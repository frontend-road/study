{"id":71806,"title":"12 | 为什么我的MySQL会“抖”一下？","content":"<p>平时的工作中，不知道你有没有遇到过这样的场景，一条SQL语句，正常执行的时候特别快，但是有时也不知道怎么回事，它就会变得特别慢，并且这样的场景很难复现，它不只随机，而且持续时间还很短。</p><p>看上去，这就像是数据库“抖”了一下。今天，我们就一起来看一看这是什么原因。</p><h1>你的SQL语句为什么变“慢”了</h1><p>在前面第2篇文章<a href=\"https://time.geekbang.org/column/article/68633\">《日志系统：一条SQL更新语句是如何执行的？》</a>中，我为你介绍了WAL机制。现在你知道了，InnoDB在处理更新语句的时候，只做了写日志这一个磁盘操作。这个日志叫作redo log（重做日志），也就是《孔乙己》里咸亨酒店掌柜用来记账的粉板，在更新内存写完redo log后，就返回给客户端，本次更新成功。</p><p>做下类比的话，掌柜记账的账本是数据文件，记账用的粉板是日志文件（redo log），掌柜的记忆就是内存。</p><p>掌柜总要找时间把账本更新一下，这对应的就是把内存里的数据写入磁盘的过程，术语就是flush。在这个flush操作执行之前，孔乙己的赊账总额，其实跟掌柜手中账本里面的记录是不一致的。因为孔乙己今天的赊账金额还只在粉板上，而账本里的记录是老的，还没把今天的赊账算进去。</p><p><strong>当内存数据页跟磁盘数据页内容不一致的时候，我们称这个内存页为“脏页”。内存数据写入到磁盘后，内存和磁盘上的数据页的内容就一致了，称为“干净页”</strong>。</p><!-- [[[read_end]]] --><p>不论是脏页还是干净页，都在内存中。在这个例子里，内存对应的就是掌柜的记忆。</p><p>接下来，我们用一个示意图来展示一下“孔乙己赊账”的整个操作过程。假设原来孔乙己欠账10文，这次又要赊9文。</p><p><img src=\"https://static001.geekbang.org/resource/image/34/da/349cfab9e4f5d2a75e07b2132a301fda.jpeg?wh=1142*1522\" alt=\"\"></p><center><span class=\"reference\">图1 “孔乙己赊账”更新和flush过程</span></center><p>回到文章开头的问题，你不难想象，平时执行很快的更新操作，其实就是在写内存和日志，而MySQL偶尔“抖”一下的那个瞬间，可能就是在刷脏页（flush）。</p><p>那么，什么情况会引发数据库的flush过程呢？</p><p>我们还是继续用咸亨酒店掌柜的这个例子，想一想：掌柜在什么情况下会把粉板上的赊账记录改到账本上？</p><ul>\n<li>第一种场景是，粉板满了，记不下了。这时候如果再有人来赊账，掌柜就只得放下手里的活儿，将粉板上的记录擦掉一些，留出空位以便继续记账。当然在擦掉之前，他必须先将正确的账目记录到账本中才行。<br>\n这个场景，对应的就是InnoDB的redo log写满了。这时候系统会停止所有更新操作，把checkpoint往前推进，redo log留出空间可以继续写。我在第二讲画了一个redo log的示意图，这里我改成环形，便于大家理解。</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/a2/e5/a25bdbbfc2cfc5d5e20690547fe7f2e5.jpg?wh=1142*856\" alt=\"\"></p><center><span class=\"reference\">图2 redo log状态图</span></center><p>checkpoint可不是随便往前修改一下位置就可以的。比如图2中，把checkpoint位置从CP推进到CP’，就需要将两个点之间的日志（浅绿色部分），对应的所有脏页都flush到磁盘上。之后，图中从write pos到CP’之间就是可以再写入的redo log的区域。</p><ul>\n<li>\n<p>第二种场景是，这一天生意太好，要记住的事情太多，掌柜发现自己快记不住了，赶紧找出账本把孔乙己这笔账先加进去。<br>\n这种场景，对应的就是系统内存不足。当需要新的内存页，而内存不够用的时候，就要淘汰一些数据页，空出内存给别的数据页使用。如果淘汰的是“脏页”，就要先将脏页写到磁盘。<br>\n你一定会说，这时候难道不能直接把内存淘汰掉，下次需要请求的时候，从磁盘读入数据页，然后拿redo log出来应用不就行了？这里其实是从性能考虑的。如果刷脏页一定会写盘，就保证了每个数据页有两种状态：</p>\n<ul>\n<li>一种是内存里存在，内存里就肯定是正确的结果，直接返回；</li>\n<li>另一种是内存里没有数据，就可以肯定数据文件上是正确的结果，读入内存后返回。<br>\n这样的效率最高。</li>\n</ul>\n</li>\n<li>\n<p>第三种场景是，生意不忙的时候，或者打烊之后。这时候柜台没事，掌柜闲着也是闲着，不如更新账本。<br>\n这种场景，对应的就是MySQL认为系统“空闲”的时候。当然，MySQL“这家酒店”的生意好起来可是会很快就能把粉板记满的，所以“掌柜”要合理地安排时间，即使是“生意好”的时候，也要见缝插针地找时间，只要有机会就刷一点“脏页”。</p>\n</li>\n<li>\n<p>第四种场景是，年底了咸亨酒店要关门几天，需要把账结清一下。这时候掌柜要把所有账都记到账本上，这样过完年重新开张的时候，就能就着账本明确账目情况了。<br>\n这种场景，对应的就是MySQL正常关闭的情况。这时候，MySQL会把内存的脏页都flush到磁盘上，这样下次MySQL启动的时候，就可以直接从磁盘上读数据，启动速度会很快。</p>\n</li>\n</ul><p>接下来，<strong>你可以分析一下上面四种场景对性能的影响。</strong></p><p>其中，第三种情况是属于MySQL空闲时的操作，这时系统没什么压力，而第四种场景是数据库本来就要关闭了。这两种情况下，你不会太关注“性能”问题。所以这里，我们主要来分析一下前两种场景下的性能问题。</p><p>第一种是“redo log写满了，要flush脏页”，这种情况是InnoDB要尽量避免的。因为出现这种情况的时候，整个系统就不能再接受更新了，所有的更新都必须堵住。如果你从监控上看，这时候更新数会跌为0。</p><p>第二种是“内存不够用了，要先将脏页写到磁盘”，这种情况其实是常态。<strong>InnoDB用缓冲池（buffer pool）管理内存，缓冲池中的内存页有三种状态：</strong></p><ul>\n<li>第一种是，还没有使用的；</li>\n<li>第二种是，使用了并且是干净页；</li>\n<li>第三种是，使用了并且是脏页。</li>\n</ul><p>InnoDB的策略是尽量使用内存，因此对于一个长时间运行的库来说，未被使用的页面很少。</p><p>而当要读入的数据页没有在内存的时候，就必须到缓冲池中申请一个数据页。这时候只能把最久不使用的数据页从内存中淘汰掉：如果要淘汰的是一个干净页，就直接释放出来复用；但如果是脏页呢，就必须将脏页先刷到磁盘，变成干净页后才能复用。</p><p>所以，刷脏页虽然是常态，但是出现以下这两种情况，都是会明显影响性能的：</p><ol>\n<li>\n<p>一个查询要淘汰的脏页个数太多，会导致查询的响应时间明显变长；</p>\n</li>\n<li>\n<p>日志写满，更新全部堵住，写性能跌为0，这种情况对敏感业务来说，是不能接受的。</p>\n</li>\n</ol><p>所以，InnoDB需要有控制脏页比例的机制，来尽量避免上面的这两种情况。</p><h1>InnoDB刷脏页的控制策略</h1><p>接下来，我就来和你说说InnoDB脏页的控制策略，以及和这些策略相关的参数。</p><p>首先，你要正确地告诉InnoDB所在主机的IO能力，这样InnoDB才能知道需要全力刷脏页的时候，可以刷多快。</p><p>这就要用到innodb_io_capacity这个参数了，它会告诉InnoDB你的磁盘能力。这个值我建议你设置成磁盘的IOPS。磁盘的IOPS可以通过fio这个工具来测试，下面的语句是我用来测试磁盘随机读写的命令：</p><pre><code> fio -filename=$filename -direct=1 -iodepth 1 -thread -rw=randrw -ioengine=psync -bs=16k -size=500M -numjobs=10 -runtime=10 -group_reporting -name=mytest \n</code></pre><p>其实，因为没能正确地设置innodb_io_capacity参数，而导致的性能问题也比比皆是。之前，就曾有其他公司的开发负责人找我看一个库的性能问题，说MySQL的写入速度很慢，TPS很低，但是数据库主机的IO压力并不大。经过一番排查，发现罪魁祸首就是这个参数的设置出了问题。</p><p>他的主机磁盘用的是SSD，但是innodb_io_capacity的值设置的是300。于是，InnoDB认为这个系统的能力就这么差，所以刷脏页刷得特别慢，甚至比脏页生成的速度还慢，这样就造成了脏页累积，影响了查询和更新性能。</p><p>虽然我们现在已经定义了“全力刷脏页”的行为，但平时总不能一直是全力刷吧？毕竟磁盘能力不能只用来刷脏页，还需要服务用户请求。所以接下来，我们就一起看看InnoDB怎么控制引擎按照“全力”的百分比来刷脏页。</p><p>根据我前面提到的知识点，试想一下，<strong>如果你来设计策略控制刷脏页的速度，会参考哪些因素呢？</strong></p><p>这个问题可以这么想，如果刷太慢，会出现什么情况？首先是内存脏页太多，其次是redo log写满。</p><p>所以，InnoDB的刷盘速度就是要参考这两个因素：一个是脏页比例，一个是redo log写盘速度。</p><p>InnoDB会根据这两个因素先单独算出两个数字。</p><p>参数innodb_max_dirty_pages_pct是脏页比例上限，默认值是75%。InnoDB会根据当前的脏页比例（假设为M），算出一个范围在0到100之间的数字，计算这个数字的伪代码类似这样：</p><pre><code>F1(M)\n{\n  if M&gt;=innodb_max_dirty_pages_pct then\n      return 100;\n  return 100*M/innodb_max_dirty_pages_pct;\n}\n</code></pre><p>InnoDB每次写入的日志都有一个序号，当前写入的序号跟checkpoint对应的序号之间的差值，我们假设为N。InnoDB会根据这个N算出一个范围在0到100之间的数字，这个计算公式可以记为F2(N)。F2(N)算法比较复杂，你只要知道N越大，算出来的值越大就好了。</p><p>然后，<strong>根据上述算得的F1(M)和F2(N)两个值，取其中较大的值记为R，之后引擎就可以按照innodb_io_capacity定义的能力乘以R%来控制刷脏页的速度。</strong></p><p>上述的计算流程比较抽象，不容易理解，所以我画了一个简单的流程图。图中的F1、F2就是上面我们通过脏页比例和redo log写入速度算出来的两个值。</p><p><img src=\"https://static001.geekbang.org/resource/image/cc/74/cc44c1d080141aa50df6a91067475374.png?wh=1142*1522\" alt=\"\"></p><center><span class=\"reference\">图3 InnoDB刷脏页速度策略</span></center><p>现在你知道了，InnoDB会在后台刷脏页，而刷脏页的过程是要将内存页写入磁盘。所以，无论是你的查询语句在需要内存的时候可能要求淘汰一个脏页，还是由于刷脏页的逻辑会占用IO资源并可能影响到了你的更新语句，都可能是造成你从业务端感知到MySQL“抖”了一下的原因。</p><p>要尽量避免这种情况，你就要合理地设置innodb_io_capacity的值，并且<strong>平时要多关注脏页比例，不要让它经常接近75%</strong>。</p><p>其中，脏页比例是通过Innodb_buffer_pool_pages_dirty/Innodb_buffer_pool_pages_total得到的，具体的命令参考下面的代码：</p><pre><code>mysql&gt; select VARIABLE_VALUE into @a from global_status where VARIABLE_NAME = 'Innodb_buffer_pool_pages_dirty';\nselect VARIABLE_VALUE into @b from global_status where VARIABLE_NAME = 'Innodb_buffer_pool_pages_total';\nselect @a/@b;\n</code></pre><p>接下来，我们再看一个有趣的策略。</p><p>一旦一个查询请求需要在执行过程中先flush掉一个脏页时，这个查询就可能要比平时慢了。而MySQL中的一个机制，可能让你的查询会更慢：在准备刷一个脏页的时候，如果这个数据页旁边的数据页刚好是脏页，就会把这个“邻居”也带着一起刷掉；而且这个把“邻居”拖下水的逻辑还可以继续蔓延，也就是对于每个邻居数据页，如果跟它相邻的数据页也还是脏页的话，也会被放到一起刷。</p><p>在InnoDB中，innodb_flush_neighbors 参数就是用来控制这个行为的，值为1的时候会有上述的“连坐”机制，值为0时表示不找邻居，自己刷自己的。</p><p>找“邻居”这个优化在机械硬盘时代是很有意义的，可以减少很多随机IO。机械硬盘的随机IOPS一般只有几百，相同的逻辑操作减少随机IO就意味着系统性能的大幅度提升。</p><p>而如果使用的是SSD这类IOPS比较高的设备的话，我就建议你把innodb_flush_neighbors的值设置成0。因为这时候IOPS往往不是瓶颈，而“只刷自己”，就能更快地执行完必要的刷脏页操作，减少SQL语句响应时间。</p><p>在MySQL 8.0中，innodb_flush_neighbors参数的默认值已经是0了。</p><h1>小结</h1><p>今天这篇文章，我延续第2篇中介绍的WAL的概念，和你解释了这个机制后续需要的刷脏页操作和执行时机。利用WAL技术，数据库将随机写转换成了顺序写，大大提升了数据库的性能。</p><p>但是，由此也带来了内存脏页的问题。脏页会被后台线程自动flush，也会由于数据页淘汰而触发flush，而刷脏页的过程由于会占用资源，可能会让你的更新和查询语句的响应时间长一些。在文章里，我也给你介绍了控制刷脏页的方法和对应的监控方式。</p><p>文章最后，我给你留下一个思考题吧。</p><p>一个内存配置为128GB、innodb_io_capacity设置为20000的大规格实例，正常会建议你将redo log设置成4个1GB的文件。</p><p>但如果你在配置的时候不慎将redo log设置成了1个100M的文件，会发生什么情况呢？又为什么会出现这样的情况呢？</p><p>你可以把你的分析结论写在留言区里，我会在下一篇文章的末尾和你讨论这个问题。感谢你的收听，也欢迎你把这篇文章分享给更多的朋友一起阅读。</p><h1>上期问题时间</h1><p>上期我留给你的问题是，给一个学号字段创建索引，有哪些方法。</p><p>由于这个学号的规则，无论是正向还是反向的前缀索引，重复度都比较高。因为维护的只是一个学校的，因此前面6位（其中，前三位是所在城市编号、第四到第六位是学校编号）其实是固定的，邮箱后缀都是@gamil.com，因此可以只存入学年份加顺序编号，它们的长度是9位。</p><p>而其实在此基础上，可以用数字类型来存这9位数字。比如201100001，这样只需要占4个字节。其实这个就是一种hash，只是它用了最简单的转换规则：字符串转数字的规则，而刚好我们设定的这个背景，可以保证这个转换后结果的唯一性。</p><p>评论区中，也有其他一些很不错的见解。</p><p>评论用户@封建的风 说，一个学校的总人数这种数据量，50年才100万学生，这个表肯定是小表。为了业务简单，直接存原来的字符串。这个答复里面包含了“优化成本和收益”的思想，我觉得值得at出来。</p><p>@小潘 同学提了另外一个极致的方向。如果碰到表数据量特别大的场景，通过这种方式的收益是很不错的。</p><p><strong>评论区留言点赞板：</strong></p><blockquote>\n<p>@lttzzlll ，提到了用整型存“四位年份+五位编号”的方法；<br>\n由于整个学号的值超过了int上限，@老杨同志 也提到了用8个字节的bigint来存的方法。</p>\n</blockquote><p></p>","neighbors":{"left":{"article_title":"11 |  怎么给字符串字段加索引？","id":71492},"right":{"article_title":"13 | 为什么表数据删掉一半，表文件大小不变？","id":72388}},"comments":[{"had_liked":false,"id":48315,"user_name":"Tony Du","can_delete":false,"product_type":"c1","uid":1001661,"ip_address":"","ucode":"F5FCC400E615EA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/48/bd/6c7d4230.jpg","comment_is_top":true,"comment_ctime":1544418983,"is_pvip":false,"replies":[{"id":"17253","content":"好问题。 <br><br>其实由于淘汰的时候，刷脏页过程不用动redo log文件的。<br><br>这个有个额外的保证，是redo log在“重放”的时候，如果一个数据页已经是刷过的，会识别出来并跳过。<br><br>","user_name":"作者回复","comment_id":48315,"uid":"1264162","ip_address":"","utype":1,"ctime":1544425254,"user_name_real":"林晓斌"}],"discussion_count":45,"race_medal":0,"score":"9.2233737563860992e+18","product_id":100020801,"comment_content":"当内存不够用了，要将脏页写到磁盘，会有一个数据页淘汰机制（最久不使用），假设淘汰的是脏页，则此时脏页所对应的redo log的位置是随机的，当有多个不同的脏页需要刷，则对应的redo log可能在不同的位置，这样就需要把redo log的多个不同位置刷掉，这样对于redo log的处理不是就会很麻烦吗？（合并间隙，移动位置？）<br>另外，redo log的优势在于将磁盘随机写转换成了顺序写，如果需要将redo log的不同部分刷掉（刷脏页），不是就在redo log里随机读写了么？","like_count":401,"discussions":[{"author":{"id":1034001,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c7/11/89ba9915.jpg","nickname":"永远的草莓地","note":"","ucode":"D4BD8DD42350CC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":300259,"discussion_content":"&#34;为了管理脏页，在 Buffer Pool 的每个instance上都维持了一个flush list，flush list 上的 page 按照修改这些 page 的LSN号进行排序。因此定期做redo checkpoint点时，选择的 LSN 总是所有 bp instance 的 flush list 上最老的那个page（拥有最小的LSN）&#34; 见 http://mysql.taobao.org/monthly/2015/05/01/","likes_number":21,"is_delete":false,"is_hidden":false,"ctime":1598001754,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1649191,"avatar":"https://static001.geekbang.org/account/avatar/00/19/2a/27/d4af5768.jpg","nickname":"哇哈哈","note":"","ucode":"F21A9BA36ABBBE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1034001,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c7/11/89ba9915.jpg","nickname":"永远的草莓地","note":"","ucode":"D4BD8DD42350CC","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":387534,"discussion_content":"对不上，层主问的是脏页刷新导致可能会redolog变动，这段文字回答的是checkpoint发生的时候脏页的处理方式","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628236401,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":300259,"ip_address":""},"score":387534,"extra":""},{"author":{"id":1054827,"avatar":"https://static001.geekbang.org/account/avatar/00/10/18/6b/a1448af1.jpg","nickname":"贝影","note":"","ucode":"19545C8DCBF8A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1649191,"avatar":"https://static001.geekbang.org/account/avatar/00/19/2a/27/d4af5768.jpg","nickname":"哇哈哈","note":"","ucode":"F21A9BA36ABBBE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543481,"discussion_content":"2阶段的时候redolog不就已经提交了吗，脏页是另外的数据刷盘吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641174925,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":387534,"ip_address":""},"score":543481,"extra":""},{"author":{"id":1034001,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c7/11/89ba9915.jpg","nickname":"永远的草莓地","note":"","ucode":"D4BD8DD42350CC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1649191,"avatar":"https://static001.geekbang.org/account/avatar/00/19/2a/27/d4af5768.jpg","nickname":"哇哈哈","note":"","ucode":"F21A9BA36ABBBE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556880,"discussion_content":"刷脏页不用管redo log  ，redo log需要擦除时，对比数据页的Lsn即可","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647564444,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":387534,"ip_address":""},"score":556880,"extra":""}]},{"author":{"id":1308434,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f7/12/009c12e9.jpg","nickname":"钱睿","note":"","ucode":"66AEB1583F648C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":298537,"discussion_content":"版本号，妙了，我还想同步redolog和脏页如何保证事务，只要带上版本号，只刷脏页就可以了","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1597320373,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":2206508,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/O6qftWBakkjQHrAhF5tia21GKkQxibJaPy2nWUKc9eiaouaqb67Hj60RRKgjgHhzPmaxaHkLszcNYrDSkj21lPylQ/132","nickname":"Geek_a852c8","note":"","ucode":"D925A9D71A76BA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1308434,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f7/12/009c12e9.jpg","nickname":"钱睿","note":"","ucode":"66AEB1583F648C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":360814,"discussion_content":"我也觉得有个版本号，如果重放的时候，版本号一样的话就不用理了","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1616544644,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":298537,"ip_address":""},"score":360814,"extra":""},{"author":{"id":2457860,"avatar":"https://static001.geekbang.org/account/avatar/00/25/81/04/853bc40f.jpg","nickname":"岑寂","note":"","ucode":"C602B1D7F45D32","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1308434,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f7/12/009c12e9.jpg","nickname":"钱睿","note":"","ucode":"66AEB1583F648C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":407154,"discussion_content":"lsn就可理解为版本号","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634915915,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":298537,"ip_address":""},"score":407154,"extra":""}]},{"author":{"id":1810787,"avatar":"","nickname":"Geek_224f63","note":"","ucode":"AA060E5F0C8270","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":196023,"discussion_content":"你这样想，如果对应的脏页不在内存，那肯定刷过了，如果在内存对比lsn","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1583327496,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1888845,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIWia36ia0QonoQ3ygRMmUDWglTylzqcg3141TgicHrXTLXQIRh1hZdtUYOjEZ56ibFERastOkP7Lqxog/132","nickname":"秦时灬明月","note":"","ucode":"38C65E2E0AF38A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1810787,"avatar":"","nickname":"Geek_224f63","note":"","ucode":"AA060E5F0C8270","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311413,"discussion_content":"断电情况下，脏页不在内存，也没有刷过。redo log应该会有标识，哪些刷过了哪些没有刷过","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1602331661,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":196023,"ip_address":""},"score":311413,"extra":""},{"author":{"id":2368651,"avatar":"https://static001.geekbang.org/account/avatar/00/24/24/8b/1c1ae6db.jpg","nickname":"四次挥手","note":"","ucode":"7E08DC2A60AF75","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1888845,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIWia36ia0QonoQ3ygRMmUDWglTylzqcg3141TgicHrXTLXQIRh1hZdtUYOjEZ56ibFERastOkP7Lqxog/132","nickname":"秦时灬明月","note":"","ucode":"38C65E2E0AF38A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336040,"discussion_content":"加标识就没必要了，只需要一次判断，不然每一次都去给redolog一个标识，这样的成本可能有点高吧。个人理解","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1608461709,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":311413,"ip_address":""},"score":336040,"extra":""}]},{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432125,"discussion_content":"好问题。 \n\n其实由于淘汰的时候，刷脏页过程不用动redo log文件的。\n\n这个有个额外的保证，是redo log在“重放”的时候，如果一个数据页已经是刷过的，会识别出来并跳过。\n\n","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1544425254,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1518795,"avatar":"","nickname":"Geek_2ac804","note":"","ucode":"EDF69B20030BB8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554058,"discussion_content":"redolog记录的是对页的操作日志，是对内存数据意外丢失的一种保险。内存和redolog是磁盘数据更新的两种来源，各做各的。如果内存刷过了，redolog在重放的时候，跳过即可，所谓重放，就是指将这些操作日志对数据页应用一遍","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1646203285,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1628398,"avatar":"https://static001.geekbang.org/account/avatar/00/18/d8/ee/17f220b6.jpg","nickname":"蛋炒饭加鸡蛋","note":"","ucode":"C75E27B9FB3336","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":201815,"discussion_content":"还是不理解为什么redo log不用动","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1583841579,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":6,"child_discussions":[{"author":{"id":2368651,"avatar":"https://static001.geekbang.org/account/avatar/00/24/24/8b/1c1ae6db.jpg","nickname":"四次挥手","note":"","ucode":"7E08DC2A60AF75","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1628398,"avatar":"https://static001.geekbang.org/account/avatar/00/18/d8/ee/17f220b6.jpg","nickname":"蛋炒饭加鸡蛋","note":"","ucode":"C75E27B9FB3336","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336039,"discussion_content":"我的理解：redo log记录的是数据页的改变，在进行redolog合并的时候，可以判断当前数据页的数据是否和redolog的相同，如果相同的话就不需要改了吧。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608461639,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":201815,"ip_address":""},"score":336039,"extra":""},{"author":{"id":2323862,"avatar":"https://static001.geekbang.org/account/avatar/00/23/75/96/b3ddc5df.jpg","nickname":"保安队长","note":"","ucode":"7D96E23AA987DD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1628398,"avatar":"https://static001.geekbang.org/account/avatar/00/18/d8/ee/17f220b6.jpg","nickname":"蛋炒饭加鸡蛋","note":"","ucode":"C75E27B9FB3336","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343150,"discussion_content":"因为脏页代表着内存中最新的数据，只把脏页刷新到硬盘就行了，如果动 redo log ，会导致随机读 redo log 的情况，性能不高，而且 redo log 的两个参数，write pos 和 check point 也不支持你随机读。","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1610957235,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":201815,"ip_address":""},"score":343150,"extra":""},{"author":{"id":2364366,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ0L9a0y8JQYK6ugqyD0ZkibU69C3McSZ2TCgjyDf3gpL9Esic91TicpLIH9iaTBZibMiaJG5bWOvibU0fNg/132","nickname":"GreyFoss","note":"","ucode":"83E523BB4602CC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1628398,"avatar":"https://static001.geekbang.org/account/avatar/00/18/d8/ee/17f220b6.jpg","nickname":"蛋炒饭加鸡蛋","note":"","ucode":"C75E27B9FB3336","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344929,"discussion_content":"我的理解是，内存中的脏页顺序页redolog中的记录顺序一致，如果你能保证刷脏页的算法就是LRU，那么就可以不用修改redolog了，因为会被刷脏的页也就对应最末尾的redolog记录。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1611627107,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":201815,"ip_address":""},"score":344929,"extra":""}]},{"author":{"id":1070253,"avatar":"https://static001.geekbang.org/account/avatar/00/10/54/ad/6ee2b7cb.jpg","nickname":"Jacob.C","note":"","ucode":"034998E7A7CCD1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":186521,"discussion_content":"精彩细节","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1582688114,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1695207,"avatar":"https://static001.geekbang.org/account/avatar/00/19/dd/e7/0d923009.jpg","nickname":"Geek_Winy","note":"","ucode":"BEE395FC91E131","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":33384,"discussion_content":"&#34;如果一个数据页已经是刷过的，会识别出来并跳过。&#34;, 这里有个疑惑：这个数据页下一次被载入新的数据时，这个“被刷过“的标记，会被清除吧；那redo log重放该怎么判断这个页是否被刷过呢？","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1571118534,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1695207,"avatar":"https://static001.geekbang.org/account/avatar/00/19/dd/e7/0d923009.jpg","nickname":"Geek_Winy","note":"","ucode":"BEE395FC91E131","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":154969,"discussion_content":"如果被转入新的数据，那应该就变成还未刷过吧。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1580204938,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":33384,"ip_address":""},"score":154969,"extra":""}]},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587363,"discussion_content":"总结一波：\n1.当内存不够,脏页比例过多,redo log满了,后台定时刷新都会间接触发checkpoint,checkpoint可以直白的理解为刷脏的最新进度。\n2.checkpoint会将flush链表的脏页落库到磁盘,同时同步当前落库的最大数据页lsn到redo中，此时redo推进的时候就可以复用write position和checkpoint的数据，因为这部分数据表示已经刷脏的数据\n3.由于checkpoint的时候redo的checkpoint标识还未更新，此时发生断电那么redo里面就会存在已经刷脏的日志，此时重启回放的时候就会出现重复应用，那么redo是如何处理的呢？很简单,redo发现日志lsn比数据页小就会跳过不进行应用\n","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1662994399,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2063201,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/7b/61/b65f1438.jpg","nickname":"🤩","note":"","ucode":"9F0524A1BA1BE6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385798,"discussion_content":"有点不明白这句话&#34;这个额外的保证，如果一个数据页已经是刷过的，会识别出来并跳过。&#34;,那要是脏页被刷进磁盘之后，在redo log&#34;重放&#34;之前,这个页数据还是有改动，这种场景也跳过吗？具体是怎么判断是不是刷到了redo log最新的数据，还是只刷到了redo log中这个页的一半记录？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1627280718,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1668117,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJLgibqHsl97Oq3nvnEVz7V3kaGKLmia0Ja8c4yXO7QeLKiakganRJomNGgYToW4RnFs60zibDTHicjE5w/132","nickname":"学而不思则惘","note":"","ucode":"8ED2B08AA5A755","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2063201,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/7b/61/b65f1438.jpg","nickname":"🤩","note":"","ucode":"9F0524A1BA1BE6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389095,"discussion_content":"刷进盘了怎么还有改动啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629115793,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":385798,"ip_address":""},"score":389095,"extra":""}]},{"author":{"id":2198263,"avatar":"","nickname":"shimmer","note":"","ucode":"63F3E9DCCC2C43","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":347518,"discussion_content":"既然刷脏页不会动redo log，那么redo log的checkpoint除了redo log写满的时候，还会有哪些场景下会推进？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1612247597,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":2348334,"avatar":"","nickname":"11111","note":"","ucode":"99E5613B1772C2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2198263,"avatar":"","nickname":"shimmer","note":"","ucode":"63F3E9DCCC2C43","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":360986,"discussion_content":"redo log 分为buffer和数据文件, buffer同步数据文件的时候,就会推进","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616574543,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":347518,"ip_address":""},"score":360986,"extra":""},{"author":{"id":1890006,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/d6/d6/5fbb6e00.jpg","nickname":"再忙也要充充电","note":"","ucode":"098F2D9D280D60","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2348334,"avatar":"","nickname":"11111","note":"","ucode":"99E5613B1772C2","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380038,"discussion_content":"你说的这个是会推进write point吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624288806,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":360986,"ip_address":""},"score":380038,"extra":""},{"author":{"id":1890006,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/d6/d6/5fbb6e00.jpg","nickname":"再忙也要充充电","note":"","ucode":"098F2D9D280D60","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2198263,"avatar":"","nickname":"shimmer","note":"","ucode":"63F3E9DCCC2C43","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380039,"discussion_content":"我觉得要看从哪里为基准开始刷把，按上面问题所说，从内存脏页侧开始刷的话，不推进checkpoint效率更高，因为要刷的脏页可能对应redolog上不同的位置。但如果但从redolog去推进的话，根据redolog上的记录去找内存页就可以推进checkpoint","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624289162,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":347518,"ip_address":""},"score":380039,"extra":""}]},{"author":{"id":2056201,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/60/09/a8e7913b.jpg","nickname":"SandCarving","note":"","ucode":"6B97DB71613A46","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":321699,"discussion_content":"是如何识别出来跳过的呢？是每一次刷脏页的时候，都要去redolog进行标志吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604624370,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1018620,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8a/fc/d1dd57dd.jpg","nickname":"ipofss","note":"","ucode":"DE3061C9259F9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":202317,"discussion_content":"好问题，学习了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583896407,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1242455,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f5/57/ce10fb1b.jpg","nickname":"天天向上","note":"","ucode":"0CCCA6F4DCC480","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":196976,"discussion_content":"刷脏页为什么不需要动redo log文件啊，不是需要移动check point吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583391049,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1539926,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIUBia0Aevb2CyMNPvuzTkVvlcoDpdFELFav5Bcic90wxehZibo0VglM7aRZLMo93Ful7v5TFlKfEYyg/132","nickname":"啊不多","note":"","ucode":"A38DE3C564B748","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1242455,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f5/57/ce10fb1b.jpg","nickname":"天天向上","note":"","ucode":"0CCCA6F4DCC480","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":200006,"discussion_content":"我理解的是 刷新脏页，只是把内存中的脏页写到磁盘中，保持磁盘数据的正确性，这样redo log的数据和 磁盘中的数据 也是一致的，redo log的数据不需要在这个过程中改变，redo log的数据只会在 满了之后，check point点移动的时候改变","likes_number":22,"is_delete":false,"is_hidden":false,"ctime":1583644652,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":196976,"ip_address":""},"score":200006,"extra":""},{"author":{"id":1567039,"avatar":"https://static001.geekbang.org/account/avatar/00/17/e9/3f/f4c1b255.jpg","nickname":"FINE","note":"","ucode":"46D391D85C5E58","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1242455,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f5/57/ce10fb1b.jpg","nickname":"天天向上","note":"","ucode":"0CCCA6F4DCC480","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":355300,"discussion_content":"从内存刷不用动redo log，从redo log刷需要动cp","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615401703,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":196976,"ip_address":""},"score":355300,"extra":""}]},{"author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"艿艿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":35050,"discussion_content":"赞，也有这个疑惑~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571233178,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1480717,"avatar":"https://static001.geekbang.org/account/avatar/00/16/98/0d/fb77a32c.jpg","nickname":"Tim","note":"","ucode":"3AAA9FD3D8DDDB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"艿艿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":319562,"discussion_content":"但是上文说：“redo log 写满了，要 flush 脏页”，这种情况是 InnoDB 要尽量避免的。     那他只刷脏页，不清redolog，而只是碰到了跳过的话，岂不是很容易经常就把redolog环写满了？","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1604051344,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":35050,"ip_address":""},"score":319562,"extra":""},{"author":{"id":1526355,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","nickname":"moonfox","note":"","ucode":"902BFF40EFA9FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1480717,"avatar":"https://static001.geekbang.org/account/avatar/00/16/98/0d/fb77a32c.jpg","nickname":"Tim","note":"","ucode":"3AAA9FD3D8DDDB","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":330702,"discussion_content":"不用清呀，跳过就等于推进了checkponit，被跳过的部分就可以直接使用了呀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606672967,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":319562,"ip_address":""},"score":330702,"extra":""},{"author":{"id":1518795,"avatar":"","nickname":"Geek_2ac804","note":"","ucode":"EDF69B20030BB8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1480717,"avatar":"https://static001.geekbang.org/account/avatar/00/16/98/0d/fb77a32c.jpg","nickname":"Tim","note":"","ucode":"3AAA9FD3D8DDDB","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554073,"discussion_content":"我的理解是，如果内存中大部分的数据都被刷过了，这个redolog的写满，就像纸老虎一样，需要推进的时候，瞬间就推进了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646205731,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":319562,"ip_address":""},"score":554073,"extra":""}]},{"author":{"id":1695207,"avatar":"https://static001.geekbang.org/account/avatar/00/19/dd/e7/0d923009.jpg","nickname":"Geek_Winy","note":"","ucode":"BEE395FC91E131","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":33387,"discussion_content":"自己再回答下，应该是如下面@melon的评论：新页LSN不同了，即可直接跳过","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571118809,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":2457860,"avatar":"https://static001.geekbang.org/account/avatar/00/25/81/04/853bc40f.jpg","nickname":"岑寂","note":"","ucode":"C602B1D7F45D32","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1695207,"avatar":"https://static001.geekbang.org/account/avatar/00/19/dd/e7/0d923009.jpg","nickname":"Geek_Winy","note":"","ucode":"BEE395FC91E131","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":407151,"discussion_content":"应该是redolog要重放的lsn和对应的磁盘数据页的lsn一致，才跳过","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1634915756,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":33387,"ip_address":""},"score":407151,"extra":""},{"author":{"id":1209939,"avatar":"https://static001.geekbang.org/account/avatar/00/12/76/53/21d62a23.jpg","nickname":"鲁·本","note":"","ucode":"F1DEB30C21B48E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2457860,"avatar":"https://static001.geekbang.org/account/avatar/00/25/81/04/853bc40f.jpg","nickname":"岑寂","note":"","ucode":"C602B1D7F45D32","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553474,"discussion_content":"是的，应该就是事务的编号","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645891166,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":407151,"ip_address":""},"score":553474,"extra":""}]},{"author":{"id":1307369,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f2/e9/52c5f8c5.jpg","nickname":"cz","note":"","ucode":"059BDE273CB5E0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":15213,"discussion_content":"&#34;重放&#34;是什么意思，哪位大佬解释一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568811606,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1318914,"avatar":"https://static001.geekbang.org/account/avatar/00/14/20/02/df2bfda9.jpg","nickname":"公共号","note":"","ucode":"4759B517D4CD5E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1307369,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f2/e9/52c5f8c5.jpg","nickname":"cz","note":"","ucode":"059BDE273CB5E0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":68142,"discussion_content":"重放的意思应该就是对数据页应用 redo log 的过程","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1575203978,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":15213,"ip_address":""},"score":68142,"extra":""},{"author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"一元(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1318914,"avatar":"https://static001.geekbang.org/account/avatar/00/14/20/02/df2bfda9.jpg","nickname":"公共号","note":"","ucode":"4759B517D4CD5E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302743,"discussion_content":"是的，详细点儿说就是，当内存中的脏页由于断电丢失，就需要通过磁盘中的redo log记录重新将丢失的脏页数据写回磁盘的过程 ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1599017940,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":68142,"ip_address":""},"score":302743,"extra":""},{"author":{"id":1518795,"avatar":"","nickname":"Geek_2ac804","note":"","ucode":"EDF69B20030BB8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1307369,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f2/e9/52c5f8c5.jpg","nickname":"cz","note":"","ucode":"059BDE273CB5E0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554074,"discussion_content":"重放的意思就是将redolog中记录的对页的操作日志，对磁盘上的数据页应用一次","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646205976,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":15213,"ip_address":""},"score":554074,"extra":""}]}]},{"had_liked":false,"id":48501,"user_name":"某、人","can_delete":false,"product_type":"c1","uid":1308784,"ip_address":"","ucode":"ADB42AA12A11C1","user_header":"https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg","comment_is_top":true,"comment_ctime":1544454962,"is_pvip":false,"replies":[{"id":"17419","content":"抖得像过冬一样，😄👍🏿<br><br>你说得很对，第4点没错的，出现这种情况的时候，连change buffer的优化也没意义了","user_name":"作者回复","comment_id":48501,"uid":"1264162","ip_address":"","utype":1,"ctime":1544501441,"user_name_real":"林晓斌"}],"discussion_count":13,"race_medal":0,"score":"9.2233728802127995e+18","product_id":100020801,"comment_content":"redo log是关系型数据库的核心啊,保证了ACID里的D。所以redo log是牵一发而动全身的操作<br>按照老师说的当内存数据页跟磁盘数据页不一致的时候,把内存页称为&#39;脏页&#39;。如果redo log<br>设置得太小,redo log写满.那么会涉及到哪些操作呢,我认为是以下几点:<br>1.把相对应的数据页中的脏页持久化到磁盘,checkpoint往前推<br>2.由于redo log还记录了undo的变化,undo log buffer也要持久化进undo log<br>3.当innodb_flush_log_at_trx_commit设置为非1,还要把内存里的redo log持久化到磁盘上<br>4.redo log还记录了change buffer的改变,那么还要把change buffer purge到idb<br>以及merge change buffer.merge生成的数据页也是脏页,也要持久化到磁盘<br>上述4种操作,都是占用系统I&#47;O,影响DML,如果操作频繁,会导致&#39;抖&#39;得向现在我们过冬一样。<br>但是对于select操作来说,查询时间相对会更快。因为系统脏页变少了,不用去淘汰脏页,直接复用<br>干净页即可。还有就是对于宕机恢复,速度也更快,因为checkpoint很接近LSN,恢复的数据页相对较少<br>所以要控制刷脏的频率,频率快了,影响DML I&#47;O,频率慢了,会导致读操作耗时长。<br>我是这样想的这个问题,有可能不太对,特别是对于第4点是否会merge以及purge,还需要老师的解答","like_count":197,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432212,"discussion_content":"抖得像过冬一样，😄👍🏿\n\n你说得很对，第4点没错的，出现这种情况的时候，连change buffer的优化也没意义了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544501441,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1857196,"avatar":"","nickname":"文野","note":"","ucode":"6193A3648DD557","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385551,"discussion_content":"求点拨下redo记录了undo喝change buffer怎么理解","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1627125163,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1857196,"avatar":"","nickname":"文野","note":"","ucode":"6193A3648DD557","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587364,"discussion_content":"因为undo和change buffer也都是需要保证持久化的；因此都可以通过wal机制去保证效率","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1662995085,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":385551,"ip_address":"广东"},"score":587364,"extra":""}]},{"author":{"id":1357623,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJmBKrLvqOIXDDbj3ocEIJzqsQx2e5VLDBSX6LmofYtprWwKaVAmHUqU2z3mjREHX8n9eLLiavlPg/132","nickname":"wg1993","note":"","ucode":"D5112FEFDB1DF7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":90234,"discussion_content":"&#34;当innodb_flush_log_at_trx_commit设置为非1,还要把内存里的redo log持久化到磁盘上&#34;这个应该是为1的时候要持久化吧","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1576767824,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1464074,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/cfNtHoAbHvia6I8k83V5ohrAtASOqQH1ibicotV4wwRgRdTd587zib55V2kVW0eFIJxo3OIrLJ2yx8MFtg9vMYJaLQ/132","nickname":"AlexZFX","note":"","ucode":"2061383AF4B27A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1357623,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJmBKrLvqOIXDDbj3ocEIJzqsQx2e5VLDBSX6LmofYtprWwKaVAmHUqU2z3mjREHX8n9eLLiavlPg/132","nickname":"wg1993","note":"","ucode":"D5112FEFDB1DF7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":162180,"discussion_content":"我感觉他的意思是，为1的时候，每个事务都要写磁盘，但不为1的时候，是分不确定的时间写盘的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580969618,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":90234,"ip_address":""},"score":162180,"extra":""}]},{"author":{"id":1731047,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/GmtqEx7x5hagZtXbd8Xs8ocUuHHLGIgiaqTwTcibPnpla1PVTbed2Ax7ZfzCjN2Qpeyao6ogq7L3icLzSB3vY1rlg/132","nickname":"Chanson","note":"","ucode":"74B3B180B4B953","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":358185,"discussion_content":"mark","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1615943749,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1518795,"avatar":"","nickname":"Geek_2ac804","note":"","ucode":"EDF69B20030BB8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554076,"discussion_content":"第一个评论中老师说，内存刷盘，不动redolog。这里的第一点说，内存刷盘了，checkpoint往前推，这里谁能解释下吗？我之前的理解是，内存刷盘了，checkpoint暂时不推也没关系，等redolog满的时候，再推，由于之前数据都在内存刷过了，这个checkpoint往前推的速度应该很快，基本可以理解为瞬间的，所以基本可以理解为内存刷盘，checkpoint是往前推的，但实际上redolog这时候还啥也没改动，不知道这样理解对不对","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646206259,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1199601,"avatar":"https://static001.geekbang.org/account/avatar/00/12/4d/f1/a56fefba.jpg","nickname":"bin","note":"","ucode":"B5AC8B5993AB76","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1518795,"avatar":"","nickname":"Geek_2ac804","note":"","ucode":"EDF69B20030BB8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556169,"discussion_content":"层主这里有个前提说是redolog写满了，触发的内存刷盘，这个就是本文说的刷盘的场景之一","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647236714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":554076,"ip_address":""},"score":556169,"extra":""}]},{"author":{"id":1209939,"avatar":"https://static001.geekbang.org/account/avatar/00/12/76/53/21d62a23.jpg","nickname":"鲁·本","note":"","ucode":"F1DEB30C21B48E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553475,"discussion_content":"总结的好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645891895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1194858,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3b/6a/80d9c545.jpg","nickname":"RD","note":"","ucode":"E3947B6E1681AD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":408424,"discussion_content":"6啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635246462,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1009385,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/e9/814d057a.jpg","nickname":"小陈","note":"","ucode":"A03A299310AD18","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372465,"discussion_content":"第一点已经包括第四点了吧？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620347707,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1054827,"avatar":"https://static001.geekbang.org/account/avatar/00/10/18/6b/a1448af1.jpg","nickname":"贝影","note":"","ucode":"19545C8DCBF8A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1009385,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/e9/814d057a.jpg","nickname":"小陈","note":"","ucode":"A03A299310AD18","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543482,"discussion_content":"changebuffer只是普通索引吧，如果是主键索引和唯一索引的脏页就没有changebuffer啥事","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1641175699,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":372465,"ip_address":""},"score":543482,"extra":""}]},{"author":{"id":2076283,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/ae/7b/47200692.jpg","nickname":"贺子","note":"","ucode":"A64DC9D9CF7CCD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349354,"discussion_content":"查询和更新有可能会快，有可能会慢，取决于内存中的页是不是满足，也就是说是否需要从磁盘读取页","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613123133,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48809,"user_name":"yesir","can_delete":false,"product_type":"c1","uid":1017689,"ip_address":"","ucode":"CFFE7D36ADBEBA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/59/b457f370.jpg","comment_is_top":true,"comment_ctime":1544540529,"is_pvip":false,"replies":[{"id":"17521","content":"1） 这个是innodb 数据页总是，过百万是正常的，16K一个，Bufree pool size 16G 就是100万了<br><br>2）你这个例子就是io_capacity设太小了…","user_name":"作者回复","comment_id":48809,"uid":"1264162","ip_address":"","utype":1,"ctime":1544546437,"user_name_real":"林晓斌"}],"discussion_count":8,"race_medal":0,"score":"9.2233722488526991e+18","product_id":100020801,"comment_content":"我观察了下公司的数据库确实发现了抖动现象，有几个问题，<br>1）Innodb_buffer_pool_pages_total这个值很大，百万级别的，而且数值不像是人为设置上去的，是怎么来的呢？<br>2）Innodb_buffer_pool_pages_dirty达到4万多的时候就开始flush了，脏页比例是75，这肯定是远达不到的，ssd磁盘，innodb_io_capacity是200，肯定可以提高。文章中说flush的触发条件有2个，一个是内存不够了，一个是redo log 满了，那么我这个场景是哪种情况呢 ","like_count":50,"discussions":[{"author":{"id":1236163,"avatar":"https://static001.geekbang.org/account/avatar/00/12/dc/c3/e4ba51d5.jpg","nickname":"Flash","note":"","ucode":"E285075C9E0B02","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":46442,"discussion_content":"这个就是mysql认为磁盘io能力太差，导致全力刷脏页变慢、脏页累积下来，后续只要刷脏页，不管是内存不够还是日志满了导致的刷脏页，都会导致变慢。","likes_number":9,"is_delete":false,"is_hidden":false,"ctime":1573171509,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1302064,"avatar":"https://static001.geekbang.org/account/avatar/00/13/de/30/b468b41d.jpg","nickname":"北落狮门","note":"","ucode":"C5A951170001B9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2281,"discussion_content":"请问一下， 这个Innodb_buffer_pool_pages_dirty达到4万多的时候就开始flush了，这个是在那里看到的","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1563436273,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1834977,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/ff/e1/ea2b6cef.jpg","nickname":"有头发的程序员","note":"","ucode":"48B9B1C5CC4E3A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1302064,"avatar":"https://static001.geekbang.org/account/avatar/00/13/de/30/b468b41d.jpg","nickname":"北落狮门","note":"","ucode":"C5A951170001B9","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":304981,"discussion_content":"看redolog里面的checkpoint位置.推进了就必然会flush.  可以用show engine innodb status 看到.","likes_number":12,"is_delete":false,"is_hidden":false,"ctime":1599730360,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":2281,"ip_address":""},"score":304981,"extra":""}]},{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432363,"discussion_content":"1） 这个是innodb 数据页总是，过百万是正常的，16K一个，Bufree pool size 16G 就是100万了\n\n2）你这个例子就是io_capacity设太小了…","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1544546437,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1965699,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/fe/83/df562574.jpg","nickname":"慎独明强","note":"","ucode":"DC2F7F2C0C8F60","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318646,"discussion_content":"刷盘有五种时机: 1.数据库关闭 2.主线程定时刷一定比较脏页  3.lru链表保证有足够的空闲页 默认好像是1024页  4.redolog快要写满时，会强制checkpoint 5.还有就是最大75%的脏页比例。  从上面描述来看，可能是2和4场景触发的checkpoint","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1603796912,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1780797,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/2c/3d/0bd58aa4.jpg","nickname":"Em","note":"","ucode":"32012A5C603C8A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1965699,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/fe/83/df562574.jpg","nickname":"慎独明强","note":"","ucode":"DC2F7F2C0C8F60","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576700,"discussion_content":"3是啥? ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655739490,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":318646,"ip_address":""},"score":576700,"extra":""}]},{"author":{"id":1731047,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/GmtqEx7x5hagZtXbd8Xs8ocUuHHLGIgiaqTwTcibPnpla1PVTbed2Ax7ZfzCjN2Qpeyao6ogq7L3icLzSB3vY1rlg/132","nickname":"Chanson","note":"","ucode":"74B3B180B4B953","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":358187,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615943785,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1233974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/d4/36/bcb5edfc.jpg","nickname":"diyer","note":"","ucode":"1A7248C81F9300","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":201412,"discussion_content":"ssd设置5000页","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583798340,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48951,"user_name":"Ryoma","can_delete":false,"product_type":"c1","uid":1130590,"ip_address":"","ucode":"7F692369239692","user_header":"https://static001.geekbang.org/account/avatar/00/11/40/5e/b8fada94.jpg","comment_is_top":true,"comment_ctime":1544581171,"is_pvip":true,"replies":[{"id":"17580","content":"Redo log里也是记的+9哦😄","user_name":"作者回复","comment_id":48951,"uid":"1264162","ip_address":"","utype":1,"ctime":1544584768,"user_name_real":"林晓斌"}],"discussion_count":25,"race_medal":2,"score":"9.2233722101979996e+18","product_id":100020801,"comment_content":"关于粉板和redo log的类比我觉得有一点不太合适：redo log记录的是实时欠款，比如账本中是10文，又欠了9文，此时redo log 记录的是19；而粉板的话，只会追加某人欠款+9文，不会关注原来已欠款多少（不然某人赊账时，我还需要找到账本中的这个人，才知道他之前欠款多少，我觉得这个场景跟MySQL中的场景还是有区别的）<br>","like_count":40,"discussions":[{"author":{"id":1111037,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f3/fd/ca3a1b4a.jpg","nickname":"nofrish","note":"","ucode":"8A5A47FE242891","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301343,"discussion_content":"redo log不会记录实时欠款的，因为如果要记录实时欠款的话，必然涉及到每次更新都需要读磁盘数据（拿到原有的欠款数据），这样肯定是不合理的；","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1598496004,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":6,"child_discussions":[{"author":{"id":1111805,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f6/fd/2c619dde.jpg","nickname":"Joe","note":"","ucode":"F73CF74433168D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1111037,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f3/fd/ca3a1b4a.jpg","nickname":"nofrish","note":"","ucode":"8A5A47FE242891","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":315343,"discussion_content":"基于以前的值更新，会读当前，怎么都要读取最新已提交的值的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603265345,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":301343,"ip_address":""},"score":315343,"extra":""},{"author":{"id":1970443,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIx1V1QAxC4NHaxYZGyuibBN8lcURJWc5nrnO4yic1kxnDemYV2FJGialf47kYX9qtDnZZOfe1SJeLicg/132","nickname":"lleft","note":"","ucode":"D573EB509455AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1111805,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f6/fd/2c619dde.jpg","nickname":"Joe","note":"","ucode":"F73CF74433168D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":370700,"discussion_content":"顺序的写redo不就可以了，有必要去查之前的值？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619512251,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":315343,"ip_address":""},"score":370700,"extra":""},{"author":{"id":1612839,"avatar":"https://static001.geekbang.org/account/avatar/00/18/9c/27/9cf54aa9.jpg","nickname":"阿富 _ostreamBaba","note":"","ucode":"54044576B71AE3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1111037,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f3/fd/ca3a1b4a.jpg","nickname":"nofrish","note":"","ucode":"8A5A47FE242891","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554454,"discussion_content":"问个问题，如果是这样的话，redo log记录的物理信息是哪里来的呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646386705,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":301343,"ip_address":""},"score":554454,"extra":""}]},{"author":{"id":1111805,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f6/fd/2c619dde.jpg","nickname":"Joe","note":"","ucode":"F73CF74433168D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":315331,"discussion_content":"redolog记录的+9 通过redolog恢复数据时如何保证幂等性","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1603263912,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1987547,"avatar":"","nickname":"学徒","note":"","ucode":"95956442ECB8C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1111805,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f6/fd/2c619dde.jpg","nickname":"Joe","note":"","ucode":"F73CF74433168D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364143,"discussion_content":"应该是checkpoint保证只有一次写，不会出现超过一次的写，也就没有幂等一说了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1617373004,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":315331,"ip_address":""},"score":364143,"extra":""}]},{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432433,"discussion_content":"Redo log里也是记的+9哦😄","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1544584768,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2355521,"avatar":"https://static001.geekbang.org/account/avatar/00/23/f1/41/76c0758f.jpg","nickname":"君战","note":"","ucode":"A8619A79A5CED9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349338,"discussion_content":"这应该和change buffer有关吧。如果修改的数据页不在内存中，只会记录改动，不会去磁盘读取对应的数据页。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1613101211,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1210699,"avatar":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","nickname":"-W.LI-","note":"","ucode":"3556786538664F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":31728,"discussion_content":"图上画的确实是19。。。。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1570951017,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1514378,"avatar":"https://static001.geekbang.org/account/avatar/00/17/1b/8a/2cac2bc8.jpg","nickname":"糖醋小排","note":"","ucode":"C78121BF5756BC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1210699,"avatar":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","nickname":"-W.LI-","note":"","ucode":"3556786538664F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":215223,"discussion_content":"其实老师的图没有问题，刷以前内存里的数据页是19，磁盘上是10，redo log 记录了“10改19”即“+9”","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1585303256,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":31728,"ip_address":""},"score":215223,"extra":""},{"author":{"id":1168105,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/e9/c7a80d9f.jpg","nickname":"单行道","note":"","ucode":"4EB42149B476FF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1514378,"avatar":"https://static001.geekbang.org/account/avatar/00/17/1b/8a/2cac2bc8.jpg","nickname":"糖醋小排","note":"","ucode":"C78121BF5756BC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295298,"discussion_content":"如果数据页没有在内存中，redolog的这个10是从哪来的？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596159760,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":215223,"ip_address":""},"score":295298,"extra":""},{"author":{"id":1324314,"avatar":"https://static001.geekbang.org/account/avatar/00/14/35/1a/9fa38dc9.jpg","nickname":"子瞻","note":"","ucode":"5C26FF10934534","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1168105,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d2/e9/c7a80d9f.jpg","nickname":"单行道","note":"","ucode":"4EB42149B476FF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318120,"discussion_content":"就是","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603641254,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":295298,"ip_address":""},"score":318120,"extra":""}]},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587366,"discussion_content":"网上很多都说幂等性是因为它是物理日志，既然物理日志记得是增量变化，那重复应用就不会是幂等的该如何理解？虽然可以通过lsn处理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662996573,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1665194,"avatar":"https://static001.geekbang.org/account/avatar/00/19/68/aa/4b58cfd3.jpg","nickname":"神韵","note":"","ucode":"0337AC63C9FBD1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312993,"discussion_content":"那假设不是更新加1的场景呢。而是更新将某个字段的值全部设置为一个新的值。那这个场景就直接记录数据页的变化了，将某值直接改成某值而不是+-的关系了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602904234,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2005768,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/9b/08/1380ca1d.jpg","nickname":"caohongyuan","note":"","ucode":"56E2533029E924","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":278742,"discussion_content":"那我要是求总数，是怎么计算的？算了磁盘，再加内存么","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591231710,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1722479,"avatar":"","nickname":"马青艳","note":"","ucode":"388E4689BED388","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2005768,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/9b/08/1380ca1d.jpg","nickname":"caohongyuan","note":"","ucode":"56E2533029E924","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303633,"discussion_content":"从磁盘中加入内存， 再在内存中+9 算出正确的19值， 之后的查询都会使用这个内存中的19值\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1599318529,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":278742,"ip_address":""},"score":303633,"extra":""}]},{"author":{"id":1276795,"avatar":"https://static001.geekbang.org/account/avatar/00/13/7b/7b/5b39b47b.jpg","nickname":"TIAN","note":"","ucode":"CCCF80602C1753","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":228937,"discussion_content":"Redo log记录的是页的偏移量","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586592347,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1018620,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8a/fc/d1dd57dd.jpg","nickname":"ipofss","note":"","ucode":"DE3061C9259F9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":202321,"discussion_content":"解决了我的疑虑，我看文章时也有同样的疑问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583896807,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1672786,"avatar":"https://static001.geekbang.org/account/avatar/00/19/86/52/91c7d112.jpg","nickname":"Garen","note":"","ucode":"0608C88F83EF0C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":32557,"discussion_content":"应该是那个图片误导观众了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571047182,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1324314,"avatar":"https://static001.geekbang.org/account/avatar/00/14/35/1a/9fa38dc9.jpg","nickname":"子瞻","note":"","ucode":"5C26FF10934534","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1672786,"avatar":"https://static001.geekbang.org/account/avatar/00/19/86/52/91c7d112.jpg","nickname":"Garen","note":"","ucode":"0608C88F83EF0C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318119,"discussion_content":"是的，那个图片写的将10更新为19，误导了读者","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603641237,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":32557,"ip_address":""},"score":318119,"extra":""}]},{"author":{"id":1022507,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqOpANMwDibLmj5IGJh6dTw300sZ1BHM5sG3sZv1A1rvCHOiblPD3jgFOiaMVVujtctWnQbVFoNPpRgw/132","nickname":"alioo","note":"","ucode":"F36A38C1F5FFAB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6348,"discussion_content":"Mark一下，关于redolog 我以前的理解跟你一样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566865479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108808,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1561886655,"is_pvip":false,"discussion_count":10,"race_medal":0,"score":"628627111871","product_id":100020801,"comment_content":"1：MySQL抖一下是什么意思？<br><br>抖我认为就是不稳定的意思，一个SQL语句平时速度都挺快的，偶尔会慢一下且没啥规律，就是抖啦！<br><br>2：MySQL为啥会抖一下？<br><br>因为运行的不正常了，或者不稳定了，需要花费更多的资源处理别的事情，会使SQL语句的执行效率明显变慢。针对innoDB导致MySQL抖的原因，主要是InnoDB 会在后台刷脏页，而刷脏页的过程是要将内存页写入磁盘。所以，无论是你的查询语句在需要内存的时候可能要求淘汰一个脏页，还是由于刷脏页的逻辑会占用 IO 资源并可能影响到了你的更新语句，都可能是造成你从业务端感知MySQL“抖”了一下的原因。<br><br>3：MySQL抖一下有啥问题？<br><br>很明显系统不稳定，性能突然下降对业务端是很不友好的。<br><br>4：怎么让MySQL不抖？<br><br>设置合理参数配配置，尤其是设置 好innodb_io_capacity 的值，并且平时要多关注脏页比例，不要让它经常接近 75%<br><br>5：啥是脏页？<br><br>当内存数据页跟磁盘数据页内容不一致的时候，我们称这个内存页为“脏页”。<br><br>按照这个定义感觉脏页是不可避免的，写的时候总会先写内存再写磁盘和有没有用WAL没啥关系？<br><br>6：啥是干净页？<br><br>内存数据写入到磁盘后，内存和磁盘上的数据页的内容就一致了，称为“干净页”。<br><br>7：脏页是咋产生的？<br><br>因为使用了WAL技术，这个技术会把数据库的随机写转化为顺序写，但副作用就是会产生脏页。<br><br>8：啥是随机写？为啥那么耗性能？<br><br>随机写我的理解是，这次写磁盘的那个扇区和上一次没啥关系，需要重新定位位置，机械运动是很慢的即使不是机械运动重新定位写磁盘的位置也是很耗时的。<br><br>9：啥是顺序写？<br><br>顺序写我的理解是，这次写磁盘那个扇区就在上一次的下一个位置，不需要重新定位写磁盘的位置速度当然会快一些。<br><br>10：WAL怎么把随机写转化为顺序写的？<br><br>写redolog是顺序写的，先写redolog等合适的时候再写磁盘，间接的将随机写变成了顺序写，性能确实会提高不少。<br>","like_count":147,"discussions":[{"author":{"id":1796510,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKo5jCPQW87sFySwXiaLxibak0qQYuFRTyy8RlNsO9JDyxBk1AYDrsphRskxzXPLPOW8ibWicWlRAnzwg/132","nickname":"Kevin","note":"","ucode":"C23E3390995D95","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311831,"discussion_content":"意外懂了随机IO 和顺序IO ","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1602497740,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2291604,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKZoKBSLZictDd8y2wdyEBZRrw0F062q5QBmicm2MXCHllM8JAKpEmF8iafF5z6dcxqFuV7KtaicL2XjQ/132","nickname":"Geek_1346d6","note":"","ucode":"E0F9B77D46DF99","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589122,"discussion_content":"这里纠正一下关于顺序写在redo log里的描述错误，所谓的顺序写是因为在redo log里面记录了每一条写操作的页码，在顺盘时不需要通过随机写从新定位页码，而不是记录了上一个位置，下次延续上个位置写","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1664431312,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"上海"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587369,"discussion_content":"其实在高并发的事务处理中所谓的redo顺序写也只是概率上而已，毕竟磁盘头只有一个；","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662997046,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2721761,"avatar":"https://static001.geekbang.org/account/avatar/00/29/87/e1/b85dce85.jpg","nickname":"无尽蔚蓝","note":"","ucode":"A665DF46833A81","race_medal":5,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582181,"discussion_content":"应该7有点问题，脏页的产生和WAL无关。\n操作系统为了不频繁的写磁盘，使用了写缓冲（write buffer)，就是延迟写磁盘的过程（比如延迟5s），然后打包这一时间段的写请求，再写入磁盘。写磁盘前，内存是脏页，写磁盘后，内存是干净页","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659284272,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2160140,"avatar":"https://static001.geekbang.org/account/avatar/00/20/f6/0c/34b4fa0d.jpg","nickname":"仓鼠爱学习","note":"","ucode":"7DCD4106827C33","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391150,"discussion_content":"厉害。WAL就是将redo log写磁盘转化为顺序写（也就是记录上次写得位置）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630316634,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2185166,"avatar":"https://static001.geekbang.org/account/avatar/00/21/57/ce/ad3c3954.jpg","nickname":"鹅鹅鹅","note":"","ucode":"6AFA3FCC7B5AEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":352008,"discussion_content":"总结的很棒啊\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614566537,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1012416,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/72/c0/b09911a0.jpg","nickname":"meijing0114","note":"","ucode":"B349D33E2F3ECC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333086,"discussion_content":"这个总结不错，把问题都列清楚了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607430009,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1665194,"avatar":"https://static001.geekbang.org/account/avatar/00/19/68/aa/4b58cfd3.jpg","nickname":"神韵","note":"","ucode":"0337AC63C9FBD1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312998,"discussion_content":"大佬","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602905557,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1018620,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8a/fc/d1dd57dd.jpg","nickname":"ipofss","note":"","ucode":"DE3061C9259F9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":202325,"discussion_content":"总结的很棒👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583897170,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1166969,"avatar":"https://static001.geekbang.org/account/avatar/00/11/ce/79/673f4268.jpg","nickname":"小杰","note":"","ucode":"09E29168D53178","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":13774,"discussion_content":"厉害厉害~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568698790,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48664,"user_name":"melon","can_delete":false,"product_type":"c1","uid":1023773,"ip_address":"","ucode":"7A80C20EBCAAA4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9f/1d/ec173090.jpg","comment_is_top":false,"comment_ctime":1544510517,"is_pvip":false,"replies":[{"id":"17479","content":"对的。👍🏿","user_name":"作者回复","comment_id":48664,"uid":"1264162","ip_address":"","utype":1,"ctime":1544523611,"user_name_real":"林晓斌"}],"discussion_count":26,"race_medal":0,"score":"620019801141","product_id":100020801,"comment_content":"又思考了一下，请老师帮忙看一下理解的对不对：buffer pool里维护着一个脏页列表，假设现在redo log 的 checkpoint 记录的 LSN 为 10，现在内存中的一干净页有修改，修改后该页的LSN为12，大于 checkpoint 的LSN，则在写redo log的同时该页也会被标记为脏页记录到脏页列表中，现在内存不足，该页需要被淘汰掉，该页会被刷到磁盘，磁盘中该页的LSN为12，该页也从脏页列表中移除，现在redo log 需要往前推进checkpoint，到LSN为12的这条log时，发现内存中的脏页列表里没有该页，且磁盘上该页的LSN也已经为12，则该页已刷脏，已为干净页，跳过。","like_count":145,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432297,"discussion_content":"对的。👍🏿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544523611,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1254801,"avatar":"https://static001.geekbang.org/account/avatar/00/13/25/91/46600294.jpg","nickname":"猴哥一一 cium","note":"","ucode":"38EC64F8D1A0B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":361179,"discussion_content":"那好吧，放过自己，假装有个脏页列表吧，没有了就代表刷过了。方便自己理解。","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1616600708,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1061402,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/y5NFbibdKCFCg0lHKK5ERGOQWXYYK7jhnqm2BxQ6r7tWvXx8uDmibglweejDWU39BTmDSAtBJGj1ibOZK2uIHQyqg/132","nickname":"Mr_freezing37","note":"","ucode":"BB605A6FEDCEB6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":256573,"discussion_content":"如果还需要读出磁盘的LSN再做对比，跳过的意义还大吗？因为数据是按页读取的。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1588497526,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":5,"child_discussions":[{"author":{"id":1526355,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","nickname":"moonfox","note":"","ucode":"902BFF40EFA9FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1061402,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/y5NFbibdKCFCg0lHKK5ERGOQWXYYK7jhnqm2BxQ6r7tWvXx8uDmibglweejDWU39BTmDSAtBJGj1ibOZK2uIHQyqg/132","nickname":"Mr_freezing37","note":"","ucode":"BB605A6FEDCEB6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332649,"discussion_content":"同感，感觉如果要推进的页没在内存里，也不用对比了，直接跳过就可以","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1607297387,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":256573,"ip_address":""},"score":332649,"extra":""},{"author":{"id":1134266,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4e/ba/580ec429.jpg","nickname":"小兔子乖乖","note":"","ucode":"E5CC0258CF8858","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1526355,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","nickname":"moonfox","note":"","ucode":"902BFF40EFA9FA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380825,"discussion_content":"要推进的页不在内存中了，说明已经被刷过了，在脏页列表里面已经没有这一页了，因此直接跳过","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624715601,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":332649,"ip_address":""},"score":380825,"extra":""},{"author":{"id":2457860,"avatar":"https://static001.geekbang.org/account/avatar/00/25/81/04/853bc40f.jpg","nickname":"岑寂","note":"","ucode":"C602B1D7F45D32","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1526355,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","nickname":"moonfox","note":"","ucode":"902BFF40EFA9FA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":407143,"discussion_content":"应该要考虑下宕机恢复的情况，此时内存中啥都没，所以个人理解还是要读磁盘，以磁盘的lsn为准","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1634915496,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":332649,"ip_address":""},"score":407143,"extra":""}]},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587368,"discussion_content":"数据页刷脏的时候其实就会同步这个checkpoint给redo log了，因此redo log推进的时候不需要再对比数据页lsn；什么时候需要对比呢？答：出现意外宕机的时候，此时redo log的checkpoint必然是小于等于数据页已刷脏的lsn的，当redo加载数据页发现lsn比redo的lsn大则跳过不进行处理","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1662996894,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1272996,"avatar":"https://static001.geekbang.org/account/avatar/00/13/6c/a4/7f7c1955.jpg","nickname":"死磕郎一世","note":"","ucode":"86C1197C3FB2A0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542860,"discussion_content":"我的疑问是刷脏数据页的同时会不会推进checkpoint，如果不推进checkpoint，那就每次等到redo log快满了才去推进checkpoint，这样肯定影响性能了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640865758,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1188693,"avatar":"https://static001.geekbang.org/account/avatar/00/12/23/55/ee4d4aad.jpg","nickname":"小思小言","note":"","ucode":"C847C610490DA3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":353294,"discussion_content":"老师您好，请问一下，如果脏页淘汰刷到磁盘时LSN为12，磁盘中的checkpoint的位置LSN为10此时断电了，在重启恢复时LSN为11的日志不就是重复做了嘛？是否会在淘汰脏页的时候磁盘记录最后的刷盘的LSN？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615120748,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2941277,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKEkqJxpmLX8mOxVwbBMynxzRXqiaCpnTBvGEesXiajsutj1tqoGfcJEyAbPWE5OD4Omouo5N8ZmXEw/132","nickname":"Geek_510666","note":"","ucode":"111F869DDE2EB9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1188693,"avatar":"https://static001.geekbang.org/account/avatar/00/12/23/55/ee4d4aad.jpg","nickname":"小思小言","note":"","ucode":"C847C610490DA3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560422,"discussion_content":"redo log 没有记录那不是说明这个事务在没有提交的时候就断电了，那重启不恢复也无所谓了吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649321302,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":353294,"ip_address":""},"score":560422,"extra":""}]},{"author":{"id":1228424,"avatar":"https://static001.geekbang.org/account/avatar/00/12/be/88/8d15796f.jpg","nickname":"John","note":"","ucode":"A46AF2906C38C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":310357,"discussion_content":"这个是checkpoint被推进触发刷脏的情形吧。老师不是提到有一种情形是&#34;而当要读入的数据页没有在内存的时候，就必须到缓冲池中申请一个数据页。这时候只能把最久不使用的数据页从内存中淘汰掉&#34;吗？最久不使用按照惯性语义的理解是包含读的，此时要淘汰的脏页不一定是LSN最小吧。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601796049,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1074742,"avatar":"https://static001.geekbang.org/account/avatar/00/10/66/36/b4a4e6fb.jpg","nickname":"Edon du","note":"","ucode":"1648624751AAE9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1228424,"avatar":"https://static001.geekbang.org/account/avatar/00/12/be/88/8d15796f.jpg","nickname":"John","note":"","ucode":"A46AF2906C38C1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339919,"discussion_content":"淘汰掉，不一定淘汰是脏页，如果是干净页直接就淘汰了。\n如果淘汰的数据页LSN在buffer pool维护的脏页LSN列表中，则需要进行flush操作，这个时候这个flush后并淘汰的原脏页的LSN就会从脏页列表剔除掉，但也只到此为止了，redo log并没有什么改变\n当redo log执行checkpoint时，如果查到这个刚才被淘汰的LSN没有在脏页列表中就跳过不做该数据页的flush操作。","likes_number":9,"is_delete":false,"is_hidden":false,"ctime":1609840863,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":310357,"ip_address":""},"score":339919,"extra":""},{"author":{"id":2457860,"avatar":"https://static001.geekbang.org/account/avatar/00/25/81/04/853bc40f.jpg","nickname":"岑寂","note":"","ucode":"C602B1D7F45D32","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1074742,"avatar":"https://static001.geekbang.org/account/avatar/00/10/66/36/b4a4e6fb.jpg","nickname":"Edon du","note":"","ucode":"1648624751AAE9","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":407131,"discussion_content":"不对吧？宕机重启后脏页列表什么都没有哦，按你这说的，宕机后 redo log执行checkpoint，lsn也是不在脏页列表中的，这种情况不该跳过吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634914673,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":339919,"ip_address":""},"score":407131,"extra":""},{"author":{"id":1272996,"avatar":"https://static001.geekbang.org/account/avatar/00/13/6c/a4/7f7c1955.jpg","nickname":"死磕郎一世","note":"","ucode":"86C1197C3FB2A0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2457860,"avatar":"https://static001.geekbang.org/account/avatar/00/25/81/04/853bc40f.jpg","nickname":"岑寂","note":"","ucode":"C602B1D7F45D32","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542857,"discussion_content":"我的理解是redo log具有幂等性，可以重复执行的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640865370,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":407131,"ip_address":""},"score":542857,"extra":""}]},{"author":{"id":1812970,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a9/ea/5bfce6c5.jpg","nickname":"mgs2002","note":"","ucode":"F5931108BD509B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":281214,"discussion_content":"LSN是什么意思，序号？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591692825,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1308222,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f6/3e/daddccc3.jpg","nickname":"料峭","note":"","ucode":"3868CC682CBCA7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1812970,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a9/ea/5bfce6c5.jpg","nickname":"mgs2002","note":"","ucode":"F5931108BD509B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290055,"discussion_content":"log sequence number 日志序列号","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1594311358,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":281214,"ip_address":""},"score":290055,"extra":""}]},{"author":{"id":1540275,"avatar":"https://static001.geekbang.org/account/avatar/00/17/80/b3/188e1bd6.jpg","nickname":"_(:_」∠)_","note":"","ucode":"F0C757D4CF1DB1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":213531,"discussion_content":"感谢感谢 被你一说我明白了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585102352,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1295768,"avatar":"","nickname":"InfoQ_61ccf683c4df","note":"","ucode":"2D3437F0D0749F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1540275,"avatar":"https://static001.geekbang.org/account/avatar/00/17/80/b3/188e1bd6.jpg","nickname":"_(:_」∠)_","note":"","ucode":"F0C757D4CF1DB1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":292976,"discussion_content":"你确定他说的是对的？","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1595402054,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":213531,"ip_address":""},"score":292976,"extra":""},{"author":{"id":1054827,"avatar":"https://static001.geekbang.org/account/avatar/00/10/18/6b/a1448af1.jpg","nickname":"贝影","note":"","ucode":"19545C8DCBF8A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1295768,"avatar":"","nickname":"InfoQ_61ccf683c4df","note":"","ucode":"2D3437F0D0749F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543483,"discussion_content":"哈哈哈哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641176184,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":292976,"ip_address":""},"score":543483,"extra":""}]},{"author":{"id":1615539,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI6LXcIqb5K48nia8d4zmdsD1M9AZeyXoGrLzX5xvqfN0fqXOsYKUWLbZvZ8TtJCXWmYbCkCXg93dQ/132","nickname":"漏脚脖","note":"","ucode":"214AE52EC201E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":189474,"discussion_content":"同问LSN是啥。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582886581,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1810051,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK0uyg1IicbEhLwsgM2A2ROoyVdWdmUqZfQfs6G67w9m3hdRNBMOQJatQoACj3qNGgj2KVIgricaYiaQ/132","nickname":"木得感情的编码机器","note":"","ucode":"9C6CD47ADCB8E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":170029,"discussion_content":"LSN，这些名词是哪里来的，文章有提到过？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581664679,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2355521,"avatar":"https://static001.geekbang.org/account/avatar/00/23/f1/41/76c0758f.jpg","nickname":"君战","note":"","ucode":"A8619A79A5CED9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1810051,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK0uyg1IicbEhLwsgM2A2ROoyVdWdmUqZfQfs6G67w9m3hdRNBMOQJatQoACj3qNGgj2KVIgricaYiaQ/132","nickname":"木得感情的编码机器","note":"","ucode":"9C6CD47ADCB8E6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349280,"discussion_content":"Log Sequence Number","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1613035588,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":170029,"ip_address":""},"score":349280,"extra":""}]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":154997,"discussion_content":"LSN不是针对的日志来说吗？磁盘中的页也有LSN？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580208158,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2843604,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/63/d4/b63373c3.jpg","nickname":"金金","note":"","ucode":"807EDDCDB2E939","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560243,"discussion_content":"有的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649236911,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":154997,"ip_address":""},"score":560243,"extra":""}]}]},{"had_liked":false,"id":48408,"user_name":"jimmy","can_delete":false,"product_type":"c1","uid":1302059,"ip_address":"","ucode":"8F0C2BF762C33F","user_header":"https://static001.geekbang.org/account/avatar/00/13/de/2b/2702fcbe.jpg","comment_is_top":false,"comment_ctime":1544437782,"is_pvip":false,"replies":[{"id":"17298","content":"每个数据页头部有LSN，8字节，每次修改都会变大。<br><br>对比这个LSN跟checkpoint 的LSN，比checkpoint小的一定是干净页","user_name":"作者回复","comment_id":48408,"uid":"1264162","ip_address":"","utype":1,"ctime":1544440417,"user_name_real":"林晓斌"}],"discussion_count":11,"race_medal":0,"score":"495465676822","product_id":100020801,"comment_content":"老师，我想问一下，innodb是如何知道一个页是不是脏页的，是有标记位还是通过redolog的ckeckpoint来确定的？","like_count":116,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432166,"discussion_content":"每个数据页头部有LSN，8字节，每次修改都会变大。\n\n对比这个LSN跟checkpoint 的LSN，比checkpoint小的一定是干净页","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1544440417,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1665194,"avatar":"https://static001.geekbang.org/account/avatar/00/19/68/aa/4b58cfd3.jpg","nickname":"神韵","note":"","ucode":"0337AC63C9FBD1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312995,"discussion_content":"只能确定干净页，不能确定脏页呀，因为有可能此时在刷脏，那么大于检查点的lsn的内存数据页可能也是干净页，可能是脏页","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1602904632,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2029015,"avatar":"","nickname":"小钢炮","note":"","ucode":"676C4CCF3CCD0D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":410864,"discussion_content":"log sequence number","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635782272,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1324501,"avatar":"https://static001.geekbang.org/account/avatar/00/14/35/d5/17833946.jpg","nickname":"八宝","note":"","ucode":"89D991A930FDEA","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":395798,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632357124,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2130032,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/mpsOZBaHEA5oZ4A43dU21tNsakMyLRcmjn1liaJctPYfVkzB18dspeoOFNUxmEBq7I6Bjib0qPiaoF5uu0icNYek5g/132","nickname":"BestRiven","note":"","ucode":"D2642BC46EE9FC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306582,"discussion_content":"那有脏页表还拿LSN还干什么呢？是不是脏页就看页是否在脏页表中就是了吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600323688,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069042,"avatar":"https://static001.geekbang.org/account/avatar/00/10/4f/f2/6ac3bdcf.jpg","nickname":"qingtama","note":"","ucode":"765040243ECE01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":297674,"discussion_content":"但是数据页的LSN比checkpoint 的LSN大的话也不一定就是脏页吧？除非内存页淘汰策略是优先淘汰LSN最小的数据页","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597022592,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1970443,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIx1V1QAxC4NHaxYZGyuibBN8lcURJWc5nrnO4yic1kxnDemYV2FJGialf47kYX9qtDnZZOfe1SJeLicg/132","nickname":"lleft","note":"","ucode":"D573EB509455AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1069042,"avatar":"https://static001.geekbang.org/account/avatar/00/10/4f/f2/6ac3bdcf.jpg","nickname":"qingtama","note":"","ucode":"765040243ECE01","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":370701,"discussion_content":"不一定，不是还有一个刷邻居页的操作呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619512773,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":297674,"ip_address":""},"score":370701,"extra":""}]},{"author":{"id":1117597,"avatar":"https://static001.geekbang.org/account/avatar/00/11/0d/9d/58d09086.jpg","nickname":"达达队长","note":"","ucode":"1C3F2E4F6B7637","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":250770,"discussion_content":"插眼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588039097,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1637789,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/4PvDe2mRia2vdMGyickA40y2libhpf8ibmIEQquLUZFMXUMqqDjfVb96Y69p7bS6USgxicOKCCHxQHczHBnNb5L9nfA/132","nickname":"Geek_eb2e49","note":"","ucode":"21671F0C4E7872","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":98626,"discussion_content":"数据页每次修改LSN都会变大，那脏页变成干净页发生修改后LSN应该是比checkpoint的大吧?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577178640,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1637789,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/4PvDe2mRia2vdMGyickA40y2libhpf8ibmIEQquLUZFMXUMqqDjfVb96Y69p7bS6USgxicOKCCHxQHczHBnNb5L9nfA/132","nickname":"Geek_eb2e49","note":"","ucode":"21671F0C4E7872","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":154981,"discussion_content":"所以在修改之前要靠小于checkpoint才是干净页啊。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1580205943,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":98626,"ip_address":""},"score":154981,"extra":""},{"author":{"id":1339082,"avatar":"https://static001.geekbang.org/account/avatar/00/14/6e/ca/66fbd7b3.jpg","nickname":"九山的芷兰。","note":"","ucode":"28BA9773F617B9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1637789,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/4PvDe2mRia2vdMGyickA40y2libhpf8ibmIEQquLUZFMXUMqqDjfVb96Y69p7bS6USgxicOKCCHxQHczHBnNb5L9nfA/132","nickname":"Geek_eb2e49","note":"","ucode":"21671F0C4E7872","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302011,"discussion_content":"脏页变为干净页，只是进行了一个写盘行为，它的数据页内容并未被修改，所以LSN应该是不会改变的。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1598757931,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":98626,"ip_address":""},"score":302011,"extra":""}]}]},{"had_liked":false,"id":48288,"user_name":"岁月安然","can_delete":false,"product_type":"c1","uid":1258557,"ip_address":"","ucode":"4538C24B67B513","user_header":"https://static001.geekbang.org/account/avatar/00/13/34/3d/51762e76.jpg","comment_is_top":false,"comment_ctime":1544411688,"is_pvip":false,"replies":[{"id":"17249","content":"1. Redolog 的空间是循环使用的，无所谓释放。 对应的内存页会变成干净页。但是等淘汰的时候才会逐出内存<br><br>2. 好问题，前者<br><br>3. 不用记，重启了就从checkpoint 的位置往后扫。 如果已经之前刷过盘的, 不会重复应用redi log。 好问题","user_name":"作者回复","comment_id":48288,"uid":"1264162","ip_address":"","utype":1,"ctime":1544418740,"user_name_real":"林晓斌"}],"discussion_count":10,"race_medal":0,"score":"306487089704","product_id":100020801,"comment_content":"“内存不够用了，要先将脏页写到磁盘“和“redo log 写满了，要 flush 脏页”可以理解为一个脏页本身占用内存，释放内存需要将脏页写入到磁盘才能释放。而redo log写满只有当redo log对应的脏页flush到磁盘上才能释放对应空间。有几个问题：<br>1、“内存不够用了，要先将脏页写到磁盘“redo log对应的空间会释放嘛？“redo log 写满了，要 flush 脏页”对应的内存页会释放嘛？<br>2、将脏页flush到磁盘上是直接将脏页数据覆盖到对应磁盘上的数据？还是从磁盘上取到数据后取根据redo log记录进行更新后再写入到磁盘？<br>3、redo log是怎么记录对应脏页是否已经flush了？如果断电了重启导致内存丢失，前面几章说通过redo log进行数据恢复那redo log又怎么去释放空间？","like_count":72,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432106,"discussion_content":"1. Redolog 的空间是循环使用的，无所谓释放。 对应的内存页会变成干净页。但是等淘汰的时候才会逐出内存\n\n2. 好问题，前者\n\n3. 不用记，重启了就从checkpoint 的位置往后扫。 如果已经之前刷过盘的, 不会重复应用redi log。 好问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544418740,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1357311,"avatar":"https://static001.geekbang.org/account/avatar/00/14/b5/ff/d1f205b0.jpg","nickname":"L","note":"","ucode":"5B847B2378854E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":313773,"discussion_content":"redo log是怎么记录对应脏页是否已经flush了？         每次都是跳过这个问题....","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1603089280,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1134266,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4e/ba/580ec429.jpg","nickname":"小兔子乖乖","note":"","ucode":"E5CC0258CF8858","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1357311,"avatar":"https://static001.geekbang.org/account/avatar/00/14/b5/ff/d1f205b0.jpg","nickname":"L","note":"","ucode":"5B847B2378854E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380979,"discussion_content":"我觉得应该是对比数据页的lsn和redolog checkpoint的lsn，如果数据页的lsn更大就可以直接跳过","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624850348,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":313773,"ip_address":""},"score":380979,"extra":""},{"author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"戒酒的李白","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1134266,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4e/ba/580ec429.jpg","nickname":"小兔子乖乖","note":"","ucode":"E5CC0258CF8858","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":402056,"discussion_content":"说反了，应该是如果数据页的lsn小于checkpoint的lsn，也肯定是干净页","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633788587,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":380979,"ip_address":""},"score":402056,"extra":""}]},{"author":{"id":2108347,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJNpx0kOlv2XJf9lytPvvEyu6dTQKQ750X5BonHpo4DiaEicz8q3mD6XBIwpEzoSu7JOghpric9e0trg/132","nickname":"Geek_5c55e9","note":"","ucode":"B3746DEB50C56C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557158,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647679587,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1147895,"avatar":"https://static001.geekbang.org/account/avatar/00/11/83/f7/a24b7242.jpg","nickname":"简单","note":"","ucode":"19A01CB4B9ED8C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":370202,"discussion_content":"这个点不错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619327068,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2185166,"avatar":"https://static001.geekbang.org/account/avatar/00/21/57/ce/ad3c3954.jpg","nickname":"鹅鹅鹅","note":"","ucode":"6AFA3FCC7B5AEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":352009,"discussion_content":"插眼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614566749,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1303322,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e3/1a/061e77b6.jpg","nickname":"亢星东","note":"","ucode":"5E4063E83B2BB9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":317302,"discussion_content":"问题提的很好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603531198,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1254801,"avatar":"https://static001.geekbang.org/account/avatar/00/13/25/91/46600294.jpg","nickname":"猴哥一一 cium","note":"","ucode":"38EC64F8D1A0B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312602,"discussion_content":"看不懂插眼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602746022,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1117597,"avatar":"https://static001.geekbang.org/account/avatar/00/11/0d/9d/58d09086.jpg","nickname":"达达队长","note":"","ucode":"1C3F2E4F6B7637","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":250768,"discussion_content":"插眼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588039061,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54378,"user_name":"运斤成风","can_delete":false,"product_type":"c1","uid":1350812,"ip_address":"","ucode":"BAFF69C29FDFA5","user_header":"https://static001.geekbang.org/account/avatar/00/14/9c/9c/e02a0daf.jpg","comment_is_top":false,"comment_ctime":1545837202,"is_pvip":false,"replies":[{"id":"19738","content":"对，<br>flush 一般是说刷脏页，<br>purge一般是指清undo log, <br>merge一般是指应用change buffer","user_name":"作者回复","comment_id":54378,"uid":"1264162","ip_address":"","utype":1,"ctime":1545841854,"user_name_real":"林晓斌"}],"discussion_count":1,"race_medal":0,"score":"224884136594","product_id":100020801,"comment_content":"老师好，flush和purge是不是还是有区别的？flush主要指刷新脏页，和clean进程相关？而purge是清理不再被使用的undo信息。","like_count":53,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434439,"discussion_content":"对，\nflush 一般是说刷脏页，\npurge一般是指清undo log, \nmerge一般是指应用change buffer","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545841854,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48457,"user_name":"张永志","can_delete":false,"product_type":"c1","uid":1208727,"ip_address":"","ucode":"E54B75EF3F63B3","user_header":"https://static001.geekbang.org/account/avatar/00/12/71/97/f1a3d398.jpg","comment_is_top":false,"comment_ctime":1544447798,"is_pvip":false,"replies":[{"id":"17310","content":"准确","user_name":"作者回复","comment_id":48457,"uid":"1264162","ip_address":"","utype":1,"ctime":1544450854,"user_name_real":"林晓斌"}],"discussion_count":3,"race_medal":0,"score":"207702878006","product_id":100020801,"comment_content":"100M的redo很容易写满，系统锁死，触发检查点推进，导致写操作卡住。由于主机IO能力很强，检查点会很快完成，卡住的写操作又很快可以执行。循环往复，现象就是写操作每隔一小段时间执行就会变慢几秒。","like_count":49,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432188,"discussion_content":"准确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544450854,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2564241,"avatar":"https://static001.geekbang.org/account/avatar/00/27/20/91/61162bdc.jpg","nickname":"Violet","note":"","ucode":"0A5358A06362DA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583437,"discussion_content":"高性能的机器，如果 innodb_io_capacity 配置得当，后台会一直flush脏页，是否不会发生redoLog写满的情况啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660119140,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"上海"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1115562,"avatar":"https://static001.geekbang.org/account/avatar/00/11/05/aa/3c7c00a4.jpg","nickname":"GK java","note":"","ucode":"AA54E8CAAB974C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391532,"discussion_content":"评论里遇到了志哥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630499645,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48691,"user_name":"skyoo","can_delete":false,"product_type":"c1","uid":1302503,"ip_address":"","ucode":"EBC0528BA02DD7","user_header":"https://static001.geekbang.org/account/avatar/00/13/df/e7/4ce5ed27.jpg","comment_is_top":false,"comment_ctime":1544516596,"is_pvip":false,"replies":[{"id":"17477","content":"👍🏿 常见的误用场景","user_name":"作者回复","comment_id":48691,"uid":"1264162","ip_address":"","utype":1,"ctime":1544523564,"user_name_real":"林晓斌"}],"discussion_count":1,"race_medal":0,"score":"186228110324","product_id":100020801,"comment_content":"很多测试人员再做压力测试的时候 出现刚开始 insert update 很快 一会 就出现很慢,并且延迟很大，大部分是因为redo log 设置太小 引起的,完美诠释","like_count":43,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432311,"discussion_content":"👍🏿 常见的误用场景","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544523564,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50218,"user_name":"WL","can_delete":false,"product_type":"c1","uid":1173771,"ip_address":"","ucode":"6277DCD776B87E","user_header":"https://static001.geekbang.org/account/avatar/00/11/e9/0b/1171ac71.jpg","comment_is_top":false,"comment_ctime":1544927071,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"177638586207","product_id":100020801,"comment_content":"把该讲内容总结为几个问题, 大家复习的时候可以先尝试回答这些问题检查自己的掌握程度:<br><br>\t1.<br> 脏页和干净页的定义是什么?<br>\t2. <br>引发数据库flush脏页的四种典型场景各是什么?对mysql性能的影响各是怎样的?<br>\t3. <br>缓存池中的内存页有哪三种状态? 哪两种刷脏页的情况会比较影响性能?<br>\t4. <br>innodb_io_capacity这个参数的作用是什么,这个参数设置错误可能导致什么样的后果, 如何正确的设置这个参数?<br>\t5. <br>mysql如何通过innodb_io_capacity, 脏页比例(M), 当前日志序号(N)这三个指标来控制以什么样的速度去刷脏页的?<br>\t6. <br>innodb_flush_neighbor这个参数表示什么意思,应该如何设置?<br><br>","like_count":41,"discussions":[{"author":{"id":2668694,"avatar":"https://static001.geekbang.org/account/avatar/00/28/b8/96/716ba431.jpg","nickname":"苏成","note":"","ucode":"80A8E7B243DD73","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":574077,"discussion_content":"太爱老哥了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653821286,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1920896,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/4f/80/19f946ba.jpg","nickname":"Zain","note":"","ucode":"03EDF7B1BE9CF8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":359143,"discussion_content":"请允许我再叫你一声 课代表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616121817,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":64245,"user_name":"Geek_477c02","can_delete":false,"product_type":"c1","uid":1218578,"ip_address":"","ucode":"CB9A714A50B977","user_header":"https://static001.geekbang.org/account/avatar/00/12/98/12/a169bdcd.jpg","comment_is_top":false,"comment_ctime":1548725799,"is_pvip":false,"replies":[{"id":"22768","content":"理解准确👍","user_name":"作者回复","comment_id":64245,"uid":"1264162","ip_address":"","utype":1,"ctime":1548735492,"user_name_real":"林晓斌"}],"discussion_count":1,"race_medal":0,"score":"117512842791","product_id":100020801,"comment_content":"InnoDB 认为这个系统的能力就这么差，所以刷脏页刷得特别慢，甚至比脏页生成的速度还慢，这样就造成了脏页累积，影响了查询和更新性能。为什么会影响性能，是因为要读取的数据不在内存中，但是脏页过多导致新页必须等待脏页刷盘导致的么？","like_count":28,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437921,"discussion_content":"理解准确👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548735492,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48576,"user_name":"Tony Du","can_delete":false,"product_type":"c1","uid":1001661,"ip_address":"","ucode":"F5FCC400E615EA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/48/bd/6c7d4230.jpg","comment_is_top":false,"comment_ctime":1544490701,"is_pvip":false,"replies":[{"id":"17414","content":"LSN，每次写redo log都带的一个数字， 数据页上也有，对比大小的，因为太细节没有写到文章中。","user_name":"作者回复","comment_id":48576,"uid":"1264162","ip_address":"","utype":1,"ctime":1544501160,"user_name_real":"林晓斌"}],"discussion_count":11,"race_medal":0,"score":"108918673101","product_id":100020801,"comment_content":"当内存不够用了，要将脏页写到磁盘，会有一个数据页淘汰机制（最久不使用），假设淘汰的是脏页，则此时脏页所对应的redo log的位置是随机的，当有多个不同的脏页需要刷，则对应的redo log可能在不同的位置，这样就需要把redo log的多个不同位置刷掉，这样对于redo log的处理不是就会很麻烦吗？（合并间隙，移动位置？）<br>另外，redo log的优势在于将磁盘随机写转换成了顺序写，如果需要将redo log的不同部分刷掉（刷脏页），不是就在redo log里随机读写了么？<br><br>作者回复<br>好问题。 <br><br>其实由于淘汰的时候，刷脏页过程不用动redo log文件的。<br><br>这个有个额外的保证，是redo log在“重放”的时候，如果一个数据页已经是刷过的，会识别出来并跳过。<br><br>我的回复<br>这个额外保证是如何做到的？能不能稍微解释下<br>通过刷脏页时数据页更新的timestamp来对比redo log的timestamp？","like_count":25,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432254,"discussion_content":"LSN，每次写redo log都带的一个数字， 数据页上也有，对比大小的，因为太细节没有写到文章中。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544501160,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1155646,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKotsBr2icbYNYlRSlicGUD1H7lulSTQUAiclsEz9gnG5kCW9qeDwdYtlRMXic3V6sj9UrfKLPJnQojag/132","nickname":"ppd0705","note":"","ucode":"EB63D4E3FD1E9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":236525,"discussion_content":"LSN 即 log sequence number 可以使用 `show engine innodb status`查看","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1587100222,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1665194,"avatar":"https://static001.geekbang.org/account/avatar/00/19/68/aa/4b58cfd3.jpg","nickname":"神韵","note":"","ucode":"0337AC63C9FBD1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":313001,"discussion_content":"对比内存数据页的lsn和磁盘数据页的lsn，如果已经刷脏两个lsn必然相等，就不用在刷了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1602906410,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1254801,"avatar":"https://static001.geekbang.org/account/avatar/00/13/25/91/46600294.jpg","nickname":"猴哥一一 cium","note":"","ucode":"38EC64F8D1A0B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312604,"discussion_content":"插眼,LSN","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1602746142,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1970443,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIx1V1QAxC4NHaxYZGyuibBN8lcURJWc5nrnO4yic1kxnDemYV2FJGialf47kYX9qtDnZZOfe1SJeLicg/132","nickname":"lleft","note":"","ucode":"D573EB509455AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":370711,"discussion_content":"感觉问的问题的描述都不对，刷脏页为什么要用redo呢，直接把脏页落盘不就行了呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619514369,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1254801,"avatar":"https://static001.geekbang.org/account/avatar/00/13/25/91/46600294.jpg","nickname":"猴哥一一 cium","note":"","ucode":"38EC64F8D1A0B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":361190,"discussion_content":"假装理解：重放的时候，比对redolog的lsn和数据页的LSN（需要扫一下相应页），发现一样，那这条redolog无用了，跳过吧。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616601174,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1970443,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIx1V1QAxC4NHaxYZGyuibBN8lcURJWc5nrnO4yic1kxnDemYV2FJGialf47kYX9qtDnZZOfe1SJeLicg/132","nickname":"lleft","note":"","ucode":"D573EB509455AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1254801,"avatar":"https://static001.geekbang.org/account/avatar/00/13/25/91/46600294.jpg","nickname":"猴哥一一 cium","note":"","ucode":"38EC64F8D1A0B4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":370709,"discussion_content":"这个不是相等，而是当前执行到的LSN比已经刷新的数据页的LSN大就跳过","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1619513970,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":361190,"ip_address":""},"score":370709,"extra":""}]},{"author":{"id":1310722,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erbINv385TKaRSbMzpdN7gIwrT9Pr4vspxEbDlXyjD8vEP1ZRy16qHzpEP50IQKCadfSf6cib8Of8Q/132","nickname":"乡巴佬","note":"","ucode":"80EEADBEA8C917","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348912,"discussion_content":"像是循环队列","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612774324,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1665194,"avatar":"https://static001.geekbang.org/account/avatar/00/19/68/aa/4b58cfd3.jpg","nickname":"神韵","note":"","ucode":"0337AC63C9FBD1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":313006,"discussion_content":"我觉得上面自己的想法不太现实正确，因为找磁盘数据页是随机找过程，效率低，那样就回到了随机写过程了。还有种想法是将刷过脏的页放入干净页队列，当刷到那个页时如果是已经在干净页，就跳过就行了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602907203,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1665194,"avatar":"https://static001.geekbang.org/account/avatar/00/19/68/aa/4b58cfd3.jpg","nickname":"神韵","note":"","ucode":"0337AC63C9FBD1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587370,"discussion_content":"这里的随机写只在宕机重启的时候才会触发的，所以可以不用考虑效率；正常跑的时候redo是不需要重做的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662997771,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":313006,"ip_address":"广东"},"score":587370,"extra":""}]},{"author":{"id":1665194,"avatar":"https://static001.geekbang.org/account/avatar/00/19/68/aa/4b58cfd3.jpg","nickname":"神韵","note":"","ucode":"0337AC63C9FBD1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":313002,"discussion_content":"或者对比磁盘的lsn和redo的lsn","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602906562,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48864,"user_name":"老鱼头","can_delete":false,"product_type":"c1","uid":1303895,"ip_address":"","ucode":"602049758410F1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eq46o2L7ibj1L7Uh44pLTgJrsnRezptClG1HD1PdGImspBLvFcsp0l1Wp8WDVt6sN7NUKC8aqKXnJA/132","comment_is_top":false,"comment_ctime":1544574297,"is_pvip":false,"replies":[{"id":"17568","content":"嗯嗯，你说的对<br><br>写文章的时候，我还故意用变量，这样直接拷贝会出错，然后自己再写个路径，已经考虑了安全了😓","user_name":"作者回复","comment_id":48864,"uid":"1264162","ip_address":"","utype":1,"ctime":1544582712,"user_name_real":"林晓斌"}],"discussion_count":3,"race_medal":0,"score":"91738887513","product_id":100020801,"comment_content":"那个说fio命令会破坏硬盘的兄弟，是没用对命令。估计把-filename=&#47;dev&#47;sdb1 。。。这个的意思是从 分区 sdb1 的第一个扇区开始写入随机数据，去判断这个磁盘的写入速度。如果指定路径+文件名就不会出这事了~比如老师给的例子~","like_count":21,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432392,"discussion_content":"嗯嗯，你说的对\n\n写文章的时候，我还故意用变量，这样直接拷贝会出错，然后自己再写个路径，已经考虑了安全了😓","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544582712,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1310518,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ff/36/83281758.jpg","nickname":"L","note":"","ucode":"C18B98D3DC3387","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":21165,"discussion_content":"好奇的人已经这样用了,然后重装去咯","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1569427370,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2032840,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/04/c8/3c7af100.jpg","nickname":"Javatar","note":"","ucode":"E216645CDF632C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291326,"discussion_content":"太可怕了，还好我用的是bash_history, 然后bash_history废了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1594781065,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51964,"user_name":"喔～","can_delete":false,"product_type":"c1","uid":1172171,"ip_address":"","ucode":"FE2C87CE6FEBD8","user_header":"https://static001.geekbang.org/account/avatar/00/11/e2/cb/6bc95e09.jpg","comment_is_top":false,"comment_ctime":1545283777,"is_pvip":false,"replies":[{"id":"18823","content":"每个页面有编号的。拿着编号去内存看，没有，就去磁盘","user_name":"作者回复","comment_id":51964,"uid":"1264162","ip_address":"","utype":1,"ctime":1545293311,"user_name_real":"林晓斌"}],"discussion_count":3,"race_medal":0,"score":"78854695105","product_id":100020801,"comment_content":"老师，请问下访问某条记录时，存储引擎是如何判断这条记录所在的数据页是否在内存当中，这个查内存机制是如何实现的？","like_count":18,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433683,"discussion_content":"每个页面有编号的。拿着编号去内存看，没有，就去磁盘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545293311,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587372,"discussion_content":"表空间号+数据页号 = 缓冲页地址；一个哈希表结构","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662997874,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1324501,"avatar":"https://static001.geekbang.org/account/avatar/00/14/35/d5/17833946.jpg","nickname":"八宝","note":"","ucode":"89D991A930FDEA","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":395800,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632357192,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":67667,"user_name":"二桃杀三士","can_delete":false,"product_type":"c1","uid":1303914,"ip_address":"","ucode":"5D7CAB540B0DF3","user_header":"https://static001.geekbang.org/account/avatar/00/13/e5/6a/3c618346.jpg","comment_is_top":false,"comment_ctime":1550220532,"is_pvip":false,"replies":[{"id":"24005","content":"你的理解已经很深入了哈<br>1. 是的， “dirty page too much checkpoint”其实触发的是“checkpoint要推进快点”， 根据LRU淘汰脏页的时候，没有影响checkpoint<br>2. 是的，这个文章中1.7说的就是触发“checkpoint要推进快点”的机制。","user_name":"作者回复","comment_id":67667,"uid":"1264162","ip_address":"","utype":1,"ctime":1550299077,"user_name_real":"林晓斌"}],"discussion_count":3,"race_medal":0,"score":"65974729972","product_id":100020801,"comment_content":"老师您好，请教一个问题：<br><br>当内存不够用了，要将脏页写到磁盘，会有一个数据页淘汰机制（最久不使用），假设淘汰的是脏页，则此时脏页所对应的redo log的位置是随机的，<br>当有多个不同的脏页需要刷，则对应的redo log可能在不同的位置，这样就需要把redo log的多个不同位置刷掉，<br>这样对于redo log的处理不是就会很麻烦吗？（合并间隙，移动位置？）<br>另外，redo log的优势在于将磁盘随机写转换成了顺序写，如果需要将redo log的不同部分刷掉（刷脏页），不是就在redo log里随机读写了么？<br>作者回复: 好问题。 <br><br>其实由于淘汰的时候，刷脏页过程不用动redo log文件的。<br><br>这个有个额外的保证，是redo log在“重放”的时候，如果一个数据页已经是刷过的，会识别出来并跳过。<br><br>在这个问题中关于您说的淘汰脏页过程中是不用动redo log的。<br>老师可以先看一下链接https:&#47;&#47;www.cnblogs.com&#47;f-ck-need-u&#47;archive&#47;2018&#47;05&#47;08&#47;9010872.html#commentform中的1.7章节<br>我的理解是：<br>可能是这个意思。此时脏页占缓冲池75%时，进行fuzzy checkpoint（一次只刷一小部分的日志到磁盘，而非将所有脏日志刷盘）方式中的dirty page too much checkpoint，逐渐推进的时候，若此时业务压力增大，脏页占缓冲池比例增加，此时内存不足，需要淘汰脏页，在淘汰的过程中，因为部分脏页不是顺序的，那此时淘汰的过程中刷脏页是不用动redo log的，在redo log“重放”的时候，如果一个数据页已经是刷过的，会识别出来并跳过。重点是淘汰脏页。相当于兜底方案，脏页占75%的时候，强制触发检查点；当脏页比例继续增大时，内存撑不住了，启用兜底方案，开始淘汰脏页，而这个过程，就如上所说。<br>所以我有两个问题：<br>1.就是系统正常刷脏页（比如这种方式dirty page too much checkpoint）会推进checkpoint，而因淘汰脏页的刷脏页并不会推进checkpoint？<br>2.关于链接中1.7章节的数据页刷盘规则其实也是触发checkpoint推进的方式？","like_count":15,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439316,"discussion_content":"你的理解已经很深入了哈\n1. 是的， “dirty page too much checkpoint”其实触发的是“checkpoint要推进快点”， 根据LRU淘汰脏页的时候，没有影响checkpoint\n2. 是的，这个文章中1.7说的就是触发“checkpoint要推进快点”的机制。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550299077,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3004698,"avatar":"https://static001.geekbang.org/account/avatar/00/2d/d9/1a/f5bb1a23.jpg","nickname":"LL","note":"","ucode":"1E498475B2D9EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575457,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654847769,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1254801,"avatar":"https://static001.geekbang.org/account/avatar/00/13/25/91/46600294.jpg","nickname":"猴哥一一 cium","note":"","ucode":"38EC64F8D1A0B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":361172,"discussion_content":"沃日，学习一下，据LRU淘汰脏页的时候，并不影响checkpoint哈。\n\ncheckpoint可以看作是以redolog视角下的redo刷盘位置。\n只是checkpoint向前推进的时候，可能会触发刷脏到磁盘。当然也可能不刷","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616600466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48295,"user_name":"峰","can_delete":false,"product_type":"c1","uid":1056019,"ip_address":"","ucode":"C53CB64E8E7D19","user_header":"https://static001.geekbang.org/account/avatar/00/10/1d/13/31ea1b0b.jpg","comment_is_top":false,"comment_ctime":1544413399,"is_pvip":true,"replies":[{"id":"17247","content":"👍🏿引申不错","user_name":"作者回复","comment_id":48295,"uid":"1264162","ip_address":"","utype":1,"ctime":1544418474,"user_name_real":"林晓斌"}],"discussion_count":1,"race_medal":0,"score":"61673955543","product_id":100020801,"comment_content":"redo日志设置太小，内存又比较大，导致innodb缓存的脏页还没多少就开始大量flush，刷写频率增大。感觉有点像jvm中，年轻代内存设置小点，导致频繁younggc。当然这就是个权衡，毕竟redo和内存不能无限大。","like_count":14,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432110,"discussion_content":"👍🏿引申不错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544418474,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48233,"user_name":"董航","can_delete":false,"product_type":"c1","uid":1231787,"ip_address":"","ucode":"9CA208FD26F849","user_header":"https://static001.geekbang.org/account/avatar/00/12/cb/ab/1aac53bf.jpg","comment_is_top":false,"comment_ctime":1544404856,"is_pvip":false,"replies":[{"id":"17163","content":"👍🏿<br><br>你领会到实践篇的“奥义”了😄<br><br>一边引入新知识点，一边应用前面的","user_name":"作者回复","comment_id":48233,"uid":"1264162","ip_address":"","utype":1,"ctime":1544405149,"user_name_real":"林晓斌"}],"discussion_count":3,"race_medal":0,"score":"57378979704","product_id":100020801,"comment_content":"怎么说呢，越看越明白，哈哈，前面不懂的，后面就懂了","like_count":13,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432081,"discussion_content":"👍🏿\n\n你领会到实践篇的“奥义”了😄\n\n一边引入新知识点，一边应用前面的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544405149,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1254801,"avatar":"https://static001.geekbang.org/account/avatar/00/13/25/91/46600294.jpg","nickname":"猴哥一一 cium","note":"","ucode":"38EC64F8D1A0B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312605,"discussion_content":"怎么说呢，越看越糊涂,哈哈","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1602746622,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1071680,"avatar":"https://static001.geekbang.org/account/avatar/00/10/5a/40/59de94de.jpg","nickname":"贾森安德森","note":"","ucode":"7FF58646E0AD86","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":211012,"discussion_content":"看了，你的留言，让我更有信心了。加油啊。，💪坚持","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584799464,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48419,"user_name":"didiren","can_delete":false,"product_type":"c1","uid":1305376,"ip_address":"","ucode":"8341F02F2ABA60","user_header":"https://static001.geekbang.org/account/avatar/00/13/eb/20/a02c4f61.jpg","comment_is_top":false,"comment_ctime":1544440365,"is_pvip":false,"replies":[{"id":"17312","content":"一般参考写能力","user_name":"作者回复","comment_id":48419,"uid":"1264162","ip_address":"","utype":1,"ctime":1544450920,"user_name_real":"林晓斌"}],"discussion_count":1,"race_medal":0,"score":"53084047917","product_id":100020801,"comment_content":"用fio压测的结果，读写的iops是一样的，那么io_capacity按照这个值设，还是设为读写相加","like_count":12,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432172,"discussion_content":"一般参考写能力","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544450920,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48374,"user_name":"包包up","can_delete":false,"product_type":"c1","uid":1073495,"ip_address":"","ucode":"A6F51A62A8B362","user_header":"https://static001.geekbang.org/account/avatar/00/10/61/57/6f3c81dd.jpg","comment_is_top":false,"comment_ctime":1544430497,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"44494103457","product_id":100020801,"comment_content":"redo-log内存满了，不停的要刷脏页回磁盘。现象就会是发现机器io不高，但是mysql明显的卡顿。","like_count":10},{"had_liked":false,"id":57362,"user_name":"看不到de颜色","can_delete":false,"product_type":"c1","uid":1162714,"ip_address":"","ucode":"88348CCAE81931","user_header":"https://static001.geekbang.org/account/avatar/00/11/bd/da/3d76ea74.jpg","comment_is_top":false,"comment_ctime":1546764061,"is_pvip":false,"replies":[{"id":"20672","content":"1. Redo log不用动，checkpoint 推进的时候再“丢弃”就可以了。丢弃的意思是，判断到数据页已经刷过，就不用再重放<br>2. 对，都是同步。 这个问题你再跳过去看一下第23篇😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1546772724,"ip_address":"","comment_id":57362,"utype":1}],"discussion_count":2,"race_medal":0,"score":"40201469725","product_id":100020801,"comment_content":"看完这一章明白了原来数据落盘不仅仅只是定时刷redo log及快写满是才会进行。当内存不足要淘汰掉的数据页为脏页时会直接将内存中脏页的数据刷入磁盘。不过此时产生了几个疑问。<br>1、如果直接将内存中的数据页刷入磁盘，那redo log中的数据怎么办，会去删除吗？如果是那redo log岂不就不连续了。如果不是的话当刷redo log时又该怎么判断此时硬盘中的数据已经是最新的数据了呢。<br>2、在执行DML操作时应该是总共有两处写磁盘是吗？先是innodb层的redo log落盘，紧接着MySQL server层的bin log落盘。这两处写磁盘都是同步写操作吗？<br>还望老师可以在百忙之中不吝赐教，感激不尽*^o^*","like_count":9,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435544,"discussion_content":"1. Redo log不用动，checkpoint 推进的时候再“丢弃”就可以了。丢弃的意思是，判断到数据页已经刷过，就不用再重放\n2. 对，都是同步。 这个问题你再跳过去看一下第23篇😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546772724,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1254801,"avatar":"https://static001.geekbang.org/account/avatar/00/13/25/91/46600294.jpg","nickname":"猴哥一一 cium","note":"","ucode":"38EC64F8D1A0B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":360741,"discussion_content":"mark:丢弃的意思是，判断到数据页已经刷过，就不用再重放了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616510739,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48477,"user_name":"克己过","can_delete":false,"product_type":"c1","uid":1303328,"ip_address":"","ucode":"C4C7193768E8C3","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKWBSfZTcUiaJ0Rxibe9VSDSBDEhM8lNjrTiahUrDibboxW1M8JQc7M9QevUZdVXI8N10BWpEsKc2bPKQ/132","comment_is_top":false,"comment_ctime":1544450580,"is_pvip":false,"replies":[{"id":"17541","content":"没有吧，怎么会破坏硬盘？我和以前同事一直这么用的呀…<br><br>你确定是这个命令导致的吗😓","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544556392,"ip_address":"","comment_id":48477,"utype":1}],"discussion_count":2,"race_medal":0,"score":"35904188948","product_id":100020801,"comment_content":"老师！！！fio这条命令是会破坏硬盘的！而且百度搜出来不加硬盘坏关键词去搜，搜出来的文章没有一篇会告诉你这个事情！！！不说了，我去恢复数据了😭","like_count":8,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432198,"discussion_content":"没有吧，怎么会破坏硬盘？我和以前同事一直这么用的呀…\n\n你确定是这个命令导致的吗😓","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544556392,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1261878,"avatar":"https://static001.geekbang.org/account/avatar/00/13/41/36/ca101de4.jpg","nickname":"eTen.T","note":"","ucode":"ECC6CD4B51EA96","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":215624,"discussion_content":"貌似我也碰到过，只能在没数据盘测试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585362640,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":191812,"user_name":"贾森安德森","can_delete":false,"product_type":"c1","uid":1071680,"ip_address":"","ucode":"7FF58646E0AD86","user_header":"https://static001.geekbang.org/account/avatar/00/10/5a/40/59de94de.jpg","comment_is_top":false,"comment_ctime":1584798356,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"31649569428","product_id":100020801,"comment_content":"<br>InnoDB在处理更新语句的时候，只做了写日志这一磁盘操作。这个日志叫做redo log(重做日志)<br><br>把内存里的数据写入磁盘的过程，术语就是flush。<br>当内存数据页跟磁盘数据页内容不一致的时候，我们称这个内存页为“脏页”。<br>内存数据页写入到磁盘后，内存和磁盘上的数据页的内容就一致了，称为“干净页”。<br><br>更新操作其实就是写内存和日志。而MySQL偶尔“抖”一下的那个瞬间，可能就是在刷脏页（flush）。<br><br>什么情况会引发数据库的flush过程呢？<br>1）、InnoDB 的redo log  写满的时候。<br>    影响性能，<br>2）、系统内存不足（需要新的内存页，而内存不够用的时候）<br>    这种情况是常态InnoDB用缓冲池(buffer pool)管理内存，缓冲池中的内存页有三种状态：<br>    第一种：还没有使用的；<br>    第二种：使用了并且干净页<br>    第三种：使用了并且是脏页<br><br>3）、MySQL人为系统“空闲”的时候。<br>    不影响性能<br>4）、MySQL正常关闭的时候。<br>    不影响性能<br><br>InnoDB的策略是尽量使用内存，长时间运行的库来说，未被使用的页面很少。<br>淘汰一个干净页，直接释放出来复用，如果是脏页，就必须将脏页先刷到磁盘，变成干净页后才能复用。<br><br>刷脏页影响性能的情况：<br>1）、一个查询要淘汰的脏页个数太多，会导致查询的响应时间明显变成<br>2）、日志写满，更新全部堵住，写性能跌为0，这种情况对敏感业务来说，是不能接受的。<br><br>避免上面的两种情况，InnoDB刷脏页的控制策略：<br><br>1）、设置innodb_io_capacity参数，设置成磁盘的IOPS。<br>    测试磁盘随机读写命令：<br> fio -filename=$filename -direct=1 -iodepth 1 -thread -rw=randrw -ioengine=psync -bs=16k -size=500M -numjobs=10 -runtime=10 -group_reporting -name=mytest<br><br>设置刷脏页的速度，考虑的因素：<br>1）、脏页比例<br>2）、redo log写盘的速度<br><br>参数 innodb_max_dirty_pages_pct 是脏页比例上限，默认值是 75%。<br>F1(M)<br>{<br>  if M&gt;=innodb_max_dirty_pages_pct then<br>      return 100;<br>  return 100*M&#47;innodb_max_dirty_pages_pct;<br>}<br><br>控制刷脏页的策略：<br>innodb_flush_neighbors=1 连坐机制<br>innodb_flush_neighbors=0 不找邻居，自己刷自己<br><br>而如果使用的是 SSD 这类 IOPS 比较高的设备的话，我就建议你把 innodb_flush_neighbors 的值设置成 0。因为这时候 IOPS 往往不是瓶颈，而“只刷自己”，就能更快地执行完必要的刷脏页操作，减少 SQL 语句响应时间。<br>在 MySQL 8.0 中，innodb_flush_neighbors 参数的默认值已经是 0 了。<br>","like_count":7},{"had_liked":false,"id":48646,"user_name":"算不出流源","can_delete":false,"product_type":"c1","uid":1178209,"ip_address":"","ucode":"B6CFEF672E3E1C","user_header":"https://static001.geekbang.org/account/avatar/00/11/fa/61/691e2936.jpg","comment_is_top":false,"comment_ctime":1544505747,"is_pvip":false,"replies":[{"id":"17481","content":"这个“动态平衡”确实是用“间歇性地卡住业务请求”作为代价的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544523798,"ip_address":"","comment_id":48646,"utype":1}],"discussion_count":1,"race_medal":0,"score":"31609276819","product_id":100020801,"comment_content":"思考题:redo log较小，此时F2(N)就容易较大，后台刷脏页的速度就会较快，但是机器iops很高，所以即使在mysql负载较高的情况下，也不会造成redo log写满，因为innodb会照着最大iops的目标去请求io，而读写数据库的业务请求也机器朝最大iops能力去挤，最终两类io需求相互竞争达到一个动态平衡，redo log不会被灌满，但业务请求也没有空闲的时候执行速度快。<br>    所以我认为应该不是造成抖动，而是业务负载较大的情况下，完成业务请求的平均时间会较系统空闲时加倍。不知道理解有没有问题，请老师指正","like_count":7,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432291,"discussion_content":"这个“动态平衡”确实是用“间歇性地卡住业务请求”作为代价的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544523798,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89170,"user_name":"greatcl","can_delete":false,"product_type":"c1","uid":1009449,"ip_address":"","ucode":"44D3C55394EC08","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/29/b0ec5430.jpg","comment_is_top":false,"comment_ctime":1556097266,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27325901042","product_id":100020801,"comment_content":"二刷中。<br>我觉得Ryoma 的疑问可能是因为《图 1 “孔乙己赊账”更新和 flush 过程》中，日志&#47;粉板的内容写成了“10改成19”，其实应该是“+9”。而“内存&#47;掌柜记忆”的内容是否是19要根据原有内容是否在内存中来区别。如果掌柜记忆够好或者孔乙己赊账前是否先问了下：我现在欠多少钱？老板查了下回答：10文，那么此时内存的值是会被直接改为19，否则内存中只是change buffer的记录+9。<br>不知这样理解是否正确","like_count":6},{"had_liked":false,"id":57307,"user_name":"我是小队长","can_delete":false,"product_type":"c1","uid":1334198,"ip_address":"","ucode":"E0687666EE2031","user_header":"https://static001.geekbang.org/account/avatar/00/14/5b/b6/f404b490.jpg","comment_is_top":false,"comment_ctime":1546740181,"is_pvip":false,"replies":[{"id":"20666","content":"先use information_schema再执行","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1546746329,"ip_address":"","comment_id":57307,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27316543957","product_id":100020801,"comment_content":"mysql&gt; select VARIABLE_VALUE into @a from global_status where VARIABLE_NAME = &#39;Innodb_buffer_pool_pages_dirty&#39;;<br>1146 - Table &#39;mysql.global_status&#39; doesn&#39;t exist<br><br>为啥会出现表不存在呢？","like_count":6,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435518,"discussion_content":"先use information_schema再执行","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546746329,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48297,"user_name":"极客童","can_delete":false,"product_type":"c1","uid":1250397,"ip_address":"","ucode":"D92EA8CA293B93","user_header":"https://static001.geekbang.org/account/avatar/00/13/14/5d/f4d789cc.jpg","comment_is_top":false,"comment_ctime":1544413560,"is_pvip":false,"replies":[{"id":"17246","content":"1. 这个要说明下，change buffer只对非唯一索引有效","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544418445,"ip_address":"","comment_id":48297,"utype":1}],"discussion_count":2,"race_medal":0,"score":"23019250040","product_id":100020801,"comment_content":"梳理一下之前的知识，存储引擎接到一个更新操作时，操作过程是：<br>1、引擎将这行新数据更新到change buffer中，同时将这个更新操作记录到redo log 里面；<br>2、此时 redo log 处于 prepare 状态，再生成写入binlog；<br>3、最后把redo log commit。change buffer找时机merge到buffer pool。<br><br>对本题目，如果redo log过小，会频繁触发purge操作，purge操作即buffer pool刷脏页的同时把redolog的checkpoint往前移动，导致频繁的磁盘io，结果就是mysql频繁的抖动。我的理解对吗？<br>","like_count":5,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432112,"discussion_content":"1. 这个要说明下，change buffer只对非唯一索引有效","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544418445,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1324501,"avatar":"https://static001.geekbang.org/account/avatar/00/14/35/d5/17833946.jpg","nickname":"八宝","note":"","ucode":"89D991A930FDEA","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":395810,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632357915,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48167,"user_name":"Ying","can_delete":false,"product_type":"c1","uid":1307466,"ip_address":"","ucode":"FAE36C852765F2","user_header":"https://static001.geekbang.org/account/avatar/00/13/f3/4a/4874b350.jpg","comment_is_top":false,"comment_ctime":1544379055,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23019215535","product_id":100020801,"comment_content":"redolog 设置过小，会导致频繁刷脏页，还可能引发连坐，这样抖的频率可能会明显变高，系统会不断卡死的","like_count":5},{"had_liked":false,"id":48286,"user_name":"夹心面包","can_delete":false,"product_type":"c1","uid":1301957,"ip_address":"","ucode":"002BBA49D83D17","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJCscgdVibmoPyRLRaicvk6rjTJxePZ6VFHvGjUQvtfhCS6kO4OZ1AVibbhNGKlWZmpEFf2yA6ptsqHw/132","comment_is_top":false,"comment_ctime":1544411452,"is_pvip":false,"replies":[{"id":"17250","content":"那说明你们磁盘不太好…","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544418780,"ip_address":"","comment_id":48286,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14429313340","product_id":100020801,"comment_content":"<br>老师请问下 innodb_io_capacity我们默认是200,在高并发插入场景下,cpu使用率很低,但是cpu iowait高,这种情况下 调大  innodb_io_capacity 是否有用呢,我用了您的测试方法,iops随机读写都为1K<br>","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432105,"discussion_content":"那说明你们磁盘不太好…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544418780,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":165463,"user_name":"learn more","can_delete":false,"product_type":"c1","uid":1128702,"ip_address":"","ucode":"0EF628B2E0F95E","user_header":"https://static001.geekbang.org/account/avatar/00/11/38/fe/00ddeb81.jpg","comment_is_top":false,"comment_ctime":1577240787,"is_pvip":false,"replies":[{"id":"63089","content":"监控脏页比例，接近max就不好","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1577244029,"ip_address":"","comment_id":165463,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10167175379","product_id":100020801,"comment_content":"老师你好，请问如何才能判断出，当前的MySQL是否正在刷脏页，或说是因为刷脏页影响到了MySQL性能？<br>如果发现是在刷脏页，又如何判断MySQL是因为内存不足导致的还是redo log 满了导致的呢？<br>看完这篇文章我知道了刷脏页会影响性能，也知道为什么会刷脏页，但是我却没有手段知晓线上是因为刷脏页才影响到MySQL性能。","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479168,"discussion_content":"监控脏页比例，接近max就不好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577244029,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81960,"user_name":"Lucus","can_delete":false,"product_type":"c1","uid":1198800,"ip_address":"","ucode":"CE8EB70CB9D9F1","user_header":"https://static001.geekbang.org/account/avatar/00/12/4a/d0/d319c44a.jpg","comment_is_top":false,"comment_ctime":1554088883,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10144023475","product_id":100020801,"comment_content":"思考题：<br>redo log设置的太小，应该是很容易引发redo log满了要flush，这时候所有的更新都会阻塞。内存的优势没有利用起来，如果是更新频繁的库会导致整个库都不可用。<br>p.s. 林老师能不能详细讲一下innodb_io_capacity这个参数与系统的配置关系，如何根据系统调整最佳值？","like_count":2,"discussions":[{"author":{"id":1970443,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIx1V1QAxC4NHaxYZGyuibBN8lcURJWc5nrnO4yic1kxnDemYV2FJGialf47kYX9qtDnZZOfe1SJeLicg/132","nickname":"lleft","note":"","ucode":"D573EB509455AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":370713,"discussion_content":"设置成磁盘的IOPS的值","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619514943,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":80533,"user_name":"700","can_delete":false,"product_type":"c1","uid":1072896,"ip_address":"","ucode":"E4BD0CBADAF951","user_header":"","comment_is_top":false,"comment_ctime":1553677476,"is_pvip":false,"replies":[{"id":"29648","content":"随机写就是每次更新，都直接将数据写到磁盘","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1554048910,"ip_address":"","comment_id":80533,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10143612068","product_id":100020801,"comment_content":"利用 WAL 技术，数据库将随机写转换成了顺序写，大大提升了数据库的性能。<br>----<br>老师，您好。这句话不懂？<br>随机写是指脏页写磁盘吗？<br>顺序写是指写 redo log 吗？<br><br>如果没有 WAL 技术，数据库是怎样更新数据的？<br>","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444894,"discussion_content":"随机写就是每次更新，都直接将数据写到磁盘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554048910,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57361,"user_name":"看不到de颜色","can_delete":false,"product_type":"c1","uid":1162714,"ip_address":"","ucode":"88348CCAE81931","user_header":"https://static001.geekbang.org/account/avatar/00/11/bd/da/3d76ea74.jpg","comment_is_top":false,"comment_ctime":1546764060,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10136698652","product_id":100020801,"comment_content":"看完这一章明白了原来数据落盘不仅仅只是定时刷redo log及快写满是才会进行。当内存不足要淘汰掉的数据页为脏页时会直接将内存中脏页的数据刷入磁盘。不过此时产生了几个疑问。<br>1、如果直接将内存中的数据页刷入磁盘，那redo log中的数据怎么办，会去删除吗？如果是那redo log岂不就不连续了。如果不是的话当刷redo log时又该怎么判断此时硬盘中的数据已经是最新的数据了呢。<br>2、在执行DML操作时应该是总共有两处写磁盘是吗？先是innodb层的redo log落盘，紧接着MySQL server层的bin log落盘。这两处写磁盘都是同步写操作吗？<br>还望老师可以在百忙之中不吝赐教，感激不尽*^o^*","like_count":2},{"had_liked":false,"id":52118,"user_name":"tc_song","can_delete":false,"product_type":"c1","uid":1042499,"ip_address":"","ucode":"E51763EB380B50","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e8/43/38f6f7a1.jpg","comment_is_top":false,"comment_ctime":1545313307,"is_pvip":false,"replies":[{"id":"18910","content":"比较像删除了近期删除了大量数据，有监控系统吗？看看delete的指标","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545314818,"ip_address":"","comment_id":52118,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10135247899","product_id":100020801,"comment_content":"老师，我这边遇到一个问题，生产系统突然出现pager_cleaner了七百多秒，但是业务系统中应该没有大sql,slow log中也没有长sql记录，这个时候业务系统的查询全部被卡住，十几分钟后才执行完毕。这个是啥方面问题呢？<br>2018-12-20<br> 作者回复<br>是不是之前刚刚做了大量更新？或者近期做了大量更新，然后系统突然闲下来了？<br><br>业务上没什么特别，没有大量更新，运行了一年多第一次出现，而且一天之内出现两三次","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433753,"discussion_content":"比较像删除了近期删除了大量数据，有监控系统吗？看看delete的指标","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545314818,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51284,"user_name":"假装有网名","can_delete":false,"product_type":"c1","uid":1023922,"ip_address":"","ucode":"A47E2975D36CCF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9f/b2/ca764e25.jpg","comment_is_top":false,"comment_ctime":1545146265,"is_pvip":false,"replies":[{"id":"18510","content":"看着像，你看看“直播”这一篇，里面我举例run.sh那个例子","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545150084,"ip_address":"","comment_id":51284,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10135080857","product_id":100020801,"comment_content":"我们现在数据由于近期一直在做老数据割接，频繁事务同步数据，一天一个库要被重新刷N次，结果在不执行数据割接时候mysql瞬间cpu就很高，影响了正常的访问，这会不会是由于系统处理脏页完成的？今天刚看到文章，还没看配置，望老师指点。","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433380,"discussion_content":"看着像，你看看“直播”这一篇，里面我举例run.sh那个例子","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545150084,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48382,"user_name":"石建磊","can_delete":false,"product_type":"c1","uid":1155403,"ip_address":"","ucode":"53A4E311D3DF62","user_header":"https://static001.geekbang.org/account/avatar/00/11/a1/4b/254480d3.jpg","comment_is_top":false,"comment_ctime":1544432671,"is_pvip":false,"replies":[{"id":"17302","content":"我没理解你说的“对应”的意思。<br>内存被淘汰，可能redo log还在的；<br>而即使checkpoint 往前推进了，只是把脏页变成干净页，内存里这个数据页也还在的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544440992,"ip_address":"","comment_id":48382,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10134367263","product_id":100020801,"comment_content":"老师好，对于写入的数据来说，内存中的记录和redo log中的记录是对应的吗？还是说比如redo log的记录已经少了， 但是数据还在内存中？或者说内存中数据少了，redo log中还有记录？","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432154,"discussion_content":"我没理解你说的“对应”的意思。\n内存被淘汰，可能redo log还在的；\n而即使checkpoint 往前推进了，只是把脏页变成干净页，内存里这个数据页也还在的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544440992,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48272,"user_name":"小确幸","can_delete":false,"product_type":"c1","uid":1099329,"ip_address":"","ucode":"C090505CB2DB69","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/41/b868f086.jpg","comment_is_top":false,"comment_ctime":1544408944,"is_pvip":false,"replies":[{"id":"17235","content":"1. 数据页是“数据的存储单位”，每次要读写都是整页读入内存的。<br><br>2. 这里说的内存是innodb buffer pool,  查询缓存是server层的，存的是SQL语句的查询结果","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544412491,"ip_address":"","comment_id":48272,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10134343536","product_id":100020801,"comment_content":"有两个疑问：<br>1、数据库的页，与书本的页在概念上是类似的吗？<br>2、在内存中的页数据，与查询缓存有什么区别？","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432098,"discussion_content":"1. 数据页是“数据的存储单位”，每次要读写都是整页读入内存的。\n\n2. 这里说的内存是innodb buffer pool,  查询缓存是server层的，存的是SQL语句的查询结果","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544412491,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":329601,"user_name":"微光","can_delete":false,"product_type":"c1","uid":1372556,"ip_address":"","ucode":"023D7D3F637F4F","user_header":"https://static001.geekbang.org/account/avatar/00/14/f1/8c/754566c5.jpg","comment_is_top":false,"comment_ctime":1641441337,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5936408633","product_id":100020801,"comment_content":"看完总结一下。<br>抛出问题：为什么SQL 语句为什么变“慢”了？<br>回答问题：可能是刷新脏页导致SQL变“慢”<br>分析答案：列出刷新脏页的4种情况。1、buffer pool内存不足；2、rodo log空间不足，停止更新，刷新脏页，移动checkpoint（要避免这种问题）；3、后台自动刷新脏页；4、服务关闭时刷新脏页。其中第1、2两种对SQL的性能影响较大，需要研究如何优化。<br>调优参数：innodb_io_catacity可以控制刷新脏页的速度，后面粗略的说明了刷新脏页速率的计算方法<br>监控脏页的情况：平时要多关注脏页比例，不要让它经常接近 75%。后面介绍了如何计算这个比率，其实大部分云平台都会有这个监控参数。<br>","like_count":1},{"had_liked":false,"id":250000,"user_name":"晓破天空","can_delete":false,"product_type":"c1","uid":1621178,"ip_address":"","ucode":"AD8A3B6CCE277D","user_header":"https://static001.geekbang.org/account/avatar/00/18/bc/ba/9cc5722f.jpg","comment_is_top":false,"comment_ctime":1600877463,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5895844759","product_id":100020801,"comment_content":"老师，有个问题，比如更新了数据库一个id数据，但是还没有刷新到磁盘，这时查询id（假如是第一次查询），是直接查询内存脏页吗。\r还有一个就是，事务提交后，脏页不一定立即刷到磁盘吧","like_count":1},{"had_liked":false,"id":168672,"user_name":"温故而知新可以为师矣","can_delete":false,"product_type":"c1","uid":1453053,"ip_address":"","ucode":"FADCDFA9F9E5E8","user_header":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","comment_is_top":false,"comment_ctime":1578135532,"is_pvip":false,"replies":[{"id":"65392","content":"👍<br>别的不说，这算认知升级😆","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1578142098,"ip_address":"","comment_id":168672,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5873102828","product_id":100020801,"comment_content":"最近做日报表采用的就是年与日用&quot;int&quot;来存储，只是没想到“这就是简单的hash“，瞬间高大上，哈哈哈。","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480289,"discussion_content":"👍\n别的不说，这算认知升级😆","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578142098,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":111698,"user_name":"咸鱼与果汁","can_delete":false,"product_type":"c1","uid":1283861,"ip_address":"","ucode":"F79383599ACB02","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoRyUPicEMqGsbsMicHPuvwM8nibfgK8Yt0AibAGUmnic7rLF4zUZ4dBj4ialYz54fOD6sURKwuJIWBNjhg/132","comment_is_top":false,"comment_ctime":1562586216,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5857553512","product_id":100020801,"comment_content":"老师你好，我记得之前说硬盘数据页是通过redolog进行刷新的，这会儿怎么又变成脏页刷新，请问这其中的交互关系是怎么样的？","like_count":1,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":154983,"discussion_content":"当redo log满了，就去刷，当内存满了，那就内存去刷。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580206690,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52459,"user_name":"why","can_delete":false,"product_type":"c1","uid":1012937,"ip_address":"","ucode":"C9E796E53F6F5E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/74/c9/d3439ca4.jpg","comment_is_top":false,"comment_ctime":1545385977,"is_pvip":false,"replies":[{"id":"19127","content":"这两个顺序写都是WAL机制的收益<br><br>刷脏页是Innodb 实现的，没有依赖操作系统","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545401595,"ip_address":"","comment_id":52459,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5840353273","product_id":100020801,"comment_content":"老师，WAL 将随机写转换成顺序写，这里顺序写是指 redo log 的顺序写，还是还会把多个脏页调整成顺序写。如果是会把脏页调整成顺序写，这个是操作系统本来就有的功能，还是 MySQL 实现的。（操作系统学得一般:(）","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433885,"discussion_content":"这两个顺序写都是WAL机制的收益\n\n刷脏页是Innodb 实现的，没有依赖操作系统","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545401595,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49501,"user_name":"xmasye","can_delete":false,"product_type":"c1","uid":1067119,"ip_address":"","ucode":"7AB897FE157604","user_header":"https://static001.geekbang.org/account/avatar/00/10/48/6f/cdf34b6b.jpg","comment_is_top":false,"comment_ctime":1544699424,"is_pvip":false,"replies":[{"id":"17802","content":"是的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544709161,"ip_address":"","comment_id":49501,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5839666720","product_id":100020801,"comment_content":"要避免Redolog写满，是否只能靠空闲的时候把write-ops往前移动？<br>因为：<br>“Redolog 的空间是循环使用的，无所谓释放”<br>“由于淘汰的时候，刷脏页过程不用动redo log文件的”","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432638,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544709161,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48893,"user_name":"发条橙子 。","can_delete":false,"product_type":"c1","uid":1259218,"ip_address":"","ucode":"ED076F4534FFED","user_header":"https://static001.geekbang.org/account/avatar/00/13/36/d2/c7357723.jpg","comment_is_top":false,"comment_ctime":1544576425,"is_pvip":false,"replies":[{"id":"17563","content":"1. 好问题。不能扩大，buffer pool size 设定好就只能用这么多，不会再多吃系统内存<br><br>2.  Innodb_flush_log_at_trx_commit 设置为0的时候就是<br><br>","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544582164,"ip_address":"","comment_id":48893,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5839543721","product_id":100020801,"comment_content":"总结<br>innodb_io_capacity 决定刷新缓存的频率 当值小 ，缓存数据不断累积 ，刷新少 ，脏页会越来越多 。当脏页累计会影响更新 和 查询 <br><br>影响更新 ： 因为缓冲池内存不够，下次查询需要将历史脏页刷新 耗费时间<br><br>影响查询 ：查询数据页不在缓冲池，所以走磁盘并更新数据页 ，因为缓冲池内存不够，下次查询需要将历史脏页刷新 耗费时间<br> <br>问题 ：<br>1: 系统内存不够 和 缓冲池内存的关系是 ？ 缓冲池可以无限扩大内存将系统内存沾满么？<br>2: 更新操作只是 更新redo log 更新磁盘 加   更新内存 。 可是redo log 也有缓冲区 ， 是不是会存在都是操作内存，不会操作磁盘的更新的情况<br>","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432406,"discussion_content":"1. 好问题。不能扩大，buffer pool size 设定好就只能用这么多，不会再多吃系统内存\n\n2.  Innodb_flush_log_at_trx_commit 设置为0的时候就是\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544582164,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48707,"user_name":"BD","can_delete":false,"product_type":"c1","uid":1228560,"ip_address":"","ucode":"A95CF8C3EDC228","user_header":"https://static001.geekbang.org/account/avatar/00/12/bf/10/b7974690.jpg","comment_is_top":false,"comment_ctime":1544520042,"is_pvip":false,"replies":[{"id":"17472","content":"第三步会自动提交事务的…<br><br>如果你是autocommit=1的话，其实4也是单独事务提交了😓","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544523323,"ip_address":"","comment_id":48707,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5839487338","product_id":100020801,"comment_content":"老师请问下，在一个事务回滚操作里如果有DDL操作会怎样。例如如下步骤:1.开始事务及设置手动提交  2修改表Aid为2的行 3动态创建一张表B 4修改表C里id为5的行 6提交事务 及回滚代码编写。如果在步骤5时发生异常数据库会怎样做","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432319,"discussion_content":"第三步会自动提交事务的…\n\n如果你是autocommit=1的话，其实4也是单独事务提交了😓","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544523323,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48570,"user_name":"melon","can_delete":false,"product_type":"c1","uid":1023773,"ip_address":"","ucode":"7A80C20EBCAAA4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9f/1d/ec173090.jpg","comment_is_top":false,"comment_ctime":1544490112,"is_pvip":false,"replies":[{"id":"17416","content":"判断一下发现是干净页就跳过。<br>不是重置为0，是把磁盘上数据页的LSN也一起改掉了","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544501277,"ip_address":"","comment_id":48570,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5839457408","product_id":100020801,"comment_content":"老师，您在回复 jimmy 的问题时提到通过对比数据页的 LSN 和 checkpoint 的 LSN，比checkpoint LSN 小的就是干净页，那在重放 redo log 时是如何跳过那些由于内存不足而刷脏的页面的呢？刷脏的时候会将 LSN 重置为0之类的？","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432249,"discussion_content":"判断一下发现是干净页就跳过。\n不是重置为0，是把磁盘上数据页的LSN也一起改掉了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544501277,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48479,"user_name":"Inon","can_delete":false,"product_type":"c1","uid":1014967,"ip_address":"","ucode":"F547915362A5DE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7c/b7/3b3cbc38.jpg","comment_is_top":false,"comment_ctime":1544450991,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5839418287","product_id":100020801,"comment_content":"老师您好，一直有个问题，想请教下：就是远程通过JDBC一次查询可能查询出上万条数据。但我在客户端迭代读出来的时候都是一条一条取的。我想问，数据库端一次查询，会将查询的上万条真实数据结果一次性放在一个缓冲中，等客户端来取。还是构建一个查询数据结构，只是定位查询结果位置的，每次客户端通过游标通过查询结果位置实时读磁盘取数据的？","like_count":1,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":154991,"discussion_content":"你这个应该是将一万条数据放在了内存中吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580207602,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358470,"user_name":"听风","can_delete":false,"product_type":"c1","uid":2786848,"ip_address":"浙江","ucode":"EC2EB012E8DB6D","user_header":"https://static001.geekbang.org/account/avatar/00/2a/86/20/1f1221f5.jpg","comment_is_top":false,"comment_ctime":1664343454,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1664343454","product_id":100020801,"comment_content":"innodb_flush_log_at_trx_commit=1的情况下，每次都要刷盘redolog的顺序写，对于性能的提升还有效果吗","like_count":0},{"had_liked":false,"id":358008,"user_name":"源不息","can_delete":false,"product_type":"c1","uid":2739750,"ip_address":"北京","ucode":"2B9FF0B611BC9E","user_header":"https://static001.geekbang.org/account/avatar/00/29/ce/26/f493253d.jpg","comment_is_top":false,"comment_ctime":1663829449,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1663829449","product_id":100020801,"comment_content":"1.比chechpoint的LSN大的页有可能是被淘汰又被加载，那redolog执行到这里的时候会不会在刷一次盘？<br>2. redolog执行到某个checkpoint的时候，发现该页不在内存中（已经被淘汰），该怎么办？","like_count":0},{"had_liked":false,"id":354927,"user_name":"Geek_05ebfb","can_delete":false,"product_type":"c1","uid":2740627,"ip_address":"浙江","ucode":"9C4780275F5925","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLgJgAHLWf6aEZvKao4DR8ajxz0J0EEzgNQcN9iaHicfM3gYgQZAhB8w3pOibcrLy2F6c4Y13YIFNElw/132","comment_is_top":false,"comment_ctime":1660887393,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1660887393","product_id":100020801,"comment_content":"哎 我太水了 老师能说下 到底哪些东西在内存 ，哪些在磁盘么？有点懵逼","like_count":0},{"had_liked":false,"id":348650,"user_name":"早睡使人快乐","can_delete":false,"product_type":"c1","uid":2097952,"ip_address":"","ucode":"060FA610B12E39","user_header":"https://static001.geekbang.org/account/avatar/00/20/03/20/a7fa8c64.jpg","comment_is_top":false,"comment_ctime":1655280171,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1655280171","product_id":100020801,"comment_content":"可以结合MySQL技术内幕(InnoDB存储引擎)的第二章一起看","like_count":0},{"had_liked":false,"id":348494,"user_name":"千锤百炼领悟之极限","can_delete":false,"product_type":"c1","uid":1744257,"ip_address":"","ucode":"224B5CF2101716","user_header":"https://static001.geekbang.org/account/avatar/00/1a/9d/81/d748b7eb.jpg","comment_is_top":false,"comment_ctime":1655135483,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1655135483","product_id":100020801,"comment_content":"flush的情况<br>1.redo log写满了。<br>2.内存不足。<br>3.空闲定时刷脏页。<br>4.正常关闭数据库。","like_count":0},{"had_liked":false,"id":348388,"user_name":"maple-0406","can_delete":false,"product_type":"c1","uid":1197608,"ip_address":"","ucode":"7191D06449B6B6","user_header":"https://static001.geekbang.org/account/avatar/00/12/46/28/14ef7207.jpg","comment_is_top":false,"comment_ctime":1655043967,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1655043967","product_id":100020801,"comment_content":"整个库的资源使用率不高，数据库经常“抖动”频率高，稳定性差，经常因为redo","like_count":0},{"had_liked":false,"id":343447,"user_name":"Geek_66d0aa","can_delete":false,"product_type":"c1","uid":2413797,"ip_address":"","ucode":"B07B695A63C49F","user_header":"","comment_is_top":false,"comment_ctime":1650856390,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1650856390","product_id":100020801,"comment_content":"老师你好，最近线上业务遇到奇怪的问题，偶尔会报错误，查不到太多资料，老师能帮忙解答吗？","like_count":0,"discussions":[{"author":{"id":2413797,"avatar":"","nickname":"Geek_66d0aa","note":"","ucode":"B07B695A63C49F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":567198,"discussion_content":"SQLSTATE[HY000] [2002] Operation timed out","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650856444,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":341965,"user_name":"再见理想","can_delete":false,"product_type":"c1","uid":1245999,"ip_address":"","ucode":"FAC88B3F6F6DFD","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/2f/0a5e0751.jpg","comment_is_top":false,"comment_ctime":1649934339,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1649934339","product_id":100020801,"comment_content":"为什么sql查询突然变慢了，mysql抽风？它可能是在刷脏页；<br>innodb 用 buffer pool 管理 内存数据页，而内存在buffer pool中有三种状态：<br>1，未使用的内存<br>2，干净页 （内存中的数据与磁盘中的数据一致）<br>3，脏页 （内存中的数据已更新，还没有保存到磁盘）<br>innodb刷脏页的时机：<br>1，redo log写满,无法再插入更多的redo log ，此时innodb需要将checkpoint向前移动擦去数据，并保证脏页写入磁盘，此期间内，数据库将无法执行所有的sql更新操作。<br>2，系统内存不足，无法读入新的数据页到内存，此时需要将部分数据清除，如果是干净页，直接清除就可以了，而如果是脏页则需要将数据落盘。此时查询数据无法获取到新的数据页，就需要等待刷完脏页后，才能正常执行查询逻辑。 innodb保证如果内存中有数据，则内存中数据是最新，如果内存中没有该数据页，则磁盘中的数据是最新的。<br>3，innodb认为系统空闲时，会执行刷脏页操作，innodb_io_capacity和innodb_max_dirty_pages_pct两个参数控制刷脏页的速度和时机。innodb_flush_neighbors控制是否刷脏页连坐机制，建议关闭。<br>4，在数据库即将关闭时，会将所有的脏页刷回磁盘。","like_count":0},{"had_liked":false,"id":339197,"user_name":"赵磊","can_delete":false,"product_type":"c1","uid":1481655,"ip_address":"","ucode":"18F3C2CC5040F9","user_header":"https://static001.geekbang.org/account/avatar/00/16/9b/b7/314ae48b.jpg","comment_is_top":false,"comment_ctime":1647964333,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1647964333","product_id":100020801,"comment_content":"write pos对应的LSN比某个数据页的LSN大, 则这个数据页肯定是干净页。这个结论怎么得出的","like_count":0,"discussions":[{"author":{"id":1015184,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/90/abb7bfe3.jpg","nickname":"fourge","note":"","ucode":"F3E3FFC4990358","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582815,"discussion_content":"当write pos lsn &lt; page lsn，说明这个脏页已经被刷新到磁盘上了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659688267,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":334875,"user_name":"Ocean D","can_delete":false,"product_type":"c1","uid":2727241,"ip_address":"","ucode":"C8037CBDF1AAD3","user_header":"https://static001.geekbang.org/account/avatar/00/29/9d/49/372ced1b.jpg","comment_is_top":false,"comment_ctime":1645164464,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1645164464","product_id":100020801,"comment_content":"老师:&quot;你好，问个问题， 对于一张表，建立一个聚簇索引和一个普通索引，该表的数据量是非常大，对于每次插入新的数据，是否都是都会重建索引，重建索引是不是会很慢&quot;","like_count":0,"discussions":[{"author":{"id":1015184,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/90/abb7bfe3.jpg","nickname":"fourge","note":"","ucode":"F3E3FFC4990358","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582816,"discussion_content":"会有发生页分裂的可能，通常推荐是自增主键，只需要追加操作即可。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659688325,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":329662,"user_name":"bear","can_delete":false,"product_type":"c1","uid":2353934,"ip_address":"","ucode":"65ADB4342BB290","user_header":"https://static001.geekbang.org/account/avatar/00/23/eb/0e/7d2a2286.jpg","comment_is_top":false,"comment_ctime":1641461048,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1641461048","product_id":100020801,"comment_content":"老师你好 有一个问题，看到麻烦解答下：就是redo log满了的时候 ，checkpoint 会向前移动（刷脏页到内存），redolog可能会读到change buffer 的更新记录（在次之前对应的change buffer修改的的数据由于没有读对应的数据页，也就一直没有数据合并，）那么redo log 读到这条change buffer的记录时候 是会将对应的数据页读到内存，根据change buffer 去修改，然后刷新脏页，还是这个时候并不会去处理，只在后续读到这个数据页的时候才会去更新数据页","like_count":0},{"had_liked":false,"id":326327,"user_name":"咖啡加点冰","can_delete":false,"product_type":"c1","uid":2525528,"ip_address":"","ucode":"339B87B7080F12","user_header":"https://static001.geekbang.org/account/avatar/00/26/89/58/24b2f611.jpg","comment_is_top":false,"comment_ctime":1639471646,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1639471646","product_id":100020801,"comment_content":"flush解释的意思是把内存里的数据写入磁盘的过程。之后文中又把redo log同步到磁盘的操作称为flush。但是之前并没有说过redo log是在内存里的，而是磁盘上地址有序的四个日志文件。所以这个flush的解释到底是什么呢？redo log在内存中是否也存在 感觉有必要讲一下","like_count":0},{"had_liked":false,"id":325019,"user_name":"wessonwang","can_delete":false,"product_type":"c1","uid":1000441,"ip_address":"","ucode":"A9BA5E3A3F278E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/43/f9/723ee153.jpg","comment_is_top":false,"comment_ctime":1638780854,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1638780854","product_id":100020801,"comment_content":"思考题，100M的redo log比较小，触发刷盘的频率变大，SQL执行耗时毛刺多且均匀。","like_count":0},{"had_liked":false,"id":323625,"user_name":"建强","can_delete":false,"product_type":"c1","uid":1397126,"ip_address":"","ucode":"62B03D0E0C64EC","user_header":"https://static001.geekbang.org/account/avatar/00/15/51/86/b5fd8dd8.jpg","comment_is_top":false,"comment_ctime":1638027813,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638027813","product_id":100020801,"comment_content":"思考题：<br>个人理解，redo log设置成1个100M的文件，由于redo log大小设置太小了，所以会导致redo log很快就满了，此时就需要不断刷脏页，而innodb_io_capacity设置为20000，MySQL认为系统能力很强，因此会全力去刷脏页，所以最终会导致数据库主机的IO开销很大。","like_count":0},{"had_liked":false,"id":313473,"user_name":"Geek_ec3370","can_delete":false,"product_type":"c1","uid":2624994,"ip_address":"","ucode":"AF0146483D3BB8","user_header":"","comment_is_top":false,"comment_ctime":1632454702,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632454702","product_id":100020801,"comment_content":"不合理设置innodb_io_capacity参数和redo log大小都会导致明明数据库磁盘压力很小却导致SQL很慢的现象","like_count":0},{"had_liked":false,"id":309061,"user_name":"啊良梓是我","can_delete":false,"product_type":"c1","uid":1655117,"ip_address":"","ucode":"E42FC1A60D331C","user_header":"https://static001.geekbang.org/account/avatar/00/19/41/4d/f6d6d13a.jpg","comment_is_top":false,"comment_ctime":1629908237,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1629908237","product_id":100020801,"comment_content":"上面加上一点理解：其实如果写到redo.log日志中的，那么肯定也在内存bufferpool中存在过，但是内存是很小的，所以刷脏页的频率比redo.log的checkpoint向前推进高很多。所以就出现很多redo.log中的修改记录的对应内存的脏页，都被刷到磁盘了。所以用一个脏页列表存储了当前脏页的LSN，如果没有的话，就证明已经干净了。<br>这里还有一个问题就是内存刷脏页都是按照最老的那个LSN（最小），也就是说，当突然出现断电的情况，内存没了，但是断电前我刷了一个脏页13-26到磁盘，磁盘也记录了这个页的LSN是13-26.然后呢redo.log要重放嘛，在redo.log的checkpoint从12开始，对应这个磁盘的话证明这个脏页已经刷了，所以就跳过啦？（这样子就是顺序读了？！）","like_count":0},{"had_liked":false,"id":300573,"user_name":"prader26","can_delete":false,"product_type":"c1","uid":1433707,"ip_address":"","ucode":"5EFFFC374ADECE","user_header":"https://static001.geekbang.org/account/avatar/00/15/e0/6b/f61d7466.jpg","comment_is_top":false,"comment_ctime":1625221095,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625221095","product_id":100020801,"comment_content":"<br><br>inndb 刷脏页<br>1 内存中数据页和磁盘中数据页内容不一致的时候，内存中的数据页称之为脏页，当内存中数据页 内容和磁盘数据页内容一致的时候，称之为 干净页。<br>2 innodb 使用缓冲池管理内存页，当内存空间不够的时候，就会把部分脏页数据同步到磁盘，称之为刷脏页。<br>3 刷脏页的速度和磁盘的硬件有关， innodb_io_capacity 参数是反应磁盘的 IOPS能力。 这个参数，尽量设置成磁盘的iops 参数，这样能重复嗯发挥innodb 的能力。<br>4 innodb_max_dirty_pages_pct 是脏页比例上限，默认值是 75%<br>5 innodb_flush_neighbors 设置为1 的时候，脏页的邻居是脏页也会同时被刷到磁盘。当为0的时候，邻居页不会被刷到磁盘。","like_count":0},{"had_liked":false,"id":300416,"user_name":"moonfox","can_delete":false,"product_type":"c1","uid":1526355,"ip_address":"","ucode":"902BFF40EFA9FA","user_header":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","comment_is_top":false,"comment_ctime":1625148615,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1625148615","product_id":100020801,"comment_content":"请问刷脏页时的连坐机制，相邻页是指内存中的页么？如果是，是哪个链表上的页？脏页链表中的相邻页么？","like_count":0,"discussions":[{"author":{"id":1015184,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/90/abb7bfe3.jpg","nickname":"fourge","note":"","ucode":"F3E3FFC4990358","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582817,"discussion_content":"脏页链表中的相邻数据页面","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659688487,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":298827,"user_name":"哈哈哈","can_delete":false,"product_type":"c1","uid":1248876,"ip_address":"","ucode":"C40ABE7161EFAE","user_header":"https://static001.geekbang.org/account/avatar/00/13/0e/6c/1f3b1372.jpg","comment_is_top":false,"comment_ctime":1624340720,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624340720","product_id":100020801,"comment_content":"innodb_flush_log_at_trx_commit默认是1，事务提交是同步刷盘的","like_count":0},{"had_liked":false,"id":293752,"user_name":"颜桦","can_delete":false,"product_type":"c1","uid":1099576,"ip_address":"","ucode":"1CD7250E052B32","user_header":"https://static001.geekbang.org/account/avatar/00/10/c7/38/d1a50cd6.jpg","comment_is_top":false,"comment_ctime":1621520663,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621520663","product_id":100020801,"comment_content":"课后题我觉得应该会频繁的抖动，但是抖动时间都不长","like_count":0},{"had_liked":false,"id":286694,"user_name":"Geek_a852c8","can_delete":false,"product_type":"c1","uid":2206508,"ip_address":"","ucode":"D925A9D71A76BA","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/O6qftWBakkjQHrAhF5tia21GKkQxibJaPy2nWUKc9eiaouaqb67Hj60RRKgjgHhzPmaxaHkLszcNYrDSkj21lPylQ/132","comment_is_top":false,"comment_ctime":1617505884,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617505884","product_id":100020801,"comment_content":"老师设置innodb_io_capacity是不是观察fio中的iops就行了，我查到我的电脑iops是min=356, max=  454, avg=401.30。那我设置innodb_io_capacity为400，是不是这样操作啊？","like_count":0},{"had_liked":false,"id":284078,"user_name":"帝江","can_delete":false,"product_type":"c1","uid":1590610,"ip_address":"","ucode":"93CBA4E4D05DA5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/B9vSOjMc2a86kYA8R5yDkVdFiaj2JeBZ1PuI9oUKhbnvuZwuibdUam6FTcGzDaiaFdk2GWJveUGhfCVpv4KaOdicoQ/132","comment_is_top":false,"comment_ctime":1616058233,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616058233","product_id":100020801,"comment_content":"内存与磁盘不一致的时候.这块内存有用.不能写新东西.不允许被覆盖.就像纸脏了.不能写字一样.这种情况叫脏页.<br>flush的过程就是拿橡皮擦掉字的过程.内存中的数据没用了.随便覆盖.就像一张干净的纸一样.所以叫干净页.","like_count":0},{"had_liked":false,"id":282154,"user_name":"hello","can_delete":false,"product_type":"c1","uid":1649057,"ip_address":"","ucode":"4F42DAA5DB5C38","user_header":"https://static001.geekbang.org/account/avatar/00/19/29/a1/41607383.jpg","comment_is_top":false,"comment_ctime":1615109249,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1615109249","product_id":100020801,"comment_content":"当内存数据页跟磁盘数据页内容不一致的时候，我们称这个内存页为“脏页”。<br><br>这个磁盘数据页是指的redo log数据页还是存储的数据页？","like_count":0,"discussions":[{"author":{"id":1526355,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","nickname":"moonfox","note":"","ucode":"902BFF40EFA9FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381637,"discussion_content":"存储的数据页，表的数据文件","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625149297,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":281237,"user_name":"鹅鹅鹅","can_delete":false,"product_type":"c1","uid":2185166,"ip_address":"","ucode":"6AFA3FCC7B5AEF","user_header":"https://static001.geekbang.org/account/avatar/00/21/57/ce/ad3c3954.jpg","comment_is_top":false,"comment_ctime":1614653380,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614653380","product_id":100020801,"comment_content":"这个抖一下，大部分是指更新吧，因为更新的时候，可能会刷脏页，以及change buffer吧。<br>而select的时候，都只是change buffer，也就是合并操作到redo log对吧。","like_count":0},{"had_liked":false,"id":280741,"user_name":"帝江","can_delete":false,"product_type":"c1","uid":1590610,"ip_address":"","ucode":"93CBA4E4D05DA5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/B9vSOjMc2a86kYA8R5yDkVdFiaj2JeBZ1PuI9oUKhbnvuZwuibdUam6FTcGzDaiaFdk2GWJveUGhfCVpv4KaOdicoQ/132","comment_is_top":false,"comment_ctime":1614336621,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614336621","product_id":100020801,"comment_content":"对于脏页.通过学习本节课有所改变了.<br>以前: 脏页就是不对的页面.要扔掉.<br>现在: 脏页是里面有数据的页.不能往这个页写新内容.因为有数据.(太脏了).想象成纸.而刷脏页的过程.可以类比于把纸上原来的内容抄到其他地方(数据页).然后用橡皮擦掉上面的字.擦干净以后就是干净页了.<br>所以: 页脏了不是扔掉啊.而是擦掉以后再用啊.","like_count":0},{"had_liked":false,"id":278740,"user_name":"五月","can_delete":false,"product_type":"c1","uid":1034183,"ip_address":"","ucode":"83B5FD8DBA35E4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c7/c7/8c2be2b3.jpg","comment_is_top":false,"comment_ctime":1613284410,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1613284410","product_id":100020801,"comment_content":"请教下，项目中遇到了一种情况：代码逻辑中没有使用事务，很普通的insert,然后获取last id这种方式，已经成功得到了id返回，但却会偶发数据库丢失数据，返回的该主键id数据不存在，主键出现了跳跃。会是由于内存满了问题引起的吗","like_count":0},{"had_liked":false,"id":278048,"user_name":"Long","can_delete":false,"product_type":"c1","uid":1318970,"ip_address":"","ucode":"2417242560360A","user_header":"https://static001.geekbang.org/account/avatar/00/14/20/3a/90db6a24.jpg","comment_is_top":false,"comment_ctime":1612740602,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612740602","product_id":100020801,"comment_content":"二刷第9天：温故知新：<br>1 innodb刷盘的速度两个因素，    （1）buffer pool脏页比例，（2）redo写盘的速度<br>2 控制innodb刷磁盘的能力的参数，innodb_io_capacity<br>3.buffer pool的脏页比率不要接近默认值75%<br>select concat(round(t1.variable_value&#47;t2.variable_value*100,2),&#39;%&#39;)  as dirty_page_pct from information_schema.global_status t1,information_schema.global_status t2<br>where t1.variable_name =&#39;Innodb_buffer_pool_pages_dirty&#39; and t2.variable_name = &#39;Innodb_buffer_pool_pages_total&#39;;<br>4.刷脏页的邻居算法，在机械硬盘的时代室友意义的，因为随机读写非常慢，但是现在的高速磁盘甚至SSD就没有必要了。innodb_flush_neighbors 在MySQL8.0默认值已经修改为0了 。<br>5.刷innodb buffer pool脏页的时候，不会刷新或者更新redo，只有在redo重放的时候才会考虑，如果数据页已经刷新，则跳过。<br>6.Innob怎么判断，数据页是脏页。每个数据页有个LSN，8字节，每次修改都会变大，对比这个LSN和checkpint的LSN，比check point小的就是干净页。---这个没看懂<br>7.flush一般指刷脏页，purge一般指清理undo，merge一般指应用change buffer。<br>8.innodb_fast_shutdown控制是否在shutdown的刷新buffer pool的脏页和脏日志。<br>升级需要注意的，可能需要使用=0的操作。<br>后面有时间，需要继续3刷。","like_count":0},{"had_liked":false,"id":273397,"user_name":"Ansyear","can_delete":false,"product_type":"c1","uid":1629257,"ip_address":"","ucode":"489CE96852EA2C","user_header":"https://static001.geekbang.org/account/avatar/00/18/dc/49/43ae1627.jpg","comment_is_top":false,"comment_ctime":1610587280,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1610587280","product_id":100020801,"comment_content":"正文说应该设置innodb_io_capacity为磁盘的iops，在其他地方看到设为50%-80%呢，那innodb_io_capacity_max这个参数怎么解释呢？","like_count":0,"discussions":[{"author":{"id":1015184,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/90/abb7bfe3.jpg","nickname":"fourge","note":"","ucode":"F3E3FFC4990358","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582818,"discussion_content":"就是告诉innodb存储引擎，你的磁盘iops能力（也就是说磁盘每秒IO操作数），有地方建议说设置为50-80%，是除了mysql之外，还有操作系统层的io开销，甚至是其它进程的io消耗需要。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659688655,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":272589,"user_name":"凹凸鸿","can_delete":false,"product_type":"c1","uid":1915334,"ip_address":"","ucode":"A458BAEBF314B2","user_header":"https://static001.geekbang.org/account/avatar/00/1d/39/c6/1e12f271.jpg","comment_is_top":false,"comment_ctime":1610165760,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1610165760","product_id":100020801,"comment_content":"内存数据和磁盘数据应该始终不相等吧，一个存短期，一个存长期。不理解怎么会相等呢？","like_count":0,"discussions":[{"author":{"id":1015184,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/90/abb7bfe3.jpg","nickname":"fourge","note":"","ucode":"F3E3FFC4990358","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582819,"discussion_content":"这里说的相等对象，是指同一个数据页，在内存中和磁盘中的他们的状态是一致的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659688715,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":272480,"user_name":"窗外","can_delete":false,"product_type":"c1","uid":1311172,"ip_address":"","ucode":"1E8F2D9439E7F3","user_header":"https://static001.geekbang.org/account/avatar/00/14/01/c4/21c2cde4.jpg","comment_is_top":false,"comment_ctime":1610097491,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1610097491","product_id":100020801,"comment_content":"老师好，想问一下，当一个事务持续写，一直未提交，所以持续写 redo log，而 redo log 大小有限需要覆写，那么当需要覆写时，会将对应的脏页落盘，可事务还未提交，脏页就可以落盘吗？<br><br>可以的话如果事务回滚，磁盘上的数据是错的；<br>不可以的话，redo log 没法覆写。","like_count":0,"discussions":[{"author":{"id":1015184,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/90/abb7bfe3.jpg","nickname":"fourge","note":"","ucode":"F3E3FFC4990358","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582821,"discussion_content":"所以说当redo log满了之后，MySQL会暂停（堵住）数据写入操作，也就是老师说的写性能跌为0","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659688797,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":269317,"user_name":"David.cui","can_delete":false,"product_type":"c1","uid":1302228,"ip_address":"","ucode":"AB46F310403612","user_header":"https://static001.geekbang.org/account/avatar/00/13/de/d4/b83c4185.jpg","comment_is_top":false,"comment_ctime":1608609232,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1608609232","product_id":100020801,"comment_content":"一个查询要淘汰的脏页个数太多，会导致查询的响应时间明显变长；~~~~这个是不是可以理解成mysql在做flush的时候会阻塞交易？还是不阻塞交易，因为操作系统资源都忙于FLUSH了，而导致交易变慢？","like_count":0,"discussions":[{"author":{"id":1015184,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/90/abb7bfe3.jpg","nickname":"fourge","note":"","ucode":"F3E3FFC4990358","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582822,"discussion_content":"准确的说，不能叫做阻塞！因为同一时间需要刷脏到磁盘的页面太多，会导致磁盘IO负载飙升（因为脏页刷新到磁盘上也要更多的内存和磁盘进行io交互），那么读的同时也需要io操作，此时MySQL的数据盘IO能力过载，所以导致查询响应时间明显边长。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659689258,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":266602,"user_name":"moonfox","can_delete":false,"product_type":"c1","uid":1526355,"ip_address":"","ucode":"902BFF40EFA9FA","user_header":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","comment_is_top":false,"comment_ctime":1607412206,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1607412206","product_id":100020801,"comment_content":"请教一个问题，在新增数据时，是按主键顺序写入数据文件的，但更新一条数据，就是随机写入数据文件了吧，是否需要页分裂来保证数据存放的物理顺序？比如数据是变长数据，修改后的数据长度变长了，无法在原来的位置存放？","like_count":0,"discussions":[{"author":{"id":1015184,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/90/abb7bfe3.jpg","nickname":"fourge","note":"","ucode":"F3E3FFC4990358","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582824,"discussion_content":"会的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659689282,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":265058,"user_name":"杨磊","can_delete":false,"product_type":"c1","uid":2130485,"ip_address":"","ucode":"8C06C02568E41D","user_header":"https://static001.geekbang.org/account/avatar/00/20/82/35/602e8bfc.jpg","comment_is_top":false,"comment_ctime":1606747692,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606747692","product_id":100020801,"comment_content":"课后问题回复:相对于1g的redolog 容易频繁发生抖动 因为redolog边小了 触发flush的概率变大了","like_count":0},{"had_liked":false,"id":261110,"user_name":"Cloud_July","can_delete":false,"product_type":"c1","uid":1003699,"ip_address":"","ucode":"98646F7142CBFF","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL8L7Am3u37GO6CWKqBbI02DZ2ss3IZb0F9OLewAS446vh3aicndQ255HjEDzIldBUhRpUbL04rnDA/132","comment_is_top":false,"comment_ctime":1605201780,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1605201780","product_id":100020801,"comment_content":"关于刷脏页的几个问题，内存不够时，要将脏页写入磁盘，淘汰机制下，淘汰脏页，对应的redo log位置随机的，看前面的留言，这时候不需要动redo log 可能会打上标记之类可以判断redo log对应的脏页已经没了 或者成为干净页。<br>那如果是redo log写满了，这时候需要推进checkpoint的时候，也需要刷脏页，假如推进的这一段空间的redo log 内容分散在多个不同的页中，这个需要查找具体的页，再去做内存到磁盘的刷新吧","like_count":0},{"had_liked":false,"id":260255,"user_name":"出卖灵魂的教练Kerry","can_delete":false,"product_type":"c1","uid":1807943,"ip_address":"","ucode":"8C64517DA556FE","user_header":"https://static001.geekbang.org/account/avatar/00/1b/96/47/93838ff7.jpg","comment_is_top":false,"comment_ctime":1604970505,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1604970505","product_id":100020801,"comment_content":"评论区也是干货满满","like_count":0},{"had_liked":false,"id":255101,"user_name":"Joe","can_delete":false,"product_type":"c1","uid":1111805,"ip_address":"","ucode":"F73CF74433168D","user_header":"https://static001.geekbang.org/account/avatar/00/10/f6/fd/2c619dde.jpg","comment_is_top":false,"comment_ctime":1603266027,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1603266027","product_id":100020801,"comment_content":"一直不太理解redolog记录的是物理日志，binlog记录的是逻辑日志，这两种有啥区别？<br>比如update t set a = a+1 where a = 10;<br>redolog 直接记录修改后的值a=11,还是记录a+1操作？","like_count":0,"discussions":[{"author":{"id":1015184,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/90/abb7bfe3.jpg","nickname":"fourge","note":"","ucode":"F3E3FFC4990358","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582826,"discussion_content":"是后者！redo记录的就是数据变化的过程，而binlog记录的变更后的记录值，如在row_format=row格式下，binlog的内容就是变更前后两条记录内容。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659689491,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":252101,"user_name":"Tulane","can_delete":false,"product_type":"c1","uid":1242467,"ip_address":"","ucode":"E1F5108B9E738F","user_header":"https://static001.geekbang.org/account/avatar/00/12/f5/63/53639bb7.jpg","comment_is_top":false,"comment_ctime":1602126038,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602126038","product_id":100020801,"comment_content":"老师, 看到这张的脏页描述, 我想通之前看redolog时的一些疑惑, 发出来您看看对不对.<br><br>读数据的时候, 会先到内存中读<br>• 如果读到内存页, 则一定是正确数据, 因为内存中数据页数据最新.<br>• 如果读不到内存页, 从磁盘中取出的数据页也一定是最新值, 因为脏页淘汰需要刷flush.<br><br>当使用普通索引时, 会用到change buffer, 此时数据页不必加载到内存, 就能完成更新.<br><br>此时如果读取数据, 加载的磁盘数据页到内存, 需要和change buffer结合组成最新数据, 得到最新数据的内存数据页.","like_count":0},{"had_liked":false,"id":251685,"user_name":"John","can_delete":false,"product_type":"c1","uid":1228424,"ip_address":"","ucode":"A46AF2906C38C1","user_header":"https://static001.geekbang.org/account/avatar/00/12/be/88/8d15796f.jpg","comment_is_top":false,"comment_ctime":1601796901,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601796901","product_id":100020801,"comment_content":"老师，这里对于内存不足的刷脏保有疑问。脏页的&quot;是否为脏&quot;的逻辑是由 redo log 中每行日志的序列号也就是 LSN (Log Sequence Number)实现的：<br><br>- Checkpoint 对象会记录 LSN，则小于该 LSN 的都是已经刷了的脏页。<br>- 而 buffer pool 中的 page 的头部中也会记录 LSN，表示修改当前 page 的最后操作在 redo log 中的 LSN。所以正常来说 page 的 LSN 如果小于 checkpoint 的 LSN，那么它肯定是 flush 了的。所以它是干净页。（如果系统宕机重启后还是会根据 redo log 重放 buffer pool 中的 page，LSN 也重新写入）<br><br>对于脏页，除了 buffer pool 满了加载新脏页需要根据 LRU 淘汰脏页的其它三种情况，其实都可以理解为正常推进 checkpoint 的过程，所以可以保证 LSN 的有序推进，即 LSN 大于 checkpoint 中 LSN 的 page 肯定是脏页。但是这里 LRU 淘汰的脏页就不一样了，根据惯性语义最久不使用应该包含读，所以此时要淘汰的可能就不是 buffer pool 中 LSN 最小、checkpoint LSN + 1 的脏页了，那这里就有问题，此时要怎么处理呢？<br><br>- 将小于该 LSN 的脏页也一起 flush 了？<br>- 还是有一个专门的地方记录大于 checkpoint 但是已经刷了的脏页？<br>- 还是说就不管这种情况，直接 flush 后就把该页淘汰，反正已经刷盘到数据文件了，数据不会丢失，就是后面 checkpoint 推进到当前 LSN 的时候会发生重复 flush？<br>- 还是说其实并不是按照最久不使用的淘汰策略的，而是最早被修改的脏页？","like_count":0},{"had_liked":false,"id":246885,"user_name":"慎独明强","can_delete":false,"product_type":"c1","uid":1965699,"ip_address":"","ucode":"DC2F7F2C0C8F60","user_header":"https://static001.geekbang.org/account/avatar/00/1d/fe/83/df562574.jpg","comment_is_top":false,"comment_ctime":1599523288,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599523288","product_id":100020801,"comment_content":"bufferpool 里面的内存都是以缓存页存储，对应磁盘的数据页，每一页16kb，缓存页包含数据头，比如记录这个缓存页的表空间等信息。每个bufferpool都有维护整个缓存页的数据头链表。其中包含free链表，表示空闲的缓存页，flush链表，表示需要刷回磁盘的缓存页，还有lru链表，表示在内存的干净数据，分为热数据区和冷数据区，防止连读机制和全表扫描将热数据淘汰。    当启动时，所有缓存页为空闲，从查询语句，需要分配缓存，则从free链表分配缓存页给这个数据，那么这个缓存页从free链表节点剔除，加入到lru链表，如果是更新请求，则加入到flush链表。 后台有定时任务更新lru链表和将flush链表数据刷入磁盘。   在flush链表数据满了后，则会强制刷磁盘，也会造成抖动。","like_count":0},{"had_liked":false,"id":244157,"user_name":"程辉","can_delete":false,"product_type":"c1","uid":1395334,"ip_address":"","ucode":"A8AE3BFE6EE59C","user_header":"https://static001.geekbang.org/account/avatar/00/15/4a/86/c7bd910e.jpg","comment_is_top":false,"comment_ctime":1598413062,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598413062","product_id":100020801,"comment_content":"mysql刷脏页是按照redolog中的LSN刷数据还是直接一整页刷入？如果是一整页刷入，那redo log怎么判断这条记录被刷入磁盘中了？","like_count":0},{"had_liked":false,"id":241586,"user_name":"型火🔥","can_delete":false,"product_type":"c1","uid":1003205,"ip_address":"","ucode":"C2322918B31E60","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4e/c5/78626367.jpg","comment_is_top":false,"comment_ctime":1597365979,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1597365979","product_id":100020801,"comment_content":"Redo log就像消息队列，削峰高成本的切换为线性的执行，消息堆积后需要处理，抖一下就是消息堆积了","like_count":0,"discussions":[{"author":{"id":1015184,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/90/abb7bfe3.jpg","nickname":"fourge","note":"","ucode":"F3E3FFC4990358","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582827,"discussion_content":"这个比喻米妙啊！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659689563,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":241290,"user_name":"Llooper田","can_delete":false,"product_type":"c1","uid":2107493,"ip_address":"","ucode":"564B3FB48410C7","user_header":"https://static001.geekbang.org/account/avatar/00/20/28/65/c2d383dc.jpg","comment_is_top":false,"comment_ctime":1597238019,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597238019","product_id":100020801,"comment_content":" 老师，图2这个打破了我之前的认知，有些乱了，请指正一下，bin log lsn 是不是等同于write pos 。如果是的话checkpoint lsn 位置应该一定小于等于write pos吧？但这图2来看，感觉write pos追着checkpoint 来写入，我蒙了，请指教！谢谢🙏","like_count":0},{"had_liked":false,"id":237476,"user_name":"崔经刚","can_delete":false,"product_type":"c1","uid":1827943,"ip_address":"","ucode":"207FDF850860C4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/P5lTnAkviacPGu5S5XJQGQdTpvkSjAVU9Nu2EYicIpMAjiaNP8aXDtfcIHicSnHw2fVIoqTWGGg48rZVzcficUlbgmw/132","comment_is_top":false,"comment_ctime":1595840857,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595840857","product_id":100020801,"comment_content":"老师，我先执行use information_schema，后再执行mysql&gt; select VARIABLE_VALUE into @a from global_status where VARIABLE_NAME = &#39;Innodb_buffer_pool_pages_dirty&#39;;<br>只响应了这个：Query OK, 1 row affected, 1 warning (0.00 sec)；然后我执行查询语句：<br>select * from information_schema.global_status limit 3;，发现这张表只有VARIABLE_NAME和VARIABLE_VALUE这两个字段，我的mysql版本是5.7.28。您使用是哪个版本的呀？","like_count":0},{"had_liked":false,"id":237461,"user_name":"崔经刚","can_delete":false,"product_type":"c1","uid":1827943,"ip_address":"","ucode":"207FDF850860C4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/P5lTnAkviacPGu5S5XJQGQdTpvkSjAVU9Nu2EYicIpMAjiaNP8aXDtfcIHicSnHw2fVIoqTWGGg48rZVzcficUlbgmw/132","comment_is_top":false,"comment_ctime":1595838022,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595838022","product_id":100020801,"comment_content":"老师，关于@梁中华的提问：<br>       接着Tony Du的问题讨论，脏页被淘汰的时候，只是redo log上checkpoint指针前移，应该不存在redo log随机读写的问题。<br>您的回答是: 也不会马上就前移动哈<br><br>我的疑问是：不会马上移动，是因为change buffer机制吗？比如change buffer满了，会将一部分数据写入到系统表进行数据的持久化？","like_count":0},{"had_liked":false,"id":230305,"user_name":"静静聆听","can_delete":false,"product_type":"c1","uid":1263932,"ip_address":"","ucode":"0A8600CB928EFE","user_header":"https://static001.geekbang.org/account/avatar/00/13/49/3c/5d54c510.jpg","comment_is_top":false,"comment_ctime":1593342780,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593342780","product_id":100020801,"comment_content":"老师，正常情况下，所有的变更要么直接写内存页，要么在change buffer中都有了，为什么还要再把redo log的内容写一遍redo log一般不是在崩溃时发生作用吗","like_count":0},{"had_liked":false,"id":226810,"user_name":"西门吹牛","can_delete":false,"product_type":"c1","uid":1508990,"ip_address":"","ucode":"E5D3624DDE1E83","user_header":"https://static001.geekbang.org/account/avatar/00/17/06/7e/735968e2.jpg","comment_is_top":false,"comment_ctime":1592208288,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592208288","product_id":100020801,"comment_content":"如果redo log写满，不刷脏页，直接淘汰脏页，此时，redo log要写入新日志，就必须cp推进，导致一部分redo log日志被覆盖，如果mysql异常重启，被覆盖掉的这部分日志对应的内存没有写盘，就没法恢复数据。所以感觉redo log 写满 flush 脏页：不应该是尽量避免，应该是一定要避免的","like_count":0},{"had_liked":false,"id":225530,"user_name":"mgs2002","can_delete":false,"product_type":"c1","uid":1812970,"ip_address":"","ucode":"F5931108BD509B","user_header":"https://static001.geekbang.org/account/avatar/00/1b/a9/ea/5bfce6c5.jpg","comment_is_top":false,"comment_ctime":1591779193,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591779193","product_id":100020801,"comment_content":"思考题这个redo log肯定会被写满呀，然后更新会卡住","like_count":0},{"had_liked":false,"id":219758,"user_name":"青石向晚","can_delete":false,"product_type":"c1","uid":1155598,"ip_address":"","ucode":"EA568D69879B07","user_header":"https://static001.geekbang.org/account/avatar/00/11/a2/0e/7b6eed24.jpg","comment_is_top":false,"comment_ctime":1590074277,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590074277","product_id":100020801,"comment_content":"您好，关于“这个问题可以这么想，如果刷太慢，会出现什么情况？首先是内存脏页太多，其次是 redo log 写满。”这句话我有个疑惑，刷脏页的速度和 redo log 写满没关系吧？redo log 的写满应该是跟产生事务的速度有关吧？","like_count":0},{"had_liked":false,"id":219100,"user_name":"🤔 🤔 🤔","can_delete":false,"product_type":"c1","uid":1901078,"ip_address":"","ucode":"F1A4B6270675AD","user_header":"https://static001.geekbang.org/account/avatar/00/1d/02/16/dd5cde99.jpg","comment_is_top":false,"comment_ctime":1589944908,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589944908","product_id":100020801,"comment_content":"redo过小，或者说4组redo都在活动状态，新事物DML语句操作时候，必须先写redo的，redo都满了，DML就出现了等待事件吧。这时候innodb buffer里 的脏数据的多与少，应该没什么意义了吧。等待的地方是在redo不能写。不知道理解的对不对","like_count":0},{"had_liked":false,"id":217001,"user_name":"LovePeace","can_delete":false,"product_type":"c1","uid":1010319,"ip_address":"","ucode":"5BA5B11FAF953E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6a/8f/5b224f54.jpg","comment_is_top":false,"comment_ctime":1589383530,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1589383530","product_id":100020801,"comment_content":"请教一下 MySQL中的redo log 是存在内存中还是 硬盘中的？<br>1.如果是在内存中的话那么如果机器挂了，不是也一起消失了嘛<br>2.如果是在硬盘中的话，那么直接写磁盘和写在redo log不是都很慢的嘛？","like_count":0,"discussions":[{"author":{"id":1015184,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/90/abb7bfe3.jpg","nickname":"fourge","note":"","ucode":"F3E3FFC4990358","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582829,"discussion_content":"1. 在磁盘中的\n2. 不一样，直接写磁盘是随机io，而redo log是转化为顺序io","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659689655,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":216132,"user_name":"DeenJun","can_delete":false,"product_type":"c1","uid":1026010,"ip_address":"","ucode":"6D40BA39A33C9D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a7/da/f057374c.jpg","comment_is_top":false,"comment_ctime":1589194130,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1589194130","product_id":100020801,"comment_content":"看了这篇文章有个疑惑：redo log也是写磁盘，如果每条更新redo log都落盘，那相当于也是随机写，性能也不行啊？如果部分操作可以cache在内存中，积累一定量或者time interval再把redo log落盘，这样顺序写但会丢失一部分数据吧？","like_count":0},{"had_liked":false,"id":215249,"user_name":"humor","can_delete":false,"product_type":"c1","uid":1181867,"ip_address":"","ucode":"9B48C4C7BEC92C","user_header":"https://static001.geekbang.org/account/avatar/00/12/08/ab/caec7bca.jpg","comment_is_top":false,"comment_ctime":1588940947,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588940947","product_id":100020801,"comment_content":"第二种场景是，这一天生意太好，要记住的事情太多，掌柜发现自己快记不住了，赶紧找出账本把孔乙己这笔账先加进去。<br>这个场景中掌柜为什么要记忆账目呢？账目不是会记到粉板上吗？而且人的记忆和计算机的内存的存储原理不一样吧，人的记忆容量怎么会记一天就会不够用了呢？","like_count":0},{"had_liked":false,"id":214428,"user_name":"幼儿编程教学","can_delete":false,"product_type":"c1","uid":1237199,"ip_address":"","ucode":"F13F3150E6CAE9","user_header":"https://static001.geekbang.org/account/avatar/00/12/e0/cf/43f201f2.jpg","comment_is_top":false,"comment_ctime":1588746826,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588746826","product_id":100020801,"comment_content":"向老师请教2个问题<br><br>1.<br>&gt;第一种是“redo log 写满了，要 flush 脏页”，这种情况是 InnoDB 要尽量避免的。<br>Q: 如何避免呢？开大innodb_log_file_size值？<br><br>innodb_log_file_size = 1G<br>innodb_log_files_in_group = 4<br><br>innodb_log_file_size = 2G<br>innodb_log_files_in_group = 2<br>上面这样2个配置的区别是什么？效果有什么不同？<br><br>2.<br>&gt;第二种是“内存不够用了，要先将脏页写到磁盘”，这种情况其实是常态。<br>&gt;所以，InnoDB 需要有控制脏页比例的机制，来尽量避免上面的这两种情况。<br>&gt;然后，根据上述算得的 F1(M) 和 F2(N) 两个值，取其中较大的值记为 R，之后引擎就可以按照 innodb_io_capacity 定义的能力乘以 R% 来控制刷脏页的速度。<br>&gt;要尽量避免这种情况，你就要合理地设置 innodb_io_capacity 的值，并且平时要多关注脏页比例，不要让它经常接近 75%。<br>Q: 看起来，F1(M) 和 F2(N) 我都控制不了？我能控制的只有 innodb_io_capacity 这个值？<br>当发现，刷脏页速度跟不上时，应该如何调整 innodb_io_capacity ？调大会怎样？调小会怎样？调小会遇到思考题中的问题，那我直接设置的大一点就好？大一点会遇到什么问题？<br>","like_count":0},{"had_liked":false,"id":211476,"user_name":"Geek_wuming","can_delete":false,"product_type":"c1","uid":1388314,"ip_address":"","ucode":"AE749892284E3B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/4RdOss6AW97KUaufOFIhQGMWJoRJvSZiayJBa36ic0A3M27hUFSBZhy4ZoXOp6gj1apln2N86icZEg1Z1f5PLEp8A/132","comment_is_top":false,"comment_ctime":1587969809,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587969809","product_id":100020801,"comment_content":"要是有完整的flush过程就完美了~ 感谢老师","like_count":0},{"had_liked":false,"id":202941,"user_name":"tommyCmd","can_delete":false,"product_type":"c1","uid":1208393,"ip_address":"","ucode":"4ADBB1FA44668D","user_header":"https://static001.geekbang.org/account/avatar/00/12/70/49/d7690979.jpg","comment_is_top":false,"comment_ctime":1586090066,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1586090066","product_id":100020801,"comment_content":"最后一点ssd推荐flush_db_neighbors参数设为0，有点疑问，就算是ssd, 随机io也比顺序io慢很多，所以这个参数是否也要根据业务需求调整","like_count":0},{"had_liked":false,"id":200787,"user_name":"ajlidue","can_delete":false,"product_type":"c1","uid":1308376,"ip_address":"","ucode":"D6B29E941958E8","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er6NXib2NGaTAAEe2KCcibH2FiafOOD73kQdcuAMGrnRib5CDWXum0SWDOM9NnWicbUsDpghmxEmJtpk9w/132","comment_is_top":false,"comment_ctime":1585650862,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585650862","product_id":100020801,"comment_content":"看到评论里说重放redo log的时候，会判断一个页是不是已经刷过的（通过比较LSN），如果是刷过的，则会跳过。这个是innodb做的优化吧？我理解即便是不判断是否刷过，直接重放redo log也没什么问题，毕竟回放redo log是幂等的","like_count":0},{"had_liked":false,"id":198837,"user_name":"Ryan","can_delete":false,"product_type":"c1","uid":1667987,"ip_address":"","ucode":"95BBBEE5B23878","user_header":"https://static001.geekbang.org/account/avatar/00/19/73/93/0a3a1e5b.jpg","comment_is_top":false,"comment_ctime":1585470061,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585470061","product_id":100020801,"comment_content":"抖一下 不好复现 就像工作中 开发跟qa的经典对话：明明在我电脑上跑出来结果是正确的？？","like_count":0},{"had_liked":false,"id":195838,"user_name":"库尔斯","can_delete":false,"product_type":"c1","uid":1085569,"ip_address":"","ucode":"BC2F220993C3ED","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIG210UcWicnKgOjBJC3CUxiaRImsiaqscVLyABrA4Kshm7hReicSuyRvfe1x07ydoT8WknNh2QLxU3rA/132","comment_is_top":false,"comment_ctime":1585218484,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585218484","product_id":100020801,"comment_content":"请问老师 :<br>1.checkpoint 既负责redo的刷盘也负责inndbbuffer的刷盘么？<br>2.除了checkpoint进程，应该还有别的专用的进程吧？","like_count":0},{"had_liked":false,"id":191826,"user_name":"贾森安德森","can_delete":false,"product_type":"c1","uid":1071680,"ip_address":"","ucode":"7FF58646E0AD86","user_header":"https://static001.geekbang.org/account/avatar/00/10/5a/40/59de94de.jpg","comment_is_top":false,"comment_ctime":1584798997,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584798997","product_id":100020801,"comment_content":"脏页很快就写满了，一直刷脏页。 理解还不够透彻啊，再看再看！！！看完文章，看评论。","like_count":0},{"had_liked":false,"id":191140,"user_name":"alex_lai","can_delete":false,"product_type":"c1","uid":1903459,"ip_address":"","ucode":"3057F2A593A6DB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/m7fLWyJrnwEPoIefiaxusQRh6D1Nq7PCXA8RiaxkmzdNEmFARr5q8L4qouKNaziceXia92an8hzYa5MLic6N6cNMEoQ/132","comment_is_top":false,"comment_ctime":1584748699,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1584748699","product_id":100020801,"comment_content":"我看MySQL文档里面说的default redo log file大小是48M, 是不是太小了？<br><br>The larger the value, the less checkpoint flush activity is required in the buffer pool, saving disk I&#47;O. Larger log files also make crash recovery slower.<br><br>如果设置成1G， recovery slower需要担心吗？ recover是指recover redo log到数据disk上吗？感觉1G*4 也根本不是个事儿吧？","like_count":0},{"had_liked":false,"id":189457,"user_name":"Geek_watermelon","can_delete":false,"product_type":"c1","uid":1492334,"ip_address":"","ucode":"91E8719FE966D1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erbEmOX3L6GagEaDzNpn28r0Yq7MjG5mxQicu8tXyqEZ1GatEm4Rc3VeicpqBftFq70AJictfmBmyDGA/132","comment_is_top":false,"comment_ctime":1584518387,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584518387","product_id":100020801,"comment_content":"首先是回顾下刷页的出发时机<br>1. redo被写满后，checkpoint推进的后进过的redo相关的buffer pool里的脏页需要刷回磁盘<br>2.加载新页发现buffer pool紧张时，将最久未使用的dirty page刷回磁盘并释放它提供空间<br>3.正常shutdown的时候<br>4.服务空闲时悄悄进行<br>本文末的问题，不慎设置了redo为1个100M文件，那直接的影响就是这100M会被频繁写满，必须推进checkpoint，那么write-pos和checkpoint直接相关的脏页就需要flush。这个过程会因为redo过小而频繁发生，那么mysql“抖动”的页更频繁了。这是我的浅薄理解","like_count":0},{"had_liked":false,"id":189165,"user_name":"哈密锅儿","can_delete":false,"product_type":"c1","uid":1792142,"ip_address":"","ucode":"35B34503F530AB","user_header":"https://static001.geekbang.org/account/avatar/00/1b/58/8e/97b20eb3.jpg","comment_is_top":false,"comment_ctime":1584462500,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584462500","product_id":100020801,"comment_content":"那应该会频繁抖动","like_count":0},{"had_liked":false,"id":186664,"user_name":"ipofss","can_delete":false,"product_type":"c1","uid":1018620,"ip_address":"","ucode":"DE3061C9259F9E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8a/fc/d1dd57dd.jpg","comment_is_top":false,"comment_ctime":1583897621,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583897621","product_id":100020801,"comment_content":"速度*时间=容量大小。若更新速度不变，容量大小（redo log）变小，则容量变满的时间就变短，然后就会导致刷redo log。频繁的刷redo log，会导致MySQL经常的“抖”动，影响性能。","like_count":0},{"had_liked":false,"id":186033,"user_name":"张汉桂-东莞","can_delete":false,"product_type":"c1","uid":1116277,"ip_address":"","ucode":"38657ABA59382A","user_header":"https://static001.geekbang.org/account/avatar/00/11/08/75/512b9f26.jpg","comment_is_top":false,"comment_ctime":1583744649,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583744649","product_id":100020801,"comment_content":"老师，innodb_io_capacity这个参数应该如何设置？你写的公式我没看懂。能否写个示范案例？","like_count":0},{"had_liked":false,"id":184720,"user_name":"天天向上","can_delete":false,"product_type":"c1","uid":1242455,"ip_address":"","ucode":"0CCCA6F4DCC480","user_header":"https://static001.geekbang.org/account/avatar/00/12/f5/57/ce10fb1b.jpg","comment_is_top":false,"comment_ctime":1583391036,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583391036","product_id":100020801,"comment_content":"老师在 热评第一的留言里回复说：其实由于淘汰的时候，刷脏页过程不用动redo log文件的。这句话不理解啊。刷脏页为什么不需要动redo log文件啊，不是需要移动check point吗","like_count":0},{"had_liked":false,"id":183180,"user_name":"乔丹","can_delete":false,"product_type":"c1","uid":1217413,"ip_address":"","ucode":"D832A9F97A0C7E","user_header":"https://static001.geekbang.org/account/avatar/00/12/93/85/f5d9474c.jpg","comment_is_top":false,"comment_ctime":1582968000,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582968000","product_id":100020801,"comment_content":"这节课又刷新了我一个认知：<br>flush脏数据不用去redo log里面读取，而是直接在内存里面将脏页的数据flush到磁盘里。<br>那内存里保存的脏页是否和磁盘中的对应的data page的行数和列数是一致的呢？<br>","like_count":0},{"had_liked":false,"id":175876,"user_name":"御风","can_delete":false,"product_type":"c1","uid":1812807,"ip_address":"","ucode":"51C8212BE06364","user_header":"https://static001.geekbang.org/account/avatar/00/1b/a9/47/ded5da90.jpg","comment_is_top":false,"comment_ctime":1580876204,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580876204","product_id":100020801,"comment_content":"多看几遍，再多看看留言，越来越明朗","like_count":0},{"had_liked":false,"id":174754,"user_name":"与狼共舞","can_delete":false,"product_type":"c1","uid":1391144,"ip_address":"","ucode":"02AC04B43F0194","user_header":"https://static001.geekbang.org/account/avatar/00/15/3a/28/cf707831.jpg","comment_is_top":false,"comment_ctime":1580372004,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580372004","product_id":100020801,"comment_content":"脏页比例这个SQL应该把数据库名称加一下，我找了半天在performance_schema数据库才发现。","like_count":0},{"had_liked":false,"id":165541,"user_name":"古月关耳","can_delete":false,"product_type":"c1","uid":1357013,"ip_address":"","ucode":"13DC7FFED15ABA","user_header":"https://static001.geekbang.org/account/avatar/00/14/b4/d5/9f592202.jpg","comment_is_top":false,"comment_ctime":1577256793,"is_pvip":false,"replies":[{"id":"63142","content":"不是<br><br>只要数据量大于内存大小， 就算是纯读的压力（没有生成redolog），也会让内存“不够用”","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1577272592,"ip_address":"","comment_id":165541,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1577256793","product_id":100020801,"comment_content":"redo log写满和内存不够用，不是一个概念？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479198,"discussion_content":"不是\n\n只要数据量大于内存大小， 就算是纯读的压力（没有生成redolog），也会让内存“不够用”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577272592,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":154845,"user_name":"尼古丁","can_delete":false,"product_type":"c1","uid":1722676,"ip_address":"","ucode":"3DA0ABA96F553D","user_header":"https://static001.geekbang.org/account/avatar/00/1a/49/34/0da5423f.jpg","comment_is_top":false,"comment_ctime":1574579274,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1574579274","product_id":100020801,"comment_content":"想了解一下SQL写的时候会暂存在日志里面，那么读的时候又怎么拿到更新后的数据呢。","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":154999,"discussion_content":"读的时候如果在内存中就直接从内存拿数据，否则从磁盘中拿数据。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580208319,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":154323,"user_name":"虢國技醬","can_delete":false,"product_type":"c1","uid":1056807,"ip_address":"","ucode":"5A192262AA037E","user_header":"https://static001.geekbang.org/account/avatar/00/10/20/27/a6932fbe.jpg","comment_is_top":false,"comment_ctime":1574409441,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1574409441","product_id":100020801,"comment_content":"同事在内部群描述了一个偶发的查询特别慢的咨询，我反手就推给他这篇文章✌️","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":155001,"discussion_content":"你应该问问他具体的情况，然后在群里帮他解决，这样更显得你厉害。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1580208357,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":153634,"user_name":"miracle","can_delete":false,"product_type":"c1","uid":1276137,"ip_address":"","ucode":"FD7074F1062AE9","user_header":"https://static001.geekbang.org/account/avatar/00/13/78/e9/9d807269.jpg","comment_is_top":false,"comment_ctime":1574292150,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1574292150","product_id":100020801,"comment_content":"这里写数据写redolog完了以后还会写binlog吧，然后后面才是flush的过程？不知道我的理解对不对","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":155002,"discussion_content":"应该是。 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580208416,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":151700,"user_name":"请叫我紫皮书","can_delete":false,"product_type":"c1","uid":1203288,"ip_address":"","ucode":"29F98AB3A5D98E","user_header":"https://static001.geekbang.org/account/avatar/00/12/5c/58/590d0a43.jpg","comment_is_top":false,"comment_ctime":1573780161,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1573780161","product_id":100020801,"comment_content":"老师，我有一个疑问，innodb的checkpoint相关的，比如当前的redo log的LSN=1000，checkpoint LSN=500，如果当前内存池里的页不够了，通过最近最少使用算法淘汰一个页，这个页是一个脏页，且LSN=700，那么在刷新脏页时，LSN&lt;=700的脏页都需要刷新，我这样的理解对吗？请老师指正。","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":155004,"discussion_content":"如果你当前的redo log 的lsn是1000,checkpoint=500，那说明需要向前推checkpoint了。redo log刷脏。而你又说内存到lsn=700时内存满了，那此时内存进行刷脏，不用管redo log.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580209002,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1762252,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/e3/cc/0947ff0b.jpg","nickname":"nestle","note":"","ucode":"469800BED81B54","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":77839,"discussion_content":"我也有这个疑问，需要flush的脏页，对应的redolog要怎么处理。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575946468,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":149418,"user_name":"乘风","can_delete":false,"product_type":"c1","uid":1115724,"ip_address":"","ucode":"0420C5535DACB7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLwSoTjHPX5tm4whBSfoZLX6toZxrZGUaLABQywKNf4MDc9toK3QSV7Z99ATcGicFCysoleQ5ISzmw/132","comment_is_top":false,"comment_ctime":1573214102,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573214102","product_id":100020801,"comment_content":"结论:<br>\t丢失了由InnoDB触发脏页刷新的机制,而大部分是由redo log主动触发脏页更新或淘汰LRU 尾页时触发脏页刷新.<br><br>首先分阶段分析:<br>1.redo log还未写满情况,buffer pool未满,这时脏页数据都存在buffer pool中,并且因为内存配置远远大于redo log的配置,所以出现淘汰脏页的情况较低,并且因为磁盘IO非常大,也不会出现主动将脏页数据同步到磁盘的情况.<br><br>2.redo log 写满,buffer pool未满,这时会强制触发脏页刷新,redo log与buffer pool比例悬殊,所以在多写场景会经常发生触发因redo log满主动同步脏页数据的情况. 因为磁盘IO性能较好,所以影响不会非常严重.<br><br>3.redo log 未满,buffer pool已满,这时会强制触发脏页刷新,但因为脏页比例较少(相比内存来说),所以后续可能出现频繁更新的场景仍处于2.<br>","like_count":0},{"had_liked":false,"id":137528,"user_name":"zKerry","can_delete":false,"product_type":"c1","uid":1497740,"ip_address":"","ucode":"9FB006D1A38D3F","user_header":"","comment_is_top":false,"comment_ctime":1569766259,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1569766259","product_id":100020801,"comment_content":"如何根据硬盘性能设置 innodb_io_capacity 的值？","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":155005,"discussion_content":"fio -filename=$filename -direct=1 -iodepth 1 -thread -rw=randrw -ioengine=psync -bs=16k -size=500M -numjobs=10 -runtime=10 -group_reporting -name=mytest","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580209034,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":134639,"user_name":"未来怎样","can_delete":false,"product_type":"c1","uid":1652085,"ip_address":"","ucode":"4E54EB62595B27","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKORTofsU89GYKtywquzKuEiabvZnEOonfMYKuCPlo8GDlXqZuJdBicu0XtlaeodH4BnmHV1kldSAwQ/132","comment_is_top":false,"comment_ctime":1568884427,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568884427","product_id":100020801,"comment_content":"老师说：当内存也中的数据和磁盘数据文件中数据不一致时，内存页为脏页，然后根据第二讲redolog的机制，每次更新只会更新内存，并记录redolog，那岂不是每一次更新都会产生脏页数据？另外还有一个疑问，当进行flush的时候，是用脏页数据刷的数据文件还是用redolog刷的数据文件？（我理解的脏页数据跟redolog应该是一致的）。","like_count":0},{"had_liked":false,"id":129923,"user_name":"heyman","can_delete":false,"product_type":"c1","uid":1173894,"ip_address":"","ucode":"92EF9EF1B1B1B3","user_header":"https://static001.geekbang.org/account/avatar/00/11/e9/86/d34800a4.jpg","comment_is_top":false,"comment_ctime":1567327584,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567327584","product_id":100020801,"comment_content":"老师您好。按我的理解，场景一和场景二在mysql5.6以后是异步在一个page cleaner线程里执行的，不会阻塞用户查询线程。那么请问，还会出现文中所说的“抖”吗？","like_count":0},{"had_liked":false,"id":128162,"user_name":"-W.LI-","can_delete":false,"product_type":"c1","uid":1210699,"ip_address":"","ucode":"3556786538664F","user_header":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","comment_is_top":false,"comment_ctime":1566838612,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1566838612","product_id":100020801,"comment_content":"老师好!change buffer中的数据，如果不去读，就不会加载到内存中，也就不会去触发刷脏页了是么?redo log写满的事后，会去把所有change buffer中的数据加载带内存，更新然后刷到磁盘中么?","like_count":0,"discussions":[{"author":{"id":1789588,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/4e/94/af3eb6d4.jpg","nickname":"面试怪圈","note":"","ucode":"C9C4B9B2F699C6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":191715,"discussion_content":"1.必须等待内存满了或者redolog满了才会出发\n2.因为页已经刷新到内存了,也会由内存满了,触发flush\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583029674,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":155008,"discussion_content":"1、change buffer中的数据一直在内存中啊。\n2、不明白啥意思。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580209136,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128161,"user_name":"-W.LI-","can_delete":false,"product_type":"c1","uid":1210699,"ip_address":"","ucode":"3556786538664F","user_header":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","comment_is_top":false,"comment_ctime":1566838399,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1566838399","product_id":100020801,"comment_content":"老师好!redo log设置太小，会不会出现不够刷的情况啊?。循环使用中间有一段卡主了，刷不了死锁之类的各种原因卡着。","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":155009,"discussion_content":"应该没有死锁的情况吧。只不过会抖的次数多吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580209173,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":124471,"user_name":"tiger","can_delete":false,"product_type":"c1","uid":1587264,"ip_address":"","ucode":"20011F5A8BF02E","user_header":"https://static001.geekbang.org/account/avatar/00/18/38/40/29351958.jpg","comment_is_top":false,"comment_ctime":1565905810,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1565905810","product_id":100020801,"comment_content":"如果修改(增删改)语句改变了某些页的记录，在没有提交前被flush到了数据文件，正好服务器异常掉电了，数据通过什么机制怎么实现前滚的，","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":155012,"discussion_content":"没提交，怎么flush到文件的？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580209296,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":120413,"user_name":"钧天府人","can_delete":false,"product_type":"c1","uid":1102481,"ip_address":"","ucode":"0504631225A384","user_header":"","comment_is_top":false,"comment_ctime":1564887190,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1564887190","product_id":100020801,"comment_content":"林老师，问下插入数据和删除数据，是不是在“redo log”和“脏页”里面？有点懵了。","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":155061,"discussion_content":"在redo log中。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580213533,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118833,"user_name":"天下行走","can_delete":false,"product_type":"c1","uid":1462449,"ip_address":"","ucode":"73A4CD8BB91235","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLfrbMvhKQYhxP6ziaHaj4KUNRzst8u7BZsWUsazK8oTLXcNH6sDGITl6icy3IiaGFe9Iiae12LuTrF1g/132","comment_is_top":false,"comment_ctime":1564450539,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564450539","product_id":100020801,"comment_content":"老师，请教一下，redolog刷盘时，内存页会依次（或者全部）加群吗，这里会出现不一致得情况","like_count":0},{"had_liked":false,"id":118280,"user_name":"章星","can_delete":false,"product_type":"c1","uid":1134381,"ip_address":"","ucode":"6A4BC852BE7025","user_header":"https://static001.geekbang.org/account/avatar/00/11/4f/2d/7b5ed6c2.jpg","comment_is_top":false,"comment_ctime":1564308785,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1564308785","product_id":100020801,"comment_content":"InnoDB redo log写满的情况要避免，我记得不是redolog是循环写的吗？那肯定会写满的，然后切换到下一个redolog文件。","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":155064,"discussion_content":"循环写，是不是也有写一圈的情况，这种一圈就是满的情况。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580213578,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115224,"user_name":"库尔斯","can_delete":false,"product_type":"c1","uid":1085569,"ip_address":"","ucode":"BC2F220993C3ED","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIG210UcWicnKgOjBJC3CUxiaRImsiaqscVLyABrA4Kshm7hReicSuyRvfe1x07ydoT8WknNh2QLxU3rA/132","comment_is_top":false,"comment_ctime":1563512741,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1563512741","product_id":100020801,"comment_content":"老师 change buffer merge的时候也会让数据库抖动一下么?","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":155068,"discussion_content":"是的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580213751,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114132,"user_name":"美美","can_delete":false,"product_type":"c1","uid":1148422,"ip_address":"","ucode":"44CC95C45AF345","user_header":"https://static001.geekbang.org/account/avatar/00/11/86/06/72b01bb7.jpg","comment_is_top":false,"comment_ctime":1563241197,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563241197","product_id":100020801,"comment_content":"讲解的时候是根据知道点来推导出解决办法，但是生产环境还有一个很麻烦的问题，是首先怎么发现问题，通过什么现象或者排查路径指标来定位问题，然后才是解决问题的办法。所以老师在讲解知识点时，是不是可以多讲解如何发现问题的","like_count":0},{"had_liked":false,"id":110462,"user_name":"残天噬魂","can_delete":false,"product_type":"c1","uid":1506609,"ip_address":"","ucode":"A2AD8303A4518D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/q2HwchogzNiavKhIB4GfAxH6B88NhSoC7B7keVEUqiaP6JPokDUNJLYehocOyqYqrhA3iaxywyRXLYkYJjDUQESZw/132","comment_is_top":false,"comment_ctime":1562283925,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562283925","product_id":100020801,"comment_content":"redolog会很快被占满，然后刷脏页，但很快又会刷满，所以应该会经常抖一下","like_count":0},{"had_liked":false,"id":106450,"user_name":"尔冬橙","can_delete":false,"product_type":"c1","uid":1225224,"ip_address":"","ucode":"0B013A49BC18DA","user_header":"https://static001.geekbang.org/account/avatar/00/12/b2/08/92f42622.jpg","comment_is_top":false,"comment_ctime":1561305398,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1561305398","product_id":100020801,"comment_content":"我想问下您说redolog也是写磁盘，那为什么不直接更新到磁盘呢，除了保留记录之外，直接更新和写redolog消耗时间上上是不是一样的？","like_count":0,"discussions":[{"author":{"id":1196339,"avatar":"https://static001.geekbang.org/account/avatar/00/12/41/33/d1064f9a.jpg","nickname":"Sun","note":"","ucode":"1BC2741DC07FC5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":167517,"discussion_content":"redo log 是append方式的，就是直接追加记录，是顺序写磁盘，比mysql记录的更新这种，是随机写效率要高很多。这也是wal能提升性能的原因之一。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581505435,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":105627,"user_name":"大宝","can_delete":false,"product_type":"c1","uid":1102771,"ip_address":"","ucode":"224458E5D1A35A","user_header":"https://static001.geekbang.org/account/avatar/00/10/d3/b3/4f5550c0.jpg","comment_is_top":false,"comment_ctime":1561044839,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561044839","product_id":100020801,"comment_content":"为什么是从脏页比例和日志序号中取一个，而不是权重运算了","like_count":0},{"had_liked":false,"id":101461,"user_name":"Rainman","can_delete":false,"product_type":"c1","uid":1025931,"ip_address":"","ucode":"6FD00E587EA4CF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a7/8b/208d9e2c.jpg","comment_is_top":false,"comment_ctime":1559812852,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1559812852","product_id":100020801,"comment_content":"原文写到：“InnoDB 在处理更新语句的时候，只做了写日志这一个磁盘操作。这个日志叫作 redo log（重做日志）”<br>这里涉及到要写redo log和binlog两个磁盘操作，才完成这个更新语句的事务。<br>所以，这里binlog也应该提一下。<br>老师，我说的对吗？","like_count":0,"discussions":[{"author":{"id":1117072,"avatar":"https://static001.geekbang.org/account/avatar/00/11/0b/90/f161b09a.jpg","nickname":"赵加兴","note":"","ucode":"B5730C4175B05D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2887,"discussion_content":"binlog 应该属于 server 层处理的， InnoDB 不处理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564020677,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99787,"user_name":"左瞳","can_delete":false,"product_type":"c1","uid":1206589,"ip_address":"","ucode":"B262A3E99C8605","user_header":"https://static001.geekbang.org/account/avatar/00/12/69/3d/3cfb9b87.jpg","comment_is_top":false,"comment_ctime":1559300591,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1559300591","product_id":100020801,"comment_content":"什么情况下查询会flush掉脏页？是查询的时候数据页增加了内存造成的吗？","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":155070,"discussion_content":"上述四种情况。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580213885,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":98524,"user_name":"孟太行","can_delete":false,"product_type":"c1","uid":1445138,"ip_address":"","ucode":"CCBB189EE3CABC","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eprdHAHx7Sx1bVmibW3tOGpibG7mj43HvbCV3GBm8vItMo1zWRBiamvbCGibmwnIHkVlEshbvAblPUyEw/132","comment_is_top":false,"comment_ctime":1559017745,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559017745","product_id":100020801,"comment_content":"林老师，我咨询一个问题：<br>我们有一个RDS for MySQL 5.6数据库，一到做活动时执行语句就很慢（insert和select语句较多）。但是RDS实例的CPU、内存、IOPS等资源都比较空闲（不过都有一定程度的上升）。我看了一下，在活动时间点，脏块率4.4%时就开始刷盘了，但是我们的最大脏块率是默认的75%，innodb_io_capacity=2000。而且他们在自建MySQL中没有这个现象。<br>我想请教下：为什么在4.4%脏块率时就进行刷盘操作了？这个时候按道理不是系统空闲的时间。","like_count":0},{"had_liked":false,"id":91231,"user_name":"刘常青","can_delete":false,"product_type":"c1","uid":1333608,"ip_address":"","ucode":"6F15CBEF9AB8D1","user_header":"https://static001.geekbang.org/account/avatar/00/14/59/68/b1b5e8bb.jpg","comment_is_top":false,"comment_ctime":1556940185,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1556940185","product_id":100020801,"comment_content":"一张表的数据达到一千万，添加字段，或者重新建立索引都会使数据库卡住，这也是刷新脏页的原因吧，有没有其他办法可以在这张表上加字段，又不影响数据库卡，前期没设计好，后来哭着往下走，有些场景，做关联表也不太合适，最好增加字段，老师，请教下","like_count":0,"discussions":[{"author":{"id":1789588,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/4e/94/af3eb6d4.jpg","nickname":"面试怪圈","note":"","ucode":"C9C4B9B2F699C6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":191720,"discussion_content":"这个是MDL锁的问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583029965,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":90761,"user_name":"葱本","can_delete":false,"product_type":"c1","uid":1045279,"ip_address":"","ucode":"ACBC2704516845","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f3/1f/05f97f0f.jpg","comment_is_top":false,"comment_ctime":1556629158,"is_pvip":true,"discussion_count":2,"race_medal":0,"score":"1556629158","product_id":100020801,"comment_content":"我也很困惑，如果没有刷盘就系统崩溃丢了呢，那这些redolog不就丢了么？","like_count":0,"discussions":[{"author":{"id":1789588,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/4e/94/af3eb6d4.jpg","nickname":"面试怪圈","note":"","ucode":"C9C4B9B2F699C6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":191723,"discussion_content":"写了内存,然后commit了redolog,这样才完成一个事务.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583030023,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":155077,"discussion_content":"可详细看第二章。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580214276,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":90221,"user_name":"你好太阳","can_delete":false,"product_type":"c1","uid":1498710,"ip_address":"","ucode":"53B6EE940E402C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIhOJnSGRjgdPPrAmlqogS41LDicAWu3AkvnEp3pBxBjic8gicYIwIuvHBXbtHhicLIdtxDeia00mJQcow/132","comment_is_top":false,"comment_ctime":1556451583,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556451583","product_id":100020801,"comment_content":"有两个疑惑<br>1.计算出R%,然后用innodb_io_capacity*R%的速率开始刷脏页，什么时候这个过程结束。<br>2.innodb_io_capacity是一定时间内随机指写磁盘的次数吗，写一次磁盘相当于刷几个脏页呢","like_count":0},{"had_liked":false,"id":85427,"user_name":"驴哥","can_delete":false,"product_type":"c1","uid":1274188,"ip_address":"","ucode":"9197AE37A725A9","user_header":"https://static001.geekbang.org/account/avatar/00/13/71/4c/b129b745.jpg","comment_is_top":false,"comment_ctime":1555059190,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555059190","product_id":100020801,"comment_content":"我自己使用的开发环境，虚拟机有时候直接关电源。第二天开机后第一次查询列表特别慢，之后就好了。感觉也是在flush ","like_count":0},{"had_liked":false,"id":81272,"user_name":"cxlblm","can_delete":false,"product_type":"c1","uid":1066342,"ip_address":"","ucode":"D6D6A1EFD580E3","user_header":"https://static001.geekbang.org/account/avatar/00/10/45/66/5169b669.jpg","comment_is_top":false,"comment_ctime":1553846251,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553846251","product_id":100020801,"comment_content":"林老师, 关于这个问题不是特别理解<br>&gt; 关于粉板和redo log的类比我觉得有一点不太合适：redo log记录的是实时欠款，比如账本中是10文，又欠了9文，此时redo log 记录的是19；而粉板的话，只会追加某人欠款+9文，不会关注原来已欠款多少（不然某人赊账时，我还需要找到账本中的这个人，才知道他之前欠款多少，我觉得这个场景跟MySQL中的场景还是有区别的）<br><br>2018-12-12<br>作者回复: Redo log里也是记的+9哦<br><br>redo log是工作在innodb引擎的, 如果我的条件是 update s = s + 9 where id = 1, 这个更新的时候不是server层已经把结果算出了吗? 那么innodb怎么知道+9这个数据呢? 难道这个计算的操作实在innodb层计算?","like_count":0},{"had_liked":false,"id":81164,"user_name":"唯她命","can_delete":false,"product_type":"c1","uid":1240398,"ip_address":"","ucode":"8F687E8D306840","user_header":"https://static001.geekbang.org/account/avatar/00/12/ed/4e/ef406442.jpg","comment_is_top":false,"comment_ctime":1553824160,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1553824160","product_id":100020801,"comment_content":"老师，第二种情况，如果淘汰脏页，则刷数据，如果淘汰干净页，什么也不做，那如果淘汰change buffer呢？","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":155085,"discussion_content":"那就相当于要执行merge操作，然后执行第二种情况的刷脏页。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580214571,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":80392,"user_name":"不似旧日","can_delete":false,"product_type":"c1","uid":1161271,"ip_address":"","ucode":"DF4C5E3AB9570C","user_header":"https://static001.geekbang.org/account/avatar/00/11/b8/37/98991aeb.jpg","comment_is_top":false,"comment_ctime":1553654826,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553654826","product_id":100020801,"comment_content":"数据库突然变慢的原因:<br>内存不足,MySQL将内存中的数据同步到硬盘<br>缓存不足,MySQL将内存中的数据同步到硬盘<br>MySQL空闲,MySQL将内存中的数据同步到硬盘<br>MySQL正常关闭","like_count":0},{"had_liked":false,"id":79512,"user_name":"秋天来了","can_delete":false,"product_type":"c1","uid":1205977,"ip_address":"","ucode":"98781C246B60A6","user_header":"https://static001.geekbang.org/account/avatar/00/12/66/d9/8953d6c6.jpg","comment_is_top":false,"comment_ctime":1553503183,"is_pvip":false,"replies":[{"id":"29655","content":"不会<br>","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1554052424,"ip_address":"","comment_id":79512,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553503183","product_id":100020801,"comment_content":"一部分在内存，一部分在磁盘，会影响查询结果吗？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444523,"discussion_content":"不会\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554052424,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79309,"user_name":"ccccc","can_delete":false,"product_type":"c1","uid":1152893,"ip_address":"","ucode":"55A093B24D7651","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eo9biaLzxibM9SHsOWbfHicXbWNFK10Fa5BVJfibzrMtiafez93nctsBmbJg8jAYsaxQdicjZQD7iaRFs0Vw/132","comment_is_top":false,"comment_ctime":1553432668,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553432668","product_id":100020801,"comment_content":"老师，redo log发生‘覆盖写’之前，是不是必须保证数据已写入磁盘，否则就必须停下覆盖写，等数据写入磁盘完成之后再‘覆盖写’","like_count":0},{"had_liked":false,"id":66951,"user_name":"kyq叶鑫","can_delete":false,"product_type":"c1","uid":1129030,"ip_address":"","ucode":"0002BFD7569B06","user_header":"https://static001.geekbang.org/account/avatar/00/11/3a/46/9fd9bd26.jpg","comment_is_top":false,"comment_ctime":1550046580,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1550046580","product_id":100020801,"comment_content":"难道没人遇到下面这个问题吗？The &#39;INFORMATION_SCHEMA.GLOBAL_STATUS&#39; feature is disabled;","like_count":0,"discussions":[{"author":{"id":1336169,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/dLSTGibVPxf3hZv0jDFGv83jK95VlagHZoia9DBcpkl0SEoFD19TjdGw7VDvP5qhK9ZNJ9cfpgT7PRtFtKBPaq3g/132","nickname":"麦颗斯","note":"","ucode":"21D545C9DCC7EF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302371,"discussion_content":"遇到了, 怎么回事\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598887627,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":64709,"user_name":"条","can_delete":false,"product_type":"c1","uid":1203836,"ip_address":"","ucode":"6F8679175256E3","user_header":"https://static001.geekbang.org/account/avatar/00/12/5e/7c/94af3f5e.jpg","comment_is_top":false,"comment_ctime":1548864824,"is_pvip":false,"replies":[{"id":"22910","content":"相比与以前的“邻居机制”，确实随机概率更大<br><br>不过现在iops是好多了","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1548908021,"ip_address":"","comment_id":64709,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548864824","product_id":100020801,"comment_content":"老师，只刷自己的脏页的时候，对磁盘的操作是随机io吗？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438145,"discussion_content":"相比与以前的“邻居机制”，确实随机概率更大\n\n不过现在iops是好多了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548908021,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61541,"user_name":"Aurora","can_delete":false,"product_type":"c1","uid":1302157,"ip_address":"","ucode":"84CB75BC2D7680","user_header":"https://static001.geekbang.org/account/avatar/00/13/de/8d/99536c5b.jpg","comment_is_top":false,"comment_ctime":1547718899,"is_pvip":false,"replies":[{"id":"21987","content":"“innodb认为你的磁盘很慢，刷脏频率就会较高，来保证内存中的脏页比例较少”<br>相反哦，如果配置得小，刷得就慢的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547962651,"ip_address":"","comment_id":61541,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547718899","product_id":100020801,"comment_content":"我的理解是：<br>一、什么情况下会触发刷脏页：<br>1、如果redo log file 设置的比较小，或者组的个数较少，而如果DB繁忙，此时innodb 写入redo log file的速度很快，速度快到checkpoint 还没来得及将redo log  file中对应的脏页刷到数据文件，就已经循环一遍，需要新的空间写入新的redo log，此时mysql 就会停止响应，强制进行脏页flush，推进checkpoint，进而可以将相应redo log中的内容安全覆盖掉。<br>2、当一个大的select\\update需要查询或者更新的page数超过了当前buffer pool中的可用空闲page的时候，就需要淘汰一些内存中的page(LRU算法),如果被淘汰的page是脏页，就会触发脏页flush。<br><br>二、关于innodb_io_capacity参数，<br>innodb首先通过innodb_io_capacity参数了解你磁盘的IO能力，该值建议设置成磁盘的Write IOPS。当这个值设置较小的时候，innodb认为你的磁盘很慢，刷脏频率就会较高，来保证内存中的脏页比例较少，当这个值设置较大的时候，innodb认为你的磁盘IO能力较强，刷脏频率就会降低，进而出现抖动的概率就会少很多。 不知道这个理解是否正确","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436905,"discussion_content":"“innodb认为你的磁盘很慢，刷脏频率就会较高，来保证内存中的脏页比例较少”\n相反哦，如果配置得小，刷得就慢的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547962651,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":59089,"user_name":"杰哥长得帅","can_delete":false,"product_type":"c1","uid":1241993,"ip_address":"","ucode":"5A7FD1794F62D7","user_header":"https://static001.geekbang.org/account/avatar/00/12/f3/89/fcfecb46.jpg","comment_is_top":false,"comment_ctime":1547299108,"is_pvip":false,"replies":[{"id":"21375","content":"内存里有标志位的<br>跟change buffer无关哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547309446,"ip_address":"","comment_id":59089,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547299108","product_id":100020801,"comment_content":"想请教一下老师innodb如何判断一个内存页是脏页还是干净页呢？通过change buffer吗","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436296,"discussion_content":"内存里有标志位的\n跟change buffer无关哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547309446,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55347,"user_name":"金龟","can_delete":false,"product_type":"c1","uid":1228500,"ip_address":"","ucode":"1C7D35C8AE8D9D","user_header":"https://static001.geekbang.org/account/avatar/00/12/be/d4/ff1c1319.jpg","comment_is_top":false,"comment_ctime":1546140665,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546140665","product_id":100020801,"comment_content":"io capacity 20000是指什么😊，不太懂","like_count":0},{"had_liked":false,"id":54609,"user_name":"茫农","can_delete":false,"product_type":"c1","uid":1206365,"ip_address":"","ucode":"71F7143644C9CB","user_header":"https://static001.geekbang.org/account/avatar/00/12/68/5d/1ccee378.jpg","comment_is_top":false,"comment_ctime":1545913747,"is_pvip":false,"replies":[{"id":"19846","content":"不会，会写到磁盘的redolog 文件上","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545961942,"ip_address":"","comment_id":54609,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545913747","product_id":100020801,"comment_content":"如果redo log放不下在RR事务级别下需要保存的记录，会导致事务失败回滚？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434510,"discussion_content":"不会，会写到磁盘的redolog 文件上","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545961942,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54313,"user_name":"运斤成风","can_delete":false,"product_type":"c1","uid":1350812,"ip_address":"","ucode":"BAFF69C29FDFA5","user_header":"https://static001.geekbang.org/account/avatar/00/14/9c/9c/e02a0daf.jpg","comment_is_top":false,"comment_ctime":1545826623,"is_pvip":false,"replies":[{"id":"19683","content":"每个数据页的lsn不同的，表示“更新这个page的最后一个lab”, 不需要相同","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545832166,"ip_address":"","comment_id":54313,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545826623","product_id":100020801,"comment_content":"老师好，每个数据页上都有Lsn，数据库运行时数据页上的lsn应该是千差万别的吧？若是数据库正常关闭，然后重新启动，这是所有数据页的lsn是一致的？还是保持数据库关闭时千差万别的？谢谢","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434423,"discussion_content":"每个数据页的lsn不同的，表示“更新这个page的最后一个lab”, 不需要相同","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545832166,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54058,"user_name":"蚂蚁内推+v","can_delete":false,"product_type":"c1","uid":1050508,"ip_address":"","ucode":"24B10AEE54B3FD","user_header":"https://static001.geekbang.org/account/avatar/00/10/07/8c/0d886dcc.jpg","comment_is_top":false,"comment_ctime":1545790275,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545790275","product_id":100020801,"comment_content":"假如现在有内存页A、B、C三个，现在innodb进行了四次写入，第一次：写入A，此时LSN为LSNA，第二次：写入B，此时LSN为LSNB，第三次写入A：此时LSN为LSNA2，第四次写入C，此时LSN为LSNC。这个时候，又来了一次写入请求，此时内存不足，需要将一个脏页写入磁盘，根据LRU策略，淘汰B，将B写入磁盘。<br>系统记录了4个日志相关的信息，用于其它各种处理使用：<br>Log sequence number（LSN1）：当前系统LSN最大值，新的事务日志LSN将在此基础上生成（LSN1+新日志的大小）；<br>Log flushed up to（LSN2）：当前已经写入日志文件的LSN；<br>Pages flushed up to（LSN3）：当前最旧的脏页数据对应的LSN，写Checkpoint的时候直接将此LSN写入到日志文件；<br>Last checkpoint at（LSN4）：当前已经写入Checkpoint的LSN；<br>问题：<br>1. 现在A有两个LSN：LSNA和LSNA2，只会保留LSNA2吗？<br>2. 将B写入磁盘后，会更新Log flushed up to（LSN2）这个值吗？如果更新这个值为LSNB的话，那redolog重放的时候，LSNA这个做的修改就被跳过了，就会丢失数据。如果不更新，那redolog重放，LSNB就会被重复执行。redolog这部分是怎么保证的呢？<br>3. 将B写入磁盘后，如果更新Log flushed up to（LSN2）这个值，那么是先更新再将B写入，还是先将B写入再更新呢？如果是前者，加入B写入磁盘出错了，LSN2又更新了，redolog不会重放LSNB的结果，这样会丢失数据。如果是后者，B已经写入了，但没有更新LSN2，此时断电异常，那么redolog回放，B会再写入一次，脏页和redolog都是记录的+9这样的数据，再写入一次岂不是数据不一致？","like_count":0},{"had_liked":false,"id":53497,"user_name":"alias cd=rm -rf","can_delete":false,"product_type":"c1","uid":1318325,"ip_address":"","ucode":"E7B27D76305B75","user_header":"https://static001.geekbang.org/account/avatar/00/14/1d/b5/971261fd.jpg","comment_is_top":false,"comment_ctime":1545657665,"is_pvip":false,"replies":[{"id":"19390","content":"对的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545661571,"ip_address":"","comment_id":53497,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545657665","product_id":100020801,"comment_content":"思考题答案：在更新频繁的业务中，redolog写满，导致频繁触发flush脏页，影响tps。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434157,"discussion_content":"对的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545661571,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52795,"user_name":"梦想","can_delete":false,"product_type":"c1","uid":1286059,"ip_address":"","ucode":"71DE16FC85D868","user_header":"https://static001.geekbang.org/account/avatar/00/13/9f/ab/1b0dfa68.jpg","comment_is_top":false,"comment_ctime":1545531265,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545531265","product_id":100020801,"comment_content":"请问老师内存有变化是什么环节同步到redolog里的？是每一次语句更新，还是事务提交的时候？","like_count":0},{"had_liked":false,"id":52735,"user_name":"三木禾","can_delete":false,"product_type":"c1","uid":1109458,"ip_address":"","ucode":"39C37228236860","user_header":"https://static001.geekbang.org/account/avatar/00/10/ed/d2/e3ae7ddd.jpg","comment_is_top":false,"comment_ctime":1545490075,"is_pvip":false,"replies":[{"id":"19175","content":"就是io_capacit不要设置太小。<br><br>如果是磁盘性能问题导致checkpoinnt推进太慢，就得换磁盘了…","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545509876,"ip_address":"","comment_id":52735,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545490075","product_id":100020801,"comment_content":"老师，你的课程很仔细，很清晰，但是还有一个小问题，我们需要考虑的是内存脏页flush 速率，但是如何避免出现擦黑板，对应的是数据库的check point 移动造成的整个系统无法更新呢?","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433963,"discussion_content":"就是io_capacit不要设置太小。\n\n如果是磁盘性能问题导致checkpoinnt推进太慢，就得换磁盘了…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545509876,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52070,"user_name":"tc_song","can_delete":false,"product_type":"c1","uid":1042499,"ip_address":"","ucode":"E51763EB380B50","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e8/43/38f6f7a1.jpg","comment_is_top":false,"comment_ctime":1545305168,"is_pvip":false,"replies":[{"id":"18839","content":"是不是之前刚刚做了大量更新？或者近期做了大量更新，然后系统突然闲下来了？<br><br><br>","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545306872,"ip_address":"","comment_id":52070,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1545305168","product_id":100020801,"comment_content":"老师，我这边遇到一个问题，生产系统突然出现pager_cleaner了七百多秒，但是业务系统中应该没有大sql,slow log中也没有长sql记录，这个时候业务系统的查询全部被卡住，十几分钟后才执行完毕。这个是啥方面问题呢？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433729,"discussion_content":"是不是之前刚刚做了大量更新？或者近期做了大量更新，然后系统突然闲下来了？\n\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545306872,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1243369,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f8/e9/f16a536b.jpg","nickname":"极客-绝影","note":"","ucode":"D302CE68123E74","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":54767,"discussion_content":"老师言外之意是，这个时候系统正在flush脏页呢，你查询进来了，因此很慢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574313382,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51219,"user_name":"杰之7","can_delete":false,"product_type":"c1","uid":1297232,"ip_address":"","ucode":"F7DA2E21085332","user_header":"https://static001.geekbang.org/account/avatar/00/13/cb/50/66d0bd7f.jpg","comment_is_top":false,"comment_ctime":1545138347,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545138347","product_id":100020801,"comment_content":"通过这一节的阅读学习，让我们知道为什么有时候Mysql会抖，突然变慢，一段时间又恢复了。主要原因有二，redo log写满,内存不足。<br><br>正是由于这两种原因，就需要将内存的脏读flush到磁盘上，在在这个过程中，脏读太多，日志写满的时候就会影响到刷脏读的性能，InnoDB引擎会结合这两个因素计算出一个大的R%速度。","like_count":0},{"had_liked":false,"id":50251,"user_name":"Mr.Strive.Z.H.L","can_delete":false,"product_type":"c1","uid":1030198,"ip_address":"","ucode":"6D97E159E2EECD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b8/36/542c96bf.jpg","comment_is_top":false,"comment_ctime":1544933620,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544933620","product_id":100020801,"comment_content":"学习了本章，其实对一个工程细节比较好奇：<br>引擎就可以按照 innodb_io_capacity 定义的能力乘以 R% 来控制刷脏页的速度。<br>假设innodb_io_capacity  = 300，R% = 90%，那么最后的值为270。一个数据页是16K。那么控制刷盘的速率在具体实现的时候是如何结合 上面的270和数据页16K的呢？","like_count":0},{"had_liked":false,"id":50232,"user_name":"WL","can_delete":false,"product_type":"c1","uid":1173771,"ip_address":"","ucode":"6277DCD776B87E","user_header":"https://static001.geekbang.org/account/avatar/00/11/e9/0b/1171ac71.jpg","comment_is_top":false,"comment_ctime":1544929214,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544929214","product_id":100020801,"comment_content":"再请教一下老师, innodb_io_capacity 的值如果设置的是 300, 是指每秒钟最大刷到硬盘300个数据页吗?","like_count":0},{"had_liked":false,"id":50217,"user_name":"WL","can_delete":false,"product_type":"c1","uid":1173771,"ip_address":"","ucode":"6277DCD776B87E","user_header":"https://static001.geekbang.org/account/avatar/00/11/e9/0b/1171ac71.jpg","comment_is_top":false,"comment_ctime":1544927021,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544927021","product_id":100020801,"comment_content":"思考题: 因为redo设置的只有100M, 所以会经常出现“redo log 写满了，需要 flush 脏页”的情况, 所以可能导致数据库经常性的抖动. <br>想请教一下老师, 如何才能尽量避免“redo log 写满了，要 flush 脏页”的情况, 是需要评估数据库繁忙的时间段, 然后再预估繁忙时间段的数据量, 然后再根据这个数据量判断redo log的空间大小是否合适吗? 还是有什么其他更准确的办法呢?","like_count":0},{"had_liked":false,"id":50174,"user_name":"峰哥","can_delete":false,"product_type":"c1","uid":1301870,"ip_address":"","ucode":"CB0652D3EF49A1","user_header":"https://static001.geekbang.org/account/avatar/00/13/dd/6e/f3cfebc5.jpg","comment_is_top":false,"comment_ctime":1544885275,"is_pvip":false,"replies":[{"id":"18028","content":"Max只是用来控制 innodb_io_capacity的值不能设置超过这个值，真正生效的还是innodb_io_capacity","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544896965,"ip_address":"","comment_id":50174,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544885275","product_id":100020801,"comment_content":"用fio测了一下，iops 在1500左右，MySQL的innodb_io_capacity的缺省值为200，但还有一个参数是innodb_io_capacity_max的参数，值是2000。这种情况下，系统算正常吗？max参数是怎么算出来的？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432904,"discussion_content":"Max只是用来控制 innodb_io_capacity的值不能设置超过这个值，真正生效的还是innodb_io_capacity","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544896965,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49218,"user_name":"Sinyo","can_delete":false,"product_type":"c1","uid":1307297,"ip_address":"","ucode":"57B243E7AB86A5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJAibnPX9jW8kqLcIfibjic8GbkQkEUYyFKJkc39hZhibVlNrqwTjdLozkqibI2IwACd5YzofYickNxFnZg/132","comment_is_top":false,"comment_ctime":1544625269,"is_pvip":false,"replies":[{"id":"17651","content":"其实是一个概念","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544634381,"ip_address":"","comment_id":49218,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544625269","product_id":100020801,"comment_content":"老师，请问flush和purge的区别是什么？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432535,"discussion_content":"其实是一个概念","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544634381,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48983,"user_name":"Ryoma","can_delete":false,"product_type":"c1","uid":1130590,"ip_address":"","ucode":"7F692369239692","user_header":"https://static001.geekbang.org/account/avatar/00/11/40/5e/b8fada94.jpg","comment_is_top":false,"comment_ctime":1544585185,"is_pvip":true,"discussion_count":0,"race_medal":2,"score":"1544585185","product_id":100020801,"comment_content":"如果redo log也是+9，那原图中的19是不是有问题呢","like_count":0},{"had_liked":false,"id":48940,"user_name":"Leon📷","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1544580141,"is_pvip":false,"replies":[{"id":"17571","content":"淘汰脏页是常态，一般不多就还好","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544582919,"ip_address":"","comment_id":48940,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544580141","product_id":100020801,"comment_content":"fush脏页是略过redo-log，直接到磁盘，算是把mysql逼急的应急状态吧，正常情况下还是后台线程慢条斯理的慢慢从redo-log同步到磁盘","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432428,"discussion_content":"淘汰脏页是常态，一般不多就还好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544582919,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48935,"user_name":"Leon📷","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1544579656,"is_pvip":false,"replies":[{"id":"17559","content":"前面这个描述不好，容易造成误解。 redo log不是脏页的镜像，当数据页是脏页的时候，redo log 其实是 “磁盘页到内存页的diff”","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544581758,"ip_address":"","comment_id":48935,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1544579656","product_id":100020801,"comment_content":"老师，是否可以理解redo_log就是内存buffer-pool的脏页的高速缓存，redo-log就是脏页的镜像，一荣俱荣一损俱损，最终也就是要高速缓存的数据刷新到磁盘。所谓后台的线程刷新其实还是把redo-log的操作还原成数据，然后写进ibd，所谓抖了一下，就是buffer-pool一抖带着redo-log一起抖，连带着磁盘也跟着有刷新动作","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432425,"discussion_content":"前面这个描述不好，容易造成误解。 redo log不是脏页的镜像，当数据页是脏页的时候，redo log 其实是 “磁盘页到内存页的diff”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544581758,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1066342,"avatar":"https://static001.geekbang.org/account/avatar/00/10/45/66/5169b669.jpg","nickname":"cxlblm","note":"","ucode":"D6D6A1EFD580E3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5827,"discussion_content":"感觉老师的这个说法，跟回答前面的同学的， redo中记录的是+9这个说法矛盾呀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566475032,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48700,"user_name":"风萧雨瑟","can_delete":false,"product_type":"c1","uid":1317323,"ip_address":"","ucode":"5E832ABE126393","user_header":"https://static001.geekbang.org/account/avatar/00/14/19/cb/70a2b47e.jpg","comment_is_top":false,"comment_ctime":1544518567,"is_pvip":false,"replies":[{"id":"17476","content":"你fio工具测试一下放redolog的盘，分别测试一下随机写性能和顺序写性能","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544523513,"ip_address":"","comment_id":48700,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544518567","product_id":100020801,"comment_content":"老师帮忙分析一个问题：<br>刚搭建的一个新的从库，没有负载，机器规格和参数都是和其它从库一样的。但其从库系统是centos6.有问题这台是centos7。innodb_flush_log_at_trx_commit 当值设置为1的时候(其它从库正常)，复制延迟增大，iostat查看结果如下：<br>Device            r&#47;s     w&#47;s     rMB&#47;s     wMB&#47;s   rrqm&#47;s   wrqm&#47;s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util<br>sda1             4.50  369.00      0.07      3.80     0.00     0.00   0.00   0.00    1.67    0.77   0.29    16.00    10.54   0.70  26.05<br>其它正常的从库：<br>Device:         rrqm&#47;s   wrqm&#47;s     r&#47;s     w&#47;s    rMB&#47;s    wMB&#47;s avgrq-sz avgqu-sz   await  svctm  %util<br>sda1              0.00     0.00   18.00  451.50     0.28     4.60    21.31     0.08    0.17   0.12   5.65<br>但当innodb_flush_log_at_trx_commit 设置为2的时候就正常了。  ssd为独占。 fio测试硬盘iops与其它从库区别不大。机器上两块硬盘，data目录换到另一块上，问题一样。<br>通过perf分析信息片断：<br>-  100.00%     0.00%  mysqld   libpthread-2.17.so   [.] start_thread <br>- start_thread <br>- 63.21% io_handler_thread <br>- 63.21% fil_aio_wait<br>- 45.23% os_aio_handler<br>- 28.35% os_file_write_page <br> - 25.05% 0xf0c3 <br>- 25.05% system_call_fastpath <br> - 25.05% sys_pwrite64 <br> - 25.05% vfs_write <br> - 25.05% do_sync_write<br> - 18.44% xfs_file_aio_write <br> - 18.44% xfs_file_dio_aio_write<br> - 18.44% __blockdev_direct_IO<br> - 18.44% do_blockdev_direct_IO<br> - 7.11% io_schedule<br>- io_schedule_timeout <br> - 7.11% schedule_timeout<br>- 7.11% schedule <br> - 7.11% __schedule<br> - 4.17% deactivate_task<br> - 4.17% dequeue_task <br> - 4.17% dequeue_task_fair <br>   4.17% dequeue_entity <br> - 2.94% call_function_single_interrupt<br>- 2.94% smp_call_function_single_interrupt<br>irq_exit<br>do_softirq <br>call_softirq <br>__do_softirq<br>rebalance_domains<br>top信息<br>%Cpu19 :  3.4 us,  2.0 sy,  0.0 ni, 58.4 id, 36.2 wa,  0.0 hi,  0.0 si,  0.0 st<br>PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND<br> 111111 mysql     20   0   21.4g  17.9g  15020 S  17.2 28.7   4538:15 mysqld<br>通过这些看的话象是卡在写这。但参数值不一样，差别很大。innodb方面参数如下：<br>read_io_threads&#47;write_io_threads  = 12<br>io_capacity = 4000<br>thread_concurrency  = 48<br>commit_concurrency= 48<br>flush_neighbors = 0<br>flush_method=O_DIRECT<br>purge_threads=4<br>请老师指点怎么排查<br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432316,"discussion_content":"你fio工具测试一下放redolog的盘，分别测试一下随机写性能和顺序写性能","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544523513,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48580,"user_name":"算不出流源","can_delete":false,"product_type":"c1","uid":1178209,"ip_address":"","ucode":"B6CFEF672E3E1C","user_header":"https://static001.geekbang.org/account/avatar/00/11/fa/61/691e2936.jpg","comment_is_top":false,"comment_ctime":1544491293,"is_pvip":false,"replies":[{"id":"17413","content":"会的，文中说的算io_capcity*R% 就算控制后台刷的速度的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544501065,"ip_address":"","comment_id":48580,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544491293","product_id":100020801,"comment_content":"老师，请问check point何时会推进？难道是只有在redo log写满时或者停止mysql的时候才会推进，而平时innodb后台刷脏页的时候并不会推进吗？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432257,"discussion_content":"会的，文中说的算io_capcity*R% 就算控制后台刷的速度的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544501065,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48565,"user_name":"天王","can_delete":false,"product_type":"c1","uid":1239337,"ip_address":"","ucode":"C074B2F9A5F007","user_header":"https://static001.geekbang.org/account/avatar/00/12/e9/29/629d9bb0.jpg","comment_is_top":false,"comment_ctime":1544489347,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544489347","product_id":100020801,"comment_content":"1redo log满了和内存不够了，都会触发脏页flush到磁盘。脏页和干净页区别，是否刷新到磁盘。relog 满了，会checkpoint，停止更新操作，把脏页刷到磁盘。内存不足也会把很久不使用的刷新到磁盘，如果里面包括有脏页，要触发flush操作。后台有一个线程专门做刷脏页的工作，是根据设置的比例来刷的。内存刷脏页，redo log会打上刷过的标记。relog刷脏页，内存中也会把脏页标记为干净页。","like_count":0},{"had_liked":false,"id":48557,"user_name":"天王","can_delete":false,"product_type":"c1","uid":1239337,"ip_address":"","ucode":"C074B2F9A5F007","user_header":"https://static001.geekbang.org/account/avatar/00/12/e9/29/629d9bb0.jpg","comment_is_top":false,"comment_ctime":1544488233,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544488233","product_id":100020801,"comment_content":"增删改操作会变慢。因为redo log设置比较小，容易满，满了会checkpoint，寻找新的空间，频繁的把redo log的数据刷到磁盘。checkpoint的时候会停止更新操作，所以会变慢","like_count":0},{"had_liked":false,"id":48511,"user_name":"黄智荣","can_delete":false,"product_type":"c1","uid":1027823,"ip_address":"","ucode":"3C84C8654CCB11","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ae/ef/cbb8d881.jpg","comment_is_top":false,"comment_ctime":1544457299,"is_pvip":false,"replies":[{"id":"17418","content":"其实这里意思是，“用了好机器”😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544501332,"ip_address":"","comment_id":48511,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544457299","product_id":100020801,"comment_content":"&quot;一个内存配置为 128GB、innodb_io_capacity 设置为 20000 的大规格实例，正常会建议你将 redo log 设置成 4 个 1GB 的文件。&quot;<br>&quot;redo log 设置成 4 个 1GB 的文件&quot;，这个建议是怎么算出来的？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432218,"discussion_content":"其实这里意思是，“用了好机器”😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544501332,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48473,"user_name":"斜面镜子 Bill","can_delete":false,"product_type":"c1","uid":1305242,"ip_address":"","ucode":"B5505F94540D52","user_header":"https://static001.geekbang.org/account/avatar/00/13/ea/9a/02d589f9.jpg","comment_is_top":false,"comment_ctime":1544450208,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544450208","product_id":100020801,"comment_content":"要分业务场景来看<br>1. 如果业务以写为主或者读写流量差不多，因为读cache相对较大，我理解会频繁出现因日志写满，更新全部堵住，写性能跌为 0的情况<br>2. 如果以读为主，我理解redo_log本身设置小并没有明显的影响<br>","like_count":0},{"had_liked":false,"id":48406,"user_name":"梁中华","can_delete":false,"product_type":"c1","uid":1006789,"ip_address":"","ucode":"52FE40242CBAD0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5c/c5/1231d633.jpg","comment_is_top":false,"comment_ctime":1544437265,"is_pvip":true,"replies":[{"id":"17299","content":"也不会马上就前移动哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544440450,"ip_address":"","comment_id":48406,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1544437265","product_id":100020801,"comment_content":"接着Tony Du的问题讨论，脏页被淘汰的时候，只是redo log上checkpoint指针前移，应该不存在redo log随机读写的问题。","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432164,"discussion_content":"也不会马上就前移动哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544440450,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48402,"user_name":"Bennet","can_delete":false,"product_type":"c1","uid":1022801,"ip_address":"","ucode":"C85C47A75BA412","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIXYib4bOBtUeLniaqjMNaOY4gDPPbL4hYmv1HYHSPibyHVQlAeWhabABIy0YL7qgOqaa8EibxGSoiaw1w/132","comment_is_top":false,"comment_ctime":1544436269,"is_pvip":false,"replies":[{"id":"17305","content":"Flush 和 mvcc不能放一起说哈，不一样的。<br>每一行存了一个位置可以直接找到undo log, 这个MVCC的基础<br><br>Redolog里面记录了“这是哪个页面的修改”","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544445105,"ip_address":"","comment_id":48402,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544436269","product_id":100020801,"comment_content":"老师，一直有个疑问：看了这几期的文章，我理解 redolog 和 undolog 是在有数据更新时同时写的，redolog 作为 crash-safe 机制，每次全部读入做恢复就好。但是像在做脏页flush 或者 mvcc版本回退的时候，难道是按照涉及的数据行来定位日志行的吗？如果是，是怎么做到这种“定位”的呢？如果不是，InnoDB 的机制又是怎样的？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432163,"discussion_content":"Flush 和 mvcc不能放一起说哈，不一样的。\n每一行存了一个位置可以直接找到undo log, 这个MVCC的基础\n\nRedolog里面记录了“这是哪个页面的修改”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544445105,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48400,"user_name":"csoulsi","can_delete":false,"product_type":"c1","uid":1227336,"ip_address":"","ucode":"96C9BBE9097FB3","user_header":"https://static001.geekbang.org/account/avatar/00/12/ba/48/c892a35b.jpg","comment_is_top":false,"comment_ctime":1544436050,"is_pvip":true,"replies":[{"id":"17300","content":"1. 不会触发,不需要触发的<br><br>2. 内存中","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544440750,"ip_address":"","comment_id":48400,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544436050","product_id":100020801,"comment_content":"老师，我又把第02看了一遍<br>有个疑问：<br>根据WAL机制，当记录需要更新时，先写redo，然后更新内存，生成脏页，这时候更新就算完成，之后在空闲时刷脏页到磁盘。<br>1.那么一个含有update的事务，在执行commit时，是不是就触发刷脏页的操作？<br>2.如果事务中，先update，后select，最后commit；那么update生成脏页，还未刷磁盘，select读到更新之后的数据，是从哪儿读？<br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432162,"discussion_content":"1. 不会触发,不需要触发的\n\n2. 内存中","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544440750,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48390,"user_name":"慕塔","can_delete":false,"product_type":"c1","uid":1302106,"ip_address":"","ucode":"5C6C668C1106A5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/A94RKUfWfwzRzb68T9xskctQ43TBgXSBIL78p0N0ria2tQxmsTTJebYmefhkbHK7zwpoxokxs43UxpgDTdwm5tg/132","comment_is_top":false,"comment_ctime":1544434021,"is_pvip":false,"replies":[{"id":"17301","content":"是，但是如果你数据和压力跑起来,很快就OOM了","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544440819,"ip_address":"","comment_id":48390,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544434021","product_id":100020801,"comment_content":"再请教另一个问题啊 机器内存是16G,将设置为nnodb_buffer_pool_size=100G，竟然能启动成功！！！我记得bp在系统启动的时候是事先分配好的啊 ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432159,"discussion_content":"是，但是如果你数据和压力跑起来,很快就OOM了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544440819,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48351,"user_name":"没时间了ngu","can_delete":false,"product_type":"c1","uid":1311334,"ip_address":"","ucode":"9629BB85E8BB5D","user_header":"https://static001.geekbang.org/account/avatar/00/14/02/66/4ab9225e.jpg","comment_is_top":false,"comment_ctime":1544427070,"is_pvip":false,"replies":[{"id":"17259","content":"那个（11）不是长度的意思… int 固定四个字节的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544430277,"ip_address":"","comment_id":48351,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544427070","product_id":100020801,"comment_content":"老师好，小白请教下：<br>    上述201100001一共9位数字，Int，4位就可以存储，是因为2^31-1=2147483647 ，这个能理解。<br>    但是，Int设置了大于4位的长度，最大值还是这个值。假如长度设置11， 和长度4位感觉没区别呀。<br>   请问，是Int本身的机制还是怎么回事呀?","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432143,"discussion_content":"那个（11）不是长度的意思… int 固定四个字节的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544430277,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48313,"user_name":"慕塔","can_delete":false,"product_type":"c1","uid":1302106,"ip_address":"","ucode":"5C6C668C1106A5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/A94RKUfWfwzRzb68T9xskctQ43TBgXSBIL78p0N0ria2tQxmsTTJebYmefhkbHK7zwpoxokxs43UxpgDTdwm5tg/132","comment_is_top":false,"comment_ctime":1544418800,"is_pvip":false,"replies":[{"id":"17261","content":"1. 一般建议是直接设置o_direct ，直接写文件<br>2. Fio带fsync就是直接落盘；<br>3. 你试下把物理机的双1改掉试试","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544430558,"ip_address":"","comment_id":48313,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544418800","product_id":100020801,"comment_content":"源码中有计算redo文件大小，有好几个阈值判断，以lsn的差值为判断依据，不同的阈值会导致同步异步checkpoint,同步异步刷脏页。如果page clean刷脏不足，太小会导致用户线程刷脏，single page flush，用户线程等待，频繁做checkpoint，sysbench的表现是tps掉的厉害。page clean优化点有很多，percona的优化不错，专门一个线程做lru链刷脏。<br>我想进一步问下啊，1.刷脏页是写os cache啊还是disk？2.再一个就是写redo，是不是也是调fil io先写os cache,然后调用fsync刷到disk，这两个接口也没看到是如何同步的(虽说都是在log_write_up_to下)，事务提交时，那个参数1又是如何保证redo落盘？好多接口没有返回值，看的有点晕😁 3.我在物理机和虚拟机下分别部署mysql(其他配置都一样，内存 cpu，测试环境)，虚拟机比物理机的tps(insert)高5倍，很不能理解啊😭大佬能指点不 谢谢！","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432123,"discussion_content":"1. 一般建议是直接设置o_direct ，直接写文件\n2. Fio带fsync就是直接落盘；\n3. 你试下把物理机的双1改掉试试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544430558,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48296,"user_name":"范永康","can_delete":false,"product_type":"c1","uid":1188703,"ip_address":"","ucode":"B3CD225F99D39C","user_header":"https://static001.geekbang.org/account/avatar/00/12/23/5f/c7246797.jpg","comment_is_top":false,"comment_ctime":1544413488,"is_pvip":false,"replies":[{"id":"17248","content":"不是说文件？文件肯定在磁盘","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544418501,"ip_address":"","comment_id":48296,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544413488","product_id":100020801,"comment_content":"redo log 固定大小，存在于什么位置：内存、磁盘或者缓存中？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432111,"discussion_content":"不是说文件？文件肯定在磁盘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544418501,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48260,"user_name":"Gavin","can_delete":false,"product_type":"c1","uid":1134148,"ip_address":"","ucode":"0C7C27BC2736B6","user_header":"https://static001.geekbang.org/account/avatar/00/11/4e/44/66450d97.jpg","comment_is_top":false,"comment_ctime":1544407060,"is_pvip":false,"replies":[{"id":"17236","content":"Undo log跟这文章中说的数据一样","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544412535,"ip_address":"","comment_id":48260,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544407060","product_id":100020801,"comment_content":"文章中说“InnoDB在处理更新语句的时候，只做了写日志这一个磁盘操作。这个日志叫做 redo log（重做日志）”，我想问下斌哥，undo log 的持久化时机是什么时候或者能详细说下 undo log 的刷新机制吗？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432092,"discussion_content":"Undo log跟这文章中说的数据一样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544412535,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48256,"user_name":"算不出流源","can_delete":false,"product_type":"c1","uid":1178209,"ip_address":"","ucode":"B6CFEF672E3E1C","user_header":"https://static001.geekbang.org/account/avatar/00/11/fa/61/691e2936.jpg","comment_is_top":false,"comment_ctime":1544406805,"is_pvip":false,"replies":[{"id":"17237","content":"只走一遍","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544412577,"ip_address":"","comment_id":48256,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544406805","product_id":100020801,"comment_content":"老师，请问同一个事务中有多条更新语句时，是每一条更新语句都走第2讲中说的写redo log prepare --&gt;binlog--&gt;redo log commit的步骤，还是整个事务只走一遍这个步骤？如果是每条语句各走一遍，也就是说redo log commit和事务的commit并不对应，那事务的整体性在redo log中是怎么体现的？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432089,"discussion_content":"只走一遍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544412577,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48223,"user_name":"hDEC2突变","can_delete":false,"product_type":"c1","uid":1203023,"ip_address":"","ucode":"8818FD527997D4","user_header":"https://static001.geekbang.org/account/avatar/00/12/5b/4f/22757cfb.jpg","comment_is_top":false,"comment_ctime":1544403692,"is_pvip":false,"replies":[{"id":"17159","content":"这个配置其实说的是“高配”😄<br>倒没有直接的关系<br><br>","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1544404527,"ip_address":"","comment_id":48223,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544403692","product_id":100020801,"comment_content":"一个内存配置为 128GB、innodb_io_capacity 设置为 20000 的大规格实例，正常会建议你将 redo log 设置成 4 个 1GB 的文件。<br>请问这三个参数的设置有某种计算关系么？您的这个推荐有没有对业务场景的考虑(比如读写比例等)","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432076,"discussion_content":"这个配置其实说的是“高配”😄\n倒没有直接的关系\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544404527,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48164,"user_name":"高枕","can_delete":false,"product_type":"c1","uid":1310312,"ip_address":"","ucode":"20F6CF75EC9AA4","user_header":"https://static001.geekbang.org/account/avatar/00/13/fe/68/e0bebd9a.jpg","comment_is_top":false,"comment_ctime":1544375762,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544375762","product_id":100020801,"comment_content":"早","like_count":0}]}