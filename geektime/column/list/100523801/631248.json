{"id":631248,"title":"15ï½œFormattingå®æˆ˜ï¼šå¦‚ä½•æ„å»ºä¸€ä¸ªæ•°æ®æµå¤„ç†å®ä¾‹ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å¢èª‰å£°ã€‚</p><p>C++20ä¸ºæˆ‘ä»¬å¸¦æ¥äº†é‡è¦çš„æ–‡æœ¬æ ¼å¼åŒ–æ ‡å‡†åº“æ”¯æŒã€‚é€šè¿‡Formattingåº“å’Œformatterç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°é«˜åº¦çµæ´»çš„æ–‡æœ¬æ ¼å¼åŒ–æ–¹æ¡ˆã€‚é‚£ä¹ˆï¼Œ<strong>æˆ‘ä»¬è¯¥å¦‚ä½•åœ¨å®é™…å·¥ç¨‹é¡¹ç›®ä¸­ä½¿ç”¨å®ƒå‘¢ï¼Ÿ</strong></p><p>æ—¥å¿—è¾“å‡ºåœ¨å®é™…å·¥ç¨‹é¡¹ç›®ä¸­æ˜¯ä¸€ä¸ªå¸¸è§éœ€æ±‚ï¼Œæ— è®ºæ˜¯è¿è¡Œè¿‡ç¨‹è®°å½•ï¼Œè¿˜æ˜¯é”™è¯¯è®°å½•ä¸å¼‚å¸¸è·Ÿè¸ªï¼Œéƒ½éœ€è¦ç”¨åˆ°æ—¥å¿—ã€‚</p><p>åœ¨è¿™ä¸€è®²ä¸­ï¼Œæˆ‘ä»¬ä¼šåŸºäºæ–°æ ‡å‡†å®ç°ä¸€ä¸ªæ—¥å¿—åº“ã€‚ä½ å¯ä»¥é‡ç‚¹å…³æ³¨ç‰¹åŒ–formatterç±»å‹çš„æ–¹æ³•ï¼Œå®ç°é«˜åº¦çµæ´»çš„æ ‡å‡†åŒ–å®šåˆ¶ã€‚</p><p>å¥½ï¼Œè¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬å°±ä»æ¶æ„è®¾è®¡å¼€å§‹ï¼Œä¸€æ­¥æ­¥å®ç°è¿™ä¸ªæ—¥å¿—åº“ï¼ˆè¯¾ç¨‹é…å¥—ä»£ç å¯ä»¥ä»<a href=\"https://github.com/samblg/cpp20-plus-indepth\">è¿™é‡Œ</a>è·å–ï¼‰ã€‚</p><h2>æ—¥å¿—åº“æ¶æ„è®¾è®¡</h2><p>äº‹å®ä¸Šï¼Œå®ç°ä¸€ä¸ªè¶³å¤Ÿçµæ´»çš„æ—¥å¿—åº“å¹¶ä¸å®¹æ˜“ã€‚åœ¨å®é™…å·¥ç¨‹é¡¹ç›®ä¸­ï¼Œæ—¥å¿—è¾“å‡ºä¸ä»…éœ€è¦æ”¯æŒè‡ªå®šä¹‰æ—¥å¿—çš„è¾“å‡ºæ ¼å¼ï¼Œè¿˜éœ€è¦æ”¯æŒä¸åŒçš„è¾“å‡ºç›®æ ‡ã€‚æ¯”å¦‚ï¼Œè¾“å‡ºåˆ°æ§åˆ¶å°ã€æ–‡ä»¶ï¼Œç”šè‡³æ˜¯ç½‘ç»œæµæˆ–è€…æ•°æ®åº“ç­‰ã€‚</p><p>Pythonå’ŒJavaè¿™ç±»ç°ä»£è¯­è¨€éƒ½æœ‰æˆç†Ÿçš„æ—¥å¿—åº“ä¸æ ‡å‡†æ¥å£ã€‚C++ Formattingçš„æ­£å¼æå‡ºï¼Œè®©æˆ‘ä»¬èƒ½ä½¿ç”¨ç®€æ´çš„æ–¹å¼å®ç°æ—¥å¿—åº“ã€‚</p><p>åŒæ—¶ï¼ŒPythonçš„loggingæ¨¡å—è®¾è®¡æ¯”è¾ƒä¼˜é›…ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å‚ç…§å®ƒçš„æ¶æ„ï¼Œè®¾è®¡äº†åŸºäºC++20çš„æ—¥å¿—æ¶æ„ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/ec/0c/ec3a90b1d84e98d8b5a50ca5e752370c.jpg?wh=2698x749\" alt=\"\"></p><p>é¡¹ç›®çš„æ¨¡å—å›¾æ˜¯åé¢è¿™æ ·ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/03/2d/03d1f3c199a25521cfd8258dd62e7c2d.jpg?wh=1637x1334\" alt=\"\"><br>\nå¯¹ç…§å›¾ç‰‡å¯ä»¥çœ‹åˆ°ï¼Œloggingæ¨¡å—æ˜¯å·¥ç¨‹çš„æ ¸å¿ƒï¼ŒåŒ…å«æ ¸å¿ƒæ¡†æ¶ã€handlerså’Œformattersä¸‰ä¸ªå­æ¨¡å—ã€‚</p><!-- [[[read_end]]] --><p>å…¶ä¸­ï¼Œæ ¸å¿ƒæ¡†æ¶åŒ…æ‹¬Levelã€Recordã€Formatterã€Handlerä¸Loggerçš„å®šä¹‰ã€‚ç”±äºæˆ‘ä»¬ä½¿ç”¨äº†æ¨¡ç‰ˆï¼Œå› æ­¤æ ¸å¿ƒæ¡†æ¶çš„å£°æ˜å®ç°éƒ½åœ¨å¤´æ–‡ä»¶ä¸­ã€‚å…·ä½“å«ä¹‰ä½ å¯ä»¥å‚è€ƒåé¢è¿™å¼ è¡¨ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/04/73/046a9b02dc550fd37b13503ef68fca73.jpg?wh=3374x1978\" alt=\"\"></p><p>ç”±äºæˆ‘ä»¬å…³æ³¨çš„é‡ç‚¹åœ¨äº<strong>å¦‚ä½•ä½¿ç”¨Formattingåº“</strong>å’Œ<strong>å¦‚ä½•ç‰¹åŒ–formatterç±»å‹</strong>ã€‚å› æ­¤ï¼Œå¯¹äºæ ¸å¿ƒæ¡†æ¶çš„å®šä¹‰å’Œå®ç°ï¼Œä½ å¯ä»¥å‚è€ƒå®Œæ•´çš„å·¥ç¨‹ä»£ç ã€‚</p><h2>æ—¥å¿—æ ¼å¼åŒ–å™¨æ¨¡å—</h2><p>ä»æ¨¡å—å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬åœ¨formattersæ¨¡å—ä¸­å®ç°äº†ä¸‰ç»„ä¸åŒçš„æ—¥å¿—æ ¼å¼åŒ–å™¨ã€‚æˆ‘ä»¬æ¥æ¯”è¾ƒä¸€ä¸‹ã€‚</p><p>é¦–å…ˆæ˜¯CFormatterï¼Œå®ƒæ˜¯Câ»›æ ¼æ ¼å¼åŒ–çš„æ—¥å¿—è¾“å‡ºã€‚å®ç°è¾ƒä¸ºç®€å•ï¼Œä½†æ˜¯å¦‚æœé˜…è¯»äº†ä»£ç ï¼Œä½ å°±å‘ç°è¿™ç§å®ç°æ–¹å¼éš¾ä»¥é¿å…ç±»å‹å’Œç¼“å†²åŒºå®‰å…¨é—®é¢˜ã€‚</p><p>StreamFormatteråˆ™æ˜¯C++æµâ»›æ ¼çš„æ—¥å¿—è¾“å‡ºã€‚åŸºäºC++æµçš„å®ç°ç›¸å¯¹äºCçš„å®ç°æ›´åŠ æ³¨é‡ç±»å‹å®‰å…¨ï¼Œå¹¶èƒ½å®Œå…¨é¿å…ç¼“å†²åŒºæº¢å‡ºã€‚ä½†æ˜¯ï¼Œè¿™ä¹ˆåšç¼–ç å¤æ‚ï¼Œä¹Ÿä¼šå½±å“æ•´ä½“ä»£ç çš„å¯è¯»æ€§ã€‚</p><p>æœ€åå°±æ˜¯ModernFormatterï¼Œå³C++20 formatçš„æ—¥å¿—è¾“å‡ºã€‚åŸºäºC++ Formattingåº“å’Œç‰¹åŒ–formatterå®ç°ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…·ä½“æ¥çœ‹ModernFormatterã€‚æ¥å£å®šä¹‰åœ¨include/logging/formatters/ModernFormatter.hä¸­ï¼Œä»£ç æ˜¯åé¢è¿™æ ·ã€‚</p><pre><code class=\"language-c++\">#pragma once\n&nbsp;\n#include &lt;string&gt;\n&nbsp;\nnamespace logging {\n&nbsp;&nbsp;&nbsp; class Record;\n&nbsp;\n&nbsp;&nbsp;&nbsp; namespace formatters::modern {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // formatRecordå‡½æ•°ç”¨äºæ ¼å¼åŒ–æ—¥å¿—è®°å½•å¯¹è±¡\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::string formatRecord(const logging::Record&amp; record);\n&nbsp;&nbsp;&nbsp; }\n}\n</code></pre><p>å…·ä½“å®ç°åœ¨src/logging/formatters/ModernFormatter.cppä¸­ã€‚</p><pre><code class=\"language-c++\">#include \"logging/formatters/ModernFormatter.h\"\n#include \"logging/Record.h\"\n&nbsp;\nnamespace logging::formatters::modern {\n&nbsp;&nbsp;&nbsp; // formatRecordï¼šå°†Recordå¯¹è±¡æ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²\n&nbsp;&nbsp;&nbsp; std::string formatRecord(const Record&amp; record) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return std::format(\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \"{0:&lt;16}| [{1}] {2:%Y-%m-%d}T{2:%H:%M:%OS}Z - {3}\",\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; record.name,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; record.getLevelName(),\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; record.time,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; record.message\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; );\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; } catch (std::exception&amp; e) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::cerr &lt;&lt; \"Error in format: \" &lt;&lt; e.what() &lt;&lt; std::endl;\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return \"\";\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\n&nbsp;&nbsp;&nbsp; }\n}\n</code></pre><p>è¿™ç§æ–¹æ¡ˆå…·æœ‰ä¸‰ä¸ªä¼˜ç‚¹ã€‚</p><p>ç¬¬ä¸€ï¼Œformatå†…ç½®å¯¹C++11çš„æ—¶é—´ç‚¹å¯¹è±¡çš„ç›´æ¥æ ¼å¼åŒ–ã€‚åœ¨C++20ä¸­ï¼Œç”±äºchronoæä¾›äº†é’ˆå¯¹time_pointç±»å‹çš„formatterã€‚å› æ­¤ï¼Œç›¸æ¯”å…¶ä»–çš„æ–¹æ¡ˆï¼Œè¿™ç§æ–¹æ¡ˆå¯¹æ—¶é—´çš„æ ¼å¼åŒ–è¦ç®€å•æ¸…æ™°å¾—å¤šã€‚</p><p>ç¬¬äºŒï¼Œformatä¸éœ€è¦åƒCæ–¹æ¡ˆé‚£æ ·æå‰åˆ†é…ç¼“å†²åŒºï¼Œå› æ­¤å¯ä»¥é¿å…ç¼“å†²åŒºæº¢å‡ºã€‚</p><p>ç¬¬ä¸‰ï¼Œformatå¯ä»¥è‡ªåŠ¨æ ¹æ®å‡½æ•°å‚æ•°ç±»å‹ï¼Œç¡®å®šæ ¼å¼åŒ–çš„å‚æ•°ç±»å‹ã€‚å®ƒä¸éœ€è¦å®Œå…¨æ ¹æ®æ ¼å¼åŒ–å­—ç¬¦ä¸²åˆ¤å®šå‚æ•°ç±»å‹ï¼Œå¦‚æœæ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­çš„ç±»å‹ä¸å®é™…å‚æ•°ç±»å‹ä¸åŒï¼Œä¹Ÿèƒ½åœ¨è¿è¡Œæ—¶æ£€æŸ¥å‡ºæ¥å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚æˆ‘ä»¬åœ¨ä»£ç ä¸­æ•è·äº†ç›¸å…³å¼‚å¸¸ï¼Œå‘ç”Ÿé”™è¯¯æ—¶ï¼Œä½ å¯ä»¥æ ¹æ®å…·ä½“éœ€æ±‚æ¥å¤„ç†å¼‚å¸¸ã€‚</p><p>æ€»ä¹‹ï¼Œé‡‡ç”¨C++ Formattingå®ç°çš„æ–‡æœ¬æ ¼å¼åŒ–å™¨éå¸¸ç®€å•ã€‚ä¸è¿‡è¯è¯´å›æ¥ï¼Œæ ¼å¼åŒ–æ–‡æœ¬è¿™ä»¶äº‹æœ¬æ¥å°±è¯¥å¦‚æ­¤è½»æ¾æƒ¬æ„ï¼Œä¸æ˜¯å—ï¼Ÿ</p><h2>æ—¥å¿—è®°å½•å™¨æ¨¡å—</h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬æ¥çœ‹å¦ä¸€ä¸ªé‡ç‚¹â€”â€”æ—¥å¿—è®°å½•å™¨æ¨¡å—ã€‚æ—¥å¿—è®°å½•å™¨æ˜¯æä¾›ç»™ç”¨æˆ·çš„æ¥å£ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡æ—¥å¿—è®°å½•å™¨æäº¤æ—¥å¿—ã€‚ä½ å¯ä»¥å…ˆçœ‹çœ‹ä»£ç å®ç°ï¼Œå†å¬æˆ‘è®²è§£ã€‚</p><pre><code class=\"language-c++\">#pragma once\n&nbsp;\n#include &lt;iostream&gt;\n#include &lt;string&gt;\n#include &lt;tuple&gt;\n#include &lt;memory&gt;\n#include \"logging/Level.h\"\n#include \"logging/Handler.h\"\n#include \"logging/handlers/DefaultHandler.h\"\n&nbsp;\nnamespace logging {\n&nbsp;&nbsp;&nbsp; // Loggerç±»å®šä¹‰\n&nbsp;&nbsp;&nbsp; // Levelæ˜¯æ—¥å¿—è®°å½•å™¨çš„æ—¥å¿—ç­‰çº§\n&nbsp;&nbsp;&nbsp; // HandlerTypesæ˜¯æ‰€æœ‰æ³¨å†Œçš„æ—¥å¿—å¤„ç†å™¨ï¼Œå¿…é¡»æ»¡è¶³Handlerçº¦æŸ\n&nbsp;&nbsp;&nbsp; // é€šè¿‡requiresè¦æ±‚æ¯ä¸ªLoggerç±»å¿…é¡»æ³¨å†Œè‡³å°‘ä¸€ä¸ªæ—¥å¿—å¤„ç†å™¨\n&nbsp;&nbsp;&nbsp; template &lt;Level loggerLevel, Handler... HandlerTypes&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; requires(sizeof...(HandlerTypes) &gt; 0)\n&nbsp;&nbsp;&nbsp; class Logger {\n&nbsp;&nbsp;&nbsp; public:\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // HandlerCountï¼šæ—¥å¿—è®°å½•å™¨æ•°é‡ï¼Œé€šè¿‡sizeof...è·å–æ¨¡æ¿å‚æ•°ä¸­ä¸å®šå‚æ•°çš„æ•°é‡\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; static constexpr int32_t HandlerCount = sizeof...(HandlerTypes);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // LoggerLevelï¼šLoggerçš„æ—¥å¿—ç­‰çº§\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; static constexpr Level LoggerLevel = loggerLevel;\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // æ„é€ å‡½æ•°ï¼šnameä¸ºæ—¥å¿—è®°å½•å™¨åç§°ï¼ŒattachedHandlersæ˜¯éœ€è¦æ³¨å†Œåˆ°Loggerå¯¹è±¡ä¸­çš„æ—¥å¿—å¤„ç†å™¨\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // ç”±äºæ—¥å¿—å¤„ç†å™¨ä¹Ÿä¸å…è®¸æ‹·è´ï¼Œåªå…è®¸ç§»åŠ¨ï¼Œæ‰€ä»¥è¿™é‡Œé‡‡ç”¨çš„æ˜¯å…ƒç»„çš„ç§»åŠ¨æ„é€ å‡½æ•°\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Logger(const std::string&amp; name, std::tuple&lt;HandlerTypes...&gt;&amp;&amp; attachedHandlers) :\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // è°ƒç”¨std::forwardè½¬å‘å³å€¼å¼•ç”¨\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _name(name), _attachedHandlers(std::forward&lt;std::tuple&lt;HandlerTypes...&gt;&gt;(attachedHandlers)) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // ä¸å…è®¸æ‹·è´\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Logger(const Logger&amp;) = delete;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // ä¸å…è®¸èµ‹å€¼\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Logger&amp; operator=(const Logger&amp;) = delete;\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // ç§»åŠ¨æ„é€ å‡½æ•°ï¼šå…è®¸æ—¥å¿—è®°å½•å™¨å¯¹è±¡ä¹‹é—´ç§»åŠ¨\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Logger(Logger&amp;&amp; rhs) :\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _name(std::move(rhs._name)), _attachedHandlers(std::move(rhs._attachedHandlers)) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // logï¼šé€šç”¨æ—¥å¿—è¾“å‡ºæ¥å£\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // éœ€è¦é€šè¿‡æ¨¡æ¿å‚æ•°æŒ‡å®šè¾“å‡ºçš„æ—¥å¿—ç­‰çº§\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // é€šè¿‡requiresçº¦æŸä¸¢å¼ƒæ¯”æ—¥å¿—è®°å½•å™¨è®¾å®šç­‰çº§è¦ä½çš„æ—¥å¿—\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // é¿å…è¿è¡Œæ—¶é€šè¿‡ifåˆ¤æ–­\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; template &lt;Level level&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; requires (level &gt; loggerLevel)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Logger&amp; log(const std::string&amp; message) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return *this;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // é€šè¿‡requiresçº¦æŸæäº¤ç­‰çº§ä¸ºæ—¥å¿—è®°å½•å™¨è®¾å®šç­‰çº§åŠä»¥ä¸Šçš„æ—¥å¿—\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; template &lt;Level level&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; requires (level &lt;= loggerLevel)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Logger&amp; log(const std::string&amp; message) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // æ„é€ Recordå¯¹è±¡\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Record record{\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .name = _name,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .level = level,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .time = std::chrono::system_clock::now(),\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; .message = message,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; };\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // è°ƒç”¨handleLogå®é™…å¤„ç†æ—¥å¿—è¾“å‡º\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; handleLog&lt;level, HandlerCount - 1&gt;(record);\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return *this;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // handleLogï¼šå°†æ—¥å¿—è®°å½•æäº¤ç»™æ‰€æœ‰æ³¨å†Œçš„æ—¥å¿—å¤„ç†å™¨\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // messageLevelä¸ºæäº¤çš„æ—¥å¿—ç­‰çº§\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // handlerIndexä¸ºæ—¥å¿—å¤„ç†å™¨çš„æ³¨å†Œåºå·\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // é€šè¿‡requiresçº¦æŸå½“handlerIndex &gt; 0æ—¶ä¼šé€’å½’è°ƒç”¨handleLogå°†æ¶ˆæ¯åŒæ—¶æäº¤ç»™å‰ä¸€ä¸ªæ—¥å¿—å¤„ç†å™¨\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; template &lt;Level messageLevel, int32_t handlerIndex&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; requires (handlerIndex &gt; 0)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; void handleLog(const Record&amp; record) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // é€’å½’è°ƒç”¨handleLogå°†æ¶ˆæ¯åŒæ—¶æäº¤ç»™å‰ä¸€ä¸ªæ—¥å¿—å¤„ç†å™¨\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; handleLog&lt;messageLevel, handlerIndex - 1&gt;(record);\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // è·å–å½“å‰æ—¥å¿—å¤„ç†å™¨å¹¶æäº¤æ¶ˆæ¯\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; auto&amp; handler = std::get&lt;handlerIndex&gt;(_attachedHandlers);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; handler.emit&lt;messageLevel&gt;(record);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; template &lt;Level messageLevel, int32_t handlerIndex&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; requires (handlerIndex == 0)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; void handleLog(const Record&amp; record) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // è·å–å½“å‰æ—¥å¿—å¤„ç†å™¨å¹¶æäº¤æ¶ˆæ¯\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; auto&amp; handler = std::get&lt;handlerIndex&gt;(_attachedHandlers);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; handler.emit&lt;messageLevel&gt;(record);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // æäº¤ä¸¥é‡é”™è¯¯ä¿¡æ¯ï¼ˆlogçš„åŒ…è£…ï¼‰\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Logger&amp; critical(const std::string&amp; message) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return log&lt;Level::Critical&gt;(message);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // æäº¤ä¸€èˆ¬é”™è¯¯ä¿¡æ¯ï¼ˆlogçš„åŒ…è£…ï¼‰\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Logger&amp; error(const std::string&amp; message) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return log&lt;Level::Error&gt;(message);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // æäº¤è­¦å‘Šä¿¡æ¯ï¼ˆlogçš„åŒ…è£…ï¼‰\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Logger&amp; warning(const std::string&amp; message) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return log&lt;Level::Warning&gt;(message);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // æäº¤æ™®é€šä¿¡æ¯ï¼ˆlogçš„åŒ…è£…ï¼‰\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Logger&amp; info(const std::string&amp; message) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return log&lt;Level::Info&gt;(message);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // æäº¤è°ƒè¯•ä¿¡æ¯ï¼ˆlogçš„åŒ…è£…ï¼‰\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Logger&amp; debug(const std::string&amp; message) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return log&lt;Level::Debug&gt;(message);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // æäº¤ç¨‹åºè·Ÿè¸ªä¿¡æ¯ï¼ˆlogçš„åŒ…è£…ï¼‰\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Logger&amp; trace(const std::string&amp; message) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return log&lt;Level::Trace&gt;(message);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\n&nbsp;\n&nbsp;&nbsp;&nbsp; private:\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // æ—¥å¿—è®°å½•å™¨åç§°\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::string _name;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // æ³¨å†Œçš„æ—¥å¿—å¤„ç†å™¨ï¼Œç”±äºæ—¥å¿—å¤„ç†å™¨çš„ç±»å‹ä¸æ•°é‡ä¸å®šï¼Œå› æ­¤è¿™é‡Œä½¿ç”¨å…ƒç»„è€Œéæ•°ç»„\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::tuple&lt;HandlerTypes...&gt; _attachedHandlers;\n&nbsp;&nbsp;&nbsp; };\n&nbsp;\n&nbsp;&nbsp;&nbsp; // æ—¥å¿—è®°å½•å™¨ç”Ÿæˆå·¥å‚\n&nbsp;&nbsp;&nbsp; template &lt;Level level = Level::Warning&gt;\n&nbsp;&nbsp;&nbsp; class LoggerFactory {\n&nbsp;&nbsp;&nbsp; public:\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // åˆ›å»ºæ—¥å¿—è®°å½•å™¨ï¼ŒæŒ‡å®šåç§°ä¸å¤„ç†å™¨\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; template &lt;Handler... HandlerTypes&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; static Logger&lt;level, HandlerTypes...&gt; createLogger(const std::string&amp; name, std::tuple&lt;HandlerTypes...&gt;&amp;&amp; attachedHandlers) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return Logger&lt;level, HandlerTypes...&gt;(name, std::forward&lt;std::tuple&lt;HandlerTypes...&gt;&gt;(attachedHandlers));\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // åˆ›å»ºæ—¥å¿—è®°å½•å™¨ï¼ŒæŒ‡å®šåç§°ï¼Œå¤„ç†å™¨é‡‡ç”¨é»˜è®¤å¤„ç†å™¨ï¼ˆDefaultHandlerï¼‰\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; template &lt;Handler... HandlerTypes&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; static Logger&lt;level, handlers::DefaultHandler&lt;level&gt;&gt; createLogger(const std::string&amp; name) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return Logger&lt;level, handlers::DefaultHandler&lt;level&gt;&gt;(name, std::make_tuple(handlers::DefaultHandler&lt;level&gt;()));\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\n&nbsp;&nbsp;&nbsp; };\n}\n</code></pre><p>æ—¥å¿—è®°å½•å™¨Loggeræ˜¯ä¸€ä¸ªæ¨¡æ¿ç±»ã€‚ä¸å…¶ä»–æ—¥å¿—è®°å½•å™¨ä¸åŒï¼Œ<strong>è¿™é‡Œè®¾è®¡çš„æ—¥å¿—æ¡†æ¶ï¼Œæ˜¯ä¸€ä¸ªâ€œé™æ€â€æ¡†æ¶</strong>ï¼Œä¹Ÿå°±æ˜¯æ—¥å¿—è¾“å‡ºçš„é…ç½®éƒ½å¿…é¡»åœ¨ä»£ç ä¸­ç¼–ç ï¼Œè€Œéè¯»å–å¤–éƒ¨é…ç½®æˆ–è¿è¡Œæ—¶ä¿®æ”¹ã€‚</p><p>è¿™ä¹ˆåšçš„åˆè¡·åœ¨äºï¼Œé€šè¿‡C++æ¨¡æ¿èƒ½åŠ›ç›´æ¥ç”Ÿæˆå›ºåŒ–çš„ä»£ç ï¼Œé¿å…è¿è¡Œæ—¶è¿›è¡Œé€»è¾‘åˆ¤æ–­â€”â€”è¿™æ ·æ•ˆç‡æ›´é«˜ã€‚å› æ­¤ï¼Œæ—¥å¿—è®°å½•å™¨çš„ç­‰çº§Levelå’Œéœ€è¦æ³¨å†Œåˆ°æ—¥å¿—è®°å½•å™¨çš„å¤„ç†å™¨ç±»å‹ï¼Œéƒ½éœ€è¦é€šè¿‡æ¨¡æ¿å‚æ•°æ³¨å†Œåˆ°Loggerä¸­ã€‚</p><p>å…ˆæ¥çœ‹ä¸€ä¸‹æ„é€ å‡½æ•°ã€‚æ„é€ å‡½æ•°ä¸­åŒ…å«ä¸¤ä¸ªå‚æ•°ã€‚</p><ul>\n<li>nameä¸ºæ—¥å¿—è®°å½•å™¨åç§°ã€‚</li>\n<li>attachedHandlersæ˜¯éœ€è¦æ³¨å†Œåˆ°Loggerå¯¹è±¡ä¸­çš„æ—¥å¿—å¤„ç†å™¨ã€‚</li>\n</ul><p>ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†ï¼Œæ—¥å¿—å¤„ç†å™¨çš„ç±»å‹HandlerTypesæ˜¯ä¸€ä¸ªæ¨¡æ¿ä¸å®šå‚æ•°ï¼Œå”¯ä¸€è¦æ±‚æ˜¯æ¯ä¸ªå‚æ•°éƒ½å¿…é¡»æ»¡è¶³Handlerçº¦æŸçš„ç±»å‹ã€‚è¿™ä¸ªconceptè¡¨ç¤ºåˆæ³•çš„æ—¥å¿—å¤„ç†å™¨ï¼Œå…·ä½“å®ç°ï¼Œæˆ‘ä»¬ä¼šåœ¨æ¥ä¸‹æ¥çš„â€œæ—¥å¿—å¤„ç†å™¨æ¨¡å—â€é‡Œè®¨è®ºã€‚</p><p>ç”±äºæ¯ä¸ªæ—¥å¿—å¤„ç†å™¨çš„ç±»å‹éƒ½ä¸ä¸€æ ·ã€‚å› æ­¤ï¼Œæ‰€æœ‰çš„æ—¥å¿—å¤„ç†å™¨éƒ½æŒ‰æŒ‡å®šé¡ºåºå­˜å‚¨åœ¨ä¸€ä¸ªtupleä¸­ã€‚ç”±äºæ—¥å¿—å¤„ç†å™¨ä¹Ÿä¸å…è®¸æ‹·è´ï¼Œåªå…è®¸ç§»åŠ¨ã€‚æ‰€ä»¥ï¼Œè¿™é‡Œé‡‡ç”¨çš„æ˜¯å…ƒç»„çš„ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œä¹Ÿå¯ä»¥ç¡®ä¿è¾ƒé«˜çš„è¿è¡Œæ•ˆç‡ã€‚</p><p>æ¥ç€ï¼Œçœ‹ä¸€ä¸‹æˆå‘˜å‡½æ•°logï¼Œè¯¥å‡½æ•°æ˜¯é€šç”¨çš„æ—¥å¿—è¾“å‡ºæ¥å£ï¼Œå¯ä»¥æŒ‰ç…§æŒ‡å®šæ—¥å¿—ç­‰çº§è¾“å‡ºä»»æ„å†…å®¹çš„æ—¥å¿—ã€‚Loggerçš„ä½¿ç”¨è€…éœ€è¦è°ƒç”¨è¯¥å‡½æ•°è¾“å‡ºæ—¥å¿—ï¼Œè¯¥å‡½æ•°åŒ…å«ä¸¤ä¸ªå‚æ•°ã€‚</p><ul>\n<li>levelï¼šè¾“å‡ºæ—¥å¿—ç­‰çº§ï¼Œé€šè¿‡æ¨¡æ¿å‚æ•°ä¼ é€’ã€‚</li>\n<li>messageï¼šè¡¨ç¤ºæ—¥å¿—å†…å®¹ï¼Œé€šè¿‡å‡½æ•°å‚æ•°ä¼ é€’ã€‚</li>\n</ul><p>ä¸ºäº†åœ¨ç¼–è¯‘æ—¶å°±ç¡®å®šLoggeræ˜¯å¦åº”è¯¥æ¥æ”¶è¿™ä¸ªæ—¥å¿—ï¼Œé¿å…è¿è¡Œæ—¶çš„é¢å¤–åˆ¤æ–­ï¼Œæˆ‘ä»¬å°†levelç‰¹æ„å®šä¹‰æˆæ¨¡æ¿å‚æ•°ï¼Œå¹¶åˆ©ç”¨requiresä¸ºlogå®šä¹‰äº†ä¸¤ä¸ªé‡è½½ç‰ˆæœ¬ï¼Œä½ å¯ä»¥å‚è€ƒè¿™å¼ è¡¨æ ¼ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d4/eb/d4d0e0fdca6e5486e4b005fdbd793aeb.jpg?wh=3267x1087\" alt=\"\"></p><p>æ¥ç€ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æˆå‘˜å‡½æ•°handleLogçš„å®ç°ï¼Œè¯¥å‡½æ•°å¯ä»¥å°†æ—¥å¿—æäº¤ç»™Loggerä¸­æ³¨å†Œçš„æ‰€æœ‰æ—¥å¿—å¤„ç†å™¨ï¼ŒåŒ…å«3ä¸ªå‚æ•°ã€‚</p><ul>\n<li>messageLevelï¼šæ¶ˆæ¯æ—¥å¿—ç­‰çº§ï¼Œéœ€è¦é€šè¿‡æ¨¡æ¿å‚æ•°ä¼ é€’ã€‚</li>\n<li>handlerIndexï¼šå¤„ç†å™¨åœ¨Loggerä¸­çš„æ³¨å†Œåºå·ï¼Œéœ€è¦é€šè¿‡æ¨¡æ¿å‚æ•°ä¼ é€’ã€‚</li>\n<li>recordï¼šæäº¤ç»™å¤„ç†å™¨çš„æ—¥å¿—è®°å½•ï¼Œéœ€è¦é€šè¿‡å‡½æ•°å‚æ•°ä¼ é€’ã€‚</li>\n</ul><p>ç”±äºhandlerçš„ç±»å‹ä¸ä¸€å®šç›¸åŒã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ— æ³•é€šè¿‡å¾ªç¯å°†æ—¥å¿—è®°å½•æäº¤ç»™æ‰€æœ‰çš„æ—¥å¿—å¤„ç†å™¨ï¼Œéœ€è¦é‡‡ç”¨é€’å½’çš„æ–¹å¼ã€‚</p><p>åœ¨å…·ä½“å®ç°æ—¶ï¼ŒmessageLevelå’ŒhandlerIndexå‡ä¸ºæ¨¡æ¿å‚æ•°ï¼ŒhandlerIndexä»æœ€åä¸€ä¸ªæ—¥å¿—å¤„ç†å™¨å¼€å§‹ï¼ˆè¿™è§£é‡Šäº†åœ¨æˆå‘˜å‡½æ•°logä¸­ï¼Œè°ƒç”¨handleLogæ—¶ä¼ é€’çš„æ˜¯HandlerCount - 1ï¼‰ï¼Œæœ€ç»ˆé€’å½’è°ƒç”¨åˆ°handlerIndexä¸º0æ—¶ç»ˆæ­¢ã€‚</p><p>ç”±äºLoggerä¸€èˆ¬ä¸ä¼šæ”¯æŒå¤ªå¤šçš„è¾“å‡ºç›®æ ‡ï¼ˆä¸€èˆ¬æ¥è¯´ï¼Œä¹Ÿå°±æ˜¯å°†æ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œæˆ–è€…è¾“å‡ºåˆ°æ–‡ä»¶ï¼‰ï¼Œé€’å½’å±‚æ•°ä¸ä¼šå¤ªæ·±ï¼Œå› æ­¤ä¸ºäº†åœ¨ç¼–è¯‘æ—¶ç”Ÿæˆç¡®å®šçš„è°ƒç”¨é“¾æ¡ï¼Œä¸ºC++æä¾›é€’å½’å‡½æ•°å†…è”è°ƒç”¨ä¼˜åŒ–çš„å¯èƒ½æ€§ï¼Œæˆ‘ä»¬å°†messageLevelå’ŒhandlerIndexç‰¹æ„å®šä¹‰æˆæ¨¡æ¿å‚æ•°ï¼Œå¹¶åˆ©ç”¨requiresä¸ºhandleLogå®šä¹‰äº†ä¸¤ä¸ªé‡è½½ç‰ˆæœ¬ï¼Œå°±åƒåé¢è¿™æ ·ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/12/c5/12fc6598ae40170862d98b7f8caa4bc5.jpg?wh=3267x1087\" alt=\"\"></p><p>å¥½ï¼Œæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ä»£ç ã€‚ä»94â€”121è¡Œï¼Œä¸ºä¸åŒæ—¥å¿—ç­‰çº§å®šä¹‰äº†åŒ…è£…æ¥å£ï¼Œä¾¿äºLoggerç”¨æˆ·ç›´æ¥è¾“å‡ºç‰¹å®šç­‰çº§çš„æ—¥å¿—ï¼Œå‡å°‘ç¼–ç ã€‚</p><p>ç”±äºLoggerå¿…é¡»è¦æŒ‡å®šæ—¥å¿—å¤„ç†å™¨ï¼Œè€Œä¸”å¤šä¸ªæ—¥å¿—å¤„ç†å™¨ç±»å‹ä¸åŒï¼Œå› æ­¤åˆ›å»ºLoggerå¯¹è±¡æ—¶å¿…é¡»æŒ‡æ˜æ‰€æœ‰å¤„ç†å™¨çš„ç±»å‹ã€‚</p><p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå·¥å‚ç±»LoggerFactoryï¼Œå°†æ—¥å¿—ç­‰çº§ä½œä¸ºç±»çš„æ¨¡æ¿å‚æ•°ï¼Œç”¨æˆ·è°ƒç”¨createLoggerå‡½æ•°åˆ›å»ºLoggerå¯¹è±¡æ—¶ï¼Œç¼–è¯‘å™¨å¯ä»¥æ ¹æ®å‡½æ•°å‚æ•°åˆ—è¡¨ï¼Œè‡ªåŠ¨æ¨å¯¼HandlerTypesçš„å…·ä½“ç±»å‹ï¼Œé™ä½ç¼–ç¨‹å·¥ä½œé‡ã€‚</p><h2>æ—¥å¿—å¤„ç†å™¨æ¨¡å—</h2><p>æœ€åï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æ—¥å¿—å¤„ç†å™¨æ¨¡å—ä»¥åŠå¸¸è§çš„æ—¥å¿—è¾“å‡ºå¤„ç†å®ç°ã€‚</p><h3>æ¥å£è®¾è®¡</h3><p>åœ¨logging/Handler.hä¸­å®šä¹‰äº†å’Œæ—¥å¿—å¤„ç†å™¨æœ‰å…³çš„æ¥å£ã€‚</p><pre><code class=\"language-c++\">#pragma once\n&nbsp;\n#include \"logging/Formatter.h\"\n#include \"logging/Level.h\"\n#include \"logging/Record.h\"\n#include &lt;string&gt;\n#include &lt;memory&gt;\n#include &lt;type_traits&gt;\n#include &lt;concepts&gt;\n&nbsp;\nnamespace logging {\n&nbsp;&nbsp;&nbsp; // Handler Concept\n&nbsp;&nbsp;&nbsp; // ä¸å¼ºåˆ¶æ‰€æœ‰Handleréƒ½ç»§æ‰¿BaseHandlerï¼Œåªéœ€è¦æ»¡è¶³ç‰¹å®šçš„æ¥å£ï¼Œå› æ­¤å®šä¹‰Concept\n&nbsp;&nbsp;&nbsp; template &lt;class HandlerType&gt;\n&nbsp;&nbsp;&nbsp; concept Handler = requires (HandlerType handler, const Record &amp; record, Level level) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // è¦æ±‚æœ‰emitæˆå‘˜å‡½æ•°\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; handler.emit;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // è¦æ±‚æœ‰formatå‡½æ•°ï¼Œå¯ä»¥å°†Recordå¯¹è±¡æ ¼å¼åŒ–ä¸ºstringç±»å‹çš„å­—ç¬¦ä¸²\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; { handler.format(record) } -&gt; std::same_as&lt;std::string&gt;;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // è¦æ±‚æœ‰ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œæ— æ‹·è´æ„é€ å‡½æ•°\n&nbsp;&nbsp;&nbsp; }&amp;&amp; std::move_constructible&lt;HandlerType&gt; &amp;&amp; !std::copy_constructible&lt;HandlerType&gt;;\n&nbsp;\n&nbsp;&nbsp;&nbsp; // BaseHandlerç±»å®šä¹‰\n&nbsp;&nbsp;&nbsp; // HandlerLevelæ˜¯æ—¥å¿—å¤„ç†å™¨çš„æ—¥å¿—ç­‰çº§\n&nbsp;&nbsp;&nbsp; // è‡ªå·±å®ç°Handleræ—¶å¯ä»¥ç»§æ‰¿BaseHandlerç„¶åå®ç°emit\n&nbsp;&nbsp;&nbsp; template &lt;Level HandlerLevel = Level::Warning&gt;\n&nbsp;&nbsp;&nbsp; class BaseHandler {\n&nbsp;&nbsp;&nbsp; public:\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // æ„é€ å‡½æ•°ï¼šformatterä¸ºæ—¥å¿—å¤„ç†å™¨çš„æ ¼å¼åŒ–å™¨\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BaseHandler(Formatter formatter) : _formatter(formatter) {}\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // ä¸å…è®¸æ‹·è´\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BaseHandler(const BaseHandler&amp;) = delete;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // ä¸å…è®¸èµ‹å€¼\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BaseHandler&amp; operator=(const BaseHandler&amp;) = delete;\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // ç§»åŠ¨æ„é€ å‡½æ•°ï¼šå…è®¸æ—¥å¿—å¤„ç†å™¨å¯¹è±¡ä¹‹é—´ç§»åŠ¨\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; BaseHandler(BaseHandler&amp;&amp; rhs) noexcept : _formatter(std::move(rhs._formatter)) {};\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // ææ„å‡½æ•°ï¼Œè€ƒè™‘åˆ°ä¼šè¢«ç»§æ‰¿ï¼Œé¿å…ææ„æ—¶å‘ç”Ÿèµ„æºæ³„éœ²\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; virtual ~BaseHandler() {}\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // getForamtterï¼šè·å–formatter\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Formatter getForamtter() const {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return _formatter;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // setForamtterï¼šä¿®æ”¹formatter\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; void setForamtter(Formatter formatter) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _formatter = formatter;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // formatï¼šè°ƒç”¨æ ¼å¼åŒ–å™¨å°†recordè½¬æ¢æˆæ–‡æœ¬å­—ç¬¦ä¸²\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::string format(const Record&amp; record) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; return _formatter(record);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\n&nbsp;\n&nbsp;&nbsp;&nbsp; private:\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // æ—¥å¿—å¤„ç†å™¨çš„æ ¼å¼åŒ–å™¨\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Formatter _formatter;\n&nbsp;&nbsp;&nbsp; };\n}\n</code></pre><p>Handleræ˜¯ä¸€ä¸ªconceptã€‚å‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å¼ºåˆ¶è¦æ±‚æ‰€æœ‰æ—¥å¿—å¤„ç†å™¨éƒ½ç»§æ‰¿ä¸€ä¸ªæ ‡å‡†åŸºç±»ï¼Œç„¶åé€šè¿‡æ ‡å‡†åŸºç±»è°ƒç”¨å®ç°ã€‚<strong>æˆ‘ä»¬çš„åšæ³•æ˜¯ï¼Œå®šä¹‰ä¸€ä¸ªconceptæ¥çº¦æŸHandlerçš„æ¥å£ã€‚</strong></p><p>æ—¥å¿—å¤„ç†å™¨çš„çº¦æŸåŒ…æ‹¬ï¼š</p><ul>\n<li>æä¾›emitæ¥å£ç”¨äºæäº¤æ—¥å¿—è®°å½•ã€‚</li>\n<li>æä¾›formatå‡½æ•°ï¼Œå‚æ•°ä¸ºæ—¥å¿—è®°å½•å¯¹è±¡ï¼Œè¿”å›ç±»å‹ä¸ºstd::stringã€‚</li>\n<li>æä¾›ç§»åŠ¨æ„é€ å‡½æ•°ã€‚</li>\n<li>ä¸å¯æ‹·è´ï¼ˆç¦ç”¨æ‹·è´æ„é€ å‡½æ•°ï¼‰ã€‚</li>\n</ul><p>BaseHandleræ˜¯ä¸ºå…¶ä»–æ—¥å¿—å¤„ç†å™¨ç±»æä¾›çš„åŸºç±»ã€‚è™½ç„¶æˆ‘ä»¬ä¸å¼ºåˆ¶æ‰€æœ‰çš„æ—¥å¿—å¤„ç†å™¨ç»§æ‰¿ä¸€ä¸ªæ ‡å‡†åŸºç±»ï¼Œä½†è¿˜æ˜¯æä¾›äº†ä¸€ä¸ªåŸºç±»å®ç°ï¼Œè¿™æ ·å¯ä»¥é™ä½å…·ä½“å®ç°çš„ç¼–ç å·¥ä½œé‡ã€‚</p><h3>å…·ä½“å®ç°</h3><p>æ—¥å¿—å¤„ç†å™¨å…·ä½“æ€ä¹ˆå®ç°å‘¢ï¼Ÿæˆ‘ä»¬ä»¥DefaultHandlerä¸ºä¾‹çœ‹ä¸€çœ‹ï¼ŒDefaultHandleræ˜¯é»˜è®¤æ—¥å¿—å¤„ç†å™¨ï¼Œè´Ÿè´£å°†æ—¥å¿—è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºæµã€‚</p><p>DefaultHandler å®ç°åœ¨logging/handlers/DefaultHandler.hä¸­ã€‚</p><pre><code class=\"language-c++\">#pragma once\n&nbsp;\n#include \"logging/Handler.h\"\n&nbsp;\nnamespace logging::handlers {\n&nbsp;&nbsp;&nbsp; // é»˜è®¤æ—¥å¿—å¤„ç†å™¨\n&nbsp;&nbsp;&nbsp; template &lt;Level HandlerLevel = Level::Warning&gt;\n&nbsp;&nbsp;&nbsp; // ç»§æ‰¿BaseHandler\n&nbsp;&nbsp;&nbsp; class DefaultHandler : public BaseHandler&lt;HandlerLevel&gt; {\n&nbsp;&nbsp;&nbsp; public:\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // æ„é€ å‡½æ•°ï¼Œéœ€è¦æŒ‡å®šæ ¼å¼åŒ–å™¨ï¼Œé»˜è®¤æ ¼å¼åŒ–å™¨ä¸ºdefaultFormatter\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DefaultHandler(Formatter formatter = defaultFormatter) : BaseHandler&lt;HandlerLevel&gt;(formatter) {}\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // ç¦æ­¢æ‹·è´æ„é€ å‡½æ•°\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DefaultHandler(const DefaultHandler&amp;) = delete;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // å®šä¹‰ç§»åŠ¨æ„é€ å‡½æ•°\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; DefaultHandler(const DefaultHandler&amp;&amp; rhs) noexcept : BaseHandler&lt;HandlerLevel&gt;(rhs.getForamtter()) {}\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // emitç”¨äºæäº¤æ—¥å¿—è®°å½•\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // emitLevel &gt; HandlerLevelçš„æ—¥å¿—ä¼šè¢«ä¸¢å¼ƒ\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; template &lt;Level emitLevel&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; requires (emitLevel &gt; HandlerLevel)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; void emit(const Record&amp; record) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // emitLevel &lt;= HandlerLevelçš„æ—¥å¿—ä¼šè¢«è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºæµä¸­\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; template &lt;Level emitLevel&gt;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; requires (emitLevel &lt;= HandlerLevel)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; void emit(const Record&amp; record) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; // è°ƒç”¨formatå°†æ—¥å¿—è®°å½•å¯¹è±¡æ ¼å¼åŒ–æˆæ–‡æœ¬å­—ç¬¦ä¸²\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; this-&gt;format(record) &lt;&lt; std::endl;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\n&nbsp;&nbsp;&nbsp; };\n}\n</code></pre><p>DefaultHandleræŒ‰ç…§æ—¥å¿—å¤„ç†å™¨çš„conceptå®šä¹‰äº†ç›¸å…³æ¥å£ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œemitæˆå‘˜å‡½æ•°é€šè¿‡requiresï¼Œå°†è¾“å‡ºæ—¥å¿—ç­‰çº§è¾ƒä½çš„æ—¥å¿—è®°å½•ç›´æ¥ä¸¢å¼ƒäº†ã€‚å› æ­¤ï¼Œåªæœ‰å½“æ»¡è¶³è¦æ±‚çš„æ—¥å¿—è¾“å‡ºæ—¶ï¼Œæ‰ä¼šè¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºæµä¸­â€”â€”è¿™å’ŒLoggerçš„logå‡½æ•°ä¸¢å¼ƒæ—¥å¿—çš„åŸç†ä¸€æ ·ã€‚</p><p>StreamHandlerå’ŒFileHandlerçš„å®ç°ä¸DefaultHandlerç±»ä¼¼ï¼Œåªä¸è¿‡æ˜¯å°†æ—¥å¿—è¾“å‡ºåˆ°ä¸åŒçš„ç›®æ ‡ï¼Œå®ƒä»¬çš„åˆ†å·¥ä½ å¯ä»¥å‚è€ƒä¸‹è¡¨ã€‚</p><p>ä½ å¯ä»¥é€šè¿‡è¯¾ç¨‹é…å¥—ä»£ç ï¼Œäº†è§£å®ƒä»¬çš„å…·ä½“å®ç°ç»†èŠ‚ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/3e/e0/3e84103b1f0c3b73f91b361fd7bc63e0.jpg?wh=2872x1220\" alt=\"\"></p><h2>æ€»ç»“</h2><p>åœ¨ä½¿ç”¨C++ Formattingåº“å’Œformatterç±»å‹æ—¶ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šåˆ©ç”¨æ¨¡æ¿å’Œconceptæ¥æ¶ˆè§£è¿è¡Œæ—¶æ€§èƒ½æŸè€—ï¼Œä»¥å®ç°æ›´å¥½çš„æ€§èƒ½ã€‚</p><p>å¯¹äºæ—¥å¿—å¤„ç†è¿™æ ·ä¸€ä¸ªå…¸å‹çš„åº”ç”¨åœºæ™¯æ¥è¯´ï¼Œçº¦æŸæ¡ä»¶é€šå¸¸åŒ…å«ä»¥ä¸‹å‡ ç‚¹ã€‚</p><ul>\n<li>æä¾›emitæ¥å£ç”¨äºæäº¤æ—¥å¿—è®°å½•ã€‚</li>\n<li>æä¾›formatå‡½æ•°ï¼Œå‚æ•°ä¸ºæ—¥å¿—è®°å½•å¯¹è±¡ï¼Œè¿”å›ç±»å‹ä¸ºstd::stringã€‚</li>\n<li>æä¾›ç§»åŠ¨æ„é€ å‡½æ•°ã€‚</li>\n<li>ä¸å¯æ‹·è´ï¼ˆç¦ç”¨æ‹·è´æ„é€ å‡½æ•°ï¼‰ã€‚</li>\n</ul><p>æ€»çš„æ¥è¯´ï¼Œè¿è¡Œæ—¶æ€§èƒ½æ˜¯æˆ‘ä»¬é¦–è¦è€ƒè™‘çš„é—®é¢˜ã€‚è¿™æ˜¯ä¸€ç§æ–°çš„å®è·µèŒƒå¼â€”â€”åœ¨ç°ä»£C++ç¼–ç¨‹ä½“ç³»ä¸­ï¼Œå°½å¯èƒ½è®©è®¡ç®—å‘ç”Ÿåœ¨ç¼–è¯‘æ—¶ï¼Œè€Œéè¿è¡Œæ—¶ã€‚</p><h2>è¯¾åæ€è€ƒ</h2><p>æˆ‘ä»¬åœ¨<a href=\"https://time.geekbang.org/column/article/627909\">ç¬¬11è®²</a>ä¸­ï¼Œç¼–å†™äº†åŸºäºRangesçš„å·¥ç¨‹ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€äº›æ§åˆ¶å°è¾“å‡ºæ—¥å¿—ã€‚è¯·ä½ å°è¯•ç¼–è¯‘ä»Šå¤©è¿™ä¸€è®²çš„ä»£ç ï¼Œæ›¿æ¢Rangeså·¥ç¨‹ä¸­çš„æ‰€æœ‰è¾“å‡ºï¼ŒåŒ…æ‹¬æ§åˆ¶å°è¾“å‡ºå’Œæ—¥å¿—ã€‚</p><p>æ¬¢è¿åˆ†äº«ä½ çš„é—®é¢˜ä»¥åŠæ—¥å¿—åº“çš„æ”¹è¿›æ„è§ã€‚æˆ‘ä»¬ä¸€åŒäº¤æµã€‚ä¸‹ä¸€è®²è§ï¼</p>","comments":[{"had_liked":false,"id":386748,"user_name":"æäº‘é¾™","can_delete":false,"product_type":"c1","uid":3201926,"ip_address":"åŒ—äº¬","ucode":"785924B16BE788","user_header":"https://static001.geekbang.org/account/avatar/00/30/db/86/51ec4c41.jpg","comment_is_top":false,"comment_ctime":1705477370,"is_pvip":false,"replies":[{"id":141099,"content":"æ¯”å¿ƒ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1006976,"ctime":1706443319,"ip_address":"ä¸Šæµ·","comment_id":386748,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100523801,"comment_content":"ä¸ä»…å­¦åˆ°äº†formatï¼Œè¿˜åœ¨è€å¸ˆçš„é¡¹ç›®ä»£ç ä¸­å­¦åˆ°äº†ä¸åŒé£æ ¼çš„æ—¶é—´å¤„ç†","like_count":1,"discussions":[{"author":{"id":1006976,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5d/80/0c52be53.jpg","nickname":"å¢èª‰å£°","note":"","ucode":"93C5EFC39EB9C6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":636559,"discussion_content":"æ¯”å¿ƒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1706443319,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":2,"child_discussions":[{"author":{"id":3921999,"avatar":"","nickname":"Geek_16c67a","note":"","ucode":"6CDF76F8CC314D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1006976,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5d/80/0c52be53.jpg","nickname":"å¢èª‰å£°","note":"","ucode":"93C5EFC39EB9C6","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":647506,"discussion_content":"è¿™ä¸ªè¯¾ç¨‹æ˜¯è§†é¢‘å½¢å¼è¿˜æ˜¯æ–‡å­—çš„å½¢å¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1720114257,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":636559,"ip_address":"å››å·","group_id":0},"score":647506,"extra":""},{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"å¬æ°´çš„æ¹–","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":3921999,"avatar":"","nickname":"Geek_16c67a","note":"","ucode":"6CDF76F8CC314D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":647522,"discussion_content":"å›¾æ–‡åŠ éŸ³é¢‘å½¢å¼ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1720143407,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":647506,"ip_address":"åŒ—äº¬","group_id":0},"score":647522,"extra":""}]}]},{"had_liked":false,"id":395638,"user_name":"ä¸‰ç¬‘ä¸‰å¼•ä¼å…µ","can_delete":false,"product_type":"c1","uid":3784424,"ip_address":"æ±Ÿè‹","ucode":"B96439B22B407E","user_header":"https://static001.geekbang.org/account/avatar/00/39/be/e8/878aa74f.jpg","comment_is_top":false,"comment_ctime":1731511748,"is_pvip":false,"replies":[{"id":143799,"content":"å¦‚æœçº¯è™šå‡½æ•°ï¼Œå°±ä¼šäº§ç”Ÿè¿è¡Œæ—¶å¼€é”€ï¼Œå¦‚æœç”¨æ¨¡æ¿ï¼Œå°±ä¼šå¯ä»¥å®ç°ç¼–è¯‘æ—¶è®¡ç®—ï¼Œç¡®å®šè°ƒç”¨å“ªä¸ªç‰ˆæœ¬çš„handlerï¼Œå‡å°‘è¿è¡Œæ—¶å¼€é”€ã€‚\n\nä¸è¿‡è¿™é‡Œå…¶å®æ²¡æœ‰ç‰¹åˆ«åŸå› ï¼Œå¯ä»¥åœ¨åŸºç±»é‡Œå£°æ˜ï¼Œè¿™ç‚¹å¼€é”€åœ¨ç»å¤§å¤šæ•°åº”ç”¨ä¸­å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":1006976,"ctime":1733036229,"ip_address":"åŠ æ‹¿å¤§","comment_id":395638,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100523801,"comment_content":"æˆ‘æƒ³é—®ä¸‹ä¸ºä»€ä¹ˆBaseHandlerä¸å£°æ˜ä¸€ä¸ªemitçš„çº¯è™šå‡½æ•°å‘¢ å› ä¸ºå¼€é”€å—","like_count":0,"discussions":[{"author":{"id":1006976,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5d/80/0c52be53.jpg","nickname":"å¢èª‰å£°","note":"","ucode":"93C5EFC39EB9C6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":654588,"discussion_content":"å¦‚æœçº¯è™šå‡½æ•°ï¼Œå°±ä¼šäº§ç”Ÿè¿è¡Œæ—¶å¼€é”€ï¼Œå¦‚æœç”¨æ¨¡æ¿ï¼Œå°±ä¼šå¯ä»¥å®ç°ç¼–è¯‘æ—¶è®¡ç®—ï¼Œç¡®å®šè°ƒç”¨å“ªä¸ªç‰ˆæœ¬çš„handlerï¼Œå‡å°‘è¿è¡Œæ—¶å¼€é”€ã€‚\n\nä¸è¿‡è¿™é‡Œå…¶å®æ²¡æœ‰ç‰¹åˆ«åŸå› ï¼Œå¯ä»¥åœ¨åŸºç±»é‡Œå£°æ˜ï¼Œè¿™ç‚¹å¼€é”€åœ¨ç»å¤§å¤šæ•°åº”ç”¨ä¸­å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1733036229,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŠ æ‹¿å¤§","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3784424,"avatar":"https://static001.geekbang.org/account/avatar/00/39/be/e8/878aa74f.jpg","nickname":"ä¸‰ç¬‘ä¸‰å¼•ä¼å…µ","note":"","ucode":"B96439B22B407E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":654820,"discussion_content":"å¥½çš„å¥½çš„ æ‡‚äº† è°¢è°¢ æˆ‘éƒ½ä¸çŸ¥é“è€å¸ˆå›äº† æ²¡å•¥æé†’ğŸ˜­","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1733538644,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ±Ÿè‹","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":369249,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"åŒ—äº¬","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1677290388,"is_pvip":false,"replies":[{"id":134888,"content":"ç†è®ºä¸ŠStreamHandlerå¯ä»¥åŒ…å«æ‰€æœ‰çš„æµï¼ŒåŒ…æ‹¬æ ‡å‡†è¾“å‡º&#47;é”™è¯¯æµã€æ–‡ä»¶è¾“å‡ºæµç”šè‡³å­—ç¬¦ä¸²æµã€‚æˆ‘ä»¬è¿™é‡Œå•ç‹¬è®¾è®¡FileHandlerçš„åŸå› æ˜¯ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨æ–‡ä»¶è®°å½•æ—¥å¿—æ—¶ï¼Œç»å¸¸ä¼šæ¶‰åŠåˆ°æ—¥å¿—æ–‡ä»¶å¤§å°æ§åˆ¶ã€æ—¥å¿—æ–‡ä»¶åˆ†å‰²ã€è‡ªåŠ¨å½’æ¡£ç­‰å¸¸è§éœ€æ±‚ï¼Œè¿™ç§æƒ…å†µä¸‹å¿…é¡»ç”¨å•ç‹¬çš„FileHandlerï¼ˆéœ€è¦æœ‰æ›´å¤šçš„é…ç½®å‚æ•°ï¼‰ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨StreamHandlerã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1006976,"ctime":1678249442,"ip_address":"ä¸Šæµ·","comment_id":369249,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100523801,"comment_content":"StreamHandlerçš„â€œæµâ€æ˜¯å¦åŒ…å«Fileï¼Ÿç”šè‡³åŒ…å«æ ‡å‡†è¾“å‡ºæµï¼Ÿ\næˆ‘ç›®å‰çš„ç†è§£æ˜¯ï¼šæ ‡å‡†è¾“å‡ºæµå°±æ˜¯æ§åˆ¶å°ï¼›â€œæµâ€ä¸€èˆ¬åŒ…æ‹¬æ–‡ä»¶è¾“å‡ºæµã€ç½‘ç»œè¾“å‡ºæµï¼Œå¥½åƒæ²¡æœ‰åˆ«çš„äº†ã€‚","like_count":0,"discussions":[{"author":{"id":1006976,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5d/80/0c52be53.jpg","nickname":"å¢èª‰å£°","note":"","ucode":"93C5EFC39EB9C6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":608070,"discussion_content":"ç†è®ºä¸ŠStreamHandlerå¯ä»¥åŒ…å«æ‰€æœ‰çš„æµï¼ŒåŒ…æ‹¬æ ‡å‡†è¾“å‡º/é”™è¯¯æµã€æ–‡ä»¶è¾“å‡ºæµç”šè‡³å­—ç¬¦ä¸²æµã€‚æˆ‘ä»¬è¿™é‡Œå•ç‹¬è®¾è®¡FileHandlerçš„åŸå› æ˜¯ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­ä½¿ç”¨æ–‡ä»¶è®°å½•æ—¥å¿—æ—¶ï¼Œç»å¸¸ä¼šæ¶‰åŠåˆ°æ—¥å¿—æ–‡ä»¶å¤§å°æ§åˆ¶ã€æ—¥å¿—æ–‡ä»¶åˆ†å‰²ã€è‡ªåŠ¨å½’æ¡£ç­‰å¸¸è§éœ€æ±‚ï¼Œè¿™ç§æƒ…å†µä¸‹å¿…é¡»ç”¨å•ç‹¬çš„FileHandlerï¼ˆéœ€è¦æœ‰æ›´å¤šçš„é…ç½®å‚æ•°ï¼‰ï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨StreamHandlerã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678249443,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}