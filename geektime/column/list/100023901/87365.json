{"id":87365,"title":"12 | å¦‚ä½•ç”¨é¢å‘å¯¹è±¡æ€æƒ³å†™å¥½å¹¶å‘ç¨‹åºï¼Ÿ","content":"<p>åœ¨å·¥ä½œä¸­ï¼Œæˆ‘å‘ç°å¾ˆå¤šåŒå­¦åœ¨è®¾è®¡ä¹‹åˆéƒ½æ˜¯ç›´æ¥æŒ‰ç…§å•çº¿ç¨‹çš„æ€è·¯æ¥å†™ç¨‹åºçš„ï¼Œè€Œå¿½ç•¥äº†æœ¬åº”è¯¥é‡è§†çš„å¹¶å‘é—®é¢˜ï¼›ç­‰ä¸Šçº¿åçš„æŸå¤©ï¼Œçªç„¶å‘ç°è¯¡å¼‚çš„Bugï¼Œå†å†ç»åƒè¾›ä¸‡è‹¦ç»ˆäºå®šä½åˆ°é—®é¢˜æ‰€åœ¨ï¼Œå´å‘ç°å¯¹äºå¦‚ä½•è§£å†³å·²ç»æ²¡æœ‰äº†æ€è·¯ã€‚</p><p>å…³äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘è§‰å¾—å’±ä»¬ä»Šå¤©å¾ˆæœ‰å¿…è¦å¥½å¥½èŠèŠâ€œå¦‚ä½•ç”¨é¢å‘å¯¹è±¡æ€æƒ³å†™å¥½å¹¶å‘ç¨‹åºâ€è¿™ä¸ªè¯é¢˜ã€‚</p><p>é¢å‘å¯¹è±¡æ€æƒ³ä¸å¹¶å‘ç¼–ç¨‹æœ‰å…³ç³»å—ï¼Ÿæœ¬æ¥æ˜¯æ²¡å…³ç³»çš„ï¼Œå®ƒä»¬åˆ†å±ä¸¤ä¸ªä¸åŒçš„é¢†åŸŸï¼Œä½†æ˜¯åœ¨Javaè¯­è¨€é‡Œï¼Œè¿™ä¸¤ä¸ªé¢†åŸŸè¢«æ— æƒ…åœ°èåˆåœ¨ä¸€èµ·äº†ï¼Œå¥½åœ¨èåˆçš„æ•ˆæœè¿˜æ˜¯ä¸é”™çš„ï¼š<strong>åœ¨Javaè¯­è¨€é‡Œï¼Œé¢å‘å¯¹è±¡æ€æƒ³èƒ½å¤Ÿè®©å¹¶å‘ç¼–ç¨‹å˜å¾—æ›´ç®€å•</strong>ã€‚</p><p>é‚£å¦‚ä½•æ‰èƒ½ç”¨é¢å‘å¯¹è±¡æ€æƒ³å†™å¥½å¹¶å‘ç¨‹åºå‘¢ï¼Ÿç»“åˆæˆ‘è‡ªå·±çš„å·¥ä½œç»éªŒæ¥çœ‹ï¼Œæˆ‘è§‰å¾—ä½ å¯ä»¥ä»å°è£…å…±äº«å˜é‡ã€è¯†åˆ«å…±äº«å˜é‡é—´çš„çº¦æŸæ¡ä»¶å’Œåˆ¶å®šå¹¶å‘è®¿é—®ç­–ç•¥è¿™ä¸‰ä¸ªæ–¹é¢ä¸‹æ‰‹ã€‚</p><h2>ä¸€ã€å°è£…å…±äº«å˜é‡</h2><p>å¹¶å‘ç¨‹åºï¼Œæˆ‘ä»¬å…³æ³¨çš„ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜ï¼Œä¸è¿‡æ˜¯è§£å†³å¤šçº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«å˜é‡çš„é—®é¢˜ã€‚åœ¨<a href=\"https://time.geekbang.org/column/article/84344\">ã€Š03 | äº’æ–¥é”ï¼ˆä¸Šï¼‰ï¼šè§£å†³åŸå­æ€§é—®é¢˜ã€‹</a>ä¸­ï¼Œæˆ‘ä»¬ç±»æ¯”è¿‡çƒåœºé—¨ç¥¨çš„ç®¡ç†ï¼Œç°å®ä¸–ç•Œé‡Œé—¨ç¥¨ç®¡ç†çš„ä¸€ä¸ªæ ¸å¿ƒé—®é¢˜æ˜¯ï¼šæ‰€æœ‰è§‚ä¼—åªèƒ½é€šè¿‡è§„å®šçš„å…¥å£è¿›å…¥ï¼Œå¦åˆ™æ£€ç¥¨å°±å½¢åŒè™šè®¾ã€‚åœ¨ç¼–ç¨‹ä¸–ç•Œè¿™ä¸ªé—®é¢˜ä¹Ÿå¾ˆé‡è¦ï¼Œç¼–ç¨‹é¢†åŸŸé‡Œé¢å¯¹äºå…±äº«å˜é‡çš„è®¿é—®è·¯å¾„å°±ç±»ä¼¼äºçƒåœºçš„å…¥å£ï¼Œå¿…é¡»ä¸¥æ ¼æ§åˆ¶ã€‚å¥½åœ¨æœ‰äº†é¢å‘å¯¹è±¡æ€æƒ³ï¼Œå¯¹å…±äº«å˜é‡çš„è®¿é—®è·¯å¾„å¯ä»¥è½»æ¾æŠŠæ§ã€‚</p><!-- [[[read_end]]] --><p>é¢å‘å¯¹è±¡æ€æƒ³é‡Œé¢æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ç‰¹æ€§æ˜¯<strong>å°è£…</strong>ï¼Œå°è£…çš„é€šä¿—è§£é‡Šå°±æ˜¯<strong>å°†å±æ€§å’Œå®ç°ç»†èŠ‚å°è£…åœ¨å¯¹è±¡å†…éƒ¨</strong>ï¼Œå¤–ç•Œå¯¹è±¡<strong>åªèƒ½é€šè¿‡</strong>ç›®æ ‡å¯¹è±¡æä¾›çš„<strong>å…¬å…±æ–¹æ³•æ¥é—´æ¥è®¿é—®</strong>è¿™äº›å†…éƒ¨å±æ€§ï¼Œè¿™å’Œé—¨ç¥¨ç®¡ç†æ¨¡å‹åŒ¹é…åº¦ç›¸å½“çš„é«˜ï¼Œçƒåœºé‡Œçš„åº§ä½å°±æ˜¯å¯¹è±¡å±æ€§ï¼Œçƒåœºå…¥å£å°±æ˜¯å¯¹è±¡çš„å…¬å…±æ–¹æ³•ã€‚æˆ‘ä»¬æŠŠå…±äº«å˜é‡ä½œä¸ºå¯¹è±¡çš„å±æ€§ï¼Œé‚£å¯¹äºå…±äº«å˜é‡çš„è®¿é—®è·¯å¾„å°±æ˜¯å¯¹è±¡çš„å…¬å…±æ–¹æ³•ï¼Œæ‰€æœ‰å…¥å£éƒ½è¦å®‰æ’æ£€ç¥¨ç¨‹åºå°±ç›¸å½“äºæˆ‘ä»¬å‰é¢æåˆ°çš„å¹¶å‘è®¿é—®ç­–ç•¥ã€‚</p><p>åˆ©ç”¨é¢å‘å¯¹è±¡æ€æƒ³å†™å¹¶å‘ç¨‹åºçš„æ€è·¯ï¼Œå…¶å®å°±è¿™ä¹ˆç®€å•ï¼š<strong>å°†å…±äº«å˜é‡ä½œä¸ºå¯¹è±¡å±æ€§å°è£…åœ¨å†…éƒ¨ï¼Œå¯¹æ‰€æœ‰å…¬å…±æ–¹æ³•åˆ¶å®šå¹¶å‘è®¿é—®ç­–ç•¥</strong>ã€‚å°±æ‹¿å¾ˆå¤šç»Ÿè®¡ç¨‹åºéƒ½è¦ç”¨åˆ°è®¡æ•°å™¨æ¥è¯´ï¼Œä¸‹é¢çš„è®¡æ•°å™¨ç¨‹åºå…±äº«å˜é‡åªæœ‰ä¸€ä¸ªï¼Œå°±æ˜¯valueï¼Œæˆ‘ä»¬æŠŠå®ƒä½œä¸ºCounterç±»çš„å±æ€§ï¼Œå¹¶ä¸”å°†ä¸¤ä¸ªå…¬å…±æ–¹æ³•get()å’ŒaddOne()å£°æ˜ä¸ºåŒæ­¥æ–¹æ³•ï¼Œè¿™æ ·Counterç±»å°±æˆä¸ºä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»äº†ã€‚</p><pre><code>public class Counter {\n  private long value;\n  synchronized long get(){\n    return value;\n  }\n  synchronized long addOne(){\n    return ++value;\n  }\n}\n</code></pre><p>å½“ç„¶ï¼Œå®é™…å·¥ä½œä¸­ï¼Œå¾ˆå¤šçš„åœºæ™¯éƒ½ä¸ä¼šåƒè®¡æ•°å™¨è¿™ä¹ˆç®€å•ï¼Œç»å¸¸è¦é¢ä¸´çš„æƒ…å†µå¾€å¾€æ˜¯æœ‰å¾ˆå¤šçš„å…±äº«å˜é‡ï¼Œä¾‹å¦‚ï¼Œä¿¡ç”¨å¡è´¦æˆ·æœ‰å¡å·ã€å§“åã€èº«ä»½è¯ã€ä¿¡ç”¨é¢åº¦ã€å·²å‡ºè´¦å•ã€æœªå‡ºè´¦å•ç­‰å¾ˆå¤šå…±äº«å˜é‡ã€‚è¿™ä¹ˆå¤šçš„å…±äº«å˜é‡ï¼Œå¦‚æœæ¯ä¸€ä¸ªéƒ½è€ƒè™‘å®ƒçš„å¹¶å‘å®‰å…¨é—®é¢˜ï¼Œé‚£æˆ‘ä»¬å°±ç´¯æ­»äº†ã€‚ä½†å…¶å®ä»”ç»†è§‚å¯Ÿï¼Œä½ ä¼šå‘ç°ï¼Œå¾ˆå¤šå…±äº«å˜é‡çš„å€¼æ˜¯ä¸ä¼šå˜çš„ï¼Œä¾‹å¦‚ä¿¡ç”¨å¡è´¦æˆ·çš„å¡å·ã€å§“åã€èº«ä»½è¯ã€‚<strong>å¯¹äºè¿™äº›ä¸ä¼šå‘ç”Ÿå˜åŒ–çš„å…±äº«å˜é‡ï¼Œå»ºè®®ä½ ç”¨finalå…³é”®å­—æ¥ä¿®é¥°</strong>ã€‚è¿™æ ·æ—¢èƒ½é¿å…å¹¶å‘é—®é¢˜ï¼Œä¹Ÿèƒ½å¾ˆæ˜äº†åœ°è¡¨æ˜ä½ çš„è®¾è®¡æ„å›¾ï¼Œè®©åé¢æ¥æ‰‹ä½ ç¨‹åºçš„å…„å¼ŸçŸ¥é“ï¼Œä½ å·²ç»è€ƒè™‘è¿‡è¿™äº›å…±äº«å˜é‡çš„å¹¶å‘å®‰å…¨é—®é¢˜äº†ã€‚</p><h2>äºŒã€è¯†åˆ«å…±äº«å˜é‡é—´çš„çº¦æŸæ¡ä»¶</h2><p>è¯†åˆ«å…±äº«å˜é‡é—´çš„çº¦æŸæ¡ä»¶éå¸¸é‡è¦ã€‚å› ä¸º<strong>è¿™äº›çº¦æŸæ¡ä»¶ï¼Œå†³å®šäº†å¹¶å‘è®¿é—®ç­–ç•¥</strong>ã€‚ä¾‹å¦‚ï¼Œåº“å­˜ç®¡ç†é‡Œé¢æœ‰ä¸ªåˆç†åº“å­˜çš„æ¦‚å¿µï¼Œåº“å­˜é‡ä¸èƒ½å¤ªé«˜ï¼Œä¹Ÿä¸èƒ½å¤ªä½ï¼Œå®ƒæœ‰ä¸€ä¸ªä¸Šé™å’Œä¸€ä¸ªä¸‹é™ã€‚å…³äºè¿™äº›çº¦æŸæ¡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„ç¨‹åºæ¥æ¨¡æ‹Ÿä¸€ä¸‹ã€‚åœ¨ç±»SafeWMä¸­ï¼Œå£°æ˜äº†ä¸¤ä¸ªæˆå‘˜å˜é‡upperå’Œlowerï¼Œåˆ†åˆ«ä»£è¡¨åº“å­˜ä¸Šé™å’Œåº“å­˜ä¸‹é™ï¼Œè¿™ä¸¤ä¸ªå˜é‡ç”¨äº†AtomicLongè¿™ä¸ªåŸå­ç±»ï¼ŒåŸå­ç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªæˆå‘˜å˜é‡çš„setæ–¹æ³•å°±ä¸éœ€è¦åŒæ­¥äº†ã€‚</p><pre><code>public class SafeWM {\n  // åº“å­˜ä¸Šé™\n  private final AtomicLong upper =\n        new AtomicLong(0);\n  // åº“å­˜ä¸‹é™\n  private final AtomicLong lower =\n        new AtomicLong(0);\n  // è®¾ç½®åº“å­˜ä¸Šé™\n  void setUpper(long v){\n    upper.set(v);\n  }\n  // è®¾ç½®åº“å­˜ä¸‹é™\n  void setLower(long v){\n    lower.set(v);\n  }\n  // çœç•¥å…¶ä»–ä¸šåŠ¡ä»£ç \n}\n</code></pre><p>è™½è¯´ä¸Šé¢çš„ä»£ç æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œä½†æ˜¯å¿½è§†äº†ä¸€ä¸ªçº¦æŸæ¡ä»¶ï¼Œå°±æ˜¯<strong>åº“å­˜ä¸‹é™è¦å°äºåº“å­˜ä¸Šé™</strong>ï¼Œè¿™ä¸ªçº¦æŸæ¡ä»¶èƒ½å¤Ÿç›´æ¥åŠ åˆ°ä¸Šé¢çš„setæ–¹æ³•ä¸Šå—ï¼Ÿæˆ‘ä»¬å…ˆç›´æ¥åŠ ä¸€ä¸‹çœ‹çœ‹æ•ˆæœï¼ˆå¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºï¼‰ã€‚æˆ‘ä»¬åœ¨setUpper()å’ŒsetLower()ä¸­å¢åŠ äº†å‚æ•°æ ¡éªŒï¼Œè¿™ä¹çœ‹ä¸Šå»å¥½åƒæ˜¯å¯¹çš„ï¼Œä½†å…¶å®å­˜åœ¨å¹¶å‘é—®é¢˜ï¼Œé—®é¢˜åœ¨äºå­˜åœ¨ç«æ€æ¡ä»¶ã€‚è¿™é‡Œæˆ‘é¡ºä¾¿æ’ä¸€å¥ï¼Œå…¶å®å½“ä½ çœ‹åˆ°ä»£ç é‡Œå‡ºç°ifè¯­å¥çš„æ—¶å€™ï¼Œå°±åº”è¯¥ç«‹åˆ»æ„è¯†åˆ°å¯èƒ½å­˜åœ¨ç«æ€æ¡ä»¶ã€‚</p><p>æˆ‘ä»¬å‡è®¾åº“å­˜çš„ä¸‹é™å’Œä¸Šé™åˆ†åˆ«æ˜¯(2,10)ï¼Œçº¿ç¨‹Aè°ƒç”¨setUpper(5)å°†ä¸Šé™è®¾ç½®ä¸º5ï¼Œçº¿ç¨‹Bè°ƒç”¨setLower(7)å°†ä¸‹é™è®¾ç½®ä¸º7ï¼Œå¦‚æœçº¿ç¨‹Aå’Œçº¿ç¨‹Bå®Œå…¨åŒæ—¶æ‰§è¡Œï¼Œä½ ä¼šå‘ç°çº¿ç¨‹Aèƒ½å¤Ÿé€šè¿‡å‚æ•°æ ¡éªŒï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™ï¼Œä¸‹é™è¿˜æ²¡æœ‰è¢«çº¿ç¨‹Bè®¾ç½®ï¼Œè¿˜æ˜¯2ï¼Œè€Œ5&gt;2ï¼›çº¿ç¨‹Bä¹Ÿèƒ½å¤Ÿé€šè¿‡å‚æ•°æ ¡éªŒï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™ï¼Œä¸Šé™è¿˜æ²¡æœ‰è¢«çº¿ç¨‹Aè®¾ç½®ï¼Œè¿˜æ˜¯10ï¼Œè€Œ7&lt;10ã€‚å½“çº¿ç¨‹Aå’Œçº¿ç¨‹Béƒ½é€šè¿‡å‚æ•°æ ¡éªŒåï¼Œå°±æŠŠåº“å­˜çš„ä¸‹é™å’Œä¸Šé™è®¾ç½®æˆ(7, 5)äº†ï¼Œæ˜¾ç„¶æ­¤æ—¶çš„ç»“æœæ˜¯ä¸ç¬¦åˆ<strong>åº“å­˜ä¸‹é™è¦å°äºåº“å­˜ä¸Šé™</strong>è¿™ä¸ªçº¦æŸæ¡ä»¶çš„ã€‚</p><pre><code>public class SafeWM {\n  // åº“å­˜ä¸Šé™\n  private final AtomicLong upper =\n        new AtomicLong(0);\n  // åº“å­˜ä¸‹é™\n  private final AtomicLong lower =\n        new AtomicLong(0);\n  // è®¾ç½®åº“å­˜ä¸Šé™\n  void setUpper(long v){\n    // æ£€æŸ¥å‚æ•°åˆæ³•æ€§\n    if (v &lt; lower.get()) {\n      throw new IllegalArgumentException();\n    }\n    upper.set(v);\n  }\n  // è®¾ç½®åº“å­˜ä¸‹é™\n  void setLower(long v){\n    // æ£€æŸ¥å‚æ•°åˆæ³•æ€§\n    if (v &gt; upper.get()) {\n      throw new IllegalArgumentException();\n    }\n    lower.set(v);\n  }\n  // çœç•¥å…¶ä»–ä¸šåŠ¡ä»£ç \n}\n</code></pre><p>åœ¨æ²¡æœ‰è¯†åˆ«å‡º<strong>åº“å­˜ä¸‹é™è¦å°äºåº“å­˜ä¸Šé™</strong>è¿™ä¸ªçº¦æŸæ¡ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬åˆ¶å®šçš„å¹¶å‘è®¿é—®ç­–ç•¥æ˜¯åˆ©ç”¨åŸå­ç±»ï¼Œä½†æ˜¯è¿™ä¸ªç­–ç•¥ï¼Œå®Œå…¨ä¸èƒ½ä¿è¯<strong>åº“å­˜ä¸‹é™è¦å°äºåº“å­˜ä¸Šé™</strong>è¿™ä¸ªçº¦æŸæ¡ä»¶ã€‚æ‰€ä»¥è¯´ï¼Œåœ¨è®¾è®¡é˜¶æ®µï¼Œæˆ‘ä»¬<strong>ä¸€å®šè¦è¯†åˆ«å‡ºæ‰€æœ‰å…±äº«å˜é‡ä¹‹é—´çš„çº¦æŸæ¡ä»¶ï¼Œå¦‚æœçº¦æŸæ¡ä»¶è¯†åˆ«ä¸è¶³ï¼Œå¾ˆå¯èƒ½å¯¼è‡´åˆ¶å®šçš„å¹¶å‘è®¿é—®ç­–ç•¥å—è¾•åŒ—è¾™</strong>ã€‚</p><p>å…±äº«å˜é‡ä¹‹é—´çš„çº¦æŸæ¡ä»¶ï¼Œåæ˜ åœ¨ä»£ç é‡Œï¼ŒåŸºæœ¬ä¸Šéƒ½ä¼šæœ‰ifè¯­å¥ï¼Œæ‰€ä»¥ï¼Œä¸€å®šè¦ç‰¹åˆ«æ³¨æ„ç«æ€æ¡ä»¶ã€‚</p><h2>ä¸‰ã€åˆ¶å®šå¹¶å‘è®¿é—®ç­–ç•¥</h2><p>åˆ¶å®šå¹¶å‘è®¿é—®ç­–ç•¥ï¼Œæ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„äº‹æƒ…ã€‚åº”è¯¥è¯´æ•´ä¸ªä¸“æ éƒ½æ˜¯åœ¨å°è¯•æå®šå®ƒã€‚ä¸è¿‡ä»æ–¹æ¡ˆä¸Šæ¥çœ‹ï¼Œæ— å¤–ä¹å°±æ˜¯ä»¥ä¸‹â€œä¸‰ä»¶äº‹â€ã€‚</p><ol>\n<li>é¿å…å…±äº«ï¼šé¿å…å…±äº«çš„æŠ€æœ¯ä¸»è¦æ˜¯åˆ©äºçº¿ç¨‹æœ¬åœ°å­˜å‚¨ä»¥åŠä¸ºæ¯ä¸ªä»»åŠ¡åˆ†é…ç‹¬ç«‹çš„çº¿ç¨‹ã€‚</li>\n<li>ä¸å˜æ¨¡å¼ï¼šè¿™ä¸ªåœ¨Javaé¢†åŸŸåº”ç”¨çš„å¾ˆå°‘ï¼Œä½†åœ¨å…¶ä»–é¢†åŸŸå´æœ‰ç€å¹¿æ³›çš„åº”ç”¨ï¼Œä¾‹å¦‚Actoræ¨¡å¼ã€CSPæ¨¡å¼ä»¥åŠå‡½æ•°å¼ç¼–ç¨‹çš„åŸºç¡€éƒ½æ˜¯ä¸å˜æ¨¡å¼ã€‚</li>\n<li>ç®¡ç¨‹åŠå…¶ä»–åŒæ­¥å·¥å…·ï¼šJavaé¢†åŸŸä¸‡èƒ½çš„è§£å†³æ–¹æ¡ˆæ˜¯ç®¡ç¨‹ï¼Œä½†æ˜¯å¯¹äºå¾ˆå¤šç‰¹å®šåœºæ™¯ï¼Œä½¿ç”¨Javaå¹¶å‘åŒ…æä¾›çš„è¯»å†™é”ã€å¹¶å‘å®¹å™¨ç­‰åŒæ­¥å·¥å…·ä¼šæ›´å¥½ã€‚</li>\n</ol><p>æ¥ä¸‹æ¥åœ¨å’±ä»¬ä¸“æ çš„ç¬¬äºŒæ¨¡å—æˆ‘ä¼šä»”ç»†è®²è§£Javaå¹¶å‘å·¥å…·ç±»ä»¥åŠä»–ä»¬çš„åº”ç”¨åœºæ™¯ï¼Œåœ¨ç¬¬ä¸‰æ¨¡å—æˆ‘è¿˜ä¼šè®²è§£å¹¶å‘ç¼–ç¨‹çš„è®¾è®¡æ¨¡å¼ï¼Œè¿™äº›éƒ½æ˜¯å’Œåˆ¶å®šå¹¶å‘è®¿é—®ç­–ç•¥æœ‰å…³çš„ã€‚</p><p>é™¤äº†è¿™äº›æ–¹æ¡ˆä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å®è§‚çš„åŸåˆ™éœ€è¦ä½ äº†è§£ã€‚è¿™äº›å®è§‚åŸåˆ™ï¼Œæœ‰åŠ©äºä½ å†™å‡ºâ€œå¥å£®â€çš„å¹¶å‘ç¨‹åºã€‚è¿™äº›åŸåˆ™ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰æ¡ã€‚</p><ol>\n<li>ä¼˜å…ˆä½¿ç”¨æˆç†Ÿçš„å·¥å…·ç±»ï¼šJava SDKå¹¶å‘åŒ…é‡Œæä¾›äº†ä¸°å¯Œçš„å·¥å…·ç±»ï¼ŒåŸºæœ¬ä¸Šèƒ½æ»¡è¶³ä½ æ—¥å¸¸çš„éœ€è¦ï¼Œå»ºè®®ä½ ç†Ÿæ‚‰å®ƒä»¬ï¼Œç”¨å¥½å®ƒä»¬ï¼Œè€Œä¸æ˜¯è‡ªå·±å†â€œå‘æ˜è½®å­â€ï¼Œæ¯•ç«Ÿå¹¶å‘å·¥å…·ç±»ä¸æ˜¯éšéšä¾¿ä¾¿å°±èƒ½å‘æ˜æˆåŠŸçš„ã€‚</li>\n<li>è¿«ä¸å¾—å·²æ—¶æ‰ä½¿ç”¨ä½çº§çš„åŒæ­¥åŸè¯­ï¼šä½çº§çš„åŒæ­¥åŸè¯­ä¸»è¦æŒ‡çš„æ˜¯synchronizedã€Lockã€Semaphoreç­‰ï¼Œè¿™äº›è™½ç„¶æ„Ÿè§‰ç®€å•ï¼Œä½†å®é™…ä¸Šå¹¶æ²¡é‚£ä¹ˆç®€å•ï¼Œä¸€å®šè¦å°å¿ƒä½¿ç”¨ã€‚</li>\n<li>é¿å…è¿‡æ—©ä¼˜åŒ–ï¼šå®‰å…¨ç¬¬ä¸€ï¼Œå¹¶å‘ç¨‹åºé¦–å…ˆè¦ä¿è¯å®‰å…¨ï¼Œå‡ºç°æ€§èƒ½ç“¶é¢ˆåå†ä¼˜åŒ–ã€‚åœ¨è®¾è®¡æœŸå’Œå¼€å‘æœŸï¼Œå¾ˆå¤šäººç»å¸¸ä¼šæƒ…ä¸è‡ªç¦åœ°é¢„ä¼°æ€§èƒ½çš„ç“¶é¢ˆï¼Œå¹¶å¯¹æ­¤å®æ–½ä¼˜åŒ–ï¼Œä½†æ®‹é…·çš„ç°å®å´æ˜¯ï¼šæ€§èƒ½ç“¶é¢ˆä¸æ˜¯ä½ æƒ³é¢„ä¼°å°±èƒ½é¢„ä¼°çš„ã€‚</li>\n</ol><h2>æ€»ç»“</h2><p>åˆ©ç”¨é¢å‘å¯¹è±¡æ€æƒ³ç¼–å†™å¹¶å‘ç¨‹åºï¼Œä¸€ä¸ªå…³é”®ç‚¹å°±æ˜¯åˆ©ç”¨é¢å‘å¯¹è±¡é‡Œçš„å°è£…ç‰¹æ€§ï¼Œç”±äºç¯‡å¹…åŸå› ï¼Œè¿™é‡Œæˆ‘åªåšäº†ç®€å•ä»‹ç»ï¼Œè¯¦ç»†çš„ä½ å¯ä»¥å€ŸåŠ©ç›¸å…³èµ„æ–™å®šå‘å­¦ä¹ ã€‚è€Œå¯¹å…±äº«å˜é‡è¿›è¡Œå°è£…ï¼Œè¦é¿å…â€œé€¸å‡ºâ€ï¼Œæ‰€è°“â€œé€¸å‡ºâ€ç®€å•è®²å°±æ˜¯å…±äº«å˜é‡é€ƒé€¸åˆ°å¯¹è±¡çš„å¤–é¢ï¼Œæ¯”å¦‚åœ¨<a href=\"https://time.geekbang.org/column/article/84017\">ã€Š02 | Javaå†…å­˜æ¨¡å‹ï¼šçœ‹Javaå¦‚ä½•è§£å†³å¯è§æ€§å’Œæœ‰åºæ€§é—®é¢˜ã€‹</a>é‚£ä¸€ç¯‡æˆ‘ä»¬å·²ç»è®²è¿‡æ„é€ å‡½æ•°é‡Œçš„thisâ€œé€¸å‡ºâ€ã€‚è¿™äº›éƒ½æ˜¯å¿…é¡»è¦é¿å…çš„ã€‚</p><p>è¿™æ˜¯æˆ‘ä»¬ä¸“æ å¹¶å‘ç†è®ºåŸºç¡€çš„æœ€åä¸€éƒ¨åˆ†å†…å®¹ï¼Œè¿™ä¸€éƒ¨åˆ†å†…å®¹ä¸»è¦æ˜¯è®©ä½ å¯¹å¹¶å‘ç¼–ç¨‹æœ‰ä¸€ä¸ªå…¨é¢çš„è®¤è¯†ï¼Œè®©ä½ äº†è§£å¹¶å‘ç¼–ç¨‹é‡Œçš„å„ç§æ¦‚å¿µï¼Œä»¥åŠå®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼Œå½“ç„¶ç»ˆæç›®æ ‡æ˜¯è®©ä½ çŸ¥é“é‡åˆ°å¹¶å‘é—®é¢˜è¯¥æ€ä¹ˆæ€è€ƒã€‚è¿™éƒ¨åˆ†çš„å†…å®¹è¿˜æ˜¯æœ‰ç‚¹çƒ§è„‘çš„ï¼Œä½†ä¸“æ åé¢å‡ ä¸ªæ¨¡å—çš„å†…å®¹éƒ½æ˜¯å…·ä½“çš„å®è·µéƒ¨åˆ†ï¼Œç›¸å¯¹æ¥è¯´å°±å®¹æ˜“å¤šäº†ã€‚æˆ‘ä»¬ä¸€èµ·åšæŒå§ï¼</p><h2>è¯¾åæ€è€ƒ</h2><p>æœ¬æœŸç¤ºä¾‹ä»£ç ä¸­ï¼Œç±»SafeWMä¸æ»¡è¶³åº“å­˜ä¸‹é™è¦å°äºåº“å­˜ä¸Šé™è¿™ä¸ªçº¦æŸæ¡ä»¶ï¼Œé‚£ä½ æ¥è¯•è¯•ä¿®æ”¹ä¸€ä¸‹ï¼Œè®©å®ƒèƒ½å¤Ÿåœ¨å¹¶å‘æ¡ä»¶ä¸‹æ»¡è¶³åº“å­˜ä¸‹é™è¦å°äºåº“å­˜ä¸Šé™è¿™ä¸ªçº¦æŸæ¡ä»¶ã€‚</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºä¸æˆ‘åˆ†äº«ä½ çš„æƒ³æ³•ï¼Œä¹Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºè®°å½•ä½ çš„æ€è€ƒè¿‡ç¨‹ã€‚æ„Ÿè°¢é˜…è¯»ï¼Œå¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ã€‚</p><h2>å»¶ä¼¸é˜…è¯»</h2><p>å…³äºè¿™éƒ¨åˆ†çš„å†…å®¹ï¼Œå¦‚æœä½ è§‰å¾—è¿˜ä¸â€œè¿‡ç˜¾â€ï¼Œè¿™é‡Œæˆ‘å†ç»™ä½ æ¨èä¸€æœ¬ä¹¦å§â€”â€”<a href=\"time://mall?url=https%3A%2F%2Fh5.youzan.com%2Fv2%2Fgoods%2F2758xqdzr6uuw\">ã€ŠJavaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹</a>ï¼Œè¿™æœ¬ä¹¦çš„ç¬¬ä¸‰ç« ã€Šå¯¹è±¡çš„å…±äº«ã€‹ã€ç¬¬å››ç« ã€Šå¯¹è±¡çš„ç»„åˆã€‹å…¨é¢åœ°ä»‹ç»äº†å¦‚ä½•æ„å»ºçº¿ç¨‹å®‰å…¨çš„å¯¹è±¡ï¼Œä½ å¯ä»¥æ‹¿æ¥æ·±å…¥åœ°å­¦ä¹ ã€‚</p><p></p>","comments":[{"had_liked":false,"id":79900,"user_name":"magict4","can_delete":false,"product_type":"c1","uid":1043789,"ip_address":"","ucode":"CB6F063D881AAC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ed/4d/1d1a1a00.jpg","comment_is_top":false,"comment_ctime":1553570961,"is_pvip":false,"replies":[{"id":"29317","content":"ğŸ‘ğŸ‘<br>","user_name":"ä½œè€…å›å¤","comment_id":79900,"uid":"1269969","ip_address":"","utype":1,"ctime":1553695588,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":14,"race_medal":0,"score":"714518142097","product_id":100023901,"comment_content":"1. setUpper() è·Ÿ setLower() éƒ½åŠ ä¸Š &quot;synchronized&quot; å…³é”®å­—ã€‚ä¸è¦å¤ªåœ¨æ„æ€§èƒ½ï¼Œè€å¸ˆéƒ½è¯´äº†ï¼Œé¿å…è¿‡æ—©ä¼˜åŒ–ã€‚<br>2. å¦‚æœæ€§èƒ½æœ‰é—®é¢˜ï¼Œå¯ä»¥æŠŠ lower è·Ÿ upper ä¸¤ä¸ªå˜é‡å°è£…åˆ°ä¸€ä¸ªç±»ä¸­ï¼Œä¾‹å¦‚<br>```<br>public class Boundary {<br>    private final lower;<br>    private final upper;<br>    <br>    public Boundary(long lower, long upper) {<br>        if(lower &gt;= upper) {<br>            &#47;&#47; throw exception<br>        }<br>        this.lower = lower;<br>        this.upper = upper;<br>    }<br>}<br>```<br>ç§»é™¤ SafeVM çš„ setUpper() è·Ÿ setLower() æ–¹æ³•ï¼Œå¹¶å¢å…¥ setBoundary(Boundary boundary) æ–¹æ³•ã€‚","like_count":166,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444676,"discussion_content":"ğŸ‘ğŸ‘\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553695588,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1117530,"avatar":"https://static001.geekbang.org/account/avatar/00/11/0d/5a/e60f4125.jpg","nickname":"camel","note":"","ucode":"D0D698CD74388F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":267837,"discussion_content":"æ–¹æ³•äºŒçš„æ€§èƒ½çœŸçš„æœ‰ä¼˜åŒ–å—ï¼Ÿå¤šçº¿ç¨‹åœºæ™¯ä¸‹upperå’Œloweræ˜¯åœ¨ä¸¤ä¸ªçº¿ç¨‹é‡Œä¸èƒ½åœ¨ä¸€ä¸ªå‡½æ•°å†…åŒæ—¶set","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1589698735,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1099706,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c7/ba/4c449be2.jpg","nickname":"zhaozp","note":"","ucode":"BF390F5ED762CD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1117530,"avatar":"https://static001.geekbang.org/account/avatar/00/11/0d/5a/e60f4125.jpg","nickname":"camel","note":"","ucode":"D0D698CD74388F","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":300368,"discussion_content":"å¯ä»¥åªè®¾ç½®1ä¸ªï¼Œå¦ä¸€ä¸ªä»dbé‡ŒæŸ¥è¯¢ï¼Œæˆ–è€…åœ¨update sqlæ¡ä»¶åŠ  where low < upperé™åˆ¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598065877,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":267837,"ip_address":""},"score":300368,"extra":""}]},{"author":{"id":1132661,"avatar":"https://static001.geekbang.org/account/avatar/00/11/48/75/02b4366a.jpg","nickname":"ä¹˜åTornadoçš„çº¿ç¨‹é­”æ³•å¸ˆ","note":"","ucode":"C4C9915866E769","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":139680,"discussion_content":"åœ¨ç”Ÿæˆç±»å®ä¾‹çš„æ—¶å€™ï¼Œä¸ä¼šæœ‰å¹¶å‘é—®é¢˜å§ï¼Œæ„é€ å‡½æ•°æœ¬èº«å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1579311094,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1335293,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKR3ibELhjgVicCNShZCBwvaDxibnzibggG4wUzVkS2mkDxUBZyIs87nDEdJ7PiahJBVoZcuhQ84RxAziag/132","nickname":"å‘¨æ²»æ…§","note":"","ucode":"7D56C4E66BEE17","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":63188,"discussion_content":"æ–¹æ¡ˆäºŒæ²¡æ‡‚ èƒ½ç»™è§£é‡Šä¸‹å—","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1574867681,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1589208,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTITcwicqBDYzXtLibUtian172tPs7rJpqG1Vab4oGjnguA9ziaYjDCILSGaS6qRiakvRdUEhdmSG0BGPKw/132","nickname":"å¤§é¥¶Raysir","note":"","ucode":"0AFA191420A30D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1335293,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKR3ibELhjgVicCNShZCBwvaDxibnzibggG4wUzVkS2mkDxUBZyIs87nDEdJ7PiahJBVoZcuhQ84RxAziag/132","nickname":"å‘¨æ²»æ…§","note":"","ucode":"7D56C4E66BEE17","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":211817,"discussion_content":"æˆ‘çš„ç†è§£æ˜¯setæ–¹æ³•çº¿ç¨‹ä¸å®‰å…¨çš„ç‚¹åœ¨äºç«æ€æ¡ä»¶ä¸­è·å–åˆ°çš„å€¼é€šè¿‡äº†åˆ¤æ–­ï¼Œä½†æ˜¯åœ¨setçš„æ—¶å€™å¯èƒ½ä¸æ˜¯æœ€æ–°çš„ã€‚æ–¹æ³•äºŒç±»å°è£…çš„ä¸¤ä¸ªå±æ€§éƒ½æ˜¯ä¸å¯å˜çš„ï¼Œåœ¨setBoundary()æ–¹æ³•ä¸­å»èµ‹å€¼å°±ä¸ä¼šå­˜åœ¨å€¼è¢«æ›´æ–°çš„æƒ…å†µï¼Œç±»ä¼¼äºThreadLocalçš„ç‹¬ç«‹å‰¯æœ¬","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1584889061,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":63188,"ip_address":""},"score":211817,"extra":""},{"author":{"id":1194858,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3b/6a/80d9c545.jpg","nickname":"RD","note":"","ucode":"E3947B6E1681AD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1589208,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTITcwicqBDYzXtLibUtian172tPs7rJpqG1Vab4oGjnguA9ziaYjDCILSGaS6qRiakvRdUEhdmSG0BGPKw/132","nickname":"å¤§é¥¶Raysir","note":"","ucode":"0AFA191420A30D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":296659,"discussion_content":"ä½ è¿™å’‹è°ƒæ•´åº“å­˜å•Šï¼Œæ¯æ¬¡éƒ½ new ä¸€ä¸ªå¯¹è±¡å˜›ã€‚ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596615650,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":211817,"ip_address":""},"score":296659,"extra":""},{"author":{"id":1554995,"avatar":"https://static001.geekbang.org/account/avatar/00/17/ba/33/2d83d174.jpg","nickname":"æ—¶å…‰å®ˆæŠ¤è€…-åŸºå…°","note":"","ucode":"F0B0887B1979D2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1194858,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3b/6a/80d9c545.jpg","nickname":"RD","note":"","ucode":"E3947B6E1681AD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362397,"discussion_content":"åº”è¯¥æ˜¯æ¯æ¬¡è°ƒç”¨setBoundaryå»newä¸€ä¸ªBoundaryå¯¹è±¡ï¼Œç±»ä¼¼çº¿ç¨‹å°é—­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„Boundaryå¯¹è±¡ï¼Œä¸å­˜åœ¨å¹¶å‘å®‰å…¨é—®é¢˜","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1616936753,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":296659,"ip_address":""},"score":362397,"extra":""}]},{"author":{"id":1237399,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e1/97/fec494f2.jpg","nickname":"å¤§å¤§ã€‚","note":"","ucode":"A6716E46264AC4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":65175,"discussion_content":"æˆ‘è§‰å¾—åŠ lockç»™è¿™ä¸¤ä¸ªsetæ–¹æ³•å°±å¯ä»¥äº†ï¼Œä½ è¿™ä¸ªåŒ…è£…æˆç±»çš„ï¼Œå¦‚æœåªè®¾ç½®ä¸€ä¸ªå€¼çš„æ—¶å€™ï¼Œè¿˜æ˜¯éœ€è¦å»getå¦å¤–ä¸€ä¸ªå€¼","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1574988261,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2721761,"avatar":"https://static001.geekbang.org/account/avatar/00/29/87/e1/b85dce85.jpg","nickname":"æ— å°½è”šè“","note":"","ucode":"A665DF46833A81","race_medal":5,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559847,"discussion_content":"å™¢ï¼Œç¬¬äºŒä¸ªæ–¹æ³•æ˜¯ä¸æ˜¯è¿˜è¦ä¿®æ”¹åŸæ¥çš„ä¸¤ä¸ªupper å’Œloweræˆå‘˜å˜é‡å˜æˆä¸€ä¸ªBoundaryï¼Ÿè¿™æ ·å°±å¯ä»¥çº¿ç¨‹å®‰å…¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648997913,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2721761,"avatar":"https://static001.geekbang.org/account/avatar/00/29/87/e1/b85dce85.jpg","nickname":"æ— å°½è”šè“","note":"","ucode":"A665DF46833A81","race_medal":5,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559844,"discussion_content":"è¯·é—®ç¬¬äºŒä¸ªæ–¹æ³•å¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è¿›å…¥setBounderyä¸ä¼šæœ‰çº¿ç¨‹å®‰å…¨çš„é—®é¢˜å—ï¼Œæ¯”å¦‚ä¸€ä¸ªset(3,4) ä¸€ä¸ªset(5,6)æœ€åboundaryä¸€å®šä¸ä¼šå˜æˆ(3,6)å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648997732,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1277081,"avatar":"https://static001.geekbang.org/account/avatar/00/13/7c/99/4dac6ce6.jpg","nickname":"lakeslove","note":"","ucode":"65E14D29D3C981","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318449,"discussion_content":"æ–¹æ³•äºŒçš„å±æ€§ç”¨finalä¿®é¥°å´ä¸€å¼€å§‹ä¸èµ‹å€¼ï¼Œç›´æ¥ç¼–è¯‘æŠ¥é”™å•Šã€‚ã€‚ã€‚ã€‚éš¾é“ä½ ä»¬çš„ç¼–è¯‘å™¨ä¸æŠ¥é”™å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603757566,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1758825,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/d6/69/f59d4f6f.jpg","nickname":"Ryan","note":"","ucode":"387955FD53E98C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1277081,"avatar":"https://static001.geekbang.org/account/avatar/00/13/7c/99/4dac6ce6.jpg","nickname":"lakeslove","note":"","ucode":"65E14D29D3C981","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413744,"discussion_content":"å¯¹è±¡çš„finalå­—æ®µç›´æ¥èµ‹å€¼å’Œåœ¨æ„é€ æ–¹æ³•é‡Œèµ‹å€¼æ˜¯ä¸€æ ·çš„ï¼Œç¼–è¯‘åéƒ½æ˜¯åœ¨æ„é€ æ–¹æ³•é‡Œè¿›è¡Œèµ‹å€¼çš„ï¼Œçœ‹ä¸€ä¸‹å­—èŠ‚ç å°±çŸ¥é“äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636553515,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":318449,"ip_address":""},"score":413744,"extra":""}]},{"author":{"id":1156592,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a5/f0/8648c464.jpg","nickname":"Joker","note":"","ucode":"126AF848001A1E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":42998,"discussion_content":"è€å“¥ï¼Œç¨³å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572839735,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":80108,"user_name":"æµ·é¸¿","can_delete":false,"product_type":"c1","uid":1104275,"ip_address":"","ucode":"7074EF94EA70AD","user_header":"https://static001.geekbang.org/account/avatar/00/10/d9/93/098e5ef5.jpg","comment_is_top":false,"comment_ctime":1553606753,"is_pvip":false,"replies":[{"id":"29233","content":"ç›¸å½“æ­£ç¡®ï¼<br>","user_name":"ä½œè€…å›å¤","comment_id":80108,"uid":"1269969","ip_address":"","utype":1,"ctime":1553647154,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":8,"race_medal":0,"score":"250661709921","product_id":100023901,"comment_content":"æˆ‘çœ‹æœ‰äº›äººè¯„è®ºç”¨volatieï¼Œvolatieåªèƒ½ä¿è¯å¯è§æ€§ï¼Œä½†æ˜¯ä¿è¯ä¸äº†åŸå­æ€§ï¼Œæ‰€ä»¥å¾—åŠ é”ä¿è¯äº’æ–¥ã€‚<br>è€å¸ˆæˆ‘è¿™æ ·ç†è§£å¯¹å—ï¼Ÿ","like_count":58,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444754,"discussion_content":"ç›¸å½“æ­£ç¡®ï¼\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553647154,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2060756,"avatar":"","nickname":"åœ¨ä¸‹èŸ‘è‚ç‹","note":"","ucode":"E66A65A327095A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":307816,"discussion_content":"ä¸æ‡‚å°±é—®ã€‚atomicä¸æ˜¯å·²ç»ä¿è¯åŸå­æ€§äº†ä¹ˆï¼Œé‚£ä¹ˆåŠ ä¸Švolatileä¸æ˜¯å¯è§åŸå­ä¸¤å¼€èŠ±ï¼Ÿ","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1600765759,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1687656,"avatar":"https://static001.geekbang.org/account/avatar/00/19/c0/68/314e8306.jpg","nickname":"å¨å…ˆæ£®","note":"","ucode":"5F445C6832274B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2060756,"avatar":"","nickname":"åœ¨ä¸‹èŸ‘è‚ç‹","note":"","ucode":"E66A65A327095A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":359215,"discussion_content":"ä¸¤å¼€èŠ±ç‰›é€¼å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616143050,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":307816,"ip_address":""},"score":359215,"extra":""},{"author":{"id":1554995,"avatar":"https://static001.geekbang.org/account/avatar/00/17/ba/33/2d83d174.jpg","nickname":"æ—¶å…‰å®ˆæŠ¤è€…-åŸºå…°","note":"","ucode":"F0B0887B1979D2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2060756,"avatar":"","nickname":"åœ¨ä¸‹èŸ‘è‚ç‹","note":"","ucode":"E66A65A327095A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362401,"discussion_content":"è¿™é‡Œè¯´çš„åŸå­æ€§åº”è¯¥æ˜¯ä¸šåŠ¡ä¸Šçš„åŸå­æ€§å§ï¼Œ10-2ä¿®æ”¹ä¸º5-7å¤±è´¥è€Œä¸æ˜¯å¤šä¸ªçº¿ç¨‹å¯¹10ä¿®æ”¹ä¸º5çš„åŸå­æ€§ï¼ˆè¯»ï¼Œä¿®æ”¹ï¼Œèµ‹å€¼ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616936991,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":307816,"ip_address":""},"score":362401,"extra":""},{"author":{"id":2555948,"avatar":"","nickname":"Geek_b76b97","note":"","ucode":"5968DEF6D0018B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2060756,"avatar":"","nickname":"åœ¨ä¸‹èŸ‘è‚ç‹","note":"","ucode":"E66A65A327095A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367057,"discussion_content":"å› ä¸ºä¸¤ä¸ªå…±äº«å˜é‡æ˜¯æœ‰è”ç³»çš„ï¼Œä¸€ä¸ªå˜é‡çš„åŸå­æ€§å¹¶ä¸èƒ½ä¿è¯å¤šä¸ªå˜é‡æ•´ä½“çš„åŸå­æ€§ï¼Œvolatileæ˜¯å¤šä¸ªçº¿ç¨‹å¯¹ä¸€ä¸ªå˜é‡æ—¶æœ‰æ•ˆï¼Œåƒè¿™ç§å¤šä¸ªå˜é‡çš„å°±æ— æ•ˆäº†ï¼Œä»æ•´ä½“ç±»çš„å±‚é¢åº”è¯¥åŠ synchronized","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1618241249,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":307816,"ip_address":""},"score":367057,"extra":""}]},{"author":{"id":3067096,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/cc/d8/6cdd4b15.jpg","nickname":"ä¸€å¦‚å¾€å¸¸i","note":"","ucode":"C9A5AEA38B3E97","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586408,"discussion_content":"è¯´å¾—å¥½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662191722,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ¹–å—"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2410092,"avatar":"https://static001.geekbang.org/account/avatar/00/24/c6/6c/a400175a.jpg","nickname":"FARO_Z","note":"","ucode":"B33BCC36C2A74E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580094,"discussion_content":"å•ä¸ªAtomicæ˜¯åŸå­çš„ï¼Œä½†æ˜¯å¯¹ä¸€ä¸ªè¯»å¦ä¸€ä¸ªå†™çš„æ“ä½œä¸æ˜¯åŸå­çš„ï¼Œæœ‰ç«æ€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657870622,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79928,"user_name":"æ±Ÿå—è±†æ²™åŒ…","can_delete":false,"product_type":"c1","uid":1061596,"ip_address":"","ucode":"4B7833260F9F2F","user_header":"https://static001.geekbang.org/account/avatar/00/10/32/dc/d3e3847f.jpg","comment_is_top":false,"comment_ctime":1553575831,"is_pvip":false,"replies":[{"id":"29235","content":"æ„Ÿè°¢ä¿¡ä»»ï¼æˆ‘ä»¬è¿™é‡Œè¯´çš„å…±äº«æ˜¯è¿›ç¨‹çº§åˆ«çš„ï¼Œå¦‚æœæ˜¯åˆ†å¸ƒå¼è®¡ç®—åªèƒ½é redis,db,zkè¿™äº›æ¥æåˆ†å¸ƒå¼çš„é”ï¼Œå½“ç„¶ä¸å…±äº«æ˜¯æœ€å¥½çš„è§£å†³æ–¹æ¡ˆã€‚","user_name":"ä½œè€…å›å¤","comment_id":79928,"uid":"1269969","ip_address":"","utype":1,"ctime":1553647431,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":4,"race_medal":0,"score":"126107627415","product_id":100023901,"comment_content":"ä»¤å“¥ï¼Œä¸€ç›´åœ¨è¿½ä½ çš„ä¸“æ ï¼Œç»“åˆå…¬å¸ç›®å‰å®é™…æƒ…å†µï¼Œæœ‰ä¸ªç–‘é—®ï¼Œå¦‚æœä½ ä¸“æ ä¸­çš„ä¾‹å­ä¸­çš„å…±äº«ä¿¡æ¯ï¼Œæ˜¯æ•´ä¸ªç³»ç»Ÿç»´åº¦çš„ï¼Œç³»ç»Ÿåˆæ˜¯å¤šå®ä¾‹é›†ç¾¤éƒ¨ç½²çš„ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåŠå‘¢ï¼Œèƒ½ä¸èƒ½åœ¨æ€æƒ³æˆ–å®ç°æ€è·¯ä¸Šç»™ç‚¹å»ºè®®æŒ‡å¯¼ã€‚","like_count":29,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444693,"discussion_content":"æ„Ÿè°¢ä¿¡ä»»ï¼æˆ‘ä»¬è¿™é‡Œè¯´çš„å…±äº«æ˜¯è¿›ç¨‹çº§åˆ«çš„ï¼Œå¦‚æœæ˜¯åˆ†å¸ƒå¼è®¡ç®—åªèƒ½é redis,db,zkè¿™äº›æ¥æåˆ†å¸ƒå¼çš„é”ï¼Œå½“ç„¶ä¸å…±äº«æ˜¯æœ€å¥½çš„è§£å†³æ–¹æ¡ˆã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1553647431,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2330905,"avatar":"https://static001.geekbang.org/account/avatar/00/23/91/19/6a3e7efc.jpg","nickname":"ç¨‹åºå‘˜9527","note":"","ucode":"1A1609F6BEAD84","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380293,"discussion_content":"åªèƒ½ä¿è¯å•ä¸ªjvmä¸‹çš„å¹¶å‘å®‰å…¨ï¼Œï¼Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624429727,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1131574,"avatar":"https://static001.geekbang.org/account/avatar/00/11/44/36/c5dc914f.jpg","nickname":"çŸ³å¤´","note":"","ucode":"8908B1989A3C4A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":317283,"discussion_content":"è¯·æ•™ä¸ªé—®é¢˜ï¼Œåˆ†å¸ƒå¼ç¯å¢ƒä¸‹åƒlockã€synchronized æ˜¯ä¸æ˜¯ä¸èƒ½ä¿éšœçº¿ç¨‹å®‰å…¨ï¼Œç„¶åå°±éœ€è¦åˆ†å¸ƒå¼é”è¿™ç§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603527682,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1131027,"avatar":"https://static001.geekbang.org/account/avatar/00/11/42/13/860e176a.jpg","nickname":"å¤–å›½è‚‰å¤¹é¦","note":"","ucode":"00BADDCFEA92B8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1131574,"avatar":"https://static001.geekbang.org/account/avatar/00/11/44/36/c5dc914f.jpg","nickname":"çŸ³å¤´","note":"","ucode":"8908B1989A3C4A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337701,"discussion_content":"å½“ç„¶ã€‚lockï¼Œsynchronizedéƒ½åªæ˜¯å•æœºçš„èŒƒç•´ã€‚å¦‚æœæœ‰å¤šå°æœºå™¨ï¼Œé‚£å°±è¦ä½¿ç”¨å…¶ä»–ç±»å‹çš„é”","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1609050544,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":317283,"ip_address":""},"score":337701,"extra":""}]}]},{"had_liked":false,"id":80568,"user_name":"QQæ€ª","can_delete":false,"product_type":"c1","uid":1211223,"ip_address":"","ucode":"1A39B8433D9208","user_header":"https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg","comment_is_top":false,"comment_ctime":1553683041,"is_pvip":false,"replies":[{"id":"29302","content":"ğŸ‘<br>","user_name":"ä½œè€…å›å¤","comment_id":80568,"uid":"1269969","ip_address":"","utype":1,"ctime":1553693959,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"117517800033","product_id":100023901,"comment_content":"å¿…é¡»åŠ é”å•Šï¼Œsynchronized (this)å°±è¡Œäº†ï¼Œæœ€ç®€å•åŠ é”å§ï¼Œvolatileåªèƒ½ä¿è¯å†…å­˜å¯è§æ€§ï¼Œå¹¶ä¸èƒ½ä¿è¯åŸå­æ€§","like_count":27,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444908,"discussion_content":"ğŸ‘\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553693959,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":80262,"user_name":"æˆ‘æ˜¯å–æŠ¥å°è¡Œå®¶","can_delete":false,"product_type":"c1","uid":1303013,"ip_address":"","ucode":"43530EA291B66D","user_header":"https://static001.geekbang.org/account/avatar/00/13/e1/e5/815d4271.jpg","comment_is_top":false,"comment_ctime":1553645989,"is_pvip":false,"replies":[{"id":"29305","content":"ğŸ‘<br>","user_name":"ä½œè€…å›å¤","comment_id":80262,"uid":"1269969","ip_address":"","utype":1,"ctime":1553694389,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":4,"race_medal":0,"score":"70273122725","product_id":100023901,"comment_content":"å‰é¢æœ‰ä¸ªæœ‹å‹è¯´finalä¿è¯ä¸ä¼šé€ƒé€¸ï¼Œç†è§£åº”è¯¥æœ‰è¯¯ï¼Œfianlçš„ç¦æ­¢é‡æ’åºå‰ææ˜¯æ„é€ å‡½æ•°é‡Œé¢æ²¡æœ‰thisé€ƒé€¸ï¼Œä»–åªä¿è¯finalå˜é‡ä¸ä¼šé‡æ’åºåˆ°æ„é€ å‡½æ•°ä¹‹å¤–ã€‚å¹¶ä¸ä¿è¯é€ƒé€¸ã€‚","like_count":16,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444804,"discussion_content":"ğŸ‘\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553694389,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2330905,"avatar":"https://static001.geekbang.org/account/avatar/00/23/91/19/6a3e7efc.jpg","nickname":"ç¨‹åºå‘˜9527","note":"","ucode":"1A1609F6BEAD84","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380294,"discussion_content":"fianl ----> final","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624429804,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2139604,"avatar":"","nickname":"æˆç”µå¸…æ‰","note":"","ucode":"DDE757138F41D2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":345345,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611712811,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1323652,"avatar":"","nickname":"sibyl","note":"","ucode":"0D142011860D69","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":289508,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594127399,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79803,"user_name":"ç½—æ´²","can_delete":false,"product_type":"c1","uid":1263417,"ip_address":"","ucode":"68133E38A25C17","user_header":"https://static001.geekbang.org/account/avatar/00/13/47/39/0ce1aa62.jpg","comment_is_top":false,"comment_ctime":1553559748,"is_pvip":false,"replies":[{"id":"29313","content":"ğŸ‘<br>","user_name":"ä½œè€…å›å¤","comment_id":79803,"uid":"1269969","ip_address":"","utype":1,"ctime":1553695041,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":2,"race_medal":0,"score":"48798200004","product_id":100023901,"comment_content":"æ€è€ƒé¢˜:å¯¹äºä¸¤ä¸ªäº’ç›¸æ¯”è¾ƒçš„å˜é‡æ¥è¯´ï¼Œèµ‹å€¼çš„æ—¶å€™åªèƒ½åŠ é”æ¥æ§åˆ¶ã€‚ä½†æ˜¯è¿™ä¹Ÿä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ï¼Œä¸è¿‡å¯ä»¥é‡‡ç”¨è¯»é”å’Œå†™é”æ¥ä¼˜åŒ–ï¼Œç”³è¯·å†™é”äº†å°±äº’æ–¥ï¼Œè¯»é”å¯ä»¥å¹¶å‘è®¿é—®ï¼Œè¿™æ ·æ€§èƒ½ç›¸å¯¹ç²—ç²’åº¦çš„é”æ¥è¯´ä¼šé«˜ç‚¹ã€‚","like_count":11,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444632,"discussion_content":"ğŸ‘\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553695041,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2330905,"avatar":"https://static001.geekbang.org/account/avatar/00/23/91/19/6a3e7efc.jpg","nickname":"ç¨‹åºå‘˜9527","note":"","ucode":"1A1609F6BEAD84","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380296,"discussion_content":"å…±äº«å˜é‡æœ‰è¯»æœ‰å†™æ—¶ï¼Œå¹¶å‘è¯»ï¼Œäº’æ–¥å†™ï¼Œé˜”ä»¥æå‡æ€§èƒ½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624429991,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":84019,"user_name":"Boomkeeper","can_delete":false,"product_type":"c1","uid":1437444,"ip_address":"","ucode":"129C4229D50EDD","user_header":"https://static001.geekbang.org/account/avatar/00/15/ef/04/f2942f14.jpg","comment_is_top":false,"comment_ctime":1554770059,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"35914508427","product_id":100023901,"comment_content":"æˆ‘å°±ä¸æ˜ç™½äº†ï¼Œä½¿ç”¨äº†synchronizedï¼Œä¸ºå•¥è¿˜ç”¨voliateï¼Œä»–çš„ç¡®æ˜¯ä¿è¯å¯è§æ€§ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯åŸå­æ€§ï¼Œä¸€èˆ¬ä»–çš„åº”ç”¨åœºæ™¯åº”è¯¥æ˜¯ä¸ä¾èµ–ä¹‹å‰çš„ç»“æœè€Œæ”¹å˜æ•°æ®ï¼Œç´¯åŠ çš„åœºæ™¯æ˜æ˜¾ä¸é€‚åˆ","like_count":8,"discussions":[{"author":{"id":1005842,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/12/2034b163.jpg","nickname":"Android æŠ€å¸ˆ","note":"","ucode":"F7691906C86655","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":12998,"discussion_content":"ç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Ÿæ¯”å¦‚å†™å•ä¾‹çš„æ—¶å€™ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1568627033,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1264481,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4b/61/762ec306.jpg","nickname":"æˆ‘ä»¬çš„æ—¶å…‰__","note":"","ucode":"5184EDC5CA1625","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1005842,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/12/2034b163.jpg","nickname":"Android æŠ€å¸ˆ","note":"","ucode":"F7691906C86655","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":342157,"discussion_content":"æ–°ç‰ˆæœ¬çš„jdkå·²ç»å°†å®ä¾‹åŒ–å¯¹è±¡åšæˆäº†åŸå­æ“ä½œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610600752,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":12998,"ip_address":""},"score":342157,"extra":""}]}]},{"had_liked":false,"id":80316,"user_name":"zero","can_delete":false,"product_type":"c1","uid":1299615,"ip_address":"","ucode":"528DD5C8399AEC","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKlwpFM3tkeG15YqyJTYWkfqkdmro9POq6SicYm57TaEFDOUZCXjoe0Z0Iz6UibGQqic3icJRsHdFzibtw/132","comment_is_top":false,"comment_ctime":1553648863,"is_pvip":true,"replies":[{"id":"29297","content":"å¯ä»¥<br>","user_name":"ä½œè€…å›å¤","comment_id":80316,"uid":"1269969","ip_address":"","utype":1,"ctime":1553687416,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":2,"race_medal":0,"score":"35913387231","product_id":100023901,"comment_content":"public class SafeWM {<br>  &#47;&#47; åº“å­˜ä¸Šé™<br>  private final AtomicLong upper =<br>        new AtomicLong(0);<br>  &#47;&#47; åº“å­˜ä¸‹é™<br>  private final AtomicLong lower =<br>        new AtomicLong(0);<br>  &#47;&#47; è®¾ç½®åº“å­˜ä¸Šé™<br>  void setUpper(long v) {<br>    synchronized (this) {<br>      &#47;&#47; æ£€æŸ¥å‚æ•°åˆæ³•æ€§<br>      if (v &lt; lower.get()) {<br>        throw new IllegalArgumentException();<br>      }<br>      upper.set(v);<br>    }<br>  }<br>  &#47;&#47; è®¾ç½®åº“å­˜ä¸‹é™<br>  void setLower(long v) {<br>    synchronized (this) {<br>      &#47;&#47; æ£€æŸ¥å‚æ•°åˆæ³•æ€§<br>      if (v &gt; upper.get()) {<br>        throw new IllegalArgumentException();<br>      }<br>      lower.set(v);<br>    }<br>  }<br>  &#47;&#47; çœç•¥å…¶ä»–ä¸šåŠ¡ä»£ç <br>}<br><br>è€å¸ˆï¼Œè¿™æ ·å¤„ç†å¯ä»¥å—ï¼Ÿ","like_count":8,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444820,"discussion_content":"å¯ä»¥\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553687416,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1168504,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d4/78/66b3f2a2.jpg","nickname":"æ–¯ç›–ä¸¸","note":"","ucode":"B881D14B028F14","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":346374,"discussion_content":"æˆ‘è§‰å¾—ä½ è¿™ä¸ªæ¯”è¾ƒæ¸…æ™°æ˜“æ‡‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611927470,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81248,"user_name":"Cc","can_delete":false,"product_type":"c1","uid":1441727,"ip_address":"","ucode":"1B822D627C6284","user_header":"https://static001.geekbang.org/account/avatar/00/15/ff/bf/2f0a337c.jpg","comment_is_top":false,"comment_ctime":1553842195,"is_pvip":false,"replies":[{"id":"29490","content":"æˆ‘è§‰å¾—è¿™ä¸ªæ²¡æœ‰é—®é¢˜ï¼Œvolatile æ¢æˆ finalä¼šæ›´å¥½","user_name":"ä½œè€…å›å¤","comment_id":81248,"uid":"1269969","ip_address":"","utype":1,"ctime":1553906945,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":3,"race_medal":0,"score":"31618613267","product_id":100023901,"comment_content":"åˆæƒ³åˆ°ä¸€ç§ï¼Œæ—¢ç„¶ä¸¤ä¸ªå˜é‡è¦åŒæ—¶é”å®šï¼Œé‚£å°±æŠŠä¸¤ä¸ªå˜é‡å°è£…æˆä¸€ä¸ªï¼Œç„¶åä½¿ç”¨casæ“ä½œã€‚è¿™æ ·è¡Œä¸è¡Œï¼Œå¦å¤–è€å¸ˆå¸®æˆ‘çœ‹çœ‹volatileæ˜¯ä¸æ˜¯æœ‰å¤šä½™çš„åœ°æ–¹<br>Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·<br>volatile AtomicReference&lt;Inventory&gt; inventory = new AtomicReference&lt;&gt;();<br><br>    static class Inventory {<br>        private volatile long upper = 0;<br><br>        private volatile long lower = 0;<br>    }<br><br>    void setUpper(long v) {<br>        long low;<br>        Inventory oldObj;<br>        Inventory newObj;<br>        do {<br>            oldObj = inventory.get();<br>            if (v &gt;= (low = oldObj.lower)) {<br>                throw new IllegalArgumentException();<br>            }<br>            newObj = new Inventory();<br>            newObj.lower = low;<br>            newObj.upper = v;<br><br>        } while (inventory.compareAndSet(oldObj, newObj));<br>    }<br><br>    void setLower(long v) {<br>        long upp;<br>        Inventory oldObj;<br>        Inventory newObj;<br>        do {<br>            oldObj = inventory.get();<br>            if (v &lt;= (upp = oldObj.upper)) {<br>                throw new IllegalArgumentException();<br>            }<br>            newObj = new Inventory();<br>            newObj.lower = v;<br>            newObj.upper = upp;<br><br>        } while (inventory.compareAndSet(oldObj, newObj));<br>    }<br><br><br>","like_count":7,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445131,"discussion_content":"æˆ‘è§‰å¾—è¿™ä¸ªæ²¡æœ‰é—®é¢˜ï¼Œvolatile æ¢æˆ finalä¼šæ›´å¥½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553906945,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1105958,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e0/26/4942a09e.jpg","nickname":"çŒ«å¤´é¹°çˆ±æ‹¿é“","note":"","ucode":"24266B58968428","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":87296,"discussion_content":"å¤§å°ä¸æ˜¯ä¸æ˜¯å†™åäº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1576659566,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1594508,"avatar":"https://static001.geekbang.org/account/avatar/00/18/54/8c/a3b98f6c.jpg","nickname":"denofiend","note":"","ucode":"FC9A750C96E01C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533977,"discussion_content":"ABAé—®é¢˜å‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638053219,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":259577,"user_name":"Geek_a8e9a2","can_delete":false,"product_type":"c1","uid":2264928,"ip_address":"","ucode":"79C4B82B7DAE59","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/GbZRicqbu1QJmlcOlfLyW46Mre1I2iagu0PjicL5g3jv1wqOy0QoA0lVyM4lNrBrqiaByURbeYuibU0knicQFmhnJcMg/132","comment_is_top":false,"comment_ctime":1604758898,"is_pvip":false,"replies":[{"id":"94360","content":"æƒ³äº†åŠå¤©ï¼Œåº”è¯¥æ²¡é—®é¢˜","user_name":"ä½œè€…å›å¤","comment_id":259577,"uid":"1269969","ip_address":"","utype":1,"ctime":1604804672,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":4,"race_medal":0,"score":"18784628082","product_id":100023901,"comment_content":"è€å¸ˆï¼Œè¿™ä¸ªæ–¹æ¡ˆå¦‚ä½•ï¼Ÿ<br>public class SafeVm {<br>    private volatile long upNum = 10;<br>    private volatile long lowNum = 1;<br>    private ReadWriteLock upLock = new ReentrantReadWriteLock();<br>    private ReadWriteLock lowLock = new ReentrantReadWriteLock();<br><br>    void setUpper(long newUpValue) {<br>        lowLock.readLock().lock();<br>        try {<br>            if (newUpValue &lt; lowNum) {<br>                throw new IllegalArgumentException();<br>            }<br>            upLock.writeLock().lock();<br>            try {<br>                upNum = newUpValue;<br>            } finally {<br>                upLock.writeLock().unlock();<br>            }<br>        } finally {<br>            lowLock.readLock().unlock();<br>        }<br>    }<br><br>    void setLower(long newLowValue) {<br>        upLock.readLock().lock();<br>        try {<br>            if (newLowValue &gt; upNum) {<br>                throw new IllegalArgumentException();<br>            }<br>            lowLock.writeLock().lock();<br>            try {<br>                lowNum = newLowValue;<br>            } finally {<br>                lowLock.writeLock().unlock();<br>            }<br>        } finally {<br>            upLock.readLock().unlock();<br>        }<br>    }<br>}","like_count":4,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":508965,"discussion_content":"æƒ³äº†åŠå¤©ï¼Œåº”è¯¥æ²¡é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604804672,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1855137,"avatar":"","nickname":"Geek_e6f358","note":"","ucode":"C21E94A90258A2","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384846,"discussion_content":"é—®ä¸ªé—®é¢˜ï¼Œæ„Ÿè§‰è¿™æ ·ä¼šæ­»é”ã€‚çº¿ç¨‹1ã€2åŒæ—¶æ‰§è¡ŒsetUpperã€setLowerï¼Œçº¿ç¨‹1æ‹¿åˆ°   lowLockçš„è¯»é”ï¼Œçº¿ç¨‹2æ‹¿åˆ°upLockçš„è¯»é”ã€‚çº¿ç¨‹1æ‰§è¡Œ upLock.writeLock().lock()æ—¶éœ€è¦çº¿ç¨‹2å…ˆé‡Šæ”¾è¯»é”ï¼Œçº¿ç¨‹2æ‰§è¡Œ lowLock.writeLock().lock()éœ€è¦çº¿ç¨‹1é‡Šæ”¾è¯»é”ï¼Œè¿™ä¸å°±æ­»é”äº†å—ï¼Ÿ","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1626770994,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1628434,"avatar":"https://static001.geekbang.org/account/avatar/00/18/d9/12/71db1407.jpg","nickname":"L","note":"","ucode":"A5CB3F1B4975BE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551419,"discussion_content":"ï¼Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645012768,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1100655,"avatar":"https://static001.geekbang.org/account/avatar/00/10/cb/6f/c78ef1cf.jpg","nickname":"ç‹äºŒåŒ—","note":"","ucode":"D9090E28B3E1F0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386805,"discussion_content":"ä¼šæ­»é”ï¼Œè¯»å†™äº’æ–¥ï¼Œä¸¤ä¸ªçº¿ç¨‹è¿™ä¹ˆæä¼šæ­»é”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627810059,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":184548,"user_name":"Airsaid","can_delete":false,"product_type":"c1","uid":1115302,"ip_address":"","ucode":"5B90BC0044F376","user_header":"https://static001.geekbang.org/account/avatar/00/11/04/a6/18c4f73c.jpg","comment_is_top":false,"comment_ctime":1583335465,"is_pvip":false,"replies":[{"id":"71684","content":"å†…ç½®çš„æ”¯æŒå¹¶å‘çš„æ•°æ®ç»“æ„ç­‰ç­‰","user_name":"ä½œè€…å›å¤","comment_id":184548,"uid":"1269969","ip_address":"","utype":1,"ctime":1583647652,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"18763204649","product_id":100023901,"comment_content":"ã€Œè¿«ä¸å¾—å·²æ—¶æ‰ä½¿ç”¨ä½çº§çš„åŒæ­¥åŸè¯­ï¼šä½çº§çš„åŒæ­¥åŸè¯­ä¸»è¦æŒ‡çš„æ˜¯ synchronizedã€Lockã€Semaphore ç­‰ï¼Œè¿™äº›è™½ç„¶æ„Ÿè§‰ç®€å•ï¼Œä½†å®é™…ä¸Šå¹¶æ²¡é‚£ä¹ˆç®€å•ï¼Œä¸€å®šè¦å°å¿ƒä½¿ç”¨ã€‚ã€<br><br>è€å¸ˆæ‚¨å¥½ï¼Œè¿™é‡Œå†…ç½®é”å’Œæ˜¾å¼é”éƒ½æ˜¯ä½çº§åŒæ­¥åŸè¯­ï¼Œé‚£ä»€ä¹ˆæ˜¯é«˜çº§åŒæ­¥åŸè¯­å‘¢ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486052,"discussion_content":"å†…ç½®çš„æ”¯æŒå¹¶å‘çš„æ•°æ®ç»“æ„ç­‰ç­‰","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1583647652,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":80000,"user_name":"é˜¿ç¨","can_delete":false,"product_type":"c1","uid":1131735,"ip_address":"","ucode":"011711A55C8ED0","user_header":"https://static001.geekbang.org/account/avatar/00/11/44/d7/915da418.jpg","comment_is_top":false,"comment_ctime":1553590736,"is_pvip":true,"replies":[{"id":"29187","content":"æ²¡é—®é¢˜<br>","user_name":"ä½œè€…å›å¤","comment_id":80000,"uid":"1269969","ip_address":"","utype":1,"ctime":1553604471,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"18733459920","product_id":100023901,"comment_content":"è€å¸ˆï¼Œè¿™æ ·å†™æœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Œæ€»æ„Ÿè§‰å“ªé‡Œæ€ªæ€ªçš„ã€‚<br>public class DBPush {<br>    private volatile static DBPush dbPush = null;<br><br>    private DBPush() {<br>    }<br><br>    public static DBPush getInStance() {<br>        if (dbPush == null) {<br>            synchronized (DBPush.class) {<br>                if (dbPush == null) {<br>                    dbPush = new DBPush();<br>                }<br>            }<br>        }<br>        return dbPush;<br>    }<br>}","like_count":4,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444716,"discussion_content":"æ²¡é—®é¢˜\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553604471,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79884,"user_name":"Lemon","can_delete":false,"product_type":"c1","uid":1155474,"ip_address":"","ucode":"FED3B7D2931152","user_header":"https://static001.geekbang.org/account/avatar/00/11/a1/92/ad27079c.jpg","comment_is_top":false,"comment_ctime":1553568444,"is_pvip":false,"replies":[{"id":"29109","content":"é”™è¯¯çš„è®¾ç½®ä¼šå¯¼è‡´æ°¸è¿œç­‰å¾…ï¼Œå¤ªå±é™©äº†<br>","user_name":"ä½œè€…å›å¤","comment_id":79884,"uid":"1269969","ip_address":"","utype":1,"ctime":1553571541,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"18733437628","product_id":100023901,"comment_content":"ä½¿ç”¨ Condition<br>public class SafeWM {<br><br>    &#47;&#47; åº“å­˜ä¸Šé™<br>    private final AtomicLong upper =<br>            new AtomicLong(10);<br>    &#47;&#47; åº“å­˜ä¸‹é™<br>    private final AtomicLong lower =<br>            new AtomicLong(2);<br><br>    private ReentrantLock lock = new ReentrantLock();<br>    private Condition c1 = lock.newCondition();<br>    private Condition c2 = lock.newCondition();<br>    <br>    &#47;&#47; è®¾ç½®åº“å­˜ä¸Šé™<br>    void setUpper(long v) {<br>        try {<br>            lock.lock();<br>            &#47;&#47; æ£€æŸ¥å‚æ•°åˆæ³•æ€§<br>            while (v &lt; lower.get()) {<br>                c1.await();<br>            }<br>            upper.set(v);<br>            c2.signal();<br>        } catch (Exception e) {<br>            e.printStackTrace();<br>        } finally {<br>            lock.unlock();<br>        }<br><br>    }<br><br>    &#47;&#47; è®¾ç½®åº“å­˜ä¸‹é™<br>    void setLower(long v) {<br><br>        try {<br>            lock.lock();<br>            &#47;&#47; æ£€æŸ¥å‚æ•°åˆæ³•æ€§<br>            while (v &gt; upper.get())  {<br>                c2.await();<br>            }<br>            lower.set(v);<br>            c1.signal();<br>        } catch (Exception e) {<br>            e.printStackTrace();<br>        } finally {<br>            lock.unlock();<br>        }<br>    }<br><br>}","like_count":4,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444666,"discussion_content":"é”™è¯¯çš„è®¾ç½®ä¼šå¯¼è‡´æ°¸è¿œç­‰å¾…ï¼Œå¤ªå±é™©äº†\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553571541,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81583,"user_name":"æ˜“æ°´å¯’","can_delete":false,"product_type":"c1","uid":1238961,"ip_address":"","ucode":"F5D8127ED4754E","user_header":"https://static001.geekbang.org/account/avatar/00/12/e7/b1/5c63be67.jpg","comment_is_top":false,"comment_ctime":1553953102,"is_pvip":false,"replies":[{"id":"29554","content":"æ˜¯è¿™æ ·çš„<br>","user_name":"ä½œè€…å›å¤","comment_id":81583,"uid":"1269969","ip_address":"","utype":1,"ctime":1553988219,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"14438854990","product_id":100023901,"comment_content":"ä½¿ç”¨synchronizedï¼ˆthisï¼‰çš„è¯ï¼Œæ„Ÿè§‰volatieéƒ½ä¸éœ€è¦ç”¨äº†ï¼Œjmmæ¨¡å‹ä¸æ˜¯è¯´ï¼Œé‡Šæ”¾é”çš„æ“ä½œå…ˆäºåç»­çš„åŠ é”å‘ç”Ÿï¼ŒåŠ é”æˆåŠŸåï¼Œå¯¹äºä¸Šä¸€æ¬¡é‡Šæ”¾é”ä¹‹å‰çš„æ“ä½œç»“æœæ˜¯å¯è§çš„","like_count":3,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445260,"discussion_content":"æ˜¯è¿™æ ·çš„\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553988219,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79795,"user_name":"æŠ½ç¦»ã®â¤ï¸","can_delete":false,"product_type":"c1","uid":1099436,"ip_address":"","ucode":"6CBCE2610CF768","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/ac/60d1fd42.jpg","comment_is_top":false,"comment_ctime":1553558690,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14438460578","product_id":100023901,"comment_content":"è€å¸ˆã€è®²çš„çœŸå¥½ï¼","like_count":3},{"had_liked":false,"id":81633,"user_name":"é€†æ°´è¡ŒèˆŸ","can_delete":false,"product_type":"c1","uid":1044836,"ip_address":"","ucode":"17FE5F5452B2FE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f1/64/18366f31.jpg","comment_is_top":false,"comment_ctime":1553992213,"is_pvip":true,"replies":[{"id":"29623","content":"å¤ªæ™¦æ¶©äº†","user_name":"ä½œè€…å›å¤","comment_id":81633,"uid":"1269969","ip_address":"","utype":1,"ctime":1554030812,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":2,"race_medal":0,"score":"10143926805","product_id":100023901,"comment_content":"é‚£æœ¬ä¹¦ï¼Œæœ‰äº›æ™¦æ¶©ï¼Œä½†æ˜¯æ˜¯å¿…è¯»çš„ã€‚","like_count":2,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445277,"discussion_content":"å¤ªæ™¦æ¶©äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554030812,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1641319,"avatar":"https://static001.geekbang.org/account/avatar/00/19/0b/67/dc49a1a8.jpg","nickname":"åœ¨è·¯ä¸Š","note":"","ucode":"E1184E76B14431","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":157348,"discussion_content":"æ˜¯æŒ‡é‚£æœ¬ä¹¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580471854,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79953,"user_name":"æ‚Ÿç©º","can_delete":false,"product_type":"c1","uid":1451125,"ip_address":"","ucode":"F9DFBA74B35B40","user_header":"https://static001.geekbang.org/account/avatar/00/16/24/75/808ac160.jpg","comment_is_top":false,"comment_ctime":1553581297,"is_pvip":false,"replies":[{"id":"29191","content":"å¯¹è±¡åŠ é”å°±å¯ä»¥äº†<br>","user_name":"ä½œè€…å›å¤","comment_id":79953,"uid":"1269969","ip_address":"","utype":1,"ctime":1553604836,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"10143515889","product_id":100023901,"comment_content":"è®¿é—®æ—¶ä½¿ç”¨syncchronizeå¯¹ç±»åŠ é”ã€‚ä¿è¯å˜é‡è®¿é—®çš„äº’æ–¥","like_count":2,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444700,"discussion_content":"å¯¹è±¡åŠ é”å°±å¯ä»¥äº†\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553604836,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79838,"user_name":"Zm","can_delete":false,"product_type":"c1","uid":1448893,"ip_address":"","ucode":"831FF80F07E965","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKj4w4lW7ibGEVxPv8wS1CrXKDeBz3RAaAdISxQSD23uUpV3wicsIMepaYZE8GzRcWmSpjet5NDN4MA/132","comment_is_top":false,"comment_ctime":1553562504,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10143497096","product_id":100023901,"comment_content":"Volatileä¿®é¥°å˜é‡","like_count":2},{"had_liked":false,"id":79780,"user_name":"æ— åº¸","can_delete":false,"product_type":"c1","uid":1120675,"ip_address":"","ucode":"9F61D1BF0FB4BF","user_header":"https://static001.geekbang.org/account/avatar/00/11/19/a3/600bc13d.jpg","comment_is_top":false,"comment_ctime":1553557937,"is_pvip":true,"replies":[{"id":"29091","content":"ä¸æ»¡è¶³åˆç†åº“å­˜çš„çº¦æŸæ¡ä»¶<br>","user_name":"ä½œè€…å›å¤","comment_id":79780,"uid":"1269969","ip_address":"","utype":1,"ctime":1553562466,"user_name_real":"ç‹å®ä»¤"}],"discussion_count":1,"race_medal":0,"score":"10143492529","product_id":100023901,"comment_content":"compareAndSetå§<br><br>void setUpperï¼ˆlong vï¼‰{<br>  upper.compareAndSet(upper.longValue<br>(),v);<br>}","like_count":2,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444621,"discussion_content":"ä¸æ»¡è¶³åˆç†åº“å­˜çš„çº¦æŸæ¡ä»¶\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553562466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79769,"user_name":"äº¬","can_delete":false,"product_type":"c1","uid":1267526,"ip_address":"","ucode":"F69476C14C5405","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIWgpgEACljAII095cibNoPxlR6X3sIY1fmf4KjNjIoZ8icUOYL206lAcsqMsMl80pc4IbnsrpE28rQ/132","comment_is_top":false,"comment_ctime":1553555733,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"10143490325","product_id":100023901,"comment_content":"ä¸€æ—©èµ·æ¥ï¼Œå°±æŠŠæ–‡ç« çœ‹å®Œäº†ï¼ŒæœŸå¾…è€å¸ˆåé¢æ›´ç²¾å½©çš„å†…å®¹","like_count":2},{"had_liked":false,"id":305560,"user_name":"è‹å½§","can_delete":false,"product_type":"c1","uid":1622448,"ip_address":"","ucode":"C016B28DF7449C","user_header":"https://static001.geekbang.org/account/avatar/00/18/c1/b0/b52d9ade.jpg","comment_is_top":false,"comment_ctime":1628047304,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5923014600","product_id":100023901,"comment_content":"è€å¸ˆï¼Œsynchronized(this)è¿™ä¸ªthisæ˜¯å¯¹è±¡çš„å¼•ç”¨ï¼Œå¤šä¸ªçº¿ç¨‹åœ¨ä¸åŒçš„åœ°æ–¹åŒæ—¶è°ƒç”¨è¯¥å¯¹è±¡ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯å°±é”ä¸ä½äº†ï¼Œæœ‰å¹¶å‘é—®é¢˜å‘€","like_count":1},{"had_liked":false,"id":280161,"user_name":"é©¬æ–‡é¾™","can_delete":false,"product_type":"c1","uid":1068432,"ip_address":"","ucode":"679B0F0AB402C7","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/90/25b6f544.jpg","comment_is_top":false,"comment_ctime":1614099573,"is_pvip":true,"replies":[{"id":"102075","content":"Springçš„è®¾è®¡å¤ªå¤šäº†ï¼Œç”¨çš„æ¯”è¾ƒå¤šçš„æ˜¯çº¿ç¨‹æœ¬åœ°å­˜å‚¨","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1614599033,"ip_address":"","comment_id":280161,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5909066869","product_id":100023901,"comment_content":"ç‹è€å¸ˆ ï¼Œspringä¸­çš„è®¾è®¡æ˜¯ä¸æ˜¯å°±æ˜¯åˆ©ç”¨é¿å…å…±äº«ï¼šé¿å…å…±äº«çš„æŠ€æœ¯ä¸»è¦æ˜¯åˆ©äºçº¿ç¨‹æœ¬åœ°å­˜å‚¨ä»¥åŠä¸ºæ¯ä¸ªä»»åŠ¡åˆ†é…ç‹¬ç«‹çš„çº¿ç¨‹ï¼›è¿™ä¸ªæ–¹å¼çš„å•Šï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":516002,"discussion_content":"Springçš„è®¾è®¡å¤ªå¤šäº†ï¼Œç”¨çš„æ¯”è¾ƒå¤šçš„æ˜¯çº¿ç¨‹æœ¬åœ°å­˜å‚¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614599033,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1810576,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/eLNeJNaEkwGSK7xvtamMibVLMy2MpbIqX3iaEhT7JtSnTRMRTwZ2j4HX7WAapiashbiaBDVriaXKSP0Oeic6ZAEVEXag/132","nickname":"M","note":"","ucode":"06F26E1D62E9C9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369278,"discussion_content":"æ˜¯é‚£ä¸ªThreadLocalå˜›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618994900,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1600341,"avatar":"https://static001.geekbang.org/account/avatar/00/18/6b/55/2b0f219b.jpg","nickname":"Geek_42f729","note":"","ucode":"76CFFF9DEDDF96","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1810576,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/eLNeJNaEkwGSK7xvtamMibVLMy2MpbIqX3iaEhT7JtSnTRMRTwZ2j4HX7WAapiashbiaBDVriaXKSP0Oeic6ZAEVEXag/132","nickname":"M","note":"","ucode":"06F26E1D62E9C9","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554443,"discussion_content":"æ˜¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646381977,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":369278,"ip_address":""},"score":554443,"extra":""}]}]},{"had_liked":false,"id":163258,"user_name":"æ·æ·åŒå­¦","can_delete":false,"product_type":"c1","uid":1179533,"ip_address":"","ucode":"529A326B898008","user_header":"https://static001.geekbang.org/account/avatar/00/11/ff/8d/8601f035.jpg","comment_is_top":false,"comment_ctime":1576676816,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5871644112","product_id":100023901,"comment_content":"å®‰å…¨å‘å¸ƒçš„å¸¸ç”¨æ¨¡å¼<br>å¯å˜å¯¹è±¡å¿…é¡»é€šè¿‡å®‰å…¨çš„æ–¹å¼æ¥å‘å¸ƒï¼Œè¿™é€šå¸¸æ„å‘³ç€åœ¨å‘å¸ƒå’Œä½¿ç”¨è¯¥å¯¹è±¡çš„çº¿ç¨‹æ—¶éƒ½å¿…é¡»ä½¿ç”¨åŒæ­¥ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å°†é‡ç‚¹ä»‹ç»å¦‚ä½•ç¡®ä¿ä½¿ç”¨å¯¹è±¡çš„çº¿ç¨‹èƒ½å¤Ÿçœ‹åˆ°è¯¥å¯¹è±¡å¤„äºå·²å‘å¸ƒçš„çŠ¶æ€ï¼Œå¹¶ç¨åä»‹ç»å¦‚ä½•åœ¨å¯¹è±¡å‘å¸ƒåå¯¹å…¶å¯è§æ€§è¿›è¡Œä¿®æ”¹ã€‚<br><br>å®‰å…¨åœ°å‘å¸ƒä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡çš„åº”ç”¨ä»¥åŠå¯¹è±¡çš„çŠ¶æ€å¿…é¡»åŒæ—¶å¯¹å…¶ä»–çº¿ç¨‹å¯è§ã€‚ä¸€ä¸ªæ­£ç¡®æ„é€ çš„å¯¹è±¡å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥å®‰å…¨åœ°å‘å¸ƒï¼š<br><br>åœ¨é™æ€åˆå§‹åŒ–å‡½æ•°ä¸­åˆå§‹åŒ–ä¸€ä¸ªå¯¹è±¡å¼•ç”¨<br>å°†å¯¹è±¡çš„åº”ç”¨ä¿å­˜åˆ°volatileç±»å‹çš„åŸŸæˆ–è€…AtomicReferanceå¯¹è±¡ä¸­<br>å°†å¯¹è±¡çš„å¼•ç”¨ä¿å­˜åˆ°æŸä¸ªæ­£ç¡®æ„é€ å¯¹è±¡çš„finalç±»å‹åŸŸä¸­<br>å°†å¯¹è±¡çš„å¼•ç”¨ä¿å­˜åˆ°ä¸€ä¸ªç”±é”ä¿æŠ¤çš„åŸŸä¸­ã€‚","like_count":1},{"had_liked":false,"id":157185,"user_name":"èŠ±èŠ±young","can_delete":false,"product_type":"c1","uid":1338584,"ip_address":"","ucode":"95AD30303C2B21","user_header":"https://static001.geekbang.org/account/avatar/00/14/6c/d8/68fec932.jpg","comment_is_top":false,"comment_ctime":1575076161,"is_pvip":false,"replies":[{"id":"60318","content":"æ˜¯è¿™æ ·çš„ï¼Œå¯ä»¥ä½¿ç”¨JDKæä¾›çš„åŸå­ç±»","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1575112456,"ip_address":"","comment_id":157185,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5870043457","product_id":100023901,"comment_content":"validateæˆ‘çœ‹ä¹¦ä¸­è¯´åƒa=4è¿™ç§æ˜¯æœ‰åŸå­æ€§çš„ï¼Œå¯¹äºå¤åˆæ“ä½œæ˜¯æ²¡æœ‰åŸå­æ€§ï¼Œæœ›è€å¸ˆè§£ç­”","like_count":1,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476356,"discussion_content":"æ˜¯è¿™æ ·çš„ï¼Œå¯ä»¥ä½¿ç”¨JDKæä¾›çš„åŸå­ç±»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575112456,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":116909,"user_name":"æ‹¯æ•‘åœ°çƒå¥½ç´¯","can_delete":false,"product_type":"c1","uid":1339022,"ip_address":"","ucode":"7643439601EF4C","user_header":"https://static001.geekbang.org/account/avatar/00/14/6e/8e/5d309a85.jpg","comment_is_top":false,"comment_ctime":1563937304,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5858904600","product_id":100023901,"comment_content":"---æ€»ç»“---<br>1. å°è£…ä¸å¹¶å‘ï¼šå°†å…±äº«å˜é‡ä½œä¸ºå¯¹è±¡å±æ€§å°è£…åœ¨å†…éƒ¨ï¼Œå¯¹æ‰€æœ‰å…¬å…±æ–¹æ³•æŒ‡å®šå¹¶å‘è®¿é—®ç­–ç•¥<br>2. ä¸å¯å˜ä¸å¹¶å‘ï¼šå¦‚æ— å¿…è¦ä¿®æ”¹ï¼Œå®ä¾‹å˜é‡éƒ½åº”è¯¥æ˜¯private finalçš„<br>3. å…±äº«å˜é‡é—´çš„çº¦æŸæ¡ä»¶å†³å®šäº†å¹¶å‘è®¿é—®ç­–ç•¥ï¼Œè€Œä¸ºäº†è¾¾åˆ°è¿™ç§çº¦æŸæ¡ä»¶ï¼ŒåŸºæœ¬ä¸Šéƒ½ä¼šæœ‰ifè¯­å¥ï¼Œæ­¤æ—¶å¾€å¾€ä¼šå‡ºç°ç«æ€æ¡ä»¶<br>4. å¹¶å‘è®¿é—®ç­–ç•¥ï¼šé¿å…å…±äº«ï¼›ä¸å˜æ¨¡å¼ï¼›åŒæ­¥å·¥å…·<br><br>---å¯å‘---<br>1. ç»å¸¸èƒ½å°†è®¡ç®—æœºçš„ä¸¤ä¸ªæ¦‚å¿µæ”¾åœ¨ä¸€èµ·ï¼Œçœ‹çœ‹ä¸¤è€…çš„å…³è”ï¼Œä¼šæœ‰ä¸åŒçš„æ”¶è·ã€‚","like_count":1},{"had_liked":false,"id":79886,"user_name":"crazypokerk","can_delete":false,"product_type":"c1","uid":1158383,"ip_address":"","ucode":"9AAD5D9726E503","user_header":"https://static001.geekbang.org/account/avatar/00/11/ac/ef/494f56c3.jpg","comment_is_top":false,"comment_ctime":1553568657,"is_pvip":false,"replies":[{"id":"29239","content":"å¯¹çš„<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553647690,"ip_address":"","comment_id":79886,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5848535953","product_id":100023901,"comment_content":"æˆ‘è§‰å¾—å¯¹äºä¸Šé™ä¸ä¸‹é™ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œä¸»è¦æ˜¯å› ä¸ºå‡ºç°äº†ç«æ€æ¡ä»¶ï¼Œè€Œè§£å†³ç«æ€æ¡ä»¶ä¸æ•°æ®ç«äº‰çš„è§£å†³åŠæ³•å°±æ˜¯äº’æ–¥ï¼Œå³åŠ é”ã€‚åªæœ‰å½“ä¸€ä¸ªçº¿ç¨‹è·å¾—é”ä¹‹åï¼Œåˆ¤æ–­æ¡ä»¶æ˜¯å¦æˆç«‹ä¹‹åï¼Œå†è¿›è¡Œæ›´æ”¹æ“ä½œã€‚å¦‚ç†è§£æœ‰è¯¯ï¼Œè¿˜è¯·è€å¸ˆæŒ‡æ­£ã€‚","like_count":1,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444667,"discussion_content":"å¯¹çš„\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553647690,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79818,"user_name":"undifined","can_delete":false,"product_type":"c1","uid":1068920,"ip_address":"","ucode":"449CB4CD2DC089","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/78/c3d8ecb0.jpg","comment_is_top":false,"comment_ctime":1553561115,"is_pvip":false,"replies":[{"id":"29316","content":"æˆ‘æ„Ÿè§‰ä¸å¯ä»¥ï¼Œè¿˜æ˜¯æœ‰ç«æ€æ¡ä»¶ï¼Œä½ å¯ä»¥åœ¨returnå‰é¢å¢åŠ sleepçœ‹çœ‹","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553695508,"ip_address":"","comment_id":79818,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5848528411","product_id":100023901,"comment_content":"è¦ä¿è¯å˜é‡é—´çš„çº¦æŸæ¡ä»¶ï¼Œå°±å¿…é¡»ä¿è¯åˆ¤æ–­å’Œèµ‹å€¼æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œå¯ä»¥é€šè¿‡ç»™ upper å’Œ lower åŒæ—¶åŠ é”ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ AtomicLong æä¾›çš„æ–¹æ³•è¿›è¡Œæ“ä½œ<br><br>    &#47;&#47; è®¾ç½®åº“å­˜ä¸Šé™<br>    void setUpper(long v) {<br>        &#47;&#47; æ£€æŸ¥å‚æ•°åˆæ³•æ€§<br>        upper.getAndUpdate(u -&gt; {<br>            if (v &lt; lower.get()) {<br>                throw new IllegalArgumentException();<br>            } else {<br>                return v;<br>            }<br>        });<br>    }<br><br>    &#47;&#47; è®¾ç½®åº“å­˜ä¸‹é™<br>    void setLower(long v) {<br>        &#47;&#47; æ£€æŸ¥å‚æ•°åˆæ³•æ€§<br>        lower.getAndUpdate(u -&gt; {<br>            if (v &gt; upper.get()) {<br>                throw new IllegalArgumentException();<br>            } else {<br>                return v;<br>            }<br>        });<br>    }<br> <br>è€å¸ˆè¿™æ ·ç†è§£å¯¹å—","like_count":1,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444639,"discussion_content":"æˆ‘æ„Ÿè§‰ä¸å¯ä»¥ï¼Œè¿˜æ˜¯æœ‰ç«æ€æ¡ä»¶ï¼Œä½ å¯ä»¥åœ¨returnå‰é¢å¢åŠ sleepçœ‹çœ‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553695508,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":348619,"user_name":"freesocean","can_delete":false,"product_type":"c1","uid":1529210,"ip_address":"","ucode":"CAD4C80CF569D3","user_header":"https://static001.geekbang.org/account/avatar/00/17/55/7a/d44df1d6.jpg","comment_is_top":false,"comment_ctime":1655258796,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1655258796","product_id":100023901,"comment_content":"package com.zx.juc.concurrent;<br><br>import java.util.concurrent.atomic.AtomicLong;<br>import java.util.concurrent.locks.Condition;<br>import java.util.concurrent.locks.Lock;<br>import java.util.concurrent.locks.ReentrantLock;<br><br>&#47;**<br> * @author zx<br> * @description:  å°è£…å…±äº«å˜é‡<br> * @date 2022&#47;6&#47;15<br> *&#47;<br>public class DataRaceDemo {<br><br>        &#47;&#47; åº“å­˜ä¸Šé™<br>        private final AtomicLong upper =<br>                new AtomicLong(0);<br>        &#47;&#47; åº“å­˜ä¸‹é™<br>        private final AtomicLong lower =<br>                new AtomicLong(0);<br><br>        final Lock lock = new ReentrantLock();<br>        final Condition upperCondition = lock.newCondition();<br>        final Condition lowerCondition = lock.newCondition();<br><br><br>        &#47;&#47; è®¾ç½®åº“å­˜ä¸Šé™<br>        void setUpper(long v){<br>            lock.lock();<br>            try {<br>                &#47;&#47; æ£€æŸ¥å‚æ•°åˆæ³•æ€§<br>                while(v&lt;lower.get()){<br>                    upperCondition.await();<br>                }<br>                upper.set(v);<br>                lowerCondition.signal();<br>            }catch (InterruptedException e){<br>                e.printStackTrace();<br>            } finally {<br>                lock.unlock();<br>            }<br>        }<br>        &#47;&#47; è®¾ç½®åº“å­˜ä¸‹é™<br>        void setLower(long v){<br>            lock.lock();<br>            try {<br>                &#47;&#47; æ£€æŸ¥å‚æ•°åˆæ³•æ€§<br>                while (v &gt; upper.get()) {<br>                    lowerCondition.await();<br>                }<br>                lower.set(v);<br>                upperCondition.signal();<br>            } catch (InterruptedException e) {<br>                e.printStackTrace();<br>            }finally {<br>                lock.unlock();<br>            }<br>        }<br><br>}<br>","like_count":0},{"had_liked":false,"id":346433,"user_name":"ycan","can_delete":false,"product_type":"c1","uid":1325564,"ip_address":"","ucode":"414BEADB1B8508","user_header":"https://static001.geekbang.org/account/avatar/00/14/39/fc/28ca08ea.jpg","comment_is_top":false,"comment_ctime":1653133018,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1653133018","product_id":100023901,"comment_content":"æˆåŠŸå°±æ˜¯ç®€å•çš„äº‹æƒ…é‡å¤åšï¼Œä½ çš„æ—¶é—´åœ¨å“ªé‡Œï¼Œæˆå°±å°±åœ¨å“ªé‡Œ","like_count":0},{"had_liked":false,"id":345556,"user_name":"David","can_delete":false,"product_type":"c1","uid":1021825,"ip_address":"","ucode":"22CBBC13FC97A9","user_header":"https://static001.geekbang.org/account/avatar/00/0f/97/81/e1eaf621.jpg","comment_is_top":false,"comment_ctime":1652398301,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1652398301","product_id":100023901,"comment_content":"æŠŠä¸¤ä¸ªå˜é‡åˆæˆä¸€ä¸ª ä¸€ä¸ªç”¨é«˜16ä½ç½®ä¸€ä¸ªç”¨ä½16ä½ã€‚è¿™æ ·ç”¨ä¸€ä¸ªvolatileå˜é‡å°±å¯ä»¥è§£å†³åŸå­æ€§é—®é¢˜","like_count":0},{"had_liked":false,"id":341041,"user_name":"é¾™è¡Œå¤©ä¸‹","can_delete":false,"product_type":"c1","uid":1231302,"ip_address":"","ucode":"90BEED7A164ADE","user_header":"https://static001.geekbang.org/account/avatar/00/12/c9/c6/16136ab3.jpg","comment_is_top":false,"comment_ctime":1649307482,"is_pvip":true,"replies":[{"id":"124695","content":"ç›¸æ¯”lockä¼˜å…ˆç”¨synchronizedï¼Œè¿™ä¸ªä¸æ˜¯ç›¸åè§‚ç‚¹ï¼Œæ‰€æœ‰è§‚ç‚¹éƒ½æ˜¯è¿™æ ·","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1269969","ctime":1649378506,"ip_address":"","comment_id":341041,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1649307482","product_id":100023901,"comment_content":"æ·±å…¥ç†è§£javaè™šæ‹Ÿæœºè¿™æœ¬ä¹¦æäº†ä¸ªç›¸åçš„è§‚ç‚¹ï¼Œjdk 1.6åï¼Œsynchronizedä¸jucçš„reentrantlockæ€§èƒ½åŸºæœ¬æŒå¹³ï¼Œä¸”æœªæ¥è™šæ‹Ÿæœºæ€§èƒ½æ”¹å–„ä¸­ä¼šåå‘äºåŸç”Ÿçš„synchronizedï¼Œå»ºè®®æ»¡è¶³éœ€æ±‚æ—¶ï¼Œä¼˜å…ˆç”¨synchronized","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560516,"discussion_content":"ç›¸æ¯”lockä¼˜å…ˆç”¨synchronizedï¼Œè¿™ä¸ªä¸æ˜¯ç›¸åè§‚ç‚¹ï¼Œæ‰€æœ‰è§‚ç‚¹éƒ½æ˜¯è¿™æ ·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649378506,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":315181,"user_name":"å®˜å®å„¿","can_delete":false,"product_type":"c1","uid":2110827,"ip_address":"","ucode":"03B4312475A984","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI5eicXFWltiaF9ibsEh2nNC80OYoHibhhE0X1hPHZ5KuAtY4Yxp5dQ4LsciaDxUHFBPlJM7kgQwkspzsQ/132","comment_is_top":false,"comment_ctime":1633743872,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633743872","product_id":100023901,"comment_content":"ç­”é¢˜ï¼Œç”¨volatileä¿®é¥°ä¸Šé™ï¼Œè¿™æ ·å¯ä»¥ä¿è¯è¯»åˆ°çš„ä¸Šé™å€¼æ˜¯æœ€æ–°çš„ï¼Œç„¶åè®¾ç½®ä¸‹é™æ—¶å€™åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦å¤§äºä¸Šé™ï¼›","like_count":0},{"had_liked":false,"id":305447,"user_name":"studyçš„ç¨‹åºå‘˜","can_delete":false,"product_type":"c1","uid":1023101,"ip_address":"","ucode":"E5AE9037D24429","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9c/7d/774e07f9.jpg","comment_is_top":false,"comment_ctime":1627977860,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627977860","product_id":100023901,"comment_content":"long newV = 1L;<br>        Unsafe unsafe = Unsafe.getUnsafe();<br>        AtomicLong atomicLong = new AtomicLong(0);<br>        long oldV = atomicLong.get();<br>        long objectFieldOffset = unsafe.objectFieldOffset(AtomicLong.class.getField(&quot;value&quot;));<br>        unsafe.compareAndSwapLong(atomicLong, objectFieldOffset, oldV, newV);","like_count":0},{"had_liked":false,"id":303379,"user_name":"Geek_e6f358","can_delete":false,"product_type":"c1","uid":1855137,"ip_address":"","ucode":"C21E94A90258A2","user_header":"","comment_is_top":false,"comment_ctime":1626762372,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1626762372","product_id":100023901,"comment_content":"<br>public class SafeWM {<br>  &#47;&#47; åº“å­˜ä¸Šé™<br>  private final AtomicLong upper =<br>        new AtomicLong(0);<br>  &#47;&#47; åº“å­˜ä¸‹é™<br>  private final AtomicLong lower =<br>        new AtomicLong(0);<br>  &#47;&#47; è®¾ç½®åº“å­˜ä¸Šé™<br>  synchronized void setUpper(long v){<br>    &#47;&#47; æ£€æŸ¥å‚æ•°åˆæ³•æ€§<br>    if (v &lt; lower.get()) {<br>      throw new IllegalArgumentException();<br>    }<br>    upper.set(v);<br>  }<br>  &#47;&#47; è®¾ç½®åº“å­˜ä¸‹é™<br>  synchronized  void setLower(long v){<br>    &#47;&#47; æ£€æŸ¥å‚æ•°åˆæ³•æ€§<br>    if (v &gt; upper.get()) {<br>      throw new IllegalArgumentException();<br>    }<br>    lower.set(v);<br>  }<br>  &#47;&#47; çœç•¥å…¶ä»–ä¸šåŠ¡ä»£ç <br>}","like_count":0},{"had_liked":false,"id":291894,"user_name":"jiaobuchongà¸ˆà¸¸à¹Šà¸š","can_delete":false,"product_type":"c1","uid":1118938,"ip_address":"","ucode":"0AEE4E579DC3A2","user_header":"https://static001.geekbang.org/account/avatar/00/11/12/da/a3ea305f.jpg","comment_is_top":false,"comment_ctime":1620574971,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1620574971","product_id":100023901,"comment_content":"æ¥ä¸€ä¸ªé¢è¯•é¢˜ï¼ŒåŠ æ·±å¤§å®¶å¯¹ç®¡ç¨‹çš„ç†è§£ï¼šhttps:&#47;&#47;blog.csdn.net&#47;jiaobuchong&#47;article&#47;details&#47;86555208","like_count":0},{"had_liked":false,"id":289384,"user_name":"M","can_delete":false,"product_type":"c1","uid":1810576,"ip_address":"","ucode":"06F26E1D62E9C9","user_header":"https://wx.qlogo.cn/mmopen/vi_32/eLNeJNaEkwGSK7xvtamMibVLMy2MpbIqX3iaEhT7JtSnTRMRTwZ2j4HX7WAapiashbiaBDVriaXKSP0Oeic6ZAEVEXag/132","comment_is_top":false,"comment_ctime":1618993633,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618993633","product_id":100023901,"comment_content":"è€å¸ˆï¼Œå¸®æˆ‘çœ‹ä¸‹ï¼Œè¿™æ ·å†™æœ‰é—®é¢˜å—?<br><br>public class SafeWM {<br><br>    public final AtomicLong upper = new AtomicLong(0);<br>    public final AtomicLong lower = new AtomicLong(0);<br><br>    private SafeWM() {<br>    }<br><br><br>    static class SafeWMBuilder {<br>        private Long upper = 0L;<br>        private Long lower = 0L;<br><br>        public synchronized SafeWMBuilder setUpper(Long v) {<br>            this.upper = v;<br>            return this;<br>        }<br><br>        public synchronized SafeWMBuilder setLower(Long v) {<br>            this.lower = v;<br>            return this;<br>        }<br><br><br>        public synchronized SafeWM build() {<br>            &#47;&#47;æ ¡éªŒï¼šä¸Šé™ &lt; ä¸‹é™<br>            if (upper &lt; lower) {<br>                throw new IllegalArgumentException();<br>            }<br>            SafeWM safeWM = new SafeWM();<br>            safeWM.lower.set(lower);<br>            safeWM.upper.set(upper);<br>            return safeWM;<br>        }<br>    }<br><br>}<br><br>class TestSafeWM {<br>    public static void main(String[] args) {<br>        SafeWM.SafeWMBuilder safeWMBuilder = new SafeWM.SafeWMBuilder();<br>        SafeWM safeWM = safeWMBuilder.setUpper(10L)<br>                .setLower(20L)<br>                .build();<br>        System.out.println(&quot;ä¸Šé™ï¼š&quot; + safeWM.upper.get() + &quot;   ä¸‹é™ï¼š&quot; + safeWM.lower.get());<br>    }<br>}<br>","like_count":0},{"had_liked":false,"id":289359,"user_name":"M","can_delete":false,"product_type":"c1","uid":1810576,"ip_address":"","ucode":"06F26E1D62E9C9","user_header":"https://wx.qlogo.cn/mmopen/vi_32/eLNeJNaEkwGSK7xvtamMibVLMy2MpbIqX3iaEhT7JtSnTRMRTwZ2j4HX7WAapiashbiaBDVriaXKSP0Oeic6ZAEVEXag/132","comment_is_top":false,"comment_ctime":1618988998,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618988998","product_id":100023901,"comment_content":"è€å¸ˆï¼Œæˆ‘æœ‰ä¸ªç–‘é—®ï¼š<br><br>å°±æ˜¯ä¸Šæ–‡äº†è¯´äº†ï¼Œå¯¹äºè¿™äº›ä¸ä¼šå‘ç”Ÿå˜åŒ–çš„å…±äº«å˜é‡ï¼Œå»ºè®®ä½ ç”¨ final å…³é”®å­—æ¥ä¿®é¥°<br><br>æ—¢ç„¶åŠ äº†finalå…³é”®å­—çš„å˜é‡ä¸ä¼šå‘ç”Ÿå˜åŒ–äº†ï¼Œé‚£ä¸ºä»€ä¹ˆåœ¨upperå’Œlowerä¸ŠåŠ ä¸Šfinalå…³é”®å­—å‘¢","like_count":0},{"had_liked":false,"id":279914,"user_name":"Geek_5788be","can_delete":false,"product_type":"c1","uid":1390348,"ip_address":"","ucode":"A8E7F2A898B15A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/RKNSic0k9zAa3zvicN7k7cgTib3jmd6znJmUhKVBdj04XYZgyKuEmzdn35d9Kev9yChfUGmcV49m9wN8klxg4ibXgQ/132","comment_is_top":false,"comment_ctime":1613999538,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1613999538","product_id":100023901,"comment_content":"å¤ªå¼ºäº†å§ï¼æ€»è§‰å¾—å¹¶å‘å¾ˆå¤æ‚ï¼Œè€å¸ˆç”¨é¢å‘å¯¹è±¡çš„æ€æƒ³ï¼Œä¸‰è¨€ä¸¤è¯­å°±è§£å†³äº†ï¼","like_count":0},{"had_liked":false,"id":264594,"user_name":"æˆ‘çœŸä¸æ˜¯åœ°çƒ","can_delete":false,"product_type":"c1","uid":1451048,"ip_address":"","ucode":"873F7222DE35BE","user_header":"https://static001.geekbang.org/account/avatar/00/16/24/28/9b5b1396.jpg","comment_is_top":false,"comment_ctime":1606536198,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606536198","product_id":100023901,"comment_content":"è¿™ä¸¤ä¸ªå˜é‡ç”¨äº† AtomicLong è¿™ä¸ªåŸå­ç±»ï¼ŒåŸå­ç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªæˆå‘˜å˜é‡çš„ set æ–¹æ³•å°±ä¸éœ€è¦åŒæ­¥äº†ã€‚<br><br>è€å¸ˆï¼Œä¸ºä½•ä½ éƒ½è¯´äº†setå®‰å…¨äº†ï¼Œé‚£åœ¨é‡Œé¢å†™çš„ä»£ç ï¼Œå°±ä¸å®‰å…¨äº†ï¼Ÿ","like_count":0},{"had_liked":false,"id":249664,"user_name":"maybe","can_delete":false,"product_type":"c1","uid":1475528,"ip_address":"","ucode":"93D160F617E750","user_header":"https://static001.geekbang.org/account/avatar/00/16/83/c8/5ce842f6.jpg","comment_is_top":false,"comment_ctime":1600747654,"is_pvip":false,"discussion_count":0,"race_medal":4,"score":"1600747654","product_id":100023901,"comment_content":"1ã€å¦‚ä½•å†™å¥½å¹¶å‘ç¨‹åºï¼š1ã€å°è£…å…±äº«å˜é‡ã€‚2ã€è¯†åˆ«å…±äº«å˜é‡çº¦æŸæ¡ä»¶ã€‚3ã€æŒ‡å®šåˆç†è®¿é—®ç­–ç•¥ã€‚<br>2ã€è¯¾åæ€è€ƒï¼ŒsetUpperã€setLoweråŠ ä¸Šéšç§é”synchronizedå³å¯","like_count":0},{"had_liked":false,"id":243689,"user_name":"fightingD","can_delete":false,"product_type":"c1","uid":1443637,"ip_address":"","ucode":"AD2876CED5D5AC","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKwViav94kcF50CxA0Jw7icicxociaVzut97iacy3b2ciacFqXuFWdiakVq304YcI8pt4HT5A1Yvp8EkYCpw/132","comment_is_top":false,"comment_ctime":1598250781,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598250781","product_id":100023901,"comment_content":"ç»™ setUpperï¼ˆï¼‰ï¼ŒsetLower åˆ†åˆ«åŠ ä¸Šsynchronized å…³é”®å­—ã€‚","like_count":0},{"had_liked":false,"id":243283,"user_name":"Aiome","can_delete":false,"product_type":"c1","uid":1306394,"ip_address":"","ucode":"5D3A810C0FF56B","user_header":"","comment_is_top":false,"comment_ctime":1598014484,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598014484","product_id":100023901,"comment_content":"ç»“åˆä¸šåŠ¡æ¥çœ‹ï¼Œæ²¡å¿…è¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œè¿™ç§é…ç½®ä¿®æ”¹ä¸å®¹æ˜“äº§ç”Ÿå¹¶å‘ä¿®æ”¹çš„æ“ä½œ","like_count":0},{"had_liked":false,"id":235139,"user_name":"ç¬¬ä¸€è£…ç”²é›†ç¾¤å¸ä»¤å…‹è±æ–¯ç‰¹","can_delete":false,"product_type":"c1","uid":1265707,"ip_address":"","ucode":"4E8FBB23AD860B","user_header":"https://static001.geekbang.org/account/avatar/00/13/50/2b/2344cdaa.jpg","comment_is_top":false,"comment_ctime":1594903228,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594903228","product_id":100023901,"comment_content":"volatileå…³é”®å­—æœ‰3ä¸ªç‰¹ç‚¹:<br>1-ä¸ä¿è¯åŸå­æ€§<br>2-å…·æœ‰å†…å­˜å¯è§æ€§<br>3-ç¦æ­¢æŒ‡ä»¤é‡æ’","like_count":0},{"had_liked":false,"id":232171,"user_name":"åƒé¥­","can_delete":false,"product_type":"c1","uid":1692756,"ip_address":"","ucode":"AF0D7165D5F049","user_header":"https://static001.geekbang.org/account/avatar/00/19/d4/54/7263deb2.jpg","comment_is_top":false,"comment_ctime":1593880575,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593880575","product_id":100023901,"comment_content":"ä¸Šä¸‹å±Šå°è£…åˆ°ä¸€ä¸ªlongå€¼å†…ï¼Œåˆ†åˆ«å ä½é«˜ä½å’Œä½ä½","like_count":0},{"had_liked":false,"id":209839,"user_name":"M","can_delete":false,"product_type":"c1","uid":1810576,"ip_address":"","ucode":"06F26E1D62E9C9","user_header":"https://wx.qlogo.cn/mmopen/vi_32/eLNeJNaEkwGSK7xvtamMibVLMy2MpbIqX3iaEhT7JtSnTRMRTwZ2j4HX7WAapiashbiaBDVriaXKSP0Oeic6ZAEVEXag/132","comment_is_top":false,"comment_ctime":1587623057,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587623057","product_id":100023901,"comment_content":"æœ€ç®€å•çš„åº”è¯¥å°±æ˜¯setå’Œgetéƒ½åŠ ä¸Šsyå…³é”®å­—äº†<br><br>public class SafeWM {<br>    &#47;&#47; åº“å­˜ä¸Šé™<br>    private final AtomicLong upper =<br>            new AtomicLong(0);<br>    &#47;&#47; åº“å­˜ä¸‹é™<br>    private final AtomicLong lower =<br>            new AtomicLong(0);<br><br>    &#47;&#47; è®¾ç½®åº“å­˜ä¸Šé™<br>    synchronized void setUpper(long v) {<br>        &#47;&#47; æ£€æŸ¥å‚æ•°åˆæ³•æ€§<br>        if (v &lt; lower.get()) {<br>            throw new IllegalArgumentException();<br>        }<br>        upper.set(v);<br>    }<br><br>    &#47;&#47; è®¾ç½®åº“å­˜ä¸‹é™<br>    synchronized void setLower(long v) {<br>        &#47;&#47; æ£€æŸ¥å‚æ•°åˆæ³•æ€§<br>        if (v &gt; upper.get()) {<br>            throw new IllegalArgumentException();<br>        }<br>        lower.set(v);<br>    }<br>    &#47;&#47; çœç•¥å…¶ä»–ä¸šåŠ¡ä»£ç <br>}<br>","like_count":0},{"had_liked":false,"id":208752,"user_name":"looper","can_delete":false,"product_type":"c1","uid":1238396,"ip_address":"","ucode":"DA4BCE83836C04","user_header":"https://static001.geekbang.org/account/avatar/00/12/e5/7c/2a5a418b.jpg","comment_is_top":false,"comment_ctime":1587432507,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587432507","product_id":100023901,"comment_content":"ä½¿ç”¨volatileä¿®é¥°ï¼Œvolatileä¿è¯å¯è§æ€§ï¼ŒAtomicLongä¿è¯åŸå­æ€§","like_count":0},{"had_liked":false,"id":193684,"user_name":"Mr.wang","can_delete":false,"product_type":"c1","uid":1224805,"ip_address":"","ucode":"86F341A5316BBC","user_header":"https://static001.geekbang.org/account/avatar/00/12/b0/65/90387745.jpg","comment_is_top":false,"comment_ctime":1584948369,"is_pvip":false,"discussion_count":1,"race_medal":1,"score":"1584948369","product_id":100023901,"comment_content":"ç‹è€å¸ˆå…³äºè¯¾åçš„é‚£ä¸ªé—®é¢˜ï¼Œæˆ‘æƒ³ç”¨è¯»å†™é”å’Œå…±äº«é”å»è§£å†³ï¼Œä¸çŸ¥é“æ˜¯å¦å¯ä»¥ã€‚","like_count":0,"discussions":[{"author":{"id":2330905,"avatar":"https://static001.geekbang.org/account/avatar/00/23/91/19/6a3e7efc.jpg","nickname":"ç¨‹åºå‘˜9527","note":"","ucode":"1A1609F6BEAD84","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380308,"discussion_content":"å¯ä»¥ï¼Œå°±æ˜¯è¦è¯»å†™äº’æ–¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624433804,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":191641,"user_name":"zhangchao","can_delete":false,"product_type":"c1","uid":1508339,"ip_address":"","ucode":"E665D153A85DE0","user_header":"https://static001.geekbang.org/account/avatar/00/17/03/f3/0bd094ad.jpg","comment_is_top":false,"comment_ctime":1584786354,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584786354","product_id":100023901,"comment_content":"å†™çš„å¤ªå¥½äº†","like_count":0},{"had_liked":false,"id":186812,"user_name":"ç ´æ™“","can_delete":false,"product_type":"c1","uid":1350425,"ip_address":"","ucode":"1162E00FF08DF3","user_header":"https://static001.geekbang.org/account/avatar/00/14/9b/19/41dbba8c.jpg","comment_is_top":false,"comment_ctime":1583932961,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583932961","product_id":100023901,"comment_content":"ä¸‹é¢ä»£ç æ˜¯å¦æ¯”synchroniezedæœ‰è¯»çš„ä¼˜åŠ¿?<br>```<br>public class SafeVM {<br>    &#47;&#47; åº“å­˜ä¸Šé™<br>    private final AtomicLong upper = new AtomicLong(2);<br>    &#47;&#47; åº“å­˜ä¸‹é™<br>    private final AtomicLong lower = new AtomicLong(5);<br>    &#47;&#47; è¯»å†™é”<br>    private ReadWriteLock rwl = new ReentrantReadWriteLock();<br><br>    void setUpper(long v) {<br>        rwl.readLock().lock();<br>        long lowerTmp;<br>        try {<br>            lowerTmp = lower.get();<br>            if (v &lt; lowerTmp) {<br>                throw new IllegalArgumentException();<br>            }<br>            rwl.readLock().unlock();<br>            rwl.writeLock().lock();<br>            try {<br>                long lowerTmp1 = lower.get();<br>                if (lowerTmp != lowerTmp1) {<br>                    if (v &lt; lowerTmp1) {<br>                        throw new IllegalArgumentException();<br>                    }<br>                }<br>                upper.set(v);<br>            } finally {<br>                rwl.writeLock().unlock();<br>            }<br>        } finally {<br>            rwl.readLock().unlock();<br>        }<br>    }<br><br>    void setLower(long v) {<br>        rwl.readLock().lock();<br>        long upperTmp;<br>        try {<br>            upperTmp = upper.get();<br>            if (v &gt; upperTmp) {<br>                throw new IllegalArgumentException();<br>            }<br>            rwl.readLock().unlock();<br>            rwl.writeLock().lock();<br>            try {<br>                long upperTmp1 = upper.get();<br>                if (upperTmp != upperTmp1) {<br>                    if (v &lt; upperTmp1) {<br>                        throw new IllegalArgumentException();<br>                    }<br>                }<br>                lower.set(v);<br>            } finally {<br>                rwl.writeLock().unlock();<br>            }<br>        } finally {<br>            rwl.readLock().unlock();<br>        }<br>    }<br>    &#47;&#47; çœç•¥å…¶ä»–ä¸šåŠ¡ä»£ç <br>}```","like_count":0},{"had_liked":false,"id":179984,"user_name":"è›‹ç‚’é¥­åŠ é¸¡è›‹","can_delete":false,"product_type":"c1","uid":1628398,"ip_address":"","ucode":"C75E27B9FB3336","user_header":"https://static001.geekbang.org/account/avatar/00/18/d8/ee/17f220b6.jpg","comment_is_top":false,"comment_ctime":1582154535,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582154535","product_id":100023901,"comment_content":"è€å¸ˆè¯·é—®ä¸€ä¸‹ï¼Œsynchronized void setUpper(long v)å’Œåœ¨ifè¯­å¥å¤–å±‚å¥—ä¸Šsynchronized(this)ï¼Œè¿™ä¸¤ç§æ–¹æ¡ˆæ˜¯ä¸€æ ·çš„å—ï¼Œæˆ‘ç†è§£éƒ½æ˜¯å½“å‰å¯¹è±¡ä½œä¸ºäº’æ–¥é”å§ã€‚","like_count":0},{"had_liked":false,"id":176387,"user_name":"supermouse","can_delete":false,"product_type":"c1","uid":1321860,"ip_address":"","ucode":"88072D5F881827","user_header":"https://static001.geekbang.org/account/avatar/00/14/2b/84/07f0c0d6.jpg","comment_is_top":false,"comment_ctime":1581046580,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1581046580","product_id":100023901,"comment_content":"ä¸ç®¡æ˜¯è®¾ç½®åº“å­˜ä¸Šé™è¿˜æ˜¯åº“å­˜ä¸‹é™ï¼Œéƒ½è¦åŒæ—¶æ‹¿åˆ°åº“å­˜ä¸Šé™å’Œåº“å­˜ä¸‹é™è¿™ä¸¤ä¸ªé”æ‰èƒ½è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œï¼Œä¸ºäº†é¿å…æ­»é”ï¼Œéƒ½æ˜¯å…ˆç”³è¯·åº“å­˜ä¸Šé™ï¼Œå†ç”³è¯·åº“å­˜ä¸‹é™<br>public class SafeWM {<br>    &#47;&#47; åº“å­˜ä¸Šé™<br>    private final AtomicLong upper = new AtomicLong(10);<br>    &#47;&#47; åº“å­˜ä¸‹é™<br>    private final AtomicLong lower = new AtomicLong(2);<br>    &#47;&#47; çº¿ç¨‹å®‰å…¨è®¾ç½®åº“å­˜ä¸Šé™<br>    void safeSetUpper(long v){<br>        &#47;&#47;é”å®šåº“å­˜ä¸‹é™<br>        synchronized (upper) {<br>            &#47;&#47;é”å®šåº“å­˜ä¸Šé™<br>            synchronized (lower) {<br>                &#47;&#47; æ£€æŸ¥å‚æ•°åˆæ³•æ€§<br>                if (v &lt; lower.get()) {<br>                    throw new IllegalArgumentException();<br>                }<br>                upper.set(v);<br>            }<br>        }<br>    }<br>    &#47;&#47; çº¿ç¨‹å®‰å…¨è®¾ç½®åº“å­˜ä¸‹é™<br>    void safeSetLower(long v){<br>        &#47;&#47;é”å®šåº“å­˜ä¸‹é™<br>        synchronized (upper) {<br>            &#47;&#47;é”å®šåº“å­˜ä¸Šé™<br>            synchronized (lower) {<br>                &#47;&#47; æ£€æŸ¥å‚æ•°åˆæ³•æ€§<br>                if (v &gt; upper.get()) {<br>                    throw new IllegalArgumentException();<br>                }<br>                lower.set(v);<br>            }<br>        }<br>    }<br>}","like_count":0,"discussions":[{"author":{"id":1810576,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/eLNeJNaEkwGSK7xvtamMibVLMy2MpbIqX3iaEhT7JtSnTRMRTwZ2j4HX7WAapiashbiaBDVriaXKSP0Oeic6ZAEVEXag/132","nickname":"M","note":"","ucode":"06F26E1D62E9C9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369275,"discussion_content":"æ€§èƒ½æ¯”è¾ƒä½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618994188,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":175724,"user_name":"æ—…é€”","can_delete":false,"product_type":"c1","uid":1212902,"ip_address":"","ucode":"5022477E8E9441","user_header":"https://static001.geekbang.org/account/avatar/00/12/81/e6/6cafed37.jpg","comment_is_top":false,"comment_ctime":1580808343,"is_pvip":false,"replies":[{"id":"68298","content":"é¢„ä¼°æ˜¯ä¸ç»å‹æµ‹æ‹è„‘é—¨","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1580820563,"ip_address":"","comment_id":175724,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1580808343","product_id":100023901,"comment_content":"è€å¸ˆ ä½ è¯´çš„è¿™å¥è¯  <br><br>å¾ˆå¤šäººç»å¸¸ä¼šæƒ…ä¸è‡ªç¦åœ°é¢„ä¼°æ€§èƒ½çš„ç“¶é¢ˆï¼Œå¹¶å¯¹æ­¤å®æ–½ä¼˜åŒ–ï¼Œä½†æ®‹é…·çš„ç°å®å´æ˜¯ï¼šæ€§èƒ½ç“¶é¢ˆä¸æ˜¯ä½ æƒ³é¢„ä¼°å°±èƒ½é¢„ä¼°çš„ã€‚<br><br>æ€ä¹ˆç†è§£å‘¢ æˆ‘å…ˆä¼°è®¡ç”¨æˆ·è®¿é—®é‡è¿›è¡Œå‹æµ‹ å¾—å‡ºæ€§èƒ½ç“¶é¢ˆ è¿™æ ·ä¸è¡Œå— ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482872,"discussion_content":"é¢„ä¼°æ˜¯ä¸ç»å‹æµ‹æ‹è„‘é—¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580820563,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":156851,"user_name":"å¤§å¤§ã€‚","can_delete":false,"product_type":"c1","uid":1237399,"ip_address":"","ucode":"A6716E46264AC4","user_header":"https://static001.geekbang.org/account/avatar/00/12/e1/97/fec494f2.jpg","comment_is_top":false,"comment_ctime":1574988399,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574988399","product_id":100023901,"comment_content":"åŠ ä¸€ä¸ªlockï¼Œåœ¨seté‡Œé¢å»è·å–lockï¼Œè·å–åˆ°çš„æ‰èƒ½set","like_count":0},{"had_liked":false,"id":150064,"user_name":"æœ•çˆ±å¾å¦ƒ","can_delete":false,"product_type":"c1","uid":1733692,"ip_address":"","ucode":"B10EB69934F9E2","user_header":"https://static001.geekbang.org/account/avatar/00/1a/74/3c/da79d2a1.jpg","comment_is_top":false,"comment_ctime":1573457263,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573457263","product_id":100023901,"comment_content":"æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯åŠ synchronizedå…³é”®å­—ï¼Œä¸è¿‡æˆ‘ä¸è®¤ä¸ºè¿™æ˜¯æœ€ä½³çš„è§£å†³æ–¹æ¡ˆï¼Œè¿™ä¸ªæ–¹æ¡ˆè¿åäº†ä¸‰ä¸ªåŸåˆ™ä¸­ä¸¤ä¸ªåŸåˆ™ï¼Œç¬¬äºŒä¸ªåŸåˆ™å’Œç¬¬ä¸‰ä¸ªåŸåˆ™ï¼Œå…ˆè¯´ç¬¬ä¸‰ä¸ªåŸåˆ™ï¼Œå…¶å®åŠ ä¸Šsynchronizedæ˜¯å±äºè¿‡æ—©çš„ä¼˜åŒ–ï¼Œè§£å†³æ–¹æ¡ˆå°±æ˜¯å¯ä»¥åˆ›å»ºä¸€ä¸ªä¸å˜çš„å¯¹è±¡ï¼Œç„¶åä¸ç®¡æ˜¯è®¾ç½®ä¸Šé™è¿˜æ˜¯è®¾ç½®ä¸‹é™éƒ½éœ€è¦å¯¹è¿™ä¸ªèµ„æºè¿›è¡Œç«äº‰ï¼Œä¸è¿‡ä¹Ÿæ²¡æœ‰æ™šå¤šå°‘ä¼˜åŒ–ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆæ²¡æœ‰è§£å†³ç¬¬äºŒä¸ªåŸåˆ™ï¼Œå› ä¸ºè¿˜æ˜¯ä¼šä½¿ç”¨åˆ°synchronizedçš„å…³é”®å­—... ...ï¼Œè¿™ä¸ªæˆ‘æ²¡æ³•è§£å†³","like_count":0},{"had_liked":false,"id":141792,"user_name":"åƒé¥­é¥­","can_delete":false,"product_type":"c1","uid":1231549,"ip_address":"","ucode":"95CFA07CDA2957","user_header":"https://static001.geekbang.org/account/avatar/00/12/ca/bd/a51ae4b2.jpg","comment_is_top":false,"comment_ctime":1571225458,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571225458","product_id":100023901,"comment_content":"ä¸èƒ½é” synchronized(å½“å‰å‚æ•°å€¼) å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":134606,"user_name":"DFighting","can_delete":false,"product_type":"c1","uid":1233193,"ip_address":"","ucode":"F3BA2426FF8582","user_header":"https://static001.geekbang.org/account/avatar/00/12/d1/29/1b1234ed.jpg","comment_is_top":false,"comment_ctime":1568877572,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1568877572","product_id":100023901,"comment_content":"ç”¨å‰å‡ ç« çš„é‚£ä¸ªè½¬è´¦ä¾‹å­ç”¨åˆ°çš„ï¼Œæ¯æ¬¡æ‰§è¡Œsetæ–¹æ³•æ—¶éƒ½è¦åœ¨ä¸€ä¸ªLockæ–¹æ³•ä¸­æŒæœ‰ä¸Šé™å’Œä¸‹é™ï¼Œç„¶ååˆ¤æ–­æ˜¯å¦ç¬¦åˆçº¦æŸï¼Œçº¿ç¨‹é—´åä½œå¯ä»¥è€ƒè™‘synchronized+wait()+notifyAll()æˆ–Lock+Conditionå®ç°ï¼›<br>","like_count":0},{"had_liked":false,"id":130642,"user_name":"éšå¿ƒè€Œè‡³","can_delete":false,"product_type":"c1","uid":1097836,"ip_address":"","ucode":"31866865255101","user_header":"https://static001.geekbang.org/account/avatar/00/10/c0/6c/29be1864.jpg","comment_is_top":false,"comment_ctime":1567500305,"is_pvip":false,"replies":[{"id":"48862","content":"æˆ‘è§‰å¾—å¯ä»¥å‚è€ƒç€å­¦ï¼Œäº’æœ‰è¡¥å……","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1567501505,"ip_address":"","comment_id":130642,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1567500305","product_id":100023901,"comment_content":"æˆ‘è§‰å¾—å…ˆçœ‹Javaç¼–ç¨‹çš„è‰ºæœ¯ï¼Œå†å­¦ä¹ ä¸“æ ï¼Œå†å­¦ä¹ Javaå¹¶å‘ç¼–ç¨‹å®æˆ˜ï¼›åé¢å¦‚æœè‡ªå·±è¿˜æƒ³æ·±å…¥å¯ä»¥å†å­¦ä¹ æ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºï¼ŒJavaè¯­è¨€è§„èŒƒï¼Œæ“ä½œç³»ç»Ÿï¼ˆæ¯”å¦‚æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿï¼‰ç­‰ï¼Œä¸çŸ¥é“é¡ºåºå¯¹ä¸å¯¹ï¼Œè¿˜è¯·è€å¸ˆæŒ‡æ­£","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466045,"discussion_content":"æˆ‘è§‰å¾—å¯ä»¥å‚è€ƒç€å­¦ï¼Œäº’æœ‰è¡¥å……","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567501505,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128557,"user_name":"Simple life","can_delete":false,"product_type":"c1","uid":1571460,"ip_address":"","ucode":"1902D7F72FB43F","user_header":"https://static001.geekbang.org/account/avatar/00/17/fa/84/f01d203a.jpg","comment_is_top":false,"comment_ctime":1566902180,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566902180","product_id":100023901,"comment_content":"è¿™ä¸ªä¾‹å­ä¸å¤ªæ°å½“ï¼Œè®¾ç½®åº“å­˜ä¸€èˆ¬ä¸ä¼šå­˜åœ¨å¹¶å‘é—®é¢˜ï¼Œå› ä¸ºè®¿é—®é‡å¤ªä½äº†ï¼Œå¹¶å‘é—®é¢˜å‡ ç‡å¤ªä½äº†ï¼Œæ‰£åº“å­˜è¡Œä¸ºä¸¾ä¾‹åˆé€‚ä¸€ç‚¹","like_count":0},{"had_liked":false,"id":126167,"user_name":"å†‰é‡","can_delete":false,"product_type":"c1","uid":1137353,"ip_address":"","ucode":"2CAEA424996876","user_header":"https://static001.geekbang.org/account/avatar/00/11/5a/c9/933ee0a8.jpg","comment_is_top":false,"comment_ctime":1566345265,"is_pvip":false,"replies":[{"id":"46578","content":"æ²¡è¿™æ„æ€ğŸ˜‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1566359300,"ip_address":"","comment_id":126167,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566345265","product_id":100023901,"comment_content":"javaå¹¶å‘ç¼–ç¨‹å®è·µ ä¹¦ä¸­æ˜¯è¯´æœ€å…ˆè€ƒè™‘synchronizedåŒæ­¥ï¼Œç„¶ååœ¨è€ƒè™‘lock ï¼Œä½†æ˜¯è€å¸ˆå´è¯´çš„æ˜¯ç›¸åæ„æ€ã€‚","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463860,"discussion_content":"æ²¡è¿™æ„æ€ğŸ˜‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566359300,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125416,"user_name":"é€†æµçš„é±¼","can_delete":false,"product_type":"c1","uid":1258399,"ip_address":"","ucode":"AA3DDE44A83C40","user_header":"https://static001.geekbang.org/account/avatar/00/13/33/9f/8dbd9558.jpg","comment_is_top":false,"comment_ctime":1566181402,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566181402","product_id":100023901,"comment_content":"æˆç†Ÿçš„å·¥å…·ç±»æŒ‡çš„å•¥ï¼Ÿæˆ‘æ€ä¹ˆæ„Ÿè§‰æ˜¯åŒæ­¥åŸè¯­(synchronizedè¿™äº›)å•Š","like_count":0},{"had_liked":false,"id":123172,"user_name":"é£ç¿”","can_delete":false,"product_type":"c1","uid":1068571,"ip_address":"","ucode":"65AF6AF292DAD6","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/1b/f4b786b9.jpg","comment_is_top":false,"comment_ctime":1565619604,"is_pvip":true,"replies":[{"id":"52713","content":"æ²¡æè¿‡jvmï¼Œè¯´ä¸æ¸…å•ŠğŸ˜‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1569668627,"ip_address":"","comment_id":123172,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1565619604","product_id":100023901,"comment_content":"è€å¸ˆ ä¸ºå•¥ å¯¹äºè¿™äº›ä¸ä¼šå‘ç”Ÿå˜åŒ–çš„å…±äº«å˜é‡ï¼Œå»ºè®®ä½ ç”¨ final å…³é”®å­—ä¿®é¥°ã€‚ ä¸ºä»€ä¹ˆç”¨finalä¿®é¥°äº†ï¼Œå°±æ²¡æœ‰å¹¶å‘é—®é¢˜äº† æ±‚æ•™<br><br>","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462567,"discussion_content":"æ²¡æè¿‡jvmï¼Œè¯´ä¸æ¸…å•ŠğŸ˜‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569668627,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1264135,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/07/1cab75cc.jpg","nickname":"å°å‘¨åŒå­¦","note":"","ucode":"28D157B7AAA377","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6478,"discussion_content":"ç”¨finalä¿è¯ä¸å¯å˜ï¼Œä¸å¯å˜åˆä¿è¯äº†çº¿ç¨‹å®‰å…¨ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1566916790,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118084,"user_name":"HUANGKAIHANG","can_delete":false,"product_type":"c1","uid":1430163,"ip_address":"","ucode":"F3871C5142AE52","user_header":"https://static001.geekbang.org/account/avatar/00/15/d2/93/9c58ce42.jpg","comment_is_top":false,"comment_ctime":1564234008,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564234008","product_id":100023901,"comment_content":"setUpper() è·Ÿ setLower() éƒ½åŠ ä¸Š &quot;synchronized&quot; å…³é”®å­—ã€‚è€å¸ˆæˆ‘æƒ³è¯·é—®ä¸€ä¸‹ï¼Œè¿™ä¸ªæ–¹æ¡ˆè¦å®ç°åº“å­˜ç®¡ç†çš„çº¿ç¨‹å®‰å…¨ï¼Œå®ƒè¦æ±‚åº“å­˜ç®¡ç†ç±»æ˜¯å•ä¾‹çš„ï¼Œå› ä¸ºå¦‚æœä¸¤ä¸ªçº¿ç¨‹æ“ä½œä¸¤ä¸ªä¸åŒçš„åº“å­˜ç®¡ç†å¯¹è±¡ï¼Œé‚£åŠ é”å°±æ²¡æ„ä¹‰äº†ã€‚","like_count":0},{"had_liked":false,"id":104865,"user_name":"Geek","can_delete":false,"product_type":"c1","uid":1466335,"ip_address":"","ucode":"1B8EB2C26DE4EC","user_header":"https://static001.geekbang.org/account/avatar/00/16/5f/df/3c4881f0.jpg","comment_is_top":false,"comment_ctime":1560859957,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1560859957","product_id":100023901,"comment_content":"æˆ‘è§‰å¾—åº“å­˜ä¸Šä¸‹é™çº¿ç¨‹ä¸å®‰å…¨çš„ä¸»è¦æ˜¯å¯¹åº“å­˜ä¸Šä¸‹é™çš„è®¾ç½®ä¸æ˜¯åŸå­æ€§çš„ï¼Œæˆ‘è§‰å¾—å¯ä»¥åˆ©ç”¨inté«˜ä½ä½å­˜å‚¨æ•°æ®ï¼Œé«˜ä½å­˜å‚¨åº“å­˜ä¸Šçº¿ï¼Œä½ä½å­˜å‚¨åº“å­˜ä¸‹é™ã€‚åˆ©ç”¨volatile+casæ¥å¤„ç†ï¼Œè¿˜å¯ä»¥åšåˆ°æ— é”åŒ–","like_count":0},{"had_liked":false,"id":95259,"user_name":"minggushen","can_delete":false,"product_type":"c1","uid":1441635,"ip_address":"","ucode":"60A76A58F81D7A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIhvw4HpdqXOUJnFcRKsKZwZAubZwYCtqFYLNVpp52QEWTZoMHU0DU634loe8ia4iaZibBege6SpLatQ/132","comment_is_top":false,"comment_ctime":1558000296,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558000296","product_id":100023901,"comment_content":"getsetæ–¹æ³•ä½¿ç”¨ä¸€æŠŠé”å°±å¥½ï¼Œ","like_count":0},{"had_liked":false,"id":93910,"user_name":"null","can_delete":false,"product_type":"c1","uid":1024294,"ip_address":"","ucode":"F9039EFED6B55D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","comment_is_top":false,"comment_ctime":1557661639,"is_pvip":false,"replies":[{"id":"33666","content":"ä½ è¯´çš„è¿™ä¸ªæ¡ä»¶ä¸‹ï¼Œæœ‰synchä¿è¯äº’æ–¥å°±æ²¡å¿…è¦ç”¨å…¶ä»–æ‰‹æ®µäº†ï¼Œå¦‚æœè¿˜æœ‰è¯»æ“ä½œï¼Œè€Œè¯»æ“ä½œæ²¡ç”¨synchï¼Œæœ€å¥½ç”¨åŒæ—¶ç”¨volatileã€‚æ€»ä¹‹èƒ½ç”¨å†…å­˜æ¨¡å‹çš„è§„åˆ™æ¨æ–­å‡ºæ¥å¯è§æ€§å°±å¯ä»¥<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1557757242,"ip_address":"","comment_id":93910,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1557661639","product_id":100023901,"comment_content":"synchronized this(æ— éœ€ volatile)<br>@è“å¤©ç™½äº‘çœ‹â€¦<br>@éç¤¼å‹¿è¨€-â€¦<br><br>synchronized this + volatileï¼š<br>@é–è¿œå°å’Œå°š<br>@é™ˆååº”<br><br>çœ‹äº†è€å¸ˆå¯¹ä»–ä»¬çš„å›å¤ï¼Œæ„Ÿè§‰ä¸€ä¸‹åˆè¿·ç³Šäº†ã€‚<br><br>--------<br><br>å‡è®¾æˆå‘˜å˜é‡ upperã€lower åªæœ‰ setUpper(...) å’Œ setLower(...) æ–¹æ³•å¯¹å…¶æ›´æ–°ï¼Œåªè¦ä¿è¯è¿™ä¸¤ä¸ª set æ–¹æ³•äº’æ–¥å°±å¯ä»¥äº†ï¼Œå³ synchronized setUpper(...) å’Œ synchronized setLower(...)ã€‚è€Œæˆå‘˜å˜é‡åœ¨æ­¤ä¹Ÿå¯ä»¥ä» atomic æ¢æˆåŸå§‹æ•°æ®ç±»å‹ã€‚<br>å¦‚ç†è§£æœ‰è¯¯ï¼Œè¿˜æœ›è€å¸ˆæŒ‡æ­£ï¼Œè°¢è°¢ï¼ï¼","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":449825,"discussion_content":"ä½ è¯´çš„è¿™ä¸ªæ¡ä»¶ä¸‹ï¼Œæœ‰synchä¿è¯äº’æ–¥å°±æ²¡å¿…è¦ç”¨å…¶ä»–æ‰‹æ®µäº†ï¼Œå¦‚æœè¿˜æœ‰è¯»æ“ä½œï¼Œè€Œè¯»æ“ä½œæ²¡ç”¨synchï¼Œæœ€å¥½ç”¨åŒæ—¶ç”¨volatileã€‚æ€»ä¹‹èƒ½ç”¨å†…å­˜æ¨¡å‹çš„è§„åˆ™æ¨æ–­å‡ºæ¥å¯è§æ€§å°±å¯ä»¥\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557757242,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":85901,"user_name":"çš®è›‹","can_delete":false,"product_type":"c1","uid":1202619,"ip_address":"","ucode":"8384CC338549EB","user_header":"https://static001.geekbang.org/account/avatar/00/12/59/bb/caf2b06c.jpg","comment_is_top":false,"comment_ctime":1555289849,"is_pvip":false,"replies":[{"id":"30924","content":"å¯ä»¥ç”¨æ— é”ç®—æ³•ï¼Œä¸è¿‡éƒ½å¾ˆå¤æ‚ï¼Œå»ºè®®è¿˜æ˜¯å…ˆç”¨é”","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1555327789,"ip_address":"","comment_id":85901,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555289849","product_id":100023901,"comment_content":"æ–¹æ³•å†…ä½¿ç”¨å¯¹è±¡åŠ ğŸ”’å¯ä»¥è§£å†³ç«æ€æ¡ä»¶ï¼Œä½†ä¸å°±æ˜¯ç”¨äº†ä½çº§çš„åŸè¯­å¤„ç†äº†å—ï¼Œè¿˜æœ‰å…¶ä»–æ›´å¥½çš„æ–¹å¼å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446858,"discussion_content":"å¯ä»¥ç”¨æ— é”ç®—æ³•ï¼Œä¸è¿‡éƒ½å¾ˆå¤æ‚ï¼Œå»ºè®®è¿˜æ˜¯å…ˆç”¨é”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555327789,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":82778,"user_name":"ç¼ªæ–‡","can_delete":false,"product_type":"c1","uid":1042262,"ip_address":"","ucode":"59603B50EF5FC6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e7/56/c72997f3.jpg","comment_is_top":false,"comment_ctime":1554304160,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554304160","product_id":100023901,"comment_content":"ä½œä¸ºåç«¯æœåŠ¡å¼€å‘è€…ï¼Œæˆ‘ä»¬å¼€å‘çš„æ˜¯æœåŠ¡æ¥å£ï¼Œå®é™…ä¸Šå¾ˆå¤šå¹¶å‘é—®é¢˜éƒ½ä¸ä¼šé‡åˆ°ï¼Œæ¯”å¦‚è¿™é‡Œæåˆ°çš„è®¾ç½®åº“å­˜ä¸Šä¸‹çº¿ï¼Œè¦è€ƒè™‘ä¸Šé™è¦å¤§äºä¸‹é™ï¼Œéƒ½æ˜¯åœ¨æ•°æ®åº“å±‚æ‰è€ƒè™‘çš„ï¼Œjavaè¿™ä¸€å±‚dubboä¸ºæ¯ä¸ªè¯·æ±‚åˆ†é…ä¸åŒçš„çº¿ç¨‹çš„","like_count":0},{"had_liked":false,"id":82714,"user_name":"ZOUå¿—ä¼Ÿ","can_delete":false,"product_type":"c1","uid":1029179,"ip_address":"","ucode":"439779871CC992","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b4/3b/a1f7e3a4.jpg","comment_is_top":false,"comment_ctime":1554283423,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554283423","product_id":100023901,"comment_content":"åˆ©ç”¨ä¹‹å‰ç®¡ç¨‹çš„ç®¡ç¨‹çŸ¥è¯†ä¹Ÿå¯ä»¥è§£å†³è¿™ä¸ªçº¦æŸæ¡ä»¶é—®é¢˜","like_count":0},{"had_liked":false,"id":81686,"user_name":"è“å¤©ç™½äº‘çœ‹å¤§æµ·","can_delete":false,"product_type":"c1","uid":1302670,"ip_address":"","ucode":"02EF13FE37174B","user_header":"https://static001.geekbang.org/account/avatar/00/13/e0/8e/2376cd87.jpg","comment_is_top":false,"comment_ctime":1554006847,"is_pvip":false,"replies":[{"id":"29620","content":"å¦‚æœç”¨syncronizedï¼Œå°±æ²¡å¿…è¦åŠ volatile","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1554030121,"ip_address":"","comment_id":81686,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554006847","product_id":100023901,"comment_content":"æœ‰äº›è¯„è®ºé‡Œè¯´ï¼ŒåŠ syncronizedå’Œvolatileï¼Œä½†æˆ‘è§‰å¾—syncronizedå·²ç»å¯ä»¥ä¿è¯å¯è§æ€§å•Šï¼Œä¸ºå•¥è¿˜è¦åŠ volatileï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445298,"discussion_content":"å¦‚æœç”¨syncronizedï¼Œå°±æ²¡å¿…è¦åŠ volatile","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554030121,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81241,"user_name":"Cc","can_delete":false,"product_type":"c1","uid":1441727,"ip_address":"","ucode":"1B822D627C6284","user_header":"https://static001.geekbang.org/account/avatar/00/15/ff/bf/2f0a337c.jpg","comment_is_top":false,"comment_ctime":1553841216,"is_pvip":false,"replies":[{"id":"29491","content":"æˆ‘æ„Ÿè§‰åº”è¯¥æ²¡æœ‰","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553907005,"ip_address":"","comment_id":81241,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1553841216","product_id":100023901,"comment_content":"çœ‹åˆ°å‰é¢å¥½å¤šäººç”¨casæ“ä½œï¼Œæˆ‘ä¹Ÿæƒ³äº†ä¸€ä¸‹ï¼Œæ˜¯ä¸è¡Œçš„ï¼Œå› ä¸ºcasåªèƒ½åŒæ—¶æ“ä½œä¸€ä¸ªå˜é‡ï¼Œè¿™æ¶‰åŠäº†ä¸¤ä¸ªå˜é‡ã€‚æƒ³é—®ä¸‹è€å¸ˆjavaæœ‰æ¶‰åŠä¸¤ä¸ªå˜é‡çš„caså—ã€‚æ¯”å¦‚å•Ša b   ä¸¤ä¸ªå˜é‡ã€‚å¦‚æœbçš„å€¼ä¸ºæ¯”å°±æŠŠaè®¾ä¸ºcï¼Œç±»ä¼¼redisçš„watchã€‚","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445127,"discussion_content":"æˆ‘æ„Ÿè§‰åº”è¯¥æ²¡æœ‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553907005,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1233193,"avatar":"https://static001.geekbang.org/account/avatar/00/12/d1/29/1b1234ed.jpg","nickname":"DFighting","note":"","ucode":"F3BA2426FF8582","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":16228,"discussion_content":"casåº”è¯¥ä¹Ÿéœ€è¦åœ¨è®¡ç®—å·®å€¼çš„æ—¶å€™ä¸Šé”çš„ï¼Œæˆ‘è§‰å¾—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568878186,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81062,"user_name":"CityAnimal","can_delete":false,"product_type":"c1","uid":1139902,"ip_address":"","ucode":"206491F70572AE","user_header":"https://static001.geekbang.org/account/avatar/00/11/64/be/12c37d15.jpg","comment_is_top":false,"comment_ctime":1553789024,"is_pvip":true,"replies":[{"id":"29479","content":"<br>ä¸€è‡´æ€§çº¦æŸæ˜¯ï¼Œæœ€å¤§åº“å­˜å¤§äºæœ€å°åº“å­˜ï¼Œæ‰€ä»¥é€»è¾‘å¥½åƒä¸å¯¹<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553863049,"ip_address":"","comment_id":81062,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553789024","product_id":100023901,"comment_content":"ä½¿ç”¨AtomicLongçš„compareAndSetæ–¹æ³•å¯ä»¥å—ï¼Ÿ<br><br>&#47;**<br>     * è®¾ç½®åº“å­˜ä¸Šé™<br>     *&#47;<br>    void setUpper(long v) {<br>        long previous;<br>        do {<br>            previous = upper.get();<br>            if (v &lt; previous) {<br>                throw new IllegalArgumentException();<br>            }<br>        } while (!upper.compareAndSet(previous, v));<br>    }<br><br>    &#47;**<br>     * è®¾ç½®åº“å­˜ä¸‹é™<br>     *&#47;<br>    void setLower(long v) {<br>        long previous;<br>        do {<br>            previous = lower.get();<br>            if (v &gt; previous) {<br>                throw new IllegalArgumentException();<br>            }<br>        } while (!lower.compareAndSet(previous, v));<br>    }","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445065,"discussion_content":"\nä¸€è‡´æ€§çº¦æŸæ˜¯ï¼Œæœ€å¤§åº“å­˜å¤§äºæœ€å°åº“å­˜ï¼Œæ‰€ä»¥é€»è¾‘å¥½åƒä¸å¯¹\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553863049,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81032,"user_name":"å°‘ä¸»æ±Ÿè¡«","can_delete":false,"product_type":"c1","uid":1443369,"ip_address":"","ucode":"95B503FE19604F","user_header":"https://static001.geekbang.org/account/avatar/00/16/06/29/00a319e3.jpg","comment_is_top":false,"comment_ctime":1553781052,"is_pvip":false,"replies":[{"id":"29493","content":"æ­£ç¡®","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553907299,"ip_address":"","comment_id":81032,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553781052","product_id":100023901,"comment_content":"åˆ†æä¸€ä¸‹ä¸Šè¿°ä»£ç å‡ºç°å¹¶å‘é—®é¢˜çš„æƒ…å†µæ˜¯lower.get() or upper.get()å€¼çš„æ—¶å€™ä¼šè¢«æŠ¢å èµ„æºï¼Œå°±åœ¨è¿™ä¸¤ä¸ªæ“ä½œä¸ŠåŠ é”å³å¯è§£å†³é—®é¢˜ã€‚","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445053,"discussion_content":"æ­£ç¡®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553907299,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":80849,"user_name":"é–è¿œå°å’Œå°š","can_delete":false,"product_type":"c1","uid":1213861,"ip_address":"","ucode":"094FA096B9F9B1","user_header":"https://static001.geekbang.org/account/avatar/00/12/85/a5/471ce926.jpg","comment_is_top":false,"comment_ctime":1553742142,"is_pvip":false,"replies":[{"id":"29392","content":"æ˜¯è¿™æ ·çš„<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553746806,"ip_address":"","comment_id":80849,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553742142","product_id":100023901,"comment_content":" synchronized (this) åŠ åœ¨ifé‚£é‡Œ,è®²é“ç†å·²ç»æ²¡æœ‰å¿…è¦åœ¨ä½¿ç”¨AtomicLongä¿®é¥°é‚£äºŒä¸ªå˜é‡äº†,ç›´æ¥valatieä¿®é¥°ä¸€ä¸‹ä¿è¯å¯è§æ€§, synchronized (this) ä¿è¯åŸå­æ€§.å¸Œæœ›è€å¸ˆæŒ‡æ­£,è¿™æ ·æ˜¯ä¸æ˜¯æ›´å¥½ç‚¹","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445001,"discussion_content":"æ˜¯è¿™æ ·çš„\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553746806,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":80639,"user_name":"å‘æ¡æ©™å­ ã€‚","can_delete":false,"product_type":"c1","uid":1259218,"ip_address":"","ucode":"ED076F4534FFED","user_header":"https://static001.geekbang.org/account/avatar/00/13/36/d2/c7357723.jpg","comment_is_top":false,"comment_ctime":1553692091,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553692091","product_id":100023901,"comment_content":"å¬è€å¸ˆçš„ å»æŠŠä¹¦ç¬¬ä¸‰ç« ç¬¬å››ç« çŸ¥è¯†çœ‹ä¸€éğŸ˜","like_count":0},{"had_liked":false,"id":80444,"user_name":"å—å±±","can_delete":false,"product_type":"c1","uid":1119593,"ip_address":"","ucode":"94656FE4A6C378","user_header":"https://static001.geekbang.org/account/avatar/00/11/15/69/187b9968.jpg","comment_is_top":false,"comment_ctime":1553661752,"is_pvip":true,"replies":[{"id":"29303","content":"ğŸ‘<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553694021,"ip_address":"","comment_id":80444,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553661752","product_id":100023901,"comment_content":"1ï¼Œsetæ–¹æ³•synchronized this<br>2ï¼ŒifæŠ½æˆæ–¹æ³•æ·»åŠ synchronized thisï¼Œå˜é‡volatile","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444868,"discussion_content":"ğŸ‘\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553694021,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":80358,"user_name":"æå†°æˆ","can_delete":false,"product_type":"c1","uid":1001490,"ip_address":"","ucode":"300C6893ADE296","user_header":"https://static001.geekbang.org/account/avatar/00/0f/48/12/1457f6df.jpg","comment_is_top":false,"comment_ctime":1553651692,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553651692","product_id":100023901,"comment_content":"æœŸå¾…è€å¸ˆä¸‹é¢æ–‡ç« ","like_count":0},{"had_liked":false,"id":80182,"user_name":"î ”","can_delete":false,"product_type":"c1","uid":1031328,"ip_address":"","ucode":"1B73BA45ACD06C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bc/a0/97c7679b.jpg","comment_is_top":false,"comment_ctime":1553614363,"is_pvip":false,"replies":[{"id":"29231","content":"æœ‰äº›ä¹¦åå¹´å‰åœ¨è¯»ï¼Œåå¹´åè¿˜åœ¨è¯»ï¼Œä½†æ˜¯ç†è§£ä¸åŒäº†ï¼Œæˆ‘åº†å¹¸çš„æ˜¯ä¸€ç›´åœ¨è¯»ã€‚æ²¡æœ‰ç»éªŒå¯ä»¥è‡ªè®¨è‹¦åƒï¼Œè‡ªå·±å‡æƒ³ä¸€ä¸ªé¡¹ç›®æ¥åšï¼Œä¸åŠ¨æ‰‹ä¸é‡åˆ°é—®é¢˜æ˜¯æ²¡åŠæ³•æˆé•¿çš„<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553646848,"ip_address":"","comment_id":80182,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553614363","product_id":100023901,"comment_content":"å¤§ä½¬é—®ä¸‹ï¼Œæˆ‘è¿™ç§å°ç™½(å­¦ç”Ÿï¼Œæ²¡å•¥é¡¹ç›®ç»éªŒ)ã€‚å¦‚ä½•å­¦è¿™ä¸ªï¼Œæ‰æ¯”è¾ƒå¥½ã€‚æ„Ÿè§‰è¿™äº›å†…å®¹æ˜¯æˆ˜ç•¥ä¸Šï¼Œå¯¹æˆ‘æ¥è¯´æ„Ÿè§‰æ¯”è¾ƒç©ºã€‚ ğŸ˜‚ğŸ˜‚","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444776,"discussion_content":"æœ‰äº›ä¹¦åå¹´å‰åœ¨è¯»ï¼Œåå¹´åè¿˜åœ¨è¯»ï¼Œä½†æ˜¯ç†è§£ä¸åŒäº†ï¼Œæˆ‘åº†å¹¸çš„æ˜¯ä¸€ç›´åœ¨è¯»ã€‚æ²¡æœ‰ç»éªŒå¯ä»¥è‡ªè®¨è‹¦åƒï¼Œè‡ªå·±å‡æƒ³ä¸€ä¸ªé¡¹ç›®æ¥åšï¼Œä¸åŠ¨æ‰‹ä¸é‡åˆ°é—®é¢˜æ˜¯æ²¡åŠæ³•æˆé•¿çš„\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553646848,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":80146,"user_name":"å¼ ä¸‰","can_delete":false,"product_type":"c1","uid":1004092,"ip_address":"","ucode":"1155528FAE1546","user_header":"https://static001.geekbang.org/account/avatar/00/0f/52/3c/d6fcb93a.jpg","comment_is_top":false,"comment_ctime":1553609758,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553609758","product_id":100023901,"comment_content":"è€å¸ˆåœ¨ç¬¬ä¸€æ¨¡å—é‡Œè¾¹ä¸¾çš„æ‰€æœ‰ä¾‹å­å‡ ä¹éƒ½çŠ¯è¿‡é”™è¯¯ï¼Œå®Œå…¨æ²¡æœ‰è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œä»¥ä¸ºæ¡†æ¶ï¼ˆæœ€å¸¸ç”¨çš„SpringMVCï¼‰å·²ç»å¸®æˆ‘ä»¬æå®šè¿™äº›äº†ï¼Œçœ‹å®ŒçœŸçš„è®¤è¯†åˆ°äº†ã€‚æ¥ä¸‹æ¥å†è·Ÿç€è€å¸ˆç†Ÿæ‚‰ç†Ÿç»ƒSDKé‡Œè¾¹çš„å¹¶å‘åŒ…ç±»ã€‚","like_count":0},{"had_liked":false,"id":80109,"user_name":"æœ¨å«å…­","can_delete":false,"product_type":"c1","uid":1199495,"ip_address":"","ucode":"D113DF578C5BF5","user_header":"https://static001.geekbang.org/account/avatar/00/12/4d/87/57236a2d.jpg","comment_is_top":false,"comment_ctime":1553606875,"is_pvip":true,"replies":[{"id":"29426","content":"æˆ‘è§‰å¾—1å°±å¯ä»¥äº†ï¼Œfinalä¹Ÿå¯ä»¥ï¼Œå…¶ä»–çš„æœ‰ç‚¹å¤æ‚ï¼Œä¸€ä¸å°å¿ƒå°±ä¼šå‡ºé”™ï¼Œå»ºè®®å·¥ä½œä¸­åˆ«ç”¨<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553781568,"ip_address":"","comment_id":80109,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553606875","product_id":100023901,"comment_content":"æ–¹æ¡ˆä¸€ï¼ŒåŠ é”ï¼š<br>public class SafeWM {<br>  &#47;&#47; åº“å­˜ä¸Šé™<br>  private final AtomicLong upper =<br>        new AtomicLong(0);<br>  &#47;&#47; åº“å­˜ä¸‹é™<br>  private final AtomicLong lower =<br>        new AtomicLong(0);<br>private final Object lock = new Object();<br>  &#47;&#47; è®¾ç½®åº“å­˜ä¸Šé™<br>  void setUpper(long v){<br>synchronized(lock){<br>    if...<br>    upper.set(v);<br>    }<br>  }<br>  &#47;&#47; è®¾ç½®åº“å­˜ä¸‹é™<br>  void setLower(long v){<br>    synchronized(lock){<br>     if...<br>    lower.set(v);}<br>  }<br>  &#47;&#47; çœç•¥å…¶ä»–ä¸šåŠ¡ä»£ç <br>}<br><br>æ–¹æ¡ˆäºŒï¼Œå°†ä¸Šä¸‹é™å°è£…åˆ°ä¸€ä¸ªä¸å¯å˜å¯¹è±¡ä¸­ï¼Œæˆ–è€…å°è£…åˆ°ä¸€ä¸ªprimitiveå˜é‡ä¸­ï¼Œæ¯”å¦‚å¦‚æœæœ€å¤§ä¸Šä¸‹é™ä¸è¶…è¿‡32ä½ï¼Œåˆ†åˆ«æ”¾åˆ°longå‹çš„é«˜ä½32ä½ä¸Šï¼Œä½†æ˜¯åœ¨è·å–ä¸Šæˆ–ä¸‹é™æ—¶éœ€è¦å¦ä¸€ä¸ªåŒæ­¥<br><br>æ–¹æ¡ˆä¸‰ï¼Œè®¾ç½®ä¸¤ä¸ªé”æ¥ç®¡ç†ä¸Šå’Œä¸‹é™çš„äº¤é”™è¯»å’Œå†™ï¼Œä¸ºäº†é¿å…æ­»é”ï¼Œéœ€è¦ä¿æŒlock1ï¼Œlock2çš„é”è·å–é¡ºåº<br><br>è€å¸ˆï¼Œè¿™æ ·æœ‰é—®é¢˜å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444755,"discussion_content":"æˆ‘è§‰å¾—1å°±å¯ä»¥äº†ï¼Œfinalä¹Ÿå¯ä»¥ï¼Œå…¶ä»–çš„æœ‰ç‚¹å¤æ‚ï¼Œä¸€ä¸å°å¿ƒå°±ä¼šå‡ºé”™ï¼Œå»ºè®®å·¥ä½œä¸­åˆ«ç”¨\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553781568,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":80088,"user_name":"ç¬ƒè¡Œä¹‹","can_delete":false,"product_type":"c1","uid":1140311,"ip_address":"","ucode":"F76B5C6D17765E","user_header":"https://static001.geekbang.org/account/avatar/00/11/66/57/e3bd54bd.jpg","comment_is_top":false,"comment_ctime":1553603765,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553603765","product_id":100023901,"comment_content":"synchronized(this)","like_count":0},{"had_liked":false,"id":79997,"user_name":"æå¯å¨","can_delete":false,"product_type":"c1","uid":1440757,"ip_address":"","ucode":"7BB0B44076A4F4","user_header":"https://static001.geekbang.org/account/avatar/00/15/fb/f5/6521cb02.jpg","comment_is_top":false,"comment_ctime":1553590468,"is_pvip":false,"replies":[{"id":"29188","content":"èƒ½<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553604482,"ip_address":"","comment_id":79997,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553590468","product_id":100023901,"comment_content":"åœ¨setUpperå’ŒsetLowerçš„æ–¹æ³•ä¸­ä½¿ç”¨åŒä¸€ä¸ªé”èƒ½è§£å†³é—®é¢˜å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444715,"discussion_content":"èƒ½\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553604482,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79964,"user_name":"æ©˜å­","can_delete":false,"product_type":"c1","uid":1368522,"ip_address":"","ucode":"EDF6145878F897","user_header":"https://static001.geekbang.org/account/avatar/00/14/e1/ca/d8b0835f.jpg","comment_is_top":false,"comment_ctime":1553584929,"is_pvip":false,"replies":[{"id":"29242","content":"åŒæ­¥ä¸€ä¸‹æ–¹æ³•å°±è¡Œäº†ï¼Œä½ çš„ç¬¬äºŒæ¡æ²¡çœ‹æ˜ç™½ğŸ˜‚<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553648817,"ip_address":"","comment_id":79964,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553584929","product_id":100023901,"comment_content":"ç¬¬ä¸€ï¼Œç”¨å§”æ‰˜çš„æ–¹å¼ï¼ŒæŠŠä¸¤ä¸ªå˜é‡æ”¾åˆ°åŒä¸€ä¸ªç±»ä¸­ï¼Œç„¶åç”¨finalæ³¨é‡Šã€‚å› ä¸ºjvmèƒ½å¤Ÿä¿è¯finalç±»å‹çš„å˜é‡ä¸ä¼šé€¸å‡ºã€‚<br>ç¬¬äºŒï¼Œä½¿ç”¨ç›‘è§†å™¨åŒæ­¥ï¼Œæ–¹æ³•ä¸­éœ€è¦åˆ†åˆ«åŒæ­¥ä¸¤ä¸ªå˜é‡ï¼Œä¸»è¦æ˜¯ä¾èµ–happen beforeè§„åˆ™å®ç°ã€‚ä¸çŸ¥é“å¯¹ä¸å¯¹ï¼Œæ˜¯å¦è¿˜æœ‰å…¶ä»–æ–¹æ³•","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444706,"discussion_content":"åŒæ­¥ä¸€ä¸‹æ–¹æ³•å°±è¡Œäº†ï¼Œä½ çš„ç¬¬äºŒæ¡æ²¡çœ‹æ˜ç™½ğŸ˜‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553648817,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79930,"user_name":"wxh","can_delete":false,"product_type":"c1","uid":1310106,"ip_address":"","ucode":"3166AA2DDFBB2E","user_header":"https://static001.geekbang.org/account/avatar/00/13/fd/9a/5be920c9.jpg","comment_is_top":false,"comment_ctime":1553576007,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553576007","product_id":100023901,"comment_content":"ç”¨ä¸€ä¸ªåŸå­æ“ä½œçš„å¼•ç”¨ç±»å‹å°è£…upperå’Œloweræ˜¯å¦å¯ä»¥","like_count":0},{"had_liked":false,"id":79921,"user_name":"Lemon","can_delete":false,"product_type":"c1","uid":1155474,"ip_address":"","ucode":"FED3B7D2931152","user_header":"https://static001.geekbang.org/account/avatar/00/11/a1/92/ad27079c.jpg","comment_is_top":false,"comment_ctime":1553574323,"is_pvip":false,"replies":[{"id":"29318","content":"å¯¹ï¼Œä½†æ˜¯æ€è€ƒé¢˜ä¸æ˜¯å¯è§æ€§é—®é¢˜<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553695639,"ip_address":"","comment_id":79921,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553574323","product_id":100023901,"comment_content":"å°†è¿™ä¸¤ä¸ªå˜é‡æ”¾åˆ°ä¸€ä¸ªç±»é‡Œé¢ï¼Œç„¶åä½¿ç”¨volitaleä¿®é¥°ï¼Œè¿™æ ·ä¿è¯äº†å†™å¯¹è¯»å¯è§ï¼Œè¿™æ ·å¤šå—","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444692,"discussion_content":"å¯¹ï¼Œä½†æ˜¯æ€è€ƒé¢˜ä¸æ˜¯å¯è§æ€§é—®é¢˜\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553695639,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79906,"user_name":"Smile","can_delete":false,"product_type":"c1","uid":1125189,"ip_address":"","ucode":"0617032294DC43","user_header":"https://static001.geekbang.org/account/avatar/00/11/2b/45/e8f64725.jpg","comment_is_top":false,"comment_ctime":1553571899,"is_pvip":false,"replies":[{"id":"29425","content":"1å¯ä»¥ï¼Œ2å·¥ç¨‹ä¸Šæ²¡å¯è¡Œæ€§ï¼Œ3ä¸å¯ä»¥ï¼Œæ²¡æœ‰è§£å†³ç«æ€æ¡ä»¶é—®é¢˜<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553781362,"ip_address":"","comment_id":79906,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553571899","product_id":100023901,"comment_content":"å¯¹äºsafeWMçš„ä¸Šçº¿å’Œä¸‹é™ï¼Œå½“å¤šä¸ªçº¿ç¨‹æ“ä½œè¿™ä¸¤ä¸ªå˜é‡æ—¶ï¼Œç”±äºä¸åŒçº¿ç¨‹æ“ä½œä¸åŒçš„å˜é‡ï¼Œæ‰€ä»¥ä¸å­˜åœ¨å˜é‡çš„ç«äº‰å…³ç³»ï¼Œvolatileå…³é”®å­—æ˜¯ä¿è¯äº†åŒä¸€å˜é‡åœ¨ä¸åŒçº¿ç¨‹çš„å¯è§æ€§é—®é¢˜ï¼Œä½†æ˜¯æ­¤å¤„æ¶‰åŠä¸¤ä¸ªå˜é‡æ‰€ä»¥ï¼Œæ— æ³•è§£å†³ã€‚è§£å†³æ–¹æ³•ï¼š<br>1. åœ¨setæ–¹æ³•ä¸ŠåŠ ä¸Šsynchronizdå…³é”®å­—ï¼Œè¿™æ ·ä½¿ç”¨å…±äº«å˜é‡safeWMæ¥è¿›è¡Œæ§åˆ¶<br>2. åœ¨è¯¥ç±»æ„é€ æ–¹æ³•ä¸­ï¼Œä¼ å…¥åŒä¸€ä¸ªå˜é‡ï¼Œç”¨æ¥ä½œä¸ºé”<br><br>3. ä½¿ç”¨private static volatile SafeWM safeWM = new SafeWM(2,10);ä¿è¯äº†safeWMå†…éƒ¨çš„å‚æ•°æ”¹å˜æ—¶ï¼Œå¼ºè¡Œå†™å…¥å†…å­˜ï¼Œä½¿å…¶ä»–çº¿ç¨‹ä¸­ç¼“å†²å¤±æ•ˆï¼Œä»å†…å­˜è·å–ï¼Œä»è€Œä¿è¯safeWMå†…éƒ¨æ•°æ®çš„å¯è§æ€§ï¼Œä½†æ˜¯å‘ç°ï¼Œä»ç„¶å­˜åœ¨å¹¶å‘é—®é¢˜ï¼Œå¸Œæœ›è€å¸ˆè§£ç­”ä¸€ä¸‹ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444681,"discussion_content":"1å¯ä»¥ï¼Œ2å·¥ç¨‹ä¸Šæ²¡å¯è¡Œæ€§ï¼Œ3ä¸å¯ä»¥ï¼Œæ²¡æœ‰è§£å†³ç«æ€æ¡ä»¶é—®é¢˜\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553781362,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79841,"user_name":"è‹å¿—è¾‰","can_delete":false,"product_type":"c1","uid":1068927,"ip_address":"","ucode":"39B25CE21C04EE","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/7f/5dc11380.jpg","comment_is_top":false,"comment_ctime":1553563056,"is_pvip":false,"replies":[{"id":"29110","content":"æ²¡æƒ³æ¸…æ¥šä½ è¯´çš„è¯»å†™é”<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553571612,"ip_address":"","comment_id":79841,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553563056","product_id":100023901,"comment_content":"å­˜åœ¨é—®é¢˜çš„æœ¬è´¨å°±æ˜¯å› ä¸ºä¸¤ä¸ªå˜é‡å¯èƒ½è¢«åŒæ—¶æ“ä½œï¼Œè§£å†³æ€è·¯å°±æ˜¯åªå…è®¸åŒä¸€æ—¶åˆ»ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹ï¼ŒåŠ synchronizedæˆ–è¯»å†™é”","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444649,"discussion_content":"æ²¡æƒ³æ¸…æ¥šä½ è¯´çš„è¯»å†™é”\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553571612,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79825,"user_name":"é€é¥å­","can_delete":false,"product_type":"c1","uid":1127109,"ip_address":"","ucode":"777CF0635970E1","user_header":"https://static001.geekbang.org/account/avatar/00/11/32/c5/38a59795.jpg","comment_is_top":false,"comment_ctime":1553561829,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553561829","product_id":100023901,"comment_content":"è€å¸ˆè®²å¾—æµ…å…¥æ·±å‡º","like_count":0},{"had_liked":false,"id":79810,"user_name":"å¤šè¥„ä¸¸","can_delete":false,"product_type":"c1","uid":1074310,"ip_address":"","ucode":"1AA1497C5A293C","user_header":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","comment_is_top":false,"comment_ctime":1553560452,"is_pvip":false,"replies":[{"id":"29248","content":"ä¸€ç‚¹éƒ½ä¸ç®€æ´ï¼Œå¦‚æœç®€æ´ä¸€å®šæ˜¯é”™äº†ã€‚æ— é”çš„å¹¶å‘ï¼Œä¿è¯ç»„åˆæ“ä½œçš„åŸå­æ€§æ²¡é‚£ä¹ˆå®¹æ˜“<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553649150,"ip_address":"","comment_id":79810,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553560452","product_id":100023901,"comment_content":"æ¯”èµ· ç”¨åŒæ­¥synchronized ç”¨é”Lock å±è”½å¯è§æ€§ä½¿ç”¨volatile ï¼Œä½¿ç”¨ casæ“ä½œå¥½åƒæ›´ç®€æ´ !","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444636,"discussion_content":"ä¸€ç‚¹éƒ½ä¸ç®€æ´ï¼Œå¦‚æœç®€æ´ä¸€å®šæ˜¯é”™äº†ã€‚æ— é”çš„å¹¶å‘ï¼Œä¿è¯ç»„åˆæ“ä½œçš„åŸå­æ€§æ²¡é‚£ä¹ˆå®¹æ˜“\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553649150,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79794,"user_name":"Vickygu","can_delete":false,"product_type":"c1","uid":1371330,"ip_address":"","ucode":"85E3C158EF6B6F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLUdGtTfe4kBzS6EwvyNkqBGZpKE0vpic8zgZXgoJE3pgHfa2iaulictROn3NsICbZOjz1ELybdf5P6g/132","comment_is_top":false,"comment_ctime":1553558651,"is_pvip":false,"replies":[{"id":"29090","content":"ä¸èƒ½ç”¨é™æ€é”ï¼Œå¤ªå½±å“æ€§èƒ½<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553562335,"ip_address":"","comment_id":79794,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1553558651","product_id":100023901,"comment_content":"æ˜¯ä¸æ˜¯å¯ä»¥è®¾ç½®ä¸€ä¸ªé™æ€é”ï¼Œæ¥é”ä½è¿™ä¸¤ä¸ªèµ„æºï¼špublic class SafeWM {<br>  private final AtomicLong upper = new AtomicLong(0);<br>  private final AtomicLong lower =new AtomicLong(0);<br>  &#47;&#47;é™æ€é”<br>  private static Object lock = new Object();<br><br><br>  void setUpper(long v){<br>    sychronized(lock){<br>        upper.set(v);<br>    }<br>  }<br>  <br>  void setLower(long v){<br>    sychronized(lock){<br>       lower.set(v);<br>       }<br>  }<br>  <br>}","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444627,"discussion_content":"ä¸èƒ½ç”¨é™æ€é”ï¼Œå¤ªå½±å“æ€§èƒ½\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553562335,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1351012,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/64/272dc1b7.jpg","nickname":"åœ†æ»šæ»š","note":"","ucode":"E4D81822A87D50","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3894,"discussion_content":"ç”¨é™æ€é”å’Œsynchronized(DBTest.class)é”ç±»ï¼Œè¿™ä¿©ç§æ–¹å¼æœ‰ä»€ä¹ˆåŒºåˆ«ä¹ˆï¼Œæ€§èƒ½å·®å¼‚ä¸»è¦è¡¨ç°åœ¨å“ªé‡Œï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564934877,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79790,"user_name":"KidğŸ˜‹","can_delete":false,"product_type":"c1","uid":1317216,"ip_address":"","ucode":"7150F69AAAB477","user_header":"https://static001.geekbang.org/account/avatar/00/14/19/60/888f1371.jpg","comment_is_top":false,"comment_ctime":1553558530,"is_pvip":false,"replies":[{"id":"29114","content":"åè€…å¯ä»¥<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553571852,"ip_address":"","comment_id":79790,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553558530","product_id":100023901,"comment_content":"1.ä¿®æ”¹å˜é‡å£°æ˜ï¼Œåˆ©ç”¨transientå…³é”®å­—ä¿®æ”¹ä¸Šä¸‹é™å˜é‡ï¼›<br>2.ç”¨synchronizeä¿®é¥°è®¾ç½®æ–¹æ³•ï¼›<br>è€å¸ˆï¼Œè¿™ä¸¤ç§æ–¹æ³•æ˜¯å¦å¯è¡Œï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444626,"discussion_content":"åè€…å¯ä»¥\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553571852,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79789,"user_name":"è½»æ­Œèµ‹","can_delete":false,"product_type":"c1","uid":1251574,"ip_address":"","ucode":"22F62446208805","user_header":"https://static001.geekbang.org/account/avatar/00/13/18/f6/2ff7bc7a.jpg","comment_is_top":false,"comment_ctime":1553558497,"is_pvip":false,"replies":[{"id":"29309","content":"å¾ˆå…¨é¢ï¼ğŸ‘<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553694795,"ip_address":"","comment_id":79789,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553558497","product_id":100023901,"comment_content":"ç¬¬ä¸€ç§æ–¹æ¡ˆåŠ é”<br>ç¬¬äºŒç§æ–¹æ¡ˆï¼Œä¸¤ä¸ªå˜é‡åªèƒ½é€šè¿‡ä¸€ä¸ªæ–¹æ³•setï¼Œå¦‚æœåªä¿®æ”¹å…¶ä¸­ä¸€ä¸ªï¼Œåˆ™å¦ä¸€ä¸ªä¸ºNullã€‚<br>ä¸¤ä¸ªå±æ€§é¢å¤–å®šä¹‰ä¸€ä¸ªç±»ï¼Œå±æ€§finalã€‚å½“ä¿®æ”¹çš„æ—¶å€™åªèƒ½é¢å¤–åˆ›å»ºæ–°çš„ç±»ï¼Œä¿®æ”¹å¼•ç”¨ã€‚<br>å¯¹äºå¹¶å‘æ›¿æ¢ç±»çš„å¼•ç”¨é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡åŸå­å¼•ç”¨ï¼Œè¿”å›booleanåˆ¤æ–­ã€‚å…·ä½“ä¸æˆåŠŸä¹‹åçš„ç­–ç•¥æ ¹æ®å®é™…æƒ…å†µæ¥ã€‚<br>å¸Œæœ›è€å¸ˆåŒå­¦èƒ½å¤Ÿç»™å‡ºå®è´µçš„æ„è§è¯„ä»·ä¸€ä¸‹æ–¹æ¡ˆçš„ä¼˜åŠ£ï¼Œè°¢è°¢ï¼","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444625,"discussion_content":"å¾ˆå…¨é¢ï¼ğŸ‘\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553694795,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79787,"user_name":"handylin","can_delete":false,"product_type":"c1","uid":1318193,"ip_address":"","ucode":"23EC4EFDB5FFE6","user_header":"https://static001.geekbang.org/account/avatar/00/14/1d/31/dc8ea649.jpg","comment_is_top":false,"comment_ctime":1553558338,"is_pvip":false,"replies":[{"id":"29115","content":"å½“ç„¶ä¸æ˜¯è¿™æ ·ï¼Œå¦‚æœè¿™æ ·å°±æ²¡å¹¶å‘é—®é¢˜äº†<br><br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553571917,"ip_address":"","comment_id":79787,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553558338","product_id":100023901,"comment_content":"å¯ä»¥è¯´è¯´javaå¯¹è±¡ä¹‹é—´æ˜¯æ€ä¹ˆè€ƒè™‘å…±äº«çš„å—ï¼Œ å¿…é¡»è¦ä¸€ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªå¯¹è±¡å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444624,"discussion_content":"å½“ç„¶ä¸æ˜¯è¿™æ ·ï¼Œå¦‚æœè¿™æ ·å°±æ²¡å¹¶å‘é—®é¢˜äº†\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553571917,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79779,"user_name":"é«˜æº","can_delete":false,"product_type":"c1","uid":1048887,"ip_address":"","ucode":"751B41FD38EF7D","user_header":"https://static001.geekbang.org/account/avatar/00/10/01/37/12e4c9c9.jpg","comment_is_top":false,"comment_ctime":1553557742,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553557742","product_id":100023901,"comment_content":"ç‹è€å¸ˆæˆ‘èƒ½æƒ³åˆ°çš„å°±æ˜¯å°†å˜é‡v å‰åŠ ä¸Švolatile,åŸå­æ€§æ§åˆ¶è§£å†³","like_count":0},{"had_liked":false,"id":79778,"user_name":"IamNigel","can_delete":false,"product_type":"c1","uid":1435709,"ip_address":"","ucode":"388064ADD5A38C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJS0jwYKhjm1pRfCu5X6U0VyVS4ibgdhoAkEyV7FNdIMlXoibCyticb0kGYfDUibGcNrHtmkd8SWJekAA/132","comment_is_top":false,"comment_ctime":1553557727,"is_pvip":false,"replies":[{"id":"29092","content":"ç®€å•æ­£ç¡®ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553562510,"ip_address":"","comment_id":79778,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553557727","product_id":100023901,"comment_content":"ç«æ€æ¡ä»¶è¦å®ç°åŒæ­¥","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444620,"discussion_content":"ç®€å•æ­£ç¡®ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553562510,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79776,"user_name":"zhangtnty","can_delete":false,"product_type":"c1","uid":1180553,"ip_address":"","ucode":"3C9A14BD7CF432","user_header":"https://static001.geekbang.org/account/avatar/00/12/03/89/e1621a01.jpg","comment_is_top":false,"comment_ctime":1553557641,"is_pvip":false,"replies":[{"id":"29116","content":"ä¼š<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553571953,"ip_address":"","comment_id":79776,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553557641","product_id":100023901,"comment_content":"æ–‡ä¸­é—®é¢˜å¯ä»¥æŠŠifæ¡ä»¶å’Œsetæ–¹æ³•æ”¾å…¥synchronizedï¼ˆclassï¼‰ä¸­ï¼Œè¿™æ ·ä¼šä¸ä¼šå½±å“æ€§èƒ½ã€‚","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444619,"discussion_content":"ä¼š\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553571953,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79771,"user_name":"WL","can_delete":false,"product_type":"c1","uid":1173771,"ip_address":"","ucode":"6277DCD776B87E","user_header":"https://static001.geekbang.org/account/avatar/00/11/e9/0b/1171ac71.jpg","comment_is_top":false,"comment_ctime":1553555835,"is_pvip":false,"replies":[{"id":"29298","content":"synchç”¨çš„å¤ªå¤šäº†ï¼Œæœ€å¤–é¢ä¸€ä¸ªå°±å¤Ÿäº†<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553687503,"ip_address":"","comment_id":79771,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1553555835","product_id":100023901,"comment_content":"è€å¸ˆå¦‚æœåƒä»¥ä¸‹è¿™ä¹ˆå†™æœ‰ä»€ä¹ˆé—®é¢˜æ²¡?<br>@Data<br>public class SafeWM {<br><br>    private final AtomicLong upper = new AtomicLong(0);<br><br>    private final AtomicLong lower = new AtomicLong(0);<br><br>    public synchronized void setUpper(long v){<br><br>        synchronized (this.lower){<br>            if (this.getLower().get() &gt; v) {<br>                throw new IllegalArgumentException();<br>            }<br>        }<br>        upper.set(v);<br>    }<br>    <br>    public synchronized void setLower(long v) {<br><br>        synchronized (this.upper) {<br>            if (this.getUpper().get() &lt; v) {<br>                throw new IllegalArgumentException();<br>            }<br>            lower.set(v);<br>        }<br>    }<br>}","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444616,"discussion_content":"synchç”¨çš„å¤ªå¤šäº†ï¼Œæœ€å¤–é¢ä¸€ä¸ªå°±å¤Ÿäº†\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553687503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2330905,"avatar":"https://static001.geekbang.org/account/avatar/00/23/91/19/6a3e7efc.jpg","nickname":"ç¨‹åºå‘˜9527","note":"","ucode":"1A1609F6BEAD84","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380313,"discussion_content":"é”äº†å•æ‰€ï¼Œåˆé”é©¬æ¡¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624434763,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79766,"user_name":"ä¸€é“é˜³å…‰","can_delete":false,"product_type":"c1","uid":1239557,"ip_address":"","ucode":"F35207CCCEC6E2","user_header":"https://static001.geekbang.org/account/avatar/00/12/ea/05/c0d8014d.jpg","comment_is_top":false,"comment_ctime":1553555503,"is_pvip":false,"replies":[{"id":"29314","content":"ğŸ‘<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553695054,"ip_address":"","comment_id":79766,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553555503","product_id":100023901,"comment_content":"ç®€å•ç²—æš´æ–¹æ³•ï¼šåœ¨ä¸¤ä¸ªifè¯­å¥å¤–å±‚åŠ ä¸Šsynchronize(this){...}åŒæ­¥å—ã€‚<br>å…¶ä»–çš„æ–¹æ³•æ²¡æƒ³åˆ°ã€‚<br>","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444613,"discussion_content":"ğŸ‘\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553695054,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79764,"user_name":"é‚‹é¢çš„æµæµªå‰‘å®¢","can_delete":false,"product_type":"c1","uid":1260881,"ip_address":"","ucode":"32AF6F9070506D","user_header":"https://static001.geekbang.org/account/avatar/00/13/3d/51/9723276c.jpg","comment_is_top":false,"comment_ctime":1553552097,"is_pvip":false,"replies":[{"id":"29311","content":"æ„Ÿè§‰ä¸èƒ½ç”¨ç­‰å¾…å”¤é†’æœºåˆ¶","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1553694977,"ip_address":"","comment_id":79764,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553552097","product_id":100023901,"comment_content":"æ€è€ƒé¢˜å¯ä»¥ç”¨ç­‰å¾…å”¤é†’æœºåˆ¶å®ç°","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444612,"discussion_content":"æ„Ÿè§‰ä¸èƒ½ç”¨ç­‰å¾…å”¤é†’æœºåˆ¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553694977,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}