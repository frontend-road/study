{"id":96570,"title":"06 | Python “黑箱”：输入与输出","content":"<p>你好，我是景霄。</p><p>世纪之交的论坛上曾有一句流行语：在互联网上，没人知道你是一条狗。互联网刚刚兴起时，一根网线链接到你家，信息通过这条高速线缆直达你的屏幕，你通过键盘飞速回应朋友的消息，信息再次通过网线飞入错综复杂的虚拟世界，再进入朋友家。抽象来看，一台台的电脑就是一个个黑箱，黑箱有了输入和输出，就拥有了图灵机运作的必要条件。</p><p>Python 程序也是一个黑箱：通过输入流将数据送达，通过输出流将处理后的数据送出，可能 Python 解释器后面藏了一个人，还是一个史莱哲林？No one cares。</p><p>好了废话不多说，今天我们就由浅及深讲讲 Python 的输入和输出。</p><h2>输入输出基础</h2><p>最简单直接的输入来自键盘操作，比如下面这个例子。</p><pre><code>name = input('your name:')\ngender = input('you are a boy?(y/n)')\n\n###### 输入 ######\nyour name:Jack\nyou are a boy?\n\nwelcome_str = 'Welcome to the matrix {prefix} {name}.'\nwelcome_dic = {\n    'prefix': 'Mr.' if gender == 'y' else 'Mrs',\n    'name': name\n}\n\nprint('authorizing...')\nprint(welcome_str.format(**welcome_dic))\n\n########## 输出 ##########\nauthorizing...\nWelcome to the matrix Mr. Jack.\n</code></pre><p>input() 函数暂停程序运行，同时等待键盘输入；直到回车被按下，函数的参数即为提示语，输入的类型永远是字符串型（str）。注意，初学者在这里很容易犯错，下面的例子我会讲到。print() 函数则接受字符串、数字、字典、列表甚至一些自定义类的输出。</p><p>我们再来看下面这个例子。</p><pre><code>a = input()\n1\nb = input()\n2\n\nprint('a + b = {}'.format(a + b))\n########## 输出 ##############\na + b = 12\nprint('type of a is {}, type of b is {}'.format(type(a), type(b)))\n########## 输出 ##############\ntype of a is &lt;class 'str'&gt;, type of b is &lt;class 'str'&gt;\nprint('a + b = {}'.format(int(a) + int(b)))\n########## 输出 ##############\na + b = 3\n</code></pre><p>这里注意，把 str 强制转换为 int 请用 int()，转为浮点数请用 float()。而在生产环境中使用强制转换时，请记得加上 try except（即错误和异常处理，专栏后面文章会讲到）。</p><!-- [[[read_end]]] --><p>Python 对 int 类型没有最大限制（相比之下， C++ 的 int 最大为 2147483647，超过这个数字会产生溢出），但是对 float 类型依然有精度限制。这些特点，除了在一些算法竞赛中要注意，在生产环境中也要时刻提防，避免因为对边界条件判断不清而造成 bug 甚至 0day（危重安全漏洞）。</p><p>我们回望一下币圈。2018年4月23日中午11点30分左右，BEC 代币智能合约被黑客攻击。黑客利用数据溢出的漏洞，攻击与美图合作的公司美链 BEC 的智能合约，成功地向两个地址转出了天量级别的 BEC 代币，导致市场上的海量 BEC 被抛售，该数字货币的价值也几近归零，给 BEC 市场交易带来了毁灭性的打击。</p><p>由此可见，虽然输入输出和类型处理事情简单，但我们一定要慎之又慎。毕竟相当比例的安全漏洞，都来自随意的 I/O 处理。</p><h2>文件输入输出</h2><p>命令行的输入输出，只是 Python 交互的最基本方式，适用一些简单小程序的交互。而生产级别的 Python 代码，大部分 I/O 则来自于文件、网络、其他进程的消息等等。</p><p>接下来，我们来详细分析一个文本文件读写。假设我们有一个文本文件in.txt，内容如下：</p><pre><code>I have a dream that my four little children will one day live in a nation where they will not be judged by the color of their skin but by the content of their character. I have a dream today.\n\nI have a dream that one day down in Alabama, with its vicious racists, . . . one day right there in Alabama little black boys and black girls will be able to join hands with little white boys and white girls as sisters and brothers. I have a dream today.\n\nI have a dream that one day every valley shall be exalted, every hill and mountain shall be made low, the rough places will be made plain, and the crooked places will be made straight, and the glory of the Lord shall be revealed, and all flesh shall see it together.\n\nThis is our hope. . . With this faith we will be able to hew out of the mountain of despair a stone of hope. With this faith we will be able to transform the jangling discords of our nation into a beautiful symphony of brotherhood. With this faith we will be able to work together, to pray together, to struggle together, to go to jail together, to stand up for freedom together, knowing that we will be free one day. . . .\n\nAnd when this happens, and when we allow freedom ring, when we let it ring from every village and every hamlet, from every state and every city, we will be able to speed up that day when all of God's children, black men and white men, Jews and Gentiles, Protestants and Catholics, will be able to join hands and sing in the words of the old Negro spiritual: &quot;Free at last! Free at last! Thank God Almighty, we are free at last!&quot;\n</code></pre><p>好，让我们来做一个简单的 NLP（自然语言处理）任务。如果你对此不太了解也没有影响，我会带你一步步完成这个任务。</p><p>首先，我们要清楚NLP任务的基本步骤，也就是下面的四步：</p><ol>\n<li>\n<p>读取文件；</p>\n</li>\n<li>\n<p>去除所有标点符号和换行符，并把所有大写变成小写；</p>\n</li>\n<li>\n<p>合并相同的词，统计每个词出现的频率，并按照词频从大到小排序；</p>\n</li>\n<li>\n<p>将结果按行输出到文件 out.txt。</p>\n</li>\n</ol><p>你可以自己先思考一下，用Python如何解决这个问题。这里，我也给出了我的代码，并附有详细的注释。我们一起来看下这段代码。</p><pre><code>import re\n\n# 你不用太关心这个函数\ndef parse(text):\n    # 使用正则表达式去除标点符号和换行符\n    text = re.sub(r'[^\\w ]', ' ', text)\n\n    # 转为小写\n    text = text.lower()\n    \n    # 生成所有单词的列表\n    word_list = text.split(' ')\n    \n    # 去除空白单词\n    word_list = filter(None, word_list)\n    \n    # 生成单词和词频的字典\n    word_cnt = {}\n    for word in word_list:\n        if word not in word_cnt:\n            word_cnt[word] = 0\n        word_cnt[word] += 1\n    \n    # 按照词频排序\n    sorted_word_cnt = sorted(word_cnt.items(), key=lambda kv: kv[1], reverse=True)\n    \n    return sorted_word_cnt\n\nwith open('in.txt', 'r') as fin:\n    text = fin.read()\n\nword_and_freq = parse(text)\n\nwith open('out.txt', 'w') as fout:\n    for word, freq in word_and_freq:\n        fout.write('{} {}\\n'.format(word, freq))\n\n########## 输出(省略较长的中间结果) ##########\n\nand 15\nbe 13\nwill 11\nto 11\nthe 10\nof 10\na 8\nwe 8\nday 6\n\n...\n\nold 1\nnegro 1\nspiritual 1\nthank 1\ngod 1\nalmighty 1\nare 1\n</code></pre><p>你不用太关心 parse() 函数的具体实现，你只需要知道，它做的事情是把输入的 text 字符串，转化为我们需要的排序后的词频统计。而 sorted_word_cnt 则是一个二元组的列表（list of tuples）。</p><p>首先我们需要先了解一下，计算机中文件访问的基础知识。事实上，计算机内核（kernel）对文件的处理相对比较复杂，涉及到内核模式、虚拟文件系统、锁和指针等一系列概念，这些内容我不会深入讲解，我只说一些基础但足够使用的知识。</p><p>我们先要用open() 函数拿到文件的指针。其中，第一个参数指定文件位置（相对位置或者绝对位置）；第二个参数，如果是 <code>'r' </code>表示读取，如果是<code>'w'</code> 则表示写入，当然也可以用 <code>'rw'</code> ，表示读写都要。a 则是一个不太常用（但也很有用）的参数，表示追加（append），这样打开的文件，如果需要写入，会从原始文件的最末尾开始写入。</p><p>这里我插一句，在 Facebook 的工作中，代码权限管理非常重要。如果你只需要读取文件，就不要请求写入权限。这样在某种程度上可以降低 bug 对整个系统带来的风险。</p><p>好，回到我们的话题。在拿到指针后，我们可以通过 read() 函数，来读取文件的全部内容。代码 text = fin.read() ，即表示把文件所有内容读取到内存中，并赋值给变量 text。这么做自然也是有利有弊：</p><ul>\n<li>\n<p>优点是方便，接下来我们可以很方便地调用 parse 函数进行分析；</p>\n</li>\n<li>\n<p>缺点是如果文件过大，一次性读取可能造成内存崩溃。</p>\n</li>\n</ul><p>这时，我们可以给 read 指定参数 size ，用来表示读取的最大长度。还可以通过 readline() 函数，每次读取一行，这种做法常用于数据挖掘（Data Mining）中的数据清洗，在写一些小的程序时非常轻便。如果每行之间没有关联，这种做法也可以降低内存的压力。而write() 函数，可以把参数中的字符串输出到文件中，也很容易理解。</p><p>这里我需要简单提一下 with 语句（后文会详细讲到）。open() 函数对应于 close() 函数，也就是说，如果你打开了文件，在完成读取任务后，就应该立刻关掉它。而如果你使用了 with 语句，就不需要显式调用 close()。在 with 的语境下任务执行完毕后，close() 函数会被自动调用，代码也简洁很多。</p><p>最后需要注意的是，所有 I/O 都应该进行错误处理。因为 I/O 操作可能会有各种各样的情况出现，而一个健壮（robust）的程序，需要能应对各种情况的发生，而不应该崩溃（故意设计的情况除外）。</p><h2>JSON 序列化与实战</h2><p>最后，我来讲一个和实际应用很贴近的知识点。</p><p>JSON（JavaScript Object Notation）是一种轻量级的数据交换格式，它的设计意图是把所有事情都用设计的字符串来表示，这样既方便在互联网上传递信息，也方便人进行阅读（相比一些 binary 的协议）。JSON 在当今互联网中应用非常广泛，也是每一个用 Python程序员应当熟练掌握的技能点。</p><p>设想一个情景，你要向交易所购买一定数额的股票。那么，你需要提交股票代码、方向（买入/卖出）、订单类型（市价/限价）、价格（如果是限价单）、数量等一系列参数，而这些数据里，有字符串，有整数，有浮点数，甚至还有布尔型变量，全部混在一起并不方便交易所解包。</p><p>那该怎么办呢？</p><p>其实，我们要讲的JSON ，正能解决这个场景。你可以把它简单地理解为两种黑箱：</p><ul>\n<li>\n<p>第一种，输入这些杂七杂八的信息，比如Python 字典，输出一个字符串；</p>\n</li>\n<li>\n<p>第二种，输入这个字符串，可以输出包含原始信息的 Python 字典。</p>\n</li>\n</ul><p>具体代码如下：</p><pre><code>import json\n\nparams = {\n    'symbol': '123456',\n    'type': 'limit',\n    'price': 123.4,\n    'amount': 23\n}\n\nparams_str = json.dumps(params)\n\nprint('after json serialization')\nprint('type of params_str = {}, params_str = {}'.format(type(params_str), params))\n\noriginal_params = json.loads(params_str)\n\nprint('after json deserialization')\nprint('type of original_params = {}, original_params = {}'.format(type(original_params), original_params))\n\n########## 输出 ##########\n\nafter json serialization\ntype of params_str = &lt;class 'str'&gt;, params_str = {'symbol': '123456', 'type': 'limit', 'price': 123.4, 'amount': 23}\nafter json deserialization\ntype of original_params = &lt;class 'dict'&gt;, original_params = {'symbol': '123456', 'type': 'limit', 'price': 123.4, 'amount': 23}\n</code></pre><p>其中，</p><ul>\n<li>\n<p>json.dumps() 这个函数，接受 Python 的基本数据类型，然后将其序列化为 string；</p>\n</li>\n<li>\n<p>而json.loads() 这个函数，接受一个合法字符串，然后将其反序列化为 Python 的基本数据类型。</p>\n</li>\n</ul><p>是不是很简单呢？</p><p>不过还是那句话，请记得加上错误处理。不然，哪怕只是给 json.loads() 发送了一个非法字符串，而你没有 catch 到，程序就会崩溃了。</p><p>到这一步，你可能会想，如果我要输出字符串到文件，或者从文件中读取JSON字符串，又该怎么办呢？</p><p>是的，你仍然可以使用上面提到的 open() 和 read()/write() ，先将字符串读取/输出到内存，再进行JSON编码/解码，当然这有点麻烦。</p><pre><code>import json\n\nparams = {\n    'symbol': '123456',\n    'type': 'limit',\n    'price': 123.4,\n    'amount': 23\n}\n\nwith open('params.json', 'w') as fout:\n    params_str = json.dump(params, fout)\n\nwith open('params.json', 'r') as fin:\n    original_params = json.load(fin)\n\nprint('after json deserialization')\nprint('type of original_params = {}, original_params = {}'.format(type(original_params), original_params))\n\n########## 输出 ##########\n\nafter json deserialization\ntype of original_params = &lt;class 'dict'&gt;, original_params = {'symbol': '123456', 'type': 'limit', 'price': 123.4, 'amount': 23}\n</code></pre><p>这样，我们就简单清晰地实现了读写 JSON 字符串的过程。当开发一个第三方应用程序时，你可以通过 JSON 将用户的个人配置输出到文件，方便下次程序启动时自动读取。这也是现在普遍运用的成熟做法。</p><p>那么 JSON 是唯一的选择吗？显然不是，它只是轻量级应用中最方便的选择之一。据我所知，在 Google，有类似的工具叫做Protocol Buffer，当然，Google 已经完全开源了这个工具，你可以自己了解一下使用方法。</p><p>相比于  JSON，它的优点是生成优化后的二进制文件，因此性能更好。但与此同时，生成的二进制序列，是不能直接阅读的。它在 TensorFlow 等很多对性能有要求的系统中都有广泛的应用。</p><h2>总结</h2><p>这节课，我们主要学习了 Python 的普通 I/O和文件 I/O，同时了解了 JSON 序列化的基本知识，并通过具体的例子进一步掌握。再次强调一下需要注意的几点：</p><ul>\n<li>\n<p>I/O 操作需谨慎，一定要进行充分的错误处理，并细心编码，防止出现编码漏洞；</p>\n</li>\n<li>\n<p>编码时，对内存占用和磁盘占用要有充分的估计，这样在出错时可以更容易找到原因；</p>\n</li>\n<li>\n<p>JSON序列化是很方便的工具，要结合实战多多练习；</p>\n</li>\n<li>\n<p>代码尽量简洁、清晰，哪怕是初学阶段，也要有一颗当元帅的心。</p>\n</li>\n</ul><h2>思考题</h2><p>最后，我给你留了两道思考题。</p><p>第一问：你能否把NLP例子中的 word count 实现一遍？不过这次，in.txt 可能非常非常大（意味着你不能一次读取到内存中），而 output.txt 不会很大（意味着重复的单词数量很多）。</p><p>提示：你可能需要每次读取一定长度的字符串，进行处理，然后再读取下一次的。但是如果单纯按照长度划分，你可能会把一个单词隔断开，所以需要细心处理这种边界情况。</p><p>第二问：你应该使用过类似百度网盘、Dropbox等网盘，但是它们可能空间有限（比如 5GB）。如果有一天，你计划把家里的 100GB 数据传送到公司，可惜你没带 U 盘，于是你想了一个主意：</p><p>每次从家里向 Dropbox 网盘写入不超过 5GB 的数据，而公司电脑一旦侦测到新数据，就立即拷贝到本地，然后删除网盘上的数据。等家里电脑侦测到本次数据全部传入公司电脑后，再进行下一次写入，直到所有数据都传输过去。</p><p>根据这个想法，你计划在家写一个 server.py，在公司写一个 client.py 来实现这个需求。</p><p>提示：我们假设每个文件都不超过 5GB。</p><ul>\n<li>\n<p>你可以通过写入一个控制文件（config.json）来同步状态。不过，要小心设计状态，这里有可能产生 race condition。</p>\n</li>\n<li>\n<p>你也可以通过直接侦测文件是否产生，或者是否被删除来同步状态，这是最简单的做法。</p>\n</li>\n</ul><p>不要担心难度问题，尽情写下你的思考，最终代码我也会为你准备好。</p><p>欢迎在留言区写下你的答案，也欢迎你把这篇文章转给你的同事、朋友，一起在思考中学习。</p>","comments":[{"had_liked":false,"id":97934,"user_name":"Jingxiao","can_delete":false,"product_type":"c1","uid":1259521,"ip_address":"","ucode":"EB966BB87132F6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJOlibibPFEWOib8ib7RtfAtxND5FUqCxxoeTuLAbBI9ic23xuwdXT4IyiaWq3Fic9RgEAYI0lBTbEp2rcg/132","comment_is_top":true,"comment_ctime":1558844484,"is_pvip":false,"discussion_count":7,"race_medal":0,"score":"9.2233722832268001e+18","product_id":100026901,"comment_content":"思考题第二题：（省略了一些异常处理，后面会讲到）<br>server.py<br># 我们假设 server 电脑上的所有的文件都在 BASR_DIR 中，为了简化不考虑文件夹结构，网盘的路径在 NET_DIR<br><br>import os<br>from shutil import copyfile<br>import time<br><br>BASE_DIR = &#39;server&#47;&#39;<br>NET_DIR = &#39;net&#47;&#39;<br><br>def main():<br>    filenames = os.listdir(BASE_DIR)<br>    for i, filename in enumerate(filenames):<br>        print(&#39;copying {} into net drive...  {}&#47;{}&#39;.format(filename, i + 1, len(filenames)))<br>        copyfile(BASE_DIR + filename, NET_DIR + filename)<br>        print(&#39;copied {} into net drive, waiting client complete...  {}&#47;{}&#39;.format(filename, i + 1, len(filenames)))<br><br>        while os.path.exists(NET_DIR + filename):<br>            time.sleep(3)<br><br>    print(&#39;transferred {} into client.  {}&#47;{}&#39;.format(filename, i + 1, len(filenames)))<br><br>if __name__ == &quot;__main__&quot;:<br>\tmain()<br><br>++++++++++++++++++++++<br>client.py<br># 我们假设 client 电脑上要输出的文件夹在 BASR_DIR ，网盘的路径在 NET_DIR<br><br>import os<br>from shutil import copyfile<br>import time<br><br>BASE_DIR = &#39;client&#47;&#39;<br>NET_DIR = &#39;net&#47;&#39;<br><br>def main():<br>    while True:<br>        filenames = os.listdir(NET_DIR)<br>        for filename in filenames:<br>            print(&#39;downloading {} into local disk...&#39;.format(filename))<br>            copyfile(NET_DIR + filename, BASE_DIR + filename)<br>            os.remove(NET_DIR + filename) # 我们需要删除这个文件，网盘会提我们同步这个操作，从而 server 知晓已完成<br>            print(&#39;downloaded {} into local disk.&#39;.format(filename))<br>        time.sleep(3)<br><br>if __name__ == &quot;__main__&quot;:<br>\tmain()","like_count":58,"discussions":[{"author":{"id":1444483,"avatar":"https://static001.geekbang.org/account/avatar/00/16/0a/83/f916f903.jpg","nickname":"风","note":"","ucode":"E1CE0825AAF805","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344302,"discussion_content":"客户端这边应该加个超时判断，如果网盘路径下，很久都没有出现新文件（说明服务端已经传完了所有文件），就结束程序。要不然client.py将一直运行","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1611399315,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1542450,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/a8PMLmCTCBa40j7JIy3d8LsdbW5hne7lkk9KOGQuiaeVk4cn06KWwlP3ic69BsQLpNFtRTjRdUM2ySDBAv1MOFfA/132","nickname":"Ilovek8s","note":"","ucode":"64DF0F7D0CF0B0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376862,"discussion_content":"牛逼，向大神膜拜。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622385538,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2508673,"avatar":"https://static001.geekbang.org/account/avatar/00/26/47/81/0fdf9885.jpg","nickname":"TSC-SUN","note":"","ucode":"7479A6AD8E2664","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367315,"discussion_content":"老师我想问一下，可能有点简单，为什么要区分sever电脑和clean电脑，有什么不同吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618320156,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1600007,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEI4pmhZGWGlmpLbxrZk2b6JXfzc7aoXvczZf3xpC09nzmDEyGlTGCIw1h6vq3zF9YDG8Lv7raMdKQ/132","nickname":"Geek_871a6a","note":"","ucode":"4D0917BFD6B441","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":270737,"discussion_content":"那么如何会自动传完之后，客户端直接关闭呢，这个时候可以在客户端进行判断，如果服务端的进程挂了，那么这边客户端就直接断开","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590045664,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1339625,"avatar":"https://static001.geekbang.org/account/avatar/00/14/70/e9/26243f4f.jpg","nickname":"王遥","note":"","ucode":"DFAA29C57C4B9D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":42188,"discussion_content":"第二遍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572606948,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1546621,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/8C8icoib08mXvTD57UD5HentzH67xefic45LuicmcYEXxbnWEBfTZzyAlxFIcPdreCV77KqpHvAlTAxzaQUIubVsfA/132","nickname":"Geek_85bcd4","note":"","ucode":"E8777744EF30AC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1918,"discussion_content":"client.py 有两点：  \n     1.为什么需要while+ for 嵌套循环，如果抛出异常，应该用try: except\n     2.os.remove(NET_DIR+filename) : 为什么需要删除这个文件【引用了while的原因么】\n       ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563093663,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1187403,"avatar":"https://static001.geekbang.org/account/avatar/00/12/1e/4b/b324aba3.jpg","nickname":"明少","note":"","ucode":"D11881FC6FB5DF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1546621,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/8C8icoib08mXvTD57UD5HentzH67xefic45LuicmcYEXxbnWEBfTZzyAlxFIcPdreCV77KqpHvAlTAxzaQUIubVsfA/132","nickname":"Geek_85bcd4","note":"","ucode":"E8777744EF30AC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":36508,"discussion_content":"1、while 是为了让接收服务一直运行，for是为了遍历网盘文件；\n2、删除是因为网盘容量小，删了通知上传服务端继续上传新的文件；","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1571386394,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":1918,"ip_address":""},"score":36508,"extra":""}]}]},{"had_liked":false,"id":97925,"user_name":"Jingxiao","can_delete":false,"product_type":"c1","uid":1259521,"ip_address":"","ucode":"EB966BB87132F6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJOlibibPFEWOib8ib7RtfAtxND5FUqCxxoeTuLAbBI9ic23xuwdXT4IyiaWq3Fic9RgEAYI0lBTbEp2rcg/132","comment_is_top":true,"comment_ctime":1558842243,"is_pvip":false,"discussion_count":19,"race_medal":0,"score":"9.2233722316871004e+18","product_id":100026901,"comment_content":"思考题第一题：<br><br>import re<br><br>CHUNK_SIZE = 100 # 这个数表示一次最多读取的字符长度<br><br># 这个函数每次会接收上一次得到的 last_word，然后和这次的 text 合并起来处理。<br># 合并后判断最后一个词有没有可能连续，并分离出来，然后返回。<br># 这里的代码没有 if 语句，但是仍然是正确的，可以想一想为什么。<br>def parse_to_word_list(text, last_word, word_list):<br>    text = re.sub(r&#39;[^\\w ]&#39;, &#39; &#39;, last_word + text)<br>    text = text.lower()<br>    cur_word_list = text.split(&#39; &#39;)<br>    cur_word_list, last_word = cur_word_list[:-1], cur_word_list[-1]<br>    word_list += filter(None, cur_word_list)<br>    return last_word<br><br>def solve():<br>    with open(&#39;in.txt&#39;, &#39;r&#39;) as fin:<br>        word_list, last_word = [], &#39;&#39;<br>        while True:<br>            text = fin.read(CHUNK_SIZE)<br>            if not text: <br>                break # 读取完毕，中断循环<br>            last_word = parse_to_word_list(text, last_word, word_list)<br><br>        word_cnt = {}<br>        for word in word_list:<br>            if word not in word_cnt:<br>                word_cnt[word] = 0<br>            word_cnt[word] += 1<br><br>        sorted_word_cnt = sorted(word_cnt.items(), key=lambda kv: kv[1], reverse=True)<br>        return sorted_word_cnt<br><br>print(solve())","like_count":46,"discussions":[{"author":{"id":1338704,"avatar":"https://static001.geekbang.org/account/avatar/00/14/6d/50/c2b759a1.jpg","nickname":"AI午间狂睡Steve","note":"","ucode":"6CB9572A861C09","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1321,"discussion_content":"老师您好，关于您的代码，我有个小问题：\n这道题的目的是如果输入的text太大我们mei y办法一次性读到内存中我们应该如何处理。\n您的解法解决了分次读取数据的问题，但是每一次读取之后都会把本次读取的word写入word list中。\n那么这个word list就会不断扩大，因为我们没有去重。\n最后的结果就是word list变得很大，占用很多内存。\n我的问题时：这个超大的word list会导致内存溢出吗？如果会的话，我们上述的操作岂不是没有什么意义。","likes_number":8,"is_delete":false,"is_hidden":false,"ctime":1562563174,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1528650,"avatar":"https://static001.geekbang.org/account/avatar/00/17/53/4a/125225c1.jpg","nickname":"KT.","note":"","ucode":"7E5498EFB53BCF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1338704,"avatar":"https://static001.geekbang.org/account/avatar/00/14/6d/50/c2b759a1.jpg","nickname":"AI午间狂睡Steve","note":"","ucode":"6CB9572A861C09","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2546,"discussion_content":"我也想知道答案。。。这个超大的word list会导致内存溢出吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563767248,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":1321,"ip_address":""},"score":2546,"extra":""},{"author":{"id":1526831,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4c/2f/85a8d26e.jpg","nickname":"055","note":"","ucode":"210A944276395F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1338704,"avatar":"https://static001.geekbang.org/account/avatar/00/14/6d/50/c2b759a1.jpg","nickname":"AI午间狂睡Steve","note":"","ucode":"6CB9572A861C09","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5716,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566444655,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":1321,"ip_address":""},"score":5716,"extra":""},{"author":{"id":1814182,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/ae/a6/6e24b9f2.jpg","nickname":"Calvin","note":"","ucode":"AFCDCF99556A49","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1338704,"avatar":"https://static001.geekbang.org/account/avatar/00/14/6d/50/c2b759a1.jpg","nickname":"AI午间狂睡Steve","note":"","ucode":"6CB9572A861C09","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":150327,"discussion_content":"我觉得搞成一个dict来存储会更好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579792420,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":1321,"ip_address":""},"score":150327,"extra":""}]},{"author":{"id":1307689,"avatar":"","nickname":"Z_ying","note":"","ucode":"B4FDE000A012B5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1022,"discussion_content":"全文最后一个单词是不是没有进入word_list? 如果最后一个单词后面没有标点符号的话","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1562242246,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1157364,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a8/f4/2abb4a4c.jpg","nickname":"MirkoWei","note":"","ucode":"901C436D359CD3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1307689,"avatar":"","nickname":"Z_ying","note":"","ucode":"B4FDE000A012B5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":52260,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574026688,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":1022,"ip_address":""},"score":52260,"extra":""},{"author":{"id":2056178,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/5f/f2/121afc48.jpg","nickname":"MarkZoldyck","note":"","ucode":"4CA2132C996512","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1307689,"avatar":"","nickname":"Z_ying","note":"","ucode":"B4FDE000A012B5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":289266,"discussion_content":"没有标点最后一个word应该没统计到，所以while循环结束我认为还是应该对last_word进行处理一下","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1594042823,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":1022,"ip_address":""},"score":289266,"extra":""}]},{"author":{"id":2369413,"avatar":"https://static001.geekbang.org/account/avatar/00/24/27/85/ddeeaf30.jpg","nickname":"dived","note":"","ucode":"141916A3BAF5A1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373729,"discussion_content":"#稍微改了下 parse里面多放直接处理word_dict, 不要word_list了\nimport re\nCHUNK_SIZE = 100\ndef parse(text, word_dict, last_word):\n    text = re.sub(r&#39;[^\\w]&#39;, &#39; &#39;, last_word + text)\n    text = text.lower()\n    last_word =  text.split(&#39; &#39;)[-1]\n    for word in filter(None, text.split(&#39; &#39;)[:-1]):\n        word_dict[word] = word_dict.get(word, 0) + 1\n    return last_word\n\nwith open(&#39;in.txt&#39;, &#39;r&#39;) as fin:\n    word_set = set()\n    last_word = &#39;&#39;\n    word_dict = {}\n    while True:\n        text = fin.read(CHUNK_SIZE)\n        if not text:\n            break\n        last_word = parse(text, word_dict, last_word)\n    chunk_list = sorted(word_dict.items(), key=lambda x:x[1], reverse=1)\n#     print(chunk_list==sorted_dict)\n\nwith open(&#34;ou2.txt&#34;, mode=&#34;w&#34;) as fo:\n    for k, v in chunk_list:\n        fo.write(f&#34;{k} {v}\\n&#34;)\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1620839482,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1412429,"avatar":"https://static001.geekbang.org/account/avatar/00/15/8d/4d/992070e8.jpg","nickname":"憨皮苏","note":"","ucode":"D0B4B7660DA766","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362071,"discussion_content":"# 合并后判断最后一个词有没有可能连续，并分离出来，然后返回。\n# 这里的代码没有 if 语句，但是仍然是正确的，可以想一想为什么。\n\n答：无论最后一个词有没有连续，都不是放到这次来计算的，而是放到下一次，又因为放到了下一次，和下一次读取的数据合并在一起作为一个整体，因此上一次最后一个词在下一次读取时一定是完整的，不完整的仍旧是最后一个词，考虑边界情况，最后一行，仍旧满足。因此不用去判断最后一个词是否连续","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1616841882,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1754973,"avatar":"","nickname":"jtchgis","note":"","ucode":"BACBA9AB8F3162","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":205245,"discussion_content":"word_cnt[word] = 0   这里我怎么觉得应该初始=1呢？有学友能解释一下吗？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584281951,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1934586,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/84/fa/842f75f6.jpg","nickname":"。","note":"","ucode":"0048B2F95BFD4B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1754973,"avatar":"","nickname":"jtchgis","note":"","ucode":"BACBA9AB8F3162","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":215226,"discussion_content":"下一步就会加1","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585303573,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":205245,"ip_address":""},"score":215226,"extra":""},{"author":{"id":1123435,"avatar":"https://static001.geekbang.org/account/avatar/00/11/24/6b/2e52759d.jpg","nickname":"Gene","note":"","ucode":"C1DA1ECFB5445F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1754973,"avatar":"","nickname":"jtchgis","note":"","ucode":"BACBA9AB8F3162","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":315354,"discussion_content":"= 0 负责对应键值的初始化，不然下一步没法 += 1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603266002,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":205245,"ip_address":""},"score":315354,"extra":""},{"author":{"id":1710643,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/vwv0qiaibQzcTP6yIDJXOJLdh64CnBSaOceFFuWArVHQcwicIsebwYbKJ69OSJrxeXJyawtNIINcjo3V3hgg5BW1A/132","nickname":"MuBo","note":"","ucode":"46402B9B7D7B1E","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":1754973,"avatar":"","nickname":"jtchgis","note":"","ucode":"BACBA9AB8F3162","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":327783,"discussion_content":"下一步+1是第一次也会做的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605947467,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":205245,"ip_address":""},"score":327783,"extra":""}]},{"author":{"id":2642341,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epd5nINR78huW7KQbGS6C9iaFZT5CkibhDJib9IXpBicplI6p5BNrBwInMPkCL7JqABeK1t0TMuMFziahA/132","nickname":"Geek_04affd","note":"","ucode":"0D86B0B2587000","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571994,"discussion_content":"文中统计词频存在一个小问题，对于行末单词未拼写完成存在&#39;-&#39;的情况，比如hell- \no world，会将其分割为[&#39;hell&#39;, &#39;o&#39;, &#39;world&#39;]","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652527967,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1811813,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a5/65/898bc6c5.jpg","nickname":"wayne","note":"","ucode":"988E1F2F0B419A","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369987,"discussion_content":"这样还是会一次把所有内容加载到内存数组，最好是一次读取一行，然后处理一行","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619239535,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1548394,"avatar":"","nickname":"Geek_102886","note":"","ucode":"D6D595BF83A8D0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":219505,"discussion_content":"简单来说，就是对于最后一个单词留到下次去处理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585756680,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1298279,"avatar":"https://static001.geekbang.org/account/avatar/00/13/cf/67/057e5d93.jpg","nickname":"flying","note":"","ucode":"69AB7872B36B23","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1514,"discussion_content":"如果读取的100个字符中，最后一个是空格，这样的话，该程序是有问题的。\n可以将word_dict作为一个参数出入parse函数中，每次读取的单词都及时统计出结果，只是不知道性能会不会受到影响","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562672190,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1157364,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a8/f4/2abb4a4c.jpg","nickname":"MirkoWei","note":"","ucode":"901C436D359CD3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1298279,"avatar":"https://static001.geekbang.org/account/avatar/00/13/cf/67/057e5d93.jpg","nickname":"flying","note":"","ucode":"69AB7872B36B23","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":52259,"discussion_content":"text.split(&#39; &#39;)当text以&#39; &#39;结尾，得到的cur_word_list[-1]是&#39;&#39;，而如果以非&#39; &#39;结尾，得到的是单词，所以不会判断错的","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1574026458,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":1514,"ip_address":""},"score":52259,"extra":""}]},{"author":{"id":1545251,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM7adYZoHGic7ZS6cp9OmBjh1C4ajCCpciblR3ib3jDtiaKrFdbT9J7sl2B9eNoCQicfx5QWgVVZQB74pfQ/132","nickname":"Luove","note":"","ucode":"73CD4D2C731B47","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":797,"discussion_content":"景老师好，通过size来分块读取时，想到两种情况：\n1，如“he is ...good man,&#34; &#34;...&#34;  or  “he is ...good man&#34; &#34;, ...&#34;\n2，如&#34;he is ...good peop&#34; &#34;le, ...&#34;\nQ：\n1、会不会还有其他情况？\n2、中英文会有差别吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562062513,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96718,"user_name":"不瘦到140不改名","can_delete":false,"product_type":"c1","uid":1528298,"ip_address":"","ucode":"31DA063A17FC27","user_header":"https://static001.geekbang.org/account/avatar/00/17/51/ea/2ce84d5a.jpg","comment_is_top":false,"comment_ctime":1558492583,"is_pvip":false,"replies":[{"id":"34623","content":"👍","user_name":"作者回复","user_name_real":"高山流水","uid":"1513504","ctime":1558507731,"ip_address":"","comment_id":96718,"utype":1}],"discussion_count":14,"race_medal":0,"score":"263551497639","product_id":100026901,"comment_content":"from collections import defaultdict<br>import re<br><br>f = open(&quot;ini.txt&quot;, mode=&quot;r&quot;, encoding=&quot;utf-8&quot;)<br>d = defaultdict(int)<br><br>for line in f:<br>    for word in filter(lambda x: x, re.split(r&quot;\\s&quot;, line)):<br>        d[word] += 1<br><br><br>print(d)","like_count":62,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"高山流水","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450983,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558507731,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1921415,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epJD0SEy6FrzXhmAoyj5jRvs2PCcUVS6MCQAfkKpTpRxB5FsibxSdPe7cRrlertzC9HNU74sOAnBbw/132","nickname":"朱学锋","note":"","ucode":"C466309D43E478","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":210959,"discussion_content":"没看到题设中in.txt非常大的问题怎么解决的","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1584795314,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2131165,"avatar":"https://static001.geekbang.org/account/avatar/00/20/84/dd/a9265141.jpg","nickname":"diu你头发掉屏幕上了","note":"","ucode":"69E2D5EAD8B50C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371196,"discussion_content":"大文件里所有数据只在第一行的话，不就挂了吗。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1619682905,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1999745,"avatar":"","nickname":"1006510","note":"","ucode":"0068FD2DD5DEC6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":269380,"discussion_content":"这个文件是不是忘关了\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1589899190,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1156329,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a4/e9/3b65c171.jpg","nickname":"超人","note":"","ucode":"119ED76F577FC7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":30965,"discussion_content":"代码很简洁，学习了。正则表达式需要先替换非单词（标点符号）然后再split","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1570874006,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1039464,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/dc/68/006ba72c.jpg","nickname":"Untitled","note":"","ucode":"8DD6ABA3E81A2E","race_medal":2,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334702,"discussion_content":"这里没有过滤掉符号吧？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607945004,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1921415,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epJD0SEy6FrzXhmAoyj5jRvs2PCcUVS6MCQAfkKpTpRxB5FsibxSdPe7cRrlertzC9HNU74sOAnBbw/132","nickname":"朱学锋","note":"","ucode":"C466309D43E478","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":210960,"discussion_content":"比如整个文件有且仅有一行，这样写一下就崩溃了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584795383,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1012697,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/73/d9/da9349fd.jpg","nickname":"yang","note":"","ucode":"C1E91D5F9ABD42","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1655,"discussion_content":"中文也是这样搞吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562770019,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1545251,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM7adYZoHGic7ZS6cp9OmBjh1C4ajCCpciblR3ib3jDtiaKrFdbT9J7sl2B9eNoCQicfx5QWgVVZQB74pfQ/132","nickname":"Luove","note":"","ucode":"73CD4D2C731B47","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":821,"discussion_content":"同问，lambda x:x 在这里的作用及为何与None等价？请求解惑一下，谢谢~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562079271,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1606707,"avatar":"https://static001.geekbang.org/account/avatar/00/18/84/33/b3666d78.jpg","nickname":"吴优秀同学","note":"","ucode":"E3BAAC604E9972","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1545251,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM7adYZoHGic7ZS6cp9OmBjh1C4ajCCpciblR3ib3jDtiaKrFdbT9J7sl2B9eNoCQicfx5QWgVVZQB74pfQ/132","nickname":"Luove","note":"","ucode":"73CD4D2C731B47","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":194252,"discussion_content":"在python中所有非空值都是True，每一个字符串除了其本身外还有另一个身份那就是布尔值，这里匿名函数将原值进行返回，就是利用字符串来代替布尔值进行判断。","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1583201887,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":821,"ip_address":""},"score":194252,"extra":""}]},{"author":{"id":1581705,"avatar":"https://static001.geekbang.org/account/avatar/00/18/22/89/73397ccb.jpg","nickname":"响雨","note":"","ucode":"C5FB3A3BC68F92","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":167,"discussion_content":"lambda x: x 为什么在这里替代None呢？不懂。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561211930,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1012697,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/73/d9/da9349fd.jpg","nickname":"yang","note":"","ucode":"C1E91D5F9ABD42","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1581705,"avatar":"https://static001.geekbang.org/account/avatar/00/18/22/89/73397ccb.jpg","nickname":"响雨","note":"","ucode":"C5FB3A3BC68F92","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1658,"discussion_content":"filter函数接收两个参数，第一个为函数，第二个为序列，序列的每个元素作为参数传递给函数进行判，然后返回 True 或 False，最后将返回 True 的元素放到新列表中。None是false吗？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1562772020,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":167,"ip_address":""},"score":1658,"extra":""},{"author":{"id":2086265,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/d5/79/e1801426.jpg","nickname":"Bee","note":"","ucode":"3774D0CA746DA9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1012697,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/73/d9/da9349fd.jpg","nickname":"yang","note":"","ucode":"C1E91D5F9ABD42","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295129,"discussion_content":"是的，如果给的None，则会自动过滤掉返回False的值","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596097414,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":1658,"ip_address":""},"score":295129,"extra":""},{"author":{"id":2116746,"avatar":"","nickname":"Geek_0b6620","note":"","ucode":"367685E08CE1C4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1012697,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/73/d9/da9349fd.jpg","nickname":"yang","note":"","ucode":"C1E91D5F9ABD42","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":298501,"discussion_content":"(lambda x:x)(0) >>> 0; (lambda x:x)(None) >>> 没有返回值。。。难搞啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597312531,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":1658,"ip_address":""},"score":298501,"extra":""}]}]},{"had_liked":false,"id":96676,"user_name":"逆光飞翔","can_delete":false,"product_type":"c1","uid":1283178,"ip_address":"","ucode":"6CA088D343A373","user_header":"https://static001.geekbang.org/account/avatar/00/13/94/6a/fed08431.jpg","comment_is_top":false,"comment_ctime":1558487201,"is_pvip":false,"replies":[{"id":"34621","content":"filter(None, Iterable) 是一种容易出错的用法，这里不止过滤空字符串，还能过滤 0，None，空列表等值。这里的 None，严格意义上等于 lambda x: x, 是一个 callable。","user_name":"作者回复","user_name_real":"高山流水","uid":"1513504","ctime":1558507654,"ip_address":"","comment_id":96676,"utype":1}],"discussion_count":3,"race_medal":0,"score":"130407506081","product_id":100026901,"comment_content":"老师，为什么filter（none，list）可以过滤空值，不是保留空值嘛","like_count":30,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"高山流水","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450965,"discussion_content":"filter(None, Iterable) 是一种容易出错的用法，这里不止过滤空字符串，还能过滤 0，None，空列表等值。这里的 None，严格意义上等于 lambda x: x, 是一个 callable。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558507654,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1526831,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4c/2f/85a8d26e.jpg","nickname":"055","note":"","ucode":"210A944276395F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5585,"discussion_content":"https://stackoverflow.com/questions/38339496/python-filternone-list-of-bools-behavior","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1566363423,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1452570,"avatar":"","nickname":"frank_","note":"","ucode":"658DBBC9BE337F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":33404,"discussion_content":" lambda x: x, 是一个 callable  这是什么意思呢？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1571120872,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96812,"user_name":"Geek_59f23e","can_delete":false,"product_type":"c1","uid":1513783,"ip_address":"","ucode":"A463C6EB7447FD","user_header":"https://static001.geekbang.org/account/avatar/00/17/19/37/e0a9bf99.jpg","comment_is_top":false,"comment_ctime":1558513291,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"61688055435","product_id":100026901,"comment_content":"第一题：<br>1、使用defaultdict初始化计数器更方便更快，不用再多做一步in判断，parse函数只需返回filter对象。<br><br>2、读取大文件时使用for循环遍历迭代器，不占用内存空间，生成一行处理一行，就此例来说每一行行尾都是\\n没有跨行单词，故此方法不用考虑边界问题，因文件中有多行\\n，读取时做一步判断跳过避免再调用parse函数。<br><br>word_cnt = defaultdict(lambda: 0)<br><br>with open(&#39;in_big.txt&#39;, &#39;r&#39;) as fin:<br>    for line in fin:<br>        if line != &#39;\\n&#39;:<br>            for word in parse(line):<br>                word_cnt[word] += 1<br><br>第二题：<br>说说思路，具体应该需要搭建web实现吧。<br><br>1、server设置上传目录存放20个5G文件，开启while True进程检测网盘有无数据，数据为空时POST目录中5G文件，上传完毕后本地删除或者将其移出上传目录，直到上传目录为空时结束程序。<br><br>2、client开启while True进程检测网盘有无数据，数据不为空时GET下载5G文件，下载完成后DELETE请求删除网盘数据。","like_count":14},{"had_liked":false,"id":96693,"user_name":"lmingzhi","can_delete":false,"product_type":"c1","uid":1014489,"ip_address":"","ucode":"72DBAF4FD184AF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7a/d9/4feb4006.jpg","comment_is_top":false,"comment_ctime":1558488889,"is_pvip":false,"replies":[{"id":"34622","content":"👍","user_name":"作者回复","user_name_real":"高山流水","uid":"1513504","ctime":1558507676,"ip_address":"","comment_id":96693,"utype":1}],"discussion_count":2,"race_medal":0,"score":"48803129145","product_id":100026901,"comment_content":"# 第一题， 修改parse函数，使其可以更新word_cnt<br>import re<br>def parse(text, word_cnt):<br>    # 转为小写<br>    text = text.lower()    <br>    # 生成所有单词的列表<br>    word_list = re.findall(r&#39;\\w+&#39;, text) <br>    # 更新单词和词频的字典<br>    for word in word_list:<br>        word_cnt[word] = word_cnt.get(word,0) + 1<br>    return word_cnt<br><br># 初始化字典<br>word_cnt = dict()<br>with open(&#39;in.txt&#39;, &#39;r&#39;) as fin:<br>    for text in fin.readlines():<br>        word_cnt = parse(text, word_cnt)<br>        print(len(word_cnt))<br><br># 按照词频排序<br>sorted_word_cnt = sorted(word_cnt.items(), key=lambda kv: kv[1], reverse=True)<br><br># 导出<br>with open(&#39;out.txt&#39;, &#39;w&#39;) as fout:<br>    for word, freq in word_and_freq:<br>        fout.write(&#39;{} {}\\n&#39;.format(word, freq))","like_count":12,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"高山流水","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450973,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558507676,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2185264,"avatar":"","nickname":"Geek_14bbf0","note":"","ucode":"7B976390B50C3F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306566,"discussion_content":"导出应该是在排好序的list中遍历，你笔误了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1600319586,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96624,"user_name":"許敲敲","can_delete":false,"product_type":"c1","uid":1046681,"ip_address":"","ucode":"6486466820E7BF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/99/8e760987.jpg","comment_is_top":false,"comment_ctime":1558481472,"is_pvip":false,"replies":[{"id":"34614","content":"谢谢，加油！","user_name":"作者回复","user_name_real":"高山流水","uid":"1513504","ctime":1558506531,"ip_address":"","comment_id":96624,"utype":1}],"discussion_count":1,"race_medal":0,"score":"44508154432","product_id":100026901,"comment_content":"这门课太值了 哈哈哈 我以前学到的真的toy python","like_count":11,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"高山流水","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450940,"discussion_content":"谢谢，加油！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558506531,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96664,"user_name":"Python高效编程","can_delete":false,"product_type":"c1","uid":1325271,"ip_address":"","ucode":"B12B5F43B4335E","user_header":"https://static001.geekbang.org/account/avatar/00/14/38/d7/de6832df.jpg","comment_is_top":false,"comment_ctime":1558485970,"is_pvip":false,"replies":[{"id":"34618","content":"想到 Counter 很棒，但是这样注意这样不行哦，Counter 初始化输入 str 会把 str 视作一个容器，最后 Counter 里存的全是单个字符和它的次数，而不是单词。","user_name":"作者回复","user_name_real":"高山流水","uid":"1513504","ctime":1558506951,"ip_address":"","comment_id":96664,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35918224338","product_id":100026901,"comment_content":"第一问:<br>with open(&quot;in.txt&quot;, &quot;rt&quot;) as f:<br>    for line in f:<br>        Counter.update(line)","like_count":8,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"高山流水","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450960,"discussion_content":"想到 Counter 很棒，但是这样注意这样不行哦，Counter 初始化输入 str 会把 str 视作一个容器，最后 Counter 里存的全是单个字符和它的次数，而不是单词。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558506951,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":97248,"user_name":"code2","can_delete":false,"product_type":"c1","uid":1281792,"ip_address":"","ucode":"BBA5748FB6A01C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/8OPzdpDraQMvCNWAicicDt54sDaIYJZicBLfMyibXVs4V0ZibEdkZlbzxxL7aGpRoeyvibag5LaAaaGKSdwYQMY2hUrQ/132","comment_is_top":false,"comment_ctime":1558619800,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"31623390872","product_id":100026901,"comment_content":"看到一片短文，摘录如下：<br>数据科学家是“比软件工程师更擅长统计学，比统计学家更擅长软件工程的人”。许多数据科学家都具有统计学背景，但是在软件工程方面的经验甚少。我是一名资深数据科学家，在Stackoverflow的python编程方面排名前1%，并与许多（初级）数据科学家共事。以下是我经常看到的10大常见错误，本文将为你相关解决方案：<br><br>删去前九个只余一个：<br><br>使用jupyter notebook<br><br>","like_count":7,"discussions":[{"author":{"id":1281792,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/8OPzdpDraQMvCNWAicicDt54sDaIYJZicBLfMyibXVs4V0ZibEdkZlbzxxL7aGpRoeyvibag5LaAaaGKSdwYQMY2hUrQ/132","nickname":"code2","note":"","ucode":"BBA5748FB6A01C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350055,"discussion_content":"不推荐","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613694000,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1710643,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/vwv0qiaibQzcTP6yIDJXOJLdh64CnBSaOceFFuWArVHQcwicIsebwYbKJ69OSJrxeXJyawtNIINcjo3V3hgg5BW1A/132","nickname":"MuBo","note":"","ucode":"46402B9B7D7B1E","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":327023,"discussion_content":"嘛意思，是推荐使用jupyter？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605714967,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108299,"user_name":"种种","can_delete":false,"product_type":"c1","uid":1543959,"ip_address":"","ucode":"91A70789319318","user_header":"https://static001.geekbang.org/account/avatar/00/17/8f/17/bae853bb.jpg","comment_is_top":false,"comment_ctime":1561715192,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27331518968","product_id":100026901,"comment_content":"不管最后一个单词断不断都可以放到下次一起，总不会错。整个单词，放到下次没毛病，中断的单词放到下次，理应如此。","like_count":6},{"had_liked":false,"id":116499,"user_name":"王豪","can_delete":false,"product_type":"c1","uid":1545937,"ip_address":"","ucode":"EB94C142FB3AA2","user_header":"https://wx.qlogo.cn/mmopen/vi_32/c4taseHGbqaUUpulL8ACjbA1dGxqBiargeRjN43m7MJ2ImIvHvavBs11CePkSQdBVPiavqCmzT12kZHf9Kd48eTQ/132","comment_is_top":false,"comment_ctime":1563858701,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23038695181","product_id":100026901,"comment_content":"老师，这样统计词频效率应该会高一些吧<br>word_cnt={}<br>for word in word_list:<br>    word_cnt[word] = word_cnt.get(word, 0) + 1","like_count":6},{"had_liked":false,"id":97030,"user_name":"宝仔","can_delete":false,"product_type":"c1","uid":1013493,"ip_address":"","ucode":"A0F17DFF99DB21","user_header":"https://static001.geekbang.org/account/avatar/00/0f/76/f5/e3f5bd8d.jpg","comment_is_top":false,"comment_ctime":1558574187,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"23033410667","product_id":100026901,"comment_content":"word_cnt = dict()！老师你之前不是说过：word_cnt = ｛｝这样初始化字典不是效率更高吗？为什么你代码里用了函数初始化字典","like_count":5,"discussions":[{"author":{"id":1449159,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/c7/890e4c58.jpg","nickname":"孙佳路","note":"","ucode":"E5C7DEFB85EDD4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":345881,"discussion_content":"我的理解是用 { } 生成的dict, 需要判断key是否存在, 然后选择在原基础上++, 或者直接设置为1.\n用了 defaultdict 可以省去这一步, 对遇到的每一个单词, 放进用defaultdict生成的词典里直接 += 1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611807220,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96843,"user_name":"Lone","can_delete":false,"product_type":"c1","uid":1543230,"ip_address":"","ucode":"7EDE7F9407F1BF","user_header":"https://static001.geekbang.org/account/avatar/00/17/8c/3e/b4ae5ae2.jpg","comment_is_top":false,"comment_ctime":1558518353,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23033354833","product_id":100026901,"comment_content":"第一题打卡<br>import re<br><br>def parse(text, word_cnt):<br>    text = text.lower()<br>    # print(&quot;--------------------{}&quot;.format(text))<br>    word_list = re.findall(r&quot;\\w+&quot;, text)<br>    # print(word_list)<br>    for word in word_list:<br>        word_cnt[word] = word_cnt.get(word, 0) + 1<br><br>    return word_cnt<br><br>word_cnt = dict()<br><br># 读取文件<br>with open(&quot;.&#47;in.txt&quot;, &quot;r&quot;) as fin:<br>    for line in fin:<br>        word_cnt = parse(line, word_cnt)<br><br># print(word_cnt)<br><br>word_and_freq = sorted(word_cnt.items(), key=lambda kv: kv[1], reverse=True)<br><br># print(word_and_freq)<br>with open(&quot;.&#47;out.txt&quot;, &quot;w&quot;) as fout:<br>    for word, freq in word_and_freq:<br>        fout.write(&quot;{} {}\\n&quot;.format(word, freq))<br>","like_count":5},{"had_liked":false,"id":97227,"user_name":"........","can_delete":false,"product_type":"c1","uid":1236198,"ip_address":"","ucode":"D54E7F428E7F49","user_header":"https://static001.geekbang.org/account/avatar/00/12/dc/e6/ea4b2c10.jpg","comment_is_top":false,"comment_ctime":1558615534,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18738484718","product_id":100026901,"comment_content":"from collections import defaultdict<br>import re <br><br>d = defaultdict(int)<br><br>with open(&#39;in.txt&#39;, &#39;r&#39;) as fin:<br>    text = fin.readline()<br>    while text:<br>        text = re.sub(r&#39;[^\\w ]&#39;, &#39;&#39;, text)<br>        text = text.lower()<br>        word_list = text.split(&#39; &#39;)<br>    <br>        word_list = filter(None, word_list)<br>        for word in word_list:   <br>            d[word] += 1<br>        text = fin.readline()<br>    <br>    # 按照词频排序<br>    sorted_word_cnt = sorted(d.items(), key=lambda kv: kv[1], reverse=True)<br>    <br><br><br><br>","like_count":4},{"had_liked":false,"id":96662,"user_name":"人间乐园","can_delete":false,"product_type":"c1","uid":1350559,"ip_address":"","ucode":"4A203AB47FCF3C","user_header":"https://static001.geekbang.org/account/avatar/00/14/9b/9f/2cbc2a4f.jpg","comment_is_top":false,"comment_ctime":1558485880,"is_pvip":true,"replies":[{"id":"34617","content":"很棒的思路，但是注意如果原始文件只有一行呢？你想说的是读取一定长度的字符串吧","user_name":"作者回复","user_name_real":"高山流水","uid":"1513504","ctime":1558506716,"ip_address":"","comment_id":96662,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18738355064","product_id":100026901,"comment_content":"第一道，for.line in fin读取单行，使用result = yied line进行双向传递，直接把line给计数器，先判断line结尾处，如果是单词或者半个单词，则返回result给生成器，拼接到下一个line前，如果是None则不拼接，继续生成这个line。","like_count":4,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"高山流水","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450958,"discussion_content":"很棒的思路，但是注意如果原始文件只有一行呢？你想说的是读取一定长度的字符串吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558506716,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96605,"user_name":"IT蜗壳-Tango","can_delete":false,"product_type":"c1","uid":1000612,"ip_address":"","ucode":"92330844C1EF9C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/44/a4/7a45d979.jpg","comment_is_top":false,"comment_ctime":1558457960,"is_pvip":true,"replies":[{"id":"34613","content":"👍","user_name":"作者回复","user_name_real":"高山流水","uid":"1513504","ctime":1558506491,"ip_address":"","comment_id":96605,"utype":1}],"discussion_count":1,"race_medal":1,"score":"18738327144","product_id":100026901,"comment_content":"第七天打卡。","like_count":4,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"高山流水","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450931,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558506491,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104495,"user_name":"-Deeplikesea-","can_delete":false,"product_type":"c1","uid":1546184,"ip_address":"","ucode":"1B42C4EF1CD598","user_header":"https://static001.geekbang.org/account/avatar/00/17/97/c8/7b34d2fa.jpg","comment_is_top":false,"comment_ctime":1560764841,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14445666729","product_id":100026901,"comment_content":"老师，我还没有看到github的代码呢？想学习一下您怎么写的。","like_count":3,"discussions":[{"author":{"id":2922136,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/96/98/89b96cda.jpg","nickname":"三年二班邱小东","note":"","ucode":"909B49C63C8EC6","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557080,"discussion_content":"找到了吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647654649,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96751,"user_name":"mykgzy","can_delete":false,"product_type":"c1","uid":1543823,"ip_address":"","ucode":"4E47A0546987FA","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKCNH9kd9GibX3vibX9osjtWBvP5ibe8iciacMREk4bcDEgfrDQ9EKs8bQlHoVVhW9CXO8WHM5Ag26S9cA/132","comment_is_top":false,"comment_ctime":1558497402,"is_pvip":false,"replies":[{"id":"34630","content":"这也是这门课的核心价值之一，愿能有所收获","user_name":"作者回复","user_name_real":"高山流水","uid":"1513504","ctime":1558507944,"ip_address":"","comment_id":96751,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14443399290","product_id":100026901,"comment_content":"看着有点费力，但感觉超值，看到了好多python 书都没提到的生产网中涉及的知识。","like_count":3,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"高山流水","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451004,"discussion_content":"这也是这门课的核心价值之一，愿能有所收获","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558507944,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":235830,"user_name":"云蝈蝈","can_delete":false,"product_type":"c1","uid":1219179,"ip_address":"","ucode":"19B1597DB49819","user_header":"https://static001.geekbang.org/account/avatar/00/12/9a/6b/e8ef2989.jpg","comment_is_top":false,"comment_ctime":1595215369,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10185149961","product_id":100026901,"comment_content":"学到很多，楼主的问题设计的也很精妙，用的是“你计划把家里的 100GB 数据传送到公司”，而不是“你计划把公司的 100GB 数据传送到家里”","like_count":2},{"had_liked":false,"id":185093,"user_name":"向南","can_delete":false,"product_type":"c1","uid":1325700,"ip_address":"","ucode":"E6072AD7CA6798","user_header":"https://static001.geekbang.org/account/avatar/00/14/3a/84/70340e87.jpg","comment_is_top":false,"comment_ctime":1583480542,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10173415134","product_id":100026901,"comment_content":"```python<br>from collections import defaultdict<br>import re<br><br>f = open(&quot;in.txt&quot;, mode=&quot;r&quot;, encoding=&quot;utf-8&quot;)<br>d = defaultdict(int)<br><br>for line in f:<br>    for word in filter(lambda x: x, re.split(r&quot;\\s&quot;, re.sub(r&#39;[^\\w ]&#39;, &#39; &#39;, line))):<br>        d[word] += 1<br><br>a = sorted(d.items(), key=lambda x: x[1], reverse=True)<br>print(a)<br>```","like_count":2},{"had_liked":false,"id":177838,"user_name":"edward0079","can_delete":false,"product_type":"c1","uid":1544656,"ip_address":"","ucode":"72F89DCD6A0A2D","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epc3c8hB9Lg0I1NibzH6h9qjur8XvG9Tto0NRp1Q0udCgmS7C7vUb4z5bnXMqy91GB76iaYP0icPiaqgg/132","comment_is_top":false,"comment_ctime":1581513068,"is_pvip":false,"replies":[{"id":"69473","content":"说的很赞，很详细","user_name":"作者回复","comment_id":177838,"uid":"1259521","ip_address":"","utype":1,"ctime":1581883622,"user_name_real":"Jingxiao"}],"discussion_count":1,"race_medal":0,"score":"10171447660","product_id":100026901,"comment_content":"判断是否为None的情况<br><br>if not x<br><br>if x is None<br><br>if not x is None<br><br> <br><br>if x is not None`是最好的写法，清晰，不会出现错误，以后坚持使用这种写法。<br><br>使用if not x这种写法的前提是：必须清楚x等于None,  False, 空字符串&quot;&quot;, 0, 空列表[], 空字典{}, 空元组()时对你的判断没有影响才行","like_count":2,"discussions":[{"author":{"id":1259521,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJOlibibPFEWOib8ib7RtfAtxND5FUqCxxoeTuLAbBI9ic23xuwdXT4IyiaWq3Fic9RgEAYI0lBTbEp2rcg/132","nickname":"Jingxiao","note":"","ucode":"EB966BB87132F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483565,"discussion_content":"说的很赞，很详细","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581883622,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":150733,"user_name":"Paul Shan","can_delete":false,"product_type":"c1","uid":1593140,"ip_address":"","ucode":"32D99989028284","user_header":"","comment_is_top":false,"comment_ctime":1573605724,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10163540316","product_id":100026901,"comment_content":"IO 是离开CPU和内存系统的操作，如果不考虑大小和错误处理，出错几乎是必然的。<br>思考题1<br>按照行开读取，读取一行或者若干行，然后写入文件，这次需要append操作，在已经写入的文件下再追加内容。<br>思考题2<br>用Server端的时间来同步内容，家里的电脑不断的往服务端写入，如果满了就等待，每写入一定数量，例如1G，就加一条分隔符文件。办公室的电脑就不断的从服务端读取，先读取到分隔符文件，然后把时间早于分隔符文件的文件都读取，然后删除所有读过的文件包括分隔符文件。","like_count":2},{"had_liked":false,"id":130374,"user_name":"孙有能希","can_delete":false,"product_type":"c1","uid":1057071,"ip_address":"","ucode":"3FE607B46018F4","user_header":"https://static001.geekbang.org/account/avatar/00/10/21/2f/85a3c897.jpg","comment_is_top":false,"comment_ctime":1567436475,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"10157371067","product_id":100026901,"comment_content":"re.sub(r&#39;[^\\w ]&#39;, &#39; &#39;, text) 是怎么替换掉标点符号和换行的？查了半天也没理解。","like_count":2,"discussions":[{"author":{"id":1527672,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4f/78/1fe13460.jpg","nickname":"力维","note":"","ucode":"BF4E04AEE52AC6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":51080,"discussion_content":"    # 正则解析：\n    # r&#39;...&#39;： 正则命令字符串\n    # [^x]： x取反\n    # \\w ： 字母、数字、下划线、汉字\n    # r&#39;[^\\w]&#39;： 所有不是字母、数字、下划线、汉字的字符\n    # re.sub(r&#39;...&#39;,&#39; &#39;,text) : 将第一参数替换成第二参数","likes_number":11,"is_delete":false,"is_hidden":false,"ctime":1573808528,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1222119,"avatar":"https://static001.geekbang.org/account/avatar/00/12/a5/e7/815acbf7.jpg","nickname":"warm_day","note":"","ucode":"3CD078E809497C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":80032,"discussion_content":"这个正则不错https://tool.oschina.net/uploads/apidocs/jquery/regexp.html","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576139241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1250380,"avatar":"https://static001.geekbang.org/account/avatar/00/13/14/4c/c824b5fe.jpg","nickname":"Roll","note":"","ucode":"A2F2ADA7C9CAB3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":20788,"discussion_content":"查了下^是取反","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569375630,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":97156,"user_name":"乔克","can_delete":false,"product_type":"c1","uid":1315273,"ip_address":"","ucode":"28A797A4235B78","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/c9/c3eae895.jpg","comment_is_top":false,"comment_ctime":1558598732,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10148533324","product_id":100026901,"comment_content":"<br>第一题：<br>from collections import defaultdict<br>import re<br><br>dic = defaultdict(int)<br><br>with open(&quot;in.txt&quot;, &#39;r&#39;) as f:<br>    for line in f:<br>        line = re.sub(r&#39;[^\\w]&#39;, &#39; &#39;, line)<br>        for word in re.split(r&#39;[\\s\\n]+&#39;, line):<br>            word = word.lower()<br>            if word:<br>                dic[word] += 1<br>dic = sorted(dic.items())<br>print(dic)<br><br>第二题：类似于socket编程<br>1、记录服务器上文件的MD5值。然后服务器上传5G文件到中继服务器，然后将光标点记录下来，当服务端上传完后将MD5值，光标位置，当前上传的文件长度传给客户端；<br>2、客户端收到服务器的信息并记录下来，从中继服务器下载文件写入本地，下载完后对比文件长度，一切OK就删除中继服务器上的文件，并告诉服务器可以继续传了。这样循环，直到完成。","like_count":2},{"had_liked":false,"id":96822,"user_name":"zxq","can_delete":false,"product_type":"c1","uid":1542076,"ip_address":"","ucode":"E5AA95922DC791","user_header":"https://static001.geekbang.org/account/avatar/00/17/87/bc/eda72771.jpg","comment_is_top":false,"comment_ctime":1558515900,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10148450492","product_id":100026901,"comment_content":"老师，想请问一下python关于线程管理机制，举个例子来说：我有两个程序read.py和write.py，一个是负责读取info.txt内容，而另一个是将数据写入这个txt。由于我不知道两个python程序会不会同时被调用，假设调用write.py写入数据时，尚未释放txt的端口，这时候read.py被调用来读取数据，这时候就有冲突了。python如何处理这样的机制呢？如何优化这两个py文件，可不可以通过调用端口占用状态来解决呢？","like_count":2,"discussions":[{"author":{"id":1636363,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/bGrI3qhTPVgWVxSAibUu2XsFaNr3TFO08NhKcnVzW6kQPKh9kd8s6von8AORxDjRXvJXB1yibafb4nsPOzD5NWXQ/132","nickname":"yonguo_dev","note":"","ucode":"49E27086BF9437","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5989,"discussion_content":"手动加锁","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1566568838,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96633,"user_name":"vivien_zh","can_delete":false,"product_type":"c1","uid":1137491,"ip_address":"","ucode":"3C029219C90C14","user_header":"https://static001.geekbang.org/account/avatar/00/11/5b/53/200fda62.jpg","comment_is_top":false,"comment_ctime":1558482575,"is_pvip":false,"replies":[{"id":"34616","content":"多实践，多编码，多思考，一定没问题的","user_name":"作者回复","comment_id":96633,"uid":"1513504","ip_address":"","utype":1,"ctime":1558506562,"user_name_real":"高山流水"}],"discussion_count":1,"race_medal":0,"score":"10148417167","product_id":100026901,"comment_content":"努力跟上老师的进度。","like_count":2,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"高山流水","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450943,"discussion_content":"多实践，多编码，多思考，一定没问题的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558506562,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":211549,"user_name":"Steve","can_delete":false,"product_type":"c1","uid":1072131,"ip_address":"","ucode":"9C4E9E62A79C3A","user_header":"https://static001.geekbang.org/account/avatar/00/10/5c/03/370ebbc8.jpg","comment_is_top":false,"comment_ctime":1587981354,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5882948650","product_id":100026901,"comment_content":"第一题：只是稍微改了一下代码，把一次全部读入换成每次读一行，将word_cnt拿到parse函数外面，最后再一起sorting。但这是不是破坏了封装？<br>import re<br><br>def parse(text, word_cnt):<br>    text = re.sub(r&#39;[^\\w ]&#39;, &#39; &#39;, text)<br><br>    text = text.lower()<br><br>    word_list = text.split(&#39; &#39;)<br><br>    word_list = filter(None, word_list)<br><br>    for word in word_list:<br>        if word not in word_cnt:<br>            word_cnt[word] = 0<br>        word_cnt[word] += 1<br>       <br>    return<br><br>word_cnt = {}<br><br>with open(&#39;in.txt&#39;, &#39;r&#39;) as fin:<br>    for line in fin:<br>        parse(line, word_cnt)<br><br>sorted_word_cnt = sorted(word_cnt.items(), key=lambda kv: kv[1], reverse=True)<br><br>with open(&#39;out.txt&#39;, &#39;w&#39;) as fout:<br>    for word, freq in sorted_word_cnt:<br>        fout.write(&#39;{} {}\\n&#39;.format(word, freq))","like_count":1,"discussions":[{"author":{"id":1995257,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/71/f9/85329b42.jpg","nickname":"做一个可靠的UDP","note":"","ucode":"2428ED20AD3398","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":263003,"discussion_content":"和我的思路完全相同嘻嘻","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589161873,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":201830,"user_name":"🌻","can_delete":false,"product_type":"c1","uid":1509651,"ip_address":"","ucode":"9B4D8CA8C09A70","user_header":"https://static001.geekbang.org/account/avatar/00/17/09/13/d762ce74.jpg","comment_is_top":false,"comment_ctime":1585842174,"is_pvip":false,"replies":[{"id":"75932","content":"👍","user_name":"作者回复","comment_id":201830,"uid":"1513504","ip_address":"","utype":1,"ctime":1586150317,"user_name_real":"高山流水"}],"discussion_count":1,"race_medal":0,"score":"5880809470","product_id":100026901,"comment_content":"第一问：<br><br>import re<br>from collections import defaultdict<br>from pathlib import Path<br><br><br>def parse(text, count):<br>    words = re.split(r&#39;\\W&#39;, text.lower())<br><br>    for word in words:<br>        count[word] += 1<br>    return count<br><br>count = defaultdict(int)<br>with open(&#39;in.txt&#39;, &#39;r&#39;) as f:<br>    for line in f.readlines():<br>        count = parse(line, count)<br>        <br># 排序<br>count.pop(&#39;&#39;)<br>sort_by_value = sorted(count.items(), key=lambda x: x[1] * -1)<br><br><br>Path(&#39;out.txt&#39;).touch()<br><br>with open(&#39;out.txt&#39;, &#39;w&#39;) as f:<br>    for word, count in sort_by_value:<br>        f.writelines(&#39;{}: {}\\n&#39;.format(word, count))","like_count":1,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"高山流水","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490431,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586150317,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142755,"user_name":"yangyangyang","can_delete":false,"product_type":"c1","uid":1165027,"ip_address":"","ucode":"A8392F00F2F1FA","user_header":"https://static001.geekbang.org/account/avatar/00/11/c6/e3/21d5f2e3.jpg","comment_is_top":false,"comment_ctime":1571493326,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5866460622","product_id":100026901,"comment_content":"好难呀","like_count":1},{"had_liked":false,"id":104517,"user_name":"WANG","can_delete":false,"product_type":"c1","uid":1014839,"ip_address":"","ucode":"40795CDD7734F8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7c/37/a747c9f2.jpg","comment_is_top":false,"comment_ctime":1560771043,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5855738339","product_id":100026901,"comment_content":"# 第一问<br><br>import re<br>from collections import Counter<br><br><br>def parse_file(file):<br>    with open(file, &#39;r&#39;, encoding=&#39;utf8&#39;) as f:<br>        result = f.read()<br>        text = re.sub(r&#39;[^\\w ]&#39;, &#39;&#39;, result).lower().split() <br>        return text<br><br><br>def count_word(word):<br>    text = dict(Counter(word))<br>    count_word = dict(sorted(text.items(), key=lambda x: x[1], reverse=True))<br>    with open(&#39;out.txt&#39;, &#39;w&#39;, encoding=&#39;utf8&#39;) as f:<br>        for k,v in count_word.items():<br>            f.write(&#39;{}  {}\\n&#39;.format(k,v))<br><br><br>word = parse_file(&#39;in&#39;)<br><br>count_word(word)","like_count":1},{"had_liked":false,"id":101869,"user_name":"建强","can_delete":false,"product_type":"c1","uid":1397126,"ip_address":"","ucode":"62B03D0E0C64EC","user_header":"https://static001.geekbang.org/account/avatar/00/15/51/86/b5fd8dd8.jpg","comment_is_top":false,"comment_ctime":1560005403,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5854972699","product_id":100026901,"comment_content":"由于本人刚学Python，这是第一次正式写Python程序，经验与能力都不足，还请老师多指正，受篇幅限制，两个思考题的源程序我分为两次提交<br>思考题1，源程序如下，:<br>import re<br><br># 词频统计<br>#=====================函数parse定义================<br>def parse(text,word_cnt):<br>    <br>    # 使用正则表达式去除标点符号和换行符<br>    text = re.sub(r&#39;[^\\w ]&#39;, &#39; &#39;, text)<br><br>    #is_breakword用于判断最后一个单词是否折断，如果最后一个单词是完整的，则最后一个字符必是空格<br>    is_breakword = (text[-1] != &#39; &#39;)<br><br>    # 转为小写<br>    text = text.lower()<br>    <br>    # 生成所有单词的列表<br>    word_list = text.split(&#39; &#39;)<br><br>    # 去除空白单词<br>    word_list = list(filter(None, word_list))<br><br>    #如果最后一个单词折断，则在列表中去掉断头单词，合并到下次读入的文本中<br>    if is_breakword:<br>        global breakword<br>        breakword = word_list[-1]<br>        del word_list[-1]<br><br>    # 生成单词和词频的字典<br>    for word in word_list:<br>        word_cnt.setdefault(word,0)<br>        word_cnt[word] += 1<br><br>    return <br> <br>#=====================函数parse结束================<br><br>#breakword为全局变量，保存每次读入文本过程中被折断的单词，在下次读入文本时需要拼上该折断的单词<br>breakword = &#39;&#39;<br>word_cnt = {}<br><br>with open(&#39;F:\\\\temp\\\\in.txt&#39;, &#39;r&#39;) as fin:<br>    while(True):<br><br>        #每次读入100个字符到内存中，由于找不到大文件，为测试方便先暂时设为100，可根据实际情况调整读入的字符数<br>        text = fin.read(100)<br>        if not text:<br>            break<br>        <br>        #拼接上一次处理时的断头单词<br>        text = breakword + text<br><br>        #对读入的文本进行词频统计<br>        parse(text,word_cnt)<br><br># 所有文本统计完后，按照词频排序<br>word_and_freq = sorted(word_cnt.items(), key=lambda kv: kv[1], reverse=True)<br><br>with open(&#39;F:\\\\temp\\\\out.txt&#39;, &#39;w&#39;) as fout:<br>    for word, freq in word_and_freq:<br>        fout.write(&#39;{} {}\\n&#39;.format(word, freq))<br><br>print(&#39;统计完成！&#39;)","like_count":1},{"had_liked":false,"id":98044,"user_name":"Fergus","can_delete":false,"product_type":"c1","uid":1277066,"ip_address":"","ucode":"3A8AC741C49CEB","user_header":"https://static001.geekbang.org/account/avatar/00/13/7c/8a/bdeb76ac.jpg","comment_is_top":false,"comment_ctime":1558881964,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5853849260","product_id":100026901,"comment_content":"<br>#Ask 1<br># NLP 自然语言处理<br># 1.假设文件足够大，不能一次性读入内存<br># 2.注意边界处理，如果单纯按数量读取，可能会将单词拆断<br># 3.如不需要修改文件，读取时仅设置&#39;r&#39;即可<br>#<br>import os<br>import re<br><br>def nlp(content):<br>    # 去标点、换行符<br>    te = re.sub(&#39;[^\\w]&#39;, &quot; &quot;, content)<br>    # 小写<br>    te = te.lower()<br>    # 分词<br>    te = te.split(&#39; &#39;)<br>    # 去空白单词<br>    te = filter(None, te)<br>    # 词频统计<br>    for i in te:<br>        if i in dic.keys():<br>            dic[i] += 1<br>        else:<br>            dic[i] = 1<br><br>dic = {}<br>path = r&#39;c:&#47;users&#47;chen.huaiyu&#47;desktop&#39;<br>os.chdir(path)<br><br>with open(&#39;nlp.txt&#39;, &#39;r&#39;) as fin:<br>    #cc = f.read()<br>    cc1 = &#39;&#39;<br>    seek = fin.tell()<br>    num = 100<br>    count = []<br>    while True:<br>        content = fin.read(num)<br>        if content == &#39;&#39;:<br>            break<br>        elif content[-1] != &#39; &#39;:<br>            count.append(len(content))<br>            if len(count) &gt; 1:<br>                if count[-1] == count[-2]:<br>                    print(&#39;Y&#39;)<br>                    nlp(content)<br>                    seek = fin.tell()<br>                    cc1 += content<br>                    print(fin.tell())<br>                    break<br>            num += 1<br>            fin.seek(seek)<br>            continue<br>        else:<br>            print(&#39;Y&#39;)<br>            nlp(content)<br>            print(len(content))<br>            seek = fin.tell()<br>            print(seek)<br>            print(fin.tell())<br>            cc1 += content<br>                    <br>dic = sorted(dic.items(), key=lambda v: v[1], reverse=True)<br>with open(&#39;output.txt&#39;, &#39;w&#39;) as fout:<br>    for word, freq in dic:<br>        fout.write(&#39;{} {}\\n&#39;.format(word, freq))","like_count":1},{"had_liked":false,"id":97095,"user_name":"GentleCP","can_delete":false,"product_type":"c1","uid":1525440,"ip_address":"","ucode":"BB1EE3720D44F0","user_header":"https://static001.geekbang.org/account/avatar/00/17/46/c0/01292b08.jpg","comment_is_top":false,"comment_ctime":1558586655,"is_pvip":false,"replies":[{"id":"34717","content":"周末左右会给出答案，这几天你们可以思考一下哦","user_name":"作者回复","comment_id":97095,"uid":"1259521","ip_address":"","utype":1,"ctime":1558597674,"user_name_real":"Jingxiao"}],"discussion_count":1,"race_medal":0,"score":"5853553951","product_id":100026901,"comment_content":"老师github链接还没放出吗","like_count":1,"discussions":[{"author":{"id":1259521,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJOlibibPFEWOib8ib7RtfAtxND5FUqCxxoeTuLAbBI9ic23xuwdXT4IyiaWq3Fic9RgEAYI0lBTbEp2rcg/132","nickname":"Jingxiao","note":"","ucode":"EB966BB87132F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451137,"discussion_content":"周末左右会给出答案，这几天你们可以思考一下哦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558597674,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":97074,"user_name":"John Si","can_delete":false,"product_type":"c1","uid":1526611,"ip_address":"","ucode":"705B90724A4BD4","user_header":"https://static001.geekbang.org/account/avatar/00/17/4b/53/67c08006.jpg","comment_is_top":false,"comment_ctime":1558581055,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5853548351","product_id":100026901,"comment_content":"一個十年前讀CS畢業的人，因害怕失敗而放棄編程，沒有從事編程相關工作。現在後悔不已，所以報讀了老師的課程，在聽了老師幾堂課後發現編程原來沒自己想像哪麼難，失敗也不是甚麼大問題。但要跟上進度,還是有點吃力，但我會努力學習並追上各同學的程度。老師提出的思考題其實我並沒有想法，可能是我水平太低了，請問老師能否提點一下呢？謝謝！","like_count":1},{"had_liked":false,"id":96927,"user_name":"Geek_Stone","can_delete":false,"product_type":"c1","uid":1524025,"ip_address":"","ucode":"90B8A27A157217","user_header":"","comment_is_top":false,"comment_ctime":1558537013,"is_pvip":false,"replies":[{"id":"34773","content":"加油！","user_name":"作者回复","comment_id":96927,"uid":"1513504","ip_address":"","utype":1,"ctime":1558631343,"user_name_real":"高山流水"}],"discussion_count":1,"race_medal":0,"score":"5853504309","product_id":100026901,"comment_content":"差不多10年了，还是个初学者。希望尽快摆脱初学者状态。","like_count":1,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"高山流水","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451070,"discussion_content":"加油！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558631343,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96814,"user_name":"倾","can_delete":false,"product_type":"c1","uid":1524099,"ip_address":"","ucode":"ADE03757A4AAE2","user_header":"https://static001.geekbang.org/account/avatar/00/17/41/83/a6263932.jpg","comment_is_top":false,"comment_ctime":1558513667,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5853480963","product_id":100026901,"comment_content":"之前用python写过项目代码，不过是半路出家，更多的是去网上找自己用到的东西，现在又在用go写项目代码，不过python值得好好学习，不过只能在空闲的时候好好琢磨一下了。","like_count":1},{"had_liked":false,"id":96794,"user_name":"xtvjxk123456","can_delete":false,"product_type":"c1","uid":1542142,"ip_address":"","ucode":"2C89AC9E08C50A","user_header":"https://static001.geekbang.org/account/avatar/00/17/87/fe/f1755a1e.jpg","comment_is_top":false,"comment_ctime":1558508551,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5853475847","product_id":100026901,"comment_content":"涨了许多姿势","like_count":1},{"had_liked":false,"id":96765,"user_name":"夜路破晓","can_delete":false,"product_type":"c1","uid":1353577,"ip_address":"","ucode":"9B875F94B759B9","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/3hZfficKPGCq2kjFBu9SgaMjibJTEl7iaW1ta6pZNyiaWP8XEsNpunlnsiaOtBpWTXfT5BvRP3qNByml6p9rtBvqewg/132","comment_is_top":false,"comment_ctime":1558501450,"is_pvip":false,"replies":[{"id":"34631","content":"更精彩的在后面哦","user_name":"作者回复","comment_id":96765,"uid":"1513504","ip_address":"","utype":1,"ctime":1558507959,"user_name_real":"高山流水"}],"discussion_count":1,"race_medal":0,"score":"5853468746","product_id":100026901,"comment_content":"这节有点意思了，渐入佳境，值得细读。","like_count":1,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"高山流水","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451009,"discussion_content":"更精彩的在后面哦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558507959,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96731,"user_name":"GentleCP","can_delete":false,"product_type":"c1","uid":1525440,"ip_address":"","ucode":"BB1EE3720D44F0","user_header":"https://static001.geekbang.org/account/avatar/00/17/46/c0/01292b08.jpg","comment_is_top":false,"comment_ctime":1558494094,"is_pvip":false,"replies":[{"id":"34625","content":"稍后会放出哦","user_name":"作者回复","comment_id":96731,"uid":"1513504","ip_address":"","utype":1,"ctime":1558507778,"user_name_real":"高山流水"}],"discussion_count":1,"race_medal":0,"score":"5853461390","product_id":100026901,"comment_content":"老师，github的链接是多少呀","like_count":1,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"高山流水","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450992,"discussion_content":"稍后会放出哦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558507778,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96672,"user_name":"enjoylearning","can_delete":false,"product_type":"c1","uid":1000237,"ip_address":"","ucode":"DCAF8538DEA277","user_header":"https://static001.geekbang.org/account/avatar/00/0f/43/2d/af86d73f.jpg","comment_is_top":false,"comment_ctime":1558486848,"is_pvip":false,"replies":[{"id":"34619","content":"这里深入展开讲是一小节的内容了，大概知道 ** dict 可以将 python dict 转化成函数的参数就行了；一个比较通用的用法是定义允许传递不定个数参数的函数。","user_name":"作者回复","comment_id":96672,"uid":"1513504","ip_address":"","utype":1,"ctime":1558507179,"user_name_real":"高山流水"}],"discussion_count":1,"race_medal":0,"score":"5853454144","product_id":100026901,"comment_content":"为什么字典 **dict_varname 就能平铺解析，是formate的作用吗","like_count":1,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"高山流水","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450964,"discussion_content":"这里深入展开讲是一小节的内容了，大概知道 ** dict 可以将 python dict 转化成函数的参数就行了；一个比较通用的用法是定义允许传递不定个数参数的函数。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558507179,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":344103,"user_name":"sophy_sun","can_delete":false,"product_type":"c1","uid":1511610,"ip_address":"","ucode":"CA4F4721AF3475","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKCp4BHmbXfTOA0EIB9OLpvgxhWWFELy90uDqoVjdydMnueA5mtUiasPM7VB33K98icbkZfvKQo0Dfw/132","comment_is_top":false,"comment_ctime":1651240930,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1651240930","product_id":100026901,"comment_content":"老师你好，文中 sorted_word_cnt 变量为什么说是一个二元组列表呢？ 不应该是字典类型的数据吗？两者有什么区别吗？","like_count":0},{"had_liked":false,"id":323623,"user_name":"Geek_f1435c","can_delete":false,"product_type":"c1","uid":2843850,"ip_address":"","ucode":"1CF8DECC59B3BA","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/UNC7eWZWvRyAPWUpIJicgZCHkia5KFZbBQVzhGsiatC9tx5wtMSscFAPATjHIYGGZ7DxjNxZVFxkkkicwQLWVTDribw/132","comment_is_top":false,"comment_ctime":1638027418,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638027418","product_id":100026901,"comment_content":"答案解析我都看的一知半解，还是看不懂正则表达式。先留着吧，过段时间再来看吧","like_count":0},{"had_liked":false,"id":318601,"user_name":"【粉粉】","can_delete":false,"product_type":"c1","uid":1168848,"ip_address":"","ucode":"3E0F16527A8D1A","user_header":"https://static001.geekbang.org/account/avatar/00/11/d5/d0/413898d2.jpg","comment_is_top":false,"comment_ctime":1635344382,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635344382","product_id":100026901,"comment_content":"程序有的比较难理解，没有解释","like_count":0},{"had_liked":false,"id":294802,"user_name":"钢板侠","can_delete":false,"product_type":"c1","uid":1942359,"ip_address":"","ucode":"CFE2ED04BD138E","user_header":"https://static001.geekbang.org/account/avatar/00/1d/a3/57/fc1b58b9.jpg","comment_is_top":false,"comment_ctime":1622096261,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622096261","product_id":100026901,"comment_content":"第一个问题思考：读取的时候可以考虑读取每一行的内容，如果每一行的内容过大的话可以在循环上设置一个判断，如果超过设定长度时，可按照设定长度往前推指针位置到空格前，这样就能保证子字符串和子字符串之间保持完整了，剩下的就是做wordcount<br>第二个问题思考：假如有100g的数据文件在一个文件夹中，那么可以遍历整个文件夹，Server端记录每个文件，以文件名为索引，当读取完后，read[文件名]计为1，而如果遇到相同的文件名则跳过，client端则按照同步状态来读取读取完后状态变化写入成功，而Server端通过同步状态判断是否要清空网盘记录，也是通过计数的方式确定文件有没有写入，这样就能把所有文件都读进去","like_count":0},{"had_liked":false,"id":293006,"user_name":"diu你头发掉屏幕上了","can_delete":false,"product_type":"c1","uid":2131165,"ip_address":"","ucode":"69E2D5EAD8B50C","user_header":"https://static001.geekbang.org/account/avatar/00/20/84/dd/a9265141.jpg","comment_is_top":false,"comment_ctime":1621152666,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621152666","product_id":100026901,"comment_content":"思考题第一题：<br>import re<br>from collections import defaultdict<br><br>### 读取文件单词统计<br>def readlines(f, sep = &#39; &#39;, size = 4096, *args, **kwargs):<br>    &#39;&#39;&#39;<br>    读取大文件的方法<br>    :param f:文件句柄<br>    :param sep: 每一行的分隔符<br>    :return<br>    &#39;&#39;&#39;<br>    buf = &#39;&#39;<br>    while True:<br>        while sep in buf:<br>            position = buf.index(sep)   # 分隔符的位置<br>            yield buf[:position]        # 切片，从开始到分隔符位置<br>            buf = buf[position + len(sep):] # 再切片，将yield的数据切掉<br>        <br>        chunk = f.read(size)<br>        if &#39;parse&#39; in kwargs:<br>            chunk = kwargs[&#39;parse&#39;](chunk)   # 清洗<br>        if not chunk:<br>            yield buf # 返回buf中的数字<br>            break<br>        buf += chunk  # 如果read有数据的话<br><br># 单词清洗<br>def parse(text):<br>    &#39;&#39;&#39;<br>    清洗字符串<br>    1. 去除标点符号<br>    2. 转化为全小写<br>    &#39;&#39;&#39;<br>    # 使用正则去掉标点符号<br>    text = re.sub(&#39;\\W&#39;, &#39; &#39;, text)<br>    # 转为小写<br>    text = text.lower()<br>    # 生成所有单词的列表<br>    word_list = text.split()<br>    return &#39; &#39;.join(filter(None, word_list))<br><br># 单词统计<br>def count(file_path, size = 4096, encoding = None):<br>    &#39;&#39;&#39;<br>    读取文本文件，统计单词个数<br>    :param file_path: 文件路径<br>    :param size: 每次读取字符大小<br>    :param encoding: 编码格式, 可选项<br>    :return 单词统计降序列表<br>    &#39;&#39;&#39;<br>    dic = defaultdict(int)<br>    with open(file_path, encoding=encoding) as f:<br>        for word in readlines(f, &#39; &#39;, size, parse = parse):<br>            dic[word] += 1<br>    # 排序<br>    sorted_word_cnt = sorted(dic.items(), key = lambda x:x[1], reverse = True)<br>    return sorted_word_cnt<br><br>sorted_word_cnt = count(&#39;data&#47;ch06&#47;text.txt&#39;)<br>sorted_word_cnt","like_count":0},{"had_liked":false,"id":289871,"user_name":"wayne","can_delete":false,"product_type":"c1","uid":1811813,"ip_address":"","ucode":"988E1F2F0B419A","user_header":"https://static001.geekbang.org/account/avatar/00/1b/a5/65/898bc6c5.jpg","comment_is_top":false,"comment_ctime":1619240160,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1619240160","product_id":100026901,"comment_content":"第一次题：<br>类似于大数据的wordcount：<br>1. 关键是不要一次性将所有数据加载到内存数组<br><br>import re<br><br>def to_list(text):<br>    # 使用正则表达式去除标点符号和换行符<br>    text = re.sub(r&#39;[^\\w ]&#39;, &#39; &#39;, text)<br><br>    # 转为小写<br>    text = text.lower()<br>    <br>    # 生成所有单词的列表<br>    word_list = text.split(&#39; &#39;)<br>    <br>    # 去除空白单词<br>    word_list = filter(None, word_list)<br>    return word_list<br>\t<br>def to_dict(word_list):<br>\tfor i in word_list:<br>\t\tif i not in word_dict:<br>\t\t\tword_dict[&#39;i&#39;] = 1<br>\t\tword_dict[&#39;i&#39;] += 1<br><br>if ___name__ = &quot;__main__&quot;:<br>\twith open(&#39;in.txt&#39;, &#39;r&#39;) as fin:<br>\t\twhile(fin != none):<br>    \t\ttext = fin.readline()<br><br>\t    \tmap = to_list(text)<br>\t    \tword_dict = {}<br>\t    \treduce = to_dict(map_list)<br>\t\t\tsorted_list = sorted(word_dict.items(), key=lambda kv: kv[1], reverse=True)<br>\t\t\twith open(&#39;out.txt&#39;, &#39;w&#39;) as fout:<br>    \t\t\tfor word, freq in reduce_dict:<br>        \t\tfout.write(&#39;{} {}\\n&#39;.format(word, freq))","like_count":0},{"had_liked":false,"id":289367,"user_name":"Geek_3643ae","can_delete":false,"product_type":"c1","uid":2465294,"ip_address":"","ucode":"F0ED2511968B14","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKDwAOObIplPqmNsmYGxQgmP6W2WKZuiapLzEXchPicCiaTnia9ScjicjEvI4BMd5qqnR3rZFRLA3uBElw/132","comment_is_top":false,"comment_ctime":1618989891,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618989891","product_id":100026901,"comment_content":"统计词频的代码里，word_list = filter(None, word_list)这行，filter返回的是一个迭代器，不是想要的word_list列表，需要在filter外层加list() 强制转化为List","like_count":0},{"had_liked":false,"id":285482,"user_name":"憨皮苏","can_delete":false,"product_type":"c1","uid":1412429,"ip_address":"","ucode":"D0B4B7660DA766","user_header":"https://static001.geekbang.org/account/avatar/00/15/8d/4d/992070e8.jpg","comment_is_top":false,"comment_ctime":1616835792,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616835792","product_id":100026901,"comment_content":"#coding:utf-8<br><br><br>import re<br><br># 全局变量<br>word_cnt = {}<br><br># 你不用太关心这个函数<br>def parse(text):<br>    # 使用正则表达式去除标点符号和换行符<br>    text = re.sub(r&#39;[^\\w ]&#39;, &#39; &#39;, text)<br><br>    # 转为小写<br>    text = text.lower()<br><br>    # 生成所有单词的列表<br>    word_list = text.split(&#39; &#39;)<br><br>    # 去除空白单词<br>    word_list = filter(None, word_list)<br><br>    # 生成单词和词频的字典<br>    for word in word_list:<br>        if word not in word_cnt:<br>            word_cnt[word] = 0<br>        word_cnt[word] += 1<br><br><br>def get_sorted_word_cnt(word_cnt):<br>    # 按照词频排序<br>    sorted_word_cnt = sorted(word_cnt.items(), key=lambda kv: kv[1], reverse=True)<br>    return sorted_word_cnt<br><br><br>with open(&#39;in.txt&#39;, &#39;r&#39;) as fin:<br>    while True:<br>        line = fin.readline()<br>        if line:<br>            parse(line)<br>        else:<br>            break<br><br>word_and_freq = get_sorted_word_cnt(word_cnt)<br><br>with open(&#39;out.txt&#39;, &#39;w&#39;) as fout:<br>    for word, freq in word_and_freq:<br>        fout.write(&#39;{} {}\\n&#39;.format(word, freq))<br>","like_count":0},{"had_liked":false,"id":279940,"user_name":"冬雪初霁晴","can_delete":false,"product_type":"c1","uid":2162560,"ip_address":"","ucode":"EA79316E942ABE","user_header":"https://static001.geekbang.org/account/avatar/00/20/ff/80/227451d0.jpg","comment_is_top":false,"comment_ctime":1614008662,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614008662","product_id":100026901,"comment_content":"想请教一下&#39;Mr.&#39; if gender == &#39;y&#39; else &#39;Mrs&#39;这个语句,<br>这个是不是类似与有些语言中的三元表达式 bool ? statementA: statementB这样子的表达式?<br>想问一下它在python中的术语是什么?(因为翻文档没有找到)","like_count":0},{"had_liked":false,"id":269848,"user_name":"非同凡想","can_delete":false,"product_type":"c1","uid":1934969,"ip_address":"","ucode":"713FD449A49D5A","user_header":"https://static001.geekbang.org/account/avatar/00/1d/86/79/066a062a.jpg","comment_is_top":false,"comment_ctime":1608808964,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608808964","product_id":100026901,"comment_content":"##第一题<br><br>def parse1(text):<br>    text = re.sub(r&#39;[^\\w ]&#39;, &quot; &quot;, text)<br>    text = text.lower()<br>    word_list = text.split(&quot; &quot;)<br>    return  word_list<br>word_cnt = {}<br>with open(&#39;06_in.txt&#39;, &#39;r&#39;) as f:<br>    tail=[]<br>    while True:<br>        text = f.read(8)<br>        #读完了<br>        if not text:<br>            break;<br>        word_list = parse1(text)<br>        length = len(word_list)<br>        for i in range(0, length):<br>            if i == length - 1: #如果是最后一个元素，放到下一次循环处理<br>                tail = [word_list[length - 1]]<br>                continue;<br>            if i == 0 and tail: #如果是第一个元素，插入上一次循环留下的尾巴<br>                word = tail[0]<br>                tail = []<br>            else : word=&quot;&quot;<br>            word += word_list[i]<br><br>            if word != &#39;&#39;:<br>                word_cnt[word] = word_cnt.get(word, 0) + 1<br><br>    #处理最后一次循环留下的尾巴<br>    if tail and tail[0]:<br>        word_cnt[word] = word_cnt.get(word, 0) + 1<br><br>#排序<br>sorted_word_cnt = sorted(word_cnt.items(), key=lambda kv : kv[1], reverse=True)<br>#存文件<br>with open(&#39;06_out_read_with_size.txt&#39;,&#39;w&#39;) as f:<br>    for w, c in sorted_word_cnt:<br>        f.write(&quot;{}, {} \\n&quot;.format(w,c ))<br>","like_count":0},{"had_liked":false,"id":266354,"user_name":"xu","can_delete":false,"product_type":"c1","uid":1316364,"ip_address":"","ucode":"2CF44446E085AC","user_header":"https://static001.geekbang.org/account/avatar/00/14/16/0c/fa62ffdd.jpg","comment_is_top":false,"comment_ctime":1607310669,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607310669","product_id":100026901,"comment_content":"超值的课程<br>只是这个第二题有点疑惑，这个第二题是不是也要在Linux建一个web啊，还是直接在win下搭环境？","like_count":0},{"had_liked":false,"id":261997,"user_name":"dao","can_delete":false,"product_type":"c1","uid":1087879,"ip_address":"","ucode":"4181FB270462CF","user_header":"https://static001.geekbang.org/account/avatar/00/10/99/87/98ebb20e.jpg","comment_is_top":false,"comment_ctime":1605602335,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1605602335","product_id":100026901,"comment_content":"关于思考题一，改写了老师的答案，解决评论区里关于word_list内存溢出及最后一个词组如果没有标点的bug。<br>-----<br>import re<br><br>CHUNK_SIZE = 100 # 这个数表示一次最多读取的字符长度<br><br># 这个函数每次会接收上一次得到的 last_word，然后和这次的 text 合并起来处理。<br># 合并后判断最后一个词有没有可能连续，并分离出来，然后返回。<br># 这里的代码没有 if 语句，但是仍然是正确的，可以想一想为什么。<br>def parse_to_word_list(text, last_word):<br>    text = re.sub(r&#39;[^\\w ]&#39;, &#39; &#39;, last_word + text)<br>    text = text.lower()<br>    cur_word_list = text.split(&#39; &#39;)<br>    cur_word_list, last_word = cur_word_list[:-1], cur_word_list[-1]<br>    return (filter(None, cur_word_list), last_word)<br><br>def solve():<br>    with open(&#39;in.txt&#39;, &#39;r&#39;) as fin:<br>        word_cnt = {}<br>        word_list, last_word = [], &#39;&#39;<br>        while True:<br>            text = fin.read(CHUNK_SIZE)<br>            if not text:<br>                # 读取完毕，中断循环<br>                break<br>            word_list, last_word = parse_to_word_list(text, last_word)<br><br>            for word in word_list:<br>                if word not in word_cnt:<br>                    word_cnt[word] = 1<br>                else:<br>                    word_cnt[word] += 1<br><br>        if last_word:<br>            if last_word not in word_cnt:<br>                word_cnt[last_word] = 1<br>            else:<br>                word_cnt[last_word] += 1<br><br>        sorted_word_cnt = sorted(word_cnt.items(), key=lambda kv: kv[1], reverse=True)<br>        return sorted_word_cnt<br><br>words = solve()<br>with open(&#39;out.txt&#39;, &#39;w&#39;) as fout:<br>    for word,count in words:<br>        fout.write(f&#39;{word} {count}\\n&#39;)<br>","like_count":0},{"had_liked":false,"id":260535,"user_name":"Pythonlearner","can_delete":false,"product_type":"c1","uid":1592999,"ip_address":"","ucode":"2A1A7BA7402B5C","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJsn3s3eoPteic0rAmsxciaTu4twC0r1hoJlIPnAiacH0xLOTvmh0NEyBdDXicfOxprLOz6E6NfcaRB7w/132","comment_is_top":false,"comment_ctime":1605057523,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1605057523","product_id":100026901,"comment_content":"老师您好，什么时候用正则解决字符替代?什么时候用replace解决字符替代?两者相比哪个更高效，更高效的原因是为什么","like_count":0},{"had_liked":false,"id":256836,"user_name":"Geek_time","can_delete":false,"product_type":"c1","uid":1538424,"ip_address":"","ucode":"96FD038426AA37","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLw9fVyja3eQFJRjMF7OjEJVPJJicAA4w26nlChSSVTwYdDBUSNibqSvTwPbalEXuaWb6SEmP5oNJ1w/132","comment_is_top":false,"comment_ctime":1603762572,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603762572","product_id":100026901,"comment_content":"一问读取文件块以生成器形式进行操作，二问如果linux的话可以使用rsync的系统函数，这样可以保证最大效率和效果","like_count":0},{"had_liked":false,"id":241856,"user_name":"知止。","can_delete":false,"product_type":"c1","uid":2087309,"ip_address":"","ucode":"5D56DD062B1A43","user_header":"https://static001.geekbang.org/account/avatar/00/1f/d9/8d/78dd472a.jpg","comment_is_top":false,"comment_ctime":1597470565,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597470565","product_id":100026901,"comment_content":"能解析一下这个正则表达式的匹配规则吗？text = re.sub(r&#39;[^\\w ]&#39;, &#39; &#39;, text)","like_count":0},{"had_liked":false,"id":236583,"user_name":"小鱼","can_delete":false,"product_type":"c1","uid":2064498,"ip_address":"","ucode":"6AE561D1EF9C05","user_header":"https://static001.geekbang.org/account/avatar/00/1f/80/72/33107407.jpg","comment_is_top":false,"comment_ctime":1595472008,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595472008","product_id":100026901,"comment_content":"NLP中有段代码换个思路写<br># 生成单词和词频的字典 这段换成<br>word_cnt = {}<br>word_set = set(word_list)<br>for word in word_set:<br>      word_cnt[word_set] = word_list.count(word)<br>","like_count":0},{"had_liked":false,"id":226818,"user_name":"Geek_7d0f6b","can_delete":false,"product_type":"c1","uid":1843578,"ip_address":"","ucode":"31939937742A9D","user_header":"","comment_is_top":false,"comment_ctime":1592209985,"is_pvip":false,"replies":[{"id":"84144","content":"赞！","user_name":"作者回复","comment_id":226818,"uid":"1259521","ip_address":"","utype":1,"ctime":1592593061,"user_name_real":"Jingxiao"}],"discussion_count":1,"race_medal":0,"score":"1592209985","product_id":100026901,"comment_content":"import re<br>import time<br><br>#定义一个全局变量word_cnt<br>word_cnt = {}<br><br>def parse(text):<br>    text = re.sub(r&#39;[^\\w]&#39;, &#39; &#39;, text) #去除标点和换行符<br>    text = text.lower()<br>    word_list = text.split(&#39; &#39;)<br>    word_list = filter(None, word_list)<br><br>    #生成词频字典<br>    global word_cnt<br>    for word in word_list:<br>        if word not in word_cnt:<br>            word_cnt[word] = 0<br>        word_cnt[word] += 1<br><br>start_time = time.perf_counter()<br>with open(&#39;in.txt&#39;, &#39;r&#39;, encoding=&#39;UTF-8&#39;) as full:<br>    text = full.readline()<br>    while text:<br>        parse(text)<br>        text = full.readline()<br><br>sorted_word_cnt = sorted(word_cnt.items(), key=lambda kv: kv[1], reverse=True) #按照词频排序<br>with open(&#39;out.txt&#39;, &#39;w&#39;) as out:<br>    for word, freq in sorted_word_cnt:<br>        out.write(&#39;{} {}\\n&#39;.format(word, freq))<br>end_time = time.perf_counter()<br>print(end_time - start_time)<br>定义全局变量，稍微修改了一下parse函数，处理小说《飘》总共花费0.25秒","like_count":0,"discussions":[{"author":{"id":1259521,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJOlibibPFEWOib8ib7RtfAtxND5FUqCxxoeTuLAbBI9ic23xuwdXT4IyiaWq3Fic9RgEAYI0lBTbEp2rcg/132","nickname":"Jingxiao","note":"","ucode":"EB966BB87132F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":498375,"discussion_content":"赞！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592593061,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":223820,"user_name":"Joshua","can_delete":false,"product_type":"c1","uid":1348231,"ip_address":"","ucode":"6823D5F0EC5D10","user_header":"https://static001.geekbang.org/account/avatar/00/14/92/87/15931e41.jpg","comment_is_top":false,"comment_ctime":1591190451,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591190451","product_id":100026901,"comment_content":"第一题：在尽量不变动原来的代码的基础上，先利用空格分词，设置","like_count":0},{"had_liked":false,"id":208983,"user_name":"Geek_7cc111","can_delete":false,"product_type":"c1","uid":1860434,"ip_address":"","ucode":"B215419F65DBF4","user_header":"","comment_is_top":false,"comment_ctime":1587477806,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587477806","product_id":100026901,"comment_content":"from collections import defaultdict<br>import re<br>d = defaultdict(int)<br>with open(&quot;in.txt&quot;, mode=&quot;r&quot;, encoding=&quot;utf-8&quot;) as f:<br>    for line in f:<br>        for word in filter(lambda x:x, re.split(&#39;\\s&#39;,re.sub(r&#39;[^\\w ]&#39;, &#39; &#39;, line))):<br>            d[word.lower()]+=1<br>sorted_d= sorted(d.items(), key=lambda kv: kv[1], reverse=True)<br>print(sorted_d)","like_count":0},{"had_liked":false,"id":206806,"user_name":"LiuJ","can_delete":false,"product_type":"c1","uid":1937496,"ip_address":"","ucode":"EE4896E8E96B95","user_header":"https://static001.geekbang.org/account/avatar/00/1d/90/58/e2ab3dfe.jpg","comment_is_top":false,"comment_ctime":1586938939,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586938939","product_id":100026901,"comment_content":"思考题第一题：（每读取 1024 个字节的数据，将最后一个词放到下一词读取数据的前面）<br>import re<br><br><br>def parse(text, word_cnt):<br>    text = re.sub(&#39;[^\\w]&#39;, &#39; &#39;, text)<br>    text = text.lower()<br><br>    word_list = text.split(&#39; &#39;)<br>    last_word = word_list[-1]<br><br>    word_list = filter(None, word_list[:-1])<br><br>    for word in word_list:<br>        if word not in word_cnt:<br>            word_cnt[word] = 0<br>        word_cnt[word] += 1<br><br>    return last_word<br><br><br>word_cnt = {}<br>sorted_word_cnt = []<br>last_word = &#39;&#39;<br>BUF_SIZE = 1024<br><br>with open(&#39;.&#47;in.txt&#39;) as fin:<br>    while True:<br>        data = last_word + fin.read(BUF_SIZE)   # 每读一次将最后一个单词放入下次读取数据的前面来处理<br>        if not data:<br>            break<br>        else:<br>            last_word = parse(data, word_cnt)<br><br>    sorted_word_cnt = sorted(<br>        word_cnt.items(), key=lambda kv: kv[1], reverse=True)<br><br><br>with open(&#39;.&#47;out.txt&#39;, &#39;w&#39;) as fout:<br>    for word, req in sorted_word_cnt:<br>        fout.write(&#39;{} {}\\n&#39;.format(word, req))<br>","like_count":0},{"had_liked":false,"id":194358,"user_name":"Geek_thefuture","can_delete":false,"product_type":"c1","uid":1775559,"ip_address":"","ucode":"7100A3B76D20F0","user_header":"https://static001.geekbang.org/account/avatar/00/1b/17/c7/e62643a3.jpg","comment_is_top":false,"comment_ctime":1585053988,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585053988","product_id":100026901,"comment_content":"用jupyter运行file相关命令的时候总是filenotfounderror要怎么解决呢","like_count":0},{"had_liked":false,"id":193227,"user_name":"Geek_27","can_delete":false,"product_type":"c1","uid":1925957,"ip_address":"","ucode":"908A4172A219BA","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL7ZOCns481Zl7VeRk9IdHrAYF8ZpKBJ9LLUaRn7qGoibdZpwzhRmRlGRQBbFVx914qg2p5jZPozDg/132","comment_is_top":false,"comment_ctime":1584886552,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584886552","product_id":100026901,"comment_content":"好多东西不用确实忘的好快","like_count":0},{"had_liked":false,"id":190610,"user_name":"4thirteen2one","can_delete":false,"product_type":"c1","uid":1403309,"ip_address":"","ucode":"085D582DD552DD","user_header":"https://static001.geekbang.org/account/avatar/00/15/69/ad/608188c2.jpg","comment_is_top":false,"comment_ctime":1584672362,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584672362","product_id":100026901,"comment_content":"思考题第一题：<br><br>def get_word_freq_histogram(text_path):<br>    histogram = {}<br>    with open(text_path, &quot;r&quot;, encoding=&quot;utf-8&quot;) as f:<br>        tail = &quot;&quot;<br>        for line in f:<br>            if line != &quot;\\n&quot;:<br>                head = tail + line.rsplit(&quot; &quot;, 1)[0]<br>                tail = line.rsplit(&quot; &quot;, 1)[1]<br>                text = re.sub(r&#39; ?[^\\w ] ?&#39;, &#39; &#39;, head)<br>                text = text.lower()<br>                word_list = text.split()<br>                for word in word_list:<br>                    if word not in histogram:<br>                        histogram[word] = 0<br>                    histogram[word] += 1<br>    return sorted(histogram.items(), key=lambda kv: kv[1], reverse=True)","like_count":0},{"had_liked":false,"id":177736,"user_name":"Walker","can_delete":false,"product_type":"c1","uid":1712487,"ip_address":"","ucode":"721A45571AC658","user_header":"https://static001.geekbang.org/account/avatar/00/1a/21/67/8bf2d183.jpg","comment_is_top":false,"comment_ctime":1581486170,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581486170","product_id":100026901,"comment_content":"第一题：<br>&quot;&quot;&quot;没有考虑字符串跨行的问题&quot;&quot;&quot;<br><br>def count_str(path):<br>    with open(path, &quot;r&quot;, encoding=&quot;utf-8&quot;) as f:<br>        str_list = []<br>        for line in iter(lambda: f.readline(), &#39;&#39;):<br>            word_list = re.findall(&quot;\\w+&quot;, line)<br>            str_list.extend(word_list)<br>        word_count_result = {word: str_list.count(word) for word in str_list}<br>        word_count_result = dict(sorted(word_count_result.items(), reverse=True, key=lambda x: x[1]))<br>        return word_count_result<br><br>def write_result(result):<br>    with open(&quot;out.txt&quot;, &quot;w&quot;) as f:<br>        import json<br>        f.write(json.dumps(result))","like_count":0},{"had_liked":false,"id":168253,"user_name":"Joeforfun","can_delete":false,"product_type":"c1","uid":1797145,"ip_address":"","ucode":"3D2BA912E0D77D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/iaxgvyIjNFomptQ9qBk4iaakYOS1XojYHDp48TXt1kX9DxTkKuR2UXGTyhG1liahib6E4BLF12ia6mic2pF0t4ECeZIQ/132","comment_is_top":false,"comment_ctime":1578038260,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578038260","product_id":100026901,"comment_content":"# -*- coding=utf-8 -*- <br>import re<br><br># 你不用太关心这个函数<br>def parse(text):<br>    # 使用正则表达式去除标点符号和换行符<br>    text = re.sub(r&#39;[^\\w ]&#39;, &#39; &#39;, text)<br>    # 转为小写<br>    text = text.lower()<br>    # 生成所有单词的列表<br>    word_list = text.split(&#39; &#39;)<br>    return word_list<br><br>with open(&#39;in.txt&#39;, &#39;r&#39;) as fin:<br>    word_cnt = {}<br>    #每行读取（没有考虑一行有很多的情况）<br>    for text in fin.readlines():<br>        #处理读取的每行数据<br>        word_list=parse(text)<br>        #批判统计<br>        for word in word_list:<br>            if word not in word_cnt:<br>                word_cnt[word] = 1<br>            else:<br>                word_cnt[word] += 1<br># 按照词频排序                <br>sorted_word_cnt = sorted(word_cnt.items(), key=lambda kv: kv[1], reverse=True)<br><br>with open(&#39;out.txt&#39;, &#39;w&#39;) as fout:<br>    for word, freq in sorted_word_cnt:<br>        fout.write(&#39;{} {}\\n&#39;.format(word, freq))","like_count":0},{"had_liked":false,"id":167979,"user_name":"一粒","can_delete":false,"product_type":"c1","uid":1582813,"ip_address":"","ucode":"FB5F583CC6AE3C","user_header":"https://static001.geekbang.org/account/avatar/00/18/26/dd/d58156b1.jpg","comment_is_top":false,"comment_ctime":1577971719,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1577971719","product_id":100026901,"comment_content":"第一题：<br>import re<br><br>def parse(text):<br>    text = re.sub(r&#39;[^\\w]&#39;, &#39; &#39;, text)<br>    text = text.lower()<br>    word_list = text.split(&#39; &#39;)<br>    word_list = filter(None, word_list)<br><br>    word_cnt = {}<br>    for word in word_list:<br>        if word not in word_cnt:<br>            word_cnt[word] = 0<br>        word_cnt[word] += 1<br><br>    sorted_word_cnt = sorted(word_cnt.items(), key=lambda kv: kv[1], reverse=True)<br>    return sorted_word_cnt<br><br>with open(&#39;in.txt&#39;, &#39;r&#39;, encoding=&#39;utf8&#39;) as fin:<br>    for line in fin:<br>        word_and_freq = parse(line)<br>        with open(&#39;out.txt&#39;, &#39;a&#39;) as fout:<br>            for word, freq in word_and_freq:<br>                fout.write(&#39;{} {}\\n&#39;.format(word, freq))","like_count":0},{"had_liked":false,"id":159776,"user_name":"皮皮","can_delete":false,"product_type":"c1","uid":1752176,"ip_address":"","ucode":"9C4FFC1D28269D","user_header":"https://static001.geekbang.org/account/avatar/00/1a/bc/70/8d2ccd34.jpg","comment_is_top":false,"comment_ctime":1575785629,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575785629","product_id":100026901,"comment_content":"现在还是没看到最终代码，请问在哪呢","like_count":0},{"had_liked":false,"id":156674,"user_name":"Bonaparte","can_delete":false,"product_type":"c1","uid":1021741,"ip_address":"","ucode":"27E9CEE38A30C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/97/2d/8e4836f3.jpg","comment_is_top":false,"comment_ctime":1574934158,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574934158","product_id":100026901,"comment_content":"如果要学习数据分析和算法的内容，必须先学会去考虑时间复杂度和空间复杂度，之前学习过很多Python的课程中，都没有提到过复杂度这个问题。突然在这个课程看到了复杂度问题，开始就学习就会比较吃力。到了字符串哪节开始，就慢慢看不懂了。学习的节奏变成了一周，甚至两周时间去啃一讲的内容。<br><br>确实之前的都是玩具，似乎之前都没有学过一样的，一脸的疑惑，这到底是个啥子意思？<br><br>慢慢啃... ...","like_count":0},{"had_liked":false,"id":143505,"user_name":"追风筝的人","can_delete":false,"product_type":"c1","uid":1488020,"ip_address":"","ucode":"2993D60F94C396","user_header":"https://static001.geekbang.org/account/avatar/00/16/b4/94/2796de72.jpg","comment_is_top":false,"comment_ctime":1571720470,"is_pvip":false,"replies":[{"id":"56040","content":"https:&#47;&#47;www.zhihu.com&#47;question&#47;265519629&#47;answer&#47;295435756","user_name":"作者回复","user_name_real":"高山流水","uid":"1513504","ctime":1572245327,"ip_address":"","comment_id":143505,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1571720470","product_id":100026901,"comment_content":"老师    最后一行print(welcome_str.format(**welcome_dic))输出  为什么要加上2个*呢？<br><br>name = input(&#39;your name:&#39;)<br>gender = input(&#39;you are a boy?(y&#47;n)&#39;)<br><br>###### 输入 ######<br>your name:Jack<br>you are a boy?<br><br>welcome_str = &#39;Welcome to the matrix {prefix} {name}.&#39;<br>welcome_dic = {<br>    &#39;prefix&#39;: &#39;Mr.&#39; if gender == &#39;y&#39; else &#39;Mrs&#39;,<br>    &#39;name&#39;: name<br>}<br><br>print(&#39;authorizing...&#39;)<br>print(welcome_str.format(**welcome_dic))<br><br>########## 输出 ##########<br>authorizing...<br>Welcome to the matrix Mr. Jack.","like_count":0,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"高山流水","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471567,"discussion_content":"https://www.zhihu.com/question/265519629/answer/295435756","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572245327,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":135974,"user_name":"ct_tao","can_delete":false,"product_type":"c1","uid":1524554,"ip_address":"","ucode":"24FED1BE03DB7E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKpHuicbWZbXC1CTE019W6icx2aZzWYOHPxn2nhTM9BvRNzjhuEQMa1IcQWsCqeP8OwnnccO8AoMFGw/132","comment_is_top":false,"comment_ctime":1569318922,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1569318922","product_id":100026901,"comment_content":"from collections import defaultdict<br>import re<br><br>d = defaultdict(int)<br>with open(&#39;a.txt&#39;,&#39;r&#39;) as fin:<br>    for line in fin:<br>        line = line.lower()<br><br>        word_list = re.sub(r&#39;[^\\w]&#39;, &#39; &#39;, line)<br><br>        word_list = word_list.split(&#39; &#39;)<br><br>        word_list = filter(None, word_list)<br>        for word in word_list:<br>            d[word] +=1<br><br><br>with open(&#39;out.txt&#39;, &#39;w&#39;) as fout:<br>    for word, freq in d.items():<br>        fout.write(&#39;{} {}\\n&#39;.format(word, freq))<br>","like_count":0},{"had_liked":false,"id":135235,"user_name":"自由民","can_delete":false,"product_type":"c1","uid":1346236,"ip_address":"","ucode":"435C67531697F1","user_header":"https://static001.geekbang.org/account/avatar/00/14/8a/bc/cb39ed38.jpg","comment_is_top":false,"comment_ctime":1569074905,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569074905","product_id":100026901,"comment_content":"思考题<br>1.程序见github，用readline<br>只读了第一行，不知何故。<br>2.写个思路吧，设一个setting.json文件，一个bWrite文件，一个bRead文件。server.py检查bWrite为False，上传文件，在setting里记录文件名，文件大小。完成后将bWrite置为True.client.py检查那两个文件，如果bWrite为True而bRead为False，读取setting.json文件中的文件名，下载。完成后，删除文件，bRead设True，bWrite设False。<br>总结:输入输出有键盘屏幕，文件等方式，文件有普通文件和JSON等方式。要注意错误处理。<br>课程的练习代码: https:&#47;&#47;github.com&#47;zwdnet&#47;PythonPractice","like_count":0},{"had_liked":false,"id":127151,"user_name":"yonguo_dev","can_delete":false,"product_type":"c1","uid":1636363,"ip_address":"","ucode":"49E27086BF9437","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/bGrI3qhTPVgWVxSAibUu2XsFaNr3TFO08NhKcnVzW6kQPKh9kd8s6von8AORxDjRXvJXB1yibafb4nsPOzD5NWXQ/132","comment_is_top":false,"comment_ctime":1566569865,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566569865","product_id":100026901,"comment_content":"第二题给个简单的线程版：   <br>import time<br>import threading<br><br><br>file_remain = 20<br>file_lock = 0<br>cloud_size = 0<br>file_transferred = 0<br><br><br>def file_client():<br>    &quot;&quot;&quot;<br>    consume file<br>    :return:<br>    &quot;&quot;&quot;<br>    global file_transferred<br>    global cloud_size<br>    while True:<br>        if file_transferred &gt;= 20:<br>            print(&#39;download success&#39;)<br>            break<br><br>        if cloud_size &lt;= 0:<br>            time.sleep(1)<br>        else:<br>            print(&#39;download 5G-file&#39;)<br>            cloud_size -= 5<br>            file_transferred += 5<br><br><br>def file_server():<br>    global file_remain<br>    global cloud_size<br>    while True:<br>        if file_remain &lt;= 0:<br>            print(&#39;upload finished&#39;)<br>            break<br><br>        if cloud_size:<br>            time.sleep(1)<br>        else:<br>            print(&#39;upload 5G-file&#39;)<br>            file_remain -= 5<br>            cloud_size += 5<br><br><br>threading.Thread(target=file_server, args=()).start()<br>threading.Thread(target=file_client, args=()).start()","like_count":0},{"had_liked":false,"id":127138,"user_name":"yonguo_dev","can_delete":false,"product_type":"c1","uid":1636363,"ip_address":"","ucode":"49E27086BF9437","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/bGrI3qhTPVgWVxSAibUu2XsFaNr3TFO08NhKcnVzW6kQPKh9kd8s6von8AORxDjRXvJXB1yibafb4nsPOzD5NWXQ/132","comment_is_top":false,"comment_ctime":1566567422,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566567422","product_id":100026901,"comment_content":"第一题：<br>try:<br>    word_dic = {}<br>    with open(&quot;dream.txt&quot;, &#39;r&#39;) as f:<br>        while True:<br>            line_content = f.readline()<br>            if line_content:<br>                for word in line_content.strip().split(&#39; &#39;):<br>                    if not word:<br>                        continue<br>                    else:<br>                        while True:<br>                            if not word or word[-1].isalpha():<br>                                break<br>                            word = word[:-1]<br><br>                        if not word:<br>                            continue<br><br>                        if word.upper() in word_dic.keys():<br>                            word_dic[word.upper()] += 1<br>                        else:<br>                            word_dic[word.upper()] = 1<br><br>            else:<br>                break<br><br>    print(word_dic)<br><br>    word_list = sorted(<br>        [_ for _ in word_dic.items()], key=lambda x: -x[1]<br>    )<br><br>    print(word_list)<br><br>except Exception as e:<br>    print(e)","like_count":0},{"had_liked":false,"id":126552,"user_name":"055","can_delete":false,"product_type":"c1","uid":1526831,"ip_address":"","ucode":"210A944276395F","user_header":"https://static001.geekbang.org/account/avatar/00/17/4c/2f/85a8d26e.jpg","comment_is_top":false,"comment_ctime":1566409613,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566409613","product_id":100026901,"comment_content":"老师，为什么parse_to_word_list(text, last_word, word_list)中不用返回word_list?","like_count":0},{"had_liked":false,"id":113216,"user_name":"Zeb爱python","can_delete":false,"product_type":"c1","uid":1600773,"ip_address":"","ucode":"6164593B62880E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/LyDQYy515JwT0yHMSrPFsC1gfGnXyYLka3mDVLicAOIdyzMMZqNm0y8SNficDJYR1coDh5QOhxkHEjzqibFmNBCnA/132","comment_is_top":false,"comment_ctime":1562917467,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562917467","product_id":100026901,"comment_content":"我的思路如下，传入文件，返回字典，老师这样可以吗？<br>import re<br><br><br>def parse(file):<br><br>    word_dic = {}<br>    with open(&#39;D:&#47;odb&#47;in.txt&#39;, &#39;r&#39;) as fin:<br>        for line in fin:<br>            text = re.sub(r&#39;[^\\w ]&#39;, &#39; &#39;, line)<br>            text = text.lower()<br><br>            word_list = text.split(&#39; &#39;)<br>            word_list = filter(None, word_list)<br><br>            for word in word_list:<br>                if word not in word_dic:<br>                    word_dic[word] = 0<br>                word_dic[word] += 1<br><br>    sorted_word_list = sorted(word_dic.items(),<br>                              key=lambda kv: kv[1],<br>                              reverse=True)<br><br>    return sorted_word_list<br><br><br>word_file = &#39;D:&#47;odb&#47;in.txt&#39;<br>word_dic_sorted = parse(word_file)<br><br>with open(&#39;D:&#47;odb&#47;out.txt&#39;, &#39;w&#39;) as fout:<br>    for word, freq in word_dic_sorted:<br>        fout.write(&#39;{} {}\\n&#39;.format(word, freq))<br>","like_count":0},{"had_liked":false,"id":110302,"user_name":"郭杰","can_delete":false,"product_type":"c1","uid":1139077,"ip_address":"","ucode":"8A14FC047A679B","user_header":"https://static001.geekbang.org/account/avatar/00/11/61/85/6accd013.jpg","comment_is_top":false,"comment_ctime":1562226691,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562226691","product_id":100026901,"comment_content":"一&#47;首先先建立数据流<br><br>二&#47;监听是否有新数据写入<br><br>三&#47;再把数据写入到本地<br><br>四&#47;删除线上数据","like_count":0},{"had_liked":false,"id":110289,"user_name":"郭杰","can_delete":false,"product_type":"c1","uid":1139077,"ip_address":"","ucode":"8A14FC047A679B","user_header":"https://static001.geekbang.org/account/avatar/00/11/61/85/6accd013.jpg","comment_is_top":false,"comment_ctime":1562222869,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562222869","product_id":100026901,"comment_content":"python2和python3返回的不一样","like_count":0},{"had_liked":false,"id":110235,"user_name":"张大人","can_delete":false,"product_type":"c1","uid":1200544,"ip_address":"","ucode":"4FCA71788DEB29","user_header":"https://static001.geekbang.org/account/avatar/00/12/51/a0/f3bb1dd7.jpg","comment_is_top":false,"comment_ctime":1562212272,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562212272","product_id":100026901,"comment_content":"不好意思，请问老师的github地址多少啊？","like_count":0},{"had_liked":false,"id":109825,"user_name":"xavier","can_delete":false,"product_type":"c1","uid":1243128,"ip_address":"","ucode":"2F7918EA37ED9F","user_header":"https://static001.geekbang.org/account/avatar/00/12/f7/f8/3c0a6854.jpg","comment_is_top":false,"comment_ctime":1562117546,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562117546","product_id":100026901,"comment_content":"每篇都有收获，实践出真知，喜欢这种实战教学。","like_count":0},{"had_liked":false,"id":109701,"user_name":"Luove","can_delete":false,"product_type":"c1","uid":1545251,"ip_address":"","ucode":"73CD4D2C731B47","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM7adYZoHGic7ZS6cp9OmBjh1C4ajCCpciblR3ib3jDtiaKrFdbT9J7sl2B9eNoCQicfx5QWgVVZQB74pfQ/132","comment_is_top":false,"comment_ctime":1562079115,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562079115","product_id":100026901,"comment_content":"老师好，本文中提到，lambda x:x 等价于 None，不是很理解为何相等呢，lambda x:x 不就是返回自身的吗？请老师解惑。","like_count":0},{"had_liked":false,"id":105600,"user_name":"Geek_59f23e","can_delete":false,"product_type":"c1","uid":1513783,"ip_address":"","ucode":"A463C6EB7447FD","user_header":"https://static001.geekbang.org/account/avatar/00/17/19/37/e0a9bf99.jpg","comment_is_top":false,"comment_ctime":1561039740,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561039740","product_id":100026901,"comment_content":"第二题我在想能不能提前判断出合理的CHUNK_SIZE，比如在100的位置附近找到102是空格，将102作为第一次read的size，可以使用seek函数来判断当前read(1)字符是否为空格，同时使用二进制读来提高速度，最后构建出每次read的size列表，会不会更加效率呢。","like_count":0},{"had_liked":false,"id":102285,"user_name":"虎皮猫大人","can_delete":false,"product_type":"c1","uid":1142781,"ip_address":"","ucode":"A92E4A61B86BDC","user_header":"https://static001.geekbang.org/account/avatar/00/11/6f/fd/af250f7d.jpg","comment_is_top":false,"comment_ctime":1560176157,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1560176157","product_id":100026901,"comment_content":"老师的第一题解法，为什么pares_to_word_list函数没有返回word_list，但在solve函数中的for循环可以读到数据？","like_count":0,"discussions":[{"author":{"id":1606433,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/UA8KQxMP9FCvygSLksNSWLzhz0rJH8hiaP9XrfbQE81ibd7kicu2ibmlJVwXGCDu8T1jZ5xvowOqHiaZe6InBOhvKaQ/132","nickname":"hp_momocha2","note":"","ucode":"4478DC2EC730D9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3155,"discussion_content":"因为传递给pares_to_word_list函数参数是列表word_list的指针（或称为引用），并不是列表副本。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564229510,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101872,"user_name":"建强","can_delete":false,"product_type":"c1","uid":1397126,"ip_address":"","ucode":"62B03D0E0C64EC","user_header":"https://static001.geekbang.org/account/avatar/00/15/51/86/b5fd8dd8.jpg","comment_is_top":false,"comment_ctime":1560006173,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560006173","product_id":100026901,"comment_content":"思考题2的client.py源程序如下：<br>import json<br>import time<br><br>&#39;&#39;&#39;<br>Client端处理流程：<br>1.读取config.json文件<br>2.判断状态，若status=0,表示文件已经下载，需要等待上传，仍然回到第1步<br>3.若status=1或status=2,表示可从网盘上下载文件，则从网盘中读取文件，并写入本地文件中<br>4.若status=1，则修改status=0，写回config.json，仍然回到第1步<br>5.若status=2，则说明上传已经结束，Client端程序也结束。<br>&#39;&#39;&#39;<br>def getFileStatus():<br><br>    #因第一次写Python，不知道怎么获取网盘文件，暂时用本地文件代替<br>    with open(&#39;F:\\\\temp\\\\config.json&#39;, &#39;r&#39;) as jsonfin:<br>        filestatus = json.load(jsonfin)<br><br>    return filestatus<br><br>def setFileStatus(filestatus):<br><br>    #因第一次写Python，不知道怎么获取网盘文件，暂时用本地文件代替<br>    with open(&#39;F:\\\\temp\\\\config.json&#39;, &#39;w&#39;) as jsonfout:<br>        json.dump(filestatus,jsonfout)<br><br>    return<br><br>#参数filename：要下载的文件名，即把网盘文件的内容写入该文件中。<br>def downLoadFile(filename):<br><br>    #向下载文件中写入网盘文件内容<br>    with open(filename, &#39;ab&#39;) as fout:<br><br>        downloadtimes = 0<br><br>        while(True):<br>            <br>            #读取文件状态，判断是否可下传<br>            filestatus = getFileStatus()<br>            netfile = filestatus[&#39;filename&#39;]<br>            status = filestatus[&#39;status&#39;]<br><br>            #print(&quot;client: status=&quot;,status)<br><br>            if status == 2: #文件上传已经结束，则退出<br>                print(&quot;文件下载结束&quot;)<br>                break<br><br>            if status == 0: #文件已经下载，等待上传后才能继续下载<br>                #为避免和服务端产生冲突，延迟1秒，再读状态<br>                time.sleep(1)<br>                continue<br><br>            #读取网盘内容<br>            with open(netfile, &#39;rb&#39;) as fin:<br>                filevalue = fin.read()<br>                <br>            #写入下载文件中<br>            fout.write(filevalue)<br><br>            #设置状态<br>            filestatus[&#39;status&#39;] = 0<br> <br>            #把文件状态写回config.json<br>            setFileStatus(filestatus)<br><br>            downloadtimes += 1<br><br>            print(&quot;Client: 第&quot;,downloadtimes,&quot;次下载&quot;)<br><br>    return<br>downLoadFile(&#39;F:\\\\temp\\\\local\\\\move.rar&#39;)<br>","like_count":0},{"had_liked":false,"id":101870,"user_name":"建强","can_delete":false,"product_type":"c1","uid":1397126,"ip_address":"","ucode":"62B03D0E0C64EC","user_header":"https://static001.geekbang.org/account/avatar/00/15/51/86/b5fd8dd8.jpg","comment_is_top":false,"comment_ctime":1560005991,"is_pvip":false,"replies":[{"id":"36706","content":"👍","user_name":"作者回复","user_name_real":"高山流水","uid":"1513504","ctime":1560030177,"ip_address":"","comment_id":101870,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560005991","product_id":100026901,"comment_content":"思考题2的server.py源程序如下：<br>import json<br>import time<br><br>&#39;&#39;&#39;<br>SERVER端处理流程：<br>1.读取config.json文件<br>2.判断状态，若status=1,表示文件已经上传，需要等待下载，仍然回到第1步<br>3.若status=0,表示可上传文件到网盘，则读取要上传的源文件，大小不超过5G，并写入网盘文件<br>4.判断断源文件是否已经读完，若未读完，修改status=1，写回config.json，仍然回到第1步<br>5.否则，修改status=2，写回config.json,Server端程序结束。<br>&#39;&#39;&#39;<br>def getFileStatus():<br><br>    #因第一次写Python，不知道怎么获取网盘文件，暂时用本地文件代替<br>    with open(&#39;F:\\\\temp\\\\config.json&#39;, &#39;r&#39;) as jsonfin:<br>        filestatus = json.load(jsonfin)<br><br>    return filestatus<br><br>def setFileStatus(filestatus):<br><br>    #因第一次写Python，不知道怎么获取网盘文件，暂时用本地文件代替<br>    with open(&#39;F:\\\\temp\\\\config.json&#39;, &#39;w&#39;) as jsonfout:<br>        json.dump(filestatus,jsonfout)<br><br>    return<br><br>#参数filename：要上传的文件名<br>#参数filesize：要上传的文件大小,默认为10M大小<br>def upLoadFile(filename,filesize=10485760):<br><br>    #从上传文件中读取文件内容<br>    with open(filename, &#39;rb&#39;) as fin:<br><br>        uploadtimes = 0<br><br>        while(True):<br>            <br>            #读取文件状态，判断是否可上传<br>            filestatus = getFileStatus()<br>            netfile = filestatus[&#39;filename&#39;]<br>            status = filestatus[&#39;status&#39;]<br><br>            #print(&quot;server: status=&quot;,status)<br><br>            if status == 2: #文件上传已经结束，则退出<br>                break<br><br>            if status == 1: #文件已经上传，等待下载后才能继续上传<br>                #为避免和客户端产生冲突，延迟1秒，再读状态<br>                time.sleep(1)<br>                continue<br>            <br>            filevalue = fin.read(filesize)<br><br>            if not filevalue:<br>                filestatus[&#39;filesize&#39;] = 0<br>                filestatus[&#39;status&#39;] = 2<br>                print(&quot;文件上传结束&quot;)<br>            else:<br>                #把读取的内容写入网盘文件，并设置状态<br>                with open(netfile, &#39;wb&#39;) as fout:<br>                    fout.write(filevalue)<br>                filestatus[&#39;filesize&#39;] = filesize<br>                filestatus[&#39;status&#39;] = 1<br><br>                uploadtimes += 1<br>                print(&quot;Server: 第&quot;,uploadtimes,&quot;次上传&quot;)<br><br>            #把文件状态写回config.json<br>            setFileStatus(filestatus)<br><br>    return<br><br>upLoadFile(&#39;F:\\\\temp\\\\move\\\\move.rar&#39;)<br>","like_count":0,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"高山流水","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453149,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560030177,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101377,"user_name":"new","can_delete":false,"product_type":"c1","uid":1096252,"ip_address":"","ucode":"DFFCDC2123CCAA","user_header":"https://static001.geekbang.org/account/avatar/00/10/ba/3c/2b642c9a.jpg","comment_is_top":false,"comment_ctime":1559792156,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559792156","product_id":100026901,"comment_content":"第一个打印语句应该是print(&#39;type of params_str = {}, params_str = {}&#39;.format(type(params_str), params_str))这么写吧。好像表达和书写的有问题吧。感觉错误好多，不适合我这初学者","like_count":0},{"had_liked":false,"id":100750,"user_name":"Tsn_09","can_delete":false,"product_type":"c1","uid":1554170,"ip_address":"","ucode":"736F4551CB9A2F","user_header":"","comment_is_top":false,"comment_ctime":1559632272,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559632272","product_id":100026901,"comment_content":"貌似最后一个单词会少统计一次","like_count":0},{"had_liked":false,"id":100728,"user_name":"方","can_delete":false,"product_type":"c1","uid":1524180,"ip_address":"","ucode":"FAE43CEB143337","user_header":"https://static001.geekbang.org/account/avatar/00/17/41/d4/a896f83f.jpg","comment_is_top":false,"comment_ctime":1559628421,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559628421","product_id":100026901,"comment_content":"就没人发现 b = input(&quot;input:&quot;) 接收不了字符串吗？<br>2.7  3.6  3.7 版本都不行<br>然后用了 b = raw_input(&quot;input:&quot;) 就行<br>我纯小白，见谅","like_count":0},{"had_liked":false,"id":100114,"user_name":"游戏","can_delete":false,"product_type":"c1","uid":1526457,"ip_address":"","ucode":"2DAF963DADEE76","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/rp4leprLrAVpeibk9n6KHaYZeasBG4faU2JnHsBMqxE1o4BALjCTmBZV2g4dkuPGhu13kmRwSOgXpoPky3qc4Zw/132","comment_is_top":false,"comment_ctime":1559446921,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559446921","product_id":100026901,"comment_content":"配置文件的和当前的网盘文件同步不会一一对应，所以需要在配置文件中加入对应的文件信息，当公司获取到的配置文件中的文件列表信息和dropbox同步的文件列表信息一致时就可以复制完了文件后进行配置文件的修改，加入一个标记表示已经拷贝完毕，当家里的电脑获取到已经拷贝完成的标记后就可以删除掉dropbox中的文件，进行下一波的文件同步","like_count":0},{"had_liked":false,"id":99388,"user_name":"link","can_delete":false,"product_type":"c1","uid":1449334,"ip_address":"","ucode":"2A5C2D8987F958","user_header":"https://static001.geekbang.org/account/avatar/00/16/1d/76/62c8df21.jpg","comment_is_top":false,"comment_ctime":1559204722,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559204722","product_id":100026901,"comment_content":"U盘是肯定会带的","like_count":0},{"had_liked":false,"id":98737,"user_name":"Clany","can_delete":false,"product_type":"c1","uid":1238495,"ip_address":"","ucode":"1C4B6321172D87","user_header":"https://static001.geekbang.org/account/avatar/00/12/e5/df/ae7f8e00.jpg","comment_is_top":false,"comment_ctime":1559089069,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559089069","product_id":100026901,"comment_content":"老师，我去按行读取一个大文本数据，如果中途出异常退出了，我该如何去续上异常处的地方继续读取数据呢？有哪些方法嘛，求告知，谢谢老师","like_count":0},{"had_liked":false,"id":98693,"user_name":"郭杰","can_delete":false,"product_type":"c1","uid":1139077,"ip_address":"","ucode":"8A14FC047A679B","user_header":"https://static001.geekbang.org/account/avatar/00/11/61/85/6accd013.jpg","comment_is_top":false,"comment_ctime":1559058688,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559058688","product_id":100026901,"comment_content":"老师我问一下，一般什么情况下使用try ","like_count":0},{"had_liked":false,"id":98671,"user_name":"张洪阆","can_delete":false,"product_type":"c1","uid":1001954,"ip_address":"","ucode":"CFF7035D0DF059","user_header":"https://static001.geekbang.org/account/avatar/00/0f/49/e2/1fad12eb.jpg","comment_is_top":false,"comment_ctime":1559054219,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559054219","product_id":100026901,"comment_content":"第二个print的最后一个参数应该是params_str吧？<br><br>print(&#39;after json serialization&#39;)<br>print(&#39;type of params_str = {}, params_str = {}&#39;.format(type(params_str), params))<br><br>original_params = json.loads(params_str)<br><br>print(&#39;after json deserialization&#39;)<br>print(&#39;type of original_params = {}, original_params = {}&#39;.format(type(original_params), original_params))<br><br>########## 输出 ##########<br><br>after json serialization<br>type of params_str = &lt;class &#39;str&#39;&gt;, params_str = {&#39;symbol&#39;: &#39;123456&#39;, &#39;type&#39;: &#39;limit&#39;, &#39;price&#39;: 123.4, &#39;amount&#39;: 23}<br>after json deserialization<br>type of original_params = &lt;class &#39;dict&#39;&gt;, original_params = {&#39;symbol&#39;: &#39;123456&#39;, &#39;type&#39;: &#39;limit&#39;, &#39;price&#39;: 123.4, &#39;amount&#39;: 23}<br>","like_count":0},{"had_liked":false,"id":98353,"user_name":"闲人","can_delete":false,"product_type":"c1","uid":1546492,"ip_address":"","ucode":"F04C0463C6BB5F","user_header":"https://static001.geekbang.org/account/avatar/00/17/98/fc/b1d22b7e.jpg","comment_is_top":false,"comment_ctime":1558966258,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558966258","product_id":100026901,"comment_content":"用help查了一下filter的用法：<br>filter(function or None, iterable) --&gt; filter object<br>Return an iterator yielding those items of iterable for <br>which function(item) is true.<br>If function is None, return the items that are true.","like_count":0},{"had_liked":false,"id":98335,"user_name":"Steven","can_delete":false,"product_type":"c1","uid":1495454,"ip_address":"","ucode":"BC5B33911FEC46","user_header":"https://static001.geekbang.org/account/avatar/00/16/d1/9e/fe7bc8df.jpg","comment_is_top":false,"comment_ctime":1558961538,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558961538","product_id":100026901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":98275,"user_name":"水木刀","can_delete":false,"product_type":"c1","uid":1500427,"ip_address":"","ucode":"942093B000C41E","user_header":"https://static001.geekbang.org/account/avatar/00/16/e5/0b/e4e2c0b1.jpg","comment_is_top":false,"comment_ctime":1558946709,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558946709","product_id":100026901,"comment_content":"第一题：学到了集合类型的计数器：<br>from collections import defaultdict<br>import re<br><br>dic = defaultdict(int)<br><br>print(type(dic))<br>with open(&quot;in.txt&quot;, &#39;r&#39;) as f:<br>    for line in f:\t\t\t\t\t\t\t#一行行读入<br>        line = re.sub(r&#39;[^\\w]&#39;, &#39; &#39;, line)\t##不是字母的都替换成空格<br>        for word in re.split(r&#39;[\\s\\n]+&#39;, line):  #替换任意空白字符后分割成列表<br>            word = word.lower()<br>            if word:<br>                dic[word] += 1<br>dic =  sorted(dic.items(),key=lambda kv:kv[1],reverse=True)<br>print(dic)","like_count":0},{"had_liked":false,"id":98160,"user_name":"Geek_16b077","can_delete":false,"product_type":"c1","uid":1524489,"ip_address":"","ucode":"FE80EC95D143EF","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLX6H7yN2PnwkCYlAV83jIh5P5cBUHnq4hqkib5RSktgqpMJBiaccGsZUzcagWLiaVG1ve3cqanicwPxg/132","comment_is_top":false,"comment_ctime":1558922755,"is_pvip":false,"replies":[{"id":"35142","content":"你可以自己跑一下哦，因为 last_word 在你这种情况下为空字符串，想想为什么","user_name":"作者回复","user_name_real":"Jingxiao","uid":"1259521","ctime":1558931659,"ip_address":"","comment_id":98160,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1558922755","product_id":100026901,"comment_content":"第一题，按每次读取CHUNK_SIZE=100，可能会有问题，比如  ：  ......I have a dream ...     ，如果have后面的空格刚好是第100个字符，那么此时产生的 last_word 为 have ，在与下一轮取得100个字符结合，得到 havea dream.......    出现&quot;havea&quot; 这一不合理得单词","like_count":0,"discussions":[{"author":{"id":1259521,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJOlibibPFEWOib8ib7RtfAtxND5FUqCxxoeTuLAbBI9ic23xuwdXT4IyiaWq3Fic9RgEAYI0lBTbEp2rcg/132","nickname":"Jingxiao","note":"","ucode":"EB966BB87132F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451584,"discussion_content":"你可以自己跑一下哦，因为 last_word 在你这种情况下为空字符串，想想为什么","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558931659,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":98091,"user_name":"ozonect","can_delete":false,"product_type":"c1","uid":1530688,"ip_address":"","ucode":"ABE4997A5FA2A1","user_header":"https://static001.geekbang.org/account/avatar/00/17/5b/40/309a4ef2.jpg","comment_is_top":false,"comment_ctime":1558914535,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558914535","product_id":100026901,"comment_content":"大一的新生飘过  感觉第二个思考题挺难的","like_count":0},{"had_liked":false,"id":98047,"user_name":"Fergus","can_delete":false,"product_type":"c1","uid":1277066,"ip_address":"","ucode":"3A8AC741C49CEB","user_header":"https://static001.geekbang.org/account/avatar/00/13/7c/8a/bdeb76ac.jpg","comment_is_top":false,"comment_ctime":1558882856,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558882856","product_id":100026901,"comment_content":"补课中。。。第二题还需要想想，等完成了再提交","like_count":0},{"had_liked":false,"id":97920,"user_name":"🍎🍎","can_delete":false,"product_type":"c1","uid":1545949,"ip_address":"","ucode":"21C4F1D74ADD87","user_header":"https://static001.geekbang.org/account/avatar/00/17/96/dd/0fb7667d.jpg","comment_is_top":false,"comment_ctime":1558841350,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558841350","product_id":100026901,"comment_content":"老师，这句话没有搞懂， key=lambda kv: kv[1] ，其中 kv[1] 代表什么呀？","like_count":0},{"had_liked":false,"id":97814,"user_name":"首席民工","can_delete":false,"product_type":"c1","uid":1079418,"ip_address":"","ucode":"8B8D2407A1F7E3","user_header":"https://static001.geekbang.org/account/avatar/00/10/78/7a/41ba6b76.jpg","comment_is_top":false,"comment_ctime":1558783879,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558783879","product_id":100026901,"comment_content":"**welcome_dic<br><br>这里两个*表示什么意思呢","like_count":0},{"had_liked":false,"id":97705,"user_name":"小侠龙旋风","can_delete":false,"product_type":"c1","uid":1126441,"ip_address":"","ucode":"073F3924A99835","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/29/d6816ebf.jpg","comment_is_top":false,"comment_ctime":1558752300,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558752300","product_id":100026901,"comment_content":"re.split(r&#39;\\s&#39;,line)只是通过空字符分割每个单词，但标点符号并没过滤。","like_count":0},{"had_liked":false,"id":97695,"user_name":"Geek_fly","can_delete":false,"product_type":"c1","uid":1524509,"ip_address":"","ucode":"6D65B9A70C222F","user_header":"","comment_is_top":false,"comment_ctime":1558750487,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558750487","product_id":100026901,"comment_content":"json.loads() 我经常经常用。。总会遇到各种编码问题导致报错，希望老师能把字符编码问题由浅至深讲清楚","like_count":0},{"had_liked":false,"id":97620,"user_name":"voc","can_delete":false,"product_type":"c1","uid":1526888,"ip_address":"","ucode":"EDAFFBA02550FF","user_header":"https://static001.geekbang.org/account/avatar/00/17/4c/68/77a0ac2d.jpg","comment_is_top":false,"comment_ctime":1558713567,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558713567","product_id":100026901,"comment_content":"读入json数据时，文件中的json字符串必须使用双引号，单引号读入会报错","like_count":0},{"had_liked":false,"id":97598,"user_name":"hlz-123","can_delete":false,"product_type":"c1","uid":1433586,"ip_address":"","ucode":"B7E5EF0C260BD2","user_header":"","comment_is_top":false,"comment_ctime":1558705787,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558705787","product_id":100026901,"comment_content":"第二问解决方案，在网盘上建立两个文件，server.json（存放发送次数）和client.json（存放接收次数），建立两个文件是防止读写冲突和覆盖数据。server每发送一次数据，次数+1，client每接收一次数据，次数+1，当发送次数&lt;=接收次数，发送数据，当发送次数&gt;接收次数，接收数据。<br>#server.py<br>import jsons<br>server={<br>    &#39;filename&#39;:&#39;file&#39; #写入网盘的文件名称<br>    &#39;sentcount&#39;: 0     #写入网盘的次数<br>}<br>while True:<br>    #首先读取网盘上server.json和client.json文件<br>    with open(&#39;server.json&#39;, &#39;r&#39;) as fin:<br>        original_server= json.load(fin)<br>    <br>    with open(&#39;client.json&#39;, &#39;r&#39;) as fin:<br>         original_client = json.load(fin)<br><br>    # 发送次数 &lt;= 接收次数，向网盘传送数据<br>    if server[&#39;sentcount&#39;]&lt;=client[&#39;receivecount&#39;]:<br>        with open(&#39;netdisk&#39;,&#39;w&#39;) as fout:<br>            file.write(string)<br>        <br>        #发送次数+1，并写入网盘<br>        server[&#39;sentcount&#39;]+=1<br>        with open(&#39;server.json&#39;,&#39;w&#39;) as fout:<br>            server_str=json.dump(server,fout)<br>            <br>        #如果文件全部传送完毕，终止循环<br>        if file ==None:<br>            break<br><br># server.py<br>import jsons<br>client = {<br>    &#39;filename&#39;: &#39;file&#39;  # 读出网盘的文件名称<br>                &#39;receivecount&#39;: 0  # 读出网盘的次数<br>}<br><br>while True:<br>    #每次读文件前，休眠一段时间<br>    sleep()<br>    # 首先读取网盘上server.json和client.json文件<br>    with open(&#39;server.json&#39;, &#39;r&#39;) as fin:<br>        original_server = json.load(fin)<br><br>    with open(&#39;client.json&#39;, &#39;r&#39;) as fin:<br>        original_client = json.load(fin)<br><br>    # 发送次数 &gt; 接收次数，读网盘数据<br>    if server[&#39;sentcount&#39;] &gt; client[&#39;receivecount&#39;]:<br>        with open(&#39;netdisk&#39;, &#39;r&#39;) as fin:<br>            file.read()<br><br>        # 读取次数+1，并写入网盘<br>        client[&#39;receivecount&#39;] += 1<br>        with open(&#39;client.json&#39;, &#39;w&#39;) as fout:<br>            client_str = json.dump(client, fout)<br>        # 如果文件全部接收完毕，终止循环<br>        if file == None:<br>            break<br>        ","like_count":0},{"had_liked":false,"id":97531,"user_name":"William","can_delete":false,"product_type":"c1","uid":1241365,"ip_address":"","ucode":"4499F99B180102","user_header":"https://static001.geekbang.org/account/avatar/00/12/f1/15/8fcf8038.jpg","comment_is_top":false,"comment_ctime":1558688770,"is_pvip":true,"discussion_count":0,"race_medal":2,"score":"1558688770","product_id":100026901,"comment_content":"第一问利用 collections.defaultdict, 长见识了，希望老师可以剖析一下其内部实现原理，为什么能处理大量文本而不内存泄漏。<br>第二题有意思，学会Python真的是可以为所欲为!!!","like_count":0},{"had_liked":false,"id":97436,"user_name":"Adam","can_delete":false,"product_type":"c1","uid":1305633,"ip_address":"","ucode":"338BA720880E4F","user_header":"https://static001.geekbang.org/account/avatar/00/13/ec/21/b0fe1bfd.jpg","comment_is_top":false,"comment_ctime":1558668862,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558668862","product_id":100026901,"comment_content":"词频统计应该可以用MRJob框架来写。","like_count":0},{"had_liked":false,"id":97423,"user_name":"阿坤儿00","can_delete":false,"product_type":"c1","uid":1542867,"ip_address":"","ucode":"4A276EEF4AC9D6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/OAykKXiaicxfyk4qicIA0XO3QGicogukYNCBoickRVFZrCxvCav0Jyv7Ax9twWH4qkCWFuSsyDltsONicCKmAv3GZYmQ/132","comment_is_top":false,"comment_ctime":1558667439,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558667439","product_id":100026901,"comment_content":"老师我的这样可以吗？<br>word_dict_sum = dict()<br>with open(&#39;file_word.txt&#39;,&#39;r&#39;) as f:<br>    while True:<br>        line = f.readline()<br>        if not line:<br>            break<br>        word_dict = parse(line)<br>        for key,value in word_dict.items():<br>            if key in word_dict_sum:<br>                word_dict_sum[key] += value<br>            else:<br>                word_dict_sum[key] =value<br><br>sorted_word_cnt = sorted(word_dict_sum.items(),key=lambda x:x[1],reverse=True)<br>print(sorted_word_cnt)","like_count":0},{"had_liked":false,"id":97285,"user_name":"Hoo-Ah","can_delete":false,"product_type":"c1","uid":1306913,"ip_address":"","ucode":"823093A6C7DEE7","user_header":"https://static001.geekbang.org/account/avatar/00/13/f1/21/52e8267b.jpg","comment_is_top":false,"comment_ctime":1558628789,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558628789","product_id":100026901,"comment_content":"打卡，学到了defaultdict","like_count":0},{"had_liked":false,"id":97258,"user_name":"hlz-123","can_delete":false,"product_type":"c1","uid":1433586,"ip_address":"","ucode":"B7E5EF0C260BD2","user_header":"","comment_is_top":false,"comment_ctime":1558621631,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558621631","product_id":100026901,"comment_content":"第一题答案如下，第二题还在考虑<br>from collections import Counter<br>import re<br>#初始化单词计数变量<br>wordcount=Counter()<br>#定义文件访问路径<br>pathin=r&#39;E:\\hlz\\temp\\python\\temp\\in.txt&#39;<br>with open(pathin, mode=&quot;r&quot;,encoding=&#39;utf-8&#39;) as f:<br>    for line in f:<br>        #去掉标点符号和换行符，保留单词和空格<br>        line=re.sub(r&#39;[^\\w ]&#39;,&#39;&#39;,line)<br>        #字母都转为小写<br>        line=line.lower()<br>        #生成单词表<br>        word_list=line.split(&#39; &#39;)<br>        #单词计数<br>        wordcount.update(word_list)<br>#显示数据<br>print(&#39;wordcount={}&#39;.format(wordcount))","like_count":0},{"had_liked":false,"id":97231,"user_name":"........","can_delete":false,"product_type":"c1","uid":1236198,"ip_address":"","ucode":"D54E7F428E7F49","user_header":"https://static001.geekbang.org/account/avatar/00/12/dc/e6/ea4b2c10.jpg","comment_is_top":false,"comment_ctime":1558615817,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558615817","product_id":100026901,"comment_content":"2. <br>server.py 用于读取本地数据，写入网盘，达到5G后，暂停，等待client端的消息<br>client.py 读取网盘数据，写入本地，删除数据，完成后，向server.py发送消息","like_count":0},{"had_liked":false,"id":97221,"user_name":"春之绿野","can_delete":false,"product_type":"c1","uid":1057216,"ip_address":"","ucode":"296003F7D2B086","user_header":"https://static001.geekbang.org/account/avatar/00/10/21/c0/38816c31.jpg","comment_is_top":false,"comment_ctime":1558614590,"is_pvip":false,"replies":[{"id":"34771","content":"谢谢回复，代码为了精简和清晰并没有加上错误处理，我们会在随后的章节详解编程规范和错误处理。","user_name":"作者回复","user_name_real":"高山流水","uid":"1513504","ctime":1558631260,"ip_address":"","comment_id":97221,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1558614590","product_id":100026901,"comment_content":"老师，我看你的示例代码中也没有错误处理啊？","like_count":0,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"高山流水","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451184,"discussion_content":"谢谢回复，代码为了精简和清晰并没有加上错误处理，我们会在随后的章节详解编程规范和错误处理。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558631260,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":97208,"user_name":"小胖","can_delete":false,"product_type":"c1","uid":1022958,"ip_address":"","ucode":"1B8D884D254070","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9b/ee/8950c240.jpg","comment_is_top":false,"comment_ctime":1558611045,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558611045","product_id":100026901,"comment_content":"#--*-- coding:utf-8 --*--<br>import re<br><br># 你不用太关心这个函数<br>def parse(text):<br>    # 使用正则表达式去除标点符号和换行符<br>    text = re.sub(r&#39;[^\\w ]&#39;, &#39;&#39;, text)<br><br>    # 转为小写<br>    text = text.lower()<br>    <br>    # 生成所有单词的列表<br>    word_list = text.split(&#39; &#39;)<br>    <br>    # 去除空白单词<br>    word_list = filter(None, word_list)<br>    <br>    # 生成单词和词频的字典<br>    word_cnt = dict()<br>    for word in word_list:<br>        if word not in word_cnt:<br>            word_cnt[word] = 0<br>        word_cnt[word] += 1<br>    return word_cnt<br><br>total_word_cnt_dict = dict()<br><br>with open(&#39;in2.txt&#39;, &#39;r&#39;) as fin:<br>    one_read_lines_count = 1000<br>    while True:<br>        mutil_lines = &quot;&quot;<br>        count = 1<br>        while count % one_read_lines_count != 0:<br>            one_line = fin.readline()<br>            if not one_line:<br>                break<br>            mutil_lines += one_line + &quot; &quot;<br>            count += 1<br><br>        if mutil_lines:<br>            word_cnt_dict = parse(mutil_lines)<br>            for word in word_cnt_dict.keys():<br>                if word not in total_word_cnt_dict:<br>                    total_word_cnt_dict[word] = 0<br>                total_word_cnt_dict[word] += word_cnt_dict[word]<br><br>        else:<br>            break<br><br>total_sorted_word_cnt = sorted(total_word_cnt_dict.items(), key=lambda kv: kv[1], reverse=True)<br><br>with open(&#39;out2.txt&#39;, &#39;w&#39;) as fout:<br>    for word, freq in total_sorted_word_cnt:<br>        fout.write(&#39;{} {}\\n&#39;.format(word, freq))<br><br>","like_count":0},{"had_liked":false,"id":97159,"user_name":"yshan","can_delete":false,"product_type":"c1","uid":1136788,"ip_address":"","ucode":"A2ECDCDA52B8EE","user_header":"https://static001.geekbang.org/account/avatar/00/11/58/94/c8bc2b59.jpg","comment_is_top":false,"comment_ctime":1558599406,"is_pvip":false,"replies":[{"id":"34772","content":"加油💪","user_name":"作者回复","user_name_real":"高山流水","uid":"1513504","ctime":1558631276,"ip_address":"","comment_id":97159,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1558599406","product_id":100026901,"comment_content":"继续打开，继续学习","like_count":0,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"高山流水","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451159,"discussion_content":"加油💪","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558631276,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":97153,"user_name":"catshitfive","can_delete":false,"product_type":"c1","uid":1542973,"ip_address":"","ucode":"E030B61F3D0811","user_header":"https://static001.geekbang.org/account/avatar/00/17/8b/3d/2a3b67f8.jpg","comment_is_top":false,"comment_ctime":1558598553,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558598553","product_id":100026901,"comment_content":"第一题：<br>def simple_nlp(local_path):<br>    dd=defaultdict(int)<br>    with open(local_path,&#39;r&#39;,encoding=&#39;utf8&#39;) as fin:<br>        while True:<br>            sentence=fin.readline()<br>            if sentence:<br>                sentence=re.sub(&#39;[^\\w ]&#39;,&#39;&#39;,sentence).lower()<br>                for word in sentence.split(&#39; &#39;):<br>                    dd[word]+=1<br>            else:<br>                break<br>    return sorted(dd.items(),key=lambda x:x[1],reverse=True)<br>result=simple_nlp(&#39;I had a dream.txt&#39;)<br>print(result)<br><br>第二题 fork 老师github code (#^.^#)！","like_count":0},{"had_liked":false,"id":97121,"user_name":"夜行","can_delete":false,"product_type":"c1","uid":1536143,"ip_address":"","ucode":"6EC8A7E044D70F","user_header":"https://static001.geekbang.org/account/avatar/00/17/70/8f/7a70d10f.jpg","comment_is_top":false,"comment_ctime":1558591879,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558591879","product_id":100026901,"comment_content":"welcome_str = &#39;Welcome to the matrix {prefix} {name}.&#39;<br>welcome_dic = {<br>    &#39;prefix&#39;: &#39;Mr.&#39;,<br>    &#39;name&#39;: &quot;jack&quot;<br>}<br><br>print(&#39;authorizing...&#39;)<br>print(**welcome_dic)<br>print(welcome_str.format(**welcome_dic))<br>请问一下，这个**welcome_dic这个参数为啥可以这样用","like_count":0},{"had_liked":false,"id":97100,"user_name":"李昂纳多.奥斯特洛夫斯基","can_delete":false,"product_type":"c1","uid":1445486,"ip_address":"","ucode":"3E2B76117ABBAB","user_header":"https://static001.geekbang.org/account/avatar/00/16/0e/6e/3d3661c3.jpg","comment_is_top":false,"comment_ctime":1558588280,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558588280","product_id":100026901,"comment_content":"import re<br>from collections import Counter<br>with open(r&#39;d:&#47;tmp&#47;ini.txt&#39;) as f:<br>    l=sum((Counter(re.split(r&#39;[^\\w\\&#39;]+&#39;,line.strip().lower())) for line in f),Counter())<br>print(l)","like_count":0},{"had_liked":false,"id":97097,"user_name":"李昂纳多.奥斯特洛夫斯基","can_delete":false,"product_type":"c1","uid":1445486,"ip_address":"","ucode":"3E2B76117ABBAB","user_header":"https://static001.geekbang.org/account/avatar/00/16/0e/6e/3d3661c3.jpg","comment_is_top":false,"comment_ctime":1558587158,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558587158","product_id":100026901,"comment_content":"import re<br>from collections import Counter<br>l=Counter()<br>with open(r&#39;d:&#47;tmp&#47;ini.txt&#39;) as f:<br>    for line in f:<br>        l+=Counter(re.split(r&#39;[^\\w\\&#39;]+&#39;,line.strip().lower()))<br>print(l)","like_count":0},{"had_liked":false,"id":97037,"user_name":"夜月不挂科","can_delete":false,"product_type":"c1","uid":1543651,"ip_address":"","ucode":"9D358B176E5CA9","user_header":"https://static001.geekbang.org/account/avatar/00/17/8d/e3/c3ed083a.jpg","comment_is_top":false,"comment_ctime":1558575205,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558575205","product_id":100026901,"comment_content":"class CountParse(object):<br>    def __init__(self, file_name, str_type=&#39;\\n&#39;, read_size=20, out_name=&#39;out.txt&#39;, pattern=r&#39;[^\\w ]&#39;):<br>        &quot;&quot;&quot;<br>        :param file_name: 读取文件的名称<br>        :param str_type: 分割的特殊字符<br>        :param file_type: 打开文件的方式<br>        :param out_name: 输出文件的名称<br>        :param out_type: 输出文件的方式<br>        :param pattern: 替换规则<br>        :param read_size: 读取文件的大小<br>        &quot;&quot;&quot;<br>        self.file_name = file_name<br>        self.str_type = str_type<br>        self.file_type = &#39;rb&#39;<br>        self.out_name = out_name<br>        self.out_type = &#39;w&#39;<br>        self.pattern = pattern<br>        self.read_size = read_size<br><br>    def __readlines(self, f, total_size):<br>        buf = &#39;&#39;<br>        size = 0<br>        while True:<br>            while self.str_type in buf:<br>                pos = buf.index(self.str_type)<br>                yield buf[:pos]<br>                buf = buf[pos + len(self.str_type):]<br>            chunk = str(f.read(self.read_size), encoding=&#39;utf8&#39;, errors=&#39;ignore&#39;)<br>            size += self.read_size<br>            sys.stdout.write(&#39;\\r&#39; + &#39;{}{}%&#39;.format(&#39;#&#39; * (100 * size &#47;&#47; total_size), 100 * size &#47;&#47; total_size))<br>            sys.stdout.flush()<br>            if not chunk:<br>                yield buf<br>                break<br>            buf += chunk<br><br>    def parse(self):<br>        count = Counter()<br>        total_size = os.path.getsize(self.file_name)<br>        print(&#39;开始读取文件-{}&#39;.format(self.file_name))<br>        with open(self.file_name, self.file_type) as f:<br>            for line in self.__readlines(f, total_size):<br>                <br>                count.update(Counter(filter(None, re.sub(self.pattern, &#39; &#39;, line).lower().split(&#39; &#39;))))<br>        print(&#39;\\n读取完成&#39;)<br>        print(&#39;开始保存文件-{}&#39;.format(self.out_name))<br>        with open(self.out_name, self.out_type, encoding=&#39;utf-8&#39;) as f:<br>            for key, value in sorted(count.items(), key=lambda x: x[1], reverse=True):<br>                # print(key, value)<br>                f.write(&#39;{key}:{value}\\n&#39;.format(key=key, value=value))<br>        print(&#39;完成&#39;)<br>        return","like_count":0},{"had_liked":false,"id":97005,"user_name":"江","can_delete":false,"product_type":"c1","uid":1543726,"ip_address":"","ucode":"7A5378A036ABAF","user_header":"https://static001.geekbang.org/account/avatar/00/17/8e/2e/3910a53f.jpg","comment_is_top":false,"comment_ctime":1558572058,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558572058","product_id":100026901,"comment_content":"快快更新","like_count":0},{"had_liked":false,"id":96934,"user_name":"吃虫子的橙","can_delete":false,"product_type":"c1","uid":1541131,"ip_address":"","ucode":"E3D8F24E589DD2","user_header":"https://static001.geekbang.org/account/avatar/00/17/84/0b/ebcc656d.jpg","comment_is_top":false,"comment_ctime":1558538329,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558538329","product_id":100026901,"comment_content":"如果文件过大，那么一次性读取太耗费时间和内存，是不是应该用Generator Expression来按需读取好点？读取固定长度处理完继续读取，至于边界暂时想不出好办法，如果按行来算的话最简单，如果是单行我能想到的也只有按空格或者标点来判断，或者直接按照rstrip分割最后个空格，然后多出来的字用join或者+和下一次要处理的字符连接起来。<br>","like_count":0},{"had_liked":false,"id":96907,"user_name":"健身咸鱼","can_delete":false,"product_type":"c1","uid":1528176,"ip_address":"","ucode":"415CBFF3F158F3","user_header":"https://static001.geekbang.org/account/avatar/00/17/51/70/68b3f0e6.jpg","comment_is_top":false,"comment_ctime":1558533456,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558533456","product_id":100026901,"comment_content":"第二问<br><br>在家中的 server.py 文件我想主要的作用就是根据网盘账号, 来检测本地电脑中所要上传的文件并设置上传的文件大小不超过 5GB, 上传完成后暂停上传, 在上传结束后, client.py 文件一直检测上传的文件并且当文件达到一定的大小(5GB) 就根据账号下载文件, 下载文件后停止运行 client.py, 然后 server.py 文件何 client.py 文件再继续工作直到所有文件全部上传和下载完成后, 结束运行.<br><br>初学, 胡写的思路[捂脸]","like_count":0},{"had_liked":false,"id":96903,"user_name":"Geek_e918c5","can_delete":false,"product_type":"c1","uid":1526679,"ip_address":"","ucode":"6A1D1DF95A7E82","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/B5HfJCJtA2DGiadcJ8cia5uX3RHspWicydljOicTEPK4XpqVbEOCRwEZYCQxRCltricn8KefNPKQXrgs3A3VXe2GLUw/132","comment_is_top":false,"comment_ctime":1558532460,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558532460","product_id":100026901,"comment_content":"有两个小问题希望老师回复下<br>1.按照词频排序那里，key=lambda kv: kv[1],这里的kv怎么能确定是word_cnt的每一个键值对呢？默认的吗？<br>2.for word,freq in word_and_freq:字典里好像不支持这种键和值的输出啊，但我运行整个代码又没问题。","like_count":0},{"had_liked":false,"id":96849,"user_name":"潘会大","can_delete":false,"product_type":"c1","uid":1015004,"ip_address":"","ucode":"41085C621B8BEF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7c/dc/d9fa47b1.jpg","comment_is_top":false,"comment_ctime":1558520569,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1558520569","product_id":100026901,"comment_content":"老师，为什么 ” text = re.sub(r&#39;[^\\w ]&#39; “ 中 ”\\w“ 后面要加上空格啊，查了正则表达式的用法，&quot;[]&quot;中”^“ 是取”非“，如果加空格，则匹配到非空字符，但代码实际运行的结果是对的，有些不解，请指点。谢谢！","like_count":0,"discussions":[{"author":{"id":2027617,"avatar":"","nickname":"Geek_e2c610","note":"","ucode":"A4E4FF065EB966","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283287,"discussion_content":"避免重复替换空格","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1592230476,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1316364,"avatar":"https://static001.geekbang.org/account/avatar/00/14/16/0c/fa62ffdd.jpg","nickname":"xu","note":"","ucode":"2CF44446E085AC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332687,"discussion_content":"sub函数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607310816,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96841,"user_name":"Lone","can_delete":false,"product_type":"c1","uid":1543230,"ip_address":"","ucode":"7EDE7F9407F1BF","user_header":"https://static001.geekbang.org/account/avatar/00/17/8c/3e/b4ae5ae2.jpg","comment_is_top":false,"comment_ctime":1558517890,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558517890","product_id":100026901,"comment_content":"@lmingzhi 修订后<br>with open(&#39;in.txt&#39;, &#39;r&#39;) as fin:<br>    for text in fin.readline():<br>        word_cnt = parse(text, word_cnt)<br>只会读取文件的一行内容并且会将word拆分<br>应该改为：<br>with open(&quot;.&#47;in.txt&quot;, &quot;r&quot;) as fin:<br>    while True:<br>        line = fin.readline()<br>        if not line:<br>            break<br>        word_cnt = parse(line, word_cnt)<br><br>并且没有处理单词跨行场景","like_count":0},{"had_liked":false,"id":96824,"user_name":"易拉罐","can_delete":false,"product_type":"c1","uid":1525624,"ip_address":"","ucode":"56B05C4F621B3F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epEbrWwrlSUzSxBXV401OuYGL4yveAly9ib4licXb9yqoBFIYGicqJKrzGr8iaianLZo8ZPx7X4eAltM4g/132","comment_is_top":false,"comment_ctime":1558515950,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558515950","product_id":100026901,"comment_content":"for word in words_list:<br>            if word not in words_cnt:<br>                words_cnt[word] = 0<br>            words_cnt[word] += 1<br><br>大佬, 这里如果word不在words_cnt里面这里是不是应该赋值1, 而不是0, ???","like_count":0},{"had_liked":false,"id":96821,"user_name":"Lee","can_delete":false,"product_type":"c1","uid":1313515,"ip_address":"","ucode":"ED3D7200A948C3","user_header":"https://static001.geekbang.org/account/avatar/00/14/0a/eb/6d6a94d2.jpg","comment_is_top":false,"comment_ctime":1558515844,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558515844","product_id":100026901,"comment_content":"只想到用pandas读取，有个chunksize参数","like_count":0},{"had_liked":false,"id":96807,"user_name":"trrwxsy","can_delete":false,"product_type":"c1","uid":1524434,"ip_address":"","ucode":"2D072DB540EEE2","user_header":"https://static001.geekbang.org/account/avatar/00/17/42/d2/770edda2.jpg","comment_is_top":false,"comment_ctime":1558511972,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558511972","product_id":100026901,"comment_content":"第一个：<br>import re<br><br>def parse_txt(infile, outfile):<br>    word_cn_dt = {}<br>    try:<br>        fin = open(infile, &#39;r&#39;)<br>        for line in fin.readlines():<br>            if line == &#39;\\n&#39;:<br>                continue<br>            line_text = re.sub(r&#39;[^\\w ]&#39;, &#39;&#39;, line.lower())<br>            line_text = line_text.strip(&#39; &#39;)<br>            word_list = line_text.split(&#39; &#39;)<br>            for word in word_list:<br>                word_cn_dt[word] = word_cn_dt.get(word, 0) + 1<br>        word_cn_dt = sorted(word_cn_dt.items(), key=lambda kv: kv[1], reverse=True)<br>        with open(outfile, &#39;w&#39;) as fout:<br>            for word, freq in word_cn_dt:<br>                fout.write(&#39;{0} {1}\\n&#39;.format(word, freq))<br>    except Exception as ex:<br>        print(ex)<br>    finally:<br>        fin.close()<br>        <br>infile = &#39;in.txt&#39;<br>outfile = &#39;out1.txt&#39;<br><br>parse_txt(infile, outfile)","like_count":0},{"had_liked":false,"id":96748,"user_name":"干布球","can_delete":false,"product_type":"c1","uid":1218173,"ip_address":"","ucode":"048ABC199D89B9","user_header":"https://static001.geekbang.org/account/avatar/00/12/96/7d/c7e8cd34.jpg","comment_is_top":false,"comment_ctime":1558496492,"is_pvip":false,"replies":[{"id":"34629","content":"稍后会放出哦","user_name":"作者回复","user_name_real":"高山流水","uid":"1513504","ctime":1558507904,"ip_address":"","comment_id":96748,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1558496492","product_id":100026901,"comment_content":"老师的github地址是哪个呢？","like_count":0,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"高山流水","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451002,"discussion_content":"稍后会放出哦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558507904,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96747,"user_name":"林泽楷","can_delete":false,"product_type":"c1","uid":1148529,"ip_address":"","ucode":"E780B0E85EF38F","user_header":"https://static001.geekbang.org/account/avatar/00/11/86/71/52017f48.jpg","comment_is_top":false,"comment_ctime":1558496471,"is_pvip":false,"replies":[{"id":"34628","content":"汉字分词是另一个话题，也是 NLP 领域经典的问题，我们在这里就不详细多说了","user_name":"作者回复","user_name_real":"高山流水","uid":"1513504","ctime":1558507894,"ip_address":"","comment_id":96747,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1558496471","product_id":100026901,"comment_content":"如果是汉字，怎么提取词组，或者人名，或者专有名词什么的，大概思路怎样的？哪位神有想法","like_count":0,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"高山流水","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451001,"discussion_content":"汉字分词是另一个话题，也是 NLP 领域经典的问题，我们在这里就不详细多说了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558507894,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96746,"user_name":"Hurt","can_delete":false,"product_type":"c1","uid":1050946,"ip_address":"","ucode":"DCE7428CCF08EF","user_header":"https://static001.geekbang.org/account/avatar/00/10/09/42/1f762b72.jpg","comment_is_top":false,"comment_ctime":1558496389,"is_pvip":false,"replies":[{"id":"34627","content":"稍后会放出哦","user_name":"作者回复","user_name_real":"高山流水","uid":"1513504","ctime":1558507856,"ip_address":"","comment_id":96746,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1558496389","product_id":100026901,"comment_content":"github地址是多少啊","like_count":0,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"高山流水","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451000,"discussion_content":"稍后会放出哦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558507856,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96735,"user_name":"不见飞刀","can_delete":false,"product_type":"c1","uid":1221078,"ip_address":"","ucode":"2490E8D608CECA","user_header":"https://static001.geekbang.org/account/avatar/00/12/a1/d6/9d99e5ef.jpg","comment_is_top":false,"comment_ctime":1558494695,"is_pvip":false,"replies":[{"id":"34626","content":"前面说的都对，最后一句，“然后下一次就从上次去掉的最后一项那个位置开始按字数读取”，假如一个单词横跨三倍你每次读取的长度呢？你的代码会不会死循环？","user_name":"作者回复","user_name_real":"高山流水","uid":"1513504","ctime":1558507847,"ip_address":"","comment_id":96735,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1558494695","product_id":100026901,"comment_content":"我觉得一行一行读不太好<br>因为换行是会把单词分割的 <br>我觉得应该是按字数读  <br>然后spilt分割单词之间的空格 生成一个list<br>然后去掉list的最后一项  记住这一项的长度<br>用counter统计list<br>然后下一次就从上次去掉的最后一项那个位置开始按字数读取","like_count":0,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"高山流水","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450994,"discussion_content":"前面说的都对，最后一句，“然后下一次就从上次去掉的最后一项那个位置开始按字数读取”，假如一个单词横跨三倍你每次读取的长度呢？你的代码会不会死循环？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558507847,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96728,"user_name":"程序员人生","can_delete":false,"product_type":"c1","uid":1113668,"ip_address":"","ucode":"C5C5073D89AAA2","user_header":"https://static001.geekbang.org/account/avatar/00/10/fe/44/3e3040ac.jpg","comment_is_top":false,"comment_ctime":1558493555,"is_pvip":false,"replies":[{"id":"34624","content":"第二题可以避开线程的，可以再想想。","user_name":"作者回复","user_name_real":"高山流水","uid":"1513504","ctime":1558507769,"ip_address":"","comment_id":96728,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1558493555","product_id":100026901,"comment_content":"第一题，初步思路是，给read函数设定一个size，表示读取最大长度。（老师文中已提到）等一下写段代码试试<br>第二题，似乎要涉及到线程方面的内容......","like_count":0,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"高山流水","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450989,"discussion_content":"第二题可以避开线程的，可以再想想。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558507769,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96700,"user_name":"lmingzhi","can_delete":false,"product_type":"c1","uid":1014489,"ip_address":"","ucode":"72DBAF4FD184AF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7a/d9/4feb4006.jpg","comment_is_top":false,"comment_ctime":1558489222,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558489222","product_id":100026901,"comment_content":"修订~~<br>import re<br>def parse(text, word_cnt):<br>    # 转为小写<br>    text = text.lower()    <br>    # 生成所有单词的列表<br>    word_list = re.findall(r&#39;\\w+&#39;, text) <br>    # 更新单词和词频的字典<br>    for word in word_list:<br>        word_cnt[word] = word_cnt.get(word, 0) + 1<br>    return word_cnt<br><br># 初始化字典<br>word_cnt = dict()<br>with open(&#39;in.txt&#39;, &#39;r&#39;) as fin:<br>    # line.readline() 和 .readlines()之间的差异是后者一次读取整个文件，<br>    # 象 .read()一样。.readlines()自动将文件内容分析成一个行的列表，<br>    # 另一方面，.readline()每次只读取一行，通常比 .readlines()慢得多。<br>    # 仅当没有足够内存可以一次读取整个文件时，才应该使用.readline()。  <br>    for text in fin.readline():<br>        word_cnt = parse(text, word_cnt)<br>        print(len(word_cnt))<br><br># 按照词频排序<br>word_and_freq = sorted(word_cnt.items(), key=lambda kv: kv[1], reverse=True)<br><br># 导出<br>with open(&#39;out.txt&#39;, &#39;w&#39;) as fout:<br>    for word, freq in word_and_freq:<br>        fout.write(&#39;{} {}\\n&#39;.format(word, freq))","like_count":0},{"had_liked":false,"id":96628,"user_name":"Geek_212b85","can_delete":false,"product_type":"c1","uid":1000454,"ip_address":"","ucode":"2F89E94337285F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/44/06/4372fd00.jpg","comment_is_top":false,"comment_ctime":1558482047,"is_pvip":false,"replies":[{"id":"34615","content":"👍","user_name":"作者回复","user_name_real":"高山流水","uid":"1513504","ctime":1558506536,"ip_address":"","comment_id":96628,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1558482047","product_id":100026901,"comment_content":"打卡，初学者","like_count":0,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"高山流水","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450941,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558506536,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}