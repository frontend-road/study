{"id":463560,"title":"21 | å‹æµ‹å¹³å°ï¼šé«˜æ•ˆæ­å»º GoReplay å‹æµ‹å¹³å°","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é«˜æ¥¼ã€‚</p><p>ä»è¿™é‡Œå¼€å§‹ï¼Œæˆ‘ä»¬å°±è¿›å…¥å…¨é“¾è·¯å‹æµ‹çš„ç¬¬ä¸‰éƒ¨åˆ†â€œå®è·µç¯å¢ƒâ€äº†ã€‚</p><p>åœ¨æ¥ä¸‹æ¥çš„ä¸‰è®²ï¼Œæˆ‘ä¼šè¯¦ç»†è®²è®²å¦‚ä½•æ­å»ºå‹æµ‹å¹³å°ã€‚è¦æ­å»ºå‹æµ‹å¹³å°ï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬å°±è¦é€‰æ‹©ä¸€æ¬¾é€‚åˆè‡ªå·±é¡¹ç›®çš„æµé‡å·¥å…·ã€‚åœ¨ç¬¬ 6 è®²ï¼Œæˆ‘ä»¬å·²ç»è¯¦ç»†äº†è§£äº†æµé‡å·¥å…·çš„é€‰å‹ã€‚ç»¼åˆå¯¹æ¯”è¯„ä¼°åï¼Œæœ€åæˆ‘ä»¬è¿™ä¸ªé¡¹ç›®é€‰æ‹©äº†è€ç‰Œæµé‡å›æ”¾å·¥å…· GoReplayï¼Œå› ä¸ºå®ƒç®€å•ã€è½»é‡ã€çƒ­åº¦å¤Ÿï¼Œè€Œä¸”å®Œå…¨èƒ½æ»¡è¶³æˆ‘ä»¬ç›®å‰é¡¹ç›®çš„è¦æ±‚ã€‚</p><p>æ‰€ä»¥è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°±æ¥èŠä¸€èŠæ€æ ·æ­å»º GoReplay å‹æµ‹å¹³å°ã€‚å¦‚æœä½ å¯¹GoReplayéå¸¸ç†Ÿæ‚‰ï¼Œé‚£å¯ä»¥è·³è¿‡ä¸‹é¢çš„æ¦‚å¿µè®²è§£ï¼Œå¦‚æœä½ ä¹‹å‰æ²¡æœ‰æ¥è§¦è¿‡ GoReplayï¼Œå¯ä»¥è·Ÿç€æˆ‘ä¸€èµ·å…ˆå¤§æ¦‚äº†è§£ä¸‹è¿™ä¸ªå·¥å…·ã€‚</p><h2>GoReplay æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p><a href=\"https://github.com/buger/goreplay\">GoReplay</a> çš„ç®€ç§°æ˜¯ Gorï¼Œå®ƒæ˜¯ä¸€ä¸ªç®€å•çš„ TCP/HTTP æµé‡å½•åˆ¶å’Œå›æ”¾çš„å·¥å…·ï¼Œä¸»è¦ç”¨ Golang è¯­è¨€ç¼–å†™ã€‚</p><p>GoReplay çš„<a href=\"https://github.com/buger/goreplay\">å·¥ä½œåŸç†å›¾</a>å¯ä»¥å‚è€ƒä¸‹é¢è¿™å¼ ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/3e/55/3e135a37319e7e926f1ac2d410ea1b55.jpg?wh=1082x663\" alt=\"å›¾ç‰‡\"></p><p>GoReplay å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šå¯åŠ¨ä¸€ä¸ª Gor è¿›ç¨‹ï¼Œå®ƒè´Ÿè´£çš„å·¥ä½œåŒ…æ‹¬<strong>ç›‘å¬ã€è¿‡æ»¤ã€è½¬å‘ã€å›æ”¾</strong>ç­‰ã€‚é€šè¿‡ç›‘å¬ç½‘å¡ï¼Œå®ƒå¯ä»¥ç›´æ¥å½•åˆ¶è¯·æ±‚ã€‚åç»­å®ƒè¿˜æ”¯æŒå®ç°<strong>æµé‡å›æ”¾ã€å‹åŠ›æµ‹è¯•ã€æ€§èƒ½ç›‘æ§</strong>ç­‰åŠŸèƒ½ã€‚</p><p>å¦‚æœæˆ‘ä»¬ç®€åŒ–ä¸€ä¸‹æ ¸å¿ƒæµç¨‹å›¾ï¼Œå®ƒä¼šæ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/c4/99/c4eb7cb7c07de1f45212e45bf4897099.jpg?wh=1920x773\" alt=\"å›¾ç‰‡\"></p><p>GoReplay ä»æ•°æ®æµä¸­æŠ½è±¡å‡ºäº†ä¸¤ä¸ªæ¦‚å¿µï¼Œå³<strong>è¾“å…¥ï¼ˆInputï¼‰<strong>å’Œ</strong>è¾“å‡ºï¼ˆOutput ï¼‰</strong>ï¼Œå®ƒç”¨è¿™ä¸¤ä¸ªæ¦‚å¿µæ¥è¡¨ç¤ºæ•°æ®æ¥æºä¸å»å‘ï¼Œç»Ÿç§°ä¸º Pluginã€‚</p><!-- [[[read_end]]] --><p>GoReplay ç”¨ä»‹äºè¾“å…¥å’Œè¾“å‡ºæ¨¡å—ä¹‹é—´çš„ Middlewareï¼ˆä¸­é—´ä»¶ï¼‰å®ç°æ‹“å±•æœºåˆ¶ï¼Œè€Œ Emitter åˆ™æ˜¯æ ¸å¿ƒå¤„ç†å™¨ï¼Œå®ç°å¯¹äº Input è¾“å…¥æµçš„è¯»å–ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦éœ€è¦è¿›è¡Œ Middleware çš„å¤„ç†ã€è¯·æ±‚ä¿®æ”¹ç­‰ã€‚å®Œæˆè¿™ä¸€æ­¥åï¼ŒEmitterä¼šå¼‚æ­¥å¤åˆ¶æµé‡åˆ°æ‰€æœ‰ Outputï¼ŒåŒæ—¶å°†æ‰€æœ‰ Output  ä¸­æœ‰ Response çš„æ•°æ®å¤åˆ¶åˆ°æ‰€æœ‰ Outputs ä¸­ã€‚</p><h2>Golang ç¯å¢ƒå®‰è£…</h2><p>å¥½äº†ï¼Œç†æ¸… GoReplay çš„å·¥ä½œåŸç†ä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹Golangçš„ç¯å¢ƒå®‰è£…ã€‚åªæœ‰å®‰è£…å¥½Golangæ‰èƒ½è¿è¡Œ GoReplayã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œå®‰è£… Golang åŠç›¸å…³ä¾èµ–ç¯å¢ƒï¼Œä½ å¯ä»¥åœ¨<a href=\"https://golang.org/dl\">å®˜ç½‘</a>æˆ–è€… Go çš„ä¸€äº›<a href=\"https://studygolang.com/dl\">ä¸­æ–‡ç½‘ç«™</a>ä¸Šä¸‹è½½å®‰è£…åŒ…ã€‚</p><p>æˆ‘è¿™é‡Œä¸‹è½½çš„æ˜¯: go1.15.5.linux-amd64.tar.gzã€‚</p><p>ç¬¬äºŒæ­¥ï¼Œè§£å‹åˆ°æœåŠ¡å™¨ /usr/local ç›®å½•ä¸‹ã€‚</p><pre><code class=\"language-bash\">rm -rf /usr/local/go &amp;&amp; tar -C /usr/local -xzf go1.15.5.linux-amd64.tar.gz\n</code></pre><p>ç¬¬ä¸‰æ­¥ï¼Œé…ç½®ç¯å¢ƒå˜é‡ã€‚</p><pre><code class=\"language-bash\"># æ‰“å¼€\nvim /etc/profile\n\n# æ·»åŠ \nexport GOROOT=/usr/local/go\nexport PATH=$PATH:$GOROOT/bin\n\n# ç¼–è¯‘ç”Ÿæ•ˆ\nsource /etc/profile\n</code></pre><p>æœ€åï¼Œæˆ‘ä»¬éªŒè¯ Golang ç¯å¢ƒæ˜¯å¦ç”Ÿæ•ˆã€‚</p><pre><code class=\"language-bash\">[root@vm ~]# go version\ngo version go1.15.5 linux/amd64\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œç‰ˆæœ¬å·²ç»æ˜¾ç¤ºæˆåŠŸäº†ï¼Œè¿™è¯´æ˜æˆ‘ä»¬çš„ç¯å¢ƒå·²ç»å®‰è£…æˆåŠŸäº†ã€‚</p><h2>GoReplay å®‰è£…</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å®‰è£…GoReplayã€‚åœ¨æˆ‘ä»¬è¿™ä¸ªé¡¹ç›®ä¸­ï¼Œå› ä¸ºè¦åœ¨ç½‘å…³æœåŠ¡ä¸Šå½•åˆ¶æµé‡ï¼Œæ‰€ä»¥éœ€è¦åœ¨ç½‘å…³å®¹å™¨å†…å®‰è£…GoReplayã€‚</p><p>æˆ‘ä»¬ä» <a href=\"https://github.com/buger/gor/releases\">https://github.com/buger/gor/releases</a> ä¸‹è½½ Gor äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæä¾› Windowsã€Linux x64 å’Œ macOS çš„é¢„ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶ï¼‰ï¼Œä¹Ÿå¯ä»¥è‡ªå·±æºç <a href=\"https://github.com/buger/goreplay/wiki/Compilation\">ç¼–è¯‘</a>å®‰è£…ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/06/76/069e2b52cae0e28f2d7140f2636b5a76.png?wh=1258x701\" alt=\"å›¾ç‰‡\"></p><p>è¿™é‡Œï¼Œæˆ‘ç®€å•æ¼”ç¤ºä¸€ä¸‹å¦‚ä½•é€šè¿‡ curl ä¸‹è½½äºŒè¿›åˆ¶åŒ…ã€‚</p><pre><code class=\"language-bash\">$ curl -L -O https://github.com/buger/goreplay/releases/download/v1.3.1/gor_1.3.1_x64.tar.gz\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n                                 Dload  Upload   Total   Spent    Left  Speed\n100   626  100   626    0     0    741      0 --:--:-- --:--:-- --:--:--   741\n100 10.5M  100 10.5M    0     0  3258k      0  0:00:03  0:00:03 --:--:-- 5951k\n\n$ tar xvzf gor_1.3.1_x64.tar.gz \ngor\n</code></pre><p>è§£å‹ç¼©åŒ…åï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä»å½“å‰ç›®å½•è¿è¡Œ Gor äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæˆ–è€…æ›´æ–¹ä¾¿çš„æ˜¯å°†äºŒè¿›åˆ¶æ–‡ä»¶å¤åˆ¶åˆ°ç³»ç»Ÿçš„ PATHï¼ˆå¯¹äº Linux å’Œ macOSï¼Œå®ƒå¯ä»¥æ˜¯ /usr/local/binï¼‰ä¸­ã€‚</p><p>åŒæ—¶æˆ‘ä»¬ä¹Ÿè¦è®°å¾—å®‰è£…æŠ“åŒ…å·¥å…· libpcapï¼š</p><pre><code class=\"language-bash\">yum install libpcap libpcap-devel\n</code></pre><p>è¿™é‡Œæˆ‘æ¼”ç¤ºçš„æ˜¯ yum å®‰è£…æ–¹å¼ã€‚</p><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ Gor å‘½ä»¤è¿›è¡Œå„ç§æ“ä½œäº†ã€‚</p><p>åœ¨æ­£å¼ä»‹ç»æµé‡å½•åˆ¶å’Œæµé‡å›æ”¾çš„é€»è¾‘ä¹‹å‰ï¼Œæˆ‘è¿˜æƒ³å¸¦ä½ ç†Ÿæ‚‰ä¸€ä¸‹ GoReplay å¸¸ç”¨çš„å‚æ•°ã€‚å¸‚é¢ä¸Šå¯¹è¿™äº›å¸¸ç”¨å‚æ•°çš„ä»‹ç»ï¼Œæ¯”è¾ƒé½å…¨çš„ä¸å¤šï¼Œæ‰€ä»¥æˆ‘åœ¨è¿™é‡Œåšä¸ªæ€»ç»“ã€‚</p><p>è¿™é‡Œæˆ‘æŒ‰ç…§ä½¿ç”¨ç±»å‹åˆ’åˆ†ï¼Œæ•´ç†äº†å¸¸ç”¨çš„å‚æ•°ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/db/03/db66558ace720aa61c42ccfa0c41a103.jpg?wh=1920x906\" alt=\"å›¾ç‰‡\"></p><p>å…¶ä¸­æ ‡æ˜Ÿçš„å‚æ•°æ˜¯å‹æµ‹ä¸­çš„å¿…é€‰é¡¹ã€‚</p><p>å¥½äº†ï¼ŒçŸ¥é“äº†å¸¸ç”¨çš„å‚æ•°ï¼Œç‰¹åˆ«æ˜¯åœ¨å‹æµ‹ä¸­å¿…ç„¶ä¼šç”¨åˆ°çš„å‚æ•°ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±çœ‹ä¸‹å¦‚ä½•åœ¨å…·ä½“é¡¹ç›®ä¸­ä½¿ç”¨ã€‚</p><h2>æµé‡å½•åˆ¶</h2><p>æˆ‘ä»¬çŸ¥é“æµé‡å½•åˆ¶å·¥å…·çš„æ ¸å¿ƒåŸç†å°±æ˜¯å°†çº¿ä¸Šé›†ç¾¤ç¯å¢ƒçš„æµé‡å¤åˆ¶å¤šä»½å‘é€åˆ°æŒ‡å®šçš„ä»“åº“ï¼Œç„¶åä½¿ç”¨æŒ‡å®šå‹åŠ›æœºå™¨è¿›è¡Œæ”¾å¤§å›æ”¾ä»¥è¾¾åˆ°å‹åŠ›æµ‹è¯•çš„ç›®çš„ã€‚</p><p>é‚£ä¹ˆ GoReplay æ˜¯å¦‚ä½•å®ç°æµé‡å¤åˆ¶çš„å‘¢ï¼Ÿ</p><ul>\n<li>æ ¸å¿ƒåŸç†</li>\n</ul><p>ä½ å¯ä»¥å…ˆæ¥çœ‹ä¸‹è¿™å¼  GoReplay çš„å½•åˆ¶åŸç†å›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/06/ac/069f66babeb0614f7dfa6f8e99b35bac.jpg?wh=1696x1353\" alt=\"å›¾ç‰‡\"></p><p>GoReplay é€šè¿‡è°ƒç”¨ <a href=\"https://link.zhihu.com/?target=https%3A//github.com/google/gopacket\">Google/gopacket</a> æ¥å®ç°æŠ“åŒ…ï¼Œè¿™é‡Œçš„ gopacket æ˜¯åŸºäº libpcap åº“çš„ã€‚GoReplay å¯ä»¥åšåˆ°æ•æ‰æŒ‡å®šç«¯å£çš„ç½‘å¡æµé‡ï¼Œå®ƒæ—¢å¯ä»¥å®ç° TCP åè®®ï¼ˆRAW_SOCKETï¼‰çš„æŠ“åŒ…ï¼Œä¹Ÿå¯ä»¥å®ç° HTTP çš„å½•åˆ¶ã€å›æ”¾ï¼ŒåŒæ—¶è¿˜æ”¯æŒå¤šå®ä¾‹ä¹‹é—´çš„çº§è”ã€‚</p><p>å½•åˆ¶çš„æ—¶å€™ï¼Œæ¯ä¸ª TCP åŒ…è¢«æŠ½è±¡ä¸º packetã€‚å½“æ•°æ®é‡è¾ƒå¤§ã€æ•°æ®éœ€è¦è¢«åˆ†æ‹†æˆå¤šä¸ªåŒ…å‘é€æ—¶ï¼Œæ¥æ”¶ç«¯éœ€è¦æŠŠè¿™äº›åŒ…æŒ‰é¡ºåºç»„åˆèµ·æ¥ï¼ŒåŒæ—¶è¿˜è¦å¤„ç†ä¹±åºã€é‡å¤ç­‰é—®é¢˜ï¼Œä¿è¯å‘ä¸‹ä¼ é€’çš„æ˜¯ä¸€ä¸ªå®Œæ•´æ— è¯¯çš„æ•°æ®åŒ…ã€‚è¿™äº›é€»è¾‘ç»Ÿå°è£…åœ¨äº† tcp_message ä¸­ï¼Œtcp_message ä¸ packet æ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ã€‚åç»­ä¼šå°† tcp_message ä¸­çš„æ•°æ®å–å‡ºï¼Œæ‰“ä¸Šæ ‡è®°ï¼Œä¼ é€’ç»™ä¸­é—´ä»¶ï¼ˆå¦‚æœæœ‰ï¼‰æˆ–è€…æ˜¯ Output æ’ä»¶ã€‚</p><p>è¦åšåˆ°è¿™äº›ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹GoReplay åŸºäº libpcap åº“çš„æ ¸å¿ƒå‡½æ•°ã€‚</p><p>é¦–å…ˆï¼ŒGoReplay çš„ <a href=\"https://github.com/buger/goreplay/blob/master/capture/capture.go\">capture.go </a>ç±»ä¸­å®šä¹‰äº† pcap å¤„ç†å¼•æ“å‡½æ•°ï¼š</p><pre><code class=\"language-go\">func (l *Listener) activatePcap() error {\n\tvar e error\n\tvar msg string\n\tfor _, ifi := range l.Interfaces {\n\t\tvar handle *pcap.Handle\n\t\thandle, e = l.PcapHandle(ifi)\n\t\tif e != nil {\n\t\t\tmsg += (\"\\n\" + e.Error())\n\t\t\tcontinue\n\t\t}\n\t\tl.Handles[ifi.Name] = packetHandle{\n\t\t\thandler: handle,\n\t\t\tips:     interfaceIPs(ifi),\n\t\t}\n\t}\n\tif len(l.Handles) == 0 {\n\t\treturn fmt.Errorf(\"pcap handles error:%s\", msg)\n\t}\n\treturn nil\n}\n</code></pre><p><a href=\"https://github.com/buger/goreplay/blob/master/capture/capture.go\">capture.go </a>ç±»æè¿°çš„å‡ ç§å¼•æ“åŒ…æ‹¬ libpcapã€pcap_fileã€raw_socket ç­‰ï¼š</p><pre><code class=\"language-go\">// Set is here so that EngineType can implement flag.Var\nfunc (eng *EngineType) Set(v string) error {\n\tswitch v {\n\tcase \"\", \"libpcap\":\n\t\t*eng = EnginePcap\n\tcase \"pcap_file\":\n\t\t*eng = EnginePcapFile\n\tcase \"raw_socket\":\n\t\t*eng = EngineRawSocket\n\tcase \"af_packet\":\n\t\t*eng = EngineAFPacket\n\tdefault:\n\t\treturn fmt.Errorf(\"invalid engine %s\", v)\n\t}\n\treturn nil\n}\n</code></pre><p>å¥½äº†ï¼ŒçŸ¥é“äº†å½•åˆ¶çš„åŸç†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹ä¸‹å¦‚ä½•åœ¨å…·ä½“é¡¹ç›®ä¸­åšå½•åˆ¶ã€‚</p><ul>\n<li>å½•åˆ¶å®ä¾‹</li>\n</ul><p>è¿™é‡Œæˆ‘ä»¬æ¼”ç¤ºçš„ä¾‹å­æ˜¯é™¤å¥åº·æ£€æŸ¥ï¼ˆ/actuator/healthï¼‰ä¹‹å¤–ï¼Œå½•åˆ¶ç½‘å…³æœåŠ¡çš„æ‰€æœ‰æ¥å£è¯·æ±‚ã€‚</p><p>å½•åˆ¶é€»è¾‘å›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/4b/e6/4b2edec5d0116eb2b365bf8a9cbd56e6.jpg?wh=1888x344\" alt=\"å›¾ç‰‡\"></p><p>æˆ‘ä»¬ä¸»è¦ä¼šä½¿ç”¨ä¸‹é¢è¿™äº›å‘½ä»¤ï¼š</p><pre><code class=\"language-bash\"># --input-rawï¼šæ•è·æŒ‡å®šç«¯å£ HTTP æµé‡\n# --output-fileï¼šå°†è·å–çš„æµé‡è®°å½•ä¿å­˜åˆ°æ–‡ä»¶\n# -output-file-appendï¼šå•ç‹¬æ–‡ä»¶ Append å­˜å‚¨\n# --http-set-headerï¼šä¸ºè¯·æ±‚æ·»åŠ  header ä¿¡æ¯\n# --input-raw-track-responseï¼šæ”¶é›†è¿”å›ç»“æœ\n# --prettify-httpï¼šè‡ªåŠ¨è§£ç  Content-Encoding:gzip å’Œ Transfer-Encoding:chunked çš„è¯·æ±‚å’Œå“åº” \n# --http-disallow-urlï¼šä¸å…è®¸æ­£åˆ™ URL\nsudo nohup ./gor --input-raw :8201 \\ \n\t--output-file=request-mall-all.gor \\\n\t-output-file-append \\\n\t--http-set-header \"dunshan:7DGroup\" \\\n\t--http-set-header \"User-Agent:Replayed-by-Gor\" \\\n\t--input-raw-track-response \\\n\t--prettify-http \\\n\t--http-disallow-url /actuator/health &gt; /dev/null 2&gt;&amp;1 &amp;\n</code></pre><p>è¿™äº›å‘½ä»¤çš„æ„æ€æ˜¯æˆ‘ä»¬è¦ç›‘å¬ç½‘å…³å®ä¾‹çš„ 8201 ç«¯å£ï¼Œå½•åˆ¶é™¤ /actuator/health ä¹‹å¤–çš„æ‰€æœ‰è¯·æ±‚ï¼Œç„¶åæ•è·å“åº”æŠ¥æ–‡å¹¶æŠŠè¯·æ±‚è¿½åŠ åˆ°å”¯ä¸€æ–‡ä»¶ä¸­ï¼Œåƒè¿™é‡Œç”Ÿæˆçš„æµé‡æ–‡ä»¶åå«â€œrequest-mall-all.gorâ€ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜è¦å¯¹ Header ä¿¡æ¯é‡å†™å¹¶æ‰“ä¸Šå‹æµ‹æ ‡è®° â€œdunshan:7DGroupâ€ã€‚</p><p>è¿™é‡Œæœ‰ä¸€äº›éœ€è¦è¯´æ˜çš„æ˜¯ï¼š</p><ul>\n<li>sudoï¼šä»¥ root èº«ä»½è¿è¡Œï¼Œè¿™æ˜¯ç›‘å¬ç½‘ç»œæµé‡æ‰€å¿…éœ€çš„ <a href=\"https://github.com/buger/goreplay/wiki/Running-as-non-root-user\">ï¼ˆé™¤éå¦è¡Œé…ç½®ï¼‰</a> ï¼›</li>\n<li>nohupï¼šå…è®¸è¯¥å‘½ä»¤åå°è¿è¡Œï¼›</li>\n<li>/dev/nullï¼šè®© GoReplay è¿›ç¨‹ç›‘å¬ /dev/nullã€‚/dev/null è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªé»‘æ´ï¼Œç”¨äºä¸¢å¼ƒä¸éœ€è¦çš„è¾“å‡ºã€‚å¦‚æœæ—¥å¿—æ–‡ä»¶å¤ªå¤§ï¼Œå¹¶ä¸”ä½ å¯¹è‡ªå·±çš„è®¾ç½®æœ‰è¶³å¤Ÿçš„ä¿¡å¿ƒï¼Œå¯ä»¥é€‰æ‹©é‡å®šå‘åˆ° /dev/nullã€‚</li>\n<li>2&gt;&amp;1ï¼šå°† stderrï¼ˆæ ‡å‡†é”™è¯¯ï¼‰ è¾“å‡ºé‡å®šå‘åˆ° stdoutï¼ˆæ ‡å‡†è¾“å‡ºï¼‰ï¼Œå…è®¸æˆ‘ä»¬åœ¨ä¸Šé¢æŒ‡å®šçš„åŒä¸€æ—¥å¿—æ–‡ä»¶ä¸­æ”¶é›†é”™è¯¯è¾“å‡ºã€‚</li>\n<li>&amp;ï¼šåœ¨åå°è¿è¡Œè¿›ç¨‹ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨è¿è¡Œ GoReplay æ—¶ç»§ç»­ä½¿ç”¨ Shelläº†ã€‚</li>\n</ul><p>å‘½ä»¤æ‰§è¡Œåï¼Œè¾“å‡ºçš„æ˜¯ä¸‹é¢çš„ç»“æœï¼š</p><pre><code class=\"language-bash\">[root@s12 ~]# sudo nohup ./gor --input-raw :8201 \\ \n\t--output-file=request-mall-all.gor \\\n\t-output-file-append \\\n\t--http-set-header \"dunshan:7DGroup\" \\\n\t--http-set-header \"User-Agent:Replayed-by-Gor\" \\\n\t--input-raw-track-response \\\n\t--prettify-http \\\n\t--http-disallow-url /actuator/health &gt; /dev/null 2&gt;&amp;1 &amp;\n[1] 26251\n</code></pre><p>è¿™é‡Œæ˜¾ç¤ºçš„æ•°å­— 26251 æ˜¯ Gor ç¨‹åºçš„è¿›ç¨‹ PIDï¼Œåœ¨æˆ‘ä»¬å½•åˆ¶å®Œæˆåï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ª PID ç»ˆæ­¢ Gor çš„å½•åˆ¶è¿›ç¨‹ã€‚</p><p>ç°åœ¨ï¼Œ Gor å·²ç»å¼€å§‹æµé‡å½•åˆ¶äº†ï¼Œè¿™æ®µæ—¶é—´ç½‘å…³è½¬å‘çš„æ‰€æœ‰è¯·æ±‚ä¼šè¢«å½•åˆ¶ã€‚</p><p>åœ¨å½•åˆ¶äº†ä¸€æ®µæ—¶é—´çš„æµé‡åï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ç»ˆæ­¢ Gor çš„å½•åˆ¶ã€‚å½•åˆ¶ç»ˆæ­¢ä¹‹åï¼Œå¯ä»¥çœ‹åˆ°æ‰§è¡Œå½•åˆ¶æŒ‡ä»¤çš„ç›®å½•ä¸‹æœ‰äº†ä¸€ä»½æ–‡ä»¶åä¸º â€œrequest-mall-all.gor â€çš„æµé‡æ–‡ä»¶ã€‚</p><pre><code class=\"language-bash\"># æ‰‹åŠ¨è¾“å…¥ PID æ–¹å¼\nsudo kill -9 ${gor è¿›ç¨‹ PID}\n\n# è‡ªåŠ¨åŒ–è·å– PID æ–¹å¼\nfor i in `ps -ef|grep gor|grep -v grep |awk '{print $2}'`; do &nbsp;kill -9 $i; done\n</code></pre><p>å…¶å®å¦‚æœæˆ‘ä»¬è€ƒè™‘é™æ—¶å½•åˆ¶çš„è¯ï¼Œä¹Ÿå¯ä»¥å‚è€ƒä¸‹é¢è¿™æ®µå‘½ä»¤ï¼š</p><pre><code class=\"language-bash\"># timeout 60 è¡¨ç¤ºåªå½•åˆ¶ 60 ç§’åè‡ªåŠ¨åœæ­¢\nsudo nohup timeout 60 ./gor --input-raw :8201 \\ \n\t--output-file=request-mall-all.gor \\\n\t-output-file-append \\\n\t--http-set-header \"dunshan:7DGroup\" \\\n\t--http-set-header \"User-Agent:Replayed-by-Gor\" \\\n\t--input-raw-track-response \\\n\t--prettify-http \\\n\t--http-disallow-url /actuator/health &gt; /dev/null 2&gt;&amp;1 &amp;\n \n# æŒ‰å°æ—¶åˆ‡å‰²æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶ä¸”å¼€å¯æ—¥å¿—è¿½åŠ æ¨¡å¼ï¼Œä¸ä¼šè¿›è¡Œæ—¥å¿—é»˜è®¤å°åˆ†ç‰‡\nsudo nohup timeout 60 ./gor --input-raw :8201 \\ \n\t--output-file=request-mall-all-%Y-%m-%d-%H.gor \\\n\t-output-file-append \\\n\t--http-set-header \"dunshan:7DGroup\" \\\n\t--http-set-header \"User-Agent:Replayed-by-Gor\" \\\n\t--input-raw-track-response \\\n\t--prettify-http \\\n\t--http-disallow-url /actuator/health &gt; /dev/null 2&gt;&amp;1 &amp;\n \n# æŒ‰å°æ—¶åˆ‡å‰²æ—¥å¿—æ–‡ä»¶ï¼Œå¹¶ä¸”å¼€å¯æ—¥å¿—è¿½åŠ æ¨¡å¼ï¼Œä¸ä¼šè¿›è¡Œæ—¥å¿—é»˜è®¤å°åˆ†ç‰‡,.gz å‹ç¼©æ–‡ä»¶æ ¼å¼\nsudo nohup timeout 60 ./gor --input-raw :8201 \\ \n\t--output-file=request-mall-all-%Y-%m-%d-%H.gz \\\n\t-output-file-append \\\n\t--http-set-header \"dunshan:7DGroup\" \\\n\t--http-set-header \"User-Agent:Replayed-by-Gor\" \\\n\t--input-raw-track-response \\\n\t--prettify-http \\\n\t--http-disallow-url /actuator/health &gt; /dev/null 2&gt;&amp;1 &amp;\n</code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°è¯•æ‰“å¼€â€œrequest-mall-all.gor â€çš„æµé‡æ–‡ä»¶ï¼Œåˆ†æä¸€ä¸‹é‡Œé¢çš„ç»“æ„ã€‚</p><p>å› ä¸ºGoReplay ç”¨ä¸‰ä¸ªçŒ´å¤´ ğŸµğŸ™ˆğŸ™‰  ä½œä¸ºè¯·æ±‚åˆ†éš”ç¬¦ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æµé‡æ–‡ä»¶æ˜¯ä¸‹é¢è¿™ä¸ªæ ·å­ï¼š</p><pre><code class=\"language-bash\"># è¯·æ±‚ç±»å‹ï¼Œè¯·æ±‚ ID ä¸º 80a820090a6423c03994b9f3ï¼Œæ—¶é—´æˆ³\n1 80a820090a6423c03994b9f3 1635694104268073719 0\n# è¯·æ±‚çš„ç±»å‹åŠ URL åœ°å€\nPOST /api/member/sso/login HTTP/1.1\nConnection: keep-alive\n# å‹æµ‹æ ‡è®°\ndunshan: 7DGroup\nContent-Length: 34\nContent-Type: application/x-www-form-urlencoded; charset=UTF-8\nHost: 172.31.184.225:30001\n# header é‡å†™\nUser-Agent: Replayed-by-Gor\n\n# è¯·æ±‚å‚æ•°\nusername=7dTest006&amp;password=123456\n\nğŸµğŸ™ˆğŸ™‰ # è¯·æ±‚åˆ†éš”ç¬¦\n\n# å“åº”ç±»å‹ï¼Œè¯·æ±‚ ID ä¸º 80a820090a6423c03994b9f3ï¼Œæ—¶é—´æˆ³\n2 80a820090a6423c03994b9f3 1635694104291403073 392247\nHTTP/1.1 200 OK\nContent-Length: 1053\nVary: Origin\nVary: Access-Control-Request-Method\nVary: Access-Control-Request-Headers\nContent-Type: application/json\nDate: Sun, 31 Oct 2021 15:28:24 GMT\nCache-Control: no-cache, no-store, max-age=0, must-revalidate\nPragma: no-cache\nExpires: 0\nX-Content-Type-Options: nosniff\nX-Frame-Options: DENY\nX-XSS-Protection: 1 ; mode=block\nReferrer-Policy: no-referrer\n\n# å“åº”ä½“\n{\"code\":200,\"message\":\"æ“ä½œæˆåŠŸ\",\"data\":{\"token\":\"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX25hbWUiOiI3ZFRlc3QwMDYiLCJzY29wZSI6WyJhbGwiXSwiaWQiOjI0MzQ0MjUsImV4cCI6MTYzNTc4MDUwNCwiYXV0aG9yaXRpZXMiOlsi5YmN5Y-w5Lya5ZGYIl0sImp0aSI6IjBhYjQ3OWU5LWYwOWQtNDI1YS04YWQyLTgwNTE4MDg3MmU4ZiIsImNsaWVudF9pZCI6InBvcnRhbC1hcHAifQ.WzOKDhWEu00nXBMghYwxTW6xW8M1CLdqEt63xeS6MwJME2QJg1rIxAsUKRo4KxgbFPoybax3O36xnpMDLAiRskQj6VRil-WaqYFBvTeC3iGfI2whKW8FsySUQh6WU2Vf5SsvA9HhMKLl3S4PS-aIY9bElxFjajeNoVGn4KB1Rwg\",\"refreshToken\":\"eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX25hbWUiOiI3ZFRlc3QwMDYiLCJzY29wZSI6WyJhbGwiXSwiYXRpIjoiMGFiNDc5ZTktZjA5ZC00MjVhLThhZDItODA1MTgwODcyZThmIiwiaWQiOjI0MzQ0MjUsImV4cCI6MTYzNjI5ODkwNCwiYXV0aG9yaXRpZXMiOlsi5YmN5Y-w5Lya5ZGYIl0sImp0aSI6IjAwYTIxYTFiLTJjZDMtNDk0Yi1hNzkxLWE3MTlhMDViN2YxYyIsImNsaWVudF9pZCI6InBvcnRhbC1hcHAifQ.IRSQvTOQpyRAjwp6owpdcYyjLLV8oZ_J39FNv7J4sZVGGnl3o5GEv51cnP89msTa7MXIC9E0k7mUqjiHJKJ-RFPDlHne1k-hP_ZJSCg9GS35cMiVb7jYQV-rVnG3j-yqiJb9g2gsCLVcsF-KnCMwWyV46C8pH2Tiajeee-Io9F8\",\"tokenHead\":\"Bearer \",\"expiresIn\":86399}}\n</code></pre><p>ä»æµé‡æ–‡ä»¶ä¸­å¯ä»¥çœ‹å‡ºï¼Œå¯¹äºæ¯ä¸ªè¯·æ±‚ï¼Œåº”è¯¥æ”¶åˆ° 3 ä¸ªæœ‰æ•ˆ Payload(1-Request, 2-Response, 3-Replayed Response)ï¼Œå®ƒä»¬å…·æœ‰ç›¸åŒçš„è¯·æ±‚ IDï¼ˆRequestå’Œ Response å…·æœ‰ç›¸åŒçš„)ã€‚</p><p>åˆ°æ­¤ï¼Œæµé‡å½•åˆ¶å°±ç»“æŸäº†ã€‚</p><p>è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å½•åˆ¶å¤§æµé‡çš„çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°ä¸¢å¤±éƒ¨åˆ†è¯·æ±‚çš„æƒ…å†µã€‚è¿™æ˜¯å› ä¸º Gor æ˜¯åŸºäº pcap å’Œæ“ä½œç³»ç»Ÿ BufferSize è¿›è¡Œå½•åˆ¶çš„ï¼Œå½“ BufferSize æº¢å‡ºçš„æ—¶å€™ï¼Œè¯·æ±‚å°±ä¼šä¸¢å¤±ã€‚</p><p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¿…é¡»è®¾ç½®å‚æ•°ï¼šâ€“input-raw-buffer-sizeã€‚</p><pre><code class=\"language-bash\">  -input-raw-buffer-size value\n        Controls size of the OS buffer which holds packets until they dispatched. Default value depends by system: in Linux around 2MB. If you see big package drop, increase this value\n</code></pre><p>æˆ‘ä»¬å¯ä»¥åœ¨ <a href=\"https://github.com/buger/goreplay/blob/master/capture/capture.go\">capture.go</a> ä¸­æ‰¾åˆ° BufferSize ç›¸å…³çš„è¿™æ®µä»£ç ï¼š</p><pre><code class=\"language-go\">\tif l.BufferSize &gt; 0 {\n\t\terr = inactive.SetBufferSize(int(l.BufferSize))\n\t\tif err != nil {\n\t\t\treturn nil, fmt.Errorf(\"handle buffer size error: %q, interface: %q\", err, ifi.Name)\n\t\t}\n\t}\n\tif l.BufferTimeout == 0 {\n\t\tl.BufferTimeout = 2000 * time.Millisecond\n\t}\n\terr = inactive.SetTimeout(l.BufferTimeout)\n\tif err != nil {\n\t\treturn nil, fmt.Errorf(\"handle buffer timeout error: %q, interface: %q\", err, ifi.Name)\n\t}\n\thandle, err = inactive.Activate()\n</code></pre><p>è¦æ³¨æ„çš„æ˜¯ï¼Œæ“ä½œç³»ç»Ÿç¼“å†²åŒºï¼ˆ BufferSize ï¼‰çš„é»˜è®¤å€¼æ˜¯ç”¨æ¥ä¿å­˜æ•°æ®åŒ…çš„ï¼Œå®ƒåœ¨ä¸åŒçš„æ“ä½œç³»ç»Ÿä¸Šæœ‰æ‰€ä¸åŒã€‚ä¾‹å¦‚ï¼Œåœ¨ Linux ä¸Šè¿™ä¸ªå€¼æ˜¯ 2 MBï¼Œåœ¨ Windows æ˜¯ 1 MBã€‚å¦‚æœè®¾ç½®æ›´å¤§çš„ç¼“å†²åŒºæˆ–å‡å°‘ MTUï¼ˆæ¥å£å±‚çš„æœ€å¤§æ•°æ®åŒ…æ•°æ®å¤§å°ï¼‰ ä¸èƒ½å‡å°‘ä¸¢å¤±çš„è¯·æ±‚æ•°æ®ï¼Œé‚£ä¹ˆå¾ˆæœ‰å¯èƒ½æ˜¯ GoReplay Bugã€‚</p><h2>æµé‡å›æ”¾</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹ä¸‹æµé‡å›æ”¾ã€‚æµé‡å›æ”¾çš„æ ¸å¿ƒåŸç†æ˜¯é€šè¿‡ Limiter å®ç°å˜é€Ÿå›æ”¾ï¼Œé€šè¿‡ Output æ’ä»¶è¾“å‡ºåˆ°ç›®æ ‡æœºå™¨ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä¸»è¦ä½¿ç”¨çš„æ˜¯HTTPè¾“å‡ºçš„æ’ä»¶<a href=\"https://github.com/buger/goreplay/blob/master/output_http.go\">output_http.go</a>&nbsp;ï¼Œå®ƒé€šè¿‡å®ç° HTTP åè®®ï¼Œ è¿›è€Œå®ç° io.Writer æ¥å£ï¼Œæœ€åæ ¹æ®é…ç½®æ³¨å†Œåˆ° Plugin.outputs é˜Ÿåˆ—é‡Œã€‚</p><p>GoReplay å›æ”¾åŸç†å›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/fe/2b/fe26839250a99a3b2001a95a6cc7902b.jpg?wh=1656x1313\" alt=\"å›¾ç‰‡\"></p><p>æµé‡å›æ”¾ä¸»è¦é€šè¿‡ Limiter ç±»æ‰§è¡Œå„ç§å˜é€Ÿã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒGor ä¼šåˆ›å»ºä¸€ä¸ªåŠ¨æ€åç¨‹æ± ã€‚åˆå§‹åç¨‹æ•°æ˜¯ 10 ï¼Œå› ä¸ºåç¨‹æ•°é‡ï¼ˆNï¼‰ç­‰äºè¯¥åç¨‹æ± çš„é˜Ÿåˆ—é•¿åº¦ï¼Œæ‰€ä»¥å½“ HTTP è¾“å‡ºé˜Ÿåˆ—é•¿åº¦å¤§äº 10 æ—¶ï¼ŒGor ä¼šåˆ›å»ºæ›´å¤šçš„åç¨‹æ•°ã€‚</p><p>åœ¨äº§ç”Ÿ N ä¸ªåç¨‹çš„è¯·æ±‚å¾—åˆ°æ»¡è¶³ä¹‹å‰ï¼Œä¸ä¼šå†æœ‰åç¨‹åˆ›å»ºã€‚å¦‚æœåŠ¨æ€åç¨‹æ•°å½“æ—¶ä¸èƒ½å¤„ç†æ¶ˆæ¯ï¼Œå®ƒå°†ä¼šç¡çœ ä¸€ä¼šã€‚å¦‚æœåŠ¨æ€åç¨‹æ•°æ— æ³•å¤„ç†æ¶ˆæ¯ï¼Œå®ƒå°±ä¼šæ­»äº¡ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ --output-http-workers=20 é€‰é¡¹æŒ‡å®šå¹¶å‘åç¨‹æ•°ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬æ¼”ç¤ºçš„ä¾‹å­æ˜¯ï¼Œå€æ•°å›æ”¾ç½‘å…³æœåŠ¡çš„æ‰€æœ‰æ¥å£è¯·æ±‚ã€‚</p><p>å›æ”¾é€»è¾‘å›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/c9/01/c98c32493c7ca010a06944c55f8f4801.jpg?wh=1873x331\" alt=\"å›¾ç‰‡\"></p><p>æˆ‘ä»¬ä¸»è¦ä¼šä½¿ç”¨ä¸‹é¢è¿™äº›å‘½ä»¤ï¼š</p><pre><code class=\"language-bash\"># --input-fileï¼šä»æ–‡ä»¶ä¸­è·å–è¯·æ±‚æ•°æ®ï¼Œé‡æ”¾çš„æ—¶å€™ 100x å€é€Ÿ\n# --input-file-loopï¼šæ— é™å¾ªç¯ï¼Œè€Œä¸æ˜¯è¯»å®Œè¿™ä¸ªæ–‡ä»¶å°±åœæ­¢\n# --output-httpï¼šå‘é€è¯·æ±‚åˆ°ç½‘å…³\n# --output-http-workersï¼šå¹¶å‘ 100 åç¨‹å‘é€è¯·æ±‚\n# --stats --output-http-statsï¼šæ¯ 5 ç§’è¾“å‡ºä¸€æ¬¡ TPS æ•°æ®\n# --output-http-track-responseï¼šè·å–å“åº”æŠ¥æ–‡\n$ sudo ./gor --input-file 'request-mall-all.gor|10000%' \\  \n--input-file-loop \\ \n--output-http 'http://10.96.136.36:8201' \\ \n--output-http-workers 100 \\ \n--stats \\ \n--output-http-stats \\  \n--output-http-track-response \n</code></pre><p>å› ä¸ºæˆ‘ä»¬æ˜¯æ€§èƒ½å‹æµ‹ï¼Œå¯ä»¥è¦æ±‚æ— é™å¾ªç¯ã€‚å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬å‘ç½‘å…³æœåŠ¡å›æ”¾äº† 100 å€çš„æµé‡ã€‚</p><h2>æ€»ç»“</h2><p>å¥½äº†ï¼Œè¿™èŠ‚è¯¾å°±è®²åˆ°è¿™é‡Œã€‚åˆšæ‰ï¼Œæˆ‘ä»¬ä¸€èµ·æ¢³ç†äº† GoReplay çš„åŸºæœ¬æ¦‚å¿µã€æ ¸å¿ƒåŸç†ã€å¸¸ç”¨å‚æ•°ã€‚æˆ‘ä»¬è¿˜ä¸€èµ·è®¤è¯†äº†GoReplay ä¸¤ä¸ªä¸»è¦çš„åŠŸèƒ½ï¼šæµé‡å½•åˆ¶å’Œæµé‡å›æ”¾ã€‚ä¸‹é¢å‡ ä¸ªçŸ¥è¯†ç‚¹å¸Œæœ›ä½ èƒ½è®°ä½ã€‚</p><ol>\n<li>GoReplay ä¸»è¦ä¾èµ–Golangç¯å¢ƒè¿è¡Œï¼Œå®ƒé€šè¿‡å‘½ä»¤è¡Œç»„ç»‡å„ä¸ªå‚æ•°è¿›è¡Œå…·ä½“çš„æ“ä½œï¼›</li>\n<li>GoReplay åº•å±‚ä¾èµ–çš„æ˜¯ libpcap åº“ï¼Œ Gor è¿›ç¨‹å¯ä»¥è´Ÿè´£æ‰€æœ‰çš„å·¥ä½œï¼ŒåŒ…æ‹¬ç›‘å¬ã€è¿‡æ»¤ã€é‡å†™ã€å›æ”¾ç­‰ï¼›</li>\n<li>é€šè¿‡å‚æ•°ï¼š-stats å’Œ --out-http-statsï¼ŒGoReplay åŸç”Ÿåªæ”¯æŒç”±æ§åˆ¶å°ç»Ÿè®¡å‘é€è¯·æ±‚é˜Ÿåˆ—ä¿¡æ¯ï¼Œå¦‚æœæƒ³è¦æ›´å¤æ‚çš„æµ‹è¯•ç»Ÿè®¡è¿˜éœ€è¦æˆ‘ä»¬è‡ªå·±å»åŸ‹ç‚¹ä¸°å¯Œç›‘æ§æŒ‡æ ‡ï¼›</li>\n<li>ä½¿ç”¨ Middleware å¯ä»¥è®©æˆ‘ä»¬åœ¨è¾“å…¥è¾“å‡ºé—´åšä¸€äº›å¤æ‚çš„è¯·æ±‚å¢å¼ºå·¥ä½œã€‚</li>\n</ol><p>ä¸‹ä¸€èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°†è¿›å…¥å…·ä½“å®è·µç¯èŠ‚ï¼Œæˆ‘ä¼šé€šè¿‡æ¡ˆä¾‹æ¼”ç¤ºå¦‚ä½•åšåŠ¨æ€æ•°æ®å…³è”æ”¹é€ å·¥ä½œã€‚</p><h2>æ€è€ƒé¢˜</h2><p>å­¦å®Œè¿™èŠ‚è¯¾ï¼Œè¯·ä½ æ€è€ƒä¸¤ä¸ªé—®é¢˜ï¼š</p><ol>\n<li>ä½ æœ‰æ²¡æœ‰ä½¿ç”¨è¿‡ GoReplayï¼Œè°ˆè°ˆä½ ä½¿ç”¨è¿™ä¸ªå·¥å…·çš„ä¸€äº›å¿ƒå¾—ã€‚</li>\n<li>ç›¸æ¯” Java è¯­è¨€çš„å‹æµ‹å·¥å…·ï¼Œä½ è§‰å¾— Golang çš„å‹æµ‹å·¥å…·æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ</li>\n</ol><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºä¸æˆ‘äº¤æµè®¨è®ºã€‚å½“ç„¶äº†ï¼Œä½ ä¹Ÿå¯ä»¥æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™ä½ èº«è¾¹çš„æœ‹å‹ï¼Œä»–ä»¬çš„ä¸€äº›æƒ³æ³•æˆ–è®¸ä¼šè®©ä½ æœ‰æ›´å¤§çš„æ”¶è·ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ï¼</p>","neighbors":{"left":{"article_title":"20 | Mockï¼šå¦‚ä½•å±è”½ç¬¬ä¸‰æ–¹æ¥å£çš„å½±å“ï¼Ÿ","id":462212},"right":{"article_title":"22 | å‹æµ‹å¹³å°ï¼šå¦‚ä½•è§£å†³ GoReplay åŠ¨æ€æ•°æ®å…³è”ï¼Ÿ","id":464659}},"comments":[{"had_liked":false,"id":333701,"user_name":"Geek_f9e0e5","can_delete":false,"product_type":"c1","uid":1664331,"ip_address":"","ucode":"A0AFC5742C0FFB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIUw2n2cOLticrdgJWu5ibM1Hib58XNRt5jQwRibT27ZLvqKvsPoZDicrFmUic2GF9vtI2EjgMWVpiatwgFw/132","comment_is_top":false,"comment_ctime":1644478069,"is_pvip":false,"replies":[{"id":"122551","content":"é‚£å°±å­¦ä¹ ä¸€ä¸‹å§ã€‚ ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1785562","ctime":1645579110,"ip_address":"","comment_id":333701,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5939445365","product_id":100093001,"comment_content":"æ²¡æœ‰ä½¿ç”¨è¿‡ GoReplay","like_count":1,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552717,"discussion_content":"é‚£å°±å­¦ä¹ ä¸€ä¸‹å§ã€‚ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645579110,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":357214,"user_name":"lyy","can_delete":false,"product_type":"c1","uid":2381893,"ip_address":"åŒ—äº¬","ucode":"064F31D18E4875","user_header":"https://static001.geekbang.org/account/avatar/00/24/58/45/9ba77dc3.jpg","comment_is_top":false,"comment_ctime":1663068323,"is_pvip":false,"replies":[{"id":"130283","content":"å½•åˆ¶çš„æ—¶å€™åªå½•åˆ¶è¿™æ ·é“¾æ¥çš„è¯·æ±‚å°±è¡Œäº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1785562","ctime":1663808278,"ip_address":"åŒ—äº¬","comment_id":357214,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1663068323","product_id":100093001,"comment_content":"å¦‚æœåªæƒ³å›æ”¾æŸä¸ªåŸŸåä¸‹çš„è¯·æ±‚ï¼Œæ¯”å¦‚ api.xxxx.com, è¯¥æ€ä¹ˆè¿‡æ»¤å‘¢","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588508,"discussion_content":"å½•åˆ¶çš„æ—¶å€™åªå½•åˆ¶è¿™æ ·é“¾æ¥çš„è¯·æ±‚å°±è¡Œäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663808278,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350333,"user_name":"æ¸…é£æ…•ç«¹","can_delete":false,"product_type":"c1","uid":1118067,"ip_address":"åŒ—äº¬","ucode":"9CBED0CE173647","user_header":"https://static001.geekbang.org/account/avatar/00/11/0f/73/83e919a8.jpg","comment_is_top":false,"comment_ctime":1656823401,"is_pvip":false,"replies":[{"id":"129327","content":"1. æ¯æ¬¡å›æ”¾ä¹‹å‰è‚¯å®šè¦æŠŠå‚æ•°åŒ–æ–‡ä»¶åˆ·æ–°ä¸€éï¼Œæ”¾è¿›æ²¡æœ‰è¿˜æ¬¾çš„è®¢å•ã€‚<br>2. ç™»å½•è¿‡æœŸäº†ï¼Œé‚£è‚¯å®šæ˜¯è¦çœ‹çœ‹tokenè¿‡æœŸæ—¶é—´ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1785562","ctime":1661335554,"ip_address":"åŒ—äº¬","comment_id":350333,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1656823401","product_id":100093001,"comment_content":"å½•åˆ¶å›æ”¾çš„å“ªäº›æ•°æ®ï¼Œæœ‰äº›è®¢å•å·²ç»è¿˜æ¬¾äº†ï¼›æœ‰äº›ç™»å½•è¿‡æœŸäº†ï¼Œé«˜æ¥¼è€å¸ˆè¯·æ•™ä¸‹è¿™ä¸ªæ˜¯æ€ä¹ˆè§£å†³å¤„ç†çš„å‘¢","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585125,"discussion_content":"1. æ¯æ¬¡å›æ”¾ä¹‹å‰è‚¯å®šè¦æŠŠå‚æ•°åŒ–æ–‡ä»¶åˆ·æ–°ä¸€éï¼Œæ”¾è¿›æ²¡æœ‰è¿˜æ¬¾çš„è®¢å•ã€‚\n2. ç™»å½•è¿‡æœŸäº†ï¼Œé‚£è‚¯å®šæ˜¯è¦çœ‹çœ‹tokenè¿‡æœŸæ—¶é—´ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661335554,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345816,"user_name":"Geek_c149bf","can_delete":false,"product_type":"c1","uid":2877172,"ip_address":"","ucode":"F3437FB4F8354B","user_header":"","comment_is_top":false,"comment_ctime":1652612043,"is_pvip":true,"replies":[{"id":"126619","content":"è¿™ä¸ªå·¥å…·æ˜¯å¯ä»¥æ”¯æŒHTTPSçš„ï¼Œå¯ä»¥è‡ªå·±æ‰©å±•ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1785562","ctime":1653834541,"ip_address":"","comment_id":345816,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1652612043","product_id":100093001,"comment_content":"æœ€è¿‘ä¹Ÿåœ¨è°ƒç ”æµé‡å›æ”¾  è¿™ä¸ªå·¥å…·æ‰¾äº†ä¸€äº›èµ„æ–™ å…¨éƒ½æ˜¯http èƒ½æ”¯æŒhttpså— çº¿ä¸Šç¯å¢ƒéƒ½æ˜¯httpså‘€","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":574114,"discussion_content":"è¿™ä¸ªå·¥å…·æ˜¯å¯ä»¥æ”¯æŒHTTPSçš„ï¼Œå¯ä»¥è‡ªå·±æ‰©å±•ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653834541,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}