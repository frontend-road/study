{"id":771719,"title":"09ï½œæ¥å£æŒ‡æ ‡ï¼šç›‘å¬æ¥å£çŠ¶æ€ï¼Œæ”¶é›†é¡µé¢æ¥å£å¼‚å¸¸æ•°æ®","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ä¸‰æ¡¥ã€‚</p><p>å¾ˆå¤šå‰ç«¯åŒå­¦å¹¶ä¸å¤ªé‡è§†æ¥å£å¼‚å¸¸æƒ…å†µçš„ç»´æŠ¤ï¼Œåè€ŒæŠŠç²¾åŠ›é›†ä¸­åœ¨å½“å‰çš„åŠŸèƒ½æ˜¯å¦å¯ç”¨ã€‚ä½†åœ¨å®é™…çš„åº”ç”¨è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°å„ç§ä¸å¯é¢„çŸ¥çš„æ¥å£å¼‚å¸¸æƒ…å†µã€‚å¦‚æœæ²¡æœ‰åšå¥½å……åˆ†çš„å¼‚å¸¸å¤„ç†å’Œç»´æŠ¤å·¥ä½œï¼Œä¸ä»…ä¼šå¯¼è‡´è¾ƒå·®çš„ç”¨æˆ·ä½“éªŒï¼Œç”šè‡³å½±å“æ•´ä¸ªWebåº”ç”¨çš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚</p><p>å› æ­¤ï¼Œè¿™èŠ‚è¯¾æˆ‘ä»¬ä¼šæŠŠç›®å…‰æ”¾åœ¨<a href=\"https://time.geekbang.org/column/article/769079\">ç¬¬5èŠ‚è¯¾</a>æåˆ°çš„æ¥å£å¼‚å¸¸è¿™ä¸ªæ•°æ®æŒ‡æ ‡ï¼Œé‡ç‚¹å­¦ä¹ åœ¨å‰ç«¯å…¨é“¾è·¯ä¸­æ•è·è¯·æ±‚å¼‚å¸¸çš„æ–¹æ³•ã€‚ç›¸ä¿¡é€šè¿‡è¿™èŠ‚è¯¾çš„å­¦ä¹ ï¼Œä½ å°±èƒ½æŒæ¡å‰ç«¯å…¨é“¾è·¯çš„å¼‚å¸¸å¤„ç†æ–¹æ¡ˆï¼ŒåŒæ—¶è¿˜è¿›ä¸€æ­¥æå‡ä½ çš„å‰ç«¯æŠ€èƒ½å’Œå‘ç°é—®é¢˜çš„èƒ½åŠ›ã€‚</p><h2>è¯·æ±‚æ¥å£å°è£…çš„å¸¸è§è¯¯åŒº</h2><p>æˆ‘ä»¬çŸ¥é“ï¼Œå‰ç«¯æœ‰ä¸¤ç§å‘æœåŠ¡å™¨å‘èµ·è¯·æ±‚çš„æ–¹æ³•ã€‚ä¸€ç§æ˜¯ä½¿ç”¨XMLHTTPRequestå¯¹è±¡ï¼Œæ˜¯æ—©æœŸæµè§ˆå™¨çš„å®ç°æ–¹æ¡ˆã€‚å¦ä¸€ç§æ˜¯ä½¿ç”¨Fetch APIï¼Œè¿™ä¸ªæ˜¯ES6æ–°å¢çš„ç‰¹æ€§ã€‚è¿™èŠ‚è¯¾ï¼Œæˆ‘é€‰ç”¨çš„æ˜¯Fetchæ¥å¸¦ä½ åˆ†æè¯·æ±‚å¼‚å¸¸æ•è·çš„ä¸€ç³»åˆ—é—®é¢˜ã€‚</p><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä¸¤ä¸ªå¸¸è§çš„ä¾‹å­ã€‚</p><p>ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œæœ‰äº›åŒå­¦æ‡‚å¾—Fetchæ˜¯å¼‚æ­¥å‡½æ•°ï¼Œå¹¶ä¸”æœ‰æ„è¯†åœ°åœ¨ä»£ç é‡Œæ·»åŠ äº†trycatchæ•è·å¼‚å¸¸ï¼Œè¿™æ ·ï¼Œåœ¨å‘ç”Ÿè¯·æ±‚å¼‚å¸¸çš„æ—¶å€™ï¼Œå°±èƒ½é€šè¿‡Catchæ•è·å¼‚å¸¸äº†ã€‚æˆ‘ä»¬ä¹Ÿèƒ½è¿›è¡Œå¼‚å¸¸åçš„äº¤äº’å¤„ç†ï¼Œæ¯”å¦‚æä¾›ä¿¡æ¯æ¥æé†’ç”¨æˆ·ã€‚</p><pre><code class=\"language-typescript\">let result;\ntry {\n\tresult = await fetch(url, {\n&nbsp; &nbsp; body,\n&nbsp; &nbsp; method: 'POST',\n&nbsp; &nbsp; keepalive: true\n&nbsp; });\n} catch (e) {\n\tconsole.log(e)\n}\n\n// ä¸‹é¢ç»§ç»­ä½¿ç”¨resultç»“æœå¤„ç†ä¸šåŠ¡\n</code></pre><!-- [[[read_end]]] --><p>ä¸Šè¿°ä»£ç çš„é—®é¢˜åœ¨äºï¼Œè¿™é‡Œçš„catché€»è¾‘è¢«å¿½ç•¥äº†ã€‚æˆ‘é˜…è¯»è¿‡è®¸å¤šå‰ç«¯é¡¹ç›®ä»£ç ï¼Œå‡ ä¹æ‰€æœ‰catchéƒ½æ˜¯ç›´æ¥ä½¿ç”¨console.logè¾“å‡ºé”™è¯¯ä¿¡æ¯çš„ã€‚</p><p>è¿™æ ·çš„æ—¥å¿—è¾“å‡ºæœ‰ç”¨å—ï¼Ÿæœ‰ç”¨çš„ï¼Œä½†å®ƒå¯èƒ½åªåœ¨å¼€å‘ç¯å¢ƒä¸­æœ‰æ•ˆï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å‡ ä¹æ²¡ç”¨ã€‚å› ä¸ºæ—¥å¿—æ˜¯åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸Šè¾“å‡ºçš„ï¼Œå‡ºç°é—®é¢˜æ—¶ï¼Œå‰ç«¯åŒå­¦æ ¹æœ¬æ— æ³•è·å–è¿™äº›æ—¥å¿—ã€‚</p><p>ç¬¬äºŒä¸ªä¾‹å­ï¼Œæœ‰äº›å‰ç«¯åŒå­¦ä¼šä½¿ç”¨äºŒæ¬¡å°è£…çš„æ–¹æ¡ˆï¼Œå¯¹Fetchå‡½æ•°è¿›è¡Œå°è£…ï¼Œç„¶ååœ¨å°è£…ä»£ç é‡Œæ·»åŠ é€»è¾‘ã€‚å¦‚ä¸‹é¢çš„å°è£…ä»£ç æ‰€ç¤ºã€‚</p><pre><code class=\"language-typescript\">// fetchUtil.ts\nexport async function fetchUtil(url: string, body: string) {\n&nbsp; // @ts-ignore\n&nbsp; return fetch(url, {\n&nbsp; &nbsp; body,\n&nbsp; &nbsp; method: 'POST',\n&nbsp; &nbsp; keepalive: true\n&nbsp; });\n}\n\n// index.ts\nimport { fetchUtil } from './fetchutil'\n\nlet result = ;\ntry {\n\tresult = await fetchUtil(url, JSON.stringify(body));\n} catch (e) {\n\tconsole.log(e)\n}\n</code></pre><p>è¿™ç§æ–¹å¼è™½ç„¶å¯è¡Œï¼Œä½†è¿˜æ˜¯ä¼šå­˜åœ¨ä¸šåŠ¡è€¦åˆçš„æƒ…å†µã€‚å¤§éƒ¨åˆ†å‰ç«¯åŒå­¦å¯¹å‡½æ•°çš„å°è£…ç†è§£éƒ½æ˜¯æ–°å»ºä¸€ä¸ªå‡½æ•°ï¼Œç„¶ååœ¨å‡½æ•°å†…æ·»åŠ é€šç”¨é€»è¾‘ã€‚</p><p>å¦‚æœä½ åªç»´æŠ¤ä¸€ä¸ªé¡¹ç›®ï¼Œè¿™ç§ç†è§£æ˜¯æ²¡é—®é¢˜çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ éœ€è¦ç»´æŠ¤10ä¸ªä»¥ä¸Šçš„é¡¹ç›®ï¼Œè¿™ç§ä»£ç çš„å°è£…æ¨¡å¼å°±ä¼šå­˜åœ¨è®¸å¤šç¼ºé™·ã€‚æ¯”å¦‚ä½ æœ‰å¤šä¸ªä¸åŒæ¶æ„çš„å‰ç«¯é¡¹ç›®ï¼Œé‚£å°±è¦ç»™æ¯ä¸€ä¸ªé¡¹ç›®éƒ½é‡æ–°å°è£…ä¸€éï¼Œè¿™ä¹Ÿä¼šå¢åŠ å…¬å…±ä»£ç çš„ç»´æŠ¤æˆæœ¬ã€‚</p><p>æ­¤å¤–ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ä¼šä¸ºäº†å…¬å…±ä¸šåŠ¡é€»è¾‘ï¼Œå°†ç›¸å…³çš„å‚æ•°å°è£…åå†å‘èµ·è¯·æ±‚ï¼Œæ¯”å¦‚åœ¨å‘èµ·è¯·æ±‚ä¹‹å‰å¸¦ä¸ŠaccessTokenã€‚å¦‚æœæˆ‘ä»¬è¿˜éœ€è¦æ”¶é›†è¯·æ±‚å‰åçš„å„ç§å‚æ•°ï¼Œé‚£å°±æ„å‘³ç€è€¦åˆäº†å…¬å…±ä¸šåŠ¡é€»è¾‘å’Œå…¨é“¾è·¯é€»è¾‘ã€‚</p><p>ä¸¤ä¸ªå…¸å‹çš„é—®é¢˜è¯´å®Œäº†ï¼Œç°åœ¨è½®åˆ°å’±ä»¬æ€è€ƒè§£å†³æ–¹æ¡ˆäº†ã€‚æˆ‘ä»¬è¯¥æ€ä¹ˆåœ¨ç›‘å¬è¯·æ±‚å¼‚å¸¸çš„åŒæ—¶ï¼Œè®©å‰ç«¯å…¨é“¾è·¯æ—¢èƒ½è§£è€¦åˆå…·å¤‡æ‰©å±•æ€§å‘¢ï¼Ÿ</p><h2>ç›‘å¬è¯·æ±‚ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>æˆ‘ä»¬å·²ç»æ¢è®¨è¿‡ï¼Œå‰ç«¯å…¨é“¾è·¯å…¶ä¸­çš„ä¸€ä¸ªéœ€æ±‚æ˜¯è¦èƒ½å¤Ÿè¿½è¸ªå’Œæº¯æºå‰åç«¯é“¾è·¯æ—¥å¿—ï¼Œå¹¶ä¸”æ¯ä¸€ä¸ªå‰ç«¯è¯·æ±‚è·Ÿåç«¯æ¥æ”¶çš„è¯·æ±‚èƒ½å¤Ÿä¸€ä¸€å¯¹åº”ã€‚</p><p>æœ‰äº†è¿™ä¸ªåŸºç¡€ï¼Œæˆ‘ä»¬å…ˆç†è§£ç›‘å¬è¯·æ±‚çš„å‡ ä¸ªæ ¸å¿ƒéœ€æ±‚ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç›‘æ§å‰ç«¯å‘èµ·è¯·æ±‚çš„ç¨³å®šæ€§ï¼Œä¾‹å¦‚è¯·æ±‚æ˜¯å¦å·²ç»åˆ°è¾¾æœåŠ¡ç«¯ï¼Œç”¨æˆ·æ˜¯å¦ä¸­æ–­è¯·æ±‚ä»¥åŠè¯·æ±‚æ˜¯å¦å¤±è´¥ç­‰ã€‚</p><p>å…¶æ¬¡ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨ç”¨æˆ·çš„ç½‘ç»œçŠ¶å†µï¼Œä¾‹å¦‚ç”¨æˆ·æ˜¯å¦å› ä¸ºç½‘ç»œé—®é¢˜å½±å“äº†ä½¿ç”¨ä½“éªŒï¼Œä¾‹å¦‚æ˜¯å¦æ˜¯å›½å¤–ç”¨æˆ·è®¿é—®å›½å†…æœåŠ¡å™¨ã€‚</p><p>ç¬¬ä¸‰ï¼Œç°åœ¨è®¸å¤šæ¥å£åŠŸèƒ½å…·å¤‡ç™»å½•é‰´æƒå’Œç”¨æˆ·ç”»åƒç­‰ç‰¹æ€§ï¼Œå‡ ä¹æ¯ä¸ªç”¨æˆ·éƒ½æœ‰å…¶ç‹¬ç‰¹çš„æ•°æ®æˆ–è€…åˆ†ç»„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦åˆ¤æ–­æ¥å£è¿”å›çš„ä¿¡æ¯æ˜¯å¦åˆç†ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼Œæˆ‘ä»¬ç›‘å¬è¯·æ±‚çš„æ ¸å¿ƒç›®çš„ï¼Œå°±æ˜¯å‘ç°è¯·æ±‚å¼‚å¸¸çš„çŠ¶æ€ã€‚ä¸ä»…è¦ä¿è¯åœ¨æ”¹é€ è¿‡ç¨‹ä¸­ä¸è€¦åˆä¸šåŠ¡é€»è¾‘ï¼Œè¿˜è¦æ”¯æŒæ›´å¤šå‰ç«¯é¡¹ç›®çš„å‰ç«¯å…¨é“¾è·¯ã€‚è¿™å°±å¼•å‡ºäº†æˆ‘ä»¬è®¾è®¡çš„ä¸¤ä¸ªåŸåˆ™ï¼Œæ”¯æŒç›‘å¬Fetchï¼ŒåŒæ—¶è€ƒè™‘å‘ä¸‹å…¼å®¹æ”¯æŒXMLHttpRequestã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éµå¾ª<strong>ä¸è€¦åˆä¸šåŠ¡</strong>çš„åŸåˆ™ã€‚è¿™ä¸ªé“ç†å¾ˆç®€å•ï¼Œæˆ‘ä»¬è®¾è®¡çš„å…¨é“¾è·¯æ–¹æ¡ˆå¹¶ä¸æ˜¯ä¸ºäº†æŸä¸ªå…·ä½“é¡¹ç›®ï¼Œè€Œæ˜¯ä¸€å¥—é€šç”¨æ€§çš„æ–¹æ¡ˆï¼Œå› æ­¤æˆ‘ä»¬ä¸åº”å°†å…¶ä¸ä¸šåŠ¡ç´§å¯†è€¦åˆã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬é€‰æ‹©å¯¹XMLHttpRequestå¯¹è±¡å’ŒFetch APIæ–¹æ³•è¿›è¡Œé€‚å½“çš„æ”¹é€ ï¼Œæ‹¦æˆªæ¯ä¸€æ¬¡è¯·æ±‚ï¼Œå¹¶åœ¨è¯·æ±‚å‰ååšå‡ºç›¸åº”çš„å¤„ç†ã€‚</p><p>ç¬¬äºŒä¸ªåŸåˆ™æ˜¯<strong>å‘ä¸‹å…¼å®¹</strong>ã€‚ç”±äºç”¨æˆ·çš„ç¯å¢ƒå¤æ‚ï¼Œç‰¹åˆ«æ˜¯æµè§ˆå™¨ç‰ˆæœ¬çš„å¾ˆå¤šï¼ŒFetchç‰¹æ€§è™½ç„¶æä¾›äº†æ›´å¥½çš„å¼€å‘ä½“éªŒï¼Œä½†ä¸èƒ½æ”¯æŒä¸€äº›æ—§ç‰ˆæœ¬çš„æµè§ˆå™¨ã€‚è€ŒXMLHttpRequestå¯¹è±¡çš„å…¼å®¹æ€§æ›´å¥½ï¼Œå› æ­¤ï¼Œä¸ºäº†ç¡®ä¿å…¨é“¾è·¯ç›‘æ§çš„è¦†ç›–é¢æ›´å¹¿ï¼Œæˆ‘ä»¬éœ€è¦åŒæ—¶æ”¯æŒXMLHttpRequestå’ŒFetchä¸¤ç§è¯·æ±‚æ–¹å¼ã€‚</p><h2>æˆ‘ä»¬åº”è¯¥å…³æ³¨å“ªäº›è¯·æ±‚å¼‚å¸¸ï¼Ÿ</h2><p>ä»æŠ€æœ¯å±‚é¢æ¥çœ‹ï¼Œå‘èµ·ä¸€æ¬¡è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å…³æ³¨çš„åŒ…æ‹¬ï¼šè¯·æ±‚çš„HTTPçŠ¶æ€ç æ˜¯å¦æ­£å¸¸ï¼Ÿè¯·æ±‚æ˜¯å¦è¶…æ—¶ï¼Ÿè¯·æ±‚æ˜¯å¦è¢«ä¸­æ–­ï¼Ÿ</p><p>é€šè¿‡è®¾è®¡ä¸€å¥—åˆç†çš„ç›‘å¬æœºåˆ¶æ¥å…³æ³¨è¿™äº›çŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥æ›´å¥½åœ°äº†è§£ç”¨æˆ·çš„å®é™…ç½‘ç»œçŠ¶æ€ï¼Œä»è€Œæå‡äº§å“çš„ä½¿ç”¨ä½“éªŒã€‚</p><h3>HTTPçŠ¶æ€ç </h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥ç†è§£ä¸€ä¸‹HTTPçŠ¶æ€ç ï¼Œå®ƒç”±ç‰¹å®šçš„ä¸‰ä½æ•°å­—ç»„æˆï¼Œè¡¨ç¤ºæœåŠ¡å™¨å¯¹å®¢æˆ·ç«¯ï¼ˆé€šå¸¸æ˜¯æµè§ˆå™¨æˆ–Appï¼‰çš„è¯·æ±‚å“åº”ç»“æœï¼Œæ¯”å¦‚è¯·æ±‚æ˜¯å¦æˆåŠŸï¼Œæ˜¯å¦å‡ºç°é”™è¯¯ç­‰ç­‰ã€‚</p><p>å’±ä»¬æ¯”è¾ƒç†Ÿæ‚‰çš„å‡ ä¸ªï¼Œ200è¡¨ç¤ºè¯·æ±‚æˆåŠŸã€301è¡¨ç¤ºæ°¸ä¹…é‡å®šå‘ã€400è¡¨ç¤ºæ— æ•ˆè¯·æ±‚ã€404è¡¨ç¤ºèµ„æºæœªæ‰¾åˆ°ã€500è¡¨ç¤ºæœåŠ¡å™¨é”™è¯¯ç­‰ã€‚</p><p>è™½ç„¶æ‰€æœ‰çš„çŠ¶æ€ç éƒ½å€¼å¾—å…³æ³¨ï¼Œä½†åœ¨ä»£ç å®ç°å±‚é¢ï¼Œæˆ‘ä»¬åº”è¯¥åŒºåˆ†ä¸‰ç§æƒ…å†µï¼šæˆåŠŸå“åº”ã€ä¿¡æ¯å“åº”å’Œé‡å®šå‘å“åº”ï¼Œä»¥åŠé”™è¯¯å“åº”ã€‚é”™è¯¯å“åº”åˆå¯ä»¥ç»†åˆ†ä¸ºå®¢æˆ·ç«¯é”™è¯¯å’ŒæœåŠ¡ç«¯é”™è¯¯ã€‚</p><p>æˆåŠŸå“åº”å±äº2xxèŒƒå›´ï¼Œè¡¨ç¤ºå“åº”çš„ç»“æœéƒ½æ˜¯æ­£å¸¸çš„ã€‚é™¤éæœ‰ç‰¹æ®Šéœ€æ±‚éœ€è¦ç›‘æ§è¿™ä¹ˆç»†çš„ç»´åº¦ï¼Œå¦åˆ™æˆ‘ä»¬ä¸€èˆ¬ä¸ä¼šè®°å½•è¿™äº›æ­£å¸¸ç»“æœã€‚é€šå¸¸ï¼Œè¿™ç±»æ—¥å¿—ä¼šè¢«è®°å½•ä¸ºæ™®é€šæ—¥å¿—ç±»å‹ <code>Info</code>ã€‚</p><p>ä¿¡æ¯å“åº”å±äº1xxèŒƒå›´ï¼Œé‡å®šå‘å“åº”å±äº3xxèŒƒå›´ï¼Œè¿™ç±»çš„çŠ¶æ€ç ä¸»è¦è¡¨ç¤ºä¸€äº›ç‰¹æ®Šçš„å“åº”çŠ¶æ€ï¼ŒåŸåˆ™ä¸Šå¹¶ä¸ä»£è¡¨å­˜åœ¨é—®é¢˜ï¼Œå¦‚æœå‡ºç°è¿™äº›çŠ¶æ€ç ï¼Œæˆ‘ä»¬å¯ä»¥ç»™å®ƒå®šä¹‰ä¸ºå¾…å…³æ³¨çš„æ—¥å¿—ï¼Œä¾‹å¦‚ <code>warn</code> ç±»å‹æ—¥å¿—ã€‚</p><p>é”™è¯¯å“åº”å±äº4xxå’Œ5xxèŒƒå›´ã€‚è¿™ç±»çŠ¶æ€ç è¯´æ˜å­˜åœ¨ç½‘ç»œé—®é¢˜æˆ–è€…æœåŠ¡é—®é¢˜ï¼Œå±äºä¸¥é‡çº§åˆ«ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ—¥å¿—ä¸­ä½¿ç”¨ <code>error</code>ã€<code>hight</code> ä»¥åŠ <code>critical</code> ç­‰ç±»å‹ã€‚</p><p>æœ€ç»ˆï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹è¯„ä¼°è¯·æ±‚å“åº”ç»“æœçš„æ—¥å¿—çº§åˆ«çš„æ–¹æ³•ã€‚</p><pre><code class=\"language-typescript\">export const getFetchStatusLevel = (status: number): TraceDataSeverity =&gt; {\n&nbsp; if (status &gt;= 500) {\n&nbsp; &nbsp; return TraceDataSeverity.Critical\n&nbsp; } else if (status &gt;= 400) {\n&nbsp; &nbsp; return TraceDataSeverity.Error\n&nbsp; } else if (status &gt;= 300) {\n&nbsp; &nbsp; return TraceDataSeverity.Warning\n&nbsp; } else if (status &gt;= 200) {\n&nbsp; &nbsp; return TraceDataSeverity.Info\n&nbsp; } else {\n&nbsp; &nbsp; return TraceDataSeverity.Else\n&nbsp; }\n}\n</code></pre><h3>è¯·æ±‚ä¸­æ–­</h3><p>æˆ‘ä»¬å¯èƒ½ä¼šå¿½è§†ä¸€ç§æƒ…å†µï¼Œå³å½“ç”¨æˆ·åœ¨æµè§ˆå™¨å‘èµ·è¯·æ±‚åï¼Œç”±äºå¼‚æ­¥åŸå› ï¼Œåœ¨ç»“æœå°šæœªè¿”å›æ—¶å—å„ç§å¤–ç•Œçš„å› ç´ å½±å“ï¼Œè¯·æ±‚è¢«åŠ¨åœ°ç»ˆæ­¢äº†ã€‚</p><p>åœ¨æµè§ˆå™¨ç«¯å‘ç”Ÿçš„è¿™ç§è¢«åŠ¨å¼ç»ˆæ­¢è¯·æ±‚ï¼ŒæœåŠ¡å™¨æ˜¯ä¸ä¼šè¿”å›å“åº”ç»“æœå’ŒçŠ¶æ€ç çš„ï¼Œå› æ­¤æˆ‘ä»¬æ— æ³•é€šè¿‡æœåŠ¡å™¨å“åº”ç»“æœè·å–ç»ˆæ­¢çŠ¶æ€ã€‚</p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•é€šè¿‡ä»£ç å‘ç°è¯·æ±‚è¢«ä¸­æ–­å‘¢ï¼Ÿ</p><p>åœ¨XMLHTTPRequestå¯¹è±¡ä¸­ï¼Œabortæ–¹æ³•å¯ä»¥æ•è·è¢«ä¸­æ–­çš„è¯·æ±‚ï¼Œä½†åœ¨æœ¬è¯¾ç¨‹ä¸­æˆ‘ä»¬ä¸ä¼šé‡ç‚¹æ¢è®¨è¿™ç§åœºæ™¯ã€‚æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è‡ªè¡Œæ·±å…¥å­¦ä¹ ã€‚</p><p>æˆ‘ä»¬ä»¥Fetchçš„ç‰¹æ€§ä¸ºä¾‹ã€‚å¯æƒœçš„æ˜¯ï¼ŒFetchå¯¹è±¡é»˜è®¤æ²¡æœ‰äº‹ä»¶ç»ˆæ­¢è¯·æ±‚ï¼Œéœ€è¦é…åˆAbortControllerå¯¹è±¡æ‰èƒ½å®ç°ã€‚</p><p>ä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼Œé€šè¿‡catchæ•è·ï¼Œç„¶åé€šè¿‡errå¯¹è±¡çš„nameå±æ€§å°±èƒ½åˆ¤æ–­æ˜¯å¦æ˜¯AbortErrorç±»å‹ï¼Œå°±èƒ½å‘ç°è¯·æ±‚æ˜¯å¦è¢«ç»ˆæ­¢äº†ã€‚</p><pre><code class=\"language-typescript\">try {\n\tres = await fetch(url, options);\n} catch (err) {\n\tif (err.name == 'AbortError') {\n\t&nbsp; // å‘ç°è¢«ä¸­æ­¢è¯·æ±‚åï¼Œå¤„ç†çš„é€»è¾‘\n\t} else {\n\t\tthrow err\n\t}\n}\n</code></pre><h3>è¯·æ±‚è¶…æ—¶</h3><p>æˆ‘ä»¬ç»å¸¸é‡åˆ°è¿™æ ·çš„æƒ…å†µï¼šç”¨æˆ·åé¦ˆæ‰“å¼€çš„é¡µé¢æ²¡å†…å®¹ï¼Œæˆ–è€…é¡µé¢æ˜¾ç¤ºä¸æ­£å¸¸ã€‚é€šå¸¸æˆ‘ä»¬çš„è§£å†³åŠæ³•æ˜¯å»ºè®®ç”¨æˆ·åˆ·æ–°é¡µé¢ã€‚</p><p>è¿™ç§æƒ…å†µå¤§æ¦‚ç‡æ˜¯ç”¨æˆ·çš„ç½‘ç»œé—®é¢˜å¯¼è‡´çš„ï¼Œä½¿å¾—ä»–ä»¬åœ¨é‚£ä¸€åˆ»æ— æ³•æ­£å¸¸ä½¿ç”¨Webé¡µé¢ã€‚</p><p>é‚£ä¹ˆï¼Œå‰ç«¯åŒå­¦å¯èƒ½å°±ä¼šé—®äº†ï¼Œæ—¢ç„¶è®©ç”¨æˆ·åˆ·æ–°å°±èƒ½è§£å†³é—®é¢˜ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜è¦å…³å¿ƒç”¨æˆ·ç½‘ç»œé—®é¢˜ï¼Ÿ</p><p>ç¡®å®ï¼Œåˆ·æ–°é¡µé¢å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†æˆ‘æ›¾ç»é‡åˆ°ä¸€ä¸ªæ›´æœ‰è¶£çš„è¶…æ—¶é—®é¢˜ã€‚</p><p>æœ‰ä¸€æ¬¡æˆ‘ä»¬æ”¶åˆ°ä¸€ä¸ªç”¨æˆ·åé¦ˆï¼Œè¯´äº§å“çš„å…¶ä¸­ä¸€ä¸ªåŠŸèƒ½æ€»æ˜¯æ— æ³•ä½¿ç”¨ã€‚æˆ‘ä»¬è°ƒæŸ¥äº†æœåŠ¡å™¨æ—¥å¿—ã€ç”¨æˆ·çš„æ¥æºä»¥åŠç”¨æˆ·çš„æ“ä½œè®°å½•ã€‚ç„¶åæˆ‘ä»¬ä¸è¿ç»´åŒäº‹ä¸€èµ·æ£€æŸ¥æ—¥å¿—ï¼Œæœ€ç»ˆå‘ç°è¿™ä¸ªåœ°åŒºæ¥è‡ªå›½å¤–çš„ä¸€ä¸ªæµ·å²›å°å›½å®¶ï¼Œåˆšå¥½ä»–ä»¬çš„ç½‘ç»œæ‹’ç»äº†æˆ‘ä»¬æŸä¸€ç±»åç«¯æœåŠ¡çš„è¯·æ±‚ã€‚</p><p>ä»è¿™ä¸ªç‰¹æ®Šé—®é¢˜æ¥çœ‹ï¼Œå¦‚æœæˆ‘ä»¬èƒ½åšå¥½ç”¨æˆ·è¯·æ±‚è¶…æ—¶çš„ç›‘æ§ï¼Œå¯èƒ½å°±èƒ½æå‰å‘ç°æœåŠ¡è¢«æ‹¦æˆªçš„é—®é¢˜ï¼Œè€Œä¸å¿…ç­‰åˆ°ç”¨æˆ·åé¦ˆåæ‰å»ä¿®å¤ã€‚</p><p>è™½ç„¶è¯·æ±‚è¶…æ—¶å¹¶ä¸å¸¸è§ï¼Œä½†é€šè¿‡ç›‘å¬å¯ä»¥æå‰å‘ç°è¿™ç§å°æ¦‚ç‡çš„é—®é¢˜ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•å®ç°è¯·æ±‚è¶…æ—¶çš„ç›‘å¬å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ä»¥Fetchç‰¹æ€§ä¸ºä¾‹ï¼Œåƒè¯·æ±‚ä¸­æ­¢ä¸€æ ·ï¼ŒFetchç‰¹æ€§å¹¶æœªæä¾›è¶…æ—¶æœºåˆ¶å’Œè¶…æ—¶äº‹ä»¶çš„å®ç°ã€‚æˆ‘ä»¬å¯ä»¥åˆ©ç”¨AbortControllerå¯¹è±¡çš„åŠŸèƒ½ï¼Œç»“åˆPromiseæ¥å®ç°è¶…æ—¶ä¸­æ­¢çš„è¯·æ±‚ã€‚</p><pre><code class=\"language-typescript\">const controller = new AbortController()\nconst { signal } = controller\n\nconst handleTimeout = (delay = 6000) =&gt; {\n\treturn new Promise(_, reject) =&gt; {\n\t\tsetTimeout(() =&gt; {\n\t\t\t// è§¦å‘ä¸­æ­¢\n\t&nbsp; &nbsp; controller.abort()\n&nbsp; &nbsp; &nbsp; reject(new Error('TimeoutAbortError'))\n&nbsp; &nbsp; }, delay)\n\t})\n}\n\n// å¤„ç†è¯·æ±‚è¶…æ—¶\nPromise.race([\n\thandleTimeout(),&nbsp;\n\tfetch(url, {&nbsp;\n\t\tsignal&nbsp;\n\t})\n]).catch(err =&gt; {\n&nbsp; &nbsp; if (err.name === 'TimeoutAbortError') {\n\t&nbsp; &nbsp; // è¯·æ±‚è¶…æ—¶\n&nbsp; &nbsp; }\n})\n</code></pre><h2>å¦‚ä½•åšåˆ°å¿«é€Ÿæ”¯æŒå¤šé¡¹ç›®ï¼Ÿ</h2><p>å‰é¢æˆ‘ä»¬å­¦ä¹ äº†å…¨é“¾è·¯ä¸­éœ€è¦é‡ç‚¹å…³æ³¨çš„ä¸‰ç§æ¥å£è¯·æ±‚çŠ¶æ€ï¼Œå¹¶å±•ç¤ºäº†ç®€è¦çš„ä»£ç ç¤ºä¾‹ã€‚ä½†è¿™äº›ä»£ç å¹¶ä¸èƒ½ç›´æ¥åº”ç”¨åˆ°é¡¹ç›®ä¸Šï¼Œç‰¹åˆ«æ˜¯è¦å¿«é€Ÿæ”¯æŒå¤šç§ä¸åŒæ¶æ„çš„å‰ç«¯é¡¹ç›®çš„æ—¶å€™ï¼Œå°±éœ€è¦é‡‡ç”¨é€šç”¨å‰ç«¯æ’ä»¶çš„æ–¹å¼ã€‚</p><p>æˆ‘ä»¬è¿˜æ˜¯ä»¥Fetchå¯¹è±¡ä¸ºä¾‹ï¼Œåœ¨ä¸è€¦åˆä¸šåŠ¡ä»£ç çš„æƒ…å†µä¸‹ï¼Œå­¦ä¹ å¦‚ä½•å®ç°å¯¹Fetchçš„äºŒæ¬¡å°è£…ã€‚</p><p>Fetch APIæ˜¯Windowsçš„ä¸€ä¸ªå±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡window.fetchè·å–è¯¥å¯¹è±¡ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰Fetchæ‰©å±•å¹¶è¦†ç›–å®ƒï¼Œä¾‹å¦‚ä¸‹é¢ä»£ç ã€‚</p><pre><code class=\"language-typescript\">// src/core/fetch.ts\n\nconst { fetch: originFetch } = window;\n\nconst interceptFetch = () =&gt; {\n\n&nbsp; return async (...args: any) =&gt; {\n\t&nbsp; const [ url, options ] = args;\n\t&nbsp; let res = null;\n\t&nbsp; try {\n&nbsp; &nbsp; &nbsp; res = await originFetch(url, options);\n&nbsp; &nbsp; } catch (err) {\n\t&nbsp; &nbsp; console.log(err)\n&nbsp; &nbsp; }\n&nbsp; &nbsp; return res\n&nbsp; }\n}\n\nexport default interceptFetch\n</code></pre><p>åœ¨ä¸Šè¿°ä»£ç çš„å®ç°æ–¹æ¡ˆä¸­ï¼Œæˆ‘ä»¬é€šè¿‡windowè·å–åŸç”ŸFetchå¯¹è±¡ï¼Œå¹¶å°†å…¶é‡æ–°å‘½åä¸ºoriginFetchï¼Œç„¶åå®šä¹‰äº†æ–°çš„å‡½æ•°interceptFetchï¼Œè¿™æ ·ï¼Œå‡½æ•°å†…éƒ¨å°±ä¼šç›´æ¥è¿”å›å·²ä½¿ç”¨çš„Fetchå¯¹è±¡ã€‚</p><p>ç»è¿‡è¿™æ ·çš„ä»£ç è®¾è®¡ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿå®ç°Fetchå¯¹è±¡çš„æ‹¦æˆªï¼Œç„¶åå°±èƒ½åŸºäºinterceptFetchå‡½æ•°åšä¸€äº›é€»è¾‘ä¸Šçš„å¾®æ”¹é€ ã€‚</p><p>ç”±äºæˆ‘ä»¬éœ€è¦åœ¨ä¸è€¦åˆä»£ç çš„å‰æä¸‹è‡ªåŠ¨æ•è·HTTPçŠ¶æ€ç ï¼Œæ‰€ä»¥ï¼ŒåŸºäºç°æœ‰ä»£ç ï¼Œç»“åˆå‰ç«¯å…¨é“¾è·¯çš„æ•°æ®æŒ‡æ ‡è®¾è®¡æ–¹æ¡ˆï¼Œæˆ‘ä»¬å°†å¢åŠ ä¸‰ä¸ªé€»è¾‘ã€‚</p><p>é¦–å…ˆï¼Œç”±äºæˆ‘ä»¬åªå…³å¿ƒéæ­£å¸¸çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ‹¦æˆªå™¨é‡Œåªå…³æ³¨é2xxçš„çŠ¶æ€ç ã€‚</p><p>å…¶æ¬¡ï¼Œæˆ‘ä»¬å°†åœ¨interceptFetchå‡½æ•°ä¸­æ–°å¢onerrorå‡½æ•°å‚æ•°ï¼Œä»¥ä¾¿åœ¨è¯·æ±‚å¼‚å¸¸æ—¶ä¸ºå¤–å±‚æä¾›è‡ªå®šä¹‰é€»è¾‘å‚æ•°ã€‚</p><p>æœ€åï¼Œåœ¨æ‹¦æˆªå™¨å†…å¢åŠ è¯·æ±‚è€—æ—¶ï¼ŒåŒæ—¶ä»¥elapsedTimeå‚æ•°ä¼ å…¥onerrorå‡½æ•°ã€‚</p><p>å…·ä½“çš„ä»£ç å®ç°é€»è¾‘ï¼Œå‚è€ƒå¦‚ä¸‹ã€‚</p><pre><code class=\"language-typescript\">import { getTimestamp } from \"./util\";\nconst { fetch: originFetch } = window;\n\nexport type OnFetchError = {\n&nbsp; url: string\n&nbsp; status: number\n&nbsp; statusText: string\n&nbsp; method: 'POST' | 'GET'\n&nbsp; body: any,\n&nbsp; elapsedTime: number\n}\n\nexport type InterceptFetchType = {\n&nbsp; onError: (error: OnFetchError) =&gt; void;\n}\n\n// æ‹¦æˆªfetch\nconst interceptFetch = ({ onError } : InterceptFetchType) =&gt; {\n\n&nbsp; return async (...args: any) =&gt; {\n&nbsp; &nbsp; const [url, options] = args;\n&nbsp; &nbsp; const startTime = getTimestamp()\n&nbsp; &nbsp; let res;\n&nbsp; &nbsp; try {\n&nbsp; &nbsp; &nbsp; res = await originFetch(url, options);\n&nbsp; &nbsp; } catch (err) {\n&nbsp; &nbsp; }\n&nbsp; &nbsp; if (!(res.ok &amp;&amp; res.status &gt;= 200 &amp;&amp; res.status &lt; 300)) {\n&nbsp; &nbsp; &nbsp; onError({\n&nbsp; &nbsp; &nbsp; &nbsp; url,\n&nbsp; &nbsp; &nbsp; &nbsp; status: res.status,\n&nbsp; &nbsp; &nbsp; &nbsp; statusText: res.statusText,\n&nbsp; &nbsp; &nbsp; &nbsp; method: options.method,\n&nbsp; &nbsp; &nbsp; &nbsp; body: options.body,\n&nbsp; &nbsp; &nbsp; &nbsp; elapsedTime: getTimestamp() - startTime,\n&nbsp; &nbsp; &nbsp; })\n&nbsp; &nbsp; }\n\n&nbsp; &nbsp; return res\n&nbsp; }\n}\n\nexport default interceptFetch\n</code></pre><p>å®Œæˆä¸Šè¿°fetchæ‹¦æˆªå™¨æ¨¡å—åï¼Œæˆ‘ä»¬å°±èƒ½ä¸ºå‰ç«¯é¡¹ç›®æä¾›ä¸€ç§å¿«é€Ÿã€é«˜æ•ˆçš„æ–¹å¼æ¥å¼•å…¥è¿™ä¸ªfetchæ‹¦æˆªå™¨ã€‚ä¾‹å¦‚ä»¥ä¸‹çš„ç¤ºä¾‹ä»£ç ã€‚</p><pre><code class=\"language-typescript\">// src/index.ts\nimport interceptFetch from './core/fetch'\n\nwindow.fetch = interceptFetch({\n\tonError: (error) =&gt; {\n\t\tconsole.log(error)\n\t}\n})\n</code></pre><p>é€šè¿‡ä¸Šè¿°çš„å®ç°æ–¹æ¡ˆï¼Œæˆ‘ä»¬å°±å®ç°äº†ä¸€ä¸ªç®€å•çš„fetchæ‹¦æˆªå™¨ï¼Œå®ƒèƒ½å¤Ÿå…¨å±€ç›‘å¬æ¥å£è¯·æ±‚å¼‚å¸¸ï¼Œå¹¶æŠŠå¼‚å¸¸ä¿¡æ¯æä¾›ç»™onErrorå‡½æ•°ã€‚</p><p>å½“ç„¶ï¼Œè¿™åªæ˜¯ä¸€ä¸ªåŸºç¡€ç‰ˆæœ¬ï¼Œå®é™…ä½¿ç”¨ä¸­æˆ‘ä»¬å¯èƒ½éœ€è¦å¯¹å…¶è¿›è¡Œè¿›ä¸€æ­¥çš„æ‰©å±•å’Œä¼˜åŒ–ï¼Œæ»¡è¶³æ›´å¤æ‚çš„ä¸šåŠ¡éœ€æ±‚ã€‚</p><h2>æ€»ç»“</h2><p>æœ¬èŠ‚è¯¾é‡ç‚¹å­¦ä¹ äº†å‰ç«¯å…¨é“¾è·¯ç›‘æ§ä¸­çš„æ¥å£å¼‚å¸¸é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ç‰¹åˆ«å…³æ³¨HTTPçŠ¶æ€ç ã€è¯·æ±‚è¶…æ—¶å’Œè¯·æ±‚ä¸­æ–­ã€‚è¿™ä¸‰ç§çŠ¶æ€æ˜¯å‰ç«¯å¼€å‘ä¸­å¸¸é‡åˆ°å’Œéœ€è¦å¤„ç†çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦è®¾è®¡å‡ºä¸€å¥—åˆç†çš„ç›‘å¬æœºåˆ¶æ¥å…³æ³¨è¿™äº›çŠ¶æ€ï¼Œä»è€Œæ›´å¥½åœ°äº†è§£ç”¨æˆ·çš„å®é™…ç½‘ç»œçŠ¶æ€ï¼Œæå‡äº§å“çš„ä½¿ç”¨ä½“éªŒã€‚</p><p>åœ¨è®¾è®¡ç›‘å¬æœºåˆ¶æ—¶ï¼Œåº”éµå¾ªä¸è€¦åˆä¸šåŠ¡å’Œå‘ä¸‹å…¼å®¹çš„åŸåˆ™ã€‚ä¸è€¦åˆä¸šåŠ¡æ˜¯ä¸ºäº†è®©æˆ‘ä»¬è®¾è®¡çš„å…¨é“¾è·¯æ–¹æ¡ˆå…·æœ‰é€šç”¨æ€§ï¼Œè€Œä¸æ˜¯ä»…é’ˆå¯¹æŸä¸ªå…·ä½“é¡¹ç›®ã€‚å‘ä¸‹å…¼å®¹åˆ™æ˜¯ä¸ºäº†ç¡®ä¿å…¨é“¾è·¯ç›‘æ§çš„è¦†ç›–é¢æ›´å¹¿ï¼Œæ”¯æŒXMLHttpRequestå’ŒFetchä¸¤ç§è¯·æ±‚æ–¹å¼ã€‚</p><p>åŸºäºä¸¤ä¸ªåŸåˆ™ï¼Œæˆ‘ä»¬çš„æ–¹æ¡ˆé€‰æ‹©äº†æ‹¦æˆªå’Œæ”¹é€ Fetch APIæˆ–XMLHttpRequestå¯¹è±¡çš„æ–¹æ³•ï¼Œå®ç°å…¨å±€çš„æ¥å£è¯·æ±‚ç›‘å¬ã€‚æœ€åï¼Œæˆ‘è¿˜æä¾›äº†ä¸€ä¸ªåŸºäºFetchAPIçš„æ‹¦æˆªå™¨ç¤ºä¾‹ï¼Œè®©ä½ èƒ½å¤Ÿæ›´æ·±å…¥åœ°ç†è§£å®ç°çš„åŸç†ã€‚</p><p>ä¸‹èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°†ç»§ç»­å­¦ä¹ æ•è·å‰ç«¯èµ„æºå’Œè„šæœ¬é”™è¯¯å¼‚å¸¸ä¿¡æ¯çš„æ–¹æ³•ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ¬æ¥æˆ‘ä»¬é‡ç‚¹è®²è¿°äº†ä»¥Fetchå¯¹è±¡ä¸ºåŸºç¡€çš„è¯·æ±‚æ¥å£æ‹¦æˆªå™¨çš„å®ç°æ–¹æ¡ˆï¼Œå¹¶æ²¡æœ‰é‡ç‚¹æ¢è®¨XMLHttpRequestå¯¹è±¡çš„æ–¹æ¡ˆã€‚</p><p>ç°åœ¨å°±ç•™ä¸ªä½œä¸šç»™ä½ ï¼Œä½ èƒ½å°è¯•ä¸€ä¸‹åŸºäºè¿™èŠ‚è¯¾æåˆ°çš„æ–¹æ¡ˆå’ŒåŸåˆ™ï¼Œè¯•å†™ä¸€ä¸‹åŸºäºXMLHttpRequestå¯¹è±¡çš„æ‹¦æˆªå™¨å—ï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºå’Œæˆ‘äº¤æµã€‚å¦‚æœè§‰å¾—æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿå¯ä»¥æŠŠè¯¾ç¨‹åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·å­¦ä¹ ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ï¼</p>","neighbors":{"left":{"article_title":"08ï½œç½‘é¡µæŒ‡æ ‡ï¼šå¦‚ä½•å¿«é€ŸæŠŠWeb Vitalsé›†æˆåˆ°å®é™…é¡¹ç›®ï¼Ÿ","id":771015},"right":{"article_title":"10ï½œèµ„æºå’Œè„šæœ¬å¼‚å¸¸æŒ‡æ ‡ï¼šç›‘å¬èµ„æºå’Œè„šæœ¬çŠ¶æ€ï¼Œæ”¶é›†å¼‚å¸¸æ•°æ®","id":772007}},"comments":[{"had_liked":false,"id":392576,"user_name":"è‹æœæœ","can_delete":false,"product_type":"c1","uid":2852467,"ip_address":"åŒ—äº¬","ucode":"12A62ED032F345","user_header":"https://static001.geekbang.org/account/avatar/00/2b/86/73/5190bbde.jpg","comment_is_top":true,"comment_ctime":1721270726,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100759401,"comment_content":"å®Œæ•´æºç å…¥å£ï¼š\nhttps:&#47;&#47;github.com&#47;sankyutang&#47;fontend-trace-geekbang-course","like_count":0},{"had_liked":false,"id":392090,"user_name":".","can_delete":false,"product_type":"c1","uid":1379928,"ip_address":"åŒ—äº¬","ucode":"B66F5E7A21D6C8","user_header":"https://static001.geekbang.org/account/avatar/00/15/0e/58/360aa1ce.jpg","comment_is_top":false,"comment_ctime":1719924145,"is_pvip":false,"replies":[{"id":142581,"content":"ä»£ç å·²å‘å¸ƒã€‚é“¾æ¥å¦‚ä¸‹ï¼šhttps:&#47;&#47;github.com&#47;sankyutang&#47;fontend-trace-geekbang-course","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":1327155,"ctime":1720406226,"ip_address":"å¹¿ä¸œ","comment_id":392090,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100759401,"comment_content":"æœ‰ä»£ç ä»“åº“å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1327155,"avatar":"https://static001.geekbang.org/account/avatar/00/14/40/33/11e434ba.jpg","nickname":"ä¸‰æ©‹sankyu ğŸ©","note":"","ucode":"2129405EA8D3D7","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":647661,"discussion_content":"ä»£ç å·²å‘å¸ƒã€‚é“¾æ¥å¦‚ä¸‹ï¼šhttps://github.com/sankyutang/fontend-trace-geekbang-course","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1720406226,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":390333,"user_name":"westfall","can_delete":false,"product_type":"c1","uid":1632773,"ip_address":"ä¸Šæµ·","ucode":"F3F5CB7DF695FC","user_header":"https://static001.geekbang.org/account/avatar/00/18/ea/05/9976b871.jpg","comment_is_top":false,"comment_ctime":1715148211,"is_pvip":false,"replies":[{"id":142070,"content":"axiosæ¯”è¾ƒå—æ¬¢è¿ï¼Œå†å²é¡¹ç›®ç”¨çš„æœ€å¤šã€‚\nä¸è¿‡ï¼Œæœ€è¿‘å‡ å¹´å‡ºç°äº†å¾ˆå¤šä¼˜ç§€çš„è¯·æ±‚åº“æ¡†æ¶","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1327155,"ctime":1715699801,"ip_address":"å¹¿ä¸œ","comment_id":390333,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100759401,"comment_content":"ç°åœ¨åŸºæœ¬ä¸Šéƒ½æ˜¯ axios ä¸€æŠŠæ¢­äº†","like_count":0,"discussions":[{"author":{"id":1327155,"avatar":"https://static001.geekbang.org/account/avatar/00/14/40/33/11e434ba.jpg","nickname":"ä¸‰æ©‹sankyu ğŸ©","note":"","ucode":"2129405EA8D3D7","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":645021,"discussion_content":"axiosæ¯”è¾ƒå—æ¬¢è¿ï¼Œå†å²é¡¹ç›®ç”¨çš„æœ€å¤šã€‚\nä¸è¿‡ï¼Œæœ€è¿‘å‡ å¹´å‡ºç°äº†å¾ˆå¤šä¼˜ç§€çš„è¯·æ±‚åº“æ¡†æ¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1715699801,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3688751,"avatar":"https://static001.geekbang.org/account/avatar/00/38/49/2f/590142fb.jpg","nickname":"JuneRain","note":"","ucode":"2A92727BF9F6DE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":645141,"discussion_content":"å¯¹å•Šï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨åƒ axios è¿™ç±»çš„åº“æ¥å‘è¯·æ±‚å‘¢ï¼Œä¸€èˆ¬ä¸ä¼šåŒæ„è®©ä½ è‡ªå·±å°è£…çš„å§ï¼Œå½“ç„¶äº†å¤§ä½¬çº§åˆ«çš„å¦è¯´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1715817131,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":394435,"user_name":"Aaaaaaaaaaayou","can_delete":false,"product_type":"c1","uid":1073601,"ip_address":"å¹¿ä¸œ","ucode":"67BA315B87587D","user_header":"https://static001.geekbang.org/account/avatar/00/10/61/c1/93031a2a.jpg","comment_is_top":false,"comment_ctime":1726799122,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100759401,"comment_content":"ä»£ç å¥½åƒæœ‰é—®é¢˜ã€‚\nconst err = new Error(&#39;TimeoutAbortError&#39;);\nerr.name åº”è¯¥æ˜¯ Errorï¼Œerr.message æ‰æ˜¯ TimeoutAbortError","like_count":0},{"had_liked":false,"id":390628,"user_name":"JuneRain","can_delete":false,"product_type":"c1","uid":3688751,"ip_address":"å¹¿ä¸œ","ucode":"2A92727BF9F6DE","user_header":"https://static001.geekbang.org/account/avatar/00/38/49/2f/590142fb.jpg","comment_is_top":false,"comment_ctime":1715820880,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100759401,"comment_content":"å¯¹åˆ©ç”¨ AbortController ç»“åˆ setTimeout å®ç°è¯·æ±‚ä¸­æ–­è¿™é‡Œæœ‰ç‚¹ç–‘é—®ï¼š\n   åœ¨é¡¹ç›®è§„æ¨¡è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼ŒæŸäº›åœºæ™¯çŸ­æ—¶é—´å†…ä¼šå‘èµ·å¾ˆå¤šè¯·æ±‚ï¼Œä¾‹å¦‚è¿›å…¥é¦–é¡µçš„åœºæ™¯ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¤§é‡çš„ setTimeout æ˜¯å¦ä¼šæœ‰æ€§èƒ½é—®é¢˜ï¼Ÿ","like_count":0}]}