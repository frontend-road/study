{"id":179238,"title":"15 | return Object.create(new.target.prototype)ï¼šåšæ¡†æ¶è®¾è®¡çš„åŸºæœ¬åŠŸï¼šå†™ä¸€ä¸ªæ ¹ç±»","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å‘¨çˆ±æ°‘ã€‚</p><p>ä»Šå¤©è¿™ä¸€è®²çš„æ ‡é¢˜å‘¢ï¼Œæ¯”è¾ƒé•¿ã€‚å®ƒæ˜¯æˆ‘è¿™ä¸ªä¸“æ ä¸­æœ€é•¿çš„æ ‡é¢˜äº†ã€‚ä¸è¿‡è¯´èµ·æ¥ï¼Œè¿™ä¸ªæ ‡é¢˜çš„æ„ä¹‰è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œå°±æ˜¯è¿”å›ä¸€ä¸ªç”¨<code>Object.create()</code>æ¥åˆ›å»ºçš„å¯¹è±¡ã€‚</p><p>å› ä¸ºç”¨åˆ°äº†<code>return</code>è¿™ä¸ªå­å¥ï¼Œæ‰€ä»¥å®ƒæ˜¾ç„¶åº”è¯¥æ˜¯ä¸€ä¸ªå‡½æ•°ä¸­çš„é€€å‡ºä»£ç ï¼Œæ˜¯ä¸èƒ½åœ¨å‡½æ•°å¤–å•ç‹¬ä½¿ç”¨çš„ã€‚</p><p>è¿™ä¸ªå‡½æ•°å‘¢ï¼Œå¿…é¡»æ˜¯ä¸€ä¸ªæ„é€ å™¨ã€‚æ›´å‡†ç¡®åœ°è¯´ï¼Œæ ‡é¢˜ä¸­çš„ä»£ç å¿…é¡»å·¥ä½œåœ¨æ„é€ è¿‡ç¨‹ä¹‹ä¸­ã€‚å› ä¸ºé™¤äº†<code>return</code>ï¼Œå®ƒè¿˜ç”¨åˆ°äº†ä¸€ä¸ªç§°ä¸ºå…ƒå±æ€§ï¼ˆ<em>meta property</em>ï¼‰çš„ä¸œè¥¿ï¼Œä¹Ÿå°±æ˜¯<code>new.target</code>ã€‚</p><p>è¿„ä»Šä¸ºæ­¢ï¼Œ<code>new.target</code>æ˜¯JavaScriptä¸­å”¯ä¸€çš„ä¸€ä¸ªå…ƒå±æ€§ã€‚</p><h2>ä¸ºä»€ä¹ˆéœ€è¦å®šä¹‰è‡ªå·±çš„æ„å»ºè¿‡ç¨‹</h2><p>é€šè¿‡ä¹‹å‰çš„è¯¾ç¨‹ï¼Œä½ åº”è¯¥çŸ¥é“ï¼šJavaScriptä½¿ç”¨åŸå‹ç»§æ‰¿æ¥æ­å»ºè‡ªå·±çš„é¢å‘å¯¹è±¡çš„ç»§æ‰¿ä½“ç³»ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è¯ç”Ÿäº†ä¸¤ç§æ–¹æ³•ï¼š</p><ol>\n<li>ä½¿ç”¨ä¸€èˆ¬å‡½æ•°çš„æ„é€ å™¨ï¼›</li>\n<li>ä½¿ç”¨ECMAScript 6ä¹‹åçš„ç±»ã€‚</li>\n</ol><p>ä»æ ¹åº•ä¸Šæ¥è¯´ï¼Œè¿™ä¸¤ç§æ–¹æ³•çš„æ„å»ºè¿‡ç¨‹éƒ½æ˜¯åœ¨JavaScriptå¼•æ“ä¸­äº‹å…ˆå®šä¹‰å¥½äº†çš„ï¼Œä¾‹å¦‚åœ¨æ—§å¼é£æ ¼çš„æ„é€ å™¨ä¸­ï¼ˆä»¥ä»£ç <code>new X</code>ä¸ºä¾‹ï¼‰ï¼Œå¯¹è±¡<code>this</code>å®é™…ä¸Šæ˜¯ç”±newè¿ç®—ä¾æ®<code>X.prototype</code>æ¥åˆ›å»ºçš„ã€‚å¾ªæ­¤å‰ä¾‹ï¼ŒECMAScript 6ä¸­çš„ç±»ï¼Œåœ¨åˆ›å»º<code>this</code>å¯¹è±¡æ—¶ä¹Ÿéœ€è¦è¿™ä¸ª<code>X.prototype</code>æ¥ä½œä¸ºåŸå‹ã€‚</p><!-- [[[read_end]]] --><p>ä½†æ˜¯ï¼ŒæŒ‰ç…§ECMAScript 6çš„è®¾è®¡ï¼Œåˆ›å»ºè¿™ä¸ª<code>this</code>å¯¹è±¡çš„è¡Œä¸ºä¸æƒåŠ›ï¼Œå°†é€šè¿‡<code>super()</code>è¢«å±‚å±‚è½¬äº¤ï¼Œç›´åˆ°çˆ¶ç±»æˆ–ç¥–å…ˆç±»ä¸­æœ‰èƒ½åŠ›åˆ›å»ºè¯¥å¯¹è±¡çš„é‚£ä¸ªæ„é€ å™¨æˆ–ç±»ä¸ºæ­¢ã€‚è€Œåœ¨è¿™æ—¶ï¼Œçˆ¶ç±»æ˜¯ä¸å¯èƒ½çŸ¥é“<code>new X</code>è¿ç®—ä¸­çš„è¿™ä¸ªå­ç±»ä¸ºä½•çš„ï¼Œå› ä¸ºçˆ¶ç±»é€šå¸¸æ˜¯æ›´æ—©å…ˆè¢«å£°æ˜å‡ºæ¥çš„ã€‚æ—¢ç„¶å®ƒçš„ä»£ç ä¸€æ—©å°±è¢«å†³å®šäº†ï¼Œé‚£ä¹ˆå¯¹å­ç±»é€æ˜ä¹Ÿå°±æ˜¯æ­£å¸¸çš„äº†ã€‚</p><p>äºæ˜¯çœŸæ­£çš„çŸ›ç›¾åœ¨è¿™æ—¶å€™å°±å‡ºç°äº†ï¼š<strong>çˆ¶ç±»å¹¶ä¸çŸ¥é“å­ç±»<code>X</code>ï¼Œå´åˆéœ€è¦<code>X.prototype</code>æ¥ä¸ºå®ä¾‹<code>this</code>è®¾ç½®åŸå‹ã€‚</strong></p><p>ECMAScriptä¸ºæ­¤æå‡ºäº†<code>new.target</code>è¿™ä¸ªä¸œè¥¿ï¼Œå®ƒå°±æŒ‡å‘ä¸Šé¢çš„<code>X</code>ï¼Œå¹¶ä¸”éšç€<code>super()</code>è°ƒç”¨ä¸€å±‚å±‚åœ°å‘ä¸Šä¼ é€’ï¼Œä»¥ä¾¿æœ€ç»ˆåˆ›å»ºè€…ç±»å¯ä»¥ä½¿ç”¨å®ƒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä»¥ä¹‹å‰è®¨è®ºè¿‡çš„<code>Date()</code>ä¸ºä¾‹ï¼Œå®ƒçš„æ„å»ºè¿‡ç¨‹å¿…ç„¶åŒ…æ‹¬â€œç±»ä¼¼äºâ€å¦‚ä¸‹ä¸¤è¡Œä»£ç æ¥å¤„ç†<code>this</code>ï¼š</p><pre><code>// åœ¨JavaScriptå†…ç½®ç±»Date()ä¸­å¯èƒ½çš„å¤„ç†é€»è¾‘\nfunction _Date() {\n  this = Object.Create(Date.prototype, { _internal_slots });\n  Object.setPrototypeOf(this, new.target.prototype);\n  ...\n}\n</code></pre><ol>\n<li>ä¾æ®çˆ¶ç±»çš„åŸå‹ï¼Œä¹Ÿå°±æ˜¯Date.prototypeæ¥åˆ›å»ºå¯¹è±¡å®ä¾‹thisï¼Œå› ä¸ºå®ƒæ˜¯çˆ¶ç±»åˆ›å»ºå‡ºæ¥çš„ï¼›</li>\n<li>ç½®thiså®ä¾‹çš„åŸå‹ä¸ºå­ç±»çš„prototypeï¼Œä¹Ÿå°±æ˜¯new.target.prototypeï¼Œå› ä¸ºå®ƒæœ€ç»ˆæ˜¯å­ç±»çš„å®ä¾‹ã€‚</li>\n</ol><p>è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆProxy()ç±»çš„constructå¥æŸ„ä¸Reflect.construct()æ–¹æ³•ä¸­éƒ½éœ€è¦ä¼ é€’ä¸€ä¸ªç§°ä¸º<code>_newTarget</code>_çš„é¢å¤–å‚æ•°çš„åŸå› ã€‚<code>new.target</code>è¿™ä¸ªå…ƒå±æ€§ï¼Œäº‹å®ä¸Šå°±æ˜¯åœ¨æ„é€ è¿‡ç¨‹ä¸­ï¼Œåœ¨<code>super()</code>è°ƒç”¨çš„å‚æ•°ç•Œé¢ä¸Šä¼ é€’çš„ã€‚åªä¸è¿‡ä½ åœ¨æ„é€ æ–¹æ³•ä¸­å†™<code>super()</code>çš„æ—¶å€™ï¼Œæ˜¯JavaScriptå¼•æ“éšå¼åœ°å¸®ä½ ä¼ é€’äº†è¿™ä¸ªå‚æ•°è€Œå·²ã€‚</p><p>ä½ å¯èƒ½å·²ç»å‘ç°äº†é—®é¢˜çš„å…³é”®ï¼š<strong>æ˜¯<code>super()</code>åœ¨å¸®åŠ©ä½ ä¼ é€’è¿™ä¸ª<code>new.target</code>å‚æ•°ï¼</strong></p><p>é‚£ä¹ˆï¼Œå¦‚æœå‡½æ•°ä¸­æ²¡æœ‰è°ƒç”¨<code>super()</code>å‘¢ï¼Ÿ</p><h2>å…ˆè¡¥ä¸ªè¯¾ï¼šå…³äºéšå¼çš„æ„é€ æ–¹æ³•</h2><p>åœ¨ä¹‹å‰çš„è¯¾ç¨‹ä¸­æˆ‘æåŠè¿‡ï¼Œå½“ç±»å£°æ˜ä¸­æ²¡æœ‰â€œconstructor()â€æ–¹æ³•æ—¶ï¼ŒJavaScriptä¼šä¸»åŠ¨ä¸ºå®ƒåˆ›å»ºä¸€ä¸ªã€‚å…³äºè¿™ä¸€ç‚¹å½“æ—¶å¹¶æ²¡æœ‰å±•å¼€æ¥ç»†è®²ï¼Œæ‰€ä»¥è¿™é‡Œå…ˆè¡¥ä¸ªè¯¾ã€‚</p><p>é¦–å…ˆï¼Œä½ é€šå¸¸å†™ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œéƒ½ä¸å¤ªä¼šä¸»åŠ¨å»å£°æ˜æ„é€ æ–¹æ³•â€œconstructor()â€ã€‚å› ä¸ºå¤šæ•°æƒ…å†µä¸‹ï¼Œç±»ä¸»è¦æ˜¯å®šä¹‰å®ƒçš„å®ä¾‹çš„é‚£äº›æ€§è´¨ï¼Œä¾‹å¦‚æ–¹æ³•æˆ–å±æ€§å­˜å–å™¨ã€‚æç«¯çš„æƒ…å†µä¸‹ï¼Œä½ ä¹Ÿå¯èƒ½åªå†™ä¸€ä¸ªç©ºçš„ç±»ï¼Œåªæ˜¯ä¸ºäº†å°†çˆ¶ç±»åšä¸€æ¬¡ç®€å•çš„æ´¾ç”Ÿã€‚ä¾‹å¦‚ï¼š</p><pre><code>class MyClass extends Object {}\n</code></pre><p>æ— è®ºæ˜¯å“ªç§æƒ…å†µï¼Œæ€»ä¹‹<strong>ä½ å°±æ˜¯æ²¡æœ‰å†™â€œconstructor()â€æ–¹æ³•</strong>ã€‚æœ‰è¶£çš„æ˜¯ï¼Œäº‹å®ä¸ŠJavaScriptåˆå§‹åŒ–å‡ºæ¥çš„è¿™ä¸ªMyClassç±»ï¼Œï¼ˆå®ƒä½œä¸ºä¸€ä¸ªå‡½æ•°ï¼‰å°±æ˜¯æŒ‡å‘é‚£ä¸ªâ€œconstructor()â€æ–¹æ³•çš„ï¼Œä¸¤è€…æ˜¯åŒä¸€ä¸ªä¸œè¥¿ã€‚</p><p>ä¸è¿‡ï¼Œè¿™ä¸€ç‚¹ä¸å¤ªå®¹æ˜“è¯å®ã€‚å› ä¸ºåœ¨â€œconstructor()â€æ–¹æ³•å†…éƒ¨æ— æ³•è®¿é—®å®ƒè‡ªèº«ï¼Œä¸èƒ½å†™å‡ºç±»ä¼¼â€œ<em>constructor===MyClass</em>â€è¿™æ ·çš„æ£€æµ‹æ¡ä»¶æ¥ã€‚æ‰€ä»¥ï¼Œä½ åªèƒ½åœ¨ECMAScriptçš„è§„èŒƒæ–‡æ¡£ä¸­å»ç¡®è®¤è¿™ä¸€ç‚¹ã€‚</p><p>é‚£ä¹ˆï¼Œæ—¢ç„¶MyClasså°±æ˜¯constructor()æ–¹æ³•ï¼Œè€Œç”¨æˆ·ä»£ç åˆæ²¡æœ‰å£°æ˜è¿™ä¸ªæ–¹æ³•ã€‚é‚£ä¹ˆè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>ECMAScriptè§„èŒƒå°±çº¦å®šï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¼•æ“éœ€è¦å‘ç”¨æˆ·ä»£ç ä¸­æ’å…¥ä¸€æ®µç¡¬ä»£ç ã€‚ä¹Ÿå°±æ˜¯å¸®ä½ å†™ä¸€ä¸ªç¼ºçœçš„æ„é€ æ–¹æ³•ï¼Œç„¶åå¼•æ“ä¸ºè¿™ä¸ªç¡¬ä»£ç çš„ä»£ç æ–‡æœ¬åŠ¨æ€åœ°ç”Ÿæˆä¸€ä¸ªâ€œæ„é€ æ–¹æ³•â€å£°æ˜ï¼Œæœ€åå†å°†å®ƒåˆå§‹åŒ–ä¸ºç±»MyClass()ã€‚è¿™é‡Œçš„â€œç¡¬ä»£ç â€åŒ…æ‹¬ä¸¤ä¸ªä»£ç ç‰‡æ–­ï¼Œåˆ†åˆ«å¯¹åº”äºâ€œæœ‰/æ²¡æœ‰â€<code>extends</code>å£°æ˜çš„æƒ…å†µã€‚å¦‚ä¸‹ï¼š</p><pre><code>// å¦‚æœåœ¨classå£°æ˜ä¸­æœ‰extends XXX\nclass MyClass extends XXX {\n  // è‡ªåŠ¨æ’å…¥çš„ç¼ºçœæ„é€ æ–¹æ³•\n  constructor(...args) {\n    super(...args);\n  }\n  ...\n}\n \n// å¦‚æœåœ¨classå£°æ˜ä¸­æ²¡æœ‰å£°æ˜extends\nclass MyClass {\n  // è‡ªåŠ¨æ’å…¥çš„ç¼ºçœæ„é€ æ–¹æ³•\n  constructor() {}\n  ...\n}\n</code></pre><p>åœ¨å£°æ˜ä¸­å¦‚æœæœ‰extendsè¯­æ³•çš„è¯ï¼Œç¼ºçœæ„é€ æ–¹æ³•ä¸­å°±æ’å…¥ä¸€ä¸ªSuperCall()ï¼›è€Œå¦‚æœå£°æ˜ä¸­æ²¡æœ‰extendsï¼Œé‚£ä¹ˆç¼ºçœæ„é€ æ–¹æ³•å°±æ˜¯ä¸€æ®µç©ºçš„ä»£ç ï¼Œä»€ä¹ˆä¹Ÿæ²¡æœ‰ã€‚</p><p>æ‰€ä»¥ï¼Œç°åœ¨ä½ çœ‹åˆ°äº†ä½ æ‰€æå‡ºçš„é—®é¢˜çš„ç¬¬ä¸€ä¸ªç­”æ¡ˆï¼š</p><p><span class=\"orange\">å¦‚æœæ²¡æœ‰å£°æ˜æ„é€ æ–¹æ³•ï¼ˆå› æ­¤æ²¡æœ‰super()è°ƒç”¨ï¼‰ï¼Œé‚£ä¹ˆå°±è®©å¼•æ“å·å·å£°æ˜ä¸€ä¸ªã€‚</span></p><h2>éæ´¾ç”Ÿç±»æ˜¯ä¸ç”¨è°ƒç”¨super()çš„</h2><p>å¦ä¸€ç§ç‰¹æ®Šæƒ…å†µå°±æ˜¯ä¸Šé¢çš„è¿™ç§éæ´¾ç”Ÿç±»ï¼Œä¹Ÿå°±åœ¨ç±»å£°æ˜ä¸­è¯­æ³•ä¸­æ²¡æœ‰â€œextends XXXâ€çš„è¿™ç§æƒ…å†µã€‚ä¸Šé¢çš„ç¡¬ä»£ç ä¸­ï¼ŒJavaScriptå¼•æ“ä¸ºå®ƒç”Ÿæˆçš„å°±æ˜¯ä¸€ä¸ªç©ºçš„æ„é€ æ–¹æ³•ï¼Œç›®çš„å‘¢ï¼Œä¹Ÿå°±æ˜¯ä¸ºäº†åˆ›å»ºç±»æ‰€å¯¹åº”çš„é‚£ä¸ªå‡½æ•°ä½“ã€‚å¹¶ä¸”ï¼Œè²Œä¼¼åˆ«æ— å®ƒç”¨ã€‚</p><p>è¿™ç§éæ´¾ç”Ÿç±»çš„å£°æ˜éå¸¸ç‰¹åˆ«ï¼Œæœ¬è´¨ä¸Šæ¥è¯´ï¼Œå®ƒæ˜¯å…¼å®¹æ—§çš„JavaScriptæ„é€ å™¨å£°æ˜çš„ä¸€ç§è¯­æ³•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœâ€œextends XXXâ€ä¸å£°æ˜ï¼Œé‚£ä¹ˆç©ºçš„æ„é€ æ–¹æ³•å’Œç©ºçš„å‡½æ•°ä¸€æ ·ï¼›å¹¶ä¸”å³ä½¿æ˜¯å£°æ˜äº†å…·ä½“çš„æ„é€ æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒçš„è¡Œä¸ºä¹Ÿä¸ä¼ ç»Ÿçš„æ„é€ å‡½æ•°ä¸€æ ·ã€‚</p><p>ä¸ºäº†è¿™ç§ä¸€è‡´æ€§ï¼Œå½“è¿™ç§éæ´¾ç”Ÿç±»çš„æ„é€ æ–¹æ³•è¿”å›æ— æ•ˆå€¼æ—¶ï¼Œå®ƒå’Œä¼ ç»Ÿçš„æ„é€ å‡½æ•°ä¹Ÿä¼šå‘ç”Ÿç›¸åŒçš„è¡Œä¸ºâ€”â€”â€œè¿”å›å·²åˆ›å»ºçš„<code>this</code>â€ã€‚ä¾‹å¦‚ï¼š</p><pre><code>class MyClass extends Object {\n  constructor() {\n    return 1;\n  }\n}\n\nfunction MyConstructor() {\n  return 1;\n}\n</code></pre><p>æµ‹è¯•å¦‚ä¸‹ï¼š</p><pre><code>&gt; new MyClass;\n{}\n\n&gt; new MyConstructor;\n{}\n</code></pre><p>è¿™æ ·çš„ç›¸ä¼¼æ€§è¿˜åŒ…æ‹¬ä¸€ä¸ªé‡è¦çš„ã€ä¸ä»Šå¤©è®¨è®ºçš„ä¸»é¢˜ç›¸å…³çš„ç‰¹æ€§ï¼š**éæ´¾ç”Ÿç±»ä¹Ÿä¸éœ€è¦è°ƒç”¨<code>super()</code>ã€‚**è‡³äºåŸå› ï¼Œåˆ™æ˜¯éå¸¸æ˜æ˜¾çš„ï¼Œå› ä¸ºâ€œåˆ›å»º<code>this</code>å®ä¾‹â€çš„è¡Œä¸ºæ˜¯ç”±å¼•æ“éšå¼å®Œæˆçš„ï¼Œå¯¹äºä¼ ç»Ÿçš„æ„é€ å™¨æ˜¯è¿™æ ·ï¼Œå¯¹äºéæ´¾ç”Ÿç±»çš„æ„é€ æ–¹æ³•ï¼Œä¹Ÿæ˜¯è¿™æ ·ã€‚äºŒè€…çš„è¡Œä¸ºä¸€è‡´ã€‚</p><p>é‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹è¿˜æœ‰æ²¡æœ‰â€œnew.targetâ€å‘¢ï¼Ÿäº‹å®æ˜¯ï¼š</p><p><span class=\"orange\">åœ¨ä¼ ç»Ÿçš„æ„é€ å‡½æ•°å’Œéæ´¾ç”Ÿç±»çš„æ„é€ æ–¹æ³•ä¸­ï¼Œä¸€æ ·æ˜¯æœ‰<code>new.target</code>çš„ã€‚</span></p><p>ç„¶è€Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ<code>new.target</code>æ˜¯éœ€è¦ç”¨<code>super()</code>æ¥ä¼ é€’çš„å‘€ï¼Ÿï¼</p><p>æ˜¯çš„ï¼Œè¿™ä¸¤ç§å‡½æ•°ä¸ç±»çš„ç¡®ä¸è°ƒç”¨<code>super()</code>ï¼Œä½†è¿™åªè¯´æ˜å®ƒä¸éœ€è¦å‘çˆ¶ç±»ä¼ é€’<code>new.target</code>è€Œå·²ã€‚è¦çŸ¥é“ï¼Œå½“å®ƒè‡ªå·²ä½œä¸ºçˆ¶ç±»æ—¶ï¼Œè¿˜æ˜¯éœ€è¦æ¥å—ç”±å®ƒçš„å­ç±»ä¼ é€’æ¥çš„é‚£äº›<code>new.target</code>çš„ã€‚</p><p>æ‰€ä»¥ï¼Œä½ æ‰€æå‡ºçš„é—®é¢˜è¿˜æœ‰ç¬¬äºŒä¸ªç­”æ¡ˆï¼š</p><p><span class=\"orange\">å¦‚æœæ˜¯ä¸ä½¿ç”¨<code>super()</code>è°ƒç”¨çš„ç±»æˆ–æ„é€ å™¨å‡½æ•°ï¼Œé‚£ä¹ˆå¯ä»¥è®©å®ƒåšæ ¹ç±»ï¼ˆç¥–å…ˆç±»ï¼‰ã€‚</span></p><h2>å®šåˆ¶çš„æ„é€ æ–¹æ³•</h2><p>ä½ åº”è¯¥è¿˜è®°å¾—ï¼Œä¸Šé¢è¿™ä¸¤ç§æƒ…å†µçš„ç±»æˆ–æ„é€ å™¨å‡½æ•°éƒ½æ˜¯å¯ä»¥é€šè¿‡<code>return</code>æ¥è¿”å›å€¼çš„ã€‚ä¹‹å‰çš„è¯¾ç¨‹ä¸­ä¹Ÿä¸€å†å¼ºè°ƒè¿‡ï¼š</p><ul>\n<li>åœ¨è¿™æ ·çš„ç±»ä¸­è¿”å›éå¯¹è±¡å€¼ï¼Œé‚£ä¹ˆå°±é»˜è®¤æ›¿æ¢æˆå·²åˆ›å»ºçš„<code>this</code>ï¼›</li>\n<li>è¿”å›é€šè¿‡<code>return</code>ä¼ å‡ºçš„å¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯ä¸€ä¸ªç”¨æˆ·å®šåˆ¶çš„åˆ›å»ºè¿‡ç¨‹ï¼‰ã€‚</li>\n</ul><p>æ‰€ä»¥å¦‚æœæ˜¯ç”¨æˆ·å®šåˆ¶çš„åˆ›å»ºè¿‡ç¨‹ï¼Œé‚£ä¹ˆå°±å›åˆ°äº†æœ€å¼€å§‹çš„é‚£ä¸ªé—®é¢˜ä¸Šï¼š</p><p><span class=\"orange\">çˆ¶ç±»å¹¶ä¸çŸ¥é“å­ç±»<code>X</code>ï¼Œå´åˆéœ€è¦<code>X.prototype</code>æ¥ä¸ºå®ä¾‹<code>this</code>è®¾ç½®åŸå‹ã€‚</span></p><p>å› æ­¤äº‹å®ä¸Šå¦‚æœç”¨æˆ·è¦åœ¨â€œæ ¹ç±»/ç¥–å…ˆç±»â€çš„å±‚çº§ä¸Šå®ç°ä¸€ä¸ªå®šåˆ¶è¿‡ç¨‹ï¼Œå¹¶ä¸”è¿˜éœ€è¦è¿”å›ä¸€ä¸ªå­ç±»æ‰€éœ€è¦çš„å®ä¾‹ï¼Œé‚£ä¹ˆå®ƒé™¤äº†è‡ªå·±åˆ›å»º<code>this</code>ä¹‹å¤–ï¼Œè¿˜éœ€è¦è°ƒç”¨ä¸€ä¸ªä¸ºå®ä¾‹<code>x</code>ç½®å®ƒçš„ç±»åŸå‹X.prototypeçš„è¿‡ç¨‹ï¼š</p><pre><code>// å‚è§æœ¬è®²å¼€å§‹çš„_Date()è¿‡ç¨‹\nObject.setPrototypeOf(x, X.prototype)\n</code></pre><p>ç”±äº<code>X.prototype</code>æ˜¯å­ç±»é€šè¿‡<code>super()</code>ä¼ é€’æ¥çš„ï¼Œå› æ­¤ä½œä¸ºçˆ¶ç±»çš„<code>MyClass</code>ä¸­é€šå¸¸éœ€è¦å¤„ç†çš„ä»£ç ï¼Œå°±å˜æˆäº†<code>ä¸ºthiså¼•ç”¨ç½®new.target.prototypeè¿™ä¸ªåŸå‹</code>ã€‚</p><pre><code>// ï¼ˆä¹Ÿå°±æ˜¯ï¼‰\nObject.setPrototypeOf(this, new.target.prototype);\n</code></pre><p>ç„¶è€Œè¿˜æœ‰ä¸€ç§æ›´åŠ ç‰¹æ®Šçš„æƒ…å†µï¼šç±»çš„æ„é€ æ–¹æ³•ä¸­ä¹Ÿå¯èƒ½æ²¡æœ‰<code>this</code>è¿™ä¸ªå¼•ç”¨ã€‚</p><pre><code>class MyClass extends null {\n  constructor() {\n    ...\n  }\n}\n</code></pre><p>ä¾‹å¦‚ï¼Œå½“ä½ ä¸ºextendsè¿™ä¸ªå£°æ˜ç½®nullå€¼æ—¶ï¼Œç”±äº<code>extends</code>å£°æ˜<code>MyClass</code>æ´¾ç”Ÿè‡ª<code>null</code>ï¼ˆä¹Ÿå°±æ˜¯æ²¡æœ‰åŸå‹ï¼‰ï¼Œé‚£ä¹ˆåœ¨æ„é€ æ–¹æ³•ä¸­ä¹Ÿæ˜¯ä¸èƒ½è°ƒç”¨<code>super()</code>çš„ã€‚å¹¶ä¸”ç”±äºæ²¡æœ‰åŸå‹ï¼ŒJavaScriptå¼•æ“ä¹Ÿä¸ä¼šç¼ºçœä¸ºè¿™ä¸ª<code>MyClass</code>åˆ›å»º<code>this</code>å®ä¾‹ã€‚æ‰€ä»¥ï¼Œåœ¨è¿™ä¸ªâ€œconstructor()â€æ„é€ æ–¹æ³•ä¸­ï¼Œæ—¢æ²¡æœ‰<code>this</code>ä¹Ÿä¸èƒ½è°ƒç”¨<code>super()</code>ã€‚</p><p>æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>ä½ å¿…é¡»ç¡®ä¿¡è¿™æ ·çš„ç±»åªèƒ½ç”¨ä½œæ ¹ç±»ï¼ˆæ˜¾ç„¶ï¼Œå®ƒä¸æ˜¯ä»»ä½•ä¸œè¥¿æ´¾ç”Ÿå‡ºæ¥çš„å­ç±»ï¼‰ã€‚å› æ­¤ï¼Œåœ¨è¯­ä¹‰ä¸Šï¼Œå®ƒå¯ä»¥è‡ªå·±åˆ›å»ºä¸€ä¸ªå®ä¾‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ ·çš„æ ¹ç±»ä¹‹æ‰€ä»¥å­˜åœ¨çš„ç›®çš„ï¼Œå°±æ˜¯ç”¨æ¥æ›¿ä»£æœ¬è®²å‰é¢è®¨è®ºçš„æ‰€æœ‰è¿‡ç¨‹ï¼Œä»¥ä¸ºâ€œå®ƒçš„å­ç±»åˆ›å»ºä¸€ä¸ª<code>this</code>å®ä¾‹â€ä¸ºå·±ä»»ã€‚å› æ­¤ï¼Œå®Œæ•´å®ç°è¿™ä¸€ç›®çš„çš„æœ€ç®€å•æ–¹å¼ï¼Œå°±æ˜¯æœ¬è®²æ ‡é¢˜ä¸­çš„è¿™ä¸€è¡Œä»£ç ï¼š</p><pre><code>class MyClass extends null {\n  constructor() {\n    return Object.create(new.target.prototype);\n  }\n}\n\n// æµ‹è¯•\nconsole.log(new MyClass);  // MyClass {}\nconsole.log(new (class MyClassEx extends MyClass{})); // MyClassEx {}\n</code></pre><p>æ‰€ä»¥ï¼Œä»…ä»…æ˜¯è¿™æ ·çš„ä¸€è¡Œä»£ç ï¼Œå°±å‡ ä¹å·²ç»ç©·å°½äº†JavaScriptç±»æ„å»ºè¿‡ç¨‹çš„å…¨éƒ¨ç§˜å¯†ã€‚</p><h2>å…¶ä»–</h2><p>å½“ç„¶å¦‚æœçˆ¶ç±»å¹¶ä¸å…³å¿ƒå­ç±»å®ä¾‹çš„åŸå‹ï¼Œé‚£ä¹ˆå®ƒè¿”å›ä»»ä½•çš„å¯¹è±¡éƒ½æ˜¯å¯ä»¥çš„ï¼Œå­ç±»åœ¨super()çš„è¿”å›ä¸­å¹¶ä¸æ£€æŸ¥åŸå‹ç»§æ‰¿é“¾çš„ç»´æŠ¤æƒ…å†µã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç¡®å®å­˜åœ¨â€œå­ç±»åˆ›å»ºå‡ºéè¯¥ç±»çš„å®ä¾‹â€çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼š</p><pre><code>class MyClass {\n  constructor() { return new Date };\n}\n\nclass MyClassEx extends MyClass {\n  constructor() { super() }; // or default\n  foo() {\n    console.log('check only');\n  }\n}\n\nvar x = new MyClassEx;\nconsole.log(x instanceof MyClassEx); // false\nconsole.log('foo' in x); // fals\n</code></pre><p>ä»Šå¤©çš„å†…å®¹å°±åˆ°è¿™é‡Œã€‚æœ‰å…³ç»§æ‰¿ã€åŸå‹ä¸ç±»çš„æ‰€æœ‰å†…å®¹å°±æš‚æ—¶å‘Šä¸€æ®µè½äº†ã€‚ä¸‹ä¸€è®²å¼€å§‹ï¼Œæˆ‘å°†ä¾§é‡ä¸ºä½ ä»‹ç»å¯¹è±¡çš„æœ¬è´¨ï¼Œä»¥åŠå®ƒçš„åº”ç”¨ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>å½“ç„¶ï¼Œè¿™ä¸€è®²ä»ç„¶ä¼šç•™æœ‰ä¸€ä¸ªä¹ é¢˜ã€‚ä»…ä»…ä¸€ä¸ªè€Œå·²ï¼š</p><ul>\n<li><code>new.target</code>ä¸ºä»€ä¹ˆç§°ä¸ºå…ƒå±æ€§ï¼Œå®ƒä¸<code>a.b</code>ï¼ˆä¾‹å¦‚super.xxxï¼Œæˆ–è€…â€™aâ€™.toStringï¼‰æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</li>\n</ul><p>å¸Œæœ›ä½ å–œæ¬¢æˆ‘çš„åˆ†äº«ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠæ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚</p>","comments":[{"had_liked":false,"id":163568,"user_name":"Astrogladiator-åŸƒè’‚çº³åº¦æ–¯","can_delete":false,"product_type":"c1","uid":1381243,"ip_address":"","ucode":"85015092B8E12A","user_header":"https://static001.geekbang.org/account/avatar/00/15/13/7b/74e90531.jpg","comment_is_top":false,"comment_ctime":1576746609,"is_pvip":true,"replies":[{"id":"62446","content":"è°¢è°¢ã€‚ç¡®å®æ˜¯æ­£ç¡®ç­”æ¡ˆä¹‹ä¸€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Aiming","uid":"1521669","ctime":1576949402,"ip_address":"","comment_id":163568,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14461648497","product_id":100039701,"comment_content":"new.targetä¸ºä»€ä¹ˆç§°ä¸ºå…ƒå±æ€§ï¼Œå®ƒä¸a.bï¼ˆä¾‹å¦‚ super.xxxï¼Œæˆ–è€…â€™aâ€™.toStringï¼‰æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ<br>ä¸ªäººç†è§£æ˜¯new.targetæ˜¯ç”¨æ¥æè¿°æ„é€ å™¨æœ¬èº«çš„å±æ€§ï¼ŒæŒ‡ä»£æ˜¯å½“å‰è¿™ä¸ªæ„é€ å™¨å‡½æ•°thisï¼Œ å®ƒä¸å±äºå®ä¾‹å¯¹è±¡çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒå¯ä»¥ç”±superå‡½æ•°ä¼ é€’è‡³æ ¹ç±»ï¼Œå¹¶æœ€ç»ˆç”±æ ¹ç±»åˆ›å»ºå¸¦æœ‰å­ç±»å®ä¾‹çš„å¯¹è±¡ã€‚","like_count":3,"discussions":[{"author":{"id":1521669,"avatar":"https://static001.geekbang.org/account/avatar/00/17/38/05/7beecd5d.jpg","nickname":"Aiming","note":"","ucode":"66292B32F9960A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478454,"discussion_content":"è°¢è°¢ã€‚ç¡®å®æ˜¯æ­£ç¡®ç­”æ¡ˆä¹‹ä¸€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576949402,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":162850,"user_name":"è¡Œé—®","can_delete":false,"product_type":"c1","uid":1039504,"ip_address":"","ucode":"F3AED699218475","user_header":"https://static001.geekbang.org/account/avatar/00/0f/dc/90/c980113a.jpg","comment_is_top":false,"comment_ctime":1576622780,"is_pvip":false,"replies":[{"id":"61906","content":"Oh... è¿™ä¸ªé—®é¢˜åœ¨ä¹‹å‰çš„è¯¾ç¨‹ä¸­è®²è¿‡ï¼Œæ‰€ä»¥è¿™é‡Œæ²¡æœ‰è¯´å¾ˆç»†ã€‚åœ¨ç¬¬13è®²ä¸­ï¼Œ<br><br>&gt; å› æ­¤åˆ°äº† ECMAScript 6 ä¹‹åï¼Œé‚£äº›ä¸€èˆ¬å‡½æ•°ï¼Œä»¥åŠéæ´¾ç”Ÿç±»ï¼Œå°±å»¶ç»­äº†è¿™ä¸€çº¦å®šï¼šä½¿ç”¨å·²ç»åˆ›å»ºçš„thiså¯¹è±¡æ¥æ›¿ä»£è¿”å›çš„æ— æ•ˆå€¼ã€‚<br>&gt; ... ...<br>&gt; å¯¹äºé‚£äº›æ´¾ç”Ÿçš„å­ç±»ï¼ˆå³å£°æ˜ä¸­ä½¿ç”¨äº†extendså­å¥çš„ç±»ï¼‰ï¼ŒECMAScript è¦æ±‚ä¸¥æ ¼éµå¾ªâ€œä¸å¾—åœ¨æ„é€ å™¨ä¸­è¿”å›éå¯¹è±¡å€¼ï¼ˆä»¥åŠ null å€¼ï¼‰â€çš„è®¾è®¡çº¦å®šï¼Œå¹¶åœ¨è¿™ç§æƒ…å†µä¸‹ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚<br><br>æ‰€ä»¥ç®€å•åœ°è¯´ï¼Œå°±æ˜¯å¦‚æœclasså£°æ˜ä¸­ä¸ä½¿ç”¨extendsï¼Œé‚£ä¹ˆå®ƒå°±è·Ÿä½ ç¤ºä¾‹ä¸­çš„MyConstructor()ä¸€æ ·ï¼Œä¸ä¼šæŠ¥é”™ã€‚è€Œå¦‚æœåƒä½ çš„MyClassé‚£æ ·ä½¿ç”¨äº†extendsï¼Œå°±ä¼šæŠ¥é”™äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Aiming","uid":"1521669","ctime":1576638158,"ip_address":"","comment_id":162850,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14461524668","product_id":100039701,"comment_content":"è¿™é‡Œçš„ä»£ç åœ¨ Chrome æˆ– Node æ˜¯æŠ¥é”™çš„<br><br><br>class MyClass extends Object {<br>  constructor() {<br>    return 1;<br>  }<br>}<br><br>function MyConstructor() {<br>  return 1;<br>}<br><br><br>console.log(new MyClass)<br>console.log(new MyConstructor)","like_count":3,"discussions":[{"author":{"id":1521669,"avatar":"https://static001.geekbang.org/account/avatar/00/17/38/05/7beecd5d.jpg","nickname":"Aiming","note":"","ucode":"66292B32F9960A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478164,"discussion_content":"Oh... è¿™ä¸ªé—®é¢˜åœ¨ä¹‹å‰çš„è¯¾ç¨‹ä¸­è®²è¿‡ï¼Œæ‰€ä»¥è¿™é‡Œæ²¡æœ‰è¯´å¾ˆç»†ã€‚åœ¨ç¬¬13è®²ä¸­ï¼Œ\n\n&amp;gt; å› æ­¤åˆ°äº† ECMAScript 6 ä¹‹åï¼Œé‚£äº›ä¸€èˆ¬å‡½æ•°ï¼Œä»¥åŠéæ´¾ç”Ÿç±»ï¼Œå°±å»¶ç»­äº†è¿™ä¸€çº¦å®šï¼šä½¿ç”¨å·²ç»åˆ›å»ºçš„thiså¯¹è±¡æ¥æ›¿ä»£è¿”å›çš„æ— æ•ˆå€¼ã€‚\n&amp;gt; ... ...\n&amp;gt; å¯¹äºé‚£äº›æ´¾ç”Ÿçš„å­ç±»ï¼ˆå³å£°æ˜ä¸­ä½¿ç”¨äº†extendså­å¥çš„ç±»ï¼‰ï¼ŒECMAScript è¦æ±‚ä¸¥æ ¼éµå¾ªâ€œä¸å¾—åœ¨æ„é€ å™¨ä¸­è¿”å›éå¯¹è±¡å€¼ï¼ˆä»¥åŠ null å€¼ï¼‰â€çš„è®¾è®¡çº¦å®šï¼Œå¹¶åœ¨è¿™ç§æƒ…å†µä¸‹ç›´æ¥æŠ›å‡ºå¼‚å¸¸ã€‚\n\næ‰€ä»¥ç®€å•åœ°è¯´ï¼Œå°±æ˜¯å¦‚æœclasså£°æ˜ä¸­ä¸ä½¿ç”¨extendsï¼Œé‚£ä¹ˆå®ƒå°±è·Ÿä½ ç¤ºä¾‹ä¸­çš„MyConstructor()ä¸€æ ·ï¼Œä¸ä¼šæŠ¥é”™ã€‚è€Œå¦‚æœåƒä½ çš„MyClassé‚£æ ·ä½¿ç”¨äº†extendsï¼Œå°±ä¼šæŠ¥é”™äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576638158,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1044175,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJOBwR7MCVqwZbPA5RQ2mjUjd571jUXUcBCE7lY5vSMibWn8D5S4PzDZMaAhRPdnRBqYbVOBTJibhJg/132","nickname":"ãƒ¾(â—Â°âˆ‡Â°â—)ï¾‰ï¾","note":"","ucode":"89545632BDA56E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":253758,"discussion_content":"ä»Šå¤©è¢«ä¸€ä¸ªnodejsé—®é¢˜ææ™•äº†ï¼Œå¼•å…¥ä¸€ä¸ªæ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—aé‡Œæœ‰ä¸€ä¸ª å±æ€§ c: C3 å…¶ä¸­C3æ˜¯ä¸ªclassï¼Œ æˆ‘æƒ³åˆ¤æ–­C3æ˜¯ä¸æ˜¯C1 ç»§æ‰¿æ¥çš„ï¼Œç”¨çš„æ˜¯ a.c.prototype instanceof C1 , è¿™æ—¶æœ‰æŠ¥é”™ C1 ä¸å­˜åœ¨ï¼Œ ä½†æ˜¯å½“æˆ‘import è¿›æ¥ import C1 from â€œC1â€ è¿™æ ·è¿›æ¥å¯ä»¥æ‰§è¡Œï¼Œä½†æ˜¯ a.c.prototype instanceof C1 è¿™ä¸ªä¼šä¸€ç›´æ˜¯falseã€‚æäº†å¾ˆä¹…å°±ä¸€ç›´æ²¡æå‡ºç»“æœï¼Œæœ€åæ‰“å°å‡ºæ¥ä¸¤ä¸ªFunctionéƒ½ä¸€æ‘¸ä¸€æ ·äº†ï¼Œè¿˜æ˜¯ç”¨ç­‰å·åˆ¤æ–­æ˜¯falseã€‚æœ€åæˆ‘ä¸å¾—ä¸ä½¿ç”¨äº†__proto__éå†åˆ¤æ–­è¿™ç§ç¡¬æ¥çš„æ–¹å¼å…ˆç»•è¿‡äº†ã€‚ä¸çŸ¥é“æ˜¯ä¸æ˜¯nodejsçš„moduleå’Œexportå¼•èµ·çš„ï¼Œæˆ‘åœ¨chromeä¸Šç”¨classæµ‹è¯•æ˜¯OKçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588256193,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":210284,"user_name":"å°ç«¥","can_delete":false,"product_type":"c1","uid":1763395,"ip_address":"","ucode":"300444B520E79D","user_header":"https://static001.geekbang.org/account/avatar/00/1a/e8/43/f9c0faed.jpg","comment_is_top":false,"comment_ctime":1587713971,"is_pvip":false,"replies":[{"id":"78529","content":"ç‰¹æ„æ‰¾äº†æ‰¾ä½ è¯´çš„è¿™æ®µECMScriptè§„èŒƒçš„æ–‡æœ¬ã€‚åº”è¯¥æ˜¯æŒ‡å¦‚ä¸‹:<br><br>&gt; In a class-based object-oriented language, in general, state is carried by instances, methods are carried by classes, and inheritance is only of structure and behaviour.<br><br>&gt; In ECMAScript, the state and methods are carried by objects, while structure, behaviour, and state are all inherited.<br><br>è¿™é‡Œåˆ†æˆä¸¤æ®µï¼Œåˆ†åˆ«æ˜¯æŒ‡çš„åŸºäºç±»ç»§æ‰¿çš„å¯¹è±¡ç³»ç»Ÿå’ŒECMAScriptä¸­çš„å¯¹è±¡ç³»ç»Ÿã€‚åœ¨è¿™é‡Œï¼Œè®²è¿°ECMAScriptä¸­çš„ï¼ˆåŸºäºåŸå‹ç»§æ‰¿çš„ï¼‰å¯¹è±¡ç³»ç»Ÿæ—¶ä¹Ÿä½¿ç”¨äº†åŸæ¥åœ¨ç±»ç»§æ‰¿ä¸­çš„æ¦‚å¿µï¼Œä¾‹å¦‚stateã€methodsã€structureå’Œbehaviourç­‰ã€‚<br><br>é¦–å…ˆï¼Œâ€œçŠ¶æ€ï¼ˆstateï¼‰â€è¿™ç§è¯´æ³•æ¥è‡ªç»“æ„åŒ–ç¨‹åºè®¾è®¡ï¼Œæˆ‘åœ¨ã€Šç¨‹åºåŸæœ¬ã€‹ä¸­ä¹Ÿç”¨äº†â€œçŠ¶æ€â€è¿™ä¸ªæ¦‚å¿µã€‚å¦‚æœæ”¾åœ¨JSé‡Œé¢ï¼ŒçŠ¶æ€å°±æ˜¯ä¸€èˆ¬å±æ€§ï¼ŒåŒ…æ‹¬ä½œä¸ºä¸€èˆ¬å±æ€§æ¥ç†è§£çš„â€œå‡½æ•°ç±»å‹çš„å±æ€§â€ã€‚çŠ¶æ€å°±æ˜¯æ•°æ®ï¼ˆå› ä¸ºæ•°æ®æ˜¯å¯å˜çš„ï¼Œæ‰€ä»¥ç§°ä¸ºçŠ¶æ€ï¼‰ï¼Œæ‰€ä»¥JavaScriptçš„å¯¹è±¡æ˜¯â€œå±æ€§åŒ…â€ï¼Œä¹Ÿå°±å¯ä»¥ç†è§£ä¸ºâ€œçŠ¶æ€ï¼ˆæ•°æ®ï¼‰çš„é›†åˆâ€ã€‚<br><br>ç¬¬äºŒä¸ªéœ€è¦è¯´æ˜çš„æ¦‚å¿µæ˜¯â€œç»“æ„ï¼ˆstructureï¼‰â€ã€‚è¿™ä¸ªç»“æ„å°±æ˜¯â€œç»“æ„åŒ–ç¨‹åºè®¾è®¡â€ä¸­çš„ç»“æ„ã€‚åœ¨è¿™ä¸ªæ¦‚å¿µä½“ç³»é‡Œé¢ï¼Œç»“æ„å°±æ˜¯â€œæ•°æ®è¢«ç»„ç»‡èµ·æ¥çš„æ ·å¼â€ï¼Œæ‰€ä»¥â€œå¯¹è±¡çš„ç»“æ„â€ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯â€œå¯¹è±¡åŒ…æ‹¬å±æ€§çš„æ ·å¼â€ã€‚ä¾‹å¦‚è¯´ï¼Œæˆ‘ä»¬ä¸‹é¢çš„ä»£ç ï¼š<br><br>```<br>obj = { a: 1, b: 2 }<br>```<br><br>è¿™æ˜¯å®šä¹‰äº†å¯¹è±¡objçš„ç»“æ„ã€‚è€Œå…¶ä¸­ï¼š<br><br>```<br>obj.a = 100<br>obj.b = 200<br>```<br><br>åˆ™æ˜¯å®šä¹‰æˆ–ä¿®æ”¹äº†objçš„ä¸¤ä¸ªçŠ¶æ€ï¼ˆå±æ€§ï¼‰ã€‚<br><br>é‚£ä¹ˆä¸ºä»€ä¹ˆè¦è¿™æ ·æ¥åŒºåˆ†æ¦‚å¿µå‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºåˆ°äº†ES6ä¹‹åï¼Œè§£æ„èµ‹å€¼æˆ–è§£æ„è¡¨è¾¾å¼æ¥å£°æ˜çš„å‚æ•°è¡¨ï¼Œå°±æ˜¯åˆ©ç”¨äº†å¯¹è±¡çš„â€œç»“æ„æ€§â€è€Œå®ç°çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼š<br><br>```<br>&#47;&#47; è§£æ„èµ‹å€¼ï¼Œåˆ©ç”¨å¯¹è±¡objçš„ç»“æ„æ€§<br>let {a, b} = obj<br>console.log(a, b)<br><br>&#47;&#47; åœ¨å‚æ•°ä¸Šçš„å£°æ˜<br>function foo({a}) { ... }<br>foo(obj);<br>```<br><br>æ‰€ä»¥ï¼Œç»“æ„å°±æ˜¯æŒ‡ç±»ä¼¼ä¸Šè¿°èµ‹å€¼æ¨¡æ¿ä¸­çš„â€œç»“æ„å£°æ˜â€ã€‚å®ƒçš„ç»§æ‰¿æ€§å°±æ˜¯æŒ‡ï¼šå­ç±»å¯¹è±¡ä¸åŸå‹å…·æœ‰ç›¸ä¼¼çš„ç»“æ„ã€‚<br><br>å›åˆ°ä½ çš„é—®é¢˜ï¼Œè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯â€œæ–¹æ³•&#47;è¡Œä¸ºâ€ã€‚â€œæ–¹æ³•(method)â€è¿™ä¸ªè¯åœ¨OOPä¸­æ˜¯ç‰¹æŒ‡çš„ï¼Œå°±æ˜¯æŒ‡å¯¹è±¡å®ä¾‹ä¸Šå¯ä»¥è°ƒç”¨çš„é‚£äº›å‡½æ•°â€”â€”å½“ç„¶ï¼Œè¿™åŒ…æ‹¬å‡½æ•°ç±»å‹çš„å±æ€§ï¼Œä»¥åŠåœ¨ç±»å£°æ˜ä¸­ç›´æ¥å£°æ˜çš„æ–¹æ³•ä»¥åŠget&#47;setterã€‚<br><br>çŠ¶æ€å’Œæ–¹æ³•éƒ½ä¼šè¢«å¯¹è±¡æ‰¿è½½ï¼ˆstate and methods are carried by objectsï¼‰ï¼Œè¿™å¥è¯åè¿‡æ¥è¯´å°±æ˜¯â€œå¯¹è±¡(objects)åŒ…æ‹¬æ–¹æ³•å’ŒçŠ¶æ€(å±æ€§)â€ã€‚<br><br>è€Œâ€œè¡Œä¸ºâ€åˆ™æ˜¯â€œåœ¨æ¦‚å¿µå±‚é¢ä¸Šè®¨è®ºOOPâ€æ—¶çš„ä¸€ä¸ªç”¨è¯ã€‚å®ƒæŒ‡çš„æ˜¯ä¸€ä¸ªå¯¹è±¡çš„èƒ½åŠ›ï¼Œæ¯”å¦‚è¢«è°ƒç”¨æˆ–è€…è¢«åˆ«çš„å¯¹è±¡å…³è”ç­‰ç­‰ã€‚æˆ‘åœ¨è®²OOPâ€”â€”ä¾‹å¦‚ç¬¬14è®²â€”â€”çš„æ—¶å€™ä¹Ÿä¼šç”¨åˆ°â€œè¡Œä¸º&#47;èƒ½åŠ›â€è¿™ä¸ªè¯ï¼Œè¡¨è¾¾çš„éƒ½æ˜¯ç›¸åŒçš„æ„æ€ã€‚è¯´å¾—ç®€å•ä¸€ç‚¹ï¼Œâ€œè¡Œä¸ºâ€å°±æ˜¯â€œæ–¹æ³•ï¼ˆçš„èƒ½åŠ›ï¼‰â€çš„æŠ½è±¡æ¦‚å¿µã€‚<br><br>æ‰€ä»¥â€œç»“æ„ï¼Œè¡Œä¸ºå’ŒçŠ¶æ€éƒ½èƒ½è¢«ç»§æ‰¿ï¼ˆstructure, behaviour, and state are all inheritedï¼‰â€æ„æ€å°±æ˜¯æŒ‡ä¸€ä¸ªå¯¹è±¡çš„è¡¨ç°æ ·å¼ã€è¡Œä¸ºæ–¹æ³•å’ŒçŠ¶æ€å±æ€§ï¼Œéƒ½æ˜¯å¯ä»¥ç»§æ‰¿çš„ã€‚<br><br>æœ€åï¼Œæœ€å¼€å§‹çš„ä¸¤æ®µè‹±æ–‡æ˜¯å¯¹æ¯”ç€æ¥è¯»çš„ã€‚å®ƒçš„æ„æ€æ˜¯ç±»ç»§æ‰¿é€šå¸¸åªç»§æ‰¿æ ·å¼å’Œè¡Œä¸ºï¼Œè€Œä¸ç»§æ‰¿å±æ€§ï¼›è€ŒJSçš„åŸå‹ç»§æ‰¿æ˜¯ä¸‰è€…éƒ½ç»§æ‰¿çš„ã€‚ç®€å•çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š<br><br>```<br>&#47;&#47; åŸå‹ç»§æ‰¿<br>parent = { a: 100, foo: function() {} }<br>x = Object.create(parent)<br>console.log(x.a); &#47;&#47; ç»§æ‰¿å±æ€§<br>console.log(x.foo); &#47;&#47; ç»§æ‰¿è¡Œä¸º<br>console.log(&#39;a&#39; in obj, &#39;foo&#39; in obj); &#47;&#47; ç»§æ‰¿ç»“æ„<br><br>&#47;&#47; ç±»ç»§æ‰¿ï¼ˆæŸäº›ç»å…¸ç³»ç»Ÿä¸­ï¼‰<br>x = new MyObject()<br>x.foo(); &#47;&#47; okay<br>`foo` in x; &#47;&#47; okay<br>console.log(x.a); &#47;&#47; maybe support ...<br>```<br>æœ€åè¿™ä¸ªä¾‹å­æ˜¯æŒ‡ï¼šåœ¨æŸäº›ç±»ç»§æ‰¿ä½“ç³»ä¸­ï¼Œâ€œç»§æ‰¿æ¥çš„å±æ€§â€å¯èƒ½å¹¶æ²¡æœ‰åˆå§‹åŒ–ï¼Œè€Œä»…ä»…æ˜¯ä¸€ä¸ªæœªåˆå§‹åŒ–çš„çŠ¶æ€ï¼ˆä¾‹å¦‚åœ¨Delphiä¸­å°±æœ‰ç±»ä¼¼çš„æ€§è´¨ï¼‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Aiming","uid":"1521669","ctime":1587915086,"ip_address":"","comment_id":210284,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10177648563","product_id":100039701,"comment_content":"è€å¸ˆï¼Œæˆ‘åœ¨çœ‹è§„èŒƒçš„æ—¶å€™ï¼Œæœ‰é‚£ä¹ˆä¸€å¥è¯ä¸ç†è§£ï¼ŒçŠ¶æ€å’Œæ–¹æ³•éƒ½ä¼šè¢«å¯¹è±¡æ‰¿è½½ï¼Œç»“æ„ï¼Œè¡Œä¸ºå’ŒçŠ¶æ€éƒ½èƒ½è¢«ç»§æ‰¿ã€‚<br>è¿™å¥æ€ä¹ˆç†è§£å‘¢ï¼Ÿ<br>æ¯”å¦‚:<br>function Car(){<br><br><br>}<br>Car.prototype.name=&quot;car1&quot;;<br>Car.prototype.run=function(){<br>     console.log(&quot;run&quot;)<br>}<br>var car1=new Car();<br>&#47;&#47;å¯¹è±¡ æ‰¿è½½çŠ¶æ€å’Œæ–¹æ³• æŒ‡name çŠ¶æ€ runæ–¹æ³•<br><br>function Dog(){<br><br>}<br>Dog.prototype=Car.prototype;<br>&#47;&#47;ç»§æ‰¿ Dog ç»§æ‰¿äº†Carå¯¹è±¡çš„ç»“æ„ è¡Œä¸ºæŒ‡ç»§æ‰¿äº†runæ–¹æ³•å—ï¼Ÿ çŠ¶æ€æ˜¯nameå±æ€§å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1521669,"avatar":"https://static001.geekbang.org/account/avatar/00/17/38/05/7beecd5d.jpg","nickname":"Aiming","note":"","ucode":"66292B32F9960A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492991,"discussion_content":"ç‰¹æ„æ‰¾äº†æ‰¾ä½ è¯´çš„è¿™æ®µECMScriptè§„èŒƒçš„æ–‡æœ¬ã€‚åº”è¯¥æ˜¯æŒ‡å¦‚ä¸‹:\n\n&amp;gt; In a class-based object-oriented language, in general, state is carried by instances, methods are carried by classes, and inheritance is only of structure and behaviour.\n\n&amp;gt; In ECMAScript, the state and methods are carried by objects, while structure, behaviour, and state are all inherited.\n\nè¿™é‡Œåˆ†æˆä¸¤æ®µï¼Œåˆ†åˆ«æ˜¯æŒ‡çš„åŸºäºç±»ç»§æ‰¿çš„å¯¹è±¡ç³»ç»Ÿå’ŒECMAScriptä¸­çš„å¯¹è±¡ç³»ç»Ÿã€‚åœ¨è¿™é‡Œï¼Œè®²è¿°ECMAScriptä¸­çš„ï¼ˆåŸºäºåŸå‹ç»§æ‰¿çš„ï¼‰å¯¹è±¡ç³»ç»Ÿæ—¶ä¹Ÿä½¿ç”¨äº†åŸæ¥åœ¨ç±»ç»§æ‰¿ä¸­çš„æ¦‚å¿µï¼Œä¾‹å¦‚stateã€methodsã€structureå’Œbehaviourç­‰ã€‚\n\né¦–å…ˆï¼Œâ€œçŠ¶æ€ï¼ˆstateï¼‰â€è¿™ç§è¯´æ³•æ¥è‡ªç»“æ„åŒ–ç¨‹åºè®¾è®¡ï¼Œæˆ‘åœ¨ã€Šç¨‹åºåŸæœ¬ã€‹ä¸­ä¹Ÿç”¨äº†â€œçŠ¶æ€â€è¿™ä¸ªæ¦‚å¿µã€‚å¦‚æœæ”¾åœ¨JSé‡Œé¢ï¼ŒçŠ¶æ€å°±æ˜¯ä¸€èˆ¬å±æ€§ï¼ŒåŒ…æ‹¬ä½œä¸ºä¸€èˆ¬å±æ€§æ¥ç†è§£çš„â€œå‡½æ•°ç±»å‹çš„å±æ€§â€ã€‚çŠ¶æ€å°±æ˜¯æ•°æ®ï¼ˆå› ä¸ºæ•°æ®æ˜¯å¯å˜çš„ï¼Œæ‰€ä»¥ç§°ä¸ºçŠ¶æ€ï¼‰ï¼Œæ‰€ä»¥JavaScriptçš„å¯¹è±¡æ˜¯â€œå±æ€§åŒ…â€ï¼Œä¹Ÿå°±å¯ä»¥ç†è§£ä¸ºâ€œçŠ¶æ€ï¼ˆæ•°æ®ï¼‰çš„é›†åˆâ€ã€‚\n\nç¬¬äºŒä¸ªéœ€è¦è¯´æ˜çš„æ¦‚å¿µæ˜¯â€œç»“æ„ï¼ˆstructureï¼‰â€ã€‚è¿™ä¸ªç»“æ„å°±æ˜¯â€œç»“æ„åŒ–ç¨‹åºè®¾è®¡â€ä¸­çš„ç»“æ„ã€‚åœ¨è¿™ä¸ªæ¦‚å¿µä½“ç³»é‡Œé¢ï¼Œç»“æ„å°±æ˜¯â€œæ•°æ®è¢«ç»„ç»‡èµ·æ¥çš„æ ·å¼â€ï¼Œæ‰€ä»¥â€œå¯¹è±¡çš„ç»“æ„â€ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯â€œå¯¹è±¡åŒ…æ‹¬å±æ€§çš„æ ·å¼â€ã€‚ä¾‹å¦‚è¯´ï¼Œæˆ‘ä»¬ä¸‹é¢çš„ä»£ç ï¼š\n\n```\nobj = { a: 1, b: 2 }\n```\n\nè¿™æ˜¯å®šä¹‰äº†å¯¹è±¡objçš„ç»“æ„ã€‚è€Œå…¶ä¸­ï¼š\n\n```\nobj.a = 100\nobj.b = 200\n```\n\nåˆ™æ˜¯å®šä¹‰æˆ–ä¿®æ”¹äº†objçš„ä¸¤ä¸ªçŠ¶æ€ï¼ˆå±æ€§ï¼‰ã€‚\n\né‚£ä¹ˆä¸ºä»€ä¹ˆè¦è¿™æ ·æ¥åŒºåˆ†æ¦‚å¿µå‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºåˆ°äº†ES6ä¹‹åï¼Œè§£æ„èµ‹å€¼æˆ–è§£æ„è¡¨è¾¾å¼æ¥å£°æ˜çš„å‚æ•°è¡¨ï¼Œå°±æ˜¯åˆ©ç”¨äº†å¯¹è±¡çš„â€œç»“æ„æ€§â€è€Œå®ç°çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼š\n\n```\n// è§£æ„èµ‹å€¼ï¼Œåˆ©ç”¨å¯¹è±¡objçš„ç»“æ„æ€§\nlet {a, b} = obj\nconsole.log(a, b)\n\n// åœ¨å‚æ•°ä¸Šçš„å£°æ˜\nfunction foo({a}) { ... }\nfoo(obj);\n```\n\næ‰€ä»¥ï¼Œç»“æ„å°±æ˜¯æŒ‡ç±»ä¼¼ä¸Šè¿°èµ‹å€¼æ¨¡æ¿ä¸­çš„â€œç»“æ„å£°æ˜â€ã€‚å®ƒçš„ç»§æ‰¿æ€§å°±æ˜¯æŒ‡ï¼šå­ç±»å¯¹è±¡ä¸åŸå‹å…·æœ‰ç›¸ä¼¼çš„ç»“æ„ã€‚\n\nå›åˆ°ä½ çš„é—®é¢˜ï¼Œè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯â€œæ–¹æ³•/è¡Œä¸ºâ€ã€‚â€œæ–¹æ³•(method)â€è¿™ä¸ªè¯åœ¨OOPä¸­æ˜¯ç‰¹æŒ‡çš„ï¼Œå°±æ˜¯æŒ‡å¯¹è±¡å®ä¾‹ä¸Šå¯ä»¥è°ƒç”¨çš„é‚£äº›å‡½æ•°â€”â€”å½“ç„¶ï¼Œè¿™åŒ…æ‹¬å‡½æ•°ç±»å‹çš„å±æ€§ï¼Œä»¥åŠåœ¨ç±»å£°æ˜ä¸­ç›´æ¥å£°æ˜çš„æ–¹æ³•ä»¥åŠget/setterã€‚\n\nçŠ¶æ€å’Œæ–¹æ³•éƒ½ä¼šè¢«å¯¹è±¡æ‰¿è½½ï¼ˆstate and methods are carried by objectsï¼‰ï¼Œè¿™å¥è¯åè¿‡æ¥è¯´å°±æ˜¯â€œå¯¹è±¡(objects)åŒ…æ‹¬æ–¹æ³•å’ŒçŠ¶æ€(å±æ€§)â€ã€‚\n\nè€Œâ€œè¡Œä¸ºâ€åˆ™æ˜¯â€œåœ¨æ¦‚å¿µå±‚é¢ä¸Šè®¨è®ºOOPâ€æ—¶çš„ä¸€ä¸ªç”¨è¯ã€‚å®ƒæŒ‡çš„æ˜¯ä¸€ä¸ªå¯¹è±¡çš„èƒ½åŠ›ï¼Œæ¯”å¦‚è¢«è°ƒç”¨æˆ–è€…è¢«åˆ«çš„å¯¹è±¡å…³è”ç­‰ç­‰ã€‚æˆ‘åœ¨è®²OOPâ€”â€”ä¾‹å¦‚ç¬¬14è®²â€”â€”çš„æ—¶å€™ä¹Ÿä¼šç”¨åˆ°â€œè¡Œä¸º/èƒ½åŠ›â€è¿™ä¸ªè¯ï¼Œè¡¨è¾¾çš„éƒ½æ˜¯ç›¸åŒçš„æ„æ€ã€‚è¯´å¾—ç®€å•ä¸€ç‚¹ï¼Œâ€œè¡Œä¸ºâ€å°±æ˜¯â€œæ–¹æ³•ï¼ˆçš„èƒ½åŠ›ï¼‰â€çš„æŠ½è±¡æ¦‚å¿µã€‚\n\næ‰€ä»¥â€œç»“æ„ï¼Œè¡Œä¸ºå’ŒçŠ¶æ€éƒ½èƒ½è¢«ç»§æ‰¿ï¼ˆstructure, behaviour, and state are all inheritedï¼‰â€æ„æ€å°±æ˜¯æŒ‡ä¸€ä¸ªå¯¹è±¡çš„è¡¨ç°æ ·å¼ã€è¡Œä¸ºæ–¹æ³•å’ŒçŠ¶æ€å±æ€§ï¼Œéƒ½æ˜¯å¯ä»¥ç»§æ‰¿çš„ã€‚\n\næœ€åï¼Œæœ€å¼€å§‹çš„ä¸¤æ®µè‹±æ–‡æ˜¯å¯¹æ¯”ç€æ¥è¯»çš„ã€‚å®ƒçš„æ„æ€æ˜¯ç±»ç»§æ‰¿é€šå¸¸åªç»§æ‰¿æ ·å¼å’Œè¡Œä¸ºï¼Œè€Œä¸ç»§æ‰¿å±æ€§ï¼›è€ŒJSçš„åŸå‹ç»§æ‰¿æ˜¯ä¸‰è€…éƒ½ç»§æ‰¿çš„ã€‚ç®€å•çš„ç¤ºä¾‹å¦‚ä¸‹ï¼š\n\n```\n// åŸå‹ç»§æ‰¿\nparent = { a: 100, foo: function() {} }\nx = Object.create(parent)\nconsole.log(x.a); // ç»§æ‰¿å±æ€§\nconsole.log(x.foo); // ç»§æ‰¿è¡Œä¸º\nconsole.log(&amp;#39;a&amp;#39; in obj, &amp;#39;foo&amp;#39; in obj); // ç»§æ‰¿ç»“æ„\n\n// ç±»ç»§æ‰¿ï¼ˆæŸäº›ç»å…¸ç³»ç»Ÿä¸­ï¼‰\nx = new MyObject()\nx.foo(); // okay\n`f","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587915086,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1763395,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/e8/43/f9c0faed.jpg","nickname":"å°ç«¥","note":"","ucode":"300444B520E79D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":252303,"discussion_content":"çœ‹å®Œè€å¸ˆçš„ç†è§£ æ„Ÿè§‰æ˜ç™½å¤šäº†ï¼ğŸ˜Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588151070,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":171830,"user_name":"é’å²æˆç°","can_delete":false,"product_type":"c1","uid":1514406,"ip_address":"","ucode":"C28AB62034B833","user_header":"https://static001.geekbang.org/account/avatar/00/17/1b/a6/6373416f.jpg","comment_is_top":false,"comment_ctime":1579024881,"is_pvip":false,"replies":[{"id":"66660","content":"è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œxä¸MyClassEx&#47;MyClassè¿™ä¸¤ä¸ªç±»æ˜¯æ²¡æœ‰ç»§æ‰¿å…³ç³»çš„ï¼ŒåŸå‹ç»§æ‰¿æˆ–ç±»ç»§æ‰¿çš„é€»è¾‘åœ¨è¿™é‡Œæ²¡æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼š<br>```<br>&gt; x instanceof MyClass<br>false<br>&gt; x instanceof MyClassEx<br>false<br>```<br><br>ä½ éœ€è¦è‡ªå·²æ¥ç»´æŠ¤åŸå‹é“¾&#47;ç»§æ‰¿å…³ç³»ï¼Œä¾‹å¦‚ï¼š<br>```<br>class MyClass {<br>  constructor() {<br>    return Object.setPrototypeOf(new Date, new.target.prototype);<br>  }<br>}<br><br>...<br><br>console.log(&#39;foo&#39; in x); &#47;&#47;true<br>console.log(x instanceof MyClassEx); &#47;&#47; true<br>console.log(x instanceof MyClass); &#47;&#47; false<br>```<br><br>å› ä¸ºç»§æ‰¿å…³ç³»è·Ÿç±»å£°æ˜åˆ†å¼€äº†ï¼Œæ‰€ä»¥ä½ å¯ä»¥æœ‰å¾ˆå¤šæ–¹æ³•æ¥çµæ´»å¤„ç†äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Aiming","uid":"1521669","ctime":1579055515,"ip_address":"","comment_id":171830,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10168959473","product_id":100039701,"comment_content":"è€å¸ˆï¼Œæœ€åçš„è¿™ä¸ªä¾‹å­ï¼š<br>```<br><br>class MyClass {<br>  constructor() { return new Date };<br>}<br><br>class MyClassEx extends MyClass {<br>  constructor() { super() }; &#47;&#47; or default<br>  foo() {<br>    console.log(&#39;check only&#39;);<br>  }<br>}<br><br>var x = new MyClassEx;<br>console.log(&#39;foo&#39; in x); &#47;&#47; false<br>```<br>å› ä¸º`foo`å¹¶ä¸åœ¨`x`å®ä¾‹ä¸Šï¼Œé‚£å‡å¦‚æˆ‘è¦è®¿é—®`foo`ï¼Œé‚£å¾—é€šè¿‡ä»€ä¹ˆæ–¹å¼ï¼Ÿæˆ–è€…è¯´ï¼Œé‚£æˆ‘è¿™ä¸ªç±»ä¸­å®šä¹‰çš„`foo`å®šä¹‰åˆ°å“ªé‡Œå»äº†ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1521669,"avatar":"https://static001.geekbang.org/account/avatar/00/17/38/05/7beecd5d.jpg","nickname":"Aiming","note":"","ucode":"66292B32F9960A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481528,"discussion_content":"è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œxä¸MyClassEx/MyClassè¿™ä¸¤ä¸ªç±»æ˜¯æ²¡æœ‰ç»§æ‰¿å…³ç³»çš„ï¼ŒåŸå‹ç»§æ‰¿æˆ–ç±»ç»§æ‰¿çš„é€»è¾‘åœ¨è¿™é‡Œæ²¡æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼š\n```\n&amp;gt; x instanceof MyClass\nfalse\n&amp;gt; x instanceof MyClassEx\nfalse\n```\n\nä½ éœ€è¦è‡ªå·²æ¥ç»´æŠ¤åŸå‹é“¾/ç»§æ‰¿å…³ç³»ï¼Œä¾‹å¦‚ï¼š\n```\nclass MyClass {\n  constructor() {\n    return Object.setPrototypeOf(new Date, new.target.prototype);\n  }\n}\n\n...\n\nconsole.log(&amp;#39;foo&amp;#39; in x); //true\nconsole.log(x instanceof MyClassEx); // true\nconsole.log(x instanceof MyClass); // false\n```\n\nå› ä¸ºç»§æ‰¿å…³ç³»è·Ÿç±»å£°æ˜åˆ†å¼€äº†ï¼Œæ‰€ä»¥ä½ å¯ä»¥æœ‰å¾ˆå¤šæ–¹æ³•æ¥çµæ´»å¤„ç†äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579055515,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005317,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/05/6e0193b5.jpg","nickname":"æ–°å“¥","note":"","ucode":"69CAF2FD490660","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285077,"discussion_content":"é‚£è¿™ä¸ªå¯¹è±¡å°±æˆäº†date ç±»å‹çš„äº†ğŸ˜³","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592730414,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":193819,"user_name":"James","can_delete":false,"product_type":"c1","uid":1513489,"ip_address":"","ucode":"953966DEFE4461","user_header":"https://static001.geekbang.org/account/avatar/00/17/18/11/f1f37801.jpg","comment_is_top":false,"comment_ctime":1584970328,"is_pvip":false,"replies":[{"id":"73884","content":"å¦‚æœåœ¨ä¸€ä¸ªå¾ªç¯ä¸­ï¼Œå¹¶ä¸”æ˜¯åœ¨è¯¥å¾ªç¯ä¸­æ·±åº¦éå†a.aï¼Œé‚£ä¹ˆå°±ä¼šæ­»å¾ªç¯ã€‚<br><br>è¿™ä¸ªæ­£å¥½åœ¨ç¼–ç¨‹æ¦‚å¿µä¸­æ˜¯æœ‰çš„ï¼Œå«åšâ€œå¾ªç¯å¼•ç”¨ï¼ˆdeep-circular-referencesï¼‰â€ã€‚å¾ªç¯å¼•ç”¨ä¸ä»…ä»…å‘ç”Ÿåœ¨ä½ çš„ä¾‹å­ä¸­ï¼Œåœ¨ä¸€èˆ¬çš„å¯¹è±¡å£°æ˜ï¼Œä»¥åŠJSONæ ¼å¼çš„æ•°æ®ä¸­éƒ½å¯ä»¥å­˜åœ¨ï¼Œåœ¨æ•°æ®ç»“æ„ä¸­ï¼Œä¹Ÿæ˜¯æ•°æ®å¸¸è§çš„æ€§è´¨ã€‚<br><br>å¦‚æœä¸€ä¸ªæ•°æ®å†…æœ‰å¾ªç¯å¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒçš„æ•°æ®éå†å°±ä¼šæ­»å¾ªç¯ã€‚å› æ­¤éœ€è¦åœ¨ä»£ç ä¸­å°è¯•å»æ£€æµ‹â€œéå†å†å²ä¸­æ˜¯å¦å­˜åœ¨ç›¸åŒç»“ç‚¹â€ï¼Œè¿™ä¸ªä»£ä»·æ˜¯æé«˜çš„ã€‚å› æ­¤ç»å¤§å¤šæ•°ç³»ç»Ÿä¸­éƒ½ä¼šè¦æ±‚æ•°æ®åœ¨äº§ç”Ÿæ—¶ä¸è¦ææˆå¾ªç¯å¼•ç”¨çš„ã€‚â€”â€”ä¹Ÿå°±æ˜¯ä¿è¯æ•°æ®å¹²å‡€ã€‚ä½†æŸäº›æƒ…å†µä¸‹ï¼Œä¹Ÿéœ€è¦å¤„ç†æœªçŸ¥çš„ã€æ— æ³•ç¡®ä¿å¹²å‡€çš„æ•°æ®ï¼Œè¿™æ—¶è¦ä¹ˆä¸åšéå†ï¼Œè¦ä¹ˆå°±åœ¨éå†ä¸­å¤„ç†ã€‚â€”â€”åœ¨æ•°æ®ç»“æ„çš„å›¾è®ºä¸­ï¼Œæœ‰è®¸å¤šâ€œæœ‰å‘æœ‰ç¯å›¾â€çš„å¤„ç†ï¼Œå°±æ˜¯è¿™ç±»ç®—æ³•ä¸æœºåˆ¶ã€‚<br><br>å›åˆ°ä½ çš„é—®é¢˜æœ¬èº«ã€‚â€œå¾ªç¯å¼•ç”¨â€æœ¬èº«çš„å­˜åœ¨ï¼Œå¹¶ä¸ä¼šå¯¼è‡´æ³„éœ²æˆ–æº¢å‡ºã€‚è¿™å¾ˆç®€å•ï¼Œä»»ä½•ä¸€ä¸ªç»“ç‚¹ï¼Œå…¶.nextå±æ€§æŒ‡å‘è‡ªèº«ï¼Œé‚£ä¹ˆå°±ç®€å•åœ°æ„æˆäº†è¿™ç§å±æ€§å¼•ç”¨ï¼ˆä¹Ÿå°±æ˜¯a.a = aï¼‰ï¼Œé‚£ä¹ˆå®ƒçš„å†…å­˜å ç”¨å°±æ’ä¸ºâ€œ2ä¸ªå…ƒç´ ï¼ˆè‡ªèº«å’Œnextå±æ€§ï¼‰â€ï¼Œè¿™æ€ä¹ˆå¯èƒ½æ³„éœ²æˆ–æº¢å‡ºå‘¢ï¼Ÿå¾ˆç®€å•çš„ã€æœ‰é™ä¸ªæˆå‘˜çš„æ•°æ®ç»“æ„è€Œå·²å˜›ã€‚<br><br>æ‰€ä»¥ä¸æ·±åº¦éå†å®ƒå°±ä¸ä¼šå‡ºé—®é¢˜ã€‚åˆå¦‚æœéœ€è¦æ·±åº¦éå†ï¼Œé‚£ä¹ˆå°±éœ€è¦ç›¸åº”çš„ç®—æ³•æˆ–å¤„ç†æœºåˆ¶ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Aiming","uid":"1521669","ctime":1585016952,"ip_address":"","comment_id":193819,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5879937624","product_id":100039701,"comment_content":"è€å¸ˆï¼Œåœ¨çœ‹reactæºç çš„contextæ—¶å€™ï¼Œé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œç®€åŒ–å¦‚ä¸‹ï¼Œå¦‚æœvar a = {}, a.a =a,æœ€ç»ˆa.a.a...å¥½åƒä¼šæ— é™ä¸‹å»ï¼Œè¿™æ ·ï¼Œä¼šä¸ä¼šæ‰§è¡Œè¿™ä¸ªä»£ç çš„æ—¶å€™ï¼Œå°±å†…å­˜æ³„æ¼äº†å•Šï¼Œå¦‚æœé€ æˆå†…å­˜æ³„æ¼çš„åŒ–ï¼Œæ€ä¹ˆä¼šåœ¨reactæºç é‡Œé¢å‘¢ï¼Ÿ<br><br>export function createContext&lt;T&gt;(<br>  defaultValue: T,<br>  calculateChangedBits: ?(a: T, b: T) =&gt; number,<br>): ReactContext&lt;T&gt; {<br><br>  const context: ReactContext&lt;T&gt; = {<br>    $$typeof: REACT_CONTEXT_TYPE,<br>    _calculateChangedBits: calculateChangedBits,<br>    _currentValue: defaultValue,<br>    _currentValue2: defaultValue,<br>    Provider: (null: any),<br>    Consumer: (null: any),<br>  };<br><br>  context.Provider = {<br>    $$typeof: REACT_PROVIDER_TYPE,<br>    _context: context,<br>  };<br><br>  let hasWarnedAboutUsingNestedContextConsumers = false;<br>  let hasWarnedAboutUsingConsumerProvider = false;<br>context.Consumer = context;<br><br>  return context;<br>}<br>","like_count":2,"discussions":[{"author":{"id":1521669,"avatar":"https://static001.geekbang.org/account/avatar/00/17/38/05/7beecd5d.jpg","nickname":"Aiming","note":"","ucode":"66292B32F9960A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488674,"discussion_content":"å¦‚æœåœ¨ä¸€ä¸ªå¾ªç¯ä¸­ï¼Œå¹¶ä¸”æ˜¯åœ¨è¯¥å¾ªç¯ä¸­æ·±åº¦éå†a.aï¼Œé‚£ä¹ˆå°±ä¼šæ­»å¾ªç¯ã€‚\n\nè¿™ä¸ªæ­£å¥½åœ¨ç¼–ç¨‹æ¦‚å¿µä¸­æ˜¯æœ‰çš„ï¼Œå«åšâ€œå¾ªç¯å¼•ç”¨ï¼ˆdeep-circular-referencesï¼‰â€ã€‚å¾ªç¯å¼•ç”¨ä¸ä»…ä»…å‘ç”Ÿåœ¨ä½ çš„ä¾‹å­ä¸­ï¼Œåœ¨ä¸€èˆ¬çš„å¯¹è±¡å£°æ˜ï¼Œä»¥åŠJSONæ ¼å¼çš„æ•°æ®ä¸­éƒ½å¯ä»¥å­˜åœ¨ï¼Œåœ¨æ•°æ®ç»“æ„ä¸­ï¼Œä¹Ÿæ˜¯æ•°æ®å¸¸è§çš„æ€§è´¨ã€‚\n\nå¦‚æœä¸€ä¸ªæ•°æ®å†…æœ‰å¾ªç¯å¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒçš„æ•°æ®éå†å°±ä¼šæ­»å¾ªç¯ã€‚å› æ­¤éœ€è¦åœ¨ä»£ç ä¸­å°è¯•å»æ£€æµ‹â€œéå†å†å²ä¸­æ˜¯å¦å­˜åœ¨ç›¸åŒç»“ç‚¹â€ï¼Œè¿™ä¸ªä»£ä»·æ˜¯æé«˜çš„ã€‚å› æ­¤ç»å¤§å¤šæ•°ç³»ç»Ÿä¸­éƒ½ä¼šè¦æ±‚æ•°æ®åœ¨äº§ç”Ÿæ—¶ä¸è¦ææˆå¾ªç¯å¼•ç”¨çš„ã€‚â€”â€”ä¹Ÿå°±æ˜¯ä¿è¯æ•°æ®å¹²å‡€ã€‚ä½†æŸäº›æƒ…å†µä¸‹ï¼Œä¹Ÿéœ€è¦å¤„ç†æœªçŸ¥çš„ã€æ— æ³•ç¡®ä¿å¹²å‡€çš„æ•°æ®ï¼Œè¿™æ—¶è¦ä¹ˆä¸åšéå†ï¼Œè¦ä¹ˆå°±åœ¨éå†ä¸­å¤„ç†ã€‚â€”â€”åœ¨æ•°æ®ç»“æ„çš„å›¾è®ºä¸­ï¼Œæœ‰è®¸å¤šâ€œæœ‰å‘æœ‰ç¯å›¾â€çš„å¤„ç†ï¼Œå°±æ˜¯è¿™ç±»ç®—æ³•ä¸æœºåˆ¶ã€‚\n\nå›åˆ°ä½ çš„é—®é¢˜æœ¬èº«ã€‚â€œå¾ªç¯å¼•ç”¨â€æœ¬èº«çš„å­˜åœ¨ï¼Œå¹¶ä¸ä¼šå¯¼è‡´æ³„éœ²æˆ–æº¢å‡ºã€‚è¿™å¾ˆç®€å•ï¼Œä»»ä½•ä¸€ä¸ªç»“ç‚¹ï¼Œå…¶.nextå±æ€§æŒ‡å‘è‡ªèº«ï¼Œé‚£ä¹ˆå°±ç®€å•åœ°æ„æˆäº†è¿™ç§å±æ€§å¼•ç”¨ï¼ˆä¹Ÿå°±æ˜¯a.a = aï¼‰ï¼Œé‚£ä¹ˆå®ƒçš„å†…å­˜å ç”¨å°±æ’ä¸ºâ€œ2ä¸ªå…ƒç´ ï¼ˆè‡ªèº«å’Œnextå±æ€§ï¼‰â€ï¼Œè¿™æ€ä¹ˆå¯èƒ½æ³„éœ²æˆ–æº¢å‡ºå‘¢ï¼Ÿå¾ˆç®€å•çš„ã€æœ‰é™ä¸ªæˆå‘˜çš„æ•°æ®ç»“æ„è€Œå·²å˜›ã€‚\n\næ‰€ä»¥ä¸æ·±åº¦éå†å®ƒå°±ä¸ä¼šå‡ºé—®é¢˜ã€‚åˆå¦‚æœéœ€è¦æ·±åº¦éå†ï¼Œé‚£ä¹ˆå°±éœ€è¦ç›¸åº”çš„ç®—æ³•æˆ–å¤„ç†æœºåˆ¶ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585016952,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":169624,"user_name":"Elmer","can_delete":false,"product_type":"c1","uid":1233975,"ip_address":"","ucode":"61FC9CE0BA5BC1","user_header":"https://static001.geekbang.org/account/avatar/00/12/d4/37/528a43e7.jpg","comment_is_top":false,"comment_ctime":1578391678,"is_pvip":true,"replies":[{"id":"65819","content":"æ˜¯çš„ã€‚ä¸éœ€è¦ã€‚JavaScirptç¡®å®å…è®¸â€œç±»â€è¿”å›â€œä»»æ„å¯¹è±¡â€ã€‚ä»JavaScript 1.2çš„è®¾è®¡å¼€å§‹ï¼Œå°±ä¸€ç›´å¦‚æ­¤ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Aiming","uid":"1521669","ctime":1578398045,"ip_address":"","comment_id":169624,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5873358974","product_id":100039701,"comment_content":"å®šåˆ¶çš„æ„é€ æ–¹æ³•ä¸­ï¼Œå¦‚æœè¿”å›é€šè¿‡returnä¼ å‡ºçš„å¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯ä¸€ä¸ªç”¨æˆ·å®šåˆ¶çš„åˆ›å»ºè¿‡ç¨‹ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™è¿”å›çš„å¯¹è±¡åŸå‹å¹¶ä¸æ˜¯å­ç±»çš„åŸå‹ï¼Œé‚£ä¸æ˜¯ä¸éœ€è¦å†è®¾ç½®thisçš„åŸå‹äº†å—ã€‚ã€‚<br>function test (){<br>  return {a: 1};<br>}<br>const b = new test();<br>b instanceof test  &#47;&#47; false;æ­¤æ—¶å¦‚æœtestæœ‰çˆ¶ç±»ä¹Ÿä¸éœ€è¦è®¾ç½®thisçš„åŸå‹ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1521669,"avatar":"https://static001.geekbang.org/account/avatar/00/17/38/05/7beecd5d.jpg","nickname":"Aiming","note":"","ucode":"66292B32F9960A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480640,"discussion_content":"æ˜¯çš„ã€‚ä¸éœ€è¦ã€‚JavaScirptç¡®å®å…è®¸â€œç±»â€è¿”å›â€œä»»æ„å¯¹è±¡â€ã€‚ä»JavaScript 1.2çš„è®¾è®¡å¼€å§‹ï¼Œå°±ä¸€ç›´å¦‚æ­¤ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578398045,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":260412,"user_name":"å°ç‚­","can_delete":false,"product_type":"c1","uid":1109544,"ip_address":"","ucode":"E20E3958CAF06C","user_header":"https://static001.geekbang.org/account/avatar/00/10/ee/28/c04a0c83.jpg","comment_is_top":false,"comment_ctime":1605000444,"is_pvip":true,"replies":[{"id":"94579","content":"è‡³ecmascript 2019è§„èŒƒä¸­åªæœ‰ä¸€ä¸ªæ˜ç¡®ç§°ä¸ºå…ƒå±æ€§çš„ä¸œè¥¿ï¼Œå°±æ˜¯new.targetã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Aiming","uid":"1521669","ctime":1605033043,"ip_address":"","comment_id":260412,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1605000444","product_id":100039701,"comment_content":"â€œè¿„ä»Šä¸ºæ­¢ï¼Œnew.targetæ˜¯ JavaScript ä¸­å”¯ä¸€çš„ä¸€ä¸ªå…ƒå±æ€§ã€‚â€ å¯¹è¿™å¥è¯æœ‰ç–‘æƒ‘ï¼Œå°±æ˜¯ä¸‹é¢è¿™äº›ä¸æ˜¯å…ƒå±æ€§å—ï¼Ÿ<br>{<br>  value: 123,<br>  writable: false,<br>  enumerable: true,<br>  configurable: false,<br>  get: undefined,<br>  set: undefined<br>}","like_count":0,"discussions":[{"author":{"id":1521669,"avatar":"https://static001.geekbang.org/account/avatar/00/17/38/05/7beecd5d.jpg","nickname":"Aiming","note":"","ucode":"66292B32F9960A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509187,"discussion_content":"è‡³ecmascript 2019è§„èŒƒä¸­åªæœ‰ä¸€ä¸ªæ˜ç¡®ç§°ä¸ºå…ƒå±æ€§çš„ä¸œè¥¿ï¼Œå°±æ˜¯new.targetã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605033043,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":221016,"user_name":"HoSalt","can_delete":false,"product_type":"c1","uid":1156074,"ip_address":"","ucode":"610B03E2A002D1","user_header":"https://static001.geekbang.org/account/avatar/00/11/a3/ea/53333dd5.jpg","comment_is_top":false,"comment_ctime":1590380864,"is_pvip":false,"replies":[{"id":"81610","content":"1. è°¢è°¢ã€‚æˆ‘è¯·ç¼–è¾‘æ”¹ä¸€ä¸‹ã€‚<br><br>2. ä¸å¯¹çš„ã€‚_Date()è¡¨è¾¾çš„æ„æ€å°±æ˜¯<br> 1). æ‹¿Date.prototypeæ¥åˆ›å»ºå®ä¾‹ï¼Œå› ä¸ºDate()å†…éƒ¨æ ¹æœ¬ä¸ä¼šç”¨ä¸€ä¸ªå¤–éƒ¨çš„åŸå‹æ¥åˆ›å»ºå®ä¾‹ã€‚<br> 2). å°†åˆ›å»ºå®ä¾‹thisçš„åŸå‹æŒ‡å‘new.target.prototype<br><br>æ ¹æœ¬ä¸Šæ¥è¯´ï¼ŒDate()åªèƒ½ä¿è¯ç”¨Date.prototypeæ¥åˆ›å»ºå®ä¾‹æ˜¯â€œæ­£ç¡®çš„â€ï¼Œè€Œä¸ä¿è¯èƒ½ç”¨new.target.prototypeåˆ›å»ºå‡ºæ­£ç¡®çš„å®ä¾‹ã€‚è®¾è®¡ä¸Šæ¥è¯´ï¼Œnew.target.prototypeæ˜¯ä»€ä¹ˆï¼Œæ˜¯æœªçŸ¥çš„ï¼Œå¯¹äºDate()æ¥è¯´å®ƒä¸å¯ä¾èµ–ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Aiming","uid":"1521669","ctime":1590462158,"ip_address":"","comment_id":221016,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1590380864","product_id":100039701,"comment_content":"<br>&#47;&#47; åœ¨JavaScriptå†…ç½®ç±»Date()ä¸­å¯èƒ½çš„å¤„ç†é€»è¾‘<br>function _Date() {<br>  this = Object.Create(Date.prototype, { _internal_slots });<br>  Object.setPrototypeOf(this, new.target.prototype);<br>  ...<br>}<br>1. Createåº”è¯¥æ˜¯å°å†™<br>2. è¿™æ®µä»£ç å‰é¢è®¾ç½®çš„__proto__ä¼šè¢«åé¢çš„è¦†ç›–å§ï¼Œä¸‹é¢è¿™æ ·å®ç°æ²¡é—®é¢˜å§ï¼Œå’Œç»§æ‰¿nullé‚£ä¸ªä¾‹å­ç±»ä¼¼<br>function _Date() {<br>  this = Object.create(new.target.prototype);<br>  ...<br>}","like_count":0,"discussions":[{"author":{"id":1521669,"avatar":"https://static001.geekbang.org/account/avatar/00/17/38/05/7beecd5d.jpg","nickname":"Aiming","note":"","ucode":"66292B32F9960A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496300,"discussion_content":"1. è°¢è°¢ã€‚æˆ‘è¯·ç¼–è¾‘æ”¹ä¸€ä¸‹ã€‚\n\n2. ä¸å¯¹çš„ã€‚_Date()è¡¨è¾¾çš„æ„æ€å°±æ˜¯\n 1). æ‹¿Date.prototypeæ¥åˆ›å»ºå®ä¾‹ï¼Œå› ä¸ºDate()å†…éƒ¨æ ¹æœ¬ä¸ä¼šç”¨ä¸€ä¸ªå¤–éƒ¨çš„åŸå‹æ¥åˆ›å»ºå®ä¾‹ã€‚\n 2). å°†åˆ›å»ºå®ä¾‹thisçš„åŸå‹æŒ‡å‘new.target.prototype\n\næ ¹æœ¬ä¸Šæ¥è¯´ï¼ŒDate()åªèƒ½ä¿è¯ç”¨Date.prototypeæ¥åˆ›å»ºå®ä¾‹æ˜¯â€œæ­£ç¡®çš„â€ï¼Œè€Œä¸ä¿è¯èƒ½ç”¨new.target.prototypeåˆ›å»ºå‡ºæ­£ç¡®çš„å®ä¾‹ã€‚è®¾è®¡ä¸Šæ¥è¯´ï¼Œnew.target.prototypeæ˜¯ä»€ä¹ˆï¼Œæ˜¯æœªçŸ¥çš„ï¼Œå¯¹äºDate()æ¥è¯´å®ƒä¸å¯ä¾èµ–ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590462158,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":163084,"user_name":"qqq","can_delete":false,"product_type":"c1","uid":1006786,"ip_address":"","ucode":"91B0ACF8CBE7BD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5c/c2/8ffd2ad0.jpg","comment_is_top":false,"comment_ctime":1576654501,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1576654501","product_id":100039701,"comment_content":"å› ä¸ºå¯ä»¥æ”¹å˜é»˜è®¤çš„åŸå‹ç»§æ‰¿è¡Œä¸º","like_count":0}]}