{"id":313791,"title":"07 | Load Averageï¼šåŠ äº†CPU Cgroupé™åˆ¶ï¼Œä¸ºä»€ä¹ˆæˆ‘çš„å®¹å™¨è¿˜æ˜¯å¾ˆæ…¢ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç¨‹è¿œã€‚ä»Šå¤©æˆ‘æƒ³èŠä¸€èŠå¹³å‡è´Ÿè½½ï¼ˆLoad Averageï¼‰çš„è¯é¢˜ã€‚</p><p>åœ¨ä¸Šä¸€è®²ä¸­ï¼Œæˆ‘ä»¬æåˆ°è¿‡CPU Cgroupå¯ä»¥é™åˆ¶è¿›ç¨‹çš„CPUèµ„æºä½¿ç”¨ï¼Œä½†æ˜¯CPU Cgroupå¯¹å®¹å™¨çš„èµ„æºé™åˆ¶æ˜¯å­˜åœ¨ç›²ç‚¹çš„ã€‚</p><p>ä»€ä¹ˆç›²ç‚¹å‘¢ï¼Ÿå°±æ˜¯æ— æ³•é€šè¿‡CPU Cgroupæ¥æ§åˆ¶Load Averageçš„å¹³å‡è´Ÿè½½ã€‚è€Œæ²¡æœ‰è¿™ä¸ªé™åˆ¶ï¼Œå°±ä¼šå½±å“æˆ‘ä»¬ç³»ç»Ÿèµ„æºçš„åˆç†è°ƒåº¦ï¼Œå¾ˆå¯èƒ½å¯¼è‡´æˆ‘ä»¬çš„ç³»ç»Ÿå˜å¾—å¾ˆæ…¢ã€‚</p><p>é‚£ä¹ˆä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬è¦æ¥è®²ä¸€ä¸‹ä¸ºä»€ä¹ˆåŠ äº†CPU Cgroupçš„é…ç½®åï¼Œå³ä½¿ä¿è¯äº†å®¹å™¨çš„CPUèµ„æºï¼Œå®¹å™¨ä¸­çš„è¿›ç¨‹è¿˜æ˜¯ä¼šè¿è¡Œå¾—å¾ˆæ…¢ï¼Ÿ</p><h2>é—®é¢˜å†ç°</h2><p>åœ¨Linuxçš„ç³»ç»Ÿç»´æŠ¤ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç»å¸¸æŸ¥çœ‹CPUä½¿ç”¨æƒ…å†µï¼Œå†æ ¹æ®è¿™ä¸ªæƒ…å†µåˆ†æç³»ç»Ÿæ•´ä½“çš„è¿è¡ŒçŠ¶æ€ã€‚æœ‰æ—¶å€™ä½ å¯èƒ½ä¼šå‘ç°ï¼Œæ˜æ˜å®¹å™¨é‡Œæ‰€æœ‰è¿›ç¨‹çš„CPUä½¿ç”¨ç‡éƒ½å¾ˆä½ï¼Œç”šè‡³æ•´ä¸ªå®¿ä¸»æœºçš„CPUä½¿ç”¨ç‡éƒ½å¾ˆä½ï¼Œè€Œæœºå™¨çš„Load Averageé‡Œçš„å€¼å´å¾ˆé«˜ï¼Œå®¹å™¨é‡Œè¿›ç¨‹è¿è¡Œå¾—ä¹Ÿå¾ˆæ…¢ã€‚</p><p>è¿™ä¹ˆè¯´æœ‰äº›æŠ½è±¡ï¼Œæˆ‘ä»¬ä¸€èµ·åŠ¨æ‰‹å†ç°ä¸€ä¸‹è¿™ä¸ªæƒ…å†µï¼Œè¿™æ ·ä½ å°±èƒ½æ›´å¥½åœ°ç†è§£è¿™ä¸ªé—®é¢˜äº†ã€‚</p><p>æ¯”å¦‚è¯´ä¸‹é¢çš„topè¾“å‡ºï¼Œç¬¬ä¸‰è¡Œå¯ä»¥æ˜¾ç¤ºå½“å‰çš„CPUä½¿ç”¨æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•´ä¸ªæœºå™¨çš„CPU Usageå‡ ä¹ä¸º0ï¼Œå› ä¸º\"id\"æ˜¾ç¤º99.9%ï¼Œè¿™è¯´æ˜CPUæ˜¯å¤„äºç©ºé—²çŠ¶æ€çš„ã€‚</p><p>ä½†æ˜¯è¯·ä½ æ³¨æ„ï¼Œè¿™é‡Œ1åˆ†é’Ÿçš„\"load average\"çš„å€¼å´é«˜è¾¾9.09ï¼Œè¿™é‡Œçš„æ•°å€¼9å‡ ä¹å°±æ„å‘³ç€ä½¿ç”¨äº†9ä¸ªCPUäº†ï¼Œè¿™æ ·CPU Usageå’ŒLoad Averageçš„æ•°å€¼çœ‹ä¸Šå»å°±å¾ˆçŸ›ç›¾äº†ã€‚</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/50/be/507d6732efd350d47161174bc0a8e9be.png?wh=1858*278\" alt=\"\"></p><p>é‚£é—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬åœ¨çœ‹ä¸€ä¸ªç³»ç»Ÿé‡ŒCPUä½¿ç”¨æƒ…å†µæ—¶ï¼Œåˆ°åº•æ˜¯çœ‹CPU Usageè¿˜æ˜¯Load Averageå‘¢ï¼Ÿ</p><p>è¿™é‡Œå°±æ¶‰åŠåˆ°ä»Šå¤©è¦è§£å†³çš„ä¸¤å¤§é—®é¢˜ï¼š</p><ol>\n<li>Load Averageåˆ°åº•æ˜¯ä»€ä¹ˆï¼ŒCPU Usageå’ŒLoad Averageæœ‰ä»€ä¹ˆå·®åˆ«ï¼Ÿ</li>\n<li>å¦‚æœLoad Averageå€¼å‡é«˜ï¼Œåº”ç”¨çš„æ€§èƒ½ä¸‹é™äº†ï¼Œè¿™èƒŒåçš„åŸå› æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</li>\n</ol><p>å¥½äº†ï¼Œè¿™ä¸€è®²æˆ‘ä»¬å°±å¸¦ç€è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œä¸€èµ·å»æ­å¼€è°œåº•ã€‚</p><h2>ä»€ä¹ˆæ˜¯Load Average?</h2><p>è¦å›ç­”å‰é¢çš„é—®é¢˜ï¼Œå¾ˆæ˜¾ç„¶æˆ‘ä»¬è¦ææ˜ç™½è¿™ä¸ªLinuxé‡Œçš„\"load average\"è¿™ä¸ªå€¼æ˜¯ä»€ä¹ˆæ„æ€ï¼Œåˆæ˜¯æ€æ ·è®¡ç®—çš„ã€‚</p><p>Load Averageè¿™ä¸ªæ¦‚å¿µï¼Œä½ å¯èƒ½åœ¨ä½¿ç”¨Linuxçš„æ—¶å€™å°±å·²ç»æ³¨æ„åˆ°äº†ï¼Œæ— è®ºä½ æ˜¯è¿è¡Œuptime, è¿˜æ˜¯topï¼Œéƒ½å¯ä»¥çœ‹åˆ°ç±»ä¼¼è¿™ä¸ªè¾“å‡º\"load averageï¼š2.02, 1.83, 1.20\"ã€‚é‚£ä¹ˆè¿™ä¸€ä¸²è¾“å‡ºåˆ°åº•æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</p><p>æœ€ç›´æ¥çš„åŠæ³•å½“ç„¶æ˜¯çœ‹æ‰‹å†Œäº†ï¼Œå¦‚æœæˆ‘ä»¬ç”¨\"Linux manual page\"æœç´¢uptimeæˆ–è€…topï¼Œå°±ä¼šçœ‹åˆ°å¯¹è¿™ä¸ª\"load average\"å’Œåé¢ä¸‰ä¸ªæ•°å­—çš„è§£é‡Šæ˜¯\"the system load averages for the past 1, 5, and 15 minutes\"ã€‚</p><p>è¿™ä¸ªè§£é‡Šå°±æ˜¯è¯´ï¼Œåé¢çš„ä¸‰ä¸ªæ•°å€¼åˆ†åˆ«ä»£è¡¨è¿‡å»1åˆ†é’Ÿï¼Œ5åˆ†é’Ÿï¼Œ15åˆ†é’Ÿåœ¨è¿™ä¸ªèŠ‚ç‚¹ä¸Šçš„Load Averageï¼Œä½†æ˜¯çœ‹äº†æ‰‹å†Œä¸Šçš„è§£é‡Šï¼Œæˆ‘ä»¬è¿˜æ˜¯ä¸èƒ½ç†è§£ä»€ä¹ˆæ˜¯Load Averageã€‚</p><p>è¿™ä¸ªæ—¶å€™ï¼Œä½ å¦‚æœå†å»ç½‘ä¸Šæ‰¾èµ„æ–™ï¼Œå°±ä¼šå‘ç°Load Averageæ˜¯ä¸€ä¸ªå¾ˆå¤è€çš„æ¦‚å¿µäº†ã€‚ä¸Šä¸ªä¸–çºª70å¹´ä»£ï¼Œæ—©æœŸçš„Unixç³»ç»Ÿä¸Šå°±å·²ç»æœ‰äº†è¿™ä¸ªLoad Averageï¼ŒIETFè¿˜æœ‰ä¸€ä¸ª<a href=\"https://tools.ietf.org/html/rfc546\">RFC546</a>å®šä¹‰äº†Load Averageï¼Œè¿™é‡Œå®šä¹‰çš„Load Averageæ˜¯<strong>ä¸€ç§CPUèµ„æºéœ€æ±‚çš„åº¦é‡ã€‚</strong></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå¯¹äºä¸€ä¸ªå•ä¸ªCPUçš„ç³»ç»Ÿï¼Œå¦‚æœåœ¨1åˆ†é’Ÿçš„æ—¶é—´é‡Œï¼Œå¤„ç†å™¨ä¸Šå§‹ç»ˆæœ‰ä¸€ä¸ªè¿›ç¨‹åœ¨è¿è¡Œï¼ŒåŒæ—¶æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹å¯è¿è¡Œé˜Ÿåˆ—ä¸­å§‹ç»ˆéƒ½æœ‰9ä¸ªè¿›ç¨‹åœ¨ç­‰å¾…è·å–CPUèµ„æºã€‚é‚£ä¹ˆå¯¹äºè¿™1åˆ†é’Ÿçš„æ—¶é—´æ¥è¯´ï¼Œç³»ç»Ÿçš„\"load average\"å°±æ˜¯1+9=10ï¼Œè¿™ä¸ªå®šä¹‰å¯¹ç»å¤§éƒ¨åˆ†çš„Unixç³»ç»Ÿéƒ½é€‚ç”¨ã€‚</p><p>å¯¹äºLinuxæ¥è¯´ï¼Œå¦‚æœåªè€ƒè™‘CPUçš„èµ„æºï¼ŒLoad Averagç­‰äºå•ä½æ—¶é—´å†…æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹åŠ ä¸Šå¯è¿è¡Œé˜Ÿåˆ—çš„è¿›ç¨‹ï¼Œè¿™ä¸ªå®šä¹‰ä¹Ÿæ˜¯æˆç«‹çš„ã€‚é€šè¿‡è¿™ä¸ªå®šä¹‰å’Œæˆ‘è‡ªå·±çš„è§‚å¯Ÿï¼Œæˆ‘ç»™ä½ å½’çº³äº†ä¸‹é¢ä¸‰ç‚¹å¯¹Load Averageçš„ç†è§£ã€‚</p><p>ç¬¬ä¸€ï¼Œä¸è®ºè®¡ç®—æœºCPUæ˜¯ç©ºé—²è¿˜æ˜¯æ»¡è´Ÿè½½ï¼ŒLoad Averageéƒ½æ˜¯Linuxè¿›ç¨‹è°ƒåº¦å™¨ä¸­<strong>å¯è¿è¡Œé˜Ÿåˆ—ï¼ˆRunning Queueï¼‰é‡Œçš„ä¸€æ®µæ—¶é—´çš„å¹³å‡è¿›ç¨‹æ•°ç›®ã€‚</strong></p><p>ç¬¬äºŒï¼Œè®¡ç®—æœºä¸Šçš„CPUè¿˜æœ‰ç©ºé—²çš„æƒ…å†µä¸‹ï¼ŒCPU Usageå¯ä»¥ç›´æ¥åæ˜ åˆ°\"load average\"ä¸Šï¼Œä»€ä¹ˆæ˜¯CPUè¿˜æœ‰ç©ºé—²å‘¢ï¼Ÿå…·ä½“æ¥è¯´å°±æ˜¯å¯è¿è¡Œé˜Ÿåˆ—ä¸­çš„è¿›ç¨‹æ•°ç›®å°äºCPUä¸ªæ•°ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œå•ä½æ—¶é—´è¿›ç¨‹CPU Usageç›¸åŠ çš„å¹³å‡å€¼åº”è¯¥å°±æ˜¯\"load average\"çš„å€¼ã€‚</p><p>ç¬¬ä¸‰ï¼Œè®¡ç®—æœºä¸Šçš„CPUæ»¡è´Ÿè½½çš„æƒ…å†µä¸‹ï¼Œè®¡ç®—æœºä¸Šçš„CPUå·²ç»æ˜¯æ»¡è´Ÿè½½äº†ï¼ŒåŒæ—¶è¿˜æœ‰æ›´å¤šçš„è¿›ç¨‹åœ¨æ’é˜Ÿéœ€è¦CPUèµ„æºã€‚è¿™æ—¶\"load average\"å°±ä¸èƒ½å’ŒCPU Usageç­‰åŒäº†ã€‚</p><p>æ¯”å¦‚å¯¹äºå•ä¸ªCPUçš„ç³»ç»Ÿï¼ŒCPU Usageæœ€å¤§åªæ˜¯æœ‰100%ï¼Œä¹Ÿå°±1ä¸ªCPUï¼›è€Œ\"load average\"çš„å€¼å¯ä»¥è¿œè¿œå¤§äº1ï¼Œå› ä¸º\"load average\"çœ‹çš„æ˜¯æ“ä½œç³»ç»Ÿä¸­å¯è¿è¡Œé˜Ÿåˆ—ä¸­è¿›ç¨‹çš„ä¸ªæ•°ã€‚</p><p>è¿™æ ·çš„è§£é‡Šå¯èƒ½å¤ªæŠ½è±¡äº†ï¼Œä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼Œæˆ‘ä»¬ä¸€èµ·åŠ¨æ‰‹éªŒè¯ä¸€ä¸‹ã€‚</p><p>æ€ä¹ˆéªŒè¯å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸ªç¨‹åºæ¥æ¨¡æ‹Ÿä¸€ä¸‹,å…ˆå‡†å¤‡å¥½ä¸€ä¸ªå¯ä»¥æ¶ˆè€—ä»»æ„CPU Usageçš„<a href=\"https://github.com/chengyli/training/tree/master/cpu/cgroup_cpu/threads-cpu\">ç¨‹åº</a>ï¼Œåœ¨æ‰§è¡Œè¿™ä¸ªç¨‹åºçš„æ—¶å€™ï¼Œåé¢åŠ ä¸ªæ•°å­—ä½œä¸ºå‚æ•°ï¼Œ</p><p>æ¯”å¦‚ä¸‹é¢çš„è®¾ç½®ï¼Œå‚æ•°æ˜¯2ï¼Œå°±æ˜¯è¯´è¿™ä¸ªè¿›ç¨‹ä¼šåˆ›å»ºå‡ºä¸¤ä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸”æ¯ä¸ªçº¿ç¨‹éƒ½è·‘æ»¡100%çš„CPUï¼Œ2ä¸ªçº¿ç¨‹å°±æ˜¯2 * 100% = 200%çš„CPU Usageï¼Œä¹Ÿå°±æ˜¯æ¶ˆè€—äº†æ•´æ•´ä¸¤ä¸ªCPUçš„èµ„æºã€‚</p><pre><code># ./threads-cpu 2\n</code></pre><p>å‡†å¤‡å¥½äº†è¿™ä¸ªCPU Usageçš„æ¨¡æ‹Ÿç¨‹åºï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨å®ƒæ¥æŸ¥çœ‹CPU Usageå’ŒLoad Averageä¹‹é—´çš„å…³ç³»äº†ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·è·‘ä¸¤ä¸ªä¾‹å­ï¼Œç¬¬ä¸€ä¸ªä¾‹å­æ˜¯æ‰§è¡Œ2ä¸ªæ»¡è´Ÿè½½çš„çº¿ç¨‹ï¼Œç¬¬äºŒä¸ªä¾‹å­æ‰§è¡Œ6ä¸ªæ»¡è´Ÿè½½çš„çº¿ç¨‹ï¼ŒåŒæ ·éƒ½æ˜¯åœ¨ä¸€å°4ä¸ªCPUçš„èŠ‚ç‚¹ä¸Šã€‚</p><p>å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬åœ¨ä¸€å°4ä¸ªCPUçš„è®¡ç®—æœºèŠ‚ç‚¹ä¸Šè¿è¡Œåˆšæ‰è¿™ä¸ªæ¨¡æ‹Ÿç¨‹åºï¼Œè¿˜æ˜¯è®¾ç½®å‚æ•°ä¸º2ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨2ä¸ªCPU Usageã€‚åœ¨è¿™ä¸ªç¨‹åºè¿è¡Œäº†å‡ åˆ†é’Ÿä¹‹åï¼Œæˆ‘ä»¬è¿è¡Œtopæ¥æŸ¥çœ‹ä¸€ä¸‹CPU Usageå’ŒLoad Averageã€‚</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªthreads-cpuå„è‡ªéƒ½å äº†å°†è¿‘100%çš„CPUï¼Œä¸¤ä¸ªå°±æ˜¯200%ï¼Œ2ä¸ªCPUï¼Œå¯¹äº4ä¸ªCPUçš„è®¡ç®—æœºæ¥è¯´ï¼ŒCPU Usageå äº†50%ï¼Œç©ºé—²äº†ä¸€åŠï¼Œè¿™ä¸ªæˆ‘ä»¬ä¹Ÿå¯ä»¥ä» idle ï¼ˆidï¼‰ï¼š49.9%å¾—åˆ°å°è¯ã€‚</p><p>è¿™æ—¶å€™ï¼ŒLoad Averageé‡Œç¬¬ä¸€é¡¹ï¼ˆä¹Ÿå°±æ˜¯å‰1åˆ†é’Ÿçš„æ•°å€¼ï¼‰ä¸º1.98ï¼Œè¿‘ä¼¼äº2ã€‚è¿™ä¸ªå€¼å’Œæˆ‘ä»¬ä¸€ç›´è¿è¡Œçš„200%CPU  Usageç›¸å¯¹åº”ï¼Œä¹ŸéªŒè¯äº†æˆ‘ä»¬ä¹‹å‰å½’çº³çš„ç¬¬äºŒç‚¹â€”â€”<strong>CPU Usageå¯ä»¥åæ˜ åˆ°Load Averageä¸Šã€‚</strong></p><p>å› ä¸ºè¿è¡Œçš„æ—¶é—´ä¸å¤Ÿï¼Œå‰5åˆ†é’Ÿï¼Œå‰15åˆ†é’Ÿçš„Load Averageè¿˜æ²¡æœ‰åˆ°2ï¼Œè€Œä¸”åé¢æˆ‘ä»¬çš„ä¾‹å­ç¨‹åºä¸€èˆ¬éƒ½åªä¼šè¿è¡Œå‡ åˆ†é’Ÿï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åªçœ‹å‰1åˆ†é’Ÿçš„Load Averageå€¼å°±è¡Œã€‚</p><p>å¦å¤–ï¼ŒLinuxå†…æ ¸ä¸­ä¸ä½¿ç”¨æµ®ç‚¹è®¡ç®—ï¼Œè¿™å¯¼è‡´Load Averageé‡Œçš„1åˆ†é’Ÿï¼Œ5åˆ†é’Ÿï¼Œ15åˆ†é’Ÿçš„æ—¶é—´å€¼å¹¶ä¸ç²¾ç¡®ï¼Œä½†è¿™ä¸å½±å“æˆ‘ä»¬æŸ¥çœ‹Load Averageçš„æ•°å€¼ï¼Œæ‰€ä»¥å…ˆä¸ç”¨ç®¡è¿™ä¸ªæ—¶é—´çš„å‡†ç¡®æ€§ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/11/52/110f67d3b31a62d3d7f27bb4a28aa552.png?wh=1606*420\" alt=\"\"><br>\né‚£æˆ‘ä»¬å†æ¥è·‘ç¬¬äºŒä¸ªä¾‹å­ï¼ŒåŒæ ·åœ¨è¿™ä¸ª4ä¸ªCPUçš„è®¡ç®—æœºèŠ‚ç‚¹ä¸Šï¼Œå¦‚æœæˆ‘ä»¬æ‰§è¡ŒCPU Usageæ¨¡æ‹Ÿç¨‹åºthreads-cpuï¼Œè®¾ç½®å‚æ•°ä¸º6ï¼Œè®©è¿™ä¸ªè¿›ç¨‹å»ºå‡º6ä¸ªçº¿ç¨‹ï¼Œè¿™æ ·æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šå°½é‡å»æŠ¢å CPUï¼Œä½†æ˜¯è®¡ç®—æœºæ€»å…±åªæœ‰4ä¸ªCPUï¼Œæ‰€ä»¥è¿™6ä¸ªçº¿ç¨‹çš„CPU UsageåŠ èµ·æ¥åªæ˜¯400%ã€‚</p><p>æ˜¾ç„¶è¿™æ—¶å€™4ä¸ªCPUéƒ½è¢«å æ»¡äº†ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•´ä¸ªèŠ‚ç‚¹çš„idleï¼ˆidï¼‰ä¹Ÿå·²ç»æ˜¯0.0%äº†ã€‚</p><p>ä½†è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬çœ‹çœ‹å‰1åˆ†é’Ÿçš„Load Averageï¼Œæ•°å€¼ä¸æ˜¯4è€Œæ˜¯5.93æ¥è¿‘6ï¼Œæˆ‘ä»¬æ­£å¥½æ¨¡æ‹Ÿäº†6ä¸ªé«˜CPUéœ€æ±‚çš„çº¿ç¨‹ã€‚è¿™ä¹Ÿå‘Šè¯‰æˆ‘ä»¬ï¼ŒLoad Averageè¡¨ç¤ºçš„æ˜¯ä¸€æ®µæ—¶é—´é‡Œè¿è¡Œé˜Ÿåˆ—ä¸­éœ€è¦è¢«è°ƒåº¦çš„è¿›ç¨‹/çº¿ç¨‹å¹³å‡æ•°ç›®ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/3c/26/3caf637cb3bc20yy5610b3d0bf59bd26.png?wh=1628*614\" alt=\"\"></p><p>è®²åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯å°±å¯ä»¥è®¤å®šLoad Averageå°±ä»£è¡¨ä¸€æ®µæ—¶é—´é‡Œè¿è¡Œé˜Ÿåˆ—ä¸­éœ€è¦è¢«è°ƒåº¦çš„è¿›ç¨‹æˆ–è€…çº¿ç¨‹å¹³å‡æ•°ç›®äº†å‘¢? æˆ–è®¸å¯¹å…¶ä»–çš„Unixç³»ç»Ÿæ¥è¯´ï¼Œè¿™ä¸ªç†è§£å·²ç»å¤Ÿäº†ï¼Œä½†æ˜¯å¯¹äºLinuxç³»ç»Ÿè¿˜ä¸èƒ½è¿™ä¹ˆè®¤å®šã€‚</p><p>ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿæ•…äº‹è¿˜è¦ä»Linuxæ—©æœŸçš„å†å²è¯´èµ·ï¼Œé‚£æ—¶å¼€å‘è€…Matthiasæœ‰è¿™ä¹ˆä¸€ä¸ªå‘ç°ï¼Œæ¯”å¦‚æŠŠå¿«é€Ÿçš„ç£ç›˜æ¢æˆäº†æ…¢é€Ÿçš„ç£ç›˜ï¼Œè¿è¡ŒåŒæ ·çš„è´Ÿè½½ï¼Œç³»ç»Ÿçš„æ€§èƒ½æ˜¯ä¸‹é™çš„ï¼Œä½†æ˜¯Load Averageå´æ²¡æœ‰åæ˜ å‡ºæ¥ã€‚</p><p>ä»–å‘ç°è¿™æ˜¯å› ä¸ºLoad Averageåªè€ƒè™‘è¿è¡Œæ€çš„è¿›ç¨‹æ•°ç›®ï¼Œè€Œæ²¡æœ‰è€ƒè™‘ç­‰å¾…I/Oçš„è¿›ç¨‹ã€‚æ‰€ä»¥ï¼Œä»–è®¤ä¸ºLoad Averageå¦‚æœåªæ˜¯è€ƒè™‘è¿›ç¨‹è¿è¡Œé˜Ÿåˆ—ä¸­éœ€è¦è¢«è°ƒåº¦çš„è¿›ç¨‹æˆ–çº¿ç¨‹å¹³å‡æ•°ç›®æ˜¯ä¸å¤Ÿçš„ï¼Œå› ä¸ºå¯¹äºå¤„äºI/Oèµ„æºç­‰å¾…çš„è¿›ç¨‹éƒ½æ˜¯å¤„äºTASK_UNINTERRUPTIBLEçŠ¶æ€çš„ã€‚</p><p>é‚£ä»–æ˜¯æ€ä¹ˆå¤„ç†è¿™ä»¶äº‹çš„å‘¢ï¼Ÿä¼°è®¡ä½ ä¹ŸçŒœåˆ°äº†ï¼Œä»–ç»™å†…æ ¸åŠ ä¸€ä¸ªpatchï¼ˆè¡¥ä¸ï¼‰ï¼ŒæŠŠå¤„äºTASK_UNINTERRUPTIBLEçŠ¶æ€çš„è¿›ç¨‹æ•°ç›®ä¹Ÿè®¡å…¥äº†Load Averageä¸­ã€‚</p><p>åœ¨è¿™é‡Œæˆ‘ä»¬åˆæåˆ°äº†TASK_UNINTERRUPTIBLEçŠ¶æ€çš„è¿›ç¨‹ï¼Œåœ¨å‰é¢çš„ç« èŠ‚ä¸­æˆ‘ä»¬ä»‹ç»è¿‡ï¼Œæˆ‘å†ç»™ä½ å¼ºè°ƒä¸€ä¸‹ï¼Œ<strong>TASK_UNINTERRUPTIBLEæ˜¯Linuxè¿›ç¨‹çŠ¶æ€çš„ä¸€ç§ï¼Œæ˜¯è¿›ç¨‹ä¸ºç­‰å¾…æŸä¸ªç³»ç»Ÿèµ„æºè€Œè¿›å…¥äº†ç¡çœ çš„çŠ¶æ€ï¼Œå¹¶ä¸”è¿™ç§ç¡çœ çš„çŠ¶æ€æ˜¯ä¸èƒ½è¢«ä¿¡å·æ‰“æ–­çš„ã€‚</strong></p><p>ä¸‹é¢å°±æ˜¯1993å¹´Matthiasçš„kernel patchï¼Œä½ æœ‰å…´è¶£çš„è¯ï¼Œå¯ä»¥è¯»ä¸€ä¸‹ã€‚</p><pre><code class=\"language-shell\">From: Matthias Urlichs &lt;urlichs@smurf.sub.org&gt;\nSubject: Load average broken ?\nDate: Fri, 29 Oct 1993 11:37:23 +0200\n\nThe kernel only counts \"runnable\" processes when computing the load average.\nI don't like that; the problem is that processes which are swapping or\nwaiting on \"fast\", i.e. noninterruptible, I/O, also consume resources.\n\nIt seems somewhat nonintuitive that the load average goes down when you\nreplace your fast swap disk with a slow swap disk...\n\nAnyway, the following patch seems to make the load average much more\nconsistent WRT the subjective speed of the system. And, most important, the\nload is still zero when nobody is doing anything. ;-)\n\n--- kernel/sched.c.orig Fri Oct 29 10:31:11 1993\n+++ kernel/sched.c Fri Oct 29 10:32:51 1993\n@@ -414,7 +414,9 @@\nunsigned long nr = 0;\n\n    for(p = &amp;LAST_TASK; p &gt; &amp;FIRST_TASK; --p)\n-       if (*p &amp;&amp; (*p)-&gt;state == TASK_RUNNING)\n+       if (*p &amp;&amp; ((*p)-&gt;state == TASK_RUNNING) ||\n+                  (*p)-&gt;state == TASK_UNINTERRUPTIBLE) ||\n+                  (*p)-&gt;state == TASK_SWAPPING))\n            nr += FIXED_1;\n    return nr;\n }\n</code></pre><p>é‚£ä¹ˆå¯¹äºLinuxçš„Load Averageæ¥è¯´ï¼Œé™¤äº†å¯è¿è¡Œé˜Ÿåˆ—ä¸­çš„è¿›ç¨‹æ•°ç›®ï¼Œç­‰å¾…é˜Ÿåˆ—ä¸­çš„UNINTERRUPTIBLEè¿›ç¨‹æ•°ç›®ä¹Ÿä¼šå¢åŠ Load Averageã€‚</p><p>ä¸ºäº†éªŒè¯è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿä¸€ä¸‹UNINTERRUPTIBLEçš„è¿›ç¨‹ï¼Œæ¥çœ‹çœ‹Load Averageçš„å˜åŒ–ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬åšä¸€ä¸ª<a href=\"https://github.com/chengyli/training/tree/master/cpu/load_average/uninterruptable/kmod\">kernel module</a>ï¼Œé€šè¿‡ä¸€ä¸ª/procæ–‡ä»¶ç³»ç»Ÿç»™ç”¨æˆ·ç¨‹åºæä¾›ä¸€ä¸ªè¯»å–çš„æ¥å£ï¼Œåªè¦ç”¨æˆ·è¿›ç¨‹è¯»å–äº†è¿™ä¸ªæ¥å£å°±ä¼šè¿›å…¥UNINTERRUPTIBLEã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ¨¡æ‹Ÿä¸¤ä¸ªå¤„äºUNINTERRUPTIBLEçŠ¶æ€çš„è¿›ç¨‹ï¼Œç„¶åæŸ¥çœ‹ä¸€ä¸‹Load Averageæœ‰æ²¡æœ‰å¢åŠ ã€‚</p><p>æˆ‘ä»¬å‘ç°ç¨‹åºè·‘äº†å‡ åˆ†é’Ÿä¹‹åï¼Œå‰1åˆ†é’Ÿçš„Load Averageå·®ä¸å¤šä»0å¢åŠ åˆ°äº†2.16ï¼ŒèŠ‚ç‚¹ä¸ŠCPU  Usageå‡ ä¹ä¸º0ï¼Œidleä¸º99.8%ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œå¯è¿è¡Œé˜Ÿåˆ—ï¼ˆRunning Queueï¼‰ä¸­çš„è¿›ç¨‹æ•°ç›®æ˜¯0ï¼Œåªæœ‰ä¼‘çœ é˜Ÿåˆ—ï¼ˆSleeping Queueï¼‰ä¸­æœ‰ä¸¤ä¸ªè¿›ç¨‹ï¼Œå¹¶ä¸”è¿™ä¸¤ä¸ªè¿›ç¨‹æ˜¾ç¤ºä¸ºD stateè¿›ç¨‹ï¼Œè¿™ä¸ªD stateè¿›ç¨‹ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ¨¡æ‹Ÿå‡ºæ¥çš„TASK_UNINTERRUPTIBLEçŠ¶æ€çš„è¿›ç¨‹ã€‚</p><p>è¿™ä¸ªä¾‹å­è¯æ˜äº†Linuxå°†TASK_UNINTERRUPTIBLEçŠ¶æ€çš„è¿›ç¨‹æ•°ç›®è®¡å…¥äº†Load Averageä¸­ï¼Œæ‰€ä»¥å³ä½¿CPUä¸Šä¸åšä»»ä½•çš„è®¡ç®—ï¼ŒLoad Averageä»ç„¶ä¼šå‡é«˜ã€‚å¦‚æœTASK_UNINTERRUPTIBLEçŠ¶æ€çš„è¿›ç¨‹æ•°ç›®æœ‰å‡ ç™¾å‡ åƒä¸ªï¼Œé‚£ä¹ˆLoad Averageçš„æ•°å€¼ä¹Ÿå¯ä»¥è¾¾åˆ°å‡ ç™¾å‡ åƒã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e0/a9/e031338191bcec89b7fb02c19af843a9.png?wh=1622*438\" alt=\"\"></p><p>å¥½äº†ï¼Œåˆ°è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥å‡†ç¡®å®šä¹‰Linuxç³»ç»Ÿé‡Œçš„Load Averageäº†ï¼Œå…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œä½ åªéœ€è¦è®°ä½ï¼Œå¹³å‡è´Ÿè½½ç»Ÿè®¡äº†è¿™ä¸¤ç§æƒ…å†µçš„è¿›ç¨‹ï¼š</p><p>ç¬¬ä¸€ç§æ˜¯Linuxè¿›ç¨‹è°ƒåº¦å™¨ä¸­å¯è¿è¡Œé˜Ÿåˆ—ï¼ˆRunning Queueï¼‰ä¸€æ®µæ—¶é—´ï¼ˆ1åˆ†é’Ÿï¼Œ5åˆ†é’Ÿï¼Œ15åˆ†é’Ÿï¼‰çš„è¿›ç¨‹å¹³å‡æ•°ã€‚</p><p>ç¬¬äºŒç§æ˜¯Linuxè¿›ç¨‹è°ƒåº¦å™¨ä¸­ä¼‘çœ é˜Ÿåˆ—ï¼ˆSleeping Queueï¼‰é‡Œçš„ä¸€æ®µæ—¶é—´çš„TASK_UNINTERRUPTIBLEçŠ¶æ€ä¸‹çš„è¿›ç¨‹å¹³å‡æ•°ã€‚</p><p>æ‰€ä»¥ï¼Œæœ€åçš„å…¬å¼å°±æ˜¯ï¼š<strong>Load Average=å¯è¿è¡Œé˜Ÿåˆ—è¿›ç¨‹å¹³å‡æ•°+ä¼‘çœ é˜Ÿåˆ—ä¸­ä¸å¯æ‰“æ–­çš„è¿›ç¨‹å¹³å‡æ•°</strong></p><p>å¦‚æœæ‰“ä¸ªæ¯”æ–¹æ¥è¯´æ˜Load Averageçš„ç»Ÿè®¡åŸç†ã€‚ä½ å¯ä»¥æƒ³è±¡æ¯ä¸ªCPUå°±æ˜¯ä¸€æ¡é“è·¯ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æ˜¯ä¸€è¾†è½¦ï¼Œæ€ä¹ˆç§‘å­¦ç»Ÿè®¡é“è·¯çš„å¹³å‡è´Ÿè½½å‘¢ï¼Ÿå°±æ˜¯çœ‹å•ä½æ—¶é—´é€šè¿‡çš„è½¦è¾†ï¼Œä¸€æ¡é“ä¸Šçš„è½¦è¶Šå¤šï¼Œé‚£ä¹ˆè¿™æ¡é“è·¯çš„è´Ÿè½½ä¹Ÿå°±è¶Šé«˜ã€‚</p><p>æ­¤å¤–ï¼ŒLinuxè®¡ç®—ç³»ç»Ÿè´Ÿè½½çš„æ—¶å€™ï¼Œè¿˜é¢å¤–åšäº†ä¸ªè¡¥ä¸æŠŠTASK_UNINTERRUPTIBLEçŠ¶æ€çš„è¿›ç¨‹ä¹Ÿè€ƒè™‘äº†ï¼Œè¿™ä¸ªå°±åƒé“è·¯ä¸­è¦æŠŠçº¢ç»¿ç¯æƒ…å†µä¹Ÿè€ƒè™‘è¿›å»ã€‚ä¸€æ—¦æœ‰äº†çº¢ç¯ï¼Œæ±½è½¦å°±è¦åœä¸‹æ¥æ’é˜Ÿï¼Œé‚£ä¹ˆå³ä½¿é“è·¯å¾ˆç©ºï¼Œä½†æ˜¯çº¢ç¯å¤šäº†ï¼Œæ±½è½¦ä¹Ÿè¦æ’é˜Ÿç­‰å¾…ï¼Œä¹Ÿå¼€ä¸å¿«ã€‚</p><h2>ç°è±¡è§£é‡Šï¼šä¸ºä»€ä¹ˆLoad Averageä¼šå‡é«˜ï¼Ÿ</h2><p>è§£é‡Šäº†Load Averageè¿™ä¸ªæ¦‚å¿µï¼Œæˆ‘ä»¬å†å›åˆ°è¿™ä¸€è®²æœ€å¼€å§‹çš„é—®é¢˜ï¼Œä¸ºä»€ä¹ˆå¯¹å®¹å™¨å·²ç»ç”¨CPU  Cgroupé™åˆ¶äº†å®ƒçš„CPU  Usageï¼Œå®¹å™¨é‡Œçš„è¿›ç¨‹è¿˜æ˜¯å¯ä»¥é€ æˆæ•´ä¸ªç³»ç»Ÿå¾ˆé«˜çš„Load Averageã€‚</p><p>æˆ‘ä»¬ç†è§£äº†Load Averageè¿™ä¸ªæ¦‚å¿µä¹‹åï¼Œå°±èƒ½åŒºåˆ†å‡ºLoad Avergeå’ŒCPUä½¿ç”¨ç‡çš„åŒºåˆ«äº†ã€‚é‚£ä¹ˆè¿™ä¸ªçœ‹ä¼¼çŸ›ç›¾çš„é—®é¢˜ä¹Ÿå°±å¾ˆå¥½å›ç­”äº†ï¼Œå› ä¸º<strong>Linuxä¸‹çš„Load Avergeä¸ä»…ä»…è®¡ç®—äº†CPU Usageçš„éƒ¨åˆ†ï¼Œå®ƒè¿˜è®¡ç®—äº†ç³»ç»Ÿä¸­TASK_UNINTERRUPTIBLEçŠ¶æ€çš„è¿›ç¨‹æ•°ç›®ã€‚</strong></p><p>è®²åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†ç¬¬ä¸€ä¸ªé—®é¢˜çš„ç­”æ¡ˆï¼Œé‚£ä¹ˆç°åœ¨æˆ‘ä»¬å†çœ‹ç¬¬äºŒä¸ªé—®é¢˜ï¼šå¦‚æœLoad Averageå€¼å‡é«˜ï¼Œåº”ç”¨çš„æ€§èƒ½å·²ç»ä¸‹é™äº†ï¼ŒçœŸæ­£çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿé—®é¢˜å°±å‡ºåœ¨TASK_UNINTERRUPTIBLEçŠ¶æ€çš„è¿›ç¨‹ä¸Šäº†ã€‚</p><p>æ€ä¹ˆéªŒè¯è¿™ä¸ªåˆ¤æ–­å‘¢ï¼Ÿè¿™æ—¶å€™æˆ‘ä»¬åªè¦è¿è¡Œ <code>ps aux | grep â€œ D â€</code> ï¼Œå°±å¯ä»¥çœ‹åˆ°å®¹å™¨ä¸­æœ‰å¤šå°‘TASK_UNINTERRUPTIBLEçŠ¶æ€ï¼ˆåœ¨pså‘½ä»¤ä¸­è¿™ä¸ªçŠ¶æ€çš„è¿›ç¨‹æ ‡ç¤ºä¸º\"D\"çŠ¶æ€ï¼‰çš„è¿›ç¨‹ï¼Œä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œåé¢æˆ‘ä»¬ç®€ç§°ä¸ºDçŠ¶æ€è¿›ç¨‹ã€‚è€Œæ­£æ˜¯è¿™äº›DçŠ¶æ€è¿›ç¨‹å¼•èµ·äº†Load Averageçš„å‡é«˜ã€‚</p><p>æ‰¾åˆ°äº†Load Averageå‡é«˜çš„é—®é¢˜å‡ºåœ¨DçŠ¶æ€è¿›ç¨‹äº†ï¼Œæˆ‘ä»¬æƒ³è¦çœŸæ­£è§£å†³é—®é¢˜ï¼Œè¿˜æœ‰å¿…è¦äº†è§£DçŠ¶æ€è¿›ç¨‹äº§ç”Ÿçš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>åœ¨Linuxå†…æ ¸ä¸­æœ‰æ•°ç™¾å¤„è°ƒç”¨ç‚¹ï¼Œå®ƒä»¬ä¼šæŠŠè¿›ç¨‹è®¾ç½®ä¸ºDçŠ¶æ€ï¼Œä¸»è¦é›†ä¸­åœ¨disk I/O çš„è®¿é—®å’Œä¿¡å·é‡ï¼ˆSemaphoreï¼‰é”çš„è®¿é—®ä¸Šï¼Œå› æ­¤DçŠ¶æ€çš„è¿›ç¨‹åœ¨Linuxé‡Œæ˜¯å¾ˆå¸¸è§çš„ã€‚</p><p><strong>æ— è®ºæ˜¯å¯¹disk I/Oçš„è®¿é—®è¿˜æ˜¯å¯¹ä¿¡å·é‡çš„è®¿é—®ï¼Œéƒ½æ˜¯å¯¹Linuxç³»ç»Ÿé‡Œçš„èµ„æºçš„ä¸€ç§ç«äº‰ã€‚</strong>å½“è¿›ç¨‹å¤„äºDçŠ¶æ€æ—¶ï¼Œå°±è¯´æ˜è¿›ç¨‹è¿˜æ²¡è·å¾—èµ„æºï¼Œè¿™ä¼šåœ¨åº”ç”¨ç¨‹åºçš„æœ€ç»ˆæ€§èƒ½ä¸Šä½“ç°å‡ºæ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ç”¨æˆ·ä¼šå‘è§‰åº”ç”¨çš„æ€§èƒ½ä¸‹é™äº†ã€‚</p><p>é‚£ä¹ˆDçŠ¶æ€è¿›ç¨‹å¯¼è‡´äº†æ€§èƒ½ä¸‹é™ï¼Œæˆ‘ä»¬è‚¯å®šæ˜¯æƒ³æ–¹è®¾æ³•å»åšè°ƒè¯•çš„ã€‚ä½†ç›®å‰DçŠ¶æ€è¿›ç¨‹å¼•èµ·çš„å®¹å™¨ä¸­è¿›ç¨‹æ€§èƒ½ä¸‹é™é—®é¢˜ï¼ŒCgroupsè¿˜ä¸èƒ½è§£å†³ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ç”¨Cgroupsåšäº†é…ç½®ï¼Œå³ä½¿ä¿è¯äº†å®¹å™¨çš„CPUèµ„æºï¼Œ å®¹å™¨ä¸­çš„è¿›ç¨‹è¿˜æ˜¯è¿è¡Œå¾ˆæ…¢çš„æ ¹æœ¬åŸå› ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬è¿›ä¸€æ­¥åšåˆ†æï¼Œä¸ºä»€ä¹ˆCPU Cgroupsä¸èƒ½è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿå°±æ˜¯å› ä¸ºCgroupsæ›´å¤šçš„æ˜¯ä»¥è¿›ç¨‹ä¸ºå•ä½è¿›è¡Œéš”ç¦»ï¼Œè€ŒDçŠ¶æ€è¿›ç¨‹æ˜¯å†…æ ¸ä¸­ç³»ç»Ÿå…¨å±€èµ„æºå¼•å…¥çš„ï¼Œæ‰€ä»¥Cgroupså½±å“ä¸äº†å®ƒã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åšçš„æ˜¯ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ç›‘æ§å®¹å™¨çš„å®¿ä¸»æœºèŠ‚ç‚¹é‡ŒDçŠ¶æ€çš„è¿›ç¨‹æ•°é‡ï¼Œç„¶åå¯¹DçŠ¶æ€è¿›ç¨‹æ•°ç›®å¼‚å¸¸çš„èŠ‚ç‚¹è¿›è¡Œåˆ†æï¼Œæ¯”å¦‚ç£ç›˜ç¡¬ä»¶å‡ºç°é—®é¢˜å¼•èµ·DçŠ¶æ€è¿›ç¨‹æ•°ç›®å¢åŠ ï¼Œè¿™æ—¶å°±éœ€è¦æ›´æ¢ç¡¬ç›˜ã€‚</p><h2>é‡ç‚¹æ€»ç»“</h2><p>è¿™ä¸€è®²æˆ‘ä»¬ä»CPU  Usageå’ŒLoad Averageå·®å¼‚è¿™ä¸ªç°è±¡è®²èµ·ï¼Œæœ€ä¸»è¦çš„ç›®çš„æ˜¯è®²æ¸…æ¥šLinuxä¸‹çš„Load Averageè¿™ä¸ªæ¦‚å¿µã€‚</p><p>åœ¨å…¶ä»–Unixæ“ä½œç³»ç»Ÿé‡ŒLoad Averageåªè€ƒè™‘CPUéƒ¨åˆ†ï¼ŒLoad Averageè®¡ç®—çš„æ˜¯è¿›ç¨‹è°ƒåº¦å™¨ä¸­å¯è¿è¡Œé˜Ÿåˆ—ï¼ˆRunning Queueï¼‰é‡Œçš„ä¸€æ®µæ—¶é—´ï¼ˆ1åˆ†é’Ÿï¼Œ5åˆ†é’Ÿï¼Œ15åˆ†é’Ÿï¼‰çš„å¹³å‡è¿›ç¨‹æ•°ç›®ï¼Œè€ŒLinuxåœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼ŒåˆåŠ ä¸Šäº†è¿›ç¨‹è°ƒåº¦å™¨ä¸­ä¼‘çœ é˜Ÿåˆ—ï¼ˆSleeping Queueï¼‰é‡Œçš„ä¸€æ®µæ—¶é—´çš„TASK_UNINTERRUPTIBLEçŠ¶æ€çš„å¹³å‡è¿›ç¨‹æ•°ç›®ã€‚</p><p>è¿™é‡Œä½ éœ€è¦é‡ç‚¹æŒæ¡Load Averageçš„è®¡ç®—å…¬å¼ï¼Œå¦‚ä¸‹å›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e6/4e/e672a6a35248420d623e55d7f7ddf34e.jpeg?wh=3200*1800\" alt=\"\"></p><p>å› ä¸ºTASK_UNINTERRUPTIBLEçŠ¶æ€çš„è¿›ç¨‹åŒæ ·ä¹Ÿä¼šç«äº‰ç³»ç»Ÿèµ„æºï¼Œæ‰€ä»¥å®ƒä¼šå½±å“åˆ°åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚æˆ‘ä»¬å¯ä»¥åœ¨å®¹å™¨å®¿ä¸»æœºçš„èŠ‚ç‚¹å¯¹DçŠ¶æ€è¿›ç¨‹åšç›‘æ§ï¼Œå®šå‘åˆ†æè§£å†³ã€‚</p><p>æœ€åï¼Œæˆ‘è¿˜æƒ³å¼ºè°ƒä¸€ä¸‹ï¼Œè¿™ä¸€è®²ä¸­æåˆ°çš„å¯¹DçŠ¶æ€è¿›ç¨‹è¿›è¡Œç›‘æ§ä¹Ÿå¾ˆé‡è¦ï¼Œå› ä¸ºè¿™æ˜¯é€šç”¨ç³»ç»Ÿæ€§èƒ½çš„ç›‘æ§æ–¹æ³•ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>ç»“åˆä»Šå¤©çš„å­¦ä¹ ï¼Œä½ å¯ä»¥è‡ªå·±åŠ¨æ‰‹æ„Ÿå—ä¸€ä¸‹Load Averageæ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Œè¯·ä½ åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œåœ¨å®¹å™¨ä¸­è¿è¡Œä¸€ä¸ªæ¶ˆè€—100%CPUçš„è¿›ç¨‹ï¼Œè¿è¡Œ10åˆ†é’Ÿåï¼Œç„¶åæŸ¥çœ‹Load Averageçš„å€¼ã€‚</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºæ™’å‡ºä½ çš„ç»å†å’Œç–‘é—®ã€‚å¦‚æœæœ‰æ”¶è·ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹ï¼Œä¸€èµ·å­¦ä¹ å’Œè®¨è®ºã€‚</p>","comments":[{"had_liked":false,"id":273146,"user_name":"æœ±æ–°å¨","can_delete":false,"product_type":"c1","uid":2326208,"ip_address":"","ucode":"50E7A6D0873853","user_header":"https://static001.geekbang.org/account/avatar/00/23/7e/c0/1c3fd7dd.jpg","comment_is_top":false,"comment_ctime":1610455741,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"70329932477","product_id":100063801,"comment_content":"åšä¸ªä¸å¤ªæ°å½“çš„æ¯”å–»ï¼š<br><br>cpuï¼šæ¯”åšä¸€æ¡é«˜é€Ÿå…¬è·¯<br><br>è¿›ç¨‹å ç”¨ï¼šæ¯”åšä¸€è¾†è¾†æ±½è½¦<br><br>é«˜é€Ÿå…¬è·¯ä¸Šçš„æ‹¥å µæƒ…å†µï¼ˆload averageï¼‰= æ­£åœ¨è·‘çš„æ±½è½¦ + æ”¶è´¹ç«™æ’é˜Ÿç­‰å¾…è¿›å…¥çš„æ±½è½¦ + æœåŠ¡ç«™åŠ æ²¹ã€åƒé¥­çš„æ±½è½¦ï¼ˆDè¿›ç¨‹ï¼‰ï¼›<br><br>æŠŠDè¿›ç¨‹è€ƒè™‘è¿›å»æ˜¯å› ä¸ºï¼ŒæœåŠ¡ç«™é‡Œçš„æ±½è½¦éšæ—¶å¯èƒ½è¿›å…¥é«˜é€Ÿå…¬è·¯ï¼Œé€ æˆæ‹¥å µç¨‹åº¦å¢åŠ ","like_count":17,"discussions":[{"author":{"id":1926471,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erqstKsb9keGmH2hwtiapCVWD6bpaGcsibZgkGbUoYyIFGqJRKbbibS82BhicjDpEc6Mwujbmic5PRibpWw/132","nickname":"å¼ å¾·å¤","note":"","ucode":"DBCC762CF77EBD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394060,"discussion_content":"è¿™ä¸ªè§£é‡Šæˆ‘ç»™æ»¡åˆ†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631705191,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":264916,"user_name":"garnett","can_delete":false,"product_type":"c1","uid":1397406,"ip_address":"","ucode":"334564479A33B1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIYdf5Z0Iicn5mGECKewrGxaY3sPlTEk3PcjImA7as2H7n7L6Krly8dzjwfOQIUYaZwdBBtfCuc0Sg/132","comment_is_top":false,"comment_ctime":1606706793,"is_pvip":false,"replies":[{"id":"96228","content":"TASK_UNINTERRUPTIBLE çŠ¶æ€çš„è¿›ç¨‹ä¸ä¸€å®šæ˜¯åšI&#47;O, æ¯”å¦‚ç­‰å¾…ä¿¡å·é‡çš„è¿›ç¨‹ä¹Ÿä¼šè¿›å…¥åˆ°è¿™ä¸ªçŠ¶æ€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1606746895,"ip_address":"","comment_id":264916,"utype":1}],"discussion_count":2,"race_medal":0,"score":"61736248937","product_id":100063801,"comment_content":"è¯·é—®è€å¸ˆï¼Œå¼•å…¥ä¸º TASK_UNINTERRUPTIBLE çŠ¶æ€çš„è¿›ç¨‹çš„æ¡ˆä¾‹ï¼Œtop è¾“å‡ºä¸­ä¸ºä»€ä¹ˆwaä½¿ç”¨ç‡è¿™ä¸€é¡¹æ²¡æœ‰å¢é•¿ï¼Ÿ","like_count":14,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510740,"discussion_content":"TASK_UNINTERRUPTIBLE çŠ¶æ€çš„è¿›ç¨‹ä¸ä¸€å®šæ˜¯åšI/O, æ¯”å¦‚ç­‰å¾…ä¿¡å·é‡çš„è¿›ç¨‹ä¹Ÿä¼šè¿›å…¥åˆ°è¿™ä¸ªçŠ¶æ€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606746895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2326880,"avatar":"https://static001.geekbang.org/account/avatar/00/23/81/60/71ed6ac7.jpg","nickname":"è°¢å“ˆå“ˆ","note":"","ucode":"5AADE70B5AFE27","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":330825,"discussion_content":"waæ˜¾ç¤ºçš„æ˜¯CPUè°ƒåº¦IOæ—¶ï¼ŒCPUå¤„åœ¨ç©ºé—²çŠ¶æ€çš„ä½¿ç”¨ç‡ï¼Œä½ æŠŠä»–ç†è§£æˆç¹å¿™çŠ¶å†µçš„ä½¿ç”¨ç‡äº†å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606717714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":264870,"user_name":"è«å","can_delete":false,"product_type":"c1","uid":1007254,"ip_address":"","ucode":"E28F2602BA25DD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5e/96/a03175bc.jpg","comment_is_top":false,"comment_ctime":1606697448,"is_pvip":false,"replies":[{"id":"96236","content":"@è«åï¼Œ<br>æ˜¯çš„ï¼Œstressæ˜¯å¾ˆå¥½çš„è´Ÿè½½æ¨¡æ‹Ÿå·¥å…·ï¼<br><br>kernel&#47;sched&#47;loadavg.c é‡Œæœ‰å®Œæ•´çš„load averageä»£ç ","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1606748865,"ip_address":"","comment_id":264870,"utype":1}],"discussion_count":3,"race_medal":0,"score":"35966435816","product_id":100063801,"comment_content":"æ¨è stress å‹æµ‹å·¥å…·ï¼šstress -c 1 -t 600<br><br>å¹³å‡è´Ÿè½½è®¡ç®—å…¬å¼ï¼ˆnr_active è¡¨ç¤ºå•ä½æ—¶é—´å†…å¹³å‡æ´»è·ƒè¿›ç¨‹ä¸ªæ•°ï¼Œæ¯ä¸ª CPU å¯¹åº”ä¸€ä¸ª è¿è¡Œé˜Ÿåˆ— rqï¼Œrq-&gt;nr_runningã€rq-&gt;nr_uninterruptible åˆ†åˆ«è¡¨ç¤ºè¯¥è¿è¡Œé˜Ÿåˆ—ä¸Šå¯è¿è¡Œè¿›ç¨‹ã€ä¸å¯ä¸­æ–­è¿›ç¨‹çš„ä¸ªæ•°ã€‚ç´¯ç§¯çš„ nr_active å†è¿›è¡ŒæŒ‡æ•°è¡°å‡å¹³å‡å¾—åˆ°æœ€ç»ˆçš„å¹³å‡è´Ÿè½½ï¼‰<br><br>&#47;* <br>* The global load average is an exponentially decaying average of nr_running +<br> * nr_uninterruptible.<br> *&#47;<br>nr_active = 0;<br>for_each_possible_cpu(cpu)<br>    nr_active += cpu_of(cpu)-&gt;nr_running + cpu_of(cpu)-&gt;nr_uninterruptible;","like_count":8,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510721,"discussion_content":"@è«åï¼Œ\næ˜¯çš„ï¼Œstressæ˜¯å¾ˆå¥½çš„è´Ÿè½½æ¨¡æ‹Ÿå·¥å…·ï¼\n\nkernel/sched/loadavg.c é‡Œæœ‰å®Œæ•´çš„load averageä»£ç ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606748865,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2129632,"avatar":"https://static001.geekbang.org/account/avatar/00/20/7e/e0/ff046b55.jpg","nickname":"æå…µ","note":"","ucode":"291243E3AB889F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385117,"discussion_content":"å¯¹äºè§£å†³é«˜è´Ÿè½½é—®é¢˜ï¼Œå¦‚ä½•ä½¿ç”¨ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626884613,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1007254,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/96/a03175bc.jpg","nickname":"è«å","note":"","ucode":"E28F2602BA25DD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":331327,"discussion_content":"å—¯ï¼Œæ˜¯çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606830013,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":265337,"user_name":"äº‰å…‰ Alan","can_delete":false,"product_type":"c1","uid":1336328,"ip_address":"","ucode":"338534F909AF03","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/08/0287f41f.jpg","comment_is_top":false,"comment_ctime":1606872586,"is_pvip":false,"replies":[{"id":"96504","content":"@äº‰å…‰ Alan<br>&gt; 1<br>å¯ä»¥ `cat &#47;proc&#47;&lt;pid&gt;&#47;stack`, çœ‹åˆ°è¿›ç¨‹åœåœ¨å†…æ ¸ä¸­çš„å“ªä¸ªå‡½æ•°ä¸Šï¼Œç»“åˆå†…æ ¸çš„ä»£ç ï¼Œå¯ä»¥â€œçŒœä¸€ä¸‹â€å¤§æ¦‚æ˜¯åœ¨å“ªä¸ªä¿¡å·é‡ä¸Šã€‚<br><br>&gt; 2<br>è¿›ç¨‹å¤ªå¤šä¼šæœ‰é—®é¢˜çš„ã€‚<br><br>&gt; 3<br>æˆ‘ä»¬ç”¨çš„ç¼ºçœ110ä¸ªpod, ä¸è¿‡å¯¹pod&#47;containerè¦åšä¸€ä¸‹max pidçš„é™åˆ¶ï¼Œ åŒæ—¶éœ€è¦ç›‘æ§cpu&#47;memory&#47;disk io&#47; network&#47;D process number&#47;max pid&#47;max fd ç­‰ç­‰","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1606916184,"ip_address":"","comment_id":265337,"utype":1}],"discussion_count":4,"race_medal":0,"score":"23081709066","product_id":100063801,"comment_content":"æ„Ÿè°¢åˆ†äº«<br><br>æˆ‘æƒ³é—®ä¸‹<br>1.å¦‚æœå‡ºç°å°±Dè¿›ç¨‹ï¼Œæˆ‘ä¸ºä»€ä¹ˆå¥½çš„æ•…éšœæ–¹æ³•æ’æŸ¥åœ¨ç­‰å¾…ä»€ä¹ˆå—ï¼Ÿ<br>2.ä¸€ç›´æœ‰ä¸ªç–‘é—®ï¼Œæ˜¯ä¸æ˜¯linuxçš„è¿›ç¨‹æ•°ä¸èƒ½å¤ªå¤šï¼Ÿå¤ªå¤šä¼šæœ‰å¾ˆå¤šçš„è°ƒåº¦æ—¶é—´é€ æˆå¾ˆå¡ï¼Ÿ<br>3.å®¹å™¨ç›®å‰æ¯ä¸ªèŠ‚ç‚¹å®˜æ–¹æ¨èæ˜¯110ä¸ªpodï¼Œopenshiftæ˜¯250ä¸ªï¼Œèƒ½é—®ä¸‹ä½ ä»¬è¿™è¾¹çš„æœ€ä½³å®è·µä¸å¼•èµ·æ€§èƒ½ä¸‹é™çš„å‰æä¸‹èŠ‚ç‚¹æœ€å¤§podæ˜¯å¤šå°‘ä¸ªå—ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510887,"discussion_content":"@äº‰å…‰ Alan\n&amp;gt; 1\nå¯ä»¥ `cat /proc/&amp;lt;pid&amp;gt;/stack`, çœ‹åˆ°è¿›ç¨‹åœåœ¨å†…æ ¸ä¸­çš„å“ªä¸ªå‡½æ•°ä¸Šï¼Œç»“åˆå†…æ ¸çš„ä»£ç ï¼Œå¯ä»¥â€œçŒœä¸€ä¸‹â€å¤§æ¦‚æ˜¯åœ¨å“ªä¸ªä¿¡å·é‡ä¸Šã€‚\n\n&amp;gt; 2\nè¿›ç¨‹å¤ªå¤šä¼šæœ‰é—®é¢˜çš„ã€‚\n\n&amp;gt; 3\næˆ‘ä»¬ç”¨çš„ç¼ºçœ110ä¸ªpod, ä¸è¿‡å¯¹pod/containerè¦åšä¸€ä¸‹max pidçš„é™åˆ¶ï¼Œ åŒæ—¶éœ€è¦ç›‘æ§cpu/memory/disk io/ network/D process number/max pid/max fd ç­‰ç­‰","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1606916184,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1217712,"avatar":"https://static001.geekbang.org/account/avatar/00/12/94/b0/b073fe8b.jpg","nickname":"aMaMiMoU","note":"","ucode":"AF1E6CA541E482","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335958,"discussion_content":"é—®é¢˜äºŒ æ•°é‡è¿‡å¤šæ—¶ï¼Œ1.ä¼šå­˜åœ¨å¤§é‡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œcpu cache ã€tlbé‡Œå†…å®¹ä¼šå—åˆ°å½±å“ï¼Œä»è€Œå½±å“è¿›ç¨‹çš„æ€§èƒ½ã€‚2.ä¼šæœ‰å¤§é‡cpuæ—¶é—´ç‰‡æ¶ˆè€—åœ¨cpu re-scheduleçš„ä¸­æ–­è°ƒåº¦ä¸Šï¼Œå¯ä»¥é€šè¿‡proc interrupt softinterruptè§‚å¯Ÿåˆ°ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1608430129,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1041547,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/e4/8b/8a0a6c86.jpg","nickname":"haha","note":"","ucode":"F4F3EAB4A15989","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334773,"discussion_content":"110ä¸»è¦è€ƒè™‘çš„æ˜¯ç½‘ç»œipçš„è§„åˆ’","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1607971767,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1111985,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg","nickname":"Frank","note":"","ucode":"9DADD72C193296","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586497,"discussion_content":"DçŠ¶æ€è¿›ç¨‹å¦‚ä½•ç›‘æ§å’Œåˆ†æå‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662262545,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å››å·"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":265114,"user_name":"æ¸¸ç¦»çš„é±¼","can_delete":false,"product_type":"c1","uid":2328318,"ip_address":"","ucode":"292D852B51C7D7","user_header":"https://static001.geekbang.org/account/avatar/00/23/86/fe/0fb57311.jpg","comment_is_top":false,"comment_ctime":1606785376,"is_pvip":false,"replies":[{"id":"96381","content":"&gt; ç¬¬ä¸€ä¸ª<br>è¿™æ—¶å€™cpuä»ç„¶æ˜¯ç©ºé—²çš„ï¼Œcpuä¹Ÿå¯ä»¥ç”¨æ¥è°ƒåº¦åˆ«çš„è¿›ç¨‹ï¼Œåªæ˜¯éœ€è¦ç«äº‰ä¿¡å·é‡çš„å‡ ä¸ªè¿›ç¨‹é—´ç›¸äº’åœ¨ç­‰å¾…ä¸­ã€‚<br><br>&gt; ç¬¬äºŒä¸ª<br>è¿™ä¸ªå°±æ˜¯æˆ‘åœ¨æ–‡ç« ä¸­è®²çš„ï¼Œå¼•èµ·load averageå¢é«˜å°±æ˜¯ä¸¤ä¸ªåŸå› ä¸€ä¸ªrunning é˜Ÿåˆ—é‡Œçš„è¿›ç¨‹ï¼Œä¸€ä¸ªæ˜¯Dè¿›ç¨‹ã€‚<br><br>&gt; ç¬¬ä¸‰ä¸ª<br>å¦‚æœåœ¨è¾ƒé•¿çš„ä¸€æ®µæ—¶é—´é‡Œï¼Œéƒ½æ˜¯å¤„äºè¿™ç§çŠ¶æ€ï¼Œé‚£ä¹ˆload averageæ˜¯5ã€‚åªæ˜¯å¤„äºDçŠ¶æ€çš„è¿›ç¨‹ï¼Œå…¶å®æ˜¯ä¸ç”¨cpuçš„ï¼Œå› æ­¤å…¶ä»–çš„å››ä¸ªè¿›ç¨‹åº”è¯¥éƒ½åœ¨è¿è¡Œã€‚å½“å…¶ä»–çš„å››ä¸ªè¿›ç¨‹éƒ½é€€å‡ºäº†ï¼Œåªå‰©Dè¿›ç¨‹ï¼Œé‚£ä¹ˆç­‰å¾…ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´åï¼Œload averageå˜æˆ1.<br><br>&gt; ç¬¬å››ä¸ª<br>å› ä¸ºload averageæ˜¯è¿‡å»1åˆ†é’Ÿ&#47;5åˆ†é’Ÿ&#47;15åˆ†é’Ÿçš„ä¸€ä¸ªå¹³å‡å€¼","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1606834484,"ip_address":"","comment_id":265114,"utype":1}],"discussion_count":2,"race_medal":0,"score":"23081621856","product_id":100063801,"comment_content":"é¦–å…ˆå¾ˆæ„Ÿè°¢è€å¸ˆï¼Œç„¶åæˆ‘è¿˜æ˜¯æœ‰ä¸€äº›äº›ä¸å¤ªæ˜ç™½ï¼Œç¬¬ä¸€ä¸ª: å¤„äºtask_interruptibleçš„è¿›ç¨‹ï¼Œè™½ç„¶å®ƒåœ¨ç­‰ä¿¡å·é‡å’Œç­‰å¾…ioä¸Šï¼Œä½†æ˜¯æˆ‘ç†è§£è¿™ä¸ªæ—¶å€™å…¶å®cpuæ˜¯ç©ºé—²çš„ï¼Œä¸ºä»€ä¹ˆä¸æŠŠcpuèµ„æºè®©å‡ºæ¥ï¼Œç­‰ioå®Œæˆæˆ–è€…æœ‰ä¿¡å·é‡æ—¶å†æŠŠå®ƒæ”¾å…¥å¯è¿è¡Œçš„é˜Ÿåˆ—ä¸­å»ç­‰å¾…è°ƒç”¨å‘¢ï¼Œç±»ä¼¼äºå›è°ƒå‡½æ•°é‚£æ ·çš„æ€æƒ³ã€‚ç¬¬äºŒä¸ª: å¦‚æœæ˜¯æˆ‘çš„æœºå™¨é•¿æœŸå¹³å‡è´Ÿè½½è¿‡é«˜ï¼Œæ˜¯ä¸æ˜¯ä¸€å®šæ˜¯DçŠ¶æ€çš„è¿›ç¨‹æˆ–çº¿ç¨‹å¼•èµ·çš„ã€‚ ç¬¬ä¸‰ä¸ª: æˆ‘æœ‰å››ä¸ªcpuçš„æœºå™¨ï¼Œç°æœ‰äº”ä¸ªè¿›ç¨‹ï¼Œæœ‰å››ä¸ªåœ¨cpuä¸­è¿è¡Œï¼Œå…¶ä¸­ä¸‰ä¸ªæ˜¯å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œå¦ä¸€ä¸ªæ˜¯å¤„äºtask_interruptableçŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯DçŠ¶æ€ï¼Œè¿˜æœ‰ä¸€ä¸ªåœ¨æ’é˜Ÿï¼Œé‚£è¿™ä¸ªæ—¶å€™çš„è´Ÿè½½æ˜¯ä¸æ˜¯å°±æ˜¯5ï¼Ÿå¦‚æœé™¤äº†åˆšåˆšçš„DçŠ¶æ€çš„è¿›ç¨‹å…¶ä»–çš„è¿›ç¨‹éƒ½è¿è¡Œå®Œäº†ï¼Œè´Ÿè½½æ˜¯ä¸æ˜¯åˆå˜æˆ1äº†ã€‚ ç¬¬å››ä¸ª: æ ¹æ®è€å¸ˆçš„å®šä¹‰å’Œå…¬å¼ï¼Œå¹³å‡è´Ÿè½½æ˜¯...çš„å¹³å‡è¿›ç¨‹æ•°ï¼Œæˆ‘æ„Ÿè§‰å¹³å‡è¿›ç¨‹æ•°æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬çœ‹åˆ°çš„å¹³å‡è´Ÿè½½éƒ½æ˜¯å¸¦å°æ•°çš„ã€‚å¸Œæœ›è€å¸ˆå¸®å¿™è§£ç­”ä¸€ä¸‹ï¼Œå¸®æˆ‘è§£é™¤ç–‘æƒ‘ã€‚ä¸‡åˆ†æ„Ÿè°¢","like_count":5,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510807,"discussion_content":"&amp;gt; ç¬¬ä¸€ä¸ª\nè¿™æ—¶å€™cpuä»ç„¶æ˜¯ç©ºé—²çš„ï¼Œcpuä¹Ÿå¯ä»¥ç”¨æ¥è°ƒåº¦åˆ«çš„è¿›ç¨‹ï¼Œåªæ˜¯éœ€è¦ç«äº‰ä¿¡å·é‡çš„å‡ ä¸ªè¿›ç¨‹é—´ç›¸äº’åœ¨ç­‰å¾…ä¸­ã€‚\n\n&amp;gt; ç¬¬äºŒä¸ª\nè¿™ä¸ªå°±æ˜¯æˆ‘åœ¨æ–‡ç« ä¸­è®²çš„ï¼Œå¼•èµ·load averageå¢é«˜å°±æ˜¯ä¸¤ä¸ªåŸå› ä¸€ä¸ªrunning é˜Ÿåˆ—é‡Œçš„è¿›ç¨‹ï¼Œä¸€ä¸ªæ˜¯Dè¿›ç¨‹ã€‚\n\n&amp;gt; ç¬¬ä¸‰ä¸ª\nå¦‚æœåœ¨è¾ƒé•¿çš„ä¸€æ®µæ—¶é—´é‡Œï¼Œéƒ½æ˜¯å¤„äºè¿™ç§çŠ¶æ€ï¼Œé‚£ä¹ˆload averageæ˜¯5ã€‚åªæ˜¯å¤„äºDçŠ¶æ€çš„è¿›ç¨‹ï¼Œå…¶å®æ˜¯ä¸ç”¨cpuçš„ï¼Œå› æ­¤å…¶ä»–çš„å››ä¸ªè¿›ç¨‹åº”è¯¥éƒ½åœ¨è¿è¡Œã€‚å½“å…¶ä»–çš„å››ä¸ªè¿›ç¨‹éƒ½é€€å‡ºäº†ï¼Œåªå‰©Dè¿›ç¨‹ï¼Œé‚£ä¹ˆç­‰å¾…ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´åï¼Œload averageå˜æˆ1.\n\n&amp;gt; ç¬¬å››ä¸ª\nå› ä¸ºload averageæ˜¯è¿‡å»1åˆ†é’Ÿ/5åˆ†é’Ÿ/15åˆ†é’Ÿçš„ä¸€ä¸ªå¹³å‡å€¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606834484,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2328318,"avatar":"https://static001.geekbang.org/account/avatar/00/23/86/fe/0fb57311.jpg","nickname":"æ¸¸ç¦»çš„é±¼","note":"","ucode":"292D852B51C7D7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":331369,"discussion_content":"è°¢è°¢è€å¸ˆçš„å›ç­”ï¼Œå‰é¢ä¸‰ä¸ªé—®é¢˜ï¼Œæˆ‘æ˜ç™½äº†ï¼Œæœ€åä¸€ä¸ªé—®é¢˜ï¼Œè¿˜æ˜¯æƒ³åˆ¨æ ¹é—®åº•ä¸€ä¸‹ï¼Œè¿‡å»ä¸€åˆ†é’Ÿçš„å¹³å‡çš„è®¡ç®—å…¬å¼æ˜¯ä»€ä¹ˆï¼Ÿå‡è®¾å•ä½æ—¶é—´ä¸º1ç§’ï¼Œé‚£æ˜¯ä¸æ˜¯ï¼Œä¸€åˆ†é’Ÿçš„å¹³å‡è´Ÿè½½å°±ç­‰äº60ä¸ªä¸€ç§’å†…çš„å¹³å‡è´Ÿè½½å€¼ç›¸åŠ å†é™¤ä»¥60æ¥å¾—åˆ°ã€‚æˆ‘æœ‰äº›æ„šé’ï¼Œæœ›è€å¸ˆè§è°…ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606836397,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":273130,"user_name":"Harold","can_delete":false,"product_type":"c1","uid":1168849,"ip_address":"","ucode":"313F3F5869E76B","user_header":"https://static001.geekbang.org/account/avatar/00/11/d5/d1/42de06de.jpg","comment_is_top":false,"comment_ctime":1610450311,"is_pvip":false,"replies":[{"id":"99552","content":"&gt; æ¢å¥è¯è¯´ï¼Œæ˜¯ä¸æ˜¯åªè¦ cpu idle ä¸æ˜¯0ï¼Œå–çš„éƒ½æ˜¯ cpu usage çš„å€¼.<br>æ²¡æœ‰Dè¿›ç¨‹çš„æƒ…å†µä¸‹ï¼Œæ˜¯çš„ã€‚<br>","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1610936779,"ip_address":"","comment_id":273130,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10200384903","product_id":100063801,"comment_content":"å¯¹äº load average çš„å€¼è¿˜æ˜¯æœ‰äº›æ¨¡ç³Šï¼Œä¸è€ƒè™‘ D è¿›ç¨‹çš„æƒ…å†µä¸‹ï¼Œ1å°8æ ¸çš„æœºå™¨æœ‰ 16ä¸ª running çš„è¿›ç¨‹ï¼Œcpuå¹¶æ²¡æœ‰å æ»¡100%çš„æƒ…å†µä¸‹ï¼Œload averageå–çš„å€¼æ˜¯ 16*(1 - cpu idle) è¿˜æ˜¯ 16ï¼Ÿæ¢å¥è¯è¯´ï¼Œæ˜¯ä¸æ˜¯åªè¦ cpu idle ä¸æ˜¯0ï¼Œå–çš„éƒ½æ˜¯ cpu usage çš„å€¼ã€‚æœ›è§£ç­”ã€‚","like_count":2,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513504,"discussion_content":"&amp;gt; æ¢å¥è¯è¯´ï¼Œæ˜¯ä¸æ˜¯åªè¦ cpu idle ä¸æ˜¯0ï¼Œå–çš„éƒ½æ˜¯ cpu usage çš„å€¼.\næ²¡æœ‰Dè¿›ç¨‹çš„æƒ…å†µä¸‹ï¼Œæ˜¯çš„ã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610936779,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":266932,"user_name":"po","can_delete":false,"product_type":"c1","uid":1023905,"ip_address":"","ucode":"7DB36C278F34D7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9f/a1/d75219ee.jpg","comment_is_top":false,"comment_ctime":1607528233,"is_pvip":true,"replies":[{"id":"96953","content":"@po,<br>&gt;1, æ˜¯çš„<br>&gt;2, å¯¹äºå¤„ç†å™¨é‡Œçš„hyper-threading, ä»Linuxè§’åº¦çœ‹åˆ°çš„ä¹Ÿæ˜¯1ä¸ªcpuã€‚2æ ¸4çº¿ç¨‹(hyper-threading), çœ‹åˆ°çš„æ˜¯4ä¸ªcpu.<br>ä½ å¯ä»¥ sys&#47;, proc&#47;ä¸‹çœ‹åˆ°cpuä¿¡æ¯ã€‚<br>&#47;sys&#47;devices&#47;system&#47;cpu&#47;online<br>&#47;proc&#47;cpuinfo<br>","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1607614499,"ip_address":"","comment_id":266932,"utype":1}],"discussion_count":7,"race_medal":0,"score":"10197462825","product_id":100063801,"comment_content":"æœ‰äº‹ï¼Œå¥½å‡ å¤©æ²¡æ¥ç•™è¨€äº†ï¼Œæˆ‘æœ‰ä¸ªç¡®è®¤ç‚¹ï¼š<br>1. å¦‚æœä¸€å°2ä¸ªcpuçš„æœºå™¨ï¼Œè·‘äº†8ä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹ä½¿ç”¨ä¸€ä¸ªcpuçš„10%ï¼Œé‚£ä¹ˆload averageåº”è¯¥æ˜¯0.8å§ï¼Ÿ<br>2. å¹³å¸¸è¯´çš„ç‰©ç†æœºCPUï¼Œæ¯”å¦‚2æ ¸4çº¿ç¨‹ï¼Œè¿™ä¸ªåœ¨Linuxé‡Œé¢çœ‹æ˜¯å‡ ä¸ªcpuå‘¢ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511450,"discussion_content":"@po,\n&amp;gt;1, æ˜¯çš„\n&amp;gt;2, å¯¹äºå¤„ç†å™¨é‡Œçš„hyper-threading, ä»Linuxè§’åº¦çœ‹åˆ°çš„ä¹Ÿæ˜¯1ä¸ªcpuã€‚2æ ¸4çº¿ç¨‹(hyper-threading), çœ‹åˆ°çš„æ˜¯4ä¸ªcpu.\nä½ å¯ä»¥ sys/, proc/ä¸‹çœ‹åˆ°cpuä¿¡æ¯ã€‚\n/sys/devices/system/cpu/online\n/proc/cpuinfo\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607614499,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1412891,"avatar":"","nickname":"æ€ç»´å†³å®šæœªæ¥","note":"","ucode":"88CC245B3C6E2D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333562,"discussion_content":"ç¬¬ä¸€ä¸ªæ˜¯çš„ï¼Œå› ä¸ºä½ çº ç»“çš„ç­”æ¡ˆåº”è¯¥æ˜¯0.8è¿˜æ˜¯8ï¼Œå¦‚æœ8ä¸ªè¿›ç¨‹çš„cpuä½¿ç”¨ç‡éƒ½æ˜¯100ï¼…ï¼Œé‚£ä¹ˆå¹³å‡è´Ÿè½½æ˜¯8ï¼Œé‚£ä¹ˆ10ï¼…åº”è¯¥å°±æ˜¯0.8ã€‚\nç¬¬äºŒä¸ªæ˜¯4ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1607564115,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1218501,"avatar":"https://static001.geekbang.org/account/avatar/00/12/97/c5/84491beb.jpg","nickname":"ç½—å³°","note":"","ucode":"5F3D6AF8F28322","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390007,"discussion_content":"æ–‡ç« é‡Œé¢è¯´çš„è¿›ç¨‹æ•°ï¼Œåˆ°è¿™é‡Œå˜æˆcpu useage","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629595826,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1336951,"avatar":"https://static001.geekbang.org/account/avatar/00/14/66/77/194ba21d.jpg","nickname":"lzh","note":"","ucode":"C3D83DF4230109","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1218501,"avatar":"https://static001.geekbang.org/account/avatar/00/12/97/c5/84491beb.jpg","nickname":"ç½—å³°","note":"","ucode":"5F3D6AF8F28322","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":570024,"discussion_content":"è¿™é‡Œè´Ÿè½½æœªæ»¡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651639756,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":390007,"ip_address":""},"score":570024,"extra":""}]},{"author":{"id":1286588,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a1/bc/ef0f26fa.jpg","nickname":"é¦–å¯Œæ‰‹è®°","note":"","ucode":"879DED4078303C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386293,"discussion_content":"æˆ‘æ˜ç™½äº†ï¼Œæ­£å¸¸æƒ…å†µä¸‹200 è·‘æ»¡åº”è¯¥æ˜¯ 2ï¼Œæ‰€ä»¥è·‘äº†å•æ ¸çš„ 80%ï¼Œé‚£å°±æ˜¯ 0.8","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627519546,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1286588,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a1/bc/ef0f26fa.jpg","nickname":"é¦–å¯Œæ‰‹è®°","note":"","ucode":"879DED4078303C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386289,"discussion_content":"ç™¾åˆ†ä¹‹ 10 ä¸ºä»€ä¹ˆæ˜¯ 0.8 å‘¢ æœ‰ç‚¹ä¸æ˜¯å¾ˆæ˜ç™½å‘€ï¼Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627517481,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1132009,"avatar":"https://static001.geekbang.org/account/avatar/00/11/45/e9/133553d1.jpg","nickname":"æ™´å¤©ğŸƒ","note":"","ucode":"5AE4A042B94010","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1286588,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a1/bc/ef0f26fa.jpg","nickname":"é¦–å¯Œæ‰‹è®°","note":"","ucode":"879DED4078303C","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":541635,"discussion_content":"ç™¾åˆ†ä¹‹åä¹˜8ï¼Œç™¾åˆ†ä¹‹å…«å","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640492901,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":386289,"ip_address":""},"score":541635,"extra":""}]}]},{"had_liked":false,"id":264907,"user_name":"Geek4329","can_delete":false,"product_type":"c1","uid":2028951,"ip_address":"","ucode":"D6FB8D1B2D5DAC","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f5/97/9a7ee7b3.jpg","comment_is_top":false,"comment_ctime":1606704973,"is_pvip":false,"replies":[{"id":"96234","content":"@Geek4329<br>å†…æ ¸æ¨¡å—é‡Œè°ƒç”¨çš„æ˜¯ msleep(), è¿™ä¸ªå‡½æ•°ä¼šæŠŠè¿›ç¨‹çš„çŠ¶æ€è®¾ç½®ä¸ºTASK_UNINTERRUPTIBLEã€‚ å°±ç”¨å®ƒæ¥æ¨¡æ‹Ÿä¸€ä¸‹ã€‚<br><br>void msleep(unsigned int msecs)<br>{<br>        unsigned long timeout = msecs_to_jiffies(msecs) + 1;<br><br>        while (timeout)<br>                timeout = schedule_timeout_uninterruptible(timeout);<br>}<br><br>signed long __sched schedule_timeout_uninterruptible(signed long timeout)<br>{<br>        __set_current_state(TASK_UNINTERRUPTIBLE);<br>        return schedule_timeout(timeout);<br>}<br><br><br>ç”¨æˆ·ç¨‹åºè¯»å–&#47;procçš„æ¥å£çš„ä¾‹å­ç¨‹åºï¼š<br>https:&#47;&#47;github.com&#47;chengyli&#47;training&#47;blob&#47;main&#47;cpu&#47;load_average&#47;uninterruptable&#47;app-test.c","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1606747559,"ip_address":"","comment_id":264907,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10196639565","product_id":100063801,"comment_content":"æ„Ÿè°¢è€å¸ˆï¼Œå—ç›ŠåŒªæµ…ï¼<br><br>æœ‰ä¸€ç‚¹ä¸æ˜¯å¾ˆæ‡‚ï¼Œæƒ³è¯·æ•™ä¸‹ï¼š<br>â€œè¿™é‡Œæˆ‘ä»¬åšä¸€ä¸ªkernel moduleï¼Œé€šè¿‡ä¸€ä¸ª &#47;proc æ–‡ä»¶ç³»ç»Ÿç»™ç”¨æˆ·ç¨‹åºæä¾›ä¸€ä¸ªè¯»å–çš„æ¥å£ï¼Œåªè¦ç”¨æˆ·è¿›ç¨‹è¯»å–äº†è¿™ä¸ªæ¥å£å°±ä¼šè¿›å…¥ UNINTERRUPTIBLEã€‚â€<br><br>è€å¸ˆä¸Šé¢ç»™çš„kernel moduleä¸­ï¼Œæˆ‘çš„ç†è§£æ˜¯åªè°ƒç”¨sleepï¼Œç„¶åç”¨æˆ·è°ƒç”¨è¿™ä¸ªæ¥å£å°±è¿›å…¥D stateï¼Œç®—æ˜¯æ¨¡æ‹ŸDISK IOçŠ¶æ€æ—¶è·å–ä¸åˆ°èµ„æºæ—¶çš„çŠ¶æ€å—ï¼Ÿè€å¸ˆèƒ½ä¸èƒ½ç»™ä¸ªå‚è€ƒï¼Œç”¨æˆ·è¿›ç¨‹è¯»æ˜¯å¦‚ä½•å–äº†è¿™ä¸ªæ¥å£å‘¢ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510737,"discussion_content":"@Geek4329\nå†…æ ¸æ¨¡å—é‡Œè°ƒç”¨çš„æ˜¯ msleep(), è¿™ä¸ªå‡½æ•°ä¼šæŠŠè¿›ç¨‹çš„çŠ¶æ€è®¾ç½®ä¸ºTASK_UNINTERRUPTIBLEã€‚ å°±ç”¨å®ƒæ¥æ¨¡æ‹Ÿä¸€ä¸‹ã€‚\n\nvoid msleep(unsigned int msecs)\n{\n        unsigned long timeout = msecs_to_jiffies(msecs) + 1;\n\n        while (timeout)\n                timeout = schedule_timeout_uninterruptible(timeout);\n}\n\nsigned long __sched schedule_timeout_uninterruptible(signed long timeout)\n{\n        __set_current_state(TASK_UNINTERRUPTIBLE);\n        return schedule_timeout(timeout);\n}\n\n\nç”¨æˆ·ç¨‹åºè¯»å–/procçš„æ¥å£çš„ä¾‹å­ç¨‹åºï¼š\nhttps://github.com/chengyli/training/blob/main/cpu/load_average/uninterruptable/app-test.c","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606747559,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2028953,"avatar":"","nickname":"Geek3340","note":"","ucode":"C64D302CD53513","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":331107,"discussion_content":"é†é†çŒé¡¶ï¼Œå¤šè°¢è€å¸ˆè®²è§£ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606788927,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":285601,"user_name":"ç¬ƒå®š","can_delete":false,"product_type":"c1","uid":1316173,"ip_address":"","ucode":"92E06FA13CC046","user_header":"https://static001.geekbang.org/account/avatar/00/14/15/4d/bbfda6b7.jpg","comment_is_top":false,"comment_ctime":1616916820,"is_pvip":false,"replies":[{"id":"104452","content":"RçŠ¶æ€çš„è¿›ç¨‹ä¸æ˜¯å•æŒ‡æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œè¿˜æŒ‡åœ¨runqueueä¸Šå¯ä»¥éšæ—¶å¾—åˆ°è°ƒåº¦æ—¶é—´ç‰‡è€Œå¯ä»¥è¿è¡Œçš„è¿›ç¨‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1618062646,"ip_address":"","comment_id":285601,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5911884116","product_id":100063801,"comment_content":"æ–‡ä¸­çš„ç¬¬äºŒä¸ªå®éªŒï¼Œå››ä¸ªcpuçš„ç³»ç»Ÿï¼Œè¿è¡Œå…­ä¸ªè¿›ç¨‹ã€‚ç†è®ºä¸Šå…­ä¸ªè¿›ç¨‹åŒä¸€æ—¶åˆ»ä¸å¯èƒ½éƒ½å¤„äºRçŠ¶æ€å§ï¼Ÿä¸€ä¸ªcpuåŒä¸€æ—¶åˆ»ä¸æ˜¯åªèƒ½å¤„ç†ä¸€ä¸ªè¿›ç¨‹å—ï¼Ÿæˆ‘çš„ç†è§£topè¾“å‡ºåº”è¯¥æ˜¯å››ä¸ªRçŠ¶æ€ä¸¤ä¸ªSçŠ¶æ€","like_count":1,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517728,"discussion_content":"RçŠ¶æ€çš„è¿›ç¨‹ä¸æ˜¯å•æŒ‡æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œè¿˜æŒ‡åœ¨runqueueä¸Šå¯ä»¥éšæ—¶å¾—åˆ°è°ƒåº¦æ—¶é—´ç‰‡è€Œå¯ä»¥è¿è¡Œçš„è¿›ç¨‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618062646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":275068,"user_name":"é’±ç±³","can_delete":false,"product_type":"c1","uid":1225974,"ip_address":"","ucode":"07AA44C6A40D34","user_header":"https://static001.geekbang.org/account/avatar/00/12/b4/f6/e39d5af1.jpg","comment_is_top":false,"comment_ctime":1611296789,"is_pvip":false,"replies":[{"id":"99974","content":"å¦‚æœè¢«åˆ çš„memory cgroupè¿˜æœ‰cache memory, å¯¹åº”çš„memroy cgroup æ§åˆ¶å—ä¸ä¼šéš &#47;sys&#47;fs&#47;cgroup&#47;memory&#47;...&#47;&lt;memory_cgroup&gt; çš„åˆ é™¤è€Œé©¬ä¸Šåˆ æ‰ã€‚<br><br>ä½ å¯ä»¥ç”¨ â€œecho 3 &gt; &#47;proc&#47;sys&#47;vm&#47;drop_cachesâ€ é‡Šæ”¾cacheä¹‹åï¼Œ memory cgroup num_cgroupsçš„æ•°å€¼åº”è¯¥ä¼šä¸‹é™ä¸€äº›ã€‚<br><br>&gt; è¿™ä¸ªå½±å“äº†apiå¯¹å®¹å™¨çš„åˆ›å»ºå’Œå¯åŠ¨<br>è¿™ä¸ªæœ‰ä»€ä¹ˆæ ·çš„å½±å“ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1611560714,"ip_address":"","comment_id":275068,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5906264085","product_id":100063801,"comment_content":"è¯·é—®è€å¸ˆï¼Œæˆ‘çš„å®¿ä¸»æœºçš„memory cgroupå¾ˆå¤šï¼Œå¤„äºä¸Šå‡è¶‹åŠ¿ï¼Œæœªä¸‹é™<br> ~# cat &#47;proc&#47;cgroups<br>#subsys_name\thierarchy\tnum_cgroups\tenabled<br>cpuset\t3\t30\t1<br>cpu\t2\t101\t1<br>cpuacct\t2\t101\t1<br>blkio\t6\t99\t1<br>memory\t7\t1013\t1<br>devices\t4\t99\t1<br>freezer\t9\t30\t1<br>net_cls\t10\t30\t1<br>perf_event\t8\t30\t1<br>net_prio\t10\t30\t1<br>pids\t5\t100\t1<br>è¿™ä¸ªå½±å“äº†apiå¯¹å®¹å™¨çš„åˆ›å»ºå’Œå¯åŠ¨ï¼Œæ”¹å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514205,"discussion_content":"å¦‚æœè¢«åˆ çš„memory cgroupè¿˜æœ‰cache memory, å¯¹åº”çš„memroy cgroup æ§åˆ¶å—ä¸ä¼šéš /sys/fs/cgroup/memory/.../&amp;lt;memory_cgroup&amp;gt; çš„åˆ é™¤è€Œé©¬ä¸Šåˆ æ‰ã€‚\n\nä½ å¯ä»¥ç”¨ â€œecho 3 &amp;gt; /proc/sys/vm/drop_cachesâ€ é‡Šæ”¾cacheä¹‹åï¼Œ memory cgroup num_cgroupsçš„æ•°å€¼åº”è¯¥ä¼šä¸‹é™ä¸€äº›ã€‚\n\n&amp;gt; è¿™ä¸ªå½±å“äº†apiå¯¹å®¹å™¨çš„åˆ›å»ºå’Œå¯åŠ¨\nè¿™ä¸ªæœ‰ä»€ä¹ˆæ ·çš„å½±å“ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611560714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":266189,"user_name":"Genius","can_delete":false,"product_type":"c1","uid":1042240,"ip_address":"","ucode":"425F2925BB1C27","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e7/40/e592d386.jpg","comment_is_top":false,"comment_ctime":1607231119,"is_pvip":false,"replies":[{"id":"96762","content":"CPUæ˜¯åˆ†æ—¶å¤„ç†è¿›ç¨‹çš„ã€‚æœ‰ä¸¤ä¸ªè¿›ç¨‹Aï¼ŒBåœ¨ä¸€ä¸ªCPUçš„æœºå™¨ä¸Šè¿è¡Œï¼Œ æ¯ä¸€ç§’æ—¶é—´é‡Œï¼ŒAå¯ä»¥è¿è¡Œ0.5ç§’ï¼ŒBå¯ä»¥è¿è¡Œ0.5ç§’ï¼Œé‚£ä¹ˆAæ‹¿åˆ°çš„CPUèµ„æºå°±æ˜¯0.5 cpu","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1607355726,"ip_address":"","comment_id":266189,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5902198415","product_id":100063801,"comment_content":"è€å¸ˆå¥½ï¼Œä¸€ä¸ªCPUåªèƒ½åŒæ—¶å¤„ç†ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸ºä»€ä¹ˆè¿˜èƒ½æŠŠCPUåˆ†ä¸º0.5Cçš„å•ä½å‘¢ï¼Œè¿™ä¸ªcpuçš„å•ä½æ˜¯æ€ä¹ˆç†è§£çš„å‘¢","like_count":1,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511172,"discussion_content":"CPUæ˜¯åˆ†æ—¶å¤„ç†è¿›ç¨‹çš„ã€‚æœ‰ä¸¤ä¸ªè¿›ç¨‹Aï¼ŒBåœ¨ä¸€ä¸ªCPUçš„æœºå™¨ä¸Šè¿è¡Œï¼Œ æ¯ä¸€ç§’æ—¶é—´é‡Œï¼ŒAå¯ä»¥è¿è¡Œ0.5ç§’ï¼ŒBå¯ä»¥è¿è¡Œ0.5ç§’ï¼Œé‚£ä¹ˆAæ‹¿åˆ°çš„CPUèµ„æºå°±æ˜¯0.5 cpu","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607355726,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":265188,"user_name":"Geek2014","can_delete":false,"product_type":"c1","uid":2028957,"ip_address":"","ucode":"9EB356D8DF287E","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f5/9d/104bb8ea.jpg","comment_is_top":false,"comment_ctime":1606809522,"is_pvip":false,"replies":[{"id":"96387","content":"@Geek2014, <br>å¯¹äº1ï¼Œ2ï¼Œ3ç‚¹ï¼Œæˆ‘çš„ç†è§£å’Œä½ ä¸€æ ·ã€‚<br><br>ä¸è¿‡è¿˜æ˜¯è¦è¯´ä¸€ä¸‹ï¼ŒI&#47;Oé«˜çš„åº”ç”¨ä¸ä¸€å®šæ˜¯Dè¿›ç¨‹ï¼Œè€Œåªæœ‰DçŠ¶æ€æ‰æ˜¯å¤„äºç­‰å¾…èµ„æºï¼Œæ‰ä¼šå¼•èµ·load averageå¢é«˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1606835579,"ip_address":"","comment_id":265188,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5901776818","product_id":100063801,"comment_content":"â€œåœ¨ Linux çš„ç³»ç»Ÿç»´æŠ¤ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç»å¸¸æŸ¥çœ‹ CPU ä½¿ç”¨æƒ…å†µï¼Œå†æ ¹æ®è¿™ä¸ªæƒ…å†µåˆ†æç³»ç»Ÿæ•´ä½“çš„è¿è¡ŒçŠ¶æ€ã€‚æœ‰æ—¶å€™ä½ å¯èƒ½ä¼šå‘ç°ï¼Œæ˜æ˜å®¹å™¨é‡Œæ‰€æœ‰è¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡éƒ½å¾ˆä½ï¼Œç”šè‡³æ•´ä¸ªå®¿ä¸»æœºçš„ CPU ä½¿ç”¨ç‡éƒ½å¾ˆä½ï¼Œè€Œæœºå™¨çš„ Load Average é‡Œçš„å€¼å´å¾ˆé«˜ï¼Œå®¹å™¨é‡Œè¿›ç¨‹è¿è¡Œå¾—ä¹Ÿå¾ˆæ…¢ã€‚â€<br><br>è€å¸ˆï¼Œè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘æ˜¯ä¸æ˜¯å¯ä»¥è¿™ä¹ˆç†è§£<br><br>    å‡è®¾ç³»ç»Ÿ4CPUï¼Œå¹³å‡è´Ÿè½½å¾ˆé«˜ä¸º8ï¼Œæ¯ä¸ªä»»åŠ¡ä½¿ç”¨100% CPUå¯å‘æŒ¥æœ€é«˜æ€§èƒ½<br>        1. å¦‚æœéƒ½æ˜¯CPUå¯†é›†å‹è´Ÿè½½ï¼Œé‚£ä¹ˆCPUä½¿ç”¨ç‡ä¸è¶…è¿‡50%ï¼Œåº”ç”¨æ€§èƒ½è‚¯å®šä¸‹é™<br>        2. å¦‚æœå…¨éƒ¨æ˜¯IOå¯†é›†å‹è´Ÿè½½ï¼Œé‚£ä¹ˆéƒ½åœ¨ç«äº‰IOèµ„æºï¼Œåº”ç”¨æ€§èƒ½è‚¯å®šä¸‹é™<br>        3. å‡è®¾æœ‰å°äº4ä¸ªçš„CPUå¯†é›†å‹è´Ÿè½½ï¼Œå…¶ä»–éƒ½æ˜¯IOå¯†é›†å‹è´Ÿè½½ï¼Œé‚£ä¹ˆCPUå¯†é›†å‹è´Ÿè½½çš„æ€§èƒ½åº”è¯¥ä¸å—å½±å“ã€‚","like_count":1,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510827,"discussion_content":"@Geek2014, \nå¯¹äº1ï¼Œ2ï¼Œ3ç‚¹ï¼Œæˆ‘çš„ç†è§£å’Œä½ ä¸€æ ·ã€‚\n\nä¸è¿‡è¿˜æ˜¯è¦è¯´ä¸€ä¸‹ï¼ŒI/Oé«˜çš„åº”ç”¨ä¸ä¸€å®šæ˜¯Dè¿›ç¨‹ï¼Œè€Œåªæœ‰DçŠ¶æ€æ‰æ˜¯å¤„äºç­‰å¾…èµ„æºï¼Œæ‰ä¼šå¼•èµ·load averageå¢é«˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606835579,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2028957,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/f5/9d/104bb8ea.jpg","nickname":"Geek2014","note":"","ucode":"9EB356D8DF287E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":331468,"discussion_content":"æ˜ç™½äº†ï¼Œå¤šè°¢è€å¸ˆè§£æƒ‘ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606879361,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356398,"user_name":"Frank","can_delete":false,"product_type":"c1","uid":1111985,"ip_address":"å››å·","ucode":"9DADD72C193296","user_header":"https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg","comment_is_top":false,"comment_ctime":1662263800,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1662263800","product_id":100063801,"comment_content":"è¯·é—®ä¸‹ï¼š  DçŠ¶æ€è¿›ç¨‹å¦‚ä½•ç›‘æ§å’Œåˆ†æå‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":328865,"user_name":"Geek4437","can_delete":false,"product_type":"c1","uid":2853695,"ip_address":"","ucode":"0BE885D9AD9444","user_header":"","comment_is_top":false,"comment_ctime":1640920866,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1640920866","product_id":100063801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œç»“åˆä¸Šä¸€èŠ‚æˆ‘æœ‰ä¸ªç–‘é—®ï¼šå®¹å™¨ä¸­ top&#47;uptime ä¸­çš„ load average æ˜¯å®¿ä¸»æœºçš„è¿˜æ˜¯å®¹å™¨çš„å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1160951,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b6/f7/3c3b1385.jpg","nickname":"æµ·èƒ†é˜¶æ®µ","note":"","ucode":"7A8C4BB4D0CDB8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544887,"discussion_content":"container","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641759515,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":308711,"user_name":"tianfeiyu","can_delete":false,"product_type":"c1","uid":1157786,"ip_address":"","ucode":"E65E6841AD5D7F","user_header":"https://static001.geekbang.org/account/avatar/00/11/aa/9a/92d2df36.jpg","comment_is_top":false,"comment_ctime":1629768623,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629768623","product_id":100063801,"comment_content":"è€å¸ˆï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹â€œä¼‘çœ é˜Ÿåˆ—ä¸­ä¸å¯æ‰“æ–­çš„è¿›ç¨‹å¹³å‡æ•°â€è™½ç„¶ä¼šå½±å“ç³»ç»Ÿçš„è´Ÿè½½ï¼Œä½†æ˜¯å¯¹ç³»ç»Ÿçš„æ€§èƒ½å½±å“ä¼šéå¸¸å¤§å—ï¼Œå®ƒä»¬ä¹‹å‰æœ‰ä»€ä¹ˆæ ·çš„å…³ç³»ï¼Œå› ä¸ºåœ¨çº¿ä¸Šçœ‹åˆ°è¿‡ä¸€äº›æœºå™¨ç¡®å®æœ‰Dè¿›ç¨‹å‡ºç°ï¼Œç”šè‡³è´Ÿè½½è¾¾åˆ°äº†ä¸Šåƒä½†æ˜¯ç³»ç»Ÿåœ¨æ­£å¸¸è¿è¡Œï¼Œä¸šåŠ¡è¿›ç¨‹å¹¶ä¸å—å½±å“ã€‚","like_count":0},{"had_liked":false,"id":300002,"user_name":"BertGeek","can_delete":false,"product_type":"c1","uid":1452799,"ip_address":"","ucode":"8E1D72C9F9778C","user_header":"https://static001.geekbang.org/account/avatar/00/16/2a/ff/a9d72102.jpg","comment_is_top":false,"comment_ctime":1624951212,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624951212","product_id":100063801,"comment_content":"åŸæ¥Load Average æ˜¯è¿™ä¹ˆç»Ÿè®¡çš„<br>ç¬¬ä¸€ç§æ˜¯ Linux è¿›ç¨‹è°ƒåº¦å™¨ä¸­å¯è¿è¡Œé˜Ÿåˆ—ï¼ˆRunning Queueï¼‰ä¸€æ®µæ—¶é—´ï¼ˆ1 åˆ†é’Ÿï¼Œ5 åˆ†é’Ÿï¼Œ15 åˆ†é’Ÿï¼‰çš„è¿›ç¨‹å¹³å‡æ•°ã€‚<br>ç¬¬äºŒç§æ˜¯ Linux è¿›ç¨‹è°ƒåº¦å™¨ä¸­ä¼‘çœ é˜Ÿåˆ—ï¼ˆSleeping Queueï¼‰é‡Œçš„ä¸€æ®µæ—¶é—´çš„ TASK_UNINTERRUPTIBLE çŠ¶æ€ä¸‹çš„è¿›ç¨‹å¹³å‡æ•°ã€‚","like_count":0},{"had_liked":false,"id":295434,"user_name":"æ‹‰å¯é‡Œå•¦","can_delete":false,"product_type":"c1","uid":1230293,"ip_address":"","ucode":"26E20DF096BDAF","user_header":"https://static001.geekbang.org/account/avatar/00/12/c5/d5/90ca8efe.jpg","comment_is_top":false,"comment_ctime":1622429805,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622429805","product_id":100063801,"comment_content":"è€å¸ˆï¼Œæˆ‘ä½¿ç”¨topå‘½ä»¤åï¼Œè¿›ç¨‹çŠ¶æ€æ˜¯Sï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆè¿˜å ç”¨CPUå‘¢","like_count":0},{"had_liked":false,"id":266535,"user_name":"ç‘","can_delete":false,"product_type":"c1","uid":1218285,"ip_address":"","ucode":"26F7ABACE0CE69","user_header":"https://static001.geekbang.org/account/avatar/00/12/96/ed/56731acd.jpg","comment_is_top":false,"comment_ctime":1607388077,"is_pvip":true,"replies":[{"id":"96819","content":"æ˜¯çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1607437674,"ip_address":"","comment_id":266535,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1607388077","product_id":100063801,"comment_content":"æ–‡é¦–æåˆ°çš„Cgroupæ— æ³•é™åˆ¶LoadAverageï¼Œä»è€Œå¯èƒ½å¯¼è‡´æ•´ä¸ªç³»ç»Ÿæ€§èƒ½ä¸‹é™ã€‚æŒ‡çš„æ˜¯å¤„äºDçŠ¶æ€è¿›ç¨‹çš„æ€§èƒ½ä¸‹é™ï¼Œè€ŒDçŠ¶æ€è¿›ç¨‹å¯¹åŒä¸€èµ„æºçš„ç«äº‰è¶Šæ¥è¶Šå¤šï¼Œæ•´ä½“è¡¨ç°å‡ºæ¥å°±æ˜¯ç³»ç»Ÿæ€§èƒ½ä¸‹é™ã€‚è¿™æ ·ç†è§£å¯¹å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511302,"discussion_content":"æ˜¯çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607437674,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":265234,"user_name":"æ°´è’¸è›‹","can_delete":false,"product_type":"c1","uid":1809160,"ip_address":"","ucode":"6F7F853A4BF901","user_header":"https://static001.geekbang.org/account/avatar/00/1b/9b/08/27ac7ecd.jpg","comment_is_top":false,"comment_ctime":1606819816,"is_pvip":false,"replies":[{"id":"96507","content":"@æ°´è’¸è›‹<br>è¿™é‡Œçš„å¹³å‡æ•°ç›®æ˜¯æŒ‡1åˆ†é’Ÿ&#47;5åˆ†é’Ÿ&#47;15åˆ†é’Ÿé˜Ÿåˆ—ä¸­çš„å¹³å‡æ•°","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1606918101,"ip_address":"","comment_id":265234,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1606819816","product_id":100063801,"comment_content":"è€å¸ˆcpuå¹³å‡æ˜¯æ´»åŠ¨è¿›ç¨‹&#47;cpuæ ¸æ•°ï¼Œsleepå¹³å‡ä¹Ÿæ˜¯sleep&#47;CPUcoreæ•°é‡ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510846,"discussion_content":"@æ°´è’¸è›‹\nè¿™é‡Œçš„å¹³å‡æ•°ç›®æ˜¯æŒ‡1åˆ†é’Ÿ/5åˆ†é’Ÿ/15åˆ†é’Ÿé˜Ÿåˆ—ä¸­çš„å¹³å‡æ•°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606918101,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}