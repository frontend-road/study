{"id":86823,"title":"ï¼ˆå°å®éªŒï¼‰ç†è§£ç¼–è¯‘åŸç†ï¼šä¸€ä¸ªå››åˆ™è¿ç®—çš„è§£é‡Šå™¨","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯winterã€‚</p><p>åœ¨å‰é¢çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘åœ¨JavaScriptå’ŒCSSçš„éƒ¨åˆ†ï¼Œå¤šæ¬¡æåˆ°äº†ç¼–è¯‘åŸç†ç›¸å…³çš„çŸ¥è¯†ã€‚è¿™ä¸€éƒ¨åˆ†çš„çŸ¥è¯†ï¼Œå¦‚æœæˆ‘ä»¬ä»ç¼–è¯‘åŸç†â€œé¾™ä¹¦â€ç­‰æ­£è§„çš„èµ„æ–™ä¸­å­¦ä¹ ï¼Œå°±ä¼šè€—è´¹æ‰ä¸å°‘çš„æ—¶é—´ï¼Œæ‰€ä»¥æˆ‘åœ¨è¿™é‡Œè®¾è®¡äº†ä¸€ä¸ªå°å®éªŒï¼Œå¸®åŠ©ä½ å¿«é€Ÿç†è§£ç¼–è¯‘åŸç†ç›¸å…³çš„çŸ¥è¯†ã€‚</p><p>ä»Šå¤©çš„å†…å®¹æ¯”è¾ƒç‰¹æ®Šï¼Œæˆ‘ä»¬æ¥åšä¸€æ®µè¯¦ç»†çš„ä»£ç å®éªŒï¼Œè¯¦ç»†çš„ä»£ç æˆ‘æ”¾åœ¨äº†æ–‡ç« é‡Œï¼Œå¦‚æœä½ æ­£åœ¨æ”¶å¬éŸ³é¢‘ï¼Œå¯ä»¥ç‚¹å‡»æ–‡ç« æŸ¥çœ‹è¯¦æƒ…ã€‚</p><h2>åˆ†æ</h2><p>æŒ‰ç…§ç¼–è¯‘åŸç†ç›¸å…³çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬æ¥è®¾è®¡ä¸€ä¸‹å·¥ä½œï¼Œè¿™é‡Œæˆ‘ä»¬åˆ†æˆå‡ ä¸ªæ­¥éª¤ã€‚</p><ul>\n<li>å®šä¹‰å››åˆ™è¿ç®—ï¼šäº§å‡ºå››åˆ™è¿ç®—çš„è¯æ³•å®šä¹‰å’Œè¯­æ³•å®šä¹‰ã€‚</li>\n<li>è¯æ³•åˆ†æï¼šæŠŠè¾“å…¥çš„å­—ç¬¦ä¸²æµå˜æˆtokenã€‚</li>\n<li>è¯­æ³•åˆ†æï¼šæŠŠtokenå˜æˆæŠ½è±¡è¯­æ³•æ ‘ASTã€‚</li>\n<li>è§£é‡Šæ‰§è¡Œï¼šååºéå†ASTï¼Œæ‰§è¡Œå¾—å‡ºç»“æœã€‚</li>\n</ul><h2>å®šä¹‰å››åˆ™è¿ç®—</h2><p>å››åˆ™è¿ç®—å°±æ˜¯åŠ å‡ä¹˜é™¤å››ç§è¿ç®—ï¼Œä¾‹å¦‚ï¼š</p><pre><code>1 + 2 * 3\n</code></pre><p>é¦–å…ˆæˆ‘ä»¬æ¥å®šä¹‰è¯æ³•ï¼Œå››åˆ™è¿ç®—é‡Œé¢åªæœ‰æ•°å­—å’Œè¿ç®—ç¬¦ï¼Œæ‰€ä»¥å®šä¹‰å¾ˆç®€å•ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜è¦æ³¨æ„ç©ºæ ¼å’Œæ¢è¡Œç¬¦ï¼Œæ‰€ä»¥è¯æ³•å®šä¹‰å¤§æ¦‚æ˜¯ä¸‹é¢è¿™æ ·çš„ã€‚</p><ul>\n<li>Token\n<ul>\n<li>Number: <code>1</code> <code>2</code> <code>3</code> <code>4</code> <code>5</code> <code>6</code> <code>7</code> <code>8</code> <code>9</code> <code>0</code> çš„ç»„åˆ</li>\n<li>Operator: <code>+</code> ã€<code>-</code>ã€ <code>*</code>ã€ <code>/</code> ä¹‹ä¸€</li>\n</ul>\n</li>\n<li>Whitespace: <code>&lt;sp&gt;</code></li>\n<li>LineTerminatorï¼š<code>&lt;LF&gt;</code> <code>&lt;CR&gt;</code></li>\n</ul><p>è¿™é‡Œæˆ‘ä»¬å¯¹ç©ºç™½å’Œæ¢è¡Œç¬¦æ²¡æœ‰ä»»ä½•çš„å¤„ç†ï¼Œæ‰€ä»¥è¯æ³•åˆ†æé˜¶æ®µä¼šç›´æ¥ä¸¢å¼ƒã€‚</p><!-- [[[read_end]]] --><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®šä¹‰è¯­æ³•ï¼Œè¯­æ³•å®šä¹‰å¤šæ•°é‡‡ç”¨BNFï¼Œä½†æ˜¯å…¶å®å¤§å®¶å†™èµ·æ¥éƒ½æ˜¯ä¹±å†™çš„ï¼Œæ¯”å¦‚JavaScriptæ ‡å‡†é‡Œé¢å°±æ˜¯ä¸€ç§è·ŸBNFç±»ä¼¼çš„è‡ªåˆ›è¯­æ³•ã€‚</p><p>ä¸è¿‡è¯­æ³•å®šä¹‰çš„æ ¸å¿ƒæ€æƒ³ä¸ä¼šå˜ï¼Œéƒ½æ˜¯å‡ ç§ç»“æ„çš„ç»„åˆäº§ç”Ÿä¸€ä¸ªæ–°çš„ç»“æ„ï¼Œæ‰€ä»¥è¯­æ³•å®šä¹‰ä¹Ÿå«è¯­æ³•äº§ç”Ÿå¼ã€‚</p><p>å› ä¸ºåŠ å‡ä¹˜é™¤æœ‰ä¼˜å…ˆçº§ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®¤ä¸ºåŠ æ³•æ˜¯ç”±è‹¥å¹²ä¸ªä¹˜æ³•å†ç”±åŠ å·æˆ–è€…å‡å·è¿æ¥æˆçš„ï¼š</p><pre><code>&lt;Expression&gt; ::= \n    &lt;AdditiveExpression&gt;&lt;EOF&gt;\n\n&lt;AdditiveExpression&gt; ::= \n    &lt;MultiplicativeExpression&gt;\n    |&lt;AdditiveExpression&gt;&lt;+&gt;&lt;MultiplicativeExpression&gt;\n    |&lt;AdditiveExpression&gt;&lt;-&gt;&lt;MultiplicativeExpression&gt;\n</code></pre><p>è¿™ç§BNFçš„å†™æ³•ç±»ä¼¼é€’å½’çš„åŸç†ï¼Œä½ å¯ä»¥ç†è§£ä¸€ä¸‹ï¼Œå®ƒè¡¨ç¤ºä¸€ä¸ªåˆ—è¡¨ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬æŠŠæ™®é€šæ•°å­—ä¹Ÿå¾—å½“æˆä¹˜æ³•çš„ä¸€ç§ç‰¹ä¾‹äº†ã€‚</p><pre><code>&lt;MultiplicativeExpression&gt; ::= \n    &lt;Number&gt;\n    |&lt;MultiplicativeExpression&gt;&lt;*&gt;&lt;Number&gt;\n    |&lt;MultiplicativeExpression&gt;&lt;/&gt;&lt;Number&gt;\n</code></pre><p>å¥½äº†ï¼Œè¿™å°±æ˜¯å››åˆ™è¿ç®—çš„å®šä¹‰äº†ã€‚</p><h2>è¯æ³•åˆ†æï¼šçŠ¶æ€æœº</h2><p>è¯æ³•åˆ†æéƒ¨åˆ†ï¼Œæˆ‘ä»¬æŠŠå­—ç¬¦æµå˜æˆtokenæµã€‚è¯æ³•åˆ†ææœ‰ä¸¤ç§æ–¹æ¡ˆï¼Œä¸€ç§æ˜¯çŠ¶æ€æœºï¼Œä¸€ç§æ˜¯æ­£åˆ™è¡¨è¾¾å¼ï¼Œå®ƒä»¬æ˜¯ç­‰æ•ˆçš„ï¼Œé€‰æ‹©ä½ å–œæ¬¢çš„å°±å¥½ï¼Œè¿™é‡Œæˆ‘éƒ½ä¼šä½ ä»‹ç»ä¸€ä¸‹çŠ¶æ€æœºã€‚</p><p>æ ¹æ®åˆ†æï¼Œæˆ‘ä»¬å¯èƒ½äº§ç”Ÿå››ç§è¾“å…¥å…ƒç´ ï¼Œå…¶ä¸­åªæœ‰ä¸¤ç§tokenï¼Œæˆ‘ä»¬çŠ¶æ€æœºçš„ç¬¬ä¸€ä¸ªçŠ¶æ€å°±æ˜¯æ ¹æ®ç¬¬ä¸€ä¸ªè¾“å…¥å­—ç¬¦æ¥åˆ¤æ–­è¿›å…¥äº†å“ªç§çŠ¶æ€ï¼š</p><pre><code class=\"language-JavaScript\">var token = [];\nconst start = char =&gt; {\n    if(char === '1' \n        || char === '2'\n        || char === '3'\n        || char === '4'\n        || char === '5'\n        || char === '6'\n        || char === '7'\n        || char === '8'\n        || char === '9'\n        || char === '0'\n    ) {\n        token.push(char);\n        return inNumber;   \n    }\n    if(char === '+' \n        || char === '-'\n        || char === '*'\n        || char === '/'\n    ) {\n        emmitToken(char, char);\n        return start\n    }\n    if(char === ' ') {\n        return start;\n    }\n    if(char === '\\r' \n        || char === '\\n'\n    ) {\n        return start;\n    }\n}\nconst inNumber = char =&gt; {\n    if(char === '1' \n        || char === '2'\n        || char === '3'\n        || char === '4'\n        || char === '5'\n        || char === '6'\n        || char === '7'\n        || char === '8'\n        || char === '9'\n        || char === '0'\n    ) {\n        token.push(char);\n        return inNumber;\n    } else {\n        emmitToken(\"Number\", token.join(\"\"));\n        token = [];\n        return start(char); // put back char\n    }\n}\n</code></pre><p>è¿™ä¸ªçŠ¶æ€æœºéå¸¸ç®€å•ï¼Œå®ƒåªæœ‰ä¸¤ä¸ªçŠ¶æ€ï¼Œå› ä¸ºæˆ‘ä»¬åªæœ‰Numberä¸æ˜¯å•å­—ç¬¦çš„tokenã€‚</p><p>è¿™é‡Œæˆ‘çš„çŠ¶æ€æœºå®ç°æ˜¯éå¸¸ç»å…¸çš„æ–¹å¼ï¼šç”¨å‡½æ•°è¡¨ç¤ºçŠ¶æ€ï¼Œç”¨ifè¡¨ç¤ºçŠ¶æ€çš„è¿ç§»å…³ç³»ï¼Œç”¨returnå€¼è¡¨ç¤ºä¸‹ä¸€ä¸ªçŠ¶æ€ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ¥è¿è¡Œä¸€ä¸‹è¿™ä¸ªçŠ¶æ€æœºè¯•è¯•çœ‹ï¼š</p><pre><code class=\"language-JavaScript\">\nfunction emmitToken(type, value) {\n    console.log(value);\n}\n\nvar input = \"1024 + 2 * 256\"\n\nvar state = start;\n\nfor(var c of input.split(''))\n    state = state(c);\n\nstate(Symbol('EOF'))\n\n</code></pre><p>è¿è¡Œåæˆ‘ä»¬å‘ç°è¾“å‡ºå¦‚ä¸‹ï¼š</p><pre><code>1024\n+\n2\n*\n256\n</code></pre><p>è¿™æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç­”æ¡ˆã€‚</p><h2>è¯­æ³•åˆ†æï¼šLL</h2><p>åšå®Œäº†è¯æ³•åˆ†æï¼Œæˆ‘ä»¬å¼€å§‹è¿›è¡Œè¯­æ³•åˆ†æï¼ŒLLè¯­æ³•åˆ†ææ ¹æ®æ¯ä¸€ä¸ªäº§ç”Ÿå¼æ¥å†™ä¸€ä¸ªå‡½æ•°ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥å†™å¥½å‡½æ•°åï¼š</p><pre><code>function AdditiveExpression( ){\n\n\n}\nfunction MultiplicativeExpression(){\n    \n\n}\n</code></pre><p>ä¸ºäº†ä¾¿äºç†è§£ï¼Œæˆ‘ä»¬å°±ä¸åšæµå¼å¤„ç†äº†ï¼Œå®é™…ä¸Šä¸€èˆ¬ç¼–è¯‘ä»£ç éƒ½åº”è¯¥æ”¯æŒæµå¼å¤„ç†ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬å‡è®¾tokenå·²ç»éƒ½æ‹¿åˆ°äº†ï¼š</p><pre><code class=\"language-JavaScript\">var tokens = [{\n    type:\"Number\",\n    value: \"1024\"\n}, {\n    type:\"+\"\n    value: \"+\"\n}, {\n    type:\"Number\",\n    value: \"2\"\n}, {\n    type:\"*\"\n    value: \"*\"\n}, {\n    type:\"Number\",\n    value: \"256\"\n}, {\n    type:\"EOF\"\n}];\n</code></pre><p>æ¯ä¸ªäº§ç”Ÿå¼å¯¹åº”ç€ä¸€ä¸ªå‡½æ•°ï¼Œä¾‹å¦‚ï¼šæ ¹æ®äº§ç”Ÿå¼ï¼Œæˆ‘ä»¬çš„AdditiveExpressionéœ€è¦å¤„ç†ä¸‰ç§æƒ…å†µï¼š</p><pre><code class=\"language-BNF\">&lt;AdditiveExpression&gt; ::= \n    &lt;MultiplicativeExpression&gt;\n    |&lt;AdditiveExpression&gt;&lt;+&gt;&lt;MultiplicativeExpression&gt;\n    |&lt;AdditiveExpression&gt;&lt;-&gt;&lt;MultiplicativeExpression&gt;\n</code></pre><p>é‚£ä¹ˆAddititveExpressionä¸­å°±è¦å†™ä¸‰ä¸ªifåˆ†æ”¯ï¼Œæ¥å¤„ç†ä¸‰ç§æƒ…å†µã€‚</p><p>AdditiveExpressionçš„å†™æ³•æ˜¯æ ¹ä¼ å…¥çš„èŠ‚ç‚¹ï¼Œåˆ©ç”¨äº§ç”Ÿå¼åˆæˆæ–°çš„èŠ‚ç‚¹</p><pre><code class=\"language-JavaScript\">function AdditiveExpression(source){\n    if(source[0].type === \"MultiplicativeExpression\") {\n        let node = {\n            type:\"AdditiveExpression\",\n            children:[source[0]]\n        }\n        source[0] = node;\n        return node;\n    } \n    if(source[0].type === \"AdditiveExpression\" &amp;&amp; source[1].type === \"+\") {\n        let node = {\n            type:\"AdditiveExpression\",\n            operator:\"+\",\n            children:[source.shift(), source.shift(), MultiplicativeExpression(source)]\n        }\n        source.unshift(node);\n    }\n    if(source[0].type === \"AdditiveExpression\" &amp;&amp; source[1].type === \"-\") {\n        let node = {\n            type:\"AdditiveExpression\",\n            operator:\"-\",\n            children:[source.shift(), source.shift(), MultiplicativeExpression(source)]\n        }\n        source.unshift(node);\n    }\n}\n</code></pre><p>é‚£ä¹ˆä¸‹ä¸€æ­¥æˆ‘ä»¬å°±æŠŠè§£æå¥½çš„tokenä¼ ç»™æˆ‘ä»¬çš„é¡¶å±‚å¤„ç†å‡½æ•°Expressionã€‚</p><pre><code>Expression(tokens);\n</code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹Expressionè¯¥æ€ä¹ˆå¤„ç†å®ƒã€‚</p><p>æˆ‘ä»¬Expressionæ”¶åˆ°ç¬¬ä¸€ä¸ªtokenï¼Œæ˜¯ä¸ªNumberï¼Œè¿™ä¸ªæ—¶å€™ï¼ŒExpressionå°±å‚»äº†ï¼Œè¿™æ˜¯å› ä¸ºäº§ç”Ÿå¼åªå‘Šè¯‰æˆ‘ä»¬ï¼Œæ”¶åˆ°äº† AdditiveExpression æ€ä¹ˆåŠã€‚</p><p>è¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦å¯¹äº§ç”Ÿå¼çš„é¦–é¡¹å±‚å±‚å±•å¼€ï¼Œæ ¹æ®æ‰€æœ‰å¯èƒ½æ€§è°ƒç”¨ç›¸åº”çš„å¤„ç†å‡½æ•°ï¼Œè¿™ä¸ªè¿‡ç¨‹åœ¨ç¼–è¯‘åŸç†ä¸­ç§°ä¸ºæ±‚â€œclosureâ€ã€‚</p><pre><code class=\"language-JavaScript\">function Expression(source){\n    if(source[0].type === \"AdditiveExpression\" &amp;&amp; source[1] &amp;&amp; source[1].type === \"EOF\" ) {\n        let node = {\n            type:\"Expression\",\n            children:[source.shift(), source.shift()]\n        }\n        source.unshift(node);\n        return node;\n    }\n    AdditiveExpression(source);\n    return Expression(source);\n}\nfunction AdditiveExpression(source){\n    if(source[0].type === \"MultiplicativeExpression\") {\n        let node = {\n            type:\"AdditiveExpression\",\n            children:[source[0]]\n        }\n        source[0] = node;\n        return AdditiveExpression(source);\n    } \n    if(source[0].type === \"AdditiveExpression\" &amp;&amp; source[1] &amp;&amp; source[1].type === \"+\") {\n        let node = {\n            type:\"AdditiveExpression\",\n            operator:\"+\",\n            children:[]\n        }\n        node.children.push(source.shift());\n        node.children.push(source.shift());\n        MultiplicativeExpression(source);\n        node.children.push(source.shift());\n        source.unshift(node);\n        return AdditiveExpression(source);\n    }\n    if(source[0].type === \"AdditiveExpression\" &amp;&amp; source[1] &amp;&amp; source[1].type === \"-\") {\n        let node = {\n            type:\"AdditiveExpression\",\n            operator:\"-\",\n            children:[]\n        }\n        node.children.push(source.shift());\n        node.children.push(source.shift());\n        MultiplicativeExpression(source);\n        node.children.push(source.shift());\n        source.unshift(node);\n        return AdditiveExpression(source);\n    }\n    if(source[0].type === \"AdditiveExpression\")\n        return source[0];\n    MultiplicativeExpression(source);\n    return AdditiveExpression(source);\n}\nfunction MultiplicativeExpression(source){\n    if(source[0].type === \"Number\") {\n        let node = {\n            type:\"MultiplicativeExpression\",\n            children:[source[0]]\n        }\n        source[0] = node;\n        return MultiplicativeExpression(source);\n    } \n    if(source[0].type === \"MultiplicativeExpression\" &amp;&amp; source[1] &amp;&amp; source[1].type === \"*\") {\n        let node = {\n            type:\"MultiplicativeExpression\",\n            operator:\"*\",\n            children:[]\n        }\n        node.children.push(source.shift());\n        node.children.push(source.shift());\n        node.children.push(source.shift());\n        source.unshift(node);\n        return MultiplicativeExpression(source);\n    }\n    if(source[0].type === \"MultiplicativeExpression\"&amp;&amp; source[1] &amp;&amp; source[1].type === \"/\") {\n        let node = {\n            type:\"MultiplicativeExpression\",\n            operator:\"/\",\n            children:[]\n        }\n        node.children.push(source.shift());\n        node.children.push(source.shift());\n        node.children.push(source.shift());\n        source.unshift(node);\n        return MultiplicativeExpression(source);\n    }\n    if(source[0].type === \"MultiplicativeExpression\")\n        return source[0];\n\n    return MultiplicativeExpression(source);\n};\n\nvar source = [{\n    type:\"Number\",\n    value: \"3\"\n}, {\n    type:\"*\",\n    value: \"*\"\n}, {\n    type:\"Number\",\n    value: \"300\"\n}, {\n    type:\"+\",\n    value: \"+\"\n}, {\n    type:\"Number\",\n    value: \"2\"\n}, {\n    type:\"*\",\n    value: \"*\"\n}, {\n    type:\"Number\",\n    value: \"256\"\n}, {\n    type:\"EOF\"\n}];\nvar ast = Expression(source);\n\nconsole.log(ast);\n</code></pre><h2>è§£é‡Šæ‰§è¡Œ</h2><p>å¾—åˆ°äº†ASTä¹‹åï¼Œæœ€å›°éš¾çš„ä¸€æ­¥æˆ‘ä»¬å·²ç»è§£å†³äº†ã€‚è¿™é‡Œæˆ‘ä»¬å°±ä¸å¯¹è¿™é¢—æ ‘åšä»»ä½•çš„ä¼˜åŒ–å’Œç²¾ç®€äº†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œç›´æ¥è¿›å…¥æ‰§è¡Œé˜¶æ®µã€‚æˆ‘ä»¬åªéœ€è¦å¯¹è¿™ä¸ªæ ‘åšéå†æ“ä½œæ‰§è¡Œå³å¯ã€‚</p><p>æˆ‘ä»¬æ ¹æ®ä¸åŒçš„èŠ‚ç‚¹ç±»å‹å’Œå…¶å®ƒä¿¡æ¯ï¼Œå†™ifåˆ†åˆ«å¤„ç†å³å¯ï¼š</p><pre><code class=\"language-JavaScript\">\nfunction evaluate(node) {\n    if(node.type === \"Expression\") {\n        return evaluate(node.children[0])\n    }\n    if(node.type === \"AdditiveExpression\") {\n        if(node.operator === '-') {\n            return evaluate(node.children[0]) - evaluate(node.children[2]);\n        }\n        if(node.operator === '+') {\n            return evaluate(node.children[0]) + evaluate(node.children[2]);\n        }\n        return evaluate(node.children[0])\n    }\n    if(node.type === \"MultiplicativeExpression\") {\n        if(node.operator === '*') {\n            return evaluate(node.children[0]) * evaluate(node.children[2]);\n        }\n        if(node.operator === '/') {\n            return evaluate(node.children[0]) / evaluate(node.children[2]);\n        }\n        return evaluate(node.children[0])\n    }\n    if(node.type === \"Number\") {\n        return Number(node.value);\n    }\n}\n</code></pre><h2>æ€»ç»“</h2><p>åœ¨è¿™ä¸ªå°å®éªŒä¸­ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå°å®éªŒå­¦ä¹ äº†ç¼–è¯‘åŸç†çš„åŸºæœ¬çŸ¥è¯†ï¼Œå°å®éªŒçš„ç›®çš„æ˜¯å¸®åŠ©ä½ ç†è§£JavaScriptè¯¾ç¨‹ä¸­æ¶‰åŠåˆ°çš„ç¼–è¯‘åŸç†åŸºæœ¬æ¦‚å¿µï¼Œå®ƒç¦»çœŸæ­£çš„ç¼–è¯‘åŸç†å­¦ä¹ è¿˜æœ‰å¾ˆå¤§çš„å·®è·ã€‚</p><p>é€šè¿‡å®éªŒï¼Œæˆ‘ä»¬äº†è§£äº†äº§ç”Ÿå¼ã€è¯æ³•åˆ†æã€è¯­æ³•åˆ†æå’Œè§£é‡Šæ‰§è¡Œçš„è¿‡ç¨‹ã€‚</p><p>æœ€åç•™ç»™ä½ ä¸€äº›æŒ‘æˆ˜ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„æ°´å¹³é€‰æ‹©ï¼š</p><ul>\n<li>è¡¥å…¨emmitTokenï¼Œä½¿å¾—æˆ‘ä»¬çš„ä»£ç èƒ½å®Œæ•´å·¥ä½œèµ·æ¥ã€‚</li>\n<li>ä¸ºå››åˆ™è¿ç®—åŠ å…¥å°æ•°ã€‚</li>\n<li>å¼•å…¥è´Ÿæ•°ã€‚</li>\n<li>æ·»åŠ æ‹¬å·åŠŸèƒ½ã€‚</li>\n</ul><p>æ¬¢è¿å†™å¥½çš„åŒå­¦ç•™è¨€ç»™æˆ‘ã€‚</p><p></p>","comments":[{"had_liked":false,"id":79870,"user_name":"é˜¿æˆ","can_delete":false,"product_type":"c1","uid":1390032,"ip_address":"","ucode":"CEC3CD65FB9333","user_header":"https://static001.geekbang.org/account/avatar/00/15/35/d0/f2ac6d91.jpg","comment_is_top":false,"comment_ctime":1553566311,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"126107617895","product_id":100023201,"comment_content":"* ä»¥å‰æˆ‘åªå¤§æ¦‚äº†è§£ä¸€èˆ¬çš„åšæ³•æ˜¯æ¶ˆé™¤æ–‡æ³•ä¸­çš„å·¦é€’å½’ï¼Œè¿™ä¸€è¯¾è®©æˆ‘çŸ¥é“åŸæ¥è¿˜å¯ä»¥é€šè¿‡â€œå±‚å±‚å±•å¼€â€å»å¤„ç†ã€‚<br>* è¯æ³•åˆ†ææˆ‘å°è¯•äº†æ­£åˆ™çš„æ–¹å¼<br>* æ‹¬å·çš„å¤„ç†è´¹äº†äº›æ—¶é—´ï¼Œè¿™é‡Œæˆ‘æ˜¯ä¿®æ”¹äº†æ–‡æ³•ï¼ˆæ„Ÿè§‰æˆ‘çš„ Expression äº§ç”Ÿå¼[åœ¨æºç æ³¨é‡Šé‡Œ]æ€ªæ€ªçš„ï¼Œå¸Œæœ› winter è€å¸ˆæœ‰æ—¶é—´çš„è¯å¯ä»¥æŒ‡ç‚¹ä¸€ä¸‹ï¼‰ï¼Œå¦ä¸€ç§åšæ³•æ˜¯ï¼Œå…ˆæŠŠä¸­ç¼€è¡¨è¾¾å¼å˜æˆå‰ç¼€è¡¨è¾¾å¼<br>* å­¦ä¹ ä¸€äº›ç¼–è¯‘åŸç†çš„çŸ¥è¯†è¿˜æ˜¯å¾ˆæœ‰å¿…è¦ä¹Ÿå¾ˆæœ‰è¶£çš„ï¼Œå¯ä»¥å»å†™ä¸€äº›webpackçš„loaderå•Šï¼Œæ’ä»¶å•Šï¼Œvscodeçš„æ’ä»¶ç­‰ç­‰<br>https:&#47;&#47;github.com&#47;aimergenge&#47;arithmetic-executor","like_count":29},{"had_liked":false,"id":111839,"user_name":"åŒ—å¤©é­”ç‹¼","can_delete":false,"product_type":"c1","uid":1188144,"ip_address":"","ucode":"C22623ECEB8DBA","user_header":"https://static001.geekbang.org/account/avatar/00/12/21/30/8ecce1e1.jpg","comment_is_top":false,"comment_ctime":1562629674,"is_pvip":true,"discussion_count":3,"race_medal":0,"score":"70282106410","product_id":100023201,"comment_content":"æ„Ÿè§‰æ¯ä¸€ç¯‡éƒ½éœ€è¦çœ‹ä¸‰éï¼Œæ‰èƒ½çœ‹æ‡‚ä¸€ç‚¹å†™çš„æ˜¯å•¥ã€‚åç«¯å…¥è¡Œï¼Œå¤§å‰ç«¯ï¼Œå…¨æ ˆï¼Œæ¶æ„å¸ˆã€‚è·¯è¿˜å¾ˆé•¿ï¼Œæ¥¼ä¸Šçš„ï¼šæ—¥æ‹±ä¸€å’ï¼Œå…±å‹‰","like_count":17,"discussions":[{"author":{"id":2189600,"avatar":"https://static001.geekbang.org/account/avatar/00/21/69/20/5cba0aa5.jpg","nickname":"é™åå¸¸æ€å·±è¿‡ï¼Œé—²è°ˆè«è®ºäººé","note":"","ucode":"01D40CD71BD51C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306954,"discussion_content":"æ¯äº†ä¸‰éä¹Ÿä¸ä¸€å®šèƒ½æ‡‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1600430347,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1314538,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0e/ea/16291abc.jpg","nickname":"better man","note":"","ucode":"89E50F6762822F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3715,"discussion_content":"åŒå’","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1564730791,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1249969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/12/b1/3a112b27.jpg","nickname":"æ®µå¸…å¸…","note":"","ucode":"2675BC0BE154E8","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":563956,"discussion_content":"å·èµ·æ¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650118159,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79329,"user_name":"Bojack","can_delete":false,"product_type":"c1","uid":1251080,"ip_address":"","ucode":"A57E552845DB28","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoLw2qjwoaVCDq8BqCcXOibyTG3rxiaJlDy2lt62IkiaDrrHeVwq4Pe8RpBbYJTIiadyicZ7InBCLCjJtQ/132","comment_is_top":false,"comment_ctime":1553436018,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"31618207090","product_id":100023201,"comment_content":"å®ç°äº†å°æ•°ä¸è´Ÿæ•°çš„ç¼–è¯‘å™¨ https:&#47;&#47;gist.github.com&#47;OPY-bbt&#47;8ee387122550326f60592b94b7908d19","like_count":7},{"had_liked":false,"id":78690,"user_name":"ç¿°å¼Ÿ","can_delete":false,"product_type":"c1","uid":1144772,"ip_address":"","ucode":"42149ACC75AA08","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/EJZoM46wR6QqTeibhPZsO5wJTeUia4RndGicWfDZLw153WibjsnJXqEtGZICxAa8icb36pDkficTic3FViaySd1z9HmQBw/132","comment_is_top":false,"comment_ctime":1553218741,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"31617989813","product_id":100023201,"comment_content":"æ—¥æ‹±ä¸€å’","like_count":7},{"had_liked":false,"id":159568,"user_name":"ç¼ºä¸ªè±†é¥¼å—","can_delete":false,"product_type":"c1","uid":1390212,"ip_address":"","ucode":"EF050C820E4E17","user_header":"https://static001.geekbang.org/account/avatar/00/15/36/84/e19b05dd.jpg","comment_is_top":false,"comment_ctime":1575687395,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23050523875","product_id":100023201,"comment_content":"ä¹‹å‰å†™äº†ä¸€ä¸ªJSçš„ç¼–è¯‘å™¨çš„è¯æ³•å’Œè¯­æ³•åˆ†æã€‚å¯ä»¥å¤„ç†å˜é‡å£°æ˜ï¼ŒåŠ å‡ä¹˜é™¤è¿ç®—åŠèµ‹å€¼è¿ç®—ã€‚<br>https:&#47;&#47;github.com&#47;yuguomin&#47;my-compiler","like_count":5},{"had_liked":false,"id":78381,"user_name":"ä¸€æ¡ä¸ä¼šæŒ£æ‰çš„å’¸é±¼ğŸŸ","can_delete":false,"product_type":"c1","uid":1374267,"ip_address":"","ucode":"AE37E9FAD55F33","user_header":"https://static001.geekbang.org/account/avatar/00/14/f8/3b/a338f925.jpg","comment_is_top":false,"comment_ctime":1553136160,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23027972640","product_id":100023201,"comment_content":"æƒ³é—®ä¸‹è€å¸ˆæœ‰æ²¡æœ‰æ¨èçš„å›½å¤–è®ºå›|YouTubeä½œè€…|ä¸ªäººåšå®¢","like_count":5},{"had_liked":false,"id":123749,"user_name":"chang.xu","can_delete":false,"product_type":"c1","uid":1244613,"ip_address":"","ucode":"51C230B833A214","user_header":"https://static001.geekbang.org/account/avatar/00/12/fd/c5/1f13bed2.jpg","comment_is_top":false,"comment_ctime":1565750935,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18745620119","product_id":100023201,"comment_content":"æ ‡è®°ï¼Œéœ€è¦åŸºç¡€å†å›æ¥","like_count":4},{"had_liked":false,"id":104822,"user_name":"Rango","can_delete":false,"product_type":"c1","uid":1158889,"ip_address":"","ucode":"78D05A106F049E","user_header":"https://static001.geekbang.org/account/avatar/00/11/ae/e9/48703ee9.jpg","comment_is_top":false,"comment_ctime":1560848214,"is_pvip":false,"replies":[{"id":"58943","content":"æ€ä¹ˆè§£æå‘¢ éš¾é“ä¸æ˜¯è·Ÿè¯­æ³•åˆ†æä¸€æ ·ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"winter","uid":"1268524","ctime":1574222272,"ip_address":"","comment_id":104822,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18740717398","product_id":100023201,"comment_content":"è¿™è¾¹æŠŠä¸­ç¼€è¡¨è¾¾å¼è§£ææˆåç¼€è¡¨è¾¾å¼ä¼šä¸ä¼šæ›´å®¹æ˜“ç†è§£ä¸€ç‚¹ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1268524,"avatar":"https://static001.geekbang.org/account/avatar/00/13/5b/2c/12bfd3cd.jpg","nickname":"winter","note":"","ucode":"2B068EDEAFEB56","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454440,"discussion_content":"æ€ä¹ˆè§£æå‘¢ éš¾é“ä¸æ˜¯è·Ÿè¯­æ³•åˆ†æä¸€æ ·ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574222272,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":140750,"user_name":"Glee","can_delete":false,"product_type":"c1","uid":1388875,"ip_address":"","ucode":"AA0D428E34D29E","user_header":"https://static001.geekbang.org/account/avatar/00/15/31/4b/0f5b3a0a.jpg","comment_is_top":false,"comment_ctime":1571042277,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14455944165","product_id":100023201,"comment_content":"æ—¥æ‹±ä¸€å’","like_count":3},{"had_liked":false,"id":80515,"user_name":"çˆ±çš„ç¥","can_delete":false,"product_type":"c1","uid":1373857,"ip_address":"","ucode":"780400297FB83A","user_header":"https://static001.geekbang.org/account/avatar/00/14/f6/a1/debef255.jpg","comment_is_top":false,"comment_ctime":1553673706,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14438575594","product_id":100023201,"comment_content":"å¤§ä¸‰æ­£åœ¨å­¦ä¹ ç¼–è¯‘åŸç†ï¼Œç›®å‰ä»…èƒ½çœ‹æ‡‚è¯æ³•åˆ†æé‚£äº›ï¼Œåé¢è¿˜ä¸èƒ½çœ‹æ‡‚ã€‚è¡¥å…¨äº†emmitTokenå‡½æ•°ã€‚<br>var tokens = []<br>emmitToken(typeï¼Œvalue){<br>   tokens.push({<br>      type :  typeï¼Œ<br>      value:  value<br>   })<br>}<br>ä¸çŸ¥é“å¯¹ä¸å¯¹ğŸ¤”","like_count":3,"discussions":[{"author":{"id":1645413,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/OWO43KiahibaWnZWkEzXfNQCAqAvVNia44HLxzaNbPKZxiaic3ameJ72dLros26ibxuCL1B5pl7MRlOVrqutNsTOXegQ/132","nickname":"JY","note":"","ucode":"54DF39E40C0F20","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7959,"discussion_content":"è¿˜æœ‰EOFè¦å¤„ç†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567740389,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78856,"user_name":"leslee","can_delete":false,"product_type":"c1","uid":1384326,"ip_address":"","ucode":"DB1CBF9F8D16BF","user_header":"https://static001.geekbang.org/account/avatar/00/15/1f/86/3a7eeac4.jpg","comment_is_top":false,"comment_ctime":1553258807,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14438160695","product_id":100023201,"comment_content":"BNF é‚£é‡Œæœ‰æ²¡æœ‰è¯¦ç»†ä¸€ç‚¹çš„èµ„æ–™å‘¢ æˆ–è€…æœ‰æ²¡æœ‰æ›´åŠ é€šä¿—çš„å†™æ³•ï¼Ÿ çœ‹ä¸æ‡‚äº†â€¦â€¦","like_count":3},{"had_liked":false,"id":78301,"user_name":"Huayra","can_delete":false,"product_type":"c1","uid":1031596,"ip_address":"","ucode":"5F8F6EF2783C1B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bd/ac/c9154dfe.jpg","comment_is_top":false,"comment_ctime":1553128066,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10143062658","product_id":100023201,"comment_content":"ç¡¬å•ƒé¾™ä¹¦ï¼Œå¯¹ç¼–ç¨‹è¯­è¨€çš„ç†è§£æ›´ä¸Šä¸€å±‚æ¥¼","like_count":2},{"had_liked":false,"id":267915,"user_name":"Geek_e6f5a9","can_delete":false,"product_type":"c1","uid":2360854,"ip_address":"","ucode":"028C9559ACC63D","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/BWDhMILusuficY2zo10KiaetDPjW08aBJ5sn7cLy2VV91hicacriaibDoqDAexLc0Mr4fnwpbllOLZ0BEFib3tic5WtHA/132","comment_is_top":false,"comment_ctime":1607995819,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5902963115","product_id":100023201,"comment_content":"æ„Ÿè§‰åƒåœ¨çœ‹å¤©ä¹¦ğŸ˜­ï¼Œç‰¹åˆ«æ˜¯è§£æExpressionæ±‚closureé‚£éƒ¨åˆ†ä»£ç ï¼Œè¯·é—®winterè€å¸ˆå­¦ä¹ è¿™ä¸ªçš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿæ€æ ·æ‰èƒ½çœ‹æ‡‚ï¼Ÿ","like_count":1},{"had_liked":false,"id":265422,"user_name":"ä»æ–°å¼€å§‹","can_delete":false,"product_type":"c1","uid":1736797,"ip_address":"","ucode":"9BDA8C16C24321","user_header":"https://static001.geekbang.org/account/avatar/00/1a/80/5d/b870bb08.jpg","comment_is_top":false,"comment_ctime":1606894284,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5901861580","product_id":100023201,"comment_content":"æ—¥æ‹±ä¸€å’","like_count":1},{"had_liked":false,"id":164195,"user_name":"å¤šå¤š","can_delete":false,"product_type":"c1","uid":1344516,"ip_address":"","ucode":"4040EDA251F971","user_header":"https://static001.geekbang.org/account/avatar/00/14/84/04/4607749e.jpg","comment_is_top":false,"comment_ctime":1576907646,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5871874942","product_id":100023201,"comment_content":"é€šè¿‡Symbol(&#39;EOF&#39;)æ€ä¹ˆæ‹¿åˆ°&#39;EOF&#39;ï¼Ÿæ˜¯ä¸æ˜¯åº”è¯¥ç”¨Symbol.for(&#39;EOF&#39;)ï¼Ÿ","like_count":1},{"had_liked":false,"id":78592,"user_name":"ban","can_delete":false,"product_type":"c1","uid":1034204,"ip_address":"","ucode":"E523CE97E48266","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c7/dc/9408c8c2.jpg","comment_is_top":false,"comment_ctime":1553180589,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5848147885","product_id":100023201,"comment_content":"è€å¸ˆï¼Œåšåç«¯çš„æ„Ÿè§‰è¶Šåˆ°åé¢è¶Šçœ‹ä¸åˆ°ï¼Œè¯·é—®è¯¥æ€ä¹ˆåšï¼Œæ±‚è§£","like_count":1,"discussions":[{"author":{"id":1610726,"avatar":"https://static001.geekbang.org/account/avatar/00/18/93/e6/fd94c378.jpg","nickname":"545é¾™å“¥å“¥","note":"","ucode":"3B74276B771817","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":212232,"discussion_content":"æ²¡äº‹ï¼Œå‰ç«¯åŒå­¦è¡¨ç¤ºä¹Ÿçœ‹ä¸æ‡‚QAQ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584949282,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353917,"user_name":"kkkä¸¶kk","can_delete":false,"product_type":"c1","uid":3078538,"ip_address":"äº‘å—","ucode":"0FA99C7B85C867","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/oltXBXuibxC3rVKOLn9NweNETjP510mItykNdS0daSZs1qyTRjzDXGtWNzUYwe0iaRRXsOZygk8d9x3HLqUXZffA/132","comment_is_top":false,"comment_ctime":1659925959,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1659925959","product_id":100023201,"comment_content":"æ„Ÿè§‰å’Œå‰ç«¯çš„æ¨¡æ¿å¼•æ“å·®ä¸å¤šï¼Œéƒ½æ˜¯ä»å­—ç¬¦ä¸²è§£æåˆ°tokenï¼Œæœ€åå†è§£ætoken","like_count":0},{"had_liked":false,"id":333578,"user_name":"æœ¨å­ææ","can_delete":false,"product_type":"c1","uid":2852517,"ip_address":"","ucode":"F8EF397893AA4E","user_header":"","comment_is_top":false,"comment_ctime":1644411283,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1644411283","product_id":100023201,"comment_content":"ä¸€ç¯‡æ›´æ¯”ä¸€ç¯‡éš¾","like_count":0},{"had_liked":false,"id":251318,"user_name":"zly","can_delete":false,"product_type":"c1","uid":2175260,"ip_address":"","ucode":"BBBCA6CD16FFBF","user_header":"https://static001.geekbang.org/account/avatar/00/21/31/1c/51f4d08e.jpg","comment_is_top":false,"comment_ctime":1601459772,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601459772","product_id":100023201,"comment_content":"<br>&#47;**<br> * numberè½¬MultiplicativeExpressionå¯¹è±¡åï¼Œåˆ¤æ–­æ˜¯å¦æœ‰ä¹˜é™¤ï¼Œæœ‰å°±åˆæˆæ–°çš„MultiplicativeExpression<br> * @param {Token[]} tokenList<br> *&#47;<br>function MultiplicativeExpression(tokenList: Token[]): Token {<br>  let first = tokenList[0];<br>  let second = tokenList[1];<br>  if (first.type == &quot;number&quot;) {<br>    let newToken: Token = {<br>      type: &quot;MultiplicativeExpression&quot;,<br>      children: [first],<br>    };<br>    tokenList[0] = newToken;<br>  } else if (<br>    first.type == &quot;MultiplicativeExpression&quot; &amp;&amp;<br>    second &amp;&amp;<br>    (second.type == &quot;&#47;&quot; || second.type == &quot;*&quot;)<br>  ) {<br>    let newToken: Token = {<br>      type: &quot;MultiplicativeExpression&quot;,<br>      operating: second.type,<br>      children: [],<br>    };<br>    newToken.children.push(tokenList.shift());<br>    tokenList.shift();<br>    newToken.children.push(tokenList.shift());<br>    tokenList.unshift(newToken);<br>  } else if (first.type == &quot;MultiplicativeExpression&quot;) {<br>    return first;<br>  }<br>  return MultiplicativeExpression(tokenList);<br>}<br><br>&#47;**<br> * æ ¹æ®astè¯­æ³•æ ‘è¿›è¡Œè®¡ç®—å¹¶è¿”å›ç»“æœ<br> * @param {Token[]} tokenList<br> *&#47;<br>function executeTree(token: Token): number {<br>  if (token.type == &quot;number&quot;) {<br>    return Number(token.value);<br>  }<br>  let first = token.children[0];<br>  let second = token.children[1];<br>  if (token.type == &quot;AdditiveExpression&quot;) {<br>    if (token.operating) {<br>      let firstResult = executeTree(first);<br>      let secondResult = second ? executeTree(second) : 0;<br>      return firstResult + (token.operating == &quot;-&quot; ? -1 : 1) * secondResult;<br>    } else {<br>      return executeTree(first);<br>    }<br>  }<br>  if (token.type == &quot;MultiplicativeExpression&quot;) {<br>    let firstResult = executeTree(first);<br>    if (token.operating == &quot;&#47;&quot;) {<br>      return firstResult &#47; (second ? executeTree(second) : 1);<br>    } else if (token.operating == &quot;*&quot;) {<br>      return firstResult * (second ? executeTree(second) : 1);<br>    } else {<br>      return firstResult;<br>    }<br>  }<br>  if (token.type == &quot;Expression&quot;) {<br>    return executeTree(first);<br>  }<br>}<br><br>&#47;&#47;test code<br>let result = arithmeticEval(&quot;1.4+2.2*3+3&#47;3&quot;);<br>&#47;&#47;expected value<br>console.log(result);<br>9;<br>","like_count":0},{"had_liked":false,"id":251317,"user_name":"zly","can_delete":false,"product_type":"c1","uid":2175260,"ip_address":"","ucode":"BBBCA6CD16FFBF","user_header":"https://static001.geekbang.org/account/avatar/00/21/31/1c/51f4d08e.jpg","comment_is_top":false,"comment_ctime":1601459762,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601459762","product_id":100023201,"comment_content":"&#47;**<br> * MultiplicativeExpressionå¯¹è±¡è½¬AdditiveExpressionå¯¹è±¡åï¼Œåˆ¤æ–­æ˜¯å¦æœ‰åŠ å‡ï¼Œæœ‰åŠ å‡å°±åˆæˆæ–°çš„AdditiveExpression<br> * @param {Token[]} tokenList<br> *&#47;<br>function AdditiveExpression(tokenList: Token[]): Token {<br>  let first = tokenList[0];<br>  let second = tokenList[1];<br>  if (first.type == &quot;MultiplicativeExpression&quot;) {<br>    let newToken: Token = {<br>      type: &quot;AdditiveExpression&quot;,<br>      children: [first],<br>    };<br>    tokenList[0] = newToken;<br>  } else if (<br>    first.type == &quot;AdditiveExpression&quot; &amp;&amp;<br>    second &amp;&amp;<br>    (second.type == &quot;+&quot; || second.type == &quot;-&quot;)<br>  ) {<br>    let newToken: Token = {<br>      type: &quot;AdditiveExpression&quot;,<br>      operating: second.type,<br>      children: [],<br>    };<br>    newToken.children.push(tokenList.shift());<br>    tokenList.shift();<br>    MultiplicativeExpression(tokenList);<br>    newToken.children.push(tokenList.shift());<br>    tokenList.unshift(newToken);<br>  } else if (first.type == &quot;AdditiveExpression&quot;) {<br>    return first;<br>  } else {<br>    MultiplicativeExpression(tokenList);<br>  }<br>  return AdditiveExpression(tokenList);<br>}","like_count":0},{"had_liked":false,"id":251316,"user_name":"zly","can_delete":false,"product_type":"c1","uid":2175260,"ip_address":"","ucode":"BBBCA6CD16FFBF","user_header":"https://static001.geekbang.org/account/avatar/00/21/31/1c/51f4d08e.jpg","comment_is_top":false,"comment_ctime":1601459732,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601459732","product_id":100023201,"comment_content":"&#47;&#47;åˆæ­¥ç›®æ ‡ï¼šä¸å¸¦æ‹¬å·çš„åŠ å‡ä¹˜é™¤çš„å››åˆ™è¿ç®—æ‰§è¡Œå™¨<br>type Operating = &quot;+&quot; | &quot;-&quot; | &quot;*&quot; | &quot;&#47;&quot;;<br><br>type TokenType =<br>  | &quot;number&quot;<br>  | &quot;EOF&quot;<br>  | &quot;MultiplicativeExpression&quot;<br>  | &quot;AdditiveExpression&quot;<br>  | &quot;Expression&quot;<br>  | Operating;<br><br>interface Token {<br>  type: TokenType;<br>  value?: string;<br>  children?: Token[];<br>  operating?: Operating;<br>}<br>&#47;&#47;tokenæ•°<br>let tokenList: Token[] = [];<br>let numberToken = [&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;0&quot;, &quot;.&quot;];<br>let operatingToken: string[] = [&quot;+&quot;, &quot;-&quot;, &quot;&#47;&quot;, &quot;*&quot;];<br>&#47;**<br> * è‡ªå·±å®ç°å››åˆ™è¿ç®—çš„ä¸€ä¸ªevalæ‰§è¡Œå™¨<br> *<br> * @param {string} str<br> *&#47;<br>function arithmeticEval(str: string): number {<br>  tokenList = [];<br>  let tokenStateMachine = new TokenStateMachine(str);<br>  tokenStateMachine.lexicalAnalysis();<br>  tokenList.push({ type: &quot;EOF&quot; });<br>  let tree = Expression(tokenList);<br>  let result = executeTree(tree);<br>  return result;<br>}<br><br>&#47;**<br> * tokençŠ¶æ€æœº<br> * @class TokenStateMachine<br> *&#47;<br>class TokenStateMachine {<br>  state: () =&gt; void;<br>  index: number = 0;<br>  str: string;<br>  numberStr = &quot;&quot;;<br>  constructor(str: string) {<br>    this.str = str;<br>    this.index = 0;<br>    this.state = this.start;<br>  }<br>  &#47;**<br>   *  è¯æ³•åˆ†æ<br>   * @memberof TokenStateMachine<br>   *&#47;<br>  lexicalAnalysis() {<br>    while (this.index &lt;= this.str.length) {<br>      this.state();<br>    }<br>  }<br>  start() {<br>    let key = this.str[this.index];<br>    if (numberToken.includes(key)) {<br>      this.numberStr = &quot;&quot;;<br>      this.numberStr += key;<br>      this.state = this.number;<br>    } else if (operatingToken.includes(key)) {<br>      emitToken(key as TokenType, key);<br>    }<br>    this.index += 1;<br>  }<br>  number() {<br>    let key = this.str[this.index];<br>    if (numberToken.includes(key)) {<br>      this.numberStr += key;<br>      this.index += 1;<br>    } else {<br>      emitToken(&quot;number&quot;, this.numberStr);<br>      this.state = this.start;<br>    }<br>  }<br>}<br>&#47;**<br> * è§¦å‘tokenï¼Œå¢åŠ tokenåˆ°tokenæ ‘ä¸­<br> * @param {TokenType} tokenType<br> * @param {string} key<br> *&#47;<br>function emitToken(tokenType: TokenType, key: string) {<br>  tokenList.push({<br>    type: tokenType,<br>    value: key,<br>  });<br>}","like_count":0},{"had_liked":false,"id":205228,"user_name":"ä¸‰çš®","can_delete":false,"product_type":"c1","uid":1353061,"ip_address":"","ucode":"D0087B34A24387","user_header":"https://static001.geekbang.org/account/avatar/00/14/a5/65/ca607ded.jpg","comment_is_top":false,"comment_ctime":1586574069,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586574069","product_id":100023201,"comment_content":"ç¨åå†çœ‹","like_count":0},{"had_liked":false,"id":188525,"user_name":"é«˜å®å†›","can_delete":false,"product_type":"c1","uid":1353773,"ip_address":"","ucode":"B4B3EBE191659A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/xpAsb3hl87UbMPCkYhgdvC3pSx2WYaic9vu8qibksibttGveDbibohibsicxk0AQayNriciaeV3HYrCEd0dQkp4Q83nTqQ/132","comment_is_top":false,"comment_ctime":1584364581,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584364581","product_id":100023201,"comment_content":"ç•™çš„æŒ‘æˆ˜æ˜¯ä¸æ˜¯åªæœ‰æœ€åä¸€ä¸ªæ·»åŠ æ‹¬å·çš„éœ€è¦åœ¨closureé‡Œå¤„ç†ï¼Œå°æ•°å’Œè´Ÿæ•°çš„åœ¨è¯æ³•åˆ†æé‡Œå°±å¯ä»¥ï¼Ÿ","like_count":0},{"had_liked":false,"id":91919,"user_name":"èŠ¬èŠ¬é¢œ","can_delete":false,"product_type":"c1","uid":1474173,"ip_address":"","ucode":"AA88E3951519E7","user_header":"https://static001.geekbang.org/account/avatar/00/16/7e/7d/d3345d7f.jpg","comment_is_top":false,"comment_ctime":1557134272,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557134272","product_id":100023201,"comment_content":"äº§ç”Ÿå¼å¦‚ä¸‹<br>Expr = Add &lt;EOF&gt;<br>Add = Multiply | Add + Multiply | Add - Multiply<br>Multiply = Num | Multiply * Multiply | Multiply &#47; Multiply | ( Add )<br>Num = æœ‰ç†æ•°<br><br>å¯¹äºæ‹¬å·çš„å¤„ç†ï¼Œå…³é”®åœ¨MultiplicativeExpressionæ–¹æ³•ä¸­åˆ¤æ–­è¿ç®—ç¬¦å·¦å³ä¸¤ä¾§çš„å˜é‡æ˜¯å¦ä¸º(Add)<br>function MultiplicativeExpression(source) {<br>  if (source[0].type === &quot;Number&quot;) {<br>    let node = {<br>      type: &quot;MultiplicativeExpression&quot;,<br>      children: [source[0]]<br>    }<br>    source[0] = node;<br>    return MultiplicativeExpression(source);<br>  }<br>  if (source[0].type === &quot;parentness&quot;) {<br>    let addExpr = [];<br>    let i = 0;<br>    while (i++ &lt; source.length &amp;&amp; source[i].type !== &quot;parenthese&quot;) {<br>      addExpr.push(source[i]);<br>    }<br>    source.splice(0, addExpr.length + 2, AdditiveExpression([...addExpr]));<br>    source[0].type = &quot;MultiplicativeExpression&quot;;<br>  }<br>  if (source[2] &amp;&amp; source[2].type === &quot;parenthese&quot;) {<br>    let addExpr = [];<br>    let i = 2;<br>    while (i++ &lt; source.length &amp;&amp; source[i].type !== &quot;parenthese&quot;) {<br>      addExpr.push(source[i]);<br>    }<br>    source.splice(2, addExpr.length + 2, AdditiveExpression([...addExpr]));<br>    source[2].type = &quot;MultiplicativeExpression&quot;;<br>  }<br>...<br>","like_count":0},{"had_liked":false,"id":79283,"user_name":"ç–¯äºŒä¸­","can_delete":false,"product_type":"c1","uid":1058296,"ip_address":"","ucode":"51DE889B3C2413","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/f8/4a6062b1.jpg","comment_is_top":false,"comment_ctime":1553424444,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553424444","product_id":100023201,"comment_content":"æ¶¨çŸ¥è¯†äº†ï¼ŒBNFå’ŒLLçœŸæ˜¯ç²¾å¦™","like_count":0}]}