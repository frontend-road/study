{"id":135120,"title":"21 | Kafka Consumeræºç åˆ†æï¼šæ¶ˆæ¯æ¶ˆè´¹çš„å®ç°è¿‡ç¨‹","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æç¥ã€‚</p><p>æˆ‘ä»¬åœ¨ä¸ŠèŠ‚è¯¾ä¸­æåˆ°è¿‡ï¼Œç”¨äºè§£å†³æ¶ˆæ¯é˜Ÿåˆ—ä¸€äº›å¸¸è§é—®é¢˜çš„çŸ¥è¯†å’ŒåŸç†ï¼Œæœ€ç»ˆè½åœ°åˆ°ä»£ç ä¸Šï¼Œéƒ½åŒ…å«åœ¨æ”¶ã€å‘æ¶ˆæ¯è¿™ä¸¤ä¸ªæµç¨‹ä¸­ã€‚å¯¹äºæ¶ˆæ¯é˜Ÿåˆ—çš„ç”Ÿäº§å’Œæ¶ˆè´¹è¿™ä¸¤ä¸ªæ ¸å¿ƒæµç¨‹ï¼Œåœ¨å¤§éƒ¨åˆ†æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œå®ƒå®ç°çš„ä¸»è¦æµç¨‹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ï¼Œé€šè¿‡è¿™ä¸¤èŠ‚è¯¾çš„å­¦ä¹ ä¹‹åï¼ŒæŒæ¡äº†è¿™ä¸¤ä¸ªæµç¨‹çš„å®ç°è¿‡ç¨‹ã€‚æ— è®ºä½ ä½¿ç”¨çš„æ˜¯å“ªç§æ¶ˆæ¯é˜Ÿåˆ—ï¼Œé‡åˆ°æ”¶å‘æ¶ˆæ¯çš„é—®é¢˜ï¼Œä½ éƒ½å¯ä»¥ç”¨åŒæ ·çš„æ€è·¯å»åˆ†æå’Œè§£å†³é—®é¢˜ã€‚</p><p>ä¸Šä¸€èŠ‚è¯¾æˆ‘å’Œä½ ä¸€èµ·é€šè¿‡åˆ†ææºä»£ç å­¦ä¹ äº†RocketMQæ¶ˆæ¯ç”Ÿäº§çš„å®ç°è¿‡ç¨‹ï¼Œæœ¬èŠ‚è¯¾æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹Kafkaæ¶ˆè´¹è€…çš„æºä»£ç ï¼Œç†æ¸…Kafkaæ¶ˆè´¹çš„å®ç°è¿‡ç¨‹ï¼Œå¹¶ä¸”èƒ½ä»ä¸­å­¦ä¹ åˆ°ä¸€äº›Kafkaçš„ä¼˜ç§€è®¾è®¡æ€è·¯å’Œç¼–ç æŠ€å·§ã€‚</p><p>åœ¨å¼€å§‹åˆ†ææºç ä¹‹å‰ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥å›é¡¾ä¸€ä¸‹Kafkaæ¶ˆè´¹æ¨¡å‹çš„å‡ ä¸ªè¦ç‚¹ï¼š</p><ul>\n<li>Kafkaçš„æ¯ä¸ªConsumerï¼ˆæ¶ˆè´¹è€…ï¼‰å®ä¾‹å±äºä¸€ä¸ªConsumerGroupï¼ˆæ¶ˆè´¹ç»„ï¼‰ï¼›</li>\n<li>åœ¨æ¶ˆè´¹æ—¶ï¼ŒConsumerGroupä¸­çš„æ¯ä¸ªConsumerç‹¬å ä¸€ä¸ªæˆ–å¤šä¸ªPartitionï¼ˆåˆ†åŒºï¼‰ï¼›</li>\n<li>å¯¹äºæ¯ä¸ªConsumerGroupï¼Œåœ¨ä»»æ„æ—¶åˆ»ï¼Œæ¯ä¸ªPartitionè‡³å¤šæœ‰1ä¸ªConsumeråœ¨æ¶ˆè´¹ï¼›</li>\n<li>æ¯ä¸ªConsumerGroupéƒ½æœ‰ä¸€ä¸ªCoordinator(åè°ƒè€…ï¼‰è´Ÿè´£åˆ†é…Consumerå’ŒPartitionçš„å¯¹åº”å…³ç³»ï¼Œå½“Partitionæˆ–æ˜¯Consumerå‘ç”Ÿå˜æ›´æ—¶ï¼Œä¼šè§¦å‘rebalanceï¼ˆé‡æ–°åˆ†é…ï¼‰è¿‡ç¨‹ï¼Œé‡æ–°åˆ†é…Consumerä¸Partitionçš„å¯¹åº”å…³ç³»ï¼›</li>\n<li>Consumerç»´æŠ¤ä¸Coordinatorä¹‹é—´çš„å¿ƒè·³ï¼Œè¿™æ ·Coordinatorå°±èƒ½æ„ŸçŸ¥åˆ°Consumerçš„çŠ¶æ€ï¼Œåœ¨Consumeræ•…éšœçš„æ—¶å€™åŠæ—¶è§¦å‘rebalanceã€‚</li>\n</ul><!-- [[[read_end]]] --><p>æŒæ¡å¹¶ç†è§£Kafkaçš„æ¶ˆè´¹æ¨¡å‹ï¼Œå¯¹äºæ¥ä¸‹æ¥ç†è§£å…¶æ¶ˆè´¹çš„å®ç°è¿‡ç¨‹æ˜¯è‡³å…³é‡è¦çš„ï¼Œå¦‚æœä½ å¯¹ä¸Šé¢çš„è¿™äº›è¦ç‚¹è¿˜æœ‰ä¸æ¸…æ¥šçš„åœ°æ–¹ï¼Œå»ºè®®å›é¡¾ä¸€ä¸‹ä¹‹å‰çš„è¯¾ç¨‹æˆ–è€…çœ‹ä¸€ä¸‹Kafkaç›¸å…³çš„æ–‡æ¡£ï¼Œç„¶åå†ç»§ç»­æ¥ä¸‹æ¥çš„å†…å®¹ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨å½“å‰æœ€æ–°çš„ç‰ˆæœ¬2.2è¿›è¡Œåˆ†æï¼Œä½¿ç”¨Gitåœ¨GitHubä¸Šç›´æ¥ä¸‹è½½æºç åˆ°æœ¬åœ°ï¼š</p><pre><code>git clone git@github.com:apache/kafka.git\ncd kafka\ngit checkout 2.2\n</code></pre><p>åœ¨ã€Š<a href=\"https://time.geekbang.org/column/article/115519\">09 | å­¦ä¹ å¼€æºä»£ç è¯¥å¦‚ä½•å…¥æ‰‹ï¼Ÿ</a>ã€‹è¿™èŠ‚è¯¾ä¸­ï¼Œæˆ‘è®²è¿‡ï¼Œåˆ†æå›½å¤–æºç æœ€å¥½çš„æ–¹å¼å°±æ˜¯ä»æ–‡æ¡£å…¥æ‰‹ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ‰¾ä¸€ä¸‹Kafkaçš„æ–‡æ¡£ï¼Œçœ‹çœ‹ä»å“ªå„¿æ¥å…¥æ‰‹å¼€å¯æˆ‘ä»¬çš„åˆ†ææµç¨‹ã€‚</p><p>Kafkaçš„Consumerå…¥å£ç±»<a href=\"https://kafka.apache.org/10/javadoc/?org/apache/kafka/clients/consumer/KafkaConsumer.html\">KafkaConsumerçš„JavaDoc</a>ï¼Œç»™å‡ºäº†å…³äºå¦‚ä½•ä½¿ç”¨KafkaConsumeréå¸¸è¯¦ç»†çš„è¯´æ˜æ–‡æ¡£ï¼Œå¹¶ä¸”ç»™å‡ºäº†ä¸€ä¸ªä½¿ç”¨Consumeræ¶ˆè´¹çš„æœ€ç®€ä»£ç ç¤ºä¾‹ï¼š</p><pre><code>     // è®¾ç½®å¿…è¦çš„é…ç½®ä¿¡æ¯\n     Properties props = new Properties();\n     props.put(&quot;bootstrap.servers&quot;, &quot;localhost:9092&quot;);\n     props.put(&quot;group.id&quot;, &quot;test&quot;);\n     props.put(&quot;enable.auto.commit&quot;, &quot;true&quot;);\n     props.put(&quot;auto.commit.interval.ms&quot;, &quot;1000&quot;);\n     props.put(&quot;key.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);\n     props.put(&quot;value.deserializer&quot;, &quot;org.apache.kafka.common.serialization.StringDeserializer&quot;);\n\n     // åˆ›å»ºConsumerå®ä¾‹\n     KafkaConsumer&lt;String, String&gt; consumer = new KafkaConsumer&lt;&gt;(props);\n\n     // è®¢é˜…Topic\n     consumer.subscribe(Arrays.asList(&quot;foo&quot;, &quot;bar&quot;));\n\n     // å¾ªç¯æ‹‰æ¶ˆæ¯\n     while (true) {\n         ConsumerRecords&lt;String, String&gt; records = consumer.poll(100);\n         for (ConsumerRecord&lt;String, String&gt; record : records)\n             System.out.printf(&quot;offset = %d, key = %s, value = %s%n&quot;, record.offset(), record.key(), record.value());\n     }\n</code></pre><p>è¿™æ®µä»£ç ä¸»è¦çš„ä¸»è¦æµç¨‹æ˜¯ï¼š</p><ol>\n<li>è®¾ç½®å¿…è¦çš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼šèµ·å§‹è¿æ¥çš„Brokeråœ°å€ï¼ŒConsumer Groupçš„IDï¼Œè‡ªåŠ¨æäº¤æ¶ˆè´¹ä½ç½®çš„é…ç½®å’Œåºåˆ—åŒ–é…ç½®ï¼›</li>\n<li>åˆ›å»ºConsumerå®ä¾‹ï¼›</li>\n<li>è®¢é˜…äº†2ä¸ªTopicï¼šfoo å’Œ barï¼›</li>\n<li>å¾ªç¯æ‹‰å–æ¶ˆæ¯å¹¶æ‰“å°åœ¨æ§åˆ¶å°ä¸Šã€‚</li>\n</ol><p>é€šè¿‡ä¸Šé¢çš„ä»£ç å®ä¾‹æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ¶ˆè´¹è¿™ä¸ªå¤§çš„æµç¨‹ï¼Œåœ¨Kafkaä¸­å®é™…ä¸Šæ˜¯è¢«åˆ†æˆäº†â€œè®¢é˜…â€å’Œâ€œæ‹‰å–æ¶ˆæ¯â€è¿™ä¸¤ä¸ªå°çš„æµç¨‹ã€‚å¦å¤–ï¼Œæˆ‘åœ¨ä¹‹å‰çš„è¯¾ç¨‹ä¸­åå¤æåˆ°è¿‡ï¼ŒKafkaåœ¨æ¶ˆè´¹è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸ªConsumerå®ä¾‹æ˜¯ç»‘å®šåˆ°ä¸€ä¸ªåˆ†åŒºä¸Šçš„ï¼Œé‚£Consumeræ˜¯å¦‚ä½•ç¡®å®šï¼Œç»‘å®šåˆ°å“ªä¸€ä¸ªåˆ†åŒºä¸Šçš„å‘¢ï¼Ÿè¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡åˆ†ææ¶ˆè´¹æµç¨‹æ¥æ‰¾åˆ°ç­”æ¡ˆçš„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åˆ†ææ•´ä¸ªæ¶ˆè´¹æµç¨‹ä¸»è¦èšç„¦åœ¨ä¸‰ä¸ªé—®é¢˜ä¸Šï¼š</p><ol>\n<li>è®¢é˜…è¿‡ç¨‹æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</li>\n<li>Consumeræ˜¯å¦‚ä½•ä¸Coordinatoråå•†ï¼Œç¡®å®šæ¶ˆè´¹å“ªäº›Partitionçš„ï¼Ÿ</li>\n<li>æ‹‰å–æ¶ˆæ¯çš„è¿‡ç¨‹æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</li>\n</ol><p>äº†è§£å‰ä¸¤ä¸ªé—®é¢˜ï¼Œæœ‰åŠ©äºä½ å……åˆ†ç†è§£Kafkaçš„å…ƒæ•°æ®æ¨¡å‹ï¼Œä»¥åŠKafkaæ˜¯å¦‚ä½•åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´æ¥äº¤æ¢å…ƒæ•°æ®çš„ã€‚æœ€åä¸€ä¸ªé—®é¢˜ï¼Œæ‹‰å–æ¶ˆæ¯çš„å®ç°è¿‡ç¨‹ï¼Œå®é™…ä¸Šå°±æ˜¯æ¶ˆè´¹çš„ä¸»è¦æµç¨‹ï¼Œæˆ‘ä»¬ä¸ŠèŠ‚è¯¾è®²è¿‡ï¼Œè¿™æ˜¯æ¶ˆæ¯é˜Ÿåˆ—æœ€æ ¸å¿ƒçš„ä¸¤ä¸ªæµç¨‹ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯å¿…é¡»é‡ç‚¹æŒæ¡çš„ã€‚æˆ‘ä»¬å°±å¸¦ç€è¿™ä¸‰ä¸ªé—®é¢˜ï¼Œæ¥åˆ†æKafkaçš„è®¢é˜…å’Œæ‹‰å–æ¶ˆæ¯çš„è¿‡ç¨‹å¦‚ä½•å®ç°ã€‚</p><h2>è®¢é˜…è¿‡ç¨‹å¦‚ä½•å®ç°ï¼Ÿ</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è®¢é˜…çš„å®ç°æµç¨‹ã€‚ä»ä¸Šé¢çš„ä¾‹å­è·Ÿè¸ªåˆ°è®¢é˜…çš„ä¸»æµç¨‹æ–¹æ³•ï¼š</p><pre><code>  public void subscribe(Collection&lt;String&gt; topics, ConsumerRebalanceListener listener) {\n      acquireAndEnsureOpen();\n      try {\n          // çœç•¥éƒ¨åˆ†ä»£ç \n\n          // é‡ç½®è®¢é˜…çŠ¶æ€\n          this.subscriptions.subscribe(new HashSet&lt;&gt;(topics), listener);\n\n          // æ›´æ–°å…ƒæ•°æ®\n          metadata.setTopics(subscriptions.groupSubscription());\n      } finally {\n          release();\n      }\n  }\n</code></pre><p>åœ¨è¿™ä¸ªä»£ç ä¸­ï¼Œæˆ‘ä»¬å…ˆå¿½ç•¥æ‰å„ç§å‚æ•°å’ŒçŠ¶æ€æ£€æŸ¥çš„åˆ†æ”¯ä»£ç ï¼Œè®¢é˜…çš„ä¸»æµç¨‹ä¸»è¦æ›´æ–°äº†ä¸¤ä¸ªå±æ€§ï¼šä¸€ä¸ªæ˜¯è®¢é˜…çŠ¶æ€subscriptionsï¼Œå¦ä¸€ä¸ªæ˜¯æ›´æ–°å…ƒæ•°æ®ä¸­çš„topicä¿¡æ¯ã€‚è®¢é˜…çŠ¶æ€subscriptionsä¸»è¦ç»´æŠ¤äº†è®¢é˜…çš„topicå’Œpatitionçš„æ¶ˆè´¹ä½ç½®ç­‰çŠ¶æ€ä¿¡æ¯ã€‚å±æ€§metadataä¸­ç»´æŠ¤äº†Kafkaé›†ç¾¤å…ƒæ•°æ®çš„ä¸€ä¸ªå­é›†ï¼ŒåŒ…æ‹¬é›†ç¾¤çš„BrokerèŠ‚ç‚¹ã€Topicå’ŒPartitionåœ¨èŠ‚ç‚¹ä¸Šåˆ†å¸ƒï¼Œä»¥åŠæˆ‘ä»¬èšç„¦çš„ç¬¬äºŒä¸ªé—®é¢˜ï¼šCoordinatorç»™Consumeråˆ†é…çš„Partitionä¿¡æ¯ã€‚</p><p>è¯·æ³¨æ„ä¸€ä¸‹ï¼Œè¿™ä¸ªsubscribe()æ–¹æ³•çš„å®ç°æœ‰ä¸€ä¸ªéå¸¸å€¼å¾—å¤§å®¶å­¦ä¹ çš„åœ°æ–¹ï¼šå°±æ˜¯å¼€å§‹çš„acquireAndEnsureOpen()å’Œtry-finally release()ï¼Œä½œç”¨å°±æ˜¯ä¿æŠ¤è¿™ä¸ªæ–¹æ³•åªèƒ½å•çº¿ç¨‹è°ƒç”¨ã€‚</p><p>Kafkaåœ¨æ–‡æ¡£ä¸­æ˜ç¡®åœ°æ³¨æ˜äº†Consumerä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ„å‘³ç€Consumerè¢«å¹¶å‘è°ƒç”¨æ—¶ä¼šå‡ºç°ä¸å¯é¢„æœŸçš„ç»“æœã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µå‘ç”Ÿï¼ŒKafkaåšäº†ä¸»åŠ¨çš„æ£€æµ‹å¹¶æŠ›å‡ºå¼‚å¸¸ï¼Œè€Œä¸æ˜¯æ”¾ä»»ç³»ç»Ÿäº§ç”Ÿä¸å¯é¢„æœŸçš„æƒ…å†µã€‚</p><p>Kafkaâ€œ<strong>ä¸»åŠ¨æ£€æµ‹ä¸æ”¯æŒçš„æƒ…å†µå¹¶æŠ›å‡ºå¼‚å¸¸ï¼Œé¿å…ç³»ç»Ÿäº§ç”Ÿä¸å¯é¢„æœŸçš„è¡Œä¸º</strong>â€è¿™ç§æ¨¡å¼ï¼Œå¯¹äºå¢å¼ºçš„ç³»ç»Ÿçš„å¥å£®æ€§æ˜¯ä¸€ç§éå¸¸æœ‰æ•ˆçš„åšæ³•ã€‚å¦‚æœä½ çš„ç³»ç»Ÿä¸æ”¯æŒç”¨æˆ·çš„æŸç§æ“ä½œï¼Œæ­£ç¡®çš„åšæ³•æ˜¯ï¼Œæ£€æµ‹ä¸æ”¯æŒçš„æ“ä½œï¼Œç›´æ¥æ‹’ç»ç”¨æˆ·æ“ä½œï¼Œå¹¶ç»™å‡ºæ˜ç¡®çš„é”™è¯¯æç¤ºï¼Œè€Œä¸åº”è¯¥åªæ˜¯åœ¨æ–‡æ¡£ä¸­å†™ä¸Šâ€œä¸è¦è¿™æ ·åšâ€ï¼Œå´æ”¾ä»»ç”¨æˆ·é”™è¯¯çš„æ“ä½œï¼Œäº§ç”Ÿä¸€äº›ä¸å¯é¢„æœŸçš„ã€å¥‡æ€ªçš„é”™è¯¯ç»“æœã€‚</p><p>å…·ä½“Kafkaæ˜¯å¦‚ä½•å®ç°çš„å¹¶å‘æ£€æµ‹ï¼Œå¤§å®¶å¯ä»¥çœ‹ä¸€ä¸‹æ–¹æ³•acquireAndEnsureOpen()çš„å®ç°ï¼Œå¾ˆç®€å•ä¹Ÿå¾ˆç»å…¸ï¼Œæˆ‘ä»¬å°±ä¸å†å±•å¼€è®²è§£äº†ã€‚</p><p>ç»§ç»­è·Ÿè¿›åˆ°æ›´æ–°å…ƒæ•°æ®çš„æ–¹æ³•metadata.setTopics()é‡Œé¢ï¼Œè¿™ä¸ªæ–¹æ³•çš„å®ç°é™¤äº†æ›´æ–°å…ƒæ•°æ®ç±»Metadataä¸­çš„topicç›¸å…³çš„ä¸€äº›å±æ€§ä»¥å¤–ï¼Œè¿˜è°ƒç”¨äº†Metadata.requestUpdate()æ–¹æ³•è¯·æ±‚æ›´æ–°å…ƒæ•°æ®ã€‚</p><pre><code>    public synchronized int requestUpdate() {\n        this.needUpdate = true;\n        return this.updateVersion;\n    }\n</code></pre><p>è·Ÿè¿›åˆ°requestUpdate()çš„æ–¹æ³•é‡Œé¢æˆ‘ä»¬ä¼šå‘ç°ï¼Œè¿™é‡Œé¢å¹¶æ²¡æœ‰çœŸæ­£å‘é€æ›´æ–°å…ƒæ•°æ®çš„è¯·æ±‚ï¼Œåªæ˜¯å°†éœ€è¦æ›´æ–°å…ƒæ•°æ®çš„æ ‡å¿—ä½needUpdateè®¾ç½®ä¸ºtrueå°±ç»“æŸäº†ã€‚Kafkaå¿…é¡»ç¡®ä¿åœ¨ç¬¬ä¸€æ¬¡æ‹‰æ¶ˆæ¯ä¹‹å‰å…ƒæ•°æ®æ˜¯å¯ç”¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨ç¬¬ä¸€æ¬¡æ‹‰æ¶ˆæ¯ä¹‹å‰å¿…é¡»æ›´æ–°ä¸€æ¬¡å…ƒæ•°æ®ï¼Œå¦åˆ™Consumerå°±ä¸çŸ¥é“å®ƒåº”è¯¥å»å“ªä¸ªBrokerä¸Šå»æ‹‰å“ªä¸ªPartitionçš„æ¶ˆæ¯ã€‚</p><p>åˆ†æå®Œè®¢é˜…ç›¸å…³çš„ä»£ç ï¼Œæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ï¼šåœ¨è®¢é˜…çš„å®ç°è¿‡ç¨‹ä¸­ï¼ŒKafkaæ›´æ–°äº†è®¢é˜…çŠ¶æ€subscriptionså’Œå…ƒæ•°æ®metadataä¸­çš„ç›¸å…³topicçš„ä¸€äº›å±æ€§ï¼Œå°†å…ƒæ•°æ®çŠ¶æ€ç½®ä¸ºâ€œéœ€è¦ç«‹å³æ›´æ–°â€ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰çœŸæ­£å‘é€æ›´æ–°å…ƒæ•°æ®çš„è¯·æ±‚ï¼Œæ•´ä¸ªè¿‡ç¨‹æ²¡æœ‰å’Œé›†ç¾¤æœ‰ä»»ä½•ç½‘ç»œæ•°æ®äº¤æ¢ã€‚</p><p>é‚£è¿™ä¸ªå…ƒæ•°æ®ä¼šåœ¨ä»€ä¹ˆæ—¶å€™çœŸæ­£åšä¸€æ¬¡æ›´æ–°å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å…ˆå¸¦ç€è¿™ä¸ªé—®é¢˜æ¥ç€çœ‹ä»£ç ã€‚</p><h2>æ‹‰å–æ¶ˆæ¯çš„è¿‡ç¨‹å¦‚ä½•å®ç°ï¼Ÿ</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ†ææ‹‰å–æ¶ˆæ¯çš„æµç¨‹ã€‚è¿™ä¸ªæµç¨‹çš„æ—¶åºå›¾å¦‚ä¸‹ï¼ˆç‚¹å‡»å›¾ç‰‡å¯æ”¾å¤§æŸ¥çœ‹ï¼‰ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/4b/96/4be9e6aa9890e66bc4e26f0c318f8d96.png?wh=996*473\" alt=\"\"></p><p>æˆ‘ä»¬å¯¹ç€æ—¶åºå›¾æ¥åˆ†æå®ƒçš„å®ç°æµç¨‹ã€‚åœ¨KafkaConsumer.poll()æ–¹æ³•(å¯¹åº”æºç 1179è¡Œ)çš„å®ç°é‡Œé¢ï¼Œå¯ä»¥çœ‹åˆ°ä¸»è¦æ˜¯å…ˆåè°ƒç”¨äº†2ä¸ªç§æœ‰æ–¹æ³•ï¼š</p><ol>\n<li>updateAssignmentMetadataIfNeeded(): æ›´æ–°å…ƒæ•°æ®ã€‚</li>\n<li>pollForFetches()ï¼šæ‹‰å–æ¶ˆæ¯ã€‚</li>\n</ol><p>æ–¹æ³•updateAssignmentMetadataIfNeeded()ä¸­ï¼Œè°ƒç”¨äº†coordinator.poll()æ–¹æ³•ï¼Œpoll()æ–¹æ³•é‡Œé¢åˆè°ƒç”¨äº†client.ensureFreshMetadata()æ–¹æ³•ï¼Œåœ¨client.ensureFreshMetadata()æ–¹æ³•ä¸­åˆè°ƒç”¨äº†client.poll()æ–¹æ³•ï¼Œå®ç°äº†ä¸Clusteré€šä¿¡ï¼Œåœ¨Coordinatorä¸Šæ³¨å†ŒConsumerå¹¶æ‹‰å–å’Œæ›´æ–°å…ƒæ•°æ®ã€‚è‡³æ­¤ï¼Œâ€œå…ƒæ•°æ®ä¼šåœ¨ä»€ä¹ˆæ—¶å€™çœŸæ­£åšä¸€æ¬¡æ›´æ–°â€è¿™ä¸ªé—®é¢˜ä¹Ÿæœ‰äº†ç­”æ¡ˆã€‚</p><p>ç±»ConsumerNetworkClientå°è£…äº†Consumerå’ŒClusterä¹‹é—´æ‰€æœ‰çš„ç½‘ç»œé€šä¿¡çš„å®ç°ï¼Œè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªéå¸¸å½»åº•çš„å¼‚æ­¥å®ç°ã€‚å®ƒæ²¡æœ‰ç»´æŠ¤ä»»ä½•çš„çº¿ç¨‹ï¼Œæ‰€æœ‰å¾…å‘é€çš„Requestéƒ½å­˜æ”¾åœ¨å±æ€§unsentä¸­ï¼Œè¿”å›çš„Responseå­˜æ”¾åœ¨å±æ€§pendingCompletionä¸­ã€‚æ¯æ¬¡è°ƒç”¨poll()æ–¹æ³•çš„æ—¶å€™ï¼Œåœ¨å½“å‰çº¿ç¨‹ä¸­å‘é€æ‰€æœ‰å¾…å‘é€çš„Requestï¼Œå¤„ç†æ‰€æœ‰æ”¶åˆ°çš„Responseã€‚</p><p>æˆ‘ä»¬åœ¨ä¹‹å‰çš„è¯¾ç¨‹ä¸­è®²åˆ°è¿‡ï¼Œè¿™ç§å¼‚æ­¥è®¾è®¡çš„ä¼˜åŠ¿å°±æ˜¯ç”¨å¾ˆå°‘çš„çº¿ç¨‹å®ç°é«˜ååé‡ï¼ŒåŠ£åŠ¿ä¹Ÿéå¸¸æ˜æ˜¾ï¼Œæå¤§å¢åŠ äº†ä»£ç çš„å¤æ‚åº¦ã€‚å¯¹æ¯”ä¸ŠèŠ‚è¯¾æˆ‘ä»¬åˆ†æçš„RocketMQçš„ä»£ç ï¼ŒProducerå’ŒConsumeråœ¨ä¸»è¦æ”¶å‘æ¶ˆæ¯æµç¨‹ä¸ŠåŠŸèƒ½çš„å¤æ‚åº¦æ˜¯å·®ä¸å¤šçš„ï¼Œä½†æ˜¯ä½ å¯ä»¥å¾ˆæ˜æ˜¾åœ°æ„Ÿå—åˆ°Kafkaçš„ä»£ç å®ç°è¦æ¯”RocketMQçš„ä»£ç å®ç°æ›´åŠ çš„å¤æ‚éš¾äºç†è§£ã€‚</p><p>æˆ‘ä»¬ç»§ç»­åˆ†ææ–¹æ³•pollForFetches()çš„å®ç°ã€‚</p><pre><code>    private Map&lt;TopicPartition, List&lt;ConsumerRecord&lt;K, V&gt;&gt;&gt; pollForFetches(Timer timer) {\n        // çœç•¥éƒ¨åˆ†ä»£ç \n        // å¦‚æœç¼“å­˜é‡Œé¢æœ‰æœªè¯»å–çš„æ¶ˆæ¯ï¼Œç›´æ¥è¿”å›è¿™äº›æ¶ˆæ¯\n        final Map&lt;TopicPartition, List&lt;ConsumerRecord&lt;K, V&gt;&gt;&gt; records = fetcher.fetchedRecords();\n        if (!records.isEmpty()) {\n            return records;\n        }\n        // æ„é€ æ‹‰å–æ¶ˆæ¯è¯·æ±‚ï¼Œå¹¶å‘é€\n        fetcher.sendFetches();\n        // çœç•¥éƒ¨åˆ†ä»£ç \n        // å‘é€ç½‘ç»œè¯·æ±‚æ‹‰å–æ¶ˆæ¯ï¼Œç­‰å¾…ç›´åˆ°æœ‰æ¶ˆæ¯è¿”å›æˆ–è€…è¶…æ—¶\n        client.poll(pollTimer, () -&gt; {\n            return !fetcher.hasCompletedFetches();\n        });\n        // çœç•¥éƒ¨åˆ†ä»£ç \n        // è¿”å›æ‹‰åˆ°çš„æ¶ˆæ¯\n        return fetcher.fetchedRecords();\n    }\n</code></pre><p>è¿™æ®µä»£ç çš„ä¸»è¦å®ç°é€»è¾‘æ˜¯ï¼š</p><ol>\n<li>å¦‚æœç¼“å­˜é‡Œé¢æœ‰æœªè¯»å–çš„æ¶ˆæ¯ï¼Œç›´æ¥è¿”å›è¿™äº›æ¶ˆæ¯ï¼›</li>\n<li>æ„é€ æ‹‰å–æ¶ˆæ¯è¯·æ±‚ï¼Œå¹¶å‘é€ï¼›</li>\n<li>å‘é€ç½‘ç»œè¯·æ±‚å¹¶æ‹‰å–æ¶ˆæ¯ï¼Œç­‰å¾…ç›´åˆ°æœ‰æ¶ˆæ¯è¿”å›æˆ–è€…è¶…æ—¶ï¼›</li>\n<li>è¿”å›æ‹‰åˆ°çš„æ¶ˆæ¯ã€‚</li>\n</ol><p>åœ¨æ–¹æ³•fetcher.sendFetches()çš„å®ç°é‡Œé¢ï¼ŒKafkaæ ¹æ®å…ƒæ•°æ®çš„ä¿¡æ¯ï¼Œæ„é€ åˆ°æ‰€æœ‰éœ€è¦çš„Brokerçš„æ‹‰æ¶ˆæ¯çš„Requestï¼Œç„¶åè°ƒç”¨client.Send()æ–¹æ³•å°†è¿™äº›è¯·æ±‚å¼‚æ­¥å‘é€å‡ºå»ã€‚å¹¶ä¸”ï¼Œæ³¨å†Œäº†ä¸€ä¸ªå›è°ƒç±»æ¥å¤„ç†è¿”å›çš„Responseï¼Œæ‰€æœ‰è¿”å›çš„Responseè¢«æš‚æ—¶å­˜æ”¾åœ¨Fetcher.completedFetchesä¸­ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™æ—¶çš„Requestå¹¶æ²¡æœ‰è¢«çœŸæ­£å‘ç»™å„ä¸ªBrokerï¼Œè€Œæ˜¯è¢«æš‚å­˜åœ¨äº†client.unsendä¸­ç­‰å¾…è¢«å‘é€ã€‚</p><p>ç„¶åï¼Œåœ¨è°ƒç”¨client.poll()æ–¹æ³•æ—¶ï¼Œä¼šçœŸæ­£å°†ä¹‹å‰æ„é€ çš„æ‰€æœ‰Requestå‘é€å‡ºå»ï¼Œå¹¶å¤„ç†æ”¶åˆ°çš„Responseã€‚</p><p>æœ€åï¼Œfetcher.fetchedRecords()æ–¹æ³•ä¸­ï¼Œå°†è¿”å›çš„Responseååºåˆ—åŒ–åè½¬æ¢ä¸ºæ¶ˆæ¯åˆ—è¡¨ï¼Œè¿”å›ç»™è°ƒç”¨è€…ã€‚</p><p>ç»¼åˆä¸Šé¢çš„å®ç°åˆ†æï¼Œæˆ‘åœ¨è¿™é‡Œç»™å‡ºæ•´ä¸ªæ‹‰å–æ¶ˆæ¯çš„æµç¨‹æ¶‰åŠåˆ°çš„ç›¸å…³ç±»çš„ç±»å›¾ï¼Œåœ¨è¿™ä¸ªç±»å›¾ä¸­ï¼Œä¸ºäº†ä¾¿äºä½ ç†è§£ï¼Œæˆ‘å¹¶æ²¡æœ‰æŠŠæ‰€æœ‰ç±»éƒ½ç»˜åˆ¶ä¸Šå»ï¼Œåªæ˜¯æŠŠæœ¬èŠ‚è¯¾ä¸¤ä¸ªæµç¨‹ç›¸å…³çš„ä¸»è¦ç±»å’Œè¿™äº›ç±»é‡Œçš„å…³é”®å±æ€§ç”»åœ¨äº†å›¾ä¸­ã€‚ä½ å¯ä»¥é…åˆè¿™ä¸ªç±»å›¾å’Œä¸Šé¢çš„æ—¶åºå›¾è¿›è¡Œä»£ç é˜…è¯»ã€‚</p><p>ç±»å›¾ï¼ˆç‚¹å‡»å›¾ç‰‡å¯æ”¾å¤§æŸ¥çœ‹ï¼‰ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/7b/a2/7b9e26b50308a377c62e741f844c0fa2.png?wh=1215*439\" alt=\"\"></p><h2>å°ç»“</h2><p>æœ¬èŠ‚è¯¾æˆ‘ä»¬ä¸€èµ·åˆ†æäº†Kafka Consumeræ¶ˆè´¹æ¶ˆæ¯çš„å®ç°è¿‡ç¨‹ã€‚å¤§å®¶æ¥åˆ†æä»£ç è¿‡ç¨‹ä¸­ï¼Œä¸ä»…ä»…æ˜¯è¦æŒæ¡Kafkaæ•´ä¸ªæ¶ˆè´¹çš„æµç¨‹æ˜¯æ˜¯å¦‚ä½•å®ç°çš„ï¼Œæ›´é‡è¦çš„æ˜¯ç†è§£å®ƒè¿™ç§å®Œå…¨å¼‚æ­¥çš„è®¾è®¡æ€æƒ³ã€‚</p><p>å‘é€è¯·æ±‚æ—¶ï¼Œæ„å»ºRequestå¯¹è±¡ï¼Œæš‚å­˜å…¥å‘é€é˜Ÿåˆ—ï¼Œä½†ä¸ç«‹å³å‘é€ï¼Œè€Œæ˜¯ç­‰å¾…åˆé€‚çš„æ—¶æœºæ‰¹é‡å‘é€ã€‚å¹¶ä¸”ï¼Œç”¨å›è°ƒæˆ–è€…RequestFeutureæ–¹å¼ï¼Œé¢„å…ˆå®šä¹‰å¥½å¦‚ä½•å¤„ç†å“åº”çš„é€»è¾‘ã€‚åœ¨æ”¶åˆ°Brokerè¿”å›çš„å“åº”ä¹‹åï¼Œä¹Ÿä¸ä¼šç«‹å³å¤„ç†ï¼Œè€Œæ˜¯æš‚å­˜åœ¨é˜Ÿåˆ—ä¸­ï¼Œæ‹©æœºå¤„ç†ã€‚é‚£è¿™ä¸ªæ‹©æœºç­–ç•¥å°±æ¯”è¾ƒå¤æ‚äº†ï¼Œæœ‰å¯èƒ½æ˜¯éœ€è¦è¯»å–å“åº”çš„æ—¶å€™ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ç¼“å†²åŒºæ»¡äº†æˆ–æ˜¯æ—¶é—´åˆ°äº†ï¼Œéƒ½æœ‰å¯èƒ½è§¦å‘ä¸€æ¬¡çœŸæ­£çš„ç½‘ç»œè¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯åœ¨poll()æ–¹æ³•ä¸­å‘é€æ‰€æœ‰å¾…å‘é€Requestå¹¶å¤„ç†æ‰€æœ‰Responseã€‚</p><p>è¿™ç§è®¾è®¡çš„å¥½å¤„æ˜¯ï¼Œä¸éœ€è¦ç»´æŠ¤ç”¨äºå¼‚æ­¥å‘é€çš„å’Œå¤„ç†å“åº”çš„çº¿ç¨‹ï¼Œå¹¶ä¸”èƒ½å……åˆ†å‘æŒ¥æ‰¹é‡å¤„ç†çš„ä¼˜åŠ¿ï¼Œè¿™ä¹Ÿæ˜¯Kafkaçš„æ€§èƒ½éå¸¸å¥½çš„åŸå› ä¹‹ä¸€ã€‚è¿™ç§è®¾è®¡çš„ç¼ºç‚¹ä¹Ÿéå¸¸çš„æ˜æ˜¾ï¼Œå°±æ˜¯å®ç°çš„å¤æ‚åº¦å¤ªå¤§äº†ï¼Œå¦‚æœæ²¡æœ‰æ·±åšçš„ä»£ç åŠŸåŠ›ï¼Œå¾ˆéš¾é©¾é©­è¿™ä¹ˆå¤æ‚çš„è®¾è®¡ï¼Œå¹¶ä¸”åç»­ç»´æŠ¤çš„æˆæœ¬ä¹Ÿå¾ˆé«˜ã€‚</p><p>æ€»ä½“æ¥è¯´ï¼Œä¸æ¨èå¤§å®¶æŠŠä»£ç è®¾è®¡å¾—è¿™ä¹ˆå¤æ‚ã€‚ä»£ç ç»“æ„ç®€å•ã€æ¸…æ™°ã€æ˜“ç»´æŠ¤æ˜¯æ˜¯æˆ‘ä»¬åœ¨è®¾è®¡è¿‡ç¨‹ä¸­éœ€è¦è€ƒè™‘çš„ä¸€ä¸ªéå¸¸é‡è¦çš„å› ç´ ã€‚å¾ˆå¤šæ—¶å€™ï¼Œä¸ºäº†è·å¾—è¾ƒå¥½çš„ä»£ç ç»“æ„ï¼Œåœ¨å¯æ¥å—çš„èŒƒå›´å†…ï¼Œå»ç‰ºç‰²ä¸€äº›æ€§èƒ½ï¼Œä¹Ÿæ˜¯åˆ’ç®—çš„ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æˆ‘ä»¬çŸ¥é“ï¼ŒKafka Consumeråœ¨æ¶ˆè´¹è¿‡ç¨‹ä¸­æ˜¯éœ€è¦ç»´æŠ¤æ¶ˆè´¹ä½ç½®çš„ï¼ŒConsumeræ¯æ¬¡ä»å½“å‰æ¶ˆè´¹ä½ç½®æ‹‰å–ä¸€æ‰¹æ¶ˆæ¯ï¼Œè¿™äº›æ¶ˆæ¯éƒ½è¢«æ­£å¸¸æ¶ˆè´¹åï¼ŒConsumerä¼šç»™Coordinatorå‘ä¸€ä¸ªæäº¤ä½ç½®çš„è¯·æ±‚ï¼Œç„¶åæ¶ˆè´¹ä½ç½®ä¼šå‘åç§»åŠ¨ï¼Œå®Œæˆä¸€æ‰¹æ¶ˆè´¹è¿‡ç¨‹ã€‚é‚£kafka Consumeræ˜¯å¦‚ä½•ç»´æŠ¤å’Œæäº¤è¿™ä¸ªæ¶ˆè´¹ä½ç½®çš„å‘¢ï¼Ÿè¯·ä½ å¸¦ç€è¿™ä¸ªé—®é¢˜å†å›é¡¾ä¸€ä¸‹Consumerçš„ä»£ç ï¼Œå°è¯•ç‹¬ç«‹åˆ†æä»£ç å¹¶æ‰¾åˆ°ç­”æ¡ˆã€‚æ¬¢è¿åœ¨ç•™è¨€åŒºä¸æˆ‘åˆ†äº«è®¨è®ºã€‚</p><p>æ„Ÿè°¢é˜…è¯»ï¼Œå¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰ä¸€äº›å¯å‘ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚</p><p></p>","neighbors":{"left":{"article_title":"20 | RocketMQ Produceræºç åˆ†æï¼šæ¶ˆæ¯ç”Ÿäº§çš„å®ç°è¿‡ç¨‹","id":132889},"right":{"article_title":"22 | Kafkaå’ŒRocketMQçš„æ¶ˆæ¯å¤åˆ¶å®ç°çš„å·®å¼‚ç‚¹åœ¨å“ªï¼Ÿ","id":136030}},"comments":[{"had_liked":false,"id":132825,"user_name":"ä¸šä½™è‰","can_delete":false,"product_type":"c1","uid":1126538,"ip_address":"","ucode":"99BDC1E629049D","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/8a/b5ca7286.jpg","comment_is_top":false,"comment_ctime":1568248396,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"194841776716","product_id":100032301,"comment_content":"æˆ‘ä»¬éœ€è¦ä¸€äº›é€Ÿæˆçš„å®æˆ˜ç»éªŒï¼Œæ¯”å¦‚æ¶ˆæ¯é˜Ÿåˆ—çªç„¶å»¶è¿Ÿ2ä¸ªå°æ—¶è¯¥å¦‚ä½•è§£å†³ï¼Ÿ<br>å¸Œæœ›å¸¦ç€è¿™äº›ç±»ä¼¼çš„é—®é¢˜ï¼Œç»“åˆè®¾è®¡åŸç†ï¼Œå¸®åŠ©æˆ‘ä»¬å±‚å±‚è§£æã€‚ã€‚ã€‚","like_count":46,"discussions":[{"author":{"id":1393856,"avatar":"https://static001.geekbang.org/account/avatar/00/15/44/c0/a39672a3.jpg","nickname":"ç‹è€…ä¹‹é’»","note":"","ucode":"D877B496829D1A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":330743,"discussion_content":"å“ˆå“ˆï¼Œåæ‚”äº†å§ï¼Œè¿™ä¸ªè¯¾ç¨‹æ ‡é¢˜èµ·çš„ç‰›é€¼ï¼Œå†…å®¹è¿‡äºå½¢å¼è‚¤æµ…ï¼Œ","likes_number":9,"is_delete":false,"is_hidden":false,"ctime":1606701945,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2293684,"avatar":"","nickname":"Geek_1d0a96","note":"","ucode":"C2B4D608DB6B12","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1393856,"avatar":"https://static001.geekbang.org/account/avatar/00/15/44/c0/a39672a3.jpg","nickname":"ç‹è€…ä¹‹é’»","note":"","ucode":"D877B496829D1A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":353074,"discussion_content":"ç¬¬ä¸€ç¯‡è¯´å®è¯è¿˜ä¸é”™ï¼Œåé¢å…¨ç¨‹ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¦è®²è¿™ä¹ˆå¹¶å‘ã€ç½‘ç»œã€æ“ä½œç³»ç»Ÿçš„ä¸œè¥¿","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1614995241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":330743,"ip_address":""},"score":353074,"extra":""}]},{"author":{"id":1204168,"avatar":"https://static001.geekbang.org/account/avatar/00/12/5f/c8/13aa8aa9.jpg","nickname":"night","note":"","ucode":"03B3C955092C03","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":531540,"discussion_content":"éä¹Ÿéä¹Ÿï¼Œä¸€åˆ‡é€Ÿæˆçš„ä¸œè¥¿éƒ½åº”è¯¥è­¦æƒ•ï¼Œæ¬ çš„å†…åŠŸå­¦è´¹æ€»æ˜¯è¦äº¤çš„ï¼Œæ ¸å¿ƒåŸç† + æ•´ä½“è®¾è®¡ + å…³é”®å·¥ç¨‹ç»†èŠ‚ æ˜ç™½äº†ï¼Œåˆ™ä¸€åˆ‡æ•…éšœäº‹æ•…éƒ½æ˜¯çº¸è€è™ ","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1637331935,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2462393,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/BKusySicUz9ppf2aZCxe5jMMX2aI8o6kHRRQibFosGEZf7zNFue9OcTsmuicOHOBicZ404Z522AgrTlJa3gSW9AL8w/132","nickname":"Geek_a5453a","note":"","ucode":"993DF63E38059D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":355127,"discussion_content":"è¿™æ ‡é¢˜å…šã€‚çœŸçš„æ˜¯ä¸¥é‡ä¸è¾¾æ ‡çš„è¯¾ç¨‹","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1615384615,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1488243,"avatar":"https://static001.geekbang.org/account/avatar/00/16/b5/73/15a8006a.jpg","nickname":"goxdev","note":"","ucode":"7374587CD08BEE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":395941,"discussion_content":"ç»™ä½ ä¸€äº›é€Ÿæˆçš„ç»éªŒï¼Œä»¥åå¦‚æœé‡åˆ°å…¶ä»–çš„é—®é¢˜ï¼Œä½ ç»™ä½ çš„leaderè¯´è€å¸ˆä»¥å‰æ²¡è®²å•Šï¼Œè§£ä¸äº†ã€‚ å“ˆå“ˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632365379,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":146598,"user_name":"Peter","can_delete":false,"product_type":"c1","uid":1595382,"ip_address":"","ucode":"A77322C4E07B2D","user_header":"https://static001.geekbang.org/account/avatar/00/18/57/f6/2c7ac1ad.jpg","comment_is_top":false,"comment_ctime":1572578439,"is_pvip":false,"replies":[{"id":"56817","content":"ç»†è‡´ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":146598,"uid":"1501046","ip_address":"","utype":1,"ctime":1572830345,"user_name_real":"æç¥"}],"discussion_count":2,"race_medal":0,"score":"91766891655","product_id":100032301,"comment_content":"è¯¾åä½œä¸šï¼Œå¸Œæœ›è€å¸ˆæŒ‡æ­£ã€‚<br>åœ¨åŸºç¡€ç¯‡03çš„æ—¶å€™è®²è¿‡æ¶ˆè´¹ä½ç½®æ˜¯æ¶ˆæ¯é˜Ÿåˆ—æœåŠ¡å™¨é’ˆå¯¹æ¯ä¸ªæ¶ˆè´¹ç»„å’Œæ¯ä¸ªé˜Ÿåˆ—ç»´æŠ¤çš„ä¸€ä¸ªä½ç½®å˜é‡ã€‚é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´æœ€ç»ˆçœŸæ­£æ›´æ–°è¿™ä¸ªä½ç½®å˜é‡åº”è¯¥æ˜¯äº¤ç”±æœåŠ¡å™¨å»æ‰§è¡Œçš„ï¼Œè€ŒConsumeråªæ˜¯å‘é€ä¸€ä¸ªè¯·æ±‚ã€‚é‚£ä¹ˆé¡ºç€è¿™ä¸ªæ€è·¯ï¼Œæˆ‘çŒœåº”è¯¥æ˜¯åœ¨æ›´æ–°å…ƒæ•°æ®çš„æ—¶å€™å°±åº”è¯¥å‘é€è¿™ä¸ªè¯·æ±‚ï¼ŒåŸå› å¾ˆç®€å•ï¼šæ¶ˆè´¹è€…éœ€è¦çŸ¥é“â€œä»å“ªå‘èµ·â€å¹¶ä¸”â€œå‘å¤šå°‘â€ï¼Œå› æ­¤è¿™æ—¶å°±å·²ç»çŸ¥é“äº†åº”è¯¥å°†æ¶ˆè´¹ä½ç½®æ›´æ–°ä¸ºå¤šå°‘äº†ï¼Œæ‰€ä»¥è¿™æ—¶å€™å°±å¯ä»¥å‘é€è¿™ä¸ªè¯·æ±‚äº†ã€‚è‡³äºæœåŠ¡å™¨æœ€ç»ˆä¼šå°†æ¶ˆè´¹ä½ç½®æ›´æ–°ä¸ºå¤šå°‘ï¼Œè¿˜å–å†³äºå®¢æˆ·ç«¯è¿”å›çš„ç»“æœã€‚<br>åœ¨æ–¹æ³•updateAssignmentMetadataIfNeededä¸­ï¼Œæœ€åä¸€è¡Œreturn updateFetchPositions(timer);<br>ä»updateFetchPositionsè¿™ä¸ªæ–¹æ³•ç‚¹è¿›å»ï¼Œçœ‹åˆ°coordinator.refreshCommittedOffsetsIfNeeded(timer)<br>è¿™ä¸ªæ–¹æ³•ç‚¹è¿›å»ä¹‹åä¼šçœ‹åˆ°fetchCommittedOffsetsæ–¹æ³•ï¼Œè¿›è¿™ä¸ªæ–¹æ³•ï¼Œæ‰¾åˆ°sendOffsetFetchRequestï¼Œç‚¹è¿›å»ï¼Œæœ€ç»ˆä¼šå‘ç°  client.send(coordinator, requestBuilder)","like_count":21,"discussions":[{"author":{"id":1501046,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","nickname":"æç¥","note":"","ucode":"B19E91EE248591","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472934,"discussion_content":"ç»†è‡´ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572830345,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1439353,"avatar":"https://static001.geekbang.org/account/avatar/00/15/f6/79/43fc66d3.jpg","nickname":"wesley","note":"","ucode":"102E5F24FE7EBD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308404,"discussion_content":"ä½†æ˜¯ä»æˆ‘ä¸ªäººçš„ç†è§£ï¼Œoffsetæ˜¯å¿…é¡»ç”±æ¶ˆè´¹è€…æ¶ˆè´¹å®Œæˆåï¼Œcommitçš„æ—¶å€™å‘Šè¯‰æœåŠ¡å™¨è¿™ä¸ªæ¶ˆæ¯æˆ‘å·²ç»æ¶ˆè´¹å®Œäº†ï¼Œä¸ªäººæ„Ÿè§‰åº”è¯¥è¿™ä¸ªæ—¶å€™å†è¿›è¡Œoffsetçš„æ›´æ–°\n\nä»ä»£ç é‡Œçœ‹ï¼ŒKafkaConsumer#commitSync(java.time.Duration) é‡Œå°±æœ‰ coordinator.commitOffsetsSync(subscriptions.allConsumed(), time.timer(timeout)) çš„è¯­å¥  ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1600940244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":133860,"user_name":"DFighting","can_delete":false,"product_type":"c1","uid":1233193,"ip_address":"","ucode":"F3BA2426FF8582","user_header":"https://static001.geekbang.org/account/avatar/00/12/d1/29/1b1234ed.jpg","comment_is_top":false,"comment_ctime":1568685024,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"35928423392","product_id":100032301,"comment_content":"offsetçš„æäº¤ä¸çŸ¥é“æ˜¯ä¸æ˜¯åœ¨kafkaConsumer.commitAsyncä¸­è°ƒç”¨coordinator.commitOffsetsAsync(offsets,callback)<br>1ã€è¿™é‡Œè®¾è®¡æˆå¼‚æ­¥æ–¹å¼ä¸€å¼€å§‹æˆ‘æ˜¯æ¯”è¾ƒå¥‡æ€ªçš„ï¼Œä»–æ˜¯å¦‚ä½•ä¿è¯offsetä¸ä¸¢å¤±å‘¢ï¼Ÿçœ‹äº†ä»£ç æ‰çŸ¥é“åœ¨å¼‚æ­¥è¿”å›å‰ä¼šç­‰å¾…ConcurrentLinkQueue&lt;offsetCommitCompletetion&gt;ä¸­æ²¡æœ‰å…¶ä»–çš„å¾…å¤„ç†çš„å…¶ä»–çš„offsetçš„commitåï¼Œæ‰ä¼šè¿”å›ï¼Œè¿™é‡Œçš„éé˜»å¡é˜Ÿåˆ—æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥é¿å…å½“å‰æäº¤å†²æ‰å…¶ä»–çš„offsetçš„æäº¤<br>2ã€çœŸæ­£è¿›è¡Œæäº¤çš„æ—¶å€™ä¹Ÿä¸æ˜¯è°ƒç”¨ä»€ä¹ˆå…·ä½“æ“ä½œnetçš„æ¥å£ï¼Œè€Œæ˜¯å‘å¦ä¸€ä¸ªConcurrentLinkedQueueä¸­æ³¨å†Œäº†ä¸€ä¸ªRequestFutureListenerçš„ç›‘å¬è€…ï¼Œå½“ç„¶æ³¨å†Œä¹‹å‰ä½¿ç”¨äº†AtomicIntegeræ¥ä¿è¯å¹¶å‘å®‰å…¨ã€‚<br>3ã€æ¯ä¸ªç›‘å¬è€…åº”è¯¥éƒ½ä¼šç”±ç›¸åº”çš„Coordinatorè½®è¯¢å¤„ç†é˜Ÿåˆ—ä¸­çš„å¾…æäº¤è¯·æ±‚ï¼Œå°†offsetæäº¤ä»å…·ä½“çš„Consumerä¸­è§£è€¦åˆ°æ¯ä¸ªç»„çš„Coordinatorä¸­ã€‚<br>å½“ç„¶ä»¥ä¸Šåªæ˜¯ä¸ªäººç†è§£ï¼Œå¦‚æœ‰ä¸å½“æ¬¢è¿æŒ‡æ­£ã€‚<br>è¯»å®Œè¿™ä¸ªä»£ç ï¼Œæˆ‘å‘ç°kafkaåœ¨è¿™é‡Œä¿è¯å¹¶å‘æ•°æ®ä¸€è‡´æ€§æ—¶ï¼Œä½¿ç”¨äº†å®‰å…¨çš„æ•°æ®ç»“æ„+CASçš„æ•°æ®è®¿é—®ï¼Œçµæ´»ä¸”å¤§å¤§é™ä½äº†é”æœºåˆ¶çš„ç²—ç²’åº¦å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œåªæ˜¯è¿™ä¸ªä»£ç çœŸä¸å®¹æ˜“å†™å¥½ï¼ŒçœŸæ˜¯å¤§ç‰›ä½œå“ï¼ï¼","like_count":8},{"had_liked":false,"id":222965,"user_name":"é²ç­å¤§å¸ˆ","can_delete":false,"product_type":"c1","uid":1179156,"ip_address":"","ucode":"4F9615DF87B031","user_header":"https://static001.geekbang.org/account/avatar/00/11/fe/14/f1532dec.jpg","comment_is_top":false,"comment_ctime":1590974917,"is_pvip":false,"replies":[{"id":"82361","content":"å®ç°â€œä¸é‡å¤æ¶ˆè´¹â€æ˜¯éå¸¸å›°éš¾çš„ï¼Œä½ éœ€è¦åšçš„å°±æ˜¯è®©ä½ çš„consumerå…·å¤‡å¹‚ç­‰æ€§ï¼Œè¿™æ ·å³ä½¿å‘ç”Ÿé‡å¤æ¶ˆè´¹ï¼Œä¹Ÿä¸ä¼šå¯¹ç³»ç»Ÿæ•°æ®äº§ç”Ÿä»»ä½•å½±å“ã€‚","user_name":"ä½œè€…å›å¤","comment_id":222965,"uid":"1501046","ip_address":"","utype":1,"ctime":1591151855,"user_name_real":"æç¥"}],"discussion_count":3,"race_medal":0,"score":"27360778693","product_id":100032301,"comment_content":"è€å¸ˆï¼Œkafak consumer åœ¨reblanceæœŸé—´ï¼Œå¦‚ä½•å®ç°ä¸é‡å¤æ¶ˆè´¹","like_count":6,"discussions":[{"author":{"id":1501046,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","nickname":"æç¥","note":"","ucode":"B19E91EE248591","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496975,"discussion_content":"å®ç°â€œä¸é‡å¤æ¶ˆè´¹â€æ˜¯éå¸¸å›°éš¾çš„ï¼Œä½ éœ€è¦åšçš„å°±æ˜¯è®©ä½ çš„consumerå…·å¤‡å¹‚ç­‰æ€§ï¼Œè¿™æ ·å³ä½¿å‘ç”Ÿé‡å¤æ¶ˆè´¹ï¼Œä¹Ÿä¸ä¼šå¯¹ç³»ç»Ÿæ•°æ®äº§ç”Ÿä»»ä½•å½±å“ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591151855,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1179156,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fe/14/f1532dec.jpg","nickname":"é²ç­å¤§å¸ˆ","note":"","ucode":"4F9615DF87B031","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":278121,"discussion_content":"è€å¸ˆï¼Œä»€ä¹ˆæ—¶å€™å‡ºä¸ªnettyä¸“é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591152823,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1179156,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fe/14/f1532dec.jpg","nickname":"é²ç­å¤§å¸ˆ","note":"","ucode":"4F9615DF87B031","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":278119,"discussion_content":"æ„Ÿè°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591152791,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":137788,"user_name":"å±±å¤´","can_delete":false,"product_type":"c1","uid":1610142,"ip_address":"","ucode":"9CD45A7966F37E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/1R7lHGBvwPTVfb3BAQrPX3AhsYWnXyicbUJUYDgWagWxMGTnsNFvKibzeJ8v7fF2vJLQGf2EY9dV07rnn5Mhv9Uw/132","comment_is_top":false,"comment_ctime":1569850988,"is_pvip":false,"replies":[{"id":"52989","content":"ä»æœåŠ¡ç«¯çš„åè°ƒè€…è·å–ã€‚æœåŠ¡ç«¯çš„åè°ƒè€…ä¼šè®°å½•ä¸»é¢˜çš„æ¯ä¸ªæ¶ˆè´¹ç»„çš„æ¯ä¸ªåˆ†åŒºå½“å‰çš„æ¶ˆè´¹ä½ç½®","user_name":"ä½œè€…å›å¤","comment_id":137788,"uid":"1501046","ip_address":"","utype":1,"ctime":1569906555,"user_name_real":"æç¥"}],"discussion_count":4,"race_medal":0,"score":"27339654764","product_id":100032301,"comment_content":"è€å¸ˆï¼Œä½ å¥½ï¼Œbrokerå’Œæ¶ˆè´¹ç«¯éƒ½é‡å¯äº†ï¼Œæ¶ˆè´¹ç«¯è¿˜çŸ¥é“ä»å“ªä¸ªoffsetå¼€å§‹æ¶ˆè´¹å—","like_count":6,"discussions":[{"author":{"id":1501046,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","nickname":"æç¥","note":"","ucode":"B19E91EE248591","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469262,"discussion_content":"ä»æœåŠ¡ç«¯çš„åè°ƒè€…è·å–ã€‚æœåŠ¡ç«¯çš„åè°ƒè€…ä¼šè®°å½•ä¸»é¢˜çš„æ¯ä¸ªæ¶ˆè´¹ç»„çš„æ¯ä¸ªåˆ†åŒºå½“å‰çš„æ¶ˆè´¹ä½ç½®","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1569906555,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1933720,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/HiaWCRaqMW25cPg13Q0yIpJj6oSGcYQqTuOy68JwTuSem1GgK0bMjfzVWTaIyNs1iaHba0DHqTuXg4EVnvic0ER3A/132","nickname":"æèŠ³å†›","note":"","ucode":"03C3C74CC5979F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":258804,"discussion_content":"è€å¸ˆï¼Œåº”è¯¥è®²è§£æºä»£ç å®ç°çš„åŸç†å³å¯ï¼Œè€Œä¸æ˜¯æ·±å…¥åˆ°å…·ä½“çš„ä»£ç å®ç°ï¼Œå¯¹äºå…¶å®ƒè¯­è¨€çš„å­¦å‘˜æ„ä¹‰ä¸å¤§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588729104,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1481811,"avatar":"https://static001.geekbang.org/account/avatar/00/16/9c/53/ade0afb0.jpg","nickname":"ub8","note":"","ucode":"0D937C3EAEB781","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":82931,"discussion_content":"æŒä¹…åŒ–äº†åº”è¯¥ä»–æ˜¯ä»€ä¹ˆæ—¶å€™æŒä¹…åŒ–çš„å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576402041,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1610142,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/1R7lHGBvwPTVfb3BAQrPX3AhsYWnXyicbUJUYDgWagWxMGTnsNFvKibzeJ8v7fF2vJLQGf2EY9dV07rnn5Mhv9Uw/132","nickname":"å±±å¤´","note":"","ucode":"9CD45A7966F37E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":23844,"discussion_content":"æ”¾åˆ°åè°ƒè€…å“ªé‡Œå‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569918341,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":247496,"user_name":"äºæˆé¾™","can_delete":false,"product_type":"c1","uid":1017681,"ip_address":"","ucode":"807A110E8AAEB2","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/51/4155b021.jpg","comment_is_top":false,"comment_ctime":1599725379,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14484627267","product_id":100032301,"comment_content":"åˆ†æäº†ä¸‹acquireAndEnsureOpenå¦‚ä½•åŠ é”ï¼Œä¾›å¤§å®¶å‚è€ƒ<br><br>private void acquireAndEnsureOpen() {<br>    acquire();<br>    &#47;&#47;KafkaConsumeræˆå‘˜å˜é‡ï¼Œåˆå§‹å€¼ä¸ºfalseï¼Œè°ƒç”¨close(Duration)æ–¹æ³•åæ‰ä¼šç½®ä¸ºtrue<br>    if (this.closed) {<br>        release();<br>        throw new IllegalStateException(&quot;This consumer has already been closed.&quot;);<br>    }<br>}<br><br>&#47;&#47;å˜é‡å£°æ˜<br>private static final long NO_CURRENT_THREAD = -1L;<br><br>private void acquire() {<br>    &#47;&#47;æ‹¿åˆ°å½“å‰çº¿ç¨‹çš„çº¿ç¨‹id<br>    long threadId = Thread.currentThread().getId();<br>    &#47;*if threadIdä¸å½“å‰æ­£æ‰§è¡Œçš„çº¿ç¨‹çš„idä¸ä¸€è‡´ï¼ˆå¹¶å‘ï¼Œå¤šçº¿ç¨‹è®¿é—®ï¼‰&amp;&amp; threadIdå¯¹åº”çš„çº¿ç¨‹æ²¡æœ‰äº‰æŠ¢åˆ°é”<br>    \t then æŠ›å‡ºå¼‚å¸¸<br>   \tä¸¾ä¾‹ï¼š<br>   \t\tç°åœ¨æœ‰ä¸¤ä¸ªKafkaConsumerçº¿ç¨‹ï¼Œçº¿ç¨‹idåˆ†åˆ«æ˜¯thread1, thread2ï¼Œè¦æ‰§è¡Œacquire()æ–¹æ³•ã€‚<br>\t\tthread1å…ˆå¯åŠ¨ï¼Œæ‰§è¡Œå®Œä¸Šé¢è¿™æ¡è¯­å¥ã€èµ‹å€¼threadIdåï¼Œ thread1æ ˆå¸§ä¸­threadId=thread1ï¼Œæ­¤æ—¶CPUçº¿ç¨‹è°ƒåº¦ã€æ‰§è¡Œthread2ï¼Œ<br>\t\tthread2ä¹Ÿèµ°åˆ°ifè¯­å¥æ—¶ï¼Œåœ¨thread2çš„æ ˆå¸§ä¸­ï¼ŒthreadIdå·²ç»èµ‹å€¼ä¸ºthread2ï¼Œèµ°åˆ°è¿™é‡Œï¼ŒcurrentThreadä½œä¸ºæˆå‘˜å˜é‡ï¼Œåˆå§‹å€¼ä¸ºNO_CURRENT_THREADï¼ˆ-1ï¼‰ï¼Œå› æ­¤å¿…ç„¶ä¸ç›¸ç­‰ï¼Œç»§ç»­èµ°ç¬¬äºŒåˆ¤æ–­æ¡ä»¶ï¼Œå³åˆ©ç”¨AtomicIntegerçš„CASæ“ä½œï¼Œå°†å½“å‰çº¿ç¨‹id threadId(thread2)èµ‹å€¼ç»™currentThreadè¿™ä¸ªAtomicIntegerï¼Œå¿…ç„¶è¿”å›trueï¼Œå› æ­¤ä¼šç»§ç»­æ‰§è¡Œï¼Œä½¿å¾—refcountåŠ 1ï¼›<br>\t\tæ¥ç€ï¼Œæ­¤æ—¶æ‰§è¡Œthread1ï¼Œé‚£ä¹ˆå†ç»§ç»­æ‰§è¡Œifï¼ŒthreadId(thread1) != currentThread.get() (thread2)èƒ½æ»¡è¶³ï¼Œä½†æ˜¯currentThreadçš„CASèµ‹å€¼å°†ä¼šå¤±è´¥ï¼Œå› æ­¤æ­¤æ—¶currentThreadçš„å€¼å¹¶ä¸æ˜¯NO_CURRENT_THREADã€‚<br>\t\t<br>\t\trefcountç”¨äºè®°å½•é‡å…¥é”çš„æƒ…å†µï¼Œå‚è§release()æ–¹æ³•ï¼Œå½“refcount=0æ—¶ï¼ŒcurrentThreadå°†é‡æ–°èµ‹å€¼ä¸ºNO_CURRENT_THREADï¼Œä¿è¯å½»åº•è§£é”ã€‚<br>    *&#47;<br>    if (threadId != currentThread.get() &amp;&amp; !currentThread.compareAndSet(NO_CURRENT_THREAD, threadId))<br>        throw new ConcurrentModificationException(&quot;KafkaConsumer is not safe for multi-threaded access&quot;);<br>    refcount.incrementAndGet();<br>}","like_count":3,"discussions":[{"author":{"id":1016232,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/81/a8/559afe8b.jpg","nickname":"Sruby","note":"","ucode":"A7D1B93F41DA0F","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312539,"discussion_content":"è¿™ç§æ–¹å¼è·Ÿæ™®é€šçš„é”ç›¸æ¯”æ•ˆç‡æ›´å¥½å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602730831,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":205918,"user_name":"å‡Œç©ºé£èµ·çš„å‰ªåˆ€è…¿","can_delete":false,"product_type":"c1","uid":1243680,"ip_address":"","ucode":"16FBBF4A3B54C6","user_header":"https://static001.geekbang.org/account/avatar/00/12/fa/20/0f06b080.jpg","comment_is_top":false,"comment_ctime":1586756838,"is_pvip":false,"replies":[{"id":"77011","content":"Kafka Consumerä¸æœåŠ¡ç«¯çš„åè°ƒè€…ç»´æŠ¤å¿ƒè·³ï¼Œè€Œåè°ƒè€…æ‰€åœ¨çš„Brokerä¸ä¸€å®šå’Œæ¥æ”¶æ¶ˆæ¯çš„Brokeræ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚<br>æ‰€ä»¥ï¼Œå¿…é¡»å¾—åˆ†å¼€ã€‚","user_name":"ä½œè€…å›å¤","comment_id":205918,"uid":"1501046","ip_address":"","utype":1,"ctime":1586830252,"user_name_real":"æç¥"}],"discussion_count":1,"race_medal":0,"score":"14471658726","product_id":100032301,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼š<br>          kafka consumerä¸­æ²¡æœ‰åˆ†æåˆ°å¿ƒè·³çº¿ç¨‹æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Œæˆ‘çœ‹æºä»£ç ä¸Šå†™çš„æ˜¯å•ç‹¬å¼€äº†ä¸€ä¸ªåå°çº¿ç¨‹è´Ÿè´£å¿ƒè·³ï¼Œè¿™æ ·å¤„ç†çš„ä¼˜åŠ¿æ˜¯ä»€ä¹ˆå•Šï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1501046,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","nickname":"æç¥","note":"","ucode":"B19E91EE248591","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491612,"discussion_content":"Kafka Consumerä¸æœåŠ¡ç«¯çš„åè°ƒè€…ç»´æŠ¤å¿ƒè·³ï¼Œè€Œåè°ƒè€…æ‰€åœ¨çš„Brokerä¸ä¸€å®šå’Œæ¥æ”¶æ¶ˆæ¯çš„Brokeræ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚\næ‰€ä»¥ï¼Œå¿…é¡»å¾—åˆ†å¼€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586830252,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":219381,"user_name":"é²ç­å¤§å¸ˆ","can_delete":false,"product_type":"c1","uid":1179156,"ip_address":"","ucode":"4F9615DF87B031","user_header":"https://static001.geekbang.org/account/avatar/00/11/fe/14/f1532dec.jpg","comment_is_top":false,"comment_ctime":1590020900,"is_pvip":false,"replies":[{"id":"81471","content":"æ˜¯çš„ï¼Œæ¶ˆè´¹ä¼šæš‚åœï¼Œç›´åˆ°Rebalanceå®Œæˆã€‚","user_name":"ä½œè€…å›å¤","comment_id":219381,"uid":"1501046","ip_address":"","utype":1,"ctime":1590370104,"user_name_real":"æç¥"}],"discussion_count":1,"race_medal":0,"score":"10179955492","product_id":100032301,"comment_content":"æ¯ä¸ª ConsumerGroup éƒ½æœ‰ä¸€ä¸ª Coordinator(åè°ƒè€…ï¼‰è´Ÿè´£åˆ†é… Consumer å’Œ Partition çš„å¯¹åº”å…³ç³»ï¼Œå½“ Partition æˆ–æ˜¯ Consumer å‘ç”Ÿå˜æ›´æ—¶ï¼Œä¼šè§¦å‘ rebalanceï¼ˆé‡æ–°åˆ†é…ï¼‰è¿‡ç¨‹ï¼Œé‡æ–°åˆ†é… Consumer ä¸ Partition çš„å¯¹åº”å…³ç³»ï¼›â€¦â€¦åœ¨rebalanceæœŸé—´åº”è¯¥æ˜¯ä¸èƒ½æ¶ˆè´¹çš„å§","like_count":2,"discussions":[{"author":{"id":1501046,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","nickname":"æç¥","note":"","ucode":"B19E91EE248591","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495789,"discussion_content":"æ˜¯çš„ï¼Œæ¶ˆè´¹ä¼šæš‚åœï¼Œç›´åˆ°Rebalanceå®Œæˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590370104,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":189792,"user_name":"SKang","can_delete":false,"product_type":"c1","uid":1803753,"ip_address":"","ucode":"AF3311B3A51841","user_header":"https://static001.geekbang.org/account/avatar/00/1b/85/e9/3854e59a.jpg","comment_is_top":false,"comment_ctime":1584551299,"is_pvip":false,"replies":[{"id":"73118","content":"ä¸æ˜¯çš„ï¼Œä¸åŒæ¶ˆè´¹ç»„çš„åç§»é‡æ˜¯åˆ†å¼€è®°å½•çš„ã€‚","user_name":"ä½œè€…å›å¤","comment_id":189792,"uid":"1501046","ip_address":"","utype":1,"ctime":1584593232,"user_name_real":"æç¥"}],"discussion_count":1,"race_medal":0,"score":"5879518595","product_id":100032301,"comment_content":"è€å¸ˆ æˆ‘çœ‹å®Œä¹‹å å¯ä»¥ç†è§£ä¸º æ¶ˆè´¹ç»„A æ¶ˆè´¹ä¸€ä¸ªccä¸»é¢˜çš„æ¶ˆæ¯ï¼Œç„¶åè¿‡ç¨‹ä¸­æˆ‘å°†æ¶ˆè´¹ç»„A çš„åå­—æ”¹æˆæ¶ˆè´¹ç»„Båï¼Œä¸ä¼šå‡ºç°é‡å¤æ¶ˆè´¹ï¼Œåªä¼šæ¥ç€Açš„ ç»§ç»­æ¶ˆè´¹å‰©ä¸‹çš„å§ æˆ‘è®¤ä¸ºæ¯•ç«ŸAå·²ç»æˆåŠŸæ¶ˆè´¹äº† åç§»é‡å·²ç»æˆåŠŸè¢«æ›´æ–°äº†å§","like_count":1,"discussions":[{"author":{"id":1501046,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","nickname":"æç¥","note":"","ucode":"B19E91EE248591","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487795,"discussion_content":"ä¸æ˜¯çš„ï¼Œä¸åŒæ¶ˆè´¹ç»„çš„åç§»é‡æ˜¯åˆ†å¼€è®°å½•çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584593232,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":133051,"user_name":"å±±å¤´","can_delete":false,"product_type":"c1","uid":1610142,"ip_address":"","ucode":"9CD45A7966F37E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/1R7lHGBvwPTVfb3BAQrPX3AhsYWnXyicbUJUYDgWagWxMGTnsNFvKibzeJ8v7fF2vJLQGf2EY9dV07rnn5Mhv9Uw/132","comment_is_top":false,"comment_ctime":1568339152,"is_pvip":false,"replies":[{"id":"50997","content":"åŒå­¦ï¼Œæˆ‘ä»¬è¿™èŠ‚è¯¾é€šç¯‡å°±æ˜¯è®²å¾—è¿™ä¸ªé—®é¢˜å•Šï¼Œç»™ä½ ä»¬è®²è§£ä½¿ç”¨çš„å°±æ˜¯å®é™…çš„ä»£ç ã€‚","user_name":"ä½œè€…å›å¤","comment_id":133051,"uid":"1501046","ip_address":"","utype":1,"ctime":1568429405,"user_name_real":"æç¥"}],"discussion_count":5,"race_medal":0,"score":"5863306448","product_id":100032301,"comment_content":"æ¶ˆè´¹è€…å¦‚ä½•ä»æœåŠ¡ç«¯æ‹‰å–æ¶ˆæ¯çš„ï¼Œç”¨forå¾ªç¯æ•ˆç‡å¤ªä½å§ï¼Œèƒ½å¦è¯´è¯´å®é™…çš„ä»£ç ","like_count":1,"discussions":[{"author":{"id":1501046,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","nickname":"æç¥","note":"","ucode":"B19E91EE248591","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467240,"discussion_content":"åŒå­¦ï¼Œæˆ‘ä»¬è¿™èŠ‚è¯¾é€šç¯‡å°±æ˜¯è®²å¾—è¿™ä¸ªé—®é¢˜å•Šï¼Œç»™ä½ ä»¬è®²è§£ä½¿ç”¨çš„å°±æ˜¯å®é™…çš„ä»£ç ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568429405,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1610142,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/1R7lHGBvwPTVfb3BAQrPX3AhsYWnXyicbUJUYDgWagWxMGTnsNFvKibzeJ8v7fF2vJLQGf2EY9dV07rnn5Mhv9Uw/132","nickname":"å±±å¤´","note":"","ucode":"9CD45A7966F37E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":21160,"discussion_content":"è€å¸ˆï¼Œclientå’Œconsumerå•¥åŒºåˆ«","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1569426272,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walleæ–Œ","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288394,"discussion_content":"å…¶å®ä»ä¸€å¼€å§‹rocketmq kafka rabbitmqçš„å¯¹æ¯”çš„æ—¶å€™å°±è¯´äº†ï¼Œkafkaçš„æ¶ˆæ¯åŠæ—¶æ€§ä¸é«˜ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593741251,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1610142,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/1R7lHGBvwPTVfb3BAQrPX3AhsYWnXyicbUJUYDgWagWxMGTnsNFvKibzeJ8v7fF2vJLQGf2EY9dV07rnn5Mhv9Uw/132","nickname":"å±±å¤´","note":"","ucode":"9CD45A7966F37E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":21153,"discussion_content":"è€å¸ˆï¼Œä½ å¥½brokeå¦‚ä½•æ‰¾åˆ°å®¢æˆ·ç«¯ipå’Œç«¯å£çš„ï¼Œåªæœ‰æœ‰ipå’Œportæ‰èƒ½æŠŠæ¶ˆæ¯æ¨ç»™å®¢æˆ·ç«¯å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569424943,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1116106,"avatar":"https://static001.geekbang.org/account/avatar/00/11/07/ca/3feccf32.jpg","nickname":"Berton.Yip.","note":"","ucode":"DB6C45FD67CDA3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1610142,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/1R7lHGBvwPTVfb3BAQrPX3AhsYWnXyicbUJUYDgWagWxMGTnsNFvKibzeJ8v7fF2vJLQGf2EY9dV07rnn5Mhv9Uw/132","nickname":"å±±å¤´","note":"","ucode":"9CD45A7966F37E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":233871,"discussion_content":"zk-metaæ•°æ®.è‡³äºå¦‚ä½•ç»´æŠ¤, å¿ƒè·³æœºåˆ¶.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586949998,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":21153,"ip_address":""},"score":233871,"extra":""}]}]},{"had_liked":false,"id":132868,"user_name":"leslie","can_delete":false,"product_type":"c1","uid":1324255,"ip_address":"","ucode":"798E7C1CC98CC2","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/df/64e3d533.jpg","comment_is_top":false,"comment_ctime":1568255252,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5863222548","product_id":100032301,"comment_content":"   å…ˆæ‰“å¡ï¼šä»£ç æ…¢æ…¢ç ”ç©¶ï¼›è€å¸ˆä»Šå¤©è®²è¿°äº†ç ”ç©¶ä»£ç çš„ç›®çš„ï¼š<br>   1.æ¶ˆæ¯é˜Ÿåˆ—å®ç°çš„ä¸»è¦æµç¨‹éƒ½ä¸€æ ·ï¼ŒæŒæ¡æµç¨‹çš„å®ç°è¿‡ç¨‹ï¼›é‡åˆ°æ”¶å‘æ¶ˆæ¯çš„é—®é¢˜ï¼Œéƒ½å¯ä»¥ç”¨åŒæ ·çš„æ€è·¯å»åˆ†æå’Œè§£å†³é—®é¢˜ã€‚<br>   2.çœ‹ä¸€ä¸‹æºä»£ç ï¼Œç†æ¸…æ¶ˆè´¹ç”Ÿäº§çš„å®ç°è¿‡ç¨‹ï¼Œä»ä¸­å­¦ä¹ ä¸€äº›ä¼˜ç§€çš„è®¾è®¡æ€è·¯å’Œç¼–ç æŠ€å·§ã€‚<br>   è¿™ä¸ªç®—æ˜¯ä¸€ä¸ªå°çš„æ€»ç»“å§ï¼šæ˜å¤©ä¸­ç§‹ä¼‘æ¯åˆšå¥½å¯ä»¥å•ƒä»£ç ï¼Œå¥½å¥½ç ”ç©¶ä»£ç å»ä½“ä¼šã€‚<br>   æ˜å¤©æ˜¯ä¸­ç§‹ä½³èŠ‚ï¼šæ„¿è€å¸ˆèŠ‚æ—¥å¿«ä¹^_^","like_count":1},{"had_liked":false,"id":360200,"user_name":"å°æ¨","can_delete":false,"product_type":"c1","uid":1252598,"ip_address":"åŒ—äº¬","ucode":"C7C07AF005507C","user_header":"https://static001.geekbang.org/account/avatar/00/13/1c/f6/b5394713.jpg","comment_is_top":false,"comment_ctime":1666269113,"is_pvip":false,"discussion_count":0,"race_medal":3,"score":"1666269113","product_id":100032301,"comment_content":"æˆ‘æœ‰ä¸ªç–‘é—®ï¼Œ1ä¸ªtopicï¼Œ3ä¸ªpartitionï¼Œå¢åŠ consumeræ•°é‡èƒ½æå‡æ¶ˆè´¹é€Ÿåº¦ä¹ˆï¼Ÿæˆ–è€…è¯´kafkaåº”è¯¥å¦‚ä½•æå‡æ¶ˆè´¹èƒ½åŠ›ã€‚æœŸå¾…è€å¸ˆè§£ç­”ã€‚","like_count":0},{"had_liked":false,"id":336344,"user_name":"tianbingJ","can_delete":false,"product_type":"c1","uid":2163653,"ip_address":"","ucode":"666141CAD8260F","user_header":"https://static001.geekbang.org/account/avatar/00/21/03/c5/600fd645.jpg","comment_is_top":false,"comment_ctime":1646104102,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1646104102","product_id":100032301,"comment_content":"å¤§éƒ¨åˆ†å†…å®¹éƒ½åœ¨è®¨è®ºç½‘ç»œã€CASã€å¼‚æ­¥å•Šç­‰ç­‰çŸ¥è¯†å¯¹äºå®ç°ä¸€ä¸ªç³»ç»Ÿå¤šä¹ˆé‡è¦ï¼›ä½†æ˜¯ï¼Œå„ç§æ¡†æ¶å®ç°çš„åœºæ™¯éƒ½ä¼šç”¨åˆ°è¿™äº›å†…å®¹ï¼Œæ€»ä¸èƒ½æ‰€æœ‰çš„è¯¾ç¨‹éƒ½å…ˆç½—åˆ—ä¸€éè¿™äº›å†…å®¹å§ã€‚<br>å³ä½¿ä»‹ç»ï¼ŒèŠ±ä¸ªä¸¤ä¸‰èŠ‚è¯¾å·®ä¸å¤šå°±è¡Œäº†ï¼Œå æ¯”è¿‡å¤§ï¼›ç»“æœå°±æ˜¯è·‘é¢˜äº†ï¼Œæ²¡æœ‰èšç„¦åœ¨MQä¸Šã€‚","like_count":0},{"had_liked":false,"id":323107,"user_name":"Sam Fu","can_delete":false,"product_type":"c1","uid":1112676,"ip_address":"","ucode":"EA285A4943271F","user_header":"https://static001.geekbang.org/account/avatar/00/10/fa/64/457325e6.jpg","comment_is_top":false,"comment_ctime":1637731569,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1637731569","product_id":100032301,"comment_content":"è€å¸ˆ æˆ‘æœ€è¿‘çœ‹äº†rocketmqæ¶ˆè´¹çš„æºç ï¼Œæ‚¨çœ‹çœ‹æˆ‘çš„ç†è§£å¯¹ä¸å¯¹ã€‚<br>rocketmq consumeræ¶ˆè´¹å®Œæ¶ˆæ¯åï¼Œå…¶å®ä¸ç®¡æˆåŠŸæˆ–å¤±è´¥éƒ½ä¼šæäº¤è¿™æ‰¹ä¿¡æ¯çš„æœ€å¤§ä½ç§»ã€‚ å¦‚æœå­˜åœ¨å¤±è´¥çš„æ¶ˆæ¯ï¼Œåˆ™ä¼šå°†æ•´ä¸ªè¿™ä¸€æ‰¹æ¶ˆæ¯å…¨éƒ¨å‘åˆ°é‡è¯•é˜Ÿåˆ—å»ã€‚è¿™æ ·çš„è¯ï¼Œä¹‹å‰æ¶ˆè´¹è¿‡çš„æ¶ˆæ¯å°±ä¼šé‡å¤æ¶ˆè´¹äº†ã€‚<br>æ‰€ä»¥æ¯æ‰¹æ‹‰å–çš„æ¶ˆæ¯è®¾ç½®çš„ä¸èƒ½å¤ªå¤§ï¼Œå¦åˆ™æœ‰ä¸€æ¡å¤±è´¥æ•´ä¸ªéƒ½å¾—é‡è¯•ï¼Œé‡è¯•ç‡ä¼šå¢é«˜","like_count":0},{"had_liked":false,"id":253066,"user_name":"å¯¹ä¸é”™","can_delete":false,"product_type":"c1","uid":1682027,"ip_address":"","ucode":"EF55733E3BD78B","user_header":"https://static001.geekbang.org/account/avatar/00/19/aa/6b/ab9a072a.jpg","comment_is_top":false,"comment_ctime":1602583560,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1602583560","product_id":100032301,"comment_content":"è¯·é—®kafkaæ¶ˆè´¹è€…ä½¿ç”¨æ‰‹åŠ¨æäº¤ä½ç§»çš„æ–¹å¼ï¼Œå½“å‰æ¶ˆè´¹è¿›åº¦ä¸º10ï¼Œ,ç„¶åæ¶ˆè´¹å‡ æ¡å¤±è´¥ä¹‹åï¼Œæäº¤ä½ç§»å¤±è´¥ï¼Œåé¢æ¶ˆè´¹æ–°çš„æ¶ˆæ¯æˆåŠŸä¹‹åï¼Œå½“å‰æ¶ˆè´¹è¿›åº¦è¢«æ›´æ–°ä¸º15ï¼Œé‚£ä¸­é—´æ¶ˆè´¹å¤±è´¥çš„å‡ æ¡æ¶ˆæ¯ä¼šéšç€é‡å¯æ¶ˆè´¹è€…è€Œé‡æ–°æ¶ˆè´¹å—ï¼Ÿä½ç§»ä¸»é¢˜é‡Œé¢çš„æ¶ˆè´¹è¿›åº¦ä¼šéšç€é‡å¯æ¶ˆè´¹è€…è€Œè¢«åˆ é™¤å—?å¦‚æœä¸è¢«åˆ é™¤ï¼Œé‚£åº”è¯¥ä¸ä¼šé‡æ–°æ¶ˆè´¹å¤±è´¥çš„é‚£å‡ æ¡æ¶ˆæ¯å§ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1386315,"avatar":"https://static001.geekbang.org/account/avatar/00/15/27/4b/e49c82d0.jpg","nickname":"Rover","note":"","ucode":"7575EC91F45B99","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":360154,"discussion_content":"æ¶ˆè´¹ä»¥offsetä¸ºæ ‡å‡†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616380437,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":236022,"user_name":"Geek_411c57","can_delete":false,"product_type":"c1","uid":2056209,"ip_address":"","ucode":"ED9A6313018E82","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/rHcOA80Xqhe4PJ9S38AzqD2zhrMjK92D7lvH8D3feuHkjiaHTIks5LQvOYjLWZr9mjFklv04jI2Wciahk7x2o8YA/132","comment_is_top":false,"comment_ctime":1595293862,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595293862","product_id":100032301,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæˆ‘æƒ³é—®ä¸‹: å®¢æˆ·ç«¯æ‹‰å–æ¶ˆæ¯çš„æ—¶å€™æ˜¯åŒæ­¥æ‹‰å–å—ï¼Ÿå¦‚æœæ˜¯åŒæ­¥æ‹‰å–çš„è¯åº”è¯¥ä¼šå ç”¨è¿æ¥å§ï¼Ÿä¸ºä»€ä¹ˆä¸æ˜¯ç”¨å¼‚æ­¥ç›‘å¬ioäº‹ä»¶å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":226727,"user_name":"è›¤èŸ†å…ˆç”Ÿ","can_delete":false,"product_type":"c1","uid":1125703,"ip_address":"","ucode":"8353492D68DBBF","user_header":"https://static001.geekbang.org/account/avatar/00/11/2d/47/7c3baa15.jpg","comment_is_top":false,"comment_ctime":1592190518,"is_pvip":false,"replies":[{"id":"84540","content":"å¯ä»¥è´´ä¸€ä¸‹Topicçš„å…·ä½“é…ç½®ï¼Œå¤§å®¶ä¸€èµ·å¸®ä½ åˆ†æä¸€ä¸‹åŸå› ã€‚","user_name":"ä½œè€…å›å¤","comment_id":226727,"uid":"1501046","ip_address":"","utype":1,"ctime":1592918416,"user_name_real":"æç¥"}],"discussion_count":1,"race_medal":0,"score":"1592190518","product_id":100032301,"comment_content":"æœ‰ä¸ªé—®é¢˜è¯·æ•™ä¸€ä¸‹è€å¸ˆï¼Œç›®å‰æˆ‘ä»¬å…¬å¸æŸä¸ªåº”ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒä¸€å…±æœ‰ä¸¤å°æœºå™¨ï¼Œè¿™æ—¶å€™æœ‰ä¸€å°æœºå™¨æŒ‚äº†ï¼Œä½†æ˜¯æŸä¸ªæ¶ˆæ¯è¿˜æ˜¯ä¼šç»å¸¸æ¶ˆè´¹åˆ°è¿™å°æŒ‚çš„æœºå™¨ä¸Šï¼Œå¯¼è‡´æ¶ˆæ¯æ²¡æœ‰æ¶ˆè´¹æˆåŠŸï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1501046,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","nickname":"æç¥","note":"","ucode":"B19E91EE248591","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":498344,"discussion_content":"å¯ä»¥è´´ä¸€ä¸‹Topicçš„å…·ä½“é…ç½®ï¼Œå¤§å®¶ä¸€èµ·å¸®ä½ åˆ†æä¸€ä¸‹åŸå› ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592918416,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":219378,"user_name":"é²ç­å¤§å¸ˆ","can_delete":false,"product_type":"c1","uid":1179156,"ip_address":"","ucode":"4F9615DF87B031","user_header":"https://static001.geekbang.org/account/avatar/00/11/fe/14/f1532dec.jpg","comment_is_top":false,"comment_ctime":1590020770,"is_pvip":false,"replies":[{"id":"81470","content":"å¦‚æœæ˜¯ä¸åŒçš„group.idï¼Œäº’ç›¸ä¹‹é—´æ²¡æœ‰å½±å“ã€‚","user_name":"ä½œè€…å›å¤","comment_id":219378,"uid":"1501046","ip_address":"","utype":1,"ctime":1590370060,"user_name_real":"æç¥"}],"discussion_count":3,"race_medal":0,"score":"1590020770","product_id":100032301,"comment_content":"å¤šä¸ªconsumeræ¶ˆè´¹åŒä¸€ä¸ªpartitionä¼šæœ‰ä»€ä¹ˆé—®é¢˜ä¹ˆ","like_count":0,"discussions":[{"author":{"id":1501046,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","nickname":"æç¥","note":"","ucode":"B19E91EE248591","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495788,"discussion_content":"å¦‚æœæ˜¯ä¸åŒçš„group.idï¼Œäº’ç›¸ä¹‹é—´æ²¡æœ‰å½±å“ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590370060,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2643691,"avatar":"https://static001.geekbang.org/account/avatar/00/28/56/eb/c862a6bd.jpg","nickname":"æœ€ç¾çš„æ—¶å…‰","note":"","ucode":"5AAAC0B858F6B3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540649,"discussion_content":"åŒä¸€ä¸ªç»„ä¸­çš„å¤šä¸ªconsumeræ¶ˆè´¹åŒä¸€ä¸ªpartitionä¼šæœ‰é‡å¤æ¶ˆè´¹çš„é—®é¢˜å’ŒåŒä¸€ä¸ªåˆ†åŒºå†…é¡ºåºä¸ä¸€è‡´çš„é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640102074,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1179156,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fe/14/f1532dec.jpg","nickname":"é²ç­å¤§å¸ˆ","note":"","ucode":"4F9615DF87B031","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":274260,"discussion_content":"åŒä¸€ä¸ªgroupä¸‹ä¼šæœ‰ä»€ä¹ˆå½±å“çš„ï¼Œæ„Ÿè§‰ä¹Ÿèƒ½æ­£å¸¸æ¶ˆè´¹å§ï¼Œåªæ˜¯é¡ºåºæ€§ä¸èƒ½ä¿è¯äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590559551,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":216803,"user_name":"lizhibo","can_delete":false,"product_type":"c1","uid":1636410,"ip_address":"","ucode":"FDF4FA12C699B3","user_header":"https://static001.geekbang.org/account/avatar/00/18/f8/3a/e0c14cb3.jpg","comment_is_top":false,"comment_ctime":1589346246,"is_pvip":false,"replies":[{"id":"80331","content":"æ‰€ä»¥æ¶ˆè´¹çš„æ—¶å€™ï¼Œå¦‚æœä¸èƒ½æ¥å—ä¸¢æ¶ˆæ¯ï¼Œä¸€å®šä¸è¦è®¾ç½®æˆè‡ªåŠ¨æäº¤æ¶ˆè´¹ä½ç½®ã€‚è¿™æ ·ä¸‹æ¬¡æ‹‰å–çš„æ—¶å€™ï¼Œè¿˜ä¼šæ‹‰åˆ°è¿™ä¸ªä½ç½®çš„æ¶ˆæ¯ã€‚<br><br>ConsumerRecords&lt;String, String&gt; records = consumer.poll(Duration.ofMillis(1000L));<br>&#47;&#47; æ‰§è¡Œæ¶ˆè´¹ä¸šåŠ¡é€»è¾‘ï¼Œç„¶åå†æäº¤æ¶ˆè´¹ä½ç½®ã€‚<br>consumer.commitSync();<br>","user_name":"ä½œè€…å›å¤","comment_id":216803,"uid":"1501046","ip_address":"","utype":1,"ctime":1589462029,"user_name_real":"æç¥"}],"discussion_count":4,"race_medal":0,"score":"1589346246","product_id":100032301,"comment_content":"è€å¸ˆå¥½ï¼Œkafkaæ¶ˆæ¯è¦æ˜¯åœ¨æ¶ˆè´¹ç«¯æ¶ˆè´¹å‡ºç°å¼‚å¸¸äº†æ€ä¹ˆåŠï¼Œä»–æ²¡æœ‰å†æ¬¡æ¶ˆè´¹çš„æœºåˆ¶ï¼Œæ¯”å¦‚1åˆ†ä¹‹åå†å»æ¶ˆè´¹ï¼Œè¿™ä¸ªæ€ä¹ˆå®ç°","like_count":0,"discussions":[{"author":{"id":1501046,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","nickname":"æç¥","note":"","ucode":"B19E91EE248591","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494951,"discussion_content":"æ‰€ä»¥æ¶ˆè´¹çš„æ—¶å€™ï¼Œå¦‚æœä¸èƒ½æ¥å—ä¸¢æ¶ˆæ¯ï¼Œä¸€å®šä¸è¦è®¾ç½®æˆè‡ªåŠ¨æäº¤æ¶ˆè´¹ä½ç½®ã€‚è¿™æ ·ä¸‹æ¬¡æ‹‰å–çš„æ—¶å€™ï¼Œè¿˜ä¼šæ‹‰åˆ°è¿™ä¸ªä½ç½®çš„æ¶ˆæ¯ã€‚\n\nConsumerRecords&amp;lt;String, String&amp;gt; records = consumer.poll(Duration.ofMillis(1000L));\n// æ‰§è¡Œæ¶ˆè´¹ä¸šåŠ¡é€»è¾‘ï¼Œç„¶åå†æäº¤æ¶ˆè´¹ä½ç½®ã€‚\nconsumer.commitSync();\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589462029,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walleæ–Œ","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288404,"discussion_content":"å¦‚æœä½ é‚£æ¥å…¥spring-kafkaå°±ä¼šçœ‹åˆ° è¿™è¾¹çš„å°è£…å¾ˆæœ‰æ„æ€ï¼Œæ— è®ºä½ æ˜¯æ‰‹åŠ¨è¿˜æ˜¯è‡ªåŠ¨ï¼Œæ˜¯å•æ¡è¿˜æ˜¯æ‰¹é‡ï¼Œéƒ½å¾ˆéš¾æ»¡è¶³æ¶ˆæ¯æ¶ˆè´¹å¤±è´¥é—´éš”ä¸€æ®µé‡è¯•è¿™ä¸ªéœ€æ±‚ã€‚å› ä¸ºä»clientç«¯ä½ èƒ½å¤Ÿåšçš„æœ‰é™ã€‚å¦‚æœæœ‰è¿™ä¸ªéœ€æ±‚å¯ä»¥çœ‹ä¸‹rocketmqæ˜¯å¦‚ä½•å®ç°çš„ï¼Œè‚¯å®šæ˜¯clientä¸brokerçš„ç›¸äº’é…åˆæ‰èƒ½åšè¿™ç§ç©æ³•ï¼ŒæŒºæœ‰æ„æ€çš„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1593742653,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1636410,"avatar":"https://static001.geekbang.org/account/avatar/00/18/f8/3a/e0c14cb3.jpg","nickname":"lizhibo","note":"","ucode":"FDF4FA12C699B3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":275449,"discussion_content":"è€å¸ˆå¥½ï¼Œè®¾ç½®äº†æ‰‹åŠ¨æäº¤ï¼Œæäº¤å¤±è´¥äº†ï¼Œæ€ä¹ˆè®©ä»–é‡è¯•æ¶ˆæ¯ï¼Œé—´éš”æŒ‡å®šæ—¶é—´è¿›è¡Œé‡è¯•æ¶ˆè´¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590716372,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walleæ–Œ","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1636410,"avatar":"https://static001.geekbang.org/account/avatar/00/18/f8/3a/e0c14cb3.jpg","nickname":"lizhibo","note":"","ucode":"FDF4FA12C699B3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288402,"discussion_content":"ä½ è¿™ä¸ªéœ€æ±‚æ˜æ˜¾æ˜¯rocketmqçš„å¼ºé¡¹ã€‚kafkaä½œä¸ºåˆè¡·æ˜¯æ—¥å¿—æµå¤„ç†ï¼Œæ›´åœ¨ä¹çš„æ˜¯æ•´ä½“ååé‡ï¼Œå¦‚æœä½ æƒ³å¯¹æ¯æ¡æ¶ˆæ¯é‡è¯•ä¸”æ—¶é—´é—´éš”æœ‰å˜åŒ–ï¼Œæ¨èrocketmqï¼Œå¹¶ä¸”æ”¯æŒclientç«¯å¤šçº¿ç¨‹æ¶ˆè´¹ï¼Œæå‡æ¶ˆè´¹é€Ÿåº¦ï¼Œä½†æ˜¯ä¹Ÿè¦æ³¨æ„æ¶ˆæ¯é‡è¯•ä¼šé€ æˆå•æ¬¡æ¶ˆè´¹çš„å¤šæ¡æ¶ˆæ¯é‡è¯•ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1593742493,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":275449,"ip_address":""},"score":288402,"extra":""}]}]},{"had_liked":false,"id":181554,"user_name":"å‡¡","can_delete":false,"product_type":"c1","uid":1721168,"ip_address":"","ucode":"80C2A6452AB9EA","user_header":"https://static001.geekbang.org/account/avatar/00/1a/43/50/abb4ca1e.jpg","comment_is_top":false,"comment_ctime":1582558880,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582558880","product_id":100032301,"comment_content":"æäº¤ä½ç½®æ˜¯åœ¨ConsumerCoordinatorç±»æä¾›äº†åŒæ­¥å¼‚æ­¥æäº¤æ–¹æ³•ï¼Œå…·ä½“æäº¤ä½ç½®å¯ä»¥æŸ¥çœ‹åˆ°è°ƒç”¨è¿™å‡ ä¸ªæ–¹æ³•çš„ä½ç½® ","like_count":0},{"had_liked":false,"id":152332,"user_name":"LY","can_delete":false,"product_type":"c1","uid":1273512,"ip_address":"","ucode":"6AEF6BD822A3AB","user_header":"https://static001.geekbang.org/account/avatar/00/13/6e/a8/ee6bc8a5.jpg","comment_is_top":false,"comment_ctime":1573975075,"is_pvip":false,"replies":[{"id":"58726","content":"æˆ‘è”ç³»ç¼–è¾‘åŒå­¦ä¿®æ”¹ï¼Œæ„Ÿè°¢ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"æç¥","uid":"1501046","ctime":1574124567,"ip_address":"","comment_id":152332,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1573975075","product_id":100032301,"comment_content":"å½“ Partition æˆ–æ˜¯ Consumer å‘ç”Ÿå˜æ›´æ˜¯ï¼Œä¼šè§¦å‘ reblanceï¼ˆé‡æ–°åˆ†é…ï¼‰è¿‡ç¨‹ã€‚<br>è¿™å¥è¯æœ‰ä¸¤ä¸ªé”™åˆ«å­—ã€‚ã€‚ã€‚","like_count":0,"discussions":[{"author":{"id":1501046,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","nickname":"æç¥","note":"","ucode":"B19E91EE248591","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474784,"discussion_content":"æˆ‘è”ç³»ç¼–è¾‘åŒå­¦ä¿®æ”¹ï¼Œæ„Ÿè°¢ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574124567,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142781,"user_name":"æ—­ä¸œ(Frank)","can_delete":false,"product_type":"c1","uid":1024486,"ip_address":"","ucode":"176FA629800062","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a1/e6/50da1b2d.jpg","comment_is_top":false,"comment_ctime":1571525679,"is_pvip":false,"replies":[{"id":"55252","content":"å› ä¸ºæˆ‘ä»¬è¿™ä¸ªè¯¾éœ€è¦ç…§é¡¾åˆ°ä½¿ç”¨ä¸åŒæ¶ˆæ¯é˜Ÿåˆ—å’Œä½¿ç”¨ä¸åŒè¯­è¨€çš„å°ä¼™ä¼´å•Šã€‚<br>","user_name":"ä½œè€…å›å¤","user_name_real":"æç¥","uid":"1501046","ctime":1571620752,"ip_address":"","comment_id":142781,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1571525679","product_id":100032301,"comment_content":"ä¸Šä¸€èŠ‚è¯¾æˆ‘å’Œä½ ä¸€èµ·é€šè¿‡åˆ†ææºä»£ç å­¦ä¹ äº† RocketMQ æ¶ˆæ¯ç”Ÿäº§çš„å®ç°è¿‡ç¨‹ï¼Œæœ¬èŠ‚è¯¾æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ Kafka æ¶ˆè´¹è€…çš„æºä»£ç ï¼Œç†æ¸… Kafka æ¶ˆè´¹çš„å®ç°è¿‡ç¨‹ï¼Œå¹¶ä¸”èƒ½ä»ä¸­å­¦ä¹ åˆ°ä¸€äº› Kafka çš„ä¼˜ç§€è®¾è®¡æ€è·¯å’Œç¼–ç æŠ€å·§ã€‚<br><br>è€å¸ˆï¼Œä¸ºä»€ä¹ˆä¸Šä¸€è®²æ˜¯Rabbitè¿™ä¸€è®²æ˜¯kafka?","like_count":0,"discussions":[{"author":{"id":1501046,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","nickname":"æç¥","note":"","ucode":"B19E91EE248591","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471269,"discussion_content":"å› ä¸ºæˆ‘ä»¬è¿™ä¸ªè¯¾éœ€è¦ç…§é¡¾åˆ°ä½¿ç”¨ä¸åŒæ¶ˆæ¯é˜Ÿåˆ—å’Œä½¿ç”¨ä¸åŒè¯­è¨€çš„å°ä¼™ä¼´å•Šã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571620752,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":139483,"user_name":"äºšæ´²èˆç‹.å°¼å¤æ‹‰æ–¯èµµå››","can_delete":false,"product_type":"c1","uid":1443078,"ip_address":"","ucode":"7159F5D7232696","user_header":"https://static001.geekbang.org/account/avatar/00/16/05/06/f5979d65.jpg","comment_is_top":false,"comment_ctime":1570667076,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570667076","product_id":100032301,"comment_content":"è¿™ç¯‡æ–‡ç« çœŸçš„å¥½æ·±ï¼Œçœ‹äº†å¥½å‡ éæ‰æ˜ç™½ï¼Œå¼‚æ­¥çš„è®¾è®¡å¥½å¤æ‚ï¼Œç°åœ¨æ˜ç™½å‰é¢ä¸ºä»€ä¹ˆè€å¸ˆè®²é‚£äº›åŸºç¡€äº†","like_count":0},{"had_liked":false,"id":137787,"user_name":"å±±å¤´","can_delete":false,"product_type":"c1","uid":1610142,"ip_address":"","ucode":"9CD45A7966F37E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/1R7lHGBvwPTVfb3BAQrPX3AhsYWnXyicbUJUYDgWagWxMGTnsNFvKibzeJ8v7fF2vJLQGf2EY9dV07rnn5Mhv9Uw/132","comment_is_top":false,"comment_ctime":1569850522,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569850522","product_id":100032301,"comment_content":"æ¶ˆè´¹ç«¯é‡å¯çš„æ—¶å€™ï¼Œä»–ä¼šä»å“ªé‡Œæ‹¿offsetå‘¢ï¼Ÿä»–æ˜¯ä»å¤´è¿˜æ˜¯æ‹¿æ¶ˆæ¯è¿˜æ˜¯ä»ä¸Šæ¬¡æ¶ˆè´¹çš„åœ°æ–¹ï¼Ÿè¿™ä¸ªoffsetèƒ½è®²è®²å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":136406,"user_name":"å±±å¤´","can_delete":false,"product_type":"c1","uid":1610142,"ip_address":"","ucode":"9CD45A7966F37E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/1R7lHGBvwPTVfb3BAQrPX3AhsYWnXyicbUJUYDgWagWxMGTnsNFvKibzeJ8v7fF2vJLQGf2EY9dV07rnn5Mhv9Uw/132","comment_is_top":false,"comment_ctime":1569424817,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569424817","product_id":100032301,"comment_content":"è€å¸ˆï¼Œä¸»é¢˜å’Œåˆ†åŒºï¼Œä»¥åŠåˆ†åŒºå’ŒConsumerGroupåˆ°åº•æ˜¯å‡ å¯¹å‡ çš„å…³ç³»","like_count":0},{"had_liked":false,"id":136403,"user_name":"å±±å¤´","can_delete":false,"product_type":"c1","uid":1610142,"ip_address":"","ucode":"9CD45A7966F37E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/1R7lHGBvwPTVfb3BAQrPX3AhsYWnXyicbUJUYDgWagWxMGTnsNFvKibzeJ8v7fF2vJLQGf2EY9dV07rnn5Mhv9Uw/132","comment_is_top":false,"comment_ctime":1569424340,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569424340","product_id":100032301,"comment_content":" ConsumerGroupï¼Œå’Œåˆ†åŒºä»€ä¹ˆå…³ç³»ï¼Œæœ‰å¤šå°‘ä¸ªConsumerGroupå‘¢","like_count":0},{"had_liked":false,"id":135161,"user_name":"z.l","can_delete":false,"product_type":"c1","uid":1181055,"ip_address":"","ucode":"805CC5784D3F76","user_header":"https://static001.geekbang.org/account/avatar/00/12/05/7f/d35ab9a1.jpg","comment_is_top":false,"comment_ctime":1569047994,"is_pvip":false,"replies":[{"id":"51966","content":"ä½ èƒ½è¯´ä¸€ä¸‹åœ¨ä»£ç ä¸­å“ªä¸ªåœ°æ–¹åˆå§‹åŒ–äº†Producerå—ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"æç¥","uid":"1501046","ctime":1569202984,"ip_address":"","comment_id":135161,"utype":1}],"discussion_count":5,"race_medal":0,"score":"1569047994","product_id":100032301,"comment_content":"è€å¸ˆå¥½ï¼Œçœ‹äº†Rocketmq consumeræºç ï¼Œä¸ºå•¥å¯åŠ¨consumerå®ä¾‹çš„æ—¶å€™ä¹Ÿä¼šåˆå§‹åŒ–producerï¼Œæ˜¯ä¸ºäº†æäº¤æ¶ˆè´¹ä½ç‚¹å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1501046,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","nickname":"æç¥","note":"","ucode":"B19E91EE248591","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468074,"discussion_content":"ä½ èƒ½è¯´ä¸€ä¸‹åœ¨ä»£ç ä¸­å“ªä¸ªåœ°æ–¹åˆå§‹åŒ–äº†Producerå—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569202984,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1736650,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKyuuhxu0HH4cIKCClCqx0LTurCCYWmNcFwfTWV5te5afsibp2yuDmC9mibEHx0Xy8QlvqvMWWcAib8g/132","nickname":"æˆ‘çš„å–µ","note":"","ucode":"A7435BDBDD2587","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571284,"discussion_content":"åœ¨consumeræ¶ˆè´¹æ¶ˆæ¯æ—¶ï¼Œå¦‚æœæ¶ˆè´¹å¤±è´¥ï¼Œéœ€è¦å‘é€é‡è¯•æ¶ˆæ¯ï¼Œé‚£ä¹ˆæ­¤æ—¶consumerå°±å¯ä»¥é€šè¿‡produceræ¥å‘é€ä¸€æ¡é‡è¯•æ¶ˆæ¯äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1652169176,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1181055,"avatar":"https://static001.geekbang.org/account/avatar/00/12/05/7f/d35ab9a1.jpg","nickname":"z.l","note":"","ucode":"805CC5784D3F76","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1736650,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKyuuhxu0HH4cIKCClCqx0LTurCCYWmNcFwfTWV5te5afsibp2yuDmC9mibEHx0Xy8QlvqvMWWcAib8g/132","nickname":"æˆ‘çš„å–µ","note":"","ucode":"A7435BDBDD2587","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586886,"discussion_content":"ç¡®å®æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662565121,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":571284,"ip_address":"ä¸Šæµ·"},"score":586886,"extra":""}]},{"author":{"id":1610142,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/1R7lHGBvwPTVfb3BAQrPX3AhsYWnXyicbUJUYDgWagWxMGTnsNFvKibzeJ8v7fF2vJLQGf2EY9dV07rnn5Mhv9Uw/132","nickname":"å±±å¤´","note":"","ucode":"9CD45A7966F37E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":23651,"discussion_content":"å®¢æˆ·ç«¯ä¹Ÿéœ€è¦ç»™brokerå‘æ¶ˆæ¯å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569850269,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1181055,"avatar":"https://static001.geekbang.org/account/avatar/00/12/05/7f/d35ab9a1.jpg","nickname":"z.l","note":"","ucode":"805CC5784D3F76","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":19684,"discussion_content":"åœ¨DefaultMQPushConsumerImplçš„start()æ–¹æ³•ä¸­è°ƒç”¨äº†mQClientFactory.start()ã€‚mQClientFactory.start()ä¸­åˆæ‰§è¡Œäº†this.defaultMQProducer.getDefaultMQProducerImpl().start(false) å¯åŠ¨äº†producer","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569216860,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":133406,"user_name":"ç±³å…°é“åŒ ","can_delete":false,"product_type":"c1","uid":1647921,"ip_address":"","ucode":"C1BFE2EC2F12EC","user_header":"https://static001.geekbang.org/account/avatar/00/19/25/31/1ee460ab.jpg","comment_is_top":false,"comment_ctime":1568553709,"is_pvip":false,"replies":[{"id":"51338","content":"æˆ‘è¿˜æ˜¯å¸Œæœ›åŒå­¦ä»¬èƒ½é€šè¿‡å­¦ä¹ ï¼Œå…·å¤‡ç‹¬ç«‹åˆ†æä»£ç ï¼Œç‹¬ç«‹è®¾è®¡èƒ½åŠ›ï¼Œè¿™æ ·æ‰èƒ½æé«˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æç¥","uid":"1501046","ctime":1568683842,"ip_address":"","comment_id":133406,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1568553709","product_id":100032301,"comment_content":"ç”¨ä»£ç è·Ÿç±»å›¾æ¥è®²è§£ä¸€ä¸ªç³»ç»Ÿçš„å®ç°è¿˜æ˜¯å¤ªè¿‡äºæŠ½è±¡ï¼Œéš¾ä»¥æŠŠæ¡ä½ï¼Œæœ€å¥½çš„æ–¹å¼æ˜¯ç”¨è€å¸ˆç†è§£çš„ä¸œè¥¿ç„¶åè½¬æ¢æˆé€šä¿—æ˜“æ‡‚çš„åŸç†å›¾æ¥è®²è§£","like_count":0,"discussions":[{"author":{"id":1501046,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e7/76/79c1f23a.jpg","nickname":"æç¥","note":"","ucode":"B19E91EE248591","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467382,"discussion_content":"æˆ‘è¿˜æ˜¯å¸Œæœ›åŒå­¦ä»¬èƒ½é€šè¿‡å­¦ä¹ ï¼Œå…·å¤‡ç‹¬ç«‹åˆ†æä»£ç ï¼Œç‹¬ç«‹è®¾è®¡èƒ½åŠ›ï¼Œè¿™æ ·æ‰èƒ½æé«˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568683842,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132924,"user_name":"å¾®å¾®ä¸€ç¬‘","can_delete":false,"product_type":"c1","uid":1250327,"ip_address":"","ucode":"CFA7ABE81D0B99","user_header":"https://static001.geekbang.org/account/avatar/00/13/14/17/8763dced.jpg","comment_is_top":false,"comment_ctime":1568275570,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1568275570","product_id":100032301,"comment_content":"è€å¸ˆå¥½ï¼Œå…ˆç¥æ‚¨èŠ‚æ—¥å¿«ä¹ï¼ï¼ï¼æ‚¨è¾›è‹¦äº†~<br>æœ‰å‡ ä¸ªç–‘é—®éœ€è¦è€å¸ˆè§£ç­”ä¸€ä¸‹ï¼š<br>â‘ ä»Šå¤©åœ¨çœ‹rocketMqæºç è¿‡ç¨‹ä¸­ï¼Œå‘ç°DefaultMQProduceræœ‰ä¸ªå±æ€§defaultTopicQueueNumsï¼Œå®ƒæ˜¯ç”¨æ¥è®¾ç½®topicçš„ConsumeQueueçš„æ•°é‡çš„å—ï¼Ÿæˆ‘ä¹‹å‰çš„ç†è§£æ˜¯ï¼ŒconsumeQueueçš„æ•°é‡æ˜¯åˆ›å»ºtopicçš„æ—¶å€™æŒ‡å®šçš„ï¼Œè·Ÿproduceræ²¡æœ‰å…³ç³»ï¼Œé‚£è¿™ä¸ªå‚æ•°åˆæœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ<br>â‘¡åœ¨RocketMqçš„æ§åˆ¶å°ä¸Šå¯ä»¥åˆ›å»ºtopicï¼Œéœ€è¦æŒ‡å®šwriteQueueNumsï¼ŒreadQueueNumsï¼Œpermï¼Œè¿™ä¸‰ä¸ªå‚æ•°æ˜¯æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿè¿™é‡Œä¸ºä»€ä¹ˆè¦åŒºåˆ†å†™é˜Ÿåˆ—è·Ÿè¯»é˜Ÿåˆ—å‘¢ï¼Ÿä¸åº”è¯¥åªæœ‰ä¸€ä¸ªconsumeQueueå—ï¼Ÿ<br>â‘¢ç”¨æˆ·è¯·æ±‚--&gt;å¼‚æ­¥å¤„ç†---&gt;ç”¨æˆ·æ”¶åˆ°å“åº”ç»“æœã€‚å¼‚æ­¥å¤„ç†çš„ä½œç”¨æ˜¯ï¼šç”¨æ›´å°‘çš„çº¿ç¨‹æ¥æ¥æ”¶æ›´å¤šçš„ç”¨æˆ·è¯·æ±‚ï¼Œç„¶åå¼‚æ­¥å¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚è€å¸ˆï¼Œå¼‚æ­¥å¤„ç†å®Œåï¼Œå¦‚ä½•å°†ç»“æœé€šçŸ¥ç»™åŸå…ˆçš„ç”¨æˆ·å‘¢ï¼Ÿå³ä½¿æœ‰å›è°ƒæ¥å£ï¼Œæˆ‘ç†è§£ä¹Ÿæ˜¯ç»™ç”¨æˆ·å‘ä¸ªçŸ­ä¿¡ä¹‹ç±»çš„å¤„ç†ï¼Œé‚£ç»“æœæ€ä¹ˆè¿”å›åˆ°å®šä½åˆ°ç”¨æˆ·ï¼Œå¹¶è¿”å›ä¹‹å‰è¯·æ±‚çš„é¡µé¢ä¸Šå‘¢ï¼Ÿéœ€è¦è®©ä¹‹å‰çš„è¯·æ±‚çº¿ç¨‹é˜»å¡å—ï¼Ÿé‚£ä¹Ÿæ— æ³•è¾¾åˆ°ã€ç”¨æ›´å°‘çš„çº¿ç¨‹æ¥æ¥æ”¶æ›´å¤šçš„ç”¨æˆ·è¯·æ±‚ã€‘çš„ç›®çš„ä¸«ã€‚<br>æœ›è€å¸ˆèƒ½æŒ‡ç‚¹è¿·æ´¥~~~","like_count":0,"discussions":[{"author":{"id":1481811,"avatar":"https://static001.geekbang.org/account/avatar/00/16/9c/53/ade0afb0.jpg","nickname":"ub8","note":"","ucode":"0D937C3EAEB781","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":82932,"discussion_content":"å°´å°¬äº†æ²¡å›å¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576402133,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}