{"id":281054,"title":"07 æ¡ˆä¾‹ç¯‡ | å¦‚ä½•é¢„é˜²å†…å­˜æ³„æ¼å¯¼è‡´çš„ç³»ç»Ÿå‡æ­»ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é‚µäºšæ–¹ã€‚</p><p>ä¸ŠèŠ‚è¯¾ï¼Œæˆ‘ä»¬è®²äº†æœ‰å“ªäº›è¿›ç¨‹çš„å†…å­˜ç±»å‹ä¼šå®¹æ˜“å¼•èµ·å†…å­˜æ³„æ¼ï¼Œè¿™ä¸€è®²æˆ‘ä»¬æ¥èŠä¸€èŠï¼Œåˆ°åº•åº”è¯¥å¦‚ä½•åº”å¯¹å†…å­˜æ³„æ¼çš„é—®é¢˜ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œå†…å­˜æ³„æ¼æ˜¯ä»¶éå¸¸å®¹æ˜“å‘ç”Ÿçš„äº‹ï¼Œä½†å¦‚æœå®ƒä¸ä¼šç»™åº”ç”¨ç¨‹åºå’Œç³»ç»Ÿé€ æˆå±å®³ï¼Œé‚£å®ƒå°±ä¸ä¼šæ„æˆå¨èƒã€‚å½“ç„¶æˆ‘ä¸æ˜¯è¯´è¿™ç±»å†…å­˜æ³„æ¼æ— éœ€å»å…³å¿ƒï¼Œå¯¹è¿½æ±‚å®Œç¾çš„ç¨‹åºå‘˜è€Œè¨€ï¼Œè¿˜æ˜¯éœ€è¦å½»åº•åœ°è§£å†³æ‰å®ƒçš„ã€‚</p><p>è€Œæœ‰ä¸€äº›å†…å­˜æ³„æ¼ä½ å´éœ€è¦æ ¼å¤–é‡è§†ï¼Œæ¯”å¦‚è¯´é•¿æœŸè¿è¡Œçš„åå°è¿›ç¨‹çš„å†…å­˜æ³„æ¼ï¼Œè¿™ç§æ³„æ¼æ—¥ç§¯æœˆç´¯ï¼Œä¼šé€æ¸è€—å…‰ç³»ç»Ÿå†…å­˜ï¼Œç”šè‡³ä¼šå¼•èµ·ç³»ç»Ÿå‡æ­»ã€‚</p><p>æˆ‘ä»¬åœ¨äº†è§£å†…å­˜æ³„æ¼é€ æˆçš„å±å®³ä¹‹å‰ï¼Œå…ˆä¸€èµ·çœ‹ä¸‹ä»€ä¹ˆæ ·çš„å†…å­˜æ³„æ¼æ˜¯æœ‰å±å®³çš„ã€‚</p><h2>ä»€ä¹ˆæ ·çš„å†…å­˜æ³„æ¼æ˜¯æœ‰å±å®³çš„ï¼Ÿ</h2><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå†…å­˜æ³„æ¼çš„ç®€å•ç¤ºä¾‹ç¨‹åºã€‚</p><pre><code>#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\n#define SIZE (1024 * 1024 * 1024) /* 1G */\nint main()\n{\n    char *p = malloc(SIZE);\n    if (!p)\n      return -1;\n    \n    memset(p, 1, SIZE);\n    /* ç„¶åå°±å†ä¹Ÿä¸ä½¿ç”¨è¿™å—å†…å­˜ç©ºé—´ */\n    /* æ²¡æœ‰é‡Šæ”¾pæ‰€æŒ‡å‘çš„å†…å­˜è¿›ç¨‹å°±é€€å‡ºäº† */\n    /* free(p); */\n    return 0;\n}\n</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªç¨‹åºé‡Œé¢ç”³è¯·äº†1Gçš„å†…å­˜åï¼Œæ²¡æœ‰è¿›è¡Œé‡Šæ”¾å°±é€€å‡ºäº†ï¼Œé‚£è¿™1Gçš„å†…å­˜ç©ºé—´æ˜¯æ³„æ¼äº†å—ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªç®€å•çš„å†…å­˜æ³„æ¼æ£€æŸ¥å·¥å…·(valgrind)æ¥çœ‹çœ‹ã€‚</p><pre><code>$ valgrind --leak-check=full  ./a.out \n==20146== HEAP SUMMARY:\n==20146==     in use at exit: 1,073,741,824 bytes in 1 blocks\n==20146==   total heap usage: 1 allocs, 0 frees, 1,073,741,824 bytes allocated\n==20146== \n==20146== 1,073,741,824 bytes in 1 blocks are possibly lost in loss record 1 of 1\n==20146==    at 0x4C29F73: malloc (vg_replace_malloc.c:309)\n==20146==    by 0x400543: main (in /home/yafang/test/mmleak/a.out)\n==20146== \n==20146== LEAK SUMMARY:\n==20146==    definitely lost: 0 bytes in 0 blocks\n==20146==    indirectly lost: 0 bytes in 0 blocks\n==20146==      possibly lost: 1,073,741,824 bytes in 1 blocks\n==20146==    still reachable: 0 bytes in 0 blocks\n==20146==         suppressed: 0 bytes in 0 blocks\n</code></pre><p>ä»valgrindçš„æ£€æŸ¥ç»“æœé‡Œæˆ‘ä»¬å¯ä»¥æ¸…æ¥šåœ°çœ‹åˆ°ï¼Œç”³è¯·çš„å†…å­˜åªè¢«ä½¿ç”¨äº†ä¸€æ¬¡ï¼ˆmemsetï¼‰å°±å†æ²¡è¢«ä½¿ç”¨ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨å®Œåå´æ²¡æœ‰æŠŠè¿™æ®µå†…å­˜ç©ºé—´ç»™é‡Šæ”¾æ‰ï¼Œè¿™å°±æ˜¯å…¸å‹çš„å†…å­˜æ³„æ¼ã€‚é‚£è¿™ä¸ªå†…å­˜æ³„æ¼æ˜¯æœ‰å±å®³çš„å—ï¼Ÿ</p><p>è¿™å°±è¦ä»è¿›ç¨‹åœ°å€ç©ºé—´çš„åˆ†é…å’Œé”€æ¯æ¥è¯´èµ·ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºæ„å›¾ï¼š</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/e0/64/e0e227529ba7f2fcab1ab445c4634764.jpg?wh=3300*1950\" alt=\"\" title=\"è¿›ç¨‹åœ°å€ç©ºé—´ç”³è¯·å’Œé‡Šæ”¾ç¤ºæ„å›¾\"></p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œè¿›ç¨‹åœ¨é€€å‡ºçš„æ—¶å€™ï¼Œä¼šæŠŠå®ƒå»ºç«‹çš„æ˜ å°„éƒ½ç»™è§£é™¤æ‰ã€‚æ¢å¥è¯è¯´ï¼Œè¿›ç¨‹é€€å‡ºæ—¶ï¼Œä¼šæŠŠå®ƒç”³è¯·çš„å†…å­˜éƒ½ç»™é‡Šæ”¾æ‰ï¼Œè¿™ä¸ªå†…å­˜æ³„æ¼å°±æ˜¯æ²¡å±å®³çš„ã€‚ä¸è¿‡è¯è¯´å›æ¥ï¼Œè™½ç„¶è¿™æ ·æ²¡æœ‰ä»€ä¹ˆå±å®³ï¼Œä½†æ˜¯æˆ‘ä»¬æœ€å¥½è¿˜æ˜¯è¦åœ¨ç¨‹åºé‡ŒåŠ ä¸Šfree Â§ï¼Œè¿™æ‰æ˜¯ç¬¦åˆç¼–ç¨‹è§„èŒƒçš„ã€‚æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹è¿™ä¸ªç¨‹åºï¼ŒåŠ ä¸ŠfreeÂ§ï¼Œå†æ¬¡ç¼–è¯‘åé€šè¿‡valgrindæ¥æ£€æŸ¥ï¼Œå°±ä¼šå‘ç°ä¸å­˜åœ¨ä»»ä½•å†…å­˜æ³„æ¼äº†ï¼š</p><pre><code>$ valgrind --leak-check=full  ./a.out \n==20123== HEAP SUMMARY:\n==20123==     in use at exit: 0 bytes in 0 blocks\n==20123==   total heap usage: 1 allocs, 1 frees, 1,073,741,824 bytes allocated\n==20123== \n==20123== All heap blocks were freed -- no leaks are possible\n</code></pre><p>æ€»ä¹‹ï¼Œå¦‚æœè¿›ç¨‹ä¸æ˜¯é•¿æ—¶é—´è¿è¡Œï¼Œé‚£ä¹ˆå³ä½¿å­˜åœ¨å†…å­˜æ³„æ¼ï¼ˆæ¯”å¦‚è¿™ä¸ªä¾‹å­ä¸­çš„åªæœ‰mallocæ²¡æœ‰freeï¼‰ï¼Œå®ƒçš„å±å®³ä¹Ÿä¸å¤§ï¼Œå› ä¸ºè¿›ç¨‹é€€å‡ºæ—¶ï¼Œå†…æ ¸ä¼šæŠŠè¿›ç¨‹ç”³è¯·çš„å†…å­˜éƒ½ç»™é‡Šæ”¾æ‰ã€‚</p><p>æˆ‘ä»¬å‰é¢ä¸¾çš„è¿™ä¸ªä¾‹å­æ˜¯å¯¹åº”ç”¨ç¨‹åºæ— å®³çš„å†…å­˜æ³„æ¼ï¼Œæˆ‘ä»¬ç»§ç»­æ¥çœ‹ä¸‹å“ªäº›å†…å­˜æ³„æ¼ä¼šç»™åº”ç”¨ç¨‹åºäº§ç”Ÿå±å®³ ã€‚æˆ‘ä»¬åŒæ ·ä»¥mallocä¸ºä¾‹ï¼Œçœ‹ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ç¨‹åºï¼š</p><pre><code>#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;unistd.h&gt;\n\n#define SIZE (1024 * 1024 * 1024) /* 1G */\n\nvoid process_memory()\n{\n        char *p; \n        p = malloc(SIZE);\n        if (!p)\n                return;\n        memset(p, 1, SIZE);\n        /* Forget to free this memory */\n}\n\n/* å¤„ç†å…¶ä»–äº‹åŠ¡ï¼Œä¸ºäº†ç®€ä¾¿èµ·è§ï¼Œæˆ‘ä»¬å°±ä»¥sleepä¸ºä¾‹ */\nvoid process_others()\n{\n        sleep(1);\n}\n\n\nint main()\n{\n        /* è¿™éƒ¨åˆ†å†…å­˜åªå¤„ç†ä¸€æ¬¡ï¼Œä»¥åå†ä¹Ÿä¸ä¼šç”¨åˆ° */\n        process_memory();\n\n\n        /* è¿›ç¨‹ä¼šé•¿æ—¶é—´è¿è¡Œ */\n        while (1) {\n                process_others();\n        }   \n        return 0;\n</code></pre><p>è¿™æ˜¯ä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„ç¨‹åºï¼Œprocess_memory()ä¸­æˆ‘ä»¬ç”³è¯·äº†1Gçš„å†…å­˜å»ä½¿ç”¨ï¼Œç„¶åå°±å†ä¹Ÿä¸ç”¨å®ƒäº†ï¼Œç”±äºè¿™éƒ¨åˆ†å†…å­˜ä¸ä¼šå†è¢«åˆ©ç”¨ï¼Œè¿™å°±é€ æˆäº†å†…å­˜çš„æµªè´¹ï¼Œå¦‚æœè¿™æ ·çš„ç¨‹åºå¤šäº†ï¼Œè¢«æ³„æ¼å‡ºå»çš„å†…å­˜å°±ä¼šè¶Šæ¥è¶Šå¤šï¼Œç„¶åç³»ç»Ÿä¸­çš„å¯ç”¨å†…å­˜å°±ä¼šè¶Šæ¥è¶Šå°‘ã€‚</p><p>å¯¹äºåå°æœåŠ¡å‹çš„ä¸šåŠ¡è€Œè¨€ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯éœ€è¦é•¿æ—¶é—´è¿è¡Œçš„ç¨‹åºï¼Œæ‰€ä»¥åå°æœåŠ¡çš„å†…å­˜æ³„æ¼ä¼šç»™ç³»ç»Ÿé€ æˆå®é™…çš„å±å®³ã€‚é‚£ä¹ˆï¼Œç©¶ç«Ÿä¼šå¸¦æ¥ä»€ä¹ˆæ ·çš„å±å®³ï¼Œæˆ‘ä»¬åˆè¯¥å¦‚ä½•å»åº”å¯¹å‘¢ï¼Ÿ</p><h2>å¦‚ä½•é¢„é˜²å†…å­˜æ³„æ¼å¯¼è‡´çš„å±å®³ï¼Ÿ</h2><p>æˆ‘ä»¬è¿˜æ˜¯ä»¥ä¸Šé¢è¿™ä¸ªmalloc()ç¨‹åºä¸ºä¾‹ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒåªæ˜¯ç”³è¯·äº†1Gçš„å†…å­˜ï¼Œå¦‚æœè¯´æŒç»­ä¸æ–­åœ°ç”³è¯·å†…å­˜è€Œä¸é‡Šæ”¾ï¼Œä½ ä¼šå‘ç°ï¼Œå¾ˆå¿«ç³»ç»Ÿå†…å­˜å°±ä¼šè¢«è€—å°½ï¼Œè¿›è€Œè§¦å‘OOM killerå»æ€è¿›ç¨‹ã€‚è¿™ä¸ªä¿¡æ¯å¯ä»¥é€šè¿‡dmesgï¼ˆè¯¥å‘½ä»¤æ˜¯ç”¨æ¥æŸ¥çœ‹å†…æ ¸æ—¥å¿—çš„ï¼‰è¿™ä¸ªå‘½ä»¤æ¥æŸ¥çœ‹ï¼š</p><pre><code>$ dmesg\n[944835.029319] a.out invoked oom-killer: gfp_mask=0x100dca(GFP_HIGHUSER_MOVABLE|__GFP_ZERO), order=0, oom_score_adj=0\n[...]\n[944835.052448] Out of memory: Killed process 1426 (a.out) total-vm:8392864kB, anon-rss:7551936kB, file-rss:4kB, shmem-rss:0kB, UID:0 pgtables:14832kB oom_score_adj:0\n</code></pre><p>ç³»ç»Ÿå†…å­˜ä¸è¶³æ—¶ä¼šå”¤é†’OOM killeræ¥é€‰æ‹©ä¸€ä¸ªè¿›ç¨‹ç»™æ€æ‰ï¼Œåœ¨æˆ‘ä»¬è¿™ä¸ªä¾‹å­ä¸­å®ƒæ€æ‰äº†è¿™ä¸ªæ­£åœ¨å†…å­˜æ³„æ¼çš„ç¨‹åºï¼Œè¯¥è¿›ç¨‹è¢«æ€æ‰åï¼Œæ•´ä¸ªç³»ç»Ÿä¹Ÿå°±å˜å¾—å®‰å…¨äº†ã€‚ä½†æ˜¯ä½ è¦æ³¨æ„ï¼Œ<strong>OOM killeré€‰æ‹©è¿›ç¨‹æ˜¯æœ‰ç­–ç•¥çš„ï¼Œå®ƒæœªå¿…ä¸€å®šä¼šæ€æ‰æ­£åœ¨å†…å­˜æ³„æ¼çš„è¿›ç¨‹ï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯ä¸€ä¸ªæ— è¾œçš„è¿›ç¨‹è¢«æ€æ‰ã€‚</strong>è€Œä¸”ï¼ŒOOMæœ¬èº«ä¹Ÿä¼šå¸¦æ¥ä¸€äº›å‰¯ä½œç”¨ã€‚</p><p>æˆ‘æ¥è¯´ä¸€ä¸ªå‘ç”Ÿåœ¨ç”Ÿäº§ç¯å¢ƒä¸­çš„å®é™…æ¡ˆä¾‹ï¼Œè¿™ä¸ªæ¡ˆä¾‹æˆ‘ä¹Ÿæ›¾ç»<a href=\"https://lore.kernel.org/linux-mm/1586597774-6831-1-git-send-email-laoar.shao@gmail.com/\">åé¦ˆç»™Linuxå†…æ ¸ç¤¾åŒºæ¥åšæ”¹è¿›</a>ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¯¦ç»†è¯´ä¸€ä¸‹å®ƒã€‚</p><p>è¿™ä¸ªæ¡ˆä¾‹è·ŸOOMæ—¥å¿—æœ‰å…³ï¼ŒOOMæ—¥å¿—å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªå•ç”Ÿäº§è€…å¤šæ¶ˆè´¹è€…çš„æ¨¡å‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/b3/a7/b39503a3fb39e731d2d4c51687db70a7.jpg?wh=2758*1591\" alt=\"\" title=\"OOM info\"></p><p>è¿™ä¸ªå•ç”Ÿäº§è€…å¤šæ¶ˆè´¹è€…æ¨¡å‹ï¼Œå…¶å®æ˜¯ç”±OOM killeræ‰“å°æ—¥å¿—ï¼ˆOOM infoï¼‰æ—¶æ‰€ä½¿ç”¨çš„printkï¼ˆç±»ä¼¼äºuserspaceçš„printfï¼‰æœºåˆ¶æ¥å†³å®šçš„ã€‚printkä¼šæ£€æŸ¥è¿™äº›æ—¥å¿—éœ€è¦è¾“å‡ºç»™å“ªäº›æ¶ˆè´¹è€…ï¼Œæ¯”å¦‚å†™å…¥åˆ°å†…æ ¸ç¼“å†²åŒºï¼ˆkernel bufferï¼‰ï¼Œç„¶åé€šè¿‡dmesgå‘½ä»¤æ¥æŸ¥çœ‹ï¼›æˆ‘ä»¬é€šå¸¸ä¹Ÿéƒ½ä¼šé…ç½®rsyslogï¼Œç„¶årsyslogdä¼šå°†å†…æ ¸ç¼“å†²åŒºçš„å†…å®¹ç»™è½¬å‚¨åˆ°æ—¥å¿—æ–‡ä»¶ï¼ˆ/var/log/messagesï¼‰ä¸­ï¼›æœåŠ¡å™¨ä¹Ÿå¯èƒ½ä¼šè¿ç€ä¸€äº›æ§åˆ¶å°ï¼ˆconsole ï¼‰ï¼Œæ¯”å¦‚ä¸²å£ï¼Œè¿™äº›æ—¥å¿—ä¹Ÿä¼šè¾“å‡ºåˆ°è¿™äº›consoleã€‚</p><p>é—®é¢˜å°±å‡ºåœ¨consoleè¿™é‡Œï¼Œå¦‚æœconsoleçš„é€Ÿç‡å¾ˆæ…¢ï¼Œè¾“å‡ºå¤ªå¤šæ—¥å¿—ä¼šéå¸¸æ¶ˆè€—æ—¶é—´ï¼Œè€Œå½“æ—¶æˆ‘ä»¬é…ç½®äº†â€œconsole=ttyS1,19200â€ï¼Œå³æ³¢ç‰¹ç‡ä¸º19200çš„ä¸²å£ï¼Œè¿™æ˜¯ä¸ªå¾ˆä½é€Ÿç‡çš„ä¸²å£ã€‚ä¸€ä¸ªå®Œæ•´çš„OOM infoéœ€è¦çº¦10sæ‰èƒ½æ‰“å°å®Œï¼Œè¿™åœ¨ç³»ç»Ÿå†…å­˜ç´§å¼ æ—¶å°±ä¼šæˆä¸ºä¸€ä¸ªç“¶é¢ˆç‚¹ï¼Œä¸ºä»€ä¹ˆä¼šæ˜¯ç“¶é¢ˆç‚¹å‘¢ï¼Ÿç­”æ¡ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/2c/e7/2c4e5452584e9a1525921dffbdfda4e7.jpg?wh=4153*2088\" alt=\"\" title=\"OOMä¸ºä»€ä¹ˆä¼šæˆä¸ºç“¶é¢ˆç‚¹\"></p><p>è¿›ç¨‹Aåœ¨ç”³è¯·å†…å­˜å¤±è´¥åä¼šè§¦å‘OOMï¼Œåœ¨å‘ç”ŸOOMçš„æ—¶å€™ä¼šæ‰“å°å¾ˆå¤šå¾ˆå¤šæ—¥å¿—ï¼ˆè¿™äº›æ—¥å¿—æ˜¯ä¸ºäº†æ–¹ä¾¿åˆ†æä¸ºä»€ä¹ˆOOMä¼šå‘ç”Ÿï¼‰ï¼Œç„¶åä¼šé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„è¿›ç¨‹æ¥æ€æ‰ï¼Œä»è€Œé‡Šæ”¾å‡ºæ¥ç©ºé—²çš„å†…å­˜ï¼Œè¿™äº›ç©ºé—²çš„å†…å­˜å°±å¯ä»¥æ»¡è¶³åç»­å†…å­˜ç”³è¯·äº†ã€‚</p><p>å¦‚æœè¿™ä¸ªOOMçš„è¿‡ç¨‹è€—æ—¶å¾ˆé•¿ï¼ˆå³æ‰“å°åˆ°slow consoleæ‰€éœ€çš„æ—¶é—´å¤ªé•¿ï¼Œå¦‚ä¸Šå›¾çº¢è‰²éƒ¨åˆ†æ‰€ç¤ºï¼‰ï¼Œå…¶ä»–è¿›ç¨‹ï¼ˆè¿›ç¨‹Bï¼‰ä¹Ÿåœ¨æ­¤æ—¶ç”³è¯·å†…å­˜ï¼Œä¹Ÿä¼šç”³è¯·å¤±è´¥ï¼Œäºæ˜¯è¿›ç¨‹BåŒæ ·ä¹Ÿä¼šè§¦å‘OOMæ¥å°è¯•é‡Šæ”¾å†…å­˜ï¼Œè€ŒOOMè¿™é‡Œåˆæœ‰ä¸€ä¸ªå…¨å±€é”ï¼ˆoom_lockï¼‰æ¥è¿›è¡Œä¿æŠ¤ï¼Œè¿›ç¨‹Bå°è¯•è·å–ï¼ˆtrylockï¼‰è¿™ä¸ªé”çš„æ—¶å€™ä¼šå¤±è´¥ï¼Œå°±åªèƒ½å†æ¬¡é‡è¯•ã€‚</p><p>å¦‚æœæ­¤æ—¶ç³»ç»Ÿä¸­æœ‰å¾ˆå¤šè¿›ç¨‹éƒ½åœ¨ç”³è¯·å†…å­˜ï¼Œé‚£ä¹ˆè¿™äº›ç”³è¯·å†…å­˜çš„è¿›ç¨‹éƒ½ä¼šè¢«é˜»å¡åœ¨è¿™é‡Œï¼Œè¿™å°±å½¢æˆäº†ä¸€ä¸ªæ¶æ€§å¾ªç¯ï¼Œç”šè‡³ä¼šå¼•å‘ç³»ç»Ÿé•¿æ—¶é—´æ— å“åº”ï¼ˆå‡æ­»ï¼‰ã€‚</p><p>é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä¸Linuxå†…æ ¸å†…å­˜å­ç³»ç»Ÿçš„ç»´æŠ¤è€…Michal Hockoä»¥åŠOOMå­æ¨¡å—çš„æ´»è·ƒå¼€å‘è€…Tetsuo Handaè¿›è¡Œäº†<a href=\"https://lore.kernel.org/linux-mm/1586597774-6831-1-git-send-email-laoar.shao@gmail.com/\">ä¸€äº›è®¨è®º</a>ï¼Œä¸è¿‡æˆ‘ä»¬å¹¶æ²¡æœ‰è®¨è®ºå‡ºä¸€ä¸ªå®Œç¾çš„è§£å†³æ–¹æ¡ˆï¼Œç›®å‰ä»ç„¶æ˜¯åªæœ‰ä¸€äº›è§„é¿æªæ–½ï¼Œå¦‚ä¸‹ï¼š</p><ul>\n<li>\n<p><strong>åœ¨å‘ç”ŸOOMæ—¶å°½å¯èƒ½å°‘åœ°æ‰“å°ä¿¡æ¯</strong><br>\né€šè¿‡å°†<a href=\"https://www.kernel.org/doc/Documentation/sysctl/vm.txt\">vm.oom_dump_tasks</a>è°ƒæ•´ä¸º0ï¼Œå¯ä»¥ä¸å»å¤‡ä»½ï¼ˆdumpï¼‰å½“å‰ç³»ç»Ÿä¸­æ‰€æœ‰å¯è¢«killçš„è¿›ç¨‹ä¿¡æ¯ï¼Œå¦‚æœç³»ç»Ÿä¸­æœ‰å¾ˆå¤šè¿›ç¨‹ï¼Œè¿™äº›ä¿¡æ¯çš„æ‰“å°å¯èƒ½ä¼šéå¸¸æ¶ˆè€—æ—¶é—´ã€‚åœ¨æˆ‘ä»¬è¿™ä¸ªæ¡ˆä¾‹é‡Œï¼Œè¿™éƒ¨åˆ†è€—æ—¶çº¦ä¸º6så¤šï¼Œå OOMæ•´ä½“è€—æ—¶10sçš„ä¸€å¤šåŠï¼Œæ‰€ä»¥å‡å°‘è¿™éƒ¨åˆ†çš„æ‰“å°èƒ½å¤Ÿç¼“è§£è¿™ä¸ªé—®é¢˜ã€‚</p>\n<p>ä½†æ˜¯ï¼Œ<strong>è¿™å¹¶ä¸æ˜¯ä¸€ä¸ªå®Œç¾çš„æ–¹æ¡ˆï¼Œåªæ˜¯ä¸€ä¸ªè§„é¿æªæ–½</strong>ã€‚å› ä¸ºå½“æˆ‘ä»¬æŠŠvm.oom_dump_tasksé…ç½®ä¸º1æ—¶ï¼Œæ˜¯å¯ä»¥é€šè¿‡è¿™äº›æ‰“å°çš„ä¿¡æ¯æ¥æ£€æŸ¥OOM killeræ˜¯å¦é€‰æ‹©äº†åˆç†çš„è¿›ç¨‹ï¼Œä»¥åŠç³»ç»Ÿä¸­æ˜¯å¦å­˜åœ¨ä¸åˆç†çš„OOMé…ç½®ç­–ç•¥çš„ã€‚å¦‚æœæˆ‘ä»¬å°†å®ƒé…ç½®ä¸º0ï¼Œå°±æ— æ³•å¾—åˆ°è¿™äº›ä¿¡æ¯äº†ï¼Œè€Œä¸”è¿™äº›ä¿¡æ¯ä¸ä»…ä¸ä¼šæ‰“å°åˆ°ä¸²å£ï¼Œä¹Ÿä¸ä¼šæ‰“å°åˆ°å†…æ ¸ç¼“å†²åŒºï¼Œå¯¼è‡´æ— æ³•è¢«è½¬å‚¨åˆ°ä¸ä¼šäº§ç”Ÿé—®é¢˜çš„æ—¥å¿—æ–‡ä»¶ä¸­ã€‚</p>\n</li>\n<li>\n<p><strong>è°ƒæ•´ä¸²å£æ‰“å°çº§åˆ«ï¼Œä¸å°†OOMä¿¡æ¯æ‰“å°åˆ°ä¸²å£</strong><br>\né€šè¿‡è°ƒæ•´<a href=\"https://www.kernel.org/doc/Documentation/sysctl/kernel.txt\">/proc/sys/kernel/printk</a>å¯ä»¥åšåˆ°é¿å…å°†OOMä¿¡æ¯è¾“å‡ºåˆ°ä¸²å£ï¼Œæˆ‘ä»¬é€šè¿‡è®¾ç½®console_loglevelæ¥å°†å®ƒçš„çº§åˆ«è®¾ç½®çš„æ¯”OOMæ—¥å¿—çº§åˆ«ï¼ˆä¸º4ï¼‰å°ï¼Œå°±å¯ä»¥é¿å…OOMçš„ä¿¡æ¯æ‰“å°åˆ°consoleï¼Œæ¯”å¦‚å°†å®ƒè®¾ç½®ä¸º3:</p>\n</li>\n</ul><pre><code># åˆå§‹é…ç½®(ä¸º7)ï¼šæ‰€æœ‰ä¿¡æ¯éƒ½ä¼šè¾“å‡ºåˆ°console\n$ cat /proc/sys/kernel/printk\n7\t4\t1\t7\n\n# è°ƒæ•´console_loglevelçº§åˆ«ï¼Œä¸è®©OOMä¿¡æ¯æ‰“å°åˆ°console\n$ echo &quot;3 4 1 7&quot; &gt; /proc/sys/kernel/printk\n\n# æŸ¥çœ‹è°ƒæ•´åçš„é…ç½®\n$ cat /proc/sys/kernel/printk\n3\t4\t1\t\n</code></pre><p>ä½†æ˜¯è¿™æ ·åšä¼šå¯¼è‡´æ‰€æœ‰ä½äºé»˜è®¤çº§åˆ«ï¼ˆä¸º4ï¼‰çš„å†…æ ¸æ—¥å¿—éƒ½æ— æ³•è¾“å‡ºåˆ°consoleï¼Œåœ¨ç³»ç»Ÿå‡ºç°é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬æœ‰æ—¶å€™ï¼ˆæ¯”å¦‚æ— æ³•ç™»å½•åˆ°æœåŠ¡å™¨ä¸Šé¢æ—¶ï¼‰ä¼šéœ€è¦æŸ¥çœ‹consoleä¿¡æ¯æ¥åˆ¤æ–­é—®é¢˜æ˜¯ä»€ä¹ˆå¼•èµ·çš„ï¼Œå¦‚æœæŸäº›ä¿¡æ¯æ²¡æœ‰è¢«æ‰“å°åˆ°consoleï¼Œå¯èƒ½ä¼šå½±å“æˆ‘ä»¬çš„åˆ†æã€‚</p><p>è¿™ä¸¤ç§è§„é¿æ–¹æ¡ˆå„æœ‰åˆ©å¼Šï¼Œä½ éœ€è¦æ ¹æ®ä½ çš„å®é™…æƒ…å†µæ¥åšé€‰æ‹©ï¼Œå¦‚æœä½ ä¸æ¸…æ¥šæ€ä¹ˆé€‰æ‹©æ—¶ï¼Œæˆ‘å»ºè®®ä½ é€‰æ‹©ç¬¬äºŒç§ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨consoleçš„æ¦‚ç‡è¿˜æ˜¯è¾ƒå°‘ä¸€äº›ï¼Œæ‰€ä»¥ç¬¬äºŒç§æ–¹æ¡ˆçš„å½±å“ä¹Ÿç›¸å¯¹è¾ƒå°ä¸€äº›ã€‚</p><p>OOMç›¸å…³çš„ä¸€äº›æ—¥å¿—è¾“å‡ºåï¼Œå°±åˆ°äº†ä¸‹ä¸€ä¸ªé˜¶æ®µï¼šé€‰æ‹©ä¸€ä¸ªæœ€éœ€è¦æ€æ­»çš„è¿›ç¨‹æ¥æ€æ‰ã€‚OOM killeråœ¨é€‰æ‹©æ€æ‰å“ªä¸ªè¿›ç¨‹æ—¶ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„è¿‡ç¨‹ï¼Œè€Œä¸”å¦‚æœé…ç½®ä¸å½“ä¹Ÿä¼šå¼•èµ·å…¶ä»–é—®é¢˜ã€‚å…³äºè¿™éƒ¨åˆ†çš„æ¡ˆä¾‹ï¼Œæˆ‘ä»¬ä¼šåœ¨ä¸‹èŠ‚è¯¾æ¥åˆ†æã€‚</p><h2>è¯¾å ‚æ€»ç»“</h2><p>è¿™èŠ‚è¯¾æˆ‘ä»¬è®²äº†ä»€ä¹ˆæ˜¯å†…å­˜æ³„æ¼ï¼Œä»¥åŠå†…å­˜æ³„æ¼å¯èƒ½é€ æˆçš„å±å®³ã€‚å¯¹äºé•¿æ—¶é—´è¿è¡Œçš„åå°ä»»åŠ¡è€Œè¨€ï¼Œå®ƒå­˜åœ¨çš„å†…å­˜æ³„æ¼å¯èƒ½ä¼šç»™ç³»ç»Ÿå¸¦æ¥æ¯”è¾ƒä¸¥é‡çš„å±å®³ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸€å®šè¦é‡è§†è¿™äº›ä»»åŠ¡çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚</p><p>å†…å­˜æ³„æ¼é—®é¢˜æ˜¯éå¸¸å®¹æ˜“å‘ç”Ÿçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æå‰åšå¥½å†…å­˜æ³„æ¼çš„å…œåº•å·¥ä½œï¼šå³ä½¿æœ‰æ³„æ¼äº†ä¹Ÿä¸è¦è®©å®ƒç»™ç³»ç»Ÿå¸¦æ¥å¾ˆå¤§çš„å±å®³ã€‚é•¿æ—¶é—´çš„å†…å­˜æ³„æ¼é—®é¢˜æœ€ååŸºæœ¬éƒ½ä¼šä»¥OOMç»“æŸï¼Œæ‰€ä»¥ä½ éœ€è¦å»æŒæ¡OOMçš„ç›¸å…³çŸ¥è¯†ï¼Œæ¥åšå¥½è¿™ä¸ªå…œåº•å·¥ä½œã€‚</p><p>å¦‚æœä½ çš„æœåŠ¡å™¨æœ‰æ…¢é€Ÿçš„ä¸²å£è®¾å¤‡ï¼Œé‚£ä½ ä¸€å®šè¦é˜²æ­¢å®ƒæ¥æ”¶å¤ªå¤šçš„æ—¥å¿—ï¼Œå°¤å…¶æ˜¯OOMäº§ç”Ÿçš„æ—¥å¿—ï¼Œå› ä¸ºOOMçš„æ—¥å¿—é‡æ˜¯å¾ˆå¤§çš„ï¼Œæ‰“å°å®Œæ•´ä¸ªOOMä¿¡æ¯kennelä¼šå¾ˆè€—æ—¶ï¼Œè¿›è€Œå¯¼è‡´é˜»å¡ç”³è¯·å†…å­˜çš„è¿›ç¨‹ï¼Œç”šè‡³ä¼šä¸¥é‡åˆ°è®©æ•´ä¸ªç³»ç»Ÿå‡æ­»ã€‚</p><p>å¢¨è²å®šå¾‹å‘Šè¯‰æˆ‘ä»¬ï¼Œå¦‚æœäº‹æƒ…æœ‰å˜åçš„å¯èƒ½ï¼Œä¸ç®¡è¿™ç§å¯èƒ½æ€§æœ‰å¤šå°ï¼Œå®ƒæ€»ä¼šå‘ç”Ÿã€‚å¯¹åº”åˆ°å†…å­˜æ³„æ¼å°±æ˜¯ï¼Œå½“ä½ çš„ç³»ç»Ÿè¶³å¤Ÿå¤æ‚åï¼Œå®ƒæ€»æ˜¯å¯èƒ½ä¼šå‘ç”Ÿçš„ã€‚æ‰€ä»¥ï¼Œå¯¹äºå†…å­˜æ³„æ¼é—®é¢˜ï¼Œä½ åœ¨åšå¥½é¢„é˜²çš„åŒæ—¶ï¼Œä¹Ÿä¸€å®šè¦å¯¹å®ƒå‘ç”Ÿåå¯èƒ½å¸¦æ¥çš„å±å®³åšå¥½é¢„é˜²ã€‚</p><h2>è¯¾åä½œä¸š</h2><p>è¯·å†™ä¸€äº›åº”ç”¨ç¨‹åºæ¥æ„é€ å†…å­˜æ³„æ¼çš„æµ‹è¯•ç”¨ä¾‹ï¼Œç„¶åä½¿ç”¨valgrindæ¥è¿›è¡Œè§‚å¯Ÿã€‚æ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„çœ‹æ³•ã€‚</p><p>æ„Ÿè°¢ä½ çš„é˜…è¯»ï¼Œå¦‚æœä½ è®¤ä¸ºè¿™èŠ‚è¯¾çš„å†…å®¹æœ‰æ”¶è·ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™ä½ çš„æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²è§ã€‚</p>","neighbors":{"left":{"article_title":"06  åŸºç¡€ç¯‡ | è¿›ç¨‹çš„å“ªäº›å†…å­˜ç±»å‹å®¹æ˜“å¼•èµ·å†…å­˜æ³„æ¼ï¼Ÿ","id":280455},"right":{"article_title":"08 æ¡ˆä¾‹ç¯‡ | Shmemï¼šè¿›ç¨‹æ²¡æœ‰æ¶ˆè€—å†…å­˜ï¼Œå†…å­˜å“ªå»äº†ï¼Ÿ","id":282129}},"comments":[{"had_liked":false,"id":257929,"user_name":"è«å","can_delete":false,"product_type":"c1","uid":1007254,"ip_address":"","ucode":"E28F2602BA25DD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5e/96/a03175bc.jpg","comment_is_top":false,"comment_ctime":1604216681,"is_pvip":false,"replies":[{"id":"94332","content":"å—¯ bcc memleakä¹Ÿæ˜¯ä¸ªå¾ˆå¥½çš„åˆ†æå·¥å…· å°±æ˜¯å®ƒå¯¹å†…æ ¸ç‰ˆæœ¬è¦æ±‚é«˜ éœ€è¦è¾ƒæ–°çš„å†…æ ¸æ‰è¡Œ","user_name":"ä½œè€…å›å¤","comment_id":257929,"uid":"1981399","ip_address":"","utype":1,"ctime":1604761366,"user_name_real":"é‚µäºšæ–¹"}],"discussion_count":1,"race_medal":0,"score":"40258922345","product_id":100058001,"comment_content":"valgrind è™½ç„¶å¾ˆå¼ºå¤§ï¼Œä½†å¤ªæ…¢äº†ï¼Œæ¨è bcc memleak å·¥å…·ã€‚ğŸ˜€","like_count":10,"discussions":[{"author":{"id":1981399,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/3b/d7/9d942870.jpg","nickname":"é‚µäºšæ–¹","note":"","ucode":"CDFABCB81B9782","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":508500,"discussion_content":"å—¯ bcc memleakä¹Ÿæ˜¯ä¸ªå¾ˆå¥½çš„åˆ†æå·¥å…· å°±æ˜¯å®ƒå¯¹å†…æ ¸ç‰ˆæœ¬è¦æ±‚é«˜ éœ€è¦è¾ƒæ–°çš„å†…æ ¸æ‰è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604761366,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":245976,"user_name":"ä¸å€’ç¿","can_delete":false,"product_type":"c1","uid":1273429,"ip_address":"","ucode":"132C4F3B0575B9","user_header":"https://static001.geekbang.org/account/avatar/00/13/6e/55/9100b47c.jpg","comment_is_top":false,"comment_ctime":1599123684,"is_pvip":false,"replies":[{"id":"90429","content":"è°¢è°¢ä½ çš„å»ºè®®ã€‚è¿™æ ·æˆ‘ä¹Ÿè€ƒè™‘è¿‡ï¼Œåªæ˜¯æˆ‘ä»¬æ„Ÿè§‰è¿™æœ‰ç‚¹åƒåº”è¯•æ•™è‚²å…ˆå‡ºé¢˜å†è¯´ç­”æ¡ˆï¼Œæˆ‘ä¸»è¦æ˜¯æ‹…å¿ƒè¿™ä¼šå±€é™ä½å¤§å®¶çš„æ€ç»´ã€‚æ‰€ä»¥æˆ‘åœ¨æ¡ˆä¾‹ç¯‡é‡Œä¸€èˆ¬éƒ½æ˜¯æŠŠå…·ä½“é—®é¢˜ç»™åšä¸€ä¸ªæŠ½è±¡ï¼Œèƒ½å¤Ÿè®©å¤§å®¶ä¸å±€é™äºæŸä¸€ä¸ªé—®é¢˜ï¼Œè€Œæ˜¯é€šè¿‡è¿™äº›æŠ½è±¡çš„æ¡ˆä¾‹æ¥ç†è§£é—®é¢˜çš„æœ¬è´¨ã€‚","user_name":"ä½œè€…å›å¤","comment_id":245976,"uid":"1981399","ip_address":"","utype":1,"ctime":1599145965,"user_name_real":"é‚µäºšæ–¹"}],"discussion_count":1,"race_medal":0,"score":"35958862052","product_id":100058001,"comment_content":"æä¸ªè§è®®ï¼šæ¡ˆä¾‹è¿™æ–¹é¢ï¼Œæ•™å¸ˆèƒ½å¦æ”¹å˜ä¸€ä¸‹è®²è¯¾é¡ºåº<br>è¿è¡Œä¸€ä¸ªæœ‰é—®é¢˜çš„ç¨‹åº(ä¸çœ‹æºç )--&gt;è§‚å¯Ÿç³»ç»ŸæŒ‡æ ‡å‘ç°å¯èƒ½æ˜¯å†…å­˜æ³„æ¼ --&gt;ç”¨å·¥å…·æ‰¾åˆ°é—®é¢˜ç¨‹åº --&gt;åˆ†æå¯èƒ½æ˜¯å“ªæ–¹é¢çš„é—®é¢˜--&gt;æŸ¥çœ‹æºç  --&gt;é—®é¢˜èƒŒåçš„åŸç†ç­‰  ","like_count":9,"discussions":[{"author":{"id":1981399,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/3b/d7/9d942870.jpg","nickname":"é‚µäºšæ–¹","note":"","ucode":"CDFABCB81B9782","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505025,"discussion_content":"è°¢è°¢ä½ çš„å»ºè®®ã€‚è¿™æ ·æˆ‘ä¹Ÿè€ƒè™‘è¿‡ï¼Œåªæ˜¯æˆ‘ä»¬æ„Ÿè§‰è¿™æœ‰ç‚¹åƒåº”è¯•æ•™è‚²å…ˆå‡ºé¢˜å†è¯´ç­”æ¡ˆï¼Œæˆ‘ä¸»è¦æ˜¯æ‹…å¿ƒè¿™ä¼šå±€é™ä½å¤§å®¶çš„æ€ç»´ã€‚æ‰€ä»¥æˆ‘åœ¨æ¡ˆä¾‹ç¯‡é‡Œä¸€èˆ¬éƒ½æ˜¯æŠŠå…·ä½“é—®é¢˜ç»™åšä¸€ä¸ªæŠ½è±¡ï¼Œèƒ½å¤Ÿè®©å¤§å®¶ä¸å±€é™äºæŸä¸€ä¸ªé—®é¢˜ï¼Œè€Œæ˜¯é€šè¿‡è¿™äº›æŠ½è±¡çš„æ¡ˆä¾‹æ¥ç†è§£é—®é¢˜çš„æœ¬è´¨ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1599145965,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":246013,"user_name":"å¤§é£å“¥","can_delete":false,"product_type":"c1","uid":1046810,"ip_address":"","ucode":"DEBAE3967CA0D3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f9/1a/d289c2ac.jpg","comment_is_top":false,"comment_ctime":1599132193,"is_pvip":false,"replies":[{"id":"90455","content":"åœ¨å‡ºç°è¿™ç§å‡æ­»é—®é¢˜æ—¶éœ€è¦é¦–å…ˆæƒ³åŠæ³•æ¥ä¿å­˜äº‹æ•…ç°åœºï¼Œæœ‰äº†è¿™äº›ç°åœºåå°±å¯ä»¥åˆ†æå…·ä½“åŸå› äº†ï¼Œlockdepå’Œsoftlockupè¿™äº›éƒ½å¯ä»¥è®¤ä¸ºæ˜¯å†…æ ¸é—®é¢˜ï¼Œæ‰€ä»¥æœ€å¥½å¯ä»¥æ„é€ å‡ºæ¥vmcoreæ¥è¿›è¡Œåˆ†æï¼Œæˆ‘é€šå¸¸æ˜¯ä½¿ç”¨sysyrqæ¥æ„é€ å‡ºæ¥vmcoreï¼Œç„¶ååˆ†æè¿™äº›vmcoreã€‚è¿™é‡Œæœ‰ä¸ªé—®é¢˜æ—¶ï¼Œå¾€å¾€å‘ç”Ÿé—®é¢˜çš„æ—¶å€™å°±æ²¡æœ‰åŠæ³•æ¥æ‰§è¡Œå‘½ä»¤äº†ï¼Œæ‰€ä»¥æ ¹æ®ä¸€äº›ä¿¡æ¯æ¥æå‰åšå¥½é¢„åˆ¤å¾ˆé‡è¦ï¼Œæ¯”å¦‚æ ¹æ®loadå€¼è¾¾åˆ°å¤šå°‘å°±è®¤ä¸ºå¼‚å¸¸äº†ï¼Œæˆ–è€…åˆ©ç”¨å…¶ä»–ä¸€äº›ç³»ç»ŸæŒ‡æ ‡ï¼Œæ¯”å¦‚å†…å­˜å¼•èµ·çš„å‡æ­»å¯ä»¥å€ŸåŠ©psiæŒ‡æ ‡æ¥åšé¢„åˆ¤ã€‚åœ¨æ„é€ vmcoreæ—¶ï¼Œå¦‚æœæ˜¯ç£ç›˜æ•…éšœæˆ–è€…æ–‡ä»¶ç³»ç»Ÿå‡ºäº†é—®é¢˜ï¼Œé‚£è¿™ä¸ªvmcoreä¹Ÿå¯èƒ½æ— æ³•ä¿å­˜ä¸‹æ¥ï¼Œè¿™ä¸ªæ—¶å€™å€ŸåŠ©ç½‘ç»œæŠŠè¿™äº›ä¿¡æ¯ç»™å¯¼å‡ºæ¥ä¹Ÿæ˜¯ä¸€ä¸ªæ–¹æ¡ˆï¼ŒåµŒå…¥å¼ç³»ç»Ÿä¸­å¸¸ç”¨çš„åšæ³•è¿™æ˜¯æŠŠä»–ä»¬ä¿å­˜åœ¨éæ˜“å¤±å†…å­˜ä¸­ï¼Œç„¶åé‡å¯åè§£æè¿™äº›éæ˜“å¤±å†…å­˜ã€‚<br><br>","user_name":"ä½œè€…å›å¤","comment_id":246013,"uid":"1981399","ip_address":"","utype":1,"ctime":1599194301,"user_name_real":"é‚µäºšæ–¹"}],"discussion_count":2,"race_medal":0,"score":"23073968673","product_id":100058001,"comment_content":"å¤ªæ£’äº†ï¼Œè°¢è°¢è€å¸ˆï¼æœ€è¿‘é¡¹ç›®ä¹Ÿå‡ºç°è¿‡å‡æ­»çš„ç°è±¡ï¼Œlockdepã€soft lockç­‰ï¼Œç°åœ¨è¿˜æ²¡æ‰¾åˆ°å¥½çš„æ–¹æ³•å»æŸ¥æ‰¾å’Œå®šä½ï¼Œæœ›è€å¸ˆæŒ‡æ•™ã€‚ä¹‹å‰ä¹Ÿå‡ºç°è¿‡æ‰“å°æ—¥å¿—æ‹‰æ…¢ç³»ç»Ÿæ€§èƒ½çš„æƒ…å†µï¼Œåé¢ä¹Ÿå‘ç°æ˜¯printkçš„åŸå› ï¼Œåé¢ä¿®æ”¹printkä¸ä»ä¸²å£è¾“å‡ºï¼Œæ‰“å°åˆ°ç½‘ç»œå°±è§£å†³äº†ï¼Œå½“æ—¶ä¹Ÿæ²¡æ—¶é—´è¿½æº¯æ ¹æœ¬åŸå› ï¼Œç°åœ¨ä¸€æƒ³ï¼Œprintké‡Œé¢æœ‰å‡ æŠŠé”ï¼Œæ˜¯å¦ä¹Ÿæ˜¯é¢‘ç¹å’Œå¤§æ•°æ®æ‰“å°å‡ºç°é”ç«äº‰æ‰€å¯¼è‡´çš„ï¼Ÿé¡¹ç›®éœ€è¦ç”¨åˆ°å¾ˆå¤šç‰¹æ®Šç¡¬ä»¶èµ„æºå’ŒDMAï¼Œæ‰€ä»¥å¤§å¤šæ˜¯å†…æ ¸å±‚å¼€å‘ï¼Œæˆå‘˜åˆå¾ˆå¤šæ˜¯ä»åµŒå…¥å¼åº”ç”¨è½¬è¿‡æ¥çš„ï¼Œå¾ˆå¤šé—®é¢˜å…¶å®éƒ½æ²¡æ‰¾åˆ°æ ¹å› ï¼Œçœ‹åˆ°è€å¸ˆä¸“æ ï¼ŒçœŸçš„å—ç›ŠåŒªæµ…ï¼","like_count":5,"discussions":[{"author":{"id":1981399,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/3b/d7/9d942870.jpg","nickname":"é‚µäºšæ–¹","note":"","ucode":"CDFABCB81B9782","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505034,"discussion_content":"åœ¨å‡ºç°è¿™ç§å‡æ­»é—®é¢˜æ—¶éœ€è¦é¦–å…ˆæƒ³åŠæ³•æ¥ä¿å­˜äº‹æ•…ç°åœºï¼Œæœ‰äº†è¿™äº›ç°åœºåå°±å¯ä»¥åˆ†æå…·ä½“åŸå› äº†ï¼Œlockdepå’Œsoftlockupè¿™äº›éƒ½å¯ä»¥è®¤ä¸ºæ˜¯å†…æ ¸é—®é¢˜ï¼Œæ‰€ä»¥æœ€å¥½å¯ä»¥æ„é€ å‡ºæ¥vmcoreæ¥è¿›è¡Œåˆ†æï¼Œæˆ‘é€šå¸¸æ˜¯ä½¿ç”¨sysyrqæ¥æ„é€ å‡ºæ¥vmcoreï¼Œç„¶ååˆ†æè¿™äº›vmcoreã€‚è¿™é‡Œæœ‰ä¸ªé—®é¢˜æ—¶ï¼Œå¾€å¾€å‘ç”Ÿé—®é¢˜çš„æ—¶å€™å°±æ²¡æœ‰åŠæ³•æ¥æ‰§è¡Œå‘½ä»¤äº†ï¼Œæ‰€ä»¥æ ¹æ®ä¸€äº›ä¿¡æ¯æ¥æå‰åšå¥½é¢„åˆ¤å¾ˆé‡è¦ï¼Œæ¯”å¦‚æ ¹æ®loadå€¼è¾¾åˆ°å¤šå°‘å°±è®¤ä¸ºå¼‚å¸¸äº†ï¼Œæˆ–è€…åˆ©ç”¨å…¶ä»–ä¸€äº›ç³»ç»ŸæŒ‡æ ‡ï¼Œæ¯”å¦‚å†…å­˜å¼•èµ·çš„å‡æ­»å¯ä»¥å€ŸåŠ©psiæŒ‡æ ‡æ¥åšé¢„åˆ¤ã€‚åœ¨æ„é€ vmcoreæ—¶ï¼Œå¦‚æœæ˜¯ç£ç›˜æ•…éšœæˆ–è€…æ–‡ä»¶ç³»ç»Ÿå‡ºäº†é—®é¢˜ï¼Œé‚£è¿™ä¸ªvmcoreä¹Ÿå¯èƒ½æ— æ³•ä¿å­˜ä¸‹æ¥ï¼Œè¿™ä¸ªæ—¶å€™å€ŸåŠ©ç½‘ç»œæŠŠè¿™äº›ä¿¡æ¯ç»™å¯¼å‡ºæ¥ä¹Ÿæ˜¯ä¸€ä¸ªæ–¹æ¡ˆï¼ŒåµŒå…¥å¼ç³»ç»Ÿä¸­å¸¸ç”¨çš„åšæ³•è¿™æ˜¯æŠŠä»–ä»¬ä¿å­˜åœ¨éæ˜“å¤±å†…å­˜ä¸­ï¼Œç„¶åé‡å¯åè§£æè¿™äº›éæ˜“å¤±å†…å­˜ã€‚\n\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1599194301,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1046810,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f9/1a/d289c2ac.jpg","nickname":"å¤§é£å“¥","note":"","ucode":"DEBAE3967CA0D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303228,"discussion_content":"æ„Ÿè°¢è€å¸ˆç­”å¤ï¼Œåœ¨è€å¸ˆæ¨èçš„ä¹¦é‡Œä¹Ÿæœ‰è¯´åˆ°ï¼Œçœ‹æ¥è¿˜æ˜¯å¾—æŠŠvmcoreåŠ è¿›å»ï¼Œä¸»è¦æ˜¯flashå°±256Mï¼Œå‰©ä½™å¤§æ¦‚å°±50Må·¦å³ï¼Œå†…å­˜æœ‰2Gï¼Œflashè‚¯å®šä¸èƒ½å®Œå…¨ä¿å­˜å½“æ—¶çš„ç°åœºï¼Œè¿™ç§çœ‹æ˜¯å¦å¯ä»¥ä¿å­˜åˆ°nfsä¸‹ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599195083,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":245977,"user_name":"jssfy","can_delete":false,"product_type":"c1","uid":1137238,"ip_address":"","ucode":"F16353CFE607B7","user_header":"https://static001.geekbang.org/account/avatar/00/11/5a/56/115c6433.jpg","comment_is_top":false,"comment_ctime":1599123888,"is_pvip":false,"replies":[{"id":"90453","content":"å¼‚å¸¸å®•æœºæ˜¯æ€»ä¼šå‘ç”Ÿçš„ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™æœ‰æœªè½ç›˜çš„æ•°æ®ï¼Œé‚£è¿™éƒ¨åˆ†æ•°æ®å°±ä¼šä¸¢å¤±ï¼Œè¿™å…¶å®æ˜¯éš¾ä»¥å»é¿å…çš„ã€‚æ‰€ä»¥è¿™ç§é—®é¢˜å¤§è‡´æ˜¯æœ‰ä¸¤ä¸ªæ€è·¯ï¼š1.æ•°æ®æ²¡ä¿å­˜å®Œæ•´çš„è¯ï¼Œå·²ä¿å­˜çš„æ•°æ®æ˜¯å‡†ç¡®çš„å°±å¥½ï¼Œæ–‡ä»¶ç³»ç»Ÿä¼šåšæ ¡éªŒï¼Œä¸å®Œæ•´çš„æ•°æ®è®¤ä¸ºæ˜¯æ— æ•ˆæ•°æ®ã€‚2. å†—ä½™å¤‡ä»½æ¥é¢„é˜²å•ç‚¹æ•…éšœï¼Œä¸€å°ä¸»æœºå®•æœºå¾ˆæ­£å¸¸ï¼Œå¦‚æœå¤šå°åŒæ—¶å®•æœºå°±å‡ ä¹ä¸å¯èƒ½äº†ï¼Œæ‰€ä»¥å†—ä½™å¤‡ä»½æ˜¯å¾ˆé‡è¦çš„ã€‚","user_name":"ä½œè€…å›å¤","comment_id":245977,"uid":"1981399","ip_address":"","utype":1,"ctime":1599193261,"user_name_real":"é‚µäºšæ–¹"}],"discussion_count":1,"race_medal":0,"score":"10189058480","product_id":100058001,"comment_content":"å¦‚æœå®•æœºçš„è¯kernel bufferçš„æ•°æ®å¯èƒ½æ²¡æ¥å¾—åŠè½ç›˜ï¼Œè¿™ä¸ªä¸€èˆ¬æ€ä¹ˆè§£?","like_count":3,"discussions":[{"author":{"id":1981399,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/3b/d7/9d942870.jpg","nickname":"é‚µäºšæ–¹","note":"","ucode":"CDFABCB81B9782","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505026,"discussion_content":"å¼‚å¸¸å®•æœºæ˜¯æ€»ä¼šå‘ç”Ÿçš„ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™æœ‰æœªè½ç›˜çš„æ•°æ®ï¼Œé‚£è¿™éƒ¨åˆ†æ•°æ®å°±ä¼šä¸¢å¤±ï¼Œè¿™å…¶å®æ˜¯éš¾ä»¥å»é¿å…çš„ã€‚æ‰€ä»¥è¿™ç§é—®é¢˜å¤§è‡´æ˜¯æœ‰ä¸¤ä¸ªæ€è·¯ï¼š1.æ•°æ®æ²¡ä¿å­˜å®Œæ•´çš„è¯ï¼Œå·²ä¿å­˜çš„æ•°æ®æ˜¯å‡†ç¡®çš„å°±å¥½ï¼Œæ–‡ä»¶ç³»ç»Ÿä¼šåšæ ¡éªŒï¼Œä¸å®Œæ•´çš„æ•°æ®è®¤ä¸ºæ˜¯æ— æ•ˆæ•°æ®ã€‚2. å†—ä½™å¤‡ä»½æ¥é¢„é˜²å•ç‚¹æ•…éšœï¼Œä¸€å°ä¸»æœºå®•æœºå¾ˆæ­£å¸¸ï¼Œå¦‚æœå¤šå°åŒæ—¶å®•æœºå°±å‡ ä¹ä¸å¯èƒ½äº†ï¼Œæ‰€ä»¥å†—ä½™å¤‡ä»½æ˜¯å¾ˆé‡è¦çš„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1599193261,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":255514,"user_name":"æˆ‘èƒ½èµ°å¤šè¿œ","can_delete":false,"product_type":"c1","uid":1240465,"ip_address":"","ucode":"07DF5D5DADFA3C","user_header":"https://static001.geekbang.org/account/avatar/00/12/ed/91/1d332031.jpg","comment_is_top":false,"comment_ctime":1603362941,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5898330237","product_id":100058001,"comment_content":"æˆ‘æ˜¯åšCå¼€å‘çš„ï¼Œåº”ç”¨å±‚å¼€å‘å†…å­˜æ³„éœ²é—®é¢˜è¿˜æ˜¯æ¯”è¾ƒå¸¸è§çš„ï¼Œæœ‰é‚£äº›å¥½ç”¨çš„æ–¹æ³•æ¥å¿«é€Ÿæ£€æµ‹å†…å­˜æ³„éœ²é—®é¢˜ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1102245,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d1/a5/2bbedc3b.jpg","nickname":"over","note":"","ucode":"FE272AC19842D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389748,"discussion_content":"bcc","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629421850,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350101,"user_name":"æœªè‹¥æŸ³çµ®","can_delete":false,"product_type":"c1","uid":1903900,"ip_address":"","ucode":"D93F27CC711700","user_header":"https://static001.geekbang.org/account/avatar/00/1d/0d/1c/201c105f.jpg","comment_is_top":false,"comment_ctime":1656572616,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1656572616","product_id":100058001,"comment_content":"javaç¨‹åºå¯ä»¥ä½¿ç”¨ valgrind å—","like_count":0},{"had_liked":false,"id":304037,"user_name":"Wade_é˜¿ä¼Ÿ","can_delete":false,"product_type":"c1","uid":1688629,"ip_address":"","ucode":"5AE2E846A13443","user_header":"https://static001.geekbang.org/account/avatar/00/19/c4/35/2cc10d43.jpg","comment_is_top":false,"comment_ctime":1627202313,"is_pvip":false,"replies":[{"id":"112939","content":"è¿›ç¨‹é€€å‡ºæ—¶ ä¼šå»é‡Šæ”¾è¿›ç¨‹çš„åœ°å€ç©ºé—´ å¦‚æœè¿›ç¨‹åœ°å€ç©ºé—´å¯¹åº”çš„pageæ²¡æœ‰å…¶ä»–äººåœ¨å¼•ç”¨ å°±ä¼šfreeæ‰è¿™äº›pageã€‚slabåˆ™æ˜¯åªè¦æ¥ç®¡ç†å†…æ ¸çš„æ•°æ® é€šå¸¸ä¸ç”¨æ¥ç®¡ç†è¿›ç¨‹æ•°æ®ã€‚","user_name":"ä½œè€…å›å¤","comment_id":304037,"uid":"1981399","ip_address":"","utype":1,"ctime":1631437621,"user_name_real":"é‚µäºšæ–¹"}],"discussion_count":1,"race_medal":0,"score":"1627202313","product_id":100058001,"comment_content":"å…³äºè€å¸ˆä¸Šé¢æåˆ°çš„ï¼Œå¦‚æœè¿›ç¨‹ä¸æ˜¯é•¿æ—¶é—´è¿è¡Œï¼Œé‚£ä¹ˆå³ä½¿å­˜åœ¨å†…å­˜æ³„æ¼ï¼ˆæ¯”å¦‚è¿™ä¸ªä¾‹å­ä¸­çš„åªæœ‰ malloc æ²¡æœ‰ freeï¼‰ï¼Œå®ƒçš„å±å®³ä¹Ÿä¸å¤§ï¼Œå› ä¸ºè¿›ç¨‹é€€å‡ºæ—¶ï¼Œå†…æ ¸ä¼šæŠŠè¿›ç¨‹ç”³è¯·çš„å†…å­˜éƒ½ç»™é‡Šæ”¾æ‰ã€‚è¿™é‡Œèƒ½å¦ç†è§£ä¸ºè¿›ç¨‹çš„å†…å­˜æ˜¯ç”±å†…æ ¸é€šè¿‡slab pageå›æ”¶æ—¶æ‰€é‡Šæ”¾ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1981399,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/3b/d7/9d942870.jpg","nickname":"é‚µäºšæ–¹","note":"","ucode":"CDFABCB81B9782","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523908,"discussion_content":"è¿›ç¨‹é€€å‡ºæ—¶ ä¼šå»é‡Šæ”¾è¿›ç¨‹çš„åœ°å€ç©ºé—´ å¦‚æœè¿›ç¨‹åœ°å€ç©ºé—´å¯¹åº”çš„pageæ²¡æœ‰å…¶ä»–äººåœ¨å¼•ç”¨ å°±ä¼šfreeæ‰è¿™äº›pageã€‚slabåˆ™æ˜¯åªè¦æ¥ç®¡ç†å†…æ ¸çš„æ•°æ® é€šå¸¸ä¸ç”¨æ¥ç®¡ç†è¿›ç¨‹æ•°æ®ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631437621,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":285817,"user_name":"aingwm","can_delete":false,"product_type":"c1","uid":1800980,"ip_address":"","ucode":"609462DBC596CE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJAl7V1ibk8gX9qWZKLlCmKAl6nicoTZ03PWksrUbItVraTGk5zpne1BEtUam8w8VID4EzcyyhC1LAw/132","comment_is_top":false,"comment_ctime":1617019148,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617019148","product_id":100058001,"comment_content":"è€å¸ˆï¼Œæˆ‘åœ¨è™šæ‹Ÿæœº 64 ä½ Ubuntu 18.04.1 (å†…æ ¸ç‰ˆæœ¬ 4.5.0-29-generic) ç³»ç»Ÿä¸Šè¯•éªŒäº†ä¸€ä¸‹ï¼Œæˆ‘æŠŠ process_memory() å‡½æ•°æ”¾åˆ°äº† while(1)  å¾ªç¯ä¸­ï¼Œåˆ°æœ€åå®ƒåªæ˜¯å ç”¨äº† 90.1% çš„å†…å­˜å°±æ²¡å¾€ä¸Šæ¶¨äº†ï¼Œä¹Ÿæ²¡è§¦å‘ OOM ï¼Œåæ¥æˆ‘æŠŠ sleep(1) æ¢æˆçœŸæ­£çš„éœ€è¦å¾ªç¯è®¡ç®—å¤šæ¬¡çš„è€—æ—¶æ“ä½œï¼ˆé€šè¿‡ ps å¯çœ‹åˆ° &quot;%CPU&quot; å­—æ®µçš„å€¼è¾¾åˆ°ç”šè‡³è¶…è¿‡ 100% ï¼‰ï¼Œæœ€ååº”è¯¥æ˜¯è§¦å‘äº† OOM ï¼Œå› ä¸ºçœ¼ççåœ°çœ‹ç€ a.out é€€å‡ºäº†ï¼ˆç»ˆç«¯è¢«é‡Šæ”¾ï¼Œåˆå¯ä»¥è¾“å…¥æ–°å‘½ä»¤ï¼Œä¸”é€šè¿‡ ps ä¹Ÿç¡®å®æ‰¾ä¸åˆ° a.out ï¼‰ï¼Œä½†æ˜¯ dmesg è¾“å‡ºçš„ä¿¡æ¯ä¸­ä¸ºä»€ä¹ˆæ²¡æœ‰ &quot;Out of memory&quot; ä¿¡æ¯å‘¢ï¼ˆæˆ‘ç›´æ¥æŸ¥çœ‹ &#47;var&#47;log&#47;messages æ–‡ä»¶ä¹Ÿæ²¡æ‰¾åˆ°ï¼‰ï¼Œæ˜¯æ²¡æœ‰å¼€å¯è®°å½• OOM æ—¥å¿—çš„åŠŸèƒ½å—ï¼Ÿé‚£è¦æ€ä¹ˆå¼€å¯å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":255437,"user_name":"æˆ‘èƒ½èµ°å¤šè¿œ","can_delete":false,"product_type":"c1","uid":1240465,"ip_address":"","ucode":"07DF5D5DADFA3C","user_header":"https://static001.geekbang.org/account/avatar/00/12/ed/91/1d332031.jpg","comment_is_top":false,"comment_ctime":1603343120,"is_pvip":false,"replies":[{"id":"93221","content":"å¯¹çš„ ç¨‹åºæŒ‚æ‰å è¿™äº›mallocçš„å†…å­˜å°±ä¸å†æœ‰å¼•ç”¨ å°±ä¼šè¢«é‡Šæ”¾æ‰ã€‚","user_name":"ä½œè€…å›å¤","comment_id":255437,"uid":"1981399","ip_address":"","utype":1,"ctime":1603516842,"user_name_real":"é‚µäºšæ–¹"}],"discussion_count":1,"race_medal":0,"score":"1603343120","product_id":100058001,"comment_content":"ç¬¬ä¸€ä¸ªä¾‹å­ä¸­åªæœ‰ malloc æ²¡æœ‰ freeï¼Œå®ƒçš„å±å®³ä¹Ÿä¸å¤§ï¼Œå› ä¸ºè¿›ç¨‹é€€å‡ºæ—¶ï¼Œå†…æ ¸ä¼šæŠŠè¿›ç¨‹ç”³è¯·çš„å†…å­˜éƒ½ç»™é‡Šæ”¾æ‰ã€‚æˆ‘ä¸€ç›´ç†è§£çš„è¿›ç¨‹é€€å‡ºåï¼Œæ³„éœ²çš„è¿™å—å†…å­˜ä¹Ÿä¸ä¼šè¢«å›æ”¶æ‰ã€‚çœŸæ˜¯å¤šå¹´éƒ½ç†è§£é”™äº†ã€‚ç»†æƒ³äº†ä¸€ä¸‹ï¼Œè¿˜çœŸæ˜¯è¿™æ ·ï¼Œæ¯”å¦‚æˆ‘ä»¬å†å¼€å‘ä¸­ä¼šç”³è¯·ä¸€äº›é•¿æœŸå æœ‰çš„å†…å­˜ã€‚ç¨‹åºæŒ‚æ‰ï¼Œè¿™äº›å†…å­˜å°±è¢«ç³»ç»Ÿå›æ”¶æ‰äº†ã€‚","like_count":0,"discussions":[{"author":{"id":1981399,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/3b/d7/9d942870.jpg","nickname":"é‚µäºšæ–¹","note":"","ucode":"CDFABCB81B9782","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":507714,"discussion_content":"å¯¹çš„ ç¨‹åºæŒ‚æ‰å è¿™äº›mallocçš„å†…å­˜å°±ä¸å†æœ‰å¼•ç”¨ å°±ä¼šè¢«é‡Šæ”¾æ‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603516842,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":246602,"user_name":"å¼ æŒ¯å®‡","can_delete":false,"product_type":"c1","uid":1130691,"ip_address":"","ucode":"7A6FD7294E65FF","user_header":"https://static001.geekbang.org/account/avatar/00/11/40/c3/e545ba80.jpg","comment_is_top":false,"comment_ctime":1599437322,"is_pvip":false,"replies":[{"id":"91116","content":"xfså­˜åœ¨é—®é¢˜çš„å¯èƒ½æ€§æ›´å¤§","user_name":"ä½œè€…å›å¤","comment_id":246602,"uid":"1981399","ip_address":"","utype":1,"ctime":1599976576,"user_name_real":"é‚µäºšæ–¹"}],"discussion_count":1,"race_medal":0,"score":"1599437322","product_id":100058001,"comment_content":"è€å¸ˆï¼Œç£ç›˜ç»å¸¸ä¼šæœ‰æ–‡ä»¶æƒé™å˜æˆ??? çš„æƒ…å†µï¼Œä½¿ç”¨xfs repairå¯ä»¥ä¿®å¤ï¼Œè¿™ä¸ªæ˜¯ä¸šåŠ¡çš„é—®é¢˜å—","like_count":0,"discussions":[{"author":{"id":1981399,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/3b/d7/9d942870.jpg","nickname":"é‚µäºšæ–¹","note":"","ucode":"CDFABCB81B9782","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505190,"discussion_content":"xfså­˜åœ¨é—®é¢˜çš„å¯èƒ½æ€§æ›´å¤§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599976576,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}