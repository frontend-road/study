{"id":601964,"title":"09ï½œåˆ†å¸ƒå¼äº‹åŠ¡ï¼šå¤šæœåŠ¡çš„2PCã€TCCéƒ½æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å¾é•¿é¾™ï¼Œä»Šå¤©è¿™èŠ‚è¯¾æˆ‘ä»¬èŠèŠåˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p><p>ç›®å‰ä¸šç•Œæµè¡Œå¾®æœåŠ¡ï¼ŒDDDé¢†åŸŸé©±åŠ¨è®¾è®¡ä¹Ÿéšä¹‹æµè¡Œèµ·æ¥ã€‚DDDæ˜¯ä¸€ç§æ‹†åˆ†å¾®æœåŠ¡çš„æ–¹æ³•ï¼Œå®ƒä»ä¸šåŠ¡æµç¨‹çš„è§†è§’ä»ä¸Šå¾€ä¸‹æ‹†åˆ†é¢†åŸŸï¼Œé€šè¿‡èšåˆæ ¹å…³è”å¤šä¸ªé¢†åŸŸï¼Œå°†å¤šä¸ªæµç¨‹èšåˆåœ¨ä¸€èµ·ï¼Œå½¢æˆç‹¬ç«‹çš„æœåŠ¡ã€‚ç›¸æ¯”ç”±æ•°æ®è¡¨ç»“æ„è®¾è®¡å‡ºçš„å¾®æœåŠ¡ï¼ŒDDDè¿™ç§æ–¹å¼æ›´åŠ åˆç†ï¼Œä½†ä¹ŸåŠ å¤§äº†åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°éš¾åº¦ã€‚</p><p>åœ¨ä¼ ç»Ÿçš„åˆ†å¸ƒå¼äº‹åŠ¡å®ç°æ–¹å¼ä¸­ï¼Œæˆ‘ä»¬æ™®éä¼šå°†ä¸€ä¸ªå®Œæ•´çš„äº‹åŠ¡æ”¾åœ¨ä¸€ä¸ªç‹¬ç«‹çš„é¡¹ç›®ä¸­ç»Ÿä¸€ç»´æŠ¤ï¼Œå¹¶åœ¨ä¸€ä¸ªæ•°æ®åº“ä¸­ç»Ÿä¸€å¤„ç†æ‰€æœ‰çš„æ“ä½œã€‚è¿™æ ·åœ¨å‡ºç°é—®é¢˜æ—¶ï¼Œç›´æ¥ä¸€èµ·å›æ»šï¼Œå³å¯ä¿è¯æ•°æ®çš„äº’æ–¥å’Œç»Ÿä¸€æ€§ã€‚</p><p>ä¸è¿‡ï¼Œ<strong>è¿™ç§æ–¹å¼çš„æœåŠ¡å¤ç”¨æ€§å’Œéš”ç¦»æ€§è¾ƒå·®ï¼Œå¾ˆå¤šæ ¸å¿ƒä¸šåŠ¡ä¸ºäº†äº‹åŠ¡çš„ä¸€è‡´æ€§åªèƒ½èšåˆåœ¨ä¸€èµ·ã€‚</strong></p><p>ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œäº‹åŠ¡åœ¨æ‰§è¡ŒæœŸé—´ä¼šäº’æ–¥é”å®šå¤§é‡çš„æ•°æ®ï¼Œå¯¼è‡´æœåŠ¡æ•´ä½“æ€§èƒ½å­˜åœ¨ç“¶é¢ˆã€‚<strong>è€Œéæ ¸å¿ƒä¸šåŠ¡è¦æƒ³åœ¨éš”ç¦»è¦æ±‚é«˜çš„ç³»ç»Ÿæ¶æ„ä¸­ï¼Œå®ç°è·¨å¾®æœåŠ¡çš„äº‹åŠ¡ï¼Œéš¾åº¦æ›´å¤§ï¼Œ</strong>å› ä¸ºæ ¸å¿ƒä¸šåŠ¡åŸºæœ¬ä¸ä¼šé…åˆéæ ¸å¿ƒä¸šåŠ¡åšæ”¹é€ ï¼Œå†åŠ ä¸Šæ ¸å¿ƒä¸šåŠ¡ç»å¸¸éšä¸šåŠ¡éœ€æ±‚æ”¹åŠ¨ï¼ˆèšåˆçš„ä¸šåŠ¡è¿‡å¤šï¼‰ï¼Œç»“æœå°±æ˜¯éæ ¸å¿ƒä¸šåŠ¡æ²¡æ³•åšäº‹åŠ¡ï¼Œæ ¸å¿ƒä¸šåŠ¡ä¹Ÿæ— æ³•åšä¸ªæ€§åŒ–æ”¹é€ ã€‚</p><p>ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œå¤šä¸ªç³»ç»Ÿè¦æƒ³åœ¨äº’åŠ¨çš„åŒæ—¶ä¿æŒäº‹åŠ¡ä¸€è‡´æ€§ï¼Œæ˜¯ä¸€ä¸ªä»¤äººå¤´ç–¼çš„é—®é¢˜ï¼Œä¸šå†…å¾ˆå¤šéæ ¸å¿ƒä¸šåŠ¡æ— æ³•å’Œæ ¸å¿ƒæ¨¡å—ä¸€èµ·å¼€å¯äº‹åŠ¡ï¼Œç»å¸¸å‡ºç°æ“ä½œå‡ºé”™ï¼Œéœ€è¦äººå·¥è¡¥å¿ä¿®å¤çš„æƒ…å†µã€‚</p><!-- [[[read_end]]] --><p>å°¤å…¶åœ¨å¾®æœåŠ¡æ¶æ„æˆ–ç”¨DDDæ–¹å¼å®ç°çš„ç³»ç»Ÿä¸­ï¼ŒæœåŠ¡è¢«æ‹†åˆ†å¾—æ›´ç»†ï¼Œå¹¶ä¸”éƒ½æ˜¯ç‹¬ç«‹éƒ¨ç½²ï¼Œæ‹¥æœ‰ç‹¬ç«‹çš„æ•°æ®åº“ï¼Œè¿™å°±å¯¼è‡´è¦æƒ³ä¿æŒäº‹åŠ¡ä¸€è‡´æ€§å®ç°å°±æ›´éš¾äº†ï¼Œå› æ­¤è·¨è¶Šå¤šä¸ªæœåŠ¡å®ç°åˆ†å¸ƒå¼äº‹åŠ¡å·²æˆä¸ºåˆšéœ€ã€‚</p><p>å¥½åœ¨ç›®å‰ä¸šå†…æœ‰å¾ˆå¤šå®ç°åˆ†å¸ƒå¼äº‹åŠ¡çš„æ–¹å¼ï¼Œæ¯”å¦‚2PCã€3PCã€TCCç­‰ï¼Œä½†ç©¶ç«Ÿç”¨å“ªç§æ¯”è¾ƒåˆé€‚å‘¢ï¼Ÿè¿™æ˜¯æˆ‘ä»¬éœ€è¦é‡ç‚¹å…³æ³¨çš„ã€‚å› æ­¤ï¼Œè¿™èŠ‚è¯¾æˆ‘ä¼šå¸¦ä½ å¯¹åˆ†å¸ƒå¼äº‹åŠ¡åšä¸€äº›è®¨è®ºï¼Œè®©ä½ å¯¹åˆ†å¸ƒå¼äº‹åŠ¡æœ‰æ›´æ·±çš„è®¤è¯†ï¼Œå¸®ä½ åšå‡ºæ›´å¥½çš„å†³ç­–ã€‚</p><h2>XAåè®®</h2><p>åœ¨è®²åˆ†å¸ƒå¼äº‹åŠ¡ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè®¤è¯†ä¸€ä¸‹XAåè®®ã€‚</p><p>XAåè®®æ˜¯ä¸€ä¸ªå¾ˆæµè¡Œçš„åˆ†å¸ƒå¼äº‹åŠ¡åè®®ï¼Œå¯ä»¥å¾ˆå¥½åœ°æ”¯æ’‘æˆ‘ä»¬å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œæ¯”å¦‚å¸¸è§çš„2PCã€3PCç­‰ã€‚è¿™ä¸ªåè®®é€‚åˆåœ¨å¤šä¸ªæ•°æ®åº“ä¸­ï¼Œåè°ƒåˆ†å¸ƒå¼äº‹åŠ¡ï¼Œç›®å‰Oracleã€DB2ã€MySQL 5.7.7ä»¥ä¸Šç‰ˆæœ¬éƒ½æ”¯æŒå®ƒï¼ˆè™½ç„¶æœ‰å¾ˆå¤šbugï¼‰ã€‚è€Œç†è§£äº†XAåè®®ï¼Œå¯¹æˆ‘ä»¬æ·±å…¥äº†è§£åˆ†å¸ƒå¼äº‹åŠ¡çš„æœ¬è´¨å¾ˆæœ‰å¸®åŠ©ã€‚</p><p>æ”¯æŒXAåè®®çš„æ•°æ®åº“å¯ä»¥åœ¨å®¢æˆ·ç«¯æ–­å¼€çš„æƒ…å†µä¸‹ï¼Œå°†æ‰§è¡Œå¥½çš„ä¸šåŠ¡ç»“æœæš‚å­˜èµ·æ¥ï¼Œç›´åˆ°å¦å¤–ä¸€ä¸ªè¿›ç¨‹ç¡®è®¤æ‰ä¼šæœ€ç»ˆæäº¤æˆ–å›æ»šäº‹åŠ¡ï¼Œè¿™æ ·å°±èƒ½è½»æ¾å®ç°å¤šä¸ªæ•°æ®åº“çš„äº‹åŠ¡ä¸€è‡´æ€§ã€‚</p><p>åœ¨XAåè®®é‡Œæœ‰ä¸‰ä¸ªä¸»è¦çš„è§’è‰²ï¼š</p><ul>\n<li><strong>åº”ç”¨ï¼ˆAPï¼‰</strong>ï¼šåº”ç”¨æ˜¯å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ä»£ç å®ç°ï¼Œä¸šåŠ¡é€»è¾‘é€šè¿‡è¯·æ±‚äº‹åŠ¡åè°ƒå™¨å¼€å¯å…¨å±€äº‹åŠ¡ï¼Œåœ¨äº‹åŠ¡åè°ƒå™¨æ³¨å†Œå¤šä¸ªå­äº‹åŠ¡åï¼Œä¸šåŠ¡ä»£ç ä¼šä¾æ¬¡ç»™æ‰€æœ‰å‚ä¸äº‹åŠ¡çš„å­ä¸šåŠ¡ä¸‹å‘è¯·æ±‚ã€‚å¾…æ‰€æœ‰å­ä¸šåŠ¡æäº¤æˆåŠŸåï¼Œä¸šåŠ¡ä»£ç æ ¹æ®è¿”å›æƒ…å†µå‘Šè¯‰äº‹åŠ¡åè°ƒå™¨å„ä¸ªå­äº‹åŠ¡çš„æ‰§è¡Œæƒ…å†µï¼Œç”±äº‹åŠ¡åè°ƒå™¨å†³ç­–å­äº‹åŠ¡æ˜¯æäº¤è¿˜æ˜¯å›æ»šï¼ˆæœ‰äº›å®ç°æ˜¯äº‹åŠ¡åè°ƒå™¨å‘è¯·æ±‚ç»™å­æœåŠ¡ï¼‰ã€‚</li>\n<li><strong>äº‹åŠ¡åè°ƒå™¨ï¼ˆTMï¼‰</strong>ï¼šç”¨äºåˆ›å»ºä¸»äº‹åŠ¡ï¼ŒåŒæ—¶åè°ƒå„ä¸ªå­äº‹åŠ¡ã€‚äº‹åŠ¡åè°ƒå™¨ä¼šæ ¹æ®å„ä¸ªå­äº‹åŠ¡çš„æ‰§è¡Œæƒ…å†µï¼Œå†³ç­–è¿™äº›å­äº‹åŠ¡æœ€ç»ˆæ˜¯æäº¤æ‰§è¡Œç»“æœï¼Œè¿˜æ˜¯å›æ»šæ‰§è¡Œç»“æœã€‚æ­¤å¤–ï¼Œäº‹åŠ¡åè°ƒå™¨å¾ˆå¤šæ—¶å€™è¿˜ä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬æäº¤äº‹åŠ¡ï¼›</li>\n<li><strong>èµ„æºç®¡ç†å™¨ï¼ˆRMï¼‰</strong>ï¼šæ˜¯ä¸€ç§æ”¯æŒäº‹åŠ¡æˆ–XAåè®®çš„æ•°æ®èµ„æºï¼Œæ¯”å¦‚MySQLã€Redisç­‰ã€‚</li>\n</ul><p>å¦å¤–ï¼ŒXAè¿˜å¯¹åˆ†å¸ƒå¼äº‹åŠ¡è§„å®šäº†ä¸¤ä¸ªé˜¶æ®µï¼šPrepareé˜¶æ®µå’ŒCommité˜¶æ®µã€‚</p><p><strong>åœ¨Prepareé˜¶æ®µ</strong>ï¼Œ<strong>äº‹åŠ¡åè°ƒå™¨</strong>ä¼šé€šè¿‡xidï¼ˆäº‹åŠ¡å”¯ä¸€æ ‡è¯†ï¼Œç”±ä¸šåŠ¡æˆ–äº‹åŠ¡åè°ƒå™¨ç”Ÿæˆï¼‰åè°ƒå¤šä¸ªèµ„æºç®¡ç†å™¨æ‰§è¡Œ<strong>å­äº‹åŠ¡</strong>ï¼Œæ‰€æœ‰å­äº‹åŠ¡æ‰§è¡ŒæˆåŠŸåä¼šå‘äº‹åŠ¡åè°ƒå™¨æ±‡æŠ¥ã€‚</p><p>è¿™æ—¶çš„å­äº‹åŠ¡æ‰§è¡ŒæˆåŠŸæ˜¯æŒ‡äº‹åŠ¡å†…SQLæ‰§è¡ŒæˆåŠŸï¼Œå¹¶æ²¡æœ‰æ‰§è¡Œäº‹åŠ¡çš„æœ€ç»ˆcommitï¼ˆæäº¤ï¼‰ï¼Œæ‰€æœ‰å­äº‹åŠ¡æ˜¯æäº¤è¿˜æ˜¯å›æ»šï¼Œéœ€è¦ç­‰äº‹åŠ¡åè°ƒå™¨åšæœ€ç»ˆå†³ç­–ã€‚</p><p>æ¥ç€åˆ†å¸ƒå¼äº‹åŠ¡<strong>è¿›å…¥Commité˜¶æ®µ</strong>ï¼šå½“<strong>äº‹åŠ¡åè°ƒå™¨</strong>æ”¶åˆ°æ‰€æœ‰èµ„æºç®¡ç†å™¨æˆåŠŸæ‰§è¡Œå­äº‹åŠ¡çš„æ¶ˆæ¯åï¼Œä¼šè®°å½•äº‹åŠ¡æ‰§è¡ŒæˆåŠŸï¼Œå¹¶å¯¹å­äº‹åŠ¡åšçœŸæ­£æäº¤ã€‚å¦‚æœPrepareé˜¶æ®µæœ‰å­äº‹åŠ¡å¤±è´¥ï¼Œæˆ–è€…äº‹åŠ¡åè°ƒå™¨åœ¨ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æ‰€æœ‰å­äº‹åŠ¡æ‰§è¡ŒæˆåŠŸçš„æ¶ˆæ¯ï¼Œå°±ä¼šé€šçŸ¥æ‰€æœ‰èµ„æºç®¡ç†å™¨å¯¹å­äº‹åŠ¡æ‰§è¡Œå›æ»šçš„æ“ä½œã€‚</p><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œæ¯ä¸ªå­äº‹åŠ¡éƒ½æœ‰å¤šä¸ªçŠ¶æ€ï¼Œæ¯ä¸ªçŠ¶æ€çš„æµè½¬æƒ…å†µå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/a8/39/a89ce0be085676f4ac493d61de025339.jpg?wh=3988x2416\" alt=\"\"></p><p>å¦‚ä¸Šå›¾ï¼Œå­äº‹åŠ¡æœ‰å››ä¸ªé˜¶æ®µçš„çŠ¶æ€ï¼š</p><ul>\n<li><strong>ACTIVEï¼š</strong>å­äº‹åŠ¡SQLæ­£åœ¨æ‰§è¡Œä¸­ï¼›</li>\n<li><strong>IDLEï¼š</strong>å­äº‹åŠ¡æ‰§è¡Œå®Œæ¯•ç­‰å¾…åˆ‡æ¢PreparedçŠ¶æ€ï¼Œå¦‚æœæœ¬æ¬¡æ“ä½œä¸å‚ä¸å›æ»šï¼Œå°±å¯ä»¥ç›´æ¥æäº¤å®Œæˆï¼›</li>\n<li><strong>PREPAREDï¼š</strong>å­äº‹åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œç­‰å¾…å…¶ä»–æœåŠ¡å®ä¾‹çš„å­äº‹åŠ¡å…¨éƒ¨Readyã€‚</li>\n<li><strong>COMMITED/FAILEDï¼š</strong>æ‰€æœ‰å­äº‹åŠ¡æ‰§è¡ŒæˆåŠŸ/å¤±è´¥åï¼Œä¸€èµ·æäº¤æˆ–å›æ»šã€‚</li>\n</ul><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹XAåè°ƒä¸¤ä¸ªäº‹åŠ¡çš„å…·ä½“æµç¨‹ï¼Œè¿™é‡Œæˆ‘æ‹¿æœ€å¸¸è§çš„2PCæ–¹å¼ä¸ºä¾‹è¿›è¡Œè®²è§£ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/5f/da/5f4b724b4db9d7a5d9f642yy23f90fda.jpg?wh=1920x1163\" alt=\"å›¾ç‰‡\" title=\"XA åè°ƒä¸¤ä¸ªæœåŠ¡çš„åˆ†å¸ƒå¼äº‹åŠ¡è¿‡ç¨‹\n\"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨åè°ƒä¸¤ä¸ªæœåŠ¡Application 1å’ŒApplication 2æ—¶ï¼Œä¸šåŠ¡ä¼šå…ˆè¯·æ±‚äº‹åŠ¡åè°ƒå™¨åˆ›å»ºå…¨å±€äº‹åŠ¡ï¼ŒåŒæ—¶ç”Ÿæˆå…¨å±€äº‹åŠ¡çš„å”¯ä¸€æ ‡è¯†xidï¼Œç„¶åå†åœ¨äº‹åŠ¡åè°ƒå™¨é‡Œåˆ†åˆ«æ³¨å†Œä¸¤ä¸ªå­äº‹åŠ¡ï¼Œç”Ÿæˆæ¯ä¸ªå­äº‹åŠ¡å¯¹åº”çš„xidã€‚è¿™é‡Œè¯´æ˜ä¸€ä¸‹ï¼Œxidç”±gtrid+bqual+formatIDç»„æˆï¼Œå¤šä¸ªå­äº‹åŠ¡çš„gtridæ˜¯ç›¸åŒçš„ï¼Œä½†å…¶ä»–éƒ¨åˆ†å¿…é¡»åŒºåˆ†å¼€ï¼Œé˜²æ­¢è¿™äº›æœåŠ¡åœ¨ä¸€ä¸ªæ•°æ®åº“ä¸‹ã€‚</p><p>é‚£ä¹ˆæœ‰äº†å­äº‹åŠ¡çš„xidï¼Œè¢«è¯·æ±‚çš„æœåŠ¡ä¼šé€šè¿‡xidæ ‡è¯†å¼€å¯XAå­äº‹åŠ¡ï¼Œè®©XAå­äº‹åŠ¡æ‰§è¡Œä¸šåŠ¡æ“ä½œã€‚å½“äº‹åŠ¡æ•°æ®æ“ä½œéƒ½æ‰§è¡Œå®Œæ¯•åï¼Œå­äº‹åŠ¡ä¼šæ‰§è¡ŒPrepareæŒ‡ä»¤ï¼Œå°†å­äº‹åŠ¡æ ‡æ³¨ä¸ºPreparedçŠ¶æ€ï¼Œç„¶åä»¥åŒæ ·çš„æ–¹å¼æ‰§è¡Œxid2äº‹åŠ¡ã€‚</p><p>æ‰€æœ‰å­äº‹åŠ¡æ‰§è¡Œå®Œæ¯•åï¼ŒPreparedçŠ¶æ€çš„XAäº‹åŠ¡ä¼šæš‚å­˜åœ¨MySQLä¸­ï¼Œå³ä½¿ä¸šåŠ¡æš‚æ—¶æ–­å¼€ï¼Œäº‹åŠ¡ä¹Ÿä¼šå­˜åœ¨ã€‚è¿™æ—¶ï¼Œä¸šåŠ¡ä»£ç è¯·æ±‚äº‹åŠ¡åè°ƒå™¨é€šçŸ¥æ‰€æœ‰ç”³è¯·çš„å­äº‹åŠ¡å…¨éƒ¨æ‰§è¡ŒæˆåŠŸã€‚ä¸æ­¤åŒæ—¶ï¼ŒTMä¼šé€šçŸ¥RM1å’ŒRM2æ‰§è¡Œæœ€ç»ˆçš„commitï¼ˆæˆ–è°ƒç”¨æ¯ä¸ªä¸šåŠ¡å°è£…çš„æäº¤æ¥å£ï¼‰ã€‚</p><p>è‡³æ­¤ï¼Œæ•´ä¸ªäº‹åŠ¡æµç¨‹æ‰§è¡Œå®Œæ¯•ã€‚è€Œåœ¨Prepareé˜¶æ®µï¼Œå¦‚æœæœ‰å­äº‹åŠ¡æ‰§è¡Œå¤±è´¥ï¼Œç¨‹åºæˆ–äº‹åŠ¡åè°ƒå™¨ï¼Œå°±ä¼šé€šçŸ¥æ‰€æœ‰å·²ç»åœ¨PreparedçŠ¶æ€çš„äº‹åŠ¡æ‰§è¡Œå›æ»šã€‚</p><p>ä»¥ä¸Šå°±æ˜¯XAåè®®å®ç°å¤šä¸ªå­ç³»ç»Ÿçš„äº‹åŠ¡ä¸€è‡´æ€§çš„è¿‡ç¨‹ï¼Œå¯ä»¥è¯´å¤§éƒ¨åˆ†çš„åˆ†å¸ƒå¼äº‹åŠ¡éƒ½æ˜¯ä½¿ç”¨ç±»ä¼¼çš„æ–¹å¼å®ç°çš„ã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹ï¼Œçœ‹çœ‹XAåè®®åœ¨MySQLä¸­çš„æŒ‡ä»¤æ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚</p><h2>MySQL XAçš„2PCåˆ†å¸ƒå¼äº‹åŠ¡</h2><p>åœ¨è¿›å…¥æ¡ˆä¾‹ä¹‹å‰ï¼Œä½ å¯ä»¥å…ˆäº†è§£ä¸€ä¸‹MySQLä¸­ï¼Œæ‰€æœ‰å…³XAåè®®çš„æŒ‡ä»¤é›†ï¼Œä»¥æ–¹ä¾¿æ¥ä¸‹æ¥çš„å­¦ä¹ ï¼š</p><pre><code class=\"language-sql\"># å¼€å¯ä¸€ä¸ªäº‹åŠ¡Idä¸ºxidçš„XAå­äº‹åŠ¡\n# gtridæ˜¯äº‹åŠ¡ä¸»IDï¼Œbqualæ˜¯å­äº‹åŠ¡æ ‡è¯†\n# formatidæ˜¯æ•°æ®ç±»å‹æ ‡æ³¨ ç±»ä¼¼format type\nXA {START|BEGIN} xid[gtrid[,bqual[,format_id]]] [JOIN|RESUME] \n\n# ç»“æŸxidçš„å­äº‹åŠ¡ï¼Œè¿™ä¸ªäº‹åŠ¡ä¼šæ ‡æ³¨ä¸ºIDLEçŠ¶æ€\n# å¦‚æœIDELçŠ¶æ€ç›´æ¥æ‰§è¡ŒXA COMMITæäº¤é‚£ä¹ˆå°±æ˜¯ 1PC\nXA END xid [SUSPEND [FOR MIGRATE]] \n\n# è®©å­äº‹åŠ¡å¤„äºPreparedçŠ¶æ€ï¼Œç­‰å¾…å…¶ä»–å­äº‹åŠ¡å¤„ç†åï¼Œåç»­ç»Ÿä¸€æœ€ç»ˆæäº¤æˆ–å›æ»š\n# å¦å¤– åœ¨è¿™ä¸ªæ“ä½œä¹‹å‰å¦‚æœæ–­å¼€é“¾æ¥ï¼Œä¹‹å‰æ‰§è¡Œçš„äº‹åŠ¡éƒ½ä¼šå›æ»š\nXA PREPARE xid \n\n# ä¸Šé¢ä¸åŒå­äº‹åŠ¡ ç”¨ä¸åŒçš„xid(gtridä¸€è‡´ï¼Œå¦‚æœåœ¨ä¸€ä¸ªå®ä¾‹bqualå¿…é¡»ä¸åŒ)\n\n# æŒ‡å®šxidå­äº‹åŠ¡æœ€ç»ˆæäº¤\nXA COMMIT xid [ONE PHASE] \nXA ROLLBACK xid å­äº‹åŠ¡æœ€ç»ˆå›æ»š\n\n# æŸ¥çœ‹å¤„äºPreparedçŠ¶æ€çš„äº‹åŠ¡\n# æˆ‘ä»¬ç”¨è¿™ä¸ªæ¥ç¡®è®¤äº‹åŠ¡è¿›å±•æƒ…å†µï¼Œå€Ÿæ­¤å†³å®šæ˜¯å¦æ•´ä½“æäº¤\n# å³ä½¿æäº¤é“¾æ¥æ–­å¼€äº†ï¼Œæˆ‘ä»¬ç”¨è¿™ä¸ªä»æ—§èƒ½çœ‹åˆ°æ‰€æœ‰çš„PrepareDçŠ¶æ€çš„äº‹åŠ¡\n# \nXA RECOVER [CONVERT XID] \n</code></pre><p>è¨€å½’æ­£ä¼ ï¼Œæˆ‘ä»¬ä»¥è´­ç‰©åœºæ™¯ä¸ºä¾‹ï¼Œåœ¨è´­ç‰©çš„æ•´ä¸ªäº‹åŠ¡æµç¨‹ä¸­ï¼Œéœ€è¦åè°ƒçš„æœåŠ¡æœ‰ä¸‰ä¸ªï¼š<strong>ç”¨æˆ·é’±åŒ…ã€å•†å“åº“å­˜å’Œç”¨æˆ·è´­ç‰©è®¢å•ï¼Œ</strong>å®ƒä»¬çš„æ•°æ®éƒ½æ”¾åœ¨ç§æœ‰çš„æ•°æ®åº“ä¸­ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/83/ab/83d2c1a7ec17bf844972f208659a95ab.jpg?wh=1920x1163\" alt=\"å›¾ç‰‡\" title=\"ç”¨æˆ·è´­ç‰©\"></p><p>æŒ‰ç…§ä¸šåŠ¡æµç¨‹ï¼Œç”¨æˆ·åœ¨è´­ä¹°å•†å“æ—¶ï¼Œç³»ç»Ÿéœ€è¦æ‰§è¡Œæ‰£åº“å­˜ã€ç”Ÿæˆè´­ç‰©è®¢å•å’Œæ‰£é™¤ç”¨æˆ·è´¦æˆ·ä½™é¢çš„æ“ä½œ ã€‚å…¶ä¸­ï¼Œâ€œæ‰£åº“å­˜â€å’Œâ€œæ‰£é™¤ç”¨æˆ·è´¦æˆ·ä½™é¢â€æ˜¯ä¸ºäº†ä¿è¯æ•°æ®çš„å‡†ç¡®å’Œä¸€è‡´æ€§ï¼Œæ‰€ä»¥æ‰£å‡è¿‡ç¨‹ä¸­ï¼Œè¦åœ¨äº‹åŠ¡æ“ä½œæœŸé—´é”å®šäº’æ–¥çš„å…¶ä»–çº¿ç¨‹æ“ä½œä¿è¯ä¸€è‡´æ€§ï¼Œç„¶åé€šè¿‡2PCæ–¹å¼ï¼Œå¯¹ä¸‰ä¸ªæœåŠ¡å®ç°äº‹åŠ¡åè°ƒã€‚</p><p>å…·ä½“å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-go\">package main\nimport (\n   \"database/sql\"\n   \"fmt\"\n   _ \"github.com/go-sql-driver/mysql\"\n   \"strconv\"\n   \"time\"\n)\nfunc main() {\n   // åº“å­˜çš„è¿æ¥\n   stockDb, err := sql.Open(\"mysql\", \"root:paswd@tcp(127.0.0.1:3306)/shop_product_stock\")\n   if err != nil {\n      panic(err.Error())\n   }\n   defer stockDb.Close()\n   //è®¢å•çš„è¿æ¥\n   orderDb, err := sql.Open(\"mysql\", \"root:paswd@tcp(127.0.0.1:3307)/shop_order\")\n   if err != nil {\n      panic(err.Error())\n   }\n   defer orderDb.Close()\n   //é’±åŒ…çš„è¿æ¥\n   moneyDb, err := sql.Open(\"mysql\", \"root:paswd@tcp(127.0.0.1:3308)/user_money_bag\")\n   if err != nil {\n      panic(err.Error())\n   }\n   defer moneyDb.Close()\n   \n   // ç”Ÿæˆxid(å¦‚æœåœ¨åŒä¸€ä¸ªæ•°æ®åº“ï¼Œå­äº‹åŠ¡ä¸èƒ½ä½¿ç”¨ç›¸åŒxid)\n   xid := strconv.FormatInt(time.Now().UnixMilli(), 10)\n   //å¦‚æœåç»­æ‰§è¡Œè¿‡ç¨‹æœ‰æŠ¥é”™ï¼Œé‚£ä¹ˆå›æ»šæ‰€æœ‰å­äº‹åŠ¡\n   defer func() {\n      if err := recover(); err != nil {\n         stockDb.Exec(\"XA ROLLBACK ?\", xid)\n         orderDb.Exec(\"XA ROLLBACK ?\", xid)\n         moneyDb.Exec(\"XA ROLLBACK ?\", xid)\n      }\n   }()\n \n   // ç¬¬ä¸€é˜¶æ®µ Prepare\n   // åº“å­˜ å­äº‹åŠ¡å¯åŠ¨\n   if _, err = stockDb.Exec(\"XA START ?\", xid); err != nil {\n      panic(err.Error())\n   }\n   //æ‰£é™¤åº“å­˜ï¼Œè¿™é‡Œçœç•¥äº†æ•°æ®è¡Œé”æ“ä½œ\n   if _, err = stockDb.Exec(\"update product_stock set stock=stock-1 where id =1\"); err != nil {\n      panic(err.Error())\n   }\n   //äº‹åŠ¡æ‰§è¡Œç»“æŸ\n   if _, err = stockDb.Exec(\"XA END ?\", xid); err != nil {\n      panic(err.Error())\n   }\n   //è®¾ç½®åº“å­˜ä»»åŠ¡ä¸ºPreparedçŠ¶æ€\n   if _, err = stockDb.Exec(\"XA PREPARE ?\", xid); err != nil {\n      panic(err.Error())\n   }\n\n   // è®¢å• å­äº‹åŠ¡å¯åŠ¨\n   if _, err = orderDb.Exec(\"XA START ?\", xid); err != nil {\n      panic(err.Error())\n   }\n   //åˆ›å»ºè®¢å•\n   if _, err = orderDb.Exec(\"insert shop_order(id,pid,xx) value (1,2,3)\"); err != nil {\n      panic(err.Error())\n   }\n   //äº‹åŠ¡æ‰§è¡Œç»“æŸ\n   if _, err = orderDb.Exec(\"XA END ?\", xid); err != nil {\n      panic(err.Error())\n   }\n   //è®¾ç½®ä»»åŠ¡ä¸ºPreparedçŠ¶æ€\n   if _, err = orderDb.Exec(\"XA PREPARE ?\", xid); err != nil {\n      panic(err.Error())\n   }\n   \n   // é’±åŒ… å­äº‹åŠ¡å¯åŠ¨\n   if _, err = moneyDb.Exec(\"XA START ?\", xid); err != nil {\n      panic(err.Error())\n   }\n   //æ‰£å‡ç”¨æˆ·è´¦æˆ·ç°é‡‘ï¼Œè¿™é‡Œçœç•¥äº†æ•°æ®è¡Œé”æ“ä½œ\n   if _, err = moneyDb.Exec(\"update user_money_bag set money=money-1 where id =9527\"); err != nil {\n      panic(err.Error())\n   }\n   //äº‹åŠ¡æ‰§è¡Œç»“æŸ\n   if _, err = moneyDb.Exec(\"XA END ?\", xid); err != nil {\n      panic(err.Error())\n   }\n   //è®¾ç½®ä»»åŠ¡ä¸ºPreparedçŠ¶æ€\n   if _, err = moneyDb.Exec(\"XA PREPARE ?\", xid); err != nil {\n      panic(err.Error())\n   }\n   // åœ¨è¿™æ—¶ï¼Œå¦‚æœé“¾æ¥æ–­å¼€ã€PreparedçŠ¶æ€çš„XAäº‹åŠ¡ä»æ—§åœ¨MySQLå­˜åœ¨\n   // ä»»æ„ä¸€ä¸ªé“¾æ¥è°ƒç”¨XA RECOVERéƒ½èƒ½å¤Ÿçœ‹åˆ°è¿™ä¸‰ä¸ªæ²¡æœ‰æœ€ç»ˆæäº¤çš„äº‹åŠ¡\n   \n   // --------\n   // ç¬¬äºŒé˜¶æ®µ è¿è¡Œåˆ°è¿™é‡Œæ²¡æœ‰ä»»ä½•é—®é¢˜\n   // é‚£ä¹ˆæ‰§è¡Œ commit\n   // --------\n   if _, err = stockDb.Exec(\"XA COMMIT ?\", xid); err != nil {\n      panic(err.Error())\n   }\n   if _, err = orderDb.Exec(\"XA COMMIT ?\", xid); err != nil {\n      panic(err.Error())\n   }\n   if _, err = moneyDb.Exec(\"XA COMMIT ?\", xid); err != nil {\n      panic(err.Error())\n   }\n   //åˆ°è¿™é‡Œå…¨éƒ¨æµç¨‹å®Œæ¯•\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒMySQLé€šè¿‡XAæŒ‡ä»¤è½»æ¾å®ç°äº†å¤šä¸ªåº“æˆ–å¤šä¸ªæœåŠ¡çš„äº‹åŠ¡ä¸€è‡´æ€§æäº¤ã€‚</p><p>å¯èƒ½ä½ ä¼šæƒ³ï¼Œä¸ºä»€ä¹ˆåœ¨ä¸Šé¢çš„ä»£ç ä¸­æ²¡æœ‰çœ‹åˆ°äº‹åŠ¡åè°ƒå™¨çš„ç›¸å…³æ“ä½œï¼Ÿè¿™é‡Œæˆ‘ä»¬ä¸å¦¨å»æ‰å­ä¸šåŠ¡çš„å…·ä½“å®ç°ï¼Œç”¨APIè°ƒç”¨çš„æ–¹å¼çœ‹ä¸€ä¸‹æ˜¯æ€ä¹ˆå›äº‹ï¼š</p><pre><code class=\"language-go\">package main\nimport (\n   \"database/sql\"\n   \"fmt\"\n   _ \"github.com/go-sql-driver/mysql\"\n   \"strconv\"\n   \"time\"\n)\nfunc main() {\n   // åº“å­˜çš„è¿æ¥\n   stockDb, err := sql.Open(\"mysql\", \"root:123456@tcp(127.0.0.1:3306)/shop_product_stock\")\n   if err != nil {\n      panic(err.Error())\n   }\n   defer stockDb.Close()\n   //è®¢å•çš„è¿æ¥\n   orderDb, err := sql.Open(\"mysql\", \"root:123456@tcp(127.0.0.1:3307)/shop_order\")\n   if err != nil {\n      panic(err.Error())\n   }\n   defer orderDb.Close()\n   //é’±åŒ…çš„è¿æ¥\n   moneyDb, err := sql.Open(\"mysql\", \"root:123456@tcp(127.0.0.1:3308)/user_money_bag\")\n   if err != nil {\n      panic(err.Error())\n   }\n   defer moneyDb.Close()\n   \n   // ç”Ÿæˆxid\n   xid := strconv.FormatInt(time.Now().UnixMilli(), 10)\n   //å¦‚æœåç»­æ‰§è¡Œè¿‡ç¨‹æœ‰æŠ¥é”™ï¼Œé‚£ä¹ˆå›æ»šæ‰€æœ‰å­äº‹åŠ¡\n   defer func() {\n      if err := recover(); err != nil {\n         stockDb.Exec(\"XA ROLLBACK ?\", xid)\n         orderDb.Exec(\"XA ROLLBACK ?\", xid)\n         moneyDb.Exec(\"XA ROLLBACK ?\", xid)\n      }\n   }()\n \n   //è°ƒç”¨APIæ‰£æ¬¾ï¼Œapiå†…æ‰§è¡Œxa startã€sqlã€xa endã€xa prepare\n   if _, err = API.Call(\"UserMoneyBagPay\", uid, price, xid); err != nil {\n      panic(err.Error())\n   }\n   //è°ƒç”¨å•†å“åº“å­˜æ‰£åº“å­˜\n   if _, err = API.Call(\"ShopStockDecr\", productId, 1, xid); err != nil {\n      panic(err.Error())\n   }\n   //è°ƒç”¨APIç”Ÿæˆè®¢å•\n   if _, err = API.Call(\"ShopOrderCreate\",productId, uid, price, xid); err != nil {\n      panic(err.Error())\n   }\n   // --------\n   // ç¬¬äºŒé˜¶æ®µ è¿è¡Œåˆ°è¿™é‡Œæ²¡æœ‰ä»»ä½•é—®é¢˜\n   // é‚£ä¹ˆæ‰§è¡Œ commit\n   // --------\n   if _, err = stockDb.Exec(\"XA COMMIT ?\", xid); err != nil {\n      panic(err.Error())\n   }\n   if _, err = orderDb.Exec(\"XA COMMIT ?\", xid); err != nil {\n      panic(err.Error())\n   }\n   if _, err = moneyDb.Exec(\"XA COMMIT ?\", xid); err != nil {\n      panic(err.Error())\n   }\n   //åˆ°è¿™é‡Œå…¨éƒ¨æµç¨‹å®Œæ¯•\n}\n</code></pre><p>æˆ‘æƒ³ä½ å·²ç»çŸ¥é“äº†ï¼Œå½“å‰ç¨‹åºæœ¬èº«å°±å·²ç»å®ç°äº†äº‹åŠ¡åè°ƒå™¨çš„åŠŸèƒ½ã€‚å…¶å®ä¸€äº›å¼€æºçš„åˆ†å¸ƒå¼äº‹åŠ¡ç»„ä»¶ï¼Œæ¯”å¦‚ <a href=\"https://seata.io/zh-cn/docs/overview/what-is-seata.html\">seata</a>æˆ– <a href=\"https://github.com/dtm-labs/dtm\">dtm</a> ç­‰ï¼Œå¯¹äº‹åŠ¡åè°ƒå™¨æœ‰ä¸€ä¸ªæ›´å¥½çš„æŠ½è±¡å°è£…ï¼Œå¦‚æœä½ æ„Ÿå…´è¶£çš„è¯å¯ä»¥ä½“éªŒæµ‹è¯•ä¸€ä¸‹ã€‚</p><p>è€Œä¸Šé¢ä¸¤ä¸ªæ¼”ç¤ºä»£ç çš„å…·ä½“æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/25/26/253e04da1340acc27772c2f5a4ddd726.jpg?wh=1920x1719\" alt=\"å›¾ç‰‡\" title=\"æ•´ä½“æµç¨‹å›¾\"></p><p>é€šè¿‡æµç¨‹å›¾ä½ ä¼šå‘ç°ï¼Œ2PCäº‹åŠ¡ä¸ä»…å®¹æ˜“ç†è§£ï¼Œå®ç°èµ·æ¥ä¹Ÿç®€å•ã€‚</p><p>ä¸è¿‡å®ƒæœ€å¤§çš„ç¼ºç‚¹æ˜¯åœ¨Prepareé˜¶æ®µï¼Œå¾ˆå¤šæ“ä½œçš„æ•°æ®éœ€è¦å…ˆåšè¡Œé”å®šï¼Œæ‰èƒ½ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚å¹¶ä¸”åº”ç”¨å’Œæ¯ä¸ªå­äº‹åŠ¡çš„è¿‡ç¨‹éœ€è¦é˜»å¡ï¼Œç­‰æ•´ä¸ªäº‹åŠ¡å…¨éƒ¨å®Œæˆæ‰èƒ½é‡Šæ”¾èµ„æºï¼Œè¿™å°±å¯¼è‡´èµ„æºé”å®šæ—¶é—´æ¯”è¾ƒé•¿ï¼Œå¹¶å‘ä¹Ÿä¸é«˜ï¼Œå¸¸æœ‰å¤§é‡äº‹åŠ¡æ’é˜Ÿã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œ2PCä¼šä¸¢æ•°æ®ï¼Œæ¯”å¦‚åœ¨Commité˜¶æ®µï¼Œå¦‚æœäº‹åŠ¡åè°ƒå™¨çš„æäº¤æ“ä½œè¢«æ‰“æ–­äº†ï¼ŒXAäº‹åŠ¡å°±ä¼šé—ç•™åœ¨MySQLä¸­ã€‚</p><p>è€Œä¸”ä½ åº”è¯¥å·²ç»å‘ç°äº†ï¼Œ2PCçš„æ•´ä½“è®¾è®¡æ˜¯æ²¡æœ‰è¶…æ—¶æœºåˆ¶çš„ï¼Œå¦‚æœé•¿æ—¶é—´ä¸æäº¤é—ç•™åœ¨MySQLä¸­çš„XAå­äº‹åŠ¡ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®åº“é•¿æœŸè¢«é”è¡¨ã€‚</p><p>åœ¨å¾ˆå¤šå¼€æºçš„å®ç°ä¸­ï¼Œ2PCçš„äº‹åŠ¡åè°ƒå™¨ä¼šè‡ªåŠ¨å›æ»šæˆ–å¼ºåˆ¶æäº¤é•¿æ—¶é—´æ²¡æœ‰æäº¤çš„äº‹åŠ¡ï¼Œä½†æ˜¯å¦‚æœè¿›ç¨‹é‡å¯æˆ–å®•æœºï¼Œè¿™ä¸ªæ“ä½œå°±ä¼šä¸¢å¤±äº†ï¼Œæ­¤æ—¶å°±éœ€è¦äººå·¥ä»‹å…¥ä¿®å¤äº†ã€‚</p><h2>3PCç®€è¿°</h2><p>å¦å¤–æä¸€å¥ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°é™¤äº†2PCå¤–ï¼Œè¿˜æœ‰3PCã€‚ä¸2PCç›¸æ¯”ï¼Œ3PCä¸»è¦å¤šäº†äº‹åŠ¡è¶…æ—¶ã€å¤šæ¬¡é‡å¤å°è¯•ï¼Œä»¥åŠæäº¤checkçš„åŠŸèƒ½ã€‚ä½†å› ä¸ºç¡®è®¤æ­¥éª¤è¿‡å¤šï¼Œå¾ˆå¤šä¸šåŠ¡çš„äº’æ–¥æ’é˜Ÿæ—¶é—´ä¼šå¾ˆé•¿ï¼Œæ‰€ä»¥3PCçš„äº‹åŠ¡å¤±è´¥ç‡è¦æ¯”2PCé«˜å¾ˆå¤šã€‚</p><p>ä¸ºäº†å‡å°‘3PCå› èµ„æºé”å®šç­‰å¾…è¶…æ—¶å¯¼è‡´çš„é‡å¤å·¥ä½œï¼Œ3PCåšäº†é¢„æ“ä½œï¼Œæ•´ä½“æµç¨‹åˆ†æˆä¸‰ä¸ªé˜¶æ®µï¼š</p><ul>\n<li><strong>CanCommité˜¶æ®µ</strong>ï¼šä¸ºäº†å‡å°‘å› ç­‰å¾…é”å®šæ•°æ®å¯¼è‡´çš„è¶…æ—¶æƒ…å†µï¼Œæé«˜äº‹åŠ¡æˆåŠŸç‡ï¼Œäº‹åŠ¡åè°ƒå™¨ä¼šå‘é€æ¶ˆæ¯ç¡®è®¤èµ„æºç®¡ç†å™¨çš„èµ„æºé”å®šæƒ…å†µï¼Œä»¥åŠæ‰€æœ‰å­äº‹åŠ¡çš„æ•°æ®åº“é”å®šæ•°æ®çš„æƒ…å†µã€‚</li>\n<li><strong>PreCommité˜¶æ®µ</strong>ï¼šæ‰§è¡Œ2PCçš„Prepareé˜¶æ®µï¼›</li>\n<li><strong>DoCommité˜¶æ®µ</strong>ï¼šæ‰§è¡Œ2PCçš„Commité˜¶æ®µã€‚</li>\n</ul><p>æ€»ä½“æ¥è¯´ï¼Œ3PCæ­¥éª¤è¿‡å¤šï¼Œè¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œæ•´ä½“æ‰§è¡Œä¹Ÿæ›´åŠ ç¼“æ…¢ï¼Œæ‰€ä»¥åœ¨åˆ†å¸ƒå¼ç”Ÿäº§ç¯å¢ƒä¸­å¾ˆå°‘ç”¨åˆ°å®ƒï¼Œè¿™é‡Œæˆ‘å°±ä¸å†è¿‡å¤šå±•å¼€äº†ã€‚</p><h2>TCCåè®®</h2><p>äº‹å®ä¸Šï¼Œ2PCå’Œ3PCéƒ½å­˜åœ¨æ‰§è¡Œç¼“æ…¢ã€å¹¶å‘ä½çš„é—®é¢˜ï¼Œè¿™é‡Œæˆ‘å†ä»‹ç»ä¸€ä¸ªæ€§èƒ½æ›´å¥½çš„åˆ†å¸ƒå¼äº‹åŠ¡TCCã€‚</p><p>TCCæ˜¯Try-Confirm-Cancelçš„ç¼©å†™ï¼Œä»æµç¨‹ä¸Šæ¥çœ‹ï¼Œå®ƒæ¯”2PCå¤šäº†ä¸€ä¸ªé˜¶æ®µï¼Œä¹Ÿå°±æ˜¯å°†Prepareé˜¶æ®µåˆæ‹†åˆ†æˆäº†ä¸¤ä¸ªé˜¶æ®µï¼šTryé˜¶æ®µå’ŒConfirmé˜¶æ®µã€‚TCCå¯ä»¥ä¸ä½¿ç”¨XAï¼Œåªä½¿ç”¨æ™®é€šäº‹åŠ¡å°±èƒ½å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</p><p>é¦–å…ˆåœ¨ <strong>Tryé˜¶æ®µï¼Œ</strong>ä¸šåŠ¡ä»£ç ä¼šé¢„ç•™ä¸šåŠ¡æ‰€éœ€çš„å…¨éƒ¨èµ„æºï¼Œæ¯”å¦‚å†»ç»“ç”¨æˆ·è´¦æˆ·100å…ƒã€æå‰æ‰£é™¤ä¸€ä¸ªå•†å“åº“å­˜ã€æå‰åˆ›å»ºä¸€ä¸ªæ²¡æœ‰å¼€å§‹äº¤æ˜“çš„è®¢å•ç­‰ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å„ä¸ªå­äº‹åŠ¡é”å®šçš„æ•°æ®é‡ã€‚ä¸šåŠ¡æ‹¿åˆ°è¿™äº›èµ„æºåï¼Œåç»­ä¸¤ä¸ªé˜¶æ®µæ“ä½œå°±å¯ä»¥æ— é”è¿›è¡Œäº†ã€‚</p><p>åœ¨ <strong>Confirmé˜¶æ®µ</strong>ï¼Œä¸šåŠ¡ç¡®è®¤æ‰€éœ€çš„èµ„æºéƒ½æ‹¿åˆ°åï¼Œå­äº‹åŠ¡ä¼šå¹¶è¡Œæ‰§è¡Œè¿™äº›ä¸šåŠ¡ã€‚æ‰§è¡Œæ—¶å¯ä»¥ä¸åšä»»ä½•é”äº’æ–¥ï¼Œä¹Ÿæ— éœ€æ£€æŸ¥ï¼Œç›´æ¥æ‰§è¡ŒTryé˜¶æ®µå‡†å¤‡çš„æ‰€æœ‰èµ„æºå°±è¡Œã€‚</p><p>è¯·æ³¨æ„ï¼Œåè®®è¦æ±‚æ‰€æœ‰æ“ä½œéƒ½æ˜¯å¹‚ç­‰çš„ï¼Œä»¥æ”¯æŒå¤±è´¥é‡è¯•ï¼Œå› ä¸ºåœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œæ¯”å¦‚èµ„æºé”äº‰æŠ¢è¶…æ—¶ã€ç½‘ç»œä¸ç¨³å®šç­‰ï¼Œæ“ä½œè¦å°è¯•æ‰§è¡Œå¤šæ¬¡æ‰ä¼šæˆåŠŸã€‚</p><p>æœ€ååœ¨ <strong>Cancelé˜¶æ®µ</strong>ï¼šå¦‚æœå­äº‹åŠ¡åœ¨Tryé˜¶æ®µæˆ–Confirmé˜¶æ®µå¤šæ¬¡æ‰§è¡Œé‡è¯•åä»æ—§å¤±è´¥ï¼ŒTMå°±ä¼šæ‰§è¡ŒCancelé˜¶æ®µçš„ä»£ç ï¼Œå¹¶é‡Šæ”¾Tryé¢„ç•™çš„èµ„æºï¼ŒåŒæ—¶å›æ»šConfirmæœŸé—´çš„å†…å®¹ã€‚æ³¨æ„ï¼ŒCancelé˜¶æ®µçš„ä»£ç ä¹Ÿè¦åšå¹‚ç­‰ï¼Œä»¥æ”¯æŒå¤šæ¬¡æ‰§è¡Œã€‚</p><p>ä¸Šè¿°æµç¨‹å›¾å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/ea/6c/ea57dee245fb9d193aa259f56e8abe6c.jpg?wh=1920x1719\" alt=\"å›¾ç‰‡\" title=\"TCC çš„å®ç°\"></p><p>æœ€åï¼Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹TCCäº‹åŠ¡çš„ä¼˜ç‚¹ï¼š</p><ul>\n<li>å¹¶å‘èƒ½åŠ›é«˜ï¼Œä¸”æ— é•¿æœŸèµ„æºé”å®šï¼›</li>\n<li>ä»£ç å…¥ä¾µå®ç°åˆ†å¸ƒå¼äº‹åŠ¡å›æ»šï¼Œå¼€å‘é‡è¾ƒå¤§ï¼Œéœ€è¦ä»£ç æä¾›æ¯ä¸ªé˜¶æ®µçš„å…·ä½“æ“ä½œï¼›</li>\n<li>æ•°æ®ä¸€è‡´æ€§ç›¸å¯¹æ¥è¯´è¾ƒå¥½ï¼›</li>\n<li>é€‚ç”¨äºè®¢å•ç±»ä¸šåŠ¡ï¼Œä»¥åŠå¯¹ä¸­é—´çŠ¶æ€æœ‰çº¦æŸçš„ä¸šåŠ¡ã€‚</li>\n</ul><p>å½“ç„¶ï¼Œå®ƒçš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼š</p><ul>\n<li>åªé€‚åˆçŸ­äº‹åŠ¡ï¼Œä¸é€‚åˆå¤šé˜¶æ®µçš„äº‹åŠ¡ï¼›</li>\n<li>ä¸é€‚åˆå¤šå±‚åµŒå¥—çš„æœåŠ¡ï¼›</li>\n<li>ç›¸å…³äº‹åŠ¡é€»è¾‘è¦æ±‚å¹‚ç­‰ï¼›</li>\n<li>å­˜åœ¨æ‰§è¡Œè¿‡ç¨‹è¢«æ‰“æ–­æ—¶ï¼Œå®¹æ˜“ä¸¢å¤±æ•°æ®çš„æƒ…å†µã€‚</li>\n</ul><h2>æ€»ç»“</h2><p>é€šå¸¸æ¥è®²ï¼Œå®ç°åˆ†å¸ƒå¼äº‹åŠ¡è¦è€—è´¹æˆ‘ä»¬å¤§é‡çš„ç²¾åŠ›å’Œæ—¶é—´ï¼Œç¡¬ä»¶ä¸Šçš„æŠ•å…¥ä¹Ÿä¸å°‘ï¼Œä½†å½“ä¸šåŠ¡çœŸçš„éœ€è¦åˆ†å¸ƒå¼äº‹åŠ¡æ—¶ï¼ŒXAåè®®å¯ä»¥ç»™æˆ‘ä»¬æä¾›å¼ºå¤§çš„æ•°æ®å±‚æ”¯æ’‘ã€‚</p><p>åˆ†å¸ƒå¼äº‹åŠ¡çš„å®ç°æ–¹å¼æœ‰å¤šç§ï¼Œå¸¸è§çš„æœ‰2PCã€3PCã€TCCç­‰ã€‚å…¶ä¸­ï¼Œ2PCå¯ä»¥å®ç°å¤šä¸ªå­äº‹åŠ¡ç»Ÿä¸€æäº¤å›æ»šï¼Œä½†å› ä¸ºè¦ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ï¼Œæ‰€ä»¥å®ƒçš„å¹¶å‘æ€§èƒ½ä¸å¥½ã€‚è€Œä¸”2PCæ²¡æœ‰è¶…æ—¶çš„æœºåˆ¶ï¼Œç»å¸¸ä¼šå°†å¾ˆå¤šXAå­äº‹åŠ¡é—æ¼åœ¨æ•°æ®åº“ä¸­ã€‚</p><p>3PCè™½ç„¶æœ‰è¶…æ—¶çš„æœºåˆ¶ï¼Œä½†æ˜¯å› ä¸ºäº¤äº’è¿‡å¤šï¼Œäº‹åŠ¡ç»å¸¸ä¼šå‡ºç°è¶…æ—¶çš„æƒ…å†µï¼Œå¯¼è‡´äº‹åŠ¡çš„æ€§èƒ½å¾ˆå·®ã€‚å¦‚æœ3PCå¤šæ¬¡å°è¯•å¤±è´¥è¶…æ—¶åï¼Œå®ƒä¼šå°è¯•å›æ»šï¼Œè¿™æ—¶å¦‚æœå›æ»šä¹Ÿè¶…æ—¶ï¼Œå°±ä¼šå‡ºç°ä¸¢æ•°æ®çš„æƒ…å†µã€‚</p><p>TCCåˆ™å¯ä»¥æå‰é¢„å®šäº‹åŠ¡ä¸­éœ€è¦é”å®šçš„èµ„æºï¼Œæ¥å‡å°‘ä¸šåŠ¡ç²’åº¦ã€‚å®ƒä½¿ç”¨æ™®é€šäº‹åŠ¡å³å¯å®Œæˆåˆ†å¸ƒå¼äº‹åŠ¡åè°ƒï¼Œå› æ­¤ç›¸å¯¹åœ°TCCçš„æ€§èƒ½å¾ˆå¥½ã€‚ä½†æ˜¯ï¼Œæäº¤æœ€ç»ˆäº‹åŠ¡å’Œå›æ»šé€»è¾‘éƒ½éœ€è¦æ”¯æŒå¹‚ç­‰ï¼Œä¸ºæ­¤éœ€è¦äººå·¥è¦æŠ•å…¥çš„ç²¾åŠ›ä¹Ÿæ›´å¤šã€‚</p><p>ç›®å‰ï¼Œå¸‚é¢ä¸Šæœ‰å¾ˆå¤šä¼˜ç§€çš„ä¸­é—´ä»¶ï¼Œæ¯”å¦‚DTMã€Seataï¼Œå®ƒä»¬å¯¹åˆ†å¸ƒå¼äº‹åŠ¡åè°ƒåšäº†å¾ˆå¤šçš„ä¼˜åŒ–ï¼Œæ¯”å¦‚è¿‡ç¨‹ä¸­å¦‚æœå‡ºç°æ‰“æ–­æƒ…å†µï¼Œå®ƒä»¬èƒ½å¤Ÿè‡ªåŠ¨é‡è¯•ã€ATæ¨¡å¼æ ¹æ®ä¸šåŠ¡ä¿®æ”¹çš„SQLè‡ªåŠ¨ç”Ÿæˆå›æ»šæ“ä½œçš„SQLï¼Œè¿™ä¸ªç›¸å¯¹æ¥è¯´ä¼šæ™ºèƒ½ä¸€äº›ã€‚</p><p>æ­¤å¤–ï¼Œè¿™äº›ä¸­é—´ä»¶è¿˜èƒ½æ”¯æŒæ›´å¤æ‚çš„å¤šå±‚çº§ã€å¤šæ­¥éª¤çš„äº‹åŠ¡åè°ƒï¼Œæä¾›çš„æµç¨‹æœºåˆ¶ä¹Ÿæ›´åŠ å®Œå–„ã€‚æ‰€ä»¥åœ¨å®ç°åˆ†å¸ƒå¼äº‹åŠ¡æ—¶ï¼Œå»ºè®®ä½¿ç”¨æˆç†Ÿçš„å¼€æºåŠ ä»¥è¾…åŠ©ï¼Œèƒ½å¤Ÿè®©æˆ‘ä»¬å°‘èµ°å¼¯è·¯ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>ç°åœ¨å¸‚é¢ä¸Šæœ‰è¯¸å¤šåˆ†å¸ƒå¼å®ç°æ–¹å¼ï¼Œä½ è§‰å¾—å“ªä¸€ç§æ€§èƒ½æ›´å¥½ï¼Ÿ</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºä¸æˆ‘äº¤æµè®¨è®ºï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ï¼</p>","comments":[{"had_liked":false,"id":362120,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"åŒ—äº¬","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1668163318,"is_pvip":false,"replies":[{"id":131725,"content":"ä½ å¥½ï¼Œpeterï¼Œå¾ˆé«˜å…´æ”¶åˆ°ä½ çš„å†æ¬¡ç•™è¨€ï¼Œ1.XAçš„bugä½“ç°åœ¨å¶å°”ç‰¹æ®Šæƒ…å†µä¸‹äº‹åŠ¡é—ç•™ï¼Œä»€ä¹ˆæ—¶å€™commitåˆ°binlogï¼Œä¸ªåˆ«äº‹åŠ¡å›æ»šå¤±è´¥ï¼Œä¸€èˆ¬æ¨èä½¿ç”¨TCCï¼Œè¿™é‡Œç”¨XAè®²è§£æ˜¯æ–¹ä¾¿å¿«é€Ÿç†è§£ã€‚2.æ²¡é”™ï¼Œå…·ä½“å®ç°å¯ä»¥ä¸åŒï¼Œç”šè‡³äº‹åŠ¡ä¸€ç›´ä¸å…³é—­ç»´æŒé“¾æ¥ï¼Œç­‰å¾…æœ€ç»ˆcommitã€‚3.seataæ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œé‡Œé¢å¾ˆå¤šç§æ–¹å¼ï¼Œå…¶ä¸­atå¯ä»¥æ ¹æ®ä¿®æ”¹sqlè‡ªåŠ¨ç”Ÿæˆå›æ»šsqlã€‚4å¤§å‚ä¼šå°½åŠ›ä¿®æ”¹äº‹åŠ¡çš„ç²’åº¦ï¼Œåˆ†åŒºï¼Œåˆ†ç‰‡ï¼Œåˆ†å—ã€‚5ï¼Œå°è§„æ¨¡çš„æ™®étccæˆ–æ¯”è¾ƒå¤æ‚çš„ç»„ä»¶å®ç°ï¼Œæ¯”å¦‚seataçš„sagaï¼Œå¤§è§„æ¨¡çš„åˆ©ç”¨åˆ†å¸ƒå¼æ•°æ®åº“çš„åˆ†å¸ƒå¼äº‹åŠ¡","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1004527,"ctime":1668216700,"ip_address":"åŒ—äº¬","comment_id":362120,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100309001,"comment_content":"è¯·æ•™è€å¸ˆå‡ ä¸ªé—®é¢˜ï¼š\nQ1ï¼šMySQLæ”¯æŒXAçš„bugå¾ˆå¤šï¼Œé‚£ä¹ˆï¼Œå®é™…é¡¹ç›®ä¸­ä¸èƒ½ç”¨XAå—ï¼Ÿ\nQ2ï¼šTCCæ—¢å¯ä»¥æ˜¯XAï¼Œä¹Ÿå¯ä»¥ä¸æ˜¯XAï¼Œå¯¹å—ï¼Ÿ\nQ3ï¼šseatæ˜¯é‡‡ç”¨XAçš„å—ï¼Ÿè¿˜æ˜¯æ™®é€šçš„äº‹åŠ¡ï¼Ÿ\nQ4ï¼šä¸­å‚ã€å¤§å‚ä¸€èˆ¬ç”¨ä»€ä¹ˆæ¥åšåˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ\nQ5ï¼šä¸€ä¸ªç½‘ç«™ï¼Œ50ä¸‡ç”¨æˆ·ï¼Œè¿™ç§è§„æ¨¡çš„ç½‘ç«™ç”¨ä»€ä¹ˆæ¥å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593455,"discussion_content":"ä½ å¥½ï¼Œpeterï¼Œå¾ˆé«˜å…´æ”¶åˆ°ä½ çš„å†æ¬¡ç•™è¨€ï¼Œ1.XAçš„bugä½“ç°åœ¨å¶å°”ç‰¹æ®Šæƒ…å†µä¸‹äº‹åŠ¡é—ç•™ï¼Œä»€ä¹ˆæ—¶å€™commitåˆ°binlogï¼Œä¸ªåˆ«äº‹åŠ¡å›æ»šå¤±è´¥ï¼Œä¸€èˆ¬æ¨èä½¿ç”¨TCCï¼Œè¿™é‡Œç”¨XAè®²è§£æ˜¯æ–¹ä¾¿å¿«é€Ÿç†è§£ã€‚2.æ²¡é”™ï¼Œå…·ä½“å®ç°å¯ä»¥ä¸åŒï¼Œç”šè‡³äº‹åŠ¡ä¸€ç›´ä¸å…³é—­ç»´æŒé“¾æ¥ï¼Œç­‰å¾…æœ€ç»ˆcommitã€‚3.seataæ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œé‡Œé¢å¾ˆå¤šç§æ–¹å¼ï¼Œå…¶ä¸­atå¯ä»¥æ ¹æ®ä¿®æ”¹sqlè‡ªåŠ¨ç”Ÿæˆå›æ»šsqlã€‚4å¤§å‚ä¼šå°½åŠ›ä¿®æ”¹äº‹åŠ¡çš„ç²’åº¦ï¼Œåˆ†åŒºï¼Œåˆ†ç‰‡ï¼Œåˆ†å—ã€‚5ï¼Œå°è§„æ¨¡çš„æ™®étccæˆ–æ¯”è¾ƒå¤æ‚çš„ç»„ä»¶å®ç°ï¼Œæ¯”å¦‚seataçš„sagaï¼Œå¤§è§„æ¨¡çš„åˆ©ç”¨åˆ†å¸ƒå¼æ•°æ®åº“çš„åˆ†å¸ƒå¼äº‹åŠ¡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668216700,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1087243,"avatar":"https://static001.geekbang.org/account/avatar/00/10/97/0b/a943bcb3.jpg","nickname":"zhou","note":"","ucode":"E1CE8575B3F106","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":599196,"discussion_content":"å…³äºç¬¬5ç‚¹çš„ï¼Œå¤§è§„æ¨¡çš„ç”¨åˆ†å¸ƒå¼æ•°æ®åº“çš„åˆ†å¸ƒå¼äº‹åŠ¡ã€‚æˆ‘æƒ³é—®é—®è€å¸ˆï¼ŒMySQL,mongodbéƒ½æ˜¯åˆ†å¸ƒå¼æ•°æ®åº“ï¼Œä»–ä»¬çš„åˆ†å¸ƒå¼äº‹åŠ¡æ˜¯å¦è¿˜æ˜¯ä¾æ‰˜seataè¿™äº›ä¸­é—´ä»¶å»å®ç°ï¼Œä»–ä»¬æœ¬èº«æ˜¯æ²¡æœ‰åˆ†å¸ƒå¼äº‹åŠ¡çš„æ¦‚å¿µçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673399461,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":593455,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":599196,"extra":""}]}]},{"had_liked":false,"id":380435,"user_name":"Sam Fu","can_delete":false,"product_type":"c1","uid":1112676,"ip_address":"åŒ—äº¬","ucode":"EA285A4943271F","user_header":"https://static001.geekbang.org/account/avatar/00/10/fa/64/457325e6.jpg","comment_is_top":false,"comment_ctime":1693570294,"is_pvip":false,"replies":[{"id":138579,"content":"ä½ å¥½ï¼Œç›®å‰XAåœ¨å¼€æºæ•°æ®åº“è¿˜åœ¨ä¸æ–­æ”¹è¿›ä¸èƒ½ä¿è¯å®Œå…¨å¯ç”¨ï¼Œè¿˜æœ‰å¾ˆå¤šé—®é¢˜ï¼Œå®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­è¿˜å­˜åœ¨é—®é¢˜ï¼Œåº”ç”¨èŒƒå›´å…¶å®å¹¶ä¸å¹¿ï¼Œä½†æ˜¯è¿™ä¸ªåè®®èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿç†è§£å¤šæ¨¡å—åˆ†åˆ«æäº¤çš„æ€è·¯æ‰€ä»¥è¿™èŠ‚è¯¾é‡ç‚¹æ‹¿ä»–ä½œä¸ºä¾‹å­ï¼Œç†è§£XAä»¥åå…¶ä»–è§£å†³æ–¹æ¡ˆä½ ä¼šå‘ç°ç†è§£èµ·æ¥ååˆ†å®¹æ˜“ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1004527,"ctime":1693793976,"ip_address":"åŒ—äº¬","comment_id":380435,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100309001,"comment_content":"è€å¸ˆ xaè¿™ç©æ„æœ‰äººç”¨å—","like_count":1,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":627096,"discussion_content":"ä½ å¥½ï¼Œç›®å‰XAåœ¨å¼€æºæ•°æ®åº“è¿˜åœ¨ä¸æ–­æ”¹è¿›ä¸èƒ½ä¿è¯å®Œå…¨å¯ç”¨ï¼Œè¿˜æœ‰å¾ˆå¤šé—®é¢˜ï¼Œå®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­è¿˜å­˜åœ¨é—®é¢˜ï¼Œåº”ç”¨èŒƒå›´å…¶å®å¹¶ä¸å¹¿ï¼Œä½†æ˜¯è¿™ä¸ªåè®®èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å¿«é€Ÿç†è§£å¤šæ¨¡å—åˆ†åˆ«æäº¤çš„æ€è·¯æ‰€ä»¥è¿™èŠ‚è¯¾é‡ç‚¹æ‹¿ä»–ä½œä¸ºä¾‹å­ï¼Œç†è§£XAä»¥åå…¶ä»–è§£å†³æ–¹æ¡ˆä½ ä¼šå‘ç°ç†è§£èµ·æ¥ååˆ†å®¹æ˜“ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1693793976,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":362720,"user_name":"èŠ±èŠ±å¤§è„¸çŒ«","can_delete":false,"product_type":"c1","uid":1117318,"ip_address":"åŒ—äº¬","ucode":"8ABDB3F7F4FB0F","user_header":"https://static001.geekbang.org/account/avatar/00/11/0c/86/8e52afb8.jpg","comment_is_top":false,"comment_ctime":1668783728,"is_pvip":true,"replies":[{"id":131926,"content":"æ²¡é”™ï¼Œå¸¦æ¡ä»¶çš„å›æ»šæ›´éº»çƒ¦ï¼Œå¦‚æœä¸­æ–­äº†æ›´éº»çƒ¦","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1004527,"ctime":1668866929,"ip_address":"åŒ—äº¬","comment_id":362720,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100309001,"comment_content":"å‰ææ˜¯èƒ½æ¥å—çŸ­æš‚çš„æ•°æ®ä¸ä¸€è‡´ï¼ˆéå¼ºä¸€è‡´æ€§ï¼‰ï¼Œæ‰€ä»¥ä¸šåŠ¡ä¸Šæˆ‘ä»¬ä¸€èˆ¬å¾ˆå°‘ä¼šä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æ¥ç®¡æ§ï¼Œè€Œæ˜¯é€šè¿‡è¡¥å¿æœºåˆ¶æ¥å®ç°ä¸šåŠ¡æ•°æ®çš„ä¸€è‡´æ€§ï¼Œä½†æ˜¯å¦‚æœè°ƒç”¨çš„é“¾è·¯å¾ˆé•¿çš„è¯ï¼Œè¡¥å¿ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¤´ç–¼çš„äº‹æƒ…","like_count":1,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":594203,"discussion_content":"æ²¡é”™ï¼Œå¸¦æ¡ä»¶çš„å›æ»šæ›´éº»çƒ¦ï¼Œå¦‚æœä¸­æ–­äº†æ›´éº»çƒ¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668866929,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":362068,"user_name":"txjlrk","can_delete":false,"product_type":"c1","uid":1198360,"ip_address":"åŒ—äº¬","ucode":"DEBB00FAF1BC50","user_header":"https://static001.geekbang.org/account/avatar/00/12/49/18/0fdc49d7.jpg","comment_is_top":false,"comment_ctime":1668129796,"is_pvip":false,"replies":[{"id":131706,"content":"ä½ å¥½ï¼Œè€é“ï¼Œæˆ‘æŸ¥äº†ä¸‹è¿™ä¸ªå½’ç±»æ–¹å¼ä¸é”™ï¼ŒæŸ”æ€§ç›¸å¯¹çš„æ€§èƒ½æ›´å¥½ç±»ä¼¼TCC ï¼Œåˆšæ€§ç±»ä¼¼2pc ä¸xa","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1004527,"ctime":1668130483,"ip_address":"åŒ—äº¬","comment_id":362068,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100309001,"comment_content":"å‰å®³ï¼Œç”±æµ…å…¥æ·±ï¼Œç”±ç†è®ºåˆ°å®è·µï¼Œé¢é¢ä¿±åˆ°ã€‚\nåˆ†å¸ƒå¼äº‹åŠ¡ä¹Ÿåˆ†ä¸ºæŸ”æ€§å’Œåˆšæ€§ä¸¤ç§","like_count":1,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593364,"discussion_content":"ä½ å¥½ï¼Œè€é“ï¼Œæˆ‘æŸ¥äº†ä¸‹è¿™ä¸ªå½’ç±»æ–¹å¼ä¸é”™ï¼ŒæŸ”æ€§ç›¸å¯¹çš„æ€§èƒ½æ›´å¥½ç±»ä¼¼TCC ï¼Œåˆšæ€§ç±»ä¼¼2pc ä¸xa","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668130483,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":372156,"user_name":"é˜¿æ˜•","can_delete":false,"product_type":"c1","uid":1012906,"ip_address":"æµ™æ±Ÿ","ucode":"F3AD093B68E074","user_header":"https://static001.geekbang.org/account/avatar/00/0f/74/aa/178a6797.jpg","comment_is_top":false,"comment_ctime":1680786748,"is_pvip":false,"replies":[{"id":135954,"content":"ä¸ç®¡å“ªä¸ªé€‰æ‹©ï¼Œéƒ½ä¼šæœ‰å–èˆ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1004527,"ctime":1681177182,"ip_address":"åŒ—äº¬","comment_id":372156,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100309001,"comment_content":"æ€è€ƒé¢˜ï¼š1.åˆ©ç”¨æœ¬åœ°æ¶ˆæ¯è¡¨+mqï¼Œæˆ–è€…mqçš„äº‹åŠ¡æ¶ˆæ¯å®ç°ï¼Œå¯ä»¥è¾¾åˆ°è§£è€¦çš„ç›®çš„ï¼›2.åˆ©ç”¨seataç±»æ¡†æ¶ï¼Œå¯¹å¤æ‚åœºæ™¯æˆ–è€…é•¿äº‹åŠ¡å¯ä»¥ä½¿ç”¨segaæ¨¡å¼ã€‚","like_count":0,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":613187,"discussion_content":"ä¸ç®¡å“ªä¸ªé€‰æ‹©ï¼Œéƒ½ä¼šæœ‰å–èˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1681177182,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371713,"user_name":"ğŸ‘½","can_delete":false,"product_type":"c1","uid":1274117,"ip_address":"å¹¿ä¸œ","ucode":"D313AF941B412D","user_header":"https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg","comment_is_top":false,"comment_ctime":1680229043,"is_pvip":false,"replies":[{"id":135628,"content":"æ²¡é”™ï¼Œè¿™ç±»é—®é¢˜åœ¨è¡Œä¸šä¸æ–­æå‡ºï¼Œæ‰ä¼šæœ‰æ›´æ·±çš„æ€è€ƒ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1004527,"ctime":1680267465,"ip_address":"åŒ—äº¬","comment_id":371713,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100309001,"comment_content":"æœ‰ä¸€ä¸ªæ²¡ç”¨çš„åºŸè¯å°±æ˜¯ï¼Œè¦å°½å¯èƒ½å‡å°‘åˆ†å¸ƒå¼äº‹åŠ¡çš„å‘ç”Ÿä»¥åŠï¼Œå°½å¯èƒ½ä½¿åˆ†å¸ƒå¼äº‹åŠ¡çš„åŠ›åº¦æ›´ç»†ã€‚\næ¯”å¦‚ç°åœ¨åˆ›å»ºè®¢å•å’Œæ”¯ä»˜è¡Œä¸ºå¾ˆå¤šå‚å•†ä¼¼ä¹å°±æ˜¯æ‹†å¼€çš„ã€‚\n \nä¼¼ä¹åŸºæœ¬éƒ½æ˜¯ï¼š\n1. åˆ›å»ºè®¢å•çš„åŒæ—¶æ‰£å‡åº“å­˜ã€‚è¿™ä¸€éƒ¨åˆ†æ˜¯ä¸€ä¸ªäº‹åŠ¡ï¼›\n2. ç”¨æˆ·ä»˜æ¬¾ï¼Œæ‰£å‡ç”¨æˆ·ä½™é¢ï¼ŒåŒæ—¶ä¿®æ”¹è®¢å•çŠ¶æ€ã€‚è¿™éƒ¨åˆ†æ˜¯å¦å¤–çš„äº‹åŠ¡ï¼›\n\nè‡³äºå¦‚ä½•å¤„ç†äº‹åŠ¡ï¼Œä¸ªäººéƒ½æ˜¯äº‹åŠ¡è¡¥å¿ä¼šå¥½ä¸€äº›ã€‚å› ä¸ºæ˜¯äººå·¥å¤„ç†çš„ï¼Œæ‰€ä»¥æ›´åŠ å¯æ§ã€‚ç°åœ¨è§£å†³åˆ†å¸ƒå¼äº‹åŠ¡çš„ç»„ä»¶ï¼Œè²Œä¼¼æ²¡æœ‰çœ‹åˆ°å“ªä¸ªå®ç°æ–¹å¼æ˜¯ç‰¹åˆ«å¯ç”¨çš„ã€‚\n\nè€Œä¸”æœ‰æ—¶å€™ä¸å¾—ä¸è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼Œå¤šä¸ªæœåŠ¡é—´å¾ˆå¯èƒ½ä¸æ˜¯åŒä¸€å¥—åè®®ï¼Œä¹Ÿä¸é€‚åˆè®©äººå»å…¼å®¹ä½ çš„äº‹åŠ¡è§£å†³æ–¹æ¡ˆã€‚","like_count":0,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":611723,"discussion_content":"æ²¡é”™ï¼Œè¿™ç±»é—®é¢˜åœ¨è¡Œä¸šä¸æ–­æå‡ºï¼Œæ‰ä¼šæœ‰æ›´æ·±çš„æ€è€ƒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680267465,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":369716,"user_name":"Mr.å·®ä¸å¤š","can_delete":false,"product_type":"c1","uid":1437292,"ip_address":"ä¸Šæµ·","ucode":"946555FCAE710B","user_header":"https://static001.geekbang.org/account/avatar/00/15/ee/6c/246fa0d1.jpg","comment_is_top":false,"comment_ctime":1677833387,"is_pvip":false,"replies":[{"id":134813,"content":"ä½ å¥½ï¼ŒMr.å·®ä¸å¤šï¼Œå¾ˆé«˜å…´æ”¶åˆ°ä½ çš„ç•™è¨€ï¼ŒTCCä¹Ÿæ˜¯äºŒé˜¶æ®µçš„åªä¸è¿‡ä»–çš„æ€è·¯å’Œä¼ ç»Ÿçš„äºŒé˜¶æ®µçš„â€œå…ˆé”å®šé¢„å ç„¶åç­‰å¾…æ‰€æœ‰æ­¥éª¤å®Œæˆåå†ä¸€èµ·æäº¤â€ æœ‰æ‰€ä¸åŒï¼Œä»–æ˜¯å…ˆå°†æ‰€éœ€çš„äº‰æŠ¢èµ„æºå…ˆå…¨æŠ¢åˆ°ï¼Œç„¶åå†åšæœ€åæ‰§è¡Œï¼Œå¹¶ä¸”æäº¤å’Œå›æ»šæ˜¯æ”¯æŒå¤šæ¬¡æ‰§è¡Œçš„ï¼Œä¸è¿‡TCCç¼ºç‚¹å°±æ˜¯å¾ˆå¤šéœ€è¦äººå·¥åšæ›´å¤šäº‹æƒ…","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1004527,"ctime":1678066176,"ip_address":"åŒ—äº¬","comment_id":369716,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100309001,"comment_content":"æ‚¨å¥½ï¼Œè€å¸ˆ TCC å’ŒäºŒé˜¶æ®µæ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":607644,"discussion_content":"ä½ å¥½ï¼ŒMr.å·®ä¸å¤šï¼Œå¾ˆé«˜å…´æ”¶åˆ°ä½ çš„ç•™è¨€ï¼ŒTCCä¹Ÿæ˜¯äºŒé˜¶æ®µçš„åªä¸è¿‡ä»–çš„æ€è·¯å’Œä¼ ç»Ÿçš„äºŒé˜¶æ®µçš„â€œå…ˆé”å®šé¢„å ç„¶åç­‰å¾…æ‰€æœ‰æ­¥éª¤å®Œæˆåå†ä¸€èµ·æäº¤â€ æœ‰æ‰€ä¸åŒï¼Œä»–æ˜¯å…ˆå°†æ‰€éœ€çš„äº‰æŠ¢èµ„æºå…ˆå…¨æŠ¢åˆ°ï¼Œç„¶åå†åšæœ€åæ‰§è¡Œï¼Œå¹¶ä¸”æäº¤å’Œå›æ»šæ˜¯æ”¯æŒå¤šæ¬¡æ‰§è¡Œçš„ï¼Œä¸è¿‡TCCç¼ºç‚¹å°±æ˜¯å¾ˆå¤šéœ€è¦äººå·¥åšæ›´å¤šäº‹æƒ…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678066176,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":368293,"user_name":"jjn0703","can_delete":false,"product_type":"c1","uid":1076652,"ip_address":"æ±Ÿè‹","ucode":"83AF403AC7DFB7","user_header":"https://static001.geekbang.org/account/avatar/00/10/6d/ac/6128225f.jpg","comment_is_top":false,"comment_ctime":1676117587,"is_pvip":true,"replies":[{"id":134144,"content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1004527,"ctime":1676246256,"ip_address":"å¤©æ´¥","comment_id":368293,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100309001,"comment_content":"ATå’ŒSagaè¿™æ˜¯å¦å¤–çš„ä¸¤ç§æ¨¡å¼å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":603478,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1676246256,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¤©æ´¥","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1076652,"avatar":"https://static001.geekbang.org/account/avatar/00/10/6d/ac/6128225f.jpg","nickname":"jjn0703","note":"","ucode":"83AF403AC7DFB7","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":603663,"discussion_content":"æƒ³ç ”ç©¶ä¸€ä¸‹è¿™ä¸¤ä¸ªæ¨¡å¼çš„åŸç†ï¼Œè€å¸ˆæœ‰æ¨èçš„é è°±çš„è®²è§£èµ„æ–™å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1676265390,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":603478,"ip_address":"æ±Ÿè‹","group_id":0},"score":603663,"extra":""}]}]},{"had_liked":false,"id":362980,"user_name":"æäºŒæœ¨","can_delete":false,"product_type":"c1","uid":1103091,"ip_address":"åŒ—äº¬","ucode":"30E03BB84ADB27","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/f3/129d6dfe.jpg","comment_is_top":false,"comment_ctime":1669095976,"is_pvip":true,"replies":[{"id":132026,"content":"ä½ å¥½ï¼ŒæäºŒæœ¨ï¼Œä¹Ÿæ˜¯ä¸¤é˜¶æ®µæäº¤ï¼Œåªä¸è¿‡æ‰€æœ‰é€»è¾‘æ˜¯è‡ªå·±å®ç°çš„ï¼Œå›æ»šä¹Ÿæ˜¯","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1004527,"ctime":1669097043,"ip_address":"åŒ—äº¬","comment_id":362980,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100309001,"comment_content":"TCC åè®® æ˜¯2pc å—","like_count":0,"discussions":[{"author":{"id":1004527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/53/ef/5cdaa18b.jpg","nickname":"thinkpc","note":"","ucode":"0EBF75B8707584","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":594491,"discussion_content":"ä½ å¥½ï¼ŒæäºŒæœ¨ï¼Œä¹Ÿæ˜¯ä¸¤é˜¶æ®µæäº¤ï¼Œåªä¸è¿‡æ‰€æœ‰é€»è¾‘æ˜¯è‡ªå·±å®ç°çš„ï¼Œå›æ»šä¹Ÿæ˜¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1669097043,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}