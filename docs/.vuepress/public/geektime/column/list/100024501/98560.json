{"id":98560,"title":"36 | iOS æ˜¯æ€ä¹ˆç®¡ç†å†…å­˜çš„ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æˆ´é“­ã€‚ä»Šå¤©ï¼Œæˆ‘æ¥å’Œä½ èŠèŠ iOS æ˜¯æ€ä¹ˆç®¡ç†å†…å­˜çš„ã€‚</p><p>ä¸åŒçš„ç³»ç»Ÿç‰ˆæœ¬å¯¹ App è¿è¡Œæ—¶å ç”¨å†…å­˜çš„é™åˆ¶ä¸åŒï¼Œä½ å¯ä»¥åˆ©ç”¨æˆ‘åœ¨ç¬¬14ç¯‡æ–‡ç« ä¸­æåˆ°çš„æ–¹æ³•ï¼Œå»æŸ¥çœ‹ä¸åŒç‰ˆæœ¬ç³»ç»Ÿå¯¹Appå ç”¨å†…å­˜çš„å…·ä½“é™åˆ¶æ˜¯å¤šå°‘ã€‚å¦å¤–ï¼Œç³»ç»Ÿç‰ˆæœ¬çš„å‡çº§ä¹Ÿä¼šå¢åŠ å ç”¨çš„å†…å­˜ï¼ŒåŒæ—¶AppåŠŸèƒ½çš„å¢å¤šä¹Ÿä¼šè¦æ±‚è¶Šæ¥è¶Šå¤šçš„å†…å­˜ã€‚</p><p>ç„¶è€Œï¼Œç§»åŠ¨è®¾å¤‡çš„å†…å­˜èµ„æºæ˜¯æœ‰é™çš„ï¼Œå½“Appè¿è¡Œæ—¶å ç”¨çš„å†…å­˜å¤§å°è¶…è¿‡äº†é™åˆ¶åï¼Œå°±ä¼šè¢«å¼ºæ€æ‰ï¼Œä»è€Œå¯¼è‡´ç”¨æˆ·ä½“éªŒè¢«é™ä½ã€‚æ‰€ä»¥ï¼Œä¸ºäº†æå‡Appè´¨é‡ï¼Œå¼€å‘è€…è¦éå¸¸é‡è§†åº”ç”¨çš„å†…å­˜ç®¡ç†é—®é¢˜ã€‚</p><p>ç§»åŠ¨ç«¯çš„å†…å­˜ç®¡ç†æŠ€æœ¯ï¼Œä¸»è¦æœ‰ GCï¼ˆGarbage Collectionï¼Œåƒåœ¾å›æ”¶ï¼‰çš„æ ‡è®°æ¸…é™¤ç®—æ³•å’Œè‹¹æœå…¬å¸ä½¿ç”¨çš„å¼•ç”¨è®¡æ•°æ–¹æ³•ã€‚</p><p>ç›¸æ¯”è¾ƒäº GC æ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œå¼•ç”¨è®¡æ•°æ³•å¯ä»¥åŠæ—¶åœ°å›æ”¶å¼•ç”¨è®¡æ•°ä¸º0çš„å¯¹è±¡ï¼Œå‡å°‘æŸ¥æ‰¾æ¬¡æ•°ã€‚ä½†æ˜¯ï¼Œå¼•ç”¨è®¡æ•°ä¼šå¸¦æ¥å¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œæ¯”å¦‚å½“å¤–éƒ¨çš„å˜é‡å¼ºå¼•ç”¨ Blockæ—¶ï¼ŒBlock ä¹Ÿä¼šå¼ºå¼•ç”¨å¤–éƒ¨çš„å˜é‡ï¼Œå°±ä¼šå‡ºç°å¾ªç¯å¼•ç”¨ã€‚æˆ‘ä»¬éœ€è¦é€šè¿‡å¼±å¼•ç”¨ï¼Œæ¥è§£é™¤å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚</p><p>å¦å¤–ï¼Œåœ¨ ARCï¼ˆè‡ªåŠ¨å¼•ç”¨è®¡æ•°ï¼‰ä¹‹å‰ï¼Œä¸€ç›´éƒ½æ˜¯é€šè¿‡ MRCï¼ˆæ‰‹åŠ¨å¼•ç”¨è®¡æ•°ï¼‰è¿™ç§æ‰‹å†™å¤§é‡å†…å­˜ç®¡ç†ä»£ç çš„æ–¹å¼æ¥ç®¡ç†å†…å­˜ï¼Œå› æ­¤è‹¹æœå…¬å¸å¼€å‘äº† ARC æŠ€æœ¯ï¼Œç”±ç¼–è¯‘å™¨æ¥å®Œæˆè¿™éƒ¨åˆ†ä»£ç ç®¡ç†å·¥ä½œã€‚ä½†æ˜¯ï¼ŒARCä¾ç„¶éœ€è¦æ³¨æ„å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚</p><!-- [[[read_end]]] --><p>å½“ ARC çš„å†…å­˜ç®¡ç†ä»£ç äº¤ç”±ç¼–è¯‘å™¨è‡ªåŠ¨æ·»åŠ åï¼Œæœ‰äº›æƒ…å†µä¸‹ä¼šæ¯”æ‰‹åŠ¨ç®¡ç†å†…å­˜æ•ˆç‡ä½ï¼Œæ‰€ä»¥å¯¹äºä¸€äº›å†…å­˜è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦é€šè¿‡ MRCçš„æ–¹å¼æ¥ç®¡ç†ã€ä¼˜åŒ–å†…å­˜çš„ä½¿ç”¨ã€‚</p><p>è¦æƒ³æ·±å…¥ç†è§£ iOS ç®¡ç†å†…å­˜çš„æ–¹å¼ï¼Œæˆ‘ä»¬å°±ä¸ä»…ä»…è¦å…³æ³¨ç”¨æˆ·æ€æ¥å£å±‚é¢ï¼Œæ¯”å¦‚å¼•ç”¨è®¡æ•°ç®—æ³•å’Œå¾ªç¯å¼•ç”¨ç›‘æ§æŠ€å·§ï¼Œè¿˜éœ€è¦ä»ç®¡ç†å†…å­˜çš„æ¼”è¿›è¿‡ç¨‹ï¼Œå»äº†è§£ç°ä»£å†…å­˜ç®¡ç†ç³»ç»Ÿçš„å‰ä¸–ä»Šç”Ÿï¼ŒçŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚</p><p>è¯´åˆ°å†…å­˜ç®¡ç†çš„æ¼”è¿›è¿‡ç¨‹ï¼Œåœ¨æœ€å¼€å§‹çš„æ—¶å€™ï¼Œç¨‹åºæ˜¯ç›´æ¥è®¿é—®ç‰©ç†å†…å­˜ï¼Œä½†åæ¥æœ‰äº†å¤šç¨‹åºå¤šä»»åŠ¡åŒæ—¶è¿è¡Œï¼Œå°±å‡ºç°äº†å¾ˆå¤šé—®é¢˜ã€‚æ¯”å¦‚ï¼ŒåŒæ—¶è¿è¡Œçš„ç¨‹åºå ç”¨çš„æ€»å†…å­˜å¿…é¡»è¦å°äºå®é™…ç‰©ç†å†…å­˜å¤§å°ã€‚å†æ¯”å¦‚ï¼Œç¨‹åºèƒ½å¤Ÿç›´æ¥è®¿é—®å’Œä¿®æ”¹ç‰©ç†å†…å­˜ï¼Œä¹Ÿå°±èƒ½å¤Ÿç›´æ¥è®¿é—®å’Œä¿®æ”¹å…¶ä»–ç¨‹åºæ‰€ä½¿ç”¨çš„ç‰©ç†å†…å­˜ï¼Œç¨‹åºè¿è¡Œæ—¶çš„å®‰å…¨å°±æ— æ³•ä¿éšœã€‚</p><h2>è™šæ‹Ÿå†…å­˜</h2><p>ç”±äºè¦è§£å†³å¤šç¨‹åºå¤šä»»åŠ¡åŒæ—¶è¿è¡Œçš„è¿™äº›é—®é¢˜ï¼Œæ‰€ä»¥å¢åŠ äº†ä¸€ä¸ªä¸­é—´å±‚æ¥é—´æ¥è®¿é—®ç‰©ç†å†…å­˜ï¼Œè¿™ä¸ªä¸­é—´å±‚å°±æ˜¯è™šæ‹Ÿå†…å­˜ã€‚è™šæ‹Ÿå†…å­˜é€šè¿‡æ˜ å°„ï¼Œå¯ä»¥å°†è™šæ‹Ÿåœ°å€è½¬åŒ–æˆç‰©ç†åœ°å€ã€‚</p><p>è™šæ‹Ÿå†…å­˜ä¼šç»™æ¯ä¸ªç¨‹åºåˆ›å»ºä¸€ä¸ªå•ç‹¬çš„æ‰§è¡Œç¯å¢ƒï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è™šæ‹Ÿç©ºé—´ï¼Œè¿™æ ·æ¯ä¸ªç¨‹åºå°±åªèƒ½è®¿é—®è‡ªå·±çš„åœ°å€ç©ºé—´ï¼ˆAddress Spaceï¼‰ï¼Œç¨‹åºä¸ç¨‹åºé—´ä¹Ÿå°±èƒ½è¢«å®‰å…¨åœ°éš”ç¦»å¼€äº†ã€‚</p><p>32ä½çš„åœ°å€ç©ºé—´æ˜¯ 2^32 = 4294967296 ä¸ªå­—èŠ‚ï¼Œå…± 4GBï¼Œå¦‚æœå†…å­˜æ²¡æœ‰è¾¾åˆ° 4GB æ—¶ï¼Œè™šæ‹Ÿå†…å­˜æ¯”å®é™…çš„ç‰©ç†å†…å­˜è¦å¤§ï¼Œè¿™ä¼šè®©ç¨‹åºæ„Ÿè§‰è‡ªå·±èƒ½å¤Ÿæ”¯é…æ›´å¤šçš„å†…å­˜ã€‚å¦‚åŒè™šæ‹Ÿå†…å­˜åªä¾›å½“å‰ç¨‹åºä½¿ç”¨ï¼Œæ“ä½œèµ·æ¥å’Œç‰©ç†å†…å­˜ä¸€æ ·é«˜æ•ˆã€‚</p><p>æœ‰äº†è™šæ‹Ÿå†…å­˜è¿™æ ·ä¸€ä¸ªä¸­é—´å±‚ï¼Œæå¤§åœ°èŠ‚çœäº†ç‰©ç†å†…å­˜ã€‚iOSçš„å…±äº«åº“å°±æ˜¯åˆ©ç”¨äº†è¿™ä¸€ç‚¹ï¼Œåªå ç”¨ä¸€ä»½ç‰©ç†å†…å­˜ï¼Œå´èƒ½å¤Ÿåœ¨ä¸åŒåº”ç”¨çš„å¤šä»½è™šæ‹Ÿå†…å­˜ä¸­ï¼Œå»ä½¿ç”¨åŒä¸€ä»½å…±äº«åº“çš„ç‰©ç†å†…å­˜ã€‚</p><p>æ¯ä¸ªç¨‹åºéƒ½æœ‰è‡ªå·±çš„è¿›ç¨‹ï¼Œè¿›ç¨‹çš„å†…å­˜å¸ƒå±€ä¸»è¦ç”±ä»£ç æ®µã€æ•°æ®æ®µã€æ ˆã€å †ç»„æˆã€‚ç¨‹åºç”Ÿæˆçš„æ±‡ç¼–ä»£ç ä¼šæ”¾åœ¨ä»£ç æ®µã€‚å¦‚æœæ¯ä¸ªè¿›ç¨‹çš„å†…å­˜å¸ƒå±€éƒ½æ˜¯è¿åœ¨ä¸€èµ·çš„è¯ï¼Œæ¯ä¸ªè¿›ç¨‹åˆ†é…çš„ç©ºé—´å°±æ²¡æ³•çµæ´»å˜æ›´ï¼Œæ ˆå’Œå †æ²¡ç”¨æ»¡æ—¶å°±ä¼šæœ‰å¾ˆå¤šæ²¡ç”¨çš„ç©ºé—´ã€‚å¦‚æœè™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€çš„ç¿»è¯‘å†…å­˜ç®¡ç†å•å…ƒï¼ˆMemory Management Unitï¼ŒMMUï¼‰åªæ˜¯ç®€å•åœ°é€šè¿‡è¿›ç¨‹å¼€å§‹åœ°å€åŠ ä¸Šè™šæ‹Ÿåœ°å€ï¼Œæ¥è·å–ç‰©ç†åœ°å€ï¼Œå°±ä¼šé€ æˆå¾ˆå¤§çš„å†…å­˜ç©ºé—´æµªè´¹ã€‚</p><h2>åˆ†æ®µ</h2><p>åˆ†æ®µå°±æ˜¯å°†è¿›ç¨‹é‡Œè¿åœ¨ä¸€èµ·çš„ä»£ç æ®µã€æ•°æ®æ®µã€æ ˆã€å †åˆ†å¼€æˆç‹¬ç«‹çš„æ®µï¼Œæ¯ä¸ªæ®µå†…ç©ºé—´æ˜¯è¿ç»­çš„ï¼Œæ®µä¹‹é—´ä¸è¿ç»­ã€‚è¿™æ ·ï¼Œå†…å­˜çš„ç©ºé—´ç®¡ç† MMU å°±å¯ä»¥æ›´åŠ çµæ´»åœ°è¿›è¡Œå†…å­˜ç®¡ç†ã€‚</p><p>é‚£ä¹ˆï¼Œæ®µå’Œè¿›ç¨‹å…³ç³»æ˜¯æ€ä¹ˆè¡¨ç¤ºçš„å‘¢ï¼Ÿè¿›ç¨‹ä¸­å†…å­˜åœ°å€ä¼šç”¨å‰ä¸¤ä¸ªå­—èŠ‚è¡¨ç¤ºå¯¹åº”çš„æ®µã€‚æ¯”å¦‚00è¡¨ç¤ºä»£ç æ®µï¼Œ01æ ‡è¯†å †ã€‚</p><p>æ®µé‡Œçš„è¿›ç¨‹åˆæ˜¯å¦‚ä½•ç®¡ç†å†…å­˜çš„å‘¢ï¼Ÿæ¯ä¸ªæ®µå¤§å°å¢é•¿çš„æ–¹å‘ Grows Positive ä¹Ÿéœ€è¦è®°å½•ï¼Œæ˜¯å¦å¯è¯»å†™ä¹Ÿè¦è®°å½•ï¼Œä¸ºçš„æ˜¯èƒ½å¤Ÿæ›´æœ‰æ•ˆåœ°ç®¡ç†æ®µå¢é•¿ã€‚æ¯ä¸ªæ®µçš„å¤§å°ä¸ä¸€æ ·ï¼Œåœ¨ç”³è¯·çš„å†…å­˜è¢«é‡Šæ”¾åï¼Œå®¹æ˜“äº§ç”Ÿç¢ç‰‡ï¼Œè¿™æ ·åœ¨ç”³è¯·æ–°å†…å­˜æ—¶ï¼Œå¾ˆå¯èƒ½å°±ä¼šå‡ºç°æ‰€å‰©å†…å­˜ç©ºé—´å¤Ÿç”¨ï¼Œä½†æ˜¯å´ä¸è¿ç»­ï¼Œäºæ˜¯é€ æˆæ— æ³•ç”³è¯·çš„æƒ…å†µã€‚è¿™æ—¶ï¼Œå°±éœ€è¦æš‚åœè¿è¡Œè¿›ç¨‹ï¼Œå¯¹æ®µè¿›è¡Œä¿®æ”¹ï¼Œç„¶åå†å°†å†…å­˜æ‹·è´åˆ°è¿ç»­çš„åœ°å€ç©ºé—´ä¸­ã€‚ä½†æ˜¯ï¼Œè¿ç»­æ‹·è´ä¼šè€—è´¹è¾ƒå¤šæ—¶é—´ã€‚</p><p>é‚£ä¹ˆï¼Œæ€ä¹ˆæ‰èƒ½é™ä½å†…å­˜çš„ç¢ç‰‡åŒ–ç¨‹åº¦ï¼Œè¿›è€Œæé«˜æ€§èƒ½å‘¢ï¼Ÿ</p><h2>åˆ†é¡µ</h2><p>App åœ¨è¿è¡Œæ—¶ï¼Œå¤§å¤šæ•°çš„æ—¶é—´åªä¼šä½¿ç”¨å¾ˆå°éƒ¨åˆ†çš„å†…å­˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¯”æ®µç²’åº¦æ›´å°çš„ç©ºé—´ç®¡ç†æŠ€æœ¯ï¼Œä¹Ÿå°±æ˜¯åˆ†é¡µã€‚</p><p>åˆ†é¡µå°±æ˜¯æŠŠåœ°å€ç©ºé—´åˆ‡åˆ†æˆå›ºå®šå¤§å°çš„å•å…ƒï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨å»è€ƒè™‘å †å’Œæ ˆä¼šå…·ä½“ç”³è¯·å¤šå°‘ç©ºé—´ï¼Œè€Œåªè¦è€ƒè™‘éœ€è¦å¤šå°‘é¡µå°±å¯ä»¥äº†ã€‚è¿™ï¼Œå¯¹äºæ“ä½œç³»ç»Ÿç®¡ç†æ¥è¯´ä¹Ÿä¼šç®€å•å¾ˆå¤šï¼Œåªéœ€è¦ç»´æŠ¤ä¸€ä»½é¡µè¡¨ï¼ˆPage Tableï¼‰æ¥è®°å½•è™šæ‹Ÿé¡µï¼ˆVirtual Pageï¼‰å’Œç‰©ç†é¡µï¼ˆPhysical Pageï¼‰çš„å…³ç³»å³å¯ã€‚</p><p>è™šæ‹Ÿé¡µçš„å‰ä¸¤ä½æ˜¯ VPNï¼ˆVirtual Page Numberï¼‰ï¼Œæ ¹æ®é¡µè¡¨ï¼Œç¿»è¯‘ä¸ºç‰©ç†åœ°å€ PFNï¼ˆPhysical Frame Numberï¼‰ã€‚</p><p>è™šæ‹Ÿé¡µä¸ç‰©ç†é¡µä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œå°±æ˜¯è™šæ‹Ÿå†…å­˜å’Œç‰©ç†å†…å­˜çš„å…³ç³»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/77/af/7788f425fe749bef964a78ec5fbb1eaf.png?wh=1280*1072\" alt=\"\"><br>\nå¦‚å›¾æ‰€ç¤ºï¼Œå¤šä¸ªè¿›ç¨‹è™šæ‹Ÿé¡µå’Œç‰©ç†é¡µçš„å…³ç³»é€šè¿‡ç®­å¤´å…³è”èµ·æ¥äº†ï¼Œè€Œé¡µè¡¨å°±å¯ä»¥è®°å½•ä¸‹ç®­å¤´æŒ‡å‘çš„æ˜ å°„å…³ç³»ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™šæ‹Ÿé¡µå’Œç‰©ç†é¡µçš„ä¸ªæ•°æ˜¯ä¸ä¸€æ ·çš„ã€‚æ¯”å¦‚ï¼Œåœ¨64ä½æ“ä½œç³»ç»Ÿä¸­ä½¿ç”¨çš„æ˜¯48ä½å¯»å€ç©ºé—´ï¼Œä¹‹æ‰€ä»¥ä½¿ç”¨48ä½å¯»å€ç©ºé—´ï¼Œæ˜¯å› ä¸ºæ¨å‡º64ä½ç³»ç»Ÿæ—¶ç¡¬ä»¶è¿˜ä¸èƒ½æ”¯æŒ64ä½å¯»å€ç©ºé—´ï¼Œæ‰€ä»¥å°±ä¸€ç›´å»¶ç»­ä¸‹æ¥äº†ã€‚è™šæ‹Ÿé¡µå¤§å°æ˜¯16Kï¼Œé‚£ä¹ˆè™šæ‹Ÿé¡µæœ€å¤šèƒ½æœ‰ 2^48 / 2^14 = 16M ä¸ªï¼Œç‰©ç†å†…å­˜ä¸º16Gå¯¹åº”ç‰©ç†é¡µä¸ªæ•°æ˜¯ 2^64 / 2^14 = 524k ä¸ªã€‚</p><p>ç»´æŠ¤è™šæ‹Ÿé¡µå’Œç‰©ç†é¡µå…³ç³»çš„é¡µè¡¨ä¼šéšç€è¿›ç¨‹å¢å¤šè€Œå˜å¾—è¶Šæ¥è¶Šå¤§ï¼Œå½“é¡µè¡¨å¤§äºå¯„å­˜å™¨å¤§å°æ—¶ï¼Œå°±æ— æ³•æ”¾åˆ°å¯„å­˜å™¨ä¸­ï¼Œåªèƒ½æ”¾åˆ°å†…å­˜ä¸­ã€‚å½“è¦é€šè¿‡è™šæ‹Ÿåœ°å€è·å–ç‰©ç†åœ°å€çš„æ—¶å€™ï¼Œå°±è¦å¯¹é¡µè¡¨è¿›è¡Œè®¿é—®ç¿»è¯‘ï¼Œè€Œåœ¨å†…å­˜ä¸­è¿›è¡Œè®¿é—®ç¿»è¯‘çš„é€Ÿåº¦ä¼šæ¯” CPU çš„å¯„å­˜å™¨æ…¢å¾ˆå¤šã€‚</p><p>é‚£ä¹ˆï¼Œ<strong>æ€ä¹ˆåŠ é€Ÿé¡µè¡¨ç¿»è¯‘é€Ÿåº¦å‘¢ï¼Ÿ</strong></p><p>æˆ‘ä»¬çŸ¥é“ï¼Œç¼“å­˜å¯ä»¥åŠ é€Ÿè®¿é—®ã€‚MMU ä¸­æœ‰ä¸€ä¸ª TLBï¼ˆTranslation-Lookaside Bufferï¼‰ï¼Œå¯ä»¥ä½œä¸ºç¼“å­˜åŠ é€Ÿè®¿é—®ã€‚æ‰€ä»¥ï¼Œåœ¨è®¿é—®é¡µè¡¨å‰ï¼Œé¦–å…ˆæ£€æŸ¥ TLB æœ‰æ²¡æœ‰ç¼“å­˜çš„è™šæ‹Ÿåœ°å€å¯¹åº”çš„ç‰©ç†åœ°å€ï¼š</p><ul>\n<li>å¦‚æœæœ‰çš„è¯ï¼Œå°±å¯ä»¥ç›´æ¥è¿”å›ï¼Œè€Œä¸ç”¨å†å»è®¿é—®é¡µè¡¨äº†ï¼›</li>\n<li>å¦‚æœæ²¡æœ‰çš„è¯ï¼Œå°±éœ€è¦ç»§ç»­è®¿é—®é¡µè¡¨ã€‚</li>\n</ul><p>æ¯æ¬¡éƒ½è¦è®¿é—®æ•´ä¸ªåˆ—è¡¨å»æŸ¥æ‰¾æˆ‘ä»¬éœ€è¦çš„ç‰©ç†åœ°å€ï¼Œç»ˆå½’è¿˜æ˜¯ä¼šå½±å“æ•ˆç‡ï¼Œæ‰€ä»¥åˆå¼•å…¥äº†å¤šçº§é¡µè¡¨æŠ€æœ¯ã€‚ä¹Ÿå°±æ˜¯ï¼Œæ ¹æ®ä¸€å®šçš„ç®—æ³•çµæ´»åˆ†é…å¤šçº§é¡µè¡¨ï¼Œä¿è¯ä¸€çº§é¡µè¡¨æœ€å°çš„å†…å­˜å ç”¨ã€‚å…¶ä¸­ï¼Œä¸€çº§é¡µè¡¨å¯¹åº”å¤šä¸ªäºŒçº§é¡µè¡¨ï¼Œå†ç”±äºŒçº§é¡µè¡¨å¯¹åº”è™šæ‹Ÿé¡µã€‚</p><p>è¿™æ ·å†…å­˜ä¸­åªéœ€è¦ä¿å­˜ä¸€çº§é¡µè¡¨å°±å¯ä»¥ï¼Œä¸ä»…å‡å°‘äº†å†…å­˜å ç”¨ï¼Œè€Œä¸”è¿˜æé«˜äº†è®¿é—®æ•ˆç‡ã€‚æ ¹æ®å¤šçº§é¡µè¡¨åˆ†é…é¡µè¡¨å±‚çº§ç®—æ³•ï¼Œç©ºé—´å ç”¨å¤šæ—¶ï¼Œé¡µè¡¨çº§åˆ«å¢å¤šï¼Œè®¿é—®é¡µè¡¨å±‚çº§æ¬¡æ•°ä¹Ÿä¼šå¢å¤šï¼Œæ‰€ä»¥<strong>å¤šçº§é¡µè¡¨æœºåˆ¶å±äºå…¸å‹çš„æ”¯æŒæ—¶é—´æ¢ç©ºé—´çš„çµæ´»æ–¹æ¡ˆã€‚</strong></p><p>iOS çš„ XNU Mach å¾®å†…æ ¸ä¸­æœ‰å¾ˆå¤šåˆ†é¡µå™¨æä¾›åˆ†é¡µæ“ä½œï¼Œæ¯”å¦‚ Freezer åˆ†é¡µå™¨ã€VNode åˆ†é¡µå™¨ã€‚è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›åˆ†é¡µå™¨ä¸è´Ÿè´£è°ƒåº¦ï¼Œè°ƒåº¦éƒ½æ˜¯ç”± Pageout å®ˆæŠ¤çº¿ç¨‹æ‰§è¡Œã€‚</p><p>ç”±äºç§»åŠ¨è®¾å¤‡çš„å†…å­˜èµ„æºé™åˆ¶ï¼Œè™šæ‹Ÿåˆ†é¡µåœ¨ iOS ç³»ç»Ÿä¸­çš„æ§åˆ¶æ–¹å¼æ›´ä¸¥æ ¼ã€‚ç§»åŠ¨è®¾å¤‡çš„ç£ç›˜ç©ºé—´ä¹Ÿä¸å¤Ÿç”¨ï¼Œå› æ­¤æ²¡æœ‰ä½¿ç”¨ DRAMï¼ˆåŠ¨æ€ RAMï¼‰çš„æ–¹å¼æ§åˆ¶å†…å­˜ã€‚ä¸ºäº†å‡å°‘ç£ç›˜ç©ºé—´å ç”¨ï¼ŒiOS é‡‡ç”¨äº† Jetsam æœºåˆ¶æ¥æ§åˆ¶å†…å­˜çš„ä½¿ç”¨ã€‚</p><blockquote>\n<p>å¤‡æ³¨ï¼šDRAM å†…å­˜æ§åˆ¶æ–¹å¼ï¼Œæ˜¯åœ¨è™šæ‹Ÿé¡µä¸å‘½ä¸­çš„æƒ…å†µä¸‹é‡‡ç”¨ç£ç›˜æ¥ç¼“å­˜ã€‚</p>\n</blockquote><p>å ç”¨å†…å­˜è¿‡å¤šçš„è¿›ç¨‹ä¼šè¢«å¼ºæ€ï¼Œè¿™ä¹Ÿå°±å¯¹ App å ç”¨çš„å†…å­˜æå‡ºäº†æ›´é«˜çš„è¦æ±‚ã€‚åŒæ—¶ï¼ŒJetsamæœºåˆ¶ä¹Ÿå¯ä»¥é¿å…ç£ç›˜å’Œå†…å­˜äº¤æ¢å¸¦æ¥çš„æ•ˆç‡é—®é¢˜ï¼Œå› ä¸ºç£ç›˜çš„é€Ÿåº¦è¦æ¯” DRAM æ…¢ä¸Šå‡ ä¸‡å€ã€‚</p><h2>å°ç»“</h2><p>ä»Šå¤©ï¼Œæˆ‘å’Œä½ åˆ†äº«äº† iOS ç³»ç»Ÿå†…å­˜ç®¡ç†çš„åŸç†ã€‚ç†è§£è¿™äº›åŸç†ï¼Œèƒ½å¤ŸåŠ æ·±ä½ å¯¹ç³»ç»Ÿç®¡ç†å†…å­˜æ–¹å¼çš„ç†è§£ã€‚</p><p>å¯¹äºåœ¨iOSå¼€å‘è¿‡ç¨‹ä¸­å¦‚ä½•ä¼˜åŒ–å†…å­˜ï¼Œè‹¹æœå…¬å¸åœ¨2018å¹´çš„ WWDC Session 416: <a href=\"https://developer.apple.com/videos/play/wwdc2018/416/\">iOS Memory Deep Dive</a>ä¸Šè¿›è¡Œäº†è¯¦ç»†è®²è§£ï¼Œå…¶ä¸­å°±åŒ…å«äº† iOS è™šæ‹Ÿå†…å­˜æœºåˆ¶çš„å˜åŒ–ã€‚</p><p>Xcode å¼€å‘å·¥å…·å¯¹å†…å­˜åˆ†ææ–¹é¢æ‰€åšçš„æ›´æ–°ï¼Œæ¯”å¦‚ debugger å¯ä»¥è‡ªåŠ¨æ•è·å†…å­˜å ç”¨è§¦å‘ç³»ç»Ÿé™åˆ¶çš„ EXC_RESOURCE RESOURCE_TYPE_MEMORY å¼‚å¸¸ï¼Œå¹¶æ–­ç‚¹åœ¨è§¦å‘å¼‚å¸¸çš„ä½ç½®ã€‚å¯¹ Xcode ä¸­å­˜å‚¨ App å†…å­˜ä¿¡æ¯çš„ memgrah æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ vmmapã€leaksã€heapã€malloc_history ç­‰å‘½ä»¤è¡Œå·¥å…·æ¥åˆ†æã€‚</p><p>åœ¨è¿™ä¸ªSession ä¸­ï¼Œè‹¹æœå…¬å¸è¿˜æ¨èæˆ‘ä»¬ä½¿ç”¨ UIGraphicsImageRenderer æ›¿ä»£ UIGraphicsBeginImageContextWithOptionsï¼Œè®©ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©æœ€ä½³çš„å›¾ç‰‡æ ¼å¼ï¼Œè¿™æ ·ä¹Ÿèƒ½å¤Ÿé™ä½å ç”¨çš„å†…å­˜ã€‚å¯¹äºå›¾ç‰‡çš„ç¼©æ”¾ï¼Œè‹¹æœå…¬å¸æ¨èä½¿ç”¨ ImageIO ç›´æ¥è¯»å–å›¾ç‰‡çš„å¤§å°å’Œå…ƒæ•°æ®ï¼Œä¹Ÿå°±é¿å…äº†ä»¥å‰å°†åŸå§‹å›¾ç‰‡åŠ è½½åˆ°å†…å­˜ç„¶åè¿›è¡Œè½¬æ¢è€Œå¸¦æ¥çš„é¢å¤–å†…å­˜å¼€é”€ã€‚</p><p>å…¶å®ï¼Œå›¾ç‰‡èµ„æºä¸ä»…æ˜¯å½±å“AppåŒ…å¤§å°çš„é‡è¦å› ç´ ï¼Œä¹Ÿæ˜¯å†…å­˜çš„æ¶ˆè€—å¤§æˆ·ã€‚è‹¹æœå…¬å¸åœ¨2018å¹´çš„WWDC Session 219: <a href=\"https://developer.apple.com/videos/play/wwdc2018/219/\">Images and Graphics Best Practices</a>ä¸­ï¼Œè¿˜ä¸“é—¨ä»‹ç»äº†å…³äºå›¾ç‰‡çš„æœ€ä½³å®è·µï¼Œå¹¶é’ˆå¯¹å‡å°‘å†…å­˜æ¶ˆè€—è¿›è¡Œäº†è¯¦ç»†è®²è§£ã€‚</p><p>å¯¹äº App å¤„åœ¨ä½å†…å­˜æ—¶å¦‚ä½•å¤„ç†ï¼Œä½ å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« â€œ<a href=\"http://newosxbook.com/articles/MemoryPressure.html\">No pressure, Mon! Handling low memory conditions in iOS and Mavericks</a>â€ã€‚</p><h2>è¯¾åä½œä¸š</h2><p>ç¬¬ä¸‰æ–¹å†…å­˜æ£€æµ‹å·¥å…·æœ‰ <a href=\"https://github.com/Tencent/MLeaksFinder\">MLeaksFinder</a>ã€<a href=\"https://github.com/facebook/FBRetainCycleDetector\">FBRetainCycleDetector</a>ã€<a href=\"https://github.com/Tencent/OOMDetector\">OOMDetector</a>ã€‚ä½ çŸ¥é“è¿™äº›å·¥å…·è¿›è¡Œå†…å­˜æ£€æµ‹çš„åŸç†å—ï¼Ÿ</p><p>æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæ¬¢è¿ä½ åœ¨è¯„è®ºåŒºç»™æˆ‘ç•™è¨€åˆ†äº«ä½ çš„è§‚ç‚¹ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p>","neighbors":{"left":{"article_title":"35 | libffiï¼šåŠ¨æ€è°ƒç”¨å’Œå®šä¹‰ C å‡½æ•°","id":98154},"right":{"article_title":"37 | å¦‚ä½•ç¼–å†™ Clang æ’ä»¶ï¼Ÿ","id":99007}},"comments":[{"had_liked":false,"id":100004,"user_name":"ColdMountain","can_delete":false,"product_type":"c1","uid":1454505,"ip_address":"","ucode":"06A515A2307912","user_header":"https://static001.geekbang.org/account/avatar/00/16/31/a9/28fa245b.jpg","comment_is_top":false,"comment_ctime":1559383897,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"44509056857","product_id":100024501,"comment_content":"å†…å­˜å°±æ˜¯ é‚£è¾¹ç¨‹åºå‘˜è‡ªæˆ‘ä¿®å…» ä¹¦é‡Œé¢è¯´çš„ å‰ä¸¤ç« èŠ‚ çœ‹äº†ä¸¤é æ”¶è·å¾ˆå¤§","like_count":10},{"had_liked":false,"id":250602,"user_name":"åˆ˜å„’å‹‡","can_delete":false,"product_type":"c1","uid":1071044,"ip_address":"","ucode":"D8A8D7866045F8","user_header":"https://static001.geekbang.org/account/avatar/00/10/57/c4/0fcdad37.jpg","comment_is_top":false,"comment_ctime":1601167686,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14486069574","product_id":100024501,"comment_content":"â€œè™šæ‹Ÿé¡µå¤§å°æ˜¯ 16Kï¼Œé‚£ä¹ˆè™šæ‹Ÿé¡µæœ€å¤šèƒ½æœ‰ 2^48 &#47; 2^14 = 16M ä¸ªï¼Œç‰©ç†å†…å­˜ä¸º 16G å¯¹åº”ç‰©ç†é¡µä¸ªæ•°æ˜¯ 2^64 &#47; 2^14 = 524k ä¸ªã€‚â€<br><br>2^48&#47;2^14&#47;2^30 = 16 Gä¸ªè™šæ‹Ÿå†…å­˜é¡µ<br>ç‰©ç†å†…å­˜16G ï¼Œ2^34&#47;2^14 = 2^20 = 1M ä¸ª","like_count":3,"discussions":[{"author":{"id":2449060,"avatar":"https://static001.geekbang.org/account/avatar/00/25/5e/a4/d48b8298.jpg","nickname":"Geek_sz","note":"","ucode":"72E86D7D6554CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":531662,"discussion_content":"æ¢ç®—å…³ç³»æ˜¯ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637376541,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":179745,"user_name":"accessory","can_delete":false,"product_type":"c1","uid":1455454,"ip_address":"","ucode":"988A99ACF03611","user_header":"https://static001.geekbang.org/account/avatar/00/16/35/5e/7a584fed.jpg","comment_is_top":false,"comment_ctime":1582089527,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10172024119","product_id":100024501,"comment_content":"æ‚¨å¥½ï¼Œå¯¹äºè™šæ‹Ÿé¡µå’Œç‰©ç†é¡µçš„æ˜ å°„å›¾ï¼Œè¿›ç¨‹1çš„è™šæ‹Ÿé¡µvp5å’Œè¿›ç¨‹2çš„è™šæ‹Ÿé¡µvp4æ˜ å°„åˆ°åŒä¸€ä¸ªç‰©ç†é¡µpp2ä¸ä¼šæœ‰é—®é¢˜å˜›ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1785940,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/rWMGIQG1z13nekorr9I4PY1w7rlskssf949IQ24SvIewpM7mmZoH2QEZ2aKHu5tkmicGQ7KTGrN9vFYhrDsdp9w/132","nickname":"Geek_9dbcb4","note":"","ucode":"BB92D5E844A743","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":237969,"discussion_content":"å¤šä¸ªçº¿ç¨‹ï¼Œå¯ä»¥è®¿é—®è¿›ç¨‹çš„å…±äº«èµ„æºçš„ã€‚ä¾‹å¦‚å…¨å±€å˜é‡ã€å¸¸é‡ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1587201581,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":311747,"user_name":"Geek_467f30","can_delete":false,"product_type":"c1","uid":2699184,"ip_address":"","ucode":"31FDEC4896D3FD","user_header":"","comment_is_top":false,"comment_ctime":1631440759,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631440759","product_id":100024501,"comment_content":"&quot;ç¨‹åºç”Ÿæˆçš„æ±‡ç¼–ä»£ç ä¼šæ”¾åœ¨ä»£ç æ®µã€‚&quot;<br>æ˜¯æœºå™¨ç å§","like_count":1},{"had_liked":false,"id":264999,"user_name":"é˜³å…‰é»‘1","can_delete":false,"product_type":"c1","uid":1458075,"ip_address":"","ucode":"AE7C19422F565C","user_header":"https://static001.geekbang.org/account/avatar/00/16/3f/9b/f626552c.jpg","comment_is_top":false,"comment_ctime":1606730351,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606730351","product_id":100024501,"comment_content":"MLeaksFinderåœ¨æŸä¸ªVC popæˆ–dismissåä¸¤ç§’ä¼šè°ƒç”¨ä¸€ä¸ªæ–¹æ³•ï¼Œå¦‚æœèƒ½è°ƒç”¨å°±è¯´æ˜è¯¥VCæ²¡æœ‰è¢«é‡Šæ”¾æ‰","like_count":0},{"had_liked":false,"id":242617,"user_name":"nil","can_delete":false,"product_type":"c1","uid":1507193,"ip_address":"","ucode":"0F5D298C1CBB74","user_header":"https://static001.geekbang.org/account/avatar/00/16/ff/79/3b38c9e1.jpg","comment_is_top":false,"comment_ctime":1597798268,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597798268","product_id":100024501,"comment_content":"unix likeçš„osï¼Œkernelè®¾è®¡çœŸçš„æ˜¯ç»è¿‡åƒé”¤ç™¾ç‚¼ï¼Œè®¾è®¡ç²¾å¦™ä¸”é«˜æ•ˆï¼Œå¹æœå‰è¾ˆä»¬ã€‚æ²‰æ·€ä¸‹æ¥çš„åŸºæœ¬å°±æ˜¯æœ€ä½³å®è·µï¼Œæˆ–è€…è¯´åœ¨æ»¡è¶³å·²æœ‰é™åˆ¶ä¸‹çš„æ¯”è¾ƒåˆç†çš„trade-off","like_count":0},{"had_liked":false,"id":200914,"user_name":"è‘£å°šæ–Œ","can_delete":false,"product_type":"c1","uid":1195545,"ip_address":"","ucode":"9582217F65C1C7","user_header":"https://static001.geekbang.org/account/avatar/00/12/3e/19/873abe8a.jpg","comment_is_top":false,"comment_ctime":1585671871,"is_pvip":false,"discussion_count":6,"race_medal":0,"score":"1585671871","product_id":100024501,"comment_content":"æ‚¨å¥½ï¼Œè¯·æ•™ä¸ªé—®é¢˜ã€‚æœ›å›å¤ã€‚<br>iOSé‡‡ç”¨çš„æ˜¯å¼•ç”¨è®¡æ•°ï¼Œåœ¨å¼€å¯ARCçš„æƒ…å†µä¸‹ï¼Œæˆ‘åœ¨ä¸€ä¸ªèŠ±æ‹¬å·é‡Œé¢ç”³è¯·çš„å˜é‡å‡ºäº†èŠ±æ‹¬å·æ˜¯ä¸æ˜¯æ„å‘³ç€ä¼šè¢«ç¼–è¯‘å™¨è‡ªåŠ¨åŠ å…¥releaseçš„é‡Šæ”¾ä»£ç ï¼Œå³ä¿è¯åœ¨å¼•ç”¨è®¡æ•°å½’0è‡ªåŠ¨deallocã€‚<br>é‚£ä¸ºå•¥è¿˜éœ€è¦@autoreleasepool{...} è¿™æ ·çš„é€»è¾‘ï¼Œæˆ‘ç›´æ¥ä½¿ç”¨èŠ±æ‹¬å·{}ä¸å°±å¯ä»¥äº†å—[c é‡Œé¢å¯¹äºå‡ºæ ˆçš„ä¼šè‡ªåŠ¨é‡Šæ”¾]ï¼Œå¸Œæœ›èƒ½æ˜ç™½æˆ‘çš„æ„æ€ã€‚<br>{}å‡ºäº†è¿™ä¸ªèŠ±æ‹¬å·ä½œç”¨åŸŸä¹‹å¤–ï¼Œocçš„å¯¹è±¡ä¸å°±è‡ªåŠ¨é”€æ¯äº†å—ï¼Ÿé‚£ä¸ºå•¥è¿˜è¦@autoreleasepool{}<br>","like_count":0,"discussions":[{"author":{"id":2067646,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/8c/be/eeda0ed0.jpg","nickname":"æˆ‘çˆ±é’¢é“ä¾ ï¼","note":"","ucode":"C1AFF814B18BDE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":292737,"discussion_content":"ä½ çš„å¤§æ‹¬å·çš„æ„æ€æ˜¯ä½œç”¨åŸŸï¼Œåœ¨ARCç¯å¢ƒä¸‹ï¼Œç¼–è¯‘å™¨æ˜¯åœ¨åˆé€‚çš„åœ°æ–¹å¯¹è¯¥å¯¹è±¡å‘é€autoReleaseæ¶ˆæ¯ï¼Œæ¥å—è¯¥æ¶ˆæ¯çš„å¯¹è±¡ä¼šæ”¾åœ¨æœ€è¿‘çš„è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼Œè‡ªåŠ¨é‡Šæ”¾æ± åº•å±‚æœ‰å¯¹å¯¹è±¡çš„é‡Šæ”¾ç­‰ç®¡ç†æœºåˆ¶ï¼ˆçœ‹æºç ï¼‰ï¼Œæ‰€ä»¥å¦‚æœåªæ˜¯æ·»åŠ { }çš„å·ï¼Œåˆ›å»ºçš„å¯¹è±¡æœ‰å¯èƒ½è¢«æ”¾ç½®åœ¨MainRunloopç»´æŠ¤çš„è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼Œæ‰€ä»¥è¯¥å¯¹è±¡çš„é”€æ¯å’Œé‡Šæ”¾æ—¶æœºä¾èµ–runloop,è€Œä¸èƒ½ç®€å•çš„è®¤ä¸ºå‡ºäº†ä½œç”¨åŸŸå°±ä¼šè¢«é‡Šæ”¾","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1595320595,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1328565,"avatar":"https://static001.geekbang.org/account/avatar/00/14/45/b5/081ff639.jpg","nickname":"è´ºå½¦æ–‡","note":"","ucode":"1FB6C61394FE72","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2067646,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/8c/be/eeda0ed0.jpg","nickname":"æˆ‘çˆ±é’¢é“ä¾ ï¼","note":"","ucode":"C1AFF814B18BDE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":342164,"discussion_content":"åˆ›å»ºçš„å¯¹è±¡æœ‰å¯èƒ½è¢«æ”¾ç½®åœ¨MainRunloopç»´æŠ¤çš„è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ã€‚è¿™ä¸ªæ²¡å¯èƒ½ï¼Œåªæœ‰è°ƒç”¨autoReleaseçš„å¯¹è±¡æ‰ä¼šè¢«æ”¾åˆ°è‡ªåŠ¨é‡Šæ”¾æ± ã€‚è¿™é‡ŒåŠ å¤§æ‹¬å·æ²¡ä½œç”¨ï¼Œåº”è¯¥æ˜¯å› ä¸ºæ²¡æœ‰æ”¹å˜å‡½æ•°è°ƒç”¨æ ˆçš„ä½œç”¨åŸŸï¼Œè™½ç„¶åŠ äº†å¤§æ‹¬å·ï¼Œä½†æ˜¯forå¾ªç¯ä»£ç è¿˜æ˜¯åœ¨æ•´ä¸ªè°ƒç”¨forå¾ªç¯çš„å‡½æ•°è°ƒç”¨æ ˆé‡Œï¼Œforå¾ªç¯åˆ›å»ºçš„ä¸´æ—¶å˜é‡ä¹‹ä¸€æ²¡æœ‰å‡ºæ ˆï¼Œä¸€ç›´æ˜¯è¢«strongæŒ‡é’ˆæŒæœ‰ç€ã€‚ä¹Ÿå°±ä¸€ç›´ä¸ä¼šé”€æ¯ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610603748,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":292737,"ip_address":""},"score":342164,"extra":""}]},{"author":{"id":1456139,"avatar":"https://static001.geekbang.org/account/avatar/00/16/38/0b/e1b19a3a.jpg","nickname":"404","note":"","ucode":"DB0BFA057D07F0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375383,"discussion_content":"æˆ‘æ¥è¯´ä¸‹æˆ‘çš„ç†è§£ï¼Œä¸çŸ¥é“å¯¹ä¸å¯¹ã€‚\né¦–å…ˆcè¯­è¨€mallocå‡ºæ¥çš„ä¹Ÿè¦ä¸»åŠ¨è°ƒç”¨freeæˆ–è€…releaseç­‰æ¥é‡Šæ”¾ã€‚\nä½ è¯´çš„è¿‡ä½œç”¨åŸŸåªæ˜¯æŒ‡å‘è¿™å—å†…å­˜åœ°å€çš„æŒ‡é’ˆå˜é‡æˆ–è€…å˜é‡è¢«é”€æ¯äº†ï¼Œä½†æŒ‡é’ˆæŒ‡å‘çš„è¿™ä¸ªå†…å­˜åœ°å€ä¸Šçš„å¯¹è±¡ä»»ç„¶æ²¡æœ‰è¢«é”€æ¯ã€‚æ¯”å¦‚ä½ æœ‰ä¸€å¤©ä¸å°å¿ƒæŠŠæ‰‹æœºé€šè®¯å½•ä¸ŠæŸä¸ªäººçš„è”ç³»æ–¹å¼åˆ æ‰äº†ï¼Œä½†ä»–ä»»ç„¶å­˜åœ¨ï¼Œé€šè¿‡æ‰‹æœºå·ç ä»»ç„¶èƒ½å¤Ÿæ‰“é€šä»–çš„ç”µè¯ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621599760,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1458075,"avatar":"https://static001.geekbang.org/account/avatar/00/16/3f/9b/f626552c.jpg","nickname":"é˜³å…‰é»‘1","note":"","ucode":"AE7C19422F565C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":330918,"discussion_content":"å¦‚æœæ˜¯ä¸€ä¸ªforå¾ªç¯  é‡Œé¢çš„å±€éƒ¨å˜é‡æ— æ³•ç«‹å³é‡Šæ”¾ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606730446,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1459289,"avatar":"https://static001.geekbang.org/account/avatar/00/16/44/59/9cc7d8cd.jpg","nickname":"æ¯›æˆæ–¹","note":"","ucode":"DFBF3D464D8D7C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":246690,"discussion_content":"å¯ä»¥æŸ¥çœ‹autoreleasepool çš„åº•å±‚C++å®ç°è¿‡ç¨‹ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587766196,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1785940,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/rWMGIQG1z13nekorr9I4PY1w7rlskssf949IQ24SvIewpM7mmZoH2QEZ2aKHu5tkmicGQ7KTGrN9vFYhrDsdp9w/132","nickname":"Geek_9dbcb4","note":"","ucode":"BB92D5E844A743","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":237968,"discussion_content":"@autoreleasepool{}ä¼šæ›´æ—©çš„é‡Šæ”¾å†…éƒ¨çš„å†…å­˜å ç”¨ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587201498,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":100752,"user_name":"Bill","can_delete":false,"product_type":"c1","uid":1273035,"ip_address":"","ucode":"DAF34E50CF3434","user_header":"https://static001.geekbang.org/account/avatar/00/13/6c/cb/8a41f8ce.jpg","comment_is_top":false,"comment_ctime":1559632557,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559632557","product_id":100024501,"comment_content":"å“ˆå“ˆç¨‹åºå‘˜è‡ªæˆ‘ä¿®å…»é‡Œè§è¿‡ğŸ˜¬","like_count":0}]}