{"id":436371,"title":"ç‰¹åˆ«æ”¾é€ | å’Œä½ èŠèŠç°ä»£C++é‡Œçš„â€œç‰¹æ®Šå®¹å™¨â€","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯Chronoã€‚</p><p>ã€Šç½—å‰‘é”‹çš„C++å®æˆ˜ç¬”è®°ã€‹è¿™é—¨è¯¾å·²ç»å®Œç»“æœ‰ä¸€å¹´å¤šçš„æ—¶é—´äº†ï¼Œçœ‹åˆ°æœ‰å¾ˆå¤šåŒå­¦è¿˜åœ¨ç•™è¨€åŒºç ”ç©¶ã€æ¢è®¨C++çš„æŠ€æœ¯é—®é¢˜ï¼Œæˆ‘éå¸¸å¼€å¿ƒã€‚èƒ½å¤Ÿä¸ºç°ä»£C++åœ¨å›½å†…çš„æ¨å¹¿æ™®åŠåšä¸€ç‚¹åŠ›æ‰€èƒ½åŠçš„è´¡çŒ®ï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œå®åœ¨æ˜¯ä¸€ä»¶å¾ˆæœ‰æ„ä¹‰çš„äº‹æƒ…ã€‚</p><h2>ä¸€ä¸ªå¥½æ¶ˆæ¯</h2><p>ç°åœ¨ï¼Œè¿˜æœ‰ä¸€ä¸ªå¥½æ¶ˆæ¯è¦å‘Šè¯‰æŒç»­å…³æ³¨è¿™é—¨è¯¾çš„æœ‹å‹ä»¬ã€‚å¹´åˆçš„æ—¶å€™ï¼Œäººæ°‘é‚®ç”µå‡ºç‰ˆç¤¾çš„ç¼–è¾‘åœ¨ç½‘ä¸Šè”ç³»åˆ°äº†æˆ‘ï¼Œä»–ä»¬ä¹Ÿå¯¹ç°ä»£C++å¾ˆæ„Ÿå…´è¶£ï¼Œæƒ³æŠŠè¿™ä¸ªçº¿ä¸Šçš„è¯¾ç¨‹â€œæ¬â€åˆ°çº¿ä¸‹ï¼Œæ”¹æˆçº¸è´¨çš„å®ä½“å›¾ä¹¦ã€‚</p><p>äºæ˜¯ï¼Œè¿™å¤§åŠå¹´æ¥ï¼Œæˆ‘å°±èŠ±äº†å¾ˆå¤šç²¾åŠ›ä¸å‡ºç‰ˆç¤¾åˆä½œï¼ŒæŠŠè¿™é—¨è¯¾çš„å†…å®¹é‡æ–°æ•´ç†å®Œå–„ï¼Œæ”¹æˆæ›´é€‚åˆçº¸è´¨å›¾ä¹¦é˜…è¯»çš„å½¢å¼ã€‚ç°åœ¨æ¥çœ‹ï¼Œè™½ç„¶æ ¸å¿ƒçš„å†…å®¹ä¸å˜ï¼Œä½†åœ¨è¯­è¨€è¡¨è¿°ã€ç¤ºä¾‹ä»£ç ã€æ•´ä½“æ¶æ„æ–¹é¢éƒ½åšäº†éå¸¸å¤§çš„ä¿®æ”¹ï¼Œå¯ä»¥è¯´æ˜¯æŠŠè¿™é—¨è¯¾ç”±å†…åˆ°å¤–åŠ¨äº†ä¸€ä¸ªâ€œå¤§æ‰‹æœ¯â€ï¼Œå®Œå…¨å˜æˆäº†å¦å¤–ä¸€å¹…é¢å­”å¦ä¸€ä¸ªäººã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/3c/3f/3cb3e4b565f5b6fc656803d8dfac513f.png?wh=957x315\" alt=\"\"></p><blockquote>\n<p>ç½—å‰‘é”‹çš„ã€ŠC++å®æˆ˜ç¬”è®°ã€‹å·²ç»åœ¨æå®¢å•†åŸä¸Šçº¿ï¼Œä½ å¯ä»¥ç‚¹å‡»<a href=\"https://shop18793264.m.youzan.com/wscgoods/detail/2oiy2u01z4b3c6d?dc_ps=2911469729606718469.200001\">é“¾æ¥</a>è´­ä¹°ã€‚</p>\n</blockquote><p>å¦å¤–ï¼Œè¿™é—¨è¯¾ä¸Šçº¿ä¹‹åˆè€ƒè™‘åˆ°å›½å†…çš„C++åº”ç”¨ç°çŠ¶ï¼Œä½¿ç”¨çš„æ˜¯C++11/14ï¼ŒGCCçš„ç‰ˆæœ¬æ˜¯5.4ï¼Œè€Œåˆ°äº†ä¸€å¹´ä¹‹åçš„ä»Šå¤©ï¼Œç¡®å®æ˜¾å¾—æœ‰ç‚¹è€æ—§äº†ã€‚æ‰€ä»¥å€Ÿç€è¿™æ¬¡å‡ºç‰ˆå›¾ä¹¦çš„æœºä¼šï¼Œæˆ‘ä¹Ÿåšäº†ä¸€ä¸ªå…¨é¢çš„å‡çº§ï¼ŒC++æ ‡å‡†æ›´æ–°åˆ°äº†17/20ï¼ŒGCCçš„ç‰ˆæœ¬æ˜¯7.5å’Œ10.3ï¼Œåº”è¯¥å¯ä»¥åœ¨ä¸€ä¸¤å¹´çš„æ—¶é—´ä¹‹å†…ä¸ä¼šè¿‡æ—¶ã€‚</p><!-- [[[read_end]]] --><p>ç›¸åº”åœ°ï¼Œå›¾ä¹¦é‡Œçš„ç¤ºä¾‹ä»£ç ä¹Ÿåšäº†æ›´æ–°å’Œè°ƒæ•´ï¼Œå…¨éƒ¨ä½¿ç”¨C++17/20æ ‡å‡†å’ŒGCC7/10ç¼–è¯‘é€šè¿‡ï¼Œåº”ç”¨äº†è®¸å¤šæ ‡å‡†é‡Œçš„æ–°ç‰¹æ€§ã€‚</p><p>è€Œä¸”ï¼Œä¸ºäº†è®©å›¾ä¹¦æ›´å…·â€œå®æˆ˜â€ä»·å€¼ï¼Œæˆ‘è¿˜åœ¨æ¯ä¸ªç« èŠ‚éƒ½æ–°å¢äº†å¾ˆå¤šçš„å†…å®¹ï¼Œæ¯”å¦‚ç”¨Docker/Kubernetesæ­å»ºå¼€å‘ç¯å¢ƒã€C++å„æ ‡å‡†ç‰¹æ€§ä»‹ç»ã€C++20çš„æ ¼å¼åŒ–åŠŸèƒ½ã€èŒƒå›´ç®—æ³•ã€Boostç¨‹åºåº“ç²¾é€‰ç­‰ç­‰ã€‚è¿™äº›éƒ½æ˜¯å½“åˆè®¾è®¡è¿™é—¨è¯¾çš„æ—¶å€™æƒ³å†™ä½†å› ä¸ºç§ç§åŸå› æ²¡æœ‰æ¥å¾—åŠå†™çš„å†…å®¹ï¼Œç°åœ¨ç»ˆäºèƒ½å¤Ÿå‘ˆç°åœ¨å¹¿å¤§C++çˆ±å¥½è€…é¢å‰äº†ï¼Œä¹Ÿç®—æ˜¯äº†ç»“äº†æˆ‘çš„ä¸€ä»½å¿ƒæ„¿ã€‚</p><p>å› ä¸ºç¤ºä¾‹ä»£ç éƒ½ä½¿ç”¨äº†æ–°æ ‡å‡†ï¼ŒåŸæ¥çš„GitHubé¡¹ç›®cpp_studyï¼ˆ<a href=\"https://github.com/chronolaw/cpp_study\">https://github.com/chronolaw/cpp_study</a>ï¼‰å·²ç»ä¸å¤ªåˆé€‚äº†ï¼Œæ‰€ä»¥æˆ‘åˆæ–°å¼€äº†ä¸€ä¸ªé¡¹ç›®cpp_noteï¼ˆ<a href=\"https://github.com/chronolaw/cpp_note\">https://github.com/chronolaw/cpp_note</a>ï¼‰ï¼Œå¹¶ä¸”åœ¨DockerHubä¸Šæä¾›äº†æ‰“åŒ…å¥½çš„é•œåƒï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤â€œdocker pull chronolaw/cpp_noteâ€æ‹‰å–åç›´æ¥åœ¨æœ¬åœ°è¿è¡Œã€‚</p><p>ä¸è¿‡ï¼Œç”±äºç›®å‰GitHubä¸å¤Ÿç¨³å®šï¼Œæœ‰çš„æ—¶å€™å¯èƒ½è®¿é—®èµ·æ¥æœ‰å›°éš¾ï¼Œå¦‚æœä½ æœ‰éœ€è¦ï¼Œå¯ä»¥åœ¨è¿™é‡Œç•™è¨€ï¼Œæˆ‘ä¼šåœ¨å›½å†…æ‰¾ä¸ªæ‰˜ç®¡ç½‘ç«™åšé¡¹ç›®åŒæ­¥ï¼Œæ–¹ä¾¿å¤§å®¶çš„ä½¿ç”¨å’Œå­¦ä¹ ã€‚</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥å‘¢ï¼Œæˆ‘å°±æ‘˜å–å›¾ä¹¦ä¸­çš„ä¸€éƒ¨åˆ†æ–°å†…å®¹ï¼Œ<strong>æ¥èŠèŠC++17æ ‡å‡†é‡Œæä¾›çš„optionalå’Œvariantè¿™ä¸¤ç§ç‰¹æ®Šå®¹å™¨ã€‚</strong></p><p>å®¹å™¨æˆ‘ä»¬éƒ½å·²ç»å¾ˆç†Ÿæ‚‰äº†ï¼Œé‚£ä»€ä¹ˆæ˜¯â€œç‰¹æ®Šå®¹å™¨â€å‘¢ï¼Ÿ</p><p>ä¼ ç»Ÿæ„ä¹‰ä¸ŠC++é‡Œçš„å®¹å™¨ï¼ŒæŒ‡çš„å°±æ˜¯åœ¨è¯¾ç¨‹<a href=\"https://time.geekbang.org/column/article/243319\">ç¬¬12è®²</a>é‡Œä»‹ç»çš„é¡ºåºå®¹å™¨ã€æœ‰åºå®¹å™¨å’Œæ— åºå®¹å™¨ï¼Œä½†éšç€è¯­è¨€çš„å‘å±•ï¼Œæ ‡å‡†åº“é‡Œä¹Ÿå¢åŠ äº†ä¸€äº›æ–°çš„æ•°æ®ç»“æ„ã€‚å®ƒä»¬ä¸å®Œå…¨ç¬¦åˆå®¹å™¨çš„å®šä¹‰ï¼Œä½†åœ¨ç”¨æ³•ã€ç”¨é€”ä¸Šåˆå¾ˆåƒå®¹å™¨ï¼Œæ‰€ä»¥è¿™ç±»æ•°æ®ç»“æ„ä¸€èˆ¬å°±ç»Ÿç§°ä¸ºâ€œç‰¹æ®Šå®¹å™¨â€ã€‚</p><h2>å¯é€‰å€¼optional</h2><p>ä½ ä¸€å®šçŸ¥é“ï¼ŒC++çš„å‡½æ•°åªèƒ½è¿”å›ä¸€ä¸ªå€¼ï¼Œè¿™ä¸ªå€¼å¿…é¡»æ˜¯å¯ç”¨çš„ã€æœ‰æ•ˆçš„ã€æœ‰æ„ä¹‰çš„ï¼Œæ¯”å¦‚åˆ†é…çš„å­—èŠ‚æ•°ã€åˆ›å»ºçš„å¯¹è±¡æŒ‡é’ˆã€æŸ¥æ‰¾å­—ç¬¦ä¸²çš„ä½ç½®ç­‰ç­‰ã€‚</p><p>ä¸è¿‡ï¼Œå¾ˆå¤šæ—¶å€™å‡½æ•°å¦‚æœæ‰§è¡Œä¸æˆåŠŸï¼Œå°±ä¸ä¸€å®šèƒ½å¤Ÿè¿”å›æœ‰æ„ä¹‰çš„å€¼ï¼Œæ¯”å¦‚å†…å­˜ç©ºé—´ä¸è¶³ã€åˆ›å»ºå¯¹è±¡å¤±è´¥ã€æ¨¡å¼å­—ç¬¦ä¸²ä¸å­˜åœ¨ç­‰ç­‰ï¼Œè¿™ä¸ªæ—¶å€™å‡½æ•°çš„è¿”å›å€¼å°±ä¼šæ˜¯æ— æ•ˆçš„ã€‚</p><p>ä½†C++çš„ä¼ ç»Ÿæ–¹å¼åœ¨è¡¨ç¤ºâ€œæ— æ•ˆâ€æ¦‚å¿µçš„æ—¶å€™æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼Œå®ƒé€šå¸¸ä¼šç”¨ä¸€ä¸ªç‰¹æ®Šçš„0æˆ–è€…-1æ¥è¡¨ç¤ºï¼Œæ¯”å¦‚åˆ†é…å†…å­˜ã€åˆ›å»ºå¯¹è±¡è¿”å›nullptrï¼ŒæŸ¥æ‰¾å­—ç¬¦è¿”å›nposã€‚</p><p>ä½†è¿˜æœ‰å¾ˆå¤šæ—¶å€™å‡½æ•°è°ƒç”¨å¯èƒ½å¹¶ä¸å­˜åœ¨è¿™ç§â€œæ— æ•ˆå€¼â€ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨å®æ•°åŸŸä¸Šæ±‚å¹³æ–¹æ ¹ï¼Œå¦‚æœæ“ä½œå¯¹è±¡æ˜¯è´Ÿæ•°ï¼Œé‚£ä¹ˆå‡½æ•°å°±æ²¡æœ‰æ°å½“çš„æ–¹æ³•æ¥å¤„ç†ï¼Œæ²¡æœ‰åŠæ³•è¿”å›ä¸€ä¸ªåˆç†çš„â€œæ— æ•ˆå€¼â€ã€‚</p><p>å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ç§æƒ…å†µè§†ä¸ºé”™è¯¯ï¼Œç”¨æŠ›å‡ºå¼‚å¸¸çš„æ–¹å¼æ¥æŠ¥é”™ï¼Œä½†è¿™æ ·çš„æˆæœ¬å¤ªé«˜ï¼Œè€Œä¸”æœ‰çš„åœºåˆä¸‹å¼‚å¸¸çš„ä½¿ç”¨ä¹Ÿå¯èƒ½å—åˆ°é™åˆ¶ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>æˆ‘ä»¬å°±éœ€è¦æœ‰ä¸€ç§ç®€å•ã€è½»é‡çº§çš„æ¦‚å¿µï¼Œå®ƒèƒ½å¤Ÿè¡¨ç¤ºä»»ä½•çš„â€œæ— æ•ˆå€¼â€ï¼Œè¿™åœ¨ç°ä»£C++ä¸­å°±æ˜¯æ¨¡æ¿ç±»optionalã€‚</strong></p><p>optionalå¯ä»¥è¿‘ä¼¼åœ°çœ‹åšæ˜¯åªèƒ½å®¹çº³ä¸€ä¸ªå…ƒç´ çš„ç‰¹æ®Šå®¹å™¨ï¼Œè€Œè¿™æ ·çš„å®¹å™¨å°±ä¼šæœ‰æ˜¯å¦æŒæœ‰å…ƒç´ çš„ä¸¤ç§çŠ¶æ€ï¼Œâ€œç©ºâ€å’Œâ€œéç©ºâ€ï¼Œæ°å¥½å°±å¯¹åº”æ— æ•ˆå’Œæœ‰æ•ˆï¼Œä¸éœ€è¦ä½¿ç”¨ç‰¹æ®Šçš„0æˆ–è€…-1ï¼Œéå¸¸è‡ªç„¶åœ°è§£å†³äº†æˆ‘ä»¬ä¸Šé¢é‡åˆ°çš„éš¾é¢˜ã€‚</p><p>optionalå¯¹è±¡é»˜è®¤æ˜¯ç©ºçš„ï¼Œä¹Ÿå°±æ˜¯å¤„äºæ— æ•ˆçŠ¶æ€ï¼Œç»™å®ƒèµ‹å€¼åå› ä¸ºé‡Œé¢æœ‰äº†å…ƒç´ ï¼Œå°±å˜æˆäº†æœ‰æ•ˆçŠ¶æ€ï¼Œåˆ¤æ–­optionalå¯¹è±¡æ˜¯å¦æœ‰æ•ˆå¯ä»¥è°ƒç”¨å®ƒçš„æˆå‘˜å‡½æ•°has_value()ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>optional&lt;int&gt; op; \t\t\t\t\t\t// æŒæœ‰intçš„optionalå¯¹è±¡\nassert(!op.has_value()); \t\t\t\t// é»˜è®¤æ˜¯æ— æ•ˆå€¼\n\nop = 10; \t\t\t\t\t\t\t\t// èµ‹å€¼ï¼ŒæŒæœ‰æœ‰æ•ˆå€¼\nif (op.has_value()) {\t\t\t\t\t// åˆ¤æ–­æ˜¯å¦æœ‰æ•ˆ\n  cout &lt;&lt; &quot;value is valid&quot; &lt;&lt; endl;\n} \n</code></pre><p>å¦‚æœoptionalæ˜¯æœ‰æ•ˆçš„ï¼Œä¹Ÿå°±æ˜¯è¯´é‡Œé¢æœ‰å€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è°ƒç”¨æˆå‘˜å‡½æ•°value()è·å–å€¼çš„å¼•ç”¨ï¼Œè€Œå¦ä¸€ä¸ªæˆå‘˜å‡½æ•°value_or()åˆ™æ›´çµæ´»äº›ï¼Œå¦‚æœoptionalæ— æ•ˆå°±ä¼šè¿”å›ç»™å®šçš„æ›¿ä»£å€¼ï¼Œå¯ä»¥å…å»æˆ‘ä»¬æ£€æŸ¥çš„æ­¥éª¤ï¼Œä»£ç å†™èµ·æ¥æ›´åŠ ç®€å•ï¼š</p><pre><code>optional&lt;int&gt; op1 = 42; \t\t\t\t// åˆå§‹åŒ–æœ‰æ•ˆå€¼çš„optional\n\nif (op1.has_value()) {\t\t\t\t\t// åˆ¤æ–­æ˜¯å¦æœ‰æ•ˆ\n    cout &lt;&lt; op1.value() &lt;&lt; endl; \t\t// è·å–å€¼çš„å¼•ç”¨\n}\n\noptional&lt;int&gt; op2; \t\t\t\t\t\t// åˆå§‹åŒ–æ— æ•ˆå€¼çš„optional\ncout &lt;&lt; op2.value_or(99) &lt;&lt; endl; \t\t// æ— æ•ˆï¼Œè¿”å›ç»™å®šçš„æ›¿ä»£å€¼\n</code></pre><p>ä¸è¿‡å¦ä¸€æ–¹é¢ï¼Œoptionalè¡Œä¸ºè¡¨ç°çš„åˆå¾ˆåƒæŒ‡é’ˆï¼Œå¯ä»¥ç”¨*/-&gt;æ¥ç›´æ¥è®¿é—®å†…éƒ¨çš„å€¼ï¼Œä¹Ÿèƒ½å¤Ÿæ˜¾å¼ï¼ˆexplicitï¼‰è½¬æ¢ä¸ºboolå€¼ï¼Œæˆ–è€…ç”¨reset()æ¸…ç©ºå†…å®¹ï¼Œç”¨èµ·æ¥éå¸¸åƒæˆ‘ä»¬ä¹‹å‰è®²è¿‡çš„æ™ºèƒ½æŒ‡é’ˆunique_ptrï¼š</p><pre><code>optional&lt;string&gt; op {&quot;zelda&quot;};\t\t\t// æŒæœ‰stringçš„optionalå¯¹è±¡\nassert(op); \t\t\t\t\t\t\t// å¯ä»¥åƒæŒ‡é’ˆä¸€æ ·boolåˆ¤æ–­\nassert(!op-&gt;empty() &amp;&amp; *op == &quot;zelda&quot;);\t// ä½¿ç”¨*/-&gt;è®¿é—®å†…éƒ¨çš„å€¼\n\nop.reset();\t\t\t\t\t\t\t\t// æ¸…ç©ºå†…éƒ¨çš„å€¼\nassert(!op); \t\t\t\t\t\t\t// æ­¤æ—¶æ˜¯æ— æ•ˆå€¼\n</code></pre><p>åŒæ ·çš„ï¼Œoptionalä¹Ÿå¯ä»¥ç”¨å·¥å‚å‡½æ•°make_optional()æ¥åˆ›å»ºï¼Œä¸è¿‡ä¸ç›´æ¥æ„é€ ä¸åŒï¼Œå³ä½¿ä¸æä¾›åˆå§‹åŒ–å‚æ•°ï¼Œå®ƒä¹Ÿå¿…å®šä¼šç”¨â€œé›¶å€¼â€åˆ›å»ºå‡ºä¸€ä¸ªæœ‰æ•ˆå€¼çš„optionalå¯¹è±¡ï¼Œè¿™ä¸€ç‚¹æˆ‘ä»¬åœ¨ç”¨çš„æ—¶å€™è¦ç‰¹åˆ«æ³¨æ„ï¼Œä¾‹å¦‚ï¼š</p><pre><code>auto op1 = make_optional&lt;int&gt;();\t\t// ä½¿ç”¨é»˜è®¤å€¼æ„é€ æœ‰æ•ˆå€¼\nauto op2 = make_optional&lt;string&gt;();\t\t// ä½¿ç”¨é»˜è®¤å€¼æ„é€ æœ‰æ•ˆå€¼\n\nassert(op1 &amp;&amp; op2); \t\t\t\t\t// make_optionalæ€»æ˜¯æœ‰æ•ˆçš„\nassert(op1 == 0); \t\t\t\t\t\t// å€¼æ˜¯é»˜è®¤çš„0\nassert(op2-&gt;empty());\t\t\t\t\t// å€¼æ˜¯ç©ºå­—ç¬¦ä¸²\n\nauto op3 = make_optional&lt;string&gt;(&quot;hi&quot;);\t\t\t// å¸¦å‚æ•°åˆ›å»ºoptional\nauto op4 = make_optional&lt;vector&lt;int&gt;&gt;({1,2,3});\t// å¸¦å‚æ•°åˆ›å»ºoptional\n\nassert(op3-&gt;size() == 2);\nassert(op4-&gt;at(0) == 1);\n</code></pre><p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬æœ‰äº†optionalï¼Œå½“å‡½æ•°éœ€è¦è¿”å›å¯èƒ½æ— æ•ˆçš„å€¼çš„æ—¶å€™å°±ç®€å•äº†ï¼Œåªéœ€è¦æŠŠå‡½æ•°çš„è¿”å›å€¼ç”¨optionalåŒ…è£…ä¸€ä¸‹å°±å¯ä»¥ï¼Œæ¯”å¦‚ä¹‹å‰è¯´åˆ°çš„å®æ•°æ±‚å¹³æ–¹æ ¹ï¼š</p><pre><code>auto safe_sqrt = [](double x) {\t\t\t// lambdaè¡¨è¾¾å¼å¼€å¹³æ–¹\n    optional&lt;double&gt; v; \t\t\t\t// é»˜è®¤æ˜¯æ— æ•ˆå€¼\n\n    if (x &lt; 0) {\t\t\t\t\t\t// è´Ÿæ•°æ— æ³•æ±‚å¹³æ–¹æ ¹\n        return v; \t\t\t\t\t\t// è¿”å›æ— æ•ˆå€¼\n    }\n\n    v  = ::sqrt(x); \t\t\t\t\t// æ­£æ•°å¹³æ–¹æ ¹æœ‰æ•ˆ\n    return v; \t\t\t\t\t\t\t// è¿”å›æœ‰æ•ˆå€¼\n};\n\nassert(!safe_sqrt(-1)); \t\t\t\t// è´Ÿæ•°æ— æ³•æ±‚å¹³æ–¹æ ¹\nassert(safe_sqrt(9).value() == 3); \t\t// æ­£æ•°å¹³æ–¹æ ¹æœ‰æ•ˆ\n</code></pre><p>å…³äºoptionalæœ€åæˆ‘ä»¬è¦æ³¨æ„çš„æ˜¯ï¼Œå½“å®ƒå†…éƒ¨æŒæœ‰çš„æ˜¯boolç±»å‹çš„æ—¶å€™ï¼Œç”±äºå®ƒæœ¬èº«å¯ä»¥è½¬å‹æˆboolï¼Œä½†å«ä¹‰æ˜¯å€¼çš„æœ‰æ•ˆæ€§ï¼Œè€Œå¹¶éå†…éƒ¨çš„boolçœŸå‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å†™ä»£ç çš„æ—¶å€™å°±å¿…é¡»åˆ¤æ–­ä¸¤æ¬¡ï¼Œä¸ç•™æ„çš„è¯å¾ˆå®¹æ˜“è¯¯ç”¨ï¼Œä¾‹å¦‚ï¼š</p><pre><code>optional&lt;bool&gt; op {false}; \t\t\t\t// æŒæœ‰boolçš„optionalå¯¹è±¡\n\nif (op) {\t\t\t\t\t\t\t\t// é”™è¯¯ç”¨æ³•ï¼Œå®é™…ä¸Šåˆ¤æ–­çš„æ˜¯æœ‰æ•ˆæ€§\n    cout &lt;&lt; &quot;misuse&quot; &lt;&lt; endl;\n}\n\nif (op &amp;&amp; op.value()) {\t\t\t\t\t// æ­£ç¡®ç”¨æ³•ï¼Œæœ‰æ•ˆåå†æ£€æŸ¥å€¼\n    cout &lt;&lt; &quot; right &quot; &lt;&lt; endl;\n}\n</code></pre><h2>å¯å˜å€¼variant</h2><p>C++é‡Œæœ‰ä¸€ç§ç‰¹æ®Šçš„æ•°æ®ç»“æ„unionï¼Œå®ƒå¯ä»¥æŠŠå¤šç§ä¸åŒçš„ç±»å‹â€œèšåˆâ€åœ¨ä¸€èµ·ï¼Œè¿è¡Œçš„æ—¶å€™èƒ½å¤Ÿéšæ—¶åˆ‡æ¢â€œèº«ä»½â€ï¼Œæœ‰ç‚¹â€œå˜è„¸â€â€œå¤šé‡äººæ ¼â€çš„æ„Ÿè§‰ï¼Œåœ¨åº•å±‚ç³»ç»Ÿçº§ç¼–ç¨‹çš„æ—¶å€™éå¸¸æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼š</p><pre><code>union {\t\t\t\t\t\t\t\t\t// å®šä¹‰ä¸€ä¸ªè”åˆä½“\n    int     n; \t\t\t\t\t\t\t// å¯ä»¥æ˜¯æ•´æ•°æˆ–è€…æµ®ç‚¹æ•°\n    float   f;\n    double  d;\n} x; \t\t\t\t\t\t\t\t\t// å®šä¹‰çš„åŒæ—¶å£°æ˜å˜é‡\n\nx.d = 3.14; \t\t\t\t\t\t\t// åƒç±»æˆå‘˜å˜é‡é‚£æ ·æ“ä½œ\nx.n = 10; \t\t\t\t\t\t\t\t// åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ç§æ•°æ®ç±»å‹\n</code></pre><p>ä¸è¿‡unionçš„åŠŸèƒ½æ¯”è¾ƒå¼±ï¼Œåªèƒ½èšåˆå¹³å‡¡ï¼ˆtrivialï¼Œæˆ–è€…å«POD/Plain Old Dataï¼‰çš„æ•°æ®ç±»å‹ï¼Œé‡åˆ°åƒstring/vectorè¿™æ ·æ¯”è¾ƒå¤æ‚çš„ç±»å‹å°±æ´¾ä¸ä¸Šç”¨åœºã€‚</p><p><strong>åœ¨C++17é‡Œï¼Œæ ‡å‡†å§”å‘˜ä¼šæ–°å¼•å…¥äº†ä¸€ä¸ªæ¨¡æ¿ç±»variantï¼Œå®ƒå¯ä»¥è¯´æ˜¯ä¸€ä¸ªâ€œæ™ºèƒ½unionâ€ï¼Œèƒ½å¤Ÿèšåˆä»»æ„ç±»å‹ï¼Œæ²¡æœ‰ä»»ä½•é™åˆ¶ï¼ŒåŒæ—¶ç”¨èµ·æ¥åˆå’Œunionå‡ ä¹ä¸€æ ·æ–¹ä¾¿ã€‚</strong></p><p>å¦‚æœæˆ‘ä»¬ä»¥å®¹å™¨çš„è§†è§’æ¥çœ‹variantï¼Œå®ƒå°±åƒæ˜¯åªèƒ½å®¹çº³ä¸€ä¸ªå…ƒç´ çš„â€œå¼‚è´¨â€å®¹å™¨ï¼Œé‡Œé¢å­˜æ”¾çš„å…·ä½“ç±»å‹æ˜¯ä¸ç¡®å®šçš„ï¼Œæƒ³çŸ¥é“å½“å‰æ˜¯å“ªç§å…ƒç´ å¿…é¡»è°ƒç”¨æˆå‘˜å‡½æ•°index()ï¼Œå®ƒä¼šè¿”å›å½“å‰å…ƒç´ ç±»å‹åœ¨æ¨¡æ¿å‚æ•°åˆ—è¡¨é‡Œçš„ç´¢å¼•ï¼š</p><pre><code>variant&lt;int, float, double&gt; v; \t\t\t// å¯ä»¥å®¹çº³ä¸‰ç§ä¸åŒçš„æ•´æ•°\n\nv = 42; \t\t\t\t\t\t\t\t// ç›´æ¥èµ‹å€¼ä¸ºint\nassert(v.index() == 0); \t\t\t\t// ç´¢å¼•å·æ˜¯0\n\nv = 3.14f; \t\t\t\t\t\t\t\t// ç›´æ¥èµ‹å€¼ä¸ºfloat\nassert(v.index() == 1); \t\t\t\t// ç´¢å¼•å·æ˜¯1\n\nv = 2.718; \t\t\t\t\t\t\t\t// ç›´æ¥èµ‹å€¼ä¸ºdouble\nassert(v.index() == 2); \t\t\t\t// ç´¢å¼•å·æ˜¯2\n</code></pre><p>ä¸è¿‡å› ä¸ºvariantéœ€è¦å­˜å‚¨ä»»æ„ç±»å‹ï¼Œå†…éƒ¨ç»“æ„æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥variantä¸èƒ½åƒunioné‚£æ ·ç”¨æˆå‘˜å˜é‡çš„å½¢å¼æ¥è®¿é—®å†…éƒ¨çš„å€¼ï¼Œå¿…é¡»è¦ç”¨å¤–éƒ¨çš„å‡½æ•°get()æ¥è·å–å€¼ã€‚get()æ˜¯ä¸€ä¸ªæ¯”è¾ƒç‰¹åˆ«çš„æ¨¡æ¿å‡½æ•°ï¼Œè°ƒç”¨æ—¶å¿…é¡»åœ¨å‡½æ•°åååŠ ä¸Šæ¨¡æ¿çš„å°–æ‹¬å·ï¼Œé‡Œé¢çš„æ¨¡æ¿å‚æ•°å¯ä»¥æ˜¯ç±»å‹åæˆ–è€…æ˜¯ç´¢å¼•å·ã€‚</p><p>å¾ˆæ˜¾ç„¶ï¼Œå› ä¸ºvariantä»»æ„æ—¶åˆ»åªèƒ½æŒæœ‰ä¸€ç§ç±»å‹ï¼Œå¦‚æœç”¨get()è®¿é—®äº†ä¸å­˜åœ¨çš„å€¼å°±ä¼šå‡ºé”™ï¼ŒC++ä¼šä»¥æŠ›å‡ºå¼‚å¸¸çš„æ–¹å¼æ¥å‘ŠçŸ¥è°ƒç”¨è€…ã€‚ä¾‹å¦‚ï¼š</p><pre><code>v = 42; \t\t\t\t\t\t\t// èµ‹å€¼ä¸ºint\nassert(get&lt;0&gt;(v) == 42); \t\t\t// å–ç¬¬0å·çš„å€¼ï¼Œå³int\n\nv = 2.718; \t\t\t\t\t\t\t// èµ‹å€¼ä¸ºdouble\nauto x = get&lt;double&gt;(v); \t\t\t// å–doubleçš„å€¼ï¼Œå³ç¬¬2å·\n\nget&lt;int&gt;(v); \t\t\t\t\t\t// å½“å‰æ˜¯doubleï¼Œæ‰€ä»¥å‡ºé”™ï¼ŒæŠ›å‡ºå¼‚å¸¸\n</code></pre><p>ä¸è¿‡æŠ›å‡ºå¼‚å¸¸çš„æ–¹å¼ä¸å¤ªå‹å¥½ï¼Œtry-catchå¤„ç†èµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¯ä»¥ç”¨å¦ä¸€ä¸ªæ¨¡æ¿å‡½æ•°get_if()ï¼Œå®ƒä»¥æŒ‡é’ˆçš„æ–¹å¼è¿”å›variantå†…éƒ¨çš„å€¼ï¼Œå¦‚æœä¸å­˜åœ¨å°±æ˜¯nullptrï¼Œè¿™æ ·ç”¨èµ·æ¥å°±æ¯”è¾ƒè½»æ¾äº†ï¼š</p><pre><code>auto p = get_if&lt;int&gt;(&amp;v); \t\t\t// å–intçš„å€¼ï¼Œä¸å­˜åœ¨å°±æ˜¯ç©ºæŒ‡é’ˆ\nassert(p == nullptr);\n</code></pre><p>å¦å¤–ï¼ŒC++è¿˜æä¾›äº†ä¸€ä¸ªå…¨å±€å‡½æ•°visit()ï¼Œå®ƒæ˜¯get/get_ifä¹‹å¤–çš„å¦ä¸€ç§æ›´çµæ´»çš„ä½¿ç”¨æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä¸éœ€è¦è€ƒè™‘ç±»å‹çš„ç´¢å¼•å·ï¼Œä»¥ä¸€ä¸ªé›†ä¸­ä¸šåŠ¡é€»è¾‘çš„â€œè®¿é—®å™¨â€å‡½æ•°æ¥ä¸“é—¨å¤„ç†variantå¯¹è±¡ã€‚</p><p>å› ä¸ºvariantæ˜¯â€œå¼‚è´¨â€çš„ï¼Œæ‰€ä»¥è¿™ä¸ªè®¿é—®å™¨å‡½æ•°æœ€å¥½æ˜¯æ³›å‹çš„lambdaè¡¨è¾¾å¼ï¼Œå†™èµ·æ¥æ›´æ–¹ä¾¿ï¼š</p><pre><code>variant&lt;int, string&gt; v; \t\t\t// å¯ä»¥å®¹çº³æ•´æ•°å’Œå­—ç¬¦ä¸²\n\nauto vistor = [](auto&amp; x) {\t\t\t// æ³›å‹çš„lambdaï¼Œä¸ç”¨å†™æ¨¡æ¿å‚æ•°\n    x = x + x; \t\t\t\t\t\t// è¾“å…¥å€¼åŠ å€\n    cout &lt;&lt; x &lt;&lt; endl;\n};\n\nv = 10; \t\t\t\t\t\t\t// èµ‹å€¼ä¸ºint\nstd::visit(vistor, v); \t\t\t\t// è¾“å‡º20\n\nv = &quot;ok&quot;;\t\t\t\t\t\t\t// èµ‹å€¼ä¸ºstring\nstd::visit(vistor, v); \t\t\t\t// è¾“å‡ºokok\n</code></pre><p>æˆ‘ä»¬éœ€è¦ç‰¹åˆ«æ³¨æ„ä¸€ç‚¹ï¼Œåœ¨å®ç°è®¿é—®å™¨å‡½æ•°çš„æ—¶å€™ï¼Œå®ƒå¿…é¡»èƒ½å¤Ÿå¤„ç†variantçš„ä»»ä½•å¯èƒ½ç±»å‹ï¼Œå¦åˆ™å°±æ— æ³•é€šè¿‡C++çš„é™æ€ç¼–è¯‘æ£€æŸ¥ã€‚</p><p>æ¯”å¦‚ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è¿™æ®µç¤ºä¾‹ä»£ç ä¸­æŠŠlambdaçš„èµ‹å€¼è¯­å¥æ”¹æˆâ€œx = x * xâ€ï¼Œé‚£ä¹ˆå®ƒè‚¯å®šæ˜¯æ— æ³•åº”ç”¨äºstringçš„ï¼Œæ‰€ä»¥å°±ä¼šæŠ¥å‡ºä¸€å¤§å †ç¼–è¯‘é”™è¯¯ã€‚</p><p>variantâ€œå¼‚è´¨å®¹å™¨â€çš„ç‰¹æ€§éå¸¸æœ‰ä»·å€¼ï¼Œæˆ‘ä»¬æ·±å…¥æ€è€ƒä¸€ä¸‹å°±ä¼šå‘ç°ï¼Œå®ƒå®Œå…¨å¯ä»¥åœ¨ä¸ä½¿ç”¨â€œç»§æ‰¿â€â€œè™šå‡½æ•°â€çš„æƒ…å†µä¸‹å®ç°é¢å‘å¯¹è±¡ç¼–ç¨‹é‡Œçš„â€œå¤šæ€â€ç‰¹æ€§ï¼Œä¹Ÿå› ä¸ºæ²¡æœ‰äº†è™šè¡¨æŒ‡é’ˆè¿è¡Œæ•ˆç‡ä¼šæ›´é«˜ã€‚</p><h2>å°ç»“</h2><p>å¥½äº†ï¼Œä»Šå¤©æˆ‘ä»¬å­¦ä¹ äº†C++ä¼ ç»Ÿå®¹å™¨ä¹‹å¤–çš„ä¸¤ç§æ–°å‹æ•°æ®ç»“æ„ï¼šoptionalå’Œvariantã€‚å…¶å®å®ƒä»¬å¹¶ä¸æ˜¯å®¹å™¨ï¼Œå› ä¸ºæ²¡æœ‰è¿­ä»£å™¨ä¹Ÿä¸èƒ½åº”ç”¨ç®—æ³•ï¼Œä½†å®ƒä»¬å’Œæ ‡å‡†å®¹å™¨ä¸€æ ·èƒ½å¤Ÿâ€œå®¹çº³å…ƒç´ â€ï¼Œæ‰€ä»¥å¯ä»¥è§†ä¸ºæ˜¯ç‰¹æ®Šçš„å®¹å™¨ã€‚</p><p>ç®€å•å°ç»“ä¸€ä¸‹ä»Šå¤©çš„å†…å®¹ï¼š</p><ol>\n<li>ä¼ ç»Ÿçš„C++åœ¨è¡¨ç¤ºæ— æ•ˆå€¼æ—¶æœ‰å¾ˆå¤šé™åˆ¶ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥å°±å‡ºç°äº†optionalï¼›</li>\n<li>optionalä¸“é—¨ç”¨æ¥è¡¨ç¤ºå€¼æœ‰æ•ˆæˆ–è€…æ— æ•ˆï¼Œç”¨æ³•å¾ˆåƒæ˜¯å•å…ƒç´ å®¹å™¨æˆ–è€…æ™ºèƒ½æŒ‡é’ˆï¼Œæœ€ä½³çš„åº”ç”¨åœºæ™¯æ˜¯å‡½æ•°çš„è¿”å›å€¼ï¼›</li>\n<li>ä¼ ç»ŸC++çš„unionå¯ä»¥å­˜æ”¾å¤šç§ä¸åŒçš„å€¼ï¼Œå¾ˆæœ‰ç”¨ï¼Œä½†å±€é™æ€§å¾ˆå¤§ï¼›</li>\n<li>variantæ˜¯å¯¹unionçš„å¢å¼ºï¼Œå®ƒæ˜¯ä¸€ç§â€œå¼‚è´¨â€å®¹å™¨ï¼Œèƒ½å¤Ÿåœ¨è¿è¡Œæ—¶æ”¹å˜ç±»å‹ï¼Œè¿›è€Œå®ç°æ³›å‹å¤šæ€ã€‚</li>\n</ol><h2>è¯¾ä¸‹ä½œä¸š</h2><p>æŒ‰ç…§æˆ‘ä»¬è¯¾ç¨‹çš„æƒ¯ä¾‹ï¼Œæœ€åä»ç„¶æ˜¯è¯¾ä¸‹ä½œä¸šæ—¶é—´ï¼Œç»™ä½ ç•™ä¸¤ä¸ªæ€è€ƒé¢˜ï¼š</p><ol>\n<li>optionalå¾ˆåƒå®¹å™¨å’Œæ™ºèƒ½æŒ‡é’ˆï¼Œé‚£ä¹ˆä¸å®ƒä»¬çš„åŒºåˆ«åœ¨å“ªé‡Œå‘¢ï¼Ÿ</li>\n<li>è®¿é—®variantå¯¹è±¡å¯ä»¥ä½¿ç”¨get()å’Œvisit()ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°å„è‡ªæœ‰ä»€ä¹ˆä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Ÿ</li>\n</ol><p><img src=\"https://static001.geekbang.org/resource/image/36/a5/361f79e4cb5b4bf548a140edaf9a86a5.png?wh=3624x5300\" alt=\"\"></p>","neighbors":{"left":{"article_title":"è½»æ¾è¯é¢˜ï¼ˆå››ï¼‰ | çœŸæ­£é«˜æ•ˆçš„ç”Ÿæ´»ï¼Œæ˜¯å¼ å¼›æœ‰åº¦","id":248888},"right":{"article_title":"ç½—å‰‘é”‹è€å¸ˆå‡ºæ–°è¯¾äº†ï¼Ÿ","id":525678}},"comments":[{"had_liked":false,"id":320443,"user_name":"åµ‡æ–Œ","can_delete":false,"product_type":"c1","uid":1047812,"ip_address":"","ucode":"C9422C3F8A7B23","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fd/04/89cc31ab.jpg","comment_is_top":false,"comment_ctime":1636334075,"is_pvip":false,"replies":[{"id":"116173","content":"æ˜¯çš„ï¼Œæœ¬æ¥æƒ³å†™anyçš„ï¼Œä½†ç¯‡å¹…å¤ªé•¿äº†ï¼Œåªå¥½ç æ‰ï¼Œæƒ³è¦äº†è§£çš„åŒå­¦å¯ä»¥çœ‹çº¸è´¨ä¹¦ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç½—å‰‘é”‹","uid":"1181974","ctime":1636337044,"ip_address":"","comment_id":320443,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10226268667","product_id":100051801,"comment_content":"è€ç¨‹åºå‘˜å°±æ˜¯é è°±ï¼Œåˆè¡¥äº†ä¸€ç¯‡ã€‚Modern C++çš„å­¦ä¹ è·¯ä¸Šåˆå¤šäº†æœ¬å¥½ä¹¦ã€‚å’Œoptionalå’Œvariantä¸€å¹¶ï¼Œä¸ªäººè§‰å¾—è¿˜æœ‰ä¸ªå¾ˆæœ‰ç”¨çš„å°±æ˜¯std::anyã€‚","like_count":3,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529993,"discussion_content":"æ˜¯çš„ï¼Œæœ¬æ¥æƒ³å†™anyçš„ï¼Œä½†ç¯‡å¹…å¤ªé•¿äº†ï¼Œåªå¥½ç æ‰ï¼Œæƒ³è¦äº†è§£çš„åŒå­¦å¯ä»¥çœ‹çº¸è´¨ä¹¦ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636337044,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1047812,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/fd/04/89cc31ab.jpg","nickname":"åµ‡æ–Œ","note":"","ucode":"C9422C3F8A7B23","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":412974,"discussion_content":"å“ˆå“ˆã€‚è¿™ä¸‹è¿™ä¹¦å¿…é¡»è¦ä¹°äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636349317,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":320075,"user_name":"ä¹ä¸‰","can_delete":false,"product_type":"c1","uid":1454691,"ip_address":"","ucode":"7D093ED7273CBE","user_header":"https://static001.geekbang.org/account/avatar/00/16/32/63/fa24f92e.jpg","comment_is_top":false,"comment_ctime":1636076313,"is_pvip":false,"replies":[{"id":"116078","content":"æŠ±æ­‰å•Šï¼Œç¦»å¼€ä¸€å¹´å¤šäº†ï¼Œæ²¡åŠæ—¶æ›´æ–°çŠ¶æ€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç½—å‰‘é”‹","uid":"1181974","ctime":1636120946,"ip_address":"","comment_id":320075,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10226010905","product_id":100051801,"comment_content":"ç½—è€å¸ˆä¸åœ¨360äº† å•Šã€‚å¥”ç€ç½—è€å¸ˆæ¥äº†360ã€‚æˆ‘è¯´å’‹æ²¡åœ¨æ¨æ¨ä¸Šæœåˆ°æ‚¨ğŸ˜„","like_count":2,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529864,"discussion_content":"æŠ±æ­‰å•Šï¼Œç¦»å¼€ä¸€å¹´å¤šäº†ï¼Œæ²¡åŠæ—¶æ›´æ–°çŠ¶æ€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636120946,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":320026,"user_name":"Stephen","can_delete":false,"product_type":"c1","uid":1165201,"ip_address":"","ucode":"0D49223E6CB7B1","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ7mAt63VrbLZPHpeZxSc4IlBYswQSnaAB5wGePaGFDehgiaNfIxI1SJ5yIHIlmVk8hsw0RaoaSCPA/132","comment_is_top":false,"comment_ctime":1636041233,"is_pvip":false,"replies":[{"id":"116077","content":"thanks","user_name":"ä½œè€…å›å¤","user_name_real":"ç½—å‰‘é”‹","uid":"1181974","ctime":1636120925,"ip_address":"","comment_id":320026,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5931008529","product_id":100051801,"comment_content":"çˆ±äº†çˆ±äº†<br>","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529847,"discussion_content":"thanks","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636120925,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355752,"user_name":"robonix","can_delete":false,"product_type":"c1","uid":1212323,"ip_address":"ä¸Šæµ·","ucode":"866EC82EDA455B","user_header":"https://static001.geekbang.org/account/avatar/00/12/7f/a3/23540579.jpg","comment_is_top":false,"comment_ctime":1661735010,"is_pvip":false,"replies":[{"id":"129473","content":"ç”¨stdè¡¨ç¤ºå¼ºè°ƒå®ƒåœ¨æ ‡å‡†åº“é‡Œï¼Œæ˜¯ä¸€ä¸ªä¹ æƒ¯ï¼Œçœ‹èµ·æ¥æ›´å‹å¥½ä¸€äº›ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1181974","ctime":1661743755,"ip_address":"ä¸Šæµ·","comment_id":355752,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1661735010","product_id":100051801,"comment_content":"è€å¸ˆï¼Œä¸ºå•¥è¦ç”¨std::visitè€Œä¸ç›´æ¥å†™æˆvisit(v)å‘¢","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585643,"discussion_content":"ç”¨stdè¡¨ç¤ºå¼ºè°ƒå®ƒåœ¨æ ‡å‡†åº“é‡Œï¼Œæ˜¯ä¸€ä¸ªä¹ æƒ¯ï¼Œçœ‹èµ·æ¥æ›´å‹å¥½ä¸€äº›ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1661743755,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328158,"user_name":"dyun","can_delete":false,"product_type":"c1","uid":1405074,"ip_address":"","ucode":"D8E3498D0CAD01","user_header":"https://static001.geekbang.org/account/avatar/00/15/70/92/ca05f037.jpg","comment_is_top":false,"comment_ctime":1640577542,"is_pvip":true,"replies":[{"id":"119528","content":"è¿™ä¸ªç›®å‰è¿˜æ²¡æœ‰ç»Ÿä¸€çš„è§£å†³æ–¹æ¡ˆï¼Œæ ‡å‡†å§”å‘˜ä¼šä¹Ÿæ­£åœ¨åŠªåŠ›ï¼Œä½†çŸ­æœŸæ¥çœ‹è¿˜æ˜¯è¦é è‡ªå·±å»æ‰¾ï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1181974","ctime":1640645697,"ip_address":"","comment_id":328158,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1640577542","product_id":100051801,"comment_content":"æ„Ÿè§‰modern c++å’Œå…¶ä»–è¯­è¨€rust JAVA goç›¸æ¯”å¯èƒ½å°±ç¼ºä¸€ä¸ªå¥½ç”¨çš„ä¾èµ–ç®¡ç†å·¥å…·äº†ï¼Œç±»ä¼¼cargo gomodï¼Œä¹Ÿçœ‹åˆ°æœ‰ä¸€äº›ç±»ä¼¼å·¥å…·ï¼Œå¯å®˜æ–¹æ²¡ä¸€ä¸ªç»Ÿä¸€ï¼Œè¿™å—è€å¸ˆæœ‰ä»€ä¹ˆç»éªŒåˆ†äº«ä¹ˆï¼Œæ¯•ç«Ÿæ¯ä¸ªä¾èµ–è‡ªå·±å»æ‰¾ä¹Ÿä»…ä»…æ˜¯ä¸ªä½“åŠ›æ´»","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542035,"discussion_content":"è¿™ä¸ªç›®å‰è¿˜æ²¡æœ‰ç»Ÿä¸€çš„è§£å†³æ–¹æ¡ˆï¼Œæ ‡å‡†å§”å‘˜ä¼šä¹Ÿæ­£åœ¨åŠªåŠ›ï¼Œä½†çŸ­æœŸæ¥çœ‹è¿˜æ˜¯è¦é è‡ªå·±å»æ‰¾ï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640645697,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326199,"user_name":"ç™½èŠ±é£ä¿¡å­","can_delete":false,"product_type":"c1","uid":2850941,"ip_address":"","ucode":"89CA70180EA326","user_header":"https://static001.geekbang.org/account/avatar/00/2b/80/7d/51914d34.jpg","comment_is_top":false,"comment_ctime":1639412210,"is_pvip":false,"replies":[{"id":"118473","content":"å¿…é¡»çš„ï¼Œè®©å¤§å®¶å­¦èµ·æ¥æœ‰åŠ¨åŠ›ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1181974","ctime":1639454475,"ip_address":"","comment_id":326199,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1639412210","product_id":100051801,"comment_content":"è€å¸ˆç•™è¨€çš„å›å¤é¢‘ç‡å¥½é«˜å“‡ï¼Œå‡ ä¹æœ‰é—®å¿…ç­”ï¼ç‚¹èµç‚¹èµç‚¹èµï¼","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538612,"discussion_content":"å¿…é¡»çš„ï¼Œè®©å¤§å®¶å­¦èµ·æ¥æœ‰åŠ¨åŠ›ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639454475,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":320000,"user_name":"lunar","can_delete":false,"product_type":"c1","uid":1197007,"ip_address":"","ucode":"4FC1E388AD98C6","user_header":"https://static001.geekbang.org/account/avatar/00/12/43/cf/118c4ef5.jpg","comment_is_top":false,"comment_ctime":1636032873,"is_pvip":false,"replies":[{"id":"116014","content":"æœ‰æœºä¼šæœ‰æ—¶é—´å°±ä¼šå†™ä¸€ç‚¹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç½—å‰‘é”‹","uid":"1181974","ctime":1636067861,"ip_address":"","comment_id":320000,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1636032873","product_id":100051801,"comment_content":"å¤ªå€¼äº†ï¼Œç«Ÿç„¶è¿˜æœ‰æ›´æ–°ğŸ¤­","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529839,"discussion_content":"æœ‰æœºä¼šæœ‰æ—¶é—´å°±ä¼šå†™ä¸€ç‚¹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636067861,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":319991,"user_name":"Joseph","can_delete":false,"product_type":"c1","uid":1085994,"ip_address":"","ucode":"B031FACEBEE273","user_header":"https://static001.geekbang.org/account/avatar/00/10/92/2a/bae66865.jpg","comment_is_top":false,"comment_ctime":1636029874,"is_pvip":true,"replies":[{"id":"116015","content":"è¿˜æ²¡å¼€å§‹äº†è§£rustï¼Œçœ‹æ¥æ˜¯è‹±é›„æ‰€è§ç•¥åŒã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç½—å‰‘é”‹","uid":"1181974","ctime":1636067904,"ip_address":"","comment_id":319991,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1636029874","product_id":100051801,"comment_content":"C++è¯­è¨€çš„å‘å±•ä¸Rustå¾ˆå¤šå†…åœ¨é€»è¾‘éå¸¸ç›¸ä¼¼ï¼Œè¿™ä¸¤ä¸ªå®¹å™¨ç±»Rustä¸­å¾ˆå®¹æ˜“ä½¿ç”¨ï¼Œæˆ–è€…è¯´å°±æ˜¯å†…åœ¨ç‰¹æ€§ï¼Œè¯´æ˜è¾ƒä½å±‚è¯­è¨€éƒ½ä¼šæœ‰ç›¸ä¼¼çš„æ€è€ƒã€‚","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"ç½—å‰‘é”‹","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529837,"discussion_content":"è¿˜æ²¡å¼€å§‹äº†è§£rustï¼Œçœ‹æ¥æ˜¯è‹±é›„æ‰€è§ç•¥åŒã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636067904,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}