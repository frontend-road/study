{"id":197432,"title":"23ä¸¨MySQLï¼šæ•°æ®åº“çº§ç›‘æ§åŠå¸¸ç”¨è®¡æ•°å™¨è§£æï¼ˆä¸‹ï¼‰","content":"<p>ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è®²äº†æœ‰å…³æ•°æ®åº“çš„å…¨å±€åˆ†æï¼Œé‚£ä¹ˆåœ¨ä»Šå¤©çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ç»§ç»­çœ‹çœ‹åœ¨æ•°æ®åº“ä¸­ï¼Œå¦‚ä½•åšå®šå‘åˆ†æã€‚</p><p>è¿˜è®°å¾—æˆ‘åœ¨ä¸Šç¯‡æ–‡ç« ä¸­æåˆ°çš„å·¥å…·å—ï¼Ÿmysqlreportã€pt-query-digestå’Œmysql_exportor+Prometheus+Grafanaã€‚æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡ä¸­å·²ç»è®²å®Œäº†mysqlreportï¼Œä»Šå¤©æˆ‘ä»¬æ¥çœ‹çœ‹å‰©ä¸‹çš„è¿™å‡ ä¸ªã€‚</p><h2>å®šå‘æŠ“å–SQLï¼špt-query-digest</h2><p><code>pt-query-digest</code>æ˜¯ä¸ªæŒºå¥½çš„å·¥å…·ï¼Œå®ƒå¯ä»¥åˆ†æ<code>slow log</code>ã€<code>general log</code>ã€<code>binary log</code>ï¼Œè¿˜èƒ½åˆ†ætcpdumpæŠ“å–çš„MySQLåè®®æ•°æ®ï¼Œå¯è§è¿™ä¸ªå·¥å…·æœ‰å¤šå¼ºå¤§ã€‚<code>pt-query-digest</code>å±äºPercona-toolå·¥å…·é›†ï¼Œè¿™ä¸ªPerconaå…¬å¸è¿˜å‡ºäº†å¥½å‡ ä¸ªç‰¹åˆ«å¥½ä½¿çš„ç›‘æ§MySQLçš„å·¥å…·ã€‚</p><p><code>pt-query-digest</code>åˆ†æslow logæ—¶äº§ç”Ÿçš„æŠ¥å‘Šé€»è¾‘éå¸¸æ¸…æ™°ï¼Œå¹¶ä¸”æ•°æ®ä¹Ÿæ¯”è¾ƒå®Œæ•´ã€‚æ‰§è¡Œå‘½ä»¤åå°±ä¼šç”Ÿæˆä¸€ä¸ªæŠ¥å‘Šã€‚</p><p>æˆ‘æ¥ç¨å¾®è§£é‡Šä¸€ä¸‹è¿™ä¸ªæŠ¥å‘Šã€‚æˆ‘ä»¬å…ˆçœ‹è¿™ä¸ªæŠ¥å‘Šçš„ç¬¬ä¸€ä¸ªéƒ¨åˆ†ï¼š</p><pre><code># 88.3s user time, 2.5s system time, 18.73M rss, 2.35G vsz\n# Current date: Thu Jun 22 11:30:02 2017\n# Hostname: localhost\n# Files: /Users/Zee/Downloads/log/10.21.0.30/4001/TENCENT64-slow.log.last\n# Overall: 210.18k total, 43 unique, 0.26 QPS, 0.14x concurrency _________\n# Time range: 2017-06-12 21:20:51 to 2017-06-22 09:26:38\n# Attribute          total     min     max     avg     95%  stddev  median\n# ============     ======= ======= ======= ======= ======= ======= =======\n# Exec time        118079s   100ms      9s   562ms      2s   612ms   293ms\n# Lock time            15s       0     7ms    71us   119us    38us    69us\n# Rows sent          1.91M       0  48.42k    9.53   23.65  140.48    2.90\n# Rows examine      13.99G       0   3.76M  69.79k 101.89k  33.28k  68.96k\n# Rows affecte       3.36M       0   1.98M   16.76    0.99   4.90k       0\n# Query size       102.82M       6  10.96k  512.99  719.66  265.43  719.66\n</code></pre><p>ä»ä¸Šè¡¨ä¸­å¯ä»¥çœ‹å¾—å‡ºæ¥ï¼Œåœ¨è¿™ä¸ªæ…¢æ—¥å¿—ä¸­ï¼Œæ€»æ‰§è¡Œæ—¶é—´è¾¾åˆ°äº†118079sï¼Œå¹³å‡æ‰§è¡Œæ—¶é—´ä¸º562msï¼Œæœ€é•¿æ‰§è¡Œæ—¶é—´ä¸º9sï¼Œæ ‡å‡†æ–¹å·®ä¸º612msã€‚</p><!-- [[[read_end]]] --><p>å¯è§åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼ŒSQLæ‰§è¡Œè¿˜æ˜¯æœ‰ç‚¹æ…¢çš„ã€‚</p><p>è¿™æ—¶ä¹Ÿè®¸ä¼šæœ‰äººé—®ï¼ŒSQLæ‰§è¡Œå¤šé•¿æ—¶é—´æ‰æ˜¯æ…¢å‘¢ï¼Ÿä¹‹å‰åœ¨ä¸€ä¸ªé‡‘èæœºæ„ï¼Œæˆ‘è·Ÿä¸€ä¸ªåšæ ¸å¿ƒç³»ç»Ÿçš„å›¢é˜Ÿè®¨è®ºä»–ä»¬çš„SQLæ‰§è¡Œæ—¶é—´æŒ‡æ ‡ã€‚ä»–ä»¬åˆ¤æ–­ä¹‹åè¯´ï¼Œå¸Œæœ›SQLå¹³å‡æ‰§è¡Œæ—¶é—´æŒ‡æ ‡å®šåœ¨500msã€‚æˆ‘è¯´ï¼Œä½ ä»¬è¦500msï¼Œé‚£å‰é¢è¿˜æœ‰ä¸€è¿ä¸²çš„èŠ‚ç‚¹æ‰èƒ½åˆ°è¾¾æœ€ç»ˆçš„ç”¨æˆ·ï¼Œå¦‚æœæ¯ä¸ªç¯èŠ‚éƒ½è¿™æ ·è¦æ±‚è‡ªå·±ï¼Œé‚£æœ€ç»ˆçš„ç”¨æˆ·ä¸å°±æ˜æ˜¾æ„Ÿè§‰åˆ°å¾ˆæ…¢äº†å—ï¼Ÿ</p><p>ç»è¿‡ä¸€è½®è½®çš„è®¨è®ºï¼Œæœ€åå®šåœ¨äº†100msä»¥å†…ã€‚</p><p>å…¶å®ä»æˆ‘çš„ç»éªŒä¸Šæ¥çœ‹ï¼Œå¯¹äºå¤§éƒ¨åˆ†å®æ—¶çš„ä¸šåŠ¡ï¼Œä¸€ä¸ªSQLæ‰§è¡Œçš„å¹³å‡æ—¶é—´æŒ‡æ ‡å®šåœ¨100mséƒ½å¤šäº†ã€‚ä½†æ˜¯å¯¹æ€§èƒ½æ¥è¯´å°±æ˜¯è¿™æ ·ï¼Œåœ¨æ‰€æœ‰çš„ç¯èŠ‚ä¸­éƒ½æ²¡æœ‰å›ºå®šçš„æ ‡å‡†ï¼Œåªæœ‰ç»éªŒæ•°æ®å’Œä¸æ–­æ¼”åŒ–çš„ç³»ç»Ÿæ€§èƒ½èƒ½åŠ›ã€‚</p><p>æˆ‘ä»¬å†æ¥ç€åˆ†æä¸Šé¢çš„æ•°æ®ã€‚å†æ¥çœ‹<code>pt-query-digest</code>ç»™å‡ºçš„è´Ÿè½½æŠ¥è¡¨ï¼š</p><pre><code># Profile\n# Rank Query ID           Response time    Calls  R/Call V/M   Item\n# ==== ================== ================ ====== ====== ===== ===========\n#    1 0x6A516B681113449F 73081.7989 61.9%  76338 0.9573  0.71 UPDATE mb_trans\n#    2 0x90194A5C40980DA7 38014.5008 32.2% 105778 0.3594  0.20 SELECT mb_trans mb_trans_finan\n#    3 0x9B56065EE2D0A5C8  3893.9757  3.3%   9709 0.4011  0.11 UPDATE mb_finan\n# MISC 0xMISC              3088.5453  2.6%  18353 0.1683   0.0 &lt;40 ITEMS&gt;\n</code></pre><p>ä»è¿™ä¸ªè¡¨ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæœ‰ä¸¤ä¸ªSQLçš„æ‰§è¡Œæ—¶é—´å äº†æ€»æ‰§è¡Œæ—¶é—´çš„94%ï¼Œæ˜¾ç„¶è¿™ä¸¤ä¸ªSQLæ˜¯è¦æ¥ä¸‹æ¥è¦åˆ†æçš„é‡ç‚¹ã€‚</p><p>æˆ‘ä»¬å†æ¥ç€çœ‹è¿™ä¸ªå·¥å…·ç»™å‡ºçš„ç¬¬ä¸€ä¸ªSQLçš„æ€§èƒ½æŠ¥è¡¨ï¼š</p><pre><code># Query 1: 0.30 QPS, 0.29x concurrency, ID 0x6A516B681113449F at byte 127303589\n# This item is included in the report because it matches --limit.\n# Scores: V/M = 0.71\n# Time range: 2017-06-16 21:12:05 to 2017-06-19 18:50:59\n# Attribute    pct   total     min     max     avg     95%  stddev  median\n# ============ === ======= ======= ======= ======= ======= ======= =======\n# Count         36   76338\n# Exec time     61  73082s   100ms      5s   957ms      2s   823ms   672ms\n# Lock time     19      3s    20us     7ms    38us    66us    29us    33us\n# Rows sent      0       0       0       0       0       0       0       0\n# Rows examine  36   5.06G   3.82k 108.02k  69.57k 101.89k  22.70k  68.96k\n# Rows affecte   2  74.55k       1       1       1       1       0       1\n# Query size    12  12.36M     161     263  169.75  192.76   11.55  158.58\n# String:\n# Databases    db_bank\n# Hosts        10.21.16.50 (38297/50%)... 1 more\n# Users        user1\n# Query_time distribution\n#   1us\n#  10us\n# 100us\n#   1ms\n#  10ms\n# 100ms  ################################################################\n#    1s  #########################################\n#  10s+\n# Tables\n#    SHOW TABLE STATUS FROM `db_bank` LIKE 'mb_trans'\\G\n#    SHOW CREATE TABLE `db_bank`.`mb_trans`\\G\nUPDATE mb_trans  \n\t\tSET \n\t\tresCode='PCX00000',resultMes='äº¤æ˜“æˆåŠŸ',payTranStatus='P03',payRouteCode='CMA'  \n\t\tWHERE \n\t\tseqNo='20170619PM010394356875'\\G\n# Converted for EXPLAIN\n# EXPLAIN /*!50100 PARTITIONS*/\nselect  \n\t\tresCode='PCX00000',resultMes='äº¤æ˜“æˆåŠŸ',payTranStatus='P03',payRouteCode='CMA' from mb_trans where  \n\t\tseqNo='20170619PM010394356875'\\G\n</code></pre><p>ä»æŸ¥è¯¢æ—¶é—´åˆ†å¸ƒå›¾ä¸Šæ¥çœ‹ï¼Œè¿™ä¸ªè¯­å¥çš„æ‰§è¡Œæ—¶é—´åœ¨100ms~1sä¹‹é—´å±…å¤šï¼Œ95%çš„æ‰§è¡Œæ—¶é—´åœ¨2sä»¥ä¸‹ã€‚é‚£ä¹ˆè¿™ä¸ªSQLå°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦è°ƒä¼˜çš„é‡ç‚¹äº†ã€‚</p><p>ç¬¬äºŒä¸ªSQLæˆ‘å°±ä¸èµ˜è¿°äº†ï¼Œå› ä¸ºé€»è¾‘æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚</p><p>é€šè¿‡å¯¹æ…¢æ—¥å¿—çš„åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå¿«çŸ¥é“å“ªä¸ªSQLæ˜¯æ…¢çš„äº†ã€‚å½“ç„¶ä½ ç”¨<code>mysqldumpslow</code>åˆ†æï¼Œä¹Ÿä¼šå¾—åˆ°ä¸€æ ·çš„ç»“æœã€‚</p><h2>SQLå‰–æï¼šprofiling</h2><p>åœ¨åˆ†ææ•°æ®åº“çš„æ€§èƒ½æ—¶ï¼Œæ˜¾ç„¶å¯¹SQLçš„åˆ†ææ˜¯ç»•ä¸è¿‡å»çš„ä¸€ä¸ªç¯èŠ‚ã€‚ä½†æ˜¯æˆ‘ä¹‹å‰ä¹Ÿè¯´è¿‡äº†ï¼Œä¸Šæ¥å°±å¯¹SQLè¿›è¡Œå…¨é¢å‰–æä¹Ÿæ˜¯ä¸åˆé€»è¾‘çš„ï¼Œå› ä¸ºSQLé‚£ä¹ˆå¤šï¼Œå¦‚æœå¯¹æ¯ä¸ªSQLéƒ½è¿›è¡Œè¯¦ç»†çš„æ‰§è¡Œæ­¥éª¤è§£æï¼Œæ˜¾ç„¶ä¼šæ‹–æ…¢æ•´ä¸ªç³»ç»Ÿï¼Œè€Œä¸”ï¼Œå¯¹ä¸€äº›æ‰§è¡Œå¿«çš„SQLè¿›è¡Œåˆ†æä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¿…è¦ï¼Œå¾’å¢èµ„æºæ¶ˆè€—ã€‚</p><p>é€šè¿‡ä¸Šé¢çš„åˆ†æè¿‡ç¨‹ï¼Œæˆ‘ä»¬å·²ç»å®šä½åˆ°äº†å…·ä½“æ˜¯å“ªä¸ªSQLæ‰§è¡Œå¾—æ…¢ï¼Œé‚£ä¹ˆä¸‹é¢å°±æ˜¯è¦çŸ¥é“SQLçš„æ‰§è¡Œç»†èŠ‚ã€‚æ— è®ºæ˜¯åœ¨Oracleè¿˜æ˜¯åœ¨MySQLä¸­ï¼Œæˆ‘ä»¬éƒ½è¦å»çœ‹æ‰§è¡Œè®¡åˆ’ã€‚</p><p>æ¯”å¦‚è¯´ä¸‹é¢è¿™æ ·çš„ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/0d/e6/0dc186fdc3757e4804030a9e19b5a0e6.png?wh=608*64\" alt=\"\"></p><p>ä¸Šå›¾ä¸­<code>select_type</code>æ˜¯å­å¥ç±»å‹çš„æ„æ€ï¼Œæœ‰ç®€å•æœ‰å¤æ‚ï¼Œä½†æ˜¯å®ƒä¸èƒ½è¯´æ˜ä»€ä¹ˆæˆæœ¬çš„é—®é¢˜ã€‚åœ¨è¿™é‡Œï¼Œæœ€é‡è¦çš„å†…å®¹æ˜¯typeï¼Œå› ä¸ºtypeå¯ä»¥å‘Šè¯‰ä½ è®¿é—®è¿™ä¸ªè¡¨çš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡ä»€ä¹ˆæ ·çš„æ–¹å¼è®¿é—®çš„ã€‚ä¸Šå›¾ä¸­çš„ALLæ˜¯å…¨è¡¨æ‰«æçš„æ„æ€ã€‚typeè¿˜æœ‰å¦‚ä¸‹å‡ ä¸ªå€¼ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/ba/ba/ba8d198f6dc35389a615c8e64b5c6dba.png?wh=2102*1232\" alt=\"\"></p><p>æ‰§è¡Œè®¡åˆ’ä¸­çš„<code>possible_keys</code>ä¼šåˆ—å‡ºå¯èƒ½ä½¿ç”¨åˆ°çš„ç´¢å¼•å€¼ã€‚keyè¿™ä¸€åˆ—ä¼šåˆ—å‡ºæ‰§è¡Œæ—¶ä½¿ç”¨åˆ°çš„ç´¢å¼•å€¼ã€‚</p><p>ä»¥ä¸Šä¿¡æ¯å°±æ˜¯MySQLçš„æ‰§è¡Œè®¡åˆ’ä¸­æ¯”è¾ƒé‡è¦çš„éƒ¨åˆ†äº†ã€‚è¿™äº›ä¿¡æ¯å¯ä»¥å¸®åŠ©æˆ‘ä»¬åšSQLçš„åˆ†æï¼Œä¸ºä¼˜åŒ–æä¾›è¯æ®ã€‚</p><p>é™¤äº†æ‰§è¡Œè®¡åˆ’å¤–ï¼ŒMySQLè¿˜æä¾›äº†<code>profiling</code>ï¼Œè¿™ä¸ªæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿå®ƒå¯ä»¥æŠŠSQLæ‰§è¡Œçš„æ¯ä¸€ä¸ªæ­¥éª¤è¯¦ç»†åˆ—å‡ºæ¥ï¼Œä»ä¸€ä¸ªSQLè¿›å…¥åˆ°æ•°æ®åº“ä¸­ï¼Œåˆ°æ‰§è¡Œå®Œè¿™æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚</p><p>MySQLçš„<code>profiling</code>åœ¨<code>session</code>çº§ç”Ÿæ•ˆï¼Œæ‰€ä»¥å½“ä½ ç”¨äº†æ…¢æ—¥å¿—ï¼ŒçŸ¥é“å“ªä¸ªSQLæœ‰é—®é¢˜ä¹‹åï¼Œå†ç”¨è¿™ä¸ªåŠŸèƒ½æ˜¯æœ€è§æˆæ•ˆçš„ã€‚å¦‚æœæƒ³ä¸€å¼€å§‹å°±æŠŠæ‰€æœ‰<code>session</code>çš„<code>SQL profiling</code>åŠŸèƒ½æ‰“å¼€ï¼Œé‚£æˆæœ¬å°±å¤ªé«˜äº†ã€‚</p><p>ä¸‹é¢æˆ‘æ¥è¯¦ç»†è§£é‡Šä¸€ä¸‹profilingçš„ç”¨æ³•å’ŒåŠŸèƒ½ã€‚</p><h3>profilingæ“ä½œæ­¥éª¤</h3><p>profilingçš„æ“ä½œæ­¥éª¤æ¯”è¾ƒç®€å•ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>æ­¥éª¤ä¸€ ï¼šset profiling=1;  //è¿™ä¸€æ­¥æ˜¯ä¸ºäº†æ‰“å¼€profilingåŠŸèƒ½\næ­¥éª¤äºŒ ï¼šæ‰§è¡Œè¯­å¥           //æ‰§è¡Œä½ ä»æ…¢æ—¥å¿—ä¸­çœ‹åˆ°çš„è¯­å¥\næ­¥éª¤ä¸‰ ï¼šshow profiles;    //è¿™ä¸€æ­¥æ˜¯ä¸ºäº†æŸ¥æ‰¾æ­¥éª¤äºŒä¸­æ‰§è¡Œçš„è¯­å¥çš„ID\næ­¥éª¤å›› ï¼šshow profile all for query id; //è¿™ä¸€æ­¥æ˜¯ä¸ºäº†æ˜¾ç¤ºå‡ºprofilingçš„ç»“æœ\n</code></pre><p>æˆ‘ä»¬å®é™…æ‰§è¡Œä¸€ä¸‹ä¸Šé¢çš„æ­¥éª¤ï¼š</p><pre><code>// æ­¥éª¤ä¸€ï¼šæ‰“å¼€profilingåŠŸèƒ½\nmysql&gt; set profiling=1;\nQuery OK, 0 rows affected, 1 warning (0.00 sec)\n// è¿™ä¸€æ­¥åªæ˜¯ä¸ºäº†ç¡®è®¤ä¸€ä¸‹profilesåˆ—è¡¨æœ‰æ²¡æœ‰å€¼ï¼Œå¯ä»¥ä¸ç”¨æ‰§è¡Œã€‚\nmysql&gt; show profiles;\nEmpty set, 1 warning (0.00 sec)\n// æ­¥éª¤äºŒï¼šæ‰§è¡Œè¯­å¥\nmysql&gt; select * from t_user where user_name='Zee0355916';\n+--------------------------------------+-------------+------------+--------+----------------------+-------------+---------------------+\n| id                                   | user_number | user_name  | org_id | email                | mobile      | create_time         |\n+--------------------------------------+-------------+------------+--------+----------------------+-------------+---------------------+\n| 00000d2d-32a8-11ea-91f8-00163e124cff | 00009496    | Zee0355916 | NULL   | test9495@dunshan.com | 17600009498 | 2020-01-09 14:19:32 |\n| 77bdb1ef-32a6-11ea-91f8-00163e124cff | 00009496    | Zee0355916 | NULL   | test9495@dunshan.com | 17600009498 | 2020-01-09 14:08:34 |\n| d4338339-32a2-11ea-91f8-00163e124cff | 00009496    | Zee0355916 | NULL   | test9495@dunshan.com | 17600009498 | 2020-01-09 13:42:31 |\n+--------------------------------------+-------------+------------+--------+----------------------+-------------+---------------------+\n3 rows in set (14.33 sec)\n// æ­¥éª¤ä¸‰ï¼šæŸ¥çœ‹profilesåˆ—è¡¨ä¸­ï¼Œæœ‰äº†æˆ‘ä»¬åˆšæ‰æ‰§è¡Œçš„è¯­å¥\nmysql&gt; show profiles;\n+----------+-------------+---------------------------------------------------+\n| Query_ID | Duration    | Query                                             |\n+----------+-------------+---------------------------------------------------+\n|        1 | 14.34078475 | select * from t_user where user_name='Zee0355916' |\n+----------+-------------+---------------------------------------------------+\n1 row in set, 1 warning (0.00 sec)\n// æ­¥éª¤å››ï¼šçœ‹è¿™ä¸ªè¯­å¥çš„profileä¿¡æ¯\nmysql&gt; show profile all for query 1;\n+--------------------------------+-----------+----------+------------+-------------------+---------------------+--------------+---------------+---------------+-------------------+-------------------+-------------------+-------+-----------------------+------------------+-------------+\n| Status                         | Duration  | CPU_user | CPU_system | Context_voluntary | Context_involuntary | Block_ops_in | Block_ops_out | Messages_sent | Messages_received | Page_faults_major | Page_faults_minor | Swaps | Source_function       | Source_file      | Source_line |\n+--------------------------------+-----------+----------+------------+-------------------+---------------------+--------------+---------------+---------------+-------------------+-------------------+-------------------+-------+-----------------------+------------------+-------------+\n| starting                       |  0.000024 | 0.000012 |   0.000005 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | NULL                  | NULL             |        NULL |\n| Waiting for query cache lock   |  0.000004 | 0.000003 |   0.000001 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | try_lock              | sql_cache.cc     |         468 |\n| init                           |  0.000003 | 0.000002 |   0.000001 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | try_lock              | sql_cache.cc     |         468 |\n| checking query cache for query |  0.000052 | 0.000036 |   0.000015 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | send_result_to_client | sql_cache.cc     |        1601 |\n| checking permissions           |  0.000007 | 0.000005 |   0.000002 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | check_access          | sql_parse.cc     |        5316 |\n| Opening tables                 |  0.000032 | 0.000023 |   0.000009 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | open_tables           | sql_base.cc      |        5095 |\n| init                           |  0.000042 | 0.000029 |   0.000013 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | mysql_prepare_select  | sql_select.cc    |        1051 |\n| System lock                    |  0.000016 | 0.000011 |   0.000004 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | mysql_lock_tables     | lock.cc          |         304 |\n| Waiting for query cache lock   |  0.000003 | 0.000002 |   0.000001 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | try_lock              | sql_cache.cc     |         468 |\n| System lock                    |  0.000020 | 0.000014 |   0.000006 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | try_lock              | sql_cache.cc     |         468 |\n| optimizing                     |  0.000012 | 0.000009 |   0.000004 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | optimize              | sql_optimizer.cc |         139 |\n| statistics                     |  0.000019 | 0.000013 |   0.000005 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | optimize              | sql_optimizer.cc |         365 |\n| preparing                      |  0.000015 | 0.000010 |   0.000005 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | optimize              | sql_optimizer.cc |         488 |\n| executing                      |  0.000004 | 0.000003 |   0.000001 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | exec                  | sql_executor.cc  |         110 |\n| Sending data                   | 14.324781 | 4.676869 |   0.762349 |              1316 |                 132 |      2499624 |           288 |             0 |                 0 |                 8 |             30862 |     0 | exec                  | sql_executor.cc  |         190 |\n| end                            |  0.000015 | 0.000007 |   0.000002 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | mysql_execute_select  | sql_select.cc    |        1106 |\n| query end                      |  0.000006 | 0.000005 |   0.000001 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | mysql_execute_command | sql_parse.cc     |        5015 |\n| closing tables                 |  0.000016 | 0.000013 |   0.000003 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | mysql_execute_command | sql_parse.cc     |        5063 |\n| freeing items                  |  0.000013 | 0.000010 |   0.000003 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 2 |     0 | mysql_parse           | sql_parse.cc     |        6490 |\n| Waiting for query cache lock   |  0.000003 | 0.000002 |   0.000000 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | try_lock              | sql_cache.cc     |         468 |\n| freeing items                  |  0.000014 | 0.000012 |   0.000003 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | try_lock              | sql_cache.cc     |         468 |\n| Waiting for query cache lock   |  0.000003 | 0.000002 |   0.000000 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | try_lock              | sql_cache.cc     |         468 |\n| freeing items                  |  0.000003 | 0.000002 |   0.000001 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | try_lock              | sql_cache.cc     |         468 |\n| storing result in query cache  |  0.000004 | 0.000002 |   0.000000 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | end_of_result         | sql_cache.cc     |        1034 |\n| logging slow query             |  0.015645 | 0.000084 |   0.000020 |                 2 |                   0 |           16 |             8 |             0 |                 0 |                 0 |                 2 |     0 | log_slow_do           | sql_parse.cc     |        1935 |\n| cleaning up                    |  0.000034 | 0.000024 |   0.000006 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | dispatch_command      | sql_parse.cc     |        1837 |\n+--------------------------------+-----------+----------+------------+-------------------+---------------------+--------------+---------------+---------------+-------------------+-------------------+-------------------+-------+-----------------------+------------------+-------------+\n26 rows in set, 1 warning (0.02 sec)\n</code></pre><p>éå¸¸é•¿ï¼Œä»è¿™æ ·çš„æ•°æ®ä¸­ï¼Œæˆ‘ä»¬å°±çœ‹åˆ°äº†ä¸€ä¸ªè¯­å¥åœ¨æ•°æ®åº“ä¸­ä»å¼€å§‹åˆ°ç»“æŸçš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚</p><p>å¯¹ç”Ÿå‘½å‘¨æœŸä¸­çš„æ¯ä¸ªæ­¥éª¤è¿›è¡Œç»Ÿè®¡ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°æ¯ä¸ªæ­¥éª¤æ‰€æ¶ˆè€—çš„æ—¶é—´ã€‚ä¸ä»…å¦‚æ­¤ï¼Œè¿˜èƒ½çœ‹åˆ°å¦‚ä¸‹è¿™äº›ä¿¡æ¯ï¼š</p><ul>\n<li>BLOCK IO</li>\n<li>Context Switches</li>\n<li>CPU</li>\n<li>IPC</li>\n<li>MEMORY</li>\n<li>Page Fault</li>\n<li>SOURCE</li>\n<li>SWAPS</li>\n</ul><p>æœ‰äº†è¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬åŸºæœ¬ä¸Šå°±å¯ä»¥åˆ¤æ–­è¯­å¥å“ªé‡Œæœ‰é—®é¢˜äº†ã€‚</p><p>ä»ä¸Šé¢è¿™ä¸ªç¤ºä¾‹è¯­å¥ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°<code>Sending data</code>è¿™ä¸€æ­¥æ¶ˆè€—äº†14ç§’çš„æ—¶é—´ï¼Œå¹¶ä¸”ä»åé¢çš„æ•°æ®ä¸­ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°ä¸»åŠ¨ä¸Šä¸‹æ–‡åˆ‡æ¢æœ‰1316æ¬¡ï¼Œè¢«åŠ¨çš„æœ‰132æ¬¡ï¼Œå—æ“ä½œçš„é‡ä¹Ÿéå¸¸å¤§ã€‚</p><p>ç¢°åˆ°è¿™æ ·çš„æƒ…å†µï¼Œæˆ‘ä»¬å°±å¾—å…ˆçŸ¥é“è¿™ä¸ª<code>Sending data</code>åˆ°åº•æ˜¯ä»€ä¹ˆä¸œè¥¿ã€‚ä¸‹é¢æˆ‘ä»¬ç»“åˆä¹‹å‰è¯´çš„åˆ°çš„æ‰§è¡Œè®¡åˆ’ï¼Œä¸€èµ·çœ‹ä¸€ä¸‹ï¼š</p><pre><code>mysql&gt; explain select * from t_user where user_name='Zee0355916';\n+----+-------------+--------+------+---------------+------+---------+------+---------+-------------+\n| id | select_type | table  | type | possible_keys | key  | key_len | ref  | rows    | Extra       |\n+----+-------------+--------+------+---------------+------+---------+------+---------+-------------+\n|  1 | SIMPLE      | t_user | ALL  | NULL          | NULL | NULL    | NULL | 3868195 | Using where |\n+----+-------------+--------+------+---------------+------+---------+------+---------+-------------+\n1 row in set (0.00 sec)\n</code></pre><p>è¿™å°±æ˜¯ä¸ªå…¸å‹çš„å…¨è¡¨æ‰«æï¼Œæ‰€ä»¥ä¸‹ä¸€æ­¥å°±æ˜¯æ£€æŸ¥æœ‰æ²¡æœ‰åˆ›å»ºç´¢å¼•ã€‚</p><pre><code>mysql&gt; show indexes from t_user;\n+--------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+\n| Table  | Non_unique | Key_name | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment |\n+--------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+\n| t_user |          0 | PRIMARY  |            1 | id          | A         |     3868195 |     NULL | NULL   |      | BTREE      |         |               |\n+--------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+\n1 row in set (0.00 sec)\n\n\nmysql&gt;\n</code></pre><p>è¿˜æ˜¯æœ‰ä¸€ä¸ªä¸»é”®ç´¢å¼•çš„ï¼Œä½†ç”±äºæˆ‘ä»¬æ²¡ç”¨ä¸»é”®æ¥æŸ¥ï¼Œæ‰€ä»¥ç”¨ä¸åˆ°ã€‚</p><p>æœ‰äº›æ€§èƒ½æµ‹è¯•å·¥ç¨‹å¸ˆé¢å¯¹è¿™ç§æƒ…å†µå¯èƒ½ä¼šæœ‰è¿™ç§æƒ³æ³•ï¼šç¬¬ä¸€æ¬¡æ²¡æœ‰æŸ¥ç´¢å¼•ï¼Œä½†æ˜¯æŠŠæ‰€æœ‰æ•°æ®éƒ½è°ƒåˆ°ç¼“å­˜é‡Œäº†å‘€ï¼Œæ‰€ä»¥ç¬¬äºŒæ¬¡å°±å¿«äº†å˜›ï¼Œäºæ˜¯æœ‰äº›äººå¯èƒ½æƒ³å°½å¿«â€œå®Œæˆâ€å·¥ä½œï¼Œå°±ç”¨é‡å¤çš„æ•°æ®ã€‚</p><p>è¿™é‡Œæˆ‘å†æ‰§è¡Œä¸€éï¼Œä½ å¯ä»¥çœ‹çœ‹æ˜¯ä»€ä¹ˆç»“æœï¼š</p><pre><code>+----------+-------------+-----------------------------------------------------------+\n| Query_ID | Duration    | Query                                                     |\n+----------+-------------+-----------------------------------------------------------+\n|        1 | 14.34078475 | select * from t_user where user_name='Zee0355916'         |\n|        2 |  0.00006675 | show profile all for 1                                    |\n|        3 |  0.00031700 | explain select * from t_user where user_name='Zee0355916' |\n|        4 |  0.00040025 | show indexes from t_user                                  |\n+----------+-------------+-----------------------------------------------------------+\n6 rows in set, 1 warning (0.00 sec)\n\n\nmysql&gt; select * from t_user where user_name='Zee0355916';\n+--------------------------------------+-------------+------------+--------+----------------------+-------------+---------------------+\n| id                                   | user_number | user_name  | org_id | email                | mobile      | create_time         |\n+--------------------------------------+-------------+------------+--------+----------------------+-------------+---------------------+\n| 00000d2d-32a8-11ea-91f8-00163e124cff | 00009496    | Zee0355916 | NULL   | test9495@dunshan.com | 17600009498 | 2020-01-09 14:19:32 |\n| 77bdb1ef-32a6-11ea-91f8-00163e124cff | 00009496    | Zee0355916 | NULL   | test9495@dunshan.com | 17600009498 | 2020-01-09 14:08:34 |\n| d4338339-32a2-11ea-91f8-00163e124cff | 00009496    | Zee0355916 | NULL   | test9495@dunshan.com | 17600009498 | 2020-01-09 13:42:31 |\n+--------------------------------------+-------------+------------+--------+----------------------+-------------+---------------------+\n3 rows in set (0.00 sec)\n\n\nmysql&gt; show profiles;\n+----------+-------------+-----------------------------------------------------------+\n| Query_ID | Duration    | Query                                                     |\n+----------+-------------+-----------------------------------------------------------+\n|        1 | 14.34078475 | select * from t_user where user_name='Zee0355916'         |\n|        2 |  0.00006675 | show profile all for 1                                    |\n|        3 |  0.00031700 | explain select * from t_user where user_name='Zee0355916' |\n|        4 |  0.00040025 | show indexes from t_user                                  |\n|        5 |  0.00027325 | select * from t_user where user_name='Zee0355916'         |\n+----------+-------------+-----------------------------------------------------------+\n7 rows in set, 1 warning (0.00 sec)\n\n\nmysql&gt; show profile all for query 5;\n+--------------------------------+----------+----------+------------+-------------------+---------------------+--------------+---------------+---------------+-------------------+-------------------+-------------------+-------+-----------------------+--------------+-------------+\n| Status                         | Duration | CPU_user | CPU_system | Context_voluntary | Context_involuntary | Block_ops_in | Block_ops_out | Messages_sent | Messages_received | Page_faults_major | Page_faults_minor | Swaps | Source_function       | Source_file  | Source_line |\n+--------------------------------+----------+----------+------------+-------------------+---------------------+--------------+---------------+---------------+-------------------+-------------------+-------------------+-------+-----------------------+--------------+-------------+\n| starting                       | 0.000029 | 0.000018 |   0.000004 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | NULL                  | NULL         |        NULL |\n| Waiting for query cache lock   | 0.000006 | 0.000003 |   0.000001 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | try_lock              | sql_cache.cc |         468 |\n| init                           | 0.000003 | 0.000003 |   0.000000 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | try_lock              | sql_cache.cc |         468 |\n| checking query cache for query | 0.000008 | 0.000006 |   0.000002 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | send_result_to_client | sql_cache.cc |        1601 |\n| checking privileges on cached  | 0.000003 | 0.000002 |   0.000000 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | send_result_to_client | sql_cache.cc |        1692 |\n| checking permissions           | 0.000010 | 0.000192 |   0.000000 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | check_access          | sql_parse.cc |        5316 |\n| sending cached result to clien | 0.000210 | 0.000028 |   0.000000 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 1 |     0 | send_result_to_client | sql_cache.cc |        1803 |\n| cleaning up                    | 0.000006 | 0.000006 |   0.000000 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | dispatch_command      | sql_parse.cc |        1837 |\n+--------------------------------+----------+----------+------------+-------------------+---------------------+--------------+---------------+---------------+-------------------+-------------------+-------------------+-------+-----------------------+--------------+-------------+\n8 rows in set, 1 warning (0.00 sec)\n\n\nmys\n\n</code></pre><p>çœ‹åˆ°æ²¡æœ‰ï¼Œåœ¨ç”¨é‡å¤æ•°æ®çš„æ—¶å€™ç¡®å®ä¼šè®©å“åº”æ—¶é—´å¿«å¾ˆå¤šï¼Œå› ä¸ºæ•°æ®ç›´æ¥ä»<code>cache</code>ä¸­å‘ç»™<code>client</code>äº†ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™ç§ä½œæ³•è¯·ä½ åšå†³åˆ¶æ­¢ï¼Œå› ä¸ºå®ƒä¸ç¬¦åˆçœŸå®ç”Ÿäº§çš„æ ·å­ã€‚å½“ä½ å†æ¢ä¸€ä¸ªæ•°æ®çš„æ—¶å€™ï¼Œå°±ä¼šæ­‡èœï¼Œè¿˜è¦å†ç»è¿‡14ç§’çš„æ—¶é—´åšå…¨è¡¨æ‰«æã€‚</p><p>æ‰€ä»¥æ­£ç¡®çš„åšæ³•æ˜¯åˆ›å»ºåˆé€‚çš„ç´¢å¼•ï¼Œè®©è¯­å¥åœ¨æ‰§è¡Œä»»ä½•ä¸€æ¡æ•°æ®æ—¶éƒ½èƒ½å¿«èµ·æ¥ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬ç°åœ¨å°±åˆ›å»ºä¸€ä¸ªç´¢å¼•ï¼Œå†çœ‹æ‰§è¡Œç»“æœã€‚</p><pre><code>// åˆ›å»ºç´¢å¼•\nmysql&gt; ALTER TABLE t_user ADD INDEX username_idx (user_name);\nQuery OK, 0 rows affected (44.69 sec)\nRecords: 0  Duplicates: 0  Warnings: 0\n// åˆ†æè¡¨\nmysql&gt; analyze table t_user;\n+-----------+---------+----------+----------+\n| Table     | Op      | Msg_type | Msg_text |\n+-----------+---------+----------+----------+\n| pa.t_user | analyze | status   | OK       |\n+-----------+---------+----------+----------+\n1 row in set (0.08 sec)\n// æ‰§è¡Œè¯­å¥ \nmysql&gt; select * from t_user where user_name='Zee0046948';\n+--------------------------------------+-------------+------------+--------+----------------------+-------------+---------------------+\n| id                                   | user_number | user_name  | org_id | email                | mobile      | create_time         |\n+--------------------------------------+-------------+------------+--------+----------------------+-------------+---------------------+\n| 000061a2-31c2-11ea-8d89-00163e124cff | 00009496    | Zee0046948 | NULL   | test9495@dunshan.com | 17600009498 | 2020-01-08 10:53:08 |\n| 047d7ae1-32a2-11ea-91f8-00163e124cff | 00009496    | Zee0046948 | NULL   | test9495@dunshan.com | 17600009498 | 2020-01-09 13:36:42 |\n| 1abfa543-318f-11ea-8d89-00163e124cff | 00009496    | Zee0046948 | NULL   | test9495@dunshan.com | 17600009498 | 2020-01-08 04:48:48 |\n| 671c4014-3222-11ea-91f8-00163e124cff | 00009496    | Zee0046948 | NULL   | test9495@dunshan.com | 17600009498 | 2020-01-08 22:23:12 |\n| 9de16dd3-32a5-11ea-91f8-00163e124cff | 00009496    | Zee0046948 | NULL   | test9495@dunshan.com | 17600009498 | 2020-01-09 14:02:28 |\n| dd4ab182-32a4-11ea-91f8-00163e124cff | 00009496    | Zee0046948 | NULL   | test9495@dunshan.com | 17600009498 | 2020-01-09 13:57:05 |\n| f507067e-32a6-11ea-91f8-00163e124cff | 00009496    | Zee0046948 | NULL   | test9495@dunshan.com | 17600009498 | 2020-01-09 14:12:04 |\n| f7b82744-3185-11ea-8d89-00163e124cff | 00009496    | Zee0046948 | NULL   | test9495@dunshan.com | 17600009498 | 2020-01-08 03:43:24 |\n+--------------------------------------+-------------+------------+--------+----------------------+-------------+---------------------+\n8 rows in set (0.02 sec)\n// æŸ¥çœ‹Query_ID\nmysql&gt; show profiles;\n+----------+-------------+-----------------------------------------------------------+\n| Query_ID | Duration    | Query                                                     |\n+----------+-------------+-----------------------------------------------------------+\n|        1 | 14.34078475 | select * from t_user where user_name='Zee0355916'         |\n|        2 |  0.00006675 | show profile all for 1                                    |\n|        3 |  0.00031700 | explain select * from t_user where user_name='Zee0355916' |\n|        4 |  0.00005875 | show indexes for table t_user                             |\n|        5 |  0.00005850 | show indexes for t_user                                   |\n|        6 |  0.00040025 | show indexes from t_user                                  |\n|        7 |  0.00027325 | select * from t_user where user_name='Zee0355916'         |\n|        8 |  0.00032100 | explain select * from t_user where user_name='Zee0355916' |\n|        9 | 12.22490550 | select * from t_user where user_name='Zee0046945'         |\n|       10 |  0.00112450 | select * from t_user limit 20                             |\n|       11 | 44.68370500 | ALTER TABLE t_user ADD INDEX username_idx (user_name)     |\n|       12 |  0.07385150 | analyze table t_user                                      |\n|       13 |  0.01516450 | select * from t_user where user_name='Zee0046948'         |\n+----------+-------------+-----------------------------------------------------------+\n13 rows in set, 1 warning (0.00 sec)\n// æŸ¥çœ‹profileä¿¡æ¯\nmysql&gt; show profile all for query 13;\n+--------------------------------+----------+----------+------------+-------------------+---------------------+--------------+---------------+---------------+-------------------+-------------------+-------------------+-------+-----------------------+------------------+-------------+\n| Status                         | Duration | CPU_user | CPU_system | Context_voluntary | Context_involuntary | Block_ops_in | Block_ops_out | Messages_sent | Messages_received | Page_faults_major | Page_faults_minor | Swaps | Source_function       | Source_file      | Source_line |\n+--------------------------------+----------+----------+------------+-------------------+---------------------+--------------+---------------+---------------+-------------------+-------------------+-------------------+-------+-----------------------+------------------+-------------+\n| starting                       | 0.000030 | 0.000017 |   0.000004 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | NULL                  | NULL             |        NULL |\n| Waiting for query cache lock   | 0.000005 | 0.000004 |   0.000001 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | try_lock              | sql_cache.cc     |         468 |\n| init                           | 0.000003 | 0.000002 |   0.000000 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | try_lock              | sql_cache.cc     |         468 |\n| checking query cache for query | 0.000060 | 0.000050 |   0.000011 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | send_result_to_client | sql_cache.cc     |        1601 |\n| checking permissions           | 0.000009 | 0.000007 |   0.000002 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | check_access          | sql_parse.cc     |        5316 |\n| Opening tables                 | 0.000671 | 0.000412 |   0.000000 |                 1 |                   0 |            8 |             0 |             0 |                 0 |                 0 |                 1 |     0 | open_tables           | sql_base.cc      |        5095 |\n| init                           | 0.006018 | 0.000082 |   0.000899 |                 1 |                   0 |         5408 |             0 |             0 |                 0 |                 1 |                 0 |     0 | mysql_prepare_select  | sql_select.cc    |        1051 |\n| System lock                    | 0.000017 | 0.000011 |   0.000003 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | mysql_lock_tables     | lock.cc          |         304 |\n| Waiting for query cache lock   | 0.000003 | 0.000003 |   0.000000 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | try_lock              | sql_cache.cc     |         468 |\n| System lock                    | 0.000019 | 0.000015 |   0.000004 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | try_lock              | sql_cache.cc     |         468 |\n| optimizing                     | 0.000012 | 0.000010 |   0.000002 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | optimize              | sql_optimizer.cc |         139 |\n| statistics                     | 0.001432 | 0.000167 |   0.000037 |                 1 |                   0 |           32 |             0 |             0 |                 0 |                 0 |                 4 |     0 | optimize              | sql_optimizer.cc |         365 |\n| preparing                      | 0.000026 | 0.000043 |   0.000009 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 1 |     0 | optimize              | sql_optimizer.cc |         488 |\n| executing                      | 0.000034 | 0.000005 |   0.000001 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | exec                  | sql_executor.cc  |         110 |\n| Sending data                   | 0.006727 | 0.000439 |   0.001111 |                13 |                   0 |         1536 |             0 |             0 |                 0 |                 0 |                 1 |     0 | exec                  | sql_executor.cc  |         190 |\n| end                            | 0.000014 | 0.000007 |   0.000002 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | mysql_execute_select  | sql_select.cc    |        1106 |\n| query end                      | 0.000009 | 0.000008 |   0.000001 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | mysql_execute_command | sql_parse.cc     |        5015 |\n| closing tables                 | 0.000015 | 0.000012 |   0.000003 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | mysql_execute_command | sql_parse.cc     |        5063 |\n| freeing items                  | 0.000010 | 0.000008 |   0.000002 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | mysql_parse           | sql_parse.cc     |        6490 |\n| Waiting for query cache lock   | 0.000003 | 0.000002 |   0.000000 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | try_lock              | sql_cache.cc     |         468 |\n| freeing items                  | 0.000027 | 0.000022 |   0.000005 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | try_lock              | sql_cache.cc     |         468 |\n| Waiting for query cache lock   | 0.000003 | 0.000002 |   0.000001 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | try_lock              | sql_cache.cc     |         468 |\n| freeing items                  | 0.000003 | 0.000002 |   0.000000 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | try_lock              | sql_cache.cc     |         468 |\n| storing result in query cache  | 0.000004 | 0.000004 |   0.000001 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | end_of_result         | sql_cache.cc     |        1034 |\n| cleaning up                    | 0.000015 | 0.000012 |   0.000003 |                 0 |                   0 |            0 |             0 |             0 |                 0 |                 0 |                 0 |     0 | dispatch_command      | sql_parse.cc     |        1837 |\n+--------------------------------+----------+----------+------------+-------------------+---------------------+--------------+---------------+---------------+-------------------+-------------------+-------------------+-------+-----------------------+------------------+-------------+\n25 rows in set, 1 warning (0.01 sec)\n\n\nmysql&gt;\n</code></pre><p>ä»ä¸Šé¢æœ€åçš„profileä¿¡æ¯ä½ å¯ä»¥çœ‹å‡ºæ¥ï¼Œæ­¥éª¤ä¸€ç‚¹æ²¡å°‘ï¼Œä½†æ˜¯é€Ÿåº¦å¿«äº†å¾ˆå¤šï¼Œè¿™æ‰æ˜¯æ­£ç¡®çš„ä¼˜åŒ–æ€è·¯ã€‚</p><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æè¿°äº†åœ¨ä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œå¦‚ä½•ä»å…¨å±€ç›‘æ§çš„è§’åº¦æŸ¥çœ‹æ•°æ®ï¼Œä»Šå¤©è®²çš„æ˜¯å¦‚ä½•æ‰¾åˆ°å…·ä½“æ…¢çš„SQLï¼Œä»¥åŠå¦‚ä½•å®šä½è¿™ä¸ªSQLçš„é—®é¢˜ã€‚</p><p>å½“ç„¶ä¸æ˜¯æ‰€æœ‰çš„æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯SQLçš„é—®é¢˜ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯é…ç½®çš„é—®é¢˜ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯ç¡¬ä»¶çš„é—®é¢˜ã€‚ä¸ç®¡ä»€ä¹ˆæ ·çš„é—®é¢˜ï¼Œå…¶åˆ†ææ€è·¯éƒ½æ˜¯è¿™æ ·çš„ï¼Œä¹Ÿå°±æ˜¯æˆ‘æ€»æ˜¯åœ¨å¼ºè°ƒçš„ï¼šå…¨å±€ç›‘æ§-å®šå‘ç›‘æ§ã€‚</p><p>å½“ç„¶ï¼Œåœ¨è¿™é‡Œæˆ‘ä¹Ÿåº”è¯¥ç»™å‡ºMySQLåˆ†æå†³ç­–æ ‘çš„æ€è·¯ã€‚ä»<code>mysqlreport</code>çš„åˆ’åˆ†ä¸Šï¼Œç»™å‡ºå‡ ä¸ªå…·ä½“çš„åˆ†æå†³ç­–æ ‘çš„æ ‘æã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/5b/27/5b9c8e2f05ee467ffc834dad86dcb927.png?wh=3867*851\" alt=\"\"></p><p>è¿™æ˜¯å¸¸è§çš„é—®é¢˜ï¼Œå¦‚æœä½ æœ‰å…´è¶£ï¼Œå¯ä»¥è‡ªå·±å®Œå–„è¿™æ£µå®Œæ•´çš„æ ‘ï¼Œå› ä¸ºä½ å¯èƒ½ä¼šæœ‰ä¸ä¸€æ ·çš„åˆ’åˆ†è®¡æ•°å™¨çš„å·¥å…·æˆ–æ€è·¯ï¼Œæ‰€ä»¥è¿™ä¸ªæ ‘æ˜¯å¯ä»¥çµæ´»å˜åŒ–çš„ã€‚</p><p>ä½ ä¸€å®šè¦è®°å¾—ï¼Œåˆ«äººç»™ä½ çš„ä¸œè¥¿ï¼Œæ°¸è¿œå˜ä¸æˆè‡ªå·±çš„ä¸œè¥¿ï¼Œå®ƒä»¬åªèƒ½å¼•å¯¼ä½ ã€‚å¦‚æœä½ è‡ªå·±åŠ¨æ‰‹å»åšä¸€éï¼Œå“ªæ€•åªç”»å‡ºä¸€ä¸ªåˆ†ææ¥ï¼Œéƒ½ä¼šæ˜¯å¾ˆå¤§çš„è¿›æ­¥ã€‚</p><p>å¦‚æœä½ æƒ³ç”¨å…¶ä»–çš„å…¨å±€ç›‘æ§å·¥å…·ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘å¦‚ä¸‹çš„ç»„åˆï¼Œä¹Ÿå°±æ˜¯mysql_exportor+Prometheus+Grafanaã€‚</p><h2>mysql_exportor+Prometheus+Grafana</h2><p>æˆ‘åœ¨å‰é¢ä¹Ÿå±¡æ¬¡æåˆ°è¿‡è¿™ç±»ç»„åˆï¼Œä¸åŒçš„exportorsç»“åˆPrometheus+Grafanaï¼Œå¯ä»¥å®ç°å®æ—¶ç›‘æ§åŠæ•°æ®çš„ä¿å­˜ã€‚</p><p>åœ¨è¿™é‡Œæˆ‘ä»¬çœ‹ä¸€ä¸‹<code>mysql_exportor</code>å¯ä»¥ç»™æˆ‘ä»¬æä¾›ä»€ä¹ˆæ ·çš„ç›‘æ§æ•°æ®ã€‚è¿™é‡Œæˆªå‡ ä¸ªå›¾ï¼Œç»™ä½ å¤§æ¦‚çœ‹ä¸€ä¸‹è¿™ä¸ªå¥—è£…å·¥å…·èƒ½çœ‹ä»€ä¹ˆå†…å®¹ï¼Œæœ‰å…´è¶£çš„è¯ï¼Œä½ ä¹Ÿå¯ä»¥è‡ªå·±æ­å»ºä¸€ä¸‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d9/ac/d96a58c12ab279375d976f27ff17acac.png?wh=1842*892\" alt=\"\"></p><p><img src=\"https://static001.geekbang.org/resource/image/29/a1/292761d3463870e0fe3a0b05a502d6a1.png?wh=1852*765\" alt=\"\"></p><p><img src=\"https://static001.geekbang.org/resource/image/95/73/959feaeacefe12129a9337eee5e1c073.png?wh=1860*768\" alt=\"\"></p><h2>æ€»ç»“</h2><p>æœ‰å…³æ•°æ®åº“çš„çŸ¥è¯†å®åœ¨æ˜¯å¤ªå¤šäº†ï¼Œåœ¨è¿™ä¸¤ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘é‡ç‚¹æƒ³å‘Šè¯‰ä½ çš„ï¼Œå°±æ˜¯åˆ†ææ•°æ®åº“åº”è¯¥å…·æœ‰çš„æ€è·¯ã€‚è‡³äºå…¶ä»–çš„çŸ¥è¯†ç‚¹ï¼Œæˆ‘æƒ³åº”è¯¥æ˜¯ä½ æ‰“å¼€æ–‡ç« ä¹‹å‰å°±åº”è¯¥å‚¨å¤‡çš„ä¸œè¥¿ã€‚</p><p>æˆ‘ä»¬å†æ¥æ€»ç»“ä¸€ä¸‹ï¼Œåœ¨æ•°æ®åº“çš„åˆ†æä¸­ï¼Œæœ€æœ‰å¯èƒ½åœ¨ä¸‰ä¸ªæ–¹é¢å‡ºç°é—®é¢˜ï¼š</p><ol>\n<li>ç¡¬ä»¶é…ç½®</li>\n<li>æ•°æ®åº“é…ç½®</li>\n<li>SQLè¯­å¥</li>\n</ol><p>å¯¹äºç¡¬ä»¶é…ç½®æ¥è¯´ï¼Œæˆ‘ä»¬åªèƒ½åœ¨è§£å†³äº†2å’Œ3çš„é—®é¢˜ä¹‹åï¼Œå†æ¥è¯„ä¼°åˆ°åº•å¤šå°‘ç¡¬ä»¶å¤Ÿç”¨çš„ã€‚è€Œé¢å¯¹æ•°æ®åº“é…ç½®é—®é¢˜ï¼Œè¿™ä¸ªå®åœ¨æ²¡ä»€ä¹ˆå¥½æ‹›ï¼Œåªèƒ½å»äº†è§£æ•°æ®åº“æ¶æ„ç­‰ä¸€ç³»åˆ—çš„çŸ¥è¯†ä¹‹åï¼Œå†å­¦ç€è§£å†³ã€‚è€ŒSQLçš„é—®é¢˜å‘¢ï¼Œåº”è¯¥è¯´æ˜¯æˆ‘ä»¬åœ¨æ€§èƒ½æµ‹è¯•å’Œåˆ†æä¸­æœ€å¸¸è§çš„äº†ã€‚SQLæ€§èƒ½é—®é¢˜çš„åˆ†ææ€è·¯ä¹Ÿæ¯”è¾ƒæ¸…æ™°ï¼Œé‚£å°±æ˜¯åˆ¤æ–­å‡ºå…·ä½“çš„SQLç“¶é¢ˆç‚¹ï¼Œè¿›è€Œåšç›¸åº”çš„ä¼˜åŒ–ï¼Œåˆ‡è®°ä¸è¦è’™ï¼</p><p>ç°åœ¨çš„æ•°æ®åº“ç±»åˆ«æ¯”ä¹‹å‰å¤šå¤ªå¤šäº†ï¼Œæ¯ç§æ•°æ®åº“éƒ½æœ‰è‡ªå·±çš„æ¶æ„å’Œä½¿ç”¨åœºæ™¯ï¼Œæˆ‘ä»¬è¦åœ¨å……åˆ†äº†è§£äº†ä¹‹åï¼Œæ‰èƒ½ä¸‹æ‰‹å»è°ƒã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æˆ‘åœ¨è¿™é‡Œç…§ä¾‹ç•™ä¸¤ä¸ªé—®é¢˜ã€‚ä½ èƒ½è¯´ä¸€ä¸‹æ•°æ®åº“åˆ†æçš„å¤§ä½“æ€è·¯æ˜¯ä»€ä¹ˆå—ï¼Ÿå¦‚ä½•åœ¨æ•°æ®åº“ä¸­è¿…é€Ÿæ‰¾åˆ°ä¸€ä¸ªæ…¢SQLçš„æ ¹æœ¬åŸå› å‘¢ï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨è¯„è®ºåŒºå†™ä¸‹ä½ çš„æ€è€ƒï¼Œä¹Ÿæ¬¢è¿æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–è€…åŒäº‹ï¼Œä¸€èµ·äº¤æµä¸€ä¸‹ã€‚</p>","neighbors":{"left":{"article_title":"22ä¸¨MySQLï¼šæ•°æ®åº“çº§ç›‘æ§åŠå¸¸ç”¨è®¡æ•°å™¨è§£æï¼ˆä¸Šï¼‰","id":196791},"right":{"article_title":"24ä¸¨Kafkaï¼šæ€§èƒ½ç›‘æ§å·¥å…·ä¹‹é˜Ÿåˆ—çº§ç›‘æ§åŠå¸¸ç”¨è®¡æ•°å™¨è§£æ","id":198947}},"comments":[{"had_liked":false,"id":178386,"user_name":"å¼ çº¢å ","can_delete":false,"product_type":"c1","uid":1177173,"ip_address":"","ucode":"D24026D81B5D9C","user_header":"https://static001.geekbang.org/account/avatar/00/11/f6/55/b3ab84a2.jpg","comment_is_top":false,"comment_ctime":1581676067,"is_pvip":false,"replies":[{"id":"69190","content":"å¤šè°¢æ”¯æŒï¼Œåé¢è¦ä¸æˆ‘å†™ç‚¹æ¹¿çš„ã€‚ğŸ˜„","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1581683845,"ip_address":"","comment_id":178386,"utype":1}],"discussion_count":1,"race_medal":0,"score":"48826316323","product_id":100042501,"comment_content":"å¹²è´§å¤ªå¤šäº†ï¼Œè¯¾ç¨‹ä»·æ ¼ä¸¥é‡ä½ä¼°äº†ï¼","like_count":11,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483789,"discussion_content":"å¤šè°¢æ”¯æŒï¼Œåé¢è¦ä¸æˆ‘å†™ç‚¹æ¹¿çš„ã€‚ğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581683845,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":178394,"user_name":"Geek_f93234","can_delete":false,"product_type":"c1","uid":1769504,"ip_address":"","ucode":"1E5DC903A5429E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJGXndj5N66z9BL1ic9GibZzWWgoVeWaWTL2XUnCYic7iba2kAEvN9WfjmlXELD5lqt8IJ1P023N5ZWicg/132","comment_is_top":false,"comment_ctime":1581677859,"is_pvip":false,"replies":[{"id":"69189","content":"æŠ“ä½é‡ç‚¹äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1581683806,"ip_address":"","comment_id":178394,"utype":1}],"discussion_count":1,"race_medal":1,"score":"27351481635","product_id":100042501,"comment_content":"æ•°æ®åº“åˆ†æçš„å¤§ä½“æ€è·¯æ˜¯ä»€ä¹ˆå—ï¼Ÿ<br>å…¨å±€åˆ†æ--å®šå‘åˆ†æ<br>1.å…¨å±€åˆ†æï¼šåˆ†ææ•°æ®åº“ç¡¬ä»¶é…ç½®ï¼Œæ•°æ®åº“é…ç½®ï¼ŒSQLè¯­å¥ï¼Œé‡‡ç”¨å…¨å±€ç›‘æ§å·¥å…·å¦‚mysqlreportå·¥å…·æ”¶é›†åˆ°çš„æµ‹è¯•æ•°æ®ï¼Œåˆ†æå¯èƒ½å­˜åœ¨çš„é—®é¢˜ï¼›<br>2.å®šå‘åˆ†æï¼šå¦‚ï¼šé’ˆæ…¢æŸ¥è¯¢å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ï¼Œé‡‡ç”¨pt-query-digestå·¥å…·åˆ†ææ…¢æŸ¥è¯¢æ—¥å¿—æŠ“å–å­˜åœ¨é—®é¢˜çš„sqlï¼Œåˆ©ç”¨profilingåˆ†æsqlè¯­å¥çš„æ¯ä¸€ä¸ªå±‚çº§ï¼ŒæŸ¥çœ‹sqlæ‰§è¡Œè®¡åˆ’,å¯¹sqlè¿›è¡Œä¼˜åŒ–ã€‚<br><br>å¦‚ä½•åœ¨æ•°æ®åº“ä¸­è¿…é€Ÿæ‰¾åˆ°ä¸€ä¸ªæ…¢ SQL çš„æ ¹æœ¬åŸå› å‘¢ï¼Ÿ<br>profilingåˆ†æsqlè¯­å¥çš„æ¯ä¸€ä¸ªå±‚çº§ï¼Œç»“åˆsqlè¯­å¥æ‰§è¡Œè®¡åˆ’åˆ†ææ…¢sqlæ ¹æœ¬åŸå› ","like_count":6,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483794,"discussion_content":"æŠ“ä½é‡ç‚¹äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581683806,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":282971,"user_name":"å‡¯è€","can_delete":false,"product_type":"c1","uid":1672674,"ip_address":"","ucode":"DF9C2170509BD0","user_header":"https://static001.geekbang.org/account/avatar/00/19/85/e2/540b91fa.jpg","comment_is_top":false,"comment_ctime":1615478880,"is_pvip":false,"replies":[{"id":"103236","content":"è¿˜æœ‰ç¬¬0æ¡ï¼Œå°±æ˜¯æŸ¥çœ‹å…¨å±€ç›‘æ§æ•°æ®ï¼Œåƒmysqlreportè¿™æ ·çš„æ•°æ®ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1616422347,"ip_address":"","comment_id":282971,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10205413472","product_id":100042501,"comment_content":"æ•°æ®åº“æ…¢SQLåˆ†æåŸºæœ¬æ€è·¯ï¼š<br>1.é…ç½®æ…¢sqlæ¡ä»¶ï¼Œå°†æ»¡è¶³æ¡ä»¶çš„sqlå†™å…¥æ…¢æŸ¥è¯¢æ—¥å¿—<br>2.é€šè¿‡explainå·¥å…·è§£æsqlï¼Œåˆ¤æ–­æ˜¯å¦åŠ äº†ç´¢å¼•æˆ–ç´¢å¼•æ˜¯å¦å¤±æ•ˆ<br>3.å¦‚æœæ²¡æœ‰ç´¢å¼•ï¼Œåœ¨æ•°æ®è¡¨æ·»åŠ åˆé€‚çš„ç´¢å¼•ï¼Œå†æ‰§è¡Œsqlï¼Œçœ‹æ‰§è¡Œæ—¶é—´ã€‚<br>4.æ·»åŠ ç´¢å¼•sqlæ‰§è¡Œæ—¶é—´æ²¡æœ‰ä¼˜åŒ–é‚£å°±ä»sqlç¼–å†™é€»è¾‘è¿‡äºå¤æ‚å¯¼è‡´æŸ¥è¯¢è¿‡æ…¢<br>5.å½“ç„¶ç¡¬ä»¶é…ç½®ï¼Œæ•°æ®åº“é…ç½®éƒ½ä¼šå½±å“æ•°æ®åº“sqlçš„æ‰§è¡Œæ—¶é—´","like_count":2,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":516895,"discussion_content":"è¿˜æœ‰ç¬¬0æ¡ï¼Œå°±æ˜¯æŸ¥çœ‹å…¨å±€ç›‘æ§æ•°æ®ï¼Œåƒmysqlreportè¿™æ ·çš„æ•°æ®ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616422347,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":192666,"user_name":"æ‘å¤«","can_delete":false,"product_type":"c1","uid":1434041,"ip_address":"","ucode":"B70D4E421A281B","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erdesQy0moaicYTicoHRQXzbmJm15wohb77qD1OdbuSqPCSUerbcZHzxJJunfmEhTx4kBLxbGaxQ9iag/132","comment_is_top":false,"comment_ctime":1584866826,"is_pvip":false,"replies":[{"id":"73589","content":"æŸ¥è¯¢çš„è¯æœ‰æ•ˆæœã€‚çœ‹åº”ç”¨ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1584879119,"ip_address":"","comment_id":192666,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5879834122","product_id":100042501,"comment_content":"è€å¸ˆï¼Œç½‘ä¸Šéƒ½å»ºè®®Mysqlè¦å…³é—­query cacheï¼Œæˆ‘çœ‹æ‚¨çš„ç¤ºä¾‹æ˜¯å¼€å¯å‘¢ï¼Œæ‰€ä»¥æ‰§è¡ŒåŒä¸€ä¸ªsqlä¼šè¯»ç¼“å­˜ã€‚å¦‚æœå…³é—­äº†ï¼Œå·æ‡’çš„åŠæ³•æ˜¯æ²¡æœ‰ç”¨çš„å§","like_count":1,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488437,"discussion_content":"æŸ¥è¯¢çš„è¯æœ‰æ•ˆæœã€‚çœ‹åº”ç”¨ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584879119,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":186941,"user_name":"æœˆäº®å’Œå…­ä¾¿å£«","can_delete":false,"product_type":"c1","uid":1080894,"ip_address":"","ucode":"EFFCB9171D4B4E","user_header":"https://static001.geekbang.org/account/avatar/00/10/7e/3e/82202cc8.jpg","comment_is_top":false,"comment_ctime":1583977259,"is_pvip":false,"replies":[{"id":"72128","content":"å­¦åˆ°ç²¾é«“äº†ã€‚ğŸ˜€ğŸ˜€","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1583988520,"ip_address":"","comment_id":186941,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5878944555","product_id":100042501,"comment_content":"çœ‹å®Œæ˜¨å¤©å’Œä»Šå¤©çš„ä¸“æ ï¼Œæˆ‘æœ‰ä¸ªæƒ³æ³•ï¼Œä¸ç®¡ä¸‰ä¸ƒäºŒåä¸€ï¼Œä¸€ä¸Šæ¥å…ˆæŠŠæ…¢æ—¥å¿—æ‹å‡ºæ¥ï¼Œåˆ†æï¼Œç„¶åæ‰§è¡Œè®¡åˆ’ï¼Œä¸‰æ¿æ–§è€å®Œäº†ï¼Œç„¶ååœ¨å¼€å§‹å·¥ä½œ......","like_count":1,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486928,"discussion_content":"å­¦åˆ°ç²¾é«“äº†ã€‚ğŸ˜€ğŸ˜€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583988520,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":343264,"user_name":"ç¨‹ç§‘é•¿","can_delete":false,"product_type":"c1","uid":1545790,"ip_address":"","ucode":"45B7BE3F0C043E","user_header":"https://static001.geekbang.org/account/avatar/00/17/96/3e/2295581a.jpg","comment_is_top":false,"comment_ctime":1650733677,"is_pvip":false,"replies":[{"id":"125951","content":"çœ‹èµ·æ¥æ˜¯ç†è§£äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1785562","ctime":1652061062,"ip_address":"","comment_id":343264,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1650733677","product_id":100042501,"comment_content":"é—®é¢˜ä¸€ï¼š<br>å…ˆå…¨å±€ï¼Œåœ¨å®šå‘åˆ†æ<br>é—®é¢˜äºŒï¼š<br>profilingï¼Œå®ƒå¯ä»¥æŠŠ SQL æ‰§è¡Œçš„æ¯ä¸€ä¸ªæ­¥éª¤è¯¦ç»†åˆ—å‡ºæ¥ï¼Œä»ä¸€ä¸ª SQL è¿›å…¥åˆ°æ•°æ®åº“ä¸­ï¼Œåˆ°æ‰§è¡Œå®Œè¿™æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚<br>MySQL çš„profilingåœ¨sessionçº§ç”Ÿæ•ˆï¼Œæ‰€ä»¥å½“ä½ ç”¨äº†æ…¢æ—¥å¿—ï¼ŒçŸ¥é“å“ªä¸ª SQL æœ‰é—®é¢˜ä¹‹åï¼Œå†ç”¨è¿™ä¸ªåŠŸèƒ½æ˜¯æœ€è§æˆæ•ˆçš„ã€‚","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571043,"discussion_content":"çœ‹èµ·æ¥æ˜¯ç†è§£äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652061063,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313632,"user_name":"å­¦ä¹ å­¦ä¸ªå±","can_delete":false,"product_type":"c1","uid":1049017,"ip_address":"","ucode":"DF2D61E6FB2FCE","user_header":"https://static001.geekbang.org/account/avatar/00/10/01/b9/73435279.jpg","comment_is_top":false,"comment_ctime":1632574435,"is_pvip":false,"replies":[{"id":"114818","content":"å¥½åƒæˆ‘æ²¡åœ¨macä¸‹å®‰è£…è¿‡å“¦ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1634690620,"ip_address":"","comment_id":313632,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1632574435","product_id":100042501,"comment_content":"mac å¦‚ä½•å®‰è£… pt-query-digest  æ€»æ˜¯å®‰è£…ä¸æˆåŠŸ","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527418,"discussion_content":"å¥½åƒæˆ‘æ²¡åœ¨macä¸‹å®‰è£…è¿‡å“¦ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634690620,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313631,"user_name":"å­¦ä¹ å­¦ä¸ªå±","can_delete":false,"product_type":"c1","uid":1049017,"ip_address":"","ucode":"DF2D61E6FB2FCE","user_header":"https://static001.geekbang.org/account/avatar/00/10/01/b9/73435279.jpg","comment_is_top":false,"comment_ctime":1632574272,"is_pvip":false,"replies":[{"id":"114820","content":"ç­‰æˆ‘ä»¥åå†™ä¸€ä¸ªä¸“é—¨è®²å·¥å…·çš„ä¸“æ å§ã€‚ğŸ˜Š","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1634690651,"ip_address":"","comment_id":313631,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1632574272","product_id":100042501,"comment_content":"è¿™äº›å·¥å…·æœ‰æ­å»ºæ•™ç¨‹å—è€å¸ˆ","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527417,"discussion_content":"ç­‰æˆ‘ä»¥åå†™ä¸€ä¸ªä¸“é—¨è®²å·¥å…·çš„ä¸“æ å§ã€‚ğŸ˜Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634690651,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":311640,"user_name":"Promise","can_delete":false,"product_type":"c1","uid":1038646,"ip_address":"","ucode":"3E07E270EED2E8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d9/36/92d8eb91.jpg","comment_is_top":false,"comment_ctime":1631356820,"is_pvip":true,"replies":[{"id":"114827","content":"æœ‰ã€‚å¾®ä¿¡ç¾¤é‡Œå‘è¿‡å¾ˆå¤šéã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1634691022,"ip_address":"","comment_id":311640,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1631356820","product_id":100042501,"comment_content":"è€å¸ˆmysql_exportor+Prometheus+Grafanaè¿™ä¸€å¥—æœ‰æ­å»ºæµç¨‹å—","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526691,"discussion_content":"æœ‰ã€‚å¾®ä¿¡ç¾¤é‡Œå‘è¿‡å¾ˆå¤šéã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634691022,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1895690,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKM7ibRxGAUM3oGFCKv8P3ibiaAUXXovQkuic8oYjTfFW1REAU4Fic3P2ChMXD9CRcs4icUwHYtosicbqiciaw/132","nickname":"ayla00","note":"","ucode":"F28770C1A81ECA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554356,"discussion_content":"è€å¸ˆæˆ‘ä¹°äº†ä¸¤å¥—è¯¾ç¨‹ï¼Œæ€ä¹ˆåŠ å…¥å¾®ä¿¡ç¾¤ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646358230,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":231146,"user_name":"LQQ","can_delete":false,"product_type":"c1","uid":1529915,"ip_address":"","ucode":"172A84730ED0A3","user_header":"https://static001.geekbang.org/account/avatar/00/17/58/3b/22dbe7c3.jpg","comment_is_top":false,"comment_ctime":1593593051,"is_pvip":false,"replies":[{"id":"87984","content":"# 100ms ################################################################# 1s #########################################<br>æˆ‘çœ‹çš„æ˜¯è¿™ä¸¤è¡Œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1596077121,"ip_address":"","comment_id":231146,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1593593051","product_id":100042501,"comment_content":"è€å¸ˆï¼Œä¸Šæ–‡ä¸­æåˆ° IDå°¾å·ä¸º449Fçš„sql æ—¥å¿—ï¼Œæ ‡å‡†å·®ä¸º823msï¼Œ95çº¿ä¸º2sï¼Œå¹³å‡å€¼ä¸º957msï¼Œå¦‚æœæ˜¯æ­£æ€åˆ†å¸ƒï¼Œæ ¹æ®æ ‡å‡†å·®çš„å®šä¹‰ï¼Œ68%çš„è¯·æ±‚åº”è¯¥åœ¨100ms~1780msä¹‹é—´ï¼Œæ‚¨è¯´çš„æ˜¯å¤§å¤šæ•°è¯·æ±‚åœ¨100ms~1så†…ï¼Œå¯èƒ½æ˜¯æˆ‘å¤ªè¾ƒçœŸäº†ï¼Œç‰¹æ„ç®—äº†ä¸€ä¸‹^_^","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500175,"discussion_content":"# 100ms ################################################################# 1s #########################################\næˆ‘çœ‹çš„æ˜¯è¿™ä¸¤è¡Œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596077121,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":210495,"user_name":"æœˆäº®å’Œå…­ä¾¿å£«","can_delete":false,"product_type":"c1","uid":1080894,"ip_address":"","ucode":"EFFCB9171D4B4E","user_header":"https://static001.geekbang.org/account/avatar/00/10/7e/3e/82202cc8.jpg","comment_is_top":false,"comment_ctime":1587778485,"is_pvip":false,"replies":[{"id":"82002","content":"æˆ‘è„‘å­é‡Œæœ‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1590754092,"ip_address":"","comment_id":210495,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1587778485","product_id":100042501,"comment_content":"è€å¸ˆï¼Œå“ªå¯ä»¥çœ‹åˆ°MySQL- grafana é‡Œé¢å„ä¸ªæŒ‡æ ‡çš„è¯¦ç»†è§£é‡Šï¼Œç°åœ¨çœ‹åˆ°æŒ‡æ ‡ä¸€è„¸æ‡µé€¼ï¼Œä¸çŸ¥é“å“ªä¸ªæŒ‡æ ‡ä»€ä¹ˆæ„æ€ï¼Œå€¼åˆ°äº†å¤šå°‘ä»£è¡¨æœ‰é—®é¢˜ï¼Œåº”è¯¥æ€ä¹ˆåŠï¼Ÿæ€ä¹ˆç ´è§£","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493034,"discussion_content":"æˆ‘è„‘å­é‡Œæœ‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590754092,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":190266,"user_name":"æ‘å¤«","can_delete":false,"product_type":"c1","uid":1434041,"ip_address":"","ucode":"B70D4E421A281B","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erdesQy0moaicYTicoHRQXzbmJm15wohb77qD1OdbuSqPCSUerbcZHzxJJunfmEhTx4kBLxbGaxQ9iag/132","comment_is_top":false,"comment_ctime":1584624925,"is_pvip":false,"replies":[{"id":"73209","content":"åºŸå¼ƒè¿˜èƒ½çœ‹æ‰§è¡Œè®¡åˆ’ã€‚<br>sqlæ‰§è¡Œå¤šæ¬¡ï¼Œæ­¥éª¤æ˜¯åº”è¯¥å·®ä¸å¤šçš„å‘€ï¼Œæ²¡æ‡‚è¿™ä¸ªé—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1584653189,"ip_address":"","comment_id":190266,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1584624925","product_id":100042501,"comment_content":"è€å¸ˆæˆ‘çœ‹show profileåœ¨5.7ä»¥åå°±è¢«åºŸå¼ƒäº†ï¼Œè¿˜æœ‰å°±æ˜¯æˆ‘åŒä¸€ä¸ªsqlæ‰§è¡Œå¤šæ¬¡ï¼Œé€šè¿‡show prorileæŸ¥çœ‹æ¯æ¬¡queryIdï¼Œæ­¥éª¤å·®ä¸å¤šå‘€ã€‚ä¸çŸ¥é“ä¸ºå•¥å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487930,"discussion_content":"åºŸå¼ƒè¿˜èƒ½çœ‹æ‰§è¡Œè®¡åˆ’ã€‚\nsqlæ‰§è¡Œå¤šæ¬¡ï¼Œæ­¥éª¤æ˜¯åº”è¯¥å·®ä¸å¤šçš„å‘€ï¼Œæ²¡æ‡‚è¿™ä¸ªé—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584653189,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":186132,"user_name":"å°è€é¼ ","can_delete":false,"product_type":"c1","uid":1257460,"ip_address":"","ucode":"C663A0C863A515","user_header":"https://static001.geekbang.org/account/avatar/00/13/2f/f4/2dede51a.jpg","comment_is_top":false,"comment_ctime":1583763692,"is_pvip":false,"replies":[{"id":"71902","content":"è¯·ç†è§£ä¸€ä¸‹æœ¬ä¸“æ ä¸­ä¸€ç›´åœ¨å¼ºè°ƒçš„åˆ†æ®µåˆ†å±‚ä¸­çš„åˆ†å±‚çš„å«ä¹‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1583768920,"ip_address":"","comment_id":186132,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1583763692","product_id":100042501,"comment_content":"å¦‚ä½•ç¡®å®šå¼•èµ·ç³»ç»Ÿæ…¢çš„åŸå› æ˜¯DBï¼Œæ˜¯å¦å¯ä»OSåˆ†æå…¥æ‰‹ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486638,"discussion_content":"è¯·ç†è§£ä¸€ä¸‹æœ¬ä¸“æ ä¸­ä¸€ç›´åœ¨å¼ºè°ƒçš„åˆ†æ®µåˆ†å±‚ä¸­çš„åˆ†å±‚çš„å«ä¹‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583768920,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":182928,"user_name":"Duke","can_delete":false,"product_type":"c1","uid":1786107,"ip_address":"","ucode":"2EE45277C37484","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er3G5DWFp5PEklibQPYE1m8OxtYqTcryibkcUHpP4ibBicf8OUYHB6V1iaSRaNiaFV8cuNFb0xbOUF7mZhQ/132","comment_is_top":false,"comment_ctime":1582892098,"is_pvip":false,"replies":[{"id":"70748","content":"å°å¿ƒå—ä¸ä½å†…åŠ›ã€‚ğŸ˜ƒğŸ˜ƒ","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1582904118,"ip_address":"","comment_id":182928,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1582892098","product_id":100042501,"comment_content":"å¹²æ´»å¤ªå¤šï¼Œæˆ‘å¾—çœ‹çœ‹å¸æ”¶ï¼","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485505,"discussion_content":"å°å¿ƒå—ä¸ä½å†…åŠ›ã€‚ğŸ˜ƒğŸ˜ƒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582904118,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":178204,"user_name":"å¤œç©ºä¸­æœ€äº®çš„æ˜Ÿ","can_delete":false,"product_type":"c1","uid":1267566,"ip_address":"","ucode":"ADC3E7B6789955","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/6e/b6795c44.jpg","comment_is_top":false,"comment_ctime":1581607542,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581607542","product_id":100042501,"comment_content":"å¥½å¥½åœ¨å®¶å‘†ç€å­¦ä¹  é‚£ä¹Ÿä¸å»","like_count":0}]}