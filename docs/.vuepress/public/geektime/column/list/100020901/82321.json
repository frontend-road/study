{"id":82321,"title":"38 | 案例篇：怎么使用 tcpdump 和 Wireshark 分析网络流量？","content":"<p>你好，我是倪朋飞。</p><p>上一节，我们学习了 DNS 性能问题的分析和优化方法。简单回顾一下，DNS 可以提供域名和 IP 地址的映射关系，也是一种常用的全局负载均衡（GSLB）实现方法。</p><p>通常，需要暴露到公网的服务，都会绑定一个域名，既方便了人们记忆，也避免了后台服务 IP 地址的变更影响到用户。</p><p>不过要注意，DNS 解析受到各种网络状况的影响，性能可能不稳定。比如公网延迟增大，缓存过期导致要重新去上游服务器请求，或者流量高峰时 DNS 服务器性能不足等，都会导致 DNS 响应的延迟增大。</p><p>此时，可以借助 nslookup 或者 dig 的调试功能，分析 DNS 的解析过程，再配合 ping 等工具调试 DNS 服务器的延迟，从而定位出性能瓶颈。通常，你可以用缓存、预取、HTTPDNS 等方法，优化 DNS 的性能。</p><p>上一节我们用到的ping，是一个最常用的测试服务延迟的工具。很多情况下，ping 可以帮我们定位出延迟问题，不过有时候， ping 本身也会出现意想不到的问题。这时，就需要我们抓取ping 命令执行时收发的网络包，然后分析这些网络包，进而找出问题根源。</p><p>tcpdump 和 Wireshark 就是最常用的网络抓包和分析工具，更是分析网络性能必不可少的利器。</p><!-- [[[read_end]]] --><ul>\n<li>\n<p>tcpdump 仅支持命令行格式使用，常用在服务器中抓取和分析网络包。</p>\n</li>\n<li>\n<p>Wireshark 除了可以抓包外，还提供了强大的图形界面和汇总分析工具，在分析复杂的网络情景时，尤为简单和实用。</p>\n</li>\n</ul><p>因而，在实际分析网络性能时，先用 tcpdump 抓包，后用 Wireshark 分析，也是一种常用的方法。</p><p>今天，我就带你一起看看，怎么使用 tcpdump 和 Wireshark ，来分析网络的性能问题。</p><h2>案例准备</h2><p>本次案例还是基于 Ubuntu 18.04，同样适用于其他的 Linux 系统。我使用的案例环境是这样的：</p><ul>\n<li>\n<p>机器配置：2 CPU，8GB 内存。</p>\n</li>\n<li>\n<p>预先安装 tcpdump、Wireshark 等工具，如：</p>\n</li>\n</ul><pre><code># Ubuntu\napt-get install tcpdump wireshark\n\n# CentOS\nyum install -y tcpdump wireshark\n</code></pre><p>由于 Wireshark 的图形界面，并不能通过 SSH 使用，所以我推荐你在本地机器（比如 Windows）中安装。你可以到 <a href=\"https://www.wireshark.org/\">https://www.wireshark.org/</a> 下载并安装 Wireshark。</p><blockquote>\n<p>跟以前一样，案例中所有命令，都默认以 root 用户（在Windows中，运行Wireshark时除外）运行。如果你是用普通用户身份登陆系统，请运行 sudo su root 命令切换到 root 用户。</p>\n</blockquote><h2>再探 ping</h2><p>前面讲过，ping 是一种最常用的网络工具，常用来探测网络主机之间的连通性以及延迟。关于 ping 的原理和使用方法，我在前面的 <a href=\"https://time.geekbang.org/column/article/81057\">Linux网络基础篇</a>  已经简单介绍过，而 DNS 缓慢的案例中，也多次用到了 ping 测试 DNS 服务器的延迟（RTT）。</p><p>不过，虽然 ping 比较简单，但有时候你会发现，ping 工具本身也可能出现异常，比如运行缓慢，但实际网络延迟却并不大的情况。</p><p>接下来，我们打开一个终端，SSH 登录到案例机器中，执行下面的命令，来测试案例机器与极客邦科技官网的连通性和延迟。如果一切正常，你会看到下面这个输出：</p><pre><code># ping 3 次（默认每次发送间隔1秒）\n# 假设DNS服务器还是上一期配置的114.114.114.114\n$ ping -c3 geektime.org\nPING geektime.org (35.190.27.188) 56(84) bytes of data.\n64 bytes from 35.190.27.188 (35.190.27.188): icmp_seq=1 ttl=43 time=36.8 ms\n64 bytes from 35.190.27.188 (35.190.27.188): icmp_seq=2 ttl=43 time=31.1 ms\n64 bytes from 35.190.27.188 (35.190.27.188): icmp_seq=3 ttl=43 time=31.2 ms\n\n--- geektime.org ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 11049ms\nrtt min/avg/max/mdev = 31.146/33.074/36.809/2.649 ms\n</code></pre><p>ping 的输出界面，  <a href=\"https://time.geekbang.org/column/article/81057\">Linux网络基础篇</a> 中我们已经学过，你可以先复习一下，自己解读并且分析这次的输出。</p><p>不过要注意，假如你运行时发现 ping 很快就结束了，那就执行下面的命令，再重试一下。至于这条命令的含义，稍后我们再做解释。</p><pre><code># 禁止接收从DNS服务器发送过来并包含googleusercontent的包\n$ iptables -I INPUT -p udp --sport 53 -m string --string googleusercontent --algo bm -j DROP\n</code></pre><p>根据 ping 的输出，你可以发现，geektime.org 解析后的 IP 地址是 35.190.27.188，而后三次 ping 请求都得到了响应，延迟（RTT）都是 30ms 多一点。</p><p>但汇总的地方，就有点儿意思了。3次发送，收到3次响应，没有丢包，但三次发送和接受的总时间居然超过了 11s（11049ms），这就有些不可思议了吧。</p><p>会想起上一节的 DNS 解析问题，你可能会怀疑，这可能是 DNS 解析缓慢的问题。但到底是不是呢？</p><p>再回去看 ping 的输出，三次 ping 请求中，用的都是 IP 地址，说明 ping 只需要在最开始运行时，解析一次得到 IP，后面就可以只用 IP了。</p><p>我们再用 nslookup 试试。在终端中执行下面的 nslookup 命令，注意，这次我们同样加了 time 命令，输出 nslookup 的执行时间：</p><pre><code>$ time nslookup geektime.org\nServer:\t\t114.114.114.114\nAddress:\t114.114.114.114#53\n\nNon-authoritative answer:\nName:\tgeektime.org\nAddress: 35.190.27.188\n\n\nreal\t0m0.044s\nuser\t0m0.006s\nsys\t0m0.003s\n</code></pre><p>可以看到，域名解析还是很快的，只需要 44ms，显然比 11s 短了很多。</p><p>到这里，再往后该怎么分析呢？其实，这时候就可以用 tcpdump 抓包，查看 ping 在收发哪些网络包。</p><p>我们再打开另一个终端（终端二），SSH 登录案例机器后，执行下面的命令：</p><pre><code>$ tcpdump -nn udp port 53 or host 35.190.27.188\n</code></pre><p>当然，你可以直接用 tcpdump 不加任何参数来抓包，但那样的话，就可能抓取到很多不相干的包。由于我们已经执行过 ping 命令，知道了 geekbang.org 的 IP 地址是35.190.27.188，也知道 ping 命令会执行 DNS 查询。所以，上面这条命令，就是基于这个规则进行过滤。</p><p>我来具体解释一下这条命令。</p><ul>\n<li>\n<p>-nn ，表示不解析抓包中的域名（即不反向解析）、协议以及端口号。</p>\n</li>\n<li>\n<p>udp port 53 ，表示只显示 UDP协议的端口号（包括源端口和目的端口）为53的包。</p>\n</li>\n<li>\n<p>host 35.190.27.188 ，表示只显示 IP 地址（包括源地址和目的地址）为35.190.27.188的包。</p>\n</li>\n<li>\n<p>这两个过滤条件中间的“ or ”，表示或的关系，也就是说，只要满足上面两个条件中的任一个，就可以展示出来。</p>\n</li>\n</ul><p>接下来，回到终端一，执行相同的 ping 命令：</p><pre><code>$ ping -c3 geektime.org\n...\n--- geektime.org ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 11095ms\nrtt min/avg/max/mdev = 81.473/81.572/81.757/0.130 ms\n</code></pre><p>命令结束后，再回到终端二中，查看 tcpdump 的输出：</p><pre><code>tcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on eth0, link-type EN10MB (Ethernet), capture size 262144 bytes\n14:02:31.100564 IP 172.16.3.4.56669 &gt; 114.114.114.114.53: 36909+ A? geektime.org. (30)\n14:02:31.507699 IP 114.114.114.114.53 &gt; 172.16.3.4.56669: 36909 1/0/0 A 35.190.27.188 (46)\n14:02:31.508164 IP 172.16.3.4 &gt; 35.190.27.188: ICMP echo request, id 4356, seq 1, length 64\n14:02:31.539667 IP 35.190.27.188 &gt; 172.16.3.4: ICMP echo reply, id 4356, seq 1, length 64\n14:02:31.539995 IP 172.16.3.4.60254 &gt; 114.114.114.114.53: 49932+ PTR? 188.27.190.35.in-addr.arpa. (44)\n14:02:36.545104 IP 172.16.3.4.60254 &gt; 114.114.114.114.53: 49932+ PTR? 188.27.190.35.in-addr.arpa. (44)\n14:02:41.551284 IP 172.16.3.4 &gt; 35.190.27.188: ICMP echo request, id 4356, seq 2, length 64\n14:02:41.582363 IP 35.190.27.188 &gt; 172.16.3.4: ICMP echo reply, id 4356, seq 2, length 64\n14:02:42.552506 IP 172.16.3.4 &gt; 35.190.27.188: ICMP echo request, id 4356, seq 3, length 64\n14:02:42.583646 IP 35.190.27.188 &gt; 172.16.3.4: ICMP echo reply, id 4356, seq 3, length 64\n</code></pre><p>这次输出中，前两行，表示 tcpdump 的选项以及接口的基本信息；从第三行开始，就是抓取到的网络包的输出。这些输出的格式，都是 <code>时间戳 协议 源地址.源端口 &gt; 目的地址.目的端口 网络包详细信息</code>（这是最基本的格式，可以通过选项增加其他字段）。</p><p>前面的字段，都比较好理解。但网络包的详细信息，本身根据协议的不同而不同。所以，要理解这些网络包的详细含义，就要对常用网络协议的基本格式以及交互原理，有基本的了解。</p><p>当然，实际上，这些内容都会记录在 IETF（ 互联网工程任务组）发布的 <a href=\"https://tools.ietf.org/rfc/index\">RFC</a>（请求意见稿）中。</p><p>比如，第一条就表示，从本地 IP 发送到 114.114.114.114 的 A 记录查询请求，它的报文格式记录在 RFC1035 中，你可以点击<a href=\"https://www.ietf.org/rfc/rfc1035.txt\">这里</a>查看。在这个 tcpdump 的输出中，</p><ul>\n<li>\n<p>36909+ 表示查询标识值，它也会出现在响应中，加号表示启用递归查询。</p>\n</li>\n<li>\n<p>A? 表示查询 A 记录。</p>\n</li>\n<li>\n<p>geektime.org. 表示待查询的域名。</p>\n</li>\n<li>\n<p>30 表示报文长度。</p>\n</li>\n</ul><p>接下来的一条，则是从 114.114.114.114 发送回来的 DNS 响应——域名 geektime.org. 的 A 记录值为 35.190.27.188。</p><p>第三条和第四条，是 ICMP echo request 和 ICMP echo reply，响应包的时间戳 14:02:31.539667，减去请求包的时间戳 14:02:31.508164 ，就可以得到，这次 ICMP 所用时间为 30ms。这看起来并没有问题。</p><p>但随后的两条反向地址解析 PTR 请求，就比较可疑了。因为我们只看到了请求包，却没有应答包。仔细观察它们的时间，你会发现，这两条记录都是发出后 5s 才出现下一个网络包，两条 PTR 记录就消耗了 10s。</p><p>再往下看，最后的四个包，则是两次正常的 ICMP 请求和响应，根据时间戳计算其延迟，也是 30ms。</p><p>到这里，其实我们也就找到了 ping 缓慢的根源，正是两次 PTR 请求没有得到响应而超时导致的。PTR 反向地址解析的目的，是从 IP 地址反查出域名，但事实上，并非所有IP 地址都会定义 PTR 记录，所以 PTR 查询很可能会失败。</p><p>所以，在你使用 ping 时，如果发现结果中的延迟并不大，而 ping 命令本身却很慢，不要慌，有可能是背后的 PTR 在搞鬼。</p><p>知道问题后，解决起来就比较简单了，只要禁止 PTR 就可以。还是老路子，执行 man ping 命令，查询使用手册，就可以找出相应的方法，即加上 -n 选项禁止名称解析。比如，我们可以在终端中执行如下命令：</p><pre><code>$ ping -n -c3 geektime.org\nPING geektime.org (35.190.27.188) 56(84) bytes of data.\n64 bytes from 35.190.27.188: icmp_seq=1 ttl=43 time=33.5 ms\n64 bytes from 35.190.27.188: icmp_seq=2 ttl=43 time=39.0 ms\n64 bytes from 35.190.27.188: icmp_seq=3 ttl=43 time=32.8 ms\n\n--- geektime.org ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2002ms\nrtt min/avg/max/mdev = 32.879/35.160/39.030/2.755 ms\n</code></pre><p>你可以发现，现在只需要 2s 就可以结束，比刚才的 11s 可是快多了。</p><p>到这里， 我就带你一起使用 tcpdump ，解决了一个最常见的 ping 工作缓慢的问题。</p><p>案例最后，如果你在开始时，执行了 iptables 命令，那也不要忘了删掉它：</p><pre><code>$ iptables -D INPUT -p udp --sport 53 -m string --string googleusercontent --algo bm -j DROP\n</code></pre><p>不过，删除后你肯定还有疑问，明明我们的案例跟 Google 没啥关系，为什么要根据 googleusercontent ，这个毫不相关的字符串来过滤包呢？</p><p>实际上，如果换一个 DNS 服务器，就可以用 PTR 反查到 35.190.27.188 所对应的域名：</p><pre><code> $ nslookup -type=PTR 35.190.27.188 8.8.8.8\nServer:\t8.8.8.8\nAddress:\t8.8.8.8#53\nNon-authoritative answer:\n188.27.190.35.in-addr.arpa\tname = 188.27.190.35.bc.googleusercontent.com.\nAuthoritative answers can be found from:\n</code></pre><p>你看，虽然查到了 PTR 记录，但结果并非 geekbang.org，而是 188.27.190.35.bc.googleusercontent.com。其实，这也是为什么，案例开始时将包含 googleusercontent 的丢弃后，ping 就慢了。因为 iptables ，实际上是把 PTR 响应给丢了，所以会导致 PTR 请求超时。</p><p>tcpdump 可以说是网络性能分析最有效的利器。接下来，我再带你一起看看 tcpdump 的更多使用方法。</p><h2>tcpdump</h2><p>我们知道，tcpdump 也是最常用的一个网络分析工具。它基于 <a href=\"https://www.tcpdump.org/\">libpcap</a>  ，利用内核中的 AF_PACKET 套接字，抓取网络接口中传输的网络包；并提供了强大的过滤规则，帮你从大量的网络包中，挑出最想关注的信息。</p><p>tcpdump 为你展示了每个网络包的详细细节，这就要求，在使用前，你必须要对网络协议有基本了解。而要了解网络协议的详细设计和实现细节， <a href=\"https://www.rfc-editor.org/rfc-index.html\">RFC</a> 当然是最权威的资料。</p><p>不过，RFC 的内容，对初学者来说可能并不友好。如果你对网络协议还不太了解，推荐你去学《TCP/IP详解》，特别是第一卷的 TCP/IP 协议族。这是每个程序员都要掌握的核心基础知识。</p><p>再回到 tcpdump工具本身，它的基本使用方法，还是比较简单的，也就是 <strong>tcpdump [选项] [过滤表达式]</strong>。当然，选项和表达式的外面都加了中括号，表明它们都是可选的。</p><blockquote>\n<p>提示：在 Linux 工具中，如果你在文档中看到，选项放在中括号里，就说明这是一个可选选项。这时候就要留意一下，这些选项是不是有默认值。</p>\n</blockquote><p>查看 tcpdump 的 <a href=\"https://www.tcpdump.org/manpages/tcpdump.1.html\">手册</a>  ，以及 pcap-filter 的<a href=\"https://www.tcpdump.org/manpages/pcap-filter.7.html\">手册</a>，你会发现，tcpdump 提供了大量的选项以及各式各样的过滤表达式。不过不要担心，只需要掌握一些常用选项和过滤表达式，就可以满足大部分场景的需要了。</p><p>为了帮你更快上手 tcpdump 的使用，我在这里也帮你整理了一些最常见的用法，并且绘制成了表格，你可以参考使用。</p><p>首先，来看一下常用的几个选项。在上面的ping 案例中，我们用过  <strong>-nn</strong> 选项，表示不用对 IP 地址和端口号进行名称解析。其他常用选项，我用下面这张表格来解释。</p><p><img src=\"https://static001.geekbang.org/resource/image/85/ff/859d3b5c0071335429620a3fcdde4fff.png?wh=1655*994\" alt=\"\"></p><p>接下来，我们再来看常用的过滤表达式。刚刚用过的是  udp port 53 or host 35.190.27.188 ，表示抓取 DNS 协议的请求和响应包，以及源地址或目的地址为 35.190.27.188 的包。</p><p>其他常用的过滤选项，我也整理成了下面这个表格。</p><p><img src=\"https://static001.geekbang.org/resource/image/48/b3/4870a28c032bdd2a26561604ae2f7cb3.png?wh=1660*1129\" alt=\"\"></p><p>最后，再次强调 tcpdump 的输出格式，我在前面已经介绍了它的基本格式：</p><pre><code>时间戳 协议 源地址.源端口 &gt; 目的地址.目的端口 网络包详细信息\n</code></pre><p>其中，网络包的详细信息取决于协议，不同协议展示的格式也不同。所以，更详细的使用方法，还是需要你去查询 tcpdump 的 <a href=\"https://www.tcpdump.org/manpages/tcpdump.1.html\">man</a> 手册（执行 man tcpdump 也可以得到）。</p><p>不过，讲了这么多，你应该也发现了。tcpdump 虽然功能强大，可是输出格式却并不直观。特别是，当系统中网络包数比较多（比如PPS 超过几千）的时候，你想从 tcpdump 抓取的网络包中分析问题，实在不容易。</p><p>对比之下，Wireshark 则通过图形界面，以及一系列的汇总分析工具，提供了更友好的使用界面，让你可以用更快的速度，摆平网络性能问题。接下来，我们就详细来看看它。</p><h2>Wireshark</h2><p>Wireshark 也是最流行的一个网络分析工具，它最大的好处就是提供了跨平台的图形界面。跟 tcpdump 类似，Wireshark 也提供了强大的过滤规则表达式，同时，还内置了一系列的汇总分析工具。</p><p>比如，拿刚刚的 ping 案例来说，你可以执行下面的命令，把抓取的网络包保存到 ping.pcap 文件中：</p><pre><code>$ tcpdump -nn udp port 53 or host 35.190.27.188 -w ping.pcap\n</code></pre><p>接着，把它拷贝到你安装有 Wireshark 的机器中，比如你可以用 scp 把它拷贝到本地来：</p><pre><code>$ scp host-ip/path/ping.pcap .\n</code></pre><p>然后，再用 Wireshark 打开它。打开后，你就可以看到下面这个界面：</p><p><img src=\"https://static001.geekbang.org/resource/image/6b/2c/6b854703dcfcccf64c0a69adecf2f42c.png?wh=2316*400\" alt=\"\"></p><p>从 Wireshark 的界面里，你可以发现，它不仅以更规整的格式，展示了各个网络包的头部信息；还用了不同颜色，展示 DNS 和 ICMP 这两种不同的协议。你也可以一眼看出，中间的两条 PTR 查询并没有响应包。</p><p>接着，在网络包列表中选择某一个网络包后，在其下方的网络包详情中，你还可以看到，这个包在协议栈各层的详细信息。比如，以编号为 5 的 PTR 包为例：</p><p><img src=\"https://static001.geekbang.org/resource/image/59/25/59781a5dc7b1b9234643991365bfc925.png?wh=2230*864\" alt=\"\"></p><p>你可以看到，IP 层（Internet Protocol）的源地址和目的地址、传输层的 UDP 协议（User Datagram Protocol）、应用层的 DNS 协议（Domain Name System）的概要信息。</p><p>继续点击每层左边的箭头，就可以看到该层协议头的所有信息。比如点击 DNS 后，就可以看到 Transaction ID、Flags、Queries 等 DNS 协议各个字段的数值以及含义。</p><p>当然，Wireshark 的功能远不止如此。接下来我再带你一起，看一个 HTTP 的例子，并理解 TCP 三次握手和四次挥手的工作原理。</p><p>这个案例我们将要访问的是 <a href=\"http://example.com/\">http://example.com/</a> 。进入终端一，执行下面的命令，首先查出 example.com 的 IP。然后，执行 tcpdump 命令，过滤得到的 IP 地址，并将结果保存到 web.pcap 中。</p><pre><code>$ dig +short example.com\n93.184.216.34\n$ tcpdump -nn host 93.184.216.34 -w web.pcap\n</code></pre><blockquote>\n<p>实际上，你可以在 host 表达式中，直接使用域名，即 <strong>tcpdump -nn host example.com -w web.pcap</strong>。</p>\n</blockquote><p>接下来，切换到终端二，执行下面的 curl 命令，访问 <a href=\"http://example.com\">http://example.com</a>：</p><pre><code>$ curl http://example.com\n</code></pre><p>最后，再回到终端一，按下 Ctrl+C 停止 tcpdump，并把得到的 web.pcap 拷贝出来。</p><p>使用 Wireshark 打开 web.pcap 后，你就可以在 Wireshark 中，看到如下的界面：</p><p><img src=\"https://static001.geekbang.org/resource/image/07/9d/07bcdba5b563ebae36f5b5b453aacd9d.png?wh=2360*398\" alt=\"\"></p><p>由于 HTTP 基于 TCP ，所以你最先看到的三个包，分别是 TCP 三次握手的包。接下来，中间的才是 HTTP 请求和响应包，而最后的三个包，则是 TCP 连接断开时的三次挥手包。</p><p>从菜单栏中，点击 Statistics -&gt; Flow Graph，然后，在弹出的界面中的 Flow type 选择 TCP Flows，你可以更清晰的看到，整个过程中 TCP 流的执行过程：</p><p><img src=\"https://static001.geekbang.org/resource/image/4e/bb/4ec784752fdbc0cc5ead036a6419cbbb.png?wh=1526*596\" alt=\"\"></p><p>这其实跟各种教程上讲到的，TCP 三次握手和四次挥手很类似，作为对比， 你通常看到的 TCP 三次握手和四次挥手的流程，基本是这样的：</p><p><img src=\"https://static001.geekbang.org/resource/image/52/e8/5230fb678fcd3ca6b55d4644881811e8.png?wh=875*976\" alt=\"\"></p><p>(图片来自<a href=\"https://coolshell.cn/articles/11564.html\">酷壳</a>)</p><p>不过，对比这两张图，你会发现，这里抓到的包跟上面的四次挥手，并不完全一样，实际挥手过程只有三个包，而不是四个。</p><p>其实，之所以有三个包，是因为服务器端收到客户端的 FIN 后，服务器端同时也要关闭连接，这样就可以把 ACK 和 FIN 合并到一起发送，节省了一个包，变成了“三次挥手”。</p><p>而通常情况下，服务器端收到客户端的 FIN 后，很可能还没发送完数据，所以就会先回复客户端一个 ACK 包。稍等一会儿，完成所有数据包的发送后，才会发送 FIN 包。这也就是四次挥手了。</p><p>抓包后， Wireshark 中就会显示下面这个界面（原始网络包来自 Wireshark TCP 4-times close 示例，你可以点击 <a href=\"https://wiki.wireshark.org/TCP%204-times%20close\">这里</a> 下载）：</p><p><img src=\"https://static001.geekbang.org/resource/image/0e/99/0ecb6d11e5e7725107c0291c45aa7e99.png?wh=1898*186\" alt=\"\"></p><p>当然，Wireshark 的使用方法绝不只有这些，更多的使用方法，同样可以参考 <a href=\"https://www.wireshark.org/docs/\">官方文档</a> 以及 <a href=\"https://wiki.wireshark.org/\">WIKI</a>。</p><h2>小结</h2><p>今天，我们一起学了 tcpdump 和 Wireshark 的使用方法，并通过几个案例，学会了如何运用这两个工具来分析网络的收发过程，并找出潜在的性能问题。</p><p>当你发现针对相同的网络服务，使用 IP 地址快而换成域名却慢很多时，就要想到，有可能是 DNS 在捣鬼。DNS 的解析，不仅包括从域名解析出 IP 地址的 A 记录请求，还包括性能工具帮你，“聪明”地从 IP 地址反查域名的 PTR 请求。</p><p>实际上，<strong>根据 IP 地址反查域名、根据端口号反查协议名称，是很多网络工具默认的行为，而这往往会导致性能工具的工作缓慢</strong>。所以，通常，网络性能工具都会提供一个选项（比如 -n 或者 -nn），来禁止名称解析。</p><p>在工作中，当你碰到网络性能问题时，不要忘记tcpdump 和 Wireshark 这两个大杀器。你可以用它们抓取实际传输的网络包，再排查是否有潜在的性能问题。</p><h2>思考</h2><p>最后，我想请你来聊一聊，你是如何使用 tcpdump 和 Wireshark 的。你用 tcpdump 或者 Wireshark 解决过哪些网络问题呢？你又是如何排查、分析并解决的呢？你可以结合今天学到的网络知识，总结自己的思路。</p><p>欢迎在留言区和我讨论，也欢迎你把这篇文章分享给你的同事、朋友。我们一起在实战中演练，在交流中进步。</p>","neighbors":{"left":{"article_title":"37 | 案例篇：DNS 解析时快时慢，我该怎么办？","id":81850},"right":{"article_title":"39 | 案例篇：怎么缓解 DDoS 攻击带来的性能下降问题？","id":82573}},"comments":[{"had_liked":false,"id":68157,"user_name":"1+1","can_delete":false,"product_type":"c1","uid":1242204,"ip_address":"","ucode":"5497CCAE58281C","user_header":"https://static001.geekbang.org/account/avatar/00/12/f4/5c/e0a56bbf.jpg","comment_is_top":false,"comment_ctime":1550450909,"is_pvip":false,"replies":[{"id":"24372","content":"👍 这两本书都不错","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550570148,"ip_address":"","comment_id":68157,"utype":1}],"discussion_count":3,"race_medal":0,"score":"233478684893","product_id":100020901,"comment_content":"wireshark的使用推荐阅读林沛满的《Wireshark网络分析就这么简单》和《Wireshark网络分析的艺术》","like_count":55,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439541,"discussion_content":"👍 这两本书都不错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550570148,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2116919,"avatar":"","nickname":"Geek_77a14f","note":"","ucode":"EB71258E219A6D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338450,"discussion_content":"你好，想问一下是需要2本都要买，还是需要买其中一本呢？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1609293526,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2057462,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/64/f6/b2de64bb.jpg","nickname":"倔强的韭菜","note":"","ucode":"D99AB658AE1778","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2116919,"avatar":"","nickname":"Geek_77a14f","note":"","ucode":"EB71258E219A6D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341355,"discussion_content":"个人觉得第一本更好一些","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1610385853,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":338450,"ip_address":""},"score":341355,"extra":""}]}]},{"had_liked":false,"id":85610,"user_name":"xierongfei","can_delete":false,"product_type":"c1","uid":1298910,"ip_address":"","ucode":"2B4F061FA93A76","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/mnBC29lF1RibHdwkZdPdGM9QRAl7Y7Aicad8vpmIEialjia93IEVSAHibkKdwHwfZr6qedVHiafKUD8Yk1v2eiaibj8l0w/132","comment_is_top":false,"comment_ctime":1555141035,"is_pvip":true,"replies":[{"id":"31289","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1555500966,"ip_address":"","comment_id":85610,"utype":1}],"discussion_count":3,"race_medal":0,"score":"121814225323","product_id":100020901,"comment_content":"之前公司一个内部应用出现页面卡顿，而且每次都是1-2用户反馈（随机），排出了应用本身，服务器，客户端网络问题后，然后让it在用户端抓包传给我，然后用Wireshark分析后，发现有大量虚假重传，后面分析后发现，是用户都在一个Nat网络后面，部分用户时间不一致，同时我们服务器开启了tcp快速回收，导致连接被回收了。后面关闭tcp快速回收后解决。也是第一次用工具分析这种比较复杂的问题。","like_count":29,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446735,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555500966,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1016905,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/84/49/47d48fd0.jpg","nickname":"观弈道人","note":"","ucode":"F3BB619A33C605","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":60724,"discussion_content":"您好，请问如何关闭tcp快速回收","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574749260,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1662117,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM7zuDYFIutbSPc4eEtcMhdNBTI1FRR7q0xrGh2X1QdiaNxvAV31HcRUsjPWLaaWftqgwTnVoiaica8Nw/132","nickname":"胜辉（大V）","note":"","ucode":"3C13BFCD82D4EC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1016905,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/84/49/47d48fd0.jpg","nickname":"观弈道人","note":"","ucode":"F3BB619A33C605","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":399813,"discussion_content":"新的linux内核已经去掉了tw_recycle选项 所以这个问题应该是不会再有了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1633068372,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":60724,"ip_address":""},"score":399813,"extra":""}]}]},{"had_liked":false,"id":68165,"user_name":"日拱一卒","can_delete":false,"product_type":"c1","uid":1056944,"ip_address":"","ucode":"3BDFD6F473862C","user_header":"https://static001.geekbang.org/account/avatar/00/10/20/b0/0a1551c4.jpg","comment_is_top":false,"comment_ctime":1550452202,"is_pvip":false,"replies":[{"id":"24373","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550570156,"ip_address":"","comment_id":68165,"utype":1}],"discussion_count":1,"race_medal":0,"score":"70269928938","product_id":100020901,"comment_content":"林沛满的书都看过，确实写的相当好，都是案例驱动。<br>把协议讲的生动有趣就数他。","like_count":16,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439543,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550570156,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":73432,"user_name":"bzadhere","can_delete":false,"product_type":"c1","uid":1045920,"ip_address":"","ucode":"8A3CC56EF76A65","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f5/a0/c342c50e.jpg","comment_is_top":false,"comment_ctime":1551883041,"is_pvip":false,"replies":[{"id":"26762","content":"谢谢分享","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551886051,"ip_address":"","comment_id":73432,"utype":1}],"discussion_count":2,"race_medal":0,"score":"57386457889","product_id":100020901,"comment_content":"&quot;如果看了这个你还是不会用Wireshark，那就来找我吧&quot; ----这是在网上可以找到最牛逼的资料<br><br>https:&#47;&#47;www.dell.com&#47;community&#47;%E6%95%B0%E6%8D%AE%E5%AD%98%E5%82%A8%E8%AE%A8%E8%AE%BA%E5%8C%BA&#47;%E5%A6%82%E6%9E%9C%E7%9C%8B%E4%BA%86%E8%BF%99%E4%B8%AA%E4%BD%A0%E8%BF%98%E6%98%AF%E4%B8%8D%E4%BC%9A%E7%94%A8Wireshark-%E9%82%A3%E5%B0%B1%E6%9D%A5%E6%89%BE%E6%88%91%E5%90%A7-8%E6%9C%886%E6%97%A5%E5%AE%8C%E7%BB%93&#47;td-p&#47;7007033","like_count":14,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442084,"discussion_content":"谢谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551886051,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1434831,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e4/cf/906f47c9.jpg","nickname":"含章","note":"","ucode":"A7CA116D5275C9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":355564,"discussion_content":"大佬，这个下边的分页打不开吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615452640,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68650,"user_name":"肖飞码字","can_delete":false,"product_type":"c1","uid":1000696,"ip_address":"","ucode":"53D821F2F0F1DA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/44/f8/6fdb50ab.jpg","comment_is_top":false,"comment_ctime":1550567274,"is_pvip":false,"replies":[{"id":"24383","content":"👍 谢谢分享","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550570656,"ip_address":"","comment_id":68650,"utype":1}],"discussion_count":1,"race_medal":0,"score":"44500240234","product_id":100020901,"comment_content":"tcpdump抓包可以用来处理一些疑难问题的。 如受到了什么类型的攻击，执行了mysql的什么命令，接收以及发送出去了什么数据包通通都可以。像入侵检测如snort工具之类的应该也是对数据包进行抓包分析的，很实用，很强大。","like_count":11,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439778,"discussion_content":"👍 谢谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550570656,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":72913,"user_name":"科学Jia","can_delete":false,"product_type":"c1","uid":1080409,"ip_address":"","ucode":"95430413F82A69","user_header":"https://static001.geekbang.org/account/avatar/00/10/7c/59/26b1e65a.jpg","comment_is_top":false,"comment_ctime":1551754213,"is_pvip":false,"replies":[{"id":"26743","content":"嗯，证书解密是最简单的方法，也可以使用 MitM（Man-in-the-middle）方法","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551883379,"ip_address":"","comment_id":72913,"utype":1}],"discussion_count":2,"race_medal":0,"score":"35911492581","product_id":100020901,"comment_content":"老师，这个案例写的极其生动:D, 就是问一句，现在我们的项目都是https，那么如果抓包https，tcpdump或者wireshark是否可以解密？因为我看到wireshark解密需要private key，但是private key涉及安全问题，肯定都拿不到，那么你们遇到抓包https后解析是怎么做的呢？","like_count":9,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441824,"discussion_content":"嗯，证书解密是最简单的方法，也可以使用 MitM（Man-in-the-middle）方法","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551883379,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1318448,"avatar":"","nickname":"zzyalbert","note":"","ucode":"A6E3691ADCAECA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4237,"discussion_content":"可以用浏览器保存private key，chrome、firefox都支持","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1565245367,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69308,"user_name":"潘政宇","can_delete":false,"product_type":"c1","uid":1254758,"ip_address":"","ucode":"9A6658EE862D95","user_header":"https://static001.geekbang.org/account/avatar/00/13/25/66/4835d92e.jpg","comment_is_top":false,"comment_ctime":1550714828,"is_pvip":true,"replies":[{"id":"24841","content":"不只是ping，大部分输出中包含名字的工具都支持反向解析，这是为了更直观展示结果（毕竟我们熟悉的都是域名而不是IP）。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550849625,"ip_address":"","comment_id":69308,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23025551308","product_id":100020901,"comment_content":"老师好，为什么ping命令使用PTR信息，ping一个域名的时候，直接dns查询得到A记录ip地址，然后ping这个ip就行啊，为什么使用反向解析？","like_count":6,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440053,"discussion_content":"不只是ping，大部分输出中包含名字的工具都支持反向解析，这是为了更直观展示结果（毕竟我们熟悉的都是域名而不是IP）。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550849625,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68149,"user_name":"明翼","can_delete":false,"product_type":"c1","uid":1068361,"ip_address":"","ucode":"E77F86BEB3D5C1","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","comment_is_top":false,"comment_ctime":1550449194,"is_pvip":false,"replies":[{"id":"24371","content":"👍 没有图形界面的时候，tshark也是个选择","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550570115,"ip_address":"","comment_id":68149,"utype":1}],"discussion_count":2,"race_medal":0,"score":"23025285674","product_id":100020901,"comment_content":"老师wireshark有个命令行版本tshark，wireshark是通过一个叫dump的进程抓包管道方式发送给tshark解析的，不过tshark的命令项有点多，不是太好用","like_count":6,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439538,"discussion_content":"👍 没有图形界面的时候，tshark也是个选择","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550570115,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1269873,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/71/895ee6cf.jpg","nickname":"分清云淡","note":"","ucode":"7045AE6BF72D31","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":126996,"discussion_content":"tcpdump/tshark/wireshark 底层都是调os的pcap库来抓包的。真正的高手就得会用tshark, 因为界面上分析起来不够灵活，给你看几个tshark屌爆的案例： https://plantegg.github.io/2019/06/21/%E5%B0%B1%E6%98%AF%E8%A6%81%E4%BD%A0%E6%87%82%E6%8A%93%E5%8C%85--WireShark%E4%B9%8B%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%89%88tshark/","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1578557688,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":73566,"user_name":"kissingers","can_delete":false,"product_type":"c1","uid":1135299,"ip_address":"","ucode":"615151808CF628","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKzqiaZnBw2myRWY802u48Rw3W2zDtKoFQ6vN63m4FdyjibM21FfaOYe8MbMpemUdxXJeQH6fRdVbZA/132","comment_is_top":false,"comment_ctime":1551926875,"is_pvip":false,"replies":[{"id":"27321","content":"优化方法里面有提到","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1552347961,"ip_address":"","comment_id":73566,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18731796059","product_id":100020901,"comment_content":"林沛满的书不错，EMC 大牛值得推荐。<br>Fiddler，工具也了解过，微软的人写的，支持https （man in middle），能修改请求和响应数据包。<br>另外老师能讲讲：linux 主机上怎么提高数据转发性能吗？","like_count":5,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442159,"discussion_content":"优化方法里面有提到","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552347961,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":199958,"user_name":"hellojd_gk","can_delete":false,"product_type":"c1","uid":1679543,"ip_address":"","ucode":"319AF4C1AD568D","user_header":"https://static001.geekbang.org/account/avatar/00/19/a0/b7/1327ae60.jpg","comment_is_top":false,"comment_ctime":1585522445,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14470424333","product_id":100020901,"comment_content":"如果换一个 DNS 服务器，就可以用 PTR 反查到 35.190.27.188 所对应的域名，到最后也没讲到为什么是googleaccount域名。","like_count":3,"discussions":[{"author":{"id":1284474,"avatar":"https://static001.geekbang.org/account/avatar/00/13/99/7a/558666a5.jpg","nickname":"AceslupK","note":"","ucode":"048F84D019CBBB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393308,"discussion_content":"意思应该是，如果换用别的域名地址，反解出来的不一定是googleusercontent。但为了演示PTR响应超时，提前查询知道反向解析出“188.27.190.35.bc.googleusercontent.com.”故意做的配置。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1631349624,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79211,"user_name":"Griffin","can_delete":false,"product_type":"c1","uid":1087329,"ip_address":"","ucode":"CF766B92A65261","user_header":"https://static001.geekbang.org/account/avatar/00/10/97/61/34a0da09.jpg","comment_is_top":false,"comment_ctime":1553402849,"is_pvip":false,"replies":[{"id":"29054","content":"嗯嗯，谢谢补充","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553526760,"ip_address":"","comment_id":79211,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10143337441","product_id":100020901,"comment_content":"Web的问题推荐 MITM啊","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444400,"discussion_content":"嗯嗯，谢谢补充","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553526760,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69586,"user_name":"ninuxer","can_delete":false,"product_type":"c1","uid":1243135,"ip_address":"","ucode":"5394ADAF2667D6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132","comment_is_top":false,"comment_ctime":1550794821,"is_pvip":false,"replies":[{"id":"25328","content":"嗯嗯，fiddler主要用于HTTP","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551193184,"ip_address":"","comment_id":69586,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10140729413","product_id":100020901,"comment_content":"打卡day40<br>使用姿势跟老师的一样，都是tcpdump抓包后，拿到图形界面分析，如果是web问题，还会用下fiddler来分析","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440177,"discussion_content":"嗯嗯，fiddler主要用于HTTP","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551193184,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":334479,"user_name":"sky","can_delete":false,"product_type":"c1","uid":1082187,"ip_address":"","ucode":"FC323371453C97","user_header":"https://static001.geekbang.org/account/avatar/00/10/83/4b/0e96fcae.jpg","comment_is_top":false,"comment_ctime":1644974657,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5939941953","product_id":100020901,"comment_content":"实践的时候出现了以下错误，也没找到解决方案，有朋友遇到过吗<br><br>配置：<br>腾讯云 OS：ubuntu18.04 <br>CPU：2 <br>Mem：4G<br>Bandwidth：8Mbps<br><br>resolv.conf<br>nameserver 114.114.114.114<br>options edns0<br><br>root@VM-4-13-ubuntu:&#47;home&#47;ubuntu# nslookup -type=PTR 39.106.233.176 8.8.8.8<br>Server:         8.8.8.8<br>Address:        8.8.8.8#53<br><br>** server can&#39;t find 176.233.106.39.in-addr.arpa: NXDOMAIN","like_count":2},{"had_liked":false,"id":133301,"user_name":"哈哈哈哈哈哈哈哈","can_delete":false,"product_type":"c1","uid":1120350,"ip_address":"","ucode":"8186E8CF7D39BE","user_header":"https://static001.geekbang.org/account/avatar/00/11/18/5e/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1568507655,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"5863474951","product_id":100020901,"comment_content":"老师 对线上服务进行tcpdump会影响性能吗","like_count":1,"discussions":[{"author":{"id":2068721,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/90/f1/7f2b5e16.jpg","nickname":"CHN-Lee-玉米","note":"","ucode":"0A53080F38F229","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377263,"discussion_content":"会","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622563060,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68192,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1550455374,"is_pvip":false,"replies":[{"id":"24374","content":"嗯 复杂的场景还是用Wireshark更方便些","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550570202,"ip_address":"","comment_id":68192,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5845422670","product_id":100020901,"comment_content":"[D38打卡]<br>以前都是在windows上用Wireshark,想不到linux下也有Wireshark.<br>不过平常维护的linux只能用终端登录,在终端中还是用tcpdump.<br><br>今天看了专栏,才发现,可以用tcpdump抓包,然后用Wireshark来展示.这个厉害了.<br>","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439556,"discussion_content":"嗯 复杂的场景还是用Wireshark更方便些","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1550570202,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":342779,"user_name":"丫头","can_delete":false,"product_type":"c1","uid":1170944,"ip_address":"","ucode":"A17BCC0D1C014D","user_header":"https://static001.geekbang.org/account/avatar/00/11/de/00/c646dc88.jpg","comment_is_top":false,"comment_ctime":1650460054,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1650460054","product_id":100020901,"comment_content":"怎么安装tcpdump","like_count":0},{"had_liked":false,"id":328645,"user_name":"JianXu","can_delete":false,"product_type":"c1","uid":1033219,"ip_address":"","ucode":"2A61BDBB573BDC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c4/03/f753fda7.jpg","comment_is_top":false,"comment_ctime":1640826644,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1640826644","product_id":100020901,"comment_content":"我们部门现在使用iPvS 和 envoy 作分布式负载均衡，有人说这种情况用log 分析就可以了，没有必要使用tcpdump, 也有人说需要使用tcpdump,  为什么支持类似Netscalar nstrace 的能力，需要改动envoy 源代码，加载自定义的kernel module , 还要暂存key … 不知道兄弟公司有这样的需求吗？","like_count":0},{"had_liked":false,"id":305123,"user_name":"忆水寒","can_delete":false,"product_type":"c1","uid":1147453,"ip_address":"","ucode":"E3F86BD8AA8903","user_header":"https://static001.geekbang.org/account/avatar/00/11/82/3d/356fc3d6.jpg","comment_is_top":false,"comment_ctime":1627830050,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627830050","product_id":100020901,"comment_content":"分析过很多问题，比如高峰期的时候，网络断连。<br><br>https:&#47;&#47;mp.weixin.qq.com&#47;s&#47;XS3Jnn3Xl4_12gzg0zrSTA","like_count":1},{"had_liked":false,"id":304831,"user_name":"ghostwritten","can_delete":false,"product_type":"c1","uid":1308196,"ip_address":"","ucode":"AE512F2E24A1A0","user_header":"https://static001.geekbang.org/account/avatar/00/13/f6/24/5a9277f1.jpg","comment_is_top":false,"comment_ctime":1627633554,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627633554","product_id":100020901,"comment_content":"ping -c3 geektime.org<br>ping -n -c3 geektime.org<br>iptables -I INPUT -p udp --sport 53 -m string --string googleusercontent --algo bm -j DROP<br>iptables -D INPUT -p udp --sport 53 -m string --string googleusercontent --algo bm -j DROP<br>time nslookup geektime.org<br> nslookup -type=PTR 35.190.27.188 8.8.8.8<br>tcpdump -nn udp port 53 or host 35.190.27.188<br>tcpdump -nn udp port 53 or host 35.190.27.188 -w ping.pcap<br>dig +short example.com<br>tcpdump -nn host 93.184.216.34 -w web.pcap","like_count":0},{"had_liked":false,"id":288433,"user_name":"谨兮谨兮","can_delete":false,"product_type":"c1","uid":1376885,"ip_address":"","ucode":"55712DD3852169","user_header":"https://static001.geekbang.org/account/avatar/00/15/02/75/2839c0bb.jpg","comment_is_top":false,"comment_ctime":1618468004,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618468004","product_id":100020901,"comment_content":"为什么ping域名出现ptr呢","like_count":0},{"had_liked":false,"id":258941,"user_name":"凯","can_delete":false,"product_type":"c1","uid":1405256,"ip_address":"","ucode":"60DB11CF72C7B0","user_header":"https://static001.geekbang.org/account/avatar/00/15/71/48/44df7f4e.jpg","comment_is_top":false,"comment_ctime":1604585318,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604585318","product_id":100020901,"comment_content":"每节课都受益匪浅","like_count":0},{"had_liked":false,"id":248098,"user_name":"欧阳洲","can_delete":false,"product_type":"c1","uid":1986708,"ip_address":"","ucode":"94606A6315F2BA","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKT9Tk01eiaQ9aAhszthzGm6lwruRWPXia1YYFozctrdRvKg0Usp8NbwuKBApwD0D6Fty2tib3RdtFJg/132","comment_is_top":false,"comment_ctime":1600008606,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1600008606","product_id":100020901,"comment_content":"老师好，请教一下：<br>抓包并没看到 googleusercontent 的字样，这个字符串在哪里呢？<br>PTR的包倒是看到了in-addr.arpa的字样，iptables命令用in-addr.arpa代替googleusercontent应该也可以吧<br>","like_count":0},{"had_liked":false,"id":237620,"user_name":"北纬8℃","can_delete":false,"product_type":"c1","uid":1433189,"ip_address":"","ucode":"4999F2E037C93C","user_header":"https://static001.geekbang.org/account/avatar/00/15/de/65/51147fb6.jpg","comment_is_top":false,"comment_ctime":1595903175,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595903175","product_id":100020901,"comment_content":"老师，讲http改成https 是我们文章中提到的加了域名么。 我们http改成了https流量就崩了，第一次链接要15s，","like_count":0},{"had_liked":false,"id":232055,"user_name":"方木木","can_delete":false,"product_type":"c1","uid":1045634,"ip_address":"","ucode":"44E0C9318DF794","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f4/82/466ecee2.jpg","comment_is_top":false,"comment_ctime":1593845404,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1593845404","product_id":100020901,"comment_content":"老师，三次挥手的示例图中，为什么8号包，会同时有fin和ack标志，7号包已经有ack","like_count":0,"discussions":[{"author":{"id":1318941,"avatar":"https://static001.geekbang.org/account/avatar/00/14/20/1d/0c1a184c.jpg","nickname":"罗辑思维","note":"","ucode":"D257A06EDE928E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364140,"discussion_content":"从7号和8号包相同的seq号可以看出这两个包都是172.16.3.4发给93.184.216.34的ACK包，只是被分段了，刚好172.16.3.4也要发送FIN包，就直接合并在8号包了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617372750,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":202943,"user_name":"怀揣梦想的学渣","can_delete":false,"product_type":"c1","uid":1916685,"ip_address":"","ucode":"2349B9F4F6FDE3","user_header":"https://static001.geekbang.org/account/avatar/00/1d/3f/0d/1e8dbb2c.jpg","comment_is_top":false,"comment_ctime":1586090690,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1586090690","product_id":100020901,"comment_content":"tcpdump这个确实很好用。","like_count":0},{"had_liked":false,"id":135742,"user_name":"kissingers","can_delete":false,"product_type":"c1","uid":1135299,"ip_address":"","ucode":"615151808CF628","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKzqiaZnBw2myRWY802u48Rw3W2zDtKoFQ6vN63m4FdyjibM21FfaOYe8MbMpemUdxXJeQH6fRdVbZA/132","comment_is_top":false,"comment_ctime":1569251268,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1569251268","product_id":100020901,"comment_content":"老师，有没有碰到过tcpdump 抓包本身就丢包，即tcpdump 本身丢包了？","like_count":0,"discussions":[{"author":{"id":1662117,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM7zuDYFIutbSPc4eEtcMhdNBTI1FRR7q0xrGh2X1QdiaNxvAV31HcRUsjPWLaaWftqgwTnVoiaica8Nw/132","nickname":"胜辉（大V）","note":"","ucode":"3C13BFCD82D4EC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":399816,"discussion_content":"会的 具体看服务器是否繁忙 忙就有可能没抓到","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1633068854,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":131854,"user_name":"wking","can_delete":false,"product_type":"c1","uid":1294634,"ip_address":"","ucode":"47D52E4280D1E6","user_header":"https://static001.geekbang.org/account/avatar/00/13/c1/2a/e7102065.jpg","comment_is_top":false,"comment_ctime":1567937912,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567937912","product_id":100020901,"comment_content":"老师，有没有工具抓取指定某个url请求tcp包？","like_count":0},{"had_liked":false,"id":88689,"user_name":"Boy-struggle","can_delete":false,"product_type":"c1","uid":1402286,"ip_address":"","ucode":"94113E2837DC29","user_header":"https://static001.geekbang.org/account/avatar/00/15/65/ae/9727318e.jpg","comment_is_top":false,"comment_ctime":1555982911,"is_pvip":false,"replies":[{"id":"31954","content":"tcpdump抓包看看？可以先试试客户端抓包，如果还是没有线索就两端抓包对比看看","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1556113461,"ip_address":"","comment_id":88689,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555982911","product_id":100020901,"comment_content":"老师，最近我们遇到了一个关于vsftp问题，客户端返回错误码为28，官方解释是数据连接超时，到不清楚到底是从客户端分析还是服务端分析，我们用的是被动模式vsftp","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447864,"discussion_content":"tcpdump抓包看看？可以先试试客户端抓包，如果还是没有线索就两端抓包对比看看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556113461,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":84657,"user_name":"大坏狐狸","can_delete":false,"product_type":"c1","uid":1325678,"ip_address":"","ucode":"5044F89A505C5B","user_header":"https://static001.geekbang.org/account/avatar/00/14/3a/6e/e39e90ca.jpg","comment_is_top":false,"comment_ctime":1554890892,"is_pvip":false,"replies":[{"id":"30637","content":"文中有讲到的，在四次挥手的图后面","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1555076102,"ip_address":"","comment_id":84657,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554890892","product_id":100020901,"comment_content":"由于TCP连接是全双工的，因此每个方向都必须单独进行关闭。这原则是当一方完成它的数据发送任务后就能发送一个FIN来终止这个方向的连接。收到一个 FIN只意味着这一方向上没有数据流动，一个TCP连接在收到一个FIN后仍能发送数据。首先进行关闭的一方将执行主动关闭，而另一方执行被动关闭。<br>（1） TCP客户端发送一个FIN，用来关闭客户到服务器的数据传送。<br>（2） 服务器收到这个FIN，它发回一个ACK，确认序号为收到的序号加1。和SYN一样，一个FIN将占用一个序号。<br>（3） 服务器关闭客户端的连接，发送一个FIN给客户端。<br>（4） 客户端发回ACK报文确认，并将确认序号设置为收到序号加1。<br><br><br>老师这个是百度百科的。请问第一个抓包的时候有FIN 没说有ACK ，但是上图中ACK=y+1; 而你的（Wireshark TCP 4-times close 示例 这句话的连接的图片，也是没有ACK的 。但是平常抓包确实会看到ACK。。。那老师 到底带不带ACK，第一次FIN的时候?）","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446416,"discussion_content":"文中有讲到的，在四次挥手的图后面","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555076102,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":82562,"user_name":"DigDeeply","can_delete":false,"product_type":"c1","uid":1239008,"ip_address":"","ucode":"113F4D755A1FEC","user_header":"https://static001.geekbang.org/account/avatar/00/12/e7/e0/33521e13.jpg","comment_is_top":false,"comment_ctime":1554252428,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554252428","product_id":100020901,"comment_content":"工具很用法简单，最重要的是要了解TCP相关的基础知识，否则能抓到包，也看不出问题和原因来。<br>感谢老师的分享，很受益，需要再巩固下基础知识。","like_count":0},{"had_liked":false,"id":82340,"user_name":"如果","can_delete":false,"product_type":"c1","uid":1320638,"ip_address":"","ucode":"138A3EEEE50850","user_header":"","comment_is_top":false,"comment_ctime":1554187731,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554187731","product_id":100020901,"comment_content":"DAY38，打卡","like_count":0},{"had_liked":false,"id":79168,"user_name":"Griffin","can_delete":false,"product_type":"c1","uid":1087329,"ip_address":"","ucode":"CF766B92A65261","user_header":"https://static001.geekbang.org/account/avatar/00/10/97/61/34a0da09.jpg","comment_is_top":false,"comment_ctime":1553394879,"is_pvip":false,"replies":[{"id":"29347","content":"应该是版本的问题，比如https:&#47;&#47;linux.die.net&#47;man&#47;8&#47;tcpdump 这儿就有","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553699228,"ip_address":"","comment_id":79168,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553394879","product_id":100020901,"comment_content":"老师问个问题，我man tcpdump搜索-nn没找到结果，只有-n的介绍。我搜索了下发现在linuxquestions.org上有人问，并且回答者也是用的man，结果有-n和-nn的介绍。是我的man版本不对么？系统版本是18.04.1","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444381,"discussion_content":"应该是版本的问题，比如https://linux.die.net/man/8/tcpdump 这儿就有","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553699228,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79088,"user_name":"Maxwell","can_delete":false,"product_type":"c1","uid":1086275,"ip_address":"","ucode":"720A00AD472616","user_header":"https://static001.geekbang.org/account/avatar/00/10/93/43/0e84492d.jpg","comment_is_top":false,"comment_ctime":1553349125,"is_pvip":false,"replies":[{"id":"29063","content":"是不是抓的包比较大？Wireshark解析需要一定的时间，稍微等等应该可以恢复","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553527056,"ip_address":"","comment_id":79088,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553349125","product_id":100020901,"comment_content":"ubantu下用tcpdump抓包后，下载到本地，windows版的wireshark打开抓包文件，一直未响应，是咋回事呢？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444351,"discussion_content":"是不是抓的包比较大？Wireshark解析需要一定的时间，稍微等等应该可以恢复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553527056,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}