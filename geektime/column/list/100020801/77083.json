{"id":77083,"title":"26 | å¤‡åº“ä¸ºä»€ä¹ˆä¼šå»¶è¿Ÿå¥½å‡ ä¸ªå°æ—¶ï¼Ÿ","content":"<p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å’Œä½ ä»‹ç»äº†å‡ ç§å¯èƒ½å¯¼è‡´å¤‡åº“å»¶è¿Ÿçš„åŸå› ã€‚ä½ ä¼šå‘ç°ï¼Œè¿™äº›åœºæ™¯é‡Œï¼Œä¸è®ºæ˜¯å¶å‘æ€§çš„æŸ¥è¯¢å‹åŠ›ï¼Œè¿˜æ˜¯å¤‡ä»½ï¼Œå¯¹å¤‡åº“å»¶è¿Ÿçš„å½±å“ä¸€èˆ¬æ˜¯åˆ†é’Ÿçº§çš„ï¼Œè€Œä¸”åœ¨å¤‡åº“æ¢å¤æ­£å¸¸ä»¥åéƒ½èƒ½å¤Ÿè¿½ä¸Šæ¥ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœå¤‡åº“æ‰§è¡Œæ—¥å¿—çš„é€Ÿåº¦æŒç»­ä½äºä¸»åº“ç”Ÿæˆæ—¥å¿—çš„é€Ÿåº¦ï¼Œé‚£è¿™ä¸ªå»¶è¿Ÿå°±æœ‰å¯èƒ½æˆäº†å°æ—¶çº§åˆ«ã€‚è€Œä¸”å¯¹äºä¸€ä¸ªå‹åŠ›æŒç»­æ¯”è¾ƒé«˜çš„ä¸»åº“æ¥è¯´ï¼Œå¤‡åº“å¾ˆå¯èƒ½æ°¸è¿œéƒ½è¿½ä¸ä¸Šä¸»åº“çš„èŠ‚å¥ã€‚</p><p>è¿™å°±æ¶‰åŠåˆ°ä»Šå¤©æˆ‘è¦ç»™ä½ ä»‹ç»çš„è¯é¢˜ï¼šå¤‡åº“å¹¶è¡Œå¤åˆ¶èƒ½åŠ›ã€‚</p><p>ä¸ºäº†ä¾¿äºä½ ç†è§£ï¼Œæˆ‘ä»¬å†ä¸€èµ·çœ‹ä¸€ä¸‹ç¬¬24ç¯‡æ–‡ç« <a href=\"https://time.geekbang.org/column/article/76446\">ã€ŠMySQLæ˜¯æ€ä¹ˆä¿è¯ä¸»å¤‡ä¸€è‡´çš„ï¼Ÿã€‹</a>çš„ä¸»å¤‡æµç¨‹å›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/1a/ef/1a85a3bac30a32438bfd8862e5a34eef.png?wh=1142*856\" alt=\"\"></p><center><span class=\"reference\">å›¾1 ä¸»å¤‡æµç¨‹å›¾</span></center><p>è°ˆåˆ°ä¸»å¤‡çš„å¹¶è¡Œå¤åˆ¶èƒ½åŠ›ï¼Œæˆ‘ä»¬è¦å…³æ³¨çš„æ˜¯å›¾ä¸­é»‘è‰²çš„ä¸¤ä¸ªç®­å¤´ã€‚ä¸€ä¸ªç®­å¤´ä»£è¡¨äº†å®¢æˆ·ç«¯å†™å…¥ä¸»åº“ï¼Œå¦ä¸€ç®­å¤´ä»£è¡¨çš„æ˜¯å¤‡åº“ä¸Šsql_threadæ‰§è¡Œä¸­è½¬æ—¥å¿—ï¼ˆrelay logï¼‰ã€‚å¦‚æœç”¨ç®­å¤´çš„ç²—ç»†æ¥ä»£è¡¨å¹¶è¡Œåº¦çš„è¯ï¼Œé‚£ä¹ˆçœŸå®æƒ…å†µå°±å¦‚å›¾1æ‰€ç¤ºï¼Œç¬¬ä¸€ä¸ªç®­å¤´è¦æ˜æ˜¾ç²—äºç¬¬äºŒä¸ªç®­å¤´ã€‚</p><p>åœ¨ä¸»åº“ä¸Šï¼Œå½±å“å¹¶å‘åº¦çš„åŸå› å°±æ˜¯å„ç§é”äº†ã€‚ç”±äºInnoDBå¼•æ“æ”¯æŒè¡Œé”ï¼Œé™¤äº†æ‰€æœ‰å¹¶å‘äº‹åŠ¡éƒ½åœ¨æ›´æ–°åŒä¸€è¡Œï¼ˆçƒ­ç‚¹è¡Œï¼‰è¿™ç§æç«¯åœºæ™¯å¤–ï¼Œå®ƒå¯¹ä¸šåŠ¡å¹¶å‘åº¦çš„æ”¯æŒè¿˜æ˜¯å¾ˆå‹å¥½çš„ã€‚æ‰€ä»¥ï¼Œä½ åœ¨æ€§èƒ½æµ‹è¯•çš„æ—¶å€™ä¼šå‘ç°ï¼Œå¹¶å‘å‹æµ‹çº¿ç¨‹32å°±æ¯”å•çº¿ç¨‹æ—¶ï¼Œæ€»ä½“ååé‡é«˜ã€‚</p><p>è€Œæ—¥å¿—åœ¨å¤‡åº“ä¸Šçš„æ‰§è¡Œï¼Œå°±æ˜¯å›¾ä¸­å¤‡åº“ä¸Šsql_threadæ›´æ–°æ•°æ®(DATA)çš„é€»è¾‘ã€‚å¦‚æœæ˜¯ç”¨å•çº¿ç¨‹çš„è¯ï¼Œå°±ä¼šå¯¼è‡´å¤‡åº“åº”ç”¨æ—¥å¿—ä¸å¤Ÿå¿«ï¼Œé€ æˆä¸»å¤‡å»¶è¿Ÿã€‚</p><!-- [[[read_end]]] --><p>åœ¨å®˜æ–¹çš„5.6ç‰ˆæœ¬ä¹‹å‰ï¼ŒMySQLåªæ”¯æŒå•çº¿ç¨‹å¤åˆ¶ï¼Œç”±æ­¤åœ¨ä¸»åº“å¹¶å‘é«˜ã€TPSé«˜æ—¶å°±ä¼šå‡ºç°ä¸¥é‡çš„ä¸»å¤‡å»¶è¿Ÿé—®é¢˜ã€‚</p><p>ä»å•çº¿ç¨‹å¤åˆ¶åˆ°æœ€æ–°ç‰ˆæœ¬çš„å¤šçº¿ç¨‹å¤åˆ¶ï¼Œä¸­é—´çš„æ¼”åŒ–ç»å†äº†å¥½å‡ ä¸ªç‰ˆæœ¬ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°±è·Ÿä½ è¯´è¯´MySQLå¤šçº¿ç¨‹å¤åˆ¶çš„æ¼”è¿›è¿‡ç¨‹ã€‚</p><p>å…¶å®è¯´åˆ°åº•ï¼Œæ‰€æœ‰çš„å¤šçº¿ç¨‹å¤åˆ¶æœºåˆ¶ï¼Œéƒ½æ˜¯è¦æŠŠå›¾1ä¸­åªæœ‰ä¸€ä¸ªçº¿ç¨‹çš„sql_threadï¼Œæ‹†æˆå¤šä¸ªçº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯éƒ½ç¬¦åˆä¸‹é¢çš„è¿™ä¸ªæ¨¡å‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/bc/45/bcf75aa3b0f496699fd7885426bc6245.png?wh=1142*856\" alt=\"\"></p><center><span class=\"reference\">å›¾2 å¤šçº¿ç¨‹æ¨¡å‹</span></center><p>å›¾2ä¸­ï¼Œcoordinatorå°±æ˜¯åŸæ¥çš„sql_thread, ä¸è¿‡ç°åœ¨å®ƒä¸å†ç›´æ¥æ›´æ–°æ•°æ®äº†ï¼Œåªè´Ÿè´£è¯»å–ä¸­è½¬æ—¥å¿—å’Œåˆ†å‘äº‹åŠ¡ã€‚çœŸæ­£æ›´æ–°æ—¥å¿—çš„ï¼Œå˜æˆäº†workerçº¿ç¨‹ã€‚è€Œworkçº¿ç¨‹çš„ä¸ªæ•°ï¼Œå°±æ˜¯ç”±å‚æ•°slave_parallel_workerså†³å®šçš„ã€‚æ ¹æ®æˆ‘çš„ç»éªŒï¼ŒæŠŠè¿™ä¸ªå€¼è®¾ç½®ä¸º8~16ä¹‹é—´æœ€å¥½ï¼ˆ32æ ¸ç‰©ç†æœºçš„æƒ…å†µï¼‰ï¼Œæ¯•ç«Ÿå¤‡åº“è¿˜æœ‰å¯èƒ½è¦æä¾›è¯»æŸ¥è¯¢ï¼Œä¸èƒ½æŠŠCPUéƒ½åƒå…‰äº†ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œä½ éœ€è¦å…ˆæ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šäº‹åŠ¡èƒ½ä¸èƒ½æŒ‰ç…§è½®è¯¢çš„æ–¹å¼åˆ†å‘ç»™å„ä¸ªworkerï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªäº‹åŠ¡åˆ†ç»™worker_1ï¼Œç¬¬äºŒä¸ªäº‹åŠ¡å‘ç»™worker_2å‘¢ï¼Ÿ</p><p>å…¶å®æ˜¯ä¸è¡Œçš„ã€‚å› ä¸ºï¼Œäº‹åŠ¡è¢«åˆ†å‘ç»™workerä»¥åï¼Œä¸åŒçš„workerå°±ç‹¬ç«‹æ‰§è¡Œäº†ã€‚ä½†æ˜¯ï¼Œç”±äºCPUçš„è°ƒåº¦ç­–ç•¥ï¼Œå¾ˆå¯èƒ½ç¬¬äºŒä¸ªäº‹åŠ¡æœ€ç»ˆæ¯”ç¬¬ä¸€ä¸ªäº‹åŠ¡å…ˆæ‰§è¡Œã€‚è€Œå¦‚æœè¿™æ—¶å€™åˆšå¥½è¿™ä¸¤ä¸ªäº‹åŠ¡æ›´æ–°çš„æ˜¯åŒä¸€è¡Œï¼Œä¹Ÿå°±æ„å‘³ç€ï¼ŒåŒä¸€è¡Œä¸Šçš„ä¸¤ä¸ªäº‹åŠ¡ï¼Œåœ¨ä¸»åº“å’Œå¤‡åº“ä¸Šçš„æ‰§è¡Œé¡ºåºç›¸åï¼Œä¼šå¯¼è‡´ä¸»å¤‡ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œè¯·ä½ å†è®¾æƒ³ä¸€ä¸‹å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼šåŒä¸€ä¸ªäº‹åŠ¡çš„å¤šä¸ªæ›´æ–°è¯­å¥ï¼Œèƒ½ä¸èƒ½åˆ†ç»™ä¸åŒçš„workeræ¥æ‰§è¡Œå‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼Œä¹Ÿä¸è¡Œã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªäº‹åŠ¡æ›´æ–°äº†è¡¨t1å’Œè¡¨t2ä¸­çš„å„ä¸€è¡Œï¼Œå¦‚æœè¿™ä¸¤æ¡æ›´æ–°è¯­å¥è¢«åˆ†åˆ°ä¸åŒworkerçš„è¯ï¼Œè™½ç„¶æœ€ç»ˆçš„ç»“æœæ˜¯ä¸»å¤‡ä¸€è‡´çš„ï¼Œä½†å¦‚æœè¡¨t1æ‰§è¡Œå®Œæˆçš„ç¬é—´ï¼Œå¤‡åº“ä¸Šæœ‰ä¸€ä¸ªæŸ¥è¯¢ï¼Œå°±ä¼šçœ‹åˆ°è¿™ä¸ªäº‹åŠ¡â€œæ›´æ–°äº†ä¸€åŠçš„ç»“æœâ€ï¼Œç ´åäº†äº‹åŠ¡é€»è¾‘çš„éš”ç¦»æ€§ã€‚</p><p>æ‰€ä»¥ï¼Œcoordinatoråœ¨åˆ†å‘çš„æ—¶å€™ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹è¿™ä¸¤ä¸ªåŸºæœ¬è¦æ±‚ï¼š</p><ol>\n<li>\n<p>ä¸èƒ½é€ æˆæ›´æ–°è¦†ç›–ã€‚è¿™å°±è¦æ±‚æ›´æ–°åŒä¸€è¡Œçš„ä¸¤ä¸ªäº‹åŠ¡ï¼Œå¿…é¡»è¢«åˆ†å‘åˆ°åŒä¸€ä¸ªworkerä¸­ã€‚</p>\n</li>\n<li>\n<p>åŒä¸€ä¸ªäº‹åŠ¡ä¸èƒ½è¢«æ‹†å¼€ï¼Œå¿…é¡»æ”¾åˆ°åŒä¸€ä¸ªworkerä¸­ã€‚</p>\n</li>\n</ol><p>å„ä¸ªç‰ˆæœ¬çš„å¤šçº¿ç¨‹å¤åˆ¶ï¼Œéƒ½éµå¾ªäº†è¿™ä¸¤æ¡åŸºæœ¬åŸåˆ™ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±çœ‹çœ‹å„ä¸ªç‰ˆæœ¬çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥ã€‚</p><h1>MySQL 5.5ç‰ˆæœ¬çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥</h1><p>å®˜æ–¹MySQL 5.5ç‰ˆæœ¬æ˜¯ä¸æ”¯æŒå¹¶è¡Œå¤åˆ¶çš„ã€‚ä½†æ˜¯ï¼Œåœ¨2012å¹´çš„æ—¶å€™ï¼Œæˆ‘è‡ªå·±æœåŠ¡çš„ä¸šåŠ¡å‡ºç°äº†ä¸¥é‡çš„ä¸»å¤‡å»¶è¿Ÿï¼ŒåŸå› å°±æ˜¯å¤‡åº“åªæœ‰å•çº¿ç¨‹å¤åˆ¶ã€‚ç„¶åï¼Œæˆ‘å°±å…ˆåå†™äº†ä¸¤ä¸ªç‰ˆæœ¬çš„å¹¶è¡Œç­–ç•¥ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘ç»™ä½ ä»‹ç»ä¸€ä¸‹è¿™ä¸¤ä¸ªç‰ˆæœ¬çš„å¹¶è¡Œç­–ç•¥ï¼Œå³æŒ‰è¡¨åˆ†å‘ç­–ç•¥å’ŒæŒ‰è¡Œåˆ†å‘ç­–ç•¥ï¼Œä»¥å¸®åŠ©ä½ ç†è§£MySQLå®˜æ–¹ç‰ˆæœ¬å¹¶è¡Œå¤åˆ¶ç­–ç•¥çš„è¿­ä»£ã€‚</p><h3>æŒ‰è¡¨åˆ†å‘ç­–ç•¥</h3><p>æŒ‰è¡¨åˆ†å‘äº‹åŠ¡çš„åŸºæœ¬æ€è·¯æ˜¯ï¼Œå¦‚æœä¸¤ä¸ªäº‹åŠ¡æ›´æ–°ä¸åŒçš„è¡¨ï¼Œå®ƒä»¬å°±å¯ä»¥å¹¶è¡Œã€‚å› ä¸ºæ•°æ®æ˜¯å­˜å‚¨åœ¨è¡¨é‡Œçš„ï¼Œæ‰€ä»¥æŒ‰è¡¨åˆ†å‘ï¼Œå¯ä»¥ä¿è¯ä¸¤ä¸ªworkerä¸ä¼šæ›´æ–°åŒä¸€è¡Œã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœæœ‰è·¨è¡¨çš„äº‹åŠ¡ï¼Œè¿˜æ˜¯è¦æŠŠä¸¤å¼ è¡¨æ”¾åœ¨ä¸€èµ·è€ƒè™‘çš„ã€‚å¦‚å›¾3æ‰€ç¤ºï¼Œå°±æ˜¯æŒ‰è¡¨åˆ†å‘çš„è§„åˆ™ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/8b/76/8b6976fedd6e644022d4026581fb8d76.png?wh=1142*856\" alt=\"\"></p><center><span class=\"reference\">å›¾3 æŒ‰è¡¨å¹¶è¡Œå¤åˆ¶ç¨‹æ¨¡å‹</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸ªworkerçº¿ç¨‹å¯¹åº”ä¸€ä¸ªhashè¡¨ï¼Œç”¨äºä¿å­˜å½“å‰æ­£åœ¨è¿™ä¸ªworkerçš„â€œæ‰§è¡Œé˜Ÿåˆ—â€é‡Œçš„äº‹åŠ¡æ‰€æ¶‰åŠçš„è¡¨ã€‚hashè¡¨çš„keyæ˜¯â€œåº“å.è¡¨åâ€ï¼Œvalueæ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºé˜Ÿåˆ—ä¸­æœ‰å¤šå°‘ä¸ªäº‹åŠ¡ä¿®æ”¹è¿™ä¸ªè¡¨ã€‚</p><p>åœ¨æœ‰äº‹åŠ¡åˆ†é…ç»™workeræ—¶ï¼Œäº‹åŠ¡é‡Œé¢æ¶‰åŠçš„è¡¨ä¼šè¢«åŠ åˆ°å¯¹åº”çš„hashè¡¨ä¸­ã€‚workeræ‰§è¡Œå®Œæˆåï¼Œè¿™ä¸ªè¡¨ä¼šè¢«ä»hashè¡¨ä¸­å»æ‰ã€‚</p><p>å›¾3ä¸­ï¼Œhash_table_1è¡¨ç¤ºï¼Œç°åœ¨worker_1çš„â€œå¾…æ‰§è¡Œäº‹åŠ¡é˜Ÿåˆ—â€é‡Œï¼Œæœ‰4ä¸ªäº‹åŠ¡æ¶‰åŠåˆ°db1.t1è¡¨ï¼Œæœ‰1ä¸ªäº‹åŠ¡æ¶‰åŠåˆ°db2.t2è¡¨ï¼›hash_table_2è¡¨ç¤ºï¼Œç°åœ¨worker_2ä¸­æœ‰ä¸€ä¸ªäº‹åŠ¡ä¼šæ›´æ–°åˆ°è¡¨t3çš„æ•°æ®ã€‚</p><p>å‡è®¾åœ¨å›¾ä¸­çš„æƒ…å†µä¸‹ï¼Œcoordinatorä»ä¸­è½¬æ—¥å¿—ä¸­è¯»å…¥ä¸€ä¸ªæ–°äº‹åŠ¡Tï¼Œè¿™ä¸ªäº‹åŠ¡ä¿®æ”¹çš„è¡Œæ¶‰åŠåˆ°è¡¨t1å’Œt3ã€‚</p><p>ç°åœ¨æˆ‘ä»¬ç”¨äº‹åŠ¡Tçš„åˆ†é…æµç¨‹ï¼Œæ¥çœ‹ä¸€ä¸‹åˆ†é…è§„åˆ™ã€‚</p><ol>\n<li>\n<p>ç”±äºäº‹åŠ¡Tä¸­æ¶‰åŠä¿®æ”¹è¡¨t1ï¼Œè€Œworker_1é˜Ÿåˆ—ä¸­æœ‰äº‹åŠ¡åœ¨ä¿®æ”¹è¡¨t1ï¼Œäº‹åŠ¡Tå’Œé˜Ÿåˆ—ä¸­çš„æŸä¸ªäº‹åŠ¡è¦ä¿®æ”¹åŒä¸€ä¸ªè¡¨çš„æ•°æ®ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬è¯´äº‹åŠ¡Tå’Œworker_1æ˜¯å†²çªçš„ã€‚</p>\n</li>\n<li>\n<p>æŒ‰ç…§è¿™ä¸ªé€»è¾‘ï¼Œé¡ºåºåˆ¤æ–­äº‹åŠ¡Tå’Œæ¯ä¸ªworkeré˜Ÿåˆ—çš„å†²çªå…³ç³»ï¼Œä¼šå‘ç°äº‹åŠ¡Tè·Ÿworker_2ä¹Ÿå†²çªã€‚</p>\n</li>\n<li>\n<p>äº‹åŠ¡Tè·Ÿå¤šäºä¸€ä¸ªworkerå†²çªï¼Œcoordinatorçº¿ç¨‹å°±è¿›å…¥ç­‰å¾…ã€‚</p>\n</li>\n<li>\n<p>æ¯ä¸ªworkerç»§ç»­æ‰§è¡Œï¼ŒåŒæ—¶ä¿®æ”¹hash_tableã€‚å‡è®¾hash_table_2é‡Œé¢æ¶‰åŠåˆ°ä¿®æ”¹è¡¨t3çš„äº‹åŠ¡å…ˆæ‰§è¡Œå®Œæˆï¼Œå°±ä¼šä»hash_table_2ä¸­æŠŠdb1.t3è¿™ä¸€é¡¹å»æ‰ã€‚</p>\n</li>\n<li>\n<p>è¿™æ ·coordinatorä¼šå‘ç°è·Ÿäº‹åŠ¡Tå†²çªçš„workeråªæœ‰worker_1äº†ï¼Œå› æ­¤å°±æŠŠå®ƒåˆ†é…ç»™worker_1ã€‚</p>\n</li>\n<li>\n<p>coordinatorç»§ç»­è¯»ä¸‹ä¸€ä¸ªä¸­è½¬æ—¥å¿—ï¼Œç»§ç»­åˆ†é…äº‹åŠ¡ã€‚</p>\n</li>\n</ol><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªäº‹åŠ¡åœ¨åˆ†å‘çš„æ—¶å€™ï¼Œè·Ÿæ‰€æœ‰workerçš„å†²çªå…³ç³»åŒ…æ‹¬ä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š</p><ol>\n<li>\n<p>å¦‚æœè·Ÿæ‰€æœ‰workeréƒ½ä¸å†²çªï¼Œcoordinatorçº¿ç¨‹å°±ä¼šæŠŠè¿™ä¸ªäº‹åŠ¡åˆ†é…ç»™æœ€ç©ºé—²çš„woker;</p>\n</li>\n<li>\n<p>å¦‚æœè·Ÿå¤šäºä¸€ä¸ªworkerå†²çªï¼Œcoordinatorçº¿ç¨‹å°±è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°å’Œè¿™ä¸ªäº‹åŠ¡å­˜åœ¨å†²çªå…³ç³»çš„workeråªå‰©ä¸‹1ä¸ªï¼›</p>\n</li>\n<li>\n<p>å¦‚æœåªè·Ÿä¸€ä¸ªworkerå†²çªï¼Œcoordinatorçº¿ç¨‹å°±ä¼šæŠŠè¿™ä¸ªäº‹åŠ¡åˆ†é…ç»™è¿™ä¸ªå­˜åœ¨å†²çªå…³ç³»çš„workerã€‚</p>\n</li>\n</ol><p>è¿™ä¸ªæŒ‰è¡¨åˆ†å‘çš„æ–¹æ¡ˆï¼Œåœ¨å¤šä¸ªè¡¨è´Ÿè½½å‡åŒ€çš„åœºæ™¯é‡Œåº”ç”¨æ•ˆæœå¾ˆå¥½ã€‚ä½†æ˜¯ï¼Œå¦‚æœç¢°åˆ°çƒ­ç‚¹è¡¨ï¼Œæ¯”å¦‚æ‰€æœ‰çš„æ›´æ–°äº‹åŠ¡éƒ½ä¼šæ¶‰åŠåˆ°æŸä¸€ä¸ªè¡¨çš„æ—¶å€™ï¼Œæ‰€æœ‰äº‹åŠ¡éƒ½ä¼šè¢«åˆ†é…åˆ°åŒä¸€ä¸ªworkerä¸­ï¼Œå°±å˜æˆå•çº¿ç¨‹å¤åˆ¶äº†ã€‚</p><h3>æŒ‰è¡Œåˆ†å‘ç­–ç•¥</h3><p>è¦è§£å†³çƒ­ç‚¹è¡¨çš„å¹¶è¡Œå¤åˆ¶é—®é¢˜ï¼Œå°±éœ€è¦ä¸€ä¸ªæŒ‰è¡Œå¹¶è¡Œå¤åˆ¶çš„æ–¹æ¡ˆã€‚æŒ‰è¡Œå¤åˆ¶çš„æ ¸å¿ƒæ€è·¯æ˜¯ï¼šå¦‚æœä¸¤ä¸ªäº‹åŠ¡æ²¡æœ‰æ›´æ–°ç›¸åŒçš„è¡Œï¼Œå®ƒä»¬åœ¨å¤‡åº“ä¸Šå¯ä»¥å¹¶è¡Œæ‰§è¡Œã€‚æ˜¾ç„¶ï¼Œè¿™ä¸ªæ¨¡å¼è¦æ±‚binlogæ ¼å¼å¿…é¡»æ˜¯rowã€‚</p><p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬åˆ¤æ–­ä¸€ä¸ªäº‹åŠ¡Tå’Œworkeræ˜¯å¦å†²çªï¼Œç”¨çš„å°±è§„åˆ™å°±ä¸æ˜¯â€œä¿®æ”¹åŒä¸€ä¸ªè¡¨â€ï¼Œè€Œæ˜¯â€œä¿®æ”¹åŒä¸€è¡Œâ€ã€‚</p><p>æŒ‰è¡Œå¤åˆ¶å’ŒæŒ‰è¡¨å¤åˆ¶çš„æ•°æ®ç»“æ„å·®ä¸å¤šï¼Œä¹Ÿæ˜¯ä¸ºæ¯ä¸ªworkerï¼Œåˆ†é…ä¸€ä¸ªhashè¡¨ã€‚åªæ˜¯è¦å®ç°æŒ‰è¡Œåˆ†å‘ï¼Œè¿™æ—¶å€™çš„keyï¼Œå°±å¿…é¡»æ˜¯â€œåº“å+è¡¨å+å”¯ä¸€é”®çš„å€¼â€ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™ä¸ªâ€œå”¯ä¸€é”®â€åªæœ‰ä¸»é”®idè¿˜æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘ä¸‹é¢è¿™ç§åœºæ™¯ï¼Œè¡¨t1ä¸­é™¤äº†ä¸»é”®ï¼Œè¿˜æœ‰å”¯ä¸€ç´¢å¼•aï¼š</p><pre><code>CREATE TABLE `t1` (\n  `id` int(11) NOT NULL,\n  `a` int(11) DEFAULT NULL,\n  `b` int(11) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `a` (`a`)\n) ENGINE=InnoDB;\n\ninsert into t1 values(1,1,1),(2,2,2),(3,3,3),(4,4,4),(5,5,5);\n</code></pre><p>å‡è®¾ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦åœ¨ä¸»åº“æ‰§è¡Œè¿™ä¸¤ä¸ªäº‹åŠ¡ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/f1/78/f19916e27b8ff28e87ed3ad9f5473378.png?wh=937*149\" alt=\"\"></p><center><span class=\"reference\">å›¾4 å”¯ä¸€é”®å†²çªç¤ºä¾‹</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸¤ä¸ªäº‹åŠ¡è¦æ›´æ–°çš„è¡Œçš„ä¸»é”®å€¼ä¸åŒï¼Œä½†æ˜¯å¦‚æœå®ƒä»¬è¢«åˆ†åˆ°ä¸åŒçš„workerï¼Œå°±æœ‰å¯èƒ½session Bçš„è¯­å¥å…ˆæ‰§è¡Œã€‚è¿™æ—¶å€™id=1çš„è¡Œçš„açš„å€¼è¿˜æ˜¯1ï¼Œå°±ä¼šæŠ¥å”¯ä¸€é”®å†²çªã€‚</p><p>å› æ­¤ï¼ŒåŸºäºè¡Œçš„ç­–ç•¥ï¼Œäº‹åŠ¡hashè¡¨ä¸­è¿˜éœ€è¦è€ƒè™‘å”¯ä¸€é”®ï¼Œå³keyåº”è¯¥æ˜¯â€œåº“å+è¡¨å+ç´¢å¼•açš„åå­—+açš„å€¼â€ã€‚</p><p>æ¯”å¦‚ï¼Œåœ¨ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘è¦åœ¨è¡¨t1ä¸Šæ‰§è¡Œupdate t1 set a=1 where id=2è¯­å¥ï¼Œåœ¨binlogé‡Œé¢è®°å½•äº†æ•´è¡Œçš„æ•°æ®ä¿®æ”¹å‰å„ä¸ªå­—æ®µçš„å€¼ï¼Œå’Œä¿®æ”¹åå„ä¸ªå­—æ®µçš„å€¼ã€‚</p><p>å› æ­¤ï¼Œcoordinatoråœ¨è§£æè¿™ä¸ªè¯­å¥çš„binlogçš„æ—¶å€™ï¼Œè¿™ä¸ªäº‹åŠ¡çš„hashè¡¨å°±æœ‰ä¸‰ä¸ªé¡¹:</p><ol>\n<li>\n<p>key=hash_func(db1+t1+â€œPRIMARYâ€+2), value=2; è¿™é‡Œvalue=2æ˜¯å› ä¸ºä¿®æ”¹å‰åçš„è¡Œidå€¼ä¸å˜ï¼Œå‡ºç°äº†ä¸¤æ¬¡ã€‚</p>\n</li>\n<li>\n<p>key=hash_func(db1+t1+â€œaâ€+2), value=1ï¼Œè¡¨ç¤ºä¼šå½±å“åˆ°è¿™ä¸ªè¡¨a=2çš„è¡Œã€‚</p>\n</li>\n<li>\n<p>key=hash_func(db1+t1+â€œaâ€+1), value=1ï¼Œè¡¨ç¤ºä¼šå½±å“åˆ°è¿™ä¸ªè¡¨a=1çš„è¡Œã€‚</p>\n</li>\n</ol><p>å¯è§ï¼Œ<strong>ç›¸æ¯”äºæŒ‰è¡¨å¹¶è¡Œåˆ†å‘ç­–ç•¥ï¼ŒæŒ‰è¡Œå¹¶è¡Œç­–ç•¥åœ¨å†³å®šçº¿ç¨‹åˆ†å‘çš„æ—¶å€™ï¼Œéœ€è¦æ¶ˆè€—æ›´å¤šçš„è®¡ç®—èµ„æºã€‚</strong>ä½ å¯èƒ½ä¹Ÿå‘ç°äº†ï¼Œè¿™ä¸¤ä¸ªæ–¹æ¡ˆå…¶å®éƒ½æœ‰ä¸€äº›çº¦æŸæ¡ä»¶ï¼š</p><ol>\n<li>\n<p>è¦èƒ½å¤Ÿä»binlogé‡Œé¢è§£æå‡ºè¡¨åã€ä¸»é”®å€¼å’Œå”¯ä¸€ç´¢å¼•çš„å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸»åº“çš„binlogæ ¼å¼å¿…é¡»æ˜¯rowï¼›</p>\n</li>\n<li>\n<p>è¡¨å¿…é¡»æœ‰ä¸»é”®ï¼›</p>\n</li>\n<li>\n<p>ä¸èƒ½æœ‰å¤–é”®ã€‚è¡¨ä¸Šå¦‚æœæœ‰å¤–é”®ï¼Œçº§è”æ›´æ–°çš„è¡Œä¸ä¼šè®°å½•åœ¨binlogä¸­ï¼Œè¿™æ ·å†²çªæ£€æµ‹å°±ä¸å‡†ç¡®ã€‚</p>\n</li>\n</ol><p>ä½†ï¼Œå¥½åœ¨è¿™ä¸‰æ¡çº¦æŸè§„åˆ™ï¼Œæœ¬æ¥å°±æ˜¯DBAä¹‹å‰è¦æ±‚ä¸šåŠ¡å¼€å‘äººå‘˜å¿…é¡»éµå®ˆçš„çº¿ä¸Šä½¿ç”¨è§„èŒƒï¼Œæ‰€ä»¥è¿™ä¸¤ä¸ªå¹¶è¡Œå¤åˆ¶ç­–ç•¥åœ¨åº”ç”¨ä¸Šä¹Ÿæ²¡æœ‰ç¢°åˆ°ä»€ä¹ˆéº»çƒ¦ã€‚</p><p>å¯¹æ¯”æŒ‰è¡¨åˆ†å‘å’ŒæŒ‰è¡Œåˆ†å‘è¿™ä¸¤ä¸ªæ–¹æ¡ˆçš„è¯ï¼ŒæŒ‰è¡Œåˆ†å‘ç­–ç•¥çš„å¹¶è¡Œåº¦æ›´é«˜ã€‚ä¸è¿‡ï¼Œå¦‚æœæ˜¯è¦æ“ä½œå¾ˆå¤šè¡Œçš„å¤§äº‹åŠ¡çš„è¯ï¼ŒæŒ‰è¡Œåˆ†å‘çš„ç­–ç•¥æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol>\n<li>\n<p>è€—è´¹å†…å­˜ã€‚æ¯”å¦‚ä¸€ä¸ªè¯­å¥è¦åˆ é™¤100ä¸‡è¡Œæ•°æ®ï¼Œè¿™æ—¶å€™hashè¡¨å°±è¦è®°å½•100ä¸‡ä¸ªé¡¹ã€‚</p>\n</li>\n<li>\n<p>è€—è´¹CPUã€‚è§£æbinlogï¼Œç„¶åè®¡ç®—hashå€¼ï¼Œå¯¹äºå¤§äº‹åŠ¡ï¼Œè¿™ä¸ªæˆæœ¬è¿˜æ˜¯å¾ˆé«˜çš„ã€‚</p>\n</li>\n</ol><p>æ‰€ä»¥ï¼Œæˆ‘åœ¨å®ç°è¿™ä¸ªç­–ç•¥çš„æ—¶å€™ä¼šè®¾ç½®ä¸€ä¸ªé˜ˆå€¼ï¼Œå•ä¸ªäº‹åŠ¡å¦‚æœè¶…è¿‡è®¾ç½®çš„è¡Œæ•°é˜ˆå€¼ï¼ˆæ¯”å¦‚ï¼Œå¦‚æœå•ä¸ªäº‹åŠ¡æ›´æ–°çš„è¡Œæ•°è¶…è¿‡10ä¸‡è¡Œï¼‰ï¼Œå°±æš‚æ—¶é€€åŒ–ä¸ºå•çº¿ç¨‹æ¨¡å¼ï¼Œé€€åŒ–è¿‡ç¨‹çš„é€»è¾‘å¤§æ¦‚æ˜¯è¿™æ ·çš„ï¼š</p><ol>\n<li>\n<p>coordinatoræš‚æ—¶å…ˆholdä½è¿™ä¸ªäº‹åŠ¡ï¼›</p>\n</li>\n<li>\n<p>ç­‰å¾…æ‰€æœ‰workeréƒ½æ‰§è¡Œå®Œæˆï¼Œå˜æˆç©ºé˜Ÿåˆ—ï¼›</p>\n</li>\n<li>\n<p>coordinatorç›´æ¥æ‰§è¡Œè¿™ä¸ªäº‹åŠ¡ï¼›</p>\n</li>\n<li>\n<p>æ¢å¤å¹¶è¡Œæ¨¡å¼ã€‚</p>\n</li>\n</ol><p>è¯»åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½ä¼šæ„Ÿåˆ°å¥‡æ€ªï¼Œè¿™ä¸¤ä¸ªç­–ç•¥åˆæ²¡æœ‰è¢«åˆåˆ°å®˜æ–¹ï¼Œæˆ‘ä¸ºä»€ä¹ˆè¦ä»‹ç»è¿™ä¹ˆè¯¦ç»†å‘¢ï¼Ÿå…¶å®ï¼Œä»‹ç»è¿™ä¸¤ä¸ªç­–ç•¥çš„ç›®çš„æ˜¯æŠ›ç –å¼•ç‰ï¼Œæ–¹ä¾¿ä½ ç†è§£åé¢è¦ä»‹ç»çš„ç¤¾åŒºç‰ˆæœ¬ç­–ç•¥ã€‚</p><h1>MySQL 5.6ç‰ˆæœ¬çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥</h1><p>å®˜æ–¹MySQL5.6ç‰ˆæœ¬ï¼Œæ”¯æŒäº†å¹¶è¡Œå¤åˆ¶ï¼Œåªæ˜¯æ”¯æŒçš„ç²’åº¦æ˜¯æŒ‰åº“å¹¶è¡Œã€‚ç†è§£äº†ä¸Šé¢ä»‹ç»çš„æŒ‰è¡¨åˆ†å‘ç­–ç•¥å’ŒæŒ‰è¡Œåˆ†å‘ç­–ç•¥ï¼Œä½ å°±ç†è§£äº†ï¼Œç”¨äºå†³å®šåˆ†å‘ç­–ç•¥çš„hashè¡¨é‡Œï¼Œkeyå°±æ˜¯æ•°æ®åº“åã€‚</p><p>è¿™ä¸ªç­–ç•¥çš„å¹¶è¡Œæ•ˆæœï¼Œå–å†³äºå‹åŠ›æ¨¡å‹ã€‚å¦‚æœåœ¨ä¸»åº“ä¸Šæœ‰å¤šä¸ªDBï¼Œå¹¶ä¸”å„ä¸ªDBçš„å‹åŠ›å‡è¡¡ï¼Œä½¿ç”¨è¿™ä¸ªç­–ç•¥çš„æ•ˆæœä¼šå¾ˆå¥½ã€‚</p><p>ç›¸æ¯”äºæŒ‰è¡¨å’ŒæŒ‰è¡Œåˆ†å‘ï¼Œè¿™ä¸ªç­–ç•¥æœ‰ä¸¤ä¸ªä¼˜åŠ¿ï¼š</p><ol>\n<li>\n<p>æ„é€ hashå€¼çš„æ—¶å€™å¾ˆå¿«ï¼Œåªéœ€è¦åº“åï¼›è€Œä¸”ä¸€ä¸ªå®ä¾‹ä¸ŠDBæ•°ä¹Ÿä¸ä¼šå¾ˆå¤šï¼Œä¸ä¼šå‡ºç°éœ€è¦æ„é€ 100ä¸‡ä¸ªé¡¹è¿™ç§æƒ…å†µã€‚</p>\n</li>\n<li>\n<p>ä¸è¦æ±‚binlogçš„æ ¼å¼ã€‚å› ä¸ºstatementæ ¼å¼çš„binlogä¹Ÿå¯ä»¥å¾ˆå®¹æ˜“æ‹¿åˆ°åº“åã€‚</p>\n</li>\n</ol><p>ä½†æ˜¯ï¼Œå¦‚æœä½ çš„ä¸»åº“ä¸Šçš„è¡¨éƒ½æ”¾åœ¨åŒä¸€ä¸ªDBé‡Œé¢ï¼Œè¿™ä¸ªç­–ç•¥å°±æ²¡æœ‰æ•ˆæœäº†ï¼›æˆ–è€…å¦‚æœä¸åŒDBçš„çƒ­ç‚¹ä¸åŒï¼Œæ¯”å¦‚ä¸€ä¸ªæ˜¯ä¸šåŠ¡é€»è¾‘åº“ï¼Œä¸€ä¸ªæ˜¯ç³»ç»Ÿé…ç½®åº“ï¼Œé‚£ä¹Ÿèµ·ä¸åˆ°å¹¶è¡Œçš„æ•ˆæœã€‚</p><p>ç†è®ºä¸Šä½ å¯ä»¥åˆ›å»ºä¸åŒçš„DBï¼ŒæŠŠç›¸åŒçƒ­åº¦çš„è¡¨å‡åŒ€åˆ†åˆ°è¿™äº›ä¸åŒçš„DBä¸­ï¼Œå¼ºè¡Œä½¿ç”¨è¿™ä¸ªç­–ç•¥ã€‚ä¸è¿‡æ®æˆ‘æ‰€çŸ¥ï¼Œç”±äºéœ€è¦ç‰¹åœ°ç§»åŠ¨æ•°æ®ï¼Œè¿™ä¸ªç­–ç•¥ç”¨å¾—å¹¶ä¸å¤šã€‚</p><h1>MariaDBçš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥</h1><p>åœ¨<a href=\"https://time.geekbang.org/column/article/76161\">ç¬¬23ç¯‡æ–‡ç« </a>ä¸­ï¼Œæˆ‘ç»™ä½ ä»‹ç»äº†redo logç»„æäº¤(group commit)ä¼˜åŒ–ï¼Œ è€ŒMariaDBçš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥åˆ©ç”¨çš„å°±æ˜¯è¿™ä¸ªç‰¹æ€§ï¼š</p><ol>\n<li>\n<p>èƒ½å¤Ÿåœ¨åŒä¸€ç»„é‡Œæäº¤çš„äº‹åŠ¡ï¼Œä¸€å®šä¸ä¼šä¿®æ”¹åŒä¸€è¡Œï¼›</p>\n</li>\n<li>\n<p>ä¸»åº“ä¸Šå¯ä»¥å¹¶è¡Œæ‰§è¡Œçš„äº‹åŠ¡ï¼Œå¤‡åº“ä¸Šä¹Ÿä¸€å®šæ˜¯å¯ä»¥å¹¶è¡Œæ‰§è¡Œçš„ã€‚</p>\n</li>\n</ol><p>åœ¨å®ç°ä¸Šï¼ŒMariaDBæ˜¯è¿™ä¹ˆåšçš„ï¼š</p><ol>\n<li>\n<p>åœ¨ä¸€ç»„é‡Œé¢ä¸€èµ·æäº¤çš„äº‹åŠ¡ï¼Œæœ‰ä¸€ä¸ªç›¸åŒçš„commit_idï¼Œä¸‹ä¸€ç»„å°±æ˜¯commit_id+1ï¼›</p>\n</li>\n<li>\n<p>commit_idç›´æ¥å†™åˆ°binlogé‡Œé¢ï¼›</p>\n</li>\n<li>\n<p>ä¼ åˆ°å¤‡åº“åº”ç”¨çš„æ—¶å€™ï¼Œç›¸åŒcommit_idçš„äº‹åŠ¡åˆ†å‘åˆ°å¤šä¸ªworkeræ‰§è¡Œï¼›</p>\n</li>\n<li>\n<p>è¿™ä¸€ç»„å…¨éƒ¨æ‰§è¡Œå®Œæˆåï¼Œcoordinatorå†å»å–ä¸‹ä¸€æ‰¹ã€‚</p>\n</li>\n</ol><p>å½“æ—¶ï¼Œè¿™ä¸ªç­–ç•¥å‡ºæ¥çš„æ—¶å€™æ˜¯ç›¸å½“æƒŠè‰³çš„ã€‚å› ä¸ºï¼Œä¹‹å‰ä¸šç•Œçš„æ€è·¯éƒ½æ˜¯åœ¨â€œåˆ†æbinlogï¼Œå¹¶æ‹†åˆ†åˆ°workerâ€ä¸Šã€‚è€ŒMariaDBçš„è¿™ä¸ªç­–ç•¥ï¼Œç›®æ ‡æ˜¯â€œæ¨¡æ‹Ÿä¸»åº“çš„å¹¶è¡Œæ¨¡å¼â€ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™ä¸ªç­–ç•¥æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå®ƒå¹¶æ²¡æœ‰å®ç°â€œçœŸæ­£çš„æ¨¡æ‹Ÿä¸»åº“å¹¶å‘åº¦â€è¿™ä¸ªç›®æ ‡ã€‚åœ¨ä¸»åº“ä¸Šï¼Œä¸€ç»„äº‹åŠ¡åœ¨commitçš„æ—¶å€™ï¼Œä¸‹ä¸€ç»„äº‹åŠ¡æ˜¯åŒæ—¶å¤„äºâ€œæ‰§è¡Œä¸­â€çŠ¶æ€çš„ã€‚</p><p>å¦‚å›¾5æ‰€ç¤ºï¼Œå‡è®¾äº†ä¸‰ç»„äº‹åŠ¡åœ¨ä¸»åº“çš„æ‰§è¡Œæƒ…å†µï¼Œä½ å¯ä»¥çœ‹åˆ°åœ¨trx1ã€trx2å’Œtrx3æäº¤çš„æ—¶å€™ï¼Œtrx4ã€trx5å’Œtrx6æ˜¯åœ¨æ‰§è¡Œçš„ã€‚è¿™æ ·ï¼Œåœ¨ç¬¬ä¸€ç»„äº‹åŠ¡æäº¤å®Œæˆçš„æ—¶å€™ï¼Œä¸‹ä¸€ç»„äº‹åŠ¡å¾ˆå¿«å°±ä¼šè¿›å…¥commitçŠ¶æ€ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/8f/c3/8fec5fb48d6095aecc80016826efbfc3.png?wh=1142*856\" alt=\"\"></p><center><span class=\"reference\">å›¾5 ä¸»åº“å¹¶è¡Œäº‹åŠ¡</span></center><p>è€ŒæŒ‰ç…§MariaDBçš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥ï¼Œå¤‡åº“ä¸Šçš„æ‰§è¡Œæ•ˆæœå¦‚å›¾6æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/8a/22/8ac3799c1ff2f9833619a1624ca3e622.png?wh=1142*856\" alt=\"\"></p><center><span class=\"reference\">å›¾6 MariaDB å¹¶è¡Œå¤åˆ¶ï¼Œå¤‡åº“å¹¶è¡Œæ•ˆæœ</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å¤‡åº“ä¸Šæ‰§è¡Œçš„æ—¶å€™ï¼Œè¦ç­‰ç¬¬ä¸€ç»„äº‹åŠ¡å®Œå…¨æ‰§è¡Œå®Œæˆåï¼Œç¬¬äºŒç»„äº‹åŠ¡æ‰èƒ½å¼€å§‹æ‰§è¡Œï¼Œè¿™æ ·ç³»ç»Ÿçš„ååé‡å°±ä¸å¤Ÿã€‚</p><p>å¦å¤–ï¼Œè¿™ä¸ªæ–¹æ¡ˆå¾ˆå®¹æ˜“è¢«å¤§äº‹åŠ¡æ‹–åè…¿ã€‚å‡è®¾trx2æ˜¯ä¸€ä¸ªè¶…å¤§äº‹åŠ¡ï¼Œé‚£ä¹ˆåœ¨å¤‡åº“åº”ç”¨çš„æ—¶å€™ï¼Œtrx1å’Œtrx3æ‰§è¡Œå®Œæˆåï¼Œå°±åªèƒ½ç­‰trx2å®Œå…¨æ‰§è¡Œå®Œæˆï¼Œä¸‹ä¸€ç»„æ‰èƒ½å¼€å§‹æ‰§è¡Œã€‚è¿™æ®µæ—¶é—´ï¼Œåªæœ‰ä¸€ä¸ªworkerçº¿ç¨‹åœ¨å·¥ä½œï¼Œæ˜¯å¯¹èµ„æºçš„æµªè´¹ã€‚</p><p>ä¸è¿‡å³ä½¿å¦‚æ­¤ï¼Œè¿™ä¸ªç­–ç•¥ä»ç„¶æ˜¯ä¸€ä¸ªå¾ˆæ¼‚äº®çš„åˆ›æ–°ã€‚å› ä¸ºï¼Œå®ƒå¯¹åŸç³»ç»Ÿçš„æ”¹é€ éå¸¸å°‘ï¼Œå®ç°ä¹Ÿå¾ˆä¼˜é›…ã€‚</p><h1>MySQL 5.7çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥</h1><p>åœ¨MariaDBå¹¶è¡Œå¤åˆ¶å®ç°ä¹‹åï¼Œå®˜æ–¹çš„MySQL5.7ç‰ˆæœ¬ä¹Ÿæä¾›äº†ç±»ä¼¼çš„åŠŸèƒ½ï¼Œç”±å‚æ•°slave-parallel-typeæ¥æ§åˆ¶å¹¶è¡Œå¤åˆ¶ç­–ç•¥ï¼š</p><ol>\n<li>\n<p>é…ç½®ä¸ºDATABASEï¼Œè¡¨ç¤ºä½¿ç”¨MySQL 5.6ç‰ˆæœ¬çš„æŒ‰åº“å¹¶è¡Œç­–ç•¥ï¼›</p>\n</li>\n<li>\n<p>é…ç½®ä¸º LOGICAL_CLOCKï¼Œè¡¨ç¤ºçš„å°±æ˜¯ç±»ä¼¼MariaDBçš„ç­–ç•¥ã€‚ä¸è¿‡ï¼ŒMySQL 5.7è¿™ä¸ªç­–ç•¥ï¼Œé’ˆå¯¹å¹¶è¡Œåº¦åšäº†ä¼˜åŒ–ã€‚è¿™ä¸ªä¼˜åŒ–çš„æ€è·¯ä¹Ÿå¾ˆæœ‰è¶£å„¿ã€‚</p>\n</li>\n</ol><p>ä½ å¯ä»¥å…ˆè€ƒè™‘è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šåŒæ—¶å¤„äºâ€œæ‰§è¡ŒçŠ¶æ€â€çš„æ‰€æœ‰äº‹åŠ¡ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥å¹¶è¡Œï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯ï¼Œä¸èƒ½ã€‚</p><p>å› ä¸ºï¼Œè¿™é‡Œé¢å¯èƒ½æœ‰ç”±äºé”å†²çªè€Œå¤„äºé”ç­‰å¾…çŠ¶æ€çš„äº‹åŠ¡ã€‚å¦‚æœè¿™äº›äº‹åŠ¡åœ¨å¤‡åº“ä¸Šè¢«åˆ†é…åˆ°ä¸åŒçš„workerï¼Œå°±ä¼šå‡ºç°å¤‡åº“è·Ÿä¸»åº“ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p><p>è€Œä¸Šé¢æåˆ°çš„MariaDBè¿™ä¸ªç­–ç•¥çš„æ ¸å¿ƒï¼Œæ˜¯â€œæ‰€æœ‰å¤„äºcommitâ€çŠ¶æ€çš„äº‹åŠ¡å¯ä»¥å¹¶è¡Œã€‚äº‹åŠ¡å¤„äºcommitçŠ¶æ€ï¼Œè¡¨ç¤ºå·²ç»é€šè¿‡äº†é”å†²çªçš„æ£€éªŒäº†ã€‚</p><p>è¿™æ—¶å€™ï¼Œä½ å¯ä»¥å†å›é¡¾ä¸€ä¸‹ä¸¤é˜¶æ®µæäº¤ï¼Œæˆ‘æŠŠå‰é¢<a href=\"https://time.geekbang.org/column/article/76161\">ç¬¬23ç¯‡æ–‡ç« </a>ä¸­ä»‹ç»è¿‡çš„ä¸¤é˜¶æ®µæäº¤è¿‡ç¨‹å›¾è´´è¿‡æ¥ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/5a/28/5ae7d074c34bc5bd55c82781de670c28.png?wh=1142*1522\" alt=\"\"></p><center><span class=\"reference\">å›¾7 ä¸¤é˜¶æ®µæäº¤ç»†åŒ–è¿‡ç¨‹å›¾</span></center><p>å…¶å®ï¼Œä¸ç”¨ç­‰åˆ°commité˜¶æ®µï¼Œåªè¦èƒ½å¤Ÿåˆ°è¾¾redo log prepareé˜¶æ®µï¼Œå°±è¡¨ç¤ºäº‹åŠ¡å·²ç»é€šè¿‡é”å†²çªçš„æ£€éªŒäº†ã€‚</p><p>å› æ­¤ï¼ŒMySQL 5.7å¹¶è¡Œå¤åˆ¶ç­–ç•¥çš„æ€æƒ³æ˜¯ï¼š</p><ol>\n<li>\n<p>åŒæ—¶å¤„äºprepareçŠ¶æ€çš„äº‹åŠ¡ï¼Œåœ¨å¤‡åº“æ‰§è¡Œæ—¶æ˜¯å¯ä»¥å¹¶è¡Œçš„ï¼›</p>\n</li>\n<li>\n<p>å¤„äºprepareçŠ¶æ€çš„äº‹åŠ¡ï¼Œä¸å¤„äºcommitçŠ¶æ€çš„äº‹åŠ¡ä¹‹é—´ï¼Œåœ¨å¤‡åº“æ‰§è¡Œæ—¶ä¹Ÿæ˜¯å¯ä»¥å¹¶è¡Œçš„ã€‚</p>\n</li>\n</ol><p>æˆ‘åœ¨ç¬¬23ç¯‡æ–‡ç« ï¼Œè®²binlogçš„ç»„æäº¤çš„æ—¶å€™ï¼Œä»‹ç»è¿‡ä¸¤ä¸ªå‚æ•°ï¼š</p><ol>\n<li>\n<p>binlog_group_commit_sync_delayå‚æ•°ï¼Œè¡¨ç¤ºå»¶è¿Ÿå¤šå°‘å¾®ç§’åæ‰è°ƒç”¨fsync;</p>\n</li>\n<li>\n<p>binlog_group_commit_sync_no_delay_countå‚æ•°ï¼Œè¡¨ç¤ºç´¯ç§¯å¤šå°‘æ¬¡ä»¥åæ‰è°ƒç”¨fsyncã€‚</p>\n</li>\n</ol><p>è¿™ä¸¤ä¸ªå‚æ•°æ˜¯ç”¨äºæ•…æ„æ‹‰é•¿binlogä»writeåˆ°fsyncçš„æ—¶é—´ï¼Œä»¥æ­¤å‡å°‘binlogçš„å†™ç›˜æ¬¡æ•°ã€‚åœ¨MySQL 5.7çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥é‡Œï¼Œå®ƒä»¬å¯ä»¥ç”¨æ¥åˆ¶é€ æ›´å¤šçš„â€œåŒæ—¶å¤„äºprepareé˜¶æ®µçš„äº‹åŠ¡â€ã€‚è¿™æ ·å°±å¢åŠ äº†å¤‡åº“å¤åˆ¶çš„å¹¶è¡Œåº¦ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸¤ä¸ªå‚æ•°ï¼Œæ—¢å¯ä»¥â€œæ•…æ„â€è®©ä¸»åº“æäº¤å¾—æ…¢äº›ï¼Œåˆå¯ä»¥è®©å¤‡åº“æ‰§è¡Œå¾—å¿«äº›ã€‚åœ¨MySQL 5.7å¤„ç†å¤‡åº“å»¶è¿Ÿçš„æ—¶å€™ï¼Œå¯ä»¥è€ƒè™‘è°ƒæ•´è¿™ä¸¤ä¸ªå‚æ•°å€¼ï¼Œæ¥è¾¾åˆ°æå‡å¤‡åº“å¤åˆ¶å¹¶å‘åº¦çš„ç›®çš„ã€‚</p><h1>MySQL 5.7.22çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥</h1><p>åœ¨2018å¹´4æœˆä»½å‘å¸ƒçš„MySQL 5.7.22ç‰ˆæœ¬é‡Œï¼ŒMySQLå¢åŠ äº†ä¸€ä¸ªæ–°çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥ï¼ŒåŸºäºWRITESETçš„å¹¶è¡Œå¤åˆ¶ã€‚</p><p>ç›¸åº”åœ°ï¼Œæ–°å¢äº†ä¸€ä¸ªå‚æ•°binlog-transaction-dependency-trackingï¼Œç”¨æ¥æ§åˆ¶æ˜¯å¦å¯ç”¨è¿™ä¸ªæ–°ç­–ç•¥ã€‚è¿™ä¸ªå‚æ•°çš„å¯é€‰å€¼æœ‰ä»¥ä¸‹ä¸‰ç§ã€‚</p><ol>\n<li>\n<p>COMMIT_ORDERï¼Œè¡¨ç¤ºçš„å°±æ˜¯å‰é¢ä»‹ç»çš„ï¼Œæ ¹æ®åŒæ—¶è¿›å…¥prepareå’Œcommitæ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥å¹¶è¡Œçš„ç­–ç•¥ã€‚</p>\n</li>\n<li>\n<p>WRITESETï¼Œè¡¨ç¤ºçš„æ˜¯å¯¹äºäº‹åŠ¡æ¶‰åŠæ›´æ–°çš„æ¯ä¸€è¡Œï¼Œè®¡ç®—å‡ºè¿™ä¸€è¡Œçš„hashå€¼ï¼Œç»„æˆé›†åˆwritesetã€‚å¦‚æœä¸¤ä¸ªäº‹åŠ¡æ²¡æœ‰æ“ä½œç›¸åŒçš„è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬çš„writesetæ²¡æœ‰äº¤é›†ï¼Œå°±å¯ä»¥å¹¶è¡Œã€‚</p>\n</li>\n<li>\n<p>WRITESET_SESSIONï¼Œæ˜¯åœ¨WRITESETçš„åŸºç¡€ä¸Šå¤šäº†ä¸€ä¸ªçº¦æŸï¼Œå³åœ¨ä¸»åº“ä¸ŠåŒä¸€ä¸ªçº¿ç¨‹å…ˆåæ‰§è¡Œçš„ä¸¤ä¸ªäº‹åŠ¡ï¼Œåœ¨å¤‡åº“æ‰§è¡Œçš„æ—¶å€™ï¼Œè¦ä¿è¯ç›¸åŒçš„å…ˆåé¡ºåºã€‚</p>\n</li>\n</ol><p>å½“ç„¶ä¸ºäº†å”¯ä¸€æ ‡è¯†ï¼Œè¿™ä¸ªhashå€¼æ˜¯é€šè¿‡â€œåº“å+è¡¨å+ç´¢å¼•å+å€¼â€è®¡ç®—å‡ºæ¥çš„ã€‚å¦‚æœä¸€ä¸ªè¡¨ä¸Šé™¤äº†æœ‰ä¸»é”®ç´¢å¼•å¤–ï¼Œè¿˜æœ‰å…¶ä»–å”¯ä¸€ç´¢å¼•ï¼Œé‚£ä¹ˆå¯¹äºæ¯ä¸ªå”¯ä¸€ç´¢å¼•ï¼Œinsertè¯­å¥å¯¹åº”çš„writesetå°±è¦å¤šå¢åŠ ä¸€ä¸ªhashå€¼ã€‚</p><p>ä½ å¯èƒ½çœ‹å‡ºæ¥äº†ï¼Œè¿™è·Ÿæˆ‘ä»¬å‰é¢ä»‹ç»çš„åŸºäºMySQL 5.5ç‰ˆæœ¬çš„æŒ‰è¡Œåˆ†å‘çš„ç­–ç•¥æ˜¯å·®ä¸å¤šçš„ã€‚ä¸è¿‡ï¼ŒMySQLå®˜æ–¹çš„è¿™ä¸ªå®ç°è¿˜æ˜¯æœ‰å¾ˆå¤§çš„ä¼˜åŠ¿ï¼š</p><ol>\n<li>\n<p>writesetæ˜¯åœ¨ä¸»åº“ç”Ÿæˆåç›´æ¥å†™å…¥åˆ°binlogé‡Œé¢çš„ï¼Œè¿™æ ·åœ¨å¤‡åº“æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸éœ€è¦è§£æbinlogå†…å®¹ï¼ˆeventé‡Œçš„è¡Œæ•°æ®ï¼‰ï¼ŒèŠ‚çœäº†å¾ˆå¤šè®¡ç®—é‡ï¼›</p>\n</li>\n<li>\n<p>ä¸éœ€è¦æŠŠæ•´ä¸ªäº‹åŠ¡çš„binlogéƒ½æ‰«ä¸€éæ‰èƒ½å†³å®šåˆ†å‘åˆ°å“ªä¸ªworkerï¼Œæ›´çœå†…å­˜ï¼›</p>\n</li>\n<li>\n<p>ç”±äºå¤‡åº“çš„åˆ†å‘ç­–ç•¥ä¸ä¾èµ–äºbinlogå†…å®¹ï¼Œæ‰€ä»¥binlogæ˜¯statementæ ¼å¼ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p>\n</li>\n</ol><p>å› æ­¤ï¼ŒMySQL 5.7.22çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥åœ¨é€šç”¨æ€§ä¸Šè¿˜æ˜¯æœ‰ä¿è¯çš„ã€‚</p><p>å½“ç„¶ï¼Œå¯¹äºâ€œè¡¨ä¸Šæ²¡ä¸»é”®â€å’Œâ€œå¤–é”®çº¦æŸâ€çš„åœºæ™¯ï¼ŒWRITESETç­–ç•¥ä¹Ÿæ˜¯æ²¡æ³•å¹¶è¡Œçš„ï¼Œä¹Ÿä¼šæš‚æ—¶é€€åŒ–ä¸ºå•çº¿ç¨‹æ¨¡å‹ã€‚</p><h1>å°ç»“</h1><p>åœ¨ä»Šå¤©è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å’Œä½ ä»‹ç»äº†MySQLçš„å„ç§å¤šçº¿ç¨‹å¤åˆ¶ç­–ç•¥ã€‚</p><p>ä¸ºä»€ä¹ˆè¦æœ‰å¤šçº¿ç¨‹å¤åˆ¶å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºå•çº¿ç¨‹å¤åˆ¶çš„èƒ½åŠ›å…¨é¢ä½äºå¤šçº¿ç¨‹å¤åˆ¶ï¼Œå¯¹äºæ›´æ–°å‹åŠ›è¾ƒå¤§çš„ä¸»åº“ï¼Œå¤‡åº“æ˜¯å¯èƒ½ä¸€ç›´è¿½ä¸ä¸Šä¸»åº“çš„ã€‚ä»ç°è±¡ä¸Šçœ‹å°±æ˜¯ï¼Œå¤‡åº“ä¸Šseconds_behind_masterçš„å€¼è¶Šæ¥è¶Šå¤§ã€‚</p><p>åœ¨ä»‹ç»å®Œæ¯ä¸ªå¹¶è¡Œå¤åˆ¶ç­–ç•¥åï¼Œæˆ‘è¿˜å’Œä½ åˆ†äº«äº†ä¸åŒç­–ç•¥çš„ä¼˜ç¼ºç‚¹ï¼š</p><ul>\n<li>å¦‚æœä½ æ˜¯DBAï¼Œå°±éœ€è¦æ ¹æ®ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼Œé€‰æ‹©ä¸åŒçš„ç­–ç•¥ï¼›</li>\n<li>å¦‚æœæ˜¯ä½ ä¸šåŠ¡å¼€å‘äººå‘˜ï¼Œä¹Ÿå¸Œæœ›ä½ èƒ½ä»ä¸­è·å–çµæ„Ÿç”¨åˆ°å¹³æ—¶çš„å¼€å‘å·¥ä½œä¸­ã€‚</li>\n</ul><p>ä»è¿™äº›åˆ†æä¸­ï¼Œä½ ä¹Ÿä¼šå‘ç°å¤§äº‹åŠ¡ä¸ä»…ä¼šå½±å“åˆ°ä¸»åº“ï¼Œä¹Ÿæ˜¯é€ æˆå¤‡åº“å¤åˆ¶å»¶è¿Ÿçš„ä¸»è¦åŸå› ä¹‹ä¸€ã€‚å› æ­¤ï¼Œåœ¨å¹³æ—¶çš„å¼€å‘å·¥ä½œä¸­ï¼Œæˆ‘å»ºè®®ä½ å°½é‡å‡å°‘å¤§äº‹åŠ¡æ“ä½œï¼ŒæŠŠå¤§äº‹åŠ¡æ‹†æˆå°äº‹åŠ¡ã€‚</p><p>å®˜æ–¹MySQL5.7ç‰ˆæœ¬æ–°å¢çš„å¤‡åº“å¹¶è¡Œç­–ç•¥ï¼Œä¿®æ”¹äº†binlogçš„å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¯´binlogåè®®å¹¶ä¸æ˜¯å‘ä¸Šå…¼å®¹çš„ï¼Œåœ¨ä¸»å¤‡åˆ‡æ¢ã€ç‰ˆæœ¬å‡çº§çš„æ—¶å€™éœ€è¦æŠŠè¿™ä¸ªå› ç´ ä¹Ÿè€ƒè™‘è¿›å»ã€‚</p><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸‹ä¸€ä¸ªæ€è€ƒé¢˜å§ã€‚</p><p>å‡è®¾ä¸€ä¸ªMySQL 5.7.22ç‰ˆæœ¬çš„ä¸»åº“ï¼Œå•çº¿ç¨‹æ’å…¥äº†å¾ˆå¤šæ•°æ®ï¼Œè¿‡äº†3ä¸ªå°æ—¶åï¼Œæˆ‘ä»¬è¦ç»™è¿™ä¸ªä¸»åº“æ­å»ºä¸€ä¸ªç›¸åŒç‰ˆæœ¬çš„å¤‡åº“ã€‚</p><p>è¿™æ—¶å€™ï¼Œä½ ä¸ºäº†æ›´å¿«åœ°è®©å¤‡åº“è¿½ä¸Šä¸»åº“ï¼Œè¦å¼€å¹¶è¡Œå¤åˆ¶ã€‚åœ¨binlog-transaction-dependency-trackingå‚æ•°çš„COMMIT_ORDERã€WRITESETå’ŒWRITE_SESSIONè¿™ä¸‰ä¸ªå–å€¼ä¸­ï¼Œä½ ä¼šé€‰æ‹©å“ªä¸€ä¸ªå‘¢ï¼Ÿ</p><p>ä½ é€‰æ‹©çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿå¦‚æœè®¾ç½®å¦å¤–ä¸¤ä¸ªå‚æ•°ï¼Œä½ è®¤ä¸ºä¼šå‡ºç°ä»€ä¹ˆç°è±¡å‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„ç­”æ¡ˆå’Œåˆ†æå†™åœ¨è¯„è®ºåŒºï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« è·Ÿä½ è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h1>ä¸ŠæœŸé—®é¢˜æ—¶é—´</h1><p>ä¸ŠæœŸçš„é—®é¢˜æ˜¯ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ï¼Œå¤‡åº“çš„ä¸»å¤‡å»¶è¿Ÿä¼šè¡¨ç°ä¸ºä¸€ä¸ª45åº¦çš„çº¿æ®µï¼Ÿè¯„è®ºåŒºæœ‰ä¸å°‘åŒå­¦çš„å›å¤éƒ½è¯´åˆ°äº†é‡ç‚¹ï¼šå¤‡åº“çš„åŒæ­¥åœ¨è¿™æ®µæ—¶é—´å®Œå…¨è¢«å µä½äº†ã€‚</p><p>äº§ç”Ÿè¿™ç§ç°è±¡å…¸å‹çš„åœºæ™¯ä¸»è¦åŒ…æ‹¬ä¸¤ç§ï¼š</p><ul>\n<li>ä¸€ç§æ˜¯å¤§äº‹åŠ¡ï¼ˆåŒ…æ‹¬å¤§è¡¨DDLã€ä¸€ä¸ªäº‹åŠ¡æ“ä½œå¾ˆå¤šè¡Œï¼‰ï¼›</li>\n<li>è¿˜æœ‰ä¸€ç§æƒ…å†µæ¯”è¾ƒéšè”½ï¼Œå°±æ˜¯å¤‡åº“èµ·äº†ä¸€ä¸ªé•¿äº‹åŠ¡ï¼Œæ¯”å¦‚</li>\n</ul><pre><code>begin; \nselect * from t limit 1;\n</code></pre><p>ç„¶åå°±ä¸åŠ¨äº†ã€‚</p><p>è¿™æ—¶å€™ä¸»åº“å¯¹è¡¨tåšäº†ä¸€ä¸ªåŠ å­—æ®µæ“ä½œï¼Œå³ä½¿è¿™ä¸ªè¡¨å¾ˆå°ï¼Œè¿™ä¸ªDDLåœ¨å¤‡åº“åº”ç”¨çš„æ—¶å€™ä¹Ÿä¼šè¢«å µä½ï¼Œä¹Ÿä¸èƒ½çœ‹åˆ°è¿™ä¸ªç°è±¡ã€‚</p><p>è¯„è®ºåŒºè¿˜æœ‰åŒå­¦è¯´æ˜¯ä¸æ˜¯ä¸»åº“å¤šçº¿ç¨‹ã€ä»åº“å•çº¿ç¨‹ï¼Œå¤‡åº“è·Ÿä¸ä¸Šä¸»åº“çš„æ›´æ–°èŠ‚å¥å¯¼è‡´çš„ï¼Ÿä»Šå¤©è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬åˆšå¥½è®²çš„æ˜¯å¹¶è¡Œå¤åˆ¶ã€‚æ‰€ä»¥ï¼Œä½ çŸ¥é“äº†ï¼Œè¿™ç§æƒ…å†µä¼šå¯¼è‡´ä¸»å¤‡å»¶è¿Ÿï¼Œä½†ä¸ä¼šè¡¨ç°ä¸ºè¿™ç§æ ‡å‡†çš„å‘ˆ45åº¦çš„ç›´çº¿ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote>\n<p>@æ˜“ç¿” ã€ @ä¸‡å‹‡ã€@è€æ¨åŒå¿— ç­‰åŒå­¦çš„å›å¤éƒ½æåˆ°äº†æˆ‘ä»¬ä¸Šé¢è¯´çš„åœºæ™¯ï¼›</p>\n</blockquote><blockquote>\n<p>@Max åŒå­¦æäº†ä¸€ä¸ªå¾ˆä¸é”™çš„é—®é¢˜ã€‚ä¸»å¤‡å…³ç³»é‡Œé¢ï¼Œå¤‡åº“ä¸»åŠ¨è¿æ¥ï¼Œä¹‹åçš„binlogå‘é€æ˜¯ä¸»åº“ä¸»åŠ¨æ¨é€çš„ã€‚ä¹‹æ‰€ä»¥è¿™ä¹ˆè®¾è®¡ä¹Ÿæ˜¯ä¸ºäº†æ•ˆç‡å’Œå®æ—¶æ€§è€ƒè™‘ï¼Œæ¯•ç«Ÿé å¤‡åº“è½®è¯¢ï¼Œä¼šæœ‰æ—¶é—´å·®ã€‚</p>\n</blockquote><p></p>","comments":[{"had_liked":false,"id":58687,"user_name":"è€æ¨åŒå¿—","can_delete":false,"product_type":"c1","uid":1246199,"ip_address":"","ucode":"3F334F0CFD3DE6","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/f7/3a493bec.jpg","comment_is_top":true,"comment_ctime":1547175471,"is_pvip":false,"replies":[{"id":"21216","content":"ğŸ‘ï¼Œä½ æ¯”æˆ‘å›å¤å¾—è¯¦ç»†ï¼Œé¡¶èµ·","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547178695,"ip_address":"","comment_id":58687,"utype":1}],"discussion_count":5,"race_medal":0,"score":"9.2233725065533993e+18","product_id":100020801,"comment_content":"å°è¯•å›ç­” æ…§é‘«coming çš„é—®é¢˜ã€‚<br>è€å¸ˆå›¾ç‰‡çš„æ­¥éª¤æœ‰ä¸‹é¢5æ­¥<br>1 redo log prepare write<br>2 binlog write<br>3 redo log prepare fsync<br>4 binlog fsync<br>5 redo log commit write<br><br>1)å¦‚æœæ›´æ–°é€šä¸€æ¡è®°å½•æ˜¯æœ‰é”çš„ï¼Œåªèƒ½ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œï¼Œå…¶ä»–äº‹åŠ¡ç­‰å¾…é”ã€‚<br><br>2)ç¬¬4æ­¥çš„æ—¶å€™ä¼šå› ä¸ºä¸‹é¢ä¸¤ä¸ªå‚æ•°ï¼Œç­‰å…¶ä»–æ²¡æœ‰é”å†²çªçš„äº‹åŠ¡ï¼Œä¸€èµ·åˆ·ç›˜ï¼Œæ­¤æ—¶ä¸€èµ·æ‰§è¡Œçš„äº‹åŠ¡æ‹¥æœ‰ç›¸åŒçš„commit_id<br>binlog_group_commit_sync_delay<br>binlog_group_commit_sync_no_delay_count<br><br>3)æ‰§è¡Œæ­¥éª¤5åï¼Œé‡Šæ”¾é”ï¼Œç­‰å¾…é”çš„äº‹åŠ¡å¼€å§‹æ‰§è¡Œã€‚<br><br>æ‰€ä»¥å¯¹åŒä¸€è¡Œæ›´æ–°çš„äº‹åŠ¡ï¼Œä¸å¯èƒ½æ‹¥æœ‰ç›¸åŒçš„commit_id","like_count":110,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436174,"discussion_content":"ğŸ‘ï¼Œä½ æ¯”æˆ‘å›å¤å¾—è¯¦ç»†ï¼Œé¡¶èµ·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547178695,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1691436,"avatar":"https://static001.geekbang.org/account/avatar/00/19/cf/2c/be133cdf.jpg","nickname":"tank","note":"","ucode":"256553A4C09ABF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":316711,"discussion_content":"[root@centos7-mysql5 ~]# mysqlbinlog -vv /data/mysql_log/binlog.000130 --start-position=2014116   --stop-position=2014627\n# at 2014116\n#201022 23:29:47 server id 3306  end_log_pos 2014181 CRC32 0xaff15d6c   GTID    last_committed=2194     sequence_number=2195         rbr_only=yes\n/*!50718 SET TRANSACTION ISOLATION LEVEL READ COMMITTED*//*!*/;\nSET @@SESSION.GTID_NEXT= &#39;c5714948-edc3-11ea-990b-000c29f0ee9b:55954&#39;/*!*/;\n# at 2014181\n#201022 23:29:41 server id 3306  end_log_pos 2014258 CRC32 0xda15f77b   Query   thread_id=1115  exec_time=0     error_code=0\nSET TIMESTAMP=1603423781/*!*/;\nSET @@session.pseudo_thread_id=1115/*!*/;\nSET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/*!*/;\nSET @@session.sql_mode=1436549152/*!*/;\nSET @@session.auto_increment_increment=2, @@session.auto_increment_offset=1/*!*/;\n/*!\\C utf8 *//*!*/;\nSET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=8/*!*/;\nSET @@session.lc_time_names=0/*!*/;\nSET @@session.collation_database=DEFAULT/*!*/;\nBEGIN\n/*!*/;\n# at 2014258\n#201022 23:29:41 server id 3306  end_log_pos 2014315 CRC32 0x41a95e75   Rows_query\n# update t_iso set d=d+1 where id=0\n# at 2014315\n#201022 23:29:41 server id 3306  end_log_pos 2014365 CRC32 0x80d7b705   Table_map: `test`.`t_iso` mapped to number 165\n# at 2014365\n#201022 23:29:41 server id 3306  end_log_pos 2014427 CRC32 0xb048cac9   Update_rows: table id 165 flags: STMT_END_F\n\n#201022 23:29:44 server id 3306  end_log_pos 2014484 CRC32 0x453a0d33   Rows_query\n# update t_iso set d=d+2 where id=0\n# at 2014484\n#201022 23:29:44 server id 3306  end_log_pos 2014534 CRC32 0x2527a2ca   Table_map: `test`.`t_iso` mapped to number 165\n# at 2014534\n#201022 23:29:44 server id 3306  end_log_pos 2014596 CRC32 0x28d61a11   Update_rows: table id 165 flags: STMT_END_F\n#201022 23:29:47 server id 3306  end_log_pos 2014627 CRC32 0x3a8264c6   Xid = 366367\nCOMMIT/*!*/;","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603443795,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1691436,"avatar":"https://static001.geekbang.org/account/avatar/00/19/cf/2c/be133cdf.jpg","nickname":"tank","note":"","ucode":"256553A4C09ABF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":316555,"discussion_content":"è€å¸ˆï¼Œä¸ºä»€ä¹ˆæˆ‘RR/RCéš”ç¦»çº§åˆ«æµ‹è¯•åŒä¸€ä¸ªäº‹åŠ¡2æ¬¡æ›´æ–°åŒä¸€è¡Œéƒ½æˆåŠŸäº†ï¼Œè€Œä¸”æ˜¯åŒä¸€ä¸ªcommit_id?\n\nCREATE TABLE `t` ( `id` int(11) NOT NULL, `c` int(11) DEFAULT NULL, `d` int(11) DEFAULT NULL, PRIMARY KEY (`id`), KEY `c` (`c`)) ENGINE=InnoDB;insert into t values(0,0,0),(5,5,5),(10,10,10),(15,15,15),(20,20,20),(25,25,25);\n\nroot@localhost:[test] 23:29:34>begin;\nroot@localhost:[test] 23:29:36>update t_iso set d=d+1 where id=0;\nroot@localhost:[test] 23:29:41>update t_iso set d=d+2 where id=0;\nroot@localhost:[test] 23:29:44>commit;\nQuery OK, 0 rows affected (0.00 sec)\nç”±äºæ— æ³•æˆªå›¾ï¼Œshow binlog events in &#39;binlog.000130&#39; from 2014116 limit 9;  ç»“æœå¦‚ä¸‹ï¼š\nroot@localhost:[test] 23:54:39>show binlog events in &#39;binlog.000130&#39; from 2014116 limit 9;\nbinlog.000130 | 2014116 | Gtid           |      3306 |     2014181 | SET @@SESSION.GTID_NEXT= &#39;c5714948-edc3-11ea-990b-000c29f0ee9b:55954&#39;\nbinlog.000130 | 2014181 | Query          |      3306 |     2014258 | BEGIN\nbinlog.000130 | 2014258 | Rows_query     |      3306 |     2014315 | # update t_iso set d=d+1 where id=0\nbinlog.000130 | 2014484 | Table_map      |      3306 |     2014534 | table_id: 165 (test.t_iso)\nbinlog.000130 | 2014365 | Update_rows    |      3306 |     2014427 | table_id: 165 flags: STMT_END_F\nbinlog.000130 | 2014427 | Rows_query     |      3306 |     2014484 | # update t_iso set d=d+2 where id=0\nbinlog.000130 | 2014484 | Table_map      |      3306 |     2014534 | table_id: 165 (test.t_iso)\nbinlog.000130 | 2014534 | Update_rows    |      3306 |     2014596 | table_id: 165 flags: STMT_END_F\nbinlog.000130 | 2014596 | Xid            |      3306 |     2014627 | COMMIT /* xid=366367 */","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603425353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1970443,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIx1V1QAxC4NHaxYZGyuibBN8lcURJWc5nrnO4yic1kxnDemYV2FJGialf47kYX9qtDnZZOfe1SJeLicg/132","nickname":"lleft","note":"","ucode":"D573EB509455AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1691436,"avatar":"https://static001.geekbang.org/account/avatar/00/19/cf/2c/be133cdf.jpg","nickname":"tank","note":"","ucode":"256553A4C09ABF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375176,"discussion_content":"å¯¹åŒä¸€è¡Œæ›´æ–°çš„ä¸åŒäº‹åŠ¡ï¼Œä¸æ˜¯ä¸€ä¸ªäº‹åŠ¡é‡Œé¢å¤šæ¡SQLæ›´æ–°åŒä¸€è¡Œ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1621501788,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":316555,"ip_address":""},"score":375176,"extra":""},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1691436,"avatar":"https://static001.geekbang.org/account/avatar/00/19/cf/2c/be133cdf.jpg","nickname":"tank","note":"","ucode":"256553A4C09ABF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":561417,"discussion_content":"é”çš„å¯é‡å…¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649638521,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":316555,"ip_address":""},"score":561417,"extra":""}]}]},{"had_liked":false,"id":58692,"user_name":"é•¿æ°","can_delete":false,"product_type":"c1","uid":1312212,"ip_address":"","ucode":"DD52C9494005F7","user_header":"https://static001.geekbang.org/account/avatar/00/14/05/d4/e06bf86d.jpg","comment_is_top":true,"comment_ctime":1547176658,"is_pvip":false,"replies":[{"id":"21217","content":"åº”è¯¥æ˜¯è¯´ï¼Œå®ƒè¿Ÿæ—©è¦commitï¼Œä½†æ˜¯ä¸¤ä¸ªworkeræ˜¯ä¸¤ä¸ªçº¿ç¨‹ï¼Œæ²¡åŠæ³•çº¦å¥½â€œåŒæ—¶æäº¤â€ï¼Œè¿™æ ·å°±æœ‰å¯èƒ½å‡ºç°ä¸€ä¸ªå…ˆæäº¤ä¸€ä¸ªåæäº¤ã€‚<br>è¿™ä¸¤ä¸ªæäº¤ä¹‹é—´çš„æ—¶é—´å·®ï¼Œå°±èƒ½è¢«ç”¨æˆ·çœ‹åˆ°â€œä¸€åŠäº‹åŠ¡â€ï¼Œå¥½é—®é¢˜<br>","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547178902,"ip_address":"","comment_id":58692,"utype":1}],"discussion_count":12,"race_medal":0,"score":"9.2233722488553001e+18","product_id":100020801,"comment_content":"ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªäº‹åŠ¡æ›´æ–°äº†è¡¨ t1 å’Œè¡¨ t2 ä¸­çš„å„ä¸€è¡Œï¼Œå¦‚æœè¿™ä¸¤æ¡æ›´æ–°è¯­å¥è¢«åˆ†åˆ°ä¸åŒ worker çš„è¯ï¼Œè™½ç„¶æœ€ç»ˆçš„ç»“æœæ˜¯ä¸»å¤‡ä¸€è‡´çš„ï¼Œä½†å¦‚æœè¡¨ t1 æ‰§è¡Œå®Œæˆçš„ç¬é—´ï¼Œå¤‡åº“ä¸Šæœ‰ä¸€ä¸ªæŸ¥è¯¢ï¼Œå°±ä¼šçœ‹åˆ°è¿™ä¸ªäº‹åŠ¡â€œæ›´æ–°äº†ä¸€åŠçš„ç»“æœâ€ï¼Œç ´åäº†äº‹åŠ¡é€»è¾‘çš„åŸå­æ€§ã€‚<br><br>è€å¸ˆè¿™å—ä¸å¤ªæ˜ç™½ï¼Œå¤‡åº“æœ‰æŸ¥è¯¢ä¼šçœ‹åˆ°æ›´æ–°äº†ä¸€åŠçš„ç»“æœï¼Œt1çš„workeræ‰§è¡Œå®Œäº†æ›´æ–°ä¼šcommitå—ï¼Ÿå¦‚æœä¸commitï¼Œå¤‡åº“æŸ¥è¯¢åº”è¯¥çœ‹ä¸åˆ°å§ï¼Ÿå¦‚æœcommitï¼Œå°±ç ´åäº†äº‹ç‰©çš„åŸå­æ€§ï¼Œè‚¯å®šæ˜¯æœ‰é—®é¢˜çš„ã€‚","like_count":50,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436175,"discussion_content":"åº”è¯¥æ˜¯è¯´ï¼Œå®ƒè¿Ÿæ—©è¦commitï¼Œä½†æ˜¯ä¸¤ä¸ªworkeræ˜¯ä¸¤ä¸ªçº¿ç¨‹ï¼Œæ²¡åŠæ³•çº¦å¥½â€œåŒæ—¶æäº¤â€ï¼Œè¿™æ ·å°±æœ‰å¯èƒ½å‡ºç°ä¸€ä¸ªå…ˆæäº¤ä¸€ä¸ªåæäº¤ã€‚\nè¿™ä¸¤ä¸ªæäº¤ä¹‹é—´çš„æ—¶é—´å·®ï¼Œå°±èƒ½è¢«ç”¨æˆ·çœ‹åˆ°â€œä¸€åŠäº‹åŠ¡â€ï¼Œå¥½é—®é¢˜\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547178902,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1155646,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKotsBr2icbYNYlRSlicGUD1H7lulSTQUAiclsEz9gnG5kCW9qeDwdYtlRMXic3V6sj9UrfKLPJnQojag/132","nickname":"ppd0705","note":"","ucode":"EB63D4E3FD1E9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":277036,"discussion_content":"å¹¶è¡Œå¤åˆ¶çš„æœ€å°ç²’åº¦åº”è¯¥æ˜¯äº‹åŠ¡å§ï¼Ÿ","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1590986968,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":2377275,"avatar":"https://static001.geekbang.org/account/avatar/00/24/46/3b/ac4b8ab0.jpg","nickname":"Streamä¸Šçš„å¸§","note":"","ucode":"325FBEFF80BD91","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1155646,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKotsBr2icbYNYlRSlicGUD1H7lulSTQUAiclsEz9gnG5kCW9qeDwdYtlRMXic3V6sj9UrfKLPJnQojag/132","nickname":"ppd0705","note":"","ucode":"EB63D4E3FD1E9A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336896,"discussion_content":"æŒ‰äº‹åŠ¡ä¸èƒ½åˆ†å‘ï¼Œå¦‚æœä¸¤ä¸ªäº‹åŠ¡æ›´æ–°åŒä¸€è¡Œï¼Œæ­¤æ—¶å°±ä¼šå‡ºç°é¡ºåºçš„ä¸ç¡®å®šæ€§ï¼Œè¿›è€Œå¯¼è‡´ä¸»å¤‡çš„æ•°æ®ä¸ä¸€è‡´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608726622,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":277036,"ip_address":""},"score":336896,"extra":""},{"author":{"id":1633316,"avatar":"https://static001.geekbang.org/account/avatar/00/18/ec/24/6bceb24c.jpg","nickname":"å­å­å­å­å­åº·","note":"","ucode":"0B475582C30D25","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2377275,"avatar":"https://static001.geekbang.org/account/avatar/00/24/46/3b/ac4b8ab0.jpg","nickname":"Streamä¸Šçš„å¸§","note":"","ucode":"325FBEFF80BD91","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553791,"discussion_content":"åˆ©ç”¨ç»„æäº¤ï¼Œä¸å¯èƒ½å­˜åœ¨ä¿®æ”¹åŒä¸€è¡Œçš„2ä¸ªäº‹åŠ¡å§ï¼Ÿå¦ä¸€ä¸ªäº‹åŠ¡åº”è¯¥è·å–ä¸åˆ°é”é˜»å¡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646096478,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":336896,"ip_address":""},"score":553791,"extra":""}]},{"author":{"id":1210699,"avatar":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","nickname":"-W.LI-","note":"","ucode":"3556786538664F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":9747,"discussion_content":"å¤§ä½¬ä½ è¿™ä¹ˆä¸€é—®æˆ‘ä¹Ÿçº³é—·äº†ï¼Œæˆ‘ä»¥ä¸ºä»binlogè¯»è¿‡æ¥çš„æ•°æ®ä¹Ÿä¼šæœ‰mvccæ”¯æŒå¿«ç…§è¯»ã€‚ã€‚ã€‚è¿™ä¹ˆè¯´æ˜¯æ²¡æœ‰çš„å–½","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1568211409,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"è‰¿è‰¿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1210699,"avatar":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","nickname":"-W.LI-","note":"","ucode":"3556786538664F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":38936,"discussion_content":"ä»åº“æœ‰å»¶è¿Ÿï¼Œè¿™å°±æ³¨å®šäº†æ˜¯ä¸ªä¸å‡†ç¡®çš„æ•°æ®æºäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571848029,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":9747,"ip_address":""},"score":38936,"extra":""}]},{"author":{"id":1586404,"avatar":"https://static001.geekbang.org/account/avatar/00/18/34/e4/4450c053.jpg","nickname":"å››å‘³ç³–","note":"","ucode":"6648BACBF1CFEA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":359864,"discussion_content":"ä¸¤ä¸ªworkerè¦ä¿è¯ä¸€èµ·æäº¤é‚£å°±æ˜¯åˆ†å¸ƒå¼äº‹åŠ¡äº†ï¼Œç°åœ¨mysqlä¸æ”¯æŒå§ï¼ŒTiDBæ˜¯åˆ†å¸ƒå¼çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616308782,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1541014,"avatar":"https://static001.geekbang.org/account/avatar/00/17/83/96/73ff13a0.jpg","nickname":"å¤©äº®å‰è¯´æ™šå®‰","note":"","ucode":"1D82EE562A7C71","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":186929,"discussion_content":"æˆ‘å¾ˆè¯§å¼‚æ˜¯ä¸ºå•¥ä¸ç›´æ¥æŠŠä¸»åº“çš„è¯­å¥é€è¿‡æ¥æ‰§è¡Œå•Šï¼Ÿç±»ä¼¼äºå†™ä¸¤ä¸ªåº“ï¼Œåªæ˜¯å†™å¤‡åº“çš„æ“ä½œæ˜¯ä¸»åº“åšçš„ï¼Œè¿™æ ·ä¸å°±å¯ä»¥åšåˆ°å’Œä¸»åº“ä¸€æ ·å—ï¼Ÿä¸è¿‡è¿™æ ·çš„è¯ï¼Œå¤‡åº“çš„æœºå™¨æ€§èƒ½è¦é«˜äºä¸»åº“æ‰åˆç†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582721461,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1904762,"avatar":"","nickname":"åˆ˜æ˜æ˜","note":"","ucode":"202F0552168DF5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1541014,"avatar":"https://static001.geekbang.org/account/avatar/00/17/83/96/73ff13a0.jpg","nickname":"å¤©äº®å‰è¯´æ™šå®‰","note":"","ucode":"1D82EE562A7C71","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":284851,"discussion_content":"binlogæ˜¯statementæ ¼å¼ï¼Œå°±æ˜¯ç›¸å½“æ‰§è¡Œä¸»åº“çš„è¯­å¥ã€‚è¿™ç§æ–¹å¼ä¹Ÿè¦è€ƒè™‘è®©å®ƒå¹¶å‘å†™ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592660720,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":186929,"ip_address":""},"score":284851,"extra":""},{"author":{"id":2377275,"avatar":"https://static001.geekbang.org/account/avatar/00/24/46/3b/ac4b8ab0.jpg","nickname":"Streamä¸Šçš„å¸§","note":"","ucode":"325FBEFF80BD91","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1541014,"avatar":"https://static001.geekbang.org/account/avatar/00/17/83/96/73ff13a0.jpg","nickname":"å¤©äº®å‰è¯´æ™šå®‰","note":"","ucode":"1D82EE562A7C71","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336901,"discussion_content":"å•çº¿ç¨‹çš„å¤„ç†å°±æ˜¯ä½ è¯´çš„é‚£ç§å¤„ç†æ–¹å¼ï¼Œè¿½æ±‚æ›´åŠ æè‡´çš„æ€§èƒ½å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608726745,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":186929,"ip_address":""},"score":336901,"extra":""},{"author":{"id":1541014,"avatar":"https://static001.geekbang.org/account/avatar/00/17/83/96/73ff13a0.jpg","nickname":"å¤©äº®å‰è¯´æ™šå®‰","note":"","ucode":"1D82EE562A7C71","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2377275,"avatar":"https://static001.geekbang.org/account/avatar/00/24/46/3b/ac4b8ab0.jpg","nickname":"Streamä¸Šçš„å¸§","note":"","ucode":"325FBEFF80BD91","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338438,"discussion_content":"å¯¹ï¼Œå¤šçº¿ç¨‹çš„ç¡®ä¼šæœ‰é—®é¢˜ã€‚æˆ‘è§‰å¾—å¯ä»¥è€ƒè™‘äº‹ç‰©è¿›è¡Œæ‰“åŒ…å°±è¿˜å¥½äº†ï¼Œä¸è¿‡ä¹Ÿè¦è€ƒè™‘å€¼è¦†ç›–é¡ºåºä¸ä¸€è‡´å¸¦æ¥çš„æ•°æ®ä¸ä¸€è‡´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609291348,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":336901,"ip_address":""},"score":338438,"extra":""}]}]},{"had_liked":false,"id":60753,"user_name":"jike","can_delete":false,"product_type":"c1","uid":1304913,"ip_address":"","ucode":"83CB61A1F0FFA1","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKAerblVqBONYuFvJN6EVhjeGuFSvbrS73sHOhm1OhwJFg05o266icOibdhdks1bAwn2kcpltnEmibIA/132","comment_is_top":true,"comment_ctime":1547542927,"is_pvip":false,"replies":[{"id":"21672","content":"æ˜¯æœ‰å¯èƒ½binlog eventå†™å…¥é¡ºåºä¸åŒçš„ï¼Œå¥½é—®é¢˜","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547552002,"ip_address":"","comment_id":60753,"utype":1}],"discussion_count":6,"race_medal":0,"score":"9.2233721629564006e+18","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œå¼€å¯å¹¶è¡Œå¤åˆ¶åï¼Œäº‹åŠ¡æ˜¯æŒ‰ç…§ç»„æ¥æäº¤çš„ï¼Œä»åº“ä¹Ÿæ˜¯æ ¹æ®commit_idæ¥å›æ”¾ï¼Œå¦‚æœä»åº“ä¹Ÿå¼€å¯binlogçš„è¯ï¼Œé‚£æ˜¯ä¸æ˜¯å­˜åœ¨ä¸»ä»çš„binlog  eventå†™å…¥é¡ºåºä¸ä¸€è‡´çš„æƒ…å†µå‘¢ï¼Ÿ","like_count":30,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436609,"discussion_content":"æ˜¯æœ‰å¯èƒ½binlog eventå†™å…¥é¡ºåºä¸åŒçš„ï¼Œå¥½é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547552002,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1937062,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/8e/a6/c3286b61.jpg","nickname":"Javaå’å¢™å·¥ç¨‹å¸ˆ","note":"","ucode":"E76AE44A9C76AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306224,"discussion_content":"å¤šçº¿ç¨‹æå‡æ€§èƒ½å¯¼è‡´é¡ºåºä¸åŒï¼Œå„ç§ç­–ç•¥ä¿è¯äº†æœ€ç»ˆç»“æœæ˜¯ä¸€è‡´çš„","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1600223412,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":167325,"discussion_content":"è™½ç„¶ç»„äº‹åŠ¡æäº¤çš„å†™å…¥é¡ºåºä¸åŒï¼Œä½†æ˜¯ä¸å½±å“æ•°æ®çš„å…ˆåé¡ºåºã€‚ä¸»å¤‡æ•°æ®è¿˜æ˜¯ä¸€è‡´çš„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1581477864,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2389270,"avatar":"https://static001.geekbang.org/account/avatar/00/24/75/16/6e28bf17.jpg","nickname":"åˆæ™¨","note":"","ucode":"C5D95D13E49127","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590307,"discussion_content":"å¯èƒ½å‡ºç°é¡ºåºä¸ä¸€è‡´ï¼Œä½†æœ€ç»ˆä¿è¯ä¸€è‡´æ€§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665649673,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"é™•è¥¿"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1320050,"avatar":"https://static001.geekbang.org/account/avatar/00/14/24/72/9e2a651c.jpg","nickname":"å®¶æœ‰é‚¹å¤ª","note":"","ucode":"5636BD37EB1A99","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":395169,"discussion_content":"æœ‰ä¸ªcommit_orderå‚æ•°å¯ä»¥æ§åˆ¶å¤‡åº“æŒ‰ç…§ä¸»åº“æäº¤çš„é¡ºåºè¿›è¡Œæäº¤ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632269117,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1320050,"avatar":"https://static001.geekbang.org/account/avatar/00/14/24/72/9e2a651c.jpg","nickname":"å®¶æœ‰é‚¹å¤ª","note":"","ucode":"5636BD37EB1A99","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537750,"discussion_content":"commit_order ä¹Ÿä¸æ˜¯æ§åˆ¶æŒ‰ç…§ä¸»åº“æäº¤é¡ºåºçš„ã€‚åªæ˜¯æŒ‰ç…§åŒæ—¶å¤„äºâ€œprepareé˜¶æ®µâ€çš„äº‹åŠ¡ï¼Œéƒ½å¹¶è¡Œæ‰§è¡Œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639152097,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":395169,"ip_address":""},"score":537750,"extra":""}]}]},{"had_liked":false,"id":58988,"user_name":"HuaMax","can_delete":false,"product_type":"c1","uid":1118488,"ip_address":"","ucode":"2E78DE1AF098AF","user_header":"https://static001.geekbang.org/account/avatar/00/11/11/18/8cee35f9.jpg","comment_is_top":false,"comment_ctime":1547266333,"is_pvip":false,"replies":[{"id":"21349","content":"å‡†ç¡®ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547269179,"ip_address":"","comment_id":58988,"utype":1}],"discussion_count":6,"race_medal":0,"score":"353734584605","product_id":100020801,"comment_content":"è¯¾åé¢˜ã€‚å…³é”®ç‚¹åœ¨äºä¸»åº“å•çº¿ç¨‹ï¼Œé’ˆå¯¹ä¸‰ç§ä¸åŒçš„ç­–ç•¥ï¼ŒCOMMIT_ORDERï¼šæ²¡æœ‰åŒæ—¶åˆ°è¾¾redo logçš„prepare çŠ¶æ€çš„äº‹åŠ¡ï¼Œå¤‡åº“é€€åŒ–ä¸ºå•çº¿ç¨‹ï¼›WRITESETï¼šé€šè¿‡å¯¹æ¯”æ›´æ–°çš„äº‹åŠ¡æ˜¯å¦å­˜åœ¨å†²çªçš„è¡Œï¼Œå¯ä»¥å¹¶å‘æ‰§è¡Œï¼›WRITE_SESSIONï¼šåœ¨WRITESETçš„åŸºç¡€ä¸Šå¢åŠ äº†çº¿ç¨‹çš„çº¦æŸï¼Œåˆ™é€€åŒ–ä¸ºå•çº¿ç¨‹ã€‚ç»¼ä¸Šï¼Œåº”é€‰æ‹©WRITESETç­–ç•¥","like_count":83,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436267,"discussion_content":"å‡†ç¡®ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547269179,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"æˆ’é…’çš„æç™½","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":408938,"discussion_content":"å¤§ä½¬ç‰›é€¼ï¼Œåˆ†æå¾ˆé€å½»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635345173,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1111175,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f4/87/644c0c5d.jpg","nickname":"ä¿Šä¼Ÿ","note":"","ucode":"7905B4F25637F4","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":261843,"discussion_content":"ä¸€ä¸ªçº¿ç¨‹å¯¹åŒä¸€è¡Œè‚¯å®šæ˜¯é¡ºåºä¿®æ”¹çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589013940,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1541014,"avatar":"https://static001.geekbang.org/account/avatar/00/17/83/96/73ff13a0.jpg","nickname":"å¤©äº®å‰è¯´æ™šå®‰","note":"","ucode":"1D82EE562A7C71","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":186970,"discussion_content":"æˆ‘æƒ³é—®çš„æ˜¯çº¿ç¨‹çº¦æŸæœ‰å•¥æ„ä¹‰å•Šï¼Ÿåº”è¯¥æ˜¯åŒä¸€è¡Œçš„ä¿®æ”¹å¿…é¡»é¡ºåºä¸€è‡´æ‰æœ‰æ„ä¹‰å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582722665,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":2036333,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/6ZM5RHVBe8pVGoibpPHVM5TZTbqS4u4ckiaHoItk1LIhTfCEYbH7LYiaWJDvTiaga34MQQ3xicIZ0vsAkoSKRvY8F3A/132","nickname":"Geek_b4bb35","note":"","ucode":"257EE15A137445","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1541014,"avatar":"https://static001.geekbang.org/account/avatar/00/17/83/96/73ff13a0.jpg","nickname":"å¤©äº®å‰è¯´æ™šå®‰","note":"","ucode":"1D82EE562A7C71","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373926,"discussion_content":"åœ¨ä¿è¯æœ€ç»ˆä¸€è‡´æ€§çš„æƒ…å†µä¸‹ï¼Œä¸šåŠ¡ä¾§ä¹Ÿå¯èƒ½ä¼šæ ¹æ®ä¸åŒäº‹åŠ¡åœ¨å®¢æˆ·ç«¯æ˜¾ç¤ºçš„ä¼˜å…ˆçº§æ¥è¦æ±‚é¡ºåºæ€§","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1620916818,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":186970,"ip_address":""},"score":373926,"extra":""},{"author":{"id":2389270,"avatar":"https://static001.geekbang.org/account/avatar/00/24/75/16/6e28bf17.jpg","nickname":"åˆæ™¨","note":"","ucode":"C5D95D13E49127","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1541014,"avatar":"https://static001.geekbang.org/account/avatar/00/17/83/96/73ff13a0.jpg","nickname":"å¤©äº®å‰è¯´æ™šå®‰","note":"","ucode":"1D82EE562A7C71","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590310,"discussion_content":"è¿™é‡Œå­˜åœ¨è¿™æ ·çš„æƒ…å†µï¼Œé¿å…å‡ºç°å”¯ä¸€é”®å†²çªã€‚ è¡¨t id ä¸»é”®ï¼Œaæ˜¯å”¯ä¸€é”®ã€‚sessionA  æ›´æ”¹id=1,a=1 ï¼Œè®¾ç½®a=6 ;session B æ›´æ”¹id=2 a=2 è®¾ç½®a=1 ã€‚ è¿™é‡Œå…ˆAåBæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œè‹¥Bå…ˆæ‰§è¡Œï¼Œå°±ä¼šå‡ºç°å”¯ä¸€é”®å†²çªã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665649951,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":186970,"ip_address":"é™•è¥¿"},"score":590310,"extra":""}]}]},{"had_liked":false,"id":59560,"user_name":"æ¯å¤©æ™’ç™½ç‰™","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1547385589,"is_pvip":false,"replies":[{"id":"21416","content":"è¿™å‡ ç¯‡åæ·±ï¼Œä½†ç¡®å®æ˜¯å¤§å®¶åœ¨ä½¿ç”¨çš„æ—¶å€™éœ€è¦äº†è§£çš„ï¼Œ<br>åˆ°30ç¯‡åé¢çš„æ–‡ç« ä¼šååº”ç”¨å“ˆ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547394206,"ip_address":"","comment_id":59560,"utype":1}],"discussion_count":15,"race_medal":1,"score":"212000783093","product_id":100020801,"comment_content":"æˆ‘æ˜¯åšjavaçš„ï¼Œçœ‹è€å¸ˆçš„è¿™ä¸ªä¸“æ ï¼Œç¡®å®æŒºåƒåŠ›çš„ï¼Œè€å¸ˆä¸“æ çš„å¹²è´§å¤ªå¤šäº†ï¼Œä¸‹é¢çš„ç•™è¨€ä¹Ÿæ˜¯ç›¸å½“æœ‰æ°´å¹³ï¼Œè´¨é‡éƒ½å¾ˆé«˜ï¼Œäº’åŠ¨ä¹Ÿå¥½ï¼Œåº”è¯¥æ˜¯å¥½å¤šDBAå§ï¼Œåšjavaçš„æˆ‘ï¼Œçœ‹çš„å¤´å¤§","like_count":50,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436355,"discussion_content":"è¿™å‡ ç¯‡åæ·±ï¼Œä½†ç¡®å®æ˜¯å¤§å®¶åœ¨ä½¿ç”¨çš„æ—¶å€™éœ€è¦äº†è§£çš„ï¼Œ\nåˆ°30ç¯‡åé¢çš„æ–‡ç« ä¼šååº”ç”¨å“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547394206,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"è‰¿è‰¿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":38766,"discussion_content":"åŒæ³ªæµæ»¡é¢ã€‚ã€‚ã€‚\n\nå±äºï¼Œçœ‹å®Œæ–‡ç« ï¼Œè€å¸ˆå¥½ç‰›é€¼ã€‚\nçœ‹åˆ°è¯„è®ºï¼Œè‡ªå·±æ˜¯ä¸ªæ™ºéšœå„¿ç«¥ã€‚","likes_number":25,"is_delete":false,"is_hidden":false,"ctime":1571831813,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1590610,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/B9vSOjMc2a86kYA8R5yDkVdFiaj2JeBZ1PuI9oUKhbnvuZwuibdUam6FTcGzDaiaFdk2GWJveUGhfCVpv4KaOdicoQ/132","nickname":"å¸æ±Ÿ","note":"","ucode":"93CBA4E4D05DA5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1044546,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/42/7728d4f5.jpg","nickname":"è‰¿è‰¿","note":"","ucode":"8F727AB7A7F6B2","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":353524,"discussion_content":"æ„Ÿè§‰è¯„è®ºåŒºå¥½å¤šç•™çº§çš„.ä¸æ˜¯æˆ‘ä»¬æ–°ç”Ÿèƒ½æ¯”çš„.","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1615169787,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":38766,"ip_address":""},"score":353524,"extra":""}]},{"author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walleæ–Œ","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295988,"discussion_content":"æˆ‘æ„Ÿè§‰ä¹Ÿå¯ä»¥ï¼Œåšä¸šåŠ¡çš„èƒ½å¤Ÿäº†è§£åŸç†è¿˜æ˜¯å¥½çš„ï¼Œæ¥¼ä¸»è¿™ä¹ˆè¯´å¯èƒ½æ˜¯çœ‹å…¶ä»–ä¸­é—´ä»¶çš„æºç åŸç†å°‘ä¸€äº›ï¼Œmysqlçš„å¾ˆå¤šç©æ³•ï¼Œä¸­é—´ä»¶æ˜¯é€šç”¨çš„ï¼Œå»ºè®®çœ‹ä¸‹redis mqç›¸å…³çš„åŸç†ï¼Œä¼šå‘ç°ï¼Œå…¶å®å·®ä¸å¤šå•¦ï¼Œæ— éæ˜¯ä¸€äº›ç»†èŠ‚çš„è§„å®šå•¥çš„ æœ‰æ‰€åŒºåˆ«ã€‚","likes_number":10,"is_delete":false,"is_hidden":false,"ctime":1596422069,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1110677,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f2/95/538d0348.jpg","nickname":"wrp000000","note":"","ucode":"4860119F2276FE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walleæ–Œ","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":305447,"discussion_content":"åŒæ„Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599923830,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":295988,"ip_address":""},"score":305447,"extra":""}]},{"author":{"id":1120596,"avatar":"https://static001.geekbang.org/account/avatar/00/11/19/54/4341f5b7.jpg","nickname":"æ•æ•","note":"","ucode":"28C8E8899F74D8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":23720,"discussion_content":"æˆ‘æ„Ÿè§‰ç†è§£èµ·æ¥è¿˜å¥½å§ï¼Œæˆ‘ä¹Ÿæ˜¯åšJavaçš„","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1569862180,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1257299,"avatar":"https://static001.geekbang.org/account/avatar/00/13/2f/53/f17cfee2.jpg","nickname":"Z","note":"","ucode":"8E56D0618F1B76","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377541,"discussion_content":"ç†è§£èµ·æ¥è¿˜è¡Œï¼Œå°±æ˜¯è®°ä¸ä½ï¼Œè¯´ä¸å‡ºæ¥","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1622704115,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1264707,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4c/43/150c70c2.jpg","nickname":"é™ˆæ¾Plus","note":"","ucode":"0074BDECFA3D1D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334233,"discussion_content":"åŒæ˜¯javaï¼Œæ³ªæµæ»¡é¢ï½","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1607774039,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2726571,"avatar":"https://static001.geekbang.org/account/avatar/00/29/9a/ab/12b2dc2c.jpg","nickname":"è’æµ·é£æ²«","note":"","ucode":"B152C65A78C3D0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":401077,"discussion_content":"ä¿ºä¹Ÿä¸€æ ·ï¼Œä¸è¿‡å¤šçœ‹å‡ éï¼Œå¤šåŠ¨æ‰‹å®æ“åº”è¯¥ä¼šå¥½ç‚¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633533077,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1586404,"avatar":"https://static001.geekbang.org/account/avatar/00/18/34/e4/4450c053.jpg","nickname":"å››å‘³ç³–","note":"","ucode":"6648BACBF1CFEA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":359868,"discussion_content":"phperè¡¨ç¤ºè€å¸ˆè®²çš„é€šä¿—æ˜“æ‡‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616309107,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1207410,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqXSb2jAzlMM0JdTjWrNiaq2uR9eeloBYp906POddb9evmuj5f4CUoO6ge8TibibwtZicnl1sRHic9rW7g/132","nickname":"ç´«æ—¥","note":"","ucode":"73A8DEE323AC19","race_medal":4,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":313853,"discussion_content":"åŒæ„Ÿï¼Œä¹°äº†å¥½ä¹…ï¼Œæ„Ÿè§‰çœ‹ä¸è¿›å»ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603099433,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1590610,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/B9vSOjMc2a86kYA8R5yDkVdFiaj2JeBZ1PuI9oUKhbnvuZwuibdUam6FTcGzDaiaFdk2GWJveUGhfCVpv4KaOdicoQ/132","nickname":"å¸æ±Ÿ","note":"","ucode":"93CBA4E4D05DA5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1207410,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqXSb2jAzlMM0JdTjWrNiaq2uR9eeloBYp906POddb9evmuj5f4CUoO6ge8TibibwtZicnl1sRHic9rW7g/132","nickname":"ç´«æ—¥","note":"","ucode":"73A8DEE323AC19","race_medal":4,"user_type":1,"is_pvip":true},"discussion":{"id":353523,"discussion_content":"æˆ‘æ˜¯php.ä¸€èµ·åŠ æ²¹.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615169742,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":313853,"ip_address":""},"score":353523,"extra":""}]},{"author":{"id":1937062,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/8e/a6/c3286b61.jpg","nickname":"Javaå’å¢™å·¥ç¨‹å¸ˆ","note":"","ucode":"E76AE44A9C76AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306225,"discussion_content":"åŒæ„Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600223639,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":167329,"discussion_content":"æˆ‘æ˜¯åšC#çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581477946,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1015754,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","nickname":"helloworld","note":"","ucode":"00DF2FEC58D2E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":96785,"discussion_content":"é€šé“ä¼—äººå•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577092719,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":59397,"user_name":"æŸã€äºº","can_delete":false,"product_type":"c1","uid":1308784,"ip_address":"","ucode":"ADB42AA12A11C1","user_header":"https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg","comment_is_top":false,"comment_ctime":1547363052,"is_pvip":false,"replies":[{"id":"21414","content":"ä¸Šé¢çš„æè¿°éƒ¨åˆ†ï¼Œwritesetçš„å¤šçº¿ç¨‹å¤åˆ¶æµç¨‹é‡Œé¢ï¼Œè¿™æ®µéœ€è¦ä¿®æ”¹ä¸‹ï¼š<br>ã€2.æŠŠbinlog_cache flushåˆ°binlogæ–‡ä»¶ä¸­,æ ¹æ®è¡¨åã€ä¸»é”®å’Œå”¯ä¸€é”®(å¦‚æœæœ‰)ç”Ÿæˆhashå€¼(writeset),ä¿å­˜åˆ°hashè¡¨ä¸­<br>ã€åˆ¤æ–­è¿™ä¸‰ä¸ªäº‹åŠ¡çš„writesetæ˜¯å¦æœ‰å†²çª,å¦‚æœæ²¡æœ‰å†²çª,åˆ™è§†ä¸ºåŒç»„,å¦‚æœæœ‰å†²çª,åˆ™è§†ä¸ºä¸åŒç»„.<br>å¹¶æŠŠæŠŠç»„å‘˜ç¼–å·ä»¥åŠç»„çš„ç¼–å·å†™è¿›binlogæ–‡ä»¶ä¸­ã€‘ã€<br>ä¸Šé¢ä¸­æ‹¬å·è¿™æ®µè¦å»æ‰ï¼Œ<br>åˆ¤æ–­writesetä¹‹é—´æ˜¯å¦å¯ä»¥å¹¶è¡Œè¿™ä¸ªé€»è¾‘ï¼Œæ˜¯åœ¨å¤‡åº“çš„coordinatorçº¿ç¨‹åšçš„ã€‚<br><br>----<br>1. åœ¨å¤šçº¿ç¨‹å¹¶å‘çš„æ—¶å€™ï¼ŒSeconds_behind_masterå¾ˆä¸å‡†ï¼Œåé¢ä¼šä»‹ç»åˆ«çš„åˆ¤æ–­æ–¹æ³•ï¼›<br>2. æ˜¯çš„,å¤‡åº“æœ‰è®°å½•ï¼Œå°±æ˜¯show slave status é‡Œé¢çš„Relay_Log_File å’Œ Relay_Log_Pos è¿™ä¸¤ä¸ªå€¼è¡¨ç¤ºçš„ï¼Œå¥½é—®é¢˜<br>3.  â€åŠ å…¥åˆ°ç»„æ˜¯åœ¨binlog cache flushåˆ°binlogæ–‡ä»¶ä¹‹å‰åšçš„,å¦‚æœæ­¤æ—¶æœ‰äº‹åŠ¡æ­£åœ¨flush,æœªsync,åˆ™åé¢çš„äº‹åŠ¡å¿…é¡»ç­‰å¾…â€œ è¿™å¥è¯æ˜¯å¯¹çš„ï¼Œä½†æ˜¯æˆ‘æ²¡çœ‹å‡ºè¿™ä¸ªè·Ÿå‰é¢æçš„ä¸¤ä¸ªå»¶è¿Ÿå‚æ•°ä½œç”¨çš„å…³ç³»^_^","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547376900,"ip_address":"","comment_id":59397,"utype":1}],"discussion_count":5,"race_medal":0,"score":"113216512748","product_id":100020801,"comment_content":"æ€»ç»“ä¸‹å¤šçº¿ç¨‹å¤åˆ¶çš„æµç¨‹,æœ‰ä¸å¯¹ä¹‹å¤„è¯·è€å¸ˆæŒ‡å‡º:<br>åŒ1,é…ç½®ä¸ºlogical_clock,å‡è®¾æœ‰ä¸‰ä¸ªäº‹åŠ¡å¹¶å‘æ‰§è¡Œä¹Ÿå·²ç»æ‰§è¡Œå®Œæˆ(éƒ½å¤„äºprepareé˜¶æ®µ)<br>1.ä¸‰ä¸ªäº‹åŠ¡æŠŠredo logä»redo log bufferå†™åˆ°fs page cacheä¸­<br>2.æŠŠbinlog_cache flushåˆ°binlogæ–‡ä»¶ä¸­,æœ€å…ˆè¿›å…¥flushé˜Ÿåˆ—çš„ä¸ºleader,<br>å…¶å®ƒä¸¤ä¸ªäº‹åŠ¡ä¸ºfollower.æŠŠç»„å‘˜ç¼–å·ä»¥åŠç»„çš„ç¼–å·å†™è¿›binlogæ–‡ä»¶ä¸­(ä¸‰ä¸ªäº‹åŠ¡ä¸ºåŒä¸€ç»„).<br>3.ä¸‰ä¸ªäº‹åŠ¡çš„redo logåšfsync,binlogåšfsync.<br>4.dumpçº¿ç¨‹ä»binlogæ–‡ä»¶é‡ŒæŠŠbinlog eventå‘é€ç»™ä»åº“<br>5.I&#47;Oçº¿ç¨‹æ¥æ”¶åˆ°binlog event,å†™åˆ°relay logä¸­<br>6.sql threadè¯»å–relay log,åˆ¤æ–­å‡ºè¿™ä¸‰ä¸ªäº‹åŠ¡æ˜¯å¤„äºåŒä¸€ä¸ªç»„,<br>åˆ™æŠŠè¿™ä¸‰ä¸ªäº‹åŠ¡çš„eventæ‰“åŒ…å‘é€ç»™ä¸‰ä¸ªç©ºé—²çš„workerçº¿ç¨‹(å¦‚æœæœ‰)å¹¶æ‰§è¡Œã€‚<br><br>é…ç½®ä¸ºwritesetçš„å¤šçº¿ç¨‹å¤åˆ¶æµç¨‹:<br>1.ä¸‰ä¸ªäº‹åŠ¡æŠŠredo logä»redo log bufferå†™åˆ°fs page cacheä¸­<br>2.æŠŠbinlog_cache flushåˆ°binlogæ–‡ä»¶ä¸­,æ ¹æ®è¡¨åã€ä¸»é”®å’Œå”¯ä¸€é”®(å¦‚æœæœ‰)ç”Ÿæˆhashå€¼(writeset),ä¿å­˜åˆ°hashè¡¨ä¸­<br>åˆ¤æ–­è¿™ä¸‰ä¸ªäº‹åŠ¡çš„writesetæ˜¯å¦æœ‰å†²çª,å¦‚æœæ²¡æœ‰å†²çª,åˆ™è§†ä¸ºåŒç»„,å¦‚æœæœ‰å†²çª,åˆ™è§†ä¸ºä¸åŒç»„.<br>å¹¶æŠŠæŠŠç»„å‘˜ç¼–å·ä»¥åŠç»„çš„ç¼–å·å†™è¿›binlogæ–‡ä»¶ä¸­<br>(ä¸è¿‡ä¸€ä¸ªç»„çš„äº‹åŠ¡ä¸ªæ•°ä¹Ÿä¸æ˜¯æ— é™å¤§,ç”±å‚æ•°binlog_transaction_dependency_history_sizeå†³å®šç»„å†…æœ€å¤šäº‹åŠ¡æ•°)<br>3.ç„¶ååšredo logå’Œbinlogçš„fsync<br>4.dumpçº¿ç¨‹ä»binlogæ–‡ä»¶é‡ŒæŠŠbinlog eventå‘é€ç»™ä»åº“<br>5.I&#47;Oçº¿ç¨‹æ¥æ”¶åˆ°binlog event,å†™åˆ°relay logä¸­<br>6.sql threadè¯»å–relay log,å¦‚æœæ˜¯åŒä¸€ä¸ªç»„çš„äº‹åŠ¡,åˆ™æŠŠäº‹åŠ¡åˆ†é…åˆ°ä¸åŒçš„workerçº¿ç¨‹å»åº”ç”¨relay log.<br>ä¸åŒç»„çš„äº‹åŠ¡,éœ€è¦ç­‰åˆ°ä¸Šä¸€ä¸ªç»„çš„äº‹åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œæˆ,æ‰èƒ½åˆ†é…workerçº¿ç¨‹åº”ç”¨relay log.<br><br>è€å¸ˆæˆ‘æœ‰å‡ ä¸ªé—®é¢˜æƒ³è¯·æ•™ä¸‹:<br>1.åœ¨å¤‡åº“æ˜¯å•çº¿ç¨‹ä¸‹,second_behind_masteræ˜¯é€šè¿‡è®¡ç®—T3-T1å¾—åˆ°,<br>åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹,æ˜¯æ€ä¹ˆè®¡ç®—å‡ºsecond_behind_masterçš„å€¼ï¼Ÿç”¨çš„æ˜¯å“ªä¸€ä¸ªäº‹åŠ¡çš„æ—¶é—´æˆ³?<br>2.å¤šçº¿ç¨‹å¤åˆ¶ä¸‹,å¦‚æœä»åº“å®•æœºäº†,æ˜¯ä¸æ˜¯ä»åº“æœ‰ä¸€ä¸ªè®°å½•è¡¨è®°å½•é‚£äº›äº‹åŠ¡å·²ç»åº”ç”¨å®Œæˆ,<br>æ¢å¤çš„æ—¶å€™,åªéœ€è¦æ¢å¤æœªåº”ç”¨çš„äº‹åŠ¡.<br>3.binlogå»¶è¿Ÿsyncçš„ä¸¤ä¸ªå‚æ•°,æ˜¯å»¶è¿Ÿå·²ç»flushæœªsyncæ—¶é—´ã€‚æ„æ€æ˜¯è®©äº‹åŠ¡ç»„å ç”¨flushæ—¶é—´æ›´é•¿,<br>ä¹‹åçš„äº‹åŠ¡æœ‰æ›´å¤šçš„æ—¶é—´,ä»binlog cacheè¿›å…¥åˆ°flushé˜Ÿåˆ—,ä½¿å¾—ç»„å‘˜å˜å¤š,èµ·åˆ°ä»åº“å¹¶å‘çš„ç›®çš„<br>å› ä¸ºæˆ‘ç†è§£çš„æ˜¯åŠ å…¥åˆ°ç»„æ˜¯åœ¨binlog cache flushåˆ°binlogæ–‡ä»¶ä¹‹å‰åšçš„,å¦‚æœæ­¤æ—¶æœ‰äº‹åŠ¡æ­£åœ¨flush,<br>æœªsync,åˆ™åé¢çš„äº‹åŠ¡å¿…é¡»ç­‰å¾…ã€‚ä¸çŸ¥é“ç†è§£å¾—å¯¹ä¸<br><br><br><br>","like_count":27,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436334,"discussion_content":"ä¸Šé¢çš„æè¿°éƒ¨åˆ†ï¼Œwritesetçš„å¤šçº¿ç¨‹å¤åˆ¶æµç¨‹é‡Œé¢ï¼Œè¿™æ®µéœ€è¦ä¿®æ”¹ä¸‹ï¼š\nã€2.æŠŠbinlog_cache flushåˆ°binlogæ–‡ä»¶ä¸­,æ ¹æ®è¡¨åã€ä¸»é”®å’Œå”¯ä¸€é”®(å¦‚æœæœ‰)ç”Ÿæˆhashå€¼(writeset),ä¿å­˜åˆ°hashè¡¨ä¸­\nã€åˆ¤æ–­è¿™ä¸‰ä¸ªäº‹åŠ¡çš„writesetæ˜¯å¦æœ‰å†²çª,å¦‚æœæ²¡æœ‰å†²çª,åˆ™è§†ä¸ºåŒç»„,å¦‚æœæœ‰å†²çª,åˆ™è§†ä¸ºä¸åŒç»„.\nå¹¶æŠŠæŠŠç»„å‘˜ç¼–å·ä»¥åŠç»„çš„ç¼–å·å†™è¿›binlogæ–‡ä»¶ä¸­ã€‘ã€\nä¸Šé¢ä¸­æ‹¬å·è¿™æ®µè¦å»æ‰ï¼Œ\nåˆ¤æ–­writesetä¹‹é—´æ˜¯å¦å¯ä»¥å¹¶è¡Œè¿™ä¸ªé€»è¾‘ï¼Œæ˜¯åœ¨å¤‡åº“çš„coordinatorçº¿ç¨‹åšçš„ã€‚\n\n----\n1. åœ¨å¤šçº¿ç¨‹å¹¶å‘çš„æ—¶å€™ï¼ŒSeconds_behind_masterå¾ˆä¸å‡†ï¼Œåé¢ä¼šä»‹ç»åˆ«çš„åˆ¤æ–­æ–¹æ³•ï¼›\n2. æ˜¯çš„,å¤‡åº“æœ‰è®°å½•ï¼Œå°±æ˜¯show slave status é‡Œé¢çš„Relay_Log_File å’Œ Relay_Log_Pos è¿™ä¸¤ä¸ªå€¼è¡¨ç¤ºçš„ï¼Œå¥½é—®é¢˜\n3.  â€åŠ å…¥åˆ°ç»„æ˜¯åœ¨binlog cache flushåˆ°binlogæ–‡ä»¶ä¹‹å‰åšçš„,å¦‚æœæ­¤æ—¶æœ‰äº‹åŠ¡æ­£åœ¨flush,æœªsync,åˆ™åé¢çš„äº‹åŠ¡å¿…é¡»ç­‰å¾…â€œ è¿™å¥è¯æ˜¯å¯¹çš„ï¼Œä½†æ˜¯æˆ‘æ²¡çœ‹å‡ºè¿™ä¸ªè·Ÿå‰é¢æçš„ä¸¤ä¸ªå»¶è¿Ÿå‚æ•°ä½œç”¨çš„å…³ç³»^_^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547376900,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2389270,"avatar":"https://static001.geekbang.org/account/avatar/00/24/75/16/6e28bf17.jpg","nickname":"åˆæ™¨","note":"","ucode":"C5D95D13E49127","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590312,"discussion_content":"ä½ è¿™æ ·ï¼Œæ˜¾å¾—æˆ‘ä»¬å¾ˆå‘†å‘€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665650322,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"é™•è¥¿"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2252648,"avatar":"https://static001.geekbang.org/account/avatar/00/22/5f/68/8e4407c7.jpg","nickname":"ğŸ’¡","note":"","ucode":"8AB762A8CDFEF7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388871,"discussion_content":"è¯·é—®ä¸‹&#34;å¦‚æœæ­¤æ—¶æœ‰äº‹åŠ¡æ­£åœ¨flush,æœªsync,åˆ™åé¢çš„äº‹åŠ¡å¿…é¡»ç­‰å¾…&#34; æ€ä¹ˆç†è§£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629022414,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1227366,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ba/66/7d9f45e7.jpg","nickname":"å¤ªç©ºç‰›ä»”","note":"","ucode":"0205635C3854AF","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":2252648,"avatar":"https://static001.geekbang.org/account/avatar/00/22/5f/68/8e4407c7.jpg","nickname":"ğŸ’¡","note":"","ucode":"8AB762A8CDFEF7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543529,"discussion_content":"æˆ‘çš„ç†è§£æ˜¯ binlog cacheæ˜¯æŒ‰çº¿ç¨‹åˆ†é… ä¹Ÿå°±æ˜¯è¯´äº‹åŠ¡åœ¨flushé˜¶æ®µæ˜¯å•çº¿ç¨‹å¤„ç†çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641196141,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":388871,"ip_address":""},"score":543529,"extra":""},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2252648,"avatar":"https://static001.geekbang.org/account/avatar/00/22/5f/68/8e4407c7.jpg","nickname":"ğŸ’¡","note":"","ucode":"8AB762A8CDFEF7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587832,"discussion_content":"æ–‡ä»¶åªæœ‰ä¸€ä¸ªè€Œä¸”æ˜¯é¡ºåºå†™ï¼ŒåŠ é”åšåŒæ­¥ï¼Œé€šè¿‡ç»„æäº¤å°†è¿™ä¸ªæ­¥éª¤æ‹†åˆ†å¤šä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µç‹¬äº«ä¸€æŠŠé”ï¼Œä»è€Œæé«˜å¹¶å‘ï¼›æœ‰ç‚¹nettyä¸åŒhandlerå„ä¸ªçº¿ç¨‹å¼‚æ­¥ä¸²è¡Œçš„å‘³é“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663313036,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":388871,"ip_address":"å¹¿ä¸œ"},"score":587832,"extra":""}]}]},{"had_liked":false,"id":58649,"user_name":"æ…§é‘«coming","can_delete":false,"product_type":"c1","uid":1324385,"ip_address":"","ucode":"7BAC9CA255630E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLE4LYb3jrH63ZV98Zpc8DompwDgb1O3nffMoZCmiaibauRyEFv6NDNsST9RWxZExvMLMWb50zaanoQ/132","comment_is_top":false,"comment_ctime":1547166453,"is_pvip":false,"replies":[{"id":"21200","content":"å¥½é—®é¢˜<br>ä¸è¿‡è¿™ä¸ªæ˜¯ä¸å¯èƒ½çš„å“ˆï¼Œå¯¹åŒä¸€è¡Œçš„ä¿®æ”¹ï¼Œç¬¬ä¸€ä¸ªæ‹¿åˆ°è¡Œé”çš„äº‹åŠ¡è¿˜æ²¡æäº¤å‰ï¼Œå¦å¤–ä¸¤ä¸ªä¼šè¢«è¡Œé”å µä½çš„ï¼Œè¿™ä¸¤ä¸ªè¿›å…¥ä¸äº†commitçŠ¶æ€ã€‚æ‰€ä»¥è¿™ä¸‰ä¸ªçš„commit_idä¸ä¼šç›¸åŒçš„ğŸ˜†","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547176178,"ip_address":"","comment_id":58649,"utype":1}],"discussion_count":4,"race_medal":0,"score":"113216316149","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæœ‰ä¸ªé—®é¢˜ï¼Œmariadbçš„å¹¶è¡Œç­–ç•¥ï¼Œå½“åŒä¸€ç»„ä¸­æœ‰3ä¸ªäº‹åŠ¡ï¼Œå®ƒä»¬éƒ½å¯¹åŒä¸€è¡ŒåŒä¸€å­—æ®µå€¼è¿›è¡Œæ›´æ”¹ï¼Œè€Œå®ƒä»¬çš„commit_idç›¸åŒï¼Œå¯ä»¥åœ¨ä»åº“å¹¶è¡Œæ‰§è¡Œï¼Œé‚£ä¹ˆ3è€…çš„å…ˆåé¡ºåºæ˜¯æ€ä¹ˆä¿è¯ä¸å½±å“è¯¥è¡Œè¯¥å­—æ®µçš„æœ€ç»ˆç»“æœä¸ä¸»åº“ä¸€è‡´ï¼Ÿ","like_count":26,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436150,"discussion_content":"å¥½é—®é¢˜\nä¸è¿‡è¿™ä¸ªæ˜¯ä¸å¯èƒ½çš„å“ˆï¼Œå¯¹åŒä¸€è¡Œçš„ä¿®æ”¹ï¼Œç¬¬ä¸€ä¸ªæ‹¿åˆ°è¡Œé”çš„äº‹åŠ¡è¿˜æ²¡æäº¤å‰ï¼Œå¦å¤–ä¸¤ä¸ªä¼šè¢«è¡Œé”å µä½çš„ï¼Œè¿™ä¸¤ä¸ªè¿›å…¥ä¸äº†commitçŠ¶æ€ã€‚æ‰€ä»¥è¿™ä¸‰ä¸ªçš„commit_idä¸ä¼šç›¸åŒçš„ğŸ˜†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1547176178,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":3167302,"avatar":"","nickname":"Geek_eabafe","note":"","ucode":"4D94487320B33B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":588162,"discussion_content":"è€å¸ˆï¼Œè¿™é‡Œçš„commit_idæ˜¯ç»„æäº¤æ—¶ï¼Œæ¶‰åŠçš„äº‹åŠ¡åˆ†é…åŒä¸€ä¸ªcommit_idå§ï¼Œå®ƒå—æ—¶é—´æˆ–è€…äº‹åŠ¡ç´¯è®¡ä¸ªæ•°æœ‰å…³ï¼Œå°±ç®—åä¸¤ä¸ªè¢«å µä½ï¼Œåç»­æ‰§è¡Œå®Œä¹Ÿæ˜¯æœ‰å¯èƒ½ä¸€ä¸ªç»„æäº¤çš„å§ï¼Ÿ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663581283,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":436150,"ip_address":"åŒ—äº¬"},"score":588162,"extra":""},{"author":{"id":2389270,"avatar":"https://static001.geekbang.org/account/avatar/00/24/75/16/6e28bf17.jpg","nickname":"åˆæ™¨","note":"","ucode":"C5D95D13E49127","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":3167302,"avatar":"","nickname":"Geek_eabafe","note":"","ucode":"4D94487320B33B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590314,"discussion_content":"æŒæœ‰é”çš„äº‹åŠ¡æäº¤æ—¶æ‰ä¼šé‡Šæ”¾é”ï¼Œå³ä½¿è®¾ç½®äº†binlogç»„æäº¤çš„å‚æ•°ï¼Œè¿™é‡Œä¹Ÿæ˜¯ç­‰å¾…å…¶ä»–æ²¡æœ‰é”å†²çªçš„äº‹åŠ¡ï¼›ä¸€èµ·æ‰§è¡Œçš„äº‹åŠ¡æ‰æ‹¥æœ‰ç›¸åŒçš„commit_idï¼›åç»­é‡Šæ”¾é”ï¼Œç­‰å¾…é”çš„äº‹åŠ¡æ‰§è¡Œï¼Œè¿™é‡Œæ˜¯åˆ†é…å…¶ä»–commit_idã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665651424,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":588162,"ip_address":"é™•è¥¿"},"score":590314,"extra":""}]},{"author":{"id":1667987,"avatar":"https://static001.geekbang.org/account/avatar/00/19/73/93/0a3a1e5b.jpg","nickname":"Ryan","note":"","ucode":"95BBBEE5B23878","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":223894,"discussion_content":"æˆ‘ä¹Ÿåœ¨æƒ³ æ›´æ–°åŒä¸€è¡Œ æ€ä¹ˆå¯èƒ½åŒæ—¶è·å–åˆ°é” æ‹¥æœ‰ç›¸åŒåˆ°commit_id","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586260693,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":74533,"user_name":"linqw","can_delete":false,"product_type":"c1","uid":1134138,"ip_address":"","ucode":"09DCFE98C54DD8","user_header":"https://static001.geekbang.org/account/avatar/00/11/4e/3a/86196508.jpg","comment_is_top":false,"comment_ctime":1552230674,"is_pvip":false,"replies":[{"id":"28798","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1553339740,"ip_address":"","comment_id":74533,"utype":1}],"discussion_count":1,"race_medal":0,"score":"78861642002","product_id":100020801,"comment_content":"å­¦ä¹ å®Œè¿™ç¯‡å†™ä¸‹è‡ªå·±çš„ç†è§£ï¼Œè€å¸ˆæœ‰ç©ºå¸®å¿™çœ‹ä¸‹å“¦ï¼Œå¤‡åº“ä¸€èˆ¬ä¼šå»¶è¿Ÿåˆ†é’Ÿçº§åˆ«ï¼Œæ¯”å¦‚ä¸»åº“å‹åŠ›æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œå¤‡åº“æœ‰å¯èƒ½ä¼šå»¶è¿Ÿå°æ—¶çº§åˆ«ï¼Œä¸ºæ­¤mysqlå®˜æ–¹æä¾›äº†å¤šç§å¤šçº¿ç¨‹å¤åˆ¶ç­–ç•¥<br>1ã€5.6åŸºäºåº“çš„å¤šçº¿ç¨‹å¤åˆ¶ç­–ç•¥ï¼Œä½¿ç”¨hashæ•°æ®åº“åä½œä¸ºkeyï¼Œvalueä¸ºå¤šå°‘ä¸ªäº‹åŠ¡ä¿®æ”¹æ­¤æ•°æ®åº“ï¼Œä½¿ç”¨hashæ¥åˆ†é…å¤šçº¿ç¨‹ï¼Œå¦‚æœä¸€ä¸ªæ–°äº‹åŠ¡åŠ å…¥è¿›æ¥ï¼Œå¦‚æœæœ‰å†²çªçš„hashï¼Œåˆ†é…ç»™æ­¤çº¿ç¨‹ï¼Œå¦‚æœæ²¡æœ‰å†²çªåˆ†é…ç»™ç©ºé—²çš„çº¿ç¨‹ï¼Œæ„Ÿè§‰å®ç°çš„æ€è·¯ä½¿ç”¨é˜Ÿåˆ—+çº¿ç¨‹æ± ï¼Œå¦‚æœçº¿ç¨‹æ± ä¸­æ²¡æœ‰ç©ºé—²çš„çº¿ç¨‹ï¼Œå°±åœ¨é˜Ÿåˆ—ä¸­å¢åŠ äº‹åŠ¡ï¼Œå¦‚æœé˜Ÿåˆ—æ»¡ï¼Œåˆ†å‘å™¨é˜»å¡ï¼Œä¸è§£æbinlogï¼Œåˆ†å‘å™¨æ˜¯ç”Ÿäº§è€…ï¼Œçº¿ç¨‹æ± æ˜¯æ¶ˆè´¹è€…ï¼ŒåŸºäºåº“çš„å¤šçº¿ç¨‹å¤åˆ¶æœ‰å¦‚ä¸‹ä¼˜ç‚¹â‘ æ„é€  hash å€¼çš„æ—¶å€™å¾ˆå¿«ï¼Œåªéœ€è¦åº“åï¼›çº¿ç¨‹çš„hashé¡¹ä¹Ÿå¾ˆå°‘â‘¡binlogä¸éœ€è¦å¼ºåˆ¶æŒ‡å®šrowï¼Œstatementä¹Ÿå¯ä»¥æ‹¿åˆ°åº“åã€‚ç¼ºç‚¹ï¼šâ‘ å¦‚æœåªæœ‰ä¸€ä¸ªåº“å•çº¿ç¨‹å¤åˆ¶ï¼Œå¯ä»¥å°†å…¶çƒ­ç‚¹è¡¨åˆ†å¸ƒåˆ°å¤šä¸ªåº“ä¸­ï¼ˆä¸æ¨èä½¿ç”¨ï¼‰ï¼Œå¦‚æœå¤šä¸ªåº“çš„çƒ­ç‚¹ç¨‹åº¦ä¸åŒä¹Ÿä¼šä½¿å…¶å•çº¿ç¨‹å¤åˆ¶ã€‚<br>2ã€åŸºäºè¡¨çš„å¤šçº¿ç¨‹å¤åˆ¶ï¼ˆéå®˜æ–¹ï¼Œè€å¸ˆå®ç°ï¼‰ï¼Œhashæ•°æ®åº“å+è¡¨åä½œä¸ºkeyï¼Œvalueä¸ºå¤šå°‘ä¸ªäº‹åŠ¡ä¿®æ”¹æ­¤æ•°æ®è¡¨ï¼ŒåŒä¸€ä¸ªäº‹åŠ¡çš„å¤šå¼ è¡¨ï¼Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹è¿›è¡Œå¤„ç†ï¼Œé˜²æ­¢è¿ååŸå­æ€§ï¼Œä¼˜ç‚¹å¯¹åŒä¸€ä¸ªåº“å¤šä¸ªçƒ­ç‚¹è¡¨å¯ä»¥åŒæ—¶å¤åˆ¶ï¼Œå¤šè¡¨è´Ÿè½½æ•ˆæœå¾ˆå¥½ï¼Œå¦‚æœç¢°åˆ°çƒ­ç‚¹è¡¨ï¼Œæ¯”å¦‚æ‰€æœ‰çš„æ›´æ–°äº‹åŠ¡éƒ½ä¼šæ¶‰åŠåˆ°æŸä¸€ä¸ªè¡¨çš„æ—¶å€™ï¼Œä¼šä½¿ç”¨å•çº¿ç¨‹å¤åˆ¶ã€‚<br>3ã€åŸºäºè¡Œçš„å¤šçº¿ç¨‹å¤åˆ¶ï¼Œkeyå¿…é¡»æ˜¯â€œåº“å + è¡¨å + å”¯ä¸€é”®çš„å€¼â€œä¹Ÿéœ€è€ƒè™‘å”¯ä¸€ä¸»é”®ï¼Œé˜²æ­¢å”¯ä¸€ä¸»é”®å†²çªï¼ˆcpuçš„å¤šçº¿ç¨‹è°ƒåº¦ï¼Œé¡ºåºä¸å›ºå®šï¼‰ï¼Œvalueä¸ºä¿®æ”¹å‰åkeyçš„æ¬¡æ•°ï¼Œçº¦æŸâ‘ è¡¨å¿…é¡»æœ‰ä¸»é”®â‘¡ä¸èƒ½æœ‰å¤–é”®â‘¢binlogæ ¼å¼rowï¼ˆè¡¨å¤åˆ¶ä¹Ÿä¸€æ ·ï¼‰ç¼ºç‚¹ï¼šâ‘ å¤§äº‹åŠ¡è€—cpuâ‘¡hashé¡¹å¤šã€‚ä¼˜åŒ–å¯ä»¥è®¾ç½®é˜ˆå€¼ï¼Œå¦‚æœäº‹åŠ¡ä¿®æ”¹çš„è¡Œå¤§äºç‰¹å®šå€¼ï¼Œä½¿ç”¨å•çº¿ç¨‹å¤åˆ¶ï¼ˆè€å¸ˆè‡ªå·±å®ç°ï¼‰ã€‚mysqlå®˜ç½‘åŸºäºè¡Œçš„å¤šçº¿ç¨‹å¤åˆ¶ï¼Œè¡¨ç¤ºçš„æ˜¯å¯¹äºäº‹åŠ¡æ¶‰åŠæ›´æ–°çš„æ¯ä¸€è¡Œï¼Œè®¡ç®—å‡ºæ¯ä¸€è¡Œçš„ hashä¿å­˜åœ¨writesetä¸­ï¼Œä¼˜ç‚¹ï¼Œâ‘ æ˜¯æœ‰mysqlä¸»åº“å†™å…¥binlogä¸­ï¼Œä¸éœ€è¦è§£æ binlog å†…å®¹ï¼ˆevent é‡Œçš„è¡Œæ•°æ®ï¼‰ï¼ŒèŠ‚çœè®¡ç®—é‡â‘¡binlogæ ¼å¼æ²¡è¦æ±‚ï¼Œå¯ä»¥ä½¿ç”¨statementâ‘¢æ— éœ€æ‰«ææ•´ä¸ªäº‹åŠ¡çš„binlogçœå†…å­˜ï¼Œmysql5.7.22çš„å¤šçº¿ç¨‹å¤åˆ¶å®ç°æ–¹å¼ã€‚<br>4ã€mysql5.7çš„å¤šçº¿ç¨‹å¤åˆ¶å®ç°æ–¹å¼ï¼Œå€ŸåŠ©äºå¤„äºredo prepareåˆ°commitçŠ¶æ€ä¸‹çš„äº‹åŠ¡å¯ä»¥å¹¶è¡Œï¼Œå› ä¸ºæ‰§è¡Œå™¨æ‰¾å¼•æ“æ‹¿æ•°æ®æ—¶ï¼Œäº‹åŠ¡å¦‚æœé”å†²çªä¼šé˜»å¡ï¼Œæ— æ³•åˆ°å†™redo logè¿™ä¸€æ­¥ï¼Œå¯ä»¥ä½¿ç”¨binlogæ•…æ„å»¶è¿Ÿfsyncï¼Œé˜²æ­¢é¢‘ç¹å†™ç£ç›˜æ“ä½œï¼Œä¸ä¼šä¸¢å¤±æ•°æ®ï¼ˆredo prepar+å®Œæ•´çš„binlogäº‹åŠ¡æ‰èƒ½æäº¤ï¼Œå¦åˆ™å›æ»šï¼‰ï¼Œä½¿å…¶åœ¨å¤‡åº“å¤šçº¿ç¨‹å¤åˆ¶ï¼Œä¸»å¤‡å»¶è¿Ÿä½ï¼Œï¼Œä½†æ˜¯è¿™æ ·æœ‰ä¸€ç‚¹ä¸å¥½ï¼Œè¯­å¥çš„å“åº”æ—¶é—´å˜é•¿ï¼Œæ„Ÿè§‰mysqlå®˜ç½‘æ•…æ„å»¶è¿Ÿredoçš„fsyncï¼Œåœ¨binlog writeçš„æ—¶å€™ï¼ˆå› ä¸ºäº‹åŠ¡çš„binlogè¦å†™å®Œæ•´ï¼Œæ—¶é—´è¾ƒé•¿ï¼‰ï¼Œä½¿å…¶èƒ½æ‰¹é‡æäº¤ï¼Œå‡å°‘iopsï¼Œæ„Ÿè§‰å¾ˆå·§å¦™","like_count":18,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442590,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553339740,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61513,"user_name":"Mr.Strive.Z.H.L","can_delete":false,"product_type":"c1","uid":1030198,"ip_address":"","ucode":"6D97E159E2EECD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b8/36/542c96bf.jpg","comment_is_top":false,"comment_ctime":1547711110,"is_pvip":false,"replies":[{"id":"21872","content":"å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½æœ‰ä¸¤ä¸ªæ•°å­—è¡¨ç¤ºå®ƒåœ¨æ‰§è¡Œæäº¤é˜¶æ®µçš„æ—¶é—´èŒƒå›´, æ„æˆåŒºé—´(c1, c2).<br>å¦‚æœä¸¤ä¸ªäº‹åŠ¡çš„åŒºé—´æœ‰äº¤é›†ï¼Œå°±æ˜¯å¯ä»¥å¹¶è¡Œçš„ã€‚<br>è¿™é‡Œc1æ˜¯äº‹åŠ¡å¯åŠ¨çš„æ—¶å€™ï¼Œå½“å‰ç³»ç»Ÿé‡Œæœ€å¤§çš„commit_idï¼›<br>ä¸€ä¸ªäº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œcommit_id+1.","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547740671,"ip_address":"","comment_id":61513,"utype":1}],"discussion_count":2,"race_medal":0,"score":"48792351366","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼š<br>å…³äºCOMMIT_ORDERçš„å¹¶è¡Œå¤åˆ¶æ–¹æ¡ˆï¼Œä»åº“æ ¹æ® commit_idæ¥åˆ¤æ–­â€œå¤„äºprepareå’ŒcommitçŠ¶æ€çš„äº‹åŠ¡â€ã€‚è¿™é‡Œæˆ‘æœ‰ä¸ªå¾ˆå¤§çš„ç–‘æƒ‘ï¼šcommit_idæ˜¯ä»€ä¹ˆæ—¶å€™åŠ å…¥åˆ°binlogçš„ï¼Œåˆæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™é€’å¢çš„ï¼Ÿï¼Ÿ<br>ï¼ˆ<br>å¯¹äºæˆ‘è¿™ä¸ªé—®é¢˜çš„è¿›ä¸€æ­¥è§£é‡Šï¼š<br>æ—¢ç„¶commit_idæ˜¯è¦è¢«å†™å…¥åˆ°binlogçš„ï¼Œé‚£ä¹ˆcommit_idæ¯«æ— ç–‘é—®å°±æ˜¯åœ¨write binlogé˜¶æ®µå†™å…¥çš„ã€‚<br><br>æˆ‘ä»¬çŸ¥é“redologæ˜¯ç»„æäº¤çš„ï¼Œå¦‚æœåªæ˜¯æŒ‰ç…§redologçš„ç»„æäº¤æ–¹å¼ç”Ÿæˆcommit_idï¼Œé‚£ä¹ˆè¿™ä¸ªcommit_idåŒ…å«çš„å¹¶è¡Œäº‹åŠ¡æ•°é‡å¹¶ä¸å¤Ÿå¤šï¼å› ä¸ºåœ¨binlog writeé˜¶æ®µï¼Œåˆæœ‰äº‹åŠ¡è¿›å…¥åˆ°redolog prepareé˜¶æ®µï¼Œä»–ä»¬ä¹‹é—´çš„commit_idæ˜¯ä¸ä¸€æ ·çš„ï¼Œä½†æ˜¯ä»–ä»¬æ˜¯å¯ä»¥å¹¶è¡Œçš„ã€‚<br><br>æ‰€ä»¥commit_idä»€ä¹ˆæ—¶å€™é€’å¢ï¼Ÿè¿™ä¸ªæ˜¯éå¸¸å…³é”®çš„ï¼Œæˆ‘ä¹Ÿå¾ˆç–‘æƒ‘ï¼Œcommit_idåˆ°åº•æ˜¯æ ¹æ®ä»€ä¹ˆæ¡ä»¶é€’å¢çš„ï¼Ÿï¼Ÿ<br>ï¼‰","like_count":11,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436895,"discussion_content":"å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½æœ‰ä¸¤ä¸ªæ•°å­—è¡¨ç¤ºå®ƒåœ¨æ‰§è¡Œæäº¤é˜¶æ®µçš„æ—¶é—´èŒƒå›´, æ„æˆåŒºé—´(c1, c2).\nå¦‚æœä¸¤ä¸ªäº‹åŠ¡çš„åŒºé—´æœ‰äº¤é›†ï¼Œå°±æ˜¯å¯ä»¥å¹¶è¡Œçš„ã€‚\nè¿™é‡Œc1æ˜¯äº‹åŠ¡å¯åŠ¨çš„æ—¶å€™ï¼Œå½“å‰ç³»ç»Ÿé‡Œæœ€å¤§çš„commit_idï¼›\nä¸€ä¸ªäº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œcommit_id+1.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547740671,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1788647,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/4a/e7/6c16af5d.jpg","nickname":"æ±‰æ±Ÿ","note":"","ucode":"01622D984B8F9B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348326,"discussion_content":"c2 æ˜¯ä»€ä¹ˆ ï¼Ÿ æ˜¯ ï¼Œcommit_id+1ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612513278,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65060,"user_name":"J!","can_delete":false,"product_type":"c1","uid":1305003,"ip_address":"","ucode":"71C946119B59D1","user_header":"https://static001.geekbang.org/account/avatar/00/13/e9/ab/37903736.jpg","comment_is_top":false,"comment_ctime":1549015062,"is_pvip":false,"replies":[{"id":"23065","content":"è¿›å…¥prepare çš„æ—¶å€™å°±ç»™è¿™ä¸ªäº‹åŠ¡åˆ†é… commitidï¼Œè¿™ä¸ªcommitidå°±æ˜¯å½“å‰ç³»ç»Ÿæœ€å¤§çš„ä¸€ä¸ªcommitid","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1549038647,"ip_address":"","comment_id":65060,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35908753430","product_id":100020801,"comment_content":"åŒæ—¶å¤„äº prepare çŠ¶æ€çš„äº‹åŠ¡ï¼Œåœ¨å¤‡åº“æ‰§è¡Œæ—¶æ˜¯å¯ä»¥å¹¶è¡Œ.å¤åˆ¶çš„ï¼Œæ˜¯è¿™ä¸ªprepare å°±å¯ä»¥ç”Ÿæˆäº†æ”¹ç»„çš„commited Idå—<br><br>æå®¢æ—¶é—´ç‰ˆæƒæ‰€æœ‰: https:&#47;&#47;time.geekbang.org&#47;column&#47;article&#47;77083","like_count":8,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438303,"discussion_content":"è¿›å…¥prepare çš„æ—¶å€™å°±ç»™è¿™ä¸ªäº‹åŠ¡åˆ†é… commitidï¼Œè¿™ä¸ªcommitidå°±æ˜¯å½“å‰ç³»ç»Ÿæœ€å¤§çš„ä¸€ä¸ªcommitid","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549038647,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58864,"user_name":"ç”Ÿæ´»åœ¨åˆ«å¤„","can_delete":false,"product_type":"c1","uid":1096441,"ip_address":"","ucode":"E7F60026F2737A","user_header":"https://static001.geekbang.org/account/avatar/00/10/ba/f9/351e4fc0.jpg","comment_is_top":false,"comment_ctime":1547216560,"is_pvip":false,"replies":[{"id":"21309","content":"æ˜¯è¯´ï¼Œä¸éœ€è¦è§£æå‡ºbinlogé‡Œé¢çš„è¡Œä¿¡æ¯ã€‚ä½ æçš„å¯¹ï¼Œæˆ‘åŠ ä¸ªè¯´æ˜è¿›å»","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547228396,"ip_address":"","comment_id":58864,"utype":1}],"discussion_count":3,"race_medal":0,"score":"35906954928","product_id":100020801,"comment_content":"writeset æ˜¯åœ¨ä¸»åº“ç”Ÿæˆåç›´æ¥å†™å…¥åˆ° binlog é‡Œé¢çš„ï¼Œè¿™æ ·åœ¨å¤‡åº“æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸éœ€è¦è§£æ binlog å†…å®¹ï¼ŒèŠ‚çœäº†å¾ˆå¤šè®¡ç®—é‡ï¼›çŸ›ç›¾å§ï¼Ÿä¸è§£æbinlogæ€ä¹ˆçŸ¥é“æ˜¯åŒä¸€ä¸ªå†™é›†åˆï¼Ÿ","like_count":8,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436238,"discussion_content":"æ˜¯è¯´ï¼Œä¸éœ€è¦è§£æå‡ºbinlogé‡Œé¢çš„è¡Œä¿¡æ¯ã€‚ä½ æçš„å¯¹ï¼Œæˆ‘åŠ ä¸ªè¯´æ˜è¿›å»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547228396,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"æˆ’é…’çš„æç™½","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":409229,"discussion_content":"ä¸¥è°¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635396354,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1363110,"avatar":"https://static001.geekbang.org/account/avatar/00/14/cc/a6/b0490e97.jpg","nickname":"Tsong","note":"","ucode":"CF0259824E6D53","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294670,"discussion_content":"ä¹Ÿæ˜¯ä¾é   last_committedæ¥åˆ¤æ–­å¾—ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595952649,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":75270,"user_name":"è½»æ­Œèµ‹","can_delete":false,"product_type":"c1","uid":1251574,"ip_address":"","ucode":"22F62446208805","user_header":"https://static001.geekbang.org/account/avatar/00/13/18/f6/2ff7bc7a.jpg","comment_is_top":false,"comment_ctime":1552371984,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27322175760","product_id":100020801,"comment_content":"1ï¼Œ3ä¼šå¯¼è‡´å¤‡åº“ä»ç„¶å•çº¿ç¨‹æ‰§è¡Œ<br>1æ˜¯å› ä¸ºæ²¡æœ‰ä»»ä½•äº‹åŠ¡æ—¶é—´çº¿æ˜¯ä¸€è‡´çš„<br>3æ˜¯å› ä¸ºå•çº¿ç¨‹æ‰§è¡Œçš„äº‹åŠ¡çš„å…ˆåå…³ç³»å¿…ç„¶ä¸ä¼šæœ‰é‡å çš„æƒ…å†µï¼Œåœ¨å¤šçº¿ç¨‹ä¸Šé¢ä¸ºäº†ä¿è¯é¡ºåºè‡ªç„¶åªèƒ½ä¸€ä¸ªä¸ªè¿‡ï¼Œå°±æˆäº†å•çº¿ç¨‹","like_count":6},{"had_liked":false,"id":63841,"user_name":"ç‰›ç‰›","can_delete":false,"product_type":"c1","uid":1194626,"ip_address":"","ucode":"CFCE68B4F92209","user_header":"https://static001.geekbang.org/account/avatar/00/12/3a/82/1ff83a38.jpg","comment_is_top":false,"comment_ctime":1548552438,"is_pvip":false,"replies":[{"id":"23032","content":"1. delete 300æ¡ ï¼Œ sleep 500mså·²ç»æ˜¯å¾ˆå…‹åˆ¶çš„æ“ä½œäº†ï¼Œå•çº¿ç¨‹å—ï¼Ÿå¦‚æœè¿˜æ˜¯å•çº¿ç¨‹ï¼Œé‚£å»¶è¿Ÿåº”è¯¥ä¸æ˜¯è¿™ä¸ªæ“ä½œå¯¼è‡´çš„<br><br>2. è¿™éƒ½æ˜¯å¾ˆå°çš„å‹åŠ›ï¼Œä¸ä¼šè¯»å–æ…¢æ‰å¯¹","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1549004939,"ip_address":"","comment_id":63841,"utype":1}],"discussion_count":2,"race_medal":0,"score":"27318356214","product_id":100020801,"comment_content":"è€å¸ˆã€è¯·æ•™ä¸¤ä¸ªé—®é¢˜ï½<br>1. æˆ‘åœ¨jobé‡ŒæŒ‰ä¸»é”®åˆ é™¤çº¿ä¸Šè¡¨æ•°æ®çš„æ—¶å€™ã€é€ æˆäº†ä¸»ä»å»¶è¿Ÿã€delete from table where id in...<br><br>idæ˜¯ä¸»é”®ã€æ¯æ¬¡delete 300æ¡ã€sleep 500msã€è¿™ç§å»¶è¿Ÿå¯èƒ½æ˜¯ä»€ä¹ˆé€ æˆçš„å‘¢ï¼Ÿ300æ¡åº”è¯¥ä¸ç®—å¤§äº‹åŠ¡ï¼Ÿè¿˜æ˜¯è¯´å¿«é€Ÿçš„æ•°æ®åˆ é™¤å¯¼è‡´äº†ç´¢å¼•é‡å»ºï¼Ÿ<br><br>2. å¦‚æœä¸€ä¸ªè¡¨å¿«é€Ÿå¾€é‡Œå†™æ•°æ®ã€æ¯æ¬¡300æ¡ã€sleep 1sã€è¿™ä¸ªåº“ä¸Šçš„è¯»å–ä¼šæ…¢å—ï¼Ÿ<br><br>å¤šè°¢è€å¸ˆğŸ™ï½","like_count":6,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437730,"discussion_content":"1. delete 300æ¡ ï¼Œ sleep 500mså·²ç»æ˜¯å¾ˆå…‹åˆ¶çš„æ“ä½œäº†ï¼Œå•çº¿ç¨‹å—ï¼Ÿå¦‚æœè¿˜æ˜¯å•çº¿ç¨‹ï¼Œé‚£å»¶è¿Ÿåº”è¯¥ä¸æ˜¯è¿™ä¸ªæ“ä½œå¯¼è‡´çš„\n\n2. è¿™éƒ½æ˜¯å¾ˆå°çš„å‹åŠ›ï¼Œä¸ä¼šè¯»å–æ…¢æ‰å¯¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549004939,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587834,"discussion_content":"å•çº¿ç¨‹æ²¡å¿…è¦sleepå§ã€‚å¤ªå…‹åˆ¶äº†....","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663314491,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":85046,"user_name":"xyğŸ¥","can_delete":false,"product_type":"c1","uid":1029430,"ip_address":"","ucode":"DA1EC0789071F0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b5/36/d444d19e.jpg","comment_is_top":false,"comment_ctime":1554966530,"is_pvip":false,"replies":[{"id":"31598","content":"ä¸»è¦è¿˜æ˜¯ä»åº“çš„applyçº¿ç¨‹ä¸å¤Ÿå¿«ã€‚ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1555724968,"ip_address":"","comment_id":85046,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23029803010","product_id":100020801,"comment_content":"æ—è€å¸ˆå¥½ï¼Œé—®ä¸€ä¸ªæœ€è¿‘é‡åˆ°çš„é—®é¢˜ã€‚æœ‰ä¸€å°5.7ç‰ˆæœ¬çš„MySQLæ•°æ®åº“ï¼Œåœ¨å¼€å¯å¤šçº¿ç¨‹å¤åˆ¶ï¼ˆ4ï¼‰çš„æ—¶å€™ï¼Œè·‘äº†ä¸¤å¤©åï¼Œç„¶åä¸‰ä¸ªä»åº“åŒæ—¶å¡ä½äº†ï¼ŒæŒ‰ç…§MySQL 1864æŠ¥é”™ï¼Œæ‰‹åŠ¨è°ƒå¤§äº†ä¸‰ä¸ªä»åº“slave_pending_jobs_size_maxçš„å‚æ•°ä¹‹åå°±æ¢å¤äº†ï¼Œä¹‹å‰åœ¨5.6ä¸Šæ²¡æœ‰é‡åˆ°è¿‡è¿™ä¸ªé—®é¢˜ã€‚è¿™é‡Œçš„åŸç†è¿˜æ²¡æƒ³æ˜ç™½ï¼Œå®˜æ¡£ä¸Šåœ¨è¿™é‡Œæè¿°çš„ä¸æ˜¯å¾ˆè¯¦ç»†ï¼Œæ±‚æŒ‡å¯¼ä¸€ä¸‹ã€‚","like_count":5,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446540,"discussion_content":"ä¸»è¦è¿˜æ˜¯ä»åº“çš„applyçº¿ç¨‹ä¸å¤Ÿå¿«ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555724968,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68128,"user_name":"èƒ¡æ¥šåš","can_delete":false,"product_type":"c1","uid":1120212,"ip_address":"","ucode":"225883EDF35BED","user_header":"https://static001.geekbang.org/account/avatar/00/11/17/d4/d7a4e6f5.jpg","comment_is_top":false,"comment_ctime":1550420863,"is_pvip":false,"replies":[{"id":"24132","content":"ä¸€ä¸ªäº‹åŠ¡åªèƒ½å‘ç»™ä¸€ä¸ªworkerçš„ï¼Œ<br><br>é•¿æ°è¯„è®ºçš„é‚£ä¸ªé—®é¢˜ï¼Œè®¨è®ºçš„æ˜¯å¦‚æœåˆ†æˆä¸¤ä¸ªäº‹åŠ¡ï¼Œç„¶åçº¦å®šä¸€èµ·æäº¤ï¼Œè¿™ä¸ªæ˜¯åšä¸åˆ°çš„ï¼ˆæˆ–è€…è¯´å®ç°èµ·æ¥å¾ˆå¤æ‚ï¼‰","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1550452752,"ip_address":"","comment_id":68128,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18730290047","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå…³äºç•™è¨€æ¿ä¸­ç½®é¡¶ç•™è¨€é•¿æ°çš„é—®é¢˜ï¼šä¸€ä¸ªäº‹åŠ¡æ›´æ–°äº†ä¸¤å¼ è¡¨çš„æ•°æ®ï¼Œç„¶åä¸¤ä¸ªæ›´æ–°è¯­å¥åˆ†ç»™äº†ä¸¤ä¸ªworkerã€‚è¿™é—®é¢˜æˆ‘æœ‰ç‚¹ä¸æ˜ç™½ï¼Œå› ä¸ºçœ‹å®Œä¸“æ æˆ‘çš„è®¤çŸ¥æ˜¯ä¸€ä¸ªäº‹åŠ¡åªä¼šç»™ä¸€ä¸ªworkeræ‰§è¡Œï¼Œè¿™æ ·å°±ä¸ä¼šæœ‰å…ˆåcommité—®é¢˜ã€‚è¯·é—®è€å¸ˆæ˜¯æˆ‘çœ‹æ¼äº†ä»€ä¹ˆå—ï¼Ÿè¿™ç§æƒ…å†µåº”è¯¥ä¼šå‡ºç°åœ¨å“ªç§ç­–ç•¥ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439528,"discussion_content":"ä¸€ä¸ªäº‹åŠ¡åªèƒ½å‘ç»™ä¸€ä¸ªworkerçš„ï¼Œ\n\né•¿æ°è¯„è®ºçš„é‚£ä¸ªé—®é¢˜ï¼Œè®¨è®ºçš„æ˜¯å¦‚æœåˆ†æˆä¸¤ä¸ªäº‹åŠ¡ï¼Œç„¶åçº¦å®šä¸€èµ·æäº¤ï¼Œè¿™ä¸ªæ˜¯åšä¸åˆ°çš„ï¼ˆæˆ–è€…è¯´å®ç°èµ·æ¥å¾ˆå¤æ‚ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550452752,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":129551,"user_name":"MrVito","can_delete":false,"product_type":"c1","uid":1252169,"ip_address":"","ucode":"716FF6F8871706","user_header":"https://static001.geekbang.org/account/avatar/00/13/1b/49/ddefc656.jpg","comment_is_top":false,"comment_ctime":1567153272,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14452055160","product_id":100020801,"comment_content":"è¯´å®è¯ï¼Œè¿™ä¸€ç¯‡æ–‡ç« æˆ‘åœ¨æŒ‰è¡¨å¤åˆ¶å’ŒæŒ‰è¡Œå¤åˆ¶è¿™ä¸€æ®µè¿˜æ˜¯æ¸…æ™°çš„ï¼Œä½†æ˜¯åˆ°äº†å¹¶è¡Œå¤åˆ¶å°±ä¸æ˜¯å¾ˆæ¸…æ™°äº†ã€‚åœ¨MySQL5.7.22æ–°å¢äº†binlog-transaction-dependency-trackingï¼Œç”¨æ¥æ§åˆ¶æ˜¯éƒ½ä½¿ç”¨å¹¶è¡Œå¤åˆ¶ç­–ç•¥ï¼Œåˆ†ä¸ºcommit_orderï¼Œwritesetå’Œwriteset_sessionã€‚å¦‚æœéœ€è¦å¤‡åº“èµ¶å¿«è¿½ä¸Šä¸»åº“ï¼Œé‚£ä¹ˆå°±éœ€è¦æ›´å¿«çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥ï¼Œåœ¨è¿™é‡Œæˆ‘é€‰æ‹©è®¾ç½®ä¸ºwritesetï¼Œä¸ºä»€ä¹ˆï¼Œå› ä¸ºwritesetä¸éœ€è¦è§£æbinlogçš„å†…å®¹ï¼Œç›´æ¥å¹¶å‘æ‰§è¡Œå¤„ç†å†²çªï¼Œè€Œcommit_orderéœ€è¦åœ¨prepareé˜¶æ®µå’Œcommité˜¶æ®µåˆ¤æ–­æ˜¯å¦å¯ä»¥å¹¶è¡Œï¼Œè¿™æ ·ä¼šé€€åŒ–æˆå•çº¿ç¨‹ï¼Œå†å¹¶è¡Œå¤åˆ¶ï¼Œwriteset_sessionè¿˜è¦åœ¨writesetçš„åŸºç¡€ä¸Šå¤šä¸€ä¸ªçº¦æŸï¼Œè¦ä¿è¯å…ˆåé¡ºåºï¼Œä¿è¯è¿‡å…ˆåé¡ºåºå°±ä¼šé€€åŒ–æˆå•çº¿ç¨‹ï¼","like_count":3},{"had_liked":false,"id":65059,"user_name":"J!","can_delete":false,"product_type":"c1","uid":1305003,"ip_address":"","ucode":"71C946119B59D1","user_header":"https://static001.geekbang.org/account/avatar/00/13/e9/ab/37903736.jpg","comment_is_top":false,"comment_ctime":1549015007,"is_pvip":false,"replies":[{"id":"23064","content":"äº‹åŠ¡æäº¤çš„æ—¶å€™","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1549038415,"ip_address":"","comment_id":65059,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14433916895","product_id":100020801,"comment_content":"5.7 ç‰ˆæœ¬çš„åŸºäºç»„æäº¤çš„å¹¶è¡Œå¤åˆ¶ã€‚last_commitid æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™ç”Ÿæˆçš„ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438302,"discussion_content":"äº‹åŠ¡æäº¤çš„æ—¶å€™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549038415,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65051,"user_name":"alias cd=rm -rf","can_delete":false,"product_type":"c1","uid":1318325,"ip_address":"","ucode":"E7B27D76305B75","user_header":"https://static001.geekbang.org/account/avatar/00/14/1d/b5/971261fd.jpg","comment_is_top":false,"comment_ctime":1549012800,"is_pvip":false,"replies":[{"id":"23068","content":"å¯¹çš„ï¼ŒğŸ‘<br><br>","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1549038887,"ip_address":"","comment_id":65051,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14433914688","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼š<br><br>æ€è€ƒé¢˜ç­”æ¡ˆçš„çŒœæµ‹ï¼šå»ºè®®é‡‡ç”¨ WRITESETã€‚<br>WRITESET_SESSIONï¼šå› ä¸ºä¸»åº“æ˜¯å•çº¿ç¨‹æ’å…¥ï¼Œå¦‚æœé‡‡ç”¨WRITESET_SESSIONï¼Œé‚£ä¹ˆä¼šé€€åŒ–æˆå•çº¿ç¨‹ä¸»ä»å¤åˆ¶ã€‚<br>COMMIT_ORDERï¼šå› ä¸ºæ˜¯è¿½å†å²æ•°æ®ï¼Œæ‰€ä»¥ä¼šé€€åŒ–æˆå•çº¿ç¨‹ã€‚","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438297,"discussion_content":"å¯¹çš„ï¼ŒğŸ‘\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549038887,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63317,"user_name":"IceGeek17","can_delete":false,"product_type":"c1","uid":1103101,"ip_address":"","ucode":"1B42D7260449B4","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/fd/43802282.jpg","comment_is_top":false,"comment_ctime":1548321027,"is_pvip":false,"replies":[{"id":"22414","content":"çœ‹å®Œåˆ†äº«ä½ çš„å¿ƒå¾—å“ˆ ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1548322400,"ip_address":"","comment_id":63317,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14433222915","product_id":100020801,"comment_content":"å¥½æ–‡ï¼Œæ€»ç»“å¯¹æ¯”ä¸åŒçš„å¹¶è¡Œç­–ç•¥ï¼Œè®²çš„æ·±å…¥æµ…å‡ºï¼Œçœ‹å®Œè±ç„¶å¼€æœ—ã€‚æœ‰çœ‹æºä»£ç çš„å†²åŠ¨ã€‚","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437545,"discussion_content":"çœ‹å®Œåˆ†äº«ä½ çš„å¿ƒå¾—å“ˆ ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548322400,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61506,"user_name":"Mr.Strive.Z.H.L","can_delete":false,"product_type":"c1","uid":1030198,"ip_address":"","ucode":"6D97E159E2EECD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b8/36/542c96bf.jpg","comment_is_top":false,"comment_ctime":1547709338,"is_pvip":false,"replies":[{"id":"21861","content":"æˆ‘ä¹Ÿå»ºè®®å°½é‡å°‘ä½¿ç”¨å¤–é”®ï¼Œæˆ‘è‡ªå·±ç†è§£çš„å‡ ä¸ªåŸå› å§<br>1. è¿™ä¸ªå…³ç³»åº”è¯¥ç»´æŠ¤åœ¨å¼€å‘ç³»ç»Ÿçš„é€»è¾‘ä¸­ï¼Œæ”¾åœ¨æ•°æ®åº“é‡Œé¢ï¼Œæ¯”è¾ƒéšè”½ï¼Œå®¹æ˜“å¿˜è®°<br>2. å¤–é”®çº¦æŸå¯èƒ½ä¼šå¯¼è‡´æœ‰äº›æ›´æ–°å¤±è´¥<br>3. å¤–é”®çº¦æŸï¼ˆå°¤å…¶æ˜¯çº§è”æ›´æ–°ï¼‰å®¹æ˜“å‡ºç°éé¢„æœŸçš„ç»“æœ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547709781,"ip_address":"","comment_id":61506,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14432611226","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼š<br>ä»Šå¤©çš„å†…å®¹ä¸­å†™åˆ°ï¼šâ€œå¤–é”®çº¦æŸâ€ä¼šå¯¼è‡´å¹¶è¡Œå¤åˆ¶é€€åŒ–ä¸ºå•çº¿ç¨‹ã€‚<br>è¿™ä¸ªåœ°æ–¹æˆ‘å°±çªç„¶è”æƒ³åˆ°ï¼Œåœ¨ä¸šåŠ¡ä¸­ï¼Œç±»ä¼¼äºâ€œå¤–é”®â€è¿™ç§å…³ç³»æ˜¯ä¸€å®šå­˜åœ¨çš„ã€‚ä½†æ˜¯ä¸€èˆ¬åœ¨è®¾è®¡è¡¨çš„æ—¶å€™ï¼Œæ¯”å¦‚ï¼šè¡¨Açš„æŸä¸ªå”¯ä¸€é”®æ˜¯è¡¨Bçš„å¤–é”®ã€‚å¹¶ä¸ä¼šçœŸæ­£â€æ˜¾ç¤ºâ€çš„åœ¨æ•°æ®åº“è¡¨ä¸­åˆ›å»ºå¤–é”®å…³ç³»ã€‚ï¼ˆæŸ¥è¯¢çš„æ—¶å€™ï¼ŒæŸ¥è¯¢å‡ºAçš„è¿™ä¸ªå”¯ä¸€é”®ï¼Œç„¶åå†æ ¹æ®è¿™ä¸ªå”¯ä¸€é”®æŸ¥è¯¢è¡¨Bçš„æ•°æ®ï¼Œå¹¶ä¸ä¼šæœ‰çœŸæ­£çš„å¤–é”®å…³ç³»ï¼Œä¸€æ¬¡æ€§æŸ¥å‡ºæ‰€æœ‰å…³è”æ•°æ®ï¼‰<br>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436890,"discussion_content":"æˆ‘ä¹Ÿå»ºè®®å°½é‡å°‘ä½¿ç”¨å¤–é”®ï¼Œæˆ‘è‡ªå·±ç†è§£çš„å‡ ä¸ªåŸå› å§\n1. è¿™ä¸ªå…³ç³»åº”è¯¥ç»´æŠ¤åœ¨å¼€å‘ç³»ç»Ÿçš„é€»è¾‘ä¸­ï¼Œæ”¾åœ¨æ•°æ®åº“é‡Œé¢ï¼Œæ¯”è¾ƒéšè”½ï¼Œå®¹æ˜“å¿˜è®°\n2. å¤–é”®çº¦æŸå¯èƒ½ä¼šå¯¼è‡´æœ‰äº›æ›´æ–°å¤±è´¥\n3. å¤–é”®çº¦æŸï¼ˆå°¤å…¶æ˜¯çº§è”æ›´æ–°ï¼‰å®¹æ˜“å‡ºç°éé¢„æœŸçš„ç»“æœ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547709781,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58938,"user_name":"çº¦ä¹¦äºš","can_delete":false,"product_type":"c1","uid":1046714,"ip_address":"","ucode":"81EA27ADD9EC1A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","comment_is_top":false,"comment_ctime":1547257644,"is_pvip":false,"replies":[{"id":"21347","content":"å•Š ä¸æ˜¯ä¸æ˜¯<br>å¤‡åº“å¹¶è¡Œå¤åˆ¶è·Ÿsemi-syncæ²¡å…³ç³»çš„ã€‚<br>å¹¶ä¸æ˜¯è¯´â€œè®©æ‰€æœ‰çš„äº‹åŠ¡å¤„äºprepareçŠ¶æ€ï¼Œç„¶åä¸­é—´è¦ç­‰å¤‡åº“æ‰§è¡Œâ€<br><br><br>â€œå¤„äºprepareçŠ¶æ€çš„äº‹åŠ¡ï¼Œå¯ä»¥å¹¶è¡Œâ€ åœ¨å®ç°ä¸Šæ˜¯ï¼Œä¸»åº“åœ¨å†™binlogçš„æ—¶å€™ä¼šç»™è¿™äº›binlogé‡Œé¢è®°commit_idå’Œsequence_noï¼Œæ¥è¯´æ˜äº‹åŠ¡ä¹‹é—´åœ¨ä¸»åº“ä¸Šå¹¶è¡Œprepareçš„çŠ¶æ€ï¼›<br><br>å¤‡åº“æ˜¯é€šè¿‡è§£æbinlogæ‹¿åˆ° commit_id å’Œ sequence_noï¼Œæ¥å†³å®šè¦æ€ä¹ˆå¹¶å‘çš„ã€‚<br><br>","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547269063,"ip_address":"","comment_id":58938,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14432159532","product_id":100020801,"comment_content":"MySQL 5.7å¹¶è¡Œå¤åˆ¶é‚£é‡Œæ²¡æœ‰çœ‹æ‡‚ã€‚é—®é¢˜æœ‰ç‚¹å¤šè¯·è§è°…å“ˆã€‚<br>æ–‡ä¸­æåˆ°å¤„äºprepareçŠ¶æ€çš„äº‹åŠ¡ï¼Œå¯ä»¥å¹¶è¡Œã€‚<br>é‚£è¯´æ˜ï¼Œä¸»åº“commitä¹‹å‰ï¼Œå°±è¦æŠŠbinlogåŒæ­¥åˆ°ä»åº“äº†å§ï¼Ÿ (é—®é¢˜1)<br>è¿˜æåˆ°äº†prepareçŠ¶æ€å’ŒcommitçŠ¶æ€çš„äº‹åŠ¡ï¼Œå¯ä»¥å¹¶è¡Œã€‚<br>æˆ‘æƒ³è±¡ä¸­çš„åŒæ­¥çš„æ­¥éª¤æ˜¯ï¼Œä¸€ç»„äº‹åŠ¡ï¼ˆå…¶ä¸­æœ‰è¿˜æ²¡commitçš„ï¼Œä¹Ÿæœ‰å·²ç»commitçš„ï¼‰çš„binlogè¢«ä»åº“è·å–åˆ°ï¼Œå¹¶è¡Œæ‰§è¡Œsqlçš„åŒæ—¶å†åå»ä¸‹ä¸€ç»„äº‹åŠ¡ã€‚ä½†ä¸‹ä¸€ç»„äº‹åŠ¡åœ¨ä¸Šä¸€ç»„æ‰§è¡Œå®Œä¹‹å‰ï¼Œä¸ä¼šæ‰§è¡Œã€‚æ‰€ä»¥å°±æ˜¯è¿™æ ·çš„æµç¨‹ ï¼š åŒæ­¥binlog-&gt;æ‰§è¡Œï¼ŒåŒæ—¶åŒæ­¥æ–°binlog-&gt;ç­‰å¾…æ‰§è¡Œå®Œ-&gt;æ‰§è¡Œï¼ŒåŒæ—¶åŒæ­¥æ–°binlogã€‚<br>æ˜¯è¿™æ ·å—ï¼ˆé—®é¢˜2ï¼‰<br>å¯ä¸ºä»€ä¹ˆä»åº“ä¼šçœ‹åˆ°prepareå’Œcommitçš„ä¸¤ç§äº‹åŠ¡ï¼Œè€Œä¸å…¨æ˜¯preparedï¼Ÿ(é—®é¢˜3)<br>éšçº¦è§‰å¾—è¿™ä¼¼ä¹æ¶‰åŠåˆ°äº†å¼‚æ­¥&#47;åŠåŒæ­¥ï¼ŒAFTER_COMMIT&#47;AFTER_SYNCçš„å†…å®¹äº†ï¼Œåé¢ä¼šæœ‰è¯¦ç»†ä»‹ç»å˜›ï¼Ÿ(é—®é¢˜4)<br><br>","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436253,"discussion_content":"å•Š ä¸æ˜¯ä¸æ˜¯\nå¤‡åº“å¹¶è¡Œå¤åˆ¶è·Ÿsemi-syncæ²¡å…³ç³»çš„ã€‚\nå¹¶ä¸æ˜¯è¯´â€œè®©æ‰€æœ‰çš„äº‹åŠ¡å¤„äºprepareçŠ¶æ€ï¼Œç„¶åä¸­é—´è¦ç­‰å¤‡åº“æ‰§è¡Œâ€\n\n\nâ€œå¤„äºprepareçŠ¶æ€çš„äº‹åŠ¡ï¼Œå¯ä»¥å¹¶è¡Œâ€ åœ¨å®ç°ä¸Šæ˜¯ï¼Œä¸»åº“åœ¨å†™binlogçš„æ—¶å€™ä¼šç»™è¿™äº›binlogé‡Œé¢è®°commit_idå’Œsequence_noï¼Œæ¥è¯´æ˜äº‹åŠ¡ä¹‹é—´åœ¨ä¸»åº“ä¸Šå¹¶è¡Œprepareçš„çŠ¶æ€ï¼›\n\nå¤‡åº“æ˜¯é€šè¿‡è§£æbinlogæ‹¿åˆ° commit_id å’Œ sequence_noï¼Œæ¥å†³å®šè¦æ€ä¹ˆå¹¶å‘çš„ã€‚\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547269063,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537753,"discussion_content":"å…¶å®æ„æ€å°±æ˜¯ç±»ä¼¼mariadbçš„å¹¶è¡Œç­–ç•¥ã€‚å¦‚æœmysqlæ²¡æœ‰å»¶è¿Ÿbinlog syncçš„æ•°é‡ï¼Œé‚£ä¹ˆï¼Œä¸€æ¬¡çš„ç»„æäº¤å¯èƒ½äº‹åŠ¡å°±æ¯”è¾ƒå°‘ã€‚ä½†æ˜¯åœ¨ä»åº“å¹¶è¡Œæ‰§è¡Œçš„æ—¶å€™ï¼Œè¿˜æ˜¯è¦ä¸€ç»„æ‰§è¡Œå®Œå†å¹¶è¡Œä¸‹ä¸€ç»„ã€‚æ‰€ä»¥ï¼Œå¦‚æœä¸»åº“å»¶è¿Ÿbinlog syncï¼Œé‚£ä¹ˆæ¯æ¬¡ç»„æäº¤çš„äº‹åŠ¡å°±æ›´å¤šï¼Œåœ¨ä»åº“ç¬¦åˆå¹¶è¡Œæ¡ä»¶çš„äº‹åŠ¡æ•°é‡ä¹Ÿå˜å¤šäº†ï¼Œè¿™æ ·å³ä½¿è¿˜æ˜¯ä¸€ç»„å¹¶è¡Œå®Œï¼Œåœ¨å¹¶è¡Œä¸‹ä¸€ç»„çš„ç­–ç•¥ã€‚æ•ˆæœã€æ€§èƒ½éƒ½ä¼šæ¯”mariadbå®ç°çš„æ›´å¥½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639152831,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":171731,"user_name":"longhaiqwe","can_delete":false,"product_type":"c1","uid":1061318,"ip_address":"","ucode":"A5AEE950A7AF35","user_header":"https://static001.geekbang.org/account/avatar/00/10/31/c6/27225119.jpg","comment_is_top":false,"comment_ctime":1579002540,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10168937132","product_id":100020801,"comment_content":"&quot;èƒ½å¤Ÿåœ¨åŒä¸€ç»„é‡Œæäº¤çš„äº‹åŠ¡ï¼Œä¸€å®šä¸ä¼šä¿®æ”¹åŒä¸€è¡Œ&quot;<br>è¿™å¥è¯ä¸æ˜¯å¾ˆç†è§£ï¼Œå¦‚æœinnodb_flush_log_at_trx_commit=0çš„è¯ï¼Œé‚£ä¹ˆredo log bufferé‡Œé¢å°±å¯èƒ½ä¼šæœ‰å¾ˆå¤šå·²ç»commitäº†çš„äº‹åŠ¡ï¼Œé‚£ä¹ˆå®ƒä»¬æœ‰å¯èƒ½ä¼šä¿®æ”¹åŒä¸€è¡Œå•Šï¼Ÿ<br>è¯·è€å¸ˆé‡Šç–‘é—®ï¼Œè°¢è°¢","like_count":2},{"had_liked":false,"id":115469,"user_name":"miracle","can_delete":false,"product_type":"c1","uid":1276137,"ip_address":"","ucode":"FD7074F1062AE9","user_header":"https://static001.geekbang.org/account/avatar/00/13/78/e9/9d807269.jpg","comment_is_top":false,"comment_ctime":1563594810,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"10153529402","product_id":100020801,"comment_content":"è¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼Œçœ‹äº†ä¸‰éè¿˜æ˜¯æ²¡æ˜ç™½ æ–‡ä¸­è¯´çš„ MariaDB çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥ ä¸»åº“ä¸Šå¯ä»¥ä¸€ç»„äº‹åŠ¡ committing çš„åŒæ—¶å¦ä¸€ç»„äº‹åŠ¡åœ¨ running ä¸ºä»€ä¹ˆåœ¨ä»åº“ä¸Šå°±å¿…é¡»è¦ç­‰åˆ° committing ç»“æŸä¹‹åå¦ä¸€ç»„æ‰èƒ½ runningå‘¢ å¸Œæœ›è€å¸ˆæœ‰ç©ºèƒ½è§£ç­”ä¸‹è¿™ä¸ªé—®é¢˜","like_count":2,"discussions":[{"author":{"id":1458200,"avatar":"https://static001.geekbang.org/account/avatar/00/16/40/18/cc3804e2.jpg","nickname":"æ²ˆæ´ªå½¬","note":"","ucode":"F9911236D0BA1C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":100435,"discussion_content":"ä¸»åº“ä¸Šæ˜¯é”æ§åˆ¶å¹¶å‘ï¼Œæ‰€ä»¥ä¸»ä¸Šå¯èƒ½å¦å¤–äº‹ç‰©åªæ˜¯ç­‰å¾…é”ã€‚\n ä»åº“ä¸Šæ˜¯é€šè¿‡åˆ†å‘æ§åˆ¶å¹¶å‘ï¼Œç­–ç•¥æ˜¯æ‰§è¡Œå®Œä¸€ç»„ä¹‹åæ‰ä¼šæ‰§è¡Œä¸‹ä¸€ç»„ã€‚æ‰€ä»¥ä»åº“ä¸Šç­‰å¾…é”ä¹‹å‰çš„æ­¥éª¤ä¹Ÿæ²¡åšï¼Œæ¯”å¦‚:åŠ è½½æ•°æ®åˆ°buffer_pool ä¹‹ç±»çš„ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1577259999,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1276137,"avatar":"https://static001.geekbang.org/account/avatar/00/13/78/e9/9d807269.jpg","nickname":"miracle","note":"","ucode":"FD7074F1062AE9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1458200,"avatar":"https://static001.geekbang.org/account/avatar/00/16/40/18/cc3804e2.jpg","nickname":"æ²ˆæ´ªå½¬","note":"","ucode":"F9911236D0BA1C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":101660,"discussion_content":"æ‰€ä»¥ä»åº“ä¸Šç­‰å¾…é”ä¹‹å‰çš„æ­¥éª¤ä¹Ÿæ²¡åšï¼Œæ¯”å¦‚:åŠ è½½æ•°æ®åˆ°buffer_pool ä¹‹ç±»çš„ã€‚\nè¿™äº›æ²¡åšæ˜¯ä¸ºäº†åŠ é€Ÿä¸²è¡Œæ‰§è¡Œæ•ˆç‡å—è¿˜æ˜¯ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1577288999,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":100435,"ip_address":""},"score":101660,"extra":""}]}]},{"had_liked":false,"id":110388,"user_name":"null","can_delete":false,"product_type":"c1","uid":1024294,"ip_address":"","ucode":"F9039EFED6B55D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","comment_is_top":false,"comment_ctime":1562246982,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10152181574","product_id":100020801,"comment_content":"åŸæ–‡ï¼š<br>è¿™æ—¶å€™ä¸»åº“å¯¹è¡¨ t åšäº†ä¸€ä¸ªåŠ å­—æ®µæ“ä½œï¼Œå³ä½¿è¿™ä¸ªè¡¨å¾ˆå°ï¼Œè¿™ä¸ª DDL åœ¨å¤‡åº“åº”ç”¨çš„æ—¶å€™ä¹Ÿä¼šè¢«å µä½ï¼Œä¹Ÿã€–ä¸èƒ½ã€—çœ‹åˆ°è¿™ä¸ªç°è±¡ã€‚<br><br>è€å¸ˆï¼Œåº”è¯¥æ˜¯ä¹Ÿèƒ½çœ‹åˆ°è¿™ä¸ªç°è±¡å§","like_count":2},{"had_liked":false,"id":59043,"user_name":"è§‚å¼ˆé“äºº","can_delete":false,"product_type":"c1","uid":1016905,"ip_address":"","ucode":"F3BB619A33C605","user_header":"https://static001.geekbang.org/account/avatar/00/0f/84/49/47d48fd0.jpg","comment_is_top":false,"comment_ctime":1547285460,"is_pvip":false,"replies":[{"id":"21370","content":"serializableéš”ç¦»çº§åˆ«ç¡®å®ç”¨å¾—å¾ˆå°‘ï¼ˆæˆ‘æ²¡æœ‰è§è¿‡åœ¨ç”Ÿäº§ä¸Šä½¿ç”¨çš„å“ˆï¼‰","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547293084,"ip_address":"","comment_id":59043,"utype":1}],"discussion_count":4,"race_medal":0,"score":"10137220052","product_id":100020801,"comment_content":"ä¸è€å¸ˆä½ å¥½ï¼Œé—®ä¸ªé¢˜å¤–é—®é¢˜ï¼Œmysqlå·²ç»é€šè¿‡gapé”è§£å†³äº†åœ¨rrçº§åˆ«ä¸‹çš„å¹»è¯»é—®é¢˜ï¼Œé‚£ä¹ˆserializableéš”ç¦»çº§åˆ«ç›®å‰è¿˜æœ‰ä»€ä¹ˆç”¨é€”ï¼Œä¸€èˆ¬æ–‡ç« ä¸Šè¯´çš„ï¼Œserializable ä¸»è¦æ˜¯ä¸ºäº†è§£å†³å¹»è¯»ï¼Œè°¢è°¢å›ç­”ã€‚","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436282,"discussion_content":"serializableéš”ç¦»çº§åˆ«ç¡®å®ç”¨å¾—å¾ˆå°‘ï¼ˆæˆ‘æ²¡æœ‰è§è¿‡åœ¨ç”Ÿäº§ä¸Šä½¿ç”¨çš„å“ˆï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547293084,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1798004,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/6f/74/a8567e21.jpg","nickname":"awesome","note":"","ucode":"46175C176DF410","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582814,"discussion_content":"åœ¨RRéš”ç¦»çº§åˆ«ä¸‹ï¼Œå¦‚æœä¸€ä¸ªäº‹åŠ¡ä»å¤´åˆ°å°¾å°±åªæœ‰å¿«ç…§è¯»ï¼Œé‚£ä¹ˆMVCCè§£å†³äº†å¹»è¯»çš„é—®é¢˜ã€‚å¦‚æœä¸€ä¸ªäº‹åŠ¡ä»å¤´åˆ°å°¾åªæœ‰å½“å‰è¯»ï¼Œé‚£ä¹ˆé€šè¿‡é—´éš™é”å’Œä¸´å»ºé”ä¹Ÿè§£å†³äº†å¹»è¯»é—®é¢˜ã€‚ä½†æ˜¯å¦‚æœä¸€ä¸ªäº‹åŠ¡æ—¢æœ‰å¿«ç…§è¯»ä¹Ÿæœ‰å½“å‰è¯»ï¼Œé‚£ä¹ˆMVCCå°±è§£å†³ä¸äº†å¹»è¯»é—®é¢˜ã€‚è¿™æ—¶å€™serializableç™»åœºäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659688187,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1293877,"avatar":"https://static001.geekbang.org/account/avatar/00/13/be/35/dd79037e.jpg","nickname":"a...Z","note":"","ucode":"5A5A44903785FD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":120913,"discussion_content":"gap æ— æ³•å®Œå…¨è§£å†³rrçº§åˆ«çš„å¹»è¯»é—®é¢˜ï¼Œåªæ˜¯è§£å†³äº†å½“å‰è¯»å’Œå½“å‰è¯»åˆ°äº‹åŠ¡æäº¤æ—¶è¿™ä¸ªè¿‡ç¨‹çš„å¹»è¯»é—®é¢˜å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578304393,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1293877,"avatar":"https://static001.geekbang.org/account/avatar/00/13/be/35/dd79037e.jpg","nickname":"a...Z","note":"","ucode":"5A5A44903785FD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":167339,"discussion_content":"ä¸æ˜¯å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581478704,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":120913,"ip_address":""},"score":167339,"extra":""}]}]},{"had_liked":false,"id":58859,"user_name":"ä¿¡ä¿¡","can_delete":false,"product_type":"c1","uid":1303865,"ip_address":"","ucode":"8DF0EC045579FD","user_header":"https://static001.geekbang.org/account/avatar/00/13/e5/39/951f89c8.jpg","comment_is_top":false,"comment_ctime":1547215372,"is_pvip":false,"replies":[{"id":"21310","content":"è·Ÿæœ€å¼€å§‹ä»‹ç»çš„ç­–ç•¥ä¸€æ ·ï¼Œupdateçš„writeseté‡Œï¼Œ æ¯ä¸€ä¸ªå”¯ä¸€ç´¢å¼•å°±å¯¹åº”ä¸¤ä¸ªhashå€¼<br>","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547233226,"ip_address":"","comment_id":58859,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10137149964","product_id":100020801,"comment_content":"æ–‡ä¸­æåˆ°ï¼š5.7.22çš„å¹¶è¡Œå¤åˆ¶ä¸­ï¼Œå¯¹äºæ¯ä¸ªå”¯ä¸€ç´¢å¼•ï¼Œinsert è¯­å¥å¯¹åº”çš„ writeset å°±è¦å¤šå¢åŠ ä¸€ä¸ª hash å€¼ã€‚è¿™æ˜¯ä¸æ˜¯åªé€‚ç”¨äºrowæ ¼å¼çš„binlogå•Šï¼Ÿå› ä¸ºupdate æœ€ç»ˆä¹Ÿæ˜¯æ‹†æˆäº†deleteå’Œinsertã€‚ã€‚ã€‚å¦å¤–ï¼Œå¦‚æœæ˜¯statementæ ¼å¼çš„binlogï¼Œé‚£ä¹ˆå”¯ä¸€ç´¢å¼•çš„updateè¯­å¥åº”è¯¥ä¹Ÿéœ€è¦å¤šå¢åŠ ä¸€ä¸ªhashå€¼äº†å§ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436236,"discussion_content":"è·Ÿæœ€å¼€å§‹ä»‹ç»çš„ç­–ç•¥ä¸€æ ·ï¼Œupdateçš„writeseté‡Œï¼Œ æ¯ä¸€ä¸ªå”¯ä¸€ç´¢å¼•å°±å¯¹åº”ä¸¤ä¸ªhashå€¼\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547233226,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58685,"user_name":"ä½ æœ‰èµ„æ ¼å—ï¼Ÿ","can_delete":false,"product_type":"c1","uid":1233534,"ip_address":"","ucode":"4758C5A190BABB","user_header":"https://static001.geekbang.org/account/avatar/00/12/d2/7e/bd8c372a.jpg","comment_is_top":false,"comment_ctime":1547174994,"is_pvip":false,"replies":[{"id":"21215","content":"çœ‹åˆ°ä½ çš„ç”¨æˆ·åï¼Œæˆ‘å“äº†ä¸€è·³ğŸ˜…","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547178599,"ip_address":"","comment_id":58685,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10137109586","product_id":100020801,"comment_content":"æ‰“å¡","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436172,"discussion_content":"çœ‹åˆ°ä½ çš„ç”¨æˆ·åï¼Œæˆ‘å“äº†ä¸€è·³ğŸ˜…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547178599,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":260994,"user_name":"å¾ä¹ƒå¤§ç¥","can_delete":false,"product_type":"c1","uid":1320247,"ip_address":"","ucode":"8D14359AD04A09","user_header":"https://static001.geekbang.org/account/avatar/00/14/25/37/fe05351b.jpg","comment_is_top":false,"comment_ctime":1605169581,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5900136877","product_id":100020801,"comment_content":"å­¦ä¹ è€å¸ˆçš„ä¸“æ çœŸæ˜¯ä¹…æ—±é‡ç”˜éœ²ï¼Œæ»¡æ»¡çš„å…¨æ˜¯å¹²è´§ã€‚æ¯çœ‹ä¸€ç¯‡éƒ½æ˜¯æ”¶è·ï¼Œå¯¹ä¹‹å‰ç¢°åˆ°çš„MySQLé—®é¢˜éƒ½æ˜¯é†é†çŒé¡¶è§£æï¼Œçªç„¶è§‰å¾—CRUDè¿™ä¹ˆå¤šå¹´çœŸçš„å…¨CRUDäº†ã€‚åŒæ—¶ä¹Ÿå­¦äº†å…¶ä»–çš„ä¸“æ ï¼Œæ²¡æœ‰å¯¹æ¯”å°±æ²¡æœ‰ä¼¤å®³ï¼Œè¿™å°±æœ€å¥½ä¸“æ æ²¡æœ‰ä¹‹ä¸€ã€‚","like_count":1},{"had_liked":false,"id":181520,"user_name":"æ‚ æ‚ å°ç«¹å­","can_delete":false,"product_type":"c1","uid":1061786,"ip_address":"","ucode":"A5E6731D28EBF9","user_header":"https://static001.geekbang.org/account/avatar/00/10/33/9a/a323b2f1.jpg","comment_is_top":false,"comment_ctime":1582554241,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5877521537","product_id":100020801,"comment_content":"å¯¹äºçƒ­ç‚¹è¡Œçš„æ›´æ–°æœ‰ä»€ä¹ˆå¥½çš„è§£å†³æ–¹æ¡ˆå—ï¼Ÿ","like_count":1},{"had_liked":false,"id":120324,"user_name":"é’±","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1564830931,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5859798227","product_id":100020801,"comment_content":"åŸç†åŸºæœ¬èƒ½æ˜ç™½ï¼Œä¸è¿‡ç»†èŠ‚åŸºæœ¬éƒ½åœ¨åˆ·æ–°è‡ªå·±çš„è®¤çŸ¥ï¼Œä¸‡å¹¸é‡åˆ°å¦‚æ­¤ç‰›é€¼çš„è€å¸ˆã€‚<br>ä¸€ä¸ªç”Ÿäº§çš„å¿«ä¸€ä¸ªæ¶ˆè´¹çš„æ…¢ï¼Œå»¶è¿Ÿä½•æ­¢å‡ ä¸ªå°æ—¶ï¼Œææ€•æ­¤ç”Ÿéƒ½èµ¶ä¸ä¸Šã€‚","like_count":1},{"had_liked":false,"id":83665,"user_name":"å”¯å¥¹å‘½","can_delete":false,"product_type":"c1","uid":1240398,"ip_address":"","ucode":"8F687E8D306840","user_header":"https://static001.geekbang.org/account/avatar/00/12/ed/4e/ef406442.jpg","comment_is_top":false,"comment_ctime":1554693416,"is_pvip":false,"replies":[{"id":"32455","content":"è¿™é‡Œæ²¡æœ‰çŸ›ç›¾å“ˆã€‚å›¾6ä¸­ï¼Œç”»åœ¨åŒä¸€ç»„çš„ï¼Œå°±è¡¨ç¤ºå¯ä»¥å¹¶è¡Œæ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå›¾6ä¸­ï¼Œ123æ˜¯å¹¶è¡Œæ‰§è¡Œï¼Œç„¶å456å¹¶è¡Œï¼Œç„¶å789å¹¶è¡Œ","user_name":"ä½œè€…å›å¤","user_name_real":"Jingï½","uid":"1059377","ctime":1556593738,"ip_address":"","comment_id":83665,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5849660712","product_id":100020801,"comment_content":"è€å¸ˆ æˆ‘è§‰å¾—å›¾6å¥½åƒæœ‰é—®é¢˜å•Šï¼Œåœ¨å›¾5ä¸­,ä¸»åº“trx1,trx2,trx3æ˜¯åŒä¸€ç»„é‡Œé¢çš„äº‹åŠ¡ï¼Œä»–ä»¬æ‹¥æœ‰ç›¸åŒçš„commit_idï¼Œä»–ä»¬åˆ°å¤‡åº“é‡Œé¢éœ€è¦è¢«åˆ†åˆ°ä¸åŒçš„workeré‡Œé¢å»æ‰§è¡Œï¼Œä½†æ˜¯å›¾6é‡Œé¢ï¼Œtrx1,trx2,trx3è¿˜ä¾ç„¶åœ¨ä¸€ç»„é‡Œé¢ï¼Ÿè¿™æ˜¯ä¸æ˜¯çŸ›ç›¾äº†ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1059377,"avatar":"https://static001.geekbang.org/account/avatar/00/10/2a/31/9edbf8a6.jpg","nickname":"è´¾é™","note":"","ucode":"081E70CC01F6B8","race_medal":0,"user_type":8,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446120,"discussion_content":"è¿™é‡Œæ²¡æœ‰çŸ›ç›¾å“ˆã€‚å›¾6ä¸­ï¼Œç”»åœ¨åŒä¸€ç»„çš„ï¼Œå°±è¡¨ç¤ºå¯ä»¥å¹¶è¡Œæ‰§è¡Œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå›¾6ä¸­ï¼Œ123æ˜¯å¹¶è¡Œæ‰§è¡Œï¼Œç„¶å456å¹¶è¡Œï¼Œç„¶å789å¹¶è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556593738,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1336951,"avatar":"https://static001.geekbang.org/account/avatar/00/14/66/77/194ba21d.jpg","nickname":"lzh","note":"","ucode":"C3D83DF4230109","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":18974,"discussion_content":"æ—¢ç„¶èƒ½åœ¨åŒä¸€ç»„commitï¼Œå°±æ˜¯è¯´æ˜åœ¨ä¸»åº“è¿™å‡ ä¸ªäº‹åŠ¡å½¼æ­¤æ²¡æœ‰å†²çªï¼Œç„¶åä»åº“é‡æ”¾æ—¶åˆ†é…åˆ°ä¸åŒworkeré‡Œæ˜¯å†è‡ªç„¶ä¸è¿‡çš„äº‹æƒ…äº†ï¼Œæœ¬æ¥å°±æ˜¯ä¸€ç»„çš„äº‹åŠ¡å°±è¦åˆ†é…åˆ°ä¸åŒworker....","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569123850,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":64770,"user_name":"æ—¶éšæ—¶ç°","can_delete":false,"product_type":"c1","uid":1111899,"ip_address":"","ucode":"DA4D622FF84920","user_header":"https://static001.geekbang.org/account/avatar/00/10/f7/5b/d2e7c2c4.jpg","comment_is_top":false,"comment_ctime":1548903786,"is_pvip":false,"replies":[{"id":"22943","content":"è¿™ä¸ªæè¿°åº”è¯¥æ˜¯ä¸»è¦è€ƒè™‘åœ¨æœ‰ä¸»é”®çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡rowé‡Œé¢çš„ä¿¡æ¯å–å‡ºä¸»é”®ç›´æ¥å®šä½è®°å½•ã€‚<br><br>ä½ è¯´çš„è¿™äº›å…¶å®åŠ£åŠ¿ç¡®å®ä¹Ÿæ˜¯å­˜åœ¨çš„ ğŸ˜†","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1548935091,"ip_address":"","comment_id":64770,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5843871082","product_id":100020801,"comment_content":"Furthermore, given that changes are propagated and applied in row-based format, this means that they are received in an optimized and compact format, and likely reducing the number of IO operations required when compared to the originating member.<br>è¿™ä¸ªæ˜¯å®˜æ¡£ä¸Šå¯¹MGRçš„ä¸€æ®µè§£è¯»ï¼Œæˆ‘çš„ç–‘é—®æ˜¯ï¼š<br>ä¸ºä½•row-base replicationåœ¨ä»åº“å›æ”¾æ—¶ä¼šèŠ‚çœå¤§é‡IOï¼Ÿ<br>å€™é€‰ç­”æ¡ˆï¼š<br>1ã€çœå»äº†sqlè§£æï¼Œç›´æ¥è°ƒç”¨do_command<br>2ã€ï¼Ÿï¼Ÿ<br>å¯æ˜¯rowå¤åˆ¶æœ‰å…¶ä»–å¯èƒ½å­˜åœ¨çš„åŠ£åŠ¿ï¼Œæ¯”å¦‚å•ä¸ªå¤§dmlä¼šè¢«è§£ææˆå¤šä¸ªdml_eventè¿›è¡Œé‡æ”¾ï¼Œä¸‡ä¸€è¯¥è¡¨æ²¡æœ‰ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•ï¼Œåªèƒ½é‡‡ç”¨äºŒçº§ç´¢å¼•æˆ–è€…å…¨è¡¨æ‰«æ(å¼€å¯hash_scanä¹Ÿå¯ä»¥)ï¼Œæ‰€ä»¥ï¼Œå®˜æ¡£ä¸Šç›´æ¥è¯´ä¼šå‡å°‘å¤§é‡IOæ˜¯ä¸æ˜¯æœ‰ç‚¹å¤ªæ­¦æ–­äº†","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438168,"discussion_content":"è¿™ä¸ªæè¿°åº”è¯¥æ˜¯ä¸»è¦è€ƒè™‘åœ¨æœ‰ä¸»é”®çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡rowé‡Œé¢çš„ä¿¡æ¯å–å‡ºä¸»é”®ç›´æ¥å®šä½è®°å½•ã€‚\n\nä½ è¯´çš„è¿™äº›å…¶å®åŠ£åŠ¿ç¡®å®ä¹Ÿæ˜¯å­˜åœ¨çš„ ğŸ˜†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548935091,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2439786,"avatar":"https://static001.geekbang.org/account/avatar/00/25/3a/6a/61645df6.jpg","nickname":"å°å”Eden","note":"","ucode":"13644850F7BEC5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590333,"discussion_content":"MGRå¼ºåˆ¶çº¦æŸè¡¨ä¸­å¿…é¡»åŒ…å«ä¸»é”®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665663420,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å››å·"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61089,"user_name":"äº¢æ˜Ÿä¸œ","can_delete":false,"product_type":"c1","uid":1303322,"ip_address":"","ucode":"5E4063E83B2BB9","user_header":"https://static001.geekbang.org/account/avatar/00/13/e3/1a/061e77b6.jpg","comment_is_top":false,"comment_ctime":1547618513,"is_pvip":false,"replies":[{"id":"21760","content":"è¿™ä¸ªæ˜¯è¦ç»“åˆä¸šåŠ¡çš„ï¼Œæ¯”å¦‚è¦åˆ é™¤100ä¸‡è¡Œï¼Œæ”¹æˆ100ä¸ªäº‹åŠ¡ï¼Œæ¯ä¸ªäº‹åŠ¡åˆ é™¤1ä¸‡è¡Œï¼Œè¿™æ ·çš„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547621976,"ip_address":"","comment_id":61089,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5842585809","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œå¦‚ä½•å°†å¤§äº‹åŠ¡æ‹†æˆå°äº‹åŠ¡","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436739,"discussion_content":"è¿™ä¸ªæ˜¯è¦ç»“åˆä¸šåŠ¡çš„ï¼Œæ¯”å¦‚è¦åˆ é™¤100ä¸‡è¡Œï¼Œæ”¹æˆ100ä¸ªäº‹åŠ¡ï¼Œæ¯ä¸ªäº‹åŠ¡åˆ é™¤1ä¸‡è¡Œï¼Œè¿™æ ·çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547621976,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60937,"user_name":"é“","can_delete":false,"product_type":"c1","uid":1100869,"ip_address":"","ucode":"B17CA7372C21C1","user_header":"https://static001.geekbang.org/account/avatar/00/10/cc/45/73a0f7f8.jpg","comment_is_top":false,"comment_ctime":1547597013,"is_pvip":false,"replies":[{"id":"21730","content":"å› ä¸ºè¿™ä¸¤ä¸ªworkeræ²¡åŠæ³•â€œçº¦å¥½ä¸€èµ·æäº¤â€ï¼Œè¿™ä¸ªæ˜¯å±äºä¸¤ä¸ªçº¿ç¨‹äº†<br>","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547605220,"ip_address":"","comment_id":60937,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5842564309","product_id":100020801,"comment_content":"è€å¸ˆï¼Œè¿™æ®µä¸å¤ªç†è§£ï¼šâ€œä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªäº‹åŠ¡æ›´æ–°äº†è¡¨ t1 å’Œè¡¨ t2 ä¸­çš„å„ä¸€è¡Œï¼Œå¦‚æœè¿™ä¸¤æ¡æ›´æ–°è¯­å¥è¢«åˆ†åˆ°ä¸åŒ worker çš„è¯ï¼Œè™½ç„¶æœ€ç»ˆçš„ç»“æœæ˜¯ä¸»å¤‡ä¸€è‡´çš„ï¼Œä½†å¦‚æœè¡¨ t1 æ‰§è¡Œå®Œæˆçš„ç¬é—´ï¼Œå¤‡åº“ä¸Šæœ‰ä¸€ä¸ªæŸ¥è¯¢ï¼Œå°±ä¼šçœ‹åˆ°è¿™ä¸ªäº‹åŠ¡â€œæ›´æ–°äº†ä¸€åŠçš„ç»“æœâ€ï¼Œç ´åäº†äº‹åŠ¡é€»è¾‘çš„åŸå­æ€§ã€‚â€å¤‡åº“ä¸Šçš„æŸ¥è¯¢å±äºå¦å¤–ä¸€ä¸ªäº‹åŠ¡ï¼ŒæŒ‰ç…§å¯é‡å¤è¯»éš”ç¦»çº§åˆ«ï¼Œè¿™ä¸ªæŸ¥è¯¢ä¸åº”è¯¥çœ‹åˆ°å¦å¤–ä¸€ä¸ªäº‹åŠ¡â€œæ›´æ–°äº†ä¸€åŠçš„ç»“æœâ€å•Šã€‚å³ä¾¿æ˜¯è¿™ä¸¤æ¡æ›´æ–°è¯­å¥è¢«åˆ†åˆ°ä¸åŒ worker ï¼Œä¹Ÿåº”è¯¥ä¿è¯äº‹åŠ¡çš„åŸå­æ€§å•Šï¼Œéš¾é“æ˜¯æŠ€æœ¯ä¸Šæœ‰å›°éš¾å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436674,"discussion_content":"å› ä¸ºè¿™ä¸¤ä¸ªworkeræ²¡åŠæ³•â€œçº¦å¥½ä¸€èµ·æäº¤â€ï¼Œè¿™ä¸ªæ˜¯å±äºä¸¤ä¸ªçº¿ç¨‹äº†\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547605220,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60582,"user_name":"å¤©ä½¿ä¹‹å‰‘","can_delete":false,"product_type":"c1","uid":1306842,"ip_address":"","ucode":"69B2D109AE282F","user_header":"https://static001.geekbang.org/account/avatar/00/13/f0/da/74bbb9e6.jpg","comment_is_top":false,"comment_ctime":1547516007,"is_pvip":false,"replies":[{"id":"21619","content":"è¿˜æ˜¯ç”¨gtidé›†åˆåˆ¤æ–­å§ğŸ˜“","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547526363,"ip_address":"","comment_id":60582,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5842483303","product_id":100020801,"comment_content":"mysql 5.7å¹¶è¡Œå¤åˆ¶æœ‰ä¸€ä¸ªbugï¼Œæ˜¯seconds_behind_masterè®°å½•å¹¶ä¸å‡†ç¡®ï¼Œæ˜¾ç¤ºä¸º0ï¼Œä½†æ˜¯å®é™…å¹¶ä¸ä¸º0ï¼Œèƒ½ä¸èƒ½è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆï¼Ÿå¹¶ä¸”æœ‰æ²¡æœ‰å…¶ä»–åœ°æ–¹å¯ä»¥è¯»åˆ°å‡†ç¡®çš„å€¼å‘¢","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436550,"discussion_content":"è¿˜æ˜¯ç”¨gtidé›†åˆåˆ¤æ–­å§ğŸ˜“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547526363,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58739,"user_name":"é”…å­","can_delete":false,"product_type":"c1","uid":1323048,"ip_address":"","ucode":"4A9143AFB07FF2","user_header":"https://static001.geekbang.org/account/avatar/00/14/30/28/6e019a7a.jpg","comment_is_top":false,"comment_ctime":1547187403,"is_pvip":false,"replies":[{"id":"21229","content":"é‚£å°±æ˜¯ä»¥slave_parallel_type=databaseä¸ºå‡†äº†","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547190275,"ip_address":"","comment_id":58739,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5842154699","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œç”±ä¸€ä¸ªç–‘é—®ï¼Œåœ¨MySQL5.7.22ä¸­ï¼Œslave_parallel_type=databaseï¼Œè€Œbinlog_transaction_dependency_tracking=commit_orderï¼Œè¿™2ä¸ªå‚æ•°ä¼šä¸ä¼šå†²çªå‘¢ï¼Ÿå¦‚æœä¼šä»¥å“ªä¸ªç­–ç•¥ä¸ºå‡†å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436194,"discussion_content":"é‚£å°±æ˜¯ä»¥slave_parallel_type=databaseä¸ºå‡†äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547190275,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58705,"user_name":"å€ªå¤§äºº","can_delete":false,"product_type":"c1","uid":1193052,"ip_address":"","ucode":"4798D69F3E86FB","user_header":"https://static001.geekbang.org/account/avatar/00/12/34/5c/6b4757a0.jpg","comment_is_top":false,"comment_ctime":1547179552,"is_pvip":false,"replies":[{"id":"21224","content":"æˆ‘ä¹Ÿæ²¡æƒ³åˆ°æœ‰ä»€ä¹ˆåœºæ™¯å¿…é¡»å¾—ç”¨WRITESET_SESSION","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547180339,"ip_address":"","comment_id":58705,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5842146848","product_id":100020801,"comment_content":"å•Šçªç„¶å‘ç°å‰é¢ç†è§£é”™äº†<br>æ±‚é—®ä¸‹è€å¸ˆï¼ŒWRITESET_SESSIONä»€ä¹ˆæ—¶å€™ä¼šéœ€è¦å‘€ï¼Œå°±æ˜¯ä»€ä¹ˆæ—¶å€™éœ€è¦â€œä¸»åº“ä¸ŠåŒä¸€ä¸ªçº¿ç¨‹å…ˆåæ‰§è¡Œçš„ä¸¤ä¸ªäº‹åŠ¡ï¼Œåœ¨å¤‡åº“æ‰§è¡Œçš„æ—¶å€™ï¼Œè¦ä¿è¯ç›¸åŒçš„å…ˆåé¡ºåºâ€","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436180,"discussion_content":"æˆ‘ä¹Ÿæ²¡æƒ³åˆ°æœ‰ä»€ä¹ˆåœºæ™¯å¿…é¡»å¾—ç”¨WRITESET_SESSION","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547180339,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1458200,"avatar":"https://static001.geekbang.org/account/avatar/00/16/40/18/cc3804e2.jpg","nickname":"æ²ˆæ´ªå½¬","note":"","ucode":"F9911236D0BA1C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":100439,"discussion_content":"å¯èƒ½æœ‰ä¸€äº›ä¸šåŠ¡éœ€è¦ï¼Œå¯èƒ½ä»£ç æ²¡å†™åˆ°ä¸€ä¸ªäº‹ç‰©é‡Œé¢ï¼Œä½†æ˜¯ç¨‹åºæ‰§è¡Œçš„ä¹‹åé¡ºåºæ‰§è¡Œçš„ã€‚å¿…é¡»å‘æ›´æ–°aè¡¨çŠ¶æ€ï¼Œç„¶åæ›´æ–°bè¡¨çŠ¶æ€ä¹‹ç±»çš„ã€‚ä¸æŒ‰ç…§è¿™ä¸ªå¯èƒ½ä¼šæœ‰ç¬é—´çŠ¶æ€ä¸å¯¹æˆ–è€…æŠ¥é”™","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1577260738,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":359570,"user_name":"åˆæ™¨","can_delete":false,"product_type":"c1","uid":2389270,"ip_address":"é™•è¥¿","ucode":"C5D95D13E49127","user_header":"https://static001.geekbang.org/account/avatar/00/24/75/16/6e28bf17.jpg","comment_is_top":false,"comment_ctime":1665648737,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1665648737","product_id":100020801,"comment_content":"æ€è€ƒé¢˜ï¼š","like_count":0},{"had_liked":false,"id":347172,"user_name":"LWD","can_delete":false,"product_type":"c1","uid":1986739,"ip_address":"","ucode":"DDA444DB113C01","user_header":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","comment_is_top":false,"comment_ctime":1653791986,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1653791986","product_id":100020801,"comment_content":"æŒ‰è¡Œåˆ†å‘ç­–ç•¥æœ‰bugã€‚å®é™…ä½¿ç”¨ä¼šæœ‰å¾ˆå¤šé—®é¢˜ã€‚æ¯”å¦‚é—´éš™é”çš„é¡ºåºè¦æ€ä¹ˆä¿è¯ï¼ŸAé”ä½åŒºé—´[1,2,3]ã€‚Bæ’å…¥2è¢«é˜»å¡ä½ã€‚ç»“æœä»åº“è§£æçš„æ—¶å€™å…ˆæ‰§è¡ŒBç„¶åæ‰§è¡ŒAã€‚æ­¤æ—¶å°±ä¼šæœ‰é—®é¢˜ã€‚ã€‚ã€‚ã€‚é™¤éè§£æçš„æ—¶å€™æœ‰ä¸“é—¨å¯¹è¿™ç§æƒ…å†µè¿›è¡Œå¤„ç†","like_count":0},{"had_liked":false,"id":342290,"user_name":"å†è§ç†æƒ³","can_delete":false,"product_type":"c1","uid":1245999,"ip_address":"","ucode":"FAC88B3F6F6DFD","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/2f/0a5e0751.jpg","comment_is_top":false,"comment_ctime":1650172851,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1650172851","product_id":100020801,"comment_content":"mysql 5.6ç‰ˆæœ¬ä¹‹å‰ ä»…æ”¯æŒä»åº“å•çº¿ç¨‹å¤„ç†binlogæ—¥å¿—ï¼Œå†™é€Ÿåº¦ä½äºä¸»åº“çš„å†™é€Ÿåº¦ï¼Œå®¹æ˜“å¯¼è‡´ä¸»ä»å»¶è¿Ÿã€‚<br>mysql 5.6ç‰ˆæœ¬åŠä¹‹å å¼€å§‹æ”¯æŒä»åº“çš„å¤šçº¿ç¨‹å¹¶è¡Œå¤åˆ¶èƒ½åŠ›ã€‚ä½†å¤šçº¿ç¨‹æ‰§è¡Œå¤åˆ¶ä¹Ÿæ˜¯æœ‰æ¡ä»¶é™åˆ¶çš„ã€‚<br>1.åŒä¸€ä¸ªäº‹åŠ¡ä¸­çš„è¯­å¥å¿…é¡»åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œã€‚<br>2.ä¸åŒäº‹åŠ¡ä¸­å­˜åœ¨æ•°æ®å†²çªçš„è¯­å¥ä¹Ÿå¿…é¡»åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œã€‚<br>å®˜æ–¹æä¾›äº† å°†sqlæŒ‰åº“åˆ†åˆ°ä¸åŒçº¿ç¨‹æ‰§è¡Œçš„æ–¹å¼ ä»¥åŠ  åˆ©ç”¨redo log ç»„æäº¤ (group commit) ä¼˜åŒ–çš„ç‰¹æ€§å°†ä¸»åº“ä¸­å¯ä»¥å¹¶è¡Œçš„è¯­å¥åœ¨ä»åº“ä¸­å¹¶è¡Œæ‰§è¡Œã€‚","like_count":0},{"had_liked":false,"id":339190,"user_name":"å¼ ç¦é¡º","can_delete":false,"product_type":"c1","uid":1213423,"ip_address":"","ucode":"42EC3D0CF544AF","user_header":"https://static001.geekbang.org/account/avatar/00/12/83/ef/7b34560d.jpg","comment_is_top":false,"comment_ctime":1647960858,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1647960858","product_id":100020801,"comment_content":"è€å¸ˆï¼Œè¯·é—®5.7çš„å¹¶è¡Œå¤åˆ¶å¦‚æœæœ‰DDLè¯­å¥ä¼šä½¿ç”¨onlineDDLå˜›ï¼Œè¿™ä¹ˆç†è§£æ˜¯å¦å¯ä»¥é€šè¿‡å¼€å¯å¹¶è¡Œå¤åˆ¶é™ä½å› ä¸ºDDLå¼•èµ·çš„ä¸»ä»å»¶è¿Ÿ","like_count":0},{"had_liked":false,"id":330426,"user_name":"mushan","can_delete":false,"product_type":"c1","uid":2756810,"ip_address":"","ucode":"B57CCB0A1FA653","user_header":"","comment_is_top":false,"comment_ctime":1641974548,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1641974548","product_id":100020801,"comment_content":"â€œMariaDB è¿™ä¸ªç­–ç•¥çš„æ ¸å¿ƒï¼Œæ˜¯â€œæ‰€æœ‰å¤„äº commitâ€çŠ¶æ€çš„äº‹åŠ¡å¯ä»¥å¹¶è¡Œâ€<br>â€œMySQL 5.7 å¹¶è¡Œå¤åˆ¶ç­–ç•¥çš„æ€æƒ³æ˜¯ï¼šåŒæ—¶å¤„äº prepare çŠ¶æ€çš„äº‹åŠ¡ï¼Œåœ¨å¤‡åº“æ‰§è¡Œæ—¶æ˜¯å¯ä»¥å¹¶è¡Œçš„ï¼›å¤„äº prepare çŠ¶æ€çš„äº‹åŠ¡ï¼Œä¸å¤„äº commit çŠ¶æ€çš„äº‹åŠ¡ä¹‹é—´ï¼Œåœ¨å¤‡åº“æ‰§è¡Œæ—¶ä¹Ÿæ˜¯å¯ä»¥å¹¶è¡Œçš„â€<br>MariaDBå’Œ5.7å¹¶è¡Œå¤åˆ¶ç­–ç•¥çš„è¿™ä¸¤è€…çš„åŒºåˆ«è¿˜æ˜¯æ²¡å¤ªæ˜ç™½ï¼Œåœ¨å®ç°ä¸Šä¸éƒ½æ˜¯å¤‡åº“æ ¹æ®commit idæ¥ç¡®å®šæ˜¯å¦å¯ä»¥åˆ†å‘åˆ°ä¸åŒworkerå¹¶è¡Œåº”ç”¨å—ï¼Ÿéš¾é“åªæ˜¯binlog_group_commit_sync_delayå’Œbinlog_group_commit_sync_no_delay_countå»¶è¿Ÿfsyncçš„ä¼˜åŒ–ï¼Ÿ","like_count":0},{"had_liked":false,"id":329164,"user_name":"æ¸…é£","can_delete":false,"product_type":"c1","uid":2317711,"ip_address":"","ucode":"62490AD4F949BB","user_header":"https://static001.geekbang.org/account/avatar/00/23/5d/8f/498d9ea5.jpg","comment_is_top":false,"comment_ctime":1641191904,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1641191904","product_id":100020801,"comment_content":"ä¸»åº“å•çº¿ç¨‹ï¼Œå› æ­¤COMMIT_ORDERç­–ç•¥ä¸‹ï¼Œä¸²è¡Œæ‰§è¡Œäº‹åŠ¡å’Œæ›´æ–°redo logï¼Œä¹Ÿå°±æ²¡æœ‰å…¶ä»–redo logåŒæ—¶ä¸ºprepareçŠ¶æ€çš„äº‹åŠ¡ï¼Œåªæœ‰ä¸€ä¸ªworkeråœ¨å·¥ä½œï¼Œå¤‡åº“é€€åŒ–ä¸ºå•çº¿ç¨‹ï¼›WRITESETç­–ç•¥ï¼Œå…¶å¯¹æ¯”æ›´æ–°çš„äº‹åŠ¡æ˜¯å¦å­˜åœ¨å†²çªçš„è¡Œå†³å®šäº‹åŠ¡å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œå› æ­¤ä¸å—ä¸»åº“å•çº¿ç¨‹å½±å“ï¼Œå¤‡åº“å¯ä»¥å¹¶è¡Œå¤åˆ¶ï¼›WRITE_SESSIONç­–ç•¥ï¼Œæ–°å¢æ‰§è¡Œé¡ºåºçº¦æŸï¼Œç”±äºä¸»åº“å•çº¿ç¨‹å¯¼è‡´äº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œå› æ­¤å¤‡åº“ä¹Ÿä¼šé€€è¿˜ä¸ºå•çº¿ç¨‹","like_count":0},{"had_liked":false,"id":324989,"user_name":"Dunk","can_delete":false,"product_type":"c1","uid":1691447,"ip_address":"","ucode":"A8F5AB98382719","user_header":"https://static001.geekbang.org/account/avatar/00/19/cf/37/6ed137b9.jpg","comment_is_top":false,"comment_ctime":1638772445,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638772445","product_id":100020801,"comment_content":"## è§£ç­”æ€è·¯<br><br>å•çº¿ç¨‹æ’å…¥ä¹Ÿå°±æ„å‘³ç€ä¸å­˜åœ¨å¤šä¸ªå¹¶å‘äº‹åŠ¡çš„redologå¤„äºprepareæˆ–commitçŠ¶æ€ï¼Œå¦‚æœä½¿ç”¨`COMMIT_ORDER`å‚æ•°æ¥è¿›è¡Œå¿«é€Ÿå¤åˆ¶å°±å¾—ä¸å¿å¤±ï¼Œè¾¾ä¸åˆ°å¿«é€Ÿå¹¶è¡Œå¤åˆ¶çš„æ•ˆæœï¼›è€Œå¯¹äº`WRITESET`å‚æ•°æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ç§åŸºäºæŒ‰è¡Œåˆ†å‘çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥ï¼Œè¿™ç§æ–¹å¼æ‰€å¾—åˆ°çš„å¹¶è¡Œåº¦æ˜¯æ¯”è¾ƒå¥½çš„ï¼›å¦‚æœä½¿ç”¨`WRITESET_SESSION`å‚æ•°å› ä¸ºå¤šåŠ äº†ä¸€ä¸ªçº¦æŸæ¡ä»¶ä¹Ÿå°±æ„å‘³ç€è¿™ç§æ–¹å¼çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥çš„å¹¶å‘åº¦æ˜¯æœ‰ä¸€å®šçš„æŸå¤±çš„ã€‚ç»¼åˆä¸Šè¿°åˆ†æï¼Œé’ˆå¯¹è¿™ä¸ªé—®é¢˜é‡‡ç”¨`WRITESET`å‚æ•°çš„å¹¶å‘å¤åˆ¶ç­–ç•¥æ˜¯æ›´å¥½ä¸€äº›çš„ã€‚<br><br>é‡‡ç”¨`COMMIT_ORDER`çš„æ–¹æ¡ˆä¼šå‡ºç°çš„ç°è±¡æ˜¯å¤‡åº“æ°¸è¿œä¸ä¼šè¿½ä¸Šä¸»åº“ï¼Œå¦‚æœè¦ä¿æŒä¸¤è€…çš„ä¸€è‡´æ€§ï¼Œè¿™å¿…é¡»åœæ‰æœåŠ¡æ¥è¿›è¡ŒåŒæ­¥æ“ä½œï¼Œç„¶è€Œè¿™æ ·åšæ˜¯æå…¶ä¸å¯å–çš„ã€‚<br><br>é‡‡ç”¨`WRITE_SESSION`çš„æ–¹æ¡ˆæœ‰ç‚¹ç±»ä¼¼äº`COMMIT_ORDER`çš„ï¼Œè¿™ç§æ–¹æ¡ˆä¹Ÿæ˜¯ä¼šäº§ç”Ÿæ°¸è¿œæ— æ³•è¿½ä¸Šä¸»åº“çš„é—®é¢˜ã€‚<br>ä»¥ä¸Šä¸ºä¸ªäººæ‹™è§ï¼","like_count":0},{"had_liked":false,"id":322144,"user_name":"å±±é¬¼è°£","can_delete":false,"product_type":"c1","uid":1543162,"ip_address":"","ucode":"E25F498B85A01B","user_header":"https://static001.geekbang.org/account/avatar/00/17/8b/fa/103e6900.jpg","comment_is_top":false,"comment_ctime":1637205302,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1637205302","product_id":100020801,"comment_content":"â€œèƒ½å¤Ÿåœ¨åŒä¸€ç»„é‡Œæäº¤çš„äº‹åŠ¡ï¼Œä¸€å®šä¸ä¼šä¿®æ”¹åŒä¸€è¡Œâ€ä¸ºä»€ä¹ˆå—ï¼Ÿè¯„è®ºé‡Œä¼¼ä¹éƒ½æ²¡æœ‰è¿™ä¸ªç–‘é—®ï¼Ÿçœ‹è¿™æ–‡ç« çš„éƒ½æ˜¯DBAå—ï¼Ÿä½œä¸ºå¼€å‘ï¼Œä¸æ˜¯å¾ˆç†è§£è¿™å¥è¯~ <br>å…ˆåˆ«è¯´åŒç»„äº†ï¼Œæˆ‘ä¸€ä¸ªäº‹åŠ¡é‡Œé¢ï¼Œæ‰§è¡Œä¸¤ä¸ªupdateæ¥ä¿®æ”¹åŒä¸€è¡Œï¼Œè¿™ç§ç®—ä¸ç®—ä¿®æ”¹äº†åŒä¸€è¡Œï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537754,"discussion_content":"è¿˜è®°å¾—binlogä¹‹å‰è¿˜æœ‰ä¸€ä¸ªbinlog cacheå—ï¼Ÿbinlog cacheæ˜¯æ¯ä¸ªçº¿ç¨‹ç‹¬æœ‰çš„ï¼Œå®ƒä»¬æœ€ç»ˆä¼šå†™åˆ°åŒä¸€ä¸ªbinlogæ–‡ä»¶ã€‚åœ¨ç»„æäº¤çš„æ—¶å€™ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ binlog cacheï¼Œä¸»åº“èƒ½å¹¶å‘çº¿ç¨‹ï¼Œåœ¨binlogç»„æäº¤é‡Œï¼ŒåŒ…å«çš„å°±æ˜¯é€šè¿‡äº†é”å†²çªçš„äº‹åŠ¡ã€‚\nç»„æäº¤åŒ…å«å¤šä¸ªäº‹åŠ¡ï¼Œè¿™äº›äº‹åŠ¡ä¼šæœ‰é”å†²çªå—ï¼Ÿæ˜¾ç„¶ä¸ä¼šã€‚å¦‚æœä¸¤ä¸ªäº‹åŠ¡æœ‰é”å†²çªï¼Œé‚£å…¶ä¸­ä¹‹ä¸€ä¸ªäº‹åŠ¡ï¼Œè‚¯å®šè¦ç­‰å¦ä¸€ä¸ªäº‹åŠ¡æäº¤äº†ï¼Œé‡Šæ”¾äº†é”ä¹‹åæ‰æ‰§è¡Œã€‚é‚£ä¹ˆï¼Œä»–ä»¬å°±ä¸å¯èƒ½åœ¨åŒä¸€ä¸ªç»„é‡Œäº†ã€‚\nâ€œåŒä¸€ä¸ªäº‹åŠ¡å¤šæ¬¡updateåŒä¸€è¡Œã€‚â€å’Œâ€œèƒ½å¤Ÿåœ¨åŒä¸€ç»„é‡Œæäº¤çš„äº‹åŠ¡ï¼Œä¸€å®šä¸ä¼šä¿®æ”¹åŒä¸€è¡Œâ€è¿™ä¸¤å¥è¯å¹¶ä¸çŸ›ç›¾ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639153726,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":310893,"user_name":"å»–æ™¶â‚â‚ƒâ‚‰â‚€â‚ˆâ‚„â‚ˆâ‚†â‚â‚„â‚‚","can_delete":false,"product_type":"c1","uid":2070832,"ip_address":"","ucode":"2331549830E0DE","user_header":"https://static001.geekbang.org/account/avatar/00/1f/99/30/9e542e5a.jpg","comment_is_top":false,"comment_ctime":1630974507,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630974507","product_id":100020801,"comment_content":"è€å¸ˆï¼ŒMariaDB çš„å¹¶è¡Œå¤åˆ¶ç­–ç•¥ï¼Œæ€ä¹ˆåˆ¤æ–­ä¸€ç»„å…¨éƒ¨å·²ç»å®Œæˆå‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":298402,"user_name":"å¼ ä¸‰ä¸°","can_delete":false,"product_type":"c1","uid":1155275,"ip_address":"","ucode":"3A6215A40B3B21","user_header":"https://static001.geekbang.org/account/avatar/00/11/a0/cb/aab3b3e7.jpg","comment_is_top":false,"comment_ctime":1624084069,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624084069","product_id":100020801,"comment_content":"è€å¸ˆï¼Œè¿™ä¸ªæœ‰ä»€ä¹ˆç”¨å—ï¼Ÿæ„Ÿè§‰åªéœ€è¦å”¯ä¸€ç´¢å¼•å°±å¤Ÿäº†ã€‚åªè¦çŸ¥é“å½“å‰æ­£åœ¨ä¿®æ”¹å“ªè¡Œå°±å¥½äº†å•Šã€‚ä¸‹ä¸€ä¸ªäº‹åŠ¡åœ¨ä¿®æ”¹ç›¸åŒè¡Œçš„æ—¶å€™ï¼Œå¦‚æœå†²çªå°±è¿›å…¥ä¸ä¹‹å†²çªçš„workã€‚<br><br>key=hash_func(db1+t1+â€œPRIMARYâ€+2), value=2; è¿™é‡Œ value=2 æ˜¯å› ä¸ºä¿®æ”¹å‰åçš„è¡Œ id å€¼ä¸å˜ï¼Œå‡ºç°äº†ä¸¤æ¬¡ã€‚","like_count":0},{"had_liked":false,"id":295502,"user_name":"ä½™å…‰å¼º","can_delete":false,"product_type":"c1","uid":2634522,"ip_address":"","ucode":"54FE11650387B6","user_header":"https://static001.geekbang.org/account/avatar/00/28/33/1a/bc405145.jpg","comment_is_top":false,"comment_ctime":1622453135,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1622453135","product_id":100020801,"comment_content":"è€å¸ˆï¼Œå¦‚æœä¸ºäº†è§£å†³ä¸»ä»å»¶è¿Ÿï¼Œé€šè¿‡ä¸­é—´ä»¶è½¬å‘ï¼Œä¸»åº“å’Œä»åº“åŒæ—¶æ”¶åˆ°ä¸€æ ·rowæ•°æ®ï¼Œä¸»åº“å’Œä»åº“åŒæ—¶æ”¶åˆ°ï¼Œå°±ä¸ç”¨binlogåŒæ­¥","like_count":0,"discussions":[{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537755,"discussion_content":"è¿™ä¸ªä¿è¯ä¸äº†ä¸»ä»ä¸€è‡´å•Šã€‚ä½ å°†è¯·æ±‚é€šè¿‡ä¸­é—´ä»¶åˆ†å‘ï¼Œä¿è¯ä¸äº†å“ªä¸ªæœåŠ¡å™¨æˆåŠŸï¼Œå“ªä¸ªæœåŠ¡å™¨å¤±è´¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639153975,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":283362,"user_name":"Murphy","can_delete":false,"product_type":"c1","uid":1652747,"ip_address":"","ucode":"094C807F1DFA33","user_header":"https://static001.geekbang.org/account/avatar/00/19/38/0b/5070e8df.jpg","comment_is_top":false,"comment_ctime":1615729190,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1615729190","product_id":100020801,"comment_content":"å¼€å¯å¹¶è¡Œå¤åˆ¶åï¼Œä»åº“ä¸ŠåŒä¸€ä¸ªè¡¨çš„æ’å…¥ä¹Ÿä¸æ˜¯æœ‰åºçš„äº†ï¼Ÿé‚£ä¸»é”®æ˜¯ä¸æ˜¯å°±å˜æˆéšæœºå†™äº†ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537756,"discussion_content":"æœ‰å¯èƒ½ã€‚ä¸è¿‡å¦‚æœæ˜¯rowæ ¼å¼çš„binlogï¼Œå®ƒè®°å½•äº†ä¸»åº“æ•°æ®è¡Œçš„å®Œæ•´å˜åŒ–ï¼Œæ‰€ä»¥ï¼Œæ‰€æœ‰å­—æ®µçš„å˜åŒ–éƒ½æ˜¯ä¸€è‡´çš„ã€‚ä½†ï¼Œéšæœºå†™è¿˜æ˜¯æœ‰å¯èƒ½å‘ç”Ÿçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639154075,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":274388,"user_name":"è´ºå­","can_delete":false,"product_type":"c1","uid":2076283,"ip_address":"","ucode":"A64DC9D9CF7CCD","user_header":"https://static001.geekbang.org/account/avatar/00/1f/ae/7b/47200692.jpg","comment_is_top":false,"comment_ctime":1610986225,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1610986225","product_id":100020801,"comment_content":"è€å¸ˆè¯·é—®ï¼Œ5.7.22ä»¥åï¼Œè®¾ç½®äº†writesetçš„æ–¹å¼å¹¶è¡Œå¤åˆ¶ï¼Œé‚£ä¹ˆæ²¡äº¤é›†çš„äº‹åŠ¡æ˜¯å…è®¸å¹¶è¡Œå¤åˆ¶çš„ï¼Œä½†æ˜¯ä¸ä¸€å®šä¼šå¹¶è¡Œå¤åˆ¶å¯¹å§ï¼Ÿé‚£ä¹ˆä»åº“æ˜¯æ€ä¹ˆå…·ä½“æ¥è§„åˆ’å¹¶è¡Œå¤åˆ¶å‘¢ï¼Ÿæ˜¯å•ä½æ—¶é—´å†…æ¥åˆ¤æ–­ä¸­ç»§æ—¥å¿—ä¸­æ‰€æœ‰å¯ä»¥å¹¶è¡Œæ‰§è¡Œçš„äº‹åŠ¡ï¼Œç„¶åå¹¶è¡Œæ‰§è¡Œå—ï¼Ÿ","like_count":0},{"had_liked":false,"id":255845,"user_name":"tank","can_delete":false,"product_type":"c1","uid":1691436,"ip_address":"","ucode":"256553A4C09ABF","user_header":"https://static001.geekbang.org/account/avatar/00/19/cf/2c/be133cdf.jpg","comment_is_top":false,"comment_ctime":1603442442,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1603442442","product_id":100020801,"comment_content":"è€å¸ˆï¼Œä¸ºä»€ä¹ˆæˆ‘RR&#47;RCéš”ç¦»çº§åˆ«æµ‹è¯•åŒä¸€ä¸ªäº‹åŠ¡2æ¬¡æ›´æ–°åŒä¸€è¡Œéƒ½æˆåŠŸäº†ï¼Œæ˜¯åŒä¸€ä¸ªcommit_id(xid)?<br>é‚£è¿™æ ·ä¸æ˜¯å’ŒåŒä¸€ç»„å¯ä»¥å¹¶è¡Œå¤åˆ¶å†²çªäº†å—?<br><br>CREATE TABLE `t` ( `id` int(11) NOT NULL, `c` int(11) DEFAULT NULL, `d` int(11) DEFAULT NULL, PRIMARY KEY (`id`), KEY `c` (`c`)) ENGINE=InnoDB;insert into t values(0,0,0),(5,5,5),(10,10,10),(15,15,15),(20,20,20),(25,25,25);<br><br>root@localhost:[test] 23:29:34&gt;begin;<br>root@localhost:[test] 23:29:36&gt;update t_iso set d=d+1 where id=0;<br>root@localhost:[test] 23:29:41&gt;update t_iso set d=d+2 where id=0;<br>root@localhost:[test] 23:29:44&gt;commit;<br>Query OK, 0 rows affected (0.00 sec)<br>ç”±äºæ— æ³•æˆªå›¾ï¼Œshow binlog events in &#39;binlog.000130&#39; from 2014116 limit 9; ç»“æœå¦‚ä¸‹ï¼š<br>root@localhost:[test] 23:54:39&gt;show binlog events in &#39;binlog.000130&#39; from 2014116 limit 9;<br>binlog.000130 | 2014116 | Gtid | 3306 | 2014181 | SET @@SESSION.GTID_NEXT= &#39;c5714948-edc3-11ea-990b-000c29f0ee9b:55954&#39;<br>binlog.000130 | 2014181 | Query | 3306 | 2014258 | BEGIN<br>binlog.000130 | 2014258 | Rows_query | 3306 | 2014315 | # update t_iso set d=d+1 where id=0<br>binlog.000130 | 2014484 | Table_map | 3306 | 2014534 | table_id: 165 (test.t_iso)<br>binlog.000130 | 2014365 | Update_rows | 3306 | 2014427 | table_id: 165 flags: STMT_END_F<br>binlog.000130 | 2014427 | Rows_query | 3306 | 2014484 | # update t_iso set d=d+2 where id=0<br>binlog.000130 | 2014484 | Table_map | 3306 | 2014534 | table_id: 165 (test.t_iso)<br>binlog.000130 | 2014534 | Update_rows | 3306 | 2014596 | table_id: 165 flags: STMT_END_F<br>binlog.000130 | 2014596 | Xid | 3306 | 2014627 | COMMIT &#47;* xid=366367 *&#47;","like_count":0,"discussions":[{"author":{"id":1691436,"avatar":"https://static001.geekbang.org/account/avatar/00/19/cf/2c/be133cdf.jpg","nickname":"tank","note":"","ucode":"256553A4C09ABF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":316726,"discussion_content":"[root@centos7-mysql5 ~]# mysqlbinlog -vv /data/mysql_log/binlog.000130 --start-position=2014116   --stop-position=2014627\n# at 2014116\n#201022 23:29:47 server id 3306  end_log_pos 2014181 CRC32 0xaff15d6c   GTID    last_committed=2194     sequence_number=2195         rbr_only=yes\n/*!50718 SET TRANSACTION ISOLATION LEVEL READ COMMITTED*//*!*/;\nSET @@SESSION.GTID_NEXT= &#39;c5714948-edc3-11ea-990b-000c29f0ee9b:55954&#39;/*!*/;\n# at 2014181\n#201022 23:29:41 server id 3306  end_log_pos 2014258 CRC32 0xda15f77b   Query   thread_id=1115  exec_time=0     error_code=0\nSET TIMESTAMP=1603423781/*!*/;\nSET @@session.pseudo_thread_id=1115/*!*/;\nSET @@session.foreign_key_checks=1, @@session.sql_auto_is_null=0, @@session.unique_checks=1, @@session.autocommit=1/*!*/;\nSET @@session.sql_mode=1436549152/*!*/;\nSET @@session.auto_increment_increment=2, @@session.auto_increment_offset=1/*!*/;\n/*!\\C utf8 *//*!*/;\nSET @@session.character_set_client=33,@@session.collation_connection=33,@@session.collation_server=8/*!*/;\nSET @@session.lc_time_names=0/*!*/;\nSET @@session.collation_database=DEFAULT/*!*/;\nBEGIN\n/*!*/;\n# at 2014258\n#201022 23:29:41 server id 3306  end_log_pos 2014315 CRC32 0x41a95e75   Rows_query\n# update t_iso set d=d+1 where id=0\n# at 2014315\n#201022 23:29:41 server id 3306  end_log_pos 2014365 CRC32 0x80d7b705   Table_map: `test`.`t_iso` mapped to number 165\n# at 2014365\n#201022 23:29:41 server id 3306  end_log_pos 2014427 CRC32 0xb048cac9   Update_rows: table id 165 flags: STMT_END_F\n\n#201022 23:29:44 server id 3306  end_log_pos 2014484 CRC32 0x453a0d33   Rows_query\n# update t_iso set d=d+2 where id=0\n# at 2014484\n#201022 23:29:44 server id 3306  end_log_pos 2014534 CRC32 0x2527a2ca   Table_map: `test`.`t_iso` mapped to number 165\n# at 2014534\n#201022 23:29:44 server id 3306  end_log_pos 2014596 CRC32 0x28d61a11   Update_rows: table id 165 flags: STMT_END_F\n\n#201022 23:29:47 server id 3306  end_log_pos 2014627 CRC32 0x3a8264c6   Xid = 366367\nCOMMIT/*!*/;","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603446077,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":254307,"user_name":"ç´«æ—¥","can_delete":false,"product_type":"c1","uid":1207410,"ip_address":"","ucode":"73A8DEE323AC19","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqXSb2jAzlMM0JdTjWrNiaq2uR9eeloBYp906POddb9evmuj5f4CUoO6ge8TibibwtZicnl1sRHic9rW7g/132","comment_is_top":false,"comment_ctime":1603099113,"is_pvip":true,"discussion_count":1,"race_medal":4,"score":"1603099113","product_id":100020801,"comment_content":"åœ¨å¹³æ—¶çš„å¼€å‘å·¥ä½œä¸­ï¼Œæˆ‘å»ºè®®ä½ å°½é‡å‡å°‘å¤§äº‹åŠ¡æ“ä½œï¼ŒæŠŠå¤§äº‹åŠ¡æ‹†æˆå°äº‹åŠ¡ï¼Œå¤§äº‹ç‰©æ€ä¹ˆæ‹†åˆ†æˆå°äº‹ç‰©ï¼Œæ€ä¹ˆä¿è¯å°äº‹ç‰©é—´åŒæ­¥ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1691436,"avatar":"https://static001.geekbang.org/account/avatar/00/19/cf/2c/be133cdf.jpg","nickname":"tank","note":"","ucode":"256553A4C09ABF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":316728,"discussion_content":"æ¯”å¦‚åˆ é™¤å†å²æ•°æ®ï¼Œè€ƒè™‘ä¸€æ¬¡åˆ é™¤1000è¡Œï¼Œå¯ä»¥å‚è€ƒï¼š\ndelimiter $$\ncreate procedure t_del()\nbegin\nset @i = 1;\nwhile @i > 0 do\ndelete from t limit 1000;\nselect  row_count() into @i;\nend while;\nend $$\ndelimiter ;\ncall t_del();","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603446244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":247297,"user_name":"Magic","can_delete":false,"product_type":"c1","uid":1272047,"ip_address":"","ucode":"FD9CEDAA419EB0","user_header":"https://static001.geekbang.org/account/avatar/00/13/68/ef/6264ca3d.jpg","comment_is_top":false,"comment_ctime":1599652107,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599652107","product_id":100020801,"comment_content":"è¯¾åé—®é¢˜ï¼š<br>é€‰æ‹©WRITESET<br><br>åŸå› ï¼šå› ä¸ºä¸»åº“æ˜¯å•çº¿ç¨‹å†™å…¥ï¼Œæ— å¹¶å‘å†™ï¼Œå› æ­¤ç»„æäº¤æœºåˆ¶å¹¶ä¸èƒ½å¸¦æ¥å¹¶å‘åº¦çš„æé«˜ã€‚è€Œç­–ç•¥ä¸‰è¦ä¿è¯åŒä¸€çº¿ç¨‹äº‹åŠ¡å†™å…¥æ¬¡åºï¼Œç»“æœå°±æ˜¯å¤‡åº“ä¹Ÿé€€åŒ–ä¸ºå•çº¿ç¨‹æ‰§è¡Œäº†","like_count":0},{"had_liked":false,"id":242664,"user_name":"zero","can_delete":false,"product_type":"c1","uid":1538554,"ip_address":"","ucode":"C3744C5164F30F","user_header":"https://static001.geekbang.org/account/avatar/00/17/79/fa/48b481fe.jpg","comment_is_top":false,"comment_ctime":1597806263,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1597806263","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæœ€è¿‘æˆ‘é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ç™¾æ€ä¸å¾—å…¶è§£ã€‚<br>æˆ‘ä»¬çš„é¡¹ç›®æ˜¯ä¸»ä»ç»“æ„çš„ï¼ˆMySQLç‰ˆæœ¬æ˜¯5.7ï¼‰ï¼Œæ¯å¼ è¡¨éƒ½æ˜¯å‡ åƒä¸‡æ•°æ®ï¼Œæˆ‘ä»¬æœ‰çš„åŒäº‹åœ¨ä¸»è¡¨ä¸ŠæŸ¥è¯¢ï¼ŒæŸ¥è¯¢çš„æ•°æ®ä¹Ÿå°±å‡ ç™¾ä¸‡æ¡ï¼Œç„¶åæŠŠè¿™å‡ ç™¾ä¸‡æ¡æ•°æ®æ‰¹é‡å¯¼å‡ºåˆ°æœ¬åœ°ã€‚ç„¶åè¿ç»´çš„åŒäº‹å°±è¿‡æ¥è¯´ä¸èƒ½è¿™æ ·æ‰¹é‡å¯¼å‡ºï¼Œä¼šé€ æˆé•¿æ—¶é—´çš„ä¸»å¤‡å»¶æ—¶ã€‚<br>è¿™ç§å¯¼å‡ºæ“ä½œæ²¡æœ‰æ¶‰åŠäº‹åŠ¡ï¼Œä¹Ÿæ²¡æœ‰æ›´æ–°ï¼Œä¿®æ”¹ï¼ˆåº”è¯¥ä¸ä¼šå†™å…¥binlogæ—¥å¿—æŠŠï¼‰ã€‚ä¸ºå•¥ä¼šé€ æˆé•¿æ—¶é—´ä¸»å¤‡å»¶æ—¶å‘€ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1386315,"avatar":"https://static001.geekbang.org/account/avatar/00/15/27/4b/e49c82d0.jpg","nickname":"Rover","note":"","ucode":"7575EC91F45B99","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378525,"discussion_content":"mä¸‹ï¼Œæœ‰è§£éº»çƒ¦åŒæ­¥ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623254814,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":228412,"user_name":"åˆ˜æ˜æ˜","can_delete":false,"product_type":"c1","uid":1904762,"ip_address":"","ucode":"202F0552168DF5","user_header":"","comment_is_top":false,"comment_ctime":1592661363,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592661363","product_id":100020801,"comment_content":"å› æ­¤ï¼ŒMySQL 5.7 å¹¶è¡Œå¤åˆ¶ç­–ç•¥çš„æ€æƒ³æ˜¯ï¼šåŒæ—¶å¤„äº prepare çŠ¶æ€çš„äº‹åŠ¡ï¼Œåœ¨å¤‡åº“æ‰§è¡Œæ—¶æ˜¯å¯ä»¥å¹¶è¡Œçš„ï¼›å¤„äº prepare çŠ¶æ€çš„äº‹åŠ¡ï¼Œä¸å¤„äº commit çŠ¶æ€çš„äº‹åŠ¡ä¹‹é—´ï¼Œåœ¨å¤‡åº“æ‰§è¡Œæ—¶ä¹Ÿæ˜¯å¯ä»¥å¹¶è¡Œçš„ã€‚<br><br>è¿™é‡Œä¸å¤ªæ˜ç™½ï¼Œbinlogä¸­ä¼šæœ‰redo logçš„prepareçŠ¶æ€å—ï¼Œä¸¤é˜¶æ®µæäº¤binlogé‡Œå°±æ¶‰åŠwriteå’Œfsync, é‚£binlogå†™åˆ°æ–‡ä»¶é‡Œä¸éƒ½æ˜¯commitçŠ¶æ€ï¼Œæ€ä¹ˆä¼šæœ‰repareåˆ°commitçš„ä¸­é—´çŠ¶æ€ï¼Œä¸æ‡‚ï¼Ÿï¼Ÿï¼Ÿ","like_count":0},{"had_liked":false,"id":221090,"user_name":"ä¹å±±çš„èŠ·å…°ã€‚","can_delete":false,"product_type":"c1","uid":1339082,"ip_address":"","ucode":"28BA9773F617B9","user_header":"https://static001.geekbang.org/account/avatar/00/14/6e/ca/66fbd7b3.jpg","comment_is_top":false,"comment_ctime":1590403043,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590403043","product_id":100020801,"comment_content":"mysql 5.7 çš„ slave-parallel-type é…ç½®ä¸º LOGICAL_CLOCKï¼Œä¸ mysql 5.7.22 æ˜¯ä¸æ˜¯åªæ˜¯&quot;æ¨¡æ‹Ÿäº†ä¸»åº“çš„å¹¶è¡Œæ¨¡å¼&quot;ï¼Œå¹¶æ²¡æœ‰å®ç°â€œçœŸæ­£çš„æ¨¡æ‹Ÿä¸»åº“å¹¶å‘åº¦â€è¿™ä¸ªç›®æ ‡ï¼Ÿ","like_count":0},{"had_liked":false,"id":221046,"user_name":"Geek_fb333","can_delete":false,"product_type":"c1","uid":2011553,"ip_address":"","ucode":"F0904774D027A3","user_header":"https://static001.geekbang.org/account/avatar/00/1e/b1/a1/b1fd3903.jpg","comment_is_top":false,"comment_ctime":1590391179,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590391179","product_id":100020801,"comment_content":"çº¿ä¸Šå»ºè®®å¼€å¹¶è¡Œå¤åˆ¶å—","like_count":0},{"had_liked":false,"id":220440,"user_name":"æ³¨æ„åŠ›$","can_delete":false,"product_type":"c1","uid":1142316,"ip_address":"","ucode":"7FB3399A1EAB72","user_header":"https://static001.geekbang.org/account/avatar/00/11/6e/2c/e2f3cfc0.jpg","comment_is_top":false,"comment_ctime":1590242463,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1590242463","product_id":100020801,"comment_content":"è€å¸ˆï¼Œä¸»å¤‡ åœ¨ binlog-transaction-dependency-tracking å‚æ•° å¯ä»¥ä¸ä¸€è‡´æ¥ è®©å¤‡åº“è¿½ä¸Šä¸»åº“å—","like_count":0},{"had_liked":false,"id":217446,"user_name":"æ˜ŸæœŸå…«","can_delete":false,"product_type":"c1","uid":1440429,"ip_address":"","ucode":"D8C66E7F61B0D1","user_header":"https://static001.geekbang.org/account/avatar/00/15/fa/ad/3fa02ac7.jpg","comment_is_top":false,"comment_ctime":1589506435,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589506435","product_id":100020801,"comment_content":"è€å¸ˆï¼šwriteset_sessionä¸­çš„äº‹åŠ¡çš„å…ˆåé¡ºåºï¼Œæ€ä¹ˆä¿è¯ï¼Œæ˜¯æ ¹æ®beginæ—¶é—´è¿˜æ˜¯commitæ—¶é—´å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":208261,"user_name":"LH","can_delete":false,"product_type":"c1","uid":1211178,"ip_address":"","ucode":"819B9B2409E834","user_header":"https://static001.geekbang.org/account/avatar/00/12/7b/2a/7d8b5943.jpg","comment_is_top":false,"comment_ctime":1587309668,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587309668","product_id":100020801,"comment_content":"é€ æˆä¸»å¤‡å»¶è¿Ÿçš„å› ç´ <br>1ï¼Œå¤‡ç”¨æœºç¡¬ä»¶åƒåœ¾<br>2ï¼Œæ— èŠ‚åˆ¶å‹è¿«å¤‡ç”¨æœº<br>3ï¼Œä¸»åº“å¹¶è¡Œå¤§äºå¤‡åº“<br>4ï¼Œä¸»åº“å¤§äº‹åŠ¡æäº¤","like_count":0},{"had_liked":false,"id":203733,"user_name":"Ryan","can_delete":false,"product_type":"c1","uid":1667987,"ip_address":"","ucode":"95BBBEE5B23878","user_header":"https://static001.geekbang.org/account/avatar/00/19/73/93/0a3a1e5b.jpg","comment_is_top":false,"comment_ctime":1586260611,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586260611","product_id":100020801,"comment_content":"WRITESET","like_count":0},{"had_liked":false,"id":182190,"user_name":"å°äºˆ","can_delete":false,"product_type":"c1","uid":1442580,"ip_address":"","ucode":"3F5EAEE1746074","user_header":"https://static001.geekbang.org/account/avatar/00/16/03/14/e9ca2d09.jpg","comment_is_top":false,"comment_ctime":1582726941,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582726941","product_id":100020801,"comment_content":"å›ç­”é—®é¢˜ é€‰æ‹© WRITESETã€‚<br>ç”±äºä¸»åº“æ˜¯å•çº¿ç¨‹æ‰§è¡Œï¼Œæ²¡æœ‰åŒæ—¶å¤„äºprepareçŠ¶æ€çš„äº‹åŠ¡ï¼Œå¦‚æœé€‰æ‹©COMMIT_ORDEEï¼Œå¤‡åº“ä¹Ÿæ˜¯å•çº¿ç¨‹æ‰§è¡Œã€‚ ä¹Ÿä¸éœ€è¦é€‰æ‹©WRITESET_<br>_SESSIONï¼Œå› ä¸ºåˆšåˆšæ­å»ºçš„å¤‡åº“ï¼Œæš‚æ—¶æ²¡ç”¨ç”¨æˆ·è®¿é—®ï¼Œä¸éœ€è¦è€ƒè™‘åŒæ­¥ä¸­çš„æ•°æ®ä¸€è‡´æ€§ï¼Œåªè¦ä¿è¯æœ€ç»ˆä¸€è‡´æ€§å°±è¡Œã€‚ç­‰è¿½ä¸Šä¸»åº“åå†æ ¹æ®å…·ä½“ä¸šåŠ¡æ”¹æˆCOMMIT_ORDER æˆ– WRITESET_SESSION","like_count":0},{"had_liked":false,"id":164799,"user_name":"helloworld","can_delete":false,"product_type":"c1","uid":1015754,"ip_address":"","ucode":"00DF2FEC58D2E6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","comment_is_top":false,"comment_ctime":1577092910,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577092910","product_id":100020801,"comment_content":"å¼±å¼±åœ°é—®ä¸‹è€å¸ˆï¼Œä½œä¸ºä¸€ä¸ªJavaç¨‹åºå‘˜å¯¹äºæœ¬èŠ‚çš„è¯¾ç¨‹éœ€è¦å­¦ä¹ åˆ°ä»€ä¹ˆç¨‹åº¦å‘¢ï¼Ÿä¾‹å¦‚å¯¹äºã€æŒ‰è¡Œå¤åˆ¶ã€çš„ç­–ç•¥ï¼Œhashä¸­æ‘ä¸­çš„æ•°æ®çš„æ ¼å¼æ²¡æœ‰ç†è§£ç­‰è¿™äº›é—®é¢˜ã€‚æ„Ÿè°¢è€å¸ˆ","like_count":0},{"had_liked":false,"id":164795,"user_name":"helloworld","can_delete":false,"product_type":"c1","uid":1015754,"ip_address":"","ucode":"00DF2FEC58D2E6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","comment_is_top":false,"comment_ctime":1577092551,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577092551","product_id":100020801,"comment_content":"é˜…è¯»äº†ä¸¤ä¸ªéï¼ŒåŠ ä¸Šå¯¹ä¹‹å‰çš„å†…å®¹æŸ¥é˜…ï¼Œä¹Ÿç®—å¯¹æœ¬é›†çš„è¯¾ç¨‹ä»å¤§ä½“ä¸Šæœ‰äº†ä¸€ä¸ªäº†è§£ï¼Œå½“ä¸­çš„ç»†èŠ‚è¿˜æ˜¯å­˜åœ¨ç–‘é—®","like_count":0},{"had_liked":false,"id":156571,"user_name":"jian","can_delete":false,"product_type":"c1","uid":1185102,"ip_address":"","ucode":"21CDBBB8000F0C","user_header":"https://static001.geekbang.org/account/avatar/00/12/15/4e/4636a81d.jpg","comment_is_top":false,"comment_ctime":1574915621,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574915621","product_id":100020801,"comment_content":"&quot;è¦è§£å†³çƒ­ç‚¹è¡¨çš„å¹¶è¡Œå¤åˆ¶é—®é¢˜ï¼Œå°±éœ€è¦ä¸€ä¸ªæŒ‰è¡Œå¹¶è¡Œå¤åˆ¶çš„æ–¹æ¡ˆã€‚æŒ‰è¡Œå¤åˆ¶çš„æ ¸å¿ƒæ€è·¯æ˜¯ï¼šå¦‚æœä¸¤ä¸ªäº‹åŠ¡æ²¡æœ‰æ›´æ–°ç›¸åŒçš„è¡Œï¼Œå®ƒä»¬åœ¨å¤‡åº“ä¸Šå¯ä»¥å¹¶è¡Œæ‰§è¡Œã€‚æ˜¾ç„¶ï¼Œè¿™ä¸ªæ¨¡å¼è¦æ±‚ binlog æ ¼å¼å¿…é¡»æ˜¯ rowã€‚&quot;è¯·é—®è€å¸ˆï¼Œä»€ä¹ˆå¿…é¡»æ˜¯rowï¼Œå¦‚æœæ˜¯æœ‰è¡¨åï¼Œä¸»é”®å’Œå”¯ä¸€ç´¢å¼•çš„statementï¼Œä¸ºä»€ä¹ˆä¸èƒ½ï¼Ÿæœ›æŒ‡ç‚¹ï¼Œè°¢è°¢","like_count":0},{"had_liked":false,"id":153430,"user_name":"éšå¿ƒè€Œè‡³","can_delete":false,"product_type":"c1","uid":1097836,"ip_address":"","ucode":"31866865255101","user_header":"https://static001.geekbang.org/account/avatar/00/10/c0/6c/29be1864.jpg","comment_is_top":false,"comment_ctime":1574234488,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574234488","product_id":100020801,"comment_content":"æˆ‘æ˜¯åšåç«¯å¼€å‘çš„ï¼Œæ„Ÿè§‰è¿™ä¸ªæœ‰ç‚¹åƒå¤‡åº“å»¶è¿Ÿæœ‰ç‚¹åƒç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ï¼Œä¸»åº“å¯ä»¥å½“æˆç”Ÿæˆè€…ï¼Œå¤‡åº“å¯ä»¥å½“æˆæ¶ˆè´¹è€…ï¼Œç”Ÿäº§è€…åœ¨å¤šçº¿ç¨‹åœ°ç”Ÿäº§æ•°æ®ï¼Œè€Œæ¶ˆè´¹è€…å´ç”¨å•çº¿ç¨‹æ¥æ¶ˆè´¹æ•°æ®ï¼Œæ‰€ä»¥è¯´æ…¢ä¹Ÿæ˜¯æ­£å¸¸çš„ï¼Œè§£å†³çš„æ–¹æ³•å°±æ˜¯å°½å¯èƒ½ç»™æ¶ˆè´¹è€…è®¾ç½®å¤šä¸ªçº¿ç¨‹ã€‚","like_count":0},{"had_liked":false,"id":141116,"user_name":"æ³•åŠå¤","can_delete":false,"product_type":"c1","uid":1613732,"ip_address":"","ucode":"18BFBCD9191C19","user_header":"https://static001.geekbang.org/account/avatar/00/18/9f/a4/e015abbe.jpg","comment_is_top":false,"comment_ctime":1571116991,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571116991","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œæˆ‘ç›®å‰åœ¨ç»´æŠ¤ä¸€ä¸ªè€æ—§ç³»ç»Ÿï¼Œä½¿ç”¨mysql5.1ï¼Œä¸šåŠ¡é«˜å³°æ—¶å¤åˆ¶å»¶è¿Ÿè¾¾åˆ°5000+ï¼Œiostatç»“æœç¡¬ç›˜ä½¿ç”¨ç‡è¾¾åˆ°99%ï¼Œioååé‡æ¯ç§’åœ¨10Mbå·¦å³ï¼Œå¹¶æ²¡æœ‰è¾¾åˆ°ç“¶é¢ˆï¼Œè¯»å†™è¯·æ±‚æ¯ç§’åœ¨6ï¼Œ700å·¦å³ï¼Œiowaitç¡®å¾ˆé«˜ã€‚æˆ‘æœ‰ç‚¹å›°æƒ‘å•çº¿ç¨‹å¤åˆ¶ä¸ºä»€ä¹ˆä¼šäº§ç”Ÿioæ€§èƒ½é—®é¢˜å‘¢ï¼Ÿå¸Œæœ›è€å¸ˆè§£æƒ‘ä¸€ä¸‹ï¼ŒæœŸå¾…è€å¸ˆçš„å›å¤â€¦","like_count":0},{"had_liked":false,"id":135362,"user_name":"æé‘«ç£Š","can_delete":false,"product_type":"c1","uid":1101615,"ip_address":"","ucode":"D06517CFCEEE00","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/2f/4f89f22a.jpg","comment_is_top":false,"comment_ctime":1569138284,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569138284","product_id":100020801,"comment_content":"å¤‡åº“çš„å¤åˆ¶ä¸æ˜¯åŸºäº binlogï¼Œéš¾é“ binlog ä¸­ä¹Ÿæœ‰èƒ½çœ‹åˆ° prepare å’Œ commit è¿™ä¸ªä¸¤ä¸ªé˜¶æ®µï¼Ÿå¦‚æœçœ‹ä¸åˆ°çš„è¯ï¼Œä»åº“æ€ä¹ˆèƒ½çœ‹åˆ°è¿™ç»„æäº¤ä¸­çš„äº‹åŠ¡æ˜¯ prepare çš„è¿˜æ˜¯ commit çš„ï¼Ÿ5.7 å¯¹ MariaDB çš„ä¼˜åŒ–åˆä»ä½•è¯´èµ·å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":135099,"user_name":"ä¸ä¸å†é™©è®°","can_delete":false,"product_type":"c1","uid":1661704,"ip_address":"","ucode":"A43829E454C067","user_header":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","comment_is_top":false,"comment_ctime":1569025392,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569025392","product_id":100020801,"comment_content":"æˆ‘æ›¾ç»ä¸»5.1 ä»5.7  ä»åº“æ€»æ˜¯exepos ä¸å¯¹ï¼Œè€Œæ•°æ®åˆæ˜¯å¯¹çš„ï¼Œä¼°è®¡å°±æ˜¯binlog  ä¸ä¸€æ ·å¼•å‘çš„ã€‚","like_count":0},{"had_liked":false,"id":126002,"user_name":"ä¸€åªç¾Š","can_delete":false,"product_type":"c1","uid":1303375,"ip_address":"","ucode":"6A3ADF7DA30DA3","user_header":"https://static001.geekbang.org/account/avatar/00/13/e3/4f/4709b019.jpg","comment_is_top":false,"comment_ctime":1566291489,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566291489","product_id":100020801,"comment_content":"â€œå½“ç„¶ä¸ºäº†å”¯ä¸€æ ‡è¯†ï¼Œè¿™ä¸ª hash å€¼æ˜¯é€šè¿‡ åº“å + è¡¨å + ç´¢å¼•å + å€¼â€ è®¡ç®—å‡ºæ¥çš„ã€‚ å¦‚æœä¸€ä¸ªè¡¨ä¸Šé™¤äº†æœ‰ä¸»é”®ç´¢å¼•å¤–ï¼Œè¿˜æœ‰å…¶ä»–å”¯ä¸€ç´¢å¼•ï¼Œé‚£ä¹ˆå¯¹äºæ¯ä¸ªå”¯ä¸€ç´¢å¼•ï¼Œinsert è¯­å¥å¯¹åº”çš„ writeset å°±è¦å¤šå¢åŠ ä¸€ä¸ª hash å€¼ã€‚â€<br><br>æœ‰ä¸ªé—®é¢˜æƒ³è¯·æ•™ä¸€ä¸‹ï¼šä¸€ä¸ªäº‹åŠ¡ä¸ºä»€ä¹ˆä¼šæœ‰å¤šä¸ªhashè·Ÿå®ƒå¯¹åº”ï¼ŸæŒ‰ç†è¯´ä¸€ä¸ª hash ä¸€ä¸ªäº‹åŠ¡æ‰åˆç†å•Šã€‚","like_count":0},{"had_liked":false,"id":106753,"user_name":"Jason_é¹","can_delete":false,"product_type":"c1","uid":1179329,"ip_address":"","ucode":"4A3DCAAC531724","user_header":"https://static001.geekbang.org/account/avatar/00/11/fe/c1/6c99fff4.jpg","comment_is_top":false,"comment_ctime":1561383505,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1561383505","product_id":100020801,"comment_content":"ä¹‹å‰çº¿ä¸Šé‡åˆ°ä¸»ä»å»¶æ—¶1sçš„caseï¼Œåé¦ˆç»™DBAï¼Œä»–ç­”å¤åˆ°æ˜¯å› ä¸ºä»åº“å¼€äº†å¹¶è¡Œå¤åˆ¶çš„ç­–ç•¥ï¼Œä»–æŠŠå¹¶è¡Œå¤åˆ¶å…³äº†ä¸»ä»å»¶è¿Ÿå°±æ¢å¤æ­£å¸¸äº†ï¼Œå¾ˆä¸ç†è§£å…³äº†å¹¶è¡Œå¤åˆ¶å²‚ä¸æ˜¯æ›´æ…¢äº†ä¹ˆï¼Ÿä¸ºå•¥è¿˜ä¼šå› ä¸ºå¼€å¯å¹¶è¡Œå¤åˆ¶ä¼šå½±å“ä¸»ä»å»¶æ—¶çš„","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":167343,"discussion_content":"æ˜¯ä¸æ˜¯é…ç½®äº†é”™è¯¯çš„å‚æ•°å¯¼è‡´ç­–ç•¥ä¸æ­£å¸¸äº†ã€‚æ¯”å¦‚å»¶æ—¶æˆ–è€…ç§¯ç´¯ä¸€å®šäº‹åŠ¡æ•°æäº¤ä¹‹ç±»çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581479116,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":98961,"user_name":"ping","can_delete":false,"product_type":"c1","uid":1303688,"ip_address":"","ucode":"B60EF3B90D827E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJR5k5ThxFPZyew0UKNaq89utnIEQia2CiaxMOvacibGnbuZNpSiaaGTlRLWhmegxagELnIXfNveRxLfw/132","comment_is_top":false,"comment_ctime":1559120656,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559120656","product_id":100020801,"comment_content":"æˆ‘é‡åˆ°å¤´å¤§é—®é¢˜ï¼Œæ¸…æŒ‡æ•™ã€‚æƒ…å†µæè¿°ï¼š ä¸€ä¸»ä¸€ä»ï¼Œç‰ˆæœ¬ï¼šå®˜æ–¹  5.7.25 ï¼›ç¡¬ä»¶ï¼š8c 16g ssd, ä¸šåŠ¡ä¸å¿™ï¼Œä»åº“å°šæœªæœ‰åº”ç”¨è¿æ¥ï¼›å¤åˆ¶é‡‡ç”¨mts,ä»åº“ å»¶æ—¶è¶Šæ¥è¶Šå¤§,ç¹å¿™çš„åº“æ²¡æœ‰é‡åˆ°è¿™ç§æƒ…å†µï¼›ä»åº“çº¿ç¨‹å‘ç°ï¼šä¸€ä¸ª system userä¸€ç›´å¤„äº   System lock çŠ¶æ€ï¼›sql_threadçº¿ç¨‹çŠ¶æ€ï¼šWaiting for dependent transaction to commit<br>ä¸»è¦å‚æ•°ï¼Œä¸»åº“ï¼šbinlog_group_commit_sync_delay     =3000  binlog_group_commit_sync_no_delay_count=20 ï¼›ä»åº“ï¼šslave_parallel_workers  = 4          <br>slave_parallel_type                = LOGICAL_CLOCK  <br>slave_preserve_commit_order        = 1<br>master_info_repository             = table<br>relay_log_info_repository          = table<br>relay_log_recovery                 = 1<br>log_slave_updates                  = 1 <br>log_bin                            = mysql_bin<br>binlog_format                      = row<br>binlog_group_commit_sync_delay     =3000<br>binlog_group_commit_sync_no_delay_count=20<br><br>æš‚æ—¶è§£å†³ï¼Œä»åº“æ“ä½œï¼šå…³é—­binlogå¾ˆå¿«æ•°æ®å°±åŒæ­¥äº†ï¼Œ<br>åå¤è¯•äº†å¤šæ¬¡ è²Œä¼¼ å…³é—­ slave_preserve_commit_order ä¹Ÿå¯ä»¥è§£å†³é—®é¢˜<br>binlog_group_commit_sync_delay     =0<br>binlog_group_commit_sync_no_delay_count=0<br>ä¸€ç›´è¢«å›°æ‰°ï¼Œè¯·æŒ‡æ•™<br><br><br><br><br>","like_count":0},{"had_liked":false,"id":96519,"user_name":"å†™ç‚¹å•¥å‘¢","can_delete":false,"product_type":"c1","uid":1065272,"ip_address":"","ucode":"C19032CF1C41BA","user_header":"https://static001.geekbang.org/account/avatar/00/10/41/38/4f89095b.jpg","comment_is_top":false,"comment_ctime":1558439684,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1558439684","product_id":100020801,"comment_content":"è¯·é—®è€å¸ˆï¼Œå¦‚æœå¤‡åº“æ‰§è¡Œrelay logçš„è¯­å¥å‡ºé”™äº†ä¼šæ€ä¹ˆå¤„ç†ã€‚<br>å¤‡åº“ä¼šä¸ä¼šåœæ­¢å¤åˆ¶ï¼Œç­‰å¾…å¤±è´¥çš„transactionè¢«å¤„ç†ï¼Ÿè¿˜æ˜¯ä¼šç•¥è¿‡å‡ºé”™æ•°æ®ç»§ç»­å‘¢ï¼Ÿ<br><br>è°¢è°¢è€å¸ˆï¼","like_count":0,"discussions":[{"author":{"id":1043325,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/c9xpiakQ3OC1AlfCeW03lLnnb7mj5v35Hib8YDs66zpnVib2n2qFichFmFp2Ec4QDPR0dKh38MkBBLyD3bE4NiaanZQ/132","nickname":"é¾™æ™“","note":"","ucode":"FAF34F1C65D103","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":354324,"discussion_content":"æˆ‘ç”¨8.0è¯•äº†ä¸€ä¸‹ï¼Œä¼šåœæ­¢å¤åˆ¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615276628,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":93352,"user_name":"Godson","can_delete":false,"product_type":"c1","uid":1248384,"ip_address":"","ucode":"3DBA34ADC0FC4A","user_header":"https://static001.geekbang.org/account/avatar/00/13/0c/80/2eea0e0d.jpg","comment_is_top":false,"comment_ctime":1557455316,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557455316","product_id":100020801,"comment_content":"é‡åˆ°ä¸€ä¸ªçº¿ä¸Šé—®é¢˜ï¼ŒDBæœºå™¨çš„ä¸»ä»å»¶è¿Ÿè¾ƒé«˜ï¼Œæœ€å¤šçš„æ—¶å€™è¾¾åˆ°äº†1ç§’ï¼ŒDBAé€‰æ‹©å…³é—­äº†ä»åº“çš„å¤šçº¿ç¨‹å¤åˆ¶ï¼Œä¸»ä»å»¶è¿Ÿé™ä½åˆ°å‡ ä¹ä¸º0ï¼Œåªæ˜¯å¶å°”æœ‰å°–åˆºï¼ˆæ•ˆæœå¾ˆæ˜æ˜¾ï¼‰ã€‚ç–‘é—®ï¼šå¤šçº¿ç¨‹å¤åˆ¶æ˜¯ä¸ºäº†é™ä½ä¸»ä»å»¶è¿Ÿè€Œå‡ºç°çš„ï¼Œä¸ºä½•å…³é—­äº†åè€Œå»¶è¿Ÿé™ä½ï¼ŒçŒœæƒ³ï¼šæ˜¯ä¸æ˜¯å› ä¸ºä»åº“æ‰§è¡ŒrelayLogè·Ÿä¸ä¸Šä¸»åº“çš„é€Ÿåº¦ï¼Œæ‰€ä»¥å»¶è¿Ÿæ¯”è¾ƒé«˜ï¼Œè¿˜æ˜¯å› ä¸ºå…¶ä»–åŸå› ï¼Ÿä»åº“å¦‚æœå›æ‰§ä¸»åº“æ€§èƒ½æ²¡æœ‰ç“¶é¢ˆçš„è¯ï¼Œä¼¼ä¹å¹¶è¡Œå¤åˆ¶æ‰“å¼€çš„æ„ä¹‰ä¹Ÿä¸æ˜¯å¾ˆå¤§ã€‚","like_count":0},{"had_liked":false,"id":83575,"user_name":"å”¯å¥¹å‘½","can_delete":false,"product_type":"c1","uid":1240398,"ip_address":"","ucode":"8F687E8D306840","user_header":"https://static001.geekbang.org/account/avatar/00/12/ed/4e/ef406442.jpg","comment_is_top":false,"comment_ctime":1554655870,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1554655870","product_id":100020801,"comment_content":"key=hash_func(db1+t1+â€œPRIMARYâ€+2ï¼‰<br>æ–‡ç« ä¸­ æ›´æ–° where id = 1 å’Œ where id = 2<br>é‚£ä¸ºå•¥è¿™é‡Œ â€œPRIMARYâ€+2  è€Œä¸æ˜¯ â€œPRIMARYâ€+1å‘¢ï¼Œæˆ–è€…2ä¸ªéƒ½æœ‰å‘¢","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":167344,"discussion_content":"é‡Œé¢çš„é‚£ä¸ª2æ˜¯Idå€¼ä¸º2ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581479164,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":80978,"user_name":"xm","can_delete":false,"product_type":"c1","uid":1254296,"ip_address":"","ucode":"9A08EB6F201D74","user_header":"https://static001.geekbang.org/account/avatar/00/13/23/98/bd96932f.jpg","comment_is_top":false,"comment_ctime":1553768257,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1553768257","product_id":100020801,"comment_content":"æœ‰äº†å°ç–‘é—®ï¼Œå¦‚æœä¸Šäº†ä¸»ä»å¤åˆ¶äº†ï¼Œä¸»åº“çš„ä»»ä½•ç´¢å¼•ï¼ˆé™¤äº†ä¸»é”®ç´¢å¼•ï¼‰æ˜¯ä¸æ˜¯éƒ½å¯ä»¥å»æ‰å•¦ğŸ˜„","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":167346,"discussion_content":"å½“ç„¶ä¸æ˜¯äº†ã€‚ä¸»ä»å¤åˆ¶å’Œç´¢å¼•æœ‰å•¥å¿…ç„¶å…³ç³»å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581479220,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62764,"user_name":"LeonğŸ“·","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1548151075,"is_pvip":false,"replies":[{"id":"22220","content":"semi-syncåœ¨ç¬¬28ç¯‡ä¼šæåˆ°ï¼Œä½†æ˜¯ä¹Ÿä¸æ˜¯å¤§ç¯‡å¹…ä»‹ç»<br><br>åé¢å¯èƒ½ä¹Ÿä¸ä¼šå¤§ç¯‡å¹…ä¸“é—¨ä»‹ç»äº†ï¼Œä½ è¯´ä¸‹ä½ çš„é—®é¢˜å“ˆã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1548172794,"ip_address":"","comment_id":62764,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548151075","product_id":100020801,"comment_content":"è€å¸ˆï¼Œsemisyncå•¥æ—¶å€™è®²ä¸‹ï¼Œæ˜¨å¤©é¢è¯•è¢«é—®åˆ°ä¸€è„¸æ‡µé€¼","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437341,"discussion_content":"semi-syncåœ¨ç¬¬28ç¯‡ä¼šæåˆ°ï¼Œä½†æ˜¯ä¹Ÿä¸æ˜¯å¤§ç¯‡å¹…ä»‹ç»\n\nåé¢å¯èƒ½ä¹Ÿä¸ä¼šå¤§ç¯‡å¹…ä¸“é—¨ä»‹ç»äº†ï¼Œä½ è¯´ä¸‹ä½ çš„é—®é¢˜å“ˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548172794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60862,"user_name":"crazyone","can_delete":false,"product_type":"c1","uid":1115042,"ip_address":"","ucode":"705E34642E41F5","user_header":"https://static001.geekbang.org/account/avatar/00/11/03/a2/ceb37046.jpg","comment_is_top":false,"comment_ctime":1547564118,"is_pvip":false,"replies":[{"id":"21687","content":"å°±æ˜¯ä¸¤é˜¶æ®µæäº¤é‡Œçš„ï¼Œå†™redo çš„ç¬¬ä¸€é˜¶æ®µ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547568097,"ip_address":"","comment_id":60862,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547564118","product_id":100020801,"comment_content":"â€œä¸ç”¨ç­‰åˆ° commit é˜¶æ®µï¼Œåªè¦èƒ½å¤Ÿåˆ°è¾¾ redo log prepare é˜¶æ®µï¼Œå°±è¡¨ç¤ºäº‹åŠ¡å·²ç»é€šè¿‡é”<br>å†²çªçš„æ£€éªŒäº†ã€‚â€è¿™å¥è¯ä¸æ€ä¹ˆç†è§£ã€‚äº‹åŠ¡è·å–é”æ˜¯åœ¨æ‰§è¡Œåˆ°å¯¹åº”çš„è¯­å¥æ‰åšæ£€æŸ¥çš„ï¼Œredo logåœ¨äº‹åŠ¡å½“ä¸­ï¼Œåº”è¯¥ä¹Ÿæ˜¯ä¸€æ¡æ¡æ“ä½œè¯­å¥å†™çš„å§ï¼Ÿéš¾é“å†™å®Œäº†ï¼Œæ‰ä¼šè¿›å…¥åˆ°prepareé˜¶æ®µï¼Ÿè¿™ä¸ªprepareé˜¶æ®µæ˜¯æŒ‡äº‹åŠ¡å·²ç»å®Œå…¨æ‰«ææ‰§è¡Œå®Œæ‰€æœ‰äº‹åŠ¡æ“ä½œï¼Œå‡†å¤‡å†™å…¥åˆ°redo logæ–‡ä»¶çš„é˜¶æ®µ?","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436647,"discussion_content":"å°±æ˜¯ä¸¤é˜¶æ®µæäº¤é‡Œçš„ï¼Œå†™redo çš„ç¬¬ä¸€é˜¶æ®µ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547568097,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60717,"user_name":"ç‰§é±¼","can_delete":false,"product_type":"c1","uid":1360250,"ip_address":"","ucode":"0EB8FDD7A4BB2E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erFY9H3mxyTpZ9gxAmdeKic565hicicDZmv7cjswd8hdernmxib0chdQrlDNKUZQ8AticQCgDdgVEmJNuA/132","comment_is_top":false,"comment_ctime":1547536118,"is_pvip":false,"replies":[{"id":"21669","content":"1. ä¸ä¼šæœ‰ä¸€åŠäº‹åŠ¡å‘€ï¼Œæ˜¯ä»€ä¹ˆåœºæ™¯ä¸‹å‘ç°çš„ï¼Ÿ<br>2. è¯´å‡½æ•°å…¥å£å¯èƒ½ä¸ä¼šåšå“ˆï¼Œå› ä¸ºå¾ˆå¤šåŸç†æ¶‰åŠåˆ°ä¸æ­¢ä¸€ä¸ªå‡½æ•°å…¥å£ï¼Œæˆ‘è§‰å¾—è¿˜æ˜¯è¯´åŸç†æœ¬èº«å¥½äº›å“¦<br>ä¸è¿‡å¦‚æœä½ å¯¹æŸä¸€ä¸ªç‚¹æƒ³äº†è§£å‡½æ•°å®ç°çš„è¯ï¼Œå¯ä»¥åœ¨è¯„è®ºåŒºå‘å‡ºæ¥","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547551904,"ip_address":"","comment_id":60717,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547536118","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œçœ‹è¯„è®ºåŒºï¼Œæåˆ°ä¸€ä¸ªä¸€åŠäº‹åŠ¡çš„é—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜å¯æ˜¯å¾ˆå¤§çš„é—®é¢˜å‘¢ï¼Œæ€ä¹ˆé¿å…è¿™ç§é—®é¢˜å‡ºç°å‘¢ï¼Ÿmysqlè¿™è¾¹æœ‰ä»€ä¹ˆåº”å¯¹æªæ–½å—ï¼Ÿå¦å¤–ï¼Œèƒ½å¦è¯´æ˜ä¸€ä¸‹æ¯ä¸€å—çŸ¥è¯†éƒ¨åˆ†æºç å…¥å£å‡½æ•°å‘¢ï¼Ÿèƒ½å¤Ÿè®©å¤§å®¶æ›´æ·±å…¥ç†è§£mysqlå†…éƒ¨åˆ°åº•æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œå½¢æˆä¸€ä¸ªä¸»çº¿çš„çŸ¥è¯†ä½“ç³»ã€‚ä¹Ÿå°±æ˜¯çŸ¥å…¶ç„¶ï¼Œè¿˜è¦çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436596,"discussion_content":"1. ä¸ä¼šæœ‰ä¸€åŠäº‹åŠ¡å‘€ï¼Œæ˜¯ä»€ä¹ˆåœºæ™¯ä¸‹å‘ç°çš„ï¼Ÿ\n2. è¯´å‡½æ•°å…¥å£å¯èƒ½ä¸ä¼šåšå“ˆï¼Œå› ä¸ºå¾ˆå¤šåŸç†æ¶‰åŠåˆ°ä¸æ­¢ä¸€ä¸ªå‡½æ•°å…¥å£ï¼Œæˆ‘è§‰å¾—è¿˜æ˜¯è¯´åŸç†æœ¬èº«å¥½äº›å“¦\nä¸è¿‡å¦‚æœä½ å¯¹æŸä¸€ä¸ªç‚¹æƒ³äº†è§£å‡½æ•°å®ç°çš„è¯ï¼Œå¯ä»¥åœ¨è¯„è®ºåŒºå‘å‡ºæ¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547551904,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60305,"user_name":"å°è¶…","can_delete":false,"product_type":"c1","uid":1068004,"ip_address":"","ucode":"FCC8B303A16E70","user_header":"https://static001.geekbang.org/account/avatar/00/10/4b/e4/0219e7c8.jpg","comment_is_top":false,"comment_ctime":1547456639,"is_pvip":false,"replies":[{"id":"21558","content":"å¯¹ï¼Œcommit_id ä¼šå†™åˆ°binlogé‡Œé¢ï¼Œè€Œcommit_id ä½“ç°äº†ä¸»åº“â€œåŒæ—¶è¿›å…¥redo log prepare å’Œ commit â€è¿™ä¸ªçŠ¶æ€","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547484039,"ip_address":"","comment_id":60305,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547456639","product_id":100020801,"comment_content":"è€å¸ˆï¼Œä»åº“ä¸æ˜¯åªæ ¹æ®binlogæ¥åšç›¸åº”çš„æ“ä½œä¹ˆï¼Œè¿™ä¸ªå¹¶è¡Œå¤åˆ¶ç­–ç•¥æ ¹æ®äº‹åŠ¡ç›¸åŒcommit_idåˆ¤æ–­å¥½ç†è§£ï¼Œä½†æ˜¯æ ¹æ®åŒæ—¶è¿›å…¥redo log prepare å’Œ commit æ¥åˆ¤æ–­è¿™ä¸ªæ€ä¹ˆç†è§£ï¼Ÿäº‹åŠ¡æäº¤çš„æ—¶å€™ï¼Œå…¶ä»–äº‹åŠ¡çš„redo logå¤„äºprepareçš„çŠ¶æ€äº‹åŠ¡çš„æŸä¸ªæ ‡è¯†ä¹Ÿä¼šè®°å½•åˆ°æ¯ä¸€ä¸ªäº‹åŠ¡çš„binlogä¸­ä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436471,"discussion_content":"å¯¹ï¼Œcommit_id ä¼šå†™åˆ°binlogé‡Œé¢ï¼Œè€Œcommit_id ä½“ç°äº†ä¸»åº“â€œåŒæ—¶è¿›å…¥redo log prepare å’Œ commit â€è¿™ä¸ªçŠ¶æ€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547484039,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":59724,"user_name":"å¼ å…ˆå…ˆæ£®æ£®æ£®","can_delete":false,"product_type":"c1","uid":1304393,"ip_address":"","ucode":"6DF6E4FA5E3968","user_header":"","comment_is_top":false,"comment_ctime":1547422632,"is_pvip":false,"replies":[{"id":"21483","content":"å¤‡åº“æ˜¯è¦åªç”¨äºæŸ¥è¯¢ï¼›<br>æ›´æ–°äº‹åŠ¡åªå‘ç»™ä¸»åº“ï¼Œåªè¯»äº‹åŠ¡è¿˜æ˜¯å¯ä»¥å‘ç»™å¤‡åº“çš„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547432531,"ip_address":"","comment_id":59724,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547422632","product_id":100020801,"comment_content":"å¤‡åº“ä¸æ˜¯ä»…ç”¨äºæŸ¥è¯¢ä¹ˆï¼Ÿbeginçš„è¯ï¼Œä¸æ˜¯ä¼šåœ¨ä¸»åº“æ‰§è¡Œä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436385,"discussion_content":"å¤‡åº“æ˜¯è¦åªç”¨äºæŸ¥è¯¢ï¼›\næ›´æ–°äº‹åŠ¡åªå‘ç»™ä¸»åº“ï¼Œåªè¯»äº‹åŠ¡è¿˜æ˜¯å¯ä»¥å‘ç»™å¤‡åº“çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547432531,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":59614,"user_name":"itzzy","can_delete":false,"product_type":"c1","uid":1058553,"ip_address":"","ucode":"25C4B6F6FDE945","user_header":"https://static001.geekbang.org/account/avatar/00/10/26/f9/2a7d80a3.jpg","comment_is_top":false,"comment_ctime":1547392490,"is_pvip":false,"replies":[{"id":"21420","content":"æŠ¥é”™çš„åŸå› å‘æˆ‘çœ‹ä¸‹<br><br>è¿˜æœ‰ï¼Œ5.7æ”¯æŒå¯†ç è¿‡æœŸçš„åŠŸèƒ½ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯è¿™ä¸ªåŸå› å¯¼è‡´çš„ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547397055,"ip_address":"","comment_id":59614,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547392490","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œmacä¸Šæœ¬æœºä½¿ç”¨mysqlé‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œå®‰è£…æ—¶é‡ç½®è¿‡rootçš„å¯†ç ï¼Œæœ‰ä¸€æ®µæ—¶é—´æ²¡æœ‰ä½¿ç”¨æœ¬åœ°çš„mysqlï¼Œå‰å‡ å¤©ä½¿ç”¨å‘ç°åˆè¦é‡ç½®å¯†ç ï¼Œåœ¨ç½‘ä¸Šæ‰¾èµ„æ–™è§£å†³äº†ï¼Œä½†æ˜¯è¿˜æ˜¯ä¸çŸ¥é“ä¸ºå•¥ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Œå¸Œæœ›è€å¸ˆçœ‹åˆ°è§£ç­”ä¸‹ï¼Œæ„Ÿè°¢~","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436366,"discussion_content":"æŠ¥é”™çš„åŸå› å‘æˆ‘çœ‹ä¸‹\n\nè¿˜æœ‰ï¼Œ5.7æ”¯æŒå¯†ç è¿‡æœŸçš„åŠŸèƒ½ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯è¿™ä¸ªåŸå› å¯¼è‡´çš„ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547397055,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":59060,"user_name":"å¤©ä½¿ä¹‹å‰‘","can_delete":false,"product_type":"c1","uid":1306842,"ip_address":"","ucode":"69B2D109AE282F","user_header":"https://static001.geekbang.org/account/avatar/00/13/f0/da/74bbb9e6.jpg","comment_is_top":false,"comment_ctime":1547289046,"is_pvip":false,"replies":[{"id":"21372","content":"â€œè®°å½•å¹¶ä¸å‡†å¤‡â€ ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547293142,"ip_address":"","comment_id":59060,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547289046","product_id":100020801,"comment_content":"mysql 5.7å¹¶è¡Œå¤åˆ¶æœ‰ä¸€ä¸ªbugï¼Œæ˜¯seconds_behind_masterè®°å½•å¹¶ä¸å‡†å¤‡ï¼Œæ˜¾ç¤ºä¸º0ï¼Œä½†æ˜¯å®é™…å¹¶ä¸ä¸º0ï¼Œèƒ½ä¸èƒ½è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆï¼Ÿå¹¶ä¸”æœ‰æ²¡æœ‰å…¶ä»–åœ°æ–¹å¯ä»¥è¯»åˆ°å‡†ç¡®çš„å€¼å‘¢","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436289,"discussion_content":"â€œè®°å½•å¹¶ä¸å‡†å¤‡â€ ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547293142,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58850,"user_name":"ä¿¡ä¿¡","can_delete":false,"product_type":"c1","uid":1303865,"ip_address":"","ucode":"8DF0EC045579FD","user_header":"https://static001.geekbang.org/account/avatar/00/13/e5/39/951f89c8.jpg","comment_is_top":false,"comment_ctime":1547212569,"is_pvip":false,"replies":[{"id":"21311","content":"ä¸»åº“ä¸Šå¯ä»¥åŒæ—¶running çš„äº‹åŠ¡åœ¨å¤‡åº“ä¸Šä¸å¯ä»¥å¹¶è¡Œã€‚<br><br>è¿™ä¸ªä¸å¯¹å‘€ï¼Œæ¯”å¦‚ä¸¤ä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶runningï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼š<br>1. ä¸¤ä¸ªæ›´æ–°ä¸åŒçš„è¡Œï¼Œè¿™æ ·åœ¨å¤‡åº“å°±å¯ä»¥å¹¶è¡Œï¼›<br>2. æ›´æ–°åŒä¸€è¡Œï¼Œä¸€ä¸ªåœ¨æ‰§è¡Œï¼Œä¸€ä¸ªåœ¨é”ç­‰å¾…ï¼Œéƒ½æ˜¯runningï¼Œè¿™ç§åœ¨å¤‡åº“å°±ä¸èƒ½å¹¶è¡Œ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547233320,"ip_address":"","comment_id":58850,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547212569","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæœ‰ä¸ªé—®é¢˜æƒ³åŠå¤©ï¼šä¸»åº“ä¸Šå¯ä»¥åŒæ—¶running çš„äº‹åŠ¡åœ¨å¤‡åº“ä¸Šä¸å¯ä»¥å¹¶è¡Œã€‚æœ€åè®¤ä¸ºinnodbæ˜¯å•çº¿ç¨‹æ‰§è¡Œå¤šå®¢æˆ·ç«¯å‘æ¥çš„å­˜å‚¨å‘½ä»¤çš„ï¼Œä¸çŸ¥è¿™æ ·ç†è§£å¯¹ä¸å¯¹ï¼Ÿè¯·è€å¸ˆè§£ç­”ã€‚","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436233,"discussion_content":"ä¸»åº“ä¸Šå¯ä»¥åŒæ—¶running çš„äº‹åŠ¡åœ¨å¤‡åº“ä¸Šä¸å¯ä»¥å¹¶è¡Œã€‚\n\nè¿™ä¸ªä¸å¯¹å‘€ï¼Œæ¯”å¦‚ä¸¤ä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶runningï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼š\n1. ä¸¤ä¸ªæ›´æ–°ä¸åŒçš„è¡Œï¼Œè¿™æ ·åœ¨å¤‡åº“å°±å¯ä»¥å¹¶è¡Œï¼›\n2. æ›´æ–°åŒä¸€è¡Œï¼Œä¸€ä¸ªåœ¨æ‰§è¡Œï¼Œä¸€ä¸ªåœ¨é”ç­‰å¾…ï¼Œéƒ½æ˜¯runningï¼Œè¿™ç§åœ¨å¤‡åº“å°±ä¸èƒ½å¹¶è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547233320,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58770,"user_name":"åº“æ·˜æ·˜","can_delete":false,"product_type":"c1","uid":1310240,"ip_address":"","ucode":"90813B0C46E978","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqibSwKPg7hiapc49qoM4dibhM3fYANPjfltF2ibBZ3dHX2hibjg5EIIcziahrmjO5R2XrcRibvU39TQS7jg/132","comment_is_top":false,"comment_ctime":1547190401,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1547190401","product_id":100020801,"comment_content":"æˆ‘è®¤ä¸ºè¿˜æ˜¯è¦é‡‡ç”¨writeset æ¨¡å¼ ç”±äºæ˜¯å•çº¿ç¨‹æ’å…¥äº†å¾ˆå¤šæ•°æ®ï¼Œ\r<br>å‚æ•°commit_order æ˜¯å¯¹å¤šçº¿ç¨‹æ•ˆæœæ¯”è¾ƒå¥½ï¼Œå¯¹äºè¿™ç§æƒ…å†µï¼Œæ€§èƒ½å‡ ä¹æ²¡æœ‰ä»€ä¹ˆæå‡\r<br>å‚æ•°writeset_session æ˜¯ä¸ºäº†ä¿è¯åŒsessionäº‹åŠ¡çš„é¡ºåºæ€§ï¼Œæ€§èƒ½ä¸Šä¹Ÿæ²¡æœ‰ä»€ä¹ˆæå‡","like_count":0},{"had_liked":false,"id":58720,"user_name":"éƒ­åˆš","can_delete":false,"product_type":"c1","uid":1292032,"ip_address":"","ucode":"22CB8ECE8E3DCA","user_header":"https://static001.geekbang.org/account/avatar/00/13/b7/00/12149f4e.jpg","comment_is_top":false,"comment_ctime":1547183112,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1547183112","product_id":100020801,"comment_content":"MySQLçš„åˆ†æ”¯ç‰ˆæœ¬MariaDB,Oracle,perconaå¦‚ä½•é€‰å‹å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":58708,"user_name":"æ»”æ»”","can_delete":false,"product_type":"c1","uid":1303342,"ip_address":"","ucode":"6968B5771AF79D","user_header":"https://static001.geekbang.org/account/avatar/00/13/e3/2e/77ad18f4.jpg","comment_is_top":false,"comment_ctime":1547180356,"is_pvip":false,"replies":[{"id":"21226","content":"ä¸æ˜¯ï¼Œå°±æ˜¯çœ‹order by","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547184525,"ip_address":"","comment_id":58708,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547180356","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæƒ³è¯·æ•™æ‚¨ä¸€ä¸ªé—®é¢˜ï¼Œçœ‹åˆ°ç½‘ä¸Šæœ‰ä¸€æ®µè¯&quot;ä½¿ç”¨å€’åºç´¢å¼•å¯ä»¥æå‡order by descçš„æ€§èƒ½&quot;ï¼Œæƒ³é—®ä¸€ä¸‹è¿™æ˜¯å¦è¿˜è¦çœ‹å…·ä½“çš„èŒƒå›´æŸ¥è¯¢è¯­å¥æ˜¯&lt;è¿˜æ˜¯&gt;ï¼Œå¦‚æœæ˜¯&gt;ä½¿ç”¨å€’åºç´¢å¼•å¯ä»¥æå‡order by descçš„æ€§èƒ½ï¼Œä½†æ˜¯å¦‚æœæ˜¯&lt;åº”è¯¥ä½¿ç”¨é»˜è®¤å‡åºç´¢å¼•ä¼šæ›´å¿«ï¼Œæ˜¯è¿™æ ·ä¹ˆï¼ŸğŸ¤”","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436182,"discussion_content":"ä¸æ˜¯ï¼Œå°±æ˜¯çœ‹order by","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547184525,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58704,"user_name":"ä¸‡å‹‡","can_delete":false,"product_type":"c1","uid":1309092,"ip_address":"","ucode":"BC9E0918DF4516","user_header":"https://static001.geekbang.org/account/avatar/00/13/f9/a4/f0b92135.jpg","comment_is_top":false,"comment_ctime":1547179076,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1547179076","product_id":100020801,"comment_content":"1.å¦‚æœæ˜¯å¤šå¼ è¡¨åˆ†åˆ«æ’å…¥æ•°æ®ï¼Œæˆ‘è§‰å¾—é€‰ç”¨commit_orderå€¼ï¼Œæ¯ä¸ªè¡¨æŒ‰ç…§é¡ºåºæ’å…¥æ•°æ®åˆ†æ‰¹æäº¤ï¼Œå¤‡åº“çš„workerçº¿ç¨‹å¯ä»¥å¹¶è¡Œæ‰§è¡Œä¸åŒçš„è¡¨ã€‚<br>2.å¦‚æœæ˜¯å•è¡¨é¡ºåºæ’å…¥å¤§é‡æ•°æ®ï¼Œæˆ‘è§‰å¾—é€‰ç”¨wirteset_sessionå€¼ï¼Œå¤‡åº“è¦ä¿è¯æ‰§è¡Œçš„é¡ºåºã€‚<br>3.å¦‚æœæ˜¯å¤šå¼ è¡¨æ— åºçš„æ’å…¥æ•°æ®ï¼Œæˆ‘è§‰å¾—é€‰ç”¨writesetå€¼ï¼Œä¸¤ä¸ªäº‹åŠ¡æ²¡æœ‰æ“ä½œä¸€å¼ è¡¨ï¼Œå¯ä»¥å¹¶è¡Œè¿è¡Œã€‚","like_count":0},{"had_liked":false,"id":58703,"user_name":"å€ªå¤§äºº","can_delete":false,"product_type":"c1","uid":1193052,"ip_address":"","ucode":"4798D69F3E86FB","user_header":"https://static001.geekbang.org/account/avatar/00/12/34/5c/6b4757a0.jpg","comment_is_top":false,"comment_ctime":1547178846,"is_pvip":false,"replies":[{"id":"21221","content":"ç¬¬äºŒéƒ¨åˆ†ä¸æ˜¯å¾ˆå‡†ç¡®ï¼Œè¦å†é‡æ–°ç†è§£ä¸‹å“ˆğŸ˜†<br><br>ï¼ˆä¸è¿‡çœ‹ä½ åé¢çš„è¯„è®ºï¼Œåº”è¯¥æ˜¯getåˆ°ç‚¹äº†ï¼‰","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547179710,"ip_address":"","comment_id":58703,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547178846","product_id":100020801,"comment_content":"ä½œä¸šé¢˜ï¼š<br>â€œä¸»åº“å•çº¿ç¨‹æ’å…¥äº†å¾ˆå¤šæ•°æ®â€ =&gt; ä¸é€‚åˆç”¨COMMIT_ORDERï¼Œå› ä¸ºæ¯ç»„æäº¤çš„äº‹åŠ¡éƒ½åªåŒ…å«ä¸€ä¸ªäº‹åŠ¡ï¼Œå¦‚æœç”¨COMMIT_ORDERå°±ç›¸å½“äºå¤‡åº“ä¸€ç›´ä¸²è¡Œæ‰§è¡Œï¼Œå¹¶ä¸”è¿˜å¾—ç­‰æ¯ä¸ªäº‹åŠ¡æäº¤ä¹‹åæ‰èƒ½å–ä¸‹ä¸€æ‰¹æ‰§è¡Œï¼Œä¼šæ…¢ä¸€äº›ã€‚<br><br>è€ŒWRITESET_SESSIONç›¸æ¯”WRITESETï¼ŒæŒ‰æˆ‘çš„ç†è§£å°±æ˜¯ä¸ºäº†è§£å†³æ–‡é‡Œä¸¾çš„â€œå”¯ä¸€ç´¢å¼•aâ€è¿™ä¸ªä¾‹å­çš„æƒ…å†µï¼Œæ‰€ä»¥ç»“è®ºæ˜¯ï¼šå¦‚æœè¡¨æœ‰å”¯ä¸€ç´¢å¼•å°±é€‰WRITESETï¼Œæ²¡æœ‰å°±é€‰WRITESET_SESSIONã€‚<br><br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436179,"discussion_content":"ç¬¬äºŒéƒ¨åˆ†ä¸æ˜¯å¾ˆå‡†ç¡®ï¼Œè¦å†é‡æ–°ç†è§£ä¸‹å“ˆğŸ˜†\n\nï¼ˆä¸è¿‡çœ‹ä½ åé¢çš„è¯„è®ºï¼Œåº”è¯¥æ˜¯getåˆ°ç‚¹äº†ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547179710,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58695,"user_name":"éƒ­æ±Ÿä¼Ÿ","can_delete":false,"product_type":"c1","uid":1313994,"ip_address":"","ucode":"613D638619B5A2","user_header":"https://static001.geekbang.org/account/avatar/00/14/0c/ca/6173350b.jpg","comment_is_top":false,"comment_ctime":1547177112,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1547177112","product_id":100020801,"comment_content":"å¦‚æœå•çº¿ç¨‹æ’å…¥å¾ˆå¤šæ•°æ®ï¼Œä»åº“å¼€å¹¶è¡Œå¤åˆ¶ï¼Œbinlog-transaction-dependency-trackingåªèƒ½ç”¨writesetï¼Œç†ç”±æ˜¯ï¼š<br>commit_order å‚æ•°æŒ‰ç…§åŒæ—¶è¿›å…¥prepare å’Œcommit æ¥åˆ¤æ–­æ˜¯å¦æ˜¯å¦å¯ä»¥å¹¶è¡Œï¼Œè¿™é‡Œæ˜¯å•çº¿ç¨‹ï¼Œåœ¨ä¸€ä¸ªcommitæˆåŠŸè¿”å›å‰ä¸ä¼šæœ‰ä¸‹ä¸€ä¸ªäº‹åŠ¡<br>write_session æ„æ€æ˜¯ä¸»åº“ä¸ŠåŒä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œçš„äº‹åŠ¡ï¼Œåœ¨ä»åº“æ‰§è¡Œçš„æ—¶å€™éœ€è¦ä¿è¯å…ˆåé¡ºåºï¼›å½“ä¸»åº“æ˜¯å•çº¿ç¨‹åšäº†å¾ˆå¤šäº‹åŠ¡æ—¶ï¼Œå³ä½¿ä»åº“å°†äº‹åŠ¡åˆ†å‘åˆ°å¤šä¸ªworkerï¼Œä»åº“ä»ç„¶æ˜¯ä¸²è¡Œæ‰§è¡Œ","like_count":0},{"had_liked":false,"id":58655,"user_name":"skyoo","can_delete":false,"product_type":"c1","uid":1302503,"ip_address":"","ucode":"EBC0528BA02DD7","user_header":"https://static001.geekbang.org/account/avatar/00/13/df/e7/4ce5ed27.jpg","comment_is_top":false,"comment_ctime":1547167620,"is_pvip":false,"replies":[{"id":"21202","content":"æˆ‘ä¹Ÿæ˜¯^_^","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547176201,"ip_address":"","comment_id":58655,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547167620","product_id":100020801,"comment_content":"è¶Šæ¥è¶Šå–œæ¬¢çœ‹è¯„è®ºåŒºå•¦ ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436152,"discussion_content":"æˆ‘ä¹Ÿæ˜¯^_^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547176201,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}