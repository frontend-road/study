{"id":665679,"title":"21｜数据库ORM对象关系映射（一）：数据库连接与必备操作","content":"<p>你好，我是Barry。</p><p>数据库作为项目的基石，十分重要。因为它是存储用户信息、订单记录、交易记录和产品信息等核心数据的地方。数据库还支持高效的数据查询和处理，能让项目更快地响应用户请求。最重要的是它还有安全功能，比如加密、用户认证和权限控制等等，确保数据不会被盗用或篡改。</p><p>这节课，我们一起来学习在线视频平台的数据管理基石——数据库。</p><h2>数据库类型</h2><p>数据库相当于一个大型的文件柜，里面存储了各种各样的数据。通过数据库，我们就能更方便地查找、添加、修改或删除项目中的数据。</p><p>数据库里的大量数据集合是通过数据结构（比如说顺序表、链表、栈、队列、二叉树、堆、哈希表等等）来进行组织、存储和管理的，能更高效地实现数据的增删改查。</p><p>那常用的数据库有哪些呢？我们项目中用到的MySQL就是其中一种，此外还有SQLServer、Oracle等数据库。我们先来了解一下SQLServer和Oracle。</p><p>SQLServer比较适合大型的企业级应用，很多学校也会使用。SQLServer还提供了多种聚合函数，如SUM、AVG、COUNT、MIN、MAX等，用来统计和计算数据。</p><p>而Oracle数据库管理系统（Oracle Database）是甲骨文公司的一款关系数据库管理系统。它是在数据库领域一直处于领先地位的产品。它是一种高效率的、可靠性好的、适应高吞吐量的数据库方案。</p><!-- [[[read_end]]] --><p>那为什么我们在项目中选择了MySQL，而不用Oracle呢？MySQL是一种轻量级数据库，免费且开源，使用方便。它通常适用于互联网项目，特别是Web开发项目，因为它支持大量的并发用户。由于它的开源性质，你可以很容易地找到社区支持和资源。</p><p>而Oracle则需要收费，它的支撑体系完善、强大，安全性高。Oracle适用于一些大型企业或传统行业的数据化业务，特别是银行、金融、保险等行业，因为这些行业通常对数据的可用性、安全性和实时性要求非常高。</p><p>了解了数据库的类型和优缺点之后，结合项目需求以及我们整体的学习规划，选用MySQL更为合适。接下来，我们就详细了解一下MySQL。</p><h3>数据库的基本概念</h3><p>数据库有几个核心概念需要我们熟练掌握，包括表、记录、字段、主键、外键、索引和视图。我们不妨和Excel做个比对，这能让你更好地掌握它们的用途。</p><p>表就是存储数据的“盒子”，每个表中可以有多个记录和多种不同类型的数据。</p><p>记录就是表中的一行数据，对应Excel中的每一行。</p><p>字段，就是表中的一列数据，和Excel中的某个列一样，比如姓名、年龄等，这个贴合我们的需求来决定有哪些字段。</p><p>主键是用来唯一标识每个记录的，就像身份证号码一样。我们需要注意的是，<strong>在一个数据表里，主键有且仅有一个</strong>。外键我们也会经常用到的，它可以用来联系两个表的关系，查找和比较数据等时候比较方便。</p><p>说到查找数据，我们就不得不提到索引，它就像一本字典，按照指定的关键字来排序并快速去查找数据，相当于Excel表格中的筛选功能。</p><p>最后要说到的概念就是视图，它是由查询语句生成的虚拟表格，方便我们操作和查看数据，让我们的操作和管理更直观。</p><p>不难发现，我们前面说的这些基本概念主要用于组织和管理数据，不过它们都属于单维度的表概念。接下来，我再带你梳理一下表之间的几种关系，这也是我们在应用工程中必不可少的。</p><p>表之间有三种关系：一对一、一对多和多对多。一对一关系就像一个人的身份证号码只与其户籍信息相关联。一对多关系就好比一个公司可以拥有多个部门，而一个部门只属于一个公司。多对多关系就像学生可以选择多门课程，而一门课程也可以被多个学生选择。</p><p>只有熟悉了表相关的这些基本概念，才能结合需求梳理出对应的表关系。</p><h3>数据库的操作概念</h3><p>接下来我们更进一步，来熟悉一下数据库的操作。项目中应用数据库的重点就是对数据库的操作，所以我们对数据库的操作概念一定要有所了解。</p><p>数据库的四大操作分别为新增（INSERT）、查询（SELECT）、修改（UPDATE）和删除（DELETE）。</p><ul>\n<li>新增数据就是在数据库表中添加一条记录。像用户注册这类操作，就相当于在数据库中新增一条数据。</li>\n<li>查找数据是指可以根据字段来查找数据库表中的某条记录。我们项目里最常用搜索功能，就是根据某个字段去数据库中查找。</li>\n<li>修改数据一般是在查找数据的前提下，更改相应字段对应的值。像我们之前讲到的视频信息修改、用户个人修改，都属于对原有信息的修改操作。</li>\n<li>删除数据可以是删除数据库表中的某条记录，也可以是删除某个字段，但是删除字段很可能改变表结构。所以通常情况下我们删除操作的对象都是记录。</li>\n</ul><p>虽然数据库的操作概念相对简单，但我们还是有必要掌握，这样后续应用时才能知其所以然。下面我们就进入实操环节，一起来完成数据库工具的安装与实践，为项目开发做好准备。</p><h2>数据库工具的安装和实践</h2><p>我们在使用数据库之前，一定要保证本地有相应的安装程序，其中包括MySQL数据库的安装和可视化工具的安装。</p><h3>MySQL数据库安装</h3><p>对于MySQL数据库，我们可以在官网下载应用程序。为了提升安装成功率建议使用离线安装包的方式。安装包的<a href=\"https://dev.mysql.com/downloads/mysql/5.5.html#downloads\">官网地址</a>我也给你放在这里，你直接点击即可下载。</p><p>考虑到电脑系统的不同，我们先来看一下Windows和macOS环境下的版本选择，如果你的系统是Windows，参考下面的图片选择就可以。</p><p><img src=\"https://static001.geekbang.org/resource/image/e7/ca/e7c84d00dda41d85a724d007c677c6ca.jpg?wh=1335x965\" alt=\"\"></p><p>macOS的选择可以参考后面截图里的选项。</p><p><img src=\"https://static001.geekbang.org/resource/image/f6/a2/f635f8468e2d6912de64f292c5b5dea2.jpg?wh=2864x1399\" alt=\"\"></p><p>下面我以Windows系统为案例，演示一下整个安装的过程，让你对安装的过程有一个大致的了解。</p><p>下载好前面提到的安装包之后，为了后续操作方便，我们统一把MySQL安装在D:\\mysql 这个文件夹下，这个安装路径你也可以自己选择。初始文件的内容截图我也贴在了后面，可以看一下。</p><p><img src=\"https://static001.geekbang.org/resource/image/34/f8/34b7fbcfebded2042eac73de5a99bbf8.jpg?wh=1900x655\" alt=\"\"></p><p>下载完成之后我们直接解压文件即可。然后，在解压文件中找到 <strong>bin文件</strong>，复制该文件的路径，我们需要这个文件路径完成环境配置，这样才能支持后续使用。这里你同样可以参考后面的截图。</p><p><img src=\"https://static001.geekbang.org/resource/image/2b/d4/2b70fd0d38385293d9d362bf72bc06d4.jpg?wh=2000x1699\" alt=\"\"></p><p>在环境配置这一步，你应该比较熟悉了，像之前的Python应用你也需要安装并配置，它们是一样的过程，同样要在控制面板中的高级系统设置里设置。然后我们需要在系统属性的级选项中，点击环境变量。</p><p>下一步就是在系统变量中找到path，点击编辑，在path的变量值后面加上我们之前复制的bin文件路径。这里需要注意的是，<strong>添加bin文件路径之前，记得先给上一个路径加上英文格式的分号“；”。</strong></p><p><img src=\"https://static001.geekbang.org/resource/image/c3/7b/c3cc187e54f0510f23501856d9e8b77b.jpg?wh=1585x803\" alt=\"\"></p><p>配置好环境变量后，下一步就是创建一个新的my.ini文件，该文件的用途是初始化MySQL数据库。my.ini文件中代码是后面这样，你可以参考一下。相信对照里面的详细注释，你很容易就能明白每个属性的作用。</p><pre><code class=\"language-plain\">[mysql]\n# 设置mysql客户端默认字符集\ndefault-character-set=utf8\n[mysqld]\n# 设置3306端口\nport = 3306\n# 设置mysql的安装目录\nbasedir = D:\\\\mysql\\\\mysql-8.0.33-winx64\n# 设置mysql数据库的数据的存放目录\ndatadir = D:\\\\mysql\\\\mysql-8.0.33-winx64\\\\data\n# 允许最大连接数\nmax_connections=20\n# 服务端使用的字符集默认为8比特编码的latin1字符集\ncharacter-set-server=utf8\n# 创建新表时将使用的默认存储引擎\ndefault-storage-engine=INNODB\n# 创建模式\nsql_mode = NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES\n</code></pre><p>创建好文件以后，就进入到了初始化的环节。我们需要进入cmd命令行，通过命令进入bin文件路径下。然后输入命令 mysqld --initialize来完成数据库的初始化。具体的执行效果如下图所示。</p><p><img src=\"https://static001.geekbang.org/resource/image/6c/6a/6c6f687a93b4de2ab33e1229b1628b6a.jpg?wh=2761x1200\" alt=\"\"></p><p>初始化完成后，你会发现多出了一个data文件夹。data文件中有一个后缀为 .err的文件，里面存放的是初始化登录mysql的密码。</p><p><img src=\"https://static001.geekbang.org/resource/image/58/54/588fcb8274eb8a76511a280b7c423c54.jpg?wh=1689x622\" alt=\"\"></p><p>我们用记事本方式打开 .err文件，就能找到其中存储的用户名和密码。我们需要这个账户和密码去启动MySQL的服务。</p><p><img src=\"https://static001.geekbang.org/resource/image/e1/31/e199932b0a7ed206b1723b35cf212331.jpg?wh=1401x547\" alt=\"\"></p><p>再之后就是启动MySQL服务。我们需要在bin目录下输入后面的命令。</p><pre><code class=\"language-python\">net start mysql\n</code></pre><p>对应的启动效果图我也放在了下面，你可以看一下。</p><p><img src=\"https://static001.geekbang.org/resource/image/12/d9/129b29e333af450yy6454b24d8b846d9.jpg?wh=2700x854\" alt=\"\"></p><p>服务启动以后，我们就能登录MySQL了，登录数据库的具体执行命令是后面这样，你可以直接使用。</p><pre><code class=\"language-plain\">mysql -uroot -p\n</code></pre><p>我再来给你讲讲前面这条命令的具体含义。</p><p>-u 后面跟着用户名，指定要登录的 MySQL 用户名，这里是 root，表示以 root 用户身份登录；-p 后面跟着密码，指定要登录的 MySQL 密码，这里需要输入 root 用户的密码。该命令的作用就是以 root 用户身份登录到 MySQL 数据库，并授权其他用户访问操作数据库。</p><p>按回车执行后，就会显示Enter password的字样，我们在这段文字后面输入 .err文件中给出的密码即可。如果输入以后显示后面截图里的字样，就代表登录成功了。</p><p><img src=\"https://static001.geekbang.org/resource/image/53/8f/53a169ae7c32b3712bbfcee2fbbeb38f.jpg?wh=2761x1200\" alt=\"\"></p><p>登录成功后，我们可以修改自己的root账户的密码，具体的执行代码如下。</p><pre><code class=\"language-plain\">alter user 'root'@'localhost' identified with mysql_native_password by 'flask_project';\n</code></pre><p>最后，我们还需要设置MySQL服务。这个操作同样要在我的电脑的管理选项中，选择服务与应用程序，点击进入之后选择<strong>“服务”</strong>。</p><p><img src=\"https://static001.geekbang.org/resource/image/fa/b7/fa531bce5940102ded3b3d1259b259b7.jpg?wh=1987x1479\" alt=\"\"></p><p>然后，我们要在列表中找到&nbsp;<strong>“MySQL”</strong>。之前我们已经使用语句 net start mysql 启动服务了，所以这里我们可以把启动类型设置为“自动”。</p><p><img src=\"https://static001.geekbang.org/resource/image/bc/7e/bc64cf8218aabaa083b487f532a23c7e.jpg?wh=2600x1865\" alt=\"\"></p><p>到这里我们就成功实现了MySQL的安装和服务启动。</p><h3>Navicat的安装</h3><p>刚刚安装好的MySQL还没有可视化界面，用起来不够方便。所以我们还要安装Navicat，通过它来实现数据库的可视化。Navicat是一个数据库管理工具，可以连接到SQL Server、Oracle以及我们项目里选择的MySQL。</p><p>官网的版本只有14天的免费使用版本和收费版，我给你提供了Windows和Mac的破解版，你可以按需取用。</p><ul>\n<li>Windows版本网盘链接: <a href=\"https://pan.baidu.com/s/173dybxZJF_69gZ3tJaCuYg?pwd=tk7u\">https://pan.baidu.com/s/173dybxZJF_69gZ3tJaCuYg?pwd=tk7u</a> 提取码: tk7u</li>\n<li>macOS版本网盘链接: <a href=\"https://pan.baidu.com/s/1MC1o5OfbPyw41DUyQAEgPQ?pwd=z4fn\">https://pan.baidu.com/s/1MC1o5OfbPyw41DUyQAEgPQ?pwd=z4fn</a> 提取码: z4fn</li>\n</ul><p>解压安装的过程比较简单，你自己根据它的操作提示就能完成安装。下面我们重点来看一下如何实现链接，成功链接是我们后面顺利使用MySQL的前提。</p><p>下载安装成功之后，我们打开对应的界面，直接点击“连接”选择MySQL，对应的界面效果如下图所示。</p><p><img src=\"https://static001.geekbang.org/resource/image/b8/f5/b81a1667c0ab79481b24a09ba1878cf5.jpg?wh=2898x931\" alt=\"\"></p><p>在“连接设置”页面中，我们需要输入连接名称、主机名、端口、用户名和密码。这一块的配置我们前面都已经设置好了，这时候只需要填入即可。具体的效果图如下。</p><p><img src=\"https://static001.geekbang.org/resource/image/f4/1a/f4a570cdebb3c50d37e4f88fc76bb51a.jpg?wh=2940x1510\" alt=\"\"></p><p>完成信息输入之后，你就可以点击“测试连接”按钮。如果连接成功，将会弹出一个“成功连接到服务器”的提示框；如果连接失败，则会弹出一个错误提示框，你就需要检查输入的连接信息是否正确。</p><p>到这里，我们完成了数据库的安装和应用的所有内容，为后续数据库应用做好了准备。</p><h2>总结</h2><p>今天的内容告一段落，我们一起来回顾总结一下这节课的重点内容。</p><p>数据库很重要，它是我们整个平台的基石，整个项目开发中都离不开它。几个常用数据库各有特点，经过对比我们选择了MySQL数据库，因为它更符合我们的项目需求和学习规划。</p><p>之后我们数据库的四大操作分别为新增（INSERT）、查询（SELECT）、修改（UPDATE）和删除（DELETE）。</p><p>这里我为你梳理了一张表，整理了MySQL数据库的核心概念和数据库的四大操作，供你复习参考。</p><p><img src=\"https://static001.geekbang.org/resource/image/79/f2/79f49f0fed51e8fb4d3cb1425b8a0ff2.jpg?wh=3634x2778\" alt=\"\"></p><p>学习了核心概念和四大操作之后，我们还完成了MySQL的安装与服务启动，只要你耐心跟着我的步骤操作一定可以搞定。另外，我也给你讲解了可视化工具navicat premium的安装和应用。这些安装配置都非常好上手，希望你在课后一定要自己实践一下，这样才能更加熟练地掌握数据库的应用。</p><h2>思考题</h2><p>在课程中我们讲到了数据库表有多对多的关系，你知道在实际项目中有哪些功能的表关系是多对多设计的吗？</p><p>欢迎你在留言区和我交流互动。如果这节课对你有帮助，也推荐你分享给身边更多朋友。</p>","comments":[{"had_liked":false,"id":382977,"user_name":"Aegean Sea","can_delete":false,"product_type":"c1","uid":3688848,"ip_address":"广西","ucode":"0C6F23AEAC6E07","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELrxUK36wj3AesBNLK4tPibu7URiaI48cMWho2t8bfZOyfYDnQwQu2TTXibIbGVZ8DkPhNXDGr7VTfOJv1R1ccw1KBv5qfbq1bYvDhL1MtAVjISA/132","comment_is_top":false,"comment_ctime":1698249531,"is_pvip":false,"replies":[{"id":139569,"content":"这个我重新给上传一下，之后我把课程的链接更新一下。已经放在下面了，你直接看评论区就可以。","user_name":"作者回复","user_name_real":"作者","uid":3050845,"ctime":1698586057,"ip_address":"北京","comment_id":382977,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100546501,"comment_content":"那个可视化工具怎么不见了老师","like_count":0,"discussions":[{"author":{"id":3050845,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/8d/5d/9a86007c.jpg","nickname":"Barry","note":"","ucode":"82175C78B4CAED","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":630507,"discussion_content":"这个我重新给上传一下，之后我把课程的链接更新一下。已经放在下面了，你直接看评论区就可以。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1698586057,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3050845,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/8d/5d/9a86007c.jpg","nickname":"Barry","note":"","ucode":"82175C78B4CAED","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":630608,"discussion_content":"https://www.macyy.cn/archives/735#J_DLIPPCont 这是可以下载Navicat，大家可以点击链接进行下载","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1698733517,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":376117,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"北京","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1686318720,"is_pvip":false,"replies":[{"id":137223,"content":"1、一台PC上部署一个MySQL实例支持的并发请求数量取决于多个因素，它不是由单一因素决定的，这个你需要清楚，其中包括硬件配置、操作系统、MySQL版本、数据库表结构、查询负载等。因此，很难给出一个具体的数字。一般来说一个中高端的PC上的MySQL实例可以支持数百到数千个并发请求。\n2、自增ID和UUID都可以用作MySQL表的主键。选择哪种类型的主键取决于我们具体需求。\n如果希望主键具有连续的、可排序的值，并且希望主键值在插入新行时自动生成，那么自增ID是一个很好的选择。自增ID通常比UUID生成的索引更小，因此它们可以减少表的存储需求，并提高查询性能。\n如果希望主键具有唯一的随机值，并且希望确保每一行都有一个唯一的标识符，那么UUID是一个很好的选择。UUID虽然具有唯一性，但它们生成的索引可能会比自增ID的索引更大，因此可能会影响表的存储和查询性能。\n\n","user_name":"作者回复","user_name_real":"编辑","uid":3050845,"ctime":1686539164,"ip_address":"北京","comment_id":376117,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100546501,"comment_content":"Q1：一台PC上部署一个MySQL实例，一般情况下，能支持多大并发请求？ \nQ2：MySQL的主键一般用什么？用自增ID吗？好像不能用uuid。","like_count":0,"discussions":[{"author":{"id":3050845,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/8d/5d/9a86007c.jpg","nickname":"Barry","note":"","ucode":"82175C78B4CAED","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":620792,"discussion_content":"1、一台PC上部署一个MySQL实例支持的并发请求数量取决于多个因素，它不是由单一因素决定的，这个你需要清楚，其中包括硬件配置、操作系统、MySQL版本、数据库表结构、查询负载等。因此，很难给出一个具体的数字。一般来说一个中高端的PC上的MySQL实例可以支持数百到数千个并发请求。\n2、自增ID和UUID都可以用作MySQL表的主键。选择哪种类型的主键取决于我们具体需求。\n如果希望主键具有连续的、可排序的值，并且希望主键值在插入新行时自动生成，那么自增ID是一个很好的选择。自增ID通常比UUID生成的索引更小，因此它们可以减少表的存储需求，并提高查询性能。\n如果希望主键具有唯一的随机值，并且希望确保每一行都有一个唯一的标识符，那么UUID是一个很好的选择。UUID虽然具有唯一性，但它们生成的索引可能会比自增ID的索引更大，因此可能会影响表的存储和查询性能。\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1686539164,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1104601,"avatar":"https://static001.geekbang.org/account/avatar/00/10/da/d9/f051962f.jpg","nickname":"浩仔是程序员","note":"","ucode":"A7E5CF9E1571A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":621147,"discussion_content":"老师回答得很好！一般情况下，用自增id作为主键是比较常见的，这跟mysql背后的存储引擎有关，用的比较多InnoDB引擎，会用主键去构建一颗B+索引树，采用自增id，插入数据和查询数据回表效率都会比较高。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1686842596,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}