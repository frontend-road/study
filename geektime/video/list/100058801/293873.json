{"id":293873,"title":"37 | é¡¹ç›®å®æˆ˜ï¼šåŸºäºDataStream APIå®ç°PVï¼ŒUVç»Ÿè®¡","content":"<p><strong>è¯¾ä»¶å’ŒDemoåœ°å€</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-Flink\">https://gitee.com/geektime-geekbang/geektime-Flink</a></p>","comments":[{"had_liked":false,"id":257813,"user_name":"danhanhan","can_delete":false,"product_type":"c3","uid":1701969,"ip_address":"","ucode":"5B63B9C391004F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEJEZvOtmicOtvd4twKCFakedsTjYX1icC6BEMYV1rceqdFHN6DcozxO9FB3ArrktBzh4QLqWibqlqibXQ/132","comment_is_top":false,"comment_ctime":1604138128,"is_pvip":false,"replies":[{"id":94044,"content":"è°¢è°¢","user_name":"ä½œè€…å›å¤","user_name_real":"å¼ åˆ©å…µ","uid":1119779,"ctime":1604335174,"ip_address":"","comment_id":257813,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"è€å¸ˆè®²å¾—å¾ˆå¥½ï¼Œå­¦ä¹ äº†","like_count":1,"discussions":[{"author":{"id":1119779,"avatar":"https://static001.geekbang.org/account/avatar/00/11/16/23/99c7ede5.jpg","nickname":"å¼ åˆ©å…µ","note":"","ucode":"DBAE17970AB143","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":508459,"discussion_content":"è°¢è°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604335174,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":266851,"user_name":"é«˜å¿—å¼º","can_delete":false,"product_type":"c3","uid":1276563,"ip_address":"","ucode":"68737002043752","user_header":"https://static001.geekbang.org/account/avatar/00/13/7a/93/c9302518.jpg","comment_is_top":false,"comment_ctime":1607506105,"is_pvip":false,"replies":[{"id":98228,"content":"Giteeä¸Šå°±å¯ä»¥ä¸‹è½½åˆ°","user_name":"ä½œè€…å›å¤","user_name_real":"å¼ åˆ©å…µ","uid":1119779,"ctime":1609242524,"ip_address":"","comment_id":266851,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹è¿™èŠ‚è¯¾çš„é¡¹ç›®å®æˆ˜æºç åœ¨å“ªé‡Œï¼Œæƒ³çœ‹çœ‹å­¦ä¹ ä¸€ä¸‹ï¼Œè°¢è°¢","like_count":0,"discussions":[{"author":{"id":1119779,"avatar":"https://static001.geekbang.org/account/avatar/00/11/16/23/99c7ede5.jpg","nickname":"å¼ åˆ©å…µ","note":"","ucode":"DBAE17970AB143","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511411,"discussion_content":"Giteeä¸Šå°±å¯ä»¥ä¸‹è½½åˆ°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609242524,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1817975,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/bd/77/52f54d7f.jpg","nickname":"å¼€å¿ƒDå°é¹","note":"","ucode":"95775CDDF36E69","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338853,"discussion_content":"è¿˜æ˜¯æ‰¾ä¸åˆ°ï¼Œgiteeåªæœ‰ppt","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609403399,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":280540,"user_name":"å—å±±å¤æœˆ","can_delete":false,"product_type":"c3","uid":2415578,"ip_address":"","ucode":"600C7781C4078A","user_header":"https://static001.geekbang.org/account/avatar/00/24/db/da/bc7c71e5.jpg","comment_is_top":false,"comment_ctime":1614244602,"is_pvip":false,"replies":null,"discussion_count":2,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"çœ‹å®Œè¿™ä¸ªå®æˆ˜æœ‰ç‚¹ç–‘æƒ‘ï¼Œä¼¼ä¹å®Œå…¨ä¸éœ€è¦å‰ä¸¤ç« è®²åˆ°çš„flinkéƒ¨ç½²ï¼Œåªéœ€è¦å°†ä¾èµ–çš„jaråŒ…ä¸‹è½½ä¸‹æ¥å°±èƒ½å®Œæˆflinkçš„çª—å£è®¡ç®—äº†ï¼Œä¸å‰é¢è®²çš„æäº¤ä½œä¸šåˆ°Clientä»¥åŠJobGraphçš„è½¬æ¢å’Œæäº¤æ˜¯ä¸æ˜¯æ²¡æœ‰å…³ç³»ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":3532766,"avatar":"","nickname":"Geek_bad486","note":"","ucode":"52C97ECA91B1CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":606441,"discussion_content":"è¿™ä¸ªæ˜¯å•æœºçš„ localç¯å¢ƒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677135406,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ¹–åŒ—","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2830418,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/30/52/9ff0a0e7.jpg","nickname":"congğŸ¶","note":"","ucode":"00E913053C5F29","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530891,"discussion_content":"ç”Ÿäº§ç¯å¢ƒéœ€è¦yarnæˆ–ç€k8sç®¡ç†é›†ç¾¤ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637162320,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":273088,"user_name":"ç¢§é›ªå¤©è™¹","can_delete":false,"product_type":"c3","uid":1258359,"ip_address":"","ucode":"313CC048C7E341","user_header":"https://static001.geekbang.org/account/avatar/00/13/33/77/0c593044.jpg","comment_is_top":false,"comment_ctime":1610434562,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"æ²¡æœ‰ElasticSearchç¯å¢ƒ, ç›¸å…³Sinkä»£ç æ³¨é‡Šæ‰äº†.\nWebSocketæç¤ºæ‰¾ä¸åˆ°ç±», å¼•å…¥ javax.websocket:javax.websocket-client-api:1.1 æç¤ºæ‰¾ä¸åˆ°å®ç°, ä¸Šè¯¾20åˆ†é’Ÿé…ç¯å¢ƒ2å°æ—¶.","like_count":2},{"had_liked":false,"id":392973,"user_name":"éšé‡è€Œå®‰ä¸¶","can_delete":false,"product_type":"c3","uid":1358656,"ip_address":"ä¸Šæµ·","ucode":"57E175E4FF7E3A","user_header":"https://static001.geekbang.org/account/avatar/00/14/bb/40/5ba38cfa.jpg","comment_is_top":false,"comment_ctime":1722350374,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"ä½¿ç”¨dockerå¿«é€Ÿå®‰è£…esï¼Œæ–°å»ºdocker-es.ymlï¼š\nversion: &#39;3.8&#39;\nservices:\n  elasticsearch:\n    image: docker.elastic.co&#47;elasticsearch&#47;elasticsearch:7.17.3\n    container_name: elasticsearch\n    environment:\n      - node.name=es-node-1\n      - cluster.name=es-cluster\n      - network.host=0.0.0.0\n      - discovery.type=single-node\n      - ES_JAVA_OPTS=-Xms512m -Xmx512m\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    ports:\n      - &quot;9200:9200&quot;\n      - &quot;9300:9300&quot;\n    volumes:\n      - esdata:&#47;usr&#47;share&#47;elasticsearch&#47;data\n    networks:\n      - es-network\n  kibana:\n    image: docker.elastic.co&#47;kibana&#47;kibana:7.17.3\n    container_name: kibana\n    environment:\n      - SERVER_NAME=kibana\n      - ELASTICSEARCH_HOSTS=http:&#47;&#47;elasticsearch:9200\n    ports:\n      - &quot;5601:5601&quot;\n    networks:\n      - es-network\n\n\nvolumes:\n  esdata:\n    driver: local\n\nnetworks:\n  es-network:\n    driver: bridge\n\n\næ‰§è¡Œdocker-compose -f docker-es.yml up -d","like_count":0},{"had_liked":false,"id":392972,"user_name":"éšé‡è€Œå®‰ä¸¶","can_delete":false,"product_type":"c3","uid":1358656,"ip_address":"ä¸Šæµ·","ucode":"57E175E4FF7E3A","user_header":"https://static001.geekbang.org/account/avatar/00/14/bb/40/5ba38cfa.jpg","comment_is_top":false,"comment_ctime":1722350322,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"ä½¿ç”¨dockerå¿«é€Ÿå®‰è£…kafkaï¼Œæ–°å»ºæ–‡ä»¶docker-kafka.yml:\nversion: &#39;3&#39;\nservices:\n  zookeeper:\n    image: confluentinc&#47;cp-zookeeper:latest\n    ports:\n      - &quot;2181:2181&quot;\n    environment:\n      ZOOKEEPER_CLIENT_PORT: 2181\n      ZOOKEEPER_TICK_TIME: 2000\n\n  kafka:\n    image: confluentinc&#47;cp-kafka:latest\n    ports:\n      - &quot;9092:9092&quot;\n    environment:\n      KAFKA_BROKER_ID: 1\n      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181\n      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT:&#47;&#47;localhost:9092\n      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1\n\n\næ‰§è¡Œå‘½ä»¤docker-compose -f docker-kafka.yml up -d","like_count":0},{"had_liked":false,"id":380203,"user_name":"ç‰›å¹´æ¦´è²","can_delete":false,"product_type":"c3","uid":1183703,"ip_address":"åŒ—äº¬","ucode":"230C076193C6C0","user_header":"https://static001.geekbang.org/account/avatar/00/12/0f/d7/31d07471.jpg","comment_is_top":false,"comment_ctime":1693205200,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"è¿™èŠ‚è¯¾ï¼Œè²Œä¼¼è·ŸFlinkçš„Serveræ²¡æœ‰å…³ç³»","like_count":0},{"had_liked":false,"id":350885,"user_name":"å½­è…¾è¾‰","can_delete":false,"product_type":"c3","uid":2182122,"ip_address":"","ucode":"BD15DF88F4CAE2","user_header":"https://static001.geekbang.org/account/avatar/00/21/4b/ea/f710a451.jpg","comment_is_top":false,"comment_ctime":1657279235,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"flinké‡Œé¢æœ‰åšå“ªäº›æ•°æ®å¤„ç†ï¼Œæ€ä¹ˆåšçš„å¥½åƒæ²¡æœ‰è®²åˆ°","like_count":0},{"had_liked":false,"id":334582,"user_name":"ç¦","can_delete":false,"product_type":"c3","uid":2455712,"ip_address":"","ucode":"F2FC7AF5D433C6","user_header":"https://static001.geekbang.org/account/avatar/00/25/78/a0/7a248ddc.jpg","comment_is_top":false,"comment_ctime":1645005373,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"ä¸æ˜¯è¯´windowallè¦æ·»åŠ è§¦å‘å™¨çš„å˜›ï¼Œï¼Œï¼Œæˆ‘æ€ä¹ˆæ²¡æœ‰çœ‹åˆ°è§¦å‘å™¨ï¼Œç„¶åçª—å£è‡ªå·±å°±è§¦å‘äº†","like_count":0},{"had_liked":false,"id":310569,"user_name":"å­¦æ— æ­¢å¢ƒ","can_delete":false,"product_type":"c3","uid":1645081,"ip_address":"","ucode":"BE6ADDF082AA69","user_header":"https://static001.geekbang.org/account/avatar/00/19/1a/19/440b0c7e.jpg","comment_is_top":false,"comment_ctime":1630748998,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"è¯·æ•™ä¸€ä¸‹è€å¸ˆå’Œå„ä½åŒå­¦ï¼Œå› ä¸ºprocess()æ–¹æ³•æ²¡æœ‰è®¾ç½®ä¸º1ä¸ªå¹¶è¡Œåº¦ï¼Œè¿™æ ·æ±‚å‡ºæ¥çš„uv,pvæ˜¯ä¸æ˜¯æ¯ä¸ªèŠ‚ç‚¹çš„æœ¬åœ°å€¼çš„å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1645081,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1a/19/440b0c7e.jpg","nickname":"å­¦æ— æ­¢å¢ƒ","note":"","ucode":"BE6ADDF082AA69","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392004,"discussion_content":"æµ‹è¯•äº†ä¸€ä¸‹ï¼Œæ˜¯æ±‡æ€»çš„å€¼ã€‚ã€‚çœ‹æ¥çª—å£åçš„æ“ä½œéƒ½æ˜¯åœ¨ä¸€ä¸ªå¹¶è¡Œåº¦é‡Œæ“ä½œçš„ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630761827,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":287620,"user_name":"wenjun00","can_delete":false,"product_type":"c3","uid":1263877,"ip_address":"","ucode":"2069D689BD5CBE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/5icX68uUNNsxLSfNTUhyicIhkaxTDXqqe5icyd24GPD8WPMUfexVMM15RPrviaWLc7HiabG3t4ib86GcVLopUDjpWllQ/132","comment_is_top":false,"comment_ctime":1618051808,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100058801,"comment_content":"Exception in thread &quot;main&quot; java.lang.RuntimeException: No data for required key &#39;index&#39;\n\tat org.apache.flink.api.java.utils.AbstractParameterTool.getRequired(AbstractParameterTool.java:82)\n\tat com.geekbang.flink.project.PVAndUVExample.main(PVAndUVExample.java:99)\nè¿™ä¸ªé”™è¯¯æ˜¯ä»€ä¹ˆå•Šï¼Œè€å¸ˆï¼Œæˆ‘æ²¡çœ‹æ‡‚è¿™å—ä»£ç ï¼Œè¿˜æœ‰æˆ‘çš„esæ˜¯å¸¦ç”¨æˆ·å¯†ç çš„ï¼Œæˆ‘æ·»åŠ ä¸€ä¸‹è¿™å—ä»£ç ï¼š\n        Header[] defaultHeaders = new Header[]{new BasicHeader(&quot;elastic&quot;, &quot;elastic@admin&quot;)};\n        esSinkBuilder.setRestClientFactory(\n                restClientBuilder -&gt; { restClientBuilder.setDefaultHeaders(defaultHeaders);\n                }\n        );\n","like_count":0,"discussions":[{"author":{"id":1488243,"avatar":"https://static001.geekbang.org/account/avatar/00/16/b5/73/15a8006a.jpg","nickname":"goxdev","note":"","ucode":"7374587CD08BEE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391133,"discussion_content":"è¿™é‡Œçš„indexæ˜¯elasticsearchä¸­çš„indexï¼Œå¯ä»¥æ˜¯ä»»ä¸€å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚&#34;my-index&#34;ã€‚ç¤ºä¾‹ç»™çš„ç¨‹åºéœ€è¦ç¨‹åºå¯åŠ¨æ—¶ä¼ ä¸€ä¸ªindexå‚æ•°ã€‚å½“ç„¶å¯ä»¥ä»£ç ä¸­å†™æ­»ï¼Œç„¶åå»æ‰parameterTool.getRequired(&#34;index&#34;)ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630310656,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":264683,"user_name":"å°å­¦ç”ŸğŸ­","can_delete":false,"product_type":"c3","uid":2267592,"ip_address":"","ucode":"5F34627185DA5C","user_header":"https://static001.geekbang.org/account/avatar/00/22/99/c8/12fb3cac.jpg","comment_is_top":false,"comment_ctime":1606575491,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100058801,"comment_content":"çœŸå®å·¥ç¨‹ä¼šå¼€å‘æ—¶ï¼Œå¾€å¾€ä¼šå’Œspringé›†æˆï¼Œåˆ©ç”¨springçš„ç‰¹æ€§æ–¹ä¾¿å¼€å‘ï¼Œè€å¸ˆå¯ä»¥è®²ä¸€ä¸‹å¦‚ä½•é›†æˆspringå—","like_count":0,"discussions":[{"author":{"id":1213147,"avatar":"https://static001.geekbang.org/account/avatar/00/12/82/db/6df4d3d2.jpg","nickname":"sunsum","note":"","ucode":"380BB3A7DC030C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631553,"discussion_content":"+1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1699720402,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}