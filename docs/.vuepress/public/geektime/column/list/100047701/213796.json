{"id":213796,"title":"09 | æ•°å€¼è®¡ç®—ï¼šæ³¨æ„ç²¾åº¦ã€èˆå…¥å’Œæº¢å‡ºé—®é¢˜","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æœ±æ™”ã€‚ä»Šå¤©ï¼Œæˆ‘è¦å’Œä½ è¯´è¯´æ•°å€¼è®¡ç®—çš„ç²¾åº¦ã€èˆå…¥å’Œæº¢å‡ºé—®é¢˜ã€‚</p><p>ä¹‹æ‰€ä»¥è¦å•ç‹¬åˆ†äº«æ•°å€¼è®¡ç®—ï¼Œæ˜¯å› ä¸ºå¾ˆå¤šæ—¶å€™æˆ‘ä»¬ä¹ æƒ¯çš„æˆ–è€…è¯´è®¤ä¸ºç†æ‰€å½“ç„¶çš„è®¡ç®—ï¼Œåœ¨è®¡ç®—å™¨æˆ–è®¡ç®—æœºçœ‹æ¥å¹¶ä¸æ˜¯é‚£ä¹ˆå›äº‹å„¿ã€‚å°±æ¯”å¦‚å‰æ®µæ—¶é—´çˆ†å‡ºçš„ä¸€æ¡æ–°é—»ï¼Œè¯´æ˜¯æ‰‹æœºè®¡ç®—å™¨æŠŠ10%+10%ç®—æˆäº†0.11è€Œä¸æ˜¯0.2ã€‚</p><p>å‡ºç°è¿™ç§é—®é¢˜çš„åŸå› åœ¨äºï¼Œå›½å¤–çš„è®¡ç®—ç¨‹åºä½¿ç”¨çš„æ˜¯å•æ­¥è®¡ç®—æ³•ã€‚åœ¨å•æ­¥è®¡ç®—æ³•ä¸­ï¼Œa+b%ä»£è¡¨çš„æ˜¯a*(1+b%)ã€‚æ‰€ä»¥ï¼Œæ‰‹æœºè®¡ç®—å™¨è®¡ç®—10%+10%æ—¶ï¼Œå…¶å®è®¡ç®—çš„æ˜¯10%*ï¼ˆ1+10%ï¼‰ï¼Œæ‰€ä»¥å¾—åˆ°çš„æ˜¯0.11è€Œä¸æ˜¯0.2ã€‚</p><p>åœ¨æˆ‘çœ‹æ¥ï¼Œè®¡ç®—å™¨æˆ–è®¡ç®—æœºä¼šå¾—åˆ°åç›´è§‰çš„è®¡ç®—ç»“æœçš„åŸå› ï¼Œå¯ä»¥å½’ç»“ä¸ºï¼š</p><ul>\n<li>åœ¨äººçœ‹æ¥ï¼Œæµ®ç‚¹æ•°åªæ˜¯å…·æœ‰å°æ•°ç‚¹çš„æ•°å­—ï¼Œ0.1å’Œ1éƒ½æ˜¯ä¸€æ ·ç²¾ç¡®çš„æ•°å­—ã€‚ä½†ï¼Œè®¡ç®—æœºå…¶å®æ— æ³•ç²¾ç¡®ä¿å­˜æµ®ç‚¹æ•°ï¼Œå› æ­¤æµ®ç‚¹æ•°çš„è®¡ç®—ç»“æœä¹Ÿä¸å¯èƒ½ç²¾ç¡®ã€‚</li>\n<li>åœ¨äººçœ‹æ¥ï¼Œä¸€ä¸ªè¶…å¤§çš„æ•°å­—åªæ˜¯ä½æ•°å¤šä¸€ç‚¹è€Œå·²ï¼Œå¤šå†™å‡ ä¸ª1å¹¶ä¸ä¼šè®©å¤§è„‘æ­»æœºã€‚ä½†ï¼Œè®¡ç®—æœºæ˜¯æŠŠæ•°å€¼ä¿å­˜åœ¨äº†å˜é‡ä¸­ï¼Œä¸åŒç±»å‹çš„æ•°å€¼å˜é‡èƒ½ä¿å­˜çš„æ•°å€¼èŒƒå›´ä¸åŒï¼Œå½“æ•°å€¼è¶…è¿‡ç±»å‹èƒ½è¡¨è¾¾çš„æ•°å€¼ä¸Šé™åˆ™ä¼šå‘ç”Ÿæº¢å‡ºé—®é¢˜ã€‚</li>\n</ul><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å…·ä½“çœ‹çœ‹è¿™äº›é—®é¢˜å§ã€‚</p><h2>â€œå±é™©â€çš„Double</h2><p>æˆ‘ä»¬å…ˆä»ç®€å•çš„åç›´è§‰çš„å››åˆ™è¿ç®—çœ‹èµ·ã€‚å¯¹å‡ ä¸ªç®€å•çš„æµ®ç‚¹æ•°è¿›è¡ŒåŠ å‡ä¹˜é™¤è¿ç®—ï¼š</p><!-- [[[read_end]]] --><pre><code>System.out.println(0.1+0.2);\nSystem.out.println(1.0-0.8);\nSystem.out.println(4.015*100);\nSystem.out.println(123.3/100);\n\ndouble amount1 = 2.15;\ndouble amount2 = 1.10;\nif (amount1 - amount2 == 1.05)\n    System.out.println(&quot;OK&quot;);\n</code></pre><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><pre><code>0.30000000000000004\n0.19999999999999996\n401.49999999999994\n1.2329999999999999\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè¾“å‡ºç»“æœå’Œæˆ‘ä»¬é¢„æœŸçš„å¾ˆä¸ä¸€æ ·ã€‚æ¯”å¦‚ï¼Œ0.1+0.2è¾“å‡ºçš„ä¸æ˜¯0.3è€Œæ˜¯0.30000000000000004ï¼›å†æ¯”å¦‚ï¼Œå¯¹2.15-1.10å’Œ1.05åˆ¤ç­‰ï¼Œç»“æœåˆ¤ç­‰ä¸æˆç«‹ã€‚</p><p>å‡ºç°è¿™ç§é—®é¢˜çš„ä¸»è¦åŸå› æ˜¯ï¼Œè®¡ç®—æœºæ˜¯ä»¥äºŒè¿›åˆ¶å­˜å‚¨æ•°å€¼çš„ï¼Œæµ®ç‚¹æ•°ä¹Ÿä¸ä¾‹å¤–ã€‚Javaé‡‡ç”¨äº†<a href=\"https://en.wikipedia.org/wiki/IEEE_754\">IEEE 754æ ‡å‡†</a>å®ç°æµ®ç‚¹æ•°çš„è¡¨è¾¾å’Œè¿ç®—ï¼Œä½ å¯ä»¥é€šè¿‡<a href=\"http://www.binaryconvert.com/\">è¿™é‡Œ</a>æŸ¥çœ‹æ•°å€¼è½¬åŒ–ä¸ºäºŒè¿›åˆ¶çš„ç»“æœã€‚</p><p>æ¯”å¦‚ï¼Œ0.1çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸º0.0 0011 0011 0011â€¦ ï¼ˆ0011 æ— é™å¾ªç¯)ï¼Œå†è½¬æ¢ä¸ºåè¿›åˆ¶å°±æ˜¯0.1000000000000000055511151231257827021181583404541015625ã€‚<strong>å¯¹äºè®¡ç®—æœºè€Œè¨€ï¼Œ0.1æ— æ³•ç²¾ç¡®è¡¨è¾¾ï¼Œè¿™æ˜¯æµ®ç‚¹æ•°è®¡ç®—é€ æˆç²¾åº¦æŸå¤±çš„æ ¹æºã€‚</strong></p><p>ä½ å¯èƒ½ä¼šè¯´ï¼Œä»¥0.1ä¸ºä¾‹ï¼Œå…¶åè¿›åˆ¶å’ŒäºŒè¿›åˆ¶é—´è½¬æ¢åç›¸å·®éå¸¸å°ï¼Œä¸ä¼šå¯¹è®¡ç®—äº§ç”Ÿä»€ä¹ˆå½±å“ã€‚ä½†ï¼Œæ‰€è°“ç§¯åœŸæˆå±±ï¼Œå¦‚æœå¤§é‡ä½¿ç”¨doubleæ¥ä½œå¤§é‡çš„é‡‘é’±è®¡ç®—ï¼Œæœ€ç»ˆæŸå¤±çš„ç²¾åº¦å°±æ˜¯å¤§é‡çš„èµ„é‡‘å‡ºå…¥ã€‚æ¯”å¦‚ï¼Œæ¯å¤©æœ‰ä¸€ç™¾ä¸‡æ¬¡äº¤æ˜“ï¼Œæ¯æ¬¡äº¤æ˜“éƒ½å·®ä¸€åˆ†é’±ï¼Œä¸€ä¸ªæœˆä¸‹æ¥å°±å·®30ä¸‡ã€‚è¿™å°±ä¸æ˜¯å°äº‹å„¿äº†ã€‚é‚£ï¼Œå¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¤§éƒ½å¬è¯´è¿‡BigDecimalç±»å‹ï¼Œæµ®ç‚¹æ•°ç²¾ç¡®è¡¨è¾¾å’Œè¿ç®—çš„åœºæ™¯ï¼Œä¸€å®šè¦ä½¿ç”¨è¿™ä¸ªç±»å‹ã€‚ä¸è¿‡ï¼Œåœ¨ä½¿ç”¨BigDecimalæ—¶æœ‰å‡ ä¸ªå‘éœ€è¦é¿å¼€ã€‚æˆ‘ä»¬ç”¨BigDecimalæŠŠä¹‹å‰çš„å››åˆ™è¿ç®—æ”¹ä¸€ä¸‹ï¼š</p><pre><code>System.out.println(new BigDecimal(0.1).add(new BigDecimal(0.2)));\nSystem.out.println(new BigDecimal(1.0).subtract(new BigDecimal(0.8)));\nSystem.out.println(new BigDecimal(4.015).multiply(new BigDecimal(100)));\nSystem.out.println(new BigDecimal(123.3).divide(new BigDecimal(100)));\n</code></pre><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><pre><code>0.3000000000000000166533453693773481063544750213623046875\n0.1999999999999999555910790149937383830547332763671875\n401.49999999999996802557689079549163579940795898437500\n1.232999999999999971578290569595992565155029296875\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿ç®—ç»“æœè¿˜æ˜¯ä¸ç²¾ç¡®ï¼Œåªä¸è¿‡æ˜¯ç²¾åº¦é«˜äº†è€Œå·²ã€‚è¿™é‡Œç»™å‡ºæµ®ç‚¹æ•°è¿ç®—é¿å‘ç¬¬ä¸€åŸåˆ™ï¼š<strong>ä½¿ç”¨BigDecimalè¡¨ç¤ºå’Œè®¡ç®—æµ®ç‚¹æ•°ï¼Œä¸”åŠ¡å¿…ä½¿ç”¨å­—ç¬¦ä¸²çš„æ„é€ æ–¹æ³•æ¥åˆå§‹åŒ–BigDecimal</strong>ï¼š</p><pre><code>System.out.println(new BigDecimal(&quot;0.1&quot;).add(new BigDecimal(&quot;0.2&quot;)));\nSystem.out.println(new BigDecimal(&quot;1.0&quot;).subtract(new BigDecimal(&quot;0.8&quot;)));\nSystem.out.println(new BigDecimal(&quot;4.015&quot;).multiply(new BigDecimal(&quot;100&quot;)));\nSystem.out.println(new BigDecimal(&quot;123.3&quot;).divide(new BigDecimal(&quot;100&quot;)));\n</code></pre><p>æ”¹è¿›åï¼Œå°±èƒ½å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„è¾“å‡ºäº†ï¼š</p><pre><code>0.3\n0.2\n401.500\n1.233\n</code></pre><p>åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½ä¼šç»§ç»­é—®ï¼Œä¸èƒ½è°ƒç”¨BigDecimalä¼ å…¥Doubleçš„æ„é€ æ–¹æ³•ï¼Œä½†æ‰‹å¤´åªæœ‰ä¸€ä¸ªDoubleï¼Œå¦‚ä½•è½¬æ¢ä¸ºç²¾ç¡®è¡¨è¾¾çš„BigDecimalå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬è¯•è¯•ç”¨Double.toStringæŠŠdoubleè½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œçœ‹çœ‹è¡Œä¸è¡Œï¼Ÿ</p><pre><code>System.out.println(new BigDecimal(&quot;4.015&quot;).multiply(new BigDecimal(Double.toString(100))));\n</code></pre><p>è¾“å‡ºä¸º401.5000ã€‚ä¸ä¸Šé¢å­—ç¬¦ä¸²åˆå§‹åŒ–100å’Œ4.015ç›¸ä¹˜å¾—åˆ°çš„ç»“æœ401.500ç›¸æ¯”ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆå¤šäº†1ä¸ª0å‘¢ï¼ŸåŸå› å°±æ˜¯ï¼ŒBigDecimalæœ‰scaleå’Œprecisionçš„æ¦‚å¿µï¼Œscaleè¡¨ç¤ºå°æ•°ç‚¹å³è¾¹çš„ä½æ•°ï¼Œè€Œprecisionè¡¨ç¤ºç²¾åº¦ï¼Œä¹Ÿå°±æ˜¯æœ‰æ•ˆæ•°å­—çš„é•¿åº¦ã€‚</p><p>è°ƒè¯•ä¸€ä¸‹å¯ä»¥å‘ç°ï¼Œnew BigDecimal(Double.toString(100))å¾—åˆ°çš„BigDecimalçš„scale=1ã€precision=4ï¼›è€Œnew BigDecimal(â€œ100â€)å¾—åˆ°çš„BigDecimalçš„scale=0ã€precision=3ã€‚å¯¹äºBigDecimalä¹˜æ³•æ“ä½œï¼Œè¿”å›å€¼çš„scaleæ˜¯ä¸¤ä¸ªæ•°çš„scaleç›¸åŠ ã€‚æ‰€ä»¥ï¼Œåˆå§‹åŒ–100çš„ä¸¤ç§ä¸åŒæ–¹å¼ï¼Œå¯¼è‡´æœ€åç»“æœçš„scaleåˆ†åˆ«æ˜¯4å’Œ3ï¼š</p><pre><code>private static void testScale() {\n    BigDecimal bigDecimal1 = new BigDecimal(&quot;100&quot;);\n    BigDecimal bigDecimal2 = new BigDecimal(String.valueOf(100d));\n    BigDecimal bigDecimal3 = new BigDecimal(String.valueOf(100));\n    BigDecimal bigDecimal4 = BigDecimal.valueOf(100d);\n    BigDecimal bigDecimal5 = new BigDecimal(Double.toString(100));\n\n    print(bigDecimal1); //scale 0 precision 3 result 401.500\n    print(bigDecimal2); //scale 1 precision 4 result 401.5000\n    print(bigDecimal3); //scale 0 precision 3 result 401.500\n    print(bigDecimal4); //scale 1 precision 4 result 401.5000\n    print(bigDecimal5); //scale 1 precision 4 result 401.5000\n}\n\nprivate static void print(BigDecimal bigDecimal) {\n    log.info(&quot;scale {} precision {} result {}&quot;, bigDecimal.scale(), bigDecimal.precision(), bigDecimal.multiply(new BigDecimal(&quot;4.015&quot;)));\n}\n</code></pre><p>BigDecimalçš„toStringæ–¹æ³•å¾—åˆ°çš„å­—ç¬¦ä¸²å’Œscaleç›¸å…³ï¼Œåˆä¼šå¼•å‡ºäº†å¦ä¸€ä¸ªé—®é¢˜ï¼šå¯¹äºæµ®ç‚¹æ•°çš„å­—ç¬¦ä¸²å½¢å¼è¾“å‡ºå’Œæ ¼å¼åŒ–ï¼Œæˆ‘ä»¬åº”è¯¥è€ƒè™‘æ˜¾å¼è¿›è¡Œï¼Œé€šè¿‡æ ¼å¼åŒ–è¡¨è¾¾å¼æˆ–æ ¼å¼åŒ–å·¥å…·æ¥æ˜ç¡®å°æ•°ä½æ•°å’Œèˆå…¥æ–¹å¼ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±èŠèŠæµ®ç‚¹æ•°èˆå…¥å’Œæ ¼å¼åŒ–ã€‚</p><h2>è€ƒè™‘æµ®ç‚¹æ•°èˆå…¥å’Œæ ¼å¼åŒ–çš„æ–¹å¼</h2><p>é™¤äº†ä½¿ç”¨Doubleä¿å­˜æµ®ç‚¹æ•°å¯èƒ½å¸¦æ¥ç²¾åº¦é—®é¢˜å¤–ï¼Œæ›´åŒªå¤·æ‰€æ€çš„æ˜¯è¿™ç§ç²¾åº¦é—®é¢˜ï¼ŒåŠ ä¸ŠString.formatçš„æ ¼å¼åŒ–èˆå…¥æ–¹å¼ï¼Œå¯èƒ½å¾—åˆ°è®©äººæ‘¸ä¸ç€å¤´è„‘çš„ç»“æœã€‚</p><p>æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­å§ã€‚é¦–å…ˆç”¨doubleå’Œfloatåˆå§‹åŒ–ä¸¤ä¸ª3.35çš„æµ®ç‚¹æ•°ï¼Œç„¶åé€šè¿‡String.formatä½¿ç”¨%.1fæ¥æ ¼å¼åŒ–è¿™2ä¸ªæ•°å­—ï¼š</p><pre><code>double num1 = 3.35;\nfloat num2 = 3.35f;\nSystem.out.println(String.format(&quot;%.1f&quot;, num1));//å››èˆäº”å…¥\nSystem.out.println(String.format(&quot;%.1f&quot;, num2));\n</code></pre><p>å¾—åˆ°çš„ç»“æœå±…ç„¶æ˜¯3.4å’Œ3.3ã€‚</p><p>è¿™å°±æ˜¯ç”±ç²¾åº¦é—®é¢˜å’Œèˆå…¥æ–¹å¼å…±åŒå¯¼è‡´çš„ï¼Œdoubleå’Œfloatçš„3.35å…¶å®ç›¸å½“äº3.350xxxå’Œ3.349xxxï¼š</p><pre><code>3.350000000000000088817841970012523233890533447265625\n3.349999904632568359375\n</code></pre><p>String.formaté‡‡ç”¨å››èˆäº”å…¥çš„æ–¹å¼è¿›è¡Œèˆå…¥ï¼Œå–1ä½å°æ•°ï¼Œdoubleçš„3.350å››èˆäº”å…¥ä¸º3.4ï¼Œè€Œfloatçš„3.349å››èˆäº”å…¥ä¸º3.3ã€‚</p><p><strong>æˆ‘ä»¬çœ‹ä¸€ä¸‹Formatterç±»çš„ç›¸å…³æºç ï¼Œå¯ä»¥å‘ç°ä½¿ç”¨çš„èˆå…¥æ¨¡å¼æ˜¯HALF_UP</strong>ï¼ˆä»£ç ç¬¬11è¡Œï¼‰ï¼š</p><pre><code>else if (c == Conversion.DECIMAL_FLOAT) {\n    // Create a new BigDecimal with the desired precision.\n    int prec = (precision == -1 ? 6 : precision);\n    int scale = value.scale();\n\n    if (scale &gt; prec) {\n        // more &quot;scale&quot; digits than the requested &quot;precision&quot;\n        int compPrec = value.precision();\n        if (compPrec &lt;= scale) {\n            // case of 0.xxxxxx\n            value = value.setScale(prec, RoundingMode.HALF_UP);\n        } else {\n            compPrec -= (scale - prec);\n            value = new BigDecimal(value.unscaledValue(),\n                                   scale,\n                                   new MathContext(compPrec));\n        }\n    }\n</code></pre><p>å¦‚æœæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨å…¶ä»–èˆå…¥æ–¹å¼æ¥æ ¼å¼åŒ–å­—ç¬¦ä¸²çš„è¯ï¼Œå¯ä»¥è®¾ç½®DecimalFormatï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p><pre><code>double num1 = 3.35;\nfloat num2 = 3.35f;\nDecimalFormat format = new DecimalFormat(&quot;#.##&quot;);\nformat.setRoundingMode(RoundingMode.DOWN);\nSystem.out.println(format.format(num1));\nformat.setRoundingMode(RoundingMode.DOWN);\nSystem.out.println(format.format(num2));\n</code></pre><p>å½“æˆ‘ä»¬æŠŠè¿™2ä¸ªæµ®ç‚¹æ•°å‘ä¸‹èˆå…¥å–2ä½å°æ•°æ—¶ï¼Œè¾“å‡ºåˆ†åˆ«æ˜¯3.35å’Œ3.34ï¼Œè¿˜æ˜¯æˆ‘ä»¬ä¹‹å‰è¯´çš„æµ®ç‚¹æ•°æ— æ³•ç²¾ç¡®å­˜å‚¨çš„é—®é¢˜ã€‚</p><p>å› æ­¤ï¼Œå³ä½¿é€šè¿‡DecimalFormatæ¥ç²¾ç¡®æ§åˆ¶èˆå…¥æ–¹å¼ï¼Œdoubleå’Œfloatçš„é—®é¢˜ä¹Ÿå¯èƒ½äº§ç”Ÿæ„æƒ³ä¸åˆ°çš„ç»“æœï¼Œæ‰€ä»¥æµ®ç‚¹æ•°é¿å‘ç¬¬äºŒåŸåˆ™ï¼š<strong>æµ®ç‚¹æ•°çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–ä¹Ÿè¦é€šè¿‡BigDecimalè¿›è¡Œã€‚</strong></p><p>æ¯”å¦‚ä¸‹é¢è¿™æ®µä»£ç ï¼Œä½¿ç”¨BigDecimalæ¥æ ¼å¼åŒ–æ•°å­—3.35ï¼Œåˆ†åˆ«ä½¿ç”¨å‘ä¸‹èˆå…¥å’Œå››èˆäº”å…¥æ–¹å¼å–1ä½å°æ•°è¿›è¡Œæ ¼å¼åŒ–ï¼š</p><pre><code>BigDecimal num1 = new BigDecimal(&quot;3.35&quot;);\nBigDecimal num2 = num1.setScale(1, BigDecimal.ROUND_DOWN);\nSystem.out.println(num2);\nBigDecimal num3 = num1.setScale(1, BigDecimal.ROUND_HALF_UP);\nSystem.out.println(num3);\n</code></pre><p>è¿™æ¬¡å¾—åˆ°çš„ç»“æœæ˜¯3.3å’Œ3.4ï¼Œç¬¦åˆé¢„æœŸã€‚</p><h2>ç”¨equalsåšåˆ¤ç­‰ï¼Œå°±ä¸€å®šæ˜¯å¯¹çš„å—ï¼Ÿ</h2><p>ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†ï¼Œåº”è¯¥ä½¿ç”¨BigDecimalæ¥è¿›è¡Œæµ®ç‚¹æ•°çš„è¡¨ç¤ºã€è®¡ç®—ã€æ ¼å¼åŒ–ã€‚åœ¨ä¸Šä¸€è®²ä»‹ç»<a href=\"https://time.geekbang.org/column/article/213604\">åˆ¤ç­‰é—®é¢˜</a>æ—¶ï¼Œæˆ‘æåˆ°ä¸€ä¸ªåŸåˆ™ï¼šåŒ…è£…ç±»çš„æ¯”è¾ƒè¦é€šè¿‡equalsè¿›è¡Œï¼Œè€Œä¸èƒ½ä½¿ç”¨==ã€‚é‚£ä¹ˆï¼Œä½¿ç”¨equalsæ–¹æ³•å¯¹ä¸¤ä¸ªBigDecimalåˆ¤ç­‰ï¼Œä¸€å®šèƒ½å¾—åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»“æœå—ï¼Ÿ</p><p>æˆ‘ä»¬æ¥çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚ä½¿ç”¨equalsæ–¹æ³•æ¯”è¾ƒ1.0å’Œ1è¿™ä¸¤ä¸ªBigDecimalï¼š</p><pre><code>System.out.println(new BigDecimal(&quot;1.0&quot;).equals(new BigDecimal(&quot;1&quot;)))\n</code></pre><p>ä½ å¯èƒ½å·²ç»çŒœåˆ°æˆ‘è¦è¯´ä»€ä¹ˆäº†ï¼Œç»“æœå½“ç„¶æ˜¯falseã€‚BigDecimalçš„equalsæ–¹æ³•çš„æ³¨é‡Šä¸­è¯´æ˜äº†åŸå› ï¼Œequalsæ¯”è¾ƒçš„æ˜¯BigDecimalçš„valueå’Œscaleï¼Œ1.0çš„scaleæ˜¯1ï¼Œ1çš„scaleæ˜¯0ï¼Œæ‰€ä»¥ç»“æœä¸€å®šæ˜¯falseï¼š</p><pre><code>/**\n * Compares this {@code BigDecimal} with the specified\n * {@code Object} for equality.  Unlike {@link\n * #compareTo(BigDecimal) compareTo}, this method considers two\n * {@code BigDecimal} objects equal only if they are equal in\n * value and scale (thus 2.0 is not equal to 2.00 when compared by\n * this method).\n *\n * @param  x {@code Object} to which this {@code BigDecimal} is\n *         to be compared.\n * @return {@code true} if and only if the specified {@code Object} is a\n *         {@code BigDecimal} whose value and scale are equal to this\n *         {@code BigDecimal}'s.\n * @see    #compareTo(java.math.BigDecimal)\n * @see    #hashCode\n */\n@Override\npublic boolean equals(Object x)\n</code></pre><p><strong>å¦‚æœæˆ‘ä»¬å¸Œæœ›åªæ¯”è¾ƒBigDecimalçš„valueï¼Œå¯ä»¥ä½¿ç”¨compareToæ–¹æ³•</strong>ï¼Œä¿®æ”¹åä»£ç å¦‚ä¸‹ï¼š</p><pre><code>System.out.println(new BigDecimal(&quot;1.0&quot;).compareTo(new BigDecimal(&quot;1&quot;))==0);\n</code></pre><p>å­¦è¿‡ä¸Šä¸€è®²ï¼Œä½ å¯èƒ½ä¼šæ„è¯†åˆ°BigDecimalçš„equalså’ŒhashCodeæ–¹æ³•ä¼šåŒæ—¶è€ƒè™‘valueå’Œscaleï¼Œå¦‚æœç»“åˆHashSetæˆ–HashMapä½¿ç”¨çš„è¯å°±å¯èƒ½ä¼šå‡ºç°éº»çƒ¦ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬æŠŠå€¼ä¸º1.0çš„BigDecimalåŠ å…¥HashSetï¼Œç„¶ååˆ¤æ–­å…¶æ˜¯å¦å­˜åœ¨å€¼ä¸º1çš„BigDecimalï¼Œå¾—åˆ°çš„ç»“æœæ˜¯falseï¼š</p><pre><code>Set&lt;BigDecimal&gt; hashSet1 = new HashSet&lt;&gt;();\nhashSet1.add(new BigDecimal(&quot;1.0&quot;));\nSystem.out.println(hashSet1.contains(new BigDecimal(&quot;1&quot;)));//è¿”å›false\n</code></pre><p>è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•æœ‰ä¸¤ä¸ªï¼š</p><ul>\n<li>ç¬¬ä¸€ä¸ªæ–¹æ³•æ˜¯ï¼Œä½¿ç”¨TreeSetæ›¿æ¢HashSetã€‚TreeSetä¸ä½¿ç”¨hashCodeæ–¹æ³•ï¼Œä¹Ÿä¸ä½¿ç”¨equalsæ¯”è¾ƒå…ƒç´ ï¼Œè€Œæ˜¯ä½¿ç”¨compareToæ–¹æ³•ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰é—®é¢˜ã€‚</li>\n</ul><pre><code>Set&lt;BigDecimal&gt; treeSet = new TreeSet&lt;&gt;();\ntreeSet.add(new BigDecimal(&quot;1.0&quot;));\nSystem.out.println(treeSet.contains(new BigDecimal(&quot;1&quot;)));//è¿”å›true\n</code></pre><ul>\n<li>ç¬¬äºŒä¸ªæ–¹æ³•æ˜¯ï¼ŒæŠŠBigDecimalå­˜å…¥HashSetæˆ–HashMapå‰ï¼Œå…ˆä½¿ç”¨stripTrailingZerosæ–¹æ³•å»æ‰å°¾éƒ¨çš„é›¶ï¼Œæ¯”è¾ƒçš„æ—¶å€™ä¹Ÿå»æ‰å°¾éƒ¨çš„0ï¼Œç¡®ä¿valueç›¸åŒçš„BigDecimalï¼Œscaleä¹Ÿæ˜¯ä¸€è‡´çš„ï¼š</li>\n</ul><pre><code>Set&lt;BigDecimal&gt; hashSet2 = new HashSet&lt;&gt;();\nhashSet2.add(new BigDecimal(&quot;1.0&quot;).stripTrailingZeros());\nSystem.out.println(hashSet2.contains(new BigDecimal(&quot;1.000&quot;).stripTrailingZeros()));//è¿”å›true\n</code></pre><h2>å°å¿ƒæ•°å€¼æº¢å‡ºé—®é¢˜</h2><p>æ•°å€¼è®¡ç®—è¿˜æœ‰ä¸€ä¸ªè¦å°å¿ƒçš„ç‚¹æ˜¯æº¢å‡ºï¼Œä¸ç®¡æ˜¯intè¿˜æ˜¯longï¼Œæ‰€æœ‰çš„åŸºæœ¬æ•°å€¼ç±»å‹éƒ½æœ‰è¶…å‡ºè¡¨è¾¾èŒƒå›´çš„å¯èƒ½æ€§ã€‚</p><p>æ¯”å¦‚ï¼Œå¯¹Longçš„æœ€å¤§å€¼è¿›è¡Œ+1æ“ä½œï¼š</p><pre><code>long l = Long.MAX_VALUE;\nSystem.out.println(l + 1);\nSystem.out.println(l + 1 == Long.MIN_VALUE);\n</code></pre><p>è¾“å‡ºç»“æœæ˜¯ä¸€ä¸ªè´Ÿæ•°ï¼Œå› ä¸ºLongçš„æœ€å¤§å€¼+1å˜ä¸ºäº†Longçš„æœ€å°å€¼ï¼š</p><pre><code>-9223372036854775808\ntrue\n</code></pre><p><strong>æ˜¾ç„¶è¿™æ˜¯å‘ç”Ÿäº†æº¢å‡ºï¼Œè€Œä¸”æ˜¯é»˜é»˜åœ°æº¢å‡ºï¼Œå¹¶æ²¡æœ‰ä»»ä½•å¼‚å¸¸</strong>ã€‚è¿™ç±»é—®é¢˜éå¸¸å®¹æ˜“è¢«å¿½ç•¥ï¼Œæ”¹è¿›æ–¹å¼æœ‰ä¸‹é¢2ç§ã€‚</p><p>æ–¹æ³•ä¸€æ˜¯ï¼Œè€ƒè™‘ä½¿ç”¨Mathç±»çš„addExactã€subtractExactç­‰xxExactæ–¹æ³•è¿›è¡Œæ•°å€¼è¿ç®—ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥åœ¨æ•°å€¼æº¢å‡ºæ—¶ä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸ã€‚æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œä½¿ç”¨Math.addExactå¯¹Longæœ€å¤§å€¼åš+1æ“ä½œï¼š</p><pre><code>try {\n    long l = Long.MAX_VALUE;\n    System.out.println(Math.addExact(l, 1));\n} catch (Exception ex) {\n    ex.printStackTrace();\n}\n</code></pre><p>æ‰§è¡Œåï¼Œå¯ä»¥å¾—åˆ°ArithmeticExceptionï¼Œè¿™æ˜¯ä¸€ä¸ªRuntimeExceptionï¼š</p><pre><code>java.lang.ArithmeticException: long overflow\n\tat java.lang.Math.addExact(Math.java:809)\n\tat org.geekbang.time.commonmistakes.numeralcalculations.demo3.CommonMistakesApplication.right2(CommonMistakesApplication.java:25)\n\tat org.geekbang.time.commonmistakes.numeralcalculations.demo3.CommonMistakesApplication.main(CommonMistakesApplication.java:13)\n</code></pre><p>æ–¹æ³•äºŒæ˜¯ï¼Œä½¿ç”¨å¤§æ•°ç±»BigIntegerã€‚BigDecimalæ˜¯å¤„ç†æµ®ç‚¹æ•°çš„ä¸“å®¶ï¼Œè€ŒBigIntegeråˆ™æ˜¯å¯¹å¤§æ•°è¿›è¡Œç§‘å­¦è®¡ç®—çš„ä¸“å®¶ã€‚</p><p>å¦‚ä¸‹ä»£ç ï¼Œä½¿ç”¨BigIntegerå¯¹Longæœ€å¤§å€¼è¿›è¡Œ+1æ“ä½œï¼›å¦‚æœå¸Œæœ›æŠŠè®¡ç®—ç»“æœè½¬æ¢ä¸€ä¸ªLongå˜é‡çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨BigIntegerçš„longValueExactæ–¹æ³•ï¼Œåœ¨è½¬æ¢å‡ºç°æº¢å‡ºæ—¶ï¼ŒåŒæ ·ä¼šæŠ›å‡ºArithmeticExceptionï¼š</p><pre><code>BigInteger i = new BigInteger(String.valueOf(Long.MAX_VALUE));\nSystem.out.println(i.add(BigInteger.ONE).toString());\n\ntry {\n    long l = i.add(BigInteger.ONE).longValueExact();\n} catch (Exception ex) {\n    ex.printStackTrace();\n}\n</code></pre><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><pre><code>9223372036854775808\njava.lang.ArithmeticException: BigInteger out of long range\n\tat java.math.BigInteger.longValueExact(BigInteger.java:4632)\n\tat org.geekbang.time.commonmistakes.numeralcalculations.demo3.CommonMistakesApplication.right1(CommonMistakesApplication.java:37)\n\tat org.geekbang.time.commonmistakes.numeralcalculations.demo3.CommonMistakesApplication.main(CommonMistakesApplication.java:11)\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œé€šè¿‡BigIntegerå¯¹Longçš„æœ€å¤§å€¼åŠ 1ä¸€ç‚¹é—®é¢˜éƒ½æ²¡æœ‰ï¼Œå½“å°è¯•æŠŠç»“æœè½¬æ¢ä¸ºLongç±»å‹æ—¶ï¼Œåˆ™ä¼šæç¤ºBigInteger out of long rangeã€‚</p><h2>é‡ç‚¹å›é¡¾</h2><p>ä»Šå¤©ï¼Œæˆ‘ä¸ä½ åˆ†äº«äº†æµ®ç‚¹æ•°çš„è¡¨ç¤ºã€è®¡ç®—ã€èˆå…¥å’Œæ ¼å¼åŒ–ã€æº¢å‡ºç­‰æ¶‰åŠçš„ä¸€äº›å‘ã€‚</p><p>ç¬¬ä¸€ï¼Œåˆ‡è®°ï¼Œè¦ç²¾ç¡®è¡¨ç¤ºæµ®ç‚¹æ•°åº”è¯¥ä½¿ç”¨BigDecimalã€‚å¹¶ä¸”ï¼Œä½¿ç”¨BigDecimalçš„Doubleå…¥å‚çš„æ„é€ æ–¹æ³•åŒæ ·å­˜åœ¨ç²¾åº¦ä¸¢å¤±é—®é¢˜ï¼Œåº”è¯¥ä½¿ç”¨Stringå…¥å‚çš„æ„é€ æ–¹æ³•æˆ–è€…BigDecimal.valueOfæ–¹æ³•æ¥åˆå§‹åŒ–ã€‚</p><p>ç¬¬äºŒï¼Œå¯¹æµ®ç‚¹æ•°åšç²¾ç¡®è®¡ç®—ï¼Œå‚ä¸è®¡ç®—çš„å„ç§æ•°å€¼åº”è¯¥å§‹ç»ˆä½¿ç”¨BigDecimalï¼Œæ‰€æœ‰çš„è®¡ç®—éƒ½è¦é€šè¿‡BigDecimalçš„æ–¹æ³•è¿›è¡Œï¼Œåˆ‡å‹¿åªæ˜¯è®©BigDecimalæ¥èµ°è¿‡åœºã€‚ä»»ä½•ä¸€ä¸ªç¯èŠ‚å‡ºç°ç²¾åº¦æŸå¤±ï¼Œæœ€åçš„è®¡ç®—ç»“æœå¯èƒ½éƒ½ä¼šå‡ºç°è¯¯å·®ã€‚</p><p>ç¬¬ä¸‰ï¼Œå¯¹äºæµ®ç‚¹æ•°çš„æ ¼å¼åŒ–ï¼Œå¦‚æœä½¿ç”¨String.formatçš„è¯ï¼Œéœ€è¦è®¤è¯†åˆ°å®ƒä½¿ç”¨çš„æ˜¯å››èˆäº”å…¥ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨DecimalFormatæ¥æ˜ç¡®æŒ‡å®šèˆå…¥æ–¹å¼ã€‚ä½†è€ƒè™‘åˆ°ç²¾åº¦é—®é¢˜ï¼Œæˆ‘æ›´å»ºè®®ä½¿ç”¨BigDecimalæ¥è¡¨ç¤ºæµ®ç‚¹æ•°ï¼Œå¹¶ä½¿ç”¨å…¶setScaleæ–¹æ³•æŒ‡å®šèˆå…¥çš„ä½æ•°å’Œæ–¹å¼ã€‚</p><p>ç¬¬å››ï¼Œè¿›è¡Œæ•°å€¼è¿ç®—æ—¶è¦å°å¿ƒæº¢å‡ºé—®é¢˜ï¼Œè™½ç„¶æº¢å‡ºåä¸ä¼šå‡ºç°å¼‚å¸¸ï¼Œä½†å¾—åˆ°çš„è®¡ç®—ç»“æœæ˜¯å®Œå…¨é”™è¯¯çš„ã€‚æˆ‘ä»¬è€ƒè™‘ä½¿ç”¨Math.xxxExactæ–¹æ³•æ¥è¿›è¡Œè¿ç®—ï¼Œåœ¨æº¢å‡ºæ—¶èƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œæ›´å»ºè®®å¯¹äºå¯èƒ½ä¼šå‡ºç°æº¢å‡ºçš„å¤§æ•°è¿ç®—ä½¿ç”¨BigIntegerç±»ã€‚</p><p>æ€»ä¹‹ï¼Œå¯¹äºé‡‘èã€ç§‘å­¦è®¡ç®—ç­‰åœºæ™¯ï¼Œè¯·å°½å¯èƒ½ä½¿ç”¨BigDecimalå’ŒBigIntegerï¼Œé¿å…ç”±ç²¾åº¦å’Œæº¢å‡ºé—®é¢˜å¼•å‘éš¾ä»¥å‘ç°ï¼Œä½†å½±å“é‡å¤§çš„Bugã€‚</p><p>ä»Šå¤©ç”¨åˆ°çš„ä»£ç ï¼Œæˆ‘éƒ½æ”¾åœ¨äº†GitHubä¸Šï¼Œä½ å¯ä»¥ç‚¹å‡»<a href=\"https://github.com/JosephZhu1983/java-common-mistakes\">è¿™ä¸ªé“¾æ¥</a>æŸ¥çœ‹ã€‚</p><h2>æ€è€ƒä¸è®¨è®º</h2><ol>\n<li><a href=\"https://docs.oracle.com/javase/8/docs/api/java/math/BigDecimal.html\">BigDecimal</a>æä¾›äº†8ç§èˆå…¥æ¨¡å¼ï¼Œä½ èƒ½é€šè¿‡ä¸€äº›ä¾‹å­è¯´è¯´å®ƒä»¬çš„åŒºåˆ«å—ï¼Ÿ</li>\n<li>æ•°æ®åº“ï¼ˆæ¯”å¦‚MySQLï¼‰ä¸­çš„æµ®ç‚¹æ•°å’Œæ•´å‹æ•°å­—ï¼Œä½ çŸ¥é“åº”è¯¥æ€æ ·å®šä¹‰å—ï¼Ÿåˆå¦‚ä½•å®ç°æµ®ç‚¹æ•°çš„å‡†ç¡®è®¡ç®—å‘¢ï¼Ÿ</li>\n</ol><p>é’ˆå¯¹æ•°å€¼è¿ç®—ï¼Œä½ è¿˜é‡åˆ°è¿‡ä»€ä¹ˆå‘å—ï¼Ÿæˆ‘æ˜¯æœ±æ™”ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºä¸æˆ‘ç•™è¨€åˆ†äº«ä½ çš„æƒ³æ³•ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–åŒäº‹ï¼Œä¸€èµ·äº¤æµã€‚</p>","neighbors":{"left":{"article_title":"08 | åˆ¤ç­‰é—®é¢˜ï¼šç¨‹åºé‡Œå¦‚ä½•ç¡®å®šä½ å°±æ˜¯ä½ ï¼Ÿ","id":213604},"right":{"article_title":"10 | é›†åˆç±»ï¼šå‘æ»¡åœ°çš„Liståˆ—è¡¨æ“ä½œ","id":216778}},"comments":[{"had_liked":false,"id":197093,"user_name":"Darren","can_delete":false,"product_type":"c1","uid":1254968,"ip_address":"","ucode":"CCD2B2C492BE9A","user_header":"https://static001.geekbang.org/account/avatar/00/13/26/38/ef063dc2.jpg","comment_is_top":false,"comment_ctime":1585357746,"is_pvip":true,"replies":[{"id":"74525","content":"ğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","comment_id":197093,"uid":"1001470","ip_address":"","utype":1,"ctime":1585362960,"user_name_real":"æœ±æ™”"}],"discussion_count":9,"race_medal":0,"score":"259283395506","product_id":100047701,"comment_content":"ç²¾åº¦é—®é¢˜é‡åˆ°çš„æ¯”è¾ƒå°‘ï¼Œå¯èƒ½ä¸ä»äº‹éé‡‘èè¡Œä¸šæœ‰å…³ç³»ï¼Œè¯•ç€å›ç­”ä¸‹é—®é¢˜<br>ç¬¬ä¸€ç§é—®é¢˜<br>1ã€ ROUND_UPÂ <br>èˆå…¥è¿œç¦»é›¶çš„èˆå…¥æ¨¡å¼ã€‚Â <br>åœ¨ä¸¢å¼ƒéé›¶éƒ¨åˆ†ä¹‹å‰å§‹ç»ˆå¢åŠ æ•°å­—ï¼ˆå§‹ç»ˆå¯¹éé›¶èˆå¼ƒéƒ¨åˆ†å‰é¢çš„æ•°å­—åŠ 1ï¼‰ã€‚Â <br>æ³¨æ„ï¼Œæ­¤èˆå…¥æ¨¡å¼å§‹ç»ˆä¸ä¼šå‡å°‘è®¡ç®—å€¼çš„å¤§å°ã€‚<br>2ã€ROUND_DOWNÂ <br>æ¥è¿‘é›¶çš„èˆå…¥æ¨¡å¼ã€‚Â <br>åœ¨ä¸¢å¼ƒæŸéƒ¨åˆ†ä¹‹å‰å§‹ç»ˆä¸å¢åŠ æ•°å­—ï¼ˆä»ä¸å¯¹èˆå¼ƒéƒ¨åˆ†å‰é¢çš„æ•°å­—åŠ 1ï¼Œå³æˆªçŸ­ï¼‰ã€‚Â <br>æ³¨æ„ï¼Œæ­¤èˆå…¥æ¨¡å¼å§‹ç»ˆä¸ä¼šå¢åŠ è®¡ç®—å€¼çš„å¤§å°ã€‚<br>3ã€ROUND_CEILINGÂ <br>æ¥è¿‘æ­£æ— ç©·å¤§çš„èˆå…¥æ¨¡å¼ã€‚Â <br>å¦‚æœ BigDecimal ä¸ºæ­£ï¼Œåˆ™èˆå…¥è¡Œä¸ºä¸ ROUND_UP ç›¸åŒï¼›Â <br>å¦‚æœä¸ºè´Ÿï¼Œåˆ™èˆå…¥è¡Œä¸ºä¸ ROUND_DOWN ç›¸åŒã€‚Â <br>æ³¨æ„ï¼Œæ­¤èˆå…¥æ¨¡å¼å§‹ç»ˆä¸ä¼šå‡å°‘è®¡ç®—å€¼ã€‚<br>4ã€ROUND_FLOORÂ <br>æ¥è¿‘è´Ÿæ— ç©·å¤§çš„èˆå…¥æ¨¡å¼ã€‚Â <br>å¦‚æœ BigDecimal ä¸ºæ­£ï¼Œåˆ™èˆå…¥è¡Œä¸ºä¸ ROUND_DOWN ç›¸åŒï¼›Â <br>å¦‚æœä¸ºè´Ÿï¼Œåˆ™èˆå…¥è¡Œä¸ºä¸ ROUND_UP ç›¸åŒã€‚Â <br>æ³¨æ„ï¼Œæ­¤èˆå…¥æ¨¡å¼å§‹ç»ˆä¸ä¼šå¢åŠ è®¡ç®—å€¼ã€‚<br>5ã€ROUND_HALF_UPÂ <br>å‘â€œæœ€æ¥è¿‘çš„â€æ•°å­—èˆå…¥ï¼Œå¦‚æœä¸ä¸¤ä¸ªç›¸é‚»æ•°å­—çš„è·ç¦»ç›¸ç­‰ï¼Œåˆ™ä¸ºå‘ä¸Šèˆå…¥çš„èˆå…¥æ¨¡å¼ã€‚Â <br>å¦‚æœèˆå¼ƒéƒ¨åˆ† &gt;= 0.5ï¼Œåˆ™èˆå…¥è¡Œä¸ºä¸ ROUND_UP ç›¸åŒï¼›å¦åˆ™èˆå…¥è¡Œä¸ºä¸ ROUND_DOWN ç›¸åŒã€‚Â <br>æ³¨æ„ï¼Œè¿™æ˜¯æˆ‘ä»¬å¤§å¤šæ•°äººåœ¨å°å­¦æ—¶å°±å­¦è¿‡çš„èˆå…¥æ¨¡å¼ï¼ˆå››èˆäº”å…¥ï¼‰ã€‚<br>6ã€ROUND_HALF_DOWNÂ <br>å‘â€œæœ€æ¥è¿‘çš„â€æ•°å­—èˆå…¥ï¼Œå¦‚æœä¸ä¸¤ä¸ªç›¸é‚»æ•°å­—çš„è·ç¦»ç›¸ç­‰ï¼Œåˆ™ä¸ºä¸Šèˆå…¥çš„èˆå…¥æ¨¡å¼ã€‚Â <br>å¦‚æœèˆå¼ƒéƒ¨åˆ† &gt; 0.5ï¼Œåˆ™èˆå…¥è¡Œä¸ºä¸ ROUND_UP ç›¸åŒï¼›å¦åˆ™èˆå…¥è¡Œä¸ºä¸ ROUND_DOWN ç›¸åŒï¼ˆäº”èˆå…­å…¥ï¼‰ã€‚<br>7ã€ROUND_HALF_EVENÂ <br>å‘â€œæœ€æ¥è¿‘çš„â€æ•°å­—èˆå…¥ï¼Œå¦‚æœä¸ä¸¤ä¸ªç›¸é‚»æ•°å­—çš„è·ç¦»ç›¸ç­‰ï¼Œåˆ™å‘ç›¸é‚»çš„å¶æ•°èˆå…¥ã€‚Â <br>å¦‚æœèˆå¼ƒéƒ¨åˆ†å·¦è¾¹çš„æ•°å­—ä¸ºå¥‡æ•°ï¼Œåˆ™èˆå…¥è¡Œä¸ºä¸ ROUND_HALF_UP ç›¸åŒï¼›Â <br>å¦‚æœä¸ºå¶æ•°ï¼Œåˆ™èˆå…¥è¡Œä¸ºä¸ ROUND_HALF_DOWN ç›¸åŒã€‚Â <br>æ³¨æ„ï¼Œåœ¨é‡å¤è¿›è¡Œä¸€ç³»åˆ—è®¡ç®—æ—¶ï¼Œæ­¤èˆå…¥æ¨¡å¼å¯ä»¥å°†ç´¯åŠ é”™è¯¯å‡åˆ°æœ€å°ã€‚Â <br>æ­¤èˆå…¥æ¨¡å¼ä¹Ÿç§°ä¸ºâ€œé“¶è¡Œå®¶èˆå…¥æ³•â€ï¼Œä¸»è¦åœ¨ç¾å›½ä½¿ç”¨ã€‚å››èˆå…­å…¥ï¼Œäº”åˆ†ä¸¤ç§æƒ…å†µã€‚Â <br>å¦‚æœå‰ä¸€ä½ä¸ºå¥‡æ•°ï¼Œåˆ™å…¥ä½ï¼Œå¦åˆ™èˆå»ã€‚Â <br>ä»¥ä¸‹ä¾‹å­ä¸ºä¿ç•™å°æ•°ç‚¹1ä½ï¼Œé‚£ä¹ˆè¿™ç§èˆå…¥æ–¹å¼ä¸‹çš„ç»“æœã€‚Â Â <br>1.15&gt;1.2 1.25&gt;1.2<br>8ã€ROUND_UNNECESSARYÂ <br>æ–­è¨€è¯·æ±‚çš„æ“ä½œå…·æœ‰ç²¾ç¡®çš„ç»“æœï¼Œå› æ­¤ä¸éœ€è¦èˆå…¥ã€‚Â <br>å¦‚æœå¯¹è·å¾—ç²¾ç¡®ç»“æœçš„æ“ä½œæŒ‡å®šæ­¤èˆå…¥æ¨¡å¼ï¼Œåˆ™æŠ›å‡ºArithmeticExceptionã€‚<br><br>ç¬¬äºŒä¸ªé—®é¢˜<br>åœ¨MySQLä¸­ï¼Œæ•´æ•°å’Œæµ®ç‚¹æ•°çš„å®šä¹‰éƒ½æ˜¯æœ‰å¤šç§ç±»å‹ï¼Œæ•´æ•°æ ¹æ®å®é™…èŒƒå›´å®šä¹‰ï¼Œæµ®ç‚¹æ•°è¯­è¨€æŒ‡å®šæ•´ä½“é•¿åº¦å’Œå°æ•°é•¿åº¦ã€‚æµ®ç‚¹æ•°ç±»å‹åŒ…æ‹¬å•ç²¾åº¦æµ®ç‚¹æ•°ï¼ˆfloatå‹ï¼‰å’ŒåŒç²¾åº¦æµ®ç‚¹æ•°ï¼ˆdoubleå‹ï¼‰ã€‚å®šç‚¹æ•°ç±»å‹å°±æ˜¯decimalå‹ã€‚å®šç‚¹æ•°ä»¥å­—ç¬¦ä¸²å½¢å¼å­˜å‚¨ï¼Œå› æ­¤ï¼Œå…¶ç²¾åº¦æ¯”æµ®ç‚¹æ•°è¦é«˜ï¼Œè€Œä¸”æµ®ç‚¹æ•°ä¼šå‡ºç°è¯¯å·®ï¼Œè¿™æ˜¯æµ®ç‚¹æ•°ä¸€ç›´å­˜åœ¨çš„ç¼ºé™·ã€‚å¦‚æœè¦å¯¹æ•°æ®çš„ç²¾åº¦è¦æ±‚æ¯”è¾ƒé«˜ï¼Œè¿˜æ˜¯é€‰æ‹©å®šç‚¹æ•°decimalæ¯”è¾ƒå®‰å…¨ã€‚","like_count":61,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489447,"discussion_content":"ğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585362960,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1000473,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/44/19/17fadc62.jpg","nickname":"éƒ­è•¾","note":"","ucode":"34F4C07D1C5FE8","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":228922,"discussion_content":"å“‡å¡ï¼Œè¯¾ä»£è¡¨å‰å®³","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586590665,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1484192,"avatar":"https://static001.geekbang.org/account/avatar/00/16/a5/a0/e0cccf7e.jpg","nickname":"åœ†åœ†æ»¡æ»¡","note":"","ucode":"396E7A822014D1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576432,"discussion_content":"æµ®ç‚¹æ•°çš„å­˜å‚¨ææ¸…æ¥šåå°±å®Œå…¨æ˜ç™½äº†ï¼ˆhttps://www.jianshu.com/p/ae5e68051244ï¼‰ã€‚å¯¹äºç²¾åº¦è¦æ±‚æ¯”è¾ƒé«˜çš„åœºæ™¯ï¼Œä¸èƒ½ä½¿ç”¨æµ®ç‚¹æ•°ï¼Œè¦ç”¨BigDecimalã€‚å› ä¸ºBigDecimalçš„å­˜å‚¨è·Ÿæµ®ç‚¹æ•°å®Œå…¨ä¸åŒã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655542664,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2102268,"avatar":"https://static001.geekbang.org/account/avatar/00/20/13/fc/9fd984fd.jpg","nickname":"å’–å•¡æ±ª","note":"","ucode":"1D251123439D20","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308049,"discussion_content":"æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600830487,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1015483,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7e/bb/947c329a.jpg","nickname":"ç¨‹åºå‘˜å°è·ƒ","note":"","ucode":"25BB96E0791A60","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":226124,"discussion_content":"çœ‹è¯¾ä»£è¡¨çš„è¯„è®ºï¼Œæ˜¯ä¸€ç§äº«å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586423780,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1254968,"avatar":"https://static001.geekbang.org/account/avatar/00/13/26/38/ef063dc2.jpg","nickname":"Darren","note":"","ucode":"CCD2B2C492BE9A","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1015483,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7e/bb/947c329a.jpg","nickname":"ç¨‹åºå‘˜å°è·ƒ","note":"","ucode":"25BB96E0791A60","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":227352,"discussion_content":"è°¢è°¢ï¼Œå¤§å®¶ä¸€èµ·è·Ÿç€è€å¸ˆåŠ æ²¹","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586485173,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":226124,"ip_address":""},"score":227352,"extra":""}]},{"author":{"id":1063307,"avatar":"https://static001.geekbang.org/account/avatar/00/10/39/8b/af74591f.jpg","nickname":"chun1123","note":"","ucode":"413C3A8722699F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":219078,"discussion_content":"è¯¾ä»£è¡¨æ¥äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585732172,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1254968,"avatar":"https://static001.geekbang.org/account/avatar/00/13/26/38/ef063dc2.jpg","nickname":"Darren","note":"","ucode":"CCD2B2C492BE9A","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1063307,"avatar":"https://static001.geekbang.org/account/avatar/00/10/39/8b/af74591f.jpg","nickname":"chun1123","note":"","ucode":"413C3A8722699F","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":219252,"discussion_content":"ğŸ˜‚ğŸ˜‚ğŸ˜‚ï¼Œå…±åŒå­¦ä¹ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585747900,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":219078,"ip_address":""},"score":219252,"extra":""}]},{"author":{"id":1527473,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4e/b1/4b922c82.jpg","nickname":"EchosEcho","note":"","ucode":"993828BAC9B385","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":216395,"discussion_content":"å­¦ä¹ äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585445621,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":197681,"user_name":"ğŸ‘½","can_delete":false,"product_type":"c1","uid":1274117,"ip_address":"","ucode":"D313AF941B412D","user_header":"https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg","comment_is_top":false,"comment_ctime":1585391693,"is_pvip":false,"replies":[{"id":"74633","content":"ç”¨åˆ†å­˜å‚¨æ˜¯å¯ä»¥ï¼ˆè§£å†³ç²¾åº¦é—®é¢˜ï¼‰ï¼Œä½†æ˜¯å®¹æ˜“å‡ºé”™ï¼Œä¸‡ä¸€è¯»çš„æ—¶å€™å¿˜è®°&#47;100æˆ–è€…æ˜¯å­˜çš„æ—¶å€™å¿˜è®°*100ï¼Œå¯èƒ½ä¼šå¼•èµ·é‡å¤§é—®é¢˜ï¼Œè¿˜æ˜¯ä½¿ç”¨DECIMAL(13, 2) &#47;DECIMAL(13, 4) å­˜æ¯”è¾ƒå¥½ã€‚","user_name":"ä½œè€…å›å¤","comment_id":197681,"uid":"1001470","ip_address":"","utype":1,"ctime":1585401407,"user_name_real":"æœ±æ™”"}],"discussion_count":3,"race_medal":0,"score":"61714933837","product_id":100047701,"comment_content":"æƒ³è¯·æ•™ä¸€ä¸‹ã€‚å…³äºé‡‘é¢ã€‚<br>è¿˜å­˜åœ¨ ä½¿ç”¨Longç±»å‹çš„åˆ†å­˜å‚¨ï¼Œä»¥åŠå°è£…çš„moneyå¯¹è±¡å­˜å‚¨çš„æ–¹å¼ã€‚è¿™ä¸¤ç§æ–¹å¼é€‚åˆè§£å†³é‡‘é¢ç±»çš„ç²¾åº¦ä¸¢å¤±é—®é¢˜å˜›ï¼Ÿ","like_count":15,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489580,"discussion_content":"ç”¨åˆ†å­˜å‚¨æ˜¯å¯ä»¥ï¼ˆè§£å†³ç²¾åº¦é—®é¢˜ï¼‰ï¼Œä½†æ˜¯å®¹æ˜“å‡ºé”™ï¼Œä¸‡ä¸€è¯»çš„æ—¶å€™å¿˜è®°/100æˆ–è€…æ˜¯å­˜çš„æ—¶å€™å¿˜è®°*100ï¼Œå¯èƒ½ä¼šå¼•èµ·é‡å¤§é—®é¢˜ï¼Œè¿˜æ˜¯ä½¿ç”¨DECIMAL(13, 2) /DECIMAL(13, 4) å­˜æ¯”è¾ƒå¥½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585401407,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1003940,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/51/a4/80f32335.jpg","nickname":"bing1024","note":"","ucode":"9D7454473D8CB0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":352382,"discussion_content":"google playæ”¯ä»˜æ¥å£é‡Œé¢ä½¿ç”¨çš„é‡‘é¢å•ä½ä¸ºç™¾ä¸‡åˆ†ä¹‹ä¸€","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1614697250,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2018275,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/cb/e3/a5cad724.jpg","nickname":"Lu","note":"","ucode":"DA2F82DB9437D1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372104,"discussion_content":"é¥¿äº†ä¹ˆä¼¼ä¹ä½¿ç”¨çš„æ˜¯åˆ†å­˜å‚¨ï¼Œå¯¹æ¥ä¸šåŠ¡çš„æ—¶å€™éœ€è¦éœ€è¦æ³¨æ„ä¸‹\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620194059,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":199162,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1585480905,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"40240186569","product_id":100047701,"comment_content":"æ‰‹æœºè®¡ç®—å™¨æŠŠ 10%+10% ç®—æˆäº† 0.11 è€Œä¸æ˜¯ 0.2ã€‚<br>è¯»åˆ°è¿™é‡Œï¼Œå“å¾—æˆ‘èµ¶å¿«æå‡ºå®‰å“æœºç®—äº†ä¸‹","like_count":10},{"had_liked":false,"id":201076,"user_name":"Jerry Wu","can_delete":false,"product_type":"c1","uid":1203567,"ip_address":"","ucode":"AD29B6942AAAA6","user_header":"https://static001.geekbang.org/account/avatar/00/12/5d/6f/42494dcf.jpg","comment_is_top":false,"comment_ctime":1585712521,"is_pvip":false,"replies":[{"id":"75212","content":"èµ","user_name":"ä½œè€…å›å¤","comment_id":201076,"uid":"1001470","ip_address":"","utype":1,"ctime":1585717452,"user_name_real":"æœ±æ™”"}],"discussion_count":3,"race_medal":0,"score":"35945450889","product_id":100047701,"comment_content":"æ„Ÿè°¢è€å¸ˆï¼Œçœ‹å®Œè¿™ç¯‡æ–‡ç« ï¼Œæ”¹äº†BigDecimalå·¥å…·ç±»ï¼Œé¿å…äº†ä¸€ä¸ªäº‹æ•…ã€‚","like_count":9,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490233,"discussion_content":"èµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585717452,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1596049,"avatar":"https://static001.geekbang.org/account/avatar/00/18/5a/91/f26d17d4.jpg","nickname":"âˆ«1/(x^4*âˆš(1+x^2))dx","note":"","ucode":"E300E20E5AF0FD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":227045,"discussion_content":"æ¶‰åŠé‡‘é¢æ“ä½œå¯ä»¥è€ƒè™‘ä½¿ç”¨Jada-Moneyå»å¯¹é‡‘é¢è¿›è¡ŒåŒ…è£…","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586447198,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1877862,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLu3MgZBAyyiavX2CMF2KRib791j3bBGiaQDzuQwBF2k6AKHANV2uTAAss2vVaeC7xcSYYD8vjmibRpTQ/132","nickname":"çºµä¸æœ½","note":"","ucode":"DB2CA2C46B2EF1","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1596049,"avatar":"https://static001.geekbang.org/account/avatar/00/18/5a/91/f26d17d4.jpg","nickname":"âˆ«1/(x^4*âˆš(1+x^2))dx","note":"","ucode":"E300E20E5AF0FD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":401925,"discussion_content":"è¿™åŒ…18å¹´å°±æ²¡æ›´æ–°äº†ï¼Œstarä¹Ÿå°‘ï¼Œèƒ½ç”¨ä¸","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633766603,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":227045,"ip_address":""},"score":401925,"extra":""}]}]},{"had_liked":false,"id":198240,"user_name":"Geek_3b1096","can_delete":false,"product_type":"c1","uid":1549364,"ip_address":"","ucode":"A6BD92B79B3632","user_header":"","comment_is_top":false,"comment_ctime":1585428080,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"27355231856","product_id":100047701,"comment_content":"ç”¨equalså¯¹ä¸¤BigDecimalåˆ¤ç­‰...ä¹‹å‰å°±è¢«å‘äº†","like_count":7,"discussions":[{"author":{"id":1239696,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ea/90/95b862bc.jpg","nickname":"è¿™æ˜¯æå®¢æ—¶é—´","note":"","ucode":"95EF3B568CAB7B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388747,"discussion_content":"è¿˜å¥½æˆ‘ä¹ æƒ¯å’Œ0æ¯”è¾ƒæ‰€ä»¥ç”¨è¿‡compare,ä¸ç„¶ä¹Ÿä¹ æƒ¯compareäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628933724,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1217874,"avatar":"https://static001.geekbang.org/account/avatar/00/12/95/52/ad190682.jpg","nickname":"Mr wind","note":"","ucode":"484F02D1962239","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312050,"discussion_content":"æˆ‘ä¹Ÿé‡åˆ°è¿‡ï¼Œæµ‹è¯•æµ‹å‡ºæ¥åæ‰æ„è¯†åˆ°å¯èƒ½éœ€è¦ç”¨compareTo","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602574667,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":197933,"user_name":"æ¯å¤©æ™’ç™½ç‰™","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1585404049,"is_pvip":false,"discussion_count":5,"race_medal":1,"score":"27355207825","product_id":100047701,"comment_content":"æˆ‘ä»¬ç°åœ¨å¯¹é‡‘é¢çš„è®¡ç®—éƒ½æ˜¯ç”¨åˆ†åšå•ä½å¤„ç†","like_count":7,"discussions":[{"author":{"id":1024486,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a1/e6/50da1b2d.jpg","nickname":"æ—­ä¸œ(Frank)","note":"","ucode":"176FA629800062","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":242912,"discussion_content":"åªæœ‰åœ¨éœ€è¦å±•ç¤ºçš„åœ°æ–¹æ‰è½¬æ¢å§ï¼Œå•ä»·éƒ½æ˜¯åˆ†å½•å–","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1587508842,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1004698,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","nickname":"æ¯å¤©æ™’ç™½ç‰™","note":"","ucode":"A1B102CD933DEA","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":1024486,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a1/e6/50da1b2d.jpg","nickname":"æ—­ä¸œ(Frank)","note":"","ucode":"176FA629800062","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":242942,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587513064,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":242912,"ip_address":""},"score":242942,"extra":""}]},{"author":{"id":2712078,"avatar":"https://static001.geekbang.org/account/avatar/00/29/62/0e/af82f76f.jpg","nickname":"å’¸é±¼","note":"","ucode":"32C83B9B063541","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392057,"discussion_content":"ä¸€èˆ¬è¿™æ ·ä¹Ÿå¤Ÿäº†ï¼Œä½†æ˜¯å¦‚æœä¸Šå‡åˆ°æ±‡ç‡çš„è¯ï¼Œä¸Šå‡åˆ°åˆ†çš„æ–¹æ³•å°±ä¸èƒ½æ•´äº†ï¼Œä¸è¿‡ä¸æ˜¯é‡‘èå…¬å¸çš„è¯ä¹Ÿä¸ä¼šæ¥è§¦åˆ°è¿™äº›çš„å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630807846,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2378309,"avatar":"https://static001.geekbang.org/account/avatar/00/24/4a/45/e048531a.jpg","nickname":"è¿ªç±³ä¹Œæ ¼æ–¯","note":"","ucode":"1D4393746DCBCE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341115,"discussion_content":"+1,æˆ‘å¸ä¹Ÿæ˜¯ç»Ÿä¸€åˆ°åˆ†è¿™ä¸ªå•ä½,æœ‰æ•ˆè§£å†³å°æ•°ä¸å‡†ç¡®çš„é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610293720,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1501593,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJ5Hnw1tL9EWGdzhibCw89hibKjibwcyUBCSJsQWaxxfGu5AkBibibV0anaKqw3nf3ZP0UWy5BaEYyw2Q/132","nickname":"smilekaka","note":"","ucode":"C01D8020019FDC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295415,"discussion_content":"å¯¹çš„ï¼Œ å¾®ä¿¡å°±æ˜¯è¿™ä¹ˆå¹²çš„ï¼Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596188548,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":197940,"user_name":"","can_delete":false,"product_type":"c1","uid":1940109,"ip_address":"","ucode":"4AC9863870BEF7","user_header":"","comment_is_top":false,"comment_ctime":1585404253,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"18765273437","product_id":100047701,"comment_content":"double\\floatç²¾åº¦é—®é¢˜ï¼Œä¼šå¯¼è‡´ä¸€äº›ç»“æœä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚æ¯”å¦‚3.35 å…¶å®å¦‚æœç”¨doubleè¡¨ç¤ºï¼Œåˆ™æ˜¯3.34900000ï¼Œå¦‚æœç”¨floatè¡¨ç¤ºï¼Œåˆ™æ˜¯3.500000æ‰€ä»¥æ§åˆ¶ç²¾åº¦ä¸èƒ½ç”¨ä»–ä»¬ã€‚<br>æµ®ç‚¹æ•°çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–ä¹Ÿè¦é€šè¿‡ BigDecimal è¿›è¡Œã€‚<br><br>BigDecimal num1 = new BigDecimal(&quot;3.35&quot;);<br>BigDecimal num2 = num1.setScale(1, BigDecimal.ROUND_DOWN);<br>System.out.println(num2);<br>BigDecimal num3 = num1.setScale(1, BigDecimal.ROUND_HALF_UP);<br>System.out.println(num3);<br>ä½¿ç”¨ BigDecimal è¡¨ç¤ºå’Œè®¡ç®—æµ®ç‚¹æ•°ï¼Œä¸”åŠ¡å¿…ä½¿ç”¨å­—ç¬¦ä¸²çš„æ„é€ æ–¹æ³•æ¥åˆå§‹åŒ– BigDecimal<br>å¦‚æœä¸€å®šè¦ç”¨ Double æ¥åˆå§‹åŒ– BigDecimal çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨ BigDecimal.valueOf æ–¹æ³•ï¼Œä»¥ç¡®ä¿å…¶è¡¨ç°å’Œå­—ç¬¦ä¸²å½¢å¼çš„æ„é€ æ–¹æ³•ä¸€è‡´ã€‚<br>å¦‚æœæˆ‘ä»¬å¸Œæœ›åªæ¯”è¾ƒ BigDecimal çš„ valueï¼Œå¯ä»¥ä½¿ç”¨ compareTo æ–¹æ³•<br>BigDecimalçš„equalsæ–¹æ³•æ˜¯æ¯”è¾ƒscaleçš„æ‰€ä»¥1.0è·Ÿ1å°±æ˜¯ä¸åŒçš„ã€‚æˆ‘ä»¬å¦‚æœè¦æ¯”è¾ƒä¸¤ä¸ªBigDecimalè¦ç”¨compareTo.<br><br>BigDecimal çš„ equals å’Œ hashCode æ–¹æ³•ä¼šåŒæ—¶è€ƒè™‘ value å’Œ scaleï¼Œå¦‚æœç»“åˆ HashSet æˆ– HashMap ä½¿ç”¨çš„è¯å°±å¯èƒ½ä¼šå‡ºç°éº»çƒ¦ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬æŠŠå€¼ä¸º 1.0 çš„ BigDecimal åŠ å…¥ HashSetï¼Œç„¶ååˆ¤æ–­å…¶æ˜¯å¦å­˜åœ¨å€¼ä¸º 1 çš„ BigDecimalï¼Œå¾—åˆ°çš„ç»“æœæ˜¯ falseï¼š<br><br>ç¬¬ä¸€ä¸ªæ–¹æ³•æ˜¯ï¼Œä½¿ç”¨ TreeSet æ›¿æ¢ HashSetã€‚TreeSet ä¸ä½¿ç”¨ hashCode æ–¹æ³•ï¼Œä¹Ÿä¸ä½¿ç”¨ equals æ¯”è¾ƒå…ƒç´ ï¼Œè€Œæ˜¯ä½¿ç”¨ compareTo æ–¹æ³•ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰é—®é¢˜ã€‚<br><br>Set&lt;BigDecimal&gt; treeSet = new TreeSet&lt;&gt;();<br>treeSet.add(new BigDecimal(&quot;1.0&quot;));<br>System.out.println(treeSet.contains(new BigDecimal(&quot;1&quot;)));&#47;&#47;è¿”å›true<br><br>ç¬¬äºŒä¸ªæ–¹æ³•æ˜¯ï¼ŒæŠŠ BigDecimal å­˜å…¥ HashSet æˆ– HashMap å‰ï¼Œå…ˆä½¿ç”¨ stripTrailingZeros æ–¹æ³•å»æ‰å°¾éƒ¨çš„é›¶ï¼Œæ¯”è¾ƒçš„æ—¶å€™ä¹Ÿå»æ‰å°¾éƒ¨çš„ 0ï¼Œç¡®ä¿ value ç›¸åŒçš„ BigDecimalï¼Œscale ä¹Ÿæ˜¯ä¸€è‡´çš„ï¼š<br><br>Set&lt;BigDecimal&gt; hashSet2 = new HashSet&lt;&gt;();<br>hashSet2.add(new BigDecimal(&quot;1.0&quot;).stripTrailingZeros());<br>System.out.println(hashSet2.contains(new BigDecimal(&quot;1.000&quot;).stripTrailingZeros()));&#47;&#47;è¿”å›true<br><br>æˆ‘ä»¬å¹³æ—¶ä¼šå¿½ç•¥æ‰æº¢å‡ºçš„é—®é¢˜ã€‚<br>æ–¹æ³•ä¸€æ˜¯ï¼Œè€ƒè™‘ä½¿ç”¨ Math ç±»çš„ addExactã€subtractExact ç­‰ xxExact æ–¹æ³•è¿›è¡Œæ•°å€¼è¿ç®—ï¼Œè¿™äº›æ–¹æ³•å¯ä»¥åœ¨æ•°å€¼æº¢å‡ºæ—¶ä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸.<br>\\æ–¹æ³•äºŒæ˜¯ï¼Œä½¿ç”¨å¤§æ•°ç±» BigIntegerã€‚BigDecimal æ˜¯å¤„ç†æµ®ç‚¹æ•°çš„ä¸“å®¶ï¼Œè€Œ BigInteger åˆ™æ˜¯å¯¹å¤§æ•°è¿›è¡Œç§‘å­¦è®¡ç®—çš„ä¸“å®¶ã€‚","like_count":4,"discussions":[{"author":{"id":1012843,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/74/6b/a98162a1.jpg","nickname":"winner_0715","note":"","ucode":"A033A30539181F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558499,"discussion_content":"......","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648350440,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":210188,"user_name":"Tesla","can_delete":false,"product_type":"c1","uid":1500742,"ip_address":"","ucode":"98629AFD9861EE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKUcSLVV6ia3dibe7qvTu8Vic1PVs2EibxoUdx930MC7j2Q9A6s4eibMDZlcicMFY0D0icd3RrDorMChu0zw/132","comment_is_top":false,"comment_ctime":1587695583,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10177630175","product_id":100047701,"comment_content":"æ¨èmoneyç±»","like_count":2},{"had_liked":false,"id":205284,"user_name":"ğŸ‘»","can_delete":false,"product_type":"c1","uid":1227789,"ip_address":"","ucode":"1648C82AC73C1D","user_header":"https://static001.geekbang.org/account/avatar/00/12/bc/0d/e65ca230.jpg","comment_is_top":false,"comment_ctime":1586583196,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10176517788","product_id":100047701,"comment_content":"æœ€å¥½çš„åŠæ³•å°±æ˜¯å†™å¥½æµ‹è¯•ç”¨ä¾‹","like_count":2},{"had_liked":false,"id":197500,"user_name":"hellojd","can_delete":false,"product_type":"c1","uid":1341697,"ip_address":"","ucode":"4E51807AE7E472","user_header":"https://static001.geekbang.org/account/avatar/00/14/79/01/e71510dc.jpg","comment_is_top":false,"comment_ctime":1585382091,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10175316683","product_id":100047701,"comment_content":"è¿˜æœ‰ bigdecimalçš„å€¼å¯¹æ¯”ï¼Œä¹Ÿæ˜¯é—®é¢˜","like_count":2},{"had_liked":false,"id":197499,"user_name":"hellojd","can_delete":false,"product_type":"c1","uid":1341697,"ip_address":"","ucode":"4E51807AE7E472","user_header":"https://static001.geekbang.org/account/avatar/00/14/79/01/e71510dc.jpg","comment_is_top":false,"comment_ctime":1585382041,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10175316633","product_id":100047701,"comment_content":"å¯¹è´¦æ—¶ï¼Œæ¶‰åŠdoubleæ±‚å’Œ ,é‡åˆ°äº†","like_count":2},{"had_liked":false,"id":197163,"user_name":"pedro","can_delete":false,"product_type":"c1","uid":1200704,"ip_address":"","ucode":"F40C839DDFD599","user_header":"https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg","comment_is_top":false,"comment_ctime":1585361367,"is_pvip":false,"replies":[{"id":"74529","content":"ğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","comment_id":197163,"uid":"1001470","ip_address":"","utype":1,"ctime":1585364705,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"10175295959","product_id":100047701,"comment_content":"ç¬¬ä¸€ä¸ªé—®é¢˜ï¼ŒBigDecimal çš„ 8 ä¸­ Roundæ¨¡å¼ï¼Œåˆ†åˆ«æ˜¯ <br>1.ROUND_UPï¼šå‘ä¸Šå–æ•´ï¼Œå¦‚ 5.1 è¢«æ ¼å¼åŒ–åä¸º 6ï¼Œå¦‚æœæ˜¯è´Ÿæ•°åˆ™ä¸ç›´è§‚ä¸Šä¸ä¸€è‡´ï¼Œå¦‚ -1.1 ä¼šå˜æˆ -2ã€‚2.ROUND_DOWNï¼šå‘ä¸‹å–æ•´ï¼Œä¸ ROUND_UP ç›¸åã€‚<br>3.ROUND_CEILINGï¼šæ­£è´Ÿæ•°åˆ†å¼€ç‰ˆçš„å–æ•´ï¼Œå¦‚æœæ˜¯æ­£æ•°ï¼Œåˆ™ä¸ ROUND_UP ä¸€æ ·ï¼Œå¦‚æœæ˜¯è´Ÿæ•°åˆ™ä¸ ROUND_DOWN ä¸€æ ·ã€‚<br>4.ROUND_FLOORï¼šæ­£è´Ÿæ•°åˆ†å¼€ç‰ˆçš„å–æ•´ï¼Œä¸ ROUND_CEILING ç›¸åã€‚<br>5.ROUND_HALF_UPï¼šå››èˆäº”å…¥ç‰ˆå–æ•´ï¼Œæˆ‘ä»¬ç›´è§‚ä¸Šæœ€ä¸ºç†è§£çš„ä¸€ç§æ¨¡å¼ï¼Œå¦‚ 5.4 å°æ•°éƒ¨åˆ†å°äº 0.5ï¼Œåˆ™èˆä½ä¸º 5ï¼Œå¦‚æœæ˜¯ 5.6 åˆ™è¿›ä½å˜æˆ 6ï¼Œå¦‚æœæ˜¯è´Ÿæ•°ï¼Œå¦‚ -5.4 =&gt; -5ï¼Œ-5.6 =&gt; -6ã€‚ <br>6.ROUND_HALF_DOWNï¼šäº”èˆå…­å…¥ç‰ˆå–æ•´ï¼Œå¿…é¡»å¤§äº 0.5 æ‰å¯è¿›ä½ï¼Œå…¶å®ƒä¸ ROUND_HALF_UP ä¸€è‡´ã€‚<br>7.ROUND_HALF_EVENï¼šå¥‡å¶ç‰ˆå››èˆäº”å…¥å–æ•´ï¼Œå¦‚æœèˆå¼ƒéƒ¨åˆ†å·¦è¾¹çš„æ•°å­—ä¸ºå¥‡æ•°ï¼Œåˆ™ä½œ   ROUND_HALF_UPï¼›å¦‚æœå®ƒä¸ºå¶æ•°ï¼Œåˆ™ä½œROUND_HALF_DOWNï¼Œä¼šæ ¹æ®èˆå¼ƒéƒ¨åˆ†çš„å¥‡å¶æ€§æ¥é€‰æ‹©è¿›ä½çš„æ˜¯å››èˆäº”å…¥è¿˜æ˜¯äº”èˆå…­å…¥ã€‚<br>8. ROUND_UNNECESSARYï¼šè¦æ±‚ä¼ å…¥çš„æ•°å¿…é¡»æ˜¯ç²¾ç¡®çš„ï¼Œå¦‚ 1 å’Œ 1.0 éƒ½æ˜¯ç²¾ç¡®çš„ï¼Œå¦‚æœä¸º 1.2 æˆ–è€… 1.6 ä¹‹ç±»çš„å‡ä¼šæŠ¥ ArithmeticException å¼‚å¸¸ã€‚<br><br>ç¬¬äºŒä¸ªé—®é¢˜ï¼ŒMySQL æ˜¯æ”¯æŒ bigint å’Œ bigdecimal æ•°æ®ç±»å‹å­˜å‚¨çš„ï¼Œå½“ç„¶è¿˜æœ‰ numbericï¼Œnumberic çš„ä½œç”¨ä¸ bigdecimal ä¸€è‡´ï¼Œå½“ç„¶å¦‚æœè¿™äº›æ•°æ®ç±»å‹åœ¨æ•°æ®åº“ä¸­è®¡ç®—æˆ‘è§‰å¾—æ˜¯ä¸å¦¥çš„ï¼Œåº”è¯¥æŸ¥è¯¢ååœ¨ä»£ç å±‚é¢ä¸­è®¡ç®—ï¼Œå½“ç„¶å¦‚æœæœ‰äººè¡¥å……ä¸€ä¸‹å¦‚ä½•åœ¨æ•°æ®åº“ä¸­ç§‘å­¦è®¡ç®—ï¼Œä¹Ÿå¯è®©å¤§å®¶æ¶¨æ¶¨è§è¯†ğŸ˜„ã€‚","like_count":3,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489461,"discussion_content":"ğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585364705,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":221140,"user_name":"å²³å®œæ³¢","can_delete":false,"product_type":"c1","uid":1975581,"ip_address":"","ucode":"5043CA250FDCB1","user_header":"http://thirdwx.qlogo.cn/mmopen/2kpMNDYsSfCnhAYmvAsNcYKyNLUJG5iax9BKgXAJzxypEJGRVwhibjZ53S5icgEDibn8uqrqwsKcxzEXfRRUXTdqjA/132","comment_is_top":false,"comment_ctime":1590415902,"is_pvip":false,"replies":[{"id":"81553","content":"ğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","comment_id":221140,"uid":"1001470","ip_address":"","utype":1,"ctime":1590417643,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"5885383198","product_id":100047701,"comment_content":"ä¸€èˆ¬ç”¨çš„æ¯”è¾ƒå¤šçš„å°±æ˜¯ï¼Œå‘ä¸Šå–æ•´ï¼Œå‘ä¸‹å–æ•´ï¼Œå››èˆäº”å…¥å’Œèˆä½å››ç§ï¼Œåœ¨æˆ‘ä»¬é¡¹ç›®é‡Œå› ä¸ºæœ‰å›½é™…åŒ–ï¼Œä¼šæœ‰å¸ç§æ¡£æ¡ˆï¼Œåœ¨å¸ç§ä¸­å®šä¹‰é‡‘é¢ç²¾åº¦å’Œä»·æ ¼ç²¾åº¦ä»¥åŠèˆå…¥æ–¹å¼ï¼Œåœ¨å•†å“çš„è®¡é‡å•ä½ä¸Šå®šä¹‰æ•°é‡ç²¾åº¦ä»¥åŠèˆå…¥æ–¹å¼ã€‚","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496351,"discussion_content":"ğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590417643,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":203965,"user_name":"ç¾ç¾","can_delete":false,"product_type":"c1","uid":1148422,"ip_address":"","ucode":"44CC95C45AF345","user_header":"https://static001.geekbang.org/account/avatar/00/11/86/06/72b01bb7.jpg","comment_is_top":false,"comment_ctime":1586313222,"is_pvip":false,"replies":[{"id":"76266","content":"å¯ä»¥æ¯”è¾ƒä¸€ä¸‹ï¼Œä¸»è¦æ˜¯è¦å°å¿ƒscaleï¼š<br><br>BigDecimal bigDecimal1 = new BigDecimal(&quot;100&quot;);<br>        BigDecimal bigDecimal2 = new BigDecimal(String.valueOf(100d));<br>        BigDecimal bigDecimal3 = BigDecimal.valueOf(100d);<br>        BigDecimal bigDecimal4 = new BigDecimal(Double.toString(100d));<br><br>        System.out.println(bigDecimal1.multiply(new BigDecimal(&quot;4.015&quot;)));<br>        System.out.println(bigDecimal2.multiply(new BigDecimal(&quot;4.015&quot;)));<br>        System.out.println(bigDecimal3.multiply(new BigDecimal(&quot;4.015&quot;)));<br>        System.out.println(bigDecimal4.multiply(new BigDecimal(&quot;4.015&quot;)));","user_name":"ä½œè€…å›å¤","comment_id":203965,"uid":"1001470","ip_address":"","utype":1,"ctime":1586318825,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"5881280518","product_id":100047701,"comment_content":"è¯·æ•™è€å¸ˆstring.valueofæ›¿ä»£bigdecimal.valueofå¯å¦å‘¢","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491021,"discussion_content":"å¯ä»¥æ¯”è¾ƒä¸€ä¸‹ï¼Œä¸»è¦æ˜¯è¦å°å¿ƒscaleï¼š\n\nBigDecimal bigDecimal1 = new BigDecimal(&amp;quot;100&amp;quot;);\n        BigDecimal bigDecimal2 = new BigDecimal(String.valueOf(100d));\n        BigDecimal bigDecimal3 = BigDecimal.valueOf(100d);\n        BigDecimal bigDecimal4 = new BigDecimal(Double.toString(100d));\n\n        System.out.println(bigDecimal1.multiply(new BigDecimal(&amp;quot;4.015&amp;quot;)));\n        System.out.println(bigDecimal2.multiply(new BigDecimal(&amp;quot;4.015&amp;quot;)));\n        System.out.println(bigDecimal3.multiply(new BigDecimal(&amp;quot;4.015&amp;quot;)));\n        System.out.println(bigDecimal4.multiply(new BigDecimal(&amp;quot;4.015&amp;quot;)));","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586318825,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":198445,"user_name":"å´å›½å¸…","can_delete":false,"product_type":"c1","uid":1638035,"ip_address":"","ucode":"D2EBC0308CC361","user_header":"https://static001.geekbang.org/account/avatar/00/18/fe/93/8999259d.jpg","comment_is_top":false,"comment_ctime":1585451850,"is_pvip":false,"replies":[{"id":"74688","content":"è§‰å¾—å¥½å¯ä»¥å¤šè½¬å‘åˆ†äº«","user_name":"ä½œè€…å›å¤","comment_id":198445,"uid":"1001470","ip_address":"","utype":1,"ctime":1585457151,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"5880419146","product_id":100047701,"comment_content":"çœŸæ£’ getåˆ°çŸ¥è¯†äº†ï¼","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489704,"discussion_content":"è§‰å¾—å¥½å¯ä»¥å¤šè½¬å‘åˆ†äº«","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585457151,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":198093,"user_name":"è®¸ç«¥ç«¥","can_delete":false,"product_type":"c1","uid":1003005,"ip_address":"","ucode":"4B799C0C6BC678","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg","comment_is_top":false,"comment_ctime":1585408867,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5880376163","product_id":100047701,"comment_content":"æµ®ç‚¹æ•°æˆ‘å°è±¡å¾ˆæ·±åˆ»çš„ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¤§æ•°åƒå°æ•°çš„é—®é¢˜","like_count":1},{"had_liked":false,"id":197121,"user_name":"æ¢¦å€šæ æ†","can_delete":false,"product_type":"c1","uid":1095857,"ip_address":"","ucode":"BDEB97F2822445","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/bvj76PmeUvW8kokyu91IZWuRATKmabibDWbzAj2TajeEic7WvKCJOLaOh6jibEmdQ36EO3sBUZ0HibAiapsrZo64U8w/132","comment_is_top":false,"comment_ctime":1585358885,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5880326181","product_id":100047701,"comment_content":"0.45å’Œ0.55ä¹Ÿæœ‰è¿™ä¸ªé—®é¢˜ã€‚double a=0.45,å¯ä»¥è¾“å‡º0.45,double b =1-0.55=0.444444449","like_count":1},{"had_liked":false,"id":308083,"user_name":"chachae","can_delete":false,"product_type":"c1","uid":1669586,"ip_address":"","ucode":"F9FB01803C0F1F","user_header":"https://static001.geekbang.org/account/avatar/00/19/79/d2/a3fbad97.jpg","comment_is_top":false,"comment_ctime":1629383779,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1629383779","product_id":100047701,"comment_content":"equal è¿™ä¸ªç¡®å®å¾ˆå‘hhh","like_count":0},{"had_liked":false,"id":286307,"user_name":"JoJi","can_delete":false,"product_type":"c1","uid":2066986,"ip_address":"","ucode":"B88997A80E76AC","user_header":"https://static001.geekbang.org/account/avatar/00/1f/8a/2a/f94db4dc.jpg","comment_is_top":false,"comment_ctime":1617247222,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617247222","product_id":100047701,"comment_content":"å¦‚æœæ•°æ®åº“é‡Œè®¾ç½®äº†BigDecimalå°æ•°ç‚¹ä¸º2ä½ï¼Œåœ¨å­˜å‚¨æ–¹é¢BigDecimalæ ¼å¼åŒ–çš„é—®é¢˜(Double.toStringé‚£ä¸ªä¾‹å­)æ˜¯ä¸æ˜¯å°±ä¸å½±å“äº†ã€‚","like_count":1},{"had_liked":false,"id":273780,"user_name":"é²é¸£","can_delete":false,"product_type":"c1","uid":2152306,"ip_address":"","ucode":"974BA3C3E64630","user_header":"https://static001.geekbang.org/account/avatar/00/20/d7/72/cbef720d.jpg","comment_is_top":false,"comment_ctime":1610676224,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1610676224","product_id":100047701,"comment_content":"å¯¹äºå¤§æ•°BigIntegerï¼Œä¸€å®šè¦ä½¿ç”¨longValueExactæ–¹æ³•ï¼Œå¦‚æœæ˜¯ä½¿ç”¨longValueçš„è¯ï¼ŒåŒæ ·å­˜åœ¨æº¢å‡ºé—®é¢˜","like_count":1},{"had_liked":false,"id":246116,"user_name":"jacy","can_delete":false,"product_type":"c1","uid":1103456,"ip_address":"","ucode":"0022A8759DDCE6","user_header":"https://static001.geekbang.org/account/avatar/00/10/d6/60/f21b2164.jpg","comment_is_top":false,"comment_ctime":1599183573,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1599183573","product_id":100047701,"comment_content":"1ã€åŸºç¡€ç±»å‹æ¯”è¾ƒå¯ä»¥ç”¨==ï¼ŒéåŸºç¡€ç±»å‹ç”¨equalï¼ˆBigDecimaléœ€è¦çœ‹åœºæ™¯ï¼‰ã€‚<br>2ã€BigDecimalç”¨å­—ç¬¦ä½œå…¥å‚å¯ä¿è¯ç²¾åº¦ï¼Œç¬¦ç‚¹è¿ç®—æœ€å¥½éƒ½ç”¨æ­¤ç±»å‹ï¼Œequalä¼šæ¯”è¾ƒvalueå’Œscalaï¼ŒcompareToä»…æ¯”è¾ƒvalueï¼Œ<br>å››èˆäº”å…¥æ—¶å¯ä»¥æ˜ç¡®æŒ‡å®šèˆå…¥æ–¹å¼æˆ–æ˜¯èˆå…¥ä½æ•°ã€‚<br>3ã€HashXXæ˜¯åˆ†ç¦»é“¾æ¥æ³•å®ç°ï¼Œæ¯”è¾ƒç”¨hashCodeå®šä½åˆ°æ§½ï¼Œç”¨equalæ¯”è¾ƒå€¼ã€‚TreeXXæ˜¯æ ‘å®ç°ï¼Œæ¯”è¾ƒç”¨compareToã€‚<br>4ã€å¤§æ•´æ•°è¿ç®—å¯ä»¥ç”¨BigIntegerï¼Œè½¬æ¢ç±»å‹å¦‚æœæœ‰æº¢å‡ºæ—¶ä¼šæŠ›å¼‚å¸¸ï¼Œå°†é—®é¢˜æš´éœ²å‡ºæ¥ã€‚","like_count":0},{"had_liked":false,"id":235470,"user_name":"James","can_delete":false,"product_type":"c1","uid":1134861,"ip_address":"","ucode":"48B0F2A334D1C1","user_header":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","comment_is_top":false,"comment_ctime":1595050026,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595050026","product_id":100047701,"comment_content":"BigDecimalæä¾›äº† 8 ç§èˆå…¥æ¨¡å¼å¯ä»¥ç›´æ¥çœ‹æºç ,æºç æœ‰æ³¨é‡Šä¾‹å­","like_count":0},{"had_liked":false,"id":233583,"user_name":"ç…ç…å›","can_delete":false,"product_type":"c1","uid":1069646,"ip_address":"","ucode":"3700048634C565","user_header":"https://static001.geekbang.org/account/avatar/00/10/52/4e/5150a2ee.jpg","comment_is_top":false,"comment_ctime":1594360510,"is_pvip":false,"replies":[{"id":"86227","content":"ä¸é”™","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1594375476,"ip_address":"","comment_id":233583,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1594360510","product_id":100047701,"comment_content":"æˆ‘æƒ³è¡¥å……ä¸€ç‚¹ï¼Œä¹‹æ‰€ä»¥DecimalFormatä¹Ÿä¼šå¯¼è‡´ç²¾åº¦çš„é—®é¢˜ï¼Œæ˜¯å› ä¸º format.format(num) è¿™ä¸ªæ–¹æ³•å‚æ•°æ˜¯doubleç±»å‹ï¼Œä¼ floatä¼šå¯¼è‡´å¼ºè½¬ä¸¢å¤±ç²¾åº¦ã€‚æ‰€ä»¥æ— è®ºæ€ä¹ˆæ ·ï¼Œæµ®ç‚¹æ•°çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–é€šè¿‡ BigDecimal è¿›è¡Œå°±è¡Œ","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501095,"discussion_content":"ä¸é”™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594375476,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}