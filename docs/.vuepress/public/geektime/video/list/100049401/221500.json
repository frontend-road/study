{"id":221500,"title":"04 | Service Mesh的发展：Service Mesh技术是如何演进的？","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-servicemesh\">https://gitee.com/geektime-geekbang/geektime-servicemesh</a></p>","comments":[{"had_liked":false,"id":207009,"user_name":"better","can_delete":false,"product_type":"c3","uid":1257750,"ip_address":"","ucode":"2B9BCCED753D7F","user_header":"https://static001.geekbang.org/account/avatar/00/13/31/16/f2269e73.jpg","comment_is_top":false,"comment_ctime":1586995012,"is_pvip":false,"replies":[{"id":77397,"content":"功能类似，但位置不同，导致处理的问题不同。sidecar在网格内部，网关在网格边界。前者负责东西流量，后者负责南北流量。","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1587025259,"ip_address":"","comment_id":207009,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"sidecar和微服务中的服务网关有什么区别呢，老师","like_count":7,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491979,"discussion_content":"功能类似，但位置不同，导致处理的问题不同。sidecar在网格内部，网关在网格边界。前者负责东西流量，后者负责南北流量。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587025259,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":222070,"user_name":"Geek_6db4f5","can_delete":false,"product_type":"c3","uid":2017457,"ip_address":"","ucode":"33BC5F5DFF231F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIRB21jbSQrMoqSVNnTRetBvvpdduOJzZ91PWN4iboQVqCVBTUiaqLohT03RqqjgNDSXyicYzHChM7xw/132","comment_is_top":false,"comment_ctime":1590669224,"is_pvip":false,"replies":[{"id":81939,"content":"思路相似，sidecar就是个代理，只不过更加专一；\n部署形式也不同，sidecar是1比1部署在服务上。nginx这种代理你没见过每个服务都部署一份的吧？","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1590735064,"ip_address":"","comment_id":222070,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"老师，第三阶段的代理和第四阶段的边车模式有什么本质上的区别吗？感觉有点模糊这块，理解上感觉只是一个功能多，一个功能少？","like_count":5,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496657,"discussion_content":"思路相似，sidecar就是个代理，只不过更加专一；\n部署形式也不同，sidecar是1比1部署在服务上。nginx这种代理你没见过每个服务都部署一份的吧？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590735064,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":203685,"user_name":"光","can_delete":false,"product_type":"c3","uid":1284618,"ip_address":"","ucode":"BDA7F41566E4FE","user_header":"https://static001.geekbang.org/account/avatar/00/13/9a/0a/6c74e932.jpg","comment_is_top":false,"comment_ctime":1586254616,"is_pvip":false,"replies":[{"id":76227,"content":"你可以理解为sidecar是Pod里的一个容器，为Pod中另一个主容器（也就是你的应用所在的容器）服务。sidecar好比你应用容器的助手，负责非业务相关的逻辑，比如日志处理，流量控制。","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1586311350,"ip_address":"","comment_id":203685,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"这个sidecar 比如filebeat和普通得pod 有什么本质区别么。还是只是区分了角色。","like_count":4,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490934,"discussion_content":"你可以理解为sidecar是Pod里的一个容器，为Pod中另一个主容器（也就是你的应用所在的容器）服务。sidecar好比你应用容器的助手，负责非业务相关的逻辑，比如日志处理，流量控制。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586311350,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":237296,"user_name":"Kirin","can_delete":false,"product_type":"c3","uid":1109172,"ip_address":"","ucode":"01069F39A963DA","user_header":"https://static001.geekbang.org/account/avatar/00/10/ec/b4/7e75c23e.jpg","comment_is_top":false,"comment_ctime":1595771622,"is_pvip":false,"replies":[{"id":87814,"content":"官方的测试结果是每个sidecar仅有2ms的延迟，即便你的调用链很长，加起来也多不了多少。题外话，如果你的一个业务流程上有太多的服务，说明服务划分的有问题。\n我们公司是比较典型的中小型应用，服务不超过100个。性能问题通常是应用本身的问题居多，不必担心mesh，envoy已经被验证了性能优秀","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1595934895,"ip_address":"","comment_id":237296,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"老师，您好，A-&gt;A&#39;-&gt;B&#39;-B, 这个仅仅是两个服务调用，如果服务调用链路很长的话，担心性能问题。不用Istio的话，服务很多，又难以治理，这个如何取舍？最后问下老师所在单位的使用的Istio的规模多大，遇到性能问题是如何解决的？多谢。","like_count":1,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":502366,"discussion_content":"官方的测试结果是每个sidecar仅有2ms的延迟，即便你的调用链很长，加起来也多不了多少。题外话，如果你的一个业务流程上有太多的服务，说明服务划分的有问题。\n我们公司是比较典型的中小型应用，服务不超过100个。性能问题通常是应用本身的问题居多，不必担心mesh，envoy已经被验证了性能优秀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595934895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":249997,"user_name":"宝爷","can_delete":false,"product_type":"c3","uid":1153664,"ip_address":"","ucode":"DD517FA7EB59AB","user_header":"https://static001.geekbang.org/account/avatar/00/11/9a/80/2bf8d7fc.jpg","comment_is_top":false,"comment_ctime":1600876677,"is_pvip":false,"replies":[{"id":92164,"content":"sidecar的概念出来也很久了，我们这里特指限定在容器形态的sidecar，只要它接管同一个pod中应用的某种流量（不限于网络、也可以是db流量、io），那它就是一种代理。所以你可以认为sidecar就是一种代理。\n你说的sidecar组成的网络就是第一代Service mesh。","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1602231779,"ip_address":"","comment_id":249997,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"代理和sidecar有什么本质的区别吗？我理解都是用另一个进程来接管网络，为什么是先出来sidecar，再出来service mesh？感觉sidecar出来之后，之间组成一个网络就是所谓的service mesh了。本质区别感觉没有讲透","like_count":0,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506094,"discussion_content":"sidecar的概念出来也很久了，我们这里特指限定在容器形态的sidecar，只要它接管同一个pod中应用的某种流量（不限于网络、也可以是db流量、io），那它就是一种代理。所以你可以认为sidecar就是一种代理。\n你说的sidecar组成的网络就是第一代Service mesh。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602231779,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":204717,"user_name":"Fisher","can_delete":false,"product_type":"c3","uid":1089543,"ip_address":"","ucode":"49C0EB546971ED","user_header":"https://static001.geekbang.org/account/avatar/00/10/a0/07/8d91021c.jpg","comment_is_top":false,"comment_ctime":1586444779,"is_pvip":false,"replies":[{"id":76561,"content":"对spring cloud没有深入研究，不敢妄加评论。以我现在粗浅的认识来说，我认为它算是一种公共库的解决方案，至少需要一些config或者annotation植入到应用代码中，对吧？如果我说的不对请专家指正。\n所谓殊途同归，他们要解决的问题基本上是一致的，只不过思路不同而已，选择哪种解决方案还是要看自身的情况。我个人认为service mesh的思想是更符合云原生的理念的。","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1586488908,"ip_address":"","comment_id":204717,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"说起微服务，都会说到spring cloud。那么这里老师提到的几个阶段。是不是可以说spring cloud组件都算是公共库呢？还称不上是代理，更称不上是sidecar了。","like_count":0,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491267,"discussion_content":"对spring cloud没有深入研究，不敢妄加评论。以我现在粗浅的认识来说，我认为它算是一种公共库的解决方案，至少需要一些config或者annotation植入到应用代码中，对吧？如果我说的不对请专家指正。\n所谓殊途同归，他们要解决的问题基本上是一致的，只不过思路不同而已，选择哪种解决方案还是要看自身的情况。我个人认为service mesh的思想是更符合云原生的理念的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586488908,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":204315,"user_name":"dream","can_delete":false,"product_type":"c3","uid":1117793,"ip_address":"","ucode":"65B33D32FA8BE9","user_header":"https://static001.geekbang.org/account/avatar/00/11/0e/61/ae68f8eb.jpg","comment_is_top":false,"comment_ctime":1586363060,"is_pvip":false,"replies":[{"id":76566,"content":"sidecar是一个广义的概念，我们可以认为所有能帮服务分担非业务功能的代理，都是sidecar。比如filebeat，帮服务收集日志，也是一种sidecar。\nservice mesh是利用了sidecar的思路，本质上就是sidecar的网络拓扑组合，只不过它的sidecar只负责流量控制相关的功能而已。\n只要你的应用中有这样的sidecar，哪怕只有一部分有，加上控制平面，就算是mesh。","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1586489543,"ip_address":"","comment_id":204315,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"第四阶段和第五阶段的区别是，第四阶段中只有部分服务有 Sidecar，而第五阶段是所有服务都有 Sidecar 吗？","like_count":0,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491139,"discussion_content":"sidecar是一个广义的概念，我们可以认为所有能帮服务分担非业务功能的代理，都是sidecar。比如filebeat，帮服务收集日志，也是一种sidecar。\nservice mesh是利用了sidecar的思路，本质上就是sidecar的网络拓扑组合，只不过它的sidecar只负责流量控制相关的功能而已。\n只要你的应用中有这样的sidecar，哪怕只有一部分有，加上控制平面，就算是mesh。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586489543,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1089543,"avatar":"https://static001.geekbang.org/account/avatar/00/10/a0/07/8d91021c.jpg","nickname":"Fisher","note":"","ucode":"49C0EB546971ED","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":226874,"discussion_content":"我的理解是，第四阶段的sidecar是一对一通讯，第五阶段是一对多通讯。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586443941,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":204312,"user_name":"dream","can_delete":false,"product_type":"c3","uid":1117793,"ip_address":"","ucode":"65B33D32FA8BE9","user_header":"https://static001.geekbang.org/account/avatar/00/11/0e/61/ae68f8eb.jpg","comment_is_top":false,"comment_ctime":1586362535,"is_pvip":false,"replies":[{"id":76567,"content":"公共库通常都需要整合、集成，这个过程算一种侵入。比如一些配置文件、代码中的annotation等。\n另外，部分公共库虽然功能等方面独立，但是最终和应用程序一起被编译到同一个可执行文件去部署、运行。这算第二种侵入。","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1586489779,"ip_address":"","comment_id":204312,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"请问一下，在第三阶段，把公共库抽出来单独部署，由代理去处理相应的业务逻辑。那么在业务逻辑是不是也会有代码或者配置调用公共库，没有语言绑定，但是任然有代码侵入的。是这样吗？","like_count":0,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491138,"discussion_content":"公共库通常都需要整合、集成，这个过程算一种侵入。比如一些配置文件、代码中的annotation等。\n另外，部分公共库虽然功能等方面独立，但是最终和应用程序一起被编译到同一个可执行文件去部署、运行。这算第二种侵入。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586489779,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":238662,"user_name":"Ω ٩(ˊᗜˋ*)و","can_delete":false,"product_type":"c3","uid":1466561,"ip_address":"","ucode":"C6574C35685444","user_header":"https://static001.geekbang.org/account/avatar/00/16/60/c1/5ca216ba.jpg","comment_is_top":false,"comment_ctime":1596252340,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"文章地址\nhttps:&#47;&#47;philcalcado.com&#47;2017&#47;08&#47;03&#47;pattern_service_mesh.html","like_count":1},{"had_liked":false,"id":341335,"user_name":"知者减半、省者全无","can_delete":false,"product_type":"c3","uid":1325355,"ip_address":"","ucode":"E94E146545FDC5","user_header":"https://static001.geekbang.org/account/avatar/00/14/39/2b/4aee52f8.jpg","comment_is_top":false,"comment_ctime":1649551923,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"老师，Api网关在service mesh中存在的意义大么","like_count":0},{"had_liked":false,"id":332552,"user_name":"K","can_delete":false,"product_type":"c3","uid":1864958,"ip_address":"","ucode":"BF3743E75E9930","user_header":"https://static001.geekbang.org/account/avatar/00/1c/74/fe/770ab343.jpg","comment_is_top":false,"comment_ctime":1643338706,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100049401,"comment_content":"ServiceMesh 演进过程：\n第一阶段：公共库抽取，解决业务耦合问题，但维护成本高，语言相关，通用型较差\n第二阶段：代理模式，功能较为简陋，手工操作，如Nginx\n第三阶段：边车模式，帮助微服务处理大部分网络请求，\n第四阶段：ServiceMesh，边车模式网格化，更为通用的网络处理模型\n第五阶段：ServiceMesh2，ServiceMesh升级版，增加控制平面","like_count":0,"discussions":[{"author":{"id":2450893,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/L8EpqHoAnmvkzCIsdOkv5QvhIzu5tMaF2FDusXShqukv5ZBkS8DbicWaErjnYydibiaqBrs70wQ8P6axvC2FbWpbQ/132","nickname":"Geek_d3928c","note":"","ucode":"7CB09FD1F7CB23","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552988,"discussion_content":"第一个阶段最开始是代码耦合中 严格绑定业务逻辑","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645679346,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":220327,"user_name":"peter","can_delete":false,"product_type":"c3","uid":1045527,"ip_address":"","ucode":"40F3C798A219D5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f4/17/0bb45a21.jpg","comment_is_top":false,"comment_ctime":1590223239,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100049401,"comment_content":"都是为了解藕更彻底，方便业务开发。","like_count":0},{"had_liked":false,"id":204366,"user_name":"思维决定未来","can_delete":false,"product_type":"c3","uid":1412891,"ip_address":"","ucode":"88CC245B3C6E2D","user_header":"","comment_is_top":false,"comment_ctime":1586392296,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100049401,"comment_content":"好文！","like_count":0}]}