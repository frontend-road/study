{"id":2279,"title":"19 | Docker 容器部署技术 & 持续交付流水线","content":"<p>无</p>\n","comments":[{"had_liked":false,"id":2388,"user_name":"LMD","can_delete":false,"product_type":"c3","uid":1013443,"ip_address":"","ucode":"7626FBB7A4E771","user_header":"","comment_is_top":true,"comment_ctime":1516964879,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"关于《微服务架构核心20讲》课程讲义（PDF 文件），学员可复制下面链接到浏览器下载获取。 http:&#47;&#47;t.cn&#47;RQs9iTw","like_count":6},{"had_liked":false,"id":74014,"user_name":"青梅煮马","can_delete":false,"product_type":"c3","uid":1011735,"ip_address":"","ucode":"D038621CA07BD9","user_header":"https://static001.geekbang.org/account/avatar/00/0f/70/17/93718722.jpg","comment_is_top":false,"comment_ctime":1552063092,"is_pvip":false,"replies":[{"id":27279,"content":"大，云原生是现在也是未来趋势，可以预计后续很多微服务应用会以云原生方式开发和部署。当然这个事情有一个周期，有些企业会慢，有些则快。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1552308939,"ip_address":"","comment_id":74014,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"请问云原生对我们的架构有什么重大影响吗","like_count":5,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442386,"discussion_content":"大，云原生是现在也是未来趋势，可以预计后续很多微服务应用会以云原生方式开发和部署。当然这个事情有一个周期，有些企业会慢，有些则快。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552308939,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":3585,"user_name":"Christophe","can_delete":false,"product_type":"c3","uid":1015119,"ip_address":"","ucode":"3E7BC1D388FF72","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7d/4f/d061cdc9.jpg","comment_is_top":false,"comment_ctime":1519949611,"is_pvip":false,"replies":[{"id":1358,"content":"这门课比较粗以基本概念为主，后继课程逐步细化和案例化，敬请期待","user_name":"作者回复","user_name_real":"晨晖","uid":1000463,"ctime":1522811879,"ip_address":"","comment_id":3585,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"有没有一个程序实例，否则停留在概念上，较难有直观感受。","like_count":5,"discussions":[{"author":{"id":1000463,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/44/0f/abb7bfe3.jpg","nickname":"Geek_4zi01v","note":"","ucode":"6A485218B87E38","race_medal":0,"user_type":4,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":415953,"discussion_content":"这门课比较粗以基本概念为主，后继课程逐步细化和案例化，敬请期待","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1522811879,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57262,"user_name":"王盛武","can_delete":false,"product_type":"c3","uid":1182516,"ip_address":"","ucode":"DE7EF246D3DCE8","user_header":"https://static001.geekbang.org/account/avatar/00/12/0b/34/f41d73a4.jpg","comment_is_top":false,"comment_ctime":1546700824,"is_pvip":false,"replies":[{"id":21537,"content":"1，环境一般有多套，比较规范的有DEV&#47;TEST&#47;STAGING(or UAT)&#47;PRODUCTION\n2，4台绿机，先拉入1台，叫金丝雀或者灰度测试，4台蓝机一次全部切换到4台绿机，叫蓝绿切换，一般生产上两者都有使用场景。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1547453311,"ip_address":"","comment_id":57262,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"波波老师，请教两个问题：\n1、测试环境之前一般有个dev，前后端的配合联调开发环境（不是指单机自己的单元测试工作）\n2、蓝绿+灰度发布，绿色部分的新版本，一般是怎么做？\n比如共有8台生产机，4台蓝， 4台做绿，  绿色的4台是全部更新到最新代码之后，再通过网关路由部分流量进来？\n还是4台绿的里面，先部署1台，观察没问题了再部署第2台绿的呢？","like_count":3,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435495,"discussion_content":"1，环境一般有多套，比较规范的有DEV/TEST/STAGING(or UAT)/PRODUCTION\n2，4台绿机，先拉入1台，叫金丝雀或者灰度测试，4台蓝机一次全部切换到4台绿机，叫蓝绿切换，一般生产上两者都有使用场景。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547453311,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":23485,"user_name":"AFA","can_delete":false,"product_type":"c3","uid":1228333,"ip_address":"","ucode":"4D3CEA4B8DCB1E","user_header":"https://static001.geekbang.org/account/avatar/00/12/be/2d/befd19a6.jpg","comment_is_top":false,"comment_ctime":1536408092,"is_pvip":false,"replies":[{"id":8664,"content":"我也认为docker&#47;k8s是未来微服务持续交付主要手段","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1536641422,"ip_address":"","comment_id":23485,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"您好，老师，docker和kubernetes是不是未来几年微服务的主流？","like_count":3,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423584,"discussion_content":"我也认为docker/k8s是未来微服务持续交付主要手段","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1536641422,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":181646,"user_name":"钱","can_delete":false,"product_type":"c3","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1582603347,"is_pvip":false,"replies":[{"id":74956,"content":"分布式系统数据一致性是一个很大主题，我会有专门课程讲解。主要方案：\n1. 基于2pc或者tcc的强一致性方案，阿里seata就是这种方案的一个变体实现。\n2. 基于可靠消息的最终一致方案，常用阿里RocketMQ支持事务消息。\n3. 基于saga模式的最终一致方案，常采用可靠消息+服务编排(orchestration)来实现。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1585571275,"ip_address":"","comment_id":181646,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"容器解决了环境一致性问题和实现镜像部署的能力，不过分布式环境下还存在配置不一致性已经多组之间沟通成本加剧的问题，类似这种问题老师有什么解决思路？\n另外，这个课程定位就是讲核心概念，具体实践需要自己去研究源码，老师的角色就是一个山下卖地图的人员，老师可以给你讲讲怎么爬山？地图具体怎么看？不过具体能爬到什么高度，完全有自己觉得。如果爬过其他山，可能感触更深，有人指导给予地图很关键，不过更关键的是行动起来爬起来！","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485065,"discussion_content":"分布式系统数据一致性是一个很大主题，我会有专门课程讲解。主要方案：\n1. 基于2pc或者tcc的强一致性方案，阿里seata就是这种方案的一个变体实现。\n2. 基于可靠消息的最终一致方案，常用阿里RocketMQ支持事务消息。\n3. 基于saga模式的最终一致方案，常采用可靠消息+服务编排(orchestration)来实现。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585571275,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":4010,"user_name":"小何子","can_delete":false,"product_type":"c3","uid":1061106,"ip_address":"","ucode":"6BAE6D020FA69A","user_header":"","comment_is_top":false,"comment_ctime":1521199236,"is_pvip":false,"replies":[{"id":1859,"content":"正在努力制作2018第二季，敬请期待","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1524750194,"ip_address":"","comment_id":4010,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"期待老师的后续作品","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":416164,"discussion_content":"正在努力制作2018第二季，敬请期待","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1524750194,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":20072,"user_name":"dingwood","can_delete":false,"product_type":"c3","uid":1153828,"ip_address":"","ucode":"460EB0C6E8C611","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/24/1e4883c6.jpg","comment_is_top":false,"comment_ctime":1534250206,"is_pvip":false,"replies":[{"id":7239,"content":"服务需要冶理，每家做法不一样，常见有服务治理中心(Service Registry or Repository），集中管理服务元数据（服务接口，文档等），要和研发流程打通，服务必须在治理中心注册才能上线，另外通过调用链监控可呈现运行时服务调用关系。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1534650917,"ip_address":"","comment_id":20072,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"杨老师，请教个问题，对于消费方或调用方来说，我的外部环境有很多微服务，如何确定我什么时候去调用什么服务。完全通过程序员直接的沟通和确认吗？有没有一个统一的展示性的东西，让我一目了然都有哪些微服务。急切盼复","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":422092,"discussion_content":"服务需要冶理，每家做法不一样，常见有服务治理中心(Service Registry or Repository），集中管理服务元数据（服务接口，文档等），要和研发流程打通，服务必须在治理中心注册才能上线，另外通过调用链监控可呈现运行时服务调用关系。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1534650917,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":3622,"user_name":"小何子","can_delete":false,"product_type":"c3","uid":1061106,"ip_address":"","ucode":"6BAE6D020FA69A","user_header":"","comment_is_top":false,"comment_ctime":1520092766,"is_pvip":false,"replies":[{"id":1355,"content":"网关上可以做灰度发布，比如可以用netflix zuul控制蓝绿和灰度（通过定制filter实现），具体细节还是比较复杂的，要看公司的具体运维基础设施体系，一般需要外围系统配合（比如服务动态注册中心），简单留言很难解释清楚，后续会开进一步细化的课程讲解支持灰度蓝绿的发布体系，敬请期待。","user_name":"作者回复","user_name_real":"晨晖","uid":1000463,"ctime":1522811754,"ip_address":"","comment_id":3622,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"请问老师 蓝绿 灰度在网关层需要怎么处理呢？需要掌握哪些技术才能实现？","like_count":1,"discussions":[{"author":{"id":1000463,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/44/0f/abb7bfe3.jpg","nickname":"Geek_4zi01v","note":"","ucode":"6A485218B87E38","race_medal":0,"user_type":4,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":415969,"discussion_content":"网关上可以做灰度发布，比如可以用netflix zuul控制蓝绿和灰度（通过定制filter实现），具体细节还是比较复杂的，要看公司的具体运维基础设施体系，一般需要外围系统配合（比如服务动态注册中心），简单留言很难解释清楚，后续会开进一步细化的课程讲解支持灰度蓝绿的发布体系，敬请期待。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1522811754,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":256708,"user_name":"秦跃","can_delete":false,"product_type":"c3","uid":1126269,"ip_address":"","ucode":"97332397831507","user_header":"https://static001.geekbang.org/account/avatar/00/11/2f/7d/4e6b97f6.jpg","comment_is_top":false,"comment_ctime":1603713085,"is_pvip":false,"replies":[{"id":93906,"content":"微服务不一定需要使用docker，传统物理机和虚拟机都可以部署微服务。\n\n但是docker是新一代的应用交付手段，是一种轻量级的虚拟化机制，它通过镜像解决了环境一致性问题，通过cgroups等解决了运行环境的隔离性问题，这些优点使得docker成为微服务推荐的发布机制。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1604241976,"ip_address":"","comment_id":256708,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100003901,"comment_content":"老师你好，微服务为什么需要docker？具体实战场景是？传统服务部署一个服务在docker感觉不满足使用场景，哪些场景适合啊？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":508091,"discussion_content":"微服务不一定需要使用docker，传统物理机和虚拟机都可以部署微服务。\n\n但是docker是新一代的应用交付手段，是一种轻量级的虚拟化机制，它通过镜像解决了环境一致性问题，通过cgroups等解决了运行环境的隔离性问题，这些优点使得docker成为微服务推荐的发布机制。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604241976,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":206169,"user_name":"Jesse","can_delete":false,"product_type":"c3","uid":1932953,"ip_address":"","ucode":"626E713CE2929B","user_header":"https://static001.geekbang.org/account/avatar/00/1d/7e/99/93f3ece7.jpg","comment_is_top":false,"comment_ctime":1586804840,"is_pvip":false,"replies":[{"id":77413,"content":"从你的描述我还无法判断问题所在，需要进一步了解你的部署架构，请加我微信(bulldog2015，说明来自极客时间)。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1587038975,"ip_address":"","comment_id":206169,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100003901,"comment_content":"波波老师你好，我在feign配置如下：\n@FeignClient(name = AccountConstant.SERVICE_NAME, path = &quot;&#47;&quot;, url = &quot;http:&#47;&#47;localhost:8081&quot;)&#47;\n然后因为不想去指定docker的ip，然后打开了docker-compose 的8081端口，如下：\nports:\n      - 8081:8081\nenvironment:\n      - ACCOUNT_SERVER_PORT # 8081\n\nubuntu环境，IDEA运行正常，但是在Docker中访问feign报错：\nConnection refused (Connection refused) executing GET http:&#47;&#47;localhost:8081&#47;account&#47;getName?name=123\n但是  这个地址 http:&#47;&#47;localhost:8081&#47;account&#47;getName?name=123 在浏览器下是可以访问的。\n\n请问这个是哪里没弄对引起的？\n","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491701,"discussion_content":"从你的描述我还无法判断问题所在，需要进一步了解你的部署架构，请加我微信(bulldog2015，说明来自极客时间)。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587038975,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":4000,"user_name":"正是那朵玫瑰","can_delete":false,"product_type":"c3","uid":1048261,"ip_address":"","ucode":"73D630B654573F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fe/c5/3467cf94.jpg","comment_is_top":false,"comment_ctime":1521162963,"is_pvip":false,"replies":[{"id":1698,"content":"正在努力制作中，2018第二季有体系化系列课程，预计五月初开始上线，再耐心等下","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1524374782,"ip_address":"","comment_id":4000,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100003901,"comment_content":"杨老师好，后续课程什么时候出来呀？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":416158,"discussion_content":"正在努力制作中，2018第二季有体系化系列课程，预计五月初开始上线，再耐心等下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1524374782,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":369771,"user_name":"别看我","can_delete":false,"product_type":"c3","uid":1238707,"ip_address":"福建","ucode":"8F6F014DEB4F7D","user_header":"https://static001.geekbang.org/account/avatar/00/12/e6/b3/a3ae518f.jpg","comment_is_top":false,"comment_ctime":1677918472,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100003901,"comment_content":"灰度发布的时候，数据隔离这块要怎么考虑呢？","like_count":0},{"had_liked":false,"id":54037,"user_name":"zwfec","can_delete":false,"product_type":"c3","uid":1110611,"ip_address":"","ucode":"6BDE8813580E24","user_header":"https://static001.geekbang.org/account/avatar/00/10/f2/53/2af50978.jpg","comment_is_top":false,"comment_ctime":1545788143,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100003901,"comment_content":"一直没明白一个问题，不可能每个docker都有自己的数据库，那么数据字段的发布是什么样的呢？","like_count":0}]}