{"id":154124,"title":"41 | ZooKeeper的Request Processor源码解读","content":"<p><strong>课件和Demo地址</strong></p><p><a href=\"https://gitee.com/geektime-geekbang/geekbang-zk-course\">https://gitee.com/geektime-geekbang/geekbang-zk-course</a></p>","comments":[{"had_liked":false,"id":146507,"user_name":"飞翔","can_delete":false,"product_type":"c3","uid":1068571,"ip_address":"","ucode":"65AF6AF292DAD6","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/1b/f4b786b9.jpg","comment_is_top":false,"comment_ctime":1572562045,"is_pvip":false,"replies":[{"id":56742,"content":" 1. 写wal + fsync wal: SyncRequestProcessor。\n\n 写wal ：https:&#47;&#47;github.com&#47;apache&#47;zookeeper&#47;blob&#47;release-3.5.5&#47;zookeeper-server&#47;src&#47;main&#47;java&#47;org&#47;apache&#47;zookeeper&#47;server&#47;SyncRequestProcessor.java#L122\nfsync wal：https:&#47;&#47;github.com&#47;apache&#47;zookeeper&#47;blob&#47;release-3.5.5&#47;zookeeper-server&#47;src&#47;main&#47;java&#47;org&#47;apache&#47;zookeeper&#47;server&#47;SyncRequestProcessor.java#L178\n\n2. FinalRequestProcessor。\n\nhttps:&#47;&#47;github.com&#47;apache&#47;zookeeper&#47;blob&#47;release-3.5.5&#47;zookeeper-server&#47;src&#47;main&#47;java&#47;org&#47;apache&#47;zookeeper&#47;server&#47;FinalRequestProcessor.java#L112\n\n3. SyncRequestProcessor。\n\n  https:&#47;&#47;github.com&#47;apache&#47;zookeeper&#47;blob&#47;release-3.5.5&#47;zookeeper-server&#47;src&#47;main&#47;java&#47;org&#47;apache&#47;zookeeper&#47;server&#47;SyncRequestProcessor.java#L135\n","user_name":"作者回复","user_name_real":"Geek_215586","uid":1591870,"ctime":1572676858,"ip_address":"","comment_id":146507,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100034201,"comment_content":"老师 对一个写请求 zookeeper 服务端要做的事 1. 写wal 2.写memory datatree 3.不定期snapshot from datatree 对吧， 那这三个步骤分别对应在哪个requestprocessor？","like_count":1,"discussions":[{"author":{"id":1591870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyDiaaDJrwRsdUia9HxA8EuWaDVLr4E1gMG5y2ZTxV7BNUhdNABCmH3GMZTzib796X5duibiaeuRmNXeg/132","nickname":"Geek_215586","note":"","ucode":"5916AC9CC5FBE2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472893,"discussion_content":" 1. 写wal + fsync wal: SyncRequestProcessor。\n\n 写wal ：https://github.com/apache/zookeeper/blob/release-3.5.5/zookeeper-server/src/main/java/org/apache/zookeeper/server/SyncRequestProcessor.java#L122\nfsync wal：https://github.com/apache/zookeeper/blob/release-3.5.5/zookeeper-server/src/main/java/org/apache/zookeeper/server/SyncRequestProcessor.java#L178\n\n2. FinalRequestProcessor。\n\nhttps://github.com/apache/zookeeper/blob/release-3.5.5/zookeeper-server/src/main/java/org/apache/zookeeper/server/FinalRequestProcessor.java#L112\n\n3. SyncRequestProcessor。\n\n  https://github.com/apache/zookeeper/blob/release-3.5.5/zookeeper-server/src/main/java/org/apache/zookeeper/server/SyncRequestProcessor.java#L135\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572676858,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":156789,"user_name":"王盛武","can_delete":false,"product_type":"c3","uid":1182516,"ip_address":"","ucode":"DE7EF246D3DCE8","user_header":"https://static001.geekbang.org/account/avatar/00/12/0b/34/f41d73a4.jpg","comment_is_top":false,"comment_ctime":1574956226,"is_pvip":false,"replies":[{"id":60476,"content":"会的。但是这个时候ZooKeeper还没有给客户端发响应。","user_name":"作者回复","user_name_real":"Geek_215586","uid":1591870,"ctime":1575262170,"ip_address":"","comment_id":156789,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100034201,"comment_content":"如果没到1000个，断电了，那会丢失事务日志？","like_count":0,"discussions":[{"author":{"id":1591870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyDiaaDJrwRsdUia9HxA8EuWaDVLr4E1gMG5y2ZTxV7BNUhdNABCmH3GMZTzib796X5duibiaeuRmNXeg/132","nickname":"Geek_215586","note":"","ucode":"5916AC9CC5FBE2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476233,"discussion_content":"会的。但是这个时候ZooKeeper还没有给客户端发响应。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575262170,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1105854,"avatar":"https://static001.geekbang.org/account/avatar/00/10/df/be/c6f8953f.jpg","nickname":"万事屋","note":"","ucode":"57C08B85373B0D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":100820,"discussion_content":"1000个全都没给响应？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577279173,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2361341,"avatar":"","nickname":"Geek_bd27f3","note":"","ucode":"53C31862383C25","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1105854,"avatar":"https://static001.geekbang.org/account/avatar/00/10/df/be/c6f8953f.jpg","nickname":"万事屋","note":"","ucode":"57C08B85373B0D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334618,"discussion_content":"是的\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607917974,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":100820,"ip_address":"","group_id":0},"score":334618,"extra":""}]}]}]}