{"id":86538,"title":"25 | CSPå¹¶å‘æœºåˆ¶","content":"<h1>è¯¾ä»¶åŠæºä»£ç åœ°å€</h1><p><a href=\"https://gitee.com/geektime-geekbang/go_learning\">https://gitee.com/geektime-geekbang/go_learning</a></p><h2>ä¹¦ç›®æ¨è</h2><p><a href=\"time://mall?url=https%3A%2F%2Fh5.youzan.com%2Fv2%2Fgoods%2F1ycmk3uob0ryw\">ã€Šè®¡ç®—æœºç¨‹åºçš„æ„é€ å’Œè§£é‡Šã€‹</a></p>","comments":[{"had_liked":false,"id":107624,"user_name":"pinteressante","can_delete":false,"product_type":"c3","uid":1007569,"ip_address":"","ucode":"C17A89E655CC84","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5f/d1/faf32296.jpg","comment_is_top":false,"comment_ctime":1561566376,"is_pvip":false,"replies":[{"id":39063,"content":"å¦‚æœä¸sleepï¼Œä¸»åç¨‹é€€å‡ºï¼Œç¨‹åºå°±ç»ˆæ­¢äº†ï¼ˆä»–ä¸ä¼šç­‰å¾…å­åç¨‹ï¼‰","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1561642384,"ip_address":"","comment_id":107624,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"ä¸»æ–¹æ³•æœ€åä¸ºä»€ä¹ˆè¦sleepä¸€ä¸‹","like_count":9,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455592,"discussion_content":"å¦‚æœä¸sleepï¼Œä¸»åç¨‹é€€å‡ºï¼Œç¨‹åºå°±ç»ˆæ­¢äº†ï¼ˆä»–ä¸ä¼šç­‰å¾…å­åç¨‹ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561642384,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78120,"user_name":"è¾‰ä»”lovers","can_delete":false,"product_type":"c3","uid":1210219,"ip_address":"","ucode":"3DC5B0CD0B8E71","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLVhJRVwJ0eVlC7zjNfWP6PP7VmUkF1X2m6qfh7Wic3NhAOz2fSGibF6LXLcJ59zOz7nBpCcByvtFjw/132","comment_is_top":false,"comment_ctime":1553074133,"is_pvip":false,"replies":[{"id":28494,"content":"ä½ å¯ä»¥ä¼ å›ä¸€ä¸ªç»“æ„ä½“ï¼Œé‡Œé¢åŒ…å«ç»“æœå’Œé”™è¯¯","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1553087357,"ip_address":"","comment_id":78120,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"è€å¸ˆ ï¼šè¯·æ•™ä¸ªé—®é¢˜ï¼Œgoroutineå¼‚æ­¥æ‰§è¡Œçš„ç»“æœé€šè¿‡channelæ¥é€šçŸ¥ä¸»çº¿ç¨‹ï¼Œæ˜¯ä¸æ˜¯åº”è¯¥æŠŠgoroutineæ‰§è¡Œè¿‡ç¨‹ä¸­çš„errorç­‰ä¿¡æ¯ä¹Ÿæ”¾åˆ°channelè¿”å›ï¼Œå› ä¸ºnodeçš„å¼‚å¸¸æœºåˆ¶éƒ½æ˜¯é€šè¿‡å›è°ƒå‡½æ•°å¸¦å›æ¥çš„ã€‚","like_count":3,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443976,"discussion_content":"ä½ å¯ä»¥ä¼ å›ä¸€ä¸ªç»“æ„ä½“ï¼Œé‡Œé¢åŒ…å«ç»“æœå’Œé”™è¯¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553087357,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":376726,"user_name":"ç¿±ç¿”","can_delete":false,"product_type":"c3","uid":1658287,"ip_address":"åŒ—äº¬","ucode":"F5550D1D0A981A","user_header":"https://static001.geekbang.org/account/avatar/00/19/4d/af/4e922a96.jpg","comment_is_top":false,"comment_ctime":1687272404,"is_pvip":false,"replies":[{"id":138682,"content":"å“ˆå“ˆ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1008262,"ctime":1694307710,"ip_address":"åŒ—äº¬","comment_id":376726,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"è¿˜æ˜¯å–œæ¬¢è€å¸ˆè¾¹è®²è¾¹luä»£ç ï¼Œè¿™æ ·æ’¸å¥½äº†ï¼Œç›´æ¥æ¥ç”¨ï¼Œä¸å¤ªå¥½getåˆ°å†™ä»£ç çš„æ€è·¯å‘€","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":627580,"discussion_content":"å“ˆå“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1694307711,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":331834,"user_name":"æ¶›","can_delete":false,"product_type":"c3","uid":1174992,"ip_address":"","ucode":"0839908E458151","user_header":"https://static001.geekbang.org/account/avatar/00/11/ed/d0/2f18a78b.jpg","comment_is_top":false,"comment_ctime":1642816964,"is_pvip":false,"replies":[{"id":121478,"content":"æ„Ÿè°¢ä¿¡ä»»","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1008262,"ctime":1643332460,"ip_address":"","comment_id":331834,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"éå¸¸æ„Ÿè°¢è€å¸ˆï¼Œçœ‹ç¬¬äºŒéäº†","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548692,"discussion_content":"æ„Ÿè°¢ä¿¡ä»»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643332460,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":229468,"user_name":"IAmLinGe","can_delete":false,"product_type":"c3","uid":1994848,"ip_address":"","ucode":"9DCDA0FA5CF2B0","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/TXAUcbHlPbyEibtUB2STNgmOb6oQdO8nKuA9nnhuI76Ccv2U5Vgxfp8YxvGeKQP8k47ULBwVGglH4DibOzH8Qfeg/132","comment_is_top":false,"comment_ctime":1593007307,"is_pvip":false,"replies":[{"id":84915,"content":"mailbox\n","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1593264070,"ip_address":"","comment_id":229468,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"mailboxè¿˜æ˜¯messageboxï¼Ÿï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499494,"discussion_content":"mailbox\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593264070,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":204226,"user_name":"Geek_8607a4","can_delete":false,"product_type":"c3","uid":1953243,"ip_address":"","ucode":"493EA87394BDD4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epsRcQM1w3rNhv9iaYxz7tDGtFQ6tKCbrjnic2uEAZFyd3TK8Sb24DUic2f845VtP0GnVnfRspwiaH5ug/132","comment_is_top":false,"comment_ctime":1586353944,"is_pvip":false,"replies":[{"id":76616,"content":"ä¸ä¼šã€‚å› ä¸ºç¨‹åºç”¨çš„æ˜¯buffered channelã€‚\nretCh := make(chan string, 1) \næ˜¯ä¸ä¼šé˜»å¡åç¨‹çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1586514485,"ip_address":"","comment_id":204226,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"è€å¸ˆè¿™ä¸ªå¼‚æ­¥æ–¹æ³•å¸¦è¿”å›å€¼çš„æœ‰é—®é¢˜å§ï¼Œè°ƒç”¨æ–¹å¦‚æœä¸æ£€æŸ¥è¿”å›çš„é€šé“ï¼Œé‚£ä¹ˆæ–¹æ³•ä¸­çš„åç¨‹å°±æ³„éœ²äº†","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491110,"discussion_content":"ä¸ä¼šã€‚å› ä¸ºç¨‹åºç”¨çš„æ˜¯buffered channelã€‚\nretCh := make(chan string, 1) \næ˜¯ä¸ä¼šé˜»å¡åç¨‹çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586514485,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":198109,"user_name":"Vicky~å©µå¨Ÿ","can_delete":false,"product_type":"c3","uid":1899341,"ip_address":"","ucode":"E10E28773B60F9","user_header":"https://static001.geekbang.org/account/avatar/00/1c/fb/4d/c5ac9df5.jpg","comment_is_top":false,"comment_ctime":1585409900,"is_pvip":false,"replies":[{"id":75256,"content":"è°¢è°¢ğŸ™","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1585745592,"ip_address":"","comment_id":198109,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"å¾ˆå–œæ¬¢è€å¸ˆçš„è®²è¯¾å†…å®¹å’Œæˆè¯¾æ–¹å¼ï¼Œå¯¹äºæˆ‘è¿™ç§å¯¹goè¯­è¨€0åŸºç¡€çš„äººä¹Ÿå¾ˆå®¹æ˜“ç†è§£å’Œä¸Šæ‰‹","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489648,"discussion_content":"è°¢è°¢ğŸ™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585745592,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114988,"user_name":"é¥­å›¢","can_delete":false,"product_type":"c3","uid":1332557,"ip_address":"","ucode":"E24F240CC91BE8","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erbY9UsqHZhhVoI69yXNibBBg0TRdUVsKLMg2UZ1R3NJxXdMicqceI5yhdKZ5Ad6CJYO0XpFHlJzIYQ/132","comment_is_top":false,"comment_ctime":1563443145,"is_pvip":false,"replies":[{"id":42065,"content":"å¦‚æœä¸æ˜¯buffer chanï¼Œåœ¨å‘é€æ—¶æ— æ¥æ”¶è€…æˆ–è€…buffer chanä¸­çš„æ•°æ®å·²ç»æ»¡äº†çš„æ—¶å€™ï¼Œå‘é€è€…æ˜¯ä¼šè¢«é˜»å¡çš„","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1563507817,"ip_address":"","comment_id":114988,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"æˆ‘çš„ç†è§£æ˜¯ åœ¨åç¨‹é‡Œå§æ•°æ®å†™å…¥ç®¡é“å  åç¨‹å°±ç»§ç»­å¾€ä¸‹æ‰§è¡Œäº†   åç¨‹ä¸éœ€è¦ç­‰å¾…ç®¡é“é‡Œçš„æ•°æ®è¢«æå–\nfunc service() string {\n\ttime.Sleep(time.Millisecond * 110)\n\tfmt.Println(&quot;service end&quot;)\n\treturn &quot;service action call&quot;\n}\n\nfunc sendMessage() chan string {\n\tMchannel := make(chan string)\n\tgo func() {\n\t\tfmt.Println(&quot;service in.&quot;)\n\t\tret := service()\n\t\tMchannel &lt;- ret\n\t\tfmt.Println(&quot;service exited.&quot;)\n\t}()\n\treturn Mchannel\n}\n\nservice exited.  è¿™å¥è¾“å‡º ä¼šåœ¨ service action call å‰è¾“å‡º","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458916,"discussion_content":"å¦‚æœä¸æ˜¯buffer chanï¼Œåœ¨å‘é€æ—¶æ— æ¥æ”¶è€…æˆ–è€…buffer chanä¸­çš„æ•°æ®å·²ç»æ»¡äº†çš„æ—¶å€™ï¼Œå‘é€è€…æ˜¯ä¼šè¢«é˜»å¡çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563507817,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101267,"user_name":"Eden","can_delete":false,"product_type":"c3","uid":1197733,"ip_address":"","ucode":"BE0AD731E5EF5E","user_header":"https://static001.geekbang.org/account/avatar/00/12/46/a5/51449de6.jpg","comment_is_top":false,"comment_ctime":1559766280,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"åˆå­¦è¯­è¨€ï¼Œç”¨ä¸­æ–‡è§£é‡Šï¼Œä¾¿äºç†è§£\n```go\nfunc service() string {\n\tfmt.Println(&quot;---service---ç«‹å³æ‰§è¡Œ 50 æ¯«ç§’å»¶æ—¶&quot;)\n\ttime.Sleep(time.Millisecond * 50)\n\treturn &quot;---service---Done&quot;\n}\n\nfunc otherTask() {\n\tfmt.Println(&quot;---otherTask---working on something else&quot;)\n\tfmt.Println(&quot;---otherTask---ç«‹å³æ‰§è¡Œ 100 æ¯«ç§’å»¶æ—¶&quot;)\n\ttime.Sleep(time.Millisecond * 100)\n\tfmt.Println(&quot;---otherTask---Task is Done&quot;)\n}\n\nfunc AsyncService() chan string { &#47;&#47; è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªé€šé“, æ¶ˆæ¯ç±»å‹æ˜¯ string\n\t&#47;&#47; retCh := make(chan string)    &#47;&#47; å£°æ˜ä¸€ä¸ªæ— ç¼“å†² chané€šé“, è¿™ä¸ªé€šé“çš„ç±»å‹æ˜¯ string, é€šé“ç”¨äºåç¨‹é—´çš„é€šä¿¡\n\t&#47;&#47;                               &#47;&#47; âš ï¸ ä½¿ç”¨æ— ç¼“å†²é€šé“æ—¶, å¦‚æœåç¨‹1 æ²¡æœ‰ç«‹å³æ¥å—åç¨‹ 2 é€šè¿‡ç®¡é“å‘é€çš„æ¶ˆæ¯ï¼Œå°±ä¼šé˜»å¡ï¼Œåä¹‹äº¦ç„¶\n\tretCh := make(chan string, 1) &#47;&#47; å£°æ˜ä¸€ä¸ªç¼“å†²å®¹é‡ä¸º 1 çš„chané€šé“, è¿™ä¸ªé€šé“çš„ç±»å‹æ˜¯ string, é€šé“ç”¨äºåç¨‹é—´çš„é€šä¿¡\n\tgo func() {                   &#47;&#47; æ­¤å¤„æ‰§è¡Œ åŒ¿ååç¨‹å‡½æ•°\n\t\tret := service()\n\t\tfmt.Println(&quot;---AsyncService---returned result:&quot;, ret)\n\t\tretCh &lt;- ret &#47;&#47;é€šè¿‡é€šé“å°† service()å‡½æ•°è¿”å›çš„å€¼ä¼ é€’ç»™  é€šé“ retCh\n\t\tfmt.Println(&quot;---AsyncService---service exited&quot;)\n\t}()\n\treturn retCh &#47;&#47; è¿”å›è¿™ä¸ªé€šé“\n}\n\nfunc TestAsyncService(t *testing.T) {\n\tretCh := AsyncService()\n\totherTask()\n\tfmt.Println(&lt;-retCh)\n}\n\n```","like_count":19},{"had_liked":false,"id":78441,"user_name":"è¾‰ä»”lovers","can_delete":false,"product_type":"c3","uid":1210219,"ip_address":"","ucode":"3DC5B0CD0B8E71","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLVhJRVwJ0eVlC7zjNfWP6PP7VmUkF1X2m6qfh7Wic3NhAOz2fSGibF6LXLcJ59zOz7nBpCcByvtFjw/132","comment_is_top":false,"comment_ctime":1553148498,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"type Promise struct{\n\twg sync.WaitGroup\n\tres string\n\terr error\n}\n\nfunc NewPromise(f func() (string ,error)) *Promise{\n\tp := &amp;Promise{}\n\tp.wg.Add(1)\n\tgo func(){\n\t\tp.res, p.err = f()\n\t\tp.wg.Done()\n\t}()\n\treturn p\n}\n\nfunc (p *Promise) then(r func(string), e func(error))(*Promise){\n\tgo func(){\n\t\tp.wg.Wait()\n\t\tif p.err != nil{\n\t\t\te(p.err)\n\t\t\treturn\n\t\t}\n\t\tr(p.res)\n\t}()\n\treturn p\n}\nä½¿ç”¨goæ¨¡ä»¿çš„å¼‚æ­¥promise","like_count":5},{"had_liked":false,"id":121341,"user_name":"ç“¶ç›–è¶³çƒç±»ä¼¼","can_delete":false,"product_type":"c3","uid":1373150,"ip_address":"","ucode":"FF70BEFF553665","user_header":"https://static001.geekbang.org/account/avatar/00/14/f3/de/2ebdc487.jpg","comment_is_top":false,"comment_ctime":1565103048,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œå­¦ä¹ æœ¬èŠ‚è¯¾ç¨‹åï¼Œæµ‹è¯•å¹¶æ€»ç»“å¦‚ä¸‹ï¼š\n    1. è‹¥åˆ›å»ºé€šé“æ—¶æœªè®¾ç½®é€šé“å®¹é‡ï¼Œåˆ™åç¨‹åœ¨å‘é€šé“ä¸­å­˜æ”¾æ•°æ®åä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°å…¶å®ƒåç¨‹å–èµ°æ•°æ®åæ‰ä¼šå‘ä¸‹æ‰§è¡Œï¼›\n    2. è‹¥åˆ›å»ºé€šé“æ—¶è®¾ç½®é€šé“å®¹é‡ï¼Œåˆ™åç¨‹åœ¨å‘é€šé“ä¸­å­˜æ”¾æ•°æ®åä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œï¼›\n    3. åœ¨å‘é€šé“ä¸­å­˜æ”¾æ•°æ®æ—¶ï¼Œè‹¥é€šé“å·²æ»¡ï¼Œåˆ™å½“å‰åç¨‹ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°é€šé“ç©ºé—²ï¼›\n    4. åœ¨ä»é€šé“ä¸­è¯»å–æ•°æ®æ—¶ï¼Œè‹¥é€šé“ä¸­ä¸å­˜åœ¨æ•°æ®ï¼Œåˆ™å½“å‰åç¨‹ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°å…¶å®ƒåç¨‹å‘é€šé“ä¸­å­˜æ”¾æ•°æ®ã€‚\n    5. å½“4å‘ç”Ÿæ—¶ï¼Œè‹¥æ²¡æœ‰åç¨‹å‘è¯¥é€šé“å­˜æ”¾æ•°æ®ï¼Œåˆ™ä¼šç…§æˆç¨‹åºæ­»é”ã€‚\n\næœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œçƒ¦è¯·è€å¸ˆæ–§æ­£ã€‚","like_count":4},{"had_liked":false,"id":297248,"user_name":"Geek_ab2b44","can_delete":false,"product_type":"c3","uid":1358225,"ip_address":"","ucode":"17CE6624374E3F","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJnfEgoyUEPw8dvMVz42K1nt1YIoOt5dIH8onNE1db4N4ViaOFjv8uPxkguCJ414IyYILqpkeRAzfA/132","comment_is_top":false,"comment_ctime":1623393289,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"è€å¸ˆåœ¨å†™demoçš„æ—¶å€™ï¼Œfmt çš„msg å¯ä»¥æ·»åŠ ä¸€äº›ä¸æ–¹æ³•ç›¸å…³çš„messageï¼Œå¯ä»¥ä»æ—¥å¿—èƒ½æ›´æ˜ç¡®æ—¥å¿—æ˜¯ä»å“ªä¸ªå‡½æ•°å‡ºæ¥çš„ï¼Œç°åœ¨è¿™ç§æ–¹å¼ï¼Œdone, task doneç­‰ç­‰çš„æ—¥å¿—ï¼Œå†åŠ ä¸Šçª—å£æ»šåŠ¨ï¼Œæˆ‘éƒ½è®°ä¸ä½è°æ˜¯è°äº†ï¼Œè™½ç„¶å¤šçœ‹ä¸¤éèƒ½æ˜ç™½ï¼Œå“ˆå“ˆã€‚","like_count":2},{"had_liked":false,"id":333402,"user_name":"å†è§ç†æƒ³","can_delete":false,"product_type":"c3","uid":1245999,"ip_address":"","ucode":"FAC88B3F6F6DFD","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/2f/0a5e0751.jpg","comment_is_top":false,"comment_ctime":1644327990,"is_pvip":false,"replies":null,"discussion_count":2,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"ä¸ºä»€ä¹ˆæˆ‘æ‰§è¡Œç¬¬ä¸€ç§æ²¡æœ‰é˜»å¡å•Š å’Œåé¢è®¾ç½®1çš„æ•ˆæœä¸€æ ·","like_count":1,"discussions":[{"author":{"id":1120078,"avatar":"https://static001.geekbang.org/account/avatar/00/11/17/4e/a264b1ec.jpg","nickname":"zxf","note":"","ucode":"8C8D5A6BDBDC64","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582178,"discussion_content":"æˆ‘ä¹Ÿæ˜¯ä½ è¿™ç§æƒ…å†µï¼Œåæ¥æŠŠsleepæ”¹æˆ2ç§’å°±æ­£å¸¸äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659277415,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ¹–å—","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2834946,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/42/02/7c9d5339.jpg","nickname":"ksl","note":"","ucode":"206906DBB07AE1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1120078,"avatar":"https://static001.geekbang.org/account/avatar/00/11/17/4e/a264b1ec.jpg","nickname":"zxf","note":"","ucode":"8C8D5A6BDBDC64","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":625661,"discussion_content":"ä¸è¦è¢«fmt æˆ–è€… t.log è¿·æƒ‘  chan æ¥åˆ°æ¶ˆæ¯ åˆ° æ‰“å°æ—¥å¿— è¿™è¿˜æœ‰ä¸€æ®µè·¯è¦èµ° \nå“ªè¾¹èµ°çš„å¿«è¿™ä¸ªä¸ä¸€å®šçš„  ä¸¤å›äº‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1692028205,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":582178,"ip_address":"ä¸Šæµ·","group_id":0},"score":625661,"extra":""}]}]},{"had_liked":false,"id":156830,"user_name":"ç å†œKevinäº®","can_delete":false,"product_type":"c3","uid":1116630,"ip_address":"","ucode":"D34562461CA0A1","user_header":"https://static001.geekbang.org/account/avatar/00/11/09/d6/5f366427.jpg","comment_is_top":false,"comment_ctime":1574986517,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"æ„Ÿè§‰å°±åƒä¸ªå†…åµŒç‰ˆçš„æ¶ˆæ¯é˜Ÿåˆ—","like_count":1,"discussions":[{"author":{"id":1435172,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e6/24/30806a88.jpg","nickname":"right-chen","note":"","ucode":"E0E940E80E7A2D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582971,"discussion_content":"å°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„ç»“æ„ï¼Œå…ˆè¿›å…ˆå‡ºã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659855603,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353700,"user_name":"right-chen","can_delete":false,"product_type":"c3","uid":1435172,"ip_address":"åŒ—äº¬","ucode":"E0E940E80E7A2D","user_header":"https://static001.geekbang.org/account/avatar/00/15/e6/24/30806a88.jpg","comment_is_top":false,"comment_ctime":1659687584,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"è¿™ä¸ªchannelæœ‰ç‚¹åƒæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¦‚æœé˜Ÿåˆ—å®¹é‡1çš„è¯ï¼Œéœ€è¦å‘é€ç­‰å¾…æ¶ˆè´¹ã€‚å¦‚æœå®¹é‡å¤§äº1çš„è¯ï¼Œå¯ä»¥å…ˆç”Ÿäº§ï¼Œå†æ¶ˆè´¹ã€‚ç»“æœæ˜¯å…ˆè¿›å…ˆå‡ºã€‚å…³äºå¼‚æ­¥ä»»åŠ¡è¿™å—æ˜¯è¿™ä¹ˆç†è§£çš„","like_count":0},{"had_liked":false,"id":346082,"user_name":"å°‘å¹´","can_delete":false,"product_type":"c3","uid":1994249,"ip_address":"","ucode":"15FC16DEEF13B0","user_header":"https://static001.geekbang.org/account/avatar/00/1e/6e/09/4aa5fbc2.jpg","comment_is_top":false,"comment_ctime":1652808468,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"è®©æˆ‘æƒ³èµ·äº†æ“ä½œç³»ç»Ÿé‡Œçš„è¿›ç¨‹ç®¡ç†-è¿›ç¨‹çš„é€šä¿¡æ–¹å¼ï¼š1ï¼šå…±äº«å†…å­˜ï¼›2ï¼šæ¶ˆæ¯ä¼ é€’ï¼›3ï¼šç®¡é“é€šä¿¡","like_count":0},{"had_liked":false,"id":344141,"user_name":"æ€»æœ‰åˆæ°‘æƒ³å®³æœ•","can_delete":false,"product_type":"c3","uid":1492500,"ip_address":"","ucode":"2EA4E4CA6A28E7","user_header":"https://static001.geekbang.org/account/avatar/00/16/c6/14/cbbdb191.jpg","comment_is_top":false,"comment_ctime":1651297794,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"å”‰ è¿™ä¸€èŠ‚è®²çš„\n","like_count":0},{"had_liked":false,"id":307278,"user_name":"braincy","can_delete":false,"product_type":"c3","uid":1467619,"ip_address":"","ucode":"B1DE2447CD5102","user_header":"https://static001.geekbang.org/account/avatar/00/16/64/e3/6e469d05.jpg","comment_is_top":false,"comment_ctime":1629000585,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"ä¸»å‡½æ•°ä¸éœ€è¦ sleep å§ï¼Œä» channel ä¸­å–æ•°æ®ä¸æ˜¯é˜»å¡çš„å—ï¼Œæˆ‘å»æ‰äº†è¿è¡Œä¹Ÿæ˜¯æ­£å¸¸çš„","like_count":0},{"had_liked":false,"id":252650,"user_name":"Shadow","can_delete":false,"product_type":"c3","uid":1233631,"ip_address":"","ucode":"AC67D583C6B4D7","user_header":"https://static001.geekbang.org/account/avatar/00/12/d2/df/381fb327.jpg","comment_is_top":false,"comment_ctime":1602420568,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"å’Œlinuxçš„æ¶ˆæ¯é˜Ÿåˆ—å¾ˆåƒ","like_count":0},{"had_liked":false,"id":250847,"user_name":"Geek_427d0c","can_delete":false,"product_type":"c3","uid":1876823,"ip_address":"","ucode":"D7A04138C4B8CB","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/X4ib36ADEvj76XaKD4OUY9k15KqWCAVCwibPicBxz6BBUfDrVolpYInn8zFOw3JBPtVw3L4Lkibaf2eLPemwGKzAXA/132","comment_is_top":false,"comment_ctime":1601260408,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"Goçš„åç¨‹æœ‰ä¸¤ç‚¹è·Ÿæˆ‘æƒ³çš„ä¸ä¸€æ ·ï¼š1ï¼‰channelâ€œæ²¡æœ‰æ¶ˆè´¹â€ä¹Ÿä¼šæ‰§è¡Œï¼Œå³æŠŠ`&lt;-retCh`å»æ‰ä¹Ÿä¼šæ­£å¸¸è¾“å‡ºæ‰€æœ‰Printlnï¼Œ2)ä¸€ä¸ªåç¨‹é‡Œgo func() {xxx}çš„xxxæ˜¯é¡ºåºæ‰§è¡Œçš„ï¼Œå³å…ˆservice()æ‰§è¡Œå®Œæˆï¼Œå†retCh &lt;- retã€‚","like_count":0},{"had_liked":false,"id":236007,"user_name":"æ–°ä»”","can_delete":false,"product_type":"c3","uid":2061942,"ip_address":"","ucode":"830DD6BCA39DD2","user_header":"https://static001.geekbang.org/account/avatar/00/1f/76/76/6d523a36.jpg","comment_is_top":false,"comment_ctime":1595289618,"is_pvip":false,"replies":null,"discussion_count":4,"race_medal":0,"score":4,"product_id":100024001,"comment_content":"è€å¸ˆæ‚¨å¥½~åˆå­¦golang è¯·é—®ä¸ºä»€ä¹ˆè¿™æ ·çš„ç¨‹åºæœ€åä¼šæ­»é”\n\tarr:=[]int{1,2,3,4,5}\n\tc:=make(chan int,5)\n\tfin:=make(chan int,3)\n\tcl:=make(chan int,1)\n\tdefer close(fin)\n\tdefer close(cl)\n\tdefer close(c)\n\tgo func() {\n\t\tfor _,ch:=range arr{\n\t\t\tc&lt;-ch\n\t\t}\n\t}()\n\tfor i:=0;i&lt;3;i++{\n\t\tgo func() {\n\t\t\tfor{\n\t\t\t\tclassId:=&lt;-c\n\t\t\t\ttime.Sleep(time.Second)\n\t\t\t\tfin&lt;-classId\n\t\t\t}\n\t\t}()\n\t}\n\tgo func() {\n\t\tfor classId:=range fin{\n\t\t\tfmt.Printf(&quot;classId %d finished \\n&quot;,classId)\n\t\t}\n\t\tcl&lt;-1\n\t}()\n\t&lt;-cl\n\tfmt.Println(&quot;all done&quot;)","like_count":0,"discussions":[{"author":{"id":2890901,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/1c/95/3d8920c9.jpg","nickname":"abcdabcd999","note":"","ucode":"E1D9902737F544","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600728,"discussion_content":"å°½åŠ›äº†å…„å¼Ÿï¼Œä½ è¿™ä»£ç è®©æˆ‘å¾ˆè¿·èŒ«","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1674794029,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å±±è¥¿","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2890901,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/1c/95/3d8920c9.jpg","nickname":"abcdabcd999","note":"","ucode":"E1D9902737F544","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600725,"discussion_content":"å¦‚æœé‡‡ç”¨ä¸‹é¢çš„ä»£ç ï¼Œçœ‹èµ·æ¥æ²¡æœ‰è¿èƒŒè¿™ä¸ªè€å“¥çš„æ„æ„¿ï¼Œä½†æ˜¯è¿™ä¸ªç¨‹åºå®é™…ä¸Šå­˜åœ¨æ¦‚ç‡æ€§çš„é”™è¯¯ï¼Œä½ å¯ä»¥è¯•ç€è¿è¡Œä¸‹é¢è¿™æ®µä»£ç ï¼Œä½ ä¼šå‘ç°å®ƒæœ‰æ—¶æ­£ç¡®ï¼Œæœ‰æ—¶é”™è¯¯ï¼Œå¹¶ä¸”é”™è¯¯ä¸å†æ˜¯ deadlockï¼Œè€Œæ˜¯ â€œpanic: send on closed channelâ€ï¼Œwhyï¼Ÿ\n\nfunc main() {\n\tarr := []int{1, 2, 3, 4, 5}\n\tc := make(chan int, 5)\n\tfin := make(chan int, 3)\n\tcl := make(chan int, 1)\n\twg := new(sync.WaitGroup)\n\tvar once = new(sync.Once)\n\n\tdefer close(cl)\n\n\twg.Add(1)\n\tgo func() {\n\t\tfor _, ch := range arr {\n\t\t\tc &lt;- ch\n\t\t}\n\t\tclose(c)\n\t\twg.Done()\n\t}()\n\n\twg.Add(3)\n\tfor i := 0; i &lt; 3; i++ {\n\t\tgo func() {\n\t\t\tfor {\n\t\t\t\tif classId, ok := &lt;-c; ok {\n\t\t\t\t\t// time.Sleep(time.Second)\n\t\t\t\t\tfin &lt;- classId\n\t\t\t\t} else {\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t\tonce.Do(func() { close(fin) })\n\t\t\twg.Done()\n\t\t}()\n\t}\n\twg.Add(1)\n\tgo func() {\n\t\tdefer wg.Done()\n\t\tfor classId := range fin {\n\t\t\tfmt.Printf(&#34;classId %d finished \\n&#34;, classId)\n\t\t}\n\t\tcl &lt;- 1\n\t}()\n\tcl &lt;- 1\n\t&lt;-cl\n\twg.Wait()\n\tfmt.Println(&#34;all done&#34;)\n}\n\näº§ç”Ÿè¿™æ®µä»£ç çš„é”™è¯¯åŸå› æ˜¯ï¼šä¸€ä¸ªé€šé“æœ‰å¤šä¸ªå†™ goroutineï¼Œä½ çœ‹ä¸‹é¢çš„ä»£ç ï¼Œ\nfor i := 0; i &lt; 3; i++ {\n\t\tgo func() {\n\t\t\tfor {\n\t\t\t\tif classId, ok := &lt;-c; ok {\n\t\t\t\t\t// time.Sleep(time.Second)\n\t\t\t\t\tfin &lt;- classId\n\t\t\t\t} else {\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\t\t\tonce.Do(func() { close(fin) })\n\t\t\twg.Done()\n\t\t}()\n\t}\nè¿™é‡Œå®é™…ä¸Šæœ‰ä¸‰ä¸ª goroutiine å†å‘ fin send æ•°æ®ï¼Œè¿™å¾ˆä¸å¥½ï¼Œæœ€å¥½è¿˜æ˜¯è¯»å†™å„ä¸€ä¸ªåç¨‹","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1674792897,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å±±è¥¿","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2890901,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/1c/95/3d8920c9.jpg","nickname":"abcdabcd999","note":"","ucode":"E1D9902737F544","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600685,"discussion_content":"ä¸Šé¢çš„ç¨‹åºå…¶å®åªéœ€è¦ä¿®æ”¹ä¸€æ­¥å°±èƒ½è¿è¡Œï¼Œä½†æ˜¯è¿è¡Œç»“æœåº”è¯¥å’Œè¿™ä¸ªè€å“¥çš„æƒ³æ³•ä¸ä¸€è‡´ã€‚\n1. æ— è®ºå¦‚ä½•ä¸»çº¿ç¨‹éƒ½ä¸èƒ½è¢«é˜»å¡\nfunc main() {\n\tarr := []int{1, 2, 3, 4, 5}\n\tc := make(chan int, 5)\n\tfin := make(chan int, 3)\n\tcl := make(chan int, 1)\n\tdefer close(fin)\n\tdefer close(cl)\n\tdefer close(c)\n\tgo func() {\n\t\tfor _, ch := range arr {\n\t\t\tc &lt;- ch\n\t\t}\n\t}()\n\tfor i := 0; i &lt; 3; i++ {\n\t\tgo func() {\n\t\t\tfor {\n\t\t\t\tclassId := &lt;-c\n\t\t\t\ttime.Sleep(time.Second)\n\t\t\t\tfin &lt;- classId\n\t\t\t}\n\t\t}()\n\t}\n\tgo func() {\n\t\tfor classId := range fin {\n\t\t\tfmt.Printf(&#34;classId %d finished \\n&#34;, classId)\n\t\t}\n\t\tcl &lt;- 1\n\t}()\n\t&lt;-cl // è¿™é‡Œå¯¼è‡´ä¸»çº¿ç¨‹é˜»å¡ï¼ŒæŠŠè¿™å¥æ³¨é‡Šæ‰\n\tfmt.Println(&#34;all done&#34;)\n}\n\nç”±äº cl channel æ²¡æœ‰æ”¾å…¥æ•°æ®ï¼Œè¿™ä¸»è¦æ˜¯æœ‰ç”±äº range fin è¿™ä¸ª goroutine è¢«é˜»å¡äº†ï¼Œ cl &lt;- 1 æ ¹æœ¬å°±æ²¡æœ‰æ‰§è¡Œï¼Œå¦‚æœæ³¨é‡Šæ‰ &lt;-cl è¿™å¥è¯ï¼Œè¿™ä¸ªç¨‹åºèƒ½å¤Ÿæ­£å¸¸ç»“æŸã€‚\n\n2. å¦‚æœä¸åˆ é™¤ &lt;-cl ï¼Œé‚£ä¹ˆå°±éœ€è¦è°ƒæ•´ range finï¼Œè®© fin è¿™ä¸ªchannel çš„è¯»å†™ç­‰åŒï¼Œå°±ä¸ä¼šé˜»å¡ï¼Œ fin channel çš„é˜»å¡å½’æ ¹ç»“åº• classId è¿™ä¸‰ä¸ª goroutine é€ æˆçš„ï¼Œåˆç†è®¾è®¡è¿™äº› goroutine çš„è¡Œä¸ºå°±èƒ½è®©è¿™ä¸ªç¨‹åºæ­£ç¡®","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1674726863,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å±±è¥¿","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2890901,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/1c/95/3d8920c9.jpg","nickname":"abcdabcd999","note":"","ucode":"E1D9902737F544","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600632,"discussion_content":"ä½ è¿™ä¸ªç¨‹åºé—®é¢˜å¾ˆå¤šå•Šï¼Œå…„å¼Ÿï¼Œè¿™çœ‹èµ·æ¥æ ¹æœ¬å°±ä¸æ˜¯ä¸€ä¸ªæœ‰æ„ä¹‰çš„ç¨‹åºå“‡ã€‚\n\n1. åŠæ—¶åœ¨å‘é€æ–¹å…³é—­ channel\ngo func() {\n\t\tfor _,ch:=range arr{\n\t\t\tc&lt;-ch\n\t\t}\n\t}()\nå»ºè®®åœ¨ for å¾ªç¯åå¢åŠ  close(c)ï¼Œå½“ç„¶è¿™ä¸ªä»£ç æ˜¯å¦å…³ç³» c ä¸å½±å“ç»“æœ\n\n2. fin è¢«é˜»å¡ï¼Œç”±äº c å·²ç»æ²¡æœ‰ä»»ä½•æ•°æ®å¯è¯»\nfor i:=0;i&lt;3;i++{\n\t\tgo func() {\n\t\t\tfor{\n\t\t\t\tclassId:=&lt;-c\n\t\t\t\ttime.Sleep(time.Second)\n\t\t\t\tfin&lt;-classId\n\t\t\t}\n\t\t}()\n\t}\n\nè¿™æ®µä»£ç å°†å¼€å¯ä¸‰ä¸ª goroutineï¼Œæ¯ä¸ª goroutine éƒ½åœ¨æ­»å¾ªç¯è·å–ä¸Šä¸€ä¸ª c channel ä¸­çš„æ•°æ®ï¼Œc åªæ”¾äº† 5 ä¸ªæ•°æ®ï¼Œè¿™æ˜¾ç„¶æ¯ä¸ª goroutine éƒ½å°†è¢«é˜»å¡\n\n3. range ä¸€ä¸ªè¢«é˜»å¡çš„ fin channelï¼Œè¿™å°†å¯¼è‡´ deadlockï¼Œä¸” range çš„ fin æœªè¢«æ­£ç¡® closeï¼Œå¯¼è‡´å®ƒä¸€è‡´åœ¨ç­‰\ngo func() {\n\t\tfor classId:=range fin{\n\t\t\tfmt.Printf(&#34;classId %d finished \\n&#34;,classId)\n\t\t}\n\t\tcl&lt;-1 // å®ƒä¸å½±å“\n\t}()\nè¿™ä¸ª èŒƒå›´ for å¾ªç¯å®é™…ä¸Šåšäº†å¦‚ä¸‹æ“ä½œ:\n\nfor{\n    if classId, ok := &lt;-ch; ok{\n         fmt.Printf(&#34;classId %d finished \\n&#34;,classId)\n    }else{\n         break\n    }\n}\n\næˆ‘ä»¬çœ‹åˆ°è¿™é‡Œå®é™…ä¸Š fin è¿Ÿæ—©ä¼šå› ä¸º c æ²¡æœ‰æ–°çš„å€¼è€Œè¢«é˜»å¡\n\nè€Œä¸”æˆ‘ä»¬ä¸èƒ½åœ¨æ¥æ”¶æ–¹å…³é—­ fin\ngo func() {\n               close(fin) // è¿™ä¼šå¯¼è‡´ ä¸Šé¢ fin &lt;- chassId å‘ç”Ÿé”™è¯¯\n\t\tfor classId:=range fin{\n\t\t\tfmt.Printf(&#34;classId %d finished \\n&#34;,classId)\n\t\t}\n\t\tcl&lt;-1 // å®ƒä¸å½±å“\n\t}()\n\n4. è¿è¡Œé”™è¯¯æç¤º\nä½ è¿™æ®µä»£ç æ‰§è¡ŒåæŠ¥é”™ç»“æœé”™è¯¯ stack ä¹Ÿåˆ°äº†ä¸‹é¢è¿™æ®µä»£ç ä¸Šï¼Œè¿™å’Œæˆ‘ä»¬ä¸Šé¢çš„ç»“è®ºä¹Ÿæ˜¯ä¸€è‡´çš„ã€‚\ngo func() {\n\t\tfor classId := range fin {\n\t\t\tfmt.Printf(&#34;classId %d finished \\n&#34;, classId)\n\t\t}\n\t\tcl &lt;- 1\n\t}()\n\n5. é”™è¯¯ç»“æœå¤ç°\nfunc main() {\n\tch := make(chan int)\n\n\tgo func() {\n\t\tfor i := 0; i &lt; 10; i++ {\n\t\t\tch &lt;- i // è¿™é‡Œä¼šé˜»å¡ç­‰å¾…è¯»å–\n\t\t}\n\t}()\n\tfor val := range ch {\n\t\tfmt.Println(val)\n\t}\n}\n\nè¿™æ®µä»£ç æŠ¥é”™ï¼Œæ”¹æˆä¸‹é¢ä»£ç åæ­£ç¡®\n\nfunc main() {\n\tch := make(chan int)\n\n\tgo func() {\n\t\tfor i := 0; i &lt; 10; i++ {\n\t\t\tch &lt;- i\n\t\t}\n\t\tclose(ch)\n\t}()\n\tfor val := range ch {\n\t\tfmt.Println(val)\n\t}\n}\n\nè¿™ä¸ªä»£ç çš„æ„å›¾æˆ‘è§‰å¾—è¿™ä½åŒå­¦éå¸¸ä¸æ¸…æ¥š","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1674650874,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å±±è¥¿","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":207355,"user_name":"Alvin-L","can_delete":false,"product_type":"c3","uid":1603052,"ip_address":"","ucode":"5AC96AAB75B720","user_header":"https://static001.geekbang.org/account/avatar/00/18/75/ec/c60b29f5.jpg","comment_is_top":false,"comment_ctime":1587053687,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100024001,"comment_content":"\n&#47;&#47; ä»¥ä¸Šå‡½æ•°é¦–å…ˆä¼šè°ƒç”¨AsyncService()ï¼Œå³å»ºç«‹é€šé“æ¥æ”¶å€¼ï¼Œå¹¶å¼€å¯ä¸€ä¸ªåç¨‹ï¼Œ\n&#47;&#47; åç¨‹é‡Œæ‰§è¡Œret := service(){ç­‰å¾…50æ¯«ç§’åè¿”å›å€¼&quot;Done&quot;}ã€‚ã€‚ã€‚ç­‰ç­‰\n&#47;&#47; ä½†æ˜¯è¿™æ—¶å€™ä¸å½±å“ä¸»çº¿ç¨‹çš„è¿è¡Œï¼Œæ‰€ä»¥ä¸»çº¿ç¨‹çš„ otherTask()ç´§æ¥ç€è¿è¡Œï¼Œ\n&#47;&#47; é¦–å…ˆæ‰“å°working on something elseå¹¶ç¡100æ¯«ç§’åç»§ç»­æ‰“å°&quot;otherTask is done.&quot;(æš‚æ—¶ä¸ä¼šæ‰“å°)\n&#47;&#47; è¿™ç¡100æ¯«ç§’æœŸé—´åç¨‹æ˜¯åŒæ—¶è¿è¡Œçš„ï¼Œå³ service(){ç­‰å¾…50æ¯«ç§’åè¿”å›å€¼&quot;Done&quot;}å®Œæˆåï¼Œä¼šæ‰“å°&quot;returned result.&quot;\n&#47;&#47; ç„¶åå°†è¿”å›å€¼&quot;Done&quot;äº¤ç»™é€šé“{retCh &lt;- ret}\n&#47;&#47; ç„¶åæ‰“å°&quot;service exited.&quot;ï¼Œ\n&#47;&#47; ä¸»çº¿ç¨‹ç”±äºè¿˜åœ¨ç¡100æ¯«ç§’ï¼Œåœ¨ç¡é†’åï¼Œä¼šæ‰“å°otherTask is done.\n&#47;&#47; æ¥ç€ä¼šä»é€šé“é‡Œæ‹¿å‡ºæœªæ¥å€¼å¹¶æ‰“å°{fmt.Println(&lt;-retCh)}\n&#47;&#47; å¦ä¸€ä¸ªæƒ…å†µ\n&#47;&#47; ç”±äºé€šé“retChæ˜¯ç”±AsyncService()ç”Ÿæˆçš„ï¼Œæ‰€ä»¥å¦‚æœåœ¨AsyncService()æ²¡æœ‰è·‘å®Œä¹‹å‰(æ›´æ¢å„è‡ªç¡çœ æ—¶é—´)ï¼Œ\n&#47;&#47; ä¸»ç¨‹åºå¦‚æœæƒ³ä»é€šé“é‡Œè·å–å€¼(&lt;-retCh)ä¼šé˜»å¡ï¼Œæ­¤æ—¶çš„ä¸»çº¿ç¨‹ä¼šé˜»å¡ï¼Œä¸€ç›´ç­‰å¾…é€šé“çš„å€¼&quot;Done&quot;\n&#47;&#47; ç›´åˆ°é€šé“é‡Œæœ‰å€¼&quot;Done&quot;åï¼Œæ‰ä¼šæ‰“å°\n&#47;&#47; å†å¦ä¸€ä¸ªæƒ…å†µ\n&#47;&#47; å¦‚æœä½¿ç”¨æ— ç¼“å†²é€šé“{make(chan string)}ï¼Œé‚£ä¹ˆåœ¨ä¸»çº¿ç¨‹ï¼ˆæˆ–è€…å…¶ä»–çº¿ç¨‹ï¼‰æ²¡æœ‰è·å–ç®¡é“çš„å€¼çš„æ—¶å€™ï¼Œç®¡é“ä¼šå‘ç”Ÿé˜»å¡\n&#47;&#47; æ­¤æ—¶ä¼šå…ˆæ‰“å°Doneï¼Œå†æ‰“å°&quot;service exited.&quot;ï¼Œè¿™ç§æ–¹æ³•ä¼šé™ä½åç¨‹å¤„ç†æ€§èƒ½ï¼Œ\n&#47;&#47; é™¤éæœ‰ç‰¹å®šä¸šåŠ¡åœºæ™¯ï¼Œå¦åˆ™å°½é‡ç”¨æœ‰ç¼“å†²ï¼Œå°½é‡ä¸ç”¨æ— ç¼“å†²","like_count":0},{"had_liked":false,"id":195284,"user_name":"å°è™","can_delete":false,"product_type":"c3","uid":1033083,"ip_address":"","ucode":"31438B30CF7910","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/GkMk4gBlfZcljsY3Vqu7w8ZkxBfe8WTz1ySnPTJARKXF0FpCr3HqlicIHQlItib9m7iaxLESkmBNpoiaY81EUUzQrA/132","comment_is_top":false,"comment_ctime":1585153733,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":4,"product_id":100024001,"comment_content":"é€šé“ç±»ä¼¼äºjavaé‡Œé¢çš„futuerï¼Œå¼‚æ­¥åå›ç»“æœï¼Œå¦‚æœåŠ ä¸Šbufferå®¹é‡ä¼šæ›´é«˜æ•ˆã€‚","like_count":0,"discussions":[{"author":{"id":2890901,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/1c/95/3d8920c9.jpg","nickname":"abcdabcd999","note":"","ucode":"E1D9902737F544","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600664,"discussion_content":"future","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1674703810,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å±±è¥¿","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":179411,"user_name":"è‰¾æ–¯æ›¼","can_delete":false,"product_type":"c3","uid":1001772,"ip_address":"","ucode":"B73FA6A2530138","user_header":"https://static001.geekbang.org/account/avatar/00/0f/49/2c/a2a948b6.jpg","comment_is_top":false,"comment_ctime":1581999161,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100024001,"comment_content":"ä½¿ç”¨Channelæ¥é€šä¿¡ç¡®å®ç†è§£è½»æ¾ï¼Œä¸ç”¨è€ƒè™‘é‚£ä¹ˆå¤æ‚çš„åŒæ­¥å¼‚æ­¥é—®é¢˜","like_count":0},{"had_liked":false,"id":131485,"user_name":"ä¸€ç™¾ç“¦ç‰¹å¾®ç¬‘","can_delete":false,"product_type":"c3","uid":1204445,"ip_address":"","ucode":"E270A359775F22","user_header":"https://static001.geekbang.org/account/avatar/00/12/60/dd/b8fef258.jpg","comment_is_top":false,"comment_ctime":1567764285,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100024001,"comment_content":"å›¾ç”»çš„ç”¨å¿ƒ","like_count":0},{"had_liked":false,"id":105272,"user_name":"ç¥–å›½çš„èŠ±æœµ","can_delete":false,"product_type":"c3","uid":1581761,"ip_address":"","ucode":"5896EBB8D523D6","user_header":"https://static001.geekbang.org/account/avatar/00/18/22/c1/c91c4fd6.jpg","comment_is_top":false,"comment_ctime":1560952261,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":4,"product_id":100024001,"comment_content":"å›å¤@å—å®«äº‘é¥å­:\nch := make(chan int) \n1. è¿™æ ·å®šä¹‰å‡ºæ¥çš„æ˜¯ä¸€ä¸ªæ— ç¼“å†²çš„channel, å¿…é¡»è¦æœ‰ä¸€ä¸ªåŒæ—¶å†™ä¸€ä¸ªç­‰å¾…\n2. å¦‚æœä¸²è¡Œæ‰§è¡Œçš„è¯å†™å’Œç­‰å¾…å¹¶ä¸æˆå¯¹, é€ æˆæ­»é”\n3. å¯ä»¥ä½¿ç”¨cap(ch)çœ‹åˆ°åˆ›å»ºå‡ºæ¥çš„channelå®¹é‡ä¸º0\nè§£å†³:\nch := make(chan int, 1) \n1. è¿™æ ·çš„è¯æœ‰ä¸€ä¸ªç¼“å†², å¯ä»¥å…ˆå†™è¿›å»å†å–å€¼","like_count":0,"discussions":[{"author":{"id":1953243,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epsRcQM1w3rNhv9iaYxz7tDGtFQ6tKCbrjnic2uEAZFyd3TK8Sb24DUic2f845VtP0GnVnfRspwiaH5ug/132","nickname":"Geek_8607a4","note":"","ucode":"493EA87394BDD4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":225252,"discussion_content":"æ— ç¼“å†²æœ€ä¸»è¦çš„ç”¨é€”å°±æ˜¯closeä¹‹åï¼Œæ‰€æœ‰ç›‘å¬æ¬¡é€šé“çš„åç¨‹éƒ½ä¼šæ”¶åˆ°é€šçŸ¥ï¼Œå¯ä»¥å»é˜…è¯»ä¸€ä¸‹contextçš„è®¾è®¡ï¼Œå°±æ˜¯è¿™ä¹ˆåº”ç”¨çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586353688,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":88725,"user_name":"å—å®«äº‘é¥å­","can_delete":false,"product_type":"c3","uid":1350610,"ip_address":"","ucode":"356C45EFF11756","user_header":"https://static001.geekbang.org/account/avatar/00/14/9b/d2/08d1dbc8.jpg","comment_is_top":false,"comment_ctime":1555986309,"is_pvip":false,"replies":null,"discussion_count":3,"race_medal":0,"score":4,"product_id":100024001,"comment_content":"channelä¸èƒ½å†™å®Œå°±è¯»å—ï¼Ÿè¿™æ®µä»£ç ä¼šæŠ¥æ­»é”\n```\nfunc main(){\n\tc := make(chan int)\n\tc &lt;- 12\n\ttime.Sleep(2 * time.Second)\n\tch := &lt;-c\n\tfmt.Println(ch)\n}\n```\n```\nfatal error: all goroutines are asleep - deadlock!\n```","like_count":0,"discussions":[{"author":{"id":1112873,"avatar":"https://static001.geekbang.org/account/avatar/00/10/fb/29/ee2982de.jpg","nickname":"é˜¿å¾·","note":"","ucode":"07F66FCDED4CD5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3621,"discussion_content":"æˆ‘åˆ†ææ˜¯è¿™æ ·ï¼Œä½ çš„channelä¸æ˜¯ç¼“å†²channelï¼Œc <- 12 è¿™å¥ä¹‹åå°±é˜»å¡äº†ï¼Œåé¢çš„è¯­å¥éƒ½æ²¡æœ‰æœºä¼šæ‰§è¡Œã€‚æ”¹ä¸ºç¼“å†²channelï¼Œæˆ–æŠŠä»channelå­˜å–å†…å®¹æ”¾åˆ°ä¸åŒçš„åç¨‹é‡Œå°±å¯ä»¥","likes_number":9,"is_delete":false,"is_hidden":false,"ctime":1564643448,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2890901,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/1c/95/3d8920c9.jpg","nickname":"abcdabcd999","note":"","ucode":"E1D9902737F544","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600665,"discussion_content":"ä¸¤ä½éƒ½æ˜¯æ­£è§£ï¼Œè¦ä¹ˆæ”¹æˆ buffered chan è¦ä¹ˆæ”¾å…¥å¦å¤–ä¸€ä¸ª goroutine","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1674703919,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å±±è¥¿","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1435172,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e6/24/30806a88.jpg","nickname":"right-chen","note":"","ucode":"E0E940E80E7A2D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582970,"discussion_content":"æ¥¼ä¸Šè¯´çš„å¯¹ï¼ŒæŠŠâ€œc&lt;-12â€æ”¹ä¸ºâ€œ\n\tgo func() {\n\t\tc &lt;- 12\n\t}()â€å¼‚æ­¥ç¼–ç¨‹å°±å¥½äº†ï¼Œè¿™æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ç¾å¦™ä¹‹å¤„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659855510,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}