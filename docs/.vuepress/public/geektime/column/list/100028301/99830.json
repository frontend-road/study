{"id":99830,"title":"07 | å¸¦ä½ å¿«é€Ÿä¸Šæ‰‹ Lua","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æ¸©é“­ã€‚</p><p>åœ¨å¤§æ¦‚äº†è§£ NGINX çš„åŸºç¡€çŸ¥è¯†åï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±è¦æ¥è¿›ä¸€æ­¥å­¦ä¹  Luaäº†ã€‚å®ƒæ˜¯ OpenResty ä¸­ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€ï¼ŒæŒæ¡å®ƒçš„åŸºæœ¬è¯­æ³•è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚</p><p>Lua æ˜¯ä¸€ä¸ªå°å·§ç²¾å¦™çš„è„šæœ¬è¯­è¨€ï¼Œè¯ç”Ÿäºå·´è¥¿çš„å¤§å­¦å®éªŒå®¤ï¼Œè¿™ä¸ªåå­—åœ¨è‘¡è„ç‰™è¯­é‡Œçš„å«ä¹‰æ˜¯â€œç¾ä¸½çš„æœˆäº®â€ã€‚ä»ä½œè€…æ‰€åœ¨çš„å›½å®¶æ¥çœ‹ï¼ŒNGINX è¯ç”Ÿäºä¿„ç½—æ–¯ï¼ŒLua è¯ç”Ÿäºå·´è¥¿ï¼ŒOpenResty è¯ç”Ÿäºä¸­å›½ï¼Œè¿™ä¸‰é—¨åŒæ ·ç²¾å·§çš„å¼€æºæŠ€æœ¯éƒ½å‡ºè‡ªé‡‘ç –å›½å®¶ï¼Œè€Œä¸æ˜¯æ¬§ç¾ï¼Œä¹Ÿæ˜¯æŒºæœ‰è¶£çš„ä¸€ä»¶äº‹ã€‚</p><p>å›åˆ°Luaè¯­è¨€ä¸Šã€‚äº‹å®ä¸Šï¼ŒLua åœ¨è®¾è®¡ä¹‹åˆï¼Œå°±æŠŠè‡ªå·±å®šä½ä¸ºä¸€ä¸ªç®€å•ã€è½»é‡ã€å¯åµŒå…¥çš„èƒ¶æ°´è¯­è¨€ï¼Œæ²¡æœ‰èµ°å¤§è€Œå…¨çš„è·¯çº¿ã€‚è™½ç„¶ä½ å¹³å¸¸å·¥ä½œä¸­å¯èƒ½æ²¡æœ‰ç›´æ¥ç¼–å†™ Lua ä»£ç ï¼Œä½† Lua çš„ä½¿ç”¨å…¶å®éå¸¸å¹¿æ³›ã€‚å¾ˆå¤šçš„ç½‘æ¸¸ï¼Œæ¯”å¦‚é­”å…½ä¸–ç•Œï¼Œéƒ½ä¼šé‡‡ç”¨ Lua æ¥ç¼–å†™æ’ä»¶ï¼›è€Œé”®å€¼æ•°æ®åº“ Redis åˆ™æ˜¯å†…ç½®äº† Lua æ¥æ§åˆ¶é€»è¾‘ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œè™½ç„¶ Lua è‡ªèº«çš„åº“æ¯”è¾ƒç®€å•ï¼Œä½†å®ƒå¯ä»¥æ–¹ä¾¿åœ°è°ƒç”¨ C åº“ï¼Œå¤§é‡æˆç†Ÿçš„ C ä»£ç éƒ½å¯ä»¥ä¸ºå…¶æ‰€ç”¨ã€‚æ¯”å¦‚åœ¨ OpenResty ä¸­ï¼Œå¾ˆå¤šæ—¶å€™éƒ½éœ€è¦ä½ è°ƒç”¨ NGINX å’Œ OpenSSL çš„ C å‡½æ•°ï¼Œè€Œè¿™éƒ½å¾—ç›Šäº Lua å’Œ LuaJIT è¿™ç§æ–¹ä¾¿è°ƒç”¨ C åº“çš„èƒ½åŠ›ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘å¸¦ä½ æ¥å¿«é€Ÿç†Ÿæ‚‰ä¸‹ Lua çš„æ•°æ®ç±»å‹å’Œè¯­æ³•ï¼Œä»¥ä¾¿ä½ åé¢æ›´é¡ºç•…åœ°å­¦ä¹  OpenRestyã€‚</p><!-- [[[read_end]]] --><h2>ç¯å¢ƒå’Œ hello world</h2><p>æˆ‘ä»¬ä¸ç”¨ä¸“é—¨å»å®‰è£…æ ‡å‡† Lua 5.1 ä¹‹ç±»çš„ç¯å¢ƒï¼Œå› ä¸º OpenResty å·²ç»ä¸å†æ”¯æŒæ ‡å‡† Luaï¼Œè€Œåªæ”¯æŒ LuaJITã€‚è¿™é‡Œæˆ‘ä»‹ç»çš„ Lua è¯­æ³•ï¼Œä¹Ÿæ˜¯å’Œ LuaJIT å…¼å®¹çš„éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯åŸºäºæœ€æ–°çš„ Lua 5.3ï¼Œè¿™ä¸€ç‚¹éœ€è¦ä½ ç‰¹åˆ«æ³¨æ„ã€‚</p><p>åœ¨ OpenResty çš„å®‰è£…ç›®å½•ä¸‹ï¼Œä½ å¯ä»¥æ‰¾åˆ° LuaJIT çš„ç›®å½•å’Œå¯æ‰§è¡Œæ–‡ä»¶ã€‚æˆ‘è¿™é‡Œæ˜¯ Mac ç¯å¢ƒï¼Œä½¿ç”¨ brew å®‰è£… OpenRestyï¼Œæ‰€ä»¥ä½ æœ¬åœ°çš„è·¯å¾„å¾ˆå¯èƒ½å’Œä¸‹é¢çš„ä¸åŒï¼š</p><pre><code>$ ll /usr/local/Cellar/openresty/1.13.6.2/luajit/bin/luajit\n lrwxr-xr-x  1 ming  admin    18B  4  2 14:54 /usr/local/Cellar/openresty/1.13.6.2/luajit/bin/luajit -&gt; luajit-2.1.0-beta3\n</code></pre><p>ä½ ä¹Ÿå¯ä»¥åœ¨ç³»ç»Ÿçš„å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•ä¸­æ‰¾åˆ°å®ƒï¼š</p><pre><code>$ which luajit\n /usr/local/bin/luajit\n</code></pre><p>å¹¶æŸ¥çœ‹ LuaJIT çš„ç‰ˆæœ¬å·ï¼š</p><pre><code>$ luajit -v\n LuaJIT 2.1.0-beta2 -- Copyright (C) 2005-2017 Mike Pall. http://luajit.org/\n</code></pre><p>æŸ¥æ¸…æ¥šè¿™äº›ä¿¡æ¯åï¼Œä½ å¯ä»¥æ–°å»ºä¸€ä¸ª <code>1.lua</code> æ–‡ä»¶ï¼Œå¹¶ç”¨ luajit æ¥è¿è¡Œå…¶ä¸­çš„ hello world ä»£ç ï¼š</p><pre><code>$ cat 1.lua\nprint(&quot;hello world&quot;)\n\n$ luajit 1.lua\n hello world\n</code></pre><p>å½“ç„¶ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ <code>resty</code> æ¥ç›´æ¥è¿è¡Œï¼Œè¦çŸ¥é“ï¼Œå®ƒæœ€ç»ˆä¹Ÿæ˜¯ç”¨ LuaJIT æ¥æ‰§è¡Œçš„ï¼š</p><pre><code>$ resty -e 'print(&quot;hello world&quot;)'\n hello world\n</code></pre><p>ä¸Šè¿°ä¸¤ç§è¿è¡Œ hello world çš„æ–¹å¼éƒ½æ˜¯å¯è¡Œçš„ã€‚ä¸é¡¾å¯¹æˆ‘æ¥è¯´ï¼Œæˆ‘æ›´å–œæ¬¢ <code>resty</code> è¿™ç§æ–¹å¼ï¼Œå› ä¸ºåé¢å¾ˆå¤š OpenResty çš„ä»£ç ï¼Œä¹Ÿéƒ½æ˜¯é€šè¿‡ <code>resty</code> æ¥è¿è¡Œçš„ã€‚</p><h2>æ•°æ®ç±»å‹</h2><p>Lua ä¸­çš„æ•°æ®ç±»å‹ä¸å¤šï¼Œä½ å¯ä»¥é€šè¿‡ <code>type</code> å‡½æ•°æ¥è¿”å›ä¸€ä¸ªå€¼çš„ç±»å‹ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ ·çš„æ“ä½œï¼š</p><pre><code>$ resty -e 'print(type(&quot;hello world&quot;)) \n print(type(print)) \n print(type(true)) \n print(type(360.0))\n print(type({}))\n print(type(nil))\n '\n</code></pre><p>ä¼šæ‰“å°å‡ºå¦‚ä¸‹å†…å®¹ï¼š</p><pre><code> string\n function\n boolean\n number\n table\n nil\n</code></pre><p>è¿™å‡ ç§å°±æ˜¯ Lua ä¸­çš„åŸºæœ¬æ•°æ®ç±»å‹äº†ã€‚ä¸‹é¢æˆ‘ä»¬æ¥ç®€å•ä»‹ç»ä¸€ä¸‹å®ƒä»¬ã€‚</p><h3>å­—ç¬¦ä¸²</h3><p>åœ¨ Lua ä¸­ï¼Œå­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„å€¼ï¼Œå¦‚æœä½ è¦ä¿®æ”¹æŸä¸ªå­—ç¬¦ä¸²ï¼Œå°±ç­‰äºåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ã€‚è¿™ç§åšæ³•æ˜¾ç„¶æœ‰åˆ©æœ‰å¼Šï¼šå¥½å¤„æ˜¯å³ä½¿åŒä¸€ä¸ªå­—ç¬¦ä¸²å‡ºç°äº†å¾ˆå¤šæ¬¡ï¼Œåœ¨å†…å­˜ä¸­ä¹Ÿåªæœ‰ä¸€ä»½ï¼›ä½†åŠ£åŠ¿ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå¦‚æœä½ æƒ³ä¿®æ”¹ã€æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œä¼šé¢å¤–åœ°åˆ›å»ºå¾ˆå¤šä¸å¿…è¦çš„å­—ç¬¦ä¸²ã€‚</p><p>æˆ‘ä»¬ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œæ¥è¯´æ˜è¿™ä¸ªå¼Šç«¯ã€‚ä¸‹é¢è¿™æ®µä»£ç ï¼Œæ˜¯æŠŠ 1 åˆ° 10 è¿™äº›æ•°å­—å½“ä½œå­—ç¬¦ä¸²æ‹¼æ¥èµ·æ¥ã€‚å¯¹äº†ï¼Œåœ¨ Lua ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ªç‚¹å·æ¥è¡¨ç¤ºå­—ç¬¦ä¸²çš„ç›¸åŠ ï¼š</p><pre><code>$ resty -e 'local s  = &quot;&quot;\n for i = 1, 10 do\n     s = s .. tostring(i)\n end\n print(s)'\n</code></pre><p>è¿™é‡Œæˆ‘ä»¬å¾ªç¯äº† 10 æ¬¡ï¼Œä½†åªæœ‰æœ€åä¸€æ¬¡æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œè€Œä¸­é—´æ–°å»ºçš„ 9 ä¸ªå­—ç¬¦ä¸²éƒ½æ˜¯æ— ç”¨çš„ã€‚å®ƒä»¬ä¸ä»…å ç”¨äº†é¢å¤–çš„ç©ºé—´ï¼Œä¹Ÿæ¶ˆè€—äº†ä¸å¿…è¦çš„ CPU è¿ç®—ã€‚</p><p>å½“ç„¶ï¼Œåœ¨åé¢çš„æ€§èƒ½ä¼˜åŒ–ç« èŠ‚ï¼Œæˆ‘ä»¬ä¼šæœ‰å¯¹åº”çš„æ–¹æ³•æ¥è§£å†³å®ƒã€‚</p><p>å¦å¤–ï¼Œåœ¨ Lua ä¸­ï¼Œä½ æœ‰ä¸‰ç§æ–¹å¼å¯ä»¥è¡¨è¾¾ä¸€ä¸ªå­—ç¬¦ä¸²ï¼šå•å¼•å·ã€åŒå¼•å·ï¼Œä»¥åŠé•¿æ‹¬å·ï¼ˆ<code>[[]]</code>ï¼‰ã€‚å‰é¢ä¸¤ç§éƒ½æ¯”è¾ƒå¥½ç†è§£ï¼Œåˆ«çš„è¯­è¨€ä¸€èˆ¬ä¹Ÿè¿™ä¹ˆç”¨ï¼Œé‚£ä¹ˆé•¿æ‹¬å·æœ‰ä»€ä¹ˆç”¨å¤„å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬çœ‹ä¸€ä¸ªå…·ä½“çš„ç¤ºä¾‹ï¼š</p><pre><code>$ resty -e 'print([[string has \\n and \\r]])'\n string has \\n and \\r\n</code></pre><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œé•¿æ‹¬å·ä¸­çš„å­—ç¬¦ä¸²ä¸ä¼šåšä»»ä½•çš„è½¬ä¹‰å¤„ç†ã€‚</p><p>ä½ ä¹Ÿè®¸ä¼šé—®å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœä¸Šé¢é‚£æ®µå­—ç¬¦ä¸²ä¸­åŒ…æ‹¬äº†é•¿æ‹¬å·æœ¬èº«ï¼Œåˆè¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿç­”æ¡ˆå¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨é•¿æ‹¬å·ä¸­é—´å¢åŠ ä¸€ä¸ªæˆ–è€…å¤šä¸ª <code>=</code> ç¬¦å·ï¼š</p><pre><code>$ resty -e 'print([=[ string has a [[]]. ]=])'\n  string has a [[]].\n</code></pre><h3>å¸ƒå°”å€¼</h3><p>è¿™ä¸ªå¾ˆç®€å•ï¼Œtrue å’Œ falseã€‚ä½†åœ¨ Lua ä¸­ï¼Œåªæœ‰ nil å’Œ false ä¸ºå‡ï¼Œå…¶ä»–éƒ½ä¸ºçœŸï¼ŒåŒ…æ‹¬ 0 å’Œç©ºå­—ç¬¦ä¸²ä¹Ÿä¸ºçœŸã€‚æˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç å°è¯ä¸€ä¸‹ï¼š</p><pre><code>$ resty -e 'local a = 0\n if a then\n   print(&quot;true&quot;)\n end\n a = &quot;&quot;\n if a then\n   print(&quot;true&quot;)\n end'\n</code></pre><p>è¿™ç§åˆ¤æ–­æ–¹å¼å’Œå¾ˆå¤šå¸¸è§çš„å¼€å‘è¯­è¨€å¹¶ä¸ä¸€è‡´ï¼Œæ‰€ä»¥ï¼Œä¸ºäº†é¿å…åœ¨è¿™ç§é—®é¢˜ä¸Šå‡ºé”™ï¼Œä½ å¯ä»¥æ˜¾å¼åœ°å†™æ˜æ¯”è¾ƒçš„å¯¹è±¡ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ ·ï¼š</p><pre><code>$ resty -e 'local a = 0\n if a == false then\n   print(&quot;true&quot;)\n end\n '\n\n</code></pre><h3>æ•°å­—</h3><p>Lua çš„ number ç±»å‹ï¼Œæ˜¯ç”¨åŒç²¾åº¦æµ®ç‚¹æ•°æ¥å®ç°çš„ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼ŒLuaJIT æ”¯æŒ <code>dual-number</code>ï¼ˆåŒæ•°ï¼‰æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ LuaJIT ä¼šæ ¹æ®ä¸Šä¸‹æ–‡æ¥ç”¨æ•´å‹æ¥å­˜å‚¨æ•´æ•°ï¼Œè€Œç”¨åŒç²¾åº¦æµ®ç‚¹æ•°æ¥å­˜æ”¾æµ®ç‚¹æ•°ã€‚</p><p>æ­¤å¤–ï¼ŒLuaJIT è¿˜æ”¯æŒ<code>é•¿é•¿æ•´å‹</code>çš„å¤§æ•´æ•°ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p><pre><code>$ resty -e 'print(9223372036854775807LL - 1)'\n9223372036854775806LL\n</code></pre><h3>å‡½æ•°</h3><p>å‡½æ•°åœ¨ Lua ä¸­æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œä½ å¯ä»¥æŠŠå‡½æ•°å­˜æ”¾åœ¨ä¸€ä¸ªå˜é‡ä¸­ï¼Œä¹Ÿå¯ä»¥å½“ä½œå¦å¤–ä¸€ä¸ªå‡½æ•°çš„å…¥å‚å’Œå‡ºå‚ã€‚</p><p>æ¯”å¦‚ï¼Œä¸‹é¢ä¸¤ä¸ªå‡½æ•°çš„å£°æ˜æ˜¯å®Œå…¨ç­‰ä»·çš„ï¼š</p><pre><code>function foo()\n end\n</code></pre><p>å’Œ</p><pre><code>foo = function ()\n end\n</code></pre><h3>table</h3><p>table æ˜¯ Lua ä¸­å”¯ä¸€çš„æ•°æ®ç»“æ„ï¼Œè‡ªç„¶éå¸¸é‡è¦ï¼Œæ‰€ä»¥åé¢æˆ‘ä¼šç”¨ä¸“é—¨çš„ç« èŠ‚æ¥ä»‹ç»å®ƒã€‚æˆ‘ä»¬å¯ä»¥å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç ï¼š</p><pre><code>$ resty -e 'local color = {first = &quot;red&quot;}\nprint(color[&quot;first&quot;])'\n red\n</code></pre><h3>ç©ºå€¼</h3><p>åœ¨ Lua ä¸­ï¼Œç©ºå€¼å°±æ˜¯ nilã€‚å¦‚æœä½ å®šä¹‰äº†ä¸€ä¸ªå˜é‡ï¼Œä½†æ²¡æœ‰èµ‹å€¼ï¼Œå®ƒçš„é»˜è®¤å€¼å°±æ˜¯ nilï¼š</p><pre><code>$ resty -e 'local a\n print(type(a))'\n nil\n</code></pre><p>å½“ä½ çœŸæ­£è¿›å…¥ OpenResty ä½“ç³»ä¸­åï¼Œä¼šå‘ç°å¾ˆå¤šç§ç©ºå€¼ï¼Œæ¯”å¦‚ <code>ngx.null</code> ç­‰ç­‰ï¼Œæˆ‘ä»¬åé¢å†ç»†èŠã€‚</p><p>Luaçš„æ•°æ®ç±»å‹ï¼Œæˆ‘ä¸»è¦å°±ä»‹ç»è¿™ä¹ˆå¤šï¼Œå…ˆç»™ä½ æ‰“ä¸ªåŸºç¡€ã€‚ä¸€äº›éœ€è¦é‡ç‚¹æŒæ¡çš„å†…å®¹ï¼Œåé¢çš„æ–‡ç« ä¸­æˆ‘ä»¬éƒ½ä¼šç»§ç»­å­¦ä¹ ã€‚åœ¨ç»ƒä¹ ã€ä½¿ç”¨ä¸­å­¦ä¹ ï¼Œæ°¸è¿œæ˜¯å¸æ”¶æ–°çŸ¥è¯†æœ€ä¾¿æ·çš„æ–¹å¼ã€‚</p><h2>å¸¸ç”¨æ ‡å‡†åº“</h2><p>å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬å­¦ä¹ ä¸€é—¨è¯­è¨€ï¼Œå…¶å®å°±æ˜¯åœ¨å­¦ä¹ å®ƒçš„æ ‡å‡†åº“ã€‚</p><p>Lua æ¯”è¾ƒå°å·§ï¼Œå†…ç½®çš„æ ‡å‡†åº“å¹¶ä¸å¤šã€‚è€Œä¸”ï¼Œåœ¨ OpenResty çš„ç¯å¢ƒä¸­ï¼ŒLua æ ‡å‡†åº“çš„ä¼˜å…ˆçº§æ˜¯å¾ˆä½çš„ã€‚å¯¹äºåŒä¸€ä¸ªåŠŸèƒ½ï¼Œæˆ‘æ›´æ¨èä½ ä¼˜å…ˆä½¿ç”¨ OpenResty çš„ API æ¥è§£å†³ï¼Œç„¶åæ˜¯ LuaJIT çš„åº“å‡½æ•°ï¼Œæœ€åæ‰æ˜¯æ ‡å‡† Lua çš„å‡½æ•°ã€‚</p><p><code>OpenRestyçš„API &gt; LuaJITçš„åº“å‡½æ•° &gt; æ ‡å‡†Luaçš„å‡½æ•°</code>ï¼Œè¿™ä¸ªä¼˜å…ˆçº§åé¢ä¼šè¢«åå¤æåŠï¼Œå®ƒä¸ä»…å…³ç³»åˆ°æ˜¯å¦å¥½ç”¨è¿™ä¸€ç‚¹ï¼Œæ›´ä¼šå¯¹æ€§èƒ½äº§ç”Ÿéå¸¸å¤§çš„å½±å“ã€‚</p><p>ä¸è¿‡ï¼Œå°½ç®¡å¦‚æ­¤ï¼Œåœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä¸å¯é¿å…ä¼šç”¨åˆ°ä¸€äº› Lua åº“ã€‚è¿™é‡Œï¼Œæˆ‘æŒ‘é€‰äº†å‡ ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„æ ‡å‡†åº“åšä¸‹ä»‹ç»ï¼Œå¦‚æœä½ æƒ³è¦äº†è§£æ›´å¤šå†…å®¹ï¼Œå¯ä»¥æŸ¥é˜… Lua çš„å®˜æ–¹æ–‡æ¡£ã€‚</p><h3>string åº“</h3><p>å­—ç¬¦ä¸²æ“ä½œæ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨åˆ°çš„ï¼Œä¹Ÿæ˜¯å‘æœ€å¤šçš„åœ°æ–¹ã€‚æœ‰ä¸€ä¸ªç®€å•çš„åŸåˆ™ï¼Œé‚£å°±æ˜¯å¦‚æœæ¶‰åŠåˆ°æ­£åˆ™è¡¨è¾¾å¼çš„ï¼Œè¯·ä¸€å®šè¦ä½¿ç”¨ OpenResty æä¾›çš„ <code>ngx.re.*</code> æ¥è§£å†³ï¼Œä¸è¦ç”¨ Lua çš„ <code>string.*</code> å¤„ç†ã€‚è¿™æ˜¯å› ä¸ºï¼ŒLua çš„æ­£åˆ™ç‹¬æ ‘ä¸€å¸œï¼Œä¸ç¬¦åˆ PCRE çš„è§„èŒƒï¼Œæˆ‘ç›¸ä¿¡ç»å¤§éƒ¨åˆ†å·¥ç¨‹å¸ˆæ˜¯ç©ä¸è½¬çš„ã€‚</p><p>å…¶ä¸­ <code>string.byte(s [, i [, j ]])</code>ï¼Œæ˜¯æ¯”è¾ƒå¸¸ç”¨åˆ°çš„ä¸€ä¸ª string åº“å‡½æ•°ï¼Œå®ƒè¿”å›å­—ç¬¦ s[i]ã€s[i + 1]ã€s[i + 2]ã€Â·Â·Â·Â·Â·Â·ã€s[j] æ‰€å¯¹åº”çš„ ASCII ç ã€‚i çš„é»˜è®¤å€¼ä¸º 1ï¼Œå³ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œj çš„é»˜è®¤å€¼ä¸º iã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€æ®µç¤ºä¾‹ä»£ç ï¼š</p><pre><code>$ resty -e 'print(string.byte(&quot;abc&quot;, 1, 3))\n print(string.byte(&quot;abc&quot;, 3)) -- ç¼ºå°‘ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°é»˜è®¤ä¸ç¬¬äºŒä¸ªç›¸åŒï¼Œæ­¤æ—¶ä¸º 3\n print(string.byte(&quot;abc&quot;))    -- ç¼ºå°‘ç¬¬äºŒä¸ªå’Œç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œæ­¤æ—¶è¿™ä¸¤ä¸ªå‚æ•°éƒ½é»˜è®¤ä¸º 1\n '\n</code></pre><p>å®ƒçš„è¾“å‡ºä¸ºï¼š</p><pre><code> 979899\n 99\n 97\n</code></pre><h3>table åº“</h3><p>åœ¨ OpenResty çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œå¯¹äºLua è‡ªå¸¦çš„ table åº“ï¼Œé™¤äº† <code>table.concat</code> ã€<code>table.sort</code> ç­‰å°‘æ•°å‡ ä¸ªå‡½æ•°ï¼Œå¤§éƒ¨åˆ†æˆ‘éƒ½ä¸æ¨èä½¿ç”¨ã€‚è‡³äºå®ƒä»¬çš„ç»†èŠ‚ï¼Œæˆ‘ä»¬ç•™åœ¨ LuaJIT ç« èŠ‚ä¸­ä¸“é—¨æ¥è®²ã€‚</p><p>è¿™é‡Œæˆ‘ç®€å•æä¸€ä¸‹<code>table.concat</code> ã€‚<code>table.concat</code>ä¸€èˆ¬ç”¨åœ¨å­—ç¬¦ä¸²æ‹¼æ¥çš„åœºæ™¯ä¸‹ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ã€‚å®ƒå¯ä»¥é¿å…ç”Ÿæˆå¾ˆå¤šæ— ç”¨çš„å­—ç¬¦ä¸²ã€‚</p><pre><code>$ resty -e 'local a = {&quot;A&quot;, &quot;b&quot;, &quot;C&quot;}\n print(table.concat(a))'\n</code></pre><h3>math åº“</h3><p>Lua math åº“ç”±ä¸€ç»„æ ‡å‡†çš„æ•°å­¦å‡½æ•°æ„æˆã€‚æ•°å­¦åº“çš„å¼•å…¥ï¼Œæ—¢ä¸°å¯Œäº† Lua ç¼–ç¨‹è¯­è¨€çš„åŠŸèƒ½ï¼ŒåŒæ—¶ä¹Ÿæ–¹ä¾¿äº†ç¨‹åºçš„ç¼–å†™ã€‚</p><p>åœ¨ OpenResty çš„å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¾ˆå°‘ç”¨ Lua å»åšæ•°å­¦æ–¹é¢çš„è¿ç®—ï¼Œä¸è¿‡å…¶ä¸­å’Œéšæœºæ•°ç›¸å…³çš„ <code>math.random()</code> å’Œ <code>math.randomseed()</code> ä¸¤ä¸ªå‡½æ•°ï¼Œå€’æ˜¯æ¯”è¾ƒå¸¸ç”¨ï¼Œæ¯”å¦‚ä¸‹é¢çš„è¿™æ®µä»£ç ï¼Œå®ƒå¯ä»¥åœ¨æŒ‡å®šçš„èŒƒå›´å†…ï¼Œéšæœºåœ°ç”Ÿæˆä¸¤ä¸ªæ•°å­—ã€‚</p><pre><code>$ resty -e 'math.randomseed (os.time()) \nprint(math.random())\n print(math.random(100))'\n</code></pre><h2>è™šå˜é‡</h2><p>äº†è§£äº†è¿™äº›å¸¸è§çš„æ ‡å‡†åº“ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥å­¦ä¹ ä¸€ä¸ªæ–°çš„æ¦‚å¿µâ€”â€”è™šå˜é‡ã€‚</p><p>è®¾æƒ³è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼Œå½“ä¸€ä¸ªå‡½æ•°è¿”å›å¤šä¸ªå€¼çš„æ—¶å€™ï¼Œæœ‰äº›è¿”å›å€¼æˆ‘ä»¬å¹¶ä¸éœ€è¦ï¼Œè¿™æ—¶å€™ï¼Œåº”è¯¥æ€ä¹ˆæ¥æ”¶è¿™äº›å€¼å‘¢ï¼Ÿ</p><p>ä¸çŸ¥é“ä½ æ˜¯æ€ä¹ˆçœ‹å¾…è¿™ä»¶äº‹çš„ï¼Œèµ·ç å¯¹æˆ‘æ¥è¯´ï¼Œè¦æƒ³æ³•è®¾æ³•ç»™è¿™äº›ç”¨ä¸åˆ°çš„å˜é‡ï¼Œå»èµ‹äºˆæœ‰æ„ä¹‰çš„åå­—ï¼Œç€å®æ˜¯ä¸€ä»¶å¾ˆæŠ˜ç£¨äººçš„äº‹æƒ…ã€‚</p><p>è¿˜å¥½ï¼Œ Lua ä¸­å¯ä»¥å®Œç¾åœ°è§£å†³è¿™ä¸€ç‚¹ã€‚Lua æä¾›äº†ä¸€ä¸ªè™šå˜é‡ï¼ˆdummy variableï¼‰çš„æ¦‚å¿µï¼Œ æŒ‰ç…§æƒ¯ä¾‹ä»¥ä¸€ä¸ªä¸‹åˆ’çº¿æ¥å‘½åï¼Œç”¨æ¥è¡¨ç¤ºä¸¢å¼ƒä¸éœ€è¦çš„æ•°å€¼ï¼Œä»…ä»…èµ·åˆ°å ä½çš„ä½œç”¨ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬ä»¥ <code>string.find</code> è¿™ä¸ªæ ‡å‡†åº“å‡½æ•°ä¸ºä¾‹ï¼Œæ¥çœ‹è™šå˜é‡çš„ç”¨æ³•ã€‚è¿™ä¸ªæ ‡å‡†åº“å‡½æ•°ä¼šè¿”å›ä¸¤ä¸ªå€¼ï¼Œåˆ†åˆ«ä»£è¡¨å¼€å§‹å’Œç»“æŸçš„ä¸‹æ ‡ã€‚</p><p>å¦‚æœæˆ‘ä»¬åªéœ€è¦è·å–å¼€å§‹çš„ä¸‹æ ‡ï¼Œé‚£ä¹ˆå¾ˆç®€å•ï¼Œåªå£°æ˜ä¸€ä¸ªå˜é‡æ¥æ¥æ”¶ <code>string.find</code> çš„è¿”å›å€¼å³å¯ï¼š</p><pre><code>$ resty -e 'local start = string.find(&quot;hello&quot;, &quot;he&quot;)\n print(start)'\n 1\n</code></pre><p>ä½†å¦‚æœä½ åªæƒ³è·å–ç»“æŸçš„ä¸‹æ ‡ï¼Œé‚£å°±å¿…é¡»ä½¿ç”¨è™šå˜é‡äº†ï¼š</p><pre><code>$ resty -e 'local  _, end_pos = string.find(&quot;hello&quot;, &quot;he&quot;)\n print(end_pos)'\n 2\n</code></pre><p>é™¤äº†åœ¨è¿”å›å€¼é‡Œä½¿ç”¨ï¼Œè™šå˜é‡è¿˜ç»å¸¸ç”¨äºå¾ªç¯ä¸­ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p><pre><code>$ resty -e 'for _, v in ipairs({4,5,6}) do\n     print(v)\n end'\n 4\n 5\n 6\n</code></pre><p>è€Œå½“æœ‰å¤šä¸ªè¿”å›å€¼éœ€è¦å¿½ç•¥æ—¶ï¼Œä½ å¯ä»¥é‡å¤ä½¿ç”¨åŒä¸€ä¸ªè™šå˜é‡ã€‚è¿™é‡Œæˆ‘å°±ä¸ä¸¾ä¾‹å­äº†ï¼Œä½ å¯ä»¥è¯•ç€è‡ªå·±å†™ä¸€ä¸ªè¿™æ ·çš„ç¤ºä¾‹ä»£ç å—ï¼Ÿæ¬¢è¿ä½ æŠŠä»£ç è´´åœ¨ç•™è¨€åŒºé‡Œå’Œæˆ‘åˆ†äº«ã€äº¤æµã€‚</p><h2>å†™åœ¨æœ€å</h2><p>ä»Šå¤©ï¼Œæˆ‘ä»¬ä¸€èµ·å¿«é€Ÿåœ°å­¦ä¹ äº†æ ‡å‡† Lua çš„æ•°æ®ç»“æ„å’Œè¯­æ³•ï¼Œç›¸ä¿¡ä½ å¯¹è¿™é—¨ç®€å•ç²¾å·§çš„è¯­è¨€å·²ç»æœ‰äº†åˆæ­¥çš„äº†è§£ã€‚ä¸‹èŠ‚è¯¾ï¼Œæˆ‘ä¼šå¸¦ä½ äº†è§£  Lua å’Œ LuaJIT çš„å…³ç³»ï¼ŒLuaJIT æ›´æ˜¯ OpenResty ä¸­çš„é‡å¤´æˆï¼Œå€¼å¾—æˆ‘ä»¬æ·±å…¥æŒ–æ˜ã€‚</p><p>æœ€åï¼Œæˆ‘æƒ³å†ä¸ºä½ ç•™ä¸‹ä¸€é“æ€è€ƒé¢˜ã€‚</p><p>è¿˜è®°å¾—è¿™èŠ‚è¯¾è®²mathåº“æ—¶ï¼Œå­¦è¿‡çš„è¿™æ®µä»£ç å—ï¼Ÿå®ƒå¯ä»¥åœ¨æŒ‡å®šèŒƒå›´å†…ï¼Œéšæœºç”Ÿæˆä¸¤ä¸ªæ•°å­—ã€‚</p><pre><code>$ resty -e 'math.randomseed (os.time()) \nprint(math.random())\n print(math.random(100))'\n</code></pre><p>ä¸è¿‡ï¼Œä½ å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œè¿™æ®µä»£ç æ˜¯ç”¨å½“å‰æ—¶é—´æˆ³ä½œä¸ºç§å­çš„ï¼Œé‚£ä¹ˆè¿™ç§æ–¹æ³•æ˜¯å¦æœ‰é—®é¢˜å‘¢ï¼Ÿåˆè¯¥å¦‚ä½•ç”Ÿæˆå¥½çš„ç§å­å‘¢ï¼Ÿè¦çŸ¥é“ï¼Œå¾ˆå¤šæ—¶å€™æˆ‘ä»¬ç”Ÿæˆçš„éšæœºæ•°å…¶å®å¹¶ä¸éšæœºï¼Œå¹¶ä¸”æœ‰å¾ˆå¤§çš„å®‰å…¨éšæ‚£ã€‚</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºæ¥è¯´è¯´ä½ çš„çœ‹æ³•ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« è½¬å‘ç»™ä½ çš„åŒäº‹ã€æœ‹å‹ã€‚æˆ‘ä»¬ä¸€èµ·äº¤æµã€ä¸€èµ·è¿›æ­¥ã€‚</p><p></p>","neighbors":{"left":{"article_title":"06 | OpenResty ä¸­ç”¨åˆ°çš„ NGINX çŸ¥è¯†","id":99522},"right":{"article_title":"08 | LuaJITåˆ†æ”¯å’Œæ ‡å‡†Luaæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ","id":100402}},"comments":[{"had_liked":false,"id":102567,"user_name":"HelloBug","can_delete":false,"product_type":"c1","uid":1249598,"ip_address":"","ucode":"E61A4AD5C2F724","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/3e/925aa996.jpg","comment_is_top":false,"comment_ctime":1560253510,"is_pvip":true,"replies":[{"id":"37359","content":"å¾ˆè¯¦ç»†äº†ã€‚å¦‚æœæœ‰åŠ å¯†çš„éœ€æ±‚ï¼Œä» &#47;dev&#47;random å’Œ &#47;dev&#47;urandom è¯»å–ä¼šæ›´å®‰å…¨ï¼Œæ¯•ç«Ÿåªæ˜¯ init çš„æ—¶å€™è¯»å–ä¸€æ¬¡ã€‚","user_name":"ä½œè€…å›å¤","comment_id":102567,"uid":"1017955","ip_address":"","utype":1,"ctime":1560410758,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":2,"race_medal":0,"score":"74574697542","product_id":100028301,"comment_content":"ç½‘ä¸Šæœ‰ç§è®¾ç½®éšæœºæ•°ç§å­çš„æ–¹æ³•ï¼š<br>math.randomseed(tostring(os.time()):reverse():sub(1, 6))<br>å³å°†æ—¶é—´å€¼è½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åå°†å­—ç¬¦ä¸²å€’åºï¼Œç„¶åå–å…¶å‰å…­ä½ä½œä¸ºç§å­ã€‚ä¹‹æ‰€ä»¥è¿™æ ·åšçš„åŸå› æ˜¯å› ä¸ºå½“æ—¶é—´å˜åŒ–å¾ˆå°çš„æ—¶å€™ï¼Œäº§ç”Ÿéšæœºæ•°çš„åºåˆ—å¾ˆç›¸ä¼¼ã€‚æ‰€ä»¥é€šè¿‡è¿™ç§æ–¹æ³•ä½¿å¾—å³ä½¿æ—¶é—´å˜åŒ–å¾ˆå°ï¼Œç”±äºreverseæ“ä½œï¼Œæ—¶é—´çš„é«˜ä½å˜æˆä½ä½ï¼Œä½ä½å˜æˆé«˜ä½ï¼Œéšæœºæ•°ç§å­çš„å€¼å˜åŒ–ä¼šå¾ˆå¤§ã€‚<br><br>å…³äºè¿™ç§åšæ³•æœ‰ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š<br>1.å½“å‰æ‰§è¡Œos.time()æ‰“å°çš„æ—¶é—´æ˜¯1560251897ï¼Œæ€»å…±åä½ã€‚è®¤ä¸ºå‡½æ•°ä¸­ä½¿ç”¨sub(1, 6)è¿™é‡Œå–å‰6ä½çš„ä¸­çš„6å¹¶ä¸æ˜¯ä¸€ä¸ªå›ºå®šçš„å€¼ï¼Œè€Œä¸”å¹¶æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œç›´æ¥ä½¿ç”¨math.randomseed(tostring(os.time()):reverse())å°±èƒ½è¾¾åˆ°æƒ³è¦çš„æ•ˆæœã€‚éš¾é“æœ‰å…¶ä»–æˆ‘æ²¡æœ‰æƒ³åˆ°çš„åŸå› ï¼Ÿ<br><br>2.è¿™æ ·çš„åšæ³•å¹¶ä¸èƒ½é˜»æ­¢åœ¨åŒä¸€ç§’å†…äº§ç”Ÿç›¸åŒçš„éšæœºæ•°åºåˆ—ï¼Œå¦‚æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š<br>math.randomseed(tostring(os.time()):reverse():sub(1, 6)) <br>print(math.random()) <br>print(math.random())<br>math.randomseed(tostring(os.time()):reverse():sub(1, 6)) <br>print(math.random()) <br>print(math.random())<br>è¾“å‡ºç»“æœæ˜¯ï¼š<br>0.49256881466135<br>0.0046852543018758<br>0.49256881466135<br>0.0046852543018758<br><br>å¦ä¸€ç§è¯´æ³•æ˜¯å¯¹è®¡ç®—æœºçš„ä¸€äº›æ“ä½œï¼Œå¦‚é”®ç›˜ã€é¼ æ ‡æ“ä½œï¼Œä¼šäº§ç”Ÿä¸€äº›éšæœºæ•°ï¼Œè¿™äº›éšæœºæ•°å«ç†µã€‚ç”¨æˆ·å¯ä»¥é€šè¿‡è¯»å–&#47;dev&#47;randomå’Œ&#47;dev&#47;urandomæ–‡ä»¶æ¥è·å–è¿™äº›éšæœºæ•°ã€‚åªä¸è¿‡è¯»å–&#47;dev&#47;randomæ—¶ï¼Œå¦‚æœæ–‡ä»¶é‡Œçš„ç†µä¸è¶³æ—¶ä¼šé˜»å¡ã€‚è¯»å–&#47;dev&#47;urandomæ—¶ï¼Œä¸ä¼šé˜»å¡ï¼Œä½†ä¸èƒ½ä¿è¯æ˜¯åˆé€‚çš„æ•°æ®ï¼ˆç†µä¸è¶³æ—¶æ€ä¹ˆå¤„ç†æœªæµ‹è¯•ï¼‰ã€‚å…³äºç†µçš„è¿˜æœ‰å…¶ä»–ç›¸å…³çŸ¥è¯†ï¼Œå¦‚é€šè¿‡æ“ä½œé¼ æ ‡ã€é”®ç›˜ç­‰å¯ä»¥äº§ç”Ÿç†µï¼Œé€šè¿‡cat &#47;proc&#47;sys&#47;kernel&#47;random&#47;entropy_availæ“ä½œå¯ä»¥æŸ¥çœ‹æœ‰å¤šå°‘ç†µå¯ä»¥ç”¨ç­‰ã€‚<br>è¿™æ ·çš„è¯ï¼Œé€šè¿‡è¯»å–&#47;dev&#47;urandomè®¾ç½®éšæœºæ•°ç§å­ï¼Œæ˜¯ä¸€ç§æ–¹æ³•ï¼Œä½†è§‰å¾—è¿™ç§æ–‡ä»¶è¯»å–æ“ä½œï¼Œæ•ˆç‡å¤ªä½ã€‚<br><br>å¦å¤–çœ‹ç•™è¨€é‡Œæœ‰äººè¯´é€šè¿‡ç³»ç»Ÿè°ƒç”¨ï¼Œåˆ©ç”¨èŠ¯ç‰‡ç”µç£å™ªå£°æ¥ç”Ÿæˆéšæœºæ•°ã€‚æ²¡æœ‰æœåˆ°æ˜¯å“ªä¸ªç³»ç»Ÿè°ƒç”¨ã€‚<br>","like_count":17,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453482,"discussion_content":"å¾ˆè¯¦ç»†äº†ã€‚å¦‚æœæœ‰åŠ å¯†çš„éœ€æ±‚ï¼Œä» /dev/random å’Œ /dev/urandom è¯»å–ä¼šæ›´å®‰å…¨ï¼Œæ¯•ç«Ÿåªæ˜¯ init çš„æ—¶å€™è¯»å–ä¸€æ¬¡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560410758,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1000004,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/44/d3d67640.jpg","nickname":"Hillså½•","note":"","ucode":"779020947ACABA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":32,"discussion_content":"å­¦ä¹ äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561007350,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":102555,"user_name":"HelloBug","can_delete":false,"product_type":"c1","uid":1249598,"ip_address":"","ucode":"E61A4AD5C2F724","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/3e/925aa996.jpg","comment_is_top":false,"comment_ctime":1560251479,"is_pvip":true,"replies":[{"id":"37351","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":102555,"uid":"1017955","ip_address":"","utype":1,"ctime":1560409765,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"23035087959","product_id":100028301,"comment_content":"è¿”å›ä¸‰ä¸ªå˜é‡ï¼Œå‰ä¸¤ä¸ªå˜é‡é‡å¤ä½¿ç”¨åŒä¸€ä¸ªè™šå˜é‡çš„ä¾‹å­ï¼š<br>resty -e &#39;local function sum(a, b) return a, b, a + b end local _, _, result = sum(1, 2) print(result)&#39;<br><br>os.timeè¿”å›å½“å‰æ—¶é—´çš„ç§’æ•°ï¼Œå¦‚æœåœ¨åŒä¸€ç§’å†…è®¾ç½®å½“å‰æ—¶é—´ç§’æ•°ä¸ºç§å­ï¼Œç„¶åæ‰§è¡Œéšæœºæ•°ç”Ÿæˆå‡½æ•°ï¼Œäº§ç”Ÿçš„éšæœºæ•°åºåˆ—æ˜¯ä¸€æ ·çš„ã€‚å¦‚ï¼š<br>resty -e &#39;math.randomseed(os.time()) print(math.random()) print(math.random()) math.randomseed(os.time()) print(math.random()) print(math.random())&#39;<br>è¾“å‡ºç»“æœæ˜¯ï¼š<br>0.71251659032569<br>0.36755092546457<br>0.71251659032569<br>0.36755092546457<br>å¯ä»¥çœ‹åˆ°ä¸¤æ¬¡äº§ç”Ÿçš„éšæœºæ•°åºåˆ—ç›¸åŒã€‚","like_count":5,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453476,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560409765,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":102043,"user_name":"ä¸€æ­¥","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1560126259,"is_pvip":true,"replies":[{"id":"37362","content":"æ˜¯çš„ï¼Œæ²¡é”™","user_name":"ä½œè€…å›å¤","comment_id":102043,"uid":"1017955","ip_address":"","utype":1,"ctime":1560410786,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"23034962739","product_id":100028301,"comment_content":"æ˜ç™½äº†ï¼Œ os.time æ˜¯ç§’çº§åˆ«çš„ï¼Œå¦‚æœçŸ­æ—¶é—´è¿è¡Œå¤šæ¬¡ä¼šå‡ºç°ç›¸åŒçš„éšæœºæ•°","like_count":5,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453232,"discussion_content":"æ˜¯çš„ï¼Œæ²¡é”™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560410786,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":102010,"user_name":"å«æˆ‘å›¾å›¾å°±å¯ä»¥äº†","can_delete":false,"product_type":"c1","uid":1179211,"ip_address":"","ucode":"78AD0A45E9E412","user_header":"https://static001.geekbang.org/account/avatar/00/11/fe/4b/87219faf.jpg","comment_is_top":false,"comment_ctime":1560098141,"is_pvip":false,"replies":[{"id":"37367","content":"uuid æœ¬èº«ä¹Ÿæ˜¯å…ˆæœ‰ç§å­ï¼Œç„¶åé€šè¿‡éšæœºæ•°ç”Ÿæˆçš„ã€‚","user_name":"ä½œè€…å›å¤","comment_id":102010,"uid":"1017955","ip_address":"","utype":1,"ctime":1560411046,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"18739967325","product_id":100028301,"comment_content":"ç§å­ä¼šå‡ºç°ç›¸åŒçš„,ç®€å•çš„åšæ³•å¯ä»¥ç”¨GUIDæˆ–è€…UUIDä¹‹ç±»çš„åšç§å­å§.","like_count":4,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453218,"discussion_content":"uuid æœ¬èº«ä¹Ÿæ˜¯å…ˆæœ‰ç§å­ï¼Œç„¶åé€šè¿‡éšæœºæ•°ç”Ÿæˆçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560411046,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":102436,"user_name":"John","can_delete":false,"product_type":"c1","uid":1458885,"ip_address":"","ucode":"ECACBE31D5D1A7","user_header":"https://static001.geekbang.org/account/avatar/00/16/42/c5/7913cdb0.jpg","comment_is_top":false,"comment_ctime":1560220700,"is_pvip":false,"replies":[{"id":"37366","content":"ä¸ä¼šæé«˜æ€§èƒ½ï¼Œæ¨¡å—åœ¨å•ä¸ª worker ä¸­åªä¼šåŠ è½½ä¸€æ¬¡ï¼Œå’Œæ˜¯å¦åŠ äº† local æ— å…³ã€‚è®¾ç½®ä¸ºå…¨å±€å˜é‡ï¼Œå¾ˆå®¹æ˜“å‡ºé”™ï¼Œæ¯”å¦‚é‡åä»€ä¹ˆçš„ã€‚åœ¨OpenResty ä¸­å»ºè®®æ‰€æœ‰å˜é‡éƒ½ localã€‚","user_name":"ä½œè€…å›å¤","comment_id":102436,"uid":"1017955","ip_address":"","utype":1,"ctime":1560410931,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"14445122588","product_id":100028301,"comment_content":"è¯·é—®ä¸€ä¸‹è€å¸ˆï¼Œå¦‚æœæˆ‘åœ¨init_by_lua ä¸­å¼•å…¥æŸä¸ªæ¨¡å—ï¼Œä¸åŠ localï¼Œä½œä¸ºå…¨å±€å˜é‡ï¼Œæ˜¯ä¸æ˜¯è¯´è¿™ä¸ªæ¨¡å—å°±å¯ä»¥åœ¨ä»¥årewrite,access ç­‰é˜¶æ®µç›´æ¥æ‹¿æ¥ä½¿ç”¨ï¼Ÿè¿™æ ·åšç›¸æ¯”è¾ƒäºåœ¨å„ä¸ªé˜¶æ®µè‡ªå·±å¼•å…¥æ¨¡å—ï¼Œæ˜¯å¦å‡å°‘äº†requireçš„æ¬¡æ•°ï¼Œæé«˜äº†æ€§èƒ½ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453424,"discussion_content":"ä¸ä¼šæé«˜æ€§èƒ½ï¼Œæ¨¡å—åœ¨å•ä¸ª worker ä¸­åªä¼šåŠ è½½ä¸€æ¬¡ï¼Œå’Œæ˜¯å¦åŠ äº† local æ— å…³ã€‚è®¾ç½®ä¸ºå…¨å±€å˜é‡ï¼Œå¾ˆå®¹æ˜“å‡ºé”™ï¼Œæ¯”å¦‚é‡åä»€ä¹ˆçš„ã€‚åœ¨OpenResty ä¸­å»ºè®®æ‰€æœ‰å˜é‡éƒ½ localã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560410931,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":102376,"user_name":"Rye","can_delete":false,"product_type":"c1","uid":1175100,"ip_address":"","ucode":"5BDC40ED641A6C","user_header":"https://static001.geekbang.org/account/avatar/00/11/ee/3c/a2b67971.jpg","comment_is_top":false,"comment_ctime":1560214420,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14445116308","product_id":100028301,"comment_content":"æœºå™¨å+è¿›ç¨‹ID+çº¿ç¨‹ID+æ¯«ç§’æ—¶é—´æˆ³åšç§å­","like_count":3},{"had_liked":false,"id":102022,"user_name":"WL","can_delete":false,"product_type":"c1","uid":1173771,"ip_address":"","ucode":"6277DCD776B87E","user_header":"https://static001.geekbang.org/account/avatar/00/11/e9/0b/1171ac71.jpg","comment_is_top":false,"comment_ctime":1560120393,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10150054985","product_id":100028301,"comment_content":"è¯·é—®ä¸€ä¸‹è€å¸ˆæˆ‘è¿™è¾¹luajit -v å’Œ  opm -v éƒ½æç¤ºå‘½ä»¤æ‰¾ä¸åˆ°, openrestyçš„ç‰ˆæœ¬æ˜¯openresty&#47;1.15.8.1, æƒ³é—®ä¸‹è¿™ç§è¯·æƒ…å†µæ˜¯å•¥åŸå› , åº”è¯¥å’‹è§£å†³","like_count":2},{"had_liked":false,"id":102009,"user_name":"mz","can_delete":false,"product_type":"c1","uid":1003581,"ip_address":"","ucode":"1D714C23F78446","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/MlmSR4YXUfrNlZdMv7bv1ic64HaxxVKcVtaxjzhXCvNC4XByICCmYUTprhOESzIV8p59N6DnSJ7HywfvGr5nicgA/132","comment_is_top":false,"comment_ctime":1560097405,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10150031997","product_id":100028301,"comment_content":"æˆ‘æ€ä¹ˆæ„Ÿè§‰ go è¯­è¨€é‚£ä¸ªä¸éœ€è¦çš„è¿”å›å€¼çš„å†™æ³•å°±æ˜¯å€Ÿé‰´çš„ lua è™šå˜é‡","like_count":2},{"had_liked":false,"id":156906,"user_name":"nicknick","can_delete":false,"product_type":"c1","uid":1755306,"ip_address":"","ucode":"E5EA45655DA349","user_header":"","comment_is_top":false,"comment_ctime":1574994377,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5869961673","product_id":100028301,"comment_content":"æ‰€è°“çš„è™šå˜é‡å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„å˜é‡ï¼Œæ²¡æœ‰ä»»ä½•ç‰¹æ®Šä¹‹å¤„ï¼Œåªä¸è¿‡æ˜¯ä¸ç”¨å®ƒçš„å€¼è€Œå·²ï¼Œå•ç‹¬æ‹¿å‡ºæ¥åšä¸€ä¸ªæ¦‚å¿µæ˜¯å¦æœ‰å¿…è¦","like_count":1},{"had_liked":false,"id":356177,"user_name":"JoyZ","can_delete":false,"product_type":"c1","uid":3169664,"ip_address":"æ¹–åŒ—","ucode":"46472C7B9E34DB","user_header":"https://static001.geekbang.org/account/avatar/00/30/5d/80/139d3f02.jpg","comment_is_top":false,"comment_ctime":1662025841,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1662025841","product_id":100028301,"comment_content":"è€å¸ˆï¼Œè¯·é—®ä¸‹æˆ‘é€šè¿‡openrestyåœ¨luaä»£ç é‡Œprint(9223372036854775807LL - 1)è¿™æ ·ä¸ºä»€ä¹ˆæŠ¥é”™å‘¢ï¼Ÿ<br>æç¤ºï¼š<br>bad argument #1 to &#39;print&#39; (string, number, boolean, or nil expected, got cdata)<br>åªæœ‰è½¬tostringåè¿™æ ·print(tostring(9223372036854775807LL - 1))æ‰èƒ½æ­£ç¡®æ‰“å°","like_count":0},{"had_liked":false,"id":324278,"user_name":"Leo","can_delete":false,"product_type":"c1","uid":2858431,"ip_address":"","ucode":"24D1E66E284411","user_header":"","comment_is_top":false,"comment_ctime":1638354312,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638354312","product_id":100028301,"comment_content":"åˆšå¼€å§‹å­¦luaè„šæœ¬çš„æ—¶å€™ï¼Œå¾ˆä¸ä¹ æƒ¯ï¼Œä¸€ä¸ªå‡½æ•°èƒ½åŒæ—¶è¿”å›å¤šä¸ªå˜é‡ï¼Œç­‰åæ¥å‘ç°æŒºæ–¹ä¾¿çš„ï¼Œæ˜“äºæ‰©å±•","like_count":0},{"had_liked":false,"id":209370,"user_name":"Surjur","can_delete":false,"product_type":"c1","uid":1771363,"ip_address":"","ucode":"D86AC620E59CB1","user_header":"https://static001.geekbang.org/account/avatar/00/1b/07/63/c54d40f4.jpg","comment_is_top":false,"comment_ctime":1587542393,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587542393","product_id":100028301,"comment_content":"æ¸©è€å¸ˆï¼Œæ‚¨å¥½ï¼šæˆ‘åœ¨çœ‹luajitå’ŒluaåŒºåˆ«çš„æ—¶å€™æœ‰äº›ç–‘é—®ï¼š<br>1. luajitç¼–è¯‘ç”Ÿæˆçš„æœºå™¨ç æ˜¯ä¸€ç›´ä¿å­˜åœ¨å†…å­˜é‡Œçš„å—ï¼Ÿ<br>2. ä¸€èˆ¬çº¿ä¸Šç¯å¢ƒï¼Œæé«˜æ€§èƒ½ï¼Œlua_code_cacheæ˜¯å¼€å¯çš„ï¼Œæ‰€ä»¥å¦‚æœluaä»£ç æœ‰æ”¹åŠ¨ï¼Œéœ€è¦reload nginxï¼Œæ–°çš„ä»£ç æ‰èƒ½ç”Ÿæ•ˆï¼Œé‚£ä¸€æ—¦reloadäº†ï¼Œä¹‹å‰ç¼–è¯‘å¥½çš„æœºå™¨ç è¿˜å­˜åœ¨å—ï¼Ÿ<br>3. luajit vmä¹‹æ‰€ä»¥ç›¸å¯¹lua vmé«˜æ•ˆï¼Œæ˜¯å› ä¸ºä¸€äº›çƒ­ä»£ç å°‘äº†å­—èŠ‚ç è½¬æœºå™¨ç çš„è¿‡ç¨‹ï¼Œå› ä¸ºå·²ç»æœ‰ç¼–è¯‘ç”Ÿæˆäº†æœºå™¨ç ï¼Œç›´æ¥æ‰§è¡Œæœºå™¨ç å³å¯ï¼Œæ˜¯è¿™æ ·å—ï¼Ÿ","like_count":1},{"had_liked":false,"id":162317,"user_name":"çº¢é²¤é±¼ä¸ç»¿é²¤é±¼ä¸é©´baci","can_delete":false,"product_type":"c1","uid":1199902,"ip_address":"","ucode":"CB7D8A522D665E","user_header":"https://static001.geekbang.org/account/avatar/00/12/4f/1e/cb8ddbe9.jpg","comment_is_top":false,"comment_ctime":1576499380,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576499380","product_id":100028301,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œåœ¨ Lua ä¸­ï¼Œæœ‰ä¸‰ç§æ–¹å¼å¯ä»¥è¡¨è¾¾ä¸€ä¸ªå­—ç¬¦ä¸²ï¼šå•å¼•å·ã€åŒå¼•å·ï¼Œä»¥åŠé•¿æ‹¬å·ï¼ˆ[[]]ï¼‰ï¼Œé‚£å•å¼•å·å’ŒåŒå¼•å·ä¹‹å‰æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢","like_count":0},{"had_liked":false,"id":138549,"user_name":"åˆ€æ–§æ‰‹ä½•åœ¨","can_delete":false,"product_type":"c1","uid":1202572,"ip_address":"","ucode":"B99D7ECC3EE954","user_header":"https://static001.geekbang.org/account/avatar/00/12/59/8c/ba81a832.jpg","comment_is_top":false,"comment_ctime":1570331319,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1570331319","product_id":100028301,"comment_content":"è€å¸ˆï¼Œæœ‰ä¸ªé—®é¢˜è¯·æ•™ä¸€ä¸‹ã€‚æˆ‘çš„ä»£ç å¤§æ¦‚æ˜¯è¿™æ ·çš„ã€‚<br>```<br>ngx.req.read_body() -- è§£æ body å‚æ•°ä¹‹å‰ä¸€å®šè¦å…ˆè¯»å– body<br>local arg = ngx.req.get_post_args()<br>--ngx.say(type(arg))<br>ngx.print(arg)<br>```<br>ç„¶ångx.sayçš„æ—¶å€™argæ˜¯tableç±»å‹ã€‚ngx.printæˆ‘çœ‹æ–‡æ¡£æ˜¯è¯´æ”¯æŒæ‰“å°tableçš„https:&#47;&#47;github.com&#47;openresty&#47;lua-nginx-module#ngxprintã€‚ä½†æ˜¯æˆ‘ ngx.print(arg)å°±ä¼šæŠ¥é”™ã€‚<br>error-logæ˜¯è¿™æ ·çš„ã€‚<br>```<br>2019&#47;10&#47;06 10:57:27 [error] 42634#1017147: *50 lua entry thread aborted: runtime error: &#47;Users&#47;fang&#47;Code&#47;lua_test&#47;lua_script&#47;params.lua:9: bad argument #1 to &#39;print&#39; (non-array table found)<br>stack traceback:<br>coroutine 0:<br>\t[C]: in function &#39;print&#39;<br>\t&#47;Users&#47;fang&#47;Code&#47;lua_test&#47;lua_script&#47;params.lua:9: in main chunk, client: 127.0.0.1, server: localhost, request: &quot;POST &#47;print_params HTTP&#47;1.1&quot;, host: &quot;localhost&quot;<br>```<br>æç¤ºå‚æ•°å‡ºé”™ no array or table found ã€‚ é‚£ä¹ˆè¿™ä¸ª arg åˆ°åº•æ˜¯ä¸æ˜¯ä¸€ä¸ªtable","like_count":0,"discussions":[{"author":{"id":1325126,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/dglMUGgevn9w5w3AGtTDibGhqGjf7G3GHwlOGXQl25xD7g2EsEktgxh2v4dgriaI2yLG2j45IhZCbhVg1eDrugOQ/132","nickname":"1024","note":"","ucode":"9DFAF1F44D469F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":82936,"discussion_content":"ngx.printåªæ”¯æŒæ•°å­—ç´¢å¼•çš„ä¸€ç»´æ•°ç»„ï¼Œå¦‚ï¼š{&#39;a&#39;, &#39;b&#39;, &#39;c&#39;}","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576402506,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113366,"user_name":"å²æœˆå¦‚æ­Œ","can_delete":false,"product_type":"c1","uid":1428828,"ip_address":"","ucode":"1AEBD6F79941B7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/QFE00aXGzaS6ibbfJSJsDrpIkqs0OrIYjzZv6L9vZmMhOlut2j24iaeZb0MCQazToE6FRXN960nNiaTrsmw09YjGw/132","comment_is_top":false,"comment_ctime":1562984960,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562984960","product_id":100028301,"comment_content":"æ€è€ƒé¢˜ï¼šä½¿ç”¨ç³»ç»Ÿæ—¶é—´æˆ³ä½œä¸ºç§å­ åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­æœºå™¨çš„æ—¶é—´ä¸ä¸€è‡´ å¯¼è‡´å¯èƒ½äº§ç”Ÿçš„ç§å­æ˜¯ä¸€æ ·çš„ è¿›è€Œå¯èƒ½å¯¼è‡´éšæœºæ•°ä¸å†éšæœºã€‚ è§£å†³çš„é˜²æ­¢å¯ä»¥ä½¿ç”¨ç»Ÿä¸€çš„æ—¶é—´æœºå™¨ è€Œé å„è‡ªæœºå™¨çš„æ—¶é—´ã€‚ è¿™ä¸ªé—®é¢˜è·Ÿç”Ÿäº§å”¯ä¸€æ€§åˆ†å¸ƒå¼IDæœ‰ç‚¹å…³è”","like_count":0},{"had_liked":false,"id":110030,"user_name":"å¤å¤©çš„é£","can_delete":false,"product_type":"c1","uid":1102202,"ip_address":"","ucode":"8B545AD138C18B","user_header":"https://static001.geekbang.org/account/avatar/00/10/d1/7a/ea521259.jpg","comment_is_top":false,"comment_ctime":1562153655,"is_pvip":false,"replies":[{"id":"40892","content":"æ¨èåœ¨ Linux ç¯å¢ƒè¿è¡Œä¸“æ çš„ä»£ç ï¼ŒWindows ä¸ŠOpenResty è‡ªå·±ä¹Ÿæ˜¯åŠŸèƒ½å—é™çš„ã€‚","user_name":"ä½œè€…å›å¤","comment_id":110030,"uid":"1017955","ip_address":"","utype":1,"ctime":1562736376,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"1562153655","product_id":100028301,"comment_content":"è¯·é—®ä¸€ä¸‹windowsä¸Šæ€ä¹ˆè¿è¡Œrestyï¼Œæˆ‘çœ‹ç”¨luajit a.luaæ˜¯å¯ä»¥æˆåŠŸçš„ï¼Œç”¨luajit -e &#39;print(&quot;hello&quot;)&#39; ä¼šæŠ¥é”™ï¼Œç”¨resty -e &#39;print(&quot;hello&quot;)&#39; ä¹Ÿä¼šæŠ¥åŒæ ·çš„é”™è¯¯ã€‚<br>D:\\lua&gt;luajit -e &#39;print(&quot;hello&quot;)&#39;<br>luajit: (command line):1: unexpected symbol near &#39;&#39;print(hello)&#39;&#39;<br> <br>D:\\lua&gt;luajit a.lua<br>hello world<br><br>","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456691,"discussion_content":"æ¨èåœ¨ Linux ç¯å¢ƒè¿è¡Œä¸“æ çš„ä»£ç ï¼ŒWindows ä¸ŠOpenResty è‡ªå·±ä¹Ÿæ˜¯åŠŸèƒ½å—é™çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562736376,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104927,"user_name":"wusiration","can_delete":false,"product_type":"c1","uid":1104438,"ip_address":"","ucode":"A9403377054F1E","user_header":"https://static001.geekbang.org/account/avatar/00/10/da/36/ac0ff6a7.jpg","comment_is_top":false,"comment_ctime":1560872098,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560872098","product_id":100028301,"comment_content":"ç§’çº§çš„os.timeåœ¨çŸ­æ—¶é—´è°ƒç”¨ä¸­ï¼Œrandomå‡½æ•°ä¼šä»¥ç›¸åŒçš„éšæœºç§å­äº§ç”Ÿç›¸åŒçš„éšæœºæ•°","like_count":0},{"had_liked":false,"id":104180,"user_name":"å°é£å“¥ â€è¶…ç´šæœƒå“¡","can_delete":false,"product_type":"c1","uid":1110049,"ip_address":"","ucode":"417F9563B3005B","user_header":"https://static001.geekbang.org/account/avatar/00/10/f0/21/104b9565.jpg","comment_is_top":false,"comment_ctime":1560676475,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1560676475","product_id":100028301,"comment_content":"localhost: &#47;usr&#47;local&#47;opt&#47;openresty&gt; ll &#47;usr&#47;local&#47;Cellar&#47;openresty&#47;1.15.8.1&#47;luajit&#47;bin&#47;luajit<br>lrwxr-xr-x  1 yuesf  admin  18  6 12 07:04 &#47;usr&#47;local&#47;Cellar&#47;openresty&#47;1.15.8.1&#47;luajit&#47;bin&#47;luajit -&gt; luajit-2.1.0-beta3<br>localhost: &#47;usr&#47;local&#47;opt&#47;openresty&gt; luajit -v<br>-bash: luajit: command not found<br><br>luajit æ˜¯ä¸æ˜¯å­˜åœ¨ï¼Œ ä¸ºä»€ä¹ˆ æ‰§è¡Œluajit å‘½ä»¤è¯´ä¸å­˜åœ¨<br>","like_count":0,"discussions":[{"author":{"id":1950389,"avatar":"","nickname":"æ— å…³é£æœˆ","note":"","ucode":"F5979EB048F7FE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558760,"discussion_content":"æˆ‘ä¹Ÿæ˜¯è¿™æ ·è¯·é—®æ€ä¹ˆè§£å†³çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648455858,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1960712,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/ibXBFWREdicZXJYEqwzSK5LuHL3EqCo1oUx8KUhhz6SG5qJkicFbaUAq4RWR17ky5o5k3XdYY9YZqzBTdlOmDiatEQ/132","nickname":"èŒƒå†å†›","note":"","ucode":"E058BCF3BD2E4E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":234940,"discussion_content":"ç”¨restyå‘½ä»¤å°±è¡Œ resty hello.lua","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587006901,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104179,"user_name":"å°é£å“¥ â€è¶…ç´šæœƒå“¡","can_delete":false,"product_type":"c1","uid":1110049,"ip_address":"","ucode":"417F9563B3005B","user_header":"https://static001.geekbang.org/account/avatar/00/10/f0/21/104b9565.jpg","comment_is_top":false,"comment_ctime":1560676270,"is_pvip":false,"replies":[{"id":"37914","content":"luajit åœ¨ &#47;usr&#47;local&#47;openresty&#47;luajit&#47; ç›®å½•ä¸­ï¼Œé¿å…æ±¡æŸ“ç³»ç»Ÿçš„ luajit","user_name":"ä½œè€…å›å¤","comment_id":104179,"uid":"1017955","ip_address":"","utype":1,"ctime":1560840392,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"1560676270","product_id":100028301,"comment_content":"ä¸ºä»€ä¹ˆæˆ‘è¿™é‡Œæ²¡æœ‰luajitï¼Ÿ<br>localhost: ~&gt; whicht luajit<br>-bash: whicht: command not found<br>localhost: ~&gt; which luajit<br>localhost: ~&gt; luajit -v<br>-bash: luajit: command not found<br>localhost: ~&gt;<br><br>æ˜¯å¦æˆ‘å®‰è£…æœ‰é—®é¢˜<br>localhost: &#47;usr&#47;local&#47;opt&#47;openresty&gt; pwd<br>&#47;usr&#47;local&#47;opt&#47;openresty<br>localhost: &#47;usr&#47;local&#47;opt&#47;openresty&gt; openresty -v<br>nginx version: openresty&#47;1.15.8.1<br>localhost: &#47;usr&#47;local&#47;opt&#47;openresty&gt;","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454161,"discussion_content":"luajit åœ¨ /usr/local/openresty/luajit/ ç›®å½•ä¸­ï¼Œé¿å…æ±¡æŸ“ç³»ç»Ÿçš„ luajit","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560840392,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":102232,"user_name":"chengzise","can_delete":false,"product_type":"c1","uid":1006070,"ip_address":"","ucode":"1C27D216359894","user_header":"https://static001.geekbang.org/account/avatar/00/0f/59/f6/ed66d1c1.jpg","comment_is_top":false,"comment_ctime":1560165824,"is_pvip":false,"replies":[{"id":"37358","content":"å°±æ˜¯è¦æœ‰è¶³å¤Ÿçš„ç†µ","user_name":"ä½œè€…å›å¤","comment_id":102232,"uid":"1017955","ip_address":"","utype":1,"ctime":1560410650,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"1560165824","product_id":100028301,"comment_content":"1. ç”¨å½“å‰æ—¶é—´æˆ³ä½œä¸ºç§å­çš„ï¼Œæ˜¯é€šç”¨åšæ³•æ²¡æœ‰ä»€ä¹ˆå¤§é—®é¢˜ã€‚è¿™ç§æ–¹å¼åˆ©ç”¨çš„æ˜¯éšæœºæ•°ç”Ÿæˆå‡½æ•°ï¼Œéšæœºæ•°é‡å¤å‘¨æœŸå¾ˆé•¿è€Œå·²ï¼Œä¸èƒ½ç®—æ˜¯å®Œå…¨éšæœºã€‚ å¤§å¤šæ•°ä½¿ç”¨ç¯å¢ƒæ²¡ä»€ä¹ˆé—®é¢˜ã€‚<br>2. åœ¨è¦æ±‚ä¸¥æ ¼éšæœºæ•°ç¯å¢ƒä¸­ï¼Œä¾‹å¦‚ï¼šåŠ è§£å¯†ç®—æ³•ã€‚å¯ä»¥ä½¿ç”¨ç³»ç»Ÿæä¾›çš„éšæœºæ•°æ¥å£ï¼Œè¿™ç§æ–¹å¼åˆ©ç”¨çš„æ˜¯èŠ¯ç‰‡ç”µç£å™ªå£°æ¥ç”Ÿæˆéšæœºæ•°ã€‚ç”±äºéœ€è¦ç»è¿‡ç³»ç»Ÿè°ƒç”¨ï¼Œç†è®ºä¸Šé€Ÿåº¦æ²¡æœ‰ç¬¬ä¸€ç§æ–¹å¼å¿«ã€‚<br>å¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©å“ªç§æ–¹å¼ã€‚","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453303,"discussion_content":"å°±æ˜¯è¦æœ‰è¶³å¤Ÿçš„ç†µ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560410650,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":102192,"user_name":"cylim","can_delete":false,"product_type":"c1","uid":1005082,"ip_address":"","ucode":"941310C208BDC1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/56/1a/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1560158712,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560158712","product_id":100028301,"comment_content":"brew install luajit å®‰è£…luajitã€‚ opmæ²¡æœ‰-vå‚æ•°ï¼Œå¯æ˜¯æ˜¯å¯ä»¥ç”¨çš„ã€‚","like_count":0},{"had_liked":false,"id":102128,"user_name":"æ—ºæ—º","can_delete":false,"product_type":"c1","uid":1159196,"ip_address":"","ucode":"FE2CF90F446BFB","user_header":"https://static001.geekbang.org/account/avatar/00/11/b0/1c/2e30eeb8.jpg","comment_is_top":false,"comment_ctime":1560144092,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560144092","product_id":100028301,"comment_content":"luajit -v å’Œ opm -v éƒ½æç¤ºå‘½ä»¤æ‰¾ä¸åˆ°, è¿™è‚¯å®šæ˜¯PATHçš„è®¾ç½®ä¸å¯¹ã€‚<br>lua ä¸­pairs å’Œ ipairsåŒºåˆ«å¯ä»¥å‚è€ƒä¸‹é¢çš„æ–‡ç« ï¼š<br>https:&#47;&#47;blog.csdn.net&#47;witch_soya&#47;article&#47;details&#47;7556595","like_count":0},{"had_liked":false,"id":102124,"user_name":"moshufenmo","can_delete":false,"product_type":"c1","uid":1291505,"ip_address":"","ucode":"75A9E237825AF6","user_header":"https://static001.geekbang.org/account/avatar/00/13/b4/f1/61cd0653.jpg","comment_is_top":false,"comment_ctime":1560142232,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560142232","product_id":100028301,"comment_content":"ä»£è¡¨key æ²¡æœ‰å®é™…æ„ä¹‰","like_count":0},{"had_liked":false,"id":102042,"user_name":"ä¸€æ­¥","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1560125681,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1560125681","product_id":100028301,"comment_content":"æ‰§è¡Œ resty -e &#39;print(math.random())&#39;<br>æ‰§è¡Œå¤šæ¬¡ï¼Œä¸ºä»€ä¹ˆæ¯æ¬¡ç”Ÿæˆçš„éšæœºæ•°éƒ½ä¸€æ ·å‘¢ï¼Ÿ<br>","like_count":0,"discussions":[{"author":{"id":1305369,"avatar":"https://static001.geekbang.org/account/avatar/00/13/eb/19/0d990b03.jpg","nickname":"ZeroIce","note":"","ucode":"30133BA83CE349","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3798,"discussion_content":"ä½ è§£å†³äº†ï¼Ÿæˆ‘ä¹Ÿæ˜¯è¿™æ ·å­","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564817743,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":102026,"user_name":"WL","can_delete":false,"product_type":"c1","uid":1173771,"ip_address":"","ucode":"6277DCD776B87E","user_header":"https://static001.geekbang.org/account/avatar/00/11/e9/0b/1171ac71.jpg","comment_is_top":false,"comment_ctime":1560123041,"is_pvip":false,"replies":[{"id":"37363","content":"ä»£è¡¨çš„å°±æ˜¯ä¸‹æ ‡ï¼Œä¹Ÿå°±æ˜¯ key","user_name":"ä½œè€…å›å¤","user_name_real":"æ¸©é“­@OpenResty","uid":"1017955","ctime":1560410810,"ip_address":"","comment_id":102026,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560123041","product_id":100028301,"comment_content":"è¯·é—®ä¸€ä¸‹è€å¸ˆåœ¨for _, v in ipairs({4,5,6}) do ... è¿™æ®µä»£ç ä¸­çš„è™šå˜é‡è¡¨ç¤ºçš„æ˜¯ä»€ä¹ˆå«ä¹‰, æœ‰ç‚¹æ²¡å¤ªçœ‹æ‡‚.","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453222,"discussion_content":"ä»£è¡¨çš„å°±æ˜¯ä¸‹æ ‡ï¼Œä¹Ÿå°±æ˜¯ key","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560410810,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}