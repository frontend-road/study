{"id":89306,"title":"57 | 套路篇：Linux 性能工具速查","content":"<p>你好，我是倪朋飞。</p><p>上一节，我带你一起梳理了常见的性能优化思路，先简单回顾一下。</p><p>我们可以从系统和应用程序两个角度，来进行性能优化。</p><ul>\n<li>\n<p>从系统的角度来说，主要是对 CPU、内存、网络、磁盘 I/O 以及内核软件资源等进行优化。</p>\n</li>\n<li>\n<p>而从应用程序的角度来说，主要是简化代码、降低 CPU 使用、减少网络请求和磁盘 I/O，并借助缓存、异步处理、多进程和多线程等，提高应用程序的吞吐能力。</p>\n</li>\n</ul><p>性能优化最好逐步完善，动态进行。不要追求一步到位，而要首先保证能满足当前的性能要求。性能优化通常意味着复杂度的提升，也意味着可维护性的降低。</p><p>如果你发现单机的性能调优带来过高复杂度，一定不要沉迷于单机的极限性能，而要从软件架构的角度，以水平扩展的方法来提升性能。</p><p>工欲善其事，必先利其器。我们知道，在性能分析和优化时，借助合适的性能工具，可以让整个过程事半功倍。你还记得有哪些常用的性能工具吗？今天，我就带你一起梳理一下常用的性能工具，以便你在需要时，可以迅速找到自己想要的。</p><h2>性能工具速查</h2><p>在梳理性能工具之前，首先给你提一个问题，那就是，在什么情况下，我们才需要去查找、挑选性能工具呢？你可以先自己想一下，再继续下面的内容。</p><p>其实在我看来，只有当你想了解某个性能指标，却不知道该怎么办的时候，才会想到，“要是有一个性能工具速查表就好了”这个问题。如果已知一个性能工具可用，我们更多会去查看这个工具的手册，找出它的功能、用法以及注意事项。</p><!-- [[[read_end]]] --><p>关于工具手册的查看，man 应该是我们最熟悉的方法，我在专栏中多次介绍过。实际上，除了 man 之外，还有另外一个查询命令手册的方法，也就是 info。</p><p>info 可以理解为 man 的详细版本，提供了诸如节点跳转等更强大的功能。相对来说，man 的输出比较简洁，而 info 的输出更详细。所以，我们通常使用 man 来查询工具的使用方法，只有在man 的输出不太好理解时，才会再去参考 info 文档。</p><p>当然，我说过了，要查询手册，前提一定是已知哪个工具可用。如果你还不知道要用哪个工具，就要根据想了解的指标，去查找有哪些工具可用。这其中：</p><ul>\n<li>\n<p>有些工具不需要额外安装，就可以直接使用，比如内核的 /proc 文件系统；</p>\n</li>\n<li>\n<p>而有些工具，则需要安装额外的软件包，比如 sar、pidstat、iostat 等。</p>\n</li>\n</ul><p><strong>所以，在选择性能工具时，除了要考虑性能指标这个目的外，还要结合待分析的环境来综合考虑</strong>。比如，实际环境是否允许安装软件包，是否需要新的内核版本等。</p><p>明白了工具选择的基本原则后，我们来看 Linux 的性能工具。首先还是要推荐下面这张图，也就是Brendan Gregg 整理的性能工具谱图。我在专栏中多次提到过，你肯定也已经参考过。<br>\n<img src=\"https://static001.geekbang.org/resource/image/b0/01/b07ca95ef8a3d2c89b0996a042d33901.png?wh=3000*2100\" alt=\"\"><br>\n（图片来自 <a href=\"http://www.brendangregg.com/linuxperf.html\">brendangregg.com</a>）</p><p>这张图从 Linux 内核的各个子系统出发，汇总了对各个子系统进行性能分析时，你可以选择的工具。不过，虽然这个图是性能分析最好的参考资料之一，它其实还不够具体。</p><p>比如，当你需要查看某个性能指标时，这张图里对应的子系统部分，可能有多个性能工具可供选择。但实际上，并非所有这些工具都适用，具体要用哪个，还需要你去查找每个工具的手册，对比分析做出选择。</p><p>那么，有没有更好的方法来理解这些工具呢？<strong>我的建议，还是从性能指标出发，根据性能指标的不同，将性能工具划分为不同类型</strong>。比如，最常见的就是可以根据 CPU、内存、磁盘 I/O 以及网络的各类性能指标，将这些工具进行分类。</p><p>接下来，我就从 CPU、内存、磁盘 I/O 以及网络等几个角度，梳理这些常见的 Linux 性能工具，特别是从性能指标的角度出发，理清楚到底有哪些工具，可以用来监测特定的性能指标。这些工具，实际上贯穿在我们专栏各模块的各个案例中。为了方便你查看，我将它们都整理成了表格，并增加了每个工具的使用场景。</p><h2>CPU性能工具</h2><p>首先，从 CPU 的角度来说，主要的性能指标就是 CPU 的使用率、上下文切换以及 CPU Cache 的命中率等。下面这张图就列出了常见的 CPU 性能指标。<br>\n<img src=\"https://static001.geekbang.org/resource/image/9a/69/9a211905538faffb5b3221ee01776a69.png?wh=1241*1212\" alt=\"\"><br>\n从这些指标出发，再把 CPU 使用率，划分为系统和进程两个维度，我们就可以得到，下面这个 CPU 性能工具速查表。注意，因为每种性能指标都可能对应多种工具，我在每个指标的说明中，都帮你总结了这些工具的特点和注意事项。这些也是你需要特别关注的地方。<br>\n<img src=\"https://static001.geekbang.org/resource/image/28/b0/28cb85011289f83804c51c1fb275dab0.png?wh=1707*2563\" alt=\"\"></p><h2>内存性能工具</h2><p>接着我们来看内存方面。从内存的角度来说，主要的性能指标，就是系统内存的分配和使用、进程内存的分配和使用以及 SWAP 的用量。下面这张图列出了常见的内存性能指标。<br>\n<img src=\"https://static001.geekbang.org/resource/image/ee/c0/ee36f73b9213063b3bcdaed2245944c0.png?wh=1581*1760\" alt=\"\"><br>\n从这些指标出发，我们就可以得到如下表所示的内存性能工具速查表。同 CPU 性能工具一样，这儿我也帮你梳理了，常见工具的特点和注意事项。<br>\n<img src=\"https://static001.geekbang.org/resource/image/79/f8/79ad5caf0a2c105b7e9ce77877d493f8.png?wh=1653*2198\" alt=\"\"><br>\n注：最后一行pcstat的源码链接为 <a href=\"https://github.com/tobert/pcstat\">https://github.com/tobert/pcstat</a></p><h2>磁盘I/O性能工具</h2><p>接下来，从文件系统和磁盘 I/O 的角度来说，主要性能指标，就是文件系统的使用、缓存和缓冲区的使用，以及磁盘 I/O 的使用率、吞吐量和延迟等。下面这张图列出了常见的 I/O 性能指标。<br>\n<img src=\"https://static001.geekbang.org/resource/image/72/3b/723431a944034b51a9ef13a8a1d4d03b.png?wh=2631*808\" alt=\"\"><br>\n从这些指标出发，我们就可以得到，下面这个文件系统和磁盘 I/O 性能工具速查表。同 CPU和内存性能工具一样，我也梳理出了这些工具的特点和注意事项。<br>\n<img src=\"https://static001.geekbang.org/resource/image/c2/a3/c232dcb4185f7b7ba95c126889cf6fa3.png?wh=1714*2424\" alt=\"\"></p><h2>网络性能工具</h2><p>最后，从网络的角度来说，主要性能指标就是吞吐量、响应时间、连接数、丢包数等。根据 TCP/IP 网络协议栈的原理，我们可以把这些性能指标，进一步细化为每层协议的具体指标。这里我同样用一张图，分别从链路层、网络层、传输层和应用层，列出了各层的主要指标。<br>\n<img src=\"https://static001.geekbang.org/resource/image/37/a4/37d04c213acfa650bd7467e3000356a4.png?wh=1983*1104\" alt=\"\"><br>\n从这些指标出发，我们就可以得到下面的网络性能工具速查表。同样的，我也帮你梳理了各种工具的特点和注意事项。<br>\n<img src=\"https://static001.geekbang.org/resource/image/5d/5d/5dde213baffd7811ab73c82883b2a75d.png?wh=1709*2462\" alt=\"\"></p><h2>基准测试工具</h2><p>除了性能分析外，很多时候，我们还需要对系统性能进行基准测试。比如，</p><ul>\n<li>\n<p>在文件系统和磁盘 I/O 模块中，我们使用 fio 工具，测试了磁盘 I/O 的性能。</p>\n</li>\n<li>\n<p>在网络模块中，我们使用 iperf、pktgen 等，测试了网络的性能。</p>\n</li>\n<li>\n<p>而在很多基于 Nginx 的案例中，我们则使用 ab、wrk 等，测试 Nginx 应用的性能。</p>\n</li>\n</ul><p>除了专栏里介绍过的这些工具外，对于 Linux 的各个子系统来说，还有很多其他的基准测试工具可能会用到。下面这张图，是 Brendan Gregg 整理的 Linux 基准测试工具图谱，你可以保存下来，在需要时参考。<br>\n<img src=\"https://static001.geekbang.org/resource/image/f0/e9/f094f489049602e1058e02edc708e6e9.png?wh=1500*1050\" alt=\"\"><br>\n（图片来自 <a href=\"http://www.brendangregg.com/linuxperf.html\">brendangregg.com</a>）</p><h2>小结</h2><p>今天，我们一起梳理了常见的性能工具，并从 CPU、内存、文件系统和磁盘 I/O、网络以及基准测试等不同的角度，汇总了各类性能指标所对应的性能工具速查表。</p><p>当分析性能问题时，大的来说，主要有这么两个步骤：</p><ul>\n<li>\n<p>第一步，从性能瓶颈出发，根据系统和应用程序的运行原理，确认待分析的性能指标。</p>\n</li>\n<li>\n<p>第二步，根据这些图表，选出最合适的性能工具，然后了解并使用工具，从而更快观测到需要的性能数据。</p>\n</li>\n</ul><p>虽然 Linux 的性能指标和性能工具都比较多，但熟悉了各指标含义后，你自然就会发现这些工具同性能指标间的关联。顺着这个思路往下走，掌握这些工具的选用其实并不难。</p><p>当然，正如咱们专栏一直强调的，不要把性能工具当成性能分析和优化的全部。</p><ul>\n<li>\n<p>一方面，性能分析和优化的核心，是对系统和应用程序运行原理的掌握，而性能工具只是辅助你更快完成这个过程的帮手。</p>\n</li>\n<li>\n<p>另一方面，完善的监控系统，可以提供绝大部分性能分析所需的基准数据。从这些数据中，你很可能就能大致定位出性能瓶颈，也就不用再去手动执行各类工具了。</p>\n</li>\n</ul><h2>思考</h2><p>最后，我想邀请你一起来聊聊，你都使用过哪些性能工具。你通常是怎么选择性能工具的？又是如何想到要用这些性能工具，来排查和分析性能问题的？你可以结合我的讲述，总结自己的思路。</p><p>欢迎在留言区和我讨论，也欢迎你把这篇文章分享给你的同事、朋友。我们一起在实战中演练，在交流中进步。</p><p></p>","comments":[{"had_liked":false,"id":243174,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1597981732,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"48842621988","product_id":100020901,"comment_content":"思考：<br>⭐问题，办法，工具的关系——问题是人一生中唯一的事。解决问题的办法有很多，办法使用到的工具������️也有很多。<br><br>⭐转化——核心技术，是一种重要的工具，行之有效的工具，少了这个核心工具就做不成事情，此时的工具就转化为办法。<br><br>⭐技术，是一种工具，不要误以为是办法。只有当除此技术就无法解决问题的时候，技术工具才是办法本身，比如ai,大数据只是解决问题的办法，tensorflow,spark等是解决问题的工具。<br><br>⭐工具，似乎不可能唯一。当解决问题的办法出现后，工具也趋向多元化。所以，似乎办法比工具重要的多。<br><br>⭐办法，也就是方法，解决问题的思路，步骤。需要理解问题的结构、细节，进而采取措施。兵来将挡，水来土掩。所以，关键就是知道兵将关系，水土关系，理解问题，剖析问题是根本。<br><br>⭐问题，是程序bug？运营问题？管理问题？一个问题的出现可能由多方因素。<br><br>那么作为技术人员，能拿技术解决什么问题？解决问题，才能收货利益。比如朝九晚五写bug，夜以继日搞私活。解决的问题都不是痛点，或者并不是太痛。<br><br>⭐痛点，有多痛，就有多大价值，就可以带来多大收益。要体现自我价值，就得解决痛点。谁解决了痛点，谁就是有价值的人。但痛点本身与技术无关。<br>一句话：抓住痛点(方向)，剖析原理(方法)，用好工具(利剑)。<br>-----拿着’利剑‘用正确的’方法‘挥向正确的’方向‘--------------------","like_count":12},{"had_liked":false,"id":83605,"user_name":"Linuxer","can_delete":false,"product_type":"c1","uid":1153978,"ip_address":"","ucode":"272D9D8089C3D6","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/ba/333b59e5.jpg","comment_is_top":false,"comment_ctime":1554684202,"is_pvip":false,"replies":[{"id":"30379","content":"嗯 这确实是经验式的，没有绝对的指标，不同应用不同场景都不太一样。不过USE法的这些指标都比较直观，可以优先查看","user_name":"作者回复","comment_id":83605,"uid":"1001282","ip_address":"","utype":1,"ctime":1554815683,"user_name_real":"倪朋飞"}],"discussion_count":3,"race_medal":0,"score":"35914422570","product_id":100020901,"comment_content":"有一个问题请教，很多时候工具有了，但是对于指标是否在合理范围好像没有明确的标准，都是经验式的","like_count":8,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446091,"discussion_content":"嗯 这确实是经验式的，没有绝对的指标，不同应用不同场景都不太一样。不过USE法的这些指标都比较直观，可以优先查看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554815683,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1916685,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/3f/0d/1e8dbb2c.jpg","nickname":"怀揣梦想的学渣","note":"","ucode":"2349B9F4F6FDE3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":225187,"discussion_content":"视频服务商相关场景，对于存储的话，可以使用60%这个标准，进行预警，70%开始洽谈扩容，80%的时候开始排查是否有可以优化的。90%的时候要么紧急扩容，要么申请清除一部分。我之前合作过几个做存储的厂家，基本都是这样的搞法。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1586351945,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1852596,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKFJrITQiaArYFhOMJ1leaJFickkPz9tf5fV77UaicTW6SeQHt9mrricUD8zT6ByLibIhEERupMNtq76Rg/132","nickname":"岑文佳","note":"","ucode":"A083C2B5DEA6B9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332987,"discussion_content":"开始学习，加油💪","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607409798,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86069,"user_name":"大坏狐狸","can_delete":false,"product_type":"c1","uid":1325678,"ip_address":"","ucode":"5044F89A505C5B","user_header":"https://static001.geekbang.org/account/avatar/00/14/3a/6e/e39e90ca.jpg","comment_is_top":false,"comment_ctime":1555307671,"is_pvip":false,"replies":[{"id":"30931","content":"👍 谢谢分享","user_name":"作者回复","comment_id":86069,"uid":"1001282","ip_address":"","utype":1,"ctime":1555336150,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"18735176855","product_id":100020901,"comment_content":"我看到nethogs的时候去尝试理解一下，结果v0.8.0 会有如下错误：creating socket failed while establishing local IP - are you root?<br>即使是root用户去执行。看网上说v0.8.1 解决了这个问题。所以就下载了8.5版本。<br><br>wget -c https:&#47;&#47;github.com&#47;raboof&#47;nethogs&#47;archive&#47;v0.8.5.tar.gz<br>tar xf v0.8.5.tar.gz <br>cd .&#47;nethogs-0.8.5&#47;<br><br>sudo apt-get install libncurses5-dev libpcap-dev<br>make &amp;&amp; sudo make install ","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446884,"discussion_content":"👍 谢谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555336150,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":83647,"user_name":"hola","can_delete":false,"product_type":"c1","uid":1068559,"ip_address":"","ucode":"1872B1B3FCEAFC","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/0f/c43745e7.jpg","comment_is_top":false,"comment_ctime":1554689845,"is_pvip":false,"replies":[{"id":"30378","content":"dtrace在linux上无法使用，其实我也不熟。官方网站上有个很详细的文档，可以去看看","user_name":"作者回复","comment_id":83647,"uid":"1001282","ip_address":"","utype":1,"ctime":1554815521,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"18734559029","product_id":100020901,"comment_content":"可以做一期dtrace的讲解吗？感觉这个工具很厉害，但是挺复杂的","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446113,"discussion_content":"dtrace在linux上无法使用，其实我也不熟。官方网站上有个很详细的文档，可以去看看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554815521,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":225306,"user_name":"jorin@zou","can_delete":false,"product_type":"c1","uid":1564869,"ip_address":"","ucode":"A8CEF7CCF33570","user_header":"https://static001.geekbang.org/account/avatar/00/17/e0/c5/c324a7de.jpg","comment_is_top":false,"comment_ctime":1591711595,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"10181646187","product_id":100020901,"comment_content":"是我学的太快了吗，怎么越学到后面，评论越少了，得放慢脚步","like_count":2,"discussions":[{"author":{"id":1009527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/77/c1310aad.jpg","nickname":"剑衣清风","note":"","ucode":"470CD81F6612F4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348602,"discussion_content":"买了就是学了，参考金字塔模型","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612664799,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1959822,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/e7/8e/318cfde0.jpg","nickname":"Spoon","note":"","ucode":"2FF9193AD482C2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339925,"discussion_content":"都是学完前几章就放弃了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609842498,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":234955,"user_name":"Roy","can_delete":false,"product_type":"c1","uid":1930723,"ip_address":"","ucode":"909B8B605C317A","user_header":"https://static001.geekbang.org/account/avatar/00/1d/75/e3/ef489d57.jpg","comment_is_top":false,"comment_ctime":1594858361,"is_pvip":false,"replies":[{"id":"87359","content":"这个不了解😓 不过如果针对具体性能指标，都有很多相关的性能评测工具，我们专栏里面也提到不少","user_name":"作者回复","comment_id":234955,"uid":"1001282","ip_address":"","utype":1,"ctime":1595427446,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"5889825657","product_id":100020901,"comment_content":"Linux什么时候有跑分软件?象安兔兔","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501557,"discussion_content":"这个不了解😓 不过如果针对具体性能指标，都有很多相关的性能评测工具，我们专栏里面也提到不少","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595427446,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":83591,"user_name":"ninuxer","can_delete":false,"product_type":"c1","uid":1243135,"ip_address":"","ucode":"5394ADAF2667D6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132","comment_is_top":false,"comment_ctime":1554681782,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5849649078","product_id":100020901,"comment_content":"打卡day61<br>这工具，还是要经常用，感觉用各个模块的套路篇，来的更快点～","like_count":1},{"had_liked":false,"id":294525,"user_name":"Jiyong","can_delete":false,"product_type":"c1","uid":1207360,"ip_address":"","ucode":"9390071044B1E1","user_header":"https://static001.geekbang.org/account/avatar/00/12/6c/40/f5ea25b1.jpg","comment_is_top":false,"comment_ctime":1621990823,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621990823","product_id":100020901,"comment_content":"请教老师，有哪些限制cpu 内存等资源使用率的工具。谢谢啊","like_count":0},{"had_liked":false,"id":254635,"user_name":"Akon","can_delete":false,"product_type":"c1","uid":1889038,"ip_address":"","ucode":"F0DA31C4BB4947","user_header":"https://static001.geekbang.org/account/avatar/00/1c/d3/0e/ef771277.jpg","comment_is_top":false,"comment_ctime":1603160821,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603160821","product_id":100020901,"comment_content":"大佬，有没有块设备稳定性测试的例子（比如iozone、fio这样的工具，以及制作或眼图的方法）","like_count":0},{"had_liked":false,"id":235799,"user_name":"youbuxiaoer","can_delete":false,"product_type":"c1","uid":1314891,"ip_address":"","ucode":"A92C9C7CC450FF","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLRwYJzyB6pdic3GeQvb5FSmMAOXepWERNT1nJsIY7M0adpbrACsdia56DCDxWhWicXHahSiaaIUpgZxg/132","comment_is_top":false,"comment_ctime":1595206296,"is_pvip":false,"replies":[{"id":"87259","content":"请参考我们专栏第19篇","user_name":"作者回复","comment_id":235799,"uid":"1001282","ip_address":"","utype":1,"ctime":1595343403,"user_name_real":"倪朋飞"}],"discussion_count":2,"race_medal":0,"score":"1595206296","product_id":100020901,"comment_content":"老师，工作中遇到内存占用较高，通过meminfo确认是匿名页占用较多内存，请问匿名页内存是如何产生的？如何释放？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501836,"discussion_content":"请参考我们专栏第19篇","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595343403,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1314891,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLRwYJzyB6pdic3GeQvb5FSmMAOXepWERNT1nJsIY7M0adpbrACsdia56DCDxWhWicXHahSiaaIUpgZxg/132","nickname":"youbuxiaoer","note":"","ucode":"A92C9C7CC450FF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293540,"discussion_content":"已经禁用swap了，这种情况下匿名内存如何释放？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595571673,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142368,"user_name":"柏森森","can_delete":false,"product_type":"c1","uid":1285420,"ip_address":"","ucode":"F370AD99BA71B9","user_header":"https://static001.geekbang.org/account/avatar/00/13/9d/2c/6248ffbd.jpg","comment_is_top":false,"comment_ctime":1571360662,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"1571360662","product_id":100020901,"comment_content":"请教一个问题,我在系统中使用find  &#47;query&#47;tmp  -type f  -min +1  -exec rm -rf {} \\;<br>用来删除文件发现这个脚本占用的资源特别多，CPU可以占用到20-30%,但系统不断地有交易上来，导致了性能的下降。系统&#47;query&#47;tmp中主要是小文件，请教下有没有好办法可以进行更高效，更快速地删除？另外，find工作的原理是什么","like_count":0,"discussions":[{"author":{"id":2967576,"avatar":"https://static001.geekbang.org/account/avatar/00/2d/48/18/e524f344.jpg","nickname":"Soyoger","note":"","ucode":"D4D7BD0ABC4491","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585532,"discussion_content":"这个问题就如同数据库全表扫描一样，既然是按分钟，不妨在增加一个子目录，按照时间分区，/query/tmp/2022-06-09 12/，这样每次删除上一分钟的文件夹即可，减少find操作。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661664541,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2021302,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/d7/b6/534c036e.jpg","nickname":"可以告诉我你名字嘛","note":"","ucode":"AAAA58E95F54D6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":281061,"discussion_content":"还有 page cache","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591666983,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2021302,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/d7/b6/534c036e.jpg","nickname":"可以告诉我你名字嘛","note":"","ucode":"AAAA58E95F54D6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":281059,"discussion_content":"这个老师有讲过,在IO篇, 和slab有关","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591666965,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":92192,"user_name":"陳先森","can_delete":false,"product_type":"c1","uid":1229006,"ip_address":"","ucode":"0F7AC617E3FE90","user_header":"https://static001.geekbang.org/account/avatar/00/12/c0/ce/fc41ad5e.jpg","comment_is_top":false,"comment_ctime":1557198319,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557198319","product_id":100020901,"comment_content":"原理大致清楚，但是工具不是太熟悉···还是得多练，概念性的东西当时记住了后面又容易忘，知识还是要温故而知新···还是要多看几遍，多敲几遍才记得住。慢慢的干货","like_count":0},{"had_liked":false,"id":83697,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1554705390,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554705390","product_id":100020901,"comment_content":"[D57打卡]<br>对性能分析的原理,比之前了解的多多了.<br>工具还是要经常用才行,不用就容易忘记. 有时用man还可以想起一点点来.<br><br>今天又把这些指标和工具又温习了一遍,以后也要常拿出来温习才行.<br>毕竟目前的主要工作还不是性能分析这一块.","like_count":1}]}