{"id":77207,"title":"20 | 变量（Variable）是什么（下）","content":"<h2>课件及源码下载地址：</h2><p><a href=\"https://gitee.com/geektime-geekbang/tensorflow-101/tree/master/beginners\">https://gitee.com/geektime-geekbang/tensorflow-101/tree/master/beginners</a></p>","comments":[{"had_liked":false,"id":59035,"user_name":"bearlu","can_delete":false,"product_type":"c3","uid":1030862,"ip_address":"","ucode":"14F260C8B24E27","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ba/ce/fd45714f.jpg","comment_is_top":false,"comment_ctime":1547279613,"is_pvip":true,"replies":[{"id":24898,"content":"https:&#47;&#47;github.com&#47;DjangoPeng&#47;tensorflow-101","user_name":"作者回复","user_name_real":"彭靖田","uid":1067283,"ctime":1550919128,"ip_address":"","comment_id":59035,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100023001,"comment_content":"老师，麻烦贴一下源码地址","like_count":2,"discussions":[{"author":{"id":1067283,"avatar":"https://static001.geekbang.org/account/avatar/00/10/49/13/51b1fe81.jpg","nickname":"彭靖田","note":"","ucode":"D3F1C281F38390","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436276,"discussion_content":"https://github.com/DjangoPeng/tensorflow-101","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550919128,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":171106,"user_name":"JustDoDT","can_delete":false,"product_type":"c3","uid":1127175,"ip_address":"","ucode":"6AF0B80F00EAEF","user_header":"https://static001.geekbang.org/account/avatar/00/11/33/07/8f351609.jpg","comment_is_top":false,"comment_ctime":1578845520,"is_pvip":false,"replies":[{"id":66343,"content":"是的","user_name":"编辑回复","user_name_real":"郭蕾","uid":1000473,"ctime":1578877246,"ip_address":"","comment_id":171106,"utype":2}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100023001,"comment_content":"注意TensorFlow2.0 相对于1.0很多都改名了。","like_count":0,"discussions":[{"author":{"id":1000473,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/44/19/28074c40.jpg","nickname":"小盖","note":"","ucode":"34F4C07D1C5FE8","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481242,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578877246,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127259,"user_name":"ZeroIce","can_delete":false,"product_type":"c3","uid":1305369,"ip_address":"","ucode":"30133BA83CE349","user_header":"https://static001.geekbang.org/account/avatar/00/13/eb/19/0d990b03.jpg","comment_is_top":false,"comment_ctime":1566625226,"is_pvip":false,"replies":[{"id":47865,"content":"《Python深度学习》Keras作者写的\n《深入理解TensorFlow》也可以看看","user_name":"作者回复","user_name_real":"彭靖田","uid":1067283,"ctime":1566987811,"ip_address":"","comment_id":127259,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100023001,"comment_content":"老师，有什么书籍推荐看的？英文系列也行","like_count":0,"discussions":[{"author":{"id":1067283,"avatar":"https://static001.geekbang.org/account/avatar/00/10/49/13/51b1fe81.jpg","nickname":"彭靖田","note":"","ucode":"D3F1C281F38390","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464401,"discussion_content":"《Python深度学习》Keras作者写的\n《深入理解TensorFlow》也可以看看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566987811,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70623,"user_name":"沉枫y","can_delete":false,"product_type":"c3","uid":1379253,"ip_address":"","ucode":"23FA566231DEEF","user_header":"https://static001.geekbang.org/account/avatar/00/15/0b/b5/6f876b6e.jpg","comment_is_top":false,"comment_ctime":1551148619,"is_pvip":false,"replies":[{"id":26644,"content":"在该会话（上下文）中改变（初始化、计算、赋值）了它。如果你关闭会话 ，它还是一个数据流图中的Variable 实例。","user_name":"作者回复","user_name_real":"彭靖田","uid":1067283,"ctime":1551847812,"ip_address":"","comment_id":70623,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100023001,"comment_content":"接上一条留言\nprint(sess.run(b))\nprint(b)   两者的输出结果不一样\n[1. 1. 1. 1.]\n&lt;tf.Variable &#39;b:0&#39; shape=(4,) dtype=float32_ref&gt;\n是不是可以理解为 b的本身只是一个定义好的30位的浮点数张量\n在经过session会话后，只是在该会话改变了他的值，但并不改变他本身的属性\n还是以上理解是错的  是其他的解释","like_count":0,"discussions":[{"author":{"id":1067283,"avatar":"https://static001.geekbang.org/account/avatar/00/10/49/13/51b1fe81.jpg","nickname":"彭靖田","note":"","ucode":"D3F1C281F38390","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440735,"discussion_content":"在该会话（上下文）中改变（初始化、计算、赋值）了它。如果你关闭会话 ，它还是一个数据流图中的Variable 实例。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551847812,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70622,"user_name":"沉枫y","can_delete":false,"product_type":"c3","uid":1379253,"ip_address":"","ucode":"23FA566231DEEF","user_header":"https://static001.geekbang.org/account/avatar/00/15/0b/b5/6f876b6e.jpg","comment_is_top":false,"comment_ctime":1551148046,"is_pvip":false,"replies":[{"id":26643,"content":"print(sess.run([W, b])) 会打印出结果，因为会话执行特定节点（变量、操作）返回的是 python 数据类型。但是 W和b本身是 TensorFlow DSL 定义的数据类型，是一个抽象的“壳”。无论你执行多少次，“壳”是不会变得。","user_name":"作者回复","user_name_real":"彭靖田","uid":1067283,"ctime":1551847722,"ip_address":"","comment_id":70622,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100023001,"comment_content":"执行完sess.run([W, b])后 去打印变量W后的结果并没有发生变化（在IDLE中操作）","like_count":0,"discussions":[{"author":{"id":1067283,"avatar":"https://static001.geekbang.org/account/avatar/00/10/49/13/51b1fe81.jpg","nickname":"彭靖田","note":"","ucode":"D3F1C281F38390","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440734,"discussion_content":"print(sess.run([W, b])) 会打印出结果，因为会话执行特定节点（变量、操作）返回的是 python 数据类型。但是 W和b本身是 TensorFlow DSL 定义的数据类型，是一个抽象的“壳”。无论你执行多少次，“壳”是不会变得。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551847722,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":59201,"user_name":"星辰大海","can_delete":false,"product_type":"c3","uid":1313856,"ip_address":"","ucode":"4AE6732FA73E3A","user_header":"https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqgVOA5iboljQEohRE9hVKmVbSbsQH6g5LHTZjss5I6uQ9O04ia32rCoR4EyH5HUicLbAVhKgRNWSvoQ/132","comment_is_top":false,"comment_ctime":1547332728,"is_pvip":true,"replies":[{"id":26616,"content":"加油加油!","user_name":"作者回复","user_name_real":"彭靖田","uid":1067283,"ctime":1551844283,"ip_address":"","comment_id":59201,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100023001,"comment_content":"终于赶上进度了😂","like_count":0,"discussions":[{"author":{"id":1067283,"avatar":"https://static001.geekbang.org/account/avatar/00/10/49/13/51b1fe81.jpg","nickname":"彭靖田","note":"","ucode":"D3F1C281F38390","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436310,"discussion_content":"加油加油!","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551844283,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":171114,"user_name":"JustDoDT","can_delete":false,"product_type":"c3","uid":1127175,"ip_address":"","ucode":"6AF0B80F00EAEF","user_header":"https://static001.geekbang.org/account/avatar/00/11/33/07/8f351609.jpg","comment_is_top":false,"comment_ctime":1578846535,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100023001,"comment_content":"2.0的朋友找到解决方案了，为了成功运行老师的代码：开头可以这样\nimport tensorflow.compat.v1 as tf\ntf.disable_v2_behavior()","like_count":4},{"had_liked":false,"id":171103,"user_name":"JustDoDT","can_delete":false,"product_type":"c3","uid":1127175,"ip_address":"","ucode":"6AF0B80F00EAEF","user_header":"https://static001.geekbang.org/account/avatar/00/11/33/07/8f351609.jpg","comment_is_top":false,"comment_ctime":1578845287,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100023001,"comment_content":"注意\ntf.random_normal方法改名了\n改成了tf.random.normal\n# 创建变量\n# tf.random_normal 方法返回形状为(1，4)的张量。它的4个元素符合均值为100、标准差为0.35的正态分布。\nW = tf.Variable(initial_value=tf.random.normal(shape=(1, 4), mean=100, stddev=0.35), name=&#39;W&#39;)\nb = tf.Variable(tf.zeros([4]), name=&#39;b&#39;)","like_count":3,"discussions":[{"author":{"id":1187359,"avatar":"https://static001.geekbang.org/account/avatar/00/12/1e/1f/41e35a24.jpg","nickname":"測試中……","note":"","ucode":"E7E1B46CB6D8B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":317462,"discussion_content":"感谢 ������","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603549293,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60319,"user_name":"陈浩然","can_delete":false,"product_type":"c3","uid":1369516,"ip_address":"","ucode":"2655178981B951","user_header":"https://static001.geekbang.org/account/avatar/00/14/e5/ac/b382efcb.jpg","comment_is_top":false,"comment_ctime":1547457964,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100023001,"comment_content":"import tensorflow as tf\n\nW = tf.Variable(initial_value = tf.random_normal(shape = (1 , 4) ,mean = 100 , stddev = 0.35 ), name = &quot;W&quot;)\nb = tf.Variable(tf.zeros([4]) , name=&quot;b&quot;)\n[W , b]\n[&lt;tf.Variable &#39;W:0&#39; shape=(1, 4) dtype=float32_ref&gt;,\n &lt;tf.Variable &#39;b:0&#39; shape=(4,) dtype=float32_ref&gt;]\n\nsess = tf.Session()\nsess.run(tf.global_variables_initializer())\nsess.run( [W , b])\n[array([[100.40549 ,  99.182625, 100.23513 ,  99.42683 ]], dtype=float32),\n array([0., 0., 0., 0.], dtype=float32)]\n\nsess.run(tf.assign_add(b , [1,1,1,1] ))\n\nsess.run(tf.assign_add(b , [1,1,1,1] ))\n​\narray([1., 1., 1., 1.], dtype=float32)\n\nsess.run(b)\narray([1., 1., 1., 1.], dtype=float32)\n\nsaver = tf.train.Saver({&#39;W&#39; : W , &#39;b&#39; : b})\nsaver.save(sess , &#39;.&#47;summary&#47;data.ckpt&#39; , global_step = 0)\nWARNING:tensorflow:Issue encountered when serializing trainable_variables.\nType is unsupported, or the types of the items don&#39;t match field type in CollectionDef. Note this is a warning and probably safe to ignore.\n&#39;test&#39; has type str, but expected one of: int, long, bool\nWARNING:tensorflow:Issue encountered when serializing variables.\nType is unsupported, or the types of the items don&#39;t match field type in CollectionDef. Note this is a warning and probably safe to ignore.\n&#39;test&#39; has type str, but expected one of: int, long, bool\n&#39;.&#47;summary&#47;data.ckpt-0&#39;\n\nsess.run(tf.assign_add(b , [1,1,1,1] ))\nsess.run(b)\narray([2., 2., 2., 2.], dtype=float32)\n\nsaver.restore(sess , &#39;.&#47;summary&#47;data.ckpt-0&#39;)\n\nsaver.restore(sess , &#39;.&#47;summary&#47;data.ckpt-0&#39;)\nsess.run(b)\nINFO:tensorflow:Restoring parameters from .&#47;summary&#47;data.ckpt-0\narray([1., 1., 1., 1.], dtype=float32)","like_count":3},{"had_liked":false,"id":233663,"user_name":"Tiger","can_delete":false,"product_type":"c3","uid":1903781,"ip_address":"","ucode":"BFD74BFE539A8A","user_header":"https://static001.geekbang.org/account/avatar/00/1d/0c/a5/0bbfd5e7.jpg","comment_is_top":false,"comment_ctime":1594377027,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100023001,"comment_content":"请问老师，怎么应对tensorflow的版本变化问题，一定要每个函数的名字都要改到2.0版本的吗？","like_count":0},{"had_liked":false,"id":121736,"user_name":"pyw","can_delete":false,"product_type":"c3","uid":1596506,"ip_address":"","ucode":"D09994DC0D724F","user_header":"https://static001.geekbang.org/account/avatar/00/18/5c/5a/d3e41304.jpg","comment_is_top":false,"comment_ctime":1565194688,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100023001,"comment_content":"从文件恢复的时候出错：\n```\nWARNING: Logging before flag parsing goes to stderr.\nW0808 00:16:28.798274 140416759756608 deprecation.py:323] From &#47;home&#47;pyw&#47;.local&#47;lib&#47;python3.6&#47;site-packages&#47;tensorflow&#47;python&#47;training&#47;saver.py:1276: checkpoint_exists (from tensorflow.python.training.checkpoint_management) is deprecated and will be removed in a future version.\nInstructions for updating:\nUse standard file APIs to check for files with this prefix.\nTraceback (most recent call last):\n  File &quot;c20.py&quot;, line 39, in &lt;module&gt;\n    saver.restore(sess, &#39;.&#47;save&#47;1.save&#39;)\n  File &quot;&#47;home&#47;pyw&#47;.local&#47;lib&#47;python3.6&#47;site-packages&#47;tensorflow&#47;python&#47;training&#47;saver.py&quot;, line 1278, in restore\n    compat.as_text(save_path))\nValueError: The passed save_path is not a valid checkpoint: .&#47;save&#47;1.save\n```\n\nc20.py的39行是：\nsaver.restore(sess, &#39;.&#47;save&#47;1.save&#39;)\n","like_count":0},{"had_liked":false,"id":121729,"user_name":"pyw","can_delete":false,"product_type":"c3","uid":1596506,"ip_address":"","ucode":"D09994DC0D724F","user_header":"https://static001.geekbang.org/account/avatar/00/18/5c/5a/d3e41304.jpg","comment_is_top":false,"comment_ctime":1565193491,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100023001,"comment_content":"有的方法过期了\n```\nW0807 23:51:48.566468 140651389855552 deprecation_wrapper.py:119] From c20.py:14: The name tf.Session is deprecated. Please use tf.compat.v1.Session instead.\nW0807 23:51:48.864450 140651389855552 deprecation_wrapper.py:119] From c20.py:15: The name tf.global_variables_initializer is deprecated. Please use tf.compat.v1.global_variables_initializer instead.\nW0807 23:51:49.436012 140651389855552 deprecation_wrapper.py:119] From c20.py:19: The name tf.assign_add is deprecated. Please use tf.compat.v1.assign_add instead.\n```\n\n如果按照提示修改，会得到\n\n```\n    sess.run(tf.compat.v1.global_variables_initializer())\nTypeError: unbound method run() must be called with Session instance as first argument (got Operation instance instead)\n```","like_count":0,"discussions":[{"author":{"id":1552156,"avatar":"https://static001.geekbang.org/account/avatar/00/17/af/1c/4815e534.jpg","nickname":"田野光","note":"","ucode":"5CF880C48FA634","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":8909,"discussion_content":"因为tensorflow 2.0干掉了tf session等接口，而选择了更pythonic的方法，忽略这里的警告就好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568097743,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}