{"id":88846,"title":"38 | ç§»åŠ¨å¼€å‘æ–°å¤§é™†ï¼šAndroidéŸ³è§†é¢‘å¼€å‘","content":"<blockquote>\n<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å¼ ç»æ–‡ã€‚ä¿Šæ°ç›®å‰è´Ÿè´£å¾®ä¿¡çš„éŸ³è§†é¢‘å¼€å‘å·¥ä½œï¼Œæ— è®ºæ˜¯æˆ‘ä»¬å¹³å¸¸ç»å¸¸ä½¿ç”¨åˆ°çš„å°è§†é¢‘ï¼Œè¿˜æ˜¯æœ€æ–°æ¨å‡ºçš„å³åˆ»è§†é¢‘ï¼Œéƒ½æ˜¯å‡ºè‡ªä»–æ‰‹ã€‚ä¿Šæ°åœ¨éŸ³è§†é¢‘æ–¹é¢æœ‰éå¸¸ä¸°å¯Œçš„ç»éªŒï¼Œä»Šå¤©æœ‰å¹¸è¯·åˆ°ä»–æ¥ç»™æˆ‘ä»¬åˆ†äº«ä»–ä¸ªäººå¯¹AndroidéŸ³è§†é¢‘å¼€å‘çš„å¿ƒå¾—å’Œä½“ä¼šã€‚</p>\n</blockquote><blockquote>\n<p>åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œè§†é¢‘ç±»åº”ç”¨å æ®äº†æˆ‘ä»¬è¶Šæ¥è¶Šå¤šçš„æ—¶é—´ï¼Œå„å¤§å…¬å¸ä¹Ÿçº·çº·æ€å…¥è¿™ä¸ªæˆ˜åœºï¼Œä¸ç®¡æ˜¯æŠ–éŸ³ã€å¿«æ‰‹ç­‰çŸ­è§†é¢‘ç±»å‹ï¼Œè™ç‰™ã€æ–—é±¼ç­‰ç›´æ’­ç±»å‹ï¼Œè…¾è®¯è§†é¢‘ã€çˆ±å¥‡è‰ºã€ä¼˜é…·ç­‰é•¿è§†é¢‘ç±»å‹ï¼Œè¿˜æ˜¯Vueã€ç¾æ‹ç­‰è§†é¢‘ç¼–è¾‘ç¾é¢œç±»å‹ï¼Œæ€»æœ‰ä¸€æ¬¾é€‚åˆä½ ã€‚</p>\n</blockquote><blockquote>\n<p>æœªæ¥éšç€5Gæ™®åŠä»¥åŠç½‘ç»œèµ„è´¹çš„ä¸‹é™ï¼ŒéŸ³è§†é¢‘çš„å‰æ™¯æ˜¯éå¸¸å¹¿é˜”çš„ã€‚ä½†æ˜¯å¦ä¸€æ–¹é¢ï¼Œæ— è®ºæ˜¯éŸ³è§†é¢‘çš„ç¼–è§£ç å’Œæ’­æ”¾å™¨ã€è§†é¢‘ç¼–è¾‘å’Œç¾é¢œçš„å„ç§ç®—æ³•ï¼Œè¿˜æ˜¯è§†é¢‘ä¸äººå·¥æ™ºèƒ½çš„ç»“åˆï¼ˆ<a href=\"https://mp.weixin.qq.com/s/ZtsqF7bBODFymEaYFG6KAg\">AIå‰ªç‰‡</a>ã€è§†é¢‘ä¿®å¤ã€è¶…æ¸…åŒ–ç­‰ï¼‰ï¼Œå®ƒä»¬éƒ½æ¶‰åŠäº†æ–¹æ–¹é¢é¢çš„åº•å±‚çŸ¥è¯†ï¼Œå­¦ä¹ æ›²çº¿æ¯”è¾ƒé™¡å³­ï¼Œé—¨æ§›ç›¸å¯¹æ¯”è¾ƒé«˜ï¼Œæ‰€ä»¥ä¹Ÿé€ æˆäº†ç›®å‰å„å¤§å…¬å¸éŸ³è§†é¢‘ç›¸å…³äººæ‰çš„ç´§ç¼ºã€‚å¦‚æœä½ å¯¹éŸ³è§†é¢‘å¼€å‘æ„Ÿå…´è¶£ï¼Œæˆ‘ä¹Ÿéå¸¸å»ºè®®ä½ å»å¾€è¿™ä¸ªæ–¹å‘å°è¯•ï¼Œæˆ‘ä¸ªäººæ˜¯éå¸¸çœ‹å¥½éŸ³è§†é¢‘å¼€å‘è¿™ä¸ªé¢†åŸŸçš„ã€‚</p>\n</blockquote><blockquote>\n<p>å½“ç„¶éŸ³è§†é¢‘å¼€å‘çš„ç»éªŒæ˜¯é ç€ä¸€æ¬¡åˆä¸€æ¬¡çš„â€œå¡«å‘â€æˆé•¿èµ·æ¥çš„ï¼Œä¸‹é¢æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ä¿Šæ°åŒå­¦å…³äºéŸ³è§†é¢‘çš„è®¤è¯†å’Œæ€è€ƒã€‚</p>\n</blockquote><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å‘¨ä¿Šæ°ï¼Œç°åœ¨åœ¨å¾®ä¿¡ä»äº‹Androidå¤šåª’ä½“å¼€å‘ã€‚åº”ç»æ–‡çš„é‚€è¯·ï¼Œåˆ†äº«ä¸€äº›æˆ‘å…³äºAndroidéŸ³è§†é¢‘å¼€å‘çš„å¿ƒå¾—å’Œä½“ä¼šã€‚</p><!-- [[[read_end]]] --><p>ä¸ç®¡ä½œä¸ºå¼€å‘è€…è¿˜æ˜¯ç”¨æˆ·ï¼Œç°åœ¨æˆ‘ä»¬æ¯å¤©éƒ½ä¼šæ¥è§¦åˆ°å„ç§å„æ ·çš„çŸ­è§†é¢‘ã€ç›´æ’­ç±»çš„Appï¼Œä¸ä¹‹ç›¸å…³çš„éŸ³è§†é¢‘æ–¹å‘çš„å¼€å‘ä¹Ÿå˜å¾—è¶Šæ¥è¶Šé‡è¦ã€‚ä½†æ˜¯å¯¹äºå¤§å¤šæ•°Androidå¼€å‘è€…æ¥è¯´ï¼Œä»äº‹AndroidéŸ³è§†é¢‘ç›¸å…³çš„å¼€å‘å¯èƒ½ç›®å‰è¿˜ç®—æ˜¯ä¸ªå°ä¼—é¢†åŸŸï¼Œè™½ç„¶å¯èƒ½ç›®å‰æ·±å…¥è¿™ä¸ªé¢†åŸŸçš„å¼€å‘è€…è¿˜ä¸æ˜¯å¤ªå¤šï¼Œä½†è¿™ä¸ªæ–¹å‘æ¶‰åŠçš„çŸ¥è¯†ç‚¹å¯ä¸€ç‚¹éƒ½ä¸å°‘ã€‚</p><h2>éŸ³è§†é¢‘çš„åŸºç¡€çŸ¥è¯†</h2><p><strong>1. éŸ³è§†é¢‘ç›¸å…³çš„æ¦‚å¿µ</strong></p><p>è¯´åˆ°éŸ³è§†é¢‘ï¼Œå…ˆä»æˆ‘ä»¬ç†Ÿæ‚‰ä¹Ÿé™Œç”Ÿçš„è§†é¢‘æ ¼å¼è¯´èµ·ã€‚</p><p>å¯¹äºæˆ‘ä»¬æ¥è¯´ï¼Œæœ€å¸¸è§çš„è§†é¢‘æ ¼å¼å°±æ˜¯<a href=\"https://zh.wikipedia.org/zh-cn/MP4\">MP4</a>æ ¼å¼ï¼Œè¿™æ˜¯ä¸€ä¸ªé€šç”¨çš„å®¹å™¨æ ¼å¼ã€‚æ‰€è°“å®¹å™¨æ ¼å¼ï¼Œå°±æ„å‘³å†…éƒ¨è¦æœ‰å¯¹åº”çš„æ•°æ®æµç”¨æ¥æ‰¿è½½å†…å®¹ã€‚è€Œä¸”æ—¢ç„¶æ˜¯ä¸€ä¸ªè§†é¢‘ï¼Œé‚£å¿…ç„¶æœ‰éŸ³è½¨å’Œè§†è½¨ï¼Œè€ŒéŸ³è½¨ã€è§†è½¨æœ¬èº«ä¹Ÿæœ‰å¯¹åº”çš„æ ¼å¼ã€‚å¸¸è§çš„éŸ³è½¨ã€è§†è½¨æ ¼å¼åŒ…æ‹¬ï¼š</p><ul>\n<li>\n<p>è§†è½¨ï¼š<a href=\"https://zh.wikipedia.org/wiki/%E9%AB%98%E6%95%88%E7%8E%87%E8%A7%86%E9%A2%91%E7%BC%96%E7%A0%81\">H.265(HEVC)</a>ã€<a href=\"https://zh.wikipedia.org/wiki/H.264/MPEG-4_AVC\">H.264</a>ã€‚å…¶ä¸­ï¼Œç›®å‰å¤§éƒ¨åˆ†Androidæ‰‹æœºéƒ½æ”¯æŒH.264æ ¼å¼çš„ç›´æ¥ç¡¬ä»¶ç¼–ç å’Œè§£ç ï¼›å¯¹äºH.265æ¥è¯´ï¼ŒAndroid  5.0ä»¥ä¸Šçš„æœºå™¨å°±æ”¯æŒç›´æ¥ç¡¬ä»¶è§£ç äº†ï¼Œä½†æ˜¯å¯¹äºç¡¬ä»¶ç¼–ç ï¼Œç›®å‰åªæœ‰ä¸€éƒ¨åˆ†é«˜ç«¯èŠ¯ç‰‡å¯ä»¥æ”¯æŒï¼Œä¾‹å¦‚é«˜é€šçš„8xxç³»åˆ—ã€åä¸ºçš„98xç³»åˆ—ã€‚å¯¹äºè§†è½¨ç¼–ç æ¥è¯´ï¼Œåˆ†è¾¨ç‡è¶Šå¤§æ€§èƒ½æ¶ˆè€—ä¹Ÿå°±è¶Šå¤§ï¼Œç¼–ç æ‰€éœ€çš„æ—¶é—´å°±è¶Šé•¿ã€‚</p>\n</li>\n<li>\n<p>éŸ³è½¨ï¼š<a href=\"https://zh.wikipedia.org/wiki/%E9%80%B2%E9%9A%8E%E9%9F%B3%E8%A8%8A%E7%B7%A8%E7%A2%BC\">AAC</a>ã€‚è¿™æ˜¯ä¸€ç§å†å²æ‚ ä¹…éŸ³é¢‘ç¼–ç æ ¼å¼ï¼ŒAndroidæ‰‹æœºåŸºæœ¬å¯ä»¥ç›´æ¥ç¡¬ä»¶ç¼–è§£ç ï¼Œå‡ ä¹å¾ˆå°‘é‡åˆ°å…¼å®¹æ€§é—®é¢˜ã€‚å¯ä»¥è¯´ä½œä¸ºè§†é¢‘çš„éŸ³è½¨æ ¼å¼ï¼ŒAACå·²ç»éå¸¸æˆç†Ÿäº†ã€‚</p>\n</li>\n</ul><p>å¯¹äºç¼–ç æœ¬èº«ï¼Œä¸Šé¢æåˆ°çš„è¿™äº›æ ¼å¼éƒ½æ˜¯<a href=\"https://zh.wikipedia.org/zh-hans/%E6%9C%89%E6%8D%9F%E6%95%B0%E6%8D%AE%E5%8E%8B%E7%BC%A9\">æœ‰æŸç¼–ç </a>ï¼Œå› æ­¤å‹ç¼©ç¼–ç æœ¬èº«è¿˜éœ€è¦ä¸€ä¸ªè¡¡é‡å‹ç¼©ä¹‹åï¼Œæ•°æ®é‡å¤šå°‘çš„æŒ‡æ ‡ï¼Œè¿™ä¸ªæ ‡å‡†å°±æ˜¯<a href=\"https://zh.wikipedia.org/wiki/%E6%AF%94%E7%89%B9%E7%8E%87#%E5%A4%9A%E5%AA%92%E4%BD%93%E7%9A%84%E6%AF%94%E7%89%B9%E7%8E%87\">ç ç‡</a>ã€‚åŒä¸€ä¸ªå‹ç¼©æ ¼å¼ä¸‹ï¼Œç ç‡è¶Šé«˜è´¨é‡ä¹Ÿå°±è¶Šå¥½ã€‚æ›´å¤šAndroidæœ¬èº«æ”¯æŒçš„ç¼–è§£ç æ ¼å¼ï¼Œä½ å¯ä»¥å‚è€ƒ<a href=\"https://developer.android.com/guide/topics/media/media-formats\">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><p>å°ç»“ä¸€ä¸‹ï¼Œè¦æ‹æ‘„ä¸€ä¸ªMP4è§†é¢‘ï¼Œæˆ‘ä»¬éœ€è¦å°†è§†è½¨  +  éŸ³è½¨åˆ†åˆ«ç¼–ç ï¼Œç„¶åä½œä¸ºMP4çš„æ•°æ®æµï¼Œå†åˆæˆå‡ºä¸€ä¸ªMP4æ–‡ä»¶ã€‚</p><p><strong>2. éŸ³è§†é¢‘ç¼–ç çš„æµç¨‹</strong></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹ä¸€ä¸ªè§†é¢‘æ˜¯æ€ä¹ˆæ‹æ‘„å‡ºæ¥çš„ã€‚é¦–å…ˆï¼Œæ—¢ç„¶æ˜¯æ‹æ‘„ï¼Œå°‘ä¸äº†è·Ÿæ‘„åƒå¤´ã€éº¦å…‹é£æ‰“äº¤é“ã€‚ä»æµç¨‹æ¥è¯´ï¼Œä»¥H.264/AACç¼–ç ä¸ºä¾‹ï¼Œå½•åˆ¶è§†é¢‘çš„æ€»ä½“æµç¨‹æ˜¯ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/40/73/406204beab2de273ecdb436d4bf66773.png?wh=1920*424\" alt=\"\"></p><p>æˆ‘ä»¬åˆ†åˆ«ä»æ‘„åƒå¤´/å½•éŸ³è®¾å¤‡é‡‡é›†æ•°æ®ï¼Œå°†æ•°æ®é€å…¥ç¼–ç å™¨ï¼Œåˆ†åˆ«ç¼–ç å‡ºè§†è½¨/éŸ³è½¨ä¹‹åï¼Œå†é€å…¥åˆæˆå™¨ï¼ˆMediaRemuxeræˆ–è€…ç±»ä¼¼mp4v2ã€FFmpegä¹‹ç±»çš„å¤„ç†åº“ï¼‰ï¼Œæœ€ç»ˆè¾“å‡ºMP4æ–‡ä»¶ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä¸»è¦ä»¥è§†è½¨ä¸ºä¾‹ï¼Œæ¥ä»‹ç»ä¸‹ç¼–ç çš„æµç¨‹ã€‚</p><p>é¦–å…ˆï¼Œç›´æ¥ä½¿ç”¨ç³»ç»Ÿçš„<a href=\"https://developer.android.com/reference/android/media/MediaRecorder\">MediaRecorder</a>å½•åˆ¶æ•´ä¸ªè§†é¢‘ï¼Œè¿™æ˜¯æœ€ç®€å•çš„æ–¹æ³•ï¼Œç›´æ¥å°±èƒ½è¾“å‡ºMP4æ–‡ä»¶ã€‚ä½†æ˜¯è¿™ä¸ªæ¥å£å¯å®šåˆ¶åŒ–å¾ˆå·®ï¼Œæ¯”å¦‚æˆ‘ä»¬æƒ³å½•åˆ¶ä¸€ä¸ªæ­£æ–¹å½¢çš„è§†é¢‘ï¼Œé™¤éæ‘„åƒå¤´æœ¬èº«æ”¯æŒå®½é«˜ä¸€è‡´çš„åˆ†è¾¨ç‡ï¼Œå¦åˆ™åªèƒ½åæœŸå¤„ç†æˆ–è€…å„ç§Hackã€‚å¦å¤–ï¼Œåœ¨å®é™…Appä¸­ï¼Œé™¤éå¯¹è§†é¢‘è¦æ±‚ä¸æ˜¯ç‰¹åˆ«é«˜ï¼Œä¸€èˆ¬ä¹Ÿä¸ä¼šç›´æ¥ä½¿ç”¨MediaRecorderã€‚</p><p>è§†è½¨çš„å¤„ç†æ˜¯å½•åˆ¶è§†é¢‘ä¸­ç›¸å¯¹æ¯”è¾ƒå¤æ‚çš„éƒ¨åˆ†ï¼Œè¾“å…¥æºå¤´æ˜¯Cameraçš„æ•°æ®ï¼Œæœ€ç»ˆè¾“å‡ºæ˜¯ç¼–ç çš„H.264/H.265æ•°æ®ã€‚ä¸‹é¢æˆ‘æ¥ä»‹ç»ä¸¤ç§å¤„ç†æ¨¡å‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/fb/82/fb9fe38693f3a86af745b97fc8d22882.png?wh=1698*200\" alt=\"\"></p><p>ç¬¬ä¸€ç§æ–¹æ³•æ˜¯åˆ©ç”¨Cameraè·å–æ‘„åƒå¤´è¾“å‡ºçš„åŸå§‹æ•°æ®æ¥å£ï¼ˆä¾‹å¦‚onPreviewFrameï¼‰ï¼Œç»è¿‡é¢„å¤„ç†ï¼Œä¾‹å¦‚ç¼©æ”¾ã€è£å‰ªä¹‹åï¼Œé€å…¥ç¼–ç å™¨ï¼Œè¾“å‡ºH.264/H.265ã€‚</p><p>æ‘„åƒå¤´è¾“å‡ºçš„åŸå§‹æ•°æ®æ ¼å¼ä¸ºNV21ï¼Œè¿™æ˜¯<a href=\"https://zh.wikipedia.org/wiki/YUV\">YUV</a>é¢œè‰²æ ¼å¼çš„ä¸€ç§ã€‚åŒºåˆ«äºRGBé¢œè‰²ï¼ŒYUVæ•°æ®æ ¼å¼å ç”¨ç©ºé—´æ›´å°‘ï¼Œåœ¨è§†é¢‘ç¼–ç é¢†åŸŸä½¿ç”¨ååˆ†å¹¿æ³›ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œå› ä¸ºæ‘„åƒå¤´ç›´æ¥è¾“å‡ºçš„NV21æ ¼å¼å¤§å°è·Ÿæœ€ç»ˆè§†é¢‘ä¸ä¸€å®šåŒ¹é…ï¼Œè€Œä¸”ç¼–ç å™¨å¾€å¾€ä¹Ÿè¦æ±‚è¾“å…¥å¦å¤–ä¸€ç§YUVæ ¼å¼ï¼ˆä¸€èˆ¬æ¥è¯´æ˜¯YUV420Pï¼‰ï¼Œå› æ­¤åœ¨è·å–åˆ°NV21é¢œè‰²æ ¼å¼ä¹‹åï¼Œè¿˜éœ€è¦è¿›è¡Œå„ç§ç¼©æ”¾ã€è£å‰ªä¹‹ç±»çš„æ“ä½œï¼Œä¸€èˆ¬ä¼šä½¿ç”¨<a href=\"https://www.ffmpeg.org/\">FFmpeg</a>ã€<a href=\"https://chromium.googlesource.com/libyuv/libyuv/\">libyuv</a>è¿™æ ·çš„åº“å¤„ç†YUVæ•°æ®ã€‚</p><p>æœ€åä¼šå°†æ•°æ®é€å…¥åˆ°ç¼–ç å™¨ã€‚åœ¨è§†é¢‘ç¼–ç å™¨çš„é€‰æ‹©ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥é€‰æ‹©ç³»ç»Ÿçš„MediaCodecï¼Œåˆ©ç”¨æ‰‹æœºæœ¬èº«çš„ç¡¬ä»¶ç¼–ç èƒ½åŠ›ã€‚ä½†å¦‚æœå¯¹æœ€ç»ˆè¾“å‡ºçš„è§†é¢‘å¤§å°è¦æ±‚æ¯”è¾ƒä¸¥æ ¼çš„è¯ï¼Œä½¿ç”¨çš„ç ç‡ä¼šåä½ï¼Œè¿™ç§æƒ…å†µä¸‹å¤§éƒ¨åˆ†æ‰‹æœºçš„ç¡¬ä»¶ç¼–ç å™¨è¾“å‡ºçš„ç”»è´¨å¯èƒ½ä¼šæ¯”è¾ƒå·®ã€‚å¦å¤–ä¸€ç§å¸¸è§çš„é€‰æ‹©æ˜¯åˆ©ç”¨<a href=\"https://www.videolan.org/developers/x264.html\">x264</a>æ¥è¿›è¡Œç¼–ç ï¼Œç”»è´¨è¡¨ç°ç›¸å¯¹è¾ƒå¥½ï¼Œä½†æ˜¯æ¯”èµ·ç¡¬ä»¶ç¼–ç å™¨ï¼Œé€Ÿåº¦ä¼šæ…¢å¾ˆå¤šï¼Œå› æ­¤åœ¨å®é™…ä½¿ç”¨æ—¶æœ€å¥½æ ¹æ®åœºæ™¯è¿›è¡Œé€‰æ‹©ã€‚</p><p>é™¤äº†ç›´æ¥å¤„ç†æ‘„åƒå¤´åŸå§‹æ•°æ®ä»¥å¤–ï¼Œè¿˜æœ‰ä¸€ç§å¸¸è§çš„å¤„ç†æ¨¡å‹ï¼Œåˆ©ç”¨Surfaceä½œä¸ºç¼–ç å™¨çš„è¾“å…¥æºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/50/06/5003363cbda442463e50b7c6a245b306.png?wh=1692*198\" alt=\"\"></p><p>å¯¹äºAndroidæ‘„åƒå¤´çš„é¢„è§ˆï¼Œéœ€è¦è®¾ç½®ä¸€å¼ Surface/SurfaceTextureæ¥ä½œä¸ºæ‘„åƒå¤´é¢„è§ˆæ•°æ®çš„è¾“å‡ºï¼Œè€ŒMediaCodecåœ¨API  18+ä¹‹åï¼Œå¯ä»¥é€šè¿‡<a href=\"https://developer.android.com/reference/android/media/MediaCodec#createInputSurface\">createInputSurface</a>æ¥åˆ›å»ºä¸€å¼ Surfaceä½œä¸ºç¼–ç å™¨çš„è¾“å…¥ã€‚è¿™é‡Œæ‰€è¯´çš„å¦å¤–ä¸€ç§æ–¹å¼å°±æ˜¯ï¼Œå°†æ‘„åƒå¤´é¢„è§ˆSurfaceçš„å†…å®¹ï¼Œè¾“å‡ºåˆ°MediaCodecçš„InputSurfaceä¸Šã€‚</p><p>è€Œåœ¨ç¼–ç å™¨çš„é€‰æ‹©ä¸Šï¼Œè™½ç„¶InputSurfaceæ˜¯é€šè¿‡MediaCodecæ¥åˆ›å»ºçš„ï¼Œä¹çœ‹ä¹‹ä¸‹ä¼¼ä¹åªèƒ½é€šè¿‡MediaCodecæ¥è¿›è¡Œç¼–ç ï¼Œæ— æ³•ä½¿ç”¨x264æ¥ç¼–ç ï¼Œä½†åˆ©ç”¨PreviewSurfaceï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªOpenGLçš„ä¸Šä¸‹æ–‡ï¼Œè¿™æ ·æ‰€æœ‰ç»˜åˆ¶çš„å†…å®¹ï¼Œéƒ½å¯ä»¥é€šè¿‡glReadPixelæ¥è·å–ï¼Œç„¶åå†è®²è¯»å–æ•°æ®è½¬æ¢æˆYUVå†è¾“å…¥åˆ°x264å³å¯ï¼ˆå¦å¤–ï¼Œå¦‚æœæ˜¯åœ¨GLES  3.0çš„ç¯å¢ƒï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨<a href=\"http://www.songho.ca/opengl/gl_pbo.html\">PBO</a>æ¥åŠ é€ŸglReadPixlesçš„é€Ÿåº¦ï¼‰ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/98/cb/98ae4dbac4cac80639d7dfe4682414cb.png?wh=1534*560\" alt=\"\"></p><p>ç”±äºè¿™é‡Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªOpenGLçš„ä¸Šä¸‹æ–‡ï¼Œå¯¹äºç›®å‰çš„è§†é¢‘ç±»Appæ¥è¯´ï¼Œè¿˜æœ‰å„ç§å„æ ·çš„æ»¤é•œå’Œç¾é¢œæ•ˆæœï¼Œå®é™…ä¸Šéƒ½å¯ä»¥åŸºäºOpenGLæ¥å®ç°ã€‚</p><p>è€Œè‡³äºè¿™ç§æ–¹å¼å½•åˆ¶è§†é¢‘å…·ä½“å®ç°ä»£ç ï¼Œä½ å¯ä»¥å‚è€ƒä¸‹grafikaä¸­<a href=\"https://github.com/google/grafika/blob/master/app/src/main/java/com/android/grafika/CameraCaptureActivity.java\">ç¤ºä¾‹</a>ã€‚</p><h2>è§†é¢‘å¤„ç†</h2><p><strong>1. è§†é¢‘ç¼–è¾‘</strong></p><p>åœ¨å½“ä¸‹è§†é¢‘ç±»Appä¸­ï¼Œä½ å¯ä»¥è§åˆ°å„ç§è§†é¢‘è£å‰ªã€è§†é¢‘ç¼–è¾‘çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼š</p><ul>\n<li>\n<p>è£å‰ªè§†é¢‘çš„ä¸€éƒ¨åˆ†ã€‚</p>\n</li>\n<li>\n<p>å¤šä¸ªè§†é¢‘è¿›è¡Œæ‹¼æ¥ã€‚</p>\n</li>\n</ul><p>å¯¹äºè§†é¢‘è£å‰ªã€æ‹¼æ¥æ¥è¯´ï¼ŒAndroidç›´æ¥æä¾›äº†<a href=\"https://developer.android.com/reference/android/media/MediaExtractor\">MediaExtractor</a>çš„æ¥å£ï¼Œç»“åˆseekä»¥åŠå¯¹åº”è¯»å–å¸§æ•°æ®readSampleDataçš„æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è·å–å¯¹åº”æ—¶é—´æˆ³çš„å¸§çš„å†…å®¹ï¼Œè¿™æ ·è¯»å–å‡ºæ¥çš„æ˜¯å·²ç»ç¼–ç å¥½çš„æ•°æ®ï¼Œå› æ­¤æ— éœ€é‡æ–°ç¼–ç ï¼Œç›´æ¥å¯ä»¥è¾“å…¥åˆæˆå™¨å†æ¬¡åˆæˆä¸ºMP4ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/61/ad/61b18d372ba93905b547d60da313a1ad.png?wh=1920*189\" alt=\"\"></p><p>æˆ‘ä»¬åªéœ€è¦seekåˆ°éœ€è¦è£å‰ªåŸè§†é¢‘çš„æ—¶é—´æˆ³ï¼Œç„¶åä¸€ç›´è¯»å–sampleDataï¼Œé€å…¥MediaMuxerå³å¯ï¼Œè¿™æ˜¯è§†é¢‘è£å‰ªæœ€ç®€å•çš„å®ç°æ–¹å¼ã€‚</p><p>ä½†åœ¨å®è·µæ—¶ä¼šå‘ç°ï¼Œ<a href=\"https://developer.android.com/reference/android/media/MediaExtractor#seekTo\">seekTo</a>å¹¶ä¸ä¼šå¯¹æ‰€æœ‰æ—¶é—´æˆ³éƒ½ç”Ÿæ•ˆã€‚æ¯”å¦‚è¯´ï¼Œä¸€ä¸ª<strong>4min</strong>å·¦å³çš„è§†é¢‘ï¼Œæˆ‘ä»¬æƒ³è¦seekåˆ°å¤§æ¦‚<strong>2min</strong>å·¦å³çš„ä½ç½®ï¼Œç„¶åä»è¿™ä¸ªä½ç½®è¯»å–æ•°æ®ï¼Œä½†å®é™…è°ƒç”¨seekToåˆ°2minè¿™ä¸ªä½ç½®ä¹‹åï¼Œå†ä»MediaExtractorè¯»å–æ•°æ®ï¼Œä½ ä¼šå‘ç°å®é™…è·å–çš„æ•°æ®ä¸Šå¯èƒ½æ˜¯ä»2minè¿™é‡Œå‰é¢ä¸€ç‚¹æˆ–è€…åé¢ä¸€ç‚¹ä½ç½®çš„å†…å®¹ã€‚è¿™æ˜¯å› ä¸ºMediaExtractorè¿™ä¸ªæ¥å£åªèƒ½seekåˆ°è§†é¢‘<a href=\"https://zh.wikipedia.org/wiki/%E9%97%9C%E9%8D%B5%E6%A0%BC#%E8%A6%96%E8%A8%8A%E7%B7%A8%E8%BC%AF%E7%9A%84%E9%97%9C%E9%8D%B5%E6%A0%BC\">å…³é”®å¸§</a>çš„ä½ç½®ï¼Œè€Œæˆ‘ä»¬æƒ³è¦çš„ä½ç½®å¹¶ä¸ä¸€å®šæœ‰å…³é”®å¸§ã€‚è¿™ä¸ªé—®é¢˜è¿˜æ˜¯è¦å›åˆ°è§†é¢‘ç¼–ç ï¼Œåœ¨è§†é¢‘ç¼–ç æ—¶ä¸¤ä¸ªå…³é”®å¸§ä¹‹é—´æ˜¯æœ‰ä¸€å®šé—´éš”è·ç¦»çš„ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/9a/7b/9a59d62bc13f09d9ccf971ce6d8d5b7b.jpg?wh=1248*532\" alt=\"\"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå…³é”®å¸§è¢«æˆä¸º<strong>Iå¸§</strong>ï¼Œå¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€å¸§æ²¡æœ‰è¢«å‹ç¼©çš„ç”»é¢ï¼Œè§£ç çš„æ—¶å€™æ— éœ€è¦ä¾èµ–å…¶ä»–è§†é¢‘å¸§ã€‚ä½†æ˜¯åœ¨ä¸¤ä¸ªå…³é”®å¸§ä¹‹é—´ï¼Œè¿˜å­˜åœ¨è¿™<strong>Bå¸§</strong>ã€<strong>På¸§</strong>è¿™æ ·çš„å‹ç¼©å¸§ï¼Œéœ€è¦ä¾èµ–å…¶ä»–å¸§æ‰èƒ½å®Œæ•´è§£ç å‡ºä¸€ä¸ªç”»é¢ã€‚è‡³äºä¸¤ä¸ªå…³é”®å¸§ä¹‹é—´çš„é—´éš”ï¼Œè¢«ç§°ä¸ºä¸€ä¸ª<a href=\"https://zh.wikipedia.org/wiki/%E5%9C%96%E5%83%8F%E7%BE%A4%E7%B5%84\">GOP</a> ï¼Œåœ¨GOPå†…çš„å¸§ï¼ŒMediaExtractoræ˜¯æ— æ³•ç›´æ¥seekåˆ°çš„ï¼Œå› ä¸ºè¿™ä¸ªç±»ä¸è´Ÿè´£è§£ç ï¼Œåªèƒ½seekåˆ°å‰åçš„å…³é”®å¸§ã€‚ä½†å¦‚æœGOPè¿‡å¤§ï¼Œå°±ä¼šå¯¼è‡´è§†é¢‘ç¼–è¾‘éå¸¸ä¸ç²¾å‡†äº†ï¼ˆå®é™…ä¸Šéƒ¨åˆ†æ‰‹æœºçš„ROMæœ‰æ”¹åŠ¨ï¼Œå®ç°çš„MediaExtractorä¹Ÿèƒ½ç²¾ç¡®seekï¼‰ã€‚</p><p>æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£è¦å®ç°ç²¾ç¡®è£å‰ªä¹Ÿå°±åªèƒ½å»ä¾èµ–è§£ç å™¨äº†ã€‚è§£ç å™¨æœ¬èº«èƒ½å¤Ÿè§£å‡ºæ‰€æœ‰å¸§çš„å†…å®¹ï¼Œåœ¨å¼•å…¥è§£å¸§ä¹‹åï¼Œæ•´ä¸ªè£å‰ªçš„æµç¨‹å°±å˜æˆäº†ä¸‹é¢çš„æ ·å­ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/89/53/89f6cf7d68677a1a6225905117877853.png?wh=1920*211\" alt=\"\"></p><p>æˆ‘ä»¬éœ€è¦å…ˆseekåˆ°éœ€è¦ä½ç½®çš„å‰ä¸€Iå¸§ä¸Šï¼Œç„¶åé€å…¥è§£ç å™¨ï¼Œè§£ç å™¨è§£é™¤ä¸€å¸§ä¹‹åï¼Œåˆ¤æ–­å½“å‰å¸§çš„<a href=\"https://en.wikipedia.org/wiki/Presentation_timestamp\">PTS</a>æ˜¯å¦åœ¨éœ€è¦çš„æ—¶é—´æˆ³èŒƒå›´å†…ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œå†å°†æ•°æ®é€å…¥ç¼–ç å™¨ï¼Œé‡æ–°ç¼–ç å†æ¬¡å¾—åˆ°H.264è§†è½¨æ•°æ®ï¼Œç„¶ååˆæˆMP4æ–‡ä»¶ã€‚</p><p>ä¸Šé¢æ˜¯åŸºç¡€çš„è§†é¢‘è£å‰ªæµç¨‹ï¼Œå¯¹äºè§†é¢‘æ‹¼æ¥ï¼Œä¹Ÿæ˜¯ç±»ä¼¼å¾—åˆ°å¤šæ®µH.264æ•°æ®ä¹‹åï¼Œæ‰ä¸€åŒé€å…¥åˆæˆå™¨ã€‚</p><p>å¦å¤–ï¼Œåœ¨å®é™…è§†é¢‘ç¼–è¾‘ä¸­ï¼Œæˆ‘ä»¬è¿˜ä¼šæ·»åŠ ä¸å°‘è§†é¢‘ç‰¹æ•ˆå’Œæ»¤é•œã€‚å‰é¢åœ¨è§†é¢‘æ‹æ‘„çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬åˆ©ç”¨Surfaceä½œä¸ºMediaCodecçš„è¾“å…¥æºï¼Œå¹¶ä¸”åˆ©ç”¨Surfaceåˆ›å»ºäº†OpenGLçš„ä¸Šä¸‹æ–‡ã€‚è€ŒMediaCodecä½œä¸ºè§£ç å™¨çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥åœ¨<a href=\"https://developer.android.com/reference/android/media/MediaCodec#configure\">configure</a>çš„æ—¶å€™ï¼ŒæŒ‡å®šä¸€å¼ Surfaceä½œä¸ºå…¶è§£ç çš„è¾“å‡ºã€‚å¤§éƒ¨åˆ†è§†é¢‘ç‰¹æ•ˆéƒ½æ˜¯å¯ä»¥é€šè¿‡OpenGLæ¥å®ç°çš„ï¼Œå› æ­¤è¦å®ç°è§†é¢‘ç‰¹æ•ˆï¼Œä¸€èˆ¬çš„æµç¨‹æ˜¯ä¸‹é¢è¿™æ ·çš„ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/0f/5d/0f4a26fd743155b102887758056ba85d.png?wh=1920*207\" alt=\"\"></p><p>æˆ‘ä»¬å°†è§£ç ä¹‹åçš„æ¸²æŸ“äº¤ç»™OpenGLï¼Œç„¶åè¾“å‡ºåˆ°ç¼–ç å™¨çš„InputSurfaceä¸Šï¼Œæ¥å®ç°æ•´å¥—ç¼–ç æµç¨‹ã€‚</p><p><strong>2. è§†é¢‘æ’­æ”¾</strong></p><p>ä»»ä½•è§†é¢‘ç±»Appéƒ½ä¼šæ¶‰åŠè§†é¢‘æ’­æ”¾ï¼Œä»å½•åˆ¶ã€å‰ªè¾‘å†åˆ°æ’­æ”¾ï¼Œæ„æˆå®Œæ•´çš„è§†é¢‘ä½“éªŒã€‚å¯¹äºè¦æ’­æ”¾ä¸€ä¸ªMP4æ–‡ä»¶ï¼Œæœ€ç®€å•çš„æ–¹å¼è«è¿‡äºç›´æ¥ä½¿ç”¨ç³»ç»Ÿçš„<a href=\"https://developer.android.com/reference/android/media/MediaPlayer\">MediaPlayer</a>ï¼Œåªéœ€è¦ç®€å•å‡ è¡Œä»£ç ï¼Œå°±èƒ½ç›´æ¥æ’­æ”¾è§†é¢‘ã€‚å¯¹äºæœ¬åœ°è§†é¢‘æ’­æ”¾æ¥è¯´ï¼Œè¿™æ˜¯æœ€ç®€å•çš„å®ç°æ–¹å¼ï¼Œä½†å®é™…ä¸Šæˆ‘ä»¬å¯èƒ½ä¼šæœ‰æ›´å¤æ‚çš„éœ€æ±‚ï¼š</p><ul>\n<li>\n<p>éœ€è¦æ’­æ”¾çš„è§†é¢‘å¯èƒ½æœ¬èº«å¹¶ä¸åœ¨æœ¬åœ°ï¼Œå¾ˆå¤šå¯èƒ½éƒ½æ˜¯ç½‘ç»œè§†é¢‘ï¼Œæœ‰è¾¹ä¸‹è¾¹æ’­çš„éœ€æ±‚ã€‚</p>\n</li>\n<li>\n<p>æ’­æ”¾çš„è§†é¢‘å¯èƒ½æ˜¯ä½œä¸ºè§†é¢‘ç¼–è¾‘çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨å‰ªè¾‘æ—¶éœ€è¦å®æ—¶é¢„è§ˆè§†é¢‘ç‰¹æ•ˆã€‚</p>\n</li>\n</ul><p>å¯¹äºç¬¬äºŒç§åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•é…ç½®æ’­æ”¾è§†é¢‘çš„Viewä¸ºä¸€ä¸ªGLSurfaceViewï¼Œæœ‰äº†OpenGLçš„ç¯å¢ƒï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è¿™ä¸Šå®ç°å„ç§ç‰¹æ•ˆã€æ»¤é•œçš„æ•ˆæœäº†ã€‚è€Œå¯¹äºè§†é¢‘ç¼–è¾‘å¸¸è§çš„å¿«è¿›ã€å€’æ”¾ä¹‹ç±»çš„æ’­æ”¾é…ç½®ï¼ŒMediaPlayerä¹Ÿæœ‰ç›´æ¥çš„æ¥å£å¯ä»¥è®¾ç½®ã€‚</p><p>æ›´ä¸ºå¸¸è§çš„æ˜¯ç¬¬ä¸€ç§åœºæ™¯ï¼Œä¾‹å¦‚ä¸€ä¸ªè§†é¢‘æµç•Œé¢ï¼Œå¤§éƒ¨åˆ†è§†é¢‘éƒ½æ˜¯åœ¨çº¿è§†é¢‘ï¼Œè™½ç„¶MediaPlayerä¹Ÿèƒ½å®ç°åœ¨çº¿è§†é¢‘æ’­æ”¾ï¼Œä½†å®é™…ä½¿ç”¨ä¸‹æ¥ï¼Œä¼šæœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p><ul>\n<li>\n<p>é€šè¿‡è®¾ç½®MediaPlayerè§†é¢‘URLæ–¹å¼ä¸‹è½½ä¸‹æ¥çš„è§†é¢‘ï¼Œè¢«æ”¾åˆ°äº†ä¸€ä¸ªç§æœ‰çš„ä½ç½®ï¼ŒAppä¸å®¹æ˜“ç›´æ¥è®¿é—®ï¼Œè¿™æ ·ä¼šå¯¼è‡´æˆ‘ä»¬æ²¡æ³•åšè§†é¢‘é¢„åŠ è½½ï¼Œè€Œä¸”ä¹‹å‰å·²ç»æ’­æ”¾å®Œã€ç¼“å†²å®Œçš„è§†é¢‘ï¼Œä¹Ÿä¸èƒ½é‡å¤åˆ©ç”¨åŸæœ‰ç¼“å†²å†…å®¹ã€‚</p>\n</li>\n<li>\n<p>åŒè§†é¢‘å‰ªè¾‘ç›´æ¥ä½¿ç”¨MediaExtractorè¿”å›çš„æ•°æ®é—®é¢˜ä¸€æ ·ï¼ŒMediaPlayeråŒæ ·æ— æ³•ç²¾ç¡®seekï¼Œåªèƒ½seekåˆ°æœ‰å…³é”®å¸§çš„åœ°æ–¹ã€‚</p>\n</li>\n</ul><p>å¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è§†é¢‘URLä»£ç†ä¸‹è½½çš„æ–¹å¼æ¥è§£å†³ï¼Œé€šè¿‡æœ¬åœ°ä½¿ç”¨Local HTTP  Serverçš„æ–¹å¼ä»£ç†ä¸‹è½½åˆ°ä¸€ä¸ªæŒ‡å®šçš„åœ°æ–¹ã€‚ç°åœ¨å¼€æºç¤¾åŒºå·²ç»æœ‰å¾ˆæˆç†Ÿçš„é¡¹ç›®å®ç°ï¼Œä¾‹å¦‚<a href=\"http://AndroidVideoCache\">AndroidVideoCache</a>ã€‚</p><p>è€Œå¯¹äºç¬¬äºŒä¸ªé—®é¢˜æ¥è¯´ï¼Œæ²¡æ³•ç²¾ç¡®seekçš„é—®é¢˜åœ¨æœ‰äº›Appä¸Šæ˜¯è‡´å‘½çš„ï¼Œäº§å“å¯èƒ½æ— æ³•æ¥å—è¿™æ ·çš„ä½“éªŒã€‚é‚£åŒè§†é¢‘ç¼–è¾‘ä¸€æ ·ï¼Œæˆ‘ä»¬åªèƒ½ç›´æ¥åŸºäºMediaCodecæ¥è‡ªè¡Œå®ç°æ’­æ”¾å™¨ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°±æ¯”è¾ƒå¤æ‚äº†ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨Googleå¼€æºçš„<a href=\"https://github.com/google/ExoPlayer\">ExoPlayer</a>ï¼Œç®€å•åˆå¿«æ·ï¼Œè€Œä¸”ä¹Ÿèƒ½æ”¯æŒè®¾ç½®åœ¨çº¿è§†é¢‘URLã€‚</p><p>çœ‹ä¼¼æ‰€æœ‰é—®é¢˜éƒ½æœ‰äº†è§£å†³æ–¹æ¡ˆï¼Œæ˜¯ä¸æ˜¯å°±ä¸‡äº‹å¤§å‰äº†å‘¢ï¼Ÿ</p><p>å¸¸è§çš„ç½‘ç»œè¾¹ä¸‹è¾¹æ’­è§†é¢‘çš„æ ¼å¼éƒ½æ˜¯MP4ï¼Œä½†æœ‰äº›è§†é¢‘ç›´æ¥ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå‘ç°æ— è®ºæ˜¯ä½¿ç”¨MediaPlayerè¿˜æ˜¯ExoPlayerï¼Œä¼¼ä¹éƒ½åªèƒ½ç­‰å¾…åˆ°æ•´ä¸ªè§†é¢‘éƒ½ä¸‹è½½å®Œæ‰èƒ½å¼€å§‹æ’­æ”¾ï¼Œæ²¡æœ‰è¾¾åˆ°è¾¹ä¸‹è¾¹æ’­çš„ä½“éªŒã€‚è¿™ä¸ªé—®é¢˜çš„åŸå› å®é™…ä¸Šæ˜¯å› ä¸ºMP4çš„æ ¼å¼å¯¼è‡´çš„ï¼Œå…·ä½“æ¥çœ‹ï¼Œæ˜¯è·ŸMP4<a href=\"http://l.web.umkc.edu/lizhu/teaching/2016sp.video-communication/ref/mp4.pdf\">æ ¼å¼</a>ä¸­çš„moovæœ‰å…³ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/64/42/6439de8111b1ad7173291c0723071142.png?wh=1172*330\" alt=\"\"></p><p>MP4æ ¼å¼ä¸­æœ‰ä¸€ä¸ªå«ä½œmoovçš„åœ°æ–¹å­˜å‚¨è¿™å½“å‰MP4æ–‡ä»¶çš„å…ƒä¿¡æ¯ï¼ŒåŒ…æ‹¬å½“å‰MP4æ–‡ä»¶çš„éŸ³è½¨è§†è½¨æ ¼å¼ã€è§†é¢‘é•¿åº¦ã€æ’­æ”¾é€Ÿç‡ã€è§†è½¨å…³é”®å¸§ä½ç½®åç§»é‡ç­‰é‡è¦ä¿¡æ¯ï¼ŒMP4æ–‡ä»¶åœ¨çº¿æ’­æ”¾çš„æ—¶å€™ï¼Œéœ€è¦moovä¸­çš„ä¿¡æ¯æ‰èƒ½è§£ç éŸ³è½¨è§†è½¨ã€‚</p><p>è€Œä¸Šè¿°é—®é¢˜å‘ç”Ÿçš„åŸå› åœ¨äºï¼Œå½“moovåœ¨MP4æ–‡ä»¶å°¾éƒ¨çš„æ—¶å€™ï¼Œæ’­æ”¾å™¨æ²¡æœ‰è¶³å¤Ÿçš„ä¿¡æ¯æ¥è¿›è¡Œè§£ç ï¼Œå› æ­¤è§†é¢‘å˜å¾—éœ€è¦ç›´æ¥ä¸‹è½½å®Œä¹‹åæ‰èƒ½è§£ç æ’­æ”¾ã€‚å› æ­¤ï¼Œè¦å®ç°MP4æ–‡ä»¶çš„è¾¹ä¸‹è¾¹æ’­ï¼Œåˆ™éœ€è¦å°†moovæ”¾åˆ°æ–‡ä»¶å¤´éƒ¨ã€‚ç›®å‰æ¥è¯´ï¼Œä¸šç•Œå·²ç»æœ‰éå¸¸æˆç†Ÿçš„å·¥å…·ï¼Œ<a href=\"https://ffmpeg.org/ffmpeg-formats.html#Options-8\">FFmpeg</a>è·Ÿ<a href=\"https://code.google.com/archive/p/mp4v2/\">mp4v2</a>éƒ½å¯ä»¥å°†ä¸€ä¸ªMP4æ–‡ä»¶çš„moovæå‰æ”¾åˆ°æ–‡ä»¶å¤´éƒ¨ã€‚ä¾‹å¦‚ä½¿ç”¨FFmpegï¼Œåˆ™æ˜¯å¦‚ä¸‹å‘½ä»¤ï¼š</p><pre><code>ffmpeg -i input.mp4 -movflags faststart -acodec copy -vcodec copy output.mp4\n</code></pre><p>ä½¿ç”¨<code>-movflags faststart</code>ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠè§†é¢‘æ–‡ä»¶ä¸­çš„moovæå‰äº†ã€‚</p><p>å¦å¤–ï¼Œå¦‚æœæƒ³è¦æ£€æµ‹ä¸€ä¸ªMP4çš„moovæ˜¯å¦åœ¨å‰é¢ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼<a href=\"http://atomicparsley.sourceforge.net/\">AtomicParsley</a>çš„å·¥å…·æ¥æ£€æµ‹ã€‚</p><p>åœ¨è§†é¢‘æ’­æ”¾çš„å®è·µä¸­ï¼Œé™¤äº†MP4æ ¼å¼æ¥ä½œä¸ºè¾¹ä¸‹è¾¹æ’­çš„æ ¼å¼ä»¥å¤–ï¼Œè¿˜æœ‰æ›´å¤šçš„åœºæ™¯éœ€è¦ä½¿ç”¨å…¶ä»–æ ¼å¼ï¼Œä¾‹å¦‚m3u8ã€FLVä¹‹ç±»ï¼Œä¸šç•Œåœ¨å®¢æˆ·ç«¯ä¸­å¸¸è§çš„å®ç°åŒ…æ‹¬<a href=\"https://github.com/bilibili/ijkplayer\">ijkplayer</a>ã€<a href=\"https://github.com/google/ExoPlayer\">ExoPlayer</a>ï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥å‚è€ƒä¸‹å®ƒä»¬çš„å®ç°ã€‚</p><h2>éŸ³è§†é¢‘å¼€å‘çš„å­¦ä¹ ä¹‹è·¯</h2><p>éŸ³è§†é¢‘ç›¸å…³å¼€å‘æ¶‰åŠé¢å¾ˆå¹¿ï¼Œä»Šå¤©æˆ‘ä¹Ÿåªæ˜¯ç®€å•ä»‹ç»ä¸€ä¸‹å…¶ä¸­åŸºæœ¬çš„æ¶æ„ï¼Œå¦‚æœæƒ³ç»§ç»­æ·±å…¥è¿™ä¸ªé¢†åŸŸå‘å±•ï¼Œä»æˆ‘ä¸ªäººå­¦ä¹ çš„ç»å†æ¥çœ‹ï¼Œæƒ³è¦æˆä¸ºä¸€ååˆæ ¼çš„å¼€å‘è€…ï¼Œé™¤äº†åŸºç¡€çš„Androidå¼€å‘çŸ¥è¯†ä»¥å¤–ï¼Œè¿˜è¦æ·±å…¥å­¦ä¹ ï¼Œæˆ‘è®¤ä¸ºè¿˜éœ€è¦æŒæ¡ä¸‹é¢çš„æŠ€æœ¯æ ˆã€‚</p><p><strong>è¯­è¨€</strong></p><ul>\n<li>\n<p>C/C++ï¼šéŸ³è§†é¢‘å¼€å‘ç»å¸¸éœ€è¦è·Ÿåº•å±‚ä»£ç æ‰“äº¤é“ï¼ŒæŒæ¡C/C++æ˜¯å¿…é¡»çš„æŠ€èƒ½ã€‚è¿™æ–¹é¢èµ„æ–™å¾ˆå¤šï¼Œç›¸ä¿¡æˆ‘ä»¬éƒ½èƒ½æ‰¾åˆ°ã€‚</p>\n</li>\n<li>\n<p>ARM NEONæ±‡ç¼–ï¼šè¿™æ˜¯ä¸€é¡¹è¿›é˜¶æŠ€èƒ½ï¼Œåœ¨è§†é¢‘ç¼–è§£ç ã€å„ç§å¸§å¤„ç†ä½ä¸‹æ—¶å¾ˆå¤šéƒ½æ˜¯åˆ©ç”¨NEONæ±‡ç¼–åŠ é€Ÿï¼Œä¾‹å¦‚FFmpeg/libyuvåº•å±‚éƒ½å¤§é‡åˆ©ç”¨äº†NEONæ±‡ç¼–æ¥åŠ é€Ÿå¤„ç†è¿‡ç¨‹ã€‚è™½è¯´å®ƒä¸æ˜¯å¿…å¤‡æŠ€èƒ½ï¼Œä½†æœ‰å…´è¶£ä¹Ÿå¯ä»¥å¤šå¤šäº†è§£ï¼Œå…·ä½“èµ„æ–™å¯ä»¥å‚è€ƒARMç¤¾åŒºçš„<a href=\"https://community.arm.com/processors/b/blog/posts/coding-for-neon---part-1-load-and-stores\">æ•™ç¨‹</a>ã€‚</p>\n</li>\n</ul><p><strong>æ¡†æ¶</strong></p><ul>\n<li>\n<p><a href=\"https://ffmpeg.org/\">FFmpeg</a>ï¼šå¯ä»¥è¯´æ˜¯ä¸šç•Œæœ€å‡ºåçš„éŸ³è§†é¢‘å¤„ç†æ¡†æ¶äº†ï¼Œå‡ ä¹å›Šæ‹¬éŸ³è§†é¢‘å¼€å‘çš„æ‰€æœ‰æµç¨‹ï¼Œå¯ä»¥è¯´æ˜¯å¿…å¤‡æŠ€èƒ½ã€‚</p>\n</li>\n<li>\n<p><a href=\"https://chromium.googlesource.com/libyuv/libyuv/\">libyuv</a>ï¼šGoogleå¼€æºçš„YUVå¸§å¤„ç†åº“ï¼Œå› ä¸ºæ‘„åƒå¤´è¾“å‡ºã€ç¼–è§£ç è¾“å…¥è¾“å‡ºä¹Ÿæ˜¯åŸºäºYUVæ ¼å¼ï¼Œæ‰€ä»¥ä¹Ÿç»å¸¸éœ€è¦è¿™ä¸ªåº“æ¥æ“ä½œæ•°æ®ï¼ˆFFmpegä¹Ÿæœ‰æä¾›äº†è¿™ä¸ªåº“é‡Œé¢æ‰€æœ‰çš„åŠŸèƒ½ï¼Œåœ¨<a href=\"https://www.ffmpeg.org/doxygen/2.7/swscale_8h.html\">libswscale</a>éƒ½å¯ä»¥æ‰¾åˆ°ç±»ä¼¼çš„å®ç°ã€‚ä¸è¿‡è¿™ä¸ªåº“æ€§èƒ½æ›´å¥½ï¼Œä¹Ÿæ˜¯åŸºäºNEONæ±‡ç¼–åŠ é€Ÿï¼‰ã€‚</p>\n</li>\n<li>\n<p><a href=\"https://www.videolan.org/developers/x264.html\">libx264</a>/<a href=\"http://x265.org/\">libx265</a>ï¼šç›®å‰ä¸šç•Œæœ€ä¸ºå¹¿æ³›ä½¿ç”¨çš„H.264/H.265è½¯ç¼–è§£ç åº“ã€‚ç§»åŠ¨å¹³å°ä¸Šè™½ç„¶å¯ä»¥ä½¿ç”¨ç¡¬ç¼–ç ï¼Œä½†å¾ˆå¤šæ—¶å€™å‡ºäºå…¼å®¹æ€§æˆ–ç”»è´¨çš„è€ƒè™‘ï¼Œå› ä¸ºä¸å°‘ä½ç«¯çš„Androidæœºå™¨ï¼Œåœ¨ä½ç ç‡çš„åœºæ™¯ä¸‹è¿˜æ˜¯è½¯ç¼–ç çš„ç”»è´¨ä¼šæ›´å¥½ï¼Œæœ€ç»ˆå¯èƒ½è¿˜æ˜¯å¾—è€ƒè™‘ä½¿ç”¨è½¯ç¼–è§£ç ã€‚</p>\n</li>\n<li>\n<p><a href=\"https://www.khronos.org/opengles/\">OpenGL ES</a>ï¼šå½“ä»Šï¼Œå¤§éƒ¨åˆ†è§†é¢‘ç‰¹æ•ˆã€ç¾é¢œç®—æ³•çš„å¤„ç†ï¼Œæœ€ç»ˆæ¸²æŸ“éƒ½æ˜¯åŸºäºGLESæ¥å®ç°çš„ï¼Œå› æ­¤æƒ³è¦æ·±å…¥éŸ³è§†é¢‘çš„å¼€å‘ï¼ŒGLESæ˜¯å¿…å¤‡çš„çŸ¥è¯†ã€‚å¦å¤–ï¼Œé™¤äº†GLESä»¥å¤–ï¼Œ<a href=\"https://www.khronos.org/vulkan/\">Vulkan</a>ä¹Ÿæ˜¯è¿‘å‡ å¹´å¼€å§‹å‘å±•èµ·æ¥çš„ä¸€ä¸ªæ›´é«˜æ€§èƒ½çš„å›¾å½¢APIï¼Œä½†ç›®å‰æ¥çœ‹ï¼Œä½¿ç”¨è¿˜ä¸æ˜¯ç‰¹åˆ«å¹¿æ³›ã€‚</p>\n</li>\n<li>\n<p><a href=\"https://github.com/google/ExoPlayer\">ExoPlayer</a>/<a href=\"https://github.com/bilibili/ijkplayer\">ijkplayer</a>ï¼šä¸€ä¸ªå®Œæ•´çš„è§†é¢‘ç±»Appè‚¯å®šä¼šæ¶‰åŠè§†é¢‘æ’­æ”¾çš„ä½“éªŒï¼Œè¿™ä¸¤ä¸ªåº“å¯ä»¥è¯´æ˜¯å½“ä¸‹ä¸šç•Œæœ€ä¸ºå¸¸ç”¨çš„è§†é¢‘æ’­æ”¾å™¨äº†ï¼Œæ”¯æŒä¼—å¤šæ ¼å¼ã€åè®®ï¼Œå¦‚æœä½ æƒ³è¦æ·±å…¥å­¦ä¹ è§†é¢‘æ’­æ”¾å¤„ç†ï¼Œå®ƒä»¬å‡ ä¹ä¹Ÿç®—æ˜¯å¿…å¤‡æŠ€èƒ½ã€‚</p>\n</li>\n</ul><p>ä»å®é™…éœ€æ±‚å‡ºå‘ï¼ŒåŸºäºä¸Šè¿°æŠ€æœ¯æ ˆï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸‹é¢ä¸¤æ¡è·¯å¾„æ¥æ·±å…¥å­¦ä¹ ã€‚</p><p><strong>1. è§†é¢‘ç›¸å…³ç‰¹æ•ˆå¼€å‘</strong></p><p>ç›´æ’­ã€å°è§†é¢‘ç›¸å…³Appç›®å‰è¶Šæ¥è¶Šå¤šï¼Œå‡ ä¹æ¯ä¸ªAppç›¸å…³çš„ç‰¹æ•ˆï¼Œå¾€å¾€éƒ½æ˜¯åˆ©ç”¨OpenGLæœ¬èº«æ¥å®ç°ã€‚å¯¹äºä¸€äº›ç®€å•çš„ç‰¹æ•ˆï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼<a href=\"https://en.wikipedia.org/wiki/3D_lookup_table\">Color Look Up Table</a>çš„æŠ€æœ¯ï¼Œé€šè¿‡ä¿®æ”¹ç´ æé…åˆShaderæ¥æŸ¥æ‰¾é¢œè‰²æ›¿æ¢å°±èƒ½å®ç°ã€‚å¦‚æœè¦ç»§ç»­å­¦ä¹ æ›´åŠ å¤æ‚çš„æ»¤é•œï¼Œæ¨èä½ å¯ä»¥å»<a href=\"https://www.shadertoy.com/\">shadertoy</a>å­¦ä¹ å‚è€ƒï¼Œä¸Šé¢æœ‰éå¸¸å¤šShaderçš„ä¾‹å­ã€‚</p><p>è€Œç¾é¢œã€ç¾å‹ç›¸å…³çš„æ•ˆæœï¼Œç‰¹åˆ«æ˜¯ç¾å‹ï¼Œéœ€è¦åˆ©ç”¨äººè„¸è¯†åˆ«è·å–åˆ°å…³é”®ç‚¹ï¼Œå¯¹äººè„¸çº¹ç†è¿›è¡Œä¸‰è§’åˆ’åˆ†ï¼Œç„¶åå†é€šè¿‡Shaderä¸­æ”¾å¤§ã€åç§»å¯¹åº”å…³é”®ç‚¹çº¹ç†åæ ‡æ¥å®ç°ã€‚å¦‚æœæƒ³è¦æ·±å…¥è§†é¢‘ç‰¹æ•ˆç±»çš„å¼€å‘ï¼Œæˆ‘æ¨èå¯ä»¥å¤šå­¦ä¹ OpenGLç›¸å…³çš„çŸ¥è¯†ï¼Œè¿™é‡Œä¼šæ¶‰åŠå¾ˆå¤šä¼˜åŒ–ç‚¹ã€‚</p><p><strong>2. è§†é¢‘ç¼–ç å‹ç¼©ç®—æ³•</strong></p><p>H.264/H.265éƒ½æ˜¯éå¸¸æˆç†Ÿçš„è§†é¢‘ç¼–ç æ ‡å‡†ï¼Œå¦‚ä½•åˆ©ç”¨è¿™äº›è§†é¢‘ç¼–ç æ ‡å‡†ï¼Œåœ¨ä¿è¯è§†é¢‘è´¨é‡çš„å‰æä¸‹ï¼Œå°†è§†é¢‘å¤§å°æœ€å°åŒ–ï¼Œä»è€ŒèŠ‚çœå¸¦å®½ï¼Œè¿™å°±éœ€è¦å¯¹è§†é¢‘ç¼–ç æ ‡å‡†æœ¬èº«è¦æœ‰éå¸¸æ·±åˆ»çš„ç†è§£ã€‚è¿™å¯èƒ½æ˜¯ä¸€ä¸ªé—¨æ§›ç›¸å¯¹è¾ƒé«˜çš„æ–¹å‘ï¼Œæˆ‘ä¹Ÿå°šå¤„å­¦ä¹ é˜¶æ®µï¼Œæœ‰å…´è¶£çš„åŒå­¦å¯ä»¥é˜…è¯»ç›¸å…³ç¼–ç æ ‡å‡†çš„æ–‡æ¡£ã€‚</p><p>æ¬¢è¿ä½ ç‚¹å‡»â€œè¯·æœ‹å‹è¯»â€ï¼ŒæŠŠä»Šå¤©çš„å†…å®¹åˆ†äº«ç»™å¥½å‹ï¼Œé‚€è¯·ä»–ä¸€èµ·å­¦ä¹ ã€‚æˆ‘ä¹Ÿä¸ºè®¤çœŸæ€è€ƒã€ç§¯æåˆ†äº«çš„åŒå­¦å‡†å¤‡äº†ä¸°åšçš„â€œå­¦ä¹ åŠ æ²¹ç¤¼åŒ…â€ï¼ŒæœŸå¾…ä¸ä½ ä¸€èµ·åˆ‡ç£‹è¿›æ­¥å“¦ã€‚</p><p></p>","comments":[{"had_liked":false,"id":82884,"user_name":"å¤§åœŸè±†","can_delete":false,"product_type":"c1","uid":1121636,"ip_address":"","ucode":"67445DC3EC9DB0","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/64/52a5863b.jpg","comment_is_top":false,"comment_ctime":1554343246,"is_pvip":true,"replies":[{"id":"31130","content":"åç¼€åä¸é‡è¦å§ï¼Œç¬¬äºŒä¸ªä¹Ÿä¸æ˜¯ä»€ä¹ˆåŠ å¯†ï¼Œåªæ˜¯æˆ‘ä»¬è‡ªå·±å®šçš„æ–‡ä»¶å¤´è€Œå·²ï¼Œæˆ‘ä»¬è‡ªå·±è§£ç å™¨èƒ½è§£å°±å¥½äº†","user_name":"ä½œè€…å›å¤","user_name_real":"å¼ ç»æ–‡","uid":"1009577","ctime":1555400909,"ip_address":"","comment_id":82884,"utype":1}],"discussion_count":1,"race_medal":0,"score":"78863754574","product_id":100021101,"comment_content":"æ¥æ¥æ¥ï¼Œè¿™ä½å‘¨ä¿Šæ°åŒå­¦èƒ½å¦è§£ç­”ä¸‹ï¼Œå¾®ä¿¡è¯­éŸ³ä¸ºä»€ä¹ˆé€‰ç”¨silk v3çš„ç¼–ç æ ¼å¼ï¼Œè¿˜æœ‰å°±æ˜¯ä½ ä»¬silk v3çš„éŸ³é¢‘æ ¼å¼æ–‡ä»¶ä¸ºå•¥è¦æ”¹æˆ.amrçš„åç¼€åï¼Œç„¶åæ–‡ä»¶çš„ç¬¬ä¸€ä¸ªå­—èŠ‚å‰é¢åŠ ä¸€ä¸ª&quot;.&quot;æ¥æŸåæ–‡ä»¶åšåŠ å¯†","like_count":18,"discussions":[{"author":{"id":1923990,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/5b/96/57d4970d.jpg","nickname":"é­ç‰ä¼š Gabby","note":"","ucode":"4D6D8FB1895B53","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551716,"discussion_content":"é˜²æ­¢é£Ÿå“è¢«è½¬è½½åˆ°å…¶ä»–å¹³å°ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645093555,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":150952,"user_name":"blithe","can_delete":false,"product_type":"c1","uid":1605627,"ip_address":"","ucode":"F5DD4B14D04D40","user_header":"https://static001.geekbang.org/account/avatar/00/18/7f/fb/49507baa.jpg","comment_is_top":false,"comment_ctime":1573634197,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"44523307157","product_id":100021101,"comment_content":"4å¹´å¼€å‘ï¼Œ3å¹´app,1å¹´éŸ³è§†é¢‘ï¼Œå»å¹´å¹²äº†1å¹´çš„éŸ³è§†é¢‘å·¥ä½œï¼Œå‡ºæ¥åæ²¡æ‰¾åˆ°åˆé€‚çš„éŸ³è§†é¢‘å·¥ä½œï¼Œç°åœ¨åˆå›å»åšç”µå•†appäº†ï¼Œå”‰ï¼Œæˆ‘éƒ½æ€€ç–‘æˆ‘åšçš„å¯¹ä¸å¯¹äº†ï¼Œè€Œä¸”éŸ³è§†é¢‘é‡Œé¢æ¶‰åŠçš„ä¸œè¥¿ç¡®å®å¤šï¼Œæ¥¼ä¸»è¯´çš„éƒ½æ˜¯æˆ‘çŸ¥é“çš„ä¸œè¥¿ï¼Œå°±å½“å¤ä¹ ä¸€éäº†","like_count":11},{"had_liked":false,"id":143552,"user_name":"æ˜“æ°´å—é£","can_delete":false,"product_type":"c1","uid":1123818,"ip_address":"","ucode":"A2A0F18228A5D0","user_header":"https://static001.geekbang.org/account/avatar/00/11/25/ea/ec869117.jpg","comment_is_top":false,"comment_ctime":1571729955,"is_pvip":false,"replies":[{"id":"62024","content":"ç°åœ¨ç›´æ’­é‚£ä¹ˆç«ï¼ŒèŒä½è¿˜æ˜¯æŒºå¤šçš„ï¼Œç‰¹åˆ«æ˜¯éŸ³è§†é¢‘ç¼–è¾‘","user_name":"ä½œè€…å›å¤","user_name_real":"å¼ ç»æ–‡","uid":"1009577","ctime":1576677137,"ip_address":"","comment_id":143552,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5866697251","product_id":100021101,"comment_content":"çœ‹ç°åœ¨åšéŸ³è§†é¢‘çš„èŒä½è¿˜æ˜¯æŒºå°‘çš„ï¼Œä»¥åéœ€è¦é‡ä¼šå¢åŠ ä¹ˆï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1009577,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/a9/e251ace7.jpg","nickname":"å¼ ç»æ–‡","note":"","ucode":"94B49E5F80BFDE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471590,"discussion_content":"ç°åœ¨ç›´æ’­é‚£ä¹ˆç«ï¼ŒèŒä½è¿˜æ˜¯æŒºå¤šçš„ï¼Œç‰¹åˆ«æ˜¯éŸ³è§†é¢‘ç¼–è¾‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576677137,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1596652,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI1F9FLicYT5GUwyNhbyrAx4agEh1ZEc1mibxJc0HXiakDcyRe4PJNRBeJA4enWoHJqktf2cynsSK04A/132","nickname":"Geek_67f268","note":"","ucode":"342218FD095960","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1009577,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/a9/e251ace7.jpg","nickname":"å¼ ç»æ–‡","note":"","ucode":"94B49E5F80BFDE","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":565768,"discussion_content":"åšä¸»ï¼Œä½ æ˜¯æŒ‡éŸ³è§†é¢‘ç¼–è¾‘APPå—ï¼Œç›®å‰æˆ‘åªæ˜¯åœ¨åšéŸ³è§†é¢‘å‰ªè¾‘åº”ç”¨å±‚uiå±‚ï¼Œå°å…¬å¸ï¼Œå·²ç»è§‰å¾—ä¸šåŠ¡å¾ˆéš¾äº†ã€‚æˆ‘åº”è¯¥ç»§ç»­åšæŒï¼Œå†ç»§ç»­æ·±å…¥åˆ°éŸ³è§†é¢‘å¼•æ“å±‚å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650540111,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":471590,"ip_address":""},"score":565768,"extra":""}]},{"author":{"id":1062982,"avatar":"https://static001.geekbang.org/account/avatar/00/10/38/46/07c27c49.jpg","nickname":"Kissy","note":"","ucode":"7B1F1F921E7B63","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":297303,"discussion_content":"ç¼–è¾‘è§†é¢‘çš„appä¼šå¤§ğŸ”¥å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596867357,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127096,"user_name":"å‘¨åˆš","can_delete":false,"product_type":"c1","uid":1621310,"ip_address":"","ucode":"385B34309835FB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEK7Ej3f7Ozqo6Dr0jicibDicsjlZMchmHGkaoQeLVgxkzA7YYZQPiadRcs9F1w1wWria2MfYvGeiceia9VQw/132","comment_is_top":false,"comment_ctime":1566552999,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5861520295","product_id":100021101,"comment_content":"è®²çš„å¤ªå¥½äº†","like_count":2},{"had_liked":false,"id":90982,"user_name":"RainFool","can_delete":false,"product_type":"c1","uid":1050331,"ip_address":"","ucode":"580B60B2DB0FBB","user_header":"https://static001.geekbang.org/account/avatar/00/10/06/db/26316767.jpg","comment_is_top":false,"comment_ctime":1556766311,"is_pvip":false,"replies":[{"id":"62004","content":"éŸ³è§†é¢‘æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„è¯é¢˜ï¼Œé™äºè¾¹å¹…åªèƒ½æµ…å°è¾„æ­¢","user_name":"ä½œè€…å›å¤","user_name_real":"å¼ ç»æ–‡","uid":"1009577","ctime":1576675616,"ip_address":"","comment_id":90982,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5851733607","product_id":100021101,"comment_content":"å‰æ®µæ—¶é—´æ²¡æœ‰ç›¸å…³èƒŒæ™¯ï¼Œç›´æ¥ç²—ç•¥çœ‹çš„æ—¶å€™ï¼Œæ„Ÿè§‰ä»€ä¹ˆéƒ½æ²¡æœ‰è®²<br>æœ€è¿‘æœ‰éŸ³è§†é¢‘ç›¸å…³éœ€æ±‚äº†ï¼Œå†æ¥ç»†çœ‹ï¼Œè¾¹çœ‹è¾¹åšç¬”è®°ï¼Œå‘ç°é¢é¢ä¿±åˆ°ï¼Œè¦†ç›–äº†éŸ³è§†é¢‘å¼€å‘çš„æ‰€æœ‰æ–¹å‘<br>æ„Ÿè°¢æ–‡ä¿ŠåŒå­¦çš„æ•´ç†","like_count":1,"discussions":[{"author":{"id":1009577,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/a9/e251ace7.jpg","nickname":"å¼ ç»æ–‡","note":"","ucode":"94B49E5F80BFDE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448752,"discussion_content":"éŸ³è§†é¢‘æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„è¯é¢˜ï¼Œé™äºè¾¹å¹…åªèƒ½æµ…å°è¾„æ­¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576675616,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":85569,"user_name":"è€¿æ£®","can_delete":false,"product_type":"c1","uid":1343125,"ip_address":"","ucode":"16E00EAE680E50","user_header":"https://static001.geekbang.org/account/avatar/00/14/7e/95/56224a2f.jpg","comment_is_top":false,"comment_ctime":1555126757,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5850094053","product_id":100021101,"comment_content":"å¾ˆæ£’çš„å†…å®¹ï¼Œç¡®å®æ˜¯ä»Šåä¸é”™çš„å‘å±•æ–¹å‘ï¼ŒçœŸç‰›ï¼Œå¯¹æˆ‘è¿™ç§ç›´æ¥ç”¨é˜¿é‡Œäº‘åšè§†é¢‘è¿˜ç›´æ’­çš„äººï¼Œå¾ˆæ˜¯æ±—é¢œï¼Œå¸Œæœ›è€å¸ˆå¯ä»¥æ¨èä¸€äº›å­¦ä¹ æ•™æã€‚","like_count":1},{"had_liked":false,"id":83415,"user_name":"warmcheng","can_delete":false,"product_type":"c1","uid":1267353,"ip_address":"","ucode":"711026591CF712","user_header":"https://static001.geekbang.org/account/avatar/00/13/56/99/fc04ac86.jpg","comment_is_top":false,"comment_ctime":1554566186,"is_pvip":false,"replies":[{"id":"31101","content":"è§†é¢‘ç›¸å…³çš„äººæ‰ç°åœ¨è¿˜æ˜¯æŒºç¼ºçš„ï¼Œè€Œä¸”æ›¿æ¢æˆæœ¬æ¯”è¾ƒé«˜ï¼Œå½“ç„¶è§†é¢‘æ·±å…¥ä¸‹å»ä¹Ÿä¸æ˜¯é‚£ä¹ˆå®¹æ˜“","user_name":"ä½œè€…å›å¤","user_name_real":"å¼ ç»æ–‡","uid":"1009577","ctime":1555396933,"ip_address":"","comment_id":83415,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5849533482","product_id":100021101,"comment_content":"ä¸çŸ¥é“å°è§†é¢‘è¿™äº›æ˜¯ä¸æ˜¯ä¹Ÿæ˜¯ä¸€é˜µé£ï¼Œä¹‹åå¯¹ç›¸å…³æŠ€æœ¯çš„éœ€æ±‚é‡ä¼šä¸ä¼šå˜åŒ–ç­‰ç­‰ï¼Œæ˜¯å¦è·¯æ¯”è¾ƒçª„ï¼Œæœ›å¤§ä½¬æŒ‡ç‚¹ä¸‹å°ç™½","like_count":1,"discussions":[{"author":{"id":1009577,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/a9/e251ace7.jpg","nickname":"å¼ ç»æ–‡","note":"","ucode":"94B49E5F80BFDE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446013,"discussion_content":"è§†é¢‘ç›¸å…³çš„äººæ‰ç°åœ¨è¿˜æ˜¯æŒºç¼ºçš„ï¼Œè€Œä¸”æ›¿æ¢æˆæœ¬æ¯”è¾ƒé«˜ï¼Œå½“ç„¶è§†é¢‘æ·±å…¥ä¸‹å»ä¹Ÿä¸æ˜¯é‚£ä¹ˆå®¹æ˜“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555396933,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":83037,"user_name":"è‘£å°šæ–Œ","can_delete":false,"product_type":"c1","uid":1195545,"ip_address":"","ucode":"9582217F65C1C7","user_header":"https://static001.geekbang.org/account/avatar/00/12/3e/19/873abe8a.jpg","comment_is_top":false,"comment_ctime":1554378706,"is_pvip":false,"replies":[{"id":"31128","content":"éŸ³è§†é¢‘çš„ä½“ç³»åŒ–æ·±å…¥èµ„æ–™çš„ç¡®ç›¸å¯¹å°‘ä¸€äº›","user_name":"ä½œè€…å›å¤","user_name_real":"å¼ ç»æ–‡","uid":"1009577","ctime":1555400853,"ip_address":"","comment_id":83037,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5849346002","product_id":100021101,"comment_content":"ä¸€ç›´æƒ³å¾€éŸ³è§†é¢‘ä¸Šæ·±å…¥å»å‘å±•ï¼Œä½†æ˜¯æ˜¯å¸‚é¢ä¸Šçš„å­¦ä¹ èµ„æ–™å¾ˆå°‘ã€‚<br>çœ‹é›·ç¥çš„åšæ–‡ï¼Œä¹Ÿä¸è¶³ä»¥<br>","like_count":1,"discussions":[{"author":{"id":1009577,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/a9/e251ace7.jpg","nickname":"å¼ ç»æ–‡","note":"","ucode":"94B49E5F80BFDE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445829,"discussion_content":"éŸ³è§†é¢‘çš„ä½“ç³»åŒ–æ·±å…¥èµ„æ–™çš„ç¡®ç›¸å¯¹å°‘ä¸€äº›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555400853,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":343171,"user_name":"Geek_a5b1b8","can_delete":false,"product_type":"c1","uid":2649241,"ip_address":"","ucode":"B2CFD834F0A3B7","user_header":"","comment_is_top":false,"comment_ctime":1650688732,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1650688732","product_id":100021101,"comment_content":"æ‰¾äº†ä¸€ä¸ªéŸ³è§†é¢‘å‰ªè¾‘çš„å·¥ä½œï¼Œæˆ‘è´Ÿè´£çš„æ˜¯åº”ç”¨å±‚ï¼Œå¾ˆæƒ³ç»§ç»­æ·±å…¥ï¼Œå¯éŸ³è§†é¢‘çš„ä»£ç æ˜¯å…¬å¸æœºå¯†ï¼Œä¹‹å‰å‡ å¹´ä¹Ÿæ²¡æœ‰å®‰å“è½¬å²—éŸ³è§†é¢‘çš„å…ˆä¾‹ï¼Œè¯·é—®åšä¸»ï¼Œæˆ‘åº”è¯¥ç¦»èŒå»æ‰¾å…¶ä»–çš„å¯ä»¥è½¬æœåŠ¡ç«¯çš„å·¥ä½œå—ï¼Ÿå®‰å“åº”ç”¨å±‚æˆ‘æ€•ä»¥åçœŸçš„æ²¡é¥­åƒ","like_count":0},{"had_liked":false,"id":210146,"user_name":"Rouse","can_delete":false,"product_type":"c1","uid":1205247,"ip_address":"","ucode":"71F090736720B1","user_header":"https://static001.geekbang.org/account/avatar/00/12/63/ff/4d423aa3.jpg","comment_is_top":false,"comment_ctime":1587691843,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587691843","product_id":100021101,"comment_content":"éŸ³è§†é¢‘è¿™ä¸€å—ï¼Œåªä½¿ç”¨è¿‡ijkplayer... è¿™å—æ°´è¿˜æ˜¯å¾ˆæ·±å•Š","like_count":0},{"had_liked":false,"id":117694,"user_name":"ç¨‹åºå‘˜å°è·ƒ","can_delete":false,"product_type":"c1","uid":1015483,"ip_address":"","ucode":"25BB96E0791A60","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7e/bb/947c329a.jpg","comment_is_top":false,"comment_ctime":1564112805,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1564112805","product_id":100021101,"comment_content":"è‡ªå·±åœ¨ä¸€å®¶ç›´æ’­å…¬å¸å·¥ä½œï¼Œä½†æ˜¯Androidç«¯åœ¨æˆ‘æ¥ä¹‹å‰å°±å·²ç»å®ç°äº†æ’­æ”¾å™¨çš„åŠŸèƒ½ï¼Œå¯¹äºéŸ³è§†é¢‘ï¼Œéƒ½ä¸å¥½æ„æ€è¯´è‡ªå·±æ˜¯ç›´æ’­å…¬å¸äº†ã€‚<br><br>è¿™èŠ‚è¯¾çš„å†…å®¹ï¼Œéœ€è¦æˆ‘å¥½å¥½æ¶ˆåŒ–ï¼Œå¹¶åšå¥½è§„åˆ’ï¼Œæ„Ÿè°¢æ„Ÿè°¢","like_count":0},{"had_liked":false,"id":116545,"user_name":"Justin","can_delete":false,"product_type":"c1","uid":1333898,"ip_address":"","ucode":"9328E514CB1257","user_header":"https://static001.geekbang.org/account/avatar/00/14/5a/8a/dd06563f.jpg","comment_is_top":false,"comment_ctime":1563867228,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563867228","product_id":100021101,"comment_content":"webrtcï¼Œé™åˆ°ä¸€å®šï¼ˆ270x480ï¼‰åˆ†è¾¨ç‡ï¼Œé‡Šæ”¾ç¼–ç å™¨ï¼Œé‡æ–°åˆ›å»ºç¼–ç å™¨ï¼Œå‘ç°è¿™ä¸€æ­¥åˆ›å»ºç¼–ç å™¨å‡ºç°å¼‚å¸¸ï¼Œå¯¼è‡´è°ƒç”¨ C å‡½æ•° abortäº†ï¼Œæœ‰é‡åˆ°è¿‡å—ï¼Œä¿Šæ°è€å¸ˆï¼Ÿ","like_count":0},{"had_liked":false,"id":98199,"user_name":"å·¦æ‰‹æœ¨äº½","can_delete":false,"product_type":"c1","uid":1329714,"ip_address":"","ucode":"0761296186B826","user_header":"https://static001.geekbang.org/account/avatar/00/14/4a/32/0da52b17.jpg","comment_is_top":false,"comment_ctime":1558929191,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558929191","product_id":100021101,"comment_content":"æ·±å…¥æµ…å‡º  ä¼˜ç§€ã€‚","like_count":0},{"had_liked":false,"id":96364,"user_name":"ä¸€è·¯å‘åŒ—","can_delete":false,"product_type":"c1","uid":1340760,"ip_address":"","ucode":"886745265E9726","user_header":"https://static001.geekbang.org/account/avatar/00/14/75/58/19b8674f.jpg","comment_is_top":false,"comment_ctime":1558404131,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558404131","product_id":100021101,"comment_content":"å¾ˆä¸é”™çš„æ–‡ç« ï¼Œæ­£åœ¨æœéŸ³è§†é¢‘æ–¹å‘åŠªåŠ›","like_count":0},{"had_liked":false,"id":90991,"user_name":"ä¼¼æ°´ä¸¨ç‚..``","can_delete":false,"product_type":"c1","uid":1196060,"ip_address":"","ucode":"3351BA2168FD28","user_header":"https://static001.geekbang.org/account/avatar/00/12/40/1c/4352be51.jpg","comment_is_top":false,"comment_ctime":1556772537,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556772537","product_id":100021101,"comment_content":"æ‚¨å¥½ï¼Œè¯·é—®ï¼Œå¦‚ä½•è·å–æ‰‹æœºçš„è§£ ç  å™¨ä¸ªæ•°?","like_count":0},{"had_liked":false,"id":87389,"user_name":"Object","can_delete":false,"product_type":"c1","uid":1331794,"ip_address":"","ucode":"F0FBC3E86D37AA","user_header":"https://static001.geekbang.org/account/avatar/00/14/52/52/383f1d69.jpg","comment_is_top":false,"comment_ctime":1555581291,"is_pvip":false,"replies":[{"id":"61990","content":"éŸ³è§†é¢‘çš„æ°´è¿˜æ˜¯éå¸¸æ·±çš„ï¼Œè¿˜æœ‰è§†é¢‘ç¼–è¾‘é‚£ä¸€å—","user_name":"ä½œè€…å›å¤","user_name_real":"å¼ ç»æ–‡","uid":"1009577","ctime":1576674103,"ip_address":"","comment_id":87389,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555581291","product_id":100021101,"comment_content":"è¯´å®è¯ï¼Œçœ‹çš„æœ‰ç‚¹æ™šï¼Œä¹Ÿä¸çŸ¥é“å‘¨å­¦ä½ä¼šä¸ä¼šçœ‹åˆ°ï¼Œè¦è¯´:çœ‹äº†ä¸¤éåŸºæœ¬äº†è§£äº†ï¼Œä¸è¿‡è¿˜æ˜¯æœ‰å¾ˆå¤šä¸æ‡‚å¾—åœ°æ–¹ï¼Œæ˜¯ä¸æ˜¯åšç›´æ’­å’Œsdkå°±è¿™äº›äº†","like_count":0,"discussions":[{"author":{"id":1009577,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/a9/e251ace7.jpg","nickname":"å¼ ç»æ–‡","note":"","ucode":"94B49E5F80BFDE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447424,"discussion_content":"éŸ³è§†é¢‘çš„æ°´è¿˜æ˜¯éå¸¸æ·±çš„ï¼Œè¿˜æœ‰è§†é¢‘ç¼–è¾‘é‚£ä¸€å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576674103,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":87090,"user_name":"èµµå¸…","can_delete":false,"product_type":"c1","uid":1121015,"ip_address":"","ucode":"F5A0F2BEC5332B","user_header":"https://static001.geekbang.org/account/avatar/00/11/1a/f7/7a055016.jpg","comment_is_top":false,"comment_ctime":1555510063,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555510063","product_id":100021101,"comment_content":"å¯¹äºç¬¬äºŒç§åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•é…ç½®æ’­æ”¾è§†é¢‘çš„ View ä¸ºä¸€ä¸ª GLSurfaceViewï¼Œæœ‰äº† OpenGL çš„ç¯å¢ƒï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨è¿™ä¸Šå®ç°å„ç§ç‰¹æ•ˆã€æ»¤é•œçš„æ•ˆæœäº†ã€‚è€Œå¯¹äºè§†é¢‘ç¼–è¾‘å¸¸è§çš„å¿«è¿›ã€å€’æ”¾ä¹‹ç±»çš„æ’­æ”¾é…ç½®ï¼ŒMediaPlayer ä¹Ÿæœ‰ç›´æ¥çš„æ¥å£å¯ä»¥è®¾ç½®ã€‚<br><br><br>ä½ å¥½ï¼Œæ–‡ä¸­è¿™å—çš„æè¿°è¯´MediaPlayerå¯ä»¥ç›´æ¥æœ‰æ¥å£é…ç½®å€’æ”¾åŠŸèƒ½ï¼Œæˆ‘å®åœ¨æ²¡æ‰¾åˆ°ç›¸å…³é…ç½®ğŸ˜‚   è¯·ä¿Šæ°è€å¸ˆæœ‰æ—¶é—´æŒ‡ç‚¹ä¸€ä¸‹ï½","like_count":0},{"had_liked":false,"id":82828,"user_name":"é—®ç­”","can_delete":false,"product_type":"c1","uid":1086571,"ip_address":"","ucode":"0F7858787E2D87","user_header":"https://static001.geekbang.org/account/avatar/00/10/94/6b/60ff0454.jpg","comment_is_top":false,"comment_ctime":1554337342,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554337342","product_id":100021101,"comment_content":"å¾ˆæ£’ï¼Œè°¢è°¢","like_count":0}]}