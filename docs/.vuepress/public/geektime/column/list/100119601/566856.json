{"id":566856,"title":"10ï½œReact Hooksï¼ˆä¸‹ï¼‰ï¼šç”¨Hookså¤„ç†å‡½æ•°ç»„ä»¶çš„å‰¯ä½œç”¨","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å®‹ä¸€ç®ï¼Œæ¬¢è¿å›åˆ°Reactåº”ç”¨å¼€å‘çš„å­¦ä¹ ã€‚</p><p>ä¸ŠèŠ‚è¯¾æˆ‘ä»¬è®²äº†ä»€ä¹ˆæ˜¯Hooksï¼ŒReact 18é‡Œéƒ½æœ‰å“ªäº›Hooksï¼Œç„¶åæ·±å…¥å­¦ä¹ äº†åŸºç¡€Hooksä¹‹ä¸€çš„ <code>useState</code> ï¼Œåœ¨ç»“æŸå‰ä¹Ÿä»‹ç»äº† <code>useRef</code> ã€‚</p><p>è¿™èŠ‚è¯¾æˆ‘ä»¬ç´§æ¥ç€æ¥å­¦ä¹ å¦ä¸€ä¸ªåŸºç¡€Hookï¼š<code>useEffect</code> ï¼Œä»¥åŠç”¨äºç»„ä»¶æ€§èƒ½ä¼˜åŒ–çš„Hooksï¼š<code>useMemo</code> å’Œ <code>useCallback</code> ã€‚è®²å®Œè¿™äº›Hooksï¼Œæˆ‘ä»¬å›è¿‡å¤´äº†è§£ä¸€ä¸‹æ‰€æœ‰React Hookså…±é€šçš„ä½¿ç”¨è§„åˆ™ã€‚æœ€åå›ç­”ä¸ŠèŠ‚è¯¾ä¸€å¼€å§‹æåˆ°çš„ç–‘é—®ï¼š</p><ul>\n<li>å‡½æ•°ç»„ä»¶åŠ Hookså¯ä»¥å®Œå…¨æ›¿ä»£ç±»ç»„ä»¶å—ï¼Ÿ</li>\n<li>è¿˜æœ‰å¿…è¦å­¦ä¹ ç±»ç»„ä»¶å—ï¼Ÿ</li>\n</ul><p>å¥½çš„ï¼Œæˆ‘ä»¬å…ˆä» <code>useEffect</code> å¼€å§‹ã€‚</p><h2>ä»€ä¹ˆæ˜¯å‰¯ä½œç”¨ï¼Ÿ</h2><p>å‰¯ä½œç”¨ï¼ˆSide-effectï¼Œæˆ–ç®€ç§°Effectï¼‰è¿™ä¸ªæ¦‚å¿µåœ¨ä¸ŠèŠ‚è¯¾å·²ç»å¤šæ¬¡å‡ºç°äº†ï¼Œä½ å¯èƒ½è¿˜æ˜¯è§‰å¾—è¿·æƒ‘ï¼Œåˆ°åº•ä»€ä¹ˆæ˜¯å‰¯ä½œç”¨ï¼Ÿ</p><p>è®¡ç®—æœºé¢†åŸŸçš„å‰¯ä½œç”¨æ˜¯æŒ‡ï¼š</p><blockquote>\n<p>å½“è°ƒç”¨å‡½æ•°æ—¶ï¼Œé™¤äº†è¿”å›å¯èƒ½çš„å‡½æ•°å€¼ä¹‹å¤–ï¼Œè¿˜å¯¹ä¸»è°ƒç”¨å‡½æ•°äº§ç”Ÿé™„åŠ çš„å½±å“ã€‚ä¾‹å¦‚ä¿®æ”¹å…¨å±€å˜é‡ï¼Œä¿®æ”¹å‚æ•°ï¼Œå‘ä¸»è°ƒæ–¹çš„ç»ˆç«¯ã€ç®¡é“è¾“å‡ºå­—ç¬¦æˆ–æ”¹å˜å¤–éƒ¨å­˜å‚¨ä¿¡æ¯ç­‰ã€‚<br>\nâ€”â€”<a href=\"https://zh.wikipedia.org/zh-hans/%E5%89%AF%E4%BD%9C%E7%94%A8_(%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6)\">ã€Šå‰¯ä½œç”¨ï¼ˆè®¡ç®—æœºç§‘å­¦ï¼‰- ç»´åŸºç™¾ç§‘ã€‹</a></p>\n</blockquote><p>æ€»ä¹‹ï¼Œ<strong>å‰¯ä½œç”¨å°±æ˜¯è®©ä¸€ä¸ªå‡½æ•°ä¸å†æ˜¯çº¯å‡½æ•°çš„å„ç±»æ“ä½œ</strong>ã€‚æ³¨æ„ï¼Œè¿™ä¸ªæ¦‚å¿µå¹¶ä¸æ˜¯è´¬ä¹‰çš„ï¼Œåœ¨Reactä¸­ï¼Œå¤§é‡è¡Œä¸ºéƒ½å¯ä»¥è¢«ç§°ä½œå‰¯ä½œç”¨ï¼Œæ¯”å¦‚æŒ‚è½½ã€æ›´æ–°ã€å¸è½½ç»„ä»¶ï¼Œäº‹ä»¶å¤„ç†ï¼Œæ·»åŠ å®šæ—¶å™¨ï¼Œä¿®æ”¹çœŸå®DOMï¼Œè¯·æ±‚è¿œç¨‹æ•°æ®ï¼Œåœ¨consoleä¸­æ‰“å°è°ƒè¯•ä¿¡æ¯ï¼Œç­‰ç­‰ã€‚</p><!-- [[[read_end]]] --><p>ä¸ŠèŠ‚è¯¾æåˆ°stateï¼Œå…¶å®æ˜¯ç»‘å®šåœ¨ç»„ä»¶å‡½æ•°ä¹‹å¤–çš„ <code>FiberNode</code> ä¸Šçš„ã€‚è¿™è®©ä½ æƒ³åˆ°äº†ä»€ä¹ˆï¼Ÿå¯¹çš„ï¼Œç»„ä»¶å‡½æ•°æ‰§è¡Œstateæ›´æ–°å‡½æ•°ä»é€»è¾‘ä¸Šè®²ä¹Ÿæ˜¯ä¸€ç§å‰¯ä½œç”¨ã€‚</p><h2>å‰¯ä½œç”¨Hooksï¼šuseEffect</h2><p>é¢å¯¹è¿™ä¹ˆå¤šå‰¯ä½œç”¨ï¼ŒReactå¤§å¤§æ–¹æ–¹åœ°æä¾›äº† <code>useEffect</code> è¿™ä¸ªæ‰§è¡Œå‰¯ä½œç”¨æ“ä½œçš„Hookã€‚å½“ä½ æ‰“ç®—åœ¨å‡½æ•°ç»„ä»¶åŠ å…¥å‰¯ä½œç”¨æ—¶ï¼Œ<code>useEffect</code> åŸºæœ¬ä¸Šä¼šæˆä¸ºä½ çš„é¦–é€‰ã€‚åŒæ—¶ä¹Ÿå»ºè®®ä½ åŠ¡å¿…æŠŠå‰¯ä½œç”¨æ”¾åœ¨ <code>useEffect</code> é‡Œæ‰§è¡Œï¼Œè€Œä¸æ˜¯ç›´æ¥æ”¾åœ¨ç»„ä»¶çš„å‡½æ•°ä½“ä¸­ï¼Œè¿™æ ·å¯ä»¥é¿å…å¾ˆå¤šéš¾ä»¥è°ƒè¯•çš„Bugã€‚</p><p><code>useEffect</code> è¿™ä¸ªHookæœ‰å‡ ç§ç”¨æ³•ã€‚é¦–å…ˆæœ€ç®€å•çš„ç”¨æ³•ï¼Œåªä¼ å…¥ä¸€ä¸ªæ²¡æœ‰è¿”å›å€¼çš„<strong>å‰¯ä½œç”¨å›è°ƒå‡½æ•°</strong>ï¼ˆEffect Callbackï¼‰ï¼š</p><pre><code class=\"language-javascript\">useEffect(() =&gt; {/* çœç•¥ */});\n//        -----------------\n//                ^\n//                |\n//           å‰¯ä½œç”¨å›è°ƒå‡½æ•°\n</code></pre><p>è™½ç„¶ <code>useEffect</code> ä½œä¸ºç»„ä»¶å‡½æ•°ä½“çš„ä¸€éƒ¨åˆ†ï¼Œåœ¨æ¯æ¬¡ç»„ä»¶æ¸²æŸ“ï¼ˆåŒ…æ‹¬æŒ‚è½½å’Œæ›´æ–°é˜¶æ®µï¼‰æ—¶éƒ½ä¼šè¢«è°ƒç”¨ï¼Œä½†ä½œä¸ºå‚æ•°çš„å‰¯ä½œç”¨å›è°ƒå‡½æ•°æ˜¯åœ¨<strong>æäº¤é˜¶æ®µ</strong>æ‰ä¼šè¢«è°ƒç”¨çš„ï¼Œè¿™æ—¶<strong>å‰¯ä½œç”¨å›è°ƒå‡½æ•°å¯ä»¥è®¿é—®åˆ°ç»„ä»¶çš„çœŸå®DOM</strong>ã€‚</p><p>è™½ç„¶è¿™æ˜¯æœ€ç®€å•çš„ç”¨æ³•ï¼Œä½†ç°å®ä¸­çš„ç”¨ä¾‹åè€Œæ¯”è¾ƒå°‘ï¼šæ¯•ç«Ÿæ¯æ¬¡æ¸²æŸ“åéƒ½ä¼šè¢«è°ƒç”¨ï¼Œå¦‚æœä½¿ç”¨ä¸å½“ï¼Œå®¹æ˜“äº§ç”Ÿæ€§èƒ½é—®é¢˜ã€‚è¿™é‡Œæåˆ°äº†ä¸ŠèŠ‚è¯¾è®²åˆ°çš„æ¸²æŸ“é˜¶æ®µå’Œæäº¤é˜¶æ®µï¼Œæˆ‘æŠŠå½“æ—¶ç”»çš„å›¾è´´è¿‡æ¥ï¼Œæ–¹ä¾¿ä½ å‚è€ƒã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/41/f8/41d2498402b49dd3fbbff5108eaa62f8.png?wh=1752x998\" alt=\"\"></p><p>æ¥ä¸‹æ¥å°±æ˜¯æœ€å¸¸ç”¨çš„ç”¨æ³•ï¼š<strong>å‰¯ä½œç”¨çš„æ¡ä»¶æ‰§è¡Œ</strong>ã€‚åœ¨ä¸Šé¢ç”¨æ³•çš„åŸºç¡€ä¸Šï¼Œä¼ å…¥ä¸€ä¸ª<strong>ä¾èµ–å€¼æ•°ç»„</strong>ï¼ˆDependenciesï¼‰ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼š</p><pre><code class=\"language-javascript\">useEffect(() =&gt; {/* çœç•¥ */}, [var1, var2]);\n//        -----------------   -----------\n//                ^                ^\n//                |                |\n//           å‰¯ä½œç”¨å›è°ƒå‡½æ•°       ä¾èµ–å€¼æ•°ç»„\n</code></pre><p>Reactåœ¨æ¸²æŸ“ç»„ä»¶æ—¶ï¼Œä¼šè®°å½•ä¸‹å½“æ—¶çš„ä¾èµ–å€¼æ•°ç»„ï¼Œä¸‹æ¬¡æ¸²æŸ“æ—¶ä¼šæŠŠä¾èµ–å€¼æ•°ç»„é‡Œçš„å€¼ä¾æ¬¡ä¸å‰ä¸€æ¬¡è®°å½•ä¸‹æ¥çš„å€¼åš<strong>æµ…å¯¹æ¯”</strong>ï¼ˆShallow Compareï¼‰ã€‚å¦‚æœæœ‰ä¸åŒï¼Œæ‰ä¼šåœ¨æäº¤é˜¶æ®µæ‰§è¡Œå‰¯ä½œç”¨å›è°ƒå‡½æ•°ï¼Œå¦åˆ™å°±è·³è¿‡è¿™æ¬¡æ‰§è¡Œï¼Œä¸‹æ¬¡æ¸²æŸ“å†ç»§ç»­å¯¹æ¯”ä¾èµ–å€¼æ•°ç»„ã€‚</p><p>ä¾èµ–å€¼æ•°ç»„é‡Œå¯ä»¥åŠ å…¥propsã€stateã€contextå€¼ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œåªè¦å‰¯ä½œç”¨å›è°ƒå‡½æ•°ä¸­ç”¨åˆ°äº†è‡ªå·²èŒƒå›´ä¹‹å¤–çš„å˜é‡ï¼Œéƒ½åº”è¯¥åŠ å…¥åˆ°è¿™ä¸ªæ•°ç»„é‡Œï¼Œè¿™æ ·Reactæ‰èƒ½çŸ¥é“åº”ç”¨çŠ¶æ€çš„å˜åŒ–å’Œå‰¯ä½œç”¨é—´çš„å› æœå…³ç³»ã€‚</p><p>ä¸‹é¢æ¥ä¸€ä¸ªçº§è”èœå•çš„ä¾‹å­ï¼Œå½“çœä»½stateå€¼æ›´æ–°æ—¶ï¼Œå‰¯ä½œç”¨å›è°ƒå‡½æ•°ä¼šæ ¹æ®çœä»½æ¥æ›´æ–°åŸå¸‚åˆ—è¡¨ï¼Œè€ŒåŸå¸‚åˆ—è¡¨ä¹Ÿæ˜¯ä¸€ä¸ªstateï¼Œstateæ›´æ–°ä¼šä½¿ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼ˆrerenderï¼‰ï¼Œä»¥è¾¾åˆ°åˆ·æ–°äºŒçº§èœå•é€‰é¡¹çš„ç›®çš„ã€‚</p><pre><code class=\"language-javascript\">//   ------------   --------------\n//   | çœä»½... |v|   | åŸå¸‚...  |v|\n//   ------------   --------------\n\nconst [province, setProvince] = useState(null);\nconst [cities, setCities] = useState([]);\nuseEffect(() =&gt; {\n  if (province === 'å±±ä¸œ') {\n    // è¿™äº›æ•°æ®å¯ä»¥æ˜¯æœ¬åœ°æ•°æ®ï¼Œä¹Ÿå¯ä»¥ç°ä»æœåŠ¡å™¨ç«¯è¯»å–\n    setCities(['æµå—', 'é’å²›', 'æ·„åš']);\n  }\n}, [province]);\n</code></pre><p><strong>ç©ºæ•°ç»„</strong><code>[]</code><strong>ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ä¾èµ–å€¼æ•°ç»„</strong>ï¼Œç”±äºåœ¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸä¸­ä¾èµ–å€¼ä¸ä¼šæœ‰ä»»ä½•å˜åŒ–ï¼Œæ‰€ä»¥å‰¯ä½œç”¨å›è°ƒå‡½æ•°åªä¼šåœ¨ç»„ä»¶æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œä¹‹åä¸è®ºç»„ä»¶æ›´æ–°å¤šå°‘æ¬¡ï¼Œå‰¯ä½œç”¨éƒ½ä¸ä¼šå†æ‰§è¡Œã€‚è¿™ä¸ªç”¨æ³•å¯ä»¥ç”¨æ¥åŠ è½½è¿œç¨‹æ•°æ®ã€‚</p><p>è¯·ä½ è·Ÿéšæˆ‘ï¼Œç«‹åˆ»ä¸Šæ‰‹ä¸ºoh-my-kanbané¡¹ç›®åŠ å…¥è¿œç¨‹æ•°æ®çš„å­˜å–ã€‚ä¸ºäº†ç®€åŒ–å®ç°ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨æµè§ˆå™¨å†…ç½®çš„ <code>localStorage</code> æœ¬åœ°å­˜å‚¨APIä»£æ›¿è¿œç¨‹æœåŠ¡ã€‚åŒæ ·ï¼Œä¸ºäº†ç®€åŒ–é€»è¾‘ï¼Œæˆ‘ä»¬ä¼šåˆ©ç”¨ <code>JSON.stringify</code> å’Œ <code>JSON.parse</code> åºåˆ—åŒ–å’Œååºåˆ—åŒ–çœ‹æ¿åˆ—æ•°æ®ï¼Œç›´æ¥è¯»å†™<code>localStorage</code> ä¸­çš„å•ä¸€keyã€‚</p><p>åœ¨ <code>src/App.js</code> çš„ <code>App</code> ç»„ä»¶ä»£ç ä¸­åŠ å…¥ä¸€ä¸ªåªåœ¨æŒ‚è½½æ—¶æ‰§è¡Œä¸€æ¬¡çš„ <code>useEffect</code> ï¼Œåœ¨å‰¯ä½œç”¨å›è°ƒå‡½æ•°ä¸­è¯»å–æ•°æ®ï¼Œä¸ºäº†æ¨¡æ‹Ÿè¿œç¨‹æœåŠ¡çš„è€—æ—¶ï¼Œæˆ‘ä»¬åŠ ä¸Šä¸€ä¸ª1ç§’é’Ÿçš„è®¡æ—¶å™¨ï¼š</p><pre><code class=\"language-javascript\">const DATA_STORE_KEY = 'kanban-data-store';\n\nfunction App() {\n&nbsp; const [showAdd, setShowAdd] = useState(false);\n&nbsp; const [todoList, setTodoList] = useState([/*...çœç•¥*/]);\n&nbsp; const [ongoingList, setOngoingList ] = useState([/*...çœç•¥*/]);\n&nbsp; const [doneList, setDoneList ] = useState([/*...çœç•¥*/]);\n&nbsp; useEffect(() =&gt; {\n&nbsp; &nbsp; const data = window.localStorage.getItem(DATA_STORE_KEY);\n&nbsp; &nbsp; setTimeout(() =&gt; {\n&nbsp; &nbsp; &nbsp; if (data) {\n&nbsp; &nbsp; &nbsp; &nbsp; const kanbanColumnData = JSON.parse(data);\n&nbsp; &nbsp; &nbsp; &nbsp; setTodoList(kanbanColumnData.todoList);\n&nbsp; &nbsp; &nbsp; &nbsp; setOngoingList(kanbanColumnData.ongoingList);\n&nbsp; &nbsp; &nbsp; &nbsp; setDoneList(kanbanColumnData.doneList);\n&nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; }, 1000);\n&nbsp; },[]);\n  // ...çœç•¥\n}\n</code></pre><p>æœ‰äº†è¯»å–ï¼Œè¿˜éœ€è¦æœ‰å­˜å‚¨ã€‚åœ¨å®é™…ä¸šåŠ¡ä¸­ï¼Œå› ä¸ºæ¶‰åŠåˆ°æœ¬åœ°æ•°æ®å’Œè¿œç¨‹æ•°æ®çš„åŒæ­¥ï¼Œè¿™éƒ¨åˆ†é€»è¾‘å¯èƒ½ä¼šéå¸¸å¤æ‚ï¼Œè€Œæˆ‘ä»¬è¿™é‡Œç”¨ä¸€ä¸ªå·æ‡’çš„æ–¹æ³•ï¼šåŠ å…¥ä¸€ä¸ªâ€œä¿å­˜æ‰€æœ‰å¡ç‰‡â€çš„æŒ‰é’®ï¼Œç”±ç”¨æˆ·æ¥å†³å®šä»€ä¹ˆæ—¶å€™å­˜å‚¨ã€‚</p><pre><code class=\"language-javascript\">const DATA_STORE_KEY = 'kanban-data-store';\n\nfunction App() {\n  // ...çœç•¥\n  const handleSaveAll = () =&gt; {\n&nbsp; &nbsp; const data = JSON.stringify({\n&nbsp; &nbsp; &nbsp; todoList,\n&nbsp; &nbsp; &nbsp; ongoingList,\n&nbsp; &nbsp; &nbsp; doneList\n&nbsp; &nbsp; });\n&nbsp; &nbsp; window.localStorage.setItem(DATA_STORE_KEY, data);\n&nbsp; };\n  // ...çœç•¥\n&nbsp; return (\n&nbsp; &nbsp; &lt;div className=\"App\"&gt;\n&nbsp; &nbsp; &nbsp; &lt;header className=\"App-header\"&gt;\n&nbsp; &nbsp; &nbsp; &nbsp; &lt;h1&gt;æˆ‘çš„çœ‹æ¿ &lt;button onClick={handleSaveAll}&gt;ä¿å­˜æ‰€æœ‰å¡ç‰‡&lt;/button&gt;&lt;/h1&gt;\n&nbsp; &nbsp; &nbsp; &nbsp; &lt;img src={logo} className=\"App-logo\" alt=\"logo\" /&gt;\n&nbsp; &nbsp; &nbsp; &lt;/header&gt;\n      {/* ...çœç•¥ */}\n    &lt;/div&gt;\n  );\n}\n</code></pre><p>å›åˆ°æµè§ˆå™¨ä¸­ï¼Œæ·»åŠ æ–°å¡ç‰‡ï¼Œå†ç‚¹å‡»æ–°åŠ å…¥çš„â€œä¿å­˜æ‰€æœ‰å¡ç‰‡â€æŒ‰é’®ï¼Œä½ ä¼šåœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„Local Storageä¸­ï¼Œæ‰¾åˆ°ä¸€æ¡æ–°çš„æ•°æ®ã€‚è¿™æ—¶åˆ·æ–°æµè§ˆå™¨ï¼Œä½ ä¼šå‘ç°æ–°æ·»åŠ çš„å¡ç‰‡è¿˜åœ¨ï¼Œä¸åƒä¹‹å‰ä¸€åˆ·å°±æ²¡äº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/27/26/27cb0bea39201605326de6cba693a826.png?wh=1312x712\" alt=\"å›¾ç‰‡\"></p><p>ä¸è¿‡åˆšåˆ·æ–°æµè§ˆå™¨åï¼Œ1ç§’æ—¶é¡µé¢çš„çªç„¶å˜åŒ–è¿˜æ˜¯æœ‰ç‚¹çªå…€çš„ã€‚æˆ‘ä»¬æ¥åŠ å…¥ä¸€ä¸ªè¯»å–çŠ¶æ€æç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/8c/6a/8c3af64a791eb04e3d7a43aae210056a.png?wh=816x1150\" alt=\"\"></p><p>åœ¨æµè§ˆå™¨ä¸­çœ‹ä¸‹æ•ˆæœï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/a4/64/a4f2d87ff95ec2f18380235dfa5be564.gif?wh=794x440\" alt=\"å›¾ç‰‡\"></p><p>å¤ªæ£’äº†ï¼ä½ åˆ©ç”¨ <code>useEffect(effectCallback, [])</code> å®Œæˆäº†AppæŒ‚è½½æ—¶è¯»å–â€œè¿œç¨‹æ•°æ®â€çš„åŠŸèƒ½ã€‚</p><p>å¤šæä¸€å¥ï¼Œä¾èµ–å€¼æ•°ç»„å¹¶ä¸æ˜¯å‰¯ä½œç”¨Hooksä¸“æœ‰çš„æ¦‚å¿µï¼Œ<code>useCallback</code> ã€ <code>useMemo</code> ä¹Ÿæ¥å—ä¾èµ–å€¼æ•°ç»„ä½œä¸ºç¬¬äºŒå‚æ•°ã€‚åé¢çš„è¯¾ç¨‹ä¼šè¯¦ç»†è®²è§£ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ç¬¬8èŠ‚è¯¾åœ¨ <code>oh-my-kanban</code> ä¸­åŠ å…¥çš„å®šæ—¶å™¨åŠŸèƒ½ï¼š</p><pre><code class=\"language-javascript\">const KanbanCard = ({ title, status }) =&gt; {\n&nbsp; const [displayTime, setDisplayTime] = useState(status);\n&nbsp; useEffect(() =&gt; {\n&nbsp; &nbsp; const updateDisplayTime = () =&gt; {\n&nbsp; &nbsp; &nbsp; const timePassed = new Date() - new Date(status);\n&nbsp; &nbsp; &nbsp; let relativeTime = 'åˆšåˆš';\n      // ...çœç•¥\n&nbsp; &nbsp; &nbsp; setDisplayTime(relativeTime);\n&nbsp; &nbsp; };\n&nbsp; &nbsp; const intervalId = setInterval(updateDisplayTime, UPDATE_INTERVAL);\n&nbsp; &nbsp; updateDisplayTime();\n\n&nbsp; &nbsp; return function cleanup() {\n&nbsp; &nbsp; &nbsp; clearInterval(intervalId);\n&nbsp; &nbsp; };\n&nbsp; }, [status]);\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>useEffect</code> æ¥æ”¶äº†å‰¯ä½œç”¨å›è°ƒå‡½æ•°å’Œä¾èµ–å€¼æ•°ç»„ä¸¤ä¸ªå‚æ•°ï¼Œå…¶ä¸­å‰¯ä½œç”¨å›è°ƒå‡½æ•°çš„è¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªè¿”å›çš„å‡½æ•°å«åš<strong>æ¸…é™¤å‡½æ•°</strong>ã€‚ç»„ä»¶åœ¨ä¸‹ä¸€æ¬¡æäº¤é˜¶æ®µæ‰§è¡ŒåŒä¸€ä¸ªå‰¯ä½œç”¨å›è°ƒå‡½æ•°ä¹‹å‰ï¼Œæˆ–è€…æ˜¯ç»„ä»¶å³å°†è¢«å¸è½½ä¹‹å‰ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ¸…é™¤å‡½æ•°ã€‚</p><p>åŒæ—¶å®šä¹‰å‰¯ä½œç”¨å›è°ƒå‡½æ•°ã€æ¸…é™¤å‡½æ•°å’Œä¾èµ–å€¼æ•°ç»„ï¼Œè¿™æ˜¯ <code>useEffect</code> æœ€å®Œæ•´çš„ä¸€ç§ç”¨æ³•ã€‚</p><pre><code class=\"language-javascript\">useEffect(() =&gt; {/* çœç•¥ */; return () =&gt; {/* çœç•¥ */};}, [status]);\n//        ------------------------------------------     -------\n//                       ^         -----------------        ^\n//                       |                 ^                |\n//                  å‰¯ä½œç”¨å›è°ƒå‡½æ•°         æ¸…é™¤å‡½æ•°         ä¾èµ–å€¼æ•°ç»„\n</code></pre><p>å›åˆ°ä¸Šé¢å®šæ—¶å™¨çš„ä¾‹å­ä¸­ï¼Œå¯ä»¥çœ‹å‡ºï¼Œå½“ç»„ä»¶æŒ‚è½½ï¼Œä»¥åŠä¼ å…¥ç»„ä»¶çš„statuså±æ€§å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šæ‰§è¡Œ <code>setInterval</code>ã€<code>setDisplayTime</code> ä¸¤ä¸ªå‰¯ä½œç”¨æ“ä½œã€‚å½“ç»„ä»¶çš„statuså±æ€§å†æ¬¡å˜åŒ–æ—¶ï¼Œä»¥åŠç»„ä»¶è¢«å¸è½½æ—¶ï¼Œä¼šè°ƒç”¨ <code>cleanup</code> æ¸…é™¤å‡½æ•°æ¸…ç†æ‰ä»åœ¨è¿è¡Œçš„å®šæ—¶å™¨ã€‚</p><p>åœ¨è°ƒç”¨<code>setDisplayTime</code> æ›´æ–°stateåï¼Œç»„ä»¶ä¼šé‡æ–°æ¸²æŸ“ï¼Œåœ¨é¡µé¢ä¸Šå°±èƒ½çœ‹åˆ°å¡ç‰‡æ˜¾ç¤ºäº†æœ€æ–°çš„ç›¸å¯¹æ—¶é—´ã€‚å¦‚æœä¸æ¸…ç†å®šæ—¶å™¨ä¼šæ€æ ·ï¼Ÿå¦‚æœæ˜¯åœ¨æ›´æ–°é˜¶æ®µï¼Œç»„ä»¶å°±å¯èƒ½ä¼šæœ‰å¤šä¸ªå®šæ—¶å™¨åœ¨è·‘ï¼Œä¼šäº§ç”Ÿ<strong>ç«äº‰æ¡ä»¶</strong>ï¼›å¦‚æœç»„ä»¶å·²è¢«å¸è½½ï¼Œé‚£ä¹ˆæœ‰å¯èƒ½å¯¼è‡´<strong>å†…å­˜æ³„éœ²</strong>ã€‚</p><p>å¦‚æœä¾èµ–å€¼æ•°ç»„æ˜¯ä¸€ä¸ª<strong>ç©ºæ•°ç»„</strong>ï¼Œé‚£ä¹ˆæ¸…é™¤å‡½æ•°åªä¼šåœ¨å¸è½½ç»„ä»¶æ—¶æ‰§è¡Œã€‚</p><p>å¯¹æ¯”ä¸ŠèŠ‚è¯¾è®²åˆ°çš„ç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œ<code>useEffect</code> æ ¹æ®ç”¨æ³•çš„ä¸åŒï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°å®ç° <code>componentDidMount</code> ã€ <code>componentWillUnmount</code> çš„åŠŸèƒ½ï¼Œè€Œä¸”è¿˜èƒ½æ ¹æ®propsã€stateçš„å˜åŒ–æœ‰æ¡ä»¶åœ°æ‰§è¡Œå‰¯ä½œç”¨ï¼Œæ¯”ç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸæ–¹æ³•çµæ´»å¾ˆå¤šã€‚</p><p>å‰¯ä½œç”¨Hooksé™¤äº†<code>useEffect</code>ï¼Œè¿˜æœ‰ä¸€ä¸ªåå­—ç±»ä¼¼ã€ç”¨æ³•ä¹Ÿç±»ä¼¼çš„<code>useLayoutEffect</code>ã€‚å®ƒçš„å‰¯ä½œç”¨æ‰§è¡Œæ—¶æœºä¸€èˆ¬æ—©äºå‰è€…ï¼Œæ˜¯åœ¨çœŸå®DOMå˜æ›´ä¹‹å<strong>åŒæ­¥</strong>æ‰§è¡Œçš„ï¼Œæ›´æ¥è¿‘ç±»ç»„ä»¶çš„<code>componentDidMount</code> ã€<code>componentWillUnmount</code> ã€‚ä¸ºä¿è¯æ€§èƒ½ï¼Œåº”å°½é‡ä½¿ç”¨ <code>useEffect</code> ä»¥é¿å…é˜»å¡ã€‚</p><h2>æ€§èƒ½ä¼˜åŒ–Hooksï¼šuseMemoå’ŒuseCallback</h2><p>æ¥ä¸‹æ¥ï¼Œè¶ç€ä½ å¯¹ <code>useEffect</code> çš„å‚æ•°å½¢å¼å°è±¡æ·±åˆ»ï¼Œæˆ‘ä»¬å ç”¨ä¸€å°éƒ¨åˆ†ç¯‡å¹…ï¼Œäº†è§£ä¸€ä¸‹ç”¨äºç»„ä»¶æ€§èƒ½ä¼˜åŒ–çš„Hooksï¼š<code>useMemo</code> å’Œ <code>useCallback</code>ã€‚</p><p>å…¶å®è¿™ä¸¤ä¸ªHooksä¸ <code>useEffect</code> å¹¶ä¸æ²¾äº²å¸¦æ•…ã€‚ä¸”ä¸è¯´å®ƒä»¬çš„ç”¨é€”å®Œå…¨ä¸åŒï¼Œå•ä»å›è°ƒå‡½æ•°çš„æ‰§è¡Œé˜¶æ®µæ¥çœ‹ï¼Œå‰è€…æ˜¯åœ¨æ¸²æŸ“é˜¶æ®µæ‰§è¡Œï¼Œè€Œåè€…æ˜¯åœ¨æäº¤é˜¶æ®µã€‚çœ‹èµ·æ¥å®ƒä»¬æœ€å¤§çš„ç›¸ä¼¼ç‚¹ï¼Œåœ¨äºHookçš„<strong>ç¬¬äºŒä¸ªå‚æ•°éƒ½æ˜¯ä¾èµ–å€¼æ•°ç»„</strong>ã€‚</p><p>è¿™é‡Œæ’å…¥ä¸€ä¸ªæ¦‚å¿µï¼š<strong>è®°å¿†åŒ–ï¼ˆMemoizationï¼‰ï¼Œå¯¹äºè®¡ç®—é‡å¤§çš„å‡½æ•°ï¼Œé€šè¿‡ç¼“å­˜å®ƒçš„è¿”å›å€¼æ¥èŠ‚çœè®¡ç®—æ—¶é—´ï¼Œæå‡ç¨‹åºæ‰§è¡Œé€Ÿåº¦</strong>ã€‚å¯¹äºè®°å¿†åŒ–å‡½æ•°çš„è°ƒç”¨è€…è€Œè¨€ï¼Œå­˜å…¥ç¼“å­˜è¿™ä»¶äº‹æœ¬èº«å°±æ˜¯ä¸€ç§å‰¯ä½œç”¨ã€‚<code>useMemo</code> å’Œ <code>useCallback</code> åšæ€§èƒ½ä¼˜åŒ–çš„åŸç†å°±æ˜¯è®°å¿†åŒ–ï¼Œæ‰€ä»¥å®ƒä»¬çš„æœ¬è´¨å’Œ <code>useEffect</code> ä¸€æ ·ï¼Œéƒ½æ˜¯åœ¨å¤„ç†å‰¯ä½œç”¨ã€‚</p><p>å…ˆæ¥çœ‹ä¸€ä¸‹<code>useMemo</code> ï¼Œè¿™ä¸ªHookæ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯<strong>å·¥å‚å‡½æ•°</strong>ï¼ˆFactoryï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯ä¾èµ–å€¼æ•°ç»„ï¼Œå®ƒçš„è¿”å›å€¼å°±æ˜¯æ‰§è¡Œå·¥å‚å‡½æ•°çš„è¿”å›å€¼ï¼š</p><pre><code class=\"language-javascript\">const memoized = useMemo(() =&gt; createByHeavyComputing(a, b), [a, b]);\n//    --------           ----------------------------------  ------\n//       ^                            ^                         ^\n//       |                            |                         |\n//   å·¥å‚å‡½æ•°è¿”å›å€¼                   å·¥å‚å‡½æ•°                  ä¾èµ–å€¼æ•°ç»„\n</code></pre><p><code>useMemo</code> çš„åŠŸèƒ½æ˜¯<strong>ä¸ºå·¥å‚å‡½æ•°è¿”å›ä¸€ä¸ªè®°å¿†åŒ–çš„è®¡ç®—å€¼</strong>ï¼Œåœ¨ä¸¤æ¬¡æ¸²æŸ“ä¹‹é—´ï¼Œ<strong>åªæœ‰ä¾èµ–å€¼æ•°ç»„ä¸­çš„ä¾èµ–å€¼æœ‰å˜åŒ–æ—¶ï¼Œè¯¥Hookæ‰ä¼šè°ƒç”¨å·¥å‚å‡½æ•°é‡æ–°è®¡ç®—</strong>ï¼Œå°†æ–°çš„è¿”å›å€¼è®°å¿†åŒ–å¹¶è¿”å›ç»™ç»„ä»¶ã€‚</p><p><code>useMemo</code> æœ€é‡è¦çš„ä½¿ç”¨åœºæ™¯ï¼Œæ˜¯å°†æ‰§è¡Œæˆæœ¬è¾ƒé«˜çš„è®¡ç®—ç»“æœå­˜å…¥ç¼“å­˜ï¼Œé€šè¿‡å‡å°‘é‡å¤è®¡ç®—æ¥æå‡ç»„ä»¶æ€§èƒ½ã€‚æˆ‘ä»¬ä¾æ—§ç”¨ä¸ŠèŠ‚è¯¾çš„æ–æ³¢é‚£å¥‘æ•°åˆ—é€’å½’å‡½æ•°æ¥ä¸¾ä¾‹ï¼Œä»stateä¸­è·å–<code>num</code> ï¼Œè½¬æ¢æˆæ•´æ•°<code>n</code> åä¼ é€’ç»™å‡½æ•° ï¼Œå³è®¡ç®—ç¬¬ <code>n</code> ä¸ªæ–æ³¢é‚£å¥‘æ•°ï¼š</p><pre><code class=\"language-javascript\">const [num, setNum] = useState('0');\nconst sum = useMemo(() =&gt; {\n  const n = parseInt(num, 10);\n  return fibonacci(n);\n}, [num]);\n</code></pre><p>çŠ¶æ€<code>num</code> çš„åˆå§‹å€¼æ˜¯å­—ç¬¦ä¸² <code>'0'</code> ï¼Œç»„ä»¶æŒ‚è½½æ—¶ <code>useMemo</code> ä¼šæ‰§è¡Œä¸€æ¬¡ <code>fibonacci(0)</code> è®¡ç®—å¹¶è¿”å› <code>0</code> ã€‚å¦‚æœåç»­é€šè¿‡æ–‡æœ¬æ¡†è¾“å…¥çš„æ–¹å¼ä¿®æ”¹ <code>num</code> çš„å€¼ï¼Œå¦‚ <code>'40'</code> ï¼Œ <code>'40'</code> ä¸ä¸Šæ¬¡çš„ <code>'0'</code> ä¸åŒï¼Œåˆ™ <code>useMemo</code> å†æ¬¡è®¡ç®— <code>fibonacci(40)</code> ï¼Œè¿”å› <code>102334155</code> ï¼Œå¦‚æœåç»­å…¶ä»–stateå‘ç”Ÿäº†æ”¹å˜ï¼Œä½† <code>num</code> çš„å€¼ä¿æŒ <code>'40'</code> ä¸å˜ï¼Œåˆ™ <code>useMemo</code> ä¸ä¼šæ‰§è¡Œå·¥å‚å‡½æ•°ï¼Œç›´æ¥è¿”å›ç¼“å­˜ä¸­çš„ <code>102334155</code> ï¼Œå‡å°‘äº†ç»„ä»¶æ€§èƒ½æŸè€—ã€‚</p><p>ç„¶åæ˜¯ <code>useCallback</code> ï¼Œå®ƒä¼šæŠŠä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°çš„å›è°ƒå‡½æ•°è¿”å›ç»™ç»„ä»¶ï¼Œåªè¦ç¬¬äºŒä¸ªå‚æ•°ä¾èµ–å€¼æ•°ç»„çš„ä¾èµ–é¡¹ä¸æ”¹å˜ï¼Œå®ƒå°±ä¼šä¿è¯ä¸€ç›´è¿”å›åŒä¸€ä¸ªå›è°ƒå‡½æ•°ï¼ˆå¼•ç”¨ï¼‰ï¼Œè€Œä¸æ˜¯æ–°å»ºä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¹Ÿä¿è¯äº†å›è°ƒå‡½æ•°çš„é—­åŒ…ä¹Ÿæ˜¯ä¸å˜çš„ï¼›ç›¸åï¼Œå½“ä¾èµ–é¡¹æ”¹å˜æ—¶ï¼Œ <code>useCallback</code> æ‰ä¼šæ›´æ–°å›è°ƒå‡½æ•°åŠå…¶é—­åŒ…ã€‚</p><pre><code class=\"language-javascript\">const memoizedFunc = useCallback(() =&gt; {/*çœç•¥*/}, [a, b]);\n//    ------------               ---------------   -----\n//         ^                            ^            ^\n//         |                            |            |\n//   è®°å¿†åŒ–çš„å›è°ƒå‡½æ•°                   å›è°ƒå‡½æ•°      ä¾èµ–å€¼æ•°ç»„\n</code></pre><p>å…¶å® <code>useCallback</code> æ˜¯ <code>useMemo</code> çš„ä¸€ä¸ªé©¬ç”²ï¼Œç›¸å½“äºï¼š</p><pre><code class=\"language-javascript\">const memoizedFunc = useMemo(() =&gt; () =&gt; {/*çœç•¥*/}, [a, b]);\n//    ------------           ---------------------   -----\n//       ^                      ^  ---------------      ^\n//       |                      |         ^             |\n// å·¥å‚å‡½æ•°è¿”å›çš„å›è°ƒå‡½æ•°        å·¥å‚å‡½æ•°   å›è°ƒå‡½æ•°        ä¾èµ–å€¼æ•°ç»„\n</code></pre><p>ä½ å¯èƒ½ä¼šæœ‰ç–‘é—®ï¼Œä»é©¬ç”²è§†å›¾çœ‹æ¥ï¼Œâ€œå·¥å‚å‡½æ•°ç›´æ¥è¿”å›å¦ä¸€ä¸ªå‡½æ•°â€è¿™ç§æ“ä½œä¸€ç‚¹ä¹Ÿä¸é‡å•Šï¼Œä¸ºä»€ä¹ˆè¯´<code>useCallback</code> ä¹Ÿèƒ½ç”¨æ¥ä¼˜åŒ–ç»„ä»¶æ€§èƒ½çš„å‘¢ï¼Ÿ</p><p>å¦‚æœä½ è¿˜è®°å¾—ï¼Œä¸ŠèŠ‚è¯¾è®²ä»€ä¹ˆæ˜¯çº¯å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬é¡ºå¸¦æåˆ°äº†çº¯ç»„ä»¶çš„ç‰¹æ€§ï¼šå½“ç»„ä»¶çš„propså’Œstateæ²¡æœ‰å˜åŒ–æ—¶ï¼Œå°†è·³è¿‡è¿™æ¬¡æ¸²æŸ“ã€‚è€Œä½ åœ¨å‡½æ•°ç»„ä»¶å†…é¢‘ç¹å£°æ˜çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œæ¯”å¦‚ <code>handleSubmit</code> ï¼Œåœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ã€‚</p><p>å¦‚æœæŠŠè¿™ä¸ªå‡½æ•°éšç€propsä¼ é€’ç»™ä½œä¸ºå­ç»„ä»¶çš„çº¯ç»„ä»¶ï¼Œåˆ™ä¼šå¯¼è‡´çº¯ç»„ä»¶çš„ä¼˜åŒ–æ— æ•ˆï¼Œå› ä¸ºæ¯æ¬¡çˆ¶ç»„ä»¶é‡æ–°æ¸²æŸ“éƒ½ä¼šå¸¦ç€å­ç»„ä»¶ä¸€èµ·é‡æ–°æ¸²æŸ“ã€‚è¿™æ—¶å°±è½®åˆ°<code>useCallback</code> å‡ºé©¬äº†ï¼Œä½¿ç”¨å¦¥å½“çš„è¯ï¼Œå­ç»„ä»¶ä¸ä¼šç›²ç›®è·Ÿéšçˆ¶ç»„ä»¶ä¸€èµ·é‡æ–°æ¸²æŸ“ï¼Œè¿™æ ·çš„è¯ï¼Œåå¤æ¸²æŸ“å­ç»„ä»¶çš„æˆæœ¬å°±èŠ‚çœä¸‹æ¥äº†ã€‚</p><p>ä¸Šé¢ä»‹ç»äº†<code>useMemo</code> å’Œ <code>useCallback</code> çš„å®Œæ•´æ¦‚å¿µå’Œæœ€å…¸å‹çš„ä½¿ç”¨åœºæ™¯ã€‚æˆ‘ä»¬è¿˜ä¼šåœ¨åç»­çš„ã€Šæ•°æ®ä¸å¯å˜æ€§ã€‹å’Œã€Šå¤§å‹é¡¹ç›®ã€‹ä¸¤èŠ‚è¯¾ä¸­é‡åˆ°è¿™ä¸¤ä¸ªHooksï¼Œå±Šæ—¶ä¼šç»“åˆå®é™…é¡¹ç›®å†åšè¿›ä¸€æ­¥è®²è§£ã€‚</p><h2>Hooksçš„ä½¿ç”¨è§„åˆ™</h2><p>æˆ‘ä»¬å‰é¢å­¦ä¹ äº†åŸºç¡€çš„çŠ¶æ€å’Œå‰¯ä½œç”¨Hooksï¼Œä»¥åŠéƒ¨åˆ†æ‰©å±•Hooksï¼Œç›¸ä¿¡ä½ å¯¹è¿™ç§å‡½æ•°å¼çš„APIæœ‰äº†æ›´è¿›ä¸€æ­¥çš„äº†è§£ã€‚</p><p>è™½ç„¶å€Ÿé‰´äº†å¾ˆå¤šå‡½æ•°å¼ç¼–ç¨‹çš„ç‰¹æ€§ï¼ŒHooksæœ¬èº«ä¹Ÿéƒ½æ˜¯JavaScriptå‡½æ•°ï¼Œä½†Hooksç»ˆå½’æ˜¯ä¸€å¥—<strong>Reactç‰¹æœ‰çš„API</strong>ï¼Œä½¿ç”¨Hookså¹¶ä¸ç­‰äºå‡½æ•°å¼ç¼–ç¨‹ï¼Œä¹Ÿä¸èƒ½æŠŠå‡½æ•°å¼ç¼–ç¨‹çš„å„ç§æœ€ä½³å®è·µå®Œæ•´åœ°æ¬åˆ°Hooksèº«ä¸Šã€‚</p><p>æ¯”èµ·ä¼ ç»Ÿçš„å‡½æ•°å¼ç¼–ç¨‹ï¼Œæœ‰ä¸¤æ¡é™åˆ¶ï¼Œéœ€è¦ä½ åœ¨ä½¿ç”¨Hooksæ—¶åŠ¡å¿…æ³¨æ„ã€‚</p><p><strong>ç¬¬ä¸€ï¼Œåªèƒ½åœ¨Reactçš„å‡½æ•°ç»„ä»¶ä¸­è°ƒç”¨Hooks</strong>ã€‚è¿™ä¹ŸåŒ…æ‹¬äº†åœ¨è‡ªå®šä¹‰çš„Hookä¸­è°ƒç”¨å…¶ä»–Hooksè¿™æ ·é—´æ¥çš„è°ƒç”¨æ–¹å¼ï¼Œç›®çš„æ˜¯ä¿è¯Hooksèƒ½â€œå‹¾â€åˆ°Reactçš„è™šæ‹ŸDOMä¸­å»ï¼Œè„±ç¦»Reactç¯å¢ƒçš„Hooksæ˜¯æ— æ³•èµ·ä½œç”¨çš„ã€‚</p><p><strong>ç¬¬äºŒï¼Œåªèƒ½åœ¨ç»„ä»¶å‡½æ•°çš„æœ€é¡¶å±‚è°ƒç”¨Hooks</strong>ã€‚æ— è®ºç»„ä»¶å‡½æ•°è¿è¡Œå¤šå°‘éï¼Œéƒ½è¦ä¿è¯æ¯ä¸ªHookçš„æ‰§è¡Œé¡ºåºï¼Œè¿™æ ·Reactæ‰èƒ½è¯†åˆ«æ¯ä¸ªHookï¼Œä¿æŒå®ƒä»¬çš„çŠ¶æ€ã€‚å½“ç„¶ï¼Œè¿™å°±è¦æ±‚å¼€å‘è€…ä¸èƒ½åœ¨å¾ªç¯ã€æ¡ä»¶åˆ†æ”¯ä¸­æˆ–è€…ä»»ä½•returnè¯­å¥ä¹‹åè°ƒç”¨Hooksã€‚</p><p>å…¶å®ä»Fiberåè°ƒå¼•æ“çš„åº•å±‚å®ç°æ¥çœ‹ï¼Œä¹Ÿä¸éš¾ç†è§£ä¸Šé¢ä¸¤ä¸ªé™åˆ¶ã€‚å‡½æ•°ç»„ä»¶é¦–æ¬¡æ¸²æŸ“æ—¶ä¼šåˆ›å»ºå¯¹åº”çš„FiberNodeï¼Œè¿™ä¸ªFiberNodeä¸Šä¼šä¿å­˜ä¸€ä¸ªè®°å½•HooksçŠ¶æ€çš„å•å‘é“¾è¡¨ï¼Œé“¾è¡¨çš„é•¿åº¦ä¸æ‰§è¡Œç»„ä»¶å‡½æ•°æ—¶è°ƒç”¨çš„Hooksä¸ªæ•°ç›¸åŒï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/82/61/8230e0427b3f51f031e6b3473ed11961.png?wh=2560x1506\" alt=\"\"></p><p>å½“å‡½æ•°ç»„ä»¶å†æ¬¡æ¸²æŸ“æ—¶ï¼Œæ¯ä¸ªHookéƒ½ä¼šè¢«å†æ¬¡è°ƒç”¨ï¼Œè€Œè¿™äº›Hooksä¼šæŒ‰é¡ºåºï¼Œå»è¿™ä¸ªå•å‘é“¾è¡¨ä¸­ä¸€ä¸€è®¤é¢†è‡ªå·±ä¸Šä¸€æ¬¡çš„çŠ¶æ€ï¼Œå¹¶æ ¹æ®éœ€è¦æ²¿ç”¨æˆ–è€…æ›´æ–°è‡ªå·±åœ¨é“¾è¡¨ä¸­çš„çŠ¶æ€ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/4d/64/4dedab5eb90b3fc7c3d06edbd67c9064.jpg?wh=1261x727\" alt=\"\"></p><p>è¿™ä¹Ÿè¯´æ˜äº†ä¸ºä»€ä¹ˆä¸€ä¸ª <code>useState</code> æ¯æ¬¡æ¸²æŸ“è¿”å›çš„stateæ›´æ–°å‡½æ•°éƒ½æ˜¯åŒä¸€ä¸ªå‡½æ•°ï¼ˆå¼•ç”¨ï¼‰ï¼Œ <code>useEffect</code> ä¹Ÿæ˜¯é€šè¿‡è¿™ä¸ªHookçŠ¶æ€æ¥æ¯”å¯¹ä¾èµ–å€¼æ•°ç»„åœ¨ä¸¤æ¬¡æ¸²æŸ“ä¹‹é—´æ˜¯å¦æœ‰æ›´æ”¹ï¼Œè¿›è€Œå†³å®šæ˜¯å¦å†æ¬¡æ‰§è¡Œå‰¯ä½œç”¨ã€‚</p><p>å†å›æ¥çœ‹è¿™ä¸¤ä¸ªé™åˆ¶ã€‚å¦‚æœä¸åœ¨Reactçš„å‡½æ•°ç»„ä»¶ä¸­è°ƒç”¨Hooksï¼ŒReactå°±ä¸ä¼šåˆ›å»ºè®°å½•HooksçŠ¶æ€çš„å•å‘é“¾è¡¨ï¼›å¦‚æœåœ¨å¾ªç¯ã€æ¡ä»¶åˆ†æ”¯ç­‰ä¸ç¨³å®šçš„ä»£ç ä½ç½®è°ƒç”¨Hooksï¼Œå°±æœ‰å¯èƒ½å¯¼è‡´å†æ¬¡æ¸²æŸ“æ—¶ï¼Œæ‰§è¡ŒHooksçš„æ•°é‡ã€ç§ç±»å’Œå‚æ•°ä¸ä¸Šæ¬¡çš„å•å‘é“¾è¡¨ä¸ä¸€è‡´ï¼ŒHookså†…éƒ¨çš„é€»è¾‘å°±ä¹±æ‰äº†ã€‚</p><p>åœ¨æ»¡è¶³è¿™ä¸¤ä¸ªé™åˆ¶çš„å‰æä¸‹ï¼ŒHooksä¸å…¶ä»–JSå‡½æ•°æ— å¼‚ï¼Œå‡½æ•°çš„ç»„åˆã€å¤ç”¨æ˜¯éå¸¸çµæ´»çš„ã€‚Reacté¼“åŠ±å¼€å‘è€…è‡ªå®šä¹‰Hooksï¼Œåœ¨è¿™èŠ‚è¯¾æˆ‘ä»¬æš‚ä¸å±•å¼€ï¼Œåé¢ä¼šä¸“é—¨æœ‰ä¸€èŠ‚è¯¾è®²Reactä»£ç å¤ç”¨ã€‚</p><h2>ç”¨ç±»ç»„ä»¶è¿˜æ˜¯å‡½æ•°ç»„ä»¶åŠ Hooksï¼Ÿ</h2><p>æˆªæ­¢ç›®å‰ï¼Œæˆ‘çœ‹åˆ°å¤§éƒ¨åˆ†Reactæ•™ç¨‹éƒ½æ˜¯å…ˆå­¦ä¹ ç±»ç»„ä»¶ï¼Œå†å­¦ä¹ Hooksï¼ŒçŒœæµ‹ä¸»è¦æœ‰ä¸¤æ–¹é¢çš„åŸå› ã€‚ä¸€æ˜¯ç±»ç»„ä»¶ä¸ä»¥å¾€çš„ä¼ ç»Ÿå‰ç«¯æ¡†æ¶æ›´ç›¸ä¼¼ï¼›äºŒæ˜¯ç±»ç»„ä»¶çš„ç°å­˜æ¡ˆä¾‹å’Œæ–‡æ¡£æ›´å¤šï¼Œè¿™ä¸¤ç‚¹éƒ½å¯¼è‡´äº†æ•™ç¨‹åˆ¶ä½œçš„æƒ¯æ€§ã€‚</p><p>ä½†åœ¨è¿™èŠ‚è¯¾ä½ ä¼šå‘ç°ï¼Œæˆ‘åˆ»æ„åœ°å¼•å¯¼ä½ <strong>ä¼˜å…ˆå­¦ä¹ å‡½æ•°ç»„ä»¶åŠ Hooksã€‚</strong>æˆ‘çŒœæƒ³ï¼Œä½ æ˜¯ä¸æ˜¯æœ‰ç‚¹æ‹…å¿ƒè‡ªå·±å› ä¸ºå°‘å­¦äº†ä¸€éƒ¨åˆ†å†…å®¹è€Œè½åäºå…¶ä»–äººï¼Ÿæˆ‘è§‰å¾—ä½ ä¸ç”¨æ‹…å¿ƒï¼ŒåŸå› æœ‰ä¸‹é¢ä¸¤ç‚¹ã€‚</p><p>ä¸€æ˜¯ï¼ŒReactå®˜æ–¹æ–‡æ¡£å·²ç»æ¨èå¼€å‘è€…åœ¨å¼€å‘æ–°åº”ç”¨æ—¶<a href=\"https://zh-hans.reactjs.org/docs/hooks-faq.html#should-i-use-hooks-classes-or-a-mix-of-both\">é¦–é€‰å‡½æ•°ç»„ä»¶åŠ Hooks</a>ã€‚ä»2019å¹´åˆåˆ°2022å¹´å·²ç»ä¸‰å¹´äº†ï¼ŒReactä¹Ÿå·²ç»ä»v16.8.0æ›´æ–°åˆ°v18.2.0äº†ï¼Œå®é™…æƒ…å†µåˆæ€æ ·äº†å‘¢ï¼Ÿ</p><p>ä¸Šæ•°æ®ï¼Œåœ¨Githubä¸Šæœç´¢åŒ…å«React \"useState\"çš„ä»£ç ï¼Œè¿”å›çš„JSã€TSã€TSXæ–‡ä»¶æ€»æ•°ä¸º17.9Mï¼Œè€ŒReact \"extends React.Component\"åŠ ä¸ŠReact \"extends Component\"ä¸¤æ¬¡æœç´¢çš„ç»“æœä¸º10Mã€‚</p><p>å½“ç„¶è¿™ç§ç»Ÿè®¡å¹¶ä¸ä¸¥è°¨ï¼Œä½†å·²ç»å¯ä»¥è¯æ˜Hooksçš„å—æ¬¢è¿ç¨‹åº¦ï¼Œå¯ä»¥è®¤ä¸º<strong>å‡½æ•°ç»„ä»¶å·²ç»ä»£æ›¿ç±»ç»„ä»¶æˆä¸ºä¸»æµç»„ä»¶å½¢å¼</strong>ï¼Œå­¦ä¹ å¥½å‡½æ•°ç»„ä»¶åŠ Hooksï¼ŒåŸºæœ¬å°±å¯ä»¥åº”å¯¹ä¸»æµReactåº”ç”¨å¼€å‘äº†ã€‚</p><p>äºŒæ˜¯å…ˆå…¥ä¸ºä¸»ã€‚ç±»ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶ä»£è¡¨äº†ä¸¤ç§ä¸åŒçš„ç¼–ç¨‹æ–¹å¼ï¼Œå‰è€…æ›´é¢å‘å¯¹è±¡ï¼Œåè€…æ›´æ¥è¿‘å‡½æ•°å¼ç¼–ç¨‹ã€‚å…ˆå­¦ä¹ ç±»ç»„ä»¶ï¼Œä¼šè®©å¼€å‘è€…å€¾å‘äºç”¨é¢å‘å¯¹è±¡çš„æ€è·¯ç†è§£Reactçš„å„ç§æ¦‚å¿µï¼Œè€Œå®é™…ä¸Šï¼Œåœ¨React v18.2.0ç‰ˆæœ¬çš„æºç ä¸­ï¼Œé¢å‘å¯¹è±¡çš„æ¯”é‡å·²ç»è¶Šæ¥è¶Šä½äº†ã€‚è¿™æ—¶å†å»å­¦ä¹ ç±»ç»„ä»¶ä»¥å¤–çš„æ¦‚å¿µï¼Œå¼€å‘è€…å°±ä¸å¾—ä¸å…ˆä¿®æ­£ä¹‹å‰çš„ç†è§£ã€‚</p><p>æˆ‘æœ‰ä¸å°‘åŒäº‹å®Œæ•´ç»å†äº†ä»ç±»ç»„ä»¶åˆ°å‡½æ•°ç»„ä»¶åŠ Hooksçš„è½¬æ¢ï¼Œæˆ‘è§‚å¯Ÿåˆ°ï¼Œå½“ä»–ä»¬åœ¨å·²ç»æŒæ¡ç±»ç»„ä»¶çš„åŸºç¡€ä¸Šå†å­¦ä¹ Hooksæ—¶ï¼Œä¼š<strong>ä¸è‡ªè§‰åœ°ä»å‰è€…ä¸­å¯»æ‰¾å‚ç…§ç‰©</strong>ï¼Œä¸€æ—¦å‘ç°åœ¨ç‰¹å®šçš„åŠŸèƒ½ä¸Šæ‰¾ä¸åˆ°å‚ç…§ç‰©æ—¶ï¼Œå¤šå°‘ä¼šèµ°äº›å¼¯è·¯ã€‚</p><p>æ¯”å¦‚ä»–ä»¬ä¼šç”¨ <code>useEffect</code> ç†è§£æˆç±»ç»„ä»¶é‡Œçš„ <code>componentDidMount</code> å’Œ <code>componentWillUnmount</code> ï¼Œä½†ä»–ä»¬æ„å¤–åœ°å‘ç° <code>useEffect</code> åœ¨æ¯æ¬¡ç»„ä»¶æ›´æ–°æ—¶éƒ½ä¼šè¢«æ‰§è¡Œã€‚å­¦å®Œå‰é¢å†…å®¹çš„ä½ ï¼Œç›¸ä¿¡å·²ç»çŸ¥é“å…¶ä¸­çš„åŸå› äº†ã€‚</p><p>åè¿‡æ¥ä¼˜å…ˆå­¦ä¹ å‡½æ•°ç»„ä»¶åŠ Hooksï¼Œå¯ä»¥è®©å¼€å‘è€…æ›´ç›´æ¥åœ°æ¥è§¦Reactå…ƒç´ ã€propsã€stateã€åè°ƒã€æ¸²æŸ“è¿™äº›æ ¸å¿ƒæ¦‚å¿µï¼Œæå‡å­¦ä¹ æ•ˆç‡å’Œæ•ˆæœã€‚</p><p>å½“ç„¶å‡¡äº‹ä¹Ÿæœ‰ä¾‹å¤–ã€‚ç¬¬8èŠ‚è¯¾æˆ‘ä»¬åœ¨ä»‹ç»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„é”™è¯¯å¤„ç†é˜¶æ®µæ—¶ï¼Œæåˆ°æˆªæ­¢åˆ°React v18.2.0ï¼Œåªæœ‰ç±»ç»„ä»¶æ‰èƒ½æˆä¸ºé”™è¯¯è¾¹ç•Œï¼Œå‡½æ•°ç»„ä»¶æ˜¯ä¸è¡Œçš„ã€‚åƒè¿™æ ·ç±»ç»„ä»¶ç‹¬æœ‰çš„å°‘æ•°åŠŸèƒ½ï¼Œæˆ‘ä»¬åœ¨ç¬¬ä¸‰æ¨¡å—é‡åˆ°æ—¶ä¼šè¯¦ç»†ä»‹ç»ã€‚</p><h2>å°ç»“</h2><p>è¿™èŠ‚è¯¾æˆ‘ä»¬å­¦ä¹ äº†ReactåŸºæœ¬Hooksä¹‹ä¸€çš„å‰¯ä½œç”¨Hook <code>useEffect</code> ï¼ŒåŒæ—¶é¡ºå¸¦å¯¹æ¯”äº†å‰¯ä½œç”¨Hookså’Œç±»ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ã€‚æ¥ç€ä»‹ç»äº†ä¸»è¦ç”¨äºæ€§èƒ½ä¼˜åŒ–çš„Hooks  <code>useMemo</code> å’Œ <code>useCallback</code> ã€‚ç„¶åä¹Ÿå¼ºè°ƒäº†æ— è®ºæ˜¯å“ªç§Hooksï¼Œéƒ½åªèƒ½åœ¨Reactå‡½æ•°ç»„ä»¶ä¸­ã€å‡½æ•°çš„æœ€é¡¶å±‚è°ƒç”¨çš„é™åˆ¶ã€‚</p><p>åœ¨è¿™èŠ‚è¯¾æœ«å°¾ï¼Œä¹Ÿè¯´æ˜äº†ä¸ºä»€ä¹ˆå¼•å¯¼ä½ ä¼˜å…ˆå­¦ä¹ å‡½æ•°ç»„ä»¶åŠ Hooksï¼Œè€Œä¸æ˜¯ä¼ ç»Ÿçš„ç±»ç»„ä»¶ã€‚</p><p>æœ€åä¹Ÿé™„ä¸Šæœ¬èŠ‚è¯¾æ‰€æ¶‰åŠçš„é¡¹ç›®æºä»£ç ï¼š<a href=\"https://gitee.com/evisong/geektime-column-oh-my-kanban/releases/tag/v0.10.0\">https://gitee.com/evisong/geektime-column-oh-my-kanban/releases/tag/v0.10.0</a></p><p>ä¸‹èŠ‚è¯¾æˆ‘ä»¬å°†å­¦ä¹ äº¤äº’æ€§æ›´å¼ºçš„å†…å®¹ï¼Œå³Reactçš„äº‹ä»¶å¤„ç†ã€‚</p><h2>æ€è€ƒé¢˜</h2><ol>\n<li>è¿™èŠ‚è¯¾æˆ‘ä»¬å­¦ä¹ äº† <code>useState</code> å’Œ <code>useEffect</code> ï¼Œåœ¨è®²è§£ <code>useEffect</code> æ—¶ä¸¾äº†çº§è”èœå•çš„ä¾‹å­ï¼Œä¸è¿‡è¿™ä¸ªä¾‹å­é™äºç¯‡å¹…æ²¡æœ‰å†™å®Œï¼Œæˆ‘æƒ³è¯·ä½ è¡¥å…¨å®ƒã€‚</li>\n</ol><p>éœ€æ±‚å¾ˆå…¸å‹ï¼šç¬¬ä¸€çº§æ˜¯çœä»½çš„ä¸‹æ‹‰åˆ—è¡¨ï¼Œç¬¬äºŒçº§æ˜¯åŸå¸‚çš„ä¸‹æ‹‰åˆ—è¡¨ï¼Œå½“é€‰ä¸­ä¸€ä¸ªçœä»½æ—¶åŸå¸‚çš„åˆ—è¡¨ä¼šç›¸åº”æ”¹å˜ã€‚è™½ç„¶æˆ‘ä»¬ä¸‹èŠ‚è¯¾æ‰ä¼šç³»ç»Ÿå­¦ä¹  <code>onChange</code> è¿™æ ·çš„äº‹ä»¶å¤„ç†ï¼Œä½†å‚è€ƒ <code>oh-my-kanban</code> é‡Œçš„æ ·ä¾‹ä»£ç ï¼Œæˆ‘ç›¸ä¿¡ä½ å¾ˆå¿«å°±èƒ½å†™å‡ºæ¥ã€‚</p><ol start=\"2\">\n<li>æˆ‘ä»¬åœ¨ç¬¬8èŠ‚è¯¾å’Œè¿™èŠ‚è¯¾éƒ½æåˆ°äº†å†…å­˜æ³„æ¼ï¼Œä½ èƒ½åˆ—ä¸¾å‡ºä¸€äº›å‰ç«¯é¢†åŸŸä¼šå¯¼è‡´å†…å­˜æ³„æ¼çš„ä¾‹å­å—ï¼Ÿ</li>\n</ol><p>æ¬¢è¿æŠŠä½ çš„æ€è€ƒå’Œæƒ³æ³•åˆ†äº«åœ¨ç•™è¨€åŒºï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","comments":[{"had_liked":false,"id":357735,"user_name":"ğŸ‘","can_delete":false,"product_type":"c1","uid":2189689,"ip_address":"åŒ—äº¬","ucode":"DE34B3B14287D1","user_header":"https://static001.geekbang.org/account/avatar/00/21/69/79/b4132042.jpg","comment_is_top":true,"comment_ctime":1663587659,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100119601,"comment_content":"ä½ å¥½ï¼Œæˆ‘æ˜¯ã€Šç°ä»£React Webå¼€å‘å®æˆ˜ã€‹çš„ç¼–è¾‘è¾°æ´‹ï¼Œè¿™æ˜¯ğŸ‘‡é¡¹ç›®çš„æºä»£ç é“¾æ¥ï¼Œä¾›ä½ å­¦ä¹ ä¸å‚è€ƒï¼šhttps:&#47;&#47;gitee.com&#47;evisong&#47;geektime-column-oh-my-kanban&#47;releases&#47;tag&#47;v0.10.0","like_count":0,"discussions":[{"author":{"id":1109402,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ed/9a/bbeec5bb.jpg","nickname":"liu","note":"","ucode":"041F179BB00A59","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590493,"discussion_content":"å»ºè®®ä»giteeæ‹‰ä¸€ä¸‹åˆ†æ”¯ä»£ç \nhttps://gitee.com/evisong/geektime-column-oh-my-kanban/releases/tag/v0.10.0ã€‚\nçœ‹ä¸‹æ•ˆæœ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665820562,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":357935,"user_name":"èˆ¹é•¿","can_delete":false,"product_type":"c1","uid":3170712,"ip_address":"åŒ—äº¬","ucode":"EBC0CCDB341E35","user_header":"https://static001.geekbang.org/account/avatar/00/30/61/98/0d6b499d.jpg","comment_is_top":false,"comment_ctime":1663755785,"is_pvip":false,"replies":[{"id":130407,"content":"ä½ å¥½ï¼Œèˆ¹é•¿ï¼Œä»å®ç°åŠŸèƒ½æ¥è®²ä½ ç”¨useState+useEffectä»£æ›¿useMemoæ˜¯å¯è¡Œçš„ã€‚æ­£å¦‚ä½ è¯´çš„ï¼Œç¡®å®å¤šäº†ä¸€æ¬¡æ¸²æŸ“ã€‚å…·ä½“æ¥è¯´ï¼ŒuseMemoçš„å›è°ƒæ˜¯åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­æ‰§è¡Œï¼Œè€ŒuseEffectçš„å›è°ƒä¼šåœ¨æäº¤é˜¶æ®µæ‰§è¡Œï¼ŒuseEffectå›è°ƒå†…éƒ¨è°ƒç”¨äº†useStateçš„è¯ï¼Œä¼šè§¦å‘ä¸€æ¬¡æ–°çš„æ¸²æŸ“ã€‚ä»ç”¨æˆ·æ„ŸçŸ¥ä¸Šåº”è¯¥æ²¡å¤ªå¤§å·®åˆ«ï¼Œæ¯•ç«Ÿæ¸²æŸ“è¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼ŒuseEffectçš„å›è°ƒä¹Ÿæ˜¯å¼‚æ­¥çš„ã€‚\n\nåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°è¿ç»­åœ¨ä¸€ä¸ªç»„ä»¶ä¸­å†™åæ¥ä¸ªHooksçš„æƒ…å†µï¼Œæ¯å½“å­˜åœ¨è¿™ç§è·¨å¤šæ¬¡æ¸²æŸ“è¿˜ç›¸å…³çš„Hooksï¼Œéƒ½ä¼šå¤šå°‘å¢åŠ ä¸€äº›è°ƒè¯•çš„éš¾åº¦ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1033973,"ctime":1664214989,"ip_address":"åŒ—äº¬","comment_id":357935,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100119601,"comment_content":"ä¸æ˜¯å¾ˆç†è§£ useMemo é‚£ä¸ªä¾‹å­ï¼Œæ¯”å¦‚ç”¨ ä¸‹é¢è¿™ä¸ªuseEffect  å†™æ³•ä¸æ˜¯ä¹Ÿå¯ä»¥æŒä¹…åŒ–è®°å¿†æ•°æ®å—ï¼Ÿå¥½åƒåªæ˜¯æ¯” useMemo é‚£ç§å†™æ³•å¤šäº†ä¸ª setXXX æ‰€é€ æˆçš„ä¸€æ¬¡æ¸²æŸ“ï¼Ÿ\nconst [num, setNum] = useState(&quot;0&quot;);\n  const [num2, setNum2] = useState(&quot;0&quot;);\n  useEffect(() =&gt; {\n    const n = parseInt(num, 10);\n    setNum2(fibonacci(n));\n  }, [num]);","like_count":2,"discussions":[{"author":{"id":1033973,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c6/f5/dae613e0.jpg","nickname":"å®‹ä¸€ç®","note":"","ucode":"55E5B710556C1E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588924,"discussion_content":"ä½ å¥½ï¼Œèˆ¹é•¿ï¼Œä»å®ç°åŠŸèƒ½æ¥è®²ä½ ç”¨useState+useEffectä»£æ›¿useMemoæ˜¯å¯è¡Œçš„ã€‚æ­£å¦‚ä½ è¯´çš„ï¼Œç¡®å®å¤šäº†ä¸€æ¬¡æ¸²æŸ“ã€‚å…·ä½“æ¥è¯´ï¼ŒuseMemoçš„å›è°ƒæ˜¯åœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­æ‰§è¡Œï¼Œè€ŒuseEffectçš„å›è°ƒä¼šåœ¨æäº¤é˜¶æ®µæ‰§è¡Œï¼ŒuseEffectå›è°ƒå†…éƒ¨è°ƒç”¨äº†useStateçš„è¯ï¼Œä¼šè§¦å‘ä¸€æ¬¡æ–°çš„æ¸²æŸ“ã€‚ä»ç”¨æˆ·æ„ŸçŸ¥ä¸Šåº”è¯¥æ²¡å¤ªå¤§å·®åˆ«ï¼Œæ¯•ç«Ÿæ¸²æŸ“è¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼ŒuseEffectçš„å›è°ƒä¹Ÿæ˜¯å¼‚æ­¥çš„ã€‚\n\nåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°è¿ç»­åœ¨ä¸€ä¸ªç»„ä»¶ä¸­å†™åæ¥ä¸ªHooksçš„æƒ…å†µï¼Œæ¯å½“å­˜åœ¨è¿™ç§è·¨å¤šæ¬¡æ¸²æŸ“è¿˜ç›¸å…³çš„Hooksï¼Œéƒ½ä¼šå¤šå°‘å¢åŠ ä¸€äº›è°ƒè¯•çš„éš¾åº¦ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1664214989,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1438740,"avatar":"https://static001.geekbang.org/account/avatar/00/15/f4/14/4599c47e.jpg","nickname":"Jiaæ·»ï¼","note":"","ucode":"25E6BD81287EB9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600534,"discussion_content":"æ˜¯ä¸æ˜¯å¯ä»¥ç±»æ¯”vueä¸­computedå’Œwatchçš„åŒºåˆ«ï¼Œå¹¶ä¸”reactå¤šäº†fibernodeçš„å¼‚æ­¥æ›´æ–°æ¦‚å¿µï¼Œæ‰€ä»¥ä¼šæœ‰æ¸²æŸ“è§¦å‘æ¬¡æ•°çš„ä¸åŒã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1674478211,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":357248,"user_name":"å­¦ä¹ å‰ç«¯-react","can_delete":false,"product_type":"c1","uid":1331001,"ip_address":"åŒ—äº¬","ucode":"6C873AF98F3498","user_header":"https://static001.geekbang.org/account/avatar/00/14/4f/39/791d0f5e.jpg","comment_is_top":false,"comment_ctime":1663117834,"is_pvip":false,"replies":[{"id":130384,"content":"ä½ å¥½ï¼Œå­¦ä¹ å‰ç«¯-reactï¼ŒæŠ±æ­‰è¿™å‡ å¤©åœ¨èµ¶ç¨¿å›å¤æ™šäº†ã€‚\n\nä½ è¯´å¾—å¯¹ã€‚useEffectçš„å‰¯ä½œç”¨å›è°ƒå’Œæ¸…é™¤å‡½æ•°ï¼Œå®ƒä»¬éƒ½åœ¨æäº¤é˜¶æ®µæ‰§è¡Œï¼Œä¸”å¤§å¤šæƒ…å†µéƒ½æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚è¿™äº›å‡½æ•°è¢«åŠ å…¥callbackæ›´æ–°é˜Ÿåˆ—ã€‚åœ¨çœŸå®DOMç»˜åˆ¶ä¹‹åï¼Œä¸‹ä¸€æ¬¡Reactæ¸²æŸ“ä¹‹å‰ï¼Œè¿™ä¸ªé˜Ÿåˆ—é‡Œçš„callbackä¼šä¾æ¬¡æ‰§è¡Œï¼Œæ‰€ä»¥è¿™æ—¶å€™callbackèƒ½æ‹¿åˆ°çœŸå®DOMã€‚\n\nè¿™å¼ å›¾åœ¨ç¬¬ä¸€æ¬¡ç”»æ—¶ï¼Œåªç”»äº†åŒæ­¥æ‰§è¡Œçš„æƒ…å†µï¼Œç»™å¤§å®¶é€ æˆäº†è¯¯è§£ï¼Œè¿˜è¯·è§è°…ã€‚ç›®å‰å›¾ç‰‡å·²ç»åšäº†æ›´æ–°ï¼Œä¾ç„¶çœç•¥äº†ä¸€äº›å®ç°ç»†èŠ‚ï¼Œä½†æ›´è´´è¿‘å®é™…æƒ…å†µäº†ï¼Œè¯·ä»¥è¿™ä¸€ç‰ˆä¸ºå‡†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1033973,"ctime":1664188137,"ip_address":"åŒ—äº¬","comment_id":357248,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100119601,"comment_content":"è¯·é—®ï¼šuse Effect çš„æ‰§è¡Œæ˜¯å¯ä»¥æ‹¿åˆ°çœŸå®domçš„ï¼Œé‚£ä¸ºå•¥åœ¨å›¾ä¸­æäº¤é˜¶æ®µå´æ˜¯åœ¨çœŸå®domä¹‹å‰ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1033973,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c6/f5/dae613e0.jpg","nickname":"å®‹ä¸€ç®","note":"","ucode":"55E5B710556C1E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588872,"discussion_content":"ä½ å¥½ï¼Œå­¦ä¹ å‰ç«¯-reactï¼ŒæŠ±æ­‰è¿™å‡ å¤©åœ¨èµ¶ç¨¿å›å¤æ™šäº†ã€‚\n\nä½ è¯´å¾—å¯¹ã€‚useEffectçš„å‰¯ä½œç”¨å›è°ƒå’Œæ¸…é™¤å‡½æ•°ï¼Œå®ƒä»¬éƒ½åœ¨æäº¤é˜¶æ®µæ‰§è¡Œï¼Œä¸”å¤§å¤šæƒ…å†µéƒ½æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚è¿™äº›å‡½æ•°è¢«åŠ å…¥callbackæ›´æ–°é˜Ÿåˆ—ã€‚åœ¨çœŸå®DOMç»˜åˆ¶ä¹‹åï¼Œä¸‹ä¸€æ¬¡Reactæ¸²æŸ“ä¹‹å‰ï¼Œè¿™ä¸ªé˜Ÿåˆ—é‡Œçš„callbackä¼šä¾æ¬¡æ‰§è¡Œï¼Œæ‰€ä»¥è¿™æ—¶å€™callbackèƒ½æ‹¿åˆ°çœŸå®DOMã€‚\n\nè¿™å¼ å›¾åœ¨ç¬¬ä¸€æ¬¡ç”»æ—¶ï¼Œåªç”»äº†åŒæ­¥æ‰§è¡Œçš„æƒ…å†µï¼Œç»™å¤§å®¶é€ æˆäº†è¯¯è§£ï¼Œè¿˜è¯·è§è°…ã€‚ç›®å‰å›¾ç‰‡å·²ç»åšäº†æ›´æ–°ï¼Œä¾ç„¶çœç•¥äº†ä¸€äº›å®ç°ç»†èŠ‚ï¼Œä½†æ›´è´´è¿‘å®é™…æƒ…å†µäº†ï¼Œè¯·ä»¥è¿™ä¸€ç‰ˆä¸ºå‡†ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1664188137,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2543092,"avatar":"https://static001.geekbang.org/account/avatar/00/26/cd/f4/4ccc2249.jpg","nickname":"ç¨‹åºå‘˜çš„æ…µæ‡’ç”Ÿæ´»","note":"","ucode":"ACCC53F3B6BBFE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587798,"discussion_content":"åŒç–‘æƒ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663297647,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1033973,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c6/f5/dae613e0.jpg","nickname":"å®‹ä¸€ç®","note":"","ucode":"55E5B710556C1E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":2543092,"avatar":"https://static001.geekbang.org/account/avatar/00/26/cd/f4/4ccc2249.jpg","nickname":"ç¨‹åºå‘˜çš„æ…µæ‡’ç”Ÿæ´»","note":"","ucode":"ACCC53F3B6BBFE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588873,"discussion_content":"ä½ å¥½ï¼Œç¨‹åºå‘˜çš„æ…µæ‡’ç”Ÿæ´»ï¼Œè¯·å‚è§æˆ‘ä¸Šé¢çš„å›å¤ã€‚\n\n&gt; useEffectçš„å‰¯ä½œç”¨å›è°ƒå’Œæ¸…é™¤å‡½æ•°ï¼Œå®ƒä»¬éƒ½åœ¨æäº¤é˜¶æ®µæ‰§è¡Œï¼Œä¸”å¤§å¤šæƒ…å†µéƒ½æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚è¿™äº›å‡½æ•°è¢«åŠ å…¥callbackæ›´æ–°é˜Ÿåˆ—ã€‚åœ¨çœŸå®DOMç»˜åˆ¶ä¹‹åï¼Œä¸‹ä¸€æ¬¡Reactæ¸²æŸ“ä¹‹å‰ï¼Œè¿™ä¸ªé˜Ÿåˆ—é‡Œçš„callbackä¼šä¾æ¬¡æ‰§è¡Œï¼Œæ‰€ä»¥è¿™æ—¶å€™callbackèƒ½æ‹¿åˆ°çœŸå®DOMã€‚\n\nç»™ä½ é€ æˆäº†è¯¯è§£è¿˜è¯·è§è°…ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1664188294,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":587798,"ip_address":"åŒ—äº¬","group_id":0},"score":588873,"extra":""}]}]},{"had_liked":false,"id":357363,"user_name":"éƒ½å¸‚å¤œå½’äºº","can_delete":false,"product_type":"c1","uid":1071909,"ip_address":"åŒ—äº¬","ucode":"DFF59BE3D80B42","user_header":"https://static001.geekbang.org/account/avatar/00/10/5b/25/d78cc1fe.jpg","comment_is_top":false,"comment_ctime":1663204899,"is_pvip":false,"replies":[{"id":130291,"content":"ä½ å¥½ï¼Œéƒ½å¸‚å¤œå½’äººï¼ŒæŠ±æ­‰è¿™ä¸¤å‘¨åœ¨èµ¶ç¨¿å›å¤æ™šäº†ã€‚è¿™é‡Œè¯´çš„æ˜¯useEffectçš„ä¸¤ä¸ªå‚æ•°ã€‚\n\n  const KanbanCard = ({ title, status }) =&gt; {\n    const [displayTime, setDisplayTime] = useState(status);\n\nè¿™æ®µä»£ç åªæ˜¯ä¸ºäº†æç¤ºä¸€ä¸‹useEffectæ‰€åœ¨çš„ç›¸å¯¹ä½ç½®ã€‚\n\nä¸‹é¢çš„ï¼š\n\n  useEffect(() =&gt; {\n    &#47;&#47; ...\n    return function cleanup() {\n      &#47;&#47; ...\n    };\n  }, [status]);\n\nä¸­çš„ï¼š\n\n  () =&gt; {\n    &#47;&#47; ...\n    return function cleanup() {\n      &#47;&#47; ...\n    };\n  }\n\nå°±æ˜¯useEffectç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç§°ä½œå‰¯ä½œç”¨å›è°ƒå‡½æ•°ï¼ˆEffect Callbackï¼‰ï¼›\n\nè€Œåé¢çš„ï¼š\n\n  [status]\n\nå°±æ˜¯ç¬¬äºŒä¸ªå‚æ•°ï¼Œç§°ä½œä¾èµ–å€¼æ•°ç»„ï¼ˆDependenciesï¼‰ã€‚\n","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1033973,"ctime":1663818831,"ip_address":"åŒ—äº¬","comment_id":357363,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100119601,"comment_content":"\nconst KanbanCard = ({ title, status }) =&gt; {\n  const [displayTime, setDisplayTime] = useState(status);\n  useEffect(() =&gt; {\n    const updateDisplayTime = () =&gt; {\n      const timePassed = new Date() - new Date(status);\n      let relativeTime = &#39;åˆšåˆš&#39;;\n      &#47;&#47; ...çœç•¥\n      setDisplayTime(relativeTime);\n    };\n    const intervalId = setInterval(updateDisplayTime, UPDATE_INTERVAL);\n    updateDisplayTime();\n\n    return function cleanup() {\n      clearInterval(intervalId);\n    };\n  }, [status]);\nå¯ä»¥çœ‹åˆ°ï¼ŒuseEffect æ¥æ”¶äº†å‰¯ä½œç”¨å›è°ƒå‡½æ•°å’Œä¾èµ–å€¼æ•°ç»„ä¸¤ä¸ªå‚æ•°ï¼Œå…¶ä¸­å‰¯ä½œç”¨å›è°ƒå‡½æ•°çš„è¿”å›å€¼ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªè¿”å›çš„å‡½æ•°å«åšæ¸…é™¤å‡½æ•°ã€‚ç»„ä»¶åœ¨ä¸‹ä¸€æ¬¡æäº¤é˜¶æ®µæ‰§è¡ŒåŒä¸€ä¸ªå‰¯ä½œç”¨å›è°ƒå‡½æ•°ä¹‹å‰ï¼Œæˆ–è€…æ˜¯ç»„ä»¶å³å°†è¢«å¸è½½ä¹‹å‰ï¼Œä¼šè°ƒç”¨è¿™ä¸ªæ¸…é™¤å‡½æ•°ã€‚\n\næ²¡æœ‰çœ‹æ‡‚ï¼Œä¸Šé¢çš„å“ªæœ‰ä¸¤ä¸ªå‚æ•°å•Šï¼Ÿ\n","like_count":1,"discussions":[{"author":{"id":1033973,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c6/f5/dae613e0.jpg","nickname":"å®‹ä¸€ç®","note":"","ucode":"55E5B710556C1E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588532,"discussion_content":"ä½ å¥½ï¼Œéƒ½å¸‚å¤œå½’äººï¼ŒæŠ±æ­‰è¿™ä¸¤å‘¨åœ¨èµ¶ç¨¿å›å¤æ™šäº†ã€‚è¿™é‡Œè¯´çš„æ˜¯useEffectçš„ä¸¤ä¸ªå‚æ•°ã€‚\n\n  const KanbanCard = ({ title, status }) =&gt; {\n    const [displayTime, setDisplayTime] = useState(status);\n\nè¿™æ®µä»£ç åªæ˜¯ä¸ºäº†æç¤ºä¸€ä¸‹useEffectæ‰€åœ¨çš„ç›¸å¯¹ä½ç½®ã€‚\n\nä¸‹é¢çš„ï¼š\n\n  useEffect(() =&gt; {\n    // ...\n    return function cleanup() {\n      // ...\n    };\n  }, [status]);\n\nä¸­çš„ï¼š\n\n  () =&gt; {\n    // ...\n    return function cleanup() {\n      // ...\n    };\n  }\n\nå°±æ˜¯useEffectç¬¬ä¸€ä¸ªå‚æ•°ï¼Œç§°ä½œå‰¯ä½œç”¨å›è°ƒå‡½æ•°ï¼ˆEffect Callbackï¼‰ï¼›\n\nè€Œåé¢çš„ï¼š\n\n  [status]\n\nå°±æ˜¯ç¬¬äºŒä¸ªå‚æ•°ï¼Œç§°ä½œä¾èµ–å€¼æ•°ç»„ï¼ˆDependenciesï¼‰ã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663818831,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1033973,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c6/f5/dae613e0.jpg","nickname":"å®‹ä¸€ç®","note":"","ucode":"55E5B710556C1E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588533,"discussion_content":"æ„Ÿè°¢ å­¦ä¹ å‰ç«¯-react å’Œ DullSword ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663818884,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1331001,"avatar":"https://static001.geekbang.org/account/avatar/00/14/4f/39/791d0f5e.jpg","nickname":"å­¦ä¹ å‰ç«¯-react","note":"","ucode":"6C873AF98F3498","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587950,"discussion_content":"ä¸¤ä¸ªå‚æ•°ï¼š ä¸€ä¸ªæ˜¯åŒ¿åçš„ç®­å¤´å‡½æ•°ï¼Œå¦ä¸€ä¸ªæ˜¯ [status]","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663400774,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1351108,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/c4/13376c14.jpg","nickname":"DullSword","note":"","ucode":"9560FED4161FEB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587753,"discussion_content":"æ˜¯useEffectæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œå‰ä¸¤è¡Œä¸æ˜¯ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663251581,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ç¦å»º","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":357501,"user_name":"æ»¡çœ¼æ˜ŸğŸŒŸ è¾°ğŸŠ","can_delete":false,"product_type":"c1","uid":2628364,"ip_address":"åŒ—äº¬","ucode":"65E2FBE8523545","user_header":"https://static001.geekbang.org/account/avatar/00/28/1b/0c/e236e8c2.jpg","comment_is_top":false,"comment_ctime":1663317370,"is_pvip":false,"replies":[{"id":130385,"content":"ä½ å¥½ï¼Œæ»¡çœ¼æ˜Ÿè¾°ï¼ŒæŠ±æ­‰è¿™å‡ å¤©åœ¨èµ¶ç¨¿å›å¤æ™šäº†ã€‚\n\nä½ è¯´å¾—å¯¹ã€‚useEffectè®°å½•çš„å‰¯ä½œç”¨å›è°ƒå’Œæ¸…é™¤å‡½æ•°ï¼Œéƒ½åœ¨æäº¤é˜¶æ®µæ‰§è¡Œï¼Œä¸”å¤§å¤šæƒ…å†µéƒ½æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚è¿™äº›å‡½æ•°è¢«åŠ å…¥callbackæ›´æ–°é˜Ÿåˆ—ã€‚åœ¨çœŸå®DOMç»˜åˆ¶ä¹‹åï¼Œä¸‹ä¸€æ¬¡Reactæ¸²æŸ“ä¹‹å‰ï¼Œé˜Ÿåˆ—é‡Œçš„callbackä¼šä¾æ¬¡æ‰§è¡Œã€‚\n\nåœ¨ç¬¬ä¸€æ¬¡ç”»å›¾ä¾‹æ—¶ï¼Œåªç”»äº†åŒæ­¥æ‰§è¡Œçš„æƒ…å†µï¼Œç»™ä½ é€ æˆäº†è¯¯è§£ï¼Œè¿˜è¯·è§è°…ã€‚ç›®å‰å›¾ç‰‡å·²ç»åšäº†æ›´æ–°ï¼Œä¾ç„¶çœç•¥äº†ä¸€äº›å®ç°ç»†èŠ‚ï¼Œä½†æ›´è´´è¿‘å®é™…æƒ…å†µäº†ï¼Œè¯·ä»¥è¿™ä¸€ç‰ˆä¸ºå‡†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1033973,"ctime":1664188494,"ip_address":"åŒ—äº¬","comment_id":357501,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100119601,"comment_content":"å›¾ä¾‹ä¸­ï¼ŒuseLayoutEffectæ˜¯åŒæ­¥æ›´æ–°domï¼Œåº”è¯¥åœ¨useEffectä¹‹å‰æ‰§è¡Œï¼Œä¸æ˜¯å—","like_count":0,"discussions":[{"author":{"id":1033973,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c6/f5/dae613e0.jpg","nickname":"å®‹ä¸€ç®","note":"","ucode":"55E5B710556C1E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588874,"discussion_content":"ä½ å¥½ï¼Œæ»¡çœ¼æ˜Ÿè¾°ï¼ŒæŠ±æ­‰è¿™å‡ å¤©åœ¨èµ¶ç¨¿å›å¤æ™šäº†ã€‚\n\nä½ è¯´å¾—å¯¹ã€‚useEffectè®°å½•çš„å‰¯ä½œç”¨å›è°ƒå’Œæ¸…é™¤å‡½æ•°ï¼Œéƒ½åœ¨æäº¤é˜¶æ®µæ‰§è¡Œï¼Œä¸”å¤§å¤šæƒ…å†µéƒ½æ˜¯å¼‚æ­¥æ‰§è¡Œçš„ã€‚è¿™äº›å‡½æ•°è¢«åŠ å…¥callbackæ›´æ–°é˜Ÿåˆ—ã€‚åœ¨çœŸå®DOMç»˜åˆ¶ä¹‹åï¼Œä¸‹ä¸€æ¬¡Reactæ¸²æŸ“ä¹‹å‰ï¼Œé˜Ÿåˆ—é‡Œçš„callbackä¼šä¾æ¬¡æ‰§è¡Œã€‚\n\nåœ¨ç¬¬ä¸€æ¬¡ç”»å›¾ä¾‹æ—¶ï¼Œåªç”»äº†åŒæ­¥æ‰§è¡Œçš„æƒ…å†µï¼Œç»™ä½ é€ æˆäº†è¯¯è§£ï¼Œè¿˜è¯·è§è°…ã€‚ç›®å‰å›¾ç‰‡å·²ç»åšäº†æ›´æ–°ï¼Œä¾ç„¶çœç•¥äº†ä¸€äº›å®ç°ç»†èŠ‚ï¼Œä½†æ›´è´´è¿‘å®é™…æƒ…å†µäº†ï¼Œè¯·ä»¥è¿™ä¸€ç‰ˆä¸ºå‡†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1664188495,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":357455,"user_name":"éƒ½å¸‚å¤œå½’äºº","can_delete":false,"product_type":"c1","uid":1071909,"ip_address":"åŒ—äº¬","ucode":"DFF59BE3D80B42","user_header":"https://static001.geekbang.org/account/avatar/00/10/5b/25/d78cc1fe.jpg","comment_is_top":false,"comment_ctime":1663287809,"is_pvip":false,"replies":[{"id":130387,"content":"ä½ å¥½ï¼Œéƒ½å¸‚å¤œå½’äººï¼Œè¿™ä¸¤å‘¨æˆ‘éƒ½åœ¨èµ¶ç¨¿ï¼ŒæŠ±æ­‰å›å¤æ™šäº†ã€‚è¿™é‡Œæ‰€æŒ‡çš„â€œå›è°ƒå‡½æ•°â€ï¼Œå¯¹äºï¼š\n    const memoized = useMemo(() =&gt; createByHeavyComputing(a, b), [a, b]);\næŒ‡çš„æ˜¯å…¶ä¸­çš„() =&gt; createByHeavyComputing(a, b)ï¼ŒåŒæ—¶ä¹Ÿå«å·¥å‚å‡½æ•°ï¼›\n\nå¯¹äº\n    const memoizedFunc = useCallback(() =&gt; {if (a) b()}, [a, b]);\næŒ‡çš„æ˜¯() =&gt; {if (a) b()}ï¼›\n\n() =&gt; createByHeavyComputing(a, b) å’Œ () =&gt; {if (a) b()} å¦‚æœç¬¦åˆæ‰§è¡Œæ¡ä»¶çš„è¯ï¼Œä¼šåœ¨æ¸²æŸ“é˜¶æ®µæ‰§è¡Œã€‚\n\nå¯¹äº\n    useEffect(() =&gt; { if (province === &#39;å±±ä¸œ&#39;) { setCities([&#39;æµå—&#39;, &#39;é’å²›&#39;, &#39;æ·„åš&#39;]); }}, [province]);\næŒ‡çš„æ˜¯ () =&gt; { if (province === &#39;å±±ä¸œ&#39;) { setCities([&#39;æµå—&#39;, &#39;é’å²›&#39;, &#39;æ·„åš&#39;]); }}\n\nå¦‚æœç¬¦åˆæ‰§è¡Œæ¡ä»¶çš„è¯ï¼Œ() =&gt; { if (province === &#39;å±±ä¸œ&#39;) { setCities([&#39;æµå—&#39;, &#39;é’å²›&#39;, &#39;æ·„åš&#39;]); }} ä¼šåœ¨æäº¤é˜¶æ®µæ‰§è¡Œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1033973,"ctime":1664189343,"ip_address":"åŒ—äº¬","comment_id":357455,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100119601,"comment_content":"å…¶å®è¿™ä¸¤ä¸ª Hooks ä¸ useEffect å¹¶ä¸æ²¾äº²å¸¦æ•…ã€‚ä¸”ä¸è¯´å®ƒä»¬çš„ç”¨é€”å®Œå…¨ä¸åŒï¼Œå•ä»å›è°ƒå‡½æ•°çš„æ‰§è¡Œé˜¶æ®µæ¥çœ‹ï¼Œå‰è€…æ˜¯åœ¨æ¸²æŸ“é˜¶æ®µæ‰§è¡Œï¼Œè€Œåè€…æ˜¯åœ¨æäº¤é˜¶æ®µã€‚\n\nè¿™å¥è¯ä¸ä¸Šé¢çš„ç”Ÿå‘½å‘¨æœŸå›¾ä¸å¤ªä¸€è‡´ï¼Œæ±‚è§£æƒ‘","like_count":0,"discussions":[{"author":{"id":1033973,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c6/f5/dae613e0.jpg","nickname":"å®‹ä¸€ç®","note":"","ucode":"55E5B710556C1E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588877,"discussion_content":"ä½ å¥½ï¼Œéƒ½å¸‚å¤œå½’äººï¼Œè¿™ä¸¤å‘¨æˆ‘éƒ½åœ¨èµ¶ç¨¿ï¼ŒæŠ±æ­‰å›å¤æ™šäº†ã€‚è¿™é‡Œæ‰€æŒ‡çš„â€œå›è°ƒå‡½æ•°â€ï¼Œå¯¹äºï¼š\n    const memoized = useMemo(() =&gt; createByHeavyComputing(a, b), [a, b]);\næŒ‡çš„æ˜¯å…¶ä¸­çš„() =&gt; createByHeavyComputing(a, b)ï¼ŒåŒæ—¶ä¹Ÿå«å·¥å‚å‡½æ•°ï¼›\n\nå¯¹äº\n    const memoizedFunc = useCallback(() =&gt; {if (a) b()}, [a, b]);\næŒ‡çš„æ˜¯() =&gt; {if (a) b()}ï¼›\n\n() =&gt; createByHeavyComputing(a, b) å’Œ () =&gt; {if (a) b()} å¦‚æœç¬¦åˆæ‰§è¡Œæ¡ä»¶çš„è¯ï¼Œä¼šåœ¨æ¸²æŸ“é˜¶æ®µæ‰§è¡Œã€‚\n\nå¯¹äº\n    useEffect(() =&gt; { if (province === &#39;å±±ä¸œ&#39;) { setCities([&#39;æµå—&#39;, &#39;é’å²›&#39;, &#39;æ·„åš&#39;]); }}, [province]);\næŒ‡çš„æ˜¯ () =&gt; { if (province === &#39;å±±ä¸œ&#39;) { setCities([&#39;æµå—&#39;, &#39;é’å²›&#39;, &#39;æ·„åš&#39;]); }}\n\nå¦‚æœç¬¦åˆæ‰§è¡Œæ¡ä»¶çš„è¯ï¼Œ() =&gt; { if (province === &#39;å±±ä¸œ&#39;) { setCities([&#39;æµå—&#39;, &#39;é’å²›&#39;, &#39;æ·„åš&#39;]); }} ä¼šåœ¨æäº¤é˜¶æ®µæ‰§è¡Œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1664189343,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2628364,"avatar":"https://static001.geekbang.org/account/avatar/00/28/1b/0c/e236e8c2.jpg","nickname":"æ»¡çœ¼æ˜ŸğŸŒŸ è¾°ğŸŠ","note":"","ucode":"65E2FBE8523545","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587840,"discussion_content":"å‰è€…useMemoã€useCallbackåœ¨æ¸²æŸ“é˜¶æ®µæ‰§è¡Œï¼Œåè€…useEffectåœ¨æäº¤é˜¶æ®µæ‰§è¡Œï¼Œå¥½åƒæ²¡å•¥é—®é¢˜","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1663317169,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å®å¤","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":362413,"user_name":"Imart","can_delete":false,"product_type":"c1","uid":1499790,"ip_address":"å¹¿ä¸œ","ucode":"373C0803485335","user_header":"https://static001.geekbang.org/account/avatar/00/16/e2/8e/b4ccfa02.jpg","comment_is_top":false,"comment_ctime":1668497328,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100119601,"comment_content":"useEffect æ˜¯åœ¨æµè§ˆå™¨æ¸²æŸ“&#47;å‘ˆç°domå†…å®¹åæ‰§è¡Œçš„ï¼›\nuseLayoutEffect æ˜¯åœ¨çœŸå®domæ›´æ–°åï¼Œæµè§ˆå™¨æ¸²æŸ“domå†…å®¹å‰æ‰§è¡Œçš„ï¼Œå³åœ¨renderå‡½æ•°æ‰§è¡Œåï¼Œæ¥ç€åŒæ­¥é©¬ä¸Šæ‰§è¡Œå›è°ƒå‡½æ•°å†…å®¹ï¼›","like_count":2},{"had_liked":false,"id":377750,"user_name":"Geek_9y01z7","can_delete":false,"product_type":"c1","uid":1335223,"ip_address":"æ±Ÿè‹","ucode":"41A4D7D369B3AB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eor68N3pg8Joqw3XH1EkFjmLVK5fkKokj1025XjR4va1CW8CdsKSytbw3f4WPjIbiazEbACOibNDnnA/132","comment_is_top":false,"comment_ctime":1689147550,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100119601,"comment_content":"æˆ‘è¯•å›¾åœ¨ handleSubmit é‡Œè°ƒç”¨ handleSaveAll()ï¼Œå¸Œæœ›æ¯æ¬¡æ–°å¢â€œå¾…å¤„ç†â€ åè‡ªåŠ¨ä¿å­˜ï¼Œä½†å¤±è´¥äº†ã€‚è°ƒç”¨ handleSaveAll çš„æ—¶å€™ todoList è¿˜æ²¡æœ‰è¢«æ›´æ–°ï¼Œç¬¬äºŒæ¬¡æ–°å¢åæ‰ä¼šæŠŠç¬¬ä¸€æ¬¡æ–°å¢çš„ä¿å­˜è¿›å»ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ ï¼Ÿ\n\nconst handleSubmit = (title) =&gt; {\n    const d = new Date()\n    const n = d.toLocaleDateString().replace(&#39;&#47;&#39;, &#39;-&#39;) + &#39; &#39; + d.toLocaleTimeString();\n    setTodoList(currentTodoList =&gt; [\n      { title, dt: n},\n      ...currentTodoList\n    ]);\n    \n    handleSaveAll()\n  };","like_count":0},{"had_liked":false,"id":361437,"user_name":"Geeker","can_delete":false,"product_type":"c1","uid":1032345,"ip_address":"æµ™æ±Ÿ","ucode":"9937127DE96D78","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c0/99/259a412f.jpg","comment_is_top":false,"comment_ctime":1667493285,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100119601,"comment_content":"ä¸ªäººè§‰å¾—æ¡†æ¶ä¸åº”è¯¥æŠŠâ€œè´Ÿæ‹…â€ ç”©ç»™ç”¨æˆ·","like_count":0,"discussions":[{"author":{"id":1669795,"avatar":"https://static001.geekbang.org/account/avatar/00/19/7a/a3/91dd50e8.jpg","nickname":"O","note":"","ucode":"2CC99CC96D59CC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":653871,"discussion_content":"ç”¨vueä¼šç®€åŒ–å¾ˆå¤š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1731490197,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"é‡åº†","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}