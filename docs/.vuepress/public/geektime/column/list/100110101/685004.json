{"id":685004,"title":"36ï½œå‡æ–°ä¸å‡æ—§ï¼šè‡ªå®šä¹‰ç»„ä»¶å¦‚ä½•å‡çº§åˆ°æ–°æ¶æ„ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯è’‹å®ä¼Ÿã€‚</p><p>æœ‰åŒå­¦åå°ç•™è¨€è¯´ï¼šâ€œæˆ‘æŠŠå…¬å¸åº”ç”¨å‡çº§åˆ°äº† 0.71.8 ç‰ˆæœ¬ï¼Œå¼€å¯æ–°æ¶æ„åï¼Œä¸€äº›ç»„ä»¶éƒ½ä¹±äº†ï¼ŒæŠ˜è…¾äº†ä¸‰å¤©æœ€ç»ˆæ— å¥ˆé€€å›åˆ°è€æ¶æ„äº†ã€‚â€</p><p>è¿™ä¸ªé—®é¢˜è¿˜æŒºå…¸å‹çš„ï¼Œä»Šå¤©æˆ‘ä»¬å°±æ¥èŠèŠåˆ°åº•åº”è¯¥æ€ä¹ˆå‡çº§ï¼Ÿåˆ†äº«ä¸€äº›ç»éªŒã€‚</p><p>åœ¨ä¸ŠèŠ‚è¯¾ä¸­ï¼Œæˆ‘æŠŠæˆ‘ä»¬çš„æ•™å­¦é¡¹ç›® React-Native-Classroom é¡¹ç›®ï¼Œä» 0.68 å‡çº§åˆ°äº† 0.72 çš„æ–°æ¶æ„ï¼Œè¿ç§»è¿‡ç¨‹ååˆ†é¡ºåˆ©ã€‚è¿™æ˜¯å› ä¸º React-Native-Classroom é¡¹ç›®æ²¡æœ‰ä½¿ç”¨è‡ªå®šä¹‰æ¨¡å—æˆ–ç»„ä»¶ï¼Œå®ƒä½¿ç”¨çš„éƒ½æ˜¯å®˜æ–¹çš„æˆ–æˆç†Ÿçš„ç¤¾åŒºæ–¹æ¡ˆï¼Œè¿™äº›æ–¹æ¡ˆéƒ½å¯¹æ–°è€æ¶æ„è¿›è¡Œäº†å…¼å®¹ã€‚æ‰€ä»¥ï¼Œæ— éœ€é¢å¤–çš„ Native ä»£ç å‡çº§å·¥ä½œã€‚</p><p>ä½†æ˜¯ï¼Œæ–°æ—§æ¶æ„çš„è‡ªå®šä¹‰æ¨¡å—æˆ–ç»„ä»¶ç ”å‘æ–¹å¼å®Œå…¨ä¸åŒã€‚åŸæ¥é‚£äº›è‡ªå·±ç»´æŠ¤çš„è‡ªå®šä¹‰æ¨¡å—æˆ–ç»„ä»¶ï¼Œè¦å®Œå…¨å‡çº§æˆ Turbo Modules å’Œ Fabric Components æ˜¯éœ€è¦å¤§é‡çš„æ”¹é€ å·¥ä½œçš„ã€‚</p><p>å¯¹äºä¸šåŠ¡è€Œè¨€ï¼Œç ”å‘æ•ˆç‡æ˜¯ç¬¬ä¸€ä½çš„ã€‚é‚£å¦‚ä½•å‡çº§æ–°æ¶æ„ï¼Œæ‰èƒ½é™ä½å‡çº§æˆæœ¬å‘¢ï¼Ÿ</p><p>å…ˆè¯´ç»“è®ºï¼š<strong>å‡çº§æ–°æ¶æ„æ—¶ä¸åŠ¨æ—§çš„ä¸šåŠ¡ä»£ç ï¼Œæ˜¯ä¸€ä¸ªå¥½ç­–ç•¥ã€‚</strong></p><h2><strong>è€ä»£ç æ˜¯å¦å…¼å®¹ï¼Ÿ</strong></h2><p>é‚£é¦–å…ˆï¼Œæˆ‘ä»¬å°±æ¥æµ‹è¯•ï¼Œè€ä»£ç ä¸åšä»»ä½•ä¿®æ”¹ï¼Œèƒ½å¦ç›´æ¥åœ¨æ–°æ¶æ„ä¸Šè¿è¡Œï¼Ÿ</p><p>æˆ‘å‚è€ƒäº†å®˜æ–¹æ–‡æ¡£ä¸­çš„è€æ¶æ„éƒ¨åˆ†ï¼Œåˆ†åˆ«åˆ›å»ºäº†ä¸€ä¸ªè€æ¨¡å—å’Œä¸€ä¸ªè€ç»„ä»¶ã€‚</p><p>è€æ¨¡å—æ˜¯è‡ªå®šä¹‰çš„ç®€åŒ–ç‰ˆå­˜å‚¨æ¨¡å— StorageModuleã€‚å®ƒæœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯åˆ©ç”¨é”®å€¼å¯¹çš„å½¢å¼å­˜å‚¨å­—ç¬¦ä¸²ï¼Œå¦ä¸€ä¸ªæ˜¯ä½¿ç”¨é”®å»è¯»å–å­˜å‚¨åœ¨ Native ç«¯çš„å€¼ã€‚å¦‚æœå­˜å‚¨ï¼ˆSET ITEMï¼‰å’Œè¯»å–ï¼ˆGET ITEMï¼‰æˆåŠŸï¼Œé‚£ä¹ˆå°±è¯´æ˜è¿™ç±»è€æ¨¡å—ä»£ç èƒ½åœ¨æ–°æ¶æ„ä¸­ç›´æ¥ä½¿ç”¨ã€‚</p><!-- [[[read_end]]] --><p>å…¶ JS çš„éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">import {NativeModules} from 'react-native';\n\nconst StorageTest = () =&gt; {\n\n const handleSetItem = async () =&gt; {\n   await NativeModules.StorageModule.setItem('testKey', 'Hello, World!');\n };\n\n const handleGetItem = async () =&gt; {\n   const result = await NativeModules.StorageModule.getItem('testKey');\n   console.log('Received value: ', result);\n };\n  \n return &lt;jsx.../&gt;\n};\n</code></pre><p>è€ç»„ä»¶æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰è§†å›¾ CustomViewï¼Œå®ƒåªæœ‰ç®€å•çš„è®¾ç½®èƒŒæ™¯é¢œè‰²çš„åŠŸèƒ½ã€‚å¦‚æœé¢œè‰²è®¾ç½®æˆåŠŸï¼Œé‚£ä¹ˆå°±è¯´æ˜è¿™ç±»è€ç»„ä»¶ä»£ç åœ¨æ–°æ¶æ„ä¸­èƒ½å¤Ÿç›´æ¥ä½¿ç”¨ã€‚</p><p>å…¶ JS éƒ¨åˆ†çš„ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">import {requireNativeComponent} from 'react-native';\n\nconst CustomView = requireNativeComponent('CustomView');\n\nconst App: () =&gt; JSX.Element = () =&gt; {\n return (\n   &lt;CustomView\n    style={{width: 100,height: 100 }}\n    color=\"red\"\n   /&gt;\n );\n};\nexport default App;\n</code></pre><p>è¿™äº›åŸæœ¬è¿è¡Œåœ¨è€æ¶æ„ä¸Šçš„ä»£ç ï¼Œåœ¨å¼€å¯æ–°æ¶æ„åï¼Œè¿è¡Œçš„ç»“æœæˆªå›¾å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/09/d2/09dc5e6d2aa09150a890d1b1a7e819d2.png?wh=1244x898\" alt=\"å›¾ç‰‡\"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè€çš„è‡ªå®šä¹‰æ¨¡å— StorageModule æ­£å¸¸è¿è¡Œã€‚å®ƒèƒ½å¤Ÿä» Native ä¾§æ­£ç¡®åœ°å­˜å‚¨å’Œè¯»å– â€œHello, World!â€ è¿™æ®µæ–‡å­—ã€‚</p><p>ç„¶è€Œï¼Œè€çš„è‡ªå®šä¹‰ç»„ä»¶æŠ¥é”™äº†ã€‚æŠ¥é”™å†…å®¹ä»¥æ–‡å­—å½¢å¼æ˜¾ç¤ºåœ¨ç•Œé¢ä¸Šï¼Œæç¤ºæˆ‘ CustomView è€ç»„ä»¶ä¸å…¼å®¹ Fabricï¼Œæ— æ³•åœ¨æ–°æ¶æ„ä¸­è¿è¡Œã€‚</p><p>ä»ä¸Šè¿°ç®€å•çš„æ¼”ç¤ºä¸­ï¼Œå¯ä»¥æ¨æµ‹å®˜æ–¹é»˜è®¤å¯¹è€æ¶æ„çš„è‡ªå®šä¹‰æ¨¡å—ä»£ç åšäº†å…¼å®¹ï¼Œä½†å¹¶æœªå¯¹è€æ¶æ„çš„è‡ªå®šä¹‰ç»„ä»¶ä»£ç è¿›è¡Œç›´æ¥çš„å…¼å®¹ã€‚</p><h2><strong>è€ç»„ä»¶å…¼å®¹æ–¹æ¡ˆ</strong></h2><p>ä¸ºäº†å…¼å®¹è€æ¶æ„çš„è‡ªå®šä¹‰ç»„ä»¶ï¼Œå®˜æ–¹æä¾›äº†ä¸€ç§æ‰‹åŠ¨å¼€å¯å…¼å®¹æ¨¡å¼çš„æ–¹æ¡ˆâ€”â€”<a href=\"https://github.com/reactwg/react-native-new-architecture/discussions/135\">New Renderer Interop Layer</a>ã€‚</p><p>æ˜¾ç„¶ï¼Œå¦‚æœå†å²ä»£ç ä¼—å¤šï¼Œåº•å±‚æ¶æ„å‡çº§éœ€è¦å¤§è§„æ¨¡æ”¹åŠ¨ä¸šåŠ¡ç ”å‘ä»£ç ï¼Œè¿™å¯¹ä¸šåŠ¡æ¥è¯´æ— ç–‘æ˜¯ä¸€ä¸ªå·¨å¤§çš„è´Ÿæ‹…ã€‚åœ¨ Facebook å†…éƒ¨ï¼Œè®¸å¤šä¸šåŠ¡éƒ½ä½¿ç”¨ React Nativeï¼Œå› æ­¤åŸºå»ºå’Œä¸šåŠ¡ç ”å‘å›¢é˜Ÿè‚¯å®šä¹Ÿç»è¿‡äº†å‡ è½®è®¨è®ºã€‚å…¼å®¹æ–¹æ¡ˆæ˜¾ç„¶èƒ½å¤Ÿé™ä½ä¸šåŠ¡å›¢é˜Ÿçš„å‡çº§æˆæœ¬ã€‚</p><p>æ‰€è°“çš„ New Renderer Interop Layer å°±æ˜¯é€šä¿—ç†è§£çš„ç»„ä»¶å…¼å®¹å±‚ï¼Œå®ƒèµ·æºäº Facebook å†…éƒ¨ï¼Œåœ¨å†…éƒ¨ä½¿ç”¨äº†ä¸€æ®µæ—¶é—´åï¼Œäº 0.72 ç‰ˆæœ¬è¿›è¡Œäº†å¼€æºã€‚</p><p>å¼€å¯ç»„ä»¶å…¼å®¹å±‚çš„æ–¹æ³•æœ‰ä¸‰æ­¥ã€‚</p><p>é¦–å…ˆï¼Œåœ¨æ ¹ç›®å½•åˆ›å»º react-native.config.js æ–‡ä»¶ã€‚</p><pre><code class=\"language-plain\">$ touch react-native.config.js\n</code></pre><p>ç„¶åï¼Œåˆ†åˆ«åˆ—ä¸¾ iOS å’Œ Android éœ€è¦å…¼å®¹çš„ç»„ä»¶ï¼Œå°†è¿™äº›ç»„ä»¶å¡«å†™åœ¨ <code>unstable_reactLegacyComponentNames</code> å­—æ®µä¸­ã€‚åœ¨æˆ‘çš„ä»£ç ä¸­ï¼Œæ—§æ¶æ„çš„ç»„ä»¶åå­—æ˜¯ CustomViewã€‚å› æ­¤ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">module.exports = {\n project: {\n  android: {\n   // list of components that needs to be wrapped by the interop layer\n   unstable_reactLegacyComponentNames: ['CustomView'],\n  },\n  ios: {\n   // list of components that needs to be wrapped by the interop layer\n   unstable_reactLegacyComponentNames: ['CustomView'],\n  },\n },\n};\n</code></pre><p>æœ€åä¸€æ­¥ï¼Œé‡æ–°æ„å»ºå’Œå¯åŠ¨ Appã€‚</p><pre><code class=\"language-plain\">$ yarn android\n// or\n$ yarn ios\n</code></pre><p>å®Œæˆä¸Šè¿°ä¸‰æ­¥åï¼Œåœ¨é‡æ–°å¯åŠ¨çš„ App ä¸­ï¼Œä½ å°±èƒ½çœ‹åˆ°æ—§æ¶æ„è‡ªå®šä¹‰ç»„ä»¶ CustomView èƒ½å¤Ÿæ­£å¸¸å±•ç¤º color=â€œredâ€ çš„çº¢è‰²äº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/29/9f/29e2fe1aff9114004ef4f2a7f0fa229f.png?wh=1210x888\" alt=\"å›¾ç‰‡\"></p><p>ä½†æ˜¯ï¼Œè¿™ä¸ªå…¼å®¹æ–¹æ¡ˆå¹¶ä¸å®Œç¾ã€‚</p><p>å› ä¸ºï¼Œå®˜æ–¹å¹¶ä¸æ‰“ç®— 100% æ”¯æŒæ‰€æœ‰çš„æ—§ç»„ä»¶ä»£ç ã€‚å®˜æ–¹ç»™å‡ºçš„ç†ç”±æ˜¯ï¼Œå®Œå…¨å…¼å®¹å¯èƒ½ä¼šé˜»ç¢æ–°æ¶æ„æ€§èƒ½çš„æœ€å¤§åŒ–å±•ç°ã€‚å› æ­¤ï¼Œå®˜æ–¹å¸Œæœ›ç¤¾åŒºçš„æ‰€æœ‰è€æ¶æ„çš„è‡ªå®šä¹‰ç»„ä»¶éƒ½èƒ½è¿ç§»åˆ°æ–°æ¶æ„ã€‚</p><p>å®é™…ä¸Šï¼Œç»å¤§éƒ¨åˆ†åŠŸèƒ½éƒ½èƒ½å¾—åˆ°å…¼å®¹ï¼ŒåŒ…æ‹¬ï¼š</p><ul>\n<li>Props</li>\n<li>Events</li>\n<li>Native View Commandsï¼ˆå³ä½¿ç”¨ UIManager.dispatchViewManagerï¼‰</li>\n<li>Native Methodsï¼ˆå¦‚ setNativeProps å’Œ measure* å‡½æ•°ï¼‰</li>\n<li>å‘ JS å¯¼å‡ºçš„å¸¸é‡</li>\n</ul><p>å·²çŸ¥ä¸èƒ½å…¼å®¹çš„åŒ…æ‹¬ï¼š</p><ul>\n<li>Concurrent Featuresï¼ˆå¦‚ startTransitionï¼‰</li>\n</ul><p>ä»ç°æœ‰çš„å…¼å®¹æ–¹æ¡ˆæ¥çœ‹ï¼Œç»„ä»¶ä¸­å¸¸ç”¨çš„åŠŸèƒ½å…¼å®¹å±‚éƒ½å·²ç»æ”¯æŒï¼Œè€Œ Concurrent Features åœ¨è€æ¶æ„ä¸­å°±ä¸æ”¯æŒï¼Œè¿ç§»åä»ç„¶ä¸æ”¯æŒä¹Ÿæ˜¯å¯ä»¥ç†è§£çš„ã€‚</p><p>ç”±æ­¤å¯è§ï¼Œç»å¤§éƒ¨åˆ†è€æ¶æ„çš„ç»„ä»¶ä»£ç éƒ½å¯ä»¥é€šè¿‡å…¼å®¹å±‚æ¥é€‚é…æ–°æ¶æ„ã€‚</p><h2><strong>å®Œå…¨è¿ç§»åˆ°æ–°æ¶æ„</strong></h2><p>ç„¶è€Œï¼Œå¦‚æœæˆ‘ä»¬ç»§ç»­åœ¨æ–°æ¶æ„ä¸Šè¿è¡Œè€ä»£ç ï¼Œå°±æ— æ³•äº«å—åˆ°æ–°æ¶æ„å¸¦æ¥çš„æ€§èƒ½æå‡ã€‚åœ¨<a href=\"https://time.geekbang.org/column/article/663928\">ç¬¬34è®²</a>ä¸­ï¼Œæˆ‘ä»¬å·²ç»è®¨è®ºè¿‡ï¼Œæ–°æ¶æ„çš„ç»„ä»¶æ¸²æŸ“åœ¨ Android ä¸Šå¯ä»¥æé«˜ 0%ï½8% çš„æ€§èƒ½ï¼Œåœ¨ iOS ä¸Šåˆ™å¯ä»¥æå‡ 13%ï½39% çš„æ€§èƒ½ã€‚</p><p>å› æ­¤ï¼Œå¯¹äºæœ‰æ—¶é—´å’Œèµ„æºè¿›è¡Œä»£ç è¿ç§»çš„å›¢é˜Ÿï¼Œæˆ–è€…æ­£åœ¨å¼€å‘æ–°ç»„ä»¶çš„å›¢é˜Ÿï¼Œæˆ‘ä»ç„¶<strong>å»ºè®®é‡‡ç”¨æ–°æ¶æ„çš„å¼€å‘æ–¹æ¡ˆã€‚</strong></p><p>åœ¨<a href=\"https://time.geekbang.org/column/article/519819\">ç¬¬ 22 è®²</a>ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»è¿‡æ–°æ¶æ„çš„è‡ªå®šä¹‰ç»„ä»¶ï¼Œä½†é‚£æ—¶å€™è¿˜æ²¡æœ‰ CodeGen è‡ªåŠ¨åŒ–å‡çº§å·¥å…·ï¼Œæ‰€æœ‰çš„ Turbo Modules å’Œ Fabric Component éƒ½æ˜¯æˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºçš„ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ CodeGen å·¥å…·å¸®åŠ©æˆ‘ä»¬è‡ªåŠ¨åŒ–ç”Ÿæˆå¾ˆå¤šæ¨¡æ¿ä»£ç ã€‚</p><p>åœ¨æ­¤ï¼Œæˆ‘å°†ä»¥åœ¨ Android ä¸Šå¼€å‘ CustomView ç»„ä»¶ä¸ºä¾‹ï¼Œæ¥ä»‹ç» Fabric è‡ªå®šä¹‰ç»„ä»¶çš„ç ”å‘æµç¨‹ã€‚è¿™ä¸ªè‡ªå®šä¹‰ç»„ä»¶åªæœ‰ä¸€ä¸ªåŠŸèƒ½ï¼Œé‚£å°±æ˜¯æ”¹å˜å…¶èƒŒæ™¯é¢œè‰²ã€‚æˆ‘åœ¨ <a href=\"https://github.com/jiangleo/react-native-classroom/tree/main\">GitHub</a> ä¸Šå‘å¸ƒäº†è¿™ä¸ªç»„ä»¶å®Œæ•´çš„æ–°æ¶æ„ä»£ç å’Œè€æ¶æ„ä»£ç ã€‚</p><p><strong>æ•´ä½“å¼€å‘æµç¨‹åŒ…å«ä¸‰ä¸ªæ­¥éª¤ï¼š</strong></p><ol>\n<li>å®šä¹‰ç»„ä»¶ï¼ˆJSï¼‰ï¼šä½ éœ€è¦æŠŠå¯¹ç»„ä»¶çš„è®¾è®¡æ€æƒ³ç¼–å†™æˆ TypeScript çš„ Interfaceï¼Œå¹¶å°†å…¶å®šä¹‰æˆä¸€ä¸ª npm åŒ…ï¼Œä»¥ä¾¿åç»­ä½¿ç”¨ã€‚</li>\n<li>å®ç°ç»„ä»¶ï¼ˆNativeï¼‰ï¼šåˆ©ç”¨ CodeGen è‡ªåŠ¨åŒ–å·¥å…·ï¼Œå°† TypeScript çš„ Interface ç”Ÿæˆä¸º Native çš„ Interfaceï¼Œå¹¶é€šè¿‡ä¸€äº›æ¨¡æ¿ä»£ç å°† JS å’Œ Native è¿æ¥èµ·æ¥ã€‚</li>\n<li>ä½¿ç”¨ç»„ä»¶ï¼ˆJSï¼‰ï¼šåœ¨ JS ä¸­ä½¿ç”¨ç”± Native å®ç°çš„ä»£ç ã€‚</li>\n</ol><p>åœ¨å¼€å§‹å¼€å‘ä¹‹å‰ï¼Œä½ éœ€è¦åˆ›å»ºä¸€ä¸ªç”¨äºå¼€å‘ CustomView çš„æ–‡ä»¶å¤¹ã€‚</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘ç›´æ¥åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºäº†ä¸€ä¸ªåä¸º RTNCustomView çš„æ–‡ä»¶å¤¹ã€‚æ–‡ä»¶å¤¹çš„åç§°ä»¥ RTN å¼€å¤´æ˜¯ä¸ºäº†æé«˜å…¶è¾¨è¯†åº¦ï¼Œå› ä¸º RTN æ˜¯ React Native çš„ç¼©å†™ã€‚</p><p>è¿™ä¸ªæ–‡ä»¶å¤¹åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">.\nâ”œâ”€â”€ RTNCustomView\nâ”œâ”€â”€ android\nâ”œâ”€â”€ ios\nâ””â”€â”€ js\n</code></pre><p>å…¶ä¸­ï¼Œandroid å’Œ ios æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾è¯¥ç»„ä»¶çš„å®¢æˆ·ç«¯ä»£ç ï¼Œè€Œ js æ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾ JS/TS ä»£ç ã€‚</p><h3><strong>å®šä¹‰ç»„ä»¶</strong></h3><p>å®šä¹‰ç»„ä»¶çš„æ­¥éª¤ä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ï¼š</p><ol>\n<li>RTNCustomViewNativeComponent.tsxï¼šè¿™æ˜¯è‡ªå®šä¹‰ç»„ä»¶çš„ TypeScript Interfaceã€‚</li>\n<li>package.jsonï¼šè¿™æ˜¯è‡ªå®šä¹‰ç»„ä»¶ npm åŒ…çš„é…ç½®æ–‡ä»¶ã€‚</li>\n</ol><p>é¦–å…ˆï¼Œåœ¨ js ç›®å½•ä¸­ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªåä¸º RTNCustomViewNativeComponent.tsx çš„æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶ä»¥ NativeComponent ç»“å°¾ï¼Œè¿™æ˜¯å®˜æ–¹çº¦å®šçš„è§„åˆ™ï¼Œå› ä¸ºåç»­ CodeGen éœ€è¦æ ¹æ® NativeComponent ç»“å°¾çš„æ ‡è¯†æ‰¾åˆ° TypeScript çš„è§„èŒƒæ–‡ä»¶ï¼Œç„¶åè¿›è¡Œä»£ç ç”Ÿæˆï¼ˆcode generateï¼‰ã€‚</p><p>RTNCustomViewNativeComponent.tsx æ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">import type {ViewProps, HostComponent} from 'react-native';\nimport codegenNativeComponent from 'react-native/Libraries/Utilities/codegenNativeComponent';\n\nexport interface NativeProps extends ViewProps {\n background?: string;\n}\n\nexport default codegenNativeComponent&lt;NativeProps&gt;(\n 'RTNCustomView',\n) as HostComponent&lt;NativeProps&gt;;\n</code></pre><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬çº¦å®šè¿™ä¸ªç»„ä»¶åªèƒ½æ¥å—ä¸€ä¸ªè‡ªå®šä¹‰å‚æ•° backgroundï¼Œè¿™ä¸ªå‚æ•°çš„ç±»å‹æ˜¯ stringã€‚</p><p>æ­¤å¤–ï¼Œåœ¨ RTNCustomView ç›®å½•ä¸‹ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªåä¸º package.json çš„æ–‡ä»¶ã€‚è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">{\n  \"name\": \"rtn-custom-view\",\n  \"version\": \"0.0.1\",\n  \"description\": \"Showcase a Fabric Native Component with a custom background view\",\n  \"react-native\": \"js/index\",\n  \"source\": \"js/index\",\n  \"devDependencies\": {},\n  \"peerDependencies\": {\n   \"react\": \"*\",\n   \"react-native\": \"*\"\n  },\n  \"codegenConfig\": {\n   \"name\": \"RTNCustomViewSpecs\",\n   \"type\": \"components\",\n   \"jsSrcsDir\": \"js\"\n  }\n }\n</code></pre><p>åœ¨è¿™é‡Œï¼Œéœ€è¦ç‰¹åˆ«å…³æ³¨çš„æ˜¯ codegenConfig çš„é…ç½®ï¼ŒåŒ…æ‹¬åŒ…å nameã€ç±»å‹ type ä»¥åŠè§„èŒƒçš„ç›®å½• jsSrcsDirã€‚</p><p><strong>æœ‰ä¸€äº›çº¦å®šä¿—æˆçš„è§„åˆ™ï¼š</strong>åŒ…åå¿…é¡»ä»¥ Specs ç»“å°¾ï¼›ç»„ä»¶ç±»å‹åº”å¡«å†™ componentï¼Œæ¨¡å—ç±»å‹åº”å¡«å†™ modulesï¼Œè¿™é‡Œå¡«å†™çš„æ˜¯ componentï¼›è§„èŒƒçš„ç›®å½•å°±æ˜¯æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„ js ç›®å½•ã€‚</p><h3><strong>å®ç°ç»„ä»¶</strong></h3><p>Native è¿™éƒ¨åˆ†çš„å†…å®¹ç›¸å¯¹è¾ƒå¤šï¼Œä»¥ Android ä¸ºä¾‹ï¼ŒåŒ…æ‹¬äº”ä¸ªéƒ¨åˆ†ï¼š</p><ol>\n<li>build.gradleï¼šè¿™æ˜¯ Android æ¨¡å—çš„æ„å»ºé…ç½®ã€‚</li>\n<li>CodeGenï¼šè¿™æ˜¯ç”¨äºç”Ÿæˆé“¾æ¥ JS/Java/C++ çš„æ¨¡æ¿ä»£ç ã€‚</li>\n<li>CustomView.javaï¼šè¿™æ˜¯æ–°çš„åŸç”Ÿç»„ä»¶ã€‚</li>\n<li>CustomViewManager.javaï¼šè¿™æ˜¯åŸç”Ÿç»„ä»¶çš„ç®¡ç†å™¨ã€‚</li>\n<li>CustomViewPackage.javaï¼šè¿™ä¸ªéƒ¨åˆ†è´Ÿè´£å°†åŸç”Ÿç»„ä»¶æš´éœ²ç»™ React Nativeã€‚</li>\n</ol><p>æ•´ä¸ªç»“æ„å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">RTNCenteredText\nâ”œâ”€â”€ android\nâ”‚  â”œâ”€â”€ build.gradle\nâ”‚  â””â”€â”€ src/main/java/com/rtncenteredtext\nâ”‚            â”œâ”€â”€ CustomView.java\nâ”‚            â”œâ”€â”€ CustomViewManager.java\nâ”‚            â””â”€â”€ CustomViewPackage.java\nâ”œâ”€â”€ ios\nâ”œâ”€â”€ js\nâ””â”€â”€ package.json\n</code></pre><p>æ•´ä¸ªæµç¨‹å¼€å§‹äºé…ç½® Android çš„æ„å»ºè„šæœ¬ï¼Œç„¶åä½¿ç”¨ CodeGen è‡ªåŠ¨åŒ–å·¥å…·ç”Ÿæˆèƒ¶æ°´ä»£ç ï¼ŒæŠŠ JS/Java/C++ è¿æ¥èµ·æ¥ï¼Œæ¥ç€å®šä¹‰æ–°çš„ Java è‡ªå®šä¹‰åŸç”Ÿç»„ä»¶ï¼Œå†åˆ›å»ºä¸€ä¸ªç®¡ç†è¿™ä¸ªç»„ä»¶çš„ç±»ï¼Œæœ€ååœ¨ React Native ç»„ä»¶åˆ—è¡¨ä¸­æ³¨å†Œè¿™ä¸ªç»„ä»¶ï¼Œä½¿å…¶èƒ½å¤Ÿè¢« JavaScript ä»£ç è®¿é—®ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬è¯¦ç»†è®²è§£ä¸‹æµç¨‹ã€‚</p><p><strong>ç¬¬ä¸€æ­¥</strong><strong>ï¼š</strong><strong>é…ç½® build.gradle</strong></p><p>build.gradle æ˜¯ Android æ„å»ºç³»ç»Ÿç”¨æ¥å®šä¹‰æ„å»ºè§„åˆ™çš„æ–‡ä»¶ã€‚åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œç»å¤§éƒ¨åˆ†éƒ½æ˜¯æ¨¡æ¿ä»£ç ï¼Œä½ åªéœ€è¦å¤åˆ¶å’Œç²˜è´´å°±å¯ä»¥äº†ï¼Œéœ€è¦ä¿®æ”¹çš„åªæ˜¯è‡ªå®šä¹‰ç»„ä»¶çš„åå­—ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯ <code>namespace \"com.rtncustomview\"</code>ã€‚å®Œæ•´çš„é…ç½®å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">buildscript {\n  ext.safeExtGet = {prop, fallback -&gt;\n    rootProject.ext.has(prop) ? rootProject.ext.get(prop) : fallback\n  }\n  repositories {\n    google()\n    gradlePluginPortal()\n  }\n  dependencies {\n    classpath(\"com.android.tools.build:gradle:7.3.1\")\n  }\n}\n\napply plugin: 'com.android.library'\napply plugin: 'com.facebook.react'\n\nandroid {\n  compileSdkVersion safeExtGet('compileSdkVersion', 33)\n  namespace \"com.rtncustomview\"\n\n  defaultConfig {\n    minSdkVersion safeExtGet('minSdkVersion', 21)\n    targetSdkVersion safeExtGet('targetSdkVersion', 33)\n    buildConfigField(\"boolean\", \"IS_NEW_ARCHITECTURE_ENABLED\", \"true\")\n  }\n}\n\nrepositories {\n  mavenCentral()\n  google()\n}\n\ndependencies {\n  implementation 'com.facebook.react:react-native'\n}\n</code></pre><p><strong>ç¬¬äºŒæ­¥</strong><strong>ï¼š</strong><strong>è¿è¡Œ</strong> <strong>CodeGen</strong></p><p>CodeGen æ˜¯ä¸€ä¸ªè‡ªåŠ¨ä»£ç ç”Ÿæˆå·¥å…·ï¼Œå®ƒå¯ä»¥æ ¹æ®ä¹‹å‰åˆ›å»ºçš„ RTNCustomViewNativeComponent.tsx è§„èŒƒæ–‡ä»¶ï¼Œè‡ªåŠ¨ç”Ÿæˆè¿æ¥ JSã€Java å’Œ C++ çš„æ¨¡æ¿ä»£ç ã€‚è¿™æ ·ï¼Œä½ å°±å¯ä»¥åœ¨ JS ä¸­æ–¹ä¾¿åœ°è°ƒç”¨åŸç”Ÿæ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿé¿å…äº†æ‰‹åŠ¨ç¼–å†™è¿™äº›æ¨¡æ¿ä»£ç çš„ç¹çå·¥ä½œã€‚</p><p>åœ¨è¿è¡Œ CodeGen ä¹‹å‰ï¼Œä½ éœ€è¦å…ˆå°† RTNCustomView ç»„ä»¶æ·»åŠ åˆ° package.json æ–‡ä»¶ä¸­ï¼Œç„¶åé€šè¿‡ <code>android</code> å‘½ä»¤æ¥ç”Ÿæˆæ¨¡æ¿ä»£ç ã€‚å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">// åœ¨ RN é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ\nyarn add ./RTNCustomView\n// CD åˆ°æ ¹ç›®å½•ä¸‹çš„ android\ncd android\n./gradlew generateCodegenArtifactsFromSchema\n</code></pre><p><strong>ç¬¬ä¸‰æ­¥</strong><strong>ï¼š</strong><strong>åˆ›å»º</strong> <strong>CustomView.java</strong></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªæ–°çš„åŸç”Ÿç»„ä»¶ï¼Œåä¸º CustomView.javaã€‚è¿™ä¸ª Java ç±»å°†æ‰©å±•ä¸€ä¸ª Android åŸç”Ÿè§†å›¾ç±»ï¼ˆä¾‹å¦‚ TextViewï¼‰ï¼Œå¹¶å®šä¹‰æ‰€éœ€çš„å±æ€§å’Œè¡Œä¸ºã€‚</p><p>åœ¨è¿™ä¸ªç±»ä¸­ï¼Œä½ å¯ä»¥å®šä¹‰ä½ éœ€è¦çš„æ–¹æ³•å’Œå±æ€§ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ JS ä¸­ç›´æ¥è®¿é—®è¿™äº›æ–¹æ³•å’Œå±æ€§ã€‚åŒæ—¶ï¼Œä½ è¿˜éœ€è¦å®šä¹‰ä¸€äº›ç”¨æ¥è®¾ç½®å’Œè·å–è¿™äº›å±æ€§çš„æ–¹æ³•ï¼Œè¿™æ ·ï¼ŒReact Native å°±èƒ½é€šè¿‡è¿™äº›æ–¹æ³•ä¸åŸç”Ÿç»„ä»¶è¿›è¡Œäº¤äº’ã€‚</p><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">package com.rtncustomview;\n\nimport androidx.annotation.Nullable;\nimport android.content.Context;\nimport android.graphics.Color;\nimport android.util.AttributeSet;\nimport android.view.View;\n\npublic class CustomView extends View {\n    private int color;\n\n    public CustomView(Context context) {\n        super(context);\n        this.configureComponent();\n    }\n\n    public CustomView(Context context, @Nullable AttributeSet attrs) {\n        super(context, attrs);\n        this.configureComponent();\n    }\n\n    public CustomView(Context context, @Nullable AttributeSet attrs, int defStyleAttr) {\n        super(context, attrs, defStyleAttr);\n        this.configureComponent();\n    }\n\n    private void configureComponent() {\n        // é»˜è®¤èƒŒæ™¯è‰²ä¸ºçº¢è‰²\n        this.color = Color.RED;\n        this.setBackgroundColor(this.color);\n    }\n\n    public void setBackground(String color) {\n        // é¢œè‰²å€¼ç”±React Nativeä¼ å…¥ï¼Œæ ¼å¼ä¸º#RRGGBBï¼Œå¦‚çº¢è‰²ä¸º#FF0000\n        this.color = Color.parseColor(color);\n        this.setBackgroundColor(this.color);\n     }\n}    \n</code></pre><p>å…¶æ ¸å¿ƒæ˜¯ public void setBackground(String color) æ–¹æ³•ï¼Œå®ƒå¯¹åº”ç€ RTNCustomViewNativeComponent.tsx å®šä¹‰çš„ background å±æ€§ï¼Œå®ƒæ˜¯çœŸæ­£ä½¿ android.view.View è§†å›¾èƒŒæ™¯è‰²è®¾ç½®ç”Ÿæ•ˆçš„ä»£ç ã€‚</p><p><strong>ç¬¬å››æ­¥ï¼šåˆ›å»º</strong> <strong>CustomViewManager.java</strong></p><p>æ¯ä¸ªåŸç”Ÿç»„ä»¶éƒ½éœ€è¦ä¸€ä¸ªç®¡ç†å™¨ç±»ï¼ŒCustomViewManager.java å°±æ˜¯ CustomView.java çš„ç®¡ç†ç±»ã€‚ç®¡ç†å™¨ç±»é€šå¸¸éœ€è¦æ‰©å±• SimpleViewManagerï¼Œå¹¶å®ç°å¿…è¦çš„æ–¹æ³•ï¼Œä¾‹å¦‚ createViewInstance() æ–¹æ³•ç”¨äºåˆ›å»ºåŸç”Ÿç»„ä»¶çš„å®ä¾‹ã€‚</p><p>å¯¹äº React Native è‡ªå®šä¹‰ç»„ä»¶ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨ @ReactProp æ³¨è§£æ¥æ ‡è®°å¯ä»¥ä» JS ç«¯è®¾ç½®çš„å±æ€§ï¼Œè¿™æ · React Native å°±å¯ä»¥é€šè¿‡è¿™äº›æ–¹æ³•æ¥æ›´æ–°åŸç”Ÿç»„ä»¶çš„å±æ€§äº†ã€‚</p><p>å…¶å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">package com.rtncustomview;\n\nimport androidx.annotation.NonNull;\nimport androidx.annotation.Nullable;\nimport android.graphics.Color;  // è¿™é‡Œæ·»åŠ å¯¼å…¥è¯­å¥\n\nimport com.facebook.react.bridge.ReactApplicationContext;\nimport com.facebook.react.module.annotations.ReactModule;\nimport com.facebook.react.uimanager.SimpleViewManager;\nimport com.facebook.react.uimanager.ThemedReactContext;\nimport com.facebook.react.uimanager.ViewManagerDelegate;\nimport com.facebook.react.uimanager.annotations.ReactProp;\nimport com.facebook.react.viewmanagers.RTNCustomViewManagerInterface;\nimport com.facebook.react.viewmanagers.RTNCustomViewManagerDelegate;\n\n@ReactModule(name = CustomViewManager.NAME)\npublic class CustomViewManager extends SimpleViewManager&lt;CustomView&gt;\n        implements RTNCustomViewManagerInterface&lt;CustomView&gt; {\n\n    private final ViewManagerDelegate&lt;CustomView&gt; mDelegate;\n\n    static final String NAME = \"RTNCustomView\";\n\n    public CustomViewManager(ReactApplicationContext context) {\n        mDelegate = new RTNCustomViewManagerDelegate&lt;&gt;(this);\n    }\n\n    @Nullable\n    @Override\n    protected ViewManagerDelegate&lt;CustomView&gt; getDelegate() {\n        return mDelegate;\n    }\n\n    @NonNull\n    @Override\n    public String getName() {\n        return CustomViewManager.NAME;\n    }\n\n    @NonNull\n    @Override\n    protected CustomView createViewInstance(@NonNull ThemedReactContext context) {\n        return new CustomView(context);\n    }\n\n    // Here we are exposing a background color prop.\n    @ReactProp(name = \"background\", customType = \"Color\")\n    public void setBackground(CustomView view, @Nullable String color) {\n        if (color != null) {\n            view.setBackground(color);\n        }\n    }\n}    \n</code></pre><p><strong>ç¬¬äº”æ­¥ï¼šå‡çº§</strong> <strong>CustomViewPackage.java</strong></p><p>åœ¨åˆ›å»ºäº† CustomViewManager.java ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª CustomViewPackage.java æ¥åŒ…å«æˆ‘ä»¬çš„ ViewManagerã€‚åœ¨ createViewManagers æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å°†æ·»åŠ æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ CustomViewManagerã€‚</p><p>å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">package com.rtncustomview;\n\nimport com.facebook.react.ReactPackage;\nimport com.facebook.react.bridge.NativeModule;\nimport com.facebook.react.bridge.ReactApplicationContext;\nimport com.facebook.react.uimanager.ViewManager;\nimport java.util.ArrayList;\nimport java.util.Collections;\nimport java.util.List;\n\npublic class CustomViewPackage implements ReactPackage {\n    @Override\n    public List&lt;ViewManager&gt; createViewManagers(ReactApplicationContext reactContext) {\n        // return a list that contains our CustomViewManager\n        List&lt;ViewManager&gt; viewManagers = new ArrayList&lt;&gt;();\n        viewManagers.add(new CustomViewManager(reactContext));\n        return viewManagers;\n    }\n    @Override\n    public List&lt;NativeModule&gt; createNativeModules(ReactApplicationContext reactContext) {\n        // return an empty list because we do not have any native modules to export\n        return Collections.emptyList();\n    }\n\n}\n</code></pre><h3><strong>ä½¿ç”¨ç»„ä»¶</strong></h3><p>åœ¨ç»„ä»¶ä½¿ç”¨æ–¹é¢ï¼Œå›åˆ° JS ä»£ç ä¸­ï¼Œä½¿ç”¨åœ¨å®¢æˆ·ç«¯å®ç°çš„ç»„ä»¶ã€‚</p><p>é¦–å…ˆè¿è¡Œ <code>yarn add ./RTNCustomView</code> å‘½ä»¤ï¼Œé‡æ–°æ·»åŠ  RTNCustomViewï¼Œè¿™æ ·å¯ä»¥åˆ·æ–°æˆ‘ä»¬å®ç°ç»„ä»¶çš„ä»£ç ã€‚</p><p>ç„¶åç¼–å†™ä¸€æ®µæµ‹è¯•ä»£ç ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">import React from 'react';\nimport RTNCustomView from 'rtn-custom-view/js/RTNCustomViewNativeComponent';\nimport {View, Text, Button} from 'react-native';\n\nconst App: () =&gt; JSX.Element = () =&gt; {\n return (\n  &lt;View style={{borderColor: '#0ac', borderWidth: 1, padding: 5}}&gt;\n   &lt;Text&gt;New Componentï¼šè‡ªå®šä¹‰è§†å›¾ç»„ä»¶&lt;/Text&gt;\n   &lt;RTNCustomView\n    background=\"blue\"\n    style={{\n     width: 100,\n     height: 100,\n    }}\n   /&gt;\n  &lt;/View&gt;\n );\n};\nexport default App;\n</code></pre><p><strong>RTNCustomView çš„ä½¿ç”¨æ–¹å¼éå¸¸ç±»ä¼¼äºå…¶ä»–åŸç”Ÿç»„ä»¶ã€‚</strong>ä½ å¯ä»¥å‘å®ƒä¼ é€’å„ç§å±æ€§ï¼Œä¾‹å¦‚ background å’Œ styleã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®äº† background ä¸º <code>\"blue\"</code>ï¼Œå¹¶ä¸”è®¾ç½®äº†å®ƒçš„å®½åº¦å’Œé«˜åº¦ã€‚</p><p>è¿™é‡Œçš„ style å±æ€§è®¾ç½®äº†è§†å›¾çš„å®½åº¦å’Œé«˜åº¦ã€‚è¯·æ³¨æ„ï¼Œå°½ç®¡åœ¨ CustomView.java æ–‡ä»¶ä¸­æˆ‘ä»¬åªæä¾›äº† setBackground æ–¹æ³•ç”¨äºä¿®æ”¹é¢œè‰²ï¼Œä½† React Native çš„è§†å›¾ç®¡ç†å™¨ä¸ºæ‰€æœ‰çš„åŸç”Ÿè§†å›¾ç»„ä»¶é»˜è®¤æä¾›äº†å¯¹ style å±æ€§çš„æ”¯æŒã€‚</p><p>å®Œæ•´ä»£ç ï¼Œæˆ‘æ”¾åœ¨ <a href=\"https://github.com/jiangleo/react-native-classroom/tree/main\">Github</a> ä¸Šäº†ã€‚</p><p>æœ€åï¼Œé‡æ–°æ„å»º Android åº”ç”¨ï¼Œä½ å°±èƒ½çœ‹åˆ°ä»£ç ç”Ÿæ•ˆäº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/72/1d/72cd7cecd9ed1e887562508b0a9a271d.png?wh=1210x916\" alt=\"å›¾ç‰‡\"></p><h2><strong>æ€»ç»“</strong></h2><p>è¿™èŠ‚è¯¾æˆ‘ä»‹ç»äº†ä¸¤ç§å‡çº§æ–°æ¶æ„çš„ç­–ç•¥ã€‚</p><p>ä¸€ç§ç­–ç•¥æ˜¯è€ä»£ç å…¼å®¹æ–¹æ¡ˆï¼Œè¯¥æ–¹æ¡ˆéœ€è¦å¼€å¯ç»„ä»¶å…¼å®¹å±‚æ‰èƒ½ä½¿ç”¨ï¼Œè€Œä¸”å¯èƒ½ä¼šæœ‰éƒ¨åˆ†æ€§èƒ½æŸè€—ã€‚å¦ä¸€ç§ç­–ç•¥æ˜¯å®Œå…¨è¿ç§»åˆ°æ–°æ¶æ„çš„æ–¹æ¡ˆï¼Œè¯¾ç¨‹ä¸­æˆ‘ä»¥æ–°å»º Android ç»„ä»¶ä¸ºä¾‹ï¼Œä»‹ç»äº†è¿ç§»æ–°æ¶æ„çš„ç­–ç•¥ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ–°æ¶æ„æ¨¡å¼ä¸‹ï¼Œè‡ªå®šä¹‰ç»„ä»¶çš„åˆ›å»ºæ–¹å¼ä¸è€æ¶æ„æœ‰å¾ˆå¤§çš„ä¸åŒï¼Œæ–°æ¶æ„æ˜¯ä»¥åŒ…ä¸ºå•å…ƒå°†å„ç«¯ç»Ÿä¸€åœ¨ä¸€èµ·æ¥è¿›è¡Œå¼€å‘çš„ï¼Œè€æ¶æ„ä»£ç éƒ½åœ¨è‡ªå·±çš„ JS/Android/iOS ä»“åº“ä¸­ã€‚è¿™æ„å‘³ç€ï¼Œå°†è€ä»£ç æ”¹ä¸ºæ–°æ¶æ„çš„å†™æ³•å¯èƒ½ä¼šæœ‰å·¨å¤§çš„è¿ç§»æˆæœ¬ã€‚</p><p>å› æ­¤ï¼Œæˆ‘çš„å»ºè®®æ˜¯ï¼Œæ–°çš„ç»„ä»¶æˆ–æ¨¡å—ä½¿ç”¨æ–°æ¶æ„ï¼Œè€Œæ—§çš„ä»£ç ä¿æŒä¸å˜ï¼Œä½¿ç”¨å…¼å®¹æ¨¡å¼ã€‚è¿™ç§å‡çº§ç­–ç•¥æˆæœ¬ä¼šä½å¾ˆå¤šã€‚</p><p>é‚£ä¹ˆåˆ°è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬çš„åŠ¨æ€æ›´æ–°ä¸“æ ä¹Ÿè¦å’Œå¤§å®¶è¯´å†è§äº†ï¼Œæ„Ÿè°¢ä½ è¿‡å»ä¸€å¹´çš„é™ªä¼´ã€‚å› ä¸ºæœ‰ä½ ï¼Œæ‰€ä»¥ä¸€åŒæˆé•¿ã€‚æˆ‘ä»¬æœ‰ç¼˜ï¼Œå†ä¼šï¼</p>","neighbors":{"left":{"article_title":"35ï½œè‡ªåŠ¨åŒ–ï¼šå‡çº§0.72æ–°æ¶æ„çš„æ­¥éª¤å’Œå…³é”®","id":671893},"right":[]},"comments":[{"had_liked":false,"id":379253,"user_name":"å¬è¯´æ˜µç§°å¤ªé•¿äº†èº²åœ¨æ ‘åé¢ä¼šè¢«åˆ«äººçœ‹è§çš„","can_delete":false,"product_type":"c1","uid":3616258,"ip_address":"ç¦å»º","ucode":"EFFEE43631C3B4","user_header":"https://static001.geekbang.org/account/avatar/00/37/2e/02/7f151e08.jpg","comment_is_top":false,"comment_ctime":1691600830,"is_pvip":false,"replies":null,"discussion_count":4,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"æˆ‘å°±æ˜¯é‚£ä½æŠ˜è…¾äº†ä¸‰å¤©é€€å›å»çš„åŒå­¦ï¼Œæ²¡æƒ³åˆ°è¢«ç‚¹åäº†ğŸ˜‚ã€‚ç»è¿‡äº†ä¸€å¹´ RN çš„æŠ˜è…¾æˆ‘ä¹Ÿæ€»ç»“äº†ä¸€äº›çœ‹æ³•ï¼Œè¿™ä¸ªæŠ˜è…¾è¿‡ç¨‹ä¼°è®¡ä¹Ÿæ˜¯å¾ˆå¤šåˆå°è·¨æ®µæ–¹æ¡ˆçš„å›¢é˜Ÿè¦èµ°çš„è€è·¯ã€‚é¦–å…ˆä¸èƒ½æŠŠ RN å½“åšå®¢æˆ·ç«¯æœ€ç»ˆè§£å†³æ–¹æ¡ˆï¼Œæˆ‘ä»¬å½“æ—¶è°ƒç ”åä¸‹çš„ç»“è®ºï¼šâ€œè·¨ç«¯æ˜¯æœªæ¥ï¼ŒåŸç”Ÿæ˜¯è¾…åŠ©â€ï¼Œå› ä¸ºé¡¹ç›®åˆæœŸå„éƒ¨é—¨åŒäº‹ä¸€è‡´ä¸è´Ÿè´£çš„è¯´ï¼šæ€ä¹ˆå¿«æ€ä¹ˆæ¥ï¼Œèƒ½ç”¨å°±è¡Œï¼è¿™ç»™äº†æˆ‘ä»¬æ‹¥æŠ±è·¨ç«¯çš„å‹‡æ°”ã€‚å¯å½“åŠ ç­åŠ ç‚¹å¿™å®Œé¡¹ç›®ä¸Šçº¿è·‘èµ·æ¥ç»ˆäºæ¾ä¸€å£æ°”æ—¶å¤§å®¶å£é£å°±å˜äº†ï¼Œå› ä¸ºèƒ½ç”¨å’Œç”¨åˆ°æè‡´æ˜¯ä¸¤ç äº‹ï¼Œå½“å¼€å§‹ç›ˆåˆ©æ—¶è·Ÿç«å“ä¸€å¯¹æ¯”é‚£å¿…é¡»è¦ç”¨åˆ°æè‡´ï¼Œèµ·åˆé‚£äº›ä¸ç—›ä¸ç—’çš„é—®é¢˜åœ¨è¿™ä¸ªé˜¶æ®µå°±å˜æˆäº†æ£˜æ‰‹é—®é¢˜ï¼Œå…œå…œè½¬è½¬æœ€ååˆå›åˆ°äº†åŸç”Ÿï¼Œå› ä¸ºä¸æ˜¯æ‰€æœ‰å›¢é˜Ÿéƒ½æœ‰åƒå®ä¼Ÿè€å¸ˆè¿™æ ·çš„å›¢é˜Ÿå»åšæ·±åº¦ä¼˜åŒ–ï¼Œæ‰€ä»¥æˆ‘ä»¬èŠ±äº†å¾ˆå¤šæ—¶é—´å»ä¼˜åŒ–å´æ²¡æŠ˜è…¾å‡ºæ•ˆæœï¼Œå…¬å¸æ²¡æ³•å†å¿å—æˆ‘ä»¬å»ç ”ç©¶è€Œä¸äº§å‡ºäº†ï¼Œç„¶ååªèƒ½ç”¨åŸç”ŸæŠŠå¤§éƒ¨åˆ†æ ¸å¿ƒåŠŸèƒ½é‡å†™äº†ï¼Œåªç•™ä¸‹å°‘é‡è¾¹è¾¹è§’è§’çš„ä¸šåŠ¡ç”¨ RNï¼Œå›è¿‡å¤´ä¸€çœ‹ï¼ŒåŸæœ¬æƒ³å€ŸåŠ©è·¨ç«¯æé«˜ç”Ÿäº§åŠ›ï¼Œç»“æœåè€Œæ˜¯é™ä½äº†ç”Ÿäº§åŠ›ï¼Œå¯ä»¥è¯´æ˜¯ç¾Šè‚‰æ²¡åƒåˆ°å¼„äº†ä¸€èº«éªšï¼ŒåŸå› å¾ˆç®€å•ï¼Œä¸€ä½†è¿‡äº† 0 åˆ° 1 è¿™ä¸ªé˜¶æ®µæ‘†åœ¨é¢å‰åªæœ‰ä¸¤æ¡è·¯ï¼Œè¦ä¹ˆæ·±å…¥ç”šè‡³é­”æ”¹ RNï¼ˆè¿™æ²¡ä¸ªä¸€å¹´åŠè½½é—¨éƒ½æ‘¸ä¸ç€ï¼‰ï¼Œè¦ä¹ˆç”¨åŸç”Ÿå¼€å§‹é‡æ„ï¼ˆåŸç”Ÿå¼€å‘ç»„çš„åŒäº‹è¿˜æ•´å¤©åšä¼˜åŒ–å‘¢ï¼Œçº¯ RN å’‹ä¸ªåšåˆ°æè‡´ï¼‰ï¼Œå¦‚æœæ²¡æœ‰åšè¿™åˆ°é€‰æ‹©é¢˜é‚£ä¹ˆå¤§æ¦‚ç‡æˆ‘çŒœä½ ä»¬å®£å‘Šé¡¹ç›®å¤±è´¥ç”šè‡³åˆ°äº†è£å‘˜çš„è¾¹ç¼˜ï¼Œå¸‚åœºæœºä¼šæ€»æ˜¯ç¨çºµå³é€ï¼Œé¡¹ç›®çš„å¤±è´¥ä¸æŠ€æœ¯é€‰é¡¹ä¸æ— å…³ç³»ï¼Œè¿™ä¸ªé—®é¢˜å€¼å¾—æ·±æ€ã€‚æ€»ç»“ï¼Œå¾—ç»“åˆè‡ªèº«é¡¹ç›®å€ŸåŠ© RN è¾…åŠ©å®Œæˆä¸€äº›å·¥ä½œï¼Œæœ€å¥½ä¸è¦ä¸€æ¢­å“ˆçš„æŠŠé¸¡è›‹å…¨æ”¾ RN çš„ç¯®å­é‡Œï¼Œé™¤éä½ åšçš„æ˜¯éœ€æ±‚æ˜ç¡®å¹¶ä¸”ç”Ÿå‘½å‘¨æœŸå¯é¢„æµ‹çš„é¡¹ç›®ã€‚å¦å¤–ï¼Œè¿™ä¸¤å¤©åœ¨ç ”ç©¶åŸç”Ÿæ‰¿è½½é¡µåŠ è½½ RN è¿‡æ…¢çš„é—®é¢˜ï¼Œå®‰å“ä½ç«¯æœºå¾—ä¸¤ä¸‰ç§’ç™½å±åæ‰èƒ½åŠ è½½å®Œæ¸²æŸ“å‡ºæ¥ï¼Œä¸çŸ¥é“è€å¸ˆèƒ½å¦åŠ ä¸ªé¤è®²ä¸€è®²æ€ä¹ˆä¼˜åŒ–ã€‚","like_count":4,"discussions":[{"author":{"id":2178133,"avatar":"https://static001.geekbang.org/account/avatar/00/21/3c/55/74844d08.jpg","nickname":"å¤§å¤§å°å°","note":"","ucode":"8A21DC629A24F5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":625616,"discussion_content":"æ¥¼ä¸»å¯ä»¥ç»†è¯´ä¸‹ï¼Œå…·ä½“é‡åˆ°äº†ä»€ä¹ˆç“¶é¢ˆå—ï¼Œæˆ‘å†™äº†å‡ ä¸ªæœˆï¼Œç›®å‰æ²¡æœ‰é‡åˆ°å¤§çš„é˜»ç¢ï¼Œæƒ³çŸ¥é“ä½ ä»¬é‡åˆ°äº†å“ªäº›é—®é¢˜æ˜¯rnæ— æ³•è§£å†³çš„ï¼Œç›®å‰æœ€ä¸èˆ’æœçš„æ˜¯å¾ˆå¤šç¬¬ä¸‰æ–¹ç»„ä»¶éƒ½æ˜¯ä¸‰å››å¹´å‰çš„ï¼Œæ²¡äººç»´æŠ¤ï¼Œç”¨äº†native baseç»„ä»¶åº“ï¼Œæœ€è¿‘åŠå¹´ä¹Ÿæ²¡æ›´æ–°äº†ï¼Œå‡çº§åˆ°0.72åï¼Œandroidç«¯åœ¨scrollowé‡Œçš„è¾“å…¥æ¡†é”®ç›˜å¼¹èµ·åè¾“å…¥æ¡†æ— æ³•è‡ªåŠ¨é¡¶èµ·ï¼Œæ²¡åŠæ³•ï¼Œé€€å›åˆ°0.71 ç‰ˆæœ¬äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1691987265,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":3616258,"avatar":"https://static001.geekbang.org/account/avatar/00/37/2e/02/7f151e08.jpg","nickname":"å¬è¯´æ˜µç§°å¤ªé•¿äº†èº²åœ¨æ ‘åé¢ä¼šè¢«åˆ«äººçœ‹è§çš„","note":"","ucode":"EFFEE43631C3B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2178133,"avatar":"https://static001.geekbang.org/account/avatar/00/21/3c/55/74844d08.jpg","nickname":"å¤§å¤§å°å°","note":"","ucode":"8A21DC629A24F5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":625935,"discussion_content":"å¤æ‚é¡µé¢ï¼Œå½“ä¸€ä¸ªé¡µé¢æœ‰å¾ˆå¤šçš„çŠ¶æ€æ—¶ï¼Œæ¯”å¦‚ 20 ä¸ª  setState() æ¯”è¾ƒæ…¢ï¼Œç‰¹åˆ«æ˜¯å¯¹ flatlist è¿›è¡Œæ›´æ–°æ—¶ï¼Œç„¶åä½ ä¼šè€ƒè™‘ç”¨å„ç§æ‰‹æ®µåˆå¹¶ state ã€ä½¿ç”¨å„ç§ usecallback ç¼“å­˜çš„æ‰‹æ®µæ¥ä¼˜åŒ–ï¼Œä¼˜åŒ–ä¸€éåé™¤äº†è®©ä»£ç å˜å¾—æ›´å¤æ‚ä¹‹å¤–æ”¶ç›Šç”šå¾®ã€‚è¾¾åˆ°åŒæ ·çš„æ€§èƒ½æ•ˆæœï¼Œä½¿ç”¨ rn çš„å¿ƒæ™ºè´Ÿæ‹…æ¯”åŸç”Ÿæ›´å¤§ï¼Œè¿™ç§å¤æ‚é¡µé¢åæ¥æˆ‘ä»¬æ”¹æˆåŸç”Ÿå¼€å‘ï¼Œç”¨è„šå†™å‡ºæ¥éƒ½æ˜¯ä¸æ»‘æµç•…ã€‚å†æ¯”å¦‚æœ‰å¯†é›†è®¡ç®—çš„åœºæ™¯ï¼Œä¾‹å¦‚ä¸€ä¸ªè¿ç®—è€—æ—¶ä¸‰ç§’ï¼Œè¿™ä¸‰ç§’æ“ä½œ ui æ˜¯å¡é¡¿çš„ï¼Œå› ä¸º js æ˜¯å•çº¿ç¨‹ï¼Œè€ŒåŸç”Ÿå¼€å‘è¿™ç§åœºæ™¯å¯ä»¥å¼€å­çº¿ç¨‹ã€‚æ€»ä¹‹ï¼Œå¦‚æœä½ çš„é¡¹ç›®å¼€å§‹å¯¹æ ‡åŸç”Ÿçš„æ—¶å€™é‚£ä¹ˆå°±å…¨èº«éƒ½æ˜¯ç“¶é¢ˆï¼Œç‰¹åˆ«åœ¨ä½ç«¯æœºä¸Šï¼Œè€Œæˆ‘ä»¬ä¹‹å‰åšä¸œå—äºšçš„é¡¹ç›®ï¼Œä»–ä»¬éƒ½æ˜¯ä½ç«¯æœºï¼Œreact navigation è·³è½¬å¾ˆæ…¢ï¼Œç›®æ ‡é¡µè¶Šå¤æ‚è·³è½¬è¶Šæ…¢ï¼Œæ•´ä½“æ„Ÿå—å°±æ˜¯è¿™ app æ€ä¹ˆè¿™ä¹ˆå¡ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1692338205,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":625616,"ip_address":"ç¦å»º","group_id":0},"score":625935,"extra":""},{"author":{"id":2178133,"avatar":"https://static001.geekbang.org/account/avatar/00/21/3c/55/74844d08.jpg","nickname":"å¤§å¤§å°å°","note":"","ucode":"8A21DC629A24F5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":3616258,"avatar":"https://static001.geekbang.org/account/avatar/00/37/2e/02/7f151e08.jpg","nickname":"å¬è¯´æ˜µç§°å¤ªé•¿äº†èº²åœ¨æ ‘åé¢ä¼šè¢«åˆ«äººçœ‹è§çš„","note":"","ucode":"EFFEE43631C3B4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":626179,"discussion_content":"æ„Ÿè°¢ï¼Œé¡µé¢å…ƒç´ è¿‡å¤šï¼Œé¡µé¢å¤æ‚åº¦é«˜ï¼Œæ¸²æŸ“æ€§èƒ½ç¡®å®æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œé™¤äº†åˆ†å¸§åŠ è½½ï¼Œä¹Ÿæ²¡å¥½çš„åŠæ³•ï¼Œå¯†é›†è®¡ç®—ä¹Ÿæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1692619420,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":625935,"ip_address":"å¹¿ä¸œ","group_id":0},"score":626179,"extra":""}]},{"author":{"id":1436276,"avatar":"https://static001.geekbang.org/account/avatar/00/15/ea/74/7dd9c65e.jpg","nickname":"äº¦æ«ä¸¶","note":"","ucode":"A8D09693C760E0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":625462,"discussion_content":"æ„Ÿè°¢åˆ†äº«ã€‚å¦‚æœç«å“æ¯”è‡ªå·±åšçš„å¥½ï¼Œè€ŒRNæ­£å¥½æ˜¯ç“¶é¢ˆï¼Œé‚£ç¡®å®å¾ˆè®©äººæ— åŠ©ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1691719813,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":384696,"user_name":"é•¿æ—å•Š","can_delete":false,"product_type":"c1","uid":1707743,"ip_address":"å››å·","ucode":"B75CB4919FF25A","user_header":"https://static001.geekbang.org/account/avatar/00/1a/0e/df/a64b3146.jpg","comment_is_top":false,"comment_ctime":1701344292,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":1,"score":2,"product_id":100110101,"comment_content":"è€å¸ˆåé¢èƒ½æ‰©å±•react-nativeæœåŠ¡ç«¯æ¸²æŸ“æ–¹å‘çš„ç›¸å…³å†…å®¹å—ï¼Ÿ","like_count":1},{"had_liked":false,"id":379182,"user_name":"å¤§å¤§å°å°","can_delete":false,"product_type":"c1","uid":2178133,"ip_address":"æ±Ÿè¥¿","ucode":"8A21DC629A24F5","user_header":"https://static001.geekbang.org/account/avatar/00/21/3c/55/74844d08.jpg","comment_is_top":false,"comment_ctime":1691489897,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"å“ˆå“ˆï¼Œæˆ‘å±…ç„¶æ˜¯ç¬¬ä¸€ä¸ªæ¯•ä¸šçš„ï¼","like_count":1}]}