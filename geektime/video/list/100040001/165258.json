{"id":165258,"title":"08 | 聚合查询","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-mongodb-course\">https://gitee.com/geektime-geekbang/geektime-mongodb-course</a></p>","comments":[{"had_liked":false,"id":246005,"user_name":"李英权","can_delete":false,"product_type":"c3","uid":1076081,"ip_address":"","ucode":"FECAC14A9C414B","user_header":"https://static001.geekbang.org/account/avatar/00/10/6b/71/e833b14a.jpg","comment_is_top":false,"comment_ctime":1599130258,"is_pvip":false,"replies":[{"id":91322,"content":"谢谢分享！","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1600308485,"ip_address":"","comment_id":246005,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"复杂的聚合查询 一定要尽可能把所有的match放在在project投影之前，如果match出现在project之后 就无法享受索引加速了。\n当然 还需要根据match字段 创建对应的联合索引。 我刚刚把一个复杂查询优化了 就是把几个match提前了 然后建索引，查询耗时从5秒降到1秒","like_count":13,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505032,"discussion_content":"谢谢分享！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600308485,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2435535,"avatar":"https://static001.geekbang.org/account/avatar/00/25/29/cf/db5be02a.jpg","nickname":"漆黑的小白","note":"","ucode":"C8FF1577C6FBDC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543556,"discussion_content":"赞，应该是管道的执行模式决定的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641202809,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":173344,"user_name":"daming","can_delete":false,"product_type":"c3","uid":1743628,"ip_address":"","ucode":"BCDF7A52BCB657","user_header":"https://static001.geekbang.org/account/avatar/00/1a/9b/0c/1a1efc76.jpg","comment_is_top":false,"comment_ctime":1579508329,"is_pvip":false,"replies":[{"id":67811,"content":"queryPlanner并不能保证100%找到最优的索引，所以才在必要的时候使用hint来强制指定。当你自己选了合适的索引执行以后，这个计划就会被cache，所以下次不用hint，可能也就是用了你这个cached的（最佳）索引。\n\n这个是我的一个推断。你可以清除下query plan cache再重新跑一下，看看是否还是能默认用到最佳索引。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1580258646,"ip_address":"","comment_id":173344,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"请问mongo查询用explain分析查询语句，winningPlan选中的索引并非最优索引，用hint强制执行winningplan，执行是分钟以上，然后选择自己认为最有的索引执行，只需要几十秒。然而不用hint，直接执行也是几十秒，说明explain没有显示真正最优索引，请问这是什么情况？","like_count":3,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482043,"discussion_content":"queryPlanner并不能保证100%找到最优的索引，所以才在必要的时候使用hint来强制指定。当你自己选了合适的索引执行以后，这个计划就会被cache，所以下次不用hint，可能也就是用了你这个cached的（最佳）索引。\n\n这个是我的一个推断。你可以清除下query plan cache再重新跑一下，看看是否还是能默认用到最佳索引。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1580258646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1076081,"avatar":"https://static001.geekbang.org/account/avatar/00/10/6b/71/e833b14a.jpg","nickname":"李英权","note":"","ucode":"FECAC14A9C414B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294798,"discussion_content":"请问 aggregate聚合查询 能使用hint吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596003423,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":162511,"user_name":"cording","can_delete":false,"product_type":"c3","uid":1786385,"ip_address":"","ucode":"82063AEC231613","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKlllSKrpQkhSXyNj0glDoCiaMKp23ey4Fw0nr54MKKhYAIxxU7toQuukJe2qZjwUC990ojdNmeicVQ/132","comment_is_top":false,"comment_ctime":1576547099,"is_pvip":false,"replies":[{"id":62369,"content":"如果是无条件全表count，这个很快因为是实时计数的。\n\n带条件count取决于：1） 是否用到索引  2）你的数据是否都在内存  3）你的存储IO是否够快 - SSD vs SAS vs SATA 有很大差别\n\n通常来说这种操作会需要几十秒到分钟级如果没有优化。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1576888267,"ip_address":"","comment_id":162511,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师，请教一下如果单表数据量有3亿，进行聚合统计比如count，效率怎么样？","like_count":3,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478072,"discussion_content":"如果是无条件全表count，这个很快因为是实时计数的。\n\n带条件count取决于：1） 是否用到索引  2）你的数据是否都在内存  3）你的存储IO是否够快 - SSD vs SAS vs SATA 有很大差别\n\n通常来说这种操作会需要几十秒到分钟级如果没有优化。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576888267,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":242069,"user_name":"Jack","can_delete":false,"product_type":"c3","uid":1007792,"ip_address":"","ucode":"1803F8C5114556","user_header":"https://static001.geekbang.org/account/avatar/00/0f/60/b0/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1597583290,"is_pvip":false,"replies":[{"id":89363,"content":"用于lookup 的字段，特别是 foreignField 在被lookup 表里面，必须要有索引。多半是因为这个","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1597625949,"ip_address":"","comment_id":242069,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"lookup做join查询，两个集合的文档都大于10万条时，几乎就查不出来了，怎么优化呢？","like_count":2,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503913,"discussion_content":"用于lookup 的字段，特别是 foreignField 在被lookup 表里面，必须要有索引。多半是因为这个","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597625949,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1007792,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/60/b0/abb7bfe3.jpg","nickname":"Jack","note":"","ucode":"1803F8C5114556","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":299251,"discussion_content":"因为我有时候需要通过class的查询条件来决定返回数量，所以不能先查student，这个类似于关系性数据库的一对多查询，学生有班级id我要查询班级等于“一班”的学生。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597629006,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1007792,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/60/b0/abb7bfe3.jpg","nickname":"Jack","note":"","ucode":"1803F8C5114556","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":299248,"discussion_content":"我是这样查询的：\ndb.student. aggregate（[\n｛&#34;$lookup&#34;:\n     {from:&#39;class&#39;,\n      &#39;let&#39;:{&#39;studentClassId&#39;:&#39;$studentClassId&#39;},\n      &#39;pipeline&#39;:[\n             {&#39;$addField&#39;:{&#39;_id&#39;:{&#39;toString&#39;:&#39;$_id&#39;}}},\n             {&#39;$match&#39;:{&#39;expr&#39;:{&#39;$eq&#39;:[&#39;$$studentClassId&#39;,&#39;_id&#39;]}}}\n             \n     ],\n     &#39;as&#39;:&#39;studentClass&#39;\n     }\n  },\n  {&#39;$unwind&#39;:&#39;$studentClass&#39;},\n  {&#39;$sort&#39;:&#39;studentClass.studentCount&#39;},\n  {&#39;$skip&#39;:0},\n  {&#39;$limt&#39;:20}\n]）\n最后发现，加上条件查询$match，查询student集合的时候返回很快，查询班级的时候很慢，studentClass. name这样查询就跟慢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597628697,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":160984,"user_name":"丁丁历险记","can_delete":false,"product_type":"c3","uid":1661704,"ip_address":"","ucode":"A43829E454C067","user_header":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","comment_is_top":false,"comment_ctime":1576073095,"is_pvip":false,"replies":[{"id":61411,"content":"MongoDB企业版中有支持SQL方式查询的工具。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1576118861,"ip_address":"","comment_id":160984,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"好奇一件事情，单表查询的话，为啥不直接支持下sql","like_count":2,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477556,"discussion_content":"MongoDB企业版中有支持SQL方式查询的工具。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576118861,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":184457,"user_name":"扬一场远远的风","can_delete":false,"product_type":"c3","uid":1357801,"ip_address":"","ucode":"AB47E3D2EAB8A8","user_header":"https://static001.geekbang.org/account/avatar/00/14/b7/e9/5400cdf3.jpg","comment_is_top":false,"comment_ctime":1583320234,"is_pvip":false,"replies":[{"id":72153,"content":"理论上没有，只有bson 大小限制（16MB）。但实际上我用到1000的时候查询就很慢了。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1584004141,"ip_address":"","comment_id":184457,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师好！mongodb $in子句有长度限制吗？另外mongodb的 findMany返回的游标，会不会有内存溢出的问题呢？","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486021,"discussion_content":"理论上没有，只有bson 大小限制（16MB）。但实际上我用到1000的时候查询就很慢了。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584004141,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":180996,"user_name":"qbit","can_delete":false,"product_type":"c3","uid":1262927,"ip_address":"","ucode":"96C70A1E47B93D","user_header":"https://static001.geekbang.org/account/avatar/00/13/45/4f/f94caf47.jpg","comment_is_top":false,"comment_ctime":1582456055,"is_pvip":false,"replies":[{"id":70953,"content":"mapReduce已经是deprecated，基本不维护。\nAggregation 是 替代产品，用C++写，性能比较保证。\n但是mapReduce很灵活，可以写JS脚本。\nAggregation要按照指定的语法，有些场景可能难以实现。\n\n所以，如果能用agg做的，尽量用agg\n如果逻辑太复杂，就用MR","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1583029378,"ip_address":"","comment_id":180996,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"请问 collection.mapReduce 与 collection.aggregate 的区别是？各自适用于哪些应用场景？","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484882,"discussion_content":"mapReduce已经是deprecated，基本不维护。\nAggregation 是 替代产品，用C++写，性能比较保证。\n但是mapReduce很灵活，可以写JS脚本。\nAggregation要按照指定的语法，有些场景可能难以实现。\n\n所以，如果能用agg做的，尽量用agg\n如果逻辑太复杂，就用MR","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583029378,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1262927,"avatar":"https://static001.geekbang.org/account/avatar/00/13/45/4f/f94caf47.jpg","nickname":"qbit","note":"","ucode":"96C70A1E47B93D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":191718,"discussion_content":"好的，多谢！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583029775,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":163327,"user_name":"YoKate","can_delete":false,"product_type":"c3","uid":1204743,"ip_address":"","ucode":"1D65BC35057F89","user_header":"https://static001.geekbang.org/account/avatar/00/12/62/07/953d0f7f.jpg","comment_is_top":false,"comment_ctime":1576686832,"is_pvip":false,"replies":[{"id":62371,"content":"对的。 $lte: 小于等于。所以是女员工数量等于或少于10的部门","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1576888426,"ip_address":"","comment_id":163327,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"这个：\n\ndb.user.aggregate([\n{\n  $match:{gender: &#39;女&#39;}\n} , {\n  $group: {\n   _id:&quot;$DEPARTMENT&#39;,\n   emp_qty:{$sum:1}\n}, {\n $match: {\n  emp_qty: {$lte: 10}\n}\n}])\n\n是不是寻找部门女员工数量少于 10 的部门？","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478350,"discussion_content":"对的。 $lte: 小于等于。所以是女员工数量等于或少于10的部门","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576888426,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":212620,"user_name":"李家鑫","can_delete":false,"product_type":"c3","uid":1701485,"ip_address":"","ucode":"83A47B7F95E12B","user_header":"https://static001.geekbang.org/account/avatar/00/19/f6/6d/412b5dc4.jpg","comment_is_top":false,"comment_ctime":1588164492,"is_pvip":false,"replies":[{"id":79261,"content":"目前没有取别名的功能。只能按照区间值","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1588633508,"ip_address":"","comment_id":212620,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师我想问下使用$bucket可以根据每个范围起别名吗,还是只能根据每个_id是哪个区间开始的来判断？","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493563,"discussion_content":"目前没有取别名的功能。只能按照区间值","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588633508,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1701485,"avatar":"https://static001.geekbang.org/account/avatar/00/19/f6/6d/412b5dc4.jpg","nickname":"李家鑫","note":"","ucode":"83A47B7F95E12B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":257989,"discussion_content":"感谢老师","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588638416,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":156361,"user_name":"cliff","can_delete":false,"product_type":"c3","uid":1637634,"ip_address":"","ucode":"8A311E94AD47FD","user_header":"https://static001.geekbang.org/account/avatar/00/18/fd/02/4c261784.jpg","comment_is_top":false,"comment_ctime":1574861939,"is_pvip":false,"replies":[{"id":60898,"content":"没有sumif这个keyword，但是可以实现类似的事情，下面这个例子是只把&gt;=10 的$a字段的值相加求和：\n\ndb.collection.aggregate([{\n  $group: {\n    _id: null,\n    total: {\n      $sum: {\n        $cond: [{  $gte: [&quot;$a&quot;, 10] },  \n          &quot;$a&quot;,\n          0\n        ]\n      }\n    }\n  }\n}])","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1575594561,"ip_address":"","comment_id":156361,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老大有没有类似sumif的聚合","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476078,"discussion_content":"没有sumif这个keyword，但是可以实现类似的事情，下面这个例子是只把&amp;gt;=10 的$a字段的值相加求和：\n\ndb.collection.aggregate([{\n  $group: {\n    _id: null,\n    total: {\n      $sum: {\n        $cond: [{  $gte: [&amp;quot;$a&amp;quot;, 10] },  \n          &amp;quot;$a&amp;quot;,\n          0\n        ]\n      }\n    }\n  }\n}])","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575594561,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1637634,"avatar":"https://static001.geekbang.org/account/avatar/00/18/fd/02/4c261784.jpg","nickname":"cliff","note":"","ucode":"8A311E94AD47FD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":74910,"discussion_content":"谢谢老大 请问mongo有没有mysql那种union的查询语句？ 俺这边在做一个估值表 最好一行能输出若干列但是要用到不同的聚合","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575705044,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1684128,"avatar":"https://static001.geekbang.org/account/avatar/00/19/b2/a0/8e0712bb.jpg","nickname":"思考机器","note":"","ucode":"1362B5F84AD986","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":64345,"discussion_content":"你要的应该是$cond：https://docs.mongodb.com/manual/reference/operator/aggregation/cond/","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574946283,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1637634,"avatar":"https://static001.geekbang.org/account/avatar/00/18/fd/02/4c261784.jpg","nickname":"cliff","note":"","ucode":"8A311E94AD47FD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1684128,"avatar":"https://static001.geekbang.org/account/avatar/00/19/b2/a0/8e0712bb.jpg","nickname":"思考机器","note":"","ucode":"1362B5F84AD986","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":76323,"discussion_content":"收到 非常感谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575815587,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":64345,"ip_address":"","group_id":0},"score":76323,"extra":""}]}]},{"had_liked":false,"id":156203,"user_name":"袭","can_delete":false,"product_type":"c3","uid":1077573,"ip_address":"","ucode":"D5B8609CDFB145","user_header":"https://static001.geekbang.org/account/avatar/00/10/71/45/126cd913.jpg","comment_is_top":false,"comment_ctime":1574835804,"is_pvip":false,"replies":[{"id":60783,"content":"第一个match是过滤原始集合的数据。第二个是针对group之后的结果再次过滤掉员工数量大于等于10的，只保留小于10个员工的部门。 第二个match没法放到前面，因为emp_qty在原始集合里不存在，必须等group之后才可以。\n\n\nemp_qty: {$sum: 1}的意思是对group里面的每一条数据，值加1。 如果加2，自然结果就是两倍","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1575469868,"ip_address":"","comment_id":156203,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"老师能不能再讲讲第二个例子两个match的区别？另外emp_qty的sum设为1，是说要做sum操作，还是每次增加1？如果设为2那统计出来的是人数的两倍吗？","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476030,"discussion_content":"第一个match是过滤原始集合的数据。第二个是针对group之后的结果再次过滤掉员工数量大于等于10的，只保留小于10个员工的部门。 第二个match没法放到前面，因为emp_qty在原始集合里不存在，必须等group之后才可以。\n\n\nemp_qty: {$sum: 1}的意思是对group里面的每一条数据，值加1。 如果加2，自然结果就是两倍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575469868,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":64284,"discussion_content":"第一个match是对数据数据进行过滤，只取女性用户资料进行分析\n第二个match是对处理后的数据进行过滤（在输出前），只输出员工数小于10个人的结果\nsum:1 就是指加1，sum：2就是加2.","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1574944169,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":156201,"user_name":"袭","can_delete":false,"product_type":"c3","uid":1077573,"ip_address":"","ucode":"D5B8609CDFB145","user_header":"https://static001.geekbang.org/account/avatar/00/10/71/45/126cd913.jpg","comment_is_top":false,"comment_ctime":1574834987,"is_pvip":false,"replies":[{"id":60782,"content":"first_name要加美元符号，可以理解那是个变量, 实际的值要通过替换 first_name在文档中的具体值。\n\nfind()操作里面的用到的first_name只是个key。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1575469288,"ip_address":"","comment_id":156201,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"为什么在project里面，first_name前要加美元符号，在一般find里面不需要加？","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476029,"discussion_content":"first_name要加美元符号，可以理解那是个变量, 实际的值要通过替换 first_name在文档中的具体值。\n\nfind()操作里面的用到的first_name只是个key。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575469288,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1019332,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","nickname":"长期规划","note":"","ucode":"5EF65E9115834B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":70161,"discussion_content":"貌似有个规则，字段做键值对中的值（Value）时，会加$，用于说明它不是普通字符串；而做键（Key）时不加$","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1575333944,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":158110,"user_name":"长期规划","can_delete":false,"product_type":"c3","uid":1019332,"ip_address":"","ucode":"5EF65E9115834B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","comment_is_top":false,"comment_ctime":1575334014,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"聚合功能很强大，可以用Pipeline实现很复杂功能，比SQL厉害","like_count":4},{"had_liked":false,"id":151147,"user_name":"蒋腾飞同学","can_delete":false,"product_type":"c3","uid":1645665,"ip_address":"","ucode":"AF72D93DDAC536","user_header":"https://static001.geekbang.org/account/avatar/00/19/1c/61/0ca1ca43.jpg","comment_is_top":false,"comment_ctime":1573658142,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"感觉python和mongodb很像，语法简洁～没有规则就是最好的规则？","like_count":3,"discussions":[{"author":{"id":1712028,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/1f/9c/0c7a1b3b.jpg","nickname":"VINS","note":"","ucode":"7ACA41D8AECE33","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":169233,"discussion_content":"话是这么说，但是到真正开发应用的时候还是得有规则，不然怎么会出现TypeScript这种轮子","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1581605126,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":151092,"user_name":"旺旺","can_delete":false,"product_type":"c3","uid":1159196,"ip_address":"","ucode":"FE2CF90F446BFB","user_header":"https://static001.geekbang.org/account/avatar/00/11/b0/1c/2e30eeb8.jpg","comment_is_top":false,"comment_ctime":1573652652,"is_pvip":false,"replies":null,"discussion_count":3,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"MongoDB的聚合功能真强大啊，真的是不知道。\n不过想请教老师，MongoDB的这种聚合功能，对数据量很大的时候，性能会不会很差，仍然有很好的性能表现吗？毕竟是json格式的，在聚合的时候，效率会不会很差啊","like_count":3,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":50293,"discussion_content":"量大的时候要注意调优了 - 聚合操作也有explain功能，看是否用到合适的索引，以及执行计划是否合理等。关于explain我们在后续章节会详细介绍。\n\n有一种常见的优化手段，Oracle/MySQL不太做得到的就是可以使用微分片（一个机器上部署多个分片）来提高聚合计算的并行能力。本来你只有一个数据库处理引擎来计算1亿条记录，我用10个微分片的话，我可以有10个处理引擎每个同时处理1000万，然后汇总结果数据。这个可以达到不错的性能提升效果。","likes_number":11,"is_delete":false,"is_hidden":false,"ctime":1573699930,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1103776,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d7/a0/15c82d8b.jpg","nickname":"Triton","note":"","ucode":"B6C7C2AEF2B649","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":52174,"discussion_content":"老师，如何做微分片会讲吗?","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1574001415,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":50293,"ip_address":"","group_id":0},"score":52174,"extra":""}]},{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"奕","note":"","ucode":"73CEA468CE70C3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":52163,"discussion_content":"聚合功能的性能是比较差的","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1574000513,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":289940,"user_name":"朱雯","can_delete":false,"product_type":"c3","uid":1035744,"ip_address":"","ucode":"064C45FBF6B51F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/cd/e0/c85bb948.jpg","comment_is_top":false,"comment_ctime":1619272363,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"哪里可以进行这个练习 ","like_count":1},{"had_liked":false,"id":237494,"user_name":"李英权","can_delete":false,"product_type":"c3","uid":1076081,"ip_address":"","ucode":"FECAC14A9C414B","user_header":"https://static001.geekbang.org/account/avatar/00/10/6b/71/e833b14a.jpg","comment_is_top":false,"comment_ctime":1595847209,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"唐老师，我目前遇到了复杂聚合查询耗时太长的问题：阿里云4核8g配置 数据量也不算大，只不过aggregation逻辑非常复杂，有很多project、group计算、子集合的unwind和filter计算，涉及数据十万条左右，执行时间5秒。\n加索引没有任何效果，阿里云的慢日志诊断 不支持这样的查询。","like_count":1,"discussions":[{"author":{"id":1076081,"avatar":"https://static001.geekbang.org/account/avatar/00/10/6b/71/e833b14a.jpg","nickname":"李英权","note":"","ucode":"FECAC14A9C414B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303076,"discussion_content":"找到原因了：复杂的聚合查询 一定要尽可能把所有的match放在在project投影之前，如果match出现在project之后 就无法享受索引加速了。\n当然 还需要根据match字段 创建对应的联合索引。 我刚刚把一个复杂查询优化了 就是把几个match提前了 然后建索引，查询耗时从5秒降到1秒","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1599129928,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":151356,"user_name":"fedwing","can_delete":false,"product_type":"c3","uid":1743661,"ip_address":"","ucode":"2DFF902FD190C7","user_header":"https://static001.geekbang.org/account/avatar/00/1a/9b/2d/f7fca208.jpg","comment_is_top":false,"comment_ctime":1573705776,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"请教下老师，后续会讲到mongo的同步，异步流程吗？还有是不是可以结合CURD或者其它指令来结合下源码介绍下mongo的工作流程！直接看源码，目前有点吃力，看的时候很多也不是很了解，或者老师有没有其它的资料可以帮助理解源码的！\n感谢😊","like_count":1,"discussions":[{"author":{"id":1288440,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a8/f8/5343414c.jpg","nickname":"边城","note":"","ucode":"18F5057C429080","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":50595,"discussion_content":"可以关注一下： MongoDB Change Stream。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573738044,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":151079,"user_name":"第一装甲集群司令克莱斯特","can_delete":false,"product_type":"c3","uid":1265707,"ip_address":"","ucode":"4E8FBB23AD860B","user_header":"https://static001.geekbang.org/account/avatar/00/13/50/2b/2344cdaa.jpg","comment_is_top":false,"comment_ctime":1573651264,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"及时雨，Mongo聚合操作对我的网关流量统计需求的实现大有裨益。","like_count":1,"discussions":[{"author":{"id":1661704,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","nickname":"丁丁历险记","note":"","ucode":"A43829E454C067","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":79323,"discussion_content":"基础不牢就拿着干项目。佩服\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576073232,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339949,"user_name":"TGL","can_delete":false,"product_type":"c3","uid":2946511,"ip_address":"","ucode":"1E581E441A2FA5","user_header":"https://static001.geekbang.org/account/avatar/00/2c/f5/cf/2202bf6b.jpg","comment_is_top":false,"comment_ctime":1648479530,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"老师 好，对于地理信息这块的应用聚合撒点MongoDB支持吗？","like_count":0},{"had_liked":false,"id":328502,"user_name":"Geek_e775ae","can_delete":false,"product_type":"c3","uid":2878546,"ip_address":"","ucode":"EBE3C9D3C6B08F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLNnyOVYibaw0rmQEMFoOwVvjecEQYXtOhVTlRPZ7UCrABnotVccp2SvwjImP1o5YKJmeKMLK37mVw/132","comment_is_top":false,"comment_ctime":1640756310,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"聚合操作有点像java的stream","like_count":0,"discussions":[{"author":{"id":1165671,"avatar":"https://static001.geekbang.org/account/avatar/00/11/c9/67/7d446501.jpg","nickname":"大展宏兔","note":"","ucode":"21E6001F29951B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576374,"discussion_content":"+1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655477598,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":194916,"user_name":"追忆似水年华","can_delete":false,"product_type":"c3","uid":1160192,"ip_address":"","ucode":"C1D7C0DD7E7411","user_header":"https://static001.geekbang.org/account/avatar/00/11/b4/00/661fb98d.jpg","comment_is_top":false,"comment_ctime":1585120646,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"这个聚合查询涨知识了，感觉很适合用来分析各种数据","like_count":0},{"had_liked":false,"id":191127,"user_name":"hellojd_gk","can_delete":false,"product_type":"c3","uid":1679543,"ip_address":"","ucode":"319AF4C1AD568D","user_header":"https://static001.geekbang.org/account/avatar/00/19/a0/b7/1327ae60.jpg","comment_is_top":false,"comment_ctime":1584747168,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"打卡，跟着敲代码到此","like_count":0},{"had_liked":false,"id":161660,"user_name":"小氘","can_delete":false,"product_type":"c3","uid":1622109,"ip_address":"","ucode":"DA55B9A02D9EE0","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erPMtAfnQdpx1yOZQ2ic7icqUs3tvibEjUXQMUXKiaakyuIho6k6vmdl46nrdWjXIjPIRg9Pmco00tR5w/132","comment_is_top":false,"comment_ctime":1576288740,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"管道和步骤让我想到了java中的Stream类，有中间操作和终端操作，Stream类就是想在java中实现数据库的聚合操作。","like_count":0},{"had_liked":false,"id":151629,"user_name":"石头","can_delete":false,"product_type":"c3","uid":1309514,"ip_address":"","ucode":"84B38EA38106C5","user_header":"https://static001.geekbang.org/account/avatar/00/13/fb/4a/05ed55bc.jpg","comment_is_top":false,"comment_ctime":1573767176,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"比sql语句复杂","like_count":0}]}