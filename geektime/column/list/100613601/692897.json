{"id":692897,"title":"06ï½œç±»åŠ è½½å­ç³»ç»Ÿ ï¼ˆä¸Šï¼‰ï¼šç±»åŠ è½½çš„æµç¨‹ä¸æœºåˆ¶","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯åº·æ¨ã€‚ä»Šå¤©è¿™èŠ‚è¯¾æˆ‘ä»¬æ¥èŠèŠJVMä¸­çš„ç±»åŠ è½½æµç¨‹å’Œæœºåˆ¶ã€‚</p><p>ç±»åŠ è½½å­ç³»ç»Ÿå¯ä»¥çœ‹ä½œæ˜¯JVMçš„æ¬è¿å·¥ã€‚é€šè¿‡ä½¿ç”¨Javacç¼–è¯‘å™¨ï¼Œæˆ‘ä»¬å°†ç¼–å†™çš„ä»£ç è½¬æ¢ä¸º.classæ–‡ä»¶ï¼Œè¿™æ ·ç±»å°±å¯ä»¥è¢«çœŸæ­£åœ°åŠ è½½åˆ°JVMä¸­ï¼Œä»è€Œå®ç°é«˜æ•ˆåœ°è¿è¡Œã€‚å€ŸåŠ©ç±»åŠ è½½æµç¨‹ï¼Œæˆ‘ä»¬å°†.classæ–‡ä»¶ä¸­çš„æ•°æ®ç»“æ„å­˜å‚¨åˆ°äº†è¿è¡Œæ—¶çš„æ–¹æ³•åŒºä¸­ï¼Œä½œä¸ºåç»­Javaç¨‹åºè¿è¡Œçš„åŸºç¡€ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f1/7d/f1aa64de1628a3ec678fb573c336007d.png?wh=1920x635\" alt=\"å›¾ç‰‡\"></p><h2>æ–¹æ³•åŒº</h2><p>è¿™é‡Œçš„æ–¹æ³•åŒºå…¶å®æ˜¯ä¸€ä¸ªé€»è¾‘ç©ºé—´çš„æ¦‚å¿µï¼Œå¹¶ä¸æ˜¯çœŸå®çš„ç‰©ç†ç©ºé—´ã€‚</p><p>å› ä¸ºåœ¨ JDK 7 ä¹‹å‰ï¼Œæ–¹æ³•åŒºä¹Ÿè¢«ç§°ä¸ºæ°¸ä¹…ä»£ï¼ˆPermGenï¼‰ï¼Œä½œä¸ºå †å†…å­˜çš„ä¸€éƒ¨åˆ†åˆ†é…ã€‚ç”±äºåœ¨æŸäº›åœºæ™¯ä¸‹å¯èƒ½å¯¼è‡´æ°¸ä¹…ä»£å†…å­˜æº¢å‡ºï¼Œå› æ­¤åç»­ç‰ˆæœ¬çš„ JVM å¯¹å…¶è¿›è¡Œäº†ä¼˜åŒ–ã€‚ åˆ°äº†JDK 8ï¼Œæ–¹æ³•åŒºçš„æ¦‚å¿µç»è¿‡æ”¹è¿›ï¼Œä¸å†å«åšæ°¸ä¹…ä»£ï¼Œè€Œæ˜¯æ”¹ä¸ºå…ƒç©ºé—´ï¼ˆMetaspaceï¼‰ã€‚</p><p>æ–¹æ³•åŒºåŒ…å«4ç±»ä¿¡æ¯ã€‚</p><ol>\n<li>ç±»çš„å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬ç±»çš„ç»“æ„ä¿¡æ¯ã€è®¿é—®æƒé™ã€å­—æ®µå’Œæ–¹æ³•ç­‰ã€‚</li>\n<li>é™æ€å˜é‡ï¼Œç±»çš„é™æ€å˜é‡ï¼Œå³åœ¨ç±»çº§åˆ«å…±äº«çš„å˜é‡ã€‚</li>\n<li>ç±»çš„æ–¹æ³•ä¿¡æ¯ã€æ„é€ å‡½æ•°ã€‚</li>\n<li>æœ€åæ˜¯è¿è¡Œæ—¶å¸¸é‡æ± ï¼Œå®ƒæ˜¯ä¸€ç§å­˜å‚¨ç¼–è¯‘æ—¶å¸¸é‡å’Œå¼•ç”¨çš„æ•°æ®ç»“æ„ï¼Œä¸»è¦åŒ…æ‹¬å­—ç¬¦ä¸²å¸¸é‡ã€æ•°å€¼å¸¸é‡ã€ç±»å¼•ç”¨ã€å­—æ®µå¼•ç”¨ã€æ–¹æ³•å¼•ç”¨ç­‰ã€‚è¿è¡Œæ—¶å¸¸é‡æ± åœ¨ç±»è¢«åŠ è½½æ—¶è‡ªåŠ¨åˆ›å»ºï¼Œå¹¶åœ¨è¿è¡Œæ—¶è¢« JVM ä½¿ç”¨ã€‚</li>\n</ol><p>å› ä¸ºæ–¹æ³•åŒºé‡Œå­˜å‚¨äº†ç±»çš„å…ƒæ•°æ®å’Œé™æ€å˜é‡ç­‰ï¼Œæ‰€ä»¥å¹³æ—¶åœ¨å¼€å‘çš„æ—¶å€™ä½ éœ€è¦å…³æ³¨æ–¹æ³•åŒºçš„å†…å­˜ä½¿ç”¨ï¼Œé¿å…å¤§é‡åŠ è½½ç±»ä»¥åŠå®šä¹‰è¿‡å¤šçš„é™æ€å˜é‡å¯¼è‡´å†…å­˜ä¸è¶³ã€‚æœ€åè¿˜è¦é¿å…ç±»åˆå§‹åŒ–çš„å¾ªç¯å¼•ç”¨ï¼Œåˆ›å»ºç±»æ—¶ï¼Œç¡®ä¿ç±»ä¹‹é—´çš„å¼•ç”¨å…³ç³»æ²¡æœ‰å¾ªç¯ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´ç±»åˆå§‹åŒ–é˜»å¡ã€‚</p><!-- [[[read_end]]] --><p>ä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„Java ä»£ç è·å–æ–¹æ³•åŒºçš„å†…å­˜ä½¿ç”¨æƒ…å†µåŠå…ƒç©ºé—´ä¿¡æ¯ã€‚</p><pre><code class=\"language-java\">public class MethodAreaExample {\n&nbsp;&nbsp;&nbsp; public static void main(String[] args) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MemoryMXBean memoryMXBean = ManagementFactory.getMemoryMXBean();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MemoryUsage nonHeapMemoryUsage = memoryMXBean.getNonHeapMemoryUsage();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MemoryPoolMXBean metaspaceMemoryPoolBean = null;\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for (MemoryPoolMXBean memoryPoolBean : ManagementFactory.getMemoryPoolMXBeans()) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (\"Metaspace\".equals(memoryPoolBean.getName())) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; metaspaceMemoryPoolBean = memoryPoolBean;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; break;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(\"æ–¹æ³•åŒºï¼ˆå…ƒç©ºé—´ï¼‰ä¿¡æ¯ï¼š\");\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(\"æ–¹æ³•åŒºï¼ˆå…ƒç©ºé—´ï¼‰åˆå§‹å¤§å°: \" + nonHeapMemoryUsage.getInit() / 1024 + \"KB\");\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(\"æ–¹æ³•åŒºï¼ˆå…ƒç©ºé—´ï¼‰æœ€å¤§å¤§å°: \" + (nonHeapMemoryUsage.getMax() == -1 ? \"æ— é™åˆ¶\" : nonHeapMemoryUsage.getMax() / 1024 + \"KB\"));\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(\"æ–¹æ³•åŒºï¼ˆå…ƒç©ºé—´ï¼‰å·²ç”¨å¤§å°: \" + nonHeapMemoryUsage.getUsed() / 1024 + \"KB\");\n&nbsp;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (metaspaceMemoryPoolBean != null) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(\"\\nMetaspace ä¿¡æ¯ï¼š\");\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; MemoryUsage metaspaceMemoryUsage = metaspaceMemoryPoolBean.getUsage();\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(\"Metaspace åˆå§‹å¤§å°: \" + metaspaceMemoryUsage.getInit() / 1024 + \"KB\");\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(\"Metaspace æœ€å¤§å¤§å°: \" + (metaspaceMemoryUsage.getMax() == -1 ? \"æ— é™åˆ¶\" : metaspaceMemoryUsage.getMax() / 1024 + \"KB\"));\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; System.out.println(\"Metaspace å·²ç”¨å¤§å°: \" + metaspaceMemoryUsage.getUsed() / 1024 + \"KB\");\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }\n&nbsp;&nbsp;&nbsp; }\n}\n</code></pre><p>ç»“æœè¾“å‡ºå¦‚ä¸‹ï¼š</p><pre><code class=\"language-java\">æ–¹æ³•åŒºï¼ˆå…ƒç©ºé—´ï¼‰ä¿¡æ¯ï¼š\næ–¹æ³•åŒºï¼ˆå…ƒç©ºé—´ï¼‰åˆå§‹å¤§å°: 2496KB\næ–¹æ³•åŒºï¼ˆå…ƒç©ºé—´ï¼‰æœ€å¤§å¤§å°: æ— é™åˆ¶\næ–¹æ³•åŒºï¼ˆå…ƒç©ºé—´ï¼‰å·²ç”¨å¤§å°: 4606KB\n&nbsp;\nMetaspace ä¿¡æ¯ï¼š\nMetaspace åˆå§‹å¤§å°: 0KB\nMetaspace æœ€å¤§å¤§å°: æ— é™åˆ¶\nMetaspace å·²ç”¨å¤§å°: 3225KB\n</code></pre><h2>ç±»åŠ è½½æ—¶æœº</h2><p>JVMç±»åŠ è½½çš„æ—¶æœºä¸»è¦åŸºäº<strong>é¦–æ¬¡ä¸»åŠ¨ä½¿ç”¨</strong>çš„åŸåˆ™ï¼Œâ€œé¦–æ¬¡â€æ¶‰åŠå¤šç§ä¸åŒçš„æƒ…å†µï¼Œæ¯”å¦‚æ„é€ ä¸€ä¸ªæ–°çš„å®ä¾‹ã€æŸ¥è¯¢ä¸€ä¸ªæ–°çš„å˜é‡ã€è°ƒç”¨ä¸€ä¸ªæ–°çš„æ–¹æ³•ç­‰ã€‚JVMè§„èŒƒå…è®¸ç±»åŠ è½½å™¨é¢„åˆ¤åˆ°æŸä¸ªç±»å¯èƒ½é©¬ä¸Šä¼šè¢«ä½¿ç”¨ï¼Œè€Œé€‰æ‹©æå‰åŠ è½½ã€‚</p><p>è¿™ç§è®¾è®¡ä¸»è¦æ˜¯ä¸ºäº†æå‡ç³»ç»Ÿçš„æ€§èƒ½å’Œæ•ˆç‡ï¼Œå› ä¸ºåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„ç±»éƒ½ä¼šè¢«ä½¿ç”¨ï¼Œå¦‚æœæå‰åŠ è½½æ‰€æœ‰çš„ç±»ï¼Œä¸ä»…ä¼šå»¶é•¿åŠ è½½æ—¶é—´ï¼Œä¹Ÿä¼šæµªè´¹ç³»ç»Ÿèµ„æºã€‚é€šè¿‡å»¶è¿ŸåŠ è½½ï¼Œå¯ä»¥æœ‰æ•ˆèŠ‚çœç³»ç»Ÿèµ„æºï¼Œæé«˜ç¨‹åºå“åº”é€Ÿåº¦ã€‚åŒæ—¶ï¼Œè¿™ç§ç­–ç•¥ä¹Ÿé¿å…äº†å› ç¨‹åºé”™è¯¯è€Œå¯¼è‡´çš„ç³»ç»Ÿå´©æºƒï¼Œå¢å¼ºäº†ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¥å£®æ€§ã€‚</p><h2>.classæ–‡ä»¶åŠ è½½æ–¹å¼</h2><p>JVMåŠ è½½.classæ–‡ä»¶çš„æ–¹å¼éå¸¸çµæ´»ï¼Œå¯ä»¥æ ¹æ®åº”ç”¨ç¨‹åºçš„å®é™…éœ€è¦å’Œè¿è¡Œç¯å¢ƒè¿›è¡Œé€‰æ‹©ã€‚æ¯”å¦‚æˆ‘ä»¬å¯ä»¥ä»æœ¬åœ°ç³»ç»Ÿé‡Œç›´æ¥åŠ è½½ï¼Œè¿™æ˜¯æœ€åŸºæœ¬çš„åŠ è½½æ–¹å¼ï¼Œç±»åŠ è½½å™¨ä»æœ¬åœ°ç³»ç»Ÿç›´æ¥è¯»å–éœ€è¦åŠ è½½çš„.classæ–‡ä»¶ï¼›ä¹Ÿå¯ä»¥é€šè¿‡ç½‘ç»œä¸‹è½½.classæ–‡ä»¶ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œç±»åŠ è½½å™¨å¯ä»¥ä»ç½‘ç»œä¸­è·å–.classæ–‡ä»¶ã€‚é€šè¿‡ä½¿ç”¨zipã€jarç­‰å½’æ¡£æ–‡ä»¶å’Œä¸“ç”¨çš„æ•°æ®åº“ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾è·å¾—.classæ–‡ä»¶ï¼Œå¹¶ä¸”å¯ä»¥æŠŠJavaæºæ–‡ä»¶åŠ¨æ€ç¼–è¯‘æˆç±»æ–‡ä»¶ï¼Œä»¥ä¾¿åœ¨ç³»ç»Ÿä¸­å¿«é€Ÿè®¿é—®å’Œä½¿ç”¨ã€‚</p><p>äº†è§£è¿™äº›åŠ è½½æ–¹å¼æœ‰åŠ©äºæˆ‘ä»¬æ›´å¥½åœ°ç†è§£Javaç¨‹åºçš„è¿è¡Œæœºåˆ¶ï¼Œå¹¶åœ¨å®è·µä¸­åšå‡ºåˆé€‚çš„æŠ€æœ¯é€‰å‹ã€‚</p><h2>ç±»åŠ è½½å…¨æµç¨‹</h2><p>ç±»åŠ è½½ä¸»è¦åˆ†ä¸ºåŠ è½½ã€è¿æ¥ã€åˆå§‹åŒ–ä¸‰ä¸ªæ­¥éª¤ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/39/cc/398c340be2b9b1db2d44bfae86e51ccc.png?wh=1920x434\" alt=\"å›¾ç‰‡\"></p><p>ä¸‹é¢æˆ‘ä»¬å°±æ¥è¯¦ç»†èŠä¸‹å…·ä½“çš„æµç¨‹ã€‚</p><h3>åŠ è½½</h3><p>åœ¨JVMä¸­ï¼Œç±»åŠ è½½æ˜¯æŒ‡æŠŠç±»çš„äºŒè¿›åˆ¶æ•°æ®åŠ è½½åˆ°å†…å­˜é‡Œçš„è¿‡ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼šæŸ¥æ‰¾ã€è½¬åŒ–å’Œç”Ÿæˆã€‚</p><h4>æŸ¥æ‰¾</h4><p>JVMåœ¨åŠ è½½é˜¶æ®µçš„ç¬¬ä¸€æ­¥å°±æ˜¯é€šè¿‡ä¸€ç»„é¢„å…ˆå®šä¹‰çš„ç±»åŠ è½½å™¨è¿›è¡Œç±»çš„æŸ¥æ‰¾ï¼Œå®ƒä»¬å¯ä»¥æ˜¯ç”±ç³»ç»Ÿæä¾›çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ç”¨æˆ·è‡ªå·±åˆ›å»ºçš„ï¼Œå®ƒä»¬èƒ½å¤Ÿå¸®åŠ©ç”¨æˆ·å¿«é€Ÿã€å‡†ç¡®åœ°æœç´¢åˆ°æ‰€éœ€çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼Œä»è€Œå®ç°ç±»çš„æŸ¥æ‰¾ã€‚</p><h4>è½¬åŒ–</h4><p>JVMåœ¨æ”¶é›†åˆ°ç±»çš„äºŒè¿›åˆ¶ä¿¡æ¯ä¹‹åï¼Œå¿…é¡»æŠŠè¿™äº›ä¿¡æ¯è½¬æ¢æˆä¸€ç§å¯ä»¥åœ¨ä»»ä½•æƒ…å†µä¸‹æ‰§è¡Œçš„å®ä½“æ¨¡å‹ã€‚åœ¨è¿™ä¸ªè½¬åŒ–è¿‡ç¨‹ä¸­ï¼ŒJVMå°†å­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬æ¢æˆæ–¹æ³•åŒºé‡Œçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ï¼Œä¹Ÿå°±æ˜¯ç±»çš„ä¿¡æ¯ã€é™æ€å˜é‡ã€å¸¸é‡ç­‰æ•°æ®ï¼Œä»¥ä¾¿åç»­æ‰§è¡Œå’Œè®¿é—®ã€‚</p><h4>ç”Ÿæˆ</h4><p>JVMå°†ä¸€ä¸ªç‰¹å®šçš„java.lang.Classæ˜ å°„åˆ°Javaå †ï¼Œä»¥æ­¤æ¥æä¾›ä¸€ä¸ªå¯ä»¥è®¿é—®è¿™ä¸ªç±»çš„å…¥å£ã€‚åœ¨è¿™ä¸ªé˜¶æ®µï¼Œç¨‹åºçš„å¯æ“ä½œæ€§è¾¾åˆ°äº†é¡¶å³°ï¼Œä½ ä¸ä»…èƒ½å¤Ÿåˆ©ç”¨å·²æœ‰çš„ç±»åŠ è½½å™¨ï¼Œè¿˜èƒ½å¤Ÿæ ¹æ®éœ€è¦ä½¿ç”¨è‡ªå·±å®šä¹‰çš„ç±»åŠ è½½å™¨å®ŒæˆåŠ è½½ã€‚ä¸‹ä¸€èŠ‚è¯¾ï¼Œæˆ‘ä¼šå¸¦ä½ æ‰“é€ ä¸€ä¸ªè‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ã€‚</p><h3>è¿æ¥é˜¶æ®µ</h3><p>è¿æ¥é˜¶æ®µä¹Ÿåˆ†ä¸º3æ­¥ï¼Œåˆ†åˆ«ä¸ºéªŒè¯é˜¶æ®µã€å‡†å¤‡é˜¶æ®µå’Œè§£æé˜¶æ®µã€‚</p><h4>éªŒè¯é˜¶æ®µ</h4><p>éªŒè¯æ˜¯ç±»åŠ è½½è¿‡ç¨‹ä¸­è‡³å…³é‡è¦çš„ä¸€æ­¥ï¼Œç›®çš„æ˜¯ç¡®ä¿è¢«åŠ è½½çš„ç±»èƒ½å¤Ÿæ»¡è¶³è™šæ‹Ÿæœºçš„éœ€æ±‚ï¼Œå¹¶ä¸”ä¸ä¼šå¯¹è™šæ‹Ÿæœºçš„å®‰å…¨é€ æˆä»»ä½•å¨èƒã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸ºäº†ç¡®ä¿ç±»çš„å‡†ç¡®æ€§å’Œå®Œæ•´æ€§ï¼ŒéªŒè¯è¿‡ç¨‹åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ã€‚</p><p>é¦–å…ˆ<strong>JVMä¼šå¯¹å­—èŠ‚æµè¿›è¡Œä¸¥æ ¼åœ°æ–‡æ¡£æ£€æŸ¥</strong>ï¼Œç¡®ä¿å®ƒä»¬éµå¾ªClassçš„æ ‡å‡†ã€‚ä¾‹å¦‚ï¼Œå­—èŠ‚æµçš„èµ·å§‹ä½ç½®å¿…é¡»æ˜¯0xCAFEBABEï¼Œè€Œä¸”å®ƒä»¬çš„ç‰ˆæœ¬åºåˆ—å¿…é¡»å’Œå½“å‰çš„VMç›¸åŒ¹é…ã€‚</p><p>åœ¨è¿™ä¸ªæ­¥éª¤ä¸­ï¼Œ<strong>JVMä¼šé€šè¿‡è¯­ä¹‰åˆ†ææ¥ç¡®ä¿å­—èŠ‚ç é‡Œçš„å†…å®¹å’ŒJavaè¯­è¨€çš„æ ‡å‡†ä¸€è‡´</strong>ã€‚ä¾‹å¦‚ï¼Œå®ƒå°†æ£€æŸ¥ä¸€ä¸ªç±»çš„çˆ¶ç±»æ˜¯å¦æ­£ç¡®ï¼Œè¿˜æœ‰å®ƒæ˜¯å¦å…·å¤‡Javaè¯­è¨€çš„æ ‡å‡†ã€‚</p><p>åœ¨<strong>å­—èŠ‚ç éªŒè¯</strong>çš„æ­¥éª¤ä¸­ï¼Œè™šæ‹Ÿæœºå°†æ·±å…¥ç ”ç©¶æ•°æ®æµå’Œæ§åˆ¶æµï¼Œä»¥ä¾¿å‡†ç¡®åœ°è¯†åˆ«å‡ºç¨‹åºçš„æ­£å½“æ€§ã€å¯é æ€§ä»¥åŠå¯è¡Œæ€§ã€‚è¿™ä¸ªé˜¶æ®µä¸»è¦æ˜¯å¯¹å­—èŠ‚ç è¿›è¡Œé™æ€åˆ†æï¼Œç¡®ä¿ç¨‹åºçš„å¤„ç†é€»è¾‘æ˜¯æ­£ç¡®çš„ã€‚</p><p>åœ¨<strong>ç¬¦å·å¼•ç”¨éªŒè¯</strong>é˜¶æ®µï¼ŒJVMå°†æ£€æŸ¥å­—èŠ‚ç ä¸­çš„ç¬¦å·åç§°ï¼Œç¡®ä¿å®ƒä»¬èƒ½å¤Ÿè¢«æ­£ç¡®åœ°è§£æï¼Œä»è€Œç¡®ä¿ç±»ã€æ–¹æ³•å’Œæ–¹æ³•ä¹‹é—´çš„è°ƒç”¨å…³ç³»æ˜¯æ­£ç¡®çš„ï¼Œç¡®ä¿è§£æåŠ¨ä½œçš„å‡†ç¡®æ€§å’Œå¯é æ€§ã€‚</p><p>åœ¨éªŒè¯é˜¶æ®µï¼Œè™½ç„¶å¯ä»¥ç¡®ä¿è¢«åŠ è½½çš„ç±»çš„å‡†ç¡®æ€§ï¼Œä½†å¹¶ä¸æ˜¯å¿…éœ€çš„ã€‚ä¸ºäº†æ›´æœ‰æ•ˆåœ°å®Œæˆç±»çš„åŠ è½½ï¼Œå¯ä»¥é‡‡å–ä¸€äº›æªæ–½ï¼Œæ¯”å¦‚ä½¿ç”¨ <code>-Xverifynone</code> å‚æ•°ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆåœ°å‡å°‘è™šæ‹Ÿæœºçš„ç±»åŠ è½½æ—¶é—´ã€‚<strong>éªŒè¯é˜¶æ®µå¯¹ç¨‹åºçš„è¿è¡ŒæœŸæ²¡æœ‰ç›´æ¥å½±å“ï¼Œä½†å®ƒå¯¹äºè™šæ‹Ÿæœºçš„å®‰å…¨æ€§å’Œç¨³å®šæ€§å…·æœ‰é‡è¦æ„ä¹‰ã€‚</strong></p><h4>å‡†å¤‡é˜¶æ®µ</h4><p>è¿™ä¸ªé˜¶æ®µçš„ä»»åŠ¡æ˜¯ç»™ç±»ä¸­çš„é™æ€å˜é‡åˆ†é…ç©ºé—´ï¼Œå¹¶ä¸”è®¾ç½®ä¸€ä¸ªåˆå€¼ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šåœ¨JVMçš„æ–¹æ³•åŒºä¸­è¿›è¡Œï¼Œå…¶ä¸­æœ‰ä¸¤ç‚¹éå¸¸é‡è¦ã€‚</p><ol>\n<li>é™æ€å˜é‡ï¼Œåœ¨è¿™ä¸ªé˜¶æ®µä¼šè¿›è¡Œå†…å­˜çš„åˆ†é…ï¼Œæ„å‘³ç€è¿™ä¸ªå˜é‡æ˜¯å±äºæ•´ä¸ªç±»çš„ï¼Œä¸ä¾èµ–äºä»»ä½•å¯¹è±¡å®ä¾‹ã€‚ç„¶è€Œå¯¹äºå®ä¾‹å˜é‡æ¥è¯´ï¼Œå®ƒä»¬æ˜¯åœ¨åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ä¸­åœ¨Javaçš„å †å†…å­˜ä¸­åˆ†é…çš„ã€‚</li>\n<li>é™æ€å˜é‡çš„åˆå€¼é€šå¸¸ä¼šè¢«è®¾ç½®æˆè¿™ä¸ªæ•°æ®ç±»å‹çš„é»˜è®¤å€¼ï¼Œä¾‹å¦‚æ•´å‹çš„å€¼ï¼Œå®ƒä¼šè¢«åˆå§‹åŒ–ä¸º0ã€‚è€Œåœ¨Javaä»£ç ä¸­å®ƒå¯èƒ½è¢«æ˜¾å¼åœ°èµ‹äºˆäº†ä¸€ä¸ªä¸åŒçš„å€¼ã€‚</li>\n</ol><p><img src=\"https://static001.geekbang.org/resource/image/19/5f/1948118e55c67c5aa8928ee361f36b5f.png?wh=1920x1092\" alt=\"å›¾ç‰‡\"></p><h4>è§£æé˜¶æ®µ</h4><p>è§£æé˜¶æ®µæ˜¯JVMæŠŠç±»æ–‡ä»¶ä¸­çš„ç¬¦å·å¼•ç”¨æ”¹ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚ç¬¦å·å¼•ç”¨å°±æ˜¯ç¼–è¯‘é˜¶æ®µä½¿ç”¨çš„ä¸€å—æŒ‡ç¤ºç¬¦ï¼Œç”¨æ¥å®šä½å¼•ç”¨çš„ç›®æ ‡ã€‚è€Œç›´æ¥å¼•ç”¨åˆ™æ˜¯ä»¥æŒ‡é’ˆã€åç§»é‡æˆ–è€…å¥æŸ„çš„å½¢å¼ï¼Œç›´æ¥æŒ‡å‘ç›®æ ‡ã€‚</p><p>åœ¨è§£æé˜¶æ®µï¼ŒJVMä¼šå°†ç±»ä¸­çš„ç¬¦å·å¼•ç”¨è½¬æ¢æˆç›´æ¥å¼•ç”¨ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯åœ¨è¿è¡Œæ—¶ï¼ŒJVMå°±å¯ä»¥æ–¹ä¾¿åœ°è®¿é—®åˆ°å®é™…çš„å¯¹è±¡æˆ–è€…æ–¹æ³•ã€‚è¿™ä¸ªè¿‡ç¨‹è®©JVMèƒ½å¤Ÿå‡†ç¡®åœ°æ‰¾åˆ°ç±»ã€å­—æ®µå’Œæ–¹æ³•åœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼Œä»è€Œå®Œæˆç±»çš„åŠ è½½å’Œè¿æ¥æµç¨‹ã€‚</p><p>ç‰¹åˆ«å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<strong>ç¬¦å·å¼•ç”¨å’ŒJVMçš„å†…å­˜å¸ƒå±€æ— å…³ï¼Œè€Œç›´æ¥å¼•ç”¨åˆ™æ˜¯å’Œå†…å­˜å¸ƒå±€ç›¸å…³çš„ã€‚</strong>åŒä¸€ä¸ªç¬¦å·å¼•ç”¨åœ¨ä¸åŒçš„JVMå®ä¾‹ä¸­å¯èƒ½ä¼šå¯¹åº”ç€ä¸åŒçš„ç›´æ¥å¼•ç”¨ã€‚JVMåœ¨è§£æé˜¶æ®µæŠŠç¬¦å·å¼•ç”¨è½¬æ¢æˆå®é™…çš„å†…å­˜åœ°å€ï¼Œä½¿JVMèƒ½åœ¨è¿è¡Œé˜¶æ®µæ­£ç¡®åœ°è®¿é—®å’Œæ“ä½œç±»çš„æˆå‘˜ã€‚</p><h3>åˆå§‹åŒ–é˜¶æ®µ</h3><p>åœ¨JVMä¸­ï¼Œå½“æˆ‘ä»¬åœ¨ç‰¹å®šæƒ…æ™¯ä¸‹éœ€è¦åˆå§‹åŒ–ç±»æ—¶ï¼Œå°±ä¼šè¿›å…¥åˆå§‹åŒ–é˜¶æ®µã€‚åœ¨ç±»çš„åˆå§‹åŒ–é˜¶æ®µï¼ŒJVMä¼šæ‰§è¡Œç±»çš„åˆå§‹åŒ–ä»£ç ï¼Œå¹¶åŒæ­¥å¤šä¸ªçº¿ç¨‹å¯¹åŒä¸€ä¸ªç±»çš„åˆå§‹åŒ–ã€‚ç±»çš„é™æ€å˜é‡çš„åˆå§‹åŒ–å¯ä»¥åœ¨å£°æ˜æ—¶æŒ‡å®šåˆå§‹å€¼ï¼Œæˆ–è€…åœ¨é™æ€ä»£ç å—ä¸­è¿›è¡Œã€‚åˆå§‹åŒ–è¿‡ç¨‹ä¼šæŒ‰é¡ºåºæ‰§è¡Œåˆå§‹åŒ–è¯­å¥ï¼Œå¦‚æœç±»æˆ–å…¶çˆ¶ç±»è¿˜æœªåŠ è½½å’Œè¿æ¥ï¼Œåˆ™å…ˆè¿›è¡ŒåŠ è½½å’Œè¿æ¥ã€‚</p><h3>ç±»åŠ è½½ä¸­çš„é”æœºåˆ¶</h3><p>ç±»åœ¨åŠ è½½è¿‡ç¨‹ä¸­ï¼Œå…¶å®ä¹Ÿæ˜¯ä¼šåŠ é”çš„ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªæ—¥å¸¸å¾ˆå®¹æ˜“è¢«å¿½è§†çš„é—®é¢˜ã€‚ä¸ºäº†ç¡®ä¿ Java ç±»çš„å…¨å±€å”¯ä¸€æ€§å’Œçº¿ç¨‹å®‰å…¨ï¼Œç±»åŠ è½½å™¨åœ¨åŠ è½½ç±»çš„æ—¶å€™ä½¿ç”¨äº†é”æœºåˆ¶ã€‚å½“å¤šä¸ªçº¿ç¨‹å°è¯•åŒæ—¶åŠ è½½åŒä¸€ä¸ªç±»æ—¶ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è·å¾—ç±»åŠ è½½çš„é”ï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦ç­‰å¾…ï¼Œç›´åˆ°é‚£ä¸ªçº¿ç¨‹å®Œæˆç±»åŠ è½½æ“ä½œã€‚</p><p>ç±»åŠ è½½çš„é”å…·æœ‰è‰¯å¥½çš„æ€§èƒ½å’Œå¯é‡å…¥æ€§ï¼Œå› ä¸ºå®ƒæ˜¯åŸºäº ConcurrentHashMap æ¥å®ç°çš„ã€‚åœ¨ Java 7 ä¹‹å‰ï¼ŒåŠ è½½è¿‡ç¨‹æ˜¯åœ¨åŒä¸€ä¸ªé˜¶æ®µè·å–åˆ°é”ï¼Œè€Œåœ¨ Java 7 åŠä¹‹åçš„ç‰ˆæœ¬ä¸­ï¼Œé”çš„ç²’åº¦ç»†åŒ–åˆ°äº†æ¯ä¸ªåŠ è½½é˜¶æ®µï¼Œæé«˜äº†æ€§èƒ½ã€‚</p><h2>é‡ç‚¹å›é¡¾</h2><p>JVMçš„ç±»åŠ è½½æœºåˆ¶å°±åƒæ˜¯å°†ç±»æ–‡ä»¶æ¬è¿›JVMè¿è¡Œæ—¶çš„æ¬è¿å·¥ï¼Œé€šè¿‡åŠ è½½ã€è¿æ¥å’Œåˆå§‹åŒ–ç­‰é˜¶æ®µï¼Œç¡®ä¿ç±»å¯ä»¥è¢«æ­£å¸¸ä½¿ç”¨ï¼Œå¹¶æ‰§è¡ŒéªŒè¯ã€å‡†å¤‡å’Œè§£æç­‰æ“ä½œï¼Œä¿è¯ç¨‹åºçš„æ­£ç¡®æ€§å’Œå®‰å…¨æ€§ã€‚</p><p>æ–¹æ³•åŒºå­˜æ”¾äº†ç±»çš„ç»“æ„ä¿¡æ¯ã€å¸¸é‡æ± ä»¥åŠç±»ã€å®ä¾‹æ„é€ å‡½æ•°å’Œæ¥å£æ–¹æ³•çš„å­—èŠ‚ç æ–‡ä»¶ä¿¡æ¯ã€‚ç±»åŠ è½½æ—¶æœºæ˜¯åŸºäºâ€œé¦–æ¬¡ä¸»åŠ¨ä½¿ç”¨â€çš„åŸåˆ™ï¼Œåªæœ‰åœ¨éœ€è¦çš„æ—¶å€™æ‰ä¼šè¿›è¡Œç±»çš„åŠ è½½æ“ä½œï¼Œé¿å…æ€§èƒ½æµªè´¹ã€‚ç±»åŠ è½½å…¨æµç¨‹åŒ…æ‹¬åŠ è½½ã€è¿æ¥å’Œåˆå§‹åŒ–ä¸‰ä¸ªæ­¥éª¤ï¼Œå°†ç±»çš„äºŒè¿›åˆ¶æ•°æ®è½¬åŒ–ä¸ºå¯æ‰§è¡Œçš„å®ä½“ï¼Œå¹¶ç”Ÿæˆç›¸å…³çš„Classå¯¹è±¡ï¼Œè€Œè¿™ä¸ªClasså¯¹è±¡ä¹Ÿæ˜¯åé¢æˆ‘ä»¬è¦å­¦ä¹ çš„åå°„çš„åŸºç¡€ã€‚ç±»åŠ è½½ä¸­çš„é”æœºåˆ¶ç¡®ä¿äº†ç±»çš„å…¨å±€å”¯ä¸€æ€§å’Œçº¿ç¨‹å®‰å…¨æ€§ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>ç±»åŠ è½½çš„å®é™…æµç¨‹æœ‰å“ªäº›ï¼Ÿåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šæ‰§è¡Œç±»çš„åˆå§‹åŒ–åŠ¨ä½œï¼Ÿæ¬¢è¿ä½ æŠŠæ€è€ƒåçš„ç»“æœåˆ†äº«åˆ°è¯„è®ºåŒºï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾çš„å†…å®¹åˆ†äº«ç»™å…¶ä»–æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p><h2>ğŸ’¡ç‚¹äº®ä½ çš„çŸ¥è¯†æ¡†æ¶å›¾</h2><p><img src=\"https://static001.geekbang.org/resource/image/66/eb/6603b0ab207a196c7f7118f1f77207eb.jpg?wh=5430x3900\" alt=\"å›¾ç‰‡\"></p>","comments":[{"had_liked":false,"id":380864,"user_name":"on","can_delete":false,"product_type":"c1","uid":2869085,"ip_address":"ä¸Šæµ·","ucode":"D0B59D9F0FC209","user_header":"https://static001.geekbang.org/account/avatar/00/2b/c7/5d/40bdba38.jpg","comment_is_top":false,"comment_ctime":1694336437,"is_pvip":true,"replies":[{"id":139137,"content":"åœ¨ Java 8 åŠä»¥åç‰ˆæœ¬ä¸­ï¼ŒHotSpot JVM å·²ç»å…¨é¢åºŸå¼ƒåŸå…ˆçš„æ°¸ä¹…ä»£ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰ï¼Œæ­¤ä¸¾ä¸»è¦æ˜¯ä¸ºäº†å…‹æœæ°¸ä¹…ä»£å†…å­˜ç©ºé—´å®¹æ˜“å‡ºç°çš„æº¢å‡ºé—®é¢˜ã€‚ä¸€ä¸ªæ˜¯é€»è¾‘æ¦‚å¿µï¼Œä¸€ä¸ªæ˜¯å®é™…ç‰©ç†ç©ºé—´æ¦‚å¿µ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1366588,"ctime":1696515735,"ip_address":"åŒ—äº¬","comment_id":380864,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100613601,"comment_content":"æ–¹æ³•åŒºä¸å°±æ˜¯ç›´æ¥å˜ä¸ºäº†metaspaceï¼Ÿä¸ºå•¥ä»£ç ç¤ºä¾‹è¿˜æ˜¯ä¸¤å—ï¼Œæ–¹æ³•åŒºå’Œmetaspaceï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1366588,"avatar":"https://static001.geekbang.org/account/avatar/00/14/da/3c/6ca50139.jpg","nickname":"Arthur king å¾®ä¿¡è¶…ç´šæœƒå“¡","note":"","ucode":"79637F55F0ED85","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":629021,"discussion_content":"åœ¨ Java 8 åŠä»¥åç‰ˆæœ¬ä¸­ï¼ŒHotSpot JVM å·²ç»å…¨é¢åºŸå¼ƒåŸå…ˆçš„æ°¸ä¹…ä»£ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰ï¼Œæ­¤ä¸¾ä¸»è¦æ˜¯ä¸ºäº†å…‹æœæ°¸ä¹…ä»£å†…å­˜ç©ºé—´å®¹æ˜“å‡ºç°çš„æº¢å‡ºé—®é¢˜ã€‚ä¸€ä¸ªæ˜¯é€»è¾‘æ¦‚å¿µï¼Œä¸€ä¸ªæ˜¯å®é™…ç‰©ç†ç©ºé—´æ¦‚å¿µ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1696515735,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":380664,"user_name":"^_^","can_delete":false,"product_type":"c1","uid":1682012,"ip_address":"åŒ—äº¬","ucode":"05E7C6F1DD6E77","user_header":"https://static001.geekbang.org/account/avatar/00/19/aa/5c/d2c1c7ce.jpg","comment_is_top":false,"comment_ctime":1693970411,"is_pvip":false,"replies":[{"id":138616,"content":"åé¢çš„ç« èŠ‚å¯¹è¿™éƒ¨åˆ†æœ‰è¯¦ç»†çš„ä»‹ç»ï¼Œå¯ä»¥å…³æ³¨ä¸‹ï¼Œæœ€æ™šåº”è¯¥ä¸‹å‘¨æ›´æ–°å°±èƒ½çœ‹åˆ°äº†","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1366588,"ctime":1694069209,"ip_address":"åŒ—äº¬","comment_id":380664,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100613601,"comment_content":"åˆå§‹åŒ–åŒ…æ‹¬ä¸¤ä¸ªæ–¹é¢ï¼šä¸€æ˜¯ä¸ºå¯¹è±¡çš„å®ä¾‹å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®é»˜è®¤åˆå§‹å€¼ï¼ŒäºŒæ˜¯æ‰§è¡Œå¯¹è±¡çš„æ„é€ æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ã€‚è¿™å—åˆå§‹åŒ–èƒ½å¦è¯¦ç»†è®²è®²ä¸€ä¸‹","like_count":0,"discussions":[{"author":{"id":1366588,"avatar":"https://static001.geekbang.org/account/avatar/00/14/da/3c/6ca50139.jpg","nickname":"Arthur king å¾®ä¿¡è¶…ç´šæœƒå“¡","note":"","ucode":"79637F55F0ED85","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":627379,"discussion_content":"åé¢çš„ç« èŠ‚å¯¹è¿™éƒ¨åˆ†æœ‰è¯¦ç»†çš„ä»‹ç»ï¼Œå¯ä»¥å…³æ³¨ä¸‹ï¼Œæœ€æ™šåº”è¯¥ä¸‹å‘¨æ›´æ–°å°±èƒ½çœ‹åˆ°äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1694069210,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":380560,"user_name":"éƒ­åˆš","can_delete":false,"product_type":"c1","uid":1292032,"ip_address":"å¹¿ä¸œ","ucode":"22CB8ECE8E3DCA","user_header":"https://static001.geekbang.org/account/avatar/00/13/b7/00/12149f4e.jpg","comment_is_top":false,"comment_ctime":1693820279,"is_pvip":false,"replies":[{"id":139153,"content":"å½“å‡ºç°ç©ºé—´å†…å­˜æº¢å‡ºæ—¶ï¼Œå¤šåŠæƒ…å†µä¸‹éƒ½æ˜¯ç”±äºç¨‹åºä¸­å­˜åœ¨ä¸€äº›æ— æ³•è¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼Œå®ƒä»¬ä¸€ç›´å ç”¨ç€å†…å­˜ï¼Œé€ æˆäº†å†…å­˜æº¢å‡ºã€‚è¯Šæ–­è¯¥é—®é¢˜ï¼Œæ­¥éª¤å¯èƒ½åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š\n1. æŸ¥çœ‹é”™è¯¯å †æ ˆä¿¡æ¯ï¼šå½“å‘ç”Ÿå†…å­˜æº¢å‡ºé”™è¯¯æ—¶ï¼Œå †æ ˆä¿¡æ¯å°†è¢«æ‰“å°å‡ºæ¥ã€‚è¿™å¯ä»¥ä¸ºæˆ‘ä»¬æä¾›ä¸€äº›æœ‰ä»·å€¼çš„ä¿¡æ¯ï¼Œä¾‹å¦‚é”™è¯¯çš„ç±»å‹ã€ä½ç½®ç­‰ã€‚\n2. åˆ©ç”¨JVMæä¾›çš„å·¥å…·è¯Šæ–­é—®é¢˜ï¼šJVMæä¾›äº†ä¸€äº›å·¥å…·æ¥å¸®åŠ©æˆ‘ä»¬è¯Šæ–­å†…å­˜çš„é—®é¢˜ã€‚è¿™åŒ…æ‹¬jmapå‘½ä»¤ã€jhatå‘½ä»¤ã€VisualVMå·¥å…·ç­‰ç­‰ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™äº›å·¥å…·æŸ¥çœ‹å †å†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œæ‰¾å‡ºå“ªäº›å¯¹è±¡å¯¼è‡´äº†å†…å­˜æº¢å‡ºã€‚\n3. ä½¿ç”¨å†…å­˜åˆ†æå·¥å…·ï¼šå­˜åœ¨å¾ˆå¤šç¬¬ä¸‰æ–¹çš„åˆ†æå·¥å…·ï¼Œå¦‚Eclipse Memory Analyzer (MAT)ç­‰ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æŸ¥çœ‹å†…å­˜çš„åˆ†å¸ƒæƒ…å†µï¼Œå®šä½å¯èƒ½çš„å†…å­˜æ³„æ¼ç‚¹ã€‚  \n4. Dumpå†…å­˜å¿«ç…§ï¼šå½“å†…å­˜æº¢å‡ºå‘ç”Ÿæ—¶ï¼Œå¯ä»¥ç”Ÿæˆheap dumpï¼Œç„¶åç”¨åˆ†æå·¥å…·è¿›è¡Œåˆ†æã€‚è¿™æ ·ä¸€èˆ¬å¯ä»¥æ‰¾åˆ°é‚£äº›æœ€å å†…å­˜çš„å¯¹è±¡ï¼Œè¿›ä¸€æ­¥åˆ†æä¸ºä»€ä¹ˆå®ƒä»¬ä¼šå ç”¨è¿™ä¹ˆå¤šå†…å­˜ã€‚\n5. ä»£ç å®¡æŸ¥ï¼šå¦‚æœä»¥ä¸Šæ­¥éª¤éƒ½æ— æ³•æ‰¾åˆ°é—®é¢˜ï¼Œå¯èƒ½éœ€è¦è¿›è¡Œä»£ç å®¡æŸ¥ï¼Œçœ‹ä»£ç é€»è¾‘æ˜¯å¦æœ‰å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºã€‚\næ€»çš„æ¥è¯´ï¼Œè¦è¯Šæ–­å’Œè§£å†³è¯¥é—®é¢˜ï¼Œå°±éœ€è¦äº†è§£JVMçš„å·¥ä½œåŸç†å’Œä½¿ç”¨ç›¸å…³çš„è¯Šæ–­å·¥å…·ã€‚åŒæ—¶ï¼Œå¯¹ä»£ç çš„ç†Ÿæ‚‰ä¹Ÿèƒ½å¸®åŠ©æˆ‘ä»¬æ›´å¿«åœ°æ‰¾åˆ°é—®é¢˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1366588,"ctime":1696592166,"ip_address":"åŒ—äº¬","comment_id":380560,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100613601,"comment_content":"å…ƒç©ºé—´å†…å­˜æº¢å‡ºï¼Œæ€ä¹ˆè¯Šæ–­å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1366588,"avatar":"https://static001.geekbang.org/account/avatar/00/14/da/3c/6ca50139.jpg","nickname":"Arthur king å¾®ä¿¡è¶…ç´šæœƒå“¡","note":"","ucode":"79637F55F0ED85","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":629057,"discussion_content":"å½“å‡ºç°ç©ºé—´å†…å­˜æº¢å‡ºæ—¶ï¼Œå¤šåŠæƒ…å†µä¸‹éƒ½æ˜¯ç”±äºç¨‹åºä¸­å­˜åœ¨ä¸€äº›æ— æ³•è¢«åƒåœ¾å›æ”¶çš„å¯¹è±¡ï¼Œå®ƒä»¬ä¸€ç›´å ç”¨ç€å†…å­˜ï¼Œé€ æˆäº†å†…å­˜æº¢å‡ºã€‚è¯Šæ–­è¯¥é—®é¢˜ï¼Œæ­¥éª¤å¯èƒ½åŒ…æ‹¬ä»¥ä¸‹å‡ ç§ï¼š\n1. æŸ¥çœ‹é”™è¯¯å †æ ˆä¿¡æ¯ï¼šå½“å‘ç”Ÿå†…å­˜æº¢å‡ºé”™è¯¯æ—¶ï¼Œå †æ ˆä¿¡æ¯å°†è¢«æ‰“å°å‡ºæ¥ã€‚è¿™å¯ä»¥ä¸ºæˆ‘ä»¬æä¾›ä¸€äº›æœ‰ä»·å€¼çš„ä¿¡æ¯ï¼Œä¾‹å¦‚é”™è¯¯çš„ç±»å‹ã€ä½ç½®ç­‰ã€‚\n2. åˆ©ç”¨JVMæä¾›çš„å·¥å…·è¯Šæ–­é—®é¢˜ï¼šJVMæä¾›äº†ä¸€äº›å·¥å…·æ¥å¸®åŠ©æˆ‘ä»¬è¯Šæ–­å†…å­˜çš„é—®é¢˜ã€‚è¿™åŒ…æ‹¬jmapå‘½ä»¤ã€jhatå‘½ä»¤ã€VisualVMå·¥å…·ç­‰ç­‰ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™äº›å·¥å…·æŸ¥çœ‹å †å†…å­˜çš„ä½¿ç”¨æƒ…å†µï¼Œæ‰¾å‡ºå“ªäº›å¯¹è±¡å¯¼è‡´äº†å†…å­˜æº¢å‡ºã€‚\n3. ä½¿ç”¨å†…å­˜åˆ†æå·¥å…·ï¼šå­˜åœ¨å¾ˆå¤šç¬¬ä¸‰æ–¹çš„åˆ†æå·¥å…·ï¼Œå¦‚Eclipse Memory Analyzer (MAT)ç­‰ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬æŸ¥çœ‹å†…å­˜çš„åˆ†å¸ƒæƒ…å†µï¼Œå®šä½å¯èƒ½çš„å†…å­˜æ³„æ¼ç‚¹ã€‚  \n4. Dumpå†…å­˜å¿«ç…§ï¼šå½“å†…å­˜æº¢å‡ºå‘ç”Ÿæ—¶ï¼Œå¯ä»¥ç”Ÿæˆheap dumpï¼Œç„¶åç”¨åˆ†æå·¥å…·è¿›è¡Œåˆ†æã€‚è¿™æ ·ä¸€èˆ¬å¯ä»¥æ‰¾åˆ°é‚£äº›æœ€å å†…å­˜çš„å¯¹è±¡ï¼Œè¿›ä¸€æ­¥åˆ†æä¸ºä»€ä¹ˆå®ƒä»¬ä¼šå ç”¨è¿™ä¹ˆå¤šå†…å­˜ã€‚\n5. ä»£ç å®¡æŸ¥ï¼šå¦‚æœä»¥ä¸Šæ­¥éª¤éƒ½æ— æ³•æ‰¾åˆ°é—®é¢˜ï¼Œå¯èƒ½éœ€è¦è¿›è¡Œä»£ç å®¡æŸ¥ï¼Œçœ‹ä»£ç é€»è¾‘æ˜¯å¦æœ‰å¯èƒ½å¯¼è‡´å†…å­˜æº¢å‡ºã€‚\næ€»çš„æ¥è¯´ï¼Œè¦è¯Šæ–­å’Œè§£å†³è¯¥é—®é¢˜ï¼Œå°±éœ€è¦äº†è§£JVMçš„å·¥ä½œåŸç†å’Œä½¿ç”¨ç›¸å…³çš„è¯Šæ–­å·¥å…·ã€‚åŒæ—¶ï¼Œå¯¹ä»£ç çš„ç†Ÿæ‚‰ä¹Ÿèƒ½å¸®åŠ©æˆ‘ä»¬æ›´å¿«åœ°æ‰¾åˆ°é—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1696592166,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1195258,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3c/fa/e2990931.jpg","nickname":"æ–‡æ•¦å¤","note":"","ucode":"B8F4A6BD5D7805","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1366588,"avatar":"https://static001.geekbang.org/account/avatar/00/14/da/3c/6ca50139.jpg","nickname":"Arthur king å¾®ä¿¡è¶…ç´šæœƒå“¡","note":"","ucode":"79637F55F0ED85","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":635111,"discussion_content":"è¿™ä¸ªå›ç­”å¥½AI...\nå…ƒç©ºé—´åœ¨å †å¤–å§ã€‚ã€‚dumpå†…å­˜æ˜¯å †å†…å­˜ï¼Œå¯¹å †å¤–åˆ†ææœ‰ä»€ä¹ˆç›´æ¥æ•ˆæœï¼Ÿ\nå †å¤–çš„å†…å­˜æ³„éœ²ä¸å¥½æ’æŸ¥çš„æ„Ÿè§‰ï¼Œéœ€è¦ç”¨åˆ°åŸç”Ÿå·¥å…·ï¼Ÿ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1704423678,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":629057,"ip_address":"å››å·","group_id":0},"score":635111,"extra":""}]}]},{"had_liked":false,"id":380860,"user_name":"è¯·è¾“å…¥æ˜µç§°","can_delete":false,"product_type":"c1","uid":1333409,"ip_address":"åŒ—äº¬","ucode":"562640F2130207","user_header":"https://static001.geekbang.org/account/avatar/00/14/58/a1/6e33ffc7.jpg","comment_is_top":false,"comment_ctime":1694331542,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100613601,"comment_content":"ç¿»äº†ä¸‹ã€Šæ·±å…¥ç†è§£ Java è™šæ‹Ÿæœºç¬¬äºŒç‰ˆã€‹ï¼Œä¹¦ä¸­è®²åˆ°è§£æå¯ä»¥åœ¨åˆå§‹åŒ–ä¹‹åå¼€å§‹ã€‚\næœ‰äº”ç§æƒ…å†µéœ€è¦å¯¹ç±»åˆå§‹åŒ–ï¼š\n1ã€é‡åˆ°newã€getstaticã€setstaticã€invokestaticè¿™å››ä¸ªå­—èŠ‚ç æŒ‡ä»¤æ—¶\n2ã€å¯¹ç±»åå°„è°ƒç”¨\n3ã€è¯¥ç±»æ˜¯æŸä¸ªè¢«åˆå§‹åŒ–ç±»çš„çˆ¶ç±»\n4ã€è™šæ‹Ÿæœºå¯åŠ¨æ—¶çš„æ‰§è¡Œä¸»ç±»\n5ã€jdk 1.7 åŠ¨æ€è¯­è¨€æ”¯æŒï¼Œçœå»è‹¥å¹²","like_count":3},{"had_liked":false,"id":380438,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"åŒ—äº¬","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1693576730,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100613601,"comment_content":"ç±»åŠ è½½å™¨æ˜¯JVMçš„ä¸€éƒ¨åˆ†è¿˜æ˜¯å’ŒJVMå¹¶åˆ—çš„ä¸€ä¸ªä¸œè¥¿ï¼Ÿç±»åŠ è½½å™¨æ˜¯jreçš„binç›®å½•ä¸‹çš„ä¸€ä¸ªå·¥å…·å—ï¼Ÿ","like_count":1},{"had_liked":false,"id":386266,"user_name":"æ–‡æ•¦å¤","can_delete":false,"product_type":"c1","uid":1195258,"ip_address":"å››å·","ucode":"B8F4A6BD5D7805","user_header":"https://static001.geekbang.org/account/avatar/00/12/3c/fa/e2990931.jpg","comment_is_top":false,"comment_ctime":1704422066,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100613601,"comment_content":"æ–¹æ³•åŒºåŒ…å« 4 ç±»ä¿¡æ¯ï¼Œå…¶ä¸­æœ‰2ä¸ªæ˜¯ç±»çš„å…ƒä¿¡æ¯å’Œç±»çš„æ–¹æ³•æ–¹æ³•ä¿¡æ¯ï¼Ÿè¿™é‡Œç±»çš„å…ƒä¿¡æ¯ä¸æ˜¯åŒ…æ‹¬äº†ç±»çš„æ–¹æ³•ä¿¡æ¯å—ï¼Ÿä¸ºä»€ä¹ˆè¿™ä¹ˆåˆ†ï¼Œæ˜¯æˆ‘ç†è§£é”™äº†å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":382766,"user_name":"Geek_d41785","can_delete":false,"product_type":"c1","uid":3732994,"ip_address":"é™•è¥¿","ucode":"CA1E7BAF470FC2","user_header":"","comment_is_top":false,"comment_ctime":1698025254,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100613601,"comment_content":"æ²¡æœ‰çœ‹æ‡‚Java ä»£ç è·å–æ–¹æ³•åŒºçš„å†…å­˜ä½¿ç”¨æƒ…å†µåŠå…ƒç©ºé—´ä¿¡æ¯è¿™ä¸ªä»£ç ç¤ºä¾‹ï¼Œåœ¨Java8 ä¹‹åæ–¹æ³•åŒºä¸ç­‰äºå…ƒç©ºé—´å—","like_count":0},{"had_liked":false,"id":380561,"user_name":"éƒ­åˆš","can_delete":false,"product_type":"c1","uid":1292032,"ip_address":"å¹¿ä¸œ","ucode":"22CB8ECE8E3DCA","user_header":"https://static001.geekbang.org/account/avatar/00/13/b7/00/12149f4e.jpg","comment_is_top":false,"comment_ctime":1693820492,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100613601,"comment_content":"å…ƒç©ºé—´å†…å­˜æº¢å‡ºå¦‚ä½•åˆ†æå‘¢ï¼Ÿ","like_count":0}]}