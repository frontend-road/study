{"id":195333,"title":"19 | 日志作用域：解决不同请求之间的日志干扰","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/NET-Core\">https://gitee.com/geektime-geekbang/NET-Core</a></p>","comments":[{"had_liked":false,"id":176824,"user_name":"zy","can_delete":false,"product_type":"c3","uid":1817487,"ip_address":"","ucode":"54C318B06B8D3A","user_header":"https://static001.geekbang.org/account/avatar/00/1b/bb/8f/13de6ff8.jpg","comment_is_top":false,"comment_ctime":1581174743,"is_pvip":false,"replies":[{"id":68829,"content":"mvc的controller已经是工作在scope范围内了，配置开启即可","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1581336003,"ip_address":"","comment_id":176824,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"mvc 项目不需要像控制台程序一样先使用 logger.BeginScope()吗？","like_count":3,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483225,"discussion_content":"mvc的controller已经是工作在scope范围内了，配置开启即可","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581336003,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1132878,"avatar":"https://static001.geekbang.org/account/avatar/00/11/49/4e/8798cd01.jpg","nickname":"顷","note":"","ucode":"096B6859C1FA80","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":176440,"discussion_content":"在自己事务中或其他追踪调用链的地方，涉及到很多业务代码时，开启scope是不是不好操作，把所有操作都包含在using中吗，或者有什么最佳实践","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582035575,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1132878,"avatar":"https://static001.geekbang.org/account/avatar/00/11/49/4e/8798cd01.jpg","nickname":"顷","note":"","ucode":"096B6859C1FA80","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":215759,"discussion_content":"这些本身就是工作在scope范围内了，在web项目中不用再开启scope了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585379714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":176440,"ip_address":"","group_id":0},"score":215759,"extra":""}]}]},{"had_liked":false,"id":185502,"user_name":"小喵喵","can_delete":false,"product_type":"c3","uid":1062444,"ip_address":"","ucode":"FDBBB2A59DB8B6","user_header":"https://static001.geekbang.org/account/avatar/00/10/36/2c/8bd4be3a.jpg","comment_is_top":false,"comment_ctime":1583594922,"is_pvip":false,"replies":[{"id":72483,"content":" requestId 表示当前请求的唯一标识，每此请求都会有一个id\ntraceId 表示当前请求链路的唯一标识，在例如，这个请求进来，然后这个服务会调用其它服务，则整个链路上的请求，都会携带这个相同的traceId\nspanId，表示同一个请求链路上不同节点的标识。\ntraceId + spanId 可以实现分布式追踪。\n\n关于BeginScope，一般由框架调用，例如controller的action中，不需要些这些代码。\n在设计自己的组件，也是类似的。","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1584245280,"ip_address":"","comment_id":185502,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"1.能解释一下requestId&#47;spanId&#47;traceId 分别表示什么Id吗？为什么需要三个Id，分别对应的业务场景是什么呢？\n2.BeginScope放在using里面，如果using里面的代码很多。这样岂不是可读性和维护性都降低了吗？或者还有什么更好的使用方式？","like_count":2,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486383,"discussion_content":" requestId 表示当前请求的唯一标识，每此请求都会有一个id\ntraceId 表示当前请求链路的唯一标识，在例如，这个请求进来，然后这个服务会调用其它服务，则整个链路上的请求，都会携带这个相同的traceId\nspanId，表示同一个请求链路上不同节点的标识。\ntraceId + spanId 可以实现分布式追踪。\n\n关于BeginScope，一般由框架调用，例如controller的action中，不需要些这些代码。\n在设计自己的组件，也是类似的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584245280,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":211469,"user_name":"Eric","can_delete":false,"product_type":"c3","uid":1575571,"ip_address":"","ucode":"7EB511C384BD7B","user_header":"https://static001.geekbang.org/account/avatar/00/18/0a/93/a189ec16.jpg","comment_is_top":false,"comment_ctime":1587968548,"is_pvip":false,"replies":[{"id":79641,"content":"内置traceid应该3.x的新特性","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1588939900,"ip_address":"","comment_id":211469,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"老师你好，为什么我在2.x的版本里按你的方法并不能输出span id之类的东西","like_count":0,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493275,"discussion_content":"内置traceid应该3.x的新特性","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588939900,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":283151,"user_name":"布凡","can_delete":false,"product_type":"c3","uid":1202465,"ip_address":"","ucode":"346FCD332F8BFA","user_header":"https://static001.geekbang.org/account/avatar/00/12/59/21/d2efde18.jpg","comment_is_top":false,"comment_ctime":1615596848,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"原来追踪链就是用 IncludeScopes这个属性来控制的","like_count":1}]}