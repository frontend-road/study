{"id":417674,"title":"01ï½œnet/httpï¼šä½¿ç”¨æ ‡å‡†åº“æ­å»ºServerå¹¶ä¸æ˜¯é‚£ä¹ˆç®€å•","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯è½©è„‰åˆƒã€‚æ¬¢è¿åŠ å…¥æˆ‘çš„è¯¾ç¨‹ï¼Œå’Œæˆ‘ä¸€èµ·ä»0å¼€å§‹æ„å»ºWebæ¡†æ¶ã€‚</p><p>ä¹‹å‰æˆ‘ç®€å•ä»‹ç»äº†æ•´ä¸ªè¯¾ç¨‹çš„è®¾è®¡æ€è·¯ï¼Œä¹Ÿæ˜¯æ­å»ºWebæ¡†æ¶çš„å­¦ä¹ è·¯å¾„ï¼Œæˆ‘ä»¬ä¼šå…ˆåŸºäºæ ‡å‡†åº“æ­å»ºèµ·Serverï¼Œç„¶åä¸€æ­¥ä¸€æ­¥å¢åŠ æ§åˆ¶å™¨ã€è·¯ç”±ã€ä¸­é—´ä»¶ï¼Œæœ€åå®Œå–„å°è£…å’Œé‡å¯ï¼Œåœ¨æ•´ç« å­¦å®Œåï¼Œä½ å°±èƒ½å»ºç«‹èµ·ä¸€å¥—è‡ªå·±çš„Webæ¡†æ¶äº†ã€‚</p><p>å…¶å®ä½ ç†Ÿæ‚‰Golangçš„è¯å°±ä¼šçŸ¥é“ï¼Œç”¨å®˜æ–¹æä¾›çš„ net/http æ ‡å‡†åº“æ­å»ºä¸€ä¸ªWeb Serverï¼Œæ˜¯ä¸€ä»¶éå¸¸ç®€å•çš„äº‹ã€‚æˆ‘åœ¨é¢è¯•çš„æ—¶å€™ä¹Ÿå‘ç°ï¼Œä¸å°‘åŒå­¦ï¼Œåœ¨æ€ä¹ˆæ­æ€ä¹ˆç”¨çš„é—®é¢˜ä¸Šï¼Œå›ç­”çš„éå¸¸æºœï¼Œä½†æ˜¯å†è¿½é—®ä¸€å¥ä¸ºä»€ä¹ˆè¿™ä¸ª Server è¿™ä¹ˆè®¾è®¡ï¼Œæ¶‰åŠçš„ net/http å®ç°åŸç†æ˜¯ä»€ä¹ˆ? ä¸€æ¦‚ä¸çŸ¥ã€‚</p><p>è¿™å…¶å®æ˜¯éå¸¸å±é™©çš„ã€‚<strong>å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ä¼šå› ä¸ºä¸äº†è§£åº•å±‚åŸç†ï¼Œæƒ³å½“ç„¶çš„è®¤ä¸ºå®ƒçš„ä½¿ç”¨æ–¹å¼</strong>ï¼Œç›´æ¥å¯¼è‡´åœ¨ä»£ç ç¼–å†™ã€åº”ç”¨è°ƒä¼˜çš„æ—¶å€™å‡ºç°å„ç§é—®é¢˜ã€‚</p><p>æ‰€ä»¥ä»Šå¤©ï¼Œæˆ‘æƒ³å¸¦ç€ä½ ä»æœ€åº•å±‚çš„ HTTP åè®®å¼€å§‹ï¼Œææ¸…æ¥šWeb Serveræœ¬è´¨ï¼Œé€šè¿‡ net/http ä»£ç åº“æ¢³ç† HTTP æœåŠ¡çš„ä¸»æµç¨‹è„‰ç»œï¼Œå…ˆçŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œå†æ­å»ºæ¡†æ¶çš„Serverç»“æ„ã€‚</p><p>ä¹‹åï¼Œæˆ‘ä»¬ä¼šåŸºäºä»Šå¤©åˆ†æçš„æ•´ä¸ª HTTP æœåŠ¡ä¸»æµç¨‹åŸç†ç»§ç»­å¼€å‘ã€‚æ‰€ä»¥è¿™èŠ‚è¯¾ä½ æŒæ¡çš„ç¨‹åº¦ï¼Œå¯¹äºåç»­å†…å®¹çš„ç†è§£è‡³å…³é‡è¦ã€‚</p><h2>Web Server çš„æœ¬è´¨</h2><!-- [[[read_end]]] --><p>æ—¢ç„¶è¦æ­ Web Serverï¼Œé‚£æˆ‘ä¹Ÿå…ˆç®€å•ä»‹ç»ä¸€ä¸‹ï¼Œç»´åŸºç™¾ç§‘ä¸Šæ˜¯è¿™ä¹ˆè§£é‡Šçš„ï¼ŒWeb Server æ˜¯ä¸€ä¸ªé€šè¿‡ HTTP åè®®å¤„ç†Webè¯·æ±‚çš„è®¡ç®—æœºç³»ç»Ÿã€‚è¿™å¥è¯ä¹å¬æœ‰ç‚¹ç»•å£ï¼Œæˆ‘ç»™ä½ è§£é‡Šä¸‹ã€‚</p><p>HTTP åè®®ï¼Œåœ¨ OSI ç½‘ç»œä½“ç³»ç»“æ„ä¸­ï¼Œæ˜¯åŸºäºTCP/IPä¹‹ä¸Šç¬¬ä¸ƒå±‚åº”ç”¨å±‚çš„åè®®ï¼Œå…¨ç§°å«åšè¶…æ–‡æœ¬ä¼ è¾“åè®®ã€‚å•¥æ„æ€ï¼Ÿå°±æ˜¯è¯´HTTPåè®®ä¼ è¾“çš„éƒ½æ˜¯æ–‡æœ¬å­—ç¬¦ï¼Œåªæ˜¯è¿™äº›å­—ç¬¦æ˜¯æœ‰è§„åˆ™æ’åˆ—çš„ã€‚è¿™äº›å­—ç¬¦çš„æ’åˆ—è§„åˆ™ï¼Œå°±æ˜¯ä¸€ç§çº¦å®šï¼Œä¹Ÿå°±æ˜¯åè®®ã€‚è¿™ä¸ªåè®®è¿˜æœ‰ä¸€ä¸ªä¸“é—¨çš„æè¿°æ–‡æ¡£ï¼Œå°±æ˜¯<a href=\"https://datatracker.ietf.org/doc/html/rfc2616\">RFC 2616</a>ã€‚</p><p>å¯¹äº HTTP åè®®ï¼Œæ— è®ºæ˜¯è¯·æ±‚è¿˜æ˜¯å“åº”ï¼Œä¼ è¾“çš„æ¶ˆæ¯ä½“éƒ½å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šHTTPå¤´éƒ¨å’Œ HTTP Bodyä½“ã€‚å¤´éƒ¨æè¿°çš„ä¸€èˆ¬æ˜¯å’Œä¸šåŠ¡æ— å…³ä½†ä¸ä¼ è¾“ç›¸å…³çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¯·æ±‚åœ°å€ã€ç¼–ç æ ¼å¼ã€ç¼“å­˜æ—¶é•¿ç­‰ï¼›Body é‡Œé¢ä¸»è¦æè¿°çš„æ˜¯ä¸ä¸šåŠ¡ç›¸å…³çš„ä¿¡æ¯ã€‚<img src=\"https://static001.geekbang.org/resource/image/cb/e0/cbbafb7ac6128b6e6f8bde0c983c7ae0.jpg?wh=1920x1080\" alt=\"\"></p><p>Web Server çš„æœ¬è´¨ï¼Œå®é™…ä¸Šå°±æ˜¯<strong>æ¥æ”¶ã€è§£æ</strong> HTTP è¯·æ±‚ä¼ è¾“çš„æ–‡æœ¬å­—ç¬¦ï¼Œç†è§£è¿™äº›æ–‡æœ¬å­—ç¬¦çš„æŒ‡ä»¤ï¼Œç„¶åè¿›è¡Œ<strong>è®¡ç®—</strong>ï¼Œå†å°†è¿”å›å€¼<strong>ç»„ç»‡æˆ</strong> HTTP å“åº”çš„æ–‡æœ¬å­—ç¬¦ï¼Œé€šè¿‡ TCP ç½‘ç»œ<strong>ä¼ è¾“å›å»</strong>ã€‚</p><p>ç†è§£äº†Web Server å¹²çš„äº‹æƒ…ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥ç»§ç»­çœ‹çœ‹åœ¨è¯­è¨€å±‚é¢æ€ä¹ˆå®ç°ã€‚</p><h2>ä¸€å®šè¦ç”¨æ ‡å‡†åº“å—</h2><p>å¯¹ Web Server æ¥è¯´ï¼ŒGolang æä¾›äº† net åº“å’Œ net/http åº“ï¼Œåˆ†åˆ«å¯¹åº”OSIçš„ TCP å±‚å’Œ HTTP å±‚ï¼Œå®ƒä»¬ä¸¤ä¸ªè´Ÿè´£çš„å°±æ˜¯ HTTP çš„æ¥æ”¶å’Œè§£æã€‚</p><p>ä¸€èˆ¬æˆ‘ä»¬ä¼šä½¿ç”¨ net/http åº“è§£æ HTTP æ¶ˆæ¯ä½“ã€‚ä½†æ˜¯å¯èƒ½ä¼šæœ‰äººé—®ï¼Œå¦‚æœæˆ‘æƒ³å®ç° Web æœåŠ¡ï¼Œå¯ä¸å¯ä»¥ä¸ç”¨ net/http åº“å‘¢ï¼Ÿæ¯”å¦‚æˆ‘ç›´æ¥ç”¨ net åº“ï¼Œé€å­—è¯»å–æ¶ˆæ¯ä½“ï¼Œç„¶åè‡ªå·±è§£æè·å–çš„ä¼ è¾“å­—ç¬¦ã€‚</p><p>ç­”æ¡ˆæ˜¯å¯ä»¥çš„ï¼Œå¦‚æœä½ æœ‰å…¼å®¹å…¶å®ƒåè®®ã€è¿½æ±‚æè‡´æ€§èƒ½çš„éœ€æ±‚ï¼Œè€Œä¸”ä½ æœ‰æŠŠæ¡èƒ½æŒ‰ç…§ HTTP çš„RFC æ ‡å‡†è¿›è¡Œè§£æï¼Œé‚£å®Œå…¨å¯ä»¥è‡ªå·±å°è£…ä¸€ä¸ªHTTPåº“ã€‚</p><p>å…¶å®åœ¨ä¸€äº›å¤§å‚ä¸­ç¡®å®æ˜¯è¿™ä¹ˆåšçš„ï¼Œæ¯å½“æœ‰ä¸€äº›é€šç”¨çš„åè®®éœ€æ±‚ï¼Œæ¯”å¦‚ä¸€ä¸ªæœåŠ¡æ—¢è¦æ”¯æŒ HTTPï¼Œåˆè¦æ”¯æŒ Protocol Buffersï¼Œåˆæˆ–è€…æƒ³è¦æ”¯æŒè‡ªå®šä¹‰çš„åè®®ï¼Œé‚£ä¹ˆä»–ä»¬å°±å¯èƒ½æŠ›å¼ƒ HTTP åº“ï¼Œç”šè‡³æŠ›å¼ƒ net åº“ï¼Œç›´æ¥è‡ªå·±è¿›è¡Œç½‘ç»œäº‹ä»¶é©±åŠ¨ï¼Œè§£æ HTTP åè®®ã€‚</p><p>æœ‰ä¸ªå¼€æºåº“ï¼Œå« <a href=\"https://github.com/valyala/fasthttp\">FastHTTP</a>ï¼Œå®ƒå°±æ˜¯æŠ›å¼ƒæ ‡å‡†åº“ net/http æ¥å®ç°çš„ã€‚ä½œè€…ä¸ºäº†è¿½æ±‚æé«˜çš„HTTPæ€§èƒ½ï¼Œè‡ªå·±å°è£…äº†ç½‘ç»œäº‹ä»¶é©±åŠ¨ï¼Œè§£æäº†HTTPåè®®ã€‚ä½ æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥å»çœ‹çœ‹ã€‚</p><p>ä½†æ˜¯ç°åœ¨ç»å¤§éƒ¨åˆ†çš„ Web æ¡†æ¶ï¼Œéƒ½æ˜¯åŸºäº net/http æ ‡å‡†åº“çš„ã€‚æˆ‘è®¤ä¸ºåŸå› ä¸»è¦æœ‰ä¸¤ç‚¹ï¼š</p><ul>\n<li>ç¬¬ä¸€æ˜¯<strong>ç›¸ä¿¡å®˜æ–¹å¼€æºçš„åŠ›é‡</strong>ã€‚è‡ªå·±å®ç°HTTPåè®®çš„è§£æï¼Œä¸ä¸€å®šä¼šæ¯”æ ‡å‡†åº“å®ç°å¾—æ›´å¥½ï¼Œå³ä½¿å½“å‰æ ‡å‡†åº“æœ‰ä¸€äº›ä¸è¶³ä¹‹å¤„ï¼Œæˆ‘ä»¬ä¹Ÿéƒ½ç›¸ä¿¡ï¼Œéšç€å¼€æºè´¡çŒ®è€…è¶Šæ¥è¶Šå¤šï¼Œæ ‡å‡†åº“ä¹Ÿä¼šæœ€ç»ˆè¾¾åˆ°å®Œç¾ã€‚</li>\n<li>ç¬¬äºŒæ˜¯<strong>Web æœåŠ¡æ¶æ„çš„å˜åŒ–</strong>ã€‚éšç€å®¹å™¨åŒ–ã€Kubernetes ç­‰æŠ€æœ¯çš„å…´èµ·ï¼Œä¸šç•Œé€æ¸è¾¾æˆå…±è¯†ï¼Œå•æœºå¹¶å‘æ€§èƒ½å¹¶ä¸æ˜¯è¯„åˆ¤ Web æœåŠ¡ä¼˜åŠ£çš„å”¯ä¸€æ ‡å‡†äº†ï¼Œæ˜“ç”¨æ€§ã€æ‰©å±•æ€§ä¹Ÿæ˜¯åº•å±‚åº“éœ€è¦è€ƒé‡çš„ã€‚</li>\n</ul><p>æ‰€ä»¥æ€»ä½“æ¥è¯´ï¼Œnet/http æ ‡å‡†åº“ï¼Œä½œä¸ºå®˜æ–¹å¼€æºåº“ï¼Œå…¶æ˜“ç”¨æ€§å’Œæ‰©å±•æ€§éƒ½ç»è¿‡å¼€æºç¤¾åŒºå’ŒGolangå®˜æ–¹çš„è®¤è¯ï¼Œæ˜¯æˆ‘ä»¬ç›®å‰æ„å»ºWeb Serveré¦–é€‰çš„HTTPåè®®åº“ã€‚</p><p>ç”¨net/httpæ¥åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡ï¼Œå…¶å®å¾ˆç®€å•ï¼Œä¸‹é¢æ˜¯<a href=\"https://pkg.go.dev/net/http@go1.15.5\">å®˜æ–¹æ–‡æ¡£</a>é‡Œçš„ä¾‹å­ã€‚æˆ‘åšäº†äº›æ³¨é‡Šï¼Œå¸®ä½ ç†è§£ã€‚</p><pre><code class=\"language-go\">// åˆ›å»ºä¸€ä¸ªFooè·¯ç”±å’Œå¤„ç†å‡½æ•°\nhttp.Handle(\"/foo\", fooHandler)\n\n// åˆ›å»ºä¸€ä¸ªbarè·¯ç”±å’Œå¤„ç†å‡½æ•°\nhttp.HandleFunc(\"/bar\", func(w http.ResponseWriter, r *http.Request) {\n\tfmt.Fprintf(w, \"Hello, %q\", html.EscapeString(r.URL.Path))\n})\n\n// ç›‘å¬8080ç«¯å£\nlog.Fatal(http.ListenAndServe(\":8080\", nil))\n</code></pre><p>æ˜¯ä¸æ˜¯ä»£ç è¶³å¤Ÿç®€å•ï¼Ÿä¸€å…±å°±5è¡Œï¼Œä½†å¾€å‰ç»§ç»­æ¨è¿›ä¹‹å‰ï¼Œæˆ‘æƒ³å…ˆé—®ä½ å‡ ä¸ªé—®é¢˜ï¼Œ<strong>è¿™äº”è¡Œä»£ç åšäº†ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆå°±èƒ½å¯åŠ¨ä¸€ä¸ª HTTP æœåŠ¡ï¼Œå…·ä½“çš„é€»è¾‘æ˜¯ä»€ä¹ˆæ ·çš„</strong>ï¼Ÿ</p><p>è¦å›ç­”è¿™äº›é—®é¢˜ï¼Œä½ å°±è¦æ·±å…¥ç†è§£ net/http æ ‡å‡†åº“ã€‚è¦ä¸ç„¶ï¼Œåªä¼šç®€å•è°ƒç”¨ï¼Œå´ä¸çŸ¥é“åŸç†ï¼Œåé¢å“ªé‡Œå‡ºäº†é—®é¢˜ï¼Œæˆ–è€…ä½ æƒ³è°ƒä¼˜ï¼Œå°±æ— ä»ä¸‹æ‰‹äº†ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ net/http æ ‡å‡†åº“ï¼Œä»ä»£ç å±‚é¢ææ¸…æ¥šæ•´ä¸ª HTTP æœåŠ¡çš„ä¸»æµç¨‹åŸç†ï¼Œæœ€åå†åŸºäºåŸç†è®²å®ç°ã€‚</p><h2>net/http æ ‡å‡†åº“æ€ä¹ˆå­¦</h2><p>æƒ³è¦åœ¨ net/http æ ‡å‡†åº“çº·ç¹å¤æ‚çš„ä»£ç å±‚çº§å’Œè°ƒç”¨ä¸­ï¼Œå¼„æ¸…æ¥šä¸»æµç¨‹ä¸æ˜¯ä¸€ä»¶å®¹æ˜“äº‹ã€‚è¦å¿«é€Ÿç†Ÿæ‚‰ä¸€ä¸ªæ ‡å‡†åº“ï¼Œå°±å¾—æ‰¾å‡†æ–¹æ³•ã€‚</p><p><strong>è¿™é‡Œæˆ‘æ•™ç»™ä½ ä¸€ä¸ªå¿«é€ŸæŒæ¡ä»£ç åº“çš„æŠ€å·§ï¼šåº“å‡½æ•° &gt; ç»“æ„å®šä¹‰ &gt; ç»“æ„å‡½æ•°</strong>ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å½“ä½ åœ¨é˜…è¯»ä¸€ä¸ªä»£ç åº“çš„æ—¶å€™ï¼Œä¸åº”è¯¥ä»ä¸Šåˆ°ä¸‹é˜…è¯»æ•´ä¸ªä»£ç æ–‡æ¡£ï¼Œè€Œåº”è¯¥å…ˆé˜…è¯»æ•´ä¸ªä»£ç åº“æä¾›çš„å¯¹å¤–åº“å‡½æ•°ï¼ˆfunctionï¼‰ï¼Œå†è¯»è¿™ä¸ªåº“æä¾›çš„ç»“æ„ï¼ˆstruct/classï¼‰ï¼Œæœ€åå†é˜…è¯»æ¯ä¸ªç»“æ„å‡½æ•°ï¼ˆmethodï¼‰ã€‚<img src=\"https://static001.geekbang.org/resource/image/81/79/8150f242d1f0ee96f44793112c4dcf79.jpg?wh=1920x1080\" alt=\"\"></p><p>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå­¦å‘¢ï¼Ÿå› ä¸ºè¿™ç§é˜…è¯»æ€è·¯å’Œä»£ç åº“ä½œè€…çš„æ€è·¯æ˜¯ä¸€è‡´çš„ã€‚</p><p>é¦–å…ˆææ¸…æ¥šè¿™ä¸ªåº“è¦æä¾›ä»€ä¹ˆåŠŸèƒ½ï¼ˆæä¾›ä»€ä¹ˆæ ·çš„å¯¹å¤–å‡½æ•°ï¼‰ï¼Œç„¶åä¸ºäº†æä¾›è¿™äº›åŠŸèƒ½ï¼Œæˆ‘è¦æŠŠæ•´ä¸ªåº“åˆ†ä¸ºå‡ ä¸ªæ ¸å¿ƒæ¨¡å—ï¼ˆç»“æ„ï¼‰ï¼Œæœ€åæ¯ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œæˆ‘åº”è¯¥æä¾›ä»€ä¹ˆæ ·çš„èƒ½åŠ›ï¼ˆå…·ä½“çš„ç»“æ„å‡½æ•°ï¼‰æ¥æ»¡è¶³æˆ‘çš„éœ€æ±‚ã€‚</p><h3>åº“å‡½æ•°ï¼ˆåŠŸèƒ½ï¼‰</h3><p>æŒ‰ç…§è¿™ä¸ªæ€è·¯ï¼Œæˆ‘ä»¬æ¥é˜…è¯» net/http åº“ï¼Œå…ˆçœ‹æä¾›çš„å¯¹å¤–åº“å‡½æ•°æ˜¯ä¸ºäº†å®ç°å“ªäº›åŠŸèƒ½ã€‚è¿™é‡Œé¡ºå¸¦è¡¥å……è¯´æ˜ä¸€ä¸‹ï¼Œæˆ‘ä»¬è¯¾ç¨‹å¯¹åº”çš„Golangæºç çš„ç‰ˆæœ¬æ˜¯1.15.5ï¼Œä½ å¯ä»¥åœ¨<a href=\"https://github.com/gohade/coredemo/blob/geekbang/01/go.mod\">01åˆ†æ”¯çš„coredemo/go.mod</a>é‡Œçœ‹åˆ°ã€‚</p><p>ä½ ç›´æ¥é€šè¿‡  <code>go doc net/http | grep \"^func\"</code> å‘½ä»¤è¡Œèƒ½æŸ¥è¯¢å‡º net/http åº“æ‰€æœ‰çš„å¯¹å¤–åº“å‡½æ•°ï¼š</p><pre><code>func CanonicalHeaderKey(s string) string\nfunc DetectContentType(data []byte) string\nfunc Error(w ResponseWriter, error string, code int)\nfunc Get(url string) (resp *Response, err error)\nfunc Handle(pattern string, handler Handler)\nfunc HandleFunc(pattern string, handler func(ResponseWriter, *Request))\nfunc Head(url string) (resp *Response, err error)\nfunc ListenAndServe(addr string, handler Handler) error\nfunc ListenAndServeTLS(addr, certFile, keyFile string, handler Handler) error\nfunc MaxBytesReader(w ResponseWriter, r io.ReadCloser, n int64) io.ReadCloser\nfunc NewRequest(method, url string, body io.Reader) (*Request, error)\nfunc NewRequestWithContext(ctx context.Context, method, url string, body io.Reader) (*Request, error)\nfunc NotFound(w ResponseWriter, r *Request)\nfunc ParseHTTPVersion(vers string) (major, minor int, ok bool)\nfunc ParseTime(text string) (t time.Time, err error)\nfunc Post(url, contentType string, body io.Reader) (resp *Response, err error)\nfunc PostForm(url string, data url.Values) (resp *Response, err error)\nfunc ProxyFromEnvironment(req *Request) (*url.URL, error)\nfunc ProxyURL(fixedURL *url.URL) func(*Request) (*url.URL, error)\nfunc ReadRequest(b *bufio.Reader) (*Request, error)\nfunc ReadResponse(r *bufio.Reader, req *Request) (*Response, error)\nfunc Redirect(w ResponseWriter, r *Request, url string, code int)\nfunc Serve(l net.Listener, handler Handler) error\nfunc ServeContent(w ResponseWriter, req *Request, name string, modtime time.Time, ...)\nfunc ServeFile(w ResponseWriter, r *Request, name string)\nfunc ServeTLS(l net.Listener, handler Handler, certFile, keyFile string) error\nfunc SetCookie(w ResponseWriter, cookie *Cookie)\nfunc StatusText(code int) string\n</code></pre><p>åœ¨è¿™ä¸ªåº“æä¾›çš„æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å»æ‰ä¸€äº› New å’Œ Set å¼€å¤´çš„å‡½æ•°ï¼Œå› ä¸ºä½ ä»å‘½åä¸Šå¯ä»¥çœ‹å‡ºï¼Œè¿™äº›å‡½æ•°æ˜¯å¯¹æŸä¸ªå¯¹è±¡æˆ–è€…å±æ€§çš„è®¾ç½®ã€‚</p><p>å‰©ä¸‹çš„å‡½æ•°å¤§è‡´å¯ä»¥åˆ†æˆä¸‰ç±»ï¼š</p><ul>\n<li>ä¸ºæœåŠ¡ç«¯æä¾›åˆ›å»º HTTP æœåŠ¡çš„å‡½æ•°ï¼Œåå­—ä¸­ä¸€èˆ¬åŒ…å« Serve å­—æ ·ï¼Œæ¯”å¦‚ Serveã€ServeFileã€ListenAndServeç­‰ã€‚</li>\n<li>ä¸ºå®¢æˆ·ç«¯æä¾›è°ƒç”¨ HTTP æœåŠ¡çš„ç±»åº“ï¼Œä»¥ HTTP çš„ method åŒåï¼Œæ¯”å¦‚ Getã€Postã€Headç­‰ã€‚</li>\n<li>æä¾›ä¸­è½¬ä»£ç†çš„ä¸€äº›å‡½æ•°ï¼Œæ¯”å¦‚ProxyURLã€ProxyFromEnvironment ç­‰ã€‚</li>\n</ul><p>æˆ‘ä»¬ç°åœ¨ç ”ç©¶çš„æ˜¯ï¼Œå¦‚ä½•åˆ›å»ºä¸€ä¸ª HTTP æœåŠ¡ï¼Œæ‰€ä»¥å…³æ³¨åŒ…å« Serve å­—æ ·çš„å‡½æ•°å°±å¯ä»¥äº†ã€‚</p><pre><code class=\"language-go\">// é€šè¿‡ç›‘å¬çš„URLåœ°å€å’Œæ§åˆ¶å™¨å‡½æ•°æ¥åˆ›å»ºHTTPæœåŠ¡\nfunc ListenAndServe(addr string, handler Handler) error{}\n// é€šè¿‡ç›‘å¬çš„URLåœ°å€å’Œæ§åˆ¶å™¨å‡½æ•°æ¥åˆ›å»ºHTTPSæœåŠ¡\nfunc ListenAndServeTLS(addr, certFile, keyFile string, handler Handler) error{}\n// é€šè¿‡net.Listenerç»“æ„å’Œæ§åˆ¶å™¨å‡½æ•°æ¥åˆ›å»ºHTTPæœåŠ¡\nfunc Serve(l net.Listener, handler Handler) error{}\n// é€šè¿‡net.Listenerç»“æ„å’Œæ§åˆ¶å™¨å‡½æ•°æ¥åˆ›å»ºHTTPSæœåŠ¡\nfunc ServeTLS(l net.Listener, handler Handler, certFile, keyFile string) error{}\n</code></pre><h3>ç»“æ„å®šä¹‰ï¼ˆæ¨¡å—ï¼‰</h3><p>ç„¶åï¼Œæˆ‘ä»¬è¿‡ä¸€éè¿™ä¸ªåº“æä¾›çš„æ‰€æœ‰structï¼Œçœ‹çœ‹æ ¸å¿ƒæ¨¡å—æœ‰å“ªäº›ï¼ŒåŒæ ·ä½¿ç”¨ go doc:</p><pre><code class=\"language-go\">&nbsp;go doc net/http | grep \"^type\"|grep struct\n</code></pre><p>ä½ å¯ä»¥çœ‹åˆ°æ•´ä¸ªåº“æœ€æ ¸å¿ƒçš„å‡ ä¸ªç»“æ„ï¼š</p><pre><code class=\"language-go\">type Client struct{ ... }\ntype Cookie struct{ ... }\ntype ProtocolError struct{ ... }\ntype PushOptions struct{ ... }\ntype Request struct{ ... } \ntype Response struct{ ... }\ntype ServeMux struct{ ... }\ntype Server struct{ ... }\ntype Transport struct{ ... }\n</code></pre><p>çœ‹ç»“æ„çš„åå­—æˆ–è€…go docæŸ¥çœ‹ç»“æ„è¯´æ˜æ–‡æ¡£ï¼Œèƒ½é€æ¸äº†è§£å®ƒä»¬çš„åŠŸèƒ½ï¼š</p><ul>\n<li>Client è´Ÿè´£æ„å»ºHTTPå®¢æˆ·ç«¯ï¼›</li>\n<li>Server è´Ÿè´£æ„å»ºHTTPæœåŠ¡ç«¯ï¼›</li>\n<li>ServerMux è´Ÿè´£HTTPæœåŠ¡ç«¯è·¯ç”±ï¼›</li>\n<li>Transportã€Requestã€Responseã€Cookieè´Ÿè´£å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¼ è¾“å¯¹åº”çš„ä¸åŒæ¨¡å—ã€‚</li>\n</ul><p>ç°åœ¨é€šè¿‡åº“æ–¹æ³•ï¼ˆfunctionï¼‰å’Œç»“æ„ä½“ï¼ˆstructï¼‰ï¼Œæˆ‘ä»¬å¯¹æ•´ä¸ªåº“çš„ç»“æ„å’ŒåŠŸèƒ½æœ‰å¤§è‡´å°è±¡äº†ã€‚æ•´ä¸ªåº“æ‰¿æ‹…äº†ä¸¤éƒ¨åˆ†åŠŸèƒ½ï¼Œä¸€éƒ¨åˆ†æ˜¯æ„å»ºHTTPå®¢æˆ·ç«¯ï¼Œä¸€éƒ¨åˆ†æ˜¯æ„å»ºHTTPæœåŠ¡ç«¯ã€‚</p><p>æ„å»ºçš„HTTPæœåŠ¡ç«¯é™¤äº†æä¾›çœŸå®æœåŠ¡ä¹‹å¤–ï¼Œä¹Ÿèƒ½æä¾›ä»£ç†ä¸­è½¬æœåŠ¡ï¼Œå®ƒä»¬åˆ†åˆ«ç”± Client å’Œ Server ä¸¤ä¸ªæ•°æ®ç»“æ„è´Ÿè´£ã€‚é™¤äº†è¿™ä¸¤ä¸ªæœ€é‡è¦çš„æ•°æ®ç»“æ„ä¹‹å¤–ï¼ŒHTTP åè®®çš„æ¯ä¸ªéƒ¨åˆ†ï¼Œæ¯”å¦‚è¯·æ±‚ã€è¿”å›ã€ä¼ è¾“è®¾ç½®ç­‰éƒ½æœ‰å…·ä½“çš„æ•°æ®ç»“æ„è´Ÿè´£ã€‚</p><h3>ç»“æ„å‡½æ•°ï¼ˆèƒ½åŠ›ï¼‰</h3><p>ä¸‹é¢ä»å…·ä½“çš„éœ€æ±‚å‡ºå‘ï¼Œæˆ‘ä»¬æ¥é˜…è¯»å…·ä½“çš„ç»“æ„å‡½æ•°ï¼ˆmethodï¼‰ã€‚</p><p>æˆ‘ä»¬å½“å‰çš„éœ€æ±‚æ˜¯åˆ›å»º HTTP æœåŠ¡ï¼Œå¼€å¤´æˆ‘ä¸¾äº†ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼š</p><pre><code class=\"language-go\">// åˆ›å»ºä¸€ä¸ªFooè·¯ç”±å’Œå¤„ç†å‡½æ•°\nhttp.Handle(\"/foo\", fooHandler)\n\n// åˆ›å»ºä¸€ä¸ªbarè·¯ç”±å’Œå¤„ç†å‡½æ•°\nhttp.HandleFunc(\"/bar\", func(w http.ResponseWriter, r *http.Request) {\n\tfmt.Fprintf(w, \"Hello, %q\", html.EscapeString(r.URL.Path))\n})\n\n// ç›‘å¬8080ç«¯å£\nlog.Fatal(http.ListenAndServe(\":8080\", nil))\n</code></pre><p>æˆ‘ä»¬è·Ÿç€ http.ListenAndServe è¿™ä¸ªå‡½æ•°æ¥ç†ä¸€ä¸‹ net/http åˆ›å»ºæœåŠ¡çš„ä¸»æµç¨‹é€»è¾‘ã€‚</p><p>é˜…è¯»å…·ä½“çš„ä»£ç é€»è¾‘ç”¨ <code>go doc</code> å‘½ä»¤æ˜æ˜¾å°±ä¸å¤Ÿäº†ï¼Œä½ éœ€è¦ä¸¤ä¸ªä¸œè¥¿ï¼š</p><p>ä¸€ä¸ªæ˜¯å¯ä»¥çµæ´»è¿›è¡Œä»£ç è·³è½¬çš„ IDEï¼ŒVS Code å’Œ GoLand éƒ½æ˜¯éå¸¸å¥½çš„å·¥å…·ã€‚ä»¥æˆ‘ä»¬ç°åœ¨è¦æŸ¥çœ‹çš„ http.ListenAndServe è¿™ä¸ªå‡½æ•°ä¸ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥ä»ä¸Šé¢çš„ä¾‹å­ä»£ç ä¸­ï¼Œç›´æ¥é€šè¿‡IDEè·³è½¬åˆ°è¿™ä¸ªå‡½æ•°çš„æºç ä¸­é˜…è¯»ï¼Œæœ‰ä¸€ä¸ªèƒ½çµæ´»è·³è½¬çš„IDEå·¥å…·æ˜¯éå¸¸å¿…è¦çš„ã€‚</p><p>å¦ä¸€ä¸ªæ˜¯å¯ä»¥æ–¹ä¾¿è®°å½•ä»£ç æµç¨‹çš„ç¬”è®°ï¼Œè¿™é‡Œæˆ‘çš„ä¸ªäººæ–¹æ³•æ˜¯ä½¿ç”¨æ€ç»´å¯¼å›¾ã€‚</p><p>å…·ä½“æ–¹æ³•æ˜¯<strong>å°†è¦åˆ†æçš„ä»£ç ä»å…¥å£å¤„ä¸€å±‚å±‚è®°å½•ä¸‹æ¥ï¼Œæ¯ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬åªè®°å½•å…¶æ ¸å¿ƒä»£ç ï¼Œç„¶åå¯¹æ¯ä¸ªæ ¸å¿ƒä»£ç ä¸€å±‚å±‚è§£æ</strong>ã€‚è®°å¾—æŠŠæ€ç»´å¯¼å›¾çš„ç»“æ„è®¾ç½®ä¸ºå³ä¾§åˆ†å¸ƒï¼Œè¿™æ ·æ›´ç›´è§‚ã€‚</p><p>æ¯”å¦‚ä¸‹é¢è¿™å¼ å›¾ï¼Œå°±æ˜¯æˆ‘è§£æéƒ¨åˆ†HTTPåº“æœåŠ¡ç«¯ç”»çš„<a href=\"https://github.com/gohade/geekbang/tree/main/01\">ä»£ç åˆ†æå›¾</a>ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/3a/cd/3ab5c45e113ddf4cc3bdb0e09c85c7cd.png?wh=2464x1192\" alt=\"\"></p><p>è¿™å¼ å›¾çœ‹ä¸Šå»å±‚çº§å¤æ‚ï¼Œä¸è¿‡ä¸ç”¨æ‹…å¿ƒï¼Œå¯¹ç…§ç€æ€ç»´å¯¼å›¾ï¼Œæˆ‘å¸¦ä½ ä¸€å±‚ä¸€å±‚é˜…è¯»ï¼Œè®²è§£æ¯ä¸€å±‚çš„é€»è¾‘ï¼Œå¸¦ä½ çœ‹æ¸…æ¥šä»£ç èƒŒåçš„è®¾è®¡æ€è·¯ã€‚</p><p>æˆ‘ä»¬å…ˆé¡ºç€ http.ListenAndServe çš„è„‰ç»œè¯»ã€‚</p><p><strong>ç¬¬ä¸€å±‚</strong>ï¼Œhttp.ListenAndServe æœ¬è´¨æ˜¯é€šè¿‡åˆ›å»ºä¸€ä¸ª Server æ•°æ®ç»“æ„ï¼Œè°ƒç”¨ <code>server.ListenAndServe</code> å¯¹å¤–æä¾›æœåŠ¡ï¼Œè¿™ä¸€å±‚å®Œå…¨æ˜¯æ¯”è¾ƒç®€å•çš„å°è£…ï¼Œç›®çš„æ˜¯ï¼Œå°†Serverç»“æ„åˆ›å»ºæœåŠ¡çš„æ–¹æ³• ListenAndServe ï¼Œç›´æ¥ä½œä¸ºåº“å‡½æ•°å¯¹å¤–æä¾›ï¼Œå¢åŠ åº“çš„æ˜“ç”¨æ€§ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/4e/01/4eeaace11e29989b3bfc2344ca8e4001.png?wh=810x582\" alt=\"\"></p><p>è¿›å…¥åˆ°<strong>ç¬¬äºŒå±‚</strong>ï¼Œåˆ›å»ºæœåŠ¡çš„æ–¹æ³• ListenAndServe å…ˆå®šä¹‰äº†ç›‘å¬ä¿¡æ¯ <code>net.Listen</code>ï¼Œç„¶åè°ƒç”¨ Serve å‡½æ•°ã€‚</p><p>è€Œåœ¨<strong>ç¬¬ä¸‰å±‚</strong> Serve å‡½æ•°ä¸­ï¼Œç”¨äº†ä¸€ä¸ª for å¾ªç¯ï¼Œé€šè¿‡ <code>l.Accept</code>ä¸æ–­æ¥æ”¶ä»å®¢æˆ·ç«¯ä¼ è¿›æ¥çš„è¯·æ±‚è¿æ¥ã€‚å½“æ¥æ”¶åˆ°äº†ä¸€ä¸ªæ–°çš„è¯·æ±‚è¿æ¥çš„æ—¶å€™ï¼Œé€šè¿‡ <code>srv.NewConn</code>åˆ›å»ºäº†ä¸€ä¸ªè¿æ¥ç»“æ„ï¼ˆ<code>http.conn</code>ï¼‰ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª Goroutine ä¸ºè¿™ä¸ªè¯·æ±‚è¿æ¥å¯¹åº”æœåŠ¡ï¼ˆ<code>c.serve</code>ï¼‰ã€‚</p><p>ä»ç¬¬å››å±‚å¼€å§‹ï¼Œåé¢å°±æ˜¯å•ä¸ªè¿æ¥çš„æœåŠ¡é€»è¾‘äº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/79/72/798e88645b4d77a3da302a6c6d719472.jpeg?wh=1026x860\" alt=\"\"></p><p>åœ¨<strong>ç¬¬å››å±‚</strong>ï¼Œ<code>c.serve</code>å‡½æ•°å…ˆåˆ¤æ–­æœ¬æ¬¡  HTTP è¯·æ±‚æ˜¯å¦éœ€è¦å‡çº§ä¸º HTTPsï¼Œæ¥ç€åˆ›å»ºè¯»æ–‡æœ¬çš„readerå’Œå†™æ–‡æœ¬çš„bufferï¼Œå†è¿›ä¸€æ­¥è¯»å–æœ¬æ¬¡è¯·æ±‚æ•°æ®ï¼Œç„¶å<strong>ç¬¬äº”å±‚</strong>è°ƒç”¨æœ€å…³é”®çš„æ–¹æ³• <code>serverHandler{c.server}.ServeHTTP(w,&nbsp;w.req)</code> ï¼Œæ¥å¤„ç†è¿™æ¬¡è¯·æ±‚ã€‚</p><p>è¿™ä¸ªå…³é”®æ–¹æ³•æ˜¯ä¸ºäº†å®ç°è‡ªå®šä¹‰çš„è·¯ç”±å’Œä¸šåŠ¡é€»è¾‘ï¼Œè°ƒç”¨å†™æ³•æ˜¯æ¯”è¾ƒæœ‰æ„æ€çš„ï¼š</p><pre><code class=\"language-go\">serverHandler{c.server}.ServeHTTP(w,&nbsp;w.req)\n</code></pre><p>serverHandlerç»“æ„ä½“ï¼Œæ˜¯æ ‡å‡†åº“å°è£…çš„ï¼Œä»£è¡¨â€œè¯·æ±‚å¯¹åº”çš„å¤„ç†é€»è¾‘â€ï¼Œå®ƒåªåŒ…å«äº†ä¸€ä¸ªæŒ‡å‘æ€»å…¥å£æœåŠ¡serverçš„æŒ‡é’ˆã€‚</p><p>è¿™ä¸ªç»“æ„å°†æ€»å…¥å£çš„æœåŠ¡ç»“æ„Serverå’Œæ¯ä¸ªè¿æ¥çš„å¤„ç†é€»è¾‘å·§å¦™è”ç³»åœ¨ä¸€èµ·äº†ï¼Œä½ å¯ä»¥çœ‹æ¥ç€çš„<strong>ç¬¬å…­å±‚</strong>é€»è¾‘ï¼š</p><pre><code class=\"language-go\">// serverHandler ç»“æ„ä»£è¡¨è¯·æ±‚å¯¹åº”çš„å¤„ç†é€»è¾‘\ntype serverHandler struct {\n\tsrv *Server\n}\n\n// å…·ä½“å¤„ç†é€»è¾‘çš„å¤„ç†å‡½æ•°\nfunc (sh serverHandler) ServeHTTP(rw ResponseWriter, req *Request) {\n\thandler := sh.srv.Handler\n\tif handler == nil {\n\t\thandler = DefaultServeMux\n\t}\n\t...\n\thandler.ServeHTTP(rw, req)\n}\n</code></pre><p>å¦‚æœå…¥å£æœåŠ¡serverç»“æ„å·²ç»è®¾ç½®äº† Handlerï¼Œå°±è°ƒç”¨è¿™ä¸ªHandleræ¥å¤„ç†æ­¤æ¬¡è¯·æ±‚ï¼Œåä¹‹åˆ™ä½¿ç”¨åº“è‡ªå¸¦çš„ DefaultServerMuxã€‚</p><p>è¿™é‡Œçš„serverHandlerè®¾è®¡ï¼Œèƒ½åŒæ—¶ä¿è¯è¿™ä¸ªåº“çš„æ‰©å±•æ€§å’Œæ˜“ç”¨æ€§ï¼šä½ å¯ä»¥å¾ˆæ–¹ä¾¿ä½¿ç”¨é»˜è®¤æ–¹æ³•å¤„ç†è¯·æ±‚ï¼Œä½†æ˜¯ä¸€æ—¦æœ‰éœ€æ±‚ï¼Œä¹Ÿèƒ½è‡ªå·±æ‰©å±•å‡ºæ–¹æ³•å¤„ç†è¯·æ±‚ã€‚</p><p>é‚£ä¹ˆDefaultServeMux æ˜¯æ€ä¹ˆå¯»æ‰¾ Handler çš„å‘¢ï¼Œè¿™å°±æ˜¯æ€ç»´å¯¼å›¾çš„æœ€åä¸€éƒ¨åˆ†<strong>ç¬¬ä¸ƒå±‚</strong>ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/34/fe/344fc7d6f2d1aca635ef1284185621fe.png?wh=2268x418\" alt=\"\"></p><p><code>DefaultServeMux.Handle</code> æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ map å®ç°ï¼Œkey æ˜¯è·¯å¾„ï¼ˆpatternï¼‰ï¼Œvalue æ˜¯è¿™ä¸ª pattern å¯¹åº”çš„å¤„ç†å‡½æ•°ï¼ˆhandlerï¼‰ã€‚å®ƒæ˜¯é€šè¿‡ <code>mux.match</code>(path) å¯»æ‰¾å¯¹åº” Handlerï¼Œä¹Ÿå°±æ˜¯ä» DefaultServeMux å†…éƒ¨çš„ map ä¸­ç›´æ¥æ ¹æ® key å¯»æ‰¾åˆ° value çš„ã€‚</p><p>è¿™ç§æ ¹æ® map ç›´æ¥æŸ¥æ‰¾è·¯ç”±çš„æ–¹å¼æ˜¯ä¸æ˜¯å¯ä»¥æ»¡è¶³æˆ‘ä»¬çš„è·¯ç”±éœ€æ±‚å‘¢ï¼Ÿæˆ‘ä»¬ä¼šåœ¨ç¬¬ä¸‰è®²è·¯ç”±ä¸­è¯¦ç»†è§£è¯´ã€‚</p><p>å¥½ï¼ŒHTTPåº“ Server çš„ä»£ç æµç¨‹æˆ‘ä»¬å°±æ¢³ç†å®Œæˆäº†ï¼Œæ•´ä¸ªé€»è¾‘çº¿å¤§è‡´æ˜¯ï¼š</p><pre><code class=\"language-plain\">åˆ›å»ºæœåŠ¡ -&gt; ç›‘å¬è¯·æ±‚ -&gt; åˆ›å»ºè¿æ¥ -&gt; å¤„ç†è¯·æ±‚\n</code></pre><p>å¦‚æœä½ è§‰å¾—å±‚æ¬¡æ¯”è¾ƒå¤šï¼Œå¯¹ç…§ç€æ€ç»´å¯¼å›¾å¤šçœ‹å‡ éå°±é¡ºç•…äº†ã€‚è¿™é‡Œæˆ‘ä¹Ÿç»™ä½ æ•´ç†äº†ä¸€ä¸‹é€»è¾‘çº¿å„å±‚çš„å…³é”®ç»“è®ºï¼š</p><ul>\n<li>ç¬¬ä¸€å±‚ï¼Œæ ‡å‡†åº“åˆ›å»ºHTTPæœåŠ¡æ˜¯é€šè¿‡åˆ›å»ºä¸€ä¸ª Server æ•°æ®ç»“æ„å®Œæˆçš„ï¼›</li>\n<li>ç¬¬äºŒå±‚ï¼ŒServer æ•°æ®ç»“æ„åœ¨forå¾ªç¯ä¸­ä¸æ–­ç›‘å¬æ¯ä¸€ä¸ªè¿æ¥ï¼›</li>\n<li>ç¬¬ä¸‰å±‚ï¼Œæ¯ä¸ªè¿æ¥é»˜è®¤å¼€å¯ä¸€ä¸ª Goroutine ä¸ºå…¶æœåŠ¡ï¼›</li>\n<li>ç¬¬å››ã€äº”å±‚ï¼ŒserverHandler ç»“æ„ä»£è¡¨è¯·æ±‚å¯¹åº”çš„å¤„ç†é€»è¾‘ï¼Œå¹¶ä¸”é€šè¿‡è¿™ä¸ªç»“æ„è¿›è¡Œå…·ä½“ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼›</li>\n<li>ç¬¬å…­å±‚ï¼ŒServer æ•°æ®ç»“æ„å¦‚æœæ²¡æœ‰è®¾ç½®å¤„ç†å‡½æ•° Handlerï¼Œé»˜è®¤ä½¿ç”¨ DefaultServerMuxå¤„ç†è¯·æ±‚ï¼›</li>\n<li>ç¬¬ä¸ƒå±‚ï¼ŒDefaultServerMux æ˜¯ä½¿ç”¨ map ç»“æ„æ¥å­˜å‚¨å’ŒæŸ¥æ‰¾è·¯ç”±è§„åˆ™ã€‚</li>\n</ul><p>å¦‚æœä½ å¯¹ä¸Šé¢å‡ ç‚¹å…³é”®ç»“è®ºè¿˜æœ‰ç–‘æƒ‘çš„ï¼Œå¯ä»¥å†å»çœ‹ä¸€éæ€ç»´å¯¼å›¾ã€‚é˜…è¯»æ ¸å¿ƒé€»è¾‘ä»£ç æ˜¯ä¼šæœ‰ç‚¹æ¯ç‡¥ï¼Œä½†æ˜¯<strong>è¿™æ¡é€»è¾‘çº¿æ˜¯HTTPæœåŠ¡å¯åŠ¨æœ€æ ¸å¿ƒçš„ä¸»æµç¨‹é€»è¾‘</strong>ï¼Œåé¢æˆ‘ä»¬ä¼šåŸºäºè¿™ä¸ªæµç¨‹ç»§ç»­å¼€å‘ï¼Œä½ è¦æŒæ¡åˆ°èƒ½èƒŒä¸‹æ¥çš„ç¨‹åº¦ã€‚åƒä¸‡ä¸è¦è§‰å¾—è¦èƒŒè¯µäº†ï¼Œå‹åŠ›å¤ªå¤§ï¼Œå…¶å®å¯¹ç…§ç€æ€ç»´å¯¼å›¾ï¼Œé¡ºå‡ éé€»è¾‘ï¼Œç†è§£äº†å†è®°å¿†å°±å¾ˆå®¹æ˜“ã€‚</p><h2>åˆ›å»ºæ¡†æ¶çš„Serverç»“æ„</h2><p>ç°åœ¨åŸç†å¼„æ¸…æ¥šäº†ï¼Œè¯¥ä¸‹æ‰‹æ­ HTTP æœåŠ¡äº†ã€‚</p><p>åˆšåˆšå’±ä¹Ÿåˆ†æäº†ä¸»æµç¨‹ä»£ç ï¼Œå…¶ä¸­ç¬¬ä¸€å±‚çš„å…³é”®ç»“è®ºå°±æ˜¯ï¼šnet/http æ ‡å‡†åº“åˆ›å»ºæœåŠ¡ï¼Œå®è´¨ä¸Šå°±æ˜¯é€šè¿‡åˆ›å»º Server æ•°æ®ç»“æ„æ¥å®Œæˆçš„ã€‚æ‰€ä»¥æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥åˆ›å»ºä¸€ä¸ª Server æ•°æ®ç»“æ„ã€‚</p><p>é€šè¿‡ <code>go doc net/http.Server</code> æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Server çš„ç»“æ„ï¼š</p><pre><code class=\"language-go\">type Server struct {\n    // è¯·æ±‚ç›‘å¬åœ°å€\n\tAddr string\n    // è¯·æ±‚æ ¸å¿ƒå¤„ç†å‡½æ•°\n\tHandler Handler \n\t...\n}\n</code></pre><p>å…¶ä¸­æœ€æ ¸å¿ƒçš„æ˜¯ Handlerè¿™ä¸ªå­—æ®µï¼Œä»ä¸»æµç¨‹ä¸­æˆ‘ä»¬çŸ¥é“ï¼ˆç¬¬å…­å±‚å…³é”®ç»“è®ºï¼‰ï¼Œå½“ Handler è¿™ä¸ªå­—æ®µè®¾ç½®ä¸ºç©ºçš„æ—¶å€™ï¼Œå®ƒä¼šé»˜è®¤ä½¿ç”¨ DefaultServerMux è¿™ä¸ªè·¯ç”±å™¨æ¥å¡«å……è¿™ä¸ªå€¼ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šä½¿ç”¨è‡ªå·±å®šä¹‰çš„è·¯ç”±æ¥æ›¿æ¢è¿™ä¸ªé»˜è®¤è·¯ç”±ã€‚</p><p>æ‰€ä»¥åœ¨æ¡†æ¶ä»£ç ä¸­ï¼Œæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„æ ¸å¿ƒè·¯ç”±ç»“æ„ï¼Œå®ç° Handlerã€‚</p><p>å…ˆæ¥ç†ä¸€ä¸‹ç›®å½•ç»“æ„ï¼Œæˆ‘ä»¬åœ¨<a href=\"https://github.com/gohade/coredemo/tree/geekbang/01\">GitHub</a>ä¸Šåˆ›å»ºä¸€ä¸ªé¡¹ç›®coredemoï¼Œè¿™ä¸ªé¡¹ç›®æ˜¯è¿™é—¨è¯¾ç¨‹æ‰€æœ‰çš„ä»£ç é›†åˆï¼ŒåŒ…å«è¦å®ç°çš„æ¡†æ¶å’Œä½¿ç”¨æ¡†æ¶çš„ç¤ºä¾‹ä¸šåŠ¡ä»£ç ã€‚</p><p><strong>æ‰€æœ‰çš„æ¡†æ¶ä»£ç éƒ½å­˜æ”¾åœ¨frameworkæ–‡ä»¶å¤¹ä¸­ï¼Œè€Œæ‰€æœ‰çš„ç¤ºä¾‹ä¸šåŠ¡ä»£ç éƒ½å­˜æ”¾åœ¨frameworkæ–‡ä»¶å¤¹ä¹‹å¤–</strong>ã€‚è¿™é‡Œä¸ºäº†åé¢ç§°å‘¼æ–¹ä¾¿ï¼Œæˆ‘ä»¬å°±æŠŠframeworkæ–‡ä»¶å¤¹å«æ¡†æ¶æ–‡ä»¶å¤¹ï¼Œè€ŒæŠŠå¤–å±‚ç§°ä¸ºä¸šåŠ¡æ–‡ä»¶å¤¹ã€‚</p><p>å½“ç„¶ GitHub ä¸Šçš„è¿™ä¸ªcoredemoæ˜¯æˆ‘åœ¨å†™è¯¾ç¨‹çš„æ—¶å€™ä¸ºäº†æ¼”ç¤ºåˆ›å»ºçš„ï¼Œæ¨èä½ è·Ÿç€ä¸€æ­¥ä¸€æ­¥å†™ã€‚æˆå“åœ¨<a href=\"https://github.com/gohade/hade\">hadeé¡¹ç›®</a>é‡Œï¼Œä½ å¯ä»¥å…ˆçœ‹çœ‹ï¼Œåœ¨æœ€åå‘å¸ƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå°†æ•´ä¸ªé¡¹ç›®è¿›è¡Œå‘å¸ƒã€‚åœ¨ä¸€ä¸ªæ–°çš„ä¸šåŠ¡ä¸­ï¼Œå¦‚æœè¦ä½¿ç”¨åˆ°æˆ‘ä»¬è‡ªå·±å†™å¥½çš„æ¡†æ¶ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡å¼•ç”¨ â€œimport é¡¹ç›®åœ°å€/frameworkâ€ æ¥å¼•å…¥ï¼Œåœ¨æœ€åä¸€éƒ¨åˆ†åšå®æˆ˜é¡¹ç›®çš„æ—¶å€™æˆ‘ä»¬ä¼šå…·ä½“æ¼”ç¤ºã€‚</p><p>å¥½ï¼Œä¸‹é¢æˆ‘ä»¬æ¥ä¸€æ­¥æ­¥å®ç°è¿™ä¸ªé¡¹ç›®ã€‚</p><p>åˆ›å»ºä¸€ä¸ªframeworkæ–‡ä»¶å¤¹ï¼Œæ–°å»ºcore.goï¼Œåœ¨é‡Œé¢å†™å…¥ã€‚</p><pre><code class=\"language-go\">package framework\n\nimport \"net/http\"\n\n// æ¡†æ¶æ ¸å¿ƒç»“æ„\ntype Core struct {\n}\n\n// åˆå§‹åŒ–æ¡†æ¶æ ¸å¿ƒç»“æ„\nfunc NewCore() *Core {\n\treturn &amp;Core{}\n}\n\n// æ¡†æ¶æ ¸å¿ƒç»“æ„å®ç°Handleræ¥å£\nfunc (c *Core) ServeHTTP(response http.ResponseWriter, request *http.Request) {\n\t// TODO\n}\n\n</code></pre><p>è€Œåœ¨ä¸šåŠ¡æ–‡ä»¶å¤¹ä¸­åˆ›å»ºmain.goï¼Œå…¶ä¸­çš„mainå‡½æ•°å°±å˜æˆè¿™æ ·ï¼š</p><pre><code class=\"language-go\">func main() {\n\tserver := &amp;http.Server{\n        // è‡ªå®šä¹‰çš„è¯·æ±‚æ ¸å¿ƒå¤„ç†å‡½æ•°\n\t\tHandler: framework.NewCore(),\n        // è¯·æ±‚ç›‘å¬åœ°å€\n\t\tAddr:&nbsp; &nbsp; \":8080\",\n\t}\n\tserver.ListenAndServe()\n}\n\n</code></pre><p>æ•´ç†ä¸‹è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬é€šè¿‡è‡ªå·±åˆ›å»ºäº† Server æ•°æ®ç»“æ„ï¼Œå¹¶ä¸”åœ¨æ•°æ®ç»“æ„ä¸­åˆ›å»ºäº†è‡ªå®šä¹‰çš„Handlerï¼ˆCoreæ•°æ®ç»“æ„ï¼‰å’Œç›‘å¬åœ°å€ï¼Œå®ç°äº†ä¸€ä¸ª HTTP æœåŠ¡ã€‚è¿™ä¸ªæœåŠ¡çš„å…·ä½“ä¸šåŠ¡é€»è¾‘éƒ½é›†ä¸­åœ¨æˆ‘ä»¬è‡ªå®šä¹‰çš„Coreç»“æ„ä¸­ï¼Œåç»­æˆ‘ä»¬è¦åšçš„äº‹æƒ…å°±æ˜¯ä¸æ–­ä¸°å¯Œè¿™ä¸ªCoreæ•°æ®ç»“æ„çš„åŠŸèƒ½é€»è¾‘ã€‚</p><p>åç»­æ¯èŠ‚è¯¾å­¦å®Œä¹‹åï¼Œæˆ‘éƒ½ä¼šæŠŠä»£ç æ”¾åœ¨å¯¹åº”çš„GitHubçš„åˆ†æ”¯ä¸­ã€‚ä½ è·Ÿç€è¯¾ç¨‹æ•²å®Œä»£ç è¿‡ç¨‹ä¸­æœ‰ä¸äº†è§£çš„åœ°æ–¹ï¼Œå¯ä»¥å¯¹æ¯”å‚è€ƒåˆ†æ”¯ã€‚</p><p>æœ¬èŠ‚è¯¾æˆ‘ä»¬å®Œæˆçš„ä»£ç åˆ†æ”¯æ˜¯ï¼š<a href=\"https://github.com/gohade/coredemo/tree/geekbang/01\">geekbang/01</a> ï¼Œä»£ç ç»“æ„æˆ‘ä¹Ÿæˆªäº†å›¾ï¼š<img src=\"https://static001.geekbang.org/resource/image/2c/d2/2c481d0c93efede365a7e079c4eb49d2.png?wh=734x396\" alt=\"\"></p><h2>å°ç»“</h2><p>ä»Šå¤©æˆ‘ä»¥ net/http æ ‡å‡†åº“ä¸ºä¾‹ï¼Œåˆ†äº«äº†å¿«é€Ÿç†Ÿæ‚‰ä»£ç åº“çš„æŠ€å·§ï¼Œ<strong>åº“å‡½æ•° &gt; ç»“æ„å®šä¹‰ &gt; ç»“æ„å‡½æ•°ã€‚</strong>åœ¨é˜…è¯»ä»£ç åº“æ—¶ï¼Œä»åŠŸèƒ½å‡ºå‘ï¼Œå…ˆè¯»å¯¹å¤–åº“å‡½æ•°ï¼Œå†ç»†è¯»è¿™ä¸ªåº“æä¾›çš„ç»“æ„ï¼Œææ¸…æ¥šåŠŸèƒ½å’Œå¯¹åº”ç»“æ„ä¹‹åï¼Œæœ€ååŸºäºå®é™…éœ€æ±‚çœ‹æ¯ä¸ªç»“æ„å‡½æ•°ã€‚</p><p>è¯»æ¯ä¸ªç»“æ„å‡½æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨æ€ç»´å¯¼å›¾æ¢³ç†äº†net/http åˆ›å»º HTTP æœåŠ¡çš„ä¸»æµç¨‹é€»è¾‘ï¼ŒåŸºäºä¸»æµç¨‹åŸç†ï¼Œåˆ›å»ºäº†ä¸€ä¸ªå±äºæˆ‘ä»¬æ¡†æ¶çš„ Server ç»“æ„ï¼Œä½ å¯ä»¥å†å›é¡¾ä¸€ä¸‹è¿™å¼ å›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/3a/cd/3ab5c45e113ddf4cc3bdb0e09c85c7cd.png?wh=2464x1192\" alt=\"\"></p><p>ä¸»æµç¨‹çš„é“¾æ¡æ¯”è¾ƒé•¿ï¼Œä½†æ˜¯ä½ å…ˆç†é¡ºé€»è¾‘ï¼Œè®°ä½å‡ ä¸ªå…³é”®çš„èŠ‚ç‚¹ï¼Œå†ç»“åˆæ€ç»´å¯¼å›¾ï¼Œå°±èƒ½è®°ä½æ•´ä¸ªä¸»æµç¨‹é€»è¾‘äº†ï¼Œä¹‹åæ‰€æœ‰å…³äº HTTP çš„ç»†èŠ‚å’Œé—®é¢˜ï¼Œæˆ‘ä»¬éƒ½ä¼šåŸºäºè¿™ä¸ªä¸»æµç¨‹é€»è¾‘æ¥æ€è€ƒå’Œå›ç­”ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>ä»Šå¤©æˆ‘ç”¨æ€ç»´å¯¼å›¾æ¢³ç†äº†æœ€æ ¸å¿ƒçš„ HTTP æœåŠ¡å¯åŠ¨çš„ä¸»æµç¨‹é€»è¾‘ï¼ŒçŸ¥æ˜“è¡Œéš¾ï¼Œä½ ä¸å¦¨ç”¨è¿™ä¸ªæ€è·¯åšåšä¸‹é¢è¿™é“æ€è€ƒé¢˜ï¼Œå°è¯•ç»˜åˆ¶å‡ºå±äºä½ è‡ªå·±çš„æ€ç»´å¯¼å›¾ã€‚</p><p>HTTP åº“æä¾› FileServer æ¥å°è£…å¯¹æ–‡ä»¶è¯»å–çš„ HTTP æœåŠ¡ã€‚å®ç°ä»£ç ä¹Ÿéå¸¸ç®€å•ï¼š</p><pre><code class=\"language-go\">fs := http.FileServer(http.Dir(\"/home/bob/static\"))\nhttp.Handle(\"/static/\", http.StripPrefix(\"/static\", fs))\n</code></pre><p>è¯·é—®å®ƒçš„ä¸»æµç¨‹é€»è¾‘æ˜¯ä»€ä¹ˆï¼Ÿä½ è®¤ä¸ºå…¶ä¸­æœ€å…³é”®çš„èŠ‚ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„æ€è€ƒã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œå¦‚æœä½ è§‰å¾—ä»Šå¤©çš„å†…å®¹å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠä»Šå¤©çš„å†…å®¹åˆ†äº«ç»™ä½ èº«è¾¹çš„æœ‹å‹ï¼Œé‚€è¯·ä»–ä¸€èµ·å­¦ä¹ ã€‚</p>","neighbors":{"left":{"article_title":"å¼€ç¯‡è¯ï½œä¸ºä»€ä¹ˆæˆ‘ä»¬è¦ä»é›¶å¼€å‘æ¡†æ¶ï¼Ÿ","id":417657},"right":{"article_title":"02ï½œContextï¼šè¯·æ±‚æ§åˆ¶å™¨ï¼Œè®©æ¯ä¸ªè¯·æ±‚éƒ½åœ¨æŒæ§ä¹‹ä¸­","id":418283}},"comments":[{"had_liked":false,"id":312748,"user_name":"ç¨‹æ—­","can_delete":false,"product_type":"c1","uid":2043208,"ip_address":"","ucode":"D02F98AC07E1D3","user_header":"https://static001.geekbang.org/account/avatar/00/1f/2d/48/bc2648c4.jpg","comment_is_top":false,"comment_ctime":1631965184,"is_pvip":false,"replies":[{"id":"113375","content":"ä½ å¥½ï¼Œä½ çš„é€»è¾‘æ˜¯æ­£ç¡®çš„ï¼Œä¸è¿‡å¯èƒ½è¿‡å¤šå…³æ³¨åˆ†æ”¯ç»†èŠ‚ã€‚åœ¨ä½¿ç”¨æ€ç»´å¯¼å›¾çš„æ—¶å€™ï¼Œå¦‚æœå¯¹äºæ¯”è¾ƒå¤æ‚çš„é€»è¾‘ï¼Œæˆ‘ä»¬éœ€è¦åˆ†æå“ªäº›æ˜¯å…³é”®èŠ‚ç‚¹ï¼Œå“ªäº›æ˜¯éå…³é”®èŠ‚ç‚¹ã€‚<br><br>æ¯”å¦‚FileServer, å…¶å…³é”®ç‚¹æœ‰ä¸¤ä¸ªï¼š<br><br>1  fileHandler æˆ‘ä»¬èƒ½å’ŒListenAndServe è¿æ¥èµ·æ¥ï¼Œå®ƒæä¾›äº†ServeHTTPçš„æ–¹æ³•ï¼Œ è¿™ä¸ªæ˜¯è¯·æ±‚å¤„ç†çš„å…¥å£å‡½æ•°<br><br>2 FileServer æœ€æœ¬è´¨çš„å‡½æ•°æ˜¯å°è£…äº†io.CopyNï¼ŒåŸºæœ¬é€»è¾‘æ˜¯ï¼š<br><br>å¦‚æœæ˜¯è¯»å–æ–‡ä»¶å¤¹ï¼Œåˆ™éå†æ–‡ä»¶å¤¹å†…æ‰€æœ‰æ–‡ä»¶ï¼Œå°†æ–‡ä»¶åç›´æ¥è¾“å‡ºè¿”å›å€¼ã€‚<br>å¦‚æœæ˜¯è¯»å–æ–‡ä»¶ï¼Œåˆ™è®¾ç½®æ–‡ä»¶çš„é˜…è¯»æŒ‡é’ˆï¼ˆå¦‚æœéœ€è¦å¤šæ¬¡è¯»å–æ–‡ä»¶ï¼Œåˆ›å»ºgoroutineï¼Œä¸”ä¸ºæ¯ä¸ªgoroutineåˆ›å»ºé˜…è¯»æŒ‡é’ˆï¼‰ï¼Œä½¿ç”¨io.CopyNè¯»å–æ–‡ä»¶å†…å®¹è¾“å‡ºè¿”å›å€¼ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å¶å‰‘å³°","uid":"1069186","ctime":1632163702,"ip_address":"","comment_id":312748,"utype":1}],"discussion_count":3,"race_medal":0,"score":"87531311104","product_id":100090601,"comment_content":"1. http.FileServer åˆ›å»º FileHandler æ•°æ®ç»“æ„<br>2. FileHandler ç»“æ„ä½“ä¸­åŒ…å« FileSystem æ¥å£ï¼ŒFileSystem æ¥å£åŒ…å«Open æ–¹æ³•<br>3. http.Dir çš„ Open æ–¹æ³• å®ç°  FileSystem æ¥å£ çš„ Open æ–¹æ³•<br>4. http.Dir çš„ Open æ–¹æ³•å¯¹è¡¨ç¤ºå­—ç¬¦ä¸²çš„æ–‡ä»¶è·¯å¾„è¿›è¡Œåˆ¤æ–­ï¼š<br>    ï¼ˆ1ï¼‰å…ˆåˆ¤æ–­ åˆ†éš”ç¬¦æ˜¯å¦ä¸º &quot;&#47;&quot;ä¸”è¯¥å­—ç¬¦ä¸²ä¸­æ˜¯å¦åŒ…å«åˆ†éš”ç¬¦ï¼Œè‹¥ä¸æ»¡è¶³ è¿”å› nil å’Œ errorä¿¡æ¯ &quot;http: invalid character in file path&quot;<br>    ï¼ˆ2ï¼‰å°† http.Dir ä» Dir ç±»å‹è½¬æ¢ä¸º string ç±»å‹ï¼Œåˆ¤æ–­è¯¥æ˜¯å¦ä¸ºç©ºï¼Œè‹¥ä¸ºç©ºï¼Œå°† dir èµ‹å€¼ä¸º &quot;.&quot;<br>    ï¼ˆ3ï¼‰ä½¿ç”¨ path.Clean ï¼Œfilepath.FromSlash å’Œ filepath.Join æ–¹æ³•è·å¾—è·¯å¾„å…¨å<br>    ï¼ˆ4ï¼‰ä½¿ç”¨ os.Open æ–¹æ³•æ‰“å¼€æ–‡ä»¶ï¼Œå¦‚æœæ‰“å¼€å¤±è´¥ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯ï¼Œå¦‚æœæˆåŠŸä»¥è¯»æ¨¡å¼æ‰“å¼€æ–‡ä»¶","like_count":21,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527099,"discussion_content":"ä½ å¥½ï¼Œä½ çš„é€»è¾‘æ˜¯æ­£ç¡®çš„ï¼Œä¸è¿‡å¯èƒ½è¿‡å¤šå…³æ³¨åˆ†æ”¯ç»†èŠ‚ã€‚åœ¨ä½¿ç”¨æ€ç»´å¯¼å›¾çš„æ—¶å€™ï¼Œå¦‚æœå¯¹äºæ¯”è¾ƒå¤æ‚çš„é€»è¾‘ï¼Œæˆ‘ä»¬éœ€è¦åˆ†æå“ªäº›æ˜¯å…³é”®èŠ‚ç‚¹ï¼Œå“ªäº›æ˜¯éå…³é”®èŠ‚ç‚¹ã€‚\n\næ¯”å¦‚FileServer, å…¶å…³é”®ç‚¹æœ‰ä¸¤ä¸ªï¼š\n\n1  fileHandler æˆ‘ä»¬èƒ½å’ŒListenAndServe è¿æ¥èµ·æ¥ï¼Œå®ƒæä¾›äº†ServeHTTPçš„æ–¹æ³•ï¼Œ è¿™ä¸ªæ˜¯è¯·æ±‚å¤„ç†çš„å…¥å£å‡½æ•°\n\n2 FileServer æœ€æœ¬è´¨çš„å‡½æ•°æ˜¯å°è£…äº†io.CopyNï¼ŒåŸºæœ¬é€»è¾‘æ˜¯ï¼š\n\nå¦‚æœæ˜¯è¯»å–æ–‡ä»¶å¤¹ï¼Œåˆ™éå†æ–‡ä»¶å¤¹å†…æ‰€æœ‰æ–‡ä»¶ï¼Œå°†æ–‡ä»¶åç›´æ¥è¾“å‡ºè¿”å›å€¼ã€‚\nå¦‚æœæ˜¯è¯»å–æ–‡ä»¶ï¼Œåˆ™è®¾ç½®æ–‡ä»¶çš„é˜…è¯»æŒ‡é’ˆï¼ˆå¦‚æœéœ€è¦å¤šæ¬¡è¯»å–æ–‡ä»¶ï¼Œåˆ›å»ºgoroutineï¼Œä¸”ä¸ºæ¯ä¸ªgoroutineåˆ›å»ºé˜…è¯»æŒ‡é’ˆï¼‰ï¼Œä½¿ç”¨io.CopyNè¯»å–æ–‡ä»¶å†…å®¹è¾“å‡ºè¿”å›å€¼ã€‚","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1632163702,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2536820,"avatar":"https://static001.geekbang.org/account/avatar/00/26/b5/74/cd80b9f4.jpg","nickname":"å‹","note":"","ucode":"972A4333A8B101","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"discussion":{"id":534372,"discussion_content":"ç¡®å®æ²¡æƒ³åˆ°è€å¸ˆè¿˜ä¼šçœ‹ç¬¬ä¸€ç« çš„è¯„è®º è®©æˆ‘æœ‰æ¯å¤©åœ¨è¯„è®ºä¸‹é¢äº¤ä½œä¸šçš„åŠ¨åŠ›äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638174843,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":527099,"ip_address":""},"score":534372,"extra":""}]},{"author":{"id":2043208,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/2d/48/bc2648c4.jpg","nickname":"ç¨‹æ—­","note":"","ucode":"D02F98AC07E1D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":397468,"discussion_content":"å¤šè°¢ä½œè€…æŒ‡å¯¼ï¼Œå†™çš„æ—¶å€™æ€»æ„Ÿè§‰è‡ªå·±æœ‰ç‚¹è·‘åã€‚\nä¸è¿‡è¿™æ¬¡æºç é˜…è¯»æœ‰ä¸ªæ„å¤–æ”¶è·ï¼Œæˆ‘å‘ç° Rune ç±»å‹ æ˜¯é€šè¿‡ RuneSelf è¿™ä¸ªå¸¸é‡æ¥åšRuneç±»å‹çš„åˆ¤æ–­ï¼ŒRuneSelf çš„å€¼è®¾ç½®ä¸º 0x80 ï¼Œå°äº 0x80 åˆ™ä¸ºå•ä¸ªå­—ç¬¦ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1632625428,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":311984,"user_name":"return","can_delete":false,"product_type":"c1","uid":1135528,"ip_address":"","ucode":"42B8A3380DF04B","user_header":"https://static001.geekbang.org/account/avatar/00/11/53/a8/abc96f70.jpg","comment_is_top":false,"comment_ctime":1631584593,"is_pvip":false,"replies":[{"id":"113071","content":"æ©ï¼Œæˆ‘å¹³æ—¶é˜…è¯»æºç å°±æ˜¯è¿™æ ·é˜…è¯»çš„ã€‚ç»éªŒä¹‹è°ˆã€‚æ„Ÿè°¢æ”¯æŒã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å¶å‰‘å³°","uid":"1069186","ctime":1631599822,"ip_address":"","comment_id":311984,"utype":1}],"discussion_count":1,"race_medal":0,"score":"53171192145","product_id":100090601,"comment_content":"å¾ˆèµï¼Œ è¯»æºç çš„ æ€è·¯å’Œ æ€ç»´å¯¼å›¾ å¾ˆå€¼å¾—å­¦ä¹ ","like_count":13,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526820,"discussion_content":"æ©ï¼Œæˆ‘å¹³æ—¶é˜…è¯»æºç å°±æ˜¯è¿™æ ·é˜…è¯»çš„ã€‚ç»éªŒä¹‹è°ˆã€‚æ„Ÿè°¢æ”¯æŒã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631599822,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":311982,"user_name":"Middleware","can_delete":false,"product_type":"c1","uid":1072015,"ip_address":"","ucode":"C0028293ECDD47","user_header":"https://static001.geekbang.org/account/avatar/00/10/5b/8f/4b0ab5db.jpg","comment_is_top":false,"comment_ctime":1631583765,"is_pvip":true,"replies":[{"id":"113123","content":"ä½ å¥½ï¼Œåœ¨åé¢æœ‰ä¸€ç« ä¼šä¸“é—¨ä»‹ç»ç›®å½•çš„ç« èŠ‚ï¼Œå«ã€Šå¦‚ä½•ç³»ç»Ÿè®¾è®¡æ¡†æ¶çš„æ•´ä½“ç›®å½•ã€‹ã€‚æ¯ä¸€ä¸ªç« èŠ‚ï¼Œæˆ‘éƒ½æœ‰å­˜æ”¾æºç åœ¨githubé¡¹ç›®çš„å¯¹åº”åˆ†æ”¯ï¼Œå¦‚æœå¸Œæœ›è·Ÿç€ä¸Šæ‰‹æ•²ä¸€éï¼Œå¯ä»¥è·Ÿç€æ–‡ç« æ•²å®Œä»£ç ï¼Œè·Ÿç€å¯¹åº”åˆ†æ”¯å¯¹ä¸€éã€‚https:&#47;&#47;github.com&#47;gohade&#47;coredemo&#47;tree&#47;geekbang&#47;01<br><br>è°¢è°¢æ”¯æŒï¼Œå¦å¤–ä¸ºä½ çš„ID middleware ç‚¹ä¸ªèµã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å¶å‰‘å³°","uid":"1069186","ctime":1631670625,"ip_address":"","comment_id":311982,"utype":1}],"discussion_count":3,"race_medal":0,"score":"40286289429","product_id":100090601,"comment_content":"ç›®å½•æœ‰ç‚¹ä¸æ¸…æ™°ï¼Œä»é›¶å¼€å§‹ï¼Œé‚£ä¹ˆæ˜¯ä¸æ˜¯åº”è¯¥ç»™å‡ºå»ºç«‹åˆé€‚çš„æ–‡ä»¶ç›®å½•ç»“æ„ï¼Œå‘½åã€‚æˆ‘ä»¬ä¹Ÿèƒ½è·Ÿç€ä¸Šæ‰‹æ•²ä¸€éã€‚æ¯”å¦‚è¿™ä¸ª framework .ç›®å½•æ˜¯å¦‚ä½•å‘½åã€‚å¸Œæœ›è€å¸ˆçœŸçš„èƒ½æ‰‹æŠŠæ‰‹","like_count":9,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526819,"discussion_content":"ä½ å¥½ï¼Œåœ¨åé¢æœ‰ä¸€ç« ä¼šä¸“é—¨ä»‹ç»ç›®å½•çš„ç« èŠ‚ï¼Œå«ã€Šå¦‚ä½•ç³»ç»Ÿè®¾è®¡æ¡†æ¶çš„æ•´ä½“ç›®å½•ã€‹ã€‚æ¯ä¸€ä¸ªç« èŠ‚ï¼Œæˆ‘éƒ½æœ‰å­˜æ”¾æºç åœ¨githubé¡¹ç›®çš„å¯¹åº”åˆ†æ”¯ï¼Œå¦‚æœå¸Œæœ›è·Ÿç€ä¸Šæ‰‹æ•²ä¸€éï¼Œå¯ä»¥è·Ÿç€æ–‡ç« æ•²å®Œä»£ç ï¼Œè·Ÿç€å¯¹åº”åˆ†æ”¯å¯¹ä¸€éã€‚https://github.com/gohade/coredemo/tree/geekbang/01\n\nè°¢è°¢æ”¯æŒï¼Œå¦å¤–ä¸ºä½ çš„ID middleware ç‚¹ä¸ªèµã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631670625,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1072015,"avatar":"https://static001.geekbang.org/account/avatar/00/10/5b/8f/4b0ab5db.jpg","nickname":"Middleware","note":"","ucode":"C0028293ECDD47","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393993,"discussion_content":"Nice ï¼Œæ„Ÿè°¢è€å¸ˆçš„å›å¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631681179,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1242122,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f4/0a/cf728857.jpg","nickname":"YourSweetHeart","note":"","ucode":"38843F447B03F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393858,"discussion_content":"å¼ºå­nb","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631619458,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312326,"user_name":"å¥½å®¶åº­","can_delete":false,"product_type":"c1","uid":1727613,"ip_address":"","ucode":"29A192102E0095","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyibojtJCnzAE7E8sMqgiaiaAHl3FuzcXcicQnjnT5huUFMxGUMzV5NGuqzzHHr8dBzCs3xfuhwcOnPw/132","comment_is_top":false,"comment_ctime":1631752242,"is_pvip":false,"replies":[{"id":"113373","content":"httpæœåŠ¡åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šé»˜è®¤å¼€å¯keep-aliveæœºåˆ¶ã€‚keep-aliveæœºåˆ¶å°±æ˜¯ä¸€ä¸ªè¿æ¥åœ¨ä¸€ä¸ªè¯·æ±‚ç»“æŸä¹‹åï¼Œå¹¶ä¸å…³é—­å½“å‰è¿æ¥ï¼Œåœ¨ä¸‹ä¸ªè¯·æ±‚çš„æ—¶å€™ä¹Ÿèƒ½ä½¿ç”¨è¿™ä¸ªè¿æ¥ã€‚è¿™ä¸ªforå¾ªç¯å°±æ˜¯ä¸ºkeep-aliveæœºåˆ¶æœåŠ¡çš„ã€‚åœ¨æœåŠ¡ä¸€ä¸ªè¿æ¥çš„æ—¶å€™ï¼Œå¤„ç†å®Œä¸€ä¸ªè¯·æ±‚ï¼Œå¹¶ä¸å…³é—­è¿™ä¸ªè¿æ¥ï¼Œè€Œæ˜¯å¾ªç¯ç­‰å¾…ä¸‹ä¸ªè¯·æ±‚ã€‚<br><br>é‚£è¦å…³é—­keep-aliveæ€ä¹ˆåŠå‘¢ï¼Ÿä½ ä¹Ÿå¯ä»¥åœ¨forå¾ªç¯ä¸­çš„w.conn.server.doKeepAlives çœ‹åˆ°ï¼Œå®ƒåˆ¤æ–­å¦‚æœæœåŠ¡ç«¯çš„ disableKeepAlives ä¸æ˜¯0ï¼Œåˆ™è®¾ç½®äº†å…³é—­keep-aliveï¼Œåˆ™å°±ä¸è¿›è¡Œforå¾ªç¯äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å¶å‰‘å³°","uid":"1069186","ctime":1632162839,"ip_address":"","comment_id":312326,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27401556018","product_id":100090601,"comment_content":"è€å¸ˆï¼Œè¯·é—® go c.serve(connCtx) é‡Œé¢ä¸ºä»€ä¹ˆè¿˜æœ‰ä¸€ä¸ªå¾ªç¯ï¼Ÿcå€¼å¾—æ˜¯ä¸€ä¸ªconnectionï¼Œæˆ‘ç†è§£ä¸æ˜¯æ¯ä¸ªè¿æ¥å¤„ç†ä¸€æ¬¡å°±å¥½äº†å—ï¼Œä¸ºå•¥è¿˜æœ‰ä¸€ä¸ªforå¾ªç¯å‘¢ï¼Ÿ<br>Â·Â·Â·<br>&#47; Serve a new connection.<br>func (c *conn) serve(ctx context.Context) {<br>\tc.remoteAddr = c.rwc.RemoteAddr().String()<br>\tctx = context.WithValue(ctx, LocalAddrContextKey, c.rwc.LocalAddr())<br>\tdefer func() {<br>\t\tif err := recover(); err != nil &amp;&amp; err != ErrAbortHandler {<br>\t\t\tconst size = 64 &lt;&lt; 10<br>\t\t\tbuf := make([]byte, size)<br>\t\t\tbuf = buf[:runtime.Stack(buf, false)]<br>\t\t\tc.server.logf(&quot;http: panic serving %v: %v\\n%s&quot;, c.remoteAddr, err, buf)<br>\t\t}<br>\t\tif !c.hijacked() {<br>\t\t\tc.close()<br>\t\t\tc.setState(c.rwc, StateClosed)<br>\t\t}<br>\t}()<br><br>\t...<br><br>\tfor {<br>\t\tw, err := c.readRequest(ctx)<br>\t\tif c.r.remain != c.server.initialReadLimitSize() {<br>\t\t\t&#47;&#47; If we read any bytes off the wire, we&#39;re active.<br>\t\t\tc.setState(c.rwc, StateActive)<br>\t\t}<br>\t\tif err != nil {<br>\t\t\tconst errorHeaders = &quot;\\r\\nContent-Type: text&#47;plain; charset=utf-8\\r\\nConnection: close\\r\\n\\r\\n&quot;<br><br>...<br>\t\t}<br>...<br>```","like_count":7,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526937,"discussion_content":"httpæœåŠ¡åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šé»˜è®¤å¼€å¯keep-aliveæœºåˆ¶ã€‚keep-aliveæœºåˆ¶å°±æ˜¯ä¸€ä¸ªè¿æ¥åœ¨ä¸€ä¸ªè¯·æ±‚ç»“æŸä¹‹åï¼Œå¹¶ä¸å…³é—­å½“å‰è¿æ¥ï¼Œåœ¨ä¸‹ä¸ªè¯·æ±‚çš„æ—¶å€™ä¹Ÿèƒ½ä½¿ç”¨è¿™ä¸ªè¿æ¥ã€‚è¿™ä¸ªforå¾ªç¯å°±æ˜¯ä¸ºkeep-aliveæœºåˆ¶æœåŠ¡çš„ã€‚åœ¨æœåŠ¡ä¸€ä¸ªè¿æ¥çš„æ—¶å€™ï¼Œå¤„ç†å®Œä¸€ä¸ªè¯·æ±‚ï¼Œå¹¶ä¸å…³é—­è¿™ä¸ªè¿æ¥ï¼Œè€Œæ˜¯å¾ªç¯ç­‰å¾…ä¸‹ä¸ªè¯·æ±‚ã€‚\n\né‚£è¦å…³é—­keep-aliveæ€ä¹ˆåŠå‘¢ï¼Ÿä½ ä¹Ÿå¯ä»¥åœ¨forå¾ªç¯ä¸­çš„w.conn.server.doKeepAlives çœ‹åˆ°ï¼Œå®ƒåˆ¤æ–­å¦‚æœæœåŠ¡ç«¯çš„ disableKeepAlives ä¸æ˜¯0ï¼Œåˆ™è®¾ç½®äº†å…³é—­keep-aliveï¼Œåˆ™å°±ä¸è¿›è¡Œforå¾ªç¯äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632162839,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312632,"user_name":"Groot","can_delete":false,"product_type":"c1","uid":1001257,"ip_address":"","ucode":"D3919AFA300C79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/47/29/425a2030.jpg","comment_is_top":false,"comment_ctime":1631902124,"is_pvip":false,"replies":[{"id":"113322","content":"ä½ å¥½ï¼Œéå¸¸æ„Ÿè°¢æ”¯æŒã€‚éå¸¸é«˜å…´æœ¬ç¯‡èƒ½è®©ä½ æœ‰ä¸€äº›æ”¶è·ã€‚åç»­æ–‡ç« æ˜¯ä»‹ç»å†™æ¡†æ¶çš„è¿‡ç¨‹çš„ã€‚æ„Ÿè°¢ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å¶å‰‘å³°","uid":"1069186","ctime":1632016676,"ip_address":"","comment_id":312632,"utype":1}],"discussion_count":2,"race_medal":0,"score":"18811771308","product_id":100090601,"comment_content":"ä¸€ç¯‡æ–‡ç« å€¼å›ç¥¨ä»·ï¼Œæ„Ÿè§‰åç»­çš„æ–‡ç« éƒ½æ˜¯åœ¨åšæ…ˆå–„ ğŸ˜‚<br><br>å—ç›ŠåŒªæµ…ï¼Œæ„Ÿè°¢åˆ†äº« ğŸ‘","like_count":4,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527055,"discussion_content":"ä½ å¥½ï¼Œéå¸¸æ„Ÿè°¢æ”¯æŒã€‚éå¸¸é«˜å…´æœ¬ç¯‡èƒ½è®©ä½ æœ‰ä¸€äº›æ”¶è·ã€‚åç»­æ–‡ç« æ˜¯ä»‹ç»å†™æ¡†æ¶çš„è¿‡ç¨‹çš„ã€‚æ„Ÿè°¢ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632016676,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1001257,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/29/425a2030.jpg","nickname":"Groot","note":"","ucode":"D3919AFA300C79","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":397981,"discussion_content":"è¿™ä¸ªä¸“æ çœ‹åˆ° 05 èŠ‚å°±æœæ–­æ”¾å¼ƒäº†ï¼Œåé¢å†™çš„ä»£ç å®åœ¨ä»¤äººä¸æ•¢æ­ç»´ï¼Œè¿˜ä¸å¦‚å»çœ‹ Github ä¸Šä¼˜ç§€çš„æ¡†æ¶æºç \n\nè¿™èŠ‚ä»‹ç»çš„çœ‹æºç çš„æ–¹æ³•æŒºä¸é”™ï¼Œå¯ä»¥ç›´æ¥ç”¨èµ·æ¥äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632710308,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312577,"user_name":"å¸ƒä¸è€å®","can_delete":false,"product_type":"c1","uid":1363166,"ip_address":"","ucode":"72B86A2BE251E2","user_header":"https://static001.geekbang.org/account/avatar/00/14/cc/de/59a530dc.jpg","comment_is_top":false,"comment_ctime":1631872363,"is_pvip":false,"replies":[{"id":"113374","content":"æ˜¯çš„ï¼Œç¡®å®æ˜¯é¡ºåºé”™è¯¯ï¼Œå·²ç»è”ç³»ç¼–è¾‘è¿›è¡Œä¿®æ”¹äº†ã€‚æ„Ÿè°¢æé†’ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å¶å‰‘å³°","uid":"1069186","ctime":1632163116,"ip_address":"","comment_id":312577,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14516774251","product_id":100090601,"comment_content":"è€å¸ˆï¼ŒHTTP åº“ Server çš„ä»£ç æµç¨‹æ˜¯ä¸æ˜¯åº”è¯¥ä¸ºï¼šåˆ›å»ºæœåŠ¡ -&gt; ç›‘å¬è¯·æ±‚ -&gt; åˆ›å»ºè¿æ¥ -&gt; å¤„ç†è¯·æ±‚ è¦æ›´å‡†ç¡®ä¸€ç‚¹ï¼Ÿå› ä¸ºnet.Listenæ˜¯åœ¨srv.newConnä¹‹å‰è¿›è¡Œçš„ã€‚","like_count":3,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527033,"discussion_content":"æ˜¯çš„ï¼Œç¡®å®æ˜¯é¡ºåºé”™è¯¯ï¼Œå·²ç»è”ç³»ç¼–è¾‘è¿›è¡Œä¿®æ”¹äº†ã€‚æ„Ÿè°¢æé†’ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632163116,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313136,"user_name":"ghostwritten","can_delete":false,"product_type":"c1","uid":1308196,"ip_address":"","ucode":"AE512F2E24A1A0","user_header":"https://static001.geekbang.org/account/avatar/00/13/f6/24/5a9277f1.jpg","comment_is_top":false,"comment_ctime":1632293979,"is_pvip":false,"replies":[{"id":"113506","content":"ğŸ‘åšæŒä¸€èµ·ä»—å‰‘èµ°å¤©æ¶¯","user_name":"ä½œè€…å›å¤","user_name_real":"å¤šå°‘","uid":"2547771","ctime":1632414754,"ip_address":"","comment_id":313136,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10222228571","product_id":100090601,"comment_content":"æ‰“å¡ç¬¬äºŒå¤©ï¼š<br>https:&#47;&#47;github.com&#47;gohade&#47;coredemo&#47;blob&#47;geekbang&#47;01&#47;go.mod<br>https:&#47;&#47;datatracker.ietf.org&#47;doc&#47;html&#47;rfc2616<br>https:&#47;&#47;github.com&#47;valyala&#47;fasthttp<br>https:&#47;&#47;pkg.go.dev&#47;net&#47;http@go1.15.5<br><br>Web Server ç¬¬ä¸€ä¸ªgoæ¶æ„ï¼šnet&#47;http<br>ç†Ÿæ‚‰åº“æŠ€å·§ï¼šåº“å‡½æ•° &gt; ç»“æ„å®šä¹‰ &gt; ç»“æ„å‡½æ•°<br>æŸ¥çœ‹åº“å‘½ä»¤ï¼š<br>go doc net&#47;http | grep &quot;^func<br>go doc net&#47;http | grep &quot;^type&quot;|grep struct<br><br>ç»“æ„å‡½æ•°å¦‚ä¸‹ï¼š<br>&#47;&#47; åˆ›å»ºä¸€ä¸ªFooè·¯ç”±å’Œå¤„ç†å‡½æ•°<br>http.Handle(&quot;&#47;foo&quot;, fooHandler)<br><br>&#47;&#47; åˆ›å»ºä¸€ä¸ªbarè·¯ç”±å’Œå¤„ç†å‡½æ•°<br>http.HandleFunc(&quot;&#47;bar&quot;, func(w http.ResponseWriter, r *http.Request) {<br>  fmt.Fprintf(w, &quot;Hello, %q&quot;, html.EscapeString(r.URL.Path))<br>})<br><br>&#47;&#47; ç›‘å¬8080ç«¯å£<br>log.Fatal(http.ListenAndServe(&quot;:8080&quot;, nil))<br><br>ç”»æºä»£ç åˆ†æå›¾ï¼Œå­¦ä¼šè„‘å›¾æ„æ€æ˜¯å…³é”®ï¼ˆç•¥ï¼‰<br>æµç¨‹ï¼š<br> - ç¬¬ä¸€å±‚ï¼Œæ ‡å‡†åº“åˆ›å»º HTTP æœåŠ¡æ˜¯é€šè¿‡åˆ›å»ºä¸€ä¸ª Server æ•°æ®ç»“æ„å®Œæˆçš„ï¼›<br> - ç¬¬äºŒå±‚ï¼ŒServer æ•°æ®ç»“æ„åœ¨ for å¾ªç¯ä¸­ä¸æ–­ç›‘å¬æ¯ä¸€ä¸ªè¿æ¥ï¼›<br> - ç¬¬ä¸‰å±‚ï¼Œæ¯ä¸ªè¿æ¥é»˜è®¤å¼€å¯ä¸€ä¸ª Goroutine ä¸ºå…¶æœåŠ¡ï¼›<br> - ç¬¬å››ã€äº”å±‚ï¼ŒserverHandler ç»“æ„ä»£è¡¨è¯·æ±‚å¯¹åº”çš„å¤„ç†é€»è¾‘ï¼Œå¹¶ä¸”é€šè¿‡è¿™ä¸ªç»“æ„è¿›è¡Œå…·ä½“ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼›<br> - ç¬¬å…­å±‚ï¼ŒServer æ•°æ®ç»“æ„å¦‚æœæ²¡æœ‰è®¾ç½®å¤„ç†å‡½æ•° Handlerï¼Œé»˜è®¤ä½¿ç”¨ `DefaultServerMux` å¤„ç†è¯·æ±‚ï¼›<br> - ç¬¬ä¸ƒå±‚ï¼Œ`DefaultServerMux` æ˜¯ä½¿ç”¨ map ç»“æ„æ¥å­˜å‚¨å’ŒæŸ¥æ‰¾è·¯ç”±è§„åˆ™ã€‚<br><br><br>åˆ›å»ºæ¡†æ¶çš„ Server ç»“æ„<br>1.åˆ›å»ºä¸€ä¸ª coredemo&#47;framework&#47;core.go,å®ç°å…·ä½“ä¸šåŠ¡é€»è¾‘<br>&#47;&#47; æ¡†æ¶æ ¸å¿ƒç»“æ„<br>type Core struct {<br>}<br><br>&#47;&#47; åˆå§‹åŒ–æ¡†æ¶æ ¸å¿ƒç»“æ„<br>func NewCore() *Core {<br>  return &amp;Core{}<br>}<br><br>&#47;&#47; æ¡†æ¶æ ¸å¿ƒç»“æ„å®ç°Handleræ¥å£<br>func (c *Core) ServeHTTP(response http.ResponseWriter, request *http.Request) {<br>  &#47;&#47; TODO<br>}<br><br>2.åˆ›å»ºä¸€ä¸ª coredemo&#47;main.go,åˆ›å»ºæœåŠ¡çš„æ–¹æ³• `ListenAndServe` å…ˆå®šä¹‰äº†ç›‘å¬ä¿¡æ¯ `net.Listen`ï¼Œç„¶åè°ƒç”¨ `Serve` å‡½æ•°,å®ç°å¯¹å¤–æä¾›æœåŠ¡<br><br>","like_count":2,"discussions":[{"author":{"id":2547771,"avatar":"https://static001.geekbang.org/account/avatar/00/26/e0/3b/8ec916b2.jpg","nickname":"å¤šå°‘","note":"","ucode":"0A6EF7AA6E4BB7","race_medal":0,"user_type":4,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527246,"discussion_content":"ğŸ‘åšæŒä¸€èµ·ä»—å‰‘èµ°å¤©æ¶¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632414754,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312229,"user_name":"é€—é€¼ç« é±¼","can_delete":false,"product_type":"c1","uid":1197314,"ip_address":"","ucode":"5E8A5E1CC375B7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEJfTnE46bP9zFU0MJicYZmKYTPhm97YjgSEmNVKr3ic1BY3CL8ibPUFCBVTqyoHQPpBcbe9GRKEN1CyA/132","comment_is_top":false,"comment_ctime":1631694842,"is_pvip":false,"replies":[{"id":"113372","content":"æ˜¯çš„ï¼Œä¸»è¦åœ¨äºç¬¬å…­å±‚çš„ServeHTTPï¼Œä¸åŒçš„handlerå®ç°çš„ServeHTTPæ˜¯ä¸ä¸€æ ·çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å¶å‰‘å³°","uid":"1069186","ctime":1632162014,"ip_address":"","comment_id":312229,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10221629434","product_id":100090601,"comment_content":"FileServer çš„ä¸»è¦æµç¨‹å‰é¢äº”å±‚åº”è¯¥éƒ½ä¸€æ ·ï¼Œç¬¬å…­å±‚å¼€å§‹ä¸ä¸€æ ·ï¼ŒFileServer --&gt; fileHandler --&gt; fileHandleré‡Œå®ç°çš„ ServeHTTP --&gt; serveFile ã€‚","like_count":2,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526903,"discussion_content":"æ˜¯çš„ï¼Œä¸»è¦åœ¨äºç¬¬å…­å±‚çš„ServeHTTPï¼Œä¸åŒçš„handlerå®ç°çš„ServeHTTPæ˜¯ä¸ä¸€æ ·çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632162014,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356975,"user_name":"æ— éš…","can_delete":false,"product_type":"c1","uid":1058801,"ip_address":"å¹¿ä¸œ","ucode":"756E8D6E915FF0","user_header":"https://static001.geekbang.org/account/avatar/00/10/27/f1/e4fc57a3.jpg","comment_is_top":false,"comment_ctime":1662775744,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1662775744","product_id":100090601,"comment_content":"ç®—æ³•æœ‰æ—¶è¦å†™æœåŠ¡ç«¯ç¨‹åºï¼Œæœgoçœ‹åˆ°è¿™é—¨è¯¾ï¼Œæ„å¤–çš„æƒŠå–œï½","like_count":1},{"had_liked":false,"id":356937,"user_name":"å°é©¬ğŸ","can_delete":false,"product_type":"c1","uid":1107540,"ip_address":"ä¸Šæµ·","ucode":"8CA466A4004BDB","user_header":"https://static001.geekbang.org/account/avatar/00/10/e6/54/86056001.jpg","comment_is_top":false,"comment_ctime":1662711690,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1662711690","product_id":100090601,"comment_content":"ä»£ç ä¸­NewCoreè¿”å›æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„coreç»“æ„ä½“ å¦‚ä½•å’Œå°è£…å¥½çš„serveré‡Œé¢çš„handleræˆä¸ºäº†åŒä¸€ä¸ªç±»å‹ï¼Ÿä¸æŠ¥é”™çš„å˜›ï¼Ÿè¿˜è¯·æŒ‡æ•™ä¸‹ï¼","like_count":0},{"had_liked":false,"id":331984,"user_name":"è€å…µ","can_delete":false,"product_type":"c1","uid":1471109,"ip_address":"","ucode":"F004F8EC90E5B0","user_header":"https://static001.geekbang.org/account/avatar/00/16/72/85/c337e9a1.jpg","comment_is_top":false,"comment_ctime":1642940730,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1642940730","product_id":100090601,"comment_content":"1. ä½¿ç”¨go doc net&#47;http.FileServer | grep &#39;^func&#39; å¾—åˆ°ç»“æœ func FileServer(root FileSystem) Handler<br>2. ä½¿ç”¨fsä½œä¸ºhandlerä¼ é€’ç»™http.Handle ä½œä¸ºå‚æ•°ï¼Œè¿™æ ·å¯ä»¥æ›´åŠ routeçš„mapï¼Œå¾—åˆ°fsä½œä¸ºé™æ€æ–‡ä»¶çš„handleræ–¹æ³•ã€‚<br>3. FileServeræ–¹æ³•ä¸­åˆ›å»ºä¸€ä¸ªfileHandlerçš„ç»“æ„ï¼Œæ–‡ä»¶è·¯å¾„ä½œä¸ºrootè¢«ä¼ å…¥fileHandlerçš„ç»“æ„ä¸­ã€‚ä¸æ­¤åŒæ—¶handleréƒ½éœ€è¦å®ç°ServeHTTPçš„æ–¹æ³•ã€‚<br>4. fileHanlder.ServeHTTP æ–¹æ³•ä¸­åœ¨ä½¿ç”¨&quot;upath := r.URL.Path&quot;å¾—åˆ°upathåï¼Œå°†è¿™ä¸ªè·¯å¾„ä½œä¸ºæ–‡ä»¶è·¯å¾„è°ƒç”¨serveFileæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ ¹æ®è¯·æ±‚æ–‡ä»¶è¿›è¡ŒOpenæ“ä½œã€‚<br>5. æœ€åå°†æ–‡ä»¶è¯»å–çš„å†…å®¹ä½œä¸ºå‚æ•°è°ƒç”¨serveContentæ–¹æ³•ï¼Œæ–¹æ³•ä¸­å¯¹ioæ“ä½œè¿›è¡Œå¤„ç†ï¼Œæœ€åio.CopyNå°†contentèµ‹å€¼åˆ°wï¼ˆResponseWriterï¼‰ä¸­ï¼Œä¹Ÿå°±æ˜¯response","like_count":0},{"had_liked":false,"id":325547,"user_name":"Geek_8ed998","can_delete":false,"product_type":"c1","uid":1793879,"ip_address":"","ucode":"1C164836354665","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLJHTX1IwEl1Eh1CCO2ejL2gKe08Vxib61UZz9l5WGA81ObK0Nk5MCZ3ic6IWcW5kyX0DtwBNMEMl2Q/132","comment_is_top":false,"comment_ctime":1639019898,"is_pvip":false,"replies":[{"id":"118657","content":"è¿™ä¸ªæ˜¯gomodçš„æœºåˆ¶ï¼Œå¦‚æœä½ çš„é¡¹ç›®åœ¨gomodä¸­å‘½åä¸ºcoredemoï¼Œ é‚£ä¹ˆcoredemo&#47;frameworkå°±ä¼šå»ä½ çš„é¡¹ç›®ä¸‹çš„frameworkç›®å½•æŸ¥è¯¢ï¼Œå½“ç„¶ä½ è¿™é‡Œä¹Ÿèƒ½å†™æˆ.&#47;frameworkã€‚ä½†æ˜¯åˆ«äººç”¨åˆ°ä½ çš„åº“çš„æ—¶å€™å°±ä¼šå‡ºç°é”™è¯¯","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1069186","ctime":1639608183,"ip_address":"","comment_id":325547,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1639019898","product_id":100090601,"comment_content":"è€å¸ˆä¸ºå•¥ä½ ä»£ç é‡Œmani.goé‡Œé¢import æ˜¯&quot;coredemo&#47;framework&quot; ï¼Œè€Œæˆ‘è¿™é‡ŒæŒ‰ä½ ä¸€æ ·çš„ç›®å½•ç»“æ„è¦å†™æˆ&quot;.&#47;framework&quot;æ‰èƒ½æ‰¾åˆ°åŒ…","like_count":0,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539091,"discussion_content":"è¿™ä¸ªæ˜¯gomodçš„æœºåˆ¶ï¼Œå¦‚æœä½ çš„é¡¹ç›®åœ¨gomodä¸­å‘½åä¸ºcoredemoï¼Œ é‚£ä¹ˆcoredemo/frameworkå°±ä¼šå»ä½ çš„é¡¹ç›®ä¸‹çš„frameworkç›®å½•æŸ¥è¯¢ï¼Œå½“ç„¶ä½ è¿™é‡Œä¹Ÿèƒ½å†™æˆ./frameworkã€‚ä½†æ˜¯åˆ«äººç”¨åˆ°ä½ çš„åº“çš„æ—¶å€™å°±ä¼šå‡ºç°é”™è¯¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639608184,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":323831,"user_name":"å‹","can_delete":false,"product_type":"c1","uid":2536820,"ip_address":"","ucode":"972A4333A8B101","user_header":"https://static001.geekbang.org/account/avatar/00/26/b5/74/cd80b9f4.jpg","comment_is_top":false,"comment_ctime":1638176864,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638176864","product_id":100090601,"comment_content":"æ‰¾åˆ°äº† dirList æ‰“å°æ–‡ä»¶ç›®å½• ","like_count":0},{"had_liked":false,"id":323830,"user_name":"å‹","can_delete":false,"product_type":"c1","uid":2536820,"ip_address":"","ucode":"972A4333A8B101","user_header":"https://static001.geekbang.org/account/avatar/00/26/b5/74/cd80b9f4.jpg","comment_is_top":false,"comment_ctime":1638176811,"is_pvip":false,"replies":[{"id":"119258","content":"èµ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1069186","ctime":1640223307,"ip_address":"","comment_id":323830,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1638176811","product_id":100090601,"comment_content":"1. dir æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹ æœ¬è´¨æ˜¯å­—ç¬¦ä¸² å®ç°äº† FileSystem æ¥å£<br>2. é€šè¿‡http.StripPrefix(&quot;&#47;static&quot;, fs) è¿”å›ä¸€ä¸ªå¤„ç†è¯·æ±‚ï¼Œé‡Œé¢çš„é€»è¾‘å¤§æ¦‚çœ‹äº†ä¸‹ åº”è¯¥æ˜¯æŠŠå‰ç¼€static åˆ é™¤ä¹‹åé‡æ–°æ„å»ºä¸€ä¸‹path<br>3. æœ€ç»ˆè¿˜æ˜¯é€šè¿‡ ServeHttpå¤„ç†è¯·æ±‚ï¼Œä»£ç ä¸­è¿˜å¤„ç†äº† â€œ&#47;â€ å¦‚æœå‰ç¼€æ²¡æœ‰&#47; è¿˜è´´å¿ƒçš„å¸®å¿™è¡¥å……ä¸€ä¸ª<br>4. è°ƒç”¨ serveFile ï¼ˆè¿˜åŒ…å«é‡å®šå‘ä»£ç åˆ° index.HTML è¿™ä¸ªä¸æ˜¯é‡ç‚¹ï¼‰ï¼Œè°ƒç”¨Openå‡½æ•°æ‰“å¼€æ–‡ä»¶<br>æœ€åå…³é—­æ–‡ä»¶<br><br>å¦‚æœæ˜¯è¯»å–æ–‡ä»¶å¤¹ï¼Œåˆ™éå†æ–‡ä»¶å¤¹å†…æ‰€æœ‰æ–‡ä»¶ï¼Œå°†æ–‡ä»¶åç›´æ¥è¾“å‡ºè¿”å›å€¼ã€‚ å…³äºè¿™æ®µè¯æˆ‘å…¶å®å…·ä½“ç»†èŠ‚ä»£ç æ²¡çœ‹å¤ªæ˜ç™½  = =éš¾å—","like_count":0,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540964,"discussion_content":"èµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640223307,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":320257,"user_name":"å‹","can_delete":false,"product_type":"c1","uid":2536820,"ip_address":"","ucode":"972A4333A8B101","user_header":"https://static001.geekbang.org/account/avatar/00/26/b5/74/cd80b9f4.jpg","comment_is_top":false,"comment_ctime":1636180455,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636180455","product_id":100090601,"comment_content":"æ‰“å¡ç¬¬ä¸€é¢˜ï¼Œè·Ÿç€è€å¸ˆå­¦ä¹ å®Œç„¶åæœ‰æœºä¼šå¯ä»¥å’Œè€å¸ˆäº¤æµã€‚","like_count":0},{"had_liked":false,"id":317732,"user_name":"ç›˜èƒ§","can_delete":false,"product_type":"c1","uid":1650748,"ip_address":"","ucode":"5386CC4C92ECC2","user_header":"https://static001.geekbang.org/account/avatar/00/19/30/3c/0668d6ae.jpg","comment_is_top":false,"comment_ctime":1634907225,"is_pvip":false,"replies":[{"id":"115346","content":"servehttpæ˜¯net&#47;httpæä¾›æœåŠ¡çš„å…³é”®å­—","user_name":"ä½œè€…å›å¤","user_name_real":"å¶å‰‘å³°","uid":"1069186","ctime":1635204045,"ip_address":"","comment_id":317732,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1634907225","product_id":100090601,"comment_content":"è€å¸ˆ  ä¸ºä»€ä¹ˆè¿™ä¸ªå®ç°çš„å®ä¾‹æ–¹æ³• ä¸€å®šè¦å«  func (c *Core) ServeHTTP    æˆ‘ä¸å°å¿ƒå†™é”™äº†ï¼Œ ç³»ç»Ÿä¼šæŠ¥é”™æç¤ºå‘¢","like_count":0,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528945,"discussion_content":"servehttpæ˜¯net/httpæä¾›æœåŠ¡çš„å…³é”®å­—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635204045,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1320293,"avatar":"https://static001.geekbang.org/account/avatar/00/14/25/65/f04c6cfa.jpg","nickname":"yesterday","note":"","ucode":"681CDE1288BFD6","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547409,"discussion_content":"å› ä¸ºè¦å®ç°Handleræ¥å£ã€‚\nå®šä¹‰æ˜¯\ntype Handler interface {\n        ServeHTTP(ResponseWriter, *Request)\n}","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1642661910,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":317338,"user_name":".","can_delete":false,"product_type":"c1","uid":2770944,"ip_address":"","ucode":"6ABCCB846DE6F3","user_header":"https://static001.geekbang.org/account/avatar/00/2a/48/00/dd8c0dc1.jpg","comment_is_top":false,"comment_ctime":1634745009,"is_pvip":false,"replies":[{"id":"115348","content":"æ˜¯çš„ï¼Œæ„Ÿè°¢å›å¤","user_name":"ä½œè€…å›å¤","user_name_real":"å¶å‰‘å³°","uid":"1069186","ctime":1635204163,"ip_address":"","comment_id":317338,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1634745009","product_id":100090601,"comment_content":"- http.FileServer<br><br>  1. é€šè¿‡http.Dirè¿”å›FileSystem<br><br>  2. åˆ›å»ºfileHandlerç»“æ„ä½“<br><br>  3. é€šè¿‡http.StripPrefixè¿”å›HandlerFunc<br><br>  4. åœ¨HandlerFuncä¸­é€šè¿‡è¯·æ±‚çš„urlæ¥åˆ¤æ–­è¯¥è¯·æ±‚æ˜¯å¦å­˜åœ¨<br><br>    4.1. è¯·æ±‚å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨ServeHTTP<br><br>    4.2. è¯·æ±‚ä¸å­˜åœ¨ï¼Œåˆ™è¿”å›404","like_count":0,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528775,"discussion_content":"æ˜¯çš„ï¼Œæ„Ÿè°¢å›å¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635204163,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":317175,"user_name":"winkyi","can_delete":false,"product_type":"c1","uid":1227277,"ip_address":"","ucode":"91FBA510324439","user_header":"https://static001.geekbang.org/account/avatar/00/12/ba/0d/5b7c8ff9.jpg","comment_is_top":false,"comment_ctime":1634700110,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634700110","product_id":100090601,"comment_content":"&#47;&#47; å…·ä½“å¤„ç†é€»è¾‘çš„å¤„ç†å‡½æ•°<br>func (sh serverHandler) ServeHTTP(rw ResponseWriter, req *Request) {<br>  handler := sh.srv.Handler<br>  if handler == nil {<br>    handler = DefaultServeMux<br>  }<br>  ...<br>  handler.ServeHTTP(rw, req)<br>}<br><br>è€å¸ˆå¥½ï¼Œåˆ°ç¬¬å…­å±‚çš„è¿™ä¸ªæ–¹æ³•æœ‰ç‚¹ä¸æ˜ç™½,åŒæ ·æ˜¯å‘½åä¸ºServeHTTPçš„æ¥å£,æ€ä¹ˆå’Œmainå‡½æ•°ä¸­å®šä¹‰çš„Handleå’ŒHandleFuncæ–¹æ³•è¿›è¡Œå…³è”ã€‚","like_count":0},{"had_liked":false,"id":316499,"user_name":"å®™æ–¯","can_delete":false,"product_type":"c1","uid":2041396,"ip_address":"","ucode":"80DF36BAD298AD","user_header":"https://static001.geekbang.org/account/avatar/00/1f/26/34/891dd45b.jpg","comment_is_top":false,"comment_ctime":1634357073,"is_pvip":true,"replies":[{"id":"114836","content":"æ˜¯çš„ï¼Œæœ€ç»ˆè¿˜æ˜¯è°ƒç”¨servehttp","user_name":"ä½œè€…å›å¤","user_name_real":"å¶å‰‘å³°","uid":"1069186","ctime":1634693506,"ip_address":"","comment_id":316499,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1634357073","product_id":100090601,"comment_content":"FileServerè°ƒç”¨å¦‚ä¸‹è¿‡ç¨‹ï¼š<br>1 handler = DefaultServeMux <br>2 è°ƒç”¨handler.ServeHTTP<br> 2.1  è°ƒç”¨h := mux.Handler(r) ï¼Œå…¶ä¸­ hæ˜¯http.HandlerFuncç±»å‹ï¼Œæ˜¯http.StripPrefixçš„è¿”å›å‡½æ•°ã€‚<br> 2.2 è°ƒç”¨h.ServeHTTP(w, r)ï¼Œæ‰§è¡Œhttp.HandlerFuncçš„ServeHTTPã€‚<br>   2.2.1 è°ƒç”¨f(w, r)ï¼Œæ˜¯http.HandlerFunc.ServeHTTPçš„å†…éƒ¨ï¼Œæ­¤æ—¶çš„f==http.StripPrefixçš„è¿”å›å‡½æ•°ã€‚<br>   2.2.1.1 è°ƒç”¨FileServer.ServeHTTPã€‚<br>","like_count":0,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528395,"discussion_content":"æ˜¯çš„ï¼Œæœ€ç»ˆè¿˜æ˜¯è°ƒç”¨servehttp","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634693506,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313524,"user_name":"eviltion","can_delete":false,"product_type":"c1","uid":1515445,"ip_address":"","ucode":"022DE8510B825E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/mWicFKgbjL299CQPEhoFdSAphVb4UpibkhF8loRxryBRt3H7ZGkibibhaKANTxvSiatic4PLCy2MsbEMH1hc76YefPUw/132","comment_is_top":false,"comment_ctime":1632474039,"is_pvip":true,"replies":[{"id":"113604","content":"ä½ å¥½ï¼Œé”™è¯¯æç¤ºæ˜¯è¯´Coreæ•°æ®ç»“æ„æ²¡æœ‰å®ç°ServeHTTP æ–¹æ³•ï¼ˆmissing ServeHTTP methodï¼‰<br><br>æˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªç©ºå®ç°çš„ServeHTTPæ–¹æ³•åœ¨core.goä¸­ã€‚<br><br>func (c *Core) ServeHTTP(response http.ResponseWriter, request *http.Request) {<br>\t&#47;&#47; TODO<br>}<br><br>å‚è€ƒ https:&#47;&#47;github.com&#47;gohade&#47;coredemo&#47;blob&#47;geekbang&#47;01&#47;framework&#47;core.go","user_name":"ä½œè€…å›å¤","user_name_real":"å¶å‰‘å³°","uid":"1069186","ctime":1632619948,"ip_address":"","comment_id":313524,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1632474039","product_id":100090601,"comment_content":".\\main.go:10:3: cannot use framework.NewCore() (type *framework.Core) as type http.Handler in field value:<br>        *framework.Core does not implement http.Handler (missing ServeHTTP method)<br>è€å¸ˆå¸®å¿™çœ‹ä¸‹ï¼Œdemo å¯åŠ¨æŠ¥è¿™ä¸ªé”™ï¼Œä»€ä¹ˆåŸå› é‚£","like_count":0,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527377,"discussion_content":"ä½ å¥½ï¼Œé”™è¯¯æç¤ºæ˜¯è¯´Coreæ•°æ®ç»“æ„æ²¡æœ‰å®ç°ServeHTTP æ–¹æ³•ï¼ˆmissing ServeHTTP methodï¼‰\n\næˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªç©ºå®ç°çš„ServeHTTPæ–¹æ³•åœ¨core.goä¸­ã€‚\n\nfunc (c *Core) ServeHTTP(response http.ResponseWriter, request *http.Request) {\n\t// TODO\n}\n\nå‚è€ƒ https://github.com/gohade/coredemo/blob/geekbang/01/framework/core.go","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632619948,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313327,"user_name":"Derek","can_delete":false,"product_type":"c1","uid":1146983,"ip_address":"","ucode":"A4D5DED1E00F60","user_header":"https://static001.geekbang.org/account/avatar/00/11/80/67/4e381da5.jpg","comment_is_top":false,"comment_ctime":1632378871,"is_pvip":false,"replies":[{"id":"113510","content":"ä½ å¯ä»¥çœ‹ä¸‹åœ¨ server.go ä¸­æœ‰å¥è¯ï¼š<br>serverHandler{c.server}.ServeHTTP(w, w.req)<br><br>è¿™é‡Œçš„c.server å¦‚æœæ²¡æœ‰è®¾ç½®çš„è¯ï¼Œæœ‰å¯èƒ½æ˜¯nil<br><br>ç„¶åserver.goä¸­çš„<br><br>func (sh serverHandler) ServeHTTP(rw ResponseWriter, req *Request) {<br>\thandler := sh.srv.Handler<br>\tif handler == nil {<br>\t\thandler = DefaultServeMux<br>\t}<br>\tif req.RequestURI == &quot;*&quot; &amp;&amp; req.Method == &quot;OPTIONS&quot; {<br>\t\thandler = globalOptionsHandler{}<br>\t}<br>\thandler.ServeHTTP(rw, req)<br>}<br><br>è¿™é‡Œå¦‚æœsh.srv.Handler å°±ä¼šé»˜è®¤ä¸º DefaultServeMuxï¼Œå°±å’Œ ServeHTTP çš„ä¸²è”ä¸Šäº†<br><br>","user_name":"ä½œè€…å›å¤","user_name_real":"å¶å‰‘å³°","uid":"1069186","ctime":1632438268,"ip_address":"","comment_id":313327,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1632378871","product_id":100090601,"comment_content":"è€å¸ˆï¼Œå…³äºâ€œå¦‚æœå…¥å£æœåŠ¡ server ç»“æ„å·²ç»è®¾ç½®äº† Handlerï¼Œå°±è°ƒç”¨è¿™ä¸ª Handler æ¥å¤„ç†æ­¤æ¬¡è¯·æ±‚ï¼Œåä¹‹åˆ™ä½¿ç”¨åº“è‡ªå¸¦çš„ DefaultServerMuxâ€œè¿™å¥è¯ï¼š<br>DefaultServeMux æ˜¯æ€ä¹ˆå¯»æ‰¾ Handler è¿™ä¸€å±‚ä»£ç çš„å•Šï¼Ÿï¼Œç¬¬ä¸ƒå±‚æˆ‘æ²¡çœ‹åˆ°DefaultServeMuxç›´æ¥è°ƒç”¨Handleæ–¹æ³•å•Š? <br>```go<br>func (mux *ServeMux) ServeHTTP(w ResponseWriter, r *Request) {<br>\tif r.RequestURI == &quot;*&quot; {<br>\t\tif r.ProtoAtLeast(1, 1) {<br>\t\t\tw.Header().Set(&quot;Connection&quot;, &quot;close&quot;)<br>\t\t}<br>\t\tw.WriteHeader(StatusBadRequest)<br>\t\treturn<br>\t}<br>\th, _ := mux.Handler(r)<br>\th.ServeHTTP(w, r)<br>}<br>```<br>è¿™é‡Œè°ƒç”¨çš„æ˜¯Handlerï¼Œåé¢è·Ÿä¸‹å»ä¹Ÿæ²¡æœ‰ç”¨åˆ°Handleæ–¹æ³•å•Š? <br>","like_count":0,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527315,"discussion_content":"ä½ å¯ä»¥çœ‹ä¸‹åœ¨ server.go ä¸­æœ‰å¥è¯ï¼š\nserverHandler{c.server}.ServeHTTP(w, w.req)\n\nè¿™é‡Œçš„c.server å¦‚æœæ²¡æœ‰è®¾ç½®çš„è¯ï¼Œæœ‰å¯èƒ½æ˜¯nil\n\nç„¶åserver.goä¸­çš„\n\nfunc (sh serverHandler) ServeHTTP(rw ResponseWriter, req *Request) {\n\thandler := sh.srv.Handler\n\tif handler == nil {\n\t\thandler = DefaultServeMux\n\t}\n\tif req.RequestURI == &amp;quot;*&amp;quot; &amp;amp;&amp;amp; req.Method == &amp;quot;OPTIONS&amp;quot; {\n\t\thandler = globalOptionsHandler{}\n\t}\n\thandler.ServeHTTP(rw, req)\n}\n\nè¿™é‡Œå¦‚æœsh.srv.Handler å°±ä¼šé»˜è®¤ä¸º DefaultServeMuxï¼Œå°±å’Œ ServeHTTP çš„ä¸²è”ä¸Šäº†\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632438268,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313318,"user_name":"jeffery","can_delete":false,"product_type":"c1","uid":1219972,"ip_address":"","ucode":"35E2DAA386FB86","user_header":"https://static001.geekbang.org/account/avatar/00/12/9d/84/171b2221.jpg","comment_is_top":false,"comment_ctime":1632375852,"is_pvip":false,"replies":[{"id":"113505","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"å¤šå°‘","uid":"2547771","ctime":1632414696,"ip_address":"","comment_id":313318,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1632375852","product_id":100090601,"comment_content":"net&#47;http åŸç†åˆ†æçš„é€å½»<br><br>ç¬¬ä¸€å±‚ï¼Œæ ‡å‡†åº“åˆ›å»º HTTP æœåŠ¡æ˜¯é€šè¿‡åˆ›å»ºä¸€ä¸ª Server æ•°æ®ç»“æ„å®Œæˆçš„ï¼›<br>ç¬¬äºŒå±‚ï¼ŒServer æ•°æ®ç»“æ„åœ¨ for å¾ªç¯ä¸­ä¸æ–­ç›‘å¬æ¯ä¸€ä¸ªè¿æ¥ï¼›<br>ç¬¬ä¸‰å±‚ï¼Œæ¯ä¸ªè¿æ¥é»˜è®¤å¼€å¯ä¸€ä¸ª Goroutine ä¸ºå…¶æœåŠ¡ï¼›<br>ç¬¬å››ã€äº”å±‚ï¼ŒserverHandler ç»“æ„ä»£è¡¨è¯·æ±‚å¯¹åº”çš„å¤„ç†é€»è¾‘ï¼Œå¹¶ä¸”é€šè¿‡è¿™ä¸ªç»“æ„è¿›è¡Œå…·ä½“ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼›<br>ç¬¬å…­å±‚ï¼ŒServer æ•°æ®ç»“æ„å¦‚æœæ²¡æœ‰è®¾ç½®å¤„ç†å‡½æ•° Handlerï¼Œé»˜è®¤ä½¿ç”¨ DefaultServerMux å¤„ç†è¯·æ±‚ï¼›<br>ç¬¬ä¸ƒå±‚ï¼ŒDefaultServerMux æ˜¯ä½¿ç”¨ map ç»“æ„æ¥å­˜å‚¨å’ŒæŸ¥æ‰¾è·¯ç”±è§„åˆ™ã€‚","like_count":0,"discussions":[{"author":{"id":2547771,"avatar":"https://static001.geekbang.org/account/avatar/00/26/e0/3b/8ec916b2.jpg","nickname":"å¤šå°‘","note":"","ucode":"0A6EF7AA6E4BB7","race_medal":0,"user_type":4,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527313,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632414696,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312793,"user_name":"è¿›åŒ–èŒ","can_delete":false,"product_type":"c1","uid":1276861,"ip_address":"","ucode":"B30A5F78BB4171","user_header":"https://static001.geekbang.org/account/avatar/00/13/7b/bd/ccb37425.jpg","comment_is_top":false,"comment_ctime":1632022508,"is_pvip":true,"replies":[{"id":"113377","content":"æ˜¯çš„ï¼Œç‰¹åˆ«æ˜¯å¤æ‚çš„é€»è¾‘ï¼Œæ€ç»´å¯¼å›¾åˆ†ææºç çš„æ–¹æ³•æ˜¯éå¸¸å¥½ç”¨çš„æ–¹æ³•ï¼Œç”»å®Œå›¾ä¹‹åä¹Ÿå°±å¯¹é€»è¾‘äº†è§£äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å¶å‰‘å³°","uid":"1069186","ctime":1632163851,"ip_address":"","comment_id":312793,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1632022508","product_id":100090601,"comment_content":"æ€ç»´å¯¼å›¾æ˜¯ä¸ªå¥½ä¸œè¥¿ï¼Œå¹³æ—¶ç”¨ ide ç‚¹ç€ä¸€ä¸ªä¸ªå°è£…çš„å‡½æ•°ã€ç»“æ„ï¼Œè·³ç€è·³ç€è„‘å­å°±ä¹±äº†ã€æ‡µäº†~","like_count":0,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527114,"discussion_content":"æ˜¯çš„ï¼Œç‰¹åˆ«æ˜¯å¤æ‚çš„é€»è¾‘ï¼Œæ€ç»´å¯¼å›¾åˆ†ææºç çš„æ–¹æ³•æ˜¯éå¸¸å¥½ç”¨çš„æ–¹æ³•ï¼Œç”»å®Œå›¾ä¹‹åä¹Ÿå°±å¯¹é€»è¾‘äº†è§£äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632163851,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312097,"user_name":"Ethan Liu","can_delete":false,"product_type":"c1","uid":1070043,"ip_address":"","ucode":"231F944F7CD56A","user_header":"https://static001.geekbang.org/account/avatar/00/10/53/db/858337e3.jpg","comment_is_top":false,"comment_ctime":1631624269,"is_pvip":true,"replies":[{"id":"113250","content":"ç”¨xmindæˆ–è€…wps","user_name":"ä½œè€…å›å¤","user_name_real":"å¶å‰‘å³°","uid":"1069186","ctime":1631917212,"ip_address":"","comment_id":312097,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1631624269","product_id":100090601,"comment_content":"è€å¸ˆï¼Œæ€ç»´å¯¼å›¾ç”¨ä»€ä¹ˆå·¥å…·ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526864,"discussion_content":"ç”¨xmindæˆ–è€…wps","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631917212,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1272477,"avatar":"https://static001.geekbang.org/account/avatar/00/13/6a/9d/65bc01f9.jpg","nickname":"peterszhou","note":"","ucode":"DE068869801A28","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394209,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631786462,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312003,"user_name":"bearlu","can_delete":false,"product_type":"c1","uid":1030862,"ip_address":"","ucode":"14F260C8B24E27","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ba/ce/fd45714f.jpg","comment_is_top":false,"comment_ctime":1631588851,"is_pvip":true,"replies":[{"id":"113119","content":"ä½ å¥½ï¼Œè¯¾ç¨‹æ˜¯åŸºäº1.15ç‰ˆæœ¬çš„golangè¿›è¡Œåˆ†æçš„ï¼Œå¯ä»¥çœ‹githubä¸Šçš„go.modä¸­goçš„ç‰ˆæœ¬å·","user_name":"ä½œè€…å›å¤","user_name_real":"å¶å‰‘å³°","uid":"1069186","ctime":1631670228,"ip_address":"","comment_id":312003,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1631588851","product_id":100090601,"comment_content":"è€å¸ˆï¼Œè¿™ä¸ªè¯¾ç¨‹æºç åˆ†æçš„æºç ï¼ŒåŸºäºå“ªä¸ªç‰ˆæœ¬çš„golangï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1069186,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/82/32a2bf86.jpg","nickname":"å¶å‰‘å³°","note":"","ucode":"3974D917C69C29","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526826,"discussion_content":"ä½ å¥½ï¼Œè¯¾ç¨‹æ˜¯åŸºäº1.15ç‰ˆæœ¬çš„golangè¿›è¡Œåˆ†æçš„ï¼Œå¯ä»¥çœ‹githubä¸Šçš„go.modä¸­goçš„ç‰ˆæœ¬å·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631670228,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}