{"id":119498,"title":"10 | 使用ZooKeeper实现分布式队列","content":"<p><strong>课件和Demo地址</strong></p><p><a href=\"https://gitee.com/geektime-geekbang/geekbang-zk-course\">https://gitee.com/geektime-geekbang/geekbang-zk-course</a></p>","comments":[{"had_liked":false,"id":129898,"user_name":"小白","can_delete":false,"product_type":"c3","uid":1004755,"ip_address":"","ucode":"9BB9A170023CD8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/d3/46fd4aa3.jpg","comment_is_top":false,"comment_ctime":1567321368,"is_pvip":false,"replies":[{"id":48468,"content":"多谢，这样大部分学员可以不用Ant了。","user_name":"作者回复","user_name_real":"Geek_215586","uid":1591870,"ctime":1567351509,"ip_address":"","comment_id":129898,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100034201,"comment_content":"老师, zookeeper 3.5.5分支上的源码是支持maven构建的。\ngit clone https:&#47;&#47;github.com&#47;apache&#47;zookeeper.git\ngit checkout branch-3.5.5\ncd zookeeper\n“修改根pom.xm中git-commit-id-plugin的version为3.0.1，自带的2.2.5在maven中央库里没有不知道为什么&quot;\nmvn install -Dmaven.skip.test=rue 或直接使用IDEA的导入maven项目功能\n运行zookeeper-recipes-queue中的单元测试文件DistributedQueueTest:\ncd zookeeper-recipes&#47;zookeeper-recipes-queue\nmvn test -Dtest=org.apache.zookeeper.recipes.queue.DistributedQueueTest","like_count":15,"discussions":[{"author":{"id":1591870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyDiaaDJrwRsdUia9HxA8EuWaDVLr4E1gMG5y2ZTxV7BNUhdNABCmH3GMZTzib796X5duibiaeuRmNXeg/132","nickname":"Geek_215586","note":"","ucode":"5916AC9CC5FBE2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465704,"discussion_content":"多谢，这样大部分学员可以不用Ant了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567351509,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1182802,"avatar":"https://static001.geekbang.org/account/avatar/00/12/0c/52/f25c3636.jpg","nickname":"长脖子树","note":"","ucode":"D9090EF67EEB1B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291115,"discussion_content":"亲测可用, 中间一个命令改成 mvn install -DskipTests=true  就行, 可以直接在 idea 中调试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594710613,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132762,"user_name":"fancion","can_delete":false,"product_type":"c3","uid":1121584,"ip_address":"","ucode":"9000895F6BE0E4","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/30/4a82c7af.jpg","comment_is_top":false,"comment_ctime":1568214914,"is_pvip":false,"replies":[{"id":50967,"content":"是的","user_name":"作者回复","user_name_real":"Geek_215586","uid":1591870,"ctime":1568377351,"ip_address":"","comment_id":132762,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100034201,"comment_content":"老师好，所以element方法作用是返回的队列的对头吗？","like_count":1,"discussions":[{"author":{"id":1591870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyDiaaDJrwRsdUia9HxA8EuWaDVLr4E1gMG5y2ZTxV7BNUhdNABCmH3GMZTzib796X5duibiaeuRmNXeg/132","nickname":"Geek_215586","note":"","ucode":"5916AC9CC5FBE2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467111,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568377351,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127227,"user_name":"王金龙","can_delete":false,"product_type":"c3","uid":1106058,"ip_address":"","ucode":"E1BD8BC7CB426B","user_header":"https://static001.geekbang.org/account/avatar/00/10/e0/8a/38118387.jpg","comment_is_top":false,"comment_ctime":1566614683,"is_pvip":false,"replies":[{"id":47101,"content":"1. ZooKeeper源代码用的是Ant+Ivy。\n2. Curator源代码用的是maven。\n3. 我自己的项目用的是Gradle。\n\n这节讲的分布式队列是包含在ZooKeeper源代码中的，所以用的是Ant+Ivy。","user_name":"作者回复","user_name_real":"Geek_215586","uid":1591870,"ctime":1566646337,"ip_address":"","comment_id":127227,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100034201,"comment_content":"现在是用maven的吧，您视频里说是用ant","like_count":1,"discussions":[{"author":{"id":1591870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyDiaaDJrwRsdUia9HxA8EuWaDVLr4E1gMG5y2ZTxV7BNUhdNABCmH3GMZTzib796X5duibiaeuRmNXeg/132","nickname":"Geek_215586","note":"","ucode":"5916AC9CC5FBE2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464387,"discussion_content":"1. ZooKeeper源代码用的是Ant+Ivy。\n2. Curator源代码用的是maven。\n3. 我自己的项目用的是Gradle。\n\n这节讲的分布式队列是包含在ZooKeeper源代码中的，所以用的是Ant+Ivy。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566646337,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126852,"user_name":"Dovelol","can_delete":false,"product_type":"c3","uid":1253384,"ip_address":"","ucode":"9B5DDF7720F307","user_header":"https://static001.geekbang.org/account/avatar/00/13/20/08/bc06bc69.jpg","comment_is_top":false,"comment_ctime":1566490652,"is_pvip":false,"replies":[{"id":47035,"content":"只有返回的orderedChildren不为空，但是orderedChildren的所有元素被其他用户出站才会重试。如果返回的orderedChildren为空，会立刻返回。对性能应该影响不大，因为读操作是一个ZooKeeper节点在本地就能处理的。\n\n另外也可以在发现orderedChildren的所有元素被其他用户出站时返回，这样的队列实现也是对的。","user_name":"作者回复","user_name_real":"Geek_215586","uid":1591870,"ctime":1566566753,"ip_address":"","comment_id":126852,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100034201,"comment_content":"老师好，能讲一下这个分布式队列的缺点吗？如果一直不添加元素，所有客户端会一直循环获取，客户端比较多的情况下对性能影响大吗？","like_count":1,"discussions":[{"author":{"id":1591870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyDiaaDJrwRsdUia9HxA8EuWaDVLr4E1gMG5y2ZTxV7BNUhdNABCmH3GMZTzib796X5duibiaeuRmNXeg/132","nickname":"Geek_215586","note":"","ucode":"5916AC9CC5FBE2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464203,"discussion_content":"只有返回的orderedChildren不为空，但是orderedChildren的所有元素被其他用户出站才会重试。如果返回的orderedChildren为空，会立刻返回。对性能应该影响不大，因为读操作是一个ZooKeeper节点在本地就能处理的。\n\n另外也可以在发现orderedChildren的所有元素被其他用户出站时返回，这样的队列实现也是对的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566566753,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126847,"user_name":"Dovelol","can_delete":false,"product_type":"c3","uid":1253384,"ip_address":"","ucode":"9B5DDF7720F307","user_header":"https://static001.geekbang.org/account/avatar/00/13/20/08/bc06bc69.jpg","comment_is_top":false,"comment_ctime":1566489701,"is_pvip":false,"replies":[{"id":47029,"content":"和单机的并发队列一样，这个分布式协同队列可以用来做生产者和消费者的协同。\n\nZooKeeper的源码zookeeper-recipes&#47;zookeeper-recipes-queue目录下提供了一个分布式协同队列的实现。另外Apache Curator也提供了分布式协同队列的实现。建议使用Apache Curator的实现。","user_name":"作者回复","user_name_real":"Geek_215586","uid":1591870,"ctime":1566564745,"ip_address":"","comment_id":126847,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100034201,"comment_content":"老师好，这个分布式协同队列是zk自己实现的源码吗？ 那就是说可以有api直接用，能讲下应用场景吗？","like_count":1,"discussions":[{"author":{"id":1591870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyDiaaDJrwRsdUia9HxA8EuWaDVLr4E1gMG5y2ZTxV7BNUhdNABCmH3GMZTzib796X5duibiaeuRmNXeg/132","nickname":"Geek_215586","note":"","ucode":"5916AC9CC5FBE2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464200,"discussion_content":"和单机的并发队列一样，这个分布式协同队列可以用来做生产者和消费者的协同。\n\nZooKeeper的源码zookeeper-recipes/zookeeper-recipes-queue目录下提供了一个分布式协同队列的实现。另外Apache Curator也提供了分布式协同队列的实现。建议使用Apache Curator的实现。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566564745,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126237,"user_name":"yang","can_delete":false,"product_type":"c3","uid":1074310,"ip_address":"","ucode":"1AA1497C5A293C","user_header":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","comment_is_top":false,"comment_ctime":1566352237,"is_pvip":false,"replies":[{"id":46777,"content":"1. ZooKeeper API（例如create）不会重试，Curator提供的API有重试机制。\n2. 是的。\n3. 是的。","user_name":"作者回复","user_name_real":"Geek_215586","uid":1591870,"ctime":1566394558,"ip_address":"","comment_id":126237,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100034201,"comment_content":"\n1. create方法是跟其他的方法类似，也是采用重试机制吧？ 那create失败了，就是会一直重试吗？\n\n2. element方法取到的childNames是快照 那后面再调用element的时候，子节点在取到之后，被get之前已经被其他线程全部remove了，此时调用element这个方法的线程是一直重试吗？\n\n3. 同样的remove方法取到了子节点们，但是去真正remove的时候，发现已经不在子节点中了，会一直重试吗？\n","like_count":1,"discussions":[{"author":{"id":1591870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyDiaaDJrwRsdUia9HxA8EuWaDVLr4E1gMG5y2ZTxV7BNUhdNABCmH3GMZTzib796X5duibiaeuRmNXeg/132","nickname":"Geek_215586","note":"","ucode":"5916AC9CC5FBE2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463901,"discussion_content":"1. ZooKeeper API（例如create）不会重试，Curator提供的API有重试机制。\n2. 是的。\n3. 是的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566394558,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1074310,"avatar":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","nickname":"yang","note":"","ucode":"1AA1497C5A293C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5574,"discussion_content":"对应的代码还没来得及看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566358195,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1074310,"avatar":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","nickname":"yang","note":"","ucode":"1AA1497C5A293C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5573,"discussion_content":"哦 好蠢 create失败了 说明已经存在了 就直接返回了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566358154,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125665,"user_name":"凌霄","can_delete":false,"product_type":"c3","uid":1107786,"ip_address":"","ucode":"19C4BFB0298276","user_header":"https://static001.geekbang.org/account/avatar/00/10/e7/4a/4dfb565a.jpg","comment_is_top":false,"comment_ctime":1566223183,"is_pvip":false,"replies":[{"id":46460,"content":"后面的内容会比较深入","user_name":"作者回复","user_name_real":"Geek_215586","uid":1591870,"ctime":1566307183,"ip_address":"","comment_id":125665,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100034201,"comment_content":"不过瘾，上干货吧！","like_count":1,"discussions":[{"author":{"id":1591870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyDiaaDJrwRsdUia9HxA8EuWaDVLr4E1gMG5y2ZTxV7BNUhdNABCmH3GMZTzib796X5duibiaeuRmNXeg/132","nickname":"Geek_215586","note":"","ucode":"5916AC9CC5FBE2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463652,"discussion_content":"后面的内容会比较深入","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566307183,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":164912,"user_name":"tony007","can_delete":false,"product_type":"c3","uid":1784317,"ip_address":"","ucode":"B7856A57D34EF5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKmq56WXiabfEE8NyyAHLicMpa6pxuSIxVb4BBp5k3vukp27DYsRYVibicp8ZyQZMQvUn7TYw89jUk4gA/132","comment_is_top":false,"comment_ctime":1577110338,"is_pvip":false,"replies":[{"id":79228,"content":"ZooKeeper保证的是以下的数据一致性：\n\n1. Linearizable writes: 所有更新ZooKeeper状态的操作保证可线性化的数据一致性。\n2. FIFO client order: 来自一个client的所有操作按照client发送操作请求的顺序执行。\n\n多个客户端保证第一点。","user_name":"作者回复","user_name_real":"Geek_215586","uid":1591870,"ctime":1588574496,"ip_address":"","comment_id":164912,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100034201,"comment_content":"多个客户端如何保证线程安全？","like_count":0,"discussions":[{"author":{"id":1591870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyDiaaDJrwRsdUia9HxA8EuWaDVLr4E1gMG5y2ZTxV7BNUhdNABCmH3GMZTzib796X5duibiaeuRmNXeg/132","nickname":"Geek_215586","note":"","ucode":"5916AC9CC5FBE2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478947,"discussion_content":"ZooKeeper保证的是以下的数据一致性：\n\n1. Linearizable writes: 所有更新ZooKeeper状态的操作保证可线性化的数据一致性。\n2. FIFO client order: 来自一个client的所有操作按照client发送操作请求的顺序执行。\n\n多个客户端保证第一点。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588574496,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":140657,"user_name":"豆子高","can_delete":false,"product_type":"c3","uid":1326166,"ip_address":"","ucode":"C84B1081E40A08","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLxDV4VqTISMDBPgnjDAicCnWbjE3FeFv4eNWdITw6aib82iasfb63vJCU6bxRB4zN6eaGztZPmlpWdg/132","comment_is_top":false,"comment_ctime":1571022212,"is_pvip":false,"replies":[{"id":54854,"content":"带有Before注解的方法会在测试用例运行之前执行，带有After注解的方法会在测试用例运行之后执行。所以测试用例testOffer1()的执行过程如下所示：\n\n1. ClientBase.setUp()启动一个ZooKeeper节点。\n2. DistributedQueueTest.testOffer1()创建一个DistributedQueue，先入队，然后出队，验证出队元素和入队元素是相等的。\n3. DistributedQueueTest.tearDown()停止ZooKeeper节点。","user_name":"作者回复","user_name_real":"Geek_215586","uid":1591870,"ctime":1571292300,"ip_address":"","comment_id":140657,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100034201,"comment_content":"老师 能讲一下 DistributedQueueTest 测试类里面的逻辑嘛  讲一个就行了 看起来有点吃力 尤其是运行测试方法时先会执行tearDown()方法  整个逻辑不是很明白 跟前面讲的基础 需要老师指点一下 不然不知道怎么连接起来","like_count":0,"discussions":[{"author":{"id":1591870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyDiaaDJrwRsdUia9HxA8EuWaDVLr4E1gMG5y2ZTxV7BNUhdNABCmH3GMZTzib796X5duibiaeuRmNXeg/132","nickname":"Geek_215586","note":"","ucode":"5916AC9CC5FBE2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470497,"discussion_content":"带有Before注解的方法会在测试用例运行之前执行，带有After注解的方法会在测试用例运行之后执行。所以测试用例testOffer1()的执行过程如下所示：\n\n1. ClientBase.setUp()启动一个ZooKeeper节点。\n2. DistributedQueueTest.testOffer1()创建一个DistributedQueue，先入队，然后出队，验证出队元素和入队元素是相等的。\n3. DistributedQueueTest.tearDown()停止ZooKeeper节点。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571292300,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127377,"user_name":"北北、Pepper","can_delete":false,"product_type":"c3","uid":1259513,"ip_address":"","ucode":"46A74C52E68BC1","user_header":"https://static001.geekbang.org/account/avatar/00/13/37/f9/f4428000.jpg","comment_is_top":false,"comment_ctime":1566669495,"is_pvip":false,"replies":[{"id":47175,"content":"好的","user_name":"作者回复","user_name_real":"Geek_215586","uid":1591870,"ctime":1566734960,"ip_address":"","comment_id":127377,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100034201,"comment_content":"看完了，期待老师后面更深入的讲解","like_count":0,"discussions":[{"author":{"id":1591870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyDiaaDJrwRsdUia9HxA8EuWaDVLr4E1gMG5y2ZTxV7BNUhdNABCmH3GMZTzib796X5duibiaeuRmNXeg/132","nickname":"Geek_215586","note":"","ucode":"5916AC9CC5FBE2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464463,"discussion_content":"好的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566734960,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126179,"user_name":"geraltlaush","can_delete":false,"product_type":"c3","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1566346096,"is_pvip":false,"replies":[{"id":46770,"content":"这个用的是ZooKeeper自带的源代码。需要按第10节讲的那样把ZooKeeper的源代码弄到IDE中去。","user_name":"作者回复","user_name_real":"Geek_215586","uid":1591870,"ctime":1566392882,"ip_address":"","comment_id":126179,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100034201,"comment_content":"分布式协同队列的源代码在github上没找到啊","like_count":0,"discussions":[{"author":{"id":1591870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyDiaaDJrwRsdUia9HxA8EuWaDVLr4E1gMG5y2ZTxV7BNUhdNABCmH3GMZTzib796X5duibiaeuRmNXeg/132","nickname":"Geek_215586","note":"","ucode":"5916AC9CC5FBE2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463870,"discussion_content":"这个用的是ZooKeeper自带的源代码。需要按第10节讲的那样把ZooKeeper的源代码弄到IDE中去。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566392882,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126163,"user_name":"geraltlaush","can_delete":false,"product_type":"c3","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1566343487,"is_pvip":false,"replies":[{"id":46773,"content":"您说的很对，分布式协同队列和单机的无锁队列在设计理念上是相同的。它们都是non-blocking的算法。","user_name":"作者回复","user_name_real":"Geek_215586","uid":1591870,"ctime":1566394161,"ip_address":"","comment_id":126163,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100034201,"comment_content":"这种分布式协同队列可以理解为单机的无锁队列吧。每个线程操作都是原子性的，类似cmpchg这样。客户端无需自己来创建锁就可以维持数据一致性","like_count":0,"discussions":[{"author":{"id":1591870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyDiaaDJrwRsdUia9HxA8EuWaDVLr4E1gMG5y2ZTxV7BNUhdNABCmH3GMZTzib796X5duibiaeuRmNXeg/132","nickname":"Geek_215586","note":"","ucode":"5916AC9CC5FBE2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463857,"discussion_content":"您说的很对，分布式协同队列和单机的无锁队列在设计理念上是相同的。它们都是non-blocking的算法。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566394161,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126150,"user_name":"coderfone","can_delete":false,"product_type":"c3","uid":1147721,"ip_address":"","ucode":"D08301F22609AF","user_header":"https://static001.geekbang.org/account/avatar/00/11/83/49/268531c3.jpg","comment_is_top":false,"comment_ctime":1566332547,"is_pvip":false,"replies":[{"id":46776,"content":"1. ZkCli.sh是ZooKeeper提供的一个shell，可以在这个shell里面使用命令操作ZooKeeper。这些命令都是对ZooKeeper API的封装。\n2. Curator是在ZooKeeper API上面封装的一个high level API。","user_name":"作者回复","user_name_real":"Geek_215586","uid":1591870,"ctime":1566394370,"ip_address":"","comment_id":126150,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100034201,"comment_content":"老师，请我zookeeper api 跟ZkCli和Curator客户端有什么区别？","like_count":0,"discussions":[{"author":{"id":1591870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJyDiaaDJrwRsdUia9HxA8EuWaDVLr4E1gMG5y2ZTxV7BNUhdNABCmH3GMZTzib796X5duibiaeuRmNXeg/132","nickname":"Geek_215586","note":"","ucode":"5916AC9CC5FBE2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463850,"discussion_content":"1. ZkCli.sh是ZooKeeper提供的一个shell，可以在这个shell里面使用命令操作ZooKeeper。这些命令都是对ZooKeeper API的封装。\n2. Curator是在ZooKeeper API上面封装的一个high level API。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566394370,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":349214,"user_name":"余为国","can_delete":false,"product_type":"c3","uid":1264868,"ip_address":"","ucode":"E9E916DC49D177","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoc8sReia18fc441HgklicXQOZZG8pwf7eFUGK7xvTmpYLtKfIgaY3Pe6tORmiabXQY1FWR2K9wgibf9A/132","comment_is_top":false,"comment_ctime":1655803932,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100034201,"comment_content":"zk 3.4.14 怎么编译打包，有没有文档","like_count":0},{"had_liked":false,"id":275625,"user_name":"滩涂曳尾","can_delete":false,"product_type":"c3","uid":1187478,"ip_address":"","ucode":"40F650F2A419D4","user_header":"https://static001.geekbang.org/account/avatar/00/12/1e/96/c735ad6b.jpg","comment_is_top":false,"comment_ctime":1611625098,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100034201,"comment_content":"老师，offer或者element每次都要排序，这个性能岂不是很低吗","like_count":0},{"had_liked":false,"id":271931,"user_name":"最闪亮的星","can_delete":false,"product_type":"c3","uid":1032521,"ip_address":"","ucode":"434B461F054DDF","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKcRygMwYWWicGO1AqaqcA5VsXz8mUDlGqtWBU3uiaCqPQT7GnNk2UYqicXbMy9BJF9EZ9zHAMLNer5g/132","comment_is_top":false,"comment_ctime":1609873281,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100034201,"comment_content":"这个是zookeeper内部的实现原理，并不是开发者使用的接口。\nhttps:&#47;&#47;zookeeper.apache.org&#47;doc&#47;r3.5.3-beta&#47;zookeeperTutorial.html\n这个链接，才是开发者去实现一个队列的思路。\n你说的我感觉不太对。","like_count":0},{"had_liked":false,"id":166871,"user_name":"ezekiel","can_delete":false,"product_type":"c3","uid":1158795,"ip_address":"","ucode":"AB4AB6FA8612D8","user_header":"https://static001.geekbang.org/account/avatar/00/11/ae/8b/43ce01ca.jpg","comment_is_top":false,"comment_ctime":1577619952,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100034201,"comment_content":"老师您好！\n\n我有几个疑问，分布式队列的应用场景是什么？优点是什么？缺点是什么？能和消息队列对比下吗？","like_count":0}]}