{"id":158104,"title":"68丨协议和扩展","content":"<p><strong>课件地址</strong></p><p><a href=\"https://gitee.com/geektime-geekbang/swift-course\">https://gitee.com/geektime-geekbang/swift-course</a></p>","comments":[{"had_liked":false,"id":179577,"user_name":"轻","can_delete":false,"product_type":"c3","uid":1456533,"ip_address":"","ucode":"812208DE6C6A7B","user_header":"https://static001.geekbang.org/account/avatar/00/16/39/95/ee029e7d.jpg","comment_is_top":false,"comment_ctime":1582034062,"is_pvip":false,"replies":[{"id":70496,"content":"结构体和枚举是值类型，类对象是应用类型，你可以先理解一下值类型和引用类型的区别。  另外比如枚举是列出某些有穷序列集的数据结构，比如一个星期都有星期几，你用类也可以表示，但是枚举更清晰，更优","user_name":"作者回复","user_name_real":"Geek_f72435","uid":1341726,"ctime":1582717823,"ip_address":"","comment_id":179577,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"老师，想问一下，为什么Swift要引入结构体和枚举的概念呢，用类不是都可以解决问题吗？比如说创建一种类型的时候","like_count":1,"discussions":[{"author":{"id":1341726,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLxtKhpmvzx2VB4iajicfJVFmQR3eP3xBpdpQEovpSqUfAOrNImvYwVb7P37ibI0ONziau9sbFEk8oDaA/132","nickname":"elfgate","note":"","ucode":"3C0B5F7C1F664C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484313,"discussion_content":"结构体和枚举是值类型，类对象是应用类型，你可以先理解一下值类型和引用类型的区别。  另外比如枚举是列出某些有穷序列集的数据结构，比如一个星期都有星期几，你用类也可以表示，但是枚举更清晰，更优","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582717823,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":158373,"user_name":"淇则有岸","can_delete":false,"product_type":"c3","uid":1473099,"ip_address":"","ucode":"342BB93F4F6D37","user_header":"https://static001.geekbang.org/account/avatar/00/16/7a/4b/70041204.jpg","comment_is_top":false,"comment_ctime":1575361143,"is_pvip":false,"replies":[{"id":60726,"content":"编译器应该是有警告的，这种是做不到的。\n官方给的是：This is intentional: protocol extensions cannot introduce @objc entry points due to limitations of the Objective-C runtime. If you want to add @objc entry points to NSObject, extend NSObject.\n\n可以参见：https:&#47;&#47;bugs.swift.org&#47;browse&#47;SR-3349?focusedCommentId=21826&amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-21826","user_name":"作者回复","user_name_real":"Geek_f72435","uid":1341726,"ctime":1575434836,"ip_address":"","comment_id":158373,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"你好，我试图用extension 来完成一个协议的默认实现出现了问题，比如我在一个新建extension UItableviewDelegate 中实现 cell will dispaly 方法 发现该默认实现并不会被处理","like_count":1,"discussions":[{"author":{"id":1341726,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLxtKhpmvzx2VB4iajicfJVFmQR3eP3xBpdpQEovpSqUfAOrNImvYwVb7P37ibI0ONziau9sbFEk8oDaA/132","nickname":"elfgate","note":"","ucode":"3C0B5F7C1F664C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476694,"discussion_content":"编译器应该是有警告的，这种是做不到的。\n官方给的是：This is intentional: protocol extensions cannot introduce @objc entry points due to limitations of the Objective-C runtime. If you want to add @objc entry points to NSObject, extend NSObject.\n\n可以参见：https://bugs.swift.org/browse/SR-3349?focusedCommentId=21826&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-21826","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575434836,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":152171,"user_name":"aaaVege💫","can_delete":false,"product_type":"c3","uid":1234309,"ip_address":"","ucode":"84446C9CD15F43","user_header":"https://static001.geekbang.org/account/avatar/00/12/d5/85/9da08fd3.jpg","comment_is_top":false,"comment_ctime":1573897050,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"可以通过老师的衣服来判断哪些课是一天讲的","like_count":5},{"had_liked":false,"id":362836,"user_name":"Geek_c50193","can_delete":false,"product_type":"c3","uid":3219717,"ip_address":"北京","ucode":"F06449E865FB7C","user_header":"","comment_is_top":false,"comment_ctime":1668952318,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"protocol textualPresentation {\n    var fullNameDescription: String { get }\n}\n\nextension Int: textualPresentation {\n    var fullNameDescription: String {\n        &quot;Int fullNameDescription&quot;\n    }\n}\n\nstruct PersonDescription: textualPresentation {\n    var name: String\n    var age: Int\n    var fullNameDescription: String {\n        return &quot;person name: \\(name), person age: \\(age)&quot;\n    }\n}\n\nextension Array: textualPresentation where Element: textualPresentation {\n    var fullNameDescription: String {\n        return &quot;[\\(self.map { $0.fullNameDescription }.joined(separator: &quot;,&quot;))]&quot;\n    }\n}\nlet presentableArray: [textualPresentation] = [PersonDescription(name: &quot;张三&quot;, age: 35), 15]\n&#47;&#47; compile error: Type &#39;any textualPresentation&#39; cannot conform to &#39;textualPresentation&#39;\nprint(presentableArray.fullNameDescription)\n请问，最后一行的编译错误怎么解决呢？数组中是遵循相同协议的不同结构体或类，打印数组的fullNameDescription的时候就出错，换成相同类型的对象就可以了。","like_count":0},{"had_liked":false,"id":336428,"user_name":"Null","can_delete":false,"product_type":"c3","uid":1382587,"ip_address":"","ucode":"A7D4DF2A43C7D8","user_header":"https://static001.geekbang.org/account/avatar/00/15/18/bb/9299fab1.jpg","comment_is_top":false,"comment_ctime":1646141722,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"在协议中自定义方法，其实使用挺受限制的，因为这个协议的方法无法访问到任何关于遵守协议的结构体或者类型的信息，可能添加一些纯功能性质的方法会用吧。咋说呢，就感觉怪怪的，这种小来小去特性积累多了，搞的swift像个大杂烩。","like_count":0},{"had_liked":false,"id":336425,"user_name":"Null","can_delete":false,"product_type":"c3","uid":1382587,"ip_address":"","ucode":"A7D4DF2A43C7D8","user_header":"https://static001.geekbang.org/account/avatar/00/15/18/bb/9299fab1.jpg","comment_is_top":false,"comment_ctime":1646141314,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"extension 为协议提供默认计算属性实现感觉没啥使用场景，因为遵守协议的结构体或者类，必须要自己实现这个计算属性，否则不会让其编译通过。但是如果提供默认方法的实现，遵守协议的结构体或者类不去实现方法不会报错。难道是给optional类型的属性准备的，求老师指导。","like_count":0},{"had_liked":false,"id":281090,"user_name":"梵虚","can_delete":false,"product_type":"c3","uid":1199537,"ip_address":"","ucode":"12D5BC1942E4FE","user_header":"https://static001.geekbang.org/account/avatar/00/12/4d/b1/883ab42b.jpg","comment_is_top":false,"comment_ctime":1614580768,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"新版的Xcode要这样写了\nextension Array  where Element: TextRepresentable {\n    var desc: String{\n        let itemDesc = self.map{$0.desc}\n        return itemDesc.joined(separator: &quot;&quot;)\n    }\n}","like_count":0,"discussions":[{"author":{"id":1241363,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f1/13/0ecff761.jpg","nickname":"陈春求","note":"","ucode":"AAF95F699A6BDF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385216,"discussion_content":"extension Collection where Iterator.Element: TextRepresentable { //给Collection协议添加限制,要求Collection中的每个元素都遵循可文本呈现协议TextRepresentable\n    var desc: String {\n        let itemsAsText = self.map { $0.desc }\n        return &#34;[&#34; + itemsAsText.joined(separator: &#34;,&#34;) + &#34;]&#34;\n    }\n}\n\n在Xcode 12.4上运行了一下，老师的写法还是能正常运行的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626943842,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}