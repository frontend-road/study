{"id":366930,"title":"03ï½œSpring Bean ä¾èµ–æ³¨å…¥å¸¸è§é”™è¯¯ï¼ˆä¸‹ï¼‰","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å‚…å¥ï¼Œè¿™èŠ‚è¯¾æˆ‘ä»¬æ¥ç€èŠSpringçš„è‡ªåŠ¨æ³¨å…¥ã€‚</p><p>ä¸Šä¸€è®²æˆ‘ä»¬ä»‹ç»äº†3ä¸ªSpringç¼–ç¨‹ä¸­å…³äºä¾èµ–æ³¨å…¥çš„é”™è¯¯æ¡ˆä¾‹ï¼Œè¿™äº›é”™è¯¯éƒ½æ˜¯æ¯”è¾ƒå¸¸è§çš„ã€‚å¦‚æœä½ ä»”ç»†åˆ†æçš„è¯ï¼Œä½ ä¼šå‘ç°å®ƒä»¬å¤§å¤šéƒ½æ˜¯å›´ç»•ç€@Autowiredã€@Qualifierçš„ä½¿ç”¨è€Œå‘ç”Ÿï¼Œè€Œä¸”è‡ªåŠ¨æ³¨å…¥çš„ç±»å‹ä¹Ÿéƒ½æ˜¯æ™®é€šå¯¹è±¡ç±»å‹ã€‚</p><p>é‚£åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä¼šä½¿ç”¨@Valueç­‰ä¸å¤ªå¸¸è§çš„æ³¨è§£æ¥å®Œæˆè‡ªåŠ¨æ³¨å…¥ï¼ŒåŒæ—¶ä¹Ÿå­˜åœ¨æ³¨å…¥åˆ°é›†åˆã€æ•°ç»„ç­‰å¤æ‚ç±»å‹çš„åœºæ™¯ã€‚è¿™äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿä¼šé‡åˆ°ä¸€äº›é—®é¢˜ã€‚æ‰€ä»¥è¿™ä¸€è®²æˆ‘ä»¬ä¸å¦¨æ¥æ¢³ç†ä¸‹ã€‚</p><h2>æ¡ˆä¾‹1ï¼š@Valueæ²¡æœ‰æ³¨å…¥é¢„æœŸçš„å€¼</h2><p>åœ¨è£…é…å¯¹è±¡æˆå‘˜å±æ€§æ—¶ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šä½¿ç”¨@Autowiredæ¥è£…é…ã€‚ä½†æ˜¯ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬ä¹Ÿä½¿ç”¨@Valueè¿›è¡Œè£…é…ã€‚ä¸è¿‡è¿™ä¸¤ç§æ³¨è§£ä½¿ç”¨é£æ ¼ä¸åŒï¼Œä½¿ç”¨@Autowiredä¸€èˆ¬éƒ½ä¸ä¼šè®¾ç½®å±æ€§å€¼ï¼Œè€Œ@Valueå¿…é¡»æŒ‡å®šä¸€ä¸ªå­—ç¬¦ä¸²å€¼ï¼Œå› ä¸ºå…¶å®šä¹‰åšäº†è¦æ±‚ï¼Œå®šä¹‰ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>public @interface Value {\n\n   /**\n    * The actual value expression &amp;mdash; for example, &lt;code&gt;#{systemProperties.myProp}&lt;/code&gt;.\n    */\n   String value();\n\n}\n</code></pre><p>å¦å¤–åœ¨æ¯”è¾ƒè¿™ä¸¤è€…çš„åŒºåˆ«æ—¶ï¼Œ<strong>æˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šå› ä¸º@Valueå¸¸ç”¨äºStringç±»å‹çš„è£…é…è€Œè¯¯ä»¥ä¸º@Valueä¸èƒ½ç”¨äºéå†…ç½®å¯¹è±¡çš„è£…é…ï¼Œå®é™…ä¸Šè¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„è¯¯åŒº</strong>ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢è¿™ç§æ–¹å¼æ¥Autowiredä¸€ä¸ªå±æ€§æˆå‘˜ï¼š</p><pre><code>@Value(&quot;#{student}&quot;)\nprivate Student student;\n</code></pre><!-- [[[read_end]]] --><p>å…¶ä¸­studentè¿™ä¸ªBeanå®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code>@Bean\npublic Student student(){\n    Student student = createStudent(1, &quot;xie&quot;);\n    return student;\n}\n</code></pre><p>å½“ç„¶ï¼Œæ­£å¦‚å‰é¢æåŠï¼Œæˆ‘ä»¬ä½¿ç”¨@Valueæ›´å¤šæ˜¯ç”¨æ¥è£…é…Stringï¼Œè€Œä¸”å®ƒæ”¯æŒå¤šç§å¼ºå¤§çš„è£…é…æ–¹å¼ï¼Œå…¸å‹çš„æ–¹å¼å‚è€ƒä¸‹é¢çš„ç¤ºä¾‹ï¼š</p><pre><code>//æ³¨å†Œæ­£å¸¸å­—ç¬¦ä¸²\n@Value(&quot;æˆ‘æ˜¯å­—ç¬¦ä¸²&quot;)\nprivate String text; \n\n//æ³¨å…¥ç³»ç»Ÿå‚æ•°ã€ç¯å¢ƒå˜é‡æˆ–è€…é…ç½®æ–‡ä»¶ä¸­çš„å€¼\n@Value(&quot;${ip}&quot;)\nprivate String ip\n\n//æ³¨å…¥å…¶ä»–Beanå±æ€§ï¼Œå…¶ä¸­studentä¸ºbeançš„IDï¼Œnameä¸ºå…¶å±æ€§\n@Value(&quot;#{student.name}&quot;)\nprivate String name;\n</code></pre><p>ä¸Šé¢æˆ‘ç»™ä½ ç®€å•ä»‹ç»äº†@Valueçš„å¼ºå¤§åŠŸèƒ½ï¼Œä»¥åŠå®ƒå’Œ@Autowiredçš„åŒºåˆ«ã€‚é‚£ä¹ˆåœ¨ä½¿ç”¨@Valueæ—¶å¯èƒ½ä¼šé‡åˆ°é‚£äº›é”™è¯¯å‘¢ï¼Ÿè¿™é‡Œåˆ†äº«ä¸€ä¸ªæœ€ä¸ºå…¸å‹çš„é”™è¯¯ï¼Œå³ä½¿ç”¨@Valueå¯èƒ½ä¼šæ³¨å…¥ä¸€ä¸ªä¸æ˜¯é¢„æœŸçš„å€¼ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æ¨¡æ‹Ÿä¸€ä¸ªåœºæ™¯ï¼Œæˆ‘ä»¬åœ¨é…ç½®æ–‡ä»¶application.propertiesé…ç½®äº†è¿™æ ·ä¸€ä¸ªå±æ€§ï¼š</p><pre><code>username=admin\npassword=pass\n</code></pre><p>ç„¶åæˆ‘ä»¬åœ¨ä¸€ä¸ªBeanä¸­ï¼Œåˆ†åˆ«å®šä¹‰ä¸¤ä¸ªå±æ€§æ¥å¼•ç”¨å®ƒä»¬ï¼š</p><pre><code>@RestController\n@Slf4j\npublic class ValueTestController {\n    @Value(&quot;${username}&quot;)\n    private String username;\n    @Value(&quot;${password}&quot;)\n    private String password;\n \n    @RequestMapping(path = &quot;user&quot;, method = RequestMethod.GET)\n    public String getUser(){\n       return username + &quot;:&quot; + password;\n    };\n}\n</code></pre><p>å½“æˆ‘ä»¬å»æ‰“å°ä¸Šè¿°ä»£ç ä¸­çš„usernameå’Œpasswordæ—¶ï¼Œæˆ‘ä»¬ä¼šå‘ç°passwordæ­£ç¡®è¿”å›äº†ï¼Œä½†æ˜¯usernameè¿”å›çš„å¹¶ä¸æ˜¯é…ç½®æ–‡ä»¶ä¸­æŒ‡æ˜çš„adminï¼Œè€Œæ˜¯è¿è¡Œè¿™æ®µç¨‹åºçš„è®¡ç®—æœºç”¨æˆ·åã€‚å¾ˆæ˜æ˜¾ï¼Œä½¿ç”¨@Valueè£…é…çš„å€¼æ²¡æœ‰å®Œå…¨ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸã€‚</p><h3>æ¡ˆä¾‹è§£æ</h3><p>é€šè¿‡åˆ†æè¿è¡Œç»“æœï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“@Valueçš„ä½¿ç”¨æ–¹å¼åº”è¯¥æ˜¯æ²¡æœ‰é”™çš„ï¼Œæ¯•ç«Ÿpasswordè¿™ä¸ªå­—æ®µè£…é…ä¸Šäº†ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆusernameæ²¡æœ‰ç”Ÿæ•ˆæˆæ­£ç¡®çš„å€¼ï¼Ÿæ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥å…·ä½“è§£æä¸‹ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆäº†è§£ä¸‹å¯¹äº@Valueï¼ŒSpringæ˜¯å¦‚ä½•æ ¹æ®@Valueæ¥æŸ¥è¯¢â€œå€¼â€çš„ã€‚æˆ‘ä»¬å¯ä»¥å…ˆé€šè¿‡æ–¹æ³•DefaultListableBeanFactory#doResolveDependencyæ¥äº†è§£@Valueçš„æ ¸å¿ƒå·¥ä½œæµç¨‹ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code>@Nullable\npublic Object doResolveDependency(DependencyDescriptor descriptor, @Nullable String beanName,\n      @Nullable Set&lt;String&gt; autowiredBeanNames, @Nullable TypeConverter typeConverter) throws BeansException {\n    //çœç•¥å…¶ä»–éå…³é”®ä»£ç \n    Class&lt;?&gt; type = descriptor.getDependencyType();\n      //å¯»æ‰¾@Value\n      Object value = getAutowireCandidateResolver().getSuggestedValue(descriptor);\n      if (value != null) {\n         if (value instanceof String) {\n            //è§£æValueå€¼\n            String strVal = resolveEmbeddedValue((String) value);\n            BeanDefinition bd = (beanName != null &amp;&amp; containsBean(beanName) ?\n                  getMergedBeanDefinition(beanName) : null);\n            value = evaluateBeanDefinitionString(strVal, bd);\n         }\n         \n         //è½¬åŒ–Valueè§£æçš„ç»“æœåˆ°è£…é…çš„ç±»å‹\n         TypeConverter converter = (typeConverter != null ? typeConverter : getTypeConverter());\n         try {\n            return converter.convertIfNecessary(value, type, descriptor.getTypeDescriptor());\n         }\n         catch (UnsupportedOperationException ex) {\n            //å¼‚å¸¸å¤„ç†\n         }\n      }\n    //çœç•¥å…¶ä»–éå…³é”®ä»£ç \n  }\n</code></pre><p>â€‹å¯ä»¥çœ‹åˆ°ï¼Œ@Valueçš„å·¥ä½œå¤§ä½“åˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªæ ¸å¿ƒæ­¥éª¤ã€‚</p><p><strong>1.  å¯»æ‰¾@Value</strong></p><p>åœ¨è¿™æ­¥ä¸­ï¼Œä¸»è¦æ˜¯åˆ¤æ–­è¿™ä¸ªå±æ€§å­—æ®µæ˜¯å¦æ ‡è®°ä¸º@Valueï¼Œä¾æ®çš„æ–¹æ³•å‚è€ƒQualifierAnnotationAutowireCandidateResolver#findValueï¼š</p><pre><code>@Nullable\nprotected Object findValue(Annotation[] annotationsToSearch) {\n   if (annotationsToSearch.length &gt; 0) {  \n      AnnotationAttributes attr = AnnotatedElementUtils.getMergedAnnotationAttributes(\n            AnnotatedElementUtils.forAnnotations(annotationsToSearch), this.valueAnnotationType);\n      //valueAnnotationTypeå³ä¸º@Value\n      if (attr != null) {\n         return extractValue(attr);\n      }\n   }\n   return null;\n}\n</code></pre><p><strong>2.  è§£æ@Valueçš„å­—ç¬¦ä¸²å€¼</strong></p><p>å¦‚æœä¸€ä¸ªå­—æ®µæ ‡è®°äº†@Valueï¼Œåˆ™å¯ä»¥æ‹¿åˆ°å¯¹åº”çš„å­—ç¬¦ä¸²å€¼ï¼Œç„¶åå°±å¯ä»¥æ ¹æ®å­—ç¬¦ä¸²å€¼å»åšè§£æï¼Œæœ€ç»ˆè§£æçš„ç»“æœå¯èƒ½æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™å–å†³äºå­—ç¬¦ä¸²æ€ä¹ˆå†™ã€‚</p><p><strong>3.  å°†è§£æç»“æœè½¬åŒ–ä¸ºè¦è£…é…çš„å¯¹è±¡çš„ç±»å‹</strong></p><p>å½“æ‹¿åˆ°ç¬¬äºŒæ­¥ç”Ÿæˆçš„ç»“æœåï¼Œæˆ‘ä»¬ä¼šå‘ç°å¯èƒ½å’Œæˆ‘ä»¬è¦è£…é…çš„ç±»å‹ä¸åŒ¹é…ã€‚å‡è®¾æˆ‘ä»¬å®šä¹‰çš„æ˜¯UUIDï¼Œè€Œæˆ‘ä»¬è·å–çš„ç»“æœæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°±ä¼šæ ¹æ®ç›®æ ‡ç±»å‹æ¥å¯»æ‰¾è½¬åŒ–å™¨æ‰§è¡Œè½¬åŒ–ï¼Œå­—ç¬¦ä¸²åˆ°UUIDçš„è½¬åŒ–å®é™…ä¸Šå‘ç”Ÿåœ¨UUIDEditorä¸­ï¼š</p><pre><code>public class UUIDEditor extends PropertyEditorSupport {\n\n   @Override\n   public void setAsText(String text) throws IllegalArgumentException          {\n      if (StringUtils.hasText(text)) {\n         //è½¬åŒ–æ“ä½œ\n         setValue(UUID.fromString(text.trim()));\n      }\n      else {\n         setValue(null);\n      }\n   }\n   //çœç•¥å…¶ä»–éå…³ä»£ç \n  \n}\n</code></pre><p>é€šè¿‡å¯¹ä¸Šé¢å‡ ä¸ªå…³é”®æ­¥éª¤çš„è§£æï¼Œæˆ‘ä»¬å¤§ä½“äº†è§£äº†@Valueçš„å·¥ä½œæµç¨‹ã€‚ç»“åˆæˆ‘ä»¬çš„æ¡ˆä¾‹ï¼Œå¾ˆæ˜æ˜¾é—®é¢˜åº”è¯¥å‘ç”Ÿåœ¨ç¬¬äºŒæ­¥ï¼Œå³è§£æValueæŒ‡å®šå­—ç¬¦ä¸²è¿‡ç¨‹ï¼Œæ‰§è¡Œè¿‡ç¨‹å‚è€ƒä¸‹é¢çš„å…³é”®ä»£ç è¡Œï¼š</p><pre><code>String strVal = resolveEmbeddedValue((String) value);\n</code></pre><p>è¿™é‡Œå…¶å®æ˜¯åœ¨è§£æåµŒå…¥çš„å€¼ï¼Œå®é™…ä¸Šå°±æ˜¯â€œæ›¿æ¢å ä½ç¬¦â€å·¥ä½œã€‚å…·ä½“è€Œè¨€ï¼Œå®ƒé‡‡ç”¨çš„æ˜¯PropertySourcesPlaceholderConfigureræ ¹æ®PropertySourcesæ¥æ›¿æ¢ã€‚ä¸è¿‡å½“ä½¿ç”¨ ${username} æ¥è·å–æ›¿æ¢å€¼æ—¶ï¼Œå…¶æœ€ç»ˆæ‰§è¡Œçš„æŸ¥æ‰¾å¹¶ä¸æ˜¯å±€é™åœ¨application.propertyæ–‡ä»¶ä¸­çš„ã€‚é€šè¿‡è°ƒè¯•ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„è¿™äº›â€œæºâ€éƒ½æ˜¯æ›¿æ¢ä¾æ®ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/25/40/25d4242bc0dae8fa730663b9122b7840.png?wh=1683*269\" alt=\"\"></p><pre><code>[ConfigurationPropertySourcesPropertySource {name='configurationProperties'}, \nStubPropertySource {name='servletConfigInitParams'}, ServletContextPropertySource {name='servletContextInitParams'}, PropertiesPropertySource {name='systemProperties'}, OriginAwareSystemEnvironmentPropertySource {name='systemEnvironment'}, RandomValuePropertySource {name='random'},\nOriginTrackedMapPropertySource {name='applicationConfig: classpath:/application.properties]'},\nMapPropertySource {name='devtools'}]\n</code></pre><p>è€Œå…·ä½“çš„æŸ¥æ‰¾æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„ä»£ç ï¼ˆPropertySourcesPropertyResolver#getPropertyï¼‰æ¥è·å–å®ƒçš„æ‰§è¡Œæ–¹å¼ï¼š</p><pre><code>@Nullable\nprotected &lt;T&gt; T getProperty(String key, Class&lt;T&gt; targetValueType, boolean resolveNestedPlaceholders) {\n   if (this.propertySources != null) {\n      for (PropertySource&lt;?&gt; propertySource : this.propertySources) {\n         Object value = propertySource.getProperty(key);\n         if (value != null) {\n         //æŸ¥åˆ°valueå³é€€å‡º  \n         return convertValueIfNecessary(value, targetValueType);\n         }\n      }\n   }\n \n   return null;\n}\n</code></pre><p>ä»è¿™å¯ä»¥çœ‹å‡ºï¼Œåœ¨è§£æValueå­—ç¬¦ä¸²æ—¶ï¼Œå…¶å®æ˜¯æœ‰é¡ºåºçš„ï¼ˆæŸ¥æ‰¾çš„æºæ˜¯å­˜åœ¨CopyOnWriteArrayListä¸­ï¼Œåœ¨å¯åŠ¨æ—¶å°±è¢«æœ‰åºå›ºå®šä¸‹æ¥ï¼‰ï¼Œä¸€ä¸ªä¸€ä¸ªâ€œæºâ€æ‰§è¡ŒæŸ¥æ‰¾ï¼Œåœ¨å…¶ä¸­ä¸€ä¸ªæºæ‰¾åˆ°åï¼Œå°±å¯ä»¥ç›´æ¥è¿”å›äº†ã€‚</p><p>å¦‚æœæˆ‘ä»¬æŸ¥çœ‹systemEnvironmentè¿™ä¸ªæºï¼Œä¼šå‘ç°åˆšå¥½æœ‰ä¸€ä¸ªusernameå’Œæˆ‘ä»¬æ˜¯é‡åˆçš„ï¼Œä¸”å€¼ä¸æ˜¯passã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/eb/28/eb48b0d27dc7d0dyy32a548934edc728.png?wh=708*381\" alt=\"\"></p><p>æ‰€ä»¥ï¼Œè®²åˆ°è¿™é‡Œï¼Œä½ åº”è¯¥çŸ¥é“é—®é¢˜æ‰€åœ¨äº†å§ï¼Ÿè¿™æ˜¯ä¸€ä¸ªè¯¯æ‰“è¯¯æ’çš„ä¾‹å­ï¼Œåˆšå¥½ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼ˆsystemEnvironmentï¼‰ä¸­å«æœ‰åŒåçš„é…ç½®ã€‚å®é™…ä¸Šï¼Œå¯¹äºç³»ç»Ÿå‚æ•°ï¼ˆsystemPropertiesï¼‰ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œè¿™äº›å‚æ•°æˆ–è€…å˜é‡éƒ½æœ‰å¾ˆå¤šï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰æ„è¯†åˆ°å®ƒçš„å­˜åœ¨ï¼Œèµ·äº†ä¸€ä¸ªåŒåçš„å­—ç¬¦ä¸²ä½œä¸º@Valueçš„å€¼ï¼Œåˆ™å¾ˆå®¹æ˜“å¼•å‘è¿™ç±»é—®é¢˜ã€‚</p><h3>é—®é¢˜ä¿®æ­£</h3><p>é’ˆå¯¹è¿™ä¸ªæ¡ˆä¾‹ï¼Œæœ‰äº†æºç çš„å‰–æï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆå¿«åœ°æ‰¾åˆ°è§£å†³æ–¹æ¡ˆäº†ã€‚ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥é¿å…ä½¿ç”¨åŒä¸€ä¸ªåç§°ï¼Œå…·ä½“ä¿®æ”¹å¦‚ä¸‹ï¼š</p><pre><code>user.name=admin\nuser.password=pass\n</code></pre><p>ä½†æ˜¯å¦‚æœæˆ‘ä»¬è¿™ä¹ˆæ”¹çš„è¯ï¼Œå…¶å®è¿˜æ˜¯ä¸è¡Œçš„ã€‚å®é™…ä¸Šï¼Œé€šè¿‡ä¹‹å‰çš„è°ƒè¯•æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°ç±»ä¼¼çš„åŸå› ï¼Œåœ¨systemPropertiesè¿™ä¸ªPropertiesPropertySourceæºä¸­åˆšå¥½å­˜åœ¨user.nameï¼ŒçœŸæ˜¯æ— å·§ä¸æˆä¹¦ã€‚æ‰€ä»¥å‘½åæ—¶ï¼Œæˆ‘ä»¬ä¸€å®šè¦æ³¨æ„<strong>ä¸ä»…è¦é¿å…å’Œç¯å¢ƒå˜é‡å†²çªï¼Œä¹Ÿè¦æ³¨æ„é¿å…å’Œç³»ç»Ÿå˜é‡ç­‰å…¶ä»–å˜é‡å†²çª</strong>ï¼Œè¿™æ ·æ‰èƒ½ä»æ ¹æœ¬ä¸Šè§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>é€šè¿‡è¿™ä¸ªæ¡ˆä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼šSpringç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šå¥½ç”¨çš„åŠŸèƒ½ï¼Œä½†æ˜¯è¿™äº›åŠŸèƒ½äº¤ç»‡åˆ°ä¸€èµ·åï¼Œå°±æœ‰å¯èƒ½è®©æˆ‘ä»¬è¯¯å…¥ä¸€äº›å‘ï¼Œåªæœ‰äº†è§£å®ƒçš„è¿è¡Œæ–¹å¼ï¼Œæˆ‘ä»¬æ‰èƒ½è¿…é€Ÿå®šä½é—®é¢˜ã€è§£å†³é—®é¢˜ã€‚</p><h2>æ¡ˆä¾‹2ï¼šé”™ä¹±çš„æ³¨å…¥é›†åˆ</h2><p>å‰é¢æˆ‘ä»¬ä»‹ç»äº†å¾ˆå¤šè‡ªåŠ¨æ³¨å…¥çš„é”™è¯¯æ¡ˆä¾‹ï¼Œä½†æ˜¯è¿™äº›æ¡ˆä¾‹éƒ½å±€é™åœ¨å•ä¸ªç±»å‹çš„æ³¨å…¥ï¼Œå¯¹äºé›†åˆç±»å‹çš„æ³¨å…¥å¹¶æ— æåŠã€‚å®é™…ä¸Šï¼Œ<strong>é›†åˆç±»å‹çš„è‡ªåŠ¨æ³¨å…¥æ˜¯Springæä¾›çš„å¦å¤–ä¸€ä¸ªå¼ºå¤§åŠŸèƒ½ã€‚</strong></p><p>å‡è®¾æˆ‘ä»¬å­˜åœ¨è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼šå­˜åœ¨å¤šä¸ªå­¦ç”ŸBeanï¼Œæˆ‘ä»¬éœ€è¦æ‰¾å‡ºæ¥ï¼Œå¹¶å­˜å‚¨åˆ°ä¸€ä¸ªListé‡Œé¢å»ã€‚å¤šä¸ªå­¦ç”ŸBeançš„å®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code>@Bean\npublic Student student1(){\n    return createStudent(1, &quot;xie&quot;);\n}\n\n@Bean\npublic Student student2(){\n    return createStudent(2, &quot;fang&quot;);\n}\n\nprivate Student createStudent(int id, String name) {\n    Student student = new Student();\n    student.setId(id);\n    student.setName(name);\n    return student;\n}\n</code></pre><p>æœ‰äº†é›†åˆç±»å‹çš„è‡ªåŠ¨æ³¨å…¥åï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠé›¶æ•£çš„å­¦ç”ŸBeanæ”¶é›†èµ·æ¥äº†ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code>@RestController\n@Slf4j\npublic class StudentController {\n\n    private List&lt;Student&gt; students;\n\n    public StudentController(List&lt;Student&gt; students){\n        this.students = students;\n    }\n\n    @RequestMapping(path = &quot;students&quot;, method = RequestMethod.GET)\n    public String listStudents(){\n       return students.toString();\n    };\n\n}\n</code></pre><p>é€šè¿‡ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®Œæˆé›†åˆç±»å‹çš„æ³¨å…¥å·¥ä½œï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><blockquote>\n<p>[Student(id=1, name=xie), Student(id=2, name=fang)]</p>\n</blockquote><p>ç„¶è€Œï¼Œä¸šåŠ¡æ€»æ˜¯å¤æ‚çš„ï¼Œéœ€æ±‚ä¹Ÿæ˜¯ä¸€ç›´å˜åŠ¨çš„ã€‚å½“æˆ‘ä»¬æŒç»­å¢åŠ ä¸€äº›studentæ—¶ï¼Œå¯èƒ½å°±ä¸å–œæ¬¢ç”¨è¿™ç§æ–¹å¼æ¥æ³¨å…¥é›†åˆç±»å‹äº†ï¼Œè€Œæ˜¯å€¾å‘äºç”¨ä¸‹é¢çš„æ–¹å¼å»å®Œæˆæ³¨å…¥å·¥ä½œï¼š</p><pre><code>@Bean\npublic List&lt;Student&gt; students(){\n    Student student3 = createStudent(3, &quot;liu&quot;);\n    Student student4 = createStudent(4, &quot;fu&quot;);\n    return Arrays.asList(student3, student4);\n} \n</code></pre><p>ä¸ºäº†å¥½è®°ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸å¦¨å°†ä¸Šé¢è¿™ç§æ–¹å¼å‘½åä¸ºâ€œç›´æ¥è£…é…æ–¹å¼â€ï¼Œè€Œå°†ä¹‹å‰çš„é‚£ç§å‘½åä¸ºâ€œæ”¶é›†æ–¹å¼â€ã€‚</p><p>å®é™…ä¸Šï¼Œå¦‚æœè¿™ä¸¤ç§æ–¹å¼æ˜¯éæ­¤å³å½¼çš„å­˜åœ¨ï¼Œè‡ªç„¶æ²¡æœ‰ä»»ä½•é—®é¢˜ï¼Œéƒ½èƒ½ç©è½¬ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¸å°å¿ƒè®©è¿™2ç§æ–¹å¼åŒæ—¶å­˜åœ¨äº†ï¼Œç»“æœä¼šæ€æ ·ï¼Ÿ</p><p>è¿™æ—¶å€™å¾ˆå¤šäººéƒ½ä¼šè§‰å¾—Springå¾ˆå¼ºå¤§ï¼Œè‚¯å®šä¼šåˆå¹¶ä¸Šé¢çš„ç»“æœï¼Œæˆ–è€…è®¤ä¸ºè‚¯å®šæ˜¯ä»¥ç›´æ¥è£…é…ç»“æœä¸ºå‡†ã€‚ç„¶è€Œï¼Œå½“æˆ‘ä»¬è¿è¡Œèµ·ç¨‹åºï¼Œå°±ä¼šå‘ç°åé¢çš„æ³¨å…¥æ–¹å¼æ ¹æœ¬æ²¡æœ‰ç”Ÿæ•ˆã€‚å³ä¾ç„¶è¿”å›çš„æ˜¯å‰é¢å®šä¹‰çš„2ä¸ªå­¦ç”Ÿã€‚ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™æ ·çš„é”™è¯¯å‘¢ï¼Ÿ</p><h3>æ¡ˆä¾‹è§£æ</h3><p>è¦äº†è§£è¿™ä¸ªé”™è¯¯çš„æ ¹æœ¬åŸå› ï¼Œä½ å°±å¾—å…ˆæ¸…æ¥šè¿™ä¸¤ç§æ³¨å…¥é£æ ¼åœ¨Springä¸­æ˜¯å¦‚ä½•å®ç°çš„ã€‚å¯¹äºæ”¶é›†è£…é…é£æ ¼ï¼ŒSpringä½¿ç”¨çš„æ˜¯DefaultListableBeanFactory#resolveMultipleBeansæ¥å®Œæˆè£…é…å·¥ä½œï¼Œé’ˆå¯¹æœ¬æ¡ˆä¾‹å…³é”®çš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼š</p><pre><code>private Object resolveMultipleBeans(DependencyDescriptor descriptor, @Nullable String beanName,\n      @Nullable Set&lt;String&gt; autowiredBeanNames, @Nullable TypeConverter typeConverter) {\n   final Class&lt;?&gt; type = descriptor.getDependencyType();\n   if (descriptor instanceof StreamDependencyDescriptor) {\n      //è£…é…stream\n      return stream;\n   }\n   else if (type.isArray()) {\n      //è£…é…æ•°ç»„\n      return result;\n   }\n   else if (Collection.class.isAssignableFrom(type) &amp;&amp; type.isInterface()) {\n      //è£…é…é›†åˆ\n      //è·å–é›†åˆçš„å…ƒç´ ç±»å‹\n      Class&lt;?&gt; elementType = descriptor.getResolvableType().asCollection().resolveGeneric();\n      if (elementType == null) {\n         return null;\n      }\n      //æ ¹æ®å…ƒç´ ç±»å‹æŸ¥æ‰¾æ‰€æœ‰çš„bean\n      Map&lt;String, Object&gt; matchingBeans = findAutowireCandidates(beanName, elementType,\n            new MultiElementDescriptor(descriptor));\n      if (matchingBeans.isEmpty()) {\n         return null;\n      }\n      if (autowiredBeanNames != null) {\n         autowiredBeanNames.addAll(matchingBeans.keySet());\n      }\n      //è½¬åŒ–æŸ¥åˆ°çš„æ‰€æœ‰beanæ”¾ç½®åˆ°é›†åˆå¹¶è¿”å›\n      TypeConverter converter = (typeConverter != null ? typeConverter : getTypeConverter());\n      Object result = converter.convertIfNecessary(matchingBeans.values(), type);\n      //çœç•¥éå…³é”®ä»£ç \n      return result;\n   }\n   else if (Map.class == type) {\n      //è§£æmap\n      return matchingBeans;\n   }\n   else {\n      return null;\n   }\n}\n</code></pre><p>åˆ°è¿™ï¼Œæˆ‘ä»¬å°±ä¸éš¾æ¦‚æ‹¬å‡ºè¿™ç§æ”¶é›†å¼é›†åˆè£…é…æ–¹å¼çš„å¤§ä½“è¿‡ç¨‹äº†ã€‚</p><p><strong>1.  è·å–é›†åˆç±»å‹çš„å…ƒç´ ç±»å‹</strong></p><p>é’ˆå¯¹æœ¬æ¡ˆä¾‹ï¼Œç›®æ ‡ç±»å‹å®šä¹‰ä¸ºList&lt;Student&gt; studentsï¼Œæ‰€ä»¥å…ƒç´ ç±»å‹ä¸ºStudentï¼Œè·å–çš„å…·ä½“æ–¹æ³•å‚è€ƒä»£ç è¡Œï¼š</p><blockquote>\n<p>Class&lt;?&gt; elementType = descriptor.getResolvableType().asCollection().resolveGeneric();</p>\n</blockquote><p><strong>2.  æ ¹æ®å…ƒç´ ç±»å‹ï¼Œæ‰¾å‡ºæ‰€æœ‰çš„Bean</strong></p><p>æœ‰äº†ä¸Šé¢çš„å…ƒç´ ç±»å‹ï¼Œå³å¯æ ¹æ®å…ƒç´ ç±»å‹æ¥æ‰¾å‡ºæ‰€æœ‰çš„Beanï¼Œå…³é”®ä»£ç è¡Œå¦‚ä¸‹ï¼š</p><blockquote>\n<p>Map&lt;String, Object&gt; matchingBeans = findAutowireCandidates(beanName, elementType, new MultiElementDescriptor(descriptor));</p>\n</blockquote><p><strong>3.  å°†åŒ¹é…çš„æ‰€æœ‰çš„BeanæŒ‰ç›®æ ‡ç±»å‹è¿›è¡Œè½¬åŒ–</strong></p><p>ç»è¿‡æ­¥éª¤2ï¼Œæˆ‘ä»¬è·å–çš„æ‰€æœ‰çš„Beanéƒ½æ˜¯ä»¥java.util.LinkedHashMap.LinkedValueså½¢å¼å­˜å‚¨çš„ï¼Œå’Œæˆ‘ä»¬çš„ç›®æ ‡ç±»å‹å¤§æ¦‚ç‡ä¸åŒï¼Œæ‰€ä»¥æœ€åä¸€æ­¥éœ€è¦åšçš„æ˜¯<strong>æŒ‰éœ€è½¬åŒ–</strong>ã€‚åœ¨æœ¬æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬å°±éœ€è¦æŠŠå®ƒè½¬åŒ–ä¸ºListï¼Œè½¬åŒ–çš„å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><blockquote>\n<p>Object result = converter.convertIfNecessary(matchingBeans.values(), type);</p>\n</blockquote><p>å¦‚æœæˆ‘ä»¬ç»§ç»­æ·±ç©¶æ‰§è¡Œç»†èŠ‚ï¼Œå°±å¯ä»¥çŸ¥é“æœ€ç»ˆæ˜¯è½¬åŒ–å™¨CollectionToCollectionConverteræ¥å®Œæˆè¿™ä¸ªè½¬åŒ–è¿‡ç¨‹ã€‚</p><p>å­¦ä¹ å®Œæ”¶é›†æ–¹å¼çš„è£…é…åŸç†ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹ç›´æ¥è£…é…æ–¹å¼çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå®é™…ä¸Šè¿™æ­¥åœ¨å‰é¢çš„è¯¾ç¨‹ä¸­æˆ‘ä»¬å°±æåˆ°è¿‡ï¼ˆå³DefaultListableBeanFactory#findAutowireCandidatesæ–¹æ³•æ‰§è¡Œï¼‰ï¼Œå…·ä½“çš„æ‰§è¡Œè¿‡ç¨‹è¿™é‡Œå°±ä¸å¤šè¯´äº†ã€‚</p><p>çŸ¥é“äº†æ‰§è¡Œè¿‡ç¨‹ï¼Œæ¥ä¸‹æ¥æ— éå°±æ˜¯æ ¹æ®ç›®æ ‡ç±»å‹ç›´æ¥å¯»æ‰¾åŒ¹é…çš„Beanã€‚åœ¨æœ¬æ¡ˆä¾‹ä¸­ï¼Œå°±æ˜¯å°†Beanåç§°ä¸ºstudentsçš„List&lt;Student&gt;è£…é…ç»™StudentController#studentså±æ€§ã€‚</p><p>äº†è§£äº†è¿™ä¸¤ç§æ–¹å¼ï¼Œæˆ‘ä»¬å†æ¥æ€è€ƒè¿™ä¸¤ç§æ–¹å¼çš„å…³ç³»ï¼šå½“åŒæ—¶æ»¡è¶³è¿™ä¸¤ç§è£…é…æ–¹å¼æ—¶ï¼ŒSpringæ˜¯å¦‚ä½•å¤„ç†çš„ï¼Ÿè¿™é‡Œæˆ‘ä»¬å¯ä»¥å‚è€ƒæ–¹æ³•DefaultListableBeanFactory#doResolveDependencyçš„å‡ è¡Œå…³é”®ä»£ç ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code>Object multipleBeans = resolveMultipleBeans(descriptor, beanName, autowiredBeanNames, typeConverter);\nif (multipleBeans != null) {\n   return multipleBeans;\n}\nMap&lt;String, Object&gt; matchingBeans = findAutowireCandidates(beanName, type, descriptor);\n</code></pre><p>å¾ˆæ˜æ˜¾ï¼Œè¿™ä¸¤ç§è£…é…é›†åˆçš„æ–¹å¼æ˜¯<strong>ä¸èƒ½åŒå­˜</strong>çš„ï¼Œç»“åˆæœ¬æ¡ˆä¾‹ï¼Œå½“ä½¿ç”¨æ”¶é›†è£…é…æ–¹å¼æ¥è£…é…æ—¶ï¼Œèƒ½æ‰¾åˆ°ä»»ä½•ä¸€ä¸ªå¯¹åº”çš„Beanï¼Œåˆ™è¿”å›ï¼Œå¦‚æœä¸€ä¸ªéƒ½æ²¡æœ‰æ‰¾åˆ°ï¼Œæ‰ä¼šé‡‡ç”¨ç›´æ¥è£…é…çš„æ–¹å¼ã€‚è¯´åˆ°è¿™é‡Œï¼Œä½ å¤§æ¦‚èƒ½ç†è§£ä¸ºä»€ä¹ˆåæœŸä»¥Listæ–¹å¼ç›´æ¥æ·»åŠ çš„Student Beanéƒ½ä¸ç”Ÿæ•ˆäº†å§ã€‚</p><h3>é—®é¢˜ä¿®æ­£</h3><p>ç°åœ¨å¦‚ä½•çº æ­£è¿™ä¸ªé—®é¢˜å°±å˜å¾—ç®€å•å¤šäº†ï¼Œå°±æ˜¯ä½ ä¸€å®šè¦ä¸‹æ„è¯†åœ°é¿å…è¿™2ç§æ–¹å¼å…±å­˜å»è£…é…é›†åˆï¼Œåªç”¨ä¸€ä¸ªè¿™ä¸ªé—®é¢˜å°±è¿åˆƒè€Œè§£äº†ã€‚ä¾‹å¦‚ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç›´æ¥è£…é…çš„æ–¹å¼å»ä¿®æ­£é—®é¢˜ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code>@Bean\npublic List&lt;Student&gt; students(){\n    Student student1 = createStudent(1, &quot;xie&quot;);\n    Student student2 = createStudent(2, &quot;fang&quot;);\n    Student student3 = createStudent(3, &quot;liu&quot;);\n    Student student4 = createStudent(4, &quot;fu&quot;);\n    return Arrays.asList(student1ï¼Œstudent2ï¼Œstudent3, student4);\n}\n</code></pre><p>ä¹Ÿå¯ä»¥ä½¿ç”¨æ”¶é›†æ–¹å¼æ¥ä¿®æ­£é—®é¢˜æ—¶ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code>    @Bean\n    public Student student1(){\n        return createStudent(1, &quot;xie&quot;);\n    }\n    @Bean\n    public Student student2(){\n        return createStudent(2, &quot;fang&quot;);\n    }\n    @Bean\n    public Student student3(){\n        return createStudent(3, &quot;liu&quot;);\n    }\n    @Bean\n    public Student student4(){\n        return createStudent(4, &quot;fu&quot;);\n    }\n</code></pre><p>æ€»ä¹‹ï¼Œéƒ½æ˜¯å¯ä»¥çš„ã€‚è¿˜æœ‰ä¸€ç‚¹è¦æ³¨æ„ï¼š<strong>åœ¨å¯¹äºåŒä¸€ä¸ªé›†åˆå¯¹è±¡çš„æ³¨å…¥ä¸Šï¼Œæ··åˆå¤šç§æ³¨å…¥æ–¹å¼æ˜¯ä¸å¯å–çš„ï¼Œè¿™æ ·é™¤äº†é”™ä¹±ï¼Œåˆ«æ— æ‰€å¾—ã€‚</strong></p><h2>é‡ç‚¹å›é¡¾</h2><p>ä»Šå¤©æˆ‘ä»¬åˆå­¦ä¹ äº†å…³äºSpringè‡ªåŠ¨æ³¨å…¥çš„ä¸¤ä¸ªå…¸å‹æ¡ˆä¾‹ã€‚</p><p>é€šè¿‡æ¡ˆä¾‹1çš„å­¦ä¹ ï¼Œæˆ‘ä»¬äº†è§£åˆ°@Valueä¸ä»…å¯ä»¥ç”¨æ¥æ³¨å…¥Stringç±»å‹ï¼Œä¹Ÿå¯ä»¥æ³¨å…¥è‡ªå®šä¹‰å¯¹è±¡ç±»å‹ã€‚åŒæ—¶åœ¨æ³¨å…¥Stringæ—¶ï¼Œä½ ä¸€å®šè¦æ„è¯†åˆ°å®ƒä¸ä»…ä»…å¯ä»¥ç”¨æ¥å¼•ç”¨é…ç½®æ–‡ä»¶é‡Œé…ç½®çš„å€¼ï¼Œä¹Ÿå¯èƒ½å¼•ç”¨åˆ°ç¯å¢ƒå˜é‡ã€ç³»ç»Ÿå‚æ•°ç­‰ã€‚</p><p>è€Œé€šè¿‡æ¡ˆä¾‹2çš„å­¦ä¹ ï¼Œæˆ‘ä»¬äº†è§£åˆ°é›†åˆç±»å‹çš„æ³¨å…¥æ”¯æŒä¸¤ç§å¸¸è§çš„æ–¹å¼ï¼Œå³ä¸Šæ–‡ä¸­æˆ‘ä»¬å‘½åçš„æ”¶é›†è£…é…å¼å’Œç›´æ¥è£…é…å¼ã€‚è¿™ä¸¤ç§æ–¹å¼å…±åŒè£…é…ä¸€ä¸ªå±æ€§æ—¶ï¼Œåè€…å°±ä¼šå¤±æ•ˆã€‚</p><p>ç»¼åˆä¸Šä¸€è®²çš„å†…å®¹ï¼Œæˆ‘ä»¬ä¸€å…±åˆ†æäº†5ä¸ªé—®é¢˜ä»¥åŠèƒŒåçš„åŸç†ï¼Œé€šè¿‡è¿™äº›æ¡ˆä¾‹çš„åˆ†æï¼Œæˆ‘ä»¬ä¸éš¾çœ‹å‡ºSpringçš„è‡ªåŠ¨æ³¨å…¥éå¸¸å¼ºå¤§ï¼Œå›´ç»•@Autowiredã€@Qualifierã€@Valueç­‰å†…ç½®æ³¨è§£ï¼Œæˆ‘ä»¬å¯ä»¥å®Œæˆä¸åŒçš„æ³¨å…¥ç›®æ ‡å’Œéœ€æ±‚ã€‚ä¸è¿‡è¿™ç§å¼ºå¤§ï¼Œæ­£å¦‚æˆ‘åœ¨<a href=\"https://time.geekbang.org/column/article/364661\">å¼€ç¯‡è¯</a>ä¸­æåŠçš„ï¼Œå®ƒå»ºç«‹åœ¨å¾ˆå¤šéšæ€§çš„è§„åˆ™ä¹‹ä¸Šã€‚åªæœ‰ä½ æŠŠè¿™äº›è§„åˆ™éƒ½çƒ‚ç†Ÿäºå¿ƒäº†ï¼Œæ‰èƒ½å¾ˆå¥½åœ°å»è§„é¿é—®é¢˜ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>åœ¨æ¡ˆä¾‹2ä¸­ï¼Œæˆ‘ä»¬åˆæ¬¡è¿è¡Œç¨‹åºè·å–çš„ç»“æœå¦‚ä¸‹ï¼š</p><blockquote>\n<p>[Student(id=1, name=xie), Student(id=2, name=fang)]</p>\n</blockquote><p>é‚£ä¹ˆå¦‚ä½•åšåˆ°è®©å­¦ç”Ÿ2ä¼˜å…ˆè¾“å‡ºå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ç•™è¨€åŒºè§ï¼</p>","neighbors":{"left":{"article_title":"02ï½œSpring Bean ä¾èµ–æ³¨å…¥å¸¸è§é”™è¯¯ï¼ˆä¸Šï¼‰","id":366170},"right":{"article_title":"04ï½œSpring Bean ç”Ÿå‘½å‘¨æœŸå¸¸è§é”™è¯¯","id":367876}},"comments":[{"had_liked":false,"id":297957,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1623854264,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"164832611512","product_id":100077001,"comment_content":"æ€è€ƒé¢˜ï¼š<br>æ–¹æ³•ä¸€ï¼šæ·»åŠ @Order(number)æ³¨è§£ï¼Œnumberè¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šé å‰<br>æ–¹æ³•äºŒï¼šå£°æ˜Studentè¿™äº›Beanæ—¶å°†id=2çš„Studentæåˆ°id=1ä¹‹å‰<br><br>","like_count":39},{"had_liked":false,"id":290505,"user_name":"ç¬¨é±¼","can_delete":false,"product_type":"c1","uid":1080625,"ip_address":"","ucode":"FF99952DBD448C","user_header":"https://static001.geekbang.org/account/avatar/00/10/7d/31/fd301a35.jpg","comment_is_top":false,"comment_ctime":1619593836,"is_pvip":true,"discussion_count":3,"race_medal":0,"score":"27389397612","product_id":100077001,"comment_content":"StudentControlleræ„é€ å‡½æ•°ä¸Šä¸éœ€è¦åŠ @Autowiredæ³¨è§£å—ï¼Ÿ","like_count":6,"discussions":[{"author":{"id":2594123,"avatar":"https://static001.geekbang.org/account/avatar/00/27/95/4b/9b50efe3.jpg","nickname":"å®‰çœ ","note":"","ucode":"94AC6BE1FFD257","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384199,"discussion_content":"æ˜¾ç¤ºå£°æ˜æ„é€ å™¨çš„æ—¶å€™ï¼Œbeanåˆ›å»ºï¼Œå°±æ˜¯èµ°å£°æ˜çš„æ„é€ å™¨åˆ›å»ºï¼Œå‚æ•°çš„beanå¯¹è±¡ï¼Œä¼šåœ¨Springå®¹å™¨ä¸­æŸ¥æ‰¾","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1626421951,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1375256,"avatar":"https://static001.geekbang.org/account/avatar/00/14/fc/18/8e69f7cf.jpg","nickname":"TANMIYOO","note":"","ucode":"BC3556131D4D61","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371416,"discussion_content":"spring beanå®šä¹‰å¸¸è§é”™è¯¯ä½ æ˜¯å’‹å­¦çš„?","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1619764245,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1168960,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d6/40/e1a51ac1.jpg","nickname":"Washington","note":"","ucode":"00F5F36416147D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371317,"discussion_content":"é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ä¸éœ€è¦åŠ @Autowired","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1619725418,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290278,"user_name":"Ball","can_delete":false,"product_type":"c1","uid":1521451,"ip_address":"","ucode":"1EE949E68D84CA","user_header":"https://static001.geekbang.org/account/avatar/00/17/37/2b/b32f1d66.jpg","comment_is_top":false,"comment_ctime":1619483297,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27389287073","product_id":100077001,"comment_content":"ä»Šå¤©çš„è¯¾ç¨‹ç»™å‡ºçš„é—®é¢˜ç›´å‡»ä¸šåŠ¡ç—›ç‚¹ï¼æˆ‘ä»¬éå¸¸æ–¹ä¾¿çš„ä½¿ç”¨ä¾èµ–æ³¨å…¥çš„ç‰¹æ€§æ—¶ï¼Œå¿…é¡»è¦æ€è€ƒğŸ¤”å¯¹è±¡ä»å“ªé‡Œæ³¨å…¥ã€æ€ä¹ˆåˆ›å»ºã€ä¸ºä»€ä¹ˆæ˜¯æ³¨å…¥è¿™ä¸€ä¸ªå¯¹è±¡çš„ã€‚è™½ç„¶ç¼–å†™æ¡†æ¶çš„ç›®çš„æ˜¯è®©å¼€å‘äººå‘˜æ— éœ€å…³å¿ƒå¤ªå¤šåº•å±‚ç»†èŠ‚ï¼Œèƒ½ä¸“å¿ƒä¸šåŠ¡é€»è¾‘çš„å¼€å‘ï¼Œä½†æ˜¯ä½œä¸ºå¼€å‘äººå‘˜ä¸èƒ½çœŸçš„æ— è„‘å»ä½¿ç”¨æ¡†æ¶ã€‚<br>å¦å¤–ï¼Œæˆ‘è¿˜å¾—å­¦ä¼šæ³¨å…¥é›†åˆç­‰é«˜çº§ç”¨æ³•ï¼Œä¹‹å‰ä¸šåŠ¡ä¸Šéƒ½æ˜¯ç”¨çš„æ³¨å…¥å•ä¸ªå¯¹è±¡çš„ç®€å•ç”¨æ³•ï¼Œå¿…é¡»æœ‰æ‰€æå‡ã€‚","like_count":6},{"had_liked":false,"id":319312,"user_name":"if...else...","can_delete":false,"product_type":"c1","uid":2550743,"ip_address":"","ucode":"D0565908C99695","user_header":"https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg","comment_is_top":false,"comment_ctime":1635738925,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10225673517","product_id":100077001,"comment_content":"ä¸é”™ï¼Œå­¦ä¹ äº†","like_count":2},{"had_liked":false,"id":292472,"user_name":"æš–è‰²æµ®ä½™ç”Ÿ","can_delete":false,"product_type":"c1","uid":1593126,"ip_address":"","ucode":"ED943F2DF88896","user_header":"https://static001.geekbang.org/account/avatar/00/18/4f/26/f21afb83.jpg","comment_is_top":false,"comment_ctime":1620833218,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"10210767810","product_id":100077001,"comment_content":"å‘ç°ä¸€ä¸ªé—®é¢˜ã€‚é€šè¿‡æ”¶é›†æ¨¡å¼è·å–ã€‚æ¯”å¦‚æˆ‘å¾— StudentController ç±»ä¸­é€šè¿‡ @Bean çš„æ–¹å¼å£°æ˜ä¸€ä¸ª bean çš„æ—¶å€™ï¼Œæ”¶é›†æ¨¡å¼å¹¶ä¸ä¼šæ”¶é›†åˆ°å½“å‰å£°æ˜çš„è¿™ä¸ª Student beanã€‚å½“æˆ‘çš„ @Bean æ ‡æ³¨çš„æ–¹æ³•ä¸º static çš„æ—¶å€™ï¼Œæ”¶é›†æ¨¡å¼æ­¤æ—¶æ”¶é›†åˆ°çš„æ˜¯ 3 ä¸ª bean. æ„Ÿè§‰å¤§æ¦‚æ˜¯å½“æˆ‘çš„ bean å®ä¾‹åŒ–å®Œæˆä¹‹åæ‰ä¼šè°ƒç”¨ @Bean æ ‡æ³¨çš„éé™æ€æ–¹æ³•ï¼Œå› ä¸ºå®ä¾‹åŒ–æœªå®Œæˆæ— æ³•è°ƒç”¨ã€‚ è€Œé™æ€æ–¹æ³•å¹¶ä¸ä¾èµ– bean å®ä¾‹åŒ–ã€‚æ²¡æ‰¾åˆ°å…·ä½“çš„ä»£ç ","like_count":2,"discussions":[{"author":{"id":2227949,"avatar":"https://static001.geekbang.org/account/avatar/00/21/fe/ed/a37ce1e3.jpg","nickname":"C","note":"","ucode":"E7743DB82C5B55","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":405787,"discussion_content":"å¯¹ï¼Œä½ çš„æƒ³æ³•æ˜¯å¯¹çš„ã€‚@Beanæ ‡æ³¨çš„æ–¹æ³•å£°æ˜åœ¨ç±»å†…éƒ¨æ—¶ï¼Œä¼šé€šè¿‡ConfigurationClassBeanDefinitionReader#loadBeanDefinitionsForBeanMethodåŠ è½½ï¼Œå¦‚æœæ–¹æ³•ä¸æ˜¯staticä¿®é¥°çš„å°†ä¼šè®¾ç½®@Beanæ‰€å±AbstractBeanDefinitionçš„factoryBeanNameå±æ€§ï¼ŒBeanFactoryåœ¨å®ä¾‹åŒ–@Beanæ‰€å±çš„å®ä¾‹æ—¶(AbstractAutowireCapableBeanFactory#createBeanInstance)ï¼Œå‘ç°AbstractBeanDefinitionçš„factoryBeanNameä¸ä¸ºç©ºæ—¶ï¼Œä¼šè°ƒç”¨AbstractAutowireCapableBeanFactory#instantiateUsingFactoryMethodï¼Œè¯¥æ–¹æ³•ä¼šå°†factoryBeanNameæ‰€æŒ‡å‘çš„Beanåˆ›å»ºå‡ºæ¥ï¼Œç„¶åé€šè¿‡åå°„è°ƒç”¨è¯¥Beanæ ‡è®°ä¸º@Beançš„æ–¹æ³•è·å–æ‰§è¡Œç»“æœ(ä¹Ÿå°±æ˜¯è¦åˆ›å»ºçš„Bean)ï¼Œç„¶åæ”¾å…¥BeanFactoryä¸­ã€‚å½“ç„¶ï¼Œè¿™ä¸€åˆ‡è¿˜éœ€è¦ä½ å»æ±‚è¯ï¼Œæˆ‘çœ‹çš„Springç‰ˆæœ¬æ˜¯5.3.5ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634646387,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1306315,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ee/cb/4bd24e0f.jpg","nickname":"å®˜äºº","note":"","ucode":"ECEF55B08E252B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382393,"discussion_content":"ConfigurationClassBeanDefinitionReader#loadBeanDefinitionsForBeanMethod ä¼šå¤„ç†static å’Œéé™æ€çš„bean","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625555326,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1306315,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ee/cb/4bd24e0f.jpg","nickname":"å®˜äºº","note":"","ucode":"ECEF55B08E252B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382392,"discussion_content":"ConfigurationClassParser#retrieveBeanMethodMetadata","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625554911,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290241,"user_name":"qlmmys","can_delete":false,"product_type":"c1","uid":1558222,"ip_address":"","ucode":"B9C6B37FF80F06","user_header":"https://static001.geekbang.org/account/avatar/00/17/c6/ce/c1376d80.jpg","comment_is_top":false,"comment_ctime":1619445524,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10209380116","product_id":100077001,"comment_content":"æ€è€ƒé¢˜<br>springæŒ‰ç…§beanå£°æ˜çš„é¡ºåºåŠ è½½beanï¼Œå¹¶é¡ºåºä¿å­˜ã€‚æ‰€ä»¥æƒ³è®©å­¦ç”Ÿ2ä¼˜å…ˆè¾“å‡ºï¼Œä¸»éœ€è¦ä¼˜å…ˆå£°æ˜å­¦ç”Ÿ2å³å¯","like_count":2},{"had_liked":false,"id":290227,"user_name":"å“¦å¼æ‰äº†","can_delete":false,"product_type":"c1","uid":1232599,"ip_address":"","ucode":"1F89B1BA1EEF52","user_header":"https://static001.geekbang.org/account/avatar/00/12/ce/d7/8168e1bf.jpg","comment_is_top":false,"comment_ctime":1619441587,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"10209376179","product_id":100077001,"comment_content":"æ€è€ƒé¢˜ï¼š<br>æ”¶é›†è£…é…é£æ ¼ï¼šåªèƒ½é€šè¿‡å®ä½“ç±»å®ç°Orderedæ¥å£ getOrderæ–¹æ³•ä¸­æŒ‡å®šä¸€ä¸ªé¡ºåº<br>ç›´æ¥è£…é…æ–¹å¼ï¼šé™¤äº†ä¸Šè¿°æ–¹å¼ï¼Œè¿˜å¯ä»¥@Order ã€@Priorityæ³¨è§£æŒ‡å®šé¡ºåºã€‚","like_count":2,"discussions":[{"author":{"id":1122971,"avatar":"https://static001.geekbang.org/account/avatar/00/11/22/9b/e948d5c3.jpg","nickname":"Nightwish","note":"","ucode":"29CC83987C6134","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374349,"discussion_content":"è¿™äº›æ³¨è§£æˆ–è€…æ¥å£æ˜¯æ€ä¹ˆç¡®å®šé¡ºåºçš„ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621148498,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326262,"user_name":"Geek7319","can_delete":false,"product_type":"c1","uid":2854210,"ip_address":"","ucode":"47B5934C973BD6","user_header":"","comment_is_top":false,"comment_ctime":1639452077,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5934419373","product_id":100077001,"comment_content":"é’ˆå¯¹é—®é¢˜1ï¼Œæ˜¯å¦å¯ä»¥å¯ä»¥ä½¿ç”¨@PropertySourceé…ç½®æ–‡ä»¶è·¯å¾„å‘¢ã€‚ ä»å›ºå®šé…ç½®æ–‡ä»¶è·¯å¾„æŠ½å–valueå€¼ï¼Œå°±æ— éœ€è€ƒè™‘å¤šä¸ªé…ç½®æ–‡ä»¶å‘½åå†²çªé—®é¢˜","like_count":1},{"had_liked":false,"id":292847,"user_name":"è™¹ç‚","can_delete":false,"product_type":"c1","uid":1600615,"ip_address":"","ucode":"9E28ACEBFB26D5","user_header":"https://static001.geekbang.org/account/avatar/00/18/6c/67/07bcc58f.jpg","comment_is_top":false,"comment_ctime":1621007998,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5915975294","product_id":100077001,"comment_content":"æ§åˆ¶spring beanåŠ è½½é¡ºåºï¼š<br>1ï¼ŒBeanä¸Šä½¿ç”¨@Orderæ³¨è§£ï¼Œå¦‚@Order(2)ã€‚æ•°å€¼è¶Šå°è¡¨ç¤ºä¼˜å…ˆçº§è¶Šé«˜ã€‚é»˜è®¤ä¼˜å…ˆçº§æœ€ä½ã€‚<br>2ï¼Œ@DependsOn    ä½¿ç”¨å®ƒï¼Œå¯ä½¿å¾—ä¾èµ–çš„Beanå¦‚æœæœªè¢«åˆå§‹åŒ–ä¼šè¢«ä¼˜å…ˆåˆå§‹åŒ–ã€‚","like_count":1,"discussions":[{"author":{"id":1023101,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/9c/7d/774e07f9.jpg","nickname":"studyçš„ç¨‹åºå‘˜","note":"","ucode":"E5AE9037D24429","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582683,"discussion_content":"@DependsOnä¸è¡Œï¼Œæ˜¯ä¸æ˜¯å› ä¸ºåˆå§‹åŒ–çš„é¡ºåºå’Œæ³¨å…¥çš„é¡ºåºæ— å…³ ï¼Ÿ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659596309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1331611,"avatar":"https://static001.geekbang.org/account/avatar/00/14/51/9b/ccea47d9.jpg","nickname":"å®‰è¿ªå¯†æ©","note":"","ucode":"A6F3F67CF8E6F8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555011,"discussion_content":"@DependsOn ä¸å¥½ç”¨å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646721803,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354933,"user_name":"é™Œå…®","can_delete":false,"product_type":"c1","uid":1415619,"ip_address":"å¹¿ä¸œ","ucode":"00CE47CAECD5CD","user_header":"https://static001.geekbang.org/account/avatar/00/15/99/c3/e4f408d4.jpg","comment_is_top":false,"comment_ctime":1660894113,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1660894113","product_id":100077001,"comment_content":"@Valueè¿™ä¸ªç‚¹æ˜¯ä¹‹å‰ä»æ¥æ²¡æœ‰è€ƒè™‘åˆ°çš„","like_count":0},{"had_liked":false,"id":332210,"user_name":"å­å¤œæ¯ç¯","can_delete":false,"product_type":"c1","uid":1359678,"ip_address":"","ucode":"5D84BFE7832038","user_header":"https://static001.geekbang.org/account/avatar/00/14/bf/3e/cdc36608.jpg","comment_is_top":false,"comment_ctime":1643097236,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1643097236","product_id":100077001,"comment_content":"æ·»åŠ @Order(number)æ³¨è§£ï¼Œnumberè¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼Œè¶Šé å‰","like_count":0},{"had_liked":false,"id":291159,"user_name":"arch","can_delete":false,"product_type":"c1","uid":1078931,"ip_address":"","ucode":"A69EBFE0520B85","user_header":"https://static001.geekbang.org/account/avatar/00/10/76/93/64ed7385.jpg","comment_is_top":false,"comment_ctime":1620060460,"is_pvip":true,"discussion_count":3,"race_medal":0,"score":"1620060460","product_id":100077001,"comment_content":"StudentControlleræ„é€ å‡½æ•°ä¸Šåº”è¯¥éœ€è¦åŠ @Autowiredæ³¨è§£","like_count":0,"discussions":[{"author":{"id":1366631,"avatar":"https://static001.geekbang.org/account/avatar/00/14/da/67/73a0c754.jpg","nickname":"gallifrey","note":"","ucode":"A4E5E0E7E2DEF9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":569553,"discussion_content":"è¯¦è§01 | Spring Bean å®šä¹‰å¸¸è§é”™è¯¯ æ¡ˆä¾‹2","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651477573,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1331611,"avatar":"https://static001.geekbang.org/account/avatar/00/14/51/9b/ccea47d9.jpg","nickname":"å®‰è¿ªå¯†æ©","note":"","ucode":"A6F3F67CF8E6F8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555013,"discussion_content":"ä¸éœ€è¦çš„ã€‚è‡ªå·±è¯•è¯•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646721962,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2450893,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/L8EpqHoAnmvkzCIsdOkv5QvhIzu5tMaF2FDusXShqukv5ZBkS8DbicWaErjnYydibiaqBrs70wQ8P6axvC2FbWpbQ/132","nickname":"Geek_d3928c","note":"","ucode":"7CB09FD1F7CB23","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553597,"discussion_content":"æ„é€ å‡½æ•°æ³¨å…¥äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645975214,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290200,"user_name":"é™ˆè¶Š","can_delete":false,"product_type":"c1","uid":1007632,"ip_address":"","ucode":"C27ED9BE19913E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/60/10/2c533d89.jpg","comment_is_top":false,"comment_ctime":1619427259,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1619427259","product_id":100077001,"comment_content":"orderæ³¨è§£<br>å®ç°orderedæ¥å£","like_count":0}]}