{"id":148148,"title":"28 | I/Oå¤šè·¯å¤ç”¨è¿›é˜¶ï¼šå­çº¿ç¨‹ä½¿ç”¨pollå¤„ç†è¿æ¥I/Oäº‹ä»¶","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç››å»¶æ•ï¼Œè¿™é‡Œæ˜¯ç½‘ç»œç¼–ç¨‹å®æˆ˜ç¬¬28è®²ï¼Œæ¬¢è¿å›æ¥ã€‚</p><p>åœ¨å‰é¢çš„ç¬¬27è®²ä¸­ï¼Œæˆ‘ä»¬å¼•å…¥äº†reactorååº”å †æ¨¡å¼ï¼Œå¹¶ä¸”è®©reactorååº”å †åŒæ—¶åˆ†å‘Acceptorä¸Šçš„è¿æ¥å»ºç«‹äº‹ä»¶å’Œå·²å»ºç«‹è¿æ¥çš„I/Oäº‹ä»¶ã€‚</p><p>æˆ‘ä»¬ä»”ç»†æƒ³æƒ³è¿™ç§æ¨¡å¼ï¼Œåœ¨å‘èµ·è¿æ¥è¯·æ±‚çš„å®¢æˆ·ç«¯éå¸¸å¤šçš„æƒ…å†µä¸‹ï¼Œæœ‰ä¸€ä¸ªåœ°æ–¹æ˜¯æœ‰é—®é¢˜çš„ï¼Œé‚£å°±æ˜¯å•reactorçº¿ç¨‹æ—¢åˆ†å‘è¿æ¥å»ºç«‹ï¼Œåˆåˆ†å‘å·²å»ºç«‹è¿æ¥çš„I/Oï¼Œæœ‰ç‚¹å¿™ä¸è¿‡æ¥ï¼Œåœ¨å®æˆ˜ä¸­çš„è¡¨ç°å¯èƒ½å°±æ˜¯å®¢æˆ·ç«¯è¿æ¥æˆåŠŸç‡åä½ã€‚</p><p>å†è€…ï¼Œæ–°çš„ç¡¬ä»¶æŠ€æœ¯ä¸æ–­å‘å±•ï¼Œå¤šæ ¸å¤šè·¯CPUå·²ç»å¾—åˆ°æå¤§çš„åº”ç”¨ï¼Œå•reactorååº”å †æ¨¡å¼çœ‹ç€å¤§æŠŠçš„CPUèµ„æºå´ä¸ç”¨ï¼Œæœ‰ç‚¹å¯æƒœã€‚</p><p>è¿™ä¸€è®²æˆ‘ä»¬å°±å°†acceptorä¸Šçš„è¿æ¥å»ºç«‹äº‹ä»¶å’Œå·²å»ºç«‹è¿æ¥çš„I/Oäº‹ä»¶åˆ†ç¦»ï¼Œå½¢æˆæ‰€è°“çš„ä¸»-ä»reactoræ¨¡å¼ã€‚</p><h2>ä¸»-ä»reactoræ¨¡å¼</h2><p>ä¸‹é¢çš„è¿™å¼ å›¾æè¿°äº†ä¸»-ä»reactoræ¨¡å¼æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><p>ä¸»-ä»è¿™ä¸ªæ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œä¸»ååº”å †çº¿ç¨‹åªè´Ÿè´£åˆ†å‘Acceptorè¿æ¥å»ºç«‹ï¼Œå·²è¿æ¥å¥—æ¥å­—ä¸Šçš„I/Oäº‹ä»¶äº¤ç»™sub-reactorè´Ÿè´£åˆ†å‘ã€‚å…¶ä¸­sub-reactorçš„æ•°é‡ï¼Œå¯ä»¥æ ¹æ®CPUçš„æ ¸æ•°æ¥çµæ´»è®¾ç½®ã€‚</p><p>æ¯”å¦‚ä¸€ä¸ªå››æ ¸CPUï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®sub-reactorä¸º4ã€‚ç›¸å½“äºæœ‰4ä¸ªèº«æ‰‹ä¸å‡¡çš„ååº”å †çº¿ç¨‹åŒæ—¶åœ¨å·¥ä½œï¼Œè¿™å¤§å¤§å¢å¼ºäº†I/Oåˆ†å‘å¤„ç†çš„æ•ˆç‡ã€‚è€Œä¸”ï¼ŒåŒä¸€ä¸ªå¥—æ¥å­—äº‹ä»¶åˆ†å‘åªä¼šå‡ºç°åœ¨ä¸€ä¸ªååº”å †çº¿ç¨‹ä¸­ï¼Œè¿™ä¼šå¤§å¤§å‡å°‘å¹¶å‘å¤„ç†çš„é”å¼€é”€ã€‚</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/92/2a/9269551b14c51dc9605f43d441c5a92a.png?wh=1026*1108\" alt=\"\"><br>\næˆ‘æ¥è§£é‡Šä¸€ä¸‹è¿™å¼ å›¾ï¼Œæˆ‘ä»¬çš„ä¸»ååº”å †çº¿ç¨‹ä¸€ç›´åœ¨æ„ŸçŸ¥è¿æ¥å»ºç«‹çš„äº‹ä»¶ï¼Œå¦‚æœæœ‰è¿æ¥æˆåŠŸå»ºç«‹ï¼Œä¸»ååº”å †çº¿ç¨‹é€šè¿‡acceptæ–¹æ³•è·å–å·²è¿æ¥å¥—æ¥å­—ï¼Œæ¥ä¸‹æ¥ä¼šæŒ‰ç…§ä¸€å®šçš„ç®—æ³•é€‰å–ä¸€ä¸ªä»ååº”å †çº¿ç¨‹ï¼Œå¹¶æŠŠå·²è¿æ¥å¥—æ¥å­—åŠ å…¥åˆ°é€‰æ‹©å¥½çš„ä»ååº”å †çº¿ç¨‹ä¸­ã€‚</p><p>ä¸»ååº”å †çº¿ç¨‹å”¯ä¸€çš„å·¥ä½œï¼Œå°±æ˜¯è°ƒç”¨acceptè·å–å·²è¿æ¥å¥—æ¥å­—ï¼Œä»¥åŠå°†å·²è¿æ¥å¥—æ¥å­—åŠ å…¥åˆ°ä»ååº”å †çº¿ç¨‹ä¸­ã€‚ä¸è¿‡ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå°é—®é¢˜ï¼Œä¸»ååº”å †çº¿ç¨‹å’Œä»ååº”å †çº¿ç¨‹ï¼Œæ˜¯ä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹ï¼Œå¦‚ä½•æŠŠå·²è¿æ¥å¥—æ¥å­—åŠ å…¥åˆ°å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä¸­å‘¢ï¼Ÿæ›´ä»¤äººæ²®ä¸§çš„æ˜¯ï¼Œæ­¤æ—¶ä»ååº”å †çº¿ç¨‹æˆ–è®¸å¤„äºäº‹ä»¶åˆ†å‘çš„æ— é™å¾ªç¯ä¹‹ä¸­ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>æˆ‘åœ¨è¿™é‡Œå…ˆå–ä¸ªå…³å­ï¼Œè¿™æ˜¯é«˜æ€§èƒ½ç½‘ç»œç¨‹åºæ¡†æ¶è¦è§£å†³çš„é—®é¢˜ã€‚åœ¨å®æˆ˜ç¯‡é‡Œï¼Œæˆ‘å°†ä¸ºè¿™äº›é—®é¢˜ä¸€ä¸€è§£å¼€ç­”æ¡ˆã€‚</p><h2>ä¸»-ä»reactor+worker threadsæ¨¡å¼</h2><p>å¦‚æœè¯´ä¸»-ä»reactoræ¨¡å¼è§£å†³äº†I/Oåˆ†å‘çš„é«˜æ•ˆç‡é—®é¢˜ï¼Œé‚£ä¹ˆwork threadså°±è§£å†³äº†ä¸šåŠ¡é€»è¾‘å’ŒI/Oåˆ†å‘ä¹‹é—´çš„è€¦åˆé—®é¢˜ã€‚æŠŠè¿™ä¸¤ä¸ªç­–ç•¥ç»„è£…åœ¨ä¸€èµ·ï¼Œå°±æ˜¯å®æˆ˜ä¸­æ™®éé‡‡ç”¨çš„æ¨¡å¼ã€‚å¤§åé¼é¼çš„Nettyï¼Œå°±æ˜¯æŠŠè¿™ç§æ¨¡å¼å‘æŒ¥åˆ°æè‡´çš„ä¸€ç§å®ç°ã€‚ä¸è¿‡è¦æ³¨æ„Nettyé‡Œé¢æåˆ°çš„workerçº¿ç¨‹ï¼Œå…¶å®å°±æ˜¯æˆ‘ä»¬è¿™é‡Œè¯´çš„ä»reactorçº¿ç¨‹ï¼Œå¹¶ä¸æ˜¯å¤„ç†å…·ä½“ä¸šåŠ¡é€»è¾‘çš„workerçº¿ç¨‹ã€‚</p><p>ä¸‹é¢è´´çš„ä¸€æ®µä»£ç å°±æ˜¯å¸¸è§çš„Nettyåˆå§‹åŒ–ä»£ç ï¼Œè¿™é‡ŒBoss  Groupå°±æ˜¯acceptorä¸»ååº”å †ï¼ŒworkerGroupå°±æ˜¯ä»ååº”å †ã€‚è€Œå¤„ç†ä¸šåŠ¡é€»è¾‘çš„çº¿ç¨‹ï¼Œé€šå¸¸éƒ½æ˜¯é€šè¿‡ä½¿ç”¨Nettyçš„ç¨‹åºå¼€å‘è€…è¿›è¡Œè®¾è®¡å’Œå®šåˆ¶ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä¸šåŠ¡é€»è¾‘çº¿ç¨‹éœ€è¦ä»workerGroupçº¿ç¨‹ä¸­åˆ†ç¦»ï¼Œä»¥ä¾¿æ”¯æŒæ›´é«˜çš„å¹¶å‘åº¦ã€‚</p><pre><code>public final class TelnetServer {\n    static final int PORT = Integer.parseInt(System.getProperty(&quot;port&quot;, SSL? &quot;8992&quot; : &quot;8023&quot;));\n\n    public static void main(String[] args) throws Exception {\n        //äº§ç”Ÿä¸€ä¸ªreactorçº¿ç¨‹ï¼Œåªè´Ÿè´£accetporçš„å¯¹åº”å¤„ç†\n        EventLoopGroup bossGroup = new NioEventLoopGroup(1);\n        //äº§ç”Ÿä¸€ä¸ªreactorçº¿ç¨‹ï¼Œè´Ÿè´£å¤„ç†å·²è¿æ¥å¥—æ¥å­—çš„I/Oäº‹ä»¶åˆ†å‘\n        EventLoopGroup workerGroup = new NioEventLoopGroup(1);\n        try {\n           //æ ‡å‡†çš„Nettyåˆå§‹ï¼Œé€šè¿‡serverbootstrapå®Œæˆçº¿ç¨‹æ± ã€channelä»¥åŠå¯¹åº”çš„handlerè®¾ç½®ï¼Œæ³¨æ„è¿™é‡Œè®²bossGroupå’ŒworkerGroupä½œä¸ºå‚æ•°è®¾ç½®\n            ServerBootstrap b = new ServerBootstrap();\n            b.group(bossGroup, workerGroup)\n             .channel(NioServerSocketChannel.class)\n             .handler(new LoggingHandler(LogLevel.INFO))\n             .childHandler(new TelnetServerInitializer(sslCtx));\n\n            //å¼€å¯ä¸¤ä¸ªreactorçº¿ç¨‹æ— é™å¾ªç¯å¤„ç†\n            b.bind(PORT).sync().channel().closeFuture().sync();\n        } finally {\n            bossGroup.shutdownGracefully();\n            workerGroup.shutdownGracefully();\n        }\n    }\n}\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/1e/b4/1e647269a5f51497bd5488b2a44444b4.png?wh=3340*6055\" alt=\"\"><br>\nè¿™å¼ å›¾è§£é‡Šäº†ä¸»-ä»ååº”å †ä¸‹åŠ ä¸Šworkerçº¿ç¨‹æ± çš„å¤„ç†æ¨¡å¼ã€‚</p><p>ä¸»-ä»ååº”å †è·Ÿä¸Šé¢ä»‹ç»çš„åšæ³•æ˜¯ä¸€æ ·çš„ã€‚å’Œä¸Šé¢ä¸ä¸€æ ·çš„æ˜¯ï¼Œè¿™é‡Œå°†decodeã€computeã€encodeç­‰CPUå¯†é›†å‹çš„å·¥ä½œä»I/Oçº¿ç¨‹ä¸­æ‹¿èµ°ï¼Œè¿™äº›å·¥ä½œäº¤ç»™workerçº¿ç¨‹æ± æ¥å¤„ç†ï¼Œè€Œä¸”è¿™äº›å·¥ä½œæ‹†åˆ†æˆäº†ä¸€ä¸ªä¸ªå­ä»»åŠ¡è¿›è¡Œã€‚encodeä¹‹åå®Œæˆçš„ç»“æœå†ç”±sub-reactorçš„I/Oçº¿ç¨‹å‘é€å‡ºå»ã€‚</p><h2>æ ·ä¾‹ç¨‹åº</h2><pre><code>#include &lt;lib/acceptor.h&gt;\n#include &quot;lib/common.h&quot;\n#include &quot;lib/event_loop.h&quot;\n#include &quot;lib/tcp_server.h&quot;\n\nchar rot13_char(char c) {\n    if ((c &gt;= 'a' &amp;&amp; c &lt;= 'm') || (c &gt;= 'A' &amp;&amp; c &lt;= 'M'))\n        return c + 13;\n    else if ((c &gt;= 'n' &amp;&amp; c &lt;= 'z') || (c &gt;= 'N' &amp;&amp; c &lt;= 'Z'))\n        return c - 13;\n    else\n        return c;\n}\n\n//è¿æ¥å»ºç«‹ä¹‹åçš„callback\nint onConnectionCompleted(struct tcp_connection *tcpConnection) {\n    printf(&quot;connection completed\\n&quot;);\n    return 0;\n}\n\n//æ•°æ®è¯»åˆ°bufferä¹‹åçš„callback\nint onMessage(struct buffer *input, struct tcp_connection *tcpConnection) {\n    printf(&quot;get message from tcp connection %s\\n&quot;, tcpConnection-&gt;name);\n    printf(&quot;%s&quot;, input-&gt;data);\n\n    struct buffer *output = buffer_new();\n    int size = buffer_readable_size(input);\n    for (int i = 0; i &lt; size; i++) {\n        buffer_append_char(output, rot13_char(buffer_read_char(input)));\n    }\n    tcp_connection_send_buffer(tcpConnection, output);\n    return 0;\n}\n\n//æ•°æ®é€šè¿‡bufferå†™å®Œä¹‹åçš„callback\nint onWriteCompleted(struct tcp_connection *tcpConnection) {\n    printf(&quot;write completed\\n&quot;);\n    return 0;\n}\n\n//è¿æ¥å…³é—­ä¹‹åçš„callback\nint onConnectionClosed(struct tcp_connection *tcpConnection) {\n    printf(&quot;connection closed\\n&quot;);\n    return 0;\n}\n\nint main(int c, char **v) {\n    //ä¸»çº¿ç¨‹event_loop\n    struct event_loop *eventLoop = event_loop_init();\n\n    //åˆå§‹åŒ–acceptor\n    struct acceptor *acceptor = acceptor_init(SERV_PORT);\n\n    //åˆå§‹tcp_serverï¼Œå¯ä»¥æŒ‡å®šçº¿ç¨‹æ•°ç›®ï¼Œè¿™é‡Œçº¿ç¨‹æ˜¯4ï¼Œè¯´æ˜æ˜¯ä¸€ä¸ªacceptorçº¿ç¨‹ï¼Œ4ä¸ªI/Oçº¿ç¨‹ï¼Œæ²¡ä¸€ä¸ªI/Oçº¿ç¨‹\n    //tcp_serverè‡ªå·±å¸¦ä¸€ä¸ªevent_loop\n    struct TCPserver *tcpServer = tcp_server_init(eventLoop, acceptor, onConnectionCompleted, onMessage,\n                                                  onWriteCompleted, onConnectionClosed, 4);\n    tcp_server_start(tcpServer);\n\n    // main thread for acceptor\n    event_loop_run(eventLoop);\n}\n</code></pre><p>æˆ‘ä»¬çš„æ ·ä¾‹ç¨‹åºå‡ ä¹å’Œç¬¬27è®²çš„ä¸€æ ·ï¼Œå”¯ä¸€çš„ä¸åŒæ˜¯åœ¨åˆ›å»ºTCPServeræ—¶ï¼Œçº¿ç¨‹çš„æ•°é‡è®¾ç½®ä¸å†æ˜¯0ï¼Œè€Œæ˜¯4ã€‚è¿™é‡Œçº¿ç¨‹æ˜¯4ï¼Œè¯´æ˜æ˜¯ä¸€ä¸ªä¸»acceptorçº¿ç¨‹ï¼Œ4ä¸ªä»reactorçº¿ç¨‹ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½è·Ÿä¸€ä¸ªevent_loopä¸€ä¸€ç»‘å®šã€‚</p><p>ä½ å¯èƒ½ä¼šé—®ï¼Œè¿™ä¹ˆç®€å•å°±å®Œæˆäº†ä¸»ã€ä»çº¿ç¨‹çš„é…ç½®ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯YESã€‚è¿™å…¶å®æ˜¯è®¾è®¡æ¡†æ¶éœ€è¦è€ƒè™‘çš„åœ°æ–¹ï¼Œä¸€ä¸ªæ¡†æ¶ä¸ä»…è¦è€ƒè™‘æ€§èƒ½ã€æ‰©å±•æ€§ï¼Œä¹Ÿéœ€è¦è€ƒè™‘å¯ç”¨æ€§ã€‚å¯ç”¨æ€§éƒ¨åˆ†å°±æ˜¯ç¨‹åºå¼€å‘è€…å¦‚ä½•ä½¿ç”¨æ¡†æ¶ã€‚å¦‚æœæˆ‘æ˜¯ä¸€ä¸ªå¼€å‘è€…ï¼Œæˆ‘è‚¯å®šå…³å¿ƒæ¡†æ¶çš„ä½¿ç”¨æ–¹å¼æ˜¯ä¸æ˜¯è¶³å¤Ÿæ–¹ä¾¿ï¼Œé…ç½®æ˜¯ä¸æ˜¯è¶³å¤Ÿçµæ´»ç­‰ã€‚</p><p>åƒè¿™é‡Œï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚çµæ´»åœ°é…ç½®ä¸»ã€ä»ååº”å †çº¿ç¨‹ï¼Œå°±æ˜¯ä¸€ä¸ªæ˜“ç”¨æ€§çš„ä½“ç°ã€‚å½“ç„¶ï¼Œå› ä¸ºæ—¶é—´æœ‰é™ï¼Œæˆ‘æ²¡æœ‰è€ƒè™‘wokerçº¿ç¨‹çš„éƒ¨åˆ†ï¼Œè¿™éƒ¨åˆ†å…¶å®åº”è¯¥æ˜¯åº”ç”¨ç¨‹åºè‡ªå·±æ¥è®¾è®¡è€ƒè™‘ã€‚ç½‘ç»œç¼–ç¨‹æ¡†æ¶é€šè¿‡å›è°ƒå‡½æ•°æš´éœ²äº†äº¤äº’çš„æ¥å£ï¼Œè¿™é‡Œåº”ç”¨ç¨‹åºå¼€å‘è€…å®Œå…¨å¯ä»¥åœ¨onMessageæ–¹æ³•é‡Œé¢è·å–ä¸€ä¸ªå­çº¿ç¨‹æ¥å¤„ç†encodeã€computeå’Œencodeçš„å·¥ä½œï¼Œåƒä¸‹é¢çš„ç¤ºèŒƒä»£ç ä¸€æ ·ã€‚</p><pre><code>//æ•°æ®è¯»åˆ°bufferä¹‹åçš„callback\nint onMessage(struct buffer *input, struct tcp_connection *tcpConnection) {\n    printf(&quot;get message from tcp connection %s\\n&quot;, tcpConnection-&gt;name);\n    printf(&quot;%s&quot;, input-&gt;data);\n    //å–å‡ºä¸€ä¸ªçº¿ç¨‹æ¥è´Ÿè´£decodeã€computeå’Œencode\n    struct buffer *output = thread_handle(input);\n    //å¤„ç†å®Œä¹‹åå†é€šè¿‡reactor I/Oçº¿ç¨‹å‘é€æ•°æ®\n    tcp_connection_send_buffer(tcpConnection, output);\n    return \n</code></pre><h2>æ ·ä¾‹ç¨‹åºç»“æœ</h2><p>æˆ‘ä»¬å¯åŠ¨è¿™ä¸ªæœåŠ¡å™¨ç«¯ç¨‹åºï¼Œä½ å¯ä»¥ä»æœåŠ¡å™¨ç«¯çš„è¾“å‡ºä¸Šçœ‹åˆ°ä½¿ç”¨äº†pollä½œä¸ºäº‹ä»¶åˆ†å‘æ–¹å¼ã€‚</p><p>å¤šæ‰“å¼€å‡ ä¸ªtelnetå®¢æˆ·ç«¯äº¤äº’ï¼Œmain-threadåªè´Ÿè´£æ–°çš„è¿æ¥å»ºç«‹ï¼Œæ¯ä¸ªå®¢æˆ·ç«¯æ•°æ®çš„æ”¶å‘ç”±ä¸åŒçš„å­çº¿ç¨‹Thread-1ã€Thread-2ã€Thread-3å’ŒThread-4æ¥æä¾›æœåŠ¡ã€‚</p><p>è¿™é‡Œç”±äºä½¿ç”¨äº†å­çº¿ç¨‹è¿›è¡ŒI/Oå¤„ç†ï¼Œä¸»çº¿ç¨‹å¯ä»¥ä¸“æ³¨äºæ–°è¿æ¥å¤„ç†ï¼Œä»è€Œå¤§å¤§æé«˜äº†å®¢æˆ·ç«¯è¿æ¥æˆåŠŸç‡ã€‚</p><pre><code>$./poll-server-multithreads\n[msg] set poll as dispatcher\n[msg] add channel fd == 4, main thread\n[msg] poll added channel fd==4\n[msg] set poll as dispatcher\n[msg] add channel fd == 7, main thread\n[msg] poll added channel fd==7\n[msg] event loop thread init and signal, Thread-1\n[msg] event loop run, Thread-1\n[msg] event loop thread started, Thread-1\n[msg] set poll as dispatcher\n[msg] add channel fd == 9, main thread\n[msg] poll added channel fd==9\n[msg] event loop thread init and signal, Thread-2\n[msg] event loop run, Thread-2\n[msg] event loop thread started, Thread-2\n[msg] set poll as dispatcher\n[msg] add channel fd == 11, main thread\n[msg] poll added channel fd==11\n[msg] event loop thread init and signal, Thread-3\n[msg] event loop thread started, Thread-3\n[msg] set poll as dispatcher\n[msg] event loop run, Thread-3\n[msg] add channel fd == 13, main thread\n[msg] poll added channel fd==13\n[msg] event loop thread init and signal, Thread-4\n[msg] event loop run, Thread-4\n[msg] event loop thread started, Thread-4\n[msg] add channel fd == 5, main thread\n[msg] poll added channel fd==5\n[msg] event loop run, main thread\n[msg] get message channel i==1, fd==5\n[msg] activate channel fd == 5, revents=2, main thread\n[msg] new connection established, socket == 14\nconnection completed\n[msg] get message channel i==0, fd==7\n[msg] activate channel fd == 7, revents=2, Thread-1\n[msg] wakeup, Thread-1\n[msg] add channel fd == 14, Thread-1\n[msg] poll added channel fd==14\n[msg] get message channel i==1, fd==14\n[msg] activate channel fd == 14, revents=2, Thread-1\nget message from tcp connection connection-14\nfasfas\n[msg] get message channel i==1, fd==14\n[msg] activate channel fd == 14, revents=2, Thread-1\nget message from tcp connection connection-14\nfasfas\nasfa\n[msg] get message channel i==1, fd==5\n[msg] activate channel fd == 5, revents=2, main thread\n[msg] new connection established, socket == 15\nconnection completed\n[msg] get message channel i==0, fd==9\n[msg] activate channel fd == 9, revents=2, Thread-2\n[msg] wakeup, Thread-2\n[msg] add channel fd == 15, Thread-2\n[msg] poll added channel fd==15\n[msg] get message channel i==1, fd==15\n[msg] activate channel fd == 15, revents=2, Thread-2\nget message from tcp connection connection-15\nafasdfasf\n[msg] get message channel i==1, fd==15\n[msg] activate channel fd == 15, revents=2, Thread-2\nget message from tcp connection connection-15\nafasdfasf\nsafsafa\n[msg] get message channel i==1, fd==15\n[msg] activate channel fd == 15, revents=2, Thread-2\n[msg] poll delete channel fd==15\nconnection closed\n[msg] get message channel i==1, fd==5\n[msg] activate channel fd == 5, revents=2, main thread\n[msg] new connection established, socket == 16\nconnection completed\n[msg] get message channel i==0, fd==11\n[msg] activate channel fd == 11, revents=2, Thread-3\n[msg] wakeup, Thread-3\n[msg] add channel fd == 16, Thread-3\n[msg] poll added channel fd==16\n[msg] get message channel i==1, fd==16\n[msg] activate channel fd == 16, revents=2, Thread-3\nget message from tcp connection connection-16\nfdasfasdf\n[msg] get message channel i==1, fd==14\n[msg] activate channel fd == 14, revents=2, Thread-1\n[msg] poll delete channel fd==14\nconnection closed\n[msg] get message channel i==1, fd==5\n[msg] activate channel fd == 5, revents=2, main thread\n[msg] new connection established, socket == 17\nconnection completed\n[msg] get message channel i==0, fd==13\n[msg] activate channel fd == 13, revents=2, Thread-4\n[msg] wakeup, Thread-4\n[msg] add channel fd == 17, Thread-4\n[msg] poll added channel fd==17\n[msg] get message channel i==1, fd==17\n[msg] activate channel fd == 17, revents=2, Thread-4\nget message from tcp connection connection-17\nqreqwrq\n[msg] get message channel i==1, fd==16\n[msg] activate channel fd == 16, revents=2, Thread-3\n[msg] poll delete channel fd==16\nconnection closed\n[msg] get message channel i==1, fd==5\n[msg] activate channel fd == 5, revents=2, main thread\n[msg] new connection established, socket == 18\nconnection completed\n[msg] get message channel i==0, fd==7\n[msg] activate channel fd == 7, revents=2, Thread-1\n[msg] wakeup, Thread-1\n[msg] add channel fd == 18, Thread-1\n[msg] poll added channel fd==18\n[msg] get message channel i==1, fd==18\n[msg] activate channel fd == 18, revents=2, Thread-1\nget message from tcp connection connection-18\nfasgasdg\n^C\n</code></pre><h2>æ€»ç»“</h2><p>æœ¬è®²ä¸»è¦è®²è¿°äº†ä¸»ä»reactoræ¨¡å¼ï¼Œä¸»ä»reactoræ¨¡å¼ä¸­ï¼Œä¸»reactoråªè´Ÿè´£è¿æ¥å»ºç«‹çš„å¤„ç†ï¼Œè€ŒæŠŠå·²è¿æ¥å¥—æ¥å­—çš„I/Oäº‹ä»¶åˆ†å‘äº¤ç»™ä»reactorçº¿ç¨‹å¤„ç†ï¼Œè¿™å¤§å¤§æé«˜äº†å®¢æˆ·ç«¯è¿æ¥çš„å¤„ç†èƒ½åŠ›ã€‚ä»Nettyçš„å®ç°ä¸Šæ¥çœ‹ï¼Œä¹Ÿéµå¾ªäº†è¿™ä¸€åŸåˆ™ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>å’Œå¾€å¸¸ä¸€æ ·ï¼Œç»™ä½ ç•™ä¸¤é“æ€è€ƒé¢˜ï¼š</p><p>ç¬¬ä¸€é“ï¼Œä»æ—¥å¿—è¾“å‡ºä¸­ï¼Œä½ è¿˜å¯ä»¥çœ‹åˆ°main-threadé¦–å…ˆåŠ å…¥äº†fdä¸º4çš„å¥—æ¥å­—ï¼Œè¿™ä¸ªæ˜¯ç›‘å¬å¥—æ¥å­—ï¼Œå¾ˆå¥½ç†è§£ã€‚å¯æ˜¯è¿™é‡Œçš„main-threadåˆåŠ å…¥äº†ä¸€ä¸ªfdä¸º7çš„å¥—æ¥å­—ï¼Œè¿™ä¸ªå¥—æ¥å­—æ˜¯å¹²ä»€ä¹ˆç”¨çš„å‘¢ï¼Ÿ</p><p>ç¬¬äºŒé“ï¼Œä½ å¯ä»¥è¯•ç€ä¿®æ”¹ä¸€ä¸‹æœåŠ¡å™¨ç«¯çš„ä»£ç ï¼ŒæŠŠdecode-compute-encodeéƒ¨åˆ†ä½¿ç”¨çº¿ç¨‹æˆ–è€…çº¿ç¨‹æ± æ¥å¤„ç†ã€‚</p><p>æ¬¢è¿ä½ åœ¨è¯„è®ºåŒºå†™ä¸‹ä½ çš„æ€è€ƒï¼Œæˆ–è€…åœ¨GitHubä¸Šä¸Šä¼ ä¿®æ”¹è¿‡çš„ä»£ç ï¼Œæˆ‘ä¼šå’Œä½ ä¸€èµ·äº¤æµï¼Œä¹Ÿæ¬¢è¿æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–è€…åŒäº‹ï¼Œä¸€èµ·äº¤æµä¸€ä¸‹ã€‚</p>","neighbors":{"left":{"article_title":"27 | I/Oå¤šè·¯å¤ç”¨é‡ä¸Šçº¿ç¨‹ï¼šä½¿ç”¨pollå•çº¿ç¨‹å¤„ç†æ‰€æœ‰I/Oäº‹ä»¶","id":146664},"right":{"article_title":"29 | æ¸å…¥ä½³å¢ƒï¼šä½¿ç”¨epollå’Œå¤šçº¿ç¨‹æ¨¡å‹","id":149204}},"comments":[{"had_liked":false,"id":154950,"user_name":"é’±","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1574603944,"is_pvip":false,"replies":[{"id":"60378","content":"æ€»ç»“çš„å¾ˆåˆ°ä½ï¼Œæœ‰ç‚¹æƒŠè‰³ ğŸ˜","user_name":"ä½œè€…å›å¤","comment_id":154950,"uid":"1618647","ip_address":"","utype":1,"ctime":1575186459,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"306517281960","product_id":100032701,"comment_content":"1ï¼šé˜»å¡IO+å¤šè¿›ç¨‹â€”â€”å®ç°ç®€å•ï¼Œæ€§èƒ½ä¸€èˆ¬<br><br>2ï¼šé˜»å¡IO+å¤šçº¿ç¨‹â€”â€”ç›¸æ¯”äºé˜»å¡IO+å¤šè¿›ç¨‹ï¼Œå‡å°‘äº†ä¸Šä¸‹æ–‡åˆ‡æ¢æ‰€å¸¦æ¥çš„å¼€é”€ï¼Œæ€§èƒ½æœ‰æ‰€æé«˜ã€‚<br><br>3ï¼šé˜»å¡IO+çº¿ç¨‹æ± â€”â€”ç›¸æ¯”äºé˜»å¡IO+å¤šçº¿ç¨‹ï¼Œå‡å°‘äº†çº¿ç¨‹é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€ï¼Œæ€§èƒ½æœ‰äº†è¿›ä¸€æ­¥çš„æé«˜ã€‚<br><br>4ï¼šReactor+çº¿ç¨‹æ± â€”â€”ç›¸æ¯”äºé˜»å¡IO+çº¿ç¨‹æ± ï¼Œé‡‡ç”¨äº†æ›´åŠ å…ˆè¿›çš„äº‹ä»¶é©±åŠ¨è®¾è®¡æ€æƒ³ï¼Œèµ„æºå ç”¨å°‘ã€æ•ˆç‡é«˜ã€æ‰©å±•æ€§å¼ºï¼Œæ˜¯æ”¯æŒé«˜æ€§èƒ½é«˜å¹¶å‘åœºæ™¯çš„åˆ©å™¨ã€‚<br><br>5ï¼šä¸»ä»Reactor+çº¿ç¨‹æ± â€”â€”ç›¸æ¯”äºReactor+çº¿ç¨‹æ± ï¼Œå°†è¿æ¥å»ºç«‹äº‹ä»¶å’Œå·²å»ºç«‹è¿æ¥çš„å„ç§IOäº‹ä»¶åˆ†ç¦»ï¼Œä¸»Reactoråªè´Ÿè´£å¤„ç†è¿æ¥äº‹ä»¶ï¼Œä»Reactoråªè´Ÿè´£å¤„ç†å„ç§IOäº‹ä»¶ï¼Œè¿™æ ·èƒ½å¢åŠ å®¢æˆ·ç«¯è¿æ¥çš„æˆåŠŸç‡ï¼Œå¹¶ä¸”å¯ä»¥å……åˆ†åˆ©ç”¨ç°åœ¨å¤šCPUçš„èµ„æºç‰¹æ€§è¿›ä¸€æ­¥çš„æé«˜IOäº‹ä»¶çš„å¤„ç†æ•ˆç‡ã€‚<br><br><br>6ï¼šä¸» - ä»Reactoræ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œä¸»Reactorçº¿ç¨‹åªè´Ÿè´£åˆ†å‘ Acceptor è¿æ¥å»ºç«‹ï¼Œå·²è¿æ¥å¥—æ¥å­—ä¸Šçš„ I&#47;O äº‹ä»¶äº¤ç»™ ä»Reactor è´Ÿè´£åˆ†å‘ã€‚å…¶ä¸­ sub-reactor çš„æ•°é‡ï¼Œå¯ä»¥æ ¹æ® CPU çš„æ ¸æ•°æ¥çµæ´»è®¾ç½®ã€‚","like_count":72,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475621,"discussion_content":"æ€»ç»“çš„å¾ˆåˆ°ä½ï¼Œæœ‰ç‚¹æƒŠè‰³ ğŸ˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575186459,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":205575,"user_name":"ray","can_delete":false,"product_type":"c1","uid":1717235,"ip_address":"","ucode":"10962C711CBC11","user_header":"","comment_is_top":false,"comment_ctime":1586677335,"is_pvip":false,"replies":[{"id":"76807","content":"æ­£å¦‚ä½ æ‰€è¯´ï¼Œä¸€èˆ¬æˆ‘ä»¬è¿™é‡Œè¯´çš„workeréƒ½æ˜¯æ­£ç»å¹²è‹¦åŠ›æ´»çš„ï¼Œå¦‚encode&#47;decodeï¼Œä¸šåŠ¡é€»è¾‘ç­‰ï¼Œåœ¨ç½‘ç»œç¼–ç¨‹èŒƒå¼ä¸‹ï¼Œæˆ‘ä»¬ä¸æ¨èI&#47;Oæ“ä½œåˆæ··åœ¨workerçº¿ç¨‹é‡Œé¢ã€‚<br><br>è€Œä½ æçš„routineçš„æ–¹å¼ï¼Œåº”è¯¥æ˜¯ä¸€ç§I&#47;Oå¤„ç†çš„ç¼–ç¨‹æ–¹å¼ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨è¿™æ ·routineçš„æ—¶å€™ï¼Œå¦‚æœæœ‰I&#47;Oæ“ä½œï¼Œå¯¹åº”çš„cpuèµ„æºè¢«åˆ‡æ¢å›å»ï¼Œå®é™…ä¸Šåˆå›åˆ°äº†I&#47;Oäº‹ä»¶é©±åŠ¨çš„èŒƒå¼ã€‚è¿™é‡Œçš„routineæœ¬èº«æ˜¯è¢«è¯­è¨€è‡ªå·±æ‰€å°è£…çš„I&#47;Oäº‹ä»¶é©±åŠ¨æœºåˆ¶æ‰€åŒ…è£…çš„ï¼Œä½ å¯ä»¥è®¤ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯­è¨€(å¦‚C++&#47;Golang)å®ç°äº†å†…ç”Ÿçš„äº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼Œè®©æˆ‘ä»¬å¯ä»¥ç›´æ¥å…³æ³¨ä¹‹å‰çš„encode&#47;decodeå’Œä¸šåŠ¡é€»è¾‘çš„ç¼–ç ã€‚<br><br>ä¸ç®¡æŠ€æœ¯æ€ä¹ˆå˜åŒ–ï¼Œcpuã€çº¿ç¨‹ã€äº‹ä»¶é©±åŠ¨ï¼Œè¿™äº›æ¦‚å¿µå’Œå®ç°éƒ½æ˜¯å®å®åœ¨åœ¨å­˜åœ¨çš„ï¼Œä¸ºäº†è®©æˆ‘ä»¬å†™ä»£ç æ›´åŠ çš„ç®€å•å’Œç›´æ¥ï¼Œå°†è¿™äº›å¤æ‚çš„æ¦‚å¿µè—åœ¨åé¢ï¼Œé€šè¿‡æ–°çš„ç¼–ç¨‹èŒƒå¼æ¥è¾¾åˆ°è¿™æ ·çš„ç›®çš„ï¼Œæ˜¯ç°ä»£ç¨‹åºè¯­è¨€å‘å±•çš„å¿…ç„¶ã€‚","user_name":"ä½œè€…å›å¤","comment_id":205575,"uid":"1618647","ip_address":"","utype":1,"ctime":1586681879,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"44536350295","product_id":100032701,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œ<br>å¦‚æœåœ¨worker thread poolé‡Œé¢çš„threadåœ¨æ‰§è¡Œå·¥ä½œæ—¶ï¼Œåˆé‡åˆ°äº†I&#47;Oã€‚æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥åœ¨worker thread poolé‡Œé¢åŠ å…¥epollæ¥è½®è¯¢ï¼Ÿä½†é€šå¸¸åœ¨worker threadé‡Œé¢é‡åˆ°çš„I&#47;Oåº”è¯¥éƒ½å·²ç»ä¸æ˜¯network I&#47;Oäº†ï¼Œè€Œæ˜¯sqlã€è¯»å†™fileã€æˆ–æ˜¯å‘ç¬¬ä¸‰æ–¹å‘èµ·apiï¼Œæˆ‘ä¸æ˜¯å¾ˆç¡®å®šèƒ½å¦ç”¨epollæ¥å¤„ç†ã€‚<br><br>æœ‰åœ¨googleä¸ŠæŸ¥åˆ°ï¼Œworker threadæˆ–worker processè‹¥é‡åˆ°I&#47;Oï¼Œä¼¼ä¹ä¼šç”¨ä¸€ç§å«ä½œcoroutineçš„æ–¹å¼æ¥åˆ‡æ¢cpuçš„ä½¿ç”¨æƒã€‚æ­¤ç§åˆ‡æ¢æ–¹å¼ï¼Œä¸æ¶‰åŠkernelï¼Œå…¨æ˜¯åœ¨åº”ç”¨ç¨‹åºåšåˆ‡æ¢ã€‚<br><br>è¿™è¾¹æƒ³è¯·æ•™è€å¸ˆï¼Œå¯¹åœ¨worker threadé‡Œé¢é‡åˆ°I&#47;Oé—®é¢˜æ—¶çš„å¤„ç†æ–¹å¼æˆ–æ˜¯å¿ƒå¾—æ˜¯ä»€ä¹ˆï¼Ÿ<br><br>è°¢è°¢è€å¸ˆçš„åˆ†äº«ï¼","like_count":11,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491518,"discussion_content":"æ­£å¦‚ä½ æ‰€è¯´ï¼Œä¸€èˆ¬æˆ‘ä»¬è¿™é‡Œè¯´çš„workeréƒ½æ˜¯æ­£ç»å¹²è‹¦åŠ›æ´»çš„ï¼Œå¦‚encode/decodeï¼Œä¸šåŠ¡é€»è¾‘ç­‰ï¼Œåœ¨ç½‘ç»œç¼–ç¨‹èŒƒå¼ä¸‹ï¼Œæˆ‘ä»¬ä¸æ¨èI/Oæ“ä½œåˆæ··åœ¨workerçº¿ç¨‹é‡Œé¢ã€‚\n\nè€Œä½ æçš„routineçš„æ–¹å¼ï¼Œåº”è¯¥æ˜¯ä¸€ç§I/Oå¤„ç†çš„ç¼–ç¨‹æ–¹å¼ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨è¿™æ ·routineçš„æ—¶å€™ï¼Œå¦‚æœæœ‰I/Oæ“ä½œï¼Œå¯¹åº”çš„cpuèµ„æºè¢«åˆ‡æ¢å›å»ï¼Œå®é™…ä¸Šåˆå›åˆ°äº†I/Oäº‹ä»¶é©±åŠ¨çš„èŒƒå¼ã€‚è¿™é‡Œçš„routineæœ¬èº«æ˜¯è¢«è¯­è¨€è‡ªå·±æ‰€å°è£…çš„I/Oäº‹ä»¶é©±åŠ¨æœºåˆ¶æ‰€åŒ…è£…çš„ï¼Œä½ å¯ä»¥è®¤ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¯­è¨€(å¦‚C++/Golang)å®ç°äº†å†…ç”Ÿçš„äº‹ä»¶é©±åŠ¨æœºåˆ¶ï¼Œè®©æˆ‘ä»¬å¯ä»¥ç›´æ¥å…³æ³¨ä¹‹å‰çš„encode/decodeå’Œä¸šåŠ¡é€»è¾‘çš„ç¼–ç ã€‚\n\nä¸ç®¡æŠ€æœ¯æ€ä¹ˆå˜åŒ–ï¼Œcpuã€çº¿ç¨‹ã€äº‹ä»¶é©±åŠ¨ï¼Œè¿™äº›æ¦‚å¿µå’Œå®ç°éƒ½æ˜¯å®å®åœ¨åœ¨å­˜åœ¨çš„ï¼Œä¸ºäº†è®©æˆ‘ä»¬å†™ä»£ç æ›´åŠ çš„ç®€å•å’Œç›´æ¥ï¼Œå°†è¿™äº›å¤æ‚çš„æ¦‚å¿µè—åœ¨åé¢ï¼Œé€šè¿‡æ–°çš„ç¼–ç¨‹èŒƒå¼æ¥è¾¾åˆ°è¿™æ ·çš„ç›®çš„ï¼Œæ˜¯ç°ä»£ç¨‹åºè¯­è¨€å‘å±•çš„å¿…ç„¶ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586681879,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":150536,"user_name":"é©¬ä¸åœè¹„","can_delete":false,"product_type":"c1","uid":1620168,"ip_address":"","ucode":"9AB66524672291","user_header":"https://static001.geekbang.org/account/avatar/00/18/b8/c8/950fb2c9.jpg","comment_is_top":false,"comment_ctime":1573551304,"is_pvip":false,"replies":[{"id":"58551","content":"Javaçš„å°è£…æ˜¯éå¸¸æ¼‚äº®ï¼Œå€˜è‹¥èƒ½ç†è§£åŸç†ï¼Œå°±ä¼šæ›´åŠ å®¹æ˜“ç†è§£å®ƒçš„å°è£…äº†ã€‚","user_name":"ä½œè€…å›å¤","comment_id":150536,"uid":"1618647","ip_address":"","utype":1,"ctime":1573991244,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"23048387784","product_id":100032701,"comment_content":"å­¦ä¹  netty çš„æ—¶å€™äº†è§£åˆ° reactor æ¨¡å¼ï¼Œnetty çš„ ï¼ˆå• ã€ä¸»ä»ï¼‰reactor å¯ä»¥çµæ´»é…ç½®ï¼Œè€å¸ˆè®²çš„æ¨¡å¼çœŸçš„æ˜¯å’Œ netty è®¾è®¡ä¸€æ · ï¼Œè¿™æ¬¡å­¦ä¹ ç®—æ˜¯çœŸæ­£ææ˜ç™½äº†å“ˆå“ˆ","like_count":5,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474194,"discussion_content":"Javaçš„å°è£…æ˜¯éå¸¸æ¼‚äº®ï¼Œå€˜è‹¥èƒ½ç†è§£åŸç†ï¼Œå°±ä¼šæ›´åŠ å®¹æ˜“ç†è§£å®ƒçš„å°è£…äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573991244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142276,"user_name":"åˆ˜ç³»","can_delete":false,"product_type":"c1","uid":1009725,"ip_address":"","ucode":"A772E5BCAE640E","user_header":"","comment_is_top":false,"comment_ctime":1571323970,"is_pvip":false,"replies":[{"id":"55122","content":"æˆ‘æ€ä¹ˆè§‰çš„ä½ çš„ç»“æœæ˜¯å¯¹çš„å‘¢ï¼Ÿæœ‰å¯èƒ½æˆ‘æ–‡ç« ä¸­è´´çš„ä¿¡æ¯ä¸å¤Ÿå…¨ï¼Œé€ æˆäº†ä¸€å®šçš„è¯¯å¯¼ã€‚","user_name":"ä½œè€…å›å¤","comment_id":142276,"uid":"1618647","ip_address":"","utype":1,"ctime":1571457394,"user_name_real":"froghui"}],"discussion_count":2,"race_medal":0,"score":"23046160450","product_id":100032701,"comment_content":"è€å¸ˆï¼Œæˆ‘è¯•éªŒäº†ç¨‹åºï¼Œå‘ç°æœ‰ä¸€ä¸ªé—®é¢˜ã€‚<br>æœåŠ¡å™¨ç¨‹åºå¯åŠ¨åè¾“å‡ºç»“æœä¸æ–‡ç« ä¸­çš„ä¸ä¸€æ ·ã€‚<br> .&#47;poll-server-multithreads <br>[msg] set poll as dispatcher, main thread<br>[msg] add channel fd == 4, main thread<br>[msg] poll added channel fd==4, main thread<br>[msg] set poll as dispatcher, Thread-1<br>[msg] add channel fd == 8, Thread-1<br>[msg] poll added channel fd==8, Thread-1<br>[msg] event loop thread init and signal, Thread-1<br>[msg] event loop run, Thread-1<br>[msg] event loop thread started, Thread-1<br>[msg] set poll as dispatcher, Thread-2<br>[msg] add channel fd == 10, Thread-2<br>[msg] poll added channel fd==10, Thread-2<br>[msg] event loop thread init and signal, Thread-2<br>[msg] event loop run, Thread-2<br>[msg] event loop thread started, Thread-2<br>[msg] set poll as dispatcher, Thread-3<br>[msg] add channel fd == 19, Thread-3<br>[msg] poll added channel fd==19, Thread-3<br>[msg] event loop thread init and signal, Thread-3<br>[msg] event loop run, Thread-3<br>[msg] event loop thread started, Thread-3<br>[msg] set poll as dispatcher, Thread-4<br>[msg] add channel fd == 21, Thread-4<br>[msg] poll added channel fd==21, Thread-4<br>[msg] event loop thread init and signal, Thread-4<br>[msg] event loop run, Thread-4<br>[msg] event loop thread started, Thread-4<br>[msg] add channel fd == 6, main thread<br>[msg] poll added channel fd==6, main thread<br>[msg] event loop run, main thread<br>å„ä¸ªå­çº¿ç¨‹å¯åŠ¨ååˆ›å»ºçš„å¥—æ¥å­—å¯¹æ˜¯æ·»åŠ åœ¨å­çº¿ç¨‹çš„eventloopä¸Šçš„ï¼Œè€Œä¸æ˜¯åƒæ–‡ç« ä¸­çš„å…¨æ˜¯æ·»åŠ åœ¨ä¸»çº¿ç¨‹ä¸­ã€‚<br>ä»æˆ‘é˜…è¯»ä»£ç æ¥çœ‹ï¼Œç¡®å®ä¹Ÿæ˜¯æ·»åŠ åœ¨å­çº¿ç¨‹ä¸­ã€‚ä¸çŸ¥é“å“ªé‡Œä¸å¯¹ï¼Ÿ<br>ä¸»çº¿ç¨‹ç»™å­çº¿ç¨‹ä¸‹å‘è¿æ¥å¥—æ¥å­—æ˜¯é€šè¿‡ä¸»çº¿ç¨‹è°ƒç”¨event_loop_add_channel_eventå®Œæˆçš„ï¼Œå½“ä¸»çº¿ç¨‹ä¸­å‘ç°eventloopå’Œè‡ªå·±ä¸æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼Œå°±é€šè¿‡ç»™è¿™ä¸ªevenloopçš„å¥—æ¥å­—å¯¹å‘é€ä¸€ä¸ªâ€œaâ€äº§ç”Ÿäº‹ä»¶å”¤é†’ï¼Œç„¶åå­çº¿ç¨‹å¤„ç†pending_channelï¼Œå®ç°åœ¨å­çº¿ç¨‹ä¸­æ·»åŠ è¿æ¥å¥—æ¥å­—ã€‚<br>","like_count":5,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471056,"discussion_content":"æˆ‘æ€ä¹ˆè§‰çš„ä½ çš„ç»“æœæ˜¯å¯¹çš„å‘¢ï¼Ÿæœ‰å¯èƒ½æˆ‘æ–‡ç« ä¸­è´´çš„ä¿¡æ¯ä¸å¤Ÿå…¨ï¼Œé€ æˆäº†ä¸€å®šçš„è¯¯å¯¼ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571457394,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2450040,"avatar":"","nickname":"ç‹è“¬å‹ƒ","note":"","ucode":"DDF4CCE9728DCF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540252,"discussion_content":"æ€»ç®—çœ‹æ˜ç™½äº† è¿™é‡Œå¥½å¤æ‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640001334,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":239176,"user_name":"Simple life","can_delete":false,"product_type":"c1","uid":1571460,"ip_address":"","ucode":"1902D7F72FB43F","user_header":"https://static001.geekbang.org/account/avatar/00/17/fa/84/f01d203a.jpg","comment_is_top":false,"comment_ctime":1596452920,"is_pvip":false,"replies":[{"id":"89387","content":"éå¸¸åŒæ„ï¼Œè¿™é‡Œä¸æ˜¯ä½¿ç”¨æœ‰è¯¯ï¼Œåªæ˜¯ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œåœ¨çº¿ç¨‹é‡Œç»Ÿä¸€å¤„ç†äº†è§£ç ã€å¤„ç†å’Œç¼–ç ã€‚ä½ çš„è¯´æ³•æ˜¯å¯¹çš„ã€‚","user_name":"ä½œè€…å›å¤","comment_id":239176,"uid":"1618647","ip_address":"","utype":1,"ctime":1597636264,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"14481354808","product_id":100032701,"comment_content":"æˆ‘è§‰å¾—è€å¸ˆè¿™é‡ŒonMessageå›è°ƒä¸­ä½¿ç”¨çº¿ç¨‹æ± æ–¹å¼æœ‰è¯¯ï¼Œè¿™é‡Œè§£ç ï¼Œå¤„ç†ï¼Œç¼–ç æ˜¯ä¸²è¡Œæ“ä½œçš„ï¼Œå¤šçº¿ç¨‹å¹¶ä¸èƒ½å¸¦æ¥æ€§èƒ½çš„æå‡ï¼Œä¸»çº¿ç¨‹è¿˜æ˜¯ä¼šé˜»å¡ä¸é‡Šæ”¾çš„ï¼Œæˆ‘è§‰å¾—æœ€ä½³çš„åšæ³•æ˜¯ï¼Œè§£ç äº¤ç»™çº¿ç¨‹æ± å»åšï¼Œç„¶åè¿”å›ï¼Œè§£ç å®Œæˆåæ³¨å†Œè¿›sub-reactorä¸­å†äº¤ç”±ä¸‹ä¸€ä¸ªä¸šåŠ¡å¤„ç†ï¼Œä¸šåŠ¡å¤„ç†ï¼Œç¼–ç åŒä¸Šï¼Œå®ç°è§£è€¦å……åˆ†åˆ©ç”¨å¤šçº¿ç¨‹","like_count":4,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503012,"discussion_content":"éå¸¸åŒæ„ï¼Œè¿™é‡Œä¸æ˜¯ä½¿ç”¨æœ‰è¯¯ï¼Œåªæ˜¯ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œåœ¨çº¿ç¨‹é‡Œç»Ÿä¸€å¤„ç†äº†è§£ç ã€å¤„ç†å’Œç¼–ç ã€‚ä½ çš„è¯´æ³•æ˜¯å¯¹çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597636264,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":261582,"user_name":"è¿›å‡»çš„å·¨äºº","can_delete":false,"product_type":"c1","uid":1167120,"ip_address":"","ucode":"DB62D77D460BF1","user_header":"https://static001.geekbang.org/account/avatar/00/11/cf/10/9fa2e5ba.jpg","comment_is_top":false,"comment_ctime":1605429316,"is_pvip":false,"replies":[{"id":"95511","content":"å—¯ï¼Œnettyç¡®å®æ˜¯è¿™æ ·è®¾è®¡çš„ï¼Œå¾ˆå¤šä¸œè¥¿æœ€åéƒ½æ˜¯æ®Šé€”åŒå½’ã€‚","user_name":"ä½œè€…å›å¤","comment_id":261582,"uid":"1618647","ip_address":"","utype":1,"ctime":1606041999,"user_name_real":"froghui"}],"discussion_count":2,"race_medal":0,"score":"10195363908","product_id":100032701,"comment_content":"Nettyçš„ä¸»ä»reactoråˆ†åˆ«å¯¹åº”bossGroupå’ŒworkerGroupï¼ŒworkerGroupå¤„ç†éacceptçš„ioäº‹ä»¶ï¼Œè‡³äºä¸šåŠ¡é€»è¾‘æ˜¯å¦äº¤ç»™å¦å¤–çš„çº¿ç¨‹æ± å¤„ç†ï¼Œå¯ä»¥ç†è§£ä¸ºnettyå¹¶æ²¡æœ‰æ”¯æŒï¼ŒåŸå› æ˜¯å› ä¸ºä¸šåŠ¡é€»è¾‘éƒ½éœ€è¦å¼€å‘è€…è‡ªå·±è‡ªå®šä¹‰æä¾›ï¼Œä½†åœ¨è¿™ç‚¹ä¸Šï¼Œnettyé€šè¿‡ChannelHandler+piplineæä¾›äº†ioäº‹ä»¶å’Œä¸šåŠ¡é€»è¾‘åˆ†ç¦»çš„èƒ½åŠ›ï¼Œéœ€è¦å¼€å‘è€…æ·»åŠ è‡ªå®šä¹‰ChannelHandlerï¼Œå®ç°ioäº‹ä»¶åˆ°ä¸šåŠ¡é€»è¾‘å¤„ç†çš„çº¿ç¨‹åˆ†ç¦»ã€‚","like_count":2,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509526,"discussion_content":"å—¯ï¼Œnettyç¡®å®æ˜¯è¿™æ ·è®¾è®¡çš„ï¼Œå¾ˆå¤šä¸œè¥¿æœ€åéƒ½æ˜¯æ®Šé€”åŒå½’ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606041999,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1066707,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/d3/e25d104a.jpg","nickname":"Ãªï½—Ä›ï½","note":"","ucode":"5000233111BEFA","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335380,"discussion_content":"å¯ä»¥çœ‹ä¸‹pipline.addLastçš„api æ˜¯æ”¯æŒçº¿ç¨‹æ± å‚æ•°çš„ï¼Œå¯ä»¥è®©ä¸šåŠ¡handleråœ¨è‡ªå®šä¹‰çº¿ç¨‹æ± æ‰§è¡Œ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1608176802,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":214597,"user_name":"ç–¯ç‹‚çš„çŸ³å¤´","can_delete":false,"product_type":"c1","uid":1763900,"ip_address":"","ucode":"65CE6EB494FDCA","user_header":"https://static001.geekbang.org/account/avatar/00/1a/ea/3c/24cb4bde.jpg","comment_is_top":false,"comment_ctime":1588770682,"is_pvip":false,"replies":[{"id":"79834","content":"æœ€åä¸€ä¸ªéƒ¨åˆ†ä¼šè®²è¿™éƒ¨åˆ†çš„è®¾è®¡ï¼Œä¸è¦æ™•å“ˆã€‚","user_name":"ä½œè€…å›å¤","comment_id":214597,"uid":"1618647","ip_address":"","utype":1,"ctime":1589099672,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"10178705274","product_id":100032701,"comment_content":"çœ‹è€å¸ˆæºç ï¼Œchannelï¼Œbufferå„ç§å¯¹è±¡ï¼Œè°ƒæ¥è°ƒå»çš„ï¼Œç»™æˆ‘è°ƒæ‡µäº†ã€‚","like_count":2,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494134,"discussion_content":"æœ€åä¸€ä¸ªéƒ¨åˆ†ä¼šè®²è¿™éƒ¨åˆ†çš„è®¾è®¡ï¼Œä¸è¦æ™•å“ˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589099672,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":185136,"user_name":"ç»¿ç®­ä¾ ","can_delete":false,"product_type":"c1","uid":1528536,"ip_address":"","ucode":"B994F558A98E29","user_header":"https://static001.geekbang.org/account/avatar/00/17/52/d8/123a4981.jpg","comment_is_top":false,"comment_ctime":1583492839,"is_pvip":false,"replies":[{"id":"71666","content":"è¿™ä¸ªæ˜¯é€šè¿‡CMakeæ¥å®šä¹‰çš„ï¼Œé€šè¿‡CMakeçš„checkæ¥æ£€éªŒæ˜¯å¦enable epollï¼Œè¿™ä¸ªå®å‡ºç°åœ¨åŠ¨æ€ç”Ÿæˆçš„å¤´æ–‡ä»¶ä¸­ã€‚<br><br># check epoll and add config.h for the macro compilation<br>include(CheckSymbolExists)<br>check_symbol_exists(epoll_create &quot;sys&#47;epoll.h&quot; EPOLL_EXISTS)<br>if (EPOLL_EXISTS)<br>    # Linuxä¸‹è®¾ç½®ä¸ºepoll<br>    set(EPOLL_ENABLE 1 CACHE INTERNAL &quot;enable epoll&quot;)<br><br>    # Linuxä¸‹ä¹Ÿè®¾ç½®ä¸ºpoll<br>#    set(EPOLL_ENABLE &quot;&quot; CACHE INTERNAL &quot;not enable epoll&quot;)<br>else ()<br>    set(EPOLL_ENABLE &quot;&quot; CACHE INTERNAL &quot;not enable epoll&quot;)<br>endif ()","user_name":"ä½œè€…å›å¤","comment_id":185136,"uid":"1618647","ip_address":"","utype":1,"ctime":1583639685,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"5878460135","product_id":100032701,"comment_content":"event_loop.c --- struct event_loop *event_loop_init_with_name(char *thread_name)ï¼š<br><br>#ifdef EPOLL_ENABLE<br>    yolanda_msgx(&quot;set epoll as dispatcher, %s&quot;, eventLoop-&gt;thread_name);<br>    eventLoop-&gt;eventDispatcher = &amp;epoll_dispatcher;<br>#else<br>    yolanda_msgx(&quot;set poll as dispatcher, %s&quot;, eventLoop-&gt;thread_name);<br>    eventLoop-&gt;eventDispatcher = &amp;poll_dispatcher;<br>#endif<br>    eventLoop-&gt;event_dispatcher_data = eventLoop-&gt;eventDispatcher-&gt;init(eventLoop);<br><br>æ²¡æ‰¾åˆ° EPOLL_ENABLE çš„å®šä¹‰ï¼Œè€å¸ˆæ€ä¹ˆè€ƒè™‘çš„ï¼ï¼è¿™é‡Œçš„è¯æ˜¯å¦åªèƒ½åœ¨event_loop.h æ‰€åŒ…å«çš„å¤´æ–‡ä»¶ä¸­å»æ‰¾å®šä¹‰ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486262,"discussion_content":"è¿™ä¸ªæ˜¯é€šè¿‡CMakeæ¥å®šä¹‰çš„ï¼Œé€šè¿‡CMakeçš„checkæ¥æ£€éªŒæ˜¯å¦enable epollï¼Œè¿™ä¸ªå®å‡ºç°åœ¨åŠ¨æ€ç”Ÿæˆçš„å¤´æ–‡ä»¶ä¸­ã€‚\n\n# check epoll and add config.h for the macro compilation\ninclude(CheckSymbolExists)\ncheck_symbol_exists(epoll_create &amp;quot;sys/epoll.h&amp;quot; EPOLL_EXISTS)\nif (EPOLL_EXISTS)\n    # Linuxä¸‹è®¾ç½®ä¸ºepoll\n    set(EPOLL_ENABLE 1 CACHE INTERNAL &amp;quot;enable epoll&amp;quot;)\n\n    # Linuxä¸‹ä¹Ÿè®¾ç½®ä¸ºpoll\n#    set(EPOLL_ENABLE &amp;quot;&amp;quot; CACHE INTERNAL &amp;quot;not enable epoll&amp;quot;)\nelse ()\n    set(EPOLL_ENABLE &amp;quot;&amp;quot; CACHE INTERNAL &amp;quot;not enable epoll&amp;quot;)\nendif ()","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583639685,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":171066,"user_name":"ææœè¾‰","can_delete":false,"product_type":"c1","uid":1152951,"ip_address":"","ucode":"8E4A4469A77A88","user_header":"https://static001.geekbang.org/account/avatar/00/11/97/b7/d5a83264.jpg","comment_is_top":false,"comment_ctime":1578837256,"is_pvip":false,"replies":[{"id":"68054","content":"æ¥è¿‘çœŸç›¸äº†ï¼Œåç»­ç« èŠ‚ä¼šæ­å¼€ç­”æ¡ˆã€‚","user_name":"ä½œè€…å›å¤","comment_id":171066,"uid":"1618647","ip_address":"","utype":1,"ctime":1580628062,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"5873804552","product_id":100032701,"comment_content":"fdä¸º7çš„å¥—æ¥å­—åº”è¯¥æ˜¯socketpair()è°ƒç”¨åˆ›å»ºçš„ä¸»-ä»reactorå¥—æ¥å­—å¯¹ä¸­ï¼Œä»reactorçº¿ç¨‹å†™ï¼Œä¸»reactorçº¿ç¨‹è¯»çš„å¥—æ¥å­—ï¼Œä½œç”¨çš„è¯ï¼Œä¸ªäººæ¨æµ‹åº”è¯¥æ˜¯ä»reactorçº¿ç¨‹ä¸­çš„è¿æ¥å¥—æ¥å­—å…³é—­äº†ï¼ˆå³è¿æ¥æ–­å¼€äº†ï¼‰ï¼Œå°†è¿™æ ·çš„äº‹ä»¶åé¦ˆç»™ä¸»reactorï¼Œä»¥é€šçŸ¥ä¸»reactorçº¿ç¨‹ï¼Œæˆ‘å·²ç»å‡†å¤‡å¥½æ¥æ”¶ä¸‹ä¸€ä¸ªè¿æ¥å¥—æ¥å­—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481228,"discussion_content":"æ¥è¿‘çœŸç›¸äº†ï¼Œåç»­ç« èŠ‚ä¼šæ­å¼€ç­”æ¡ˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580628062,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":171057,"user_name":"ææœè¾‰","can_delete":false,"product_type":"c1","uid":1152951,"ip_address":"","ucode":"8E4A4469A77A88","user_header":"https://static001.geekbang.org/account/avatar/00/11/97/b7/d5a83264.jpg","comment_is_top":false,"comment_ctime":1578834702,"is_pvip":false,"replies":[{"id":"68055","content":"æˆ‘å…¶å®æ²¡æƒ³è¿™ä¹ˆå¤šï¼Œä¸€èˆ¬è€Œè¨€ï¼Œworkerçº¿ç¨‹çš„ä¸ªæ•°ä¿æŒå’Œcpuæ ¸ä¸€è‡´ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„åšæ³•ï¼Œä¾‹å¦‚nginxã€‚","user_name":"ä½œè€…å›å¤","comment_id":171057,"uid":"1618647","ip_address":"","utype":1,"ctime":1580628179,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"5873801998","product_id":100032701,"comment_content":"4æ ¸cpuï¼Œä¸»reactorè¦å æ‰ä¸€ä¸ªï¼Œåªæœ‰3ä¸ªå¯ä»¥åˆ†é…ç»™ä»æ ¸å¿ƒã€‚<br>æŒ‰ç…§è€å¸ˆçš„è¯´æ³•ï¼Œæ˜¯å› ä¸ºä¸»reactorçš„å·¥ä½œç›¸å¯¹æ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥å ç”¨å†…æ ¸çš„æ—¶é—´å¾ˆå°‘ï¼Œæ‰€ä»¥å°†ä»reactoråˆ†é…æ»¡ï¼Œç„¶åæœ€å¤§åŒ–å¯¹è¿æ¥å¥—æ¥å­—çš„å¤„ç†èƒ½åŠ›å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481224,"discussion_content":"æˆ‘å…¶å®æ²¡æƒ³è¿™ä¹ˆå¤šï¼Œä¸€èˆ¬è€Œè¨€ï¼Œworkerçº¿ç¨‹çš„ä¸ªæ•°ä¿æŒå’Œcpuæ ¸ä¸€è‡´ï¼Œæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„åšæ³•ï¼Œä¾‹å¦‚nginxã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580628179,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":140079,"user_name":"å·äº‘","can_delete":false,"product_type":"c1","uid":1265438,"ip_address":"","ucode":"3D56399A7C5BDF","user_header":"https://static001.geekbang.org/account/avatar/00/13/4f/1e/e2b7a9ba.jpg","comment_is_top":false,"comment_ctime":1570802919,"is_pvip":false,"replies":[{"id":"55072","content":"è°ƒç”¨pollçš„ä»£ç å·²ç»å°è£…åœ¨æ¡†æ¶ä¸­ï¼Œå…·ä½“å¯ä»¥çœ‹<br>https:&#47;&#47;github.com&#47;froghui&#47;yolanda<br><br>lib&#47;event_dispatcher.h<br>lib&#47;poll_dispatcher.h<br>lib&#47;poll_dispatcher.c","user_name":"ä½œè€…å›å¤","comment_id":140079,"uid":"1618647","ip_address":"","utype":1,"ctime":1571451206,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"5865770215","product_id":100032701,"comment_content":"å¯ä¸å¯ä»¥æŠŠè°ƒç”¨pollä»£ç çš„ä½ç½®å±•ç¤ºä¸€ä¸‹","like_count":1,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470236,"discussion_content":"è°ƒç”¨pollçš„ä»£ç å·²ç»å°è£…åœ¨æ¡†æ¶ä¸­ï¼Œå…·ä½“å¯ä»¥çœ‹\nhttps://github.com/froghui/yolanda\n\nlib/event_dispatcher.h\nlib/poll_dispatcher.h\nlib/poll_dispatcher.c","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571451206,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":327238,"user_name":"ç‹è“¬å‹ƒ","can_delete":false,"product_type":"c1","uid":2450040,"ip_address":"","ucode":"DDF4CCE9728DCF","user_header":"","comment_is_top":false,"comment_ctime":1640000321,"is_pvip":false,"replies":[{"id":"119417","content":"è¿™æ®µåˆ¤æ–­ï¼Œåˆ¤æ–­çš„ä¾æ®æ˜¯å½“å‰çš„çº¿ç¨‹idæ˜¯event_loopé‡Œçš„è®°å½•ï¼Œæ˜¯ä¸æ˜¯ä¸€è‡´çš„ã€‚<br>if (!isInSameThread(eventLoop)) {<br>        event_loop_wakeup(eventLoop);<br>    } else {<br>        event_loop_handle_pending_channel(eventLoop);<br>    }","user_name":"ä½œè€…å›å¤","comment_id":327238,"uid":"1618647","ip_address":"","utype":1,"ctime":1640403369,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1640000321","product_id":100032701,"comment_content":"è€å¸ˆ è¯·é—®é‚£ä¸ªevent_loop_do_channel_eventå‡½æ•°ä»€ä¹ˆæ—¶å€™æ‰è¿›å…¥ä¸æ˜¯åŒä¸€ä¸ªçº¿ç¨‹çš„åˆ¤æ–­ä¸­å»ï¼Ÿçœ‹ä¸æ˜ç™½äº†","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541488,"discussion_content":"è¿™æ®µåˆ¤æ–­ï¼Œåˆ¤æ–­çš„ä¾æ®æ˜¯å½“å‰çš„çº¿ç¨‹idæ˜¯event_loopé‡Œçš„è®°å½•ï¼Œæ˜¯ä¸æ˜¯ä¸€è‡´çš„ã€‚\nif (!isInSameThread(eventLoop)) {\n        event_loop_wakeup(eventLoop);\n    } else {\n        event_loop_handle_pending_channel(eventLoop);\n    }","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640403369,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":320655,"user_name":"è¿™ä¸€è¡Œï¼Œ30å¹´","can_delete":false,"product_type":"c1","uid":2238081,"ip_address":"","ucode":"DC9408D1DEC015","user_header":"https://static001.geekbang.org/account/avatar/00/22/26/81/036e6579.jpg","comment_is_top":false,"comment_ctime":1636440885,"is_pvip":true,"replies":[{"id":"116705","content":"ä½ æ˜¯ç”¨ä»€ä¹ˆæ–¹æ³•ç¼–è¯‘çš„ï¼Ÿæˆ‘çš„å·¥ç¨‹ç»Ÿä¸€ç”¨CMakeç¼–è¯‘ï¼Œåº”è¯¥æ²¡é—®é¢˜ã€‚<br><br>å¦å¤–ï¼Œè¿™é‡Œçš„åº“éƒ½åœ¨æºä»£ç çš„libç›®å½•ä¸‹ã€‚","user_name":"ä½œè€…å›å¤","comment_id":320655,"uid":"1618647","ip_address":"","utype":1,"ctime":1636873835,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"1636440885","product_id":100032701,"comment_content":"<br>   <br>#include &lt;lib&#47;acceptor.h&gt;<br>#include &quot;lib&#47;common.h&quot;<br>#include &quot;lib&#47;event_loop.h&quot;<br>#include &quot;lib&#47;tcp_server.h&quot;<br><br>æŠŠè€å¸ˆçš„ä»£ç copyè¿‡å»ï¼Œè¿™äº›ç±»åº“éƒ½æŠ¥é”™ï¼Œä¸ç”¨è€å¸ˆå¼•ç”¨çš„å®ç”¨ä»€ä¹ˆå®ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530077,"discussion_content":"ä½ æ˜¯ç”¨ä»€ä¹ˆæ–¹æ³•ç¼–è¯‘çš„ï¼Ÿæˆ‘çš„å·¥ç¨‹ç»Ÿä¸€ç”¨CMakeç¼–è¯‘ï¼Œåº”è¯¥æ²¡é—®é¢˜ã€‚\n\nå¦å¤–ï¼Œè¿™é‡Œçš„åº“éƒ½åœ¨æºä»£ç çš„libç›®å½•ä¸‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636873835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312599,"user_name":"ä¼é¹…","can_delete":false,"product_type":"c1","uid":1498369,"ip_address":"","ucode":"AE29B98E5B4497","user_header":"https://static001.geekbang.org/account/avatar/00/16/dd/01/803f3750.jpg","comment_is_top":false,"comment_ctime":1631885425,"is_pvip":false,"replies":[{"id":"114036","content":"master reactor ååº”å †çº¿ç¨‹ï¼Œå°±æ˜¯ä¸»acceptorï¼Œè¿™ä¸¤ä¸ªæ„æ€æ¥è¿‘ï¼Œä¸€ä¸ªæ˜¯ä»è®¾è®¡æ¨¡å¼è§’åº¦ï¼Œå¦ä¸€ä¸ªæ˜¯ä»ç¨‹åºè®¾è®¡åŠŸèƒ½è§’åº¦ã€‚","user_name":"ä½œè€…å›å¤","comment_id":312599,"uid":"1618647","ip_address":"","utype":1,"ctime":1633576022,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"1631885425","product_id":100032701,"comment_content":"è€å¸ˆï¼Œä¸»reactoråªåˆ†å‘acceptorä¸Šå»ºç«‹è¿æ¥çš„äº‹ä»¶ï¼Œä¸åº”è¯¥æ˜¯client-&gt;acceptor -&gt; master reactorä¹ˆï¼Œå›¾ä¸Šæ˜¯client-&gt;master reactor-&gt;acceptorè¿™é‡Œçœ‹æ™•äº†","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527040,"discussion_content":"master reactor ååº”å †çº¿ç¨‹ï¼Œå°±æ˜¯ä¸»acceptorï¼Œè¿™ä¸¤ä¸ªæ„æ€æ¥è¿‘ï¼Œä¸€ä¸ªæ˜¯ä»è®¾è®¡æ¨¡å¼è§’åº¦ï¼Œå¦ä¸€ä¸ªæ˜¯ä»ç¨‹åºè®¾è®¡åŠŸèƒ½è§’åº¦ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633576022,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":275425,"user_name":"Morton","can_delete":false,"product_type":"c1","uid":1544422,"ip_address":"","ucode":"9D0E7715B0C0AB","user_header":"https://static001.geekbang.org/account/avatar/00/17/90/e6/5eb07352.jpg","comment_is_top":false,"comment_ctime":1611536915,"is_pvip":false,"replies":[{"id":"100426","content":"ä½ è¯´çš„æ˜¯ä¸€ä¸ªåˆ†æ³•ï¼Œä¸»è¦è¿˜æ˜¯çœ‹ä½ workerçº¿ç¨‹å¹²æ´»çš„å¤šå°‘ï¼Œæœ€å¥½è¿˜æ˜¯ç»è¿‡å®é™…å‹æµ‹çš„ç»“æœæ¥å†³å®šcpuåˆ†é…æ¯”ã€‚","user_name":"ä½œè€…å›å¤","comment_id":275425,"uid":"1618647","ip_address":"","utype":1,"ctime":1612101651,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"1611536915","product_id":100032701,"comment_content":"è€å¸ˆï¼ŒReactorçº¿ç¨‹æ± å ç”¨äº†ä¸€éƒ¨åˆ†cpuæ ¸ï¼Œç„¶åworkerçº¿ç¨‹å¦‚æœç”¨çº¿ç¨‹æ± åˆä¼šå ç”¨ä¸€éƒ¨åˆ†cpuæ ¸ï¼Œå‡è®¾8æ ¸æœºå™¨åº”è¯¥æ€ä¹ˆåˆ†é…çº¿ç¨‹æ± ï¼Ÿreactorå 4ä¸ªworkerçº¿ç¨‹å 4ä¸ªï¼Ÿ<br>","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514337,"discussion_content":"ä½ è¯´çš„æ˜¯ä¸€ä¸ªåˆ†æ³•ï¼Œä¸»è¦è¿˜æ˜¯çœ‹ä½ workerçº¿ç¨‹å¹²æ´»çš„å¤šå°‘ï¼Œæœ€å¥½è¿˜æ˜¯ç»è¿‡å®é™…å‹æµ‹çš„ç»“æœæ¥å†³å®šcpuåˆ†é…æ¯”ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612101651,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":254236,"user_name":"æœ¨å­çš¿","can_delete":false,"product_type":"c1","uid":1242778,"ip_address":"","ucode":"3FDEAFABB4C427","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJUzv6S9wroyXaoFIwvC1mdDiav4BVS4BbPTuwtvWibthL5PyMuxFNicY06QJMZicVpib7E88S19nH4I9Q/132","comment_is_top":false,"comment_ctime":1603088906,"is_pvip":false,"replies":[{"id":"95501","content":"å…ˆçœ‹æ‡‚ï¼Œå†è¯•ç€æ”¹","user_name":"ä½œè€…å›å¤","comment_id":254236,"uid":"1618647","ip_address":"","utype":1,"ctime":1606040775,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"1603088906","product_id":100032701,"comment_content":"ç»ˆäºæŠŠæ•´ä¸ªä»£ç æµç¨‹èµ°é€šäº†ï¼Œå¤ªä¸å®¹æ˜“äº†ï¼Œä¸è¿‡è¿˜åªæ˜¯çœ‹å¾—æ‡‚ï¼Œå†™å‡ºæ¥è¿˜æ˜¯å¾ˆéš¾ï¼","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":507326,"discussion_content":"å…ˆçœ‹æ‡‚ï¼Œå†è¯•ç€æ”¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606040775,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":254147,"user_name":"æœ¨å­çš¿","can_delete":false,"product_type":"c1","uid":1242778,"ip_address":"","ucode":"3FDEAFABB4C427","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJUzv6S9wroyXaoFIwvC1mdDiav4BVS4BbPTuwtvWibthL5PyMuxFNicY06QJMZicVpib7E88S19nH4I9Q/132","comment_is_top":false,"comment_ctime":1603071923,"is_pvip":false,"replies":[{"id":"95500","content":"åšæŒå°±æ˜¯èƒœåˆ© âœŒï¸","user_name":"ä½œè€…å›å¤","comment_id":254147,"uid":"1618647","ip_address":"","utype":1,"ctime":1606040751,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"1603071923","product_id":100032701,"comment_content":"åšæŒåšæŒï¼Œæ— æ•°æ¬¡æƒ³æ”¾å¼ƒï¼å¿«è¦ç»“æŸäº†ï¼","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":507295,"discussion_content":"åšæŒå°±æ˜¯èƒœåˆ© âœŒï¸","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606040751,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":234446,"user_name":"æˆ‘çš„åå­—ä¸å«1988","can_delete":false,"product_type":"c1","uid":1054568,"ip_address":"","ucode":"6833A6EC2FF501","user_header":"https://static001.geekbang.org/account/avatar/00/10/17/68/1592a02d.jpg","comment_is_top":false,"comment_ctime":1594693689,"is_pvip":false,"replies":[{"id":"86812","content":"å—¯ï¼Œæˆ‘çœ‹åˆ°äº†ï¼Œæ”¹èµ·æ¥~","user_name":"ä½œè€…å›å¤","comment_id":234446,"uid":"1618647","ip_address":"","utype":1,"ctime":1594907726,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"1594693689","product_id":100032701,"comment_content":"è€å¸ˆï¼Œgithubä¸Šé¢çš„æºç ï¼Œlib&#47;poll_dispacher.cæ–‡ä»¶é‡Œé¢çš„poll_addã€poll_delã€poll_updateç­‰å‡½æ•°é‡Œé¢çš„â€œif (i &gt; INIT_POLL_SIZE)â€ åˆ¤æ–­æœ‰é—®é¢˜ï¼Œå› ä¸º for å¾ªç¯ç»“æŸä¹‹åï¼Œi çš„å¯èƒ½çš„æœ€å¤§å€¼ä¸ºINIT_POLL_SIZEï¼Œæ‰€ä»¥æ°¸è¿œä¸å¯èƒ½å¤§äºINIT_POLL_SIZE","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501393,"discussion_content":"å—¯ï¼Œæˆ‘çœ‹åˆ°äº†ï¼Œæ”¹èµ·æ¥~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594907726,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":222511,"user_name":"jhren","can_delete":false,"product_type":"c1","uid":1596987,"ip_address":"","ucode":"60F7CCEA1E2C88","user_header":"https://static001.geekbang.org/account/avatar/00/18/5e/3b/845fb641.jpg","comment_is_top":false,"comment_ctime":1590824723,"is_pvip":false,"replies":[{"id":"82179","content":"åˆç†å•Šï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥äº‹ä»¶é©±åŠ¨ã€‚","user_name":"ä½œè€…å›å¤","comment_id":222511,"uid":"1618647","ip_address":"","utype":1,"ctime":1590931447,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"1590824723","product_id":100032701,"comment_content":"è¯·é—®è€å¸ˆï¼Œæˆ‘çœ‹è§æœ‰äººåœ¨å‘é€ç«¯ä½¿ç”¨httpcomponents I&#47;O reactorï¼Œè¯·é—®åˆç†å—ï¼Ÿ<br><br>https:&#47;&#47;hc.apache.org&#47;httpcomponents-core-ga&#47;tutorial&#47;html&#47;nio.html#d5e477","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496823,"discussion_content":"åˆç†å•Šï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥äº‹ä»¶é©±åŠ¨ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590931447,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":181758,"user_name":"supermouse","can_delete":false,"product_type":"c1","uid":1321860,"ip_address":"","ucode":"88072D5F881827","user_header":"https://static001.geekbang.org/account/avatar/00/14/2b/84/07f0c0d6.jpg","comment_is_top":false,"comment_ctime":1582628988,"is_pvip":false,"replies":[{"id":"71034","content":"channelæ˜¯ä¸€ä¸ªæŠ½è±¡ï¼Œè¡¨ç¤ºä¸€ä¸ªè¿æ¥é€šé“ï¼Œæœ‰å¯èƒ½æ˜¯tcpè¿æ¥ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å†…éƒ¨çš„ä¸€ä¸ªå®ç°(å¦‚sockertpair)ï¼Œä½ å¯ä»¥æŠŠå®ƒå’Œconnectionåšä¸€ä¸ªæœ‰æ•ˆå…³è”ã€‚","user_name":"ä½œè€…å›å¤","comment_id":181758,"uid":"1618647","ip_address":"","utype":1,"ctime":1583052653,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"1582628988","product_id":100032701,"comment_content":"è€å¸ˆï¼Œè¯·é—®èƒ½ä¸èƒ½è¯´ä¸€ä¸‹ä¸Šä¸€è®²å’Œè¿™ä¸€è®²çš„ä»£ç ä¸­çš„channelæ˜¯å¹²ä»€ä¹ˆç”¨çš„ï¼Ÿä¸€ç›´æ²¡çœ‹æ˜ç™½","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485110,"discussion_content":"channelæ˜¯ä¸€ä¸ªæŠ½è±¡ï¼Œè¡¨ç¤ºä¸€ä¸ªè¿æ¥é€šé“ï¼Œæœ‰å¯èƒ½æ˜¯tcpè¿æ¥ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯å†…éƒ¨çš„ä¸€ä¸ªå®ç°(å¦‚sockertpair)ï¼Œä½ å¯ä»¥æŠŠå®ƒå’Œconnectionåšä¸€ä¸ªæœ‰æ•ˆå…³è”ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583052653,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":156047,"user_name":"æ—æ—","can_delete":false,"product_type":"c1","uid":1613227,"ip_address":"","ucode":"7B6318B971E430","user_header":"https://static001.geekbang.org/account/avatar/00/18/9d/ab/6589d91a.jpg","comment_is_top":false,"comment_ctime":1574815509,"is_pvip":false,"replies":[{"id":"60368","content":"æˆ‘æ²¡æœ‰è¯•è¿‡ï¼Œä¸æ˜¯å¾ˆç¡®å®šã€‚æŒ‰é“ç†æ¥è¯´æ˜¯å¯ä»¥çš„ã€‚<br><br>æŠŠæè¿°å­—ä¼ ç»™å¦ä¸€ä¸ªè¿›ç¨‹ï¼Œå½“closeçš„æ—¶å€™ï¼Œåº”è¯¥å’Œforkä¸€ä¸ªå­è¿›ç¨‹å¤„ç†çš„æ–¹å¼ä¸€æ ·ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1575185226,"ip_address":"","comment_id":156047,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1574815509","product_id":100032701,"comment_content":"è¯·é—®è€å¸ˆï¼Œè¿™é‡Œçš„ä¸»ä»reactorï¼Œæ˜¯å¦å¯ä»¥æ˜¯ä¸¤ä¸ªä¸åŒçš„è¿›ç¨‹(éå­è¿›ç¨‹) å¹¶é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—æŠŠæ–°è¿æ¥socketçš„æè¿°ç¬¦å‘ç»™ä»reactorè¿›ç¨‹ï¼Ÿ ç”¨è¿™ç§æ–¹æ³•ï¼Œclose socketçš„æ—¶å€™æ˜¯å¦éœ€è¦ä¸»ä»reactorè¿›ç¨‹éƒ½closeä¸€æ¬¡ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475969,"discussion_content":"æˆ‘æ²¡æœ‰è¯•è¿‡ï¼Œä¸æ˜¯å¾ˆç¡®å®šã€‚æŒ‰é“ç†æ¥è¯´æ˜¯å¯ä»¥çš„ã€‚\n\næŠŠæè¿°å­—ä¼ ç»™å¦ä¸€ä¸ªè¿›ç¨‹ï¼Œå½“closeçš„æ—¶å€™ï¼Œåº”è¯¥å’Œforkä¸€ä¸ªå­è¿›ç¨‹å¤„ç†çš„æ–¹å¼ä¸€æ ·ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575185226,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":146368,"user_name":"yusuf","can_delete":false,"product_type":"c1","uid":1170784,"ip_address":"","ucode":"9F32149B2ADDA0","user_header":"https://static001.geekbang.org/account/avatar/00/11/dd/60/eae432c6.jpg","comment_is_top":false,"comment_ctime":1572508659,"is_pvip":false,"replies":[{"id":"56590","content":"æ¯ä¸ªååº”å †éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„çº¿ç¨‹ï¼Œä¹Ÿåº”è¯¥æŠŠè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘æ”¾åˆ°ç»Ÿä¸€çš„çº¿ç¨‹æ± é‡Œé¢ï¼Œè‡³äºè¿™ä¸ªçº¿ç¨‹æ± æ˜¯ä¸æ˜¯åœ¨å¤šä¸ªååº”å †çº¿ç¨‹é—´å…±äº«ï¼Œå®Œå…¨ç”±åº”ç”¨ç¨‹åºè‡ªå·±è®¾è®¡å’ŒæŒæ§ï¼Œæˆ‘ä¸ªäººè§‰å¾—ä¸€ä¸ªçº¿ç¨‹æ± æ˜¯OKçš„ï¼Œè¿™ä¸ªå›¾é‡Œæ˜¯ä¸€ä¸ªç¤ºä¾‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1572572209,"ip_address":"","comment_id":146368,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1572508659","product_id":100032701,"comment_content":"è€å¸ˆï¼Œè¯·é—®æ˜¯æ¯ä¸ªä»ååº”å †éƒ½æœ‰è‡ªå·±çš„workerçº¿ç¨‹æ± ä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472821,"discussion_content":"æ¯ä¸ªååº”å †éƒ½æœ‰ä¸€ä¸ªè‡ªå·±çš„çº¿ç¨‹ï¼Œä¹Ÿåº”è¯¥æŠŠè‡ªå·±çš„ä¸šåŠ¡é€»è¾‘æ”¾åˆ°ç»Ÿä¸€çš„çº¿ç¨‹æ± é‡Œé¢ï¼Œè‡³äºè¿™ä¸ªçº¿ç¨‹æ± æ˜¯ä¸æ˜¯åœ¨å¤šä¸ªååº”å †çº¿ç¨‹é—´å…±äº«ï¼Œå®Œå…¨ç”±åº”ç”¨ç¨‹åºè‡ªå·±è®¾è®¡å’ŒæŒæ§ï¼Œæˆ‘ä¸ªäººè§‰å¾—ä¸€ä¸ªçº¿ç¨‹æ± æ˜¯OKçš„ï¼Œè¿™ä¸ªå›¾é‡Œæ˜¯ä¸€ä¸ªç¤ºä¾‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572572209,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142230,"user_name":"ä¼ è¯´ä¸­çš„æˆå¤§å¤§","can_delete":false,"product_type":"c1","uid":1236766,"ip_address":"","ucode":"103543D6E706BF","user_header":"https://static001.geekbang.org/account/avatar/00/12/df/1e/cea897e8.jpg","comment_is_top":false,"comment_ctime":1571316304,"is_pvip":false,"replies":[{"id":"55121","content":"ä½œç”¨é©¬ä¸Šåœ¨ç¬¬å››ç¯‡å±•å¼€è®²ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1571457196,"ip_address":"","comment_id":142230,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1571316304","product_id":100032701,"comment_content":"ç¬¬ä¸€é—®æˆ‘ç ”ç©¶äº†ä»£ç  lib&#47;event_loop.c 231å’Œ232è¡Œ åˆ›å»ºäº†ä¸€ä¸ªchannelå¹¶ä¸”event_loop_add_channel_eventäº‹ä»¶<br>ç„¶ååˆåœ¨lib&#47;tcp_server.c  169å’Œ171ç»™listenfdåˆ›å»ºäº†ä¸€ä¸ªchannelå¹¶ä¸”æ‰§è¡Œäº†event_loop_add_channel_event<br>æ‰€ä»¥æ˜¯ä¸¤æ¬¡,ä¸Šé¢é‚£ä¸ªæ˜¯å¯¹socketpairåˆ›å»ºæè¿°ç¬¦è¿›è¡Œäº†æ·»åŠ ä½œç”¨è¿˜ä¸å¤ªæ˜ç™½","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471037,"discussion_content":"ä½œç”¨é©¬ä¸Šåœ¨ç¬¬å››ç¯‡å±•å¼€è®²ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571457196,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":140577,"user_name":"Hale","can_delete":false,"product_type":"c1","uid":1129731,"ip_address":"","ucode":"1925955343FE94","user_header":"https://static001.geekbang.org/account/avatar/00/11/3d/03/b2d9a084.jpg","comment_is_top":false,"comment_ctime":1571010889,"is_pvip":true,"replies":[{"id":"55076","content":"é€šè¿‡round-robinçš„ç®—æ³•ã€‚ä»£ç åœ¨<br>lib&#47;thread_pool.c  thread_pool_get_loop","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1571451895,"ip_address":"","comment_id":140577,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1571010889","product_id":100032701,"comment_content":"ä¸» reactor é€šè¿‡ä»€ä¹ˆæ ·çš„ç®—æ³•æŠŠè¿æ¥å¥—æ¥å­—åˆ†å‘ç»™ä»reactorï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470449,"discussion_content":"é€šè¿‡round-robinçš„ç®—æ³•ã€‚ä»£ç åœ¨\nlib/thread_pool.c  thread_pool_get_loop","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571451895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":139834,"user_name":"mgxian","can_delete":false,"product_type":"c1","uid":1014806,"ip_address":"","ucode":"7B7E77E6A83B87","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7c/16/4d1e5cc1.jpg","comment_is_top":false,"comment_ctime":1570754146,"is_pvip":false,"replies":[{"id":"55069","content":"è°œåº•å¾ˆå¿«æ­æ™“ :)","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1571450921,"ip_address":"","comment_id":139834,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1570754146","product_id":100032701,"comment_content":"7è¿™ä¸ªå¥—æ¥å­—åº”è¯¥æ˜¯ç”¨æ¥ä¼ é€’æ–°å»ºè¿æ¥çš„å¥—æ¥å­—çš„ ","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470134,"discussion_content":"è°œåº•å¾ˆå¿«æ­æ™“ :)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571450921,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1177315,"avatar":"https://static001.geekbang.org/account/avatar/00/11/f6/e3/e4bcd69e.jpg","nickname":"æ²‰æ·€çš„æ¢¦æƒ³","note":"","ucode":"BCB7C26F9D214B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":30815,"discussion_content":"ç”¨å¥—æ¥å­—æ¥ä¼ é€’å¥—æ¥å­—ï¼Œæ„Ÿè§‰å¾ˆç¥å¥‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570861289,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}