{"id":614570,"title":"05｜K8s 极简实战：示例应用介绍","content":"<p>你好，我是王炜。</p><p>上一章，我们以一个 Python 应用为例，学习了将应用迁移到云原生架构下的完整过程，也就是从容器化、部署到 K8s、弹性伸缩最后到 GitOps 的全过程。在实战的过程中，我没有太多地介绍概念，而是让你直接上手感受 K8s 和 GitOps 的强大之处。</p><p>这一章，我会设计一个更加接近真实业务的示例应用。这个应用会涵盖你在工作中常用的 K8s 对象，包括 Deployment、Service、Ingress、HPA、Namespace、ConfigMap 等。在将这个应用部署到 K8s 的过程中，我们会逐渐深入到每个 K8s 对象中。</p><p>这节课，我们先来了解一下这个示例应用。</p><p>在开始学习之前，你需要做好以下准备：</p><ul>\n<li>准备一台电脑（首选 Linux 或 macOS，Windows 也适用，注意操作差异）；</li>\n<li><a href=\"https://docs.docker.com/engine/install/\">安装 Docker</a>；</li>\n<li><a href=\"https://kubernetes.io/docs/tasks/tools/\">安装 Kubectl</a>；</li>\n<li><a href=\"https://kind.sigs.k8s.io/docs/user/quick-start/#installation\">安装 Kind</a>。</li>\n</ul><h2>架构介绍</h2><h3>应用架构</h3><p>我设计的这个示例应用是一套微服务架构的应用，你可以在 GitHub 上获取<a href=\"https://github.com/lyzhang1999/kubernetes-example\">源码</a>，源码目录结构如下：</p><pre><code class=\"language-powershell\">$ ls\nbackend&nbsp; deploy&nbsp; &nbsp;frontend\n</code></pre><p>在这里，backend 目录为后端源码，frontend 目录为前端源码，deploy 目录是应用的 K8s Manifest，前后端都已经包含构建镜像所需的 Dockerfile。</p><!-- [[[read_end]]] --><p>示例应用由三个服务组成：</p><ol>\n<li>前端；</li>\n<li>后端；</li>\n<li>数据库。</li>\n</ol><p>其中，前端采用 React 编写，它也是应用对外提供服务的入口；后端由 Python 编写；数据库采用流行的 Postgres。应用整体架构如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/e4/e0/e47ayy03e7a3a6429c6c5b404133ede0.jpg?wh=1920x1074\" alt=\"图片\"></p><p>前端实现了三个功能，分别是存储输入的内容，列出输入内容记录以及删除所有的记录。这三个功能分别对应了后端的三个接口，也就是 /add, /fetch 和 /delete，最后数据会被存储在 Postgres 数据库中。</p><p>示例应用的前端界面如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/4d/af/4d24857b5b97a1c8e7629198c8f379af.png?wh=1920x1172\" alt=\"图片\"></p><h3>K8s 部署架构</h3><p>为了方便你把示例应用直接部署到 K8s 集群内，我已经写好了 K8s Manifest 文件，你可以在 <a href=\"https://github.com/lyzhang1999/kubernetes-example/tree/main/deploy\">GitHub</a> 找到这些清单文件。应用的 K8s 部署架构图如下：</p><p><img src=\"https://static001.geekbang.org/resource/image/f1/56/f1e65380bb2342676024341b034f0e56.jpg?wh=1920x1001\" alt=\"图片\"></p><p>在这张架构图中，Ingress 是应用的入口，Ingress 会根据请求路径将流量分流至前后端的 Service 中，然后 Service 将请求转发给前后端 Pod 进行业务逻辑处理，后端的工作负载 Deployment 配置了 HPA 自动横向扩容。同时，Postgres 也是以 Deployment 的方式部署到集群内的。最后，所有资源都部署在 K8s 的 example 命名空间（Namespace）下。</p><p>在熟悉了应用架构之后，接下来我们就把它部署到 K8s 集群内。</p><h2>部署应用</h2><h3>创建新的 K8s 集群</h3><p>我们还是以部署到本地 Kind 集群为例，为了避免资源冲突，需要先把第一章实验过程创建的 Kind 集群删掉。你可以用 kind delete cluster 来删除集群：</p><pre><code class=\"language-powershell\">$ kind delete cluster\n</code></pre><p>然后，重新创建一个 K8s 集群，将下面的内容保存为 config.yaml：</p><pre><code class=\"language-yaml\">kind: Cluster\napiVersion: kind.x-k8s.io/v1alpha4\nnodes:\n- role: control-plane\n  kubeadmConfigPatches:\n  - |\n    kind: InitConfiguration\n    nodeRegistration:\n      kubeletExtraArgs:\n        node-labels: \"ingress-ready=true\"\n  extraPortMappings:\n  - containerPort: 80\n    hostPort: 80\n    protocol: TCP\n  - containerPort: 443\n    hostPort: 443\n    protocol: TCP\n</code></pre><p>接下来，使用 kind create cluster 重新创建集群：</p><pre><code class=\"language-yaml\">❯ kind create cluster --config config.yaml\nCreating cluster \"kind\" ...\n ✓ Ensuring node image (kindest/node:v1.23.4) 🖼\n ✓ Preparing nodes 📦  \n ✓ Writing configuration 📜 \n ✓ Starting control-plane 🕹️ \n ✓ Installing CNI 🔌 \n ✓ Installing StorageClass 💾 \nSet kubectl context to \"kind-kind\"\nYou can now use your cluster with:\n\nkubectl cluster-info --context kind-kind\n</code></pre><p>由于示例应用使用了 Ingress，所以我们需要为 Kind 部署 Ingress，你可以使用 kubectl apply -f 来部署 Ingress-Nginx：</p><pre><code class=\"language-powershell\">$ kubectl create -f https://ghproxy.com/https://raw.githubusercontent.com/lyzhang1999/resource/main/ingress-nginx/ingress-nginx.yaml\nnamespace/ingress-nginx created\nserviceaccount/ingress-nginx created\nserviceaccount/ingress-nginx-admission created\n......\n</code></pre><p>最后，再部署 Metric Server，以便开启 HPA 功能：</p><pre><code class=\"language-powershell\">$ kubectl apply -f https://ghproxy.com/https://raw.githubusercontent.com/lyzhang1999/resource/main/metrics/metrics.yaml\nserviceaccount/metrics-server created\nclusterrole.rbac.authorization.k8s.io/system:aggregated-metrics-reader created\nclusterrole.rbac.authorization.k8s.io/system:metrics-server created\n......\n</code></pre><p><strong>准备好新的 K8s 集群后，就可以开始部署示例应用了。</strong></p><h3>部署示例应用</h3><p>我们把示例应用所有的资源都部署在一个新的命名空间下，新的命名空间命名为 example。我们首先需要创建该命名空间，你可以使用 kubectl create namespace 来创建命名空间：</p><pre><code class=\"language-powershell\">$ kubectl create namespace example\nnamespace/example created\n</code></pre><p>然后，创建 Postgres 数据库，同样使用 kubectl apply 来创建：</p><pre><code class=\"language-powershell\">$ kubectl apply -f https://ghproxy.com/https://raw.githubusercontent.com/lyzhang1999/kubernetes-example/main/deploy/database.yaml -n example\nconfigmap/pg-init-script created\ndeployment.apps/postgres created\nservice/pg-service created\n</code></pre><p>在上面这段代码中，-n 参数代表指定命名空间，也就是 example 命名空间，<strong>注意，后续创建资源时都需要指定这个命名空间。</strong></p><p>然后再分别创建前后端 Deployment 工作负载和 Service：</p><pre><code class=\"language-powershell\">$ kubectl apply -f https://ghproxy.com/https://raw.githubusercontent.com/lyzhang1999/kubernetes-example/main/deploy/frontend.yaml -n example\ndeployment.apps/frontend created\nservice/frontend-service created\n\n$ kubectl apply -f https://ghproxy.com/https://raw.githubusercontent.com/lyzhang1999/kubernetes-example/main/deploy/backend.yaml -n example\ndeployment.apps/backend created\nservice/backend-service created\n</code></pre><p>接下来，为应用创建 Ingress 和 HPA 策略：</p><pre><code class=\"language-powershell\">$ kubectl apply -f https://ghproxy.com/https://raw.githubusercontent.com/lyzhang1999/kubernetes-example/main/deploy/ingress.yaml -n example\ningress.networking.k8s.io/frontend-ingress created\n\n$ kubectl apply -f https://ghproxy.com/https://raw.githubusercontent.com/lyzhang1999/kubernetes-example/main/deploy/hpa.yaml -n example\nhorizontalpodautoscaler.autoscaling/backend created\n</code></pre><p>其实，除了可以按照上面的引导单独创建示例应用的每一个 K8s 对象以外，我们还可以使用另一种方法，那就是把这个 Git 仓库克隆到本地，然后使用 kubectl apply <strong>一次性将所有示例应用的对象</strong>部署到集群内：</p><pre><code class=\"language-yaml\">$ git clone https://ghproxy.com/https://github.com/lyzhang1999/kubernetes-example &amp;&amp; cd kubernetes-example\nCloning into 'kubernetes-example'...\n......\nResolving deltas: 100% (28/28), done.\n\n$ kubectl apply -f deploy -n example\ndeployment.apps/backend created\nservice/backend-service created\nconfigmap/pg-init-script created\n......\n</code></pre><p>这里的 -f 参数除了可以指定文件外，还可以指定目录，kubectl 将会检查目录下所有可用的 Manifest，然后把它部署到 K8s 集群。-n 参数代表将所有 Manifest 部署到 example 命名空间。</p><p>最后，我们可以使用 kubectl wait 来检查所有资源是不是已经处于 Ready 状态了：</p><pre><code class=\"language-powershell\">$ kubectl wait --for=condition=Ready pods --all -n example\npod/backend-9b677898b-n5lsm condition met\npod/frontend-f948bdc85-q6x9f condition met\npod/postgres-7745b57d5d-f4trt condition met\n</code></pre><p><strong>到这里，示例应用就部署完了。</strong></p><p>打开浏览器访问 127.0.0.1，你应该能看到示例应用的前端界面，如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/4d/07/4dae13ff82229226916b7b767d6a5007.png?wh=1920x1190\" alt=\"图片\"></p><p>你可以尝试在输出框中输入内容，如果点击 Add 按钮，下方的列表内会出现你输入的内容，点击 Clear 所有内容被清空，这就说明应用已经可以正常工作了。</p><h2>K8s 对象解析</h2><p>在这个示例应用中，我们创建了一个新的命名空间来部署所有资源，这个命名空间是 example。</p><p>此外，示例应用涉及到的资源比较多，为了更清楚地梳理它们之间的逻辑关系，我给你简单地总结一下。</p><p>首先，你可以使用 kubectl get all 来查看某个命名空间下的所有资源：</p><pre><code class=\"language-powershell\">❯ kubectl get all -n example\nNAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; READY&nbsp; &nbsp;STATUS&nbsp; &nbsp; RESTARTS&nbsp; &nbsp;AGE\npod/backend-648ff85f48-8qgjg&nbsp; &nbsp; 1/1&nbsp; &nbsp; &nbsp;Running&nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 29s\npod/backend-648ff85f48-f845h&nbsp; &nbsp; 1/1&nbsp; &nbsp; &nbsp;Running&nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 51s\npod/frontend-7b55cc5c67-4svjz&nbsp; &nbsp;1/1&nbsp; &nbsp; &nbsp;Running&nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 14s\npod/frontend-7b55cc5c67-9cx57&nbsp; &nbsp;1/1&nbsp; &nbsp; &nbsp;Running&nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 14s\npod/postgres-7745b57d5d-f4trt&nbsp; &nbsp;1/1&nbsp; &nbsp; &nbsp;Running&nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 44m\n\nNAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TYPE&nbsp; &nbsp; &nbsp; &nbsp; CLUSTER-IP&nbsp; &nbsp; &nbsp; EXTERNAL-IP&nbsp; &nbsp;PORT(S)&nbsp; &nbsp; AGE\nservice/backend-service&nbsp; &nbsp; ClusterIP&nbsp; &nbsp;10.96.244.140&nbsp; &nbsp;&lt;none&gt;&nbsp; &nbsp; &nbsp; &nbsp; 5000/TCP&nbsp; &nbsp;42m\nservice/frontend-service&nbsp; &nbsp;ClusterIP&nbsp; &nbsp;10.96.85.54&nbsp; &nbsp; &nbsp;&lt;none&gt;&nbsp; &nbsp; &nbsp; &nbsp; 3000/TCP&nbsp; &nbsp;43m\nservice/pg-service&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ClusterIP&nbsp; &nbsp;10.96.166.74&nbsp; &nbsp; &lt;none&gt;&nbsp; &nbsp; &nbsp; &nbsp; 5432/TCP&nbsp; &nbsp;44m\n\nNAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;READY&nbsp; &nbsp;UP-TO-DATE&nbsp; &nbsp;AVAILABLE&nbsp; &nbsp;AGE\ndeployment.apps/backend&nbsp; &nbsp; 2/2&nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;42m\ndeployment.apps/frontend&nbsp; &nbsp;2/2&nbsp; &nbsp; &nbsp;4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;43m\ndeployment.apps/postgres&nbsp; &nbsp;1/1&nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;44m\n\nNAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DESIRED&nbsp; &nbsp;CURRENT&nbsp; &nbsp;READY&nbsp; &nbsp;AGE\nreplicaset.apps/backend-648ff85f48&nbsp; &nbsp; 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;51s\nreplicaset.apps/frontend-7b55cc5c67&nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;54s\nreplicaset.apps/postgres-7745b57d5d&nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;44m\n\nNAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;REFERENCE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TARGETS&nbsp; &nbsp; MINPODS&nbsp; &nbsp;MAXPODS&nbsp; &nbsp;REPLICAS&nbsp; &nbsp;AGE\nhorizontalpodautoscaler.autoscaling/backend&nbsp; &nbsp; Deployment/backend&nbsp; &nbsp; 0%/50%&nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10&nbsp; &nbsp; &nbsp; &nbsp; 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8m17s\nhorizontalpodautoscaler.autoscaling/frontend&nbsp; &nbsp;Deployment/frontend&nbsp; &nbsp;51%/80%&nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10&nbsp; &nbsp; &nbsp; &nbsp; 10&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8m17s\n</code></pre><p>-n 参数表示指定一个命名空间，从返回结果可以看出，示例应用一共创建了 5 个 Pod、3 个 Service、3 个 Deployment、3 个 Replicaset、2 个 HPA，是不是对有些概念有点陌生呢？别担心，我们还会在接下来的课程中详细介绍。</p><h2>总结</h2><p>在这节课，我为你准备了一个示例应用，并引导你创建了一个新的本地 Kind 集群，还完成了部署的操作。此外，我们还介绍了应用整体的架构设计，包括业务架构和 K8s 部署架构。</p><p>示例应用主要从真实项目出发，在我们这个应用里出现的大多数 K8s 对象，你也会在实际工作中用到它们，掌握它们有助于你把真实的应用迁移到 K8s。在接下来的课程里，我会从这个示例应用出发，为你详细介绍这里出现的每一个 K8s 对象类型，为未来的 GitOps 课程打下坚实的基础。</p><h2>思考题</h2><p>最后，给你留一道思考题吧。</p><p>请你尝试在示例应用中添加一些数据，然后使用 kubectl delete pod 删除 Postgres 的 Pod，删除后 K8s 将会重新创建 Pod，请你观察一下之前保存的数据还存在吗？为什么？</p><p>欢迎你给我留言交流讨论，你也可以把这节课分享给更多的朋友一起阅读。我们下节课见。</p>","neighbors":{"left":{"article_title":"04｜如何借助GitOps实现应用秒级自动发布和回滚？","id":612577},"right":{"article_title":"06 | 如何使用命名空间隔离团队及应用环境？","id":615238}},"comments":[{"had_liked":false,"id":364728,"user_name":"includestdio.h","can_delete":false,"product_type":"c1","uid":2314854,"ip_address":"广东","ucode":"5027BACE9319CD","user_header":"https://static001.geekbang.org/account/avatar/00/23/52/66/3e4d4846.jpg","comment_is_top":false,"comment_ctime":1671420268,"is_pvip":true,"replies":[{"id":132808,"content":"感谢指正。\n回答非常正确！","user_name":"作者回复","user_name_real":"编辑","uid":1275456,"ctime":1671432056,"ip_address":"广东","comment_id":364728,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"“首先，你可以使用 kubect get all 来查看某个命名空间下的所有资源” 。命令写错了，kubectl\n\n删除 Postgres Pod 后，添加的数据不存在。原因：写入的数据位于容器的可写层，不commit不保存，delete 后，重新拉起的 Pod 基于原始容器镜像创建，仅存在原始的只读层数据。需要保存数据的话，可以提前通过 volume 等做好持久化方案，把容器和数据解耦","like_count":9,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597092,"discussion_content":"感谢指正。\n回答非常正确！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1671432056,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":364733,"user_name":"Y","can_delete":false,"product_type":"c1","uid":1179432,"ip_address":"广东","ucode":"952AA9B2CD91CE","user_header":"https://static001.geekbang.org/account/avatar/00/11/ff/28/040f6f01.jpg","comment_is_top":false,"comment_ctime":1671425565,"is_pvip":true,"replies":[{"id":132809,"content":"😄","user_name":"作者回复","user_name_real":"编辑","uid":1275456,"ctime":1671432118,"ip_address":"广东","comment_id":364733,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"继续追剧","like_count":3,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597093,"discussion_content":"😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1671432119,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":364730,"user_name":"GAC·DU","can_delete":false,"product_type":"c1","uid":1385403,"ip_address":"广东","ucode":"7847FBE1C13740","user_header":"https://static001.geekbang.org/account/avatar/00/15/23/bb/a1a61f7c.jpg","comment_is_top":false,"comment_ctime":1671420913,"is_pvip":false,"replies":[{"id":132807,"content":"在生产环境下有很多存储方案，比如：\n1. https:&#47;&#47;github.com&#47;rook&#47;rook\n2. https:&#47;&#47;github.com&#47;ceph&#47;ceph\n3. https:&#47;&#47;github.com&#47;longhorn&#47;longhorn\n\n如果你用的是云厂商的托管 K8s 集群，云厂商一般会直接提供现成的存储方案，比如结合自家云盘的存储，不需要自建。","user_name":"作者回复","user_name_real":"编辑","uid":1275456,"ctime":1671431995,"ip_address":"广东","comment_id":364730,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"前端添加的数据会被删除，因为没有挂盘存储。生产环境用那种存储框架？","like_count":2,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597090,"discussion_content":"在生产环境下有很多存储方案，比如：\n1. https://github.com/rook/rook\n2. https://github.com/ceph/ceph\n3. https://github.com/longhorn/longhorn\n\n如果你用的是云厂商的托管 K8s 集群，云厂商一般会直接提供现成的存储方案，比如结合自家云盘的存储，不需要自建。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1671431996,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":372541,"user_name":"Alex","can_delete":false,"product_type":"c1","uid":1024763,"ip_address":"山东","ucode":"F6B5C64BC99FB7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a2/fb/94af9cf1.jpg","comment_is_top":false,"comment_ctime":1681267315,"is_pvip":false,"replies":[{"id":135991,"content":"👍🏻感谢分享","user_name":"作者回复","user_name_real":"编辑","uid":1275456,"ctime":1681297704,"ip_address":"广东","comment_id":372541,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"针对无法拉取镜像的情况，建议修改下KIND内集群的镜像源到国内阿里的镜像源上\nkind: Cluster\napiVersion: kind.x-k8s.io&#47;v1alpha4\nnodes:\n- role: control-plane\n  kubeadmConfigPatches:\n  - |\n    kind: InitConfiguration\n    imageRepository: registry.aliyuncs.com&#47;google_containers\n    nodeRegistration:\n      kubeletExtraArgs:\n        node-labels: &quot;ingress-ready=true&quot;\n  extraPortMappings:\n  - containerPort: 80\n    hostPort: 80\n    protocol: TCP\n  - containerPort: 443\n    hostPort: 443\n    protocol: TCP","like_count":1,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":613383,"discussion_content":"👍🏻感谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1681297704,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365220,"user_name":"熊悟空的凶","can_delete":false,"product_type":"c1","uid":1933459,"ip_address":"广东","ucode":"5FA9498BDA92C0","user_header":"https://static001.geekbang.org/account/avatar/00/1d/80/93/dde3d5f0.jpg","comment_is_top":false,"comment_ctime":1672281003,"is_pvip":false,"replies":[{"id":133040,"content":"Draw.io","user_name":"作者回复","user_name_real":"编辑","uid":1275456,"ctime":1672294244,"ip_address":"广东","comment_id":365220,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"老师你好  麻烦问下  您画图工具用什么画的 挺好的","like_count":1,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597874,"discussion_content":"Draw.io","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672294244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":364721,"user_name":"Amosヾ","can_delete":false,"product_type":"c1","uid":1567014,"ip_address":"广东","ucode":"833F6FCB4042AD","user_header":"https://static001.geekbang.org/account/avatar/00/17/e9/26/472e16e4.jpg","comment_is_top":false,"comment_ctime":1671414343,"is_pvip":true,"replies":[{"id":132811,"content":"感谢指正。","user_name":"作者回复","user_name_real":"编辑","uid":1275456,"ctime":1671434486,"ip_address":"广东","comment_id":364721,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"图里不是5个pod吗","like_count":1,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597098,"discussion_content":"感谢指正。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1671434486,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":377732,"user_name":"Sophia-百鑫","can_delete":false,"product_type":"c1","uid":1269105,"ip_address":"上海","ucode":"070DC977441003","user_header":"https://static001.geekbang.org/account/avatar/00/13/5d/71/4f6aad17.jpg","comment_is_top":false,"comment_ctime":1689128176,"is_pvip":false,"replies":[{"id":137657,"content":"👍🏻值得借鉴的解决思路","user_name":"作者回复","user_name_real":"编辑","uid":1275456,"ctime":1689131694,"ip_address":"广东","comment_id":377732,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"我在学习后面章节时 ，找到了 503 失败的原因，是在我clone 到本地的代码里， frontend deployment 中 pod定义标签 和 frontend service 中 pod 选择器的标签不同 （估计是我不小心碰到误改了老师的原文），导致后面无法生产endpoint对象 也无法找到frontend service 与 front pod 的对应关系，导致无法提供服务。 能读懂各个manifest文件及里面参数的含义和关联关系非常重要。是学习K8S 的核心。\n","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":623176,"discussion_content":"👍🏻值得借鉴的解决思路","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1689131694,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":377618,"user_name":"Sophia-百鑫","can_delete":false,"product_type":"c1","uid":1269105,"ip_address":"上海","ucode":"070DC977441003","user_header":"https://static001.geekbang.org/account/avatar/00/13/5d/71/4f6aad17.jpg","comment_is_top":false,"comment_ctime":1688885548,"is_pvip":false,"replies":[{"id":137625,"content":"是用的 Kind 吗，检查一下 ingress-nginx 是否部署成功，ingress 对象是否正常匹配到了 service，service 关联的 pod 是否正常运行。","user_name":"作者回复","user_name_real":"编辑","uid":1275456,"ctime":1688953248,"ip_address":"广东","comment_id":377618,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"Mac 上完成集群部署，解决了 frontend pod  OOMKILL 问题后，5个pod 都正常 running。 但浏览器访问127.0.0.1 报 503 。 \nkubernetes-example git:(main) ✗ kubectl  get  pods -n example\nNAME                        READY   STATUS    RESTARTS   AGE\nbackend-f8ffdcdd6-57qkp     1&#47;1     Running   0          28m\nbackend-f8ffdcdd6-7rvhv     1&#47;1     Running   0          28m\nfrontend-696c87cc48-4qqvv   1&#47;1     Running   0          28m\nfrontend-696c87cc48-kg2jw   1&#47;1     Running   0          28m\npostgres-f4745bb69-2m2bt    1&#47;1     Running   0          28m\n➜  kubernetes-example git:(main) ✗ kubectl get all -n example\nNAME                            READY   STATUS    RESTARTS   AGE\npod&#47;backend-f8ffdcdd6-57qkp     1&#47;1     Running   0          31m\npod&#47;backend-f8ffdcdd6-7rvhv     1&#47;1     Running   0          31m\npod&#47;frontend-696c87cc48-4qqvv   1&#47;1     Running   0          31m\npod&#47;frontend-696c87cc48-kg2jw   1&#47;1     Running   0          31m\npod&#47;postgres-f4745bb69-2m2bt    1&#47;1     Running   0          31m\n\nNAME                       TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE\nservice&#47;backend-service    ClusterIP   10.96.56.77     &lt;none&gt;        5000&#47;TCP   31m\nservice&#47;frontend-service   ClusterIP   10.96.119.215   &lt;none&gt;        3000&#47;TCP   31m\nservice&#47;pg-service         ClusterIP   10.96.46.127    &lt;none&gt;        5432&#47;TCP   31m\n\nNAME                       READY   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps&#47;backend    2&#47;2     2            2           31m\ndeployment.apps&#47;frontend   2&#47;2     2            2           31m\ndeployment.apps&#47;postgres   1&#47;1     1            1           31m\n\nNAME                                  DESIRED   CURRENT   READY   AGE\nreplicaset.apps&#47;backend-f8ffdcdd6     2         2         2       31m\nreplicaset.apps&#47;frontend-696c87cc48   2         2         2       31m\nreplicaset.apps&#47;postgres-f4745bb69    1         1         1       31m\n\nNAME                                           REFERENCE             TARGETS           MINPODS   MAXPODS   REPLICAS   AG","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":623022,"discussion_content":"是用的 Kind 吗，检查一下 ingress-nginx 是否部署成功，ingress 对象是否正常匹配到了 service，service 关联的 pod 是否正常运行。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1688953248,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1269105,"avatar":"https://static001.geekbang.org/account/avatar/00/13/5d/71/4f6aad17.jpg","nickname":"Sophia-百鑫","note":"","ucode":"070DC977441003","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":623172,"discussion_content":"我在使用 kubectl get endpoint -n  example   查看 命名空间下服务 的endpoint 对象时，发现 frontend -service 的endpoint 是 none。 说明frontend -service 的 pod 选择器定义错误 导致 k8s 无法在创建 service 后，主动创建出此service 对应的endpoint 。 通过这条命令 发现了问题的根本。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1689128879,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1269105,"avatar":"https://static001.geekbang.org/account/avatar/00/13/5d/71/4f6aad17.jpg","nickname":"Sophia-百鑫","note":"","ucode":"070DC977441003","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":623170,"discussion_content":"通过后面章节的学习找到了失败的原因 是 frontend deployment 中 pod 定义中的label 与frontend service 中 pod 选择器的label 不一致导致的。（我clone 到本地的代码不小心误改了 frontend service 中 pod 选择器的label），这样导致了 frontend service 无法匹配到对应的frontend pod ，导致无法提供服务。 各个 manifest文件的参数定义以及参数间的关系的理解掌握非常重要。 感谢老师","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1689128534,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":373209,"user_name":"Da Vinci","can_delete":false,"product_type":"c1","uid":1061671,"ip_address":"广东","ucode":"DB3B7F6A6028C1","user_header":"https://static001.geekbang.org/account/avatar/00/10/33/27/e5a74107.jpg","comment_is_top":false,"comment_ctime":1682243772,"is_pvip":true,"replies":[{"id":136332,"content":"检查一下 ingress-nginx pod 是不是 running 状态。","user_name":"作者回复","user_name_real":"编辑","uid":1275456,"ctime":1682302979,"ip_address":"泰国","comment_id":373209,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"部署完ingress，访问404，是有什么不对吗，老师\n","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":615488,"discussion_content":"检查一下 ingress-nginx pod 是不是 running 状态。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1682302979,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"泰国","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":372617,"user_name":"渣渣辉","can_delete":false,"product_type":"c1","uid":1911235,"ip_address":"日本","ucode":"730838D9161579","user_header":"https://static001.geekbang.org/account/avatar/00/1d/29/c3/791d0f5e.jpg","comment_is_top":false,"comment_ctime":1681352999,"is_pvip":false,"replies":[{"id":136008,"content":"方便贴一下 pod 的日志信息吗","user_name":"作者回复","user_name_real":"编辑","uid":1275456,"ctime":1681377068,"ip_address":"广东","comment_id":372617,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100312001,"comment_content":"老师你好，我通过下载github项目进行部署。但是当我访问前端的时候出现了502 BadGateway错误。然后查看pod的时候发现前端的pod重启了。并且在重启成功后再次访问还是出现了502的错误。我用的是m1芯片的macbook。","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":613527,"discussion_content":"方便贴一下 pod 的日志信息吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1681377068,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1911235,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/29/c3/791d0f5e.jpg","nickname":"渣渣辉","note":"","ucode":"730838D9161579","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":613560,"discussion_content":"kubectl logs frontend-6b48fbbc48-k2zjf -n example\nyarn run v1.22.19\n$ react-scripts start\nℹ ｢wds｣: Project is running at http://10.244.0.6/\nℹ ｢wds｣: webpack output is served from \nℹ ｢wds｣: Content not from webpack is served from /frontend/public\nℹ ｢wds｣: 404s will fallback to /\nStarting the development server...\n\nBrowserslist: caniuse-lite is outdated. Please run:\n  npx update-browserslist-db@latest\n  Why you should do it regularly: https://github.com/browserslist/update-db#readme\nThe build failed because the process exited too early. This probably means the system ran out of memory or someone called `kill -9` on the process.\nerror Command failed with exit code 1.\ninfo Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1681393292,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":613527,"ip_address":"日本","group_id":0},"score":613560,"extra":""}]},{"author":{"id":2870395,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/cc/7b/fb7920f3.jpg","nickname":"Xueqiu⛄️","note":"","ucode":"DEC8196A8BA5A9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":620266,"discussion_content":"我遇到了类似的问题。frontend pod 不停的crash，然后重启。为了测试，我在本地环境下用docker 单独跑了一下frontend container。发现frontend container 需要至少 300mbi。但是deployment 中只有requests：128Mi，limits：256Mi。所以当时猜想的问题应该是Pod遇到了 out of memory issue，然后被不停重启。我把requests和limits memory都改到1024Mi之后，就没有再出现crash loop的问题。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1685991465,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"美国","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2808415,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/da/5f/f72f0ffd.jpg","nickname":"HD","note":"","ucode":"E7990C3384BDF4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":646016,"discussion_content":"兄弟，牛！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1717127882,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371903,"user_name":"心看世界","can_delete":false,"product_type":"c1","uid":1353069,"ip_address":"陕西","ucode":"992FFF9C33DE85","user_header":"https://static001.geekbang.org/account/avatar/00/14/a5/6d/ad719e86.jpg","comment_is_top":false,"comment_ctime":1680510269,"is_pvip":false,"replies":[{"id":135695,"content":"Ingress-nginx 部署失败了，检查一下镜像的拉取情况。如果是因为网络原因，可以开通一台云厂商的香港虚拟机或者托管的 K8s 集群来实验。","user_name":"作者回复","user_name_real":"编辑","uid":1275456,"ctime":1680524061,"ip_address":"新加坡","comment_id":371903,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"老师，请教一下，运行一下命令，发生错误：\nkubectl apply -f https:&#47;&#47;ghproxy.com&#47;https:&#47;&#47;raw.githubusercontent.com&#47;lyzhang1999&#47;kubernetes-example&#47;main&#47;deploy&#47;ingress.yaml -n example\n\nError from server (InternalError): error when creating &quot;deploy&#47;ingress.yaml&quot;: Internal error occurred: failed calling webhook &quot;validate.nginx.ingress.kubernetes.io&quot;: failed to call webhook: Post &quot;https:&#47;&#47;ingress-nginx-controller-admission.ingress-nginx.svc:443&#47;networking&#47;v1&#47;ingresses?timeout=10s&quot;: dial tcp 10.96.57.158:443: connect: connection refused","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612127,"discussion_content":"Ingress-nginx 部署失败了，检查一下镜像的拉取情况。如果是因为网络原因，可以开通一台云厂商的香港虚拟机或者托管的 K8s 集群来实验。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680524061,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"新加坡","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371133,"user_name":"小马🐎","can_delete":false,"product_type":"c1","uid":1107540,"ip_address":"上海","ucode":"8CA466A4004BDB","user_header":"https://static001.geekbang.org/account/avatar/00/10/e6/54/86056001.jpg","comment_is_top":false,"comment_ctime":1679565955,"is_pvip":false,"replies":[{"id":135397,"content":"网络原因，可以尝试开通云厂商香港集群来实验。","user_name":"作者回复","user_name_real":"编辑","uid":1275456,"ctime":1679574472,"ip_address":"广东","comment_id":371133,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"容器pod的状态只有一个running 其他的都是contaninerCreating 怎么搞？》","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":610470,"discussion_content":"网络原因，可以尝试开通云厂商香港集群来实验。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679574472,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371114,"user_name":"小马🐎","can_delete":false,"product_type":"c1","uid":1107540,"ip_address":"上海","ucode":"8CA466A4004BDB","user_header":"https://static001.geekbang.org/account/avatar/00/10/e6/54/86056001.jpg","comment_is_top":false,"comment_ctime":1679555476,"is_pvip":false,"replies":[{"id":135395,"content":"ingress-nginx 没有部署成功，检查工作负载。一般是镜像没拉取成功，你可以开通一台云厂商的香港集群来实验。","user_name":"作者回复","user_name_real":"编辑","uid":1275456,"ctime":1679573817,"ip_address":"广东","comment_id":371114,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"Error from server (InternalError): error when creating &quot;https:&#47;&#47;ghproxy.com&#47;https:&#47;&#47;raw.githubusercontent.com&#47;lyzhang1999&#47;kubernetes-example&#47;main&#47;deploy&#47;ingress.yaml&quot;: Internal error occurred: failed calling webhook &quot;validate.nginx.ingress.kubernetes.io&quot;: failed to call webhook: Post &quot;https:&#47;&#47;ingress-nginx-controller-admission.ingress-nginx.svc:443&#47;networking&#47;v1&#47;ingresses?timeout=10s&quot;: dial tcp 10.96.16.113:443: connect: connection refused    \n\n这个是什么原因呀？","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":610467,"discussion_content":"ingress-nginx 没有部署成功，检查工作负载。一般是镜像没拉取成功，你可以开通一台云厂商的香港集群来实验。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679573817,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":369935,"user_name":"陈敏","can_delete":false,"product_type":"c1","uid":2841834,"ip_address":"福建","ucode":"A8F05ADF47E5F0","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erUYW4duhqyicJEAOaEAbtSiaz22iaUmV1Mh1SJGcwRgicyZC16Rk3fJFvwXuhZJP6lqjLKCH13TEvrGg/132","comment_is_top":false,"comment_ctime":1678158065,"is_pvip":false,"replies":[{"id":134860,"content":"云数据库已经很成熟了，在迁移过程主要是要做数据同步和流量切换，从私有部署的数据库实例迁移到云数据库可能会导致短时间的停机。","user_name":"作者回复","user_name_real":"编辑","uid":1275456,"ctime":1678170012,"ip_address":"广东","comment_id":369935,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"老师你好，请问一下，生产上数据库上云的话有什么最佳实践可以推荐呢","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":607875,"discussion_content":"云数据库已经很成熟了，在迁移过程主要是要做数据同步和流量切换，从私有部署的数据库实例迁移到云数据库可能会导致短时间的停机。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678170012,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":369453,"user_name":"toranx11","can_delete":false,"product_type":"c1","uid":1728431,"ip_address":"湖南","ucode":"80F54B52BEE8B3","user_header":"https://static001.geekbang.org/account/avatar/00/1a/5f/af/a2a7c866.jpg","comment_is_top":false,"comment_ctime":1677558048,"is_pvip":false,"replies":[{"id":134670,"content":"镜像是正常的，“too many open files”似乎是宿主机的配置导致的，查看这个文档排查：https:&#47;&#47;kind.sigs.k8s.io&#47;docs&#47;user&#47;known-issues&#47;#pod-errors-due-to-too-many-open-files。","user_name":"作者回复","user_name_real":"编辑","uid":1275456,"ctime":1677639006,"ip_address":"广东","comment_id":369453,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"最新的前端镜像（lyzhang1999&#47;frontend:latest）是有问题吗？frontend pod 一直CrashLoopBackOff：\n\nStarting the development server...\n\nnode:events:491\n      throw er; &#47;&#47; Unhandled &#39;error&#39; event\n      ^\n\nError: EMFILE: too many open files, watch &#39;&#47;frontend&#47;public&#39;\n    at FSWatcher.&lt;computed&gt; (node:internal&#47;fs&#47;watchers:244:19)\n    at Object.watch (node:fs:2301:34)\n    at createFsWatchInstance (&#47;frontend&#47;node_modules&#47;chokidar&#47;lib&#47;nodefs-handler.js:38:15)\n    at setFsWatchListener (&#47;frontend&#47;node_modules&#47;chokidar&#47;lib&#47;nodefs-handler.js:81:15)\n    at FSWatcher.NodeFsHandler._watchWithNodeFs (&#47;frontend&#47;node_modules&#47;chokidar&#47;lib&#47;nodefs-handler.js:233:14)\n    at FSWatcher.NodeFsHandler._handleDir (&#47;frontend&#47;node_modules&#47;chokidar&#47;lib&#47;nodefs-handler.js:429:19)\n    at FSWatcher.&lt;anonymous&gt; (&#47;frontend&#47;node_modules&#47;chokidar&#47;lib&#47;nodefs-handler.js:477:19)\n    at FSWatcher.&lt;anonymous&gt; (&#47;frontend&#47;node_modules&#47;chokidar&#47;lib&#47;nodefs-handler.js:482:16)\n    at FSReqCallback.oncomplete (node:fs:207:5)\nEmitted &#39;error&#39; event on FSWatcher instance at:\n    at FSWatcher._handleError (&#47;frontend&#47;node_modules&#47;chokidar&#47;index.js:260:10)\n    at createFsWatchInstance (&#47;frontend&#47;node_modules&#47;chokidar&#47;lib&#47;nodefs-handler.js:40:5)\n    at setFsWatchListener (&#47;frontend&#47;node_modules&#47;chokidar&#47;lib&#47;nodefs-handler.js:81:15)\n    [... lines matching original stack trace ...]\n    at FSReqCallback.oncomplete (node:fs:207:5) {\n  errno: -24,\n  syscall: &#39;watch&#39;,\n  code: &#39;EMFILE&#39;,\n  path: &#39;&#47;frontend&#47;public&#39;,\n  filename: &#39;&#47;frontend&#47;public&#39;\n}","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":607140,"discussion_content":"镜像是正常的，“too many open files”似乎是宿主机的配置导致的，查看这个文档排查：https://kind.sigs.k8s.io/docs/user/known-issues/#pod-errors-due-to-too-many-open-files。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677639006,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":367704,"user_name":"阿星","can_delete":false,"product_type":"c1","uid":2883767,"ip_address":"福建","ucode":"B4F6135FFA9B51","user_header":"https://static001.geekbang.org/account/avatar/00/2c/00/b7/a39ab3e5.jpg","comment_is_top":false,"comment_ctime":1675473771,"is_pvip":false,"replies":[{"id":133937,"content":"检查一下 Ingress-nginx 是不是没安装成功？","user_name":"作者回复","user_name_real":"编辑","uid":1275456,"ctime":1675486921,"ip_address":"广东","comment_id":367704,"utype":1}],"discussion_count":4,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"CentOS 8.2 下，按照引导都安装好了，但是执行\nkubectl apply -f .&#47;deploy&#47;ingress.yaml -n example 时报错了：\n\nerror when creating &quot;deploy&#47;ingress.yaml&quot;: Internal error occurred: failed calling webhook &quot;validate.nginx.ingress.kubernetes.io&quot;: failed to call webhook: Post &quot;https:&#47;&#47;ingress-nginx-controller-admission.ingress-nginx.svc:443&#47;networking&#47;v1&#47;ingresses?timeout=10s&quot;: dial tcp 10.96.136.247:443: connect: connection refused","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":601905,"discussion_content":"检查一下 Ingress-nginx 是不是没安装成功？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675486921,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2883767,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/00/b7/a39ab3e5.jpg","nickname":"阿星","note":"","ucode":"B4F6135FFA9B51","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":601909,"discussion_content":"谢谢老师回复，再次尝试了发现是 kind 里面启动 Ingress-nginx 失败了。后续发现 kind 里面似乎无法成功拉取镜像，需要先本地 pull 下来后，调用 kind load docker-image 加载完毕后才可以。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675493555,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":601905,"ip_address":"福建","group_id":0},"score":601909,"extra":""}]},{"author":{"id":2883767,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/00/b7/a39ab3e5.jpg","nickname":"阿星","note":"","ucode":"B4F6135FFA9B51","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":601912,"discussion_content":"又研究了一下，发现是因为终端设置了代理，导致 kind 里面 pull image 失败了。关掉代理后就好了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675495161,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"福建","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1107540,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e6/54/86056001.jpg","nickname":"小马🐎","note":"","ucode":"8CA466A4004BDB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2883767,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/00/b7/a39ab3e5.jpg","nickname":"阿星","note":"","ucode":"B4F6135FFA9B51","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":610436,"discussion_content":"兄弟，什么意思？没看懂，我现在也碰到这个问题了，我是在Mac上的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679560569,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":601912,"ip_address":"上海","group_id":0},"score":610436,"extra":""}]}]},{"had_liked":false,"id":366303,"user_name":"郑海成","can_delete":false,"product_type":"c1","uid":1192616,"ip_address":"北京","ucode":"B0363EA4B2C646","user_header":"https://static001.geekbang.org/account/avatar/00/12/32/a8/d5bf5445.jpg","comment_is_top":false,"comment_ctime":1673571401,"is_pvip":true,"replies":[{"id":133470,"content":"非常正确👍🏻","user_name":"作者回复","user_name_real":"编辑","uid":1275456,"ctime":1673575421,"ip_address":"广东","comment_id":366303,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"删除pod后，添加的数据不存在了。pod没有挂载持久化存储，kubernetes 存储按照生命周期分为: 容器文件系统存储、临时存储、持久化存储。容器文件系统存储与pod内容器生命周期一致，容器删除后销毁；临时存储与pod生命周期一致，pod删除后销毁；持久化存储是外部的网络存储或者hostpath，会一直保留。示例中使用容器文件系统存储，删除pod就被销毁","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":599518,"discussion_content":"非常正确👍🏻","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673575422,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":366051,"user_name":"那风在极客","can_delete":false,"product_type":"c1","uid":1026502,"ip_address":"广东","ucode":"132B9263006BB9","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a9/c6/30b29c22.jpg","comment_is_top":false,"comment_ctime":1673343244,"is_pvip":false,"replies":[{"id":133417,"content":"是的，需要 1.23 以上的版本。","user_name":"作者回复","user_name_real":"编辑","uid":1275456,"ctime":1673443899,"ip_address":"广东","comment_id":366051,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"提示 unable to recognize &quot;hpa.yaml&quot;: no matches for kind &quot;HorizontalPodAutoscaler&quot; in version &quot;autoscaling&#47;v2&quot;，是我的 k8s 版本低了吗，我的 k8s 实验版本是 v1.22.2","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":599321,"discussion_content":"是的，需要 1.23 以上的版本。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673443899,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365559,"user_name":"李多","can_delete":false,"product_type":"c1","uid":2806068,"ip_address":"广东","ucode":"974E2C405C2CE7","user_header":"https://static001.geekbang.org/account/avatar/00/2a/d1/34/03dc9e03.jpg","comment_is_top":false,"comment_ctime":1672760026,"is_pvip":false,"replies":[{"id":133150,"content":"我更新了一版，你可以重新拉一下示例应用仓库，重新部署试试看。","user_name":"作者回复","user_name_real":"编辑","uid":1275456,"ctime":1672794307,"ip_address":"广东","comment_id":365559,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"老师，frontend的资源配额数值是不是有问题，我这里一直提示OOM错误：\n\npod&#47;backend-6f756f886f-8ncv8    1&#47;1     Running             0                   15m\npod&#47;backend-6f756f886f-k6c9x    1&#47;1     Running             0                   58m\npod&#47;frontend-7b55cc5c67-5r54z   1&#47;1     Terminating         0                   5m12s\npod&#47;frontend-7b55cc5c67-brl6q   1&#47;1     Running             2 (81s ago)         4m57s\npod&#47;frontend-7b55cc5c67-cwgtt   0&#47;1     OOMKilled           3 (&lt;invalid&gt; ago)   15m\npod&#47;frontend-7b55cc5c67-tktd9   1&#47;1     Running             2 (&lt;invalid&gt; ago)   5m12s\npod&#47;frontend-7b85d8fc8-5fj6t    0&#47;1     ContainerCreating   0                   8s\npod&#47;frontend-7b85d8fc8-8v2b7    1&#47;1     Running             0                   38s\npod&#47;frontend-7b85d8fc8-jnw4j    0&#47;1     ContainerCreating   0                   38s\npod&#47;frontend-7b85d8fc8-x9vv9    0&#47;1     ContainerCreating   0                   38s\npod&#47;postgres-7745b57d5d-hckqd   1&#47;1     Running             0                   58m\n\n查看hpa对应的额度也超了：\n\nhorizontalpodautoscaler.autoscaling&#47;backend    Deployment&#47;backend    25%&#47;50%, 1%&#47;50%   2         10        2          5m46s\nhorizontalpodautoscaler.autoscaling&#47;frontend   Deployment&#47;frontend   200%&#47;80%          2         10        5          5m46s\n","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598352,"discussion_content":"我更新了一版，你可以重新拉一下示例应用仓库，重新部署试试看。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1672794308,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2806068,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/d1/34/03dc9e03.jpg","nickname":"李多","note":"","ucode":"974E2C405C2CE7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":598370,"discussion_content":"好的老师。我看到您更新的好像是hpa，昨天我把frontend内存request加到512了，就可以起来了。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1672797738,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":598352,"ip_address":"山东","group_id":0},"score":598370,"extra":""}]}]},{"had_liked":false,"id":365226,"user_name":"熊悟空的凶","can_delete":false,"product_type":"c1","uid":1933459,"ip_address":"广东","ucode":"5FA9498BDA92C0","user_header":"https://static001.geekbang.org/account/avatar/00/1d/80/93/dde3d5f0.jpg","comment_is_top":false,"comment_ctime":1672283908,"is_pvip":false,"replies":[{"id":133042,"content":"主要的原因是没有为 Pg Pod 配置持久化存储。","user_name":"作者回复","user_name_real":"编辑","uid":1275456,"ctime":1672294335,"ip_address":"广东","comment_id":365226,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100312001,"comment_content":"思考题： 删除命名空间下pg数据库后 数据不见了；实例都删了（理解是物理删除）； 数据肯定不应该在了 ","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597876,"discussion_content":"主要的原因是没有为 Pg Pod 配置持久化存储。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1672294335,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":364764,"user_name":"烟火不坠","can_delete":false,"product_type":"c1","uid":1149539,"ip_address":"广东","ucode":"BEEE3173C66E5F","user_header":"https://static001.geekbang.org/account/avatar/00/11/8a/63/a5fda84d.jpg","comment_is_top":false,"comment_ctime":1671458673,"is_pvip":false,"replies":[{"id":132832,"content":"正确，可以进一步尝试为 pg 增加持久化存储。","user_name":"作者回复","user_name_real":"编辑","uid":1275456,"ctime":1671504902,"ip_address":"广东","comment_id":364764,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100312001,"comment_content":"思考题：数据不在了，pg没有持久化存储，新pod基于yaml文件定义的镜像启动。","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597165,"discussion_content":"正确，可以进一步尝试为 pg 增加持久化存储。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1671504903,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":364754,"user_name":"奕","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"广东","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1671449521,"is_pvip":false,"replies":[{"id":132821,"content":"部署 Ingress-Nginx 之后访问本地 127.0.0.1 就可以了，应用带有 Ingress 策略。另外注意创建 Kind 集群的时候需要按照文中的步骤暴露 80 端口。","user_name":"作者回复","user_name_real":"编辑","uid":1275456,"ctime":1671452241,"ip_address":"广东","comment_id":364754,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100312001,"comment_content":"mac 部署完成之后，访问 127.0.0.1 :3000 无法访问，进入到容器内就可以访问，网络不通","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597127,"discussion_content":"部署 Ingress-Nginx 之后访问本地 127.0.0.1 就可以了，应用带有 Ingress 策略。另外注意创建 Kind 集群的时候需要按照文中的步骤暴露 80 端口。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1671452241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":364744,"user_name":"Geek_7c4279","can_delete":false,"product_type":"c1","uid":3247407,"ip_address":"广东","ucode":"A085F4F1C29E77","user_header":"","comment_is_top":false,"comment_ctime":1671444354,"is_pvip":false,"replies":[{"id":132815,"content":"加油～","user_name":"作者回复","user_name_real":"编辑","uid":1275456,"ctime":1671447162,"ip_address":"广东","comment_id":364744,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100312001,"comment_content":"继续追剧","like_count":0,"discussions":[{"author":{"id":1275456,"avatar":"https://static001.geekbang.org/account/avatar/00/13/76/40/791d0f5e.jpg","nickname":"王炜","note":"","ucode":"B6F98A1EC06BDB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597115,"discussion_content":"加油～","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1671447162,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":393226,"user_name":"Geek_72141d","can_delete":false,"product_type":"c1","uid":2608731,"ip_address":"重庆","ucode":"9573E68C340CCD","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epJo44GuuyRFNiaicEbXBpqu1WqLFQ4wj7pernCWibYD2CQyBlqUs0oF9xlFibACdoEmSJp7Ips1xDkiaw/132","comment_is_top":false,"comment_ctime":1723198451,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100312001,"comment_content":"做实验用的docker image下不下来，可以上传到国内的docker镜像站吗？","like_count":0},{"had_liked":false,"id":384079,"user_name":"dj","can_delete":false,"product_type":"c1","uid":1512964,"ip_address":"北京","ucode":"F6803089067D80","user_header":"https://static001.geekbang.org/account/avatar/00/17/16/04/3168b413.jpg","comment_is_top":false,"comment_ctime":1700229620,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100312001,"comment_content":"$ kubectl -n example  apply  -f .&#47;deploy&#47;hpa.yaml \nresource mapping not found for name: &quot;frontend&quot; namespace: &quot;&quot; from &quot;.&#47;deploy&#47;hpa.yaml&quot;: no matches for kind &quot;HorizontalPodAutoscaler&quot; in version &quot;autoscaling&#47;v2&quot;\nensure CRDs are installed first\nresource mapping not found for name: &quot;backend&quot; namespace: &quot;&quot; from &quot;.&#47;deploy&#47;hpa.yaml&quot;: no matches for kind &quot;HorizontalPodAutoscaler&quot; in version &quot;autoscaling&#47;v2&quot;","like_count":0},{"had_liked":false,"id":384072,"user_name":"dj","can_delete":false,"product_type":"c1","uid":1512964,"ip_address":"北京","ucode":"F6803089067D80","user_header":"https://static001.geekbang.org/account/avatar/00/17/16/04/3168b413.jpg","comment_is_top":false,"comment_ctime":1700223676,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100312001,"comment_content":"创建 ingress-nginx 报错  olebinding.rbac.authorization.k8s.io&#47;ingress-nginx-admission created\nclusterrolebinding.rbac.authorization.k8s.io&#47;ingress-nginx created\nclusterrolebinding.rbac.authorization.k8s.io&#47;ingress-nginx-admission created\nconfigmap&#47;ingress-nginx-controller created\nerror: error validating &quot;&#47;mnt&#47;d&#47;gitops&#47;resource&#47;ingress-nginx&#47;ingress-nginx.yaml&quot;: error validating data: \n[ValidationError(Service.spec): unknown field &quot;ipFamilies&quot; in io.k8s.api.core.v1.ServiceSpec, ValidationError(Service.spec): unknown field &quot;ipFamilyPolicy&quot; in io.k8s.api.core.v1.ServiceSpec]; if you choose to ignore these errors, turn validation off with --validate=false","like_count":0}]}