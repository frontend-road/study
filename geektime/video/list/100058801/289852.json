{"id":289852,"title":"24 | Watermark Generator","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-Flink\">https://gitee.com/geektime-geekbang/geektime-Flink</a></p>","comments":[{"had_liked":false,"id":320895,"user_name":"Geek_246ovb","can_delete":false,"product_type":"c3","uid":1718198,"ip_address":"","ucode":"7A79D96729357C","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er5oeRAIicqPS4QsOjyVkvMzaQGvgnln8XiboSuwE9UmjlichtrXnKpT7iampOKadLOWMOsl0CG9rhkpQ/132","comment_is_top":false,"comment_ctime":1636546423,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":1,"score":2,"product_id":100058801,"comment_content":"老师好，我看官方flink1.11的版本说AssignerWithPeriodicWatermarks和AssignerWithPunctuatedWatermarks都已弃用了，请问您是否会更新视频教程呢？","like_count":0},{"had_liked":false,"id":268743,"user_name":"mini希","can_delete":false,"product_type":"c3","uid":1043539,"ip_address":"","ucode":"54DFFE0CE0C7EF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ec/53/dcec6fdc.jpg","comment_is_top":false,"comment_ctime":1608337874,"is_pvip":false,"replies":null,"discussion_count":3,"race_medal":1,"score":2,"product_id":100058801,"comment_content":"老师好，为何在实现WatermarkGenerator的onPeriodicEmit方法时候，currentMaxTimestamp-maxOutOfOrderness-1，最后要减去1？","like_count":0,"discussions":[{"author":{"id":2034674,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/0b/f2/a8b0d8a6.jpg","nickname":"千里马","note":"","ucode":"829A075C14E5CA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":570364,"discussion_content":"源码中就是-1，你也可以不-1。我用的时候就不-1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651744289,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1751214,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/b8/ae/085484e7.jpg","nickname":"Insomnia","note":"","ucode":"5986A48988D6E3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":342885,"discussion_content":"BoundedOutOfOrdernessWatermarks 类中定义的 maxTimestamp = Long.MIN_VALUE + outOfOrdernessMillis + 1; 所以在 emitWatermark 的时候需要减1\n如果自定义 WatermarkGenerator<T> 时, 不需要在 emitWatermark 中减 1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610864278,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1442535,"avatar":"https://static001.geekbang.org/account/avatar/00/16/02/e7/20294573.jpg","nickname":"小石头","note":"","ucode":"F72197C6F06889","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":342693,"discussion_content":"源码中加了一个1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610780794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":253993,"user_name":"13693113483","can_delete":false,"product_type":"c3","uid":1318913,"ip_address":"","ucode":"39CF3202F58847","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJwicoopV8ZJuxPQUfATepdg7zHQG1vpZpickQYicRN0u9qwibK2lq7MDpt0ZFdofnwshNcibkLdqk9ZRg/132","comment_is_top":false,"comment_ctime":1603008121,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"老师。你好，JobEntity e1 = new JobEntity(&quot;2&quot;, 3, &quot;2020-10-01 12:12:15&quot;);\n            add(e1);\n            JobEntity e2 = new JobEntity(&quot;2&quot;, 10, &quot;2020-09-16 12:12:13&quot;);\n            add(e2);\n            JobEntity e3 = new JobEntity(&quot;2&quot;, 3, &quot;2020-10-01 00:10:15&quot;);\n            add(e3); 在我使用以上三个事件时间进行统计的时候。e2被标记为迟到时间，e3被统计到窗口。我使用的是TumblingEventTimeWindows，窗口大小为1天。没有设置窗口延迟统计，无界阀值我设置的是10ms。 另外我发现随着我窗口大小的调整。e2事件也不会被标记为迟到事件。理论上，窗口的大小调整并不会影响迟到事件的标记。但是我执行的效果并不是我理解的。请老师解惑","like_count":0,"discussions":[{"author":{"id":1751214,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/b8/ae/085484e7.jpg","nickname":"Insomnia","note":"","ucode":"5986A48988D6E3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":342171,"discussion_content":"为什么 e2 会被标记为迟到事件? e3 会正常触发 e2 窗口的计算, 触发计算后, 如果再来一条数据 时间戳是 09-16 , 这条数据才会被标记为迟到数据.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610605637,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}