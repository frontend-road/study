{"id":517172,"title":"19ï½œReduxï¼šå¤§å‹åº”ç”¨åº”è¯¥å¦‚ä½•ç®¡ç†çŠ¶æ€ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯è’‹å®ä¼Ÿã€‚</p><p>ä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘è¦å’Œä½ èŠçš„æ˜¯ï¼Œå¦‚ä½•ä½¿ç”¨ Redux æ¥ç®¡ç†å¤æ‚çš„ã€å¤§å‹çš„åº”ç”¨çŠ¶æ€ã€‚</p><p>æœ‰äººè®¤ä¸ºï¼Œåœ¨ React å‡ºäº† hooks ä¹‹åï¼Œå®˜æ–¹æä¾›çš„ useReducer å’Œ useContext çš„ç»„åˆï¼Œå·²è¿‘ä¼¼èƒ½å¤Ÿä»£æ›¿ Redux äº†ï¼Œæ‰€ä»¥ï¼Œç°åœ¨æ˜¯æ—¶å€™æŠ›å¼ƒ Reduxï¼Œç›´æ¥ç”¨ useReducer å’Œ useContext å¯¹å¤§å‹åº”ç”¨è¿›è¡ŒçŠ¶æ€ç®¡ç†äº†ã€‚</p><p>ä¹Ÿæœ‰äººè®¤ä¸ºï¼Œè™½ç„¶ Redux è§£å†³äº†çŠ¶æ€ç®¡ç†çš„é—®é¢˜ï¼Œä½†æ˜¯ Redux æ¨¡æ¿ä»£ç å¤ªå¤šï¼Œåº”è¯¥æŠ›å¼ƒ Reduxï¼Œæ”¹ç”¨ Mobx æˆ– Zustand è¿™ç±»å†™èµ·æ¥æ›´ç®€å•çš„å·¥å…·ã€‚</p><p>ä½†æˆ‘è®¤ä¸ºï¼Œä»ç›®å‰æ¥çœ‹ï¼ŒRedux ä¾æ—§æ˜¯æˆ‘ä»¬å¼€å‘å¤§å‹é¡¹ç›®æ—¶ï¼Œåº”è¯¥æœ€ä¼˜å…ˆè€ƒè™‘çš„çŠ¶æ€ç®¡ç†å·¥å…·ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ä¸€æ–¹é¢ï¼Œå¤§å‹é¡¹ç›®çš„çŠ¶æ€ç®¡ç†å¤æ‚åº¦å¾ˆé«˜ï¼ŒuseContext å¹¶ä¸æ˜¯çŠ¶æ€ç®¡ç†å·¥å…·ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªæä¾›äº†è·¨å±‚çº§ä¼ é€’çŠ¶æ€çš„å·¥å…·è€Œå·²ã€‚çœŸè¦æ‹¿ useReducer å’Œ useContext æ¥å†™å¤§å‹é¡¹ç›®ï¼Œä½ éœ€è¦å†™æ›´å¤šçš„æ¨¡æ¿ä»£ç ï¼Œè€Œä¸”æ›´éš¾ç»´æŠ¤ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œå¼€å‘å¤§å‹é¡¹ç›®éœ€è¦è€ƒè™‘å›¢é˜Ÿæˆå‘˜çš„åä½œæˆæœ¬ï¼Œç›®å‰æ¥çœ‹ï¼Œæ— è®ºæ˜¯ <a href=\"https://www.npmtrends.com/mobx-vs-redux-vs-zustand\">npm trends ä¸Šçš„ä¸‹è½½é‡</a>ï¼Œè¿˜æ˜¯æˆ‘å¯¹ React Native å¼€å‘è€…çš„<a href=\"https://segmentfault.com/a/1190000041324009\">è°ƒç ”æŠ¥å‘Š</a>éƒ½æ˜¾ç¤ºï¼ŒRedux çš„æµè¡Œç¨‹åº¦è¿œè¶…äºå…¶ä»–çŠ¶æ€ç®¡ç†å·¥å…·ã€‚å›¢é˜Ÿæ‹›ä¸€ä¸ªæ–°äººï¼Œæ–°äººç†Ÿæ‚‰ Redux æ¦‚ç‡è¿œæ¯”ç†Ÿæ‚‰ Mobxã€Zustand çš„æ¦‚ç‡æ›´é«˜ï¼Œå­¦ä¹ æˆæœ¬ã€åä½œæˆæœ¬ä¹Ÿæ˜¯æœ€ä½çš„ã€‚</p><!-- [[[read_end]]] --><p>è‡³äºä»¥å‰è¢«å¤§å®¶åæ§½æœ€å¤šçš„ï¼ŒRedux æ¨¡æ¿ä»£ç å¤šçš„é—®é¢˜ï¼Œç°åœ¨ä¹Ÿå¯ä»¥ä½¿ç”¨ Redux Toolkit æ¥è§£å†³ä¸€éƒ¨åˆ†äº†ã€‚Redux å®˜æ–¹æ˜¯è¿™ä¹ˆè¯´çš„ï¼š</p><blockquote>\n<p>We want <em>all</em> Redux users to write their Redux code with Redux Toolkit, because it simplifies your code <em>and</em> eliminates many common Redux mistakes and bugs!<br>\næˆ‘ä»¬å¸Œæœ›æ‰€æœ‰çš„ Redux å¼€å‘è€…éƒ½èƒ½ç”¨ Redux Toolkit æ¥å†™ä»£ç ï¼Œå› ä¸ºå®ƒèƒ½ç®€åŒ–ä»£ç ï¼Œå‡å°‘ BUG å’Œæ¶ˆé™¤å¸¸è§çš„å¯¹ Redux çš„è¯¯è§£ã€‚</p>\n</blockquote><p>æ‰€ä»¥ï¼Œä»Šå¤©è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°±ä¸€èµ·æ¢ç©¶ Redux/Redux Toolkit åˆ°åº•ä½•æ—¶ç”¨ã€æ€ä¹ˆç”¨ã€‚</p><h2>Redux ä»€ä¹ˆæ—¶å€™ç”¨ï¼Ÿ</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ˜ç¡®çš„æ˜¯ï¼šä¸€ä¸ªåº”ç”¨çš„çŠ¶æ€ç®¡ç†è¦å¤æ‚åˆ°ä»€ä¹ˆç¨‹åº¦æ‰éœ€è¦å¼•å…¥ Reduxï¼Ÿä¸€ä¸ªæœ€å¥½çš„åˆ¤æ–­æ ‡å‡†æ˜¯ï¼Œ<strong>å½“ä½ è§‰å¾—çŠ¶æ€ç®¡ç†æ˜¯ä½ ç ”å‘ç—›ç‚¹çš„æ—¶å€™ï¼Œä½ æ‰éœ€è¦å¼€å§‹ç€æ‰‹è§£å†³</strong>ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ä¸€ä¸ªå¤§å‹é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸é‡åˆ°çš„é—®é¢˜å°±æ˜¯ï¼Œå…¨å±€çŠ¶æ€ç®¡ç†çš„é—®é¢˜ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/d4/4f/d4fe606ec6fb8891dbafe1f0aee94f4f.gif?wh=550x475\" alt=\"å›¾ç‰‡\"></p><p>è¿™å¼ å›¾æ¥è‡ª <a href=\"https://medium.com/dailyjs/when-do-i-know-im-ready-for-redux-f34da253c85f\">ã€ŠWhen do I know Iâ€™m ready for Reduxï¼Ÿã€‹</a>ï¼Œå›¾ä¸­æè¿°çš„å°±æ˜¯ä¸€ä¸ªå…¨å±€çŠ¶æ€æ›´æ–°çš„éš¾é¢˜ã€‚åœ¨ä¸€ä¸ª App ä¸­ï¼Œå®ƒæœ‰ä¸€ä¸ªå…¨å±€çŠ¶æ€è¢«å¤šä¸ªç»„ä»¶ä½¿ç”¨äº†ï¼Œå› æ­¤å®ƒå°†è¯¥å…¨å±€çŠ¶æ€æ”¾åœ¨äº† Root ç»„ä»¶ä¸­ã€‚å½“å…¶ä¸­ä¸€ä¸ªç»„ä»¶ï¼Œè§¦å‘äº†è¯¥å…¨å±€çš„çŠ¶æ€æ›´æ–°æ“ä½œåï¼ŒRoot çš„æ–°çŠ¶æ€ä¼šé€å±‚ä¼ é€’åˆ°æ•´ä¸ªåº”ç”¨ä¸Šã€‚</p><p>è™½ç„¶å°†å…¨å±€çŠ¶æ€æŒ‚åœ¨ Root ç»„ä»¶ä¸Šï¼Œå¹¶é€šè¿‡å°†çŠ¶æ€å’ŒçŠ¶æ€æ›´æ–°å‡½æ•°é€å±‚ä¼ é€’åˆ°å„ä¸ªç»„ä»¶ä¸Šï¼Œèƒ½è§£å†³è·¨ç»„ä»¶æ›´æ–°çš„éš¾é¢˜ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ¡ˆå´å¸¦æ¥äº†æ€§èƒ½æŸè€—å’Œç»´æŠ¤æˆæœ¬é«˜ç­‰é—®é¢˜ã€‚</p><p>æ‰€ä»¥å½“ä½ åœ¨ä½¿ç”¨ useStateã€useReducer ç®¡ç†çŠ¶æ€æ—¶ï¼Œå¦‚æœä¼šé‡åˆ°æ€§èƒ½é—®é¢˜å’Œç»´æŠ¤æ€§é—®é¢˜æ—¶ï¼Œä½ å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ Redux äº†ã€‚</p><p>ä½ çœ‹ï¼ŒRedux é€šè¿‡ Store å­˜å‚¨äº†å…¨å±€çŠ¶æ€ï¼Œå®ƒä¸ä»…è§£å†³äº†çŠ¶æ€éœ€è¦é€å±‚ä¼ é€’çš„é—®é¢˜ï¼Œè¿˜é¿å…äº†æ•´ä¸ªåº”ç”¨çš„ re-renderï¼Œä¸å®¹æ˜“å‡ºç°ç›¸å…³çš„æ€§èƒ½é—®é¢˜ã€‚</p><p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä»€ä¹ˆæ—¶å€™éœ€è¦ Reduxï¼Œä»€ä¹ˆæ—¶å€™ä¸éœ€è¦ Redux è¿™ä¸ªé—®é¢˜ï¼Œç›¸ä¿¡ä½ å·²ç»æœ‰äº†ç­”æ¡ˆã€‚</p><p>å½“ä½ æœ‰å¤§é‡çš„å…¨å±€çŠ¶æ€éœ€è¦ç®¡ç†æ—¶ï¼Œå½“åº”ç”¨çŠ¶æ€é¢‘ç¹æ›´æ–°é‡åˆ°æ€§èƒ½ç“¶é¢ˆæ—¶ï¼Œå½“ç®¡ç†çŠ¶æ€çš„é€»è¾‘å¤æ‚åˆ°éœ€è¦ä»£ç åˆ†æ²»æ—¶ï¼Œå½“å¤šäººåä½œå¼€å‘éœ€è¦éµå®ˆåŒä¸€å¥—æœ€ä½³å®è·µæ—¶ï¼Œå°±æ˜¯ä½ è€ƒè™‘ä½¿ç”¨ Redux çš„æ—¶å€™äº†ã€‚</p><h2>Redux çš„å·¥ä½œåŸç†</h2><p>æ²¡æœ‰æ¥è§¦è¿‡ Redux çš„åŒå­¦å¯èƒ½ä¼šé—®ï¼Œâ€œå¬è¯´ Redux ç‰¹åˆ«å¤æ‚ï¼Œæˆ‘ä»¥å‰æ²¡æœ‰å­¦è¿‡ï¼Œèƒ½ç”¨ä¸€å¥è¯ä»‹ç»ä¸€ä¸‹ Redux çš„å·¥ä½œåŸç†å—ï¼Ÿâ€</p><p>Redux çš„æ ¸å¿ƒåŸç†ï¼Œæˆ‘ä»¬ç”¨ä¸€å¥è¯æ¦‚æ‹¬å°±æ˜¯ï¼š<strong>State é©±åŠ¨ View æ›´æ–°ï¼Œç”¨æˆ·æ“ä½œ View è§¦å‘ Action ï¼Œå†é€šè¿‡ Action æ¥æ›´æ–° Stateã€‚</strong></p><p>å¦‚ä½•ç†è§£è¿™å¥è¯ä¸­çš„ Stateã€View å’Œ Action å‘¢ï¼Ÿ</p><p>æˆ‘ç”¨ä¸€ä¸ªæœ€ç®€å•çš„è®¡æ•°ç»„ä»¶æ¥ç»™ä½ ä¸¾ä¾‹å­ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">function Counter() {\n  // State çŠ¶æ€\n  const [counter, setCounter] = useState(0)\n\n  // â€œAction â€ æŒ‡ä»¤\n  const increment = () =&gt; {\n    setCounter(prevCounter =&gt; prevCounter + 1)\n  }\n\n  // View è§†å›¾\n  return (\n    &lt;View&gt;\n        &lt;Text&gt;Value: {counter} &lt;/Text&gt;\n        &lt;Text onPress={increment}&gt;+1&lt;/Text&gt;\n    &lt;/View&gt;\n  )\n}\n</code></pre><p><strong>ä½¿ç”¨ useState ç®¡ç†åº”ç”¨çŠ¶æ€æ—¶ï¼Œæœ‰ä¸‰ä¸ªéƒ¨åˆ†ï¼šStateã€View å’Œæ‰€è°“çš„  â€œActionâ€ã€‚</strong>Stateã€View éƒ¨åˆ†ä½ å·²ç»éå¸¸ç†Ÿæ‚‰äº†ï¼ŒState æ˜¯çŠ¶æ€ï¼ŒView æ˜¯ JSX åˆ›å»ºçš„è§†å›¾ï¼Œä½†æ‰€è°“çš„ \"Action \" æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>â€œActionâ€å¹¶ä¸éš¾ç†è§£ï¼Œåœ¨è®¡æ•°åº”ç”¨ä¸­ï¼Œincrement å‡½æ•°å¯ä»¥ç†è§£ä¸ºâ€œå‡½æ•°å½¢å¼çš„â€çŠ¶æ€æ›´æ–°æŒ‡ä»¤ã€‚increment  å‡½æ•°å†…éƒ¨è°ƒç”¨çš„æ˜¯çŠ¶æ€æ›´æ–°å‡½æ•° setCounterï¼Œç”¨äºæ›´æ–°è§†å›¾ Viewã€‚</p><p><strong>ä½¿ç”¨ Redux ç®¡ç†åº”ç”¨çŠ¶æ€æ—¶ï¼Œä¹Ÿæœ‰ä¸‰éƒ¨åˆ†ï¼šStateã€View å’Œ Actionã€‚</strong> State æ˜¯çŠ¶æ€ï¼ŒView æ˜¯è§†å›¾ï¼ŒAction æ˜¯æ›´æ–°æŒ‡ä»¤ã€‚</p><p>ä¸åŒçš„æ˜¯ï¼ŒuseState ç®¡ç†çš„æ˜¯ç»„ä»¶çŠ¶æ€ï¼ŒRedux ç®¡ç†çš„æ˜¯å…¨å±€çŠ¶æ€ã€‚</p><p><strong>åœ¨ Redux ä¸­ï¼ŒState æ˜¯ä¸€ä¸ªå­˜å‚¨åœ¨å…¨å±€ä¸­çš„å¯¹è±¡ï¼Œç”¨äºæè¿°æ•´ä¸ªåº”ç”¨çš„çŠ¶æ€ï¼š</strong></p><pre><code class=\"language-plain\">{\n    counter: 0\n}\n</code></pre><p>æ˜¯çš„ï¼Œæ²¡é”™ã€‚Redux çŠ¶æ€åªæ˜¯ä¸€ä¸ªæ™®é€šå¯¹è±¡ã€‚å¦‚æœä½ ç”¨ Redux æ¥å®ç°è®¡æ•°åº”ç”¨ï¼Œé‚£ä¹ˆå®ƒçš„çŠ¶æ€å°±æ˜¯ counterï¼ŒçŠ¶æ€çš„é»˜è®¤å€¼æ˜¯ 0ã€‚</p><p>Redux çš„å…¨å±€çŠ¶æ€å¯ä»¥åªæœ‰ä¸€ä¸ªï¼Œä¹Ÿå¯ä»¥æœ‰å¤šä¸ªï¼ŒçŠ¶æ€çš„å€¼æ—¢å¯ä»¥æ˜¯åŸå§‹æ•°æ®ç±»å‹ numberã€string ç­‰ï¼Œä¹Ÿå¯ä»¥æ˜¯æ›´å¤æ‚çš„ objectã€array æ•°æ®ç±»å‹ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ª Todo åº”ç”¨çš„çŠ¶æ€ä¾‹å­ï¼Œå®ƒå°±æœ‰ä¸¤ä¸ªçŠ¶æ€ï¼Œå¹¶ä¸”çŠ¶æ€çš„æ•°æ®ç±»å‹ä¹Ÿæ›´å¤æ‚ï¼š</p><pre><code class=\"language-json\">{\n  todos: [{\n    text: 'Eat food',\n    completed: true\n  }, {\n    text: 'Exercise',\n    completed: false\n  }],\n  visibilityFilter: 'SHOW_COMPLETED'\n}\n</code></pre><p>Todo åº”ç”¨çš„ä¸¤ä¸ªå…¨å±€çŠ¶æ€åˆ†åˆ«æ˜¯todos å’Œ visibilityFilterã€‚todos çŠ¶æ€æ˜¯ array åµŒå¥— object çš„å¤åˆæ•°æ®ç±»å‹ï¼Œè€Œ visibilityFilter æ˜¯ string çš„åŸºæœ¬æ•°æ®ç±»å‹ã€‚</p><p>Redux ä¸­çš„ View ä¹Ÿå°±æ˜¯ JSX è§†å›¾ï¼Œæˆ‘å°±ä¸ç»™ä½ ä¸¾ä¾‹äº†ã€‚æ¥ç€æˆ‘ä»¬å†æ¥äº†è§£ Redux ä¸­ Action ç©¶ç«Ÿæ˜¯ä»€ä¹ˆã€‚</p><p><strong>åœ¨ Redux ä¸­ï¼ŒAction æ˜¯ä¸€ä¸ªåŒ…å« type å­—æ®µçš„å¯¹è±¡ï¼Œç”¨æ¥æè¿°â€œå‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…â€ã€‚</strong>æˆ‘ä»¬ä»¥è®¡æ•°åº”ç”¨çŠ¶æ€çš„ Action ä¸ºä¾‹ï¼š</p><pre><code class=\"language-plain\">{ type: 'COUNT_INCREMENT'}\n</code></pre><p>è¿™é‡Œï¼Œè®¡æ•°åº”ç”¨ â€œ+1â€ çš„æ“ä½œï¼Œè¢«æŠ½è±¡æˆäº†ä¸€ä¸ª type ç­‰äº COUNT_INCREMENT çš„å­—ç¬¦ä¸²æŒ‡ä»¤ã€‚</p><p>ä½†å¦‚æœæ˜¯ä¸€ä¸ªæ›´å¤æ‚çš„ Todo åº”ç”¨ï¼ŒTodo åº”ç”¨å°±è¦å¢åŠ ä¸€ä¸ªå¾…åŠäº‹é¡¹ã€‚å¾…åŠäº‹é¡¹çš„å†…å®¹æ˜¯ç”¨æˆ·è¾“å…¥çš„ï¼Œè¿™è¦æ€ä¹ˆå®ç°å‘¢ï¼ŸRedux æ˜¯å¦‚ä½•çŸ¥é“ç”¨æˆ·è¾“å…¥æ˜¯ â€œ10ç‚¹ä¹°èœâ€ ï¼Œè¿˜æ˜¯ â€œ12ç‚¹åšé¥­â€ çš„å¾…åŠäº‹é¡¹å‘¢ï¼Ÿ</p><p>è¿™å°±éœ€è¦ä¸€ä¸ªå¦å¤–çš„å­—æ®µæ¥æ‰¿è½½å¾…åŠäº‹é¡¹çš„ä¿¡æ¯äº†ï¼Œä¸€ä¸ª TODO åº”ç”¨çš„ Action ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">{ type: 'ADD_TODO', text: '10ç‚¹ä¹°èœ' }\n{ type: 'ADD_TODO', text: '12ç‚¹åšé¥­' }\n{ type: 'TOGGLE_TODO', index: 1 }\n</code></pre><p>ä½ çœ‹ï¼Œè¿™ä¸ªç¤ºä¾‹ä¸­æœ‰ 3 ä¸ª Action ï¼Œå‰ä¸¤ä¸ª Action çš„ type æ˜¯ ADD_TODOï¼Œå°±æ˜¯å¢åŠ å¾…åŠäº‹é¡¹ï¼Œtext æ˜¯ä½ è‡ªå®šä¹‰çš„å‚æ•°åï¼Œå…¶å†…å®¹åˆ†åˆ«æ˜¯ç”¨æˆ·è¾“å…¥çš„å†…å®¹â€œ10ç‚¹ä¹°èœâ€å’Œâ€œ12ç‚¹åšé¥­â€ã€‚ç¬¬ä¸‰ä¸ª Action å°±æ˜¯æ ‡è®°å¾…åŠäº‹é¡¹æ˜¯å¦å®Œæˆçš„ Actionï¼Œå®ƒçš„ type æ˜¯ TOGGLE_TODOï¼Œå®ƒçš„è‡ªå®šä¹‰å‚æ•°åæ˜¯ indexï¼Œè‡ªå®šä¹‰å‚æ•°å€¼æ˜¯æ•°å­— 1ã€‚</p><p>åƒ textã€index è¿™æ ·å­—æ®µï¼Œå¼€å‘è€…å¯ä»¥è‡ªå·±å®šä¹‰ã€‚ä½†æœ‰ä¸€äº›å·¥å…·ï¼Œæ¯”å¦‚åé¢è¦ä»‹ç»çš„ Redux Toolkitï¼Œä¼šç»Ÿä¸€å°†å…¶å®šä¹‰ä¸º payload å­—æ®µï¼Œçœå»äº†å­—æ®µåä¸ç¡®å®šçš„éº»çƒ¦äº‹ã€‚</p><p>é‚£å½“ Redux æ”¶åˆ° Action é€šçŸ¥åï¼Œå¦‚ä½•æ›´æ–°å…¨å±€çŠ¶æ€å‘¢ï¼Ÿè¿™å°±è¦ç”¨åˆ° Reducer äº†ã€‚</p><p><strong>Reducer å°±æ˜¯ä¸€ä¸ªæ™®é€šçš„çŠ¶æ€æ›´æ–°å‡½æ•°ã€‚Redux ä¼šå°†å½“å‰åº”ç”¨çš„çŠ¶æ€ State å’ŒæŒ‡ä»¤ Action ä½œä¸ºå‚æ•°ï¼Œä¼ ç»™ Reducer å‡½æ•°ï¼Œå¹¶æ¥æ”¶ä¸€ä¸ª Reducer è¿”å›çš„ newState ä½œä¸ºæ–°å…¨å±€çŠ¶æ€ã€‚</strong>å‡½æ•°ç¤ºæ„å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">const reducer = (state, action ) =&gt; newState\n</code></pre><p>åœ¨ä¸€ä¸ªç®€å•çš„è®¡æ•°åº”ç”¨ä¸­ï¼ŒReducer å¯ä»¥è¿™æ ·å†™ï¼š</p><pre><code class=\"language-plain\">function increment(state = 0, action) {\n    return state+1\n}\n\nfunction counterApp(state = {}, action) {\n  return {\n    counter: increment(state.counter, action),\n  }\n}\n</code></pre><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼ŒcounterApp å°±æ˜¯ Redux <strong>ç®¡ç†æ‰€æœ‰å…¨å±€çŠ¶æ€çš„å‡½æ•°</strong>ï¼Œincrement å‡½æ•°å°±æ˜¯ä½ <strong>å¤„ç†åˆ†ç‰‡çŠ¶æ€çš„ Reducer å‡½æ•°</strong>ã€‚counterApp å‡½æ•°æ¥æ”¶å½“å‰çŠ¶æ€ state å’Œå‘å‡ºçš„æŒ‡ä»¤ action ä½œä¸ºå‚æ•°ï¼Œå¹¶ä¸”å°†è¿™äº›å‚æ•°ä¼ ç»™ incrementï¼Œç”± increment æ›´æ–°å‡½æ•°æ¥æ›´æ–°çŠ¶æ€ã€‚</p><p>çœ‹åˆ°è¿™å„¿ï¼Œä½ å¯èƒ½ä¼šæƒ³ï¼Œä¸ºä»€ä¹ˆRedux å¤„ç†çŠ¶æ€æ—¶ï¼Œæ—¢è¦æœ‰ç®¡ç†æ‰€æœ‰å…¨å±€çŠ¶æ€çš„å‡½æ•°ã€‚åˆæœ‰å¤„ç†åˆ†ç‰‡çŠ¶æ€çš„ Reducer å‡½æ•°ï¼Œæè¿™ä¹ˆéº»çƒ¦å¹²å˜›ï¼Œç›´æ¥ç”¨ä¸€ä¸ªå‡½æ•°æ¥å¤„ç†ä¸è¡Œå—ï¼Ÿ</p><p>ä¸è¡Œï¼Œå› ä¸ºåœ¨å¤§å‹åº”ç”¨ä¸­ï¼Œç”¨ä¸€ä¸ªå‡½æ•°å¤„ç†ä¸è¿‡æ¥ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªè¾ƒä¸ºå¤æ‚çš„ TODO åº”ç”¨çš„ç¤ºä¾‹ï¼Œä½ å°±æ˜ç™½äº†ï¼š</p><pre><code class=\"language-plain\">function filter(state = 'SHOW_ALL', action) {\n  if (action.type === 'SET_VISIBILITY_FILTER') {\n    return action.filter\n  } else {\n    return state\n  }\n}\n\nfunction todos(state = [], action) {\n  switch (action.type) {\n    case 'ADD_TODO':\n      return state.concat([{ text: action.text, completed: false }])\n    case 'TOGGLE_TODO':\n      return state.map((todo, index) =&gt;\n        action.index === index\n          ? { text: todo.text, completed: !todo.completed }\n          : todo\n      )\n    default:\n      return state\n  }\n}\n\nfunction todoApp(state = {}, action) {\n  return {\n    todosState: todos(state.todos, action),\n    filterState: filter(state.visibilityFilter, action)\n  }\n}\n</code></pre><p>è¿™éƒ¨åˆ†ä»£ç ï¼ŒåŒ…å«ä¸‰ä¸ªå‡½æ•°ï¼Œå…¶ä¸­ todoApp æ˜¯ Redux <strong>ç®¡ç†æ‰€æœ‰å…¨å±€çŠ¶æ€çš„å‡½æ•°</strong>ï¼Œå®ƒç®¡ç†äº† todosState å’Œ filterState ä¸¤ä¸ªå…¨å±€çŠ¶æ€ã€‚å¦å¤–ä¸¤ä¸ª<strong>å¤„ç†åˆ†ç‰‡çŠ¶æ€çš„ Reducer å‡½æ•°</strong> filterã€todos åˆ†åˆ«å¤„ç†äº† todosState  å’Œ filterState å…¨å±€çŠ¶æ€çš„æ“ä½œé€»è¾‘ã€‚</p><p>ä½ çœ‹ï¼Œåœ¨è®¡æ•°åº”ç”¨ä¸­å…¨å±€çŠ¶æ€åªæœ‰ä¸€ä¸ªï¼Œç”¨ä¸€ä¸ªå‡½æ•°æ¥ç®¡ç†æ‰€æœ‰å…¨å±€çŠ¶æ€ï¼Œç”¨å¦ä¸€ä¸ª reduer æ¥ç®¡ç†åˆ†ç‰‡çŠ¶æ€ï¼Œæ˜¾å¾—æœ‰ç‚¹å¤šä½™ã€‚ä½†æ˜¯åœ¨ TodoApp ä¸­ï¼Œæœ‰ä¸¤ä¸ªçŠ¶æ€ï¼Œè€Œä¸”å®ƒçš„çŠ¶æ€å¤„ç†é€»è¾‘æ¯”è¾ƒå¤æ‚ã€‚</p><p>ä¸€ä¸ªåº”ç”¨è¶Šå¤æ‚ï¼Œç®¡ç†çŠ¶æ€çš„é€»è¾‘ä¹Ÿå°±è¶Šå¤æ‚ï¼Œä»£ç é‡å¯ä¸æ­¢å‡ è¡Œã€åå‡ è¡Œï¼Œä¸Šç™¾è¡Œã€ä¸Šåƒè¡Œä¹Ÿæ˜¯å¯èƒ½çš„ï¼Œç”¨ä¸€ä¸ªå‡½æ•°æ¥å¤„ç†æ‰€æœ‰çŠ¶æ€æ˜¯ä¸ç°å®çš„ã€‚æ‰€ä»¥æˆ‘ä»¬æ—¢éœ€è¦ä¸€ä¸ªç®¡ç†æ‰€æœ‰å…¨å±€çŠ¶æ€çš„å‡½æ•°ï¼Œåˆéœ€è¦è‹¥å¹²ä¸ªèƒ½å¤Ÿå¤„ç†åˆ†ç‰‡çŠ¶æ€çš„ Reducer å‡½æ•°ã€‚</p><p>è¿™å°±æ˜¯ Redux æ—¢æœ‰ç®¡ç†æ‰€æœ‰å…¨å±€çŠ¶æ€çš„å‡½æ•°ï¼Œåˆæœ‰å¤„ç†ä¸åŒåˆ†ç‰‡çŠ¶æ€çš„ Reducer å‡½æ•°çš„åŸå› ã€‚</p><p>å®Œæ•´çš„æµç¨‹æ˜¯ï¼Œ<strong>åœ¨åˆå§‹åŒ–æ—¶ï¼ŒRedux é€šè¿‡ Reducer æ¥åˆå§‹åŒ– Stateï¼ŒState é©±åŠ¨ View æ¸²æŸ“ã€‚åœ¨æ›´æ–°çŠ¶æ€æ—¶ï¼Œç”¨æˆ·æ“ä½œ View  è§¦å‘ Actionï¼ŒAction å’Œå½“å‰ State ä¼šè¢«åˆ†å‘ç»™å¤„ç†åˆ†ç‰‡çŠ¶æ€çš„ Reducer å‡½æ•°ï¼Œç”± Reducer å‡½æ•°æ¥æ‰§è¡Œæ›´æ–°é€»è¾‘å’Œè¿”å›æ–°çš„ Stateï¼Œå¹¶æœ€ç»ˆåˆ·æ–° Viewã€‚</strong>è¿™äº›å°±æ˜¯ Redux çš„æ ¸å¿ƒåŸç†ã€‚</p><h2>Redux çš„æœ€ä½³å®è·µ</h2><p>åœ¨äº†è§£å®Œ Redux çš„æ ¸å¿ƒåŸç†åï¼Œæˆ‘ä»¬å†å­¦ä¹  Redux çš„æœ€ä½³å®è·µï¼Œå°±ä¼šè½»æ¾å¾ˆå¤šã€‚</p><p>ç›®å‰ï¼ŒRedux ç¤¾åŒºå’Œå®˜æ–¹å›¢é˜Ÿï¼Œç»å†å¤šå¹´çš„æ¢ç´¢ï¼Œæ…¢æ…¢æ‘¸ç´¢äº†ä¸€å¥—æœ€ä½³å®è·µï¼Œå¹¶ä¸”æŠŠè¿™å¥—æœ€ä½³å®è·µå°è£…åˆ°äº† Redux Toolkit å·¥å…·é›†ä¸­ã€‚ä½¿ç”¨ Redux Toolkit è¿™å¥—æœ€ä½³å®è·µï¼Œä¸ä»…èƒ½å¤Ÿé¿å…å¸¸è§çš„ Redux ä½¿ç”¨è¯¯åŒºï¼Œè¿˜èƒ½å°‘å†™å¾ˆå¤šä»£ç ã€‚</p><p>æ¯”å¦‚ï¼Œåœ¨ä½¿ç”¨ <a href=\"https://redux-toolkit.js.org/\">Redux Toolkit</a> ä¹‹åï¼ŒRedux å®˜æ–¹æä¾›çš„ Todo App çš„ä»£ç ä¸­çš„ todosSlice.js æ–‡ä»¶çš„ä»£ç è¡Œæ•°ï¼Œå°±ç”± <a href=\"https://github.com/reduxjs/redux-fundamentals-example-app/blob/897f4e1efe124c939239e7d9e7a16bef3c42897c/src/features/todos/todosSlice.js\">196 è¡Œ</a>å‡å°‘åˆ° <a href=\"https://github.com/reduxjs/redux-fundamentals-example-app/blob/3ac8804e3d16ddf50cf35d87ded6c10e49c56d44/src/features/todos/todosSlice.js\">131 è¡Œ</a>ï¼Œä»£ç é‡å‡å°‘äº† 33%ã€‚</p><p>Redux Toolkit çš„æœ¬è´¨æ˜¯æä¾›äº†ä¸€äº›<strong>å·¥å…·å‡½æ•°</strong>ï¼Œç®€åŒ–çº¯æ‰‹å†™ Redux ä»£ç çš„å†—ä½™é€»è¾‘ï¼Œå…¶ä¸­æœ€é‡è¦çš„ä¸¤ä¸ªå·¥å…·å‡½æ•°æ˜¯ï¼š</p><ul>\n<li>configureStoreï¼šç®¡ç†æ‰€æœ‰å…¨å±€çŠ¶æ€çš„å‡½æ•°ï¼Œå®ƒçš„è¿”å›å€¼æ˜¯ä¸€ä¸ª Store å¯¹è±¡ï¼›</li>\n<li>createSliceï¼šç®¡ç†åˆ†ç‰‡å…¨å±€çŠ¶æ€çš„å‡½æ•°ï¼Œå…¶è¿”å›å€¼æ˜¯ä¸€ä¸ªåˆ†ç‰‡å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¸Šæœ€é‡è¦çš„ä¸¤ä¸ªå±æ€§æ˜¯ï¼š\n<ul>\n<li>actionsï¼šåˆ›å»ºåˆ†ç‰‡ action çš„å‡½æ•°é›†åˆï¼›</li>\n<li>reducerï¼šå·²ç»åˆ›å»ºå¥½çš„åˆ†ç‰‡ reducerã€‚</li>\n</ul>\n</li>\n</ul><p>å¦å¤–ï¼ŒRedux è¿˜æœ‰ä¸€ä¸ªä¸“é—¨çš„ <a href=\"https://react-redux.js.org/api/hooks\">React Redux åº“</a> ï¼Œè¿™ä¸ªåº“ä¸»è¦ä¸º React/React Native åº”ç”¨æä¾›äº† 1 ä¸ªç»„ä»¶å’Œ 2 ä¸ªå¸¸ç”¨çš„é’©å­å‡½æ•°ï¼š</p><ul>\n<li>Providerï¼šProvider æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œè¯¥ç»„ä»¶æ¥æ”¶å­˜å‚¨æ‰€æœ‰å…¨å±€çŠ¶æ€çš„ Store å¯¹è±¡ä½œä¸ºå‚æ•°ã€‚Provider ç»„ä»¶åº•å±‚ç”¨çš„æ˜¯ useContextï¼Œå®ƒä¸ºæ•´ä¸ªåº”ç”¨çš„å…¶ä»–ç»„ä»¶æä¾›è·å– Store å¯¹è±¡çš„èƒ½åŠ›ï¼›</li>\n<li>useSelectorï¼šä» Store ä¸­è·å–å½“å‰ç»„ä»¶éœ€è¦ç”¨åˆ°çš„çŠ¶æ€ï¼›</li>\n<li>useDispatchï¼šç”¨äºå‘é€æŒ‡ä»¤çš„é’©å­å‡½æ•°ï¼Œå…¶è¿”å›å€¼æ˜¯ dispatch å‡½æ•°ï¼Œè€Œ dispatch å‡½æ•°çš„å…¥å‚æ˜¯ actionã€‚</li>\n</ul><p><strong>ç›®å‰ï¼Œä½¿ç”¨ Redux å¼€å‘ React Native åº”ç”¨çš„æœ€ä½³å®è·µï¼Œå°±æ˜¯åŒæ—¶ä½¿ç”¨ Redux Toolkit å’Œ React Reduxï¼Œå®ç°å…¨å±€çŠ¶æ€ç®¡ç†ã€‚</strong></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä»¥è®¡æ•°åº”ç”¨å’Œ Todo åº”ç”¨ä¸ºä¾‹ï¼Œå­¦ä¹ å¦‚ä½•ä½¿ç”¨ Redux Toolkit å’Œ React Reduxã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦å¼•å…¥ç›¸å…³çš„å·¥å…·å‡½æ•°ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">import {configureStore, createSlice } from '@reduxjs/toolkit';\nimport {Provider, useSelector, useDispatch } from 'react-redux';\n</code></pre><p>è¿™é‡Œï¼Œæˆ‘ä»¬åˆ†åˆ«ä» â€˜@reduxjs/toolkitâ€™ å’Œ â€˜react-reduxâ€™ ä¸­å¼•å…¥äº†configureStoreã€createSliceã€Providerã€useSelectorã€useDispatchã€‚<br>\né‚£å¦‚ä½•ä½¿ç”¨å®ƒä»¬æ¥ç®¡ç†åº”ç”¨çŠ¶æ€å‘¢ï¼Ÿæ•´ä¸ªè¿‡ç¨‹å¤§è‡´åˆ†ä¸º 5 æ­¥ï¼š</p><ol>\n<li>ä½¿ç”¨ Provider ç»„ä»¶å‘åº”ç”¨çš„å…¶ä»–ç»„ä»¶æä¾›è·å– Store çš„èƒ½åŠ›ï¼›</li>\n<li>ä½¿ç”¨ configureStore å‡½æ•°åˆ›å»º Storeï¼›</li>\n<li>ä½¿ç”¨ createSlice å‡½æ•°åˆ›å»ºåˆ†ç‰‡ï¼›</li>\n<li>ä½¿ç”¨ useSelector è·å–åˆ†ç‰‡ Stateï¼›</li>\n<li>ä½¿ç”¨ useDispatch ç”Ÿæˆçš„ dispatch æ¥å‘é€ actionã€‚</li>\n</ol><p><strong>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹å¦‚ä½•ä½¿ç”¨ Provider ç»„ä»¶å‘å…¶ä»–ç»„ä»¶æä¾›è·å– Store çš„èƒ½åŠ›ã€‚</strong></p><p>ä¸€èˆ¬è€Œè¨€ï¼ŒProvider ç»„ä»¶é€šå¸¸æ˜¯æœ€é¡¶å±‚çš„ç»„ä»¶ï¼Œå®ƒåŒ…è£¹ä½äº†æ•´ä¸ªåº”ç”¨ã€‚ä»¥è®¡æ•°åº”ç”¨ä¸ºä¾‹ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">const store = ...\n\n// è®¡æ•°åº”ç”¨\nfunction CounterApp(){}\n\n// æ ¹ç»„ä»¶\nexport default function Root() {\n  return (\n    &lt;Provider store={store}&gt;\n      &lt;CounterApp /&gt;\n    &lt;/Provider&gt;\n  );\n}\n\nAppRegistry.registerComponent('App', () =&gt; Root);\n</code></pre><p>ä½ çœ‹ï¼ŒRoot æ˜¯æ•´ä¸ªåº”ç”¨çš„æ ¹ç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶ä½¿ç”¨äº† Provider åŒ…è£¹ä½ä»£è¡¨è®¡æ•°åº”ç”¨çš„ CounterApp ç»„ä»¶ï¼Œå¹¶ä¸” Provider  æ¥æ”¶äº† store ä½œä¸ºå‚æ•°ï¼Œå› æ­¤ CounterApp ç»„ä»¶åŠå…¶æ‰€æœ‰çš„å­ç»„ä»¶éƒ½èƒ½ä» store ä¸­è·å–ä»»æ„çš„å…¨å±€çŠ¶æ€ã€‚</p><p>é‚£å­˜å‚¨å…¨å±€çŠ¶æ€çš„å¯¹è±¡ store æ˜¯å¦‚ä½•åˆ›é€ çš„å‘¢ï¼Ÿ<strong>è¿™å°±åˆ°äº†ç¬¬äºŒæ­¥ï¼Œåˆ›å»º store ç”¨åˆ°çš„å‡½æ•°æ˜¯ configureStoreã€‚</strong></p><p>ä½¿ç”¨ configureStore å‡½æ•°åˆ›å»º store çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">const counterSlice = ...\n\nconst store = configureStore({\n  reducer: {\n    counter: counterSlice.reducer,\n  }\n});\n\nconsole.log(store.getState()) // { counter }\n</code></pre><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä½¿ç”¨äº† configureStore å‡½æ•°æ¥åˆ›å»º store å¯¹è±¡ã€‚configureStore å‡½æ•°çš„å…¥å‚ä¸­æœ€å…³é”®çš„å¯¹è±¡å±æ€§æ˜¯ reducer å±æ€§ã€‚åœ¨è®¡æ•°åº”ç”¨ä¸­ï¼ŒconfigureStore å…¥å‚çš„ reducer çš„ç»“æ„æ˜¯ { counter }ï¼Œé‚£ä¹ˆ configureStore è¿”å›å€¼ store å¯¹è±¡çš„ç»“æ„ä¹Ÿæ˜¯  { counter }ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œè®¡æ•°åº”ç”¨å­˜åœ¨ä¸€ä¸ªå…¨å±€çŠ¶æ€ counterã€‚</p><p>ä½ ä¹Ÿå¯ä»¥æ ¹æ®ä¸åŒçš„æƒ…å†µï¼Œåˆ›å»ºä¸åŒçš„ store å¯¹è±¡ã€‚æ¯”å¦‚ Todo åº”ç”¨ä½ å¯ä»¥è¿™ä¹ˆåˆ›å»ºï¼š</p><pre><code class=\"language-plain\">const todosSlice  = ...\nconst filtersSlice = ...\n\nconst store = configureStore({\n  reducer: {\n    todosState: todosSlice.reducer,\n    filterState: filtersSlice.reducer,\n  },\n})\n\nconsole.log(store.getState()) // { todos, filters }\n</code></pre><p>åœ¨ Todo åº”ç”¨ä¸­ï¼ŒconfigureStore å…¥å‚çš„ reducer çš„ç»“æ„æ˜¯ { todos, filters }ï¼Œé‚£ä¹ˆ store å¯¹è±¡çš„ç»“æ„ä¹Ÿæ˜¯ { todos, filters }ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒTodo åº”ç”¨å­˜åœ¨ä¸¤ä¸ªå…¨å±€çŠ¶æ€ï¼Œåˆ†åˆ«æ˜¯ todos å’Œ filtersã€‚</p><p>åœ¨ Redux ä¸­ï¼Œåˆ†ç‰‡ state æ˜¯é€šè¿‡åˆ†ç‰‡ reducer ç”Ÿæˆçš„ã€‚åœ¨è®¡æ•°åº”ç”¨ä¸­ï¼Œåˆ†ç‰‡æ˜¯ counterSliceï¼Œåˆ†ç‰‡çŠ¶æ€ counter æ˜¯é€šè¿‡ counterSlice.reducer åˆ›å»ºçš„ï¼›åœ¨ Todo åº”ç”¨ä¸­ï¼Œåˆ†ç‰‡æ˜¯ todosSlice å’Œ filtersSliceï¼Œåˆ†ç‰‡çŠ¶æ€ todosState å’Œ filterState æ˜¯é€šè¿‡ todosSlice.reducer å’Œ filtersSlice.reducer åˆ›å»ºçš„ã€‚</p><p>å› æ­¤ï¼Œæ¥ä¸‹æ¥ä½ éœ€è¦å…³æ³¨çš„æ˜¯å¦‚ä½•åˆ›å»ºåˆ†ç‰‡ã€‚é‚£ä¹ˆå¦‚ä½•åˆ›å»ºåˆ†ç‰‡å‘¢ï¼Ÿ<strong>è¿™å°±æ˜¯ç¬¬ä¸‰æ­¥çš„ä»»åŠ¡ï¼Œåˆ›å»ºåˆ†ç‰‡ç”¨åˆ°çš„å‡½æ•°æ˜¯ createSliceã€‚</strong></p><p>ä½¿ç”¨ createSlice å‡½æ•°åˆ›å»ºåˆ†ç‰‡çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">const initialState = {\n  value: 0,\n};\n\nconst counterSlice = createSlice({\n  name: 'counter',\n  initialState,\n  reducers: {\n    increment: (state, action) =&gt; {\n      // å¯ä»¥ç›´æ¥ä¿®æ”¹çš„â€œçŠ¶æ€â€\n      state.value += action.payload;\n    },\n  },\n});\n\nconsole.log(counterSlice.actions.increment(1)) \n// {\"payload\": 1, \"type\": \"counter/increment\"}\n\nconsole.log(counterSlice.reducer) \n/*\nfunction reducer(state, action) {\n  if (!_reducer) _reducer = buildReducer();\n  return _reducer(state, action);\n}\n*/\n</code></pre><p>åˆ›å»ºåˆ†ç‰‡éœ€è¦ä¸‰ä¸ªå‚æ•°ï¼š</p><ul>\n<li>nameï¼šåˆ†ç‰‡çš„åå­—ï¼Œå­—ç¬¦ä¸²ç±»å‹ã€‚ç¤ºä¾‹ä¸­æ˜¯ â€œcounterâ€ å­—ç¬¦ä¸²ï¼›</li>\n<li>initialStateï¼šåˆ†ç‰‡çš„åˆå§‹åŒ–çŠ¶æ€ã€‚ç¤ºä¾‹ä¸­æ˜¯ { value: 0 } çš„å¯¹è±¡ï¼›</li>\n<li>reducersï¼šå¯¹è±¡ç±»å‹ï¼Œç”¨äºåˆ›å»ºåˆ†ç‰‡ action å’Œåˆ†ç‰‡ reducerã€‚</li>\n</ul><p><strong>createSlice å‡½æ•°ä¼šè‡ªåŠ¨ç”Ÿæˆåˆ†ç‰‡ action creators å’Œåˆ†ç‰‡ reducerï¼Œ</strong> å¹¶å°†è¿™ä¸¤ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„å€¼æŒ‚åœ¨å…¶è¿”å›å¯¹è±¡ counterSlice çš„ actions å±æ€§å’Œ reducer å±æ€§ä¸Šã€‚</p><p>é‚£æ€æ ·éªŒè¯createSlice å‡½æ•°ç¡®å®å¸®ä½ åˆ›å»ºäº†åˆ†ç‰‡ action creators å’Œåˆ†ç‰‡ reducer å‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æ‰“å° counterSlice.actions.increment(1)æ¥æ£€éªŒã€‚actions.increment æ˜¯åˆ›å»º increment action çš„å‡½æ•°ï¼Œæ‰“å°çš„ç»“æœæ˜¯  { â€œtypeâ€: â€œcounter/incrementâ€, â€œpayloadâ€: 1}ã€‚å…¶ä¸­ï¼Œâ€œtypeâ€ å­—æ®µæ˜¯åˆ†ç‰‡ action çš„å¿…ä¼ å­—æ®µï¼Œâ€œtypeâ€ çš„å€¼ç”±åˆ†ç‰‡åå­— â€œcounterâ€ å’Œ reducers å¯¹è±¡çš„é”®å â€œincrementâ€ å…±åŒç»„æˆã€‚â€œpayloadâ€ å­—æ®µæ˜¯ä¸“é—¨ç”¨äºä¼ å‚çš„å­—æ®µï¼Œå…¶å‚æ•°æ¥æºäº actions.increment åˆ›å»ºå‡½æ•°çš„ç¬¬ä¸€ä¸ªå…¥å‚ï¼Œä¹Ÿå°±æ˜¯æ•°å­— 1ã€‚</p><p>ä½ ä¹Ÿå¯ä»¥æ‰“å° counterSlice.reducerï¼Œå®ƒå†…éƒ¨æ˜¯ä¸€ä¸ªç”± Redux å¸®æˆ‘ä»¬ç”Ÿæˆçš„ _reducer å‡½æ•°ã€‚</p><p>åœ¨å®Œæˆä»¥ä¸Šä¸‰æ­¥åï¼Œåº”ç”¨ä¸­çš„ç»„ä»¶å°±èƒ½å¤Ÿä½¿ç”¨åˆ†ç‰‡ State å’Œåˆ†ç‰‡ Action æ¥å±•ç¤ºå’Œæ”¹å˜ UI è§†å›¾äº†ã€‚</p><p><strong>é‚£æ¥ç€æ–°çš„é—®é¢˜å°±æ¥äº†ï¼šç»„ä»¶è¯¥å¦‚ä½•è·å–å’Œä½¿ç”¨åˆ†ç‰‡ State å’Œåˆ†ç‰‡ Action å‘¢ï¼Ÿ</strong></p><p>è¿™å°±æ˜¯æœ€åç¬¬å››æ­¥å’Œç¬¬äº”æ­¥çš„ä»»åŠ¡ï¼Œè¿™ä¸¤æ­¥éƒ½æ˜¯åœ¨å…·ä½“ç»„ä»¶ä¸­è¿›è¡Œçš„ï¼Œæˆ‘ä»¬æ”¾åœ¨ä¸€èµ·çœ‹å°±å¥½ï¼Œç»„ä»¶çš„ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">function CounterApp() {\n  const counter = useSelector((state) =&gt; state.counter.value);\n\n  const dispatch = useDispatch();\n\n  const handlePress = () =&gt; {\n    dispatch(counterSlice.actions.increment(10));\n  };\n\n  return (\n      &lt;View style={styles.box}&gt;\n        &lt;Text&gt;{counter}&lt;/Text&gt;\n        &lt;Text onPress={handlePress}&gt;+10&lt;/Text&gt;\n      &lt;/View&gt;\n  );\n}\n</code></pre><p>åœ¨ CounterApp ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆä½¿ç”¨ useSelector è·å–çŠ¶æ€ï¼Œç„¶åå†ä½¿ç”¨ useDispatch è·å– dispatch å‡½æ•°ï¼Œå¹¶ä¸”åœ¨å¯¹åº”æ—¶æœºè°ƒç”¨ dispatch(action) å‘é€æŒ‡ä»¤ã€‚</p><p>å…¶ä¸­ï¼Œ<strong>useSelector çš„ä¸»è¦ä½œç”¨æ˜¯æŒ‰éœ€è·å–çŠ¶æ€ã€‚</strong>è™½ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ store.getState() è·å–æ‰€æœ‰çŠ¶æ€ï¼Œä½†è·å–æ‰€æœ‰å…¨å±€çŠ¶æ€ä¼šæœ‰ä¸€ä¸ªå¼Šç«¯ï¼Œé‚£å°±æ˜¯åªè¦ä»»ä½•ä¸€ä¸ªå…¨å±€çŠ¶æ€å‘ç”Ÿäº†æ”¹å˜ï¼Œè¯¥ç»„ä»¶å°±ä¼š re-renderï¼Œè¿™å®¹æ˜“å¯¼è‡´åº”ç”¨æ€§èƒ½å˜å·®ã€‚å› æ­¤ï¼Œä½ éœ€è¦ useSelector å¸®ä½ ä» store ä¸­æŒ‰éœ€è·å–çŠ¶æ€ã€‚</p><p>useSelector çš„å…¥å‚æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä½ å¯ä»¥é€šè¿‡è¿™ä¸ªå‡½æ•°ä»æ‰€æœ‰ state ä¸­é€‰æ‹©è¯¥ç»„ä»¶ä¸­ç”¨åˆ°çš„ stateã€‚åœ¨è¿™ä¸ªè®¡æ•°ç»„ä»¶ä¸­ï¼Œåªç”¨åˆ°äº† state.counter.valueï¼Œå› æ­¤è¿™ä¸ªå‡½æ•°åªç”¨è¿”å› state.counter.value ä½œä¸ºçŠ¶æ€å°±å¯ä»¥äº†ã€‚</p><p>å› æ­¤ï¼Œåœ¨ä¸Šè¿°è®¡æ•°åº”ç”¨çš„åˆå§‹åŒ–æ—¶ï¼Œé»˜è®¤çš„è®¡æ•°å€¼æ˜¯ 0ï¼Œæ¯å½“ä½ ç‚¹å‡»ä¸€æ¬¡ â€œ+10â€ æŒ‰é’®æ—¶ï¼Œå°±ä¼šè§¦å‘ action æŒ‡ä»¤ï¼Œå°†è®¡æ•°å€¼ â€œ+10â€ã€‚</p><p>æˆ‘æŠŠå®Œæ•´çš„ä»£ç æ”¾åœ¨äº†è¿™é‡Œï¼Œä½ å¯ä»¥ä»”ç»†çœ‹ä¸‹ï¼š</p><pre><code class=\"language-plain\">import React  from 'react';\nimport {View, Text, StyleSheet} from 'react-native';\nimport {\n  useSelector,\n  useDispatch,\n  Provider,\n  TypedUseSelectorHook,\n} from 'react-redux';\nimport {configureStore, createSlice, PayloadAction} from '@reduxjs/toolkit';\n\ninterface CounterState {\n  value: number;\n}\n\nconst initialState: CounterState = {\n  value: 0,\n};\n\nconst counterSlice = createSlice({\n  name: 'counter',\n  initialState,\n  // Reducer\n  reducers: {\n    increment: (state, action) =&gt; {\n      state.value += action.payload;\n    },\n  },\n});\n\n// Store\nconst store = configureStore({\n  reducer: {\n    counter: counterSlice.reducer,\n  },\n});\n\nfunction CounterApp() {\n  // State\n  const counter = useSelector((state) =&gt; state.counter.value);\n\n  const dispatch = useDispatch();\n\n  // Event Hanlder\n  const handlePress = () =&gt; {\n    // Action\n    const action = counterSlice.actions.increment(10);\n    // dispatch\n    dispatch(action);\n  };\n\n  // View/UI\n  return (\n      &lt;View &gt;\n        &lt;Text&gt;{counter}&lt;/Text&gt;\n        {/* click event: deposit */}\n        &lt;Text onPress={handlePress}&gt;+10&lt;/Text&gt;\n      &lt;/View&gt;\n  );\n}\n\nexport default function Root() {\n  return (\n    &lt;Provider store={store}&gt;\n      &lt;CounterApp /&gt;\n    &lt;/Provider&gt;\n  );\n}\n</code></pre><p>åœ¨è¿™æ®µå®Œæ•´ä»£ç ä¸­ï¼Œæˆ‘å¸®ä½ æŠŠ Redux ä¸­çš„å…³é”®æ¦‚å¿µéƒ½æ ‡è®°å‡ºæ¥äº†ã€‚Redux ä¸­çš„æ¦‚å¿µæ¯”è¾ƒå¤šï¼ŒåŒ…æ‹¬ Storeã€Reducerã€Stateã€UIã€Event Handleã€Dispatchã€Actionã€‚åœ¨çœ‹è®¡æ•°åº”ç”¨çš„å®ç°ä»£ç çš„åŒæ—¶ï¼Œä½ ä¹Ÿå¯ä»¥ç»“åˆ Redux å®˜æ–¹æä¾›çš„åŸç†å›¾ï¼ŒæŠŠä½¿ç”¨ Redux çš„æœ€ä½³å®ç°å’ŒåŸç†ç»“åˆåœ¨ä¸€èµ·ç†è§£ï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/c9/c4/c98922b5a476e12b853576324f12f5c4.gif?wh=1440x1080\" alt=\"å›¾ç‰‡\"></p><h2>é™„åŠ ææ–™</h2><ul>\n<li>ä¸‰ä¸ªå®˜ç½‘ï¼š<a href=\"https://redux.js.org/\">Redux</a>ã€<a href=\"https://redux-toolkit.js.org/\">Redux Toolkit</a>ã€<a href=\"https://react-redux.js.org/\">React Redux</a>ã€‚</li>\n<li>è¿™ä¸€è®²æä¾›çš„æ˜¯ç®€ç‰ˆçš„æœ€ä½³å®è·µï¼Œå®˜ç½‘å®Œæ•´çš„æœ€ä½³å®è·µè§ <a href=\"https://redux.js.org/style-guide/\">ã€ŠRedux Style Guideã€‹</a>ã€‚</li>\n<li>ç®€ç‰ˆæœ€ä½³å®ç°çš„è®¡æ•°åº”ç”¨ <a href=\"https://github.com/jiangleo/react-native-classroom/blob/main/src/19_Redux/03_ToolkitCounter/index.tsx\">Demo</a>ã€‚</li>\n<li>å®Œæ•´æœ€ä½³å®è·µçš„è®¡æ•°åº”ç”¨ <a href=\"https://github.com/jiangleo/react-native-classroom/tree/main/src/19_Redux/04_CounterApp\">Demo</a>ã€‚</li>\n<li>å®Œæ•´æœ€ä½³å®è·µçš„ Todo åº”ç”¨ <a href=\"https://github.com/jiangleo/react-native-classroom/tree/main/src/19_Redux/05_TodoApp\">Demo</a>ã€‚</li>\n</ul><h2>æ€»ç»“</h2><p>è¿™ä¸€è®²ï¼Œæˆ‘å’Œä½ ä»‹ç»äº†ä¸‰ä¸ªé‡ç‚¹ï¼Œåˆ†åˆ«æ˜¯ Redux ä»€ä¹ˆæ—¶å€™ç”¨ã€Redux çš„å·¥ä½œåŸç†å’Œ Redux çš„æœ€ä½³å®è·µã€‚</p><p>ä¸è¿‡ï¼ŒRedux å¹¶ä¸æ˜¯ä¸‡èƒ½è¯ï¼Œå®ƒåªé€‚åˆå¤æ‚æˆ–å¤§å‹åº”ç”¨çš„å…¨å±€çŠ¶æ€ç®¡ç†ï¼Œåœ¨ç®€å•æˆ–å°å‹åº”ç”¨ä¸­ä½¿ç”¨ Reduxï¼Œå°±åƒå¤§ç‚®æ‰“è‹è‡å¤§æå°ç”¨ã€‚</p><p>è™½ç„¶ä½¿ç”¨ Redux æ¥ç®¡ç†çŠ¶æ€éœ€è¦ 5 ä¸ªæ­¥éª¤ï¼Œæ¯”ä½¿ç”¨ useState çš„  3 ä¸ªæ­¥éª¤å¤šäº†ä¸¤ä¸ªæ­¥éª¤ã€‚ä½†ä½¿ç”¨ Redux æ¥ç®¡ç†å…¨å±€çŠ¶æ€æœ‰å¾ˆå¤šå¥½å¤„ï¼Œæ¯”å¦‚å®ƒèƒ½æé«˜ä½ åº”ç”¨çš„å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œè€Œè¿™äº›ç‰¹æ€§æ­£æ˜¯å¤æ‚é¡¹ç›®ã€å¤§å‹é¡¹ç›®æ‰€éœ€è¦çš„ã€‚</p><p>ä½†å¯¹äºä¸€ä¸ªå¤§å‹é¡¹ç›®è€Œè¨€ï¼ŒRedux å¹¶ä¸æ˜¯å”¯ä¸€çŠ¶æ€ç®¡ç†æ–¹æ¡ˆï¼Œé€šå¸¸æˆ‘è¿˜ä¼šå°† Redux å’Œ useStateã€ReactQuery æ­é…èµ·æ¥ä½¿ç”¨ã€‚æˆ‘æ›´å–œæ¬¢ä½¿ç”¨ useState æ¥ç®¡ç†ç»„ä»¶çŠ¶æ€ï¼Œä½¿ç”¨ Redux æ¥ç®¡ç†å…¨å±€çŠ¶æ€ï¼Œä½¿ç”¨ ReactQuery æ¥ç®¡ç†å¼‚æ­¥çŠ¶æ€ã€‚</p><h2>ä½œä¸š</h2><p>React/React Native ç”Ÿæ€ä¸­ï¼ŒçŠ¶æ€ç®¡ç†å·¥å…·å¯è°“æ˜¯ç™¾å®¶äº‰é¸£ï¼Œé‚£ä½ é€‰æ‹©çš„æ–¹æ¡ˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºå’Œæˆ‘åˆ†äº«ä½ çš„ç­”æ¡ˆã€‚æˆ‘ä»¬ä¸‹ä¸€è®²è§ã€‚</p>","neighbors":{"left":{"article_title":"18ï½œNavigationï¼šé¡µé¢ä¹‹é—´æ€ä¹ˆè·³è½¬ï¼Ÿ","id":516300},"right":{"article_title":"20ï½œSentryï¼šçº¿ä¸Šé”™è¯¯ä¸æ€§èƒ½ç›‘æ§æ€ä¹ˆå¤„ç†ï¼Ÿ","id":518009}},"comments":[{"had_liked":false,"id":360099,"user_name":"æµ·ç»µè±¹è±¹","can_delete":false,"product_type":"c1","uid":2707541,"ip_address":"å±±ä¸œ","ucode":"8B20A2CC021D16","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epfMaQHtCXaQkepugPQb4P9GYdPQzo6LiahxosVPtjjg8hKhcq1d9PTnODZQ6STa1XqxFvVHjJvhfw/132","comment_is_top":false,"comment_ctime":1666174323,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1666174323","product_id":100110101,"comment_content":"ç”¨FBçš„Recoilå§, Reduxå¤ªå•°å—¦äº†è€Œä¸”å¿ƒæ™ºè´Ÿæ‹…è¾ƒé«˜","like_count":0},{"had_liked":false,"id":348685,"user_name":"abcğŸ™‚","can_delete":false,"product_type":"c1","uid":1887261,"ip_address":"","ucode":"FCF2B9091D161B","user_header":"https://static001.geekbang.org/account/avatar/00/1c/cc/1d/3c0272a1.jpg","comment_is_top":false,"comment_ctime":1655302858,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1655302858","product_id":100110101,"comment_content":"èƒ½ä¸èƒ½è®²è®²å…¨å±€çŠ¶æ€çš„åœºæ™¯ï¼Œæ„Ÿè§‰å¾ˆå¤šæƒ…å†µä¸éœ€è¦redux","like_count":0,"discussions":[{"author":{"id":2107468,"avatar":"https://static001.geekbang.org/account/avatar/00/20/28/4c/afe2ab34.jpg","nickname":"äº‘","note":"","ucode":"705DF6B2A7654B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":581508,"discussion_content":"åŒä¸Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658820431,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345670,"user_name":"python4","can_delete":false,"product_type":"c1","uid":1023327,"ip_address":"","ucode":"BFEE720743B53E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9d/5f/06671a0d.jpg","comment_is_top":false,"comment_ctime":1652501258,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652501258","product_id":100110101,"comment_content":"å‡½æ•°å‘½åä¸ŠåŠ ä¸€ç‚¹reduxæ¦‚å¿µæ˜¯å¦æ›´å¥½, æ–¹ä¾¿æ–°æ‰‹ç‰¢è®°æ¦‚å¿µ, æ¯”å¦‚: filter -&gt; filterReducer","like_count":0}]}