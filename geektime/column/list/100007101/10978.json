{"id":10978,"title":"ç¬¬26è®² | äº‘ä¸­çš„ç½‘ç»œå®‰å…¨ï¼šè™½ç„¶ä¸æ˜¯åœŸè±ªï¼Œä¹Ÿéœ€è¦åŸºæœ¬å®‰å…¨å’Œä¿éšœ","content":"<p>åœ¨ä»Šå¤©çš„å†…å®¹å¼€å§‹ä¹‹å‰ï¼Œæˆ‘å…ˆå–ä¸ªå…³å­ã€‚æ–‡ç« ç»“å°¾ï¼Œæˆ‘ä¼šæ”¾ä¸€ä¸ª<span class=\"orange\">è¶…çº§å½©è›‹</span>ï¼Œæ‰€ä»¥ï¼Œä»Šå¤©çš„å†…å®¹ä½ ä¸€å®šè¦çœ‹åˆ°æœ€åå“¦ï¼</p><p>ä¸Šä¸€èŠ‚æˆ‘ä»¬çœ‹åˆ°ï¼Œåšä¸€ä¸ªå°åŒºç‰©ä¸šç»´æŠ¤ä¸€ä¸ªå¤§å®¶å…±äº«çš„ç¯å¢ƒï¼Œè¿˜æ˜¯æŒºä¸å®¹æ˜“çš„ã€‚å¦‚æœéƒ½æ˜¯è‡ªè§‰éµå®ˆè§„åˆ™çš„ä½æˆ·é‚£è¿˜å¥½ï¼Œå¦‚æœé‡ä¸Šä¸è‡ªè§‰çš„ä½æˆ·å°±ä¼šå¾ˆéº»çƒ¦ã€‚</p><p>å°±åƒå…¬æœ‰äº‘çš„ç¯å¢ƒï¼Œå…¶å®æ²¡æœ‰ä½ æƒ³çš„é‚£ä¹ˆçº¯å‡€ï¼Œå„æ€€é¬¼èƒçš„é»‘å®¢åˆ°å¤„éƒ½æ˜¯ã€‚æ‰«æä½ çš„ç«¯å£å‘€ï¼Œæ¢æµ‹ä¸€ä¸‹ä½ å¯åŠ¨çš„ä»€ä¹ˆåº”ç”¨å•Šï¼Œçœ‹ä¸€çœ‹æ˜¯å¦æœ‰å„ç§æ¼æ´å•Šã€‚è¿™å°±åƒå°å·æ½œå…¥å°åŒºåï¼Œè¿™å„¿çœ‹çœ‹ï¼Œé‚£å„¿ç§ç§ï¼Œçª—æˆ·æœ‰æ²¡æœ‰å…³ä¸¥äº†å•Šï¼Œçª—å¸˜æœ‰æ²¡æœ‰æ‹‰ä¸Šå•Šï¼Œä¸»äººç¡äº†æ²¡ï¼Œæ˜¯ä¸æ˜¯æ—¶æœºæ½œå…¥å®¤å†…å•Šï¼Œç­‰ç­‰ã€‚</p><p>å‡å¦‚ä½ åˆ›å»ºäº†ä¸€å°è™šæ‹Ÿæœºï¼Œé‡Œé¢æ˜æ˜è·‘äº†ä¸€ä¸ªç”µå•†åº”ç”¨ï¼Œè¿™æ˜¯ä½ éå¸¸é‡è¦çš„ä¸€ä¸ªåº”ç”¨ï¼Œä½ ä¼šæŠŠå®ƒè¿›è¡Œå®‰å…¨åŠ å›ºã€‚è¿™å°è™šæ‹Ÿæœºçš„æ“ä½œç³»ç»Ÿé‡Œï¼Œä¸å°å¿ƒå®‰è£…äº†å¦å¤–ä¸€ä¸ªåå°åº”ç”¨ï¼Œç›‘å¬ç€ä¸€ä¸ªç«¯å£ï¼Œè€Œä½ çš„è­¦è§‰æ€§æ²¡æœ‰è¿™ä¹ˆé«˜ã€‚</p><p>è™šæ‹Ÿæœºçš„è¿™ä¸ªç«¯å£æ˜¯å¯¹ç€å…¬ç½‘å¼€æ”¾çš„ï¼Œç¢°å·§è¿™ä¸ªåå°åº”ç”¨æœ¬èº«æ˜¯æœ‰æ¼æ´çš„ï¼Œé»‘å®¢å°±å¯ä»¥æ‰«æåˆ°è¿™ä¸ªç«¯å£ï¼Œç„¶åé€šè¿‡è¿™ä¸ªåå°åº”ç”¨çš„ç«¯å£ä¾µå…¥ä½ çš„æœºå™¨ï¼Œå°†ä½ åŠ å›ºå¥½çš„ç”µå•†ç½‘ç«™é»‘æ‰ã€‚è¿™å°±åƒä½ ä¹°äº†ä¸€ä¸ªäº”æ˜Ÿçº§çš„é˜²ç›—é—¨ï¼Œå¡è½¦éƒ½æ’ä¸å¼€ï¼Œä½†æ˜¯å•æ‰€çª—æˆ·çš„é—¨æŠŠæ‰‹æ˜¯åçš„ï¼Œå°å·ä»å•æ‰€é‡Œé¢å°±è¿›æ¥äº†ã€‚</p><p>æ‰€ä»¥<strong>å¯¹äºå…¬æœ‰äº‘ä¸Šçš„è™šæ‹Ÿæœºï¼Œæˆ‘çš„å»ºè®®æ˜¯ä»…ä»…å¼€æ”¾éœ€è¦çš„ç«¯å£ï¼Œè€Œå°†å…¶ä»–çš„ç«¯å£ä¸€æ¦‚å…³é—­ã€‚è¿™ä¸ªæ—¶å€™ï¼Œä½ åªè¦é€šè¿‡å®‰å…¨æªæ–½å®ˆæŠ¤å¥½è¿™ä¸ªå”¯ä¸€çš„å…¥å£å°±å¯ä»¥äº†</strong>ã€‚é‡‡ç”¨çš„æ–¹å¼å¸¸å¸¸æ˜¯ç”¨<strong>ACL</strong>ï¼ˆAccess Control Listï¼Œè®¿é—®æ§åˆ¶åˆ—è¡¨ï¼‰æ¥æ§åˆ¶IPå’Œç«¯å£ã€‚</p><!-- [[[read_end]]] --><p>è®¾ç½®å¥½äº†è¿™äº›è§„åˆ™ï¼Œåªæœ‰æŒ‡å®šçš„IPæ®µèƒ½å¤Ÿè®¿é—®æŒ‡å®šçš„å¼€æ”¾æ¥å£ï¼Œå°±ç®—æœ‰ä¸ªæœ‰æ¼æ´çš„åå°è¿›ç¨‹åœ¨é‚£é‡Œï¼Œä¹Ÿä¼šè¢«å±è”½ï¼Œé»‘å®¢è¿›ä¸æ¥ã€‚åœ¨äº‘å¹³å°ä¸Šï¼Œè¿™äº›è§„åˆ™çš„é›†åˆå¸¸ç§°ä¸º<strong>å®‰å…¨ç»„</strong>ã€‚é‚£å®‰å…¨ç»„æ€ä¹ˆå®ç°å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬æ¥å¤ä¹ ä¸€ä¸‹ï¼Œå½“ä¸€ä¸ªç½‘ç»œåŒ…è¿›å…¥ä¸€å°æœºå™¨çš„æ—¶å€™ï¼Œéƒ½ä¼šåšä»€ä¹ˆäº‹æƒ…ã€‚</p><p>é¦–å…ˆæ‹¿ä¸‹MACå¤´çœ‹çœ‹ï¼Œæ˜¯ä¸æ˜¯æˆ‘çš„ã€‚å¦‚æœæ˜¯ï¼Œåˆ™æ‹¿ä¸‹IPå¤´æ¥ã€‚å¾—åˆ°ç›®æ ‡IPä¹‹åå‘¢ï¼Œå°±å¼€å§‹è¿›è¡Œè·¯ç”±åˆ¤æ–­ã€‚åœ¨è·¯ç”±åˆ¤æ–­ä¹‹å‰ï¼Œè¿™ä¸ªèŠ‚ç‚¹æˆ‘ä»¬ç§°ä¸º<strong>PREROUTING</strong>ã€‚å¦‚æœå‘ç°IPæ˜¯æˆ‘çš„ï¼ŒåŒ…å°±åº”è¯¥æ˜¯æˆ‘çš„ï¼Œå°±å‘ç»™ä¸Šé¢çš„ä¼ è¾“å±‚ï¼Œè¿™ä¸ªèŠ‚ç‚¹å«ä½œ<strong>INPUT</strong>ã€‚å¦‚æœå‘ç°IPä¸æ˜¯æˆ‘çš„ï¼Œå°±éœ€è¦è½¬å‘å‡ºå»ï¼Œè¿™ä¸ªèŠ‚ç‚¹ç§°ä¸º<strong>FORWARD</strong>ã€‚å¦‚æœæ˜¯æˆ‘çš„ï¼Œä¸Šå±‚å¤„ç†å®Œæ¯•åï¼Œä¸€èˆ¬ä¼šè¿”å›ä¸€ä¸ªå¤„ç†ç»“æœï¼Œè¿™ä¸ªå¤„ç†ç»“æœä¼šå‘å‡ºå»ï¼Œè¿™ä¸ªèŠ‚ç‚¹ç§°ä¸º<strong>OUTPUT</strong>ï¼Œæ— è®ºæ˜¯FORWARDè¿˜æ˜¯OUTPUTï¼Œéƒ½æ˜¯è·¯ç”±åˆ¤æ–­ä¹‹åå‘ç”Ÿçš„ï¼Œæœ€åä¸€ä¸ªèŠ‚ç‚¹æ˜¯<strong>POSTROUTING</strong>ã€‚</p><p>æ•´ä¸ªè¿‡ç¨‹å¦‚å›¾æ‰€ç¤ºã€‚</p><p></p><p><img src=\"https://static001.geekbang.org/resource/image/a7/49/a7b549514cf6d750f7dfb1e488ebdd49.jpg?wh=2126*889\" alt=\"\"></p><p>æ•´ä¸ªåŒ…çš„å¤„ç†è¿‡ç¨‹è¿˜æ˜¯åŸæ¥çš„è¿‡ç¨‹ï¼Œåªä¸è¿‡ä¸ºä»€ä¹ˆè¦æ ¼å¤–å…³æ³¨è¿™<strong>äº”ä¸ªèŠ‚ç‚¹</strong>å‘¢ï¼Ÿ</p><p>æ˜¯å› ä¸ºåœ¨Linuxå†…æ ¸ä¸­ï¼Œæœ‰ä¸€ä¸ªæ¡†æ¶å«Netfilterã€‚å®ƒå¯ä»¥åœ¨è¿™äº›èŠ‚ç‚¹æ’å…¥hookå‡½æ•°ã€‚è¿™äº›å‡½æ•°å¯ä»¥æˆªè·æ•°æ®åŒ…ï¼Œå¯¹æ•°æ®åŒ…è¿›è¡Œå¹²é¢„ã€‚ä¾‹å¦‚åšä¸€å®šçš„ä¿®æ”¹ï¼Œç„¶åå†³ç­–æ˜¯å¦æ¥ç€äº¤ç»™TCP/IPåè®®æ ˆå¤„ç†ï¼›æˆ–è€…å¯ä»¥äº¤å›ç»™åè®®æ ˆï¼Œé‚£å°±æ˜¯<strong>ACCEPT</strong>ï¼›æˆ–è€…è¿‡æ»¤æ‰ï¼Œä¸å†ä¼ è¾“ï¼Œå°±æ˜¯<strong>DROP</strong>ï¼›è¿˜æœ‰å°±æ˜¯<strong>QUEUE</strong>ï¼Œå‘é€ç»™æŸä¸ªç”¨æˆ·æ€è¿›ç¨‹å¤„ç†ã€‚</p><p>è¿™ä¸ªæ¯”è¾ƒéš¾ç†è§£ï¼Œç»å¸¸ç”¨åœ¨å†…éƒ¨è´Ÿè½½å‡è¡¡ï¼Œå°±æ˜¯è¿‡æ¥çš„æ•°æ®ä¸€ä¼šå„¿ä¼ ç»™ç›®æ ‡åœ°å€1ï¼Œä¸€ä¼šå„¿ä¼ ç»™ç›®æ ‡åœ°å€2ï¼Œè€Œä¸”ç›®æ ‡åœ°å€çš„ä¸ªæ•°å’Œæƒé‡éƒ½å¯èƒ½å˜ã€‚åè®®æ ˆå¾€å¾€å¤„ç†ä¸äº†è¿™ä¹ˆå¤æ‚çš„é€»è¾‘ï¼Œéœ€è¦å†™ä¸€ä¸ªå‡½æ•°æ¥ç®¡è¿™ä¸ªæ•°æ®ï¼Œå®ç°è‡ªå·±çš„é€»è¾‘ã€‚</p><p>æœ‰äº†è¿™ä¸ªNetfilteræ¡†æ¶å°±å¤ªå¥½äº†ï¼Œä½ å¯ä»¥åœ¨IPè½¬å‘çš„è¿‡ç¨‹ä¸­ï¼Œéšæ—¶å¹²é¢„è¿™ä¸ªè¿‡ç¨‹ï¼Œåªè¦ä½ èƒ½å®ç°è¿™äº›hookå‡½æ•°ã€‚</p><p>ä¸€ä¸ªè‘—åçš„å®ç°ï¼Œå°±æ˜¯<strong>å†…æ ¸æ¨¡å—ip_tables</strong>ã€‚å®ƒåœ¨è¿™äº”ä¸ªèŠ‚ç‚¹ä¸ŠåŸ‹ä¸‹å‡½æ•°ï¼Œä»è€Œå¯ä»¥æ ¹æ®è§„åˆ™è¿›è¡ŒåŒ…çš„å¤„ç†ã€‚æŒ‰åŠŸèƒ½å¯åˆ†ä¸ºå››å¤§ç±»ï¼šè¿æ¥è·Ÿè¸ªï¼ˆconntrackï¼‰ã€æ•°æ®åŒ…çš„è¿‡æ»¤ï¼ˆfilterï¼‰ã€ç½‘ç»œåœ°å€è½¬æ¢ï¼ˆnatï¼‰å’Œæ•°æ®åŒ…çš„ä¿®æ”¹ï¼ˆmangleï¼‰ã€‚å…¶ä¸­è¿æ¥è·Ÿè¸ªæ˜¯åŸºç¡€åŠŸèƒ½ï¼Œè¢«å…¶ä»–åŠŸèƒ½æ‰€ä¾èµ–ã€‚å…¶ä»–ä¸‰ä¸ªå¯ä»¥å®ç°åŒ…çš„è¿‡æ»¤ã€ä¿®æ”¹å’Œç½‘ç»œåœ°å€è½¬æ¢ã€‚</p><p>åœ¨ç”¨æˆ·æ€ï¼Œè¿˜æœ‰ä¸€ä¸ªä½ è‚¯å®šçŸ¥é“çš„å®¢æˆ·ç«¯ç¨‹åºiptablesï¼Œç”¨å‘½ä»¤è¡Œæ¥å¹²é¢„å†…æ ¸çš„è§„åˆ™ã€‚å†…æ ¸çš„åŠŸèƒ½å¯¹åº”iptablesçš„å‘½ä»¤è¡Œæ¥è®²ï¼Œå°±æ˜¯<strong>è¡¨å’Œé“¾</strong>çš„æ¦‚å¿µã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/74/95/746131a029919768c4f00a0fe7fayy95.jpg?wh=2483*1613\" alt=\"\"></p><p>iptablesçš„è¡¨åˆ†ä¸ºå››ç§ï¼šraw--&gt;mangle--&gt;nat--&gt;filterã€‚è¿™å››ä¸ªä¼˜å…ˆçº§ä¾æ¬¡é™ä½ï¼Œrawä¸å¸¸ç”¨ï¼Œæ‰€ä»¥ä¸»è¦åŠŸèƒ½éƒ½åœ¨å…¶ä»–ä¸‰ç§è¡¨é‡Œå®ç°ã€‚æ¯ä¸ªè¡¨å¯ä»¥è®¾ç½®å¤šä¸ªé“¾ã€‚</p><p>filterè¡¨å¤„ç†è¿‡æ»¤åŠŸèƒ½ï¼Œä¸»è¦åŒ…å«ä¸‰ä¸ªé“¾ï¼š</p><ul>\n<li>\n<p>INPUTé“¾ï¼šè¿‡æ»¤æ‰€æœ‰ç›®æ ‡åœ°å€æ˜¯æœ¬æœºçš„æ•°æ®åŒ…ï¼›</p>\n</li>\n<li>\n<p>FORWARDé“¾ï¼šè¿‡æ»¤æ‰€æœ‰è·¯è¿‡æœ¬æœºçš„æ•°æ®åŒ…ï¼›</p>\n</li>\n<li>\n<p>OUTPUTé“¾ï¼šè¿‡æ»¤æ‰€æœ‰ç”±æœ¬æœºäº§ç”Ÿçš„æ•°æ®åŒ…ã€‚</p>\n</li>\n</ul><p>natè¡¨ä¸»è¦æ˜¯å¤„ç†ç½‘ç»œåœ°å€è½¬æ¢ï¼Œå¯ä»¥è¿›è¡ŒSnatï¼ˆæ”¹å˜æ•°æ®åŒ…çš„æºåœ°å€ï¼‰ã€Dnatï¼ˆæ”¹å˜æ•°æ®åŒ…çš„ç›®æ ‡åœ°å€ï¼‰ï¼ŒåŒ…å«ä¸‰ä¸ªé“¾ï¼š</p><ul>\n<li>\n<p>PREROUTINGé“¾ï¼šå¯ä»¥åœ¨æ•°æ®åŒ…åˆ°è¾¾é˜²ç«å¢™æ—¶æ”¹å˜ç›®æ ‡åœ°å€ï¼›</p>\n</li>\n<li>\n<p>OUTPUTé“¾ï¼šå¯ä»¥æ”¹å˜æœ¬åœ°äº§ç”Ÿçš„æ•°æ®åŒ…çš„ç›®æ ‡åœ°å€ï¼›</p>\n</li>\n<li>\n<p>POSTROUTINGé“¾ï¼šåœ¨æ•°æ®åŒ…ç¦»å¼€é˜²ç«å¢™æ—¶æ”¹å˜æ•°æ®åŒ…çš„æºåœ°å€ã€‚</p>\n</li>\n</ul><p>mangleè¡¨ä¸»è¦æ˜¯ä¿®æ”¹æ•°æ®åŒ…ï¼ŒåŒ…å«ï¼š</p><ul>\n<li>\n<p>PREROUTINGé“¾ï¼›</p>\n</li>\n<li>\n<p>INPUTé“¾ï¼›</p>\n</li>\n<li>\n<p>FORWARDé“¾ï¼›</p>\n</li>\n<li>\n<p>OUTPUTé“¾ï¼›</p>\n</li>\n<li>\n<p>POSTROUTINGé“¾ã€‚</p>\n</li>\n</ul><p>å°†iptablesçš„è¡¨å’Œé“¾åŠ å…¥åˆ°ä¸Šé¢çš„è¿‡ç¨‹å›¾ä¸­ï¼Œå°±å½¢æˆäº†ä¸‹é¢çš„å›¾å’Œè¿‡ç¨‹ã€‚</p><p></p><p><img src=\"https://static001.geekbang.org/resource/image/e0/ec/e06c112fce8e3f3bc8a89c52f86fdfec.jpg?wh=2588*1113\" alt=\"\"></p><ol>\n<li>\n<p>æ•°æ®åŒ…è¿›å…¥çš„æ—¶å€™ï¼Œå…ˆè¿›mangleè¡¨çš„PREROUTINGé“¾ã€‚åœ¨è¿™é‡Œå¯ä»¥æ ¹æ®éœ€è¦ï¼Œæ”¹å˜æ•°æ®åŒ…å¤´å†…å®¹ä¹‹åï¼Œè¿›å…¥natè¡¨çš„PREROUTINGé“¾ï¼Œåœ¨è¿™é‡Œå¯ä»¥æ ¹æ®éœ€è¦åšDnatï¼Œä¹Ÿå°±æ˜¯ç›®æ ‡åœ°å€è½¬æ¢ã€‚</p>\n</li>\n<li>\n<p>è¿›å…¥è·¯ç”±åˆ¤æ–­ï¼Œè¦åˆ¤æ–­æ˜¯è¿›å…¥æœ¬åœ°çš„è¿˜æ˜¯è½¬å‘çš„ã€‚</p>\n</li>\n<li>\n<p>å¦‚æœæ˜¯è¿›å…¥æœ¬åœ°çš„ï¼Œå°±è¿›å…¥INPUTé“¾ï¼Œä¹‹åæŒ‰æ¡ä»¶è¿‡æ»¤é™åˆ¶è¿›å…¥ã€‚</p>\n</li>\n<li>\n<p>ä¹‹åè¿›å…¥æœ¬æœºï¼Œå†è¿›å…¥OUTPUTé“¾ï¼ŒæŒ‰æ¡ä»¶è¿‡æ»¤é™åˆ¶å‡ºå»ï¼Œç¦»å¼€æœ¬åœ°ã€‚</p>\n</li>\n<li>\n<p>å¦‚æœæ˜¯è½¬å‘å°±è¿›å…¥FORWARDé“¾ï¼Œæ ¹æ®æ¡ä»¶è¿‡æ»¤é™åˆ¶è½¬å‘ã€‚</p>\n</li>\n<li>\n<p>ä¹‹åè¿›å…¥POSTROUTINGé“¾ï¼Œè¿™é‡Œå¯ä»¥åšSnatï¼Œç¦»å¼€ç½‘ç»œæ¥å£ã€‚</p>\n</li>\n</ol><p>æœ‰äº†iptableså‘½ä»¤ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨äº‘ä¸­å®ç°ä¸€å®šçš„å®‰å…¨ç­–ç•¥ã€‚ä¾‹å¦‚æˆ‘ä»¬å¯ä»¥å¤„ç†å‰é¢çš„å·çª¥äº‹ä»¶ã€‚é¦–å…ˆæˆ‘ä»¬å°†æ‰€æœ‰çš„é—¨éƒ½å…³é—­ã€‚</p><pre><code>iptables -t filter -A INPUT -s 0.0.0.0/0.0.0.0 -d X.X.X.X -j DROP\n</code></pre><p>-sè¡¨ç¤ºæºIPåœ°å€æ®µï¼Œ-dè¡¨ç¤ºç›®æ ‡åœ°å€æ®µï¼ŒDROPè¡¨ç¤ºä¸¢å¼ƒï¼Œä¹Ÿå³æ— è®ºä»å“ªé‡Œæ¥çš„ï¼Œè¦æƒ³è®¿é—®æˆ‘è¿™å°æœºå™¨ï¼Œå…¨éƒ¨æ‹’ç»ï¼Œè°ä¹Ÿé»‘ä¸è¿›æ¥ã€‚</p><p>ä½†æ˜¯ä½ å‘ç°åäº†ï¼Œsshä¹Ÿè¿›ä¸æ¥äº†ï¼Œéƒ½ä¸èƒ½è¿œç¨‹è¿ç»´äº†ï¼Œå¯ä»¥æ‰“å¼€ä¸€ä¸‹ã€‚</p><pre><code>iptables -I INPUT -s 0.0.0.0/0.0.0.0 -d X.X.X.X -p tcp --dport 22 -j ACCEPT\n</code></pre><p>å¦‚æœè¿™å°æœºå™¨æ˜¯æä¾›çš„æ˜¯webæœåŠ¡ï¼Œ80ç«¯å£ä¹Ÿåº”è¯¥æ‰“å¼€ï¼Œå½“ç„¶ä¸€æ—¦æ‰“å¼€ï¼Œè¿™ä¸ª80ç«¯å£å°±éœ€è¦å¾ˆå¥½çš„é˜²æŠ¤ï¼Œä½†æ˜¯ä»è§„åˆ™è§’åº¦è¿˜æ˜¯è¦æ‰“å¼€ã€‚</p><pre><code>iptables -A INPUT -s 0.0.0.0/0.0.0.0 -d X.X.X.X -p tcp --dport 80 -j ACCEPT\n</code></pre><p>è¿™æ ·å°±æå®šäº†ï¼Œå…¶ä»–çš„è´¦æˆ·éƒ½å°æ­»ï¼Œå°±ä¸€ä¸ªé˜²ç›—é—¨å¯ä»¥è¿›å‡ºï¼Œåªè¦é˜²ç›—é—¨æ˜¯äº”æ˜Ÿçº§çš„ï¼Œå°±æ¯”è¾ƒå®‰å…¨äº†ã€‚</p><p>è¿™äº›è§„åˆ™éƒ½å¯ä»¥åœ¨è™šæ‹Ÿæœºé‡Œï¼Œè‡ªå·±å®‰è£…iptablesè‡ªå·±é…ç½®ã€‚ä½†æ˜¯å¦‚æœè™šæ‹Ÿæœºæ•°ç›®éå¸¸å¤šï¼Œéƒ½è¦é…ç½®ï¼Œå¯¹äºç”¨æˆ·æ¥è®²å°±å¤ªéº»çƒ¦äº†ï¼Œèƒ½ä¸èƒ½è®©äº‘å¹³å°æŠŠè¿™éƒ¨åˆ†å·¥ä½œåšæ‰å‘¢ï¼Ÿ</p><p>å½“ç„¶å¯ä»¥äº†ã€‚åœ¨äº‘å¹³å°ä¸Šï¼Œä¸€èˆ¬å…è®¸ä¸€ä¸ªæˆ–è€…å¤šä¸ªè™šæ‹Ÿæœºå±äºæŸä¸ªå®‰å…¨ç»„ï¼Œè€Œå±äºä¸åŒå®‰å…¨ç»„çš„è™šæ‹Ÿæœºä¹‹é—´çš„è®¿é—®ä»¥åŠå¤–ç½‘è®¿é—®è™šæ‹Ÿæœºï¼Œéƒ½éœ€è¦é€šè¿‡å®‰å…¨ç»„è¿›è¡Œè¿‡æ»¤ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/06/21/069e51d949312246yy9d2764e6d6c921.jpg?wh=2743*1841\" alt=\"\"></p><p>ä¾‹å¦‚å›¾ä¸­ï¼Œæˆ‘ä»¬ä¼šåˆ›å»ºä¸€ç³»åˆ—çš„ç½‘ç«™ï¼Œéƒ½æ˜¯å‰ç«¯åœ¨Tomcaté‡Œé¢ï¼Œå¯¹å¤–å¼€æ”¾8080ç«¯å£ã€‚æ•°æ®åº“ä½¿ç”¨MySQLï¼Œå¼€æ”¾3306ç«¯å£ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿è¿ç»´ï¼Œæˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªå®‰å…¨ç»„ï¼Œå°†Tomcatæ‰€åœ¨çš„è™šæ‹Ÿæœºæ”¾åœ¨å®‰å…¨ç»„Aé‡Œé¢ã€‚åœ¨å®‰å…¨ç»„Aé‡Œé¢ï¼Œå…è®¸ä»»æ„IPåœ°å€0.0.0.0/0è®¿é—®8080ç«¯å£ï¼Œä½†æ˜¯å¯¹äºsshçš„22ç«¯å£ï¼Œä»…ä»…å…è®¸ç®¡ç†å‘˜ç½‘æ®µ203.0.113.0/24è®¿é—®ã€‚</p><p>æˆ‘ä»¬å°†MySQLæ‰€åœ¨çš„è™šæ‹Ÿæœºæ”¾åœ¨å®‰å…¨ç»„Bé‡Œé¢ã€‚åœ¨å®‰å…¨ç»„Bé‡Œé¢ï¼Œä»…ä»…å…è®¸æ¥è‡ªå®‰å…¨ç»„Açš„æœºå™¨è®¿é—®3306ç«¯å£ï¼Œä½†æ˜¯å¯¹äºsshçš„22ç«¯å£ï¼ŒåŒæ ·å…è®¸ç®¡ç†å‘˜ç½‘æ®µ203.0.113.0/24è®¿é—®ã€‚</p><p>è¿™äº›å®‰å…¨ç»„è§„åˆ™éƒ½å¯ä»¥è‡ªåŠ¨ä¸‹å‘åˆ°æ¯ä¸ªåœ¨å®‰å…¨ç»„é‡Œé¢çš„è™šæ‹Ÿæœºä¸Šï¼Œä»è€Œæ§åˆ¶ä¸€å¤§æ‰¹è™šæ‹Ÿæœºçš„å®‰å…¨ç­–ç•¥ã€‚è¿™ç§æ‰¹é‡ä¸‹å‘æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿä½ è¿˜è®°å¾—è¿™å¹…å›¾å—ï¼Ÿ</p><p><img src=\"https://static001.geekbang.org/resource/image/24/24/246db57c915d9ccf6e0d66182de0fe24.jpg?wh=720*977\" alt=\"\"></p><p>ä¸¤ä¸ªVMéƒ½é€šè¿‡tapç½‘å¡è¿æ¥åˆ°ä¸€ä¸ªç½‘æ¡¥ä¸Šï¼Œä½†æ˜¯ç½‘æ¡¥æ˜¯äºŒå±‚çš„ï¼Œä¸¤ä¸ªVMä¹‹é—´æ˜¯å¯ä»¥éšæ„äº’é€šçš„ï¼Œå› è€Œéœ€è¦æœ‰ä¸€ä¸ªåœ°æ–¹ç»Ÿä¸€é…ç½®è¿™äº›iptablesè§„åˆ™ã€‚</p><p>å¯ä»¥å¤šåŠ ä¸€ä¸ªç½‘æ¡¥ï¼Œåœ¨è¿™ä¸ªç½‘æ¡¥ä¸Šé…ç½®iptablesè§„åˆ™ï¼Œå°†åœ¨ç”¨æˆ·åœ¨ç•Œé¢ä¸Šé…ç½®çš„è§„åˆ™ï¼Œæ”¾åˆ°è¿™ä¸ªç½‘æ¡¥ä¸Šã€‚ç„¶ååœ¨æ¯å°æœºå™¨ä¸Šè·‘ä¸€ä¸ªAgentï¼Œå°†ç”¨æˆ·é…ç½®çš„å®‰å…¨ç»„å˜æˆiptablesè§„åˆ™ï¼Œé…ç½®åœ¨è¿™ä¸ªç½‘æ¡¥ä¸Šã€‚</p><p>å®‰å…¨é—®é¢˜è§£å†³äº†ï¼ŒiptablesçœŸå¼ºå¤§ï¼åˆ«å¿™ï¼Œiptablesé™¤äº†filterï¼Œè¿˜æœ‰natå‘¢ï¼Œè¿™ä¸ªåŠŸèƒ½ä¹Ÿéå¸¸é‡è¦ã€‚</p><p>å‰é¢çš„ç« èŠ‚æˆ‘ä»¬è¯´è¿‡ï¼Œåœ¨è®¾è®¡äº‘å¹³å°çš„æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³è®©è™šæ‹Ÿæœºä¹‹é—´çš„ç½‘ç»œå’Œç‰©ç†ç½‘ç»œè¿›è¡Œéš”ç¦»ï¼Œä½†æ˜¯è™šæ‹Ÿæœºæ¯•ç«Ÿè¿˜æ˜¯è¦é€šè¿‡ç‰©ç†ç½‘å’Œå¤–ç•Œé€šä¿¡çš„ï¼Œå› è€Œéœ€è¦åœ¨å‡ºç‰©ç†ç½‘çš„æ—¶å€™ï¼Œåšä¸€æ¬¡ç½‘ç»œåœ°å€è½¬æ¢ï¼Œä¹Ÿå³natï¼Œè¿™ä¸ªå°±å¯ä»¥ç”¨iptablesæ¥åšã€‚</p><p>æˆ‘ä»¬å­¦è¿‡ï¼ŒIPå¤´é‡Œé¢åŒ…å«æºIPåœ°å€å’Œç›®æ ‡IPåœ°å€ï¼Œè¿™ä¸¤ç§IPåœ°å€éƒ½å¯ä»¥è½¬æ¢æˆå…¶ä»–åœ°å€ã€‚è½¬æ¢æºIPåœ°å€çš„ï¼Œæˆ‘ä»¬ç§°ä¸ºSnatï¼›è½¬æ¢ç›®æ ‡IPåœ°å€çš„ï¼Œæˆ‘ä»¬ç§°ä¸ºDnatã€‚</p><p>ä½ æœ‰æ²¡æœ‰æ€è€ƒè¿‡è¿™ä¸ªé—®é¢˜ï¼ŒTCPçš„è®¿é—®éƒ½æ˜¯ä¸€å»ä¸€å›çš„ï¼Œè€Œä½ åœ¨ä½ å®¶é‡Œè¿æ¥WiFiçš„IPåœ°å€æ˜¯ä¸€ä¸ªç§ç½‘IPï¼Œ192.168.1.xã€‚å½“ä½ é€šè¿‡ä½ ä»¬å®¶çš„è·¯ç”±å™¨è®¿é—®163ç½‘ç«™ä¹‹åï¼Œç½‘ç«™çš„è¿”å›ç»“æœå¦‚ä½•èƒ½å¤Ÿåˆ°è¾¾ä½ çš„ç¬”è®°æœ¬ç”µè„‘å‘¢ï¼Ÿè‚¯å®šä¸èƒ½é€šè¿‡192.168.1.xï¼Œè¿™æ˜¯ä¸ªç§ç½‘IPï¼Œä¸å…·æœ‰å…¬ç½‘ä¸Šçš„å®šä½èƒ½åŠ›ï¼Œè€Œä¸”ç”¨è¿™ä¸ªç½‘æ®µçš„äººå¾ˆå¤šï¼ŒèŒ«èŒ«äººæµ·ï¼Œæ€ä¹ˆèƒ½å¤Ÿæ‰¾åˆ°ä½ å‘¢ï¼Ÿ</p><p>æ‰€ä»¥å½“ä½ ä»ä½ å®¶é‡Œè®¿é—®163ç½‘ç«™çš„æ—¶å€™ï¼Œåœ¨ä½ è·¯ç”±å™¨çš„å‡ºå£ï¼Œä¼šåšSnatçš„ï¼Œè¿è¥å•†çš„å‡ºå£ä¹Ÿå¯èƒ½åšSnatï¼Œå°†ä½ çš„ç§ç½‘IPåœ°å€ï¼Œæœ€ç»ˆè½¬æ¢ä¸ºå…¬ç½‘IPåœ°å€ï¼Œç„¶å163ç½‘ç«™å°±å¯ä»¥é€šè¿‡è¿™ä¸ªå…¬ç½‘IPåœ°å€è¿”å›ç»“æœï¼Œç„¶åå†natå›æ¥ï¼Œç›´åˆ°åˆ°è¾¾ä½ çš„ç¬”è®°æœ¬ç”µè„‘ã€‚</p><p>äº‘å¹³å°é‡Œé¢çš„è™šæ‹Ÿæœºä¹Ÿæ˜¯è¿™æ ·å­çš„ï¼Œå®ƒåªæœ‰ç§ç½‘IPåœ°å€ï¼Œåˆ°è¾¾å¤–ç½‘ç½‘å£è¦åšä¸€æ¬¡Snatï¼Œè½¬æ¢æˆä¸ºæœºæˆ¿ç½‘IPï¼Œç„¶åå‡ºæ•°æ®ä¸­å¿ƒçš„æ—¶å€™ï¼Œå†è½¬æ¢ä¸ºå…¬ç½‘IPã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/1a/1a/1a5d299c2eb5480eda93a8f8e3b3ca1a.jpg?wh=720*951\" alt=\"\"></p><p>è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œåœ¨å¤–ç½‘ç½‘å£ä¸ŠåšSnatçš„æ—¶å€™ï¼Œæ˜¯å…¨éƒ¨è½¬æ¢æˆä¸€ä¸ªæœºæˆ¿ç½‘IPå‘¢ï¼Œè¿˜æ˜¯æ¯ä¸ªè™šæ‹Ÿæœºéƒ½å¯¹åº”ä¸€ä¸ªæœºæˆ¿ç½‘IPï¼Œæœ€ç»ˆå¯¹åº”ä¸€ä¸ªå…¬ç½‘IPå‘¢ï¼Ÿå‰é¢ä¹Ÿè¯´è¿‡äº†ï¼Œå…¬ç½‘IPéå¸¸è´µï¼Œè™šæ‹Ÿæœºä¹Ÿå¾ˆå¤šï¼Œå½“ç„¶ä¸èƒ½æ¯ä¸ªéƒ½æœ‰å•ç‹¬çš„æœºæˆ¿ç½‘å’Œå…¬ç½‘IPäº†ï¼Œå› æ­¤è¿™ç§Snatæ˜¯ä¸€ç§ç‰¹æ®Šçš„Snatï¼ŒMASQUERADEï¼ˆåœ°å€ä¼ªè£…ï¼‰ã€‚</p><p>è¿™ç§æ–¹å¼ä¸‹ï¼Œæ‰€æœ‰çš„è™šæ‹Ÿæœºå…±äº«ä¸€ä¸ªæœºæˆ¿ç½‘å’Œå…¬ç½‘çš„IPåœ°å€ï¼Œæ‰€æœ‰ä»å¤–ç½‘ç½‘å£å‡ºå»çš„ï¼Œéƒ½è½¬æ¢æˆä¸ºè¿™ä¸ªIPåœ°å€ã€‚é‚£åˆä¸€ä¸ªé—®é¢˜æ¥äº†ï¼Œéƒ½å˜æˆä¸€ä¸ªå…¬ç½‘IPäº†ï¼Œå½“163ç½‘ç«™è¿”å›ç»“æœçš„æ—¶å€™ï¼Œç»™è°å‘¢ï¼Œå†natæˆä¸ºå“ªä¸ªç§ç½‘çš„IPå‘¢ï¼Ÿ</p><p>è¿™å°±æ˜¯Netfilterçš„è¿æ¥è·Ÿè¸ªï¼ˆconntrackï¼‰åŠŸèƒ½äº†ã€‚å¯¹äºTCPåè®®æ¥è®²ï¼Œè‚¯å®šæ˜¯ä¸Šæ¥å…ˆå»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œå¯ä»¥ç”¨â€œæº/ç›®çš„IP+æº/ç›®çš„ç«¯å£â€å”¯ä¸€æ ‡è¯†ä¸€æ¡è¿æ¥ï¼Œè¿™ä¸ªè¿æ¥ä¼šæ”¾åœ¨conntrackè¡¨é‡Œé¢ã€‚å½“æ—¶æ˜¯è¿™å°æœºå™¨å»è¯·æ±‚163ç½‘ç«™çš„ï¼Œè™½ç„¶æºåœ°å€å·²ç»Snatæˆå…¬ç½‘IPåœ°å€äº†ï¼Œä½†æ˜¯conntrackè¡¨é‡Œé¢è¿˜æ˜¯æœ‰è¿™ä¸ªè¿æ¥çš„è®°å½•çš„ã€‚å½“163ç½‘ç«™è¿”å›æ•°æ®çš„æ—¶å€™ï¼Œä¼šæ‰¾åˆ°è®°å½•ï¼Œä»è€Œæ‰¾åˆ°æ­£ç¡®çš„ç§ç½‘IPåœ°å€ã€‚</p><p>è¿™æ˜¯è™šæ‹Ÿæœºåšå®¢æˆ·ç«¯çš„æƒ…å†µï¼Œå¦‚æœè™šæ‹ŸæœºåšæœåŠ¡å™¨å‘¢ï¼Ÿä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè™šæ‹Ÿæœºé‡Œé¢éƒ¨ç½²çš„å°±æ˜¯163ç½‘ç«™å‘¢ï¼Ÿ</p><p></p><p>è¿™ä¸ªæ—¶å€™å°±éœ€è¦ç»™è¿™ä¸ªç½‘ç«™é…ç½®å›ºå®šçš„ç‰©ç†ç½‘çš„IPåœ°å€å’Œå…¬ç½‘IPåœ°å€äº†ã€‚è¿™æ—¶å€™å°±éœ€è¦è¯¦ç»†é…ç½®Snatè§„åˆ™å’ŒDnatè§„åˆ™äº†ã€‚</p><p>å½“å¤–éƒ¨è®¿é—®è¿›æ¥çš„æ—¶å€™ï¼Œå¤–ç½‘ç½‘å£ä¼šé€šè¿‡Dnatè§„åˆ™å°†å…¬ç½‘IPåœ°å€è½¬æ¢ä¸ºç§ç½‘IPåœ°å€ï¼Œåˆ°è¾¾è™šæ‹Ÿæœºï¼Œè™šæ‹Ÿæœºé‡Œé¢æ˜¯163ç½‘ç«™ï¼Œè¿”å›ç»“æœï¼Œå¤–ç½‘ç½‘å£ä¼šé€šè¿‡Snatè§„åˆ™ï¼Œå°†ç§ç½‘IPåœ°å€è½¬æ¢ä¸ºé‚£ä¸ªåˆ†é…ç»™å®ƒçš„å›ºå®šçš„å…¬ç½‘IPåœ°å€ã€‚</p><p>ç±»ä¼¼çš„è§„åˆ™å¦‚ä¸‹ï¼š</p><ul>\n<li>\n<p>æºåœ°å€è½¬æ¢(Snat)ï¼šiptables -t nat -A -s ç§ç½‘IP -j Snat --to-source å¤–ç½‘IP</p>\n</li>\n<li>\n<p>ç›®çš„åœ°å€è½¬æ¢(Dnat)ï¼šiptables -t nat -A -PREROUTING -d å¤–ç½‘IP -j Dnat --to-destination ç§ç½‘IP</p>\n</li>\n</ul><p>åˆ°æ­¤ä¸ºæ­¢iptablesè§£å†³äº†éæ³•å·çª¥éšç§çš„é—®é¢˜ã€‚</p><h2>å°ç»“</h2><p>å¥½äº†ï¼Œè¿™ä¸€èŠ‚å°±è®²åˆ°è¿™é‡Œäº†ï¼Œæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ã€‚</p><ul>\n<li>\n<p>äº‘ä¸­çš„å®‰å…¨ç­–ç•¥çš„å¸¸ç”¨æ–¹å¼æ˜¯ï¼Œä½¿ç”¨iptablesçš„è§„åˆ™ï¼Œè¯·è®°ä½å®ƒçš„äº”ä¸ªé˜¶æ®µï¼ŒPREROUTINGã€INPUTã€FORWARDã€OUTPUTã€POSTROUTINGã€‚</p>\n</li>\n<li>\n<p>iptablesåˆ†ä¸ºå››ç§è¡¨ï¼Œrawã€mangleã€natã€filterã€‚å…¶ä¸­å®‰å…¨ç­–ç•¥ä¸»è¦åœ¨filterè¡¨ä¸­å®ç°ï¼Œè€Œè™šæ‹Ÿç½‘ç»œå’Œç‰©ç†ç½‘ç»œåœ°å€çš„è½¬æ¢ä¸»è¦åœ¨natè¡¨ä¸­å®ç°ã€‚</p>\n</li>\n</ul><p>æœ€åï¼Œç»™ä½ ç•™ä¸¤ä¸ªæ€è€ƒé¢˜ã€‚</p><ol>\n<li>\n<p>è¿™ä¸€èŠ‚ä¸­é‡ç‚¹è®²äº†iptablesçš„filterå’ŒnatåŠŸèƒ½ï¼Œiptablesè¿˜å¯ä»¥é€šè¿‡QUEUEå®ç°è´Ÿè½½å‡è¡¡ï¼Œä½ çŸ¥é“æ€ä¹ˆåšå—ï¼Ÿ</p>\n</li>\n<li>\n<p>è¿™ä¸€èŠ‚ä»…ä»…è®²è¿°äº†äº‘ä¸­å·çª¥çš„é—®é¢˜ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªåˆæ³•çš„ç”¨æˆ·ï¼Œä½†æ˜¯ä¸è‡ªè§‰æŠ¢å ç½‘ç»œé€šé“ï¼Œåº”è¯¥é‡‡å–ä»€ä¹ˆç­–ç•¥å‘¢ï¼Ÿ</p>\n</li>\n</ol><p>æˆ‘ä»¬çš„ä¸“æ æ›´æ–°åˆ°ç¬¬26è®²ï¼Œä¸çŸ¥ä½ æŒæ¡å¾—å¦‚ä½•ï¼Ÿæ˜¯ä¸æ˜¯æœ‰å¾ˆå¤šé—®é¢˜æƒ³è¦è·Ÿæˆ‘é¢å¯¹é¢æ¢è®¨å‘¢ï¼Ÿè¿™é‡Œå°±æœ‰ä¸€ä¸ªæœºä¼šã€‚</p><p><span class=\"orange\">ä»Šå¤©æ™šä¸Š8:30ï¼Œæˆ‘ä¼šåœ¨æå®¢æ—¶é—´APPé‡Œåšä¸€ä¸ªç›´æ’­ï¼Œä¸»é¢˜æ˜¯â€œæŠ€æœ¯äººå¦‚ä½•åœ¨æŠ€æœ¯æµªæ½®ä¸­çº¿æ€§æˆé•¿ï¼Ÿ</span>â€ï¼Œæˆ‘ä¼šæŠŠæˆ‘ä»¬è®²è¿‡çš„ç½‘ç»œåè®®ä½œä¸ºæ¡ˆä¾‹ï¼Œåœ¨ç›´æ’­ä¸­å±•å¼€è®²è§£ï¼Œä¹Ÿä¼šåˆ†äº«æˆ‘ä»ä¸šå¤šå¹´æ¥çš„å¿ƒå¾—ä½“ä¼šã€‚<strong>ä½ å¯ä»¥ç›´æ¥åœ¨è¿™é‡Œç•™è¨€æé—®ï¼Œä¹Ÿå¯ä»¥å‡†å¤‡å¥½é—®é¢˜åœ¨ç›´æ’­çš„æ—¶å€™å’Œæˆ‘äº¤æµã€‚</strong></p><p>æ¬¢è¿ä½ æ¥çœ‹ç›´æ’­ï¼æˆ‘ä»¬æ™šä¸Šè§ï¼</p><p><img src=\"https://static001.geekbang.org/resource/image/00/ab/001997ebd09dd7e9f649f183207cdfab.jpg?wh=900*500\" alt=\"\"></p>","comments":[{"had_liked":false,"id":21366,"user_name":"å°å®‡å®™","can_delete":false,"product_type":"c1","uid":1029649,"ip_address":"","ucode":"BBFFC39CB9E26F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b6/11/e8506a04.jpg","comment_is_top":false,"comment_ctime":1535042509,"is_pvip":false,"replies":[{"id":"7585","content":"å¯¹çš„","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘","uid":"1001590","ctime":1535077394,"ip_address":"","comment_id":21366,"utype":1}],"discussion_count":1,"race_medal":0,"score":"177628701645","product_id":100007101,"comment_content":"k8sçš„kube-proxy å°±æ˜¯åˆ©ç”¨çš„iptables åšæµé‡è½¬å‘å’Œè´Ÿè½½å‡è¡¡çš„ï¼Œservice åˆ©ç”¨nat å°†ç›¸åº”çš„æµé‡è½¬å‘åˆ°å¯¹åº”çš„podä¸­ï¼Œå¦å¤–iptables æœ‰ä¸€ä¸ªprobabilityç‰¹æ€§ï¼Œå¯ä»¥è®¾ç½®probabilityçš„ç™¾åˆ†æ¯”æ˜¯å¤šå°‘ï¼Œä»è€Œå®ç°è´Ÿè½½å‡è¡¡","like_count":41,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":422652,"discussion_content":"å¯¹çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1535077394,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":16386,"user_name":"rtoday","can_delete":false,"product_type":"c1","uid":1174402,"ip_address":"","ucode":"DFAA788C96ABAC","user_header":"https://static001.geekbang.org/account/avatar/00/11/eb/82/4b56fa5f.jpg","comment_is_top":false,"comment_ctime":1531919659,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"130380938539","product_id":100007101,"comment_content":"å…³äºç½‘ç»œå®‰å…¨<br>ä¸çŸ¥é“è¯¾ç¨‹ç»“æŸå<br>å¯å¦æ‹¨å†—è°ˆä¸€ä¸‹<br>1.ä»€ä¹ˆæ˜¯ç½‘ç»œé•¿åŸï¼Ÿ<br>2.æ—©æœŸçš„ç§‘å­¦ä¸Šç½‘æ˜¯æ€ä¹ˆç¿»å¢™çš„ï¼Ÿ<br>3.æ˜¯å¦å¯ä»¥å¼€ä¸€å ‚è¯¾è°ˆè°ˆè¢«å¸¸è§çš„ç½‘ç»œæ”»å‡»åï¼Œè¯¥æ€ä¹ˆç¾éš¾ä¿®å¤<br>4.å¹³å¸¸è¿ç»´çš„å…¥ä¾µé˜²å¾¡ç³»ç»ŸIPSï¼Œå…¥ä¾µä¾¦æµ‹ç³»ç»ŸIDSï¼Œæ˜¯æ€ä¹ˆæ“ä½œçš„ï¼Œä»¥åŠèƒŒååŸç†<br>5.å†å²ä¸Šæœ‰æ²¡æœ‰å“ªä¸€äº›ç€åçš„ç½‘ç»œç¾éš¾ï¼Œåˆšå¥½æ‚¨ç»å†è¿‡ã€‚èƒŒåå‘ä½œåŸå› ï¼Œä»¥åŠå½“æ—¶æ‚¨çš„è§£å†³ä¹‹é“<br><br>å› ä¸ºæˆ‘è¿˜æ»¡å¥½å¥‡çš„ï¼Œæ¯”å¦‚è«åå¥‡å¦™å˜æˆè·³æ¿ï¼Œå»æ”»å‡»ç¾å›½å®˜æ–¹æœºæ„ï¼Œè¦æ€ä¹ˆé˜²èŒƒä»¥åŠä»–æ˜¯æ€ä¹ˆåŠåˆ°çš„","like_count":30,"discussions":[{"author":{"id":2036511,"avatar":"","nickname":"Geek_4e3a3d","note":"","ucode":"E319CFAF9212DC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311341,"discussion_content":"æ•°æ®åº“å®¡è®¡ã€WAFè¿™äº›ä¼ ç»Ÿç½‘ç»œé‡Œçš„å®‰å…¨äº§å“æ€ä¹ˆåœ¨äº‘è®¡ç®—ä¸­å‘æŒ¥ä½œç”¨å‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602312715,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":83394,"user_name":"Garry","can_delete":false,"product_type":"c1","uid":1216548,"ip_address":"","ucode":"FB48A333342B91","user_header":"https://static001.geekbang.org/account/avatar/00/12/90/24/aa5146e4.jpg","comment_is_top":false,"comment_ctime":1554556052,"is_pvip":false,"replies":[{"id":"49905","content":"èµ","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘","uid":"1001590","ctime":1567781578,"ip_address":"","comment_id":83394,"utype":1}],"discussion_count":2,"race_medal":0,"score":"96043836564","product_id":100007101,"comment_content":"å¯¹è¡¨å’Œé“¾æ¯”è¾ƒè¿·ç³Šçš„åŒå­¦ï¼Œç»“åˆè¿™ä¸ªåšå®¢çš„å†…å®¹çœ‹èµ·æ¥å¯èƒ½æ›´å®¹æ˜“ç†è§£ï¼Œhttp:&#47;&#47;www.zsythink.net&#47;archives&#47;1199","like_count":22,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446005,"discussion_content":"èµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567781578,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1282790,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIZbhibFy60Ilf27wIgwvs5xmc2Glkx4VjzVyjYptdC2q2OL2w604RCGKCibZTmak28sUBNfYwkG6ww/132","nickname":"CCCLARITY","note":"","ucode":"EA9FAF7009EB1B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579013,"discussion_content":"æœ‰æ¡ä»¶æ²¹ç®¡çš„è¿™é‡Œæœ‰ä¸ªè§†é¢‘ v=yE82upHCxfU","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657119503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":15964,"user_name":"å›ºæ€Uç›˜","can_delete":false,"product_type":"c1","uid":1043446,"ip_address":"","ucode":"9C473DA25CB4C1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/eb/f6/ec7971f4.jpg","comment_is_top":false,"comment_ctime":1531699733,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"70251176469","product_id":100007101,"comment_content":"å¤šå¹´éƒ½æ²¡å…·ä½“å¼„æ¸…æ¥šiptables,è¿™ä¸€ç¯‡æ–‡ç« è§£æƒ‘äº†ï¼Œå¤šè°¢åˆ˜è€å¸ˆã€‚","like_count":16},{"had_liked":false,"id":16232,"user_name":"å¤§æ ‘","can_delete":false,"product_type":"c1","uid":1159186,"ip_address":"","ucode":"293E597E5AFC04","user_header":"https://static001.geekbang.org/account/avatar/00/11/b0/12/cddd766c.jpg","comment_is_top":false,"comment_ctime":1531839028,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"48776479284","product_id":100007101,"comment_content":"è€å¸ˆå¥½ï¼Œç›´æ’­é”™è¿‡äº†ï¼Œæœ‰æ²¡æœ‰å›çœ‹å‘¢ï¼Ÿ","like_count":11},{"had_liked":false,"id":316050,"user_name":"Nick","can_delete":false,"product_type":"c1","uid":2597449,"ip_address":"","ucode":"37E60C08183617","user_header":"https://static001.geekbang.org/account/avatar/00/27/a2/49/7e749be2.jpg","comment_is_top":false,"comment_ctime":1634115341,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"18813984525","product_id":100007101,"comment_content":"è¿™ä¹ˆä¹…äº†éš¾é“æ²¡äººçœ‹åˆ°iptablesè¡¨å’Œé“¾é‚£å¼ å›¾ï¼ŒfilteræŒ‡å‘æŒ‡é”™äº†ä¹ˆï¼Ÿåº”è¯¥æ˜¯æŒ‡å‘inputã€forwardå’Œoutputï¼Œè€Œä¸æ˜¯inputã€forwordå’Œpostroutingã€‚","like_count":4,"discussions":[{"author":{"id":1276373,"avatar":"https://static001.geekbang.org/account/avatar/00/13/79/d5/4a7971fc.jpg","nickname":"Ethan","note":"","ucode":"016F1DEBA895B8","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578225,"discussion_content":"è¿˜æ²¡æ”¹å‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656589382,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":15970,"user_name":"timgise","can_delete":false,"product_type":"c1","uid":1083979,"ip_address":"","ucode":"0F4567495A471F","user_header":"https://static001.geekbang.org/account/avatar/00/10/8a/4b/9863a07b.jpg","comment_is_top":false,"comment_ctime":1531701666,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18711570850","product_id":100007101,"comment_content":"æœŸå¾…","like_count":4},{"had_liked":false,"id":18045,"user_name":"James","can_delete":false,"product_type":"c1","uid":1134861,"ip_address":"","ucode":"48B0F2A334D1C1","user_header":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","comment_is_top":false,"comment_ctime":1533104730,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14418006618","product_id":100007101,"comment_content":"çœ‹å®Œåå¯¹iptables é…ç½®ç‰¹åˆ«ç†è§£â€¦æ˜ç™½ä¸ºå•¥è¿™ä¹ˆé…ç½®â€¦â€¦è€Œä¸æ˜¯å¤åˆ¶æ”¹ç«¯å£é…ç½®â€¦â€¦","like_count":3},{"had_liked":false,"id":15983,"user_name":"stany","can_delete":false,"product_type":"c1","uid":1088746,"ip_address":"","ucode":"93FE6AD6E256F1","user_header":"https://static001.geekbang.org/account/avatar/00/10/9c/ea/bdab7a0d.jpg","comment_is_top":false,"comment_ctime":1531705323,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14416607211","product_id":100007101,"comment_content":"åˆ˜è€å¸ˆå¥½ï¼Œæˆ‘ä¹Ÿæ˜¯ç½‘æ˜“çš„åŒå­¦ï¼Œå…³äºè¡¨å’Œé“¾çš„é‚£å¼ å›¾ï¼Œæˆ‘åœ¨åˆ«çš„èµ„æ–™ä¸Šï¼Œçœ‹åˆ°åœ¨ output éƒ¨åˆ†å’Œ forward éƒ¨åˆ†ä¹‹åæ±‡èšçš„é“¾è·¯ä¸Šï¼Œè¿˜æœ‰ä¸€ä¸ªè·¯ç”±ç­–è®º routing decision çš„ï¼Ÿä½†æ˜¯è¿™é‡Œä¸èƒ½ä¼ å›¾ï¼Œä¼ ä¸ä¸Šæ¥ç»™ä½ çœ‹ã€‚","like_count":3},{"had_liked":false,"id":160927,"user_name":"ç‚å‘ç¼çœ¼","can_delete":false,"product_type":"c1","uid":1425953,"ip_address":"","ucode":"7D195057C8E94C","user_header":"https://static001.geekbang.org/account/avatar/00/15/c2/21/a8ef82ac.jpg","comment_is_top":false,"comment_ctime":1576062480,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"10165997072","product_id":100007101,"comment_content":"è€å¸ˆï¼Œæœ‰ä¸ªé—®é¢˜å®åœ¨æ˜¯æ²¡ç†è§£ï¼Œæ–‡ä¸­è¿™å¥è¯ï¼š<br>å¯ä»¥å¤šåŠ ä¸€ä¸ªç½‘æ¡¥ï¼Œåœ¨è¿™ä¸ªç½‘æ¡¥ä¸Šé…ç½® iptables è§„åˆ™ï¼Œå°†åœ¨ç”¨æˆ·åœ¨ç•Œé¢ä¸Šé…ç½®çš„è§„åˆ™ï¼Œæ”¾åˆ°è¿™ä¸ªç½‘æ¡¥ä¸Šã€‚ç„¶ååœ¨æ¯å°æœºå™¨ä¸Šè·‘ä¸€ä¸ª Agentï¼Œå°†ç”¨æˆ·é…ç½®çš„å®‰å…¨ç»„å˜æˆ iptables è§„åˆ™ï¼Œé…ç½®åœ¨è¿™ä¸ªç½‘æ¡¥ä¸Šã€‚<br>å¦‚æœç…§ä¸Šé¢é‚£ä¸ªå›¾æ¥çœ‹çš„è¯ï¼Œæ˜¯å¤šåŠ çš„è¿™ä¸ªç½‘æ¡¥æ˜¯br1ï¼ŸæŠŠè§„åˆ™éƒ½æ”¾åœ¨è¿™ä¸ªç½‘æ¡¥ä¸Šï¼Ÿé‚£æ¯ä¸ªæœºå™¨éƒ½è·‘ä¸€ä¸ªAgentæ˜¯ç‰©ç†æœºè·‘çš„è¿˜æ˜¯æ¯ä¸ªè™šæ‹Ÿæœºè·‘çš„ï¼Ÿå˜æˆiptablesè§„åˆ™åï¼Œé…ç½®åœ¨è¿™ä¸ªç½‘æ¡¥ä¸Šï¼ŒæŒ‡çš„æ˜¯br0ï¼Ÿé‚£è¿™äº›è§„åˆ™æ˜¯æ€ä¹ˆä¸‹å‘åˆ°è™šæ‹Ÿæœºä¸Šçš„ï¼Œè¿˜æ˜¯è¯´å°±ä¸ä¸‹å‘è™šæ‹Ÿæœºäº†ï¼Œåœ¨br0ä¸Šå°±å·²ç»åšäº†å®‰å…¨è¿‡æ»¤ï¼Œæ¯ä¸ªè™šæ‹Ÿæœºä¸Šæ˜¯æ²¡æœ‰iptablesè§„åˆ™çš„ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1303865,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e5/39/951f89c8.jpg","nickname":"ä¿¡ä¿¡","note":"","ucode":"8DF0EC045579FD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":242868,"discussion_content":"æˆ‘ä¹Ÿå¾ˆç–‘æƒ‘è¿™é‡Œï¼Œäºæ˜¯æœåˆ°ä»¥ä¸‹ï¼šå¯¹ä¸€å°æœºå™¨ä¸Šçš„è™šæ‹Ÿæœºè€Œè¨€ï¼ŒäºŒå±‚äº’é€šï¼Œæ‰€ä»¥åªéœ€è¦åœ¨ç‰©ç†æœºå±‚é¢ï¼Œå¤šåŠ ä¸€ä¸ªç½‘æ¡¥ï¼Œå°†ä¸€ä¸ªå®‰å…¨ç»„çš„ç‰©ç†æœºè¿æ¥èµ·æ¥ï¼Œç»Ÿä¸€åœ¨è¿™ä¸ªç½‘æ¡¥ä¸Šé€šè¿‡iptablesé…ç½®å®‰å…¨ç»„è§„åˆ™ï¼Œç„¶ååœ¨æ¯å°æœºå™¨ä¸Šè·‘ä¸€ä¸ªagentç¨‹åºï¼Œå°†ç½‘æ¡¥ä¸Šçš„å®‰å…¨ç»„è§„åˆ™å˜æˆæœºå™¨å†…éƒ¨çš„iptablesè§„åˆ™ï¼Œå®ç°ç»Ÿä¸€ä¸‹å‘ã€‚å½“ç„¶ï¼Œé™¤äº†filterå®‰å…¨ç»„ï¼Œiptablesè¿˜å¯ä»¥natäº‘å¹³å°è™šæ‹Ÿæœºï¼Œå®ç°ä¸å¤–éƒ¨é€šä¿¡ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1587487059,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1452167,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJcwXucibksEYRSYg6icjibzGa7efcMrCsGec2UwibjTd57icqDz0zzkEEOM2pXVju60dibzcnQKPfRkN9g/132","nickname":"Geek_93970d","note":"","ucode":"52AC308BEC7737","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1303865,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e5/39/951f89c8.jpg","nickname":"ä¿¡ä¿¡","note":"","ucode":"8DF0EC045579FD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584644,"discussion_content":"æ„æ€æ˜¯ä¸“é—¨å¼€ä¸€ä¸ªåé—¨ç”¨æ¥åšé…ç½®ç®¡ç†å·¥ä½œï¼Ÿè€Œä¸”å¬èµ·æ¥è¿™ä¸ª agent åº”è¯¥æ˜¯è·‘åœ¨è™šæ‹Ÿæœºé‡Œå§ï¼Ÿè¿˜æ˜¯ç‰©ç†æœºå‘¢ï¼Ÿå¦å¤–ï¼Œä¸ºä»€ä¹ˆéå¾—å¼€ä¸€ä¸ªæ–°çš„ç½‘æ¡¥å‘¢ï¼Ÿç”¨åŸæ¥çš„ç½‘æ¡¥ä¸è¡Œå—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660986297,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":242868,"ip_address":"åŒ—äº¬"},"score":584644,"extra":""}]},{"author":{"id":1452167,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJcwXucibksEYRSYg6icjibzGa7efcMrCsGec2UwibjTd57icqDz0zzkEEOM2pXVju60dibzcnQKPfRkN9g/132","nickname":"Geek_93970d","note":"","ucode":"52AC308BEC7737","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584643,"discussion_content":"æ„æ€æ˜¯ä¸“é—¨å¼€ä¸€ä¸ªåé—¨ç”¨æ¥åšé…ç½®ç®¡ç†å·¥ä½œï¼Ÿè€Œä¸”å¬èµ·æ¥è¿™ä¸ª agent åº”è¯¥æ˜¯è·‘åœ¨è™šæ‹Ÿæœºé‡Œå§ï¼Ÿè¿˜æ˜¯ç‰©ç†æœºå‘¢ï¼Ÿå¦å¤–ï¼Œä¸ºä»€ä¹ˆéå¾—å¼€ä¸€ä¸ªæ–°çš„ç½‘æ¡¥å‘¢ï¼Ÿç”¨åŸæ¥çš„ç½‘æ¡¥ä¸è¡Œå—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660986287,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":17456,"user_name":"balancer","can_delete":false,"product_type":"c1","uid":1145758,"ip_address":"","ucode":"A865FAFF2FE1FA","user_header":"https://static001.geekbang.org/account/avatar/00/11/7b/9e/37d69ff0.jpg","comment_is_top":false,"comment_ctime":1532656428,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10122591020","product_id":100007101,"comment_content":"è€å¸ˆï¼Œåé¢èƒ½ä¸èƒ½åŠ ç‚¹å¯¹ç½‘ç»œçš„æ£€æµ‹ï¼Œæ’æŸ¥æ¡ˆä¾‹ï¼Œè¯¾ç¨‹å°±å®Œæ•´äº†","like_count":2},{"had_liked":false,"id":16022,"user_name":"å‹¤åŠ³çš„å°èƒ–å­-libo","can_delete":false,"product_type":"c1","uid":1158344,"ip_address":"","ucode":"5BB20CD5A56568","user_header":"https://static001.geekbang.org/account/avatar/00/11/ac/c8/4b1c0d40.jpg","comment_is_top":false,"comment_ctime":1531745466,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10121680058","product_id":100007101,"comment_content":"è¿™ç« æ€»ç»“å¤ªç»™åŠ›äº†ï¼Œå¾ˆå–œæ¬¢ğŸ’•<br><br>é‡Œé¢çš„æœºæˆ¿ç½‘ipå°±æ˜¯ç‰©ç†ç½‘ipåœ°å€å§ï¼Ÿ","like_count":2},{"had_liked":false,"id":15980,"user_name":"é­å³°","can_delete":false,"product_type":"c1","uid":1146412,"ip_address":"","ucode":"33F5D09C64D4C4","user_header":"https://static001.geekbang.org/account/avatar/00/11/7e/2c/54d68da4.jpg","comment_is_top":false,"comment_ctime":1531704626,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10121639218","product_id":100007101,"comment_content":"æçº²æŒˆé¢†ï¼ŒæŠŠä»¥å‰å­¦çš„ä¸œè¥¿éƒ½èæ±‡è´¯é€šäº†ã€‚å¦‚æœæƒ³è¦æŠŠè¿™äº›çŸ¥è¯†å¾€æ·±é‡Œé¢å­¦å­¦ï¼Œçœ‹çœ‹æœ‰å•¥å¥½çš„å»ºè®®æ²¡","like_count":2},{"had_liked":false,"id":334185,"user_name":"é˜¿æ£ ","can_delete":false,"product_type":"c1","uid":1222354,"ip_address":"","ucode":"4C62FF98BCD925","user_header":"https://static001.geekbang.org/account/avatar/00/12/a6/d2/ebe20bb5.jpg","comment_is_top":false,"comment_ctime":1644803177,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5939770473","product_id":100007101,"comment_content":"conntracké€šè¿‡â€œæº &#47; ç›®çš„ IP+ æº &#47; ç›®çš„ç«¯å£â€å”¯ä¸€æ ‡è¯†ä¸€æ¡è¿æ¥ï¼Œä½†æ˜¯å“åº”å›æ¥çš„æ—¶å€™ï¼Œæ€ä¹ˆå¯¹åº”å›æ¥è¿™æ¡å”¯ä¸€æ ‡è¯†å‘¢ï¼Ÿ","like_count":1},{"had_liked":false,"id":170595,"user_name":"lji","can_delete":false,"product_type":"c1","uid":1724244,"ip_address":"","ucode":"5791B86037F129","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/zxrG3SKctHcdRcCw5Z3W5Ur0Opaziaj6r6otPpmzZrdIFf5Ref5dyEZQALa7DXn3ViaeWiaTiaeghQA4R5ib8x74JYg/132","comment_is_top":false,"comment_ctime":1578640501,"is_pvip":true,"replies":[{"id":"66274","content":"çš„ç¡®å°±æ²¡åŠæ³•è®¿é—®äº†ã€‚ä½†æ˜¯å¾ˆå°‘æœ‰ä¸€ä¸ªç½‘ç»œå†…éƒ¨æœ‰6ä¸‡ä¸ªã€‚å°±ç®—æ˜¯ä¸€ä¸ªå…¬å¸ï¼Œä¹Ÿä¸ä¼šè¶…è¿‡6ä¸‡ä¸ªå…±ç”¨ä¸€ä¸ªsnatç½‘å…³","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘","uid":"1001590","ctime":1578823684,"ip_address":"","comment_id":170595,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5873607797","product_id":100007101,"comment_content":"ä¸€ç‚¹ç–‘é—®ï¼šå¦‚æœè¯´å¤šäººå…±äº«ä¸€ä¸ª IP è®¿é—® 163.comï¼Œé€šè¿‡ Snat è½¬æ¢å‡ºå»ä¹‹åæ˜¯<br>â€œæº &#47; ç›®çš„ IP+ æº &#47; ç›®çš„ç«¯å£â€ ä½œä¸ºå”¯ä¸€è¡¨ç¤ºè®¿é—®ï¼Œä¸€ä¸ªä¸»æœºçš„å¯ç”¨ç«¯å£æ˜¯ 65536-1024 ä¸ªï¼Œé‚£ä¹ˆæ˜¯å¦æ„å‘³è€…å½“å¹¶å‘è¶…è¿‡è¿™ä¸ªæ•°æ—¶ï¼Œæ¯”å¦‚ä¸€ä¸ª å…¬ç½‘IP å†…æ‰€æœ‰ç”¨æˆ·åŒæ—¶è®¿é—® 163.com è¶…è¿‡65536-1024 ä¸ªï¼Œé‚£ä¹ˆè¿è¥å•†çš„ç«¯å£ä¸å¤Ÿç”¨ï¼Œæ­¤æ—¶ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481032,"discussion_content":"çš„ç¡®å°±æ²¡åŠæ³•è®¿é—®äº†ã€‚ä½†æ˜¯å¾ˆå°‘æœ‰ä¸€ä¸ªç½‘ç»œå†…éƒ¨æœ‰6ä¸‡ä¸ªã€‚å°±ç®—æ˜¯ä¸€ä¸ªå…¬å¸ï¼Œä¹Ÿä¸ä¼šè¶…è¿‡6ä¸‡ä¸ªå…±ç”¨ä¸€ä¸ªsnatç½‘å…³","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578823684,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":165829,"user_name":"DFighting","can_delete":false,"product_type":"c1","uid":1233193,"ip_address":"","ucode":"F3BA2426FF8582","user_header":"https://static001.geekbang.org/account/avatar/00/12/d1/29/1b1234ed.jpg","comment_is_top":false,"comment_ctime":1577328603,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5872295899","product_id":100007101,"comment_content":"è™½ç„¶æˆ‘ä¸æ˜¯ç½‘ç»œè¿ç»´äººå‘˜ï¼Œä½†æ˜¯æœ¬ç§‘ä¸»è¦å°±æ˜¯ç ”ç©¶ç½‘å’¯çš„ï¼Œæ‰€ä»¥ç°åœ¨çœ‹è¿™äº›å…¥é—¨çš„ç†è®ºè¿˜æ˜¯å¾ˆäº²åˆ‡çš„ï¼Œä¸€ç›´æ„Ÿè§‰å¼€å‘è¿™æ¡è·¯è¶Šèµ°åˆ°åé¢ï¼Œ408åŸºç¡€çš„é‚£å‡ é—¨è¯¾æ‰€å¸¦æ¥çš„çš„ç”¨å¤„å°±è¶Šå¤§ï¼Œå› ä¸ºåªæœ‰åŸºçŸ³æ‰“ç‰¢äº†æ‰èƒ½ä¸æ–­æˆé•¿ï¼Œæ˜å¹´å°±è¦æ¯•ä¸šäº†ï¼Œè¶ç€è¿˜æ²¡å…¥èŒèµ¶å¿«è¡¥è¡¥è¿™äº›åŸºç¡€çŸ¥è¯†ï¼Œè™½ç„¶æ²¡æœºä¼šå®è·µï¼Œä½†çŸ¥é“æœ‰è¿™äº›ä¸œè¥¿ï¼Œä»¥åé‡åˆ°äº†é—®é¢˜è‡³å°‘ä¼šæœ‰äº›å­¦ä¹ çš„æ–¹å‘ã€‚<br>ps:è€å¸ˆçš„LinuxåŠŸåº•çœŸå¼ºï¼Œæœ€å¼€å§‹ä¹°çš„æ˜¯åˆ˜è€å¸ˆçš„Linuxæ“ä½œç³»ç»Ÿè¯¾ï¼Œå°è¯•çœ‹äº†ä¸‰æ¬¡ï¼Œå®åœ¨æ˜¯çœ‹ä¸ä¸‹å»ï¼Œç„¶åä¹°äº†è¿™é—¨è¯¾ï¼ŒæŸå¤©æƒŠå–œåœ°å‘ç°å°½ç„¶éƒ½æ˜¯åˆ˜è€çš„è¯¾ï¼ŒçœŸæ˜¯é¡¶çº§å¤§ä½¬å•Š","like_count":1},{"had_liked":false,"id":357898,"user_name":"Vikee","can_delete":false,"product_type":"c1","uid":2034285,"ip_address":"åŒ—äº¬","ucode":"17BF7DAD4F7E37","user_header":"https://static001.geekbang.org/account/avatar/00/1f/0a/6d/f9016796.jpg","comment_is_top":false,"comment_ctime":1663737500,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1663737500","product_id":100007101,"comment_content":"å¤§å­¦çš„æ—¶å€™åœ¨å›¾ä¹¦é¦†é‡Œé‡åˆ°é™ˆå‹‡å‹‹çš„ã€Šæ›´å®‰å…¨çš„Linuxç½‘ç»œã€‹ï¼Œå½“æ—¶çŸ¥è¯†é¢ä¸å…¨ï¼Œä½†æ˜¯åªè§‰å¾—ä½œè€…å†™çš„å¾ˆå¥½ï¼Œå¾ˆæ¸…æ™°ï¼Œå¾ˆæ„¿æ„è¯»ã€‚æ—¶éš”ä¸‰å¹´ï¼Œåœ¨è¿™é‡Œå»ºæ„ç½‘ç»œçŸ¥è¯†ç»“æ„çš„æ—¶å€™ï¼Œåˆé‡åˆ°äº†é‡Œé¢æåŠçš„å†…å®¹-iptablesã€‚ä¸€ä¸‹å­è§‰å¾—å¾ˆäº²åˆ‡ï¼Œè¿™ä¸€ç« å†…å®¹æˆ‘å‡ ä¹æ˜¯å…´å¥‹çš„è¯»ä¸‹æ¥çš„ï¼Œå¯¹ä»¥å‰ä¸ç†è§£çš„åœ°æ–¹ä¹Ÿæœ‰äº†æ›´æ·±çš„ç†è§£ï¼Œæ„Ÿè°¢ã€‚","like_count":0},{"had_liked":false,"id":350307,"user_name":"Ethan","can_delete":false,"product_type":"c1","uid":1276373,"ip_address":"","ucode":"016F1DEBA895B8","user_header":"https://static001.geekbang.org/account/avatar/00/13/79/d5/4a7971fc.jpg","comment_is_top":false,"comment_ctime":1656773254,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1656773254","product_id":100007101,"comment_content":"ç»™å¤§å®¶ä¸¾ä¸€ä¸ª SNAT å’Œ DNAT çš„ä¾‹å­ï¼Œä¾¿äºç†è§£ï¼š<br><br>A æ˜¯å†…ç½‘æœåŠ¡å™¨ IP åœ°å€ 192.168.1.1.<br>B æ˜¯äº’è”ç½‘ IP åœ°å€ï¼Œ3.3.3.3.<br>A è¿æ¥ä¸€ä¸ª NAT ç½‘å…³ C 10.1.1.1,  C æ‹¥æœ‰ä¸€ä¸ªç©ºé—²å…¬æœ‰ IP 2.2.2.2.<br>è¿™é‡Œæˆ‘ä»¬æœŸå¾… A å¯ä»¥é€šè¿‡ NAT ä½¿ç”¨ 2.2.2.2 å…¬ç½‘ IP ä¸Šåˆå’Œ B é€šä¿¡ã€‚<br>---<br>åœ¨ A PING 3.3.3.3ï¼š<br><br>A - &gt; B - &gt; C å‘é€æ•°æ®åŒ…å˜åŒ–è¿‡ç¨‹ï¼š<br><br>å‘åŒ…è¿‡ç¨‹ï¼š<br>A -&gt; Bï¼šsrcï¼š192.168.1.1 dst:3.3.3.3<br>B -&gt; C:  srcï¼š2.2.2.2 dst:3.3.3.3 ï¼ˆB è¿›è¡Œäº† SNATï¼‰<br><br>C - &gt; B - &gt; A å›åŒ…è¿‡ç¨‹ï¼š<br>C - &gt; Bï¼šsrcï¼š3.3.3.3 dst:2.2.2.2<br>B -&gt; A:  srcï¼š192.168.1.1 dst:3.3.3.3 ï¼ˆB è¿›è¡Œäº† DNATï¼‰<br><br>å¯ä»¥å‘ç°æ— è®ºæ˜¯ snat è¿˜æ˜¯ dnat å…¶å®æŒ‡çš„éƒ½æ˜¯å¯¹å†…ç½‘ local åœ°å€ 192.168.1.1 åšçš„è½¬åŒ–ï¼Œå‘åŒ…è‡ªç„¶æ˜¯æºï¼Œå›åŒ…è‡ªç„¶æ˜¯ç›®çš„ã€‚<br><br><br>","like_count":0},{"had_liked":false,"id":349498,"user_name":"xj111","can_delete":false,"product_type":"c1","uid":1192268,"ip_address":"","ucode":"FC5786846F0919","user_header":"https://static001.geekbang.org/account/avatar/00/12/31/4c/17b9726f.jpg","comment_is_top":false,"comment_ctime":1655999747,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1655999747","product_id":100007101,"comment_content":"è€å¸ˆï¼Œæœ‰ä¸ªç–‘é—®ï¼ŒSnatçš„åœºæ™¯æ˜¯ä¸æ˜¯å†…ç½‘åªèƒ½è®¿é—®å¤–ç½‘ï¼Œä½†æ˜¯å¤–ç½‘ä¸èƒ½è®¿é—®å†…ç½‘ï¼Œè¿™æ˜¯åœ¨tcpå»ºç«‹è¿æ¥ç”¨åˆ°äº†ï¼Œå»ºç«‹è¿æ¥åæ•°æ®æ˜¯åŒå‘ä¼ è¾“çš„æ˜¯å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":309833,"user_name":"Trident","can_delete":false,"product_type":"c1","uid":1609530,"ip_address":"","ucode":"53E6788CF33398","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/l4nngwyggBGqeMXC0micwO8bM1hSttgQXa1Y5frJSqWa8NibDhia5icwPcHM5wOpV3hfsf0UicDY0ypFqnQ3iarG0T1w/132","comment_is_top":false,"comment_ctime":1630368251,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630368251","product_id":100007101,"comment_content":"ä»¥å‰åªçŸ¥é“iptablesç”¨æ¥åšæ§åˆ¶å®‰å…¨ï¼ŒåŸæ¥è¿˜æœ‰é‚£ä¹ˆå¤šåŠŸèƒ½","like_count":0},{"had_liked":false,"id":254807,"user_name":"åˆ˜æ˜“ä¹‹","can_delete":false,"product_type":"c1","uid":1909024,"ip_address":"","ucode":"1CDC3E98B92CE3","user_header":"https://static001.geekbang.org/account/avatar/00/1d/21/20/d7f5bb18.jpg","comment_is_top":false,"comment_ctime":1603189351,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1603189351","product_id":100007101,"comment_content":"iptables ä½œä¸ºå†…æ ¸éƒ¨åˆ†,ç»è¿‡å¦‚æ­¤å¤šå¯¹åŒ…çš„æŸ¥çœ‹åŠä¿®æ”¹,å¦‚æœå•ä¸ªæœåŠ¡å™¨çš„è™šæ‹Ÿç½‘ç»œè®¾å¤‡å¤šäº†,åŠ¿å¿…ä¼šé€ æˆä¸¥é‡çš„æ€§èƒ½ä¸‹é™å§? ","like_count":0,"discussions":[{"author":{"id":1793361,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/5d/51/87fc7ef9.jpg","nickname":"Issacæ…œ","note":"","ucode":"690B69FC1C0BB2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379935,"discussion_content":"æ‰€ä»¥å°±å‡ºç°äº†ç¡¬ä»¶é˜²ç«å¢™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624253410,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":228234,"user_name":"æœ±å›½ä¼Ÿ","can_delete":false,"product_type":"c1","uid":1083343,"ip_address":"","ucode":"A8547956D9C372","user_header":"https://static001.geekbang.org/account/avatar/00/10/87/cf/7bec93d8.jpg","comment_is_top":false,"comment_ctime":1592621233,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1592621233","product_id":100007101,"comment_content":"&quot;iptables -t nat -A -s ç§ç½‘ IP -j Snat --to-source å¤–ç½‘ IP&quot;<br>æ˜¯ä¸æ˜¯å°‘äº†ä¸€ä¸ªPOSTROUTINGå•Š","like_count":0},{"had_liked":false,"id":228233,"user_name":"æœ±å›½ä¼Ÿ","can_delete":false,"product_type":"c1","uid":1083343,"ip_address":"","ucode":"A8547956D9C372","user_header":"https://static001.geekbang.org/account/avatar/00/10/87/cf/7bec93d8.jpg","comment_is_top":false,"comment_ctime":1592621215,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1592621215","product_id":100007101,"comment_content":"&quot;iptables -t nat -A -s ç§ç½‘ IP -j Snat --to-source å¤–ç½‘ IP&quot;","like_count":0},{"had_liked":false,"id":217141,"user_name":"Bitstream","can_delete":false,"product_type":"c1","uid":1434089,"ip_address":"","ucode":"51FB631A70B52C","user_header":"https://static001.geekbang.org/account/avatar/00/15/e1/e9/29b62c57.jpg","comment_is_top":false,"comment_ctime":1589425264,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589425264","product_id":100007101,"comment_content":"iptablesè®²çš„å¾ˆç²¾å½©","like_count":0},{"had_liked":false,"id":207756,"user_name":"TrulyLiang","can_delete":false,"product_type":"c1","uid":1926460,"ip_address":"","ucode":"716830B78DC0D7","user_header":"https://static001.geekbang.org/account/avatar/00/1d/65/3c/62510a1e.jpg","comment_is_top":false,"comment_ctime":1587174853,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587174853","product_id":100007101,"comment_content":"æ–‡ä¸­æåˆ°â€œè¿™æ˜¯è™šæ‹Ÿæœºåšå®¢æˆ·ç«¯çš„æƒ…å†µï¼Œå¦‚æœè™šæ‹ŸæœºåšæœåŠ¡å™¨å‘¢ï¼Ÿä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè™šæ‹Ÿæœºé‡Œé¢éƒ¨ç½²çš„å°±æ˜¯ 163 ç½‘ç«™å‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™å°±éœ€è¦ç»™è¿™ä¸ªç½‘ç«™é…ç½®å›ºå®šçš„ç‰©ç†ç½‘çš„ IP åœ°å€å’Œå…¬ç½‘ IP åœ°å€äº†ã€‚è¿™æ—¶å€™å°±éœ€è¦è¯¦ç»†é…ç½® Snat è§„åˆ™å’Œ Dnat è§„åˆ™äº†ã€‚â€   è¯·é—®ä¸€ä¸‹è¿™é‡Œæåˆ°çš„IPåœ°å€NATåº”ç”¨æ˜¯åœ¨ç½‘å…³åšçš„æ˜¯å—ï¼Ÿé‚£è¿™ä¸ªç½‘å…³åˆæ˜¯èµ·åœ¨é‚£é‡Œçš„å‘¢ï¼Œåˆæ˜¯åœ¨é‚£é‡Œå®ç°çš„å‘¢ï¼Ÿè¯·è€å¸ˆå¸®å¿™è§£ç­”ä¸€ä¸‹ï¼Œè°¢è°¢ã€‚","like_count":0},{"had_liked":false,"id":196799,"user_name":"25ma","can_delete":false,"product_type":"c1","uid":1303713,"ip_address":"","ucode":"AB5435B9DB52C9","user_header":"https://static001.geekbang.org/account/avatar/00/13/e4/a1/178387da.jpg","comment_is_top":false,"comment_ctime":1585315032,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585315032","product_id":100007101,"comment_content":"ilterè¡¨ï¼šè´Ÿè´£è¿‡æ»¤åŠŸèƒ½ï¼Œé˜²ç«å¢™ï¼›å†…æ ¸æ¨¡å—ï¼šiptables_filter<br>natè¡¨ï¼šnetwork address translationï¼Œç½‘ç»œåœ°å€è½¬æ¢åŠŸèƒ½ï¼›å†…æ ¸æ¨¡å—ï¼šiptable_nat<br>mangleè¡¨ï¼šæ‹†è§£æŠ¥æ–‡ï¼Œåšå‡ºä¿®æ”¹ï¼Œå¹¶é‡æ–°å°è£… çš„åŠŸèƒ½ï¼›iptable_mangle<br>rawè¡¨ï¼šå…³é—­natè¡¨ä¸Šå¯ç”¨çš„è¿æ¥è¿½è¸ªæœºåˆ¶ï¼›iptable_raw","like_count":0},{"had_liked":false,"id":196793,"user_name":"25ma","can_delete":false,"product_type":"c1","uid":1303713,"ip_address":"","ucode":"AB5435B9DB52C9","user_header":"https://static001.geekbang.org/account/avatar/00/13/e4/a1/178387da.jpg","comment_is_top":false,"comment_ctime":1585314043,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585314043","product_id":100007101,"comment_content":"ç½‘ç»œå®‰å…¨çš„ç¡®æ˜¯å¤ªé‡è¦äº†ï¼Œå¾—å¥½å¥½è®¤çœŸå­¦ä¹ ","like_count":0},{"had_liked":false,"id":194954,"user_name":"King-ZJ","can_delete":false,"product_type":"c1","uid":1915385,"ip_address":"","ucode":"7448A4BBB5A118","user_header":"https://static001.geekbang.org/account/avatar/00/1d/39/f9/b946719a.jpg","comment_is_top":false,"comment_ctime":1585123700,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585123700","product_id":100007101,"comment_content":"è¿™ä¸€èŠ‚é€šè¿‡iptableså‘½ä»¤å®ç°ä¸€äº›åŠŸèƒ½ï¼Œè¿˜æ˜¯å¾—å¤šå®è·µï¼Œè¿›ä¸€æ­¥å»ç†Ÿæ‚‰ï¼Œä¹Ÿå¤šçœ‹å‡ éï¼Œå¤šäº†è§£äº†è§£ã€‚","like_count":0},{"had_liked":false,"id":183221,"user_name":"kissrain","can_delete":false,"product_type":"c1","uid":1120583,"ip_address":"","ucode":"2177C53E3B2DCC","user_header":"https://static001.geekbang.org/account/avatar/00/11/19/47/b27f1314.jpg","comment_is_top":false,"comment_ctime":1582975679,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582975679","product_id":100007101,"comment_content":"ä¸€ç‚¹ç–‘é—®ï¼šå½“å¤–éƒ¨è®¿é—®è¿›æ¥çš„æ—¶å€™ï¼Œå¤–ç½‘ç½‘å£ä¼šé€šè¿‡ Dnat è§„åˆ™å°†å…¬ç½‘ IP åœ°å€è½¬æ¢ä¸ºç§ç½‘ IP åœ°å€ï¼Œè¿™é‡Œçš„å…¬ç½‘IPå’Œç§ç½‘ IP æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»å—ï¼Ÿå¦‚æœæ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦è¿›è¡Œè½¬æ¢å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":159076,"user_name":"é¥­ç²’","can_delete":false,"product_type":"c1","uid":1153455,"ip_address":"","ucode":"4C3220B0D43997","user_header":"https://static001.geekbang.org/account/avatar/00/11/99/af/d29273e2.jpg","comment_is_top":false,"comment_ctime":1575533348,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575533348","product_id":100007101,"comment_content":"è¿™ç¯‡è§£æƒ‘é¢‡å¤šï¼Œå¼€å¿ƒã€‚","like_count":0},{"had_liked":false,"id":138862,"user_name":"å†·èƒæµ®ä¹æœµ","can_delete":false,"product_type":"c1","uid":1134525,"ip_address":"","ucode":"5C3BCBD9E5973D","user_header":"https://static001.geekbang.org/account/avatar/00/11/4f/bd/e08af2e9.jpg","comment_is_top":false,"comment_ctime":1570494994,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570494994","product_id":100007101,"comment_content":"å°†å®‰å…¨ç»„è§„åˆ™æ‰¹é‡ä¸‹å‘çš„é‚£å¼ å›¾ä¸Šï¼Œè§„åˆ™æ˜¯é…ç½®åœ¨br0è¿˜æ˜¯br1å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":122985,"user_name":"ALAN","can_delete":false,"product_type":"c1","uid":1240164,"ip_address":"","ucode":"70E3B1C730E63F","user_header":"https://static001.geekbang.org/account/avatar/00/12/ec/64/7403c694.jpg","comment_is_top":false,"comment_ctime":1565582363,"is_pvip":false,"replies":[{"id":"46316","content":"ä¼šå­˜åœ¨çš„","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘","uid":"1001590","ctime":1566288005,"ip_address":"","comment_id":122985,"utype":1}],"discussion_count":4,"race_medal":0,"score":"1565582363","product_id":100007101,"comment_content":"è€å¸ˆï¼Œmacåœ°å€ä¸€æ ·çš„ï¼Œipåœ°å€æ€ä¹ˆè¿˜ä¼šä¸ä¸€æ ·äº†ï¼Ÿå› ä¸ºmacåœ°å€æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥åº”è¯¥ä¸ä¼šå­˜åœ¨macåœ°å€ç›¸åŒçš„å¤šä¸ªipåœ°å€æŠŠï¼Ÿæ‰€ä»¥æ‚¨è¯´çš„forwardè½¬å‘æƒ…å†µåº”è¯¥ä¸å­˜åœ¨æŠŠ","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462489,"discussion_content":"ä¼šå­˜åœ¨çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566288005,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2976412,"avatar":"https://static001.geekbang.org/account/avatar/00/2d/6a/9c/de8f9280.jpg","nickname":"åˆšæ¯…åšå“","note":"","ucode":"6D16E587400F6F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572224,"discussion_content":"macåœ°å€æ˜¯ä½ çš„èº«ä»½è¯ï¼Œ IPåœ°å€æ˜¯ä½ æ‰€åœ¨çš„ä½ç½®ã€‚èº«ä»½è¯å”¯ä¸€ï¼Œä½†ä½ å¯ä»¥åœ¨å¤šä¸ªåœ°æ–¹ï¼Œä½ åœ¨ä¸åŒçš„åœ°æ–¹ä¼šå¯¹åº”ä¸åŒçš„IPåœ°å€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652664432,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2049638,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/46/66/6eaf229f.jpg","nickname":"james.S","note":"","ucode":"3437624A9FA805","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291054,"discussion_content":"ç½‘å¡å¯ä»¥é…ç½®ä¸¤ä¸ªip","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594693240,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1104611,"avatar":"https://static001.geekbang.org/account/avatar/00/10/da/e3/51295241.jpg","nickname":"ç†Šç†Š","note":"","ucode":"D4E5B5C4FCF059","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":215009,"discussion_content":"æˆ‘ä¹Ÿæœ‰è¿™ä¸ªç–‘æƒ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585271838,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121270,"user_name":"N_H","can_delete":false,"product_type":"c1","uid":1541386,"ip_address":"","ucode":"109B67557AB3CE","user_header":"https://static001.geekbang.org/account/avatar/00/17/85/0a/e564e572.jpg","comment_is_top":false,"comment_ctime":1565091599,"is_pvip":false,"replies":[{"id":"46350","content":"å¯ä»¥å›è¿‡å¤´å»å†çœ‹","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘","uid":"1001590","ctime":1566296708,"ip_address":"","comment_id":121270,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1565091599","product_id":100007101,"comment_content":"å¦‚æœå‰é¢çš„ä¸ç†è§£ï¼Œåˆ°è¿™é‡Œçš„æœ‰äº›ç»†èŠ‚ä¼šä¸ç†è§£","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461715,"discussion_content":"å¯ä»¥å›è¿‡å¤´å»å†çœ‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566296708,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86187,"user_name":"beiler","can_delete":false,"product_type":"c1","uid":1192989,"ip_address":"","ucode":"0A62FE86617486","user_header":"https://static001.geekbang.org/account/avatar/00/12/34/1d/169cd800.jpg","comment_is_top":false,"comment_ctime":1555320881,"is_pvip":false,"replies":[{"id":"49661","content":"æ¥å…¥åŒºåŸŸ","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘","uid":"1001590","ctime":1567696198,"ip_address":"","comment_id":86187,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555320881","product_id":100007101,"comment_content":"è€å¸ˆèƒ½é—®ä¸‹å†…å¤–ç½‘éš”ç¦»å¹²å˜›ç”¨çš„å—ï¼Ÿä¸ºä»€ä¹ˆè¦åšå†…å¤–ç½‘éš”ç¦»ï¼Ÿå¦‚æœåšæ¸—é€æµ‹è¯•çš„è¯æˆ‘ä»¬è®¾å¤‡åº”è¯¥éƒ¨ç½²åœ¨å“ªï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446910,"discussion_content":"æ¥å…¥åŒºåŸŸ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567696198,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":85297,"user_name":"dexter","can_delete":false,"product_type":"c1","uid":1315252,"ip_address":"","ucode":"DD51207438FBD6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEL5xnfuicbtRz4F87AAjZX6oCEjMtYiaIu4iaQichQmy0vEBA6Sumic1RDvUCeuBEqj6iatnt2kENbKYmuw/132","comment_is_top":false,"comment_ctime":1555031535,"is_pvip":false,"replies":[{"id":"49719","content":"è™šæ‹Ÿæœºåœ¨è¿œç«¯çš„è¯ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘","uid":"1001590","ctime":1567698522,"ip_address":"","comment_id":85297,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555031535","product_id":100007101,"comment_content":"è®¿é—®è™šæ‹Ÿæœºé‡Œé¢çš„163çš„æ—¶å€™ï¼Œä¸ºä»€ä¹ˆè¦åŒæ—¶åšdnatå’Œsnatå‘¢ï¼Ÿè¿”å›ç»“æœä¸èƒ½ç”¨conntracté“¾è·¯è·Ÿè¸ªæ–¹å¼ä¹ˆï¼Ÿä¹Ÿå°±æ˜¯ä¸éœ€è¦åšsnatäº†","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446619,"discussion_content":"è™šæ‹Ÿæœºåœ¨è¿œç«¯çš„è¯ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567698522,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":84040,"user_name":"è¶…è¶…","can_delete":false,"product_type":"c1","uid":1476077,"ip_address":"","ucode":"D0751F29553481","user_header":"https://static001.geekbang.org/account/avatar/00/16/85/ed/905b052f.jpg","comment_is_top":false,"comment_ctime":1554772674,"is_pvip":false,"replies":[{"id":"49784","content":"æ˜¯çš„ï¼Œå¯ä»¥äº¤ç»™ç”¨æˆ·æ€ï¼Œè‡ªå·±å¤„ç†","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘","uid":"1001590","ctime":1567701458,"ip_address":"","comment_id":84040,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554772674","product_id":100007101,"comment_content":"å›ç­”é—®é¢˜ä¸€ï¼šiptablesçš„è§„åˆ™æŒ‡å®šqueueï¼Œæ„æ€æ˜¯æŠŠç½‘ç»œæ•°æ®åŒ…é€å…¥åˆ°ç”¨æˆ·ç©ºé—´çš„æŒ‡å®šæ¶ˆæ¯é˜Ÿåˆ—IDï¼Œåœ¨ç”¨æˆ·ç©ºé—´å¯ä»¥è‡ªå·±ç¼–ç¨‹ï¼<br>iptablesè¿˜æœ‰æ‰©å±•çš„NFQUEUEï¼Œå¯ä»¥æŒ‡å®šåˆ†é…ç»™æŸä¸ªèŒƒå›´çš„å¤šä¸ªé˜Ÿåˆ—å·ï¼Œåœ¨ç”¨æˆ·æ€å¯ä»¥å®ç°æ›´é«˜çº§çš„è´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446227,"discussion_content":"æ˜¯çš„ï¼Œå¯ä»¥äº¤ç»™ç”¨æˆ·æ€ï¼Œè‡ªå·±å¤„ç†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567701458,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":83399,"user_name":"Garry","can_delete":false,"product_type":"c1","uid":1216548,"ip_address":"","ucode":"FB48A333342B91","user_header":"https://static001.geekbang.org/account/avatar/00/12/90/24/aa5146e4.jpg","comment_is_top":false,"comment_ctime":1554560069,"is_pvip":false,"replies":[{"id":"49903","content":"è¿™æ˜¯è™šæ‹Ÿçš„ç½‘æ¡¥ï¼Œä¸æ˜¯çº¯æ­£çš„äºŒå±‚è®¾å¤‡äº†","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘","uid":"1001590","ctime":1567781560,"ip_address":"","comment_id":83399,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554560069","product_id":100007101,"comment_content":"è€å¸ˆï¼Œæœ‰ä¸ªç–‘é—®ï¼Œæ‚¨åœ¨å®‰å…¨ç»„çš„ä¾‹å­ä¸­è¯´åœ¨ç½‘æ¡¥ä¸­ç»Ÿä¸€é…ç½®è§„åˆ™ï¼Œä½†æ˜¯ç½‘æ¡¥æ˜¯äºŒå±‚è®¾å¤‡ï¼Œåº”è¯¥å¯¹é“¾è·¯å±‚ä»¥ä¸Šæ˜¯é€æ˜çš„ï¼Œä¸ä¼šæ‹¿ä¸‹æ¥IPå¤´æ¥æŸ¥çœ‹ï¼Œé‚£iptablesçš„è§„åˆ™æ˜¯å¦‚ä½•åº”ç”¨åœ¨ç½‘æ¡¥ä¸Šå‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446008,"discussion_content":"è¿™æ˜¯è™šæ‹Ÿçš„ç½‘æ¡¥ï¼Œä¸æ˜¯çº¯æ­£çš„äºŒå±‚è®¾å¤‡äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567781560,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":37362,"user_name":"äººä¸‘å°±åº”å¤šè¯»ä¹¦","can_delete":false,"product_type":"c1","uid":1131393,"ip_address":"","ucode":"286E5A75EAAD5C","user_header":"https://static001.geekbang.org/account/avatar/00/11/43/81/1618d469.jpg","comment_is_top":false,"comment_ctime":1541556833,"is_pvip":false,"replies":[{"id":"13441","content":"è´Ÿè½½å‡è¡¡å®ç°æ–¹æ³•æ¯”è¾ƒå¤šï¼Œlvs, haproxyéƒ½å¯ä»¥","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘","uid":"1001590","ctime":1541596837,"ip_address":"","comment_id":37362,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1541556833","product_id":100007101,"comment_content":"è€å¸ˆæˆ‘æœ‰ä¸ªé—®é¢˜ï¼Œä¹‹å‰è®²äº†gslbçš„åŸç†ï¼Œé‚£ä¹ˆæœ¬åœ°è´Ÿè½½å‡è¡¡slbæ˜¯é€šè¿‡netfilterè¿›è¡Œçš„å®ç°å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428311,"discussion_content":"è´Ÿè½½å‡è¡¡å®ç°æ–¹æ³•æ¯”è¾ƒå¤šï¼Œlvs, haproxyéƒ½å¯ä»¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541596837,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":33116,"user_name":"å‘¨é£","can_delete":false,"product_type":"c1","uid":1073374,"ip_address":"","ucode":"F85FA236EB0C0D","user_header":"https://static001.geekbang.org/account/avatar/00/10/60/de/5c67895a.jpg","comment_is_top":false,"comment_ctime":1539746089,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1539746089","product_id":100007101,"comment_content":"æ„Ÿè°¢è€å¸ˆçš„è®²è§£ï¼Œä»¥å‰åªæ˜¯äº†è§£natçš„å¤§ä½“åŸç†ï¼Œç°åœ¨å¯¹æ•´ä¸ªè¿‡ç¨‹æœ‰äº†æ›´æ·±å…¥çš„äº†è§£ã€‚åŒæ—¶å¯¹äº‘ä¸»æœºçš„å®‰å…¨ç­–ç•¥å’Œå®ç°åŸç†æœ‰ä¸ªæ·±å…¥çš„è®¤è¯†ï¼Œè¿™é—¨è¯¾éå¸¸å€¼å¾—å­¦ç”Ÿå’Œç¨‹åºå‘˜å­¦ä¹ ã€‚","like_count":0},{"had_liked":false,"id":16721,"user_name":"å­¦å¾’ç‹å°æ˜","can_delete":false,"product_type":"c1","uid":1146223,"ip_address":"","ucode":"B3AE202003E415","user_header":"https://static001.geekbang.org/account/avatar/00/11/7d/6f/c1ceb673.jpg","comment_is_top":false,"comment_ctime":1532135974,"is_pvip":false,"replies":[{"id":"5812","content":"ä¸æ˜¯çš„ï¼Œè½¬æˆäº’è”ç½‘çš„å…¬ç½‘ip","user_name":"ä½œè€…å›å¤","user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘","uid":"1001590","ctime":1532162393,"ip_address":"","comment_id":16721,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1532135974","product_id":100007101,"comment_content":"è€å¸ˆï¼Œè¿è¥å•†åšSnatæ˜¯å°†ipv4è½¬ipv6å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420909,"discussion_content":"ä¸æ˜¯çš„ï¼Œè½¬æˆäº’è”ç½‘çš„å…¬ç½‘ip","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1532162393,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":16012,"user_name":"Hurt","can_delete":false,"product_type":"c1","uid":1050946,"ip_address":"","ucode":"DCE7428CCF08EF","user_header":"https://static001.geekbang.org/account/avatar/00/10/09/42/1f762b72.jpg","comment_is_top":false,"comment_ctime":1531738026,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1531738026","product_id":100007101,"comment_content":"ğŸ‘ğŸ‘ æœŸå¾…","like_count":0},{"had_liked":false,"id":15967,"user_name":"æ¢¦æƒ³å¯åŠ¨çš„èœ—ç‰›","can_delete":false,"product_type":"c1","uid":1111602,"ip_address":"","ucode":"781F2A6DA6FEB3","user_header":"https://static001.geekbang.org/account/avatar/00/10/f6/32/358f9411.jpg","comment_is_top":false,"comment_ctime":1531700665,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1531700665","product_id":100007101,"comment_content":"ç›´æ¥çœ‹å½©è›‹ğŸ˜‚","like_count":0},{"had_liked":false,"id":15965,"user_name":"æ‚Ÿç©ºèŠæ¶æ„","can_delete":false,"product_type":"c1","uid":1123163,"ip_address":"","ucode":"C2F482A0CF8AF1","user_header":"https://static001.geekbang.org/account/avatar/00/11/23/5b/983408b9.jpg","comment_is_top":false,"comment_ctime":1531700156,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1531700156","product_id":100007101,"comment_content":"çœ‹ç›´æ’­å•¦","like_count":0}]}