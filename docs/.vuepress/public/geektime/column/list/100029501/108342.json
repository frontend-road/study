{"id":108342,"title":"16丨游标：当我们需要逐条处理数据时，该怎么做？","content":"<p>我们在编写SQL语句的时候通常是面向集合进行思考，这种思考方式更让我们关注结果集的特征，而不是具体的实现过程。面向集合的思考方式与面向过程的思考方式各有特点，我们该如何理解它们呢？</p><p>我们用下面这张图开启今天的学习。这张图中一共有9个图形，每个图形有不同的特征，包括形状、纹理、颜色和个数等。</p><p><img src=\"https://static001.geekbang.org/resource/image/3d/8b/3daf9a9168ac825e9e7943843175bb8b.jpg?wh=605*466\" alt=\"\"><br>\n当我们看到这张图时，有时候会不由自主地按照某个属性进行分类，比如说按照红色分类，那么1、4、9就是一类。这实际上就是属于同一个条件下的查询结果集。或者我们也可以按照物体的个数来划分，比如都有3个物体的，那么对应的就是2、5、6、8，这就是对应着“都包括3个物体”的查询结果集。</p><p>你能看出来集合思维更像是从整体的角度来考虑，然后把整个数据集按照不同的属性进行划分，形成不同的子集合。面向集合的思考方式，让我们关注“获取什么”，而不是“如何获取”，这也可以说是SQL与传统编程最大的区别之一，因为SQL本身是以关系模型和集合论为基础的。</p><p>然而也有一些情况，我们不需要对查询结果集中的所有数据行都采用相同的处理方式，需要每次处理一行或者一部分行，这时就需要面向过程的编程方法了。游标就是这种编程方式的体现。如果你之前已经有了一些面向过程的编程经验，那么对于游标的理解也会比较容易。</p><!-- [[[read_end]]] --><p>关于游标，你需要掌握以下几个方面的内容：</p><ol>\n<li>什么是游标？我们为什么要使用游标？</li>\n<li>如何使用游标？使用游标的常用步骤都包括哪些？</li>\n<li>如何使用游标来解决一些常见的问题？</li>\n</ol><h2>什么是游标？</h2><p>在数据库中，游标是个重要的概念，它提供了一种灵活的操作方式，可以让我们从数据结果集中每次提取一条数据记录进行操作。游标让SQL这种面向集合的语言有了面向过程开发的能力。可以说，游标是面向过程的编程方式，这与面向集合的编程方式有所不同。</p><p>在SQL中，游标是一种临时的数据库对象，可以指向存储在数据库表中的数据行指针。这里游标充当了指针的作用，我们可以通过操作游标来对数据行进行操作。</p><p>比如我们查询了heros数据表中最大生命值大于8500的英雄都有哪些：</p><pre><code>SELECT id, name, hp_max FROM heros WHERE hp_max &gt; 8500\n</code></pre><p>查询结果（4条数据）：</p><p><img src=\"https://static001.geekbang.org/resource/image/04/c0/046f997b7d1b2ce6a64e65b728cca4c0.jpg?wh=659*363\" alt=\"\"></p><p>这里我们就可以通过游标来操作数据行，如图所示此时游标所在的行是“白起”的记录，我们也可以在结果集上滚动游标，指向结果集中的任意一行。</p><h2>如何使用游标？</h2><p>游标实际上是一种控制数据集的更加灵活的处理方式。</p><p>如果我们想要使用游标，一般需要经历五个步骤。不同DBMS中，使用游标的语法可能略有不同。</p><p>第一步，定义游标。</p><pre><code>DECLARE cursor_name CURSOR FOR select_statement\n</code></pre><p>这个语法适用于MySQL，SQL Server，DB2和MariaDB。如果是用Oracle或者PostgreSQL，需要写成：</p><pre><code>DECLARE cursor_name CURSOR IS select_statement\n</code></pre><p>要使用SELECT语句来获取数据结果集，而此时还没有开始遍历数据，这里select_statement代表的是SELECT语句。</p><p>下面我用MySQL举例讲解游标的使用，如果你使用的是其他的RDBMS，具体的游标语法可能略有差异。我们定义一个能够存储heros数据表中的最大生命值的游标，可以写为：</p><pre><code>DECLARE cur_hero CURSOR FOR \n\tSELECT hp_max FROM heros;\n</code></pre><p>第二步，打开游标。</p><pre><code>OPEN cursor_name\n</code></pre><p>当我们定义好游标之后，如果想要使用游标，必须先打开游标。打开游标的时候SELECT语句的查询结果集就会送到游标工作区。</p><p>第三步，从游标中取得数据。</p><pre><code>FETCH cursor_name INTO var_name ...\n</code></pre><p>这句的作用是使用cursor_name这个游标来读取当前行，并且将数据保存到var_name这个变量中，游标指针指到下一行。如果游标读取的数据行有多个列名，则在INTO关键字后面赋值给多个变量名即可。</p><p>第四步，关闭游标。</p><pre><code>CLOSE cursor_name\n</code></pre><p>有OPEN就会有CLOSE，也就是打开和关闭游标。当我们使用完游标后需要关闭掉该游标。关闭游标之后，我们就不能再检索查询结果中的数据行，如果需要检索只能再次打开游标。</p><p>最后一步，释放游标。</p><pre><code>DEALLOCATE cursor_namec \n</code></pre><p>有DECLARE就需要有DEALLOCATE，DEALLOCATE的作用是释放游标。我们一定要养成释放游标的习惯，否则游标会一直存在于内存中，直到进程结束后才会自动释放。当你不需要使用游标的时候，释放游标可以减少资源浪费。</p><p>上面就是5个常用的游标步骤。我来举一个简单的例子，假设我想用游标来扫描heros数据表中的数据行，然后累计最大生命值，那么该怎么做呢？</p><p>我先创建一个存储过程calc_hp_max，然后在存储过程中定义游标cur_hero，使用FETCH获取每一行的具体数值，然后赋值给变量hp，再用变量hp_sum做累加求和，最后再输出hp_sum，代码如下：</p><pre><code>CREATE PROCEDURE `calc_hp_max`()\nBEGIN\n       -- 创建接收游标的变量\n       DECLARE hp INT;  \n       -- 创建总数变量 \n       DECLARE hp_sum INT DEFAULT 0;\n       -- 创建结束标志变量  \n       DECLARE done INT DEFAULT false;\n       -- 定义游标     \n       DECLARE cur_hero CURSOR FOR SELECT hp_max FROM heros;\n       \n       OPEN cur_hero;\n       read_loop:LOOP \n       FETCH cur_hero INTO hp;\n       SET hp_sum = hp_sum + hp;\n       END LOOP;\n       CLOSE cur_hero;\n       SELECT hp_sum;\nEND\n</code></pre><p>你会发现执行<code>call calc_hp_max()</code>这一句的时候系统会提示1329错误，也就是在LOOP中当游标没有取到数据时会报的错误。</p><p>当游标溢出时（也就是当游标指向到最后一行数据后继续执行会报的错误），我们可以定义一个continue的事件，指定这个事件发生时修改变量done的值，以此来判断游标是否已经溢出，即：</p><pre><code>DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = true;  \n</code></pre><p>同时在循环中我们需要加上对done的判断，如果游标的循环已经结束，就需要跳出read_loop循环，完善的代码如下：</p><pre><code>CREATE PROCEDURE `calc_hp_max`()\nBEGIN\n       -- 创建接收游标的变量\n       DECLARE hp INT;  \n\n       -- 创建总数变量 \n       DECLARE hp_sum INT DEFAULT 0;\n       -- 创建结束标志变量  \n     DECLARE done INT DEFAULT false;\n       -- 定义游标     \n       DECLARE cur_hero CURSOR FOR SELECT hp_max FROM heros;\n       -- 指定游标循环结束时的返回值  \n     DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = true;  \n       \n       OPEN cur_hero;\n       read_loop:LOOP \n       FETCH cur_hero INTO hp;\n       -- 判断游标的循环是否结束  \n       IF done THEN  \n                     LEAVE read_loop;\n       END IF; \n              \n       SET hp_sum = hp_sum + hp;\n       END LOOP;\n       CLOSE cur_hero;\n       SELECT hp_sum;\nEND\n</code></pre><p>运行结果（1行数据）：</p><p><img src=\"https://static001.geekbang.org/resource/image/25/74/250fa19076fb9e55f801847815eb8674.png?wh=253*147\" alt=\"\"></p><p>在游标中的循环中，除了使用LOOP循环以外，你还可以使用REPEAT… UNTIL…以及WHILE循环。它们同样需要设置CONTINUE事件来处理游标溢出的情况。</p><p>所以你能看出，使用游标可以让我们对SELECT结果集中的每一行数据进行相同或者不同的操作，从而很精细化地管理结果集中的每一条数据。</p><p><strong>使用游标来解决一些常见的问题</strong></p><p>我刚才讲了一个简单的使用案例，实际上如果想要统计hp_sum，完全可以通过SQL语句来完成，比如：</p><pre><code>SELECT SUM(hp_max) FROM heros\n</code></pre><p>运行结果（1行数据）：</p><p><img src=\"https://static001.geekbang.org/resource/image/3b/9f/3b26582a9d86399c7b8c240e82369f9f.png?wh=273*150\" alt=\"\"><br>\n那么游标都有什么用呢？</p><p>当你需要处理一些复杂的数据行计算的时候，游标就会起到作用了。我举个例子，还是针对heros数据表，假设我们想要对英雄的物攻成长（对应attack_growth）进行升级，在新版本中大范围提升英雄的物攻成长数值，但是针对不同的英雄情况，提升的幅度也不同，具体提升的方式如下。</p><p>如果这个英雄原有的物攻成长小于5，那么将在原有基础上提升7%-10%。如果物攻成长的提升空间（即最高物攻attack_max-初始物攻attack_start）大于200，那么在原有的基础上提升10%；如果物攻成长的提升空间在150到200之间，则提升8%；如果物攻成长的提升空间不足150，则提升7%。</p><p>如果原有英雄的物攻成长在5—10之间，那么将在原有基础上提升5%。</p><p>如果原有英雄的物攻成长大于10，则保持不变。</p><p>以上所有的更新后的物攻成长数值，都需要保留小数点后3位。</p><p>你能看到上面这个计算的情况相对复杂，实际工作中你可能会遇到比这个更加复杂的情况，这时你可以采用面向过程的思考方式来完成这种任务，也就是说先取出每行的数值，然后针对数值的不同情况采取不同的计算方式。</p><p>针对上面这个情况，你自己可以用游标来完成转换，具体的代码如下：</p><pre><code>CREATE PROCEDURE `alter_attack_growth`()\nBEGIN\n       -- 创建接收游标的变量\n       DECLARE temp_id INT;  \n       DECLARE temp_growth, temp_max, temp_start, temp_diff FLOAT;  \n\n       -- 创建结束标志变量  \n       DECLARE done INT DEFAULT false;\n       -- 定义游标     \n       DECLARE cur_hero CURSOR FOR SELECT id, attack_growth, attack_max, attack_start FROM heros;\n       -- 指定游标循环结束时的返回值  \n       DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = true;  \n       \n       OPEN cur_hero;  \n       FETCH cur_hero INTO temp_id, temp_growth, temp_max, temp_start;\n       REPEAT\n                     IF NOT done THEN\n                            SET temp_diff = temp_max - temp_start;\n                            IF temp_growth &lt; 5 THEN\n                                   IF temp_diff &gt; 200 THEN\n                                          SET temp_growth = temp_growth * 1.1;\n                                   ELSEIF temp_diff &gt;= 150 AND temp_diff &lt;=200 THEN\n                                          SET temp_growth = temp_growth * 1.08;\n                                   ELSEIF temp_diff &lt; 150 THEN\n                                          SET temp_growth = temp_growth * 1.07;\n                                   END IF;                       \n                            ELSEIF temp_growth &gt;=5 AND temp_growth &lt;=10 THEN\n                                   SET temp_growth = temp_growth * 1.05;\n                            END IF;\n                            UPDATE heros SET attack_growth = ROUND(temp_growth,3) WHERE id = temp_id;\n                     END IF;\n       FETCH cur_hero INTO temp_id, temp_growth, temp_max, temp_start;\n       UNTIL done = true END REPEAT;\n       \n       CLOSE cur_hero;\nEND\n</code></pre><p>这里我创建了alter_attack_growth这个存储过程，使用了REPEAT…UNTIL…的循环方式，针对不同的情况计算了新的物攻成长temp_growth，然后对原有的attack_growth进行了更新，最后调用call alter_attack_growth();执行存储过程。</p><p>有一点需要注意的是，我们在对数据表进行更新前，需要备份之前的表，我们可以将备份后的表命名为heros_copy1。更新完heros数据表之后，你可以看下两张表在attack_growth字段上的对比，我们使用SQL进行查询：</p><pre><code>SELECT heros.id, heros.attack_growth, heros_copy1.attack_growth FROM heros JOIN heros_copy1 WHERE heros.id = heros_copy1.id\n</code></pre><p>运行结果（69条记录）：</p><p><img src=\"https://static001.geekbang.org/resource/image/62/c9/622c50afb8ff6be7d9682fe3537dedc9.png?wh=1036*483\" alt=\"\"><br>\n通过前后两张表的attack_growth对比你也能看出来，存储过程通过游标对不同的数据行进行了更新。</p><p>需要说明的是，以上代码适用于MySQL，如果在SQL Server或Oracle中，使用方式会有些差别。</p><h2>总结</h2><p>今天我们讲解了如何在SQL中使用游标，游标实际上是面向过程的思维方式，与面向集合的思维方式不同的地方在于，游标更加关注“如何执行”。我们可以通过游标更加精细、灵活地查询和管理想要的数据行。</p><p>有的时候，我们需要找特定数据，用SQL查询写起来会比较困难，比如两表或多表之间的嵌套循环查找，如果用JOIN会非常消耗资源，效率也可能不高，而用游标则会比较高效。</p><p>虽然在处理某些复杂的数据情况下，使用游标可以更灵活，但同时也会带来一些性能问题，比如在使用游标的过程中，会对数据行进行加锁，这样在业务并发量大的时候，不仅会影响业务之间的效率，还会消耗系统资源，造成内存不足，这是因为游标是在内存中进行的处理。如果有游标的替代方案，我们可以采用替代方案。</p><p><img src=\"https://static001.geekbang.org/resource/image/dc/11/dca1fadf6625b9699c25104e74fb8d11.jpg?wh=3341*2066\" alt=\"\"><br>\n我们今天讲解了游标，你能用自己的语言介绍下游标的作用吗？另外，我们之前提到过，SQL本身是一门结构化查询语言，但我们也可以在SQL的基础上进行面向过程的开发，完成较为复杂的功能，你能说一下面向过程和面向集合这两种编程方式的区别吗？</p><p>欢迎你在评论区写下你的思考，也欢迎把这篇文章分享给你的朋友或者同事，一起交流一下。</p>","comments":[{"had_liked":false,"id":114440,"user_name":"Y024","can_delete":false,"product_type":"c1","uid":1018056,"ip_address":"","ucode":"397126D2E17997","user_header":"https://static001.geekbang.org/account/avatar/00/0f/88/c8/ae476935.jpg","comment_is_top":false,"comment_ctime":1563317659,"is_pvip":true,"replies":[{"id":"63812","content":"多谢分享","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577542492,"ip_address":"","comment_id":114440,"utype":1}],"discussion_count":2,"race_medal":2,"score":"104642532763","product_id":100029501,"comment_content":"面向集合思维方式的训练，有个在线的游戏，可以帮忙大家：<br>www.setgame.com&#47;puzzle&#47;set.htm<br><br>关于面向集合的思考，《Oracle SQL高级编程》一书里有个专门的章节介绍：<br>http:&#47;&#47;m.ituring.com.cn&#47;article&#47;472","like_count":24,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458665,"discussion_content":"多谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577542492,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1574088,"avatar":"https://static001.geekbang.org/account/avatar/00/18/04/c8/c75f4f2d.jpg","nickname":"张小倔","note":"","ucode":"6C1B2C4D8CE4C8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7589,"discussion_content":"完了，花了15min才把游戏完成","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567580154,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":178677,"user_name":"萌面赵先生","can_delete":false,"product_type":"c1","uid":1170379,"ip_address":"","ucode":"CC51AB1C925E13","user_header":"https://static001.geekbang.org/account/avatar/00/11/db/cb/58f4b5d2.jpg","comment_is_top":false,"comment_ctime":1581777598,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"83186156222","product_id":100029501,"comment_content":"讲道理 根本不适合新人看 ... 做到这里循环逻辑还没说明白呢，在这儿输出一通...看到后面完全在看天书...","like_count":19,"discussions":[{"author":{"id":2974360,"avatar":"","nickname":"高兴业","note":"","ucode":"6F6B8C58F5FEBF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":570035,"discussion_content":"还是不懂，估计要好好学习一下循环方面的东西","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651643517,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2815900,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/f7/9c/69c5c5dc.jpg","nickname":"越锋利","note":"","ucode":"63E9E3F3C7D53D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":408989,"discussion_content":"虽然不懂 sql 的循环，但是一看就能明白想干嘛啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635348860,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1919541,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/4a/35/66caeed9.jpg","nickname":"完美坚持","note":"","ucode":"AE0261D8DDEF64","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376403,"discussion_content":"这个可能需要一点面向过程的编程经验，估计你现在很可能也有了吧。\n我也是没接触过sql，不过之前写过一点c、R和python，看这个循环就不难，都一样\n我记得高中的时候也学过一点","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622110215,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":205293,"user_name":"qijj","can_delete":false,"product_type":"c1","uid":1231369,"ip_address":"","ucode":"AAE7BAD5DABEE2","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLLn1y9RSL9JcACGRVkkhkEmjH7z1eiag763CVKwn3Mzb3djbibwbx0fgZqyBpPozGLOicnllSfydEng/132","comment_is_top":false,"comment_ctime":1586585810,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"74601029842","product_id":100029501,"comment_content":"老师，你的例子中为什么没写 释放游标的代码？","like_count":18},{"had_liked":false,"id":114473,"user_name":"ahazxc","can_delete":false,"product_type":"c1","uid":1528500,"ip_address":"","ucode":"B63143E0A67776","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJsszO0GeFFRZbF3XRZGic9nlHLC322hNGVazsExCRqb5HnmoaCTToiaUhTAtVyPudP8CiaHPzwviaP5A/132","comment_is_top":false,"comment_ctime":1563322944,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"53102930496","product_id":100029501,"comment_content":"想问下老师，在第二个例子中，第一次游标获取数据后，按条件更新数据后，为啥还要再fetch一遍呢？","like_count":12,"discussions":[{"author":{"id":1275753,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoAgs66iaTKNaTZtFJibhNWYhudlpv39r6gmy5Joj3DB32VZvrYqcguOYExVjfJ7UQHr5AXvjMceia3g/132","nickname":"爱科幻爱魔法细节控","note":"","ucode":"BEECFA102FA711","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2572,"discussion_content":"首先说，fetch 每次只取一行数据。前面的例子只用一次fetch是因为 fetch 语句在循环内，就是说每次循环都取了一行数据；后面的例子，fetch 在 循环（repeat）开始之前，就是说，这里的 fetch 只取到了一行数据，想要在循环内一条一条的遍历剩下的所有行，就要在循环内后面地方再 fetch 一次。","likes_number":8,"is_delete":false,"is_hidden":false,"ctime":1563771055,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1584098,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIR9QrAn9TZOrJMSYMyN96PAuAjETVrN5SPp3hMbfUAGIWtHceWPEoQtPdXeuBn7VB7dagtxynAIA/132","nickname":"ballgod","note":"","ucode":"C20E95E98EAC43","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":232342,"discussion_content":"这个应该是不同循环结构的作用方式不同，如果使用loop就不会有。使用repeat下面有相应的变量，所以首先要执行一次","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586867046,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114524,"user_name":"我行我素","can_delete":false,"product_type":"c1","uid":1224678,"ip_address":"","ucode":"4C69542FAB0671","user_header":"https://static001.geekbang.org/account/avatar/00/12/af/e6/9c77acff.jpg","comment_is_top":false,"comment_ctime":1563328803,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"31628099875","product_id":100029501,"comment_content":"不使用游标，使用case when then 也能完成物攻的那个sql吧","like_count":7,"discussions":[{"author":{"id":1409700,"avatar":"https://static001.geekbang.org/account/avatar/00/15/82/a4/a92c6eca.jpg","nickname":"墨灵","note":"","ucode":"185D70CA20BEEE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":204284,"discussion_content":"我也更倾向用CASE的方式去处理这类的业务，如果某行的更新需要跟根据前面的行数据时，游标会更适用","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1584150144,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1588752,"avatar":"https://static001.geekbang.org/account/avatar/00/18/3e/10/6fbed067.jpg","nickname":"Eva","note":"","ucode":"562975BA95D762","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5595,"discussion_content":"我也觉得可以，而且更加简单方便","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566368094,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115029,"user_name":"ABC","can_delete":false,"product_type":"c1","uid":1054958,"ip_address":"","ucode":"7501AD9C0C4A70","user_header":"https://static001.geekbang.org/account/avatar/00/10/18/ee/a1ed60d1.jpg","comment_is_top":false,"comment_ctime":1563457210,"is_pvip":false,"replies":[{"id":"63888","content":"创建的话可以使用Navicat，运行命令的时候可以用MySQL客户端命令行","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577603465,"ip_address":"","comment_id":115029,"utype":1}],"discussion_count":2,"race_medal":0,"score":"27333260986","product_id":100029501,"comment_content":"老师这些例子是在MySQL的客户端命令行里面运行吗?在navicat里面运行好几个例子都没反应..","like_count":6,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458935,"discussion_content":"创建的话可以使用Navicat，运行命令的时候可以用MySQL客户端命令行","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577603465,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2131512,"avatar":"https://static001.geekbang.org/account/avatar/00/20/86/38/379a9da5.jpg","nickname":"Duke","note":"","ucode":"77BB22ADCC2AB9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":562888,"discussion_content":"Navicat 可以直接打开命令行","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649904400,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114630,"user_name":"夜路破晓","can_delete":false,"product_type":"c1","uid":1353577,"ip_address":"","ucode":"9B875F94B759B9","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/3hZfficKPGCq2kjFBu9SgaMjibJTEl7iaW1ta6pZNyiaWP8XEsNpunlnsiaOtBpWTXfT5BvRP3qNByml6p9rtBvqewg/132","comment_is_top":false,"comment_ctime":1563353853,"is_pvip":false,"replies":[{"id":"63811","content":"对的","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577542452,"ip_address":"","comment_id":114630,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27333157629","product_id":100029501,"comment_content":"简单理解就是把操作鼠标的动作用存储过程封装起来从而实现面对大批量数据重复操作的自动化。<br>这种情况我选择用编程比如python来解决，除非是那种有定期更新要求的定制宽表，可以考虑在定制宽表的基础加个游标以便实现自动化定期更新的要求。","like_count":6,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458752,"discussion_content":"对的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577542452,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":116104,"user_name":"大斌","can_delete":false,"product_type":"c1","uid":1002183,"ip_address":"","ucode":"1434C2B0A29135","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4a/c7/ec18673b.jpg","comment_is_top":false,"comment_ctime":1563786307,"is_pvip":false,"replies":[{"id":"63803","content":"总结的不错","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577542264,"ip_address":"","comment_id":116104,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23038622787","product_id":100029501,"comment_content":"我理解游标的作用：<br>在进行一些复杂计算的时候可以使用游标，因为自带的没有这么复杂的计算，需要自己进行定制，<br><br>我理解的面向过程和面向集合的编程方式的区别：<br>面向过程是结构化编程，是对解决问题步骤的分析<br>面向集合是属于抽象式的，把解决步骤模块化来复用<br>","like_count":5,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459385,"discussion_content":"总结的不错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577542264,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114923,"user_name":"魏颖琪","can_delete":false,"product_type":"c1","uid":1184964,"ip_address":"","ucode":"097544C71EBDA7","user_header":"https://static001.geekbang.org/account/avatar/00/12/14/c4/e354d8ba.jpg","comment_is_top":false,"comment_ctime":1563434160,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"23038270640","product_id":100029501,"comment_content":"例子运行会报告：ERROR 1243 (HY000): Unknown prepared statement handler (cur_hero) given to DEALLOCATE PREPARE。 在MYSQL官网上的例子（https:&#47;&#47;dev.mysql.com&#47;doc&#47;refman&#47;5.7&#47;en&#47;cursors.html）并没有 DEALLOCATE PREPARE  这一步。我理解DECLARE只是做一个变量声明，就如同DECLARE hp INT。过程结束，应该就是生命周期的结束。精简例子，只有声明CURSOR和释放CURSOR，同样报错。","like_count":5,"discussions":[{"author":{"id":1000060,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/7c/8ef14715.jpg","nickname":"🄽🄸🅇🅄🅂","note":"","ucode":"853763C229A5AA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2312,"discussion_content":"嗯，不要deallocate prepare cur_hero，就不会报这个错误了","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1563454879,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114490,"user_name":"林彦","can_delete":false,"product_type":"c1","uid":1032615,"ip_address":"","ucode":"5094CC6ED7B40C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c1/a7/5e66d331.jpg","comment_is_top":false,"comment_ctime":1563324788,"is_pvip":false,"replies":[{"id":"63895","content":"面向集合是一种思维方式，但有些时候 面向过程更容易处理一些具体的细节，比如各种条件判断等，这时就可以采用游标 来对具体的数据进行处理","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577603866,"ip_address":"","comment_id":114490,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23038161268","product_id":100029501,"comment_content":"面向集合是通过属性来划分数据获取结果，面向过程是通过对每个&#47;条数据进行处理。<br>请问老师文中提到的游标的比较常见的，或能避免其缺点的替代方式有哪些？有哪些场景又必须要用游标？<br>谢谢。","like_count":5,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458685,"discussion_content":"面向集合是一种思维方式，但有些时候 面向过程更容易处理一些具体的细节，比如各种条件判断等，这时就可以采用游标 来对具体的数据进行处理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577603866,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":164370,"user_name":"旅途","can_delete":false,"product_type":"c1","uid":1212902,"ip_address":"","ucode":"5022477E8E9441","user_header":"https://static001.geekbang.org/account/avatar/00/12/81/e6/6cafed37.jpg","comment_is_top":false,"comment_ctime":1576951812,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18756820996","product_id":100029501,"comment_content":"老师  判断游标已经到头的语句  DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = true; 是怎么和你创建的游标 cur_hero 关联起来的呢 假如存储过程里定义了多个游标 都是靠这一个变量判断吗?","like_count":4},{"had_liked":false,"id":135895,"user_name":"飞翔","can_delete":false,"product_type":"c1","uid":1068571,"ip_address":"","ucode":"65AF6AF292DAD6","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/1b/f4b786b9.jpg","comment_is_top":false,"comment_ctime":1569293987,"is_pvip":true,"replies":[{"id":"63495","content":"相当于使用游标在内存中进行寻址，类似指针的作用","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577514589,"ip_address":"","comment_id":135895,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18749163171","product_id":100029501,"comment_content":"老师 游标是不是有防止内存被撑爆的作用， 比如要获取1百万条数据，假设直接都读取到内存中，内存搁不下，使用游标获取1百万条 貌似就没问题","like_count":4,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468372,"discussion_content":"相当于使用游标在内存中进行寻址，类似指针的作用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577514589,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":133474,"user_name":"GLADIATOR","can_delete":false,"product_type":"c1","uid":1448564,"ip_address":"","ucode":"6FE14E0BCD6240","user_header":"https://static001.geekbang.org/account/avatar/00/16/1a/74/8f7f8786.jpg","comment_is_top":false,"comment_ctime":1568590732,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14453492620","product_id":100029501,"comment_content":"英语单词发音可不可以准点，稍微看一下音标","like_count":4},{"had_liked":false,"id":332475,"user_name":"佳伦","can_delete":false,"product_type":"c1","uid":1064508,"ip_address":"","ucode":"3AE8098B5BE716","user_header":"https://static001.geekbang.org/account/avatar/00/10/3e/3c/fc3ad983.jpg","comment_is_top":false,"comment_ctime":1643270374,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10233204966","product_id":100029501,"comment_content":"个人理解，游标算是对SQL可以面向过程的一个扩充，但是功能非常有限，不如使用编程语言操作来得直接。","like_count":2},{"had_liked":false,"id":148724,"user_name":"冲","can_delete":false,"product_type":"c1","uid":1149914,"ip_address":"","ucode":"4191C8A4DF3840","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIk46cor5XVFTPZbPOnb7pViabgy450pobo46hRHFQz5nR5ocYRKIzC8vShic36vwa553H4Vj50x5wA/132","comment_is_top":false,"comment_ctime":1573054663,"is_pvip":false,"replies":[{"id":"62682","content":"对的 像鼠标的光标一样可以对每个数据进行扫描","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577084239,"ip_address":"","comment_id":148724,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10162989255","product_id":100029501,"comment_content":"再次回顾学习一次SQL，游标自我理解就想像鼠标的光标一样可以对每个数据进行扫描，可以到达每个数据的位置。总结游标的使用步骤定义游标，用变量接收游标是否结束，打开游标，游标中取得数据，关闭游标，释放游标。","like_count":2,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473582,"discussion_content":"对的 像鼠标的光标一样可以对每个数据进行扫描","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577084239,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115230,"user_name":"华夏","can_delete":false,"product_type":"c1","uid":1449474,"ip_address":"","ucode":"4D627CFA5A4B82","user_header":"https://static001.geekbang.org/account/avatar/00/16/1e/02/2864e0f2.jpg","comment_is_top":false,"comment_ctime":1563513833,"is_pvip":false,"replies":[{"id":"63676","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577527930,"ip_address":"","comment_id":115230,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10153448425","product_id":100029501,"comment_content":"IF temp_growth &lt; 5 THEN<br>\t\t\t\tIF temp_diff &gt; 200 THEN<br>\t\t\t\t\tSET temp_growth = temp_growth * 1.1;<br>\t\t\t\tELSEIF temp_diff &gt;= 150 THEN<br>\t\t\t\t\tSET temp_growth = temp_growth * 1.08;<br>\t\t\t\tELSEIF temp_diff &lt; 150 THEN<br>\t\t\t\t\tSET temp_growth = temp_growth * 1.07;<br>\t\t\t\tEND IF;<br>\t\t\tELSEIF temp_growth &lt; 10 THEN<br>\t\t\t\tSET temp_growth = temp_growth * 1.05;<br>条件判断也可以写成这样哈。因为上文if&gt;200，elseif就默认&lt;=200。后面同理。","like_count":2,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459019,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577527930,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114465,"user_name":"Penn","can_delete":false,"product_type":"c1","uid":1044701,"ip_address":"","ucode":"C6A4AA2259068F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/AkO5s3tJhibth9nelCNdU5qD4J3aEn8OpBhOHluicWgEj1SbcGC6e9rccK8DrfJtRibJT5g6iamfIibt5xX7ketDF6w/132","comment_is_top":false,"comment_ctime":1563322498,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10153257090","product_id":100029501,"comment_content":"面向过程和面向集合，最终的目的都是得到一个计算结果，不同点是，面向过程通过描述how来计算结果，面向集合通过描述what来获得结果;比如需要计算一篮子豆子中红豆的个数，面向过程时，我可以用眼睛筛选红豆子，也可以用仪器筛选，关键是方法需要自己找;而面向集合只需要喊一声:我要红豆子，问题就解决了，只关心最终的结果","like_count":2,"discussions":[{"author":{"id":1474214,"avatar":"https://static001.geekbang.org/account/avatar/00/16/7e/a6/4e331ef4.jpg","nickname":"骑行的掌柜J","note":"","ucode":"3163102651C653","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7623,"discussion_content":"形象 哈哈哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567588824,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117020,"user_name":"Ronnyz","can_delete":false,"product_type":"c1","uid":1488280,"ip_address":"","ucode":"9F34527B1D343D","user_header":"https://static001.geekbang.org/account/avatar/00/16/b5/98/ffaf2aca.jpg","comment_is_top":false,"comment_ctime":1563955939,"is_pvip":false,"replies":[{"id":"63633","content":"对的","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577525682,"ip_address":"","comment_id":117020,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5858923235","product_id":100029501,"comment_content":"在Navicat运行例子出现报错ERROR 1243，解决办法就是去掉 DEALLOCATE PREPARE cur_hero","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459781,"discussion_content":"对的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577525682,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358924,"user_name":"徐相华","can_delete":false,"product_type":"c1","uid":1475276,"ip_address":"上海","ucode":"343CEDA213DC70","user_header":"","comment_is_top":false,"comment_ctime":1665031620,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1665031620","product_id":100029501,"comment_content":"老师好，请问一下，课件中提到“会对数据行进行加锁”，这个说法是针对mysql的吗？因为mysql的默认隔离 级别是可重复读？所以，所有的查询都加了行级锁是这样吗？","like_count":0},{"had_liked":false,"id":350929,"user_name":"Geek_e4dbc9","can_delete":false,"product_type":"c1","uid":2925693,"ip_address":"","ucode":"C266D066939B5E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/SPs38cwRr8ctKQsicGQicASrV49FC0qdNZXH78jfnBK2RBZVfnIP5zE0NVkReYsBWKcKYCRR3zB3tFRVH491B23A/132","comment_is_top":false,"comment_ctime":1657355116,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1657355116","product_id":100029501,"comment_content":"不是很能理解为什么要在OLTP数据库里做复杂的查询操作，这跟它的定位就不符。","like_count":0},{"had_liked":false,"id":322975,"user_name":"Geek_bad8d7","can_delete":false,"product_type":"c1","uid":2816162,"ip_address":"","ucode":"C3414C8A9D5580","user_header":"","comment_is_top":false,"comment_ctime":1637677166,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637677166","product_id":100029501,"comment_content":"游标的作用就是负责在数据库语言中迭代数据集，逐条操作","like_count":0},{"had_liked":false,"id":322939,"user_name":"Geek_bad8d7","can_delete":false,"product_type":"c1","uid":2816162,"ip_address":"","ucode":"C3414C8A9D5580","user_header":"","comment_is_top":false,"comment_ctime":1637666864,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637666864","product_id":100029501,"comment_content":"所有游标主要是方便在写自定义函数的时候迭代结果集","like_count":0},{"had_liked":false,"id":318072,"user_name":"Geek_28670d","can_delete":false,"product_type":"c1","uid":2814926,"ip_address":"","ucode":"7BA10C23E56F1E","user_header":"","comment_is_top":false,"comment_ctime":1635140773,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635140773","product_id":100029501,"comment_content":"面向集合中所有数据被视为一个整体，强调的是处理结果，面向过程处理的是集合中单条记录，强调的是精细化处理。<br>游标用来遍历集合数据，可针对不同的条件做不的处理。","like_count":0},{"had_liked":false,"id":307083,"user_name":"TheOne","can_delete":false,"product_type":"c1","uid":1582134,"ip_address":"","ucode":"2A359780156A8B","user_header":"https://static001.geekbang.org/account/avatar/00/18/24/36/1c4af368.jpg","comment_is_top":false,"comment_ctime":1628853923,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628853923","product_id":100029501,"comment_content":"游标-可以灵活的处理单条数据，主要用来结合存储过程封装函数，实现复杂的逻辑<br>缺点是复杂","like_count":0},{"had_liked":false,"id":294848,"user_name":"完美坚持","can_delete":false,"product_type":"c1","uid":1919541,"ip_address":"","ucode":"AE0261D8DDEF64","user_header":"https://static001.geekbang.org/account/avatar/00/1d/4a/35/66caeed9.jpg","comment_is_top":false,"comment_ctime":1622108947,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622108947","product_id":100029501,"comment_content":"自己写了下：<br>mysql 8.0<br>DELIMITER &#47;&#47;<br>CREATE PROCEDURE `alter_attack_growth`()<br>BEGIN<br>    DECLARE temp_id INT;<br>    DECLARE temp_growth, temp_max, temp_start, temp_diff FLOAT;<br>    DECLARE done INT DEFAULT false;<br>    DECLARE cur_hero CURSOR FOR SELECT id, attack_growth, attack_max, attack_start FROM heros;<br>    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = true;<br><br>    OPEN cur_hero;<br>    FETCH cur_hero INTO temp_id, temp_growth, temp_max, temp_start;<br>    REPEAT<br>        IF NOT done THEN<br>            SET temp_diff = temp_max-temp_start;<br>            IF temp_growth &lt; 5 THEN<br>                IF temp_diff &gt; 200 THEN<br>                    SET temp_growth = temp_growth * 1.1;<br>                ELSEIF temp_diff &gt;= 150 AND temp_diff &lt;= 200 THEN<br>                    SET temp_growth = temp_growth * 1.08;<br>                ELSEIF temp_diff &lt; 150 THEN<br>                    SET temp_growth = temp_growth * 1.07;<br>                END IF;<br>            ELSEIF temp_growth &gt;=5 AND temp_growth &lt;= 10 THEN<br>                SET temp_growth = temp_growth * 1.05;<br>            END IF;<br>            UPDATE heros SET attack_growth = ROUND(temp_growth, 3) WHERE id = temp_id;<br>        END IF;<br>        FETCH cur_hero INTO temp_id, temp_growth, temp_max, temp_start;<br>    UNTIL done = true END REPEAT;<br>    CLOSE cur_hero;<br>END<br>&#47;&#47;<br>DELIMITER ;","like_count":0},{"had_liked":false,"id":288534,"user_name":"giteebravo","can_delete":false,"product_type":"c1","uid":1005290,"ip_address":"","ucode":"C087E8D6B5A98B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/56/ea/32608c44.jpg","comment_is_top":false,"comment_ctime":1618533107,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1618533107","product_id":100029501,"comment_content":"<br>游标 适用于需要对集合中的行进行单独处理的场景。<br>","like_count":0},{"had_liked":false,"id":256347,"user_name":"bahao","can_delete":false,"product_type":"c1","uid":2061470,"ip_address":"","ucode":"3D99BE6BA2F3AF","user_header":"https://static001.geekbang.org/account/avatar/00/1f/74/9e/31872e2c.jpg","comment_is_top":false,"comment_ctime":1603605738,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603605738","product_id":100029501,"comment_content":"感谢楼上分享的面向集合思维训练","like_count":0},{"had_liked":false,"id":224090,"user_name":"宇过添情","can_delete":false,"product_type":"c1","uid":1878956,"ip_address":"","ucode":"59DC854F0492CB","user_header":"","comment_is_top":false,"comment_ctime":1591272927,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591272927","product_id":100029501,"comment_content":"用程序代码也可以实现存储过程的功能吧？代码也存储过程的优劣能说一下嘛？","like_count":0},{"had_liked":false,"id":204739,"user_name":"小熊","can_delete":false,"product_type":"c1","uid":1634686,"ip_address":"","ucode":"9E4CD1DA292076","user_header":"https://static001.geekbang.org/account/avatar/00/18/f1/7e/8925aba5.jpg","comment_is_top":false,"comment_ctime":1586447954,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586447954","product_id":100029501,"comment_content":"学习了","like_count":0},{"had_liked":false,"id":204058,"user_name":"面试官问","can_delete":false,"product_type":"c1","uid":1009375,"ip_address":"","ucode":"F9CE89589772F4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/66/df/501ba989.jpg","comment_is_top":false,"comment_ctime":1586326192,"is_pvip":true,"discussion_count":3,"race_medal":0,"score":"1586326192","product_id":100029501,"comment_content":"游标在实际开发中有多少人会用？","like_count":0,"discussions":[{"author":{"id":1925812,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/AUfUPzmpoBhuFIlhXtteCL1otfTpMOw5w9grO1kJ2DWZ2eCibxdFskh7r6JKpCdFHGPzpUugM5Rxcic3zg3PyPoQ/132","nickname":"彭潇","note":"","ucode":"3A985BCB5CA0AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":264120,"discussion_content":"我基本天天都在写游标。。。。 ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1589290242,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1009375,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/df/501ba989.jpg","nickname":"面试官问","note":"","ucode":"F9CE89589772F4","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1925812,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/AUfUPzmpoBhuFIlhXtteCL1otfTpMOw5w9grO1kJ2DWZ2eCibxdFskh7r6JKpCdFHGPzpUugM5Rxcic3zg3PyPoQ/132","nickname":"彭潇","note":"","ucode":"3A985BCB5CA0AE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":266697,"discussion_content":"是做什么业务或者什么功能的呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589550067,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":264120,"ip_address":""},"score":266697,"extra":""},{"author":{"id":1925812,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/AUfUPzmpoBhuFIlhXtteCL1otfTpMOw5w9grO1kJ2DWZ2eCibxdFskh7r6JKpCdFHGPzpUugM5Rxcic3zg3PyPoQ/132","nickname":"彭潇","note":"","ucode":"3A985BCB5CA0AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1009375,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/df/501ba989.jpg","nickname":"面试官问","note":"","ucode":"F9CE89589772F4","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":268261,"discussion_content":"银行业务\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589757635,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":266697,"ip_address":""},"score":268261,"extra":""}]}]},{"had_liked":false,"id":167062,"user_name":"慕城暖阳","can_delete":false,"product_type":"c1","uid":1490699,"ip_address":"","ucode":"F6B58F377325DB","user_header":"https://static001.geekbang.org/account/avatar/00/16/bf/0b/173b87bb.jpg","comment_is_top":false,"comment_ctime":1577680241,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577680241","product_id":100029501,"comment_content":"老师，在存储过程最后添加释放游标语句为什么会报错？","like_count":0},{"had_liked":false,"id":143792,"user_name":"Coool","can_delete":false,"product_type":"c1","uid":1701702,"ip_address":"","ucode":"1D1AB3270B02B9","user_header":"https://static001.geekbang.org/account/avatar/00/19/f7/46/209ca424.jpg","comment_is_top":false,"comment_ctime":1571793183,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571793183","product_id":100029501,"comment_content":"复制的老师的代码，但是运行出来，结果都是一样的，求解答？<br>id\tattack_growth\tattack_growth(1)<br>10000\t12\t12<br>10001\t11\t11<br>10002\t11\t11<br>10003\t8\t8<br>10004\t12\t12<br>10005\t13\t13<br>10006\t10\t10<br>10007\t11\t11<br>10008\t9\t9<br>10009\t9\t9<br>10010\t9\t9<br>10011\t9\t9<br>10012\t9\t9<br>10013\t12\t12<br>10014\t10\t10<br>10015\t8\t8<br>10016\t10\t10<br>10017\t11\t11<br>10018\t12\t12<br>10019\t17\t17<br>10020\t13\t13<br>10021\t16\t16<br>10022\t17\t17<br>10023\t17\t17<br>10024\t16\t16<br>10025\t15\t15<br>10026\t17\t17<br>10027\t15\t15<br>10028\t11\t11<br>10029\t9\t9<br>10030\t12\t12<br>10031\t9\t9<br>10032\t9\t9<br>10033\t9\t9<br>10034\t11\t11<br>10035\t9\t9<br>10036\t9\t9<br>10037\t9\t9<br>10038\t9\t9<br>10039\t11\t11<br>10040\t9\t9<br>10041\t8\t8<br>10042\t10\t10<br>10043\t9\t9<br>10044\t9\t9<br>10045\t10\t10<br>10046\t8\t8<br>10047\t10\t10<br>10048\t10\t10<br>10049\t9\t9<br>10050\t14\t14<br>10051\t15\t15<br>10052\t13\t13<br>10053\t11\t11<br>10054\t15\t15<br>10055\t11\t11<br>10056\t13\t13<br>10057\t13\t13<br>10058\t14\t14<br>10059\t13\t13<br>10060\t13\t13<br>10061\t12\t12<br>10062\t11\t11<br>10063\t11\t11<br>10064\t18\t18<br>10065\t15\t15<br>10066\t15\t15<br>10067\t11\t11<br>10068\t16\t16","like_count":0},{"had_liked":false,"id":117238,"user_name":"Danpier","can_delete":false,"product_type":"c1","uid":1463474,"ip_address":"","ucode":"11E208FDE34961","user_header":"https://static001.geekbang.org/account/avatar/00/16/54/b2/5ea0b709.jpg","comment_is_top":false,"comment_ctime":1564014369,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1564014369","product_id":100029501,"comment_content":"<br>DEALLOCATE PREPARE 这个查了官方文档5.5和8.0，都说明这个语句是用于释放 PREPARE 语句，而没有提到释放游标，谷歌也没查到相关用法，应该是说错了吧？<br>第二个例子 FETCH 放在repeat内部第一行就行，不知为什么要在循环外和循环尾部都加一句？","like_count":0,"discussions":[{"author":{"id":1925812,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/AUfUPzmpoBhuFIlhXtteCL1otfTpMOw5w9grO1kJ2DWZ2eCibxdFskh7r6JKpCdFHGPzpUugM5Rxcic3zg3PyPoQ/132","nickname":"彭潇","note":"","ucode":"3A985BCB5CA0AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":264121,"discussion_content":"释放游标好像不是这个","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589290302,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115783,"user_name":"自主","can_delete":false,"product_type":"c1","uid":1074940,"ip_address":"","ucode":"E66649583EE7C4","user_header":"https://static001.geekbang.org/account/avatar/00/10/66/fc/11c7eb80.jpg","comment_is_top":false,"comment_ctime":1563728565,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563728565","product_id":100029501,"comment_content":"我想问问游标溢出，什么是游标溢出，标准是什么？","like_count":0},{"had_liked":false,"id":115341,"user_name":"linus","can_delete":false,"product_type":"c1","uid":1246600,"ip_address":"","ucode":"910606671D1706","user_header":"https://static001.geekbang.org/account/avatar/00/13/05/88/0a1f1b1d.jpg","comment_is_top":false,"comment_ctime":1563537571,"is_pvip":false,"replies":[{"id":"63672","content":"使用 call calc_hp_max()","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577527894,"ip_address":"","comment_id":115341,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1563537571","product_id":100029501,"comment_content":"第一个示例报如下错，麻烦大佬瞅一下，给个回复，谢谢<br>[SQL]call calc_hp_max(10)<br><br>[Err] 1318 - Incorrect number of arguments for PROCEDURE help.calc_hp_max; expected 0, got 1<br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459062,"discussion_content":"使用 call calc_hp_max()","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577527894,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1474214,"avatar":"https://static001.geekbang.org/account/avatar/00/16/7e/a6/4e331ef4.jpg","nickname":"骑行的掌柜J","note":"","ucode":"3163102651C653","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7620,"discussion_content":"不要加参数10，你一开始创建存储过程的时候就是没有参数的，直接写成CALL calc_hp_max(); 就可以了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567588563,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1150474,"avatar":"https://static001.geekbang.org/account/avatar/00/11/8e/0a/31ec5392.jpg","nickname":"挠头侠","note":"","ucode":"F96966832E2252","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4962,"discussion_content":"你加参数了呀，你是不是按上面的例子写的呀，上面的例子没有指定可以输入参数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565860931,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115073,"user_name":"算盘Man","can_delete":false,"product_type":"c1","uid":1580662,"ip_address":"","ucode":"F26211FEEC18B7","user_header":"https://static001.geekbang.org/account/avatar/00/18/1e/76/7ccbbe83.jpg","comment_is_top":false,"comment_ctime":1563466489,"is_pvip":false,"replies":[{"id":"63680","content":"可以看下评论中同学的回复","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577528110,"ip_address":"","comment_id":115073,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1563466489","product_id":100029501,"comment_content":"DECLARE cur_hero CURSOR FOR <br>\tSELECT hp_max FROM heros<br>&gt; 1064 - You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;DECLARE cur_hero CURSOR FOR <br>\tSELECT hp_max FROM heros&#39; at line 1<br>&gt; 时间: 0s<br>请教陈老师 为什么复制您的代码会在Navicat里会报错啊 谢谢","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458955,"discussion_content":"可以看下评论中同学的回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577528110,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1394726,"avatar":"https://static001.geekbang.org/account/avatar/00/15/48/26/93fd21d5.jpg","nickname":"书痕","note":"","ucode":"8367371EF89D61","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":41014,"discussion_content":"游标属于复合语句 Compound-Statement，复合语句用于BEGIN .. END的语句块中，而 BEGIN ... END 用于存储程序中（如存储过程、存储函数等），因此游标是不能单独用的。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1572327189,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1474214,"avatar":"https://static001.geekbang.org/account/avatar/00/16/7e/a6/4e331ef4.jpg","nickname":"骑行的掌柜J","note":"","ucode":"3163102651C653","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7621,"discussion_content":"你没加分号; ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567588685,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114899,"user_name":"JustDoDT","can_delete":false,"product_type":"c1","uid":1127175,"ip_address":"","ucode":"6AF0B80F00EAEF","user_header":"https://static001.geekbang.org/account/avatar/00/11/33/07/8f351609.jpg","comment_is_top":false,"comment_ctime":1563427643,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563427643","product_id":100029501,"comment_content":"运行最后一个例子alter_attack_growth时，结果运行正确。看着逻辑也对。<br>报这个错误。<br>1243 - Unknown prepared statement handler (cur_hero) given to DEALLOCATE PREPARE, Time: 0.070000s","like_count":0},{"had_liked":false,"id":114863,"user_name":"liuyyy","can_delete":false,"product_type":"c1","uid":1158611,"ip_address":"","ucode":"AAA3922482E4F7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ercic1LB9N9P1lWftkyyNqjILPAedlbRqvJl2KNTrDFCboiakKoTHPBTF3ufaIsdcLb9uXU8hFlptuw/132","comment_is_top":false,"comment_ctime":1563419870,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1563419870","product_id":100029501,"comment_content":"运行第二个例子时，为啥affected rows为0呢","like_count":0,"discussions":[{"author":{"id":1004960,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/55/a0/65833509.jpg","nickname":"吉祥","note":"","ucode":"4E4F549CB975DB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547723,"discussion_content":"其实操作成功了。操作前，把表复制一下，call后对比一下两张表的attact_growth，成功","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642839601,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1004960,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/55/a0/65833509.jpg","nickname":"吉祥","note":"","ucode":"4E4F549CB975DB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547711,"discussion_content":"我也是，不知道咋回事","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642837046,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114614,"user_name":"时间是最真的答案","can_delete":false,"product_type":"c1","uid":1183601,"ip_address":"","ucode":"B90F3EF769F865","user_header":"https://static001.geekbang.org/account/avatar/00/12/0f/71/9273e8a4.jpg","comment_is_top":false,"comment_ctime":1563350385,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"1563350385","product_id":100029501,"comment_content":"使用游标会造成性能问题，导致目前很少有公司在线上的系统中使用游标吧，反正我没有遇到使用游标的，可能是我见识不够，有公司使用游标的朋友吗，可以讨论一下游标的使用场景等","like_count":0,"discussions":[{"author":{"id":1925812,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/AUfUPzmpoBhuFIlhXtteCL1otfTpMOw5w9grO1kJ2DWZ2eCibxdFskh7r6JKpCdFHGPzpUugM5Rxcic3zg3PyPoQ/132","nickname":"彭潇","note":"","ucode":"3A985BCB5CA0AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":264124,"discussion_content":"银行大量使用游标。。。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589290374,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1080938,"avatar":"https://static001.geekbang.org/account/avatar/00/10/7e/6a/f7b010c7.jpg","nickname":"钢铁侠","note":"","ucode":"A9B239FB1D1A49","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1925812,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/AUfUPzmpoBhuFIlhXtteCL1otfTpMOw5w9grO1kJ2DWZ2eCibxdFskh7r6JKpCdFHGPzpUugM5Rxcic3zg3PyPoQ/132","nickname":"彭潇","note":"","ucode":"3A985BCB5CA0AE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285946,"discussion_content":"数据量大的话，会不会很慢呢？我有时更新大表几乎是for循环加case when加上 数据量判断，每一万行提交一次\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592993700,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":264124,"ip_address":""},"score":285946,"extra":""}]},{"author":{"id":1516991,"avatar":"https://static001.geekbang.org/account/avatar/00/17/25/bf/1e9c853f.jpg","nickname":"Cue","note":"","ucode":"A5CB460B54FDB0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5361,"discussion_content":"mysql-client pymysql  python用这些库就是类似mysql中用游标编程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566202600,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114599,"user_name":"江南皮革厂研发中心保安队长","can_delete":false,"product_type":"c1","uid":1099584,"ip_address":"","ucode":"231419643A5CC5","user_header":"https://static001.geekbang.org/account/avatar/00/10/c7/40/66a203cd.jpg","comment_is_top":false,"comment_ctime":1563348067,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1563348067","product_id":100029501,"comment_content":"老师，declare游标是不是只能在存储过程中使用啊，我在外面declare都报语法错误。","like_count":0,"discussions":[{"author":{"id":1463474,"avatar":"https://static001.geekbang.org/account/avatar/00/16/54/b2/5ea0b709.jpg","nickname":"Danpier","note":"","ucode":"11E208FDE34961","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2876,"discussion_content":"游标属于复合语句 Compound-Statement，复合语句用于BEGIN .. END的语句块中，而 BEGIN ... END 用于存储程序中（如存储过程、存储函数等），因此游标是不能单独用的。可以看下5.5的官方文档（ https://dev.mysql.com/doc/refman/5.5/en/sql-syntax-compound-statements.html）","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1564015799,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114531,"user_name":"NO.9","can_delete":false,"product_type":"c1","uid":1336970,"ip_address":"","ucode":"B92F14B493406F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/fUDCLLob6DFS8kZcMUfxOc4qQHeQfW4rIMK5Ty2u2AqLemcdhVRw7byx85HrVicSvy5AiabE0YGMj5gVt8ibgrusA/132","comment_is_top":false,"comment_ctime":1563330205,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563330205","product_id":100029501,"comment_content":"这个跟exec sql curser有什么区别？","like_count":0},{"had_liked":false,"id":114496,"user_name":"cricket1981","can_delete":false,"product_type":"c1","uid":1001715,"ip_address":"","ucode":"758262F5958DA4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/48/f3/f1034ffd.jpg","comment_is_top":false,"comment_ctime":1563325258,"is_pvip":false,"replies":[{"id":"63893","content":"对 是的 游标属于面向过程，SQL是面向集合的处理方式","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577603797,"ip_address":"","comment_id":114496,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563325258","product_id":100029501,"comment_content":"游标面向过程处理是否可以类比流处理，而sql面向集合处理类比批处理？","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458689,"discussion_content":"对 是的 游标属于面向过程，SQL是面向集合的处理方式","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577603797,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114448,"user_name":"我知道了嗯","can_delete":false,"product_type":"c1","uid":1138471,"ip_address":"","ucode":"9186EC1F32C490","user_header":"https://static001.geekbang.org/account/avatar/00/11/5f/27/a6873bc9.jpg","comment_is_top":false,"comment_ctime":1563319760,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563319760","product_id":100029501,"comment_content":"mysql存储过程的性能比oracle差嘛","like_count":0}]}