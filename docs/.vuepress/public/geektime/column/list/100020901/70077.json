{"id":70077,"title":"04 | 基础篇：经常说的 CPU 上下文切换是什么意思？（下）","content":"<p>你好，我是倪朋飞。</p><p>上一节，我给你讲了CPU上下文切换的工作原理。简单回顾一下，CPU 上下文切换是保证 Linux 系统正常工作的一个核心功能，按照不同场景，可以分为进程上下文切换、线程上下文切换和中断上下文切换。具体的概念和区别，你也要在脑海中过一遍，忘了的话及时查看上一篇。</p><p>今天我们就接着来看，究竟怎么分析CPU上下文切换的问题。</p><h2>怎么查看系统的上下文切换情况</h2><p>通过前面学习我们知道，过多的上下文切换，会把CPU 时间消耗在寄存器、内核栈以及虚拟内存等数据的保存和恢复上，缩短进程真正运行的时间，成了系统性能大幅下降的一个元凶。</p><p>既然上下文切换对系统性能影响那么大，你肯定迫不及待想知道，到底要怎么查看上下文切换呢？在这里，我们可以使用 vmstat 这个工具，来查询系统的上下文切换情况。</p><p>vmstat 是一个常用的系统性能分析工具，主要用来分析系统的内存使用情况，也常用来分析 CPU 上下文切换和中断的次数。</p><p>比如，下面就是一个 vmstat 的使用示例：</p><pre><code># 每隔5秒输出1组数据\n$ vmstat 5\nprocs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\n r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st\n 0  0      0 7005360  91564 818900    0    0     0     0   25   33  0  0 100  0  0\n</code></pre><p>我们一起来看这个结果，你可以先试着自己解读每列的含义。在这里，我重点强调下，需要特别关注的四列内容：</p><ul>\n<li>\n<p>cs（context switch）是每秒上下文切换的次数。</p>\n</li>\n<li>\n<p>in（interrupt）则是每秒中断的次数。</p>\n</li>\n<li>\n<p>r（Running or Runnable）是就绪队列的长度，也就是正在运行和等待CPU的进程数。</p>\n</li>\n<li>\n<p>b（Blocked）则是处于不可中断睡眠状态的进程数。</p>\n</li>\n</ul><!-- [[[read_end]]] --><p>可以看到，这个例子中的上下文切换次数 cs 是33次，而系统中断次数 in 则是25次，而就绪队列长度r和不可中断状态进程数b都是0。</p><p>vmstat 只给出了系统总体的上下文切换情况，要想查看每个进程的详细情况，就需要使用我们前面提到过的 pidstat  了。给它加上 -w 选项，你就可以查看每个进程上下文切换的情况了。</p><p>比如说：</p><pre><code># 每隔5秒输出1组数据\n$ pidstat -w 5\nLinux 4.15.0 (ubuntu)  09/23/18  _x86_64_  (2 CPU)\n\n08:18:26      UID       PID   cswch/s nvcswch/s  Command\n08:18:31        0         1      0.20      0.00  systemd\n08:18:31        0         8      5.40      0.00  rcu_sched\n...\n</code></pre><p>这个结果中有两列内容是我们的重点关注对象。一个是  cswch  ，表示每秒自愿上下文切换（voluntary context switches）的次数，另一个则是  nvcswch  ，表示每秒非自愿上下文切换（non voluntary context switches）的次数。</p><p>这两个概念你一定要牢牢记住，因为它们意味着不同的性能问题：</p><ul>\n<li>\n<p>所谓<strong>自愿上下文切换，是指进程无法获取所需资源，导致的上下文切换</strong>。比如说， I/O、内存等系统资源不足时，就会发生自愿上下文切换。</p>\n</li>\n<li>\n<p>而<strong>非自愿上下文切换，则是指进程由于时间片已到等原因，被系统强制调度，进而发生的上下文切换</strong>。比如说，大量进程都在争抢 CPU 时，就容易发生非自愿上下文切换。</p>\n</li>\n</ul><h2>案例分析</h2><p>知道了怎么查看这些指标，另一个问题又来了，上下文切换频率是多少次才算正常呢？别急着要答案，同样的，我们先来看一个上下文切换的案例。通过案例实战演练，你自己就可以分析并找出这个标准了。</p><h3>你的准备</h3><p>今天的案例，我们将使用 sysbench 来模拟系统多线程调度切换的情况。</p><p>sysbench 是一个多线程的基准测试工具，一般用来评估不同系统参数下的数据库负载情况。当然，在这次案例中，我们只把它当成一个异常进程来看，作用是模拟上下文切换过多的问题。</p><p>下面的案例基于 Ubuntu 18.04，当然，其他的 Linux 系统同样适用。我使用的案例环境如下所示：</p><ul>\n<li>\n<p>机器配置：2 CPU，8GB 内存</p>\n</li>\n<li>\n<p>预先安装 sysbench 和 sysstat 包，如 apt install sysbench sysstat</p>\n</li>\n</ul><p>正式操作开始前，你需要打开三个终端，登录到同一台 Linux 机器中，并安装好上面提到的两个软件包。包的安装，可以先Google一下自行解决，如果仍然有问题的，在留言区写下你的情况。</p><p>另外注意，下面所有命令，都<strong>默认以 root 用户运行</strong>。所以，如果你是用普通用户登陆的系统，记住先运行 sudo su root 命令切换到 root 用户。</p><p>安装完成后，你可以先用 vmstat 看一下空闲系统的上下文切换次数：</p><pre><code># 间隔1秒后输出1组数据\n$ vmstat 1 1\nprocs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\n r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st\n 0  0      0 6984064  92668 830896    0    0     2    19   19   35  1  0 99  0  0\n</code></pre><p>这里你可以看到，现在的上下文切换次数 cs 是35，而中断次数 in 是19，r和b都是0。因为这会儿我并没有运行其他任务，所以它们就是空闲系统的上下文切换次数。</p><h3>操作和分析</h3><p>接下来，我们正式进入实战操作。</p><p>首先，在第一个终端里运行 sysbench  ，模拟系统多线程调度的瓶颈：</p><pre><code># 以10个线程运行5分钟的基准测试，模拟多线程切换的问题\n$ sysbench --threads=10 --max-time=300 threads run\n</code></pre><p>接着，在第二个终端运行 vmstat  ，观察上下文切换情况：</p><pre><code># 每隔1秒输出1组数据（需要Ctrl+C才结束）\n$ vmstat 1\nprocs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----\n r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st\n 6  0      0 6487428 118240 1292772    0    0     0     0 9019 1398830 16 84  0  0  0\n 8  0      0 6487428 118240 1292772    0    0     0     0 10191 1392312 16 84  0  0  0\n</code></pre><p>你应该可以发现，cs 列的上下文切换次数从之前的 35 骤然上升到了 139 万。同时，注意观察其他几个指标：</p><ul>\n<li>\n<p>r 列：就绪队列的长度已经到了 8，远远超过了系统 CPU 的个数 2，所以肯定会有大量的 CPU 竞争。</p>\n</li>\n<li>\n<p>us（user）和 sy（system）列：这两列的CPU 使用率加起来上升到了 100%，其中系统 CPU 使用率，也就是 sy 列高达 84%，说明 CPU 主要是被内核占用了。</p>\n</li>\n<li>\n<p>in  列：中断次数也上升到了1万左右，说明中断处理也是个潜在的问题。</p>\n</li>\n</ul><p>综合这几个指标，我们可以知道，系统的就绪队列过长，也就是正在运行和等待CPU的进程数过多，导致了大量的上下文切换，而上下文切换又导致了系统 CPU 的占用率升高。</p><p>那么到底是什么进程导致了这些问题呢？</p><p>我们继续分析，在第三个终端再用 pidstat 来看一下， CPU 和进程上下文切换的情况：</p><pre><code># 每隔1秒输出1组数据（需要 Ctrl+C 才结束）\n# -w参数表示输出进程切换指标，而-u参数则表示输出CPU使用指标\n$ pidstat -w -u 1\n08:06:33      UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command\n08:06:34        0     10488   30.00  100.00    0.00    0.00  100.00     0  sysbench\n08:06:34        0     26326    0.00    1.00    0.00    0.00    1.00     0  kworker/u4:2\n\n08:06:33      UID       PID   cswch/s nvcswch/s  Command\n08:06:34        0         8     11.00      0.00  rcu_sched\n08:06:34        0        16      1.00      0.00  ksoftirqd/1\n08:06:34        0       471      1.00      0.00  hv_balloon\n08:06:34        0      1230      1.00      0.00  iscsid\n08:06:34        0      4089      1.00      0.00  kworker/1:5\n08:06:34        0      4333      1.00      0.00  kworker/0:3\n08:06:34        0     10499      1.00    224.00  pidstat\n08:06:34        0     26326    236.00      0.00  kworker/u4:2\n08:06:34     1000     26784    223.00      0.00  sshd\n</code></pre><p>从pidstat的输出你可以发现，CPU 使用率的升高果然是 sysbench 导致的，它的 CPU 使用率已经达到了 100%。但上下文切换则是来自其他进程，包括非自愿上下文切换频率最高的 pidstat  ，以及自愿上下文切换频率最高的内核线程 kworker 和 sshd。</p><p>不过，细心的你肯定也发现了一个怪异的事儿：pidstat 输出的上下文切换次数，加起来也就几百，比 vmstat 的 139 万明显小了太多。这是怎么回事呢？难道是工具本身出了错吗？</p><p>别着急，在怀疑工具之前，我们再来回想一下，前面讲到的几种上下文切换场景。其中有一点提到， Linux 调度的基本单位实际上是线程，而我们的场景 sysbench 模拟的也是线程的调度问题，那么，是不是 pidstat 忽略了线程的数据呢？</p><p>通过运行 man pidstat  ，你会发现，pidstat 默认显示进程的指标数据，加上 -t 参数后，才会输出线程的指标。</p><p>所以，我们可以在第三个终端里，  Ctrl+C 停止刚才的 pidstat 命令，再加上 -t 参数，重试一下看看：</p><pre><code># 每隔1秒输出一组数据（需要 Ctrl+C 才结束）\n# -wt 参数表示输出线程的上下文切换指标\n$ pidstat -wt 1\n08:14:05      UID      TGID       TID   cswch/s nvcswch/s  Command\n...\n08:14:05        0     10551         -      6.00      0.00  sysbench\n08:14:05        0         -     10551      6.00      0.00  |__sysbench\n08:14:05        0         -     10552  18911.00 103740.00  |__sysbench\n08:14:05        0         -     10553  18915.00 100955.00  |__sysbench\n08:14:05        0         -     10554  18827.00 103954.00  |__sysbench\n...\n</code></pre><p>现在你就能看到了，虽然 sysbench 进程（也就是主线程）的上下文切换次数看起来并不多，但它的子线程的上下文切换次数却有很多。看来，上下文切换罪魁祸首，还是过多的 sysbench 线程。</p><p>我们已经找到了上下文切换次数增多的根源，那是不是到这儿就可以结束了呢？</p><p>当然不是。不知道你还记不记得，前面在观察系统指标时，除了上下文切换频率骤然升高，还有一个指标也有很大的变化。是的，正是中断次数。中断次数也上升到了1万，但到底是什么类型的中断上升了，现在还不清楚。我们接下来继续抽丝剥茧找源头。</p><p>既然是中断，我们都知道，它只发生在内核态，而 pidstat 只是一个进程的性能分析工具，并不提供任何关于中断的详细信息，怎样才能知道中断发生的类型呢？</p><p>没错，那就是从 /proc/interrupts 这个只读文件中读取。/proc 实际上是 Linux 的一个虚拟文件系统，用于内核空间与用户空间之间的通信。/proc/interrupts 就是这种通信机制的一部分，提供了一个只读的中断使用情况。</p><p>我们还是在第三个终端里，  Ctrl+C 停止刚才的 pidstat 命令，然后运行下面的命令，观察中断的变化情况：</p><pre><code># -d 参数表示高亮显示变化的区域\n$ watch -d cat /proc/interrupts\n           CPU0       CPU1\n...\nRES:    2450431    5279697   Rescheduling interrupts\n...\n</code></pre><p>观察一段时间，你可以发现，变化速度最快的是<strong>重调度中断</strong>（RES），这个中断类型表示，唤醒空闲状态的 CPU 来调度新的任务运行。这是多处理器系统（SMP）中，调度器用来分散任务到不同 CPU 的机制，通常也被称为<strong>处理器间中断</strong>（Inter-Processor Interrupts，IPI）。</p><p>所以，这里的中断升高还是因为过多任务的调度问题，跟前面上下文切换次数的分析结果是一致的。</p><p>通过这个案例，你应该也发现了多工具、多方面指标对比观测的好处。如果最开始时，我们只用了  pidstat 观测，这些很严重的上下文切换线程，压根儿就发现不了了。</p><p>现在再回到最初的问题，每秒上下文切换多少次才算正常呢？</p><p><strong>这个数值其实取决于系统本身的 CPU 性能</strong>。在我看来，如果系统的上下文切换次数比较稳定，那么从数百到一万以内，都应该算是正常的。但当上下文切换次数超过一万次，或者切换次数出现数量级的增长时，就很可能已经出现了性能问题。</p><p>这时，你还需要根据上下文切换的类型，再做具体分析。比方说：</p><ul>\n<li>\n<p>自愿上下文切换变多了，说明进程都在等待资源，有可能发生了 I/O 等其他问题；</p>\n</li>\n<li>\n<p>非自愿上下文切换变多了，说明进程都在被强制调度，也就是都在争抢 CPU，说明 CPU 的确成了瓶颈；</p>\n</li>\n<li>\n<p>中断次数变多了，说明 CPU 被中断处理程序占用，还需要通过查看 /proc/interrupts 文件来分析具体的中断类型。</p>\n</li>\n</ul><h2>小结</h2><p>今天，我通过一个sysbench的案例，给你讲了上下文切换问题的分析思路。碰到上下文切换次数过多的问题时，<strong>我们可以借助 vmstat  、  pidstat 和 /proc/interrupts 等工具</strong>，来辅助排查性能问题的根源。</p><h2>思考</h2><p>最后，我想请你一起来聊聊，你之前是怎么分析和排查上下文切换问题的。你可以结合这两节的内容和你自己的实际操作，来总结自己的思路。</p><p>欢迎在留言区和我讨论，也欢迎把这篇文章分享给你的同事、朋友。我们一起在实战中演练，在交流中学习。</p><p><img src=\"https://static001.geekbang.org/resource/image/56/52/565d66d658ad23b2f4997551db153852.jpg?wh=1110*549\" alt=\"\"></p>","neighbors":{"left":{"article_title":"03 | 基础篇：经常说的 CPU 上下文切换是什么意思？（上）","id":69859},"right":{"article_title":"05 | 基础篇：某个应用的CPU使用率居然达到100%，我该怎么办？","id":70476}},"comments":[{"had_liked":false,"id":43957,"user_name":"行者","can_delete":false,"product_type":"c1","uid":1063734,"ip_address":"","ucode":"EA31201A7C5AE1","user_header":"https://static001.geekbang.org/account/avatar/00/10/3b/36/2d61e080.jpg","comment_is_top":false,"comment_ctime":1543336106,"is_pvip":false,"replies":[{"id":"15842","content":"👍","user_name":"作者回复","comment_id":43957,"uid":"1001282","ip_address":"","utype":1,"ctime":1543411339,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"860536795306","product_id":100020901,"comment_content":"结合前两节，首先通过uptime查看系统负载，然后使用mpstat结合pidstat来初步判断到底是cpu计算量大还是进程争抢过大或者是io过多，接着使用vmstat分析切换次数，以及切换类型，来进一步判断到底是io过多导致问题还是进程争抢激烈导致问题。","like_count":201,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430570,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543411339,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46042,"user_name":"lupguo","can_delete":false,"product_type":"c1","uid":1009098,"ip_address":"","ucode":"1B55A01DF78647","user_header":"https://static001.geekbang.org/account/avatar/00/0f/65/ca/38dcd55a.jpg","comment_is_top":false,"comment_ctime":1543838286,"is_pvip":false,"discussion_count":6,"race_medal":0,"score":"461105338958","product_id":100020901,"comment_content":"1. stress和sysbench两个工具在压测过程中的对比发现：<br>stress基于多进程的，会fork多个进程，导致进程上下文切换，导致us开销很高；<br>sysbench基于多线程的，会创建多个线程，单一进程基于内核线程切换，导致sy的内核开销很高；<br>具体可以通过vmstat对比<br>stress -c 8 -i 16 -t 600<br>vmstat 1 5<br>sysbench --threads=20 --time=300 threads run<br>vmstat 1 5<br>2. 和鸟哥说的一样，不懂多看man，see also的命令基本涵盖了老师讲解的<br>3. 建议结合操作系统完成后，再看这块教程，整体会更系统性，看问题会更加客观<br><br>希望对大家有帮助","like_count":108,"discussions":[{"author":{"id":1825417,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83errr36kXHkxMhIEGgDibzrdwIQaBhxQBORfOqw5ibQIV4rznfCLssqJTJaVSoyVPHM5eWuiahKx5elwQ/132","nickname":"张涛","note":"","ucode":"78B1A95F89E6DA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":328649,"discussion_content":"个人猜测，sysbench压测sy开销高，是因为sysbench在应用层主动放弃CPU，频繁触发上下文切换；stress压测，反复进行应用层计算，不主动放弃CPU，仅在分配时间片用完或者最小调度间隔后才会发生调度，调度次数少很多，sy开销就就比较少，另stress线程量到达一定数量后，以最小调度间隔进行调度，单位时间内统计调度次数不再增加","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1606202790,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1617390,"avatar":"","nickname":"Geek_87338d","note":"","ucode":"591122E793E9D0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3225,"discussion_content":"进程上下文切换也是sy。\n我还是没搞懂为什么stress就是us高，sysbench就是sy高。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1564319710,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1314732,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoTGktF2iaCu1Qe1GxdcUIc7GuOGajHQVOquRbBQpsYiaOXy4LTNzNM9JV3U0QiaDyUIfJyh4icLo9ic6g/132","nickname":"Eilian","note":"","ucode":"F8264341B89A20","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1617390,"avatar":"","nickname":"Geek_87338d","note":"","ucode":"591122E793E9D0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":38351,"discussion_content":"同意你说的，我也没搞懂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571760801,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":3225,"ip_address":""},"score":38351,"extra":""},{"author":{"id":1044145,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ee/b1/4af0e26c.jpg","nickname":"xian","note":"","ucode":"3F88DC504887A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1617390,"avatar":"","nickname":"Geek_87338d","note":"","ucode":"591122E793E9D0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":47683,"discussion_content":"stree进程执行的计算是sqrt函数（库函数，所以usr cpu高），sysbench命令执行的是线程的各种同步操作（系统调用，所以sys cpu高），例如lock。通过stree --help 和 sysbench thread help 就能查看到。","likes_number":22,"is_delete":false,"is_hidden":false,"ctime":1573390841,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":3225,"ip_address":""},"score":47683,"extra":""},{"author":{"id":1298046,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKZicicibGibtR5zAia782Ajc5I5BN3F3tjAdlibATIknHv67gbxeH21N7B6vbgwLjYb1miaLKhqicptB5ibYw/132","nickname":"阿飞","note":"","ucode":"F8B1FC8521264D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1044145,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ee/b1/4af0e26c.jpg","nickname":"xian","note":"","ucode":"3F88DC504887A2","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":270778,"discussion_content":"懂了，之所以stress压测在用户态的cpu占用高，是因为调用的函数在用户空间执行，而不是在内核空间执行","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1590052517,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":47683,"ip_address":""},"score":270778,"extra":""}]},{"author":{"id":1314732,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoTGktF2iaCu1Qe1GxdcUIc7GuOGajHQVOquRbBQpsYiaOXy4LTNzNM9JV3U0QiaDyUIfJyh4icLo9ic6g/132","nickname":"Eilian","note":"","ucode":"F8264341B89A20","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":38349,"discussion_content":"同意你说的，我也没搞懂\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571760768,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45596,"user_name":"发条橙子 。","can_delete":false,"product_type":"c1","uid":1259218,"ip_address":"","ucode":"ED076F4534FFED","user_header":"https://static001.geekbang.org/account/avatar/00/13/36/d2/c7357723.jpg","comment_is_top":false,"comment_ctime":1543717701,"is_pvip":false,"replies":[{"id":"16327","content":"总结的很好，继续保持👍","user_name":"作者回复","comment_id":45596,"uid":"1001282","ip_address":"","utype":1,"ctime":1543797618,"user_name_real":"倪朋飞"}],"discussion_count":4,"race_medal":0,"score":"319371297605","product_id":100020901,"comment_content":"案例分析 ：<br><br>登录到服务器，现在系统负载怎么样 。 高的话有三种情况，首先是cpu使用率 ，其次是io使用率 ，之后就是两者都高 。 <br><br>cpu 使用率高，可能确实是使用率高， 也的可能实际处理不高而是进程太多切换上下文频繁 ， 也可能是进程内线程的上下文切换频繁<br><br>io 使用率高 ， 说明 io 请求比较大， 可能是 文件io 、 网络io 。  <br><br>工具 ：<br>系统负载 ：  uptime   （ watch -d uptime）看三个阶段平均负载<br>系统整体情况 ：  mpstat （mpstat -p ALL 3） 查看 每个cpu当前的整体状况，可以重点看用户态、内核态、以及io等待三个参数<br>系统整体的平均上下文切换情况 ： vmstat   (vmstat 3) 可以重点看 r （进行或等待进行的进程）、b （不可中断进程&#47;io进程） 、in （中断次数） 、cs（上下文切换次数）  <br>查看详细的上下文切换情况 ： pidstat （pidstat -w(进程切换指标)&#47;-u（cpu使用指标）&#47;-wt(线程上下文切换指标)） 注意看是自愿上下文切换、还是被动上下文切换<br>io使用情况 ： iostat<br><br>模拟场景工具 ：<br>stress ： 模拟进程 、 io<br>sysbench ： 模拟线程数","like_count":75,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431114,"discussion_content":"总结的很好，继续保持👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543797618,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591040,"discussion_content":"但是我看了很多其他资料显示top里面的wa表示io类型但是并不严谨，这个wa高不能说明磁盘很繁忙，只能提供一个参考方向http://linuxperf.com/?p=33","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666237710,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3074120,"avatar":"","nickname":"Geek_c3fcec","note":"","ucode":"C97FB4C9CB274F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583145,"discussion_content":"查看哪个进程使用的IO比较多，可以用iotop这个命令","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659931186,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2159849,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKwDuOXYZ1UsWHaNwMcqGScJF4d5uNuUPUP2iaIFkvjTm2C02MBFmGMYbKibTTqWseN9Ic4vbaickarw/132","nickname":"旺仔涮菜","note":"","ucode":"125B49A8EF7EAF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":410968,"discussion_content":"总结很牛","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635819432,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44745,"user_name":"酱油侠","can_delete":false,"product_type":"c1","uid":1134863,"ip_address":"","ucode":"3041C85FEEDDEE","user_header":"https://static001.geekbang.org/account/avatar/00/11/51/0f/17bdfdaf.jpg","comment_is_top":false,"comment_ctime":1543485876,"is_pvip":false,"replies":[{"id":"16014","content":"👍 谢谢分享经验，其他用centos的同学可以参考一下","user_name":"作者回复","comment_id":44745,"uid":"1001282","ip_address":"","utype":1,"ctime":1543538241,"user_name_real":"倪朋飞"}],"discussion_count":9,"race_medal":0,"score":"267831458228","product_id":100020901,"comment_content":"我用的centos，yum装的sysbench。执行后很快完事了的可以设置下max-requests，默认max-requests是1w所以很快就结束了。<br>sysbench --num-threads=10 --max-time=300 --max-requests=10000000 --test=threads run<br>有的朋友&#47;proc&#47;interrupts时看不见RES是因为窗口开太小了RES在最下面。","like_count":63,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430825,"discussion_content":"👍 谢谢分享经验，其他用centos的同学可以参考一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543538241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1104177,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d9/31/e58f2fb0.jpg","nickname":"ranger2","note":"","ucode":"59F15FFB511161","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1937,"discussion_content":"是终端窗口太小，没有显示出来\n我观察了一下，发现第一列以2、3、4开头的是0，可以不显示它们，让终端窗口显示其它内容，运行下面命令就可以了\nwatch -d &#39;cat /proc/interrupts | egrep -v &#34;^( )+[2-4]&#34;&#39;\n","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1563109488,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1669343,"avatar":"https://static001.geekbang.org/account/avatar/00/19/78/df/424bdc4a.jpg","nickname":"于途","note":"","ucode":"70300C6CCCEAF1","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":1104177,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d9/31/e58f2fb0.jpg","nickname":"ranger2","note":"","ucode":"59F15FFB511161","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":319957,"discussion_content":"确实有效果������","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604212875,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":1937,"ip_address":""},"score":319957,"extra":""},{"author":{"id":2110718,"avatar":"https://static001.geekbang.org/account/avatar/00/20/34/fe/e5429b02.jpg","nickname":"glimmer","note":"","ucode":"48A16C52FB4C45","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1104177,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d9/31/e58f2fb0.jpg","nickname":"ranger2","note":"","ucode":"59F15FFB511161","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373251,"discussion_content":"watch -d tail -n 25 /proc/interrupts ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1620660272,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":1937,"ip_address":""},"score":373251,"extra":""},{"author":{"id":1970516,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLK4NPyaFDl4rzrd4A9z42tQDibFLdCicbrAdyUa5P2B5u8UCUBenpHX7VgUCibvHvhpza4icMBKVnhmA/132","nickname":"学无止境","note":"","ucode":"2C28E8E54DAB4E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":2110718,"avatar":"https://static001.geekbang.org/account/avatar/00/20/34/fe/e5429b02.jpg","nickname":"glimmer","note":"","ucode":"48A16C52FB4C45","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":406163,"discussion_content":"确实有效果","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634714992,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":373251,"ip_address":""},"score":406163,"extra":""}]},{"author":{"id":1171512,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKmbibsVRmAdEqAtZL9R00FjIZuibW9fTQCXd0OCwhxsR5dfzEKJOcleIpjDqyJnpK4ArY7uGrpcgag/132","nickname":"随欲而安","note":"","ucode":"BE701473CB8BAD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":182,"discussion_content":"我也是centos，为啥sysbench --threads=1000 --time=300 threads run，RES没有变化","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1561259379,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2416022,"avatar":"https://static001.geekbang.org/account/avatar/00/24/dd/96/8677254c.jpg","nickname":"承","note":"","ucode":"31E425788BA852","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1171512,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKmbibsVRmAdEqAtZL9R00FjIZuibW9fTQCXd0OCwhxsR5dfzEKJOcleIpjDqyJnpK4ArY7uGrpcgag/132","nickname":"随欲而安","note":"","ucode":"BE701473CB8BAD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343107,"discussion_content":"我也是","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610950954,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":182,"ip_address":""},"score":343107,"extra":""}]},{"author":{"id":1117933,"avatar":"https://static001.geekbang.org/account/avatar/00/11/0e/ed/1c662e93.jpg","nickname":"莫珣","note":"","ucode":"CAFE6F2AC5C177","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":29758,"discussion_content":"我的是CentOS 7，可是拉到最下面也没看到RES呀","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1570782439,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2159849,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKwDuOXYZ1UsWHaNwMcqGScJF4d5uNuUPUP2iaIFkvjTm2C02MBFmGMYbKibTTqWseN9Ic4vbaickarw/132","nickname":"旺仔涮菜","note":"","ucode":"125B49A8EF7EAF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":410970,"discussion_content":"顶一个","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635819583,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45088,"user_name":"冯宇","can_delete":false,"product_type":"c1","uid":1248481,"ip_address":"","ucode":"894A0951E776D7","user_header":"https://static001.geekbang.org/account/avatar/00/13/0c/e1/e54540b9.jpg","comment_is_top":false,"comment_ctime":1543544836,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"199112040452","product_id":100020901,"comment_content":"友情提醒，sudo -i就可以快速切换到root啦😄 不加-i的话是以非登录模式切换，不会拿到root的环境变量","like_count":47,"discussions":[{"author":{"id":1995448,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/72/b8/94a2eaeb.jpg","nickname":"生活","note":"","ucode":"3E2962D5698479","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":264244,"discussion_content":"看到这个我想起来，生产上更新版本时 没有加 -i  启动服务，导致拿到错误的环境变量，各路大佬 晚上三点多起来排查问题","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1589295551,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44251,"user_name":"discoverer-tab","can_delete":false,"product_type":"c1","uid":1006560,"ip_address":"","ucode":"3CE83781933FED","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5b/e0/d27145c8.jpg","comment_is_top":false,"comment_ctime":1543394575,"is_pvip":false,"replies":[{"id":"15812","content":"总结的好👍","user_name":"作者回复","comment_id":44251,"uid":"1001282","ip_address":"","utype":1,"ctime":1543408011,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"126097446159","product_id":100020901,"comment_content":"过多上下文切换会缩短进程运行时间\rvmstat 1 1：分析内存使用情况、cpu上下文切换和中断的次数。cs每秒上下文切换的次数，in每秒中断的次数，r运行或等待cpu的进程数，b中断睡眠状态的进程数。\rpidstat -w 5：查看每个进程详细情况。cswch（每秒自愿）上下文切换次数，如系统资源不足导致，nvcswch每秒非自愿上下文切换次数，如cpu时间片用完或高优先级线程\r案例分析：\rsysbench：多线程的基准测试工具，模拟context switch\r终端1：sysbench --threads=10 --max-time=300 threads run\r终端2：vmstat 1：sys列占用84%说明主要被内核占用，ur占用16%；r就绪队列8；in中断处理1w，cs切换139w==&gt;等待进程过多，频繁上下文切换，内核cpu占用率升高\r终端3：pidstat -w -u 1：sysbench的cpu占用100%（-wt发现子线程切换过多），其他进程导致上下文切换\rwatch -d cat &#47;proc&#47;interupts ：查看另一个指标中断次数，在&#47;proc&#47;interupts中读取，发现重调度中断res变化速度最快\r总结：cswch过多说明资源IO问题，nvcswch过多说明调度争抢cpu过多，中断次数变多说明cpu被中断程序调用","like_count":29,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430694,"discussion_content":"总结的好👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543408011,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44134,"user_name":"miracle","can_delete":false,"product_type":"c1","uid":1276137,"ip_address":"","ucode":"FD7074F1062AE9","user_header":"https://static001.geekbang.org/account/avatar/00/13/78/e9/9d807269.jpg","comment_is_top":false,"comment_ctime":1543372248,"is_pvip":false,"replies":[{"id":"15826","content":"中断次数是多少？","user_name":"作者回复","comment_id":44134,"uid":"1001282","ip_address":"","utype":1,"ctime":1543409677,"user_name_real":"倪朋飞"}],"discussion_count":8,"race_medal":0,"score":"53082979800","product_id":100020901,"comment_content":"发现一个不太严谨的地方，即使没有开sysbench，用watch -d &#47;proc&#47;interrupts的时候 RES的变化也是最大的，这个时候in跟cs都不高","like_count":12,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430644,"discussion_content":"中断次数是多少？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543409677,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1130590,"avatar":"https://static001.geekbang.org/account/avatar/00/11/40/5e/b8fada94.jpg","nickname":"Ryoma","note":"","ucode":"7F692369239692","race_medal":2,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288799,"discussion_content":"大家到 vmstat 中显示的中断能看出来，每秒万级别。而/proc/interrupts 中这么大是因为一起在累加，通过watch -d 查看时，能感受到增长速度","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1593875077,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1994374,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/6e/86/c682976b.jpg","nickname":"zhushenghang","note":"","ucode":"712CFE335C7CE4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":261770,"discussion_content":"RES的值看起来是累加的，只是开sysbench的时候累加的更快，没开的时候累加的很慢。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1589004150,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1793589,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epxppZUun6eqVDbbuyIzSZibcydqnDkdZ96NBDmNYHun484FUcdj3vdaJmuxia9wqEChMRkhj8IpfaA/132","nickname":"Summer","note":"","ucode":"DA2683248EA698","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":166757,"discussion_content":"同遇到这个问题：但是对比之后发现\nsysbench之前：\nRES: 9756380 6271794 5508862 \nsysbench之后：\nRES:   11426376    7724328    6879559 \n\n另外，LOC的中断数更多：\nLOC:  147716699  105701039  108596025","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1581426736,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1317999,"avatar":"https://static001.geekbang.org/account/avatar/00/14/1c/6f/3ea2a599.jpg","nickname":"嘉木","note":"","ucode":"AF4877693782C0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":23545,"discussion_content":"我也遇到了，这时候负载还很低，in和cs才几千，但是RES都9位数了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1569831813,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1661058,"avatar":"https://static001.geekbang.org/account/avatar/00/19/58/82/778916cb.jpg","nickname":"egrep .*","note":"","ucode":"00230AF9B0CFBE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364831,"discussion_content":"我在fedora（内核5.0+）上测试是LOC变高，centos8与debian10（内核4.0+）则是RES变高，另外wc -l /proc/interrupts 行数也是不同的，猜测和内核版本有关","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617621145,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1145907,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep2gRIticwS6CiatsCiaU4QRjAODKibQevrhSciatrmd90lNIZFxywE9yyZgAxKTmWiaBSH4zZUcRIV46qQ/132","nickname":"englefly","note":"","ucode":"E3FCF19E618718","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334698,"discussion_content":"我是8核CPU，\n没开sysbench 时 RES很高，如下\n---------------------------------------------------------------------------------------------\nLOC:    5372627    5433721    3834237    5670342    5357320    5222061    5170551    5754029   Local timer interrupts\n SPU:          0          0          0          0          0          0          0          0   Spurious interrupts\n PMI:        224        227        228        214        214        217        219        220   Performance monitoring interrupts\n IWI:          2          1          1          0          3          1          0          2   IRQ work interrupts\n RTR:          0          0          0          0          0          0          0          0   APIC ICR read retries\n RES:    1558982     797805     541885     496455     358278     382295     369241     468547   Rescheduling interrupts\n---------------------------------------------------------\n开了30个线程的sysbench，RES几乎没有变化，如下\n----------------------------------------------------------\n LOC:    5377518    5438821    3838964    5675360    5362237    5227505    5175599    5759702   Local timer interrupts\n SPU:          0          0          0          0          0          0          0          0   Spurious interrupts\n PMI:        225        228        230        215        216        218        220        221   Performance monitoring interrupts\n IWI:          2          1          1          0          3          1          0          2   IRQ work interrupts\n RTR:          0          0          0          0          0          0          0          0   APIC ICR read retries\n RES:    1570984     808229     552120     506624     367116     392836     379311     478829   Rescheduling interrupts\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607943662,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2066801,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/W0VEO7Hxzd61mia6Ls2EpBmaZ0l9q7SFUAErbu4XKIjWLmlALr4ybpicDoI8SoXY8XJNKmk04Ep1ibTCuFvfCF8GQ/132","nickname":"Chen","note":"","ucode":"5D0F3DF807706E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":324171,"discussion_content":"我也遇到了，没有开sysbench，in和cs次数是几千，RES到8位数，但LOC更高已经9位数了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605064470,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44118,"user_name":"Haku","can_delete":false,"product_type":"c1","uid":1317506,"ip_address":"","ucode":"9AB39B8EF6405D","user_header":"https://static001.geekbang.org/account/avatar/00/14/1a/82/ca3ef12c.jpg","comment_is_top":false,"comment_ctime":1543370156,"is_pvip":false,"replies":[{"id":"15829","content":"赞👍","user_name":"作者回复","comment_id":44118,"uid":"1001282","ip_address":"","utype":1,"ctime":1543409965,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"44493043116","product_id":100020901,"comment_content":"Ubuntu16.04LTS下:<br># 以 10 个线程运行 5 分钟的基准测试，模拟多线程切换的问题<br>$ sysbench --num-threads=10 --max-time=300 --test=threads run","like_count":10,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430634,"discussion_content":"赞👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543409965,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44378,"user_name":"CYH","can_delete":false,"product_type":"c1","uid":1099568,"ip_address":"","ucode":"396AF8DBD0C8AE","user_header":"https://static001.geekbang.org/account/avatar/00/10/c7/30/2f8b78e9.jpg","comment_is_top":false,"comment_ctime":1543416599,"is_pvip":false,"discussion_count":6,"race_medal":0,"score":"40198122263","product_id":100020901,"comment_content":"老师请教一下：我的是centos7系统，执行sysbetch后，watch -d cat &#47;proc&#47;interrupts并没有发现您文中描述的重调度中断指标呢？","like_count":9,"discussions":[{"author":{"id":1160330,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b4/8a/94fc896e.jpg","nickname":"刘波","note":"","ucode":"AF3579B1B6A4E7","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":84111,"discussion_content":"看到了RES，但是发现RES 为0 而且一直不变。 倒是 LOC  IWI 一直在增长。操作系统为 CentOS Linux release 7.0.1406 (Core)  3.10.0-123.8.1.el7.x86_64","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1576488835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1805809,"avatar":"","nickname":"ccz 开发(谢不邀)","note":"","ucode":"B8803B050AAC68","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1160330,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b4/8a/94fc896e.jpg","nickname":"刘波","note":"","ucode":"AF3579B1B6A4E7","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":133735,"discussion_content":"你的虚拟机是不是cpu只设置了一个，如果只设置一个就会一直不变","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1578984893,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":84111,"ip_address":""},"score":133735,"extra":""},{"author":{"id":2401422,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/NyFOEueITjaGLpakMEuWAqVQjo1uDIXlpDdpCxXGfaWiaXzibLQ3WgOFCe8D9FvCmyjsGT7jDsLUbkt8jt2aVs9g/132","nickname":"geek","note":"","ucode":"FF0845140D72A9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1805809,"avatar":"","nickname":"ccz 开发(谢不邀)","note":"","ucode":"B8803B050AAC68","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546748,"discussion_content":"对，我这里也是1核的机器，RES为0，没看到RES的变化。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642412725,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":133735,"ip_address":""},"score":546748,"extra":""}]},{"author":{"id":1104177,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d9/31/e58f2fb0.jpg","nickname":"ranger2","note":"","ucode":"59F15FFB511161","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1935,"discussion_content":"因为屏幕太小，没有显示出来，你用vi打开这个文件，发现在最下面是有这一行的","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1563108044,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591041,"discussion_content":"while true; do cat /proc/interrupts|grep RES; sleep 3; done可以这样看res","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666238373,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1133975,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4d/97/82e652a4.jpg","nickname":"加了盐海盗","note":"","ucode":"D985E4A81153F0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":21053,"discussion_content":"直接cat","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569418429,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":231102,"user_name":"多襄丸","can_delete":false,"product_type":"c1","uid":1074310,"ip_address":"","ucode":"1AA1497C5A293C","user_header":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","comment_is_top":false,"comment_ctime":1593582916,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"35953321284","product_id":100020901,"comment_content":"说RES=0的同学，你一定是设置了CPU个数=1。","like_count":9,"discussions":[{"author":{"id":1766642,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/f4/f2/9a28aaff.jpg","nickname":"郑小凯","note":"","ucode":"AF7AF4776DBFEE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393906,"discussion_content":"的确是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631632730,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":90691,"user_name":"cuikt","can_delete":false,"product_type":"c1","uid":1242702,"ip_address":"","ucode":"9A1DB426CEFEEA","user_header":"https://static001.geekbang.org/account/avatar/00/12/f6/4e/0066303c.jpg","comment_is_top":false,"comment_ctime":1556610862,"is_pvip":false,"replies":[{"id":"32525","content":"谢谢分享，sort、cat 都是所有人都需要掌握的基础工具","user_name":"作者回复","comment_id":90691,"uid":"1001282","ip_address":"","utype":1,"ctime":1556633771,"user_name_real":"倪朋飞"}],"discussion_count":4,"race_medal":0,"score":"31621381934","product_id":100020901,"comment_content":"可以通过以下指令进行排序，观察RES。<br>watch -d &#39;cat &#47;proc&#47;interrupts | sort -nr -k 2 &#39;","like_count":8,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448617,"discussion_content":"谢谢分享，sort、cat 都是所有人都需要掌握的基础工具","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556633771,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591042,"discussion_content":"while true; do cat /proc/interrupts|grep RES; sleep 3; done这样也可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666238391,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2457360,"avatar":"","nickname":"Geek_7302ef","note":"","ucode":"DBFBAD4CDE296B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351736,"discussion_content":"排序不显示RES，换了一个命令 watch -d &#39;cat /proc/interrupts |sed -n 54p&#39;\t","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614419336,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1805809,"avatar":"","nickname":"ccz 开发(谢不邀)","note":"","ucode":"B8803B050AAC68","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":133738,"discussion_content":"排序这个没啥意义吧。。它这个不同行的都不相干，你只不过是恰好RES第二列的值比较大，你把它挪上来而已，哈哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578985353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44122,"user_name":"echo","can_delete":false,"product_type":"c1","uid":1081292,"ip_address":"","ucode":"D81839D03AE550","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEIHvQHWCJ6cjAjFthVAADNWx0uaZicm4UDJCbVbvcian6gFI1gqWWX2tG3lEB2nVNtaVXtwibGOYiauCA/132","comment_is_top":false,"comment_ctime":1543370478,"is_pvip":false,"replies":[{"id":"15828","content":"CPU使用率都是哪种高？具体到每个线程，又是哪种CPU使用率高？先找出最高的类型再继续分析","user_name":"作者回复","comment_id":44122,"uid":"1001282","ip_address":"","utype":1,"ctime":1543409947,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"31608141550","product_id":100020901,"comment_content":"老师你好，有个难题希望能指导一下排查<br>我有个系统，跑的是32核48G的云主机，load经常超过CPU核数，峰值时load5可达到CPU核数的3倍， 但是CPU利用率不超过50%左右。<br>其他关键数据：I&#47;O wait 不超过0.1， 网络流量没超出网卡QOS，R状态的进程数也就一两个，没有D状态的进程。系统只要跑一个CPU密集型的Java进程，线程数2-3k。另外load、CPU、网卡流量的曲线是一致的。<br><br>通读了你的第二篇文章，按文章指导能排查的都排查了，接下来应该从哪方面着手定位load高的根因呢？","like_count":8,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430637,"discussion_content":"CPU使用率都是哪种高？具体到每个线程，又是哪种CPU使用率高？先找出最高的类型再继续分析","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543409947,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":179862,"user_name":"罗辑思维","can_delete":false,"product_type":"c1","uid":1318941,"ip_address":"","ucode":"D257A06EDE928E","user_header":"https://static001.geekbang.org/account/avatar/00/14/20/1d/0c1a184c.jpg","comment_is_top":false,"comment_ctime":1582112282,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27351916058","product_id":100020901,"comment_content":"<br>CPU上下文切换<br>三个场景识切换：进程上下文切换、线程上下文切换以及中断上下文切换。<br>二个概念牢牢记：自愿上下文切换、非自愿上下文切换。<br>一个中断不要忘：中断次数。","like_count":6},{"had_liked":false,"id":44062,"user_name":"茴香根","can_delete":false,"product_type":"c1","uid":1316111,"ip_address":"","ucode":"B91C00B72077F1","user_header":"https://static001.geekbang.org/account/avatar/00/14/15/0f/954be2db.jpg","comment_is_top":false,"comment_ctime":1543366934,"is_pvip":false,"replies":[{"id":"15834","content":"这是常见的问题，一般用宽显示器会好些","user_name":"作者回复","comment_id":44062,"uid":"1001282","ip_address":"","utype":1,"ctime":1543410894,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"27313170710","product_id":100020901,"comment_content":"打卡本节课程，在使用Linux一些监控命令行时候常常碰到列宽和下面的的数据错位的情况，比如数据过大，占了两列，导致数据错位，不方便观察，不知老师可有好的工具或方法解决。","like_count":7,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430617,"discussion_content":"这是常见的问题，一般用宽显示器会好些","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543410894,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44011,"user_name":"Linuxer","can_delete":false,"product_type":"c1","uid":1153978,"ip_address":"","ucode":"272D9D8089C3D6","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/ba/333b59e5.jpg","comment_is_top":false,"comment_ctime":1543364939,"is_pvip":false,"replies":[{"id":"15838","content":"是的，cs值不是绝对的，所以最好是监控起来，看变化情况，比如是不是数量级的增长","user_name":"作者回复","comment_id":44011,"uid":"1001282","ip_address":"","utype":1,"ctime":1543411234,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"27313168715","product_id":100020901,"comment_content":"我们之前是如果系统CPU不高根本不会去关注上下文切换，但是这种情况下以前也观测到cs有几十万的情况，所以我想请教一个问题，什么情况下需要关注上下文切换呢？","like_count":7,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430593,"discussion_content":"是的，cs值不是绝对的，所以最好是监控起来，看变化情况，比如是不是数量级的增长","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543411234,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43971,"user_name":"glinuxer","can_delete":false,"product_type":"c1","uid":1148218,"ip_address":"","ucode":"0FD861CB2AA5A7","user_header":"https://static001.geekbang.org/account/avatar/00/11/85/3a/bb885be4.jpg","comment_is_top":false,"comment_ctime":1543355689,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"27313159465","product_id":100020901,"comment_content":"Pidstats确实是把利器啊","like_count":6},{"had_liked":false,"id":114344,"user_name":"wanlinwang","can_delete":false,"product_type":"c1","uid":1588770,"ip_address":"","ucode":"C74C3CF0B5BF64","user_header":"https://static001.geekbang.org/account/avatar/00/18/3e/22/f91219a8.jpg","comment_is_top":false,"comment_ctime":1563278888,"is_pvip":true,"replies":[{"id":"41970","content":"不同工具的输出格式不完全一样，文章中的b其实就是D状态的进程","user_name":"作者回复","comment_id":114344,"uid":"1001282","ip_address":"","utype":1,"ctime":1563455367,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"23038115368","product_id":100020901,"comment_content":"进程状态说明<br><br>R (task_running) : 可执行状态<br><br>S (task_interruptible): 可中断的睡眠状态<br><br>D (task_uninterruptible): 不可中断的睡眠状态<br><br>T(task_stopped or task_traced)：暂停状态或跟踪状态<br><br>Z (task_dead - exit_zombie)：退出状态，进程成为僵尸进程<br><br>X (task_dead - exit_dead)：退出状态，进程即将被销毁<br><br>文章中写的是b状态是不可中断的睡眠状态，哪个是正确的？","like_count":6,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458617,"discussion_content":"不同工具的输出格式不完全一样，文章中的b其实就是D状态的进程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563455367,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56387,"user_name":"Geek_5258f8","can_delete":false,"product_type":"c1","uid":1209313,"ip_address":"","ucode":"4EC60AE0C23CBE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIbas4S4X5W15njMeoEPPSyBZRX37nrTXbMFFeHghXl4Slk6WXE7oq5yxoNnukYfcOQs00RAvUmEA/132","comment_is_top":false,"comment_ctime":1546434579,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23021271059","product_id":100020901,"comment_content":"老师，请教一个问题:线程多了会带来性能下降。我们假定一个理想境，所有线程优先级相同，即除了时间片到期切换外，无其他触发条件。那1s内发生的线程切换次数是相同的，即1s&#47;20ms次。从这个角度思考，线程的多少并不影响cpu的整体吞吐量。只是影响对某单个线程的响应时间。我的理解对吗？(这里也去掉了cache失效的影响)","like_count":5},{"had_liked":false,"id":44139,"user_name":"姜小鱼","can_delete":false,"product_type":"c1","uid":1317762,"ip_address":"","ucode":"3E2076E20289BF","user_header":"https://static001.geekbang.org/account/avatar/00/14/1b/82/69581d8a.jpg","comment_is_top":false,"comment_ctime":1543372875,"is_pvip":false,"replies":[{"id":"15825","content":"有没有报错误？可以加上—debug看看有没有错误消息","user_name":"作者回复","comment_id":44139,"uid":"1001282","ip_address":"","utype":1,"ctime":1543409630,"user_name_real":"倪朋飞"}],"discussion_count":2,"race_medal":0,"score":"23018209355","product_id":100020901,"comment_content":"老师 为什么我执行sysbench之后很快就结束了？sysbench --num-threads=10 --max-time=600 --test=threads run 我用的是ubuntu16","like_count":6,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430646,"discussion_content":"有没有报错误？可以加上—debug看看有没有错误消息","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543409630,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1324108,"avatar":"https://static001.geekbang.org/account/avatar/00/14/34/4c/434e87b2.jpg","nickname":"星辰大海","note":"","ucode":"481C00C62EC2F1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":207802,"discussion_content":"老师能不能建个性能优化微信群，方便交流","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584514985,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49714,"user_name":"wmmmeng","can_delete":false,"product_type":"c1","uid":1117517,"ip_address":"","ucode":"C5E29DBB39BB0F","user_header":"https://static001.geekbang.org/account/avatar/00/11/0d/4d/f692ba8b.jpg","comment_is_top":false,"comment_ctime":1544756512,"is_pvip":false,"replies":[{"id":"17963","content":"1. 可以写个简单的SHELL或者Python命令处理下（其实很多工具都是这么玩的）<br>2. RES 是一种中断，执行的时候选择相对闲的CPU运行","user_name":"作者回复","comment_id":49714,"uid":"1001282","ip_address":"","utype":1,"ctime":1544783178,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"14429658400","product_id":100020901,"comment_content":"老师您好，很感谢您的分享，让我了解了Linux的一些基础运行原理。有2句话，我没有太明白“观察一段时间，你可以发现，变化速度最快的是重调度中断（RES），这个中断类型表示，唤醒空闲状态的 CPU 来调度新的任务运行”。1. 变化速度这个怎么理解呢，是指每个cpu的每秒增长值吗，如果是，在有多个interrupts在变动的时候，有什么好的办法方便看变化么（我的是8核的，看到的结果是Local timer interrupts，Performance monitoring interrupts在8个cpu中的高亮也很快，不知道具体有没有什么好的方法看多个cpu多个interripts的变化值）？2. 在老师的配置中，vmstat状态里面r和b状态的进程数远超cpu核数，为啥还会有出现唤醒空闲状态的cpu这一说法呢？望老师不要嫌弃我小白用户，谢谢老师<br>","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432740,"discussion_content":"1. 可以写个简单的SHELL或者Python命令处理下（其实很多工具都是这么玩的）\n2. RES 是一种中断，执行的时候选择相对闲的CPU运行","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544783178,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":238657,"user_name":"yyl","can_delete":false,"product_type":"c1","uid":1170843,"ip_address":"","ucode":"1741DACDFCA9AF","user_header":"https://static001.geekbang.org/account/avatar/00/11/dd/9b/0bc44a78.jpg","comment_is_top":false,"comment_ctime":1596250866,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10186185458","product_id":100020901,"comment_content":"“自愿上下文切换变多了，说明进程都在等待资源，有可能发生了 I&#47;O 等其他问题；<br>非自愿上下文切换变多了，说明进程都在被强制调度，也就是都在争抢 CPU，说明 CPU 的确成了瓶颈；”<br>是否可以这样理解：<br>自愿上下文切换，是任务在竞争除CPU的其他资源，其他资源成为瓶颈；<br>非自愿上下文切换，是任务在竞争CPU，由于执行优先级 或 执行时间片达到等导致的强制释放CPU资源","like_count":3},{"had_liked":false,"id":236225,"user_name":"Solokat","can_delete":false,"product_type":"c1","uid":2062818,"ip_address":"","ucode":"56BAA66C408D73","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/7UJwSjHWKYOwnAYjjiaNBob396XaIqmttnHKuM7ahBu19QCn1mNicrg24nKgzA2kttP8tpV466anzMjMxq8Sx3Lw/132","comment_is_top":false,"comment_ctime":1595355012,"is_pvip":true,"replies":[{"id":"87362","content":"感谢分享！","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1595427753,"ip_address":"","comment_id":236225,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10185289604","product_id":100020901,"comment_content":"贡献一个曾经踩过的坑。<br><br>cswch数目在这个机器低load的情况下，总的cswch数目比高load的情况下，多出一个数量级。例如<br>系统高load：186,616<br>系统低load：1,067,542<br>在这种情况下，低load总的执行时间只是高load下的60%。<br><br>其原因是（我的认识），但cswch发生的时候，必然是两个原因之一：1）等待资源，例如内存，IO。2）高优先级的任务抢断。在我所用到系统中，基本上来自于等待资源，查询数据库的等待。<br><br>cswch只是反映了上下文切换的次数，并没有反映每次切换所~等~待~的~时~间。<br><br>不过也有疑问，为啥在低Load的情况下，上下文切换的次数增加那么多？对此，我也有疑问。<br><br>期待你的赐教！","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501993,"discussion_content":"感谢分享！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595427753,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":147717,"user_name":"鱼君","can_delete":false,"product_type":"c1","uid":1402505,"ip_address":"","ucode":"40F1A109B9ECE0","user_header":"https://static001.geekbang.org/account/avatar/00/15/66/89/af017dba.jpg","comment_is_top":false,"comment_ctime":1572880927,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"10162815519","product_id":100020901,"comment_content":"怎么感觉你们学的那么轻松，我怎么学的一头雾水；","like_count":2,"discussions":[{"author":{"id":1805809,"avatar":"","nickname":"ccz 开发(谢不邀)","note":"","ucode":"B8803B050AAC68","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":133739,"discussion_content":"看到不会的名字，就百度一下各种相关文章，不要仅仅盯着这篇文，慢慢吃，加油","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1578985532,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3076600,"avatar":"","nickname":"Geek_98fb86","note":"","ucode":"65531B96036C16","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583511,"discussion_content":"me too.....","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660162099,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1881192,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIICoUUZlgrZABeK7eek2iceF5XicGTJT22ibJIKbwDcej8qpsqVgMias7cl0HKd9EQQec6EkZSKLPswA/132","nickname":"Geek_32766c","note":"","ucode":"D1267A350D61E2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534677,"discussion_content":"一头雾水的不止你一个人。。。@鱼君","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638256556,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":123385,"user_name":"小苏","can_delete":false,"product_type":"c1","uid":1501618,"ip_address":"","ucode":"1A4776F948C6F5","user_header":"https://static001.geekbang.org/account/avatar/00/16/e9/b2/6a9203b5.jpg","comment_is_top":false,"comment_ctime":1565664769,"is_pvip":false,"replies":[{"id":"45972","content":"线程是Linux调度的基本单位，是操作系统负责调度的（不是进程负责的）。但是，有些编程语言或者框架可能内置了“Thread”的概念，但它们不一定等同于Linux的线程。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1566133611,"ip_address":"","comment_id":123385,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10155599361","product_id":100020901,"comment_content":"老师我有个关于cpu 时间片的问题:<br>        进程是拥有资源的基本单位,很多书上说cpu分配时间片给进程,但是又说线程是cpu调度的基本单位更甚者有的说进程是抢占cpu的基本单位,现在我对这个概念比较乱,那么cpu分配时间片的到底是给进程还是直接给到线程如果是给到进程那么进程中的线程是不是共享进程的时间片,那么进程中的线程是由进程本身去调度的吗?(进程选中一个优先级交搞的线程吧时间片交给这个线程执行) 例如jvm,还是由操作系统去调度?个人理解是线程共享进程的时间片多线程情况下进程选择优先级高(或按照一定的规则)选择一个线程让改线程消耗进程的时间片,但是看了好多资料越看越懵,请老师和同学们帮忙释义下.到底是怎样调度的.","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462646,"discussion_content":"线程是Linux调度的基本单位，是操作系统负责调度的（不是进程负责的）。但是，有些编程语言或者框架可能内置了“Thread”的概念，但它们不一定等同于Linux的线程。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566133611,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43956,"user_name":"十三","can_delete":false,"product_type":"c1","uid":1196791,"ip_address":"","ucode":"D3EFE8729DDE8A","user_header":"https://static001.geekbang.org/account/avatar/00/12/42/f7/9dce9a7b.jpg","comment_is_top":false,"comment_ctime":1543335639,"is_pvip":false,"replies":[{"id":"15843","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543411353,"ip_address":"","comment_id":43956,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10133270231","product_id":100020901,"comment_content":"『D5打卡』<br><br>不用root权限的Linux用户，不是好的用户😂<br>这几天访问&#47;proc 只读文件的次数，比以前几个月都多，老实说，学会pidstat、vmstat这些工具的靠谱使用方法，就值了。不过还是要记住，工具不是全部<br>乌班图真的稳，跟着老师操作，基本没啥问题","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430569,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543411353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":256167,"user_name":"evan","can_delete":false,"product_type":"c1","uid":1543040,"ip_address":"","ucode":"491B073D5AFEDE","user_header":"https://static001.geekbang.org/account/avatar/00/17/8b/80/8702bd5f.jpg","comment_is_top":false,"comment_ctime":1603544454,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5898511750","product_id":100020901,"comment_content":"刚去线上看了下:<br>64核128G内存的机器 上下文切换: 175W... <br>主要跑存储的机器 codis和rocksdb 估计是codis协程切换引起线程切换?","like_count":2},{"had_liked":false,"id":236445,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1595417096,"is_pvip":false,"replies":[{"id":"87360","content":"这是本地定时器中断，也就是每个CPU自己的定时器中断","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1595427565,"ip_address":"","comment_id":236445,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5890384392","product_id":100020901,"comment_content":"我的中断速度最快的是这个，这个啥意思嘞？<br>LOC: 1533644095 4160359531   Local timer interrupts<br>","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":502064,"discussion_content":"这是本地定时器中断，也就是每个CPU自己的定时器中断","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595427565,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":180264,"user_name":"阳光梦","can_delete":false,"product_type":"c1","uid":1283965,"ip_address":"","ucode":"55BDA128D39931","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/TTPicMEZ5s1zKiaKYecIljicRV9dibITPM0958W3VuNHXlTQic2Dj6XYGibF7dqrG3JWr0LMx7hY9zXGzuvTDNGw8KAA/132","comment_is_top":false,"comment_ctime":1582243844,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5877211140","product_id":100020901,"comment_content":"您好，有个问题请教下。多个进程竞争cpu为何导致cpu上下文切换频繁？系统调度进程时，每个进程时间片用完了就调度下个就绪进程。您是指这些进程有优先级，会发生抢占导致的？谢谢","like_count":1},{"had_liked":false,"id":113661,"user_name":"ranger2","can_delete":false,"product_type":"c1","uid":1104177,"ip_address":"","ucode":"59F15FFB511161","user_header":"https://static001.geekbang.org/account/avatar/00/10/d9/31/e58f2fb0.jpg","comment_is_top":false,"comment_ctime":1563107926,"is_pvip":false,"replies":[{"id":"41980","content":"换个大屏幕😊 或者写个脚本，只把变化大的显示出来","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1563456713,"ip_address":"","comment_id":113661,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5858075222","product_id":100020901,"comment_content":"运行这个命令时：watch -d cat &#47;proc&#47;interrupts<br>在终端中，显示的数据行数有限，刚好RES没有显示出来，这个有什么参数可以解决吗？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458336,"discussion_content":"换个大屏幕😊 或者写个脚本，只把变化大的显示出来","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563456713,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1609950,"avatar":"https://static001.geekbang.org/account/avatar/00/18/90/de/7270b6fe.jpg","nickname":"大灰狼","note":"","ucode":"F3B979E6D22CE1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555405,"discussion_content":"缩小显示的字号","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646894474,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":111932,"user_name":"少盐","can_delete":false,"product_type":"c1","uid":1305743,"ip_address":"","ucode":"BCC7E264B75702","user_header":"https://static001.geekbang.org/account/avatar/00/13/ec/8f/8299495a.jpg","comment_is_top":false,"comment_ctime":1562639383,"is_pvip":false,"replies":[{"id":"42000","content":"谢谢分享👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1563459045,"ip_address":"","comment_id":111932,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5857606679","product_id":100020901,"comment_content":"刚开始使用的yum install sysbench,但是提升不能够从阿里源获取，改用以下命令，完成安装<br>$ curl -s https:&#47;&#47;packagecloud.io&#47;install&#47;repositories&#47;akopytov&#47;sysbench&#47;script.rpm.sh | sudo bash<br><br>$ sudo yum -y install sysbench<br>vmstat  pidstat  sysbench 都是第一次接触，慢慢熟悉下","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457501,"discussion_content":"谢谢分享👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563459045,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1297749,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEJSYNNABBxXCme5FMGUYTPbvnT6IvpzPP3qiaSibZficAfabydnwWOV6LlQ4lAtF0aeN3ficv0S3iavmxQ/132","nickname":"wumin","note":"","ucode":"419A9FDDC9636D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":249954,"discussion_content":"感谢。\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587978566,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":75423,"user_name":"小小鸟","can_delete":false,"product_type":"c1","uid":1102550,"ip_address":"","ucode":"11C15D267DE457","user_header":"https://static001.geekbang.org/account/avatar/00/10/d2/d6/d393593d.jpg","comment_is_top":false,"comment_ctime":1552395894,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5847363190","product_id":100020901,"comment_content":"打卡 加油 <br>负载<br>CPU<br>  真正使用率高<br>   上下文切换 ： 自愿切换 非自愿切换<br>IO<br>网络IO 文件IO","like_count":1},{"had_liked":false,"id":63026,"user_name":"曾经瘦过","can_delete":false,"product_type":"c1","uid":1240106,"ip_address":"","ucode":"57C32575A1C1FD","user_header":"https://static001.geekbang.org/account/avatar/00/12/ec/2a/b11d5ad8.jpg","comment_is_top":false,"comment_ctime":1548231743,"is_pvip":false,"replies":[{"id":"22346","content":"嗯 是的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548252611,"ip_address":"","comment_id":63026,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5843199039","product_id":100020901,"comment_content":"mark  长见识了 &#47;proc下面其实有很多文件都是很有用出的 还有内核态 用户态  系统调用导致的cpu切换  还有中断  让我更加清晰产生native崩溃的时候 android的的运行，对捕获native那部分内容有了更好的认识，同时 以后也对 android  cpu 部分的优化 更加深入了解 PS：曾经纠结了半天 为啥CPU要多任务同时执行。。后来想了一下linux是多用户系统，需要多任务同事执行 额.","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437442,"discussion_content":"嗯 是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548252611,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53995,"user_name":"Q","can_delete":false,"product_type":"c1","uid":1047423,"ip_address":"","ucode":"785546C617D3DF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fb/7f/746a6f5e.jpg","comment_is_top":false,"comment_ctime":1545784651,"is_pvip":false,"replies":[{"id":"19726","content":"👍👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545839980,"ip_address":"","comment_id":53995,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5840751947","product_id":100020901,"comment_content":"<br>\t* 如何查看CPU上下文切换情况？<br>vmstat，指标参数(cs 每秒上下文切换次数、in 每秒中断次数、r 进程就绪队列、b 不可中断睡眠的进程数)，注意该工具只显示进程切换总体状态，不显示具体进程的切换状态<br>pidstat，指标参数(cswch 自愿上下文切换，一般是资源不足导致、nvcswch 非自愿上下文切换，时间片花完，被强制切换)，该工具可以显示具体进程的切换状态，加上 -t 参数之后显示具体的线程切换状态<br>\t* 上下文切换次数多少才算正常？综合分析自愿、非自愿上下文切换次数、中断次数(中断会导致上下文切换)，结合系统正常、平稳运行状态下的基线状态来判断<br><br>\t* 如何查看中断情况？ cat &#47;proc&#47;interrupts<br><br>注意，我在实验过程中由于虚拟机只配了一个核心CPU，所以RES值为0，因为该中断类型表示，唤醒空闲状态的 CPU 来调度新的任务运行，由于只配置了一个CPU，就没有空闲的CPU可用。当把CPU核数增加到2个之后，该RES值才体现出来。","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434316,"discussion_content":"👍👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545839980,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51890,"user_name":"Lost In The Echo。","can_delete":false,"product_type":"c1","uid":1211954,"ip_address":"","ucode":"6EC7BF57DA3A15","user_header":"https://static001.geekbang.org/account/avatar/00/12/7e/32/e569f729.jpg","comment_is_top":false,"comment_ctime":1545274102,"is_pvip":false,"replies":[{"id":"18888","content":"top显示的不全","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545313350,"ip_address":"","comment_id":51890,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5840241398","product_id":100020901,"comment_content":"top里面好像都有这些数据吧","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433663,"discussion_content":"top显示的不全","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545313350,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49450,"user_name":"9527","can_delete":false,"product_type":"c1","uid":1032735,"ip_address":"","ucode":"04B51C09E3C7B8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c2/1f/343f2dec.jpg","comment_is_top":false,"comment_ctime":1544690723,"is_pvip":false,"replies":[{"id":"17823","content":"第一个问题单核没有RES是正常的，第二个看起来也是正常的，文中也提了绝对值跟系统有关；第三个负载的确很低","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544744089,"ip_address":"","comment_id":49450,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5839658019","product_id":100020901,"comment_content":"老师好，我有些问题<br>您在试验中，最后中断是因为RES 导致的<br>我自己试验发现是是LOC Local timer interrupts 这个值变化比较大，RES没变化<br>我用的是阿里云单CPU的机器，是否是机器原因导致的试验差别呢<br><br>另外您提到了上下文切换数量是 几百--一万以内<br>因为公司线上机器有台机器正在做数据传输，读一个A服务器的数据再写入到B服务器<br>我用dstat看，每秒的中断高达10W了，上下文切换也是7-8W，机器的idl大概是80，网络读400M+，写200M+<br>机器配置是 2.2G*40核，128G内存，万M网卡，因为只是从网络读，再通过网络写，所以磁盘无压力<br>但这个中断和上下文切换数量比老师说的高了很多，这种算是正常吗？<br><br>我用 watch -d cat &#47;proc&#47;interrupts  看这个机器，因为是40核的，CPU太多了<br>显示都完全乱了，根本看不出来了，对于CPU核太多的，显示上有什么更好的方式吗？<br><br>最后再问下平均负载的问题<br>我看线上机器，1m，5m，15m 平均负载看都是1.2到1.3的样子<br>因为这个机器是40核的，所以每个CPU都满负荷运作的话，平均负载应该是 40.0 吗？<br>现在我看到的负载是1.2，1.3的样子，就表示其实负载还是比较低的？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432622,"discussion_content":"第一个问题单核没有RES是正常的，第二个看起来也是正常的，文中也提了绝对值跟系统有关；第三个负载的确很低","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544744089,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1013424,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","nickname":"不了峰","note":"","ucode":"E23B96D6A3D4EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540206,"discussion_content":"我用 watch -d cat /proc/interrupts 看这个机器，因为是40核的，CPU太多了\n显示都完全乱了，根本看不出来了，对于CPU核太多的，显示上有什么更好的方式吗？\n\n--加大显示的宽度（逻辑列=1000） ：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639988063,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43961,"user_name":"二三子也","can_delete":false,"product_type":"c1","uid":1245787,"ip_address":"","ucode":"69C7D86583277D","user_header":"https://static001.geekbang.org/account/avatar/00/13/02/5b/ce326cfc.jpg","comment_is_top":false,"comment_ctime":1543337557,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5838304853","product_id":100020901,"comment_content":"Flag","like_count":1},{"had_liked":false,"id":346943,"user_name":"momo","can_delete":false,"product_type":"c1","uid":1875126,"ip_address":"","ucode":"E7DE4095DFEF5D","user_header":"https://static001.geekbang.org/account/avatar/00/1c/9c/b6/f6acc0a6.jpg","comment_is_top":false,"comment_ctime":1653552284,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1653552284","product_id":100020901,"comment_content":"你好。请问下。再sysbench模仿压力测试时，我用 vmstat 命令。 直接输出 当前占用情况， 上下文切换次数和cpu使用率也并不高。这是为什么呢？ ","like_count":0},{"had_liked":false,"id":331555,"user_name":"正能量","can_delete":false,"product_type":"c1","uid":2896298,"ip_address":"","ucode":"F70048FFBE28E0","user_header":"https://static001.geekbang.org/account/avatar/00/2c/31/aa/ffd59a50.jpg","comment_is_top":false,"comment_ctime":1642650473,"is_pvip":true,"replies":[{"id":"121246","content":"是的，但是由于Docker的实现原理，很多性能工具在容器内和容器外的运行方法还是有很大不同的。你可以在后面的学习过程中对比一下看看。","user_name":"作者回复","user_name_real":"编辑","uid":"1001282","ctime":1642858411,"ip_address":"","comment_id":331555,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1642650473","product_id":100020901,"comment_content":"由于虚拟机和真实Linux环境搭建比较麻烦。 可以考虑使用 docker镜像 这也符合当下 云服务的实际情况。 win10装上 docker后，拉取Ubuntu镜像，即可。而且docker配置的灵活性更高。 只是建议","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547777,"discussion_content":"是的，但是由于Docker的实现原理，很多性能工具在容器内和容器外的运行方法还是有很大不同的。你可以在后面的学习过程中对比一下看看。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642858411,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":329107,"user_name":"ch_ort","can_delete":false,"product_type":"c1","uid":1580926,"ip_address":"","ucode":"B79746E687F29E","user_header":"","comment_is_top":false,"comment_ctime":1641124736,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1641124736","product_id":100020901,"comment_content":"问题： 上下文切换高，一般cpu sys也会高？ 为什么还要看上下文切呢？","like_count":0},{"had_liked":false,"id":319684,"user_name":"李海洋","can_delete":false,"product_type":"c1","uid":2752674,"ip_address":"","ucode":"C13EF35DB5CDCB","user_header":"","comment_is_top":false,"comment_ctime":1635908705,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635908705","product_id":100020901,"comment_content":"麻烦问下老师为什么我在centos7.6里执行 sysbench --threads=10 --max-time=300 threads run后使用pidstat -wt 1命令查看进程指标数据，sysbench的线程显示在kworker&#47;0:0进程下呢？","like_count":0},{"had_liked":false,"id":317572,"user_name":"robonix","can_delete":false,"product_type":"c1","uid":1212323,"ip_address":"","ucode":"866EC82EDA455B","user_header":"https://static001.geekbang.org/account/avatar/00/12/7f/a3/23540579.jpg","comment_is_top":false,"comment_ctime":1634864149,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1634864149","product_id":100020901,"comment_content":"老师，如果两个进程运行在不同的CPU上，这两个进程还会互相干扰吗？比如其中一个CPU使用率很高，会使得另一个CPU任务处理滞后吗","like_count":0,"discussions":[{"author":{"id":1129668,"avatar":"https://static001.geekbang.org/account/avatar/00/11/3c/c4/7c2bf312.jpg","nickname":"草根","note":"","ucode":"7C97CB09A4D8F1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540172,"discussion_content":"不会","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639980055,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":315874,"user_name":"Ansyear","can_delete":false,"product_type":"c1","uid":1629257,"ip_address":"","ucode":"489CE96852EA2C","user_header":"https://static001.geekbang.org/account/avatar/00/18/dc/49/43ae1627.jpg","comment_is_top":false,"comment_ctime":1634028982,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634028982","product_id":100020901,"comment_content":"我这边测试的为啥Ubuntu16.04下b的中断数使用为0没有变化呢？","like_count":0},{"had_liked":false,"id":313410,"user_name":"时不我待","can_delete":false,"product_type":"c1","uid":2778842,"ip_address":"","ucode":"6556E24AC47BBF","user_header":"https://static001.geekbang.org/account/avatar/00/2a/66/da/380b8f00.jpg","comment_is_top":false,"comment_ctime":1632411434,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632411434","product_id":100020901,"comment_content":"以前不考虑这个问题","like_count":0},{"had_liked":false,"id":306856,"user_name":"mc","can_delete":false,"product_type":"c1","uid":1095597,"ip_address":"","ucode":"DCB78290963673","user_header":"https://static001.geekbang.org/account/avatar/00/10/b7/ad/d2136404.jpg","comment_is_top":false,"comment_ctime":1628748676,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628748676","product_id":100020901,"comment_content":"我按照文章去操作，执行sysbench --threads=10 --max-time=300 threads run报错了，我根据提示信息看了sysbench的使用说明，然后执行这个命令：sysbench --test=threads --num-threads=10 --max-time=300 run<br>然后窗口2和窗口3按照提示操作，但是窗口2的r、b都是0，in 和cs都是几百左右，窗口3都没有看到sysbench相关的东西，%CPU 都是那种1,3之类的很小的值，根本没有100%的那种，整个例子的效果，我根本没有做到文中的效果，也不知道是什么原因，有知道的大佬可以跟我讲一下吗","like_count":0},{"had_liked":false,"id":305649,"user_name":"wenpin","can_delete":false,"product_type":"c1","uid":1134027,"ip_address":"","ucode":"A66E3A4A59093A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/WSClHmjiaTh5D3lKAia9CBiaUqFf46ZludOVk9S5GnElUSDsH9ZzBtVktF5xEEQq4VCFXM0lgKdbzFTHateKylmibw/132","comment_is_top":false,"comment_ctime":1628087506,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628087506","product_id":100020901,"comment_content":"老师说的每秒几百到一万次上下文切换是正常的，是每台机器呢还是平均每个核？假如一台机器是100核 ，合理的上下文切换次数也是这个数字吗","like_count":0},{"had_liked":false,"id":304820,"user_name":"💢 星星💢","can_delete":false,"product_type":"c1","uid":1254392,"ip_address":"","ucode":"A402B765222C35","user_header":"https://static001.geekbang.org/account/avatar/00/13/23/f8/24fcccea.jpg","comment_is_top":false,"comment_ctime":1627629053,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1627629053","product_id":100020901,"comment_content":"老师，为啥vimstat看到的cs ,in 3000多，到pidstat 看就一起加起来就几百呢。这是什么原因呢？怎么处理这样的情况呢？","like_count":0,"discussions":[{"author":{"id":1107484,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e6/1c/9d3744ee.jpg","nickname":"小李讲源码","note":"","ucode":"2573037D7C82C8","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":561092,"discussion_content":"pidstat wt 查看线程上下文切换次数看看。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649551875,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":300245,"user_name":"Geek_fa64a4","can_delete":false,"product_type":"c1","uid":2679439,"ip_address":"","ucode":"91C68BB7ABEB02","user_header":"","comment_is_top":false,"comment_ctime":1625061690,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625061690","product_id":100020901,"comment_content":"如果机器负载特别高 高到sshd都连不上 是不是只能重启机器了？","like_count":0},{"had_liked":false,"id":294527,"user_name":"吴小伟","can_delete":false,"product_type":"c1","uid":1027604,"ip_address":"","ucode":"7B29DBED8D6D78","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ae/14/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1621990882,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1621990882","product_id":100020901,"comment_content":"我这次有个服务10k左右，简单逻辑，就是读multipart form的文件，然后返回，观察下来，上下文切换有几百万，sys 10%，这个该如何优化呢","like_count":0},{"had_liked":false,"id":293682,"user_name":"Geek_9710b6","can_delete":false,"product_type":"c1","uid":2540777,"ip_address":"","ucode":"0C6286C17B7E48","user_header":"","comment_is_top":false,"comment_ctime":1621490478,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1621490478","product_id":100020901,"comment_content":"老师，你好！我按照案例来做，中断变换最大的并不是RES，而是LOC。想问下，这两个中断是否有什么联系呢？","like_count":0,"discussions":[{"author":{"id":1805809,"avatar":"","nickname":"ccz 开发(谢不邀)","note":"","ucode":"B8803B050AAC68","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382934,"discussion_content":"看一下其它的评论，有回答到","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625797505,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288567,"user_name":"清水","can_delete":false,"product_type":"c1","uid":2559543,"ip_address":"","ucode":"D25F83AA62FD70","user_header":"","comment_is_top":false,"comment_ctime":1618540608,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618540608","product_id":100020901,"comment_content":"环境集群部署，主机上安装有多个pod：用vmstat 1 检查web应用发现r高，b偶尔一次，cs高达5W，但是us+sy都不够20，in也高达1.5W，但是用都pidstat -w -u  1 都是只有没抓到有用的线程，都是我用的命令 top和pidstat，没有办法找到导致中断和cs高的原因<br><br>感觉一台主机上多个不同应用的pod不好看资源","like_count":0},{"had_liked":false,"id":287565,"user_name":"谨兮谨兮","can_delete":false,"product_type":"c1","uid":1376885,"ip_address":"","ucode":"55712DD3852169","user_header":"https://static001.geekbang.org/account/avatar/00/15/02/75/2839c0bb.jpg","comment_is_top":false,"comment_ctime":1618032620,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618032620","product_id":100020901,"comment_content":"定位到了哪个进程是上下文切换的源头 我还想进一步定位是是什么函数导致的  应该怎么做","like_count":0},{"had_liked":false,"id":287426,"user_name":"睡着了去做梦","can_delete":false,"product_type":"c1","uid":1171280,"ip_address":"","ucode":"1B553D695BC70D","user_header":"https://static001.geekbang.org/account/avatar/00/11/df/50/ed811610.jpg","comment_is_top":false,"comment_ctime":1617943873,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617943873","product_id":100020901,"comment_content":"上下文切换超过1万就算不正常，是指多个cpu还是单个，我系统2万左右，4核的，也没啥不正常","like_count":0},{"had_liked":false,"id":284282,"user_name":"liuy","can_delete":false,"product_type":"c1","uid":1643287,"ip_address":"","ucode":"F5863E5613058A","user_header":"https://static001.geekbang.org/account/avatar/00/19/13/17/93f954d3.jpg","comment_is_top":false,"comment_ctime":1616148629,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616148629","product_id":100020901,"comment_content":"sysbench --threads=10 --max-time=300 threads run<br>--thread-yields=N number of yields to do per request [1000]<br>--thread-locks=N  number of locks per thread [8]<br>您好，请问这个命令做的是什么啊？我把lock数量变少后发现cpu跑不起来了<br>","like_count":0},{"had_liked":false,"id":284266,"user_name":"liuy","can_delete":false,"product_type":"c1","uid":1643287,"ip_address":"","ucode":"F5863E5613058A","user_header":"https://static001.geekbang.org/account/avatar/00/19/13/17/93f954d3.jpg","comment_is_top":false,"comment_ctime":1616144404,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616144404","product_id":100020901,"comment_content":"sysbench --thread 10 ... <br>请问这个命令创建的10个线程在做什么啊？ ","like_count":0},{"had_liked":false,"id":284052,"user_name":"光","can_delete":false,"product_type":"c1","uid":1284618,"ip_address":"","ucode":"BDA7F41566E4FE","user_header":"https://static001.geekbang.org/account/avatar/00/13/9a/0a/6c74e932.jpg","comment_is_top":false,"comment_ctime":1616051557,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1616051557","product_id":100020901,"comment_content":"问下在k8s 中发现上下文切换特别严重。有好的办法解决么","like_count":0},{"had_liked":false,"id":283064,"user_name":"不将就","can_delete":false,"product_type":"c1","uid":1168579,"ip_address":"","ucode":"9BEC01AEE1D885","user_header":"https://static001.geekbang.org/account/avatar/00/11/d4/c3/d41e8c79.jpg","comment_is_top":false,"comment_ctime":1615536569,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1615536569","product_id":100020901,"comment_content":"老师，您好，我在查看中断的回收，怎么看不到RES这种类型，而只能看到数字<br>Every 2.0s: cat &#47;proc&#47;interrupts                                                                               ubuntu: Fri Mar 12 16:09:21 2021<br><br>            CPU0       CPU1<br>   0:          7          0   IO-APIC    2-edge      timer<br>   1:        297         10   IO-APIC    1-edge      i8042<br>   8:          1          0   IO-APIC    8-edge      rtc0<br>   9:          0          0   IO-APIC    9-fasteoi   acpi<br>  12:       1294        203   IO-APIC   12-edge      i8042<br>  14:          0          0   IO-APIC   14-edge      ata_piix<br>  15:          0          0   IO-APIC   15-edge      ata_piix<br>  16:       3999         18   IO-APIC   16-fasteoi   vmwgfx, snd_ens1371<br>  17:      27263          0   IO-APIC   17-fasteoi   ehci_hcd:usb1, ioc0<br>  18:          0         78   IO-APIC   18-fasteoi   uhci_hcd:usb2<br>  19:          0     157499   IO-APIC   19-fasteoi   ens33","like_count":0,"discussions":[{"author":{"id":1013424,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","nickname":"不了峰","note":"","ucode":"E23B96D6A3D4EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540208,"discussion_content":"输出的高度设小了，没有完整输出","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639988178,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":283013,"user_name":"ʚ🧸ྀིɞ","can_delete":false,"product_type":"c1","uid":2454787,"ip_address":"","ucode":"17CC693141E193","user_header":"https://static001.geekbang.org/account/avatar/00/25/75/03/c249f389.jpg","comment_is_top":false,"comment_ctime":1615518878,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1615518878","product_id":100020901,"comment_content":"自愿上下文切换，是指进程无法获取所需资源，导致的上下文切换。 这个的意思是不是指获取到不资源后主动让出CPU时间片呢？","like_count":0,"discussions":[{"author":{"id":2153296,"avatar":"https://static001.geekbang.org/account/avatar/00/20/db/50/c2d07bb1.jpg","nickname":"L。","note":"","ucode":"FCE0BC976776E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389954,"discussion_content":"请老师指教 这块我也有点疑问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629536237,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":278684,"user_name":"Morton","can_delete":false,"product_type":"c1","uid":1544422,"ip_address":"","ucode":"9D0E7715B0C0AB","user_header":"https://static001.geekbang.org/account/avatar/00/17/90/e6/5eb07352.jpg","comment_is_top":false,"comment_ctime":1613199063,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1613199063","product_id":100020901,"comment_content":"老师您好，假如一个线程阻塞在远程socket接口调用时，会发生上下文切换，占用cpu资源吗","like_count":0},{"had_liked":false,"id":274647,"user_name":"Geek_88dbc9","can_delete":false,"product_type":"c1","uid":2417658,"ip_address":"","ucode":"371480D559ACC5","user_header":"","comment_is_top":false,"comment_ctime":1611110751,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1611110751","product_id":100020901,"comment_content":"老师您好， CentOS 系统8核执行<br>sysbench --threads=10 --max-time=300 threads run<br>并没有啥效果","like_count":0},{"had_liked":false,"id":269414,"user_name":"Geek_065895","can_delete":false,"product_type":"c1","uid":2136069,"ip_address":"","ucode":"2E6FCCC78E5767","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/rxz5aKicRkvqWmt6c6c7eayHvh577uibBTVQzcJKwSTqI9FaxZSRlx7NRVw4atWpqER8ncA5jErQb3wb4cPzZxlA/132","comment_is_top":false,"comment_ctime":1608636964,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608636964","product_id":100020901,"comment_content":"过多的上下文切换，会把 CPU 时间消耗在寄存器、内核栈以及虚拟内存等数据的保存和恢复上<br><br>关键词:vmstat 判断正常的上下文切换次数 自愿&#47;非自愿上下文切换<br><br>知识点<br>\t1. 自愿上下文切换:CPU时间片正常轮换<br>\t2. 非自愿上下文切换:进程被强制进行CPU上下文切换,说明都在抢CPU<br>\t3. 判断正常的上下文切换次数:稳定的数百到万.如果出现指数型增长,就可以认为不正常了.然后根据上下文切换类型(自愿&#47;非自愿上下文切换,中断)判断原因<br><br>Linux命令<br>\t1. vmstat 1 1(cs(context switch),in(interrupt),r(running or runnable),b(blocked),us(user),sy(system)<br>\t2. sysbench:多线程的基准测试工具，一般用来评估不同系统参数下的数据库负载情况<br>问题:<br>\t1. 处于runnable状态的进程为什么会占用CPU资源?<br>","like_count":0},{"had_liked":false,"id":254902,"user_name":"一粒","can_delete":false,"product_type":"c1","uid":1582813,"ip_address":"","ucode":"FB5F583CC6AE3C","user_header":"https://static001.geekbang.org/account/avatar/00/18/26/dd/d58156b1.jpg","comment_is_top":false,"comment_ctime":1603209233,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1603209233","product_id":100020901,"comment_content":"要把操作系统原理看一遍了","like_count":0},{"had_liked":false,"id":253228,"user_name":"Geek_f702be","can_delete":false,"product_type":"c1","uid":1143067,"ip_address":"","ucode":"8E3B5F393C4266","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epumnXjMLYzHkGFhAraIiaAMXpotuUR9PCexBWl25tRLFAvpzs03Hfse4Y1lyeWuryz6z80Fd8AXiaw/132","comment_is_top":false,"comment_ctime":1602657241,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602657241","product_id":100020901,"comment_content":"打卡<br>top查看系统整体情况<br>mpstat和pidstat确认是cpu密集、io密集型、大量进程竞争导致负载问题<br>如果是多进程竞争导致上下文切换，这个时候要判断是哪种类型的上下文切换<br>使用vmstat来查看上下文切换、中断、就绪队列、等待io的情况<br>结合pidstat来分析上下文切换类型，是自愿还是非自愿<br>","like_count":0},{"had_liked":false,"id":253051,"user_name":"Geek_f702be","can_delete":false,"product_type":"c1","uid":1143067,"ip_address":"","ucode":"8E3B5F393C4266","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epumnXjMLYzHkGFhAraIiaAMXpotuUR9PCexBWl25tRLFAvpzs03Hfse4Y1lyeWuryz6z80Fd8AXiaw/132","comment_is_top":false,"comment_ctime":1602578698,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602578698","product_id":100020901,"comment_content":"打卡day2<br>上下文切换：<br>1、时间片耗完<br>2、系统资源不足，等待<br>3、主动挂起<br>4、优先级更高程序运行<br>5、硬件中断<br><br>3、","like_count":0},{"had_liked":false,"id":252725,"user_name":"郑斌","can_delete":false,"product_type":"c1","uid":2224641,"ip_address":"","ucode":"E253447BAB1E23","user_header":"https://static001.geekbang.org/account/avatar/00/21/f2/01/80521228.jpg","comment_is_top":false,"comment_ctime":1602469519,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602469519","product_id":100020901,"comment_content":"我之前只会用perf tool去dump state来看cs次数，只笼统地知道这个数变大了会影响性能，但做不到量化","like_count":0},{"had_liked":false,"id":248984,"user_name":"杨朔","can_delete":false,"product_type":"c1","uid":1698559,"ip_address":"","ucode":"EEE553EF6D2C5A","user_header":"https://static001.geekbang.org/account/avatar/00/19/ea/ff/000af703.jpg","comment_is_top":false,"comment_ctime":1600394659,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1600394659","product_id":100020901,"comment_content":"我发现目前这些仿佛都解决不了我的问题……<br>我这里是网络服务，程序都是跑在协程上，就是brpc的bthread，<br>它和pthread之间还有一层调度，这个调度通过以上介绍的工具都查不出来吧……<br>然后你会发现cpu也没跑满，io也没跑满，但是还是会有错误（失败的请求）<br>初步推测是程序写的调度不合理，频繁加锁之类的导致性能低下<br>像这种问题，系统工具也识别不出来，即使是profile工具也无能为力（只显示函数耗时，但加锁等显示不出来）<br>问下老师，这种问题就只能人肉代码发现问题了吗？","like_count":0},{"had_liked":false,"id":246831,"user_name":"xzy","can_delete":false,"product_type":"c1","uid":1002095,"ip_address":"","ucode":"1A44368083A19E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4a/6f/e36b3908.jpg","comment_is_top":false,"comment_ctime":1599488172,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599488172","product_id":100020901,"comment_content":"不可中断睡眠状态的进程是什么进程？能否举个例子","like_count":0},{"had_liked":false,"id":246533,"user_name":"、Ama","can_delete":false,"product_type":"c1","uid":1671811,"ip_address":"","ucode":"50CFBE9125C379","user_header":"https://static001.geekbang.org/account/avatar/00/19/82/83/50931cc3.jpg","comment_is_top":false,"comment_ctime":1599393464,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599393464","product_id":100020901,"comment_content":"请问老师嵌入式环境咋办？系统根本不会有这些工具，只有基本的命令。有些工具的结果可以通过系统得到，有些不知道去哪里获取。","like_count":0},{"had_liked":false,"id":244616,"user_name":"此号用来看新闻","can_delete":false,"product_type":"c1","uid":2152758,"ip_address":"","ucode":"D74C189B6922C0","user_header":"","comment_is_top":false,"comment_ctime":1598596404,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598596404","product_id":100020901,"comment_content":"我一个虚拟机4核6G跑sysbench测试，中断一下飚到5万多，上下文切换130万，这说明性能不行吧。","like_count":0},{"had_liked":false,"id":244406,"user_name":"刀刀","can_delete":false,"product_type":"c1","uid":1193232,"ip_address":"","ucode":"9C0FD56AA3950F","user_header":"https://static001.geekbang.org/account/avatar/00/12/35/10/f0e8fc14.jpg","comment_is_top":false,"comment_ctime":1598508414,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598508414","product_id":100020901,"comment_content":"老师，请问 RES 能通过数值大小判断过多任务的调度吗？因为我是嵌入式开发板，不好观察变化速度。如下：<br>IPI0:  20894550    3652011   14969306   11874933       Rescheduling interrupts<br>板子上四个核的数字都比较大，是否可以确定是因为任务调度过多呢？","like_count":0},{"had_liked":false,"id":241000,"user_name":"番茄巴拉巴","can_delete":false,"product_type":"c1","uid":1663904,"ip_address":"","ucode":"2E9E05C406CE14","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJZ6CiaZkFUoicXB1OnTkhElOkU8YyoW1KdYwsmJ6TnYicSqiazLWvN1kKiaVyRge9QJeic0YRia6icUaHFLA/132","comment_is_top":false,"comment_ctime":1597146565,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1597146565","product_id":100020901,"comment_content":"我的测试场景: 服务每 10s 给 2 万个 tcp 长连接发送字符串, 每个都是直接调用 write 函数. 结果发现 nvcswch&#47;s 一直为 0, cswch&#47;s 只在 tcp 连接数逐渐增加的时候偶尔 100 左右, tcp 连接数稳定在 100 后, 这两个值都为 0 了. 这不符合教程的描述啊, 按教程的描述, 调用一次 write 就应该有 2 次上下文切换的","like_count":0,"discussions":[{"author":{"id":1663904,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJZ6CiaZkFUoicXB1OnTkhElOkU8YyoW1KdYwsmJ6TnYicSqiazLWvN1kKiaVyRge9QJeic0YRia6icUaHFLA/132","nickname":"番茄巴拉巴","note":"","ucode":"2E9E05C406CE14","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":298122,"discussion_content":"错了，是稳定在2万后","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597197803,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":236448,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1595417413,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595417413","product_id":100020901,"comment_content":"总结：<br>--使用vmstat查看系统上下文切换<br><br>\tvmstat 只给出了系统总体的上下文切换情况，要想查看每个进程的详细情况，就需要使用我们前面提到过的 pidstat了。<br>给它加上 -w 选项，你就可以查看每个进程上下文切换的情况了。<br>[每隔5秒输出1组数据]<br># vmstat 5   <br><br>重点参数：<br>system：<br>※ cs（context switch）是每秒上下文切换的次数。<br>※ in（interrupt）则是每秒中断的次数。<br>procs：<br>※ r（Running or Runnable）是就绪队列的长度，也就是正在运行和等待 CPU 的进程数。<br>※ b（Blocked）则是处于不可中断睡眠状态的进程数。<br><br><br>--观察每个进程的上下文切换情况：<br># pidstat -w 5<br><br>两个重点参数：<br>cswch ： 表示每秒自愿上下文切换（voluntary context switches）的次数。<br>nvcswch ： 表示每秒非自愿上下文切换（non voluntary context switches）的次数。<br><br>解释：<br>※ 自愿上下文切换，是指进程无法获取所需资源，导致的上下文切换。比如说， I&#47;O、内存等系统资源不足时，就会发生自愿上下文切换。<br>※ 非自愿上下文切换，则是指进程由于时间片已到等原因，被系统强制调度，进而发生的上下文切换。比如说，大量进程都在争抢 CPU 时，就容易发生非自愿上下文切换。<br><br><br>-- 使用 sysbench 来模拟系统多线程调度切换<br>sysbench 是一个多线程的基准测试工具，一般用来评估不同系统参数下的数据库负载情况。<br>机器配置：2 CPU，4GB 内存<br><br><br>-&gt;间隔1秒后输出1组数据,查看空闲系统的上下文切换次数<br># vmstat 1 1<br><br>结果：<br>cs：上下文切换次数为0<br>in：中断次数为0<br>r：正在运行和等待CPU的进程数6<br>b：处于不可中断睡眠状态的进程数0<br><br><br>window1:<br>-&gt;以10个线程运行5分钟的基准测试，模拟多线程切换的问题<br> sysbench --threads=10 --max-time=300 threads run<br><br><br><br>window2:<br>-&gt; 运行 vmstat  ，观察上下文切换情况,每隔1秒输出1组数据<br>vmstat 1<br><br>观察：<br>1）cs列上下文切换次数的增长<br>2）r列正在运行和等待cpu的进程数<br>3）us（user cpu使用率）和 sy（system cpu使用率）两列的 CPU 使用率加起来上升到了多少<br>4）中断处理次数in是多少。<br>综合看这几个指标，看是否r即正在运行和等待cpu的进程过多，导致cs即上下文切换激增，进而导致us+sy即cpu使用率激增呢？<br><br>window3：<br>找出是哪个进程导致的cpu使用率增高？<br>-&gt;-w参数表示输出进程切换指标，而-u参数则表示输出CPU使用指标<br>平均时间:   UID       PID    %usr %system  %guest    %CPU   CPU  Command<br>平均时间:     0     10760   12.73   99.09    0.00  100.00     -  sysbench<br>说明：这个命令只输出进程Id，如果想看线程id的可以用如下命令，这个命令至少可以看到CPU 使用率的升高果然是 sysbench 导致的。<br><br><br>-&gt;-wt 参数表示输出线程的上下文切换指标,每隔1秒输出一组数据<br>pidstat -wt 1<br>观察：可以通过输出观察到cpu使用率最高的进程，但不代表是这个进程导致的线程上下文切换增高，可以观察cswch&#47;s nvcswch&#47;s两列<br>知道非自愿上下文切换频率最高的进程，以及自愿上下文切换频率最高的进程。<br><br><br>window4：<br>-&gt;观察中断的变化情况，-d 参数表示高亮显示变化的区域<br>watch -d cat &#47;proc&#47;interrupts","like_count":0},{"had_liked":false,"id":236245,"user_name":"酸辣土豆丝","can_delete":false,"product_type":"c1","uid":1751234,"ip_address":"","ucode":"0E3E4AFB31E1E6","user_header":"https://static001.geekbang.org/account/avatar/00/1a/b8/c2/d1904d74.jpg","comment_is_top":false,"comment_ctime":1595376993,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595376993","product_id":100020901,"comment_content":"对于上下文的切换，先使用vmstat,再使用pidstat,分别从进程和线程两个方面进行对比，最后使用内核的中断文件进行辅助验证","like_count":0},{"had_liked":false,"id":230494,"user_name":"生活不如诗","can_delete":false,"product_type":"c1","uid":1139515,"ip_address":"","ucode":"FD48EABEEC52B7","user_header":"https://static001.geekbang.org/account/avatar/00/11/63/3b/c5cd68ab.jpg","comment_is_top":false,"comment_ctime":1593400359,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593400359","product_id":100020901,"comment_content":"通过pidstat命令和vmstat命令可以分析cpu上下文切换的次数。<br>pidstat -w输出命令有cswch和nvcswch。<br>1. cswch：自愿中断，表示进程请求的资源不到位，如果此值过高表示系统io可能是瓶颈；<br>2. nvcswch：非自愿中断，表示进程的时间片用完了，被强制中断，如果此值过高表示cpu可能是瓶颈；<br>vmstat输出中：<br>1. r：就绪队列，表示正在运行和等待cpu的进程数；<br>2. b：处于不可中断睡眠状态的进程数；<br>3. cs：上下文切换次数；<br>4. in：中断次数；<br>关于中断次数，可以通过查看&#47;proc&#47;interrupts来进行分析。<br>&#47;proc&#47;interrupts中的res（重调度中断），表示唤醒空闲cpu来调度进程任务。此值变化过快表示进程过多，cpu不够用。<br>上下文切换的次数在100-10000以内应该是正常值。但是如果上下文切换次数超过一万或骤然出现指数级增长，说明系统存在问题。","like_count":0},{"had_liked":false,"id":227472,"user_name":"sky","can_delete":false,"product_type":"c1","uid":1008071,"ip_address":"","ucode":"9FE5F43055D3AB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/61/c7/b64ac05e.jpg","comment_is_top":false,"comment_ctime":1592387898,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592387898","product_id":100020901,"comment_content":"1:对这句话有个疑问,自愿上下文切换变多了，说明进程都在等待资源，有可能发生了 I&#47;O 等其他问题 <br>日常我们的开发过程中一些 阻塞式IO代码,例如socket 或者文件IO, 都是自愿放弃当前自己的cpu 执行时间片?称为自愿切换?<br>2:nvcswch过多说明调度争抢cpu过多，中断次数变多说明cpu被中断程序调用, 这里的 nvc 和 RES 中断应该是等价的吧, 因为线程都在等待cpu 执行,且在一次时间片内未执行完即被分配给其它线程时间片到了  RES 中断,所以引起切换? 求指教","like_count":0},{"had_liked":false,"id":223077,"user_name":"臧咔嚓","can_delete":false,"product_type":"c1","uid":1101627,"ip_address":"","ucode":"827758EC99C34F","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/3b/679b518b.jpg","comment_is_top":false,"comment_ctime":1590996679,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590996679","product_id":100020901,"comment_content":"感觉文中nvcswch和man pidstat中的不太一样，所以提出一点疑惑。<br>文中”非自愿上下文切换，则是指进程由于时间片已到等原因，被系统强制调度，进而发生的上下文切换“，可是看man pidstat中讲nvcswch是指在进程的时间片内（没用完time silice）而被强制放弃处理器，Linux 2.4以前的o(n)调度是非抢占的，所以应该是没有nvcswch，Linux 2.4的O(1)和2.6以后的CFS调度都是抢占式的，所以应该有nvcswch。<br>man pidstat中的注释”A involuntary context switch takes place when a task executes for the duration of its time slice and then is forced to relinquish the processor. “","like_count":0},{"had_liked":false,"id":222047,"user_name":"Geek_76f04f","can_delete":false,"product_type":"c1","uid":2020720,"ip_address":"","ucode":"2A3D34C303E19A","user_header":"https://static001.geekbang.org/account/avatar/00/1e/d5/70/93a34aa5.jpg","comment_is_top":false,"comment_ctime":1590663338,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1590663338","product_id":100020901,"comment_content":"老师您好，最近在看您的课程，有一个问题我想请问一下。就是多线程服务端程序，如果用线程池，先开辟cpu核数的线程，那这些线程需要绑定到每个核吗？相比于不绑定，性能会有提高吗？盼老师回答。","like_count":0,"discussions":[{"author":{"id":1227011,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b9/03/f09b1275.jpg","nickname":"鱼饼专业运维","note":"","ucode":"CCC577541F1722","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":319239,"discussion_content":"会减少资源的损耗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603969022,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":216843,"user_name":"阿飞","can_delete":false,"product_type":"c1","uid":1298046,"ip_address":"","ucode":"F8B1FC8521264D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKZicicibGibtR5zAia782Ajc5I5BN3F3tjAdlibATIknHv67gbxeH21N7B6vbgwLjYb1miaLKhqicptB5ibYw/132","comment_is_top":false,"comment_ctime":1589354063,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589354063","product_id":100020901,"comment_content":"老师你好，这句话不是很理解：不可中断睡眠状态的进程，进程和中断有什么关联吗","like_count":0},{"had_liked":false,"id":212921,"user_name":"一个路过的菜鸟","can_delete":false,"product_type":"c1","uid":1955176,"ip_address":"","ucode":"EC034161202E1E","user_header":"","comment_is_top":false,"comment_ctime":1588238511,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588238511","product_id":100020901,"comment_content":"这个错怎么处理？，进行不下去了。<br>root@DESKTOP-OVMF6FV:&#47;proc# vmstat<br>procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----<br> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st<br>Error: &#47;proc must be mounted<br>  To mount &#47;proc at boot you need an &#47;etc&#47;fstab line like:<br>      proc   &#47;proc   proc    defaults<br>  In the meantime, run &quot;mount proc &#47;proc -t proc&quot;","like_count":0},{"had_liked":false,"id":211737,"user_name":"ray","can_delete":false,"product_type":"c1","uid":1717235,"ip_address":"","ucode":"10962C711CBC11","user_header":"","comment_is_top":false,"comment_ctime":1587999917,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587999917","product_id":100020901,"comment_content":"老师您好，请问<br>1. watch指令会截断部份输出，请问这问题有办法解决吗？<br>2. 我观察中断状况res并不会一直快速变化，有可能是什么原因呢？<br><br>谢谢老师的解答^^","like_count":0},{"had_liked":false,"id":209306,"user_name":"小伟","can_delete":false,"product_type":"c1","uid":1043401,"ip_address":"","ucode":"B631E56A112BDC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/eb/c9/b1b233cf.jpg","comment_is_top":false,"comment_ctime":1587532620,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"1587532620","product_id":100020901,"comment_content":"观察一段时间，你可以发现，变化速度最快的是重调度中断（RES）<br><br>这个并没有观察到，其他人也有这个问题吗？","like_count":0,"discussions":[{"author":{"id":1013093,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/75/65/2a7f8212.jpg","nickname":"小明","note":"","ucode":"31A24C60B4CC5B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":246940,"discussion_content":"用 watch -d &#39;cat /proc/interrupts | sort -nr -k 2 &#39;  这个命令能看到","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587788435,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1882184,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKrQa8ICRkaiblQlRU1iaiaoRkFdJB82E3sQC4FmXTcHTtMU1l58OXd0A2rwN7UkOQ6eh7J5sChVmdibA/132","nickname":"niithxl","note":"","ucode":"9AC42066FDD358","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1013093,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/75/65/2a7f8212.jpg","nickname":"小明","note":"","ucode":"31A24C60B4CC5B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":345558,"discussion_content":"我用这个命令可以，感谢哈，我可是翻了好久的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611741327,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":246940,"ip_address":""},"score":345558,"extra":""}]},{"author":{"id":1013093,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/75/65/2a7f8212.jpg","nickname":"小明","note":"","ucode":"31A24C60B4CC5B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":246939,"discussion_content":"的确没有观察到 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587788061,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":208750,"user_name":"扩散性百万咸面包","can_delete":false,"product_type":"c1","uid":1905171,"ip_address":"","ucode":"6D703D51553B42","user_header":"https://static001.geekbang.org/account/avatar/00/1d/12/13/e103a6e3.jpg","comment_is_top":false,"comment_ctime":1587432382,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587432382","product_id":100020901,"comment_content":"老师可以考虑开个操作系统的课。刘超老师的主要讲内核源码去了，您可以讲讲实操。很多人感兴趣的。","like_count":0},{"had_liked":false,"id":204302,"user_name":"墨田","can_delete":false,"product_type":"c1","uid":1194703,"ip_address":"","ucode":"A1BEAF01A0F5F5","user_header":"https://static001.geekbang.org/account/avatar/00/12/3a/cf/30510276.jpg","comment_is_top":false,"comment_ctime":1586361470,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1586361470","product_id":100020901,"comment_content":"进程上下文切换几万，很多都是非自愿的切换，但是看cpu使用率很低。这个接下来要怎么看看呢","like_count":0,"discussions":[{"author":{"id":1487584,"avatar":"https://static001.geekbang.org/account/avatar/00/16/b2/e0/d856f5a4.jpg","nickname":"鱼","note":"","ucode":"89EC9CE3AD0281","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372519,"discussion_content":"提高进程的优先级试试呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620363283,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":200054,"user_name":"痞子胥","can_delete":false,"product_type":"c1","uid":1617678,"ip_address":"","ucode":"3701A981FFF083","user_header":"","comment_is_top":false,"comment_ctime":1585537312,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585537312","product_id":100020901,"comment_content":"Local timer interrupts  系统定时器 中断频繁 要怎么处理啊？","like_count":0},{"had_liked":false,"id":194911,"user_name":"Lucky","can_delete":false,"product_type":"c1","uid":1246761,"ip_address":"","ucode":"AA2E16A8493388","user_header":"https://static001.geekbang.org/account/avatar/00/13/06/29/d61b1339.jpg","comment_is_top":false,"comment_ctime":1585119868,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585119868","product_id":100020901,"comment_content":"排查问题的方法论和思考逻辑很重要","like_count":0},{"had_liked":false,"id":193801,"user_name":"hellojd_gk","can_delete":false,"product_type":"c1","uid":1679543,"ip_address":"","ucode":"319AF4C1AD568D","user_header":"https://static001.geekbang.org/account/avatar/00/19/a0/b7/1327ae60.jpg","comment_is_top":false,"comment_ctime":1584967517,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584967517","product_id":100020901,"comment_content":"文中说的【这里的中断升高还是因为过多任务的调度问题】，感觉还没有完全说明，是由于资源问题导致自愿中断？，还是CPU争抢导致的非自愿上下文切换。<br><br>麻烦老师，给解释下 RES 代表的含义。","like_count":0},{"had_liked":false,"id":192458,"user_name":"自渡。","can_delete":false,"product_type":"c1","uid":1907278,"ip_address":"","ucode":"3E3EB3DE28CC46","user_header":"https://static001.geekbang.org/account/avatar/00/1d/1a/4e/a946ca99.jpg","comment_is_top":false,"comment_ctime":1584852443,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584852443","product_id":100020901,"comment_content":"棒","like_count":0},{"had_liked":false,"id":191583,"user_name":"喻茂","can_delete":false,"product_type":"c1","uid":1318661,"ip_address":"","ucode":"C8BD8086A17365","user_header":"https://static001.geekbang.org/account/avatar/00/14/1f/05/8a06692e.jpg","comment_is_top":false,"comment_ctime":1584783190,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584783190","product_id":100020901,"comment_content":".&#47;autogen.sh<br>.&#47;configure ＃.&#47;configure --without-mysql（不编译测试mysql的功能模块）<br>make  编译了6个多小时还没有完，是不是有问题？","like_count":0},{"had_liked":false,"id":180707,"user_name":"宋胖胖","can_delete":false,"product_type":"c1","uid":1857496,"ip_address":"","ucode":"AA828F49CCEABA","user_header":"https://static001.geekbang.org/account/avatar/00/1c/57/d8/e9c8b923.jpg","comment_is_top":false,"comment_ctime":1582368742,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582368742","product_id":100020901,"comment_content":"老师请教个问题：<br>我的系统是centos6.5  已经安装了mysql 5.6。   在安装sysbench时安装个依赖包mysql-libs5.1  和现有的mysql5.6冲突了，怎么解决啊？","like_count":0},{"had_liked":false,"id":172864,"user_name":"Jaime","can_delete":false,"product_type":"c1","uid":1078333,"ip_address":"","ucode":"904192CC4E916F","user_header":"https://static001.geekbang.org/account/avatar/00/10/74/3d/54bbc1df.jpg","comment_is_top":false,"comment_ctime":1579340277,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1579340277","product_id":100020901,"comment_content":"先通过htop查看cpu使用率，看到哪个进程占用的cpu比较多，然后在看vmstat.看到上下午切换的次数很高，在通过pidstat查看是不是sys bench引起的，最后在看看&#47;proc&#47;interrupts 看看是什么中断引起的，最后确认是上下文切换过多引起的性能问题","like_count":0},{"had_liked":false,"id":171640,"user_name":"ccz 开发(谢不邀)","can_delete":false,"product_type":"c1","uid":1805809,"ip_address":"","ucode":"B8803B050AAC68","user_header":"","comment_is_top":false,"comment_ctime":1578985089,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578985089","product_id":100020901,"comment_content":"“重调度中断（RES），这个中断类型表示，唤醒空闲状态的 CPU 来调度新的任务运行”老师，这里哪还有空闲状态的CPU","like_count":0},{"had_liked":false,"id":170906,"user_name":"笑","can_delete":false,"product_type":"c1","uid":1741098,"ip_address":"","ucode":"689A435818403A","user_header":"https://static001.geekbang.org/account/avatar/00/1a/91/2a/c0fb21fa.jpg","comment_is_top":false,"comment_ctime":1578754676,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578754676","product_id":100020901,"comment_content":"打卡，Day 3，查看上下文切换和中断的命令有vmstat, pidstat -wt -u, &#47;proc&#47;interrupts文件。自愿上下文切换和非自愿上下文切换。","like_count":0},{"had_liked":false,"id":170239,"user_name":"刘友淙","can_delete":false,"product_type":"c1","uid":1620058,"ip_address":"","ucode":"97F3A69A308313","user_header":"","comment_is_top":false,"comment_ctime":1578555462,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578555462","product_id":100020901,"comment_content":"D4 打卡","like_count":0},{"had_liked":false,"id":166695,"user_name":"小名叫大明","can_delete":false,"product_type":"c1","uid":1129317,"ip_address":"","ucode":"4804D68A396B40","user_header":"https://static001.geekbang.org/account/avatar/00/11/3b/65/203298ce.jpg","comment_is_top":false,"comment_ctime":1577546434,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577546434","product_id":100020901,"comment_content":"学习了，感谢大佬，回去必须要练习，总结一下。","like_count":0},{"had_liked":false,"id":162262,"user_name":"刘波","can_delete":false,"product_type":"c1","uid":1160330,"ip_address":"","ucode":"AF3579B1B6A4E7","user_header":"https://static001.geekbang.org/account/avatar/00/11/b4/8a/94fc896e.jpg","comment_is_top":false,"comment_ctime":1576488856,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1576488856","product_id":100020901,"comment_content":"看到了RES，但是发现RES 为0 而且一直不变。 倒是 LOC  IWI 一直在增长。<br>操作系统为 CentOS Linux release 7.0.1406 (Core)  3.10.0-123.8.1.el7.x86_64  云主机","like_count":0},{"had_liked":false,"id":150925,"user_name":"88591","can_delete":false,"product_type":"c1","uid":1254656,"ip_address":"","ucode":"04CE3E46455185","user_header":"https://static001.geekbang.org/account/avatar/00/13/25/00/3afbab43.jpg","comment_is_top":false,"comment_ctime":1573629269,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573629269","product_id":100020901,"comment_content":"1、用uptime 看到系统负载明显有升高<br>2、使用pidstat 看到进程 sysbench cpu 占用很高，但是wait 的数字偏高。可能是io 等待，或者等待调度 <br>3、使用vmstat 看到上下文切换次数明显升高。  那么sysbench 应该是等待被调度。线程的数量设置的太多了。应该为cpu 密集型任务。应该降低线程数量。<br>4、因为我是4核cpu ，将线程数量调整为4。wait 的时间变短了，上下文切换次数明显减少。cpu 在用户和内核空间的利用率也明显升高。 ","like_count":0},{"had_liked":false,"id":145628,"user_name":"sky","can_delete":false,"product_type":"c1","uid":1058101,"ip_address":"","ucode":"931131DC4EB710","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/YejEftrfCKosbfmDLm8bqMZs9yaaAt8MOmfo9e7nIrx1BK2SbEhL3HeFPibMIxuHp17WXjndia6IDDfhB6GJfmUQ/132","comment_is_top":false,"comment_ctime":1572334273,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572334273","product_id":100020901,"comment_content":"watch -d cat &#47;proc&#47;interrupts  这个结果列表太长  ，显示在前面都是0 没有变化，怎么看到全部或有变化？？","like_count":0},{"had_liked":false,"id":144701,"user_name":"黄展志","can_delete":false,"product_type":"c1","uid":1356083,"ip_address":"","ucode":"EBA342CD89072D","user_header":"https://static001.geekbang.org/account/avatar/00/14/b1/33/8993eae0.jpg","comment_is_top":false,"comment_ctime":1572000927,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572000927","product_id":100020901,"comment_content":"倪老师，写的命令<br>sysbench --threads=10 --max-time=300  threads run<br>貌似问题<br>我用的版本是sysbench-0.4.12<br>如下用法：<br><br>sysbench --num-threads=10 --max-time=300  --test=threads run<br>","like_count":0},{"had_liked":false,"id":141712,"user_name":"Geek_32a1cf","can_delete":false,"product_type":"c1","uid":1203854,"ip_address":"","ucode":"319DDD9BAB6772","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ajNVdqHZLLDC4cj2XKjHPNdOiaZR6oxeO36umdW8cnuW0YfyKCfpia883ib4RheBicuL2TPhMY14HQ7e7Dl4Zvhd8w/132","comment_is_top":false,"comment_ctime":1571214362,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571214362","product_id":100020901,"comment_content":"老师，咨询个问题：操作系统是centos系统，当执行sysbench命令时，监控中断类型时，watch -d cat &#47;proc&#47;interrupts，为什么显示RES的值为0呢，LOC、IWI这两个中断在不断的变化","like_count":0},{"had_liked":false,"id":139344,"user_name":"Geek_ff315c","can_delete":false,"product_type":"c1","uid":1647182,"ip_address":"","ucode":"DFB3C651DC062C","user_header":"","comment_is_top":false,"comment_ctime":1570616235,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570616235","product_id":100020901,"comment_content":"老师你好，那个重调度中断上面给出的解释是调度空闲的cpu，可是现在队列都已经大于CPU个数，还会有空闲的么","like_count":0},{"had_liked":false,"id":131151,"user_name":"czkk","can_delete":false,"product_type":"c1","uid":1516278,"ip_address":"","ucode":"56EE189CD243C7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/5TeftklBIoiaslVT9uNqz1aiasOamDZOlawaaicfEibRloiamLVQpg7o3EmlxY0ALAJwA0SUkRYp0PO3mExibokmpgEQ/132","comment_is_top":false,"comment_ctime":1567653225,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567653225","product_id":100020901,"comment_content":"RES被占用的数值大概到多少才算是到中断处理程序的瓶颈呢，有一个具体的数值瓶颈吗？","like_count":0},{"had_liked":false,"id":130530,"user_name":"liuy","can_delete":false,"product_type":"c1","uid":1643287,"ip_address":"","ucode":"F5863E5613058A","user_header":"https://static001.geekbang.org/account/avatar/00/19/13/17/93f954d3.jpg","comment_is_top":false,"comment_ctime":1567479663,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567479663","product_id":100020901,"comment_content":"按照这节课的试了试，但是我们环境docker,好像会受到影响..vmstat看上下文切换一直是2万多，通过pidstat只看我运行的进程 ，自愿切换上下文的占高，统计下来有8000多。 ","like_count":0},{"had_liked":false,"id":126118,"user_name":"饭粒","can_delete":false,"product_type":"c1","uid":1153455,"ip_address":"","ucode":"4C3220B0D43997","user_header":"https://static001.geekbang.org/account/avatar/00/11/99/af/d29273e2.jpg","comment_is_top":false,"comment_ctime":1566315743,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566315743","product_id":100020901,"comment_content":"环境是 2*CPU 4GB CentOS Linux release 7.4.1708 (Core) 虚拟机<br>案例模拟中，用 watch -d cat &#47;proc&#47;interrupts 最多、变化最快的中断不是 Rescheduling interrupts 而是 Local timer interrupts。<br>LOC:    2559728    2673902   Local timer interrupts<br>RES:     396887     416796   Rescheduling interrupts","like_count":0},{"had_liked":false,"id":124301,"user_name":"丁小疯","can_delete":false,"product_type":"c1","uid":1631373,"ip_address":"","ucode":"8FD320587FB63C","user_header":"https://static001.geekbang.org/account/avatar/00/18/e4/8d/1c49755d.jpg","comment_is_top":false,"comment_ctime":1565856106,"is_pvip":false,"replies":[{"id":"45968","content":"请参考后续的套路篇和网络篇，有讲到各种类型CPU高以及网络性能的分析思路","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1566133099,"ip_address":"","comment_id":124301,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1565856106","product_id":100020901,"comment_content":"如果已经看到系统cpu有软中断30%，sys占用30%、cs在1000左右，in在11000左右，cpu占用的进程是nginx，in的原因是IO-APIC-fasteoi，如何解决呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463106,"discussion_content":"请参考后续的套路篇和网络篇，有讲到各种类型CPU高以及网络性能的分析思路","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566133099,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118320,"user_name":"Geek_87338d","can_delete":false,"product_type":"c1","uid":1617390,"ip_address":"","ucode":"591122E793E9D0","user_header":"","comment_is_top":false,"comment_ctime":1564320477,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564320477","product_id":100020901,"comment_content":"有一个问题没搞懂<br>用stress -c 8，context switch并没有提升那么多，us 100<br>用sysbench --threads=8，context switch变为280w+，us 13，sy 86<br>我理解即使stress是利用进程来压，进程切换也要占用sy，为什么会有这么大的差异？两个工具的原理不一样吗？","like_count":0},{"had_liked":false,"id":107707,"user_name":"董尚斌","can_delete":false,"product_type":"c1","uid":1195545,"ip_address":"","ucode":"9582217F65C1C7","user_header":"https://static001.geekbang.org/account/avatar/00/12/3e/19/873abe8a.jpg","comment_is_top":false,"comment_ctime":1561598287,"is_pvip":false,"replies":[{"id":"39659","content":"案例中压测是非自愿上下文切换高，不过实际应用具体哪个高还要看应用自身的类型。比如，有的的应用可能会需要大量IO，压测的时间IO就是最主要的性能因素","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1562061035,"ip_address":"","comment_id":107707,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561598287","product_id":100020901,"comment_content":"所谓自愿上下文切换，是指进程无法获取所需资源，导致的上下文切换。比如说， I&#47;O、内存等系统资源不足时，就会发生自愿上下文切换。<br><br>而非自愿上下文切换，则是指进程由于时间片已到等原因，被系统强制调度，进而发生的上下文切换。比如说，大量进程都在争抢 CPU 时，就容易发生非自愿上下文切换。<br><br>所以在压测的情况下，不应该是非自愿上下文升高吗？表明很多线程和进程争抢CPU。而不是由于资源不足导致的切换。<br><br>老师这里不是很懂。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455633,"discussion_content":"案例中压测是非自愿上下文切换高，不过实际应用具体哪个高还要看应用自身的类型。比如，有的的应用可能会需要大量IO，压测的时间IO就是最主要的性能因素","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562061035,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104840,"user_name":"山鷹·China","can_delete":false,"product_type":"c1","uid":1146178,"ip_address":"","ucode":"1A13AAC813C1C8","user_header":"https://static001.geekbang.org/account/avatar/00/11/7d/42/c324a7de.jpg","comment_is_top":false,"comment_ctime":1560851724,"is_pvip":false,"replies":[{"id":"38372","content":"对的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1561215557,"ip_address":"","comment_id":104840,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560851724","product_id":100020901,"comment_content":"老湿！！vmstat 查看的cs值与pidstat -wt查看到的值有什么关系呀？我分析pidstat是单个进程里面所有的上下文切换。vmstat是系统全局的上下文切换。老师指正一下！！<br><br>sysbench --test=threads --num-threads=10 --max-time=300 run<br>测试数据<br>$ vmstat -w 3<br> procs -----------------------memory---------------------- ---swap-- -----io---- -system-- --------cpu--------<br> r  b         swpd         free         buff        cache   si   so    bi    bo   in   cs  us  sy  id  wa  st<br> ......<br> 1  0        94364       225356       258912      1526864    0    0     0     0  241  375   0   0  99   0   0<br> 0  0        94364       223364       258912      1526916    0    0     0   128  285  855   0   1  99   0   0<br> 0  0        94364       223364       258912      1526924    0    0     0     0  250  407   0   1  99   0   0<br> 7  0        94364       222860       258912      1526932    0    0     0    20 4775 1586429  10  56  34   0   0<br> 0  0        94364       224364       258912      1526940    0    0     0    17 6779 1886799  11  69  19   0   0<br> ......<br><br>$ pidstat -wt 3<br>Average:      UID      TGID       TID   cswch&#47;s nvcswch&#47;s  Command<br>......<br>Average:        0     20562         -      2.50      0.00  kworker&#47;u256:1<br>Average:        0         -     20562      2.50      0.00  |__kworker&#47;u256:1<br>Average:     1000         -     20606      0.33    105.58  |__pidstat<br>Average:     1000     20607         -      0.08      0.00  sysbench<br>Average:     1000         -     20607      0.08      0.00  |__sysbench<br>Average:     1000         -     20609  12809.66  63959.87  |__sysbench<br>Average:     1000         -     20610  11885.43  66376.77  |__sysbench<br>Average:     1000         -     20612  13801.75  63928.98  |__sysbench<br>Average:     1000         -     20613  13788.01  63087.76  |__sysbench<br>Average:     1000         -     20615  13319.65  64901.58  |__sysbench<br>Average:     1000         -     20616  12542.88  63434.80  |__sysbench<br>Average:     1000         -     20617  13894.34  65904.66  |__sysbench<br>......","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454448,"discussion_content":"对的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561215557,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":102902,"user_name":"Butter Fly","can_delete":false,"product_type":"c1","uid":1564473,"ip_address":"","ucode":"D2B488B465FC3C","user_header":"https://static001.geekbang.org/account/avatar/00/17/df/39/6ead11bc.jpg","comment_is_top":false,"comment_ctime":1560325460,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560325460","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":102801,"user_name":"设置昵称","can_delete":false,"product_type":"c1","uid":1504058,"ip_address":"","ucode":"1FB53E126036EB","user_header":"https://static001.geekbang.org/account/avatar/00/16/f3/3a/63cf1d0e.jpg","comment_is_top":false,"comment_ctime":1560306557,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560306557","product_id":100020901,"comment_content":"命令解析<br>1.vmstate<br>通常用来分析系统的内存使用情况，CPU上下文切换，中断次数<br>2.pidstate<br>以进程为粒度来分析进程所使用系统资源的情况<br>3.uptime<br><br>实战<br>1. 首先多线程环境<br>sysbench --threads=10 --max-time=300 threads run<br>2. 偶然间输入uptime<br>发现最近一段时间系统负载变高了，说明cpu繁忙了，现在该咋办呢？<br>3. 输入top命令全局看一下<br>可以发现是哪个进程正在使用cpu<br>4. 现在应该分析一下到底是什么原因导致的<br>a) 看看是不是多进程多线程的问题<br>vmstate 1  # 看一下每秒cs（上下文切换次数），每秒in（每秒中断次数），发现次数太高了，可以确定是多进程多线程有一定影响，下面看看具体是哪一个造成的<br># 看一下各个进程cpu的使用情况<br>top<br>pidstat 1  # 显示每秒cpu的使用情况，每1秒刷新<br>mpstat -P ALL 1 #显示不同cpu上cpu的使用情况，每1秒刷新<br>pidstat -w # 显示进程的上下文切换次数<br>pidstat -wt  # 显示线程的上下文切换次数<br><br>到此，我们就能分析出是sysbench该进程中，存在太多的线程所导致的问题<br>","like_count":0},{"had_liked":false,"id":101181,"user_name":"任鹏斌","can_delete":false,"product_type":"c1","uid":1104086,"ip_address":"","ucode":"34319B05EA6E74","user_header":"https://static001.geekbang.org/account/avatar/00/10/d8/d6/47da34bf.jpg","comment_is_top":false,"comment_ctime":1559735693,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559735693","product_id":100020901,"comment_content":"挺好学习了，非常好懂","like_count":0},{"had_liked":false,"id":97072,"user_name":"筱の简單","can_delete":false,"product_type":"c1","uid":1539341,"ip_address":"","ucode":"B2E922D534A893","user_header":"https://static001.geekbang.org/account/avatar/00/17/7d/0d/c753174e.jpg","comment_is_top":false,"comment_ctime":1558580583,"is_pvip":false,"replies":[{"id":"34972","content":"是不是终端太小被截断了？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1558793888,"ip_address":"","comment_id":97072,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1558580583","product_id":100020901,"comment_content":"centos7系统，执行sysbetch后，watch -d cat &#47;proc&#47;interrupts并没有发现文中描述的RES(重调度中断指标)，直接使用cat &#47;proc&#47;interrupts 查看 是有RES的","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451125,"discussion_content":"是不是终端太小被截断了？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558793888,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":93409,"user_name":"衣申人","can_delete":false,"product_type":"c1","uid":1115777,"ip_address":"","ucode":"887FE9109B97DE","user_header":"https://static001.geekbang.org/account/avatar/00/11/06/81/28418795.jpg","comment_is_top":false,"comment_ctime":1557465287,"is_pvip":false,"replies":[{"id":"33534","content":"工具和思路都是一样的，唯一的不同是pidstat需要多加一个选项，把线程也显示出来（用法请查询man手册）","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1557671036,"ip_address":"","comment_id":93409,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1557465287","product_id":100020901,"comment_content":"老师，如果是多线程程序，怎么分析？你说的都是进程哦？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":449620,"discussion_content":"工具和思路都是一样的，唯一的不同是pidstat需要多加一个选项，把线程也显示出来（用法请查询man手册）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557671036,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91161,"user_name":"zklkycg2012","can_delete":false,"product_type":"c1","uid":1231779,"ip_address":"","ucode":"F1E22C88EC4033","user_header":"https://static001.geekbang.org/account/avatar/00/12/cb/a3/d1567b0b.jpg","comment_is_top":false,"comment_ctime":1556885105,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556885105","product_id":100020901,"comment_content":"打卡~","like_count":0},{"had_liked":false,"id":86248,"user_name":"manatee","can_delete":false,"product_type":"c1","uid":1041112,"ip_address":"","ucode":"708D90E7A265BD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e2/d8/f0562ede.jpg","comment_is_top":false,"comment_ctime":1555331610,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555331610","product_id":100020901,"comment_content":"老师您好，我在运行sysbench命令的时候非常奇怪，按照您的命令，只运行一秒就结束了，这个是怎么回事呢，系统是ubuntu 16.04 ,1c2g的配置，是否和系统资源太低有关呢","like_count":0},{"had_liked":false,"id":83533,"user_name":"星星.","can_delete":false,"product_type":"c1","uid":1223251,"ip_address":"","ucode":"A8A2C2762EF053","user_header":"https://static001.geekbang.org/account/avatar/00/12/aa/53/f55283cb.jpg","comment_is_top":false,"comment_ctime":1554642101,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554642101","product_id":100020901,"comment_content":"为什么pidstat查看的上下文切换次数不是整数？","like_count":0},{"had_liked":false,"id":82001,"user_name":"easy","can_delete":false,"product_type":"c1","uid":1077728,"ip_address":"","ucode":"10FEA3D65B2536","user_header":"https://static001.geekbang.org/account/avatar/00/10/71/e0/ebe7d07c.jpg","comment_is_top":false,"comment_ctime":1554100809,"is_pvip":false,"replies":[{"id":"29848","content":"两个角度，一个是CPU使用率，另一个I&#47;O，I&#47;O除了使用率还有很多其他指标（请参考I&#47;O模块）","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1554211018,"ip_address":"","comment_id":82001,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554100809","product_id":100020901,"comment_content":"老是您好，线上机器负载比较高，经查内存和cpu、io使用率较低，上下文切换次数也不高，还需从那些角度去排查一下？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445425,"discussion_content":"两个角度，一个是CPU使用率，另一个I/O，I/O除了使用率还有很多其他指标（请参考I/O模块）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554211018,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81217,"user_name":"胡萝卜","can_delete":false,"product_type":"c1","uid":1056926,"ip_address":"","ucode":"306139A86C182D","user_header":"https://static001.geekbang.org/account/avatar/00/10/20/9e/3278e1d8.jpg","comment_is_top":false,"comment_ctime":1553833006,"is_pvip":false,"replies":[{"id":"29585","content":"man vmstat查询","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1554003185,"ip_address":"","comment_id":81217,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553833006","product_id":100020901,"comment_content":"老师您好，请教 在多CPU机器上，vmstat 输出指标时，r cs us 显示的是多个CPU运行的平均值吗","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445121,"discussion_content":"man vmstat查询","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554003185,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":80176,"user_name":"强友谅","can_delete":false,"product_type":"c1","uid":1475358,"ip_address":"","ucode":"C13F01A12D72A0","user_header":"https://static001.geekbang.org/account/avatar/00/16/83/1e/bdc4f811.jpg","comment_is_top":false,"comment_ctime":1553613451,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553613451","product_id":100020901,"comment_content":"打卡，pidstat是个好东西","like_count":0},{"had_liked":false,"id":79250,"user_name":"frank_","can_delete":false,"product_type":"c1","uid":1452570,"ip_address":"","ucode":"658DBBC9BE337F","user_header":"","comment_is_top":false,"comment_ctime":1553416093,"is_pvip":false,"replies":[{"id":"29046","content":"可以输出到文件里面，或者使用 awk&#47;sed 稍微处理一下","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553526224,"ip_address":"","comment_id":79250,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553416093","product_id":100020901,"comment_content":"请教大家，通常我们生产环境里面用的服务器，大多都有几十颗CPU，信息太多<br>watch -d cat &#47;proc&#47;intetrrupts 这个命令不好用，只能看到一部分信息，有没有更好的方法呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444416,"discussion_content":"可以输出到文件里面，或者使用 awk/sed 稍微处理一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553526224,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79244,"user_name":"冬风向左吹","can_delete":false,"product_type":"c1","uid":1066928,"ip_address":"","ucode":"376C45C5134F93","user_header":"https://static001.geekbang.org/account/avatar/00/10/47/b0/a9b77a1e.jpg","comment_is_top":false,"comment_ctime":1553414671,"is_pvip":false,"replies":[{"id":"29049","content":"正常","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553526369,"ip_address":"","comment_id":79244,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553414671","product_id":100020901,"comment_content":"我们线上的一个java进程，约300多个线程，CPU上下文切换都在10000以上，java进程的cpu使用率在110%左右，但整个系统的CPU使用率不高，这算正常吗","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444414,"discussion_content":"正常","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553526369,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78491,"user_name":"codd_wang","can_delete":false,"product_type":"c1","uid":1466166,"ip_address":"","ucode":"6CA3D74110046A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoAR2a7LRukRwfqFEMlavwkwUm06jBUwBHtNib7dJbvVKl6O6y8arXhfnHKu4U8kJCYGsKgGwkagtg/132","comment_is_top":false,"comment_ctime":1553159165,"is_pvip":false,"replies":[{"id":"28754","content":"cs是CPU context switches","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553317452,"ip_address":"","comment_id":78491,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553159165","product_id":100020901,"comment_content":"请教倪老师，CPU上下文切换包括：进程，线程和中断；vmstat看到的cs（每秒上下文切换次数）不包括in（每秒中断次数）吧？那这个cs值是进程和线程切换次数？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444119,"discussion_content":"cs是CPU context switches","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553317452,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78218,"user_name":"冰凌","can_delete":false,"product_type":"c1","uid":1394578,"ip_address":"","ucode":"5C9EADFEDBF4E5","user_header":"https://static001.geekbang.org/account/avatar/00/15/47/92/f6a832c3.jpg","comment_is_top":false,"comment_ctime":1553094865,"is_pvip":false,"replies":[{"id":"28766","content":"嗯嗯，对的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553318569,"ip_address":"","comment_id":78218,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553094865","product_id":100020901,"comment_content":"下面这种情况，分析思路对么？<br><br>假设我现在有一台Linux服务器负载变高了，如何找到原因？如何排查分析<br>          Step1: 首先通过uptime看下最近一段时间的负载怎么样，能够得出是徒然变高还是变高已经有一段时间了，比较5min和15min系统负载的数据<br>           Step2: 分析系统负载高的原因有哪些？根据前面学习的，可能是计算密集型任务导致，IO密集型任务导致，还有可能是大量线程等待调度导致，还有可能是几种情况的组合同时存在。这里要怎么分析可以通过mpstat工具来区分，主要关注的几个指标是%idle %iowait %wait<br>           Step3: 如果通过上一步确认是大量线程等待调度导致，那么可以通过vmstat来查看系统整体的上下文切换情况，主要关注cs／in／r／b 四个指标<br>           Step4: 我们已经知道了系统负载高的原因，进一步通过pidstat 查看具体是那一个线程导致的详细原因","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444009,"discussion_content":"嗯嗯，对的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553318569,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":74866,"user_name":"Con2uS","can_delete":false,"product_type":"c1","uid":1410624,"ip_address":"","ucode":"23AD2E1E872A0F","user_header":"https://static001.geekbang.org/account/avatar/00/15/86/40/5a1ab807.jpg","comment_is_top":false,"comment_ctime":1552306738,"is_pvip":false,"replies":[{"id":"27344","content":"前面的 $ 符号要删掉","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1552350306,"ip_address":"","comment_id":74866,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1552306738","product_id":100020901,"comment_content":"您好老师，执行这段$ sysbench --threads=10 --ma-time=300 threads run命令，系统报找不到$: command not found<br>============================<br>但是我之前已经安装了sysbench，请问是啥原因呢？<br><br>Reading package lists... Done<br>Building dependency tree       <br>Reading state information... Done<br>sysbench is already the newest version (0.4.12-1.1ubuntu1).<br>sysstat is already the newest version (11.2.0-1ubuntu0.2).","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442713,"discussion_content":"前面的 $ 符号要删掉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552350306,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":73987,"user_name":"Linking...","can_delete":false,"product_type":"c1","uid":1450875,"ip_address":"","ucode":"A979AD4397979E","user_header":"https://static001.geekbang.org/account/avatar/00/16/23/7b/077ff260.jpg","comment_is_top":false,"comment_ctime":1552054242,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552054242","product_id":100020901,"comment_content":"mark 回头用这章知识去分析下我们运算集群的机器上到底是IO资源导致的自愿上下文切换多还是非自愿上下文切换多。如果是自愿上下文切换多 可能是由于网络IO瓶颈 也就是数据拉取速度造成的问题。","like_count":0},{"had_liked":false,"id":72079,"user_name":"光","can_delete":false,"product_type":"c1","uid":1284618,"ip_address":"","ucode":"BDA7F41566E4FE","user_header":"https://static001.geekbang.org/account/avatar/00/13/9a/0a/6c74e932.jpg","comment_is_top":false,"comment_ctime":1551516007,"is_pvip":true,"replies":[{"id":"26324","content":"嗯，后面文章中有介绍的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551705384,"ip_address":"","comment_id":72079,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551516007","product_id":100020901,"comment_content":"问下，分析中以及工作中经常看到kworker 这样的进程，查了资料说的不是很清楚，能稍微解释下么。谢谢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441451,"discussion_content":"嗯，后面文章中有介绍的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551705384,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":71772,"user_name":"小豹子","can_delete":false,"product_type":"c1","uid":1346267,"ip_address":"","ucode":"972F3E6BF0FDEA","user_header":"https://static001.geekbang.org/account/avatar/00/14/8a/db/76ab84c6.jpg","comment_is_top":false,"comment_ctime":1551429774,"is_pvip":false,"replies":[{"id":"26321","content":"中断是计算机处理硬件请求的一种方式，中断的来源是硬件。比如网卡收到一个外部发送过来的网络帧，就会产生一个中断信号，通知内核收到了新的网络帧。然后，内核才会通过中断处理程序来读取并处理。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551705205,"ip_address":"","comment_id":71772,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1551429774","product_id":100020901,"comment_content":"倪老师，我对这个&quot;中断&quot;的概念反反复复看也没弄明白。什么时候出现的中断？是不是该进程的时间片到了，被系统中断了。那这个跟非自愿上下文切换有什么分别。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441323,"discussion_content":"中断是计算机处理硬件请求的一种方式，中断的来源是硬件。比如网卡收到一个外部发送过来的网络帧，就会产生一个中断信号，通知内核收到了新的网络帧。然后，内核才会通过中断处理程序来读取并处理。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551705205,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1015256,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/d8/d7c77764.jpg","nickname":"HunterYuan","note":"","ucode":"F8900C33D29AA7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":158888,"discussion_content":"重调度中断（RES）,这个中断也是硬件产生的吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580635809,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70679,"user_name":"Maxwell","can_delete":false,"product_type":"c1","uid":1086275,"ip_address":"","ucode":"720A00AD472616","user_header":"https://static001.geekbang.org/account/avatar/00/10/93/43/0e84492d.jpg","comment_is_top":false,"comment_ctime":1551162021,"is_pvip":false,"replies":[{"id":"25706","content":"嗯","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551399055,"ip_address":"","comment_id":70679,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551162021","product_id":100020901,"comment_content":"上下文切换次数过高，是不是会导致系统CPU使用率高","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440766,"discussion_content":"嗯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551399055,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70367,"user_name":"小花","can_delete":false,"product_type":"c1","uid":1401483,"ip_address":"","ucode":"BFF0A1A59FD35D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/umxqic2CHGySYhT47Rz03ePCloIZ7X21dCLZMVo82m2gjhJdJVqYt3AOdZUXg1roTNSRibkj2g5eia76cbFdxjliag/132","comment_is_top":false,"comment_ctime":1551086483,"is_pvip":false,"replies":[{"id":"25357","content":"正常","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551195099,"ip_address":"","comment_id":70367,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551086483","product_id":100020901,"comment_content":"procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu-----<br> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st<br> 6  0      0  10995     75   2385    0    0     0     0 33136 19122 61  4 35  0  0<br> 7  0      0  10995     75   2385    0    0     0     0 31730 18253 63  3 34  0  0<br> 8  0      0  10995     75   2385    0    0     0     0 28670 16343 69  3 28  0  0<br> 8  0      0  10996     75   2385    0    0     0     0 29385 16904 70  4 26  0  0<br> 7  0      0  10995     75   2385    0    0     0    64 29725 17317 66  5 30  0  0<br> 8  0      0  10995     75   2385    0    0     0    16 12890 7361 92  2  6  0  0<br> 7  0      0  10994     75   2385    0    0     0     0 27283 15710 69  4 26  0  0<br> 7  0      0  10995     75   2385    0    0     0     0 30240 17268 67  4 29  0  0<br>我这个 java web程序， 8核逻辑CPU，在访问某个页面的时候，in 3万多，cs2万左右，这个页面访问结束以后，又降下去了<br><br>procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu-----<br> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st<br> 4  0      0  10985     75   2392    0    0     0     0 17771 9890 42  2 56  0  0<br> 3  0      0  10986     75   2392    0    0     0     0 20381 13209 35  1 64  0  0<br> 3  0      0  10985     75   2392    0    0     0     0 21625 12078 22  1 77  0  0<br> 8  0      0  10985     75   2392    0    0     0   112 20176 10950 23  1 76  0  0<br> 1  0      0  10986     75   2392    0    0     0     0 17241 10588 36  1 63  0  0<br> 1  0      0  10986     75   2392    0    0     0     0 9628 5158 18  1 81  0  0<br> 1  0      0  10985     75   2392    0    0     0    16 11071 7011 16  1 83  0  0<br> 1  0      0  10985     75   2392    0    0     0     0 5924 3311 17  1 83  0  0<br><br>不知道这个正常么。。<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440588,"discussion_content":"正常","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551195099,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69404,"user_name":"平安喜乐","can_delete":false,"product_type":"c1","uid":1102350,"ip_address":"","ucode":"B97D8944B0B035","user_header":"https://static001.geekbang.org/account/avatar/00/10/d2/0e/26bf35a4.jpg","comment_is_top":false,"comment_ctime":1550735962,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1550735962","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":69029,"user_name":"机智的胖纸","can_delete":false,"product_type":"c1","uid":1430568,"ip_address":"","ucode":"0EEBC02FF9EB06","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK6yJ7MdMSUEuhaIFJ1VibttXlbrnqib1ubb5vOVC4V0XuoTP6qGpPmhA7p1fAeJ1Rm6ciayOUMc7xCA/132","comment_is_top":false,"comment_ctime":1550648391,"is_pvip":false,"replies":[{"id":"24532","content":"4万不算大，要看趋势，有数量级增长的时候才需要分析","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550674773,"ip_address":"","comment_id":69029,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550648391","product_id":100020901,"comment_content":"问下 我这边中断很高 有四万左右  具体中断类型有如下几个:1.Local timer interrupts 2,RES 不知道这如何排查","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439923,"discussion_content":"4万不算大，要看趋势，有数量级增长的时候才需要分析","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550674773,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68636,"user_name":"机智的胖纸","can_delete":false,"product_type":"c1","uid":1430568,"ip_address":"","ucode":"0EEBC02FF9EB06","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK6yJ7MdMSUEuhaIFJ1VibttXlbrnqib1ubb5vOVC4V0XuoTP6qGpPmhA7p1fAeJ1Rm6ciayOUMc7xCA/132","comment_is_top":false,"comment_ctime":1550563637,"is_pvip":false,"replies":[{"id":"24380","content":"中断高也有可能是正常的，还要找出中断类型，看看是不是预期的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550570579,"ip_address":"","comment_id":68636,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550563637","product_id":100020901,"comment_content":"中断的切换太多 将近有4万 我看proc inter*里面的 cpu变化都很大 不知道如何排查呢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439769,"discussion_content":"中断高也有可能是正常的，还要找出中断类型，看看是不是预期的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550570579,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":59455,"user_name":"董启富","can_delete":false,"product_type":"c1","uid":1261080,"ip_address":"","ucode":"CD8D2E9EC695C4","user_header":"https://static001.geekbang.org/account/avatar/00/13/3e/18/41d88fab.jpg","comment_is_top":false,"comment_ctime":1547371986,"is_pvip":false,"replies":[{"id":"21516","content":"TASKLET是内核中的机制，从应用程序角度没法调整。<br><br>从性能角度来看，绝对的中断次数和上下文切换次数意义不大，而是要确认是有什么样的性能瓶颈。比如是网络延迟大、吞吐小还是CPU处理慢？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1547447528,"ip_address":"","comment_id":59455,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547371986","product_id":100020901,"comment_content":"老师您好，<br>如下我的一个测试环境中 vmstat 5 的数目。<br>这个环境的基本情况是：硬件是一个 32核的服务器，在上面只创建了一个VMWare 虚拟机，操作系统是 CentOS 7.3，而且虚拟机本身分配了 32 个核。<br># vmstat 5<br>procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----<br> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st<br>22  0      0 2443320 478972 24910664    0    0     1    81    5    4 11 12 77  0  0<br>23  0      0 2416304 478972 24925276    0    0     0  7773 195936 333869 26 21 53  0  0<br>22  0      0 2416404 478972 24921072    0    0     0  6907 194218 328692 26 23 51  0  0<br>16  0      0 2407880 478972 24912072    0    0     0 12558 196727 336617 26 23 51  0  0<br>20  0      0 4684464 478972 26460620    0    0     0 57650 173601 306627 20 21 58  1  0<br>14  2      0 4072196 478972 27016744    0    0     0 92974 183439 319716 20 20 57  4  0<br><br>从上面的输出，我的分析是：<br>1）处于可运行状态的进程数目在23及以下，说明总体而言系统的load不高<br>2）中断(in)达到 190k以上，并且上下文切换(cs)达到 330k&#47;s, 说明，因为中断导致频繁的上下文切换。应该检查中断。<br>3）检查系统的软中断，合计的中断数目和平均数目如下：<br>Type\tTotal\tAverage<br>HI:\t0\t0<br>TIMER:\t2518204945\t78693905<br>NET_TX:\t129439\t4045<br>NET_RX:\t6769136176\t211535506<br>BLOCK:\t2659530\t83110<br>BLOCK_IOPOLL:\t0\t0<br>TASKLET:\t207533812\t6485432<br>SCHED:\t205349449\t6417170<br>HRTIMER:\t0\t0<br>RCU:\t1346323862\t42072621<br><br>可以看出 NET_TX， NET_RX, BLOCK 的中断数目比较大，我在服务器上抓了6s左右的tcpdump，合计抓到195994个包，平均包的大小是 670B，请教一下，这样的包算不算小包？程序本身确实在不停地接收来自客户端的数据包，下面具体朝哪个方向做调整来降低中断和上下文切换次数？<br>另外，从软中断输出可以看到 TASKLET 只运行在 9 个CPU上，且平均值为6485432。系统有32个CPU，TASKLET 不能跨CPU。对于TASKLET输出，这个值正常吗？有没有好的替代方案？<br><br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436339,"discussion_content":"TASKLET是内核中的机制，从应用程序角度没法调整。\n\n从性能角度来看，绝对的中断次数和上下文切换次数意义不大，而是要确认是有什么样的性能瓶颈。比如是网络延迟大、吞吐小还是CPU处理慢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547447528,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55531,"user_name":"Spring","can_delete":false,"product_type":"c1","uid":1007267,"ip_address":"","ucode":"80594B4B056A53","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5e/a3/9670d4b4.jpg","comment_is_top":false,"comment_ctime":1546224722,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546224722","product_id":100020901,"comment_content":"不考虑多核心的情况下，是不是可以理解开源组件中多进程和多线程模型考虑是基于实现复杂性方面的考虑，而不仅仅是执行效率吗？","like_count":0},{"had_liked":false,"id":54999,"user_name":"花开蝶自来","can_delete":false,"product_type":"c1","uid":1358144,"ip_address":"","ucode":"767D55E7A82975","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKibu8C3CeYGF6JCBribiaEPia5gibaQnj9icryPVwoF6ibosmdicXJIhBEUdn0aDwZQ32oTyJL86DgDswhAg/132","comment_is_top":false,"comment_ctime":1545997843,"is_pvip":false,"replies":[{"id":"19909","content":"嗯嗯 多查文档","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546000081,"ip_address":"","comment_id":54999,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545997843","product_id":100020901,"comment_content":"D2打卡，<br>不是非常懂一些指标的含义，得查查~","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434645,"discussion_content":"嗯嗯 多查文档","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546000081,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54978,"user_name":"孙成子","can_delete":false,"product_type":"c1","uid":1317819,"ip_address":"","ucode":"7DF58E9202FC60","user_header":"https://static001.geekbang.org/account/avatar/00/14/1b/bb/4a749b6c.jpg","comment_is_top":false,"comment_ctime":1545990912,"is_pvip":false,"replies":[{"id":"19912","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546001667,"ip_address":"","comment_id":54978,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545990912","product_id":100020901,"comment_content":"D4","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434638,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546001667,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54469,"user_name":"Maxwell","can_delete":false,"product_type":"c1","uid":1086275,"ip_address":"","ucode":"720A00AD472616","user_header":"https://static001.geekbang.org/account/avatar/00/10/93/43/0e84492d.jpg","comment_is_top":false,"comment_ctime":1545877131,"is_pvip":false,"replies":[{"id":"19955","content":"看场景，实际系统一般都是多个问题综合导致性能问题","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546006806,"ip_address":"","comment_id":54469,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545877131","product_id":100020901,"comment_content":"额，这个好像很难理解，实际工作中上下文切换导致性能问题的多么？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434463,"discussion_content":"看场景，实际系统一般都是多个问题综合导致性能问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546006806,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53896,"user_name":"管清麟","can_delete":false,"product_type":"c1","uid":1198013,"ip_address":"","ucode":"7CA1651D0DE257","user_header":"https://static001.geekbang.org/account/avatar/00/12/47/bd/5c34df95.jpg","comment_is_top":false,"comment_ctime":1545749690,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545749690","product_id":100020901,"comment_content":"打卡第五天","like_count":0},{"had_liked":false,"id":52447,"user_name":"贼道","can_delete":false,"product_type":"c1","uid":1049316,"ip_address":"","ucode":"CFC6727249C815","user_header":"","comment_is_top":false,"comment_ctime":1545383976,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545383976","product_id":100020901,"comment_content":"在系统里看到大量的kworker线程应该如何分析？","like_count":0},{"had_liked":false,"id":52121,"user_name":"Only now","can_delete":false,"product_type":"c1","uid":1038574,"ip_address":"","ucode":"C617473A03AE27","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d8/ee/6e7c2264.jpg","comment_is_top":false,"comment_ctime":1545313758,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545313758","product_id":100020901,"comment_content":"mark ","like_count":0},{"had_liked":false,"id":51299,"user_name":"风清扬","can_delete":false,"product_type":"c1","uid":1047043,"ip_address":"","ucode":"651F1390B64953","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fa/03/619e3e48.jpg","comment_is_top":false,"comment_ctime":1545148887,"is_pvip":true,"replies":[{"id":"18645","content":"嗯嗯 谢谢分享","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545195728,"ip_address":"","comment_id":51299,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545148887","product_id":100020901,"comment_content":"root@ubuntu:~# sysbench --threads=10 --max-time=300 threads run<br>WARNING: --max-time is deprecated, use --time instead","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433394,"discussion_content":"嗯嗯 谢谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545195728,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51145,"user_name":"Eric","can_delete":false,"product_type":"c1","uid":1043295,"ip_address":"","ucode":"3F0E90E53C914B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLz2Db6H0jT6EWuqnWlGt7UiaFViaScE6ADdXpU1I5Joh4ea4htIjTR04XoNxj8GA92L13iaSQl1JqHQ/132","comment_is_top":false,"comment_ctime":1545120798,"is_pvip":false,"replies":[{"id":"18457","content":"1. 本地时钟中断，在物理机上会比较高，虚拟机中就比较低了<br>2. 没有，还是要观察变化的趋势，也就要监控起来","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545142386,"ip_address":"","comment_id":51145,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545120798","product_id":100020901,"comment_content":"老师好，我有两个问题不太明白<br><br>1、我 cat &#47;proc&#47;interrupts   发现 Rescheduling interrupts 只有两位数的变化，变化不大。 但是 Local timer interrupts 有五位数的变化。 请问这个 LOC 是什么，正常吗？<br><br>2、我观察了多台线上业务服务器，中断数平均都在 5000~10000 左右。 CS 都在 10000 以上。  我看了老师在留言中的回复，是根据不同性能的机器，具体值是不一样的。 有没有一个根据CPU核心数，大致正常范围数值的计算公式呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433307,"discussion_content":"1. 本地时钟中断，在物理机上会比较高，虚拟机中就比较低了\n2. 没有，还是要观察变化的趋势，也就要监控起来","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545142386,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50869,"user_name":"悬铃木（赵岩）","can_delete":false,"product_type":"c1","uid":1327862,"ip_address":"","ucode":"BB8285E938EE7B","user_header":"https://static001.geekbang.org/account/avatar/00/14/42/f6/6532d23d.jpg","comment_is_top":false,"comment_ctime":1545057819,"is_pvip":false,"replies":[{"id":"18469","content":"内存里","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545143797,"ip_address":"","comment_id":50869,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545057819","product_id":100020901,"comment_content":"cpu切换会保存当前进程的寄存器，栈等信息。保存在哪里了？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433152,"discussion_content":"内存里","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545143797,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50852,"user_name":"陈帅","can_delete":false,"product_type":"c1","uid":1316646,"ip_address":"","ucode":"F8EC28252B80EF","user_header":"","comment_is_top":false,"comment_ctime":1545054623,"is_pvip":false,"replies":[{"id":"18470","content":"参考第05的方法分析这个进程的行为","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545143928,"ip_address":"","comment_id":50852,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545054623","product_id":100020901,"comment_content":"公司机器配置：CPU 32核，内存125G。<br>top了一下，发现sshd2的CPU一直比较高，CPU一直在2000%左右。<br>根据前面老师说的思路排查了下：<br>系统的上下文切换次数在2万左右，中断在3万左右；<br>sshd2的io不高，自愿上下文切换在3左右，非自愿上下文切换在0。<br>不知道怎么解决了，希望老师指导下！<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433141,"discussion_content":"参考第05的方法分析这个进程的行为","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545143928,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50655,"user_name":"Schmilençé","can_delete":false,"product_type":"c1","uid":1257721,"ip_address":"","ucode":"4CD7341BD2F428","user_header":"https://static001.geekbang.org/account/avatar/00/13/30/f9/6dbf31a7.jpg","comment_is_top":false,"comment_ctime":1545024472,"is_pvip":true,"replies":[{"id":"18480","content":"嗯嗯 不同版本的参数不一样","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545144977,"ip_address":"","comment_id":50655,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1545024472","product_id":100020901,"comment_content":"迟到的打卡，希望年底跟上进度！<br>对了：sysbench 1.1.0下面，--max-time=300这个选项应该改为--time=300，即：<br>sysbench --threads=10 --time=300 threads run","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433054,"discussion_content":"嗯嗯 不同版本的参数不一样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545144977,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50595,"user_name":"嘉神666","can_delete":false,"product_type":"c1","uid":1317473,"ip_address":"","ucode":"021CA7D92AD1CE","user_header":"https://static001.geekbang.org/account/avatar/00/14/1a/61/fff6c73e.jpg","comment_is_top":false,"comment_ctime":1545014285,"is_pvip":false,"replies":[{"id":"18497","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545145521,"ip_address":"","comment_id":50595,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545014285","product_id":100020901,"comment_content":"学到了，补上打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433036,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545145521,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50038,"user_name":"呆呆","can_delete":false,"product_type":"c1","uid":1324041,"ip_address":"","ucode":"04AAAFE302D031","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/09/898d084e.jpg","comment_is_top":false,"comment_ctime":1544846421,"is_pvip":false,"replies":[{"id":"18106","content":"是的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545004333,"ip_address":"","comment_id":50038,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544846421","product_id":100020901,"comment_content":"cpu上下文切换属于sys使用率吧？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432854,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545004333,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49864,"user_name":"大坏狐狸","can_delete":false,"product_type":"c1","uid":1325678,"ip_address":"","ucode":"5044F89A505C5B","user_header":"https://static001.geekbang.org/account/avatar/00/14/3a/6e/e39e90ca.jpg","comment_is_top":false,"comment_ctime":1544781742,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544781742","product_id":100020901,"comment_content":"老师，我这里显示的 Local timer interrupts  按每秒大概2k的速度中断，是因为是centos么？","like_count":0},{"had_liked":false,"id":49519,"user_name":"鹏","can_delete":false,"product_type":"c1","uid":1009228,"ip_address":"","ucode":"243E408E2094E1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/66/4c/39a6829c.jpg","comment_is_top":false,"comment_ctime":1544704171,"is_pvip":false,"replies":[{"id":"17821","content":"还要看系统的配置和应用的类型，一般看变化情况更好","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544743815,"ip_address":"","comment_id":49519,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544704171","product_id":100020901,"comment_content":"cs 是不是太高了<br>procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----<br> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st<br> 9  0      0 6034444 5992496 337203840    0    0  8166  3102 125230 162468  5  8 87  0  0<br> 5  0      0 6006260 5992624 337229056    0    0  8194  1454 118720 160044  4  8 89  0  0<br> 5  0      0 5877116 5994104 337363040    0    0 20811 11905 126420 164815  4 10 85  1  0<br> 3  0      0 5732156 5994384 337506944    0    0 20307 24907 127620 162254  4  8 87  0  0<br> 5  0      0 5673632 5994580 337549056    0    0  9267 26081 121987 163692  4  8 87  0  0<br> 3  0      0 5592248 5994772 337644992    0    0  8330 32955 122538 162098  5  8 87  0  0<br> 6  0      0 5480484 5994924 337759136    0    0  8149  2719 123734 161787  5  8 87  0  0<br> 1  0      0 5462952 5995076 337776736    0    0  8198  1134 117928 158985  4  7 89  0  0","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432645,"discussion_content":"还要看系统的配置和应用的类型，一般看变化情况更好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544743815,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48644,"user_name":"maoxiajun","can_delete":false,"product_type":"c1","uid":1198843,"ip_address":"","ucode":"CB4926BC81B3B1","user_header":"https://static001.geekbang.org/account/avatar/00/12/4a/fb/70f14340.jpg","comment_is_top":false,"comment_ctime":1544505641,"is_pvip":false,"replies":[{"id":"17459","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544520929,"ip_address":"","comment_id":48644,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544505641","product_id":100020901,"comment_content":"lesson4打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432290,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544520929,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48375,"user_name":"汤🐠🥣昱","can_delete":false,"product_type":"c1","uid":1332781,"ip_address":"","ucode":"46842C90E59A1A","user_header":"https://static001.geekbang.org/account/avatar/00/14/56/2d/dd3b12b8.jpg","comment_is_top":false,"comment_ctime":1544430826,"is_pvip":false,"replies":[{"id":"17361","content":"这是vmstat的一个坑，第一行是系统启动以来的平均值，直接忽略即可。后面的各行才是你设置的间隔时间的平均值","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544489062,"ip_address":"","comment_id":48375,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544430826","product_id":100020901,"comment_content":"procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----<br> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st<br> 1  0    520 3831600    116 7871856    0    0     0    11    0    0  0  0 99  0  0<br> 0  0    520 3831264    116 7871868    0    0     0     0 2285 2400  0  0 100  0  0<br> 0  0    520 3830956    116 7871924    0    0     0    11 2591 2818  2  0 98  0  0<br> 0  0    520 3830268    116 7871972    0    0     0    64 2440 2673  1  0 99  0  0<br>在使用vmstat 5 查看系统性能的时候，第一行cs，us小，之后数值都很大，这是为什么？<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432152,"discussion_content":"这是vmstat的一个坑，第一行是系统启动以来的平均值，直接忽略即可。后面的各行才是你设置的间隔时间的平均值","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544489062,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48337,"user_name":"如果","can_delete":false,"product_type":"c1","uid":1320638,"ip_address":"","ucode":"138A3EEEE50850","user_header":"","comment_is_top":false,"comment_ctime":1544424215,"is_pvip":false,"replies":[{"id":"17267","content":"+1赞","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544434263,"ip_address":"","comment_id":48337,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544424215","product_id":100020901,"comment_content":"DAY4,打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432135,"discussion_content":"+1赞","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544434263,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47635,"user_name":"力挽狂澜爆炸输出的臭臭宁","can_delete":false,"product_type":"c1","uid":1155904,"ip_address":"","ucode":"E8D26181129BCA","user_header":"https://static001.geekbang.org/account/avatar/00/11/a3/40/e0df3b84.jpg","comment_is_top":false,"comment_ctime":1544169215,"is_pvip":false,"replies":[{"id":"17011","content":"第一个是累加值，第二个是vmstat采集时间的差值","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544193389,"ip_address":"","comment_id":47635,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544169215","product_id":100020901,"comment_content":"为什么&#47;proc&#47;interrupts显示的RES中断数有245万多，而vmstat显示的只有1万？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431841,"discussion_content":"第一个是累加值，第二个是vmstat采集时间的差值","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544193389,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47069,"user_name":"Geng","can_delete":false,"product_type":"c1","uid":1202134,"ip_address":"","ucode":"3FF8A62B08035A","user_header":"https://static001.geekbang.org/account/avatar/00/12/57/d6/ee9e1e43.jpg","comment_is_top":false,"comment_ctime":1544028956,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544028956","product_id":100020901,"comment_content":"15:     432533   IO-APIC  15-edge      ata_piix<br> 24:          0   PCI-MSI 65536-edge      virtio1-config<br> 25:    5881576   PCI-MSI 65537-edge      virtio1-req.0<br> 26:          0   PCI-MSI 49152-edge      virtio0-config<br> 27:   16526409   PCI-MSI 49153-edge      virtio0-input.0<br> 28:        222   PCI-MSI 49154-edge      virtio0-output.0<br>NMI:          0   Non-maskable interrupts<br>LOC:   39324969   Local timer interrupts<br>SPU:          0   Spurious interrupts<br>MCE:          0   Machine check exceptions<br>MCP:       1352   Machine check polls<br>HYP:          0   Hypervisor callback interrupts<br>我的设备上显示是LOC较高","like_count":0},{"had_liked":false,"id":46661,"user_name":"Arwen","can_delete":false,"product_type":"c1","uid":1318125,"ip_address":"","ucode":"480444BDB579CB","user_header":"https://static001.geekbang.org/account/avatar/00/14/1c/ed/c7719736.jpg","comment_is_top":false,"comment_ctime":1543969914,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543969914","product_id":100020901,"comment_content":"mark学会几个命令pidstat -wt 1,pidstat -w -t 1","like_count":0},{"had_liked":false,"id":45930,"user_name":"f","can_delete":false,"product_type":"c1","uid":1027733,"ip_address":"","ucode":"8849D39F700E4B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ae/95/d1b13c9e.jpg","comment_is_top":false,"comment_ctime":1543820397,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543820397","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":45803,"user_name":"型火🔥","can_delete":false,"product_type":"c1","uid":1003205,"ip_address":"","ucode":"C2322918B31E60","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4e/c5/78626367.jpg","comment_is_top":false,"comment_ctime":1543798599,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1543798599","product_id":100020901,"comment_content":"D4 vmstat<br>pidstat<br>&#47;proc&#47;interrupts","like_count":0},{"had_liked":false,"id":45625,"user_name":"3x3eyes","can_delete":false,"product_type":"c1","uid":1316447,"ip_address":"","ucode":"1D0B97A976DE50","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoIaX6V6AlxXTF7HjQwoATh8DgibHlszeCw4iad2yvictYoeiac7MtMkM1x6dLA8YAN1fO1EZ4Tq8oC4A/132","comment_is_top":false,"comment_ctime":1543727357,"is_pvip":false,"replies":[{"id":"16319","content":"这个值跟CPU性能和负载的类型都有关系，一般没有确切的阈值。一般推荐观察它的变化情况而不是绝对值，比如是否有数量级的增长","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543797341,"ip_address":"","comment_id":45625,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543727357","product_id":100020901,"comment_content":"如何才能判断上下文切换数形成性能瓶颈了呢?尤其是服务器环境，有没有一个大概的（阈）值，当cpu核的上下文切换超这个值就代表性能问题了。<br>另外，cpu核心，主频，指令集有没有可能对中断数阈值有影响?","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431127,"discussion_content":"这个值跟CPU性能和负载的类型都有关系，一般没有确切的阈值。一般推荐观察它的变化情况而不是绝对值，比如是否有数量级的增长","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543797341,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45562,"user_name":"在路上","can_delete":false,"product_type":"c1","uid":1143372,"ip_address":"","ucode":"335960F683C23C","user_header":"https://static001.geekbang.org/account/avatar/00/11/72/4c/4d636a23.jpg","comment_is_top":false,"comment_ctime":1543676360,"is_pvip":false,"replies":[{"id":"16236","content":"1.观察下有没有其他的异常变化<br>2.最后的汇总结果是什么？试一下请求数再设置大一点","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543719353,"ip_address":"","comment_id":45562,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543676360","product_id":100020901,"comment_content":"不压测时，in和cs才几百，&#47;proc&#47;interrupts 中的res就140多万了；10个线程压测，in上升为2万多，cs上升到50多万，但是&#47;proc&#47;interrupts 中的res变化不大，这个怎么来理解呢？<br>另外在ubuntu16.04版本执行命令为：sysbench --num-threads=10 --max-time=3000  --test=threads run 这个命令只显示不到10s就结束了，--max-time怎么不起作用，即使加了--max-requests=1000也一样","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431096,"discussion_content":"1.观察下有没有其他的异常变化\n2.最后的汇总结果是什么？试一下请求数再设置大一点","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543719353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45495,"user_name":"gentleman♥️","can_delete":false,"product_type":"c1","uid":1119062,"ip_address":"","ucode":"0BAC746A70038C","user_header":"https://static001.geekbang.org/account/avatar/00/11/13/56/6a062937.jpg","comment_is_top":false,"comment_ctime":1543655238,"is_pvip":false,"replies":[{"id":"16330","content":"文中其实已经介绍了中断上下文，比如你去访问一个web服务，就需要网卡中断帮你处理网络数据包的收发","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543797979,"ip_address":"","comment_id":45495,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543655238","product_id":100020901,"comment_content":"老师问个问题 像我们一般的应用什么的 就可以说是进程吧<br>它的进程的切换，最后还是要通过内部的线程来体现，也就说实际上一般应用的进程上下文切换，最后反应的都是线程的上下文切换，是吗，<br>那是不是也有只有线程级别内核上下文切换呢，比如一个进程只有一个线程这个是吧<br>但是有其他操作系统内核层面也有这样的上下文切换嘛，就是没有进程附加的内核切换，如果有，老师能举几个例子嘛","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431064,"discussion_content":"文中其实已经介绍了中断上下文，比如你去访问一个web服务，就需要网卡中断帮你处理网络数据包的收发","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543797979,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45483,"user_name":"mj4ever","can_delete":false,"product_type":"c1","uid":1005549,"ip_address":"","ucode":"73028E537099CC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/ed/d50de13c.jpg","comment_is_top":false,"comment_ctime":1543652322,"is_pvip":true,"replies":[{"id":"16332","content":"模拟环境几个CPU？需要至少2个才会有RES","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543798147,"ip_address":"","comment_id":45483,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543652322","product_id":100020901,"comment_content":"本周外出培训了，不过还是需要坚持跟上，所以，周六先补习下CPU上下文切换的知识。<br>通过两篇知识的学习，掌握了以下内容：<br>1、理解了什么是CPU的上下文切换，以及上下文切换发生的场景有哪些<br>2、理解了系统调用的概念，用户态到内核态的转变，属于特权模式切换<br>3、实操模拟上下文切换的分析：<br>（1）首先，观察上下文切换和中断次数总体情况，可使用 vmstat 命令<br>（2）如果是，上下文切换次数过多，可进一步观察每个进程的详细情况，可使用 pidstat 命令；还要区分出是自愿（cswch）还是非自愿（nvcswch）<br>（3）如果是，中断次数过多，进一步观察系统中断使用情况，可以查看 &#47;proc&#47;interrupts<br><br>有一点小疑问：我模拟的场景下（测试用例和老师给的相同），中断次数并不算高，维持在2000左右，这个时候查看&#47;proc&#47;interrupts，发现LOC（Local timer interrupts）变化率要比RES（Rescheduling interrupts）的高；然后去查了LOC（https:&#47;&#47;stackoverflow.com&#47;questions&#47;10567214&#47;what-are-linux-local-timer-interrupts），发现没有看懂，或许也不是很重要：）<br><br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431060,"discussion_content":"模拟环境几个CPU？需要至少2个才会有RES","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543798147,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45340,"user_name":"maoxiajun","can_delete":false,"product_type":"c1","uid":1198843,"ip_address":"","ucode":"CB4926BC81B3B1","user_header":"https://static001.geekbang.org/account/avatar/00/12/4a/fb/70f14340.jpg","comment_is_top":false,"comment_ctime":1543591290,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543591290","product_id":100020901,"comment_content":"lesson4打卡","like_count":0},{"had_liked":false,"id":45304,"user_name":"ageeklet","can_delete":false,"product_type":"c1","uid":1237638,"ip_address":"","ucode":"3A717CF59AE04A","user_header":"https://static001.geekbang.org/account/avatar/00/12/e2/86/53ae8868.jpg","comment_is_top":false,"comment_ctime":1543581627,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543581627","product_id":100020901,"comment_content":"我的RES为什么基本上不会变。。。。","like_count":0},{"had_liked":false,"id":45224,"user_name":"地心引力","can_delete":false,"product_type":"c1","uid":1332297,"ip_address":"","ucode":"B5BCF5EF0C73C2","user_header":"https://static001.geekbang.org/account/avatar/00/14/54/49/ede4ab2f.jpg","comment_is_top":false,"comment_ctime":1543562703,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543562703","product_id":100020901,"comment_content":"文章里说的方法是在SMP架构的服务器上使用的，对于NUMA架构的服务器也同样适用吗","like_count":0},{"had_liked":false,"id":45223,"user_name":"半青","can_delete":false,"product_type":"c1","uid":1314715,"ip_address":"","ucode":"DC8639685C3940","user_header":"https://static001.geekbang.org/account/avatar/00/14/0f/9b/0683f2da.jpg","comment_is_top":false,"comment_ctime":1543562375,"is_pvip":false,"replies":[{"id":"16085","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543570443,"ip_address":"","comment_id":45223,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543562375","product_id":100020901,"comment_content":"找到问题了，cpu只使用了一个","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430961,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543570443,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45215,"user_name":"半青","can_delete":false,"product_type":"c1","uid":1314715,"ip_address":"","ucode":"DC8639685C3940","user_header":"https://static001.geekbang.org/account/avatar/00/14/0f/9b/0683f2da.jpg","comment_is_top":false,"comment_ctime":1543561549,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1543561549","product_id":100020901,"comment_content":"老师，运行sysbench后，RES的指标是0 ，系统是RHEL7.5,&#47;proc&#47;interrupts的指标没有变化。","like_count":0,"discussions":[{"author":{"id":1805809,"avatar":"","nickname":"ccz 开发(谢不邀)","note":"","ucode":"B8803B050AAC68","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":133765,"discussion_content":"单核cpu不会变化","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578987473,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45214,"user_name":"MJ","can_delete":false,"product_type":"c1","uid":1237145,"ip_address":"","ucode":"FCEC0C21444D2A","user_header":"https://static001.geekbang.org/account/avatar/00/12/e0/99/5d603697.jpg","comment_is_top":false,"comment_ctime":1543561543,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543561543","product_id":100020901,"comment_content":"老师写的太好了，赞！<br><br>努力学习中","like_count":0},{"had_liked":false,"id":45144,"user_name":"樊海涛","can_delete":false,"product_type":"c1","uid":1323249,"ip_address":"","ucode":"0B04D5985EE0E1","user_header":"https://static001.geekbang.org/account/avatar/00/14/30/f1/bf7fd8d2.jpg","comment_is_top":false,"comment_ctime":1543549824,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543549824","product_id":100020901,"comment_content":"linux调度的基本单位实际上是线程；<br>1、首先用vmstat工具分析系统的cpu上下文切换次数和中断次数；cs是每秒上下文切换次数，in是每秒中断次数，r是就绪队列长度；<br>2、通过pidstat工具具体查看每个进程的上下文切换，主要关注 cswch（每秒自愿上下文切换次数）和nvcswch（每秒非自愿上下文切换次数）；<br>3、从 &#47;proc&#47;interrupts文件查看中断次数；<br><br>","like_count":0},{"had_liked":false,"id":45134,"user_name":"Zenppl","can_delete":false,"product_type":"c1","uid":1322987,"ip_address":"","ucode":"093795428BADB7","user_header":"https://static001.geekbang.org/account/avatar/00/14/2f/eb/5dceac8a.jpg","comment_is_top":false,"comment_ctime":1543548819,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543548819","product_id":100020901,"comment_content":"ubuntu 16.04 <br>sysbench --num-threads=10 --max-time=300 --max-requests=10000000 --test=threads run","like_count":0},{"had_liked":false,"id":45064,"user_name":"coolber","can_delete":false,"product_type":"c1","uid":1103997,"ip_address":"","ucode":"13A5F9DBD4275D","user_header":"https://static001.geekbang.org/account/avatar/00/10/d8/7d/76f05d32.jpg","comment_is_top":false,"comment_ctime":1543542712,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543542712","product_id":100020901,"comment_content":"&#47;proc&#47;interrupts  这个在core系统上终端查看很不方便，大家有好用的工具么","like_count":0},{"had_liked":false,"id":45063,"user_name":"划时代","can_delete":false,"product_type":"c1","uid":1061454,"ip_address":"","ucode":"9554CE2F83B77F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/2o1Izf2YyJSnnI0ErZ51pYRlnrmibqUTaia3tCU1PjMxuwyXSKOLUYiac2TQ5pd5gNGvS81fVqKWGvDsZLTM8zhWg/132","comment_is_top":false,"comment_ctime":1543542689,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543542689","product_id":100020901,"comment_content":"操作实践，分析观察，熟悉中断。","like_count":0},{"had_liked":false,"id":44989,"user_name":"J","can_delete":false,"product_type":"c1","uid":1204008,"ip_address":"","ucode":"7F1BD7F66F4700","user_header":"https://static001.geekbang.org/account/avatar/00/12/5f/28/17ed19bc.jpg","comment_is_top":false,"comment_ctime":1543537939,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543537939","product_id":100020901,"comment_content":"用stress -i 增加D进程数  为什么 vmstat下面的b(blocked)数目不增加呢？","like_count":0},{"had_liked":false,"id":44987,"user_name":"J","can_delete":false,"product_type":"c1","uid":1204008,"ip_address":"","ucode":"7F1BD7F66F4700","user_header":"https://static001.geekbang.org/account/avatar/00/12/5f/28/17ed19bc.jpg","comment_is_top":false,"comment_ctime":1543537668,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543537668","product_id":100020901,"comment_content":"怎么能把vmstat下面的blocked数量增大呢?","like_count":0},{"had_liked":false,"id":44938,"user_name":"樊海涛","can_delete":false,"product_type":"c1","uid":1323249,"ip_address":"","ucode":"0B04D5985EE0E1","user_header":"https://static001.geekbang.org/account/avatar/00/14/30/f1/bf7fd8d2.jpg","comment_is_top":false,"comment_ctime":1543513653,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543513653","product_id":100020901,"comment_content":"day5打卡，我用的是阿里的云主机，没有执行sysbench工具的时候，系统的cs已经到好几百了<br><br>用pidstat -w -u 1分析，发现自愿上下文切换最高的是rcu_sched进程<br>","like_count":0},{"had_liked":false,"id":44892,"user_name":"森高","can_delete":false,"product_type":"c1","uid":1315650,"ip_address":"","ucode":"C38B483E56F3D1","user_header":"https://static001.geekbang.org/account/avatar/00/14/13/42/762cb313.jpg","comment_is_top":false,"comment_ctime":1543503639,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543503639","product_id":100020901,"comment_content":"感谢老师分享！这边有一个问题想请教一下老师：<br>在使用sysbench提供100并发压力的时候，通过ps aux指令发现sysbench进程状态是Sl+，且使用uptime指令观察到系统平均负载逐渐升高。按照之前的介绍，平均负载指的是系统处于可运行状态（R）和不可中断状态（D）的平均进程数，这里既状态不符合（Sl+），进程数也没变多（只是线程变多），为什么平均负载会升高呢？<br>谢谢老师！","like_count":0},{"had_liked":false,"id":44863,"user_name":"阿卡牛","can_delete":false,"product_type":"c1","uid":1022247,"ip_address":"","ucode":"0BC43A904C3199","user_header":"https://static001.geekbang.org/account/avatar/00/0f/99/27/47aa9dea.jpg","comment_is_top":false,"comment_ctime":1543501079,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543501079","product_id":100020901,"comment_content":"老师我系统是8核的，但用htop命令查看会显示有12个cpu，是因为多线程的关系吗？","like_count":0},{"had_liked":false,"id":44852,"user_name":"huhu小仙女","can_delete":false,"product_type":"c1","uid":1016908,"ip_address":"","ucode":"9E83753A7F8FBC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/84/4c/9fd9e2eb.jpg","comment_is_top":false,"comment_ctime":1543499819,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543499819","product_id":100020901,"comment_content":"😄","like_count":0},{"had_liked":false,"id":44823,"user_name":"未来小鬼","can_delete":false,"product_type":"c1","uid":1244665,"ip_address":"","ucode":"A0ED87F78E6319","user_header":"https://static001.geekbang.org/account/avatar/00/12/fd/f9/61bdb3f8.jpg","comment_is_top":false,"comment_ctime":1543496500,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543496500","product_id":100020901,"comment_content":"倪老师，我在知乎做了个打卡学习连载，附上了课程目录与课程购买二维码，可行？:)","like_count":0},{"had_liked":false,"id":44750,"user_name":"xzy","can_delete":false,"product_type":"c1","uid":1002095,"ip_address":"","ucode":"1A44368083A19E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4a/6f/e36b3908.jpg","comment_is_top":false,"comment_ctime":1543486377,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1543486377","product_id":100020901,"comment_content":"有一点不明白，一个进程中的多个线程可以同时在多核cpu运行吗？如果可以是如何做到的？","like_count":0,"discussions":[{"author":{"id":1049361,"avatar":"https://static001.geekbang.org/account/avatar/00/10/03/11/f58c6278.jpg","nickname":"你好呀","note":"","ucode":"2E97656410BACA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1879,"discussion_content":"可以吧   有一个图   多核cpu调度   可以去看看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563026275,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44734,"user_name":"luodi","can_delete":false,"product_type":"c1","uid":1334245,"ip_address":"","ucode":"A0D8613C792C47","user_header":"https://static001.geekbang.org/account/avatar/00/14/5b/e5/aaa642da.jpg","comment_is_top":false,"comment_ctime":1543483461,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543483461","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":44688,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1543476277,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543476277","product_id":100020901,"comment_content":"老师,我又来请教了.<br>还是之前反映的问题,服务器平常负载不到0.1,但是偶尔会飙升到14+.<br>以下是load1:10+时的指标数据,及个人分析.<br> mpstat -P ALL 5 结果:<br> CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest   %idle<br> all   19.85    4.00    7.04    0.05    0.00    0.66    0.00    0.00   68.41<br>该时间段有个定时任务, 用了nice调整了优先级. 该程序本身不占cpu不占内存.<br>可以看到%idle还有68% 说明瓶颈本身不在cpu上.<br>vmstat 1 结果:<br> r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st<br>30  0      0 130560   5840 2154888    0    0     0 11152 13013 35408 17  6 77  0  0<br> 4  0      0 126144   5840 2156296    0    0     0     0 8265 19351 15  4 81  0  0<br> 5  0      0 124764   5848 2157780    0    0     0    32 7470 17824 16  4 80  0  0<br>80%时候r都在0-2,极少数时候会超过5, 零星几次超过10.<br>这里到了30,说明确实运行和等待的程序较多导致负载上升.<br>我用 ps aufx 看STAT 处于R状态的经常就一两个.[不知道有什么办法知道是哪些程序在等待]<br>这里的in cs平常都是 13013 和 35408 这个数量级.平常系统负载就很低,说明不是这里的原因.<br>后面in cs降低是手动停掉了tail | grep 日志.[这两个命令是导致in cs升高的主要原因.]<br>pidstat -wut 1 结果也还好,没有明显变化.<br>watch -d cat &#47;proc&#47;interrupts 结果<br>LOC:  954744422  958342296  960076141  962868552   Local timer interrupts<br>RES:  687327731  702086115  718167508  708951075   Rescheduling interrupts<br>这两个最多 谷歌说LOC多是正常的.<br>个人分析:<br>该机器上的程序既不是CPU密集型 也不是I&#47;O密集型 指标也可以来证明.<br>我单独测i&#47;o时 bi bo 可以到120K+ 这里负载上升时的bo才11K+.<br>结合r的指标,说明确实是瞬时会有大量等待的进程导致负载上升.[但是ps看不出来来]<br>猜测:<br>可能还是云服务器的磁盘i&#47;o有问题.我的很多程序需要写日志,如果卡在磁盘io,确实可以导致程序都在等待. 虽然负载上升时的bi &#47;bo 不算高,但是毕竟是共享的.<br>下次再负载上升时,我再拷贝下大文件,把bi&#47;bo进一步拉上去,看负载会不会继续升高.","like_count":0},{"had_liked":false,"id":44687,"user_name":"Cranliu","can_delete":false,"product_type":"c1","uid":1304302,"ip_address":"","ucode":"DC2DE84B142FDA","user_header":"https://static001.geekbang.org/account/avatar/00/13/e6/ee/e3c4c9b3.jpg","comment_is_top":false,"comment_ctime":1543476258,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543476258","product_id":100020901,"comment_content":"sysbench --num-threads=20 --max-time=3000 --max-requests=100000 --test=threads run","like_count":0},{"had_liked":false,"id":44397,"user_name":"大飞","can_delete":false,"product_type":"c1","uid":1320080,"ip_address":"","ucode":"2D98888FC63CA9","user_header":"","comment_is_top":false,"comment_ctime":1543419671,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543419671","product_id":100020901,"comment_content":"d1打卡","like_count":0},{"had_liked":false,"id":44396,"user_name":"云开","can_delete":false,"product_type":"c1","uid":1297758,"ip_address":"","ucode":"74541653336DDA","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/nSvVtStiaQzslFM7YRnlhP7FxdVsz8abjlwY6XZ4guKtkXNUgG8EibxztoeosKL2YuxDsb159NTQhVXFBkj31kBw/132","comment_is_top":false,"comment_ctime":1543419527,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543419527","product_id":100020901,"comment_content":"我的也是—max-time=300不管用 只能执行5s多<br>而且加大这个参数值还是同样的效果","like_count":0},{"had_liked":false,"id":44393,"user_name":"张春阳","can_delete":false,"product_type":"c1","uid":1259397,"ip_address":"","ucode":"02C89D7A9F489A","user_header":"https://static001.geekbang.org/account/avatar/00/13/37/85/d91dec8c.jpg","comment_is_top":false,"comment_ctime":1543419186,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1543419186","product_id":100020901,"comment_content":"咨询个问题，vmstat第一列就绪状态为8，是指的进程还是线程？单进程开了8个线程，这8个线程在争抢父进程所在的1个cpu吗？","like_count":0,"discussions":[{"author":{"id":2432907,"avatar":"https://static001.geekbang.org/account/avatar/00/25/1f/8b/bc711633.jpg","nickname":"江南晨辉","note":"","ucode":"2A1DD346ED3BC9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539552,"discussion_content":"8个线程是系统级别下的线程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639751348,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44380,"user_name":"dexter","can_delete":false,"product_type":"c1","uid":1315252,"ip_address":"","ucode":"DD51207438FBD6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEL5xnfuicbtRz4F87AAjZX6oCEjMtYiaIu4iaQichQmy0vEBA6Sumic1RDvUCeuBEqj6iatnt2kENbKYmuw/132","comment_is_top":false,"comment_ctime":1543417614,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543417614","product_id":100020901,"comment_content":"打卡5","like_count":0},{"had_liked":false,"id":44350,"user_name":"封建的风","can_delete":false,"product_type":"c1","uid":1302600,"ip_address":"","ucode":"811C24F093AF0F","user_header":"https://static001.geekbang.org/account/avatar/00/13/e0/48/3d72e81c.jpg","comment_is_top":false,"comment_ctime":1543412737,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543412737","product_id":100020901,"comment_content":"一直不确定的一个问题，请教老师，<br>在一个线程拿到cpu时间片运行时，碰到等待io的情况下，cpu时间片还没耗尽时会发生cs吗？还是在时间片内等io信号返回呢","like_count":0},{"had_liked":false,"id":44339,"user_name":"walker","can_delete":false,"product_type":"c1","uid":1324219,"ip_address":"","ucode":"FA5B2400A53730","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/bb/0b971fca.jpg","comment_is_top":false,"comment_ctime":1543411199,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543411199","product_id":100020901,"comment_content":"上下文切换的临界值是不固定的，根据cpu性能有所不同。一般情况下cpu上下文切换比较平稳的情况下，正常。当切换变化比较大的时候，说明出现瓶颈。","like_count":0},{"had_liked":false,"id":44327,"user_name":"Goal","can_delete":false,"product_type":"c1","uid":1307012,"ip_address":"","ucode":"C337CD4C7E07B0","user_header":"https://static001.geekbang.org/account/avatar/00/13/f1/84/7d21bd9e.jpg","comment_is_top":false,"comment_ctime":1543408554,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543408554","product_id":100020901,"comment_content":"收获颇丰，以前零零散散的知识，终于可以系统的学一下啦，而且，最好的，面试有的说啦","like_count":0},{"had_liked":false,"id":44283,"user_name":"大胃高怕飞","can_delete":false,"product_type":"c1","uid":1047735,"ip_address":"","ucode":"EEC5151E1A8062","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fc/b7/6cef8bf0.jpg","comment_is_top":false,"comment_ctime":1543400024,"is_pvip":false,"replies":[{"id":"15810","content":"+1😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543407814,"ip_address":"","comment_id":44283,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543400024","product_id":100020901,"comment_content":"打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430709,"discussion_content":"+1😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543407814,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44265,"user_name":"仲鬼","can_delete":false,"product_type":"c1","uid":1314692,"ip_address":"","ucode":"DB1CD7052D5BA6","user_header":"https://static001.geekbang.org/account/avatar/00/14/0f/84/d8e63885.jpg","comment_is_top":false,"comment_ctime":1543396353,"is_pvip":false,"replies":[{"id":"15809","content":"1. 没有因果关系，但中断返回的时候有可能正好碰到进程重新调度。<br>2. 分散任务到空闲的CPU，这样多个CPU上的任务可以并行运行","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543407801,"ip_address":"","comment_id":44265,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543396353","product_id":100020901,"comment_content":"老师请教两个问题：<br>1. 请问中断会导致非自愿上下文切换吗？<br>2.  为什么其他CPU闲置的时候，需要用RES中断通知闲置CPU调度其他CPU的就绪任务？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430700,"discussion_content":"1. 没有因果关系，但中断返回的时候有可能正好碰到进程重新调度。\n2. 分散任务到空闲的CPU，这样多个CPU上的任务可以并行运行","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543407801,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44261,"user_name":"蜗牛","can_delete":false,"product_type":"c1","uid":1310692,"ip_address":"","ucode":"D750232EC0BCBB","user_header":"https://static001.geekbang.org/account/avatar/00/13/ff/e4/6431a3b3.jpg","comment_is_top":false,"comment_ctime":1543395990,"is_pvip":false,"replies":[{"id":"15811","content":"b=0表示没有处于不可能中断状态的进程，r比较大可以继续分析下进程的CPU情况","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543407977,"ip_address":"","comment_id":44261,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543395990","product_id":100020901,"comment_content":"vmstat 显示r是345，b是0会是什么原因呢，服务器上面三个tomcat，一个mysql，4核16g服务器<br>[图片]","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430698,"discussion_content":"b=0表示没有处于不可能中断状态的进程，r比较大可以继续分析下进程的CPU情况","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543407977,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44247,"user_name":":(){ :|: };:","can_delete":false,"product_type":"c1","uid":1314938,"ip_address":"","ucode":"3FB8D1ABA060AD","user_header":"https://static001.geekbang.org/account/avatar/00/14/10/7a/b15e6572.jpg","comment_is_top":false,"comment_ctime":1543393848,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543393848","product_id":100020901,"comment_content":"同问 sysbench --max-time=300 实际只执行了6s 是什么原因呢~","like_count":0},{"had_liked":false,"id":44241,"user_name":"D白菜","can_delete":false,"product_type":"c1","uid":1304391,"ip_address":"","ucode":"8DC343172AB781","user_header":"https://static001.geekbang.org/account/avatar/00/13/e7/47/d0715205.jpg","comment_is_top":false,"comment_ctime":1543392740,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543392740","product_id":100020901,"comment_content":"问题处理对象<br>平均负载(uptime)--&gt;vmstat判断问题出在哪方面(队列、内存、swap换页、cpu、io、上下文切换)--&gt;进一步查看有问题方面的性能(mpstat\\iostat\\netstat\\ps\\free\\sar等)--&gt;pidstat找到具体有问题的对象--&gt;对有问题对象(任务)分析找到解决办法(日志、性能数据文件、strace、应用分析等)。<br>总结：<br>1、通过vmstat(虚拟内存统计)命令和 &#47;proc&#47;interrupts文件种获取服务器总体性能。<br>vmstat命令显示列含义：<br>r(running or runable): 就绪队列长度，包括当前运行和等待执行的任务数。<br>b(blocked)：处在非中断睡眠状态的进程数<br>cs(context switches)每秒上下文切换次数。<br>in(interrupt)，每秒中断次数。<br>2、在通过pidstat(-w)来进一步获取上下文切换情况，找出出现性能问题的对象-进程和线程。<br>cswch(voluntary context switches) 每秒自愿上下文切换次数，资源不够导致的上下文切换。<br>nvcswch(non voluntary context switches)每秒非自愿上下文切换次数，系统强制调度发生的上下文切换。<br>3、判断出上下文切换的类型，并进一步分析具体原因，找到解决问题的办法。<br>1)、自愿上下文切换很多，说明资源等待，有可能是程序问题，比如慢sql，或者资源不足;<br>2)、非自愿上下文切换变多了，说明任务被强制调度争抢CPU，CPU可能已成为瓶颈;<br>3)、中断次数增多(in问题)，说明cpu被中断占用，需要通过watch -d &#47;proc&#47;interrupts进行进一步的分析。","like_count":0},{"had_liked":false,"id":44190,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1543380867,"is_pvip":false,"replies":[{"id":"15815","content":"赶紧用学到的方法分析下","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543409122,"ip_address":"","comment_id":44190,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543380867","product_id":100020901,"comment_content":"看了今天的内容，待会再去服务器上看看。昨天也遇到了云服务器上短时负载过高的情况。4cpu 8g内存 load1:9 load5:4 这种。cpu负载在20%（usr 15% sys 5%  iowait 0.05% soft 0.3% idle 79%），上下文切换和中断数稳定在4w，1w，内存还有2g。平常这些指标也这样，load才0.1，但是偶尔会突然高到了9，实在是有点莫名其妙。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430674,"discussion_content":"赶紧用学到的方法分析下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543409122,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44186,"user_name":"许山山","can_delete":false,"product_type":"c1","uid":1241643,"ip_address":"","ucode":"2A5168DEB58F19","user_header":"https://static001.geekbang.org/account/avatar/00/12/f2/2b/7d9751bb.jpg","comment_is_top":false,"comment_ctime":1543379928,"is_pvip":false,"replies":[{"id":"15818","content":"多个CPU才会有这个中断","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543409206,"ip_address":"","comment_id":44186,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543379928","product_id":100020901,"comment_content":"老师我用的是ubuntu 16.04的vps，单核、2G内存，不论是否运行测试程序，RES都是0，in没有明显变化，在100~400间波动，cs从几百激增到十几万。我想问下问什么我这边没有出现明显的中断问题呢？而且我的测试程序也会很快的停止。是因为vps的配置太低了吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430670,"discussion_content":"多个CPU才会有这个中断","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543409206,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44175,"user_name":"solar","can_delete":false,"product_type":"c1","uid":1316091,"ip_address":"","ucode":"D5BE087E264401","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/dwehJHP4ycAfDb9MoudXb4QSt7YgmISqwwsa928XZ6aTWqwWh0kx0iatjocSibLa7iajXmbGlJ5svegY3P6LfKJ0w/132","comment_is_top":false,"comment_ctime":1543378025,"is_pvip":true,"replies":[{"id":"15816","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543409136,"ip_address":"","comment_id":44175,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543378025","product_id":100020901,"comment_content":"一直对上下文切换理解不够深刻，现在又有了更新的认识，收获不错。尤其学习到了pidstat，vmstat等更深入理解进程相关的命令。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430665,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543409136,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44109,"user_name":"tristan","can_delete":false,"product_type":"c1","uid":1317022,"ip_address":"","ucode":"4700479F896D44","user_header":"https://static001.geekbang.org/account/avatar/00/14/18/9e/b04d5e6c.jpg","comment_is_top":false,"comment_ctime":1543369462,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543369462","product_id":100020901,"comment_content":"打卡学习。","like_count":0},{"had_liked":false,"id":44101,"user_name":"kakasir","can_delete":false,"product_type":"c1","uid":1316615,"ip_address":"","ucode":"21F9742D3E63B3","user_header":"https://static001.geekbang.org/account/avatar/00/14/17/07/83f030c9.jpg","comment_is_top":false,"comment_ctime":1543369228,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543369228","product_id":100020901,"comment_content":"打卡，这些必须自己实际操作才能体会深刻，还处于学习阶段，自己安一些工具也会失败，多实践吧","like_count":0},{"had_liked":false,"id":44097,"user_name":"低调","can_delete":false,"product_type":"c1","uid":1087237,"ip_address":"","ucode":"F4F001639091E0","user_header":"https://static001.geekbang.org/account/avatar/00/10/97/05/17cf5840.jpg","comment_is_top":false,"comment_ctime":1543368874,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543368874","product_id":100020901,"comment_content":"打卡第四篇","like_count":0},{"had_liked":false,"id":44051,"user_name":"王涛","can_delete":false,"product_type":"c1","uid":1315326,"ip_address":"","ucode":"6241F08634D342","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/fe/de00d8d8.jpg","comment_is_top":false,"comment_ctime":1543366533,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543366533","product_id":100020901,"comment_content":"第4大卡","like_count":0},{"had_liked":false,"id":44048,"user_name":"学习者","can_delete":false,"product_type":"c1","uid":1017684,"ip_address":"","ucode":"3BF2B29656C1CF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/54/727379d8.jpg","comment_is_top":false,"comment_ctime":1543366476,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543366476","product_id":100020901,"comment_content":"第五篇打卡","like_count":0},{"had_liked":false,"id":44045,"user_name":"皇家救星","can_delete":false,"product_type":"c1","uid":1326106,"ip_address":"","ucode":"89F1274A3835FE","user_header":"https://static001.geekbang.org/account/avatar/00/14/3c/1a/1806ef25.jpg","comment_is_top":false,"comment_ctime":1543366461,"is_pvip":false,"replies":[{"id":"15835","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543410903,"ip_address":"","comment_id":44045,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543366461","product_id":100020901,"comment_content":"谢谢，之前一直觉得我们系统才8个cpu，但是进程有几千个，应该会有严重的调度问题，但是不知道怎么观察。感谢指出方向","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430609,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543410903,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44015,"user_name":"罗盼","can_delete":false,"product_type":"c1","uid":1316509,"ip_address":"","ucode":"E15183A08C6683","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/f9DsnXlr17ibsonA7quWTgMrHq6qSvhWlzz4G5dOBLcY98I6JckYeeDQicjGfNQ1XqibibeUZkvld5YH23JyIribibbw/132","comment_is_top":false,"comment_ctime":1543365235,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543365235","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":44000,"user_name":"ninuxer","can_delete":false,"product_type":"c1","uid":1243135,"ip_address":"","ucode":"5394ADAF2667D6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132","comment_is_top":false,"comment_ctime":1543364094,"is_pvip":false,"replies":[{"id":"15839","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543411244,"ip_address":"","comment_id":44000,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543364094","product_id":100020901,"comment_content":"day5，打卡<br>vmstat的输出中，r，b的值结合起来，对应了前一个主题中uptime显示出的平均负载情况；in中断，cs上下文切换<br>pidstat -w输出进程级别的上下文切换情况，-wt输出线程级别上下文切换情况；分自愿切换（得不到必要的资源，如内存，io等），非自愿切换（时间片到期，进程间竞争cpu资源）<br>中断信息可查看&#47;proc&#47;interruptes信息<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430588,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543411244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43994,"user_name":"Linux云计算网络","can_delete":false,"product_type":"c1","uid":1114062,"ip_address":"","ucode":"8E1F8B049D3C95","user_header":"https://static001.geekbang.org/account/avatar/00/10/ff/ce/73ee54bf.jpg","comment_is_top":false,"comment_ctime":1543363480,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543363480","product_id":100020901,"comment_content":"带着问题去学习","like_count":0},{"had_liked":false,"id":43975,"user_name":"湖湘志","can_delete":false,"product_type":"c1","uid":1285578,"ip_address":"","ucode":"C8B069B3AD4FEA","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erJR5Kj0Xm6LykFHLaWqHjQiaroVxgdoGI7uHEGz2D3PfibWNkBYP23QLzFmcuicgKLbqUch0ZJ2ZNOA/132","comment_is_top":false,"comment_ctime":1543359466,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543359466","product_id":100020901,"comment_content":"D4","like_count":0}]}