{"id":12050,"title":"27 | 在Kotlin 中使用协程","content":"<h1>源代码及 PDF 课件地址：</h1><p><strong><a href=\"https://gitee.com/geektime-geekbang/KotlinPrimer\">https://gitee.com/geektime-geekbang/KotlinPrimer</a></strong></p>","comments":[{"had_liked":false,"id":21088,"user_name":"Leo66","can_delete":false,"product_type":"c3","uid":1088741,"ip_address":"","ucode":"FC12D932CAAC65","user_header":"https://static001.geekbang.org/account/avatar/00/10/9c/e5/5ba793ec.jpg","comment_is_top":false,"comment_ctime":1534906097,"is_pvip":false,"replies":[{"id":7543,"content":"因为job2还await了500ms也计算在main中，所以main其实是1800ms","user_name":"作者回复","user_name_real":"kymjs张涛","uid":1009146,"ctime":1535018898,"ip_address":"","comment_id":21088,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100009801,"comment_content":"涛哥，挂起中3应该是第1500ms打印的log，main:主线程等待中应该是1300ms打印，为啥挂起中3在前面执行呢","like_count":4,"discussions":[{"author":{"id":1009146,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/65/fa/2b4d2f26.jpg","nickname":"kymjs张涛","note":"","ucode":"EFE7AF4C0D4FE8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":422529,"discussion_content":"因为job2还await了500ms也计算在main中，所以main其实是1800ms","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1535018898,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50379,"user_name":"蚂蚁内推+v","can_delete":false,"product_type":"c3","uid":1050508,"ip_address":"","ucode":"24B10AEE54B3FD","user_header":"https://static001.geekbang.org/account/avatar/00/10/07/8c/0d886dcc.jpg","comment_is_top":false,"comment_ctime":1544964454,"is_pvip":false,"replies":[{"id":19071,"content":"是的，协程库现在已经发正式版了，有一些小改动，可以用launch替代","user_name":"作者回复","user_name_real":"kymjs张涛","uid":1009146,"ctime":1545380434,"ip_address":"","comment_id":50379,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100009801,"comment_content":"协程库 1.0.1 没 runblocking\n","like_count":1,"discussions":[{"author":{"id":1009146,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/65/fa/2b4d2f26.jpg","nickname":"kymjs张涛","note":"","ucode":"EFE7AF4C0D4FE8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432961,"discussion_content":"是的，协程库现在已经发正式版了，有一些小改动，可以用launch替代","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545380434,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":294435,"user_name":"near","can_delete":false,"product_type":"c3","uid":1870563,"ip_address":"","ucode":"09DE24BAEA38A6","user_header":"https://static001.geekbang.org/account/avatar/00/1c/8a/e3/c967e11a.jpg","comment_is_top":false,"comment_ctime":1621940891,"is_pvip":false,"replies":[{"id":109141,"content":"okhttp支持异步线程调同步接口的","user_name":"作者回复","user_name_real":"kymjs张涛","uid":1009146,"ctime":1625700748,"ip_address":"","comment_id":294435,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100009801,"comment_content":"有个问题，一般用三方网络请求sdk，比如okhttp，里面的请求都在子线程中运行的，如果在协程中用okhttp请求的话，是不是等于在协程中再开线程，这样协程的优势在哪里？okhttp请求返回后，又是如何返回协程中的？","like_count":0,"discussions":[{"author":{"id":1009146,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/65/fa/2b4d2f26.jpg","nickname":"kymjs张涛","note":"","ucode":"EFE7AF4C0D4FE8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520652,"discussion_content":"okhttp支持异步线程调同步接口的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625700748,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":82712,"user_name":"helloworld","can_delete":false,"product_type":"c3","uid":1101762,"ip_address":"","ucode":"003700A99A910B","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/c2/a5b3ceaf.jpg","comment_is_top":false,"comment_ctime":1554282608,"is_pvip":false,"replies":[{"id":42508,"content":"runblock会阻塞当前协程，会首先执行这里面的内容","user_name":"作者回复","user_name_real":"kymjs张涛","uid":1009146,"ctime":1563807636,"ip_address":"","comment_id":82712,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100009801,"comment_content":"涛哥，\nfun main()  {\n    runBlocking {\n        launch {\n            delay(2000)\n            println(&quot;hello&quot;)\n        }\n\n        coroutineScope {\n            launch {\n                delay(3000)\n                println(&quot;coroutineScope launch&quot;)\n            }\n\n            delay(1000)\n            println(&quot;coroutineScope&quot;)\n        }\n\n        println(&quot;world&quot;)\n    }\n\n\n}\n这个的输出顺序是：\ncoroutineScope\nhello\ncoroutineScope launch\nworld\n我的问题是，我为什么“world”最后输出，而不是第一个输出","like_count":0,"discussions":[{"author":{"id":1009146,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/65/fa/2b4d2f26.jpg","nickname":"kymjs张涛","note":"","ucode":"EFE7AF4C0D4FE8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445695,"discussion_content":"runblock会阻塞当前协程，会首先执行这里面的内容","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563807636,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":23566,"user_name":"ccy","can_delete":false,"product_type":"c3","uid":1173924,"ip_address":"","ucode":"05245424E536AA","user_header":"","comment_is_top":false,"comment_ctime":1536498613,"is_pvip":false,"replies":[{"id":8656,"content":"main中调用了delay，自己动手敲一下就知道了","user_name":"作者回复","user_name_real":"kymjs张涛","uid":1009146,"ctime":1536635274,"ip_address":"","comment_id":23566,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100009801,"comment_content":"job2不是异步的吗？为什么时间会算在main里？如果这样，那后面几节里讲到的getHtml协程方法耗时不也是算在main里了吗？","like_count":0,"discussions":[{"author":{"id":1009146,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/65/fa/2b4d2f26.jpg","nickname":"kymjs张涛","note":"","ucode":"EFE7AF4C0D4FE8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423618,"discussion_content":"main中调用了delay，自己动手敲一下就知道了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1536635274,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":319616,"user_name":"Geek_fba3f9","can_delete":false,"product_type":"c3","uid":2825983,"ip_address":"","ucode":"23C56BEB3E65ED","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/F4wluvVn7PE5nUyHptWZTIuCdKHicWybrmrrb8hd9IKw8ialyaKSMkMvHiboHn4VlPiaq3B7VgA7k6xNznTAuhj04A/132","comment_is_top":false,"comment_ctime":1635865123,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100009801,"comment_content":"这里的介绍有点问题，在kotlin中，协程是建立在线程之上的，kotlin中 启动一个协程执行一段代码，最终是映射在java线程上执行的","like_count":2},{"had_liked":false,"id":185744,"user_name":"大木","can_delete":false,"product_type":"c3","uid":1141518,"ip_address":"","ucode":"6664E525C54A28","user_header":"https://static001.geekbang.org/account/avatar/00/11/6b/0e/37605758.jpg","comment_is_top":false,"comment_ctime":1583673774,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100009801,"comment_content":"协程库1.3 貌似 runBlocking 又回来了？","like_count":0}]}