{"id":464856,"title":"43ï½œç”Ÿäº§ç¯å¢ƒï¼šçœŸå®ä¸–ç•Œä¸‹çš„ä¸€ä¸ªRusté¡¹ç›®åŒ…å«å“ªäº›è¦ç´ ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é™ˆå¤©ã€‚</p><p>éšç€æˆ‘ä»¬çš„å®æˆ˜é¡¹ç›® KV server æ¥è¿‘å°¾å£°ï¼Œè¯¾ç¨‹ä¹Ÿåˆ°äº†æ”¶å®˜é˜¶æ®µã€‚æŒæ¡ä¸€é—¨è¯­è¨€çš„ç‰¹æ€§ï¼Œèƒ½å†™å‡ºåº”ç”¨è¿™äº›ç‰¹æ€§è§£å†³ä¸€äº›å°é—®é¢˜çš„ä»£ç ï¼Œç®—æ˜¯åˆçª¥é—¨å¾„ï¼Œå°±åƒåœ¨æ¸¸æ³³æ± é‡Œç»ƒä¹ å†²æµªï¼›çœŸæ­£æƒ³æŠŠè¯­è¨€èä¼šè´¯é€šï¼Œè¿˜è¦é å¤§é£å¤§æµªä¸­çš„ç£¨ç»ƒã€‚æ‰€ä»¥æ¥ä¸‹æ¥çš„ä¸‰ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬ä¼šåé‡äº†è§£çœŸå®çš„ Rust åº”ç”¨ç¯å¢ƒï¼Œçœ‹çœ‹å¦‚ä½•ç”¨ Rust æ„å»ºå¤æ‚çš„è½¯ä»¶ç³»ç»Ÿã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥å­¦ä¹ çœŸå®ä¸–ç•Œä¸‹çš„ä¸€ä¸ª Rust é¡¹ç›®ï¼Œåº”è¯¥åŒ…å«å“ªäº›è¦ç´ ã€‚ä¸»è¦ä»‹ç»å’Œå¼€å‘é˜¶æ®µç›¸å…³çš„å†…å®¹ï¼ŒåŒ…æ‹¬ï¼šä»£ç ä»“åº“çš„ç®¡ç†ã€æµ‹è¯•å’ŒæŒç»­é›†æˆã€æ–‡æ¡£ã€ç‰¹æ€§ç®¡ç†ã€ç¼–è¯‘æœŸå¤„ç†ã€æ—¥å¿—å’Œç›‘æ§ï¼Œæœ€åä¼šé¡ºä¾¿ä»‹ç»ä¸€ä¸‹å¦‚ä½•æ§åˆ¶ Rust ä»£ç ç¼–è¯‘å‡ºçš„å¯æ‰§è¡Œæ–‡ä»¶çš„å¤§å°ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/5c/69/5ca01caa4c92ae2b595927b32f5cba69.jpg?wh=1920x1145\" alt=\"å›¾ç‰‡\"></p><h2>ä»£ç ä»“åº“çš„ç®¡ç†</h2><p>æˆ‘ä»¬å…ˆä»ä¸€ä¸ªä»£ç ä»“åº“çš„ç»“æ„å’Œç®¡ç†å…¥æ‰‹ã€‚ä¹‹å‰ä»‹ç»è¿‡ï¼ŒRust æ”¯æŒ workspaceï¼Œå¯ä»¥åœ¨ä¸€ä¸ª workspace ä¸‹æ”¾ç½®å¾ˆå¤š cratesã€‚ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰å‘ç°ï¼Œè¿™é—¨è¯¾ç¨‹åœ¨GitHub ä¸Šçš„ repoï¼Œå°±æŠŠæ¯èŠ‚è¯¾çš„ä»£ç ç»„ç»‡æˆä¸€ä¸ªä¸ª crateï¼Œæ”¾åœ¨åŒä¸€ä¸ª workspace ä¸­ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/2b/62/2bf542e266197e04ededc5c4a6e6cf62.jpg?wh=1920x1134\" alt=\"å›¾ç‰‡\"></p><p>åœ¨æ„å»ºåº”ç”¨ç¨‹åºæˆ–è€…æœåŠ¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦å°½é‡æŠŠå„ä¸ªæ¨¡å—åˆ’åˆ†æ¸…æ¥šï¼Œç„¶åç”¨ä¸åŒçš„ crate å®ç°å®ƒä»¬ã€‚è¿™æ ·ï¼Œä¸€æ¥å¢é‡ç¼–è¯‘çš„æ•ˆç‡æ›´é«˜ï¼ˆæ²¡æœ‰æ”¹åŠ¨çš„ crate æ— éœ€é‡ç¼–ï¼‰ï¼ŒäºŒæ¥å¯ä»¥é€šè¿‡ crate å¼ºåˆ¶ä¸ºæ¨¡å—åˆ’åˆ†è¾¹ç•Œï¼Œæ˜ç¡®å…¬å¼€çš„æ¥å£å’Œç§æœ‰æ¥å£ã€‚</p><!-- [[[read_end]]] --><p>ä¸€èˆ¬è€Œè¨€ï¼Œé™¤äº†ä»£ç ä»“åº“çš„æ ¹ç›®å½•æœ‰ <a href=\"http://README.md\">README.md</a> å¤–ï¼Œworkspace ä¸‹çš„æ¯ä¸ª crate ä¹Ÿæœ€å¥½è¦æœ‰ <a href=\"http://README.md\">README.md</a> ä»¥åŠ examplesï¼Œè®©ä½¿ç”¨è€…å¯ä»¥å¾ˆæ¸…æ™°åœ°ç†è§£å¦‚ä½•ä½¿ç”¨è¿™ä¸ª crateã€‚å¦‚æœä½ çš„é¡¹ç›®çš„æ„å»ºè¿‡ç¨‹ä¸æ˜¯ç®€å•é€šè¿‡ cargo build å®Œæˆçš„ï¼Œå»ºè®®æä¾› Makefile æˆ–è€…ç±»ä¼¼çš„è„šæœ¬æ¥è‡ªåŠ¨åŒ–æœ¬åœ°æ„å»ºçš„æµç¨‹ã€‚</p><p>å½“æˆ‘ä»¬å¾€ä»£ç ä»“åº“é‡Œæäº¤ä»£ç æ—¶ï¼Œåº”è¯¥è¦åœ¨æœ¬åœ°èµ°ä¸€éåŸºæœ¬çš„æ£€æŸ¥ï¼ŒåŒ…æ‹¬ä»£ç é£æ ¼æ£€æŸ¥ã€ç¼–è¯‘æ£€æŸ¥ã€é™æ€æ£€æŸ¥ï¼Œä»¥åŠå•å…ƒæµ‹è¯•ï¼Œè¿™æ ·å¯ä»¥æœ€å¤§ç¨‹åº¦ä¿è¯æ¯ä¸ªæäº¤éƒ½æ˜¯å®Œå¤‡çš„ï¼Œæ²¡æœ‰åŸºæœ¬é”™è¯¯çš„ä»£ç ã€‚</p><p>å¦‚æœä½ ä½¿ç”¨ Git æ¥ç®¡ç†ä»£ç ä»“åº“ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ pre-commit hookã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ä¸å¿…è‡ªå·±æ’°å†™ pre-commit hook è„šæœ¬ï¼Œå¯ä»¥ä½¿ç”¨ <a href=\"https://pre-commit.com/\">pre-commit</a> è¿™ä¸ªå·¥å…·ã€‚ä¸‹é¢æ˜¯æˆ‘åœ¨ <a href=\"https://github.com/tyrchen/geektime-rust\">tyrchen/geektime-rust</a> ä¸­ä½¿ç”¨çš„ pre-commit é…ç½®ï¼Œä¾›ä½ å‚è€ƒï¼š</p><pre><code class=\"language-yaml\">â¯ cat .pre-commit-config.yaml\nfail_fast: false\nrepos:\n  - repo: &lt;https://github.com/pre-commit/pre-commit-hooks&gt;\n    rev: v2.3.0\n    hooks:\n      - id: check-byte-order-marker\n      - id: check-case-conflict\n      - id: check-merge-conflict\n      - id: check-symlinks\n      - id: check-yaml\n      - id: end-of-file-fixer\n      - id: mixed-line-ending\n      - id: trailing-whitespace\n  - repo: &lt;https://github.com/psf/black&gt;\n    rev: 19.3b0\n    hooks:\n      - id: black\n  - repo: local\n    hooks:\n      - id: cargo-fmt\n        name: cargo fmt\n        description: Format files with rustfmt.\n        entry: bash -c 'cargo fmt -- --check'\n        language: rust\n        files: \\\\.rs$\n        args: []\n      - id: cargo-check\n        name: cargo check\n        description: Check the package for errors.\n        entry: bash -c 'cargo check --all'\n        language: rust\n        files: \\\\.rs$\n        pass_filenames: false\n      - id: cargo-clippy\n        name: cargo clippy\n        description: Lint rust sources\n        entry: bash -c 'cargo clippy --all-targets --all-features --tests --benches -- -D warnings'\n        language: rust\n        files: \\\\.rs$\n        pass_filenames: false\n      - id: cargo-test\n        name: cargo test\n        description: unit test for the project\n        entry: bash -c 'cargo test --all-features --all'\n        language: rust\n        files: \\\\.rs$\n        pass_filenames: false\n</code></pre><p>ä½ åœ¨æ ¹ç›®å½•ç”Ÿæˆ .pre-commit-config.yaml åï¼Œè¿è¡Œ pre-commit installï¼Œä»¥å git commit æ—¶å°±ä¼šè‡ªåŠ¨åšè¿™ä¸€ç³»åˆ—çš„æ£€æŸ¥ï¼Œä¿è¯æäº¤ä»£ç çš„æœ€åŸºæœ¬çš„æ­£ç¡®æ€§ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œä½ çš„ä»£ç ä»“åº“åœ¨æ ¹ç›®å½•ä¸‹æœ€å¥½è¿˜å£°æ˜ä¸€ä¸ª deny.tomlï¼Œä½¿ç”¨ <a href=\"https://github.com/EmbarkStudios/cargo-deny\">cargo-deny</a> æ¥ç¡®ä¿ä½ ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹ä¾èµ–æ²¡æœ‰ä¸è¯¥å‡ºç°çš„æˆæƒï¼ˆæ¯”å¦‚ä¸ä½¿ç”¨ä»»ä½• GPL/APGL çš„ä»£ç ï¼‰ã€æ²¡æœ‰å¯ç–‘çš„æ¥æºï¼ˆæ¯”å¦‚ä¸æ˜¯æ¥è‡ªæŸä¸ª fork çš„ GitHub repo ä¸‹çš„ commitï¼‰ï¼Œä»¥åŠæ²¡æœ‰åŒ…å«æœ‰å®‰å…¨æ¼æ´çš„ç‰ˆæœ¬ã€‚</p><p>cargo-deny å¯¹äºç”Ÿäº§ç¯å¢ƒä¸‹çš„ä»£ç éå¸¸é‡è¦ï¼Œå› ä¸ºç°ä»£è½¯ä»¶ä¾èµ–å¤ªå¤šï¼Œä¾èµ–æ ‘è¿‡äºåºæ‚ï¼Œé äººçœ¼æ˜¯å¾ˆéš¾å®¡æŸ¥å‡ºé—®é¢˜çš„ã€‚é€šè¿‡ä½¿ç”¨ cargo-denyï¼Œæˆ‘ä»¬å¯ä»¥é¿å…å¾ˆå¤šæœ‰é£é™©çš„ç¬¬ä¸‰æ–¹åº“ã€‚</p><h2>æµ‹è¯•å’ŒæŒç»­é›†æˆ</h2><p>åœ¨è¯¾ç¨‹é‡Œï¼Œæˆ‘ä»¬ä¸æ–­åœ°åœ¨é¡¹ç›®ä¸­å¼ºè°ƒå•å…ƒæµ‹è¯•çš„é‡è¦æ€§ã€‚å•å…ƒæµ‹è¯•é™¤äº†æ˜¯è½¯ä»¶è´¨é‡ä¿è¯çš„å¿…è¦æ‰‹æ®µå¤–ï¼Œè¿˜æ˜¯æ¥å£è®¾è®¡å’Œè¿­ä»£çš„æœ€ä½³è¾…åŠ©å·¥å…·ã€‚</p><p>è‰¯å¥½çš„æ¶æ„ã€æ¸…æ™°çš„æ¥å£éš”ç¦»ï¼Œå¿…ç„¶ä¼šè®©å•å…ƒæµ‹è¯•å˜å¾—å®¹æ˜“ç›´è§‚ï¼›è€Œå†™èµ·æ¥åˆ«æ‰­ï¼Œç”šè‡³æ„Ÿè§‰å¾ˆéš¾æ’°å†™çš„å•å…ƒæµ‹è¯•ï¼Œåˆ™æ˜¯åœ¨è­¦å‘Šä½ è½¯ä»¶çš„æ¶æ„æˆ–è€…è®¾è®¡å‡ºäº†é—®é¢˜ï¼š<strong>è¦ä¹ˆæ˜¯æ¨¡å—ä¹‹é—´è€¦åˆæ€§å¤ªå¼ºï¼ˆçŠ¶æ€çº ç¼ ä¸æ¸…ï¼‰ï¼Œè¦ä¹ˆæ˜¯æ¥å£è®¾è®¡å¾—å¾ˆéš¾ä½¿ç”¨</strong>ã€‚</p><p>åœ¨ Rust ä¸‹æ’°å†™å•å…ƒæµ‹è¯•éå¸¸ç›´è§‚ï¼Œæµ‹è¯•ä»£ç å’Œæ¨¡å—ä»£ç æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œå¾ˆå®¹æ˜“é˜…è¯»å’Œäº’ç›¸å°è¯ã€‚æˆ‘ä»¬ä¹‹å‰å·²ç»å†™è¿‡å¤§é‡è¿™ç±»çš„å•å…ƒæµ‹è¯•ã€‚</p><p>ä¸è¿‡è¿˜æœ‰ä¸€ç§å•å…ƒæµ‹è¯•æ˜¯å’Œæ–‡æ¡£æ”¾åœ¨ä¸€èµ·çš„ï¼Œdoctestï¼Œå¦‚æœä½ åœ¨å­¦ä¹ è¿™é—¨è¯¾çš„è¿‡ç¨‹ä¸­å·²ç»ä¹ æƒ¯é‡åˆ°é—®é¢˜å°±å»çœ‹æºä»£ç çš„è¯ï¼Œä¼šçœ‹åˆ°å¾ˆå¤šç±»ä¼¼è¿™æ ·çš„ doctestï¼Œæ¯”å¦‚ä¸‹é¢çš„ <a href=\"https://doc.rust-lang.org/src/std/collections/hash/map.rs.html#713-737\">HashMap::get</a> æ–¹æ³•çš„ doctestï¼š</p><pre><code class=\"language-rust\">/// Returns a reference to the value corresponding to the key.\n///\n/// The key may be any borrowed form of the map's key type, but\n/// [`Hash`] and [`Eq`] on the borrowed form *must* match those for\n/// the key type.\n///\n/// # Examples\n///\n/// ```\n/// use std::collections::HashMap;\n///\n/// let mut map = HashMap::new();\n/// map.insert(1, \"a\");\n/// assert_eq!(map.get(&amp;1), Some(&amp;\"a\"));\n/// assert_eq!(map.get(&amp;2), None);\n/// ```\n#[stable(feature = \"rust1\", since = \"1.0.0\")]\n#[inline]\npub fn get&lt;Q: ?Sized&gt;(&amp;self, k: &amp;Q) -&gt; Option&lt;&amp;V&gt;\nwhere\n    K: Borrow&lt;Q&gt;,\n    Q: Hash + Eq,\n{\n    self.base.get(k)\n}\n</code></pre><p>åœ¨ä¹‹å‰çš„ä»£ç ä¸­ï¼Œè™½ç„¶æˆ‘ä»¬æ²¡æœ‰æ˜ç¡®ä»‹ç»æ–‡æ¡£æ³¨é‡Šï¼Œä½†æƒ³å¿…ä½ å·²ç»çŸ¥é“ï¼Œå¯ä»¥é€šè¿‡ â€œ///â€ æ¥æ’°å†™æ•°æ®ç»“æ„ã€traitã€æ–¹æ³•å’Œå‡½æ•°çš„æ–‡æ¡£æ³¨é‡Šã€‚</p><p>è¿™æ ·çš„æ³¨é‡Šå¯ä»¥ç”¨ markdown æ ¼å¼æ’°å†™ï¼Œä¹‹åé€šè¿‡ â€œcargo docâ€ ç¼–è¯‘æˆç±»ä¼¼ä½ åœ¨ <a href=\"http://docs.rs\">docs.rs</a> ä¸‹çœ‹åˆ°çš„æ–‡æ¡£ã€‚å…¶ä¸­ï¼Œmarkdown é‡Œçš„ä»£ç å°±ä¼šè¢«ç¼–è¯‘æˆ doctestï¼Œç„¶ååœ¨ â€œcargo testâ€ ä¸­è¿›è¡Œæµ‹è¯•ã€‚</p><p>é™¤äº†å•å…ƒæµ‹è¯•ï¼Œæˆ‘ä»¬å¾€å¾€è¿˜éœ€è¦é›†æˆæµ‹è¯•å’Œæ€§èƒ½æµ‹è¯•ã€‚åœ¨åç»­ KV server çš„å®ç°è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šå¼•å…¥é›†æˆæµ‹è¯•æ¥æµ‹è¯•æœåŠ¡å™¨çš„åŸºæœ¬åŠŸèƒ½ï¼Œä»¥åŠæ€§èƒ½æµ‹è¯•æ¥æµ‹è¯• pub/sub çš„æ€§èƒ½ã€‚è¿™ä¸ªåœ¨é‡åˆ°çš„æ—¶å€™å†è¯¦ç»†ä»‹ç»ã€‚</p><p>åœ¨ä¸€ä¸ªé¡¹ç›®çš„æ—©æœŸï¼Œå¼•å…¥æŒç»­é›†æˆéå¸¸å¿…è¦ï¼Œå“ªæ€•è¿˜æ²¡æœ‰å…¨é¢çš„æµ‹è¯•è¦†ç›–ã€‚</p><p>å¦‚æœè¯´ pre-commit æ˜¯æ¯ä¸ªäººæäº¤ä»£ç çš„ä¸€é“å®ˆå«ï¼Œé¿å…ä¸€äº›åŸºæœ¬çš„é”™è¯¯è¿›å…¥åˆ°ä»£ç åº“ï¼Œè®©å¤§å®¶åœ¨å›¢é˜Ÿåä½œåšä»£ç å®¡é˜…æ—¶ï¼Œä¸è‡³äºè¿˜éœ€è¦å…³æ³¨åŸºæœ¬çš„ä»£ç æ ¼å¼ï¼›é‚£ä¹ˆï¼Œ<strong>æŒç»­é›†æˆå°±æ˜¯åœ¨å›¢é˜Ÿåä½œè¿‡ç¨‹ä¸­çš„ä¸€é“å®ˆå«ï¼Œä¿è¯æ·»åŠ åˆ° PR é‡Œæˆ–è€…åˆå¹¶åˆ° master ä¸‹çš„ä»£ç ï¼Œåœ¨ç‰¹å®šçš„ç¯å¢ƒä¸‹ï¼Œä¹Ÿæ˜¯æ²¡æœ‰é—®é¢˜çš„</strong>ã€‚</p><p>å¦‚æœä½ ç”¨ GitHub æ¥ç®¡ç†ä»£ç ä»“åº“ï¼Œå¯ä»¥ä½¿ç”¨ github workflow æ¥è¿›è¡ŒæŒç»­é›†æˆï¼Œæ¯”å¦‚ä¸‹é¢æ˜¯ä¸€ä¸ªæœ€åŸºæœ¬çš„ Rust github workflow çš„å®šä¹‰ï¼š</p><pre><code class=\"language-yaml\">â¯ cat .github/workflows/build.yml\nname: build\n\non:\n  push:\n    branches:\n      - master\n  pull_request:\n    branches:\n      - master\n\njobs:\n  build-rust:\n    strategy:\n      matrix:\n        platform: [ubuntu-latest, windows-latest]\n    runs-on: ${{ matrix.platform }}\n    steps:\n      - uses: actions/checkout@v2\n      - name: Cache cargo registry\n        uses: actions/cache@v1\n        with:\n          path: ~/.cargo/registry\n          key: ${{ runner.os }}-cargo-registry\n      - name: Cache cargo index\n        uses: actions/cache@v1\n        with:\n          path: ~/.cargo/git\n          key: ${{ runner.os }}-cargo-index\n      - name: Cache cargo build\n        uses: actions/cache@v1\n        with:\n          path: target\n          key: ${{ runner.os }}-cargo-build-target\n      - name: Install stable\n        uses: actions-rs/toolchain@v1\n        with:\n          profile: minimal\n          toolchain: stable\n          override: true\n      - name: Check code format\n        run: cargo fmt -- --check\n      - name: Check the package for errors\n        run: cargo check --all\n      - name: Lint rust sources\n        run: cargo clippy --all-targets --all-features --tests --benches -- -D warnings\n      - name: Run tests\n        run: cargo test --all-features -- --test-threads=1 --nocapture\n      - name: Generate docs\n        run: cargo doc --all-features --no-deps\n</code></pre><p>æˆ‘ä»¬ä¼šå¤„ç†ä»£ç æ ¼å¼ï¼ŒåšåŸºæœ¬çš„é™æ€æ£€æŸ¥ã€å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ï¼Œä»¥åŠç”Ÿæˆæ–‡æ¡£ã€‚</p><h2>æ–‡æ¡£</h2><p>å‰é¢è¯´äº†ï¼ŒRust ä»£ç çš„æ–‡æ¡£æ³¨é‡Šå¯ä»¥ç”¨ â€œ///â€ æ¥æ ‡æ³¨ã€‚å¯¹äºæˆ‘ä»¬ä¸Šä¸€è®² KV server çš„ä»£ç ï¼Œå¯ä»¥è¿è¡Œ â€œcargo docâ€ æ¥ç”Ÿæˆå¯¹åº”çš„æ–‡æ¡£ã€‚</p><p>æ³¨æ„ï¼Œåœ¨ cargo doc æ—¶ï¼Œä¸å…‰ä½ è‡ªå·±æ’°å†™çš„ crate çš„æ–‡æ¡£ä¼šè¢«ç”Ÿæˆï¼Œæ‰€æœ‰åœ¨ä¾èµ–é‡Œä½¿ç”¨åˆ°çš„ crate çš„æ–‡æ¡£ä¹Ÿä¼šä¸€å¹¶ç”Ÿæˆï¼Œæ‰€ä»¥å¦‚æœä½ æƒ³åœ¨æ²¡æœ‰ç½‘çš„æƒ…å†µä¸‹ï¼Œå‚è€ƒæŸäº›å¼•ç”¨äº†çš„ crate æ–‡æ¡£ï¼Œå¯ä»¥çœ‹æœ¬åœ°ç”Ÿæˆçš„æ–‡æ¡£ã€‚ä¸‹å›¾æ˜¯ä¸Šä¸€è®²çš„ KV server æ–‡æ¡£çš„æˆªå›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/d7/dd/d7f9b262b28c5a4aa15ef15997f0dfdd.png?wh=1920x1413\" alt=\"å›¾ç‰‡\"></p><p>å¤§å¤šæ•°æ—¶å€™ï¼Œä½ åªéœ€è¦ä½¿ç”¨ â€œ///â€ æ¥æ’°å†™æ–‡æ¡£å°±å¤Ÿç”¨äº†ï¼Œä¸è¿‡å¦‚æœä½ éœ€è¦æ’°å†™ crate çº§åˆ«çš„æ–‡æ¡£ï¼Œä¹Ÿå°±æ˜¯ä¼šæ˜¾ç¤ºåœ¨ crate æ–‡æ¡£ä¸»é¡µä¸Šçš„å†…å®¹ï¼Œå¯ä»¥åœ¨ <a href=\"http://lib.rs\">lib.rs</a> æˆ–è€… <a href=\"http://main.rs\">main.rs</a> çš„å¼€å¤´ç”¨ â€œ//!â€ï¼Œæ¯”å¦‚ï¼š</p><pre><code class=\"language-rust\">//! è¿™æ˜¯ crate æ–‡æ¡£\n</code></pre><p>å¦‚æœä½ æƒ³å¼ºè¿«è‡ªå·±è¦æ’°å†™æ¯ä¸ªå…¬å…±æ¥å£çš„æ–‡æ¡£ï¼Œä¿æŒç³»ç»Ÿæœ‰è‰¯å¥½çš„æ–‡æ¡£è¦†ç›–ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ <code>![deny(missing_docs)]</code>ã€‚è¿™æ ·ï¼Œä»»ä½•æ—¶å€™åªè¦ä½ å¿˜è®°æ’°å†™æ–‡æ¡£ï¼Œéƒ½ä¼šäº§ç”Ÿç¼–è¯‘é”™è¯¯ã€‚å¦‚æœä½ è§‰å¾—ç¼–è¯‘é”™è¯¯å¤ªä¸¥æ ¼ï¼Œä¹Ÿå¯ä»¥ç”¨ç¼–è¯‘æŠ¥è­¦ï¼š<code>![warn(missing_docs]</code>ã€‚ä¹‹å‰æˆ‘ä»¬é˜…è¯»è¿‡ bytes crate çš„æºç ï¼Œå¯ä»¥å†å›è¿‡å¤´æ¥çœ‹çœ‹å®ƒçš„ <a href=\"https://github.com/tokio-rs/bytes/blob/master/src/lib.rs\">lib.rs çš„å¼€å¤´</a>ã€‚<br>\nåœ¨ä»‹ç»æµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬æåˆ°äº†æ–‡æ¡£æµ‹è¯•ã€‚</p><p>åœ¨æ–‡æ¡£ä¸­æ’°å†™æ ·ä¾‹ä»£ç å¹¶ä¿è¯è¿™ä¸ªæ ·ä¾‹ä»£ç å¯ä»¥æ­£å¸¸è¿è¡Œéå¸¸é‡è¦ï¼Œå› ä¸ºä½¿ç”¨è€…åœ¨çœ‹ä½ çš„ crate æ–‡æ¡£æ—¶ï¼Œå¾€å¾€å…ˆä¼šå‚è€ƒä½ çš„æ ·ä¾‹ä»£ç ï¼Œäº†è§£æ¥å£å¦‚ä½•ä½¿ç”¨ã€‚å¤§éƒ¨åˆ†æ—¶å€™ï¼Œä½ çš„æ ·ä¾‹ä»£ç è¯¥æ€ä¹ˆå†™å°±æ€ä¹ˆå†™ï¼Œ<strong>ä½†æ˜¯ï¼Œåœ¨è¿›è¡Œå¼‚æ­¥å¤„ç†å’Œé”™è¯¯å¤„ç†æ—¶ï¼Œéœ€è¦ç¨å¾®åšä¸€äº›é¢å¤–å·¥ä½œ</strong>ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæ–‡æ¡£é‡Œå¼‚æ­¥å¤„ç†çš„ä¾‹å­ï¼ˆ<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=70dad7f47ea1c6d58454e6bc5e2cabb9\">ä»£ç </a>ï¼‰ï¼š</p><pre><code class=\"language-rust\">use std::task::Poll;\nuse futures::{prelude::*, stream::poll_fn};\n\n/// fibnacci ç®—æ³•\n/// ç¤ºä¾‹ï¼š\n/// ```\n/// use futures::prelude::*;\n/// use playground::fib; // playground crate åå­—å« playground\n/// # futures::executor::block_on(async {\n/// let mut st = fib(10);\n/// assert_eq!(Some(2), st.next().await);\n/// # });\n/// ```\npub fn fib(mut n: usize) -&gt; impl Stream&lt;Item = i32&gt; {\n    let mut a = 1;\n    let mut b = 1;\n    poll_fn(move |_cx| -&gt; Poll&lt;Option&lt;i32&gt;&gt; {\n        if n == 0 {\n            return Poll::Ready(None);\n        }\n        n -= 1;\n        let c = a + b;\n        a = b;\n        b = c;\n        Poll::Ready(Some(b))\n    })\n}\n</code></pre><p>æ³¨æ„è¿™æ®µä»£ç ä¸­çš„è¿™ä¸¤å¥æ³¨é‡Šï¼š</p><pre><code class=\"language-rust\">/// # futures::executor::block_on(async {\n/// ...\n/// # });\n</code></pre><p>åœ¨ <code>///</code> åå‡ºç°äº† <code>#</code>ï¼Œä»£è¡¨è¿™å¥è¯ä¸ä¼šå‡ºç°åœ¨ç¤ºä¾‹ä¸­ï¼Œä½†ä¼šè¢«åŒ…æ‹¬åœ¨ç”Ÿæˆçš„æµ‹è¯•ä»£ç ä¸­ã€‚ä¹‹æ‰€ä»¥éœ€è¦ <code>block_on</code>ï¼Œæ˜¯å› ä¸ºè°ƒç”¨æˆ‘ä»¬çš„æµ‹è¯•ä»£ç æ—¶ï¼Œéœ€è¦ä½¿ç”¨ awaitï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨å¼‚æ­¥è¿è¡Œæ—¶æ¥è¿è¡Œå®ƒã€‚</p><p>å®é™…ä¸Šï¼Œè¿™ä¸ªçš„æ–‡æ¡£æµ‹è¯•ç›¸å½“äºï¼š</p><pre><code class=\"language-rust\">fn main() {\n    fn _doctest_main_xxx() {\n        use futures::prelude::*;\n        use playground::fib; // playground crate åå­—å« playground\n\n        futures::executor::block_on(async {\n            let mut st = fib(10);\n            assert_eq!(Some(2), st.next().await);\n        });\n    }\n    _doctest_main_xxx()\n}\n</code></pre><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªæ–‡æ¡£ä¸­åšé”™è¯¯å¤„ç†çš„ä¾‹å­ï¼ˆ<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2021&amp;gist=ffe46d7ee705ba3a8b570c5ca9f547a2\">ä»£ç </a>ï¼‰ï¼š</p><pre><code class=\"language-rust\">use std::io;\nuse std::fs;\n\n/// å†™å…¥æ–‡ä»¶\n/// ç¤ºä¾‹ï¼š\n/// ```\n/// use playground::write_file;\n/// write_file(\"/tmp/dummy_test\", \"hello world\")?;\n/// # Ok::&lt;_, std::io::Error&gt;(())\n/// ```\npub fn write_file(name: &amp;str, contents: &amp;str) -&gt; Result&lt;(), io::Error&gt; {\n    fs::write(name, contents)\n}\n</code></pre><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>?</code> è¿›è¡Œäº†é”™è¯¯å¤„ç†ï¼Œæ‰€ä»¥éœ€è¦æœ€åè¡¥ä¸€å¥ <code>Ok::&lt;_, io::Error&gt;</code> æ¥æ˜ç¡®è¿”å›çš„é”™è¯¯ç±»å‹ã€‚</p><p>å¦‚æœä½ æƒ³äº†è§£æ›´å¤šæœ‰å…³ Rust æ–‡æ¡£çš„å†…å®¹ï¼Œå¯ä»¥çœ‹ <a href=\"https://doc.rust-lang.org/stable/rustdoc/\">rustdoc book</a>ã€‚</p><h2>ç‰¹æ€§ç®¡ç†</h2><p>ä½œä¸ºä¸€é—¨ç¼–è¯‘å‹è¯­è¨€ï¼ŒRust æ”¯æŒæ¡ä»¶ç¼–è¯‘ã€‚</p><p>é€šè¿‡æ¡ä»¶ç¼–è¯‘ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åŒä¸€ä¸ª crate ä¸­æ”¯æŒä¸åŒçš„ç‰¹æ€§ï¼ˆfeatureï¼‰ï¼Œä»¥æ»¡è¶³ä¸åŒçš„éœ€æ±‚ã€‚æ¯”å¦‚ reqwestï¼Œå®ƒé»˜è®¤ä½¿ç”¨å¼‚æ­¥æ¥å£ï¼Œä½†å¦‚æœä½ éœ€è¦åŒæ­¥æ¥å£ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒçš„ â€œblockingâ€ ç‰¹æ€§ã€‚</p><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­åˆç†åœ°ä½¿ç”¨ç‰¹æ€§ï¼Œå¯ä»¥è®© crate çš„æ ¸å¿ƒåŠŸèƒ½å¼•å…¥è¾ƒå°‘çš„ä¾èµ–ï¼Œè€Œåªæœ‰åœ¨å¯åŠ¨æŸä¸ªç‰¹æ€§çš„æ—¶å€™ï¼Œæ‰ä½¿ç”¨æŸäº›ä¾èµ–ï¼Œè¿™æ ·å¯ä»¥è®©æœ€ç»ˆç¼–è¯‘å‡ºæ¥çš„åº“æˆ–è€…å¯æ‰§è¡Œæ–‡ä»¶å°½å¯èƒ½åœ°å°ã€‚</p><p>ç‰¹æ€§ä½œä¸ºé«˜çº§å·¥å…·ï¼Œå¹¶ä¸åœ¨æˆ‘ä»¬è¿™ä¸ªè¯¾ç¨‹çš„èŒƒå›´å†…ï¼Œæ„Ÿå…´è¶£çš„è¯ï¼Œä½ å¯ä»¥çœ‹ <a href=\"https://doc.rust-lang.org/cargo/reference/features.html\">cargo book</a> æ·±å…¥äº†è§£å¦‚ä½•åœ¨ä½ çš„ crate ä¸­ä½¿ç”¨ç‰¹æ€§ï¼Œä»¥åŠåœ¨ä»£ç æ’°å†™è¿‡ç¨‹ä¸­ï¼Œå¦‚ä½•ä½¿ç”¨ç›¸åº”çš„å®æ¥åšæ¡ä»¶ç¼–è¯‘ã€‚</p><h2>ç¼–è¯‘æœŸå¤„ç†</h2><p>åœ¨å¼€å‘è½¯ä»¶ç³»ç»Ÿçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘å“ªäº›äº‹æƒ…éœ€è¦æ”¾åœ¨ç¼–è¯‘æœŸå¤„ç†ï¼Œå“ªäº›äº‹æƒ…æ”¾åœ¨åŠ è½½æœŸå¤„ç†ï¼Œå“ªäº›äº‹æƒ…æ”¾åœ¨è¿è¡ŒæœŸå¤„ç†ã€‚</p><p>æœ‰äº›äº‹æƒ…ï¼Œæˆ‘ä»¬ä¸ä¸€å®šè¦æ”¾åœ¨è¿è¡ŒæœŸæ‰è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥åœ¨ç¼–è¯‘æœŸå°±åšä¸€äº›é¢„å¤„ç†ï¼Œè®©æ•°æ®èƒ½å¤Ÿä»¥æ›´å¥½çš„å½¢å¼åœ¨è¿è¡ŒæœŸè¢«ä½¿ç”¨ã€‚</p><p>æ¯”å¦‚åœ¨åšä¸­æ–‡ç¹ç®€è½¬æ¢çš„æ—¶å€™ï¼Œå¯ä»¥é¢„å…ˆæŠŠå•å­—å¯¹ç…§è¡¨ä»æ–‡ä»¶ä¸­è¯»å–å‡ºæ¥ï¼Œå¤„ç†æˆ <code>Vec&lt;(char, char)&gt;</code>ï¼Œç„¶åç”Ÿæˆ bincode å­˜å…¥åˆ°å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚æˆ‘ä»¬çœ‹è¿™ä¸ªä¾‹å­ï¼ˆ<a href=\"https://github.com/tyrchen/fast2s/blob/master/build.rs\">ä»£ç </a>ï¼‰ï¼š</p><pre><code class=\"language-rust\">use std::io::{self, BufRead};\nuse std::{env, fs::File, path::Path};\n\nfn main() {\n    // å¦‚æœ build.rs æˆ–è€…ç¹ç®€å¯¹ç…§è¡¨æ–‡ä»¶å˜åŒ–ï¼Œåˆ™é‡æ–°ç¼–è¯‘\n    println!(\"cargo:rerun-if-changed=build.rs\");\n    println!(\"cargo:rerun-if-changed=src/t2s.txt\");\n\n    // ç”Ÿæˆ OUT_DIR/map.bin ä¾› lib.rs è®¿é—®\n    let out_dir = env::var_os(\"OUT_DIR\").unwrap();\n    let out_file = Path::new(&amp;out_dir).join(\"map.bin\");\n    let f = File::create(&amp;out_file).unwrap();\n    let v = get_kv(\"src/t2s.txt\");\n    bincode::serialize_into(f, &amp;v).unwrap();\n}\n\n// æŠŠ split å‡ºæ¥çš„ &amp;str è½¬æ¢æˆ char\nfn s2c(s: &amp;str) -&gt; char {\n    let mut chars = s.chars();\n    let c = chars.next().unwrap();\n    assert!(chars.next().is_none());\n    assert!(c.len_utf8() == 3);\n    c\n}\n\n// è¯»å–æ–‡ä»¶ï¼ŒæŠŠæ¯ä¸€è¡Œç¹ç®€å¯¹ç…§çš„å­—ç¬¦ä¸²è½¬æ¢æˆ Vec&lt;(char, char)&gt;\nfn get_kv(filename: &amp;str) -&gt; Vec&lt;(char, char)&gt; {\n    let f = File::open(filename).unwrap();\n    let lines = io::BufReader::new(f).lines();\n    let mut v = Vec::with_capacity(4096);\n    for line in lines {\n        let line = line.unwrap();\n        let kv: Vec&lt;_&gt; = line.split(' ').collect();\n        v.push((s2c(kv[0]), s2c(kv[1])));\n    }\n\n    v\n}\n</code></pre><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬åœ¨ç¼–è¯‘æœŸé¢å¤–èŠ±è´¹äº†ä¸€äº›æ—¶é—´ï¼Œå´è®©è¿è¡ŒæœŸçš„ä»£ç å’Œå·¥ä½œå¤§å¤§ç®€åŒ–ï¼ˆ<a href=\"https://github.com/tyrchen/fast2s/blob/master/src/special.rs#L8\">ä»£ç </a>ï¼‰ï¼š</p><pre><code class=\"language-rust\">static MAP_DATA: &amp;[u8] = include_bytes!(concat!(env!(\"OUT_DIR\"), \"/map.bin\"));\n\nlazy_static! {\n    /// state machine for the translation\n    static ref MAP: HashMap&lt;char, char&gt; = {\n        let data: Vec&lt;(char, char)&gt; = bincode::deserialize(MAP_DATA).unwrap();\n        data.into_iter().collect()\n    };\n    ...\n}\n</code></pre><h2>æ—¥å¿—å’Œç›‘æ§</h2><p>æˆ‘ä»¬ç›®å‰æ’°å†™çš„é¡¹ç›®ï¼Œéƒ½è¿˜åªæœ‰å°‘é‡çš„æ—¥å¿—ã€‚ä½†å¯¹äºç”Ÿäº§ç¯å¢ƒä¸‹çš„é¡¹ç›®æ¥è¯´ï¼Œè¿™è¿œè¿œä¸å¤Ÿã€‚æˆ‘ä»¬éœ€è¦è¯¦å°½çš„ã€ä¸åŒçº§åˆ«çš„æ—¥å¿—ã€‚</p><p>è¿™æ ·ï¼Œå½“ç³»ç»Ÿåœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‡ºç°é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ—¥å¿—å¾—åˆ°è¶³å¤Ÿçš„çº¿ç´¢ï¼Œä»è€Œæ‰¾åˆ°é—®é¢˜çš„æºå¤´ï¼Œè¿›è€Œè§£å†³é—®é¢˜ã€‚è€Œä¸”åœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸‹ï¼Œæˆ‘ä»¬å¾€å¾€è¿˜éœ€è¦æŠŠæ”¶é›†åˆ°çš„æ—¥å¿—é›†ä¸­èµ·æ¥ï¼Œè¿›è¡Œè¿‡æ»¤å’ŒæŸ¥è¯¢ã€‚</p><p>é™¤äº†æ—¥å¿—ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ”¶é›†ç³»ç»Ÿçš„è¡Œä¸ºæ•°æ®å’Œæ€§èƒ½æŒ‡æ ‡ï¼Œæ¥äº†è§£ç³»ç»Ÿè¿è¡Œæ—¶çš„çŠ¶æ€ã€‚</p><p>Rust æœ‰ä¸é”™çš„å¯¹ <a href=\"https://prometheus.io/\">prometheus</a> çš„æ”¯æŒï¼Œæ¯”å¦‚ <a href=\"https://docs.rs/prometheus/latest/prometheus/\">rust-prometheus</a> å¯ä»¥å¸®åŠ©ä½ æ–¹ä¾¿åœ°æ”¶é›†å’Œå‘é€å„ç§æŒ‡æ ‡ï¼›è€Œ opentelemetry-rust æ›´æ˜¯é™¤äº†æ”¯æŒ <a href=\"https://github.com/open-telemetry/opentelemetry-rust\">prometheus</a> å¤–ï¼Œè¿˜æ”¯æŒå¾ˆå¤šå…¶ä»–å•†ä¸š/éå•†ä¸šçš„ç›‘æ§å·¥å…·ï¼Œæ¯”å¦‚ datadogï¼Œæ¯”å¦‚ jaegerã€‚</p><p>ä¹‹åæˆ‘ä»¬è¿˜ä¼šæœ‰ä¸€è®²æ¥è®© KV server æ›´å¥½åœ°å¤„ç†æ—¥å¿—å’Œç›‘æ§ï¼Œå¹¶ä¸”ç”¨ jaeger è¿›è¡Œæ€§èƒ½åˆ†æï¼Œæ‰¾åˆ°ä»£ç ä¸­çš„æ€§èƒ½é—®é¢˜ã€‚</p><h2>å¯æ‰§è¡Œæ–‡ä»¶å¤§å°</h2><p>æœ€åï¼Œæˆ‘ä»¬æ¥è°ˆè°ˆå¯æ‰§è¡Œæ–‡ä»¶çš„å¤§å°ã€‚</p><p>ç»å¤§å¤šæ•°ä½¿ç”¨åœºæ™¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ <code>cargo build --release</code> å°±å¤Ÿäº†ï¼Œç”Ÿæˆçš„ release build å¯ä»¥ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œä½†æœ‰äº›æƒ…å†µï¼Œæ¯”å¦‚åµŒå…¥å¼ç¯å¢ƒï¼Œæˆ–è€…ç”¨ Rust æ„å»ºæä¾›ç»™ Android/iOS çš„åŒ…æ—¶ï¼Œéœ€è¦å¯æ‰§è¡Œæ–‡ä»¶æˆ–è€…åº“æ–‡ä»¶å°½å¯èƒ½å°ï¼Œé¿å…æµªè´¹æ–‡ä»¶ç³»ç»Ÿçš„ç©ºé—´ï¼Œæˆ–è€…ç½‘ç»œæµé‡ã€‚</p><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›é¢å¤–çš„æ‰‹æ®µæ¥ä¼˜åŒ–æ–‡ä»¶å°ºå¯¸ã€‚ä½ å¯ä»¥å‚è€ƒ <a href=\"https://github.com/johnthagen/min-sized-rust\">min-sized-rust</a> æä¾›çš„æ–¹æ³•è¿›è¡Œå¤„ç†ã€‚</p><h2>å°ç»“</h2><p>ä»Šå¤©æˆ‘ä»¬èœ»èœ“ç‚¹æ°´è®¨è®ºäº†ï¼ŒæŠŠä¸€ä¸ª Rust é¡¹ç›®çœŸæ­£åº”ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ï¼Œéœ€è¦è€ƒè™‘çš„è¯¸å¤šé—®é¢˜ã€‚ä¹‹åä¼šå›´ç»•ç€ KV server æ¥å®è·µè¿™ä¸€è®²ä¸­æˆ‘ä»¬èŠåˆ°çš„å†…å®¹ã€‚<br>\n<img src=\"https://static001.geekbang.org/resource/image/2a/ef/2a6c520f4402132a70bf44333664ccef.jpg?wh=2312x1379\" alt=\"\"></p><p>åšä¸€ä¸ªä¸šä½™é¡¹ç›®å’Œåšä¸€ä¸ªå®é™…çš„ã€è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œçš„é¡¹ç›®æœ‰å¾ˆå¤§ä¸åŒã€‚ä¸šä½™é¡¹ç›®æˆ‘ä»¬ä¸»è¦å…³æ³¨éœ€æ±‚æ˜¯ä¸æ˜¯å¾—åˆ°äº†å¦¥å–„çš„å®ç°ï¼Œä¸»è¦å…³æ³¨çš„æ˜¯æ„å»ºçš„æµç¨‹ï¼›è€Œåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é™¤äº†éœ€è¦å…³æ³¨æ„å»ºï¼Œè¿˜æœ‰æµ‹é‡å’Œå­¦ä¹ çš„å®Œæ•´å¼€å‘æµç¨‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/c7/3f/c78be3a1631658bbfa3a0693yy5d1a3f.jpg?wh=3129x1837\" alt=\"\"></p><p>çœ‹è¿™å¼ å›¾ï¼Œä¸€ä¸ªé¡¹ç›®çš„æ•´ä½“å¼€å‘æµç¨‹ç›¸ä¿¡æ˜¯ä½ æ‰€ç†Ÿæ‚‰ï¼ŒåŒ…æ‹¬åˆå§‹æƒ³æ³•ã€éœ€æ±‚åˆ†æã€æ’æœŸã€è®¾è®¡å’Œå®ç°ã€æŒç»­é›†æˆã€ä»£ç å®¡æŸ¥ã€æµ‹è¯•ã€å‘å¸ƒã€åˆ†é˜¶æ®µä¸Šçº¿ã€å®éªŒã€ç›‘æ§ã€æ•°æ®åˆ†æç­‰éƒ¨åˆ†ï¼Œæˆ‘æŠŠå®ƒè´¯ç©¿åˆ°ç²¾ç›Šåˆ›ä¸šï¼ˆLean Startupï¼‰â€œæ„å»º - æµ‹é‡ - å­¦ä¹ â€ï¼ˆBuild - Measure - Learnï¼‰çš„ä¸‰ä¸ªç¯èŠ‚ä¸­ã€‚</p><p>ä»Šå¤©ä»‹ç»çš„ä»£ç ä»“åº“çš„ç®¡ç†ã€æµ‹è¯•å’ŒæŒç»­é›†æˆã€æ–‡æ¡£ã€æ—¥å¿—å’Œç›‘æ§ï¼Œå’Œè¿™ä¸ªæµç¨‹ä¸­çš„å¾ˆå¤šç¯èŠ‚éƒ½æœ‰å…³ç³»ï¼Œä½ å¯ä»¥å¯¹ç…§ç€è‡ªå·±å…¬å¸çš„å¼€å‘æµç¨‹ï¼Œæƒ³ä¸€æƒ³å¦‚ä½•åœ¨è¿™äº›æµç¨‹ä¸­æ›´å¥½åœ°ä½¿ç”¨ Rustã€‚</p><h3>æ€è€ƒé¢˜</h3><p>åœ¨ä¸Šé¢å®Œæ•´å¼€å‘æµç¨‹å›¾ä¸­ï¼Œä»Šå¤©åªæ¶‰åŠäº†ä¸»è¦çš„éƒ¨åˆ†ã€‚ä½ å¯ä»¥ç»“åˆè‡ªå·±ç°æœ‰å·¥ä½œçš„æµç¨‹ï¼Œæ€è€ƒä¸€ä¸‹å¦‚æœæŠŠ Rust å¼•å…¥åˆ°ä½ çš„å·¥ä½œä¸­ï¼Œå“ªäº›æµç¨‹èƒ½å¤Ÿå¾ˆå¥½åœ°é€‚é…ï¼Œå“ªäº›æµç¨‹è¿˜éœ€è¦é¢å¤–çš„å·¥ä½œï¼Ÿ</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„æ€è€ƒï¼Œæ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œå¦‚æœè§‰å¾—æœ‰æ”¶è·ï¼Œä¹Ÿæ¬¢è¿ä½ åˆ†äº«ç»™èº«è¾¹çš„æœ‹å‹ï¼Œé‚€ä»–ä¸€èµ·è®¨è®ºã€‚ä½ å®Œæˆäº†Rustå­¦ä¹ çš„ç¬¬43æ¬¡æ‰“å¡å•¦ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p>","neighbors":{"left":{"article_title":"42ï½œé˜¶æ®µå®æ“ï¼ˆ7ï¼‰ï¼šæ„å»ºä¸€ä¸ªç®€å•çš„KV server-å¦‚ä½•åšå¤§çš„é‡æ„ï¼Ÿ","id":461999},"right":{"article_title":"44ï½œæ•°æ®å¤„ç†ï¼šåº”ç”¨ç¨‹åºå’Œæ•°æ®å¦‚ä½•æ‰“äº¤é“ï¼Ÿ","id":464855}},"comments":[{"had_liked":false,"id":325333,"user_name":"äº¤æµä¼š","can_delete":false,"product_type":"c1","uid":2022072,"ip_address":"","ucode":"EA82C16C86FAEE","user_header":"https://static001.geekbang.org/account/avatar/00/1e/da/b8/3f80b8a5.jpg","comment_is_top":false,"comment_ctime":1638926171,"is_pvip":false,"replies":[{"id":"118832","content":"æœ‰å¾ˆå¤šä¸­é—´è¿‡ç¨‹","user_name":"ä½œè€…å›å¤","comment_id":325333,"uid":"1079375","ip_address":"","utype":1,"ctime":1639808016,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"10228860763","product_id":100085301,"comment_content":"æ²¡æƒ³åˆ°rustå‡ è¡Œä»£ç çš„å°é¡¹ç›®ä¼šå è¿™ä¹ˆå¤§ç©ºé—´ï¼Œå“ˆå“ˆ<br>2.4G\t.&#47;queryer<br>797M .&#47;scrape_url<br>1.7G\t.&#47;httpie<br>1.9G\t.&#47;thumbor","like_count":2,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539708,"discussion_content":"æœ‰å¾ˆå¤šä¸­é—´è¿‡ç¨‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639808016,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":346376,"user_name":"æŸ±å­","can_delete":false,"product_type":"c1","uid":1567991,"ip_address":"","ucode":"9714A69DF84278","user_header":"https://static001.geekbang.org/account/avatar/00/17/ec/f7/d33de1ce.jpg","comment_is_top":false,"comment_ctime":1653064801,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1653064801","product_id":100085301,"comment_content":"è€å¸ˆï¼Œçœ‹åˆ°æ‚¨è¿™ç« æåˆ°äº†ï¼šmin-sized-rustï¼Œå¹¶ä¸”æ‚¨åœ¨27è®²ä¸­æœ‰æåˆ°ä¸€äº›Rustå¼€å‘å‰ç«¯åº”ç”¨ã€ä»¥Wasmçš„æ–¹å¼åœ¨æµè§ˆå™¨é‡Œè¿è¡Œçš„æ¡†æ¶ï¼Œå¦‚Yewã€Seedï¼›<br>è¯·é—®è¿™ç±»Wasmçš„æ–¹æ¡ˆæ˜¯å¦æœ‰æ–¹æ³•ç¼–è¯‘ Wasmçš„ä»£ç åˆ†åŒ…ï¼Œå¹¶ä¸”ä»¥æ‡’åŠ è½½çš„æ–¹å¼åœ¨ç”¨åˆ°éƒ¨åˆ†ä»£ç çš„æ—¶å€™å†åŠ¨æ€åŠ è½½ï¼Ÿ","like_count":0},{"had_liked":false,"id":325389,"user_name":"Rayjun","can_delete":false,"product_type":"c1","uid":1002514,"ip_address":"","ucode":"61A3D1A3D03569","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4c/12/f0c145d4.jpg","comment_is_top":false,"comment_ctime":1638940519,"is_pvip":true,"replies":[{"id":"118830","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","comment_id":325389,"uid":"1079375","ip_address":"","utype":1,"ctime":1639807653,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1638940519","product_id":100085301,"comment_content":"å¾ˆèµï¼Œä¸ä»…ä»…æ˜¯ rust é¡¹ç›®å¯ä»¥å‚è€ƒè¿™ä¸ªæµç¨‹ï¼Œå¯¹äºå…¶ä»–è¯­è¨€çš„é¡¹ç›®ï¼ŒåŒæ ·é€‚ç”¨","like_count":0,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539706,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639807653,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":325305,"user_name":"å½­äºšä¼¦","can_delete":false,"product_type":"c1","uid":2425378,"ip_address":"","ucode":"77A32C73A23F72","user_header":"https://static001.geekbang.org/account/avatar/00/25/02/22/19585900.jpg","comment_is_top":false,"comment_ctime":1638910850,"is_pvip":true,"replies":[{"id":"118045","content":"æœ‰çš„ï¼Œåªæ˜¯è¿™æ˜¯é‚€è¯·çš„åœºå¤–å¤§å’–æ¥åŠ é¤ï¼Œæ‰€ä»¥ä¸Šçº¿æ—¶é—´ä¸æ˜¯å¾ˆç¨³å®šã€‚ä¸è¿‡æ”¾å¿ƒï¼Œä¼šæœ‰çš„ã€‚","user_name":"ç¼–è¾‘å›å¤","comment_id":325305,"uid":"2547771","ip_address":"","utype":2,"ctime":1638918979,"user_name_real":"ç¼–è¾‘"}],"discussion_count":2,"race_medal":0,"score":"1638910850","product_id":100085301,"comment_content":"å¼±å¼±åœ°é—®ä¸€å¥, &quot;åŠ é¤|å¼€æ‚Ÿä¹‹å¡ ä¸šç•Œéƒ½åœ¨ç”¨rustå¹²ä»€ä¹ˆ&quot;è¿™èŠ‚è¯¾æœ¨æœ‰äº†ä¹ˆ?","like_count":0,"discussions":[{"author":{"id":1059377,"avatar":"https://static001.geekbang.org/account/avatar/00/10/2a/31/9edbf8a6.jpg","nickname":"è´¾é™","note":"","ucode":"081E70CC01F6B8","race_medal":0,"user_type":8,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536949,"discussion_content":"æœ‰çš„ï¼Œåªæ˜¯è¿™æ˜¯é‚€è¯·çš„åœºå¤–å¤§å’–æ¥åŠ é¤ï¼Œæ‰€ä»¥ä¸Šçº¿æ—¶é—´ä¸æ˜¯å¾ˆç¨³å®šã€‚ä¸è¿‡æ”¾å¿ƒï¼Œä¼šæœ‰çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638918979,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":8}","child_discussion_number":1,"child_discussions":[{"author":{"id":2425378,"avatar":"https://static001.geekbang.org/account/avatar/00/25/02/22/19585900.jpg","nickname":"å½­äºšä¼¦","note":"","ucode":"77A32C73A23F72","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1059377,"avatar":"https://static001.geekbang.org/account/avatar/00/10/2a/31/9edbf8a6.jpg","nickname":"è´¾é™","note":"","ucode":"081E70CC01F6B8","race_medal":0,"user_type":8,"is_pvip":true},"discussion":{"id":537406,"discussion_content":"å¥½çš„ğŸ‘Œè°¢è°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639053756,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":536949,"ip_address":""},"score":537406,"extra":""}]}]}]}