{"id":68776,"title":"43 | bufioåŒ…ä¸­çš„æ•°æ®ç±»å‹ï¼ˆä¸‹ï¼‰","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯éƒæ—ï¼Œæˆ‘ä»Šå¤©ç»§ç»­åˆ†äº«bufioåŒ…ä¸­çš„æ•°æ®ç±»å‹ã€‚</p><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘æåˆ°äº†<code>bufio</code>åŒ…ä¸­çš„æ•°æ®ç±»å‹ä¸»è¦æœ‰<code>Reader</code>ã€<code>Scanner</code>ã€<code>Writer</code>å’Œ<code>ReadWriter</code>ã€‚å¹¶ç€é‡è®²åˆ°äº†<code>bufio.Reader</code>ç±»å‹ä¸<code>bufio.Writer</code>ç±»å‹ï¼Œä»Šå¤©ï¼Œæˆ‘ä»¬ç»§ç»­ä¸“æ³¨<code>bufio.Reader</code>çš„å†…å®¹æ¥è¿›è¡Œå­¦ä¹ ã€‚</p><h2>çŸ¥è¯†æ‰©å±•</h2><h3>é—®é¢˜ ï¼š<code>bufio.Reader</code>ç±»å‹è¯»å–æ–¹æ³•æœ‰å“ªäº›ä¸åŒï¼Ÿ</h3><p><code>bufio.Reader</code>ç±»å‹æ‹¥æœ‰å¾ˆå¤šç”¨äºè¯»å–æ•°æ®çš„æŒ‡é’ˆæ–¹æ³•ï¼Œ<strong>è¿™é‡Œé¢æœ‰4ä¸ªæ–¹æ³•å¯ä»¥ä½œä¸ºä¸åŒè¯»å–æµç¨‹çš„ä»£è¡¨ï¼Œå®ƒä»¬æ˜¯ï¼š<code>Peek</code>ã€<code>Read</code>ã€<code>ReadSlice</code>å’Œ<code>ReadBytes</code>ã€‚</strong></p><p><strong><code>Reader</code>å€¼çš„<code>Peek</code>æ–¹æ³•</strong>çš„åŠŸèƒ½æ˜¯ï¼šè¯»å–å¹¶è¿”å›å…¶ç¼“å†²åŒºä¸­çš„<code>n</code>ä¸ªæœªè¯»å­—èŠ‚ï¼Œå¹¶ä¸”å®ƒä¼šä»å·²è¯»è®¡æ•°ä»£è¡¨çš„ç´¢å¼•ä½ç½®å¼€å§‹è¯»ã€‚</p><p>åœ¨ç¼“å†²åŒºæœªè¢«å¡«æ»¡ï¼Œå¹¶ä¸”å…¶ä¸­çš„æœªè¯»å­—èŠ‚çš„æ•°é‡å°äº<code>n</code>çš„æ—¶å€™ï¼Œè¯¥æ–¹æ³•å°±ä¼šè°ƒç”¨<code>fill</code>æ–¹æ³•ï¼Œä»¥å¯åŠ¨ç¼“å†²åŒºå¡«å……æµç¨‹ã€‚ä½†æ˜¯ï¼Œå¦‚æœå®ƒå‘ç°ä¸Šæ¬¡å¡«å……ç¼“å†²åŒºçš„æ—¶å€™æœ‰é”™è¯¯ï¼Œé‚£å°±ä¸ä¼šå†æ¬¡å¡«å……ã€‚</p><p>å¦‚æœè°ƒç”¨æ–¹ç»™å®šçš„<code>n</code>æ¯”ç¼“å†²åŒºçš„é•¿åº¦è¿˜è¦å¤§ï¼Œæˆ–è€…ç¼“å†²åŒºä¸­æœªè¯»å­—èŠ‚çš„æ•°é‡å°äº<code>n</code>ï¼Œé‚£ä¹ˆ<code>Peek</code>æ–¹æ³•å°±ä¼šæŠŠâ€œæ‰€æœ‰æœªè¯»å­—èŠ‚ç»„æˆçš„åºåˆ—â€ä½œä¸ºç¬¬ä¸€ä¸ªç»“æœå€¼è¿”å›ã€‚</p><p>åŒæ—¶ï¼Œå®ƒé€šå¸¸è¿˜æŠŠâ€œ<code>bufio.ErrBufferFull</code>å˜é‡çš„å€¼ï¼ˆä»¥ä¸‹ç®€ç§°ç¼“å†²åŒºå·²æ»¡çš„é”™è¯¯ï¼‰â€<br>\nä½œä¸ºç¬¬äºŒä¸ªç»“æœå€¼è¿”å›ï¼Œç”¨æ¥è¡¨ç¤ºï¼šè™½ç„¶ç¼“å†²åŒºè¢«å‹ç¼©å’Œå¡«æ»¡äº†ï¼Œä½†æ˜¯ä»ç„¶æ»¡è¶³ä¸äº†è¦æ±‚ã€‚</p><!-- [[[read_end]]] --><p>åªæœ‰åœ¨ä¸Šè¿°çš„æƒ…å†µéƒ½æ²¡æœ‰å‡ºç°æ—¶ï¼Œ<code>Peek</code>æ–¹æ³•æ‰èƒ½è¿”å›ï¼šâ€œä»¥å·²è¯»è®¡æ•°ä¸ºèµ·å§‹çš„<code>n</code>ä¸ªå­—èŠ‚â€å’Œâ€œè¡¨ç¤ºæœªå‘ç”Ÿä»»ä½•é”™è¯¯çš„<code>nil</code>â€ã€‚</p><p><strong><code>bufio.Reader</code>ç±»å‹çš„Peekæ–¹æ³•æœ‰ä¸€ä¸ªé²œæ˜çš„ç‰¹ç‚¹ï¼Œé‚£å°±æ˜¯ï¼šå³ä½¿å®ƒè¯»å–äº†ç¼“å†²åŒºä¸­çš„æ•°æ®ï¼Œä¹Ÿä¸ä¼šæ›´æ”¹å·²è¯»è®¡æ•°çš„å€¼ã€‚</strong></p><p>è¿™ä¸ªç±»å‹çš„å…¶ä»–è¯»å–æ–¹æ³•å¹¶ä¸æ˜¯è¿™æ ·ã€‚å°±æ‹¿<strong>è¯¥ç±»å‹çš„<code>Read</code>æ–¹æ³•æ¥è¯´</strong>ï¼Œå®ƒæœ‰æ—¶ä¼šæŠŠç¼“å†²åŒºä¸­çš„æœªè¯»å­—èŠ‚ï¼Œä¾æ¬¡æ‹·è´åˆ°å…¶å‚æ•°<code>p</code>ä»£è¡¨çš„å­—èŠ‚åˆ‡ç‰‡ä¸­ï¼Œå¹¶ç«‹å³æ ¹æ®å®é™…æ‹·è´çš„å­—èŠ‚æ•°å¢åŠ å·²è¯»è®¡æ•°çš„å€¼ã€‚</p><ul>\n<li>\n<p>åœ¨ç¼“å†²åŒºä¸­è¿˜æœ‰æœªè¯»å­—èŠ‚çš„æƒ…å†µä¸‹ï¼Œè¯¥æ–¹æ³•çš„åšæ³•å°±æ˜¯å¦‚æ­¤ã€‚ä¸è¿‡ï¼Œåœ¨å¦ä¸€äº›æ—¶å€™ï¼Œå…¶æ‰€å±å€¼çš„å·²è¯»è®¡æ•°ä¼šç­‰äºå·²å†™è®¡æ•°ï¼Œè¿™è¡¨æ˜ï¼šæ­¤æ—¶çš„ç¼“å†²åŒºä¸­å·²ç»æ²¡æœ‰ä»»ä½•æœªè¯»çš„å­—èŠ‚äº†ã€‚</p>\n</li>\n<li>\n<p>å½“ç¼“å†²åŒºä¸­å·²æ— æœªè¯»å­—èŠ‚æ—¶ï¼Œ<code>Read</code>æ–¹æ³•ä¼šå…ˆæ£€æŸ¥å‚æ•°<code>p</code>çš„é•¿åº¦æ˜¯å¦å¤§äºæˆ–ç­‰äºç¼“å†²åŒºçš„é•¿åº¦ã€‚å¦‚æœæ˜¯ï¼Œé‚£ä¹ˆ<code>Read</code>æ–¹æ³•ä¼šç´¢æ€§æ”¾å¼ƒå‘ç¼“å†²åŒºä¸­å¡«å……æ•°æ®ï¼Œè½¬è€Œç›´æ¥ä»å…¶åº•å±‚è¯»å–å™¨ä¸­è¯»å‡ºæ•°æ®å¹¶æ‹·è´åˆ°<code>p</code>ä¸­ã€‚è¿™æ„å‘³ç€å®ƒå®Œå…¨è·¨è¿‡äº†ç¼“å†²åŒºï¼Œå¹¶ç›´è¿äº†æ•°æ®ä¾›éœ€çš„åŒæ–¹ã€‚</p>\n</li>\n</ul><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>Peek</code>æ–¹æ³•åœ¨é‡åˆ°ç±»ä¼¼æƒ…å†µæ—¶çš„åšæ³•ä¸è¿™é‡Œçš„åŒºåˆ«ï¼ˆè¿™ä¸¤ç§åšæ³•å­°ä¼˜å­°åŠ£è¿˜è¦çœ‹å…·ä½“çš„ä½¿ç”¨åœºæ™¯ï¼‰ã€‚</p><p><code>Peek</code>æ–¹æ³•ä¼šåœ¨æ¡ä»¶æ»¡è¶³æ—¶å¡«å……ç¼“å†²åŒºï¼Œå¹¶åœ¨å‘ç°å‚æ•°<code>n</code>çš„å€¼æ¯”ç¼“å†²åŒºçš„é•¿åº¦æ›´å¤§æ—¶ï¼Œç›´æ¥è¿”å›ç¼“å†²åŒºä¸­çš„æ‰€æœ‰æœªè¯»å­—èŠ‚ã€‚</p><p>å¦‚æœæˆ‘ä»¬å½“åˆè®¾å®šçš„ç¼“å†²åŒºé•¿åº¦å¾ˆå¤§ï¼Œé‚£ä¹ˆåœ¨è¿™ç§æƒ…å†µä¸‹çš„æ–¹æ³•æ‰§è¡Œè€—æ—¶ï¼Œå°±æœ‰å¯èƒ½ä¼šæ¯”è¾ƒé•¿ã€‚æœ€ä¸»è¦çš„åŸå› æ˜¯å¡«å……ç¼“å†²åŒºéœ€è¦èŠ±è´¹è¾ƒé•¿çš„æ—¶é—´ã€‚</p><p>ç”±<code>fill</code>æ–¹æ³•æ‰§è¡Œçš„æµç¨‹å¯çŸ¥ï¼Œå®ƒä¼šå°½é‡å¡«æ»¡ç¼“å†²åŒºä¸­çš„å¯å†™ç©ºé—´ã€‚ç„¶è€Œï¼Œ<code>Read</code>æ–¹æ³•åœ¨å¤§å¤šæ•°çš„æƒ…å†µä¸‹ï¼Œæ˜¯ä¸ä¼šå‘ç¼“å†²åŒºä¸­å†™å…¥æ•°æ®çš„ï¼Œå°¤å…¶æ˜¯åœ¨å‰é¢æè¿°çš„é‚£ç§æƒ…å†µä¸‹ï¼Œå³ï¼šç¼“å†²åŒºä¸­å·²æ— æœªè¯»å­—èŠ‚ï¼Œä¸”å‚æ•°<code>p</code>çš„é•¿åº¦å¤§äºæˆ–ç­‰äºç¼“å†²åŒºçš„é•¿åº¦ã€‚</p><p>æ­¤æ—¶ï¼Œè¯¥æ–¹æ³•ä¼šç›´æ¥ä»åº•å±‚è¯»å–å™¨é‚£é‡Œè¯»å‡ºæ•°æ®ï¼Œæ‰€ä»¥æ•°æ®çš„è¯»å‡ºé€Ÿåº¦å°±æˆä¸ºäº†è¿™ç§æƒ…å†µä¸‹æ–¹æ³•æ‰§è¡Œè€—æ—¶çš„å†³å®šæ€§å› ç´ ã€‚</p><p>å½“ç„¶äº†ï¼Œæˆ‘åœ¨è¿™é‡Œè¯´çš„åªæ˜¯è€—æ—¶æ“ä½œåœ¨æŸäº›æƒ…å†µä¸‹æ›´å¯èƒ½å‡ºç°åœ¨å“ªé‡Œï¼Œä¸€åˆ‡çš„ç»“è®ºè¿˜æ˜¯è¦ä»¥æ€§èƒ½æµ‹è¯•çš„å®¢è§‚ç»“æœä¸ºå‡†ã€‚</p><p>è¯´å›<code>Read</code>æ–¹æ³•çš„å†…éƒ¨æµç¨‹ã€‚å¦‚æœç¼“å†²åŒºä¸­å·²æ— æœªè¯»å­—èŠ‚ï¼Œä½†å…¶é•¿åº¦æ¯”å‚æ•°<code>p</code>çš„é•¿åº¦æ›´å¤§ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•ä¼šå…ˆæŠŠå·²è¯»è®¡æ•°å’Œå·²å†™è®¡æ•°çš„å€¼éƒ½é‡ç½®ä¸º<code>0</code>ï¼Œç„¶åå†å°è¯•ç€ä½¿ç”¨ä»åº•å±‚è¯»å–å™¨é‚£é‡Œè·å–çš„æ•°æ®ï¼Œå¯¹ç¼“å†²åŒºè¿›è¡Œä¸€æ¬¡ä»å¤´è‡³å°¾çš„å¡«å……ã€‚</p><p>ä¸è¿‡è¦æ³¨æ„ï¼Œè¿™é‡Œçš„å°è¯•åªä¼šè¿›è¡Œä¸€æ¬¡ã€‚æ— è®ºåœ¨è¿™ä¸€æ—¶åˆ»æ˜¯å¦èƒ½å¤Ÿè·å–åˆ°æ•°æ®ï¼Œä¹Ÿæ— è®ºè·å–æ—¶æ˜¯å¦æœ‰é”™è¯¯å‘ç”Ÿï¼Œéƒ½ä¼šæ˜¯å¦‚æ­¤ã€‚è€Œ<code>fill</code>æ–¹æ³•çš„åšæ³•ä¸æ­¤ä¸åŒï¼Œåªè¦æ²¡æœ‰å‘ç”Ÿé”™è¯¯ï¼Œå®ƒå°±ä¼šè¿›è¡Œå¤šæ¬¡å°è¯•ï¼Œå› æ­¤å®ƒçœŸæ­£è·å–åˆ°ä¸€äº›æ•°æ®çš„å¯èƒ½æ€§æ›´å¤§ã€‚</p><p>ä¸è¿‡ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•æœ‰ä¸€ç‚¹æ˜¯ç›¸åŒï¼Œé‚£å°±æ˜¯ï¼šåªè¦å®ƒä»¬æŠŠè·å–åˆ°çš„æ•°æ®å†™å…¥ç¼“å†²åŒºï¼Œå°±ä¼šåŠæ—¶åœ°æ›´æ–°å·²å†™è®¡æ•°çš„å€¼ã€‚</p><p><strong>å†æ¥è¯´<code>ReadSlice</code>æ–¹æ³•å’Œ<code>ReadBytes</code>æ–¹æ³•ã€‚</strong> è¿™ä¸¤ä¸ªæ–¹æ³•çš„åŠŸèƒ½æ€»ä½“ä¸Šæ¥è¯´ï¼Œéƒ½æ˜¯æŒç»­åœ°è¯»å–æ•°æ®ï¼Œç›´è‡³é‡åˆ°è°ƒç”¨æ–¹ç»™å®šçš„åˆ†éš”ç¬¦ä¸ºæ­¢ã€‚</p><p><strong><code>ReadSlice</code>æ–¹æ³•</strong>ä¼šå…ˆåœ¨å…¶ç¼“å†²åŒºçš„æœªè¯»éƒ¨åˆ†ä¸­å¯»æ‰¾åˆ†éš”ç¬¦ã€‚å¦‚æœæœªèƒ½æ‰¾åˆ°ï¼Œå¹¶ä¸”ç¼“å†²åŒºæœªæ»¡ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•ä¼šå…ˆé€šè¿‡è°ƒç”¨<code>fill</code>æ–¹æ³•å¯¹ç¼“å†²åŒºè¿›è¡Œå¡«å……ï¼Œç„¶åå†æ¬¡å¯»æ‰¾ï¼Œå¦‚æ­¤å¾€å¤ã€‚</p><p>å¦‚æœåœ¨å¡«å……çš„è¿‡ç¨‹ä¸­å‘ç”Ÿäº†é”™è¯¯ï¼Œé‚£ä¹ˆå®ƒä¼šæŠŠç¼“å†²åŒºä¸­çš„æœªè¯»éƒ¨åˆ†ä½œä¸ºç»“æœè¿”å›ï¼ŒåŒæ—¶è¿”å›ç›¸åº”çš„é”™è¯¯å€¼ã€‚</p><p>æ³¨æ„ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­æœ‰å¯èƒ½ä¼šå‡ºç°è™½ç„¶ç¼“å†²åŒºå·²è¢«å¡«æ»¡ï¼Œä½†ä»ç„¶æ²¡èƒ½æ‰¾åˆ°åˆ†éš”ç¬¦çš„æƒ…å†µã€‚</p><p>è¿™æ—¶ï¼Œ<code>ReadSlice</code>æ–¹æ³•ä¼šæŠŠæ•´ä¸ªç¼“å†²åŒºï¼ˆä¹Ÿå°±æ˜¯<code>buf</code>å­—æ®µä»£è¡¨çš„å­—èŠ‚åˆ‡ç‰‡ï¼‰ä½œä¸ºç¬¬ä¸€ä¸ªç»“æœå€¼ï¼Œå¹¶æŠŠç¼“å†²åŒºå·²æ»¡çš„é”™è¯¯ï¼ˆå³<code>bufio.ErrBufferFull</code>å˜é‡çš„å€¼ï¼‰ä½œä¸ºç¬¬äºŒä¸ªç»“æœå€¼ã€‚</p><p>ç»è¿‡<code>fill</code>æ–¹æ³•å¡«æ»¡çš„ç¼“å†²åŒºè‚¯å®šä»å¤´è‡³å°¾éƒ½åªåŒ…å«äº†æœªè¯»çš„å­—èŠ‚ï¼Œæ‰€ä»¥è¿™æ ·åšæ˜¯åˆç†çš„ã€‚</p><p>å½“ç„¶äº†ï¼Œä¸€æ—¦<code>ReadSlice</code>æ–¹æ³•æ‰¾åˆ°äº†åˆ†éš”ç¬¦ï¼Œå®ƒå°±ä¼šåœ¨ç¼“å†²åŒºä¸Šåˆ‡å‡ºç›¸åº”çš„ã€åŒ…å«åˆ†éš”ç¬¦çš„å­—èŠ‚åˆ‡ç‰‡ï¼Œå¹¶æŠŠè¯¥åˆ‡ç‰‡ä½œä¸ºç»“æœå€¼è¿”å›ã€‚æ— è®ºåˆ†éš”ç¬¦æ‰¾åˆ°ä¸å¦ï¼Œè¯¥æ–¹æ³•éƒ½ä¼šæ­£ç¡®åœ°è®¾ç½®å·²è¯»è®¡æ•°çš„å€¼ã€‚</p><p>æ¯”å¦‚ï¼Œåœ¨è¿”å›ç¼“å†²åŒºä¸­çš„æ‰€æœ‰æœªè¯»å­—èŠ‚ï¼Œæˆ–è€…ä»£è¡¨å…¨éƒ¨ç¼“å†²åŒºçš„å­—èŠ‚åˆ‡ç‰‡ä¹‹å‰ï¼Œå®ƒä¼šæŠŠå·²å†™è®¡æ•°çš„å€¼èµ‹ç»™å·²è¯»è®¡æ•°ï¼Œä»¥è¡¨æ˜ç¼“å†²åŒºä¸­å·²æ— æœªè¯»å­—èŠ‚ã€‚</p><p>å¦‚æœè¯´<code>ReadSlice</code>æ˜¯ä¸€ä¸ªå®¹æ˜“åŠé€”è€ŒåºŸçš„æ–¹æ³•çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥è¯´<code>ReadBytes</code>æ–¹æ³•ç®—å¾—ä¸Šæ˜¯ç›¸å½“çš„æ‰§ç€ã€‚</p><p><strong><code>ReadBytes</code>æ–¹æ³•</strong>ä¼šé€šè¿‡è°ƒç”¨<code>ReadSlice</code>æ–¹æ³•ä¸€æ¬¡åˆä¸€æ¬¡åœ°ä»ç¼“å†²åŒºä¸­è¯»å–æ•°æ®ï¼Œç›´è‡³æ‰¾åˆ°åˆ†éš”ç¬¦ä¸ºæ­¢ã€‚</p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ<code>ReadSlice</code>æ–¹æ³•å¯èƒ½ä¼šå› ç¼“å†²åŒºå·²æ»¡è€Œè¿”å›æ‰€æœ‰å·²è¯»åˆ°çš„å­—èŠ‚å’Œç›¸åº”çš„é”™è¯¯å€¼ï¼Œä½†<code>ReadBytes</code>æ–¹æ³•æ€»æ˜¯ä¼šå¿½ç•¥æ‰è¿™æ ·çš„é”™è¯¯ï¼Œå¹¶å†æ¬¡è°ƒç”¨<code>ReadSlice</code>æ–¹æ³•ï¼Œè¿™ä½¿å¾—åè€…ä¼šç»§ç»­å¡«å……ç¼“å†²åŒºå¹¶åœ¨å…¶ä¸­å¯»æ‰¾åˆ†éš”ç¬¦ã€‚</p><p>é™¤é<code>ReadSlice</code>æ–¹æ³•è¿”å›çš„é”™è¯¯å€¼å¹¶ä¸ä»£è¡¨ç¼“å†²åŒºå·²æ»¡çš„é”™è¯¯ï¼Œæˆ–è€…å®ƒæ‰¾åˆ°äº†åˆ†éš”ç¬¦ï¼Œå¦åˆ™è¿™ä¸€è¿‡ç¨‹æ°¸è¿œä¸ä¼šç»“æŸã€‚</p><p>å¦‚æœå¯»æ‰¾çš„è¿‡ç¨‹ç»“æŸäº†ï¼Œä¸ç®¡æ˜¯ä¸æ˜¯å› ä¸ºæ‰¾åˆ°äº†åˆ†éš”ç¬¦ï¼Œ<code>ReadBytes</code>æ–¹æ³•éƒ½ä¼šæŠŠåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­è¯»åˆ°çš„æ‰€æœ‰å­—èŠ‚ï¼ŒæŒ‰ç…§è¯»å–çš„å…ˆåé¡ºåºç»„è£…æˆä¸€ä¸ªå­—èŠ‚åˆ‡ç‰‡ï¼Œå¹¶æŠŠå®ƒä½œä¸ºç¬¬ä¸€ä¸ªç»“æœå€¼ã€‚å¦‚æœè¿‡ç¨‹ç»“æŸæ˜¯å› ä¸ºå‡ºç°é”™è¯¯ï¼Œé‚£ä¹ˆå®ƒè¿˜ä¼šæŠŠæ‹¿åˆ°çš„é”™è¯¯å€¼ä½œä¸ºç¬¬äºŒä¸ªç»“æœå€¼ã€‚</p><p>åœ¨<code>bufio.Reader</code>ç±»å‹çš„ä¼—å¤šè¯»å–æ–¹æ³•ä¸­ï¼Œä¾èµ–<code>ReadSlice</code>æ–¹æ³•çš„é™¤äº†<code>ReadBytes</code>æ–¹æ³•ï¼Œè¿˜æœ‰<code>ReadLine</code>æ–¹æ³•ã€‚ä¸è¿‡åè€…åœ¨è¯»å–æµç¨‹ä¸Šå¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„ï¼Œæˆ‘å°±ä¸åœ¨è¿™é‡Œèµ˜è¿°äº†ã€‚</p><p>å¦å¤–ï¼Œè¯¥ç±»å‹çš„<code>ReadString</code>æ–¹æ³•å®Œå…¨ä¾èµ–äº<code>ReadBytes</code>æ–¹æ³•ï¼Œå‰è€…åªæ˜¯åœ¨åè€…è¿”å›çš„ç»“æœå€¼ä¹‹ä¸Šåšäº†ä¸€ä¸ªç®€å•çš„ç±»å‹è½¬æ¢è€Œå·²ã€‚</p><p><strong>æœ€åï¼Œæˆ‘è¿˜è¦æé†’ä½ ä¸€ä¸‹ï¼Œæœ‰ä¸ªå®‰å…¨æ€§æ–¹é¢çš„é—®é¢˜éœ€è¦ä½ æ³¨æ„ã€‚<code>bufio.Reader</code>ç±»å‹çš„<code>Peek</code>æ–¹æ³•ã€<code>ReadSlice</code>æ–¹æ³•å’Œ<code>ReadLine</code>æ–¹æ³•éƒ½æœ‰å¯èƒ½ä¼šé€ æˆå†…å®¹æ³„éœ²ã€‚</strong></p><p>è¿™ä¸»è¦æ˜¯å› ä¸ºå®ƒä»¬åœ¨æ­£å¸¸çš„æƒ…å†µä¸‹éƒ½ä¼šè¿”å›ç›´æ¥åŸºäºç¼“å†²åŒºçš„å­—èŠ‚åˆ‡ç‰‡ã€‚æˆ‘åœ¨è®²<code>bytes.Buffer</code>ç±»å‹çš„æ—¶å€™è§£é‡Šè¿‡ä»€ä¹ˆå«å†…å®¹æ³„éœ²ã€‚ä½ å¯ä»¥è¿”å›æŸ¥çœ‹ã€‚</p><p>è°ƒç”¨æ–¹å¯ä»¥é€šè¿‡è¿™äº›æ–¹æ³•è¿”å›çš„ç»“æœå€¼è®¿é—®åˆ°ç¼“å†²åŒºçš„å…¶ä»–éƒ¨åˆ†ï¼Œç”šè‡³ä¿®æ”¹ç¼“å†²åŒºä¸­çš„å†…å®¹ã€‚è¿™é€šå¸¸éƒ½æ˜¯å¾ˆå±é™©çš„ã€‚</p><h2>æ€»ç»“</h2><p>æˆ‘ä»¬ç”¨æ¯”è¾ƒé•¿çš„ç¯‡å¹…ä»‹ç»äº†<code>bufio</code>åŒ…ä¸­çš„æ•°æ®ç±»å‹ï¼Œå…¶ä¸­çš„é‡ç‚¹æ˜¯<code>bufio.Reader</code>ç±»å‹ã€‚</p><p><code>bufio.Reader</code>ç±»å‹ä»£è¡¨çš„æ˜¯æºå¸¦ç¼“å†²åŒºçš„è¯»å–å™¨ã€‚å®ƒçš„å€¼åœ¨è¢«åˆå§‹åŒ–çš„æ—¶å€™éœ€è¦æ¥å—ä¸€ä¸ªåº•å±‚çš„è¯»å–å™¨ï¼Œåè€…çš„ç±»å‹å¿…é¡»æ˜¯<code>io.Reader</code>æ¥å£çš„å®ç°ã€‚</p><p><code>Reader</code>å€¼ä¸­çš„ç¼“å†²åŒºå…¶å®å°±æ˜¯ä¸€ä¸ªæ•°æ®å­˜å‚¨ä¸­ä»‹ï¼Œå®ƒä»‹äºåº•å±‚è¯»å–å™¨ä¸è¯»å–æ–¹æ³•åŠå…¶è°ƒç”¨æ–¹ä¹‹é—´ã€‚æ­¤ç±»å€¼çš„è¯»å–æ–¹æ³•ä¸€èˆ¬éƒ½ä¼šå…ˆä»è¯¥å€¼çš„ç¼“å†²åŒºä¸­è¯»å–æ•°æ®ï¼ŒåŒæ—¶åœ¨å¿…è¦çš„æ—¶å€™é¢„å…ˆä»å…¶åº•å±‚è¯»å–å™¨é‚£é‡Œè¯»å‡ºä¸€éƒ¨åˆ†æ•°æ®ï¼Œå¹¶å¡«å……åˆ°ç¼“å†²åŒºä¸­ä»¥å¤‡åç”¨ã€‚å¡«å……ç¼“å†²åŒºçš„æ“ä½œé€šå¸¸ä¼šç”±è¯¥å€¼çš„<code>fill</code>æ–¹æ³•æ‰§è¡Œã€‚åœ¨å¡«å……çš„è¿‡ç¨‹ä¸­ï¼Œ<code>fill</code>æ–¹æ³•æœ‰æ—¶è¿˜ä¼šå¯¹ç¼“å†²åŒºè¿›è¡Œå‹ç¼©ã€‚</p><p>åœ¨<code>Reader</code>å€¼æ‹¥æœ‰çš„ä¼—å¤šè¯»å–æ–¹æ³•ä¸­ï¼Œæœ‰4ä¸ªæ–¹æ³•å¯ä»¥ä½œä¸ºä¸åŒè¯»å–æµç¨‹çš„ä»£è¡¨ï¼Œå®ƒä»¬æ˜¯ï¼š<code>Peek</code>ã€<code>Read</code>ã€<code>ReadSlice</code>å’Œ<code>ReadBytes</code>ã€‚</p><p><code>Peek</code>æ–¹æ³•çš„ç‰¹ç‚¹æ˜¯å³ä½¿è¯»å–äº†ç¼“å†²åŒºä¸­çš„æ•°æ®ï¼Œä¹Ÿä¸ä¼šæ›´æ”¹å·²è¯»è®¡æ•°çš„å€¼ã€‚è€Œ<code>Read</code>æ–¹æ³•ä¼šåœ¨å‚æ•°å€¼çš„é•¿åº¦è¿‡å¤§ï¼Œä¸”ç¼“å†²åŒºä¸­å·²æ— æœªè¯»å­—èŠ‚æ—¶ï¼Œè·¨è¿‡ç¼“å†²åŒºå¹¶ç›´æ¥å‘åº•å±‚è¯»å–å™¨ç´¢è¦æ•°æ®ã€‚</p><p><code>ReadSlice</code>æ–¹æ³•ä¼šåœ¨ç¼“å†²åŒºçš„æœªè¯»éƒ¨åˆ†ä¸­å¯»æ‰¾ç»™å®šçš„åˆ†éš”ç¬¦ï¼Œå¹¶åœ¨å¿…è¦æ—¶å¯¹ç¼“å†²åŒºè¿›è¡Œå¡«å……ã€‚</p><p>å¦‚æœåœ¨å¡«æ»¡ç¼“å†²åŒºä¹‹åä»ç„¶æœªèƒ½æ‰¾åˆ°åˆ†éš”ç¬¦ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•å°±ä¼šæŠŠæ•´ä¸ªç¼“å†²åŒºä½œä¸ºç¬¬ä¸€ä¸ªç»“æœå€¼è¿”å›ï¼ŒåŒæ—¶è¿”å›ç¼“å†²åŒºå·²æ»¡çš„é”™è¯¯ã€‚</p><p><code>ReadBytes</code>æ–¹æ³•ä¼šé€šè¿‡è°ƒç”¨<code>ReadSlice</code>æ–¹æ³•ï¼Œä¸€æ¬¡åˆä¸€æ¬¡åœ°å¡«å……ç¼“å†²åŒºï¼Œå¹¶åœ¨å…¶ä¸­å¯»æ‰¾åˆ†éš”ç¬¦ã€‚é™¤éå‘ç”Ÿäº†æœªé¢„æ–™åˆ°çš„é”™è¯¯æˆ–è€…æ‰¾åˆ°äº†åˆ†éš”ç¬¦ï¼Œå¦åˆ™è¿™ä¸€è¿‡ç¨‹å°†ä¼šä¸€ç›´è¿›è¡Œä¸‹å»ã€‚</p><p><code>Reader</code>å€¼çš„<code>ReadLine</code>æ–¹æ³•ä¼šä¾èµ–äºå®ƒçš„<code>ReadSlice</code>æ–¹æ³•ï¼Œè€Œå…¶<code>ReadString</code>æ–¹æ³•åˆ™å®Œå…¨ä¾èµ–äº<code>ReadBytes</code>æ–¹æ³•ã€‚</p><p>å¦å¤–ï¼Œå€¼å¾—æˆ‘ä»¬ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œ<code>Reader</code>å€¼çš„<code>Peek</code>æ–¹æ³•ã€<code>ReadSlice</code>æ–¹æ³•å’Œ<code>ReadLine</code>æ–¹æ³•éƒ½å¯èƒ½ä¼šé€ æˆå…¶ç¼“å†²åŒºä¸­çš„å†…å®¹çš„æ³„éœ²ã€‚</p><p>æœ€åå†è¯´ä¸€ä¸‹<code>bufio.Writer</code>ç±»å‹ã€‚æŠŠè¯¥ç±»å€¼çš„ç¼“å†²åŒºä¸­æš‚å­˜çš„æ•°æ®å†™è¿›å…¶åº•å±‚å†™å…¥å™¨çš„åŠŸèƒ½ï¼Œä¸»è¦æ˜¯ç”±å®ƒçš„<code>Flush</code>æ–¹æ³•å®ç°çš„ã€‚</p><p>æ­¤ç±»å€¼çš„æ‰€æœ‰æ•°æ®å†™å…¥æ–¹æ³•éƒ½ä¼šåœ¨å¿…è¦çš„æ—¶å€™è°ƒç”¨å®ƒçš„<code>Flush</code>æ–¹æ³•ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™äº›å†™å…¥æ–¹æ³•éƒ½ä¼šå…ˆæŠŠæ•°æ®å†™è¿›å…¶æ‰€å±å€¼çš„ç¼“å†²åŒºï¼Œç„¶åå†å¢åŠ è¯¥å€¼ä¸­çš„å·²å†™è®¡æ•°ã€‚ä½†æ˜¯ï¼Œåœ¨æœ‰äº›æ—¶å€™ï¼Œ<code>Write</code>æ–¹æ³•å’Œ<code>ReadFrom</code>æ–¹æ³•ä¹Ÿä¼šè·¨è¿‡ç¼“å†²åŒºï¼Œå¹¶ç›´æ¥æŠŠæ•°æ®å†™è¿›å…¶åº•å±‚å†™å…¥å™¨ã€‚</p><p>è¯·è®°ä½ï¼Œè™½ç„¶è¿™äº›å†™å…¥æ–¹æ³•éƒ½ä¼šä¸æ—¶åœ°è°ƒç”¨<code>Flush</code>æ–¹æ³•ï¼Œä½†æ˜¯åœ¨å†™å…¥æ‰€æœ‰çš„æ•°æ®ä¹‹åå†æ˜¾å¼åœ°è°ƒç”¨ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•æ€»æ˜¯æœ€ç¨³å¦¥çš„ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>ä»Šå¤©çš„æ€è€ƒé¢˜æ˜¯ï¼š<code>bufio.Scanner</code>ç±»å‹çš„ä¸»è¦åŠŸç”¨æ˜¯ä»€ä¹ˆï¼Ÿå®ƒæœ‰å“ªäº›ç‰¹ç‚¹ï¼Ÿ</p><p>æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§ã€‚</p><p><a href=\"https://github.com/hyper0x/Golang_Puzzlers\">æˆ³æ­¤æŸ¥çœ‹Goè¯­è¨€ä¸“æ æ–‡ç« é…å¥—è¯¦ç»†ä»£ç ã€‚</a></p><p></p>","neighbors":{"left":{"article_title":"42 | bufioåŒ…ä¸­çš„æ•°æ®ç±»å‹ ï¼ˆä¸Šï¼‰","id":67485},"right":{"article_title":"44 | ä½¿ç”¨osåŒ…ä¸­çš„API ï¼ˆä¸Šï¼‰","id":68779}},"comments":[{"had_liked":false,"id":41085,"user_name":"xyz","can_delete":false,"product_type":"c1","uid":1016059,"ip_address":"","ucode":"CA183740FB5C9D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/80/fb/ffa57759.jpg","comment_is_top":false,"comment_ctime":1542723654,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"65967233094","product_id":100013101,"comment_content":"æ…¢æ…¢è¿½ä¸Šäº†ï¼ˆä¸è¿‡æœ‰äº›å†…å®¹å­¦çš„æ¯”è¾ƒç²—ç•¥â€¦â€¦ï¼‰ï¼Œæ„Ÿè§‰éƒæ—è€å¸ˆçš„è¿™ä¸ªç³»åˆ—ï¼Œç‰¹åˆ«æ˜¯åé¢çš„å†…å®¹æ›´é€‚åˆä½œä¸ºä¸€ä¸ªäº†è§£å¸¸ç”¨åº“çš„ç´¢å¼•å­˜åœ¨ï¼Œæœ‰åœ¨å®é™…å·¥ä½œä¸­ç¢°åˆ°äº†é—®é¢˜å†æ¥å‚è€ƒä¼šæ›´å¥½ç†è§£ã€‚","like_count":16,"discussions":[{"author":{"id":1133945,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4d/79/803537db.jpg","nickname":"æ…¢åŠ¨ä½œ","note":"","ucode":"62C944F4A4D8AC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379055,"discussion_content":"åº”è¯¥å°±æ˜¯æºç çš„æè¿°ï¼Œæ„Ÿè§‰çœ‹apiå°±å¥½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623654058,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":140049,"user_name":"wang jl","can_delete":false,"product_type":"c1","uid":1328098,"ip_address":"","ucode":"F32E4921EAECC1","user_header":"https://static001.geekbang.org/account/avatar/00/14/43/e2/a1ff289c.jpg","comment_is_top":false,"comment_ctime":1570796600,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"53110404152","product_id":100013101,"comment_content":"æˆ‘å°±æƒ³çœ‹bufio.Scanneræ‰ä¹°çš„è¿™ä¸ªæ•™ç¨‹ğŸ˜“ç»“æœæ˜¯æ€è€ƒé¢˜","like_count":13},{"had_liked":false,"id":296800,"user_name":"moonfox","can_delete":false,"product_type":"c1","uid":1526355,"ip_address":"","ucode":"902BFF40EFA9FA","user_header":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","comment_is_top":false,"comment_ctime":1623164434,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18803033618","product_id":100013101,"comment_content":"å¯ä»¥æŠŠ io.Reader æˆ– strings.NewReader æƒ³åƒæˆä¸€ä¸ªå®é™…çš„å­˜åœ¨äºç¡¬ç›˜ä¹‹ä¸Šçš„æ–‡ä»¶IOå¯¹è±¡ï¼Œä½ è¦å¯¹è¿™ä¸ªæ–‡ä»¶è¿›è¡Œè¯»å†™æ“ä½œï¼Œæ„Ÿè§‰è¿™æ ·æ¯”è¾ƒç”ŸåŠ¨å…·ä½“ï¼Œå¯ä»¥æ›´å¥½çš„ç†è§£bufioåŒ…çš„åŠŸèƒ½ç”¨é€”ï¼ŒbufioåŒ…å¯ä»¥æœ‰æ•ˆçš„é™ä½ç³»ç»ŸIOçš„è¯»å†™æ¬¡æ•°ï¼Œä»è€Œæé«˜äº†ç¨‹åºçš„æ€§èƒ½ã€‚ XD","like_count":5},{"had_liked":false,"id":262810,"user_name":"è¶£å­¦è½¦","can_delete":false,"product_type":"c1","uid":1505155,"ip_address":"","ucode":"5279A6BF4C67A3","user_header":"https://static001.geekbang.org/account/avatar/00/16/f7/83/7fa4bd45.jpg","comment_is_top":false,"comment_ctime":1605849069,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18785718253","product_id":100013101,"comment_content":"bufio.Scanner é€šè¿‡ä¸€ä¸ªåˆ†éš”å‡½æ•°ï¼Œå¾ªç¯è¯»å–åº•å±‚è¯»å–å™¨ä¸­çš„å†…å®¹ï¼Œæ¯æ¬¡è¯»å–ä¸€æ®µï¼Œä½¿ç”¨Scanner.Scan() è¯»å–ï¼Œ é€šè¿‡Scanner.Text() æˆ– Scanner.Bytes() è·å–è¯»åˆ°çš„å†…å®¹","like_count":5},{"had_liked":false,"id":186786,"user_name":"ä¹–ï¼Œæ‘¸æ‘¸å¤´","can_delete":false,"product_type":"c1","uid":1611745,"ip_address":"","ucode":"BD92741A11D3CD","user_header":"https://static001.geekbang.org/account/avatar/00/18/97/e1/0f4d90ff.jpg","comment_is_top":false,"comment_ctime":1583924912,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"14468826800","product_id":100013101,"comment_content":"å¥½å§ï¼Œçœ‹äº†æºç ï¼Œ writer2.ReadFrom åªæœ‰ç¼“å†²åŒºä¸º0æ‰ä¼šè·¨è¿‡ç¼“å†²åŒº","like_count":3},{"had_liked":false,"id":125622,"user_name":"å¼ å‰‘","can_delete":false,"product_type":"c1","uid":1203791,"ip_address":"","ucode":"DB03987538F89C","user_header":"https://static001.geekbang.org/account/avatar/00/12/5e/4f/56ad818d.jpg","comment_is_top":false,"comment_ctime":1566215868,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14451117756","product_id":100013101,"comment_content":"å…ˆå­¦ä¸€é æœ‰ä¸ªæ•´ä½“çš„åˆ†ç±»å’Œç²—ç•¥äº†è§£ ä»¥åæœ‰ç”¨åˆ°è¿˜å¯å›æ¥æ‰¾åˆ°","like_count":3},{"had_liked":false,"id":288736,"user_name":"æˆäººä»¥ğŸŸï¼Œä¸å¦‚æˆäººä»¥æ¸”","can_delete":false,"product_type":"c1","uid":1193874,"ip_address":"","ucode":"BD53829E924B66","user_header":"https://static001.geekbang.org/account/avatar/00/12/37/92/961ba560.jpg","comment_is_top":false,"comment_ctime":1618646877,"is_pvip":true,"replies":[{"id":"104785","content":"ç®€å•è¯´ï¼Œå¦‚æœæ˜¯å•ç‹¬çš„APIï¼Œé‚£ä¹ˆèµ·ç éœ€è¦æ˜ç¡®ä½“ç°è¿”å›å€¼çš„å«ä¹‰ï¼Œä»¥åŠåœ¨å‡ºç°é”™è¯¯æˆ–å¼‚å¸¸æƒ…å†µä¸‹çš„å…·ä½“è¡Œä¸ºã€‚<br><br>å¦‚æœæ˜¯æˆä½“ç³»çš„APIï¼Œé‚£å°±è¦éµå¾ªå®Œæ•´ç»Ÿä¸€çš„è§„èŒƒäº†ã€‚è¿™ä¸ªè§„èŒƒå¯ä»¥æ ¹æ®é¡¹ç›®çš„å®é™…æƒ…å†µã€å›¢é˜Ÿçš„æ—¢æœ‰ä¹ æƒ¯å’Œé£æ ¼è‡ªå·±å®šä¹‰ï¼Œæ¯”å¦‚ï¼šè¿”å›å€¼æ–‡æ¡£çš„å†™æ³•ã€è¿”å›å€¼çš„å‘½åæ–¹æ³•ã€å¤šè¿”å›å€¼çš„æ¬¡åºã€å¤šè¿”å›å€¼çš„è”åˆèµ‹å€¼æ–¹å¼ï¼ˆå¦‚â€œè‹¥errä¸ä¸ºnilåˆ™retå¿…ä¸º0â€ä¹‹ç±»çš„ï¼‰ç­‰ç­‰ã€‚<br><br>åˆ¶å®šè¿™ç±»è§„èŒƒçš„æ—¶å€™å¯ä»¥å¤šå‚è€ƒGoæ ‡å‡†åº“ä¸­çš„ä»£ç å’Œæ–‡æ¡£ï¼ŒåŠªåŠ›åšåˆ°è‡ªæœ‰è§„èŒƒä¸å®˜æ–¹è§„èŒƒçš„åŸºæœ¬ä¸€è‡´æ€§ã€‚è¿™æ ·åšå¯¹è·¨å›¢é˜Ÿåä½œä¼šæ›´åŠ å‹å¥½ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1618661608,"ip_address":"","comment_id":288736,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10208581469","product_id":100013101,"comment_content":"éƒè€å¸ˆï¼Œæˆ‘é€šè¿‡é˜…è¯»è¿™éƒ¨åˆ†çš„æºä»£ç æ„Ÿå—åˆ°æºä»£ç ä½œè€…çš„ç”¨å¿ƒè‰¯è‹¦ï¼Œä»¥åŠå¯¹ I&#47;O è¯»å†™æ§åˆ¶çš„ç²¾ç»†ã€‚æˆ‘çš„ç–‘é—®æ—¶ï¼šå¯¹äºæ–¹æ³•è¿”å›å€¼çš„ç”¨é€”ï¼Œä»¥åŠåœ¨è®¾è®¡ API æ—¶ï¼Œç‰¹åˆ«æ˜¯æ–¹æ³•çš„è¿”å›å€¼éƒ½æœ‰å“ªäº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚","like_count":3,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518722,"discussion_content":"ç®€å•è¯´ï¼Œå¦‚æœæ˜¯å•ç‹¬çš„APIï¼Œé‚£ä¹ˆèµ·ç éœ€è¦æ˜ç¡®ä½“ç°è¿”å›å€¼çš„å«ä¹‰ï¼Œä»¥åŠåœ¨å‡ºç°é”™è¯¯æˆ–å¼‚å¸¸æƒ…å†µä¸‹çš„å…·ä½“è¡Œä¸ºã€‚\n\nå¦‚æœæ˜¯æˆä½“ç³»çš„APIï¼Œé‚£å°±è¦éµå¾ªå®Œæ•´ç»Ÿä¸€çš„è§„èŒƒäº†ã€‚è¿™ä¸ªè§„èŒƒå¯ä»¥æ ¹æ®é¡¹ç›®çš„å®é™…æƒ…å†µã€å›¢é˜Ÿçš„æ—¢æœ‰ä¹ æƒ¯å’Œé£æ ¼è‡ªå·±å®šä¹‰ï¼Œæ¯”å¦‚ï¼šè¿”å›å€¼æ–‡æ¡£çš„å†™æ³•ã€è¿”å›å€¼çš„å‘½åæ–¹æ³•ã€å¤šè¿”å›å€¼çš„æ¬¡åºã€å¤šè¿”å›å€¼çš„è”åˆèµ‹å€¼æ–¹å¼ï¼ˆå¦‚â€œè‹¥errä¸ä¸ºnilåˆ™retå¿…ä¸º0â€ä¹‹ç±»çš„ï¼‰ç­‰ç­‰ã€‚\n\nåˆ¶å®šè¿™ç±»è§„èŒƒçš„æ—¶å€™å¯ä»¥å¤šå‚è€ƒGoæ ‡å‡†åº“ä¸­çš„ä»£ç å’Œæ–‡æ¡£ï¼ŒåŠªåŠ›åšåˆ°è‡ªæœ‰è§„èŒƒä¸å®˜æ–¹è§„èŒƒçš„åŸºæœ¬ä¸€è‡´æ€§ã€‚è¿™æ ·åšå¯¹è·¨å›¢é˜Ÿåä½œä¼šæ›´åŠ å‹å¥½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618661608,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288733,"user_name":"æˆäººä»¥ğŸŸï¼Œä¸å¦‚æˆäººä»¥æ¸”","can_delete":false,"product_type":"c1","uid":1193874,"ip_address":"","ucode":"BD53829E924B66","user_header":"https://static001.geekbang.org/account/avatar/00/12/37/92/961ba560.jpg","comment_is_top":false,"comment_ctime":1618645699,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"10208580291","product_id":100013101,"comment_content":"ã€Œbufio.Readerç±»å‹çš„ Peek æ–¹æ³•æœ‰ä¸€ä¸ªé²œæ˜çš„ç‰¹ç‚¹ï¼Œé‚£å°±æ˜¯ï¼šå³ä½¿å®ƒè¯»å–äº†ç¼“å†²åŒºä¸­çš„æ•°æ®ï¼Œä¹Ÿä¸ä¼šæ›´æ”¹å·²è¯»è®¡æ•°çš„å€¼ã€‚ã€è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯ Peek æ–¹æ³•å¯èƒ½ä¼šä¿®æ”¹ b.r å’Œ b.w çš„å€¼ï¼Œä½†æ˜¯å¯¹äº Peek æ–¹æ³•æ¥è¯´ï¼Œå…¶å«ä¹‰æ˜¯å¹¶éæ˜¯ä¸€ç§â€œçœŸå®â€çš„è¯»å–ï¼Œæ„å‘³ç€æ¥ä¸‹æ¥å†ç”¨ ReadByte è¿˜èƒ½è¯»å–åˆ°ç›¸åŒçš„æ•°æ®ã€‚æ¯”å¦‚ç”¨ä¸‹é¢çš„ç¤ºä¾‹ç¨‹åºå¯ä»¥éªŒè¯ï¼š<br><br>func main() {<br>\tbuf := bytes.NewBufferString(&quot;abcd&quot;)<br>\treader := bufio.NewReader(buf)<br><br>\tslice, err := reader.Peek(4)<br>\tif err != nil {<br>\t\tlog.Fatal(err)<br>\t}<br>\tfmt.Printf(&quot;%v.\\n&quot;, slice)<br><br>\tvalue, err := reader.ReadByte()<br>\tfmt.Printf(&quot;%v.\\n&quot;, value)<br>}","like_count":3},{"had_liked":false,"id":164134,"user_name":"Richard","can_delete":false,"product_type":"c1","uid":1316758,"ip_address":"","ucode":"893F958B9DD161","user_header":"https://static001.geekbang.org/account/avatar/00/14/17/96/846fc11b.jpg","comment_is_top":false,"comment_ctime":1576893391,"is_pvip":false,"replies":[{"id":"62393","content":"â€œå¡«å……â€å’Œâ€œå¡«æ»¡â€æ˜¯æœ‰åŒºåˆ«çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1576904940,"ip_address":"","comment_id":164134,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5871860687","product_id":100013101,"comment_content":"â€œ ReadSliceæ–¹æ³•ä¼šå…ˆåœ¨å…¶ç¼“å†²åŒºçš„æœªè¯»éƒ¨åˆ†ä¸­å¯»æ‰¾åˆ†éš”ç¬¦ã€‚å¦‚æœæœªèƒ½æ‰¾åˆ°ï¼Œå¹¶ä¸”ç¼“å†²åŒºæœªæ»¡ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•ä¼šå…ˆé€šè¿‡è°ƒç”¨fillæ–¹æ³•å¯¹ç¼“å†²åŒºè¿›è¡Œå¡«å……ï¼Œç„¶åå†æ¬¡å¯»æ‰¾ï¼Œå¦‚æ­¤å¾€å¤ã€‚â€  è™½ç„¶é€šè¿‡åç»­å†…å®¹äº†è§£äº†ReadSliceæ–¹æ³•åªå¡«æ»¡ä¸€æ¬¡ç¼“å†²åŒºï¼Œä½†æ˜¯è¿™é‡Œä¸Šä¸‹æ–‡ä¸­çš„ â€œå¦‚æ­¤åå¤â€ ä¸€è¯å®¹æ˜“è®©äººäº§ç”Ÿå’ŒreadbyteåŠŸèƒ½ä¸€æ ·çš„è¯¯è§£ã€‚","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478652,"discussion_content":"â€œå¡«å……â€å’Œâ€œå¡«æ»¡â€æ˜¯æœ‰åŒºåˆ«çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576904940,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":315296,"user_name":"jxs1211","can_delete":false,"product_type":"c1","uid":1101006,"ip_address":"","ucode":"B7F1F2D84389E7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKELX1Rd1vmLRWibHib8P95NA87F4zcj8GrHKYQL2RcLDVnxNy1ia2geTWgW6L2pWn2kazrPNZMRVrIg/132","comment_is_top":false,"comment_ctime":1633792142,"is_pvip":false,"replies":[{"id":"114314","content":"ç¬¬ä¸€ä¸ªé—®é¢˜ï¼ŒfullBuffers åœ¨ collectFragments æ–¹æ³•ä¸­ä»£è¡¨äº†ä¸€ä¸ªæœ‰åçš„ç»“æœå•Šã€‚<br><br>å®ƒçš„å£°æ˜å·²ç»åŒ…å«åœ¨è¯¥æ–¹æ³•çš„ç­¾åä¸­äº†ï¼š<br><br>  collectFragments(delim byte) (fullBuffers [][]byte, finalFragment []byte, totalLen int, err error)<br><br>å‡½æ•°æˆ–æ–¹æ³•ç­¾åä¸­çš„æœ‰åç»“æœä¼šåœ¨è¯¥å‡½æ•°æˆ–æ–¹æ³•è¢«è°ƒç”¨æ—¶è‡ªåŠ¨åœ°åˆ›å»ºå¹¶åˆå§‹åŒ–ï¼Œå…¶åˆå§‹åŒ–å€¼ä¼šæ˜¯å…¶ç±»å‹çš„é›¶å€¼ã€‚<br><br>ç¬¬äºŒä¸ªé—®é¢˜ï¼Œä½ è¯´çš„å¯¹ã€‚<br><br>collectFragments æ–¹æ³•å…¶å®æ˜¯åœ¨åšäºŒæ¬¡ç¼“å­˜ï¼Œä¸è®ºè¯»å–æˆåŠŸè¿˜æ˜¯å‡ºé”™ï¼Œéƒ½å…ˆç”¨â€œï¼ˆåŠ¨æ€ï¼‰ç»“æ„åŒ–â€çš„æ–¹å¼æŠŠæ‰«æè¿‡çš„æ•°æ®ç¼“å­˜ä¸‹æ¥ï¼Œä½†æŠŠâ€œæˆè´¥â€çš„åˆ¤å®šæƒç•™ç»™è°ƒç”¨å®ƒçš„ä»£ç ã€‚æ›´ç¡®åˆ‡åœ°è¯´ï¼Œæ˜¯ç•™ç»™ collectFragments æ–¹æ³•çš„è°ƒç”¨æ–¹çš„è°ƒç”¨æ–¹ã€‚<br><br>è¿™ç›¸å½“äºï¼šâ€œæˆ‘â€åœ¨å†…éƒ¨æŠŠæ¯”è¾ƒç¹æ‚ä»¥åŠå®¹æ˜“é€ æˆï¼ˆç©ºé—´æˆ–æ—¶é—´ï¼‰æµªè´¹çš„é‚£éƒ¨åˆ†æ“ä½œå…ˆåšäº†ï¼Œæ­£æ‰€è°“â€œå†…ç½®äº†æœ€ä½³å®è·µâ€ï¼Œè‡³äºæ“ä½œç»“æœçš„è§£è¯»â€œä½ ä»¬â€è‡ªå·±åšå§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1633939008,"ip_address":"","comment_id":315296,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1633792142","product_id":100013101,"comment_content":"è¯·æ•™ä¸€ä¸ªè¯»ä»£ç æ˜¯é‡åˆ°çš„ç–‘é—®ï¼ŒcollectFragmentsæ–¹æ³•ä¸­fullBufferså¹¶æ²¡æœ‰æå‰å£°æ˜ï¼Œè¿™æ ·ä¹Ÿå¯æ·»åŠ buffå—å—ï¼Œå¦å¤–æ³¨é‡Šä¸­è¯´è¿™ç§æ–¹å¼å¯ä»¥å‡å°‘è°ƒç”¨æ—¶çš„å†…å­˜å¼€é”€å’Œæ•°æ®æ‹·è´ï¼Œæ˜¯æŒ‡è¿™é‡Œåˆ†ç‰‡æ‹·è´åä¸€æ¬¡å¡«å……åˆ°ä¸€ä¸ªåˆ‡ç‰‡ä¸­è¿”å›ï¼Œå°±ä¸ç”¨å¤–éƒ¨è°ƒç”¨è€…è‡ªå·±å»ç»„è£…çš„æ„æ€å—","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527927,"discussion_content":"ç¬¬ä¸€ä¸ªé—®é¢˜ï¼ŒfullBuffers åœ¨ collectFragments æ–¹æ³•ä¸­ä»£è¡¨äº†ä¸€ä¸ªæœ‰åçš„ç»“æœå•Šã€‚\n\nå®ƒçš„å£°æ˜å·²ç»åŒ…å«åœ¨è¯¥æ–¹æ³•çš„ç­¾åä¸­äº†ï¼š\n\n  collectFragments(delim byte) (fullBuffers [][]byte, finalFragment []byte, totalLen int, err error)\n\nå‡½æ•°æˆ–æ–¹æ³•ç­¾åä¸­çš„æœ‰åç»“æœä¼šåœ¨è¯¥å‡½æ•°æˆ–æ–¹æ³•è¢«è°ƒç”¨æ—¶è‡ªåŠ¨åœ°åˆ›å»ºå¹¶åˆå§‹åŒ–ï¼Œå…¶åˆå§‹åŒ–å€¼ä¼šæ˜¯å…¶ç±»å‹çš„é›¶å€¼ã€‚\n\nç¬¬äºŒä¸ªé—®é¢˜ï¼Œä½ è¯´çš„å¯¹ã€‚\n\ncollectFragments æ–¹æ³•å…¶å®æ˜¯åœ¨åšäºŒæ¬¡ç¼“å­˜ï¼Œä¸è®ºè¯»å–æˆåŠŸè¿˜æ˜¯å‡ºé”™ï¼Œéƒ½å…ˆç”¨â€œï¼ˆåŠ¨æ€ï¼‰ç»“æ„åŒ–â€çš„æ–¹å¼æŠŠæ‰«æè¿‡çš„æ•°æ®ç¼“å­˜ä¸‹æ¥ï¼Œä½†æŠŠâ€œæˆè´¥â€çš„åˆ¤å®šæƒç•™ç»™è°ƒç”¨å®ƒçš„ä»£ç ã€‚æ›´ç¡®åˆ‡åœ°è¯´ï¼Œæ˜¯ç•™ç»™ collectFragments æ–¹æ³•çš„è°ƒç”¨æ–¹çš„è°ƒç”¨æ–¹ã€‚\n\nè¿™ç›¸å½“äºï¼šâ€œæˆ‘â€åœ¨å†…éƒ¨æŠŠæ¯”è¾ƒç¹æ‚ä»¥åŠå®¹æ˜“é€ æˆï¼ˆç©ºé—´æˆ–æ—¶é—´ï¼‰æµªè´¹çš„é‚£éƒ¨åˆ†æ“ä½œå…ˆåšäº†ï¼Œæ­£æ‰€è°“â€œå†…ç½®äº†æœ€ä½³å®è·µâ€ï¼Œè‡³äºæ“ä½œç»“æœçš„è§£è¯»â€œä½ ä»¬â€è‡ªå·±åšå§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633939008,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":309562,"user_name":"lesserror","can_delete":false,"product_type":"c1","uid":1351076,"ip_address":"","ucode":"25A54D1165FCF6","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","comment_is_top":false,"comment_ctime":1630232728,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630232728","product_id":100013101,"comment_content":"å¤§å®¶ä¸€å®šè¦çœ‹çœ‹è€å¸ˆå†™çš„ç¤ºä¾‹ä»£ç ï¼Œå†™çš„éå¸¸ç”¨å¿ƒäº†ã€‚","like_count":0},{"had_liked":false,"id":297582,"user_name":"æ…¢åŠ¨ä½œ","can_delete":false,"product_type":"c1","uid":1133945,"ip_address":"","ucode":"62C944F4A4D8AC","user_header":"https://static001.geekbang.org/account/avatar/00/11/4d/79/803537db.jpg","comment_is_top":false,"comment_ctime":1623654123,"is_pvip":true,"replies":[{"id":"108099","content":"é‚£ç¥è´ºä½ ï¼Œè¯´æ˜ä½ å·²ç»ç†ŸçŸ¥è¿™äº›çŸ¥è¯†ç‚¹äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1623739141,"ip_address":"","comment_id":297582,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1623654123","product_id":100013101,"comment_content":"è¿™å‡ èŠ‚æ„Ÿè§‰ç›´æ¥çœ‹apiæˆ–æºç å°±å¥½ï¼Œæ²¡æœ‰ä»€ä¹ˆå°è±¡æ·±åˆ»çš„åœ°æ–¹","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521865,"discussion_content":"é‚£ç¥è´ºä½ ï¼Œè¯´æ˜ä½ å·²ç»ç†ŸçŸ¥è¿™äº›çŸ¥è¯†ç‚¹äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623739141,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1133945,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4d/79/803537db.jpg","nickname":"æ…¢åŠ¨ä½œ","note":"","ucode":"62C944F4A4D8AC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379228,"discussion_content":"çœ‹çœ‹éƒ½ç®€å•ï¼Œè®©æˆ‘ä¸çœ‹è¯´å‡ºæ¥è¿˜æ˜¯ä¸è¡Œçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623760679,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2806043,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLBFkSq1oiaEMRjtyyv4ZpCI0OuaSsqs04ODm0OkZF6QhsAh3SvqhxibS2n7PLAVZE3QRSn5Hic0DyXg/132","nickname":"ddh","note":"","ucode":"8E852375365F16","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1133945,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4d/79/803537db.jpg","nickname":"æ…¢åŠ¨ä½œ","note":"","ucode":"62C944F4A4D8AC","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":541319,"discussion_content":"çœ¼é«˜æ‰‹ä½å—ï¼Œ å­¦æŠ€æœ¯ï¼Œ åˆ‡è®°æµ®èºå‘¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640330432,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":379228,"ip_address":""},"score":541319,"extra":""}]}]},{"had_liked":false,"id":186785,"user_name":"ä¹–ï¼Œæ‘¸æ‘¸å¤´","can_delete":false,"product_type":"c1","uid":1611745,"ip_address":"","ucode":"BD92741A11D3CD","user_header":"https://static001.geekbang.org/account/avatar/00/18/97/e1/0f4d90ff.jpg","comment_is_top":false,"comment_ctime":1583924770,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1583924770","product_id":100013101,"comment_content":"basicWriter3 := &amp;strings.Builder{}<br>reader2 := strings.NewReader(&quot;1234456789&quot;)<br>writer2 := bufio.NewWriterSize(basicWriter3,3)<br>writer2.WriteString(&quot;abcd&quot;)<br>&#47;&#47;æ­¤æ—¶ç¼“å†²åŒºä¸­è¿˜æœ‰æ•°æ® d, basicWriter3çš„æ•°æ®ä¸º â€abcâ€œ<br>writer2.ReadFrom(reader2) &#47;&#47;è¿™ä¸€æ­¥ä¸ç»è¿‡ç¼“å†²åŒº<br>&#47;&#47;basicWriter3.String()  æ•°æ®ç†è®ºä¸Šå°±åº”è¯¥æ˜¯ abc123456789<br>&#47;&#47;å®é™…æˆ‘æ‰“å°å‡ºæ¥çš„æ•°æ®ä¸º abcd1234567<br>writer2.Flush()<br>&#47;&#47;åº”è¯¥æ˜¯  abc123456789d æ‰å¯¹ï¼Œä½†æ˜¯å®é™…æ‰“å°å‡ºæ¥å¹¶ä¸æ˜¯è¿™æ ·çš„<br><br>","like_count":0},{"had_liked":false,"id":133328,"user_name":"John","can_delete":false,"product_type":"c1","uid":1018282,"ip_address":"","ucode":"F5ADD6603903D5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/89/aa/eb4c37db.jpg","comment_is_top":false,"comment_ctime":1568517678,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1568517678","product_id":100013101,"comment_content":"æ‰“å¡","like_count":0},{"had_liked":false,"id":120918,"user_name":"jimmy","can_delete":false,"product_type":"c1","uid":1019906,"ip_address":"","ucode":"4CB6B256917811","user_header":"https://static001.geekbang.org/account/avatar/00/0f/90/02/ba6c8c73.jpg","comment_is_top":false,"comment_ctime":1565013511,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1565013511","product_id":100013101,"comment_content":"åšæŒï¼ŒåŠ æ²¹","like_count":0},{"had_liked":false,"id":107609,"user_name":"æ›¾æ˜¥äº‘","can_delete":false,"product_type":"c1","uid":1197308,"ip_address":"","ucode":"5569D3EC9AD3B4","user_header":"https://static001.geekbang.org/account/avatar/00/12/44/fc/1ca9c88c.jpg","comment_is_top":false,"comment_ctime":1561563999,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561563999","product_id":100013101,"comment_content":"æ¯å¤©åšæŒä¸€è¯¾","like_count":0},{"had_liked":false,"id":83625,"user_name":"Zero","can_delete":false,"product_type":"c1","uid":1246799,"ip_address":"","ucode":"309EB120D5C3FF","user_header":"https://static001.geekbang.org/account/avatar/00/13/06/4f/de1e5a54.jpg","comment_is_top":false,"comment_ctime":1554686212,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554686212","product_id":100013101,"comment_content":"åšæŒ","like_count":0},{"had_liked":false,"id":75536,"user_name":"è™¢åœ‹æŠ€é†¬","can_delete":false,"product_type":"c1","uid":1056807,"ip_address":"","ucode":"5A192262AA037E","user_header":"https://static001.geekbang.org/account/avatar/00/10/20/27/a6932fbe.jpg","comment_is_top":false,"comment_ctime":1552411496,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552411496","product_id":100013101,"comment_content":"æ‰“å¡","like_count":0}]}