{"id":224523,"title":"15 | æœåŠ¡å…¥å£ï¼šç”¨Service Entryæ‰©å±•ä½ çš„ç½‘æ ¼æœåŠ¡","content":"<p><strong>è¯¾ä»¶å’ŒDemoåœ°å€</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-servicemesh\">https://gitee.com/geektime-geekbang/geektime-servicemesh</a></p>","comments":[{"had_liked":false,"id":220602,"user_name":"3Golds","can_delete":false,"product_type":"c3","uid":1203477,"ip_address":"","ucode":"A27DEF9616432A","user_header":"https://static001.geekbang.org/account/avatar/00/12/5d/15/7df9df88.jpg","comment_is_top":false,"comment_ctime":1590292689,"is_pvip":false,"replies":[{"id":81539,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"é©¬è‹¥é£","uid":1046394,"ctime":1590410560,"ip_address":"","comment_id":220602,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"1.6é»˜è®¤ä»configmapè¿‡æ»¤ä¸åˆ°äº†, ç”¨1.6çš„åŒå­¦å¯ä»¥è‡ªè¡Œå¢åŠ ä»¥ä¸‹å­—æ®µåˆ°configmap\n\n```\n    outboundTrafficPolicy:\n      mode: REGISTRY_ONLY\n```","like_count":5,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"é©¬è‹¥é£","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496185,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590410560,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1336951,"avatar":"https://static001.geekbang.org/account/avatar/00/14/66/77/194ba21d.jpg","nickname":"ileruza","note":"","ucode":"C3D83DF4230109","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576501,"discussion_content":"mesh: |-\n    accessLogEncoding: TEXT\n    accessLogFile: /dev/stdout\n    accessLogFormat: &#34;&#34;\n    outboundTrafficPolicy:\n        mode: REGISTRY_ONLY\n\n\nè¦è®²å°±èƒ½ä¸èƒ½è®²æ¸…æ¥šä¸€ç‚¹â€¦â€¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655609461,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":223152,"user_name":"éª¨æ±¤é¸¡è›‹é¢","can_delete":false,"product_type":"c3","uid":1050002,"ip_address":"","ucode":"2AC141A523E710","user_header":"https://static001.geekbang.org/account/avatar/00/10/05/92/b609f7e3.jpg","comment_is_top":false,"comment_ctime":1591010165,"is_pvip":false,"replies":[{"id":82331,"content":"é¦–å…ˆç¡®è®¤ä¸€ä¸‹émeshçš„æœåŠ¡æ˜¯å¦éœ€è¦çº³å…¥åˆ°meshå†…è¿›è¡Œæµæ§ï¼Ÿå¦‚æœä¸éœ€è¦ï¼Œå°±ä¸ç”¨éå¾—ç”¨ServiceEntryã€‚\nmeshæœåŠ¡å’ŒémeshæœåŠ¡å»ºè®®åˆ†namespaceï¼Œæ–¹ä¾¿ç®¡ç†ï¼Œé€æ­¥è¿ç§»ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é©¬è‹¥é£","uid":1046394,"ctime":1591092437,"ip_address":"","comment_id":223152,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"è€å¸ˆï¼Œæˆ‘åœ¨ç ”ç©¶å¦‚ä½•å°†mesh è½åœ°åˆ°å…¬å¸ï¼Œå…¬å¸å·²æœ‰çš„å®¹å™¨é›†ç¾¤ æ²¡åŠæ³•ä¸€ä¸‹å­å…¨åˆ‡å…¥åˆ°mesh ä¸­æ¥ï¼Œæ¯”å¦‚æœ‰ä¸€éƒ¨åˆ†pod æœ‰envoy sidecar ï¼Œæœ‰ä¸€éƒ¨åˆ†pod æ²¡æœ‰envoyï¼Œæˆ‘ä»Šå¤©å°è¯•ä½¿ç”¨istio ingress è®¿é—®ä¸å¸¦sidecarçš„podæ—¶ï¼Œè¿”å›no healthy upstream\nè¯·é—®è¿™ä¸ªé—®é¢˜èƒ½ç”¨ ServiceEntry è§£å†³å˜›ï¼Ÿæˆ–è€…æ›´ä¼˜é›…çš„æ–¹å¼è€å¸ˆå¯ä»¥æŒ‡ç‚¹ä¸€ä¸‹å˜›ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"é©¬è‹¥é£","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":497030,"discussion_content":"é¦–å…ˆç¡®è®¤ä¸€ä¸‹émeshçš„æœåŠ¡æ˜¯å¦éœ€è¦çº³å…¥åˆ°meshå†…è¿›è¡Œæµæ§ï¼Ÿå¦‚æœä¸éœ€è¦ï¼Œå°±ä¸ç”¨éå¾—ç”¨ServiceEntryã€‚\nmeshæœåŠ¡å’ŒémeshæœåŠ¡å»ºè®®åˆ†namespaceï¼Œæ–¹ä¾¿ç®¡ç†ï¼Œé€æ­¥è¿ç§»ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591092437,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":210382,"user_name":"æ€ç»´å†³å®šæœªæ¥","can_delete":false,"product_type":"c3","uid":1412891,"ip_address":"","ucode":"88CC245B3C6E2D","user_header":"","comment_is_top":false,"comment_ctime":1587733361,"is_pvip":false,"replies":[{"id":78428,"content":"ç®€å•æ¥è¯´ï¼š\n1. å¦‚æœresolutioné…çš„æ˜¯DNSï¼Œæ²¡æœ‰é…ç½®endpointï¼Œå®ƒä¼šé…åˆhostså­—æ®µè¿›è¡Œè§£æï¼›\n2. å¦‚æœè®¾ç½®äº†endpointä¸ºå…·ä½“IPï¼Œresolutionå°±è¦è®¾ç½®ä¸ºSTATICï¼Œè¡¨ç¤ºç›´æ¥ä½¿ç”¨IPï¼Œä¸ç”¨è§£æï¼›\n3. å¦‚æœresolutioné…çš„æ˜¯DNSï¼Œä¹Ÿé…ç½®äº†endpointï¼Œä¼šè§£æendpointé‡Œè®¾ç½®çš„åœ°å€ï¼›\n4. addressè¿™ä¸ªå­—æ®µæ˜¯å…³è”æœåŠ¡çš„VIPåœ°å€ï¼Œå¯¹HTTPæ˜¯ä¸ç”Ÿæ•ˆçš„ã€‚\nå¯ä»¥å†ä»”ç»†ç¢ç£¨ä¸‹è¿™ä¸ªç¤ºä¾‹ï¼š\napiVersion: networking.istio.io&#47;v1alpha3\nkind: ServiceEntry\nmetadata:\n  name: external-svc-mongocluster\nspec:\n  hosts:\n  - mymongodb.somedomain # not used\n  addresses:\n  - 192.192.192.192&#47;24 # VIPs\n  ports:\n  - number: 27018\n    name: mongodb\n    protocol: MONGO\n  location: MESH_INTERNAL\n  resolution: STATIC\n  endpoints:\n  - address: 2.2.2.2\n  - address: 3.3.3.3\n","user_name":"ä½œè€…å›å¤","user_name_real":"é©¬è‹¥é£","uid":1046394,"ctime":1587808356,"ip_address":"","comment_id":210382,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"è€å¸ˆèƒ½è¯¦ç»†è®²ä¸‹resolutionï¼Œaddresseså’Œendpointè¿™å‡ ä¸ªå‚æ•°çš„é…åˆä½¿ç”¨å—ï¼Ÿçœ‹äº†å®˜æ–¹æ–‡æ¡£è¿˜æ˜¯ä¼¼æ‡‚éæ‡‚","like_count":1,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"é©¬è‹¥é£","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493010,"discussion_content":"ç®€å•æ¥è¯´ï¼š\n1. å¦‚æœresolutioné…çš„æ˜¯DNSï¼Œæ²¡æœ‰é…ç½®endpointï¼Œå®ƒä¼šé…åˆhostså­—æ®µè¿›è¡Œè§£æï¼›\n2. å¦‚æœè®¾ç½®äº†endpointä¸ºå…·ä½“IPï¼Œresolutionå°±è¦è®¾ç½®ä¸ºSTATICï¼Œè¡¨ç¤ºç›´æ¥ä½¿ç”¨IPï¼Œä¸ç”¨è§£æï¼›\n3. å¦‚æœresolutioné…çš„æ˜¯DNSï¼Œä¹Ÿé…ç½®äº†endpointï¼Œä¼šè§£æendpointé‡Œè®¾ç½®çš„åœ°å€ï¼›\n4. addressè¿™ä¸ªå­—æ®µæ˜¯å…³è”æœåŠ¡çš„VIPåœ°å€ï¼Œå¯¹HTTPæ˜¯ä¸ç”Ÿæ•ˆçš„ã€‚\nå¯ä»¥å†ä»”ç»†ç¢ç£¨ä¸‹è¿™ä¸ªç¤ºä¾‹ï¼š\napiVersion: networking.istio.io/v1alpha3\nkind: ServiceEntry\nmetadata:\n  name: external-svc-mongocluster\nspec:\n  hosts:\n  - mymongodb.somedomain # not used\n  addresses:\n  - 192.192.192.192/24 # VIPs\n  ports:\n  - number: 27018\n    name: mongodb\n    protocol: MONGO\n  location: MESH_INTERNAL\n  resolution: STATIC\n  endpoints:\n  - address: 2.2.2.2\n  - address: 3.3.3.3\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587808356,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2037440,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/16/c0/753248c0.jpg","nickname":"MonsterSquad","note":"","ucode":"D13ABF4B906A8B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372501,"discussion_content":"è€å¸ˆ è¿™ä¸ªendpointsä¸­çš„addressæ˜¯çœŸå®mongodbçš„åœ°å€å—ï¼ˆæˆ‘ç†è§£ä¸ºPodåœ°å€ï¼‰ï¼Œé‚£spec.addresså¯¹åº”çš„VIPSå°±æ˜¯K8såŸç”Ÿçš„serviceå—ï¼ˆæˆ‘ç†è§£ä¸ºk8såŸç”Ÿservice çš„åœ°å€ï¼Œé‚£ä¹ˆå¦‚æœæ˜¯æˆ‘å†™æˆheaderlessçš„åŸŸåmymongodb.devã€Œåé¢.svc.cluster.localçœç•¥ã€æˆ‘çš„locationå°±å¾—å†™æˆDNSï¼‰ï¼Œè€å¸ˆæ˜¯è¿™æ ·ç†è§£çš„å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620356537,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":247887,"user_name":"è‚¥å°è‚‰","can_delete":false,"product_type":"c3","uid":1934265,"ip_address":"","ucode":"9BAE9BE5734B38","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTINjIqCwibaXkoq9acCZg7YnEXKYFT20ng01sCHf6iaLlkSdRIJ15F8olsBicMZwT9IIPa2OlNrdicgJA/132","comment_is_top":false,"comment_ctime":1599902453,"is_pvip":false,"replies":[{"id":91192,"content":"è¿™ä¸ªä¸åº”è¯¥å•Šï¼Œistioctl profile diff default demo çœ‹çœ‹æ˜¯ä¸æ˜¯profileæœ‰ä»€ä¹ˆé—®é¢˜ã€‚ä¸è¡Œå†é‡æ–°å®‰è£…ä¸€ä¸‹","user_name":"ä½œè€…å›å¤","user_name_real":"é©¬è‹¥é£","uid":1046394,"ctime":1600060980,"ip_address":"","comment_id":247887,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"å®‰è£…istio1.7ï¼ŒæŒ‰ç…§å‘½ä»¤å¸®åŠ©æç¤ºç”¨ä¸‹åˆ—å‘½ä»¤å®‰è£…demoé…ç½®\nistioctl install --set profile=demo --skip-confirmation\nå®‰è£…å¥½ååªæœ‰istiod ingress egressä¸‰ä¸ªæœåŠ¡ï¼Œé‚£äº›demoåº”è¯¥æœ‰çš„kialiï¼Œjagerç­‰éƒ½æ²¡æœ‰","like_count":0,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"é©¬è‹¥é£","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505521,"discussion_content":"è¿™ä¸ªä¸åº”è¯¥å•Šï¼Œistioctl profile diff default demo çœ‹çœ‹æ˜¯ä¸æ˜¯profileæœ‰ä»€ä¹ˆé—®é¢˜ã€‚ä¸è¡Œå†é‡æ–°å®‰è£…ä¸€ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600060980,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005634,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/58/42/abb7bfe3.jpg","nickname":"eric-xin","note":"","ucode":"B10BB7796CDF6B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366953,"discussion_content":"ç”¨è¿™ä¸ªå‘½ä»¤ï¼šistioctl manifest apply --set profile=demo \n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618223491,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1934265,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTINjIqCwibaXkoq9acCZg7YnEXKYFT20ng01sCHf6iaLlkSdRIJ15F8olsBicMZwT9IIPa2OlNrdicgJA/132","nickname":"è‚¥å°è‚‰","note":"","ucode":"9BAE9BE5734B38","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":305693,"discussion_content":"æˆ‘åªå¥½å†ä½¿ç”¨å‘½ä»¤æ‰å®‰è£…å¥½é‚£å‡ ä¸ªæ’ä»¶\nkubectl apply -f samples/addones -n istio-system","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600061252,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":242033,"user_name":"å½¬å°‘","can_delete":false,"product_type":"c3","uid":1460396,"ip_address":"","ucode":"B4A7FDC62C48B1","user_header":"https://static001.geekbang.org/account/avatar/00/16/48/ac/045a2ccb.jpg","comment_is_top":false,"comment_ctime":1597567010,"is_pvip":false,"replies":[{"id":89582,"content":"ä½ è¯´çš„éƒ½å¯¹ï¼Œä¸»è¦æ˜¯çœ‹ä½ éœ€ä¸éœ€è¦æŠŠå¤–éƒ¨æµé‡çº³å…¥åˆ°meshç»Ÿä¸€ç®¡ç†ï¼Œå¦‚æœä¸éœ€è¦ï¼Œä½ çš„è§£å†³æ–¹æ¡ˆéƒ½okã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é©¬è‹¥é£","uid":1046394,"ctime":1597919134,"ip_address":"","comment_id":242033,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"è¯¾åä¹ é¢˜ï¼Œé…ç½®é’ˆå¯¹httpsåè®®çš„æœåŠ¡å…¥å£ã€‚\napiVersion: networking.istio.io&#47;v1alpha3\nkind: ServiceEntry\nmetadata:\n name: baidu-portal\nspec:\n hosts:\n - www.baidu.com\n ports:\n - number: 443\n   name: https-port\n   protocol: HTTPS\n resolution: DNS\n\nå¦å¤–æƒ³è¯·æ•™ä¸€ä¸‹è€å¸ˆï¼ŒserviceEntryåœ¨ç”Ÿäº§ç¯å¢ƒåº”ç”¨å¾—å¤šä¸å¤šï¼Œæœ‰ä»€ä¹ˆå…·ä½“çš„ä¸šåŠ¡åœºæ™¯é€‚ç”¨ï¼Ÿæ„Ÿè§‰å¦‚æœåªæ˜¯æ§åˆ¶å¤–éƒ¨èµ„æºæ˜¯å¦å¯è®¿é—®ï¼Œä¸€èˆ¬éƒ½ä¼šåœ¨å®‰å…¨å·¥å…·ä¸Šæ·»åŠ é™åˆ¶ï¼›å¦‚æœæ˜¯å¤–éƒ¨èµ„æºå¤„ç†èƒ½åŠ›ä¸ä½³éœ€è¦é™æµï¼Œä¹Ÿæ˜¯è¦ç»“åˆå…·ä½“ä¸šåŠ¡åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­è¿›è¡Œæ§åˆ¶æ¯”è¾ƒåˆé€‚ã€‚","like_count":0,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"é©¬è‹¥é£","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503907,"discussion_content":"ä½ è¯´çš„éƒ½å¯¹ï¼Œä¸»è¦æ˜¯çœ‹ä½ éœ€ä¸éœ€è¦æŠŠå¤–éƒ¨æµé‡çº³å…¥åˆ°meshç»Ÿä¸€ç®¡ç†ï¼Œå¦‚æœä¸éœ€è¦ï¼Œä½ çš„è§£å†³æ–¹æ¡ˆéƒ½okã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597919134,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":230069,"user_name":"é¾šå·§","can_delete":false,"product_type":"c3","uid":1045844,"ip_address":"","ucode":"97FABC0B91971A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f5/54/8062d599.jpg","comment_is_top":false,"comment_ctime":1593250328,"is_pvip":false,"replies":[{"id":85008,"content":"kubectl get configmap istio -n istio-system -o yaml | sed &#39;s&#47;mode: ALLOW_ANY&#47;mode: ALLOW_ANYREGISTRY_ONLY&#47;g&#39; | kubectl replace -n istio-system -f -\nå…ˆçœ‹çœ‹configmapç”Ÿæ•ˆæ²¡ï¼›\nå¦å¤–ä½ æ˜¯æ€ä¹ˆè®¿é—®çš„ï¼Ÿè®¿é—®å¤–ç½‘çš„æœåŠ¡æ˜¯å¦æ³¨å…¥äº†sidecarï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"é©¬è‹¥é£","uid":1046394,"ctime":1593334628,"ip_address":"","comment_id":230069,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"æˆ‘ istio 1.5.1 ç‰ˆæœ¬ configmap   outboundTrafficPolicy: mode: REGISTRY_ONLY  æ²¡æœ‰å®šä¹‰æœåŠ¡å…¥å£è¿˜æ˜¯ç›´æ¥å¯ä»¥è®¿é—®å¤–ç½‘ï¼Ÿå“ªé‡Œè®¾ç½®çš„æœ‰é—®é¢˜ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"é©¬è‹¥é£","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499752,"discussion_content":"kubectl get configmap istio -n istio-system -o yaml | sed &amp;#39;s/mode: ALLOW_ANY/mode: ALLOW_ANYREGISTRY_ONLY/g&amp;#39; | kubectl replace -n istio-system -f -\nå…ˆçœ‹çœ‹configmapç”Ÿæ•ˆæ²¡ï¼›\nå¦å¤–ä½ æ˜¯æ€ä¹ˆè®¿é—®çš„ï¼Ÿè®¿é—®å¤–ç½‘çš„æœåŠ¡æ˜¯å¦æ³¨å…¥äº†sidecarï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593334628,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1600767,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epvYc3REh3jaTt9hPxj4alDicbzsawNyvaxMCTKcPHtK2b8EoI0HTsicaTzsrVo2hBhl9tbGXiaUxFYA/132","nickname":"WandaYu","note":"","ucode":"17D97DF0803BF4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":365603,"discussion_content":"k8s 1.14, istio 1.15.1 \næ›¿æ¢äº†è¿˜æ˜¯å¯ä»¥è®¿é—®å…¬ç½‘\n\n$ kubectl get configmap istio -n istio-system -o yaml | sed &#39;s/mode: ALLOW_ANY/mode: ALLOW_ANYREGISTRY_ONLY/g&#39; | kubectl replace -n istio-system -f -\nconfigmap/istio replaced\n\n$ kbe sleep-666475687f-f8xnr -c sleep curl http://httpbin.org/headers\nkubectl exec [POD] [COMMAND] is DEPRECATED and will be removed in a future version. Use kubectl kubectl exec [POD] -- [COMMAND] instead.\n{\n  &#34;headers&#34;: {\n    &#34;Accept&#34;: &#34;*/*&#34;,\n    &#34;Content-Length&#34;: &#34;0&#34;,\n    &#34;Host&#34;: &#34;httpbin.org&#34;,\n    &#34;User-Agent&#34;: &#34;curl/7.69.1&#34;,\n    &#34;X-Amzn-Trace-Id&#34;: &#34;Root=1-606e69c0-3e2293ac11fd2a652e2d827a&#34;,\n    &#34;X-B3-Sampled&#34;: &#34;1&#34;,\n    &#34;X-B3-Spanid&#34;: &#34;001bde352601dc9e&#34;,\n    &#34;X-B3-Traceid&#34;: &#34;fd18b098c7f43bc3001bde352601dc9e&#34;,\n    &#34;X-Envoy-Peer-Metadata&#34;: &#34;ChwKDElOU1RBTkNFX0lQUxIMGgoxMC4xLjAuMTE1CsQBCgZMQUJFTFMSuQEqtgEKDgoDYXBwEgcaBXNsZWVwCiEKEXBvZC10ZW1wbGF0ZS1oYXNoEgwaCjY2NjQ3NTY4N2YKJAoZc2VjdXJpdHkuaXN0aW8uaW8vdGxzTW9kZRIHGgVpc3RpbwoqCh9zZXJ2aWNlLmlzdGlvLmlvL2Nhbm9uaWNhbC1uYW1lEgcaBXNsZWVwCi8KI3NlcnZpY2UuaXN0aW8uaW8vY2Fub25pY2FsLXJldmlzaW9uEggaBmxhdGVzdAoaCgdNRVNIX0lEEg8aDWNsdXN0ZXIubG9jYWwKIAoETkFNRRIYGhZzbGVlcC02NjY0NzU2ODdmLWY4eG5yChYKCU5BTUVTUEFDRRIJGgdkZWZhdWx0CkkKBU9XTkVSEkAaPmt1YmVybmV0ZXM6Ly9hcGlzL2FwcHMvdjEvbmFtZXNwYWNlcy9kZWZhdWx0L2RlcGxveW1lbnRzL3NsZWVwChoKD1NFUlZJQ0VfQUNDT1VOVBIHGgVzbGVlcAoYCg1XT1JLTE9BRF9OQU1FEgcaBXNsZWVw&#34;,\n    &#34;X-Envoy-Peer-Metadata-Id&#34;: &#34;sidecar~10.1.0.115~sleep-666475687f-f8xnr.default~default.svc.cluster.local&#34;\n  }\n}\n\n$ k get pod | grep -i sleep\nsleep-666475687f-f8xnr            2/2     Running   0          15h\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617848865,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":3684311,"avatar":"","nickname":"Geek_b04bc8","note":"","ucode":"143D8631AF1A4E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1600767,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epvYc3REh3jaTt9hPxj4alDicbzsawNyvaxMCTKcPHtK2b8EoI0HTsicaTzsrVo2hBhl9tbGXiaUxFYA/132","nickname":"WandaYu","note":"","ucode":"17D97DF0803BF4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":624783,"discussion_content":"æ–°ç‰ˆæœ¬å·²ç»ä¸æ˜¯åœ¨configmapä¸­æ§åˆ¶äº†ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1690904952,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":365603,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":624783,"extra":""}]}]},{"had_liked":false,"id":212257,"user_name":"Geek_2655db","can_delete":false,"product_type":"c3","uid":1809331,"ip_address":"","ucode":"3BC81783F791BD","user_header":"","comment_is_top":false,"comment_ctime":1588080371,"is_pvip":false,"replies":[{"id":78988,"content":"å’±ä»¬å…ˆç¡®å®šä¸€ä¸ªé—®é¢˜ï¼šå­˜é‡ç³»ç»Ÿçš„éƒ¨ç½²ç¯å¢ƒæ˜¯ä»€ä¹ˆï¼Ÿæ˜¯äº‘ä¸Šï¼Ÿå®ä½“æœºï¼ŸK8sï¼Ÿå¦‚æœä¸æ˜¯åŸºäºk8sçš„ï¼Œistioæ˜¯æ²¡æ³•ç®¡ç†çš„ï¼Œä¸è¿‡å¯ä»¥é€‰æ‹©æ‰˜ç®¡çš„meshæœåŠ¡ï¼Œæ¯”å¦‚aws appmeshã€‚\nå‡è®¾ç¬¬ä¸€ä¸ªé—®é¢˜æ»¡è¶³è¦æ±‚ï¼ˆk8sï¼‰ï¼Œé‚£ä¹ˆç¬¬äºŒç‚¹ï¼šâ€œç®¡ç†åº•å±‚é€šè®¯å’Œæµé‡â€ ï¼Œæˆ‘ç†è§£æ²¡é”™çš„è¯ï¼Œæ˜¯æœ‰å…¶ä»–ç³»ç»Ÿï¼ˆæˆ–æœåŠ¡ï¼‰é€šè¿‡ServiceEntryè®¿é—®å­˜é‡ç³»ç»Ÿï¼Ÿå¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œè¿™ä¸ªè®¿é—®å­˜é‡ç³»ç»Ÿçš„ï¼Œæ˜¯ä¸‹æ¸¸ç³»ç»Ÿï¼ˆæœåŠ¡ï¼‰ï¼Œéœ€è¦æ¥å…¥istioï¼Œå­˜é‡ç³»ç»Ÿä¸éœ€è¦ä»»ä½•ä¾µå…¥ã€‚å½“ç„¶å‰ææ˜¯å®ƒèƒ½æä¾›å¯æ”¯æŒçš„åè®®ï¼ˆhttp&#47;grpcç­‰ï¼‰","user_name":"ä½œè€…å›å¤","user_name_real":"é©¬è‹¥é£","uid":1046394,"ctime":1588159595,"ip_address":"","comment_id":212257,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"è€å¸ˆï¼Œè¯·æ•™ä¸‹ï¼Œæˆ‘ä»¬ç°åœ¨æœ‰å­˜é‡ç³»ç»Ÿï¼Œæˆ‘æƒ³æ˜¯ä¸æ˜¯å¯ä»¥åŸºäºserviceEntryæ¥ç®¡ç†è¿™äº›å­˜é‡ç³»ç»Ÿçš„åº•å±‚é€šè®¯å’Œæµé‡ï¼Œå½“ç„¶ï¼Œå‰ææ¡ä»¶æ˜¯å¯¹è¿™äº›å­˜é‡ç³»ç»Ÿæ²¡æœ‰ä»»ä½•çš„ä¾µå…¥æ€§æ”¹é€ ï¼Œæ˜¯å¦å¯ä»¥å®ç°ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆéœ€è¦æ»¡è¶³çš„å‰ç½®æ¡ä»¶ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"é©¬è‹¥é£","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493462,"discussion_content":"å’±ä»¬å…ˆç¡®å®šä¸€ä¸ªé—®é¢˜ï¼šå­˜é‡ç³»ç»Ÿçš„éƒ¨ç½²ç¯å¢ƒæ˜¯ä»€ä¹ˆï¼Ÿæ˜¯äº‘ä¸Šï¼Ÿå®ä½“æœºï¼ŸK8sï¼Ÿå¦‚æœä¸æ˜¯åŸºäºk8sçš„ï¼Œistioæ˜¯æ²¡æ³•ç®¡ç†çš„ï¼Œä¸è¿‡å¯ä»¥é€‰æ‹©æ‰˜ç®¡çš„meshæœåŠ¡ï¼Œæ¯”å¦‚aws appmeshã€‚\nå‡è®¾ç¬¬ä¸€ä¸ªé—®é¢˜æ»¡è¶³è¦æ±‚ï¼ˆk8sï¼‰ï¼Œé‚£ä¹ˆç¬¬äºŒç‚¹ï¼šâ€œç®¡ç†åº•å±‚é€šè®¯å’Œæµé‡â€ ï¼Œæˆ‘ç†è§£æ²¡é”™çš„è¯ï¼Œæ˜¯æœ‰å…¶ä»–ç³»ç»Ÿï¼ˆæˆ–æœåŠ¡ï¼‰é€šè¿‡ServiceEntryè®¿é—®å­˜é‡ç³»ç»Ÿï¼Ÿå¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œè¿™ä¸ªè®¿é—®å­˜é‡ç³»ç»Ÿçš„ï¼Œæ˜¯ä¸‹æ¸¸ç³»ç»Ÿï¼ˆæœåŠ¡ï¼‰ï¼Œéœ€è¦æ¥å…¥istioï¼Œå­˜é‡ç³»ç»Ÿä¸éœ€è¦ä»»ä½•ä¾µå…¥ã€‚å½“ç„¶å‰ææ˜¯å®ƒèƒ½æä¾›å¯æ”¯æŒçš„åè®®ï¼ˆhttp/grpcç­‰ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588159595,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1809331,"avatar":"","nickname":"Geek_2655db","note":"","ucode":"3BC81783F791BD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":252969,"discussion_content":"æ„Ÿè°¢è€å¸ˆè§£æƒ‘ï¼\nä¸€ã€\n1.å­˜é‡ç³»ç»Ÿè·‘åœ¨è™šæ‹Ÿæœºä¸Šï¼›\n2.æƒ³åŸºäºk8s+istioæ„å»ºä¸€å¥—é˜²è…å±‚ï¼Œç”±è¿™ä¸€å±‚æš´éœ²(http/grpc)å¯¹ä¸‹æ¸¸ç³»ç»Ÿçš„æœåŠ¡ï¼›\n3.é˜²è…å±‚é€šè¿‡ServiceEntryæ¥ç®¡ç†å­˜é‡ç³»ç»Ÿçš„æœåŠ¡æµé‡åŠé€šè®¯ï¼›\n4.æˆ‘ä»¬è´Ÿè´£å­˜é‡ç³»ç»Ÿçš„ï¼Œä¸ç®¡ä¸‹æ¸¸ç³»ç»Ÿå¥½ä¸ä¸å¥½ï¼Œæˆ‘ä»¬ä½œä¸ºæœåŠ¡æä¾›æ–¹è¿˜æ˜¯éœ€è¦ä¿è¯è‡ªèº«çš„å¯ç”¨æ€§åŠå¯è§‚æµ‹æ€§ï¼Œæ‰€ä»¥æƒ³ç€æ˜¯ä¸æ˜¯æä¸ªè¿™æ ·çš„é˜²è…å±‚æ˜¯å¯è¡Œçš„ï¼›\näºŒã€\n1.è¯¾ç¨‹ä¸­ä»‹ç»äº†ServiceEntryå’ŒGatewayæ˜¯ç›¸åçš„æ¦‚å¿µï¼Œæˆ‘çš„ç†è§£æ˜¯\na.ServiceEntryæ˜¯ç”¨æ¥æ§åˆ¶ç½‘æ ¼å†…æœåŠ¡è°ƒç”¨å¤–éƒ¨æœåŠ¡çš„ï¼Œæ§åˆ¶ä¸»ä½“è¿˜æ˜¯åœ¨ç½‘æ ¼å†…éƒ¨çš„æœåŠ¡æœ¬èº«ï¼Œè€Œè¿™ä¸ªæœåŠ¡åœ¨ä½¿ç”¨åœºæ™¯ä¸­æ‰®æ¼”çš„æ¶ˆè´¹è€…çš„è§’è‰²\nb.Gatewayæ˜¯ç”¨æ¥æ§åˆ¶å¤–éƒ¨æœåŠ¡è°ƒç”¨ç½‘æ ¼å†…æœåŠ¡çš„ï¼Œæ§åˆ¶ä¸»ä½“ä¹Ÿæ˜¯ç½‘æ ¼å†…éƒ¨çš„æœåŠ¡æœ¬èº«ï¼Œè€Œè¿™ä¸ªæœåŠ¡åœ¨ä½¿ç”¨åœºæ™¯ä¸­æ‰®æ¼”çš„æ˜¯æœåŠ¡è€…çš„è§’è‰²\nc.bä¸­æ‰€è¿°Gatewayå‡†ç¡®ç‚¹ï¼Œåº”è¯¥æ˜¯æŒ‡Ingress Gwï¼Œé‚£Egress Gwå’ŒSEçš„åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿ\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1588208211,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1809331,"avatar":"","nickname":"Geek_2655db","note":"","ucode":"3BC81783F791BD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":259715,"discussion_content":"æ±‚å¤§ä½¬è§£æƒ‘å•Šï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588812843,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355914,"user_name":"Brilliant","can_delete":false,"product_type":"c3","uid":1522168,"ip_address":"ä¸Šæµ·","ucode":"CFF4F5BCAF21EE","user_header":"https://static001.geekbang.org/account/avatar/00/17/39/f8/b5a1b669.jpg","comment_is_top":false,"comment_ctime":1661849482,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"```\n$ kc exec -it sleep-5887ccbb67-gqkdw -c sleep --  curl http:&#47;&#47;httpbin.org&#47;headers\ncurl: (6) Could not resolve host: httpbin.org\n```\nç‰ˆæœ¬ä¿¡æ¯å¦‚ä¸‹ï¼š\nistioç›¸å…³\nclient version: 1.14.3\ncontrol plane version: 1.14.3\ndata plane version: 1.14.3 (9 proxies)\nk8sç›¸å…³\nClient Version: v1.24.3\nKustomize Version: v4.5.4\nServer Version: v1.24.3+k3s1\n\nè¿™è¾¹åšäº†å¦‚ä¸‹å°è¯•\n1. è¿›å…¥sleepå®¹å™¨ä¸­`$cat &#47;etc&#47;resolv.conf`, nameserverä¸ºkube-dnsçš„serivceåœ°å€ï¼Œåœ¨è¯¥å®¹å™¨ä¸­ï¼Œç›´æ¥curlåŒæ ·æç¤ºæ— æ³•è§£æ\n2. è¿›å…¥æ³¨å…¥çš„istio-proxyå®¹å™¨ä¸­`$cat &#47;etc&#47;resolv.conf`, nameserveråŒä¸Šï¼Œåœ¨è¯¥å®¹å™¨ä¸­curl, å¯ä»¥æ­£å¸¸æ‹¿åˆ°æ•°æ®","like_count":0},{"had_liked":false,"id":335525,"user_name":"Amosãƒ¾","can_delete":false,"product_type":"c3","uid":1567014,"ip_address":"","ucode":"833F6FCB4042AD","user_header":"https://static001.geekbang.org/account/avatar/00/17/e9/26/472e16e4.jpg","comment_is_top":false,"comment_ctime":1645576143,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"è€å¸ˆï¼Œå¦‚æœæƒ³ä½¿ç”¨ç±»ä¼¼k8s endpointçš„æ–¹å¼å°†å¤–éƒ¨æµé‡ç®¡ç†èµ·æ¥ï¼Œåº”è¯¥æ˜¯ä½¿ç”¨seå§ï¼Ÿé‚£hostè¯¥å¦‚ä½•æŒ‡å®šï¼Ÿ","like_count":0}]}