{"id":67351,"title":"34 | Kubernetesç½‘ç»œæ¨¡å‹ä¸CNIç½‘ç»œæ’ä»¶","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å¼ ç£Šã€‚ä»Šå¤©æˆ‘å’Œä½ åˆ†äº«çš„ä¸»é¢˜æ˜¯ï¼šKubernetesç½‘ç»œæ¨¡å‹ä¸CNIç½‘ç»œæ’ä»¶ã€‚</p><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¥Flannelé¡¹ç›®ä¸ºä¾‹ï¼Œä¸ºä½ è¯¦ç»†è®²è§£äº†å®¹å™¨è·¨ä¸»æœºç½‘ç»œçš„ä¸¤ç§å®ç°æ–¹æ³•ï¼šUDPå’ŒVXLANã€‚</p><p>ä¸éš¾çœ‹åˆ°ï¼Œè¿™äº›ä¾‹å­æœ‰ä¸€ä¸ªå…±æ€§ï¼Œé‚£å°±æ˜¯ç”¨æˆ·çš„å®¹å™¨éƒ½è¿æ¥åœ¨docker0ç½‘æ¡¥ä¸Šã€‚è€Œç½‘ç»œæ’ä»¶åˆ™åœ¨å®¿ä¸»æœºä¸Šåˆ›å»ºäº†ä¸€ä¸ªç‰¹æ®Šçš„è®¾å¤‡ï¼ˆUDPæ¨¡å¼åˆ›å»ºçš„æ˜¯TUNè®¾å¤‡ï¼ŒVXLANæ¨¡å¼åˆ›å»ºçš„åˆ™æ˜¯VTEPè®¾å¤‡ï¼‰ï¼Œdocker0ä¸è¿™ä¸ªè®¾å¤‡ä¹‹é—´ï¼Œé€šè¿‡IPè½¬å‘ï¼ˆè·¯ç”±è¡¨ï¼‰è¿›è¡Œåä½œã€‚</p><p>ç„¶åï¼Œç½‘ç»œæ’ä»¶çœŸæ­£è¦åšçš„äº‹æƒ…ï¼Œåˆ™æ˜¯é€šè¿‡æŸç§æ–¹æ³•ï¼ŒæŠŠä¸åŒå®¿ä¸»æœºä¸Šçš„ç‰¹æ®Šè®¾å¤‡è¿é€šï¼Œä»è€Œè¾¾åˆ°å®¹å™¨è·¨ä¸»æœºé€šä¿¡çš„ç›®çš„ã€‚</p><p>å®é™…ä¸Šï¼Œä¸Šé¢è¿™ä¸ªæµç¨‹ï¼Œä¹Ÿæ­£æ˜¯Kuberneteså¯¹å®¹å™¨ç½‘ç»œçš„ä¸»è¦å¤„ç†æ–¹æ³•ã€‚åªä¸è¿‡ï¼ŒKubernetesæ˜¯é€šè¿‡ä¸€ä¸ªå«ä½œCNIçš„æ¥å£ï¼Œç»´æŠ¤äº†ä¸€ä¸ªå•ç‹¬çš„ç½‘æ¡¥æ¥ä»£æ›¿docker0ã€‚è¿™ä¸ªç½‘æ¡¥çš„åå­—å°±å«ä½œï¼šCNIç½‘æ¡¥ï¼Œå®ƒåœ¨å®¿ä¸»æœºä¸Šçš„è®¾å¤‡åç§°é»˜è®¤æ˜¯ï¼šcni0ã€‚</p><p>ä»¥Flannelçš„VXLANæ¨¡å¼ä¸ºä¾‹ï¼Œåœ¨Kubernetesç¯å¢ƒé‡Œï¼Œå®ƒçš„å·¥ä½œæ–¹å¼è·Ÿæˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­è®²è§£çš„æ²¡æœ‰ä»»ä½•ä¸åŒã€‚åªä¸è¿‡ï¼Œdocker0ç½‘æ¡¥è¢«æ›¿æ¢æˆäº†CNIç½‘æ¡¥è€Œå·²ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/9f/8c/9f11d8716f6d895ff6d1c813d460488c.jpg?wh=1767*933\" alt=\"\"></p><p>åœ¨è¿™é‡Œï¼ŒKubernetesä¸ºFlannelåˆ†é…çš„å­ç½‘èŒƒå›´æ˜¯10.244.0.0/16ã€‚è¿™ä¸ªå‚æ•°å¯ä»¥åœ¨éƒ¨ç½²çš„æ—¶å€™æŒ‡å®šï¼Œæ¯”å¦‚ï¼š</p><!-- [[[read_end]]] --><pre><code>$ kubeadm init --pod-network-cidr=10.244.0.0/16\n</code></pre><p>ä¹Ÿå¯ä»¥åœ¨éƒ¨ç½²å®Œæˆåï¼Œé€šè¿‡ä¿®æ”¹kube-controller-managerçš„é…ç½®æ–‡ä»¶æ¥æŒ‡å®šã€‚</p><p>è¿™æ—¶å€™ï¼Œå‡è®¾Infra-container-1è¦è®¿é—®Infra-container-2ï¼ˆä¹Ÿå°±æ˜¯Pod-1è¦è®¿é—®Pod-2ï¼‰ï¼Œè¿™ä¸ªIPåŒ…çš„æºåœ°å€å°±æ˜¯10.244.0.2ï¼Œç›®çš„IPåœ°å€æ˜¯10.244.1.3ã€‚è€Œæ­¤æ—¶ï¼ŒInfra-container-1é‡Œçš„eth0è®¾å¤‡ï¼ŒåŒæ ·æ˜¯ä»¥Veth Pairçš„æ–¹å¼è¿æ¥åœ¨Node 1çš„cni0ç½‘æ¡¥ä¸Šã€‚æ‰€ä»¥è¿™ä¸ªIPåŒ…å°±ä¼šç»è¿‡cni0ç½‘æ¡¥å‡ºç°åœ¨å®¿ä¸»æœºä¸Šã€‚</p><p>æ­¤æ—¶ï¼ŒNode 1ä¸Šçš„è·¯ç”±è¡¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code># åœ¨Node 1ä¸Š\n$ route -n\nKernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n...\n10.244.0.0      0.0.0.0         255.255.255.0   U     0      0        0 cni0\n10.244.1.0      10.244.1.0      255.255.255.0   UG    0      0        0 flannel.1\n172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 docker0\n</code></pre><p>å› ä¸ºæˆ‘ä»¬çš„IPåŒ…çš„ç›®çš„IPåœ°å€æ˜¯10.244.1.3ï¼Œæ‰€ä»¥å®ƒåªèƒ½åŒ¹é…åˆ°ç¬¬äºŒæ¡è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯10.244.1.0å¯¹åº”çš„è¿™æ¡è·¯ç”±è§„åˆ™ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ¡è§„åˆ™æŒ‡å®šäº†æœ¬æœºçš„flannel.1è®¾å¤‡è¿›è¡Œå¤„ç†ã€‚å¹¶ä¸”ï¼Œflannel.1åœ¨å¤„ç†å®Œåï¼Œè¦å°†IPåŒ…è½¬å‘åˆ°çš„ç½‘å…³ï¼ˆGatewayï¼‰ï¼Œæ­£æ˜¯â€œéš§é“â€å¦ä¸€ç«¯çš„VTEPè®¾å¤‡ï¼Œä¹Ÿå°±æ˜¯Node 2çš„flannel.1è®¾å¤‡ã€‚æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥çš„æµç¨‹ï¼Œå°±è·Ÿä¸Šä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»è¿‡çš„Flannel VXLANæ¨¡å¼å®Œå…¨ä¸€æ ·äº†ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒCNIç½‘æ¡¥åªæ˜¯æ¥ç®¡æ‰€æœ‰CNIæ’ä»¶è´Ÿè´£çš„ã€å³Kubernetesåˆ›å»ºçš„å®¹å™¨ï¼ˆPodï¼‰ã€‚è€Œæ­¤æ—¶ï¼Œå¦‚æœä½ ç”¨docker runå•ç‹¬å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œé‚£ä¹ˆDockeré¡¹ç›®è¿˜æ˜¯ä¼šæŠŠè¿™ä¸ªå®¹å™¨è¿æ¥åˆ°docker0ç½‘æ¡¥ä¸Šã€‚æ‰€ä»¥è¿™ä¸ªå®¹å™¨çš„IPåœ°å€ï¼Œä¸€å®šæ˜¯å±äºdocker0ç½‘æ¡¥çš„172.17.0.0/16ç½‘æ®µã€‚</p><p>Kubernetesä¹‹æ‰€ä»¥è¦è®¾ç½®è¿™æ ·ä¸€ä¸ªä¸docker0ç½‘æ¡¥åŠŸèƒ½å‡ ä¹ä¸€æ ·çš„CNIç½‘æ¡¥ï¼Œä¸»è¦åŸå› åŒ…æ‹¬ä¸¤ä¸ªæ–¹é¢ï¼š</p><ul>\n<li>ä¸€æ–¹é¢ï¼ŒKubernetesé¡¹ç›®å¹¶æ²¡æœ‰ä½¿ç”¨Dockerçš„ç½‘ç»œæ¨¡å‹ï¼ˆCNMï¼‰ï¼Œæ‰€ä»¥å®ƒå¹¶ä¸å¸Œæœ›ã€ä¹Ÿä¸å…·å¤‡é…ç½®docker0ç½‘æ¡¥çš„èƒ½åŠ›ï¼›</li>\n<li>å¦ä¸€æ–¹é¢ï¼Œè¿™è¿˜ä¸Kuberneteså¦‚ä½•é…ç½®Podï¼Œä¹Ÿå°±æ˜¯Infraå®¹å™¨çš„Network Namespaceå¯†åˆ‡ç›¸å…³ã€‚</li>\n</ul><p>æˆ‘ä»¬çŸ¥é“ï¼ŒKubernetesåˆ›å»ºä¸€ä¸ªPodçš„ç¬¬ä¸€æ­¥ï¼Œå°±æ˜¯åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªInfraå®¹å™¨ï¼Œç”¨æ¥â€œholdâ€ä½è¿™ä¸ªPodçš„Network Namespaceï¼ˆè¿™é‡Œï¼Œä½ å¯ä»¥å†å›é¡¾ä¸€ä¸‹ä¸“æ ç¬¬13ç¯‡æ–‡ç« <a href=\"https://time.geekbang.org/column/article/40092\">ã€Šä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦Podï¼Ÿã€‹</a>ä¸­çš„ç›¸å…³å†…å®¹ï¼‰ã€‚</p><p>æ‰€ä»¥ï¼ŒCNIçš„è®¾è®¡æ€æƒ³ï¼Œå°±æ˜¯ï¼š<strong>Kubernetesåœ¨å¯åŠ¨Infraå®¹å™¨ä¹‹åï¼Œå°±å¯ä»¥ç›´æ¥è°ƒç”¨CNIç½‘ç»œæ’ä»¶ï¼Œä¸ºè¿™ä¸ªInfraå®¹å™¨çš„Network Namespaceï¼Œé…ç½®ç¬¦åˆé¢„æœŸçš„ç½‘ç»œæ ˆã€‚</strong></p><blockquote>\n<p>å¤‡æ³¨ï¼šåœ¨å‰é¢ç¬¬32ç¯‡æ–‡ç« <a href=\"https://time.geekbang.org/column/article/64948\">ã€Šæµ…è°ˆå®¹å™¨ç½‘ç»œã€‹</a>ä¸­ï¼Œæˆ‘è®²è§£å•æœºå®¹å™¨ç½‘ç»œæ—¶ï¼Œå·²ç»å’Œä½ åˆ†äº«è¿‡ï¼Œä¸€ä¸ªNetwork Namespaceçš„ç½‘ç»œæ ˆåŒ…æ‹¬ï¼šç½‘å¡ï¼ˆNetwork Interfaceï¼‰ã€å›ç¯è®¾å¤‡ï¼ˆLoopback Deviceï¼‰ã€è·¯ç”±è¡¨ï¼ˆRouting Tableï¼‰å’Œiptablesè§„åˆ™ã€‚</p>\n</blockquote><p>é‚£ä¹ˆï¼Œè¿™ä¸ªç½‘ç»œæ ˆçš„é…ç½®å·¥ä½œåˆæ˜¯å¦‚ä½•å®Œæˆçš„å‘¢ï¼Ÿ</p><p>ä¸ºäº†å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦ä»CNIæ’ä»¶çš„éƒ¨ç½²å’Œå®ç°æ–¹å¼è°ˆèµ·äº†ã€‚</p><p>æˆ‘ä»¬åœ¨éƒ¨ç½²Kubernetesçš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªæ­¥éª¤æ˜¯å®‰è£…kubernetes-cniåŒ…ï¼Œå®ƒçš„ç›®çš„å°±æ˜¯åœ¨å®¿ä¸»æœºä¸Šå®‰è£…<strong>CNIæ’ä»¶æ‰€éœ€çš„åŸºç¡€å¯æ‰§è¡Œæ–‡ä»¶</strong>ã€‚</p><p>åœ¨å®‰è£…å®Œæˆåï¼Œä½ å¯ä»¥åœ¨å®¿ä¸»æœºçš„/opt/cni/binç›®å½•ä¸‹çœ‹åˆ°å®ƒä»¬ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>$ ls -al /opt/cni/bin/\ntotal 73088\n-rwxr-xr-x 1 root root  3890407 Aug 17  2017 bridge\n-rwxr-xr-x 1 root root  9921982 Aug 17  2017 dhcp\n-rwxr-xr-x 1 root root  2814104 Aug 17  2017 flannel\n-rwxr-xr-x 1 root root  2991965 Aug 17  2017 host-local\n-rwxr-xr-x 1 root root  3475802 Aug 17  2017 ipvlan\n-rwxr-xr-x 1 root root  3026388 Aug 17  2017 loopback\n-rwxr-xr-x 1 root root  3520724 Aug 17  2017 macvlan\n-rwxr-xr-x 1 root root  3470464 Aug 17  2017 portmap\n-rwxr-xr-x 1 root root  3877986 Aug 17  2017 ptp\n-rwxr-xr-x 1 root root  2605279 Aug 17  2017 sample\n-rwxr-xr-x 1 root root  2808402 Aug 17  2017 tuning\n-rwxr-xr-x 1 root root  3475750 Aug 17  2017 vlan\n</code></pre><p>è¿™äº›CNIçš„åŸºç¡€å¯æ‰§è¡Œæ–‡ä»¶ï¼ŒæŒ‰ç…§åŠŸèƒ½å¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š</p><p><strong>ç¬¬ä¸€ç±»ï¼Œå«ä½œMainæ’ä»¶ï¼Œå®ƒæ˜¯ç”¨æ¥åˆ›å»ºå…·ä½“ç½‘ç»œè®¾å¤‡çš„äºŒè¿›åˆ¶æ–‡ä»¶</strong>ã€‚æ¯”å¦‚ï¼Œbridgeï¼ˆç½‘æ¡¥è®¾å¤‡ï¼‰ã€ipvlanã€loopbackï¼ˆloè®¾å¤‡ï¼‰ã€macvlanã€ptpï¼ˆVeth Pairè®¾å¤‡ï¼‰ï¼Œä»¥åŠvlanã€‚</p><p>æˆ‘åœ¨å‰é¢æåˆ°è¿‡çš„Flannelã€Weaveç­‰é¡¹ç›®ï¼Œéƒ½å±äºâ€œç½‘æ¡¥â€ç±»å‹çš„CNIæ’ä»¶ã€‚æ‰€ä»¥åœ¨å…·ä½“çš„å®ç°ä¸­ï¼Œå®ƒä»¬å¾€å¾€ä¼šè°ƒç”¨bridgeè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ã€‚è¿™ä¸ªæµç¨‹ï¼Œæˆ‘é©¬ä¸Šå°±ä¼šè¯¦ç»†ä»‹ç»åˆ°ã€‚</p><p><strong>ç¬¬äºŒç±»ï¼Œå«ä½œIPAMï¼ˆIP Address Managementï¼‰æ’ä»¶ï¼Œå®ƒæ˜¯è´Ÿè´£åˆ†é…IPåœ°å€çš„äºŒè¿›åˆ¶æ–‡ä»¶</strong>ã€‚æ¯”å¦‚ï¼Œdhcpï¼Œè¿™ä¸ªæ–‡ä»¶ä¼šå‘DHCPæœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼›host-localï¼Œåˆ™ä¼šä½¿ç”¨é¢„å…ˆé…ç½®çš„IPåœ°å€æ®µæ¥è¿›è¡Œåˆ†é…ã€‚</p><p><strong>ç¬¬ä¸‰ç±»ï¼Œæ˜¯ç”±CNIç¤¾åŒºç»´æŠ¤çš„å†…ç½®CNIæ’ä»¶</strong>ã€‚æ¯”å¦‚ï¼šflannelï¼Œå°±æ˜¯ä¸“é—¨ä¸ºFlannelé¡¹ç›®æä¾›çš„CNIæ’ä»¶ï¼›tuningï¼Œæ˜¯ä¸€ä¸ªé€šè¿‡sysctlè°ƒæ•´ç½‘ç»œè®¾å¤‡å‚æ•°çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼›portmapï¼Œæ˜¯ä¸€ä¸ªé€šè¿‡iptablesé…ç½®ç«¯å£æ˜ å°„çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼›bandwidthï¼Œæ˜¯ä¸€ä¸ªä½¿ç”¨Token Bucket Filter (TBF) æ¥è¿›è¡Œé™æµçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p><p>ä»è¿™äº›äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœè¦å®ç°ä¸€ä¸ªç»™Kubernetesç”¨çš„å®¹å™¨ç½‘ç»œæ–¹æ¡ˆï¼Œå…¶å®éœ€è¦åšä¸¤éƒ¨åˆ†å·¥ä½œï¼Œä»¥Flannelé¡¹ç›®ä¸ºä¾‹ï¼š</p><p><strong>é¦–å…ˆï¼Œå®ç°è¿™ä¸ªç½‘ç»œæ–¹æ¡ˆæœ¬èº«</strong>ã€‚è¿™ä¸€éƒ¨åˆ†éœ€è¦ç¼–å†™çš„ï¼Œå…¶å®å°±æ˜¯flanneldè¿›ç¨‹é‡Œçš„ä¸»è¦é€»è¾‘ã€‚æ¯”å¦‚ï¼Œåˆ›å»ºå’Œé…ç½®flannel.1è®¾å¤‡ã€é…ç½®å®¿ä¸»æœºè·¯ç”±ã€é…ç½®ARPå’ŒFDBè¡¨é‡Œçš„ä¿¡æ¯ç­‰ç­‰ã€‚</p><p><strong>ç„¶åï¼Œå®ç°è¯¥ç½‘ç»œæ–¹æ¡ˆå¯¹åº”çš„CNIæ’ä»¶</strong>ã€‚è¿™ä¸€éƒ¨åˆ†ä¸»è¦éœ€è¦åšçš„ï¼Œå°±æ˜¯é…ç½®Infraå®¹å™¨é‡Œé¢çš„ç½‘ç»œæ ˆï¼Œå¹¶æŠŠå®ƒè¿æ¥åœ¨CNIç½‘æ¡¥ä¸Šã€‚</p><p>ç”±äºFlannelé¡¹ç›®å¯¹åº”çš„CNIæ’ä»¶å·²ç»è¢«å†…ç½®äº†ï¼Œæ‰€ä»¥å®ƒæ— éœ€å†å•ç‹¬å®‰è£…ã€‚è€Œå¯¹äºWeaveã€Calicoç­‰å…¶ä»–é¡¹ç›®æ¥è¯´ï¼Œæˆ‘ä»¬å°±å¿…é¡»åœ¨å®‰è£…æ’ä»¶çš„æ—¶å€™ï¼ŒæŠŠå¯¹åº”çš„CNIæ’ä»¶çš„å¯æ‰§è¡Œæ–‡ä»¶æ”¾åœ¨/opt/cni/bin/ç›®å½•ä¸‹ã€‚</p><blockquote>\n<p>å®é™…ä¸Šï¼Œå¯¹äºWeaveã€Calicoè¿™æ ·çš„ç½‘ç»œæ–¹æ¡ˆæ¥è¯´ï¼Œå®ƒä»¬çš„DaemonSetåªéœ€è¦æŒ‚è½½å®¿ä¸»æœºçš„/opt/cni/bin/ï¼Œå°±å¯ä»¥å®ç°æ’ä»¶å¯æ‰§è¡Œæ–‡ä»¶çš„å®‰è£…äº†ã€‚ä½ å¯ä»¥æƒ³ä¸€ä¸‹å…·ä½“åº”è¯¥æ€ä¹ˆåšï¼Œå°±å½“ä½œä¸€ä¸ªè¯¾åå°é—®é¢˜ç•™ç»™ä½ å»å®è·µäº†ã€‚</p>\n</blockquote><p>æ¥ä¸‹æ¥ï¼Œä½ å°±éœ€è¦åœ¨å®¿ä¸»æœºä¸Šå®‰è£…flanneldï¼ˆç½‘ç»œæ–¹æ¡ˆæœ¬èº«ï¼‰ã€‚è€Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œflanneldå¯åŠ¨åä¼šåœ¨æ¯å°å®¿ä¸»æœºä¸Šç”Ÿæˆå®ƒå¯¹åº”çš„<strong>CNIé…ç½®æ–‡ä»¶</strong>ï¼ˆå®ƒå…¶å®æ˜¯ä¸€ä¸ªConfigMapï¼‰ï¼Œä»è€Œå‘Šè¯‰Kubernetesï¼Œè¿™ä¸ªé›†ç¾¤è¦ä½¿ç”¨Flannelä½œä¸ºå®¹å™¨ç½‘ç»œæ–¹æ¡ˆã€‚</p><p>è¿™ä¸ªCNIé…ç½®æ–‡ä»¶çš„å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>$ cat /etc/cni/net.d/10-flannel.conflist \n{\n  &quot;name&quot;: &quot;cbr0&quot;,\n  &quot;plugins&quot;: [\n    {\n      &quot;type&quot;: &quot;flannel&quot;,\n      &quot;delegate&quot;: {\n        &quot;hairpinMode&quot;: true,\n        &quot;isDefaultGateway&quot;: true\n      }\n    },\n    {\n      &quot;type&quot;: &quot;portmap&quot;,\n      &quot;capabilities&quot;: {\n        &quot;portMappings&quot;: true\n      }\n    }\n  ]\n}\n</code></pre><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨Kubernetesä¸­ï¼Œå¤„ç†å®¹å™¨ç½‘ç»œç›¸å…³çš„é€»è¾‘å¹¶ä¸ä¼šåœ¨kubeletä¸»å¹²ä»£ç é‡Œæ‰§è¡Œï¼Œè€Œæ˜¯ä¼šåœ¨å…·ä½“çš„CRIï¼ˆContainer Runtime Interfaceï¼Œå®¹å™¨è¿è¡Œæ—¶æ¥å£ï¼‰å®ç°é‡Œå®Œæˆã€‚å¯¹äºDockeré¡¹ç›®æ¥è¯´ï¼Œå®ƒçš„CRIå®ç°å«ä½œdockershimï¼Œä½ å¯ä»¥åœ¨kubeletçš„ä»£ç é‡Œæ‰¾åˆ°å®ƒã€‚</p><p>æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥dockershimä¼šåŠ è½½ä¸Šè¿°çš„CNIé…ç½®æ–‡ä»¶ã€‚</p><p>éœ€è¦æ³¨æ„ï¼ŒKubernetesç›®å‰ä¸æ”¯æŒå¤šä¸ªCNIæ’ä»¶æ··ç”¨ã€‚å¦‚æœä½ åœ¨CNIé…ç½®ç›®å½•ï¼ˆ/etc/cni/net.dï¼‰é‡Œæ”¾ç½®äº†å¤šä¸ªCNIé…ç½®æ–‡ä»¶çš„è¯ï¼Œdockershimåªä¼šåŠ è½½æŒ‰å­—æ¯é¡ºåºæ’åºçš„ç¬¬ä¸€ä¸ªæ’ä»¶ã€‚</p><p>ä½†å¦ä¸€æ–¹é¢ï¼ŒCNIå…è®¸ä½ åœ¨ä¸€ä¸ªCNIé…ç½®æ–‡ä»¶é‡Œï¼Œé€šè¿‡pluginså­—æ®µï¼Œå®šä¹‰å¤šä¸ªæ’ä»¶è¿›è¡Œåä½œã€‚</p><p>æ¯”å¦‚ï¼Œåœ¨æˆ‘ä»¬ä¸Šé¢è¿™ä¸ªä¾‹å­é‡Œï¼ŒFlannelé¡¹ç›®å°±æŒ‡å®šäº†flannelå’Œportmapè¿™ä¸¤ä¸ªæ’ä»¶ã€‚</p><p><strong>è¿™æ—¶å€™ï¼Œdockershimä¼šæŠŠè¿™ä¸ªCNIé…ç½®æ–‡ä»¶åŠ è½½èµ·æ¥ï¼Œå¹¶ä¸”æŠŠåˆ—è¡¨é‡Œçš„ç¬¬ä¸€ä¸ªæ’ä»¶ã€ä¹Ÿå°±æ˜¯flannelæ’ä»¶ï¼Œè®¾ç½®ä¸ºé»˜è®¤æ’ä»¶</strong>ã€‚è€Œåœ¨åé¢çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œflannelå’Œportmapæ’ä»¶ä¼šæŒ‰ç…§å®šä¹‰é¡ºåºè¢«è°ƒç”¨ï¼Œä»è€Œä¾æ¬¡å®Œæˆâ€œé…ç½®å®¹å™¨ç½‘ç»œâ€å’Œâ€œé…ç½®ç«¯å£æ˜ å°„â€è¿™ä¸¤æ­¥æ“ä½œã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°±æ¥ä¸ºä½ è®²è§£ä¸€ä¸‹è¿™æ ·ä¸€ä¸ªCNIæ’ä»¶çš„å·¥ä½œåŸç†ã€‚</p><p>å½“kubeletç»„ä»¶éœ€è¦åˆ›å»ºPodçš„æ—¶å€™ï¼Œå®ƒç¬¬ä¸€ä¸ªåˆ›å»ºçš„ä¸€å®šæ˜¯Infraå®¹å™¨ã€‚æ‰€ä»¥åœ¨è¿™ä¸€æ­¥ï¼Œdockershimå°±ä¼šå…ˆè°ƒç”¨Docker APIåˆ›å»ºå¹¶å¯åŠ¨Infraå®¹å™¨ï¼Œç´§æ¥ç€æ‰§è¡Œä¸€ä¸ªå«ä½œSetUpPodçš„æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨å°±æ˜¯ï¼šä¸ºCNIæ’ä»¶å‡†å¤‡å‚æ•°ï¼Œç„¶åè°ƒç”¨CNIæ’ä»¶ä¸ºInfraå®¹å™¨é…ç½®ç½‘ç»œã€‚</p><p>è¿™é‡Œè¦è°ƒç”¨çš„CNIæ’ä»¶ï¼Œå°±æ˜¯/opt/cni/bin/flannelï¼›è€Œè°ƒç”¨å®ƒæ‰€éœ€è¦çš„å‚æ•°ï¼Œåˆ†ä¸ºä¸¤éƒ¨åˆ†ã€‚</p><p><strong>ç¬¬ä¸€éƒ¨åˆ†ï¼Œæ˜¯ç”±dockershimè®¾ç½®çš„ä¸€ç»„CNIç¯å¢ƒå˜é‡ã€‚</strong></p><p>å…¶ä¸­ï¼Œæœ€é‡è¦çš„ç¯å¢ƒå˜é‡å‚æ•°å«ä½œï¼šCNI_COMMANDã€‚å®ƒçš„å–å€¼åªæœ‰ä¸¤ç§ï¼šADDå’ŒDELã€‚</p><p><strong>è¿™ä¸ªADDå’ŒDELæ“ä½œï¼Œå°±æ˜¯CNIæ’ä»¶å”¯ä¸€éœ€è¦å®ç°çš„ä¸¤ä¸ªæ–¹æ³•ã€‚</strong></p><p>å…¶ä¸­ADDæ“ä½œçš„å«ä¹‰æ˜¯ï¼šæŠŠå®¹å™¨æ·»åŠ åˆ°CNIç½‘ç»œé‡Œï¼›DELæ“ä½œçš„å«ä¹‰åˆ™æ˜¯ï¼šæŠŠå®¹å™¨ä»CNIç½‘ç»œé‡Œç§»é™¤æ‰ã€‚</p><p>è€Œå¯¹äºç½‘æ¡¥ç±»å‹çš„CNIæ’ä»¶æ¥è¯´ï¼Œè¿™ä¸¤ä¸ªæ“ä½œæ„å‘³ç€æŠŠå®¹å™¨ä»¥Veth Pairçš„æ–¹å¼â€œæ’â€åˆ°CNIç½‘æ¡¥ä¸Šï¼Œæˆ–è€…ä»ç½‘æ¡¥ä¸Šâ€œæ‹”â€æ‰ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¥ADDæ“ä½œä¸ºé‡ç‚¹è¿›è¡Œè®²è§£ã€‚</p><p>CNIçš„ADDæ“ä½œéœ€è¦çš„å‚æ•°åŒ…æ‹¬ï¼šå®¹å™¨é‡Œç½‘å¡çš„åå­—eth0ï¼ˆCNI_IFNAMEï¼‰ã€Podçš„Network Namespaceæ–‡ä»¶çš„è·¯å¾„ï¼ˆCNI_NETNSï¼‰ã€å®¹å™¨çš„IDï¼ˆCNI_CONTAINERIDï¼‰ç­‰ã€‚è¿™äº›å‚æ•°éƒ½å±äºä¸Šè¿°ç¯å¢ƒå˜é‡é‡Œçš„å†…å®¹ã€‚å…¶ä¸­ï¼ŒPodï¼ˆInfraå®¹å™¨ï¼‰çš„Network Namespaceæ–‡ä»¶çš„è·¯å¾„ï¼Œæˆ‘åœ¨å‰é¢è®²è§£å®¹å™¨åŸºç¡€çš„æ—¶å€™æåˆ°è¿‡ï¼Œå³ï¼š/proc/&lt;å®¹å™¨è¿›ç¨‹çš„PID&gt;/ns/netã€‚</p><blockquote>\n<p>å¤‡æ³¨ï¼šè¿™é‡Œä½ ä¹Ÿå¯ä»¥å†å›é¡¾ä¸‹ä¸“æ ç¬¬8ç¯‡æ–‡ç« <a href=\"https://time.geekbang.org/column/article/18119\">ã€Šç™½è¯å®¹å™¨åŸºç¡€ï¼ˆå››ï¼‰ï¼šé‡æ–°è®¤è¯†Dockerå®¹å™¨ã€‹</a>ä¸­çš„ç›¸å…³å†…å®¹ã€‚</p>\n</blockquote><p>é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨ CNI ç¯å¢ƒå˜é‡é‡Œï¼Œè¿˜æœ‰ä¸€ä¸ªå«ä½œCNI_ARGSçš„å‚æ•°ã€‚é€šè¿‡è¿™ä¸ªå‚æ•°ï¼ŒCRIå®ç°ï¼ˆæ¯”å¦‚dockershimï¼‰å°±å¯ä»¥ä»¥Key-Valueçš„æ ¼å¼ï¼Œä¼ é€’è‡ªå®šä¹‰ä¿¡æ¯ç»™ç½‘ç»œæ’ä»¶ã€‚è¿™æ˜¯ç”¨æˆ·å°†æ¥è‡ªå®šä¹‰CNIåè®®çš„ä¸€ä¸ªé‡è¦æ–¹æ³•ã€‚</p><p><strong>ç¬¬äºŒéƒ¨åˆ†ï¼Œåˆ™æ˜¯dockershimä»CNIé…ç½®æ–‡ä»¶é‡ŒåŠ è½½åˆ°çš„ã€é»˜è®¤æ’ä»¶çš„é…ç½®ä¿¡æ¯ã€‚</strong></p><p>è¿™ä¸ªé…ç½®ä¿¡æ¯åœ¨CNIä¸­è¢«å«ä½œNetwork Configurationï¼Œå®ƒçš„å®Œæ•´å®šä¹‰ä½ å¯ä»¥å‚è€ƒ<a href=\"https://github.com/containernetworking/cni/blob/master/SPEC.md#network-configuration\">è¿™ä¸ªæ–‡æ¡£</a>ã€‚dockershimä¼šæŠŠNetwork Configurationä»¥JSONæ•°æ®çš„æ ¼å¼ï¼Œé€šè¿‡æ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰çš„æ–¹å¼ä¼ é€’ç»™Flannel CNIæ’ä»¶ã€‚</p><p>è€Œæœ‰äº†è¿™ä¸¤éƒ¨åˆ†å‚æ•°ï¼ŒFlannel CNIæ’ä»¶å®ç°ADDæ“ä½œçš„è¿‡ç¨‹å°±éå¸¸ç®€å•äº†ã€‚</p><p>ä¸è¿‡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒFlannelçš„CNIé…ç½®æ–‡ä»¶ï¼ˆ /etc/cni/net.d/10-flannel.conflistï¼‰é‡Œæœ‰è¿™ä¹ˆä¸€ä¸ªå­—æ®µï¼Œå«ä½œdelegateï¼š</p><pre><code>...\n     &quot;delegate&quot;: {\n        &quot;hairpinMode&quot;: true,\n        &quot;isDefaultGateway&quot;: true\n      }\n</code></pre><p>Delegateå­—æ®µçš„æ„æ€æ˜¯ï¼Œè¿™ä¸ªCNIæ’ä»¶å¹¶ä¸ä¼šè‡ªå·±åšäº‹å„¿ï¼Œè€Œæ˜¯ä¼šè°ƒç”¨DelegateæŒ‡å®šçš„æŸç§CNIå†…ç½®æ’ä»¶æ¥å®Œæˆã€‚å¯¹äºFlannelæ¥è¯´ï¼Œå®ƒè°ƒç”¨çš„Delegateæ’ä»¶ï¼Œå°±æ˜¯å‰é¢ä»‹ç»åˆ°çš„CNI bridgeæ’ä»¶ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œdockershimå¯¹Flannel CNIæ’ä»¶çš„è°ƒç”¨ï¼Œå…¶å®å°±æ˜¯èµ°äº†ä¸ªè¿‡åœºã€‚Flannel CNIæ’ä»¶å”¯ä¸€éœ€è¦åšçš„ï¼Œå°±æ˜¯å¯¹dockershimä¼ æ¥çš„Network Configurationè¿›è¡Œè¡¥å……ã€‚æ¯”å¦‚ï¼Œå°†Delegateçš„Typeå­—æ®µè®¾ç½®ä¸ºbridgeï¼Œå°†Delegateçš„IPAMå­—æ®µè®¾ç½®ä¸ºhost-localç­‰ã€‚</p><p>ç»è¿‡Flannel CNIæ’ä»¶è¡¥å……åçš„ã€å®Œæ•´çš„Delegateå­—æ®µå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>{\n    &quot;hairpinMode&quot;:true,\n    &quot;ipMasq&quot;:false,\n    &quot;ipam&quot;:{\n        &quot;routes&quot;:[\n            {\n                &quot;dst&quot;:&quot;10.244.0.0/16&quot;\n            }\n        ],\n        &quot;subnet&quot;:&quot;10.244.1.0/24&quot;,\n        &quot;type&quot;:&quot;host-local&quot;\n    },\n    &quot;isDefaultGateway&quot;:true,\n    &quot;isGateway&quot;:true,\n    &quot;mtu&quot;:1410,\n    &quot;name&quot;:&quot;cbr0&quot;,\n    &quot;type&quot;:&quot;bridge&quot;\n}\n</code></pre><p>å…¶ä¸­ï¼Œipamå­—æ®µé‡Œçš„ä¿¡æ¯ï¼Œæ¯”å¦‚10.244.1.0/24ï¼Œè¯»å–è‡ªFlannelåœ¨å®¿ä¸»æœºä¸Šç”Ÿæˆçš„Flannelé…ç½®æ–‡ä»¶ï¼Œå³ï¼šå®¿ä¸»æœºä¸Šçš„/run/flannel/subnet.envæ–‡ä»¶ã€‚</p><p>æ¥ä¸‹æ¥ï¼ŒFlannel CNIæ’ä»¶å°±ä¼šè°ƒç”¨CNI bridgeæ’ä»¶ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œï¼š/opt/cni/bin/bridgeäºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p><p>è¿™ä¸€æ¬¡ï¼Œè°ƒç”¨CNI bridgeæ’ä»¶éœ€è¦çš„ä¸¤éƒ¨åˆ†å‚æ•°çš„ç¬¬ä¸€éƒ¨åˆ†ã€ä¹Ÿå°±æ˜¯CNIç¯å¢ƒå˜é‡ï¼Œå¹¶æ²¡æœ‰å˜åŒ–ã€‚æ‰€ä»¥ï¼Œå®ƒé‡Œé¢çš„CNI_COMMANDå‚æ•°çš„å€¼è¿˜æ˜¯â€œADDâ€ã€‚</p><p>è€Œç¬¬äºŒéƒ¨åˆ†Network Configrationï¼Œæ­£æ˜¯ä¸Šé¢è¡¥å……å¥½çš„Delegateå­—æ®µã€‚Flannel CNIæ’ä»¶ä¼šæŠŠDelegateå­—æ®µçš„å†…å®¹ä»¥æ ‡å‡†è¾“å…¥ï¼ˆstdinï¼‰çš„æ–¹å¼ä¼ é€’ç»™CNI bridgeæ’ä»¶ã€‚</p><blockquote>\n<p>æ­¤å¤–ï¼ŒFlannel CNIæ’ä»¶è¿˜ä¼šæŠŠDelegateå­—æ®µä»¥JSONæ–‡ä»¶çš„æ–¹å¼ï¼Œä¿å­˜åœ¨/var/lib/cni/flannelç›®å½•ä¸‹ã€‚è¿™æ˜¯ä¸ºäº†ç»™åé¢åˆ é™¤å®¹å™¨è°ƒç”¨DELæ“ä½œæ—¶ä½¿ç”¨çš„ã€‚</p>\n</blockquote><p>æœ‰äº†è¿™ä¸¤éƒ¨åˆ†å‚æ•°ï¼Œæ¥ä¸‹æ¥CNI bridgeæ’ä»¶å°±å¯ä»¥â€œä»£è¡¨â€Flannelï¼Œè¿›è¡Œâ€œå°†å®¹å™¨åŠ å…¥åˆ°CNIç½‘ç»œé‡Œâ€è¿™ä¸€æ­¥æ“ä½œäº†ã€‚è€Œè¿™ä¸€éƒ¨åˆ†å†…å®¹ï¼Œä¸å®¹å™¨Network Namespaceå¯†åˆ‡ç›¸å…³ï¼Œæ‰€ä»¥æˆ‘è¦ä¸ºä½ è¯¦ç»†è®²è§£ä¸€ä¸‹ã€‚</p><p>é¦–å…ˆï¼ŒCNI bridgeæ’ä»¶ä¼šåœ¨å®¿ä¸»æœºä¸Šæ£€æŸ¥CNIç½‘æ¡¥æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœæ²¡æœ‰çš„è¯ï¼Œé‚£å°±åˆ›å»ºå®ƒã€‚è¿™ç›¸å½“äºåœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œï¼š</p><pre><code># åœ¨å®¿ä¸»æœºä¸Š\n$ ip link add cni0 type bridge\n$ ip link set cni0 up\n</code></pre><p>æ¥ä¸‹æ¥ï¼ŒCNI bridgeæ’ä»¶ä¼šé€šè¿‡Infraå®¹å™¨çš„Network Namespaceæ–‡ä»¶ï¼Œè¿›å…¥åˆ°è¿™ä¸ªNetwork Namespaceé‡Œé¢ï¼Œç„¶ååˆ›å»ºä¸€å¯¹Veth Pairè®¾å¤‡ã€‚</p><p>ç´§æ¥ç€ï¼Œå®ƒä¼šæŠŠè¿™ä¸ªVeth Pairçš„å…¶ä¸­ä¸€ç«¯ï¼Œâ€œç§»åŠ¨â€åˆ°å®¿ä¸»æœºä¸Šã€‚è¿™ç›¸å½“äºåœ¨å®¹å™¨é‡Œæ‰§è¡Œå¦‚ä¸‹æ‰€ç¤ºçš„å‘½ä»¤ï¼š</p><pre><code>#åœ¨å®¹å™¨é‡Œ\n\n# åˆ›å»ºä¸€å¯¹Veth Pairè®¾å¤‡ã€‚å…¶ä¸­ä¸€ä¸ªå«ä½œeth0ï¼Œå¦ä¸€ä¸ªå«ä½œvethb4963f3\n$ ip link add eth0 type veth peer name vethb4963f3\n\n# å¯åŠ¨eth0è®¾å¤‡\n$ ip link set eth0 up \n\n# å°†Veth Pairè®¾å¤‡çš„å¦ä¸€ç«¯ï¼ˆä¹Ÿå°±æ˜¯vethb4963f3è®¾å¤‡ï¼‰æ”¾åˆ°å®¿ä¸»æœºï¼ˆä¹Ÿå°±æ˜¯Host Namespaceï¼‰é‡Œ\n$ ip link set vethb4963f3 netns $HOST_NS\n\n# é€šè¿‡Host Namespaceï¼Œå¯åŠ¨å®¿ä¸»æœºä¸Šçš„vethb4963f3è®¾å¤‡\n$ ip netns exec $HOST_NS ip link set vethb4963f3 up \n</code></pre><p>è¿™æ ·ï¼Œvethb4963f3å°±å‡ºç°åœ¨äº†å®¿ä¸»æœºä¸Šï¼Œè€Œä¸”è¿™ä¸ªVeth Pairè®¾å¤‡çš„å¦ä¸€ç«¯ï¼Œå°±æ˜¯å®¹å™¨é‡Œé¢çš„eth0ã€‚</p><p>å½“ç„¶ï¼Œä½ å¯èƒ½å·²ç»æƒ³åˆ°ï¼Œä¸Šè¿°åˆ›å»ºVeth Pairè®¾å¤‡çš„æ“ä½œï¼Œå…¶å®ä¹Ÿå¯ä»¥å…ˆåœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œï¼Œç„¶åå†æŠŠè¯¥è®¾å¤‡çš„ä¸€ç«¯æ”¾åˆ°å®¹å™¨çš„Network Namespaceé‡Œï¼Œè¿™ä¸ªåŸç†æ˜¯ä¸€æ ·çš„ã€‚</p><p>ä¸è¿‡ï¼ŒCNIæ’ä»¶ä¹‹æ‰€ä»¥è¦â€œåç€â€æ¥ï¼Œæ˜¯å› ä¸ºCNIé‡Œå¯¹Namespaceæ“ä½œå‡½æ•°çš„è®¾è®¡å°±æ˜¯å¦‚æ­¤ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>err := containerNS.Do(func(hostNS ns.NetNS) error {\n  ...\n  return nil\n})\n</code></pre><p>è¿™ä¸ªè®¾è®¡å…¶å®å¾ˆå®¹æ˜“ç†è§£ã€‚åœ¨ç¼–ç¨‹æ—¶ï¼Œå®¹å™¨çš„Namespaceæ˜¯å¯ä»¥ç›´æ¥é€šè¿‡Namespaceæ–‡ä»¶æ‹¿åˆ°çš„ï¼›è€ŒHost Namespaceï¼Œåˆ™æ˜¯ä¸€ä¸ªéšå«åœ¨ä¸Šä¸‹æ–‡çš„å‚æ•°ã€‚æ‰€ä»¥ï¼Œåƒä¸Šé¢è¿™æ ·ï¼Œå…ˆé€šè¿‡å®¹å™¨Namespaceè¿›å…¥å®¹å™¨é‡Œé¢ï¼Œç„¶åå†åå‘æ“ä½œHost Namespaceï¼Œå¯¹äºç¼–ç¨‹æ¥è¯´è¦æ›´åŠ æ–¹ä¾¿ã€‚</p><p>æ¥ä¸‹æ¥ï¼ŒCNI bridgeæ’ä»¶å°±å¯ä»¥æŠŠvethb4963f3è®¾å¤‡è¿æ¥åœ¨CNIç½‘æ¡¥ä¸Šã€‚è¿™ç›¸å½“äºåœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œï¼š</p><pre><code># åœ¨å®¿ä¸»æœºä¸Š\n$ ip link set vethb4963f3 master cni0\n</code></pre><p>åœ¨å°†vethb4963f3è®¾å¤‡è¿æ¥åœ¨CNIç½‘æ¡¥ä¹‹åï¼ŒCNI bridgeæ’ä»¶è¿˜ä¼šä¸ºå®ƒè®¾ç½®<strong>Hairpin Modeï¼ˆå‘å¤¹æ¨¡å¼ï¼‰</strong>ã€‚è¿™æ˜¯å› ä¸ºï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œç½‘æ¡¥è®¾å¤‡æ˜¯ä¸å…è®¸ä¸€ä¸ªæ•°æ®åŒ…ä»ä¸€ä¸ªç«¯å£è¿›æ¥åï¼Œå†ä»è¿™ä¸ªç«¯å£å‘å‡ºå»çš„ã€‚ä½†æ˜¯ï¼Œå®ƒå…è®¸ä½ ä¸ºè¿™ä¸ªç«¯å£å¼€å¯Hairpin Modeï¼Œä»è€Œå–æ¶ˆè¿™ä¸ªé™åˆ¶ã€‚</p><p>è¿™ä¸ªç‰¹æ€§ï¼Œä¸»è¦ç”¨åœ¨å®¹å™¨éœ€è¦é€šè¿‡<a href=\"https://en.wikipedia.org/wiki/Network_address_translation\">NAT</a>ï¼ˆå³ï¼šç«¯å£æ˜ å°„ï¼‰çš„æ–¹å¼ï¼Œâ€œè‡ªå·±è®¿é—®è‡ªå·±â€çš„åœºæ™¯ä¸‹ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚æˆ‘ä»¬æ‰§è¡Œdocker run -p 8080:80ï¼Œå°±æ˜¯åœ¨å®¿ä¸»æœºä¸Šé€šè¿‡iptablesè®¾ç½®äº†ä¸€æ¡<a href=\"http://linux-ip.net/html/nat-dnat.html\">DNAT</a>ï¼ˆç›®çš„åœ°å€è½¬æ¢ï¼‰è½¬å‘è§„åˆ™ã€‚è¿™æ¡è§„åˆ™çš„ä½œç”¨æ˜¯ï¼Œå½“å®¿ä¸»æœºä¸Šçš„è¿›ç¨‹è®¿é—®â€œ&lt;å®¿ä¸»æœºçš„IPåœ°å€&gt;:8080â€æ—¶ï¼Œiptablesä¼šæŠŠè¯¥è¯·æ±‚ç›´æ¥è½¬å‘åˆ°â€œ&lt;å®¹å™¨çš„IPåœ°å€&gt;:80â€ä¸Šã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªè¯·æ±‚æœ€ç»ˆä¼šç»è¿‡docker0ç½‘æ¡¥è¿›å…¥å®¹å™¨é‡Œé¢ã€‚</p><p>ä½†å¦‚æœä½ æ˜¯åœ¨å®¹å™¨é‡Œé¢è®¿é—®å®¿ä¸»æœºçš„8080ç«¯å£ï¼Œé‚£ä¹ˆè¿™ä¸ªå®¹å™¨é‡Œå‘å‡ºçš„IPåŒ…ä¼šç»è¿‡vethb4963f3è®¾å¤‡ï¼ˆç«¯å£ï¼‰å’Œdocker0ç½‘æ¡¥ï¼Œæ¥åˆ°å®¿ä¸»æœºä¸Šã€‚æ­¤æ—¶ï¼Œæ ¹æ®ä¸Šè¿°DNATè§„åˆ™ï¼Œè¿™ä¸ªIPåŒ…åˆéœ€è¦å›åˆ°docker0ç½‘æ¡¥ï¼Œå¹¶ä¸”è¿˜æ˜¯é€šè¿‡vethb4963f3ç«¯å£è¿›å…¥åˆ°å®¹å™¨é‡Œã€‚æ‰€ä»¥ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±éœ€è¦å¼€å¯vethb4963f3ç«¯å£çš„Hairpin Modeäº†ã€‚</p><p>æ‰€ä»¥è¯´ï¼ŒFlannelæ’ä»¶è¦åœ¨CNIé…ç½®æ–‡ä»¶é‡Œå£°æ˜hairpinMode=trueã€‚è¿™æ ·ï¼Œå°†æ¥è¿™ä¸ªé›†ç¾¤é‡Œçš„Podæ‰å¯ä»¥é€šè¿‡å®ƒè‡ªå·±çš„Serviceè®¿é—®åˆ°è‡ªå·±ã€‚</p><p>æ¥ä¸‹æ¥ï¼ŒCNI bridgeæ’ä»¶ä¼šè°ƒç”¨CNI ipamæ’ä»¶ï¼Œä»ipam.subnetå­—æ®µè§„å®šçš„ç½‘æ®µé‡Œä¸ºå®¹å™¨åˆ†é…ä¸€ä¸ªå¯ç”¨çš„IPåœ°å€ã€‚ç„¶åï¼ŒCNI bridgeæ’ä»¶å°±ä¼šæŠŠè¿™ä¸ªIPåœ°å€æ·»åŠ åœ¨å®¹å™¨çš„eth0ç½‘å¡ä¸Šï¼ŒåŒæ—¶ä¸ºå®¹å™¨è®¾ç½®é»˜è®¤è·¯ç”±ã€‚è¿™ç›¸å½“äºåœ¨å®¹å™¨é‡Œæ‰§è¡Œï¼š</p><pre><code># åœ¨å®¹å™¨é‡Œ\n$ ip addr add 10.244.0.2/24 dev eth0\n$ ip route add default via 10.244.0.1 dev eth0\n</code></pre><p>æœ€åï¼ŒCNI bridgeæ’ä»¶ä¼šä¸ºCNIç½‘æ¡¥æ·»åŠ IPåœ°å€ã€‚è¿™ç›¸å½“äºåœ¨å®¿ä¸»æœºä¸Šæ‰§è¡Œï¼š</p><pre><code># åœ¨å®¿ä¸»æœºä¸Š\n$ ip addr add 10.244.0.1/24 dev cni0\n</code></pre><p>åœ¨æ‰§è¡Œå®Œä¸Šè¿°æ“ä½œä¹‹åï¼ŒCNIæ’ä»¶ä¼šæŠŠå®¹å™¨çš„IPåœ°å€ç­‰ä¿¡æ¯è¿”å›ç»™dockershimï¼Œç„¶åè¢«kubeletæ·»åŠ åˆ°Podçš„Statuså­—æ®µã€‚</p><p>è‡³æ­¤ï¼ŒCNIæ’ä»¶çš„ADDæ–¹æ³•å°±å®£å‘Šç»“æŸäº†ã€‚æ¥ä¸‹æ¥çš„æµç¨‹ï¼Œå°±è·Ÿæˆ‘ä»¬ä¸Šä¸€ç¯‡æ–‡ç« ä¸­å®¹å™¨è·¨ä¸»æœºé€šä¿¡çš„è¿‡ç¨‹å®Œå…¨ä¸€è‡´äº†ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºéç½‘æ¡¥ç±»å‹çš„CNIæ’ä»¶ï¼Œä¸Šè¿°â€œå°†å®¹å™¨æ·»åŠ åˆ°CNIç½‘ç»œâ€çš„æ“ä½œæµç¨‹ï¼Œä»¥åŠç½‘ç»œæ–¹æ¡ˆæœ¬èº«çš„å·¥ä½œåŸç†ï¼Œå°±éƒ½ä¸å¤ªä¸€æ ·äº†ã€‚æˆ‘å°†ä¼šåœ¨åç»­æ–‡ç« ä¸­ï¼Œç»§ç»­ä¸ºä½ åˆ†æè¿™éƒ¨åˆ†å†…å®¹ã€‚</p><h2>æ€»ç»“</h2><p>åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä¸ºä½ è¯¦ç»†è®²è§£äº†Kubernetesä¸­CNIç½‘ç»œçš„å®ç°åŸç†ã€‚æ ¹æ®è¿™ä¸ªåŸç†ï¼Œä½ å…¶å®å°±å¾ˆå®¹æ˜“ç†è§£æ‰€è°“çš„â€œKubernetesç½‘ç»œæ¨¡å‹â€äº†ï¼š</p><ol>\n<li>\n<p>æ‰€æœ‰å®¹å™¨éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨IPåœ°å€ä¸å…¶ä»–å®¹å™¨é€šä¿¡ï¼Œè€Œæ— éœ€ä½¿ç”¨NATã€‚</p>\n</li>\n<li>\n<p>æ‰€æœ‰å®¿ä¸»æœºéƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨IPåœ°å€ä¸æ‰€æœ‰å®¹å™¨é€šä¿¡ï¼Œè€Œæ— éœ€ä½¿ç”¨NATã€‚åä¹‹äº¦ç„¶ã€‚</p>\n</li>\n<li>\n<p>å®¹å™¨è‡ªå·±â€œçœ‹åˆ°â€çš„è‡ªå·±çš„IPåœ°å€ï¼Œå’Œåˆ«äººï¼ˆå®¿ä¸»æœºæˆ–è€…å®¹å™¨ï¼‰çœ‹åˆ°çš„åœ°å€æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚</p>\n</li>\n</ol><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªç½‘ç»œæ¨¡å‹ï¼Œå…¶å®å¯ä»¥ç”¨ä¸€ä¸ªå­—æ€»ç»“ï¼Œé‚£å°±æ˜¯â€œé€šâ€ã€‚</p><p>å®¹å™¨ä¸å®¹å™¨ä¹‹é—´è¦â€œé€šâ€ï¼Œå®¹å™¨ä¸å®¿ä¸»æœºä¹‹é—´ä¹Ÿè¦â€œé€šâ€ã€‚å¹¶ä¸”ï¼ŒKubernetesè¦æ±‚è¿™ä¸ªâ€œé€šâ€ï¼Œè¿˜å¿…é¡»æ˜¯ç›´æ¥åŸºäºå®¹å™¨å’Œå®¿ä¸»æœºçš„IPåœ°å€æ¥è¿›è¡Œçš„ã€‚</p><p>å½“ç„¶ï¼Œè€ƒè™‘åˆ°ä¸åŒç”¨æˆ·ä¹‹é—´çš„éš”ç¦»æ€§ï¼Œåœ¨å¾ˆå¤šåœºåˆä¸‹ï¼Œæˆ‘ä»¬è¿˜è¦æ±‚å®¹å™¨ä¹‹é—´çš„ç½‘ç»œâ€œä¸é€šâ€ã€‚è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä¼šåœ¨åé¢çš„æ–‡ç« ä¸­ä¼šä¸ºä½ è§£å†³ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>è¯·ä½ æ€è€ƒä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆKubernetesé¡¹ç›®ä¸è‡ªå·±å®ç°å®¹å™¨ç½‘ç»œï¼Œè€Œæ˜¯è¦é€šè¿‡ CNI åšä¸€ä¸ªå¦‚æ­¤ç®€å•çš„å‡è®¾å‘¢ï¼Ÿ</p><p>æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæ¬¢è¿ä½ ç»™æˆ‘ç•™è¨€ï¼Œä¹Ÿæ¬¢è¿åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p>","comments":[{"had_liked":false,"id":38136,"user_name":"blackpiglet","can_delete":false,"product_type":"c1","uid":1032928,"ip_address":"","ucode":"58AA8329C91767","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c2/e0/7188aa0a.jpg","comment_is_top":false,"comment_ctime":1541951920,"is_pvip":false,"replies":[{"id":"13734","content":"åˆ†æçš„å¾ˆä¸é”™","user_name":"ä½œè€…å›å¤","comment_id":38136,"uid":"1218095","ip_address":"","utype":1,"ctime":1542000606,"user_name_real":"Geek_6ef93d"}],"discussion_count":7,"race_medal":0,"score":"770341097904","product_id":100015201,"comment_content":"æ€è€ƒé¢˜ï¼šä¸ºä»€ä¹ˆ Kubernetes é¡¹ç›®ä¸è‡ªå·±å®ç°å®¹å™¨ç½‘ç»œï¼Œè€Œæ˜¯è¦é€šè¿‡ CNI åšä¸€ä¸ªå¦‚æ­¤ç®€å•çš„å‡è®¾å‘¢ï¼Ÿ<br><br>è§£ç­”ï¼šæ²¡æœ‰äº²å† Kubernetes ç½‘ç»œæ ‡å‡†åŒ–çš„è¿™ä¸ªé˜¶æ®µï¼Œä»¥ä¸‹å†…å®¹éƒ½æ˜¯åŸºäºçŒœæµ‹ï¼Œå¤§å®¶è§ç¬‘äº†ã€‚<br>æœ€å¼€å§‹æˆ‘è§‰å¾—è¿™å°±æ˜¯ä¸ºäº†æä¾›æ›´å¤šçš„ä¾¿åˆ©é€‰æ‹©ï¼Œæœ‰äº† CNIï¼Œé‚£ä¹ˆåªè¦ç¬¦åˆè§„åˆ™ï¼Œä»€ä¹ˆæ’ä»¶éƒ½å¯ä»¥ç”¨ï¼Œç”¨æˆ·çš„è‡ªç”±åº¦æ›´é«˜ï¼Œè¿™æ˜¯ Google å’Œ Kubernetes å¼€æ”¾æ€§çš„ä½“ç°ã€‚ä½†è½¬å¿µä¸€æƒ³ï¼Œå¦‚æœ Kubernetes ä¸€å¼€å§‹å°±æœ‰å®˜æ–¹çš„è§£å†³æ–¹æ¡ˆï¼Œææ€•ä¹Ÿä¸ä¼šæœ‰ä»€ä¹ˆä¸å¦¥ï¼Œæ„Ÿè§‰è¦ç†è§£çš„æ›´æ·±ï¼Œå¾—è¿½æº¯åˆ° Kubernetes åˆ›å»ºä¹‹åˆçš„å¤–éƒ¨ç¯å¢ƒå’Œ Google çš„å¼€æºç­–ç•¥äº†ã€‚Github ä¸Šæœ€æ—©çš„ Kubernetes ç‰ˆæœ¬æ˜¯ 0.4ï¼Œå…¶ä¸­çš„ç½‘ç»œéƒ¨åˆ†ï¼Œæœ€å¼€å§‹å®˜æ–¹çš„å®ç°æ–¹å¼å°±æ˜¯ GCE æ‰§è¡Œ salt è„šæœ¬åˆ›å»º bridgeï¼Œå…¶ä»–ç¯å¢ƒçš„æ¨èçš„æ–¹æ¡ˆæ˜¯ Flannel å’Œ OVSã€‚<br>æ‰€ä»¥æˆ‘çŒœæµ‹ï¼š<br>é¦–å…ˆç»™ Kubernetes å‘å±•çš„æ—¶é—´æ˜¯ä¸å¤šçš„ï¼ˆDocker å·²ç»å¤§çº¢å¤§ç´«äº†ï¼Œå†ä¸èµ¶ç´§å°±ä¸€ç»Ÿå¤©ä¸‹äº†ï¼‰ï¼Œç»™å¼€å‘å›¢é˜Ÿçš„æ—¶é—´åªå¤Ÿä¸“å¿ƒå®ç°ç¼–æ’è¿™ç§æœ€æ ¸å¿ƒçš„åŠŸèƒ½ï¼Œç½‘ç»œåŠŸèƒ½æ°å¥½ç›Ÿå‹ CoreOS çš„ Flannel å¯ä»¥æ‹¿è¿‡æ¥ç”¨ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥è®¤ä¸º Flannel å°±æ˜¯æœ€åˆ Kubernetes çš„å®˜æ–¹ç½‘ç»œæ’ä»¶ã€‚Kubernetes å‘å±•èµ·æ¥ä¹‹åï¼ŒFlannel åœ¨æœ‰äº›æƒ…å†µä¸‹å°±ä¸å¤Ÿç”¨äº†ï¼Œ15 å¹´å·¦å³ç¤¾åŒºé‡Œ Calico å’Œ  Weave å†’äº†å‡ºæ¥ï¼ŒåŸºæœ¬è§£å†³äº†ç½‘ç»œé—®é¢˜ï¼ŒKubernetes å°±æ›´ä¸éœ€è¦è‡ªå·±èŠ±ç²¾åŠ›æ¥åšè¿™ä»¶äº‹äº†ï¼Œæ‰€ä»¥æ¨å‡ºäº† CNIï¼Œæ¥åšç½‘ç»œæ’ä»¶çš„æ ‡å‡†åŒ–ã€‚æˆ‘è§‰å¾—å‡å¦‚ç¤¾åŒºé‡Œç½‘ç»œä¸€ç›´æ²¡æœ‰å¥½çš„è§£å†³æ–¹æ¡ˆçš„è¯ï¼ŒKubernetes è‚¯å®šè¿˜æ˜¯ä¼šäº²è‡ªä¸Šé˜µçš„ã€‚<br>å…¶æ¬¡ï¼ŒGoogle å¼€æºé¡¹ç›®æ¯•ç«Ÿä¹Ÿä¸æ˜¯åšæ…ˆå–„ï¼Œä»€ä¹ˆéƒ½åšçš„é¢é¢ä¿±åˆ°ï¼Œé‚£è¦æ¶ˆè€—æ›´å¤šçš„æˆæœ¬ï¼Œå½“ç„¶æ˜¯è¶Šå¤šçš„å¤–éƒ¨èµ„æºä¸ºæˆ‘æ‰€ç”¨è¶Šå¥½äº†ã€‚æ„Ÿè§‰æ¨å‡ºæ ¸å¿ƒåŠŸèƒ½ï¼Œå¸å¼•å¼€å‘è€…è¿‡æ¥åšè´¡çŒ®çš„ææ³•ï¼Œä¹Ÿç®—æ˜¯å·¨å¤´ä»¬å¼€æºçš„ä¸€ç§å¥—è·¯å§ã€‚","like_count":180,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428618,"discussion_content":"åˆ†æçš„å¾ˆä¸é”™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542000606,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1019302,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8d/a6/22c37c91.jpg","nickname":"æ¥Š_å®µå¤œ","note":"","ucode":"7BA0CADC5F23BB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382824,"discussion_content":"ä½ æ˜¯ä¸æ˜¯k8sçš„contributorè·‘æ¥å¸ƒé“çš„ [ç‹—å¤´","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1625733220,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1970516,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLK4NPyaFDl4rzrd4A9z42tQDibFLdCicbrAdyUa5P2B5u8UCUBenpHX7VgUCibvHvhpza4icMBKVnhmA/132","nickname":"å­¦æ— æ­¢å¢ƒ","note":"","ucode":"2C28E8E54DAB4E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390313,"discussion_content":"è¯´çš„çœŸå¿ƒä¸é”™ï¼Œåˆ†æçš„å¾ˆåˆ°ä½ï¼Œå‰å®³äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629774267,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2378009,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKicUgL8bc6EDj2w7GG8UjxRFYicmXlAdUHaSRdAT798ibpfOgF9OWFku5jad5ezWFGkCWXnoqFgSWlw/132","nickname":"iamcaptain","note":"","ucode":"868D95D47E033E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377369,"discussion_content":"åœ¨è¯´ä¸‹å…¶å®ƒæ–¹é¢çš„å†…å®¹å°±å¯ä»¥å‡ºä¹¦äº†å“Ÿï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622618496,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1121758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","nickname":"aoe","note":"","ucode":"1C6201EDB4E954","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308505,"discussion_content":"éšè—çš„å¤§ä½¬","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600963657,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1433247,"avatar":"https://static001.geekbang.org/account/avatar/00/15/de/9f/b6c59a75.jpg","nickname":"dustï¼","note":"","ucode":"7ADCCC7985B381","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":143460,"discussion_content":"å¸å¼•ä½ å‚ä¸è¿›æ¥ï¼Œç„¶åå‰²éŸ­èœï¼Œå“ˆå“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579508452,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1095819,"avatar":"https://static001.geekbang.org/account/avatar/00/10/b8/8b/68555cbf.jpg","nickname":"Geek_122dd9","note":"","ucode":"12BDEF1FC06633","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1433247,"avatar":"https://static001.geekbang.org/account/avatar/00/15/de/9f/b6c59a75.jpg","nickname":"dustï¼","note":"","ucode":"7ADCCC7985B381","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586214,"discussion_content":"éŸ­èœï¼šæˆ‘ä¹æ„ï¼Œå“ˆå“ˆå“ˆğŸ˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662043500,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":143460,"ip_address":"å¹¿ä¸œ"},"score":586214,"extra":""}]}]},{"had_liked":false,"id":103702,"user_name":"å•æœ‹è£","can_delete":false,"product_type":"c1","uid":1272662,"ip_address":"","ucode":"8AD121BEDD9675","user_header":"https://static001.geekbang.org/account/avatar/00/13/6b/56/37a4cea7.jpg","comment_is_top":false,"comment_ctime":1560494591,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"173359186431","product_id":100015201,"comment_content":"å…¶å®æœ¬ç« éš¾ç‚¹åœ¨äºå®ç°ç½‘ç»œæ–¹æ¡ˆå¯¹åº”çš„CNIæ’ä»¶ï¼Œå³é…ç½®Infraå®¹å™¨çš„ç½‘ç»œæ ˆï¼Œå¹¶è¿åˆ°ç½‘æ¡¥ä¸Šã€‚æ•´ä½“æµç¨‹æ˜¯ï¼škubeletåˆ›å»ºPod-&gt;åˆ›å»ºInfraå®¹å™¨-&gt;è°ƒç”¨SetUpPodï¼ˆï¼‰æ–¹æ³•ï¼Œè¯¥æ–¹æ³•éœ€è¦ä¸ºCNIå‡†å¤‡å‚æ•°ï¼Œç„¶åè°ƒç”¨CNIæ’ä»¶ï¼ˆflannel)ä¸ºInfraé…ç½®ç½‘ç»œï¼›å…¶ä¸­å‚æ•°æ¥æºäº1ã€dockershimè®¾ç½®çš„ä¸€ç»„CNIç¯å¢ƒå˜é‡ï¼›2ã€dockershimä»CNIé…ç½®æ–‡ä»¶é‡Œï¼ˆæœ‰flanneldå¯åŠ¨åç”Ÿæˆï¼Œç±»å‹ä¸ºconfigmapï¼‰åŠ è½½åˆ°çš„ã€é»˜è®¤æ’ä»¶çš„é…ç½®ä¿¡æ¯ï¼ˆnetwork configuration)ï¼Œè¿™é‡Œå¯¹CNIæ’ä»¶çš„è°ƒç”¨ï¼Œå®é™…æ˜¯network configurationè¿›è¡Œè¡¥å……ã€‚å‚æ•°å‡†å¤‡å¥½åï¼Œè°ƒç”¨Flannel CNI-&gt;è°ƒç”¨CNI bridgeï¼ˆæ‰€éœ€å‚æ•°å³ä¸ºä¸Šé¢ï¼šè®¾ç½®çš„CNIç¯å¢ƒå˜é‡å’Œè¡¥å……çš„network configuationï¼‰æ¥æ‰§è¡Œå…·ä½“çš„æ“ä½œæµç¨‹ã€‚","like_count":41,"discussions":[{"author":{"id":1088303,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9b/2f/db466c67.jpg","nickname":"HD","note":"","ucode":"3F61B901BB9245","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349054,"discussion_content":"è¦æ˜¯æœ‰ä¸€å¼ æµç¨‹å›¾æ¥è¾…åŠ©ç†è§£çš„è¯ï¼Œä¼šå¥½å¾ˆå¤š","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1612862487,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2621412,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ff/e4/927547a9.jpg","nickname":"æ— åæ— å§“","note":"","ucode":"487BD5AA2CD305","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573969,"discussion_content":"ç¡®å®æœŸå¾…å›¾","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653751412,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2582020,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/yc4g6qyr8FgzRQmoOKSVHoZYDBiaXDLLEwibmNnmRwsQDg7z87C12CAY3jgRXNIYfEkUPLpZFIp53dLbTwaqVqVQ/132","nickname":"è¡Œèµ°çš„é˜¿å”","note":"","ucode":"055C6E3496927D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382338,"discussion_content":"ç¡®å®ï¼Œæœ‰å¼ å›¾è§£é‡Šä¼šæ›´å¥½ç†è§£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625537400,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":41297,"user_name":"é˜¿æ£ ","can_delete":false,"product_type":"c1","uid":1222354,"ip_address":"","ucode":"4C62FF98BCD925","user_header":"https://static001.geekbang.org/account/avatar/00/12/a6/d2/ebe20bb5.jpg","comment_is_top":false,"comment_ctime":1542764758,"is_pvip":false,"discussion_count":11,"race_medal":0,"score":"160456554710","product_id":100015201,"comment_content":"å‰å‡ ç« éƒ½å¾ˆå¥½ç†è§£ï¼Œä¸€åˆ°ç½‘ç»œè¿™å—ï¼Œå°±è’™äº†ï¼Œæ²¡è€å¿ƒçœ‹ä¸‹å»äº†","like_count":38,"discussions":[{"author":{"id":2930234,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/KqZeIjNOVQJnsIFkDBWl5wfaxWDGLpIMUdFbF7SQhXFavmxgpwQPj9FrGAV4xNrqd733qicT4IZVibELyziaLokDQ/132","nickname":"ç½—è‰º","note":"","ucode":"9D4E1A377BCF23","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568010,"discussion_content":"ç½‘ç»œæ‰æ˜¯æ•´ä¸ªä½“ç³»æœ€æœ‰æ„æ€çš„ï¼Œå› ä¸ºä»–æœ‰é€»è¾‘æ€§ï¼Œå…¶ä»–çš„å¾ˆå¤šçš„æ˜¯æ¦‚å¿µæ€§çš„ï¼Œå…¶å®å°±æ˜¯net namespace é‡Œé¢çš„ åˆ›å»ºç½‘æ¡¥  å¤©åŠ veth peer  å’Œç»‘å®šã€‚ç„¶åå°±æ˜¯äºŒå±‚çš„ç½‘æ¡¥äº’é€šï¼Œè·¨Nodeå°±æ˜¯ç”¨åˆ°ä¸‰å±‚çš„ç½‘ç»œè·¯ç”±äº†ã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1651043227,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1055810,"avatar":"https://static001.geekbang.org/account/avatar/00/10/1c/42/d3a0e33a.jpg","nickname":"å¸Œå¾·å°å­","note":"","ucode":"0F3DA846858DBD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":2930234,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/KqZeIjNOVQJnsIFkDBWl5wfaxWDGLpIMUdFbF7SQhXFavmxgpwQPj9FrGAV4xNrqd733qicT4IZVibELyziaLokDQ/132","nickname":"ç½—è‰º","note":"","ucode":"9D4E1A377BCF23","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577889,"discussion_content":"å“ˆå“ˆï¼Œæˆ‘ä¹Ÿè§‰å¾—ç½‘ç»œè¿™å—æœ€å¸å¼•æˆ‘ï¼Œè¿™å—å…¶å®ç®—æ¯”è¾ƒåŸºç¡€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656404155,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":568010,"ip_address":""},"score":577889,"extra":""}]},{"author":{"id":2291160,"avatar":"https://static001.geekbang.org/account/avatar/00/22/f5/d8/121e4b68.jpg","nickname":"Woa ğŸ¤","note":"","ucode":"6033F496082F3B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547176,"discussion_content":"æˆ‘è§‰å¾—ç½‘ç»œè¿™é‡Œæœ€å¥½ç©äº†ğŸ˜œ","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1642568197,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1970516,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLK4NPyaFDl4rzrd4A9z42tQDibFLdCicbrAdyUa5P2B5u8UCUBenpHX7VgUCibvHvhpza4icMBKVnhmA/132","nickname":"å­¦æ— æ­¢å¢ƒ","note":"","ucode":"2C28E8E54DAB4E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390314,"discussion_content":"æŒä¹…åŒ–è‡ªå®šä¹‰å­˜å‚¨ éƒ½æŒºè¿‡æ¥äº†ï¼Œè¿™å—ä½ è¯´éš¾ã€‚ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1629774328,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1095819,"avatar":"https://static001.geekbang.org/account/avatar/00/10/b8/8b/68555cbf.jpg","nickname":"Geek_122dd9","note":"","ucode":"12BDEF1FC06633","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1970516,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLK4NPyaFDl4rzrd4A9z42tQDibFLdCicbrAdyUa5P2B5u8UCUBenpHX7VgUCibvHvhpza4icMBKVnhmA/132","nickname":"å­¦æ— æ­¢å¢ƒ","note":"","ucode":"2C28E8E54DAB4E","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":586215,"discussion_content":"æˆ‘æ˜¯å…ˆçœ‹çš„ç½‘ç»œï¼Œç‹—å¤´ï¼ŒğŸ˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662043614,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":390314,"ip_address":"å¹¿ä¸œ"},"score":586215,"extra":""}]},{"author":{"id":2651519,"avatar":"https://static001.geekbang.org/account/avatar/00/28/75/7f/ff5dd565.jpg","nickname":"Cantevenl","note":"","ucode":"F5A62BA4355F6A","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378875,"discussion_content":"çœŸçš„å¥½éš¾ ç½‘ç»œè¿™å‡ ç«  ç¿»æ¥è¦†å»çœ‹äº†ä¸‰å››éäº† è¿˜æ˜¯ä¸æ€ä¹ˆæ‡‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1623481218,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1335273,"avatar":"https://static001.geekbang.org/account/avatar/00/14/5f/e9/510fa022.jpg","nickname":"å•å°è£","note":"","ucode":"9CB18695616330","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2651519,"avatar":"https://static001.geekbang.org/account/avatar/00/28/75/7f/ff5dd565.jpg","nickname":"Cantevenl","note":"","ucode":"F5A62BA4355F6A","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":571686,"discussion_content":"è¯´å‡ºæ¥æ€•ä¸¢äººï¼Œæˆ‘å·²ç»çœ‹äº†3ä¸ªæœˆäº†ã€‚ä» Ethenet ç½‘ç»œåè®®å¼€å§‹è¡¥èµ·ï¼Œç„¶åæ˜¯ Linux Bridgeï¼Œç°åœ¨ CNI è¿™ä¸€å—ï¼Œè¿˜æ˜¯çœ‹ä¸æ‡‚ï¼Œä¼°è®¡è¿˜å¾—3ä¸ªæœˆã€‚ä¸è¿‡åæ­£æ˜¯ä¸šä½™çˆ±å¥½ï¼Œå°±æ…¢æ…¢å•ƒå§ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1652347184,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":378875,"ip_address":""},"score":571686,"extra":""}]},{"author":{"id":2217004,"avatar":"https://static001.geekbang.org/account/avatar/00/21/d4/2c/d8f626f3.jpg","nickname":"hyx","note":"","ucode":"7987F771C78357","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552545,"discussion_content":"æœ€å¥½åŠ¨æ‰‹è¯•ä¸€ä¸‹ï¼Œæ¨èä¸€ä¸ªç®€å•çš„å®è·µhttps://www.cnblogs.com/bakari/p/10443484.html","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645506913,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2155490,"avatar":"https://static001.geekbang.org/account/avatar/00/20/e3/e2/476563d5.jpg","nickname":"é£˜å¶","note":"","ucode":"8BA994FE15EBBD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":309836,"discussion_content":"ç¼–ç¨‹ä½ éƒ½æŒºè¿‡æ¥äº†ï¼Œå€’åœ¨è¿™é‡Œï¼Ÿ ä¸åˆç®—å•Šï¼ŒåŠ æ²¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601457460,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1207457,"avatar":"https://static001.geekbang.org/account/avatar/00/12/6c/a1/80d83f0a.jpg","nickname":"Ellison","note":"","ucode":"A2FB94D4F6A332","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2155490,"avatar":"https://static001.geekbang.org/account/avatar/00/20/e3/e2/476563d5.jpg","nickname":"é£˜å¶","note":"","ucode":"8BA994FE15EBBD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350832,"discussion_content":"ç¼–ç¨‹ä¼šå•Š","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1614046803,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":309836,"ip_address":""},"score":350832,"extra":""}]},{"author":{"id":1121758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","nickname":"aoe","note":"","ucode":"1C6201EDB4E954","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308506,"discussion_content":"ç¼–æ’éƒ½æŒºè¿‡æ¥äº†ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600963679,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":273459,"user_name":"å•æœ‹è£","can_delete":false,"product_type":"c1","uid":1272662,"ip_address":"","ucode":"8AD121BEDD9675","user_header":"https://static001.geekbang.org/account/avatar/00/13/6b/56/37a4cea7.jpg","comment_is_top":false,"comment_ctime":1610604084,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"91804917300","product_id":100015201,"comment_content":"æŠŠæ¡å‡ ä¸ªæ ¸å¿ƒï¼Œç„¶åä¸²èµ·æ¥ï¼Œå…¶å®ƒéœ€è¦çš„ä¸œè¥¿å†å»æ‹¿å°±å¯ä»¥äº†ã€‚<br>é—®é¢˜ç‰µå¼•ï¼š<br>ç½‘ç»œæ–¹æ¡ˆæ˜¯è°ï¼Ÿå®ƒå’Œâ€œCNIæ ‡å‡†â€çš„å…³ç³»ï¼ˆå®ç°ï¼‰æ˜¯ï¼Ÿkubernetesç½‘ç»œé…ç½®ç”±è°æ¥å®Œæˆï¼Ÿï¼ˆæˆ–è€…è¯´æˆ‘è¦æ€ä¹ˆåšæ‰èƒ½å®ç°å®ƒï¼Ÿï¼Ÿï¼‰<br><br>æ ¸å¿ƒæ”¯æ’‘ç‚¹ï¼š<br>1ã€flannelç½‘ç»œæ–¹æ¡ˆæœ¬èº«<br>2ã€CNIæ’ä»¶ï¼Œè¿™é‡Œæ˜¯å†…ç½®çš„Flannelæ’ä»¶<br>3ã€dockershim(DRI)<br><br>ä¸¤ä¸ªèƒŒæ™¯çŸ¥è¯†ï¼š<br>1ã€CNI çš„è®¾è®¡æ€æƒ³ï¼šKubernetes åœ¨å¯åŠ¨ Infra å®¹å™¨ä¹‹åï¼Œå°±å¯ä»¥ç›´æ¥è°ƒç”¨ CNI ç½‘ç»œæ’ä»¶ï¼Œä¸ºè¿™ä¸ª Infra å®¹å™¨çš„ Network Namespaceï¼Œé…ç½®ç¬¦åˆé¢„æœŸçš„ç½‘ç»œæ ˆã€‚<br>2ã€å»ºç«‹ç½‘ç»œçš„â€œä¸‰ç±»â€åŸºç¡€ç»„ä»¶&#47;å¯æ‰§è¡Œæ–‡ä»¶ã€‚<br><br>ä¸²çº¿ï¼ˆç€é‡æè¿°ä¸‰ä¸ªæ ¸å¿ƒç‚¹ä¹‹é—´çš„ä¸²è”å…³ç³»ï¼‰ï¼š<br>kubelet åˆ›å»º Pod -&gt;åˆ›å»º Infra å®¹å™¨ã€‚ä¸»è¦æ˜¯ç”±ï¼ˆCRIï¼‰**dockershim **è°ƒç”¨ Docker API åˆ›å»ºå¹¶å¯åŠ¨ Infra å®¹å™¨-&gt; SetUpPodæ–¹æ³•ã€‚æ–¹æ³•çš„ä½œç”¨æ˜¯ï¼š1.ä¸º CNI æ’ä»¶å‡†å¤‡å‚æ•°ï¼Œ2.ç„¶åè°ƒç”¨ CNI æ’ä»¶ä¸º Infra å®¹å™¨é…ç½®ç½‘ç»œã€‚<br>1.æ‰€éœ€å‚æ•°-&gt;å®ç°ADD&#47;DELæ–¹æ³•-&gt;CNIæ’ä»¶ï¼ˆ*flannelæ’ä»¶*)å®ç°ã€‚ï¼š<br>1.1å‚æ•°ä¸€ï¼šç”± dockershim è®¾ç½®çš„ä¸€ç»„ CNI ç¯å¢ƒå˜é‡ï¼ŒADD&#47;DELæ–¹æ³•å‚æ•°ã€‚<br>1.2å‚æ•°äºŒï¼šæ˜¯ dockershim ä» CNI â€œé…ç½®æ–‡ä»¶â€é‡ŒåŠ è½½åˆ°çš„ã€é»˜è®¤æ’ä»¶çš„é…ç½®ä¿¡æ¯ï¼›ç”±*flannelç½‘ç»œæ–¹æ¡ˆæœ¬èº«*å®‰è£…æ—¶ç”Ÿæˆã€‚<br>2.è°ƒç”¨ CNI æ’ä»¶:<br>å¼•ï¼š&quot;dockershim å¯¹ *Flannel CNI æ’ä»¶*çš„è°ƒç”¨ï¼Œå…¶å®å°±æ˜¯èµ°äº†ä¸ªè¿‡åœºã€‚Flannel CNI æ’ä»¶å”¯ä¸€éœ€è¦åšçš„ï¼Œå°±æ˜¯å¯¹ dockershim ä¼ æ¥çš„ Network Configuration (CNIé…ç½®æ–‡ä»¶ï¼‰è¿›è¡Œè¡¥å……ã€‚&quot;<br>æ¥ä¸‹æ¥ï¼ŒFlannel CNI æ’ä»¶-&gt;è°ƒç”¨ CNI bridge æ’ä»¶(å‚æ•°ä¸€ï¼šâ€œCNIç¯å¢ƒå˜é‡&#47;ADD&quot;, å‚æ•°äºŒï¼šâ€Network Confiuration&#47;Delegate&quot;)ï¼Œ--&gt;â€œä»£è¡¨â€Flannelï¼Œå°†å®¹å™¨åŠ å…¥CNIç½‘ç»œï¼ˆcni0ç½‘æ¡¥ï¼‰ã€‚","like_count":22},{"had_liked":false,"id":52078,"user_name":"LÃ‰ON","can_delete":false,"product_type":"c1","uid":1233565,"ip_address":"","ucode":"EFD104BDD76DBE","user_header":"https://static001.geekbang.org/account/avatar/00/12/d2/9d/5839e490.jpg","comment_is_top":false,"comment_ctime":1545305969,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"53084913521","product_id":100015201,"comment_content":"ä¸€ç›´åœ¨è‹¦è‹¦è‡ªå­¦ï¼Œåœ¨å®¹å™¨çš„å­˜å‚¨è¿˜æœ‰ç½‘ç»œä¸€ç›´å›°æ‰°ã€‚ä¸€ç›´åœ¨æ‹œè¯»ä¸æ‹œå¬ å—ç›ŠåŒªæµ… ç»§ç»­åŠªåŠ›","like_count":12,"discussions":[{"author":{"id":1119116,"avatar":"https://static001.geekbang.org/account/avatar/00/11/13/8c/c86340ca.jpg","nickname":"å·´è¥¿","note":"","ucode":"6E68AA02011541","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":117398,"discussion_content":"å¤´åƒä¸€æ ·å“¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578113131,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":196488,"user_name":"bus801","can_delete":false,"product_type":"c1","uid":1777680,"ip_address":"","ucode":"7BBF63E76DC395","user_header":"https://static001.geekbang.org/account/avatar/00/1b/20/10/5786e0d8.jpg","comment_is_top":false,"comment_ctime":1585285453,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"44534958413","product_id":100015201,"comment_content":"è¦æ˜¯å†æ¥ä¸€ç¯‡calicoçš„å°±å®Œç¾äº†","like_count":11,"discussions":[{"author":{"id":1269156,"avatar":"https://static001.geekbang.org/account/avatar/00/13/5d/a4/2e4b6d33.jpg","nickname":"ç´ è¿˜çœŸ","note":"","ucode":"9ABA456355F7E3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":346175,"discussion_content":"æœŸå¾…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611884785,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":37748,"user_name":"Dale","can_delete":false,"product_type":"c1","uid":1010056,"ip_address":"","ucode":"DD4717C06E417D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/69/88/528442b0.jpg","comment_is_top":false,"comment_ctime":1541723951,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"40196429615","product_id":100015201,"comment_content":"æˆ‘è®¤ä¸ºæ˜¯åœ¨å¤§è§„æ¨¡çš„é›†ç¾¤ç¯å¢ƒä¸­ï¼Œç½‘ç»œæ–¹æ¡ˆæ˜¯æœ€å¤æ‚çš„ï¼Œé’ˆå¯¹ä¸åŒçš„çš„ç¯å¢ƒå’Œåœºæ™¯ï¼Œç½‘ç»œéœ€è¦çµæ´»é…ç½®ã€‚k8sé›†ç¾¤é‡Œåªå…³å¿ƒæœ€ç»ˆç½‘ç»œå¯ä»¥è¿é€šï¼Œè€Œä¸éœ€è¦åœ¨å†…éƒ¨å»å®ç°å„ç§å¤æ‚çš„ç½‘ç»œæ¨¡å—ï¼Œä½¿ç”¨CNIå¯ä»¥æ–¹ä¾¿çµæ´»åœ°è‡ªå®šä¹‰ç½‘ç»œæ’ä»¶ï¼Œç½‘ç»œå¯ä»¥ç‹¬ç«‹ã€‚","like_count":9},{"had_liked":false,"id":58787,"user_name":"æ¯›ç‰æ˜","can_delete":false,"product_type":"c1","uid":1318580,"ip_address":"","ucode":"626A6BC5023B2D","user_header":"https://static001.geekbang.org/account/avatar/00/14/1e/b4/7f1e7e20.jpg","comment_is_top":false,"comment_ctime":1547193102,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"14432094990","product_id":100015201,"comment_content":"k8sé‡Œå¯ä»¥ä¸ä½¿ç”¨cniç›´æ¥ä½¿ç”¨docker0çš„ç½‘æ¡¥å—ï¼Œçœ‹äº†ä¸‹ç›®å‰å…¬å¸çš„é›†ç¾¤æ²¡æœ‰æ‰¾åˆ°cni0çš„è¿™ä¸ªè®¾å¤‡","like_count":3,"discussions":[{"author":{"id":1009501,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELq0icfdsBjscdVLkDa2ylibjtENIfmusojcm48KLgyu1xOaY90eEibBwibraBZuPYcIKaGekialqFQKbQ/132","nickname":"overflow","note":"","ucode":"60C943CC9F6F52","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":401478,"discussion_content":"masterèŠ‚ç‚¹åº”è¯¥æ²¡æœ‰cni0ï¼Œå› ä¸ºä¸éœ€è¦éƒ¨ç½²ä¸šåŠ¡pod","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1633680212,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2254917,"avatar":"https://static001.geekbang.org/account/avatar/00/22/68/45/ddf89612.jpg","nickname":"bestgopher","note":"","ucode":"D89735C8CA9C6E","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":1009501,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELq0icfdsBjscdVLkDa2ylibjtENIfmusojcm48KLgyu1xOaY90eEibBwibraBZuPYcIKaGekialqFQKbQ/132","nickname":"overflow","note":"","ucode":"60C943CC9F6F52","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545014,"discussion_content":"è°è¯´çš„masteræ²¡æœ‰çš„ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641801712,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":401478,"ip_address":""},"score":545014,"extra":""}]},{"author":{"id":1199969,"avatar":"https://static001.geekbang.org/account/avatar/00/12/4f/61/00083e41.jpg","nickname":"å°ç™½","note":"","ucode":"7ACE14C0C4AE61","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":217385,"discussion_content":"å¯ä»¥ï¼Œä¸è¿‡éœ€è¦ç»™dockerä¼ é€’é…ç½®å‚æ•°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585552972,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42312,"user_name":"ç‡•å²­å¬æ¶›","can_delete":false,"product_type":"c1","uid":1228123,"ip_address":"","ucode":"0358ECCAB39258","user_header":"https://static001.geekbang.org/account/avatar/00/12/bd/5b/94bb1036.jpg","comment_is_top":false,"comment_ctime":1542939416,"is_pvip":false,"replies":[{"id":"15270","content":"ç»™ä¸ªå¤§ç‚¹çš„rangeå•Šï¼Œè¿˜æœ‰çœ‹çœ‹ipamç”¨çš„æ˜¯å•¥é…ç½®ï¼Ÿ","user_name":"ä½œè€…å›å¤","comment_id":42312,"uid":"1218095","ip_address":"","utype":1,"ctime":1542986794,"user_name_real":"Geek_6ef93d"}],"discussion_count":2,"race_medal":0,"score":"14427841304","product_id":100015201,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼Œå’¨è¯¢ä¸€ä¸ªé—®é¢˜ï¼šflannelç»å¸¸å‡ºç° no ip address available in rangeï¼Œå‡ºç°åå°±åªèƒ½é‡ç½®èŠ‚ç‚¹ã€‚è¿™ä¸ªæ˜¯ä»€ä¹ˆåŸå› é€ æˆçš„ï¼Œä¸ºä»€ä¹ˆpodåˆ é™¤åä¸å›æ”¶ipåœ°å€ï¼Ÿæˆ–è€…è¿˜æœ‰åˆ«çš„è§£å†³åŠæ³•å—ï¼Ÿå¸Œæœ›èƒ½æ”¶åˆ°æ‚¨çš„å›å¤ã€‚","like_count":3,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430042,"discussion_content":"ç»™ä¸ªå¤§ç‚¹çš„rangeå•Šï¼Œè¿˜æœ‰çœ‹çœ‹ipamç”¨çš„æ˜¯å•¥é…ç½®ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542986794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"æˆ‘æ¥ä¹Ÿ","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":228967,"discussion_content":"ä¹‹å‰åœ¨é˜¿é‡Œäº‘k8sé›†ç¾¤ä¸Šå°±é‡åˆ°äº†è¯¥é”™è¯¯.\nç”±äºåˆ›å»ºk8sé›†ç¾¤æ—¶,é€‰æ‹©æ¯ä¸ªèŠ‚ç‚¹å¯åˆ†é…64ä¸ªIP,ç»“æœå¯åŠ¨äº†64ä¸ªpodå, æ–°çš„podå°±æ— æ³•è·å–åˆ°IPåœ°å€äº†.\nåæ¥æˆ‘ä¹Ÿæ˜¯æŠŠk8sé›†ç¾¤é‡å»ºäº†, é€‰æ‹©æ¯ä¸ªèŠ‚ç‚¹å¯åˆ†é…256ä¸ªIPåœ°å€.\næš‚æ—¶å°±æ²¡é‡åˆ°è¯¥é—®é¢˜äº†.\n\nä½ è¯´çš„IPåœ°å€æœªè¢«å›æ”¶,å€’æ˜¯å¾ˆå¥‡æ€ªçš„ç°è±¡.","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1586596025,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":37745,"user_name":"DJH","can_delete":false,"product_type":"c1","uid":1256740,"ip_address":"","ucode":"2BDEF123B3DB6A","user_header":"https://static001.geekbang.org/account/avatar/00/13/2d/24/28acca15.jpg","comment_is_top":false,"comment_ctime":1541723395,"is_pvip":false,"replies":[{"id":"13632","content":"å¯¹","user_name":"ä½œè€…å›å¤","comment_id":37745,"uid":"1218095","ip_address":"","utype":1,"ctime":1541767156,"user_name_real":"Geek_6ef93d"}],"discussion_count":1,"race_medal":0,"score":"14426625283","product_id":100015201,"comment_content":"&quot;å®é™…ä¸Šï¼Œå¯¹äº Weaveã€Calico è¿™æ ·çš„ç½‘ç»œæ–¹æ¡ˆæ¥è¯´ï¼Œå®ƒä»¬çš„ DaemonSet åªéœ€è¦æŒ‚è½½å®¿ä¸»æœºçš„ &#47;opt&#47;cni&#47;bin&#47;ï¼Œå°±å¯ä»¥å®ç°æ’ä»¶å¯æ‰§è¡Œæ–‡ä»¶çš„å®‰è£…äº†ã€‚&quot;è¿™ä¸ªæ˜¯ç”¨hostpathç±»å‹çš„å·å®ç°å—ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428475,"discussion_content":"å¯¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541767156,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":245993,"user_name":"å¤§Gæ¥äº†å‘¦","can_delete":false,"product_type":"c1","uid":1610260,"ip_address":"","ucode":"97711D9CCA73B0","user_header":"https://static001.geekbang.org/account/avatar/00/18/92/14/6ca50b3b.jpg","comment_is_top":false,"comment_ctime":1599126676,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10189061268","product_id":100015201,"comment_content":"å­˜å‚¨å’Œç½‘ç»œéœ€è¦å¥½å¥½å¸æ”¶æ‰è¡Œ","like_count":2},{"had_liked":false,"id":242598,"user_name":"å†¬å†¬","can_delete":false,"product_type":"c1","uid":1180054,"ip_address":"","ucode":"B673E6482B5C93","user_header":"https://static001.geekbang.org/account/avatar/00/12/01/96/afcb6174.jpg","comment_is_top":false,"comment_ctime":1597794424,"is_pvip":false,"discussion_count":0,"race_medal":2,"score":"10187729016","product_id":100015201,"comment_content":"kubernetesä½¿ç”¨cniä½œä¸ºpodçš„å®¹å™¨é—´é€šä¿¡çš„ç½‘æ¡¥ï¼ˆä¸docker0åŠŸèƒ½ç›¸åŒï¼‰<br>åˆå§‹åŒ–podç½‘ç»œæµç¨‹ï¼šåˆ›å»ºInfraå®¹å™¨ è°ƒç”¨cniæ’ä»¶åˆå§‹åŒ–infraå®¹å™¨ç½‘ç»œï¼ˆæ’ä»¶ä½ç½®ï¼š&#47;opt&#47;cni&#47;bin&#47;flannelï¼‰ï¼Œå¼€å§‹ dockershim è®¾ç½®çš„ä¸€ç»„ CNI ç¯å¢ƒå˜é‡ï¼ˆæšä¸¾å€¼ADDã€DELETEï¼‰ï¼Œç”¨äºè¡¨ç¤ºå°†å®¹å™¨çš„VethPairæ’å…¥æˆ–ä»cni0ç½‘æ¡¥ç§»é™¤ã€‚<br>ä¸æ­¤åŒæ—¶ï¼Œcni bridgeæ’ä»¶æ£€æŸ¥cniç½‘æ¡¥åœ¨å®¿ä¸»æœºä¸Šæ˜¯å¦å­˜åœ¨ï¼Œè‹¥ä¸å­˜åœ¨åˆ™è¿›è¡Œåˆ›å»ºã€‚æ¥ç€ï¼Œcni bridgeæ’ä»¶åœ¨network namespaceåˆ›å»ºVethPairï¼Œå°†å…¶ä¸­ä¸€ç«¯æ’å…¥åˆ°å®¿ä¸»æœºçš„cni0ç½‘æ¡¥ï¼Œå¦ä¸€ç«¯ç›´æ¥èµ‹äºˆå®¹å™¨å®ä¾‹eth0ï¼Œcniæ’ä»¶æŠŠå®¹å™¨ipæä¾›ç»™dockershim è¢«kubeletç”¨äºæ·»åŠ åˆ°podçš„statuså­—æ®µã€‚æ¥ä¸‹æ¥ï¼Œcni bridgeè°ƒç”¨cni ipamæ’ä»¶ ä»ipam.subnetå­ç½‘ä¸­ç»™å®¹å™¨eth0ç½‘å¡åˆ†é…ipåœ°å€ åŒæ—¶è®¾ç½®default routeé…ç½®ï¼Œæœ€åcni bridgeæ’ä»¶ä¸ºcniç½‘æ¡¥è®¾ç½®ipåœ°å€ã€‚","like_count":2},{"had_liked":false,"id":209262,"user_name":"å¼ ä¸‰","can_delete":false,"product_type":"c1","uid":1004092,"ip_address":"","ucode":"1155528FAE1546","user_header":"https://static001.geekbang.org/account/avatar/00/0f/52/3c/d6fcb93a.jpg","comment_is_top":false,"comment_ctime":1587525726,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10177460318","product_id":100015201,"comment_content":"ç²¾å½©ï¼è€å¸ˆä¸ä½†æ•™çŸ¥å…¶ç„¶ï¼Œè€Œä¸”å®Œå…¨è¯¦ç»†çš„è®²è§£æ‰€ä»¥ç„¶ã€‚è°¢è°¢ã€‚å­¦ä¹ äº†ã€‚","like_count":2},{"had_liked":false,"id":198667,"user_name":"vincent","can_delete":false,"product_type":"c1","uid":1796234,"ip_address":"","ucode":"9FAD09D87C1E42","user_header":"","comment_is_top":false,"comment_ctime":1585463096,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10175397688","product_id":100015201,"comment_content":"Kubernetesæ˜¯å¦å¯ä»¥ç»™Podåˆ›å»ºå¤šå¼ ç½‘å¡ï¼Œåˆ†é…å¤šä¸ªIPï¼Ÿ","like_count":2},{"had_liked":false,"id":153040,"user_name":"djfhchdh","can_delete":false,"product_type":"c1","uid":1484184,"ip_address":"","ucode":"E71D75328CE398","user_header":"https://static001.geekbang.org/account/avatar/00/16/a5/98/a65ff31a.jpg","comment_is_top":false,"comment_ctime":1574145266,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10164079858","product_id":100015201,"comment_content":"å› ä¸ºç°å®ä¸­çš„å®¹å™¨ç½‘ç»œå¤ªå¤šæ ·ã€å¤ªå¤æ‚ï¼Œä¸ºäº†è§£è€¦ã€å¯æ‰©å±•æ€§ï¼Œè®¾è®¡äº†CNIæ¥å£ï¼Œè¿™ä¸ªæ¥å£å®ç°äº†å…±åŒçš„åŠŸèƒ½ï¼šä¸ºinfraå®¹å™¨çš„network namespaceé…ç½®ç½‘ç»œæ ˆ","like_count":2,"discussions":[{"author":{"id":1055810,"avatar":"https://static001.geekbang.org/account/avatar/00/10/1c/42/d3a0e33a.jpg","nickname":"å¸Œå¾·å°å­","note":"","ucode":"0F3DA846858DBD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577890,"discussion_content":"è¿™ä¸ªæ€»ç»“å¾ˆåˆ°ä½ã€‚ç®€å•è¯´ï¼šå°±æ˜¯ä¸ºå®¹å™¨é…ç½®å¯äº’é€šçš„ç½‘ç»œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656404405,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":334842,"user_name":"å˜¿ï¼æˆ‘çš„gakki","can_delete":false,"product_type":"c1","uid":1375996,"ip_address":"","ucode":"86ABC9754D287B","user_header":"https://static001.geekbang.org/account/avatar/00/14/fe/fc/e56c9c4a.jpg","comment_is_top":false,"comment_ctime":1645153692,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5940120988","product_id":100015201,"comment_content":"https:&#47;&#47;github.com&#47;y805939188&#47;k8s-cni-test<br>ä» 0 å®ç°çš„ç®€å• cni æ’ä»¶ï¼Œå†…é™„æ•™å­¦ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥ç…ç…","like_count":1},{"had_liked":false,"id":325044,"user_name":"è¿½é£ç­çš„äºº","can_delete":false,"product_type":"c1","uid":1488020,"ip_address":"","ucode":"2993D60F94C396","user_header":"https://static001.geekbang.org/account/avatar/00/16/b4/94/2796de72.jpg","comment_is_top":false,"comment_ctime":1638785195,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5933752491","product_id":100015201,"comment_content":"K8S å¤ªå¼ºäº†  æ¯”è™šæ‹Ÿæœºè§£å†³æ–¹æ¡ˆ å…ˆè¿›äº†å¾ˆå¤š   ç”¨æ›´å°‘çš„å­˜å‚¨ åšæ›´å¤šçš„äº‹æƒ…","like_count":1,"discussions":[{"author":{"id":1117738,"avatar":"https://static001.geekbang.org/account/avatar/00/11/0e/2a/e6b443f0.jpg","nickname":"å­™è£è¾›.py","note":"","ucode":"70A9DCE005E7C4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":574986,"discussion_content":"å®¹å™¨åŒ–å’Œè™šæ‹ŸåŒ–ï¼Œæœ¬æ¥å°±æ˜¯ä¸¤ä¸ªæ–¹å‘ï¼Œäº’æœ‰åˆ©å¼Šå§ã€‚å½“æ¶‰åŠåˆ°ä»»åŠ¡ä¹‹é—´çš„å¼ºéš”ç¦»ï¼Œå°±ä¼šæ„è¯†åˆ°è™šæ‹Ÿæœºçš„å¿…è¦æ€§äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654508622,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":325042,"user_name":"è¿½é£ç­çš„äºº","can_delete":false,"product_type":"c1","uid":1488020,"ip_address":"","ucode":"2993D60F94C396","user_header":"https://static001.geekbang.org/account/avatar/00/16/b4/94/2796de72.jpg","comment_is_top":false,"comment_ctime":1638785150,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5933752446","product_id":100015201,"comment_content":"æ‰€æœ‰å®¹å™¨éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ IP åœ°å€ä¸å…¶ä»–å®¹å™¨é€šä¿¡ï¼Œè€Œæ— éœ€ä½¿ç”¨ NATã€‚æ‰€æœ‰å®¿ä¸»æœºéƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ IP åœ°å€ä¸æ‰€æœ‰å®¹å™¨é€šä¿¡ï¼Œè€Œæ— éœ€ä½¿ç”¨ NATã€‚åä¹‹äº¦ç„¶ã€‚å®¹å™¨è‡ªå·±â€œçœ‹åˆ°â€çš„è‡ªå·±çš„ IP åœ°å€ï¼Œå’Œåˆ«äººï¼ˆå®¿ä¸»æœºæˆ–è€…å®¹å™¨ï¼‰çœ‹åˆ°çš„åœ°å€æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚","like_count":1},{"had_liked":false,"id":168242,"user_name":"å·´è¥¿","can_delete":false,"product_type":"c1","uid":1119116,"ip_address":"","ucode":"6E68AA02011541","user_header":"https://static001.geekbang.org/account/avatar/00/11/13/8c/c86340ca.jpg","comment_is_top":false,"comment_ctime":1578036566,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5873003862","product_id":100015201,"comment_content":"ç½‘ç»œç¯‡ç¡®å®éš¾åº¦ä¸Šæ¥äº†,éœ€è¦å¤šçœ‹å‡ é","like_count":1},{"had_liked":false,"id":164762,"user_name":"Geek_81c7c9","can_delete":false,"product_type":"c1","uid":1638611,"ip_address":"","ucode":"60E7FA04D44CB5","user_header":"https://static001.geekbang.org/account/avatar/00/19/00/d3/ef5d2af0.jpg","comment_is_top":false,"comment_ctime":1577087635,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5872054931","product_id":100015201,"comment_content":"è€å¸ˆä½ å¥½ï¼Œè¯·é—®åœ¨CNIæ–¹æ¡ˆå‡ºç°ä¹‹å‰ï¼Œæœ‰å…¶å®ƒçš„å®¹å™¨å›ºå®šIPæ–¹æ¡ˆå—ï¼Ÿ","like_count":1},{"had_liked":false,"id":158728,"user_name":"å«æˆ‘å¤©æ‰å¥½äº†","can_delete":false,"product_type":"c1","uid":1449175,"ip_address":"","ucode":"4EC69FB09E3435","user_header":"https://static001.geekbang.org/account/avatar/00/16/1c/d7/a53dad9e.jpg","comment_is_top":false,"comment_ctime":1575443057,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5870410353","product_id":100015201,"comment_content":"æ€è€ƒé¢˜ï¼Œé«˜å†…èšï¼Œä½è€¦åˆï¼Ÿ<br>","like_count":1},{"had_liked":false,"id":37741,"user_name":"Tim Zhang","can_delete":false,"product_type":"c1","uid":1214499,"ip_address":"","ucode":"4956AC5FE45EE1","user_header":"https://static001.geekbang.org/account/avatar/00/12/88/23/a0966b4d.jpg","comment_is_top":false,"comment_ctime":1541722951,"is_pvip":false,"replies":[{"id":"13633","content":"ä¸è¦æ€¥","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1541767181,"ip_address":"","comment_id":37741,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5836690247","product_id":100015201,"comment_content":"ä¸Šä¸€ç« èŠ‚ä¸æ˜¯è¯´ä»‹ç»flannelçš„hostgwæ¨¡å¼å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428472,"discussion_content":"ä¸è¦æ€¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541767181,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":351801,"user_name":"7","can_delete":false,"product_type":"c1","uid":1804043,"ip_address":"","ucode":"3107B9740AFCB5","user_header":"https://static001.geekbang.org/account/avatar/00/1b/87/0b/07778302.jpg","comment_is_top":false,"comment_ctime":1658200796,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1658200796","product_id":100015201,"comment_content":"å¦‚æœç¼–æ’ä¸­å¼€å¯äº†hostNetwork:true, æ˜¯ä¸æ˜¯å°±ä¸éœ€è¦flannelè¿™ç±»cniæ’ä»¶äº†ï¼Ÿ å› ä¸ºlinuxçš„network namespaceæ‰“é€šå°±å·²ç»åšåˆ°å’Œå®¿ä¸»æœºå…±äº«ç½‘ç»œç©ºé—´äº†ï¼Ÿ","like_count":0},{"had_liked":false,"id":348213,"user_name":"john","can_delete":false,"product_type":"c1","uid":1349519,"ip_address":"","ucode":"CE4991BEF991BA","user_header":"https://static001.geekbang.org/account/avatar/00/14/97/8f/c091d4f3.jpg","comment_is_top":false,"comment_ctime":1654849106,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1654849106","product_id":100015201,"comment_content":"ä¸ºä»€ä¹ˆ Kubernetes é¡¹ç›®ä¸è‡ªå·±å®ç°å®¹å™¨ç½‘ç»œï¼Œè€Œæ˜¯è¦é€šè¿‡ CNI åšä¸€ä¸ªå¦‚æ­¤ç®€å•çš„å‡è®¾å‘¢ï¼Ÿ<br><br>åº”è¯¥æ˜¯ä¸åŒçš„ç½‘ç»œç¯å¢ƒï¼Œç½‘ç»œæ‹“æ‰‘ã€å…¬æœ‰äº‘&#47;ç§æœ‰äº‘ã€è§„æ¨¡ã€ç½‘ç»œå¯é æ€§è¦æ±‚éƒ½ä¸ä¸€æ ·ï¼ˆå»¶è¿Ÿã€ååé‡ç­‰ï¼‰ï¼Œéœ€è¦ä¸åŒçš„ç½‘ç»œæ–¹æ¡ˆé€‚åº”ä¸åŒçš„åœºæ™¯ã€‚","like_count":0},{"had_liked":false,"id":342645,"user_name":"æ‚ŸäºŒç©º","can_delete":false,"product_type":"c1","uid":1128549,"ip_address":"","ucode":"BF3B8BA6E49B1D","user_header":"https://static001.geekbang.org/account/avatar/00/11/38/65/edf48816.jpg","comment_is_top":false,"comment_ctime":1650380628,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1650380628","product_id":100015201,"comment_content":"ä¸èƒ½ä¸ä½©æœk8så’Œlinuxå†…æ ¸å·¥ç¨‹å¸ˆä»¬äº†ï¼Œèƒ½å°†ä¸€ä¸ªç³»ç»Ÿè®¾è®¡çš„å¦‚æ­¤ç»å¦™ï¼Œå¹¶å®ç°äº†å®ƒ","like_count":0},{"had_liked":false,"id":332513,"user_name":"NulI","can_delete":false,"product_type":"c1","uid":1491276,"ip_address":"","ucode":"BF8C3B18FE2D2A","user_header":"https://static001.geekbang.org/account/avatar/00/16/c1/4c/e72d3360.jpg","comment_is_top":false,"comment_ctime":1643286226,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1643286226","product_id":100015201,"comment_content":"ä¸¤æ¬¾æ¯”è¾ƒå®ç”¨çš„CNIæ’ä»¶ï¼Œå¯ä»¥è¯•è¯•ï¼š<br>ï¼ˆ1ï¼‰è½»é‡çº§kube-ipamå¸®ä½ è½»æ¾å®ç°K8Så®¹å™¨çš„IPåœ°å€æ°¸ä¹…å›ºå®šä¸å˜   https:&#47;&#47;mp.weixin.qq.com&#47;s&#47;JLEPko0dN0f7bdmCwvuljA<br>ï¼ˆ2ï¼‰åŸºäºMultusä¸Kube-ipamå®ç°Webå’Œæ•°æ®åº“åˆ†å±‚ç½‘ç»œå®‰å…¨è®¿é—®  https:&#47;&#47;mp.weixin.qq.com&#47;s&#47;8x8B_qhK4Y1JlkXkYpD6ng","like_count":0,"discussions":[{"author":{"id":2621412,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ff/e4/927547a9.jpg","nickname":"æ— åæ— å§“","note":"","ucode":"487BD5AA2CD305","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573971,"discussion_content":"æ‹œè¯»ä¸€ä¸‹å“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653751740,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":325045,"user_name":"è¿½é£ç­çš„äºº","can_delete":false,"product_type":"c1","uid":1488020,"ip_address":"","ucode":"2993D60F94C396","user_header":"https://static001.geekbang.org/account/avatar/00/16/b4/94/2796de72.jpg","comment_is_top":false,"comment_ctime":1638785302,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638785302","product_id":100015201,"comment_content":"é«˜å†…èš ä½è€¦åˆ","like_count":0},{"had_liked":false,"id":250940,"user_name":"Heaven","can_delete":false,"product_type":"c1","uid":1694207,"ip_address":"","ucode":"FA33FBCC66C911","user_header":"https://static001.geekbang.org/account/avatar/00/19/d9/ff/b23018a6.jpg","comment_is_top":false,"comment_ctime":1601286016,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601286016","product_id":100015201,"comment_content":"CNCFä¸€ç›´éµå¾ªçš„å¼€æ”¾çš„,äº¤ç»™ä½¿ç”¨è€…è‡ªå®šä¹‰çš„æ’ä»¶ åŸåˆ™,æ–¹ä¾¿æä¾›æ›´å¤šçš„ä¾¿åˆ©é€‰æ‹©,æœ‰äº†CNI,å°±å¯ä»¥è‡ªå®šä¹‰æ’ä»¶,æ–¹ä¾¿åº”å¯¹ä¸åŒçš„,å¤æ‚çš„ç½‘ç»œç¯å¢ƒ","like_count":0},{"had_liked":false,"id":226160,"user_name":"å›å“¥èŠæŠ€æœ¯","can_delete":false,"product_type":"c1","uid":1325816,"ip_address":"","ucode":"2C9A22BCE4C79E","user_header":"https://static001.geekbang.org/account/avatar/00/14/3a/f8/c1a939e7.jpg","comment_is_top":false,"comment_ctime":1591967545,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1591967545","product_id":100015201,"comment_content":"è€å¸ˆï¼Œæˆ‘ç°åœ¨çš„é›†ç¾¤æ˜¯ä¸€ä¸ªmaster,ä¸€ä¸ªworker,éƒ¨ç½²åº”ç”¨åè°ƒåº¦åˆ°workerèŠ‚ç‚¹ï¼Œä½†æ˜¯è¿›å…¥åº”ç”¨å®¹å™¨å†…éƒ¨ï¼Œå‘ç°pingä¸é€šmasterçš„ip,masterä¸Šä¹Ÿéƒ¨ç½²flanneläº†ã€‚è¯·é—®è¿™ä¸ªä¸€èˆ¬æ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ<br><br>","like_count":0,"discussions":[{"author":{"id":1325816,"avatar":"https://static001.geekbang.org/account/avatar/00/14/3a/f8/c1a939e7.jpg","nickname":"å›å“¥èŠæŠ€æœ¯","note":"","ucode":"2C9A22BCE4C79E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":282699,"discussion_content":"è§£å†³äº†ï¼ŒåŸå› æ˜¯masteréƒ¨ç½²çš„æ—¶å€™æ²¡æœ‰åŠ --pod-network-cidr=10.244.0.0/16","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592049825,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":214527,"user_name":"å¼ å…‹è²","can_delete":false,"product_type":"c1","uid":1304742,"ip_address":"","ucode":"F89495F04DAD5D","user_header":"https://static001.geekbang.org/account/avatar/00/13/e8/a6/e74ecf7d.jpg","comment_is_top":false,"comment_ctime":1588761836,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588761836","product_id":100015201,"comment_content":"è¯·é—®è€å¸ˆ,dockershimè°ƒç”¨CNIçš„æ—¶å€™ï¼Œå‡è®¾æ˜¯dockershim-&gt;macvlan-&gt;dhcp è¿™ç§è‡ªå»ºçš„äºŒè¿›åˆ¶æ’ä»¶ï¼Œdockershimçš„logå¯ä»¥é€šè¿‡journalctl -u kubeletçœ‹åˆ°ï¼Œé‚£macvlanï¼Œdhcpè¿™äº›æ’ä»¶çš„logåœ¨å“ªé‡Œçœ‹å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":198670,"user_name":"vincent","can_delete":false,"product_type":"c1","uid":1796234,"ip_address":"","ucode":"9FAD09D87C1E42","user_header":"","comment_is_top":false,"comment_ctime":1585463158,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585463158","product_id":100015201,"comment_content":"å®éªŒä¸Šçœ‹è¿›å…¥å®¹å™¨åæ— æ³•åœ¨å®¹å™¨é‡Œä¿®æ”¹ipæˆ–è€…è®¾ç½®è·¯ç”±","like_count":0},{"had_liked":false,"id":198668,"user_name":"vincent","can_delete":false,"product_type":"c1","uid":1796234,"ip_address":"","ucode":"9FAD09D87C1E42","user_header":"","comment_is_top":false,"comment_ctime":1585463114,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585463114","product_id":100015201,"comment_content":"åœ¨Podé‡Œæ˜¯å¦å¯ä»¥å®ç°VPNç­‰åŠŸèƒ½","like_count":0},{"had_liked":false,"id":158137,"user_name":"å¾æµ·æµª","can_delete":false,"product_type":"c1","uid":1078528,"ip_address":"","ucode":"21801C420D0610","user_header":"https://static001.geekbang.org/account/avatar/00/10/75/00/618b20da.jpg","comment_is_top":false,"comment_ctime":1575337109,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1575337109","product_id":100015201,"comment_content":"kubeadm initiative --pod-network-cidr=10.244.0.0&#47;16å¯ä»¥æˆåŠŸåˆ›å»ºk8sé›†ç¾¤ï¼Œæ¢ä¸€ä¸‹åœ°å€åˆ™ä¸è¡Œ(å¦‚10.12.0.0&#47;16)ï¼Œä¸çŸ¥é“ä¸ºå•¥ğŸ˜‚","like_count":0},{"had_liked":false,"id":152342,"user_name":"æ‹‰æ¬§","can_delete":false,"product_type":"c1","uid":1206605,"ip_address":"","ucode":"40996A8093A95F","user_header":"https://static001.geekbang.org/account/avatar/00/12/69/4d/81c44f45.jpg","comment_is_top":false,"comment_ctime":1573978750,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573978750","product_id":100015201,"comment_content":"ä¸ºäº†æ•ˆç‡å§ï¼Œcniç½‘æ¡¥å®Œå…¨å¤ç”¨äº†linuxçš„ç½‘ç»œæ ˆï¼Œå¦‚æœè‡ªå·±å¼„å®¹å™¨ç½‘ç»œï¼Œè‚¯å®šåˆè¦å¢åŠ å†…æ ¸è°ƒç”¨","like_count":0},{"had_liked":false,"id":93509,"user_name":"æ˜€æºª","can_delete":false,"product_type":"c1","uid":1493286,"ip_address":"","ucode":"BFAF31542BC24A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoCl6Nxf9oW9sDOoibA7p8lKf0jqjPeDszqI4e7iavicQHtbtyibHIhLibyXYAaT02l7GRQvM9BJUxh6yQ/132","comment_is_top":false,"comment_ctime":1557483762,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1557483762","product_id":100015201,"comment_content":"CNI bridgeæ’ä»¶ä¼šé€šè¿‡Infraå®¹å™¨çš„Network Namespaceæ–‡ä»¶ï¼Œè¿›å…¥ç½‘ç»œåç§°ç©ºé—´ï¼Œç„¶ååˆ›å»ºä¸€å¯¹Veth Pairè®¾å¤‡ã€‚<br><br>é‚£æˆ‘çš„ç¯å¢ƒæ˜¯ä½¿ç”¨çš„docker0ç½‘æ¡¥ï¼Œæ²¡æœ‰ä½¿ç”¨CNIæ’ä»¶ã€‚é‚£è¿™ä¸ªVeth Pairè®¾å¤‡æ˜¯è°åˆ›å»ºçš„å‘¢ï¼Ÿæˆ‘æ˜¯ä¸æ˜¯å¯ä»¥è¿™ä¹ˆç†è§£ï¼Œå¦‚æœInfraè¿™ä¸ªå®¹å™¨æ˜¯PODçš„ç¬¬ä¸€ä¸ªå®¹å™¨ï¼Œé‚£ä¹ˆdockerå°±ä¼šä¸ºInfraè¿™ä¸ªå®¹å™¨åˆ†é…åœ°å€ï¼Œé€šè¿‡dockerçš„CNMæ¨¡å‹çš„æŸäº›æœºåˆ¶æ¥å®Œæˆä¸ºInfraè¿™ä¸ªå®¹å™¨åˆ›å»ºè™šæ‹Ÿç½‘å¡å¯¹çš„å·¥ä½œï¼Œä½¿ç”¨çš„IPåœ°å€å°±æ˜¯ä»docker0ç½‘æ¡¥çš„bipä¸­è·å¾—çš„ã€‚è€ŒPODçš„å®¹å™¨å…±äº«Infraçš„ç½‘ç»œåº”è¯¥æ˜¯K8Sçš„ä¸€ç§æœºåˆ¶å¯ç½‘ç»œæ’ä»¶æ²¡æœ‰å…³ç³»ã€‚æ˜¯è¿™ä¸ªæ„æ€ä¹ˆ","like_count":0},{"had_liked":false,"id":71532,"user_name":"Booty Monster","can_delete":false,"product_type":"c1","uid":1198995,"ip_address":"","ucode":"D4915EAE180D15","user_header":"https://static001.geekbang.org/account/avatar/00/12/4b/93/a7b09103.jpg","comment_is_top":false,"comment_ctime":1551363735,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551363735","product_id":100015201,"comment_content":"service å¦‚æœæ˜¯iptables åšå®é™…è½¬å‘çš„ç¡®æœ‰è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é‡åˆ°è¿‡çš„ï¼š1 ä½¿ç”¨headless svcï¼Œ2 ä½¿ç”¨ipvs ","like_count":0},{"had_liked":false,"id":41464,"user_name":"å±…ç„¶æ˜¯é£å“¥","can_delete":false,"product_type":"c1","uid":1174874,"ip_address":"","ucode":"D97809C03A697D","user_header":"https://static001.geekbang.org/account/avatar/00/11/ed/5a/96cd78e8.jpg","comment_is_top":false,"comment_ctime":1542787357,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542787357","product_id":100015201,"comment_content":"å¦‚æœåˆ†é…çš„å­ç½‘æ˜¯10.244.0.0&#47;16ï¼Œé‚£ä¹ˆè¿™ä¸ªé›†ç¾¤é‡ŒnodeèŠ‚ç‚¹æœ€å¤§çš„æ•°ç›®ä¸æ˜¯åªèƒ½åˆ°254å°ï¼Ÿ","like_count":0},{"had_liked":false,"id":40845,"user_name":"freeman","can_delete":false,"product_type":"c1","uid":1296242,"ip_address":"","ucode":"B766B91AFC3398","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ZwGweFhVUTfOrrYRk6Dic1IBxFyj2ZgsI1UXQeic2B5uJFdjicsIicnKrJts9v7nGUTCQlSKNUpmvYULq5KjqWjU4g/132","comment_is_top":false,"comment_ctime":1542681366,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542681366","product_id":100015201,"comment_content":"è€å¸ˆï¼Œèƒ½ä»‹ç»ä¸‹ipvlanå—ã€‚","like_count":0},{"had_liked":false,"id":39398,"user_name":"IOVE.-Minn","can_delete":false,"product_type":"c1","uid":1227784,"ip_address":"","ucode":"9C637EEEF64057","user_header":"https://static001.geekbang.org/account/avatar/00/12/bc/08/c43f85d9.jpg","comment_is_top":false,"comment_ctime":1542265052,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542265052","product_id":100015201,"comment_content":"è€å¸ˆï¼Œåœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°ä¸€ä¸ªé—®é¢˜ã€‚k8sç‰ˆæœ¬1.12.2ï¼Œkube-proxyå¼€å¯äº†ipvsåï¼Œéƒ¨ç½²æœ€æ–°çš„ingress-controlleræœåŠ¡ï¼ˆdaemensetéƒ¨ç½²ï¼Œå¼€å¯äº†hostnetwork: trueï¼‰çš„æ—¶å€™,ä¼šæŠ¥é”™ç›‘æ§æ£€æŸ¥å¤±è´¥ã€‚è€Œå»æ‰ä¹‹åï¼Œæ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚æ’é™¤å®˜æ–¹ä¸æ¨èä½¿ç”¨hostnetworkè¿™ç§æ–¹å¼ï¼Œæ˜¯æœ‰ä»€ä¹ˆåŸå› å¼•èµ·çš„å‘¢ï¼Ÿæµ‹è¯•è¿‡å¢åŠ å¥åº·æ£€æŸ¥çš„æ—¶é—´å’Œé•œåƒçš„ç‰ˆæœ¬ï¼Œéƒ½ä¸èƒ½è§£å†³ã€‚","like_count":0},{"had_liked":false,"id":38038,"user_name":"è§ç®«è§","can_delete":false,"product_type":"c1","uid":1218358,"ip_address":"","ucode":"B8259F3CDFCCAD","user_header":"https://static001.geekbang.org/account/avatar/00/12/97/36/6addd2b6.jpg","comment_is_top":false,"comment_ctime":1541902857,"is_pvip":false,"replies":[{"id":"13673","content":"è§serviceéƒ¨åˆ†","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1541938211,"ip_address":"","comment_id":38038,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1541902857","product_id":100015201,"comment_content":"å¯ä»¥è°ˆä¸€ä¸‹åœ¨podå†… è¯·æ±‚ä¸€ä¸ªåŸŸåçš„å®Œæ•´æµç¨‹å—ï¼Ÿ æ¯”å¦‚è¯´æˆ‘æœ€è¿‘é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œreslove.confè¿™äº›æ–‡ä»¶å†…å®¹éƒ½æ˜¯æ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œåœ¨æŸä¸ªimageå†…ä¸ºä»€ä¹ˆnslookup kuberenetes.default.svc.cluster.local è§£æç»“æœæ­£å¸¸ã€‚<br>nslookup kubernetes.default è§£æåˆ°å¤–ç½‘ã€‚åƒè¿™ç±»é—®é¢˜å¦‚ä½•ä»ç†è®ºè§’åº¦åˆ†æï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428571,"discussion_content":"è§serviceéƒ¨åˆ†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541938211,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":37986,"user_name":"or0or1","can_delete":false,"product_type":"c1","uid":1218147,"ip_address":"","ucode":"E7B63C666302C8","user_header":"https://static001.geekbang.org/account/avatar/00/12/96/63/64f62020.jpg","comment_is_top":false,"comment_ctime":1541839972,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1541839972","product_id":100015201,"comment_content":"æŠŠç½‘ç»œæ’ä»¶ä½¿ç”¨dockeré•œåƒçš„æ–¹å¼æœ‰ä»€ä¹ˆä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Ÿ","like_count":0},{"had_liked":false,"id":37972,"user_name":"Len","can_delete":false,"product_type":"c1","uid":1022767,"ip_address":"","ucode":"53C623CE17973F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9b/2f/b7a3625e.jpg","comment_is_top":false,"comment_ctime":1541832365,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1541832365","product_id":100015201,"comment_content":"ä¹‹æ‰€ä»¥é€‰æ‹© CNIï¼Œæ˜¯å› ä¸º kubernetes å¸Œæœ›æ›´å¹¿æ³›çš„æ”¯æŒä¸åŒçš„ç½‘ç»œæ–¹æ¡ˆå§","like_count":0},{"had_liked":false,"id":37935,"user_name":"æ…•ä¸–å‹‹","can_delete":false,"product_type":"c1","uid":1218188,"ip_address":"","ucode":"816C11C34A3494","user_header":"https://static001.geekbang.org/account/avatar/00/12/96/8c/48a4d0a0.jpg","comment_is_top":false,"comment_ctime":1541815670,"is_pvip":false,"replies":[{"id":"13660","content":"å®¹å™¨ç½‘ç»œå…¶å®å¾ˆç®€å•ï¼Œå¼€æºä¸»æµæ–¹æ¡ˆæˆç†Ÿåº¦å·²ç»å¯ä»¥ã€‚è€Œä¸”æ›´å¤šæƒ…å†µä¸‹ï¼Œå…¶å®éƒ½æ˜¯å¤ç”¨ä¸‹å±‚å®¿ä¸»æœºç½‘ç»œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1541841649,"ip_address":"","comment_id":37935,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1541815670","product_id":100015201,"comment_content":"è¯·æ•™ä¸‹ç›®å‰æœ‰ç›¸å¯¹æˆç†Ÿçš„k8så•†ä¸šç½‘ç»œè§£å†³æ–¹æ¡ˆå—ï¼Œç”¨äºå¤§è§„æ¨¡é›†ç¾¤ä½¿ç”¨,ä¸»è¦é¿å…é›ªå´©é€ æˆå¤§è§„æ¨¡æ•…éšœï¼Œä½ ä¹ŸçŸ¥é“ï¼Œç½‘ç»œæ˜¯ä¸ªå¾ˆæ•æ„Ÿçš„è¯¾é¢˜","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428530,"discussion_content":"å®¹å™¨ç½‘ç»œå…¶å®å¾ˆç®€å•ï¼Œå¼€æºä¸»æµæ–¹æ¡ˆæˆç†Ÿåº¦å·²ç»å¯ä»¥ã€‚è€Œä¸”æ›´å¤šæƒ…å†µä¸‹ï¼Œå…¶å®éƒ½æ˜¯å¤ç”¨ä¸‹å±‚å®¿ä¸»æœºç½‘ç»œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541841649,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":37751,"user_name":"Dale","can_delete":false,"product_type":"c1","uid":1010056,"ip_address":"","ucode":"DD4717C06E417D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/69/88/528442b0.jpg","comment_is_top":false,"comment_ctime":1541724081,"is_pvip":false,"replies":[{"id":"13635","content":"è‚¯å®šæœ‰","user_name":"ä½œè€…å›å¤","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1541767228,"ip_address":"","comment_id":37751,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1541724081","product_id":100015201,"comment_content":"è€å¸ˆå•¥æ—¶å€™è®²è§£ä¸€ä¸‹calicoï¼Œå¯¹æ¯”flannelç½‘ç»œä¼˜ç¼ºç‚¹å“ˆ","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"å¼ ç£Š Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428477,"discussion_content":"è‚¯å®šæœ‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541767228,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}