{"id":86237,"title":"41丨数据挖掘实战（3）：如何对比特币走势进行预测？","content":"<p>今天我带你用数据挖掘对比特币的走势进行预测和分析。</p><p>我们之前介绍了数据挖掘算法中的分类、聚类、回归和关联分析算法，那么对于比特币走势的预测，采用哪种方法比较好呢？</p><p>可能有些人会认为采用回归分析会好一些，因为预测的结果是连续的数值类型。实际上，数据挖掘算法还有一种叫时间序列分析的算法，时间序列分析模型建立了观察结果与时间变化的关系，能帮我们预测未来一段时间内的结果变化情况。</p><p>那么时间序列分析和回归分析有哪些区别呢？</p><p>首先，在选择模型前，我们需要确定结果与变量之间的关系。回归分析训练得到的是目标变量y与自变量x（一个或多个）的相关性，然后通过新的自变量x来预测目标变量y。而时间序列分析得到的是目标变量y与时间的相关性。</p><p>另外，回归分析擅长的是多变量与目标结果之间的分析，即便是单一变量，也往往与时间无关。而时间序列分析建立在时间变化的基础上，它会分析目标变量的趋势、周期、时期和不稳定因素等。这些趋势和周期都是在时间维度的基础上，我们要观察的重要特征。</p><p>那么针对今天要进行的预测比特币走势的项目，我们都需要掌握哪些目标呢？</p><ol>\n<li>\n<p>了解时间序列预测的概念，以及常用的模型算法，包括AR、MA、ARMA、ARIMA模型等；</p>\n</li>\n<li>\n<p>掌握并使用ARMA模型工具，对一个时间序列数据进行建模和预测；</p>\n</li>\n<li>\n<p>对比特币的历史数据进行时间序列建模，并预测未来6个月的走势。</p>\n</li>\n</ol><!-- [[[read_end]]] --><h2>时间序列预测</h2><p>关于时间序列，你可以把它理解为按照时间顺序组成的数字序列。实际上在中国古代的农业社会中，人们就将一年中不同时间节点和天气的规律总结了下来，形成了二十四节气，也就是从时间序列中观察天气和太阳的规律（只是当时没有时间序列模型和相应工具），从而使得农业得到迅速发展。在现代社会，时间序列在金融、经济、商业领域拥有广泛的应用。</p><p>在时间序列预测模型中，有一些经典的模型，包括AR、MA、ARMA、ARIMA。我来给你简单介绍一下。</p><p>AR的英文全称叫做Auto Regressive，中文叫自回归模型。这个算法的思想比较简单，它认为过去若干时刻的点通过线性组合，再加上白噪声就可以预测未来某个时刻的点。</p><p>在我们日常生活环境中就存在白噪声，在数据挖掘的过程中，你可以把它理解为一个期望为0，方差为常数的纯随机过程。AR模型还存在一个阶数，称为AR（p）模型，也叫作p阶自回归模型。它指的是通过这个时刻点的前p个点，通过线性组合再加上白噪声来预测当前时刻点的值。</p><p>MA的英文全称叫做 Moving Average，中文叫做滑动平均模型。它与AR模型大同小异，AR模型是历史时序值的线性组合，MA是通过历史白噪声进行线性组合来影响当前时刻点。AR模型中的历史白噪声是通过影响历史时序值，从而间接影响到当前时刻点的预测值。同样MA模型也存在一个阶数，称为MA(q)模型，也叫作q阶移动平均模型。我们能看到AR和MA模型都存在阶数，在AR模型中，我们用p表示，在MA模型中我们用q表示，这两个模型大同小异，与AR模型不同的是MA模型是历史白噪声的线性组合。</p><p>ARMA的英文全称是Auto Regressive Moving Average，中文叫做自回归滑动平均模型，也就是AR模型和MA模型的混合。相比AR模型和MA模型，它有更准确的估计。同样ARMA模型存在p和q两个阶数，称为ARMA(p,q)模型。</p><p>ARIMA的英文全称是Auto Regressive Integrated Moving Average模型，中文叫差分自回归滑动平均模型，也叫求合自回归滑动平均模型。相比于ARMA，ARIMA多了一个差分的过程，作用是对不平稳数据进行差分平稳，在差分平稳后再进行建模。ARIMA的原理和ARMA模型一样。相比于ARMA(p,q)的两个阶数，ARIMA是一个三元组的阶数(p,d,q)，称为ARIMA(p,d,q)模型。其中d是差分阶数。</p><h2>ARMA模型工具</h2><p>上面介绍的AR，MA，ARMA，ARIMA四种模型，你只需要了解基础概念即可，中间涉及到的一些数学公式这里不进行展开。</p><p>在实际工作中，我们更多的是使用工具，我在这里主要讲解下如何使用ARMA模型工具。</p><p>在使用ARMA工具前，你需要先引用相关工具包：</p><pre><code>from statsmodels.tsa.arima_model import ARMA\n</code></pre><p>然后通过ARMA(endog,order,exog=None)创建ARMA类，这里有一些主要的参数简单说明下：</p><p>endog：英文是endogenous variable，代表内生变量，又叫非政策性变量，它是由模型决定的，不被政策左右，可以说是我们想要分析的变量，或者说是我们这次项目中需要用到的变量。</p><p>order：代表是p和q的值，也就是ARMA中的阶数。</p><p>exog：英文是exogenous variables，代表外生变量。外生变量和内生变量一样是经济模型中的两个重要变量。相对于内生变量而言，外生变量又称作为政策性变量，在经济机制内受外部因素的影响，不是我们模型要研究的变量。</p><p>举个例子，如果我们想要创建ARMA(7,0)模型，可以写成：ARMA(data,(7,0))，其中data是我们想要观察的变量，(7,0)代表(p,q)的阶数。</p><p>创建好之后，我们可以通过fit函数进行拟合，通过predict(start, end)函数进行预测，其中start为预测的起始时间，end为预测的终止时间。</p><p>下面我们使用ARMA模型对一组时间序列做建模，代码如下：</p><pre><code># coding:utf-8\n# 用ARMA进行时间序列预测\nimport pandas as pd\nimport matplotlib.pyplot as plt\nimport statsmodels.api as sm\nfrom statsmodels.tsa.arima_model import ARMA\nfrom statsmodels.graphics.api import qqplot\n# 创建数据\ndata = [5922, 5308, 5546, 5975, 2704, 1767, 4111, 5542, 4726, 5866, 6183, 3199, 1471, 1325, 6618, 6644, 5337, 7064, 2912, 1456, 4705, 4579, 4990, 4331, 4481, 1813, 1258, 4383, 5451, 5169, 5362, 6259, 3743, 2268, 5397, 5821, 6115, 6631, 6474, 4134, 2728, 5753, 7130, 7860, 6991, 7499, 5301, 2808, 6755, 6658, 7644, 6472, 8680, 6366, 5252, 8223, 8181, 10548, 11823, 14640, 9873, 6613, 14415, 13204, 14982, 9690, 10693, 8276, 4519, 7865, 8137, 10022, 7646, 8749, 5246, 4736, 9705, 7501, 9587, 10078, 9732, 6986, 4385, 8451, 9815, 10894, 10287, 9666, 6072, 5418]\ndata=pd.Series(data)\ndata_index = sm.tsa.datetools.dates_from_range('1901','1990')\n# 绘制数据图\ndata.index = pd.Index(data_index)\ndata.plot(figsize=(12,8))\nplt.show()\n# 创建ARMA模型# 创建ARMA模型\narma = ARMA(data,(7,0)).fit()\nprint('AIC: %0.4lf' %arma.aic)\n# 模型预测\npredict_y = arma.predict('1990', '2000')\n# 预测结果绘制\nfig, ax = plt.subplots(figsize=(12, 8))\nax = data.loc['1901':].plot(ax=ax)\npredict_y.plot(ax=ax)\nplt.show()\n</code></pre><p>运行结果：</p><pre><code>AIC: 1619.6323\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/71/6a/71c5fe77926ba65e4b4aca48c337c66a.png?wh=1726*1153\" alt=\"\"></p><p><img src=\"https://static001.geekbang.org/resource/image/08/fc/082ff6d7e85e176b8fd5c38f528314fc.png?wh=1727*1131\" alt=\"\"><br>\n我创建了1901年-1990年之间的时间序列数据data，然后创建ARMA(7,0)模型，并传入时间序列数据data，使用fit函数拟合，然后对1990年-2000年之间的数据进行预测，最后绘制预测结果。</p><p>你能看到ARMA工具的使用还是很方便的，只是我们需要p和q的取值。实际项目中，我们可以给p和q指定一个范围，让ARMA都运行一下，然后选择最适合的模型。</p><p>你可能会问，怎么判断一个模型是否适合？</p><p>我们需要引入AIC准则，也叫作赤池消息准则，它是衡量统计模型拟合好坏的一个标准，数值越小代表模型拟合得越好。</p><p>在这个例子中，你能看到ARMA(7,0)这个模型拟合出来的AIC是1619.6323（并不一定是最优）。</p><h2>对比特币走势进行预测</h2><p>我们都知道比特币的走势除了和历史数据以外，还和很多外界因素相关，比如用户的关注度，各国的政策，币圈之间是否打架等等。当然这些外界的因素不是我们这节课需要考虑的对象。</p><p>假设我们只考虑比特币以往的历史数据，用ARMA这个时间序列模型预测比特币的走势。</p><p>比特币历史数据（从2012-01-01到2018-10-31）可以从GitHub上下载：<a href=\"https://github.com/cystanford/bitcoin\">https://github.com/cystanford/bitcoin</a>。</p><p>你能看到数据一共包括了8个字段，代表的含义如下：</p><p><img src=\"https://static001.geekbang.org/resource/image/b0/36/b0db4047723ec5e649240e2a87196a36.png?wh=468*288\" alt=\"\"><br>\n我们的目标是构造ARMA时间序列模型，预测比特币（平均）价格走势。p和q参数具体选择多少呢？我们可以设置一个区间范围，然后选择AIC最低的ARMA模型。</p><p>我们梳理下整个项目的流程：</p><p><img src=\"https://static001.geekbang.org/resource/image/95/1e/95f8294c1f4805b86f9947178499181e.jpg?wh=2358*1091\" alt=\"\"><br>\n首先我们需要加载数据。</p><p>在准备阶段，我们需要先探索数据，采用数据可视化方式查看比特币的历史走势。按照不同的时间尺度（天，月，季度，年）可以将数据压缩，得到不同尺度的数据，然后做可视化呈现。这4个时间尺度上，我们选择月作为预测模型的时间尺度，相应的，我们选择Weighted_Price这个字段的数值作为观察结果，在原始数据中，Weighted_Price对应的是比特币每天的平均价格，当我们以“月”为单位进行压缩的时候，对应的Weighted_Price得到的就是当月的比特币平均价格。压缩代码如下：</p><pre><code>df_month = df.resample('M').mean()\n</code></pre><p>最后在预测阶段创建ARMA时间序列模型。我们并不知道p和q取什么值时，模型最优，因此我们可以给它们设置一个区间范围，比如都是range(0,3)，然后计算不同模型的AIC数值，选择最小的AIC数值对应的那个ARMA模型。最后用这个最优的ARMA模型预测未来8个月的比特币平均价格走势，并将结果做可视化呈现。</p><p>基于这个流程，具体代码如下：</p><pre><code># -*- coding: utf-8 -*-\n# 比特币走势预测，使用时间序列ARMA\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nfrom statsmodels.tsa.arima_model import ARMA\nimport warnings\nfrom itertools import product\nfrom datetime import datetime\nwarnings.filterwarnings('ignore')\n# 数据加载\ndf = pd.read_csv('./bitcoin_2012-01-01_to_2018-10-31.csv')\n# 将时间作为df的索引\ndf.Timestamp = pd.to_datetime(df.Timestamp)\ndf.index = df.Timestamp\n# 数据探索\nprint(df.head())\n# 按照月，季度，年来统计\ndf_month = df.resample('M').mean()\ndf_Q = df.resample('Q-DEC').mean()\ndf_year = df.resample('A-DEC').mean()\n# 按照天，月，季度，年来显示比特币的走势\nfig = plt.figure(figsize=[15, 7])\nplt.rcParams['font.sans-serif']=['SimHei'] #用来正常显示中文标签\nplt.suptitle('比特币金额（美金）', fontsize=20)\nplt.subplot(221)\nplt.plot(df.Weighted_Price, '-', label='按天')\nplt.legend()\nplt.subplot(222)\nplt.plot(df_month.Weighted_Price, '-', label='按月')\nplt.legend()\nplt.subplot(223)\nplt.plot(df_Q.Weighted_Price, '-', label='按季度')\nplt.legend()\nplt.subplot(224)\nplt.plot(df_year.Weighted_Price, '-', label='按年')\nplt.legend()\nplt.show()\n# 设置参数范围\nps = range(0, 3)\nqs = range(0, 3)\nparameters = product(ps, qs)\nparameters_list = list(parameters)\n# 寻找最优ARMA模型参数，即best_aic最小\nresults = []\nbest_aic = float(&quot;inf&quot;) # 正无穷\nfor param in parameters_list:\n    try:\n        model = ARMA(df_month.Weighted_Price,order=(param[0], param[1])).fit()\n    except ValueError:\n        print('参数错误:', param)\n        continue\n    aic = model.aic\n    if aic &lt; best_aic:\n        best_model = model\n        best_aic = aic\n        best_param = param\n    results.append([param, model.aic])\n# 输出最优模型\nresult_table = pd.DataFrame(results)\nresult_table.columns = ['parameters', 'aic']\nprint('最优模型: ', best_model.summary())\n# 比特币预测\ndf_month2 = df_month[['Weighted_Price']]\ndate_list = [datetime(2018, 11, 30), datetime(2018, 12, 31), datetime(2019, 1, 31), datetime(2019, 2, 28), datetime(2019, 3, 31), \n             datetime(2019, 4, 30), datetime(2019, 5, 31), datetime(2019, 6, 30)]\nfuture = pd.DataFrame(index=date_list, columns= df_month.columns)\ndf_month2 = pd.concat([df_month2, future])\ndf_month2['forecast'] = best_model.predict(start=0, end=91)\n# 比特币预测结果显示\nplt.figure(figsize=(20,7))\ndf_month2.Weighted_Price.plot(label='实际金额')\ndf_month2.forecast.plot(color='r', ls='--', label='预测金额')\nplt.legend()\nplt.title('比特币金额（月）')\nplt.xlabel('时间')\nplt.ylabel('美金')\nplt.show()\n</code></pre><p>运行结果：</p><pre><code>           Timestamp       ...        Weighted_Price\nTimestamp                   ...                      \n2011-12-31 2011-12-31       ...              4.471603\n2012-01-01 2012-01-01       ...              4.806667\n2012-01-02 2012-01-02       ...              5.000000\n2012-01-03 2012-01-03       ...              5.252500\n2012-01-04 2012-01-04       ...              5.208159\n\n[5 rows x 8 columns]\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/a9/2e/a91da037291f81fb6c90dc12223e9b2e.png?wh=1726*896\" alt=\"\"></p><p><img src=\"https://static001.geekbang.org/resource/image/f6/98/f6a288ca19200918dfe219d2be47af98.png?wh=1729*932\" alt=\"\"></p><p><img src=\"https://static001.geekbang.org/resource/image/a6/f9/a6648f60cf39dcba9fe81069da214cf9.png?wh=1729*661\" alt=\"\"><br>\n我们通过product函数创建了(p,q)在range(0,3)范围内的所有可能组合，并对每个ARMA(p,q)模型进行了AIC数值计算，保存了AIC数值最小的模型参数。然后用这个模型对比特币的未来8个月进行了预测。</p><p>从结果中你能看到，在2018年10月之后8个月的时间里，比特币会触底到4000美金左右，实际上比特币在这个阶段确实降低到了4000元美金甚至更低。在时间尺度的选择上，我们选择了月，这样就对数据进行了降维，也节约了ARMA的模型训练时间。你能看到比特币金额（美金）这张图中，按月划分的比特币走势和按天划分的比特币走势差别不大，在减少了局部的波动的同时也能体现出比特币的趋势，这样就节约了ARMA的模型训练时间。</p><h2>总结</h2><p>今天我给你讲了一个比特币趋势预测的实战项目。通过这个项目你应该能体会到，当我们对一个数值进行预测的时候，如果考虑的是多个变量和结果之间的关系，可以采用回归分析，如果考虑单个时间维度与结果的关系，可以使用时间序列分析。</p><p>根据比特币的历史数据，我们使用ARMA模型对比特币未来8个月的走势进行了预测，并对结果进行了可视化显示。你能看到ARMA工具还是很好用的，虽然比特币的走势受很多外在因素影响，比如政策环境。不过当我们掌握了这些历史数据，也不妨用时间序列模型来分析预测一下。</p><p><img src=\"https://static001.geekbang.org/resource/image/24/94/24f8ee2f600a2451eecd58a98f7db894.png?wh=1726*846\" alt=\"\"><br>\n最后依然是思考题环节，今天我们讲了AR、MA、ARMA和ARIMA，你能简单说说它们之间的区别么？</p><p>另外我在<a href=\"https://github.com/cystanford/bitcoin\">GitHub</a>中上传了沪市指数的历史数据（对应的shanghai_1990-12-19_to_2019-2-28.csv），请你编写代码使用ARMA模型对沪市指数未来10个月（截止到2019年12月31日）的变化进行预测（将数据转化为按月统计即可）。</p><p>欢迎你在评论区与我分享你的答案，也欢迎点击“请朋友读”，把这篇文章分享给你的朋友或者同事。</p>","comments":[{"had_liked":false,"id":77128,"user_name":"Geek_2a6093","can_delete":false,"product_type":"c1","uid":1395560,"ip_address":"","ucode":"9C216A0B09A7AF","user_header":"https://static001.geekbang.org/account/avatar/00/15/4b/68/a6198a59.jpg","comment_is_top":false,"comment_ctime":1552844301,"is_pvip":false,"replies":[{"id":64411,"content":"LSTM也是不错的方式，不过LSTM就像是炼金术，需要的计算量（时间）有些大了","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577618491,"ip_address":"","comment_id":77128,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100021701,"comment_content":"老师能不能讲一下LSTM\n","like_count":17},{"had_liked":false,"id":77241,"user_name":"Geek_hve78z","can_delete":false,"product_type":"c1","uid":1015045,"ip_address":"","ucode":"386803B8FC2DD5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7d/05/4bad0c7c.jpg","comment_is_top":false,"comment_ctime":1552895151,"is_pvip":false,"replies":[{"id":64404,"content":"对的","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577618416,"ip_address":"","comment_id":77241,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100021701,"comment_content":"运行沪市指数数据结果为：\n参数错误: (0, 2)\n最优模型: ARMA Model Results  \n预测数据：\n2019-03-31\t\t2841.753594\n2019-04-30\t\t2862.532373\n2019-05-31\t\t2816.252354\n2019-06-30\t\t2801.829572\n2019-07-31\t\t2773.588278\n2019-08-31\t\t2752.587602\n2019-09-30\t\t2729.086661\n2019-10-31\t\t2707.560415\n2019-11-30\t\t2685.923215\n2019-12-31\t\t2665.117874\n-----------\ndf_month2[&#39;forecast&#39;]=best_model.predict(start=0,end=348)理解\nstart=0表示从第0课数据开始计算\nend=348是指需要计算348个数据，即从1990-12-19到2019-12-31一共有348个月，所以有348个数据","like_count":7,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443591,"discussion_content":"LSTM也是不错的方式，不过LSTM就像是炼金术，需要的计算量（时间）有些大了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577618491,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77237,"user_name":"Geek_hve78z","can_delete":false,"product_type":"c1","uid":1015045,"ip_address":"","ucode":"386803B8FC2DD5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7d/05/4bad0c7c.jpg","comment_is_top":false,"comment_ctime":1552894470,"is_pvip":false,"replies":[{"id":64405,"content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577618424,"ip_address":"","comment_id":77237,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100021701,"comment_content":"# -*- coding:utf-8 -*-\n# 编码使用 ARMA 模型对沪市指数未来 10 个月（截止到 2019 年 12 月 31 日）的变化进行预测\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nfrom statsmodels.tsa.arima_model import ARMA\nimport warnings\nfrom itertools import product\nfrom datetime import datetime\nwarnings.filterwarnings(&#39;ignore&#39;)\n\n# 数据加载\ndf=pd.read_csv(&#39;.&#47;bitcoin-master&#47;shanghai_1990-12-19_to_2019-2-28.csv&#39;)\n# 将时间作为 df 的索引\ndf.Timestamp=pd.to_datetime(df.Timestamp)\ndf.index=df.Timestamp\n\n# 数据探索\nprint(df.head())\n\n# 按照月来统计\ndf_month=df.resample(&#39;M&#39;).mean()\n\n# 按照月来显示沪市指数的走势\nfig=plt.figure(figsize=[15,7])\nplt.rcParams[&#39;font.sans-serif&#39;]=[&#39;SimHei&#39;]\nplt.suptitle(&#39;沪市指数&#39;,fontsize=20)\n\nplt.plot(df_month.Price,&#39;-&#39;,label=&#39;按月&#39;)\nplt.legend()\nplt.show()\n\n# 设置参数范围\nps=range(0,3)\nqs=range(0,3)\nparameters=product(ps,qs)\nparameters_list=list(parameters)\n\n# 寻找最优 ARMA 模型参数，即 best_aic 最小\nresults=[]\nbest_aic=float(&#39;inf&#39;)# 正无穷\nfor param in parameters_list:\n    try:\n        model=ARMA(df_month.Price,order=(param[0],param[1])).fit()\n    except ValueError:\n        print(&#39;参数错误:&#39;,param)\n        continue\n    aic=model.aic\n    if aic&lt;best_aic:\n        best_model=model\n        best_aic=aic\n        best_param=param\n    results.append([param,model.aic])\n# 输出最优模型\nresult_table=pd.DataFrame(results)\nresult_table.columns=[&#39;parameters&#39;,&#39;aic&#39;]\nprint(&#39;最优模型:&#39;,best_model.summary())\n\n# 沪市指数预测\ndf_month2=df_month[[&#39;Price&#39;]]\ndate_list= [datetime(2019, 3, 31), datetime(2019, 4, 30), datetime(2019, 5, 31), datetime(2019, 6, 30), datetime(2019, 7, 31),\n             datetime(2019, 8, 31), datetime(2019, 9, 30), datetime(2019, 10, 31),datetime(2019, 11, 30),datetime(2019, 12, 31)]\nfuture=pd.DataFrame(index=date_list,columns=df_month.columns)\ndf_month2=pd.concat([df_month2,future])\ndf_month2[&#39;forecast&#39;]=best_model.predict(start=0,end=348)\n# 沪市指数预测结果显示\nplt.figure(figsize=(20,7))\ndf_month2.Price.plot(label=&#39;实际指数&#39;)\ndf_month2.forecast.plot(color=&#39;r&#39;,ls=&#39;--&#39;,label=&#39;预测指数&#39;)\nplt.legend()\nplt.title(&#39;沪市指数（月）&#39;)\nplt.xlabel(&#39;时间&#39;)\nplt.ylabel(&#39;指数&#39;)\nplt.show()","like_count":7,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443652,"discussion_content":"对的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577618416,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2668134,"avatar":"https://static001.geekbang.org/account/avatar/00/28/b6/66/5d2be1ee.jpg","nickname":"东旭","note":"","ucode":"FD3EA3265FD9C0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":535627,"discussion_content":"老师，这个沪市指数历史数据是在哪里，怎么获得的，盼复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638499611,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":443652,"ip_address":"","group_id":0},"score":535627,"extra":""}]},{"author":{"id":2002493,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erQclmTZFrRVhxGicibVxJ6a14jQyEoUU0Jf6LT20kqG6kgaETM1fWKuxFonmNOZCO5qYHF3MJQHsMw/132","nickname":"Geek_22a0c1","note":"","ucode":"1192708F1043BC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":298779,"discussion_content":"这个预测有问题啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597397516,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":82040,"user_name":"张丽斌","can_delete":false,"product_type":"c1","uid":1009318,"ip_address":"","ucode":"424253F2716313","user_header":"https://static001.geekbang.org/account/avatar/00/0f/66/a6/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1554108398,"is_pvip":false,"replies":[{"id":64325,"content":"对 很多因素","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577616906,"ip_address":"","comment_id":82040,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100021701,"comment_content":"这是刚好撞对了吧，比特币、股市什么的预测受各种因素影响太大了。更多是考虑动态因素","like_count":6,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445439,"discussion_content":"对 很多因素","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577616906,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77184,"user_name":"跳跳","can_delete":false,"product_type":"c1","uid":1172803,"ip_address":"","ucode":"80B697B89E1A0B","user_header":"https://static001.geekbang.org/account/avatar/00/11/e5/43/7bc7cfe3.jpg","comment_is_top":false,"comment_ctime":1552878472,"is_pvip":false,"replies":[{"id":64410,"content":"很好的总结，同时赞下完成作业的同学","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577618464,"ip_address":"","comment_id":77184,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100021701,"comment_content":"一、AR、MA、ARMA、ARIMA的区别\nAR的核心思想是过去若干点的线性组合，再加上白噪声预测未来时刻点的值。\nMA的核心思想是通过历史白噪声线性组合来影响当前的时刻点。\nARMA：结合AR、MA的思想，综合考虑历史白噪声和当前白噪声，预测未来时刻点。\nARIMA：较ARMA多了差分过程，对不平衡数据进行了差分平稳。\n二、沪市指数预测结果如下：\n参数错误: (0, 2)\n最优模型:                                ARMA Model Results                              \n==============================================================================\nDep. Variable:                  Price   No. Observations:                  339\nModel:                     ARMA(2, 2)   Log Likelihood               -2208.110\nMethod:                       css-mle   S.D. of innovations            162.159\nDate:                Mon, 18 Mar 2019   AIC                           4428.219\nTime:                        10:59:23   BIC                           4451.175\nSample:                    12-31-1990   HQIC                          4437.367\n                         - 02-28-2019                                         \n","like_count":6,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445439,"discussion_content":"对 很多因素","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577616906,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136723,"user_name":"骑行的掌柜J","can_delete":false,"product_type":"c1","uid":1474214,"ip_address":"","ucode":"3163102651C653","user_header":"https://static001.geekbang.org/account/avatar/00/16/7e/a6/4e331ef4.jpg","comment_is_top":false,"comment_ctime":1569498103,"is_pvip":false,"replies":[{"id":62717,"content":"Good Job，使用差分之后，再进行的ARMA模型","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577086525,"ip_address":"","comment_id":136723,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100021701,"comment_content":"我用ARIMA模型对老师一开始的那组时间序列进行了分析预测，因为字数限制：省略一开始的数据加载和最后的预测步骤，但是加入对差分次数d的查找、找ARIMA模型的p、q值和模型检验三个步骤，希望对大家有用，谢谢\n# -*- coding: utf-8 -*-\n# 用 ARIMA 进行时间序列预测\nimport numpy as np\nfrom statsmodels.graphics.tsaplots import acf,pacf,plot_acf,plot_pacf\n#2.下面我们先对非平稳时间序列进行时间序列的差分，找出适合的差分次数\n#fig = plt.figure(figsize=(12, 8))\n#ax1 = fig.add_subplot(111)\n#diff1 = data.diff(1)\n#diff1.plot(ax=ax1)\n#这里是做了1阶差分，可以看出时间序列的均值和方差基本平稳，\n#这里我们使用一阶差分的时间序列，把上面代码注释掉\n#3.接下来我们要找到ARIMA模型中合适的p和q值：\ndata = data.diff(1)\ndata.dropna(inplace=True)\n#第一步：先检查平稳序列的自相关图和偏自相关图\nfig = plt.figure(figsize=(12, 8))\nax1 = fig.add_subplot(211)\nfig = sm.graphics.tsa.plot_acf(data,lags=40,ax=ax1)\n#lags 表示滞后的阶数，下面分别得到acf 图和pacf 图\nax2 = fig.add_subplot(212)\nfig = sm.graphics.tsa.plot_pacf(data, lags=40,ax=ax2)\n#由下图我们可以分别用ARMA(0,1)模型、ARMA(7,0)模型、ARMA(7,1)模型等来拟合找出最佳模型：\n#第三步:找出最佳模型ARMA\narma_mod1 = sm.tsa.ARMA(data,(7,0)).fit()\nprint(arma_mod1.aic, arma_mod1.bic, arma_mod1.hqic)\narma_mod2 = sm.tsa.ARMA(data,(0,1)).fit()\nprint(arma_mod2.aic, arma_mod2.bic, arma_mod2.hqic)\narma_mod3 = sm.tsa.ARMA(data,(7,1)).fit()\nprint(arma_mod3.aic, arma_mod3.bic, arma_mod3.hqic)\narma_mod4 = sm.tsa.ARMA(data,(8,0)).fit()\nprint(arma_mod4.aic, arma_mod4.bic, arma_mod4.hqic)\n#由上面可以看出ARMA(7,0)模型最佳\n#第四步：进行模型检验，首先对ARMA(7,0)模型所产生的残差做自相关图\nresid = arma_mod1.resid\n#一定要加上这个变量赋值语句，不然会报错resid is not defined \nfig = plt.figure(figsize=(12, 8))\nax1 = fig.add_subplot(211)\nfig = sm.graphics.tsa.plot_acf(resid.values.squeeze(),lags=40,ax=ax1)\nax2 = fig.add_subplot(212)\nfig = sm.graphics.tsa.plot_pacf(resid, lags=40,ax=ax2)\n#接着做德宾-沃森（D-W）检验\nprint(sm.stats.durbin_watson(arma_mod1.resid.values))\n#得出来结果是不存在自相关性的\n#再观察是否符合正态分布,这里用qq图\nfig = plt.figure(figsize=(12,8))\nax = fig.add_subplot(111)\nfig = qqplot(resid, line=&#39;q&#39;,ax=ax, fit=True)\n#最后用Ljung-Box检验:检验的结果就是看最后一列前十二行的检验概率（一般观察滞后1~12阶）\nr,q,p = sm.tsa.acf(resid.values.squeeze(),qstat=True)\ndata1 = np.c_[range(1,41), r[1:], q, p]\ntable= pd.DataFrame(data1, columns=[ &#39;lag&#39;,&#39;AC&#39;,&#39;Q&#39;,&#39;Prob(&gt;Q)&#39;])\nprint(table.set_index(&#39;lag&#39;))\n","like_count":4,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443624,"discussion_content":"很好的总结，同时赞下完成作业的同学","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577618464,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1614927,"avatar":"https://static001.geekbang.org/account/avatar/00/18/a4/4f/00b2cf4b.jpg","nickname":"云焕7777","note":"","ucode":"34299A86A2F5CD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":396990,"discussion_content":"为什么会有参数错误（0,2）呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632537546,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89570,"user_name":"滢","can_delete":false,"product_type":"c1","uid":1221511,"ip_address":"","ucode":"971A6F20AF3F9A","user_header":"https://static001.geekbang.org/account/avatar/00/12/a3/87/c415e370.jpg","comment_is_top":false,"comment_ctime":1556208860,"is_pvip":false,"replies":[{"id":64221,"content":"1）彩票这种用什么没有用，因为是完全随机性，找不到规律的，或者用规律解决不了问题\n2）ARMA 可以赋值个范围，让它在范围内自己来寻找适合的参数，一般超参数优化都是这样操作\n加油滢","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577614631,"ip_address":"","comment_id":89570,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100021701,"comment_content":"想问下老师，（1）对于类似于彩票这种类型的数据该用什么算法分析？（2）对于ARMA的最优只能人为赋值，循环检测最大值吗？若数据多的情况怎么办？ ","like_count":3,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468774,"discussion_content":"Good Job，使用差分之后，再进行的ARMA模型","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577086525,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1372987,"avatar":"https://static001.geekbang.org/account/avatar/00/14/f3/3b/15ffb7c3.jpg","nickname":"胖陶","note":"","ucode":"EE32D91A3BC0F3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":37497,"discussion_content":"可以给一下完整代码吗谢谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571623938,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1474214,"avatar":"https://static001.geekbang.org/account/avatar/00/16/7e/a6/4e331ef4.jpg","nickname":"骑行的掌柜J","note":"","ucode":"3163102651C653","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1372987,"avatar":"https://static001.geekbang.org/account/avatar/00/14/f3/3b/15ffb7c3.jpg","nickname":"胖陶","note":"","ucode":"EE32D91A3BC0F3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":38820,"discussion_content":"https://blog.csdn.net/weixin_41013322/article/details/102710236 写在我博客里了 你去看看吧","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1571838093,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":37497,"ip_address":"","group_id":0},"score":38820,"extra":""}]}]},{"had_liked":false,"id":134440,"user_name":"叁","can_delete":false,"product_type":"c1","uid":1589855,"ip_address":"","ucode":"4748BE1FD3CA3E","user_header":"https://static001.geekbang.org/account/avatar/00/18/42/5f/349b57f2.jpg","comment_is_top":false,"comment_ctime":1568831347,"is_pvip":false,"replies":[{"id":63496,"content":"可以使用ARIMA模型","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577514631,"ip_address":"","comment_id":134440,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100021701,"comment_content":"我觉得确实有些问题，在是同arma模型之前没有对数据平稳性检验，毕竟模型是基于平稳性的。","like_count":2,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448178,"discussion_content":"1）彩票这种用什么没有用，因为是完全随机性，找不到规律的，或者用规律解决不了问题\n2）ARMA 可以赋值个范围，让它在范围内自己来寻找适合的参数，一般超参数优化都是这样操作\n加油滢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577614631,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77227,"user_name":"Geek_hve78z","can_delete":false,"product_type":"c1","uid":1015045,"ip_address":"","ucode":"386803B8FC2DD5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7d/05/4bad0c7c.jpg","comment_is_top":false,"comment_ctime":1552892640,"is_pvip":false,"replies":[{"id":64406,"content":"很好的总结！","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577618430,"ip_address":"","comment_id":77227,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100021701,"comment_content":"AR、MA、ARMA和ARIMA模型区别\n\n1、AR （Auto Regressive），中文叫自回归模型，它认为过去若干时刻的点通过线性组合，再加上白噪声就可以预测未来某个时刻的点。AR 模型还存在一个阶数，称为 AR（p）模型，也叫作 p 阶自回归模型。它指的是通过这个时刻点的前 p 个点，通过线性组合再加上白噪声来预测当前时刻点的值。\n\n2、MA （ Moving Average），中文叫做滑动平均模型。MA 模型存在一个阶数，称为 MA(q) 模型，也叫作 q 阶移动平均模型。MA 模型是通过将一段时间序列中白噪声序列进行加权和。\n\n3、ARMA （ Auto Regressive Moving Average），中文叫做自回归滑动平均模型， ARMA 模型存在 p 和 q 两个阶数，称为 ARMA(p,q) 模型。\n\n4、ARIMA（ Auto Regressive Integrated Moving Average ），中文叫差分自回归滑动平均模型，也叫求合自回归滑动平均模型。相比于 ARMA，ARIMA 多了一个差分的过程，作用是对不平稳数据进行差分平稳，在差分平稳后再进行建模。ARIMA 是一个三元组的阶数 (p,d,q)，称为 ARIMA(p,d,q) 模型。其中 d 是差分阶数。","like_count":2,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467749,"discussion_content":"可以使用ARIMA模型","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577514631,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":210072,"user_name":"JustDoDT","can_delete":false,"product_type":"c1","uid":1127175,"ip_address":"","ucode":"6AF0B80F00EAEF","user_header":"https://static001.geekbang.org/account/avatar/00/11/33/07/8f351609.jpg","comment_is_top":false,"comment_ctime":1587661326,"is_pvip":false,"replies":[{"id":103974,"content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1617289830,"ip_address":"","comment_id":210072,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100021701,"comment_content":"交作业：快学完第一遍了，奥利给干了。\nhttps:&#47;&#47;github.com&#47;LearningChanging&#47;Data-analysis-in-action&#47;tree&#47;master&#47;41-%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98%E5%AE%9E%E6%88%98%EF%BC%883%EF%BC%89%EF%BC%9A%E5%A6%82%E4%BD%95%E5%AF%B9%E6%AF%94%E7%89%B9%E5%B8%81%E8%B5%B0%E5%8A%BF%E8%BF%9B%E8%A1%8C%E9%A2%84%E6%B5%8B%EF%BC%9F","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443645,"discussion_content":"很好的总结！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577618430,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77128,"user_name":"Geek_2a6093","can_delete":false,"product_type":"c1","uid":1395560,"ip_address":"","ucode":"9C216A0B09A7AF","user_header":"https://static001.geekbang.org/account/avatar/00/15/4b/68/a6198a59.jpg","comment_is_top":false,"comment_ctime":1552844301,"is_pvip":false,"replies":[{"id":64411,"content":"LSTM也是不错的方式，不过LSTM就像是炼金术，需要的计算量（时间）有些大了","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577618491,"ip_address":"","comment_id":77128,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100021701,"comment_content":"老师能不能讲一下LSTM\n","like_count":17,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443591,"discussion_content":"LSTM也是不错的方式，不过LSTM就像是炼金术，需要的计算量（时间）有些大了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577618491,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77241,"user_name":"Geek_hve78z","can_delete":false,"product_type":"c1","uid":1015045,"ip_address":"","ucode":"386803B8FC2DD5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7d/05/4bad0c7c.jpg","comment_is_top":false,"comment_ctime":1552895151,"is_pvip":false,"replies":[{"id":64404,"content":"对的","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577618416,"ip_address":"","comment_id":77241,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100021701,"comment_content":"运行沪市指数数据结果为：\n参数错误: (0, 2)\n最优模型: ARMA Model Results  \n预测数据：\n2019-03-31\t\t2841.753594\n2019-04-30\t\t2862.532373\n2019-05-31\t\t2816.252354\n2019-06-30\t\t2801.829572\n2019-07-31\t\t2773.588278\n2019-08-31\t\t2752.587602\n2019-09-30\t\t2729.086661\n2019-10-31\t\t2707.560415\n2019-11-30\t\t2685.923215\n2019-12-31\t\t2665.117874\n-----------\ndf_month2[&#39;forecast&#39;]=best_model.predict(start=0,end=348)理解\nstart=0表示从第0课数据开始计算\nend=348是指需要计算348个数据，即从1990-12-19到2019-12-31一共有348个月，所以有348个数据","like_count":7,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443652,"discussion_content":"对的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577618416,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2668134,"avatar":"https://static001.geekbang.org/account/avatar/00/28/b6/66/5d2be1ee.jpg","nickname":"东旭","note":"","ucode":"FD3EA3265FD9C0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":535627,"discussion_content":"老师，这个沪市指数历史数据是在哪里，怎么获得的，盼复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638499611,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":443652,"ip_address":"","group_id":0},"score":535627,"extra":""}]},{"author":{"id":2002493,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erQclmTZFrRVhxGicibVxJ6a14jQyEoUU0Jf6LT20kqG6kgaETM1fWKuxFonmNOZCO5qYHF3MJQHsMw/132","nickname":"Geek_22a0c1","note":"","ucode":"1192708F1043BC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":298779,"discussion_content":"这个预测有问题啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597397516,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77237,"user_name":"Geek_hve78z","can_delete":false,"product_type":"c1","uid":1015045,"ip_address":"","ucode":"386803B8FC2DD5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7d/05/4bad0c7c.jpg","comment_is_top":false,"comment_ctime":1552894470,"is_pvip":false,"replies":[{"id":64405,"content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577618424,"ip_address":"","comment_id":77237,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100021701,"comment_content":"# -*- coding:utf-8 -*-\n# 编码使用 ARMA 模型对沪市指数未来 10 个月（截止到 2019 年 12 月 31 日）的变化进行预测\nimport numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nfrom statsmodels.tsa.arima_model import ARMA\nimport warnings\nfrom itertools import product\nfrom datetime import datetime\nwarnings.filterwarnings(&#39;ignore&#39;)\n\n# 数据加载\ndf=pd.read_csv(&#39;.&#47;bitcoin-master&#47;shanghai_1990-12-19_to_2019-2-28.csv&#39;)\n# 将时间作为 df 的索引\ndf.Timestamp=pd.to_datetime(df.Timestamp)\ndf.index=df.Timestamp\n\n# 数据探索\nprint(df.head())\n\n# 按照月来统计\ndf_month=df.resample(&#39;M&#39;).mean()\n\n# 按照月来显示沪市指数的走势\nfig=plt.figure(figsize=[15,7])\nplt.rcParams[&#39;font.sans-serif&#39;]=[&#39;SimHei&#39;]\nplt.suptitle(&#39;沪市指数&#39;,fontsize=20)\n\nplt.plot(df_month.Price,&#39;-&#39;,label=&#39;按月&#39;)\nplt.legend()\nplt.show()\n\n# 设置参数范围\nps=range(0,3)\nqs=range(0,3)\nparameters=product(ps,qs)\nparameters_list=list(parameters)\n\n# 寻找最优 ARMA 模型参数，即 best_aic 最小\nresults=[]\nbest_aic=float(&#39;inf&#39;)# 正无穷\nfor param in parameters_list:\n    try:\n        model=ARMA(df_month.Price,order=(param[0],param[1])).fit()\n    except ValueError:\n        print(&#39;参数错误:&#39;,param)\n        continue\n    aic=model.aic\n    if aic&lt;best_aic:\n        best_model=model\n        best_aic=aic\n        best_param=param\n    results.append([param,model.aic])\n# 输出最优模型\nresult_table=pd.DataFrame(results)\nresult_table.columns=[&#39;parameters&#39;,&#39;aic&#39;]\nprint(&#39;最优模型:&#39;,best_model.summary())\n\n# 沪市指数预测\ndf_month2=df_month[[&#39;Price&#39;]]\ndate_list= [datetime(2019, 3, 31), datetime(2019, 4, 30), datetime(2019, 5, 31), datetime(2019, 6, 30), datetime(2019, 7, 31),\n             datetime(2019, 8, 31), datetime(2019, 9, 30), datetime(2019, 10, 31),datetime(2019, 11, 30),datetime(2019, 12, 31)]\nfuture=pd.DataFrame(index=date_list,columns=df_month.columns)\ndf_month2=pd.concat([df_month2,future])\ndf_month2[&#39;forecast&#39;]=best_model.predict(start=0,end=348)\n# 沪市指数预测结果显示\nplt.figure(figsize=(20,7))\ndf_month2.Price.plot(label=&#39;实际指数&#39;)\ndf_month2.forecast.plot(color=&#39;r&#39;,ls=&#39;--&#39;,label=&#39;预测指数&#39;)\nplt.legend()\nplt.title(&#39;沪市指数（月）&#39;)\nplt.xlabel(&#39;时间&#39;)\nplt.ylabel(&#39;指数&#39;)\nplt.show()","like_count":7,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443649,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577618424,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2913751,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/75/d7/3e309b4e.jpg","nickname":"三余韵势","note":"","ucode":"8395F79A74B2CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551698,"discussion_content":"我做了个和你差不多的股价预测，但future的值是空的，还望可进一步指点一番","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645086099,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":82040,"user_name":"张丽斌","can_delete":false,"product_type":"c1","uid":1009318,"ip_address":"","ucode":"424253F2716313","user_header":"https://static001.geekbang.org/account/avatar/00/0f/66/a6/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1554108398,"is_pvip":false,"replies":[{"id":64325,"content":"对 很多因素","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577616906,"ip_address":"","comment_id":82040,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100021701,"comment_content":"这是刚好撞对了吧，比特币、股市什么的预测受各种因素影响太大了。更多是考虑动态因素","like_count":6,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443649,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577618424,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2913751,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/75/d7/3e309b4e.jpg","nickname":"三余韵势","note":"","ucode":"8395F79A74B2CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551698,"discussion_content":"我做了个和你差不多的股价预测，但future的值是空的，还望可进一步指点一番","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645086099,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77184,"user_name":"跳跳","can_delete":false,"product_type":"c1","uid":1172803,"ip_address":"","ucode":"80B697B89E1A0B","user_header":"https://static001.geekbang.org/account/avatar/00/11/e5/43/7bc7cfe3.jpg","comment_is_top":false,"comment_ctime":1552878472,"is_pvip":false,"replies":[{"id":64410,"content":"很好的总结，同时赞下完成作业的同学","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577618464,"ip_address":"","comment_id":77184,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100021701,"comment_content":"一、AR、MA、ARMA、ARIMA的区别\nAR的核心思想是过去若干点的线性组合，再加上白噪声预测未来时刻点的值。\nMA的核心思想是通过历史白噪声线性组合来影响当前的时刻点。\nARMA：结合AR、MA的思想，综合考虑历史白噪声和当前白噪声，预测未来时刻点。\nARIMA：较ARMA多了差分过程，对不平衡数据进行了差分平稳。\n二、沪市指数预测结果如下：\n参数错误: (0, 2)\n最优模型:                                ARMA Model Results                              \n==============================================================================\nDep. Variable:                  Price   No. Observations:                  339\nModel:                     ARMA(2, 2)   Log Likelihood               -2208.110\nMethod:                       css-mle   S.D. of innovations            162.159\nDate:                Mon, 18 Mar 2019   AIC                           4428.219\nTime:                        10:59:23   BIC                           4451.175\nSample:                    12-31-1990   HQIC                          4437.367\n                         - 02-28-2019                                         \n","like_count":6,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443624,"discussion_content":"很好的总结，同时赞下完成作业的同学","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577618464,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1614927,"avatar":"https://static001.geekbang.org/account/avatar/00/18/a4/4f/00b2cf4b.jpg","nickname":"云焕7777","note":"","ucode":"34299A86A2F5CD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":396990,"discussion_content":"为什么会有参数错误（0,2）呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632537546,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136723,"user_name":"骑行的掌柜J","can_delete":false,"product_type":"c1","uid":1474214,"ip_address":"","ucode":"3163102651C653","user_header":"https://static001.geekbang.org/account/avatar/00/16/7e/a6/4e331ef4.jpg","comment_is_top":false,"comment_ctime":1569498103,"is_pvip":false,"replies":[{"id":62717,"content":"Good Job，使用差分之后，再进行的ARMA模型","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577086525,"ip_address":"","comment_id":136723,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100021701,"comment_content":"我用ARIMA模型对老师一开始的那组时间序列进行了分析预测，因为字数限制：省略一开始的数据加载和最后的预测步骤，但是加入对差分次数d的查找、找ARIMA模型的p、q值和模型检验三个步骤，希望对大家有用，谢谢\n# -*- coding: utf-8 -*-\n# 用 ARIMA 进行时间序列预测\nimport numpy as np\nfrom statsmodels.graphics.tsaplots import acf,pacf,plot_acf,plot_pacf\n#2.下面我们先对非平稳时间序列进行时间序列的差分，找出适合的差分次数\n#fig = plt.figure(figsize=(12, 8))\n#ax1 = fig.add_subplot(111)\n#diff1 = data.diff(1)\n#diff1.plot(ax=ax1)\n#这里是做了1阶差分，可以看出时间序列的均值和方差基本平稳，\n#这里我们使用一阶差分的时间序列，把上面代码注释掉\n#3.接下来我们要找到ARIMA模型中合适的p和q值：\ndata = data.diff(1)\ndata.dropna(inplace=True)\n#第一步：先检查平稳序列的自相关图和偏自相关图\nfig = plt.figure(figsize=(12, 8))\nax1 = fig.add_subplot(211)\nfig = sm.graphics.tsa.plot_acf(data,lags=40,ax=ax1)\n#lags 表示滞后的阶数，下面分别得到acf 图和pacf 图\nax2 = fig.add_subplot(212)\nfig = sm.graphics.tsa.plot_pacf(data, lags=40,ax=ax2)\n#由下图我们可以分别用ARMA(0,1)模型、ARMA(7,0)模型、ARMA(7,1)模型等来拟合找出最佳模型：\n#第三步:找出最佳模型ARMA\narma_mod1 = sm.tsa.ARMA(data,(7,0)).fit()\nprint(arma_mod1.aic, arma_mod1.bic, arma_mod1.hqic)\narma_mod2 = sm.tsa.ARMA(data,(0,1)).fit()\nprint(arma_mod2.aic, arma_mod2.bic, arma_mod2.hqic)\narma_mod3 = sm.tsa.ARMA(data,(7,1)).fit()\nprint(arma_mod3.aic, arma_mod3.bic, arma_mod3.hqic)\narma_mod4 = sm.tsa.ARMA(data,(8,0)).fit()\nprint(arma_mod4.aic, arma_mod4.bic, arma_mod4.hqic)\n#由上面可以看出ARMA(7,0)模型最佳\n#第四步：进行模型检验，首先对ARMA(7,0)模型所产生的残差做自相关图\nresid = arma_mod1.resid\n#一定要加上这个变量赋值语句，不然会报错resid is not defined \nfig = plt.figure(figsize=(12, 8))\nax1 = fig.add_subplot(211)\nfig = sm.graphics.tsa.plot_acf(resid.values.squeeze(),lags=40,ax=ax1)\nax2 = fig.add_subplot(212)\nfig = sm.graphics.tsa.plot_pacf(resid, lags=40,ax=ax2)\n#接着做德宾-沃森（D-W）检验\nprint(sm.stats.durbin_watson(arma_mod1.resid.values))\n#得出来结果是不存在自相关性的\n#再观察是否符合正态分布,这里用qq图\nfig = plt.figure(figsize=(12,8))\nax = fig.add_subplot(111)\nfig = qqplot(resid, line=&#39;q&#39;,ax=ax, fit=True)\n#最后用Ljung-Box检验:检验的结果就是看最后一列前十二行的检验概率（一般观察滞后1~12阶）\nr,q,p = sm.tsa.acf(resid.values.squeeze(),qstat=True)\ndata1 = np.c_[range(1,41), r[1:], q, p]\ntable= pd.DataFrame(data1, columns=[ &#39;lag&#39;,&#39;AC&#39;,&#39;Q&#39;,&#39;Prob(&gt;Q)&#39;])\nprint(table.set_index(&#39;lag&#39;))\n","like_count":4,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468774,"discussion_content":"Good Job，使用差分之后，再进行的ARMA模型","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577086525,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1372987,"avatar":"https://static001.geekbang.org/account/avatar/00/14/f3/3b/15ffb7c3.jpg","nickname":"胖陶","note":"","ucode":"EE32D91A3BC0F3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":37497,"discussion_content":"可以给一下完整代码吗谢谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571623938,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1474214,"avatar":"https://static001.geekbang.org/account/avatar/00/16/7e/a6/4e331ef4.jpg","nickname":"骑行的掌柜J","note":"","ucode":"3163102651C653","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1372987,"avatar":"https://static001.geekbang.org/account/avatar/00/14/f3/3b/15ffb7c3.jpg","nickname":"胖陶","note":"","ucode":"EE32D91A3BC0F3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":38820,"discussion_content":"https://blog.csdn.net/weixin_41013322/article/details/102710236 写在我博客里了 你去看看吧","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1571838093,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":37497,"ip_address":"","group_id":0},"score":38820,"extra":""}]}]},{"had_liked":false,"id":89570,"user_name":"滢","can_delete":false,"product_type":"c1","uid":1221511,"ip_address":"","ucode":"971A6F20AF3F9A","user_header":"https://static001.geekbang.org/account/avatar/00/12/a3/87/c415e370.jpg","comment_is_top":false,"comment_ctime":1556208860,"is_pvip":false,"replies":[{"id":64221,"content":"1）彩票这种用什么没有用，因为是完全随机性，找不到规律的，或者用规律解决不了问题\n2）ARMA 可以赋值个范围，让它在范围内自己来寻找适合的参数，一般超参数优化都是这样操作\n加油滢","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577614631,"ip_address":"","comment_id":89570,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100021701,"comment_content":"想问下老师，（1）对于类似于彩票这种类型的数据该用什么算法分析？（2）对于ARMA的最优只能人为赋值，循环检测最大值吗？若数据多的情况怎么办？ ","like_count":3,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448178,"discussion_content":"1）彩票这种用什么没有用，因为是完全随机性，找不到规律的，或者用规律解决不了问题\n2）ARMA 可以赋值个范围，让它在范围内自己来寻找适合的参数，一般超参数优化都是这样操作\n加油滢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577614631,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":134440,"user_name":"叁","can_delete":false,"product_type":"c1","uid":1589855,"ip_address":"","ucode":"4748BE1FD3CA3E","user_header":"https://static001.geekbang.org/account/avatar/00/18/42/5f/349b57f2.jpg","comment_is_top":false,"comment_ctime":1568831347,"is_pvip":false,"replies":[{"id":63496,"content":"可以使用ARIMA模型","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577514631,"ip_address":"","comment_id":134440,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100021701,"comment_content":"我觉得确实有些问题，在是同arma模型之前没有对数据平稳性检验，毕竟模型是基于平稳性的。","like_count":2,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467749,"discussion_content":"可以使用ARIMA模型","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577514631,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77227,"user_name":"Geek_hve78z","can_delete":false,"product_type":"c1","uid":1015045,"ip_address":"","ucode":"386803B8FC2DD5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7d/05/4bad0c7c.jpg","comment_is_top":false,"comment_ctime":1552892640,"is_pvip":false,"replies":[{"id":64406,"content":"很好的总结！","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577618430,"ip_address":"","comment_id":77227,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100021701,"comment_content":"AR、MA、ARMA和ARIMA模型区别\n\n1、AR （Auto Regressive），中文叫自回归模型，它认为过去若干时刻的点通过线性组合，再加上白噪声就可以预测未来某个时刻的点。AR 模型还存在一个阶数，称为 AR（p）模型，也叫作 p 阶自回归模型。它指的是通过这个时刻点的前 p 个点，通过线性组合再加上白噪声来预测当前时刻点的值。\n\n2、MA （ Moving Average），中文叫做滑动平均模型。MA 模型存在一个阶数，称为 MA(q) 模型，也叫作 q 阶移动平均模型。MA 模型是通过将一段时间序列中白噪声序列进行加权和。\n\n3、ARMA （ Auto Regressive Moving Average），中文叫做自回归滑动平均模型， ARMA 模型存在 p 和 q 两个阶数，称为 ARMA(p,q) 模型。\n\n4、ARIMA（ Auto Regressive Integrated Moving Average ），中文叫差分自回归滑动平均模型，也叫求合自回归滑动平均模型。相比于 ARMA，ARIMA 多了一个差分的过程，作用是对不平稳数据进行差分平稳，在差分平稳后再进行建模。ARIMA 是一个三元组的阶数 (p,d,q)，称为 ARIMA(p,d,q) 模型。其中 d 是差分阶数。","like_count":2,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443645,"discussion_content":"很好的总结！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577618430,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":210072,"user_name":"JustDoDT","can_delete":false,"product_type":"c1","uid":1127175,"ip_address":"","ucode":"6AF0B80F00EAEF","user_header":"https://static001.geekbang.org/account/avatar/00/11/33/07/8f351609.jpg","comment_is_top":false,"comment_ctime":1587661326,"is_pvip":false,"replies":[{"id":103974,"content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1617289830,"ip_address":"","comment_id":210072,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100021701,"comment_content":"交作业：快学完第一遍了，奥利给干了。\nhttps:&#47;&#47;github.com&#47;LearningChanging&#47;Data-analysis-in-action&#47;tree&#47;master&#47;41-%E6%95%B0%E6%8D%AE%E6%8C%96%E6%8E%98%E5%AE%9E%E6%88%98%EF%BC%883%EF%BC%89%EF%BC%9A%E5%A6%82%E4%BD%95%E5%AF%B9%E6%AF%94%E7%89%B9%E5%B8%81%E8%B5%B0%E5%8A%BF%E8%BF%9B%E8%A1%8C%E9%A2%84%E6%B5%8B%EF%BC%9F","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492934,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617289830,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":157848,"user_name":"Ronnyz","can_delete":false,"product_type":"c1","uid":1488280,"ip_address":"","ucode":"9F34527B1D343D","user_header":"https://static001.geekbang.org/account/avatar/00/16/b5/98/ffaf2aca.jpg","comment_is_top":false,"comment_ctime":1575269540,"is_pvip":false,"replies":[{"id":62630,"content":"Ronnyz同学整理的不错","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577078781,"ip_address":"","comment_id":157848,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100021701,"comment_content":"AR \n随机变量的取值是前p期的多元线性回归，认为主要受过去p期的序列值影响。误差项是当前的随机干扰，为零均值白噪声序列\nMA\n在t时刻的随机变量的取值是前q期的随机扰动的多元线性函数。误差项是当期的随机干扰,为零均值白噪声序列，是序列的均值。认为主要受过去q期的误差项影响。\nARMA\n随机变量的取值不仅与以前p期的序列值有关还与前q期的随机扰动有关。\nARIMA\n将ARMA和差分法结合，得到ARIMA(p,d,q)，其中d是需要对数据进行差分的阶数。\n\n\n#设置参数调整范围\np_scope=range(0,3)\nq_scope=range(0,3)\n最优模型：\nModel: \tARMA(2, 2)\nAIC \t4428.219","like_count":1},{"had_liked":false,"id":79448,"user_name":"TKbook","can_delete":false,"product_type":"c1","uid":1073829,"ip_address":"","ucode":"F6E0E99CC79059","user_header":"https://static001.geekbang.org/account/avatar/00/10/62/a5/43aa0c27.jpg","comment_is_top":false,"comment_ctime":1553484987,"is_pvip":false,"replies":[{"id":64361,"content":"Godo Job！","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577617763,"ip_address":"","comment_id":79448,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100021701,"comment_content":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nfrom statsmodels.tsa.arima_model import ARMA\nimport warnings\nfrom itertools import product\nfrom datetime import datetime\nwarnings.filterwarnings(&#39;ignore&#39;)\ndf = pd.read_csv(&#39;shanghai_1990-12-19_to_2019-2-28.csv&#39;)\ndf.index = pd.to_datetime(df.Timestamp)\ndf_month = df.resample(&#39;M&#39;).mean()\n# 设置参数范围\nps = range(0, 3)\nqs = range(0, 3)\nparameters = product(ps, qs)\nparameters_list = list(parameters)\n# 寻找最优ARMA模型参数，即best_aic最小\nresults = []\nbest_aic = float(&#39;inf&#39;) # 正无穷\nfor param in parameters_list:\n    try:\n        model = ARMA(df_month.Price, order=(param[0], param[1])).fit()\n    except ValueError:\n        print(&#39;参数错误：&#39;, param)\n        continue\n    aic = model.aic\n    if aic &lt; best_aic:\n        best_model = model\n        best_aic = aic\n        best_param = param\n    results.append([param, model.aic])\n# 输出最优模型\nresult_table = pd.DataFrame(results)\nresult_table.columns = [&#39;parameters&#39;, &#39;aic&#39;]\nprint(&#39;最优模型：&#39;, best_model.summary())\n# 股市预测\ndate_list = [datetime(2019, 3, 31), datetime(2019, 4, 30), datetime(2019, 5, 31), datetime(2019, 6, 30),\n             datetime(2019, 7, 31), datetime(2019, 8, 31), datetime(2019, 9, 30), datetime(2019, 10, 31),\n             datetime(2019, 11, 30), datetime(2019, 12, 31)]\nfuture = pd.DataFrame(index=date_list, columns=df_month.columns)\ndf_month = pd.concat([df_month, future])\ndf_month[&#39;forecast&#39;] = best_model.predict(start=0, end=348)\n# 预测结果显示\nplt.figure(figsize=(20, 7))\ndf_month.Price.plot(label=&#39;实际指数&#39;)\ndf_month.forecast.plot(color=&#39;r&#39;, ls=&#39;--&#39;, label=&#39;预测指数&#39;)\nplt.legend()\nplt.title(&#39;金额（月）&#39;)\nplt.xlabel(&#39;TIME&#39;)\nplt.ylabel(&#39;RMB&#39;)\nplt.show()","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476551,"discussion_content":"Ronnyz同学整理的不错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577078781,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":267579,"user_name":"非同凡想","can_delete":false,"product_type":"c1","uid":1934969,"ip_address":"","ucode":"713FD449A49D5A","user_header":"https://static001.geekbang.org/account/avatar/00/1d/86/79/066a062a.jpg","comment_is_top":false,"comment_ctime":1607833621,"is_pvip":false,"replies":[{"id":100889,"content":"继续坚持~","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1612706435,"ip_address":"","comment_id":267579,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100021701,"comment_content":"### best param (4,3)\n\nimport pandas as pd\nfrom datetime import datetime\nfrom statsmodels.tsa.arima_model import ARMA\nimport warnings\nimport matplotlib.pyplot as  plt\nfrom itertools import product\n\nwarnings.filterwarnings(&#39;ignore&#39;)\ndata = pd.read_csv(&#39;~&#47;Documents&#47;bitcoin&#47;shanghai_1990-12-19_to_2019-2-28.csv&#39;)\nprint(data.head())\nprint(data.info())\n\ndata[&#39;Timestamp&#39;] = pd.to_datetime(data[&#39;Timestamp&#39;])\ndata.index = data[&#39;Timestamp&#39;]\nprint(data.head())\ndata_m = data.resample(&#39;M&#39;).mean()\n\nq_range = range(0, 5)\np_range = range(0, 5)\nparams = product(q_range, p_range)\nparam_list = list(params)\n# print(param_list)\nresults = []\nbest_aic = float(&#39;inf&#39;)\n\nfor param in param_list:\n    try:\n        model = ARMA(data_m[&#39;Price&#39;], order=(param[0], param[1])).fit()\n    except ValueError:\n        print(&quot;参数错误&quot;, param)\n        continue\n    aic = model.aic\n    if aic &lt; best_aic:\n        best_model = model\n        best_aic = aic\n        best_param = param\n    results.append([param, model.aic])\n\nresult_table = pd.DataFrame(results)\nresult_table.columns = [&#39;parameters&#39;, &#39;aic&#39;]\n\nprint(&quot;best model:&quot;, best_model.summary())\nprint(&quot;best param:&quot;, best_param)\ndata_month2 = data_m[[&#39;Price&#39;]]\ndate_list = [datetime(2019, 3, 31), datetime(2019, 4, 30), datetime(2019, 5, 31), datetime(2019, 6, 30),\n             datetime(2019, 7, 31),\n             datetime(2019, 8, 31), datetime(2019, 9, 30), datetime(2019, 10, 31), datetime(2019, 11, 30),\n             datetime(2019, 12, 31)]\nfuture = pd.DataFrame(index=date_list, columns=data_m.columns)\ndata_month2 = pd.concat([data_month2, future])\ndata_month2[&#39;forecast&#39;] = best_model.predict(start=0, end=384)\n#start=0表示从第0个数据开始计算\n#end=348是指需要计算348个数据，即从1990-12-19到2019-12-31一共有348个月，所以有348个数据\nprint(data_month2.head())\nplt.figure(figsize=(20, 7))\nplt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;]\ndata_month2[&#39;Price&#39;].plot(label=&#39;实际指数&#39;)\ndata_month2[&#39;forecast&#39;].plot(label=&#39;预测指数&#39;, ls=&#39;--&#39;, color=&#39;r&#39;)\nplt.legend()\nplt.title(&#39;沪市指数（月）&#39;)\nplt.xlabel(&#39;时间&#39;)\nplt.ylabel(&#39;指数&#39;)\nplt.show()","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444502,"discussion_content":"Godo Job！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577617763,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":230848,"user_name":"建强","can_delete":false,"product_type":"c1","uid":1397126,"ip_address":"","ucode":"62B03D0E0C64EC","user_header":"https://static001.geekbang.org/account/avatar/00/15/51/86/b5fd8dd8.jpg","comment_is_top":false,"comment_ctime":1593509912,"is_pvip":false,"replies":[{"id":103708,"content":"出现负值说明拟合的太好了，有些明显的过度拟合，这在建模过程中是一种并不好的情况，应考虑数据中存在更深层次的关系，重新设定模型形式，否则模型缺少泛化能力","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1617034459,"ip_address":"","comment_id":230848,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100021701,"comment_content":"请问老师，我用您的方法寻找最优模型时，最后得到的模型AIC是小于0的，这是怎么回事？是不是因为我的数据序列值都是小于1的原因？最终的输出结果是这样的：\n最优模型:                                ARMA Model Results                              \n==============================================================================\nDep. Variable:                   风险系数   No. Observations:                  216\nModel:                     ARMA(1, 1)   Log Likelihood                 364.911\nMethod:                       css-mle   S.D. of innovations              0.044\nDate:                Tue, 30 Jun 2020   AIC                           -721.823\nTime:                        17:37:35   BIC                           -708.322\nSample:                             0   HQIC                          -716.368\n                                                                              \n==============================================================================\n                 coef    std err          z      P&gt;|z|      [0.025      0.975]\n------------------------------------------------------------------------------\nconst          0.4613      0.072      6.415      0.000       0.320       0.602\nar.L1.风险系数     0.9773      0.023     42.940      0.000       0.933       1.022\nma.L1.风险系数    -0.4586      0.070     -6.583      0.000      -0.595      -0.322\n                                    Roots                                    \n=============================================================================\n                  Real          Imaginary           Modulus         Frequency\n-----------------------------------------------------------------------------\nAR.1            1.0232           +0.0000j            1.0232            0.0000\nMA.1            2.1805           +0.0000j            2.1805            0.0000\n-----------------------------------------------------------------------------","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511683,"discussion_content":"继续坚持~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612706435,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89723,"user_name":"滢","can_delete":false,"product_type":"c1","uid":1221511,"ip_address":"","ucode":"971A6F20AF3F9A","user_header":"https://static001.geekbang.org/account/avatar/00/12/a3/87/c415e370.jpg","comment_is_top":false,"comment_ctime":1556250003,"is_pvip":false,"replies":[{"id":64218,"content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577614452,"ip_address":"","comment_id":89723,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100021701,"comment_content":"A股预测，语言Python3.6 ，最佳模型ARMA(5, 4)，设置的范围稍大，得到的结果还蛮接近，可以设置的再大一些，不过数据优点多跑起来时间较长。\n#数据加载\npath = &#39;&#47;Users&#47;apple&#47;Desktop&#47;GitHubProject&#47;Read mark&#47;数据分析&#47;geekTime&#47;data&#47;&#39;\ndf = pd.read_csv(path + &#39;shanghai_1990-12-19_to_2019-2-28.csv&#39;)\n#将时间作为df的索引\ndf.Timestamp = pd.to_datetime(df.Timestamp)\ndf.index = df.Timestamp\n#数据探索\nprint(df.head())\ndf_month = df.resample(&#39;M&#39;).mean()\nprint(df_month.head())\n\n#按照天、月、季度、年显示A股走势\nfig = plt.figure(figsize=[15,7])\nplt.rcParams[&#39;font.sans-serif&#39;]=[&#39;SimHei&#39;]\nplt.suptitle(&#39;A股指数&#39;,fontsize = 18.0)\nplt.plot(df_month.Price, &#39;-&#39;, label =&#39;按月&#39;)\nplt.legend()\nplt.show()\n\n#设置参数范围\nps = range(0,7)\nqs = range(0,7)\nparameters = product(ps,qs)\nparameters_list = list(parameters)\n#寻找最优ARMA模型参数，aic最小\nresults = []\nbest_aic = float(&quot;inf&quot;)\nfor param in parameters_list:\n    try:\n        model = ARMA(df_month.Price,order=(param[0],param[1])).fit()\n    except ValueError:\n        print(&#39;参数错误:&#39;,param)\n        continue\n    aic = model.aic\n    if aic &lt; best_aic:\n        best_model = model\n        best_aic=aic\n        best_param = param\n    results.append([param,model.aic])\n\n#输出最优模型\nresult_table = pd.DataFrame(results)\nresult_table.columns = [&#39;parameters&#39;,&#39;aic&#39;]\nprint(&#39;最佳模型:&#39;,best_model.summary())\n#A股预测\ndf_month_value = df_month[[&#39;Price&#39;]]\ndate_list = [datetime(2019,3,31),datetime(2019,4,30),datetime(2019,5,31),\n             datetime(2019,6,30),datetime(2019,7,31),datetime(2019,8,31),\n             datetime(2019,9,30),datetime(2019,10,31),datetime(2019,11,30),\n             datetime(2019,12,31)]\nfuture = pd.DataFrame(index=date_list,columns=df_month.columns)\ndf_month_value = pd.concat([df_month_value,future])\ndf_month_value[&#39;forecast&#39;]=best_model.predict(start=0, end=348)\n#A股预测结果展示\nplt.figure(figsize=(20,7))\ndf_month_value.Price.plot(label=&#39;实际金额&#39;)\ndf_month_value.forecast.plot(color=&#39;r&#39;, ls=&#39;--&#39;, label=&#39;预测金额&#39;)\nplt.legend()\nplt.title(&#39;A股金额（月）&#39;)\nplt.xlabel(&#39;时间&#39;)\nplt.ylabel(&#39;指数&#39;)\nplt.show()","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500056,"discussion_content":"出现负值说明拟合的太好了，有些明显的过度拟合，这在建模过程中是一种并不好的情况，应考虑数据中存在更深层次的关系，重新设定模型形式，否则模型缺少泛化能力","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617034459,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":80089,"user_name":"Geek_dancer","can_delete":false,"product_type":"c1","uid":1440561,"ip_address":"","ucode":"F66D454E58E35E","user_header":"https://static001.geekbang.org/account/avatar/00/15/fb/31/f0a884a3.jpg","comment_is_top":false,"comment_ctime":1553603832,"is_pvip":false,"replies":[{"id":64353,"content":"对 你可以先看下是否是平稳序列，如果不是的话，就需要先做差分，也可以直接使用ARIMA","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577617472,"ip_address":"","comment_id":80089,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100021701,"comment_content":"老师，ARMA是完全根据过去时序中的数据走势规律来进行预测的吗？但是大部分预测还是会受其他特征属性的影响，从而影响其走势还有波动。我用ARMA做了电力系统的负荷预测，对比了之前用SVM做的预测，感觉ARMA的预测测精度相当低，预测曲线基本就是一个一次线性曲线，有一个大概的趋势，负荷的周期波动性完全没有体现。请问这是ARMA的局限性决定的，还是我没有训练好啊。","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448235,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577614452,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78459,"user_name":"szm","can_delete":false,"product_type":"c1","uid":1352697,"ip_address":"","ucode":"53E753D3D04431","user_header":"https://static001.geekbang.org/account/avatar/00/14/a3/f9/9180d6d1.jpg","comment_is_top":false,"comment_ctime":1553153673,"is_pvip":false,"replies":[{"id":64388,"content":"GridSearchCV 用于sklearn库中的模型","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577618196,"ip_address":"","comment_id":78459,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100021701,"comment_content":"我看老师在挑选最有参数时用的是轮询办法，39章信用卡违约率分析中讲的GridSearch可以在这里使用吗？还是GridSearch只能用于sklearn库中的分类算法？","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444746,"discussion_content":"对 你可以先看下是否是平稳序列，如果不是的话，就需要先做差分，也可以直接使用ARIMA","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577617472,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77858,"user_name":"白夜","can_delete":false,"product_type":"c1","uid":1354449,"ip_address":"","ucode":"7AABFA7C04EA34","user_header":"https://static001.geekbang.org/account/avatar/00/14/aa/d1/076482f3.jpg","comment_is_top":false,"comment_ctime":1553008171,"is_pvip":false,"replies":[{"id":64396,"content":"有涨有跌 此时此刻是2019年12月29日，当前沪市指数为3005.04点，你说准不准","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577618321,"ip_address":"","comment_id":77858,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100021701,"comment_content":"2019-03-31    2808.787904\n2019-04-30    2881.416121\n2019-05-31    2875.788248\n2019-06-30    2885.653128\n2019-07-31    2959.346386\n2019-08-31    3003.165403\n2019-09-30    2991.057003\n2019-10-31    2995.312025\n2019-11-30    3016.652431\n2019-12-31    2997.065752\n这是看涨啊","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443876,"discussion_content":"有涨有跌 此时此刻是2019年12月29日，当前沪市指数为3005.04点，你说准不准","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577618321,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77352,"user_name":"Grandia_Z","can_delete":false,"product_type":"c1","uid":1354034,"ip_address":"","ucode":"4928A7ABA7C24C","user_header":"https://static001.geekbang.org/account/avatar/00/14/a9/32/eb71b457.jpg","comment_is_top":false,"comment_ctime":1552910841,"is_pvip":false,"replies":[{"id":64403,"content":"你可以写个程序来作为data_list的输入","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577618407,"ip_address":"","comment_id":77352,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100021701,"comment_content":"提问:对未来十个月的变化进行统计,如果按日统计的话:\ndate_list= [datetime(2019, 3, 31), datetime(2019, 4, 30), datetime(2019, 5, 31), datetime(2019, 6, 30), datetime(2019, 7, 31),\n             datetime(2019, 8, 31), datetime(2019, 9, 30), datetime(2019, 10, 31),datetime(2019, 11, 30),datetime(2019, 12, 31)]\n上面这段怎么写能包含从(2019.3.1-2019.12.31)的数据呢,不会把每一天都写进去吧","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443876,"discussion_content":"有涨有跌 此时此刻是2019年12月29日，当前沪市指数为3005.04点，你说准不准","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577618321,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":87968,"user_name":"钟朗🐾","can_delete":false,"product_type":"c1","uid":1486985,"ip_address":"","ucode":"21754885DD2045","user_header":"https://static001.geekbang.org/account/avatar/00/16/b0/89/2c3d5d7a.jpg","comment_is_top":false,"comment_ctime":1555769857,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100021701,"comment_content":"老师，为什么这个没有对数据进行单位根检验和白噪声检验，这样会不会粗暴了点尼","like_count":19,"discussions":[{"author":{"id":1486681,"avatar":"https://static001.geekbang.org/account/avatar/00/16/af/59/84aedd2f.jpg","nickname":"小狮子(*¯︶¯*)","note":"","ucode":"EF8095CCD06D15","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":164958,"discussion_content":"我觉得是错的，预测数据差不多应该是蒙对了","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1581242866,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":157848,"user_name":"Ronnyz","can_delete":false,"product_type":"c1","uid":1488280,"ip_address":"","ucode":"9F34527B1D343D","user_header":"https://static001.geekbang.org/account/avatar/00/16/b5/98/ffaf2aca.jpg","comment_is_top":false,"comment_ctime":1575269540,"is_pvip":false,"replies":[{"id":62630,"content":"Ronnyz同学整理的不错","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577078781,"ip_address":"","comment_id":157848,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100021701,"comment_content":"AR \n随机变量的取值是前p期的多元线性回归，认为主要受过去p期的序列值影响。误差项是当前的随机干扰，为零均值白噪声序列\nMA\n在t时刻的随机变量的取值是前q期的随机扰动的多元线性函数。误差项是当期的随机干扰,为零均值白噪声序列，是序列的均值。认为主要受过去q期的误差项影响。\nARMA\n随机变量的取值不仅与以前p期的序列值有关还与前q期的随机扰动有关。\nARIMA\n将ARMA和差分法结合，得到ARIMA(p,d,q)，其中d是需要对数据进行差分的阶数。\n\n\n#设置参数调整范围\np_scope=range(0,3)\nq_scope=range(0,3)\n最优模型：\nModel: \tARMA(2, 2)\nAIC \t4428.219","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476551,"discussion_content":"Ronnyz同学整理的不错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577078781,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79448,"user_name":"TKbook","can_delete":false,"product_type":"c1","uid":1073829,"ip_address":"","ucode":"F6E0E99CC79059","user_header":"https://static001.geekbang.org/account/avatar/00/10/62/a5/43aa0c27.jpg","comment_is_top":false,"comment_ctime":1553484987,"is_pvip":false,"replies":[{"id":64361,"content":"Godo Job！","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577617763,"ip_address":"","comment_id":79448,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100021701,"comment_content":"import numpy as np\nimport pandas as pd\nimport matplotlib.pyplot as plt\nfrom statsmodels.tsa.arima_model import ARMA\nimport warnings\nfrom itertools import product\nfrom datetime import datetime\nwarnings.filterwarnings(&#39;ignore&#39;)\ndf = pd.read_csv(&#39;shanghai_1990-12-19_to_2019-2-28.csv&#39;)\ndf.index = pd.to_datetime(df.Timestamp)\ndf_month = df.resample(&#39;M&#39;).mean()\n# 设置参数范围\nps = range(0, 3)\nqs = range(0, 3)\nparameters = product(ps, qs)\nparameters_list = list(parameters)\n# 寻找最优ARMA模型参数，即best_aic最小\nresults = []\nbest_aic = float(&#39;inf&#39;) # 正无穷\nfor param in parameters_list:\n    try:\n        model = ARMA(df_month.Price, order=(param[0], param[1])).fit()\n    except ValueError:\n        print(&#39;参数错误：&#39;, param)\n        continue\n    aic = model.aic\n    if aic &lt; best_aic:\n        best_model = model\n        best_aic = aic\n        best_param = param\n    results.append([param, model.aic])\n# 输出最优模型\nresult_table = pd.DataFrame(results)\nresult_table.columns = [&#39;parameters&#39;, &#39;aic&#39;]\nprint(&#39;最优模型：&#39;, best_model.summary())\n# 股市预测\ndate_list = [datetime(2019, 3, 31), datetime(2019, 4, 30), datetime(2019, 5, 31), datetime(2019, 6, 30),\n             datetime(2019, 7, 31), datetime(2019, 8, 31), datetime(2019, 9, 30), datetime(2019, 10, 31),\n             datetime(2019, 11, 30), datetime(2019, 12, 31)]\nfuture = pd.DataFrame(index=date_list, columns=df_month.columns)\ndf_month = pd.concat([df_month, future])\ndf_month[&#39;forecast&#39;] = best_model.predict(start=0, end=348)\n# 预测结果显示\nplt.figure(figsize=(20, 7))\ndf_month.Price.plot(label=&#39;实际指数&#39;)\ndf_month.forecast.plot(color=&#39;r&#39;, ls=&#39;--&#39;, label=&#39;预测指数&#39;)\nplt.legend()\nplt.title(&#39;金额（月）&#39;)\nplt.xlabel(&#39;TIME&#39;)\nplt.ylabel(&#39;RMB&#39;)\nplt.show()","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444502,"discussion_content":"Godo Job！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577617763,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":267579,"user_name":"非同凡想","can_delete":false,"product_type":"c1","uid":1934969,"ip_address":"","ucode":"713FD449A49D5A","user_header":"https://static001.geekbang.org/account/avatar/00/1d/86/79/066a062a.jpg","comment_is_top":false,"comment_ctime":1607833621,"is_pvip":false,"replies":[{"id":100889,"content":"继续坚持~","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1612706435,"ip_address":"","comment_id":267579,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100021701,"comment_content":"### best param (4,3)\n\nimport pandas as pd\nfrom datetime import datetime\nfrom statsmodels.tsa.arima_model import ARMA\nimport warnings\nimport matplotlib.pyplot as  plt\nfrom itertools import product\n\nwarnings.filterwarnings(&#39;ignore&#39;)\ndata = pd.read_csv(&#39;~&#47;Documents&#47;bitcoin&#47;shanghai_1990-12-19_to_2019-2-28.csv&#39;)\nprint(data.head())\nprint(data.info())\n\ndata[&#39;Timestamp&#39;] = pd.to_datetime(data[&#39;Timestamp&#39;])\ndata.index = data[&#39;Timestamp&#39;]\nprint(data.head())\ndata_m = data.resample(&#39;M&#39;).mean()\n\nq_range = range(0, 5)\np_range = range(0, 5)\nparams = product(q_range, p_range)\nparam_list = list(params)\n# print(param_list)\nresults = []\nbest_aic = float(&#39;inf&#39;)\n\nfor param in param_list:\n    try:\n        model = ARMA(data_m[&#39;Price&#39;], order=(param[0], param[1])).fit()\n    except ValueError:\n        print(&quot;参数错误&quot;, param)\n        continue\n    aic = model.aic\n    if aic &lt; best_aic:\n        best_model = model\n        best_aic = aic\n        best_param = param\n    results.append([param, model.aic])\n\nresult_table = pd.DataFrame(results)\nresult_table.columns = [&#39;parameters&#39;, &#39;aic&#39;]\n\nprint(&quot;best model:&quot;, best_model.summary())\nprint(&quot;best param:&quot;, best_param)\ndata_month2 = data_m[[&#39;Price&#39;]]\ndate_list = [datetime(2019, 3, 31), datetime(2019, 4, 30), datetime(2019, 5, 31), datetime(2019, 6, 30),\n             datetime(2019, 7, 31),\n             datetime(2019, 8, 31), datetime(2019, 9, 30), datetime(2019, 10, 31), datetime(2019, 11, 30),\n             datetime(2019, 12, 31)]\nfuture = pd.DataFrame(index=date_list, columns=data_m.columns)\ndata_month2 = pd.concat([data_month2, future])\ndata_month2[&#39;forecast&#39;] = best_model.predict(start=0, end=384)\n#start=0表示从第0个数据开始计算\n#end=348是指需要计算348个数据，即从1990-12-19到2019-12-31一共有348个月，所以有348个数据\nprint(data_month2.head())\nplt.figure(figsize=(20, 7))\nplt.rcParams[&#39;font.sans-serif&#39;] = [&#39;SimHei&#39;]\ndata_month2[&#39;Price&#39;].plot(label=&#39;实际指数&#39;)\ndata_month2[&#39;forecast&#39;].plot(label=&#39;预测指数&#39;, ls=&#39;--&#39;, color=&#39;r&#39;)\nplt.legend()\nplt.title(&#39;沪市指数（月）&#39;)\nplt.xlabel(&#39;时间&#39;)\nplt.ylabel(&#39;指数&#39;)\nplt.show()","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511683,"discussion_content":"继续坚持~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612706435,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":230848,"user_name":"建强","can_delete":false,"product_type":"c1","uid":1397126,"ip_address":"","ucode":"62B03D0E0C64EC","user_header":"https://static001.geekbang.org/account/avatar/00/15/51/86/b5fd8dd8.jpg","comment_is_top":false,"comment_ctime":1593509912,"is_pvip":false,"replies":[{"id":103708,"content":"出现负值说明拟合的太好了，有些明显的过度拟合，这在建模过程中是一种并不好的情况，应考虑数据中存在更深层次的关系，重新设定模型形式，否则模型缺少泛化能力","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1617034459,"ip_address":"","comment_id":230848,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100021701,"comment_content":"请问老师，我用您的方法寻找最优模型时，最后得到的模型AIC是小于0的，这是怎么回事？是不是因为我的数据序列值都是小于1的原因？最终的输出结果是这样的：\n最优模型:                                ARMA Model Results                              \n==============================================================================\nDep. Variable:                   风险系数   No. Observations:                  216\nModel:                     ARMA(1, 1)   Log Likelihood                 364.911\nMethod:                       css-mle   S.D. of innovations              0.044\nDate:                Tue, 30 Jun 2020   AIC                           -721.823\nTime:                        17:37:35   BIC                           -708.322\nSample:                             0   HQIC                          -716.368\n                                                                              \n==============================================================================\n                 coef    std err          z      P&gt;|z|      [0.025      0.975]\n------------------------------------------------------------------------------\nconst          0.4613      0.072      6.415      0.000       0.320       0.602\nar.L1.风险系数     0.9773      0.023     42.940      0.000       0.933       1.022\nma.L1.风险系数    -0.4586      0.070     -6.583      0.000      -0.595      -0.322\n                                    Roots                                    \n=============================================================================\n                  Real          Imaginary           Modulus         Frequency\n-----------------------------------------------------------------------------\nAR.1            1.0232           +0.0000j            1.0232            0.0000\nMA.1            2.1805           +0.0000j            2.1805            0.0000\n-----------------------------------------------------------------------------","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500056,"discussion_content":"出现负值说明拟合的太好了，有些明显的过度拟合，这在建模过程中是一种并不好的情况，应考虑数据中存在更深层次的关系，重新设定模型形式，否则模型缺少泛化能力","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617034459,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89723,"user_name":"滢","can_delete":false,"product_type":"c1","uid":1221511,"ip_address":"","ucode":"971A6F20AF3F9A","user_header":"https://static001.geekbang.org/account/avatar/00/12/a3/87/c415e370.jpg","comment_is_top":false,"comment_ctime":1556250003,"is_pvip":false,"replies":[{"id":64218,"content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577614452,"ip_address":"","comment_id":89723,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100021701,"comment_content":"A股预测，语言Python3.6 ，最佳模型ARMA(5, 4)，设置的范围稍大，得到的结果还蛮接近，可以设置的再大一些，不过数据优点多跑起来时间较长。\n#数据加载\npath = &#39;&#47;Users&#47;apple&#47;Desktop&#47;GitHubProject&#47;Read mark&#47;数据分析&#47;geekTime&#47;data&#47;&#39;\ndf = pd.read_csv(path + &#39;shanghai_1990-12-19_to_2019-2-28.csv&#39;)\n#将时间作为df的索引\ndf.Timestamp = pd.to_datetime(df.Timestamp)\ndf.index = df.Timestamp\n#数据探索\nprint(df.head())\ndf_month = df.resample(&#39;M&#39;).mean()\nprint(df_month.head())\n\n#按照天、月、季度、年显示A股走势\nfig = plt.figure(figsize=[15,7])\nplt.rcParams[&#39;font.sans-serif&#39;]=[&#39;SimHei&#39;]\nplt.suptitle(&#39;A股指数&#39;,fontsize = 18.0)\nplt.plot(df_month.Price, &#39;-&#39;, label =&#39;按月&#39;)\nplt.legend()\nplt.show()\n\n#设置参数范围\nps = range(0,7)\nqs = range(0,7)\nparameters = product(ps,qs)\nparameters_list = list(parameters)\n#寻找最优ARMA模型参数，aic最小\nresults = []\nbest_aic = float(&quot;inf&quot;)\nfor param in parameters_list:\n    try:\n        model = ARMA(df_month.Price,order=(param[0],param[1])).fit()\n    except ValueError:\n        print(&#39;参数错误:&#39;,param)\n        continue\n    aic = model.aic\n    if aic &lt; best_aic:\n        best_model = model\n        best_aic=aic\n        best_param = param\n    results.append([param,model.aic])\n\n#输出最优模型\nresult_table = pd.DataFrame(results)\nresult_table.columns = [&#39;parameters&#39;,&#39;aic&#39;]\nprint(&#39;最佳模型:&#39;,best_model.summary())\n#A股预测\ndf_month_value = df_month[[&#39;Price&#39;]]\ndate_list = [datetime(2019,3,31),datetime(2019,4,30),datetime(2019,5,31),\n             datetime(2019,6,30),datetime(2019,7,31),datetime(2019,8,31),\n             datetime(2019,9,30),datetime(2019,10,31),datetime(2019,11,30),\n             datetime(2019,12,31)]\nfuture = pd.DataFrame(index=date_list,columns=df_month.columns)\ndf_month_value = pd.concat([df_month_value,future])\ndf_month_value[&#39;forecast&#39;]=best_model.predict(start=0, end=348)\n#A股预测结果展示\nplt.figure(figsize=(20,7))\ndf_month_value.Price.plot(label=&#39;实际金额&#39;)\ndf_month_value.forecast.plot(color=&#39;r&#39;, ls=&#39;--&#39;, label=&#39;预测金额&#39;)\nplt.legend()\nplt.title(&#39;A股金额（月）&#39;)\nplt.xlabel(&#39;时间&#39;)\nplt.ylabel(&#39;指数&#39;)\nplt.show()","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448235,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577614452,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":80089,"user_name":"Geek_dancer","can_delete":false,"product_type":"c1","uid":1440561,"ip_address":"","ucode":"F66D454E58E35E","user_header":"https://static001.geekbang.org/account/avatar/00/15/fb/31/f0a884a3.jpg","comment_is_top":false,"comment_ctime":1553603832,"is_pvip":false,"replies":[{"id":64353,"content":"对 你可以先看下是否是平稳序列，如果不是的话，就需要先做差分，也可以直接使用ARIMA","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577617472,"ip_address":"","comment_id":80089,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100021701,"comment_content":"老师，ARMA是完全根据过去时序中的数据走势规律来进行预测的吗？但是大部分预测还是会受其他特征属性的影响，从而影响其走势还有波动。我用ARMA做了电力系统的负荷预测，对比了之前用SVM做的预测，感觉ARMA的预测测精度相当低，预测曲线基本就是一个一次线性曲线，有一个大概的趋势，负荷的周期波动性完全没有体现。请问这是ARMA的局限性决定的，还是我没有训练好啊。","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444746,"discussion_content":"对 你可以先看下是否是平稳序列，如果不是的话，就需要先做差分，也可以直接使用ARIMA","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577617472,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78459,"user_name":"szm","can_delete":false,"product_type":"c1","uid":1352697,"ip_address":"","ucode":"53E753D3D04431","user_header":"https://static001.geekbang.org/account/avatar/00/14/a3/f9/9180d6d1.jpg","comment_is_top":false,"comment_ctime":1553153673,"is_pvip":false,"replies":[{"id":64388,"content":"GridSearchCV 用于sklearn库中的模型","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577618196,"ip_address":"","comment_id":78459,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100021701,"comment_content":"我看老师在挑选最有参数时用的是轮询办法，39章信用卡违约率分析中讲的GridSearch可以在这里使用吗？还是GridSearch只能用于sklearn库中的分类算法？","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444101,"discussion_content":"GridSearchCV 用于sklearn库中的模型","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577618196,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77858,"user_name":"白夜","can_delete":false,"product_type":"c1","uid":1354449,"ip_address":"","ucode":"7AABFA7C04EA34","user_header":"https://static001.geekbang.org/account/avatar/00/14/aa/d1/076482f3.jpg","comment_is_top":false,"comment_ctime":1553008171,"is_pvip":false,"replies":[{"id":64396,"content":"有涨有跌 此时此刻是2019年12月29日，当前沪市指数为3005.04点，你说准不准","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577618321,"ip_address":"","comment_id":77858,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100021701,"comment_content":"2019-03-31    2808.787904\n2019-04-30    2881.416121\n2019-05-31    2875.788248\n2019-06-30    2885.653128\n2019-07-31    2959.346386\n2019-08-31    3003.165403\n2019-09-30    2991.057003\n2019-10-31    2995.312025\n2019-11-30    3016.652431\n2019-12-31    2997.065752\n这是看涨啊","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444101,"discussion_content":"GridSearchCV 用于sklearn库中的模型","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577618196,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77352,"user_name":"Grandia_Z","can_delete":false,"product_type":"c1","uid":1354034,"ip_address":"","ucode":"4928A7ABA7C24C","user_header":"https://static001.geekbang.org/account/avatar/00/14/a9/32/eb71b457.jpg","comment_is_top":false,"comment_ctime":1552910841,"is_pvip":false,"replies":[{"id":64403,"content":"你可以写个程序来作为data_list的输入","user_name":"作者回复","user_name_real":"cy","uid":1306094,"ctime":1577618407,"ip_address":"","comment_id":77352,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100021701,"comment_content":"提问:对未来十个月的变化进行统计,如果按日统计的话:\ndate_list= [datetime(2019, 3, 31), datetime(2019, 4, 30), datetime(2019, 5, 31), datetime(2019, 6, 30), datetime(2019, 7, 31),\n             datetime(2019, 8, 31), datetime(2019, 9, 30), datetime(2019, 10, 31),datetime(2019, 11, 30),datetime(2019, 12, 31)]\n上面这段怎么写能包含从(2019.3.1-2019.12.31)的数据呢,不会把每一天都写进去吧","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443694,"discussion_content":"你可以写个程序来作为data_list的输入","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577618407,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1209322,"avatar":"https://static001.geekbang.org/account/avatar/00/12/73/ea/9c9acc43.jpg","nickname":"Jackom","note":"","ucode":"166111CDB92469","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":216282,"discussion_content":"date_range_ = pd.date_range(start=&#39;2019-03-01&#39;, end=&#39;2019-12-31&#39;, freq=&#39;M&#39;)\ndate_list_ = date_range_.to_list() #或者 date_range_.to_series()\nfuture_date = pd.DataFrame(index=date_list_, columns= df_month.columns)","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585411695,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":87968,"user_name":"钟朗🐾","can_delete":false,"product_type":"c1","uid":1486985,"ip_address":"","ucode":"21754885DD2045","user_header":"https://static001.geekbang.org/account/avatar/00/16/b0/89/2c3d5d7a.jpg","comment_is_top":false,"comment_ctime":1555769857,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100021701,"comment_content":"老师，为什么这个没有对数据进行单位根检验和白噪声检验，这样会不会粗暴了点尼","like_count":19,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443694,"discussion_content":"你可以写个程序来作为data_list的输入","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577618407,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1209322,"avatar":"https://static001.geekbang.org/account/avatar/00/12/73/ea/9c9acc43.jpg","nickname":"Jackom","note":"","ucode":"166111CDB92469","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":216282,"discussion_content":"date_range_ = pd.date_range(start=&#39;2019-03-01&#39;, end=&#39;2019-12-31&#39;, freq=&#39;M&#39;)\ndate_list_ = date_range_.to_list() #或者 date_range_.to_series()\nfuture_date = pd.DataFrame(index=date_list_, columns= df_month.columns)","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585411695,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77416,"user_name":"堂吉诃德","can_delete":false,"product_type":"c1","uid":1357227,"ip_address":"","ucode":"6A6D3D4866729B","user_header":"https://static001.geekbang.org/account/avatar/00/14/b5/ab/30e1531e.jpg","comment_is_top":false,"comment_ctime":1552921042,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100021701,"comment_content":"1. parameters = product(ps, qs) \nparameters为可迭代对象, 直接使用\nfor param in parameters:  \n不用再转为列表吧?\n\n2. 回答一下 @Grandia_Z \n时间序列操作\ndate_list = pd.date_range(&#39;2019-03-31&#39;, &#39;2019-12-31&#39;, periods=None, freq=&#39;D&#39;)\n希望你能看到","like_count":3},{"had_liked":false,"id":389782,"user_name":"yanyu-xin","can_delete":false,"product_type":"c1","uid":1899757,"ip_address":"广东","ucode":"3AA389F9E4C236","user_header":"","comment_is_top":false,"comment_ctime":1713447042,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100021701,"comment_content":"遇到的 NotImplementedError 异常提示正在使用的 statsmodels (0.14.1) 版本中已经移除了 ARMA 和 ARIMA 模型，取而代之的是 statsmodels.tsa.arima.model.ARIMA 和 statsmodels.tsa.SARIMAX。为了解决这个问题，将 ARMA 替换为 ARIMA，注意类名的变化。使用新的 ARIMA 类来拟合模型。\n将代码：\nfrom statsmodels.tsa.arma.model import ARMA \nmodel = ARMA(df_month.Weighted_Price, order=(param[0], param[1])).fit()\n改为：\nfrom statsmodels.tsa.arima.model import ARIMA\nmodel = ARIMA(df_month.Weighted_Price, order=(param[0], 0, param[1])).fit()\n\n注意：ARIMA 需要三个参数：p（AR的阶数），d（差分次数），q（MA的阶数）\n在 ARMA 模型中，d 通常设置为 0，因为 ARMA 不涉及差分\n请注意，ARIMA 模型实际上包含了 ARMA 模型的功能，但是增加了差分（d）的选项，允许您处理非平稳时间序列。在您的代码中，如果您的数据已经是平稳的，那么 d 应该设置为 0。\n如果您想要继续使用 ARMA 模型而不考虑差分，您可以使用 ARIMA 类，并将 d 参数设置为 0。如果需要使用差分，请确保在建模之前对数据进行适当的差分处理。","like_count":1},{"had_liked":false,"id":374986,"user_name":"Casper","can_delete":false,"product_type":"c1","uid":1038115,"ip_address":"马来西亚","ucode":"D6BF9612491BA3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d7/23/d195075d.jpg","comment_is_top":false,"comment_ctime":1684757192,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100021701,"comment_content":"这个代码都老了 现在都运行不了了","like_count":1},{"had_liked":false,"id":365708,"user_name":"Geek_3e33b6","can_delete":false,"product_type":"c1","uid":2990931,"ip_address":"四川","ucode":"E24206E1679177","user_header":"","comment_is_top":false,"comment_ctime":1672910106,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100021701,"comment_content":"import pandas as pd\ndf=pd.read_excel(&quot;D:\\\\pycharm\\\\anaconda3\\\\上海指数.xlsx&quot;)\ndf.index = df.Timestamp\ndf_M = df.resample(&#39;M&#39;).mean() #按月\nimport matplotlib.pyplot as plt\nplt.rcParams[&#39;font.sans-serif&#39;]=[&#39;SimHei&#39;] #用来正常显示中文标签\nfig = plt.figure(figsize=[15,7])\nplt.title(&#39;上海指数&#39;,fontsize=12)\nplt.plot(df.Price,&#39;-&#39;,label=&#39;按月&#39;)\nplt.legend()\nplt.show()\nfrom itertools import  product\nps = range(0,3)\nqs = range(0,3)\nparameters = product(ps,qs)\nparameters_list = list(parameters)\nfrom statsmodels.tsa.arima_model import ARMA\n# 找最优参数\nresults = []\nbest_aic = float(&quot;inf&quot;) #正无穷\nfor param in  parameters_list:\n    try:\n        model = ARMA(df_M.Price,order=(param[0],param[1])).fit()\n    except ValueError:\n        print(&#39;参数错误&#39;,param)\n    aic = model.aic\n    if aic &lt; best_aic:\n        best_model = model\n        best_aic = aic\n        best_param = param\n    results.append([param,model.aic])\nresults_table = pd.DataFrame(results)\nresults_table.columns = [&#39;parameters&#39;,&#39;aic&#39;]\nfrom datetime import  datetime\ndate_list = [datetime(2019, 3, 31), datetime(2019, 4, 30),datetime(2019, 5, 31), datetime(2019, 6, 30),\n             datetime(2019,7,31),datetime(2019,8,31),datetime(2019,9,30),datetime(2019,10,31)]\nfuture = pd.DataFrame(index=date_list, columns= df_M.columns)\ndf_M = pd.concat([df_M,future])\ndf_M[&#39;forecast&#39;] = best_model.predict(start=0,end=347)\nprint(df_M.tail(12))\n# 比特币预测结果显示\nplt.figure(figsize=(20,7))\ndf_M.Price.plot(label=&#39;实际指数&#39;)\ndf_M.forecast.plot(color=&#39;r&#39;, ls=&#39;--&#39;, label=&#39;预测指数&#39;)\nplt.legend()\nplt.title(&#39;上海指数（月）&#39;)\nplt.xlabel(&#39;时间&#39;)\nplt.ylabel(&#39;指数&#39;)\nplt.show()","like_count":1},{"had_liked":false,"id":329351,"user_name":"piboye","can_delete":false,"product_type":"c1","uid":1066752,"ip_address":"","ucode":"7CFD8712857A85","user_header":"https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg","comment_is_top":false,"comment_ctime":1641297750,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100021701,"comment_content":"TSLM也是吗？","like_count":1},{"had_liked":false,"id":261994,"user_name":"厚积薄发","can_delete":false,"product_type":"c1","uid":1206674,"ip_address":"","ucode":"8640C07176C249","user_header":"https://static001.geekbang.org/account/avatar/00/12/69/92/69c2c135.jpg","comment_is_top":false,"comment_ctime":1605601887,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100021701,"comment_content":"1.AR,MA,ARMA,ARIMA的区别\n       1.1AR模型 Auto Regressive  自回归模型 过去一段时间的点线性组合再加上白噪声预测未来某时刻的点  AR(p)\n       1.2.MA 模型 Moving Average 移动平均模型 历史白噪声的线性组合影响当前时刻的点  MA(q)\n        1.3.ARMA 模型 Auto Regressive Moving Average 自回归平均滑动模型  AR模型和MA模型的混合  ARMA(p,q)\n         1.4.ARIMA 模型  Auto Regressive Integrated Moving Average 差分自回归平均滑动模型 ARIMA(p,d,q)   要求数据是平稳的\n\n         预测指标AIC   AIC 越小越好\n2.什么时候使用线性回归，什么时候使用时间序列分析\n          对一个数值进行预测时，如果考虑的是单个时间维度与结果的关系，可以使用时间序列分析\n         如果考虑的是多个变量与结果之间的关系，可以采用回归分析\n3.上证指数预测\n   代码：git@github.com:houjibofa2050&#47;sequentially.git\n   \n","like_count":1},{"had_liked":false,"id":176989,"user_name":"小狮子(*¯︶¯*)","can_delete":false,"product_type":"c1","uid":1486681,"ip_address":"","ucode":"EF8095CCD06D15","user_header":"https://static001.geekbang.org/account/avatar/00/16/af/59/84aedd2f.jpg","comment_is_top":false,"comment_ctime":1581242822,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":4,"product_id":100021701,"comment_content":"不做平稳性检测就能直接用ARMA模型？\n","like_count":1},{"had_liked":false,"id":324820,"user_name":"欠儿登","can_delete":false,"product_type":"c1","uid":2816350,"ip_address":"","ucode":"3AEECE8B93BC70","user_header":"https://static001.geekbang.org/account/avatar/00/2a/f9/5e/947d77f6.jpg","comment_is_top":false,"comment_ctime":1638666218,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":4,"product_id":100021701,"comment_content":"请问时间序列必须是连续不断的么，比如按周统计就必须每周都有数据？","like_count":0,"discussions":[{"author":{"id":1349706,"avatar":"https://static001.geekbang.org/account/avatar/00/14/98/4a/c39fc848.jpg","nickname":"evan","note":"","ucode":"6D8AA919F40DEC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290478,"discussion_content":"这哥们误人子弟","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594483719,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":316754,"user_name":"东旭","can_delete":false,"product_type":"c1","uid":2668134,"ip_address":"","ucode":"FD3EA3265FD9C0","user_header":"https://static001.geekbang.org/account/avatar/00/28/b6/66/5d2be1ee.jpg","comment_is_top":false,"comment_ctime":1634541345,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":4,"product_id":100021701,"comment_content":"不知道还有人看这个课程不，我的预测都是平的，没有一点可参考趋势，我用的python3.9，ARMA已经停用了，所有我模仿着用了statsmodels.tsa.arima.model.ARIMA，不知道问题出在了哪里","like_count":0,"discussions":[{"author":{"id":1922303,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/54/ff/666c479d.jpg","nickname":"dage","note":"","ucode":"AA7C658301D918","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578202,"discussion_content":"亲测，发现是这样，时间不连续模型有可能预测失败，举个例子，历史14周的数据预测未来14周的数据，历史14周里，如果某一周中断了，那模型会预测失败，如果是有规律的中断，比如每两周中断一次，那模型预测出来的结果也是保持这样的规律","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656577194,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":235371,"user_name":"大懒虫","can_delete":false,"product_type":"c1","uid":1440873,"ip_address":"","ucode":"51014C4A7074DA","user_header":"https://static001.geekbang.org/account/avatar/00/15/fc/69/02953435.jpg","comment_is_top":false,"comment_ctime":1594985611,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100021701,"comment_content":"老师，我用arma模型去预测cpu监控数据的时候，发现训练数据拟合的很好，但是预测的时候，趋势却是相反的，请问下这个问题一般要怎么解决呢？","like_count":0},{"had_liked":false,"id":77416,"user_name":"堂吉诃德","can_delete":false,"product_type":"c1","uid":1357227,"ip_address":"","ucode":"6A6D3D4866729B","user_header":"https://static001.geekbang.org/account/avatar/00/14/b5/ab/30e1531e.jpg","comment_is_top":false,"comment_ctime":1552921042,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100021701,"comment_content":"1. parameters = product(ps, qs) \nparameters为可迭代对象, 直接使用\nfor param in parameters:  \n不用再转为列表吧?\n\n2. 回答一下 @Grandia_Z \n时间序列操作\ndate_list = pd.date_range(&#39;2019-03-31&#39;, &#39;2019-12-31&#39;, periods=None, freq=&#39;D&#39;)\n希望你能看到","like_count":3},{"had_liked":false,"id":389782,"user_name":"yanyu-xin","can_delete":false,"product_type":"c1","uid":1899757,"ip_address":"广东","ucode":"3AA389F9E4C236","user_header":"","comment_is_top":false,"comment_ctime":1713447042,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100021701,"comment_content":"遇到的 NotImplementedError 异常提示正在使用的 statsmodels (0.14.1) 版本中已经移除了 ARMA 和 ARIMA 模型，取而代之的是 statsmodels.tsa.arima.model.ARIMA 和 statsmodels.tsa.SARIMAX。为了解决这个问题，将 ARMA 替换为 ARIMA，注意类名的变化。使用新的 ARIMA 类来拟合模型。\n将代码：\nfrom statsmodels.tsa.arma.model import ARMA \nmodel = ARMA(df_month.Weighted_Price, order=(param[0], param[1])).fit()\n改为：\nfrom statsmodels.tsa.arima.model import ARIMA\nmodel = ARIMA(df_month.Weighted_Price, order=(param[0], 0, param[1])).fit()\n\n注意：ARIMA 需要三个参数：p（AR的阶数），d（差分次数），q（MA的阶数）\n在 ARMA 模型中，d 通常设置为 0，因为 ARMA 不涉及差分\n请注意，ARIMA 模型实际上包含了 ARMA 模型的功能，但是增加了差分（d）的选项，允许您处理非平稳时间序列。在您的代码中，如果您的数据已经是平稳的，那么 d 应该设置为 0。\n如果您想要继续使用 ARMA 模型而不考虑差分，您可以使用 ARIMA 类，并将 d 参数设置为 0。如果需要使用差分，请确保在建模之前对数据进行适当的差分处理。","like_count":1},{"had_liked":false,"id":374986,"user_name":"Casper","can_delete":false,"product_type":"c1","uid":1038115,"ip_address":"马来西亚","ucode":"D6BF9612491BA3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d7/23/d195075d.jpg","comment_is_top":false,"comment_ctime":1684757192,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100021701,"comment_content":"这个代码都老了 现在都运行不了了","like_count":1},{"had_liked":false,"id":365708,"user_name":"Geek_3e33b6","can_delete":false,"product_type":"c1","uid":2990931,"ip_address":"四川","ucode":"E24206E1679177","user_header":"","comment_is_top":false,"comment_ctime":1672910106,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100021701,"comment_content":"import pandas as pd\ndf=pd.read_excel(&quot;D:\\\\pycharm\\\\anaconda3\\\\上海指数.xlsx&quot;)\ndf.index = df.Timestamp\ndf_M = df.resample(&#39;M&#39;).mean() #按月\nimport matplotlib.pyplot as plt\nplt.rcParams[&#39;font.sans-serif&#39;]=[&#39;SimHei&#39;] #用来正常显示中文标签\nfig = plt.figure(figsize=[15,7])\nplt.title(&#39;上海指数&#39;,fontsize=12)\nplt.plot(df.Price,&#39;-&#39;,label=&#39;按月&#39;)\nplt.legend()\nplt.show()\nfrom itertools import  product\nps = range(0,3)\nqs = range(0,3)\nparameters = product(ps,qs)\nparameters_list = list(parameters)\nfrom statsmodels.tsa.arima_model import ARMA\n# 找最优参数\nresults = []\nbest_aic = float(&quot;inf&quot;) #正无穷\nfor param in  parameters_list:\n    try:\n        model = ARMA(df_M.Price,order=(param[0],param[1])).fit()\n    except ValueError:\n        print(&#39;参数错误&#39;,param)\n    aic = model.aic\n    if aic &lt; best_aic:\n        best_model = model\n        best_aic = aic\n        best_param = param\n    results.append([param,model.aic])\nresults_table = pd.DataFrame(results)\nresults_table.columns = [&#39;parameters&#39;,&#39;aic&#39;]\nfrom datetime import  datetime\ndate_list = [datetime(2019, 3, 31), datetime(2019, 4, 30),datetime(2019, 5, 31), datetime(2019, 6, 30),\n             datetime(2019,7,31),datetime(2019,8,31),datetime(2019,9,30),datetime(2019,10,31)]\nfuture = pd.DataFrame(index=date_list, columns= df_M.columns)\ndf_M = pd.concat([df_M,future])\ndf_M[&#39;forecast&#39;] = best_model.predict(start=0,end=347)\nprint(df_M.tail(12))\n# 比特币预测结果显示\nplt.figure(figsize=(20,7))\ndf_M.Price.plot(label=&#39;实际指数&#39;)\ndf_M.forecast.plot(color=&#39;r&#39;, ls=&#39;--&#39;, label=&#39;预测指数&#39;)\nplt.legend()\nplt.title(&#39;上海指数（月）&#39;)\nplt.xlabel(&#39;时间&#39;)\nplt.ylabel(&#39;指数&#39;)\nplt.show()","like_count":1},{"had_liked":false,"id":329351,"user_name":"piboye","can_delete":false,"product_type":"c1","uid":1066752,"ip_address":"","ucode":"7CFD8712857A85","user_header":"https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg","comment_is_top":false,"comment_ctime":1641297750,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100021701,"comment_content":"TSLM也是吗？","like_count":1},{"had_liked":false,"id":261994,"user_name":"厚积薄发","can_delete":false,"product_type":"c1","uid":1206674,"ip_address":"","ucode":"8640C07176C249","user_header":"https://static001.geekbang.org/account/avatar/00/12/69/92/69c2c135.jpg","comment_is_top":false,"comment_ctime":1605601887,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100021701,"comment_content":"1.AR,MA,ARMA,ARIMA的区别\n       1.1AR模型 Auto Regressive  自回归模型 过去一段时间的点线性组合再加上白噪声预测未来某时刻的点  AR(p)\n       1.2.MA 模型 Moving Average 移动平均模型 历史白噪声的线性组合影响当前时刻的点  MA(q)\n        1.3.ARMA 模型 Auto Regressive Moving Average 自回归平均滑动模型  AR模型和MA模型的混合  ARMA(p,q)\n         1.4.ARIMA 模型  Auto Regressive Integrated Moving Average 差分自回归平均滑动模型 ARIMA(p,d,q)   要求数据是平稳的\n\n         预测指标AIC   AIC 越小越好\n2.什么时候使用线性回归，什么时候使用时间序列分析\n          对一个数值进行预测时，如果考虑的是单个时间维度与结果的关系，可以使用时间序列分析\n         如果考虑的是多个变量与结果之间的关系，可以采用回归分析\n3.上证指数预测\n   代码：git@github.com:houjibofa2050&#47;sequentially.git\n   \n","like_count":1},{"had_liked":false,"id":176989,"user_name":"小狮子(*¯︶¯*)","can_delete":false,"product_type":"c1","uid":1486681,"ip_address":"","ucode":"EF8095CCD06D15","user_header":"https://static001.geekbang.org/account/avatar/00/16/af/59/84aedd2f.jpg","comment_is_top":false,"comment_ctime":1581242822,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":4,"product_id":100021701,"comment_content":"不做平稳性检测就能直接用ARMA模型？\n","like_count":1,"discussions":[{"author":{"id":1349706,"avatar":"https://static001.geekbang.org/account/avatar/00/14/98/4a/c39fc848.jpg","nickname":"evan","note":"","ucode":"6D8AA919F40DEC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290478,"discussion_content":"这哥们误人子弟","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594483719,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324820,"user_name":"欠儿登","can_delete":false,"product_type":"c1","uid":2816350,"ip_address":"","ucode":"3AEECE8B93BC70","user_header":"https://static001.geekbang.org/account/avatar/00/2a/f9/5e/947d77f6.jpg","comment_is_top":false,"comment_ctime":1638666218,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":4,"product_id":100021701,"comment_content":"请问时间序列必须是连续不断的么，比如按周统计就必须每周都有数据？","like_count":0,"discussions":[{"author":{"id":1922303,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/54/ff/666c479d.jpg","nickname":"dage","note":"","ucode":"AA7C658301D918","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578202,"discussion_content":"亲测，发现是这样，时间不连续模型有可能预测失败，举个例子，历史14周的数据预测未来14周的数据，历史14周里，如果某一周中断了，那模型会预测失败，如果是有规律的中断，比如每两周中断一次，那模型预测出来的结果也是保持这样的规律","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656577194,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":316754,"user_name":"东旭","can_delete":false,"product_type":"c1","uid":2668134,"ip_address":"","ucode":"FD3EA3265FD9C0","user_header":"https://static001.geekbang.org/account/avatar/00/28/b6/66/5d2be1ee.jpg","comment_is_top":false,"comment_ctime":1634541345,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":4,"product_id":100021701,"comment_content":"不知道还有人看这个课程不，我的预测都是平的，没有一点可参考趋势，我用的python3.9，ARMA已经停用了，所有我模仿着用了statsmodels.tsa.arima.model.ARIMA，不知道问题出在了哪里","like_count":0,"discussions":[{"author":{"id":2913751,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/75/d7/3e309b4e.jpg","nickname":"三余韵势","note":"","ucode":"8395F79A74B2CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553520,"discussion_content":"我出现了与你相同的问题，先开始是无数据，后来我在DataFrame()中传入了数据，估计是数据传入不同所导致的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645947909,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":235371,"user_name":"大懒虫","can_delete":false,"product_type":"c1","uid":1440873,"ip_address":"","ucode":"51014C4A7074DA","user_header":"https://static001.geekbang.org/account/avatar/00/15/fc/69/02953435.jpg","comment_is_top":false,"comment_ctime":1594985611,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100021701,"comment_content":"老师，我用arma模型去预测cpu监控数据的时候，发现训练数据拟合的很好，但是预测的时候，趋势却是相反的，请问下这个问题一般要怎么解决呢？","like_count":0,"discussions":[{"author":{"id":2913751,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/75/d7/3e309b4e.jpg","nickname":"三余韵势","note":"","ucode":"8395F79A74B2CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553520,"discussion_content":"我出现了与你相同的问题，先开始是无数据，后来我在DataFrame()中传入了数据，估计是数据传入不同所导致的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645947909,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":198708,"user_name":"张贺","can_delete":false,"product_type":"c1","uid":1283181,"ip_address":"","ucode":"0254E40FB3EB5F","user_header":"https://static001.geekbang.org/account/avatar/00/13/94/6d/5cd6e8c7.jpg","comment_is_top":false,"comment_ctime":1585464956,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100021701,"comment_content":"和计量经济学的内容比较接近","like_count":0},{"had_liked":false,"id":180829,"user_name":"苹果","can_delete":false,"product_type":"c1","uid":1761988,"ip_address":"","ucode":"5D0FA9D8560FD8","user_header":"https://static001.geekbang.org/account/avatar/00/1a/e2/c4/25acaa38.jpg","comment_is_top":false,"comment_ctime":1582423837,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100021701,"comment_content":"预测10个月的指数结果\n2019-02-28    2512.315225\n2019-03-31    2841.790501\n2019-04-30    2862.619053\n2019-05-31    2816.393758\n2019-06-30    2802.021098\n2019-07-31    2773.830565\n2019-08-31    2752.878544\n2019-09-30    2729.425626\n2019-10-31    2707.946051\n2019-11-30    2686.354577\n2019-12-31            Na\n分析对比了下其他同学的结果，整数位基本相同，小数位就不然。每次运行的结果有些差别。不过也达到了目的","like_count":0},{"had_liked":false,"id":78556,"user_name":"third","can_delete":false,"product_type":"c1","uid":1025114,"ip_address":"","ucode":"9A37408A834F0B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a4/5a/e708e423.jpg","comment_is_top":false,"comment_ctime":1553174846,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100021701,"comment_content":"最优模型，ARMA(2, 2)","like_count":0},{"had_liked":false,"id":198708,"user_name":"张贺","can_delete":false,"product_type":"c1","uid":1283181,"ip_address":"","ucode":"0254E40FB3EB5F","user_header":"https://static001.geekbang.org/account/avatar/00/13/94/6d/5cd6e8c7.jpg","comment_is_top":false,"comment_ctime":1585464956,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100021701,"comment_content":"和计量经济学的内容比较接近","like_count":0},{"had_liked":false,"id":180829,"user_name":"苹果","can_delete":false,"product_type":"c1","uid":1761988,"ip_address":"","ucode":"5D0FA9D8560FD8","user_header":"https://static001.geekbang.org/account/avatar/00/1a/e2/c4/25acaa38.jpg","comment_is_top":false,"comment_ctime":1582423837,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100021701,"comment_content":"预测10个月的指数结果\n2019-02-28    2512.315225\n2019-03-31    2841.790501\n2019-04-30    2862.619053\n2019-05-31    2816.393758\n2019-06-30    2802.021098\n2019-07-31    2773.830565\n2019-08-31    2752.878544\n2019-09-30    2729.425626\n2019-10-31    2707.946051\n2019-11-30    2686.354577\n2019-12-31            Na\n分析对比了下其他同学的结果，整数位基本相同，小数位就不然。每次运行的结果有些差别。不过也达到了目的","like_count":0},{"had_liked":false,"id":78556,"user_name":"third","can_delete":false,"product_type":"c1","uid":1025114,"ip_address":"","ucode":"9A37408A834F0B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a4/5a/e708e423.jpg","comment_is_top":false,"comment_ctime":1553174846,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100021701,"comment_content":"最优模型，ARMA(2, 2)","like_count":0}]}