{"id":96168,"title":"36 | ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼šç”¨æµæ°´çº¿æ€æƒ³æé«˜æ•ˆç‡","content":"<p>å‰é¢æˆ‘ä»¬åœ¨<a href=\"https://time.geekbang.org/column/article/95525\">ã€Š34 | Worker Threadæ¨¡å¼ï¼šå¦‚ä½•é¿å…é‡å¤åˆ›å»ºçº¿ç¨‹ï¼Ÿã€‹</a>ä¸­è®²åˆ°ï¼ŒWorker Threadæ¨¡å¼ç±»æ¯”çš„æ˜¯å·¥å‚é‡Œè½¦é—´å·¥äººçš„å·¥ä½œæ¨¡å¼ã€‚ä½†å…¶å®åœ¨ç°å®ä¸–ç•Œï¼Œå·¥å‚é‡Œè¿˜æœ‰ä¸€ç§æµæ°´çº¿çš„å·¥ä½œæ¨¡å¼ï¼Œç±»æ¯”åˆ°ç¼–ç¨‹é¢†åŸŸï¼Œå°±æ˜¯<strong>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼</strong>ã€‚</p><p>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼åœ¨ç¼–ç¨‹é¢†åŸŸçš„åº”ç”¨ä¹Ÿéå¸¸å¹¿æ³›ï¼Œå‰é¢æˆ‘ä»¬æ›¾ç»æåˆ°ï¼ŒJavaçº¿ç¨‹æ± æœ¬è´¨ä¸Šå°±æ˜¯ç”¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼å®ç°çš„ï¼Œæ‰€ä»¥æ¯å½“ä½¿ç”¨çº¿ç¨‹æ± çš„æ—¶å€™ï¼Œå…¶å®å°±æ˜¯åœ¨åº”ç”¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ã€‚</p><p>å½“ç„¶ï¼Œé™¤äº†åœ¨çº¿ç¨‹æ± ä¸­çš„åº”ç”¨ï¼Œä¸ºäº†æå‡æ€§èƒ½ï¼Œå¹¶å‘ç¼–ç¨‹é¢†åŸŸå¾ˆå¤šåœ°æ–¹ä¹Ÿéƒ½ç”¨åˆ°äº†ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼Œä¾‹å¦‚Log4j2ä¸­å¼‚æ­¥Appenderå†…éƒ¨ä¹Ÿç”¨åˆ°äº†ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ã€‚æ‰€ä»¥ä»Šå¤©æˆ‘ä»¬å°±æ¥æ·±å…¥åœ°èŠèŠç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼Œçœ‹çœ‹å®ƒå…·ä½“æœ‰å“ªäº›ä¼˜ç‚¹ï¼Œä»¥åŠå¦‚ä½•æå‡ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p><h2>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼çš„ä¼˜ç‚¹</h2><p>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ª<strong>ä»»åŠ¡é˜Ÿåˆ—</strong>ï¼Œç”Ÿäº§è€…çº¿ç¨‹ç”Ÿäº§ä»»åŠ¡ï¼Œå¹¶å°†ä»»åŠ¡æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œè€Œæ¶ˆè´¹è€…çº¿ç¨‹ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡å¹¶æ‰§è¡Œã€‚ä¸‹é¢æ˜¯ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼çš„ä¸€ä¸ªç¤ºæ„å›¾ï¼Œä½ å¯ä»¥ç»“åˆå®ƒæ¥ç†è§£ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/df/15/df72a9769cec7a25dc9093e160dbbb15.png?wh=1142*326\" alt=\"\"></p><center><span class=\"reference\">ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ç¤ºæ„å›¾</span></center><p>ä»æ¶æ„è®¾è®¡çš„è§’åº¦æ¥çœ‹ï¼Œç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„ä¼˜ç‚¹ï¼Œå°±æ˜¯<strong>è§£è€¦</strong>ã€‚è§£è€¦å¯¹äºå¤§å‹ç³»ç»Ÿçš„è®¾è®¡éå¸¸é‡è¦ï¼Œè€Œè§£è€¦çš„ä¸€ä¸ªå…³é”®å°±æ˜¯ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»å’Œé€šä¿¡æ–¹å¼å¿…é¡»å—é™ã€‚åœ¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ä¸­ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ²¡æœ‰ä»»ä½•ä¾èµ–å…³ç³»ï¼Œå®ƒä»¬å½¼æ­¤ä¹‹é—´çš„é€šä¿¡åªèƒ½é€šè¿‡ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ‰€ä»¥<strong>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼æ˜¯ä¸€ä¸ªä¸é”™çš„è§£è€¦æ–¹æ¡ˆ</strong>ã€‚</p><!-- [[[read_end]]] --><p>é™¤äº†æ¶æ„è®¾è®¡ä¸Šçš„ä¼˜ç‚¹ä¹‹å¤–ï¼Œç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ä¼˜ç‚¹å°±æ˜¯<strong>æ”¯æŒå¼‚æ­¥ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¹³è¡¡ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„é€Ÿåº¦å·®å¼‚</strong>ã€‚åœ¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ä¸­ï¼Œç”Ÿäº§è€…çº¿ç¨‹åªéœ€è¦å°†ä»»åŠ¡æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—è€Œæ— éœ€ç­‰å¾…ä»»åŠ¡è¢«æ¶ˆè´¹è€…çº¿ç¨‹æ‰§è¡Œå®Œï¼Œä¹Ÿå°±æ˜¯è¯´ä»»åŠ¡çš„ç”Ÿäº§å’Œæ¶ˆè´¹æ˜¯å¼‚æ­¥çš„ï¼Œè¿™æ˜¯ä¸ä¼ ç»Ÿçš„æ–¹æ³•ä¹‹é—´è°ƒç”¨çš„æœ¬è´¨åŒºåˆ«ï¼Œä¼ ç»Ÿçš„æ–¹æ³•ä¹‹é—´è°ƒç”¨æ˜¯åŒæ­¥çš„ã€‚</p><p>ä½ æˆ–è®¸ä¼šæœ‰è¿™æ ·çš„ç–‘é—®ï¼Œå¼‚æ­¥åŒ–å¤„ç†æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹å»å¤„ç†ï¼Œé‚£ä¸­é—´å¢åŠ ä¸€ä¸ªâ€œ<strong>ä»»åŠ¡é˜Ÿåˆ—</strong>â€ç©¶ç«Ÿæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿæˆ‘è§‰å¾—ä¸»è¦è¿˜æ˜¯ç”¨äº<strong>å¹³è¡¡ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„é€Ÿåº¦å·®å¼‚</strong>ã€‚æˆ‘ä»¬å‡è®¾ç”Ÿäº§è€…çš„é€Ÿç‡å¾ˆæ…¢ï¼Œè€Œæ¶ˆè´¹è€…çš„é€Ÿç‡å¾ˆé«˜ï¼Œæ¯”å¦‚æ˜¯1:3ï¼Œå¦‚æœç”Ÿäº§è€…æœ‰3ä¸ªçº¿ç¨‹ï¼Œé‡‡ç”¨åˆ›å»ºæ–°çš„çº¿ç¨‹çš„æ–¹å¼ï¼Œé‚£ä¹ˆä¼šåˆ›å»º3ä¸ªå­çº¿ç¨‹ï¼Œè€Œé‡‡ç”¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼Œæ¶ˆè´¹çº¿ç¨‹åªéœ€è¦1ä¸ªå°±å¯ä»¥äº†ã€‚Javaè¯­è¨€é‡Œï¼ŒJavaçº¿ç¨‹å’Œæ“ä½œç³»ç»Ÿçº¿ç¨‹æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œçº¿ç¨‹åˆ›å»ºå¾—å¤ªå¤šï¼Œä¼šå¢åŠ ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æˆæœ¬ï¼Œæ‰€ä»¥Javaçº¿ç¨‹ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œé€‚é‡å³å¯ã€‚è€Œ<strong>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼æ°å¥½èƒ½æ”¯æŒä½ ç”¨é€‚é‡çš„çº¿ç¨‹</strong>ã€‚</p><h2>æ”¯æŒæ‰¹é‡æ‰§è¡Œä»¥æå‡æ€§èƒ½</h2><p>å‰é¢æˆ‘ä»¬åœ¨<a href=\"https://time.geekbang.org/column/article/95098\">ã€Š33 | Thread-Per-Messageæ¨¡å¼ï¼šæœ€ç®€å•å®ç”¨çš„åˆ†å·¥æ–¹æ³•ã€‹</a>ä¸­è®²è¿‡è½»é‡çº§çš„çº¿ç¨‹ï¼Œå¦‚æœä½¿ç”¨è½»é‡çº§çº¿ç¨‹ï¼Œå°±æ²¡æœ‰å¿…è¦å¹³è¡¡ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„é€Ÿåº¦å·®å¼‚äº†ï¼Œå› ä¸ºè½»é‡çº§çº¿ç¨‹æœ¬èº«å°±æ˜¯å»‰ä»·çš„ï¼Œé‚£æ˜¯å¦æ„å‘³ç€ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼åœ¨æ€§èƒ½ä¼˜åŒ–æ–¹é¢å°±æ— ç”¨æ­¦ä¹‹åœ°äº†å‘¢ï¼Ÿå½“ç„¶ä¸æ˜¯ï¼Œæœ‰ä¸€ç±»å¹¶å‘åœºæ™¯åº”ç”¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼å°±æœ‰å¥‡æ•ˆï¼Œé‚£å°±æ˜¯<strong>æ‰¹é‡æ‰§è¡Œ</strong>ä»»åŠ¡ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦åœ¨æ•°æ®åº“é‡ŒINSERT 1000æ¡æ•°æ®ï¼Œæœ‰ä¸¤ç§æ–¹æ¡ˆï¼šç¬¬ä¸€ç§æ–¹æ¡ˆæ˜¯ç”¨1000ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œæ¯ä¸ªçº¿ç¨‹INSERTä¸€æ¡æ•°æ®ï¼›ç¬¬äºŒç§æ–¹æ¡ˆæ˜¯ç”¨1ä¸ªçº¿ç¨‹ï¼Œæ‰§è¡Œä¸€ä¸ªæ‰¹é‡çš„SQLï¼Œä¸€æ¬¡æ€§æŠŠ1000æ¡æ•°æ®INSERTè¿›å»ã€‚è¿™ä¸¤ç§æ–¹æ¡ˆï¼Œæ˜¾ç„¶æ˜¯ç¬¬äºŒç§æ–¹æ¡ˆæ•ˆç‡æ›´é«˜ï¼Œå…¶å®è¿™æ ·çš„åº”ç”¨åœºæ™¯å°±æ˜¯æˆ‘ä»¬ä¸Šé¢æåˆ°çš„æ‰¹é‡æ‰§è¡Œåœºæ™¯ã€‚</p><p>åœ¨<a href=\"https://time.geekbang.org/column/article/95847\">ã€Š35 | ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ï¼šå¦‚ä½•ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹ï¼Ÿã€‹</a>æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æåˆ°ä¸€ä¸ªç›‘æ§ç³»ç»ŸåŠ¨æ€é‡‡é›†çš„æ¡ˆä¾‹ï¼Œå…¶å®æœ€ç»ˆå›ä¼ çš„ç›‘æ§æ•°æ®è¿˜æ˜¯è¦å­˜å…¥æ•°æ®åº“çš„ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚ä½†è¢«ç›‘æ§ç³»ç»Ÿå¾€å¾€æœ‰å¾ˆå¤šï¼Œå¦‚æœæ¯ä¸€æ¡å›ä¼ æ•°æ®éƒ½ç›´æ¥INSERTåˆ°æ•°æ®åº“ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ¡ˆå°±æ˜¯ä¸Šé¢æåˆ°çš„ç¬¬ä¸€ç§æ–¹æ¡ˆï¼šæ¯ä¸ªçº¿ç¨‹INSERTä¸€æ¡æ•°æ®ã€‚å¾ˆæ˜¾ç„¶ï¼Œæ›´å¥½çš„æ–¹æ¡ˆæ˜¯æ‰¹é‡æ‰§è¡ŒSQLï¼Œé‚£å¦‚ä½•å®ç°å‘¢ï¼Ÿè¿™å°±è¦ç”¨åˆ°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼äº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/15/29/155d861702a047bd20b5708e06c6fd29.png?wh=1142*386\" alt=\"\"></p><center><span class=\"reference\">åŠ¨æ€é‡‡é›†åŠŸèƒ½ç¤ºæ„å›¾</span></center><p>åˆ©ç”¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼å®ç°æ‰¹é‡æ‰§è¡ŒSQLéå¸¸ç®€å•ï¼šå°†åŸæ¥ç›´æ¥INSERTæ•°æ®åˆ°æ•°æ®åº“çš„çº¿ç¨‹ä½œä¸ºç”Ÿäº§è€…çº¿ç¨‹ï¼Œç”Ÿäº§è€…çº¿ç¨‹åªéœ€å°†æ•°æ®æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ï¼Œç„¶åæ¶ˆè´¹è€…çº¿ç¨‹è´Ÿè´£å°†ä»»åŠ¡ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­æ‰¹é‡å–å‡ºå¹¶æ‰¹é‡æ‰§è¡Œã€‚</p><p>åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†5ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹è´Ÿè´£æ‰¹é‡æ‰§è¡ŒSQLï¼Œè¿™5ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ä»¥ <code>while(true){}</code> å¾ªç¯æ–¹å¼æ‰¹é‡åœ°è·å–ä»»åŠ¡å¹¶æ‰¹é‡åœ°æ‰§è¡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–æ‰¹é‡ä»»åŠ¡çš„æ–¹æ³•pollTasks()ä¸­ï¼Œé¦–å…ˆæ˜¯ä»¥é˜»å¡æ–¹å¼è·å–ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä¸€æ¡ä»»åŠ¡ï¼Œè€Œååˆ™æ˜¯ä»¥éé˜»å¡çš„æ–¹å¼è·å–ä»»åŠ¡ï¼›ä¹‹æ‰€ä»¥é¦–å…ˆé‡‡ç”¨é˜»å¡æ–¹å¼ï¼Œæ˜¯å› ä¸ºå¦‚æœä»»åŠ¡é˜Ÿåˆ—ä¸­æ²¡æœ‰ä»»åŠ¡ï¼Œè¿™æ ·çš„æ–¹å¼èƒ½å¤Ÿé¿å…æ— è°“çš„å¾ªç¯ã€‚</p><pre><code>//ä»»åŠ¡é˜Ÿåˆ—\nBlockingQueue&lt;Task&gt; bq=new\n  LinkedBlockingQueue&lt;&gt;(2000);\n//å¯åŠ¨5ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹\n//æ‰§è¡Œæ‰¹é‡ä»»åŠ¡  \nvoid start() {\n  ExecutorService es=executors\n    .newFixedThreadPool(5);\n  for (int i=0; i&lt;5; i++) {\n    es.execute(()-&gt;{\n      try {\n        while (true) {\n          //è·å–æ‰¹é‡ä»»åŠ¡\n          List&lt;Task&gt; ts=pollTasks();\n          //æ‰§è¡Œæ‰¹é‡ä»»åŠ¡\n          execTasks(ts);\n        }\n      } catch (Exception e) {\n        e.printStackTrace();\n      }\n    });\n  }\n}\n//ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–æ‰¹é‡ä»»åŠ¡\nList&lt;Task&gt; pollTasks() \n    throws InterruptedException{\n  List&lt;Task&gt; ts=new LinkedList&lt;&gt;();\n  //é˜»å¡å¼è·å–ä¸€æ¡ä»»åŠ¡\n  Task t = bq.take();\n  while (t != null) {\n    ts.add(t);\n    //éé˜»å¡å¼è·å–ä¸€æ¡ä»»åŠ¡\n    t = bq.poll();\n  }\n  return ts;\n}\n//æ‰¹é‡æ‰§è¡Œä»»åŠ¡\nexecTasks(List&lt;Task&gt; ts) {\n  //çœç•¥å…·ä½“ä»£ç æ— æ•°\n}\n</code></pre><h2>æ”¯æŒåˆ†é˜¶æ®µæäº¤ä»¥æå‡æ€§èƒ½</h2><p>åˆ©ç”¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼è¿˜å¯ä»¥è½»æ¾åœ°æ”¯æŒä¸€ç§åˆ†é˜¶æ®µæäº¤çš„åº”ç”¨åœºæ™¯ã€‚æˆ‘ä»¬çŸ¥é“å†™æ–‡ä»¶å¦‚æœåŒæ­¥åˆ·ç›˜æ€§èƒ½ä¼šå¾ˆæ…¢ï¼Œæ‰€ä»¥å¯¹äºä¸æ˜¯å¾ˆé‡è¦çš„æ•°æ®ï¼Œæˆ‘ä»¬å¾€å¾€é‡‡ç”¨å¼‚æ­¥åˆ·ç›˜çš„æ–¹å¼ã€‚æˆ‘æ›¾ç»å‚ä¸è¿‡ä¸€ä¸ªé¡¹ç›®ï¼Œå…¶ä¸­çš„æ—¥å¿—ç»„ä»¶æ˜¯è‡ªå·±å®ç°çš„ï¼Œé‡‡ç”¨çš„å°±æ˜¯å¼‚æ­¥åˆ·ç›˜æ–¹å¼ï¼Œåˆ·ç›˜çš„æ—¶æœºæ˜¯ï¼š</p><ol>\n<li>ERRORçº§åˆ«çš„æ—¥å¿—éœ€è¦ç«‹å³åˆ·ç›˜ï¼›</li>\n<li>æ•°æ®ç§¯ç´¯åˆ°500æ¡éœ€è¦ç«‹å³åˆ·ç›˜ï¼›</li>\n<li>å­˜åœ¨æœªåˆ·ç›˜æ•°æ®ï¼Œä¸”5ç§’é’Ÿå†…æœªæ›¾åˆ·ç›˜ï¼Œéœ€è¦ç«‹å³åˆ·ç›˜ã€‚</li>\n</ol><p>è¿™ä¸ªæ—¥å¿—ç»„ä»¶çš„å¼‚æ­¥åˆ·ç›˜æ“ä½œæœ¬è´¨ä¸Šå…¶å®å°±æ˜¯ä¸€ç§<strong>åˆ†é˜¶æ®µæäº¤</strong>ã€‚ä¸‹é¢æˆ‘ä»¬å…·ä½“çœ‹çœ‹ç”¨ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼å¦‚ä½•å®ç°ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ <code>info()</code>å’Œ<code>error()</code> æ–¹æ³•å†™å…¥æ—¥å¿—ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ—¥å¿—ä»»åŠ¡LogMsgï¼Œå¹¶æ·»åŠ åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œè°ƒç”¨ <code>info()</code>å’Œ<code>error()</code> æ–¹æ³•çš„çº¿ç¨‹æ˜¯ç”Ÿäº§è€…ï¼›è€ŒçœŸæ­£å°†æ—¥å¿—å†™å…¥æ–‡ä»¶çš„æ˜¯æ¶ˆè´¹è€…çº¿ç¨‹ï¼Œåœ¨Loggerè¿™ä¸ªç±»ä¸­ï¼Œæˆ‘ä»¬åªåˆ›å»ºäº†1ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ï¼Œåœ¨è¿™ä¸ªæ¶ˆè´¹è€…çº¿ç¨‹ä¸­ï¼Œä¼šæ ¹æ®åˆ·ç›˜è§„åˆ™æ‰§è¡Œåˆ·ç›˜æ“ä½œï¼Œé€»è¾‘å¾ˆç®€å•ï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚</p><pre><code>class Logger {\n  //ä»»åŠ¡é˜Ÿåˆ—  \n  final BlockingQueue&lt;LogMsg&gt; bq\n    = new BlockingQueue&lt;&gt;();\n  //flushæ‰¹é‡  \n  static final int batchSize=500;\n  //åªéœ€è¦ä¸€ä¸ªçº¿ç¨‹å†™æ—¥å¿—\n  ExecutorService es = \n    Executors.newFixedThreadPool(1);\n  //å¯åŠ¨å†™æ—¥å¿—çº¿ç¨‹\n  void start(){\n    File file=File.createTempFile(\n      &quot;foo&quot;, &quot;.log&quot;);\n    final FileWriter writer=\n      new FileWriter(file);\n    this.es.execute(()-&gt;{\n      try {\n        //æœªåˆ·ç›˜æ—¥å¿—æ•°é‡\n        int curIdx = 0;\n        long preFT=System.currentTimeMillis();\n        while (true) {\n          LogMsg log = bq.poll(\n            5, TimeUnit.SECONDS);\n          //å†™æ—¥å¿—\n          if (log != null) {\n            writer.write(log.toString());\n            ++curIdx;\n          }\n          //å¦‚æœä¸å­˜åœ¨æœªåˆ·ç›˜æ•°æ®ï¼Œåˆ™æ— éœ€åˆ·ç›˜\n          if (curIdx &lt;= 0) {\n            continue;\n          }\n          //æ ¹æ®è§„åˆ™åˆ·ç›˜\n          if (log!=null &amp;&amp; log.level==LEVEL.ERROR ||\n              curIdx == batchSize ||\n              System.currentTimeMillis()-preFT&gt;5000){\n            writer.flush();\n            curIdx = 0;\n            preFT=System.currentTimeMillis();\n          }\n        }\n      }catch(Exception e){\n        e.printStackTrace();\n      } finally {\n        try {\n          writer.flush();\n          writer.close();\n        }catch(IOException e){\n          e.printStackTrace();\n        }\n      }\n    });  \n  }\n  //å†™INFOçº§åˆ«æ—¥å¿—\n  void info(String msg) {\n    bq.put(new LogMsg(\n      LEVEL.INFO, msg));\n  }\n  //å†™ERRORçº§åˆ«æ—¥å¿—\n  void error(String msg) {\n    bq.put(new LogMsg(\n      LEVEL.ERROR, msg));\n  }\n}\n//æ—¥å¿—çº§åˆ«\nenum LEVEL {\n  INFO, ERROR\n}\nclass LogMsg {\n  LEVEL level;\n  String msg;\n  //çœç•¥æ„é€ å‡½æ•°å®ç°\n  LogMsg(LEVEL lvl, String msg){}\n  //çœç•¥toString()å®ç°\n  String toString(){}\n}\n</code></pre><h2>æ€»ç»“</h2><p>Javaè¯­è¨€æä¾›çš„çº¿ç¨‹æ± æœ¬èº«å°±æ˜¯ä¸€ç§ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼çš„å®ç°ï¼Œä½†æ˜¯çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ¯æ¬¡åªèƒ½ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­æ¶ˆè´¹ä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œï¼Œå¯¹äºå¤§éƒ¨åˆ†å¹¶å‘åœºæ™¯è¿™ç§ç­–ç•¥éƒ½æ²¡æœ‰é—®é¢˜ã€‚ä½†æ˜¯æœ‰äº›åœºæ™¯è¿˜æ˜¯éœ€è¦è‡ªå·±æ¥å®ç°ï¼Œä¾‹å¦‚éœ€è¦æ‰¹é‡æ‰§è¡Œä»¥åŠåˆ†é˜¶æ®µæäº¤çš„åœºæ™¯ã€‚</p><p>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼åœ¨åˆ†å¸ƒå¼è®¡ç®—ä¸­çš„åº”ç”¨ä¹Ÿéå¸¸å¹¿æ³›ã€‚åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹ï¼Œä½ å¯ä»¥å€ŸåŠ©åˆ†å¸ƒå¼æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMQï¼‰æ¥å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ã€‚MQä¸€èˆ¬éƒ½ä¼šæ”¯æŒä¸¤ç§æ¶ˆæ¯æ¨¡å‹ï¼Œä¸€ç§æ˜¯ç‚¹å¯¹ç‚¹æ¨¡å‹ï¼Œä¸€ç§æ˜¯å‘å¸ƒè®¢é˜…æ¨¡å‹ã€‚è¿™ä¸¤ç§æ¨¡å‹çš„åŒºåˆ«åœ¨äºï¼Œç‚¹å¯¹ç‚¹æ¨¡å‹é‡Œä¸€ä¸ªæ¶ˆæ¯åªä¼šè¢«ä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œå’ŒJavaçš„çº¿ç¨‹æ± éå¸¸ç±»ä¼¼ï¼ˆJavaçº¿ç¨‹æ± çš„ä»»åŠ¡ä¹Ÿåªä¼šè¢«ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼‰ï¼›è€Œå‘å¸ƒè®¢é˜…æ¨¡å‹é‡Œä¸€ä¸ªæ¶ˆæ¯ä¼šè¢«å¤šä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ç§æ¶ˆæ¯çš„å¹¿æ’­ï¼Œåœ¨å¤šçº¿ç¨‹ç¼–ç¨‹é¢†åŸŸï¼Œä½ å¯ä»¥ç»“åˆè§‚å¯Ÿè€…æ¨¡å¼å®ç°å¹¿æ’­åŠŸèƒ½ã€‚</p><h2>è¯¾åæ€è€ƒ</h2><p>åœ¨æ—¥å¿—ç»„ä»¶å¼‚æ­¥åˆ·ç›˜çš„ç¤ºä¾‹ä»£ç ä¸­ï¼Œå†™æ—¥å¿—çš„çº¿ç¨‹ä»¥ <code>while(true){}</code> çš„æ–¹å¼æ‰§è¡Œï¼Œä½ æœ‰å“ªäº›åŠæ³•å¯ä»¥ä¼˜é›…åœ°ç»ˆæ­¢è¿™ä¸ªçº¿ç¨‹å‘¢ï¼Ÿ</p><pre><code>this.writer.execute(()-&gt;{\n  try {\n    //æœªåˆ·ç›˜æ—¥å¿—æ•°é‡\n    int curIdx = 0;\n    long preFT=System.currentTimeMillis();\n    while (true) {\n    ......\n    }\n  } catch(Exception e) {}\n}    \n</code></pre><p>æ¬¢è¿åœ¨ç•™è¨€åŒºä¸æˆ‘åˆ†äº«ä½ çš„æƒ³æ³•ï¼Œä¹Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºè®°å½•ä½ çš„æ€è€ƒè¿‡ç¨‹ã€‚æ„Ÿè°¢é˜…è¯»ï¼Œå¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ã€‚</p><p></p>","neighbors":{"left":{"article_title":"35 | ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ï¼šå¦‚ä½•ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹ï¼Ÿ","id":95847},"right":{"article_title":"37 | è®¾è®¡æ¨¡å¼æ¨¡å—çƒ­ç‚¹é—®é¢˜ç­”ç–‘","id":96736}},"comments":[{"had_liked":false,"id":96351,"user_name":"é”¦","can_delete":false,"product_type":"c1","uid":1468298,"ip_address":"","ucode":"CB0EB4B68C468B","user_header":"https://static001.geekbang.org/account/avatar/00/16/67/8a/babd74dc.jpg","comment_is_top":false,"comment_ctime":1558402212,"is_pvip":false,"replies":[{"id":"34515","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1558411839,"ip_address":"","comment_id":96351,"utype":1}],"discussion_count":1,"race_medal":0,"score":"534134346916","product_id":100023901,"comment_content":"åœ¨åº”ç”¨ç³»ç»Ÿä¸­ï¼Œæ—¥å¿—ç³»ç»Ÿä¸€èˆ¬éƒ½æ˜¯æœ€åå…³é—­çš„å§ï¼Œå› ä¸ºå®ƒè¦ä¸ºå…¶ä»–ç³»ç»Ÿå…³é—­æä¾›å†™æ—¥å¿—æœåŠ¡ã€‚æ‰€ä»¥æ—¥å¿—ç³»ç»Ÿå…³é—­æ—¶éœ€è¦æŠŠé˜Ÿåˆ—ä¸­æ‰€æœ‰æ—¥å¿—éƒ½æ¶ˆè´¹æ‰æ‰èƒ½å…³é—­ã€‚<br>å¯èƒ½éœ€è¦åœ¨å…³é—­æ—¥å¿—ç³»ç»Ÿæ—¶æŠ•å…¥ä¸€ä¸ªæ¯’ä¸¸ï¼Œè¡¨ç¤ºæ²¡æœ‰æ–°çš„æ—¥å¿—å†™å…¥ã€‚çº¿ç¨‹æ± åœ¨æ¶ˆè´¹åˆ°æ¯’ä¸¸æ—¶çŸ¥é“æ²¡æœ‰æ—¥å¿—å†™å…¥ï¼Œå°†æ‰€æœ‰çš„æ—¥å¿—åˆ·ç›˜ï¼Œbreakå¾ªç¯ä½“ã€‚<br>","like_count":125,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450843,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558411839,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96459,"user_name":"PKæ™‚é ­é«®ä¸äº‚","can_delete":false,"product_type":"c1","uid":1207867,"ip_address":"","ucode":"08AAAC8F4DE71D","user_header":"https://static001.geekbang.org/account/avatar/00/12/6e/3b/88f14e2a.jpg","comment_is_top":false,"comment_ctime":1558429195,"is_pvip":false,"replies":[{"id":"34581","content":"æ„Ÿè°¢æ„Ÿè°¢ï¼Œæœ‰é’±éš¾ä¹°åˆé€‚:)","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1558451095,"ip_address":"","comment_id":96459,"utype":1}],"discussion_count":4,"race_medal":0,"score":"207716859403","product_id":100023901,"comment_content":"æå®¢æ—¶é—´æœ‰å¥½å¤šè¯¾ç¨‹, æˆ‘è§‰å¾—ç‹è€å¸ˆçš„å¹²è´§æ˜¯æœ€å®é™…æœ€å¯ç”¨çš„, å¿…é¡»è¦èµä¸€ä¸ªã€‚","like_count":49,"discussions":[{"author":{"id":1008065,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/61/c1/9ad88d67.jpg","nickname":"Mr_æ¨","note":"","ucode":"AD31C2320DF6A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":46541,"discussion_content":"ç¡®å®æ˜¯ï¼Œè´­ä¹°äº†å¥½å‡ ä¸ªä¸“æ ï¼Œç‹è€å¸ˆè¿˜æœ‰ä¸ªç‹äº‰çš„æ•°æ®ç»“æ„ç®—æ³•è®²çš„å¹²è´§æœ€å¤šï¼Œ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1573179126,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450888,"discussion_content":"æ„Ÿè°¢æ„Ÿè°¢ï¼Œæœ‰é’±éš¾ä¹°åˆé€‚:)","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1558451095,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1542037,"avatar":"https://static001.geekbang.org/account/avatar/00/17/87/95/cba0a896.jpg","nickname":"å¢","note":"","ucode":"B6A9F41AEE348C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":405601,"discussion_content":"æˆ‘è§‰å¾—è¿™æ˜¯ä¸€é—¨æœ€ç»å…¸çš„å¹¶å‘è¯¾","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1634606785,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2756739,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/10/83/0facd0eb.jpg","nickname":"åˆ©å¨å°”å…µé•¿","note":"","ucode":"FDE0BD5BFB1B4A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538215,"discussion_content":"åŒæ„Ÿï¼Œå…¶ä»–è®²çš„ä¸æ˜¯ä¸æˆä½“ç³»ï¼Œå°±æ˜¯é«˜å¤§ç©ºï¼Œå‡æŠŠå¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639371705,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96916,"user_name":"Ãªï½—Ä›ï½","can_delete":false,"product_type":"c1","uid":1066707,"ip_address":"","ucode":"5000233111BEFA","user_header":"https://static001.geekbang.org/account/avatar/00/10/46/d3/e25d104a.jpg","comment_is_top":false,"comment_ctime":1558535168,"is_pvip":true,"replies":[{"id":"34753","content":"èƒ½å¿«é€Ÿå®šä½çš„é—®é¢˜ğŸ‘ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1558617371,"ip_address":"","comment_id":96916,"utype":1}],"discussion_count":4,"race_medal":0,"score":"113227684864","product_id":100023901,"comment_content":"<br>ä¹‹å‰é‡åˆ°è¿‡ä¸€ä¸ªç”Ÿäº§é—®é¢˜ï¼Œä¸€ä¸ªæœåŠ¡å¯åŠ¨ä¸€æ®µæ—¶é—´åå°±ä¸åœçš„è¶…æ—¶ï¼Œåé¢ç»“åˆçº¿ç¨‹æ ˆå‘ç°å¾ˆå¤šé˜»å¡åœ¨æ‰“å°æ—¥å¿—çš„åœ°æ–¹ï¼ˆæˆ‘ä»¬ç”¨çš„å°±æ˜¯log4j2ï¼‰ï¼Œåé¢æŸ¥åˆ°æœºå­ç¡¬ç›˜é—®é¢˜ï¼Œioç›´æ¥100%ä»¥ä¸Šï¼Œæ—¥å¿—åˆ·ç›˜æ»¡å¯¼è‡´æ¶ˆè´¹é€Ÿåº¦æ…¢ï¼Œé˜Ÿåˆ—æ’‘æ»¡é˜»å¡äº†å†™ï¼Œè¿™é—´æ¥è¯´æ˜å¹³è¡¡å¥½ç”Ÿäº§å’Œæ¶ˆè´¹é€Ÿåº¦ä»¥åŠé€‚å½“çš„é˜Ÿåˆ—å¤§å°æ˜¯å¾ˆæœ‰å¿…è¦ã€‚","like_count":27,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451062,"discussion_content":"èƒ½å¿«é€Ÿå®šä½çš„é—®é¢˜ğŸ‘ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558617371,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2288362,"avatar":"https://static001.geekbang.org/account/avatar/00/22/ea/ea/77a59153.jpg","nickname":"è€¶é©¬","note":"","ucode":"3A3CF67B016CDB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546924,"discussion_content":"å†™æ—¥å¿—çš„åŒæ­¥çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642471788,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1810156,"avatar":"","nickname":"poordickey","note":"","ucode":"2A436EC813AF97","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":340691,"discussion_content":"ä¸ºä»€ä¹ˆæ—¥å¿—å†™ ä¼šå½±å“åˆ°ä¸»çº¿ç¨‹(ä¸šåŠ¡)çš„æ‰§è¡Œå‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610098887,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2288362,"avatar":"https://static001.geekbang.org/account/avatar/00/22/ea/ea/77a59153.jpg","nickname":"è€¶é©¬","note":"","ucode":"3A3CF67B016CDB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1810156,"avatar":"","nickname":"poordickey","note":"","ucode":"2A436EC813AF97","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546947,"discussion_content":"æ—¥å¿—åŒæ­¥,é˜»å¡é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642476394,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":340691,"ip_address":""},"score":546947,"extra":""}]}]},{"had_liked":false,"id":97237,"user_name":"è‚æ—‹","can_delete":false,"product_type":"c1","uid":1193784,"ip_address":"","ucode":"40061E5AFDA99C","user_header":"https://static001.geekbang.org/account/avatar/00/12/37/38/5a3b72d4.jpg","comment_is_top":false,"comment_ctime":1558616510,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"74573060542","product_id":100023901,"comment_content":"å®‰å“çš„ä¸»çº¿ç¨‹ä¸­ä¹Ÿæ˜¯é‡‡ç”¨æ¶ˆæ¯é˜Ÿåˆ—åŠ æ¶ˆæ¯å¾ªç¯æ–¹å¼ï¼Œæ¥å¤„ç†ç”¨æˆ·è¾“å…¥åŠå„ç§äº‹ä»¶ã€‚å½“åº”ç”¨é€€å‡ºæ—¶ï¼Œä¼šå‘é€ä¸€ä¸ªå¤„ç†å¯¹è±¡ä¸ºnullçš„æ¶ˆæ¯ç»™é˜Ÿåˆ—ï¼Œæ¶ˆæ¯å¾ªç¯é‡åˆ°è¿™æ ·çš„æ¶ˆæ¯æ—¶å°±é€€å‡ºäº†ã€‚","like_count":17,"discussions":[{"author":{"id":1193784,"avatar":"https://static001.geekbang.org/account/avatar/00/12/37/38/5a3b72d4.jpg","nickname":"è‚æ—‹","note":"","ucode":"40061E5AFDA99C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":59504,"discussion_content":"å‚è§æç‰åˆšçš„ã€ŠAndroidå¼€å‘è‰ºæœ¯æ¢ç´¢ã€‹å…³äºhander/looperç« èŠ‚ï¼Œé‡Œé¢æœ‰è¯¦ç»†ä»‹ç»ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574689823,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1135912,"avatar":"https://static001.geekbang.org/account/avatar/00/11/55/28/31b0cf2f.jpg","nickname":"é»‘è‰²æ¯›è¡£","note":"","ucode":"FF7E235F91BA5C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":58441,"discussion_content":" æœ‰è¿™ä¸ªæ“ä½œå˜›ï¼Ÿè¯·æ•™ä¸‹å…·ä½“çš„ä»£ç ä½ç½®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574675911,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96730,"user_name":"è‹ç±","can_delete":false,"product_type":"c1","uid":1396252,"ip_address":"","ucode":"4FA289E084B789","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erYNBIwAj3KdIXaXbeMBUjTMz31zAToHIJSdo7oQk8bfsibwViaLobVQ8miatwBlC5spLS9kVCzHMjUA/132","comment_is_top":false,"comment_ctime":1558494043,"is_pvip":false,"replies":[{"id":"34654","content":"åªæœ‰å®ˆæŠ¤çº¿ç¨‹æ‰ä¼šè‡ªåŠ¨ç»“æŸï¼Œçº¿ç¨‹æ± çš„çº¿ç¨‹ä¸æ˜¯å®ˆæŠ¤çº¿ç¨‹","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1558535698,"ip_address":"","comment_id":96730,"utype":1}],"discussion_count":1,"race_medal":0,"score":"57393068891","product_id":100023901,"comment_content":"æ‚¨å¥½è€å¸ˆé—®ä¸ªæœ€è¿‘ç”¨åˆ°çš„çº¿ç¨‹æ± ä½¿ç”¨çš„é—®é¢˜<br>æˆ‘çš„å·¥ç¨‹æ˜¯springbootçš„ï¼Œåœ¨unitTesté‡Œï¼ˆ@SpringBootTestï¼‰ é‡Œè°ƒç”¨äº†ä¸€ä¸ªservice Aï¼ˆé€šè¿‡@Autowiredçš„ï¼‰ä¸­çš„æ–¹æ³•ï¼ŒAä¸­å¯ç”¨äº†ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œæ‰§è¡Œçš„ä»»åŠ¡ æ˜¯å¾€æ•°æ®åº“é‡Œæ’å…¥æ•°æ®ã€‚ä½†æ˜¯æ€»æŠ›å‡ºæ•°æ®æºå·²ç»è¢«å…³é—­çš„å¼‚å¸¸ï¼Œæˆ‘ç†è§£çš„æ˜¯åœ¨å•æµ‹ä¸»çº¿ç¨‹å·²ç»ç»“æŸï¼Œæ‰€ä»¥å…³é—­äº†æ•°æ®æºè¿™äº›æ¸…ç†å·¥ä½œï¼Œè€Œæ­¤æ—¶çº¿ç¨‹æ± çš„çº¿ç¨‹è¿˜<br>æ²¡ç»“æŸï¼Œè¿™ä¸ªæ—¶å€™å»è°ƒç”¨æ•°æ®æºæ˜¯null çš„ï¼Œä¸çŸ¥é“è¿™ä¹ˆç†è§£å¯¹ä¸å¯¹ï¼Œå¦å¤–è¿™ä¸ªtestä¸»çº¿ç¨‹ç»“æŸï¼Œä¸ºå•¥çº¿ç¨‹æ± çš„çº¿ç¨‹è¿˜æ²¡ç»“æŸï¼ˆé€šè¿‡æ‰“æ–­ç‚¹çœ‹åˆ°çš„ï¼‰ã€‚è¿™ä¸ªæ€ä¹ˆç†è§£ï¼Œæ±‚æ•™","like_count":13,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450991,"discussion_content":"åªæœ‰å®ˆæŠ¤çº¿ç¨‹æ‰ä¼šè‡ªåŠ¨ç»“æŸï¼Œçº¿ç¨‹æ± çš„çº¿ç¨‹ä¸æ˜¯å®ˆæŠ¤çº¿ç¨‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558535698,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121801,"user_name":"Asanz","can_delete":false,"product_type":"c1","uid":1005200,"ip_address":"","ucode":"430AB7ED59EE3F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/56/90/be01bb8d.jpg","comment_is_top":false,"comment_ctime":1565226125,"is_pvip":false,"replies":[{"id":"44972","content":"éœ€è¦","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1565429473,"ip_address":"","comment_id":121801,"utype":1}],"discussion_count":1,"race_medal":0,"score":"48809866381","product_id":100023901,"comment_content":"çœ‹åˆ°å¾ˆå¤šç¤ºä¾‹ä»£ç éƒ½æ²¡æœ‰å…³é—­çº¿ç¨‹æ± çš„åŠ¨ä½œï¼Œéš¾é“å±€éƒ¨çš„çº¿ç¨‹æ± å°±ä¸è¦å…³é—­å—ï¼Ÿ","like_count":11,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461954,"discussion_content":"éœ€è¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565429473,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":203394,"user_name":"Geek_c22199","can_delete":false,"product_type":"c1","uid":1441876,"ip_address":"","ucode":"1CE5B65513E360","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI2vn8hyjICTCletGs0omz28lhriaZKX2XX9icYzAEon2IEoRnlXqyOia2bEPP0j7T6xexTnr77JJic8w/132","comment_is_top":false,"comment_ctime":1586183869,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"44535856829","product_id":100023901,"comment_content":"è¿™æ®µä»£ç æ¼‚äº®å•Š<br><br>&#47;&#47;é˜»å¡å¼è·å–ä¸€æ¡ä»»åŠ¡<br>  Task t = bq.take();<br>  while (t != null) {<br>    ts.add(t);<br>    &#47;&#47;éé˜»å¡å¼è·å–ä¸€æ¡ä»»åŠ¡<br>    t = bq.poll();<br>  }","like_count":11,"discussions":[{"author":{"id":1333649,"avatar":"https://static001.geekbang.org/account/avatar/00/14/59/91/fa2d8bb2.jpg","nickname":"ä¸åƒè¾£ğŸ‘¾","note":"","ucode":"B25E0725B5E85F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586765,"discussion_content":"è¿™ç§å’Œå…¨é˜»å¡çš„æ¯” å¥½åœ¨å“ªé‡Œäº†ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662480556,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æµ™æ±Ÿ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":134381,"user_name":"ç”Ÿæ´»å‘è¨€æƒ","can_delete":false,"product_type":"c1","uid":1136291,"ip_address":"","ucode":"B6269BE979DF35","user_header":"https://static001.geekbang.org/account/avatar/00/11/56/a3/0141096a.jpg","comment_is_top":false,"comment_ctime":1568815200,"is_pvip":false,"replies":[{"id":"51545","content":"é«˜å¹¶å‘ä¸‹ï¼Œæˆ‘è§‰å¾—ä¸»è¦æ˜¯åšå¥½é™æµå’Œç¼“å­˜ï¼Œä¿æŠ¤å¥½ç“¶é¢ˆèµ„æºæ•°æ®åº“ï¼Œé™æµå’Œç¼“å­˜çš„æ–¹æ¡ˆè¦çœ‹æµé‡å¤§å°å’Œç³»ç»Ÿæ¶æ„","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1568854798,"ip_address":"","comment_id":134381,"utype":1}],"discussion_count":2,"race_medal":4,"score":"40223520864","product_id":100023901,"comment_content":"è¯·é—®ä¸€ä¸‹é«˜å¹¶å‘åœºæ™¯ï¼Œå››ä¸ªäººæ‹¼ä¸€ä¸ªå›¢ï¼Œæ€ä¹ˆæ‹¼ï¼Ÿ<br>1.dbé‡Œè®°å½•æ‹¼å›¢äººæ•°ï¼Œå¦‚æœå°äº4åˆ™ç›´æ¥updateåˆ°æ‹¼å›¢ç”¨æˆ·è¡¨ï¼Œå¦åˆ™åˆ›å»ºæ–°çš„æ‹¼å›¢idï¼Œæ–°çš„è®°å½•ã€‚<br>2.é«˜å¹¶å‘åœºæ™¯ï¼Œæ€ä¹ˆä¿è¯è¯»å†™dbçš„ä¸€è‡´æ€§ï¼Ÿrediså’ŒdbåŒå†™ï¼Ÿ<br>3.æœŸå¾…è€å¸ˆé«˜è§","like_count":9,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":467724,"discussion_content":"é«˜å¹¶å‘ä¸‹ï¼Œæˆ‘è§‰å¾—ä¸»è¦æ˜¯åšå¥½é™æµå’Œç¼“å­˜ï¼Œä¿æŠ¤å¥½ç“¶é¢ˆèµ„æºæ•°æ®åº“ï¼Œé™æµå’Œç¼“å­˜çš„æ–¹æ¡ˆè¦çœ‹æµé‡å¤§å°å’Œç³»ç»Ÿæ¶æ„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568854798,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2308075,"avatar":"","nickname":"Geek_89e362","note":"","ucode":"E596C2CFE1CFAF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":328595,"discussion_content":"è¿™ä¸ªåº”è¯¥èƒ½é€šè¿‡ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼å®ç°ï¼Œ\n1ã€å¦‚æœå•èŠ‚ç‚¹å¯ä»¥å…ˆæŠŠæ‹¼å›¢ä¿¡æ¯ä¿å­˜åˆ°æœ¬åœ°ç¼“å­˜ä¸­ï¼Œç­‰åˆ°å‡‘å¤Ÿå››ä¸ªäººï¼Œç»Ÿä¸€åˆ·å¤§æ•°æ®åº“ä¸­ã€‚æ­¤ç§æ–¹å¼è¦è€ƒè™‘å®•æœºï¼Œæ•°æ®ä¸¢å¤±çš„é—®é¢˜ã€‚\n2ã€å¦‚æœæ˜¯é›†ç¾¤å¯ä»¥é€šè¿‡ redis åšåˆ†å¸ƒå¼ç¼“å­˜ï¼ŒæŠŠæ•°æ®å­˜åˆ°redisä¸­ï¼Œå¦èµ·çº¿ç¨‹å®šæ—¶æŸ¥è¯¢redisï¼Œå¦‚æœå‡‘å¤Ÿå››ä¸ªå°±ç›´æ¥åˆ·å¤§ï¼Œç£ç›˜ä¸­ã€‚è¿™æ ·redis æŒä¹…åŒ–æ–¹å¼è¦é…ç½®æˆaofå®æ—¶åˆ·ç›˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606187942,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":102322,"user_name":"berthav_ss","can_delete":false,"product_type":"c1","uid":1268906,"ip_address":"","ucode":"A26CCBB8C8A0FB","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJDgV2qia6eALwftiakMorogZMBunfVvRr52gXQ3WbfDb5hyFtvFZnWMltLd1vNIQLxuBHkDibPefbXA/132","comment_is_top":false,"comment_ctime":1560203846,"is_pvip":false,"replies":[{"id":"37233","content":"å¯ä»¥è€ƒè™‘ä¸€ä¸‹æ¯’ä¸¸çš„æ–¹å¼","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1560348364,"ip_address":"","comment_id":102322,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35919942214","product_id":100023901,"comment_content":"å®ä»¤è€å¸ˆï¼Œå¦‚ä½•ä¼˜é›…çš„åœæ­¢çº¿ç¨‹æ± ä¸­æŸä¸€ç»„çº¿ç¨‹å‘¢ï¼Ÿä¾‹å¦‚æˆ‘åœ¨çº¿ç¨‹aä¸­å¯åŠ¨äº†1-10çº¿ç¨‹ï¼Œçº¿ç¨‹bä¸­å¯åŠ¨äº†2-30çº¿ç¨‹ï¼Œå¦‚ä½•ä¼˜é›…åœæ­¢1-10çº¿ç¨‹å‘¢","like_count":8,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453357,"discussion_content":"å¯ä»¥è€ƒè™‘ä¸€ä¸‹æ¯’ä¸¸çš„æ–¹å¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560348364,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96354,"user_name":"æ³›å²æœˆçš„æ¶Ÿæ¼ª","can_delete":false,"product_type":"c1","uid":1104605,"ip_address":"","ucode":"1C27878EFBD3CC","user_header":"https://static001.geekbang.org/account/avatar/00/10/da/dd/c9735ee8.jpg","comment_is_top":false,"comment_ctime":1558402453,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23033238933","product_id":100023901,"comment_content":"1ã€ä½¿ç”¨çº¿ç¨‹æ± çš„shutdownæˆ–è€…shutdownNowå…³é—­çº¿ç¨‹æ± <br>2ã€whileå¾ªç¯æ¡ä»¶è®¾ç½®ä¸ºä¸€ä¸ªvolatile booleanå˜é‡<br>3ã€å¯ä»¥ä½¿ç”¨interruptï¼Œä½†æ˜¯çº¿ç¨‹æ˜¯çº¿ç¨‹æ± ç®¡ç†çš„ï¼Œæ²¡æœ‰æ¶ˆè´¹è€…çº¿ç¨‹çš„å¼•ç”¨ä¸­æ–­ä¸äº†","like_count":5},{"had_liked":false,"id":96388,"user_name":"æ™“æ°","can_delete":false,"product_type":"c1","uid":1441546,"ip_address":"","ucode":"1174C88EEBF8A6","user_header":"https://static001.geekbang.org/account/avatar/00/15/ff/0a/12faa44e.jpg","comment_is_top":false,"comment_ctime":1558407487,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18738276671","product_id":100023901,"comment_content":"35è®²è¯´åˆ°ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹ï¼Œé¦–å…ˆéœ€è¦çº¿ç¨‹çŠ¶æ€è½¬æ¢ä¸ºrunnableçŠ¶æ€ï¼ˆåœ¨ç»ˆæ­¢åˆ·ç›˜çš„æ–¹æ³•ä¸­è°ƒç”¨Thread.interrupt()æ–¹æ³•ï¼‰<br>\tç„¶åå¯ä»¥é€šè¿‡è®¾ç½®æ ‡å¿—ä½æ¥è®©çº¿ç¨‹ä¼˜é›…ç»ˆæ­¢ï¼Œå…·ä½“æœ‰ä¸¤ç§æ–¹å¼ï¼š<br>\t1ã€é€šè¿‡åˆ¤æ–­çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€Thread.currentThread.isInterrupted()<br>\t2ã€è®¾ç½®è‡ªå·±çš„çº¿ç¨‹ç»ˆæ­¢æ ‡å¿—ä½ï¼Œè¯¥æ ‡å¿—ä½volatileä¿®é¥°çš„å…±äº«å˜é‡ã€‚ï¼ˆè¿™ç§æ–¹å¼éœ€è¦åœ¨ç»ˆæ­¢åˆ·ç›˜çš„æ–¹æ³•ä¸­ä¿®æ”¹è¯¥å…±äº«å˜é‡çš„å€¼ï¼‰","like_count":4},{"had_liked":false,"id":96373,"user_name":"ack","can_delete":false,"product_type":"c1","uid":1440912,"ip_address":"","ucode":"69CA1233EEA8E2","user_header":"https://static001.geekbang.org/account/avatar/00/15/fc/90/c9df0459.jpg","comment_is_top":false,"comment_ctime":1558405095,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18738274279","product_id":100023901,"comment_content":"public class Logger {<br>\t...<br>\t<br>    volatile boolean stop;<br><br>    &#47;&#47; å¯åŠ¨å†™æ—¥å¿—çº¿ç¨‹<br>    void start() throws IOException {<br>\t\t...<br>        this.es.execute(() -&gt; {<br>            try {<br>                &#47;&#47; æœªåˆ·ç›˜æ—¥å¿—æ•°é‡<br>                int curIdx = 0;<br>                long preFT = System.currentTimeMillis();<br>                while (!stop) {<br>                   \t...<br>                }<br>            } catch (InterruptedException e) {<br>                &#47;&#47; é‡æ–°è®¾ç½®çº¿ç¨‹ä¸­æ–­çŠ¶æ€<br>                Thread.currentThread().interrupt();<br>            } catch (Exception e) {<br>                e.printStackTrace();<br>            } finally {<br>\t\t\t\t...<br>            }<br>        });<br>    }<br>\t...<br>    void stop(){<br>        stop = true;<br>        es.shutdown();<br>    }<br>}","like_count":4},{"had_liked":false,"id":117743,"user_name":"null","can_delete":false,"product_type":"c1","uid":1024294,"ip_address":"","ucode":"F9039EFED6B55D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","comment_is_top":false,"comment_ctime":1564123071,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14449024959","product_id":100023901,"comment_content":"private BlockingQueue&lt;X&gt; bq = new LinkedBlockingQueue&lt;&gt;(1000);<br><br>&#47;&#47; ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–æ‰¹é‡ä»»åŠ¡<br>List&lt;X&gt; pollTasks() throws InterruptedException{<br>  List&lt;X&gt; ts=new LinkedList&lt;&gt;();<br><br>  X t = bq.take();<br>  while (t != null) {<br>    ts.add(t);<br>    t = bq.poll();<br>  }<br><br>  return ts;<br>}<br><br>-----<br><br>éœ€æ±‚èƒŒæ™¯ï¼šï¼ˆä¸€ä¸ªçº¿ç¨‹å¾€ bq å†™æ•°æ®ï¼Œä¸‰ä¸ªçº¿ç¨‹ä» bq è¯»æ•°æ®ï¼‰<br>1. çº¿ç¨‹ A ä»æ•°æ®åº“æ‰¹é‡è¯»å–æ•°æ®ï¼Œæ¯æ¬¡è¯» 1000 æ¡è®°å½•ï¼Œç„¶ååœ¨ for å¾ªç¯å†…å†™å…¥é˜Ÿåˆ— bq.put(x)ã€‚<br>2. çº¿ç¨‹ Bã€çº¿ç¨‹ Cã€çº¿ç¨‹ D è°ƒç”¨ pollTasks() æ–¹æ³•è·å–æ•°æ®åˆ—è¡¨ï¼Œç„¶åå°†æ•°æ®åˆ—è¡¨åšä¸ºå‚æ•°ï¼Œè°ƒç”¨ Y æ¥å£è·å–ä¸€æ‰¹æ•°æ®ï¼Œæœ€åè¿›è¡Œä¸šåŠ¡è¿ç®—ã€‚<br><br>-----<br><br>è·‘ demo æ—¶å‘ç° pollTasks() æ–¹æ³•æœ‰ä¸¤ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼ˆä¸€æ˜¯ï¼šè·å–çš„åˆ—è¡¨æ•°é‡ä¸å‡ï¼ŒäºŒæ˜¯ï¼šé€€åŒ–æˆå•å…ƒç´ åˆ—è¡¨ï¼‰ï¼š<br>1. çº¿ç¨‹ Bã€Cã€D è°ƒç”¨ pollTasks() è·å¾—çš„åˆ—è¡¨ï¼Œæ•°æ®é‡ä¸å‡åŒ€ï¼Œä¾‹å¦‚çº¿ç¨‹ B åªè¯»å–åˆ° 10+ ä¸ªå…ƒç´ ï¼Œè€Œçº¿ç¨‹ C å´è¯»å–äº† 1000+ ä¸ªå…ƒç´ ã€‚<br>2. å¦‚æœæˆ‘ä¸Šæ¸¸å†™å…¥é˜Ÿåˆ— bq é€Ÿåº¦è¾ƒæ…¢ï¼ˆé€šè¿‡ä¸€äº›å¤æ‚çš„è¿ç®—å†å†™å…¥ bqï¼‰ï¼Œè¿™æ—¶ä¸‹æ¸¸é€šè¿‡ pollTasks() è·å–çš„åˆ—è¡¨ï¼Œå‡ ä¹éƒ½æ˜¯åªæœ‰ä¸€ä¸ªå…ƒç´ çš„åˆ—è¡¨ã€‚<br><br><br>åˆ—è¡¨æ•°æ®ä¸å‡ï¼Œå¯ä»¥å¢åŠ è¿”å›åˆ—è¡¨çš„ä¸Šé™ï¼Œæˆ–è€…å¢åŠ è¶…æ—¶æœºåˆ¶ã€‚<br><br>é€€åŒ–æˆå•å…ƒç´ åˆ—è¡¨ï¼š<br>1. pollTasks() çš„è°ƒç”¨æ–¹ä¸»åŠ¨ç­‰å¾…ç‰‡åˆ»ï¼Œå†è·å–æ•°æ®ã€‚<br>2. ä¿®æ”¹ pollTasks() çš„å®ç°ï¼Œè¿”å›åˆ—è¡¨çš„å‰ææ¡ä»¶æ˜¯ï¼šåˆ—è¡¨çš„ size å¿…é¡» batchSizeLimit ä¸‹é™ï¼Œå¦åˆ™ç­‰å¾…è¶…æ—¶ System.currentTimeMillis()-startMillis&gt;1000ã€‚<br>","like_count":4,"discussions":[{"author":{"id":1740281,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/8d/f9/ceb39113.jpg","nickname":"hostfoxÂ²â°Â²â°","note":"","ucode":"0D987C733D7CCB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":205924,"discussion_content":"èµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584358764,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":97026,"user_name":"æ›¾è½¼éºŸ","can_delete":false,"product_type":"c1","uid":1451391,"ip_address":"","ucode":"D418371AC11270","user_header":"https://static001.geekbang.org/account/avatar/00/16/25/7f/473d5a77.jpg","comment_is_top":false,"comment_ctime":1558573660,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14443475548","product_id":100023901,"comment_content":"è¡¥å……ä¸€ä¸‹ä¸Šé¢çš„ç•™è¨€ï¼Œå…ˆé€šè¿‡åˆ›å»ºçš„é’©å­å»åˆ›å»ºä¸€ä¸ªæ¯’ä¸¸ï¼Œç„¶åé‡Šæ”¾èµ„æº","like_count":3},{"had_liked":false,"id":97016,"user_name":"æ›¾è½¼éºŸ","can_delete":false,"product_type":"c1","uid":1451391,"ip_address":"","ucode":"D418371AC11270","user_header":"https://static001.geekbang.org/account/avatar/00/16/25/7f/473d5a77.jpg","comment_is_top":false,"comment_ctime":1558573155,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14443475043","product_id":100023901,"comment_content":"ä½¿ç”¨Runtimeæä¾›çš„é’©å­ï¼Œç„¶ååœ¨å…³é—­å‰ï¼Œå…ˆè®©å†…éƒ¨ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œå†é‡Šæ”¾èµ„æº","like_count":3},{"had_liked":false,"id":223679,"user_name":"æ¥","can_delete":false,"product_type":"c1","uid":1048433,"ip_address":"","ucode":"2612C1D888ED03","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ff/71/c492b7fa.jpg","comment_is_top":false,"comment_ctime":1591155017,"is_pvip":true,"replies":[{"id":"94110","content":"å‡ ä¹æ‰€æœ‰å¤šçº¿ç¨‹ç¨‹åºéƒ½ä¼šæœ‰é˜Ÿåˆ—ï¼Œæ‰€ä»¥ä»åº•å±‚çœ‹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ä»é«˜å±‚çœ‹ï¼Œæ˜¯å¯¹ä¸åŒé—®é¢˜çš„æŠ½è±¡ï¼Œè®¾è®¡è¿‡ç¨‹æ˜¯ä¸€ä¸ªä»é«˜å‘ä½çš„è¿‡ç¨‹ï¼Œåœ¨é«˜å±‚æ¬¡åªå…³æ³¨æ¨¡å‹è€Œä¸å…³æ³¨å®ç°ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1604447468,"ip_address":"","comment_id":223679,"utype":1}],"discussion_count":1,"race_medal":1,"score":"10181089609","product_id":100023901,"comment_content":"ä½ å¥½æˆ‘æƒ³é—®ä¸‹ï¼Œç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼å’Œworker threadæ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«å’Œè”ç³»ï¼Ÿæˆ‘çœ‹å®ƒä»¬çš„æ ¸å¿ƒéƒ½æ˜¯ä»»åŠ¡é˜Ÿåˆ—ï¼Œéƒ½æ˜¯å…ˆæŠŠä»»åŠ¡æ”¾åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç„¶åå†ä»ä»»åŠ¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡å¹¶æ‰§è¡Œã€‚","like_count":3,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":497211,"discussion_content":"å‡ ä¹æ‰€æœ‰å¤šçº¿ç¨‹ç¨‹åºéƒ½ä¼šæœ‰é˜Ÿåˆ—ï¼Œæ‰€ä»¥ä»åº•å±‚çœ‹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ä»é«˜å±‚çœ‹ï¼Œæ˜¯å¯¹ä¸åŒé—®é¢˜çš„æŠ½è±¡ï¼Œè®¾è®¡è¿‡ç¨‹æ˜¯ä¸€ä¸ªä»é«˜å‘ä½çš„è¿‡ç¨‹ï¼Œåœ¨é«˜å±‚æ¬¡åªå…³æ³¨æ¨¡å‹è€Œä¸å…³æ³¨å®ç°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604447468,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96883,"user_name":"å¼ ä¸‰","can_delete":false,"product_type":"c1","uid":1004092,"ip_address":"","ucode":"1155528FAE1546","user_header":"https://static001.geekbang.org/account/avatar/00/0f/52/3c/d6fcb93a.jpg","comment_is_top":false,"comment_ctime":1558529163,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10148463755","product_id":100023901,"comment_content":"è¿˜æ˜¯ä¸å¤ªæ‡‚ï¼Œçº¿ç¨‹æ± çš„å®ç°æ˜¯æœ‰ä¸¤ç§æ¨¡å¼å—ï¼Ÿ Worker Thread å’Œ ç”Ÿäº§è€…-æ¶ˆè´¹è€… æ¨¡å¼ ï¼Ÿ","like_count":2},{"had_liked":false,"id":96570,"user_name":"Geek_bbbda3","can_delete":false,"product_type":"c1","uid":1504651,"ip_address":"","ucode":"737394CE472C21","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKNDKOCoZvCqoYVM1t97Q77QPLmRBGvOLYzFsh8073RicycoIuwGrIsCXpAFEyVBOxcyE3Ih1mr6Vw/132","comment_is_top":false,"comment_ctime":1558450223,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10148384815","product_id":100023901,"comment_content":"volatile stoped;<br><br>while(!stoped || bq.size() &gt;0)<br>ï½›ï½<br><br>public void shutdownï¼ˆï¼‰{<br>Stoped =true;<br>Es.shutdownï¼ˆï¼‰ï¼›<br>whileï¼ˆes.awaitUtilTimeï¼ˆ5ï¼Œtimeutil.secondsï¼‰ï½›<br>es.shutdownNowï¼ˆï¼‰ï¼›<br>ï½<br>","like_count":3},{"had_liked":false,"id":290922,"user_name":"Geek_b38255","can_delete":false,"product_type":"c1","uid":2441534,"ip_address":"","ucode":"23D66FDC18E67F","user_header":"","comment_is_top":false,"comment_ctime":1619861667,"is_pvip":false,"replies":[{"id":"105481","content":"å¾ˆå¤šæ¨¡å¼åº•å±‚å®ç°éƒ½æ˜¯ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼Œæ¨¡å¼æ›´å¤šåœ°æ˜¯ä¸ç°å®ä¸–ç•Œçš„ç±»æ¯”ï¼Œæ›´å¤šåœ°æ˜¯ä¸€ç§è§£å†³é—®é¢˜çš„æ€ç»´æ–¹å¼ã€‚ä»ç±»æ¯”çš„è§’åº¦ï¼ŒWorker Thread æ¨¡å¼å’Œç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼çš„åŒºåˆ«å°±å‡ºæ¥äº†ï¼ŒWorker Thread æ¨¡å¼æ›´è´´è¿‘ç°å®ï¼Œè€Œç”Ÿäº§è€…-æ¶ˆè´¹è€…æ›´å¤šçš„æ˜¯ä¸€ç§å®ç°å±‚é¢çš„æ¨¡å¼ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1620116354,"ip_address":"","comment_id":290922,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5914828963","product_id":100023901,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæƒ³è¯·æ•™ä¸‹ï¼Œç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ ä¸ Worker Thread æ¨¡å¼çš„åŒºåˆ«æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519325,"discussion_content":"å¾ˆå¤šæ¨¡å¼åº•å±‚å®ç°éƒ½æ˜¯ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼Œæ¨¡å¼æ›´å¤šåœ°æ˜¯ä¸ç°å®ä¸–ç•Œçš„ç±»æ¯”ï¼Œæ›´å¤šåœ°æ˜¯ä¸€ç§è§£å†³é—®é¢˜çš„æ€ç»´æ–¹å¼ã€‚ä»ç±»æ¯”çš„è§’åº¦ï¼ŒWorker Thread æ¨¡å¼å’Œç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼çš„åŒºåˆ«å°±å‡ºæ¥äº†ï¼ŒWorker Thread æ¨¡å¼æ›´è´´è¿‘ç°å®ï¼Œè€Œç”Ÿäº§è€…-æ¶ˆè´¹è€…æ›´å¤šçš„æ˜¯ä¸€ç§å®ç°å±‚é¢çš„æ¨¡å¼ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620116354,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":269678,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1608735651,"is_pvip":false,"replies":[{"id":"98294","content":"ä¼šå¾ˆå¥½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1609397027,"ip_address":"","comment_id":269678,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5903702947","product_id":100023901,"comment_content":"ç¬¬ä¸€æ®µä»£ç ï¼Œéé˜»å¡è·å–ä»»åŠ¡æ—¶ï¼Œå¦‚æœå†å•æ‰¹æ¬¡æ•°é‡ä¸Šé™æ¯”å¦‚1000ï¼Œæ˜¯ä¸æ˜¯æ›´å¥½äº›","like_count":1,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":512352,"discussion_content":"ä¼šå¾ˆå¥½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609397027,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":155297,"user_name":"é»‘è‰²æ¯›è¡£","can_delete":false,"product_type":"c1","uid":1135912,"ip_address":"","ucode":"FF7E235F91BA5C","user_header":"https://static001.geekbang.org/account/avatar/00/11/55/28/31b0cf2f.jpg","comment_is_top":false,"comment_ctime":1574675947,"is_pvip":false,"replies":[{"id":"59680","content":"å»‰ä»·æ„å‘³ç€å¯ä»¥è½»æ¾åˆ›å»ºå¾ˆå¤šï¼Œçº¿ç¨‹æ˜¯ä¸èƒ½åˆ›å»ºå¾ˆå¤šçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1574727480,"ip_address":"","comment_id":155297,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5869643243","product_id":100023901,"comment_content":"å¦‚æœä½¿ç”¨è½»é‡çº§çº¿ç¨‹ï¼Œå°±æ²¡æœ‰å¿…è¦å¹³è¡¡ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„é€Ÿåº¦å·®å¼‚äº†ï¼Œå› ä¸ºè½»é‡çº§çº¿ç¨‹æœ¬èº«å°±æ˜¯å»‰ä»·çš„ï¼Œ<br><br>ä¸ºä»€ä¹ˆå»‰ä»·å°±ä¸éœ€è¦å¹³è¡¡ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475718,"discussion_content":"å»‰ä»·æ„å‘³ç€å¯ä»¥è½»æ¾åˆ›å»ºå¾ˆå¤šï¼Œçº¿ç¨‹æ˜¯ä¸èƒ½åˆ›å»ºå¾ˆå¤šçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574727480,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1135912,"avatar":"https://static001.geekbang.org/account/avatar/00/11/55/28/31b0cf2f.jpg","nickname":"é»‘è‰²æ¯›è¡£","note":"","ucode":"FF7E235F91BA5C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":60655,"discussion_content":"æ˜ç™½äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574743775,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96391,"user_name":"ä½‘å„¿","can_delete":false,"product_type":"c1","uid":1226196,"ip_address":"","ucode":"0629888E7A5E16","user_header":"https://static001.geekbang.org/account/avatar/00/12/b5/d4/3bd5b77b.jpg","comment_is_top":false,"comment_ctime":1558407870,"is_pvip":false,"replies":[{"id":"34512","content":"é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å°±ä¸¢äº†","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1558411583,"ip_address":"","comment_id":96391,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5853375166","product_id":100023901,"comment_content":"å£°æ˜ä¸€ä¸ªvolatieå˜é‡ç”¨äºè¡¨ç¤ºçº¿ç¨‹ç»“æŸï¼Œä¸ºtrueæ—¶ï¼Œé€€å‡ºå¾ªç¯<br>","like_count":1,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450860,"discussion_content":"é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å°±ä¸¢äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558411583,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96296,"user_name":"å…”æ–¯åŸº","can_delete":false,"product_type":"c1","uid":1061320,"ip_address":"","ucode":"146A5FE2D8B301","user_header":"https://static001.geekbang.org/account/avatar/00/10/31/c8/a64e4aef.jpg","comment_is_top":false,"comment_ctime":1558396201,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5853363497","product_id":100023901,"comment_content":"å¢åŠ ä¸€ä¸ªvolatileæ ‡å¿—ä½ï¼Œåˆ·ç›˜ç»“æŸåï¼Œåˆ¤æ–­æ ‡å¿—ä½ï¼Œè¿™æ ·ä¸ä¼šå½±å“æ•°æ®è½ç›˜ï¼Œä½†æ˜¯å¯èƒ½ä¼šå‘èµ·å¬ä¹‹å5ç§’æ‰ç»“æŸã€‚æˆ–è€…ç”¨çº¿ç¨‹ä¸­æ–­æ–¹å¼ï¼Œå¤„ç†å¥½ä¸­æ–­å¼‚å¸¸ä»¥åŠä¸­æ–­æ ‡è¯†å³å¯","like_count":1},{"had_liked":false,"id":96285,"user_name":"å¯†ç 123456","can_delete":false,"product_type":"c1","uid":1126593,"ip_address":"","ucode":"9889463CC0EA71","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/c1/2dde6700.jpg","comment_is_top":false,"comment_ctime":1558392936,"is_pvip":false,"replies":[{"id":"34516","content":"å¯è§ï¼Œä¸­æ–­è¦çœ‹åœºæ™¯","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1558412064,"ip_address":"","comment_id":96285,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5853360232","product_id":100023901,"comment_content":"è®¾ç½®ä¸€ä¸ªvolitle  ã€‚è¿™é‡Œä¸­æ–­è®¾ç½®ä¸äº†ï¼Œæ²¡æœ‰å¼•ç”¨ã€‚æˆ‘è§‰å¾—ä¸€ä¸ªvoliteå…³é”®å­—å¤Ÿäº†ã€‚ä¹‹å‰è¯´happens beforeçš„æ—¶å€™è¯´ï¼Œvolitå†™ï¼Œä¼˜äºvolitè¯»ï¼Œåº”è¯¥ç«‹åˆ»å¯è§ã€‚è¿˜è¦é—®ä¸‹è€å¸ˆï¼Œè¿™ä¹ˆç†è§£å¯ä»¥å—ï¼Ÿä¸­æ–­æ˜¯ä¸æ˜¯ä¸€å®šå¿…é¡»çš„ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450813,"discussion_content":"å¯è§ï¼Œä¸­æ–­è¦çœ‹åœºæ™¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558412064,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339992,"user_name":"æ¼ åšåµ©","can_delete":false,"product_type":"c1","uid":2660316,"ip_address":"","ucode":"33704880E9790F","user_header":"https://static001.geekbang.org/account/avatar/00/28/97/dc/8eacc8f1.jpg","comment_is_top":false,"comment_ctime":1648528464,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1648528464","product_id":100023901,"comment_content":"ç”¨volatile boolean flagå­—æ®µ, while(flag),  å…¶ä»–çº¿ç¨‹ ä¿®æ”¹flagå­—æ®µä¸ºfalse æ­¤çº¿ç¨‹å°±ä¼šç»ˆæ­¢","like_count":0},{"had_liked":false,"id":291983,"user_name":"M","can_delete":false,"product_type":"c1","uid":1810576,"ip_address":"","ucode":"06F26E1D62E9C9","user_header":"https://wx.qlogo.cn/mmopen/vi_32/eLNeJNaEkwGSK7xvtamMibVLMy2MpbIqX3iaEhT7JtSnTRMRTwZ2j4HX7WAapiashbiaBDVriaXKSP0Oeic6ZAEVEXag/132","comment_is_top":false,"comment_ctime":1620636630,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1620636630","product_id":100023901,"comment_content":"<br>public class Logger {<br>    &#47;&#47;ä»»åŠ¡é˜Ÿåˆ—<br>    final BlockingQueue&lt;LogMsg&gt; bq = new LinkedBlockingQueue&lt;&gt;();<br>    &#47;&#47;flushæ‰¹é‡<br>    static final int batchSize = 500;<br>    &#47;&#47;åªéœ€è¦ä¸€ä¸ªçº¿ç¨‹å†™æ—¥å¿—<br>    ExecutorService es = Executors.newFixedThreadPool(1);<br>    &#47;&#47;ä¸­æ–­æ ‡å¿—ä½<br>    volatile boolean flag = false;<br><br><br>    &#47;&#47;å¯åŠ¨å†™æ—¥å¿—çº¿ç¨‹<br>    void start() throws IOException {<br>        File file = File.createTempFile(<br>                &quot;foo&quot;, &quot;.log&quot;);<br>        final FileWriter writer =<br>                new FileWriter(file);<br>        this.es.execute(() -&gt; {<br>            try {<br>                &#47;&#47;æœªåˆ·ç›˜æ—¥å¿—æ•°é‡<br>                int curIdx = 0;<br>                long preFT = System.currentTimeMillis();<br>                while (!flag) {<br>                    LogMsg log = bq.poll(<br>                            5, TimeUnit.SECONDS);<br>                    &#47;&#47;å†™æ—¥å¿—<br>                    if (log != null) {<br>                        writer.write(log.toString());<br>                        ++curIdx;<br>                    }<br>                    &#47;&#47;å¦‚æœä¸å­˜åœ¨æœªåˆ·ç›˜æ•°æ®ï¼Œåˆ™æ— éœ€åˆ·ç›˜<br>                    if (curIdx &lt;= 0) {<br>                        continue;<br>                    }<br>                    &#47;&#47;æ ¹æ®è§„åˆ™åˆ·ç›˜<br>                    if (log != null &amp;&amp; log.level == LEVEL.ERROR ||<br>                            curIdx == batchSize ||<br>                            System.currentTimeMillis() - preFT &gt; 5000) {<br>                        writer.flush();<br>                        curIdx = 0;<br>                        preFT = System.currentTimeMillis();<br>                    }<br>                }<br>            } catch (Exception e) {<br>                e.printStackTrace();<br>            } finally {<br>                try {<br>                    writer.flush();<br>                    writer.close();<br>                } catch (IOException e) {<br>                    e.printStackTrace();<br>                }<br>            }<br>        });<br>    }<br><br><br>    void stop() {<br>        flag = true;<br>        this.es.shutdown();<br>    }<br>}<br>","like_count":0},{"had_liked":false,"id":280273,"user_name":"Geek_a852c8","can_delete":false,"product_type":"c1","uid":2206508,"ip_address":"","ucode":"D925A9D71A76BA","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/O6qftWBakkjQHrAhF5tia21GKkQxibJaPy2nWUKc9eiaouaqb67Hj60RRKgjgHhzPmaxaHkLszcNYrDSkj21lPylQ/132","comment_is_top":false,"comment_ctime":1614148286,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614148286","product_id":100023901,"comment_content":"LogMsg log = bq.poll( 5, TimeUnit.SECONDS); è¿™ä¸ªä½ç½®ä¸å¤ªå¯¹å§ã€‚ å¦‚æœæˆ‘å‰4ç§’å†™äº†100æ¡INFOçš„æ—¥å¿—ï¼Œæ²¡æœ‰flushã€‚åé¢åˆæ²¡æœ‰æ—¥å¿—åˆ°BlockingQueueäº†ã€‚é‚£ä¹ˆä»–ç­‰5ç§’çš„è¯ï¼Œè¿”å›å€¼æ˜¯ç©ºï¼Œè¿™æ—¶å°±ä¸æ»¡è¶³ï¼šå­˜åœ¨æœªåˆ·ç›˜æ•°æ®ï¼Œä¸” 5 ç§’é’Ÿå†…æœªæ›¾åˆ·ç›˜ï¼Œéœ€è¦ç«‹å³åˆ·ç›˜ã€‚æ”¹æˆè¿™æ ·ï¼šLogMsg log = bq.poll( 5000 - (System.currentTimeMillis()-preFT), TimeUnit.MilliSECONDS); æ‰å¯¹å§","like_count":0},{"had_liked":false,"id":235153,"user_name":"delete is create","can_delete":false,"product_type":"c1","uid":1147979,"ip_address":"","ucode":"A8C751219A7746","user_header":"https://static001.geekbang.org/account/avatar/00/11/84/4b/e4738ba8.jpg","comment_is_top":false,"comment_ctime":1594909191,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1594909191","product_id":100023901,"comment_content":"pollTasks æ¶ˆè´¹è€…é‡Œ  æˆ‘è§‰å¾—æœ€å¥½è®¾ç½®ä¸€ä¸ªbatch_size å§  åˆ°äº†è¿™ä¸ªé˜ˆå€¼å°±æ‰§è¡Œå…¥åº“ï¼Œè¦ä¸é˜Ÿåˆ—é‡Œä¸€ç›´æœ‰ï¼Œé‚£å°±ä¸€ç›´å–ä¹ˆ","like_count":0},{"had_liked":false,"id":199835,"user_name":"ğŸ˜œå“ˆå“ˆ","can_delete":false,"product_type":"c1","uid":1069001,"ip_address":"","ucode":"1FF58FB3A91135","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/c9/88837387.jpg","comment_is_top":false,"comment_ctime":1585496704,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1585496704","product_id":100023901,"comment_content":"ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹ä¼˜é€‰ç°æœ‰ç¬¬ä¸‰æ–¹mq","like_count":0},{"had_liked":false,"id":173996,"user_name":"feihui","can_delete":false,"product_type":"c1","uid":1007294,"ip_address":"","ucode":"13F1D4A82BC650","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5e/be/9ea55f46.jpg","comment_is_top":false,"comment_ctime":1579856655,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1579856655","product_id":100023901,"comment_content":"æ—¥å¿—çš„é‚£ä¸ªç¨‹åºä¸­â€œLogMsg log = bq.poll( 5, TimeUnit.SECONDS);â€ å…¶ä¸­çš„ 5 æ˜¯ä¸æ˜¯åº”è¯¥æ˜¯åŠ¨æ€è®¡ç®—ä¸º System.currentTimeMillis()-preFTï¼Œä¸ç„¶ä¼šå‡ºç°æ—§æ•°æ® 10 ç§’åæ‰ä¿å­˜","like_count":0,"discussions":[{"author":{"id":1667033,"avatar":"","nickname":"Geek_c4e04c","note":"","ucode":"59632B3BA4B9F0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295545,"discussion_content":"ä½ å‘ç°çš„é—®é¢˜æ˜¯å¯¹çš„ï¼Œä½†æ˜¯è§£æ³•ä¸å¯¹ï¼Œåº”è¯¥æ”¹æˆpreFT+5000-System.currentTimeMillis()","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596244593,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":149241,"user_name":"Joker","can_delete":false,"product_type":"c1","uid":1156592,"ip_address":"","ucode":"126AF848001A1E","user_header":"https://static001.geekbang.org/account/avatar/00/11/a5/f0/8648c464.jpg","comment_is_top":false,"comment_ctime":1573177906,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573177906","product_id":100023901,"comment_content":"å¦‚æœæ²¡æœ‰é˜Ÿåˆ—çš„è¯ï¼šå°±ä¼šï¼Œä¸€ä¸ªç”Ÿäº§çº¿ç¨‹å°±éœ€è¦ä¸€ä¸ªæ¶ˆè´¹çº¿ç¨‹æ¥ç›¸äº’è·Ÿè¿›ï¼Œæ‰€ä»¥è¿™ä¸ªå°±ä½†æ˜¯æ¶ˆè´¹çš„èµ¶ä¸ä¸Šç”Ÿäº§çš„é€Ÿåº¦ï¼Œå°±å¯¼è‡´äº†ä¸¤ä¸ªé—®é¢˜ï¼š1.ç­‰å¾…ï¼Œ2.å¤šä½™çº¿ç¨‹åˆ›å»ºã€‚","like_count":0},{"had_liked":false,"id":119910,"user_name":"ç‹è—æ˜","can_delete":false,"product_type":"c1","uid":1546333,"ip_address":"","ucode":"374D68B8D3FAFC","user_header":"https://static001.geekbang.org/account/avatar/00/17/98/5d/8e91b338.jpg","comment_is_top":false,"comment_ctime":1564726640,"is_pvip":false,"replies":[{"id":"53940","content":"å–å…‰ä¸ºæ­¢","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1570718336,"ip_address":"","comment_id":119910,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1564726640","product_id":100023901,"comment_content":"è€å¸ˆå¥½ï¼æ‰¹é‡æ’å…¥ SQL çš„æ¡ˆä¾‹ä¸­ï¼Œã€é¦–å…ˆæ˜¯ä»¥é˜»å¡æ–¹å¼è·å–ä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä¸€æ¡ä»»åŠ¡ï¼Œè€Œååˆ™æ˜¯ä»¥éé˜»å¡çš„...ã€‘ä¸‹é¢çš„ä»£ç ï¼Œæ„Ÿè§‰å¦‚æœä¸€ç›´èƒ½å–åˆ°å†…å®¹ï¼Œå²‚ä¸æ˜¯é€€ä¸å‡ºå¾ªç¯ä½“äº†","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461125,"discussion_content":"å–å…‰ä¸ºæ­¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570718336,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115758,"user_name":"å°”å†¬æ©™","can_delete":false,"product_type":"c1","uid":1225224,"ip_address":"","ucode":"0B013A49BC18DA","user_header":"https://static001.geekbang.org/account/avatar/00/12/b2/08/92f42622.jpg","comment_is_top":false,"comment_ctime":1563719551,"is_pvip":false,"replies":[{"id":"42311","content":"åº”è¯¥éƒ½æ˜¯4ä¸ªç©ºæ ¼<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1563754558,"ip_address":"","comment_id":115758,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563719551","product_id":100023901,"comment_content":"å®ä»¤è€å¸ˆï¼Œç°åœ¨å¤§å…¬å¸ä»£ç è§„èŒƒéƒ½æ˜¯ç¼©è¿›ä¸¤ç©ºæ ¼ä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459274,"discussion_content":"åº”è¯¥éƒ½æ˜¯4ä¸ªç©ºæ ¼\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563754558,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115715,"user_name":"å°”å†¬æ©™","can_delete":false,"product_type":"c1","uid":1225224,"ip_address":"","ucode":"0B013A49BC18DA","user_header":"https://static001.geekbang.org/account/avatar/00/12/b2/08/92f42622.jpg","comment_is_top":false,"comment_ctime":1563703832,"is_pvip":false,"replies":[{"id":"51086","content":"ç«çœ¼é‡‘ç›ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1568507041,"ip_address":"","comment_id":115715,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563703832","product_id":100023901,"comment_content":"æ‰¹é‡æ‰§è¡Œçš„ä»£ç ç¬¬ä¸ƒè¡Œåº”è¯¥æ˜¯executorsï¼Œå°‘äº†ä¸ªe","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459249,"discussion_content":"ç«çœ¼é‡‘ç›ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568507041,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113190,"user_name":"unanao","can_delete":false,"product_type":"c1","uid":1510485,"ip_address":"","ucode":"8F81ECF05D420C","user_header":"http://thirdwx.qlogo.cn/mmopen/ajNVdqHZLLAZUMxZDXiaVdiaEq6wK8XMBBXiaA6icoQykatgybzeqicLUv3420cCPqONmTwTZBydJG5V1TiamIyeiaTxw/132","comment_is_top":false,"comment_ctime":1562911574,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562911574","product_id":100023901,"comment_content":"ä¸‹é¢ä»£ç ä½¿ç”¨drainToæ›´æ–¹ä¾¿ä¸€äº›ï¼š<br>Task t = bq.take(); <br>while (t != null) {<br>    ts.add(t); <br>    t = bp.poll();<br>}<br><br>å¯ä»¥ä¿®æ”¹ä¸ºï¼š<br>t = bq.take();<br>bq.drainTo(ts);<br>ts.add(t); <br><br><br>","like_count":0},{"had_liked":false,"id":97977,"user_name":"linqw","can_delete":false,"product_type":"c1","uid":1134138,"ip_address":"","ucode":"09DCFE98C54DD8","user_header":"https://static001.geekbang.org/account/avatar/00/11/4e/3a/86196508.jpg","comment_is_top":false,"comment_ctime":1558858077,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558858077","product_id":100023901,"comment_content":"worker Threadæ¨¡å¼ï¼Œworkerç›¸å½“äºçº¿ç¨‹æ± é‡Œé¢çš„çº¿ç¨‹<br>ç”Ÿäº§è€…-æ¶ˆè´¹è€…ï¼Œç›¸å½“äºæˆ‘ä»¬è‡ªå·±ç»´æŠ¤é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—ï¼Œå‡ºé˜Ÿæ“ä½œï¼Œç„¶åæ¯”å¦‚æ¶ˆè´¹è€…çš„è¯å°±å¯ä»¥ç›´æ¥ä½¿ç”¨çº¿ç¨‹æ± æ¥æ¶ˆè´¹ï¼Œå’Œworker Threadæ¨¡å¼çš„åŒºåˆ«å’Œè”ç³»çš„è¯ï¼Œworker Threadå°±æ˜¯çº¿ç¨‹æ± å·¥ä½œçš„çº¿ç¨‹ï¼Œç”Ÿäº§è€…æ¶ˆè´¹è€…å°±æ˜¯çº¿ç¨‹æ± ï¼ˆworker Thread + å†…éƒ¨çš„é˜Ÿåˆ—+å¯¹å†…éƒ¨é˜Ÿåˆ—çš„æ“ä½œï¼‰+å¤–éƒ¨è‡ªå·±ç»´æŠ¤çš„é˜Ÿåˆ—+å¯¹å¤–éƒ¨é˜Ÿåˆ—çš„æ“ä½œã€‚<br>è¯¾åä¹ é¢˜ï¼šå¤šåŠ ä¸ªstopï¼ˆï¼‰{terminated = true;es.shutdown()} æ–¹æ³•ï¼Œå°†ä¸Šé¢çš„while(true)æ”¹æˆwhile(!terminated)","like_count":0},{"had_liked":false,"id":97112,"user_name":"ä¸­å¹´è‹±é›„ç‹å”å”","can_delete":false,"product_type":"c1","uid":1116873,"ip_address":"","ucode":"701AC00E96A012","user_header":"https://static001.geekbang.org/account/avatar/00/11/0a/c9/3e71e615.jpg","comment_is_top":false,"comment_ctime":1558591472,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558591472","product_id":100023901,"comment_content":"æˆ‘çš„ç†è§£æ˜¯å·¥äººå’Œå·¥å‚æ˜¯è€¦åˆçš„ï¼Œå³çº¿ç¨‹æ± å¼€å§‹å°±æœ‰workeråœ¨äº†ï¼Œè€Œå·¥å‚å’Œæ¶ˆè´¹è€…åˆ™æ²¡ä»€ä¹ˆå…³ç³»","like_count":0},{"had_liked":false,"id":96596,"user_name":"ban","can_delete":false,"product_type":"c1","uid":1034204,"ip_address":"","ucode":"E523CE97E48266","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c7/dc/9408c8c2.jpg","comment_is_top":false,"comment_ctime":1558455726,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558455726","product_id":100023901,"comment_content":"æˆ‘çš„æƒ³æ³•æ˜¯ï¼šå¼„ä¸€ä¸ªvoliteå¯è§æ€§çš„æ ‡å¿—ä½ï¼Œå½“å‡ºå‘æ ‡å¿—ä½çš„æ—¶å€™æ£€æŸ¥å½“å‰æ˜¯å¦è¿˜æœ‰æ—¥å¿—ï¼Œæœ‰åˆ™å–å‡ºæ¥ï¼Œç›´åˆ°é˜»å¡é˜Ÿåˆ—ä¸ºç©ºï¼Œç„¶ååˆ·ç›˜å†™å…¥æ•°æ®ï¼Œç„¶åbreaké€€å‡ºå³å¯ã€‚<br>è€å¸ˆä½ çœ‹æ˜¯å¦å¯è¡Œ","like_count":0},{"had_liked":false,"id":96583,"user_name":"ban","can_delete":false,"product_type":"c1","uid":1034204,"ip_address":"","ucode":"E523CE97E48266","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c7/dc/9408c8c2.jpg","comment_is_top":false,"comment_ctime":1558452921,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558452921","product_id":100023901,"comment_content":" while (t != null) {<br>    ts.add(t);<br>    &#47;&#47; éé˜»å¡å¼è·å–ä¸€æ¡ä»»åŠ¡<br>    t = bq.poll();<br>  }<br><br>åŠ å…¥é›†åˆçš„æ—¶å€™ï¼Œæ˜¯ä¸æ˜¯åŠ ä¸ªæ¡æ•°é™åˆ¶æ¯”è¾ƒå¥½ï¼Œé˜²æ­¢æ•°æ®è¿‡å¤šï¼ŒæŠŠé›†åˆæ’‘çˆ†äº†","like_count":0},{"had_liked":false,"id":96393,"user_name":"ä½‘å„¿","can_delete":false,"product_type":"c1","uid":1226196,"ip_address":"","ucode":"0629888E7A5E16","user_header":"https://static001.geekbang.org/account/avatar/00/12/b5/d4/3bd5b77b.jpg","comment_is_top":false,"comment_ctime":1558407945,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558407945","product_id":100023901,"comment_content":"æˆ‘è§‰å¾—è¿™é‡Œè™½ç„¶æ²¡æœ‰ä½¿ç”¨å¯ä¸­æ–­æ“ä½œï¼Œå¦‚æœä¸è€ƒè™‘ç¬¬ä¸‰æ–¹çš„è°ƒç”¨å½±å“ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨çº¿ç¨‹ä¸­æ–­æ ‡è¯†ï¼Œåªä¸è¿‡ä¸èƒ½æ•è·å¼‚å¸¸ã€‚","like_count":0},{"had_liked":false,"id":96336,"user_name":"å¼ ä¸‰","can_delete":false,"product_type":"c1","uid":1004092,"ip_address":"","ucode":"1155528FAE1546","user_header":"https://static001.geekbang.org/account/avatar/00/0f/52/3c/d6fcb93a.jpg","comment_is_top":false,"comment_ctime":1558400562,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1558400562","product_id":100023901,"comment_content":"æ‰“å¡ï¼ç›‘æ§ç³»ç»Ÿé‚£ä¸ªä¾‹å­é‡Œè¾¹pollTasksï¼ˆï¼‰æ–¹æ³•é‡Œè¾¹çš„ whileå¾ªç¯æ€ä¹ˆé€€å‡ºï¼Ÿé‚£ä¸ªwhileå¾ªç¯ä¼šä¸€ç›´æŠŠé˜»å¡è·å–çš„ç¬¬ä¸€æ¡ä»»åŠ¡æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ã€‚","like_count":0,"discussions":[{"author":{"id":1079495,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/c7/083a3a0b.jpg","nickname":"æ–°ä¸–ç•Œ","note":"","ucode":"4473DC1505F158","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549130,"discussion_content":"whileå¾ªç¯ç¬¬ä¸€æ¬¡æ˜¯é˜»å¡è·å–æ•°æ®ï¼Œåé¢æ˜¯polléé˜»å¡ï¼Œè·å–å®Œåpollå°±ä¼šè¿”å›ä¸ºnullå°±é€€å‡ºå¾ªç¯äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643597009,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96284,"user_name":"åˆ˜ç»","can_delete":false,"product_type":"c1","uid":1056297,"ip_address":"","ucode":"0802160061241F","user_header":"https://static001.geekbang.org/account/avatar/00/10/1e/29/3eefbebf.jpg","comment_is_top":false,"comment_ctime":1558392662,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558392662","product_id":100023901,"comment_content":"ä¸€å¤§æ—©å°±æ›´æ–°äº†ï¼Œå¤Ÿæ—©çš„","like_count":0}]}