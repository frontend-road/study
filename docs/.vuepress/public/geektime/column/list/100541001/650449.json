{"id":650449,"title":"20｜TTS与语音合成：让你的机器人拥有声音","content":"<p>你好，我是徐文浩。</p><p>上一讲里，我们通过Whisper模型，让AI“听懂”了我们在说什么。我们可以利用这个能力，让AI替我们听播客、做小结。不过，这只是我们和AI的单向沟通。那我们能不能更进一步，让AI不仅能“听懂”我们说的话，通过ChatGPT去回答我们问的问题，最后还能让AI把这些内容合成为语音，“说”给我们听呢？</p><p>当然可以，这也是我们这一讲的主题，我会带你一起来让AI说话。和上一讲一样，我不仅会教你如何使用云端API来做语音合成（Text-To-Speech），也会教你使用开源模型，给你一个用本地CPU就能实现的解决方案。这样，你也就不用担心数据安全的问题了。</p><h2>使用Azure云进行语音合成</h2><p>语音合成其实已经是一个非常成熟的技术了，现在在很多短视频平台里，你听到的很多配音其实都是通过语音合成技术完成的。国内外的各大公司都有类似的云服务，比如<a href=\"https://www.xfyun.cn/services/online_tts\">科大讯飞</a>、<a href=\"https://ai.aliyun.com/nls/tts\">阿里云</a>、<a href=\"https://ai.baidu.com/tech/speech/tts\">百度</a>、<a href=\"https://aws.amazon.com/cn/polly/\">AWS Polly</a>、<a href=\"https://cloud.google.com/text-to-speech\">Google Cloud</a>等等。不过，今天我们先来体验一下微软Azure云的语音合成API。选用Azure，主要有两个原因。</p><ol>\n<li>因为微软和OpenAI有合作，Azure还提供了OpenAI相关模型的托管。这样，我们在实际的生产环境使用的时候，只需要和一个云打交道就好了。</li>\n<li>价格比较便宜，并且提供了免费的额度。如果你每个月的用量在50万个字符以内，那么就不用花钱。</li>\n</ol><!-- [[[read_end]]] --><p>在运行代码之前，你需要先去注册一个Azure云的账号，并且开通<a href=\"https://azure.microsoft.com/zh-cn/products/cognitive-services/#overview\">微软认知服务</a>，然后开启对应的认知服务资源，获得自己的API Key。我在这里放了对应文档的<a href=\"https://learn.microsoft.com/en-us/azure/cognitive-services/cognitive-services-apis-create-account?tabs=multiservice%2Canomaly-detector%2Clanguage-service%2Ccomputer-vision%2Cmacos#get-the-keys-for-your-resource\">链接</a>，你照着文档一步步操作，就能完成。我在下面也放上了关键步骤的截图，具体注册过程，我就不一一介绍了。</p><p><img src=\"https://static001.geekbang.org/resource/image/e5/3c/e5b476e56ec3358e0925cacac1ee463c.png?wh=796x837\" alt=\"图片\" title=\"点击创建认知服务的链接，在自己的 Azure 云账号下，创建一个对应的认知服务\"></p><p>注：我选择了 East US 区域，因为这个区域也可以部署OpenAI的ChatGPT服务。</p><p><img src=\"https://static001.geekbang.org/resource/image/73/6f/73eaa98c11abb722b0b08dd6377cd06f.png?wh=949x492\" alt=\"图片\" title=\"在创建认知服务完成之后，在部署成功的地方，点击Go to resource进入下一个界面\"></p><p><img src=\"https://static001.geekbang.org/resource/image/08/bf/0855277b5b176c8c6f8bf5314c53eabf.png?wh=995x559\" alt=\"图片\" title=\"点击左侧的 Keys and Endpoint，然后点击右边的「复制」图标能够拿到对应的 API KEY\"></p><p>在拿到API Key之后，我还是建议你把API Key设置到环境变量里面。避免你使用Notebook或者撰写代码的时候，不小心把自己的Key暴露出去，被别人免费使用。同样的，我们也在环境变量里设置一下我们使用的Azure服务的区域eastus。</p><pre><code class=\"language-python\">export AZURE_SPEECH_KEY=YOUR_API_KEY\nexport AZURE_SPEECH_REGION=eastus\n</code></pre><p>当然，也不要忘了安装对应的Python包。</p><pre><code class=\"language-python\">pip install azure-cognitiveservices-speech\n</code></pre><h3>基本的语音合成</h3><p>账号和环境都设置好了之后，我们就可以动手来试试Azure语音合成的效果了。</p><pre><code class=\"language-python\">import os\nimport azure.cognitiveservices.speech as speechsdk\n\n# This example requires environment variables named \"SPEECH_KEY\" and \"SPEECH_REGION\"\nspeech_config = speechsdk.SpeechConfig(subscription=os.environ.get('AZURE_SPEECH_KEY'), region=os.environ.get('AZURE_SPEECH_REGION'))\naudio_config = speechsdk.audio.AudioOutputConfig(use_default_speaker=True)\n\n# The language of the voice that speaks.\nspeech_config.speech_synthesis_voice_name='zh-CN-XiaohanNeural'\n\nspeech_synthesizer = speechsdk.SpeechSynthesizer(speech_config=speech_config, audio_config=audio_config)\n\ntext = \"今天天气真不错，ChatGPT真好用。\"\n\nspeech_synthesizer.speak_text_async(text)\n</code></pre><p>运行上面这个代码，你就会听到一个女声说：“今天天气真不错，ChatGPT真好用。”</p><p>这几行代码非常简单。</p><ul>\n<li>我们先通过配置读取了API Key和Region。</li>\n<li>然后通过 speech_synthesis_voice_name这个配置参数指定了我们合成语音所使用的声音。</li>\n<li>通过 speak_text_async 这个函数，就能异步调用API服务，直接把合成的声音播放出来了。</li>\n</ul><p>通过speech_synthesis_voice_name这个参数，我们还可以选用很多别的声音，包括不同语言和不同的人。对应的列表可以在Azure的 <a href=\"https://learn.microsoft.com/en-us/azure/cognitive-services/speech-service/language-support?tabs=tts#prebuilt-neural-voices\">Language and voice support</a> 文档里面找到。我们换一个其他的voice_name，就可以把对应的语音换成男声。</p><pre><code class=\"language-python\">speech_config.speech_synthesis_voice_name='zh-CN-YunfengNeural'\nspeech_synthesizer = speechsdk.SpeechSynthesizer(speech_config=speech_config, audio_config=audio_config)\nspeech_synthesizer.speak_text_async(text)\n</code></pre><h3>指定语音的风格与角色</h3><p>如果你仔细看了 <a href=\"https://learn.microsoft.com/en-us/azure/cognitive-services/speech-service/language-support?tabs=tts#prebuilt-neural-voices\">Language and voice support</a> 的文档，你会发现它有很多很多voice_name。而且很多voice_name里，我们还有额外的两个参数可以选择，那就是Styles和Roles，它们分别代表了合成语音的语气和对应的角色。通过这两个参数，我们可以让AI把很多场景“演出来”。比如，下面的示例代码就演绎了一段母子之间关于买玩具的一段对话，你可以运行一下看看效果。</p><pre><code class=\"language-python\">ssml = \"\"\"&lt;speak version=\"1.0\" xmlns=\"http://www.w3.org/2001/10/synthesis\"\n       xmlns:mstts=\"https://www.w3.org/2001/mstts\" xml:lang=\"zh-CN\"&gt;\n    &lt;voice name=\"zh-CN-YunyeNeural\"&gt;\n        儿子看见母亲走了过来，说到：\n        &lt;mstts:express-as role=\"Boy\" style=\"cheerful\"&gt;\n            “妈妈，我想要买个新玩具”\n        &lt;/mstts:express-as&gt;\n    &lt;/voice&gt;\n    &lt;voice name=\"zh-CN-XiaomoNeural\"&gt;\n        母亲放下包，说：\n        &lt;mstts:express-as role=\"SeniorFemale\" style=\"angry\"&gt;\n            “我看你长得像个玩具。”\n        &lt;/mstts:express-as&gt;\n    &lt;/voice&gt;\n&lt;/speak&gt;\"\"\"\n\nspeech_synthesis_result = speech_synthesizer.speak_ssml_async(ssml).get()\n</code></pre><p>Azure并不是通过让你在API里面配置一些参数来指定一段文本的角色和语气，而是通过一个叫做SSML格式的XML文件做到这一点的。这个SSML是Speech Synthesis Markup Language的首字母缩写，翻译过来就是<strong>语音合成标记语言</strong>。它不是一个Azure云专属的格式，而是一个W3C的标准，所以同样的XML不仅可以用在Azure云里，也一样可以用在Google Cloud里。</p><p>通过SSML里面元素的属性配置，我们可以指定不同文本段的voice_name、role和style。比如，在上面的这个例子里面，我们就用两个voice元素，表示了两个不同的人的声音。voice 元素里面的name属性，指定了这段声音的voice_name。而在voice元素内部，你还可以内嵌mstss:express-as元素，在这个元素里我们可以指定role和style。这样一来，我们就可以让一个voice_name在不同的场景片段下，用不同的语气和角色来说话。</p><pre><code class=\"language-python\">ssml = \"\"\"&lt;speak version=\"1.0\" xmlns=\"http://www.w3.org/2001/10/synthesis\"\n       xmlns:mstts=\"https://www.w3.org/2001/mstts\" xml:lang=\"en-US\"&gt;\n    &lt;voice name=\"en-US-JennyNeural\"&gt;\n        &lt;mstts:express-as style=\"excited\"&gt;\n            That'd be just amazing!\n        &lt;/mstts:express-as&gt;\n        &lt;mstts:express-as style=\"friendly\"&gt;\n            What's next?\n        &lt;/mstts:express-as&gt;\n    &lt;/voice&gt;\n&lt;/speak&gt;\"\"\"\n\nspeech_synthesis_result = speech_synthesizer.speak_ssml_async(ssml).get()\n</code></pre><p>在我自己实际使用的体验里面，中文的语气和角色效果不算明显。但是英文的效果还是很明显的，你可以根据文档用不同的参数尝试一下。</p><p>SSML这个格式，不只支持style和role，还有更多丰富的参数可以配置，你可以去看看Azure <a href=\"https://www.w3.org/TR/speech-synthesis/\">文档的协议标准</a>。</p><h3>指定语音的输出方式</h3><p>到目前为止，我们都是使用异步调用的方式，直接把语音播放出来了。但很多时候，我们可能需要把对应的语音存储下来。那下面的代码就可以做到这一点。</p><pre><code class=\"language-python\">speech_config.speech_synthesis_language='zh-CN'\nspeech_config.speech_synthesis_voice_name='zh-CN-XiaohanNeural'\n\naudio_config = speechsdk.audio.AudioOutputConfig(filename=\"./data/tts.wav\")\n\nspeech_synthesizer = speechsdk.SpeechSynthesizer(speech_config=speech_config, audio_config=audio_config)\n\ntext = \"今天天气真不错，ChatGPT真好用\"\nspeech_synthesizer.speak_text_async(text)\n</code></pre><p>我们只需要把原先设置成 use_default_speaker=True的AudioOutputConfig，改为设置成一个 .wav的输出文件就好了。我们之后调用 speak_text_async 的函数，就会把语音输出到相应的.wav文件里。</p><pre><code class=\"language-python\">audio_config = speechsdk.audio.AudioOutputConfig(use_default_speaker=True)\n</code></pre><p>当然，你可以把对应的语音，暂时放在内存里面，而不是存储到文件系统中，也可以把输出的内容通过我们习惯的MP3格式存储下来。</p><pre><code class=\"language-python\">speech_config.set_speech_synthesis_output_format(speechsdk.SpeechSynthesisOutputFormat.Audio48Khz192KBitRateMonoMp3)\n\nspeech_synthesizer = speechsdk.SpeechSynthesizer(speech_config=speech_config, audio_config=None)\nresult = speech_synthesizer.speak_text_async(text).get()\nstream =speechsdk.AudioDataStream(result)\n\nstream.save_to_wav_file(\"./data/tts.mp3\")\n</code></pre><p>我们只需要给speech_config这个参数设定一个 synthesis_output_format 就好了。我们上面就是把输出格式设置成了一个48kHz采样、192K码率的MP3格式。然后，这一次我们把AudioConfig设置成了None。在speak_text_async函数被调用之后，我们又调用了一下get函数，拿到对应的SpeechSynthesisResult对象。然后把这个对象放到AudioDataStream里，之后我们就可以把这个AudioDataStream按照我们的需要进行处理了。这里，我们是直接把它存储成了一个MP3文件。</p><h2>使用开源模型进行语音合成</h2><p>虽然通过Azure云的API，我们可以很容易地进行语音合成，速度也很快。但很多时候因为数据安全的问题，我们还是希望能够直接在我们自己的服务器上进行语音合成。当然，这也是能够办到的，有很多开源项目都支持语音合成。</p><p>我们在这里，就不妨试一下百度开源的PaddleSpeech的语音合成功能，看看效果怎么样。</p><p>我们还是要先安装PaddleSpeech相关的Python包。</p><pre><code class=\"language-python\">%pip install paddlepaddle\n%pip install paddlespeech\n</code></pre><p>然后通过PaddleSpeech自带的TTSExecutor，可以将对应的文本内容转换成WAV文件。需要注意，这个过程中，PaddleSpeech 需要下载对应的模型，所以第一次运行的时候也要花费一定的时间。</p><pre><code class=\"language-python\">from paddlespeech.cli.tts.infer import TTSExecutor\n\ntts_executor = TTSExecutor()\n\ntext = \"今天天气十分不错，百度也能做语音合成。\"\noutput_file = \"./data/paddlespeech.wav\"\ntts_executor(text=text, output=output_file)\n</code></pre><p>PaddleSpeech的TTSExecutor，只是把你的文本输入转化成了一个WAV文件。要在Python里面播放对应的声音，我们还要借助于PyAudio这个包。对应的，我们要先安装PyAudio依赖的portaudio库，然后再安装PyAudio包。</p><p>Mac下可以通过homebrew来安装portaudio。</p><pre><code class=\"language-python\">&nbsp;brew install portaudio\n</code></pre><p>如果在Unbuntu或者Debian下，你就可以通过apt-get来安装portaudio。</p><pre><code class=\"language-python\">sudo apt-get install portaudio19-dev\n</code></pre><p>只有在portaudio安装成功之后，我们才能安装PyAudio包，不然会报缺少依赖的错误。</p><pre><code class=\"language-python\">pip install pyaudio\n</code></pre><p>通过PyAudio，我们可以直接播放WAV文件的内容了。对应的代码我放在下面了，其实我不太熟悉PyAudio库，但是这样简单的代码直接让ChatGPT帮我写，一次就能运行成功。如果你仔细读一下这段代码，也不难理解它的含义。实际就是打开了一个PyAudio的Stream，然后不断从我们的WAV文件里面读入数据，然后写入这个Stream，写入之后声音就播放出来了。如果你把 stream.write(data) 那一行去掉，那么你就会发现整个程序运行的过程里，是没有声音的。</p><pre><code class=\"language-python\">import wave\nimport pyaudio\n\ndef play_wav_audio(wav_file):\n    # open the wave file\n    wf = wave.open(wav_file, 'rb')\n\n    # instantiate PyAudio\n    p = pyaudio.PyAudio()\n\n    # open a stream\n    stream = p.open(format=p.get_format_from_width(wf.getsampwidth()),\n                    channels=wf.getnchannels(),\n                    rate=wf.getframerate(),\n                    output=True)\n\n    # read data from the wave file and play it\n    data = wf.readframes(1024)\n    while data:\n        stream.write(data)\n        data = wf.readframes(1024)\n\n    # close the stream and terminate PyAudio\n    stream.stop_stream()\n    stream.close()\n    p.terminate()\n\nplay_wav_audio(output_file)\n</code></pre><p>不过，我们调用的PaddleSpeech代码里的默认参数有一个小问题，就是它只支持中文的语音合成。如果你的文本带上英文运行一下，你会发现合成的语音里面只有中文，没有英文。</p><pre><code class=\"language-python\">tts_executor = TTSExecutor()\n\ntext = \"今天天气十分不错，Paddle Speech也能做语音合成。\"\noutput_file = \"./data/paddlespeech_missing.wav\"\ntts_executor(text=text, output=output_file)\n\nplay_wav_audio(output_file)\n</code></pre><p>运行上面的代码，你会发现，PaddleSpeech在合成的语音里面丢失了。<br>\n这是因为，PaddleSpeech默认情况下使用的是一个只支持中文的模型。我们可以通过一些参数来指定使用的模型，一样能够做中英文混合的语音合成。</p><p>对应的代码：</p><pre><code class=\"language-python\">tts_executor = TTSExecutor()\n\ntext = \"早上好, how are you? 百度Paddle Speech一样能做中英文混合的语音合成。\"\noutput_file = \"./data/paddlespeech_mix.wav\"\ntts_executor(text=text, output=output_file, \n             am=\"fastspeech2_mix\", voc=\"hifigan_csmsc\", \n             lang=\"mix\", spk_id=174)\n\nplay_wav_audio(output_file)\n</code></pre><p>可以看到，和上面的代码相比，我们增加了4个参数。</p><ul>\n<li>am，是acoustic model的缩写，也就是我们使用的声学模型。我们这里选用的是fastspeech2_mix。fastspeech2也是一个基于Transformer的语音合成模型，速度快、质量高。这里带了一个mix，代表这个模型是支持中英文混合生成的。</li>\n<li>voc，是vocoder的缩写，叫做音码器。声学模型只是把我们的文本变成了一个声音波形的信号。我们还需要通过音码器，把声学模型给出的波形变成可以播放的音频。我们这里选择的HiFiGAN_csMSC，是一个高保真（HiFi）、基于对抗生成网络（GAN）技术的模型，它的训练数据用到了HiFiSinger和csMSC，而模型的名字就来自这些关键词的组合。</li>\n<li>lang，代表我们模型支持的语言，这里我们自然应该选mix。</li>\n<li>spk_id，类似于我们之前在Azure里看到的voice_name，不同的spk_id 听起来就是不同的人说的话。</li>\n</ul><p>运行这个代码，一样能够正常地生成中英文混合的语音内容。如果你想要了解PaddleSpeech的语音合成功能，还有它所支持的各种模型和各种应用场景，可以参看GitHub上的 <a href=\"https://github.com/PaddlePaddle/PaddleSpeech/blob/develop/demos/text_to_speech/README_cn.md\">Demo 文档</a>。</p><h2>小结</h2><p>好了，这一讲到这里也就结束了。</p><p>这一讲我们学会了两种语音合成的方式。一种是使用Azure云提供的API，另一种则是使用百度开源的PaddleSpeech。Azure云的语音合成，不仅仅是能简单地把文本变成人声，还能通过SSML这个W3C标准下的XML标记语言，指定不同的人声（voice_name）、语气（style）还有角色（role）。这些功能都是非常有实用价值的，能够帮助我们处理各种场景下的语音合成需求。</p><p>而PaddleSpeech则带给了我们一个开源方案，并且它也支持中英文混合在一起的语音生成。它背后可供选择的模型里，我们使用的也是基于Transformer的fastspeech2模型。可以看到，目前Transformer类型的模型在各个领域都已经占据了主流。</p><p>学到这里，我们的AI就拥有了声音。而在下一讲里，我会拿我们已经学到的知识，搭建一个可以通过语音和你聊天的机器人。并且更进一步地，我们还会为它配上你的虚拟形象，希望你和我一样对下一讲充满期待！</p><h2>思考题</h2><p>最后，给你留一道思考题。PaddleSpeech不仅能拿来做语音合成，也能用来做语音识别。你能试试看用它做语音识别的效果吗？和OpenAI Whisper比起来，你觉得它们两个哪个效果更好？欢迎你把你体验之后的感受分享出来，也欢迎你把这一讲分享给需要的朋友，我们下一讲再见！</p><h2>推荐阅读</h2><p>PaddleSpeech的<a href=\"https://github.com/PaddlePaddle/PaddleSpeech/blob/develop/README_cn.md\">中文文档</a>里面，包含了大量使用PaddleSpeech这个开源库的场景和方法，你有兴趣可以去看一看。百度的PaddlePaddle的社区里面，也有专门的<a href=\"https://aistudio.baidu.com/aistudio/education/group/info/25130\">语音相关的课程</a>，如果你想深入了解的话，也可以去看一看。</p>","comments":[{"had_liked":false,"id":373283,"user_name":"胡萝卜","can_delete":false,"product_type":"c1","uid":2456594,"ip_address":"上海","ucode":"54DF5159C1704C","user_header":"https://static001.geekbang.org/account/avatar/00/25/7c/12/7b9a2efb.jpg","comment_is_top":false,"comment_ctime":1682338923,"is_pvip":false,"replies":[{"id":136477,"content":"👍 bark是最近比较火的一个模型","user_name":"作者回复","user_name_real":"编辑","uid":1053568,"ctime":1683085674,"ip_address":"上海","comment_id":373283,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"这个英文转语音效果不错 https:&#47;&#47;github.com&#47;suno-ai&#47;bark","like_count":7,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"徐文浩","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":616711,"discussion_content":"👍 bark是最近比较火的一个模型","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1683085674,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1026894,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ab/4e/82e9657c.jpg","nickname":"jeff","note":"","ucode":"68456DD035BDF4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":626633,"discussion_content":"支持中文吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1693219728,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"河北","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":373223,"user_name":"Toni","can_delete":false,"product_type":"c1","uid":3206957,"ip_address":"瑞士","ucode":"E6B2FACCC1E000","user_header":"https://static001.geekbang.org/account/avatar/00/30/ef/2d/757bb0d3.jpg","comment_is_top":false,"comment_ctime":1682258293,"is_pvip":false,"replies":[{"id":136456,"content":"👍","user_name":"作者回复","user_name_real":"编辑","uid":1053568,"ctime":1683082901,"ip_address":"上海","comment_id":373223,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"尝试用百度的 PaddlePaddle，将语音文件(.wav) 转换成文字(语音识别)。\n\n1. 语音中只含中文，实现代码如下:\n\nfrom paddlespeech.cli.asr.infer import ASRExecutor\nasr = ASRExecutor()\naudio_file=&quot;.&#47;data&#47;BaiduTTS&#47;zh.wav&quot;\nresult = asr(audio_file=audio_file)\nprint(result)\n\n输出结果:\n我认为跑步最重要的就是给我带来了身体健康\n语音原文:\n我认为跑步最重要的就是给我带来了身体健康\n\n2. 语音为中英文混合的文件 &quot;.&#47;data&#47;BaiduTTS&#47;paddlespeech_mix_1.wav&quot;，用上面的代码运行\n\n输出结果: \n早上好哈沃尔姨百度他都斯一样能做中英文混合的语音合成\n语音原文:\n早上好, how are you? 百度 Paddle Speech 一样能做中英文混合的语音合成\n\n处理中英文混合的语音文件，进行语音识别时，需要给 ASRExecutor() 添加参数，代码如下:\n\nfrom paddlespeech.cli.asr import ASRExecutor\nasr = ASRExecutor()\naudio_file=&quot;.&#47;data&#47;BaiduTTS&#47;paddlespeech_mix_1.wav&quot;\nresult = asr(model=&#39;conformer_talcs&#39;, lang=&#39;zh_en&#39;, codeswitch=True, sample_rate=16000, audio_file=audio_file, config=None, ckpt_path=None, force_yes=False)\nprint(result)\n\n输出结果:\n早上好 how are you 百度它读 speech 一样能做中英文混合的语音合成\n\n对照语音原文，ASRExecutor() 将语音 &quot;百度 Paddle Speech&quot; 转成了 &quot;百度它读 speech&quot;，并不完美。\n\n期待更好的解决方案。\n\n参考:\n【PaddleSpeech】一键预测，快速上手Speech开发任务\nhttps:&#47;&#47;aistudio.baidu.com&#47;aistudio&#47;projectdetail&#47;4353348?sUid=2470186&amp;shared=1&amp;ts=1660878142250\n\n一文读懂 PaddleSpeech 中英混合语音识别技术\nhttps:&#47;&#47;xie.infoq.cn&#47;article&#47;c05479afe4291255d91ed950f\n\nLoad specified model files for TTS cli #2225\nhttps:&#47;&#47;github.com&#47;PaddlePaddle&#47;PaddleSpeech&#47;issues&#47;2225\n\nPaddlePaddle&#47;PaddleSpeech\nhttps:&#47;&#47;github.com&#47;PaddlePaddle&#47;PaddleSpeech&#47;blob&#47;develop&#47;demos&#47;audio_tagging&#47;README_cn.md\n","like_count":6,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"徐文浩","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":616678,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1683082901,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2238528,"avatar":"https://static001.geekbang.org/account/avatar/00/22/28/40/82d748e6.jpg","nickname":"小理想。","note":"","ucode":"EDC35A907570DB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":629093,"discussion_content":"需要其他操作吗，如注册是什么的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1696663158,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":3206957,"avatar":"https://static001.geekbang.org/account/avatar/00/30/ef/2d/757bb0d3.jpg","nickname":"Toni","note":"","ucode":"E6B2FACCC1E000","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2238528,"avatar":"https://static001.geekbang.org/account/avatar/00/22/28/40/82d748e6.jpg","nickname":"小理想。","note":"","ucode":"EDC35A907570DB","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":629118,"discussion_content":"不需要","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1696681042,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":629093,"ip_address":"瑞士","group_id":0},"score":629118,"extra":""}]}]},{"had_liked":false,"id":373097,"user_name":"zhihai.tu","can_delete":false,"product_type":"c1","uid":1045888,"ip_address":"上海","ucode":"61371EA3EF6988","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f5/80/baddf03b.jpg","comment_is_top":false,"comment_ctime":1682038029,"is_pvip":true,"replies":[{"id":136476,"content":"OpenAI没有，语音是相对比较成熟的领域，各种开源和商业的方案很多，价格也比较便宜。","user_name":"作者回复","user_name_real":"编辑","uid":1053568,"ctime":1683085647,"ip_address":"上海","comment_id":373097,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"openai本身没有tts的api吗？期待下一讲。","like_count":2,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"徐文浩","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":616710,"discussion_content":"OpenAI没有，语音是相对比较成熟的领域，各种开源和商业的方案很多，价格也比较便宜。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1683085647,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2611118,"avatar":"https://static001.geekbang.org/account/avatar/00/27/d7/ae/95811a6b.jpg","nickname":"欧阳","note":"","ucode":"7EEFC51EA025A4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":615146,"discussion_content":"回楼上，我记得OpenAI的Whisper，本身就是asr+tts啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1682065101,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1045888,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f5/80/baddf03b.jpg","nickname":"zhihai.tu","note":"","ucode":"61371EA3EF6988","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":2611118,"avatar":"https://static001.geekbang.org/account/avatar/00/27/d7/ae/95811a6b.jpg","nickname":"欧阳","note":"","ucode":"7EEFC51EA025A4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":615842,"discussion_content":"好的，谢谢。回头我看一下，我以为这个只是asr","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1682470907,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":615146,"ip_address":"上海","group_id":0},"score":615842,"extra":""}]}]},{"had_liked":false,"id":374006,"user_name":"劉仲仲","can_delete":false,"product_type":"c1","uid":3582548,"ip_address":"美国","ucode":"265814B92CE40E","user_header":"https://static001.geekbang.org/account/avatar/00/36/aa/54/bf64d522.jpg","comment_is_top":false,"comment_ctime":1683480784,"is_pvip":false,"replies":[{"id":136859,"content":"看看是否浏览器权限设置不能播放声音？","user_name":"作者回复","user_name_real":"编辑","uid":1053568,"ctime":1684752232,"ip_address":"上海","comment_id":374006,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"老师，为甚么我用Azure语音服务，在jupyter notebook上已经跑通而且可以播放声音，但是一部署到hugging face上面就发不出声音呢","like_count":0,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"徐文浩","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":619042,"discussion_content":"看看是否浏览器权限设置不能播放声音？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1684752232,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":373331,"user_name":"Steven","can_delete":false,"product_type":"c1","uid":1253652,"ip_address":"辽宁","ucode":"3FE64459842015","user_header":"https://static001.geekbang.org/account/avatar/00/13/21/14/423a821f.jpg","comment_is_top":false,"comment_ctime":1682402657,"is_pvip":false,"replies":[{"id":136483,"content":"👍","user_name":"作者回复","user_name_real":"编辑","uid":1053568,"ctime":1683086489,"ip_address":"上海","comment_id":373331,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"补充 Windows 下安装 portaudio 库：\n1，下载安装 MSYS2：\n     https:&#47;&#47;www.msys2.org&#47;\n2，MSYS2 安装完成后在其命令行窗口中执行：\n     pacman -S mingw-w64-x86_64-portaudio\n","like_count":0,"discussions":[{"author":{"id":1053568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/13/80/8de66543.jpg","nickname":"徐文浩","note":"","ucode":"1D39AC564172E9","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":616719,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1683086489,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":380220,"user_name":"jeff","can_delete":false,"product_type":"c1","uid":1026894,"ip_address":"河北","ucode":"68456DD035BDF4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ab/4e/82e9657c.jpg","comment_is_top":false,"comment_ctime":1693219574,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"除去 PaddleSpeech 还有其他成熟方案吗？适合生产用的","like_count":1,"discussions":[{"author":{"id":2404902,"avatar":"https://static001.geekbang.org/account/avatar/00/24/b2/26/fc8c2091.jpg","nickname":"大朝子","note":"","ucode":"F06BBD84E8454B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":655123,"discussion_content":"chatTTS? meloTTS?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1734249455,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"江苏","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":380222,"user_name":"jeff","can_delete":false,"product_type":"c1","uid":1026894,"ip_address":"河北","ucode":"68456DD035BDF4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ab/4e/82e9657c.jpg","comment_is_top":false,"comment_ctime":1693219830,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"M1 芯片可以跑起来 paddleSpeech 吗？\n","like_count":0},{"had_liked":false,"id":380217,"user_name":"jeff","can_delete":false,"product_type":"c1","uid":1026894,"ip_address":"河北","ucode":"68456DD035BDF4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ab/4e/82e9657c.jpg","comment_is_top":false,"comment_ctime":1693217688,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"paddlepaddle 在 colab 安装失败....","like_count":0},{"had_liked":false,"id":376943,"user_name":"蓝胖子","can_delete":false,"product_type":"c1","uid":1976188,"ip_address":"浙江","ucode":"66BC21362C2907","user_header":"https://static001.geekbang.org/account/avatar/00/1e/27/7c/aefc1ae2.jpg","comment_is_top":false,"comment_ctime":1687759543,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"老师，有没有克隆声音的比较好的开源库推荐，类似 MockingBird 的？","like_count":0},{"had_liked":false,"id":375833,"user_name":"厚积薄发","can_delete":false,"product_type":"c1","uid":1206674,"ip_address":"北京","ucode":"8640C07176C249","user_header":"https://static001.geekbang.org/account/avatar/00/12/69/92/69c2c135.jpg","comment_is_top":false,"comment_ctime":1686039136,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100541001,"comment_content":"老师，PaddleSpeech  转换语音很慢，有没有什么好办法","like_count":0,"discussions":[{"author":{"id":1164626,"avatar":"https://static001.geekbang.org/account/avatar/00/11/c5/52/63008fc7.jpg","nickname":"xuwei","note":"","ucode":"07268C1743839F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":625263,"discussion_content":"你有GPU吗\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1691502431,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":375797,"user_name":"厚积薄发","can_delete":false,"product_type":"c1","uid":1206674,"ip_address":"北京","ucode":"8640C07176C249","user_header":"https://static001.geekbang.org/account/avatar/00/12/69/92/69c2c135.jpg","comment_is_top":false,"comment_ctime":1685978337,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100541001,"comment_content":"老师，colab 安装pyaudio 报错ERROR: Could not build wheels for pyaudio, which is required to install pyproject.toml-based projects。是不是colab 不能安装pyaudio，老师您没有写colab或者类centos下安装portaudio的命令","like_count":0}]}