{"id":71064,"title":"07 | 案例篇：系统中出现大量不可中断进程和僵尸进程怎么办？（上）","content":"<p>你好，我是倪朋飞。</p><p>上一节，我用一个 Nginx+PHP 的案例，给你讲了服务器 CPU 使用率高的分析和应对方法。这里你一定要记得，当碰到无法解释的 CPU 使用率问题时，先要检查一下是不是短时应用在捣鬼。</p><p>短时应用的运行时间比较短，很难在 top 或者 ps 这类展示系统概要和进程快照的工具中发现，你需要使用记录事件的工具来配合诊断，比如 execsnoop 或者 perf top。</p><p>这些思路你不用刻意去背，多练习几次，多在操作中思考，你便能灵活运用。</p><p>另外，我们还讲到 CPU 使用率的类型。除了上一节提到的用户 CPU 之外，它还包括系统 CPU（比如上下文切换）、等待 I/O 的 CPU（比如等待磁盘的响应）以及中断 CPU（包括软中断和硬中断）等。</p><p>我们已经在上下文切换的文章中，一起分析了系统 CPU 使用率高的问题，剩下的等待 I/O 的 CPU 使用率（以下简称为 iowait）升高，也是最常见的一个服务器性能问题。今天我们就来看一个多进程I/O的案例，并分析这种情况。</p><h2>进程状态</h2><p>当 iowait 升高时，进程很可能因为得不到硬件的响应，而长时间处于不可中断状态。从 ps 或者 top 命令的输出中，你可以发现它们都处于 D 状态，也就是不可中断状态（Uninterruptible Sleep）。既然说到了进程的状态，进程有哪些状态你还记得吗？我们先来回顾一下。</p><!-- [[[read_end]]] --><p>top 和 ps 是最常用的查看进程状态的工具，我们就从 top 的输出开始。下面是一个 top 命令输出的示例，S列（也就是 Status  列）表示进程的状态。从这个示例里，你可以看到 R、D、Z、S、I 等几个状态，它们分别是什么意思呢？</p><pre><code>$ top\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n28961 root      20   0   43816   3148   4040 R   3.2  0.0   0:00.01 top\n  620 root      20   0   37280  33676    908 D   0.3  0.4   0:00.01 app\n    1 root      20   0  160072   9416   6752 S   0.0  0.1   0:37.64 systemd\n 1896 root      20   0       0      0      0 Z   0.0  0.0   0:00.00 devapp\n    2 root      20   0       0      0      0 S   0.0  0.0   0:00.10 kthreadd\n    4 root       0 -20       0      0      0 I   0.0  0.0   0:00.00 kworker/0:0H\n    6 root       0 -20       0      0      0 I   0.0  0.0   0:00.00 mm_percpu_wq\n    7 root      20   0       0      0      0 S   0.0  0.0   0:06.37 ksoftirqd/0\n</code></pre><p>我们挨个来看一下：</p><ul>\n<li>\n<p><strong>R</strong> 是 Running 或 Runnable 的缩写，表示进程在 CPU 的就绪队列中，正在运行或者正在等待运行。</p>\n</li>\n<li>\n<p><strong>D</strong> 是 Disk Sleep 的缩写，也就是不可中断状态睡眠（Uninterruptible Sleep），一般表示进程正在跟硬件交互，并且交互过程不允许被其他进程或中断打断。</p>\n</li>\n<li>\n<p><strong>Z</strong> 是 Zombie 的缩写，如果你玩过“植物大战僵尸”这款游戏，应该知道它的意思。它表示僵尸进程，也就是进程实际上已经结束了，但是父进程还没有回收它的资源（比如进程的描述符、PID 等）。</p>\n</li>\n<li>\n<p><strong>S</strong> 是 Interruptible Sleep 的缩写，也就是可中断状态睡眠，表示进程因为等待某个事件而被系统挂起。当进程等待的事件发生时，它会被唤醒并进入 R 状态。</p>\n</li>\n<li>\n<p><strong>I</strong> 是 Idle 的缩写，也就是空闲状态，用在不可中断睡眠的内核线程上。前面说了，硬件交互导致的不可中断进程用 D 表示，但对某些内核线程来说，它们有可能实际上并没有任何负载，用 Idle 正是为了区分这种情况。要注意，D 状态的进程会导致平均负载升高， I 状态的进程却不会。</p>\n</li>\n</ul><p>当然了，上面的示例并没有包括进程的所有状态。除了以上 5 个状态，进程还包括下面这2个状态。</p><p>第一个是 <strong>T 或者 t</strong>，也就是 Stopped 或 Traced 的缩写，表示进程处于暂停或者跟踪状态。</p><p>向一个进程发送 SIGSTOP 信号，它就会因响应这个信号变成暂停状态（Stopped）；再向它发送 SIGCONT 信号，进程又会恢复运行（如果进程是终端里直接启动的，则需要你用 fg 命令，恢复到前台运行）。</p><p>而当你用调试器（如 gdb）调试一个进程时，在使用断点中断进程后，进程就会变成跟踪状态，这其实也是一种特殊的暂停状态，只不过你可以用调试器来跟踪并按需要控制进程的运行。</p><p>另一个是 <strong>X</strong>，也就是 Dead 的缩写，表示进程已经消亡，所以你不会在 top 或者 ps 命令中看到它。</p><p>了解了这些，我们再回到今天的主题。先看不可中断状态，这其实是为了保证进程数据与硬件状态一致，并且正常情况下，不可中断状态在很短时间内就会结束。所以，短时的不可中断状态进程，我们一般可以忽略。</p><p>但如果系统或硬件发生了故障，进程可能会在不可中断状态保持很久，甚至导致系统中出现大量不可中断进程。这时，你就得注意下，系统是不是出现了 I/O 等性能问题。</p><p>再看僵尸进程，这是多进程应用很容易碰到的问题。正常情况下，当一个进程创建了子进程后，它应该通过系统调用 wait() 或者 waitpid() 等待子进程结束，回收子进程的资源；而子进程在结束时，会向它的父进程发送 SIGCHLD 信号，所以，父进程还可以注册 SIGCHLD 信号的处理函数，异步回收资源。</p><p>如果父进程没这么做，或是子进程执行太快，父进程还没来得及处理子进程状态，子进程就已经提前退出，那这时的子进程就会变成僵尸进程。换句话说，父亲应该一直对儿子负责，善始善终，如果不作为或者跟不上，都会导致“问题少年”的出现。</p><p>通常，僵尸进程持续的时间都比较短，在父进程回收它的资源后就会消亡；或者在父进程退出后，由 init 进程回收后也会消亡。</p><p>一旦父进程没有处理子进程的终止，还一直保持运行状态，那么子进程就会一直处于僵尸状态。大量的僵尸进程会用尽 PID 进程号，导致新进程不能创建，所以这种情况一定要避免。</p><h2>案例分析</h2><p>接下来，我将用一个多进程应用的案例，带你分析大量不可中断状态和僵尸状态进程的问题。这个应用基于 C 开发，由于它的编译和运行步骤比较麻烦，我把它打包成了一个 <a href=\"https://github.com/feiskyer/linux-perf-examples/tree/master/high-iowait-process\">Docker 镜像</a>。这样，你只需要运行一个 Docker 容器就可以得到模拟环境。</p><h3>你的准备</h3><p>下面的案例仍然基于 Ubuntu 18.04，同样适用于其他的 Linux 系统。我使用的案例环境如下所示：</p><ul>\n<li>\n<p>机器配置：2 CPU，8GB 内存</p>\n</li>\n<li>\n<p>预先安装 docker、sysstat、dstat 等工具，如 apt install <a href=\"http://docker.io\">docker.io</a> dstat sysstat</p>\n</li>\n</ul><p>这里，dstat 是一个新的性能工具，它吸收了 vmstat、iostat、ifstat 等几种工具的优点，可以同时观察系统的 CPU、磁盘 I/O、网络以及内存使用情况。</p><p>接下来，我们打开一个终端，SSH 登录到机器上，并安装上述工具。</p><p>注意，以下所有命令都默认以 root 用户运行，如果你用普通用户身份登陆系统，请运行 sudo su root 命令切换到 root 用户。</p><p>如果安装过程有问题，你可以先上网搜索解决，实在解决不了的，记得在留言区向我提问。</p><blockquote>\n<p>温馨提示：案例应用的核心代码逻辑比较简单，你可能一眼就能看出问题，但实际生产环境中的源码就复杂多了。所以，我依旧建议，操作之前别看源码，避免先入为主，而要把它当成一个黑盒来分析，这样你可以更好地根据现象分析问题。你姑且当成你工作中的一次演练，这样效果更佳。</p>\n</blockquote><h3>操作和分析</h3><p>安装完成后，我们首先执行下面的命令运行案例应用：</p><pre><code>$ docker run --privileged --name=app -itd feisky/app:iowait\n</code></pre><p>然后，输入 ps 命令，确认案例应用已正常启动。如果一切正常，你应该可以看到如下所示的输出：</p><pre><code>$ ps aux | grep /app\nroot      4009  0.0  0.0   4376  1008 pts/0    Ss+  05:51   0:00 /app\nroot      4287  0.6  0.4  37280 33660 pts/0    D+   05:54   0:00 /app\nroot      4288  0.6  0.4  37280 33668 pts/0    D+   05:54   0:00 /app\n</code></pre><p>从这个界面，我们可以发现多个 app 进程已经启动，并且它们的状态分别是 Ss+ 和 D+。其中，S 表示可中断睡眠状态，D 表示不可中断睡眠状态，我们在前面刚学过，那后面的 s 和 + 是什么意思呢？不知道也没关系，查一下man ps 就可以。现在记住，s 表示这个进程是一个会话的领导进程，而 + 表示前台进程组。</p><p>这里又出现了两个新概念，<strong>进程组</strong>和<strong>会话</strong>。它们用来管理一组相互关联的进程，意思其实很好理解。</p><ul>\n<li>\n<p>进程组表示一组相互关联的进程，比如每个子进程都是父进程所在组的成员；</p>\n</li>\n<li>\n<p>而会话是指共享同一个控制终端的一个或多个进程组。</p>\n</li>\n</ul><p>比如，我们通过 SSH 登录服务器，就会打开一个控制终端（TTY），这个控制终端就对应一个会话。而我们在终端中运行的命令以及它们的子进程，就构成了一个个的进程组，其中，在后台运行的命令，构成后台进程组；在前台运行的命令，构成前台进程组。</p><p>明白了这些，我们再用 top  看一下系统的资源使用情况：</p><pre><code># 按下数字 1 切换到所有 CPU 的使用情况，观察一会儿按 Ctrl+C 结束\n$ top\ntop - 05:56:23 up 17 days, 16:45,  2 users,  load average: 2.00, 1.68, 1.39\nTasks: 247 total,   1 running,  79 sleeping,   0 stopped, 115 zombie\n%Cpu0  :  0.0 us,  0.7 sy,  0.0 ni, 38.9 id, 60.5 wa,  0.0 hi,  0.0 si,  0.0 st\n%Cpu1  :  0.0 us,  0.7 sy,  0.0 ni,  4.7 id, 94.6 wa,  0.0 hi,  0.0 si,  0.0 st\n...\n\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n 4340 root      20   0   44676   4048   3432 R   0.3  0.0   0:00.05 top\n 4345 root      20   0   37280  33624    860 D   0.3  0.0   0:00.01 app\n 4344 root      20   0   37280  33624    860 D   0.3  0.4   0:00.01 app\n    1 root      20   0  160072   9416   6752 S   0.0  0.1   0:38.59 systemd\n...\n</code></pre><p>从这里你能看出什么问题吗？细心一点，逐行观察，别放过任何一个地方。忘了哪行参数意思的话，也要及时返回去复习。</p><p>好的，如果你已经有了答案，那就继续往下走，看看跟我找的问题是否一样。这里，我发现了四个可疑的地方。</p><ul>\n<li>\n<p>先看第一行的平均负载（ Load Average），过去1 分钟、5 分钟和 15 分钟内的平均负载在依次减小，说明平均负载正在升高；而 1 分钟内的平均负载已经达到系统的 CPU 个数，说明系统很可能已经有了性能瓶颈。</p>\n</li>\n<li>\n<p>再看第二行的 Tasks，有 1 个正在运行的进程，但僵尸进程比较多，而且还在不停增加，说明有子进程在退出时没被清理。</p>\n</li>\n<li>\n<p>接下来看两个 CPU 的使用率情况，用户 CPU 和系统 CPU 都不高，但 iowait 分别是 60.5% 和 94.6%，好像有点儿不正常。</p>\n</li>\n<li>\n<p>最后再看每个进程的情况， CPU 使用率最高的进程只有 0.3%，看起来并不高；但有两个进程处于 D 状态，它们可能在等待 I/O，但光凭这里并不能确定是它们导致了 iowait 升高。</p>\n</li>\n</ul><p>我们把这四个问题再汇总一下，就可以得到很明确的两点：</p><ul>\n<li>\n<p>第一点，iowait 太高了，导致系统的平均负载升高，甚至达到了系统 CPU 的个数。</p>\n</li>\n<li>\n<p>第二点，僵尸进程在不断增多，说明有程序没能正确清理子进程的资源。</p>\n</li>\n</ul><p>那么，碰到这两个问题该怎么办呢？结合我们前面分析问题的思路，你先自己想想，动手试试，下节课我来继续“分解”。</p><h2>小结</h2><p>今天我们主要通过简单的操作，熟悉了几个必备的进程状态。用我们最熟悉的 ps 或者 top ，可以查看进程的状态，这些状态包括运行（R）、空闲（I）、不可中断睡眠（D）、可中断睡眠（S）、僵尸（Z）以及暂停（T）等。</p><p>其中，不可中断状态和僵尸状态，是我们今天学习的重点。</p><ul>\n<li>\n<p>不可中断状态，表示进程正在跟硬件交互，为了保护进程数据和硬件的一致性，系统不允许其他进程或中断打断这个进程。进程长时间处于不可中断状态，通常表示系统有 I/O 性能问题。</p>\n</li>\n<li>\n<p>僵尸进程表示进程已经退出，但它的父进程还没有回收子进程占用的资源。短暂的僵尸状态我们通常不必理会，但进程长时间处于僵尸状态，就应该注意了，可能有应用程序没有正常处理子进程的退出。</p>\n</li>\n</ul><h2>思考</h2><p>最后，我想请你思考一下今天的课后题，案例中发现的这两个问题，你会怎么分析呢？又应该怎么解决呢？你可以结合前面我们做过的案例分析，总结自己的思路，提出自己的问题。</p><p>欢迎在留言区和我讨论，也欢迎把这篇文章分享给你的同事、朋友。我们一起在实战中演练，在交流中进步。</p><p><img src=\"https://static001.geekbang.org/resource/image/56/52/565d66d658ad23b2f4997551db153852.jpg?wh=1110*549\" alt=\"\"></p>","neighbors":{"left":{"article_title":"06 | 案例篇：系统的 CPU 使用率很高，但为啥却找不到高 CPU 的应用？","id":70822},"right":{"article_title":"08 | 案例篇：系统中出现大量不可中断进程和僵尸进程怎么办？（下）","id":71382}},"comments":[{"had_liked":false,"id":46758,"user_name":"白华","can_delete":false,"product_type":"c1","uid":1315666,"ip_address":"","ucode":"FC9BACFCA6E8C1","user_header":"https://static001.geekbang.org/account/avatar/00/14/13/52/db1b01fc.jpg","comment_is_top":false,"comment_ctime":1543978035,"is_pvip":false,"replies":[{"id":"16765","content":"iowait不高是因为案例IO操作不够大导致的。我重新推了一个docker镜像，麻烦再试下看看","user_name":"作者回复","comment_id":46758,"uid":"1001282","ip_address":"","utype":1,"ctime":1544017650,"user_name_real":"倪朋飞"}],"discussion_count":4,"race_medal":0,"score":"302191688755","product_id":100020901,"comment_content":"老师以后的案例能不能使用centos7系统进行操作？做的很多实验和你的都会有部分偏差，这次偏差更大，相信学习你课程的大部分都是用虚拟机跑的项目，用centos系统使用率会很高，而且实际生产中用centos系统肯定大于Ubuntu，造成的实验偏差会不会也是系统的原因。我也遇到了没有出现D状态的进程，出现了大量Z进程。平均负载并没有提升，反而是下降了。iowait并没有变化。所以恳请您使用centos系统来教学吧","like_count":71,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431533,"discussion_content":"iowait不高是因为案例IO操作不够大导致的。我重新推了一个docker镜像，麻烦再试下看看","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1544017650,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1110039,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f0/17/796a3d20.jpg","nickname":"言十年","note":"","ucode":"67B8B49C3A3B17","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392077,"discussion_content":"我用的centos。刚开始 docker run --privileged --name=app -itd feisky/app:iowait /app -d /dev/vda1 -s 67108864 -c 20\n模拟除了d，没有看到z。于是想着把 写入的大小跟次数调小。z就有了。但是没看见D了。我估计系统跟硬件的差异。观察的现象得多次模拟了吧。\n改为docker run --privileged --name=app -itd feisky/app:iowait /app -d /dev/vda1 -s 37108864 -c 10\n于是又调了下，都有了\n\n  docker run --privileged --name=app -itd feisky/app:iowait /app -d /dev/vda1 -s 67108864 -c 10","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1630815025,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1924030,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/5b/be/631f41e8.jpg","nickname":"青柠二锅头","note":"","ucode":"5F77053D30B757","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1110039,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f0/17/796a3d20.jpg","nickname":"言十年","note":"","ucode":"67B8B49C3A3B17","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":411805,"discussion_content":"我试了下，1 core  4G  机器卡死了  对我机器来说可能值有点大了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636008913,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":392077,"ip_address":""},"score":411805,"extra":""}]},{"author":{"id":1112139,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f8/4b/5ae62b10.jpg","nickname":"Geek_b04b12","note":"","ucode":"F8705A21FCDF09","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2671,"discussion_content":"我运行那条docker命令，我用的是自己的ubuntu系统，\n机器配置：\n               12 核 CPU ， 16G 内存 \n                刚开始还能操作，后期直接是卡死了，更别说执行命令了，不知道老师在比较卡的状态，如何操作？ 其实，在生产环境中，出现这种卡死的状况真的没有办法，只有重启机器了。。不知道这种解决思路是否正确。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1563852057,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48043,"user_name":"书林","can_delete":false,"product_type":"c1","uid":1064791,"ip_address":"","ucode":"28D3224E8CBB6B","user_header":"https://static001.geekbang.org/account/avatar/00/10/3f/57/a014199a.jpg","comment_is_top":false,"comment_ctime":1544329037,"is_pvip":false,"replies":[{"id":"17852","content":"谢谢分享，见到Docker高手了😊。 这样的确可以达到IO限制的目的，不过使用系统级工具分析的时候，会有很大不同，比如iostat看看磁盘使用率可能还是很空闲；或者看看内核调用栈也有些不同。<br><br>不过这倒是不错的性能隔离方案👍","user_name":"作者回复","comment_id":48043,"uid":"1001282","ip_address":"","utype":1,"ctime":1544746839,"user_name_real":"倪朋飞"}],"discussion_count":3,"race_medal":0,"score":"276422235981","product_id":100020901,"comment_content":"每个人的机器配置不一样，所以会出现有的机器iowait不明显，有的机器被打爆。解决办法是用docker cgroup选项对 block io做限制。假设硬盘设备为 &#47;dev&#47;nvme0n1，测试如下：<br>1. 限制块设备的读写 iops 为 3: `docker run --privileged --name=app9 --device &#47;dev&#47;nvme0n1:&#47;dev&#47;nvme0n1 --device-write-iops &#47;dev&#47;nvme0n1:3 --device-read-iops &#47;dev&#47;nvme0n1:3  -itd feisky&#47;app:iowait-new2`<br>2. 可以查看host机器 cgroup 已为对应 docker container 添加了相关限制：<br>```<br>cat &#47;sys&#47;fs&#47;cgroup&#47;blkio&#47;docker&#47;&quot;docker-container-id&quot;&#47;blkio.throttle.write_iops_device<br>259:0 3<br>cat &#47;sys&#47;fs&#47;cgroup&#47;blkio&#47;docker&#47;&quot;docker-container-id&quot;&#47;blkio.throttle.read_iops_device<br>259:0 3<br>```<br>3.  <br>```<br>docker exec -it  &quot;docker-container-id&quot; &#47;bin&#47;bash<br>root@4cc5e6c74cc0:&#47;# dd iflag=direct if=&#47;dev&#47;nvme0n1 of=&#47;dev&#47;null bs=1k count=1000<br>1000+0 records in<br>1000+0 records out<br>1024000 bytes (1.0 MB, 1000 KiB) copied, 340.004 s, 3.0 kB&#47;s<br>```<br>`dd` 每次从 &#47;dev&#47;nvme0n1 设备读取数据写到 &#47;dev&#47;null 设备，每次读取 1kB，一共1000次，必须为 direct 选项。可以观测到拷贝速度为 3 kB&#47;s，即 1kB * 3，说明cgroup 限制 `blkio.throttle.read_iops_device` 生效。<br><br>4. 观察host机器 iowait 已经上去。<br>```<br>top - 12:10:22 up  1:25,  1 user,  load average: 0.88, 0.81, 0.83<br>任务: 780 total,   1 running, 227 sleeping,   0 stopped, 552 zombie<br>%Cpu0  :  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 s<br>%Cpu1  :  2.7 us,  0.0 sy,  0.0 ni, 97.3 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 s<br>%Cpu2  :  0.0 us,  0.0 sy,  0.0 ni,  0.0 id,100.0 wa,  0.0 hi,  0.0 si,  0.0 s<br>%Cpu3  :  5.3 us,  7.9 sy,  0.0 ni, 84.2 id,  0.0 wa,  0.0 hi,  2.6 si,  0.0 s<br>MiB Mem :   7863.3 total,    230.4 free,   3847.2 used,   3785.8 buff&#47;cache<br>MiB Swap:   8192.0 total,   8191.5 free,      0.5 used.   3191.1 avail Mem <br>```<br>zombie数那么高是因为这个 docker container 已经运行20多分钟了。<br><br>供大家参考:)","like_count":65,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432001,"discussion_content":"谢谢分享，见到Docker高手了😊。 这样的确可以达到IO限制的目的，不过使用系统级工具分析的时候，会有很大不同，比如iostat看看磁盘使用率可能还是很空闲；或者看看内核调用栈也有些不同。\n\n不过这倒是不错的性能隔离方案👍","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1544746839,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1112139,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f8/4b/5ae62b10.jpg","nickname":"Geek_b04b12","note":"","ucode":"F8705A21FCDF09","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2709,"discussion_content":"楼主说的很有道理，在研究这些参数，并提供一份不错的文档，链接如下:\nhttps://www.centos.bz/2017/08/docker-limit-container-cpu-memory-io/\n\n既然老师在文章中会多次用到docker ，建议大家把这个docker 尽量熟悉一下，对内存，和cpu，以及磁盘等做一下限制，防止了宿主的机器死机 ，本人的是ubuntu ，直接运行文章中的命令，会导致自己的主机都无法使用；\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1563873623,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1076487,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIKoEicqUZTJly55qoUXRmK4wia7YbnibsMncJaO6tKgKAQNJRfpMsibvfeiaukIibsCsuaic8QjQ3gOoTGA/132","nickname":"张可夫斯基","note":"","ucode":"3B8DF6D98583F2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553755,"discussion_content":"限制了cpu、内存、读写iops，运行后发现kill不掉了容器了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646053540,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47476,"user_name":"songgoogle","can_delete":false,"product_type":"c1","uid":1225810,"ip_address":"","ucode":"B45BC4007C08E7","user_header":"https://static001.geekbang.org/account/avatar/00/12/b4/52/75c44c71.jpg","comment_is_top":false,"comment_ctime":1544146764,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"181932773196","product_id":100020901,"comment_content":"麻烦换centos吧，更接近实际工作需求","like_count":42,"discussions":[{"author":{"id":1629257,"avatar":"https://static001.geekbang.org/account/avatar/00/18/dc/49/43ae1627.jpg","nickname":"Ansyear","note":"","ucode":"489CE96852EA2C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":403601,"discussion_content":"案例都是跑在docker里的，和宿主机是什么操作系统关系不大了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634116330,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2068721,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/90/f1/7f2b5e16.jpg","nickname":"CHN-Lee-玉米","note":"","ucode":"0A53080F38F229","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375932,"discussion_content":"我们公司大部分都是Debian哈哈哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621872677,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1962297,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/f1/39/b0960780.jpg","nickname":"恶魔果实","note":"","ucode":"691CD833C984AC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332459,"discussion_content":"老师您好，操作系统中说的三大状态（运行，就绪，阻塞）和这里的六七种状态到底是什么关系呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607229088,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1162800,"avatar":"https://static001.geekbang.org/account/avatar/00/11/be/30/1154657e.jpg","nickname":"风含叶","note":"","ucode":"7AE8D3963343AB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":273629,"discussion_content":"感觉看了这些有点价值不大。\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590480754,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50635,"user_name":"丁兆鹏","can_delete":false,"product_type":"c1","uid":1328106,"ip_address":"","ucode":"D48EBE5AC6F928","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ib8rSTG2Kln7m4M10qpb6ehPaWsA3dsib5OBsMDyol1QuwS6JiaBFJ6a2omytoS4QvLCHIw291IzBYrmj3W1gdNmA/132","comment_is_top":false,"comment_ctime":1545020060,"is_pvip":false,"replies":[{"id":"18487","content":"👍 高手，这是案例考虑不周了，已经在github上增加了参数","user_name":"作者回复","comment_id":50635,"uid":"1001282","ip_address":"","utype":1,"ctime":1545145140,"user_name_real":"倪朋飞"}],"discussion_count":8,"race_medal":0,"score":"138983973532","product_id":100020901,"comment_content":"centos7 中模拟一下一起docker中无法启动app<br> docker ps -a<br>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES<br>54a43bfd9ddb        feisky&#47;app:iowait   &quot;&#47;app&quot;              7 seconds ago       Exited (1) 6 seconds ago                       app<br><br>docker logs app也为空。<br><br>既然是c程序，使用gdb调试，发现在select_disk()<br><br>\tconst char *sd_prefix = &quot;sd&quot;;<br>\tconst char *xvd_prefix = &quot;xvd&quot;;<br>...<br>\t\tif (strncmp(sd_prefix, entry-&gt;d_name, 2) == 0 || strncmp(xvd_prefix, entry-&gt;d_name, 3) == 0)<br><br>看看机器上磁盘格式如下：<br>df -h<br>Filesystem      Size  Used Avail Use% Mounted on<br>&#47;dev&#47;vda1        99G   16G   79G  17% &#47;<br>&#47;dev&#47;vdb1        99G  5.5G   88G   6% &#47;data1<br><br>找到原因了,磁盘前缀不同，无法找到的盘，修改app.c代码<br>        const char *sd_prefix = &quot;vd&quot;;<br>        const char *xvd_prefix = &quot;vdb&quot;;<br><br>然后就可以正常启动了。<br>docker ps<br>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES<br>ceb6eec8129a        feisky&#47;app:iowait   &quot;&#47;app&quot;              2 seconds ago       Up 1 second                             app","like_count":33,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433045,"discussion_content":"👍 高手，这是案例考虑不周了，已经在github上增加了参数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545145140,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1629257,"avatar":"https://static001.geekbang.org/account/avatar/00/18/dc/49/43ae1627.jpg","nickname":"Ansyear","note":"","ucode":"489CE96852EA2C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":403915,"discussion_content":"可是容器里根本就没有app.c这个文件啊，在哪里改的源码？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634185339,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1110039,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f0/17/796a3d20.jpg","nickname":"言十年","note":"","ucode":"67B8B49C3A3B17","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392023,"discussion_content":"给力，跑起来了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630769482,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375293,"discussion_content":"我用的也是 CentOS，也是一直启动不起来。翻看评论，发现了解决办法。谢谢。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621564413,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1376885,"avatar":"https://static001.geekbang.org/account/avatar/00/15/02/75/2839c0bb.jpg","nickname":"谨兮谨兮","note":"","ucode":"55712DD3852169","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364961,"discussion_content":"源代码在哪可以修改","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617672546,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1705468,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/05/fc/bceb3f2b.jpg","nickname":"开心哥","note":"","ucode":"D44C1F03B23C5A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":330237,"discussion_content":"想破头也不明白，原来高手在这里。佩服了。 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606547562,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1145779,"avatar":"https://static001.geekbang.org/account/avatar/00/11/7b/b3/194f7f90.jpg","nickname":"没伞的孩子得使劲奔跑","note":"","ucode":"D015B4EF12E536","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":277675,"discussion_content":"高手是真的多啊...牛逼了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591090442,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1298046,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKZicicibGibtR5zAia782Ajc5I5BN3F3tjAdlibATIknHv67gbxeH21N7B6vbgwLjYb1miaLKhqicptB5ibYw/132","nickname":"阿飞","note":"","ucode":"F8B1FC8521264D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":273622,"discussion_content":"厉害了\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590477880,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46708,"user_name":"Johnson","can_delete":false,"product_type":"c1","uid":1225037,"ip_address":"","ucode":"55B582953E49F3","user_header":"https://static001.geekbang.org/account/avatar/00/12/b1/4d/10c75b34.jpg","comment_is_top":false,"comment_ctime":1543973184,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"65968482624","product_id":100020901,"comment_content":"遇到有大量的D状态的进程，导致负载到7000多，但是cpu和iowait都不高，除了重启设备还有什么办法解决？","like_count":15,"discussions":[{"author":{"id":2765662,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/G4jREHPsnUibpYZiaNj72fgibWL8rCzwOSEsYz4bAZvTkuVWZncCeDcUtRMpdhicyPJ9wHZoRiav7UnNaj0dW01ia9FA/132","nickname":"Geek_fcc5b3","note":"","ucode":"A08B757855F452","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":397711,"discussion_content":"我是新开了一个窗口，执行了sleep 120 &amp;&amp; docker stop app。避免控制台到时候卡顿直接命令都敲不出来","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632663525,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1585964,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKOHxVZKoHOYIvP5Nk2NqoJ9NkVaiasjFYtcam3MY8MgjOIcPNPrObNMHEaKpozjFeOmqicpJ3JVgsA/132","nickname":"Geek_18cecd","note":"","ucode":"D166873BD29FE4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371268,"discussion_content":"重装","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619701646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2288440,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/bnE6A7diaOmMbOSYnu11Be9WibOSdSCs1ibRpiavUJ0q2vE1XGoicDLufZziato07AgNd43B8LetSOIOCibw0uO9zrqJw/132","nickname":"Geek_340f72","note":"","ucode":"04143CCC5430A5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":352450,"discussion_content":"可以通过改进程的状态退出","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614741761,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2288440,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/bnE6A7diaOmMbOSYnu11Be9WibOSdSCs1ibRpiavUJ0q2vE1XGoicDLufZziato07AgNd43B8LetSOIOCibw0uO9zrqJw/132","nickname":"Geek_340f72","note":"","ucode":"04143CCC5430A5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":352449,"discussion_content":"D 进程你能kill 掉？搞笑吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614741730,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2066801,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/W0VEO7Hxzd61mia6Ls2EpBmaZ0l9q7SFUAErbu4XKIjWLmlALr4ybpicDoI8SoXY8XJNKmk04Ep1ibTCuFvfCF8GQ/132","nickname":"Chen","note":"","ucode":"5D0F3DF807706E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":325093,"discussion_content":"kill掉进程？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605234185,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47187,"user_name":"白华","can_delete":false,"product_type":"c1","uid":1315666,"ip_address":"","ucode":"FC9BACFCA6E8C1","user_header":"https://static001.geekbang.org/account/avatar/00/14/13/52/db1b01fc.jpg","comment_is_top":false,"comment_ctime":1544071309,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"53083678861","product_id":100020901,"comment_content":"今天重新进行了测试，用了你docker hub上的fix2，fix1，new，new2都进行测试了，发现还是不行，iowait没有升高，平均负载没有上升，没有发现D状态。希望你以后使用centos7系统进行操作，性能会好很多","like_count":12,"discussions":[{"author":{"id":1290865,"avatar":"https://static001.geekbang.org/account/avatar/00/13/b2/71/76481005.jpg","nickname":"Kingdom","note":"","ucode":"A45866C5324310","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":17791,"discussion_content":"我也是，模拟不出来，感觉课程的意义不大","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568980988,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1110039,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f0/17/796a3d20.jpg","nickname":"言十年","note":"","ucode":"67B8B49C3A3B17","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1290865,"avatar":"https://static001.geekbang.org/account/avatar/00/13/b2/71/76481005.jpg","nickname":"Kingdom","note":"","ucode":"A45866C5324310","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392024,"discussion_content":"模拟出来了。centos系统","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630769627,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":17791,"ip_address":""},"score":392024,"extra":""}]}]},{"had_liked":false,"id":101107,"user_name":"黄涛","can_delete":false,"product_type":"c1","uid":1075372,"ip_address":"","ucode":"F9507BC223FA22","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIPs72cLhiaib6m4jO15AVuYicMs8ZQxm8nuxA4Ml3Sic1W81ROJK7Pa3Fj56wGX6gstzDQkDyuyKW0aA/0","comment_is_top":false,"comment_ctime":1559719005,"is_pvip":false,"replies":[{"id":"37105","content":"谢谢分享😊","user_name":"作者回复","comment_id":101107,"uid":"1001282","ip_address":"","utype":1,"ctime":1560261106,"user_name_real":"倪朋飞"}],"discussion_count":3,"race_medal":0,"score":"48804359261","product_id":100020901,"comment_content":"我是centOS，也是无法启动，参考评论中的方式，修改启动参数为：<br>docker run --privileged --name=app -itd feisky&#47;app:iowait &#47;app -d &#47;dev&#47;vdb1<br>就可以了","like_count":12,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452807,"discussion_content":"谢谢分享😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560261106,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1319529,"avatar":"https://static001.geekbang.org/account/avatar/00/14/22/69/09f7a8a2.jpg","nickname":"Don Wang","note":"","ucode":"1853365FA279F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366807,"discussion_content":"top - 10:45:45 up 53 min,  2 users,  load average: 50.21, 18.43, 6.78\nTasks: 185 total,  75 running, 110 sleeping,   0 stopped,   0 zombie\n%Cpu0  : 43.5 us, 49.6 sy,  0.0 ni,  0.0 id,  0.0 wa,  0.0 hi,  6.9 si,  0.0 st\n%Cpu1  : 42.6 us, 50.4 sy,  0.0 ni,  0.0 id,  0.0 wa,  0.0 hi,  7.0 si,  0.0 st\nKiB Mem :  8009024 total,  2470388 free,  4872108 used,   666528 buff/cache\nKiB Swap:        0 total,        0 free,        0 used.  2885496 avail Mem \n\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                           \n 3735 root      20   0   70040  65528     44 R   3.3  0.8   0:20.62 app                                                               \n 3771 root      20   0   70040  65528     44 R   3.3  0.8   0:05.69 app                                                               \n 3807 root      20   0   70040  65528     44 R   3.3  0.8   0:01.10 app                                                               \n 3810 root      20   0   70040  65528     44 R   3.3  0.8   0:00.78 app                                                               \n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618195561,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1319529,"avatar":"https://static001.geekbang.org/account/avatar/00/14/22/69/09f7a8a2.jpg","nickname":"Don Wang","note":"","ucode":"1853365FA279F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366806,"discussion_content":"虽然可以启动 但还是有些问题,  平均负载虽然打上去了, 但是僵尸进程还是保持0, wa等待时间也是0....","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618195500,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46976,"user_name":"每天晒白牙","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1544013985,"is_pvip":false,"discussion_count":1,"race_medal":1,"score":"44493686945","product_id":100020901,"comment_content":"【D7补卡】<br>在和老师多次交流下，终于逼得老师发布一个把自己机器跑死的镜像，就可以了，结果和老师的温和了。看到老师之前的例子io压力还是不够啊<br>docker run --privileged --name=app -itd feisky&#47;app:iowait-new2<br>执行这个镜像，iowait打满，直接把我的微信给挤掉了，浏览器都打不开了，不过结果是好的。<br>继续坚持下去！","like_count":11,"discussions":[{"author":{"id":1076264,"avatar":"https://static001.geekbang.org/account/avatar/00/10/6c/28/a1f9f0ad.jpg","nickname":"陈树义","note":"","ucode":"AF83C4BDC192B5","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585077,"discussion_content":"CentOS 系统，亲测有效，666 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661327412,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79384,"user_name":"林贻民","can_delete":false,"product_type":"c1","uid":1202213,"ip_address":"","ucode":"F7185C61CAE4D0","user_header":"https://static001.geekbang.org/account/avatar/00/12/58/25/2088864b.jpg","comment_is_top":false,"comment_ctime":1553472578,"is_pvip":false,"replies":[{"id":"29041","content":"中断跟不可中断睡眠状态不是一回事，中断是会打断进程运行，而不可中断睡眠是指不可以被信号中断，而不是占着CPU不放了","user_name":"作者回复","comment_id":79384,"uid":"1001282","ip_address":"","utype":1,"ctime":1553525943,"user_name_real":"倪朋飞"}],"discussion_count":5,"race_medal":0,"score":"40208178242","product_id":100020901,"comment_content":"老师您好，我有个疑惑：不可中断状态睡眠不能被其他进程或者中断打断，那照道理说如果不可中断进程很多（超过CPU）逻辑核数时，系统应该处于卡死状态，可是实际上并不是这样的，其他进程照样在执行，说明是存在进程调度，也就是存在重调度中断，键盘输入也有响应，说明也存在硬件中断，这个似乎和不可中断进程状态进程的不可中断产生了冲突？是我有什么地方理解错了吗？","like_count":10,"discussions":[{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387518,"discussion_content":"整理一下我了解的 uninterruptible sleep 状态，也就是“D”状态的进程。首先，上几节课学习过，系统负载，它包含Runnable 和不可中断状态的进程数。所以，不可中断状态的进程确实能令系统负载升高。但是，不可中断状态是这样产生的：一个进程正在执行，它有个资源需要系统调度（例如system read,就假设是IO读文件），如果内核满足不了进程的请求，内核就会让进程暂时变成“D”状态。由于进程现在在内核态，所以，普通的kill和停止信号都不能被进程接收——这个才是“不可中断”的真实含义。其实，此时的进程已经在sleep等待内核满足它的资源请求之后，再重新变成Runnable、之后是Running的状态。所以，“不可中断”状态进程并不是占着CPU。","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1628227721,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444476,"discussion_content":"中断跟不可中断睡眠状态不是一回事，中断是会打断进程运行，而不可中断睡眠是指不可以被信号中断，而不是占着CPU不放了","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1553525943,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2373403,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/lsGTJsgLTdj4icGT7oLCMibBiatCAwTSMKGRgdxbOso1WCoGvzWz1M9cSiayrJe3X6uvbVV47dvKy5HlSeGpDSSq9A/132","nickname":"Jievin","note":"","ucode":"3448D1DE0819E9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350175,"discussion_content":"提的问题很棒👍🏻","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1613734252,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1275659,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoTtHIemT3d7oOuDoU5dOGQeUzxTvcLPeD2qPS48ib5hlKq3ne650o5GVc2N5ia5uo4WOEnzmcNAZGQ/132","nickname":"刘青松","note":"","ucode":"65759A01ECD48C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367810,"discussion_content":"这老师完全没有回答到问题所问的点上","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1618473954,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1000076,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/8c/373d4027.jpg","nickname":"龍蝦","note":"","ucode":"BE1D500833F070","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":581237,"discussion_content":"不可中断状态，表示进程正在跟硬件交互，为了保护进程数据和硬件的一致性，系统不允许其他进程或中断打断这个进程。 \n-- 这个描述确实有问题。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658655050,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46643,"user_name":"每天晒白牙","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1543968505,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"31608739577","product_id":100020901,"comment_content":"【D7打卡】<br>今天主要学习进程的状态，可以通过ps或top查看进程的状态<br>R:运行 Running或Runnable的缩写 表示进程在CPU的就绪队列中，正在运行或正在等待运行<br>I:空闲  Idle的缩写，用在不可中断睡眠的内核线程上。空闲线程不会导致平均负载升高，D状态的会导致平均负载升高<br>D:不可中断睡眠 Dist Sleep的缩写 表示进程正在跟硬件交互，并且交互过程中不允许被其他进程或中断打断<br>S:可中断睡眠 Interruptible Sleep的缩写 表示进程因为等待某个事件而被系统挂起。当进程等待的事件发生时，它会被唤醒并进入R状态<br>Z:僵尸 Zombie缩写 进程已经结束，但父进程还没有回收它的资源（如进程的描述符、PID等）<br>T:暂停 Stopped或Traced的缩写，表示进程处于暂停或者跟踪状态<br>今天实战的结果和老师的出入很大，我的系统是centos的<br>ps aux | grep &#47;app结果最开始是<br>[root@localhost ~]# ps aux | grep &#47;app<br>root       3468  0.0  0.0   4364   380 pts&#47;0    Ss+  07:38   0:00 &#47;app<br>root       3568 12.0  3.3  37268 33036 pts&#47;0    D+   07:39   0:00 &#47;app<br>root       3569  7.0  3.3  37268 33036 pts&#47;0    D+   07:39   0:00 &#47;app<br>root       3571  0.0  0.0 112728   988 pts&#47;4    S+   07:39   0:00 grep --color=auto &#47;app<br>[root@localhost ~]# ps aux | grep &#47;app<br>root       3468  0.0  0.0   4364   424 pts&#47;0    Ss+  07:38   0:00 &#47;app<br>root       3590 15.0  3.3  37268 33016 pts&#47;0    R+   07:39   0:00 &#47;app<br>root       3591 15.0  3.3  37268 33016 pts&#47;0    R+   07:39   0:00 &#47;app<br>root       3593  0.0  0.0 112724   988 pts&#47;4    R+   07:39   0:00 grep --color=auto &#47;app<br>[root@localhost ~]# ps aux | grep &#47;app<br>root       3468  0.0  0.0   4364   424 pts&#47;0    Ss+  07:38   0:00 &#47;app<br>root       3597  0.0  0.0 112728   988 pts&#47;4    S+   07:39   0:00 grep --color=auto &#47;app<br>同样用top命令观察，平均负载也不高，然后wa也很低，也没看到处于D状态的进程。符合的只有 处于僵尸状态的进程比较多<br>[root@localhost ~]# top<br>top - 07:41:45 up  2:35,  8 users,  load average: 0.00, 0.03, 0.31<br>Tasks: 224 total,   1 running, 135 sleeping,   0 stopped,  88 zombie<br>%Cpu0  :  0.7 us,  5.8 sy,  0.0 ni, 88.1 id,  4.1 wa,  0.0 hi,  1.4 si,  0.0 st<br>%Cpu1  :  1.0 us,  7.1 sy,  0.0 ni, 86.7 id,  2.7 wa,  0.0 hi,  2.4 si,  0.0 st<br>KiB Mem :   999720 total,   165196 free,   389676 used,   444848 buff&#47;cache<br>KiB Swap:  2097148 total,  1788172 free,   308976 used.   335844 avail Mem                                                                                                                 <br>和老师反映了情况，老师说可能是案例里I&#47;O线程还不够多，效果不明显，等着老师修改案例重新发镜像，再实验。","like_count":8},{"had_liked":false,"id":63086,"user_name":"泡泡","can_delete":false,"product_type":"c1","uid":1303469,"ip_address":"","ucode":"4F3D0D3AC21DA0","user_header":"https://static001.geekbang.org/account/avatar/00/13/e3/ad/a47728fd.jpg","comment_is_top":false,"comment_ctime":1548247234,"is_pvip":true,"discussion_count":2,"race_medal":0,"score":"23023083714","product_id":100020901,"comment_content":"处于不可中断状态睡眠状态的进程和僵尸状态的进程，应该不会在操作系统的就绪队列里面，为什么会使系统负载增加呢？","like_count":5,"discussions":[{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387522,"discussion_content":"系统负载就是包含就绪队列和不可中断状态的进程。有说以前设计系统的时候，考虑到不可中断状态的进程，很短时间就会重新进入就绪队列，所以，系统负载就包含了不可中断状态的进程数。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1628229754,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2834946,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/42/02/7c9d5339.jpg","nickname":"ksl","note":"","ucode":"206906DBB07AE1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":411832,"discussion_content":"好问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636014874,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46916,"user_name":"Brown羊羊","can_delete":false,"product_type":"c1","uid":1315332,"ip_address":"","ucode":"354EC478E57DEE","user_header":"https://static001.geekbang.org/account/avatar/00/14/12/04/5837b21c.jpg","comment_is_top":false,"comment_ctime":1544001389,"is_pvip":false,"replies":[{"id":"16756","content":"我的机器配置太弱了，IO已经跑满还是好多人都没有观察到iowait的现象。重新推了一个镜像，加大了IO操作，再试试看现在怎么样","user_name":"作者回复","comment_id":46916,"uid":"1001282","ip_address":"","utype":1,"ctime":1544017116,"user_name_real":"倪朋飞"}],"discussion_count":3,"race_medal":0,"score":"23018837869","product_id":100020901,"comment_content":"没有模拟出来系统I&#47;O瓶颈，可以帮忙看下吗：<br>容器运行起来后只发现一个app进程<br>[root@liyang2 ~]# ps aux|grep &#47;app<br>root     23619  0.0  0.0   4368   380 pts&#47;0    Ss+  17:12   0:00 &#47;app<br>root     23777  0.0  0.0 112648   952 pts&#47;0    S+   17:12   0:00 grep --color=auto &#47;app<br><br>CPU情况  wa也没有很高<br>%Cpu(s):  1.0 us,  1.5 sy,  0.0 ni, 94.0 id,  3.3 wa,  0.0 hi,  0.2 si,  0.0 st<br><br>系统：redhat7  3.10.0-327.el7.x86_64 x86_64 GNU&#47;Linux  ","like_count":5,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431597,"discussion_content":"我的机器配置太弱了，IO已经跑满还是好多人都没有观察到iowait的现象。重新推了一个镜像，加大了IO操作，再试试看现在怎么样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544017116,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2330999,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/KhQRc8hIxHHyPV3Og2Fc5l8w2y7ibGwGn6odmzl3wTt6fPrNv589uHmia1rgiaZhRiaLVHv9ibhzkxFx1zo42uNIS9A/132","nickname":"道长","note":"","ucode":"15B2E9CEF84634","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":329012,"discussion_content":"docker run --privileged --name=app -itd feisky/app:iowait-new2 我运行了这个还是与上面一样的结果。只看到僵尸进程很多，但是并没有显示D 的进程\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606297208,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1793589,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epxppZUun6eqVDbbuyIzSZibcydqnDkdZ96NBDmNYHun484FUcdj3vdaJmuxia9wqEChMRkhj8IpfaA/132","nickname":"Summer","note":"","ucode":"DA2683248EA698","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":169842,"discussion_content":"请问老师，新的镜像在哪里下载？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581649683,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47414,"user_name":"深蓝","can_delete":false,"product_type":"c1","uid":1219317,"ip_address":"","ucode":"944AE8C1F2DBC7","user_header":"https://static001.geekbang.org/account/avatar/00/12/9a/f5/71eee10b.jpg","comment_is_top":false,"comment_ctime":1544143023,"is_pvip":false,"replies":[{"id":"17056","content":"一个基本的思路是要找出进程处于 D 状态的原因，是在等待什么样的I&#47;O资源。比如分析系统调用、进程堆栈等等。<br><br>找出根源之后，再去分析这些根源里面到底发生了什么，才导致的没有响应。<br><br>当然，也有其他比较hack的方法，但生产环境中不推荐，以免给系统带来未知的损坏。","user_name":"作者回复","comment_id":47414,"uid":"1001282","ip_address":"","utype":1,"ctime":1544278714,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"18724012207","product_id":100020901,"comment_content":"同问，关于Uninterruptible sleep(D)状态<br>的进程如何有效的处理，以前运维的时候遇到过，貌似只能重启机器，不知道还有什么更好的办法","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431763,"discussion_content":"一个基本的思路是要找出进程处于 D 状态的原因，是在等待什么样的I/O资源。比如分析系统调用、进程堆栈等等。\n\n找出根源之后，再去分析这些根源里面到底发生了什么，才导致的没有响应。\n\n当然，也有其他比较hack的方法，但生产环境中不推荐，以免给系统带来未知的损坏。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544278714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46744,"user_name":"姜小鱼","can_delete":false,"product_type":"c1","uid":1317762,"ip_address":"","ucode":"3E2076E20289BF","user_header":"https://static001.geekbang.org/account/avatar/00/14/1b/82/69581d8a.jpg","comment_is_top":false,"comment_ctime":1543976618,"is_pvip":false,"replies":[{"id":"16769","content":"确切的说是CPU繁忙程度，因为iowait也是CPU使用率的一种类型","user_name":"作者回复","comment_id":46744,"uid":"1001282","ip_address":"","utype":1,"ctime":1544018458,"user_name_real":"倪朋飞"}],"discussion_count":2,"race_medal":0,"score":"14428878506","product_id":100020901,"comment_content":"这个案例的iowait比较高，但是并不影响cpu使用率。因为准确来说，iowait也是属于cpu idle状态的一部分，他和僵尸进程影响的只是平均负载和系统资源","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431524,"discussion_content":"确切的说是CPU繁忙程度，因为iowait也是CPU使用率的一种类型","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544018458,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1260026,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","nickname":"安排","note":"","ucode":"F78CFA9624CAEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":170070,"discussion_content":"mark，iowait不影响cpu繁忙程度，所以不会导致%CPU升高。 但是iowait本身属于CPU使用率的一种。","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1581667978,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46611,"user_name":"一生一世","can_delete":false,"product_type":"c1","uid":1254081,"ip_address":"","ucode":"D8C3E55A920676","user_header":"https://static001.geekbang.org/account/avatar/00/13/22/c1/d402bfbf.jpg","comment_is_top":false,"comment_ctime":1543946129,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14428848017","product_id":100020901,"comment_content":"我的思路是用1、pidstat看看上下文交换情况；2、vmstat看看wa;把僵尸进程的父进程停掉","like_count":3,"discussions":[{"author":{"id":2538540,"avatar":"https://static001.geekbang.org/account/avatar/00/26/bc/2c/963688bb.jpg","nickname":"noisyes","note":"","ucode":"94EC310B284AD2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373392,"discussion_content":"平均负载是指单位时间内，系统处于可运行状态和不可中断状态的平均进程数，也就是平均活跃进程数，它和 CPU 使用率并没有直接关系。所以，它不仅包括了正在使用 CPU 的进程，还包括等待 CPU 和等待 I/O 的进程。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620715423,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47034,"user_name":"xiao豪","can_delete":false,"product_type":"c1","uid":1026417,"ip_address":"","ucode":"F7969A9785E37B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a9/71/78796fd5.jpg","comment_is_top":false,"comment_ctime":1544022861,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10133957453","product_id":100020901,"comment_content":"打卡，太坑了，开着docker边跟着老师操作，结果卡死了T_T","like_count":2},{"had_liked":false,"id":46685,"user_name":"耿长学","can_delete":false,"product_type":"c1","uid":1309948,"ip_address":"","ucode":"C7A262812854D4","user_header":"https://static001.geekbang.org/account/avatar/00/13/fc/fc/1e235814.jpg","comment_is_top":false,"comment_ctime":1543971477,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10133906069","product_id":100020901,"comment_content":"学习了，每天上班路上听听音频看一看，晚上回家整理学习","like_count":2},{"had_liked":false,"id":46670,"user_name":"ninuxer","can_delete":false,"product_type":"c1","uid":1243135,"ip_address":"","ucode":"5394ADAF2667D6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132","comment_is_top":false,"comment_ctime":1543970481,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10133905073","product_id":100020901,"comment_content":"打卡day8<br>根据上几天的内容，出现iowait，能想到的分析过程：先用pidstat -u查看进城级别cpu的信息，pidstat -w查看进程级别的自愿中断信息，如果因为io问题，自愿中断应该会飙升，再就是用perf top查看出问题的进程的信息了","like_count":2},{"had_liked":false,"id":255932,"user_name":"Haonan","can_delete":false,"product_type":"c1","uid":1717529,"ip_address":"","ucode":"E6C31AC6190C69","user_header":"https://static001.geekbang.org/account/avatar/00/1a/35/19/769a9a88.jpg","comment_is_top":false,"comment_ctime":1603459556,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5898426852","product_id":100020901,"comment_content":"太喜欢这门课了，老师循循善诱，简直是初入职场的小白的读音。","like_count":1},{"had_liked":false,"id":217333,"user_name":"Yong","can_delete":false,"product_type":"c1","uid":1912653,"ip_address":"","ucode":"0ADA75C5C68619","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL3OaibxsOia5ZET1iaBsPwDM6NS43lAUTdItqkwZ66fGaaXtjOQYL73IsvY0foscUZlkaZSQPPQNexA/132","comment_is_top":false,"comment_ctime":1589465952,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5884433248","product_id":100020901,"comment_content":"老师，加下警告，这节的案例跑着没一会儿虚拟机死了，虚拟机所在的磁盘爆了，还好有快照..","like_count":1,"discussions":[{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578958,"discussion_content":"你需要增加磁盘，最好是2快磁盘，不要第一块磁盘来搞非常容易卡死","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657101404,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":107401,"user_name":"chen泽林¹⁵⁶²⁶¹⁸⁷³³⁹","can_delete":false,"product_type":"c1","uid":1467095,"ip_address":"","ucode":"AE2EF979F847B2","user_header":"https://static001.geekbang.org/account/avatar/00/16/62/d7/5bfdecf2.jpg","comment_is_top":false,"comment_ctime":1561529017,"is_pvip":false,"replies":[{"id":"40097","content":"谢谢分享😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1562249725,"ip_address":"","comment_id":107401,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5856496313","product_id":100020901,"comment_content":"安装dstat后出现except getopt.error, exc。<br>dstat工具支持python2 ，可能系统安装了python3。 <br>如果安装了python2和3的话，可以用<br>使用 &#47;usr&#47;bin&#47;python2 &#47;usr&#47;bin&#47;dstat","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455498,"discussion_content":"谢谢分享😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562249725,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":98690,"user_name":"LA","can_delete":false,"product_type":"c1","uid":1178482,"ip_address":"","ucode":"28AD0DA151799C","user_header":"https://static001.geekbang.org/account/avatar/00/11/fb/72/3fe64bc5.jpg","comment_is_top":false,"comment_ctime":1559058227,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5854025523","product_id":100020901,"comment_content":"网络io也是属于不可中断的么？有些困惑，求老师指点下","like_count":1,"discussions":[{"author":{"id":1260026,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","nickname":"安排","note":"","ucode":"F78CFA9624CAEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":170080,"discussion_content":"就像select这种io多路复用不能监控磁盘文件的描述符一样，因为总认为他是可读可写的。而对于socket fd，则不总是可读可写的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581668296,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1260026,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","nickname":"安排","note":"","ucode":"F78CFA9624CAEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":170076,"discussion_content":"属于可中断，因为对端与物理线路有很大的不确定性。而磁盘属于本机的设备，一般总认为是正常的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581668198,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57849,"user_name":"辣椒","can_delete":false,"product_type":"c1","uid":1330376,"ip_address":"","ucode":"85C62DE976C6A5","user_header":"https://static001.geekbang.org/account/avatar/00/14/4c/c8/bed1e08a.jpg","comment_is_top":false,"comment_ctime":1546928646,"is_pvip":false,"replies":[{"id":"20996","content":"😊 高手如云","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1547028463,"ip_address":"","comment_id":57849,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5841895942","product_id":100020901,"comment_content":"评论里是高手辈出啊，两个问题都是看评论区的评论都解决了","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435789,"discussion_content":"😊 高手如云","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547028463,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54473,"user_name":"龙","can_delete":false,"product_type":"c1","uid":1109018,"ip_address":"","ucode":"7ADB94BF8140E6","user_header":"https://static001.geekbang.org/account/avatar/00/10/ec/1a/f0dbaad3.jpg","comment_is_top":false,"comment_ctime":1545878020,"is_pvip":false,"replies":[{"id":"19954","content":"把分区换成磁盘","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546006674,"ip_address":"","comment_id":54473,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5840845316","product_id":100020901,"comment_content":"docker run --privileged --name=app --device &#47;dev&#47;sda5:&#47;dev&#47;sda5 --device-write-iops &#47;dev&#47;sda5:3 --device-read-iops &#47;dev&#47;sda5:3 -itd feisky&#47;app:iowait<br>报错：<br>   &#47;usr&#47;bin&#47;docker-current: Error response from daemon: oci runtime error: container_linux.go:247: starting container process caused &quot;process_linux.go:327: setting cgroup config for procHooks process caused \\&quot;failed to write 8:5 3 to blkio.throttle.read_iops_device: write &#47;sys&#47;fs&#47;cgroup&#47;blkio&#47;system.slice&#47;docker-92e10bae59a6520ef090c08f6718396497edcdc4abaace7d820afb566ac5e41a.scope&#47;blkio.throttle.read_iops_device: invalid argument\\&quot;&quot;.<br>谁知道这是啥原因吗？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434465,"discussion_content":"把分区换成磁盘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546006674,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578959,"discussion_content":"而且别拿第一块磁盘搞呀，你在增加一块磁盘就可以了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657101479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47386,"user_name":"heat nan","can_delete":false,"product_type":"c1","uid":1153826,"ip_address":"","ucode":"52D5CB17CE80E5","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/22/dd04892a.jpg","comment_is_top":false,"comment_ctime":1544140078,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5839107374","product_id":100020901,"comment_content":"老师可否深入解释下 为什么处于内核的不可中断实际有可能不占用负载。   您描述为可能，那么什么时候是占用的，什么时候不占用？","like_count":1},{"had_liked":false,"id":47321,"user_name":"CYH","can_delete":false,"product_type":"c1","uid":1099568,"ip_address":"","ucode":"396AF8DBD0C8AE","user_header":"https://static001.geekbang.org/account/avatar/00/10/c7/30/2f8b78e9.jpg","comment_is_top":false,"comment_ctime":1544106300,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5839073596","product_id":100020901,"comment_content":"hi，老师：我晚上做的实验，操作系统是cenos7.5，我看您回复留言说已经更新可以提高iowaite了，但我这验证执行ps aux|grep app并没有发现D不可中断的进程从而导致io并没有提升，只是出现了很多僵尸进程。","like_count":1},{"had_liked":false,"id":47151,"user_name":"mj4ever","can_delete":false,"product_type":"c1","uid":1005549,"ip_address":"","ucode":"73028E537099CC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/ed/d50de13c.jpg","comment_is_top":false,"comment_ctime":1544064345,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5839031641","product_id":100020901,"comment_content":"通过实际操作和资料查阅，本次课程学到了以下知识：<br>1、进程的多种状态，D (Disk Sleep) 状态的进程，会导致平均负载升高<br>2、僵尸进程：<br>（1）父子进程的运行是异步的过程，父进程需要知道子进程是何时关闭的<br>（2）子进程需要父进程来收尸，但父进程没有安装SIGCHLD信号处理函数调用wait或waitpid（）等待子进程结束，或是子进程执行太快，父进程还没来得及处理子进程状态<br>（3）父进程退出后，init进程会自动接手子进程，进行清理<br>（4）僵尸进程已经放弃了几乎所有内存空间，没有任何可执行代码，也不能被调度，仅仅在进程列表中保留一个位置，记载该进程的退出状态等信息供其他进程收集<br>（5）大量的僵尸进程会用尽 PID 进程号，导致新进程不能创建<br>3、会话和进程组<br>4、\b实操<br>（1）查看了僵尸进程 查看僵尸进程的命令 ps -e -o stat,ppid,pid,cmd | egrep &#39;^[Zz]&#39;  或  ps -ef | grep &quot;defunct&quot;，停止父进程后，僵尸进程会被回收<br>（2）没有观察到io的问题，可能是和机器配置有关系，不知道是否可以暴露个参数让我们启动docker的时候传参来施加压力。","like_count":1},{"had_liked":false,"id":351789,"user_name":"Geek_f93234","can_delete":false,"product_type":"c1","uid":1769504,"ip_address":"","ucode":"1E5DC903A5429E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJGXndj5N66z9BL1ic9GibZzWWgoVeWaWTL2XUnCYic7iba2kAEvN9WfjmlXELD5lqt8IJ1P023N5ZWicg/132","comment_is_top":false,"comment_ctime":1658196933,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1658196933","product_id":100020901,"comment_content":"思考题：发现iowait cpu使用率高，排查思路：<br>1）iotop找打io的线程<br>2）perf top -g -p pid 跟踪进程执行的函数<br>3）从应用的中函数入手排查问题","like_count":0},{"had_liked":false,"id":349006,"user_name":"～","can_delete":false,"product_type":"c1","uid":2157116,"ip_address":"","ucode":"3785BA8C337D88","user_header":"https://static001.geekbang.org/account/avatar/00/20/ea/3c/83d8ddc1.jpg","comment_is_top":false,"comment_ctime":1655635753,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1655635753","product_id":100020901,"comment_content":"app.c:12:22: fatal error: sys&#47;wait.h: No such file or directory<br> #include &lt;sys&#47;wait.h&gt;<br>Docker镜像make build的时候，报这个错误，请问应该如何解决呢？","like_count":0},{"had_liked":false,"id":349005,"user_name":"～","can_delete":false,"product_type":"c1","uid":2157116,"ip_address":"","ucode":"3785BA8C337D88","user_header":"https://static001.geekbang.org/account/avatar/00/20/ea/3c/83d8ddc1.jpg","comment_is_top":false,"comment_ctime":1655635713,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1655635713","product_id":100020901,"comment_content":"app.c:12:22: fatal error: sys&#47;wait.h: No such file or directory<br> #include &lt;sys&#47;wait.h&gt;","like_count":0},{"had_liked":false,"id":344729,"user_name":"Geek_9e9d56","can_delete":false,"product_type":"c1","uid":2791742,"ip_address":"","ucode":"F6333DA18E4EB0","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/aCVlj0fom8geRoXFkO34Jbpf9oia79QxdbwDuyyLqL1WAVC7iaViaE4YNUvcatEwwUF6102MeH6kBxo5CwLibrCiajg/132","comment_is_top":false,"comment_ctime":1651740392,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1651740392","product_id":100020901,"comment_content":"倪老师，你好，我大并发压力测试过程中，top查看应用进程状态一直是S状态，ps aux查看其状态为Sl状态，进程处于这种状态正常吗？","like_count":0},{"had_liked":false,"id":339844,"user_name":"肥low","can_delete":false,"product_type":"c1","uid":1043480,"ip_address":"","ucode":"A158AFAAB8C742","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ec/18/bf7254d3.jpg","comment_is_top":false,"comment_ctime":1648434797,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1648434797","product_id":100020901,"comment_content":"老师好 我最近遇到一种情况是 状态为S，可是正常的kill pid 并不能正常退出，必须要 -9 才可以，请问老师这种情况该怎么解决呢","like_count":0},{"had_liked":false,"id":338870,"user_name":"weing","can_delete":false,"product_type":"c1","uid":1984655,"ip_address":"","ucode":"95701BDA31F6F6","user_header":"","comment_is_top":false,"comment_ctime":1647767009,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1647767009","product_id":100020901,"comment_content":"老师，有点不明白，我这个Java 的状态为S（可中断睡眠），但是为什么 还占用CPU呢？<br>14058 root      20   0 10.066g 3.837g 163284 S  63.2 12.3 205:59.84 java<br>操作系统为 Ubuntu 18.04 LTS  物理机<br><br>","like_count":0},{"had_liked":false,"id":327588,"user_name":"Aero 袁国超","can_delete":false,"product_type":"c1","uid":2536404,"ip_address":"","ucode":"C2176D92A11DF2","user_header":"https://static001.geekbang.org/account/avatar/00/26/b3/d4/8d1d04b3.jpg","comment_is_top":false,"comment_ctime":1640184131,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1640184131","product_id":100020901,"comment_content":"大家是生产啥？老是用centos?","like_count":0,"discussions":[{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578961,"discussion_content":"都是测试平台谁敢在生产操作了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657101573,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":323130,"user_name":"gecko","can_delete":false,"product_type":"c1","uid":1198048,"ip_address":"","ucode":"2B7122536F1A0E","user_header":"https://static001.geekbang.org/account/avatar/00/12/47/e0/1ff26e99.jpg","comment_is_top":false,"comment_ctime":1637738740,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1637738740","product_id":100020901,"comment_content":"kvm 虚拟机<br><br><br>docker run --privileged --name=app -itd feisky&#47;app:iowait &#47;app -d &#47;dev&#47;vdb -s 67108864 -c 20<br>","like_count":0,"discussions":[{"author":{"id":1198048,"avatar":"https://static001.geekbang.org/account/avatar/00/12/47/e0/1ff26e99.jpg","nickname":"gecko","note":"","ucode":"2B7122536F1A0E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533268,"discussion_content":"记录下\n\ndocker stop app &amp;&amp; docker rm app \n\n\ndocker run --privileged --name=app -itd feisky/app:iowait /app -d /dev/vdb -s 671088640 -c 10\n\ndocker run --privileged --name=app -itd feisky/app:iowait-fix1 /app -d /dev/vdb -s 671088640 -c 10\n\ndocker run --privileged --name=app -itd feisky/app:iowait-fix2 /app -d /dev/vdb -s 671088640 -c 10","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637829284,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":320628,"user_name":"🎉晶晶🎉😄","can_delete":false,"product_type":"c1","uid":1169422,"ip_address":"","ucode":"76B608C42E06A8","user_header":"https://static001.geekbang.org/account/avatar/00/11/d8/0e/1bf7f57a.jpg","comment_is_top":false,"comment_ctime":1636427394,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636427394","product_id":100020901,"comment_content":"构建的镜像，启动时报错：standard_init_linux.go:228: exec user process caused: exec format error<br>请问怎么解决该问题？","like_count":0},{"had_liked":false,"id":316150,"user_name":"Ansyear","can_delete":false,"product_type":"c1","uid":1629257,"ip_address":"","ucode":"489CE96852EA2C","user_header":"https://static001.geekbang.org/account/avatar/00/18/dc/49/43ae1627.jpg","comment_is_top":false,"comment_ctime":1634181425,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634181425","product_id":100020901,"comment_content":"将系统和进程的指标监控起来有哪些监控工具和方法呢，老师也多次提到监控了","like_count":0},{"had_liked":false,"id":307691,"user_name":"Geek_d3b3e8","can_delete":false,"product_type":"c1","uid":1604672,"ip_address":"","ucode":"606AFD6AFAFD66","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLCSXgHpLA2icPxlwBLa7qS12oibHia1ib6zFxmVq5GpDxy8fXQdgYHyFAnicp76icM0DCvxaeAtxYYp5jg/132","comment_is_top":false,"comment_ctime":1629202405,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629202405","product_id":100020901,"comment_content":"不知道老师为什么用ubuntu讲解，讲真我在生产上没见过ubuntu，都多是centos","like_count":0},{"had_liked":false,"id":307690,"user_name":"Geek_d3b3e8","can_delete":false,"product_type":"c1","uid":1604672,"ip_address":"","ucode":"606AFD6AFAFD66","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLCSXgHpLA2icPxlwBLa7qS12oibHia1ib6zFxmVq5GpDxy8fXQdgYHyFAnicp76icM0DCvxaeAtxYYp5jg/132","comment_is_top":false,"comment_ctime":1629202306,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629202306","product_id":100020901,"comment_content":"老师讲的太好了，但是有个问题就是经常会用一些新的工具，但是生产环境都是自带的最原始的工具，不可能去装这些工具。","like_count":0},{"had_liked":false,"id":276947,"user_name":"雄鹰","can_delete":false,"product_type":"c1","uid":1786819,"ip_address":"","ucode":"67E0C4BDE7F6F2","user_header":"https://static001.geekbang.org/account/avatar/00/1b/43/c3/2c53acd7.jpg","comment_is_top":false,"comment_ctime":1612188026,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1612188026","product_id":100020901,"comment_content":"老师你好：请教一个问题，我在测试数据抽取时（从mysql朝hive上抽取），mysql服务器上只装了mysql（服务器配置是32C 128GB内存的物理机）hive在另一套服务器上，当在抽取业务时，第一次运行（5分钟左右），mysql所长服务器的负载很快上到100左右，此时通过iostat观察磁盘读取的速度在20MB&#47;S，但磁盘使用率在100%，cpu的us sy 使用很低，idel空闲还有近70%，iowait达到25%，MySQL服务器开始很卡顿，输入一个命令都没反应了。把抽取服务（另外一个服务器上安装的）停后，MySQL服务器可以使用了，但再次启动抽取服务，MySQL服务器很快就卡顿了（10秒），此时服务器的cpu使用很低，负载也很低，内存还有很大的剩余，磁盘IO也不高，开始怀疑mysql出问题了，但重启了mysql，再运行抽取服务，MySQL服务器不到10秒又卡死了，监控句柄占用也不高，不可中断进程也没发现，实在找不到定位该问题的思路了，麻烦老师指点一下，感谢！","like_count":0},{"had_liked":false,"id":266183,"user_name":"恶魔果实","can_delete":false,"product_type":"c1","uid":1962297,"ip_address":"","ucode":"691CD833C984AC","user_header":"https://static001.geekbang.org/account/avatar/00/1d/f1/39/b0960780.jpg","comment_is_top":false,"comment_ctime":1607229067,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607229067","product_id":100020901,"comment_content":"老师您好，操作系统中说的三大状态（运行，就绪，阻塞）和这里的六七种状态到底是什么关系呢？","like_count":0},{"had_liked":false,"id":263933,"user_name":"道长","can_delete":false,"product_type":"c1","uid":2330999,"ip_address":"","ucode":"15B2E9CEF84634","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/KhQRc8hIxHHyPV3Og2Fc5l8w2y7ibGwGn6odmzl3wTt6fPrNv589uHmia1rgiaZhRiaLVHv9ibhzkxFx1zo42uNIS9A/132","comment_is_top":false,"comment_ctime":1606297604,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606297604","product_id":100020901,"comment_content":"请教老师，我这centos系统，安装docker run --privileged --name=app -itd feisky&#47;app:iowait-new2 系统，为什么查看不到显示D+的进程<br># ps aux|grep &#47;app<br>root      9699  0.0  0.0   4368   420 pts&#47;0    Ss+  17:36   0:00 &#47;app<br>root     10236  0.0  0.0 112716   960 pts&#47;1    S+   17:43   0:00 grep --color=auto &#47;app<br><br># top<br>top - 17:42:50 up 16 days, 22:56,  2 users,  load average: 0.00, 0.01, 0.05<br>Tasks: 261 total,   1 running, 102 sleeping,   8 stopped, 150 zombie<br>%Cpu(s):  0.0 us,  0.0 sy,  0.0 ni,100.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>KiB Mem :  3879868 total,  1395092 free,   935072 used,  1549704 buff&#47;cache<br>KiB Swap:        0 total,        0 free,        0 used.  2630256 avail Mem <br>并没有老师案例里的 wa 高","like_count":0},{"had_liked":false,"id":259127,"user_name":"Ethan","can_delete":false,"product_type":"c1","uid":1810189,"ip_address":"","ucode":"75F613D58909DB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ZHw73tgCqGKhvticUWGRz4icgicu4hFWfKtacoFJeItH7maNuNUmjnEgDTJvOibwUWgGV0p6guNPibMVWDV4BUmEmlA/132","comment_is_top":false,"comment_ctime":1604635020,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1604635020","product_id":100020901,"comment_content":"docker run --privileged --name=app9 --device &#47;dev&#47;sda:&#47;dev&#47;sda --device-write-iops &#47;dev&#47;sda:3 --device-read-iops &#47;dev&#47;sda:3 -itd feisky&#47;app:iowait-new2  <br><br>老师你好，我CenterOS7运行上面的命令启动。发展wa确实飙升到100，但是zombie却一直是0。这情况正常吗？","like_count":0,"discussions":[{"author":{"id":2321649,"avatar":"","nickname":"Geek_76c30e","note":"","ucode":"EFA86960BDCB95","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326875,"discussion_content":"用老师镜像带的命令，不然你看不到效果\n你还可以通过以下三个选项来修改磁盘读取的行为：\n-d 设置要读取的磁盘，默认前缀为 /dev/sd 或者 /dev/xvd 的磁盘\n-s 设置每次读取的数据量大小，单位为字节，默认为 67108864（也就是 64MB）\n-c 设置每个子进程读取的次数，默认为 20 次，也就是读取 20*64MB 数据后子进程退出\ndocker run --privileged --name=app -itd feisky/app:iowait /app -d /dev/sdb -s 67108864 -c 20\n案例运行后，你可以执行 docker logs app 查看它的日志，正常情况下，可以看到如下的输出：\nReading data from disk /dev/sdb with buffer size 67108864 and count 20","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605692649,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":258897,"user_name":"Dowen Liu","can_delete":false,"product_type":"c1","uid":1440423,"ip_address":"","ucode":"DD072D44AD353D","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLCrJQ4AZe8VrDkR6IO03V4Tda9WexVT4zZiahBjLSYOnZb1Y49JvD2f70uQwYSMibUMQvib9NmGxEiag/132","comment_is_top":false,"comment_ctime":1604577878,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1604577878","product_id":100020901,"comment_content":"没有负载升高，也没有iowait，dstat 看 read 也是0.。。。。。。老师，镜像是改了吗？","like_count":0,"discussions":[{"author":{"id":2321649,"avatar":"","nickname":"Geek_76c30e","note":"","ucode":"EFA86960BDCB95","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326870,"discussion_content":"没有改啊。你不会看老师镜像连接里面的运行参数吗？\ndocker run --privileged --name=app -itd feisky/app:iowait /app -d /dev/sdb -s 67108864 -c 20  根据参数说明，很容易看到实验产生的效果","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605692482,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1440423,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLCrJQ4AZe8VrDkR6IO03V4Tda9WexVT4zZiahBjLSYOnZb1Y49JvD2f70uQwYSMibUMQvib9NmGxEiag/132","nickname":"Dowen Liu","note":"","ucode":"DD072D44AD353D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2321649,"avatar":"","nickname":"Geek_76c30e","note":"","ucode":"EFA86960BDCB95","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":327437,"discussion_content":"嗯嗯。在后面答疑部分发现有参数可以传，已经解决了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605838105,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":326870,"ip_address":""},"score":327437,"extra":""}]}]},{"had_liked":false,"id":254998,"user_name":"牛牛01","can_delete":false,"product_type":"c1","uid":1134722,"ip_address":"","ucode":"3D6A0B0283EF43","user_header":"https://static001.geekbang.org/account/avatar/00/11/50/82/eb5713bb.jpg","comment_is_top":false,"comment_ctime":1603247347,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603247347","product_id":100020901,"comment_content":"进程的几种状态:<br>R: Running | Runnable. 进程在CPU的就绪队列中、正在运行或在等待运行<br>D: Disk Sleep, 不可中断睡眠状态, 一般表示进程正在跟硬件交互, 并且在交互过程中不允许被其它进程或中断打断.<br>Z: 表示僵尸进程、就是进程实际结束了、但父进程还未回收它的资源(eg. 进程描述符、pid等).<br>S: 可中断睡眠, 进程因等待某个事件儿而被系统挂起, 当进程等待的事件发生时、他会被唤醒并进入R状态.<br>I: 空闲状态, 用在不可中断睡眠的内核线程上.<br><br>s: 代表一个进程是一个进程组的领导进程<br>+: 代表这是一个前台进程组","like_count":0},{"had_liked":false,"id":253731,"user_name":"Geek_f702be","can_delete":false,"product_type":"c1","uid":1143067,"ip_address":"","ucode":"8E3B5F393C4266","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epumnXjMLYzHkGFhAraIiaAMXpotuUR9PCexBWl25tRLFAvpzs03Hfse4Y1lyeWuryz6z80Fd8AXiaw/132","comment_is_top":false,"comment_ctime":1602845874,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602845874","product_id":100020901,"comment_content":"打卡<br>cpu使用率包括用户cpu、系统cpu（上下文切换）、等待I&#47;O(等待磁盘的响应)、中端cpu（软中断和硬中断）<br>熟悉进程的状态","like_count":0},{"had_liked":false,"id":248227,"user_name":"风一样的小雅静","can_delete":false,"product_type":"c1","uid":1446008,"ip_address":"","ucode":"8F6FC449A5BC90","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/EoiaYtjYmiaRal5Of1a05z3klUibJczR6DfvkXdQsRicamxUYMibf8icAKQ5wo1kkXEzfgZRaTmBCxAO2KMQ1AJjaRDQ/132","comment_is_top":false,"comment_ctime":1600072943,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1600072943","product_id":100020901,"comment_content":"第一篇文章说平均负载和cpu使用率不一定成正比，io密集型会导致平均负载高，但cpu使用率不一定高，io密集型的情况和这里iowait高的情况是一样的么，但是iowait不是也是cpu使用率的一种么，那iowait高，CPU使用率也是高的吧？","like_count":0},{"had_liked":false,"id":230577,"user_name":"生活不如诗","can_delete":false,"product_type":"c1","uid":1139515,"ip_address":"","ucode":"FD48EABEEC52B7","user_header":"https://static001.geekbang.org/account/avatar/00/11/63/3b/c5cd68ab.jpg","comment_is_top":false,"comment_ctime":1593422725,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593422725","product_id":100020901,"comment_content":"进程的常见状态分如下几种：<br>1. R：正在运行或等待运行；<br>2. D：不可中断状态，等待硬件；<br>3. S：可中断睡眠，会转变为R；<br>4. Z：僵尸进程；<br>5. I：空闲进程，用在不可中断的内核线程，不影响性能；<br>当系统出现过多的僵尸进程的原因是：<br>1. 父进程没有正常处理子进程的退出；<br>2. 子进程执行过快，导致父进程没有正常处理子进程；<br>3. 僵尸进程通常很快会消亡，如果长时间存在，说明存在问题；<br>过多不可中断进程：<br>1. 可能是设备硬件出现故障导致；<br>2. 设备硬件瓶颈导致大量进程在等待资源；<br>3. 如果多个进程长时间处于D状态，则io系统可能出现了问题；","like_count":0},{"had_liked":false,"id":223975,"user_name":"jorin@zou","can_delete":false,"product_type":"c1","uid":1564869,"ip_address":"","ucode":"A8CEF7CCF33570","user_header":"https://static001.geekbang.org/account/avatar/00/17/e0/c5/c324a7de.jpg","comment_is_top":false,"comment_ctime":1591247442,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1591247442","product_id":100020901,"comment_content":"疑问：过去 1 分钟、5 分钟和 15 分钟内的平均负载在依次减小，说明平均负载正在升高?<br>","like_count":0,"discussions":[{"author":{"id":2099588,"avatar":"https://static001.geekbang.org/account/avatar/00/20/09/84/0effdd87.jpg","nickname":"鱼我所欲","note":"","ucode":"2A5D3CCCFC21D1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302865,"discussion_content":"从过去15分钟到过去1分钟 负载 平均负载在升高啊","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1599052160,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":214983,"user_name":"Ken","can_delete":false,"product_type":"c1","uid":1120761,"ip_address":"","ucode":"9F829156E855C8","user_header":"https://static001.geekbang.org/account/avatar/00/11/19/f9/62ae32d7.jpg","comment_is_top":false,"comment_ctime":1588863144,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588863144","product_id":100020901,"comment_content":"请问老师，多进程导致的性能问题所以在线多吗？感觉现在已经较少使用多进程了。","like_count":0},{"had_liked":false,"id":204118,"user_name":"EncodedStar","can_delete":false,"product_type":"c1","uid":1504234,"ip_address":"","ucode":"03958CA7DDD6AE","user_header":"https://static001.geekbang.org/account/avatar/00/16/f3/ea/2b2adda5.jpg","comment_is_top":false,"comment_ctime":1586336669,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586336669","product_id":100020901,"comment_content":"授之以鱼不如授之以渔  man ps 里将的很详细，学到了！！~ ","like_count":0},{"had_liked":false,"id":195602,"user_name":"痞子胥","can_delete":false,"product_type":"c1","uid":1617678,"ip_address":"","ucode":"3701A981FFF083","user_header":"","comment_is_top":false,"comment_ctime":1585203482,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585203482","product_id":100020901,"comment_content":"老师 这节课的 镜像 搭建的 容器 启动不了啊","like_count":0},{"had_liked":false,"id":182592,"user_name":"宋胖胖","can_delete":false,"product_type":"c1","uid":1857496,"ip_address":"","ucode":"AA828F49CCEABA","user_header":"https://static001.geekbang.org/account/avatar/00/1c/57/d8/e9c8b923.jpg","comment_is_top":false,"comment_ctime":1582813438,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1582813438","product_id":100020901,"comment_content":"打卡，  学到了用top命令查看进程的状态，运行（R）、空闲（I）、不可中断睡眠（D）、可中断睡眠（S）、僵尸（Z  zombie）以及暂停（T） ","like_count":0,"discussions":[{"author":{"id":1962297,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/f1/39/b0960780.jpg","nickname":"恶魔果实","note":"","ucode":"691CD833C984AC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332460,"discussion_content":"操作系统中说的三大状态（运行，就绪，阻塞）和这里的六七种状态到底是什么关系呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607229170,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":172189,"user_name":"笑","can_delete":false,"product_type":"c1","uid":1741098,"ip_address":"","ucode":"689A435818403A","user_header":"https://static001.geekbang.org/account/avatar/00/1a/91/2a/c0fb21fa.jpg","comment_is_top":false,"comment_ctime":1579104883,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579104883","product_id":100020901,"comment_content":"补打卡，Day 6，今日重点为进程状态，其中最值得注意的两个状态为不可中断状态和僵尸状态。","like_count":0},{"had_liked":false,"id":172024,"user_name":"刘友淙","can_delete":false,"product_type":"c1","uid":1620058,"ip_address":"","ucode":"97F3A69A308313","user_header":"","comment_is_top":false,"comment_ctime":1579073048,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579073048","product_id":100020901,"comment_content":"D6 打卡","like_count":0},{"had_liked":false,"id":168239,"user_name":"xiong","can_delete":false,"product_type":"c1","uid":1099375,"ip_address":"","ucode":"C1BFD9EF96372F","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/6f/ac3003fa.jpg","comment_is_top":false,"comment_ctime":1578036232,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578036232","product_id":100020901,"comment_content":"为什么我这个镜像一运行就直接退出了 =_=","like_count":0},{"had_liked":false,"id":165331,"user_name":"xdargs","can_delete":false,"product_type":"c1","uid":1063740,"ip_address":"","ucode":"EB8326D3A72DE5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoH9Mlw0kLK0p39vhQpdvkbQP5TX96DB9HMJ1POaTVDpMZg4rjlO3WCAqiaWWMc77ffS3vTo8qWdXA/132","comment_is_top":false,"comment_ctime":1577201624,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1577201624","product_id":100020901,"comment_content":"新了解到top的wa参数是iowait；留言中的debug值得自己学习（docker中无法启动app，docker ps -a查看启动后关闭，用gdb调试本次的C程序）","like_count":0},{"had_liked":false,"id":161145,"user_name":"吴小喵","can_delete":false,"product_type":"c1","uid":1392780,"ip_address":"","ucode":"A8CB5407A89593","user_header":"https://static001.geekbang.org/account/avatar/00/15/40/8c/bc76ecd3.jpg","comment_is_top":false,"comment_ctime":1576132028,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576132028","product_id":100020901,"comment_content":"有没有人和我一样不会docker的，这个环境搭建不起来学不下去啊，能不能大概讲一下环境搭建的过程","like_count":0},{"had_liked":false,"id":160813,"user_name":"王昊","can_delete":false,"product_type":"c1","uid":1246393,"ip_address":"","ucode":"E3DEAAB35F7C73","user_header":"https://static001.geekbang.org/account/avatar/00/13/04/b9/153b6088.jpg","comment_is_top":false,"comment_ctime":1576036829,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576036829","product_id":100020901,"comment_content":" 如果进程处于不可中断状态，那么cpu使用率是否会升高呢？","like_count":0},{"had_liked":false,"id":135021,"user_name":"Kingdom","can_delete":false,"product_type":"c1","uid":1290865,"ip_address":"","ucode":"A45866C5324310","user_header":"https://static001.geekbang.org/account/avatar/00/13/b2/71/76481005.jpg","comment_is_top":false,"comment_ctime":1568980929,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1568980929","product_id":100020901,"comment_content":"老师 不能选择用centos吗？从头跟到这里，发现你这上面很多的东西在centos上都不行，还要各种百度，学一篇要好长时间","like_count":0,"discussions":[{"author":{"id":1319529,"avatar":"https://static001.geekbang.org/account/avatar/00/14/22/69/09f7a8a2.jpg","nickname":"Don Wang","note":"","ucode":"1853365FA279F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":86160,"discussion_content":"你装几个ubuntu就好了，又不费事","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576591156,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125493,"user_name":"丁小疯","can_delete":false,"product_type":"c1","uid":1631373,"ip_address":"","ucode":"8FD320587FB63C","user_header":"https://static001.geekbang.org/account/avatar/00/18/e4/8d/1c49755d.jpg","comment_is_top":false,"comment_ctime":1566194054,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566194054","product_id":100020901,"comment_content":"使用execsnoop 15386  15385 pgrep -d   -- ^qemu(-kvm|:.{1,11})$<br> 15388  15384 awk { sum += $1 }; END { print 0+sum }<br> 15389   3044 sleep 60<br> 15392  15391 awk &#47;^(MemFree|Buffers|Cached):&#47; {free += $2}; END {print free} &#47;proc&#47;meminfo<br> 15395  15394 pgrep -d   -- ^qemu(-kvm|:.{1,11})$<br> 15397  15393 awk { sum += $1 }; END { print 0+sum }<br> 15398   3044 sleep 60<br> 15400  15399 awk &#47;^(MemFree|Buffers|Cached):&#47; {free += $2}; END {print free} &#47;proc&#47;meminfo<br> 15403  15402 pgrep -d   -- ^qemu(-kvm|:.{1,11})$<br> 15405  15401 awk { sum += $1 }; END { print 0+sum }<br> 15406   3044 sleep 60<br> 15408  15407 awk &#47;^(MemFree|Buffers|Cached):&#47; {free += $2}; END {print free} &#47;proc&#47;meminfo<br> 15411  15410 pgrep -d   -- ^qemu(-kvm|:.{1,11})$<br> 15413  15409 awk { sum += $1 }; END { print 0+sum }<br> 15414   3044 sleep 60<br>时，发现不能一下子打印出来自己要的进程的pid的内容呢","like_count":0},{"had_liked":false,"id":122566,"user_name":"scorpiozj","can_delete":false,"product_type":"c1","uid":1031677,"ip_address":"","ucode":"C66EA76809F9BF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bd/fd/3f5d5db5.jpg","comment_is_top":false,"comment_ctime":1565425731,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565425731","product_id":100020901,"comment_content":"注意-d后加的是盘符；还有就是docker启动app后查看下log： docker logs app","like_count":0},{"had_liked":false,"id":117755,"user_name":"乖，摸摸头","can_delete":false,"product_type":"c1","uid":1611745,"ip_address":"","ucode":"BD92741A11D3CD","user_header":"https://static001.geekbang.org/account/avatar/00/18/97/e1/0f4d90ff.jpg","comment_is_top":false,"comment_ctime":1564124936,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1564124936","product_id":100020901,"comment_content":"docker run --privileged --name=app -itd feisky&#47;app:iowait<br> 无法启动","like_count":0},{"had_liked":false,"id":106392,"user_name":"魏乐","can_delete":false,"product_type":"c1","uid":1233832,"ip_address":"","ucode":"B6D50018BE67E7","user_header":"https://static001.geekbang.org/account/avatar/00/12/d3/a8/91eed372.jpg","comment_is_top":false,"comment_ctime":1561290443,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561290443","product_id":100020901,"comment_content":"PS 如果想要观察到子进程没有被正确处理的僵尸进程（wait or waitpid），其父进程也需要是存活状态，否则通过ps -aux | grep Z 观察不到僵尸进程，因为僵尸进程会被交给1号进程init处理","like_count":0},{"had_liked":false,"id":87543,"user_name":"火狼王","can_delete":false,"product_type":"c1","uid":1152184,"ip_address":"","ucode":"76919311EA41A1","user_header":"https://static001.geekbang.org/account/avatar/00/11/94/b8/09d86400.jpg","comment_is_top":false,"comment_ctime":1555634003,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1555634003","product_id":100020901,"comment_content":"dx","like_count":0},{"had_liked":false,"id":85833,"user_name":"无名老卒","can_delete":false,"product_type":"c1","uid":1348261,"ip_address":"","ucode":"48874CE670E122","user_header":"","comment_is_top":false,"comment_ctime":1555252440,"is_pvip":false,"replies":[{"id":"31290","content":"负载升高还是要从负载的含义上理解——平均活跃进程数。<br><br>Docker的IO限制实际上是通过cgroups实现的，这只是对进程的读写做了限制，并非是把磁盘的性能给降低了。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1555501290,"ip_address":"","comment_id":85833,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555252440","product_id":100020901,"comment_content":"将读写的iops都限制在3：<br>```bash<br>root@fdm:~# docker run --privileged --name app2 --device &#47;dev&#47;sda:&#47;dev&#47;sda --device-write-iops &#47;dev&#47;sda:3 --device-read-iops &#47;dev&#47;sda:3 -itd feisky&#47;app:iowait <br>c7befa77604a55ac41d31ef6328f4664d544fe4559f5609217c309eae188ffc5<br>```<br><br>查看top，负载已经上去了，同时iowait也在99%了。<br><br>```<br>top - 14:21:06 up 9 days, 12:36,  9 users,  load average: 148.06, 80.83, 34.35<br>Tasks: 360 total,   1 running, 283 sleeping,   0 stopped,   0 zombie<br>%Cpu(s):  0.0 us,  0.5 sy,  0.0 ni,  0.0 id, 99.5 wa,  0.0 hi,  0.0 si,  0.0 st<br>```<br>使用pidstat是可以看到是app 这个程序导致的<br><br>```<br>root@fdm:~# pidstat -d 5 5<br>...<br><br>02:21:01 PM   UID       PID   kB_rd&#47;s   kB_wr&#47;s kB_ccwr&#47;s iodelay  Command<br>02:21:06 PM     0     74213  13081.04      0.00      0.00   36966  app<br>02:21:06 PM     0     74214  13081.04      0.00      0.00   37121  app<br><br>root@fdm:~# iostat -d -x 5 5 sda<br><br>Device            r&#47;s     w&#47;s     rkB&#47;s     wkB&#47;s   rrqm&#47;s   wrqm&#47;s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util<br>sda              5.39    0.00   3679.04      0.00     0.00     0.00   0.00   0.00    1.78    0.00   0.00   682.67     0.00   0.89   0.48<br><br>Device            r&#47;s     w&#47;s     rkB&#47;s     wkB&#47;s   rrqm&#47;s   wrqm&#47;s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util<br>sda              5.40    0.00   3686.40      0.00     0.00     0.00   0.00   0.00    0.89    0.00   0.00   682.67     0.00   0.44   0.24<br><br>Device            r&#47;s     w&#47;s     rkB&#47;s     wkB&#47;s   rrqm&#47;s   wrqm&#47;s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util<br>sda              6.00    0.00   4096.00      0.00     0.00     0.00   0.00   0.00    3.07    0.00   0.01   682.67     0.00   1.07   0.64<br>```<br>但是使用了限制IO时，就发现了一些问题：一是运行了很久，但是僵尸进程没有涨一个，但是负载就上去了；二是看负载上去的原因是wa的占用率上去了，但使用iostat看磁盘使用率还是插正常的；三是为什么限制了容器使用的io量，但还是导致宿主机的负载升高这么多，这是为什么？请老师指点一下。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446829,"discussion_content":"负载升高还是要从负载的含义上理解——平均活跃进程数。\n\nDocker的IO限制实际上是通过cgroups实现的，这只是对进程的读写做了限制，并非是把磁盘的性能给降低了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555501290,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":84185,"user_name":"听闻","can_delete":false,"product_type":"c1","uid":1319485,"ip_address":"","ucode":"EF1D3C9EF83F7B","user_header":"https://static001.geekbang.org/account/avatar/00/14/22/3d/35a4324c.jpg","comment_is_top":false,"comment_ctime":1554799655,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554799655","product_id":100020901,"comment_content":"老师打满的镜像是那个io没有打满<br>","like_count":0},{"had_liked":false,"id":80372,"user_name":"阿文","can_delete":false,"product_type":"c1","uid":1106209,"ip_address":"","ucode":"BB4DB62141971F","user_header":"https://static001.geekbang.org/account/avatar/00/10/e1/21/5f0bf9a0.jpg","comment_is_top":false,"comment_ctime":1553652532,"is_pvip":false,"replies":[{"id":"29325","content":"docker logs app 看看什么错误？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553697330,"ip_address":"","comment_id":80372,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553652532","product_id":100020901,"comment_content":"root@linux:~# docker ps -a<br>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES<br>73e18b629c09        feisky&#47;app:iowait   &quot;&#47;app&quot;              7 seconds ago       Exited (1) 5 seconds ago                       app","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444836,"discussion_content":"docker logs app 看看什么错误？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553697330,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78470,"user_name":"JJj","can_delete":false,"product_type":"c1","uid":1196463,"ip_address":"","ucode":"EA53F2CEAFCFF1","user_header":"https://static001.geekbang.org/account/avatar/00/12/41/af/4307867a.jpg","comment_is_top":false,"comment_ctime":1553155101,"is_pvip":false,"replies":[{"id":"28755","content":"不是绝对的，还要进行I&#47;O的性能分析才可以确定。当然，io需要通过系统调用来完成，也会消耗一定的 sys CPU","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553317511,"ip_address":"","comment_id":78470,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553155101","product_id":100020901,"comment_content":"老师，你好，iowait是不是可以认为有IO性能问题，io的操作需要系统调用吧，比如write，read，对应sys CPU是不是会高？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444106,"discussion_content":"不是绝对的，还要进行I/O的性能分析才可以确定。当然，io需要通过系统调用来完成，也会消耗一定的 sys CPU","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553317511,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78026,"user_name":"王盛武","can_delete":false,"product_type":"c1","uid":1182516,"ip_address":"","ucode":"DE7EF246D3DCE8","user_header":"https://static001.geekbang.org/account/avatar/00/12/0b/34/f41d73a4.jpg","comment_is_top":false,"comment_ctime":1553057137,"is_pvip":false,"replies":[{"id":"28782","content":"源码在github上面 github.com&#47;feiskyer&#47;linux-perf-examples","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553319971,"ip_address":"","comment_id":78026,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553057137","product_id":100020901,"comment_content":"倪老师，请问上一节实验里的docker镜像有没下载仓库或者下载地址？谢谢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443939,"discussion_content":"源码在github上面 github.com/feiskyer/linux-perf-examples","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553319971,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":73188,"user_name":"L33K","can_delete":false,"product_type":"c1","uid":1046063,"ip_address":"","ucode":"2F8E105F44E347","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f6/2f/d3f1dae6.jpg","comment_is_top":false,"comment_ctime":1551836482,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551836482","product_id":100020901,"comment_content":"mark","like_count":0},{"had_liked":false,"id":73007,"user_name":"AceslupK","can_delete":false,"product_type":"c1","uid":1284474,"ip_address":"","ucode":"048F84D019CBBB","user_header":"https://static001.geekbang.org/account/avatar/00/13/99/7a/558666a5.jpg","comment_is_top":false,"comment_ctime":1551775578,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551775578","product_id":100020901,"comment_content":"今天就碰到出现D状态。df -h命令出现的。终端直接僵死。找不到方法，只能硬着头皮重启了，还好可能不是磁盘问题，不然系统启动不起来。","like_count":0},{"had_liked":false,"id":72838,"user_name":"Boy-struggle","can_delete":false,"product_type":"c1","uid":1402286,"ip_address":"","ucode":"94113E2837DC29","user_header":"https://static001.geekbang.org/account/avatar/00/15/65/ae/9727318e.jpg","comment_is_top":false,"comment_ctime":1551746882,"is_pvip":false,"replies":[{"id":"26738","content":"磁盘I&#47;O","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551882956,"ip_address":"","comment_id":72838,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551746882","product_id":100020901,"comment_content":"这里的IO指的是硬盘io还是cpu总线IO?","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441777,"discussion_content":"磁盘I/O","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551882956,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":72837,"user_name":"Boy-struggle","can_delete":false,"product_type":"c1","uid":1402286,"ip_address":"","ucode":"94113E2837DC29","user_header":"https://static001.geekbang.org/account/avatar/00/15/65/ae/9727318e.jpg","comment_is_top":false,"comment_ctime":1551746786,"is_pvip":false,"replies":[{"id":"26737","content":"R是运行状态，长时间关中断会导致中断事件丢失（比如键盘来说，一直关着的话，你就没法输入了）","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551882934,"ip_address":"","comment_id":72837,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551746786","product_id":100020901,"comment_content":"R状态是不可屏蔽状态嘛？长时间关闭中断会有什么问题？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441776,"discussion_content":"R是运行状态，长时间关中断会导致中断事件丢失（比如键盘来说，一直关着的话，你就没法输入了）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551882934,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":66987,"user_name":"元天夫","can_delete":false,"product_type":"c1","uid":1315599,"ip_address":"","ucode":"A453A2EBA77780","user_header":"","comment_is_top":false,"comment_ctime":1550051650,"is_pvip":false,"replies":[{"id":"23739","content":"嗯嗯，欢迎交流和分享","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550071146,"ip_address":"","comment_id":66987,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550051650","product_id":100020901,"comment_content":"补卡，回头看有一个好处就是可以看看大家的留言，评论中也可以受益匪浅啊","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439003,"discussion_content":"嗯嗯，欢迎交流和分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550071146,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65944,"user_name":"Maxwell","can_delete":false,"product_type":"c1","uid":1086275,"ip_address":"","ucode":"720A00AD472616","user_header":"https://static001.geekbang.org/account/avatar/00/10/93/43/0e84492d.jpg","comment_is_top":false,"comment_ctime":1549789665,"is_pvip":false,"replies":[{"id":"23683","content":"看进程号，已经不是同一个进程了","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550065628,"ip_address":"","comment_id":65944,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1549789665","product_id":100020901,"comment_content":"为什么用top命令能查看到app的进程为Z状态，但是ps aux|grep &#47;app ,状态却不是Z状态呢？<br>top输出：<br>109341 root      20   0       0      0      0 Z   9.8  0.0   0:00.30 app                         <br>109342 root      20   0       0      0      0 Z   8.9  0.0   0:00.27 app <br>使用ps aux|grep &#47;app:<br>root     108152  0.0  0.0   4512  1600 pts&#47;0    Ss+  16:22   0:00 &#47;app<br>root     109364  0.0  0.0  21536  1048 pts&#47;1    S+   17:06   0:00 grep --color=auto &#47;app","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438652,"discussion_content":"看进程号，已经不是同一个进程了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550065628,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65942,"user_name":"Maxwell","can_delete":false,"product_type":"c1","uid":1086275,"ip_address":"","ucode":"720A00AD472616","user_header":"https://static001.geekbang.org/account/avatar/00/10/93/43/0e84492d.jpg","comment_is_top":false,"comment_ctime":1549789192,"is_pvip":false,"replies":[{"id":"23684","content":"是的，请参考前面的回复增加IO压力试试","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550065677,"ip_address":"","comment_id":65942,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1549789192","product_id":100020901,"comment_content":"老师，有三个问题：<br>1.运行ps aux|grep &#47;app，并没有出现D状态的进程，我的是：<br>root     108152  0.0  0.0   4512  1600 pts&#47;0    Ss+  16:22   0:00 &#47;app<br>root     108938  0.0  0.0  21536  1076 pts&#47;1    S+   16:51   0:00 grep --color=auto &#47;app<br>我的硬件配置CPU为四核(E2 1230 V2,逻辑四核)，应该比你的配置略高，是否是硬件方面的问题<br><br>2.运行案例中，使用vmstat 查看并没有发现iowait升高，是否和我的磁盘有关?(我使用的是SATA SSD，低端固态)<br>3.top中查看的wait应该不是iowait 吧，这个和vmstat 中的wait应该不是一个意思吧？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438650,"discussion_content":"是的，请参考前面的回复增加IO压力试试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550065677,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65630,"user_name":"Geek_477c02","can_delete":false,"product_type":"c1","uid":1218578,"ip_address":"","ucode":"CB9A714A50B977","user_header":"https://static001.geekbang.org/account/avatar/00/12/98/12/a169bdcd.jpg","comment_is_top":false,"comment_ctime":1549519469,"is_pvip":false,"replies":[{"id":"23255","content":"找出根源才是更好的方法，具体方法请参考后面的I&#47;O模块","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1549636532,"ip_address":"","comment_id":65630,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1549519469","product_id":100020901,"comment_content":"遇到有大量的D状态的进程，导致负载到7000多，但是cpu和iowait都不高，除了重启设备还有什么办法解决？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438528,"discussion_content":"找出根源才是更好的方法，具体方法请参考后面的I/O模块","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549636532,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58282,"user_name":"请叫我小强","can_delete":false,"product_type":"c1","uid":1132759,"ip_address":"","ucode":"8C8BC5EBC27A0C","user_header":"https://static001.geekbang.org/account/avatar/00/11/48/d7/8b69bf21.jpg","comment_is_top":false,"comment_ctime":1547026443,"is_pvip":false,"replies":[{"id":"21155","content":"这应该是网络错误导致的，docker.io在国内访问不太稳定，一般过一段时间就会好。当然，换成国内的镜像会更稳定","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1547124951,"ip_address":"","comment_id":58282,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547026443","product_id":100020901,"comment_content":"不知道有没有同学碰到这个问题：在使用 make build 的时候出现无法认证的错误。<br>gcc -o app app.c<br>docker build -t feisky&#47;app:iowait -f Dockerfile .<br>Sending build context to Docker daemon 30.72 kB<br>Step 1&#47;4 : FROM ubuntu<br>Get https:&#47;&#47;registry-1.docker.io&#47;v2&#47;: x509: certificate signed by unknown authority<br>make: *** [build] Error 1<br><br>这个问题可以尝试在 Dockerfile 文件中把 FROM ubuntu 修改成 FROM daocloud.io&#47;ubuntu 来解决。<br><br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435987,"discussion_content":"这应该是网络错误导致的，docker.io在国内访问不太稳定，一般过一段时间就会好。当然，换成国内的镜像会更稳定","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547124951,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57938,"user_name":"gentleman♥️","can_delete":false,"product_type":"c1","uid":1119062,"ip_address":"","ucode":"0BAC746A70038C","user_header":"https://static001.geekbang.org/account/avatar/00/11/13/56/6a062937.jpg","comment_is_top":false,"comment_ctime":1546946835,"is_pvip":false,"replies":[{"id":"20990","content":"docker logs app 看看是不是正常运行了？<br>","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1547027766,"ip_address":"","comment_id":57938,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546946835","product_id":100020901,"comment_content":"[root@VM_2_23_centos high-iowait-process]# docker run --privileged --name=app -itd feisky&#47;app:iowait<br>7eb239587e564ffa1d0dd9fd91e1fe36b6c2dcdf73043cf2db8b6fde1e9e74e5<br>[root@VM_2_23_centos high-iowait-process]# top<br>top - 19:22:39 up 108 days,  8:59,  3 users,  load average: 0.71, 0.36, 0.23<br>Tasks: 187 total,   1 running, 186 sleeping,   0 stopped,   0 zombie<br>top - 19:25:15 up 108 days,  9:02,  3 users,  load average: 0.09, 0.25, 0.21<br>Tasks: 186 total,   2 running, 184 sleeping,   0 stopped,   0 zombie<br>%Cpu(s):  2.3 us,  5.3 sy,  0.0 ni, 92.5 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>KiB Mem : 16267940 total,   406336 free, 11878328 used,  3983276 buff&#47;cache<br>KiB Swap:        0 total,        0 free,        0 used.  3937244 avail Mem <br><br>僵尸线程和负载都不高啊，docker app应该已经启动了？<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435835,"discussion_content":"docker logs app 看看是不是正常运行了？\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547027766,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57778,"user_name":"Xg huang","can_delete":false,"product_type":"c1","uid":1016995,"ip_address":"","ucode":"9680FA95DE3553","user_header":"","comment_is_top":false,"comment_ctime":1546908703,"is_pvip":false,"replies":[{"id":"20999","content":"代码里访问的时候可能会使用缓存，也可能访问到磁盘，访问磁盘的时候是不可中断的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1547028807,"ip_address":"","comment_id":57778,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546908703","product_id":100020901,"comment_content":"请教一下老师，一般在写代码访问io的时候，是不可中断还是可中断？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435754,"discussion_content":"代码里访问的时候可能会使用缓存，也可能访问到磁盘，访问磁盘的时候是不可中断的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547028807,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54648,"user_name":"悬铃木（赵岩）","can_delete":false,"product_type":"c1","uid":1327862,"ip_address":"","ucode":"BB8285E938EE7B","user_header":"https://static001.geekbang.org/account/avatar/00/14/42/f6/6532d23d.jpg","comment_is_top":false,"comment_ctime":1545922230,"is_pvip":false,"replies":[{"id":"19944","content":"收到信号或者被ptrace系统调用跟踪时也会的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546005521,"ip_address":"","comment_id":54648,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545922230","product_id":100020901,"comment_content":"请教老师一个问题，进程可以自己进入T状态吗？除了kill -Stop 和debug去调试。 这个T状态是异常的一种吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434527,"discussion_content":"收到信号或者被ptrace系统调用跟踪时也会的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546005521,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54560,"user_name":"Blue_Eye","can_delete":false,"product_type":"c1","uid":1055764,"ip_address":"","ucode":"2FCF83951ABD7C","user_header":"https://static001.geekbang.org/account/avatar/00/10/1c/14/2388d9e4.jpg","comment_is_top":false,"comment_ctime":1545900639,"is_pvip":false,"replies":[{"id":"19829","content":"更新了，请设置参数增加压力再试试","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545953643,"ip_address":"","comment_id":54560,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545900639","product_id":100020901,"comment_content":"老师请问后来推的镜像是更新了之前的镜像吗？<br>今天使用还是碰到了平均负载不升反降的问题<br># top<br><br>top - 00:45:54 up 12 min,  1 user,  load average: 0.00, 0.15, 0.16<br>Tasks: 423 total,   1 running, 186 sleeping,   0 stopped, 170 zombie<br>%Cpu0  :  2.0 us, 13.9 sy,  0.0 ni, 64.4 id, 11.2 wa,  0.0 hi,  8.5 si,  0.0 st<br>%Cpu1  :  1.8 us, 16.6 sy,  0.0 ni, 65.4 id,  7.8 wa,  0.0 hi,  8.5 si,  0.0 st<br>KiB Mem :  8168764 total,  5926672 free,   758912 used,  1483180 buff&#47;cache<br>KiB Swap:  2095100 total,  2095100 free,        0 used.  7017380 avail Mem <br><br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434490,"discussion_content":"更新了，请设置参数增加压力再试试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545953643,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54532,"user_name":"徐洲更","can_delete":false,"product_type":"c1","uid":1314643,"ip_address":"","ucode":"F8A323CB732D05","user_header":"https://static001.geekbang.org/account/avatar/00/14/0f/53/92a50f01.jpg","comment_is_top":false,"comment_ctime":1545892905,"is_pvip":true,"replies":[{"id":"19952","content":"👍 总结的很棒","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546006327,"ip_address":"","comment_id":54532,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545892905","product_id":100020901,"comment_content":"关于不可中断的IO负荷导致服务器性能提高，这两天刚好有了一个实战机会<br><br>https:&#47;&#47;www.jianshu.com&#47;p&#47;d7edbff7dda6","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434484,"discussion_content":"👍 总结的很棒","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546006327,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54186,"user_name":"maoxiajun","can_delete":false,"product_type":"c1","uid":1198843,"ip_address":"","ucode":"CB4926BC81B3B1","user_header":"https://static001.geekbang.org/account/avatar/00/12/4a/fb/70f14340.jpg","comment_is_top":false,"comment_ctime":1545801722,"is_pvip":false,"replies":[{"id":"19701","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545835131,"ip_address":"","comment_id":54186,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545801722","product_id":100020901,"comment_content":"lesson7打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434386,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545835131,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51905,"user_name":"Blue sky","can_delete":false,"product_type":"c1","uid":1337182,"ip_address":"","ucode":"9551E5AC118AF5","user_header":"","comment_is_top":false,"comment_ctime":1545274978,"is_pvip":false,"replies":[{"id":"18886","content":"嗯嗯，每当这时候我都会想要是事先做好监控就好了","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545313070,"ip_address":"","comment_id":51905,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545274978","product_id":100020901,"comment_content":"我的服务器卡的飞起，终端已经不能输入了，因为我这台服务器还运行着其他程序，恐怕只能重启服务器了吧？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433666,"discussion_content":"嗯嗯，每当这时候我都会想要是事先做好监控就好了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545313070,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51791,"user_name":"超","can_delete":false,"product_type":"c1","uid":1301922,"ip_address":"","ucode":"5566EB4D10DA50","user_header":"https://static001.geekbang.org/account/avatar/00/13/dd/a2/8277208d.jpg","comment_is_top":false,"comment_ctime":1545258726,"is_pvip":false,"replies":[{"id":"18908","content":"这种情况应该要适当中断一下应用，让这些基本的操作可以正常执行后重新运行。推荐把这些系统和进程的指标监控起来，避免应用已启动又没法操作了。<br><br>还有就是预留几个CPU，专门用作运维、监控使用。这需要修改内核选项","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545314683,"ip_address":"","comment_id":51791,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545258726","product_id":100020901,"comment_content":"近日刚碰到一套生产系统出问题，我们逻辑cpu是120的实体机，跑oracle数据库，业务刚接进来就卡死了，一分钟平均负载200多，运行队列也两百多，cpu的usr部分四五十，sys部分四十左右，iowait基本是零，idle个位数，top和pidstat都无法输出，perftop也无法，只能dstat。请老师指导下思路，在查到底什么问题。","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433622,"discussion_content":"这种情况应该要适当中断一下应用，让这些基本的操作可以正常执行后重新运行。推荐把这些系统和进程的指标监控起来，避免应用已启动又没法操作了。\n\n还有就是预留几个CPU，专门用作运维、监控使用。这需要修改内核选项","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545314683,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50585,"user_name":"wing","can_delete":false,"product_type":"c1","uid":1129901,"ip_address":"","ucode":"B221E7DE5C63D6","user_header":"https://static001.geekbang.org/account/avatar/00/11/3d/ad/bee0df03.jpg","comment_is_top":false,"comment_ctime":1545012807,"is_pvip":true,"replies":[{"id":"18488","content":"可能是磁盘前缀的问题，请参考 https:&#47;&#47;github.com&#47;feiskyer&#47;linux-perf-examples&#47;tree&#47;master&#47;high-iowait-process 设置磁盘参数","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545145270,"ip_address":"","comment_id":50585,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545012807","product_id":100020901,"comment_content":"centos7,docker 镜像无法正常启动。<br>feisky&#47;app:iowait     &quot;&#47;app&quot;                   7 minutes ago       Exited (1) 7 minutes ago ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433030,"discussion_content":"可能是磁盘前缀的问题，请参考 https://github.com/feiskyer/linux-perf-examples/tree/master/high-iowait-process 设置磁盘参数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545145270,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49846,"user_name":"如果","can_delete":false,"product_type":"c1","uid":1320638,"ip_address":"","ucode":"138A3EEEE50850","user_header":"","comment_is_top":false,"comment_ctime":1544779030,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544779030","product_id":100020901,"comment_content":"DAY7，打卡<br>一个问题：老师能否用centos来做实验，毕竟绝大部分实际环境都是centos或者redhat。","like_count":0},{"had_liked":false,"id":49285,"user_name":"二三子也","can_delete":false,"product_type":"c1","uid":1245787,"ip_address":"","ucode":"69C7D86583277D","user_header":"https://static001.geekbang.org/account/avatar/00/13/02/5b/ce326cfc.jpg","comment_is_top":false,"comment_ctime":1544660665,"is_pvip":false,"replies":[{"id":"17841","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544745542,"ip_address":"","comment_id":49285,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544660665","product_id":100020901,"comment_content":"Flag","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432557,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544745542,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48991,"user_name":"#","can_delete":false,"product_type":"c1","uid":1326022,"ip_address":"","ucode":"7FD721A3AF72E9","user_header":"https://static001.geekbang.org/account/avatar/00/14/3b/c6/5954cbb7.jpg","comment_is_top":false,"comment_ctime":1544585525,"is_pvip":false,"replies":[{"id":"17676","content":"应该是内核版本，你的内核是哪个版本的？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544661180,"ip_address":"","comment_id":48991,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544585525","product_id":100020901,"comment_content":"#man top    <br>   20. S  --  Process Status<br>           The status of the task which can be one of:<br>               D = uninterruptible sleep<br>               R = running<br>               S = sleeping<br>               T = stopped by job control signal<br>               t = stopped by debugger during trace<br>               Z = zombie<br>#man ps<br>PROCESS STATE CODES<br>       Here are the different values that the s, stat and state output specifiers (header &quot;STAT&quot; or &quot;S&quot;) will display to describe the state of a process:<br><br>               D    uninterruptible sleep (usually IO)<br>               R    running or runnable (on run queue)<br>               S    interruptible sleep (waiting for an event to complete)<br>               T    stopped by job control signal<br>               t    stopped by debugger during the tracing<br>               W    paging (not valid since the 2.6.xx kernel)<br>               X    dead (should never be seen)<br>               Z    defunct (&quot;zombie&quot;) process, terminated but not reaped by its parent<br><br>       For BSD formats and when the stat keyword is used, additional characters may be displayed:<br><br>               &lt;    high-priority (not nice to other users)<br>               N    low-priority (nice to other users)<br>               L    has pages locked into memory (for real-time and custom IO)<br>               s    is a session leader<br>               l    is multi-threaded (using CLONE_THREAD, like NPTL pthreads do)<br>               +    is in the foreground process group<br>在ubuntu和centos都没看到idel状态，是内核还是版本问题呢？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432451,"discussion_content":"应该是内核版本，你的内核是哪个版本的？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544661180,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48680,"user_name":"Vicky🐣🐣🐣","can_delete":false,"product_type":"c1","uid":1266840,"ip_address":"","ucode":"F659F178A2FF34","user_header":"https://static001.geekbang.org/account/avatar/00/13/54/98/52ca7053.jpg","comment_is_top":false,"comment_ctime":1544513829,"is_pvip":false,"replies":[{"id":"17455","content":"执行 docker logs app 看看日志里面报了什么错误？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544520609,"ip_address":"","comment_id":48680,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544513829","product_id":100020901,"comment_content":"老师，我按步骤执行后，ps里面显示exited了，也没有app进程，麻烦老师看一下<br>[root@VM_0_5_centos ~]# docker run --privileged --name=app -itd feisky&#47;app:iowait<br>c6eaa823f3c7a8c4e29a8925fe424726840b1e2f2a568d22ba89966d8bdfb8fb<br>[root@VM_0_5_centos ~]# docker ps -a<br>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                     PORTS                    NAMES<br>c6eaa823f3c7        feisky&#47;app:iowait   &quot;&#47;app&quot;                   3 seconds ago       Exited (1) 1 second ago                             app<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432308,"discussion_content":"执行 docker logs app 看看日志里面报了什么错误？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544520609,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48676,"user_name":"Vicky🐣🐣🐣","can_delete":false,"product_type":"c1","uid":1266840,"ip_address":"","ucode":"F659F178A2FF34","user_header":"https://static001.geekbang.org/account/avatar/00/13/54/98/52ca7053.jpg","comment_is_top":false,"comment_ctime":1544513136,"is_pvip":false,"replies":[{"id":"17456","content":"执行 docker logs app 看看报了什么错误？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544520641,"ip_address":"","comment_id":48676,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544513136","product_id":100020901,"comment_content":"老师，我执行了docker run --privileged --name=app -itd feisky&#47;app:iowait<br>但是，没有app的进程<br>[root@VM_0_5_centos ~]# docker run --privileged --name=app -itd feisky&#47;app:iowait<br>0cdbd971d7903bb0c289b44a4f7f158f3befa9ec0e9ffec7794a0cacfcad2348<br>[root@VM_0_5_centos ~]# ps aux | grep &#39;&#47;app&#39;<br>root      7542  0.0  0.0 112648   960 pts&#47;13   R+   15:25   0:00 grep --color=auto &#47;app","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432304,"discussion_content":"执行 docker logs app 看看报了什么错误？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544520641,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48672,"user_name":"李逍遥","can_delete":false,"product_type":"c1","uid":1109750,"ip_address":"","ucode":"DB74823527E203","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/xzHDjCSFicNY3MUMECtNz6sM8yDJhBoyGk5IRoOtUat6ZIkGzxjqEqwqKYWMD3GjehScKvMjicGOGDog5FF18oyg/132","comment_is_top":false,"comment_ctime":1544512548,"is_pvip":false,"replies":[{"id":"17706","content":"试试源码里的方法 https:&#47;&#47;github.com&#47;feiskyer&#47;linux-perf-examples&#47;blob&#47;master&#47;high-iowait-process&#47;README.md","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544662434,"ip_address":"","comment_id":48672,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544512548","product_id":100020901,"comment_content":"[root@instance ~]# docker run --privileged --name=app -itd feisky&#47;app:iowait<br>7d1cd41a79cdc71d6c7e8d2882507e2d6ebeb959d728aa5a7e3c9774c996320a<br>[root@instance ~]# docker ps -a<br>CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES<br>7d1cd41a79cd        feisky&#47;app:iowait   &quot;&#47;app&quot;              3 seconds ago       Exited (1) 3 seconds ago                       app<br>倪老师，docker 镜像run不起来","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432301,"discussion_content":"试试源码里的方法 https://github.com/feiskyer/linux-perf-examples/blob/master/high-iowait-process/README.md","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544662434,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47851,"user_name":"往事随风，顺其自然","can_delete":false,"product_type":"c1","uid":1235692,"ip_address":"","ucode":"F266EC6B143E38","user_header":"https://static001.geekbang.org/account/avatar/00/12/da/ec/779c1a78.jpg","comment_is_top":false,"comment_ctime":1544236538,"is_pvip":false,"replies":[{"id":"17045","content":"已经把案例打包成docker镜像了，但是因为运行环境的不同，有些案例的确是没法重现的。<br><br>现在IO碰到的问题就是有些同学反馈把机器压死，也有学习完全体会不到IO压力。我还在思考怎么更好的解决这个问题，你可以先把自己的疑问留下","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544256355,"ip_address":"","comment_id":47851,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544236538","product_id":100020901,"comment_content":"老师可以包对应案例打包上传嘛？这样我们又具体的实例，会更好实践操作，没有对应体会不到对应的效果，和深刻理解","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431910,"discussion_content":"已经把案例打包成docker镜像了，但是因为运行环境的不同，有些案例的确是没法重现的。\n\n现在IO碰到的问题就是有些同学反馈把机器压死，也有学习完全体会不到IO压力。我还在思考怎么更好的解决这个问题，你可以先把自己的疑问留下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544256355,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47545,"user_name":"holen","can_delete":false,"product_type":"c1","uid":1104199,"ip_address":"","ucode":"2C7D342AFE4DF0","user_header":"https://static001.geekbang.org/account/avatar/00/10/d9/47/247fd305.jpg","comment_is_top":false,"comment_ctime":1544152903,"is_pvip":false,"replies":[{"id":"17084","content":"😓 这是IO案例中碰到最多的问题，有机器压死的，也有完全没压力的，这样观察的现象跟我的就不一样了。我还在思考怎么更好的解决这个问题，也欢迎你提供建议","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544314664,"ip_address":"","comment_id":47545,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544152903","product_id":100020901,"comment_content":"top - 11:19:22 up 11 days, 51 min,  3 users,  load average: 119.70, 130.70, 99.30<br>Tasks: 228 total, 104 running, 116 sleeping,   0 stopped,   8 zombie<br>%Cpu(s):  0.2 us, 94.0 sy,  0.0 ni,  0.0 id,  4.3 wa,  0.0 hi,  1.5 si,  0.0 st<br><br>炸了炸了， 不感动， 不能动 ！ 老师完全把我的机器跑挂住了哈！","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431801,"discussion_content":"😓 这是IO案例中碰到最多的问题，有机器压死的，也有完全没压力的，这样观察的现象跟我的就不一样了。我还在思考怎么更好的解决这个问题，也欢迎你提供建议","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544314664,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47466,"user_name":"walker","can_delete":false,"product_type":"c1","uid":1324219,"ip_address":"","ucode":"FA5B2400A53730","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/bb/0b971fca.jpg","comment_is_top":false,"comment_ctime":1544146354,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544146354","product_id":100020901,"comment_content":"断断续续看了几天才看完这一篇","like_count":0},{"had_liked":false,"id":47338,"user_name":"york","can_delete":false,"product_type":"c1","uid":1318852,"ip_address":"","ucode":"EE938B81A7FC04","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epGMibYc0m7cDHMsNRBUur2NPVnlBZFXoNjWomibfjnHeAO3XRt27VaH3WNtdUX11d3uIT1ZHWCxLeg/132","comment_is_top":false,"comment_ctime":1544110178,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544110178","product_id":100020901,"comment_content":"我在Ubuntu18.04虚拟机上跑，用的是feisky&#47;app:iowait镜像，基本复现老师预设的问题：平均负载升高、iowait比较高。没有复现问题的同学，可以看下虚拟机所用磁盘的容量是固定容量，还是动态增长容量？之前遇到过动态增长容量模式下，虚拟机的I&#47;O很低，导致docker镜像中模拟的I&#47;O跑不起来。<br>我的问题排错：<br>1. 用top看到app进程在不断地僵尸化，并且不断地启动新的app进程<br>2. 用pstree |grep app，发现有大量复制的app子进程<br>3. 找到那个唯一的S状态的app进程，用perf record&#47;report看，其中大量的是内核调用I&#47;O的进程，其中一个用户进程app也在里面，主要是执行read<br>4. 用docker cp将镜像内容copy到本地，其中有个名称为app的文件，但没有源码，无法进一步分析","like_count":0},{"had_liked":false,"id":47240,"user_name":"jh","can_delete":false,"product_type":"c1","uid":1331318,"ip_address":"","ucode":"C7B2764901B3C6","user_header":"https://static001.geekbang.org/account/avatar/00/14/50/76/18f93306.jpg","comment_is_top":false,"comment_ctime":1544086973,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544086973","product_id":100020901,"comment_content":"没有看到io等待，没有不可中断D进程<br>","like_count":0},{"had_liked":false,"id":47193,"user_name":"樊海涛","can_delete":false,"product_type":"c1","uid":1323249,"ip_address":"","ucode":"0B04D5985EE0E1","user_header":"https://static001.geekbang.org/account/avatar/00/14/30/f1/bf7fd8d2.jpg","comment_is_top":false,"comment_ctime":1544074119,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544074119","product_id":100020901,"comment_content":"没有模拟到I&#47;O瓶颈，老师帮忙看看呗；<br>[root@node ~]# ps aux|grep &#47;app<br>root     26206  0.0  0.0   4364   428 pts&#47;6    Ss+  13:09   0:00 &#47;app<br>root     26269  0.0  0.0      0     0 pts&#47;6    Z+   13:09   0:00 [app] &lt;defunct&gt;<br>root     26270  0.0  0.0      0     0 pts&#47;6    Z+   13:09   0:00 [app] &lt;defunct&gt;<br>root     26295  0.0  0.0      0     0 pts&#47;6    Z+   13:09   0:00 [app] &lt;defunct&gt;<br>root     26296  0.0  0.0      0     0 pts&#47;6    Z+   13:09   0:00 [app] &lt;defunct&gt;<br>root     26302  0.0  0.0      0     0 pts&#47;6    Z+   13:10   0:00 [app] &lt;defunct&gt;<br><br>top - 13:28:11 up 51 days, 19:00,  4 users,  load average: 0.00, 0.01, 0.05<br>Tasks: 625 total,   1 running, 184 sleeping,   0 stopped, 440 zombie<br>%Cpu(s):  0.2 us,  0.2 sy,  0.0 ni, 99.7 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>","like_count":0},{"had_liked":false,"id":47190,"user_name":"湖湘志","can_delete":false,"product_type":"c1","uid":1285578,"ip_address":"","ucode":"C8B069B3AD4FEA","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erJR5Kj0Xm6LykFHLaWqHjQiaroVxgdoGI7uHEGz2D3PfibWNkBYP23QLzFmcuicgKLbqUch0ZJ2ZNOA/132","comment_is_top":false,"comment_ctime":1544073091,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544073091","product_id":100020901,"comment_content":"D7","like_count":0},{"had_liked":false,"id":47123,"user_name":"☞","can_delete":false,"product_type":"c1","uid":1302793,"ip_address":"","ucode":"6FAEF05F234D2A","user_header":"https://static001.geekbang.org/account/avatar/00/13/e1/09/9483f537.jpg","comment_is_top":false,"comment_ctime":1544060522,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544060522","product_id":100020901,"comment_content":"老师您好：<br>        请问下S和T的状态怎么感觉差不多呢，一个是被中断挂起SLEEP，一个是接收到信号暂时STOP，能详细说明下这个的区别吗","like_count":0},{"had_liked":false,"id":47100,"user_name":"code2","can_delete":false,"product_type":"c1","uid":1281792,"ip_address":"","ucode":"BBA5748FB6A01C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/8OPzdpDraQMvCNWAicicDt54sDaIYJZicBLfMyibXVs4V0ZibEdkZlbzxxL7aGpRoeyvibag5LaAaaGKSdwYQMY2hUrQ/132","comment_is_top":false,"comment_ctime":1544056582,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544056582","product_id":100020901,"comment_content":"凑热闹用crntos7试了一下，没有见到异常。","like_count":0},{"had_liked":false,"id":47081,"user_name":"📆","can_delete":false,"product_type":"c1","uid":1219314,"ip_address":"","ucode":"1D0C14DB6F40C4","user_header":"https://static001.geekbang.org/account/avatar/00/12/9a/f2/64d1c380.jpg","comment_is_top":false,"comment_ctime":1544051563,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544051563","product_id":100020901,"comment_content":"不好意思，之前写错了，僵尸进程的父进程pid是1","like_count":0},{"had_liked":false,"id":47030,"user_name":"9527","can_delete":false,"product_type":"c1","uid":1032735,"ip_address":"","ucode":"04B51C09E3C7B8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c2/1f/343f2dec.jpg","comment_is_top":false,"comment_ctime":1544021883,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544021883","product_id":100020901,"comment_content":"最近正好在看unix高级编程，SIGCHLD是不可靠信号，如果父进程做了什么阻塞信号的操作或者突然有多个子进程同时发出这个信号，那么父进程就只能收到一个信号，那就没法彻底回收了，这种情况是不是无解的呢？<br>另外可否忽略这个信号，直接让init去处理回收子进程？","like_count":0},{"had_liked":false,"id":47017,"user_name":"404","can_delete":false,"product_type":"c1","uid":1313407,"ip_address":"","ucode":"2E7815DDCBA8AB","user_header":"","comment_is_top":false,"comment_ctime":1544019272,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544019272","product_id":100020901,"comment_content":"老师，你的环境是搭建了2台虚拟机，然后在虚拟机上跑了docker,我现在的情况是系统是unix，首先搭建不出来2台虚拟机，想着是起2个docker 来代替你的虚拟机，但我自己搭建dock 儿 出了问题，跑不起来。所以你那边是否可以再用docker 搭建另一套模拟环境。","like_count":0},{"had_liked":false,"id":46985,"user_name":"王涛","can_delete":false,"product_type":"c1","uid":1315326,"ip_address":"","ucode":"6241F08634D342","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/fe/de00d8d8.jpg","comment_is_top":false,"comment_ctime":1544014928,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544014928","product_id":100020901,"comment_content":"早上看了一半，晚上回来看完了。打卡D7","like_count":0},{"had_liked":false,"id":46978,"user_name":"仲鬼","can_delete":false,"product_type":"c1","uid":1314692,"ip_address":"","ucode":"DB1CD7052D5BA6","user_header":"https://static001.geekbang.org/account/avatar/00/14/0f/84/d8e63885.jpg","comment_is_top":false,"comment_ctime":1544014236,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544014236","product_id":100020901,"comment_content":"老师好，实验的centos 7.2中未看到Idle状态的进程。方便举例讲细一些吗？或者给些资料？","like_count":0},{"had_liked":false,"id":46961,"user_name":"404","can_delete":false,"product_type":"c1","uid":1313407,"ip_address":"","ucode":"2E7815DDCBA8AB","user_header":"","comment_is_top":false,"comment_ctime":1544009454,"is_pvip":false,"replies":[{"id":"16751","content":"案例应用已经是docker镜像了，你试试可以正常启动吗？ 分析的时候可以docker exec到容器里面来试试","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544016291,"ip_address":"","comment_id":46961,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544009454","product_id":100020901,"comment_content":"  老师，我的系统是unix 的，装不了虚拟机。你是否可以将你虚拟机环境封装成 2 个 docker ,然后我用docker 来搭建你对应的虚拟机环境。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431620,"discussion_content":"案例应用已经是docker镜像了，你试试可以正常启动吗？ 分析的时候可以docker exec到容器里面来试试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544016291,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46933,"user_name":"路过","can_delete":false,"product_type":"c1","uid":1316401,"ip_address":"","ucode":"7152C19ED024CC","user_header":"https://static001.geekbang.org/account/avatar/00/14/16/31/ae8adf82.jpg","comment_is_top":false,"comment_ctime":1544004043,"is_pvip":false,"replies":[{"id":"16753","content":"再考虑下，从perf的调用栈能不能看出什么线索？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544016386,"ip_address":"","comment_id":46933,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544004043","product_id":100020901,"comment_content":"使用mpstat,pidstat,iotop,vmstat,iostat,perf-tools都只能跟踪到是app这个进程导致的。使用pkill -9 app，就会杀死包括docker在内的虚拟服务。虽然结局问题。但没有找到到底是哪个愿意导致的。如果不上看程序源码，感觉没有啥头绪。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431608,"discussion_content":"再考虑下，从perf的调用栈能不能看出什么线索？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544016386,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46919,"user_name":"小华","can_delete":false,"product_type":"c1","uid":1178511,"ip_address":"","ucode":"2C67589CBA8DED","user_header":"https://static001.geekbang.org/account/avatar/00/11/fb/8f/c2c8869c.jpg","comment_is_top":false,"comment_ctime":1544002060,"is_pvip":false,"replies":[{"id":"16755","content":"嗯嗯 centos有些不一样。这个案例用到的工具只有docker不一样，centos上要安装docker-ce，可以到docker网站上查看安装方法","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544016815,"ip_address":"","comment_id":46919,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544002060","product_id":100020901,"comment_content":"老师，可以每次列清楚咱们用到的linux工具吗，我的是centos系统，两者安装名有的时候不一样","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431600,"discussion_content":"嗯嗯 centos有些不一样。这个案例用到的工具只有docker不一样，centos上要安装docker-ce，可以到docker网站上查看安装方法","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544016815,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46902,"user_name":"for","can_delete":false,"product_type":"c1","uid":1006284,"ip_address":"","ucode":"F062F823A1B698","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5a/cc/448a4620.jpg","comment_is_top":false,"comment_ctime":1543999385,"is_pvip":false,"replies":[{"id":"16757","content":"我的机器配置太弱了，IO已经跑满还是好多人都没有观察到iowait的现象。重新推了一个镜像，加大了IO操作，再试试看现在怎么样","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544017123,"ip_address":"","comment_id":46902,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543999385","product_id":100020901,"comment_content":"ubuntu 18.04 x86_64 2CPU，看到的异常点是僵尸进程逐渐增多，CPU负载未见异常。<br>ps aux | grep &#47;app 未见D状态的进程","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431592,"discussion_content":"我的机器配置太弱了，IO已经跑满还是好多人都没有观察到iowait的现象。重新推了一个镜像，加大了IO操作，再试试看现在怎么样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544017123,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46863,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1543993238,"is_pvip":false,"replies":[{"id":"16759","content":"👍 已经分析的很细致了。iowait的问题，是因为案例应用的IO操作比较保守，重推了案例镜像，再试试怎么样","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544017309,"ip_address":"","comment_id":46863,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543993238","product_id":100020901,"comment_content":"[D7打卡]<br>系统环境: ubuntu 18.04虚拟机 4cpu 6G内存.<br>启动docker后观测到的数据如下:<br># ps aux | grep &#47;app<br>root      2134  0.0  0.0   4376  1044 pts&#47;0    Ss+  14:07   0:00 &#47;app<br># ps aux | grep app<br>root      2134  0.0  0.0   4376  1044 pts&#47;0    Ss+  14:07   0:00 &#47;app<br>root      2189  0.0  0.0      0     0 pts&#47;0    Z+   14:07   0:00 [app] &lt;defunct&gt;<br>...<br># top -d1<br>top - 14:39:41 up  2:46,  5 users,  load average: 0.03, 0.07, 0.26<br>任务: 1065 total,   1 running, 231 sleeping,   0 stopped, 781 zombie<br>%Cpu(s):  0.0 us,  3.0 sy,  0.0 ni, 97.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>KiB Mem :  6098388 total,  2850004 free,  1182712 used,  2065672 buff&#47;cache<br>#  pidstat -wut -p 2134 1<br> cswch&#47;s nvcswch&#47;s 切换次数极低,几乎为0.<br># vmstat 1 11<br>procs -----------memory---------- ---swap-- -----io---- -system-- ------cpu-----<br> r  b 交换 空闲 缓冲 缓存   si   so    bi    bo   in   cs us sy id wa st<br> 1  0      0 2852420 203804 1861316    0    0     0     0  333  588  0  1 99  0  0<br>同上<br>同上<br> 0  0      0 2851176 203804 1861412    0    0 131072     0  598  923  1  4 94  2  0<br> 0  0      0 2850644 203804 1861444    0    0     0     0  438  759  1  1 98  0  0<br>同上<br>同上<br>同上<br> 0  0      0 2849548 203812 1861388    0    0 131072     0  502  827  0  3 96  1  0<br>[几乎每5秒有一次bi升高, 且伴随着top中zombie增加2个.]<br># pstree | grep app<br>        |-dockerd-+-docker-containe-+-docker-containe-+-app---1082*[app]<br>[再次说明僵尸进程是app产生的]<br># perf top -g -p 2134<br>-   96.67%     0.00%  app      app                [.] main<br>   - main<br>      - 86.67% read<br>           entry_SYSCALL_64_after_hwframe<br>           do_syscall_64<br>           sys_read<br>           vfs_read<br>           __vfs_read<br>           new_sync_read<br>           blkdev_read_iter<br>           generic_file_read_iter<br>         - blkdev_direct_IO<br>            - 72.00% bio_iov_iter_get_pages<br>                 iov_iter_get_pages<br>               + get_user_pages_fast<br>[samples数不多 可能参考意义不大]<br># docker exec -ti app &#47;bin&#47;bash<br>-rwxr-xr-x    1 root root 13040 Oct 10 07:06 app*<br>[只有可执行程序]<br>个人总结:虽然知道是app进程导致的,且几乎以固定频率5s多出2个僵尸进程.各项指标也算正常,并未有iowait升高的状况.并不知道进一步该如何分析了","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431577,"discussion_content":"👍 已经分析的很细致了。iowait的问题，是因为案例应用的IO操作比较保守，重推了案例镜像，再试试怎么样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544017309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46861,"user_name":"Any Hello mino","can_delete":false,"product_type":"c1","uid":1004683,"ip_address":"","ucode":"01EF8ECC801F6D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/8b/27ae435c.jpg","comment_is_top":false,"comment_ctime":1543993202,"is_pvip":false,"replies":[{"id":"16760","content":"这次是因为你的机器配置比我的好太多了😓我的机器上IO已经跑满了。<br><br>重新推了一个镜像，加大了IO操作，再试试看现在怎么样","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544017386,"ip_address":"","comment_id":46861,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543993202","product_id":100020901,"comment_content":"不一样啊 全是z进程 负载没变化 io也没变化 只看到z进程在增加 老师能用centos系统么 上次的perf top案例也是 都是16进制看不见 这样怎么教学 docer又没有perf系统又不一样 好麻烦","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431576,"discussion_content":"这次是因为你的机器配置比我的好太多了😓我的机器上IO已经跑满了。\n\n重新推了一个镜像，加大了IO操作，再试试看现在怎么样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544017386,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46845,"user_name":"猫王者","can_delete":false,"product_type":"c1","uid":1248924,"ip_address":"","ucode":"224826F4BA8443","user_header":"https://static001.geekbang.org/account/avatar/00/13/0e/9c/cb9da823.jpg","comment_is_top":false,"comment_ctime":1543990665,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543990665","product_id":100020901,"comment_content":"容器运行之后只有s+和z两个状态，没看到有D的进程","like_count":0},{"had_liked":false,"id":46826,"user_name":"Clear","can_delete":false,"product_type":"c1","uid":1110680,"ip_address":"","ucode":"AD768DB7654F7B","user_header":"https://static001.geekbang.org/account/avatar/00/10/f2/98/e2c92588.jpg","comment_is_top":false,"comment_ctime":1543987221,"is_pvip":false,"replies":[{"id":"16762","content":"iowait本身就是一种类型的CPU使用率指标","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544017481,"ip_address":"","comment_id":46826,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543987221","product_id":100020901,"comment_content":"老师你好，iowait为什么会导致cpu使用率增高呢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431559,"discussion_content":"iowait本身就是一种类型的CPU使用率指标","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544017481,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46787,"user_name":"icode","can_delete":false,"product_type":"c1","uid":1316610,"ip_address":"","ucode":"1B029C8ED37CFE","user_header":"https://static001.geekbang.org/account/avatar/00/14/17/02/8ec52987.jpg","comment_is_top":false,"comment_ctime":1543981863,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543981863","product_id":100020901,"comment_content":"老师D状态的进程，在资源处理完成之前是一直处于跑完CPU时间片对吧？此时其他进程也来访问它占用的资源也将处于D状态吗","like_count":0},{"had_liked":false,"id":46778,"user_name":"dexter","can_delete":false,"product_type":"c1","uid":1315252,"ip_address":"","ucode":"DD51207438FBD6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEL5xnfuicbtRz4F87AAjZX6oCEjMtYiaIu4iaQichQmy0vEBA6Sumic1RDvUCeuBEqj6iatnt2kENbKYmuw/132","comment_is_top":false,"comment_ctime":1543980488,"is_pvip":false,"replies":[{"id":"16763","content":"docs.docker.com上面有安装文档","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544017569,"ip_address":"","comment_id":46778,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543980488","product_id":100020901,"comment_content":"我虚拟机是reht6.5，这几天用yum安装docker，一致找不到docker包（其他程序可以yum），不知道docker安装是在哪个库里面，这2天的实验还没有做","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431542,"discussion_content":"docs.docker.com上面有安装文档","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544017569,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46760,"user_name":"樊海涛","can_delete":false,"product_type":"c1","uid":1323249,"ip_address":"","ucode":"0B04D5985EE0E1","user_header":"https://static001.geekbang.org/account/avatar/00/14/30/f1/bf7fd8d2.jpg","comment_is_top":false,"comment_ctime":1543978255,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543978255","product_id":100020901,"comment_content":"day8打卡","like_count":0},{"had_liked":false,"id":46747,"user_name":"帆帆帆帆帆帆帆帆","can_delete":false,"product_type":"c1","uid":1304645,"ip_address":"","ucode":"0CB732FFD07463","user_header":"https://static001.geekbang.org/account/avatar/00/13/e8/45/c58cb283.jpg","comment_is_top":false,"comment_ctime":1543976777,"is_pvip":false,"replies":[{"id":"16768","content":"这时候CPU使用率会升高一些但不一定会特别高，所以跟CPU密集型进程比，单纯看CPU使用率的话你可能不会发现它是有性能问题的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544018256,"ip_address":"","comment_id":46747,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543976777","product_id":100020901,"comment_content":"有一个问题没有想明白：<br>平均负载是指单位时间内，系统处于可运行状态和不可中断状态的平均进程数，和 CPU 使用率并没有直接关系。比如不可中断状态的进程多了（IO繁忙），平均负载会升高，但此时cpu使用率并不高。但问题是CPU使用率=1-空闲时间&#47;总CPU时间，IO繁忙，那进程iowait就应该很高，此时CPU使用率也应该很高呀。和前面的分析不一致呢。求解答。<br>","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431526,"discussion_content":"这时候CPU使用率会升高一些但不一定会特别高，所以跟CPU密集型进程比，单纯看CPU使用率的话你可能不会发现它是有性能问题的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544018256,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46739,"user_name":"📆","can_delete":false,"product_type":"c1","uid":1219314,"ip_address":"","ucode":"1D0C14DB6F40C4","user_header":"https://static001.geekbang.org/account/avatar/00/12/9a/f2/64d1c380.jpg","comment_is_top":false,"comment_ctime":1543976217,"is_pvip":false,"replies":[{"id":"16771","content":"僵尸进程需要找出父进程来解决的。“pid是1”是不是观察错了，1号进程只能是init进程（比如systemd）","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544018617,"ip_address":"","comment_id":46739,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543976217","product_id":100020901,"comment_content":"老师你好，我们业务上面跑的kvm虚拟机，挂载的iscsi存储，可是每隔一个月左右，总有一台服务器报后端存储延时，然后所有的虚拟机全部挂掉，ps查看qemu进程，发现全部变成僵尸进程了，而且进程的pid是1，查了一下这种情况要么自动恢复要么重启系统，可是等了8,9个小时都没有恢复只能重启系统恢复虚拟机，这种情况只能重启系统没有其他办法结束僵尸进程了么？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431522,"discussion_content":"僵尸进程需要找出父进程来解决的。“pid是1”是不是观察错了，1号进程只能是init进程（比如systemd）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544018617,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46738,"user_name":"JohnT3e","can_delete":false,"product_type":"c1","uid":1063982,"ip_address":"","ucode":"CF4AAAC933529C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLdWHFCr66TzHS2CpCkiaRaDIk3tU5sKPry16Q7ic0mZZdy8LOCYc38wOmyv5RZico7icBVeaPX8X2jcw/132","comment_is_top":false,"comment_ctime":1543976136,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543976136","product_id":100020901,"comment_content":"PROCESS STATE CODES<br>       Here are the different values that the s, stat and state output specifiers (header &quot;STAT&quot; or &quot;S&quot;) will display<br>       to describe the state of a process:<br><br>               D    uninterruptible sleep (usually IO)<br>               R    running or runnable (on run queue)<br>               S    interruptible sleep (waiting for an event to complete)<br>               T    stopped by job control signal<br>               t    stopped by debugger during the tracing<br>               W    paging (not valid since the 2.6.xx kernel)<br>               X    dead (should never be seen)<br>               Z    defunct (&quot;zombie&quot;) process, terminated but not reaped by its parent<br><br>       For BSD formats and when the stat keyword is used, additional characters may be displayed:<br><br>               &lt;    high-priority (not nice to other users)<br>               N    low-priority (nice to other users)<br>               L    has pages locked into memory (for real-time and custom IO)<br>               s    is a session leader<br>               l    is multi-threaded (using CLONE_THREAD, like NPTL pthreads do)<br>               +    is in the foreground process group","like_count":0},{"had_liked":false,"id":46709,"user_name":"大飞","can_delete":false,"product_type":"c1","uid":1320080,"ip_address":"","ucode":"2D98888FC63CA9","user_header":"","comment_is_top":false,"comment_ctime":1543973226,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543973226","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":46699,"user_name":"小人物","can_delete":false,"product_type":"c1","uid":1318973,"ip_address":"","ucode":"74C8A3239CA213","user_header":"https://static001.geekbang.org/account/avatar/00/14/20/3d/0233cbab.jpg","comment_is_top":false,"comment_ctime":1543972583,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543972583","product_id":100020901,"comment_content":"请问，当进程调用read系统调用之后，在等待磁盘返回数据的时候，进程究竟会处于D状态还是S状态？当发生io操作的时候，进程不是会被挂起，然后被调度走吗，此时CPU出让，状态不应该是S吗，那这样的话D状态是如何出现的？","like_count":0},{"had_liked":false,"id":46690,"user_name":"Aaron Cheung","can_delete":false,"product_type":"c1","uid":1079816,"ip_address":"","ucode":"03972759C53667","user_header":"https://static001.geekbang.org/account/avatar/00/10/7a/08/4d3e47dd.jpg","comment_is_top":false,"comment_ctime":1543971701,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543971701","product_id":100020901,"comment_content":"先打卡","like_count":0},{"had_liked":false,"id":46680,"user_name":"float sward","can_delete":false,"product_type":"c1","uid":1316444,"ip_address":"","ucode":"0549C9FE20531A","user_header":"https://static001.geekbang.org/account/avatar/00/14/16/5c/40e06141.jpg","comment_is_top":false,"comment_ctime":1543971108,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543971108","product_id":100020901,"comment_content":"Good","like_count":0},{"had_liked":false,"id":46679,"user_name":"风飘，吾独思","can_delete":false,"product_type":"c1","uid":1131032,"ip_address":"","ucode":"4DF0E7DC22EE53","user_header":"https://static001.geekbang.org/account/avatar/00/11/42/18/edc1b373.jpg","comment_is_top":false,"comment_ctime":1543970944,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543970944","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":46662,"user_name":"张泽南","can_delete":false,"product_type":"c1","uid":1194623,"ip_address":"","ucode":"2B97531351B2BE","user_header":"https://static001.geekbang.org/account/avatar/00/12/3a/7f/06d7af74.jpg","comment_is_top":false,"comment_ctime":1543969982,"is_pvip":false,"replies":[{"id":"16656","content":"极客时间有Kubernetes的，你可以看看。","user_name":"编辑回复","user_name_real":"郭蕾","uid":"1000473","ctime":1543970586,"ip_address":"","comment_id":46662,"utype":2}],"discussion_count":1,"race_medal":0,"score":"1543969982","product_id":100020901,"comment_content":"老师讲的很好，坚持学下去。老师什么时候出个docker的课程啊？？？","like_count":0,"discussions":[{"author":{"id":1000473,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/44/19/17fadc62.jpg","nickname":"郭蕾","note":"","ucode":"34F4C07D1C5FE8","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431500,"discussion_content":"极客时间有Kubernetes的，你可以看看。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543970586,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46586,"user_name":"Geek_101627","can_delete":false,"product_type":"c1","uid":1070389,"ip_address":"","ucode":"F246019019F1CB","user_header":"https://static001.geekbang.org/account/avatar/00/10/55/35/09e7dfde.jpg","comment_is_top":false,"comment_ctime":1543940770,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543940770","product_id":100020901,"comment_content":"打卡","like_count":0}]}