{"id":419664,"title":"åŠ é¤2 | ç”¨æˆ·Kaitoï¼šæˆ‘æ˜¯æ€ä¹ˆè¯»Redisæºç çš„ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯Kaitoï¼Œä¹Ÿæ˜¯ä¸¤å­£Redisè¯¾ç¨‹çš„è¯¾ä»£è¡¨ã€‚ä»Šå¤©ï¼Œæˆ‘æƒ³æ¥å’Œä½ åˆ†äº«ä¸€ä¸‹æˆ‘è¯»æºç çš„ç»éªŒï¼Œå¸Œæœ›èƒ½åŠ©åŠ›ä½ æ›´å¥½åœ°å­¦ä¹ Redisæºç ã€‚</p><p>é¦–å…ˆï¼Œä¸€æåˆ°è¯»æºç ï¼Œå¾ˆå¤šäººéƒ½ä¼šæ¯”è¾ƒç•æƒ§ï¼Œè®¤ä¸ºè¯»æºç æ˜¯é«˜æ‰‹æ‰ä¼šåšçš„äº‹æƒ…ã€‚å¯èƒ½é‡åˆ°é—®é¢˜æ—¶ï¼Œä»–ä»¬æ›´å€¾å‘äºå»æ‰¾åˆ«äººåˆ†äº«çš„ç­”æ¡ˆã€‚ä½†å¾€å¾€å¾ˆå¤šæ—¶å€™ï¼Œè‡ªå·±æŸ¥åˆ°çš„èµ„æ–™å¹¶ä¸èƒ½å¸®åŠ©è§£å†³æ‰€æœ‰é—®é¢˜ï¼Œå°¤å…¶æ˜¯æ¯”è¾ƒç»†èŠ‚çš„é—®é¢˜ã€‚</p><p>é‚£ä¹ˆä»æˆ‘çš„å®è·µç»éªŒæ¥çœ‹ï¼Œé‡åˆ°è¿™ç§æƒ…å†µï¼Œé€šå¸¸å°±éœ€è¦å»æºç ä¸­å¯»æ‰¾ç­”æ¡ˆäº†ï¼Œå› ä¸ºåœ¨æºç é¢å‰ï¼Œè¿™äº›ç»†èŠ‚ä¼šå˜å¾—ä¸€è§ˆæ— ä½™ã€‚è€Œä¸”æˆ‘è®¤ä¸ºï¼ŒæŒæ¡è¯»æºç çš„èƒ½åŠ›ï¼Œæ˜¯ä»åªæ‡‚å¾—å¦‚ä½•ä½¿ç”¨Redisï¼Œåˆ°ç²¾é€šRediså®ç°åŸç†çš„æˆé•¿ä¹‹è·¯ä¸Šï¼Œå¿…é¡»è·¨è¶Šçš„é—¨æ§›ã€‚å¯æ˜¯ï¼Œ<strong>é¢å¯¹åºå¤§å¤æ‚çš„é¡¹ç›®ï¼Œæˆ‘ä»¬æ€æ ·è¯»æºç æ‰èƒ½æ›´é«˜æ•ˆå‘¢ï¼Ÿ</strong></p><p>æ‰€ä»¥ä¸‹é¢ï¼Œæˆ‘å°±æ¥å’Œä½ èŠä¸€èŠæˆ‘åœ¨è¯»æºç æ—¶çš„ç»éªŒå’Œå¿ƒå¾—ã€‚</p><h2>æ‰¾åˆ°åœ°å›¾</h2><p>å¾ˆå¤šå¼€æºé¡¹ç›®çš„æºç ï¼Œä»£ç é‡ä¸€èˆ¬éƒ½æ¯”è¾ƒåºå¤§ï¼Œå¦‚æœåœ¨è¯»ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬æ²¡æœ‰åˆ¶å®šåˆç†çš„æ–¹æ³•ï¼Œå°±ä¸€å¤´æ‰è¿›å»è¯»ä»£ç ï¼ŒåŠ¿å¿…ä¼šæŠŠè‡ªå·±ææ™•ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘åœ¨æ‹¿åˆ°ä¸€ä¸ªé¡¹ç›®çš„ä»£ç ä¹‹åï¼Œå¹¶ä¸ä¼šé©¬ä¸Šç€æ‰‹å»è¯»ï¼Œè€Œæ˜¯ä¼šå…ˆå¯¹æ•´ä¸ªé¡¹ç›®ç»“æ„è¿›è¡Œæ¢³ç†ï¼Œåˆ’åˆ†å‡ºé¡¹ç›®å…·ä½“åŒ…å«çš„æ¨¡å—ã€‚è¿™æ ·ï¼Œæˆ‘å°±å¯¹æ•´ä¸ªé¡¹ç›®æœ‰äº†ä¸€ä¸ªå®è§‚çš„äº†è§£ã€‚</p><p>å› ä¸ºè¯»ä»£ç å°±å¥½æ¯”å»ä¸€ä¸ªé™Œç”ŸåŸå¸‚æ—…è¡Œï¼Œè¿™ä¸ªæ—…é€”è¿‡ç¨‹å……æ»¡ç€æœªçŸ¥ã€‚å¦‚æœåœ¨å‡ºå‘ä¹‹å‰ï¼Œæˆ‘ä»¬æ‰‹é‡Œèƒ½æœ‰ä¸€å¼ åœ°å›¾ï¼Œé‚£æˆ‘ä»¬å¯¹è‡ªå·±çš„è¡Œç¨‹å°±å¯ä»¥æœ‰ä¸€ä¸ªéå¸¸æ¸…æ™°çš„è§„åˆ’ï¼Œæˆ‘ä»¬å°±çŸ¥é“ï¼Œå¦‚æœæƒ³è¦åˆ°è¾¾ç›®çš„åœ°ï¼Œéœ€è¦ä»å“ªé‡Œå‡ºå‘ã€ç»è¿‡å“ªäº›åœ°æ–¹ã€é€šè¿‡ä»€ä¹ˆæ–¹å¼æ‰èƒ½åˆ°è¾¾ï¼Œ<strong>æœ‰äº†åœ°å›¾å°±æœ‰äº†è¡Œè¿›æ–¹å‘</strong>ï¼Œå¦åˆ™å¾ˆå®¹æ˜“è¿·å¤±ã€‚</p><!-- [[[read_end]]] --><p>å› æ­¤ï¼Œæå‰èŠ±ä¸€äº›æ—¶é—´æ¢³ç†æ•´ä¸ªé¡¹ç›®çš„ç»“æ„å’Œç›®å½•ï¼Œå¯¹äºåé¢æ›´å¥½åœ°é˜…è¯»ä»£ç æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚å°±æ‹¿Redisæ¥ä¸¾ä¾‹ï¼Œåœ¨è¯»Redisæºç ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆæ¢³ç†å‡ºæ•´ä¸ªé¡¹ç›®çš„åŠŸèƒ½æ¨¡å—ï¼Œä»¥åŠæ¯ä¸ªæ¨¡å—å¯¹åº”çš„ä»£ç æ–‡ä»¶ï¼Œä»¥ä¸‹ç»™å‡ºçš„å°±æ˜¯srcä¸‹çš„ä»£ç ç»“æ„ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/8d/fc/8de27eda5312b45e70f80e8d534ecafc.jpg?wh=1920x1561\" alt=\"å›¾ç‰‡\"></p><p>è¿™æ ·ï¼Œæœ‰äº†è¿™å¼ åœ°å›¾ä¹‹åï¼Œæˆ‘ä»¬å†å»çœ‹ä»£ç çš„æ—¶å€™ï¼Œå°±å¯ä»¥æœ‰é‡ç‚¹åœ°é˜…è¯»äº†ã€‚</p><h2>å‰ç½®çŸ¥è¯†å‡†å¤‡</h2><p>åœ¨æ¢³ç†å®Œæ•´ä¸ªé¡¹ç›®ç»“æ„ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ­£å¼è¿›å…¥é˜…è¯»ç¯èŠ‚å½“ä¸­äº†ã€‚</p><p>ä¸è¿‡ï¼Œåœ¨é˜…è¯»ä»£ç ä¹‹å‰ï¼Œæˆ‘ä»¬å…¶å®è¿˜éœ€è¦é¢„å…ˆæŒæ¡ä¸€äº›å‰ç½®çŸ¥è¯†ã€‚å› ä¸ºä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®ï¼Œå¿…ç„¶ç»¼åˆäº†å„ä¸ªé¢†åŸŸçš„æŠ€æœ¯çŸ¥è¯†ç‚¹ï¼Œæ¯”å¦‚æ•°æ®ç»“æ„ã€æ“ä½œç³»ç»Ÿã€ç½‘ç»œåè®®ã€ç¼–ç¨‹è¯­è¨€ç­‰ï¼Œå¦‚æœæˆ‘ä»¬æå‰åšå¥½ä¸€äº›åŠŸè¯¾ï¼Œåœ¨è¯»æºç çš„è¿‡ç¨‹ä¸­å°±ä¼šè½»æ¾å¾ˆå¤šã€‚ä»¥ä¸‹æ˜¯æ ¹æ®æˆ‘åœ¨é˜…è¯»Redisä¹¦ç±å’Œå®æˆ˜è¿‡ç¨‹ä¸­ï¼Œæå–çš„è¯»æºç å¿…å¤‡å‰ç½®çŸ¥è¯†ç‚¹ï¼Œç»™ä½ å‚è€ƒä¸€ä¸‹ã€‚</p><ul>\n<li>å¸¸ç”¨æ•°æ®ç»“æ„ï¼šæ•°ç»„ã€é“¾è¡¨ã€å“ˆå¸Œè¡¨ã€è·³è¡¨ã€‚</li>\n<li>ç½‘ç»œåè®®ï¼šTCPåè®®ã€‚</li>\n<li>ç½‘ç»œIOæ¨¡å‹ï¼šIOå¤šè·¯å¤ç”¨ã€éé˜»å¡IOã€Reactorç½‘ç»œæ¨¡å‹ã€‚</li>\n<li>æ“ä½œç³»ç»Ÿï¼šå†™æ—¶å¤åˆ¶ï¼ˆCopy On Writeï¼‰ã€å¸¸è§ç³»ç»Ÿè°ƒç”¨ã€ç£ç›˜IOæœºåˆ¶ã€‚</li>\n<li>Cè¯­è¨€åŸºç¡€ï¼šå¾ªç¯ã€åˆ†æ”¯ã€ç»“æ„ä½“ã€æŒ‡é’ˆã€‚</li>\n</ul><p>å½“ç„¶ï¼Œåœ¨é˜…è¯»æºç çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®å®é™…é—®é¢˜å†å»æŸ¥é˜…ç›¸å…³èµ„æ–™ï¼Œä½†ä¸ç®¡æ€æ ·ï¼Œæå‰ç†Ÿæ‚‰è¿™äº›æ–¹é¢çš„çŸ¥è¯†ï¼Œåœ¨çœŸæ­£è¯»ä»£ç æ—¶å°±ä¼šçœä¸‹ä¸å°‘æ—¶é—´ã€‚</p><h2>ä»åŸºç¡€æ¨¡å—å¼€å§‹è¯»</h2><p>å¥½ï¼Œæœ‰äº†åœ°å›¾å¹¶æŒæ¡äº†å‰ç½®çŸ¥è¯†ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦è¿›å…¥ä¸»é¢˜äº†ï¼š<strong>è¯»ä»£ç </strong>ã€‚ä½†å…·ä½“è¦ä»å“ªä¸ªåœ°æ–¹å¼€å§‹è¯»èµ·å‘¢ï¼Ÿæˆ‘è®¤ä¸ºè¦å…ˆä»æœ€åŸºç¡€çš„æ¨¡å—å¼€å§‹è¯»èµ·ã€‚</p><p>æˆ‘åœ¨å‰é¢ä¹Ÿåˆ†æäº†ï¼Œä¸€ä¸ªå®Œæ•´çš„é¡¹ç›®ä¼šåˆ’åˆ†å¾ˆå¤šçš„åŠŸèƒ½æ¨¡å—ï¼Œä½†è¿™äº›æ¨¡å—å¹¶ä¸æ˜¯å­¤ç«‹çš„ï¼Œè€Œå¾ˆå¯èƒ½æ˜¯æœ‰ä¾èµ–å…³ç³»çš„ã€‚æ¯”å¦‚è¯´ï¼ŒRedisä¸­çš„networking.cæ–‡ä»¶ï¼Œè¡¨ç¤ºå¤„ç†ç½‘ç»œIOçš„å…·ä½“å®ç°ã€‚è€Œå¦‚æœæˆ‘ä»¬èƒ½åœ¨ç†è§£äº‹ä»¶é©±åŠ¨æ¨¡å—ae.cçš„åŸºç¡€ä¸Šï¼Œå†å»é˜…è¯»ç½‘ç»œIOæ¨¡å—ï¼Œæ•ˆç‡å°±ä¼šæ›´é«˜ã€‚</p><p>é‚£ä¹ˆåœ¨Redisæºç ä¸­ï¼Œå“ªäº›æ˜¯æœ€åŸºç¡€çš„æ¨¡å—å‘¢ï¼Ÿæƒ³ä¸€ä¸‹ï¼Œæˆ‘ä»¬åœ¨ä½¿ç”¨Redisæ—¶ï¼Œæ¥è§¦æœ€é¢‘ç¹çš„æ˜¯å“ªäº›åŠŸèƒ½ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯<strong>å„ç§æ•°æ®ç±»å‹</strong>ã€‚</p><p><strong>ä¸€åˆ‡æ“ä½œçš„åŸºç¡€ï¼Œå…¶å®éƒ½æ˜¯åŸºäºè¿™äº›æœ€å¸¸ç”¨çš„æ•°æ®ç±»å‹æ¥åšçš„</strong>ï¼Œæ¯”å¦‚Stringã€Listã€Hashã€Setã€Sorted Setç­‰ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»è¿™äº›åŸºç¡€æ¨¡å—å¼€å§‹è¯»èµ·ï¼Œä¹Ÿå°±æ˜¯ä»t_string.cã€t_list.cã€t_hash.cã€t_set.cã€t_zset.cä»£ç å…¥æ‰‹ã€‚</p><p>å¦‚æœä½ å¯¹Redisçš„æ•°æ®ç±»å‹æœ‰æ‰€äº†è§£ï¼Œå°±ä¼šçœ‹åˆ°è¿™äº›æ•°æ®ç±»å‹åœ¨å®ç°æ—¶ï¼Œåº•å±‚éƒ½å¯¹åº”äº†ä¸åŒçš„æ•°æ®ç»“æ„ã€‚æ¯”å¦‚ï¼ŒStringçš„åº•å±‚æ˜¯SDSï¼ŒListçš„åº•å±‚æ˜¯ziplist + quicklistï¼ŒHashåº•å±‚å¯èƒ½æ˜¯ziplistï¼Œä¹Ÿå¯èƒ½æ˜¯å“ˆå¸Œè¡¨ï¼Œç­‰ç­‰ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/7c/35/7cf142081a43bba5ee84904c80ec3635.jpg?wh=1920x792\" alt=\"å›¾ç‰‡\"></p><p>è€Œç”±æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œè¿™äº›æ•°æ®ç»“æ„åˆæ˜¯æ›´ä¸ºåº•å±‚çš„æ¨¡å—ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨é˜…è¯»æ•°æ®ç±»å‹æ¨¡å—æ—¶ï¼Œå°±éœ€è¦é‡ç‚¹èšç„¦åœ¨è¿™äº›æ¨¡å—ä¸Šï¼Œä¹Ÿå°±æ˜¯sds.cã€ziplist.cã€quicklist.cã€dict.cã€intset.cæ–‡ä»¶ï¼Œè€Œä¸”è¿™äº›æ–‡ä»¶éƒ½æ˜¯æ¯”è¾ƒç‹¬ç«‹çš„ï¼Œé˜…è¯»èµ·æ¥å°±å¯ä»¥æ›´åŠ é›†ä¸­ã€‚</p><p>è¿™æ ·ï¼Œå½“æˆ‘ä»¬çœŸæ­£æŒæ¡äº†è¿™äº›åº•å±‚æ•°æ®ç»“æ„çš„å®ç°åï¼Œå°±èƒ½æ›´å¥½åœ°ç†è§£åŸºäºå®ƒä»¬å®ç°çš„å„ç§æ•°æ®ç±»å‹äº†ã€‚<strong>è¿™äº›åŸºç¡€æ¨¡å—å°±ç›¸å½“äºä¸€åº§å¤§å¦çš„åœ°åŸºï¼Œåœ°åŸºæ‰“å¥½äº†ï¼Œæ‰èƒ½åšåˆ°é«˜æ¥¼è€¸ç«‹ã€‚</strong></p><h2>æ‰¾åˆ°æ ¸å¿ƒä¸»çº¿</h2><p>æ¥ç€ï¼ŒæŒæ¡äº†æ•°æ®ç»“æ„æ¨¡å—ä¹‹åï¼Œè¿™æ—¶æˆ‘ä»¬çš„é‡ç‚¹å°±éœ€è¦æ”¾åœ¨æ ¸å¿ƒä¸»çº¿ä¸Šæ¥äº†ã€‚</p><p>åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªæ˜ç¡®çš„ç›®æ ‡ï¼Œä»¥è¿™ä¸ªç›®æ ‡ä¸ºä¸»çº¿å»è¯»ä»£ç ã€‚å› ä¸ºè¯»æºç å…¶å®æ˜¯ä¸€ä¸ªå¾ˆå¸¸è§çš„éœ€æ±‚ï¼Œå°±æ˜¯ä¸ºäº†äº†è§£è¿™ä¸ªé¡¹ç›®æœ€æ ¸å¿ƒåŠŸèƒ½çš„å®ç°ç»†èŠ‚ï¼Œæˆ‘ä»¬åªæœ‰ä»¥æ­¤ä¸ºç›®æ ‡ï¼Œæ‰¾åˆ°è¿™æ¡ä¸»çº¿å»è¯»ä»£ç ï¼Œæ‰èƒ½è¾¾åˆ°æœ€ç»ˆç›®çš„ã€‚</p><p>é‚£ä¹ˆåœ¨è¯»Redisæºç æ—¶ï¼Œä»€ä¹ˆæ‰æ˜¯å®ƒçš„æ ¸å¿ƒä¸»çº¿å‘¢ï¼Ÿè¿™é‡Œæˆ‘åˆ†äº«ä¸€ä¸ªéå¸¸å¥½ç”¨çš„æŠ€å·§ï¼Œå°±æ˜¯æ ¹æ®â€œ<strong>Redisç©¶ç«Ÿæ˜¯æ€ä¹ˆå¤„ç†å®¢æˆ·ç«¯å‘æ¥çš„å‘½ä»¤çš„ï¼Ÿ</strong>â€æ¥æ¢³ç†ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå½“æˆ‘ä»¬åœ¨æ‰§è¡ŒSET testkey testval EX 60è¿™æ ·ä¸€æ¡å‘½ä»¤æ—¶ï¼Œå°±éœ€è¦ææ¸…æ¥šRedisæ˜¯æ€ä¹ˆæ‰§è¡Œè¿™æ¡å‘½ä»¤çš„ã€‚ä¹Ÿå°±æ˜¯è¦æ˜ç¡®ï¼ŒRedisä»æ”¶åˆ°å®¢æˆ·ç«¯è¯·æ±‚ï¼Œåˆ°æŠŠæ•°æ®å­˜åˆ°Redisä¸­ã€è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæœ€åæŠŠå“åº”ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œæ•´ä¸ªè¿‡ç¨‹çš„æ¯ä¸€ä¸ªç¯èŠ‚ï¼Œåˆ°åº•æ˜¯å¦‚ä½•å¤„ç†çš„ã€‚</p><p>æœ‰äº†è¿™æ¡ä¸»çº¿ï¼Œæˆ‘ä»¬å°±æœ‰äº†éå¸¸æ˜ç¡®çš„ç›®æ ‡ï¼Œè€Œä¸”æ²¿ç€è¿™æ¡ä¸»çº¿å»è¯»ä»£ç ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¾ˆæ¸…æ™°åœ°æŠŠå¤šä¸ªæ¨¡å—ä¸²è”èµ·æ¥ã€‚æ¯”å¦‚ä»å‰é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€æ¡å‘½ä»¤çš„æ‰§è¡Œï¼Œä¸»è¦åŒ…å«äº†è¿™æ ·å‡ ä¸ªé˜¶æ®µã€‚</p><ul>\n<li><strong>Redis Serveråˆå§‹åŒ–</strong>ï¼šåŠ è½½é…ç½®ã€ç›‘å¬ç«¯å£ã€æ³¨å†Œè¿æ¥å»ºç«‹äº‹ä»¶ã€å¯åŠ¨äº‹ä»¶å¾ªç¯ï¼ˆserver.cã€anet.cï¼‰ã€‚</li>\n<li><strong>æ¥æ”¶ã€è§£æå®¢æˆ·ç«¯è¯·æ±‚</strong>ï¼šåˆå§‹åŒ–Clientã€æ³¨å†Œè¯»äº‹ä»¶ã€è¯»å®¢æˆ·ç«¯Socketï¼ˆnetworking.cï¼‰ã€‚</li>\n<li><strong>å¤„ç†å…·ä½“çš„å‘½ä»¤</strong>ï¼šæ‰¾åˆ°å¯¹åº”çš„å‘½ä»¤å‡½æ•°ã€æ‰§è¡Œå‘½ä»¤ï¼ˆserver.cã€t_string.cã€t_list.cã€t_hash.cã€t_set.cã€t_zset.cï¼‰ã€‚</li>\n<li><strong>è¿”å›å“åº”ç»™å®¢æˆ·ç«¯</strong>ï¼šå†™å®¢æˆ·ç«¯ç¼“å†²åŒºã€æ³¨å†Œå†™äº‹ä»¶ã€å†™å®¢æˆ·ç«¯Socketï¼ˆnetworking.cï¼‰ã€‚</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/87/3e/87e8563785353f4947ef70283842573e.jpg?wh=1920x882\" alt=\"å›¾ç‰‡\"></p><p>æ²¿ç€è¿™æ¡ä¸»çº¿å»è¯»ä»£ç ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŒæ¡ä¸€æ¡å‘½ä»¤çš„æ‰§è¡Œå…¨è¿‡ç¨‹ã€‚è€Œä¸”ï¼Œç”±äºè¿™æ¡ä¸»çº¿çš„ä»£ç é€»è¾‘ï¼Œå·²ç»è¦†ç›–äº†æ‰€æœ‰å‘½ä»¤çš„æ‰§è¡Œæµç¨‹ï¼Œæˆ‘ä»¬ä¸‹æ¬¡å†å»è¯»å…¶ä»–å‘½ä»¤æ—¶ï¼Œæ¯”å¦‚SADDï¼Œå°±åªéœ€è¦å…³æ³¨å¤„ç†å‘½ä»¤éƒ¨åˆ†çš„é€»è¾‘å³å¯ï¼Œå…¶ä»–é€»è¾‘æœ‰80%éƒ½æ˜¯ç›¸åŒçš„ã€‚</p><h2>å…ˆæ•´ä½“åç»†èŠ‚</h2><p>å½“ç„¶ï¼Œåœ¨é˜…è¯»ä¸»çº¿ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œè‚¯å®šä¹Ÿä¼šé‡åˆ°è¿‡äºå¤æ‚çš„å‡½æ•°ï¼Œç¬¬ä¸€æ¬¡åœ¨è¯»è¿™ç§å‡½æ•°æ—¶ï¼Œå¾ˆå®¹æ˜“å°±ä¼šé™·è¿›å»ï¼Œå¯¼è‡´æ•´ä¸ªä¸»çº¿ä»£ç çš„é˜…è¯»ï¼Œæ— æ³•ç»§ç»­æ¨è¿›ä¸‹å»ã€‚é‡åˆ°è¿™ç§æƒ…å†µå…¶å®æ˜¯å¾ˆæ­£å¸¸çš„ï¼Œå¯è¿™æ—¶æˆ‘ä»¬åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>è¿™é‡Œæˆ‘çš„åšæ³•æ˜¯ï¼Œå‰æœŸè¯»åˆ°è¿™ç§é€»è¾‘æ—¶ï¼Œä¸è¦é©¬ä¸Šé™·å…¥åˆ°ç»†èŠ‚ä¸­å»ï¼Œè€Œæ˜¯è¦<strong>å…ˆæŠ“æ•´ä½“</strong>ã€‚å…·ä½“æ¥è¯´ï¼Œå¯¹äºå¤æ‚çš„å‡½æ•°é€»è¾‘ï¼Œæˆ‘ä»¬åˆšå¼€å§‹å¹¶ä¸éœ€è¦çŸ¥é“å®ƒçš„æ¯ä¸€ä¸ªç»†èŠ‚æ˜¯å¦‚ä½•å®ç°çš„ï¼Œè€Œæ˜¯åªéœ€çŸ¥é“è¿™ä¸ªå‡½æ•°å¤§è‡´åšäº†å‡ ä»¶äº‹æƒ…å³å¯ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨æ‰§è¡ŒHSETå‘½ä»¤æ—¶ï¼Œæœ‰ä¸€æ®µä»£ç å¾ˆå¤æ‚ï¼Œå…¶ä¸­åŒ…æ‹¬äº†å¾ˆå¤šåˆ†æ”¯åˆ¤æ–­ï¼Œä¸€æ¬¡å¾ˆéš¾è¯»æ‡‚ï¼š</p><pre><code class=\"language-plain\">int hashTypeSet(robj *o, sds field, sds value, int flags) {\n&nbsp; &nbsp; int update = 0;\n\n&nbsp; &nbsp; if (o-&gt;encoding == OBJ_ENCODING_ZIPLIST) {\n&nbsp; &nbsp; &nbsp; &nbsp; unsigned char *zl, *fptr, *vptr;\n\n&nbsp; &nbsp; &nbsp; &nbsp; zl = o-&gt;ptr;\n&nbsp; &nbsp; &nbsp; &nbsp; fptr = ziplistIndex(zl, ZIPLIST_HEAD);\n&nbsp; &nbsp; &nbsp; &nbsp; if (fptr != NULL) {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fptr = ziplistFind(fptr, (unsigned char*)field, sdslen(field), 1);\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (fptr != NULL) {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Grab pointer to the value (fptr points to the field) */\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; vptr = ziplistNext(zl, fptr);\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; serverAssert(vptr != NULL);\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; update = 1;\n\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Delete value */\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zl = ziplistDelete(zl, &amp;vptr);\n\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Insert new value */\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zl = ziplistInsert(zl, vptr, (unsigned char*)value,\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdslen(value));\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; &nbsp; &nbsp; }\n\n&nbsp; &nbsp; &nbsp; &nbsp; if (!update) {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* Push new field/value pair onto the tail of the ziplist */\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zl = ziplistPush(zl, (unsigned char*)field, sdslen(field),\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ZIPLIST_TAIL);\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; zl = ziplistPush(zl, (unsigned char*)value, sdslen(value),\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ZIPLIST_TAIL);\n&nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; &nbsp; &nbsp; o-&gt;ptr = zl;\n\n&nbsp; &nbsp; &nbsp; &nbsp; /* Check if the ziplist needs to be converted to a hash table */\n&nbsp; &nbsp; &nbsp; &nbsp; if (hashTypeLength(o) &gt; server.hash_max_ziplist_entries)\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hashTypeConvert(o, OBJ_ENCODING_HT);\n&nbsp; &nbsp; } else if (o-&gt;encoding == OBJ_ENCODING_HT) {\n&nbsp; &nbsp; &nbsp; &nbsp; dictEntry *de = dictFind(o-&gt;ptr,field);\n&nbsp; &nbsp; &nbsp; &nbsp; if (de) {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sdsfree(dictGetVal(de));\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (flags &amp; HASH_SET_TAKE_VALUE) {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dictGetVal(de) = value;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value = NULL;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dictGetVal(de) = sdsdup(value);\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; update = 1;\n&nbsp; &nbsp; &nbsp; &nbsp; } else {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sds f,v;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (flags &amp; HASH_SET_TAKE_FIELD) {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; f = field;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; field = NULL;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; f = sdsdup(field);\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (flags &amp; HASH_SET_TAKE_VALUE) {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v = value;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value = NULL;\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v = sdsdup(value);\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; dictAdd(o-&gt;ptr,f,v);\n&nbsp; &nbsp; &nbsp; &nbsp; }\n&nbsp; &nbsp; } else {\n&nbsp; &nbsp; &nbsp; &nbsp; serverPanic(\"Unknown hash encoding\");\n&nbsp; &nbsp; }\n\n&nbsp; &nbsp; /* Free SDS strings we did not referenced elsewhere if the flags\n&nbsp; &nbsp; &nbsp;* want this function to be responsible. */\n&nbsp; &nbsp; if (flags &amp; HASH_SET_TAKE_FIELD &amp;&amp; field) sdsfree(field);\n&nbsp; &nbsp; if (flags &amp; HASH_SET_TAKE_VALUE &amp;&amp; value) sdsfree(value);\n&nbsp; &nbsp; return update;\n}\n</code></pre><p>é‚£ä¹ˆï¼Œæˆ‘åœ¨è¯»è¿™æ®µä»£ç æ—¶ï¼Œå°±å¯ä»¥å…ˆç®€åŒ–é€»è¾‘ï¼ŒæŠŠæ¡æ•´ä½“æ€è·¯ï¼š</p><pre><code class=\"language-plain\">// æ‰§è¡Œ HSET å‘½ä»¤\nint hashTypeSet(robj *o, sds field, sds value, int flags) {\n    ...\n    // å¦‚æœå½“å‰æ˜¯ ziplist ç¼–ç å­˜å‚¨\n    if (o-&gt;encoding == OBJ_ENCODING_ZIPLIST) {\n        ...\n    // å¦‚æœæ˜¯ hashtable ç¼–ç å­˜å‚¨\n    } else if (o-&gt;encoding == OBJ_ENCODING_HT) {\n        ...\n    } else {\n        serverPanic(\"Unknown hash encoding\");\n    }\n    ...\n}\n</code></pre><p>ä¹‹åï¼Œå†äº†è§£æ¯ä¸ªåˆ†æ”¯å¤§è‡´åšäº†å“ªäº›äº‹æƒ…ï¼š</p><pre><code class=\"language-plain\">// å¦‚æœå½“å‰æ˜¯ ziplist ç¼–ç å­˜å‚¨\nif (o-&gt;encoding == OBJ_ENCODING_ZIPLIST) {\n    ...\n    // field åœ¨ ziplist ä¸­ï¼Œä» ziplist ä¸­åˆ é™¤ï¼Œåœ¨æ’å…¥æ–°å€¼\n    if (fptr != NULL) {\n        fptr = ziplistFind(fptr, (unsigned char*)field, sdslen(field), 1);\n        zl = ziplistDelete(zl, &amp;vptr);\n        zl = ziplistInsert(zl, vptr, (unsigned char*)value, sdslen(value));\n        ...\n    }\n\n    // field ä¸åœ¨ ziplist ä¸­ï¼Œåˆ™æ’å…¥åˆ° ziplist\n    if (!update) {\n        zl = ziplistPush(zl, (unsigned char*)field, sdslen(field),\n                    ZIPLIST_TAIL);\n        ...\n    }\n\n    // ziplist å…ƒç´ è¶…è¿‡é˜ˆå€¼ï¼Œè½¬ä¸º hashtable\n    if (hashTypeLength(o) &gt; server.hash_max_ziplist_entries) {\n        hashTypeConvert(o, OBJ_ENCODING_HT);\n    }\n}\n</code></pre><p>è¿™æ ·åšçš„<strong>å¥½å¤„</strong>ï¼Œä¸€æ˜¯ä¸ä¼šè¢«å¤æ‚çš„ç»†èŠ‚é€»è¾‘ææ™•ï¼Œæ‰“å‡»è‡ªå·±çš„è‡ªä¿¡å¿ƒï¼›äºŒæ˜¯å¯ä»¥æœ‰æ•ˆé¿å…é˜…è¯»çš„è¿è´¯æ€§è¢«æ‰“æ–­ï¼Œä»è€Œèƒ½æŒç»­æ¨è¿›æˆ‘ä»¬æŠŠæ•´ä¸ªä¸»çº¿é€»è¾‘è¯»å®Œã€‚<br>\næ‰€ä»¥ï¼Œè¿™é‡Œçš„é‡ç‚¹å°±æ˜¯ï¼šå…ˆæŠŠå¤æ‚ä»£ç çš„ä¸»é€»è¾‘ææ¸…æ¥šï¼ŒçŸ¥é“æ¶‰åŠçš„æ¯ä¸ªæ–¹æ³•å®Œæˆäº†ä»€ä¹ˆäº‹ï¼Œå¿ƒé‡Œè¦å…ˆæ­å»ºä¸€ä¸ªç®€å•çš„æ¡†æ¶ï¼Œç­‰æœ‰äº†æ¡†æ¶ä¹‹åï¼Œæˆ‘ä»¬å†å»ç»™æ¡†æ¶å¡«å……ç»†èŠ‚ã€‚è¿™æ ·é€šè¿‡<strong>å…ˆæ•´ä½“åç»†èŠ‚</strong>çš„æ–¹å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¸å†ç•æƒ§ä»£ç ä¸­çš„å¤æ‚é€»è¾‘ã€‚</p><h2>å…ˆä¸»çº¿åæ”¯çº¿</h2><p>ä¸è¿‡ï¼Œåœ¨é˜…è¯»ä¸»çº¿ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è‚¯å®šè¿˜ä¼šé‡åˆ°å„ç§æ”¯çº¿é€»è¾‘ï¼Œæ¯”å¦‚æ•°æ®è¿‡æœŸã€æ›¿æ¢æ·˜æ±°ã€æŒä¹…åŒ–ã€ä¸»ä»å¤åˆ¶ç­‰ã€‚</p><p>å…¶å®ï¼Œåœ¨é˜…è¯»ä¸»çº¿é€»è¾‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸éœ€è¦å»é‡ç‚¹å…³æ³¨è¿™äº›æ”¯çº¿ï¼Œè€Œå½“æ•´ä¸ªä¸»çº¿é€»è¾‘æ¸…æ™°èµ·æ¥ä¹‹åï¼Œæˆ‘ä»¬å†å»è¯»è¿™äº›æ”¯çº¿æ¨¡å—ï¼Œå°±ä¼šå®¹æ˜“å¾ˆå¤šäº†ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»è¿™äº›æ”¯çº¿ä¸­ï¼Œé€‰å–ä¸‹ä¸€ä¸ªç›®æ ‡ï¼Œå¸¦ç€è¿™ä¸ªç›®æ ‡å»é˜…è¯»ï¼Œæ¯”å¦‚è¯´ï¼š</p><ul>\n<li>è¿‡æœŸç­–ç•¥æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿï¼ˆexpire.cã€lazyfree.cï¼‰</li>\n<li>æ·˜æ±°ç­–ç•¥æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿï¼ˆevict.cï¼‰</li>\n<li>æŒä¹…åŒ– RDBã€AOF æ˜¯æ€ä¹ˆåšçš„ï¼Ÿï¼ˆrdb.cã€aof.cï¼‰</li>\n<li>ä¸»ä»å¤åˆ¶æ˜¯æ€ä¹ˆåšçš„ï¼Ÿï¼ˆreplication.cï¼‰</li>\n<li>å“¨å…µå¦‚ä½•å®Œæˆæ•…éšœè‡ªåŠ¨åˆ‡æ¢ï¼Ÿï¼ˆsentinel.cï¼‰</li>\n<li>åˆ†ç‰‡é€»è¾‘å¦‚ä½•å®ç°ï¼Ÿï¼ˆcluster.cï¼‰</li>\n<li>â€¦.</li>\n</ul><p>æœ‰äº†æ–°çš„æ”¯çº¿ç›®æ ‡åï¼Œæˆ‘ä»¬ä¾æ—§å¯ä»¥é‡‡ç”¨å‰é¢æåˆ°çš„å…ˆæ•´ä½“åç»†èŠ‚çš„æ€è·¯é˜…è¯»ç›¸å…³æ¨¡å—ï¼Œè¿™æ ·ä¸‹æ¥ï¼Œæ•´ä¸ªé¡¹ç›®çš„æ¯ä¸ªæ¨¡å—ï¼Œå°±å¯ä»¥è¢«é€ä¸€å‡»ç ´äº†ã€‚</p><h2>æŸ¥æ¼è¡¥ç¼º</h2><p>æœ€åï¼Œæˆ‘ä»¬è¿˜éœ€è¦æŸ¥æ¼è¡¥ç¼ºã€‚</p><p>æŒ‰ç…§å‰é¢æåˆ°çš„æ–¹æ³•ï¼ŒåŸºæœ¬å°±å¯ä»¥æŠŠæ•´ä¸ªé¡¹ç›®çš„ä¸»è¦æ¨¡å—è¯»å¾—ä¸ƒä¸ƒå…«å…«äº†ï¼Œè¿™æ—¶æˆ‘ä»¬åŸºæœ¬å·²ç»å¯¹æ•´ä¸ªé¡¹ç›®æœ‰äº†æ•´ä½“çš„æŠŠæ§ã€‚</p><p>ä¸è¿‡ï¼Œå½“æˆ‘ä»¬åœ¨å·¥ä½œä¸­é‡åˆ°é—®é¢˜æ—¶ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šå‘ç°ï¼Œåœ¨å½“æ—¶è¯»ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰å¾ˆå¤šå¹¶ä¸åœ¨æ„çš„ç»†èŠ‚è¢«å¿½ç•¥äº†ã€‚æ‰€ä»¥è¿™æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥<strong>å†å¸¦ç€å…·ä½“é—®é¢˜å‡ºå‘ï¼Œèšç„¦è¿™ä¸ªé—®é¢˜ç›¸å…³çš„æ¨¡å—ï¼Œå†ä¸€æ¬¡å»è¯»æºç </strong>ã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¡«è¡¥å½“æ—¶é˜…è¯»æºç çš„ç©ºç™½åŒºã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå½“æˆ‘ä»¬åœ¨é˜…è¯»Stringåº•å±‚æ•°æ®ç»“æ„SDSï¼ˆç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼‰çš„å®ç°æ—¶ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°å½“ SDS éœ€è¦è¿½åŠ æ–°å†…å®¹æ—¶ä¼šè¿›è¡Œæ‰©å®¹ï¼Œè€Œæˆ‘ä»¬ä¹‹å‰é˜…è¯»è¿™éƒ¨åˆ†ä»£ç æ—¶ï¼Œ<strong>å¾ˆæœ‰å¯èƒ½åªæ˜¯äº†è§£åˆ°æœ‰è¿™æ ·çš„é€»è¾‘å­˜åœ¨ï¼Œä½†å¹¶æ²¡æœ‰åœ¨æ„æ‰©å®¹çš„ç›¸å…³ç»†èŠ‚ï¼ˆä¸€æ¬¡æ‰©å®¹å¤šå¤§ï¼‰</strong>ã€‚</p><p>æ‰€ä»¥ï¼Œå½“æˆ‘ä»¬åœ¨å·¥ä½œä¸­é‡åˆ°è¿™ä¸ªç»†èŠ‚é—®é¢˜åï¼Œå°±å¯ä»¥æŠŠç›®å…‰èšç„¦åœ¨ SDS çš„æ‰©å®¹é€»è¾‘ä¸Šï¼ˆsds.c çš„sdsMakeRoomForå‡½æ•°ï¼‰ï¼Œè€Œæ­¤æ—¶æˆ‘ä»¬ä¼šå‘ç°ï¼Œå½“éœ€è¦ç”³è¯·çš„æ–°å†…å­˜å°äº1MBæ—¶ï¼ŒRediså°±ä¼šç¿»å€ç”³è¯·å†…å­˜ï¼Œå¦åˆ™æŒ‰1MBç”³è¯·æ–°å†…å­˜ã€‚</p><p>é‡‡ç”¨è¿™ä¸ªæ–¹æ³•è¿›è¡ŒæŸ¥æ¼è¡¥ç¼ºï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹æ•´ä¸ªé¡¹ç›®äº†è§£å¾—æ›´æ·±å…¥ã€æ›´å…¨é¢ï¼ŒçœŸæ­£æŠŠé¡¹ç›®åƒé€ã€‚</p><h2>æ€»ç»“</h2><p>å¥½äº†ï¼Œä»¥ä¸Šå°±æ˜¯æˆ‘åœ¨é˜…è¯»Redisæºç æ—¶ï¼Œæ€»ç»“å‡ºæ¥çš„ç»éªŒä½“ä¼šï¼Œè¿™é‡Œæˆ‘ä¹ŸæŠŠè¿™ä¸ƒä¸ªæ­¥éª¤æ¢³ç†æ€»ç»“ä¸‹ã€‚</p><ol>\n<li><strong>æ‰¾åˆ°åœ°å›¾</strong>ï¼šæ‹¿åˆ°é¡¹ç›®ä»£ç åï¼Œæå‰æ¢³ç†æ•´ä¸ªé¡¹ç›®ç»“æ„ï¼ŒçŸ¥æ™“æ•´ä¸ªé¡¹ç›®çš„æ¨¡å—åˆ’åˆ†ï¼Œä»¥åŠå¯¹åº”çš„ä»£ç æ–‡ä»¶ã€‚</li>\n<li><strong>å‰ç½®çŸ¥è¯†å‡†å¤‡</strong>ï¼šæå‰æŒæ¡é¡¹ç›®ä¸­ç”¨åˆ°çš„å‰ç½®çŸ¥è¯†ï¼Œæ¯”å¦‚æ•°æ®ç»“æ„ã€æ“ä½œç³»ç»ŸåŸç†ã€ç½‘ç»œåè®®ã€ç½‘ç»œ IO æ¨¡å‹ã€ç¼–ç¨‹è¯­è¨€è¯­æ³•ç­‰ç­‰ã€‚</li>\n<li><strong>ä»åŸºç¡€æ¨¡å—å¼€å§‹è¯»</strong>ï¼šä»æœ€åº•å±‚çš„åŸºç¡€æ¨¡å—å¼€å§‹å…¥æ‰‹ï¼Œå…ˆæŒæ¡äº†è¿™äº›æ¨¡å—ï¼Œä¹‹ååŸºäºå®ƒä»¬æ„å»ºçš„æ¨¡å—è¯»èµ·æ¥ä¼šæ›´åŠ é«˜æ•ˆã€‚</li>\n<li><strong>æ‰¾åˆ°æ ¸å¿ƒä¸»çº¿</strong>ï¼šæ‰¾åˆ°æ•´ä¸ªé¡¹ç›®ä¸­æœ€æ ¸å¿ƒçš„ä¸»çº¿é€»è¾‘ï¼Œä»¥æ­¤ä¸ºç›®æ ‡ï¼Œäº†è§£å„æ¨¡å—ä¸ºäº†å®Œæˆè¿™ä¸ªåŠŸèƒ½ï¼Œæ˜¯å¦‚ä½•åä½œå’Œç»„ç»‡çš„ã€‚</li>\n<li><strong>å…ˆæ•´ä½“åç»†èŠ‚</strong>ï¼šå¯¹äºå¤æ‚å‡½æ•°ï¼Œä¸è¦ä¸Šæ¥å°±é™·å…¥ç»†èŠ‚ï¼Œå‰æœŸé˜…è¯»åªéœ€äº†è§£è¿™ä¸ªå‡½æ•°å¤§è‡´åšäº†ä»€ä¹ˆäº‹æƒ…ï¼Œå»ºç«‹æ¡†æ¶ï¼Œç­‰æ­å»ºèµ·æ¡†æ¶ä¹‹åï¼Œå†å»å¡«å……ç»†èŠ‚ã€‚</li>\n<li><strong>å…ˆä¸»çº¿åæ”¯çº¿</strong>ï¼šæ•´ä¸ªä¸»çº¿é€»è¾‘æ¸…æ™°ä¹‹åï¼Œå†å»å»¶ä¼¸é˜…è¯»æ”¯çº¿é€»è¾‘ï¼Œå› ä¸ºæ”¯çº¿é€»è¾‘è‚¯å®šæ˜¯æœåŠ¡ä¸»çº¿é€»è¾‘çš„ï¼Œè¯»å®Œä¸»çº¿åå†å»è¯»è¿™äº›æ”¯çº¿ï¼Œä¹Ÿä¼šå˜å¾—æ›´ç®€å•ã€‚</li>\n<li><strong>æŸ¥æ¼è¡¥ç¼º</strong>ï¼šåœ¨å·¥ä½œä¸­é‡åˆ°å…·ä½“é—®é¢˜ï¼Œå¸¦ç€è¿™äº›å®é™…çš„é—®é¢˜å‡ºå‘å†æ¬¡å»è¯»æºç ï¼Œè¿›è¡ŒæŸ¥æ¼è¡¥ç¼ºï¼Œå¡«è¡¥ä¹‹å‰è¯»æºç æ—¶æ²¡æœ‰æ³¨æ„åˆ°çš„åœ°æ–¹ã€‚</li>\n</ol><p>å½“ç„¶ï¼Œè¿™ä¸ªé˜…è¯»æºç çš„æ–¹æ³•ä¹Ÿå¹¶ä¸å±€é™äºRedisï¼Œå¦‚æœä½ åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¹Ÿæœ‰è¯»æºç çš„éœ€è¦ï¼Œå¸Œæœ›è¿™ä¸ªæ–¹æ³•èƒ½å¸®åŠ©ä½ æ›´å¥½åœ°åƒé€å®ƒã€‚</p><p>æœ€åï¼Œå¦‚æœä½ ä¹Ÿæœ‰è‡ªå·±çš„é˜…è¯»æºç çš„å®è·µç»éªŒå’Œæ–¹æ³•ï¼Œæ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«å‡ºæ¥ï¼Œæˆ‘ä»¬ä¸€èµ·äº¤æµï¼Œå…±åŒè¿›æ­¥ï¼</p>","comments":[{"had_liked":false,"id":312650,"user_name":"Kaito","can_delete":false,"product_type":"c1","uid":1020042,"ip_address":"","ucode":"79775FA35A95F2","user_header":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","comment_is_top":false,"comment_ctime":1631928041,"is_pvip":true,"discussion_count":5,"race_medal":0,"score":"109006110441","product_id":100084301,"comment_content":"å¾ˆè£å¹¸ï¼Œèƒ½åœ¨ç¬¬äºŒå­£ç»§ç»­ç»™å¤§å®¶å¸¦æ¥åŠ é¤æ–‡ç« ï¼Œåˆ†äº«æˆ‘å­¦ä¹ Redisçš„ç»éªŒã€‚<br><br>è¿™ç¯‡æ–‡ç« å’Œå¤§å®¶åˆ†äº«æˆ‘é˜…è¯»æºç çš„ç»éªŒå’Œå¿ƒå¾—ï¼Œå½“ç„¶ï¼Œæ–‡ç« é‡Œæåˆ°çš„æ–¹æ³•æ˜¯ã€Œé€šç”¨ã€çš„ï¼Œä¸ä»…é™äºè¯»Redisä»£ç ï¼Œè¯»ä»»ä½•é¡¹ç›®çš„æºç éƒ½å¯ä»¥æŒ‰è¿™ä¸ªæ€è·¯æ¥ï¼Œå¸Œæœ›æˆ‘çš„åˆ†äº«èƒ½å¤Ÿå¸®åŠ©åˆ°å¤§å®¶ï¼","like_count":26,"discussions":[{"author":{"id":2350230,"avatar":"https://static001.geekbang.org/account/avatar/00/23/dc/96/9501cd87.jpg","nickname":"æ— ç—•ä¹‹æ„","note":"","ucode":"8AF05C8C813352","race_medal":3,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550709,"discussion_content":"å‘å¤§ä½¬å­¦ä¹ ï¼Œä¹‹å‰å¯¹æºç ä»å“ªé‡Œå¼€å§‹çœ‹ä¸€ç­¹è«å±•ï¼Œç°åœ¨å¤§æ¦‚æœ‰äº†æ˜ç¡®çš„æ–¹å‘ï¼Œç…§ç€å¤§ä½¬çš„æ–¹å‘çœ‹èµ·æ¥ï¼Œå¸Œæœ›è‡ªå·±èƒ½åšæŒä¸‹å»ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644677572,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1657561,"avatar":"https://static001.geekbang.org/account/avatar/00/19/4a/d9/b8046b4b.jpg","nickname":"zhangm365","note":"","ucode":"60E7DEFB3F5840","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":401130,"discussion_content":"éå¸¸å¥½çš„åˆ†äº«ï¼Œæ„Ÿè°¢ï¼Œå‘å¤§ä½¬å­¦ä¹ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633572678,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2112229,"avatar":"https://static001.geekbang.org/account/avatar/00/20/3a/e5/1a1b08ad.jpg","nickname":"ä¹˜é£","note":"","ucode":"D25976CDD1D39B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":399976,"discussion_content":"è€å“¥ï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹redisä¸­å¦‚ä½•éƒ¨åˆ†è°ƒè¯•æ¨¡å—ï¼Œæ¯”å¦‚æˆ‘çœ‹åˆ°sdsé‡Œæœ‰ä¸ªmainæ˜¯å¯ä»¥å•ç‹¬ç¼–è¯‘è°ƒè¯•çš„ï¼Œä½†æ˜¯ziplistå¥½åƒå°±æ²¡æœ‰ï¼Œæˆ‘è¯•ç€è‡ªå·±å†™äº†ä¸ªmainï¼Œä½†æ˜¯ziplistå¼•ç”¨çš„å¥½åƒå¾ˆå¤šï¼Œæ²¡æ³•ç¼–è¯‘é€šè¿‡ï¼Œæœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥é’ˆå¯¹æ¯ä¸ªéƒ¨åˆ†è¿›è¡Œåˆ†åˆ«è°ƒè¯•ä¹ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633109003,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1133702,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4c/86/3be94807.jpg","nickname":"angelğŸ˜‡txyğŸ¤“","note":"","ucode":"C0AEE0D8BAF7ED","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394577,"discussion_content":"kaitoå¤§å“¥å¥½ï¼Œè·Ÿä½ ç€ä½ ä¸€èµ·å­¦redis","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631945055,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1020042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/8a/288f9f94.jpg","nickname":"Kaito","note":"","ucode":"79775FA35A95F2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1133702,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4c/86/3be94807.jpg","nickname":"angelğŸ˜‡txyğŸ¤“","note":"","ucode":"C0AEE0D8BAF7ED","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":394589,"discussion_content":"ä¸€èµ·åŠ æ²¹ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631950718,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":394577,"ip_address":""},"score":394589,"extra":""}]}]},{"had_liked":false,"id":312743,"user_name":"Bruis.","can_delete":false,"product_type":"c1","uid":2052855,"ip_address":"","ucode":"E0A663EFD217B5","user_header":"https://static001.geekbang.org/account/avatar/00/1f/52/f7/9b77fadb.jpg","comment_is_top":false,"comment_ctime":1631958821,"is_pvip":true,"discussion_count":2,"race_medal":0,"score":"10221893413","product_id":100084301,"comment_content":"Kaitoå¤§å“¥ï¼Œå¦‚ä½•å¯¹Redisæºç è¿›è¡Œç¼–è¯‘ï¼Œå¹¶èƒ½åœ¨å¼€å‘å·¥å…·ä¸Šè¿›è¡Œdebugè°ƒè¯•å‘¢ï¼Ÿå…‰çœ‹æºç ä¸debugè¿è¡Œæ„Ÿè§‰å¾ˆå¤šç»†èŠ‚æ˜¯æ²¡æ³•è¯»æ‡‚çš„å•Šã€‚","like_count":2,"discussions":[{"author":{"id":2675181,"avatar":"","nickname":"Geek_66617b","note":"","ucode":"D5B468568B8F39","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575782,"discussion_content":"ä½¿ç”¨CLionåœ¨Windowsä¸‹è°ƒè¯•Redisè¯¦ç»†æ•™ç¨‹\nhttps://www.maoyingdong.com/redis/debug_redis/","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655107051,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2112229,"avatar":"https://static001.geekbang.org/account/avatar/00/20/3a/e5/1a1b08ad.jpg","nickname":"ä¹˜é£","note":"","ucode":"D25976CDD1D39B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":400895,"discussion_content":"æˆ‘è¯´ä¸€ä¸‹æˆ‘çš„æ–¹æ³•ï¼Œæˆ‘æ˜¯ç”¨è™šæ‹Ÿæœºæ­å»ºäº†Ubuntuç³»ç»Ÿï¼Œä¸‹è½½äº†redis-5.0ï¼Œå°±å¯ä»¥åœ¨ubuntué‡Œç”¨vscodeè°ƒè¯•ï¼Œubuntuæ¯”è¾ƒæ–¹ä¾¿ï¼Œä¸€æ¬¡ç¼–è¯‘æˆåŠŸäº†ï¼Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633468761,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312626,"user_name":"Milittle","can_delete":false,"product_type":"c1","uid":1045455,"ip_address":"","ucode":"80E566639A8ABB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f3/cf/851dab01.jpg","comment_is_top":false,"comment_ctime":1631896114,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5926863410","product_id":100084301,"comment_content":"è¿™ä¸ªä¸“æ å¯ä»¥è¯´æ˜¯æœ‰ä¸¤ä¸ªè€å¸ˆã€‚","like_count":1},{"had_liked":false,"id":334024,"user_name":"æ— ç—•ä¹‹æ„","can_delete":false,"product_type":"c1","uid":2350230,"ip_address":"","ucode":"8AF05C8C813352","user_header":"https://static001.geekbang.org/account/avatar/00/23/dc/96/9501cd87.jpg","comment_is_top":false,"comment_ctime":1644677645,"is_pvip":true,"discussion_count":0,"race_medal":3,"score":"1644677645","product_id":100084301,"comment_content":"æ„Ÿè°¢å¤§ä½¬åˆ†äº«ï¼Œå†²å‘€ï¼Œæˆ‘è¦å­¦ä¹ ï¼ŒåŠ æ²¹ï¼ï¼ï¼","like_count":1},{"had_liked":false,"id":314248,"user_name":"Kang","can_delete":false,"product_type":"c1","uid":1237655,"ip_address":"","ucode":"088A8DA0A16BDE","user_header":"https://static001.geekbang.org/account/avatar/00/12/e2/97/dfadcc92.jpg","comment_is_top":false,"comment_ctime":1632913589,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632913589","product_id":100084301,"comment_content":"æ²¡æœ‰å¼€å‘ç»éªŒä¹Ÿå¯ä»¥è¿™æ ·çœ‹å—","like_count":0},{"had_liked":false,"id":312798,"user_name":"Ethan New","can_delete":false,"product_type":"c1","uid":2063962,"ip_address":"","ucode":"9CA2EF39E58030","user_header":"https://static001.geekbang.org/account/avatar/00/1f/7e/5a/da39f489.jpg","comment_is_top":false,"comment_ctime":1632025829,"is_pvip":true,"discussion_count":0,"race_medal":4,"score":"1632025829","product_id":100084301,"comment_content":"æ„Ÿè°¢Kaitoå¤§ä½¬çš„åˆ†äº«ï¼Œå‘å¤§ä½¬å­¦ä¹ ","like_count":0},{"had_liked":false,"id":312703,"user_name":"æ›¾è½¼éºŸ","can_delete":false,"product_type":"c1","uid":1451391,"ip_address":"","ucode":"D418371AC11270","user_header":"https://static001.geekbang.org/account/avatar/00/16/25/7f/473d5a77.jpg","comment_is_top":false,"comment_ctime":1631946726,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631946726","product_id":100084301,"comment_content":"æ„Ÿè°¢KaitoåŒå­¦çš„åˆ†äº«ï¼Œè¿™æ®µæ—¶é—´å—ç›Šè‰¯å¤š","like_count":0}]}