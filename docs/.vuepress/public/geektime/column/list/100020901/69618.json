{"id":69618,"title":"02 | 基础篇：到底应该怎么理解“平均负载”？","content":"<p>你好，我是倪朋飞。</p><p>每次发现系统变慢时，我们通常做的第一件事，就是执行top或者uptime命令，来了解系统的负载情况。比如像下面这样，我在命令行里输入了uptime命令，系统也随即给出了结果。</p><pre><code>$ uptime\n02:34:03 up 2 days, 20:14,  1 user,  load average: 0.63, 0.83, 0.88\n</code></pre><p>但我想问的是，你真的知道这里每列输出的含义吗？</p><p>我相信你对前面的几列比较熟悉，它们分别是当前时间、系统运行时间以及正在登录用户数。</p><pre><code>02:34:03              //当前时间\nup 2 days, 20:14      //系统运行时间\n1 user                //正在登录用户数\n</code></pre><p>而最后三个数字呢，依次则是过去1分钟、5分钟、15分钟的平均负载（Load Average）。</p><p><strong>平均负载</strong>？这个词对很多人来说，可能既熟悉又陌生，我们每天的工作中，也都会提到这个词，但你真正理解它背后的含义吗？如果你们团队来了一个实习生，他揪住你不放，你能给他讲清楚什么是平均负载吗？</p><p>其实，6年前，我就遇到过这样的一个场景。公司一个实习生一直追问我，什么是平均负载，我支支吾吾半天，最后也没能解释明白。明明总看到也总会用到，怎么就说不明白呢？后来我静下来想想，其实还是自己的功底不够。</p><p>于是，这几年，我遇到问题，特别是基础问题，都会多问自己几个“为什么”，以求能够彻底理解现象背后的本质原理，用起来更灵活，也更有底气。</p><p>今天，我就带你来学习下，如何观测和理解这个最常见、也是最重要的系统指标。</p><!-- [[[read_end]]] --><p>我猜一定有人会说，平均负载不就是单位时间内的 CPU 使用率吗？上面的0.63，就代表CPU使用率是63%。其实并不是这样，如果你方便的话，可以通过执行man uptime命令，来了解平均负载的详细解释。</p><p>简单来说，平均负载是指单位时间内，系统处于<strong>可运行状态</strong>和<strong>不可中断状态</strong>的平均进程数，也就是<strong>平均活跃进程数</strong>，它和CPU使用率并没有直接关系。这里我先解释下，可运行状态和不可中断状态这俩词儿。</p><p>所谓可运行状态的进程，是指正在使用CPU或者正在等待CPU的进程，也就是我们常用ps命令看到的，处于R状态（Running 或 Runnable）的进程。</p><p>不可中断状态的进程则是正处于内核态关键流程中的进程，并且这些流程是不可打断的，比如最常见的是等待硬件设备的I/O响应，也就是我们在ps命令中看到的D状态（Uninterruptible Sleep，也称为Disk Sleep）的进程。</p><p>比如，当一个进程向磁盘读写数据时，为了保证数据的一致性，在得到磁盘回复前，它是不能被其他进程或者中断打断的，这个时候的进程就处于不可中断状态。如果此时的进程被打断了，就容易出现磁盘数据与进程数据不一致的问题。</p><p>所以，<span class=\"orange\">不可中断状态实际上是系统对进程和硬件设备的一种保护机制</span>。</p><p>因此，你可以简单理解为，平均负载其实就是平均活跃进程数。平均活跃进程数，直观上的理解就是单位时间内的活跃进程数，但它实际上是活跃进程数的指数衰减平均值。这个“指数衰减平均”的详细含义你不用计较，这只是系统的一种更快速的计算方式，你把它直接当成活跃进程数的平均值也没问题。</p><p>既然平均的是活跃进程数，那么最理想的，就是每个CPU上都刚好运行着一个进程，这样每个CPU都得到了充分利用。比如当平均负载为2时，意味着什么呢？</p><ul>\n<li>\n<p>在只有2个CPU的系统上，意味着所有的CPU都刚好被完全占用。</p>\n</li>\n<li>\n<p>在4个CPU的系统上，意味着CPU有50%的空闲。</p>\n</li>\n<li>\n<p>而在只有1个CPU的系统中，则意味着有一半的进程竞争不到CPU。</p>\n</li>\n</ul><h2>平均负载为多少时合理</h2><p>讲完了什么是平均负载，现在我们再回到最开始的例子，不知道你能否判断出，在 uptime 命令的结果里，那三个时间段的平均负载数，多大的时候能说明系统负载高？或是多小的时候就能说明系统负载很低呢？</p><p>我们知道，平均负载最理想的情况是等于 CPU个数。所以在评判平均负载时，<strong>首先你要知道系统有几个 CPU</strong>，这可以通过 top 命令或者从文件 /proc/cpuinfo 中读取，比如：</p><pre><code># 关于grep和wc的用法请查询它们的手册或者网络搜索\n$ grep 'model name' /proc/cpuinfo | wc -l\n2\n</code></pre><p>有了CPU 个数，我们就可以判断出，当平均负载比 CPU 个数还大的时候，系统已经出现了过载。</p><p>不过，且慢，新的问题又来了。我们在例子中可以看到，平均负载有三个数值，到底该参考哪一个呢？</p><p>实际上，都要看。三个不同时间间隔的平均值，其实给我们提供了，分析<strong>系统负载趋势</strong>的数据来源，让我们能更全面、更立体地理解目前的负载状况。</p><p>打个比方，就像初秋时北京的天气，如果只看中午的温度，你可能以为还在7月份的大夏天呢。但如果你结合了早上、中午、晚上三个时间点的温度来看，基本就可以全方位了解这一天的天气情况了。</p><p>同样的，前面说到的CPU的三个负载时间段也是这个道理。</p><ul>\n<li>\n<p>如果1分钟、5分钟、15分钟的三个值基本相同，或者相差不大，那就说明系统负载很平稳。</p>\n</li>\n<li>\n<p>但如果1分钟的值远小于15 分钟的值，就说明系统最近1分钟的负载在减少，而过去15分钟内却有很大的负载。</p>\n</li>\n<li>\n<p>反过来，如果1分钟的值远大于 15 分钟的值，就说明最近1分钟的负载在增加，这种增加有可能只是临时性的，也有可能还会持续增加下去，所以就需要持续观察。一旦1分钟的平均负载接近或超过了CPU的个数，就意味着系统正在发生过载的问题，这时就得分析调查是哪里导致的问题，并要想办法优化了。</p>\n</li>\n</ul><p>这里我再举个例子，假设我们在一个单 CPU 系统上看到平均负载为 1.73，0.60，7.98，那么说明在过去 1 分钟内，系统有 73% 的超载，而在 15 分钟内，有 698% 的超载，从整体趋势来看，系统的负载在降低。</p><p>那么，在实际生产环境中，平均负载多高时，需要我们重点关注呢？</p><p>在我看来，<strong>当平均负载高于 CPU 数量70%的时候</strong>，你就应该分析排查负载高的问题了。一旦负载过高，就可能导致进程响应变慢，进而影响服务的正常功能。</p><p>但70%这个数字并不是绝对的，最推荐的方法，还是把系统的平均负载监控起来，然后根据更多的历史数据，判断负载的变化趋势。当发现负载有明显升高趋势时，比如说负载翻倍了，你再去做分析和调查。</p><h2>平均负载与CPU使用率</h2><p>现实工作中，我们经常容易把平均负载和 CPU 使用率混淆，所以在这里，我也做一个区分。</p><p>可能你会疑惑，既然平均负载代表的是活跃进程数，那平均负载高了，不就意味着 CPU 使用率高吗？</p><p>我们还是要回到平均负载的含义上来，平均负载是指单位时间内，处于可运行状态和不可中断状态的进程数。所以，它不仅包括了<strong>正在使用 CPU</strong> 的进程，还包括<strong>等待 CPU</strong> 和<strong>等待 I/O</strong> 的进程。</p><p>而 CPU 使用率，是单位时间内 CPU 繁忙情况的统计，跟平均负载并不一定完全对应。比如：</p><ul>\n<li>\n<p>CPU 密集型进程，使用大量 CPU 会导致平均负载升高，此时这两者是一致的；</p>\n</li>\n<li>\n<p>I/O 密集型进程，等待 I/O 也会导致平均负载升高，但 CPU 使用率不一定很高；</p>\n</li>\n<li>\n<p>大量等待 CPU 的进程调度也会导致平均负载升高，此时的CPU使用率也会比较高。</p>\n</li>\n</ul><h2>平均负载案例分析</h2><p>下面，我们以三个示例分别来看这三种情况，并用 iostat、mpstat、pidstat 等工具，找出平均负载升高的根源。</p><p>因为案例分析都是基于机器上的操作，所以不要只是听听、看看就够了，最好还是跟着我实际操作一下。</p><h3>你的准备</h3><p>下面的案例都是基于 Ubuntu 18.04，当然，同样适用于其他 Linux 系统。我使用的案例环境如下所示。</p><ul>\n<li>\n<p>机器配置：2 CPU，8GB 内存。</p>\n</li>\n<li>\n<p>预先安装 stress 和 sysstat 包，如 apt install stress sysstat。</p>\n</li>\n</ul><p>在这里，我先简单介绍一下 stress 和 sysstat。</p><p>stress 是一个 Linux 系统压力测试工具，这里我们用作异常进程模拟平均负载升高的场景。</p><p>而 sysstat 包含了常用的 Linux 性能工具，用来监控和分析系统的性能。我们的案例会用到这个包的两个命令 mpstat 和 pidstat。</p><ul>\n<li>\n<p>mpstat 是一个常用的多核 CPU 性能分析工具，用来实时查看每个 CPU 的性能指标，以及所有CPU的平均指标。</p>\n</li>\n<li>\n<p>pidstat 是一个常用的进程性能分析工具，用来实时查看进程的 CPU、内存、I/O 以及上下文切换等性能指标。</p>\n</li>\n</ul><p>此外，每个场景都需要你开三个终端，登录到同一台 Linux 机器中。</p><p>实验之前，你先做好上面的准备。如果包的安装有问题，可以先在Google一下自行解决，如果还是解决不了，再来留言区找我，这事儿应该不难。</p><p>另外要注意，下面的所有命令，我们都是默认以 root 用户运行。所以，如果你是用普通用户登陆的系统，一定要先运行 sudo su root 命令切换到 root 用户。</p><p>如果上面的要求都已经完成了，你可以先用 uptime 命令，看一下测试前的平均负载情况：</p><pre><code>$ uptime\n...,  load average: 0.11, 0.15, 0.09\n</code></pre><h3>场景一：CPU  密集型进程</h3><p>首先，我们在第一个终端运行  stress  命令，模拟一个  CPU  使用率 100% 的场景：</p><pre><code>$ stress --cpu 1 --timeout 600\n</code></pre><p>接着，在第二个终端运行uptime查看平均负载的变化情况：</p><pre><code># -d 参数表示高亮显示变化的区域\n$ watch -d uptime\n...,  load average: 1.00, 0.75, 0.39\n</code></pre><p>最后，在第三个终端运行mpstat查看  CPU  使用率的变化情况：</p><pre><code># -P ALL 表示监控所有CPU，后面数字5表示间隔5秒后输出一组数据\n$ mpstat -P ALL 5\nLinux 4.15.0 (ubuntu) 09/22/18 _x86_64_ (2 CPU)\n13:30:06     CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle\n13:30:11     all   50.05    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00   49.95\n13:30:11       0    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00\n13:30:11       1  100.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00\n</code></pre><p>从终端二中可以看到，1 分钟的平均负载会慢慢增加到 1.00，而从终端三中还可以看到，正好有一个 CPU 的使用率为 100%，但它的 iowait 只有 0。这说明，平均负载的升高正是由于 CPU 使用率为 100% 。</p><p>那么，到底是哪个进程导致了 CPU 使用率为 100% 呢？你可以使用 pidstat 来查询：</p><pre><code># 间隔5秒后输出一组数据\n$ pidstat -u 5 1\n13:37:07      UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command\n13:37:12        0      2962  100.00    0.00    0.00    0.00  100.00     1  stress\n</code></pre><p>从这里可以明显看到，stress进程的CPU使用率为100%。</p><h3>场景二：I/O  密集型进程</h3><p>首先还是运行  stress  命令，但这次模拟  I/O  压力，即不停地执行  sync：</p><pre><code>$ stress -i 1 --timeout 600\n</code></pre><p>还是在第二个终端运行uptime查看平均负载的变化情况：</p><pre><code>$ watch -d uptime\n...,  load average: 1.06, 0.58, 0.37\n</code></pre><p>然后，第三个终端运行mpstat查看  CPU  使用率的变化情况：</p><pre><code># 显示所有CPU的指标，并在间隔5秒输出一组数据\n$ mpstat -P ALL 5 1\nLinux 4.15.0 (ubuntu)     09/22/18     _x86_64_    (2 CPU)\n13:41:28     CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle\n13:41:33     all    0.21    0.00   12.07   32.67    0.00    0.21    0.00    0.00    0.00   54.84\n13:41:33       0    0.43    0.00   23.87   67.53    0.00    0.43    0.00    0.00    0.00    7.74\n13:41:33       1    0.00    0.00    0.81    0.20    0.00    0.00    0.00    0.00    0.00   98.99\n</code></pre><p>从这里可以看到，1 分钟的平均负载会慢慢增加到 1.06，其中一个 CPU 的系统CPU使用率升高到了 23.87，而 iowait 高达 67.53%。这说明，平均负载的升高是由于 iowait 的升高。</p><p>那么到底是哪个进程，导致 iowait 这么高呢？我们还是用 pidstat 来查询：</p><pre><code># 间隔5秒后输出一组数据，-u表示CPU指标\n$ pidstat -u 5 1\nLinux 4.15.0 (ubuntu)     09/22/18     _x86_64_    (2 CPU)\n13:42:08      UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command\n13:42:13        0       104    0.00    3.39    0.00    0.00    3.39     1  kworker/1:1H\n13:42:13        0       109    0.00    0.40    0.00    0.00    0.40     0  kworker/0:1H\n13:42:13        0      2997    2.00   35.53    0.00    3.99   37.52     1  stress\n13:42:13        0      3057    0.00    0.40    0.00    0.00    0.40     0  pidstat\n</code></pre><p>可以发现，还是  stress  进程导致的。</p><h3>场景三：大量进程的场景</h3><p>当系统中运行进程超出 CPU 运行能力时，就会出现等待 CPU 的进程。</p><p>比如，我们还是使用 stress，但这次模拟的是 8 个进程：</p><pre><code>$ stress -c 8 --timeout 600\n</code></pre><p>由于系统只有 2 个CPU，明显比 8 个进程要少得多，因而，系统的 CPU 处于严重过载状态，平均负载高达7.97：</p><pre><code>$ uptime\n...,  load average: 7.97, 5.93, 3.02\n</code></pre><p>接着再运行pidstat来看一下进程的情况：</p><pre><code># 间隔5秒后输出一组数据\n$ pidstat -u 5 1\n14:23:25      UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command\n14:23:30        0      3190   25.00    0.00    0.00   74.80   25.00     0  stress\n14:23:30        0      3191   25.00    0.00    0.00   75.20   25.00     0  stress\n14:23:30        0      3192   25.00    0.00    0.00   74.80   25.00     1  stress\n14:23:30        0      3193   25.00    0.00    0.00   75.00   25.00     1  stress\n14:23:30        0      3194   24.80    0.00    0.00   74.60   24.80     0  stress\n14:23:30        0      3195   24.80    0.00    0.00   75.00   24.80     0  stress\n14:23:30        0      3196   24.80    0.00    0.00   74.60   24.80     1  stress\n14:23:30        0      3197   24.80    0.00    0.00   74.80   24.80     1  stress\n14:23:30        0      3200    0.00    0.20    0.00    0.20    0.20     0  pidstat\n</code></pre><p>可以看出，8 个进程在争抢 2 个 CPU，每个进程等待 CPU 的时间（也就是代码块中的 %wait 列）高达 75%。这些超出 CPU 计算能力的进程，最终导致 CPU 过载。</p><h2>小结</h2><p>分析完这三个案例，我再来归纳一下<span class=\"orange\">平均负载的理解</span>。</p><p>平均负载提供了一个快速查看系统整体性能的手段，反映了整体的负载情况。但只看平均负载本身，我们并不能直接发现，到底是哪里出现了瓶颈。所以，在理解平均负载时，也要注意：</p><ul>\n<li>\n<p>平均负载高有可能是 CPU 密集型进程导致的；</p>\n</li>\n<li>\n<p>平均负载高并不一定代表 CPU 使用率高，还有可能是 I/O 更繁忙了；</p>\n</li>\n<li>\n<p>当发现负载高的时候，你可以使用 mpstat、pidstat 等工具，辅助分析负载的来源。</p>\n</li>\n</ul><h2>思考</h2><p>最后，我想邀请你一起来聊聊你所理解的平均负载，当你发现平均负载升高后，又是怎么分析排查的呢？你可以结合我前面的讲解，来总结自己的思考。欢迎在留言区和我讨论。</p><p><a href=\"time://mall?url=https%3A%2F%2Fj.youzan.com%2F7_vgDi\"><img src=\"https://static001.geekbang.org/resource/image/00/f2/00f868b7654dcb50ae2c91fd7688d2f2.jpg?wh=1242*526\" alt=\"unpreview\"></a><br>\n限量发售中，仅限<span class=\"orange\">5000份</span>，3大体系，22个模块，定位工作中80%的高频问题。</p>","neighbors":{"left":{"article_title":"01 | 如何学习Linux性能优化？","id":69346},"right":{"article_title":"03 | 基础篇：经常说的 CPU 上下文切换是什么意思？（上）","id":69859}},"comments":[{"had_liked":false,"id":42972,"user_name":"倪朋飞","can_delete":false,"product_type":"c1","uid":1001282,"ip_address":"","ucode":"F0FAC195CDE7AC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","comment_is_top":true,"comment_ctime":1543121416,"is_pvip":false,"discussion_count":24,"race_medal":0,"score":"9.2233736704854999e+18","product_id":100020901,"comment_content":"没想到大家的热情这么高，太激动了。统一回复一下案例中的几个问题：<br><br>1. iowait无法升高的问题，是因为案例中stress使用的是 sync() 系统调用，它的作用是刷新缓冲区内存到磁盘中。对于新安装的虚拟机，缓冲区可能比较小，无法产生大的IO压力，这样大部分就都是系统调用的消耗了。所以，你会看到只有系统CPU使用率升高。解决方法是使用stress的下一代stress-ng，它支持更丰富的选项，比如 stress-ng -i 1 --hdd 1 --timeout 600（--hdd表示读写临时文件）。<br>2. pidstat输出中没有%wait的问题，是因为CentOS默认的sysstat稍微有点老，源码或者RPM升级到11.5.5版本以后就可以看到了。而Ubuntu的包一般都比较新，没有这个问题。<br>3. mpstat无法观测的问题，案例中是等待5秒后输出1次结果就停止了，更好的做法是持续监控一段时间，比如持续观测20次：mpstat -P ALL 5 20。","like_count":380,"discussions":[{"author":{"id":1002363,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLcXVzWibjKHicjFcriajnkJsxd5mJic0SSYEcf3nZVq8OpFfic8avPIzRtDsOV1sNa6SmpwmX26caOqbg/132","nickname":"Leilei","note":"","ucode":"A3280043C802BC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375488,"discussion_content":"stress -i 1 --hdd 1 --timeout 600 可以实现IO负载的效果\n","likes_number":10,"is_delete":false,"is_hidden":false,"ctime":1621686084,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2367247,"avatar":"https://static001.geekbang.org/account/avatar/00/24/1f/0f/4fe3788e.jpg","nickname":"玖月","note":"","ucode":"427737A95CAE0C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337504,"discussion_content":"上车晚了哈，最近才关注到极客时间，看到朋飞老师这个课程实战太棒！对于极客这种图文音频模式授课，非常支持！朋飞老师，我用 ubuntu 16.04 做了实验，发现 pidstat 输出中也是没有 %wait。","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1608953084,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1314902,"avatar":"https://static001.geekbang.org/account/avatar/00/14/10/56/c6487f8e.jpg","nickname":"Rachel","note":"","ucode":"826A0DC0794765","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2367247,"avatar":"https://static001.geekbang.org/account/avatar/00/24/1f/0f/4fe3788e.jpg","nickname":"玖月","note":"","ucode":"427737A95CAE0C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362629,"discussion_content":"我的也是","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616994504,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":337504,"ip_address":""},"score":362629,"extra":""},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2367247,"avatar":"https://static001.geekbang.org/account/avatar/00/24/1f/0f/4fe3788e.jpg","nickname":"玖月","note":"","ucode":"427737A95CAE0C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590775,"discussion_content":"stress-ng -i\nstart N workers continuously calling sync(2) to commit buffer cache to disk.  This can be used in conjunction with the --hdd options.\n\nstress-ng -d\nstart N workers continually writing, reading and removing temporary files. The default mode is to stress test sequential writes and reads.  With the  --aggressive  option  enabled\n              without any --hdd-opts options the hdd stressor will work through all the --hdd-opt options one by one to cover a range of I/O options","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666075724,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":337504,"ip_address":"浙江"},"score":590775,"extra":""}]},{"author":{"id":1063740,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoH9Mlw0kLK0p39vhQpdvkbQP5TX96DB9HMJ1POaTVDpMZg4rjlO3WCAqiaWWMc77ffS3vTo8qWdXA/132","nickname":"xdargs","note":"","ucode":"EB8326D3A72DE5","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":59955,"discussion_content":"虚拟机里面stress-ng好像加-d进行写才压力比较大，只是-i进行sync操作，mpstat的iowait也还是没有什么压力(0)，stress和stress-ng -d 1时io比较有压力","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1574695500,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1204166,"avatar":"https://static001.geekbang.org/account/avatar/00/12/5f/c6/07cb8831.jpg","nickname":"Increase","note":"","ucode":"058AF4C7BCAAA5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582410,"discussion_content":"无法领取资料，能否让客户联系我一下，我添加了微信没人验证也没人联系我。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659425870,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1047423,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/fb/7f/746a6f5e.jpg","nickname":"Q","note":"","ucode":"785546C617D3DF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534228,"discussion_content":"&#34;缓冲区小&#34; -- 是指缓冲区内容少吗？没有什么东西刷新到磁盘？ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638147385,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1394115,"avatar":"https://static001.geekbang.org/account/avatar/00/15/45/c3/051ffe83.jpg","nickname":"rubys_","note":"","ucode":"931AD02864126A","race_medal":5,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413258,"discussion_content":"评论可以划线笔记就好了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636425226,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1100272,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c9/f0/a35f60a5.jpg","nickname":"Lynn","note":"","ucode":"83A0CF04C7049C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391206,"discussion_content":"老师又群吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630331761,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1253529,"avatar":"https://static001.geekbang.org/account/avatar/00/13/20/99/8c158560.jpg","nickname":"cxh","note":"","ucode":"912FBA0412E75A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376299,"discussion_content":"老师，D进程，不打断指的是不让出cpu吗？如果是的话，和自愿切换上下文又是什么关系，求老师解答，谢谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622074412,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2178501,"avatar":"https://static001.geekbang.org/account/avatar/00/21/3d/c5/f43fa619.jpg","nickname":"🍀柠檬鱼也是鱼","note":"","ucode":"DCF033636465F3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1253529,"avatar":"https://static001.geekbang.org/account/avatar/00/13/20/99/8c158560.jpg","nickname":"cxh","note":"","ucode":"912FBA0412E75A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533968,"discussion_content":"io会让出cpu~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638031851,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":376299,"ip_address":""},"score":533968,"extra":""}]},{"author":{"id":2559543,"avatar":"","nickname":"清水","note":"","ucode":"D25F83AA62FD70","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366276,"discussion_content":"哎呀呀，之前没有看评论，用了升级版本终于可以操作了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618019905,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1314902,"avatar":"https://static001.geekbang.org/account/avatar/00/14/10/56/c6487f8e.jpg","nickname":"Rachel","note":"","ucode":"826A0DC0794765","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362628,"discussion_content":"老师，我的是ubutun16，但是pidstat还是没有处处iowait这个指标","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616994469,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":4,"child_discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":1314902,"avatar":"https://static001.geekbang.org/account/avatar/00/14/10/56/c6487f8e.jpg","nickname":"Rachel","note":"","ucode":"826A0DC0794765","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362799,"discussion_content":"试试下载新的deb包或者源码安装新版本sysstat？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617028829,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":362628,"ip_address":""},"score":362799,"extra":""},{"author":{"id":1314902,"avatar":"https://static001.geekbang.org/account/avatar/00/14/10/56/c6487f8e.jpg","nickname":"Rachel","note":"","ucode":"826A0DC0794765","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":362888,"discussion_content":"sysstat已经是最新的了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617067158,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":362799,"ip_address":""},"score":362888,"extra":""},{"author":{"id":2559543,"avatar":"","nickname":"清水","note":"","ucode":"D25F83AA62FD70","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1314902,"avatar":"https://static001.geekbang.org/account/avatar/00/14/10/56/c6487f8e.jpg","nickname":"Rachel","note":"","ucode":"826A0DC0794765","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366301,"discussion_content":"你后面解决了吗？我更新到最新也还是没有","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618022796,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":362888,"ip_address":""},"score":366301,"extra":""}]},{"author":{"id":2138347,"avatar":"https://static001.geekbang.org/account/avatar/00/20/a0/eb/0b449b76.jpg","nickname":"学习","note":"","ucode":"147EF71CC708C3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":300536,"discussion_content":" stress-ng  -d 1 -i 1 --timeout 600   在新机中压测  使用 mpstat -P ALL 5 1  就能考到io的压力了\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598161256,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1805809,"avatar":"","nickname":"ccz 开发(谢不邀)","note":"","ucode":"B8803B050AAC68","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":132310,"discussion_content":"使用编译的方式在centos7上安装了sysstat，可以看到有%wait这一项，但是用8个线程（200线程都试过）压的时候，%wait这一项始终为0.00。然后用宿主机的ubuntu来压，%wait就有值","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578897118,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1802975,"avatar":"","nickname":"Geek_08f8b6","note":"","ucode":"A31CAF8B3EABD5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":124812,"discussion_content":"我用的实体机也没压出来iowait高，怎么知道我的缓冲区的大小呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578451659,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1802975,"avatar":"","nickname":"Geek_08f8b6","note":"","ucode":"A31CAF8B3EABD5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590777,"discussion_content":"vmstat -wt 不就看buff和cache的大小了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666075869,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":124812,"ip_address":"浙江"},"score":590777,"extra":""}]},{"author":{"id":1356083,"avatar":"https://static001.geekbang.org/account/avatar/00/14/b1/33/8993eae0.jpg","nickname":"黄展志","note":"","ucode":"EBA342CD89072D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":37618,"discussion_content":"很好，很强大，学习了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571647322,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1609350,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/2rRMjRdMelicUoU5yXibENlYapdvPUCibOk8bGicyFoIW7IMxMqhicgelVphEmWFpMucVXjQjv5pdu6RgDkNiav0qUcw/132","nickname":"holly","note":"","ucode":"9D57569ED81CBA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":22917,"discussion_content":"太强了，精准定位问题，我的就是新装的虚拟机，模拟I/O密集型时iowait都是0。我正要提这个问题，留言都写好了，因为两个终端都在登录，被提示，再进入就看到这个","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569727588,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1013424,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","nickname":"不了峰","note":"","ucode":"E23B96D6A3D4EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7617,"discussion_content":"太强了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567587490,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42556,"user_name":"longhaiqwe","can_delete":false,"product_type":"c1","uid":1061318,"ip_address":"","ucode":"A5AEE950A7AF35","user_header":"https://static001.geekbang.org/account/avatar/00/10/31/c6/27225119.jpg","comment_is_top":true,"comment_ctime":1542969376,"is_pvip":false,"replies":[{"id":"15202","content":"👍 源码或者RPM升级都可以","user_name":"作者回复","comment_id":42556,"uid":"1001282","ip_address":"","utype":1,"ctime":1542976893,"user_name_real":"倪朋飞"}],"discussion_count":3,"race_medal":0,"score":"9.2233721200020992e+18","product_id":100020901,"comment_content":" 倪老师提到的软件，最好都用源码安装吧，版本比较新，尤其是centos的同学们。","like_count":19,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430127,"discussion_content":"👍 源码或者RPM升级都可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542976893,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1916685,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/3f/0d/1e8dbb2c.jpg","nickname":"怀揣梦想的学渣","note":"","ucode":"2349B9F4F6FDE3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":209725,"discussion_content":"stress工具没法在centos8通过dnf直接安装。安装epel也不行。但我找到了安装stress-ng到centos8的办法（https://snapcraft.io/install/stress-ng/centos）。希望对其他同学有帮助。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584667609,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2058432,"avatar":"","nickname":"Geek_225d9a","note":"","ucode":"40092008DFBF2D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291357,"discussion_content":"android系统的手机可以安装这些软件么","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594790663,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42369,"user_name":"南北少卿","can_delete":false,"product_type":"c1","uid":1018958,"ip_address":"","ucode":"DFCC59F2BBD8CE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8c/4e/b81969fa.jpg","comment_is_top":true,"comment_ctime":1542943541,"is_pvip":false,"replies":[{"id":"15149","content":"版本的问题，centos自带的sysstat版本稍微老一点，11.5.5之后才增加的这个选项","user_name":"作者回复","comment_id":42369,"uid":"1001282","ip_address":"","utype":1,"ctime":1542949335,"user_name_real":"倪朋飞"}],"discussion_count":4,"race_medal":0,"score":"9.2233721114121994e+18","product_id":100020901,"comment_content":"老师,在跟着操作场景三的时候,使用命令pidstat -u 5 1,并没有出%wait的值,我用的是阿里云centos(CentOS Linux release 7.5.1804 (Core) <br>),Linux 3.10.0-693.2.2.el7.x86_64 (izbp13056tlb7huifh6gm3z) \t11&#47;23&#47;2018 \t_x86_64_\t(1 CPU)<br>Average:      UID       PID    %usr %system  %guest    %CPU   CPU  Command<br>Average:        0       252     0.00    2.02          0.00    2.02     -  kworker&#47;0:1H<br>Average:        0       257     0.00    0.20          0.00    0.20     -  jbd2&#47;vda1-8<br>Average:        0      1079    0.20    0.00          0.00    0.20     -  AliYunDun<br>Average:        0     20256    0.20    0.00         0.00    0.20     -  java<br>Average:        0     24482    0.00    0.61         0.00    0.61     -  kworker&#47;u2:1<br>Average:        0     31305    0.20   60.00        0.00   60.20    -  stress<br>Average:        0     31306    0.20    0.00    0.00    0.20     -  watch<br>","like_count":17,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430068,"discussion_content":"版本的问题，centos自带的sysstat版本稍微老一点，11.5.5之后才增加的这个选项","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542949335,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1160082,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b3/92/6a20da3f.jpg","nickname":"OneDy","note":"","ucode":"BF0705E486994F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336652,"discussion_content":"安装了sysstat12.5.3发现也不显示这个字段，不知道是不是移除了。看到https://github.com/sysstat/sysstat/blob/master/CHANGES 的确是11.5.5之后添加了%wait。\n2017/02/27: Version 11.5.5 - Sebastien Godard (sysstat <at> orange.fr)\n\t* SVG: Allow multiple charts on a row (new option added: &#34;packed&#34;).\n\t* SVG: Add new option: &#34;height=...&#34;\n\t* SVG: Properly terminate SVG file when no data have been found\n\t  [11.4.4].\n\t* SVG: Don&#39;t extend X axis beyond time end [11.4.4].\n\t* Add new %wait field to pidstat CPU utilization.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608645208,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1202482,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/ydFhHonicUQibGlAfsAYBibNOfSxpCG5cJNp9oRibTJm3TrxM7Hj4WPPCRE3vluZJb0TGQqpKCaBWLdmra5Su1KF5Q/132","nickname":"yudidi","note":"","ucode":"70283DE39D86F5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1160082,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b3/92/6a20da3f.jpg","nickname":"OneDy","note":"","ucode":"BF0705E486994F","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":338708,"discussion_content":"通过man看%wait指的是cpu相关的，并不是IO","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609343013,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":336652,"ip_address":""},"score":338708,"extra":""},{"author":{"id":1202482,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/ydFhHonicUQibGlAfsAYBibNOfSxpCG5cJNp9oRibTJm3TrxM7Hj4WPPCRE3vluZJb0TGQqpKCaBWLdmra5Su1KF5Q/132","nickname":"yudidi","note":"","ucode":"70283DE39D86F5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1160082,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b3/92/6a20da3f.jpg","nickname":"OneDy","note":"","ucode":"BF0705E486994F","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":338714,"discussion_content":"你可以用man细看下，-u 指cpu, -d 指io -w指上下文切换，这个工具是对的哈，我们用错了而已。","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1609343357,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":336652,"ip_address":""},"score":338714,"extra":""}]}]},{"had_liked":false,"id":46329,"user_name":"dancer","can_delete":false,"product_type":"c1","uid":1019036,"ip_address":"","ucode":"B8D5641A3AC490","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8c/9c/d48473ab.jpg","comment_is_top":false,"comment_ctime":1543901565,"is_pvip":false,"discussion_count":9,"race_medal":0,"score":"1354458599805","product_id":100020901,"comment_content":"学习笔记：<br>一、什么是平均负载<br>正确定义：单位时间内，系统中处于可运行状态和不可中断状态的平均进程数。<br>错误定义：单位时间内的cpu使用率。<br>可运行状态的进程：正在使用cpu或者正在等待cpu的进程，即ps aux命令下STAT处于R状态的进程<br>不可中断状态的进程：处于内核态关键流程中的进程，且不可被打断，如等待硬件设备IO响应，ps命令D状态的进程<br>理想状态：每个cpu上都有一个活跃进程，即平均负载数等于cpu数<br>过载经验值：平均负载高于cpu数量70%的时候<br><br>二、相关命令<br>cpu核数: lscpu、 grep &#39;model name&#39; &#47;proc&#47;cpuinfo | wc -l<br>显示平均负载：uptime、top，显示的顺序是最近1分钟、5分钟、15分钟，从此可以看出平均负载的趋势<br>watch -d uptime: -d会高亮显示变化的区域<br>strees: 压测命令，--cpu cpu压测选项，-i io压测选项，-c 进程数压测选项，--timeout 执行时间<br>mpstat: 多核cpu性能分析工具，-P ALL监视所有cpu<br>pidstat:  进程性能分析工具，-u 显示cpu利用率<br><br>三、平均负载与cpu使用率的区别<br>CPU使用率：单位时间内cpu繁忙情况的统计<br>情况1：CPU密集型进程，CPU使用率和平均负载基本一致<br>情况2：IO密集型进程，平均负载升高，CPU使用率不一定升高<br>情况3：大量等待CPU的进程调度，平均负载升高，CPU使用率也升高<br><br>四、平均负载过高时，如何调优<br>工具：stress、sysstat，yum即可安装<br>1. CPU密集型进程case：<br>mpstat -P ALL 5: -P ALL表示监控所有CPU，5表示每5秒刷新一次数据，观察是否有某个cpu的%usr会很高，但iowait应很低<br>pidstat -u 5 1：每5秒输出一组数据，观察哪个进程%cpu很高，但是%wait很低，极有可能就是这个进程导致cpu飚高<br>2. IO密集型进程case：<br>mpstat -P ALL 5: 观察是否有某个cpu的%iowait很高，同时%usr也较高<br>pidstat -u 5 1：观察哪个进程%wait较高，同时%CPU也较高<br>3. 大量进程case：<br>pidstat -u 5 1：观察那些%wait较高的进程是否有很多","like_count":315,"discussions":[{"author":{"id":1009464,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/38/3f617799.jpg","nickname":"张家聚","note":"","ucode":"5EC64E717CA570","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2058,"discussion_content":"课代表你好","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1563233845,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1441408,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ1uAplGtIQUOEdsnJpX27CCMaFr1KlfnDibNdnXnZdcFTYbgCsN7Ds8QxLCxJR0o3SMv02KRDyCcg/132","nickname":"王建国","note":"","ucode":"729F74BA069FBC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559092,"discussion_content":"平均负载高于cpu数量70%。这个怎么算呢？（loadavg%100 - cup数）&gt;= 70 ，这样计算吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648607253,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1198048,"avatar":"https://static001.geekbang.org/account/avatar/00/12/47/e0/1ff26e99.jpg","nickname":"gecko","note":"","ucode":"2B7122536F1A0E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532536,"discussion_content":"请教您\n2. IO密集型进程case：\npidstat -u 5 1：观察哪个进程%wait较高，同时%CPU也较高\n这里的 %wait 代表啥意思呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637638070,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1618633,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/c9/b414a77c.jpg","nickname":"HelloTalk","note":"","ucode":"F898E6A7C61D39","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337311,"discussion_content":"stress -c --cpu 是一个意思吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608868642,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1622887,"avatar":"https://static001.geekbang.org/account/avatar/00/18/c3/67/568181d7.jpg","nickname":"Jerry","note":"","ucode":"F8C5EED655B8D6","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311400,"discussion_content":"优秀！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602327171,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1497985,"avatar":"https://static001.geekbang.org/account/avatar/00/16/db/81/e45ac985.jpg","nickname":"EDi","note":"","ucode":"3F6E18239EB287","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":286955,"discussion_content":"我竟无言以表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593332503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1500262,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK0K9AM6xxDzVV6pF66jyus5NuuxZzT9icad8AQDMKibwUOy3UnoZIZdyKIKd9sA06rgFnIWwiakSeOQ/132","nickname":"斑马Z","note":"","ucode":"ABB55B4652452F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":212060,"discussion_content":"这就是专业","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584929714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1197179,"avatar":"https://static001.geekbang.org/account/avatar/00/12/44/7b/3d5175a6.jpg","nickname":"晓晨","note":"","ucode":"8651F6A162C74B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3660,"discussion_content":"观察iowait 应该用 iostat吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564668355,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1802975,"avatar":"","nickname":"Geek_08f8b6","note":"","ucode":"A31CAF8B3EABD5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1197179,"avatar":"https://static001.geekbang.org/account/avatar/00/12/44/7b/3d5175a6.jpg","nickname":"晓晨","note":"","ucode":"8651F6A162C74B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":124836,"discussion_content":"iostat只能看到平均的，看不到哪个进程的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578453036,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":3660,"ip_address":""},"score":124836,"extra":""}]}]},{"had_liked":false,"id":42279,"user_name":"冯宇","can_delete":false,"product_type":"c1","uid":1248481,"ip_address":"","ucode":"894A0951E776D7","user_header":"https://static001.geekbang.org/account/avatar/00/13/0c/e1/e54540b9.jpg","comment_is_top":false,"comment_ctime":1542936973,"is_pvip":false,"replies":[{"id":"15236","content":"👍这几个工具也很好用","user_name":"作者回复","comment_id":42279,"uid":"1001282","ip_address":"","utype":1,"ctime":1542981225,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"800406854029","product_id":100020901,"comment_content":"我一直用htop看负载，因为它更直接（在F2配置中勾选所有开关项，打开颜色区分功能），不同的负载会用不同的颜色标识。比如cpu密集型的应用，它的负载颜色是绿色偏高，iowait的操作，它的负载颜色是红色偏高等等，根据这些指标再用htop的sort就很容易定位到有问题的进程。还有个更好用的atop命令，好像是基于sar的统计生成的报告，直接就把有问题的进程标红了，更直观","like_count":186,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430035,"discussion_content":"👍这几个工具也很好用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542981225,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43232,"user_name":"双","can_delete":false,"product_type":"c1","uid":1031605,"ip_address":"","ucode":"D0AC0A69A611C8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bd/b5/b8dfa30a.jpg","comment_is_top":false,"comment_ctime":1543198019,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"581363782979","product_id":100020901,"comment_content":"还是建议用top和ps或者lsof来分析，因为一般线上的机器不会额外安装这之外的工具，而且很多公司用堡垒机登录上去之后其他的基本上都用不了，用其自带的最保险","like_count":135,"discussions":[{"author":{"id":1627308,"avatar":"https://static001.geekbang.org/account/avatar/00/18/d4/ac/517b0482.jpg","nickname":"若有所思","note":"","ucode":"F1FC9C1282635C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318095,"discussion_content":"mpstat,pidstat,iostat 都是系统自带的，没有使用额外工具","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1603638225,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1367499,"avatar":"https://static001.geekbang.org/account/avatar/00/14/dd/cb/23b114a7.jpg","nickname":"xiao皮孩。。","note":"","ucode":"27AE899819D10F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4921,"discussion_content":"说出了我的心声","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1565832963,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1622991,"avatar":"https://static001.geekbang.org/account/avatar/00/18/c3/cf/4e8ac944.jpg","nickname":"陈年玖","note":"","ucode":"89753FD1566575","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4616,"discussion_content":"这三个命令也确实很强大   基本是能看出端倪的  但是还是要  查看下  系统各日志看有木有其他的问题  才是比较好的吧  虽然会久一点 ","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1565598860,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1298046,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKZicicibGibtR5zAia782Ajc5I5BN3F3tjAdlibATIknHv67gbxeH21N7B6vbgwLjYb1miaLKhqicptB5ibYw/132","nickname":"阿飞","note":"","ucode":"F8B1FC8521264D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":269962,"discussion_content":"只要搞清楚了pidstat数据的来源，也可以写shell脚本处理，但是只要系统不是很老，基本都支持","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1589968691,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590778,"discussion_content":"大哥们呀除了iotop其他工具都是自带的，性能定位工具大概有40种很多工具都是自带的只是版本没有那么新","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666076008,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42217,"user_name":"slam","can_delete":false,"product_type":"c1","uid":1064967,"ip_address":"","ucode":"0C5C3456F77051","user_header":"https://static001.geekbang.org/account/avatar/00/10/40/07/050a63ee.jpg","comment_is_top":false,"comment_ctime":1542934266,"is_pvip":false,"replies":[{"id":"15247","content":"👍眼光很毒，的确更好的方法是进程的io情况，比如可以试试pidstat -d","user_name":"作者回复","comment_id":42217,"uid":"1001282","ip_address":"","utype":1,"ctime":1542982151,"user_name_real":"倪朋飞"}],"discussion_count":3,"race_medal":0,"score":"418154761978","product_id":100020901,"comment_content":"io高的例子 ，为何还是通过pidstat 看cpu？不应该是看哪个进程io高吗？只看sys占比就可以确认了？这里不是很理解","like_count":97,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430010,"discussion_content":"👍眼光很毒，的确更好的方法是进程的io情况，比如可以试试pidstat -d","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542982151,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1980201,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/37/29/b3af57a7.jpg","nickname":"凯文小猪","note":"","ucode":"36D8AD0229547F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385233,"discussion_content":"io的例子 我的场景是cpu占用率搞 wa几乎没有什么变化。我是通过ps -LP cu和 top -c定位出来 并没有看出pidstat明显的信息","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1626950384,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590779,"discussion_content":"io高那个参数不是很准确，io高不代表磁盘繁忙，io等待的时候cpu要等待io交互完成在使用，所以io等待的cpu是属于cpu空闲的一种，http://linuxperf.com/?p=33可以看看这个写很明确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666076152,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42213,"user_name":"Ray","can_delete":false,"product_type":"c1","uid":1063127,"ip_address":"","ucode":"F9BE6C721C5BAD","user_header":"https://static001.geekbang.org/account/avatar/00/10/38/d7/d549bf3e.jpg","comment_is_top":false,"comment_ctime":1542934147,"is_pvip":false,"replies":[{"id":"15248","content":"👍源码级分析","user_name":"作者回复","comment_id":42213,"uid":"1001282","ip_address":"","utype":1,"ctime":1542982180,"user_name_real":"倪朋飞"}],"discussion_count":2,"race_medal":0,"score":"345140317827","product_id":100020901,"comment_content":"在 sched&#47;loadavg.c 中计算平均值的算法为EMA，这种算法的目的主要是“距离目标预测窗口越近，则数据的价值越高，对未来影响越大”<br><br>如果说“更快的计算”应该只有里面的 fixed_power_int 函数用 O(log n) 的时间来算 x^n<br><br>所以内核中用 EMA 来算 loadavg 本质上并不是增加计算性能，而是让 loadavg 的趋势化更明显<br>","like_count":80,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430009,"discussion_content":"👍源码级分析","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542982180,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1260026,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","nickname":"安排","note":"","ucode":"F78CFA9624CAEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":168585,"discussion_content":"mark，学习了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581591176,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42403,"user_name":"孤岛","can_delete":false,"product_type":"c1","uid":1242777,"ip_address":"","ucode":"60AFA6A27FB0D9","user_header":"https://static001.geekbang.org/account/avatar/00/12/f6/99/114bfea1.jpg","comment_is_top":false,"comment_ctime":1542949449,"is_pvip":false,"replies":[{"id":"15222","content":"很好的比喻，补充一下这个地铁的乘客容量就是CPU个数","user_name":"作者回复","comment_id":42403,"uid":"1001282","ip_address":"","utype":1,"ctime":1542979924,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"293600725577","product_id":100020901,"comment_content":"我有一点自己的理解，请老师指正。CPU比喻成一辆地铁，正在使用CPU的进程就是在地铁上的人；等待CPU的进程就是在下一站等地铁来的人；等待I&#47;O的进程就是在下一站要上车和下车的人，虽然现在对CPU没影响，可未来会影响，所以也要考虑到平均负载上。","like_count":68,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430078,"discussion_content":"很好的比喻，补充一下这个地铁的乘客容量就是CPU个数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542979924,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42112,"user_name":"DJH","can_delete":false,"product_type":"c1","uid":1256740,"ip_address":"","ucode":"2BDEF123B3DB6A","user_header":"https://static001.geekbang.org/account/avatar/00/13/2d/24/28acca15.jpg","comment_is_top":false,"comment_ctime":1542928875,"is_pvip":false,"replies":[{"id":"15255","content":"逻辑核数","user_name":"作者回复","comment_id":42112,"uid":"1001282","ip_address":"","utype":1,"ctime":1542982396,"user_name_real":"倪朋飞"}],"discussion_count":5,"race_medal":0,"score":"276420835819","product_id":100020901,"comment_content":"老师你好，请教一个问题，现在大多数CPU有超线程能力，在计算和评估平均负载的时候，CPU的核数是指物理核数，还是超线程功能的逻辑核数？","like_count":64,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429993,"discussion_content":"逻辑核数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542982396,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1303743,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e4/bf/bec3c61d.jpg","nickname":"TongLi_Yang","note":"","ucode":"F05575B2282A45","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344359,"discussion_content":"逻辑cpu个数吧，比如1个物理cpu，有4个核心，双线程，那边就是8个逻辑cpu","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1611436940,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1309908,"avatar":"https://static001.geekbang.org/account/avatar/00/13/fc/d4/743d3f02.jpg","nickname":"Anthony","note":"","ucode":"9E0C98A9123365","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":212878,"discussion_content":"cpu调度的最小单元是线程，所以是逻辑核数","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1585028082,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1311316,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/B0hY6AmHia7LrHPuxtdlP1tOaubLvH8wH1PDsQjslnSII0mU9NT2TILNMehxXg4hCLcib2iaic0uo2hEibyR5uHYmicQ/132","nickname":"oliver","note":"","ucode":"5E032A1BAC3490","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":47326,"discussion_content":"如果一个核有多个线程，这个线程算是逻辑核数吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573312850,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1087324,"avatar":"https://static001.geekbang.org/account/avatar/00/10/97/5c/95e96895.jpg","nickname":"Jeyons","note":"","ucode":"28DE2C7597659E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1311316,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/B0hY6AmHia7LrHPuxtdlP1tOaubLvH8wH1PDsQjslnSII0mU9NT2TILNMehxXg4hCLcib2iaic0uo2hEibyR5uHYmicQ/132","nickname":"oliver","note":"","ucode":"5E032A1BAC3490","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302810,"discussion_content":"算","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599035735,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":47326,"ip_address":""},"score":302810,"extra":""}]}]},{"had_liked":false,"id":42805,"user_name":"每天晒白牙","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1543049370,"is_pvip":false,"replies":[{"id":"15320","content":"👍","user_name":"作者回复","comment_id":42805,"uid":"1001282","ip_address":"","utype":1,"ctime":1543058457,"user_name_real":"倪朋飞"}],"discussion_count":4,"race_medal":1,"score":"156161872026","product_id":100020901,"comment_content":"Centos7系统<br><br>安装stress（Linux系统压力测试工具）和sysstat（Linux性能工具）<br><br>yum install stress 一直找不到镜像处理方式   所以用了rpm方式安装<br>用rpm方式安装，先从下面的地址下载rpm包<br>http:&#47;&#47;ftp.tu-chemnitz.de&#47;pub&#47;linux&#47;dag&#47;redhat&#47;el7&#47;en&#47;x86_64&#47;rpmforge&#47;RPMS&#47;stress-1.0.2-1.el7.rf.x86_64.rpm<br>然后 rpm -Uvh stress-1.0.2-1.el7.rf.x86_64.rpm 安装<br>sysstat使用yum安装 yum install sysstat<br><br>","like_count":36,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430204,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543058457,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1113166,"avatar":"https://static001.geekbang.org/account/avatar/00/10/fc/4e/e54ed769.jpg","nickname":"blue","note":"","ucode":"FEBC22FA3AB9DE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2629,"discussion_content":"先安装epel-release这个后可以安装上了\nsudo yum install -y epel-release\nsudo yum install -y stress\n","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1563797892,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590780,"discussion_content":"直接去GitHub上边源码安装就可以了\nwget https://github.com/sysstat/sysstat/archive/refs/tags/v12.5.5.tar.gz\ntar -zxvf v12.5.5.tar.gz\nyum -y install gcc*\ncd sysstat-12.5.5","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666076672,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1970516,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLK4NPyaFDl4rzrd4A9z42tQDibFLdCicbrAdyUa5P2B5u8UCUBenpHX7VgUCibvHvhpza4icMBKVnhmA/132","nickname":"学无止境","note":"","ucode":"2C28E8E54DAB4E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":406078,"discussion_content":"亲测有效，赞一个","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634697948,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42966,"user_name":"一步","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1543120350,"is_pvip":true,"discussion_count":3,"race_medal":1,"score":"134687106526","product_id":100020901,"comment_content":"老师我有个问题哈：就是<br>总核数 = 物理CPU个数 X 每个物理CPU的核数 <br>总逻辑CPU数 = 物理CPU个数 X 每个物理CPU的核数 X 超线程数<br><br>这里的平均负载应该是 总核数比较，还是核总逻辑CPU数 比较呢？","like_count":31,"discussions":[{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590781,"discussion_content":"这个负载是和逻辑cpu个数来比较","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666076739,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1356083,"avatar":"https://static001.geekbang.org/account/avatar/00/14/b1/33/8993eae0.jpg","nickname":"黄展志","note":"","ucode":"EBA342CD89072D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":37629,"discussion_content":"总逻辑CPU数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571648451,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1144171,"avatar":"https://static001.geekbang.org/account/avatar/00/11/75/6b/fd685164.jpg","nickname":"lcf枫","note":"","ucode":"D51E8F68BD41CA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":34192,"discussion_content":"逻辑CPU数，老师在另一个提问回答了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571184029,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":143365,"user_name":"Dym","can_delete":false,"product_type":"c1","uid":1205036,"ip_address":"","ucode":"7E521F01A4D823","user_header":"","comment_is_top":false,"comment_ctime":1571694195,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"130420713075","product_id":100020901,"comment_content":"对与java应用，首先会通过top来查看占用CPU最对的进程，然后通过top -H -p pid 来查看占用CPU最多的线程，得到线程id转化成十六进制，然后通过jstack pid 导出当前线程栈信息，找到对应的线程栈信息，查看具体代码(是否有死循环、是否gc很频繁) ，如果没有找到问题，我们再看占用内存最多的进程，和我们启动时配置上设定的内存做比较，如果接近 那么说明内存资源紧张，然后再通过jstat -gcutil 1s、jmap -histo:live命令查看java中gc回收情况以及创建对象的个数 来分析出是我们内存配置(年轻代或年老代配置不合理、gc回收器配置不恰当)问题还是代码中存在内存溢出。","like_count":30,"discussions":[{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590782,"discussion_content":"直接用Arthas就可以排查java","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666076778,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46848,"user_name":"朱雯","can_delete":false,"product_type":"c1","uid":1035744,"ip_address":"","ucode":"064C45FBF6B51F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/cd/e0/c85bb948.jpg","comment_is_top":false,"comment_ctime":1543990785,"is_pvip":true,"replies":[{"id":"16761","content":"👍<br>","user_name":"作者回复","comment_id":46848,"uid":"1001282","ip_address":"","utype":1,"ctime":1544017412,"user_name_real":"倪朋飞"}],"discussion_count":3,"race_medal":0,"score":"126098042369","product_id":100020901,"comment_content":"1:uptime查看系统负载的命令<br>2：watch -d uptime 查看cpu负载变化的命令<br>3:mpstat 查看cpu使用率的命令<br>4:pidstat 查看关于pid的一些使用情况的命令<br><br><br><br>1：cpu密集型实验：为了说明负载和cpu使用密集有关系，同时四个窗口查看信息，窗口1:stress --cpu 1 --timeout 600 打开cpu压力测试 窗口2:watch -d uptime 查看平均负载的变化 窗口3:mpstat -P ALL 5 查看cpu状态变化 窗口4:pidstat -u 5 1 了解一下谁<br>预期值： 老师讲的是如下预期：<br>1:负载慢慢变为1<br>2:某一个cpu的使用率达到100%，<br>3:pidstat可以查看到 stress占用了100%<br>4:iowait为0ps:这一点是为了说明cpu密集型的进程完全和iowait没有关系的<br>结果：<br>完全符合老师预期<br><br>结论:cpu密集型的程序可以导致负载增高和cpu使用率变高<br><br><br>2:io密集型测试。说明负载和io密集使用关系，同时开四个窗口查看信息，其中三个查看状态的窗口和cpu密集型查看基本一致，压力测试窗口改为stress -i 1 --timeout 600 <br>老师预期如下<br>1:负载慢慢变成1多一点<br>2:cpu使用率低于iowait<br>3:来源可以查到来自于stress<br>实际结果<br>1:负载确实开始变高到1多一点<br>2:iowait一直没有变高，但是cpu使用率边高了<br>3:能看出来stress 的cpu使用率高了<br><br>通过留言发现：stress 使用sync的系统调用导致效果失效，当我慢慢的等待一段时间以后，我发现iowait增高一点了。解决方案是：安装stress-ng以及源码安装stress ps:通过留言看到htop和atop命令<br><br>改进：通过stress-ng测试以后，iowait确实在飙升,也可以通过源码安装的sysstat中的pidstat查看到stress-ng的使用率变高的情况发生<br><br><br>3:大量进程的场景 压力测试窗口改为 stress -c 8 --timeout 600,其他一致<br>老师预期如下：<br>1:负载变高，而且情况很严重<br>2:stress启动的进程很多，导致cpu过载<br>结果：基本符合预期<br><br>结论：负载增高的三种可能性：1:cpu密集型导致负载高，状况时cpu使用率和负载同时变高 2:io密集型：iowait很高同时负载很高3:进程多类型，如名字所示<br><br><br><br><br><br>ps:源码安装sysstat <br>git clone --depth=50 --branch=master https:&#47;&#47;github.com&#47;sysstat&#47;sysstat.git sysstat&#47;sysstat<br>cd sysstat&#47;sysstat<br>git checkout -qf 6886152fb3af82376318c35eda416c3ce611121d<br>export TRAVIS_COMPILER=gcc<br>export CC=gcc<br>export CC_FOR_BUILD=gcc<br> .&#47;configure --disable-nls --prefix=&#47;usr&#47;local&#47;<br> make &amp;&amp;make install","like_count":29,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431568,"discussion_content":"👍\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544017412,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590783,"discussion_content":"w也可以查看系统负载","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666076905,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2439715,"avatar":"https://static001.geekbang.org/account/avatar/00/25/3a/23/afcc22a7.jpg","nickname":"吕氏春秋","note":"","ucode":"4A66408239CF2A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350085,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613703519,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42595,"user_name":"哇哈哈","can_delete":false,"product_type":"c1","uid":1175537,"ip_address":"","ucode":"47453D1C96A1DD","user_header":"https://static001.geekbang.org/account/avatar/00/11/ef/f1/8b06801a.jpg","comment_is_top":false,"comment_ctime":1542976199,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"117507093191","product_id":100020901,"comment_content":"有个疑问，就像置顶评论说需要最新的版本才能看到某些系统运行指标，但是常常出问题的线上机器我们作为开发工程师并没有root权限去安装，找运维同事给装他们也不一定答应开这个口子，有可能用系统自带的或者说各类linux发行版都比较通用的系统命令（例如uptime）来完成系统状态的查看吗？","like_count":27,"discussions":[{"author":{"id":1184505,"avatar":"https://static001.geekbang.org/account/avatar/00/12/12/f9/7e6e3ac6.jpg","nickname":"Geek_04e22a","note":"","ucode":"B64FF12EA28BA6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288302,"discussion_content":"告诉你个好办法，直接把编译好的文件丢到系统上就可以运行了","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1593704154,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1100750,"avatar":"https://static001.geekbang.org/account/avatar/00/10/cb/ce/d9e00eb5.jpg","nickname":"undefined","note":"","ucode":"768098DBDBE333","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1184505,"avatar":"https://static001.geekbang.org/account/avatar/00/12/12/f9/7e6e3ac6.jpg","nickname":"Geek_04e22a","note":"","ucode":"B64FF12EA28BA6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375511,"discussion_content":"哈哈哈，这个……","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621697379,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":288302,"ip_address":""},"score":375511,"extra":""}]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590784,"discussion_content":"你可以在他给root权限的时候自己创建一个账号比如php然后把php组id和uid改成0哈哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666077045,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42250,"user_name":"萬萬沒想到","can_delete":false,"product_type":"c1","uid":1301944,"ip_address":"","ucode":"62C74988BFCA73","user_header":"https://static001.geekbang.org/account/avatar/00/13/dd/b8/9cfb6ada.jpg","comment_is_top":false,"comment_ctime":1542935662,"is_pvip":false,"replies":[{"id":"15241","content":"😊","user_name":"作者回复","comment_id":42250,"uid":"1001282","ip_address":"","utype":1,"ctime":1542981495,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"113212085358","product_id":100020901,"comment_content":"解开了我多年来对平均负载的疑问，就凭这点，花的钱也值了！！","like_count":26,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430025,"discussion_content":"😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542981495,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42358,"user_name":"白华","can_delete":false,"product_type":"c1","uid":1315666,"ip_address":"","ucode":"FC9BACFCA6E8C1","user_header":"https://static001.geekbang.org/account/avatar/00/14/13/52/db1b01fc.jpg","comment_is_top":false,"comment_ctime":1542942587,"is_pvip":false,"discussion_count":7,"race_medal":0,"score":"91737255803","product_id":100020901,"comment_content":"进行实验二 stress  -i 1 --timeout  600模拟sync  ，平均负载确实上升了，但是在mpstst  -P  ALL 5  1查看是sys那一列接近100% 而不是iowait ","like_count":21,"discussions":[{"author":{"id":1577052,"avatar":"https://static001.geekbang.org/account/avatar/00/18/10/5c/5835bf48.jpg","nickname":"紫衣","note":"","ucode":"91EEC3CF959D4A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1695,"discussion_content":"老师的建议：\n1. iowait无法升高的问题，是因为案例中stress使用的是 sync() 系统调用，它的作用是刷新缓冲区内存到磁盘中。对于新安装的虚拟机，缓冲区可能比较小，无法产生大的IO压力，这样大部分就都是系统调用的消耗了。所以，你会看到只有系统CPU使用率升高。解决方法是使用stress的下一代stress-ng，它支持更丰富的选项，比如 stress-ng -i 1 --hdd 1 --timeout 600（--hdd表示读写临时文件）。","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1562819333,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2863497,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoeOax1CZKbF83Crsg2RPOdmYwibxYiafibGzwSj7teIf51XY1rfTLlrlgLHGRRib1ZnulHhGbFNURS9w/132","nickname":"山水牧羊","note":"","ucode":"AACD8AA56E5168","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":1577052,"avatar":"https://static001.geekbang.org/account/avatar/00/18/10/5c/5835bf48.jpg","nickname":"紫衣","note":"","ucode":"91EEC3CF959D4A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590625,"discussion_content":"谢谢，我在实验过程中也遇到了这个情况，帮助很大。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665931810,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":1695,"ip_address":"北京"},"score":590625,"extra":""}]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590785,"discussion_content":"stress-ng -i\nstart N workers continuously calling sync(2) to commit buffer cache to disk.  This can be used in conjunction with the --hdd options.\n\nstress-ng -d\nstart N workers continually writing, reading and removing temporary files. The default mode is to stress test sequential writes and reads.  With the  --aggressive  option  enabled\n              without any --hdd-opts options the hdd stressor will work through all the --hdd-opt options one by one to cover a range of I/O options\n看看这个用-d","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666077102,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1596697,"avatar":"","nickname":"Geek_27f6d8","note":"","ucode":"1448853F7EE5A7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1369,"discussion_content":"我也是这种情况，是什么原因呢？老师可以解释下吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562583766,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1561853,"avatar":"https://static001.geekbang.org/account/avatar/00/17/d4/fd/17bf8b4e.jpg","nickname":"Seanbas","note":"","ucode":"C1FF5BE19307FE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1596697,"avatar":"","nickname":"Geek_27f6d8","note":"","ucode":"1448853F7EE5A7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":14634,"discussion_content":"都讲的很明白了啊，新机器不能使用stress模拟io。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568774178,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":1369,"ip_address":""},"score":14634,"extra":""},{"author":{"id":2002773,"avatar":"","nickname":"Geek_9c998b","note":"","ucode":"B71A9C7F8525D5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1561853,"avatar":"https://static001.geekbang.org/account/avatar/00/17/d4/fd/17bf8b4e.jpg","nickname":"Seanbas","note":"","ucode":"C1FF5BE19307FE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308642,"discussion_content":"用stress-ng一样iowait没有出来，还是sys比较高是怎么回事？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601017484,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":14634,"ip_address":""},"score":308642,"extra":""},{"author":{"id":2002773,"avatar":"","nickname":"Geek_9c998b","note":"","ucode":"B71A9C7F8525D5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1561853,"avatar":"https://static001.geekbang.org/account/avatar/00/17/d4/fd/17bf8b4e.jpg","nickname":"Seanbas","note":"","ucode":"C1FF5BE19307FE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308645,"discussion_content":"更新sysstat包就好了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601018108,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":14634,"ip_address":""},"score":308645,"extra":""}]}]},{"had_liked":false,"id":42807,"user_name":"威","can_delete":false,"product_type":"c1","uid":1068542,"ip_address":"","ucode":"C921CDCB22B9A3","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/fe/882eaf0f.jpg","comment_is_top":false,"comment_ctime":1543049853,"is_pvip":false,"discussion_count":6,"race_medal":0,"score":"87442395773","product_id":100020901,"comment_content":"请问老师，处于不可中断状态的进程，还会占用CPU时钟周期吗","like_count":20,"discussions":[{"author":{"id":1302228,"avatar":"https://static001.geekbang.org/account/avatar/00/13/de/d4/b83c4185.jpg","nickname":"David.cui","note":"","ucode":"AB46F310403612","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":157033,"discussion_content":"会的。进程此时无法做上下文切换，会消耗cpu的时间片","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1580436879,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1311621,"avatar":"https://static001.geekbang.org/account/avatar/00/14/03/85/f0daaeed.jpg","nickname":"Weber","note":"","ucode":"BF3C2AA4F005E9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1302228,"avatar":"https://static001.geekbang.org/account/avatar/00/13/de/d4/b83c4185.jpg","nickname":"David.cui","note":"","ucode":"AB46F310403612","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312146,"discussion_content":"处于sleep状态，不会占用cpu时间片","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602595954,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":157033,"ip_address":""},"score":312146,"extra":""}]},{"author":{"id":1616970,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/2UXuSevhia94o9Eky4OfMuSictaldxcqpjGuvRCOcvjIIoVBAENLEZbv2lgwmwC8icK1ZrUcneNtiaeFBV8MT3uzNg/132","nickname":"Gavin","note":"","ucode":"A5735665E303FD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560732,"discussion_content":"到底谁说得对，占不占cpu","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649430174,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2587091,"avatar":"https://static001.geekbang.org/account/avatar/00/27/79/d3/99d4e09f.jpg","nickname":"凯旋","note":"","ucode":"7E8D0932FA5690","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552599,"discussion_content":"那既然不会占用时间片，为什么会增加负载？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645521843,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1566080,"avatar":"https://static001.geekbang.org/account/avatar/00/17/e5/80/e5616fb3.jpg","nickname":"守望者","note":"","ucode":"66F5C7D54D87EB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2587091,"avatar":"https://static001.geekbang.org/account/avatar/00/27/79/d3/99d4e09f.jpg","nickname":"凯旋","note":"","ucode":"7E8D0932FA5690","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553022,"discussion_content":"是cpu在等待io当然占用cpu时间了\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645693471,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":552599,"ip_address":""},"score":553022,"extra":""}]},{"author":{"id":1363620,"avatar":"https://static001.geekbang.org/account/avatar/00/14/ce/a4/3fe4524b.jpg","nickname":"honey peach","note":"","ucode":"1CE86AF63E5452","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":354904,"discussion_content":"不会","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615359705,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43570,"user_name":"蚂蚁内推+v","can_delete":false,"product_type":"c1","uid":1050508,"ip_address":"","ucode":"24B10AEE54B3FD","user_header":"https://static001.geekbang.org/account/avatar/00/10/07/8c/0d886dcc.jpg","comment_is_top":false,"comment_ctime":1543241208,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"83147619832","product_id":100020901,"comment_content":"不可中断状态的进程则是正处于内核态关键流程中的进程，并且这些流程是不可打断的，比如最常见的是等待硬件设备的 I&#47;O 响应。----linux是有I&#47;O中断的，为什么等待I&#47;O响应却是不可中断的呢？那I&#47;O中断用来干什么呢？","like_count":19,"discussions":[{"author":{"id":1562826,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eq3opKxGyQia0CQibZU8If7Qv6ia3j4XiaWIdCHxrK0T3uZ5RVUSgwf0IJVRVt0wVLibryycTqv4VnEzbw/132","nickname":"Geek_8c4282","note":"","ucode":"09E13C2DDBA48D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":126645,"discussion_content":"如果中途中断，可能出现硬件中的数据跟io的数据差异化，数据不一致","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1578531814,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590786,"discussion_content":"是保护磁盘和进程的安全性，一旦打断了数据会有异常的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666077203,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1184651,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/5XxiaGg3QRVLcQNw3jfzlVtXE6MbFD4nEQkIibEuM2ekic23qN1aGOZP58NhBeibHd8XN4x626icFSlw0VI5tMiauNWA/132","nickname":"lulu","note":"","ucode":"E2F5B9C2D36A7D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":305616,"discussion_content":"有些io为同步阻塞的。未完成不能被中断。中断是指中断当前进程的执行，保存现场，调度其他进程执行。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600039236,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1014729,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7b/c9/75c9002e.jpg","nickname":"Shawn","note":"","ucode":"B95D7B54465DE4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301458,"discussion_content":"中断是可以关闭，当然有一部分是不可屏蔽的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598530831,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1260026,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","nickname":"安排","note":"","ucode":"F78CFA9624CAEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":168593,"discussion_content":"写磁盘不能被中断，写socket可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581591352,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42135,"user_name":"glinuxer","can_delete":false,"product_type":"c1","uid":1148218,"ip_address":"","ucode":"0FD861CB2AA5A7","user_header":"https://static001.geekbang.org/account/avatar/00/11/85/3a/bb885be4.jpg","comment_is_top":false,"comment_ctime":1542931012,"is_pvip":false,"replies":[{"id":"15254","content":"👍👍感谢指出，已经在文章中修正","user_name":"作者回复","comment_id":42135,"uid":"1001282","ip_address":"","utype":1,"ctime":1542982364,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":1,"score":"78852342340","product_id":100020901,"comment_content":"“不可中断状态的进程则是正在等待 I&#47;O 的进程。”——这句话不严谨。<br>应该说等待I&#47;O的进程一般是不可中断的。但反过来说是不正确的。不可中断状态不一定是等待I&#47;O。","like_count":18,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429995,"discussion_content":"👍👍感谢指出，已经在文章中修正","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542982364,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42338,"user_name":"Leon📷","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1542941288,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"74557385320","product_id":100020901,"comment_content":"老师你好，我在centos下模拟IO等待比较高场景，发现mpstat -P ALL 5 1没有出现iowait很高的情况<br>watch -d uptime指令是这样<br> 10:47:15 up 20 min,  5 users,  load average: 1.34, 0.85, 0.52<br>mpstat -P ALL 5 1指令结果是这样<br>平均时间:  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>平均时间:  all    1.21    0.00   98.79    0.00    0.00    0.00    0.00    0.00    0.00    0.00<br>平均时间:    0    1.21    0.00   98.79    0.00    0.00    0.00    0.00    0.00    0.00    0.00<br>","like_count":17,"discussions":[{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590787,"discussion_content":"stress-ng -i\nstart N workers continuously calling sync(2) to commit buffer cache to disk.  This can be used in conjunction with the --hdd options.\n\nstress-ng -d\nstart N workers continually writing, reading and removing temporary files. The default mode is to stress test sequential writes and reads.  With the  --aggressive  option  enabled\n              without any --hdd-opts options the hdd stressor will work through all the --hdd-opt options one by one to cover a range of I/O options\n用-d没事多man","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666077292,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1324202,"avatar":"https://static001.geekbang.org/account/avatar/00/14/34/aa/431de942.jpg","nickname":"dbtiger","note":"","ucode":"05E8447593318C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539513,"discussion_content":"stress -i 1 --hdd 1 --timeout 600","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639734341,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2069928,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/95/a8/7d2c6946.jpg","nickname":"快乐跳跳糖","note":"","ucode":"D7CC6908546750","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291955,"discussion_content":"前几和评论有老师解答，说是需要新版本stress","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595031786,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1134722,"avatar":"https://static001.geekbang.org/account/avatar/00/11/50/82/eb5713bb.jpg","nickname":"牛牛01","note":"","ucode":"3D6A0B0283EF43","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":22389,"discussion_content":"我也是这样，centos","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569633382,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1267906,"avatar":"https://static001.geekbang.org/account/avatar/00/13/58/c2/51fa1f28.jpg","nickname":"GEEKBANG_9388667","note":"","ucode":"FAF51FEFBB291A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5637,"discussion_content":"我自己测试了也是 cpu内核比较高 iowait并不高","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566396611,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":75859,"user_name":"冰凌","can_delete":false,"product_type":"c1","uid":1394578,"ip_address":"","ucode":"5C9EADFEDBF4E5","user_header":"https://static001.geekbang.org/account/avatar/00/15/47/92/f6a832c3.jpg","comment_is_top":false,"comment_ctime":1552482890,"is_pvip":false,"replies":[{"id":"28060","content":"👍 ","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1552750714,"ip_address":"","comment_id":75859,"utype":1}],"discussion_count":4,"race_medal":0,"score":"57387057738","product_id":100020901,"comment_content":"1. 平均负载和CPU使用率的区别：<br>平均负载：系统处于可运行状态和不可中断状态的平均进程数，也就是平均活跃进程数<br>可运行状态：正在使用CPU或者正在等待CPU的进程，也就是我们常用ps命令看到的，处于R状态的进程<br>不可中断状态：正处于内核态关键流程中的进程，并且这些流程是不可打断的。比如最常见的是等待硬件设备的I&#47;O响应，也就是我们在ps命令当中看到的D状态的进程。<br>（不可中断状态实际上是系统对进程和硬件设备的一种保护机制。）<br><br>CPU使用率：单位时间内CPU繁忙情况的统计，跟平均负载并不完全对应。<br><br>2.平均负载和CPU使用率的关系<br>例如：<br>1. CPU密集型进程，使用大量的CPU会导致平均负载升高，此时两者是一致的<br>2. I&#47;O密集型进程，等待I&#47;O也会导致平均负载升高，但是CPU使用率并不一定很高<br>3. 大量等待CPU进程调度也会导致平均负载升高，此时的CPU使用率也会比较高<br><br>3 工具使用<br>理解了原理的基础上，总结下相关的工具和排查步骤<br>如果发生系统负载过高响应比较慢应该如何排查<br>step1: 通过uptime／top看系统负载<br>Step2: 通过top命令中的%CPU 或者mpstat中的%idle %iowait %wait区分是cpu密集型还是io密集型任务还是大量进程等待调度导致<br>Step3: 通过pidstat辅助分析具体是哪个进程导致的<br><br>评论区：<br>还是建议用top和ps或者lsof来分析，因为一般线上的机器不会额外安装这之外的工具，而且很多公司用堡垒机登录上去之后其他的基本上都用不了，用其自带的最保险<br><br>我一直用htop看负载，因为它更直接（在F2配置中勾选所有开关项，打开颜色区分功能），不同的负载会用不同的颜色标识。比如cpu密集型的应用，它的负载颜色是绿色偏高，iowait的操作，它的负载颜色是红色偏高等等，根据这些指标再用htop的sort就很容易定位到有问题的进程。还有个更好用的atop命令，好像是基于sar的统计生成的报告，直接就把有问题的进程标红了，更直观","like_count":13,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443061,"discussion_content":"👍 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552750714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1195258,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3c/fa/e2990931.jpg","nickname":"文敦复","note":"","ucode":"B8F4A6BD5D7805","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533269,"discussion_content":"htop如何查看iowait，貌似并不好查！？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637829381,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1599454,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLOKzDVXse2WibsBGOR27GVYOlv8WRtFBfQe4ekNia2S5986QibD6Wv17gyDpZqmQt3kJcAcbhl3rroQ/132","nickname":"itsxun","note":"","ucode":"69E6CEA3FCB4F3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288702,"discussion_content":"赞~~~~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593843696,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1013424,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","nickname":"不了峰","note":"","ucode":"E23B96D6A3D4EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7624,"discussion_content":"赞~~~~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567589162,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":59973,"user_name":"C J J","can_delete":false,"product_type":"c1","uid":1002287,"ip_address":"","ucode":"603AA1417BD0DE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4b/2f/186918b4.jpg","comment_is_top":false,"comment_ctime":1547434401,"is_pvip":false,"replies":[{"id":"21514","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1547447143,"ip_address":"","comment_id":59973,"utype":1}],"discussion_count":2,"race_medal":0,"score":"57382009249","product_id":100020901,"comment_content":"来自一名后端开发人员的实验笔记。http:&#47;&#47;note.youdao.com&#47;noteshare?id=7f3c0445f1828c8cd2094de4b59a331b<br>","like_count":13,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436427,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547447143,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1225224,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b2/08/92f42622.jpg","nickname":"尔冬橙","note":"","ucode":"0B013A49BC18DA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":69410,"discussion_content":"老哥有后面的笔记么，写的真好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575286373,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48303,"user_name":"踏雪无痕恋","can_delete":false,"product_type":"c1","uid":1111507,"ip_address":"","ucode":"0BCD7C96C9AC5B","user_header":"https://static001.geekbang.org/account/avatar/00/10/f5/d3/121246c1.jpg","comment_is_top":false,"comment_ctime":1544416059,"is_pvip":false,"replies":[{"id":"17273","content":"感谢这么高的赞美，更有动力把专栏做好做精了😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544435757,"ip_address":"","comment_id":48303,"utype":1}],"discussion_count":5,"race_medal":0,"score":"53084023611","product_id":100020901,"comment_content":"讲解的真好，拿着这个问题问了一下身边阿里云P8的性能优化的架构师，居然把他问住了，通过这样的专栏来学习，真的是事半功倍，一定要亲自动手去实验，注意总结。","like_count":12,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432117,"discussion_content":"感谢这么高的赞美，更有动力把专栏做好做精了😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544435757,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1228250,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bd/da/ac36f63d.jpg","nickname":"小班同学","note":"","ucode":"E5F1F1335E9AB9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301386,"discussion_content":"这P8可能是假的，哈哈哈哈","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1598512206,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590788,"discussion_content":"这是一个假的p8下次考p10","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666077336,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1985184,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/GjFJHox9V8qh53zIrExw4NK0KG9WBvRH8RJVjm9jp78RSpWfa2xzyq11dTNItpK2icQniaK4bibTv6ksRGiasjTvMg/132","nickname":"Adong0678","note":"","ucode":"845EECDFDE6233","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290224,"discussion_content":"你身边p8是真的么？😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594381108,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1356083,"avatar":"https://static001.geekbang.org/account/avatar/00/14/b1/33/8993eae0.jpg","nickname":"黄展志","note":"","ucode":"EBA342CD89072D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":37631,"discussion_content":"我看了老师的kubernetes指南，也很NICE，继续点赞","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571648676,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42094,"user_name":"十三","can_delete":false,"product_type":"c1","uid":1196791,"ip_address":"","ucode":"D3EFE8729DDE8A","user_header":"https://static001.geekbang.org/account/avatar/00/12/42/f7/9dce9a7b.jpg","comment_is_top":false,"comment_ctime":1542909335,"is_pvip":false,"replies":[{"id":"15107","content":"总结的很好👍 补充一下，工具的使用最好先查一查手册，网络上的搜索结果不一定完全准确。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542932206,"ip_address":"","comment_id":42094,"utype":1}],"discussion_count":2,"race_medal":0,"score":"48787549591","product_id":100020901,"comment_content":"『D3打卡』<br><br>本来想偷个懒不动手了，结果听着听着音频，就激动地爬起来去操作了。我就是那个把load average和CPU使用率搞混的人，虽然以前每次都会用uptime查一下，但是只能隐约感觉去判断。老师说的确实很对，最简单的概念都不能清楚理解，复杂的系统关系更难抽丝剥茧。<br><br>老实说，很多工具确实都记不清咋用了，网上查了一下，又重新温习了一遍。学习果然永远不可能只靠一篇文章，真那么详细面面俱到，估计得几万字的操作手册了，就跟在学校上课似的，讲的是重点，自己基础不够的，该查字典查字典，该练习的练习。<br><br>期待后面的内容更精彩<br>","like_count":11,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429989,"discussion_content":"总结的很好👍 补充一下，工具的使用最好先查一查手册，网络上的搜索结果不一定完全准确。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542932206,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590789,"discussion_content":"多man linux和unix的解释不一样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666077391,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42375,"user_name":"亚索","can_delete":false,"product_type":"c1","uid":1314774,"ip_address":"","ucode":"E34A081E148473","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTID6xcHMMQdvRbQHSRXrLTYqLpXnMT1mL59yicGZ6IVhiame7iaOXzZz0ljBtOMlrahCDbgB5kvydtAQ/132","comment_is_top":false,"comment_ctime":1542943943,"is_pvip":false,"replies":[{"id":"15225","content":"逻辑CPU个数","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542980037,"ip_address":"","comment_id":42375,"utype":1}],"discussion_count":3,"race_medal":0,"score":"44492616903","product_id":100020901,"comment_content":"grep &#39;model name&#39; &#47;proc&#47;cpuinfo | wc -l  这个命令的得到的是cpu核数，不是cpu个数，文中纠正一下呗","like_count":10,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430071,"discussion_content":"逻辑CPU个数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542980037,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590790,"discussion_content":"这是查看cpu的逻辑个数而不是核数lscpu直接就能看到","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666077436,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3161777,"avatar":"https://static001.geekbang.org/account/avatar/00/30/3e/b1/387da06f.jpg","nickname":"🌻summer","note":"","ucode":"D7FBE24B3FA368","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588740,"discussion_content":"老师，我通过这个命令怎么查出来的值是0呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1664038866,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42230,"user_name":"低头走路，抬头看天","can_delete":false,"product_type":"c1","uid":1137639,"ip_address":"","ucode":"DF8B3017D79E44","user_header":"https://static001.geekbang.org/account/avatar/00/11/5b/e7/49a0ce91.jpg","comment_is_top":false,"comment_ctime":1542934778,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"44492607738","product_id":100020901,"comment_content":"有些建议，cpu和cpu核心数不是一个概念，也不能划等号吧。","like_count":10,"discussions":[{"author":{"id":1562826,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eq3opKxGyQia0CQibZU8If7Qv6ia3j4XiaWIdCHxrK0T3uZ5RVUSgwf0IJVRVt0wVLibryycTqv4VnEzbw/132","nickname":"Geek_8c4282","note":"","ucode":"09E13C2DDBA48D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":126652,"discussion_content":"我觉得老师说的cpu指的是逻辑cpu核数，应该是表述有问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578531909,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42160,"user_name":"茴香根","can_delete":false,"product_type":"c1","uid":1316111,"ip_address":"","ucode":"B91C00B72077F1","user_header":"https://static001.geekbang.org/account/avatar/00/14/15/0f/954be2db.jpg","comment_is_top":false,"comment_ctime":1542932259,"is_pvip":false,"replies":[{"id":"15252","content":"man pidstat ","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542982274,"ip_address":"","comment_id":42160,"utype":1}],"discussion_count":3,"race_medal":0,"score":"35902670627","product_id":100020901,"comment_content":"我的理解cpu在时间片轮转调度是以线程为单位的。每个进程内可以存在很多线程。每个线程也都可以是cpu密集型，io密集型。从底层微观来说cpu负载应该可以观测到线程这个层次。但操作系统只提供了细化到进程这一级别的观测工具。针对一些多线程程序，不知道有没有能够观测到线程级别的工具？","like_count":8,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430002,"discussion_content":"man pidstat ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542982274,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2070107,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLPcbudQOzUfwoHC4FpVwiaSAuYf0B2CvSLXm4RrTVhhsOibOJTbpvIFI6Zv72D9rQltM4h6icuJq5ibw/132","nickname":"朝旭曦风","note":"","ucode":"1756A0E27948F6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295133,"discussion_content":"我目前知道的有两种方法：\n1、pidstat -t\n2、top -H -p PID","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1596099584,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590792,"discussion_content":"pidstat -wt","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666077507,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53809,"user_name":"Maxwell","can_delete":false,"product_type":"c1","uid":1086275,"ip_address":"","ucode":"720A00AD472616","user_header":"https://static001.geekbang.org/account/avatar/00/10/93/43/0e84492d.jpg","comment_is_top":false,"comment_ctime":1545731933,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"31610503005","product_id":100020901,"comment_content":"感觉看留言也能学到不少知识","like_count":7},{"had_liked":false,"id":43896,"user_name":"赵强强","can_delete":false,"product_type":"c1","uid":1073596,"ip_address":"","ucode":"1B8AE07484C69A","user_header":"https://static001.geekbang.org/account/avatar/00/10/61/bc/88a905a5.jpg","comment_is_top":false,"comment_ctime":1543320133,"is_pvip":false,"discussion_count":6,"race_medal":0,"score":"27313123909","product_id":100020901,"comment_content":"老师您好，文中建议“平均负载高于CPU数量70%时，需要关注系统性能”，以2个CPU为例，高于70%是指高于2.7（2+0.7）还是3.4（2+2*0.7）呢。","like_count":6,"discussions":[{"author":{"id":1203659,"avatar":"https://static001.geekbang.org/account/avatar/00/12/5d/cb/3507f11c.jpg","nickname":"sbwei🚴","note":"","ucode":"A90E57298670A6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288916,"discussion_content":"1.4","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1593931608,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1145907,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep2gRIticwS6CiatsCiaU4QRjAODKibQevrhSciatrmd90lNIZFxywE9yyZgAxKTmWiaBSH4zZUcRIV46qQ/132","nickname":"englefly","note":"","ucode":"E3FCF19E618718","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334104,"discussion_content":"应该是 3.4","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1607743312,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1448147,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/ueWNR1W4WibG9o7sa3Wv6by4VwM15rJCOGfxZ3nX0tj9ic8nTcofFUICBrXICgomJfRblVMHUQELFoKKMLUmPk0Q/132","nickname":"不懈前行","note":"","ucode":"237C22578E1AF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":199597,"discussion_content":"3.4","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583595028,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1562826,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eq3opKxGyQia0CQibZU8If7Qv6ia3j4XiaWIdCHxrK0T3uZ5RVUSgwf0IJVRVt0wVLibryycTqv4VnEzbw/132","nickname":"Geek_8c4282","note":"","ucode":"09E13C2DDBA48D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":126664,"discussion_content":"2*0.7=1.4","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578532229,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1618652,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/dc/67e0e985.jpg","nickname":"顺利","note":"","ucode":"C904941C8BA6DA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":26526,"discussion_content":"超出2的70%，也就是超出1.4的时候需要关注","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570606271,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1636410,"avatar":"https://static001.geekbang.org/account/avatar/00/18/f8/3a/e0c14cb3.jpg","nickname":"lizhibo","note":"","ucode":"FDF4FA12C699B3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1618652,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/dc/67e0e985.jpg","nickname":"顺利","note":"","ucode":"C904941C8BA6DA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":31744,"discussion_content":"我感觉你这说的也没有说清楚啊 还弄的更加迷糊了...","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570952092,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":26526,"ip_address":""},"score":31744,"extra":""}]}]},{"had_liked":false,"id":42674,"user_name":"MJ","can_delete":false,"product_type":"c1","uid":1237145,"ip_address":"","ucode":"FCEC0C21444D2A","user_header":"https://static001.geekbang.org/account/avatar/00/12/e0/99/5d603697.jpg","comment_is_top":false,"comment_ctime":1543017530,"is_pvip":false,"replies":[{"id":"15322","content":"下一篇讲","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543058611,"ip_address":"","comment_id":42674,"utype":1}],"discussion_count":3,"race_medal":0,"score":"27312821306","product_id":100020901,"comment_content":"请问老师，等待cpu进程为什么也导致CPU利用率高呢？","like_count":6,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430156,"discussion_content":"下一篇讲","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543058611,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1604827,"avatar":"","nickname":"tinyfool","note":"","ucode":"8B93B6A9FBEA12","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2061,"discussion_content":"等待cpu的进程应该导致的是cpu平均负载高吧；cpu利用率不一定高？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1563237528,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590793,"discussion_content":"cpu等待核cpu空闲是一个类型的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666077631,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42374,"user_name":"zkwKevin","can_delete":false,"product_type":"c1","uid":1241908,"ip_address":"","ucode":"F2FFC29B456D26","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/AnGcicHHShBFzjPAAaqOgYzicibaRnFictZTc6taianFGiaZRxpJNWictb5TkYGibCF7jy82pUaibDIzXS7asbz11ErhrLw/132","comment_is_top":false,"comment_ctime":1542943914,"is_pvip":false,"replies":[{"id":"15226","content":"比如，它可以自己使用100%的CPU，也可以通过系统调用导致内核线程的CPU升高","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542980211,"ip_address":"","comment_id":42374,"utype":1}],"discussion_count":4,"race_medal":0,"score":"27312747690","product_id":100020901,"comment_content":"老师，我有一点不太理解就是比如线上只有一个tomcat进程，那，它撑死了就是一个进程，会占用的平均负载就是1。我理解这个负载之所以会升高，应该是它导致系统其他进程进入了r状态，不知道对不对","like_count":6,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430070,"discussion_content":"比如，它可以自己使用100%的CPU，也可以通过系统调用导致内核线程的CPU升高","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542980211,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590794,"discussion_content":"你系统当中不可能只有一个进程，linux本身的服务那也是进程呀只是跑在了内核态里面，第三方的程序时跑在用户态","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666077749,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1168658,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d5/12/ba7214ce.jpg","nickname":"lzkfun","note":"","ucode":"8FB1EFB10E5DA2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334467,"discussion_content":"一个新的系统一般不是只有一个进程的. pid为1的initd/systemd基本都有, 然后sshd这种后台服务也在运行, 甚至你打开的窗口都是有对应的进程的, 以是CPU占用非常少, 在压测的时候只能作为零头看到(CPU还是很强大的, 性能过剩)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607855761,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1102115,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d1/23/8251913b.jpg","nickname":"小丑魚去哪了","note":"","ucode":"69B95DA43B7BA7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":264399,"discussion_content":"这个负载确定是进程吗，比如像你一样运行一个进程为啥load还能超过1呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589303508,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42290,"user_name":"要饭真得好难","can_delete":false,"product_type":"c1","uid":1063625,"ip_address":"","ucode":"43A27392787B38","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/QrZxgJ29EFqH8ey0K9SA3bzUdAB1wabTQNiajH1AICicWF0B0fZUuA7qibFR2buNYKXOo8uchRKGOlwsarrZXicLKA/132","comment_is_top":false,"comment_ctime":1542937601,"is_pvip":false,"replies":[{"id":"15235","content":"还需要CPU和IO的性能数据才好区分，稍后会有细化讲述","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542981192,"ip_address":"","comment_id":42290,"utype":1}],"discussion_count":3,"race_medal":0,"score":"27312741377","product_id":100020901,"comment_content":"在场景二和场景三中，假如我不知道前置条件，只看wait的使用比例都很高，我该如何判断是因为io导致的wait高，还是因为cpu不够等待cpu导致的wait高呢？","like_count":6,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430037,"discussion_content":"还需要CPU和IO的性能数据才好区分，稍后会有细化讲述","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542981192,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590796,"discussion_content":"有top呀。top可以看到呀。用户态高就要排查用户态，内核态高就排查内核的 top可以看到cpu io 软硬中断 僵尸进程 内存 系统负载直接去缩小排查范围","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666077886,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2905523,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIDqHQQByGiaXcAk94MdDn3ftupZLXyR6bAKibxOzMxy5h3uBwZ7QiaCiaIfbCMK0cIQfGNax8iawoiaQAg/132","nickname":"nuan","note":"","ucode":"55FF98EB85404D","race_medal":5,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558396,"discussion_content":"mpstat 的输出里有 iowait","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648281946,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43710,"user_name":"neil","can_delete":false,"product_type":"c1","uid":1114569,"ip_address":"","ucode":"C14BE89908BEAD","user_header":"https://static001.geekbang.org/account/avatar/00/11/01/c9/59c385a8.jpg","comment_is_top":false,"comment_ctime":1543282960,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23018119440","product_id":100020901,"comment_content":"看平均负载时，是计算cpu个数还是cpu核数？比如有2个cpu每个2核，平均负载为4，是正好每个活跃进程都得到了cpu还是一半没拿到？","like_count":5},{"had_liked":false,"id":43356,"user_name":"echo","can_delete":false,"product_type":"c1","uid":1081292,"ip_address":"","ucode":"D81839D03AE550","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEIHvQHWCJ6cjAjFthVAADNWx0uaZicm4UDJCbVbvcian6gFI1gqWWX2tG3lEB2nVNtaVXtwibGOYiauCA/132","comment_is_top":false,"comment_ctime":1543218943,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"23018055423","product_id":100020901,"comment_content":"老师你好，有个难题希望能指导一下排查<br>我有个系统，跑的是32核48G的云主机，load经常超过CPU核数， 但是CPU利用率不超过50%左右，I&#47;O wait 不超过0.1，出于R状态的进程数也就一两个。系统只要跑一个CPU密集型的Java进程，线程数2-3k， 不知道还能从哪里着手排查了。","like_count":5,"discussions":[{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590799,"discussion_content":"那你得查看top来排查核缩小排查范围，top看到用户态高，cpu不高，io高，有没有僵尸进程，软硬中断是否有，下一步就是pidstat -c 或者pidstat -d io高就是iotop核iostat 有僵尸进程就是 ps -A -ostat,ppid,pid,cmd|grep -e &#34;^[zZ]&#34;去查看了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666078064,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1024486,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a1/e6/50da1b2d.jpg","nickname":"旭东(Frank)","note":"","ucode":"176FA629800062","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390566,"discussion_content":"CPU 密集型的还跑这么多线程？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629894530,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":100682,"user_name":"杨领well","can_delete":false,"product_type":"c1","uid":1145650,"ip_address":"","ucode":"3974A03855168C","user_header":"https://static001.geekbang.org/account/avatar/00/11/7b/32/60089a62.jpg","comment_is_top":false,"comment_ctime":1559615840,"is_pvip":false,"replies":[{"id":"38375","content":"谢谢分享😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1561215768,"ip_address":"","comment_id":100682,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18739485024","product_id":100020901,"comment_content":"深度好文， 尤其是他分析问题的思路。<br>Linux Load Averages: Solving the Mystery： http:&#47;&#47;www.brendangregg.com&#47;blog&#47;2017-08-08&#47;linux-load-averages.html","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452634,"discussion_content":"谢谢分享😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561215768,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58123,"user_name":"Something","can_delete":false,"product_type":"c1","uid":1314641,"ip_address":"","ucode":"0772172E3597D3","user_header":"https://static001.geekbang.org/account/avatar/00/14/0f/51/ec3a5d28.jpg","comment_is_top":false,"comment_ctime":1547000100,"is_pvip":false,"replies":[{"id":"20985","content":"是的，进程非常多，但进程虽然多，大都是不活跃进程","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1547027450,"ip_address":"","comment_id":58123,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18726869284","product_id":100020901,"comment_content":"有个疑问，问出来估计很low，，，文章讲的活跃进程数最好不要超过总CPU核数的百分之75，我在想光操作系统的进程就非常之多，那不是动不动就超了？","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435916,"discussion_content":"是的，进程非常多，但进程虽然多，大都是不活跃进程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547027450,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43258,"user_name":"icode","can_delete":false,"product_type":"c1","uid":1316610,"ip_address":"","ucode":"1B029C8ED37CFE","user_header":"https://static001.geekbang.org/account/avatar/00/14/17/02/8ec52987.jpg","comment_is_top":false,"comment_ctime":1543201306,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18723070490","product_id":100020901,"comment_content":"理解CPU进程调度，更好理解负载。","like_count":4},{"had_liked":false,"id":42318,"user_name":"他说风雨中","can_delete":false,"product_type":"c1","uid":1048012,"ip_address":"","ucode":"3175063755F1FD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fd/cc/b13b71f9.jpg","comment_is_top":false,"comment_ctime":1542939893,"is_pvip":false,"replies":[{"id":"15234","content":"IO是系统管理的，首先会消耗系统CPU。iowait小说明IO压力还不够，见我的统一回复","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542981054,"ip_address":"","comment_id":42318,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18722809077","product_id":100020901,"comment_content":"老师您好，我想问一下为什么我在用stress给io压力的时候，mpstat的数据iowait是0，但是sys占用很高，想问您一下这是怎么回事","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430044,"discussion_content":"IO是系统管理的，首先会消耗系统CPU。iowait小说明IO压力还不够，见我的统一回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542981054,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":235360,"user_name":"Geek_8397b3","can_delete":false,"product_type":"c1","uid":2069123,"ip_address":"","ucode":"64571F73486E24","user_header":"","comment_is_top":false,"comment_ctime":1594982049,"is_pvip":false,"replies":[{"id":"86942","content":"好问题，这几个数值实际上是过去一段时间的指数滑动平均值。1分钟loadavg并非完全等同于过去1分钟的平均值，详细的原理可以参考http:&#47;&#47;www.brendangregg.com&#47;blog&#47;2017-08-08&#47;linux-load-averages.html。<br><br>如果是更快的衡量系统负载，可以使用其他指标，比如直接使用CPU使用率。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1594994724,"ip_address":"","comment_id":235360,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14479883937","product_id":100020901,"comment_content":"有个问题：<br>为什么uptime中的平均负载是1分钟，5分钟，15分钟的负载？为什么不是5s，10s，30s呢？对于Android 等面向终端用户的设备，会对系统性能的下降非常敏感，更快地衡量系统负载是否会更好呢？<br><br>谢谢","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501696,"discussion_content":"好问题，这几个数值实际上是过去一段时间的指数滑动平均值。1分钟loadavg并非完全等同于过去1分钟的平均值，详细的原理可以参考http://www.brendangregg.com/blog/2017-08-08/linux-load-averages.html。\n\n如果是更快的衡量系统负载，可以使用其他指标，比如直接使用CPU使用率。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594994724,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":100878,"user_name":"杨领well","can_delete":false,"product_type":"c1","uid":1145650,"ip_address":"","ucode":"3974A03855168C","user_header":"https://static001.geekbang.org/account/avatar/00/11/7b/32/60089a62.jpg","comment_is_top":false,"comment_ctime":1559660932,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14444562820","product_id":100020901,"comment_content":"注意： 如果 mpstat 没有指定观察的间隔时间的话，它返回的是从操作系统启动到当前命令执行时间段内的统计值。 If you do not specify the interval parameter, the mpstat command generates a single report that contains statistics for the time since system startup and then exits. <br><br>参考文献：https:&#47;&#47;www.ibm.com&#47;support&#47;knowledgecenter&#47;en&#47;ssw_aix_71&#47;com.ibm.aix.cmds3&#47;mpstat.htm","like_count":3},{"had_liked":false,"id":65579,"user_name":"行行行","can_delete":false,"product_type":"c1","uid":1066121,"ip_address":"","ucode":"2A8481C263FBD2","user_header":"","comment_is_top":false,"comment_ctime":1549464457,"is_pvip":false,"replies":[{"id":"23695","content":"是 CPU 使用率，但代表CPU是空闲的（等待I&#47;O操作）","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550067238,"ip_address":"","comment_id":65579,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14434366345","product_id":100020901,"comment_content":"老师，等待io的进程指的是top中wa状态的进程cpu使用率和吗，那么cpu是不是也是繁忙的呢，所以I&#47;O 密集型进程，等待 I&#47;O 也会导致平均负载升高，但 CPU 使用率不一定很高这句话不是很懂","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438508,"discussion_content":"是 CPU 使用率，但代表CPU是空闲的（等待I/O操作）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550067238,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63767,"user_name":"小犀牛","can_delete":false,"product_type":"c1","uid":1371584,"ip_address":"","ucode":"2AA6B388DFC476","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/zdYDVMBian6WeZkUDtzgicVheZfeF7A5aC62p0DxJKkViaBUFia0eZQCGkO5fZNZqsga0DU9cQIYUMbkG8xEibLxBicw/132","comment_is_top":false,"comment_ctime":1548493486,"is_pvip":false,"replies":[{"id":"22593","content":"ls命令也需要CPU执行","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548577140,"ip_address":"","comment_id":63767,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14433395374","product_id":100020901,"comment_content":"CPU使用百分百时候，为什么了 ls命令都不能使用","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437712,"discussion_content":"ls命令也需要CPU执行","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548577140,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54180,"user_name":"花开蝶自来","can_delete":false,"product_type":"c1","uid":1358144,"ip_address":"","ucode":"767D55E7A82975","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKibu8C3CeYGF6JCBribiaEPia5gibaQnj9icryPVwoF6ibosmdicXJIhBEUdn0aDwZQ32oTyJL86DgDswhAg/132","comment_is_top":false,"comment_ctime":1545801421,"is_pvip":false,"replies":[{"id":"19702","content":"可以的，&#47;proc&#47;pid&#47;schedstat ","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545835588,"ip_address":"","comment_id":54180,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14430703309","product_id":100020901,"comment_content":"没有 wait%的话，没有其他命令能查出来么？一定要用pidstat吗？求教","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434384,"discussion_content":"可以的，/proc/pid/schedstat ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545835588,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50299,"user_name":"Way","can_delete":false,"product_type":"c1","uid":1299641,"ip_address":"","ucode":"F942B3B431147D","user_header":"https://static001.geekbang.org/account/avatar/00/13/d4/b9/8c3b7e46.jpg","comment_is_top":false,"comment_ctime":1544948065,"is_pvip":false,"replies":[{"id":"18098","content":"👍 谢谢分享","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545003596,"ip_address":"","comment_id":50299,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14429849953","product_id":100020901,"comment_content":"Amazon EC2 Ubuntu 18.04 因为限制了repo源，运行apt install stress会遇到以下错误<br>&quot;E: Unable to locate package stress&quot;<br>解决方法:<br>1) sudo nano &#47;etc&#47;apt&#47;sources.list<br>2) 添加以下三行到文件最底部, 然后保存并退出<br>deb http:&#47;&#47;archive.ubuntu.com&#47;ubuntu bionic main universe<br>deb http:&#47;&#47;archive.ubuntu.com&#47;ubuntu bionic-security main universe <br>deb http:&#47;&#47;archive.ubuntu.com&#47;ubuntu bionic-updates main universe<br>3) <br>sudo apt update<br>4) <br>sudo apt install stress<br>5) 确认已安装<br>$ stress --version<br>stress 1.0.4<br><br>","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432937,"discussion_content":"👍 谢谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545003596,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44162,"user_name":"Cranliu","can_delete":false,"product_type":"c1","uid":1304302,"ip_address":"","ucode":"DC2DE84B142FDA","user_header":"https://static001.geekbang.org/account/avatar/00/13/e6/ee/e3c4c9b3.jpg","comment_is_top":false,"comment_ctime":1543376671,"is_pvip":false,"replies":[{"id":"15821","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543409253,"ip_address":"","comment_id":44162,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14428278559","product_id":100020901,"comment_content":"我们通常会遇到客户反馈慢的情况，这个时候我们怎么分析呢（第一步很关键）？<br>   首先查看系统的平均负载情况(top&#47;uptime)<br>   这里需要了解平均负载的含义：<br>       单位时间内，系统处于可运行状态和不可中断状态的平均进程数，也就是平均活跃进程数。从概念上看平均负载和CPU使用率没有必然的关系。<br>       这里有两个关键词：<br>       1、可运行状态，其包括正在运行以及等待运行的进程。<br>       2、不可中断，系统处于内核态关键流程中进程，并且这些进程是不可打断的。最常见的就是IO操作了，是为了保护进程和硬件的一致性而设置的一种状态。<br>   导致系统平均负载升高的原因有以下几种情况(紧扣概念即可)：<br>   1、CPU密集型的进程(也叫计算密集型，CPU的使用率大部分情况是100%，但是IO短时间就能完成)，使用了大量的CPU资源而导致平均负载升高，此时平均负载升高就和CPU的使用率有直接关系了<br>   2、IO密集型的进程(大量进程处于不可中断状态的，等待IO也会导致平均负载升高)，但此时CPU的使用率不一定高(跟CPU的关联不大)<br>   3、大量进程等待CPU调度也会导致平均负载升高(大量进程处理正在运行或者是等待运行状态)，此时的CPU使用率也会很高<br>不过有一个问题点：进程在等待CPU调度的时候并没有真正运行，为什么会导致系统的平均负载升高呢？<br>这个就要引入一个概念，CPU上下文切换","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430659,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543409253,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43137,"user_name":"布冬","can_delete":false,"product_type":"c1","uid":1175527,"ip_address":"","ucode":"8ECDA23C0DE888","user_header":"https://static001.geekbang.org/account/avatar/00/11/ef/e7/df5fbed0.jpg","comment_is_top":false,"comment_ctime":1543191303,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14428093191","product_id":100020901,"comment_content":"rpc调用时会遇到耗时但是还得分页的调用，这时候启用多个线程并行调用，会大大降低耗时，看了这章节的学习发现这样也会导致load身高，但不是很清楚怎么取舍，老师能详细分析一下吗？","like_count":3},{"had_liked":false,"id":42804,"user_name":"每天晒白牙","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1543048963,"is_pvip":false,"discussion_count":1,"race_medal":1,"score":"14427950851","product_id":100020901,"comment_content":"io线程加到300，iowait还是0<br><br>stress -i 300 --timeout 600<br>","like_count":3,"discussions":[{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590801,"discussion_content":"stress-ng -i\nstart N workers continuously calling sync(2) to commit buffer cache to disk.  This can be used in conjunction with the --hdd options.\n\nstress-ng -d\nstart N workers continually writing, reading and removing temporary files. The default mode is to stress test sequential writes and reads.  With the  --aggressive  option  enabled\n              without any --hdd-opts options the hdd stressor will work through all the --hdd-opt options one by one to cover a range of I/O options\n用-d","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666078321,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42392,"user_name":"Geek_13d0e4","can_delete":false,"product_type":"c1","uid":1139427,"ip_address":"","ucode":"DF3C75D8EA2C92","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKNxVNQrkicXYQHZE1qz30YGxF93PIf5520YCkdoO5micRaHCxkxPBcXleHZYWTyQJM4iabZEaelnCaA/132","comment_is_top":false,"comment_ctime":1542946998,"is_pvip":false,"replies":[{"id":"15223","content":" 命令选项的用法请先man ps 查询手册","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542979962,"ip_address":"","comment_id":42392,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14427848886","product_id":100020901,"comment_content":"ps 命令如何看到r或者d状态的呢","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430075,"discussion_content":" 命令选项的用法请先man ps 查询手册","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542979962,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42172,"user_name":"Douglas","can_delete":false,"product_type":"c1","uid":1073027,"ip_address":"","ucode":"CFDE3D76B9DAE6","user_header":"https://static001.geekbang.org/account/avatar/00/10/5f/83/bb728e53.jpg","comment_is_top":false,"comment_ctime":1542932769,"is_pvip":false,"replies":[{"id":"15250","content":"IO都会消耗内核态CPU","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542982251,"ip_address":"","comment_id":42172,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14427834657","product_id":100020901,"comment_content":"不好意思打错了字了，老师，正在等待io的进程会消耗cpu资源吗？比如，应用服务器程序中，一条sql 发送到数据库系统，这个时候请求交给了数据库系统处理中，等待数据库返回,这个时候，该应用程序的线程会消耗cpu 资源吗？","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430004,"discussion_content":"IO都会消耗内核态CPU","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542982251,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1244283,"avatar":"https://static001.geekbang.org/account/avatar/00/12/fc/7b/adfef198.jpg","nickname":"一位不愿透漏姓名的足球名宿","note":"","ucode":"2A67AD14C1F436","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344350,"discussion_content":"文中说的是硬盘IO才是不可中断IO会占用cpu资源，但是这里是网络IO，网络IO线程应该处于阻塞状态，此时不会占用CPU资源吧","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1611422581,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42147,"user_name":"Dale","can_delete":false,"product_type":"c1","uid":1010056,"ip_address":"","ucode":"DD4717C06E417D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/69/88/528442b0.jpg","comment_is_top":false,"comment_ctime":1542931708,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14427833596","product_id":100020901,"comment_content":"我在工作中先用uptime 看看整体情况，在用top查看进程，按照cpu使用率排序，找出占用最大进程，再用strace跟踪进程在干啥。还会检查哪些进程处于D状态，看看io情况。","like_count":3},{"had_liked":false,"id":42081,"user_name":"Johnson","can_delete":false,"product_type":"c1","uid":1225037,"ip_address":"","ucode":"55B582953E49F3","user_header":"https://static001.geekbang.org/account/avatar/00/12/b1/4d/10c75b34.jpg","comment_is_top":false,"comment_ctime":1542904066,"is_pvip":false,"replies":[{"id":"15115","content":"这几个工具的参数在音频里面没有读，但在文稿的代码段开始都有说明。<br><br>不希望这个专栏成为一个命令工具的使用手册，所以文章里没有罗列这些工具的详细用法。其实，运行一下 “man 工具名”很容易查到这些。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542933074,"ip_address":"","comment_id":42081,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14427805954","product_id":100020901,"comment_content":"老师 可不可以讲一下pidstat mpstat stress工具的用法呢 比如各个参数的含义是什么","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429986,"discussion_content":"这几个工具的参数在音频里面没有读，但在文稿的代码段开始都有说明。\n\n不希望这个专栏成为一个命令工具的使用手册，所以文章里没有罗列这些工具的详细用法。其实，运行一下 “man 工具名”很容易查到这些。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542933074,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":305599,"user_name":"陈启航","can_delete":false,"product_type":"c1","uid":2177436,"ip_address":"","ucode":"89246B9BFD3269","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/ajNVdqHZLLC4IhKmJDYdWhQms3dmZqJ5YMDGTlPa1o52DnKSErYjsqfc6iaRJrBDZpx0RqQx7eZAED797kiaV6aw/132","comment_is_top":false,"comment_ctime":1628065579,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"10218000171","product_id":100020901,"comment_content":"必须回复一个, 几个指标的解释, 这个钱花的值了.","like_count":2},{"had_liked":false,"id":74012,"user_name":"中中哥","can_delete":false,"product_type":"c1","uid":1066007,"ip_address":"","ucode":"2836F4D139E254","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKODTphVILAIhSe12svgFMZebQojDTslUKXYaTqcEDicnyzvu4kFnKXW76GicEXU2CtAttmxveF1WLg/132","comment_is_top":false,"comment_ctime":1552060797,"is_pvip":false,"replies":[{"id":"27482","content":"嗯 是的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1552399125,"ip_address":"","comment_id":74012,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10141995389","product_id":100020901,"comment_content":"老师，有个疑问，实际项目我压测的时候r的进程能到30多，那这个到底是线程还是进程？我 用java起二十个线程，r可以维持在二十左右，那这个可以确定r指的是线程吗？","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442385,"discussion_content":"嗯 是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552399125,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58941,"user_name":"Leon📷","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1547258031,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10137192623","product_id":100020901,"comment_content":"大家热情高是因为面试的时候遇到linux性能调优的问题主要靠蒙和猜，让很多人在这个环节丢分严重，之前都是碎片化网页攻略或者linux一些手册查看，没有形成系统性的知识网络，老师第一次让大家意识到这是门系统性的学科，居然还有专门的国外大佬出书来详细讲解这个，所以老师是带领我们走进了一个新世界，打开了新知识的大门，功德无量","like_count":2},{"had_liked":false,"id":43624,"user_name":"米雄雄","can_delete":false,"product_type":"c1","uid":1197009,"ip_address":"","ucode":"FBDF8D3D4BF8FA","user_header":"https://static001.geekbang.org/account/avatar/00/12/43/d1/3dd582a8.jpg","comment_is_top":false,"comment_ctime":1543247916,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10133182508","product_id":100020901,"comment_content":"老师，在使用pidstat  -u  5  20   ，线上一个进程%cpu  高1000多，按理它不是占用其中的一个cpu100%到顶了啊！","like_count":2},{"had_liked":false,"id":43055,"user_name":"SICUN","can_delete":false,"product_type":"c1","uid":1254261,"ip_address":"","ucode":"22A384904EB9E9","user_header":"https://static001.geekbang.org/account/avatar/00/13/23/75/2b599841.jpg","comment_is_top":false,"comment_ctime":1543151444,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"10133086036","product_id":100020901,"comment_content":"win10使用vmware,装的centos7.4,使用这个命令（stress-ng -i 1 --hdd -1 --timeout 600）后，磁盘被占满了，导致虚拟机无法打开，查资料后解决，执行前应该查看命令的作用和带来的后果的，算是吃一堑长一智了。<br>","like_count":2,"discussions":[{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590804,"discussion_content":"不会有影响的-i是调用了sync的函数去刷新buff或者cache的数据落盘不会影响虚拟机的我之前测试过很多次了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666078586,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2110718,"avatar":"https://static001.geekbang.org/account/avatar/00/20/34/fe/e5429b02.jpg","nickname":"glimmer","note":"","ucode":"48A16C52FB4C45","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372778,"discussion_content":"什么原因呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620460629,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43011,"user_name":"张挺","can_delete":false,"product_type":"c1","uid":1038954,"ip_address":"","ucode":"CDF8549440926D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/da/6a/91bd13de.jpg","comment_is_top":false,"comment_ctime":1543136092,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10133070684","product_id":100020901,"comment_content":"您好，下载了stress-ng，有两个参数，请您帮忙解释一下：--fork和--vm ，这两个参数提到的fork()和mmap 的具体含义是什么？网上看了一些解释还是不太明白，谢谢","like_count":2},{"had_liked":false,"id":42388,"user_name":"JJ","can_delete":false,"product_type":"c1","uid":1057434,"ip_address":"","ucode":"3C9295759FAA11","user_header":"https://static001.geekbang.org/account/avatar/00/10/22/9a/989a3d8e.jpg","comment_is_top":false,"comment_ctime":1542945771,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10132880363","product_id":100020901,"comment_content":"很棒！特别是后面还有具体实例模拟，让理解的更深刻","like_count":2},{"had_liked":false,"id":42286,"user_name":"周萝卜","can_delete":false,"product_type":"c1","uid":1315039,"ip_address":"","ucode":"056A4426D14A45","user_header":"https://static001.geekbang.org/account/avatar/00/14/10/df/e4511752.jpg","comment_is_top":false,"comment_ctime":1542937501,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10132872093","product_id":100020901,"comment_content":"打卡，很好","like_count":2},{"had_liked":false,"id":42274,"user_name":"Mr.S","can_delete":false,"product_type":"c1","uid":1158946,"ip_address":"","ucode":"96DC8BE01D54C2","user_header":"https://static001.geekbang.org/account/avatar/00/11/af/22/559c2fdb.jpg","comment_is_top":false,"comment_ctime":1542936450,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10132871042","product_id":100020901,"comment_content":"打卡","like_count":2},{"had_liked":false,"id":42086,"user_name":"包包up","can_delete":false,"product_type":"c1","uid":1073495,"ip_address":"","ucode":"A6F51A62A8B362","user_header":"https://static001.geekbang.org/account/avatar/00/10/61/57/6f3c81dd.jpg","comment_is_top":false,"comment_ctime":1542906065,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10132840657","product_id":100020901,"comment_content":"之前的认知是负载是cpu的负载，没想到这个值还会受到iowait进程的影响。<br>之前出现负载很高的时候直接top看哪些进程的cpu使用很高。<br>后面出现负载问题的时候应该还要再看看iowait的情况。学到了","like_count":2},{"had_liked":false,"id":235895,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1595237726,"is_pvip":false,"replies":[{"id":"87252","content":"👍总结的不错","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1595343003,"ip_address":"","comment_id":235895,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5890205022","product_id":100020901,"comment_content":"总结：✨✨✨<br>-- Cpu使用率与系统负载的关系：<br>CPU 使用率，是单位时间内 CPU 繁忙情况的统计，跟平均负载并不一定完全对应。比如：<br>- CPU 密集型进程，使用大量 CPU 会导致平均负载升高，此时这两者是一致的；<br>- I&#47;O 密集型进程，等待 I&#47;O 也会导致平均负载升高，但 CPU 使用率不一定很高；<br>- 大量等待 CPU 的进程调度也会导致平均负载升高，此时的 CPU 使用率也会比较高<br><br>uptime命令的含义：<br> \t16:00:30 up 27 days, 43 min,  2 users,  load average: 0.00, 0.01, 0.05<br>    当前时间  系统运行时间          正在登陆用户数       过去1分钟、5分钟、15分钟的负载<br><br><br>-- stress 和 sysstat 包：<br>\t--stress 是一个 Linux 系统压力测试工具，可以用作异常进程模拟平均负载升高的场景。<br><br>\t--sysstat 包含了常用的 Linux 性能工具，用来监控和分析系统性能。<br>这个包有两个命令：mpstat 和 pidstat<br>\t----mpstat 是一个常用的多核 CPU 性能分析工具，用来实时查看每个 CPU 的性能指标，以及所有 CPU 的平均指标。<br>\t----pidstat 是一个常用的进程性能分析工具，用来实时查看进程的 CPU、内存、I&#47;O 以及上下文切换等性能指标。<br><br>--安装：<br> sudo su root<br> yum install stress<br><br>系统负载压测步骤：<br>window1：根据场景选择压测命令<br>-- 模拟CPU密集型<br># stress --cpu 1 --timeout 600 &#47;&#47;模拟对1个cpu的压测到100%的场景，超时时间600s  <br>-- 模拟IO密集型<br># stress -i 1 --timeout 600 &#47;&#47;模拟对IO的压测，即不停地执行sync，超时时间600s<br>-- 模拟多进程密集型<br># stress -c 8 --timeout 600 &#47;&#47;模拟8个进程的压测，超时时间600s<br><br>window2：根据uptime观察系统负载<br> # watch -d uptime<br><br>window3：mpstat观察cpu使用率的变化情况<br> # mpstat -P ALL 5<br><br>window4：查看是哪个进程引起的负载升高<br># pidstat -u 5 1<br>","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501869,"discussion_content":"👍总结的不错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595343003,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":224245,"user_name":"Vip-Time","can_delete":false,"product_type":"c1","uid":1204394,"ip_address":"","ucode":"D0F244DED2AB5B","user_header":"https://static001.geekbang.org/account/avatar/00/12/60/aa/ca11714c.jpg","comment_is_top":false,"comment_ctime":1591322693,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"5886289989","product_id":100020901,"comment_content":"基础问题，往往是这些多年经验工程师最容易忽略的问题，日常很常见，也经常运用，但某天被别人突然问到的时候，却又不是很清晰明了的解释清楚。很赞同倪老师的话，越是基础原理性的知识点多问几个为什么？20200605打卡","like_count":1},{"had_liked":false,"id":184225,"user_name":"小袁","can_delete":false,"product_type":"c1","uid":1811495,"ip_address":"","ucode":"3F5D8721F577D9","user_header":"https://static001.geekbang.org/account/avatar/00/1b/a4/27/15e75982.jpg","comment_is_top":false,"comment_ctime":1583250421,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5878217717","product_id":100020901,"comment_content":"为什么不用top来分析呢？方便大家学习","like_count":1},{"had_liked":false,"id":181489,"user_name":"蚂蚁内推+v","can_delete":false,"product_type":"c1","uid":1050508,"ip_address":"","ucode":"24B10AEE54B3FD","user_header":"https://static001.geekbang.org/account/avatar/00/10/07/8c/0d886dcc.jpg","comment_is_top":false,"comment_ctime":1582551389,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5877518685","product_id":100020901,"comment_content":"你好，倪老师，我想问下stress貌似没有指定某个编号的cpu压测吧？有其他的工具或者有相似功能的吗？<br>难道得借助cgroup吗？虚心请教，求回复，求指导，谢谢","like_count":1},{"had_liked":false,"id":126544,"user_name":"GeekCoder","can_delete":false,"product_type":"c1","uid":1523315,"ip_address":"","ucode":"14BB73CBE28545","user_header":"","comment_is_top":false,"comment_ctime":1566405988,"is_pvip":false,"replies":[{"id":"47211","content":"iowait状态会调度给需要CPU的进程","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1566743542,"ip_address":"","comment_id":126544,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5861373284","product_id":100020901,"comment_content":"请教下，一核cpu，有两个进程A和B。A进程中遇到io了，这时进程A处于不可中断状态吗？在进程A遇到io，进入内核，直到返回。这中间cpu会切换到进程b运行吗？还是cpu会一直等a进程io操作完。才会有机会切换到其他进程？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464047,"discussion_content":"iowait状态会调度给需要CPU的进程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566743542,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1311316,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/B0hY6AmHia7LrHPuxtdlP1tOaubLvH8wH1PDsQjslnSII0mU9NT2TILNMehxXg4hCLcib2iaic0uo2hEibyR5uHYmicQ/132","nickname":"oliver","note":"","ucode":"5E032A1BAC3490","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":47342,"discussion_content":"这个感觉有点答非所问呢","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1573314096,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":119618,"user_name":"afterdream","can_delete":false,"product_type":"c1","uid":1619795,"ip_address":"","ucode":"701AD039459191","user_header":"https://static001.geekbang.org/account/avatar/00/18/b7/53/823f647c.jpg","comment_is_top":false,"comment_ctime":1564638723,"is_pvip":false,"replies":[{"id":"44413","content":"一般讨论IO的时候主要是指磁盘或文件系统，网络的IO和其他外设通常分别讨论。网络IO的模拟可以参考后面的网络模块，有很多网络案例。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1565016774,"ip_address":"","comment_id":119618,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5859606019","product_id":100020901,"comment_content":"一直以来都有一个疑问，我所接触的IO负载，都是自己通过dd命令模拟对硬盘操作实现的。<br>那么还有其他IO负载的类型吗？比如串口、网口等外设接口也算IO负载吗，怎样模拟一个呢？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460983,"discussion_content":"一般讨论IO的时候主要是指磁盘或文件系统，网络的IO和其他外设通常分别讨论。网络IO的模拟可以参考后面的网络模块，有很多网络案例。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565016774,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":119030,"user_name":"刘文坛","can_delete":false,"product_type":"c1","uid":1141060,"ip_address":"","ucode":"327D908175EDD0","user_header":"https://static001.geekbang.org/account/avatar/00/11/69/44/1588e8b6.jpg","comment_is_top":false,"comment_ctime":1564489893,"is_pvip":false,"replies":[{"id":"44419","content":"用 iostat 观测不到网络I&#47;O，参考下网卡模块介绍的工具吧","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1565017194,"ip_address":"","comment_id":119030,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5859457189","product_id":100020901,"comment_content":"老师您好，系统中有个程序从网卡抓流量，3s生成pcap，我的程序一直读取pcap并解析。通过iostat可以看到wkB&#47;s 在200,000左右，但是rkB&#47;s却一直为0。难道是iostat出问题了？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460716,"discussion_content":"用 iostat 观测不到网络I/O，参考下网卡模块介绍的工具吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565017194,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590806,"discussion_content":"iostat是查看磁盘io不是查看网络io的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666078959,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":102423,"user_name":"设置昵称","can_delete":false,"product_type":"c1","uid":1504058,"ip_address":"","ucode":"1FB53E126036EB","user_header":"https://static001.geekbang.org/account/avatar/00/16/f3/3a/63cf1d0e.jpg","comment_is_top":false,"comment_ctime":1560218854,"is_pvip":false,"replies":[{"id":"37079","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1560258913,"ip_address":"","comment_id":102423,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5855186150","product_id":100020901,"comment_content":"首先<br><br>本文从平均负载出来，解释了平均负载的含义以及升高的三种原因：<br>1.  CPU密集型进程<br>2.  多个进程抢占CPU<br>3.  IO密集型进程<br><br>其次<br>本文通过案例来分析平均负载的问题<br>1. 查看系统的平均负载情况<br>uptime<br>2. 如果负载过高，通过一下命令分析是CPU过高，还是IO过高所导致的<br>mpstat -P ALL 5<br>3. 最后定位具体是哪一个进程导致<br>pidstat<br>","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453416,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560258913,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96515,"user_name":"笑","can_delete":false,"product_type":"c1","uid":1284647,"ip_address":"","ucode":"C91EAFAB88E5AC","user_header":"https://static001.geekbang.org/account/avatar/00/13/9a/27/4b81bce5.jpg","comment_is_top":false,"comment_ctime":1558439161,"is_pvip":false,"replies":[{"id":"34556","content":"表示进程因为等待某个事件而被系统挂起，07和08篇还有详细的介绍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1558447238,"ip_address":"","comment_id":96515,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5853406457","product_id":100020901,"comment_content":"能否回答下，不可中断进程不可被打断什么意思？是被抢占CPU吗？不可中断进程到底占不占用CPU时钟周期？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450906,"discussion_content":"表示进程因为等待某个事件而被系统挂起，07和08篇还有详细的介绍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558447238,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":94893,"user_name":"zhang","can_delete":false,"product_type":"c1","uid":1517047,"ip_address":"","ucode":"650C292030057B","user_header":"https://static001.geekbang.org/account/avatar/00/17/25/f7/4cc60573.jpg","comment_is_top":false,"comment_ctime":1557917643,"is_pvip":false,"replies":[{"id":"34174","content":"嗯","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1558095811,"ip_address":"","comment_id":94893,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5852884939","product_id":100020901,"comment_content":"老师，我是否可以将平均负载理解为多少人在争抢资源？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450249,"discussion_content":"嗯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558095811,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":94275,"user_name":"秒秒开心","can_delete":false,"product_type":"c1","uid":1529471,"ip_address":"","ucode":"F1E0A8189ED83B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIeQibxwVRM3enN6ib7liawc7PEugZuG7xY6ic9Y0uBZpot2pGVJhJ5BEHwgAn0Pn5KDrtgVBEcJqeKpQ/132","comment_is_top":false,"comment_ctime":1557758142,"is_pvip":false,"replies":[{"id":"33780","content":"😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1557835358,"ip_address":"","comment_id":94275,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5852725438","product_id":100020901,"comment_content":"真的是满满的干货，朋友圈别人分享的老师的课程，起初没有放在心上，但是性能分析一直是自己的弱项，而且市面上一讲性能大部分都是讲性能工具的，所以抱着试试看的心态来学的，没想到老师讲解的内容如此细致，许多点都是举例来说明，让人理解的更深刻，每天学一点，感觉现在对性能充满了激情，不可多得的好课程","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":449992,"discussion_content":"😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557835358,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":92517,"user_name":"JJj","can_delete":false,"product_type":"c1","uid":1196463,"ip_address":"","ucode":"EA53F2CEAFCFF1","user_header":"https://static001.geekbang.org/account/avatar/00/12/41/af/4307867a.jpg","comment_is_top":false,"comment_ctime":1557289117,"is_pvip":false,"replies":[{"id":"33110","content":"消耗CPU不代表CPU使用率就一定很高","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1557324267,"ip_address":"","comment_id":92517,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5852256413","product_id":100020901,"comment_content":"您好，请问下，io一定会消耗系统cpu，那为什么说io密集型的cpu利用率不一定会高呢？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":449295,"discussion_content":"消耗CPU不代表CPU使用率就一定很高","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557324267,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1019887,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8f/ef/508f1a9d.jpg","nickname":"冷白染","note":"","ucode":"00B191339988E6","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348537,"discussion_content":"我理解是io密集型的是“cpu占用”而不是“cpu使用util”","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1612618501,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79281,"user_name":"古冷","can_delete":false,"product_type":"c1","uid":1179854,"ip_address":"","ucode":"4B527897E73C2F","user_header":"https://static001.geekbang.org/account/avatar/00/12/00/ce/de7e7336.jpg","comment_is_top":false,"comment_ctime":1553424310,"is_pvip":false,"replies":[{"id":"29044","content":"就是个百分比 (1.73-1)&#47;1*100%=73%","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553526102,"ip_address":"","comment_id":79281,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5848391606","product_id":100020901,"comment_content":"单 CPU 系统上看到平均负载为 1.73，0.60，7.98，那么说明在过去 1 分钟内，系统有 73% 的超载，而在15 分钟内，有 698% 的超载<br>这个超载是怎么计算出来的呢？   怎么个公式呢？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444429,"discussion_content":"就是个百分比 (1.73-1)/1*100%=73%","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553526102,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78071,"user_name":"刘德芳","can_delete":false,"product_type":"c1","uid":1035272,"ip_address":"","ucode":"724661991A4C95","user_header":"https://static001.geekbang.org/account/avatar/00/0f/cc/08/b7fdcaa0.jpg","comment_is_top":false,"comment_ctime":1553067159,"is_pvip":false,"replies":[{"id":"28770","content":"升级 sysstat 版本","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553318959,"ip_address":"","comment_id":78071,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5848034455","product_id":100020901,"comment_content":"输入：pidstat -u 5 1，没有%wait参数列？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443957,"discussion_content":"升级 sysstat 版本","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553318959,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77577,"user_name":"林贻民","can_delete":false,"product_type":"c1","uid":1202213,"ip_address":"","ucode":"F7185C61CAE4D0","user_header":"https://static001.geekbang.org/account/avatar/00/12/58/25/2088864b.jpg","comment_is_top":false,"comment_ctime":1552964358,"is_pvip":false,"replies":[{"id":"28780","content":"是的，只有CPU不忙的时候，iowait才会高","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553319780,"ip_address":"","comment_id":77577,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5847931654","product_id":100020901,"comment_content":"老师您好，我有个问题，我使用stress -io 64 —timeout 产生大量的io进程，然后使用mpstat -P ALL 5 查看iowait,发现每个逻辑CPU对应的%iowait 只有25左右，而只产生一个io进程的时候，对应的CPU的%iowait 却可以达到7，80呢？是因为存在大量进程调度，使得CPU忙于进程调度，所以CPU io等待的时间变少了吗？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443783,"discussion_content":"是的，只有CPU不忙的时候，iowait才会高","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553319780,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":73474,"user_name":"JJj","can_delete":false,"product_type":"c1","uid":1196463,"ip_address":"","ucode":"EA53F2CEAFCFF1","user_header":"https://static001.geekbang.org/account/avatar/00/12/41/af/4307867a.jpg","comment_is_top":false,"comment_ctime":1551912500,"is_pvip":false,"replies":[{"id":"27319","content":"不是，进程不总是cpu 100%运行着，还需要IO、访问内存等等","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1552347855,"ip_address":"","comment_id":73474,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5846879796","product_id":100020901,"comment_content":"请问下粗暴地认为运行的进程数等于cpu核数是不是最理想的情况？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442102,"discussion_content":"不是，进程不总是cpu 100%运行着，还需要IO、访问内存等等","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552347855,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60729,"user_name":"closer","can_delete":false,"product_type":"c1","uid":1368990,"ip_address":"","ucode":"69F38480DF8491","user_header":"https://static001.geekbang.org/account/avatar/00/14/e3/9e/b26da70d.jpg","comment_is_top":false,"comment_ctime":1547538830,"is_pvip":false,"replies":[{"id":"22308","content":"后面几篇有很多CPU使用率的分析案例","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548249133,"ip_address":"","comment_id":60729,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5842506126","product_id":100020901,"comment_content":"请问老师，redis的top里面CPU很高，但是所在的cpu的编号确很低，怎么查？谢谢老师。困惑很久了","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436600,"discussion_content":"后面几篇有很多CPU使用率的分析案例","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548249133,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57861,"user_name":"杨🌳恒","can_delete":false,"product_type":"c1","uid":1284989,"ip_address":"","ucode":"E6AA1659353458","user_header":"https://static001.geekbang.org/account/avatar/00/13/9b/7d/a2a29840.jpg","comment_is_top":false,"comment_ctime":1546931057,"is_pvip":false,"replies":[{"id":"20995","content":"嗯嗯，所以平均负载只能作为一个参考，还需要进一步的性能分析","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1547028448,"ip_address":"","comment_id":57861,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5841898353","product_id":100020901,"comment_content":"老师，您说“平均负载最理想的情况是等于 CPU 个数”，那么根据“I&#47;O密集型导致的平均负载升高，cpu却不高”的情况，平均负载跟cpu无关时，那岂不是无法判断“平均负载理想值”了？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435797,"discussion_content":"嗯嗯，所以平均负载只能作为一个参考，还需要进一步的性能分析","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547028448,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46124,"user_name":"ckckck","can_delete":false,"product_type":"c1","uid":1337620,"ip_address":"","ucode":"BEDFC8BC59EB11","user_header":"","comment_is_top":false,"comment_ctime":1543850760,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5838818056","product_id":100020901,"comment_content":"打卡，<br>通过stree压测工具，巩固了关于负载的知识，其中一个stress -i 压io时，使用centos6.5系统并未见到效果，查看只是系统cpu增加了， 可以使用 stress -d 1 -t 600 来压下hdd的硬盘（默认1G）","like_count":1},{"had_liked":false,"id":44905,"user_name":"草剑","can_delete":false,"product_type":"c1","uid":1026310,"ip_address":"","ucode":"C6DA55E7E1B701","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a9/06/9811fb65.jpg","comment_is_top":false,"comment_ctime":1543504917,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5838472213","product_id":100020901,"comment_content":"打卡<br>平均负载是平均活跃进程数，包含正在使用CPU的进程，等待CPU的进程和等待I&#47;O的进程，理想情况是等于CPU个数。","like_count":1},{"had_liked":false,"id":44245,"user_name":"18646333118","can_delete":false,"product_type":"c1","uid":1202411,"ip_address":"","ucode":"35576AC4E5ADDD","user_header":"https://static001.geekbang.org/account/avatar/00/12/58/eb/cf3608bd.jpg","comment_is_top":false,"comment_ctime":1543393597,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5838360893","product_id":100020901,"comment_content":"centos7 测试io压力不好用，iowait没有浮动","like_count":1},{"had_liked":false,"id":44151,"user_name":"赵强强","can_delete":false,"product_type":"c1","uid":1073596,"ip_address":"","ucode":"1B8AE07484C69A","user_header":"https://static001.geekbang.org/account/avatar/00/10/61/bc/88a905a5.jpg","comment_is_top":false,"comment_ctime":1543374787,"is_pvip":false,"replies":[{"id":"15824","content":"因为I&#47;O瓶颈也是系统负载的一部分","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543409354,"ip_address":"","comment_id":44151,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5838342083","product_id":100020901,"comment_content":"倪老师您好，为什么uninterrupted sleep的进程会增加系统负载，而普通sleep状态的进程不会增加系统负载呢？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430654,"discussion_content":"因为I/O瓶颈也是系统负载的一部分","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543409354,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1244283,"avatar":"https://static001.geekbang.org/account/avatar/00/12/fc/7b/adfef198.jpg","nickname":"一位不愿透漏姓名的足球名宿","note":"","ucode":"2A67AD14C1F436","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344349,"discussion_content":"我理解大量不可中断进程会导致CPU频发上下文切换，但是普通sleep进程处于阻塞状态CPU就不会调度到他了，自然减少了CPU上下切换次数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611422294,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44070,"user_name":"克","can_delete":false,"product_type":"c1","uid":1069206,"ip_address":"","ucode":"6DDFBB05E0F4E9","user_header":"https://static001.geekbang.org/account/avatar/00/10/50/96/18612c89.jpg","comment_is_top":false,"comment_ctime":1543367101,"is_pvip":false,"replies":[{"id":"15832","content":"对的，照顾新同学，这里没有细分，第4篇有专门讲解它们的区别","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543410720,"ip_address":"","comment_id":44070,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5838334397","product_id":100020901,"comment_content":"文章中的“进程”替换成“线程”是不是更合适些。现在操作系统的CPU调度操作系统线程才是最小纬度啊。","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430622,"discussion_content":"对的，照顾新同学，这里没有细分，第4篇有专门讲解它们的区别","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543410720,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44033,"user_name":"柯锦玲(侠客行)","can_delete":false,"product_type":"c1","uid":1319040,"ip_address":"","ucode":"BFF9390B9CDB9A","user_header":"https://static001.geekbang.org/account/avatar/00/14/20/80/d61ad0cc.jpg","comment_is_top":false,"comment_ctime":1543365829,"is_pvip":false,"replies":[{"id":"15836","content":"取决于锁的竞争情况","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543411068,"ip_address":"","comment_id":44033,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5838333125","product_id":100020901,"comment_content":"朋飞你好，请教一个问题，<br>如果我编写程序，写了很多内核线程，他们大部分时间都是在调用mutex_lock等待，请问一下，这样系统的平均负载会不会非常高？ <br>","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430606,"discussion_content":"取决于锁的竞争情况","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543411068,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43911,"user_name":"Geek_60821e","can_delete":false,"product_type":"c1","uid":1316693,"ip_address":"","ucode":"A55F71113AEEA4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJTqaqppkyn9avZHqCnONVJ2Cwp9fmr7yQqUB8icRMFgCbYEHPAyogHqfYjgKPQBteKxnEKQHJzDmQ/132","comment_is_top":false,"comment_ctime":1543322247,"is_pvip":false,"replies":[{"id":"15849","content":"参考第一条回复。注意是wait而不是iowait","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543411950,"ip_address":"","comment_id":43911,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5838289543","product_id":100020901,"comment_content":"centos中pidstat -u 5 1没有显示iowait占比，是兼容问题？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430545,"discussion_content":"参考第一条回复。注意是wait而不是iowait","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543411950,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43322,"user_name":"嘿嘿和哈哈","can_delete":false,"product_type":"c1","uid":1040976,"ip_address":"","ucode":"D1DF7BB312BFAC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e2/50/9cc482c6.jpg","comment_is_top":false,"comment_ctime":1543213056,"is_pvip":false,"replies":[{"id":"15552","content":"👍步骤太详细了","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543240756,"ip_address":"","comment_id":43322,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5838180352","product_id":100020901,"comment_content":"升级sysstat监控工具<br><br>下载11.5.5以上版本的软件<br><br>wget http:&#47;&#47;pagesperso-orange.fr&#47;sebastien.godard&#47;sysstat-12.1.1.tar.gz<br>解压<br><br>tar xf sysstat-12.1.1.tar.gz<br>进入目录<br><br>cd &#47;opt&#47;tools&#47;sysstat-12.1.1<br>设置参数<br><br># sa_lib_dir=&#47;usr&#47;lib&#47;sa\\<br>sa_dir=&#47;var&#47;log&#47;sa\\<br>conf_dir=&#47;etc&#47;sysconfig   \\<br>.&#47;configure --prefix=&#47;usr \\<br>--disable-file-attr<br>&amp;&amp; make &amp;&amp; make install<br>设置sysstat全局变量及开机启动<br><br>ln -s &#47;安装路径&#47;sysstat-11.5.5&#47;sysstat  &#47;usr&#47;local&#47;bin&#47;<br>ln -s &#47;安装路径&#47;sysstat-11.5.5&#47;sysstat  &#47;etc&#47;init.d&#47;sysstat<br>chkconfig --add sysstat<br>chkconfig --list | grep sysstat<br>手动启动sysstat<br><br># &#47;etc&#47;rc.d&#47;init.d&#47;sysstat start<br>查看下是否可用<br><br>sar -u 1 5<br>执行完以上发现不是最新版本按照以下方式：<br><br>cd &#47;opt&#47;tools&#47;sysstat-12.1.1<br>.&#47;configure<br>make &amp;&amp; make install<br>查看版本<br><br>[root@zst bin]# sar -V<br>sysstat version 12.1.1<br>(C) Sebastien Godard (sysstat &lt;at&gt; orange.fr)<br>验证<br># pidstat -u 5 1<br>Linux 3.10.0-693.2.2.el7.x86_64    11&#47;26&#47;2018      _x86_64_        (2 CPU)<br><br>02:16:28 PM   UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command<br>感谢老师。解决啦。","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430361,"discussion_content":"👍步骤太详细了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543240756,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43160,"user_name":"kakasir","can_delete":false,"product_type":"c1","uid":1316615,"ip_address":"","ucode":"21F9742D3E63B3","user_header":"https://static001.geekbang.org/account/avatar/00/14/17/07/83f030c9.jpg","comment_is_top":false,"comment_ctime":1543193819,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5838161115","product_id":100020901,"comment_content":"到了第二节就干货满满，不自己动手操作，后面有可能跟不上了","like_count":1},{"had_liked":false,"id":42895,"user_name":"Goal","can_delete":false,"product_type":"c1","uid":1307012,"ip_address":"","ucode":"C337CD4C7E07B0","user_header":"https://static001.geekbang.org/account/avatar/00/13/f1/84/7d21bd9e.jpg","comment_is_top":false,"comment_ctime":1543075644,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5838042940","product_id":100020901,"comment_content":"centos6测试第二个案例，和老师讲解的一样。<br>centos7的话，只有sys，io那一列观察不到变化","like_count":1},{"had_liked":false,"id":42801,"user_name":"每天晒白牙","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1543048617,"is_pvip":false,"discussion_count":1,"race_medal":1,"score":"5838015913","product_id":100020901,"comment_content":"老师好，在实战场景二：I&#47;O密集型进程的例子中，我把io线程加到了10个，iowait一直是0.具体结果如下：<br>stress -i 10 --timeout 600<br><br>平均时间:  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>平均时间:  all    0.27    0.00   99.46    0.00    0.00    0.03    0.00    0.00    0.00    0.25<br>平均时间:    0    0.24    0.00   99.52    0.00    0.00    0.02    0.00    0.00    0.00    0.22<br>平均时间:    1    0.28    0.00   99.40    0.00    0.00    0.04    0.00    0.00    0.00    0.28<br>","like_count":1,"discussions":[{"author":{"id":1730754,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/68/c2/b112da90.jpg","nickname":"小源哥","note":"","ucode":"B5130CE20CF31D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":340213,"discussion_content":"我跟你一样，iowait都是0.00","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609928251,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42755,"user_name":"miracle","can_delete":false,"product_type":"c1","uid":1276137,"ip_address":"","ucode":"FD7074F1062AE9","user_header":"https://static001.geekbang.org/account/avatar/00/13/78/e9/9d807269.jpg","comment_is_top":false,"comment_ctime":1543035835,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5838003131","product_id":100020901,"comment_content":"我这边用 stress -i 50 -t 600 %iowait还一直是0 这个应该来怎样分析？centos8 2cpu 2g 用vmware运行的","like_count":1},{"had_liked":false,"id":42671,"user_name":"Ftao","can_delete":false,"product_type":"c1","uid":1324304,"ip_address":"","ucode":"A595D9ED6AFBE7","user_header":"https://static001.geekbang.org/account/avatar/00/14/35/10/a58ca913.jpg","comment_is_top":false,"comment_ctime":1543016827,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5837984123","product_id":100020901,"comment_content":"可以推荐有关书籍么   关于运维方面的，linux系统原理等等方面","like_count":1},{"had_liked":false,"id":42644,"user_name":"MJ","can_delete":false,"product_type":"c1","uid":1237145,"ip_address":"","ucode":"FCEC0C21444D2A","user_header":"https://static001.geekbang.org/account/avatar/00/12/e0/99/5d603697.jpg","comment_is_top":false,"comment_ctime":1542987562,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5837954858","product_id":100020901,"comment_content":"老师，实验二 stress -i 1 --timeout 600模拟sync ，平均负载确实上升了，但是在mpstst -P ALL 5 1查看是sys那一列接近100% 而不是iowait   ，系统同版本ubuntu","like_count":1},{"had_liked":false,"id":42538,"user_name":"蔡志超","can_delete":false,"product_type":"c1","uid":1315742,"ip_address":"","ucode":"ECB758BD910910","user_header":"https://static001.geekbang.org/account/avatar/00/14/13/9e/c9453e52.jpg","comment_is_top":false,"comment_ctime":1542967257,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5837934553","product_id":100020901,"comment_content":"确实如很多同学说的，在centos7 上， mpstat IO显示有问题，一直都是0 ","like_count":1},{"had_liked":false,"id":42442,"user_name":"for","can_delete":false,"product_type":"c1","uid":1006284,"ip_address":"","ucode":"F062F823A1B698","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5a/cc/448a4620.jpg","comment_is_top":false,"comment_ctime":1542955154,"is_pvip":false,"replies":[{"id":"15215","content":"这个案例看的是CPU使用率（%system），后面还会专门介绍iowait更好的分析方法。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542979368,"ip_address":"","comment_id":42442,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5837922450","product_id":100020901,"comment_content":"请问场景二是如何定位到stress导致的io问题的呢？pidstat中的输出可以看出stress的资源消耗是明显高于其他进程，但是通过什么确定是它导致的高io呢？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430093,"discussion_content":"这个案例看的是CPU使用率（%system），后面还会专门介绍iowait更好的分析方法。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542979368,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42411,"user_name":"Allen","can_delete":false,"product_type":"c1","uid":1252639,"ip_address":"","ucode":"2F3959A717BE10","user_header":"https://static001.geekbang.org/account/avatar/00/13/1d/1f/6bc10297.jpg","comment_is_top":false,"comment_ctime":1542950033,"is_pvip":false,"replies":[{"id":"15220","content":"下周会讲😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542979742,"ip_address":"","comment_id":42411,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5837917329","product_id":100020901,"comment_content":"『day2』<br><br>我有几个疑问，<br>1.  我们本节课的问题是在分析哪个进程的占用率高。 那如何分析进程下的哪个线程占用率高呢？<br><br>2.  Cpu占用率高和低，与系统的内存占用率有关系吗？  还是说，系统内存占用率与cpu占用率是两个不同的概念。<br><br>期待老师的答复，多谢。","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430082,"discussion_content":"下周会讲😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542979742,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42405,"user_name":"笑","can_delete":false,"product_type":"c1","uid":1284647,"ip_address":"","ucode":"C91EAFAB88E5AC","user_header":"https://static001.geekbang.org/account/avatar/00/13/9a/27/4b81bce5.jpg","comment_is_top":false,"comment_ctime":1542949635,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5837916931","product_id":100020901,"comment_content":"学习了，写的非常好","like_count":1},{"had_liked":false,"id":42313,"user_name":"李","can_delete":false,"product_type":"c1","uid":1119312,"ip_address":"","ucode":"5C0FAA211F2E26","user_header":"https://static001.geekbang.org/account/avatar/00/11/14/50/c23cf47d.jpg","comment_is_top":false,"comment_ctime":1542939447,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5837906743","product_id":100020901,"comment_content":"第二个场景没有模拟出来，iowait都是0。环境是4核。我把i后面参数增加也没反应","like_count":1},{"had_liked":false,"id":42310,"user_name":"zqing","can_delete":false,"product_type":"c1","uid":1106603,"ip_address":"","ucode":"2EF31AE75DA0A2","user_header":"https://static001.geekbang.org/account/avatar/00/10/e2/ab/430c24df.jpg","comment_is_top":false,"comment_ctime":1542939246,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5837906542","product_id":100020901,"comment_content":"老师，请教下负载均衡为啥要引入不可中断的任务？是基于什么考虑的","like_count":1},{"had_liked":false,"id":42282,"user_name":"李志博","can_delete":false,"product_type":"c1","uid":1009109,"ip_address":"","ucode":"F3C72573B3C112","user_header":"https://static001.geekbang.org/account/avatar/00/0f/65/d5/88beb15a.jpg","comment_is_top":false,"comment_ctime":1542937198,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5837904494","product_id":100020901,"comment_content":"学习了","like_count":1},{"had_liked":false,"id":42275,"user_name":"Sch0ng","can_delete":false,"product_type":"c1","uid":1145554,"ip_address":"","ucode":"73F6113931B1AC","user_header":"https://static001.geekbang.org/account/avatar/00/11/7a/d2/4ba67c0c.jpg","comment_is_top":false,"comment_ctime":1542936510,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5837903806","product_id":100020901,"comment_content":"眨眼间留言这么多了，赞","like_count":1},{"had_liked":false,"id":42261,"user_name":"钟悠","can_delete":false,"product_type":"c1","uid":1114612,"ip_address":"","ucode":"5AF2CAE1737927","user_header":"https://static001.geekbang.org/account/avatar/00/11/01/f4/3dc9bcce.jpg","comment_is_top":false,"comment_ctime":1542936126,"is_pvip":true,"replies":[{"id":"15239","content":"为什么要乘呢？😓","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542981445,"ip_address":"","comment_id":42261,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5837903422","product_id":100020901,"comment_content":"有个问题不太懂，为什么平均负载值乘以CPU核数不是一个整数呢","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430028,"discussion_content":"为什么要乘呢？😓","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542981445,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42196,"user_name":"ninuxer","can_delete":false,"product_type":"c1","uid":1243135,"ip_address":"","ucode":"5394ADAF2667D6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132","comment_is_top":false,"comment_ctime":1542933399,"is_pvip":false,"replies":[{"id":"15249","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542982192,"ip_address":"","comment_id":42196,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5837900695","product_id":100020901,"comment_content":"打卡，day3，算是笔记吧<br>uptime的平均负载，并不是所有情况下都等于cpu使用率。<br>平均负载的值，取决于系统上处于R状态（running加runnable）和D状态（不可中断睡眠，也就是等待io完成的进程）的个数之和在指定时间段内的平均值。<br>所以如果进程的cpu利用率高，会造成平均负载高；主要被cpu调度进行处理的进程数量多，也会造成平均负载高；io效率低，同样会造成平均负载高。<br>工具：stress可对系统做压力测试，mpstat可查看多个cpu使用情况，pidstat可以查看进程资源占用情况。","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430008,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542982192,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42108,"user_name":"Linux云计算网络","can_delete":false,"product_type":"c1","uid":1114062,"ip_address":"","ucode":"8E1F8B049D3C95","user_header":"https://static001.geekbang.org/account/avatar/00/10/ff/ce/73ee54bf.jpg","comment_is_top":false,"comment_ctime":1542928457,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5837895753","product_id":100020901,"comment_content":"清晰","like_count":1},{"had_liked":false,"id":360574,"user_name":"zwm","can_delete":false,"product_type":"c1","uid":1787187,"ip_address":"山东","ucode":"BDF98B3A1CD406","user_header":"https://static001.geekbang.org/account/avatar/00/1b/45/33/cdea4bca.jpg","comment_is_top":false,"comment_ctime":1666667062,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1666667062","product_id":100020901,"comment_content":"day2","like_count":0},{"had_liked":false,"id":358623,"user_name":"l","can_delete":false,"product_type":"c1","uid":2862009,"ip_address":"广东","ucode":"0254DCB6FA8453","user_header":"https://static001.geekbang.org/account/avatar/00/2b/ab/b9/66baffb9.jpg","comment_is_top":false,"comment_ctime":1664500787,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1664500787","product_id":100020901,"comment_content":"老师 我们项目后端服务每个服务部署一个pod 这个pod 也只有一个服务 那这种情况下的分析方法和你介绍的还有什么不同吗？这个pod 只有这个进程 ","like_count":0},{"had_liked":false,"id":357567,"user_name":"刘剑波","can_delete":false,"product_type":"c1","uid":1300550,"ip_address":"四川","ucode":"BD2D6249455633","user_header":"https://static001.geekbang.org/account/avatar/00/13/d8/46/9bfd1bf2.jpg","comment_is_top":false,"comment_ctime":1663402865,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1663402865","product_id":100020901,"comment_content":"通过stress进行IO加压，通过mpstat查看发现还是CPU占用率上去了，iowait还是0，是因为我在虚拟机里的原因吗？","like_count":0},{"had_liked":false,"id":354794,"user_name":"阿昌","can_delete":false,"product_type":"c1","uid":2587479,"ip_address":"广东","ucode":"C7AF1905B72AD3","user_header":"https://static001.geekbang.org/account/avatar/00/27/7b/57/e9b3d886.jpg","comment_is_top":false,"comment_ctime":1660790457,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1660790457","product_id":100020901,"comment_content":"老师，我这里有个问题，在逻辑CPU为1的情况下，对于I&#47;O密集型负载，CPU的ide值很高，如果此时有其它新进程进来，空闲的CPU也会从等待I&#47;O进程中切换到新进程中执行，由于等待I&#47;O进程是不可中断的，此时是否可以理解为CPU将等待I&#47;O进程放到了待运行的队列中？","like_count":0},{"had_liked":false,"id":351321,"user_name":"飞龙","can_delete":false,"product_type":"c1","uid":2276763,"ip_address":"","ucode":"EC83FE73985491","user_header":"https://static001.geekbang.org/account/avatar/00/22/bd/9b/366bb87b.jpg","comment_is_top":false,"comment_ctime":1657698738,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1657698738","product_id":100020901,"comment_content":"现在一般都有监控，像WEB，基本看最近几天的负载曲线，有波峰，看持续时长，一般我们按CPU核数的80%进行负载评估，例如 8 核 那么负载点就是8 * 0.8 = 6.4 如果长时间都高于这个值 会考虑增加服务器。当然增加之前是有进行一些参数的优化和调优。","like_count":0},{"had_liked":false,"id":350783,"user_name":"Geek_f93234","can_delete":false,"product_type":"c1","uid":1769504,"ip_address":"","ucode":"1E5DC903A5429E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJGXndj5N66z9BL1ic9GibZzWWgoVeWaWTL2XUnCYic7iba2kAEvN9WfjmlXELD5lqt8IJ1P023N5ZWicg/132","comment_is_top":false,"comment_ctime":1657188323,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1657188323","product_id":100020901,"comment_content":"day2","like_count":0},{"had_liked":false,"id":349691,"user_name":"有原","can_delete":false,"product_type":"c1","uid":2927617,"ip_address":"","ucode":"BA2B4911E66EDB","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/wFFLMkicZicdsG0H4oETYokjdZvg9kzhbU31KGRDBNDc1cDZPa8tnOz0D9TNAibia4wLkLObnAGhvhksKsRibZnSKXA/132","comment_is_top":false,"comment_ctime":1656230504,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1656230504","product_id":100020901,"comment_content":"平均负载即平均活跃进程数，由于包含了等待CPU以及I&#47;O的进程所以不能与CPU使用率画等号。<br>常用命令：mpstat查看CPU情况，pidstat查看进程情况。","like_count":0},{"had_liked":false,"id":348642,"user_name":"～","can_delete":false,"product_type":"c1","uid":2157116,"ip_address":"","ucode":"3785BA8C337D88","user_header":"https://static001.geekbang.org/account/avatar/00/20/ea/3c/83d8ddc1.jpg","comment_is_top":false,"comment_ctime":1655274921,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1655274921","product_id":100020901,"comment_content":"stress后，负载一直没有变高","like_count":0},{"had_liked":false,"id":347547,"user_name":"一默","can_delete":false,"product_type":"c1","uid":1163974,"ip_address":"","ucode":"F23A6E42DFD0C4","user_header":"https://static001.geekbang.org/account/avatar/00/11/c2/c6/88d0c7b2.jpg","comment_is_top":false,"comment_ctime":1654142185,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1654142185","product_id":100020901,"comment_content":"个人总结记录：<br>1. 观察系统负载可以通过uptime命令<br>2. 平均负载包括两个方面：cpu使用率过高和I&#47;O过高，换个说法就是进程数过多。","like_count":0},{"had_liked":false,"id":344322,"user_name":"liguoqing","can_delete":false,"product_type":"c1","uid":2275713,"ip_address":"","ucode":"5CBA4A34E84BFA","user_header":"https://static001.geekbang.org/account/avatar/00/22/b9/81/1b113543.jpg","comment_is_top":false,"comment_ctime":1651468027,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1651468027","product_id":100020901,"comment_content":"倪老师，你好！通过pidstat抓到相应的进程后，如何进一步排查这个进程呢？即到底是该进程的哪个线程或哪些线程对平均负载贡献最大？然后再进一步具体排查这些线程？","like_count":0},{"had_liked":false,"id":342360,"user_name":"安静","can_delete":false,"product_type":"c1","uid":1212634,"ip_address":"","ucode":"7C4DB6D81A48EB","user_header":"https://static001.geekbang.org/account/avatar/00/12/80/da/9c0c458c.jpg","comment_is_top":false,"comment_ctime":1650206543,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1650206543","product_id":100020901,"comment_content":" 这篇文章讲清楚了cpu利用率和cpu负载","like_count":0},{"had_liked":false,"id":341657,"user_name":"牧儿","can_delete":false,"product_type":"c1","uid":1251148,"ip_address":"","ucode":"DF72C2E3E5FC43","user_header":"https://static001.geekbang.org/account/avatar/00/13/17/4c/a32ef7d6.jpg","comment_is_top":false,"comment_ctime":1649754255,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1649754255","product_id":100020901,"comment_content":"老师，案例中的 cpu 使用率指的是整体的 cpu 使用率 1 - idle，还是单单用户态的 cpu 使用率呢？如果是整体的 cpu 使用率，平均负载是与 cpu 使用率一致的吧，因为 磁盘 io 等待的情况，只是 usr% 没有升高，但 iowait% 一样升高了呀。","like_count":0,"discussions":[{"author":{"id":1111620,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f6/44/af862cf8.jpg","nickname":"linbo","note":"","ucode":"2E230245E24F5B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573347,"discussion_content":"有同样的疑问，感觉这里说的CPU利用率是 sys usr的利用率","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653374087,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":340741,"user_name":"Bourne","can_delete":false,"product_type":"c1","uid":1336961,"ip_address":"","ucode":"084F65C80A45B6","user_header":"https://static001.geekbang.org/account/avatar/00/14/66/81/f48769da.jpg","comment_is_top":false,"comment_ctime":1649089150,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1649089150","product_id":100020901,"comment_content":"倪老师，问一个真实的线上案例，现在在运行发线上服务采用K8S部署的， 一个节点的资源是4C8G配置，服务器采用Java多线程（线程200+个），整体CPU使用率不到14%，接近86%的CPU是idl的，但是服务器的整体负载达到了8，用vmstat查看上下文切换在25w到30w之间，个人怀疑是由于多线程引起的平均负载高的情况，但是用sysbench模拟了多线程造成的平均负载升高的情况伴随而来的是CPU的sys时间升高（8C16G用sysbench模拟，CPU有84%的sys），这种情况下该怎么分析呢","like_count":0,"discussions":[{"author":{"id":2587479,"avatar":"https://static001.geekbang.org/account/avatar/00/27/7b/57/e9b3d886.jpg","nickname":"阿昌","note":"","ucode":"C7AF1905B72AD3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584382,"discussion_content":"你好，哥们，按文章三种情况，我觉得可能是第二种或者第三种，你按第二种和第三种的方法排查试试。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660796875,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":338793,"user_name":"渣渣","can_delete":false,"product_type":"c1","uid":1090247,"ip_address":"","ucode":"9261FB323141C0","user_header":"https://static001.geekbang.org/account/avatar/00/10/a2/c7/bb7d43a2.jpg","comment_is_top":false,"comment_ctime":1647743635,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1647743635","product_id":100020901,"comment_content":"平均负载提供了一个快速查看系统整体性能的手段，反映了整体的负载情况。但只看平均负载本身，我们并不能直接发现，到底是哪里出现了瓶颈。所以，在理解平均负载时，也要注意：<br>平均负载高有可能是 CPU 密集型进程导致的；<br>平均负载高并不一定代表 CPU 使用率高，还有可能是 I&#47;O 更繁忙了；<br>当发现负载高的时候，你可以使用 mpstat、pidstat 等工具，辅助分析负载的来源。","like_count":0},{"had_liked":false,"id":335923,"user_name":"巫师小佛","can_delete":false,"product_type":"c1","uid":2897626,"ip_address":"","ucode":"0B1AA80B245D60","user_header":"https://static001.geekbang.org/account/avatar/00/2c/36/da/2cad53ed.jpg","comment_is_top":false,"comment_ctime":1645771890,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1645771890","product_id":100020901,"comment_content":"目前我的排查思路如下<br>1.top查看是否有进程占用大量CPU<br>2.pidstat -d 查看是哪个进程占用读写高<br>3.kill  掉占用系统比较大的进程，再次查看平均负载是否下降","like_count":0},{"had_liked":false,"id":335843,"user_name":"i_chase","can_delete":false,"product_type":"c1","uid":1795511,"ip_address":"","ucode":"09C41C863F4EA3","user_header":"https://static001.geekbang.org/account/avatar/00/1b/65/b7/058276dc.jpg","comment_is_top":false,"comment_ctime":1645716021,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1645716021","product_id":100020901,"comment_content":"D状态的进程实际占用cpu吗","like_count":0},{"had_liked":false,"id":334599,"user_name":"嘿！别来无恙","can_delete":false,"product_type":"c1","uid":2055259,"ip_address":"","ucode":"B4D03784537D87","user_header":"https://static001.geekbang.org/account/avatar/00/1f/5c/5b/d0cd7d0d.jpg","comment_is_top":false,"comment_ctime":1645013340,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1645013340","product_id":100020901,"comment_content":"比如，当一个进程向磁盘读写数据时，为了保证数据的一致性，在得到磁盘回复前，它是不能被其他进程或者中断打断的，这个时候的进程就处于不可中断状态。如果此时的进程被打断了，就容易出现磁盘数据与进程数据不一致的问题。<br><br>比如我 kill掉这个进程可以吗？会触发保护机制么","like_count":0},{"had_liked":false,"id":332082,"user_name":"智者夏末","can_delete":false,"product_type":"c1","uid":2598358,"ip_address":"","ucode":"0CFAB842980A93","user_header":"https://static001.geekbang.org/account/avatar/00/27/a5/d6/41967892.jpg","comment_is_top":false,"comment_ctime":1643008875,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1643008875","product_id":100020901,"comment_content":"听完这堂课，并且跟着实践操作这堂课中涉及的命令，在结合介绍与讲解，虽然不能给别人完全讲解明白“平均负载”但是自我是已经理解，感谢！<br>涉及的问题是iowait无法升高，已经在置顶区看到原因，赞","like_count":0},{"had_liked":false,"id":330140,"user_name":"Geek_6bb688","can_delete":false,"product_type":"c1","uid":1468464,"ip_address":"","ucode":"5B36B8DC5F524B","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJeUmrVJiaiasCMpK7poias9eicibhXoSWf3jibCC3ECcsk6koLkyV0XqHh1CJibbC5cvbqriaTJHWxDfsicOA/132","comment_is_top":false,"comment_ctime":1641811539,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1641811539","product_id":100020901,"comment_content":"top 查看的load average 很高十几二十, cpu使用率跟iowait都没打满。请问这种情况是什么原因啊","like_count":0},{"had_liked":false,"id":323630,"user_name":"🍀柠檬鱼也是鱼","can_delete":false,"product_type":"c1","uid":2178501,"ip_address":"","ucode":"DCF033636465F3","user_header":"https://static001.geekbang.org/account/avatar/00/21/3d/c5/f43fa619.jpg","comment_is_top":false,"comment_ctime":1638031940,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638031940","product_id":100020901,"comment_content":"学习了","like_count":0},{"had_liked":false,"id":322872,"user_name":"gecko","can_delete":false,"product_type":"c1","uid":1198048,"ip_address":"","ucode":"2B7122536F1A0E","user_header":"https://static001.geekbang.org/account/avatar/00/12/47/e0/1ff26e99.jpg","comment_is_top":false,"comment_ctime":1637638904,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637638904","product_id":100020901,"comment_content":"root@yd:~# cat &#47;etc&#47;issue<br>Ubuntu 18.04.6 LTS \\n \\l<br><br><br>apt install stress sysstat -y","like_count":0},{"had_liked":false,"id":322554,"user_name":"Geek_ba858b","can_delete":false,"product_type":"c1","uid":2355716,"ip_address":"","ucode":"CFEB8735A51FA5","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEIIYg7VSvQrLAvnEcuuG6AuvXSEsciceoBlDfBrdnD8dKPmfX79b70ichdv9TtXbpJAe0HjicFOtVibAQ/132","comment_is_top":false,"comment_ctime":1637481002,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637481002","product_id":100020901,"comment_content":"场景三 用的命令是stress -c 8(cpu密集计算），为什么pidstat看到的是io非常高，而cpu只有25%？","like_count":0},{"had_liked":false,"id":321637,"user_name":"janey","can_delete":false,"product_type":"c1","uid":1619748,"ip_address":"","ucode":"B2160B363F23EB","user_header":"https://static001.geekbang.org/account/avatar/00/18/b7/24/17f6c240.jpg","comment_is_top":false,"comment_ctime":1636970540,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636970540","product_id":100020901,"comment_content":"说是单位时间的平均进程数，不应该是这样：平均2秒有10个进程在跑。这样吗？为啥又变成CPU的负载了？没明白","like_count":0},{"had_liked":false,"id":320620,"user_name":"rubys_","can_delete":false,"product_type":"c1","uid":1394115,"ip_address":"","ucode":"931AD02864126A","user_header":"https://static001.geekbang.org/account/avatar/00/15/45/c3/051ffe83.jpg","comment_is_top":false,"comment_ctime":1636425509,"is_pvip":true,"discussion_count":0,"race_medal":5,"score":"1636425509","product_id":100020901,"comment_content":"写给后面的朋友，文中的案例可以用 docker 来进行测试，镜像使用 ubuntu:18.04，docker pull ubuntu18.04。然后使用 docker run -it --cpuset-cpus=&quot;0&quot; --name=ub --privileged ubuntu:18.04 bash 启动一个容器，这个命令只使用一个核，--privileged 可以让我们在容器里面使用 strace 命令，我们可以通过 strace 看到 io 升高时候执行的系统调用，这样会更容易理解。<br><br>另外，启动容器之后，执行下面几个命令：<br>sed -i &#39;s&#47;archive.ubuntu.com&#47;mirrors.ustc.edu.cn&#47;g&#39; &#47;etc&#47;apt&#47;sources.list &#47;&#47; 换中科大源<br>apt update<br>apt install stress sysstat strace<br>安装 strace 的目的是在模拟 io 高的案例里面查看具体的系统调用，具体使用方式是 strace -p 123，123 替换为实际的进程 id 即可。","like_count":0},{"had_liked":false,"id":320462,"user_name":"琥 珀","can_delete":false,"product_type":"c1","uid":2412628,"ip_address":"","ucode":"B06A9CFA0A0269","user_header":"https://static001.geekbang.org/account/avatar/00/24/d0/54/9230c283.jpg","comment_is_top":false,"comment_ctime":1636342388,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636342388","product_id":100020901,"comment_content":"pidstat -u 5 1中的%CPU占用100，是不是并不等于CPU的使用率达到了100%，我有一个开发环境，发现mpstat中该核的CPU一半都是idle状态，usr和sys的百分比都是25%左右。这种情况应该怎么理解呢？这个进程独占了CPU？","like_count":0},{"had_liked":false,"id":319880,"user_name":"Geek_23f5cd","can_delete":false,"product_type":"c1","uid":2822229,"ip_address":"","ucode":"2664290699EDF4","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/CIzDwjaD04WSnxX4PuqKywro6pl957aupj5icyY2zF60IVfyJQzmqrT1ROc4cBaroYSzaOIuey2ibPiabPNNHMmrw/132","comment_is_top":false,"comment_ctime":1635996275,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635996275","product_id":100020901,"comment_content":"老师，我是Centos7的操作系统，跑第二个场景的时候最大的平均负载会超过3，这是什么原因？？<br><br>11时23分20秒   UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command<br>11时23分25秒     0         6    0.00    0.80    0.00    2.40    0.80     0  ksoftirqd&#47;0<br>11时23分25秒     0         9    0.00    0.60    0.00   13.37    0.60     1  rcu_sched<br>11时23分25秒     0        14    0.00    1.20    0.00    2.20    1.20     1  ksoftirqd&#47;1<br>11时23分25秒     0       717    0.40    0.60    0.00    1.40    1.00     0  vmtoolsd<br>11时23分25秒     0     10063    0.00    1.80    0.00    2.20    1.80     0  kworker&#47;0:0<br>11时23分25秒     0     10402    0.00    2.00    0.00    2.40    2.00     1  kworker&#47;1:1<br>11时23分25秒     0     12779    0.00   68.26    0.00    3.59   68.26     0  kworker&#47;u256:0<br>11时23分25秒     0     12916    0.60   66.47    0.00    2.00   67.07     1  stress-ng-hdd<br>11时23分25秒     0     12917    0.00    6.19    0.00    1.80    6.19     0  stress-ng-io<br>11时23分25秒     0     12919    0.00    0.20    0.00    0.20    0.20     0  watch<br>","like_count":0},{"had_liked":false,"id":317669,"user_name":"","can_delete":false,"product_type":"c1","uid":2095026,"ip_address":"","ucode":"79DB151C0BFC63","user_header":"https://static001.geekbang.org/account/avatar/00/1f/f7/b2/b9d2d7d8.jpg","comment_is_top":false,"comment_ctime":1634886792,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634886792","product_id":100020901,"comment_content":"平均负载是指单位时间内，系统处于可运行状态和不可中断状态的平均进程数，也就是平均活跃进程数，它和 CPU 使用率并没有直接关系。<br>$ uptime<br>02:34:03 up 2 days, 20:14,  1 user,  load average: 0.63, 0.83, 0.88<br><br><br>02:34:03 &#47;&#47;当前时间up 2 days, 20:14 &#47;&#47;系统运行时间1 user &#47;&#47;正在登录用户数<br>最后三个数字依次则是过去 1 分钟、5 分钟、15 分钟的平均负载（Load Average）<br>可运行状态：指正在使用 CPU 或者正在等待 CPU 的进程，也就是我们常用 ps 命令看到的，处于 R 状态（Running 或 Runnable）的进程。<br>不可中断状态：不可中断状态的进程则是正处于内核态关键流程中的进程，并且这些流程是不可打断的，比如最常见的是等待硬件设备的 I&#47;O 响应，也就是我们在 ps 命令中看到的 D 状态（Uninterruptible Sleep，也称为 Disk Sleep）的进程<br><br><br>平均负载为多少时合理<br>首先查看机器的CPU核数，如果超过CPU核数即为过载。查看系统平均负载需要参考三个时间段的数据判断。<br>一般来说，当平均负载高于 CPU 数量 70% 的时候，你就应该分析排查负载高的问题了。<br><br><br><br>平均负载高。使用率一定高吗<br>不一定，使用率表示单位时间内 CPU 繁忙情况的统计，并不一定与平均负载一一对应。<br>平均负载是指单位时间内，处于可运行状态和不可中断状态的进程数。所以，它不仅包括了正在使用 CPU 的进程，还包括等待 CPU 和等待 I&#47;O 的进程。<br><br><br><br>CPU 密集型进程，使用大量 CPU 会导致平均负载升高，此时这两者是一致的；<br><br>I&#47;O 密集型进程，等待 I&#47;O 也会导致平均负载升高，但 CPU 使用率不一定很高；<br>大量等待 CPU 的进程调度也会导致平均负载升高，此时的 CPU 使用率也会比较高。当系统中运行进程超出 CPU 运行能力时，就会出现等待 CPU 的进程<br><br><br><br><br><br>mpstat 是一个常用的多核 CPU 性能分析工具，用来实时查看每个 CPU 的性能指标，以及所有 CPU 的平均指标。<br><br>pidstat 是一个常用的进程性能分析工具，用来实时查看进程的 CPU、内存、I&#47;O 以及上下文切换等性能指标。<br><br><br><br>实操<br>一、终端运行 uptime 查看平均负载的变化情况<br><br># -d 参数表示高亮显示变化的区域$ watch -d uptime..., load average: 1.00, 0.75, 0.39<br>二、终端运行 mpstat 查看 CPU 使用率的变化情况：<br><br># -P ALL 表示监控所有CPU，后面数字5表示间隔5秒后输出一组数据<br>$ mpstat -P ALL 5<br>Linux 4.15.0 (ubuntu) 09&#47;22&#47;18 _x86_64_ (2 CPU)<br>13:30:06     CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>13:30:11     all   50.05    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00   49.95<br>13:30:11       0    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00<br>13:30:11       1  100.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00<br>三、pidstat 来查询具体的进程<br><br># 间隔5秒后输出一组数据，-u表示CPU指标<br>$ pidstat -u 5 1<br>Linux 4.15.0 (ubuntu)     09&#47;22&#47;18     _x86_64_    (2 CPU)<br>13:42:08      UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command<br>13:42:13        0       104    0.00    3.39    0.00    0.00    3.39     1  kworker&#47;1:1H<br>13:42:13        0       109    0.00    0.40    0.00    0.00    0.40     0  kworker&#47;0<br>","like_count":0},{"had_liked":false,"id":316746,"user_name":"陌生","can_delete":false,"product_type":"c1","uid":2677687,"ip_address":"","ucode":"3F1A6CA63F4AC2","user_header":"https://static001.geekbang.org/account/avatar/00/28/db/b7/2c7b142d.jpg","comment_is_top":false,"comment_ctime":1634538902,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634538902","product_id":100020901,"comment_content":"我的理解就是，cpu负载反应的是需要使用cpu的进程队列长度（正在执行和等待执行），cpu利用率反应的是单位时间内cpu被占用的时间比","like_count":0},{"had_liked":false,"id":316103,"user_name":"清水","can_delete":false,"product_type":"c1","uid":2559543,"ip_address":"","ucode":"D25F83AA62FD70","user_header":"","comment_is_top":false,"comment_ctime":1634136245,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634136245","product_id":100020901,"comment_content":"在只有 2 个 CPU 的系统上，意味着所有的 CPU 都刚好被完全占用。<br>在 4 个 CPU 的系统上，意味着 CPU 有 50% 的空闲。<br>而在只有 1 个 CPU 的系统中，则意味着有一半的进程竞争不到 CPU。<br><br>老师，这个是针对主机的，如果是docker，应用只占主机部分核数，也是这样计算吗？","like_count":0},{"had_liked":false,"id":315778,"user_name":"robonix","can_delete":false,"product_type":"c1","uid":1212323,"ip_address":"","ucode":"866EC82EDA455B","user_header":"https://static001.geekbang.org/account/avatar/00/12/7f/a3/23540579.jpg","comment_is_top":false,"comment_ctime":1633998560,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633998560","product_id":100020901,"comment_content":"老师，在一些类Unix系统比如QNX上有这样的分析工具吗？","like_count":0},{"had_liked":false,"id":315045,"user_name":"liubiqianmoney","can_delete":false,"product_type":"c1","uid":1110679,"ip_address":"","ucode":"E5EAD53FEA01E1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJZicRP0FZ78kT68wEGeWzPnxrF4s3Ea36XdMA2pj2TAbU3eibVt7KqzS5B7LbWMhRfSc3XEUL3Hrjw/132","comment_is_top":false,"comment_ctime":1633670290,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1633670290","product_id":100020901,"comment_content":"IO密集型包括网络IO吗？如果A进程通过网络请求B进程时，B进程发送的TCP ACK和SYN太慢，或TC P链接建立后B进程发送数据太慢，会导致A进程发起此请求的线程属于D状态和R状态吗？","like_count":0},{"had_liked":false,"id":314633,"user_name":"清水","can_delete":false,"product_type":"c1","uid":2559543,"ip_address":"","ucode":"D25F83AA62FD70","user_header":"","comment_is_top":false,"comment_ctime":1633268014,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633268014","product_id":100020901,"comment_content":"场景二和场景三使用不同的命令，一个是iowait%，一个是wait%，两个指标是不一样的吗？wait%并不是iowait？","like_count":0},{"had_liked":false,"id":313369,"user_name":"时不我待","can_delete":false,"product_type":"c1","uid":2778842,"ip_address":"","ucode":"6556E24AC47BBF","user_header":"https://static001.geekbang.org/account/avatar/00/2a/66/da/380b8f00.jpg","comment_is_top":false,"comment_ctime":1632395725,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632395725","product_id":100020901,"comment_content":"平均负载反映的是cpu的繁忙程度，可能是程序消耗、io、程序多等问题导致。<br><br>监测负载：uptime；   进一步判断：mpstat（查看cpu使用情况）、pidstat（进程使用cpu情况）","like_count":0},{"had_liked":false,"id":307589,"user_name":"宏典","can_delete":false,"product_type":"c1","uid":2616028,"ip_address":"","ucode":"63953F36596C28","user_header":"https://static001.geekbang.org/account/avatar/00/27/ea/dc/aa699264.jpg","comment_is_top":false,"comment_ctime":1629167011,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1629167011","product_id":100020901,"comment_content":"不可中断状态的进程则是正处于内核态关键流程中的进程，并且这些流程是不可打断的，比如最常见的是等待硬件设备的 I&#47;O 响应，也就是我们在 ps 命令中看到的 D 状态（Uninterruptible Sleep，也称为 Disk Sleep）的进程。<br><br>对于这段话不太理解。<br>D状态的进程不是已经是sleep状态，让出cpu的状态吗？<br>这里的不可中断是什么意思？","like_count":0},{"had_liked":false,"id":307399,"user_name":"Apollo","can_delete":false,"product_type":"c1","uid":1183821,"ip_address":"","ucode":"3A0C79CCB21FD9","user_header":"https://static001.geekbang.org/account/avatar/00/12/10/4d/f548bc68.jpg","comment_is_top":false,"comment_ctime":1629083440,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629083440","product_id":100020901,"comment_content":"单位时间内，系统中处于可运行状态和不可中断状态的平均进程数。 <br>这里单位时间是指1s么？","like_count":0},{"had_liked":false,"id":306272,"user_name":"iq2wh","can_delete":false,"product_type":"c1","uid":1054546,"ip_address":"","ucode":"B2C894ED48B2EF","user_header":"https://static001.geekbang.org/account/avatar/00/10/17/52/8e72876e.jpg","comment_is_top":false,"comment_ctime":1628481384,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628481384","product_id":100020901,"comment_content":"倪老师 请教一下 既然平均负载是&quot;单位时间内的活跃进程数&quot;，那为什么 CPU 使用率高 和 iowait 高 会导致负载变高？","like_count":0},{"had_liked":false,"id":303732,"user_name":"凯文小猪","can_delete":false,"product_type":"c1","uid":1980201,"ip_address":"","ucode":"36D8AD0229547F","user_header":"https://static001.geekbang.org/account/avatar/00/1e/37/29/b3af57a7.jpg","comment_is_top":false,"comment_ctime":1626948237,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1626948237","product_id":100020901,"comment_content":"提示一下 centos目前普通使用stress-ng  。这个包可以使用源码或rpm安装 且stress-ng做到了指令向下兼容","like_count":0},{"had_liked":false,"id":302355,"user_name":"冬天里的懒猫","can_delete":false,"product_type":"c1","uid":1042458,"ip_address":"","ucode":"970E5CEF502828","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e8/1a/cea701bb.jpg","comment_is_top":false,"comment_ctime":1626176538,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1626176538","product_id":100020901,"comment_content":"我的实验2中，得到的结果iowait并不高而是sys高。","like_count":0},{"had_liked":false,"id":297196,"user_name":"opdozz","can_delete":false,"product_type":"c1","uid":2641975,"ip_address":"","ucode":"25E81DC87D6213","user_header":"","comment_is_top":false,"comment_ctime":1623373876,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1623373876","product_id":100020901,"comment_content":"老师您好，我这边一台服务器4C20core双线程，负载会突然从10飙升到300左右，CPU利用率很低，IO也很低，也没有D进程，但是影响了业务，这个应该怎么排查","like_count":0},{"had_liked":false,"id":295282,"user_name":"Geek_79d7c1","can_delete":false,"product_type":"c1","uid":2644096,"ip_address":"","ucode":"809544988E5F09","user_header":"","comment_is_top":false,"comment_ctime":1622344700,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622344700","product_id":100020901,"comment_content":"刚刚亲手试了一下，果然亲手跑一跑命令才有收获（来自在火车上的我~）","like_count":0},{"had_liked":false,"id":294734,"user_name":"vagrancyl","can_delete":false,"product_type":"c1","uid":1110111,"ip_address":"","ucode":"DA84A627044F3C","user_header":"https://static001.geekbang.org/account/avatar/00/10/f0/5f/c234786b.jpg","comment_is_top":false,"comment_ctime":1622077759,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622077759","product_id":100020901,"comment_content":"请问这里说的不可中断io包括网络io吗？","like_count":0},{"had_liked":false,"id":293895,"user_name":"Make More Time","can_delete":false,"product_type":"c1","uid":1486157,"ip_address":"","ucode":"0EA908D497AD54","user_header":"https://static001.geekbang.org/account/avatar/00/16/ad/4d/e3345713.jpg","comment_is_top":false,"comment_ctime":1621589903,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621589903","product_id":100020901,"comment_content":"用 iostat 命令看就行了，不要问我怎么知道，看老师发的图 - ）","like_count":0},{"had_liked":false,"id":292258,"user_name":"...","can_delete":false,"product_type":"c1","uid":1242046,"ip_address":"","ucode":"C1FA35C921387C","user_header":"https://static001.geekbang.org/account/avatar/00/12/f3/be/97dd695b.jpg","comment_is_top":false,"comment_ctime":1620743483,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1620743483","product_id":100020901,"comment_content":"有个小白问题请教一下，平均负载为什么是平均活跃进程数，而不是活跃线程数呢？","like_count":0},{"had_liked":false,"id":292091,"user_name":"疯人","can_delete":false,"product_type":"c1","uid":1586002,"ip_address":"","ucode":"D1B28ED5FFE9A9","user_header":"https://static001.geekbang.org/account/avatar/00/18/33/52/77516e4c.jpg","comment_is_top":false,"comment_ctime":1620687635,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1620687635","product_id":100020901,"comment_content":"作者你好，案例2，我的虚拟机是sy高，而不是wa高，这什么原因哦？","like_count":0},{"had_liked":false,"id":290390,"user_name":"此心如水只東流","can_delete":false,"product_type":"c1","uid":1899289,"ip_address":"","ucode":"4CE691624B3028","user_header":"https://static001.geekbang.org/account/avatar/00/1c/fb/19/583cd804.jpg","comment_is_top":false,"comment_ctime":1619523246,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1619523246","product_id":100020901,"comment_content":"请教老师一个困扰我多日的问题，现象如下：<br>1、应用是邮件系统<br>2、top看到CPU负载是CPU个数的几倍；用户和系统CPU使用率低，wait高达99%，内存free有剩余<br>3、iostat查看iowait高达99%，util为100%，但是读写却是为0。<br>根据以上分析，我认为是磁盘io问题，但是即便是磁盘io性能满了，iostat显示的读写也不会是0，矛盾点在读写为0，而iowait和util为100%。<br>我分析不到原因，我初步的想法通过申请更换成SSD磁盘观察看能否解决，但这找不到问题的原因。<br>请教老师根据您的经验，能否给个思路，我沿着老师的思路排查！","like_count":0,"discussions":[{"author":{"id":1899289,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/fb/19/583cd804.jpg","nickname":"此心如水只東流","note":"","ucode":"4CE691624B3028","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385369,"discussion_content":"已定位，是存储问题。\n解决办法：将虚拟机迁移到其他存储运行。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627018757,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":289839,"user_name":"梦倚栏杆","can_delete":false,"product_type":"c1","uid":1095857,"ip_address":"","ucode":"BDEB97F2822445","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/bvj76PmeUvW8kokyu91IZWuRATKmabibDWbzAj2TajeEic7WvKCJOLaOh6jibEmdQ36EO3sBUZ0HibAiapsrZo64U8w/132","comment_is_top":false,"comment_ctime":1619223393,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619223393","product_id":100020901,"comment_content":"单位时间怎么理解？因为看到负载都是小数，时间单位的计量单位肯定很小","like_count":0},{"had_liked":false,"id":287590,"user_name":"清水","can_delete":false,"product_type":"c1","uid":2559543,"ip_address":"","ucode":"D25F83AA62FD70","user_header":"","comment_is_top":false,"comment_ctime":1618041507,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618041507","product_id":100020901,"comment_content":"第二个例子，pidstat查看那个线程导致iowait不行，我的都很低（mpstat iowait是100%），是不是用iotop -oP<br><br>命令的含义：只显示有I&#47;O行为的进程 这个命令看那个频繁写<br>或者是pidstat -d 来看延迟？","like_count":0},{"had_liked":false,"id":287536,"user_name":"清水","can_delete":false,"product_type":"c1","uid":2559543,"ip_address":"","ucode":"D25F83AA62FD70","user_header":"","comment_is_top":false,"comment_ctime":1618019320,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618019320","product_id":100020901,"comment_content":"我的好奇怪，第二个场景，我还是cpu高，iowait并不是很高？难道是我服务是8C16G的原因？但是我也扩大了stress -i 5 --timeout 600","like_count":0},{"had_liked":false,"id":287381,"user_name":"睡着了去做梦","can_delete":false,"product_type":"c1","uid":1171280,"ip_address":"","ucode":"1B553D695BC70D","user_header":"https://static001.geekbang.org/account/avatar/00/11/df/50/ed811610.jpg","comment_is_top":false,"comment_ctime":1617923376,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617923376","product_id":100020901,"comment_content":"场景中第三个例子，为什么进程8个，比cpu2个多会发生抢占导致负载升高，平常使用系统运行的进程也远不止8个？","like_count":0},{"had_liked":false,"id":286979,"user_name":"schwarzeni","can_delete":false,"product_type":"c1","uid":1112540,"ip_address":"","ucode":"C1969191F334BD","user_header":"https://static001.geekbang.org/account/avatar/00/10/f9/dc/0a1eeb4c.jpg","comment_is_top":false,"comment_ctime":1617712314,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617712314","product_id":100020901,"comment_content":"今天面试的时候被问到系统负载的问题了，由于这个专栏是两年多前看的，没有复习导致忘记了，没答上来。。太懊恼了","like_count":0},{"had_liked":false,"id":286229,"user_name":"小猫熊超酷的","can_delete":false,"product_type":"c1","uid":2543077,"ip_address":"","ucode":"1DE9E31DFADCFE","user_header":"https://static001.geekbang.org/account/avatar/00/26/cd/e5/a9366b96.jpg","comment_is_top":false,"comment_ctime":1617202213,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617202213","product_id":100020901,"comment_content":"倪老师你好, 我通过grep &#39;model name&#39; &#47;proc&#47;cpuinfo | wc -l命令读到是4核<br>为什么我uptime出来是100左右呢? 通过top看到的CPU不高","like_count":0},{"had_liked":false,"id":286055,"user_name":"静水深流","can_delete":false,"product_type":"c1","uid":1304052,"ip_address":"","ucode":"AEA93B568BD293","user_header":"https://static001.geekbang.org/account/avatar/00/13/e5/f4/073a66f8.jpg","comment_is_top":false,"comment_ctime":1617124116,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617124116","product_id":100020901,"comment_content":"才99块钱 花的值","like_count":0},{"had_liked":false,"id":285572,"user_name":"生锈的刀","can_delete":false,"product_type":"c1","uid":1134507,"ip_address":"","ucode":"5BFAA921863A15","user_header":"https://static001.geekbang.org/account/avatar/00/11/4f/ab/e89265d1.jpg","comment_is_top":false,"comment_ctime":1616902402,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616902402","product_id":100020901,"comment_content":"老师你好，场景三大量进程争夺有限的CPU，这种情况下我该如何优化？","like_count":0},{"had_liked":false,"id":285031,"user_name":"丁程 ‍‍","can_delete":false,"product_type":"c1","uid":1114444,"ip_address":"","ucode":"5FDC15DD9A7539","user_header":"https://static001.geekbang.org/account/avatar/00/11/01/4c/b34352e6.jpg","comment_is_top":false,"comment_ctime":1616584676,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1616584676","product_id":100020901,"comment_content":"这里我再举个例子，假设我们在一个单 CPU 系统上看到平均负载为 1.73，0.60，7.98，那么说明在过去 1 分钟内，系统有 73% 的超载，而在 15 分钟内，有 698% 的超载，从整体趋势来看，系统的负载在降低。<br><br>老师：这个是不是写错了，698% ？？","like_count":0,"discussions":[{"author":{"id":2559543,"avatar":"","nickname":"清水","note":"","ucode":"D25F83AA62FD70","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366348,"discussion_content":"老师的前提是1个cpu，本来应该是1或者100%，现在分别1.73，7.98，他们减去1就是超载的了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618040946,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":285029,"user_name":"程序员老王","can_delete":false,"product_type":"c1","uid":1025340,"ip_address":"","ucode":"28577A15F064CF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a5/3c/7c0d2e57.jpg","comment_is_top":false,"comment_ctime":1616583413,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616583413","product_id":100020901,"comment_content":"等待cpu也算负载的一种，我意味不占用cuu就不算负载了，io读写","like_count":0},{"had_liked":false,"id":285026,"user_name":"程序员老王","can_delete":false,"product_type":"c1","uid":1025340,"ip_address":"","ucode":"28577A15F064CF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a5/3c/7c0d2e57.jpg","comment_is_top":false,"comment_ctime":1616583087,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616583087","product_id":100020901,"comment_content":"System load averages is the average number of processes that are either<br>       in a runnable or uninterruptable state","like_count":0},{"had_liked":false,"id":284805,"user_name":"成都福哥","can_delete":false,"product_type":"c1","uid":1034285,"ip_address":"","ucode":"0D3C2E5FE17E6B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c8/2d/3dd499a9.jpg","comment_is_top":false,"comment_ctime":1616482545,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616482545","product_id":100020901,"comment_content":"不知道课程过去这么久，老师是否还会回答问题。 课程里老师提到<br>“I&#47;O 密集型进程，等待 I&#47;O 也会导致平均负载升高，但 CPU 使用率不一定很高；”<br>对这个陈述有点疑问：<br>1. IO密集型集成，导致平均负载升高。这个没有问题。<br>2.可是，等待IO的时间过多，也会导致wa时间过多，进而导致CPU 使用率升高。<br>可是老师为什么会说，“但 CPU 使用率不一定很高”呢？","like_count":0},{"had_liked":false,"id":283180,"user_name":"awker","can_delete":false,"product_type":"c1","uid":2002371,"ip_address":"","ucode":"BDC9C3CDB16D68","user_header":"","comment_is_top":false,"comment_ctime":1615608920,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615608920","product_id":100020901,"comment_content":"  系统负载高的排查思路：<br>1、平均负载概述：<br>单位时间内的活跃进程数。这些进程处于运行状态(R)或者不可中断状态(D)。<br>那么这些进程都在干什么会导致负载过高？正在使用CPU，或者等待CPU，或者等待I&#47;O。<br>所以排查思路从CPU使用、I&#47;O使用方面入手。<br>2、使用工具排查：<br>mpstat查看整体CPU的使用情况：包含CPU利用率，空闲率、%iowait使用情况<br>pidstat&#47;top查看进程的CPU使用情况；","like_count":0},{"had_liked":false,"id":283177,"user_name":"awker","can_delete":false,"product_type":"c1","uid":2002371,"ip_address":"","ucode":"BDC9C3CDB16D68","user_header":"","comment_is_top":false,"comment_ctime":1615608410,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615608410","product_id":100020901,"comment_content":"通过uptime查看系统负载变高，通过下述思路排查：<br>1、系统负载：单位时间内的平均活跃进程数，这些进程处于运行状态，或者不可中断中状态。这些进程可在干嘛呢？可以是正在使用CPU，或者等待CPU，或者等待I&#47;O。","like_count":0},{"had_liked":false,"id":282508,"user_name":"程序员班吉","can_delete":false,"product_type":"c1","uid":1478098,"ip_address":"","ucode":"BD48CF7649609A","user_header":"https://static001.geekbang.org/account/avatar/00/16/8d/d2/8a6be8d8.jpg","comment_is_top":false,"comment_ctime":1615284892,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615284892","product_id":100020901,"comment_content":"老师，我有个疑问，如果一台物理机上面跑了成百上千的docker容器是如何保证系统依然高效的运行。文章里说的单位时间里的平均负载这个时间是不是指的是CPU的一个时钟周期？如果是的话，是不是可以理解为CPU的平均负载其实和我们的CPU主频是相关的？","like_count":0},{"had_liked":false,"id":281900,"user_name":"Geek_392979","can_delete":false,"product_type":"c1","uid":2149562,"ip_address":"","ucode":"BE8A0B47CDF562","user_header":"","comment_is_top":false,"comment_ctime":1614938807,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614938807","product_id":100020901,"comment_content":"老师， 平均负载和top命令里的各种cpu利用率是正相关关系吗，也就是说， 平均负载高的话， 除了id, 剩下的us, sy, ni, wa, hi , si, st肯定有一项或多项是高的？ 是这样的吗？","like_count":0},{"had_liked":false,"id":279792,"user_name":"姚文","can_delete":false,"product_type":"c1","uid":1890509,"ip_address":"","ucode":"67488145C2B764","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJIHurGgpxc2EJyY3F44SXlrAriagrbqy2EobafmVSCZBGAWa8ESjUzlW0spt6noLfuNzdCZzHLkTw/132","comment_is_top":false,"comment_ctime":1613964169,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1613964169","product_id":100020901,"comment_content":"简单来说，平均负载是指单位时间内，系统处于可运行状态和不可中断状态的平均进程数，也就是平均活跃进程数 <br>=============<br>这一块load是任务数还是进程数？ ","like_count":0},{"had_liked":false,"id":277032,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1612237663,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612237663","product_id":100020901,"comment_content":"总感觉根据案例操作了，本节才学完一遍","like_count":0},{"had_liked":false,"id":277017,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1612233169,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612233169","product_id":100020901,"comment_content":"man uptime的中的解析：<br>DESCRIPTION<br>       uptime  gives  a  one  line display of the following information.  The current time, how long the system has been running, how many users are currently logged on, and the system<br>       load averages for the past 1, 5, and 15 minutes.<br><br>       This is the same information contained in the header line displayed by w(1).<br><br>       System load averages is the average number of processes that are either in a runnable or uninterruptable state.  A process in a runnable state is either using the CPU or waiting<br>       to  use  the  CPU.  A process in uninterruptable state is waiting for some I&#47;O access, eg waiting for disk.  The averages are taken over the three time intervals.  Load averages<br>       are not normalized for the number of CPUs in a system, so a load average of 1 means a single CPU system is loaded all the time while on a 4 CPU system it means it was  idle  75%<br>       of the time.<br>","like_count":0},{"had_liked":false,"id":276945,"user_name":"骆正祺","can_delete":false,"product_type":"c1","uid":2026062,"ip_address":"","ucode":"881DBB7EBA3FBE","user_header":"https://static001.geekbang.org/account/avatar/00/1e/ea/4e/2b982851.jpg","comment_is_top":false,"comment_ctime":1612186900,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1612186900","product_id":100020901,"comment_content":"平均负载高了、cpu使用率高了机器会有哪些表现","like_count":0},{"had_liked":false,"id":276884,"user_name":"蕃了个茄","can_delete":false,"product_type":"c1","uid":1600340,"ip_address":"","ucode":"90393ECFF5F0F3","user_header":"https://static001.geekbang.org/account/avatar/00/18/6b/54/04866f2e.jpg","comment_is_top":false,"comment_ctime":1612166812,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612166812","product_id":100020901,"comment_content":"老师有个问题，就是按上面的方法 stress -c 8 --timeout 600，cpu达到了100%，但是我这个时候同时压测了一个读取数据的php接口，ab -c100 -n1000 发现接口的吞吐率还算正常，难道cpu达到100%，没有影响吗，而且我测试的还是1核的服务器.","like_count":0},{"had_liked":false,"id":275931,"user_name":"水蒸蛋","can_delete":false,"product_type":"c1","uid":1809160,"ip_address":"","ucode":"6F7F853A4BF901","user_header":"https://static001.geekbang.org/account/avatar/00/1b/9b/08/27ac7ecd.jpg","comment_is_top":false,"comment_ctime":1611719440,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1611719440","product_id":100020901,"comment_content":"老师，是不是用的是windons10的ubantu系统，检测不太准<br>ubantu18.04 8C<br>执行stress --cpu 1 --timeout 600<br>uptime #没什么变化<br>mpstat -P ALL 5 #好像是被分摊了，没有cpu到100<br>pidstat -u 5 1 #能看到有一个进程cpu 100%了，这个明显<br><br><br>sudo stress -i 1 --timeout 600<br>uptime #没什么变化<br>mpstat -P ALL 5 1 #%usr会增加 %iowait都是0<br>pidstat -u 5 1 #能看到有一个进程cpu 100%了，这个明显<br><br>stress -c 8 --timeout 600<br>uptime #没什么变化<br>mpstat -P ALL 5 1 #%idle 已经全是0了<br>pidstat -u 5 1 #%usr基本打满了","like_count":0},{"had_liked":false,"id":275929,"user_name":"水蒸蛋","can_delete":false,"product_type":"c1","uid":1809160,"ip_address":"","ucode":"6F7F853A4BF901","user_header":"https://static001.geekbang.org/account/avatar/00/1b/9b/08/27ac7ecd.jpg","comment_is_top":false,"comment_ctime":1611719391,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1611719391","product_id":100020901,"comment_content":"ubantu18.04 8C<br>执行stress --cpu 1 --timeout 600<br>uptime #没什么变化<br>mpstat -P ALL 5 #好像是被分摊了，没有cpu到100<br>pidstat -u 5 1 #能看到有一个进程cpu 100%了，这个明显<br><br><br>sudo stress -i 1 --timeout 600<br>uptime #没什么变化<br>mpstat -P ALL 5 1 #%usr会增加 %iowait都是0<br>pidstat -u 5 1 #能看到有一个进程cpu 100%了，这个明显<br><br>stress -c 8 --timeout 600<br>uptime #没什么变化<br>mpstat -P ALL 5 1 #%idle 已经全是0了<br>pidstat -u 5 1 #%usr基本打满了","like_count":0},{"had_liked":false,"id":275279,"user_name":"一位不愿透漏姓名的足球名宿","can_delete":false,"product_type":"c1","uid":1244283,"ip_address":"","ucode":"2A67AD14C1F436","user_header":"https://static001.geekbang.org/account/avatar/00/12/fc/7b/adfef198.jpg","comment_is_top":false,"comment_ctime":1611421290,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1611421290","product_id":100020901,"comment_content":"不可中断进程，比如磁盘IO会占着CPU，但是可能不在使用CPU？","like_count":0},{"had_liked":false,"id":275187,"user_name":"浊清一点","can_delete":false,"product_type":"c1","uid":2367027,"ip_address":"","ucode":"93DFF004BA42C1","user_header":"https://static001.geekbang.org/account/avatar/00/24/1e/33/9a55a85f.jpg","comment_is_top":false,"comment_ctime":1611376985,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1611376985","product_id":100020901,"comment_content":"平均负载是指单位时间内，处于可运行状态和不可中断状态的进程数。<br>所以，它不仅包括了正在使用 CPU 的进程，还包括等待 CPU 和等待 I&#47;O 的进程。<br><br>而 CPU 使用率，是单位时间内 CPU 繁忙情况的统计，跟平均负载并不一定完全对应。比如：<br>CPU 密集型进程，使用大量 CPU 会导致平均负载升高，此时这两者是一致的；         ==&gt; top 按P<br>I&#47;O 密集型进程，等待 I&#47;O 也会导致平均负载升高，但 CPU 使用率不一定很高；       ==&gt; watch -n 1 &quot;(ps aux | awk &#39;\\$8 ~ &#47;D&#47;  { print \\$0 }&#39;)&quot;<br>大量等待 CPU 的进程调度也会导致平均负载升高，此时的 CPU 使用率也会比较高。  ==&gt; 这个还没想到怎么监控或定位? 有知道好的工具的小伙伴望共享下 ，谢谢<br><br><br>","like_count":0},{"had_liked":false,"id":272084,"user_name":"小源哥","can_delete":false,"product_type":"c1","uid":1730754,"ip_address":"","ucode":"B5130CE20CF31D","user_header":"https://static001.geekbang.org/account/avatar/00/1a/68/c2/b112da90.jpg","comment_is_top":false,"comment_ctime":1609928197,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609928197","product_id":100020901,"comment_content":"老师，场景二我没看到iowait升高的现象，iowait都是0.00，这是为什么呢，我是centos7的系统<br><br>18时15分56秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>18时16分01秒  all    1.91    0.00   45.98    0.00    0.00    0.00    0.00    0.00    0.00   52.11<br>18时16分01秒    0    0.41    0.00    3.85    0.00    0.00    0.00    0.00    0.00    0.00   95.74<br>18时16分01秒    1    3.19    0.00   87.62    0.00    0.00    0.00    0.00    0.00    0.00    9.18","like_count":0},{"had_liked":false,"id":271082,"user_name":"Janson.Wong","can_delete":false,"product_type":"c1","uid":2371917,"ip_address":"","ucode":"536838BEAFCC46","user_header":"https://static001.geekbang.org/account/avatar/00/24/31/4d/ef5bc186.jpg","comment_is_top":false,"comment_ctime":1609396091,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609396091","product_id":100020901,"comment_content":"uptime的值：<br>因此，你可以简单理解为，平均负载其实就是平均活跃进程数。平均活跃进程数，直观上的理解就是单位时间内的活跃进程数，但它实际上是活跃进程数的指数衰减平均值。<br><br>我的不同看法，我的是centos7系统：<br>我的看法更像是在这个1，5，15分钟的时间内被消耗掉的cpu个数。","like_count":0},{"had_liked":false,"id":270531,"user_name":"Geek_065895","can_delete":false,"product_type":"c1","uid":2136069,"ip_address":"","ucode":"2E6FCCC78E5767","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/rxz5aKicRkvqWmt6c6c7eayHvh577uibBTVQzcJKwSTqI9FaxZSRlx7NRVw4atWpqER8ncA5jErQb3wb4cPzZxlA/132","comment_is_top":false,"comment_ctime":1609151824,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609151824","product_id":100020901,"comment_content":"想问以下有什么方法限制使用的CPU数量吗,我的主机CPU四十多个,每次查看cpu状态就跑出一大堆CPU的数据","like_count":0},{"had_liked":false,"id":269407,"user_name":"Geek_065895","can_delete":false,"product_type":"c1","uid":2136069,"ip_address":"","ucode":"2E6FCCC78E5767","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/rxz5aKicRkvqWmt6c6c7eayHvh577uibBTVQzcJKwSTqI9FaxZSRlx7NRVw4atWpqER8ncA5jErQb3wb4cPzZxlA/132","comment_is_top":false,"comment_ctime":1608635193,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608635193","product_id":100020901,"comment_content":"02笔记<br>知识点:<br>\t1. 平均负载:平均活跃进程,包括运行中的进程和不可中断的进程(不运行但是需要占用CPU<br>\t2. CPU使用率:顾名思义.和平均负载的主要区别在于等待I&#47;O时CPU没有使用,但是平均负载会增加<br><br>linux命令:<br>\t1. uptime:实时显示平均负载<br>\t2. stress:linux系统压力模拟工具<br>\t3. mpstat:多核CPU性能分析工具<br>\t4. pidstat:进程性能分析工具<br><br>问题:<br>\t1. 为什么&quot;大量等待 CPU 的进程调度也会导致平均负载升高，此时的 CPU 使用率也会比较高&quot;,是因为要进行进程调度吗<br>","like_count":0},{"had_liked":false,"id":264533,"user_name":"po","can_delete":false,"product_type":"c1","uid":1023905,"ip_address":"","ucode":"7DB36C278F34D7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9f/a1/d75219ee.jpg","comment_is_top":false,"comment_ctime":1606492355,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1606492355","product_id":100020901,"comment_content":"老师，为什么我没有加最后5秒间隔的参数，显示CPU使用率会差那么多呢？我发现pidstat也有一样的问题，希望老师解答一下，谢谢。<br><br>root@po-virtual-machine:~# mpstat -P ALL<br>Linux 5.4.0-42-generic (po-virtual-machine) \t2020年11月27日 \t_x86_64_\t(4 CPU)<br><br>23时49分02秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>23时49分02秒  all    3.75    0.28    1.38    0.07    0.00    0.02    0.00    0.00    0.00   94.50<br>23时49分02秒    0    2.33    0.25    0.55    0.08    0.00    0.03    0.00    0.00    0.00   96.75<br>23时49分02秒    1    2.31    0.33    0.80    0.07    0.00    0.02    0.00    0.00    0.00   96.48<br>23时49分02秒    2    2.13    0.16    1.82    0.07    0.00    0.01    0.00    0.00    0.00   95.80<br>23时49分02秒    3    8.23    0.37    2.33    0.07    0.00    0.01    0.00    0.00    0.00   88.98<br>root@po-virtual-machine:~# mpstat -P ALL 5<br>Linux 5.4.0-42-generic (po-virtual-machine) \t2020年11月27日 \t_x86_64_\t(4 CPU)<br><br>23时49分05秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>23时49分10秒  all   25.30    0.00    0.15    0.00    0.00    0.00    0.00    0.00    0.00   74.55<br>23时49分10秒    0    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00<br>23时49分10秒    1    0.20    0.00    0.20    0.00    0.00    0.00    0.00    0.00    0.00   99.60<br>23时49分10秒    2    0.80    0.00    0.40    0.00    0.00    0.00    0.00    0.00    0.00   98.80<br>23时49分10秒    3  100.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00","like_count":0},{"had_liked":false,"id":263682,"user_name":"道长","can_delete":false,"product_type":"c1","uid":2330999,"ip_address":"","ucode":"15B2E9CEF84634","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/KhQRc8hIxHHyPV3Og2Fc5l8w2y7ibGwGn6odmzl3wTt6fPrNv589uHmia1rgiaZhRiaLVHv9ibhzkxFx1zo42uNIS9A/132","comment_is_top":false,"comment_ctime":1606216769,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606216769","product_id":100020901,"comment_content":"我有个疑问，我的pidstat升级到12.5.2   ，IO密集型测试过程中，我的mpstat下的%iostat很高但pidstat下的%wait并不高，看不出哪个进程出的问题。","like_count":0},{"had_liked":false,"id":263100,"user_name":"Geek_1438f5","can_delete":false,"product_type":"c1","uid":2332765,"ip_address":"","ucode":"08B0D711F3DF7E","user_header":"","comment_is_top":false,"comment_ctime":1606005747,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606005747","product_id":100020901,"comment_content":"场景2中，程序正常使用read&#47;write,不调用sync，算io密集型么？程序epoll_wait时，是算等待io么？","like_count":0},{"had_liked":false,"id":262566,"user_name":"石头再见","can_delete":false,"product_type":"c1","uid":2327479,"ip_address":"","ucode":"4325798574F69C","user_header":"https://static001.geekbang.org/account/avatar/00/23/83/b7/e970a904.jpg","comment_is_top":false,"comment_ctime":1605770614,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1605770614","product_id":100020901,"comment_content":"知识拓展：<br>1. top -H<br>2. ps -aux | awk &#39;{if( $3 &gt; 30) print $0}&#39;<br>","like_count":0},{"had_liked":false,"id":262324,"user_name":"胡翔","can_delete":false,"product_type":"c1","uid":2325069,"ip_address":"","ucode":"7B4076F55533EA","user_header":"https://static001.geekbang.org/account/avatar/00/23/7a/4d/656eba2d.jpg","comment_is_top":false,"comment_ctime":1605692599,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1605692599","product_id":100020901,"comment_content":"你好，第二个实验iowait确实上来了，可是通过pidstat -u 5 1看到的stress的wait还是0是为什么","like_count":0},{"had_liked":false,"id":258477,"user_name":"bingo","can_delete":false,"product_type":"c1","uid":1285391,"ip_address":"","ucode":"2769EAADD3B5BB","user_header":"https://static001.geekbang.org/account/avatar/00/13/9d/0f/eb8f8422.jpg","comment_is_top":false,"comment_ctime":1604454878,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604454878","product_id":100020901,"comment_content":"总结一下：平均负载高，有三个需要考虑得因素<br>1、CPU密集运算<br>2、I&#47;O密集<br>3、系统进程数太多","like_count":0},{"had_liked":false,"id":258116,"user_name":"zysnwmm","can_delete":false,"product_type":"c1","uid":1847858,"ip_address":"","ucode":"8B7CF32F87F10A","user_header":"https://static001.geekbang.org/account/avatar/00/1c/32/32/794dff33.jpg","comment_is_top":false,"comment_ctime":1604304283,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604304283","product_id":100020901,"comment_content":"%usr和%nice什么区别？比如我的系统%usr很低，%nice很高，这时候系统在干嘛？","like_count":0},{"had_liked":false,"id":257660,"user_name":"神经蛙","can_delete":false,"product_type":"c1","uid":2278036,"ip_address":"","ucode":"BAEAA801B2790B","user_header":"https://static001.geekbang.org/account/avatar/00/22/c2/94/b8916bde.jpg","comment_is_top":false,"comment_ctime":1604050298,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604050298","product_id":100020901,"comment_content":"而 CPU 使用率，是单位时间内 CPU 繁忙情况的统计，跟平均负载并不一定完全对应。<br>比如：CPU 密集型进程，使用大量 CPU 会导致平均负载升高，此时这两者是一致的；<br>I&#47;O 密集型进程，等待 I&#47;O 也会导致平均负载升高，但 CPU 使用率不一定很高；<br>大量等待 CPU 的进程调度也会导致平均负载升高，此时的 CPU 使用率也会比较高。<br><br>我2u的机子，平均负载已经超了好几倍了，但是我的cpu依然又40%的idle， iowait 也不高 为啥了？<br><br><br>[root@usm ~]# mpstat -P ALL 2 1 <br>Linux 3.10.0-1127.el7.x86_64 (usm.primary.10.0.80.53) \t10&#47;30&#47;2020 \t_x86_64_\t(2 CPU)<br><br>05:21:00 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>05:21:02 PM  all   25.52    0.00   31.19    0.26    0.00    2.06    0.00    0.00    0.00   40.98<br>05:21:02 PM    0   25.26    0.00   33.51    0.52    0.00    0.00    0.00    0.00    0.00   40.72<br>05:21:02 PM    1   25.91    0.00   29.02    0.00    0.00    3.63    0.00    0.00    0.00   41.45<br><br>Average:     CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>Average:     all   25.52    0.00   31.19    0.26    0.00    2.06    0.00    0.00    0.00   40.98<br>Average:       0   25.26    0.00   33.51    0.52    0.00    0.00    0.00    0.00    0.00   40.72<br>Average:       1   25.91    0.00   29.02    0.00    0.00    3.63    0.00    0.00    0.00   41.45<br>[root@usm ~]# <br>[root@usm ~]# <br>[root@usm ~]# uptim <br>-bash: uptim: command not found<br>[root@usm ~]# uptime <br> 17:21:24 up  2:44,  3 users,  load average: 60.55, 43.34, 34.13<br>[root@usm ~]# uptime <br> 17:25:39 up  2:48,  3 users,  load average: 14.23, 31.91, 32.17<br>","like_count":0},{"had_liked":false,"id":257368,"user_name":"mmm","can_delete":false,"product_type":"c1","uid":2263266,"ip_address":"","ucode":"D0A9D4CCEF31B8","user_header":"https://static001.geekbang.org/account/avatar/00/22/88/e2/900e279e.jpg","comment_is_top":false,"comment_ctime":1603947870,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603947870","product_id":100020901,"comment_content":"为什么centos下面的pidstat看不到cpu等待时间呢？","like_count":0},{"had_liked":false,"id":257345,"user_name":"mmm","can_delete":false,"product_type":"c1","uid":2263266,"ip_address":"","ucode":"D0A9D4CCEF31B8","user_header":"https://static001.geekbang.org/account/avatar/00/22/88/e2/900e279e.jpg","comment_is_top":false,"comment_ctime":1603942745,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603942745","product_id":100020901,"comment_content":"老师，请教一下，对于分布式系统来说，这个方法还适用吗？<br>像我们的系统是分布式，io密集型的产品，cpu已经到70%了，我们开发人员判定是io有瓶颈，但是我通过上面的mpstat看，并没有看出有很大的iowait.","like_count":0},{"had_liked":false,"id":257124,"user_name":"阿廖","can_delete":false,"product_type":"c1","uid":1399468,"ip_address":"","ucode":"C2C59BB4718A5A","user_header":"https://static001.geekbang.org/account/avatar/00/15/5a/ac/03f3551c.jpg","comment_is_top":false,"comment_ctime":1603854802,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603854802","product_id":100020901,"comment_content":"1. 解释了平均负载的含义：单位时间内可运行和不可中断的程序总数<br>2. 平均负载高的3种场景：CPU密集型场景、I&#47;0密集型场景以及多进程场景<br>3. 提出平均负载高的定义，当高于逻辑CPU的总数的70%，说明服务器的整体负载高；需要排查性能问题。 <br>4. 排查性能问题的思路方式： <br>A.  watchd -d uptime  看三个值1分钟、5分钟、15分钟的变化<br>B.  mpstat -P ALL 5  查看所有CPU的性能状态<br>C. pidstat  -u 5 1  查看进程所占用的CPU&#47;内存、上下文切换等性能指标。<br><br>5. stree 压力测试命令详解","like_count":0},{"had_liked":false,"id":254988,"user_name":"init 3","can_delete":false,"product_type":"c1","uid":2251657,"ip_address":"","ucode":"681FA943D99672","user_header":"https://static001.geekbang.org/account/avatar/00/22/5b/89/8e0924c4.jpg","comment_is_top":false,"comment_ctime":1603245576,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1603245576","product_id":100020901,"comment_content":"在只有 2 个 CPU 的系统上，意味着所有的 CPU 都刚好被完全占用---&gt;这里的两个CPU指的是2个线程还是两个core还是两个物理cpu?","like_count":0,"discussions":[{"author":{"id":2251657,"avatar":"https://static001.geekbang.org/account/avatar/00/22/5b/89/8e0924c4.jpg","nickname":"init 3","note":"","ucode":"681FA943D99672","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":315507,"discussion_content":"应该是两个core.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603283157,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":254488,"user_name":"一粒","can_delete":false,"product_type":"c1","uid":1582813,"ip_address":"","ucode":"FB5F583CC6AE3C","user_header":"https://static001.geekbang.org/account/avatar/00/18/26/dd/d58156b1.jpg","comment_is_top":false,"comment_ctime":1603120241,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1603120241","product_id":100020901,"comment_content":"老师，iowait多大时，系统属于IO密集型，需要引起关注","like_count":0},{"had_liked":false,"id":254482,"user_name":"一粒","can_delete":false,"product_type":"c1","uid":1582813,"ip_address":"","ucode":"FB5F583CC6AE3C","user_header":"https://static001.geekbang.org/account/avatar/00/18/26/dd/d58156b1.jpg","comment_is_top":false,"comment_ctime":1603120163,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1603120163","product_id":100020901,"comment_content":"打卡，本周学完CPU性能章节","like_count":0},{"had_liked":false,"id":254339,"user_name":"Geek_a852c8","can_delete":false,"product_type":"c1","uid":2206508,"ip_address":"","ucode":"D925A9D71A76BA","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/O6qftWBakkjQHrAhF5tia21GKkQxibJaPy2nWUKc9eiaouaqb67Hj60RRKgjgHhzPmaxaHkLszcNYrDSkj21lPylQ/132","comment_is_top":false,"comment_ctime":1603101894,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603101894","product_id":100020901,"comment_content":"我发现我的io也是不高了。已经用stress-ngle <br>[root@manager-node sysstat-11.5.7]# pidstat -u 5 1<br>Linux 3.10.0-1062.18.1.el7.x86_64 (manager-node) \t10&#47;19&#47;2020 \t_x86_64_\t(2 CPU)<br><br>10:03:55 AM   UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command<br>10:04:00 AM     0         6    0.00    0.40    0.00    1.40    0.40     0  ksoftirqd&#47;0<br>10:04:00 AM     0         9    0.00    0.20    0.00    0.80    0.20     1  rcu_sched<br>10:04:00 AM     0       207    0.00    0.20    0.00    0.40    0.20     1  xfsaild&#47;sda1<br>10:04:00 AM     0       208    0.00    0.40    0.00    0.00    0.40     0  kworker&#47;0:1H<br>10:04:00 AM     0       784    0.00    0.20    0.00    0.00    0.20     0  containerd<br>10:04:00 AM     0       785    1.00    0.80    0.00    0.00    1.80     1  dockerd<br>10:04:00 AM     0      1559    0.00    0.20    0.00    0.00    0.20     0  agent<br>10:04:00 AM     0      5168    0.00    9.18    0.00    2.40    9.18     0  kworker&#47;u4:2<br>10:04:00 AM     0     11679    0.00    1.80    0.00    0.20    1.80     1  kworker&#47;1:8<br>10:04:00 AM     0     14002    0.00    1.00    0.00    1.00    1.00     0  kworker&#47;0:0<br>10:04:00 AM     0     14022    0.80   27.35    0.00    0.20   28.14     0  stress-ng-hdd<br>10:04:00 AM     0     14023    0.40    5.99    0.00    1.60    6.39     1  stress-ng-io<br>10:04:00 AM     0     14164    0.00    0.40    0.00    0.00    0.40     1  pidstat<br>","like_count":0},{"had_liked":false,"id":253007,"user_name":"Geek_f702be","can_delete":false,"product_type":"c1","uid":1143067,"ip_address":"","ucode":"8E3B5F393C4266","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epumnXjMLYzHkGFhAraIiaAMXpotuUR9PCexBWl25tRLFAvpzs03Hfse4Y1lyeWuryz6z80Fd8AXiaw/132","comment_is_top":false,"comment_ctime":1602560289,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602560289","product_id":100020901,"comment_content":"打卡day2 <br>负载是单外时间内处于可运行状态或不可中断状态的进程数；包装使用cpu的进程、等待cpu的进程、等待io的进程。<br>平均负载高可能是cpu密集，i&#47;o密集、大量等待cpu进程导致","like_count":0},{"had_liked":false,"id":250525,"user_name":"罗杰","can_delete":false,"product_type":"c1","uid":1320487,"ip_address":"","ucode":"96BAFAA147341F","user_header":"https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg","comment_is_top":false,"comment_ctime":1601117226,"is_pvip":false,"discussion_count":0,"race_medal":2,"score":"1601117226","product_id":100020901,"comment_content":"第一章就被吸引了 赞 实用","like_count":0},{"had_liked":false,"id":250325,"user_name":"englefly","can_delete":false,"product_type":"c1","uid":1145907,"ip_address":"","ucode":"E3FCF19E618718","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep2gRIticwS6CiatsCiaU4QRjAODKibQevrhSciatrmd90lNIZFxywE9yyZgAxKTmWiaBSH4zZUcRIV46qQ/132","comment_is_top":false,"comment_ctime":1601025757,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601025757","product_id":100020901,"comment_content":"老师你好，关于不可中断进程，我有一些疑问：<br>1. 假设CUP只有1个core，是不是意味着最多只能有一个不可中断进程？<br>2. 如果进程在等IO的时候不可以中断，那么异步读写怎么实现呢？我以前的理解是进程发出了IO指令后就可以挂起，等待系统通知进程IO完成，然后进程恢复到可执行状态继续执行。","like_count":0},{"had_liked":false,"id":246927,"user_name":"_🐣","can_delete":false,"product_type":"c1","uid":2168407,"ip_address":"","ucode":"9BD9A506F42C51","user_header":"https://static001.geekbang.org/account/avatar/00/21/16/57/99986f03.jpg","comment_is_top":false,"comment_ctime":1599533106,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599533106","product_id":100020901,"comment_content":"老师这句话应该怎么理解呀，这不是系统负载在升高么？<br>1 分钟内，系统有 73% 的超载，而在 15 分钟内，有 698% 的超载，从整体趋势来看，系统的负载在降低。","like_count":0},{"had_liked":false,"id":244545,"user_name":"Geek_5b1ef0","can_delete":false,"product_type":"c1","uid":1667730,"ip_address":"","ucode":"7A37C43F410B06","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqLYChgx3cNPAmL2P5vSXjar4RgdpRyF1TG3ceTGjXHcGSnRckIVgLpB8jRpN6DTxzibMGwxPFnxSw/132","comment_is_top":false,"comment_ctime":1598575071,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598575071","product_id":100020901,"comment_content":"io密集型和 cpu密集型会同时出现吗？","like_count":0},{"had_liked":false,"id":244290,"user_name":"m","can_delete":false,"product_type":"c1","uid":1149859,"ip_address":"","ucode":"ED0CD4B5618277","user_header":"https://static001.geekbang.org/account/avatar/00/11/8b/a3/3397cda8.jpg","comment_is_top":false,"comment_ctime":1598451801,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598451801","product_id":100020901,"comment_content":"所以，为什么要在Load Average中加入不可中断进程？这篇博客考据了代码历史http:&#47;&#47;www.brendangregg.com&#47;blog&#47;2017-08-08&#47;linux-load-averages.html<br>总结下来就是：前人留下的一个坑，导致原本纯粹的CPU Load Average","like_count":0},{"had_liked":false,"id":243711,"user_name":"杯莫停","can_delete":false,"product_type":"c1","uid":1759325,"ip_address":"","ucode":"4FA1D5CBBEF702","user_header":"https://static001.geekbang.org/account/avatar/00/1a/d8/5d/07dfb3b5.jpg","comment_is_top":false,"comment_ctime":1598254260,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1598254260","product_id":100020901,"comment_content":"平均负载就是准备就绪要运行和不可打断（IO操作）的平均进程数量。1分钟内，5分钟内，15分钟内的数据其实就是三个样本点，让我们监控且可以直观看到平均负载的变化趋势。<br>I&#47;O密集型其实就是操作系统的复用让进行IO操作的进程让出CPU时间片，等待操作结束。","like_count":0},{"had_liked":false,"id":243371,"user_name":"凯","can_delete":false,"product_type":"c1","uid":1405256,"ip_address":"","ucode":"60DB11CF72C7B0","user_header":"https://static001.geekbang.org/account/avatar/00/15/71/48/44df7f4e.jpg","comment_is_top":false,"comment_ctime":1598077128,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598077128","product_id":100020901,"comment_content":"pidstat命令查到的如下：<br>平均时间:     0     23790    0.00    0.20    0.00    0.20     -  kworker&#47;4:1<br><br>以前遇到过kworker&#47;4:1 的cpu使用率高，这个是什么进程，再怎么定位","like_count":0},{"had_liked":false,"id":239274,"user_name":"韶年","can_delete":false,"product_type":"c1","uid":1269934,"ip_address":"","ucode":"EA4149F98FF39B","user_header":"https://static001.geekbang.org/account/avatar/00/13/60/ae/88d88232.jpg","comment_is_top":false,"comment_ctime":1596473075,"is_pvip":false,"replies":[{"id":"88791","content":"1. 是的，专栏里面的很多工具在生产环境都经常用到；<br>2. 两种类型的都有，不同工具的使用场景会有区别。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1596978024,"ip_address":"","comment_id":239274,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1596473075","product_id":100020901,"comment_content":"问题1：实际生产中，真的有公司会装这些性能分析工具吗？<br>问题2：这些性能分析工具(除了模拟cpu密集io密集)本身非常吃系统资源吗？还是说它们只是一些轻量级的工具。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503042,"discussion_content":"1. 是的，专栏里面的很多工具在生产环境都经常用到；\n2. 两种类型的都有，不同工具的使用场景会有区别。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596978024,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":238435,"user_name":"余向华","can_delete":false,"product_type":"c1","uid":1119778,"ip_address":"","ucode":"263773616D2C83","user_header":"https://static001.geekbang.org/account/avatar/00/11/16/22/2205cf0a.jpg","comment_is_top":false,"comment_ctime":1596166049,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596166049","product_id":100020901,"comment_content":"如果我现在面对着平均负载升高的话，我的解决思路会是<br><br>1、先使用uptime 这个命令看下关于平均负载的具体情况<br><br>2、使用 grep ‘model name‘  &#47;proc&#47;cpuinfo |wc -l 看下系统的CPU个数是多少，<br>判断这个负载是否属于正常，我会把70%当做一个临界值，当然这个不是一个固定值，需要根据1分钟、5分钟和15分钟的具体情况来分析。<br><br>3、接着使用命令 mpstat -P ALL 5 1看系统中的CPU具体情况，看是否是所有的CPU都是因为同一个原因，这个同一个原因可能是IO问题、可能也仅仅只是CPU的使用率问题，CPU的使用率飙高原因又可能是因为系统中的进程超过CPU的个数，也可能是某一个CPU一直被某个进程占用着（虽然这种情况我想象不出具体的场景）<br><br>4、使用pidstat -u 5 1 再判断具体是哪个进程导致，如果一个系统中布置了很多个pod的话，那么就找出对应的那个pod的<br><br>5、这个时候已经知道是因为什么原因导致的负载升高了，同时也知道是哪个pod的问题了，这里再针对性来解决不同的pod问题，比如这个pod要做的事情是计算密集型的还是IO密集型的。这个再具体的问题具体分析了。<br>","like_count":0},{"had_liked":false,"id":238408,"user_name":"阿成（Matthew）","can_delete":false,"product_type":"c1","uid":1315901,"ip_address":"","ucode":"935985DD00A1F6","user_header":"https://static001.geekbang.org/account/avatar/00/14/14/3d/70764fdc.jpg","comment_is_top":false,"comment_ctime":1596160926,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596160926","product_id":100020901,"comment_content":"cpu调度为什么负载会变高？调度前后的状态应该都是处于running 或者runnable状态的","like_count":0},{"had_liked":false,"id":238118,"user_name":"Geek_a54d1c","can_delete":false,"product_type":"c1","uid":1446882,"ip_address":"","ucode":"8058745F35E8BD","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIjKyLe0RPftkvrOg1sSYg2WHDjFPjiaicPA5OrOQckwtzJMBgIpoEtxzT7joTLOyrWtCogrXbyUetw/132","comment_is_top":false,"comment_ctime":1596073691,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596073691","product_id":100020901,"comment_content":"如何追溯历史，查看那个进程 导致cpu 或 磁盘的使用率高？","like_count":0},{"had_liked":false,"id":237927,"user_name":"时时在线","can_delete":false,"product_type":"c1","uid":2070713,"ip_address":"","ucode":"FA84A6BBD5A9E2","user_header":"https://static001.geekbang.org/account/avatar/00/1f/98/b9/976f703d.jpg","comment_is_top":false,"comment_ctime":1596006239,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596006239","product_id":100020901,"comment_content":"倪老师，比如服务器逻辑CPU数量为96，“当平均负载高于 CPU 数量 70% 的时候，你就应该分析排查负载高的问题了”，平均负载在96*0.7以下都算基本正常，是这样理解吗？","like_count":0},{"had_liked":false,"id":237906,"user_name":"万历十五年","can_delete":false,"product_type":"c1","uid":1122150,"ip_address":"","ucode":"3D8CF5DF847AE8","user_header":"https://static001.geekbang.org/account/avatar/00/11/1f/66/59e0647a.jpg","comment_is_top":false,"comment_ctime":1596002141,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1596002141","product_id":100020901,"comment_content":"在场景二里，单纯的iowait高，并不能说明是io繁忙吧？换句话说，单纯的iowait高低是不能确定io是否繁忙的","like_count":0,"discussions":[{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590810,"discussion_content":"是的io这个参数比较模糊，io高并不能代表磁盘繁忙，只能作为一个参考方向，有助于我们去往这个方向靠拢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666079745,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":237347,"user_name":"YourSweetHeart","can_delete":false,"product_type":"c1","uid":1242122,"ip_address":"","ucode":"38843F447B03F2","user_header":"https://static001.geekbang.org/account/avatar/00/12/f4/0a/cf728857.jpg","comment_is_top":false,"comment_ctime":1595796103,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595796103","product_id":100020901,"comment_content":"老师你好，等待I&#47;O的进程不可以被中断，这怎么和我在书上看到的是相反的，书上说等待I&#47;O的时候进程会被中断，切到别的cpu上呀。越来越迷糊了","like_count":0},{"had_liked":false,"id":236993,"user_name":"Geek_6a455a","can_delete":false,"product_type":"c1","uid":2083801,"ip_address":"","ucode":"882EDE52FAAEEA","user_header":"","comment_is_top":false,"comment_ctime":1595645158,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595645158","product_id":100020901,"comment_content":"在测试进程密集型时<br>用mpstat -P ALL 5 1, 看到的%usr 100,<br>用pidstat -u 5 1,看到的%usr 24.95  %wait 75<br>为啥2个命令看到的usr不一致？","like_count":0},{"had_liked":false,"id":236521,"user_name":"bin.chen","can_delete":false,"product_type":"c1","uid":1135604,"ip_address":"","ucode":"5BA49358AB8A1A","user_header":"https://static001.geekbang.org/account/avatar/00/11/53/f4/e277325d.jpg","comment_is_top":false,"comment_ctime":1595438089,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595438089","product_id":100020901,"comment_content":"这个专栏100少了，很值💪","like_count":0},{"had_liked":false,"id":235970,"user_name":"sky","can_delete":false,"product_type":"c1","uid":1207056,"ip_address":"","ucode":"5CEF9A1806298D","user_header":"https://static001.geekbang.org/account/avatar/00/12/6b/10/22f93764.jpg","comment_is_top":false,"comment_ctime":1595258224,"is_pvip":false,"replies":[{"id":"87250","content":"嗯 可以这么理解，其实新版本内核更好的观测指标是PSI<br><br>https:&#47;&#47;facebookmicrosites.github.io&#47;psi&#47;docs&#47;overview","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1595342818,"ip_address":"","comment_id":235970,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1595258224","product_id":100020901,"comment_content":"倪老师，可以这样理解平均负载和CPU使用率吗？<br>举个例子，假设在一个单CPU的机器上，有且仅有两个进程，并且两个进程先后调用系统函数read读取大批量数据，并且都处于长时间等待OS通知I&#47;O完成的通知中，这个时候系统的平均负载为2，但是CPU使用率是空闲的，因为并没有CPU在运行任何进程。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501903,"discussion_content":"嗯 可以这么理解，其实新版本内核更好的观测指标是PSI\n\nhttps://facebookmicrosites.github.io/psi/docs/overview","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595342818,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":235577,"user_name":"林敏健","can_delete":false,"product_type":"c1","uid":1101426,"ip_address":"","ucode":"EF0CE23273878C","user_header":"https://static001.geekbang.org/account/avatar/00/10/ce/72/638a2804.jpg","comment_is_top":false,"comment_ctime":1595098822,"is_pvip":false,"replies":[{"id":"87262","content":"逻辑CPU个数","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1595343459,"ip_address":"","comment_id":235577,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1595098822","product_id":100020901,"comment_content":"理想情况下，平均负载等于cpu个数。这里的cpu是指物理cpu还是core还是超线程之后的逻辑cpu？有人说intel cpu开了超线程后，一个core当成2个来用，但实际上单个逻辑cpu的运算能力不高，两个逻辑cpu加起来才等于原先1.3个core。如果超线程开启了的话，那么system load的计算对比方式是否需要相应变更？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501772,"discussion_content":"逻辑CPU个数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595343459,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":235424,"user_name":"快乐跳跳糖","can_delete":false,"product_type":"c1","uid":2069928,"ip_address":"","ucode":"D7CC6908546750","user_header":"https://static001.geekbang.org/account/avatar/00/1f/95/a8/7d2c6946.jpg","comment_is_top":false,"comment_ctime":1595031168,"is_pvip":false,"replies":[{"id":"87267","content":"很高兴看到你掌握了😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1595343864,"ip_address":"","comment_id":235424,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1595031168","product_id":100020901,"comment_content":"终于解惑了！困扰了我好久的问题，上网查的解释各种各样，终于搞明白了，谢谢老师。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501714,"discussion_content":"很高兴看到你掌握了😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595343864,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":235325,"user_name":"陈光辉","can_delete":false,"product_type":"c1","uid":1202006,"ip_address":"","ucode":"66CCBBD37A6200","user_header":"https://static001.geekbang.org/account/avatar/00/12/57/56/74cd397e.jpg","comment_is_top":false,"comment_ctime":1594975619,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594975619","product_id":100020901,"comment_content":"htop、atop真是太cool了","like_count":0},{"had_liked":false,"id":233999,"user_name":"simple_孙","can_delete":false,"product_type":"c1","uid":1873629,"ip_address":"","ucode":"A77203E242D652","user_header":"https://static001.geekbang.org/account/avatar/00/1c/96/dd/1620a744.jpg","comment_is_top":false,"comment_ctime":1594548735,"is_pvip":false,"replies":[{"id":"86799","content":"请参考第一条留言。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1594905764,"ip_address":"","comment_id":233999,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1594548735","product_id":100020901,"comment_content":"使用win10上的wsl，Ubuntu版本是Ubuntu 20.04 LTS，stress -i 1 --timeout 600不起作用，平均负载数也一直没有变化","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501239,"discussion_content":"请参考第一条留言。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594905764,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":233866,"user_name":"coline","can_delete":false,"product_type":"c1","uid":1066591,"ip_address":"","ucode":"8D65672728CDEF","user_header":"https://static001.geekbang.org/account/avatar/00/10/46/5f/c01e20ad.jpg","comment_is_top":false,"comment_ctime":1594482757,"is_pvip":false,"replies":[{"id":"86800","content":"嗯 第一条留言里面说了这个stress工具的问题","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1594905830,"ip_address":"","comment_id":233866,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1594482757","product_id":100020901,"comment_content":"1.建议使用stress-ng来模拟IO飙高，安装方式：配置阿里yum源，使用命令：yum install stress-ng -。使用命令：stress-ng --hdd 2 --timeout 600模拟磁盘读写导致IOwait飙高，这时如果只使用top命令查看会发现没有进程对CPU使用率占用飙高，但是平均负载很高<br>2.使用pidstat -d 5 3查看对磁盘读写较高的进程，一般都是这些进程导致的iowait，老师在IO密集型的验证中还是使用-u参数，现网环境只使用这个参数不能准确查到IO飙高的进程。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501196,"discussion_content":"嗯 第一条留言里面说了这个stress工具的问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594905830,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":233666,"user_name":"Geek_f40493","can_delete":false,"product_type":"c1","uid":1469401,"ip_address":"","ucode":"FD8F6B1324E76C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epjdWhOia2BKpjJLp7KZGPiaeZSNxaeorfcibSVicvjgyI0rPOdbzmQKK1Yuq04XDPu4ly2tcYx8lu6Fg/132","comment_is_top":false,"comment_ctime":1594377967,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594377967","product_id":100020901,"comment_content":"runnable状态的进程应该是不占cpu的，为什么也算到了uptime命令中的负载数量中去了","like_count":0},{"had_liked":false,"id":230467,"user_name":"生活不如诗","can_delete":false,"product_type":"c1","uid":1139515,"ip_address":"","ucode":"FD48EABEEC52B7","user_header":"https://static001.geekbang.org/account/avatar/00/11/63/3b/c5cd68ab.jpg","comment_is_top":false,"comment_ctime":1593395695,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593395695","product_id":100020901,"comment_content":"查看系统平均负载的时候，1分钟，5分钟，15分钟的负载值都要查看来综合评判系统一段时间段内的压力状态。<br>平均负载高有如下原因：<br>1. cpu密集型应用导致负载升高，此时可以通过mpstat查看每个cpu利用率，然后通过pidstat查看是哪个进程导致负载过高；<br>2. io密集型应用也会导致系统负载升高。io密集型应用处于不可中断状态，会导致cpu处于iowait状态。这种情况也是通过mpstat查看每个cpu状态，着重检查iowait值，然后通过pidstat查看造成负载过高的进程；<br>3. 进程过多造成cpu争用，此时通过mpstat会看到每个cpu使用率都很高，通过pidstat输出的wait列可以看到进程的wait值都很高，表示cpu处于多进程争用状态。","like_count":0},{"had_liked":false,"id":229612,"user_name":"杰飞Harry","can_delete":false,"product_type":"c1","uid":1555013,"ip_address":"","ucode":"175DDAB485BEEB","user_header":"https://static001.geekbang.org/account/avatar/00/17/ba/45/77d230b4.jpg","comment_is_top":false,"comment_ctime":1593073370,"is_pvip":false,"replies":[{"id":"86948","content":"请参考置顶留言 ","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1594995347,"ip_address":"","comment_id":229612,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1593073370","product_id":100020901,"comment_content":"我的iowait为什么没升高呢？按照文章那样来的，结果没升高。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499562,"discussion_content":"请参考置顶留言 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594995347,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":225370,"user_name":"全力以赴@","can_delete":false,"product_type":"c1","uid":1979876,"ip_address":"","ucode":"4F3D26318DCB19","user_header":"https://static001.geekbang.org/account/avatar/00/1e/35/e4/bb5ddaef.jpg","comment_is_top":false,"comment_ctime":1591746275,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591746275","product_id":100020901,"comment_content":"uptime  top","like_count":0},{"had_liked":false,"id":224679,"user_name":"DayDayUp","can_delete":false,"product_type":"c1","uid":1610552,"ip_address":"","ucode":"9C53659518AB74","user_header":"https://static001.geekbang.org/account/avatar/00/18/93/38/71615300.jpg","comment_is_top":false,"comment_ctime":1591504964,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1591504964","product_id":100020901,"comment_content":"如果是centos的话更好，stress为什么在centos上找不到？","like_count":0},{"had_liked":false,"id":221183,"user_name":"Michael","can_delete":false,"product_type":"c1","uid":1118976,"ip_address":"","ucode":"35F4FFAC4A4B15","user_header":"https://static001.geekbang.org/account/avatar/00/11/13/00/a4a2065f.jpg","comment_is_top":false,"comment_ctime":1590421625,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590421625","product_id":100020901,"comment_content":"root@913ecec6c8c3:&#47;workdir# uptime<br>    23:43:40 up  1:13,  0 users,  load average: 1.24, 0.35, 0.89<br><br>这里的登录用户数为什么是0，root 不算么？","like_count":0},{"had_liked":false,"id":219214,"user_name":"阿飞","can_delete":false,"product_type":"c1","uid":1298046,"ip_address":"","ucode":"F8B1FC8521264D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKZicicibGibtR5zAia782Ajc5I5BN3F3tjAdlibATIknHv67gbxeH21N7B6vbgwLjYb1miaLKhqicptB5ibYw/132","comment_is_top":false,"comment_ctime":1589967343,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589967343","product_id":100020901,"comment_content":"关于负载，看了 man uptime 文档中是这么定义平均负载的：System load averages is the average number of processes that are either  in a runnable or uninterruptable state.  A process in a runnable  state is  either  using the CPU or waiting to use the CPU. A process in uninterruptable state is waiting for some I&#47;O access, eg waiting for  disk. ","like_count":0},{"had_liked":false,"id":216723,"user_name":"小丑魚去哪了","can_delete":false,"product_type":"c1","uid":1102115,"ip_address":"","ucode":"69B95DA43B7BA7","user_header":"https://static001.geekbang.org/account/avatar/00/10/d1/23/8251913b.jpg","comment_is_top":false,"comment_ctime":1589332607,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589332607","product_id":100020901,"comment_content":"你说，load可能是都在io，那这样的说法是不是不合理呢？下面的说法，平均负载就是cpu使用率的说法呀<br><br>既然平均的是活跃进程数，那么最理想的，就是每个 CPU 上都刚好运行着一个进程，这样每个 CPU 都得到了充分利用。比如当平均负载为 2 时，意味着什么呢？在只有 2 个 CPU 的系统上，意味着所有的 CPU 都刚好被完全占用。在 4 个 CPU 的系统上，意味着 CPU 有 50% 的空闲。而在只有 1 个 CPU 的系统中，则意味着有一半的进程竞争不到 CPU。","like_count":0},{"had_liked":false,"id":212079,"user_name":"一个路过的菜鸟","can_delete":false,"product_type":"c1","uid":1955176,"ip_address":"","ucode":"EC034161202E1E","user_header":"","comment_is_top":false,"comment_ctime":1588058152,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588058152","product_id":100020901,"comment_content":"iowtait一直为0,但是stress进程的cup使用率为100%，<br>15:12:06     CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>15:12:11     all    7.69    0.00    9.84    0.00    0.05    0.00    0.00    0.00    0.00   82.41<br>15:12:11       0    3.39    0.00    5.59    0.00    0.40    0.00    0.00    0.00    0.00   90.62<br>15:12:11       1    3.20    0.00    5.00    0.00    0.00    0.00    0.00    0.00    0.00   91.80<br>15:12:11       2    3.80    0.00    5.60    0.00    0.00    0.00    0.00    0.00    0.00   90.60<br>15:12:11       3    6.39    0.00    5.99    0.00    0.00    0.00    0.00    0.00    0.00   87.62<br>15:12:11       4    6.00    0.00   12.40    0.00    0.00    0.00    0.00    0.00    0.00   81.60<br>15:12:11       5    9.38    0.00   16.57    0.00    0.00    0.00    0.00    0.00    0.00   74.05<br>15:12:11       6   13.17    0.00   14.77    0.00    0.00    0.00    0.00    0.00    0.00   72.06<br>15:12:11       7   16.23    0.00   12.83    0.00    0.00    0.00    0.00    0.00    0.00   70.94<br>--------------------------------------------------------------------------------------<br>这是什么原因导致的","like_count":0},{"had_liked":false,"id":210738,"user_name":"Idiom","can_delete":false,"product_type":"c1","uid":1327962,"ip_address":"","ucode":"78195CF67A19D6","user_header":"https://static001.geekbang.org/account/avatar/00/14/43/5a/0ebf0e44.jpg","comment_is_top":false,"comment_ctime":1587818174,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587818174","product_id":100020901,"comment_content":"打卡(*^ω^*)<br>工作过程中，碰到负载高的情况下，我一般都是用top 或者htop<br>用top的时候，我会习惯性先按1，显示出CPU的核数，然后再按P，按照CPU使用率排序<br>用htop的时候，我会按F6，然后选择需要排序的选项","like_count":0},{"had_liked":false,"id":207654,"user_name":"chai","can_delete":false,"product_type":"c1","uid":1202222,"ip_address":"","ucode":"C686EB1B1EBAB6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep66fdwo3ebSicKjf0iacAx4C2tZOthDDD4bSJqib1iauFBK6EoMSWUBp4UbbN2BQlib7mFR3hQD6MUwew/132","comment_is_top":false,"comment_ctime":1587129212,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1587129212","product_id":100020901,"comment_content":"可先用top命令查看，然后输入P，根据CPU使用率进行排序，即可判断是否是CPU使用率高的问题导致的负载高","like_count":0},{"had_liked":false,"id":202873,"user_name":"flycun","can_delete":false,"product_type":"c1","uid":1001231,"ip_address":"","ucode":"AE4C77CCE57D6B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/47/0f/c1b51e25.jpg","comment_is_top":false,"comment_ctime":1586078452,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1586078452","product_id":100020901,"comment_content":"再学习一遍，巩固一下","like_count":0},{"had_liked":false,"id":202269,"user_name":"雄鹰","can_delete":false,"product_type":"c1","uid":1786819,"ip_address":"","ucode":"67E0C4BDE7F6F2","user_header":"https://static001.geekbang.org/account/avatar/00/1b/43/c3/2c53acd7.jpg","comment_is_top":false,"comment_ctime":1585952902,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1585952902","product_id":100020901,"comment_content":"老师，你好！比如我的测试服务器CPU是32核（操作系统是centos7.2），测试某一个业务时，用top命令查看得，其中 load average: 20.86, 21.51, 14.54 ；%Cpu(s): 67.1 us,  1.1 sy,  0.0 ni, 31.7 id,  0.1 wa,  0.0 hi,  0.0 si,  0.0 st，其中一个进程（PID是 132050）占用CPU达到1699% ，想进一步查看CPU占用的详情，开始用 mpstat -P ALL 5 命令查看每个CPU的使用情况，再用pidstat -u 5 1 查看具体某个进程CPU占用情况，但发现只有两个进程（其中一个PID是132050）占用到100%，其他的占用都很少（5%），我的疑问是，这个命令查出来的CPU占用之和也才300%左右，与开始用top命令查出来的1800%（其中一个进程就占用1699%）还有1500%左右的没有看到呢？<br>这个留言区不知可否截图，若能截图更明了，可能有些纯文字表述，没有表达的很清楚。","like_count":0},{"had_liked":false,"id":200166,"user_name":"白开水","can_delete":false,"product_type":"c1","uid":1725387,"ip_address":"","ucode":"0300AB319468D3","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/yb5R8iaxicD8tROw24eqlC8icMLSz4UeMnebgXASYV8lLahzpaeiapqZkM3oAw55zPBR84KeRQ0ILQHmv3pmibuicxGg/132","comment_is_top":false,"comment_ctime":1585552280,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585552280","product_id":100020901,"comment_content":"老师，我的pidstat的版本没有‘’%wait”这一列，能否提供支持这个功能的版本呢？","like_count":0},{"had_liked":false,"id":198714,"user_name":"benamazing","can_delete":false,"product_type":"c1","uid":1549752,"ip_address":"","ucode":"D8BE0A2D29DAB4","user_header":"https://static001.geekbang.org/account/avatar/00/17/a5/b8/17129075.jpg","comment_is_top":false,"comment_ctime":1585465075,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585465075","product_id":100020901,"comment_content":"试读了两篇，感觉说得挺好挺通俗易懂的","like_count":0},{"had_liked":false,"id":194284,"user_name":"大雄","can_delete":false,"product_type":"c1","uid":1676966,"ip_address":"","ucode":"5FCFDD3A940801","user_header":"https://static001.geekbang.org/account/avatar/00/19/96/a6/32a286e0.jpg","comment_is_top":false,"comment_ctime":1585045685,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585045685","product_id":100020901,"comment_content":"[root@relay ~]# pidstat -u 5 1<br>Linux 3.10.0-862.el7.x86_64 (relay)     03&#47;24&#47;2020      _x86_64_        (2 CPU)<br><br>06:25:17 PM   UID       PID    %usr %system  %guest    %CPU   CPU  Command<br>06:25:22 PM  1000      4014    0.00    0.20    0.00    0.20     1  blackbox_export<br>06:25:22 PM     0      4162    0.20    0.00    0.00    0.20     1  barad_agent<br>06:25:22 PM     0      4173    0.20    0.00    0.00    0.20     1  barad_agent<br>06:25:22 PM  1000      4906    0.20    0.00    0.00    0.20     1  prometheus<br>06:25:22 PM     0      7149    0.20    0.20    0.00    0.40     1  YDService<br>06:25:22 PM     0     10876    0.00   93.21    0.00   93.21     0  stress<br>06:25:22 PM     0     11837    0.20    0.00    0.00    0.20     1  mysqld_exporter<br>06:25:22 PM     0     17260    0.00    0.20    0.00    0.20     1  kworker&#47;1:1<br><br>奇怪我的没iowait选项 ","like_count":0},{"had_liked":false,"id":192612,"user_name":"201200986","can_delete":false,"product_type":"c1","uid":1900861,"ip_address":"","ucode":"6042C42D1C904E","user_header":"","comment_is_top":false,"comment_ctime":1584864032,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584864032","product_id":100020901,"comment_content":"平均负载的计算是利用vmstat中的r还是r和b的和呢？","like_count":0},{"had_liked":false,"id":192410,"user_name":"自渡。","can_delete":false,"product_type":"c1","uid":1907278,"ip_address":"","ucode":"3E3EB3DE28CC46","user_header":"https://static001.geekbang.org/account/avatar/00/1d/1a/4e/a946ca99.jpg","comment_is_top":false,"comment_ctime":1584849177,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584849177","product_id":100020901,"comment_content":"学过Linux基础，能听懂","like_count":0},{"had_liked":false,"id":192409,"user_name":"自渡。","can_delete":false,"product_type":"c1","uid":1907278,"ip_address":"","ucode":"3E3EB3DE28CC46","user_header":"https://static001.geekbang.org/account/avatar/00/1d/1a/4e/a946ca99.jpg","comment_is_top":false,"comment_ctime":1584849159,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584849159","product_id":100020901,"comment_content":"讲得很好","like_count":0},{"had_liked":false,"id":191076,"user_name":"Bryan","can_delete":false,"product_type":"c1","uid":1037208,"ip_address":"","ucode":"BA9D6A278609F3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d3/98/60d13550.jpg","comment_is_top":false,"comment_ctime":1584728789,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1584728789","product_id":100020901,"comment_content":"之前一直以为是「百分比」的概念，还十分好奇为什么可以超过 1、我自己的 Mac 为什么日常都是 2-3，现在终于明白了","like_count":0},{"had_liked":false,"id":190524,"user_name":"怀揣梦想的学渣","can_delete":false,"product_type":"c1","uid":1916685,"ip_address":"","ucode":"2349B9F4F6FDE3","user_header":"https://static001.geekbang.org/account/avatar/00/1d/3f/0d/1e8dbb2c.jpg","comment_is_top":false,"comment_ctime":1584666989,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1584666989","product_id":100020901,"comment_content":"场景二，mpstat看 %iowait确实很明显。但是pidstat 部分，是看 %wait 判断出 stress进程就是占用IO资源最多的吗。","like_count":0},{"had_liked":false,"id":190252,"user_name":"小眸一笑","can_delete":false,"product_type":"c1","uid":1764623,"ip_address":"","ucode":"E59C21EE6A1F6F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIqNT4A7QuGGbvyxBAd5Jkiby6ybQbV1YPNZgQ2wxWYrIVf1ovsB4nkVxUG4ictCEgnWeaH4cL0gpzw/132","comment_is_top":false,"comment_ctime":1584623252,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584623252","product_id":100020901,"comment_content":"centos安装stress<br>yum install -y epel-release<br>yum install -y stress","like_count":0},{"had_liked":false,"id":188923,"user_name":"痞子胥","can_delete":false,"product_type":"c1","uid":1617678,"ip_address":"","ucode":"3701A981FFF083","user_header":"","comment_is_top":false,"comment_ctime":1584434453,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1584434453","product_id":100020901,"comment_content":"老师 我的  为啥 pidstat命令 没有 %wait 列?","like_count":0,"discussions":[{"author":{"id":3065276,"avatar":"","nickname":"Geek_b3b8da","note":"","ucode":"5461CD95B1D764","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590807,"discussion_content":"升级\nwget https://github.com/sysstat/sysstat/archive/refs/tags/v12.5.5.tar.gz\ntar -zxvf v12.5.5.tar.gz\nyum -y install gcc*\ncd sysstat-12.5.5","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666079262,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":186897,"user_name":"~尘曦~","can_delete":false,"product_type":"c1","uid":1175695,"ip_address":"","ucode":"BFA7E7DBD9047B","user_header":"https://static001.geekbang.org/account/avatar/00/11/f0/8f/ca9fded0.jpg","comment_is_top":false,"comment_ctime":1583947397,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583947397","product_id":100020901,"comment_content":"i&#47;o 测试的时候 cpu 平均负载上去了但 %iowait 上不去，什么问题啊<br>Every 2.0s: uptime                                                                                                                                                     Thu Mar 12 01:23:05 2020<br><br> 01:23:05 up 34 min,  4 users,  load average: 1.18, 0.79, 0.68<br><br>[root@master ~]#  mpstat -P ALL 5 1<br>Linux 3.10.0-957.el7.x86_64 (master) \t2020年03月12日 \t_x86_64_\t(2 CPU)<br><br>01时20分32秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>01时20分37秒  all    0.00    0.00   33.74    0.00    0.00    0.00    0.00    0.00    0.00   66.26<br>01时20分37秒    0    0.22    0.00   35.40    0.00    0.00    0.00    0.00    0.00    0.00   64.38<br>01时20分37秒    1    0.00    0.00   32.22    0.00    0.00    0.00    0.00    0.00    0.00   67.78<br><br>平均时间:  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>平均时间:  all    0.00    0.00   33.74    0.00    0.00    0.00    0.00    0.00    0.00   66.26<br>平均时间:    0    0.22    0.00   35.40    0.00    0.00    0.00    0.00    0.00    0.00   64.38<br>平均时间:    1    0.00    0.00   32.22    0.00    0.00    0.00    0.00    0.00    0.00   67.78<br>","like_count":0},{"had_liked":false,"id":185173,"user_name":"tinsang","can_delete":false,"product_type":"c1","uid":1066414,"ip_address":"","ucode":"89AE9D3837BEFA","user_header":"https://static001.geekbang.org/account/avatar/00/10/45/ae/a213a2a3.jpg","comment_is_top":false,"comment_ctime":1583504372,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1583504372","product_id":100020901,"comment_content":"出现了cpu使用率高，但是系统负载却很低，什么情况下会出现这样的情况呢？","like_count":0,"discussions":[{"author":{"id":1448147,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/ueWNR1W4WibG9o7sa3Wv6by4VwM15rJCOGfxZ3nX0tj9ic8nTcofFUICBrXICgomJfRblVMHUQELFoKKMLUmPk0Q/132","nickname":"不懈前行","note":"","ucode":"237C22578E1AF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":199639,"discussion_content":"不会吧。几个逻辑核？是不是只看到了某一个CPU高，但是多个核整体下来就低了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583595813,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":184767,"user_name":"Jialin","can_delete":false,"product_type":"c1","uid":1112955,"ip_address":"","ucode":"12583269732A75","user_header":"https://static001.geekbang.org/account/avatar/00/10/fb/7b/2d4b38fb.jpg","comment_is_top":false,"comment_ctime":1583398147,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583398147","product_id":100020901,"comment_content":"平均负载只是单位时间内活跃的进程数（活跃的进程是指进程包括运行状态（包括运行中的进程和等待就绪的进程）和不可中断状态）。<br>CPU使用率指单位时间内CPU运行情况的统计。<br>平均负载和CPU使用率属于两个不同的概念，在某些情况下可以等价，某些情况下不可以等价。<br>情况1：CPU密集型进程，CPU使用率和平均负载基本一致<br>情况2：IO密集型进程，平均负载升高，CPU使用率不一定升高<br>情况3：大量等待CPU的进程调度，平均负载升高，CPU使用率也升高","like_count":0},{"had_liked":false,"id":184358,"user_name":"影虫","can_delete":false,"product_type":"c1","uid":1897097,"ip_address":"","ucode":"A0BD3C13373786","user_header":"https://static001.geekbang.org/account/avatar/00/1c/f2/89/2d2df078.jpg","comment_is_top":false,"comment_ctime":1583297615,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583297615","product_id":100020901,"comment_content":"RHEL7自带的pidstat 没有%wait值，是不是版本过低","like_count":0},{"had_liked":false,"id":180218,"user_name":"宋胖胖","can_delete":false,"product_type":"c1","uid":1857496,"ip_address":"","ucode":"AA828F49CCEABA","user_header":"https://static001.geekbang.org/account/avatar/00/1c/57/d8/e9c8b923.jpg","comment_is_top":false,"comment_ctime":1582211125,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582211125","product_id":100020901,"comment_content":"打卡，学习+实战","like_count":0},{"had_liked":false,"id":179691,"user_name":"羁绊12221","can_delete":false,"product_type":"c1","uid":1463686,"ip_address":"","ucode":"15B47C5053388A","user_header":"https://static001.geekbang.org/account/avatar/00/16/55/86/ca7c94ce.jpg","comment_is_top":false,"comment_ctime":1582079585,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582079585","product_id":100020901,"comment_content":"1. CPU负载数 = 单位时间内R状态 + D状态平均进程数<br>    R状态：运行状态（正在使用CPU） + 可运行状态（正在等待CPU）<br>    D状态：Disk Sleep。等待硬件设备的IO响应的不可中断状态。<br>2. 平均负载高于CPU总核数70%需要注意。<br>3. CPU使用率高不绝对等于CPU负载高 <br>    1）对于CPU密集型进程（主机）：负载高的时候，单进程大部分时间（多进程大部分进程）处于R状态，CPU利用率高；若是单进程，则%usr增高，若是多进程争抢，则进程上下文切换增多（内核负责处理），%sys增高<br>    2）对于IO密集型进程（主机）：负载高的时候，单进程大部分时间（多进程大部分进程）处于D状态，CPU利用率可能不高，此时%iowait增高<br>4. CPU负载查看方法：uptime   top<br>5. CPU各核视角查看CPU利用率：mpstat -P ALL 1<br>    各进程视角查看CPU利用率：pidstat -u 5 1<br>6. CPU压力测试工具：stress<br>   stress --cpu 1 --timeout 600  &#47;&#47;CPU密集型<br>   stress -i 1 --timeout 600    &#47;&#47;IO密集型<br><br> 7. 需要注意：<br>     %iowait：表示进程等待IO的时间，常见于 top mpstat<br>     %wait： 表示进程等待cpu（CPU争抢），常见于 pidstat<br>8. 进程状态机（不包含挂起）<br><br>9. 进程状态机（包含挂起）<br><br>参考文档：https:&#47;&#47;www.cnblogs.com&#47;zxf98&#47;p&#47;5716296.html","like_count":0},{"had_liked":false,"id":179534,"user_name":"罗辑思维","can_delete":false,"product_type":"c1","uid":1318941,"ip_address":"","ucode":"D257A06EDE928E","user_header":"https://static001.geekbang.org/account/avatar/00/14/20/1d/0c1a184c.jpg","comment_is_top":false,"comment_ctime":1582025089,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582025089","product_id":100020901,"comment_content":"pidstat类似windows里的任务管理器。场景一：CPU  密集型进程有点像平常windows系统卡了，我们就会调出任务管理器看看CPU使用率是不是100%了，然后是哪个进程。<br>以前处理windows系统卡顿时候会用Process Explore工具定位到某个进程，然后再查看线程，最后确认线程此时的运行堆栈来找到导致cpu飙升的原因。<br>由于基础差，开始还学习了潘爱民老师翻译的《深入解析windows操作系统》，后来各种原因也放弃学习。现在又开始重新学习性能优化了。","like_count":0},{"had_liked":false,"id":177005,"user_name":"毛立平","can_delete":false,"product_type":"c1","uid":1315299,"ip_address":"","ucode":"C4B507511447C5","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/e3/17d09788.jpg","comment_is_top":false,"comment_ctime":1581247033,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1581247033","product_id":100020901,"comment_content":"Flag 2020-02-09","like_count":0},{"had_liked":false,"id":173547,"user_name":"linker","can_delete":false,"product_type":"c1","uid":1803259,"ip_address":"","ucode":"6C5799F2FC2C82","user_header":"https://static001.geekbang.org/account/avatar/00/1b/83/fb/621adceb.jpg","comment_is_top":false,"comment_ctime":1579593290,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579593290","product_id":100020901,"comment_content":"使用top命令就行，可以看平均负载，io，cpu使用率等。","like_count":0},{"had_liked":false,"id":173335,"user_name":"xiong","can_delete":false,"product_type":"c1","uid":1099375,"ip_address":"","ucode":"C1BFD9EF96372F","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/6f/ac3003fa.jpg","comment_is_top":false,"comment_ctime":1579506366,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579506366","product_id":100020901,"comment_content":"在测试 IO 密集型的时候，stress -i 1 --timeout 600 ，我在阿里云的centos 上跑，平均负载是上升了，但是 mpstat 显示出来的iowait  一直是 0.00 。磁盘是 阿里云的40G 云盘，和这个会有关系吗？","like_count":0},{"had_liked":false,"id":173183,"user_name":"Jacin","can_delete":false,"product_type":"c1","uid":1323763,"ip_address":"","ucode":"F7AA8CCB1C678C","user_header":"https://static001.geekbang.org/account/avatar/00/14/32/f3/698734e2.jpg","comment_is_top":false,"comment_ctime":1579448501,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579448501","product_id":100020901,"comment_content":"我们有个生产服务器的实际例子负载很高，但CPU，IO使用都不高<br>top - 23:32:59 up 84 days, 17:53,  1 user,  load average: 42.02, 42.21, 42.32<br>Tasks: 351 total,   1 running, 224 sleeping,   0 stopped,   0 zombie<br>%Cpu(s):  4.3 us,  4.3 sy,  0.0 ni, 91.4 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st<br>KiB Mem : 16414400 total,  2519460 free,  6761380 used,  7133560 buff&#47;cache<br><br>avg-cpu:  %user   %nice %system %iowait  %steal   %idle<br>           3.20    0.00    1.63    0.04    0.00   95.12<br><br>Device:            tps    kB_read&#47;s    kB_wrtn&#47;s    kB_read    kB_wrtn<br>fd0               0.00         0.00         0.00         16          0<br>sda               3.27         2.24       149.83   16367019 1097058900<br>dm-0              0.51         0.13         6.35     972472   46473920<br>dm-1              0.00         0.00         0.00       4772          0<br>dm-2              0.00         0.00         0.00       7552       6876<br>dm-3              0.22         0.00         1.42       6484   10388708<br>dm-4              0.07         0.00         0.27       5876    2001560<br>dm-5              2.64         2.10       144.74   15351252 1059800264<br>rbd0              0.00         0.00         0.01       7083      92858<br><br>这是什么原因导致负载高呢？","like_count":0},{"had_liked":false,"id":173008,"user_name":"卷毛","can_delete":false,"product_type":"c1","uid":1762439,"ip_address":"","ucode":"B53D459BB63025","user_header":"https://static001.geekbang.org/account/avatar/00/1a/e4/87/fa7438da.jpg","comment_is_top":false,"comment_ctime":1579406035,"is_pvip":true,"discussion_count":0,"race_medal":3,"score":"1579406035","product_id":100020901,"comment_content":"实验2, iowait没有显示。<br><br>环境：ubuntu18 cpu 1 内存 1G","like_count":0},{"had_liked":false,"id":172496,"user_name":"Jaime","can_delete":false,"product_type":"c1","uid":1078333,"ip_address":"","ucode":"904192CC4E916F","user_header":"https://static001.geekbang.org/account/avatar/00/10/74/3d/54bbc1df.jpg","comment_is_top":false,"comment_ctime":1579190760,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1579190760","product_id":100020901,"comment_content":"平均负载升高，先判断是否是cpu使用率异常，如果cpu负载不高，在判断是否iowait升高，最后在用pidstat判断是哪个进程的问题","like_count":0},{"had_liked":false,"id":172328,"user_name":"奇迹","can_delete":false,"product_type":"c1","uid":1779058,"ip_address":"","ucode":"7F02A829E305D5","user_header":"https://static001.geekbang.org/account/avatar/00/1b/25/72/00990bd2.jpg","comment_is_top":false,"comment_ctime":1579155603,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579155603","product_id":100020901,"comment_content":"解释的很清晰！","like_count":0},{"had_liked":false,"id":171414,"user_name":"在路上","can_delete":false,"product_type":"c1","uid":1143372,"ip_address":"","ucode":"335960F683C23C","user_header":"https://static001.geekbang.org/account/avatar/00/11/72/4c/4d636a23.jpg","comment_is_top":false,"comment_ctime":1578920130,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578920130","product_id":100020901,"comment_content":"倪老师，现在用k8s也遇到了平均负载过高的问题，但是这个如何优化呢？8核机器，压测600时，负载达到了28，时延48ms，而同样的机器，原先压测600时，负载只有12，时延只有26ms，目前只能降低进程数，才能降低时延和负载","like_count":0},{"had_liked":false,"id":170321,"user_name":"笑","can_delete":false,"product_type":"c1","uid":1741098,"ip_address":"","ucode":"689A435818403A","user_header":"https://static001.geekbang.org/account/avatar/00/1a/91/2a/c0fb21fa.jpg","comment_is_top":false,"comment_ctime":1578568172,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578568172","product_id":100020901,"comment_content":"打卡，Day 1，平均负载与CPU使用率是两个概念，并无绝对的关系。","like_count":0},{"had_liked":false,"id":170112,"user_name":"在路上","can_delete":false,"product_type":"c1","uid":1143372,"ip_address":"","ucode":"335960F683C23C","user_header":"https://static001.geekbang.org/account/avatar/00/11/72/4c/4d636a23.jpg","comment_is_top":false,"comment_ctime":1578533197,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578533197","product_id":100020901,"comment_content":"进程有63个，pidstat怎么显示完全呢？","like_count":0},{"had_liked":false,"id":169994,"user_name":"wakaka","can_delete":false,"product_type":"c1","uid":1471508,"ip_address":"","ucode":"835A7341577D3B","user_header":"https://static001.geekbang.org/account/avatar/00/16/74/14/ea854bfc.jpg","comment_is_top":false,"comment_ctime":1578489841,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578489841","product_id":100020901,"comment_content":"最简单的环境搭建方式，docker + ubuntu镜像，mac、windows都能搞。","like_count":0},{"had_liked":false,"id":169993,"user_name":"wakaka","can_delete":false,"product_type":"c1","uid":1471508,"ip_address":"","ucode":"835A7341577D3B","user_header":"https://static001.geekbang.org/account/avatar/00/16/74/14/ea854bfc.jpg","comment_is_top":false,"comment_ctime":1578489738,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578489738","product_id":100020901,"comment_content":"讲的很透彻。","like_count":0},{"had_liked":false,"id":169405,"user_name":"wakaka","can_delete":false,"product_type":"c1","uid":1471508,"ip_address":"","ucode":"835A7341577D3B","user_header":"https://static001.geekbang.org/account/avatar/00/16/74/14/ea854bfc.jpg","comment_is_top":false,"comment_ctime":1578327983,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578327983","product_id":100020901,"comment_content":"循序渐进，讲的很清楚","like_count":0},{"had_liked":false,"id":167670,"user_name":"深圳小草","can_delete":false,"product_type":"c1","uid":1585495,"ip_address":"","ucode":"F05D485AF07D8F","user_header":"https://static001.geekbang.org/account/avatar/00/18/31/57/b2f831a7.jpg","comment_is_top":false,"comment_ctime":1577890562,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577890562","product_id":100020901,"comment_content":"怎么没讲iostat","like_count":0},{"had_liked":false,"id":167363,"user_name":"Cy23","can_delete":false,"product_type":"c1","uid":1591293,"ip_address":"","ucode":"8DC561C5151758","user_header":"https://static001.geekbang.org/account/avatar/00/18/47/fd/895f0c27.jpg","comment_is_top":false,"comment_ctime":1577775905,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577775905","product_id":100020901,"comment_content":"感谢","like_count":0},{"had_liked":false,"id":166369,"user_name":"zmysang","can_delete":false,"product_type":"c1","uid":1642663,"ip_address":"","ucode":"8A98057E7819DD","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/tjhOILHBAmlx6YiaTZJzqzxn1uyB6XpdvGDIZhBn127TYEcoLLzxRiaKvtVd3HllQqPx7cqf2YmibyBUgGGGJPDkw/132","comment_is_top":false,"comment_ctime":1577439268,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577439268","product_id":100020901,"comment_content":"请问老师，io密集型测试时，mpstat命令产生的数据中会存在两个cpu的sys和iowait都比较高的情况，不明白为什么一个进程会影响到两个CPU？<br>05:31:24 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>05:31:29 PM  all    0.41    0.00   45.68    4.07    0.00    0.10    0.00    0.00    0.00   49.75<br>05:31:29 PM    0    0.20    0.00   54.77    6.09    0.00    0.00    0.00    0.00    0.00   38.95<br>05:31:29 PM    1    0.41    0.00   36.63    2.06    0.00    0.00    0.00    0.00    0.00   60.91<br>","like_count":0},{"had_liked":false,"id":165915,"user_name":"木木","can_delete":false,"product_type":"c1","uid":1171796,"ip_address":"","ucode":"18E2A1F55067DC","user_header":"https://static001.geekbang.org/account/avatar/00/11/e1/54/206dfa56.jpg","comment_is_top":false,"comment_ctime":1577344679,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577344679","product_id":100020901,"comment_content":"如果cpu使用率包括io等待或者系统态，除了idle状态都算在干活，那么cpu利用率与平均负载是不是也算成正比呢","like_count":0},{"had_liked":false,"id":162234,"user_name":"左氧佛沙星人","can_delete":false,"product_type":"c1","uid":1195278,"ip_address":"","ucode":"0D8295E1DABA8C","user_header":"https://static001.geekbang.org/account/avatar/00/12/3d/0e/92176eaa.jpg","comment_is_top":false,"comment_ctime":1576482150,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1576482150","product_id":100020901,"comment_content":"老师好，我的软中断过高，我看了下，  SCHED&#47;TIMER 都非常高，查资料也没有明显的思路，能指点一二吗？","like_count":0},{"had_liked":false,"id":160487,"user_name":"悸动","can_delete":false,"product_type":"c1","uid":1765212,"ip_address":"","ucode":"5D7FBE7538D6E4","user_header":"https://static001.geekbang.org/account/avatar/00/1a/ef/5c/6b91c31a.jpg","comment_is_top":false,"comment_ctime":1575961992,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575961992","product_id":100020901,"comment_content":"作者好，问个问题吧，照着文中操作的，然后cpu不高，进程就3个，io不高，但是就是平均负载高，8核的虚拟机，不知道对虚拟机有效不？然后物理机是40核的，整个物理机目前就我这一个虚拟机，不知道平均负载怎么高的","like_count":0},{"had_liked":false,"id":160141,"user_name":"刘友淙","can_delete":false,"product_type":"c1","uid":1620058,"ip_address":"","ucode":"97F3A69A308313","user_header":"","comment_is_top":false,"comment_ctime":1575878826,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575878826","product_id":100020901,"comment_content":"D2打卡","like_count":0},{"had_liked":false,"id":159481,"user_name":"Geek_2dfa32","can_delete":false,"product_type":"c1","uid":1765555,"ip_address":"","ucode":"009D8D3B6A8942","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/HvsSkXDC0A2hxOHictAG4gEXWDXEZgsU9KSbyTcD8C1jQD1JjwlGsNTQLSy92fs7LVKHlFM7MaCle1gyK66GNqQ/132","comment_is_top":false,"comment_ctime":1575634590,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575634590","product_id":100020901,"comment_content":"问题1：当平均负载为0.5，还未超过CPU的个数的时候，CPU的使用率就达到了100%？                                               问题2：pidstat监控的时候，发现%cpu为100%，%wait为0.2%。pidstat数据总和不是只有100%吗？                   问题3：CPU密集型进程在找到CPU使用率为100%的进程之后，后续如何找到对应该进程的函数，从而获取根源问题并解决","like_count":0},{"had_liked":false,"id":159479,"user_name":"Geek_2dfa32","can_delete":false,"product_type":"c1","uid":1765555,"ip_address":"","ucode":"009D8D3B6A8942","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/HvsSkXDC0A2hxOHictAG4gEXWDXEZgsU9KSbyTcD8C1jQD1JjwlGsNTQLSy92fs7LVKHlFM7MaCle1gyK66GNqQ/132","comment_is_top":false,"comment_ctime":1575634285,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575634285","product_id":100020901,"comment_content":"问题1：当1分钟的平均负载为0.5的时候，平均负载还没有超过CPU个数，为什么CPU的使用率就达到了100%？","like_count":0},{"had_liked":false,"id":159136,"user_name":"pythonbug","can_delete":false,"product_type":"c1","uid":1487274,"ip_address":"","ucode":"1A70CA92FFF8EB","user_header":"https://wx.qlogo.cn/mmopen/vi_32/wgMMrp1hvSB3E30KqZvMsj3KQdAI3T1uQM77LT7hZ65nVSjPGRg3AbUOyiahnssA6AIT5PAkyHFmlTBzUH9gdyQ/132","comment_is_top":false,"comment_ctime":1575545396,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1575545396","product_id":100020901,"comment_content":"打卡第三天","like_count":0},{"had_liked":false,"id":158243,"user_name":"拯救地球好累","can_delete":false,"product_type":"c1","uid":1339022,"ip_address":"","ucode":"7643439601EF4C","user_header":"https://static001.geekbang.org/account/avatar/00/14/6e/8e/5d309a85.jpg","comment_is_top":false,"comment_ctime":1575356098,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575356098","product_id":100020901,"comment_content":"遇到问题时，尤其是基础问题，需要多问自己几个为什么，保证自己能解释得通，彻底理解现象背后的本质原理。<br>平均负载指的是单位时间内的平均活跃进程数（可运行状态和不可中断状态）<br>可运行状态指的是正在使用或等待CPU的进程<br>不可中断状态是由于进程进入内核态的一些关键方法中且无法被中断的状态<br>分析平均负载，需要结合CPU个数和核数、三个统计值、CPU情况、IO情况，并利用mpstat,pidstat,htop等工具来进行综合分析","like_count":0},{"had_liked":false,"id":157669,"user_name":"千回百转无劫山","can_delete":false,"product_type":"c1","uid":1456256,"ip_address":"","ucode":"2C249889C00929","user_header":"","comment_is_top":false,"comment_ctime":1575245214,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1575245214","product_id":100020901,"comment_content":"学习完，总结一下。<br>1、平均负载的本质是平均活跃进程数量：正运行和不可打断的。这也就理解为啥这个数量等于CPU核数的状态最理想了。<br>2、排查问题时要注意分情况讨论：CPU密集型，IO密集型和多进程三种情况。<br>3、IO wait也会增加负载，因为他属于不可打断的进程。<br>4、stress是个不错的性能压测软件。简单实用。","like_count":0},{"had_liked":false,"id":155492,"user_name":"xdargs","can_delete":false,"product_type":"c1","uid":1063740,"ip_address":"","ucode":"EB8326D3A72DE5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoH9Mlw0kLK0p39vhQpdvkbQP5TX96DB9HMJ1POaTVDpMZg4rjlO3WCAqiaWWMc77ffS3vTo8qWdXA/132","comment_is_top":false,"comment_ctime":1574692512,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1574692512","product_id":100020901,"comment_content":"以前简单用过pidstat，这次之后更能掌握使用了，mpstat看整体情况，pidstat定位具体进程，uptime看平均负载是否偏高来初步判断有io或者cpu导致负载高，另外了解到watch的-d选项，很实用","like_count":0},{"had_liked":false,"id":149631,"user_name":"Shane","can_delete":false,"product_type":"c1","uid":1291344,"ip_address":"","ucode":"322D0A883BAF16","user_header":"https://static001.geekbang.org/account/avatar/00/13/b4/50/c5dad2dc.jpg","comment_is_top":false,"comment_ctime":1573293741,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1573293741","product_id":100020901,"comment_content":"第二遍看这篇文章了，回头再看的时候，之前没有注意到的地方现在越看越不对了。再向老师提几个问题。<br><br>在IO密集型测试过程中，使用stress-ng -i 1 --hdd 1 --timeout 600来对机器造成iowait压力。通过top命令可以发现cpu的iowait列明显上升，上升到了70%-80%。然后，使用源码安装的新版的pidstat来查看进程的cpu情况。发现sys的使用率为30%左右，但是iowait为2.5%。<br><br>另外发现老师案例中的也是这种情况，mpstat中的iowait很高，大概为40%左右。但是，通过pidstat查看到的iowait只是3-4%左右。<br><br>请老师解惑。","like_count":0,"discussions":[{"author":{"id":1291344,"avatar":"https://static001.geekbang.org/account/avatar/00/13/b4/50/c5dad2dc.jpg","nickname":"Shane","note":"","ucode":"322D0A883BAF16","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":125902,"discussion_content":"要使用新版的pidstat","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578495074,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1585495,"avatar":"https://static001.geekbang.org/account/avatar/00/18/31/57/b2f831a7.jpg","nickname":"深圳小草","note":"","ucode":"F05D485AF07D8F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":113181,"discussion_content":"pidstat哪里有iowait","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577891044,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":147043,"user_name":"鱼君","can_delete":false,"product_type":"c1","uid":1402505,"ip_address":"","ucode":"40F1A109B9ECE0","user_header":"https://static001.geekbang.org/account/avatar/00/15/66/89/af017dba.jpg","comment_is_top":false,"comment_ctime":1572774429,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572774429","product_id":100020901,"comment_content":"记忆:<br>uptime up_time<br>mpstat mp (mulit_process_stat) cpu_stat<br>pidstat pid_stat process_stat<br>","like_count":0},{"had_liked":false,"id":145648,"user_name":"xiaoxlm_0807","can_delete":false,"product_type":"c1","uid":1586508,"ip_address":"","ucode":"32B587038282BC","user_header":"","comment_is_top":false,"comment_ctime":1572336666,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572336666","product_id":100020901,"comment_content":"学习总结一下：<br><br>什么是平均负载(load average)<br><br>man uptime里面的描述:<br><br>System  load  averages is the average number of processes that are either in a runnable or uninterruptable state.  A process in a runnable state is either using the CPU or waiting to use the CPU.  A process in uninterruptable state is waiting for some I&#47;O access, eg waiting for disk.<br><br>也就是说平均负载说的所有进程使用cpu，i&#47;o资源总和的平均使用率。<br><br>所以负载高不一定就是cpu使用率高，也有可能是等待i&#47;o的进程比较多。i&#47;o等待进程比较多，一般会导致系统cpu使用率上升，因为会有大量用户态和内核态切换。<br><br>通过mpstat可以查看具体的负载，通过pidstat锁定告负载进程。<br>","like_count":0},{"had_liked":false,"id":143576,"user_name":"Dym","can_delete":false,"product_type":"c1","uid":1205036,"ip_address":"","ucode":"7E521F01A4D823","user_header":"","comment_is_top":false,"comment_ctime":1571736115,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571736115","product_id":100020901,"comment_content":"总结：<br>1、评判性能指标  从用户角度 响应快不卡 和 大量用户使用这个软件   从系统(可以从上至下一层一层检查性能优化点 Application-&gt;Lib-&gt;System call-&gt;系统内核-&gt;硬件(CPU、内存、硬盘) )角度：延迟低和吞吐量大<br><br>2、对系统各项指标例如CPU利用率、内存利用率、I&#47;O等进行监控和报警<br><br>3、知道系统有性能问题后，通过性能排查工具例如 uptime(当前平均活跃线程数也就是平均负载)  top、mpstata、pidstat 等工具确定是CPU密集型还是I&#47;O密集型，最终定位到那个进程。<br><br>4、如何进行对系统优化(这个是我们需要一起学习的地方)，优化完后需要进行测试对我们优化结果进行复盘","like_count":0},{"had_liked":false,"id":142353,"user_name":"橄榄树","can_delete":false,"product_type":"c1","uid":1030751,"ip_address":"","ucode":"74F6272CD0B3D0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ba/5f/bab32b7a.jpg","comment_is_top":false,"comment_ctime":1571358806,"is_pvip":false,"replies":[{"id":"55338","content":"请参考置顶回复","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1571665087,"ip_address":"","comment_id":142353,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1571358806","product_id":100020901,"comment_content":"你好 我执行stress -i 1 —timeout 600后为什么iowait还是0？测试了几个机器都这样.","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471078,"discussion_content":"请参考置顶回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571665087,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142208,"user_name":"马潮毅","can_delete":false,"product_type":"c1","uid":1486959,"ip_address":"","ucode":"F3F9FE4A7A0D5A","user_header":"https://static001.geekbang.org/account/avatar/00/16/b0/6f/6c1860db.jpg","comment_is_top":false,"comment_ctime":1571311919,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571311919","product_id":100020901,"comment_content":"老师，我的服务器是 CentOS7.6 内核 5.x 的，16核 CPU，32GB 内存。使用 wrk --latency -c 400 -d 1000 https:&#47;&#47;test.local.cn&#47;  ，站点环境基于 Lnmp 1.6 稳定版，部署在 nginx 1.16.x 版本，PHP环境是 PHP 7.3.10，单纯输出一个json数据。服务器外网带宽20M，内网带宽1000M。进行压测，发现所有的 cpu 的 us 在 20-30，st 在40 -60, id 在10-20，最后出来的 rps 只有 1500+。调整很多配置，发现都没有什么效果。请教下老师，还有可能是什么原因导致的吗？","like_count":0},{"had_liked":false,"id":141344,"user_name":"TTTTan","can_delete":false,"product_type":"c1","uid":1669818,"ip_address":"","ucode":"709B6AD19750A1","user_header":"https://static001.geekbang.org/account/avatar/00/19/7a/ba/2850504a.jpg","comment_is_top":false,"comment_ctime":1571142567,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571142567","product_id":100020901,"comment_content":"老师问一下，<br>场景二：I&#47;O 密集型进程中，<br>mpstat命令显示的iowait第一行ALL的百分比32.27是啥意思呢？代表所有进程占用IO的百分比32？那距离100%不是很远么？","like_count":0},{"had_liked":false,"id":138685,"user_name":"hadoop_admin","can_delete":false,"product_type":"c1","uid":1300466,"ip_address":"","ucode":"7EAFA775505C7E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJGMphabeneYXs9otkAtr67RvxJClDa7jPe7w8yExg4YaS2FGJruDKMj5yN1E90o6MFibnicH8gM0ibg/132","comment_is_top":false,"comment_ctime":1570420579,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570420579","product_id":100020901,"comment_content":"再来看CPU的性能课程，这章节中CPU平均负载不是看CPU的个数吧？是看CPU的逻辑核数，一般cpu的个数都是2个、4个等，每个CPU有多核，每核可以有多个逻辑核。不知道这样是否理解正确","like_count":0},{"had_liked":false,"id":138568,"user_name":"东风21D","can_delete":false,"product_type":"c1","uid":1477643,"ip_address":"","ucode":"2CA99FB1E185A2","user_header":"https://static001.geekbang.org/account/avatar/00/16/8c/0b/f5e08cde.jpg","comment_is_top":false,"comment_ctime":1570341826,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570341826","product_id":100020901,"comment_content":"老师，在场景三时候使用mpstat查看，cpu都是基本100%空闲，使用pidstat确认看出stress占用了所有的cpu，这是为什么呢？","like_count":0},{"had_liked":false,"id":138438,"user_name":"李顺标","can_delete":false,"product_type":"c1","uid":1620062,"ip_address":"","ucode":"C7D68E4DED775C","user_header":"","comment_is_top":false,"comment_ctime":1570242035,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570242035","product_id":100020901,"comment_content":"实际案列中测试环境，使用虚拟机估计上不来吧，电脑大多都是单CPU","like_count":0},{"had_liked":false,"id":137019,"user_name":"嘉木","can_delete":false,"product_type":"c1","uid":1317999,"ip_address":"","ucode":"AF4877693782C0","user_header":"https://static001.geekbang.org/account/avatar/00/14/1c/6f/3ea2a599.jpg","comment_is_top":false,"comment_ctime":1569577368,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569577368","product_id":100020901,"comment_content":"平均负载为什么是定义为R+D状态的进程？","like_count":0},{"had_liked":false,"id":136084,"user_name":"韦","can_delete":false,"product_type":"c1","uid":1282724,"ip_address":"","ucode":"A4A66CD1023C3D","user_header":"https://static001.geekbang.org/account/avatar/00/13/92/a4/9eeb686d.jpg","comment_is_top":false,"comment_ctime":1569341178,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569341178","product_id":100020901,"comment_content":"老师：进程状态为D没有等待CPU而是在等待资源，为什么把这种进程状态也算到CPU的负载里面，因为其往往很快变成R？","like_count":0},{"had_liked":false,"id":135351,"user_name":"『道』","can_delete":false,"product_type":"c1","uid":1537058,"ip_address":"","ucode":"A5B41F375F86CB","user_header":"https://static001.geekbang.org/account/avatar/00/17/74/22/9efe8ba4.jpg","comment_is_top":false,"comment_ctime":1569135600,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1569135600","product_id":100020901,"comment_content":"平均负载是统计的进程数 还是线程数？  我随便写了一个java代码， 开辟一个大小为30的线程池， 提交50个线程， 运行起来后， load值会上涨为30左右。  所以， 这里是不是线程数 更准确呢？ @倪朋飞 老师","like_count":0,"discussions":[{"author":{"id":1098987,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/eb/2285a345.jpg","nickname":"花晨少年","note":"","ucode":"6AA3537A6BA10E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":105887,"discussion_content":"嗯，我也觉得是线程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577497219,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":134665,"user_name":"痞子胥","can_delete":false,"product_type":"c1","uid":1617678,"ip_address":"","ucode":"3701A981FFF083","user_header":"","comment_is_top":false,"comment_ctime":1568888552,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568888552","product_id":100020901,"comment_content":"老师啊 问个迷惑的地方。。。案例场景三 大量进程场景中讲到 8个进程抢占 2两个CPU 这段没理解:  是指这8个进程 谁抢到 谁使用的意思吗？比如 进程1 抢到了 可以使用,接着 进程2 抢到了 进程1 正在使用的 进程2 进行了 ,然后 进程1 再去抢占。。还是只要一旦抢占成功 就执行完毕 才让给其他的进程？<br>","like_count":0},{"had_liked":false,"id":130976,"user_name":"不了峰","can_delete":false,"product_type":"c1","uid":1013424,"ip_address":"","ucode":"E23B96D6A3D4EC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","comment_is_top":false,"comment_ctime":1567587334,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567587334","product_id":100020901,"comment_content":"老师，我在测试 场景二：I&#47;O 密集型进程<br>时， 不是iowait高，而是 sys高起来。 <br>环境是<br>[root@i]# cat &#47;etc&#47;issue<br>Amazon Linux AMI release 2018.03<br>Kernel \\r on an \\m<br><br>[root@i ]# uname -a<br>Linux i 4.14.123-86.109.amzn1.x86_64 #1 SMP Mon Jun 10 19:44:53 UTC 2019 x86_64 x86_64 x86_64 GNU&#47;Linux<br>pidstat -u 5 10<br>08时52分11秒       PID    %usr %system  %guest    %CPU   CPU  Command<br>08时52分16秒      4304    9.80   90.20    0.00  100.00     0  stress<br>08时52分16秒      4343    0.20    0.00    0.00    0.20     0  pidstat<br><br>mpstat -P ALL 5<br>08时53分31秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest   %idle<br>08时53分36秒  all    9.60    0.00   90.40    0.00    0.00    0.00    0.00    0.00    0.00<br>08时53分36秒    0    9.60    0.00   90.40    0.00    0.00    0.00    0.00    0.00    0.00<br>","like_count":0},{"had_liked":false,"id":129318,"user_name":"song","can_delete":false,"product_type":"c1","uid":1008214,"ip_address":"","ucode":"8CE0E52D237EB9","user_header":"https://static001.geekbang.org/account/avatar/00/0f/62/56/293bb1a8.jpg","comment_is_top":false,"comment_ctime":1567086473,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567086473","product_id":100020901,"comment_content":"我理解cpu调度是以线程为单位的，而平均负载是用活跃进程数计算得到的，所以反映不了cpu的实际使用情况吧。举个例子，一个单核机器跑一个单线程的进程，平均负载是1；跑一个有10个线程的进程，平均负载也是1。这样看来平均负载跟cpu是否繁忙并不相关啊","like_count":0},{"had_liked":false,"id":129090,"user_name":"Ethan","can_delete":false,"product_type":"c1","uid":1246017,"ip_address":"","ucode":"6856180D7B2525","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/41/ba59e1ee.jpg","comment_is_top":false,"comment_ctime":1567040968,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1567040968","product_id":100020901,"comment_content":"平时一般用的工具是nmon，还真没有注意平均负载这个指标，原来还有这么多门道，受用受用。<br><br>另外，请教个问题，cpu的使用，如果sys比例很高，一般是表示系统调用很多，这些系统调用一般是I&#47;O？","like_count":0,"discussions":[{"author":{"id":1805809,"avatar":"","nickname":"ccz 开发(谢不邀)","note":"","ucode":"B8803B050AAC68","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":132339,"discussion_content":"一样的，nmon一般都关注实时变化，然后把实时的这几个数字转成图像了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578899353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128797,"user_name":"这菜真香呀","can_delete":false,"product_type":"c1","uid":1046661,"ip_address":"","ucode":"13692E295A6A47","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/85/3c072e6f.jpg","comment_is_top":false,"comment_ctime":1566964003,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566964003","product_id":100020901,"comment_content":"mpstat 在48core物理机会看起来数据量太多..难以快速定位 orz","like_count":0},{"had_liked":false,"id":126545,"user_name":"GeekCoder","can_delete":false,"product_type":"c1","uid":1523315,"ip_address":"","ucode":"14BB73CBE28545","user_header":"","comment_is_top":false,"comment_ctime":1566406155,"is_pvip":false,"replies":[{"id":"47199","content":"平均值可以是小数的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1566743029,"ip_address":"","comment_id":126545,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566406155","product_id":100020901,"comment_content":"老师，请教下，简单来说，平均负载是指单位时间内，系统处于可运行状态和不可中断状态的平均进程数，也就是平均活跃进程数，为什么看到这个负载还有0.xxx的？难道说进程数还有半个的吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464048,"discussion_content":"平均值可以是小数的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566743029,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125495,"user_name":"fishfish","can_delete":false,"product_type":"c1","uid":1625904,"ip_address":"","ucode":"E084AA32786652","user_header":"https://static001.geekbang.org/account/avatar/00/18/cf/30/43211537.jpg","comment_is_top":false,"comment_ctime":1566194141,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566194141","product_id":100020901,"comment_content":"5 users,——》老师这里的ps是不是应该换成top呀","like_count":0},{"had_liked":false,"id":124196,"user_name":"xiao皮孩。。","can_delete":false,"product_type":"c1","uid":1367499,"ip_address":"","ucode":"27AE899819D10F","user_header":"https://static001.geekbang.org/account/avatar/00/14/dd/cb/23b114a7.jpg","comment_is_top":false,"comment_ctime":1565833532,"is_pvip":false,"replies":[{"id":"45965","content":"查一查IO是不是变高了？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1566132773,"ip_address":"","comment_id":124196,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1565833532","product_id":100020901,"comment_content":"大量RPC请求会告警load高，cpu使用率不高是为啥呢？望解答，谢谢。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463052,"discussion_content":"查一查IO是不是变高了？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566132773,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":123688,"user_name":"啦啦啦","can_delete":false,"product_type":"c1","uid":1131687,"ip_address":"","ucode":"6B12EC90A62525","user_header":"https://static001.geekbang.org/account/avatar/00/11/44/a7/171c1e86.jpg","comment_is_top":false,"comment_ctime":1565743799,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565743799","product_id":100020901,"comment_content":"二刷","like_count":0},{"had_liked":false,"id":122557,"user_name":"lewis","can_delete":false,"product_type":"c1","uid":1253640,"ip_address":"","ucode":"128DA8287C180B","user_header":"https://static001.geekbang.org/account/avatar/00/13/21/08/94d145c1.jpg","comment_is_top":false,"comment_ctime":1565423302,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565423302","product_id":100020901,"comment_content":"uptime 命令可以用来查看服务器已经运行了多久，当前登录的用户有多少，以及服务器在过去的1分钟、5分钟、15分钟的系统平均负载值。<br>平均负载的最佳值是1，这意味着每个进程都可以立即执行不会错过CPU周期。负载的正常值在不同的系统中有着很大的差别。在单处理器的工作站中，1或2都是可以接受的。然而在多处理器的服务器上你可能看到8到10。<br>mpstat，全称为Multiprocessor Statistics。是实时系统监控工具。当没有参数时，mpstat则显示系统启动以后所有信息的平均值。有interval时，第一行的信息自系统启动以来的平均信息。从第二行开始，输出为前一个interval时间段的平均信息。<br>mpstat [-P {|ALL}] [internal [count]]<br>参数 解释<br>-P {|ALL} 表示监控哪个CPU， cpu在[0,cpu个数-1]中取值<br>internal 相邻的两次采样的间隔时间、<br>count 采样的次数，count只能和delay一起使用<br>","like_count":0},{"had_liked":false,"id":122290,"user_name":"~尘曦~","can_delete":false,"product_type":"c1","uid":1175695,"ip_address":"","ucode":"BFA7E7DBD9047B","user_header":"https://static001.geekbang.org/account/avatar/00/11/f0/8f/ca9fded0.jpg","comment_is_top":false,"comment_ctime":1565331396,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565331396","product_id":100020901,"comment_content":"Message from syslogd@hadoop-1 at Aug  9 12:10:50 ...<br> kernel:NMI watchdog: BUG: soft lockup - CPU#0 stuck for 24s! [etcd:31794]<br>我的虚拟机跑k8s集群报这样的错误尴尬<br><br>Message from syslogd@hadoop-1 at Aug  9 12:10:50 ...<br> kernel:NMI watchdog: BUG: soft lockup - CPU#0 stuck for 23s! [kworker&#47;0:1:40]<br>","like_count":0},{"had_liked":false,"id":119685,"user_name":"afterdream","can_delete":false,"product_type":"c1","uid":1619795,"ip_address":"","ucode":"701AD039459191","user_header":"https://static001.geekbang.org/account/avatar/00/18/b7/53/823f647c.jpg","comment_is_top":false,"comment_ctime":1564651799,"is_pvip":false,"replies":[{"id":"44412","content":"不只是进程数增多，活跃进程数也增多（比如增加了一个CPU使用率总是100%的进程，平均活跃进程也就增加了1）","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1565016640,"ip_address":"","comment_id":119685,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1564651799","product_id":100020901,"comment_content":"使用stress -i 1或者stress -c 1都是仅仅创建一个进程，那为什么load average会升高<br>load average的概念是平均活跃进程数，难道上面两个负载都会导致进程数增多？？<br>还请老师指点一下！<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461017,"discussion_content":"不只是进程数增多，活跃进程数也增多（比如增加了一个CPU使用率总是100%的进程，平均活跃进程也就增加了1）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565016640,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":119359,"user_name":"Ken","can_delete":false,"product_type":"c1","uid":1102641,"ip_address":"","ucode":"35E2CF86E56F14","user_header":"https://static001.geekbang.org/account/avatar/00/10/d3/31/cf7e9aea.jpg","comment_is_top":false,"comment_ctime":1564570813,"is_pvip":false,"replies":[{"id":"44417","content":"具体工具具体分析，比如这里stress的CPU压力很容易通过CPU观测工具查看到","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1565016896,"ip_address":"","comment_id":119359,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1564570813","product_id":100020901,"comment_content":"问一下老师，工具产生的并发数，怎么查看就是都压到了服务器上面？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460866,"discussion_content":"具体工具具体分析，比如这里stress的CPU压力很容易通过CPU观测工具查看到","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565016896,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117561,"user_name":"刘三通","can_delete":false,"product_type":"c1","uid":1201414,"ip_address":"","ucode":"A89C586FC1EE3E","user_header":"https://static001.geekbang.org/account/avatar/00/12/55/06/a495741c.jpg","comment_is_top":false,"comment_ctime":1564084180,"is_pvip":true,"replies":[{"id":"43474","content":"需要安装一下，比如 apt install stress","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1564410516,"ip_address":"","comment_id":117561,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1564084180","product_id":100020901,"comment_content":"stress包找不到 谁给分享个","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460024,"discussion_content":"需要安装一下，比如 apt install stress","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564410516,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":116925,"user_name":"BEN","can_delete":false,"product_type":"c1","uid":1274111,"ip_address":"","ucode":"7154F0B5FE4944","user_header":"https://static001.geekbang.org/account/avatar/00/13/70/ff/a255b4b3.jpg","comment_is_top":false,"comment_ctime":1563939224,"is_pvip":false,"replies":[{"id":"43469","content":"请参考置顶回复","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1564410034,"ip_address":"","comment_id":116925,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563939224","product_id":100020901,"comment_content":"案例二，请问下为什么我的iowait只是0.3左右的？centos7","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459737,"discussion_content":"请参考置顶回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564410034,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115675,"user_name":"猫小妖的尾巴","can_delete":false,"product_type":"c1","uid":1309248,"ip_address":"","ucode":"250777C6DFC468","user_header":"https://static001.geekbang.org/account/avatar/00/13/fa/40/6f4949d3.jpg","comment_is_top":false,"comment_ctime":1563693296,"is_pvip":false,"replies":[{"id":"42486","content":"升级sysstat版本，新版本才有这个输出","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1563805041,"ip_address":"","comment_id":115675,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563693296","product_id":100020901,"comment_content":"老师，pidstat命令就没有wait的值，我用我们的测试环境测试的，版本是Linux 3.2.0-136-custom (ubuntu)，生产环境版本虽然不一样也没有wait那一列","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459222,"discussion_content":"升级sysstat版本，新版本才有这个输出","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563805041,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114068,"user_name":"tinyfool","can_delete":false,"product_type":"c1","uid":1604827,"ip_address":"","ucode":"8B93B6A9FBEA12","user_header":"","comment_is_top":false,"comment_ctime":1563235766,"is_pvip":false,"replies":[{"id":"41978","content":"各个进程的CPU使用率是多少？升级 sysstat 试试？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1563456655,"ip_address":"","comment_id":114068,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563235766","product_id":100020901,"comment_content":"我的机器是4个核，在场景三实验中，模拟了16个进程，机器的平均负载达到了16左右，但是pidstat输出的%wait这一列值都是0；模拟更多的进程，%wait依然都是0；一时不知道如何排查这个问题了，希望老师可以指点下，多谢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458502,"discussion_content":"各个进程的CPU使用率是多少？升级 sysstat 试试？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563456655,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112957,"user_name":"hana","can_delete":false,"product_type":"c1","uid":1600146,"ip_address":"","ucode":"CC1368CC17BC4B","user_header":"https://static001.geekbang.org/account/avatar/00/18/6a/92/0877ed15.jpg","comment_is_top":false,"comment_ctime":1562854502,"is_pvip":false,"replies":[{"id":"41989","content":"对于CPU密集型进程，多进程运行在相同CPU上会有竞争","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1563457922,"ip_address":"","comment_id":112957,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562854502","product_id":100020901,"comment_content":"为什么一个cpu最好跑一个进程？不是俩进程呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457975,"discussion_content":"对于CPU密集型进程，多进程运行在相同CPU上会有竞争","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563457922,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110958,"user_name":"Geek_25565b","can_delete":false,"product_type":"c1","uid":1592987,"ip_address":"","ucode":"0C3A01C4B0AB66","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/CV9kk5M26pdIuAxwdXvj90ewKECzdSmzO4ibP6iaLXY50hICibefmib4qGvu1wCSfXuRobFC86z7W3OcfncpV8Uevw/132","comment_is_top":false,"comment_ctime":1562402713,"is_pvip":true,"replies":[{"id":"40439","content":"这个说的是wait吧？需要升级 sysstat 的版本","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1562509602,"ip_address":"","comment_id":110958,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562402713","product_id":100020901,"comment_content":"老师，centos上用pidstat没有iowait这个指标，我该怎么办？用那个工具代替？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457141,"discussion_content":"这个说的是wait吧？需要升级 sysstat 的版本","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562509602,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110956,"user_name":"Geek_25565b","can_delete":false,"product_type":"c1","uid":1592987,"ip_address":"","ucode":"0C3A01C4B0AB66","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/CV9kk5M26pdIuAxwdXvj90ewKECzdSmzO4ibP6iaLXY50hICibefmib4qGvu1wCSfXuRobFC86z7W3OcfncpV8Uevw/132","comment_is_top":false,"comment_ctime":1562402492,"is_pvip":true,"replies":[{"id":"40438","content":"pidstat本来就没有iowait这个指标","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1562509582,"ip_address":"","comment_id":110956,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562402492","product_id":100020901,"comment_content":"我用pidstat 在centos上，为什么没有，iowait这个指标？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457140,"discussion_content":"pidstat本来就没有iowait这个指标","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562509582,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110889,"user_name":"yskyj","can_delete":false,"product_type":"c1","uid":1192311,"ip_address":"","ucode":"B44774A5259ACF","user_header":"https://static001.geekbang.org/account/avatar/00/12/31/77/601b216b.jpg","comment_is_top":false,"comment_ctime":1562383789,"is_pvip":false,"replies":[{"id":"40445","content":"一般是指后者","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1562510385,"ip_address":"","comment_id":110889,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562383789","product_id":100020901,"comment_content":"想问下老师，“当平均负载高于 CPU 数量 70% 的时候，你就应该分析排查负载高的问题了。”<br><br>这里的cpu数量是 sockets * cores * threads 还是 sockets * cores？  ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457111,"discussion_content":"一般是指后者","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562510385,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110390,"user_name":"东门吸血","can_delete":false,"product_type":"c1","uid":1231335,"ip_address":"","ucode":"FD42F0BCEB2CC8","user_header":"","comment_is_top":false,"comment_ctime":1562247790,"is_pvip":false,"replies":[{"id":"40089","content":"不适合，但如果是 WSL2 的话倒是可以的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1562249147,"ip_address":"","comment_id":110390,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562247790","product_id":100020901,"comment_content":"不懂就问，使用Windows的Linux子系统跟着老师操作，安装的Ubuntu18，机器配置i7 4核，但是从 &#47;proc&#47;cpuinfo 得到的信息是8核， 然后stress之后 watch -d uptime , 几个数字一点都不变，之后mpstat 和 pidstat的信息里wait都是0（stress -u&#47;i 20也是0），请问是否不适合用这个系统来进行操作","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456853,"discussion_content":"不适合，但如果是 WSL2 的话倒是可以的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562249147,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109890,"user_name":"Demon.Lee","can_delete":false,"product_type":"c1","uid":1052859,"ip_address":"","ucode":"7F0E5493A8E345","user_header":"https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg","comment_is_top":false,"comment_ctime":1562125939,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1562125939","product_id":100020901,"comment_content":"刚入手，学习了一章，就知道这门课靠谱，值！","like_count":0},{"had_liked":false,"id":108510,"user_name":"刺猬","can_delete":false,"product_type":"c1","uid":1201479,"ip_address":"","ucode":"79685DAB7020C5","user_header":"https://static001.geekbang.org/account/avatar/00/12/55/47/c412f973.jpg","comment_is_top":false,"comment_ctime":1561789521,"is_pvip":false,"replies":[{"id":"40095","content":"这种问题最好的答案是查看工具的手册，比如 man mpstat","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1562249639,"ip_address":"","comment_id":108510,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561789521","product_id":100020901,"comment_content":"老师，mpstat中的%nice是什么含义？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456017,"discussion_content":"这种问题最好的答案是查看工具的手册，比如 man mpstat","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562249639,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104590,"user_name":"白建国","can_delete":false,"product_type":"c1","uid":1303460,"ip_address":"","ucode":"7D5E4FE486E50E","user_header":"https://static001.geekbang.org/account/avatar/00/13/e3/a4/cbcf6685.jpg","comment_is_top":false,"comment_ctime":1560780523,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560780523","product_id":100020901,"comment_content":"p8工程师旁边应该也和p8差不多","like_count":0},{"had_liked":false,"id":104469,"user_name":"有点意思","can_delete":false,"product_type":"c1","uid":1399454,"ip_address":"","ucode":"67F55604E8A548","user_header":"https://static001.geekbang.org/account/avatar/00/15/5a/9e/8f2ccc1d.jpg","comment_is_top":false,"comment_ctime":1560760331,"is_pvip":true,"replies":[{"id":"38378","content":"使用读取结束的数据其实就变成使用CPU了","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1561215931,"ip_address":"","comment_id":104469,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560760331","product_id":100020901,"comment_content":"老师 好<br>为什么平均活跃进程包含了使用CPU 等待CPU  等待I&#47;O的进程<br>而没有包含使用I&#47;O的进程","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454281,"discussion_content":"使用读取结束的数据其实就变成使用CPU了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561215931,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":102818,"user_name":"Butter Fly","can_delete":false,"product_type":"c1","uid":1564473,"ip_address":"","ucode":"D2B488B465FC3C","user_header":"https://static001.geekbang.org/account/avatar/00/17/df/39/6ead11bc.jpg","comment_is_top":false,"comment_ctime":1560308729,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560308729","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":101997,"user_name":"Zack.汤","can_delete":false,"product_type":"c1","uid":1565547,"ip_address":"","ucode":"5F20929B0CA25A","user_header":"https://static001.geekbang.org/account/avatar/00/17/e3/6b/01f6a8ca.jpg","comment_is_top":false,"comment_ctime":1560092100,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560092100","product_id":100020901,"comment_content":"打卡，遇到基础问题要多问为什么","like_count":0},{"had_liked":false,"id":101725,"user_name":"keka","can_delete":false,"product_type":"c1","uid":1220702,"ip_address":"","ucode":"687E53AF4B0F3A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erfbtibbPk4VI9pInKXOhhH0349bic9XiaI4lrUDr8ByXOKoEicrOHeicEyfbrGjJ0RvACN7Bb0GcBPzyA/132","comment_is_top":false,"comment_ctime":1559935976,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559935976","product_id":100020901,"comment_content":"以前公众号看过其他大神写的关于平均负载的，道理都是对的，不过没有这个清楚明了","like_count":0},{"had_liked":false,"id":101646,"user_name":"little qiang","can_delete":false,"product_type":"c1","uid":1550178,"ip_address":"","ucode":"D53903360A2B6B","user_header":"https://static001.geekbang.org/account/avatar/00/17/a7/62/9fc69ecd.jpg","comment_is_top":false,"comment_ctime":1559899377,"is_pvip":false,"replies":[{"id":"37097","content":"为什么必然负载过高？大部分进程虽然运行，但并不是一直活跃的。如果真的是一直活跃，就应该对机器进行扩容了","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1560260450,"ip_address":"","comment_id":101646,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1559899377","product_id":100020901,"comment_content":"另外，还有个问题麻烦老师帮忙解答下，一台主机可能一般也就几个CPU，但是机器上同时在运行的程序肯定是不止几个，甚至几十几百个，这样必然会有评论负载过高的情况。对于这种情况，平均负载有优化的方法吗，或者对于这种情况linux性能有什么要注意优化点吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453053,"discussion_content":"为什么必然负载过高？大部分进程虽然运行，但并不是一直活跃的。如果真的是一直活跃，就应该对机器进行扩容了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560260450,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101643,"user_name":"little qiang","can_delete":false,"product_type":"c1","uid":1550178,"ip_address":"","ucode":"D53903360A2B6B","user_header":"https://static001.geekbang.org/account/avatar/00/17/a7/62/9fc69ecd.jpg","comment_is_top":false,"comment_ctime":1559898656,"is_pvip":false,"replies":[{"id":"37098","content":"嗯，这种情况很可能是IO导致的，最好持续监控CPU和IO情况","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1560260675,"ip_address":"","comment_id":101643,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1559898656","product_id":100020901,"comment_content":"老师，您好，看了您的课程，发现当前有台主机因进程数很多，导致平均负载过高，总共48个CPU，uptime结果平均负载达到了110左右，但是看sys和io等都不高，因为大部分进程都处于无数据处理状态。当前这种情况，平均负载过高只是一个参考，应该不用太关心吧，是不是只要在后期观察如果大量数据处理时，会不会导致sys或者io等等过高就可以吧。烦请老师答疑解惑","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453052,"discussion_content":"嗯，这种情况很可能是IO导致的，最好持续监控CPU和IO情况","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560260675,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101368,"user_name":"Hoboson!","can_delete":false,"product_type":"c1","uid":1341692,"ip_address":"","ucode":"D593C3EB90E136","user_header":"https://static001.geekbang.org/account/avatar/00/14/78/fc/f7d59501.jpg","comment_is_top":false,"comment_ctime":1559789613,"is_pvip":false,"replies":[{"id":"37099","content":"IO的排查可以参考后面的IO模块","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1560260752,"ip_address":"","comment_id":101368,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1559789613","product_id":100020901,"comment_content":"我们的mongodb服务逻辑cpu80个  load average现在高达140 cpu使用率很低 <br>使用pidstat -u 5 1 发现 mongod命令 cpu使用率100% 这个命令为什么没有io列 接下来怎么排查 求指导","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452932,"discussion_content":"IO的排查可以参考后面的IO模块","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560260752,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":100823,"user_name":"沉默","can_delete":false,"product_type":"c1","uid":1564862,"ip_address":"","ucode":"F3048FBEB743A9","user_header":"https://static001.geekbang.org/account/avatar/00/17/e0/be/38126cc2.jpg","comment_is_top":false,"comment_ctime":1559647059,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559647059","product_id":100020901,"comment_content":"平均负载是指单位时间内，处于可运行状态和不可中断状态的进程数。所以，它不仅包括了正在使用 CPU 的进程，还包括等待 CPU 和等待 I&#47;O 的进程。","like_count":0},{"had_liked":false,"id":100351,"user_name":"张伯毅","can_delete":false,"product_type":"c1","uid":1099929,"ip_address":"","ucode":"E9EAF5ECFE32C7","user_header":"https://static001.geekbang.org/account/avatar/00/10/c8/99/22d2a6a7.jpg","comment_is_top":false,"comment_ctime":1559533398,"is_pvip":false,"replies":[{"id":"36180","content":"CPU核数","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1559563166,"ip_address":"","comment_id":100351,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1559533398","product_id":100020901,"comment_content":"您好，计算平均负载的时候，需要知道系统由几个 CPU，这个 CPU 是指CPU 的核数还是线程数？<br><br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452511,"discussion_content":"CPU核数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559563166,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":100072,"user_name":"冬风向左吹","can_delete":false,"product_type":"c1","uid":1066928,"ip_address":"","ucode":"376C45C5134F93","user_header":"https://static001.geekbang.org/account/avatar/00/10/47/b0/a9b77a1e.jpg","comment_is_top":false,"comment_ctime":1559436656,"is_pvip":false,"replies":[{"id":"36183","content":"这是计算错误吧 找原始监控数据看看","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1559563252,"ip_address":"","comment_id":100072,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1559436656","product_id":100020901,"comment_content":"我们线上服务器cpu使用率达到了9223372036854083584.00，异常的大，应该怎么分析呢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452398,"discussion_content":"这是计算错误吧 找原始监控数据看看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559563252,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99938,"user_name":"果子","can_delete":false,"product_type":"c1","uid":1183897,"ip_address":"","ucode":"F5D833F423E1C8","user_header":"https://static001.geekbang.org/account/avatar/00/12/10/99/e547980d.jpg","comment_is_top":false,"comment_ctime":1559362890,"is_pvip":false,"replies":[{"id":"36193","content":"iotop也可以用","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1559563690,"ip_address":"","comment_id":99938,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1559362890","product_id":100020901,"comment_content":"老师为什么不直接用iotop定位哪个进程读写","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452333,"discussion_content":"iotop也可以用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559563690,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99753,"user_name":"天然","can_delete":false,"product_type":"c1","uid":1435982,"ip_address":"","ucode":"0F12BD470A8104","user_header":"https://static001.geekbang.org/account/avatar/00/15/e9/4e/22c73926.jpg","comment_is_top":false,"comment_ctime":1559292258,"is_pvip":false,"replies":[{"id":"35920","content":"麻烦贴一下全部的错误信息？一般来说，编译失败很可能是依赖库没有安装导致的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1559428645,"ip_address":"","comment_id":99753,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1559292258","product_id":100020901,"comment_content":"安装sysstat-11.7.4，执行make的时候报这个错 <br>make: *** [sadc] 错误 1<br>查不到是什么原因","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452255,"discussion_content":"麻烦贴一下全部的错误信息？一般来说，编译失败很可能是依赖库没有安装导致的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559428645,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99370,"user_name":"童年的记忆🌾","can_delete":false,"product_type":"c1","uid":1355704,"ip_address":"","ucode":"60FE5FDA96B050","user_header":"https://static001.geekbang.org/account/avatar/00/14/af/b8/e910f6ef.jpg","comment_is_top":false,"comment_ctime":1559201027,"is_pvip":false,"replies":[{"id":"35811","content":"这个原因比较多，推荐搭建监控系统，根据历史记录找出当时CPU身高的原因，进而再去进一步定位","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1559280089,"ip_address":"","comment_id":99370,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1559201027","product_id":100020901,"comment_content":"老师，我今天遇到一个问题，两台线上配置4c8g，正常情况下java进程内存使用率在60%，cpu使用率在20%。有一个时间点（12:25分），两台流量都增大差不多时，其中一台cpu使用率，负载显著增加，这台因为cpu打到了70%，引起dubbo请求的502超时。为什么环境类似的两台，表现却不一样，可能是什么因为导致的，谢谢。<br>有问题的一台：<br>30&#47;05&#47;19-12:10  29.07    29.13    29.22    29.40     29.21    72.81     0.00     1.8M  282.9K    1.52     0.19     0.19     0.14      0.61<br>30&#47;05&#47;19-12:15  29.47    29.27    30.13    29.84     29.68    72.84     0.00     1.9M  303.3K    1.58     0.07     0.07     0.13      0.09<br>30&#47;05&#47;19-12:20  50.39    50.52    50.17    50.44     50.38    72.86     0.00     4.0M  431.1K    3.36     0.09     0.09     0.13      0.75<br>30&#47;05&#47;19-12:25  75.95    74.74    76.60    75.38     75.67    73.73     0.00     6.7M  490.1K    5.65     0.10     0.10     0.15     25.91<br>30&#47;05&#47;19-12:30  36.14    35.88    34.83    34.56     35.35    73.71     0.00     2.0M  362.8K    1.72     0.07     0.07     0.13      0.57<br>30&#47;05&#47;19-12:35  25.37    25.16    25.70    25.69     25.48    73.67     0.00     1.1M  283.7K    0.95     0.07     0.07     0.15      0.20<br>没有问题的一台：<br>Time           --cpu0-- --cpu1-- --cpu2-- --cpu3--  ---cpu-- ---mem-- ---tcp-- ---------traffic-------- --vda--- --vda1-- --vdb---  ---load-<br>30&#47;05&#47;19-12:15   9.31     9.95     9.01     9.33      9.40    68.74     0.00     2.0M  306.4K    1.68     0.23     0.23     0.08      0.03<br>30&#47;05&#47;19-12:20  12.15    11.80    12.20    12.02     12.04    68.79     0.00     4.2M  430.7K    3.52     0.13     0.13     0.09      0.00<br>30&#47;05&#47;19-12:25  18.22    18.25    18.05    18.16     18.17    68.81     0.00     8.6M  603.0K    7.18     0.15     0.15     0.11      0.06<br>30&#47;05&#47;19-12:30   7.15     6.85     7.13     6.64      6.94    68.83     0.00     1.0M  241.4K    0.88     0.20     0.20     0.11      0.00<br>30&#47;05&#47;19-12:35   7.75     7.64     7.63     7.59      7.66    68.84     0.00     1.0M  281.0K    0.88     0.13     0.13     0.16      0.00","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452083,"discussion_content":"这个原因比较多，推荐搭建监控系统，根据历史记录找出当时CPU身高的原因，进而再去进一步定位","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559280089,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":98947,"user_name":"Geek_c6ddac","can_delete":false,"product_type":"c1","uid":1541981,"ip_address":"","ucode":"D028582C11DD1A","user_header":"https://static001.geekbang.org/account/avatar/00/17/87/5d/99be81ee.jpg","comment_is_top":false,"comment_ctime":1559118082,"is_pvip":false,"replies":[{"id":"35815","content":"肯定大于1，但不是一直活跃的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1559280529,"ip_address":"","comment_id":98947,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1559118082","product_id":100020901,"comment_content":"老师，正常情况下服务器上面每个CPU上面的进程数应该都超过1吧，那不是很容易就过载了？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451902,"discussion_content":"肯定大于1，但不是一直活跃的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559280529,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":97059,"user_name":"JJj","can_delete":false,"product_type":"c1","uid":1196463,"ip_address":"","ucode":"EA53F2CEAFCFF1","user_header":"https://static001.geekbang.org/account/avatar/00/12/41/af/4307867a.jpg","comment_is_top":false,"comment_ctime":1558578817,"is_pvip":false,"replies":[{"id":"34973","content":"请参考IO模块","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1558793904,"ip_address":"","comment_id":97059,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1558578817","product_id":100020901,"comment_content":"IO操作都是不可中断的吗？都不占用CPU吗？还是有同步IO和异步IO的区别<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451117,"discussion_content":"请参考IO模块","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558793904,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96227,"user_name":"笑","can_delete":false,"product_type":"c1","uid":1284647,"ip_address":"","ucode":"C91EAFAB88E5AC","user_header":"https://static001.geekbang.org/account/avatar/00/13/9a/27/4b81bce5.jpg","comment_is_top":false,"comment_ctime":1558360898,"is_pvip":false,"replies":[{"id":"34561","content":"请参考07和08篇","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1558447632,"ip_address":"","comment_id":96227,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1558360898","product_id":100020901,"comment_content":"有相同的疑问，不可中断进程在执行内核关键操作，比如等待IO操作响应，那么这个等待IO占不占用CPU？我的理解是这个不可中断进程执行的IO操作是不是同步IO？如果这个IO被阻塞的话会不会挂起这个进程？那么怎么保证进程不可中断呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450783,"discussion_content":"请参考07和08篇","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558447632,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96159,"user_name":"wtcctw","can_delete":false,"product_type":"c1","uid":1141208,"ip_address":"","ucode":"EECBBB9AC08CD9","user_header":"https://static001.geekbang.org/account/avatar/00/11/69/d8/112f69f8.jpg","comment_is_top":false,"comment_ctime":1558346597,"is_pvip":false,"replies":[{"id":"34562","content":"Mac还真不清楚，不过好多Linux中的工具也都可以在Mac上面使用，你可以试试","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1558447670,"ip_address":"","comment_id":96159,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1558346597","product_id":100020901,"comment_content":"Mac上的负载高，要如何分析呢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450746,"discussion_content":"Mac还真不清楚，不过好多Linux中的工具也都可以在Mac上面使用，你可以试试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558447670,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1636410,"avatar":"https://static001.geekbang.org/account/avatar/00/18/f8/3a/e0c14cb3.jpg","nickname":"lizhibo","note":"","ucode":"FDF4FA12C699B3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":31519,"discussion_content":"同学 你Mac 上怎么安装sysstat的啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570933808,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":95793,"user_name":"羁绊12221","can_delete":false,"product_type":"c1","uid":1463686,"ip_address":"","ucode":"15B47C5053388A","user_header":"https://static001.geekbang.org/account/avatar/00/16/55/86/ca7c94ce.jpg","comment_is_top":false,"comment_ctime":1558178192,"is_pvip":false,"replies":[{"id":"34567","content":"不是，这只是案例场景使用了较多的系统调用导致的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1558448128,"ip_address":"","comment_id":95793,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1558178192","product_id":100020901,"comment_content":"老师好，在模拟io密集型进程时，除了IO等待（iowait升高），%system 使用率也接近100%。是否表示，在IO等待导致平均负载较高的场景下，通常也存在着 CPU利用率较高？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450598,"discussion_content":"不是，这只是案例场景使用了较多的系统调用导致的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558448128,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1034285,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c8/2d/3dd499a9.jpg","nickname":"成都福哥","note":"","ucode":"0D3C2E5FE17E6B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":360589,"discussion_content":"同问。\nIO密集型进程，IO等待时间相对较长，iowait会相应变长，进而导致CPU使用率较高。\n请教老师，这个论述，是否正确？如果不正确，问题在哪里？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616483024,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":93260,"user_name":"天然","can_delete":false,"product_type":"c1","uid":1435982,"ip_address":"","ucode":"0F12BD470A8104","user_header":"https://static001.geekbang.org/account/avatar/00/15/e9/4e/22c73926.jpg","comment_is_top":false,"comment_ctime":1557448458,"is_pvip":false,"replies":[{"id":"33535","content":"2核","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1557671072,"ip_address":"","comment_id":93260,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1557448458","product_id":100020901,"comment_content":"请问下面提到的“在只有2个cpu的系统”是指2核cpu还是2个cpu无论核数呢？<br><br>既然平均的是活跃进程数，那么最理想的，就是每个 CPU 上都刚好运行着一个进程，这样每个 CPU 都得到了充分利用。比如当平均负载为 2 时，意味着什么呢？<br>在只有 2 个 CPU 的系统上，意味着所有的 CPU 都刚好被完全占用。<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":449550,"discussion_content":"2核","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557671072,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":92535,"user_name":"Vita","can_delete":false,"product_type":"c1","uid":1372593,"ip_address":"","ucode":"15269DB6D00392","user_header":"https://static001.geekbang.org/account/avatar/00/14/f1/b1/16642bef.jpg","comment_is_top":false,"comment_ctime":1557294611,"is_pvip":false,"replies":[{"id":"33537","content":"这里有点绕，记住iowait高不代表CPU繁忙，因为这时候CPU其实是空闲的，还可以继续调度新任务。新任务执行后iowait会降低，而IO则不一定降低","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1557671468,"ip_address":"","comment_id":92535,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1557294611","product_id":100020901,"comment_content":"还有个问题，平均负载高并不一定代表 CPU 使用率高，还有可能是 I&#47;O繁忙了，这句话似乎有点问题呢？io繁忙的时候，是大部分CPU用于io等待了，但这时也是cpu使用率过高，因为cpu的idle变小了。。我觉得这句话说的不太对劲，根据现象，应该说是cpu使用率高可能是由于%usr高了，或%sys高了，或%iowait高了，但这三种情况都是CPU占用率高了。。您觉得是这样吗？<br>01:35:47 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest   %idle<br>01:35:52 PM  all    0.00    0.00   24.39   60.96    0.21    3.64    0.00    0.00   10.80<br>01:35:52 PM    0    0.00    0.00   23.30   68.13    0.44    2.64    0.00    0.00    5.49<br>01:35:52 PM    1    0.00    0.00   25.42   54.17    0.00    4.58    0.00    0.00   15.83","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":449308,"discussion_content":"这里有点绕，记住iowait高不代表CPU繁忙，因为这时候CPU其实是空闲的，还可以继续调度新任务。新任务执行后iowait会降低，而IO则不一定降低","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557671468,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":92534,"user_name":"Vita","can_delete":false,"product_type":"c1","uid":1372593,"ip_address":"","ucode":"15269DB6D00392","user_header":"https://static001.geekbang.org/account/avatar/00/14/f1/b1/16642bef.jpg","comment_is_top":false,"comment_ctime":1557294309,"is_pvip":false,"replies":[{"id":"33109","content":"请参考置顶回复","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1557324223,"ip_address":"","comment_id":92534,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1557294309","product_id":100020901,"comment_content":"您好，我有点疑惑了，为什么我在centos上运行 stress  -i 1 --timeout 600  结果是CPU在io的占用为0呢<br>[root@m01 ~]# mpstat -P ALL 5 <br>Linux 2.6.32-696.el6.x86_64 (m01) \t05&#47;08&#47;2019 \t_x86_64_\t(2 CPU)<br><br>01:43:39 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest   %idle<br>01:43:44 PM  all    0.00    0.00   46.73    0.00    0.00    0.00    0.00    0.00   53.27<br>01:43:44 PM    0    0.20    0.00    6.43    0.00    0.00    0.00    0.00    0.00   93.37<br>01:43:44 PM    1    0.00    0.00   87.07    0.00    0.00    0.00    0.00    0.00   12.93<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":449307,"discussion_content":"请参考置顶回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557324223,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91909,"user_name":"Linuxer","can_delete":false,"product_type":"c1","uid":1153978,"ip_address":"","ucode":"272D9D8089C3D6","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/ba/333b59e5.jpg","comment_is_top":false,"comment_ctime":1557132155,"is_pvip":false,"replies":[{"id":"33120","content":"注意时间范围，只凭一次top的输出是没法计算平均负载的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1557325517,"ip_address":"","comment_id":91909,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1557132155","product_id":100020901,"comment_content":"有一个问题有点犯迷糊，想请教一下<br>top 输出<br>load average: 61.72,58.4,31.93<br>Tasks: 741 total,   2running, 738 sleeping,   0 stopped,   0 zombie<br>%Cpu(s):  21.0 us,  75.9 sy,  0.0 ni,  0.9 id,  0.0 wa,  0.0 hi,  2.2 si,  0.0 st<br><br>这里的输出显示 负载挺高，但是 running只有2个,也没发现不可中断状态的任务，那么按照文章中提到平均负载-处于可运行状态和不可中断状态的进程数<br>这个top输出就表示不理解了，请老师帮忙解下惑，谢谢！","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":449075,"discussion_content":"注意时间范围，只凭一次top的输出是没法计算平均负载的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557325517,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89724,"user_name":"leon","can_delete":false,"product_type":"c1","uid":1217955,"ip_address":"","ucode":"97610F35D2543A","user_header":"https://static001.geekbang.org/account/avatar/00/12/95/a3/0a3cde60.jpg","comment_is_top":false,"comment_ctime":1556250263,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556250263","product_id":100020901,"comment_content":"打卡，面试的时候就被问道如何理解负载，当时支支吾吾的说不出来，看了这篇文章算比较明白了","like_count":0},{"had_liked":false,"id":89230,"user_name":"常扬","can_delete":false,"product_type":"c1","uid":1207316,"ip_address":"","ucode":"F48F2C17E076E7","user_header":"https://static001.geekbang.org/account/avatar/00/12/6c/14/06535aa1.jpg","comment_is_top":false,"comment_ctime":1556112647,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556112647","product_id":100020901,"comment_content":"我是linux小白，感觉真的很贴近实际生产，可以排查cpu占用率为什么那么高。谢谢！","like_count":0},{"had_liked":false,"id":88218,"user_name":"kissingers","can_delete":false,"product_type":"c1","uid":1135299,"ip_address":"","ucode":"615151808CF628","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKzqiaZnBw2myRWY802u48Rw3W2zDtKoFQ6vN63m4FdyjibM21FfaOYe8MbMpemUdxXJeQH6fRdVbZA/132","comment_is_top":false,"comment_ctime":1555895398,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555895398","product_id":100020901,"comment_content":"cpu 使用率高就是当前工作很忙，连喝水时间都没，平均负载高是手头活很多，老板还列了一堆任务排着队，好不容易做完的几个还要等客户答复，答复一来又得忙活。","like_count":0},{"had_liked":false,"id":87104,"user_name":"bigzuo","can_delete":false,"product_type":"c1","uid":1224554,"ip_address":"","ucode":"448C258D31A8A6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/RQdib68D7dsoFlYXOweiaPqLrcyn2jD6DCGnz8nc2VFmhmX0bpGTeSrVM5M9Qs7ibIInAmt5MeLcpcNja5YjyZCIg/132","comment_is_top":false,"comment_ctime":1555512632,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555512632","product_id":100020901,"comment_content":"纸上得来终觉浅，绝知此事要躬行","like_count":0},{"had_liked":false,"id":83233,"user_name":"侯恩训","can_delete":false,"product_type":"c1","uid":1162376,"ip_address":"","ucode":"F4DC47EECA0F00","user_header":"https://static001.geekbang.org/account/avatar/00/11/bc/88/fbb6022e.jpg","comment_is_top":false,"comment_ctime":1554474671,"is_pvip":false,"replies":[{"id":"30187","content":"对照loadavg的含义计算一下就知道了","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1554638452,"ip_address":"","comment_id":83233,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554474671","product_id":100020901,"comment_content":"虚拟机跑centos，cpu双核， 使用stress --cpu 1 --timeout 600进行压测，为啥load稳定在0.5？？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445931,"discussion_content":"对照loadavg的含义计算一下就知道了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554638452,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":80508,"user_name":"尹瑞","can_delete":false,"product_type":"c1","uid":1458455,"ip_address":"","ucode":"18C63E1780B203","user_header":"","comment_is_top":false,"comment_ctime":1553672031,"is_pvip":false,"replies":[{"id":"29324","content":"sorry，这个我步清楚，网络搜索看看吧","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553697243,"ip_address":"","comment_id":80508,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553672031","product_id":100020901,"comment_content":"老师，suse上如何装sysstat，用了YaST -i sysstat也不行","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444887,"discussion_content":"sorry，这个我步清楚，网络搜索看看吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553697243,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79903,"user_name":"阿文","can_delete":false,"product_type":"c1","uid":1106209,"ip_address":"","ucode":"BB4DB62141971F","user_header":"https://static001.geekbang.org/account/avatar/00/10/e1/21/5f0bf9a0.jpg","comment_is_top":false,"comment_ctime":1553571565,"is_pvip":false,"replies":[{"id":"29205","content":"需要升级sysstat版本","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553611062,"ip_address":"","comment_id":79903,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553571565","product_id":100020901,"comment_content":"为什么我执行没有 wait<br><br>极客时间版权所有: https:&#47;&#47;time.geekbang.org&#47;column&#47;article&#47;69618<br>root@linux:~# pidstat -u 5 1<br>Linux 4.4.0-21-generic (linux) \t03&#47;26&#47;2019 \t_x86_64_\t(4 CPU)<br><br>11:12:50 AM   UID       PID    %usr %system  %guest    %CPU   CPU  Command<br>11:12:55 AM     0      8255   49.90    0.00    0.00   49.90     0  stress<br>11:12:55 AM     0      8256   49.90    0.00    0.00   49.90     2  stress<br>11:12:55 AM     0      8257   49.90    0.00    0.00   49.90     3  stress<br>11:12:55 AM     0      8258   49.90    0.00    0.00   49.90     1  stress<br>11:12:55 AM     0      8259   49.90    0.00    0.00   49.90     3  stress<br>11:12:55 AM     0      8260   49.90    0.00    0.00   49.90     0  stress<br>11:12:55 AM     0      8261   50.10    0.00    0.00   50.10     1  stress<br>11:12:55 AM     0      8262   49.70    0.00    0.00   49.70     2  stress<br><br>Average:      UID       PID    %usr %system  %guest    %CPU   CPU  Command<br>Average:        0      8255   49.90    0.00    0.00   49.90     -  stress<br>Average:        0      8256   49.90    0.00    0.00   49.90     -  stress<br>Average:        0      8257   49.90    0.00    0.00   49.90     -  stress<br>Average:        0      8258   49.90    0.00    0.00   49.90     -  stress<br>Average:        0      8259   49.90    0.00    0.00   49.90     -  stress<br>Average:        0      8260   49.90    0.00    0.00   49.90     -  stress<br>Average:        0      8261   50.10    0.00    0.00   50.10     -  stress<br>Average:        0      8262   49.70    0.00    0.00   49.70     -  stress","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444679,"discussion_content":"需要升级sysstat版本","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553611062,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79278,"user_name":"古冷","can_delete":false,"product_type":"c1","uid":1179854,"ip_address":"","ucode":"4B527897E73C2F","user_header":"https://static001.geekbang.org/account/avatar/00/12/00/ce/de7e7336.jpg","comment_is_top":false,"comment_ctime":1553423359,"is_pvip":false,"replies":[{"id":"29045","content":"(135-48)&#47;48*100%","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553526142,"ip_address":"","comment_id":79278,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553423359","product_id":100020901,"comment_content":"平均负载高于 CPU 数量 70% ，这个70%是怎么算出来的呢？比如我48核，load15为135时   48&#47;135=,是这么算的么？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444427,"discussion_content":"(135-48)/48*100%","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553526142,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78817,"user_name":"frank_","can_delete":false,"product_type":"c1","uid":1452570,"ip_address":"","ucode":"658DBBC9BE337F","user_header":"","comment_is_top":false,"comment_ctime":1553246144,"is_pvip":false,"replies":[{"id":"28748","content":"是不是虚拟机内部就是使用了很多CPU？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553316982,"ip_address":"","comment_id":78817,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553246144","product_id":100020901,"comment_content":"CentOS  通过源码安装sysstat 11.6.6, 上面跑的虚拟机qemu-kvm guest使用率巨高，版本有bug吧<br><br>[root@centos]# pidstat -u 1 1<br>Linux 3.10.0-693.el7.x86_64 (pool-100-7-38-78.rcmdva.fios.verizon.net) \t03&#47;22&#47;2019 \t_x86_64_\t(24 CPU)<br><br>05:09:52 PM   UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command<br>05:09:53 PM   107      1389    0.00    4.81   25.96    0.00   30.77     0  qemu-kvm<br>05:09:53 PM   985      2323    1.92    1.92    0.00    0.00    3.85    10  nprobe<br>05:09:53 PM   107     14607    5.77    0.00   48.08    0.00   53.85     0  qemu-kvm<br>05:09:53 PM   107     22702    0.00    0.96 17737253915552362496.00    0.00   17.31     9  qemu-kvm<br>05:09:53 PM   107     23333    3.85    0.00   15.38    0.00   19.23     0  qemu-kvm<br>05:09:53 PM     0     28075    0.96    1.92    0.00    0.00    2.88     7  pidstat<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444240,"discussion_content":"是不是虚拟机内部就是使用了很多CPU？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553316982,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78604,"user_name":"lidashuang","can_delete":false,"product_type":"c1","uid":1104850,"ip_address":"","ucode":"560ABE8032760E","user_header":"https://static001.geekbang.org/account/avatar/00/10/db/d2/e29f8834.jpg","comment_is_top":false,"comment_ctime":1553181648,"is_pvip":false,"replies":[{"id":"28771","content":"嗯 stress-ng 功能更强大","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553318982,"ip_address":"","comment_id":78604,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553181648","product_id":100020901,"comment_content":"Ubuntu 18.04.1 LTS都没有stress的包了, 要安装 Stress-NG http:&#47;&#47;www.ubuntugeek.com&#47;stress-ng-tool-to-load-and-stress-your-ubuntu-system.html","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444160,"discussion_content":"嗯 stress-ng 功能更强大","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553318982,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78443,"user_name":"^_^","can_delete":false,"product_type":"c1","uid":1122575,"ip_address":"","ucode":"30E994A1627EB1","user_header":"https://static001.geekbang.org/account/avatar/00/11/21/0f/b61dc67e.jpg","comment_is_top":false,"comment_ctime":1553148611,"is_pvip":false,"replies":[{"id":"28758","content":"请参考置顶回复","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553317818,"ip_address":"","comment_id":78443,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553148611","product_id":100020901,"comment_content":"老师您好，我在实验第二个场景时io密集型，通过mpstat命令观察时发现只有%sys到达100%，iowait还是0，请问是什么原因？OS是suse Linux ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444097,"discussion_content":"请参考置顶回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553317818,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77437,"user_name":"Qiang","can_delete":false,"product_type":"c1","uid":1426891,"ip_address":"","ucode":"2629BC1B16230A","user_header":"https://static001.geekbang.org/account/avatar/00/15/c5/cb/f70348e0.jpg","comment_is_top":false,"comment_ctime":1552924375,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552924375","product_id":100020901,"comment_content":"D3, 2019.3.18","like_count":0},{"had_liked":false,"id":77378,"user_name":"InfoQ_686548eeb0d8","can_delete":false,"product_type":"c1","uid":1316985,"ip_address":"","ucode":"8222D0A7EE6155","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIsf7oYWKWrCu7LzT4xt2ZvLdNsn2Me8yEcdgVjJTKe68MQicIcO09FLXRYH5R8hCJ9RiatklFkSGtQ/132","comment_is_top":false,"comment_ctime":1552914935,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552914935","product_id":100020901,"comment_content":"今天面试就被问到了负载高如何定位的问题","like_count":0},{"had_liked":false,"id":75812,"user_name":"大宝","can_delete":false,"product_type":"c1","uid":1321975,"ip_address":"","ucode":"FC1BCF0464B6D6","user_header":"https://static001.geekbang.org/account/avatar/00/14/2b/f7/f5ae026c.jpg","comment_is_top":false,"comment_ctime":1552474809,"is_pvip":false,"replies":[{"id":"28050","content":"请升级sysstat版本","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1552749700,"ip_address":"","comment_id":75812,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1552474809","product_id":100020901,"comment_content":"pidstat -u 5 1  怎么看不到%wait 这一项<br>系统为：CentOS Linux release 7.5.1804 (Core)","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443042,"discussion_content":"请升级sysstat版本","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552749700,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":75740,"user_name":"稳稳的幸福","can_delete":false,"product_type":"c1","uid":1150638,"ip_address":"","ucode":"1B0254CBFC81D4","user_header":"https://static001.geekbang.org/account/avatar/00/11/8e/ae/bcf43f04.jpg","comment_is_top":false,"comment_ctime":1552461661,"is_pvip":false,"replies":[{"id":"28048","content":"可以把平均负载的CPU理解为以CPU使用率100%的形式执行","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1552749398,"ip_address":"","comment_id":75740,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1552461661","product_id":100020901,"comment_content":"您好，想请教下，以前公司有一台服务器 4 CPU 的，上面运行了 10 多个 java 业务应用，当时应用的访问量不大。<br>一直都不太理解的是，这 10 个java 应用进程不是一直在运行着的吗，系统负载怎么只是 0.1、0.2 的样子？？上文中提及的可运行状态进程，指的是什么样子的进程尼？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443010,"discussion_content":"可以把平均负载的CPU理解为以CPU使用率100%的形式执行","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552749398,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":74968,"user_name":"java届-Mr.吉","can_delete":false,"product_type":"c1","uid":1252541,"ip_address":"","ucode":"6CF474AB180D9B","user_header":"https://static001.geekbang.org/account/avatar/00/13/1c/bd/23aeb6d0.jpg","comment_is_top":false,"comment_ctime":1552325877,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552325877","product_id":100020901,"comment_content":"老师您好，可以解释一下单核、多核、物理处理器、逻辑处理器、cpu的区别和联系嘛","like_count":0},{"had_liked":false,"id":74776,"user_name":"rock04","can_delete":false,"product_type":"c1","uid":1316129,"ip_address":"","ucode":"7E104151852AB4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/XC10ibnwF0jtwgksFoSuUCMtgfK0Ndk5Wib3Xyr5Yyz9xiaCrKibNicPksVmicpZEatWgPPLfMXz3jCGMMiclHHQlku4Q/132","comment_is_top":false,"comment_ctime":1552296631,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552296631","product_id":100020901,"comment_content":"遇到一个问题，8C的虚拟机 跑了一个java应用，但是平均负载很高超过8了。但是查看CPU 、IO、都不高 这应该怎么排查呢","like_count":0},{"had_liked":false,"id":74028,"user_name":"Geek_f4ef24","can_delete":false,"product_type":"c1","uid":1445470,"ip_address":"","ucode":"E08867C2100407","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/n2N3Gg1kfc80sKGDRicYWa9L35GXZjia9ErMEdpXpltaCMF2dYCBCu6rlbKaRTxVZUFKZD4Hp4nCFp1AKibOQYNPw/132","comment_is_top":false,"comment_ctime":1552089137,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552089137","product_id":100020901,"comment_content":"场景二中，pidstat看到的wait","like_count":0},{"had_liked":false,"id":73876,"user_name":"咸因心上","can_delete":false,"product_type":"c1","uid":1450666,"ip_address":"","ucode":"B4C4E7D6BD940E","user_header":"https://static001.geekbang.org/account/avatar/00/16/22/aa/39240a30.jpg","comment_is_top":false,"comment_ctime":1552023175,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552023175","product_id":100020901,"comment_content":"来得有点晚，打卡第一天。","like_count":0},{"had_liked":false,"id":73604,"user_name":"别 闹","can_delete":false,"product_type":"c1","uid":1316292,"ip_address":"","ucode":"08CEC159031EC9","user_header":"https://static001.geekbang.org/account/avatar/00/14/15/c4/658edf74.jpg","comment_is_top":false,"comment_ctime":1551938622,"is_pvip":false,"replies":[{"id":"27324","content":"不是，活跃进程数不等于进程数","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1552348370,"ip_address":"","comment_id":73604,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551938622","product_id":100020901,"comment_content":"比如我看到uptime的一到五分钟是0.15，0.17，0.18而我的cpu是八个，那现在是负载吗？0.15这些是指有一分钟内的活跃进程数么不是，那我是不是需要知道我这个服务器上进城总数，进城总数的15%是过去一分钟在运行的进城数","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442180,"discussion_content":"不是，活跃进程数不等于进程数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552348370,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":73340,"user_name":"💖李京潼💖","can_delete":false,"product_type":"c1","uid":1284775,"ip_address":"","ucode":"8337BC784D9674","user_header":"https://static001.geekbang.org/account/avatar/00/13/9a/a7/51cf1a9e.jpg","comment_is_top":false,"comment_ctime":1551863268,"is_pvip":false,"replies":[{"id":"26759","content":"可以看看进程的系统调用，iowait不高参考置顶回复","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551885739,"ip_address":"","comment_id":73340,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551863268","product_id":100020901,"comment_content":"老师想请教一个问题，我的设备有16个逻辑核：<br>1. stress -i 1 - -timeout 600<br>结果如您课程中所讲<br>2. stress -i 16 - -timeout 600<br>mpstat 显示的每个cpu的%sys 很高，有的高达七十多，但iowait 却很低，低至个位数，甚至是0，这个情况该如何分析呢？谢谢老师","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442030,"discussion_content":"可以看看进程的系统调用，iowait不高参考置顶回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551885739,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":73211,"user_name":"丰号军","can_delete":false,"product_type":"c1","uid":1395846,"ip_address":"","ucode":"7F9395DFCA2596","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/7xB3OdNLiaPgZQibVAD52Jx6JlLHRs7hsMZp6UDM1k0bmtz3Op0HsK10Ca5l0snbIMYapktiak9RNUQuIcz9TmgZA/132","comment_is_top":false,"comment_ctime":1551840671,"is_pvip":false,"replies":[{"id":"26750","content":"活跃进程数，不只是不可中断进程，还有运行进程","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551884248,"ip_address":"","comment_id":73211,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551840671","product_id":100020901,"comment_content":"倪老师，平均负载表示的是处于不可中断的进程数，那么我们平时运行一个单进程多线程的服务是如何使得CPU的平均负载达到2甚至更高的呢？是因为它占用了CPU然后系统中的其他进程一直处于就绪等待的状态吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441970,"discussion_content":"活跃进程数，不只是不可中断进程，还有运行进程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551884248,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":72737,"user_name":"siri","can_delete":false,"product_type":"c1","uid":1318423,"ip_address":"","ucode":"5DA7D12157E94A","user_header":"https://static001.geekbang.org/account/avatar/00/14/1e/17/5f9ce932.jpg","comment_is_top":false,"comment_ctime":1551707977,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551707977","product_id":100020901,"comment_content":"付费的东西果然好","like_count":0},{"had_liked":false,"id":72278,"user_name":"一叶一菩提","can_delete":false,"product_type":"c1","uid":1388947,"ip_address":"","ucode":"54FEAB31E8E7D7","user_header":"https://static001.geekbang.org/account/avatar/00/15/31/93/997c9a92.jpg","comment_is_top":false,"comment_ctime":1551570514,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551570514","product_id":100020901,"comment_content":"非常满意的教程，物超所值！！！","like_count":0},{"had_liked":false,"id":70834,"user_name":"于競","can_delete":false,"product_type":"c1","uid":1219827,"ip_address":"","ucode":"4A74417B0727A4","user_header":"https://static001.geekbang.org/account/avatar/00/12/9c/f3/e01dfe3a.jpg","comment_is_top":false,"comment_ctime":1551192053,"is_pvip":true,"replies":[{"id":"25367","content":"请参考后面的IO模块","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551195712,"ip_address":"","comment_id":70834,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551192053","product_id":100020901,"comment_content":"最近遇到一中场景，服务器部署的为php-fpm服务，整体看io wait到达百分之十几，想定位是什么进程引起的。pidstat 命令来看每个php-fpm的io wait又都不高，但是php-fpm的进程数量非常多，达六百多个。是因为进程数量多累加起来io wait高的吗？想请教这种情况怎么定位","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440852,"discussion_content":"请参考后面的IO模块","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551195712,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69598,"user_name":"仙道","can_delete":false,"product_type":"c1","uid":1402218,"ip_address":"","ucode":"3F3B35929E08C9","user_header":"https://static001.geekbang.org/account/avatar/00/15/65/6a/67f55083.jpg","comment_is_top":false,"comment_ctime":1550795809,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1550795809","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":68657,"user_name":"平安喜乐","can_delete":false,"product_type":"c1","uid":1102350,"ip_address":"","ucode":"B97D8944B0B035","user_header":"https://static001.geekbang.org/account/avatar/00/10/d2/0e/26bf35a4.jpg","comment_is_top":false,"comment_ctime":1550568305,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1550568305","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":67325,"user_name":"钟悠","can_delete":false,"product_type":"c1","uid":1114612,"ip_address":"","ucode":"5AF2CAE1737927","user_header":"https://static001.geekbang.org/account/avatar/00/11/01/f4/3dc9bcce.jpg","comment_is_top":false,"comment_ctime":1550129915,"is_pvip":true,"replies":[{"id":"24029","content":"嗯，是有这个问题。请看看置顶回复","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550324908,"ip_address":"","comment_id":67325,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550129915","product_id":100020901,"comment_content":"遇到一个现象，测试IO密集型进程时，运行stress -i 1 --timeout 600命令后，执行mpstat -P ALL 5 1命令，发现%iowait并没有相应增加，倒是%sys增加了","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439144,"discussion_content":"嗯，是有这个问题。请看看置顶回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550324908,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":67258,"user_name":"信","can_delete":false,"product_type":"c1","uid":1402598,"ip_address":"","ucode":"7DA2AA0BEFE4AF","user_header":"https://static001.geekbang.org/account/avatar/00/15/66/e6/684026e3.jpg","comment_is_top":false,"comment_ctime":1550116118,"is_pvip":false,"replies":[{"id":"24027","content":"这么对比有两个问题：<br>（1）性能工具第一次的结果很有可能是不准确的（很多都是从进程启动还是算），所以要对比后面的<br>（2）性能工具本身的用法问题，比如 pidstat 默认不显示线程","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550324771,"ip_address":"","comment_id":67258,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550116118","product_id":100020901,"comment_content":"想请教老师一下 工具的使用：线上环境逻辑核数56，使用mpstat -P 5显示的cpu 中有几个20的，使用pidstat -u 5 1 得到数据，我有两个疑问：1.数据缺失，mpstat 显示20的，在pidstat里没有显示2.pidstat显示不对，比如pidstat的37号cpu usr system都很低都是0.3，但是在mpstat却有10点几，麻烦老师解答一下","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439118,"discussion_content":"这么对比有两个问题：\n（1）性能工具第一次的结果很有可能是不准确的（很多都是从进程启动还是算），所以要对比后面的\n（2）性能工具本身的用法问题，比如 pidstat 默认不显示线程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550324771,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":67022,"user_name":"Alex","can_delete":false,"product_type":"c1","uid":1026237,"ip_address":"","ucode":"27C85448CEDDB9","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a8/bd/97e6e2c8.jpg","comment_is_top":false,"comment_ctime":1550057045,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1550057045","product_id":100020901,"comment_content":"打卡 day 3","like_count":0},{"had_liked":false,"id":66984,"user_name":"爱学习的小学生","can_delete":false,"product_type":"c1","uid":1413556,"ip_address":"","ucode":"040AB71F0394F2","user_header":"https://static001.geekbang.org/account/avatar/00/15/91/b4/d5d9e4fb.jpg","comment_is_top":false,"comment_ctime":1550050945,"is_pvip":false,"replies":[{"id":"23705","content":"是的，可以在极客时间 APP 或者网站上查看","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550068489,"ip_address":"","comment_id":66984,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550050945","product_id":100020901,"comment_content":"受益匪浅、请问老师购买的内容一直保存着吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439002,"discussion_content":"是的，可以在极客时间 APP 或者网站上查看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550068489,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":66964,"user_name":"Mich","can_delete":false,"product_type":"c1","uid":1003590,"ip_address":"","ucode":"FCCA355F5D2ACC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/50/46/6d316dc8.jpg","comment_is_top":false,"comment_ctime":1550049019,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1550049019","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":65950,"user_name":"有点意思","can_delete":false,"product_type":"c1","uid":1399454,"ip_address":"","ucode":"67F55604E8A548","user_header":"https://static001.geekbang.org/account/avatar/00/15/5a/9e/8f2ccc1d.jpg","comment_is_top":false,"comment_ctime":1549793514,"is_pvip":true,"replies":[{"id":"23680","content":"需要升级一下 pidstat 版本（参考置顶回复）","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550065389,"ip_address":"","comment_id":65950,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1549793514","product_id":100020901,"comment_content":"使用的pidstat无法找到%wait","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438655,"discussion_content":"需要升级一下 pidstat 版本（参考置顶回复）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550065389,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65505,"user_name":"王小春","can_delete":false,"product_type":"c1","uid":1351789,"ip_address":"","ucode":"1B8660EDE4FEB0","user_header":"https://static001.geekbang.org/account/avatar/00/14/a0/6d/7383f9ae.jpg","comment_is_top":false,"comment_ctime":1549421054,"is_pvip":false,"replies":[{"id":"23252","content":"只是 stress 不够，后面各个模块还有很多讲解的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1549636352,"ip_address":"","comment_id":65505,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1549421054","product_id":100020901,"comment_content":"老师我问个问题，现在用stress命令可以压测，那如果说我要做压力测试，想知道这台服务器各方面的瓶颈是多少，这个命令可以看吗，这么看","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438479,"discussion_content":"只是 stress 不够，后面各个模块还有很多讲解的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549636352,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":64875,"user_name":"Hammy","can_delete":false,"product_type":"c1","uid":1256838,"ip_address":"","ucode":"9FF68F2D9BE174","user_header":"https://static001.geekbang.org/account/avatar/00/13/2d/86/ffc4d749.jpg","comment_is_top":false,"comment_ctime":1548936016,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1548936016","product_id":100020901,"comment_content":"受益匪浅","like_count":0},{"had_liked":false,"id":64744,"user_name":"L33K","can_delete":false,"product_type":"c1","uid":1046063,"ip_address":"","ucode":"2F8E105F44E347","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f6/2f/d3f1dae6.jpg","comment_is_top":false,"comment_ctime":1548898420,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1548898420","product_id":100020901,"comment_content":"打卡，学习使我快乐😁","like_count":0},{"had_liked":false,"id":64740,"user_name":"独孤","can_delete":false,"product_type":"c1","uid":1294873,"ip_address":"","ucode":"301D08665822E7","user_header":"https://static001.geekbang.org/account/avatar/00/13/c2/19/16863a09.jpg","comment_is_top":false,"comment_ctime":1548897397,"is_pvip":true,"replies":[{"id":"22990","content":"嗯嗯，docker不是完整的隔离，跟虚拟化还是有差别，所以对cpu来说，要看cgroups","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548944260,"ip_address":"","comment_id":64740,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548897397","product_id":100020901,"comment_content":"现在的线上服务器都用的docker容器，有时候在容器里面用前面的命令看到的是物理机的cpu核数，这个时候怎么界定呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438155,"discussion_content":"嗯嗯，docker不是完整的隔离，跟虚拟化还是有差别，所以对cpu来说，要看cgroups","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548944260,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":64705,"user_name":"ROY","can_delete":false,"product_type":"c1","uid":1296815,"ip_address":"","ucode":"FB99E4456D2E5F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoqEsRcQ5icwkgTDBX9JA8iaqohBdIGhxMXLFDSevEXqm5sAarw3hKeEHzxkoEJ5sx7plibcRPqmicAlQ/132","comment_is_top":false,"comment_ctime":1548863043,"is_pvip":false,"replies":[{"id":"22989","content":"这不清楚。如果你发现了，欢迎在这里分享","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548944200,"ip_address":"","comment_id":64705,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548863043","product_id":100020901,"comment_content":"mac 下有类似sysstat的工具吗","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438143,"discussion_content":"这不清楚。如果你发现了，欢迎在这里分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548944200,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":64545,"user_name":"听闻","can_delete":false,"product_type":"c1","uid":1319485,"ip_address":"","ucode":"EF1D3C9EF83F7B","user_header":"https://static001.geekbang.org/account/avatar/00/14/22/3d/35a4324c.jpg","comment_is_top":false,"comment_ctime":1548818321,"is_pvip":false,"replies":[{"id":"22978","content":"也可以下载源码来安装，比如https:&#47;&#47;github.com&#47;ColinIanKing&#47;stress-ng","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548943110,"ip_address":"","comment_id":64545,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548818321","product_id":100020901,"comment_content":"老师我系统是redhat操作系统 yum没下载到 stress-ng这个工具","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438061,"discussion_content":"也可以下载源码来安装，比如https://github.com/ColinIanKing/stress-ng","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548943110,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62379,"user_name":"🍀 🍀 🍀 🐼","can_delete":false,"product_type":"c1","uid":1252056,"ip_address":"","ucode":"1D22FEE1E50117","user_header":"https://static001.geekbang.org/account/avatar/00/13/1a/d8/4a051faa.jpg","comment_is_top":false,"comment_ctime":1548041946,"is_pvip":false,"replies":[{"id":"22132","content":"是的，网络模块会讲的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548116159,"ip_address":"","comment_id":62379,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548041946","product_id":100020901,"comment_content":"waitIO只是磁盘IO吗？网络io占比呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437190,"discussion_content":"是的，网络模块会讲的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548116159,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60659,"user_name":"keyboard_chen_-","can_delete":false,"product_type":"c1","uid":1012204,"ip_address":"","ucode":"E95757BEAF5573","user_header":"https://static001.geekbang.org/account/avatar/00/0f/71/ec/bfecf21b.jpg","comment_is_top":false,"comment_ctime":1547525404,"is_pvip":false,"replies":[{"id":"22306","content":"是的，但不一定是 100%","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548249054,"ip_address":"","comment_id":60659,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547525404","product_id":100020901,"comment_content":"iowait期间，cpu是可以给其他进程使用吧，这样的话它和cpu使用率加起来是100%吗","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436573,"discussion_content":"是的，但不一定是 100%","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548249054,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60309,"user_name":"。。。。","can_delete":false,"product_type":"c1","uid":1370981,"ip_address":"","ucode":"E724186A3F957A","user_header":"https://static001.geekbang.org/account/avatar/00/14/eb/65/6c4fbdd9.jpg","comment_is_top":false,"comment_ctime":1547456958,"is_pvip":false,"replies":[{"id":"22297","content":"请参考置顶回复","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548248442,"ip_address":"","comment_id":60309,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547456958","product_id":100020901,"comment_content":"老师，我这里有个问题请教下：  <br>IO密集型的按例  mpstat -P ALL  5  5 查看到iowait在29.76，但是我在pidstat -d 查看下，发现系统的读写速率基本为0，这是为什么呢？<br><br><br> mpstat -P ALL  5  5<br>Linux 3.10.0-693.2.2.el7.x86_64 (iZ2zegdn0p828zo4dhv53eZ) \t01&#47;14&#47;2019 \t_x86_64_\t(1 CPU)<br><br>05:00:50 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>05:00:55 PM  all    0.40    0.00   69.84   29.76    0.00    0.00    0.00    0.00    0.00    0.00<br>05:00:55 PM    0    0.40    0.00   69.84   29.76    0.00    0.00    0.00    0.00    0.00    0.00<br><br><br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436472,"discussion_content":"请参考置顶回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548248442,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":59015,"user_name":"bigzuo","can_delete":false,"product_type":"c1","uid":1224554,"ip_address":"","ucode":"448C258D31A8A6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/RQdib68D7dsoFlYXOweiaPqLrcyn2jD6DCGnz8nc2VFmhmX0bpGTeSrVM5M9Qs7ibIInAmt5MeLcpcNja5YjyZCIg/132","comment_is_top":false,"comment_ctime":1547271756,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1547271756","product_id":100020901,"comment_content":"第六天，要演练。实战出真知。","like_count":0},{"had_liked":false,"id":58541,"user_name":"Geek_99a6d6","can_delete":false,"product_type":"c1","uid":1363976,"ip_address":"","ucode":"53051556872B46","user_header":"","comment_is_top":false,"comment_ctime":1547109081,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1547109081","product_id":100020901,"comment_content":"请问，不可中断进程的时间片是怎么分配的？","like_count":0},{"had_liked":false,"id":57760,"user_name":"bigzuo","can_delete":false,"product_type":"c1","uid":1224554,"ip_address":"","ucode":"448C258D31A8A6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/RQdib68D7dsoFlYXOweiaPqLrcyn2jD6DCGnz8nc2VFmhmX0bpGTeSrVM5M9Qs7ibIInAmt5MeLcpcNja5YjyZCIg/132","comment_is_top":false,"comment_ctime":1546905432,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546905432","product_id":100020901,"comment_content":"很赞，自己之前理解的上下文切换只是部分场景，这次认真补了一课。","like_count":0},{"had_liked":false,"id":56146,"user_name":"无名","can_delete":false,"product_type":"c1","uid":1110113,"ip_address":"","ucode":"2D2E877CF97138","user_header":"https://static001.geekbang.org/account/avatar/00/10/f0/61/68462a07.jpg","comment_is_top":false,"comment_ctime":1546397419,"is_pvip":false,"replies":[{"id":"20266","content":"跟逻辑CPU总个数对比","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546423820,"ip_address":"","comment_id":56146,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546397419","product_id":100020901,"comment_content":"负载时只考虑CPU的个数是吗？如果一个CPU为多核呢？如：我的电脑位单CPU2核，uptime显示的后三个值为1.多，也是超载了是吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434945,"discussion_content":"跟逻辑CPU总个数对比","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546423820,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55778,"user_name":"web","can_delete":false,"product_type":"c1","uid":1069301,"ip_address":"","ucode":"32677A42C12650","user_header":"https://static001.geekbang.org/account/avatar/00/10/50/f5/3bf66adb.jpg","comment_is_top":false,"comment_ctime":1546307022,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546307022","product_id":100020901,"comment_content":"https:&#47;&#47;github.com&#47;liuyangc3&#47;note-book&#47;blob&#47;master&#47;kernel&#47;cpu负载深度解析.md，我的理解","like_count":0},{"had_liked":false,"id":55229,"user_name":"yshan","can_delete":false,"product_type":"c1","uid":1136788,"ip_address":"","ucode":"A2ECDCDA52B8EE","user_header":"https://static001.geekbang.org/account/avatar/00/11/58/94/c8bc2b59.jpg","comment_is_top":false,"comment_ctime":1546070734,"is_pvip":false,"replies":[{"id":"20015","content":"👍 谢谢分享","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546075465,"ip_address":"","comment_id":55229,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546070734","product_id":100020901,"comment_content":"打卡学习，碰到的问题及处理：<br>1、源码安装sysstat：<br>wget http:&#47;&#47;sebastien.godard.pagesperso-orange.fr&#47;sysstat-12.1.2.tar.gz<br>tar -xzf sysstat-12.1.2.tar.gz<br>cd sysstat-12.1.2&#47;<br>.&#47;configure<br>make<br>make install<br>碰到缺乏某个软件的依赖包，则使用apt安装即可<br><br>2、apt下载太慢，更改apt源<br>ubuntu版本16.04<br># vim &#47;etc&#47;apt&#47;sources.list<br><br>deb https:&#47;&#47;mirrors.tuna.tsinghua.edu.cn&#47;ubuntu&#47; xenial main restricted universe multiverse<br># deb-src https:&#47;&#47;mirrors.tuna.tsinghua.edu.cn&#47;ubuntu&#47; xenial main restricted universe multiverse<br>deb https:&#47;&#47;mirrors.tuna.tsinghua.edu.cn&#47;ubuntu&#47; xenial-updates main restricted universe multiverse<br># deb-src https:&#47;&#47;mirrors.tuna.tsinghua.edu.cn&#47;ubuntu&#47; xenial-updates main restricted universe multiverse<br>deb https:&#47;&#47;mirrors.tuna.tsinghua.edu.cn&#47;ubuntu&#47; xenial-backports main restricted universe multiverse<br># deb-src https:&#47;&#47;mirrors.tuna.tsinghua.edu.cn&#47;ubuntu&#47; xenial-backports main restricted universe multiverse<br>deb https:&#47;&#47;mirrors.tuna.tsinghua.edu.cn&#47;ubuntu&#47; xenial-security main restricted universe multiverse<br># deb-src https:&#47;&#47;mirrors.tuna.tsinghua.edu.cn&#47;ubuntu&#47; xenial-security main restricted universe multiverse<br><br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434703,"discussion_content":"👍 谢谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546075465,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54190,"user_name":"花开蝶自来","can_delete":false,"product_type":"c1","uid":1358144,"ip_address":"","ucode":"767D55E7A82975","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKibu8C3CeYGF6JCBribiaEPia5gibaQnj9icryPVwoF6ibosmdicXJIhBEUdn0aDwZQ32oTyJL86DgDswhAg/132","comment_is_top":false,"comment_ctime":1545802101,"is_pvip":false,"replies":[{"id":"19699","content":"状态是瞬时的，使用率是一段时间的平均值，使用率高但进程并不会一直占着CPU","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545835123,"ip_address":"","comment_id":54190,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545802101","product_id":100020901,"comment_content":"top查看的进程状态stat是 “S” 是sleep的意思，为什么它还占用这么高的 cpu使用率？<br><br>  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND<br>16097 MainTest      20   0 6222100 3.595g  21016 S 845.2 11.5   1095:15 java<br>13303 HiTest    20   0 5222344 1.244g  30936 S 100.7  4.0 186:52.26 java<br> 3249 root      20   0 2348640  54420   2740 S   2.3  0.2 629:50.09 python2.7<br> 3164 root      20   0 2269480  48668   2268 S   1.7  0.1 279:40.85 python2.7","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434388,"discussion_content":"状态是瞬时的，使用率是一段时间的平均值，使用率高但进程并不会一直占着CPU","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545835123,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53887,"user_name":"玉小帝","can_delete":false,"product_type":"c1","uid":1354628,"ip_address":"","ucode":"B1D57BCF73BD0D","user_header":"https://static001.geekbang.org/account/avatar/00/14/ab/84/af6ab8ad.jpg","comment_is_top":false,"comment_ctime":1545748694,"is_pvip":false,"replies":[{"id":"19765","content":"先排查瓶颈，找出瓶颈之后才好针对性的优化","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545886597,"ip_address":"","comment_id":53887,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545748694","product_id":100020901,"comment_content":"老师请问下计算密集型cpu，应该怎么优化呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434281,"discussion_content":"先排查瓶颈，找出瓶颈之后才好针对性的优化","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545886597,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53878,"user_name":"张晓生","can_delete":false,"product_type":"c1","uid":1228996,"ip_address":"","ucode":"42F6A91947F5E5","user_header":"https://static001.geekbang.org/account/avatar/00/12/c0/c4/dfbad982.jpg","comment_is_top":false,"comment_ctime":1545747319,"is_pvip":false,"replies":[{"id":"19762","content":"😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545886293,"ip_address":"","comment_id":53878,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545747319","product_id":100020901,"comment_content":"对着这一节，应用在生产服务器上，今晚就发现一个问题，哈哈哈","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434275,"discussion_content":"😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545886293,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53788,"user_name":"Maxwell","can_delete":false,"product_type":"c1","uid":1086275,"ip_address":"","ucode":"720A00AD472616","user_header":"https://static001.geekbang.org/account/avatar/00/10/93/43/0e84492d.jpg","comment_is_top":false,"comment_ctime":1545725219,"is_pvip":false,"replies":[{"id":"19505","content":"当然不是","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545729993,"ip_address":"","comment_id":53788,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545725219","product_id":100020901,"comment_content":"java程序，如果没写多线程，是不是意味着性能就不好？是不是代码写了多线程性能就好？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434240,"discussion_content":"当然不是","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545729993,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53222,"user_name":"Q","can_delete":false,"product_type":"c1","uid":1047423,"ip_address":"","ucode":"785546C617D3DF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fb/7f/746a6f5e.jpg","comment_is_top":false,"comment_ctime":1545617306,"is_pvip":false,"replies":[{"id":"19341","content":"👍 总结的不错","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545644033,"ip_address":"","comment_id":53222,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545617306","product_id":100020901,"comment_content":"看完理论部分，总结如下：<br><br>1. 什么是负载？因为CPU是处理实体对象是进程或线程，此处的负载是指活跃的进程（不可中断、可运行状态）<br>2.为什么要平均？因为CPU的个数是有限的，处理进程的能力也是有限的，同人类工作能力一样，最理想的状态下就是一个CPU处理一件事情<br>3.如何判断负载高？1&#47;5&#47;15分钟的平均负载值，代表CPU负载是处在过载还是冷却的趋势<br>4.CPU使用率和负载的关系？使用率高负载高，是正比影响，使用率低负载高是其他因素影响，比如IO负载","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434072,"discussion_content":"👍 总结的不错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545644033,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52790,"user_name":"岩寶儿","can_delete":false,"product_type":"c1","uid":1318238,"ip_address":"","ucode":"D3B3BB74F51EDA","user_header":"https://static001.geekbang.org/account/avatar/00/14/1d/5e/7a8cfd2f.jpg","comment_is_top":false,"comment_ctime":1545529996,"is_pvip":false,"replies":[{"id":"19195","content":"这还需要更多的监控指标才能说明问题，比如I&#47;O的使用情况。可以加上iostat -d -x 的监控继续观察是不是有I&#47;O的问题。这一块后面还会细讲","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545536732,"ip_address":"","comment_id":52790,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545529996","product_id":100020901,"comment_content":"老师，请教一个问题。是工作中遇到的，一个oracle数据库的服务器，某一天做rman备份的时候，突然服务器夯住了，ssh没有响应。几分钟后自己恢复了，查看当时的监控数据，夯住前一刻最后一次收集到的iowait不到10%，恢复后第一次收集的iowait是17%，cpu使用率不高。夯住的这段时间没有收集到top vmstat 等信息，uptime监控结果显示这段时间15分钟，5分钟，1分钟的load分别是30%多，70%多，和102%。可以断定是iowait高导致服务器负载过高从而服务器无响应么？？？有可能是内核问题吗，当时服务器只有rman备份，服务器没有做过变更，数据量也没有变化，观察了之前几天同一时间段的负载，也不高。如果是iowait导致的，是否应该有一个逐渐升高的趋势。而不是突然就夯了，没有一点征兆。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433979,"discussion_content":"这还需要更多的监控指标才能说明问题，比如I/O的使用情况。可以加上iostat -d -x 的监控继续观察是不是有I/O的问题。这一块后面还会细讲","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545536732,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52746,"user_name":"YUANWOW","can_delete":false,"product_type":"c1","uid":1259960,"ip_address":"","ucode":"8E9DE020407A1A","user_header":"https://static001.geekbang.org/account/avatar/00/13/39/b8/e4b6a677.jpg","comment_is_top":false,"comment_ctime":1545494380,"is_pvip":false,"replies":[{"id":"19186","content":"逻辑CPU个数","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545535539,"ip_address":"","comment_id":52746,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545494380","product_id":100020901,"comment_content":"文章里CPU平均负载<br>CPU个数其实说的是处理器的线程数对吗？<br>不是物理插槽和内核数 <br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433969,"discussion_content":"逻辑CPU个数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545535539,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52334,"user_name":"章星","can_delete":false,"product_type":"c1","uid":1134381,"ip_address":"","ucode":"6A4BC852BE7025","user_header":"https://static001.geekbang.org/account/avatar/00/11/4f/2d/7b5ed6c2.jpg","comment_is_top":false,"comment_ctime":1545363697,"is_pvip":false,"replies":[{"id":"19079","content":"参考置顶回复","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545386344,"ip_address":"","comment_id":52334,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545363697","product_id":100020901,"comment_content":"[root@D2850 ~]# pidstat -u 5 1 <br>Linux 2.6.32-696.23.1.el6.x86_64 (D2850) \t12&#47;21&#47;2018 \t_x86_64_\t(2 CPU)<br>11:37:39 AM       PID    %usr %system  %guest    %CPU   CPU  Command<br>我怎么没有IOStat栏位呢？<br>我的环境是CentOS6","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433837,"discussion_content":"参考置顶回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545386344,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52330,"user_name":"章星","can_delete":false,"product_type":"c1","uid":1134381,"ip_address":"","ucode":"6A4BC852BE7025","user_header":"https://static001.geekbang.org/account/avatar/00/11/4f/2d/7b5ed6c2.jpg","comment_is_top":false,"comment_ctime":1545363050,"is_pvip":false,"replies":[{"id":"19078","content":"参考置顶回复","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545386336,"ip_address":"","comment_id":52330,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545363050","product_id":100020901,"comment_content":"#stress -i 1 --timeout 600<br>#mpstat -P ALL 5<br>11:26:25 AM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest   %idle<br>11:26:30 AM  all        0.10    0.00   50.45    0.00    0.00    0.00    0.00    0.00   49.45<br>11:26:30 AM    0        0.00    0.00  100.00    0.00    0.00    0.00    0.00    0.00    0.00<br>11:26:30 AM    1        0.20    0.00    1.00    0.00    0.00    0.00    0.00    0.00   98.80<br>模拟IO密集型的时候，发现%iowait 一直是0，是哪里没有模拟正确吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433835,"discussion_content":"参考置顶回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545386336,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52147,"user_name":"管清麟","can_delete":false,"product_type":"c1","uid":1198013,"ip_address":"","ucode":"7CA1651D0DE257","user_header":"https://static001.geekbang.org/account/avatar/00/12/47/bd/5c34df95.jpg","comment_is_top":false,"comment_ctime":1545319550,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545319550","product_id":100020901,"comment_content":"打卡第三天","like_count":0},{"had_liked":false,"id":52011,"user_name":"程序员大天地","can_delete":false,"product_type":"c1","uid":1249001,"ip_address":"","ucode":"7A21F15FEE2D5B","user_header":"https://static001.geekbang.org/account/avatar/00/13/0e/e9/98b6ea61.jpg","comment_is_top":false,"comment_ctime":1545293412,"is_pvip":false,"replies":[{"id":"18881","content":"加油","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545312748,"ip_address":"","comment_id":52011,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545293412","product_id":100020901,"comment_content":"打卡D2","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433698,"discussion_content":"加油","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545312748,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51664,"user_name":"呆梨","can_delete":false,"product_type":"c1","uid":1069474,"ip_address":"","ucode":"7D4B961DE1EE8B","user_header":"https://static001.geekbang.org/account/avatar/00/10/51/a2/4fc7df75.jpg","comment_is_top":false,"comment_ctime":1545219893,"is_pvip":false,"replies":[{"id":"18903","content":"学习的时候最好用简单直观的工具，等熟悉了分析思路再去深入原理，比如用自己的方法重新实现这些工具的功能。<br><br>这些重新实现的方法有些并不复杂，一些SHELL就可以做到，但有些也需要一定的内核代码基础。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545314103,"ip_address":"","comment_id":51664,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545219893","product_id":100020901,"comment_content":"平时开发的时候，线上安装不了这些工具，只能通过ps或者其它命令分析，老师可以从基本的命令讲解下吗，然后再用工具分析下，两者可以再做下比较","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433560,"discussion_content":"学习的时候最好用简单直观的工具，等熟悉了分析思路再去深入原理，比如用自己的方法重新实现这些工具的功能。\n\n这些重新实现的方法有些并不复杂，一些SHELL就可以做到，但有些也需要一定的内核代码基础。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545314103,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51350,"user_name":"ciknife","can_delete":false,"product_type":"c1","uid":1225754,"ip_address":"","ucode":"15E2ECBFD9F52F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erw50noFUsolUTw88Ag1Nte9rfFR6R06JSqIdwlicSPt3eVtaozw7G9ZK7y9UUDHTia5Lxw8ZicuUTVQ/132","comment_is_top":false,"comment_ctime":1545177283,"is_pvip":false,"replies":[{"id":"18643","content":"CPU核心数","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545195657,"ip_address":"","comment_id":51350,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545177283","product_id":100020901,"comment_content":"CPU个数，指的事CPU核心数吗？还是物理CPU个数？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433420,"discussion_content":"CPU核心数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545195657,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50879,"user_name":"无名老卒","can_delete":false,"product_type":"c1","uid":1348261,"ip_address":"","ucode":"48874CE670E122","user_header":"","comment_is_top":false,"comment_ctime":1545059657,"is_pvip":false,"replies":[{"id":"18468","content":"👍 谢谢分享","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545143713,"ip_address":"","comment_id":50879,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545059657","product_id":100020901,"comment_content":"以前看了很资料都没有理解，这次算理解平均负载的意思了。<br><br>另外，使用strss -i 2时，只能看到%wa有升高，但是%util并没有升高，借用倪老师的话，是因为案例中stress使用的是 sync() 系统调用，它的作用是刷新缓冲区内存到磁盘中。这里我提供另外一个参数：d, --hdd N spawn N workers spinning on write()&#47;unlink()来实测写入数据。<br><br>➜  ~ stress --version<br>stress 1.0.4<br>➜  ~ stress -i 2 -d 1<br>stress: info: [18896] dispatching hogs: 0 cpu, 2 io, 0 vm, 1 hdd<br><br>另开一个窗口，观察：<br>➜  ~ iostat -d -x 2 vda<br>Device            r&#47;s     w&#47;s     rkB&#47;s     wkB&#47;s   rrqm&#47;s   wrqm&#47;s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util<br>vda              0.00  144.21      0.00  87027.37     0.00    12.63   0.00   8.05    0.00  438.99  92.67     0.00   603.47   7.30 105.26<br><br>Device            r&#47;s     w&#47;s     rkB&#47;s     wkB&#47;s   rrqm&#47;s   wrqm&#47;s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util<br>vda              0.00   90.53      0.00  91471.58     0.00     2.11   0.00   2.27    0.00 1053.19  97.95     0.00  1010.44  11.60 105.05<br><br>Device            r&#47;s     w&#47;s     rkB&#47;s     wkB&#47;s   rrqm&#47;s   wrqm&#47;s  %rrqm  %wrqm r_await w_await aqu-sz rareq-sz wareq-sz  svctm  %util<br>vda              0.00   98.43      0.00 101059.69     0.00     2.62   0.00   2.59    0.00 1056.49  94.77     0.00  1026.72  10.64 104.71","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433155,"discussion_content":"👍 谢谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545143713,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50563,"user_name":"Zack","can_delete":false,"product_type":"c1","uid":1144097,"ip_address":"","ucode":"749584E7BAEDC9","user_header":"https://static001.geekbang.org/account/avatar/00/11/75/21/1d5459cc.jpg","comment_is_top":false,"comment_ctime":1545009713,"is_pvip":false,"replies":[{"id":"18495","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545145509,"ip_address":"","comment_id":50563,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545009713","product_id":100020901,"comment_content":"打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433022,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545145509,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50263,"user_name":"就不告诉你","can_delete":false,"product_type":"c1","uid":1235462,"ip_address":"","ucode":"101F063473D8DD","user_header":"https://static001.geekbang.org/account/avatar/00/12/da/06/6739dc30.jpg","comment_is_top":false,"comment_ctime":1544936575,"is_pvip":false,"replies":[{"id":"18099","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545003603,"ip_address":"","comment_id":50263,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544936575","product_id":100020901,"comment_content":"打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432929,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545003603,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49928,"user_name":"哈哈哈","can_delete":false,"product_type":"c1","uid":1317806,"ip_address":"","ucode":"E0B317834FC914","user_header":"https://static001.geekbang.org/account/avatar/00/14/1b/ae/61725e3f.jpg","comment_is_top":false,"comment_ctime":1544790823,"is_pvip":false,"replies":[{"id":"18111","content":"仔细看一下pidstat里面是iowait 还是wait？注意它们的含义是不同的，wait是指等待运行","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545005081,"ip_address":"","comment_id":49928,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544790823","product_id":100020901,"comment_content":"场景二中，<br>pidstat看到stress进程的%iowait为 3.99，<br>mpstat 看到单个CPU的%iowait为 60多，两个核的平均值为30多。<br><br>这两个数据差距巨大，为何就认定CPU的iowait就是由stress导致的呢。<br><br>如果黑客入侵系统植入隐藏进程，常规工具是无法发现隐藏进程的pid的。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432802,"discussion_content":"仔细看一下pidstat里面是iowait 还是wait？注意它们的含义是不同的，wait是指等待运行","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545005081,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49842,"user_name":"aderm","can_delete":false,"product_type":"c1","uid":1068825,"ip_address":"","ucode":"1C8FCBA02AEA34","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/19/05834ca2.jpg","comment_is_top":false,"comment_ctime":1544778495,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544778495","product_id":100020901,"comment_content":"很详细，点赞","like_count":0},{"had_liked":false,"id":49761,"user_name":"wisdomone","can_delete":false,"product_type":"c1","uid":1147342,"ip_address":"","ucode":"CA0A9DB12EAD3D","user_header":"https://static001.geekbang.org/account/avatar/00/11/81/ce/94b624c0.jpg","comment_is_top":false,"comment_ctime":1544765325,"is_pvip":false,"replies":[{"id":"17959","content":"加油","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544782504,"ip_address":"","comment_id":49761,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544765325","product_id":100020901,"comment_content":"努力加油","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432762,"discussion_content":"加油","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544782504,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49755,"user_name":"颜培攀","can_delete":false,"product_type":"c1","uid":1246561,"ip_address":"","ucode":"AC8839AB6C69F8","user_header":"https://static001.geekbang.org/account/avatar/00/13/05/61/fc303f93.jpg","comment_is_top":false,"comment_ctime":1544764153,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1544764153","product_id":100020901,"comment_content":"<br>看完文章受益匪浅，但同时陷入了更大的困惑。<br><br>简单来说，平均负载是指单位时间内，系统处于可运行状态和不可中断状态的平均进程数，也就是平均活跃进程数。我的疑问之一是，什么是活跃进程？怎么定义的？<br><br>man ps 看到 ps displays information about a selection of the active processes. 即ps显示活跃进程的信息，因此我理解活跃进程不仅包括状态为 D R，还包括S T Z等。所以平均负载不是平均活跃进程数。之后去看操作系统，A process is an &#39;active&#39; entity as opposed to program which is considered to be a &#39;passive&#39; entity.  进程都是活跃的，与之相反程序是不活跃的。<br><br>我的疑问之二， 平均负载怎么演化出来的？历史是？<br>RFC 546 1973年 定义 平均负载为衡量CPU的指标，即CPU负载。后，Linux加入了 D，逐渐演化成 系统平均负载。去看源码，注释中说付出了巨大的努力，也不知其所以然<br><br>我的疑问三，平均负载如何计算的？<br><br>来源应该是 linux&#47;fs&#47;proc&#47;loadavg.c，具体还需要深入学习","like_count":0},{"had_liked":false,"id":49744,"user_name":"乐而忘死","can_delete":false,"product_type":"c1","uid":1001073,"ip_address":"","ucode":"A3B9812C365FAC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/46/71/53948b56.jpg","comment_is_top":false,"comment_ctime":1544761556,"is_pvip":false,"replies":[{"id":"17961","content":"有可能，别忘了还有很多内核任务和中断","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544782774,"ip_address":"","comment_id":49744,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544761556","product_id":100020901,"comment_content":"老师，有个问题想请教下，如果物理机4个核，处于R状态的进程为2！因为cpu是分时给进程使用的，这个时候是不是还是会发生上下文切换","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432755,"discussion_content":"有可能，别忘了还有很多内核任务和中断","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544782774,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49657,"user_name":"修罗","can_delete":false,"product_type":"c1","uid":1327398,"ip_address":"","ucode":"4A156F9D343F8C","user_header":"https://static001.geekbang.org/account/avatar/00/14/41/26/ba95c89a.jpg","comment_is_top":false,"comment_ctime":1544750507,"is_pvip":false,"replies":[{"id":"18113","content":"这儿是说CPU使用率？一般平均负载是个数值，而使用率是百分比。<br><br>假如是使用率的话，还要细分下是除以cpu个数后的平均使用率，还是累加的使用率。这些从工具手册上可以查到","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545005312,"ip_address":"","comment_id":49657,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544750507","product_id":100020901,"comment_content":"2核cpu负载为100％，是其中的一核负载满了还是2核都负载满了？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432706,"discussion_content":"这儿是说CPU使用率？一般平均负载是个数值，而使用率是百分比。\n\n假如是使用率的话，还要细分下是除以cpu个数后的平均使用率，还是累加的使用率。这些从工具手册上可以查到","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545005312,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49410,"user_name":"陆浩彬","can_delete":false,"product_type":"c1","uid":1103223,"ip_address":"","ucode":"4CCDB643897513","user_header":"https://static001.geekbang.org/account/avatar/00/10/d5/77/71881152.jpg","comment_is_top":false,"comment_ctime":1544683623,"is_pvip":false,"replies":[{"id":"17825","content":"谢谢建议","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544744622,"ip_address":"","comment_id":49410,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544683623","product_id":100020901,"comment_content":"虚拟机环境：ubuntu 16.6 内存2G，cpu 2核。<br>建议 高IO并发场景那一块重写，因为很容易导致读者疑惑。一开始执行stree -i 1 --timeout 600并没有观察到io提升的情况，反而是cpu彪升。如果不是看了留言，都怀疑是作者的文章的问题，建议重新设计一下场景，或者按照留言把评论区的那部分文字修改到正文中去。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432608,"discussion_content":"谢谢建议","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544744622,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49274,"user_name":"Geek_6a3634","can_delete":false,"product_type":"c1","uid":1325968,"ip_address":"","ucode":"A21D3A18D6DB6E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJs1ErIn36IY8B0RVNbkYpcicByPrExnJDABaibhGXmdWxQn3V1dSFRjIrlKaCB3hEdq44ib30zHTPgg/132","comment_is_top":false,"comment_ctime":1544659168,"is_pvip":false,"replies":[{"id":"17843","content":"继续看接下来的案例篇","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544745587,"ip_address":"","comment_id":49274,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544659168","product_id":100020901,"comment_content":"查看到进程负载高后，如何进一步定位进程中哪些操作导致负载过高？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432553,"discussion_content":"继续看接下来的案例篇","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544745587,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49259,"user_name":"熊出没","can_delete":false,"product_type":"c1","uid":1145377,"ip_address":"","ucode":"6E39230CC87808","user_header":"https://static001.geekbang.org/account/avatar/00/11/7a/21/a33cc944.jpg","comment_is_top":false,"comment_ctime":1544636137,"is_pvip":true,"replies":[{"id":"17654","content":"😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544660278,"ip_address":"","comment_id":49259,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544636137","product_id":100020901,"comment_content":"试读这篇后果断下单了 真是满满的干货啊 讲的真好 我觉得我又可以进步了","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432550,"discussion_content":"😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544660278,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48841,"user_name":"顾仲贤","can_delete":false,"product_type":"c1","uid":1107515,"ip_address":"","ucode":"2E2516A8916716","user_header":"https://static001.geekbang.org/account/avatar/00/10/e6/3b/2d14b5e1.jpg","comment_is_top":false,"comment_ctime":1544568441,"is_pvip":true,"replies":[{"id":"17700","content":"20，线程是调度的基本单位，为了方便这里没有细化","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544662007,"ip_address":"","comment_id":48841,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544568441","product_id":100020901,"comment_content":"老师您好。今天是突然想到这个问题。因为现在工作是用Erlang. 然后Erlang VM是一个beam process然后利用thread concurrency(erlang thrrad虽然和system thread不是一个东西)。也就是说一个进程的多个thread是可以同时执行在不同的CPU上。在这种情况下 uptime的平均负载会说是1还是n(thread number). 举例，一个process 有20个线程同时运行，假设现在系统就这么一个进程，那uptime的平均负载是1还是20？谢谢老师","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432380,"discussion_content":"20，线程是调度的基本单位，为了方便这里没有细化","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544662007,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48380,"user_name":"soooldier","can_delete":false,"product_type":"c1","uid":1000746,"ip_address":"","ucode":"04EC4C01DD06FD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/45/2a/c4413de4.jpg","comment_is_top":false,"comment_ctime":1544432217,"is_pvip":false,"replies":[{"id":"17350","content":"如果这是持续监控的现象的话，应该是监控的时间间隔过大导致漏掉了一些潜在的问题，最好去缩短监控系统的时间间隔","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544488757,"ip_address":"","comment_id":48380,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544432217","product_id":100020901,"comment_content":"老师您好，我们线上机器的load15一般维持在2左右，但load5只有零点几。根据load的定义我理解load5都才零点几，load15不应该到2左右呀～唯一可能的情况是在load5之外的时间断load有一个飙高，但我查了下也没出现飙高的情况","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432153,"discussion_content":"如果这是持续监控的现象的话，应该是监控的时间间隔过大导致漏掉了一些潜在的问题，最好去缩短监控系统的时间间隔","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544488757,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48338,"user_name":"力挽狂澜爆炸输出的臭臭宁","can_delete":false,"product_type":"c1","uid":1155904,"ip_address":"","ucode":"E8D26181129BCA","user_header":"https://static001.geekbang.org/account/avatar/00/11/a3/40/e0df3b84.jpg","comment_is_top":false,"comment_ctime":1544424448,"is_pvip":false,"replies":[{"id":"17266","content":"这是sysstat版本导致的问题，请参考下置顶的回复","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544434243,"ip_address":"","comment_id":48338,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544424448","product_id":100020901,"comment_content":"场景三，自己的环境是8核，启动了32个进程，CPU使用率100%，但是wait这个值是0，是不是有些操作系统上这个值是无效的？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432136,"discussion_content":"这是sysstat版本导致的问题，请参考下置顶的回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544434243,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48330,"user_name":"小飞","can_delete":false,"product_type":"c1","uid":1000347,"ip_address":"","ucode":"4C126548FBA94C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/43/9b/50927dfc.jpg","comment_is_top":false,"comment_ctime":1544422746,"is_pvip":false,"replies":[{"id":"17268","content":"可靠性和性能都需要，建议使用RAID和SSD","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544434431,"ip_address":"","comment_id":48330,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544422746","product_id":100020901,"comment_content":"常用的消息系统作为IO密集的服务。最近线上频繁遇到IO Util 打满的场景。 消息系统的性能很难再提升。 （磁盘类型 ： SATA 机械硬盘）<br>iotop 查看监控发现是jdb本身导致使用率过高。 <br>计划关闭jbd功能， 但考虑到作为消息服务，可靠性非常重要。 关闭的化某些极端情况可能会导致文件系统不可用。<br>不是知道老师有没有好的建议应对这种场景。 ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432133,"discussion_content":"可靠性和性能都需要，建议使用RAID和SSD","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544434431,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48319,"user_name":"周亮","can_delete":false,"product_type":"c1","uid":1115610,"ip_address":"","ucode":"FA435C0AEFBBDC","user_header":"https://static001.geekbang.org/account/avatar/00/11/05/da/69087c99.jpg","comment_is_top":false,"comment_ctime":1544419899,"is_pvip":false,"replies":[{"id":"17270","content":"不是，这是指进程在等待某个关键操作的状态，比如I&#47;O，这时候进程不能被信号打断","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544435244,"ip_address":"","comment_id":48319,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544419899","product_id":100020901,"comment_content":"老师你好，进程处于不可中断状态是指会一直占用CPU吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432128,"discussion_content":"不是，这是指进程在等待某个关键操作的状态，比如I/O，这时候进程不能被信号打断","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544435244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48294,"user_name":"念你如昔","can_delete":false,"product_type":"c1","uid":1323531,"ip_address":"","ucode":"FCAD88AB57D084","user_header":"https://static001.geekbang.org/account/avatar/00/14/32/0b/981b4e93.jpg","comment_is_top":false,"comment_ctime":1544413065,"is_pvip":false,"replies":[{"id":"17275","content":"平均负载就是load averqge，前文中有解释它的含义","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544436028,"ip_address":"","comment_id":48294,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544413065","product_id":100020901,"comment_content":"1分钟平均负载：1.73%,2个CPU，这里所说的负载时指该线程指在一个CPU上运行所造成的负载吗","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432109,"discussion_content":"平均负载就是load averqge，前文中有解释它的含义","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544436028,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48257,"user_name":"李慧君","can_delete":false,"product_type":"c1","uid":1342610,"ip_address":"","ucode":"EDF57BA87E376E","user_header":"https://static001.geekbang.org/account/avatar/00/14/7c/92/87f56f0c.jpg","comment_is_top":false,"comment_ctime":1544406894,"is_pvip":false,"replies":[{"id":"17279","content":"👍 超标之后记得定位根源","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544436592,"ip_address":"","comment_id":48257,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544406894","product_id":100020901,"comment_content":"一般使用top perf查看系统负载是否超标。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432090,"discussion_content":"👍 超标之后记得定位根源","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544436592,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48141,"user_name":"Alpha","can_delete":false,"product_type":"c1","uid":1227737,"ip_address":"","ucode":"E6652D2E2C357F","user_header":"https://static001.geekbang.org/account/avatar/00/12/bb/d9/6175dbab.jpg","comment_is_top":false,"comment_ctime":1544366752,"is_pvip":false,"replies":[{"id":"17286","content":"注意pidstat中的是wait，而不是iowait，这是两个不相干的指标","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544436965,"ip_address":"","comment_id":48141,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544366752","product_id":100020901,"comment_content":"mpstat<br>10:41:58 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>10:42:03 PM  all    0.53    0.00   41.66    0.00    0.00    0.00    0.00    0.00    0.00   57.81<br>10:42:03 PM    0    0.84    0.00   61.18    0.00    0.00    0.00    0.00    0.00    0.00   37.97<br>10:42:03 PM    1    0.21    0.00   21.84    0.00    0.00    0.00    0.00    0.00    0.00   77.94<br><br>pidstat -u 5 1<br>Average:      UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command<br>Average:        0      8157    0.20    0.00    0.00    0.00    0.20     -  tmux<br>Average:        0      8308    1.39   78.33    0.00    7.55   79.72     -  stress<br>Average:        0      8310    0.20    0.20    0.00    0.20    0.40     -  watch<br>Average:        0      8898    0.00   19.48    0.00    6.16   19.48     -  kworker&#47;u4:1<br>Average:        0      8939    0.00    0.20    0.00    0.00    0.20     -  pidstat<br><br>场景二：I&#47;O 密集型进程的实验中mpstat发现并没有iowait的变化，但pidstat检查就发现有，难道这是sysstat软件的bug？想请问老师有遇到过么?<br>[root@localhost ~]# rpm -qa sysstat<br>sysstat-12.1.1-1.x86_64<br><br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432047,"discussion_content":"注意pidstat中的是wait，而不是iowait，这是两个不相干的指标","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544436965,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48132,"user_name":"Alpha","can_delete":false,"product_type":"c1","uid":1227737,"ip_address":"","ucode":"E6652D2E2C357F","user_header":"https://static001.geekbang.org/account/avatar/00/12/bb/d9/6175dbab.jpg","comment_is_top":false,"comment_ctime":1544365152,"is_pvip":false,"replies":[{"id":"17287","content":"👍 谢谢分享","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544436979,"ip_address":"","comment_id":48132,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544365152","product_id":100020901,"comment_content":"sysstat 官网有rpm包，可以直接下载安装，如果已经安装自带的，请卸载之后再执行rpm安装！","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432041,"discussion_content":"👍 谢谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544436979,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47949,"user_name":"小老鼠","can_delete":false,"product_type":"c1","uid":1257460,"ip_address":"","ucode":"C663A0C863A515","user_header":"https://static001.geekbang.org/account/avatar/00/13/2f/f4/2dede51a.jpg","comment_is_top":false,"comment_ctime":1544263936,"is_pvip":false,"replies":[{"id":"17075","content":"加油👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544312350,"ip_address":"","comment_id":47949,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544263936","product_id":100020901,"comment_content":"看样子要学好，一要上机练，二要记好笔记","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431957,"discussion_content":"加油👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544312350,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47804,"user_name":"店小二#2","can_delete":false,"product_type":"c1","uid":1130925,"ip_address":"","ucode":"6103E9AE52F8E7","user_header":"https://static001.geekbang.org/account/avatar/00/11/41/ad/4ccf4238.jpg","comment_is_top":false,"comment_ctime":1544203043,"is_pvip":false,"replies":[{"id":"17046","content":"嗯嗯 这也是一个典型的性能问题。不过由于篇幅的限制，我不可能包含所有的场景，只能拿一些典型介绍相关的思路。<br><br>针对这个问题，建议你从应用程序的性能开始，分析下性能瓶颈的根源，比如对比性能正常和异常时的perf，观察NFS内部函数的堆栈，甚至也可以使用火焰图协助","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544256819,"ip_address":"","comment_id":47804,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544203043","product_id":100020901,"comment_content":"老师，没看到有讲解nfs性能的章节，可否增加定性分析nfs性能的内容。我这里也有一个nfs性能的问题，请老师解答一下。<br>困惑场景:<br>nfs client频繁的打开关闭已经落盘的拍重文件（每秒大约300多次），导致我们业务系统的性能大幅下降。正常场景时系统性能20000&#47;s，现在只有50&#47;s。分析发现，在该场景下cpu mem io都没有达到瓶颈，通过业务日志发现文件句柄频繁的被打开关闭，因此怀疑该场景nfs性能出问题。通过nmon等工具也没分析出问题根源，请老师指点。<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431892,"discussion_content":"嗯嗯 这也是一个典型的性能问题。不过由于篇幅的限制，我不可能包含所有的场景，只能拿一些典型介绍相关的思路。\n\n针对这个问题，建议你从应用程序的性能开始，分析下性能瓶颈的根源，比如对比性能正常和异常时的perf，观察NFS内部函数的堆栈，甚至也可以使用火焰图协助","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544256819,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47712,"user_name":"chenlingwx","can_delete":false,"product_type":"c1","uid":1168919,"ip_address":"","ucode":"3B65DA03D46411","user_header":"https://static001.geekbang.org/account/avatar/00/11/d6/17/2293e98f.jpg","comment_is_top":false,"comment_ctime":1544185601,"is_pvip":false,"replies":[{"id":"17009","content":"进程没有iowait的概念，进程需要通过系统调用间接访问磁盘，而系统还需要通过I&#47;O栈（后面会讲）来管理磁盘，所以有些CPU使用只能算在系统的头上","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544193296,"ip_address":"","comment_id":47712,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544185601","product_id":100020901,"comment_content":"老师您好！<br>请教老师:<br>最后的io密集场景二，mpstat显示sys为24％iowait为68％合计90％左右，为什么到pidstat里，stress进程却只显示35％左右的cpu？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431864,"discussion_content":"进程没有iowait的概念，进程需要通过系统调用间接访问磁盘，而系统还需要通过I/O栈（后面会讲）来管理磁盘，所以有些CPU使用只能算在系统的头上","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544193296,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47698,"user_name":"PavelSnake","can_delete":false,"product_type":"c1","uid":1135746,"ip_address":"","ucode":"177C9A76F02E0B","user_header":"https://static001.geekbang.org/account/avatar/00/11/54/82/89cf1522.jpg","comment_is_top":false,"comment_ctime":1544184223,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544184223","product_id":100020901,"comment_content":"D2打卡","like_count":0},{"had_liked":false,"id":47652,"user_name":"池鱼","can_delete":false,"product_type":"c1","uid":1300219,"ip_address":"","ucode":"E77F36AE3DCA23","user_header":"https://static001.geekbang.org/account/avatar/00/13/d6/fb/548e148a.jpg","comment_is_top":false,"comment_ctime":1544172354,"is_pvip":false,"replies":[{"id":"17010","content":"等待CPU的时间百分比，跟IO没关系","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544193324,"ip_address":"","comment_id":47652,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544172354","product_id":100020901,"comment_content":"pidstat命令中的%wait是等待io的百分比还是进程等待cpu的百分比？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431844,"discussion_content":"等待CPU的时间百分比，跟IO没关系","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544193324,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47588,"user_name":"肘子哥","can_delete":false,"product_type":"c1","uid":1333601,"ip_address":"","ucode":"F152F3DF514117","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ccpIPibkaTQfYbO5DGiaWpL86YSHAZfVO55WtJhjV0hb7AuyIMzLyRdLnQZ6tjB0Wars4ib7YX3fhmPh9R81MVKtA/132","comment_is_top":false,"comment_ctime":1544160060,"is_pvip":false,"replies":[{"id":"17078","content":"很多工具的数据就是源自系统，比如proc文件系统中提供了大量的数据。所以在学习的时候，可以留意性能工具的工作原理，比如试着从proc里面自己计算跟已有工具作对比","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544313160,"ip_address":"","comment_id":47588,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544160060","product_id":100020901,"comment_content":"现网环境中，mpstat和pidstat这些都是没有的，现网又禁止安装，这种情况有什么好的定位思路吗，老师","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431819,"discussion_content":"很多工具的数据就是源自系统，比如proc文件系统中提供了大量的数据。所以在学习的时候，可以留意性能工具的工作原理，比如试着从proc里面自己计算跟已有工具作对比","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544313160,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47322,"user_name":"光翟","can_delete":false,"product_type":"c1","uid":1317244,"ip_address":"","ucode":"46C5756589C6C5","user_header":"https://static001.geekbang.org/account/avatar/00/14/19/7c/f0ef6464.jpg","comment_is_top":false,"comment_ctime":1544106794,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544106794","product_id":100020901,"comment_content":"在centos 7.2(阿里云）里面yum安装stress时可能会提示报错，有可能是yum源的问题，可以先安装”epel-release”的软件包，会自动配置yum的软件仓库。如下：<br>sudo yum install -y epel-release<br>sudo yum install -y stress","like_count":0},{"had_liked":false,"id":47312,"user_name":"如果","can_delete":false,"product_type":"c1","uid":1320638,"ip_address":"","ucode":"138A3EEEE50850","user_header":"","comment_is_top":false,"comment_ctime":1544105222,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544105222","product_id":100020901,"comment_content":"DAY2<br>满满的干货，既update,top,之后的分析思路更进一步，原来自己缺失的基础还有很多，看十遍不如动手敲一遍，希望能跟的上老师的思路~~","like_count":0},{"had_liked":false,"id":46821,"user_name":"朱雯","can_delete":false,"product_type":"c1","uid":1035744,"ip_address":"","ucode":"064C45FBF6B51F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/cd/e0/c85bb948.jpg","comment_is_top":false,"comment_ctime":1543986535,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1543986535","product_id":100020901,"comment_content":"1:平均负载:单位时间内，系统处于可运行状态(running或runnable，也称之为r状态)和不可中断状态(d状态，disk sleep)的平均进程数<br>ps:不可中断状态：比如进程写入磁盘，保证磁盘和进程数据一致，这个时候不可打断，否则数据不一致，所以这是对进程和硬件的保护<br><br>2:多少负载合理:理想状况，每一个cpu上都刚好一个进程，这样cpu就充分的得到了利用，比如负载为2<br>                1:2cpu，所有cpu刚好完全使用 2:1cpu，有一半进程无法竞争到cpu，3:4cpu，有50%空闲<br>4:查看负载方法：uptime， top，查看cpu核心数 cat &#47;proc&#47;cpuinfo|grep “model name”|wc - l<br>5:要综合观察系统负载问题，1分钟，5分钟，15分钟，同时分析规律，了解系统负载变化情况，当负载高于cpu数量的70%的时候，那么就可能导致进程响应变慢，进而影响服务的正常功能<br>6:cpu使用率和平均负载并不完全等同分为多种情况：1:io密集型，io会导致平均负载升高，但是cpu使用率不一定高，<br>2cpu密集型，两者一致，3:大量等待的cpu进程调度也会导致负载升高，cpu使用率会升高<br><br>另外看到有人问中断是干嘛的，我的理解是切换进程用的，不中断切换不了进程","like_count":0},{"had_liked":false,"id":46408,"user_name":"life_牛","can_delete":false,"product_type":"c1","uid":1150443,"ip_address":"","ucode":"39E99CD4BFA48C","user_header":"https://static001.geekbang.org/account/avatar/00/11/8d/eb/e98af40f.jpg","comment_is_top":false,"comment_ctime":1543917241,"is_pvip":false,"replies":[{"id":"16602","content":"那就需要细分一下到底是什么类型的CPU使用率高，后面的文章会依次讲述每个类型的分析方法","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543927985,"ip_address":"","comment_id":46408,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543917241","product_id":100020901,"comment_content":"我用mpstat -P ALL 5 1 命令看到cpu使用率很高，但是用pidstat -u 5 1 命令看到usr%都是0 其他参数看不出来问题，这个是什么原因","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431449,"discussion_content":"那就需要细分一下到底是什么类型的CPU使用率高，后面的文章会依次讲述每个类型的分析方法","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543927985,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45914,"user_name":"ZEO","can_delete":false,"product_type":"c1","uid":1100027,"ip_address":"","ucode":"EFCB975C36307D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLl3Ye2UaHZaicq2a1YibSriaUTaxzZOMwajOR39dWKOHLGibkL2zcp6ee2I3Fibjobqjxq2G3piaYYLLZg/132","comment_is_top":false,"comment_ctime":1543817476,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543817476","product_id":100020901,"comment_content":"4核cpu，有3个核使用率长期在70%，其中一个核使用率长期在80%以上，这种问题如何排查呢<br>","like_count":0},{"had_liked":false,"id":45868,"user_name":"404","can_delete":false,"product_type":"c1","uid":1313407,"ip_address":"","ucode":"2E7815DDCBA8AB","user_header":"","comment_is_top":false,"comment_ctime":1543806245,"is_pvip":false,"replies":[{"id":"16422","content":"只要把Linux虚拟机准备好就可以了，后面每个案例都有详细的操作步骤","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543831396,"ip_address":"","comment_id":45868,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543806245","product_id":100020901,"comment_content":"老师你好，我想用docker 去搭建你说的环境，目前用docker-compose 可以跑起来，想问下怎么搭建你说的环境。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431246,"discussion_content":"只要把Linux虚拟机准备好就可以了，后面每个案例都有详细的操作步骤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543831396,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45794,"user_name":"力挽狂澜爆炸输出的臭臭宁","can_delete":false,"product_type":"c1","uid":1155904,"ip_address":"","ucode":"E8D26181129BCA","user_header":"https://static001.geekbang.org/account/avatar/00/11/a3/40/e0df3b84.jpg","comment_is_top":false,"comment_ctime":1543797299,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543797299","product_id":100020901,"comment_content":"老师您好，之前用pidstat命令的时候，在4核场景下，进程的%usr显示最大为100%，但是使用top观测的时候该进程的%usr有200%多的，为什么pidstat只能显示到100%？","like_count":0},{"had_liked":false,"id":45757,"user_name":"Geng","can_delete":false,"product_type":"c1","uid":1202134,"ip_address":"","ucode":"3FF8A62B08035A","user_header":"https://static001.geekbang.org/account/avatar/00/12/57/d6/ee9e1e43.jpg","comment_is_top":false,"comment_ctime":1543773007,"is_pvip":false,"replies":[{"id":"16294","content":"👍 谢谢分享","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543793583,"ip_address":"","comment_id":45757,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543773007","product_id":100020901,"comment_content":"http:&#47;&#47;pagesperso-orange.fr&#47;sebastien.godard&#47;sysstat-12.1.1-1.x86_64.rpm","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431196,"discussion_content":"👍 谢谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543793583,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45560,"user_name":"狼行天下","can_delete":false,"product_type":"c1","uid":1099643,"ip_address":"","ucode":"3C1D0BABB41F3D","user_header":"https://static001.geekbang.org/account/avatar/00/10/c7/7b/2c8db475.jpg","comment_is_top":false,"comment_ctime":1543674153,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543674153","product_id":100020901,"comment_content":"工作了n多年后又重新回来看这些信息，我发现这些基础概念还是很重要的。","like_count":0},{"had_liked":false,"id":45549,"user_name":"蜉蝣","can_delete":false,"product_type":"c1","uid":1229070,"ip_address":"","ucode":"77CF92496855D4","user_header":"https://static001.geekbang.org/account/avatar/00/12/c1/0e/2b987d54.jpg","comment_is_top":false,"comment_ctime":1543669352,"is_pvip":false,"replies":[{"id":"16237","content":"试试置顶的stress-ng","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543719398,"ip_address":"","comment_id":45549,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543669352","product_id":100020901,"comment_content":"老师，第二个I&#47;O密集的实战中，我的iowait始终为0，但是sys达到了100，并且平均负载也有超过1. 我是哪里弄错了吗？（命令应该没有敲错）","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431087,"discussion_content":"试试置顶的stress-ng","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543719398,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45519,"user_name":"$#","can_delete":false,"product_type":"c1","uid":1328065,"ip_address":"","ucode":"ED6368E80EAC63","user_header":"https://static001.geekbang.org/account/avatar/00/14/43/c1/eb3024a7.jpg","comment_is_top":false,"comment_ctime":1543658785,"is_pvip":false,"replies":[{"id":"16238","content":"-d可以的，也是在写磁盘。也可以试试置顶的stress-ng","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543719478,"ip_address":"","comment_id":45519,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543658785","product_id":100020901,"comment_content":"我的用centos6，stress -i 产生不了高的io，反而cpu使用率高，而用stress -d却可以产生高的io？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431074,"discussion_content":"-d可以的，也是在写磁盘。也可以试试置顶的stress-ng","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543719478,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45511,"user_name":"mark","can_delete":false,"product_type":"c1","uid":1332461,"ip_address":"","ucode":"7135BC57978AAA","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ6U2qqpFnTbI6gn864YdOIxebTOoJdR6ibwYfUQxwXtl9KjUOJfdJ2aWgsUBYyj5jKqUESluKcUMg/132","comment_is_top":false,"comment_ctime":1543657581,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543657581","product_id":100020901,"comment_content":"打卡，看得出来老师实战很强","like_count":0},{"had_liked":false,"id":45410,"user_name":"牵着蜗牛散步","can_delete":false,"product_type":"c1","uid":1335453,"ip_address":"","ucode":"68058BDD401A41","user_header":"https://static001.geekbang.org/account/avatar/00/14/60/9d/763e08ca.jpg","comment_is_top":false,"comment_ctime":1543633910,"is_pvip":false,"replies":[{"id":"16336","content":"是的，是逻辑CPU数","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543798712,"ip_address":"","comment_id":45410,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543633910","product_id":100020901,"comment_content":"这里说的cpu个数 应该指的是cpu的核数吧，并不是真正的cpu的个数","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431023,"discussion_content":"是的，是逻辑CPU数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543798712,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45380,"user_name":"任重道远","can_delete":false,"product_type":"c1","uid":1325715,"ip_address":"","ucode":"BDA98B670E70D7","user_header":"https://static001.geekbang.org/account/avatar/00/14/3a/93/2d4f2988.jpg","comment_is_top":false,"comment_ctime":1543627351,"is_pvip":false,"replies":[{"id":"16338","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543798938,"ip_address":"","comment_id":45380,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543627351","product_id":100020901,"comment_content":"stress-ng  -i --timeout 600  就可以看到iowait升高","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431008,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543798938,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45335,"user_name":"随风","can_delete":false,"product_type":"c1","uid":1244248,"ip_address":"","ucode":"86A78303C9AB9D","user_header":"https://static001.geekbang.org/account/avatar/00/12/fc/58/90b7b363.jpg","comment_is_top":false,"comment_ctime":1543590111,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543590111","product_id":100020901,"comment_content":"不可中断进程就是一直等待io完成，io也是机器负载的一部分，不只是说cpu的占用","like_count":0},{"had_liked":false,"id":45328,"user_name":"随风","can_delete":false,"product_type":"c1","uid":1244248,"ip_address":"","ucode":"86A78303C9AB9D","user_header":"https://static001.geekbang.org/account/avatar/00/12/fc/58/90b7b363.jpg","comment_is_top":false,"comment_ctime":1543588752,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543588752","product_id":100020901,"comment_content":"假如某个机器是16核的那就最多能开16个进程，如果进程数大于机器的核数就会导致系统响应变慢，但在实际的服务端我经常看到有很多个进程在同一台机。","like_count":0},{"had_liked":false,"id":45313,"user_name":"海军上校","can_delete":false,"product_type":"c1","uid":1104290,"ip_address":"","ucode":"7B0D9EC01A3F36","user_header":"https://static001.geekbang.org/account/avatar/00/10/d9/a2/afbc447c.jpg","comment_is_top":false,"comment_ctime":1543584796,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543584796","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":45286,"user_name":"f","can_delete":false,"product_type":"c1","uid":1027733,"ip_address":"","ucode":"8849D39F700E4B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ae/95/d1b13c9e.jpg","comment_is_top":false,"comment_ctime":1543577164,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543577164","product_id":100020901,"comment_content":"打卡<br><br>我发现文章中，模拟io负载的 mpstat -P ALL 5 1<br>只有一个CPU的iowait，变高。<br><br>但是在我新安装的ubuntu，中是两个cpu都60%以上。（使用的 stress-ng）<br><br>这个现象怎么解释啊？","like_count":0},{"had_liked":false,"id":45252,"user_name":"冰块","can_delete":false,"product_type":"c1","uid":1272694,"ip_address":"","ucode":"36DC4B5DDA267A","user_header":"https://static001.geekbang.org/account/avatar/00/13/6b/76/357291e1.jpg","comment_is_top":false,"comment_ctime":1543568781,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543568781","product_id":100020901,"comment_content":"pidstat 可以显示是哪个进程在消耗CPU <br>但是如何知道该进程属于哪个用户呢<br>请教下老师","like_count":0},{"had_liked":false,"id":45171,"user_name":"一路向前","can_delete":false,"product_type":"c1","uid":1044524,"ip_address":"","ucode":"5D7CC9F8BFCDA6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f0/2c/513173e9.jpg","comment_is_top":false,"comment_ctime":1543555372,"is_pvip":false,"replies":[{"id":"16088","content":"嗯嗯，谢谢推荐。其实很多工具都可以用，之前考虑不周，已经在置顶回复里面推荐了stress-ng ","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543571314,"ip_address":"","comment_id":45171,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543555372","product_id":100020901,"comment_content":"模拟I&#47;O可以用bonnie++这个工具，我看国外一些网站有人用这个做I&#47;O性能测试，demo：<br>bonnie++ -n 0 -u 0 -r `free -m | grep &#39;Mem:&#39; | awk &#39;{print $2}&#39;` -s $(echo &quot;scale=0;`free -m | grep &#39;Mem:&#39; | awk &#39;{print $2}&#39;`*2&quot; | bc -l) -f -b -d &#47;volumetest<br>注：&#47;volumetest是一个目录，模拟数据会持续写入这个目录","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430947,"discussion_content":"嗯嗯，谢谢推荐。其实很多工具都可以用，之前考虑不周，已经在置顶回复里面推荐了stress-ng ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543571314,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45158,"user_name":"Robert小七","can_delete":false,"product_type":"c1","uid":1165254,"ip_address":"","ucode":"6BBF4674673AF5","user_header":"https://static001.geekbang.org/account/avatar/00/11/c7/c6/35cc7c7c.jpg","comment_is_top":false,"comment_ctime":1543552620,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543552620","product_id":100020901,"comment_content":"在进行IO密集型的测试中，我使用的系统中io等待一致为0，反而是%sys占用率非常高，请问这是为什么<br>Average:     CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>Average:     all    0.70    0.00   50.40    0.10    0.00    0.00    0.00    0.00    0.00   48.80<br>Average:       0    1.20    0.00    3.01    0.00    0.00    0.00    0.00    0.00    0.00   95.79<br>Average:       1    0.20    0.00   98.00    0.00    0.00    0.00    0.00    0.00    0.00    1.80","like_count":0},{"had_liked":false,"id":45120,"user_name":"四阿哥","can_delete":false,"product_type":"c1","uid":1104580,"ip_address":"","ucode":"3296E89174D370","user_header":"https://static001.geekbang.org/account/avatar/00/10/da/c4/270db3ad.jpg","comment_is_top":false,"comment_ctime":1543547833,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543547833","product_id":100020901,"comment_content":"直接就定位到了最近上线的一个系统问题，netty中线程没有关，很使用的专栏，谢谢。","like_count":0},{"had_liked":false,"id":45099,"user_name":"Zenppl","can_delete":false,"product_type":"c1","uid":1322987,"ip_address":"","ucode":"093795428BADB7","user_header":"https://static001.geekbang.org/account/avatar/00/14/2f/eb/5dceac8a.jpg","comment_is_top":false,"comment_ctime":1543545581,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543545581","product_id":100020901,"comment_content":"请问老师，uptime中平均负载的第一个值为最近1分钟的平均负载，当我stress --cpu 1后，不断的使用uptime查看发现，大概过了三五分钟这个值才达到1，这怎么理解呢？","like_count":0},{"had_liked":false,"id":44913,"user_name":"Griffin","can_delete":false,"product_type":"c1","uid":1087329,"ip_address":"","ucode":"CF766B92A65261","user_header":"https://static001.geekbang.org/account/avatar/00/10/97/61/34a0da09.jpg","comment_is_top":false,"comment_ctime":1543506329,"is_pvip":false,"replies":[{"id":"16007","content":"逻辑CPU个数","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543537392,"ip_address":"","comment_id":44913,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543506329","product_id":100020901,"comment_content":"常听说Inter的cpu是4核8线程或者6核12线程，请问文章中的cpu数是指的cpu的核还是线程？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430859,"discussion_content":"逻辑CPU个数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543537392,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44902,"user_name":"杨珂","can_delete":false,"product_type":"c1","uid":1156381,"ip_address":"","ucode":"3CD45E0F7A119D","user_header":"https://static001.geekbang.org/account/avatar/00/11/a5/1d/071a4d3c.jpg","comment_is_top":false,"comment_ctime":1543504209,"is_pvip":true,"replies":[{"id":"16008","content":"很多案例就是基于容器运行的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543537463,"ip_address":"","comment_id":44902,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543504209","product_id":100020901,"comment_content":"后面是不是可以加上基于容器的性能优化分析？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430855,"discussion_content":"很多案例就是基于容器运行的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543537463,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44894,"user_name":"悬铃木（赵岩）","can_delete":false,"product_type":"c1","uid":1327862,"ip_address":"","ucode":"BB8285E938EE7B","user_header":"https://static001.geekbang.org/account/avatar/00/14/42/f6/6532d23d.jpg","comment_is_top":false,"comment_ctime":1543503842,"is_pvip":false,"replies":[{"id":"16009","content":"请参考置顶微博","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543537480,"ip_address":"","comment_id":44894,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543503842","product_id":100020901,"comment_content":"场景二 io密集型的 pidstat怎么就看出stress消耗了iowait呢？输出没看到iowait指标啊，只看到cpu用了37%而已","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430852,"discussion_content":"请参考置顶微博","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543537480,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44864,"user_name":"别 闹","can_delete":false,"product_type":"c1","uid":1316292,"ip_address":"","ucode":"08CEC159031EC9","user_header":"https://static001.geekbang.org/account/avatar/00/14/15/c4/658edf74.jpg","comment_is_top":false,"comment_ctime":1543501101,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543501101","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":44831,"user_name":"天空之城","can_delete":false,"product_type":"c1","uid":1316326,"ip_address":"","ucode":"571B92401BD566","user_header":"https://static001.geekbang.org/account/avatar/00/14/15/e6/2920b160.jpg","comment_is_top":false,"comment_ctime":1543497264,"is_pvip":false,"replies":[{"id":"16011","content":"嗯，考虑不周，在置顶回复里面说明了","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543537778,"ip_address":"","comment_id":44831,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543497264","product_id":100020901,"comment_content":"压io的方法不对","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430844,"discussion_content":"嗯，考虑不周，在置顶回复里面说明了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543537778,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44801,"user_name":"张明岗","can_delete":false,"product_type":"c1","uid":1206235,"ip_address":"","ucode":"2D970C9F95A4B3","user_header":"https://static001.geekbang.org/account/avatar/00/12/67/db/d9afdc51.jpg","comment_is_top":false,"comment_ctime":1543494734,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543494734","product_id":100020901,"comment_content":"老师你好，我用mpstat -P ALL 5查看的时候，为什么几个cpu对应的nice值都在99-100区间变化呢","like_count":0},{"had_liked":false,"id":44767,"user_name":"__花祭.","can_delete":false,"product_type":"c1","uid":1316386,"ip_address":"","ucode":"0096FC909CF015","user_header":"https://static001.geekbang.org/account/avatar/00/14/16/22/efc16d64.jpg","comment_is_top":false,"comment_ctime":1543488552,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543488552","product_id":100020901,"comment_content":"滴滴打卡成功..坚持","like_count":0},{"had_liked":false,"id":44755,"user_name":"猫饼","can_delete":false,"product_type":"c1","uid":1310456,"ip_address":"","ucode":"675F4880937469","user_header":"https://static001.geekbang.org/account/avatar/00/13/fe/f8/3e8de9b1.jpg","comment_is_top":false,"comment_ctime":1543486867,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543486867","product_id":100020901,"comment_content":"最近面试  抓紧学一点装个逼","like_count":0},{"had_liked":false,"id":44667,"user_name":"luodi","can_delete":false,"product_type":"c1","uid":1334245,"ip_address":"","ucode":"A0D8613C792C47","user_header":"https://static001.geekbang.org/account/avatar/00/14/5b/e5/aaa642da.jpg","comment_is_top":false,"comment_ctime":1543472850,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543472850","product_id":100020901,"comment_content":"打卡，这个问题确实困扰我很久了。百度查的都是敷敷浮浮地说明，而且很多是错误了。您这个讲的太好了。","like_count":0},{"had_liked":false,"id":44651,"user_name":"邋遢熊","can_delete":false,"product_type":"c1","uid":1000257,"ip_address":"","ucode":"9B4732F85904D5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/43/41/f7aa80e9.jpg","comment_is_top":false,"comment_ctime":1543470832,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543470832","product_id":100020901,"comment_content":"我是在kvm虚拟机上测试的，io测试并没有在mpstat统计指标中看到iowait升高，而是system升高，是因为kvm和宿主机交换虚拟io导致的么，虚拟机上的iowait指标是不是不会有什么作用，因为它本没有io硬件。","like_count":0},{"had_liked":false,"id":44565,"user_name":"vincentjia","can_delete":false,"product_type":"c1","uid":1005699,"ip_address":"","ucode":"EC26D23594600D","user_header":"","comment_is_top":false,"comment_ctime":1543457868,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543457868","product_id":100020901,"comment_content":"我想问个可用内存的问题 。如下，现在可用内存到底是 235m还是15g呢？ free项和available区别是什么？<br><br>[dev@pre1 ~]$ free -h<br>              total        used        free      shared  buff&#47;cache   available<br>Mem:            31G         14G        235M        5.7M         16G         15G<br>Swap:            0B          0B          0B","like_count":0},{"had_liked":false,"id":44402,"user_name":"卡卡","can_delete":false,"product_type":"c1","uid":1064855,"ip_address":"","ucode":"E696CC0386FA27","user_header":"https://static001.geekbang.org/account/avatar/00/10/3f/97/8d7a6460.jpg","comment_is_top":false,"comment_ctime":1543421662,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543421662","product_id":100020901,"comment_content":"我的环境是centos 7，pidstat -u 5 1 命令，为什么没有wait一项？<br>[root@Server-388c1032-0855-4447-8f7e-5ae2c0fa44e1 ~]# pidstat -u 5 1<br>Linux 3.10.0-693.11.1.el7.x86_64 (Server-388c1032-0855-4447-8f7e-5ae2c0fa44e1.novalocal)        11&#47;29&#47;2018      _x86_64_        (2 CPU)<br><br>12:11:54 AM   UID       PID    %usr %system  %guest    %CPU   CPU  Command<br>12:11:59 AM     0     25295    0.20    0.20    0.00    0.40     1  watch<br>12:11:59 AM     0     25363   25.20    0.00    0.00   25.20     0  stress<br>12:11:59 AM     0     25364   24.80    0.00    0.00   24.80     1  stress<br>12:11:59 AM     0     25365   25.00    0.00    0.00   25.00     0  stress<br>12:11:59 AM     0     25366   24.80    0.00    0.00   24.80     1  stress<br>12:11:59 AM     0     25367   25.00    0.00    0.00   25.00     0  stress<br>12:11:59 AM     0     25368   24.80    0.00    0.00   24.80     1  stress<br>12:11:59 AM     0     25369   25.00    0.00    0.00   25.00     0  stress<br>12:11:59 AM     0     25370   25.00    0.00    0.00   25.00     1  stress<br><br>Average:      UID       PID    %usr %system  %guest    %CPU   CPU  Command<br>Average:        0     25295    0.20    0.20    0.00    0.40     -  watch<br>Average:        0     25363   25.20    0.00    0.00   25.20     -  stress<br>Average:        0     25364   24.80    0.00    0.00   24.80     -  stress<br>Average:        0     25365   25.00    0.00    0.00   25.00     -  stress<br>Average:        0     25366   24.80    0.00    0.00   24.80     -  stress<br>Average:        0     25367   25.00    0.00    0.00   25.00     -  stress<br>Average:        0     25368   24.80    0.00    0.00   24.80     -  stress<br>Average:        0     25369   25.00    0.00    0.00   25.00     -  stress<br>Average:        0     25370   25.00    0.00    0.00   25.00     -  stress","like_count":0},{"had_liked":false,"id":44377,"user_name":"莫名","can_delete":false,"product_type":"c1","uid":1007254,"ip_address":"","ucode":"E28F2602BA25DD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5e/96/a03175bc.jpg","comment_is_top":false,"comment_ctime":1543416599,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543416599","product_id":100020901,"comment_content":"&#47;*<br> * kernel&#47;sched&#47;loadavg.c<br> *<br> * Its a silly number but people think its important. We go through<br> * great pains to make it work on big machines and tickless kernels.<br> *&#47;<br><br>Its a silly number but people think its important...","like_count":0},{"had_liked":false,"id":44374,"user_name":"型火🔥","can_delete":false,"product_type":"c1","uid":1003205,"ip_address":"","ucode":"C2322918B31E60","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4e/c5/78626367.jpg","comment_is_top":false,"comment_ctime":1543416298,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1543416298","product_id":100020901,"comment_content":"D2 mark","like_count":0},{"had_liked":false,"id":44289,"user_name":"仁者","can_delete":false,"product_type":"c1","uid":1130632,"ip_address":"","ucode":"EE2BA3A7FA34BC","user_header":"https://static001.geekbang.org/account/avatar/00/11/40/88/b36caddb.jpg","comment_is_top":false,"comment_ctime":1543400851,"is_pvip":false,"replies":[{"id":"15805","content":"文中有讲解，正在等待CPU的进程也算的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543407450,"ip_address":"","comment_id":44289,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543400851","product_id":100020901,"comment_content":"平均负载相当于平均活跃进程数，那么什么是活跃进程数呢？未竞争到 CPU 的进程也算？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430713,"discussion_content":"文中有讲解，正在等待CPU的进程也算的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543407450,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44253,"user_name":"嘉神666","can_delete":false,"product_type":"c1","uid":1317473,"ip_address":"","ucode":"021CA7D92AD1CE","user_header":"https://static001.geekbang.org/account/avatar/00/14/1a/61/fff6c73e.jpg","comment_is_top":false,"comment_ctime":1543394700,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543394700","product_id":100020901,"comment_content":"迟到了，打卡","like_count":0},{"had_liked":false,"id":44203,"user_name":"Adam","can_delete":false,"product_type":"c1","uid":1305633,"ip_address":"","ucode":"338BA720880E4F","user_header":"https://static001.geekbang.org/account/avatar/00/13/ec/21/b0fe1bfd.jpg","comment_is_top":false,"comment_ctime":1543383327,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543383327","product_id":100020901,"comment_content":"有个问题想请教下老师。一个进程的状态处于task_uninterruptible不可间断的状态（进程在等待磁盘IO操作），这种状态下这个进程应该不会执行任何操作的信号，也就是其它一些中断处理的信号应该也不会执行才行，所以中断处理任务应该也不会打断此时的进程吧。","like_count":0},{"had_liked":false,"id":44136,"user_name":"划时代","can_delete":false,"product_type":"c1","uid":1061454,"ip_address":"","ucode":"9554CE2F83B77F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/2o1Izf2YyJSnnI0ErZ51pYRlnrmibqUTaia3tCU1PjMxuwyXSKOLUYiac2TQ5pd5gNGvS81fVqKWGvDsZLTM8zhWg/132","comment_is_top":false,"comment_ctime":1543372360,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543372360","product_id":100020901,"comment_content":"平时基本都是用top命令，动手实践下载stress和sysstat源码安装包。","like_count":0},{"had_liked":false,"id":44108,"user_name":"倪路","can_delete":false,"product_type":"c1","uid":1325941,"ip_address":"","ucode":"C7B93EE9001D96","user_header":"https://static001.geekbang.org/account/avatar/00/14/3b/75/1312e1c2.jpg","comment_is_top":false,"comment_ctime":1543369457,"is_pvip":false,"replies":[{"id":"15830","content":"CPU是空闲的，iowait展示就是等待I&#47;O的时间比例","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543410406,"ip_address":"","comment_id":44108,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543369457","product_id":100020901,"comment_content":"请问进程状态为D，即处于等待不可中断io的进程会占用cpu吗？如果不会，那么为什么通过mpstat显示部分cpu会被iowait占据","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430631,"discussion_content":"CPU是空闲的，iowait展示就是等待I/O的时间比例","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543410406,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44107,"user_name":"Steven","can_delete":false,"product_type":"c1","uid":1327408,"ip_address":"","ucode":"5FD2D5442D5A1E","user_header":"https://static001.geekbang.org/account/avatar/00/14/41/30/704394b7.jpg","comment_is_top":false,"comment_ctime":1543369431,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543369431","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":44067,"user_name":"ichiro","can_delete":false,"product_type":"c1","uid":1086179,"ip_address":"","ucode":"D1708D87538F42","user_header":"https://static001.geekbang.org/account/avatar/00/10/92/e3/1be13204.jpg","comment_is_top":false,"comment_ctime":1543367055,"is_pvip":false,"replies":[{"id":"15833","content":"CPU使用率高了，平均负载也会跟着升高","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543410782,"ip_address":"","comment_id":44067,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543367055","product_id":100020901,"comment_content":"老师，cpu密集型进程只能是cpu使用率很高，但不一定平均负载高，平均负载是活跃进成数，这情况并不一致","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430621,"discussion_content":"CPU使用率高了，平均负载也会跟着升高","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543410782,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44021,"user_name":"张俊生","can_delete":false,"product_type":"c1","uid":1315242,"ip_address":"","ucode":"5234EF5C0CD930","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/aa/01c9af8a.jpg","comment_is_top":false,"comment_ctime":1543365482,"is_pvip":false,"replies":[{"id":"15837","content":"参考第一条回复","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543411115,"ip_address":"","comment_id":44021,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543365482","product_id":100020901,"comment_content":"实测 stress -i 1 --timeout 600,虽然提示dispatching hogs：0 cpu，1 io，通过mpstat - P ALL,反馈的仍旧是％sys负载高，而不是％iowait???","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430599,"discussion_content":"参考第一条回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543411115,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43964,"user_name":"李建贵","can_delete":false,"product_type":"c1","uid":1114814,"ip_address":"","ucode":"BC967D4C3F4F50","user_header":"https://static001.geekbang.org/account/avatar/00/11/02/be/bc2ca09d.jpg","comment_is_top":false,"comment_ctime":1543341667,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543341667","product_id":100020901,"comment_content":"打卡，实验抽时间做吧，最近加班严重，不小心拉上两节!","like_count":0},{"had_liked":false,"id":43948,"user_name":"发条橙子 。","can_delete":false,"product_type":"c1","uid":1259218,"ip_address":"","ucode":"ED076F4534FFED","user_header":"https://static001.geekbang.org/account/avatar/00/13/36/d2/c7357723.jpg","comment_is_top":false,"comment_ctime":1543332924,"is_pvip":false,"replies":[{"id":"15846","content":"平均负载是所有CPU的平均活跃进程数","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543411561,"ip_address":"","comment_id":43948,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543332924","product_id":100020901,"comment_content":"老师， 你的平均负载相当线程数了 ？？ load 为 2 ，当cpu为2的时候刚好完全占用， 就是一个cpu占一个线程。 cpu 为 4 的时候 ，其中两个 cpu 各占一个线程 。有两个cpu空闲，则空闲 50 % ？？？是这样么 。 <br>按我的理解， load 应该是每个cpu中的线程队列所占的线程数把 。 比如 load为2的时候，每个cpu线程队列为2 ， 当cpu为2的时候，表示当前活跃线程为 4。 按照老师的意思，load直接为当前活跃线程数，平分给每个cpu了 ？？ ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430563,"discussion_content":"平均负载是所有CPU的平均活跃进程数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543411561,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43918,"user_name":"Qoo","can_delete":false,"product_type":"c1","uid":1234944,"ip_address":"","ucode":"597362C2F7562B","user_header":"https://static001.geekbang.org/account/avatar/00/12/d8/00/4650b237.jpg","comment_is_top":false,"comment_ctime":1543324555,"is_pvip":false,"replies":[{"id":"15848","content":"使用pidstat、vmstat再细化分析一下系统和进程的CPU使用情况，应该会有所发现","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543411905,"ip_address":"","comment_id":43918,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543324555","product_id":100020901,"comment_content":"老师，我用了一台48逻辑核的服务器，使用命令<br>stress -cpu 48 --timeout 600<br>结果负载到了120+，按理说应该是48. 不能理解","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430550,"discussion_content":"使用pidstat、vmstat再细化分析一下系统和进程的CPU使用情况，应该会有所发现","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543411905,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43899,"user_name":"Geek_60821e","can_delete":false,"product_type":"c1","uid":1316693,"ip_address":"","ucode":"A55F71113AEEA4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJTqaqppkyn9avZHqCnONVJ2Cwp9fmr7yQqUB8icRMFgCbYEHPAyogHqfYjgKPQBteKxnEKQHJzDmQ/132","comment_is_top":false,"comment_ctime":1543320770,"is_pvip":false,"replies":[{"id":"15850","content":"详细的分析步骤后面还会讲的，这里可以参考一下第一条回复","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543412009,"ip_address":"","comment_id":43899,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543320770","product_id":100020901,"comment_content":"问题:我的机器stress -i 5 -t 5m ,,观察cpu有100的使用率，iowait却都是0，这怎么排查？谢谢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430540,"discussion_content":"详细的分析步骤后面还会讲的，这里可以参考一下第一条回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543412009,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43872,"user_name":"硕","can_delete":false,"product_type":"c1","uid":1310756,"ip_address":"","ucode":"661AE1FC22C943","user_header":"https://static001.geekbang.org/account/avatar/00/14/00/24/6ff7cb37.jpg","comment_is_top":false,"comment_ctime":1543315596,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543315596","product_id":100020901,"comment_content":"day2 ： <br>系统cpu 相信信息在 &#47;proc&#47;cpuinfo<br>processor - 逻辑cpu的 Id <br>physical id - 物理cpu的id<br>core id。每个核的id <br>cpu 平均负载 要具体问题具体分析：<br>IO 使用率 <br>CPU 使用率 <br>线程等待 wait 综合排查 ","like_count":0},{"had_liked":false,"id":43854,"user_name":"多襄丸","can_delete":false,"product_type":"c1","uid":1074310,"ip_address":"","ucode":"1AA1497C5A293C","user_header":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","comment_is_top":false,"comment_ctime":1543311091,"is_pvip":false,"replies":[{"id":"15852","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543412105,"ip_address":"","comment_id":43854,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543311091","product_id":100020901,"comment_content":"不论存理论角度 还是 实践角度 讲的都很好~！  学以致用, 老师用实践来讲解，讲的非常棒~！  自己是对linux没什么深刻概念的人，只知道几个皮毛的命令而已。希望自己能跟着 倪鹏飞老师，一路前进！  真的受益匪浅！","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430524,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543412105,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43724,"user_name":"王金龙","can_delete":false,"product_type":"c1","uid":1106058,"ip_address":"","ucode":"E1BD8BC7CB426B","user_header":"https://static001.geekbang.org/account/avatar/00/10/e0/8a/38118387.jpg","comment_is_top":false,"comment_ctime":1543284465,"is_pvip":true,"replies":[{"id":"15856","content":"请用Linux","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543412379,"ip_address":"","comment_id":43724,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543284465","product_id":100020901,"comment_content":"mac下的sysstat这软件找不到？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430473,"discussion_content":"请用Linux","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543412379,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43704,"user_name":"ThinkingQuest","can_delete":false,"product_type":"c1","uid":1118560,"ip_address":"","ucode":"597D0C00DAEFE4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/0SDRac7XoordnKYgDLhz5wxAOtE6xqcsSywsywEtKQAR7xicBZQ6ceYftfZjl4Ivq3a5dzvRhYkn2GcUWiaQK7ZQ/132","comment_is_top":false,"comment_ctime":1543282221,"is_pvip":false,"replies":[{"id":"15858","content":"是的，单线程ID不同，并且线程才是Linux调度的基本单位。这里没有细分进程和线程的区别。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543412541,"ip_address":"","comment_id":43704,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543282221","product_id":100020901,"comment_content":"老师对那位tomcat进行最多load 1的回答，为什么只提到可以通过系统调用，不提单进程内多线程呢。<br>linux的线程不也是通过进程实现的吗，统一的pid号好像是？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430465,"discussion_content":"是的，单线程ID不同，并且线程才是Linux调度的基本单位。这里没有细分进程和线程的区别。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543412541,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43698,"user_name":"米雄雄","can_delete":false,"product_type":"c1","uid":1197009,"ip_address":"","ucode":"FBDF8D3D4BF8FA","user_header":"https://static001.geekbang.org/account/avatar/00/12/43/d1/3dd582a8.jpg","comment_is_top":false,"comment_ctime":1543281948,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543281948","product_id":100020901,"comment_content":"老师，不停地执行rsyc操作，它属于不可中断麽？此时cpu是被闲置的？","like_count":0},{"had_liked":false,"id":43640,"user_name":"seerjk","can_delete":false,"product_type":"c1","uid":1020166,"ip_address":"","ucode":"31E167180A7512","user_header":"https://static001.geekbang.org/account/avatar/00/0f/91/06/f76ea8ff.jpg","comment_is_top":false,"comment_ctime":1543255202,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543255202","product_id":100020901,"comment_content":"老师您好。实验过程中发现一个问题。<br>在Centos7下使用sysstat v12.1.1 编译安装，在做`stress -c 8 --timeout 600`时，%wait显示正常<br>在Debian8下使用sysstat v12.1.1 编译安装，在做`stress -c 8 --timeout 600`时，%wait显示为0.<br><br>不知道是否是因为系统的计算方式不同？<br><br>Centos7是2个CPU核心，KVM虚拟化<br>Debian8是1个CPU核心，KVM虚拟化","like_count":0},{"had_liked":false,"id":43601,"user_name":"pettit renard","can_delete":false,"product_type":"c1","uid":1318994,"ip_address":"","ucode":"A1B4949E1F5B65","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/aUyTibOyoR58ZONiaHngaUjiaDxJRqIibSyXIZTg42o9HYiahUdBibAD7BqX5yYeq0Pr5S81C0czSkBpVsKVLXhpeEng/132","comment_is_top":false,"comment_ctime":1543243853,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543243853","product_id":100020901,"comment_content":"首先还是直接top命令，因为top命令能直接看到平均负载跟CPU使用率，然后负载高但使用率低，基本可以判断是io的问题，这时候可以上iotop、iostat、pidstat来查找有问题的进程或者有问题的盘，如果CPU使用率也很高，可以直接在top里按P找到搞使用率的进程，然后再对这个进程分析","like_count":0},{"had_liked":false,"id":43586,"user_name":"dexter","can_delete":false,"product_type":"c1","uid":1315252,"ip_address":"","ucode":"DD51207438FBD6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEL5xnfuicbtRz4F87AAjZX6oCEjMtYiaIu4iaQichQmy0vEBA6Sumic1RDvUCeuBEqj6iatnt2kENbKYmuw/132","comment_is_top":false,"comment_ctime":1543242686,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543242686","product_id":100020901,"comment_content":"为什么我虚拟机执行stress那个超时600命令没有效果，ps命令查看进程却没有这个进程","like_count":0},{"had_liked":false,"id":43546,"user_name":"xfan","can_delete":false,"product_type":"c1","uid":1315147,"ip_address":"","ucode":"48ED8D498D7F56","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/4b/fa64f061.jpg","comment_is_top":false,"comment_ctime":1543239070,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543239070","product_id":100020901,"comment_content":"centOs 安装压测 yum install -y epel-release<br>yum install -y stress","like_count":0},{"had_liked":false,"id":43517,"user_name":"湖海散人","can_delete":false,"product_type":"c1","uid":1096781,"ip_address":"","ucode":"74C0C825D74CC1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJe0esddRVdG689MicU5zMibMtkyLpYkX4MtiamKP8eFf7KUoMlfU7ficrciakyVS06jHVdskYT67JKtdg/132","comment_is_top":false,"comment_ctime":1543235271,"is_pvip":false,"replies":[{"id":"15537","content":"iowait是CPU的指标，uninterruptable才是进程的状态","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543239619,"ip_address":"","comment_id":43517,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543235271","product_id":100020901,"comment_content":"当进程处于iowait的时候，就是说这个进程处于不可中断状态吗？  前面提到了，CPU负载是running 状态进程和uninterruptable 状态进程","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430413,"discussion_content":"iowait是CPU的指标，uninterruptable才是进程的状态","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543239619,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43515,"user_name":"yang","can_delete":false,"product_type":"c1","uid":1141387,"ip_address":"","ucode":"42FC9AC363D1FC","user_header":"","comment_is_top":false,"comment_ctime":1543235083,"is_pvip":false,"replies":[{"id":"15539","content":"不是绝对这样子，还要看具体情景","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543239704,"ip_address":"","comment_id":43515,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543235083","product_id":100020901,"comment_content":"iowait高，系统负载高，实际CPU使用率并不高","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430411,"discussion_content":"不是绝对这样子，还要看具体情景","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543239704,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43457,"user_name":"娟哥","can_delete":false,"product_type":"c1","uid":1142021,"ip_address":"","ucode":"A83896BAA7B174","user_header":"https://static001.geekbang.org/account/avatar/00/11/6d/05/6b953aea.jpg","comment_is_top":false,"comment_ctime":1543228882,"is_pvip":false,"replies":[{"id":"15543","content":"这是正常的，案例三里面展示的才是%wait","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543240031,"ip_address":"","comment_id":43457,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543228882","product_id":100020901,"comment_content":"第2个场景当中按老师后续补充描述的方法使用stress-ng -i 1 --hdd 1 --timeout 600 后 pidstat -u 5 1 输出的%wait列 始终为0 请老师指正","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430388,"discussion_content":"这是正常的，案例三里面展示的才是%wait","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543240031,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43376,"user_name":"不是钢炮就是娘炮","can_delete":false,"product_type":"c1","uid":1315872,"ip_address":"","ucode":"A06C75FBFFFBD0","user_header":"https://static001.geekbang.org/account/avatar/00/14/14/20/a1087825.jpg","comment_is_top":false,"comment_ctime":1543221005,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543221005","product_id":100020901,"comment_content":"进行实验二 stress -i 1 --timeout 600模拟sync ，平均负载确实上升了，但是在mpstst -P ALL 5 1查看是sys那一列接近100% 而不是iowait ","like_count":0},{"had_liked":false,"id":43362,"user_name":"学习者","can_delete":false,"product_type":"c1","uid":1017684,"ip_address":"","ucode":"3BF2B29656C1CF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/54/727379d8.jpg","comment_is_top":false,"comment_ctime":1543219387,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543219387","product_id":100020901,"comment_content":"第三篇打卡","like_count":0},{"had_liked":false,"id":43317,"user_name":"GEEKBANG_8572261","can_delete":false,"product_type":"c1","uid":1267851,"ip_address":"","ucode":"DED5339172B120","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIhSR9PO18lw7Aib3RJkchjuBBgj4coFrc1VhtQZXzZk94kQnM1h39DjXfb8pPTepKbqq79hNXScuw/132","comment_is_top":false,"comment_ctime":1543212175,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543212175","product_id":100020901,"comment_content":"平均负载过高的原因只有两个：<br>(1)处于IO wait的线程数过多<br>(2)线程或进程数过多<br><br>Cpu密集型任务不会导致平均负载过高，根本原因是对于这种cpu密集型任务配置了过多的线程或进程。<br><br>这是我的理解，是否正确呢？","like_count":0},{"had_liked":false,"id":43312,"user_name":"dexter","can_delete":false,"product_type":"c1","uid":1315252,"ip_address":"","ucode":"DD51207438FBD6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEL5xnfuicbtRz4F87AAjZX6oCEjMtYiaIu4iaQichQmy0vEBA6Sumic1RDvUCeuBEqj6iatnt2kENbKYmuw/132","comment_is_top":false,"comment_ctime":1543211461,"is_pvip":false,"replies":[{"id":"15554","content":"正常的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543240832,"ip_address":"","comment_id":43312,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543211461","product_id":100020901,"comment_content":"我现在上线服务器是24逻辑核心，平均负载在4左右，是不是在这个指标范围算正常？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430356,"discussion_content":"正常的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543240832,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43273,"user_name":"樊海涛","can_delete":false,"product_type":"c1","uid":1323249,"ip_address":"","ucode":"0B04D5985EE0E1","user_header":"https://static001.geekbang.org/account/avatar/00/14/30/f1/bf7fd8d2.jpg","comment_is_top":false,"comment_ctime":1543202681,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543202681","product_id":100020901,"comment_content":"执行这条命令没有 %wait这个值啊？不知道怎么肥事？<br><br>[root@node ~]# pidstat -u 5 1<br>Linux 3.10.0-693.2.2.el7.x86_64 (node)  11&#47;26&#47;2018      _x86_64_        (8 CPU)<br><br>11:19:49 AM   UID       PID    %usr %system  %guest    %CPU   CPU  Command<br>11:19:54 AM     0      1280    0.20    0.00    0.00    0.20     2  aliyun-service<br>11:19:54 AM    27      4532    0.20    0.00    0.00    0.20     6  mysqld<br>11:19:54 AM   996      8176    0.00    0.20    0.00    0.20     2  zabbix_agentd<br>11:19:54 AM   996      8446    0.20    0.00    0.00    0.20     4  zabbix_server<br>11:19:54 AM     0     11194    0.00    0.20    0.00    0.20     6  docker-containe<br>11:19:54 AM     0     19590  100.00    0.00    0.00  100.00     7  stress<br>11:19:54 AM     0     21273    0.20    0.20    0.00    0.40     2  pidstat<br>11:19:54 AM     0     21280    2.59    0.80    0.00    3.39     3  kubelet<br>11:19:54 AM     0     23786    0.20    0.40    0.00    0.60     2  AliYunDun<br>","like_count":0},{"had_liked":false,"id":43198,"user_name":"Lucky Box","can_delete":false,"product_type":"c1","uid":1197826,"ip_address":"","ucode":"ECBFEEF8614BA3","user_header":"https://static001.geekbang.org/account/avatar/00/12/47/02/84e7237f.jpg","comment_is_top":false,"comment_ctime":1543195616,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543195616","product_id":100020901,"comment_content":"对啊，现在巨人的肩膀上，自己才能看的更远！","like_count":0},{"had_liked":false,"id":43100,"user_name":"樊海涛","can_delete":false,"product_type":"c1","uid":1323249,"ip_address":"","ucode":"0B04D5985EE0E1","user_header":"https://static001.geekbang.org/account/avatar/00/14/30/f1/bf7fd8d2.jpg","comment_is_top":false,"comment_ctime":1543162311,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543162311","product_id":100020901,"comment_content":"day3打卡","like_count":0},{"had_liked":false,"id":43082,"user_name":"tristan","can_delete":false,"product_type":"c1","uid":1317022,"ip_address":"","ucode":"4700479F896D44","user_header":"https://static001.geekbang.org/account/avatar/00/14/18/9e/b04d5e6c.jpg","comment_is_top":false,"comment_ctime":1543158403,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543158403","product_id":100020901,"comment_content":"对于需要本地文件存储的系统，大部分性能问题都在I&#47;O上，之前遇到过因为刷盘问题导致负载过高的情况。分析不出来，学习了。","like_count":0},{"had_liked":false,"id":43073,"user_name":"chengnl","can_delete":false,"product_type":"c1","uid":1221516,"ip_address":"","ucode":"1D79769405C2EC","user_header":"https://static001.geekbang.org/account/avatar/00/12/a3/8c/26b954f2.jpg","comment_is_top":false,"comment_ctime":1543155464,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543155464","product_id":100020901,"comment_content":"讲得很通俗易懂，还有案例，有收获，赞！","like_count":0},{"had_liked":false,"id":43053,"user_name":"好好学习","can_delete":false,"product_type":"c1","uid":1258789,"ip_address":"","ucode":"63A002997462E3","user_header":"https://static001.geekbang.org/account/avatar/00/13/35/25/bab760a1.jpg","comment_is_top":false,"comment_ctime":1543150976,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543150976","product_id":100020901,"comment_content":"https:&#47;&#47;github.com&#47;torvalds&#47;linux&#47;blob&#47;master&#47;kernel&#47;sched&#47;loadavg.c 源码","like_count":0},{"had_liked":false,"id":43046,"user_name":"每天晒白牙","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1543149232,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1543149232","product_id":100020901,"comment_content":"stress-ng -i 1 --hdd 1 --timeout 600 起作用了  stress-ng可以直接yum安装（yum install stress-ng）<br>iowait升高了<br><br>20时17分43秒  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>20时17分48秒  all    0.33    0.00   17.36   69.45    0.00    2.86    0.00    0.00    0.00   10.00<br>20时17分48秒    0    0.22    0.00   19.00   65.50    0.00    2.18    0.00    0.00    0.00   13.10<br>20时17分48秒    1    0.22    0.00   15.71   73.23    0.00    3.76    0.00    0.00    0.00    7.08<br>","like_count":0},{"had_liked":false,"id":43013,"user_name":"小鱼儿","can_delete":false,"product_type":"c1","uid":1125362,"ip_address":"","ucode":"64019E99E30CF5","user_header":"https://static001.geekbang.org/account/avatar/00/11/2b/f2/ac0ea09e.jpg","comment_is_top":false,"comment_ctime":1543137328,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543137328","product_id":100020901,"comment_content":"%usr 和 %system 分别代表什么意思，哪个代表cpu 使用率？","like_count":0},{"had_liked":false,"id":43009,"user_name":"Brown羊羊","can_delete":false,"product_type":"c1","uid":1315332,"ip_address":"","ucode":"354EC478E57DEE","user_header":"https://static001.geekbang.org/account/avatar/00/14/12/04/5837b21c.jpg","comment_is_top":false,"comment_ctime":1543136057,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543136057","product_id":100020901,"comment_content":"我用的是centos7虚拟机，pidstat -u 5 1看不到iowait参数，是系统差异吗","like_count":0},{"had_liked":false,"id":43002,"user_name":"怀朔","can_delete":false,"product_type":"c1","uid":1006865,"ip_address":"","ucode":"52FAC1C2FD37B6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5d/11/e1f36640.jpg","comment_is_top":false,"comment_ctime":1543133473,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543133473","product_id":100020901,"comment_content":"这里的CPU 指 逻辑CPU个数 还是物理cpu个数","like_count":0},{"had_liked":false,"id":42989,"user_name":"他在她城断了弦","can_delete":false,"product_type":"c1","uid":1242521,"ip_address":"","ucode":"3D91CA87B64C8B","user_header":"https://static001.geekbang.org/account/avatar/00/12/f5/99/454b17c1.jpg","comment_is_top":false,"comment_ctime":1543130271,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543130271","product_id":100020901,"comment_content":"最后一个例子中8个进程抢占两个CPU的话，应该是按时间片轮询占CPU吧，所以等待时间都是75%.不知道我的理解对不？","like_count":0},{"had_liked":false,"id":42981,"user_name":"mail","can_delete":false,"product_type":"c1","uid":1315334,"ip_address":"","ucode":"7440848AE8789A","user_header":"https://static001.geekbang.org/account/avatar/00/14/12/06/d719f428.jpg","comment_is_top":false,"comment_ctime":1543127538,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543127538","product_id":100020901,"comment_content":"有时tomcat会导致cpu飚高，查看都是java进程 ，怎么能查看是具体那个线程导致cpu高的原因的 老师","like_count":0},{"had_liked":false,"id":42978,"user_name":"墨萧","can_delete":false,"product_type":"c1","uid":1032229,"ip_address":"","ucode":"07FFC5D1B5C1FA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c0/25/348b4d76.jpg","comment_is_top":false,"comment_ctime":1543125256,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543125256","product_id":100020901,"comment_content":"Ubuntu16下场景二，iowait高，但是cpu占用没上来。<br>Average:     CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>Average:     all    4.19    0.00    1.72   22.70    0.00    0.05    0.00    0.00    0.00   71.34<br>Average:       0    4.25    0.00    1.42    6.07    0.00    0.00    0.00    0.00    0.00   88.26<br>Average:       1    4.23    0.00    1.41    2.82    0.00    0.00    0.00    0.00    0.00   91.53<br>Average:       2    5.08    0.00    2.03   80.49    0.00    0.20    0.00    0.00    0.00   12.20<br>Average:       3    3.41    0.00    2.00    1.60    0.00    0.00    0.00    0.00    0.00   92.99<br><br>","like_count":0},{"had_liked":false,"id":42903,"user_name":"风飘，吾独思","can_delete":false,"product_type":"c1","uid":1131032,"ip_address":"","ucode":"4DF0E7DC22EE53","user_header":"https://static001.geekbang.org/account/avatar/00/11/42/18/edc1b373.jpg","comment_is_top":false,"comment_ctime":1543079222,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543079222","product_id":100020901,"comment_content":"讲解的很清晰，白天也手动测一遍","like_count":0},{"had_liked":false,"id":42893,"user_name":"衣申人","can_delete":false,"product_type":"c1","uid":1115777,"ip_address":"","ucode":"887FE9109B97DE","user_header":"https://static001.geekbang.org/account/avatar/00/11/06/81/28418795.jpg","comment_is_top":false,"comment_ctime":1543073961,"is_pvip":false,"replies":[{"id":"15366","content":"见置顶的统一回复。系统CPU使用的问题会在第5篇详细讲","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543148225,"ip_address":"","comment_id":42893,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543073961","product_id":100020901,"comment_content":"老师你好，例子中的场景二，为什么io高的时候，%sys也高？%sys一般在什么情况下会占用cpu？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430232,"discussion_content":"见置顶的统一回复。系统CPU使用的问题会在第5篇详细讲","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543148225,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42892,"user_name":"衣申人","can_delete":false,"product_type":"c1","uid":1115777,"ip_address":"","ucode":"887FE9109B97DE","user_header":"https://static001.geekbang.org/account/avatar/00/11/06/81/28418795.jpg","comment_is_top":false,"comment_ctime":1543073795,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543073795","product_id":100020901,"comment_content":"老师你好，有个疑问: load是指进程数还是线程数？如果一个cpu密集型的进程，多线程跑满所有cpu，使每个cpu使用百分比都是100%,  那么load还只是1？","like_count":0},{"had_liked":false,"id":42886,"user_name":"渡渡鸟_linux","can_delete":false,"product_type":"c1","uid":1227772,"ip_address":"","ucode":"099BB11A3201D3","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ernR4NKI5tejJAV3HMTF3gszBBUAjkjLO2QYic2gx5dMGelFv4LWibib7CUGexmMcMp5HiaaibmOH3dyHg/132","comment_is_top":false,"comment_ctime":1543072002,"is_pvip":false,"replies":[{"id":"15367","content":"第一个问题应该是性能工具间隔时间不同导致的，可以都改成间隔1秒试试<br>第二个问题见置顶回复，系统CPU的使用还会在第5篇详细讲","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543148409,"ip_address":"","comment_id":42886,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543072002","product_id":100020901,"comment_content":"有两个问题困惑我：<br>1. 在IO密集型场景实验中，我使用一个进程实验时发现：<br>    mpstat -P ALL 3 显示两个CPU的%sys在25%左右,%idle在70%多，%iowait为0。<br>    但是pidstat -u 1显示stress的CPU %system使用率为71%左右。这多出来的25%是从哪里来的？<br>2. 在IO密集型场景实验中，我使用多进程实验时(stress -i 100 --timeout 300)%iowait 依然为0，不确定是不是磁盘读写速度太快了导致的，我电脑是nvme固态<br><br>希望老师帮忙解答下<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430230,"discussion_content":"第一个问题应该是性能工具间隔时间不同导致的，可以都改成间隔1秒试试\n第二个问题见置顶回复，系统CPU的使用还会在第5篇详细讲","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543148409,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42879,"user_name":"江南","can_delete":false,"product_type":"c1","uid":1017794,"ip_address":"","ucode":"A30607801A7107","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/c2/c3dbcd9a.jpg","comment_is_top":false,"comment_ctime":1543070611,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543070611","product_id":100020901,"comment_content":"请教老师一个问题，初始化的新操作系统本身应该会有一些处于活跃状态的进程吧？这些进程正常运行不会记入平均负载的统计吗？","like_count":0},{"had_liked":false,"id":42869,"user_name":"🌾","can_delete":false,"product_type":"c1","uid":1316943,"ip_address":"","ucode":"E76E340F2B25A7","user_header":"https://static001.geekbang.org/account/avatar/00/14/18/4f/d38b6a4e.jpg","comment_is_top":false,"comment_ctime":1543066882,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543066882","product_id":100020901,"comment_content":"平均负载.生产环境中.线程数的三倍是临界值吧.有同意我的观点的吗？？？","like_count":0},{"had_liked":false,"id":42860,"user_name":"Majorin_Che","can_delete":false,"product_type":"c1","uid":1131906,"ip_address":"","ucode":"22D3B0A20D4D1F","user_header":"https://static001.geekbang.org/account/avatar/00/11/45/82/164b9073.jpg","comment_is_top":false,"comment_ctime":1543063540,"is_pvip":false,"replies":[{"id":"15368","content":"见置顶回复","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543148451,"ip_address":"","comment_id":42860,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543063540","product_id":100020901,"comment_content":"是不是centos7还是有点区别，我测试的iowait不是不升高，而是一直不变，-i 都设成20了","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430219,"discussion_content":"见置顶回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543148451,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42847,"user_name":"刘大双","can_delete":false,"product_type":"c1","uid":1316341,"ip_address":"","ucode":"A63E76845C9C4B","user_header":"https://static001.geekbang.org/account/avatar/00/14/15/f5/5232452a.jpg","comment_is_top":false,"comment_ctime":1543056874,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543056874","product_id":100020901,"comment_content":"负载很小是不是说明系统压力很小","like_count":0},{"had_liked":false,"id":42831,"user_name":"大胃高怕飞","can_delete":false,"product_type":"c1","uid":1047735,"ip_address":"","ucode":"EEC5151E1A8062","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fc/b7/6cef8bf0.jpg","comment_is_top":false,"comment_ctime":1543053241,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543053241","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":42808,"user_name":"一直走下去","can_delete":false,"product_type":"c1","uid":1156524,"ip_address":"","ucode":"3982BD68605142","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/hBG9icueGvjQb10yBOPcrcibzPkeLX7Ax4o1ubOKQib5ZeawUibozJeg9RGNNXibLoRFSgSvy1esnJlf3NAUC2hm0Hg/132","comment_is_top":false,"comment_ctime":1543049920,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543049920","product_id":100020901,"comment_content":"学习了，打卡","like_count":0},{"had_liked":false,"id":42777,"user_name":"boaker","can_delete":false,"product_type":"c1","uid":1310765,"ip_address":"","ucode":"2FA26830FC99AE","user_header":"https://static001.geekbang.org/account/avatar/00/14/00/2d/5de6e793.jpg","comment_is_top":false,"comment_ctime":1543042624,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543042624","product_id":100020901,"comment_content":"1.平均负载:进程处于可运行状态或者不可中断状态下系统当前的平均进程数，可理解为平均活跃进程数。<br>2.影响系统负载有两个:cpu的使用率和I&#47;O操作<br>3.使用stress可以模拟异常平均负载升高的问题，使用mpstat可以分析多核CPU的使用情况，使用pidstat可以分析进程运行时资源使用情况。<br>4.用Centos7 3.10的内核，sysstat 版本12.0.2没有模拟出场景二和三，Ubuntu16 内核4.4也没有模拟出，Ubuntu18 内核4.15模拟出了。<br>","like_count":0},{"had_liked":false,"id":42774,"user_name":"祥伟","can_delete":false,"product_type":"c1","uid":1314639,"ip_address":"","ucode":"BB7D89109FC8BD","user_header":"https://static001.geekbang.org/account/avatar/00/14/0f/4f/5040f415.jpg","comment_is_top":false,"comment_ctime":1543041731,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543041731","product_id":100020901,"comment_content":"学习了，再结合留言去，干货满满啊","like_count":0},{"had_liked":false,"id":42756,"user_name":"樊海涛","can_delete":false,"product_type":"c1","uid":1323249,"ip_address":"","ucode":"0B04D5985EE0E1","user_header":"https://static001.geekbang.org/account/avatar/00/14/30/f1/bf7fd8d2.jpg","comment_is_top":false,"comment_ctime":1543035912,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543035912","product_id":100020901,"comment_content":"之前一直认为平均负载是cpu和内存总占用的一种表现","like_count":0},{"had_liked":false,"id":42744,"user_name":"李炀","can_delete":false,"product_type":"c1","uid":1030246,"ip_address":"","ucode":"28F464EA58BCC5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b8/66/5fd18e55.jpg","comment_is_top":false,"comment_ctime":1543031460,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543031460","product_id":100020901,"comment_content":"老师你好，我在虚拟机中执行 IO 压力测试，mpstat 的 %iowait 列的值始终是0，看了您的统一回复之后，把压测命令改为 stress --io 9 也还是0！详见截图：<br>① https:&#47;&#47;ws4.sinaimg.cn&#47;large&#47;006tNbRwly1fxizaj43t0j31000moh1v.jpg<br>② https:&#47;&#47;ws4.sinaimg.cn&#47;large&#47;006tNbRwly1fxiz948xiej31000motr3.jpg<br><br>请问这是虚拟机环境导致的吗？我的软硬件环境如下：<br>- Host OS: macOS Sierra 10.12.6 (Intel Core i5 with 4 CPU cores, 8GB RAM, SSD)<br>- Hypervisor: VMware Fusion 11.0.2 Pro<br>- Guest OS: Ubuntu Server 18.04.1 (2 CPU cores, 2GB RAM)","like_count":0},{"had_liked":false,"id":42726,"user_name":"walker","can_delete":false,"product_type":"c1","uid":1324219,"ip_address":"","ucode":"FA5B2400A53730","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/bb/0b971fca.jpg","comment_is_top":false,"comment_ctime":1543028944,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543028944","product_id":100020901,"comment_content":"平均负载体现的是运行态和不可终断态的进程数。运行态的进程争抢的是CPU，不可中断态的是硬盘。当负载较高时，就可能是CPU资源不够，或者硬盘读写压力。也有可能网络原因造成CPU和硬盘等待数据处理时间长，导致资源占用时间长。","like_count":0},{"had_liked":false,"id":42711,"user_name":"风云","can_delete":false,"product_type":"c1","uid":1172261,"ip_address":"","ucode":"8AFED5A7CC5670","user_header":"https://static001.geekbang.org/account/avatar/00/11/e3/25/eb9496c4.jpg","comment_is_top":false,"comment_ctime":1543025812,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543025812","product_id":100020901,"comment_content":"不错非常好","like_count":0},{"had_liked":false,"id":42690,"user_name":"舒超","can_delete":false,"product_type":"c1","uid":1055955,"ip_address":"","ucode":"42B94749BB28CE","user_header":"https://static001.geekbang.org/account/avatar/00/10/1c/d3/573575f5.jpg","comment_is_top":false,"comment_ctime":1543021229,"is_pvip":true,"replies":[{"id":"15321","content":"选项换成 -i 试试","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543058594,"ip_address":"","comment_id":42690,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543021229","product_id":100020901,"comment_content":"8逻辑核，stress -c 16 --timeout 600, mpstat -P ALL 5, 还是观察不到明显的iowait, load average已经到14，请问有可能是什么原因。CentOS 6.5","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430160,"discussion_content":"选项换成 -i 试试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543058594,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42670,"user_name":"品牌运营|陆晓明","can_delete":false,"product_type":"c1","uid":1096054,"ip_address":"","ucode":"8E04D0A90458C9","user_header":"https://static001.geekbang.org/account/avatar/00/10/b9/76/bc5f8468.jpg","comment_is_top":false,"comment_ctime":1543013659,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543013659","product_id":100020901,"comment_content":"起来学习，很有收获，期待老师后续精彩内容！","like_count":0},{"had_liked":false,"id":42661,"user_name":"Jetson","can_delete":false,"product_type":"c1","uid":1142317,"ip_address":"","ucode":"871418D66FDB96","user_header":"https://static001.geekbang.org/account/avatar/00/11/6e/2d/629ed447.jpg","comment_is_top":false,"comment_ctime":1542993475,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542993475","product_id":100020901,"comment_content":"ps aux 捕获进程的状态 用dd直写硬盘为什么不回出现d状态？","like_count":0},{"had_liked":false,"id":42658,"user_name":"江南","can_delete":false,"product_type":"c1","uid":1017794,"ip_address":"","ucode":"A30607801A7107","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/c2/c3dbcd9a.jpg","comment_is_top":false,"comment_ctime":1542993120,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542993120","product_id":100020901,"comment_content":"讲的很棒啊，谢谢","like_count":0},{"had_liked":false,"id":42647,"user_name":"youli","can_delete":false,"product_type":"c1","uid":1073863,"ip_address":"","ucode":"1B4A4E708EF022","user_header":"https://static001.geekbang.org/account/avatar/00/10/62/c7/be637ec8.jpg","comment_is_top":false,"comment_ctime":1542988840,"is_pvip":false,"replies":[{"id":"15323","content":"正解👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543058720,"ip_address":"","comment_id":42647,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542988840","product_id":100020901,"comment_content":"老师 我可以这么理解吗  cpu这3个负载很大并不代表， cpu负载很高，而是活跃进程和非活跃进程，磁盘io等原因导致系统升高，需要通过工具排除","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430146,"discussion_content":"正解👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543058720,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42645,"user_name":"benet","can_delete":false,"product_type":"c1","uid":1315481,"ip_address":"","ucode":"4E209E597770D1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJbxgpjzibnOhul9n2XPLIRkGX76Z0hj8hXl7v7cNBzSribAwwFicbaKtYjNxJz5MttZz14JaTJ81szw/132","comment_is_top":false,"comment_ctime":1542988211,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542988211","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":42638,"user_name":"是我","can_delete":false,"product_type":"c1","uid":1297235,"ip_address":"","ucode":"0AC816A2FBD4F4","user_header":"https://static001.geekbang.org/account/avatar/00/13/cb/53/262a8ce2.jpg","comment_is_top":false,"comment_ctime":1542985825,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542985825","product_id":100020901,"comment_content":"D3明天气起床进行测试","like_count":0},{"had_liked":false,"id":42634,"user_name":"湖湘志","can_delete":false,"product_type":"c1","uid":1285578,"ip_address":"","ucode":"C8B069B3AD4FEA","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erJR5Kj0Xm6LykFHLaWqHjQiaroVxgdoGI7uHEGz2D3PfibWNkBYP23QLzFmcuicgKLbqUch0ZJ2ZNOA/132","comment_is_top":false,"comment_ctime":1542984841,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542984841","product_id":100020901,"comment_content":"D2","like_count":0},{"had_liked":false,"id":42629,"user_name":"Scarf","can_delete":false,"product_type":"c1","uid":1021792,"ip_address":"","ucode":"3EDD87BD6354D5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/97/60/873cd557.jpg","comment_is_top":false,"comment_ctime":1542982886,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542982886","product_id":100020901,"comment_content":"理论与实践相结合，能够跟着做的文章，很赞","like_count":0},{"had_liked":false,"id":42619,"user_name":"李志博","can_delete":false,"product_type":"c1","uid":1009109,"ip_address":"","ucode":"F3C72573B3C112","user_header":"https://static001.geekbang.org/account/avatar/00/0f/65/d5/88beb15a.jpg","comment_is_top":false,"comment_ctime":1542980425,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542980425","product_id":100020901,"comment_content":"老师是历史怀疑有抖动，还有办法确认这个问题吗<br>","like_count":0},{"had_liked":false,"id":42600,"user_name":"sujerry","can_delete":false,"product_type":"c1","uid":1314953,"ip_address":"","ucode":"17F26AE448A711","user_header":"https://static001.geekbang.org/account/avatar/00/14/10/89/6add76e9.jpg","comment_is_top":false,"comment_ctime":1542976542,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542976542","product_id":100020901,"comment_content":"“简单来说，平均负载是指单位时间内，系统处于可运行状态和不可中断状态的平均进程数，也就是平均活跃进程数，”<br><br>上面的单位时间是是多长时间？","like_count":0},{"had_liked":false,"id":42598,"user_name":"uptoknow","can_delete":false,"product_type":"c1","uid":1008864,"ip_address":"","ucode":"8A280951C95AEC","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELImyOUmrVjSSDWjZvE0E6fE3zibBXJ2HlLeMQd7OUN8rOyvxv9asw9iaE2KxJ9xpqbbqicPsxA2VEtw/132","comment_is_top":false,"comment_ctime":1542976474,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542976474","product_id":100020901,"comment_content":"第二个例子测试结果不太一样，<br>1. stress -i 1 --timeout 600<br>2. mpstat 显示是 system cpu 上去了，<br><br>mpstat -P ALL 5<br>Linux 3.10.0-862.14.4.el7.x86_64 (localhost) \t11&#47;11&#47;2018 \t_x86_64_\t(1 CPU)<br><br>10:47:22 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>10:47:27 PM  all    0.21    0.00   97.30    2.28    0.00    0.21    0.00    0.00    0.00    0.00<br>10:47:27 PM    0    0.21    0.00   97.30    2.28    0.00    0.21    0.00    0.00    0.00    0.0<br><br>pidstat:<br><br>10:48:47 PM   UID       PID    %usr %system  %guest    %CPU   CPU  Command<br>10:48:52 PM     0       579    0.00    0.21    0.00    0.21     0  kworker&#47;0:1H<br>10:48:52 PM     0     26761    0.00    0.21    0.00    0.21     0  kworker&#47;u2:1<br>10:48:52 PM  1000     29485    0.00    0.21    0.00    0.21     0  sshd<br>10:48:52 PM     0     29651    0.21    0.21    0.00    0.42     0  watch<br>10:48:52 PM  1000     29676    0.00   92.63    0.00   92.63     0  stress<br>10:48:52 PM  1000     29804    0.00    0.21    0.00    0.21     0  pidstat","like_count":0},{"had_liked":false,"id":42591,"user_name":"卡塔库里","can_delete":false,"product_type":"c1","uid":1083464,"ip_address":"","ucode":"9A85DB54BBC9B2","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqQ4Qib7yhHB882X9AmcUSbh2AAgOL3u2YAqibYfARRb1nxe5hw8ZBiaKR35bJiaic8UvThAzLhv5yzcsg/132","comment_is_top":false,"comment_ctime":1542975640,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542975640","product_id":100020901,"comment_content":"D3打卡","like_count":0},{"had_liked":false,"id":42587,"user_name":"王喜春","can_delete":false,"product_type":"c1","uid":1022349,"ip_address":"","ucode":"436E91FDED1B30","user_header":"https://static001.geekbang.org/account/avatar/00/0f/99/8d/4d5dbfc5.jpg","comment_is_top":false,"comment_ctime":1542974892,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542974892","product_id":100020901,"comment_content":"老师， 您好。 关于实验二里“平均负载的升高是由于 iowait 的升高”的一些问题， 想再往下了解下：<br>1. CPU里可运行状态进程数多， 是因为IoWait造成了进程等待么？ 这样， 也就是说， IoWait时进程还会是可运行状态么？ 这一点跟以前的理解不一致。 以前认为IoWait时， 当前进程也会置于Wait状态。 这一点请老师帮澄清解释下。 <br>2. &quot;CPU 使用率升高到了 23.87，而 iowait 高达 67.53%”， 这两个值同时高情况下， 推导出负载的升高是因为iowait造成的， 这个逻辑推理是不是有些牵强了？<br><br>希望老师帮回复下","like_count":0},{"had_liked":false,"id":42569,"user_name":"DAN","can_delete":false,"product_type":"c1","uid":1322215,"ip_address":"","ucode":"E08589F3048012","user_header":"https://static001.geekbang.org/account/avatar/00/14/2c/e7/92d3c765.jpg","comment_is_top":false,"comment_ctime":1542971888,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542971888","product_id":100020901,"comment_content":"打卡，走起","like_count":0},{"had_liked":false,"id":42568,"user_name":"玉剑冰锋","can_delete":false,"product_type":"c1","uid":1214202,"ip_address":"","ucode":"8EA56A71BA5B22","user_header":"https://static001.geekbang.org/account/avatar/00/12/86/fa/4bcd7365.jpg","comment_is_top":false,"comment_ctime":1542971787,"is_pvip":false,"replies":[{"id":"15196","content":"都会在后面的课程中讲的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542976666,"ip_address":"","comment_id":42568,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542971787","product_id":100020901,"comment_content":"老师可以讲讲进程、线程与cpu、内存之间的关系吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430132,"discussion_content":"都会在后面的课程中讲的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542976666,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42563,"user_name":"云开","can_delete":false,"product_type":"c1","uid":1297758,"ip_address":"","ucode":"74541653336DDA","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/nSvVtStiaQzslFM7YRnlhP7FxdVsz8abjlwY6XZ4guKtkXNUgG8EibxztoeosKL2YuxDsb159NTQhVXFBkj31kBw/132","comment_is_top":false,"comment_ctime":1542970938,"is_pvip":false,"replies":[{"id":"15200","content":"请使用Linux","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542976827,"ip_address":"","comment_id":42563,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542970938","product_id":100020901,"comment_content":"mac 上 sysstat 装不上 有没有装好的同学","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430130,"discussion_content":"请使用Linux","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542976827,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42557,"user_name":"木头鱼","can_delete":false,"product_type":"c1","uid":1103492,"ip_address":"","ucode":"ED3E917F58F01A","user_header":"https://static001.geekbang.org/account/avatar/00/10/d6/84/427984c9.jpg","comment_is_top":false,"comment_ctime":1542969739,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542969739","product_id":100020901,"comment_content":"D3 学习了","like_count":0},{"had_liked":false,"id":42555,"user_name":"海","can_delete":false,"product_type":"c1","uid":1146176,"ip_address":"","ucode":"0239D583C3ECCA","user_header":"https://static001.geekbang.org/account/avatar/00/11/7d/40/bdcf7fa0.jpg","comment_is_top":false,"comment_ctime":1542968723,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542968723","product_id":100020901,"comment_content":"D3","like_count":0},{"had_liked":false,"id":42554,"user_name":"whisper","can_delete":false,"product_type":"c1","uid":1316814,"ip_address":"","ucode":"5CBE5141455BA7","user_header":"https://static001.geekbang.org/account/avatar/00/14/17/ce/b348abdd.jpg","comment_is_top":false,"comment_ctime":1542968712,"is_pvip":false,"replies":[{"id":"15206","content":"试一下增大IO的线程数，比如 stress -i 3。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542977153,"ip_address":"","comment_id":42554,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542968712","product_id":100020901,"comment_content":"[root@10-46-143-76 ~]# mpstat -P ALL 5 1<br>Linux 3.10.0-693.11.6.el7.x86_64 (10-46-143-76) \t11&#47;23&#47;2018 \t_x86_64_\t(1 CPU)<br><br>06:19:29 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>06:19:34 PM  all    1.00    0.00   98.60    0.20    0.00    0.00    0.00    0.00    0.00    0.20<br>06:19:34 PM    0    1.00    0.00   98.60    0.20    0.00    0.00    0.00    0.00    0.00    0.20<br><br>Average:     CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>Average:     all    1.00    0.00   98.60    0.20    0.00    0.00    0.00    0.00    0.00    0.20<br>Average:       0    1.00    0.00   98.60    0.20    0.00    0.00    0.00    0.00    0.00    0.20<br><br><br>老师你好，我在centos下模拟IO等待比较高场景，发现mpstat -P ALL 5 1没有出现iowait很高的情况<br>核进程使用的 CPU 百分比却很高？求解","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430126,"discussion_content":"试一下增大IO的线程数，比如 stress -i 3。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542977153,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42537,"user_name":"mj4ever","can_delete":false,"product_type":"c1","uid":1005549,"ip_address":"","ucode":"73028E537099CC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/ed/d50de13c.jpg","comment_is_top":false,"comment_ctime":1542967179,"is_pvip":true,"replies":[{"id":"15208","content":"👍 总结的好","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542977208,"ip_address":"","comment_id":42537,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542967179","product_id":100020901,"comment_content":"1、概念<br>系统负载平均值是处于 `可运行`（runnable）或 `不可中断`（uninterruptable）状态的平均活跃进程数：<br>（1）可运行状态的进程要么使用CPU，要么等待使用CPU<br>（2）处于不间断状态的进程正在等待用于某些I&#47;O访问，例如等待磁盘<br>2、如何判断负载是否正常<br>（1）平均负载最理想的情况是等于 CPU 个数，需要知道CPU的数量<br>（2）根据 1分钟 | 5分钟 | 15分钟 来判断当前负载变化趋势，上升 or 下降<br>（3）进一步判断是CPU密集型进程导致，还是I&#47;O密集型导致<br>3、相关命令（学会用man工具查命令）<br>（1）stress：施加负荷和压力测试系统的工具：<br>      * 模拟CPU密集型：stress --cpu N --timeout N<br>      * 模拟I&#47;O密集型：stress --io N --timeout N<br>（2）mpstat：是一个常用的多核CPU性能分析工具，用来实时查看每个CPU的性能指标，以及所有CPU的平均指标<br>      * mpstat [ 选项 ] [ &lt;时间间隔&gt; [ &lt;次数&gt; ] ]  mpstat -P ALL 5<br>（3）pidstat:是一个常用的进程性能分析工具，用来实时查看进程的CPU、内存、I&#47;O以及上下文切换等性能指标<br>      * pidstat [ 选项 ] [ &lt;时间间隔&gt; [ &lt;次数&gt; ] ]  pidstat -u 5 1","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430121,"discussion_content":"👍 总结的好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542977208,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42521,"user_name":"大大大dvavid","can_delete":false,"product_type":"c1","uid":1323238,"ip_address":"","ucode":"1434DE4DB3DEF1","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJW3d3MZwQwaq0aKfQsL4TUaaVULibpNwA8e3OAoCCwGBco5mAbjybhhvv99UlNEkHJoPmFZN3z4kg/132","comment_is_top":false,"comment_ctime":1542964417,"is_pvip":false,"replies":[{"id":"15209","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542977224,"ip_address":"","comment_id":42521,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542964417","product_id":100020901,"comment_content":"day2:<br>系统慢时使用如下方法确认原因：<br>1：watch -d uptime确认负载水平<br>（1）平均负载超过CPU个数数倍则可能由于大量进程<br>（2）其余情况待定<br>2：确认负载过高原因<br>mpstat -P -ALL 5 1 --确认到底是由于IO、密集计算、大量进程导致。<br>3：确认哪个进程导致<br>pidstat -u 5 1","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430115,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542977224,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42516,"user_name":"刘大双","can_delete":false,"product_type":"c1","uid":1316341,"ip_address":"","ucode":"A63E76845C9C4B","user_header":"https://static001.geekbang.org/account/avatar/00/14/15/f5/5232452a.jpg","comment_is_top":false,"comment_ctime":1542963853,"is_pvip":false,"replies":[{"id":"15210","content":"拿平均负载跟CPU总数对比，是不是负载很小？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542977387,"ip_address":"","comment_id":42516,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542963853","product_id":100020901,"comment_content":"root@blockchain1:&#47;home&#47;mpsp# uptime <br> 16:55:41 up 16 days,  8:00,  5 users,  load average: 1.88, 1.69, 1.51<br>root@blockchain1:&#47;home&#47;mpsp# mpstat -P All 5 <br>Usage: mpstat [ options ] [ &lt;interval&gt; [ &lt;count&gt; ] ]<br>Options are:<br>[ -A ] [ -u ] [ -V ] [ -I { SUM | CPU | SCPU | ALL } ]<br>[ -P { &lt;cpu&gt; [,...] | ON | ALL } ]<br>root@blockchain1:&#47;home&#47;mpsp# mpstat -P ALL  5 <br>Linux 4.4.0-66-generic (blockchain1) \t11&#47;23&#47;2018 \t_x86_64_\t(32 CPU)<br><br>04:56:32 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>04:56:37 PM  all    3.73    0.00    0.95    7.69    0.00    0.06    0.00    0.00    0.00   87.58<br>04:56:37 PM    0    4.63    0.00    1.01    9.26    0.00    0.20    0.00    0.00    0.00   84.91<br>04:56:37 PM    1    4.23    0.00    1.61    4.43    0.00    0.00    0.00    0.00    0.00   89.74<br>04:56:37 PM    2    4.66    0.00    2.63    8.30    0.00    0.40    0.00    0.00    0.00   84.01<br>04:56:37 PM    3    4.24    0.00    1.41   14.34    0.00    0.00    0.00    0.00    0.00   80.00<br>04:56:37 PM    4    3.41    0.00    1.20    5.01    0.00    0.00    0.00    0.00    0.00   90.38<br>04:56:37 PM    5    3.61    0.00    1.41   16.67    0.00    0.00    0.00    0.00    0.00   78.31<br>04:56:37 PM    6    4.79    0.00    2.00    4.79    0.00    0.00    0.00    0.00    0.00   88.42<br>04:56:37 PM    7    3.99    0.00    1.80    8.38    0.00    0.00    0.00    0.00    0.00   85.83<br>04:56:37 PM    8   13.45    0.00    1.61   25.90    0.00    0.00    0.00    0.00    0.00   59.04<br>04:56:37 PM    9    9.64    0.00    1.20   31.73    0.00    0.00    0.00    0.00    0.00   57.43<br>04:56:37 PM   10    3.00    0.00    0.80    0.00    0.00    0.00    0.00    0.00    0.00   96.20<br>04:56:37 PM   11    4.81    0.00    0.60    0.00    0.00    0.00    0.00    0.00    0.00   94.59<br>04:56:37 PM   12    1.20    0.00    0.40    0.00    0.00    0.20    0.00    0.00    0.00   98.20<br><br>我把iowait 加起来超过了100，目前跑着一个数据库，一个应用，是不是说明瓶颈是io？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430114,"discussion_content":"拿平均负载跟CPU总数对比，是不是负载很小？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542977387,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42496,"user_name":"lai","can_delete":false,"product_type":"c1","uid":1320411,"ip_address":"","ucode":"3681C5B45D25B4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/EA0fyxxD257e9soKcSWqFKoHq5J3vxgyicliaPuqggcraAkd7GKl6GSaQDxaCuruZ7gP6an1AcTC23iaATeHsAQkw/132","comment_is_top":false,"comment_ctime":1542962104,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542962104","product_id":100020901,"comment_content":" stress -i 2 --timeout 600  机器IP依然不高<br>16:33:24     CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>16:33:29     all    4.96    0.00   86.84    5.57    0.00    0.00    0.00    0.00    0.00    2.63<br>16:33:29       0    9.33    0.00   82.56    5.48    0.00    0.00    0.00    0.00    0.00    2.64<br>16:33:29       1    0.60    0.00   90.93    5.85    0.00    0.00    0.00    0.00    0.00    2.62","like_count":0},{"had_liked":false,"id":42486,"user_name":"叨科","can_delete":false,"product_type":"c1","uid":1318322,"ip_address":"","ucode":"59FF212F7B2040","user_header":"","comment_is_top":false,"comment_ctime":1542961089,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542961089","product_id":100020901,"comment_content":"我用的CentOS7 老师的第二个实验没有做出来， iowait 负载没有变成<br>终端1<br>[root@db01 ~]# stress --io 1 --timeout 600<br>stress: info: [17405] dispatching hogs: 0 cpu, 1 io, 0 vm, 0 hdd<br><br>终端2<br>Every 2.0s: uptime                                                                          Fri Nov 23 16:08:39 2018<br><br> 16:08:39 up 1 day,  5:51,  4 users,  load average: 1.16, 1.88, 1.64<br>终端3<br>[root@db01 ~]# mpstat -P ALL 5 1<br>Linux 3.10.0-693.el7.x86_64 (db01)      11&#47;23&#47;2018      _x86_64_        (1 CPU)<br><br>04:09:45 PM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>04:09:50 PM  all  100.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00<br>04:09:50 PM    0  100.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00<br><br>Average:     CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle<br>Average:     all  100.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00<br>Average:       0  100.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00<br>终端4<br>[root@db01 ~]# pidstat -u 5 1<br>Linux 3.10.0-693.el7.x86_64 (db01)      11&#47;23&#47;2018      _x86_64_        (1 CPU)<br><br>04:13:21 PM   UID       PID    %usr %system  %guest    %CPU   CPU  Command<br>04:13:26 PM     0        37    0.00    0.60    0.00    0.60     0  kworker&#47;u256:1<br>04:13:26 PM     0      3272    0.00    0.60    0.00    0.60     0  kworker&#47;u256:2<br>04:13:26 PM     0     17563    0.00   98.20    0.00   98.20     0  stress<br><br>","like_count":0},{"had_liked":false,"id":42462,"user_name":"卫江","can_delete":false,"product_type":"c1","uid":1101226,"ip_address":"","ucode":"DE2F7A6916F1A9","user_header":"https://static001.geekbang.org/account/avatar/00/10/cd/aa/33d48789.jpg","comment_is_top":false,"comment_ctime":1542957831,"is_pvip":false,"replies":[{"id":"15211","content":"这里没有细分进程和线程，它们会在稍后介绍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542978992,"ip_address":"","comment_id":42462,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542957831","product_id":100020901,"comment_content":"上面一直提到的都是进程，但是我们知道线程才是执行的基本单元，所以感觉平均负载应该是线程的活跃数吧，否则，如果活跃的线程都是一个进程的，如果显示1，感觉反应不了实际问题，不知道理解的对不对？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430103,"discussion_content":"这里没有细分进程和线程，它们会在稍后介绍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542978992,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42461,"user_name":"Egrep","can_delete":false,"product_type":"c1","uid":1054767,"ip_address":"","ucode":"0791CB7581309A","user_header":"https://static001.geekbang.org/account/avatar/00/10/18/2f/2d5acd04.jpg","comment_is_top":false,"comment_ctime":1542957822,"is_pvip":false,"replies":[{"id":"15212","content":"别急，下周开始就会讲这个分析方法。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542979043,"ip_address":"","comment_id":42461,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542957822","product_id":100020901,"comment_content":"根据老师方法测试 cpu密集进程导致负载高情况是正常.<br>我是通过centos7 系统进行测试的 发现sysstat的包版本和乌班图版本不同导致IO密集型测试有问题.<br>pidstat 没有iowait  选项. 也提升了对平均负载正确理解. <br>找到指定的进程cpu使用率高,如何进行进程分析 程序问题哪里导致的负载高,这个是怎么样解决.<br>通过strece命令进行追踪 如何分析呢?","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430102,"discussion_content":"别急，下周开始就会讲这个分析方法。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542979043,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42454,"user_name":"白梦","can_delete":false,"product_type":"c1","uid":1164500,"ip_address":"","ucode":"4D5A8CB4D643C0","user_header":"https://static001.geekbang.org/account/avatar/00/11/c4/d4/2d338d73.jpg","comment_is_top":false,"comment_ctime":1542956785,"is_pvip":false,"replies":[{"id":"15214","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542979099,"ip_address":"","comment_id":42454,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542956785","product_id":100020901,"comment_content":"打卡，浅显易懂，期待后面的教程讲解","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430100,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542979099,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42449,"user_name":"krugle","can_delete":false,"product_type":"c1","uid":1045770,"ip_address":"","ucode":"60A7D9189C01BE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f5/0a/077b9922.jpg","comment_is_top":false,"comment_ctime":1542956566,"is_pvip":false,"replies":[{"id":"15213","content":"活跃进程数不等于进程总数","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542979092,"ip_address":"","comment_id":42449,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542956566","product_id":100020901,"comment_content":"负载是进程数？？？有点不懂，负载转换成百分比了 ， 1个cpu一个进场 负载 就是100%， 一般的系统都是进场多余cpu的吧，  不知道是作者写错了，还是我理解错了，不理解的就是这个进程数量","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430097,"discussion_content":"活跃进程数不等于进程总数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542979092,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42443,"user_name":"code2","can_delete":false,"product_type":"c1","uid":1281792,"ip_address":"","ucode":"BBA5748FB6A01C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/8OPzdpDraQMvCNWAicicDt54sDaIYJZicBLfMyibXVs4V0ZibEdkZlbzxxL7aGpRoeyvibag5LaAaaGKSdwYQMY2hUrQ/132","comment_is_top":false,"comment_ctime":1542955189,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542955189","product_id":100020901,"comment_content":"自己写cpu密集的程序，如矩阵计算，质数计算等，IO密集程序如不停直接写磁盘，有缓冲区写磁盘等验证估计理解更深!","like_count":0},{"had_liked":false,"id":42437,"user_name":"咖啡@奶茶ⁿ°°°","can_delete":false,"product_type":"c1","uid":1315369,"ip_address":"","ucode":"6624565A8DC9BD","user_header":"https://static001.geekbang.org/account/avatar/00/14/12/29/b1e17761.jpg","comment_is_top":false,"comment_ctime":1542954462,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542954462","product_id":100020901,"comment_content":"CPU和CPU核数不一样吧，现在大多数应用是跑在虚拟机上，所以还是想进一步了解这些工具命令在输出上是否有不同的理解？谢谢，很精彩！很受益！","like_count":0},{"had_liked":false,"id":42436,"user_name":"阿牛","can_delete":false,"product_type":"c1","uid":1315708,"ip_address":"","ucode":"F9B46B924CED8A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/SluScDGqnhBNwmOQ774QE3RvWrlX5kf4jUxQpkmnjUrBMqRWRpwNhwf4R2pXRUW07cb7ib1Z6f2gEl4wEPEI5NA/132","comment_is_top":false,"comment_ctime":1542953637,"is_pvip":false,"replies":[{"id":"15217","content":"正好分析下为啥跑不动了","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542979493,"ip_address":"","comment_id":42436,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542953637","product_id":100020901,"comment_content":"我这台测试用的笔记本，ubuntu16.04，四核，平均负载常年在6附近，短期会到10，这样会不会有什么问题啊？系统启动的几天内，系统运行很快，但是几天之后会有卡的感觉，超过10天的话，就感觉彻底跑不动了。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430090,"discussion_content":"正好分析下为啥跑不动了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542979493,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42415,"user_name":"可可","can_delete":false,"product_type":"c1","uid":1215525,"ip_address":"","ucode":"BE715CC4756CCF","user_header":"https://static001.geekbang.org/account/avatar/00/12/8c/25/9c35480d.jpg","comment_is_top":false,"comment_ctime":1542950566,"is_pvip":false,"replies":[{"id":"15218","content":"😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542979507,"ip_address":"","comment_id":42415,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542950566","product_id":100020901,"comment_content":"以前我也碰到了有同事来问平均负载的问题，当时总是简单的以高速公路车辆占道的例子作为解答，有些车辆进程是cpu，有些车辆进程是io，其实自己也是懵懵懂懂。<br>今天了解到其实是活跃(cpu)和不可中断(io)组成的进程平均值所组成，受用了，光是这节课购买这个专栏已经值回票价了。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430085,"discussion_content":"😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542979507,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42413,"user_name":"李志博","can_delete":false,"product_type":"c1","uid":1009109,"ip_address":"","ucode":"F3C72573B3C112","user_header":"https://static001.geekbang.org/account/avatar/00/0f/65/d5/88beb15a.jpg","comment_is_top":false,"comment_ctime":1542950148,"is_pvip":false,"replies":[{"id":"15219","content":"延迟抖动？最简单的ping测试","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542979711,"ip_address":"","comment_id":42413,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542950148","product_id":100020901,"comment_content":"请教老师怎么看一台机器网络是不是有抖动","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430084,"discussion_content":"延迟抖动？最简单的ping测试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542979711,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42408,"user_name":"王喜春","can_delete":false,"product_type":"c1","uid":1022349,"ip_address":"","ucode":"436E91FDED1B30","user_header":"https://static001.geekbang.org/account/avatar/00/0f/99/8d/4d5dbfc5.jpg","comment_is_top":false,"comment_ctime":1542949889,"is_pvip":false,"replies":[{"id":"15221","content":"没有直接关系的，还是取决于你运行的应用","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542979821,"ip_address":"","comment_id":42408,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542949889","product_id":100020901,"comment_content":"老师，您好，请教下关于Java里线程数跟linux进程数转换的问题。具体来看，一个Java进程有200线程都运行且cpu数为4情况下，表现出来的load值大致是多少？转换过程中考虑哪些因素？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430080,"discussion_content":"没有直接关系的，还是取决于你运行的应用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542979821,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42398,"user_name":"一生一世","can_delete":false,"product_type":"c1","uid":1254081,"ip_address":"","ucode":"D8C3E55A920676","user_header":"https://static001.geekbang.org/account/avatar/00/13/22/c1/d402bfbf.jpg","comment_is_top":false,"comment_ctime":1542948744,"is_pvip":false,"replies":[{"id":"15224","content":"没太理解这个问题","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542980015,"ip_address":"","comment_id":42398,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542948744","product_id":100020901,"comment_content":"老师您好：进程，CPU,内存，磁盘大小如何计算？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430077,"discussion_content":"没太理解这个问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542980015,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42387,"user_name":"喜乐的心","can_delete":false,"product_type":"c1","uid":1036812,"ip_address":"","ucode":"BDDC5B51969852","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d2/0c/1ce8197f.jpg","comment_is_top":false,"comment_ctime":1542945622,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542945622","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":42382,"user_name":"英雄无泪","can_delete":false,"product_type":"c1","uid":1043347,"ip_address":"","ucode":"8777D5EA8D2A3C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/jib4NtzQJTqdr0rkdRczZtJDPpzkcgf1lT0aAlrnzh6t5QL0P4q5tiaMiae0uNh2K9S2ViaDpnPoS6S1CsRDYA9w5A/132","comment_is_top":false,"comment_ctime":1542944697,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542944697","product_id":100020901,"comment_content":"03打卡 回去做实验","like_count":0},{"had_liked":false,"id":42378,"user_name":"亚索","can_delete":false,"product_type":"c1","uid":1314774,"ip_address":"","ucode":"E34A081E148473","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTID6xcHMMQdvRbQHSRXrLTYqLpXnMT1mL59yicGZ6IVhiame7iaOXzZz0ljBtOMlrahCDbgB5kvydtAQ/132","comment_is_top":false,"comment_ctime":1542944454,"is_pvip":false,"replies":[{"id":"15155","content":"正解👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542949715,"ip_address":"","comment_id":42378,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542944454","product_id":100020901,"comment_content":"grep &#39;model name &#39;得到的是逻辑cpu的个数，刚才说错了","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430072,"discussion_content":"正解👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542949715,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42371,"user_name":"maoxiajun","can_delete":false,"product_type":"c1","uid":1198843,"ip_address":"","ucode":"CB4926BC81B3B1","user_header":"https://static001.geekbang.org/account/avatar/00/12/4a/fb/70f14340.jpg","comment_is_top":false,"comment_ctime":1542943748,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542943748","product_id":100020901,"comment_content":"day2打卡","like_count":0},{"had_liked":false,"id":42370,"user_name":"威","can_delete":false,"product_type":"c1","uid":1015519,"ip_address":"","ucode":"3736C74C69C17F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7e/df/145a51e5.jpg","comment_is_top":false,"comment_ctime":1542943608,"is_pvip":true,"replies":[{"id":"15145","content":"可能是版本问题，升级一下试试","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542947940,"ip_address":"","comment_id":42370,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542943608","product_id":100020901,"comment_content":"为什么我的pidstat 命令没有%wait 列……","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430069,"discussion_content":"可能是版本问题，升级一下试试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542947940,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42363,"user_name":"二三子也","can_delete":false,"product_type":"c1","uid":1245787,"ip_address":"","ucode":"69C7D86583277D","user_header":"https://static001.geekbang.org/account/avatar/00/13/02/5b/ce326cfc.jpg","comment_is_top":false,"comment_ctime":1542942912,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542942912","product_id":100020901,"comment_content":"Flag03","like_count":0},{"had_liked":false,"id":42361,"user_name":"梁中华","can_delete":false,"product_type":"c1","uid":1006789,"ip_address":"","ucode":"52FE40242CBAD0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5c/c5/1231d633.jpg","comment_is_top":false,"comment_ctime":1542942796,"is_pvip":true,"replies":[{"id":"15227","content":"会有的👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542980462,"ip_address":"","comment_id":42361,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1542942796","product_id":100020901,"comment_content":"如果能结合可能的优化措施就更好了","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430066,"discussion_content":"会有的👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542980462,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42359,"user_name":"David.cui","can_delete":false,"product_type":"c1","uid":1302228,"ip_address":"","ucode":"AB46F310403612","user_header":"https://static001.geekbang.org/account/avatar/00/13/de/d4/b83c4185.jpg","comment_is_top":false,"comment_ctime":1542942637,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542942637","product_id":100020901,"comment_content":"所谓平均负载就是(系统正在运行的进城数+不可中断的进程数）&#47;操作系统的逻辑处理器数量","like_count":0},{"had_liked":false,"id":42353,"user_name":"李","can_delete":false,"product_type":"c1","uid":1119312,"ip_address":"","ucode":"5C0FAA211F2E26","user_header":"https://static001.geekbang.org/account/avatar/00/11/14/50/c23cf47d.jpg","comment_is_top":false,"comment_ctime":1542942455,"is_pvip":true,"replies":[{"id":"15228","content":"跟CPU使用率不直接相关，而不是完全不相关。CPU使用率高了负载会高，反之不成立","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542980610,"ip_address":"","comment_id":42353,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542942455","product_id":100020901,"comment_content":"<br><br>总结下，平均负载只和活跃进程数有关。与cpu使用率无关。与io无关，如果io导致产生了进程，则有关。负载70不代表有问题，如果是4核，代表cpu进程利用率是70&#47;4。关键是看cpu整体负载是否高。如果高，再用pidstat直接看进城cpu占用最高的进程。不知道我的理解是否正确","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430064,"discussion_content":"跟CPU使用率不直接相关，而不是完全不相关。CPU使用率高了负载会高，反之不成立","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542980610,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42352,"user_name":"李","can_delete":false,"product_type":"c1","uid":1119312,"ip_address":"","ucode":"5C0FAA211F2E26","user_header":"https://static001.geekbang.org/account/avatar/00/11/14/50/c23cf47d.jpg","comment_is_top":false,"comment_ctime":1542942454,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1542942454","product_id":100020901,"comment_content":"<br><br>总结下，平均负载只和活跃进程数有关。与cpu使用率无关。与io无关，如果io导致产生了进程，则有关。负载70不代表有问题，如果是4核，代表cpu进程利用率是70&#47;4。关键是看cpu整体负载是否高。如果高，再用pidstat直接看进城cpu占用最高的进程。不知道我的理解是否正确","like_count":0},{"had_liked":false,"id":42347,"user_name":"李","can_delete":false,"product_type":"c1","uid":1119312,"ip_address":"","ucode":"5C0FAA211F2E26","user_header":"https://static001.geekbang.org/account/avatar/00/11/14/50/c23cf47d.jpg","comment_is_top":false,"comment_ctime":1542941910,"is_pvip":true,"replies":[{"id":"15229","content":"2个进程不一定都是活跃的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542980677,"ip_address":"","comment_id":42347,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542941910","product_id":100020901,"comment_content":"我看了半天，终于明白文中问题出在哪里了，这个只代表活跃进程数，和cpu使用率也无关。比如1cpu，如果负载等于2，只代表1个cpu用了两个进程，但不代表超过负荷了。因为这两个进程cpu使用率可能很低。甚至负载等于10可能都没问题。只要cpu不高。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430062,"discussion_content":"2个进程不一定都是活跃的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542980677,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42337,"user_name":"李","can_delete":false,"product_type":"c1","uid":1119312,"ip_address":"","ucode":"5C0FAA211F2E26","user_header":"https://static001.geekbang.org/account/avatar/00/11/14/50/c23cf47d.jpg","comment_is_top":false,"comment_ctime":1542941268,"is_pvip":true,"replies":[{"id":"15230","content":"过载不只是CPU，还有I&#47;O","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542980728,"ip_address":"","comment_id":42337,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542941268","product_id":100020901,"comment_content":"平均负载超过个数，也不代表过载啊。比如，我这个4核。-i后为20，负载增加到20.7。远远超过4。但看进城数据，每个进程cpu都很低。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430057,"discussion_content":"过载不只是CPU，还有I/O","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542980728,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42334,"user_name":"三口一头猫","can_delete":false,"product_type":"c1","uid":1317496,"ip_address":"","ucode":"96261B6675E63B","user_header":"https://static001.geekbang.org/account/avatar/00/14/1a/78/74275977.jpg","comment_is_top":false,"comment_ctime":1542940934,"is_pvip":true,"replies":[{"id":"15231","content":"意外的惊喜😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542980748,"ip_address":"","comment_id":42334,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542940934","product_id":100020901,"comment_content":"在本地虚拟机上操作了一遍竟然发现了一个挖矿程序 我想问下是局域网内的人干的吗 虚拟机网络是桥接模式","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430054,"discussion_content":"意外的惊喜😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542980748,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42331,"user_name":"赵赵","can_delete":false,"product_type":"c1","uid":1255176,"ip_address":"","ucode":"8692A5500E6A0B","user_header":"https://static001.geekbang.org/account/avatar/00/13/27/08/e7cc0ceb.jpg","comment_is_top":false,"comment_ctime":1542940785,"is_pvip":false,"replies":[{"id":"15232","content":"跟CPU个数对比计算","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542980778,"ip_address":"","comment_id":42331,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542940785","product_id":100020901,"comment_content":"问一下文章中的例子中，一个单 CPU 系统上看到平均负载为 1.73，0.60，7.98，那么说明在过去 1 分钟内，系统有 73% 的超载，而在 15 分钟内，有 698 % 的超载，从整体趋势来看，系统的负载在降低。这句话中的百分数怎么得出的，如果不是单个怎么计算，请赐教","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430052,"discussion_content":"跟CPU个数对比计算","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542980778,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42328,"user_name":"嘿嘿和哈哈","can_delete":false,"product_type":"c1","uid":1040976,"ip_address":"","ucode":"D1DF7BB312BFAC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e2/50/9cc482c6.jpg","comment_is_top":false,"comment_ctime":1542940692,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542940692","product_id":100020901,"comment_content":"老师我做场景三怎么和您显示的不一样呢？我的pidstat -u 5 1 输入的内容和您的不一致。<br>我的环境是阿里云--ECS版本为CentOS Linux release 7.4.1708 (Core)<br># stress -c 8 --timeout 600<br># uptime<br>10:34:13 up 28 days, 22:37,  3 users,  load average: 8.69, 5.11, 3.36<br># pidstat -u 5 1<br>Linux 3.10.0-693.2.2.el7.x86_64 (zst)   11&#47;23&#47;2018      _x86_64_        (2 CPU)<br><br>10:36:14 AM   UID       PID    %usr %system  %guest    %CPU   CPU  Command<br>10:36:19 AM     0     31869   24.75    0.00    0.00   24.75     1  stress<br>10:36:19 AM     0     31870   24.35    0.00    0.00   24.35     0  stress<br>10:36:19 AM     0     31871   24.15    0.00    0.00   24.15     1  stress<br>10:36:19 AM     0     31872   24.95    0.00    0.00   24.95     1  stress<br>10:36:19 AM     0     31873   25.35    0.00    0.00   25.35     0  stress<br>10:36:19 AM     0     31874   24.75    0.20    0.00   24.95     1  stress<br>10:36:19 AM     0     31875   25.35    0.00    0.00   25.35     0  stress<br>10:36:19 AM     0     31876   25.55    0.00    0.00   25.55     0  stress<br>10:36:19 AM     0     31877    0.20    0.00    0.00    0.20     0  watch<br><br>Average:      UID       PID    %usr %system  %guest    %CPU   CPU  Command<br>Average:        0     31869   24.75    0.00    0.00   24.75     -  stress<br>Average:        0     31870   24.35    0.00    0.00   24.35     -  stress<br>Average:        0     31871   24.15    0.00    0.00   24.15     -  stress<br>Average:        0     31872   24.95    0.00    0.00   24.95     -  stress<br>Average:        0     31873   25.35    0.00    0.00   25.35     -  stress<br>Average:        0     31874   24.75    0.20    0.00   24.95     -  stress<br>Average:        0     31875   25.35    0.00    0.00   25.35     -  stress<br>Average:        0     31876   25.55    0.00    0.00   25.55     -  stress<br>Average:        0     31877    0.20    0.00    0.00    0.20     -  watch","like_count":0},{"had_liked":false,"id":42324,"user_name":"李","can_delete":false,"product_type":"c1","uid":1119312,"ip_address":"","ucode":"5C0FAA211F2E26","user_header":"https://static001.geekbang.org/account/avatar/00/11/14/50/c23cf47d.jpg","comment_is_top":false,"comment_ctime":1542940405,"is_pvip":true,"replies":[{"id":"15233","content":"跟场景1对比一下，看看CPU使用率是不是比场景1低？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542980952,"ip_address":"","comment_id":42324,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542940405","product_id":100020901,"comment_content":"从我做的实验看，平均负载度和io没有直接关系，场景2模拟实验发现负载升高还是由于io影响了stress的cpu压力，并且会多出几个flush进程。因此，平均负载只和有多少个进程以及进城占用的cpu有关。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430047,"discussion_content":"跟场景1对比一下，看看CPU使用率是不是比场景1低？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542980952,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42271,"user_name":"code2","can_delete":false,"product_type":"c1","uid":1281792,"ip_address":"","ucode":"BBA5748FB6A01C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/8OPzdpDraQMvCNWAicicDt54sDaIYJZicBLfMyibXVs4V0ZibEdkZlbzxxL7aGpRoeyvibag5LaAaaGKSdwYQMY2hUrQ/132","comment_is_top":false,"comment_ctime":1542936367,"is_pvip":false,"replies":[{"id":"15237","content":"主要差异是CPU缓存和内存的本地性","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542981332,"ip_address":"","comment_id":42271,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542936367","product_id":100020901,"comment_content":"对称多处理器系统中的多个CPU和多核系统中的CPU个数，在linux系统中有什么差别？性能统计时是如何计算的？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430034,"discussion_content":"主要差异是CPU缓存和内存的本地性","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542981332,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42270,"user_name":"Mars","can_delete":false,"product_type":"c1","uid":1088584,"ip_address":"","ucode":"D7BAA9EBB7D89C","user_header":"https://static001.geekbang.org/account/avatar/00/10/9c/48/44965714.jpg","comment_is_top":false,"comment_ctime":1542936361,"is_pvip":false,"replies":[{"id":"15238","content":"下一期讲这个问题","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542981412,"ip_address":"","comment_id":42270,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542936361","product_id":100020901,"comment_content":"请问有什么方法能够确认性能瓶颈是进程切换频繁导致的还是线程切换导致的呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430033,"discussion_content":"下一期讲这个问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542981412,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42265,"user_name":"元天夫","can_delete":false,"product_type":"c1","uid":1315599,"ip_address":"","ucode":"A453A2EBA77780","user_header":"","comment_is_top":false,"comment_ctime":1542936206,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542936206","product_id":100020901,"comment_content":"D3，学习了，之前也是没有注意到负载高与iowait还有关，晚上动手实操下","like_count":0},{"had_liked":false,"id":42262,"user_name":"『LHCY』","can_delete":false,"product_type":"c1","uid":1188449,"ip_address":"","ucode":"A8B5E0467B5F25","user_header":"https://static001.geekbang.org/account/avatar/00/12/22/61/bbfb2d4a.jpg","comment_is_top":false,"comment_ctime":1542936135,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542936135","product_id":100020901,"comment_content":"uptime和线程无关吗","like_count":0},{"had_liked":false,"id":42257,"user_name":"doze_worm","can_delete":false,"product_type":"c1","uid":1232912,"ip_address":"","ucode":"CEDAB59C216EEB","user_header":"https://static001.geekbang.org/account/avatar/00/12/d0/10/d71198f1.jpg","comment_is_top":false,"comment_ctime":1542936033,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542936033","product_id":100020901,"comment_content":"good man, good google。在遇到问题的时候，其实还是应该先查一下手册再去网上翻。我好多时候把顺序弄倒了。","like_count":0},{"had_liked":false,"id":42252,"user_name":"小可","can_delete":false,"product_type":"c1","uid":1006735,"ip_address":"","ucode":"8834AF621FA67D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5c/8f/551b5624.jpg","comment_is_top":false,"comment_ctime":1542935782,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542935782","product_id":100020901,"comment_content":"醍醐灌顶，豁然开朗👍","like_count":0},{"had_liked":false,"id":42251,"user_name":"zuobianfy","can_delete":false,"product_type":"c1","uid":1315321,"ip_address":"","ucode":"46B40A9E579A21","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqTFSq8k3galzXR1v0NgR3YMDSRER2R6TeHbC7iadVoia7GjlJGh2TSviaBo9PNy4aQE1ADIv87MdwLg/132","comment_is_top":false,"comment_ctime":1542935690,"is_pvip":false,"replies":[{"id":"15240","content":"大多数进程都不是活跃的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542981486,"ip_address":"","comment_id":42251,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542935690","product_id":100020901,"comment_content":"平均负载的意思是单位时间里的进程数。1个cpu，平均负载是1是最好的，也就是说单位时间内的进程数为1。这个单位时间如何理解呢？因为cpu是无时无刻都在工作着的，单个cpu的电脑在使用者看起来可以同时运行好几个程序，这是cpu调度来实现的。所以感觉有点矛盾。这个单位时间如何理解？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430026,"discussion_content":"大多数进程都不是活跃的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542981486,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42248,"user_name":"猿谋人","can_delete":false,"product_type":"c1","uid":1197854,"ip_address":"","ucode":"5A2C095C5640BB","user_header":"https://static001.geekbang.org/account/avatar/00/12/47/1e/187de43d.jpg","comment_is_top":false,"comment_ctime":1542935593,"is_pvip":false,"replies":[{"id":"15242","content":"对的，所以称为Uninterruptible Sleep","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542981590,"ip_address":"","comment_id":42248,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542935593","product_id":100020901,"comment_content":"io等待进程消耗cpu资源很少才对吧","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430023,"discussion_content":"对的，所以称为Uninterruptible Sleep","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542981590,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42245,"user_name":"Maxwell","can_delete":false,"product_type":"c1","uid":1086275,"ip_address":"","ucode":"720A00AD472616","user_header":"https://static001.geekbang.org/account/avatar/00/10/93/43/0e84492d.jpg","comment_is_top":false,"comment_ctime":1542935330,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542935330","product_id":100020901,"comment_content":"Centos6.9的虚拟机可以么？","like_count":0},{"had_liked":false,"id":42243,"user_name":"可乐嘚嘚儿","can_delete":false,"product_type":"c1","uid":1132949,"ip_address":"","ucode":"B50EEE2CE03B9A","user_header":"https://static001.geekbang.org/account/avatar/00/11/49/95/84e68698.jpg","comment_is_top":false,"comment_ctime":1542935221,"is_pvip":false,"replies":[{"id":"15243","content":"画个曲线看看？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542981647,"ip_address":"","comment_id":42243,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542935221","product_id":100020901,"comment_content":"一个单 CPU 系统上看到平均负载为 1.73，0.60，7.98，那么说明在过去 1 分钟内，系统有 73% 的超载，而在 15 分钟内，有 698 % 的超载，从整体趋势来看，系统的负载在降低。这个负载是在增加吧","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430021,"discussion_content":"画个曲线看看？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542981647,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42241,"user_name":"float sward","can_delete":false,"product_type":"c1","uid":1316444,"ip_address":"","ucode":"0549C9FE20531A","user_header":"https://static001.geekbang.org/account/avatar/00/14/16/5c/40e06141.jpg","comment_is_top":false,"comment_ctime":1542935149,"is_pvip":false,"replies":[{"id":"15244","content":"后面逐步细化介绍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542981676,"ip_address":"","comment_id":42241,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542935149","product_id":100020901,"comment_content":"老倪 能否这篇文章介绍下磁盘io 网络io的东西？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430020,"discussion_content":"后面逐步细化介绍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542981676,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42236,"user_name":"努力的小熊猫","can_delete":false,"product_type":"c1","uid":1317235,"ip_address":"","ucode":"9F3BCBF9663F6A","user_header":"","comment_is_top":false,"comment_ctime":1542934902,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542934902","product_id":100020901,"comment_content":"03打卡","like_count":0},{"had_liked":false,"id":42227,"user_name":"雷击周","can_delete":false,"product_type":"c1","uid":1142486,"ip_address":"","ucode":"E3509357BEEBCF","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/mg86W2NaRPXXRUk0Q7M3Pm1CNson0HAejpP3pbxsbmXlib2uRIZQ7nSicUvphU1iagAEAnPCxiax6MLLh4iaIOKHnWg/132","comment_is_top":false,"comment_ctime":1542934585,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542934585","product_id":100020901,"comment_content":"D3打卡<br>想法 师傅领进门 修行靠个人","like_count":0},{"had_liked":false,"id":42226,"user_name":"Geek_33409b","can_delete":false,"product_type":"c1","uid":1112756,"ip_address":"","ucode":"9C64C42F799403","user_header":"https://static001.geekbang.org/account/avatar/00/10/fa/b4/6892eabe.jpg","comment_is_top":false,"comment_ctime":1542934523,"is_pvip":false,"replies":[{"id":"15246","content":"👍 可以跟大家分享下排查的思路","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542981734,"ip_address":"","comment_id":42226,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542934523","product_id":100020901,"comment_content":"之前遇到一个很神奇的bug，程序运行一会儿就defunct，磁盘变成read only，查了很久才发现是电源功率不够，导致了硬盘掉电。一直以为是磁盘读写有问题。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430012,"discussion_content":"👍 可以跟大家分享下排查的思路","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542981734,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42219,"user_name":"_JQ.Wang","can_delete":false,"product_type":"c1","uid":1227617,"ip_address":"","ucode":"6BE451E16592F3","user_header":"https://static001.geekbang.org/account/avatar/00/12/bb/61/90ad7c91.jpg","comment_is_top":false,"comment_ctime":1542934310,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542934310","product_id":100020901,"comment_content":"good,非常受用。","like_count":0},{"had_liked":false,"id":42203,"user_name":"Geek_101627","can_delete":false,"product_type":"c1","uid":1070389,"ip_address":"","ucode":"F246019019F1CB","user_header":"https://static001.geekbang.org/account/avatar/00/10/55/35/09e7dfde.jpg","comment_is_top":false,"comment_ctime":1542933641,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542933641","product_id":100020901,"comment_content":"03打卡","like_count":0},{"had_liked":false,"id":42199,"user_name":"Geek_101627","can_delete":false,"product_type":"c1","uid":1070389,"ip_address":"","ucode":"F246019019F1CB","user_header":"https://static001.geekbang.org/account/avatar/00/10/55/35/09e7dfde.jpg","comment_is_top":false,"comment_ctime":1542933565,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542933565","product_id":100020901,"comment_content":"03打卡","like_count":0},{"had_liked":false,"id":42183,"user_name":"jamie","can_delete":false,"product_type":"c1","uid":1316522,"ip_address":"","ucode":"AF044FDACBF262","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eo3hZK32lqkGfRTptSUaoOOIz2bHqPbS7KjdNx8qKoa6JDWeFzBIjeic2NaWVRZ6knbiaeQ1DAx7qgg/132","comment_is_top":false,"comment_ctime":1542933183,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542933183","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":42162,"user_name":"王征","can_delete":false,"product_type":"c1","uid":1130985,"ip_address":"","ucode":"F07FE3C51C00F6","user_header":"https://static001.geekbang.org/account/avatar/00/11/41/e9/586275da.jpg","comment_is_top":false,"comment_ctime":1542932516,"is_pvip":false,"replies":[{"id":"15251","content":"😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542982258,"ip_address":"","comment_id":42162,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542932516","product_id":100020901,"comment_content":"手动点赞，喜欢这种有理论有实践的授课方式","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430003,"discussion_content":"😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542982258,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42161,"user_name":"泉","can_delete":false,"product_type":"c1","uid":1027355,"ip_address":"","ucode":"F3447D3D5D5197","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ad/1b/0c558e7e.jpg","comment_is_top":false,"comment_ctime":1542932406,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542932406","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":42157,"user_name":"探索无止境","can_delete":false,"product_type":"c1","uid":1044178,"ip_address":"","ucode":"91D2A9907DFA79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ee/d2/7024431c.jpg","comment_is_top":false,"comment_ctime":1542932068,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542932068","product_id":100020901,"comment_content":"有案例，清晰明朗，而不是空谈，赞！","like_count":0},{"had_liked":false,"id":42155,"user_name":"行者","can_delete":false,"product_type":"c1","uid":1063734,"ip_address":"","ucode":"EA31201A7C5AE1","user_header":"https://static001.geekbang.org/account/avatar/00/10/3b/36/2d61e080.jpg","comment_is_top":false,"comment_ctime":1542932048,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542932048","product_id":100020901,"comment_content":"哇塞，理论结合案例，老师讲解好棒。<br>我理解的uptime查看系统负载，如果负载变大说明任务增加，接下来就是排查cpu 内存 io的变化。","like_count":0},{"had_liked":false,"id":42154,"user_name":"Linuxer","can_delete":false,"product_type":"c1","uid":1153978,"ip_address":"","ucode":"272D9D8089C3D6","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/ba/333b59e5.jpg","comment_is_top":false,"comment_ctime":1542932034,"is_pvip":false,"replies":[{"id":"15253","content":"😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542982288,"ip_address":"","comment_id":42154,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542932034","product_id":100020901,"comment_content":"一般遇到性能问题，首先也会关注平均负载，然后联系CPU数量，再关注是CPU还是IO导致负载过高，我经常用的是top和iotop，但是从没像今天过完后这般通透，感谢。今天再抽空实操一把，打卡为证","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429999,"discussion_content":"😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542982288,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42149,"user_name":"吴飞","can_delete":false,"product_type":"c1","uid":1103619,"ip_address":"","ucode":"CC58A5534BD457","user_header":"https://static001.geekbang.org/account/avatar/00/10/d7/03/eb991e02.jpg","comment_is_top":false,"comment_ctime":1542931731,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542931731","product_id":100020901,"comment_content":"打卡 明白了","like_count":0},{"had_liked":false,"id":42148,"user_name":"Lu | SSEINFO","can_delete":false,"product_type":"c1","uid":1045848,"ip_address":"","ucode":"389B5493CCEA79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f5/58/9ee22cda.jpg","comment_is_top":false,"comment_ctime":1542931718,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542931718","product_id":100020901,"comment_content":"笔记：平均负载是指单位时间内使用CPU，等待CPU，等待IO的进程数。<br>工作中遇到过由于cpu密集和IO密集的进程导致的平均负载增高。<br>文章条理清晰，待会儿做做实验再加深一下理解。","like_count":0},{"had_liked":false,"id":42141,"user_name":"Hurt","can_delete":false,"product_type":"c1","uid":1050946,"ip_address":"","ucode":"DCE7428CCF08EF","user_header":"https://static001.geekbang.org/account/avatar/00/10/09/42/1f762b72.jpg","comment_is_top":false,"comment_ctime":1542931399,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542931399","product_id":100020901,"comment_content":"打卡3😀","like_count":0},{"had_liked":false,"id":42140,"user_name":"偏偏喜欢你","can_delete":false,"product_type":"c1","uid":1101985,"ip_address":"","ucode":"76D9E22B263D6B","user_header":"https://static001.geekbang.org/account/avatar/00/10/d0/a1/07027529.jpg","comment_is_top":false,"comment_ctime":1542931377,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542931377","product_id":100020901,"comment_content":"老师您好，小白一个，跟着老师的脚步修炼","like_count":0},{"had_liked":false,"id":42134,"user_name":"baolinhaha","can_delete":false,"product_type":"c1","uid":1318108,"ip_address":"","ucode":"F04F3E9BC54055","user_header":"","comment_is_top":false,"comment_ctime":1542930938,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542930938","product_id":100020901,"comment_content":"cpu steal怎么理解？虚拟机上的cpu使用率在60%左右，所在主机没超分，cpu steal持续在15%，平均负载持续在1.5，属于io密集型业务","like_count":0},{"had_liked":false,"id":42127,"user_name":"兵临城下","can_delete":false,"product_type":"c1","uid":1316592,"ip_address":"","ucode":"88294A59484F17","user_header":"https://static001.geekbang.org/account/avatar/00/14/16/f0/3051cc84.jpg","comment_is_top":false,"comment_ctime":1542930654,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542930654","product_id":100020901,"comment_content":"以前认为，和cpu，内存，io的一个平均使用率","like_count":0},{"had_liked":false,"id":42123,"user_name":"每日都想上班","can_delete":false,"product_type":"c1","uid":1060466,"ip_address":"","ucode":"1DE64120C8B14A","user_header":"https://static001.geekbang.org/account/avatar/00/10/2e/72/145c10db.jpg","comment_is_top":false,"comment_ctime":1542930215,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542930215","product_id":100020901,"comment_content":"师傅领进门，修行靠个人，我觉得基本要点和重点都分析了，非常好","like_count":0},{"had_liked":false,"id":42092,"user_name":"雪球","can_delete":false,"product_type":"c1","uid":1224352,"ip_address":"","ucode":"C230FF4B541717","user_header":"https://static001.geekbang.org/account/avatar/00/12/ae/a0/fc30df34.jpg","comment_is_top":false,"comment_ctime":1542908938,"is_pvip":false,"replies":[{"id":"15114","content":"这几个工具的参数在音频里面没有读，但在文稿的代码段开始都有说明。<br><br>不希望这个专栏成为一个命令工具的使用手册，所以文章里没有罗列这些工具的详细用法。其实，运行一下 “man 工具名”很容易查到这些。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542932964,"ip_address":"","comment_id":42092,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542908938","product_id":100020901,"comment_content":"老师在案例过程中对pidstat mpstat stress工具各个参数的含义还没有理解，比如命令后的数字1。老师能不能系统讲解一下？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429988,"discussion_content":"这几个工具的参数在音频里面没有读，但在文稿的代码段开始都有说明。\n\n不希望这个专栏成为一个命令工具的使用手册，所以文章里没有罗列这些工具的详细用法。其实，运行一下 “man 工具名”很容易查到这些。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542932964,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42080,"user_name":"Maiza","can_delete":false,"product_type":"c1","uid":1007248,"ip_address":"","ucode":"D6911CDAC0D8C7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5e/90/5f79859b.jpg","comment_is_top":false,"comment_ctime":1542903977,"is_pvip":false,"replies":[{"id":"15256","content":"什么问题？麻烦具体指出来","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1542982446,"ip_address":"","comment_id":42080,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542903977","product_id":100020901,"comment_content":"而在 15 分钟内，有 698 % 的超载<br><br>这句话有问题。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429985,"discussion_content":"什么问题？麻烦具体指出来","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542982446,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}