{"id":8836,"title":"29 | 配置定义和场景","content":"无","comments":[{"had_liked":false,"id":295727,"user_name":"silentyears","can_delete":false,"product_type":"c3","uid":1061748,"ip_address":"","ucode":"6E137BFEB874CA","user_header":"https://static001.geekbang.org/account/avatar/00/10/33/74/d9d143fa.jpg","comment_is_top":false,"comment_ctime":1622560769,"is_pvip":false,"replies":[{"id":107632,"content":"蓝绿发布是一把切到新版本，如有问题就一把切回老版本，这种发布一般需要两倍机器资源，通常用于版本不兼容发布。\n灰度发布是先发布少量新版本，接受生产流量进行验证，和老版本共存一段时间，通过监控看是否有问题，没有问题继续发新版本，逐步下线老版本，灰度发布通常用于版本兼容发布。\nA&#47;B测试是A&#47;B两个版本同时在线上，通过监控比较两个版本的性能或用户访问数据，通常作为产品功能比对。\n","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1622994225,"ip_address":"","comment_id":295727,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"老师，蓝绿发布、灰度发布目的差不多吧，而a&#47;b test是为了统计抽样，分析哪个版本更受欢迎？","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521195,"discussion_content":"蓝绿发布是一把切到新版本，如有问题就一把切回老版本，这种发布一般需要两倍机器资源，通常用于版本不兼容发布。\n灰度发布是先发布少量新版本，接受生产流量进行验证，和老版本共存一段时间，通过监控看是否有问题，没有问题继续发新版本，逐步下线老版本，灰度发布通常用于版本兼容发布。\nA/B测试是A/B两个版本同时在线上，通过监控比较两个版本的性能或用户访问数据，通常作为产品功能比对。\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622994225,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":201498,"user_name":"　　　　　　　鸟人","can_delete":false,"product_type":"c3","uid":1035165,"ip_address":"","ucode":"E504B22F336035","user_header":"https://static001.geekbang.org/account/avatar/00/0f/cb/9d/2bc85843.jpg","comment_is_top":false,"comment_ctime":1585795857,"is_pvip":false,"replies":[{"id":75444,"content":"蓝绿发布是应用的两个版本同时并存，通过LB或者功能开关切换流量实现动态发布。\n\napp热更新是新功能模块的下载、加载和更新。\n\n两者一般是不同概念。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1585840254,"ip_address":"","comment_id":201498,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"蓝绿发布类似app的热更新？","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490355,"discussion_content":"蓝绿发布是应用的两个版本同时并存，通过LB或者功能开关切换流量实现动态发布。\n\napp热更新是新功能模块的下载、加载和更新。\n\n两者一般是不同概念。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585840254,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1035165,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/cb/9d/2bc85843.jpg","nickname":"　　　　　　　鸟人","note":"","ucode":"E504B22F336035","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":220347,"discussion_content":"谢谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585848235,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":195315,"user_name":"stg609","can_delete":false,"product_type":"c3","uid":1073025,"ip_address":"","ucode":"FB70A75A891BB8","user_header":"https://static001.geekbang.org/account/avatar/00/10/5f/81/1c614f4a.jpg","comment_is_top":false,"comment_ctime":1585177780,"is_pvip":false,"replies":[{"id":74365,"content":"业务配置也是配置中心的典型应用场景。我之前公司的研发小伙伴，在apollo配置中心的api上包了一个界面，给产品运营的小伙伴做动态业务配置更新，效果很好。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1585234008,"ip_address":"","comment_id":195315,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"业务方面的配置也是放配置中心吗？ 比如有 保险, 银行 两个微服务，及一个配置中心。那和保险紧密相关的业务方面的配置参数，如一些保费费率，也是放在配置中心吗？ 这些带有业务意义的配置如果直接有该微服务自己维护是否更合适？","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489026,"discussion_content":"业务配置也是配置中心的典型应用场景。我之前公司的研发小伙伴，在apollo配置中心的api上包了一个界面，给产品运营的小伙伴做动态业务配置更新，效果很好。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585234008,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":189663,"user_name":"Geek_4cea04","can_delete":false,"product_type":"c3","uid":1526329,"ip_address":"","ucode":"8CF778FE425C85","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLiajgNaz9JZCuoy3LSK8sy7WrBAzqQJYkCWZicRMA1vaic4pcfWyia8cAlh7m6puoGTZ3sCeH1XRKTxQ/132","comment_is_top":false,"comment_ctime":1584539458,"is_pvip":false,"replies":[{"id":73411,"content":"你的思路的对的，再做DB迁移之前，历史数据需要先全量导到新DB，然后双写(这里头还会有一个时间差，需要同步时间差窗口内的数据），只有当两边数据完全一致了，才可以考虑通过配置切换。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1584790069,"ip_address":"","comment_id":189663,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"数据库的迁移不考虑历史数据可以这样做，如果考虑历史数据的保存，这个应该怎样做呢？我的思路是不是可以在配置中心配置历史数据访问原始数据库，在做持续服务在后台进行数据转换，当转换完成后再进行数据整体断流。老师可以给简单介绍一下吗？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487760,"discussion_content":"你的思路的对的，再做DB迁移之前，历史数据需要先全量导到新DB，然后双写(这里头还会有一个时间差，需要同步时间差窗口内的数据），只有当两边数据完全一致了，才可以考虑通过配置切换。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584790069,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1088710,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9c/c6/05a6798f.jpg","nickname":"苗","note":"","ucode":"5ECCC6C855E541","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":267627,"discussion_content":"https://time.geekbang.org/column/article/221658也可以参考这篇文章；不同的地方在于比对部分；老师讲的是比对读到的结果，这篇文章中是通过上线一个程序比对写的数据。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589652963,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":131394,"user_name":"男朋友","can_delete":false,"product_type":"c3","uid":1401707,"ip_address":"","ucode":"9818176E0BBD31","user_header":"https://static001.geekbang.org/account/avatar/00/15/63/6b/34b89fae.jpg","comment_is_top":false,"comment_ctime":1567737814,"is_pvip":false,"replies":[{"id":49882,"content":"我念习惯了:)谢谢提醒! ","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1567774179,"ip_address":"","comment_id":131394,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"老师，是阈(yu第四声)值不是(fa)","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466430,"discussion_content":"我念习惯了:)谢谢提醒! ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567774179,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48143,"user_name":"Geek_fb3db2","can_delete":false,"product_type":"c3","uid":1218254,"ip_address":"","ucode":"8089B8311B6C80","user_header":"https://static001.geekbang.org/account/avatar/00/12/96/ce/8c3bdbe5.jpg","comment_is_top":false,"comment_ctime":1544367304,"is_pvip":false,"replies":[{"id":17303,"content":"配置中心只是负责配置的管理，配置更新时及时通知到客户端，客户端拿到这些配置后具体的业务逻辑是应用开发人员要定制开发的。问题1，10%这个数据可以配在配置中心里头，客户端拿到后再根据这个数据切流量。问题2，比对逻辑也是应用开发需根据具体业务定制的。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1544442794,"ip_address":"","comment_id":48143,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"没有明白这个数据迁移和配置中心怎么结合起来的 \n问题1：怎么确定是10%\n问题2：以及如果发现差异怎么比对。\n感觉配置中心只是负责配置的关心维护等操作，和上述有什么联系呢","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432048,"discussion_content":"配置中心只是负责配置的管理，配置更新时及时通知到客户端，客户端拿到这些配置后具体的业务逻辑是应用开发人员要定制开发的。问题1，10%这个数据可以配在配置中心里头，客户端拿到后再根据这个数据切流量。问题2，比对逻辑也是应用开发需根据具体业务定制的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544442794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}