{"id":427973,"title":"Spark UIï¼ˆä¸Šï¼‰| æ·±å…¥è§£è¯»Sparkä½œä¸šçš„â€œä½“æ£€æŠ¥å‘Šâ€","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å´ç£Šã€‚</p><p>å¥½ä¹…ä¸è§äº†ï¼Œè·ç¦»ä¸“æ ç»“æŸæœ‰ä¸å°‘æ—¶é—´äº†ï¼Œä¸è¿‡è¿™æœŸé—´æˆ‘ä¸€ç›´åœ¨å…³æ³¨ç€åŒå­¦ä»¬çš„ç•™è¨€ã€‚ä»Šå¤©æˆ‘å°±å¸¦ç€ä½ çš„æœŸå¾…åˆæ¥äº†ã€‚</p><p>åœ¨æ€§èƒ½è°ƒä¼˜çš„æœ¬è´¨é‚£ä¸€è®²ï¼ˆ<a href=\"https://time.geekbang.org/column/article/352577\">ç¬¬2è®²</a>ï¼‰ï¼Œæˆ‘ä»¬è¯´è¿‡æ€§èƒ½è°ƒä¼˜æ–¹æ³•è®ºã€‚</p><p>å…¶ä¸­çš„ç¬¬ä¸€æ¡ï¼Œå°±æ˜¯æ ¹æ®ä¸“å®¶ç»éªŒæˆ–æ˜¯è¿è¡Œæ—¶çš„è¯Šæ–­ï¼Œæ¥å®šä½æ€§èƒ½ç“¶é¢ˆã€‚ä½œä¸ºSparkå†…ç½®çš„è¿è¡Œæ—¶ç›‘æ§ç•Œé¢ï¼ŒSpark UIæ˜¯æˆ‘ä»¬å¿…é¡»è¦æŒæ¡çš„é‡è¦å·¥å…·ã€‚è€Œä¸”éšç€è¯¾ç¨‹çš„æ¨è¿›ï¼Œæœ‰ä¸å°‘åŒå­¦åœ¨åå°åé¦ˆï¼Œå¸Œæœ›æˆ‘è¡¥å……Spark UIçš„è¯¾ç¨‹å†…å®¹ã€‚</p><p>é‰´äºä»¥ä¸Šä¸¤ç‚¹ï¼Œæˆ‘ç”¨åŠ é¤çš„å½¢å¼ï¼ŒæŠŠSpark UIçš„å†…å®¹è¡¥å……åˆ°è¯¾ç¨‹ä¸­ï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚</p><p>åœ¨æ—¥å¸¸çš„å¼€å‘å·¥ä½œä¸­ï¼Œæˆ‘ä»¬æ€»ä¼šé‡åˆ°Sparkåº”ç”¨è¿è¡Œå¤±è´¥ã€æˆ–æ˜¯æ‰§è¡Œæ•ˆç‡æœªè¾¾é¢„æœŸçš„æƒ…å†µã€‚å¯¹äºè¿™æ ·çš„é—®é¢˜ï¼Œæƒ³æ‰¾åˆ°æ ¹æœ¬åŸå› ï¼ˆRoot Causeï¼‰ï¼Œå°±å¯ä»¥é€šè¿‡Spark UIæ¥è·å–æœ€ç›´æ¥ã€æœ€ç›´è§‚çš„çº¿ç´¢ï¼Œåœ¨å…¨é¢åœ°å®¡æŸ¥Sparkåº”ç”¨çš„åŒæ—¶ï¼Œè¿…é€Ÿå®šä½é—®é¢˜æ‰€åœ¨ã€‚</p><p>å¦‚æœæˆ‘ä»¬æŠŠå¤±è´¥çš„ã€æˆ–æ˜¯æ‰§è¡Œä½æ•ˆçš„Sparkåº”ç”¨çœ‹ä½œæ˜¯â€œç—…äººâ€çš„è¯ï¼Œé‚£ä¹ˆSpark UIä¸­å…³äºåº”ç”¨çš„ä¼—å¤šåº¦é‡æŒ‡æ ‡ï¼ˆMetricsï¼‰ï¼Œå°±æ˜¯è¿™ä¸ªç—…äººçš„â€œä½“æ£€æŠ¥å‘Šâ€ã€‚ç»“åˆå¤šæ ·çš„Metricsï¼Œèº«ä¸ºâ€œå¤§å¤«â€çš„å¼€å‘è€…å³å¯ç»“åˆç»éªŒæ¥è¿…é€Ÿåœ°å®šä½â€œç—…ç¶â€ã€‚</p><p>ä»Šå¤©è¿™ä¸€è®²ï¼Œè®©æˆ‘ä»¬ä»¥å°æ±½è½¦æ‘‡å·ä¸­â€œå€ç‡è®¡ç®—â€çš„åº”ç”¨ï¼ˆè¯¦ç»†å†…å®¹ä½ å¯ä»¥å›é¡¾<a href=\"https://time.geekbang.org/column/article/374776\">ç¬¬30è®²</a>ï¼‰ä¸ºä¾‹ï¼Œç”¨å›¾è§£çš„æ–¹å¼ï¼Œä¸€æ­¥æ­¥åœ°å»è®¤è¯†Spark UIï¼Œçœ‹ä¸€çœ‹å®ƒæœ‰å“ªäº›å…³é”®çš„åº¦é‡æŒ‡æ ‡ï¼Œè¿™äº›æŒ‡æ ‡éƒ½æ˜¯ä»€ä¹ˆå«ä¹‰ï¼Œåˆèƒ½ä¸ºå¼€å‘è€…æä¾›å“ªäº›æ´å¯Ÿï¼ˆInsightsï¼‰ï¼Ÿ</p><!-- [[[read_end]]] --><p>è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œå¯¹äºSpark UIçš„ä»‹ç»ä¸è®²è§£ï¼Œæ¶‰åŠåˆ°å¤§é‡çš„å›¾è§£ã€ä»£ç ä¸æŒ‡æ ‡é‡Šä¹‰ï¼Œå†…å®¹åºæ‚ã€‚å› æ­¤ï¼Œä¸ºäº†å‡è½»ä½ çš„å­¦ä¹ è´Ÿæ‹…ï¼Œæˆ‘æŒ‰ç…§Spark UIçš„å…¥å£ç±»å‹ï¼ˆä¸€çº§å…¥å£ã€äºŒçº§å…¥å£ï¼‰æŠŠSpark UIæ‹†æˆäº†ä¸Šã€ä¸‹ä¸¤è®²ã€‚ä¸€çº§å…¥å£æ¯”è¾ƒç®€å•ã€ç›´æ¥ï¼Œæˆ‘ä»¬ä»Šå¤©è¿™ä¸€è®²ï¼Œå…ˆæ¥è®²è§£è¿™ä¸€éƒ¨åˆ†ï¼ŒäºŒçº§å…¥å£çš„è®²è§£ç•™åˆ°ä¸‹ä¸€è®²å»å±•å¼€ã€‚</p><h2>å‡†å¤‡å·¥ä½œ</h2><p>åœ¨æ­£å¼å¼€å§‹ä»‹ç»Spark UIä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥ç®€å•äº¤ä»£ä¸€ä¸‹å›¾è§£æ¡ˆä¾‹ç”¨åˆ°çš„ç¯å¢ƒã€é…ç½®ä¸ä»£ç ã€‚ä½ å¯ä»¥å‚è€ƒè¿™é‡Œç»™å‡ºçš„ç»†èŠ‚ï¼Œå»å¤ç°â€œå€ç‡è®¡ç®—â€æ¡ˆä¾‹Spark UIä¸­çš„æ¯ä¸€ä¸ªç•Œé¢ï¼Œç„¶åå†ç»“åˆä»Šå¤©çš„è®²è§£ï¼Œä»¥â€œçœ‹å¾—è§ã€æ‘¸å¾—ç€â€çš„æ–¹å¼ï¼Œå»æ›´åŠ ç›´è§‚ã€æ·±å…¥åœ°ç†Ÿæ‚‰æ¯ä¸€ä¸ªé¡µé¢ä¸åº¦é‡æŒ‡æ ‡ã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœä½ æ‰‹å¤´ä¸€æ—¶æ²¡æœ‰åˆé€‚çš„æ‰§è¡Œç¯å¢ƒï¼Œä¹Ÿä¸è¦ç´§ã€‚å’±ä»¬è¿™ä¸€è®²çš„ç‰¹ç‚¹ï¼Œå°±æ˜¯å›¾å¤šï¼Œåé¢æˆ‘ç‰¹æ„å‡†å¤‡äº†å¤§é‡çš„å›¾ç‰‡å’Œè¡¨æ ¼ï¼Œå¸¦ä½ å½»åº•äº†è§£Spark UIã€‚</p><p>ç”±äºå°æ±½è½¦æ‘‡å·æ•°æ®ä½“é‡ä¸å¤§ï¼Œå› æ­¤åœ¨è®¡ç®—èµ„æºæ–¹é¢ï¼Œæˆ‘ä»¬çš„è¦æ±‚å¹¶ä¸é«˜ï¼Œâ€œå€ç‡è®¡ç®—â€æ¡ˆä¾‹ç”¨åˆ°çš„èµ„æºå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/0b/2b/0b3635aa7eb123b387c507f6caf4b22b.jpg?wh=1491x737\" alt=\"å›¾ç‰‡\" title=\"ç¡¬ä»¶èµ„æº\"></p><p>æ¥ä¸‹æ¥æ˜¯ä»£ç ï¼Œåœ¨å°æ±½è½¦æ‘‡å·åº”ç”¨å¼€å‘é‚£ä¸€è®²ï¼Œæˆ‘ä»¬ä¸€æ­¥æ­¥åœ°å®ç°äº†â€œå€ç‡è®¡ç®—â€çš„è®¡ç®—é€»è¾‘ï¼Œè¿™é‡Œå’±ä»¬ä¸å¦¨ä¸€èµ·å›é¡¾ä¸€ä¸‹ã€‚</p><pre><code class=\"language-scala\">// HDFSæ ¹ç›®å½•åœ°å€\nval rootPath: String = \"hdfs://hostname:9000\"\n&nbsp;\n// ç”³è¯·è€…æ•°æ®\nval hdfs_path_apply = s\"${rootPath}/2011-2019å°æ±½è½¦æ‘‡å·æ•°æ®/apply\"\nval applyNumbersDF = spark.read.parquet(hdfs_path_apply)\n// åˆ›å»ºCacheå¹¶è§¦å‘Cacheè®¡ç®—\napplyNumbersDF.cache.count()\n&nbsp;\n// ä¸­ç­¾è€…æ•°æ®\nval hdfs_path_lucky = s\"${rootPath}/2011-2019å°æ±½è½¦æ‘‡å·æ•°æ®/lucky\"\nval luckyDogsDF = spark.read.parquet(hdfs_path_lucky)\n//åˆ›å»ºCacheå¹¶è§¦å‘Cacheè®¡ç®—\nluckyDogsDF.cache.count()\n&nbsp;\nval result05_01 = applyNumbersDF\n&nbsp;&nbsp;&nbsp; // æŒ‰ç…§carNumåšå…³è”\n&nbsp;&nbsp;&nbsp; .join(luckyDogsDF.filter(col(\"batchNum\") &gt;= \"201601\").select(\"carNum\"), Seq(\"carNum\"), \"inner\")\n.groupBy(col(\"batchNum\"),col(\"carNum\"))\n.agg(count(lit(1)).alias(\"multiplier\"))\n.groupBy(\"carNum\")\n// å–æœ€å¤§å€ç‡\n.agg(max(\"multiplier\").alias(\"multiplier\"))\n.groupBy(\"multiplier\")\n// æŒ‰ç…§å€ç‡åšåˆ†ç»„è®¡æ•°\n.agg(count(lit(1)).alias(\"cnt\"))\n// æŒ‰ç…§å€ç‡æ’åº\n.orderBy(\"multiplier\")\n&nbsp;\nresult05_01.write.mode(\"Overwrite\").format(\"csv\").save(s\"${rootPath}/results/result05_01\")\n</code></pre><p>ä»Šå¤©æˆ‘ä»¬åœ¨æ­¤åŸºç¡€ä¸Šåšä¸€ç‚¹å˜åŒ–ï¼Œ<strong>ä¸ºäº†å±•ç¤ºStorageTabé¡µé¢å†…å®¹ï¼Œæˆ‘ä»¬è¿™é‡Œâ€œå¼ºè¡Œâ€ç»™applyNumbersDF å’ŒluckyDogsDFè¿™ä¸¤ä¸ªDataFrameéƒ½åŠ äº†Cacheã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå¯¹äºå¼•ç”¨æ•°é‡ä¸º1çš„æ•°æ®é›†ï¼Œå®é™…ä¸Šæ˜¯æ²¡æœ‰å¿…è¦åŠ Cacheçš„ï¼Œè¿™ä¸€ç‚¹è¿˜éœ€è¦ä½ æ³¨æ„</strong>ã€‚</p><p>å›é¡¾å®Œä»£ç ä¹‹åï¼Œå†æ¥çœ‹çœ‹é…ç½®é¡¹ã€‚ä¸ºäº†è®©Spark UIèƒ½å¤Ÿå±•ç¤ºè¿è¡Œä¸­ä»¥åŠæ‰§è¡Œå®Œæ¯•çš„åº”ç”¨ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è®¾ç½®å¦‚ä¸‹é…ç½®é¡¹å¹¶å¯åŠ¨History Serverã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/09/e9/09d9a96316b00de7a5afe015a1444de9.jpg?wh=1889x741\" alt=\"å›¾ç‰‡\" title=\"Event logç›¸å…³é…ç½®é¡¹\"></p><pre><code class=\"language-scala\">// SPARK_HOMEè¡¨ç¤ºSparkå®‰è£…ç›®å½•\n${SPAK_HOME}/sbin/start-history-server.sh\n</code></pre><p>å¥½å•¦ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œä¸€åˆ‡å‡†å¤‡å°±ç»ªã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬å¯åŠ¨spark-shellï¼Œå¹¶æäº¤â€œå€ç‡è®¡ç®—â€çš„ä»£ç ï¼Œç„¶åæŠŠç›®å…‰è½¬ç§»åˆ°Host1çš„8080ç«¯å£ï¼Œä¹Ÿå°±æ˜¯Driveræ‰€åœ¨èŠ‚ç‚¹çš„8080ç«¯å£ã€‚</p><h2>Spark UI ä¸€çº§å…¥å£</h2><p>ä»Šå¤©çš„æ•…äº‹ï¼Œè¦ä»Spark UIçš„å…¥å£å¼€å§‹ï¼Œå…¶å®åˆšæ‰è¯´çš„8080ç«¯å£æ­£æ˜¯Spark UIçš„å…¥å£ï¼Œæˆ‘ä»¬å¯ä»¥ä»è¿™é‡Œè¿›å…¥Spark UIã€‚</p><p>æ‰“å¼€Spark UIï¼Œé¦–å…ˆæ˜ å…¥çœ¼å¸˜çš„æ˜¯é»˜è®¤çš„Jobsé¡µé¢ã€‚Jobsé¡µé¢è®°å½•ç€åº”ç”¨ä¸­æ¶‰åŠçš„ActionsåŠ¨ä½œï¼Œä»¥åŠä¸æ•°æ®è¯»å–ã€ç§»åŠ¨æœ‰å…³çš„åŠ¨ä½œã€‚å…¶ä¸­ï¼Œæ¯ä¸€ä¸ªActionéƒ½å¯¹åº”ç€ä¸€ä¸ªJobï¼Œè€Œæ¯ä¸€ä¸ªJobéƒ½å¯¹åº”ç€ä¸€ä¸ªä½œä¸šã€‚æˆ‘ä»¬ä¸€ä¼šå†å»å¯¹Jobsé¡µé¢åšå±•å¼€ï¼Œç°åœ¨å…ˆæŠŠç›®å…‰é›†ä¸­åœ¨Spark UIæœ€ä¸Šé¢çš„å¯¼èˆªæ¡ï¼Œè¿™é‡Œç½—åˆ—ç€Spark UIæ‰€æœ‰çš„ä¸€çº§å…¥å£ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/56/d2/56563537c4e0ef597629d42618df21d2.png?wh=718x52\" alt=\"å›¾ç‰‡\" title=\"Spark UIå¯¼èˆªæ¡ï¼šä¸€çº§å…¥å£\"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå¯¼èˆªæ¡æœ€å·¦ä¾§æ˜¯Spark Logoä»¥åŠç‰ˆæœ¬å·ï¼Œåé¢åˆ™ä¾æ¬¡ç½—åˆ—ç€6ä¸ªä¸€çº§å…¥å£ï¼Œæ¯ä¸ªå…¥å£çš„åŠŸèƒ½ä¸ä½œç”¨æˆ‘æ•´ç†åˆ°äº†å¦‚ä¸‹çš„è¡¨æ ¼ä¸­ï¼Œä½ å¯ä»¥å…ˆæ•´ä½“è¿‡ä¸€ä¸‹ï¼Œåé¢æˆ‘ä»¬å†æŒ¨ä¸ªç»†è®²ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/yy/69/yy40a1yy06a4237dc691e197fa737569.jpg?wh=1920x811\" alt=\"\" title=\"ä¸€çº§å…¥å£ç®€ä»‹\"></p><p>å½¢è±¡ç‚¹è¯´ï¼Œè¿™6ä¸ªä¸åŒçš„å…¥å£ï¼Œå°±åƒæ˜¯ä½“æ£€æŠ¥å‘Šä¸­6å¤§ç±»ä¸åŒçš„ä½“æ£€é¡¹ï¼Œæ¯”å¦‚å†…ç§‘ã€å¤–ç§‘ã€è¡€å¸¸è§„ï¼Œç­‰ç­‰ã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ä¾æ¬¡ç¿»å¼€â€œä½“æ£€æŠ¥å‘Šâ€çš„æ¯ä¸€ä¸ªå¤§é¡¹ï¼Œå»çœ‹çœ‹â€œå€ç‡è®¡ç®—â€è¿™ä¸ªå®¶ä¼™çš„ä½“è´¨å¦‚ä½•ã€‚</p><p>ä¸è¿‡ï¼Œæœ¬ç€ç”±ç®€å…¥éš¾çš„åŸåˆ™ï¼Œå’±ä»¬å¹¶ä¸ä¼šæŒ‰ç…§Spark UIç½—åˆ—çš„é¡ºåºå»æŸ¥çœ‹å„ä¸ªå…¥å£ï¼Œ<strong>è€Œæ˜¯æŒ‰ç…§Executors &gt; Environment &gt; Storage &gt; SQL &gt; Jobs &gt; Stagesçš„é¡ºåºï¼Œå»ç¿»çœ‹â€œä½“æ£€æŠ¥å‘Šâ€</strong>ã€‚</p><p>å…¶ä¸­ï¼Œå‰3ä¸ªå…¥å£éƒ½æ˜¯è¯¦æƒ…é¡µï¼Œä¸å­˜åœ¨äºŒçº§å…¥å£ï¼›è€Œå3ä¸ªå…¥å£éƒ½æ˜¯é¢„è§ˆé¡µï¼Œéƒ½éœ€è¦è®¿é—®äºŒçº§å…¥å£ï¼Œæ‰èƒ½è·å–æ›´åŠ è¯¦ç»†çš„å†…å®¹ã€‚æ˜¾ç„¶ï¼Œç›¸æ¯”é¢„è§ˆé¡µï¼Œè¯¦æƒ…é¡µæ¥å¾—æ›´åŠ ç›´æ¥ã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ä»Executorså¼€å§‹ï¼Œå…ˆæ¥äº†è§£ä¸€ä¸‹åº”ç”¨çš„è®¡ç®—è´Ÿè½½ã€‚</p><h4>Executors</h4><p>Executors Tabçš„ä¸»è¦å†…å®¹å¦‚ä¸‹ï¼Œä¸»è¦åŒ…å«â€œSummaryâ€å’Œâ€œExecutorsâ€ä¸¤éƒ¨åˆ†ã€‚è¿™ä¸¤éƒ¨åˆ†æ‰€è®°å½•çš„åº¦é‡æŒ‡æ ‡æ˜¯ä¸€è‡´çš„ï¼Œå…¶ä¸­â€œExecutorsâ€ä»¥æ›´ç»†çš„ç²’åº¦è®°å½•ç€æ¯ä¸€ä¸ªExecutorçš„è¯¦æƒ…ï¼Œè€Œç¬¬ä¸€éƒ¨åˆ†â€œSummaryâ€æ˜¯ä¸‹é¢æ‰€æœ‰Executorsåº¦é‡æŒ‡æ ‡çš„ç®€å•åŠ å’Œã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/05/7a/05769aed159ab5a49e336451a9c5ed7a.png?wh=1920x807\" alt=\"å›¾ç‰‡\" title=\"Executorsè¯¦æƒ…é¡µ\"></p><p>æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹ï¼ŒSpark UIéƒ½æä¾›äº†å“ªäº›Metricsï¼Œæ¥é‡åŒ–æ¯ä¸€ä¸ªExecutorçš„å·¥ä½œè´Ÿè½½ï¼ˆWorkloadï¼‰ã€‚ä¸ºäº†å™è¿°æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä»¥è¡¨æ ¼çš„å½¢å¼è¯´æ˜è¿™äº›Metricsçš„å«ä¹‰ä¸ä½œç”¨ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f7/c8/f7373c0616470bde9eb282eefb64a2c8.jpg?wh=1920x1126\" alt=\"å›¾ç‰‡\" title=\"Executor Metrics\"></p><p>ä¸éš¾å‘ç°ï¼ŒExecutorsé¡µé¢æ¸…æ¸…æ¥šæ¥šåœ°è®°å½•ç€æ¯ä¸€ä¸ªExecutoræ¶ˆè€—çš„æ•°æ®é‡ï¼Œä»¥åŠå®ƒä»¬å¯¹CPUã€å†…å­˜ä¸ç£ç›˜ç­‰ç¡¬ä»¶èµ„æºçš„æ¶ˆè€—ã€‚åŸºäºè¿™äº›ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åˆ¤æ–­ä¸åŒExecutorsä¹‹é—´æ˜¯å¦å­˜åœ¨è´Ÿè½½ä¸å‡è¡¡çš„æƒ…å†µï¼Œè¿›è€Œåˆ¤æ–­åº”ç”¨ä¸­æ˜¯å¦å­˜åœ¨æ•°æ®å€¾æ–œçš„éšæ‚£ã€‚</p><p>å¯¹äºExecutorsé¡µé¢ä¸­æ¯ä¸€ä¸ªMetricsçš„å…·ä½“æ•°å€¼ï¼Œå®ƒä»¬å®é™…ä¸Šæ˜¯Tasksæ‰§è¡ŒæŒ‡æ ‡åœ¨Executorsç²’åº¦ä¸Šçš„æ±‡æ€»ã€‚å› æ­¤ï¼Œå¯¹äºè¿™äº›Metricsçš„é‡Šä¹‰ï¼Œå’±ä»¬ç•™åˆ°StagesäºŒçº§å…¥å£å†å»å±•å¼€ï¼Œè¿™é‡Œæš‚æ—¶ä¸åšä¸€ä¸€æ·±å…¥ã€‚ä½ ä¸å¦¨ç»“åˆâ€œå€ç‡è®¡ç®—â€çš„åº”ç”¨ï¼Œå»æµè§ˆä¸€ä¸‹ä¸åŒMetricsçš„å…·ä½“æ•°å€¼ï¼Œå…ˆå¯¹è¿™äº›æ•°å­—æœ‰ä¸€ä¸ªç›´è§‚ä¸Šçš„æ„Ÿå—ã€‚</p><p>å®é™…ä¸Šï¼Œè¿™äº›å…·ä½“çš„æ•°å€¼ï¼Œå¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„ï¼Œé™¤äº†RDD Blockså’ŒComplete Tasksè¿™ä¸¤ä¸ªMetricsã€‚ç»†çœ‹ä¸€ä¸‹è¿™ä¸¤ä¸ªæŒ‡æ ‡ï¼Œä½ ä¼šå‘ç°ï¼ŒRDD Blocksæ˜¯51ï¼ˆæ€»æ•°ï¼‰ï¼Œè€ŒComplete Tasksï¼ˆæ€»æ•°ï¼‰æ˜¯862ã€‚</p><p>ä¹‹å‰è®²RDDå¹¶è¡Œåº¦çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¯´è¿‡ï¼ŒRDDå¹¶è¡Œåº¦å°±æ˜¯RDDçš„åˆ†åŒºæ•°é‡ï¼Œæ¯ä¸ªåˆ†åŒºå¯¹åº”ç€ä¸€ä¸ªTaskï¼Œå› æ­¤RDDå¹¶è¡Œåº¦ä¸åˆ†åŒºæ•°é‡ã€åˆ†å¸ƒå¼ä»»åŠ¡æ•°é‡æ˜¯ä¸€è‡´çš„ã€‚å¯æ˜¯ï¼Œæˆªå›¾ä¸­çš„51ä¸862ï¼Œ<strong>æ˜¾ç„¶ä¸åœ¨ä¸€ä¸ªé‡çº§</strong>ï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ</p><p>è¿™é‡Œæˆ‘å…ˆä¹°ä¸ªå…³å­ï¼ŒæŠŠå®ƒç»™ä½ ç•™ä½œæ€è€ƒé¢˜ï¼Œä½ ä¸å¦¨èŠ±äº›æ—¶é—´ï¼Œå»å¥½å¥½æƒ³ä¸€æƒ³ã€‚å¦‚æœæ²¡æƒ³æ¸…æ¥šä¹Ÿæ²¡å…³ç³»ï¼Œæˆ‘ä»¬åœ¨è¯„è®ºåŒºä¼šç»§ç»­è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚</p><h4>Environment</h4><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥è¯´è¯´Environmentã€‚é¡¾åæ€ä¹‰ï¼ŒEnvironmenté¡µé¢è®°å½•çš„æ˜¯å„ç§å„æ ·çš„ç¯å¢ƒå˜é‡ä¸é…ç½®é¡¹ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/83/79/83byy2288931250e79354dec06cyy079.png?wh=1920x1200\" alt=\"å›¾ç‰‡\" title=\"Environmentè¯¦æƒ…é¡µ\"></p><p>ä¸ºäº†è®©ä½ æŠ“ä½ä¸»çº¿ï¼Œæˆ‘å¹¶æ²¡æœ‰ç»™ä½ å±•ç¤ºEnvironmenté¡µé¢æ‰€åŒ…å«çš„å…¨éƒ¨ä¿¡æ¯ï¼Œå°±ç±»åˆ«æ¥è¯´ï¼Œå®ƒåŒ…å«5å¤§ç±»ç¯å¢ƒä¿¡æ¯ï¼Œä¸ºäº†æ–¹ä¾¿å™è¿°ï¼Œæˆ‘æŠŠå®ƒä»¬ç½—åˆ—åˆ°äº†ä¸‹é¢çš„è¡¨æ ¼ä¸­ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/c9/4f/c9596275686485e8a9200b91403b584f.jpg?wh=1699x757\" alt=\"å›¾ç‰‡\" title=\"Environment Metrics\"></p><p>æ˜¾ç„¶ï¼Œè¿™5ç±»ä¿¡æ¯ä¸­ï¼ŒSpark Propertiesæ˜¯é‡ç‚¹ï¼Œå…¶ä¸­è®°å½•ç€æ‰€æœ‰åœ¨è¿è¡Œæ—¶ç”Ÿæ•ˆçš„Sparké…ç½®é¡¹è®¾ç½®ã€‚é€šè¿‡Spark Propertiesï¼Œæˆ‘ä»¬å¯ä»¥ç¡®è®¤è¿è¡Œæ—¶çš„è®¾ç½®ï¼Œä¸æˆ‘ä»¬é¢„æœŸçš„è®¾ç½®æ˜¯å¦ä¸€è‡´ï¼Œä»è€Œæ’é™¤å› é…ç½®é¡¹è®¾ç½®é”™è¯¯è€Œå¯¼è‡´çš„ç¨³å®šæ€§æˆ–æ˜¯æ€§èƒ½é—®é¢˜ã€‚</p><h4>Storage</h4><p>è¯´å®ŒExecutorsä¸Environmentï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€çº§å…¥å£çš„æœ€åä¸€ä¸ªè¯¦æƒ…é¡µï¼šStorageã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/ff/5b/ff84db596c0c988422e3dfa86a3b865b.png?wh=1920x485\" alt=\"å›¾ç‰‡\" title=\"Storageè¯¦æƒ…é¡µ\"></p><p>Storageè¯¦æƒ…é¡µï¼Œè®°å½•ç€æ¯ä¸€ä¸ªåˆ†å¸ƒå¼ç¼“å­˜ï¼ˆRDD Cacheã€DataFrame Cacheï¼‰çš„ç»†èŠ‚ï¼ŒåŒ…æ‹¬ç¼“å­˜çº§åˆ«ã€å·²ç¼“å­˜çš„åˆ†åŒºæ•°ã€ç¼“å­˜æ¯”ä¾‹ã€å†…å­˜å¤§å°ä¸ç£ç›˜å¤§å°ã€‚</p><p>åœ¨<a href=\"https://time.geekbang.org/column/article/363445\">ç¬¬16è®²</a>ï¼Œæˆ‘ä»¬ä»‹ç»è¿‡Sparkæ”¯æŒçš„ä¸åŒç¼“å­˜çº§åˆ«ï¼Œå®ƒæ˜¯å­˜å‚¨ä»‹è´¨ï¼ˆå†…å­˜ã€ç£ç›˜ï¼‰ã€å­˜å‚¨å½¢å¼ï¼ˆå¯¹è±¡ã€åºåˆ—åŒ–å­—èŠ‚ï¼‰ä¸å‰¯æœ¬æ•°é‡çš„æ’åˆ—ç»„åˆã€‚å¯¹äºDataFrameæ¥è¯´ï¼Œé»˜è®¤çš„çº§åˆ«æ˜¯å•å‰¯æœ¬çš„Disk Memory Deserializedï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¹Ÿå°±æ˜¯å­˜å‚¨ä»‹è´¨ä¸ºå†…å­˜åŠ ç£ç›˜ï¼Œå­˜å‚¨å½¢å¼ä¸ºå¯¹è±¡çš„å•ä¸€å‰¯æœ¬å­˜å‚¨æ–¹å¼ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/cd/18/cd982cc408b3cdcef01018ab7e565718.jpg?wh=1920x570\" alt=\"å›¾ç‰‡\" title=\"Storage Metrics\"></p><p>Cached Partitionsä¸Fraction Cachedåˆ†åˆ«è®°å½•ç€æ•°æ®é›†æˆåŠŸç¼“å­˜çš„åˆ†åŒºæ•°é‡ï¼Œä»¥åŠè¿™äº›ç¼“å­˜çš„åˆ†åŒºå æ‰€æœ‰åˆ†åŒºçš„æ¯”ä¾‹ã€‚å½“Fraction Cachedå°äº100%çš„æ—¶å€™ï¼Œè¯´æ˜åˆ†å¸ƒå¼æ•°æ®é›†å¹¶æ²¡æœ‰å®Œå…¨ç¼“å­˜åˆ°å†…å­˜ï¼ˆæˆ–æ˜¯ç£ç›˜ï¼‰ï¼Œå¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬è¦è­¦æƒ•ç¼“å­˜æ¢å…¥æ¢å‡ºå¯èƒ½ä¼šå¸¦æ¥çš„æ€§èƒ½éšæ‚£ã€‚</p><p>åé¢çš„Size in Memoryä¸Size in Diskï¼Œåˆ™æ›´åŠ ç›´è§‚åœ°å±•ç¤ºäº†æ•°æ®é›†ç¼“å­˜åœ¨å†…å­˜ä¸ç¡¬ç›˜ä¸­çš„åˆ†å¸ƒã€‚ä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œç”±äºå†…å­˜å—é™ï¼ˆ3GB/Executorï¼‰ï¼Œæ‘‡å·æ•°æ®å‡ ä¹å…¨éƒ¨è¢«ç¼“å­˜åˆ°äº†ç£ç›˜ï¼Œåªæœ‰584MBçš„æ•°æ®ï¼Œç¼“å­˜åˆ°äº†å†…å­˜ä¸­ã€‚å¦ç™½åœ°è¯´ï¼Œè¿™æ ·çš„ç¼“å­˜ï¼Œå¯¹äºæ•°æ®é›†çš„é‡å¤è®¿é—®ï¼Œå¹¶æ²¡æœ‰å¸¦æ¥å®è´¨ä¸Šçš„æ€§èƒ½æ”¶ç›Šã€‚</p><p>åŸºäºStorageé¡µé¢æä¾›çš„è¯¦ç»†ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥æœ‰çš„æ”¾çŸ¢åœ°è®¾ç½®ä¸å†…å­˜æœ‰å…³çš„é…ç½®é¡¹ï¼Œå¦‚spark.executor.memoryã€spark.memory.fractionã€spark.memory.storageFractionï¼Œä»è€Œæœ‰é’ˆå¯¹æ€§å¯¹Storage Memoryè¿›è¡Œè°ƒæ•´ã€‚</p><h4>SQL</h4><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»§ç»­è¯´ä¸€çº§å…¥å£çš„SQLé¡µé¢ã€‚å½“æˆ‘ä»¬çš„åº”ç”¨åŒ…å«DataFrameã€Datasetæˆ–æ˜¯SQLçš„æ—¶å€™ï¼ŒSpark UIçš„SQLé¡µé¢ï¼Œå°±ä¼šå±•ç¤ºç›¸åº”çš„å†…å®¹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/dd/cb/dd3231ca21492ff00c63a111d96516cb.png?wh=1920x613\" alt=\"å›¾ç‰‡\" title=\"SQLæ¦‚è§ˆé¡µ\"></p><p>å…·ä½“æ¥è¯´ï¼Œä¸€çº§å…¥å£é¡µé¢ï¼Œä»¥Actionsä¸ºå•ä½ï¼Œè®°å½•ç€æ¯ä¸ªActionå¯¹åº”çš„Spark SQLæ‰§è¡Œè®¡åˆ’ã€‚æˆ‘ä»¬éœ€è¦ç‚¹å‡»â€œDescriptionâ€åˆ—ä¸­çš„è¶…é“¾æ¥ï¼Œæ‰èƒ½è¿›å…¥åˆ°äºŒçº§é¡µé¢ï¼Œå»äº†è§£æ¯ä¸ªæ‰§è¡Œè®¡åˆ’çš„è¯¦ç»†ä¿¡æ¯ã€‚è¿™éƒ¨åˆ†å†…å®¹ï¼Œæˆ‘ä»¬ç•™åˆ°ä¸‹ä¸€è®²çš„äºŒçº§å…¥å£è¯¦æƒ…é¡µå†å»å±•å¼€ã€‚</p><h4>Jobs</h4><p>åŒç†ï¼Œå¯¹äºJobsé¡µé¢æ¥è¯´ï¼ŒSpark UIä¹Ÿæ˜¯ä»¥Actionsä¸ºç²’åº¦ï¼Œè®°å½•ç€æ¯ä¸ªActionå¯¹åº”ä½œä¸šçš„æ‰§è¡Œæƒ…å†µã€‚æˆ‘ä»¬æƒ³è¦äº†è§£ä½œä¸šè¯¦æƒ…ï¼Œä¹Ÿå¿…é¡»é€šè¿‡â€œDescriptionâ€é¡µé¢æä¾›çš„äºŒçº§å…¥å£é“¾æ¥ã€‚ä½ å…ˆæœ‰ä¸ªåˆæ­¥è®¤è¯†å°±å¥½ï¼Œä¸‹ä¸€è®²æˆ‘ä»¬å†å»å±•å¼€ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/84/4b/84b6f0188d39c7e268e1b5f68224144b.png?wh=1920x1200\" alt=\"å›¾ç‰‡\" title=\"Jobsæ¦‚è§ˆé¡µ\"><br>\nç›¸æ¯”SQLé¡µé¢çš„3ä¸ªActionsï¼šsaveï¼ˆä¿å­˜è®¡ç®—ç»“æœï¼‰ã€countï¼ˆç»Ÿè®¡ç”³è¯·ç¼–å·ï¼‰ã€countï¼ˆç»Ÿè®¡ä¸­ç­¾ç¼–å·ï¼‰ã€‚</p><p>ç»“åˆå‰é¢çš„æ¦‚è§ˆé¡µæˆªå›¾ä½ ä¼šå‘ç°ï¼ŒJobsé¡µé¢ä¼¼ä¹å‡­ç©ºå¤šå‡ºæ¥å¾ˆå¤šActionsã€‚ä¸»è¦åŸå› åœ¨äºï¼Œåœ¨Jobsé¡µé¢ï¼ŒSpark UIä¼šæŠŠæ•°æ®çš„è¯»å–ã€è®¿é—®ä¸ç§»åŠ¨ï¼Œä¹Ÿçœ‹ä½œæ˜¯ä¸€ç±»â€œActionsâ€ï¼Œæ¯”å¦‚å›¾ä¸­Job Idä¸º0ã€1ã€3ã€4çš„é‚£äº›ã€‚è¿™å‡ ä¸ªJobï¼Œå®é™…ä¸Šéƒ½æ˜¯åœ¨è¯»å–æºæ•°æ®ï¼ˆå…ƒæ•°æ®ä¸æ•°æ®é›†æœ¬èº«ï¼‰ã€‚</p><p>è‡³äºæœ€åå¤šå‡ºæ¥çš„ã€Job Idä¸º7çš„saveï¼Œä½ ä¸å¦¨ç»“åˆæœ€åä¸€è¡Œä»£ç ï¼Œå»æƒ³æƒ³é—®ä»€ä¹ˆã€‚è¿™é‡Œæˆ‘è¿˜æ˜¯æš‚æ—¶å–ä¸ªå…³å­ï¼Œç•™ç»™ä½ è¶³å¤Ÿçš„æ—¶é—´å»æ€è€ƒï¼Œå’±ä»¬è¯„è®ºåŒºè§ã€‚</p><pre><code class=\"language-scala\">result05_01.write.mode(\"Overwrite\").format(\"csv\").save(s\"${rootPath}/results/result05_01\")\n</code></pre><h4>Stages</h4><p>æˆ‘ä»¬çŸ¥é“ï¼Œæ¯ä¸€ä¸ªä½œä¸šï¼Œéƒ½åŒ…å«å¤šä¸ªé˜¶æ®µï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„Stagesã€‚åœ¨Stagesé¡µé¢ï¼ŒSpark UIç½—åˆ—äº†åº”ç”¨ä¸­æ¶‰åŠçš„æ‰€æœ‰Stagesï¼Œè¿™äº›Stagesåˆ†å±äºä¸åŒçš„ä½œä¸šã€‚è¦æƒ³æŸ¥çœ‹å“ªäº›Stageséš¶å±äºå“ªä¸ªJobï¼Œè¿˜éœ€è¦ä»Jobsçš„DescriptionsäºŒçº§å…¥å£è¿›å…¥æŸ¥çœ‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/71/7d/71cd54b597be76a1c900864661e3227d.png?wh=1920x1200\" alt=\"å›¾ç‰‡\" title=\"Stagesæ¦‚è§ˆé¡µ\"></p><p>Stagesé¡µé¢ï¼Œæ›´å¤šåœ°æ˜¯ä¸€ç§é¢„è§ˆï¼Œè¦æƒ³æŸ¥çœ‹æ¯ä¸€ä¸ªStageçš„è¯¦æƒ…ï¼ŒåŒæ ·éœ€è¦ä»â€œDescriptionâ€è¿›å…¥Stageè¯¦æƒ…é¡µï¼ˆä¸‹ä¸€è®²è¯¦ç»†å±•å¼€ï¼‰ã€‚</p><p>å¥½å•¦ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œå¯¹äºå¯¼èˆªæ¡ä¸­çš„ä¸åŒé¡µé¢ï¼Œæˆ‘ä»¬éƒ½åšäº†ä¸åŒç¨‹åº¦çš„å±•å¼€ã€‚ç®€å•æ±‡æ€»ä¸‹æ¥ï¼Œå…¶ä¸­<strong>Executorsã€Environmentã€Storageæ˜¯è¯¦æƒ…é¡µï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡è¿™3ä¸ªé¡µé¢ï¼Œè¿…é€Ÿåœ°äº†è§£é›†ç¾¤æ•´ä½“çš„è®¡ç®—è´Ÿè½½ã€è¿è¡Œç¯å¢ƒï¼Œä»¥åŠæ•°æ®é›†ç¼“å­˜çš„è¯¦ç»†æƒ…å†µï¼›è€ŒSQLã€Jobsã€Stagesï¼Œæ›´å¤šåœ°æ˜¯ä¸€ç§ç½—åˆ—å¼çš„å±•ç¤ºï¼Œæƒ³è¦äº†è§£å…¶ä¸­çš„ç»†èŠ‚ï¼Œè¿˜éœ€è¦è¿›å…¥åˆ°äºŒçº§å…¥å£</strong>ã€‚</p><p>æ­£å¦‚å¼€ç¯‡æ‰€è¯´ï¼ŒäºŒçº§å…¥å£çš„è®²è§£ï¼Œæˆ‘ä»¬ç•™åˆ°ä¸‹ä¸€è®²å†å»æ¢è®¨ï¼Œæ•¬è¯·æœŸå¾…ã€‚</p><h2>é‡ç‚¹å›é¡¾</h2><p>å¥½å•¦ï¼Œä»Šå¤©çš„è¯¾ç¨‹ï¼Œåˆ°è¿™é‡Œå°±è®²å®Œå•¦ã€‚ä»Šå¤©çš„å†…å®¹æ¯”è¾ƒå¤šï¼Œæ¶‰åŠçš„Metricsçº·ç¹è€Œåˆå¤æ‚ï¼Œä»…ä»…å¬ä¸€éæˆ‘çš„è®²è§£ï¼Œè¿˜è¿œè¿œä¸å¤Ÿï¼Œè¿˜éœ€è¦ä½ ç»“åˆæ—¥å¸¸çš„å¼€å‘ï¼Œå»å¤šå¤šæ‘¸ç´¢ä¸ä½“ä¼šï¼ŒåŠ æ²¹ï¼</p><p>ä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»ç®€å•ã€ç›´æ¥çš„ä¸€çº§å…¥å£å…¥æ‰‹ï¼ŒæŒ‰ç…§â€œExecutors -&gt; Environment -&gt; Storage -&gt; SQL -&gt; Jobs -&gt; Stagesâ€çš„é¡ºåºï¼Œå…ˆåä»‹ç»äº†ä¸€çº§å…¥å£çš„è¯¦æƒ…é¡µä¸æ¦‚è§ˆé¡µã€‚å¯¹äºè¿™äº›é¡µé¢ä¸­çš„å†…å®¹ï¼Œæˆ‘æŠŠéœ€è¦é‡ç‚¹æŒæ¡çš„éƒ¨åˆ†ï¼Œæ•´ç†åˆ°äº†å¦‚ä¸‹è¡¨æ ¼ï¼Œä¾›ä½ éšæ—¶å‚è€ƒã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e3/c7/e324fa0b2db69499d951290dc4351bc7.jpg?wh=1920x811\" alt=\"å›¾ç‰‡\"></p><h2>æ¯è¯¾ä¸€ç»ƒ</h2><p>ä»Šå¤©çš„æ€è€ƒé¢˜ï¼Œæˆ‘ä»¬åœ¨è¯¾ç¨‹ä¸­å·²ç»æè¿‡äº†ã€‚ä¸€ä¸ªæ˜¯åœ¨Executorsé¡µé¢ï¼Œä¸ºä»€ä¹ˆRDD Blocksä¸Complete Tasksçš„æ•°é‡ä¸ä¸€è‡´ã€‚ç¬¬äºŒä¸ªæ˜¯ï¼Œåœ¨Jobsé¡µé¢ï¼Œä¸ºä»€ä¹ˆæœ€åä¼šå¤šå‡ºæ¥ä¸€ä¸ªsave Actionï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºè·Ÿæˆ‘äº¤æµæ¢è®¨ï¼Œä¹Ÿæ¬¢è¿æ¨èä½ æŠŠè¿™ä¸€è®²åˆ†äº«ç»™æœ‰éœ€è¦çš„æœ‹å‹ã€åŒäº‹ã€‚</p>","comments":[{"had_liked":false,"id":318294,"user_name":"Hiway","can_delete":false,"product_type":"c1","uid":1169895,"ip_address":"","ucode":"3E97C70A04018C","user_header":"https://static001.geekbang.org/account/avatar/00/11/d9/e7/45d9e964.jpg","comment_is_top":false,"comment_ctime":1635234695,"is_pvip":false,"replies":[{"id":"115581","content":"ä¸å¤ªå¯¹å“ˆ~<br><br>æ ‡å‡†ç­”æ¡ˆæ˜¯ï¼š<br><br>ç¬¬ä¸€ä¸ªï¼šæ¯ä¸ªrddç»è¿‡å¤„ç†åï¼Œåˆå¯èƒ½ç”Ÿæˆå…¶ä»–rddï¼Œè¿™é‡Œçš„tasksæ˜¾ç¤ºçš„æ˜¯æ•´ä¸ªexecutorså¤„ç†è¿‡çš„ä»»åŠ¡æ•°ï¼Œè·Ÿrdd cacheçš„blocksæ— å…³ã€‚<br><br>ç¬¬äºŒä¸ªï¼šå› ä¸ºä»£ç æœ€åä¸€ä¸ªæ˜¯saveï¼Œè€Œsaveçš„modeæ˜¯overwriteï¼Œsaveæœ¬èº«ä¼šæœ‰ä¸€ä¸ªactionï¼Œè€Œoverwriteçš„è¿‡ç¨‹ï¼Œå®é™…ä¸Šæ˜¯å…ˆåœ¨ä¸´æ—¶æ–‡ä»¶å¤¹ç”Ÿæˆæ•°æ®ï¼Œç„¶åå†moveåˆ°ç›®æ ‡æ–‡ä»¶å¤¹ï¼Œæœ‰ä¸€ä¸ªæ•°æ®ç§»åŠ¨çš„åŠ¨ä½œï¼Œæ‰€ä»¥Sparkä¹ŸæŠŠå®ƒç®—åšäº†ä¸€ä¸ªActionã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1635429588,"ip_address":"","comment_id":318294,"utype":1}],"discussion_count":2,"race_medal":0,"score":"44584907655","product_id":100073401,"comment_content":"ç¬¬ä¸€é—®ï¼šæˆ‘çš„ç†è§£æ˜¯RDD Blocksè¡¨ç¤ºçš„æ˜¯è¯»å…¥æ•°æ®é›†æ—¶çš„åˆ†åŒºæ•°ï¼Œè€ŒComplete Tasksåˆ™è¡¨ç¤ºæ•´ä¸ªjobå®Œæˆæ—¶è¯¥Executorå®Œæˆçš„Taskæ•°ã€‚æˆ‘è§‰å¾—åŸå› æœ‰äºŒï¼š<br>ä¸€æ˜¯sparkåœ¨åˆ’åˆ†DAGæ—¶ï¼Œé‡åˆ°shuffleä¾¿ä¼šæ–­å¼€äº§ç”Ÿæ–°çš„Stageï¼Œä¸€ä¸ªtaskåªæ˜¯å¯¹åº”ä¸€ä¸ªstageé‡Œçš„ä¸€ä¸ªpartitionã€‚<br>äºŒæ˜¯å¦‚æœæœªä¿®æ”¹spark.sql.shuffle.partitionsé…ç½®ï¼Œåœ¨joinçš„æ—¶å€™å°±ä¼šè‡ªåŠ¨ä¿®æ”¹ä¸º200çš„å¹¶è¡Œåº¦ï¼Œå¯¹åº”çš„ä¸‹ä¸€ä¸ªStageä¹Ÿå°±äº§ç”Ÿäº†200ä¸ªtask<br><br>ç¬¬äºŒé—®ï¼šä»Executorsç•Œé¢çœ‹ï¼Œåº”è¯¥æ˜¯ä¸¤ä¸ªExecutoråœ¨è·‘ã€‚å› ä¸ºæ˜¯åˆ†å¸ƒå¼æ‰€ä»¥åœ¨æœ€åwriteçš„æ—¶å€™ï¼Œä¸¤ä¸ªExecutoréƒ½è¿›è¡Œäº†saveæ“ä½œã€‚è‡³äºä¸ºä»€ä¹ˆæ˜¯ä¸¤å°Executorè·‘ï¼Œåº”è¯¥è¿™æ ·è®¡ç®—å‡ºæ¥çš„ï¼šexecutor æ•°é‡ = spark.cores.max&#47;spark.executor.cores<br><br>è€å¸ˆï¼Œæ˜¯è¿™æ ·å—ï¼Ÿå¯ä»¥å‘ä¸€ä¸‹ä½ çš„spark-submitå‘½ä»¤å˜›?","like_count":11,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529174,"discussion_content":"ä¸å¤ªå¯¹å“ˆ~\n\næ ‡å‡†ç­”æ¡ˆæ˜¯ï¼š\n\nç¬¬ä¸€ä¸ªï¼šæ¯ä¸ªrddç»è¿‡å¤„ç†åï¼Œåˆå¯èƒ½ç”Ÿæˆå…¶ä»–rddï¼Œè¿™é‡Œçš„tasksæ˜¾ç¤ºçš„æ˜¯æ•´ä¸ªexecutorså¤„ç†è¿‡çš„ä»»åŠ¡æ•°ï¼Œè·Ÿrdd cacheçš„blocksæ— å…³ã€‚\n\nç¬¬äºŒä¸ªï¼šå› ä¸ºä»£ç æœ€åä¸€ä¸ªæ˜¯saveï¼Œè€Œsaveçš„modeæ˜¯overwriteï¼Œsaveæœ¬èº«ä¼šæœ‰ä¸€ä¸ªactionï¼Œè€Œoverwriteçš„è¿‡ç¨‹ï¼Œå®é™…ä¸Šæ˜¯å…ˆåœ¨ä¸´æ—¶æ–‡ä»¶å¤¹ç”Ÿæˆæ•°æ®ï¼Œç„¶åå†moveåˆ°ç›®æ ‡æ–‡ä»¶å¤¹ï¼Œæœ‰ä¸€ä¸ªæ•°æ®ç§»åŠ¨çš„åŠ¨ä½œï¼Œæ‰€ä»¥Sparkä¹ŸæŠŠå®ƒç®—åšäº†ä¸€ä¸ªActionã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635429588,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1028358,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b1/06/b62be1b8.jpg","nickname":"æœ±ç£Š","note":"","ucode":"319D61D18DDA87","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":551254,"discussion_content":"è€å¸ˆï¼Œå¾ˆæƒ³çŸ¥é“æ‚¨çš„è¿™äº›çŸ¥è¯†éƒ½æ˜¯æ€ä¹ˆè·å–åˆ°çš„ï¼Œé€šè¿‡sparkçš„æºç å—ï¼Ÿè¿˜æ˜¯æœ‰æ–‡æ¡£æˆ–è€…åˆ«äººæ–‡ç« ä¸Šæœ‰è¿™äº›ä¸œè¥¿ï¼Œæˆ‘ç”¨äº†ä¸€å¹´sparkäº†ï¼Œä½†æ˜¯æ‚¨è¯´çš„è¿™ä¸¤ä¸ªé—®é¢˜æˆ‘éƒ½ä¸çŸ¥é“ç­”æ¡ˆï¼Œä¹Ÿä¸çŸ¥é“æ€ä¹ˆæ‰èƒ½å¾—åˆ°ç­”æ¡ˆã€‚ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1644940181,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":529174,"ip_address":""},"score":551254,"extra":""}]}]},{"had_liked":false,"id":317913,"user_name":"onepieceJT2018","can_delete":false,"product_type":"c1","uid":1112182,"ip_address":"","ucode":"C8C214C3D5D285","user_header":"https://static001.geekbang.org/account/avatar/00/10/f8/76/3db69173.jpg","comment_is_top":false,"comment_ctime":1635049778,"is_pvip":true,"replies":[{"id":"115467","content":"Storageé¡µé¢æ˜¯ç”¨æ¥æ˜¾ç¤ºåˆ†å¸ƒå¼æ•°æ®é›†ç¼“å­˜çš„ï¼Œæ¯”å¦‚RDD Cacheã€DataFrame Cacheï¼Œç­‰ç­‰ã€‚<br><br>Hive on Sparkçš„é›†æˆä¸­ï¼ŒSparkä¸MapReduceã€Tezéƒ½æ˜¯åŒç­‰çš„åœ°ä½ï¼Œéƒ½æ˜¯æ‰§è¡Œå¼•æ“ï¼Œè€Œä¸”ä¸€èˆ¬Hive SQLä¸­ï¼Œå¹¶ä¸å­˜åœ¨åˆ†å¸ƒå¼æ•°æ®é›†ç¼“å­˜çš„æ¦‚å¿µï¼Œæ‰€ä»¥Storageé¢æ¿ç©ºç©ºå¦‚ä¹Ÿå€’æ˜¯ä¹Ÿä¸è¶³ä¸ºæ€ª~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1635261266,"ip_address":"","comment_id":317913,"utype":1}],"discussion_count":1,"race_medal":3,"score":"23109886258","product_id":100073401,"comment_content":"ä¸çŸ¥é“ä¸ºä»€ä¹ˆ hive on sparkçš„è¯ uié‡Œé¢storage è¿™ä¸ªé¢æ¿æ˜¯ç©ºç™½","like_count":5,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529027,"discussion_content":"Storageé¡µé¢æ˜¯ç”¨æ¥æ˜¾ç¤ºåˆ†å¸ƒå¼æ•°æ®é›†ç¼“å­˜çš„ï¼Œæ¯”å¦‚RDD Cacheã€DataFrame Cacheï¼Œç­‰ç­‰ã€‚\n\nHive on Sparkçš„é›†æˆä¸­ï¼ŒSparkä¸MapReduceã€Tezéƒ½æ˜¯åŒç­‰çš„åœ°ä½ï¼Œéƒ½æ˜¯æ‰§è¡Œå¼•æ“ï¼Œè€Œä¸”ä¸€èˆ¬Hive SQLä¸­ï¼Œå¹¶ä¸å­˜åœ¨åˆ†å¸ƒå¼æ•°æ®é›†ç¼“å­˜çš„æ¦‚å¿µï¼Œæ‰€ä»¥Storageé¢æ¿ç©ºç©ºå¦‚ä¹Ÿå€’æ˜¯ä¹Ÿä¸è¶³ä¸ºæ€ª~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635261266,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":319212,"user_name":"Reiser","can_delete":false,"product_type":"c1","uid":1078669,"ip_address":"","ucode":"E5DBBBA2F86FCE","user_header":"https://static001.geekbang.org/account/avatar/00/10/75/8d/c6a2a048.jpg","comment_is_top":false,"comment_ctime":1635677360,"is_pvip":true,"replies":[{"id":"115717","content":"å“ˆå“ˆï¼Œè€å¼Ÿå–œæ¬¢å°±å¥½~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1635684037,"ip_address":"","comment_id":319212,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18815546544","product_id":100073401,"comment_content":"å‘¨æœ«å›çœ‹ä¹‹å‰çš„æ–‡ç« ï¼Œçœ‹åˆ°è¿™ç¯‡åŠ é¤æœ‰ç‚¹æ„ŸåŠ¨ã€‚å¤ªèµ°å¿ƒäº†ï¼Œç£Šå“¥ï¼","like_count":4,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529545,"discussion_content":"å“ˆå“ˆï¼Œè€å¼Ÿå–œæ¬¢å°±å¥½~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635684037,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":331793,"user_name":"LR.ÑĞ³ Â®","can_delete":false,"product_type":"c1","uid":2717560,"ip_address":"","ucode":"8C91AB8FF1AEEE","user_header":"https://static001.geekbang.org/account/avatar/00/29/77/78/e241fe80.jpg","comment_is_top":false,"comment_ctime":1642760803,"is_pvip":false,"replies":[{"id":"121404","content":"æœ‰çš„ï¼Œä¸è¿‡è¿™ä¸ªé™åˆ¶ï¼Œä¸æ˜¯åœ¨Sparkå±‚é¢åšçš„ã€‚ä¸€èˆ¬åœ¨å·¥ä¸šçº§ï¼ŒSparkä¸€èˆ¬éƒ½æ˜¯ç”¨YARNæ¥è°ƒåº¦ï¼ŒYARNé‡Œé¢å¯ä»¥è®¾ç½®èµ„æºé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—å†…éƒ¨ï¼Œå¯ä»¥é™åˆ¶å¯ç”¨èµ„æºæ€»é‡ï¼Œä¸åŒç±»å‹çš„ä½œä¸šï¼Œæ¯”å¦‚æ‰¹å¤„ç†ã€æµè®¡ç®—ï¼Œå¾€å¾€æ˜¯ä¼šå•ç‹¬åˆ›å»ºé˜Ÿåˆ—æ¥æœåŠ¡ã€‚æ‰€ä»¥å›ç­”ä½ çš„é—®é¢˜ï¼Œå¯ä»¥è®©è¿è¥å›¢é˜Ÿè®¾ç½®ä¸åŒçš„èµ„æºé˜Ÿåˆ—ï¼Œä»è€Œè¾¾åˆ°èµ„æºéš”ç¦»çš„ç›®çš„~","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1043100","ctime":1643189212,"ip_address":"","comment_id":331793,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10232695395","product_id":100073401,"comment_content":"æœ‰ä¸€ä¸ªåˆ«çš„ç»„åŒäº‹ï¼Œæ¯æ¬¡å¯åŠ¨sparkéƒ½ä¼šæŠŠèµ„æºç”³è¯·å®Œï¼Œä»–çš„éƒ¨åˆ†å¯åŠ¨å‘½ä»¤å¦‚ä¸‹ï¼š --executor-memory 6G --num-executors 2000 --executor-cores 4ã€‚å¯¼è‡´æˆ‘æ¯æ¬¡éƒ½è¦å»killæ‰ä»–çš„applicationã€‚<br>è¯·é—®è€å¸ˆï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥é™åˆ¶å¯åŠ¨æ—¶ä¸å…è®¸ç”³è¯·è¿™ä¹ˆå¤šèµ„æºï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548424,"discussion_content":"æœ‰çš„ï¼Œä¸è¿‡è¿™ä¸ªé™åˆ¶ï¼Œä¸æ˜¯åœ¨Sparkå±‚é¢åšçš„ã€‚ä¸€èˆ¬åœ¨å·¥ä¸šçº§ï¼ŒSparkä¸€èˆ¬éƒ½æ˜¯ç”¨YARNæ¥è°ƒåº¦ï¼ŒYARNé‡Œé¢å¯ä»¥è®¾ç½®èµ„æºé˜Ÿåˆ—ï¼Œæ¯ä¸ªé˜Ÿåˆ—å†…éƒ¨ï¼Œå¯ä»¥é™åˆ¶å¯ç”¨èµ„æºæ€»é‡ï¼Œä¸åŒç±»å‹çš„ä½œä¸šï¼Œæ¯”å¦‚æ‰¹å¤„ç†ã€æµè®¡ç®—ï¼Œå¾€å¾€æ˜¯ä¼šå•ç‹¬åˆ›å»ºé˜Ÿåˆ—æ¥æœåŠ¡ã€‚æ‰€ä»¥å›ç­”ä½ çš„é—®é¢˜ï¼Œå¯ä»¥è®©è¿è¥å›¢é˜Ÿè®¾ç½®ä¸åŒçš„èµ„æºé˜Ÿåˆ—ï¼Œä»è€Œè¾¾åˆ°èµ„æºéš”ç¦»çš„ç›®çš„~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643189212,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1264318,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/be/7168674c.jpg","nickname":"é”æ„è¿›å–","note":"","ucode":"D38C42B6F61279","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583170,"discussion_content":"å•¥ä½œç”¨éœ€è¦é‚£ä¹ˆå¤šèµ„æºï¼Œæ¯ä¸ªå¼€å‘ä¸Šä¸šåŠ¡çš„æ—¶å€™ï¼Œéƒ½åº”è¯¥è§„åˆ’ä¸€ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659939084,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":322954,"user_name":"Unknown element","can_delete":false,"product_type":"c1","uid":2028277,"ip_address":"","ucode":"34A129800D0238","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f2/f5/b82f410d.jpg","comment_is_top":false,"comment_ctime":1637668549,"is_pvip":false,"replies":[{"id":"117435","content":"å¬ä¸Šå»ä¸å¤ªå¯¹ï¼Œä½ å¯ä»¥åŠ æˆ‘å¾®ä¿¡ï¼ŒæŠŠä»£ç å’Œæˆªå›¾å‘ç»™æˆ‘ï¼Œå’±ä»¬ä¸€èµ·çœ‹çœ‹ã€‚å¾®ä¿¡æœç´¢â€œæ–¹å—Kâ€æˆ–æ˜¯â€œrJuniorâ€","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1043100","ctime":1638066788,"ip_address":"","comment_id":322954,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5932635845","product_id":100073401,"comment_content":"è€å¸ˆæˆ‘çš„executorsé¡µé¢ä¸ºä»€ä¹ˆrdd blockséƒ½æ˜¯0ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533998,"discussion_content":"å¬ä¸Šå»ä¸å¤ªå¯¹ï¼Œä½ å¯ä»¥åŠ æˆ‘å¾®ä¿¡ï¼ŒæŠŠä»£ç å’Œæˆªå›¾å‘ç»™æˆ‘ï¼Œå’±ä»¬ä¸€èµ·çœ‹çœ‹ã€‚å¾®ä¿¡æœç´¢â€œæ–¹å—Kâ€æˆ–æ˜¯â€œrJuniorâ€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638066788,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1813026,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJO944A1HeBCrewW7YHE1Ha3OVWDEz8iaXwD23iczWrG9eG6deJ0dK5qD1qJuLB0u7LnU4ujtokvjAg/132","nickname":"keeprun","note":"","ucode":"0D1FBBB98567D0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540270,"discussion_content":"åŸå› æ˜¯å¦æ˜¯ä»£ç ä¸­æ²¡æœ‰ä½¿ç”¨rddç®—å­è®¡ç®—ï¼Ÿçœ‹æˆ‘è¿™è¾¹çš„æ‰§è¡Œè®°å½•ï¼Œçº¯SparkSQLçš„è®°å½•ï¼ŒRDD blockså‡ä¸º0ï¼Œè€Œä½¿ç”¨SparkCoreçš„æœ‰å…·ä½“çš„æ•°å€¼ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640004055,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2028277,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/f2/f5/b82f410d.jpg","nickname":"Unknown element","note":"","ucode":"34A129800D0238","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1813026,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJO944A1HeBCrewW7YHE1Ha3OVWDEz8iaXwD23iczWrG9eG6deJ0dK5qD1qJuLB0u7LnU4ujtokvjAg/132","nickname":"keeprun","note":"","ucode":"0D1FBBB98567D0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548061,"discussion_content":"æœ‰å¯èƒ½è¯¶ï¼Œæˆ‘è¿™è¾¹æ˜¯ç”¨hive sqlå¼€å‘çš„ï¼Œä½¿ç”¨beelineæäº¤åˆ°sparkè®¡ç®—ï¼Œåº”è¯¥æ˜¯å±äºspark with hiveçš„éƒ¨ç½²æ–¹å¼","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1643016325,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":540270,"ip_address":""},"score":548061,"extra":""}]}]},{"had_liked":false,"id":319226,"user_name":"jerry guo","can_delete":false,"product_type":"c1","uid":1267753,"ip_address":"","ucode":"179943AFCB93F8","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eo2GMhevabZrjINs2TKvIeGC7TJkicNlLvqTticuM5KL8ZN80OC2CnrsUyzPcZXO4uptj4Q1S4jT2lQ/132","comment_is_top":false,"comment_ctime":1635684742,"is_pvip":true,"replies":[{"id":"115722","content":"è¿è¡Œçš„æ—¶å€™Spark UIçœ‹8080ç«¯å£ï¼›è¿è¡Œç»“æŸä¹‹åï¼Œåœ¨å¼€å¯History serverçš„æƒ…å†µä¸‹ï¼Œçœ‹18080ç«¯å£~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1635687870,"ip_address":"","comment_id":319226,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5930652038","product_id":100073401,"comment_content":"spark sql jobçš„Storageé¡µé¢æ€ä¹ˆæ˜¯ç©ºç™½çš„å‘¢ï¼Ÿæ˜¯åªæœ‰è¿è¡Œçš„æ—¶å€™æ‰æœ‰æ•°æ®å—","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529550,"discussion_content":"è¿è¡Œçš„æ—¶å€™Spark UIçœ‹8080ç«¯å£ï¼›è¿è¡Œç»“æŸä¹‹åï¼Œåœ¨å¼€å¯History serverçš„æƒ…å†µä¸‹ï¼Œçœ‹18080ç«¯å£~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635687870,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":317110,"user_name":"Geek_01fccd","can_delete":false,"product_type":"c1","uid":2177406,"ip_address":"","ucode":"6D5D9C2882513F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/ia89MwaRSP6iaeQB4789roUntH7tia9EXyoDOnlibE8ABibAzFPiamP0SAU54NNTRiaVtkOtmLaWRH5OXbTOhUZl46scw/132","comment_is_top":false,"comment_ctime":1634690612,"is_pvip":false,"replies":[{"id":"115113","content":"æ˜¯çš„ï¼Œä¸åŒé¡µé¢çš„ç»Ÿè®¡ç»´åº¦ä¸åŒï¼Œæ‹¿Executorsé¡µé¢ä¸ºä¾‹ï¼Œå®ƒçš„ç»Ÿè®¡ç»´åº¦æ˜¯Executorsï¼Œç›¸å½“äºæŠŠå…¶ä»–ç»´åº¦ï¼ˆæ¯”å¦‚Jobsã€Stagesï¼‰å°±éƒ½æŠ¹æ‰äº†","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1634887799,"ip_address":"","comment_id":317110,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5929657908","product_id":100073401,"comment_content":"å¤šä¸ªjobå…¬ç”¨ä¸€ä¸ªexecuterï¼Œæ˜¯æŒ‰ç…§executerçº¬åº¦ï¼Œè®¡ç®—çš„å®Œæˆçš„taskæ•°å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528659,"discussion_content":"æ˜¯çš„ï¼Œä¸åŒé¡µé¢çš„ç»Ÿè®¡ç»´åº¦ä¸åŒï¼Œæ‹¿Executorsé¡µé¢ä¸ºä¾‹ï¼Œå®ƒçš„ç»Ÿè®¡ç»´åº¦æ˜¯Executorsï¼Œç›¸å½“äºæŠŠå…¶ä»–ç»´åº¦ï¼ˆæ¯”å¦‚Jobsã€Stagesï¼‰å°±éƒ½æŠ¹æ‰äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634887799,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2340596,"avatar":"","nickname":"é˜³å°","note":"","ucode":"CD76C0917139AF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":406576,"discussion_content":"ä¼°è®¡æ˜¯æ‰€æœ‰taskæ•°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634798049,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":357618,"user_name":"ddww","can_delete":false,"product_type":"c1","uid":1184678,"ip_address":"é™•è¥¿","ucode":"2871112FC9B3F7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJDgV2qia6eAL7Fb4egX3odViclRRwOlkfCBrjhU9lLeib90KGkIDjdddSibNVs47N90L36Brgnr6ppiag/132","comment_is_top":false,"comment_ctime":1663492423,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1663492423","product_id":100073401,"comment_content":"æƒ³è¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼ŒExecutorsé¡µé¢ä¸‹ï¼ŒStorage Memory 4.3Gæ˜¯æ€ä¹ˆç®—å‡ºæ¥çš„ï¼Œè¿™ä¸ªæ˜¯é›†ç¾¤FrameWork Memoryçš„æ€»å’Œå—ï¼Ÿå¦‚æœæ˜¯çš„è¯ï¼Œæˆ‘åªç®—å‡ºæ¥3.1Gã€‚","like_count":0},{"had_liked":false,"id":352588,"user_name":"Van","can_delete":false,"product_type":"c1","uid":1964434,"ip_address":"","ucode":"DFA86072AB84CC","user_header":"https://static001.geekbang.org/account/avatar/00/1d/f9/92/f9e3e023.jpg","comment_is_top":false,"comment_ctime":1658798059,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1658798059","product_id":100073401,"comment_content":"å¥½ä¸œè¥¿","like_count":0},{"had_liked":false,"id":344612,"user_name":"éª¨æ±¤é¸¡è›‹é¢","can_delete":false,"product_type":"c1","uid":1050002,"ip_address":"","ucode":"2AC141A523E710","user_header":"https://static001.geekbang.org/account/avatar/00/10/05/92/b609f7e3.jpg","comment_is_top":false,"comment_ctime":1651670389,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1651670389","product_id":100073401,"comment_content":"è¯·é—®ä¸‹ï¼Œspark æœ‰æ²¡æœ‰ç±»ä¼¼prometheus metric ç›‘æ§å‘¢","like_count":0},{"had_liked":false,"id":339575,"user_name":"è‹æ–‡è¿›","can_delete":false,"product_type":"c1","uid":2045506,"ip_address":"","ucode":"E73826626AB14A","user_header":"https://static001.geekbang.org/account/avatar/00/1f/36/42/70d01532.jpg","comment_is_top":false,"comment_ctime":1648199069,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1648199069","product_id":100073401,"comment_content":"è€å¸ˆå¥½ï¼Œæˆ‘ç”¨ä»£ç ç®—äº†ä¸€ä¸‹storageMemoryå’ŒSparkUIä¸Šçš„å¯¹ä¸ä¸Šï¼Œæˆ‘çš„sparkç‰ˆæœ¬æ˜¯3.0.0ï¼š<br>```<br>def calculateStorageMemory(<br>      executorMemory: Long = Runtime.getRuntime.maxMemory<br>  ): Unit = {<br>    val systemMemory = executorMemory<br>    val reservedMemory = 300 * 1024 * 1024<br>    &#47;&#47; User Memory ç”¨äºå­˜å‚¨å¼€å‘è€…è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„ï¼Œä¾‹å¦‚ RDD ç®—å­ä¸­å¼•ç”¨çš„æ•°ç»„ã€åˆ—è¡¨ã€æ˜ å°„ç­‰ç­‰ã€‚<br>    val userMemory = (systemMemory - reservedMemory) * 0.4<br>    &#47;&#47; Storage Memory ç”¨äºç¼“å­˜åˆ†å¸ƒå¼æ•°æ®é›†ï¼Œæ¯”å¦‚ RDD Cacheã€å¹¿æ’­å˜é‡ç­‰ç­‰<br>    val storageMemory = (systemMemory - reservedMemory) * 0.6 * 0.5<br>    val storageMemoryAsMb = JavaUtils.byteStringAsMb(storageMemory.toLong + &quot;b&quot;)<br>    println(&quot;actual storageMemory is %d MB&quot;.format(storageMemoryAsMb))<br>  }<br><br>  calculateStorageMemory()<br>  calculateStorageMemory(1*1024*1024*1024) &#47;&#47; spark.executor.memoryé»˜è®¤: 1g<br>```<br>æ‰“å°ç»“æœï¼š<br>actual storageMemory is 1002 MB<br>actual storageMemory is 217 MB<br>è€ŒSparkUIä¸Šæ˜¾ç¤ºçš„æ˜¯2GiB.<br>æˆ‘æ‰¾äº†ä¸€ä¸‹ç­”æ¡ˆï¼š<br>æœ‰çš„å¯¹ä¸ä¸Šæ˜¯å› ä¸ºå¼€äº†å †å¤–å†…å­˜ï¼Œä½†æ˜¯é»˜è®¤æƒ…å†µå †å¤–å†…å­˜æ˜¯å…³é—­çš„ï¼Œè¿™ä¸ªåŸå› æ’é™¤ã€‚<br>æœ‰çš„å¯¹ä¸ä¸Šæ˜¯SparkUIä¸Šå­—èŠ‚åˆ°GBçš„æ¢ç®—æ˜¯ç”¨çš„1000è€Œä¸æ˜¯1024ï¼Œè¿™ä¸ªbugå·²ç»è¢«ä¿®å¤äº†ï¼ˆhttps:&#47;&#47;issues.apache.org&#47;jira&#47;browse&#47;SPARK-25696ï¼‰ï¼Œæ‰€ä»¥ä¹Ÿè¢«æ’é™¤ã€‚<br>è¿˜æœ‰çš„å¯¹ä¸ä¸Šæ˜¯JVMå®é™…å¯ç”¨å†…å­˜æ¯”spark.executor.memoryçš„å€¼å°ï¼Œè€Œæˆ‘æƒ…å†µæ˜¯é»˜è®¤1gï¼ŒJVMå¯ç”¨çš„å†…å­˜æ˜¯3ä¸ªå¤šg.<br>","like_count":0},{"had_liked":false,"id":322759,"user_name":"ä¿æŠ¤","can_delete":false,"product_type":"c1","uid":1940842,"ip_address":"","ucode":"CD59FC5E087BCB","user_header":"https://static001.geekbang.org/account/avatar/00/1d/9d/6a/9158f399.jpg","comment_is_top":false,"comment_ctime":1637577356,"is_pvip":false,"replies":[{"id":"117411","content":"æ˜¯çš„~","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1043100","ctime":1637986773,"ip_address":"","comment_id":322759,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1637577356","product_id":100073401,"comment_content":"Job Id ä¸º 7å­˜åœ¨çš„åŸå›  æ˜¯å› ä¸ºä¿å­˜äº†æ–‡ä»¶å˜›","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533822,"discussion_content":"æ˜¯çš„~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637986773,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321642,"user_name":"Geek_18fe90","can_delete":false,"product_type":"c1","uid":2260535,"ip_address":"","ucode":"6BF21B093883BA","user_header":"","comment_is_top":false,"comment_ctime":1636971207,"is_pvip":false,"replies":[{"id":"116834","content":"å“ˆå“ˆ","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1637039981,"ip_address":"","comment_id":321642,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1636971207","product_id":100073401,"comment_content":"è§£å†³äº†æˆ‘çš„ä¸€å—å¿ƒç—…","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530326,"discussion_content":"å“ˆå“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637039981,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":317056,"user_name":"Sean","can_delete":false,"product_type":"c1","uid":2162751,"ip_address":"","ucode":"69234046BFD81B","user_header":"https://static001.geekbang.org/account/avatar/00/21/00/3f/a0f84788.jpg","comment_is_top":false,"comment_ctime":1634652846,"is_pvip":false,"replies":[{"id":"114781","content":"å“ˆå“ˆï¼Œç»å¯¹æ²™å‘ï½ğŸ›‹ï¸","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1634686679,"ip_address":"","comment_id":317056,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1634652846","product_id":100073401,"comment_content":"æŠ¢ä¸ªæ²™å‘å…ˆğŸ¤¯ğŸ¤¯ğŸ¤¯","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528632,"discussion_content":"å“ˆå“ˆï¼Œç»å¯¹æ²™å‘ï½ğŸ›‹ï¸","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634686679,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}