{"id":112325,"title":"09 | 让我们揭开WebRTC建立连接的神秘面纱","content":"<p><span class=\"reference\"></span>在上一篇<a href=\"https://time.geekbang.org/column/article/111675\">《08 | 有话好商量，论媒体协商》</a>文章中，我向你介绍了WebRTC进行通信时，是如何进行媒体协商的，以及媒体协商的目的是什么。</p><p>在媒体协商过程中，如果双方能达成一致，也就是商量好了使用什么编解码器，确认了使用什么传输协议，那么接下来，WebRTC就要建立连接，开始传输音视频数据了。</p><p>WebRTC之间建立连接的过程是非常复杂的。之所以复杂，主要的原因在于它既要考虑传输的<strong>高效性</strong>，又要保证端与端之间的<strong>连通率</strong>。</p><p>换句话说，当同时存在多个有效连接时，它首先选择传输质量最好的线路，如能用内网连通就不用公网。另外，如果尝试了很多线路都连通不了，那么它还会使用服务端中继的方式让双方连通，总之，是“想尽办法，用尽手段”让双方连通。</p><p>对于<strong>传输的效率与连通率</strong>这一点，既是WebRTC的目标，也是 WebRTC 建立连接的基本策略。下面我们就来具体看一下 WebRTC 是如何达到这个目标的吧！</p><h2>在WebRTC 处理过程中的位置</h2><p>下面这张图清晰地表达了本文所讲的内容在整个WebRTC处理过程中的位置。</p><p><img src=\"https://static001.geekbang.org/resource/image/fb/ff/fbce1bba75073ab721cca628b0a61cff.png?wh=1142*606\" alt=\"\"></p><center><span class=\"reference\">WebRTC处理过程图</span></center><p>图中的红色部分——连接的创建、STUN/TURN以及 NAT 穿越，就是我们本文要讲的主要内容。</p><h2>连接建立的基本原则</h2><!-- [[[read_end]]] --><p>接下来，我将通过两个具体的场景，向你介绍一下 WebRTC 建立连接的基本原则。不过在讲解之前，我们先设置一些假设条件，这样会更有利于我们下面的描述：</p><ul>\n<li>通信的双方我们称为 A 和 B；</li>\n<li>A 为呼叫方，B 为被呼叫方；</li>\n<li>C 为中继服务器，也称为 relay 服务器或 TURN服务器。</li>\n</ul><h3>1. 场景一：双方处于同一网段内</h3><p>A 与 B 进行通信，假设它们现在处于同一个办公区的同一个网段内。在这种情况下，A 与 B 有两种连通路径：</p><ul>\n<li>一种是双方通过内网直接进行连接；</li>\n<li>另一种是通过公网，也就是通过公司的网关，从公网绕一圈后再进入公司实现双方的通信。</li>\n</ul><p>相较而言，显然第一种连接路径是最好的。 A 与 B 在内网连接就好了，谁会舍近求远呢？</p><p>但现实却并非如此简单，要想让 A 与 B 直接在内网连接，首先要解决的问题是： A 与 B 如何才能知道它们是在同一个网段内呢？</p><p>这个问题还真不好回答，也正是由于这个问题不太好解决，所以，现在有很多通信类产品在双方通信时，无论是否在同一个内网，它们都统一走了公网。不过，WebRTC很好的解决了这个问题，后面我们可以看一下它是如何解决这个问题的。</p><h3>2. 场景二：双方处于不同点</h3><p>A 与 B 进行通信，它们分别在不同的地点，比如一个在北京，一个在上海，此时 A 与 B 通信必须走公网。但走公网也有两条路径：</p><ul>\n<li>一是通过 P2P 的方式双方直接建立连接；</li>\n<li>二是通过中继服务器进行中转，即A 与 B 都先与 C 建立连接，当 A 向 B 发消息时， A先将数据发给 C，然后 C 再转发给 B；同理， B 向 A 发消息时，B 先将消息发给C，然后C再转给A。</li>\n</ul><p>对于这两条路径你该如何选择呢？对于 WebRTC 来讲，它认为<strong>通过中继的方式会增加 A 与 B 之间传输的时长，所以它优先使用 P2P 方式；如果 P2P 方式不通，才会使用中继的方式</strong>。</p><p>通过上面两个场景的描述，我想你应该已经了解到 WebRTC 为了实现端与端之间连接的建立，做了非常多的工作。下面我们就来一起看看 WebRTC 建立连接的具体过程吧！</p><h2>什么是Candidate</h2><p>在讲解 WebRTC 建立连接的过程之前，你有必要先了解一个基本概念，即 <strong>ICE Candidate （ICE 候选者）</strong>。它表示 WebRTC 与远端通信时使用的协议、IP地址和端口，一般由以下字段组成：</p><ul>\n<li>本地IP地址</li>\n<li>本地端口号</li>\n<li>候选者类型，包括 host、srflx和relay</li>\n<li>优先级</li>\n<li>传输协议</li>\n<li>访问服务的用户名</li>\n<li>……</li>\n</ul><p>如果用一个结构表示，那么它就如下面所示的样子：</p><pre><code>{\n\tIP: xxx.xxx.xxx.xxx,\n\tport: number,\n\ttype: host/srflx/relay,\n\tpriority: number,\n\tprotocol: UDP/TCP,\n\tusernameFragment: string\n\t...\n}\n</code></pre><p>其中，候选者类型中的 host 表示<strong>本机候选者</strong>，srflx表示内网主机映射的<strong>外网的地址和端口</strong>，relay表示<strong>中继候选者</strong>。</p><p>当WebRTC通信双方彼此要进行连接时，每一端都会提供许多候选者，比如你的主机有两块网卡，那么每块网卡的不同端口都是一个候选者。</p><p>WebRTC会按照上面描述的格式对候选者进行排序，然后按优先级从高到低的顺序进行连通性测试，当连通性测试成功后，通信的双方就建立起了连接。</p><p>在众多候选者中，<strong>host 类型的候选者优先级是最高的</strong>。在 WebRTC 中，首先对 host 类型的候选者进行连通性检测，如果它们之间可以互通，则直接建立连接。其实，<strong>host 类型之间的连通性检测就是内网之间的连通性检测</strong>。WebRTC就是通过这种方式巧妙地解决了大家认为很困难的问题。</p><p>同样的道理，如果 host 类型候选者之间无法建立连接，那么 WebRTC 则会尝试<strong>次优先级的候选者，即 srflx 类型的候选者</strong>。也就是尝试让通信双方直接通过 P2P 进行连接，如果连接成功就使用 <strong>P2P 传输数据</strong>；如果失败，就最后尝试使用 relay 方式建立连接。</p><p>通过上面的描述，你是不是觉得 WebRTC 在这里的设计相当精妙呢？当然在 WebRTC 看来，以上这些只不过是一些“皮毛”，在下一篇关于NAT穿越原理一文中，你还会看WebRTC在 NAT 穿越上的精彩处理。</p><h2>收集 Candidate</h2><p>了解了什么是 Candidate 之后，接下来，我们再来看一下端对端的连接是如何建立的吧。</p><p>实际上，端对端的建立更主要的工作是<strong>Candidate的收集</strong>。WebRTC 将 Candidate 分为三种类型：</p><ul>\n<li>host类型，即本机内网的 IP 和端口；</li>\n<li>srflx类型,   即本机NAT映射后的外网的 IP 和端口；</li>\n<li>relay类型，即中继服务器的 IP 和端口。</li>\n</ul><p>其中，host 类型优先级最高，srflx 次之，relay最低（前面我们已经说明过了）。</p><p>在以上三种Candidate类型中，<strong>host 类型的 Candidate 是最容易收集的</strong>，因为它们都是本机的 IP 地址和端口。对于 host 类型的 Candidate 这里就不做过多讲解了，下面我们主要讲解一下 srflx 和 relay 这两种类型的 Candidate的收集。</p><h3>1. STUN协议</h3><p>srflx 类型的 Candidate 实际上就是内网地址和端口<strong>经 NAT 映射</strong>后的外网地址和端口。如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/b0/ca/b04a0cd49c3e93e1cc536566404affca.png?wh=1142*474\" alt=\"\"></p><center><span class=\"reference\">NAT地址映射图</span></center><p>你应该知道，如果主机没有公网地址，是无论如何都无法访问公网上的资源的。例如你要通过百度搜索一些信息，如果你的主机没有公网地址的话，百度搜索到的结果怎么传给你呢？</p><p>而一般情况下，主机都只有内网IP和端口，那它是如何访问外网资源的呢？实际上，在内网的网关上都有NAT (Net Address Translation) 功能，<strong>NAT 的作用就是进行内外网的地址转换</strong>。这样当你要访问公网上的资源时，NAT首先会将该主机的内网地址转换成外网地址，然后才会将请求发送给要访问的服务器；服务器处理好后将结果返回给主机的公网地址和端口，再通过 NAT 最终中转给内网的主机。</p><p>知道了上面的原理，你要想让内网主机获得它的外网IP地址也就好办了，只需要在公网上架设一台服务器，并向这台服务器发个请求说： “Hi！伙计，你看我是谁？”对方回： “你不是那xxxx吗？”这样你就可以知道自己的公网 IP 了，是不是很简单？</p><p>实际上，上面的描述已经被定义成了一套规范，即 RFC5389 ，也就是 <strong>STUN 协议</strong>，我们只要<strong>遵守这个协议就可以拿到自己的公网 IP 了</strong>。</p><p>这里我们举个例子，看看通过 STUN 协议，主机是如何获取到自己的外网IP地址和端口的。</p><ul>\n<li>首先在外网搭建一个 STUN 服务器，现在比较流行的 STUN 服务器是 CoTURN，你可以到 GitHub 上自己下载源码编译安装。</li>\n<li>当 STUN 服务器安装好后，从内网主机发送一个binding request的STUN 消息到 STUN 服务器。</li>\n<li>STUN 服务器收到该请求后，会将请求的 IP地址和端口填充到binding response消息中，然后顺原路将该消息返回给内网主机。此时，收到binding response消息的内网主机就可以解析 binding response消息了，并可以从中得到自己的外网IP和端口。</li>\n</ul><h3>2. TURN协议</h3><blockquote>\n<p>这里需要说明一点，relay服务是通过TURN协议实现的。所以我们经常说的relay服务器或TURN服务器它们是同一个意思，都是指中继服务器。</p>\n</blockquote><p>咱们言归正转，知道了内网主机如何通过 STUN 协议获取到srflx类型的候选者后，那么中继类型候选者，即 relay型的 Candidate 又是如何获取的呢？下面我们就来看一下。</p><p>首先你要清楚，<strong>relay型候选者的优先级与其他类型相比是最低的</strong>，但在其他候选者都无法连通的情况下，relay候选者就成了最好的选择。因为<strong>它的连通率是所有候选者中连通率最高的</strong>。</p><p>其实，relay型候选者的获取也是通过 STUN 协议完成的，只不过它使用的STUN消息类型与获取 srflx 型候选者的 STUN 消息的类型不一样而已。</p><p>RFC5766的 TURN 协议描述了如何获取 relay服务器（即TURN 服务器）的 Candidate过程。其中最主要的是 Allocation指令。通过向 TURN 服务器发送 Allocation 指令，relay服务就会在服务器端分配一个新的relay端口，用于中转UDP数据报。</p><p>不过这里我只是简要描述了下，如果你对这块感兴趣的话，可以直接查看 RFC5766 以了解更多的细节。</p><h2>NAT打洞/P2P穿越</h2><p>当收集到 Candidate 后，WebRTC 就开始按优先级顺序进行连通性检测了。它首先会判断两台主机是否处于同一个局域网内，如果双方确实是在同一局域网内，那么就直接在它们之间建立一条连接。</p><p>但如果两台主机不在同一个内网，WebRTC将尝试<strong>NAT打洞，即 P2P 穿越</strong>。在WebRTC中，NAT打洞是极其复杂的过程，它首先需要对 NAT 类型做判断，检测出其类型后，才能判断出是否可以打洞成功，只有存在打洞成功的可能性时才会真正尝试打洞。</p><p>WebRTC将 NAT 分类为 4 种类型，分别是：</p><ul>\n<li>完全锥型 NAT</li>\n<li>IP 限制型 NAT</li>\n<li>端口限制型 NAT</li>\n<li>对称型 NAT</li>\n</ul><p>而每种不同类型的 NAT 的详细介绍我们将在下一篇关于NAT穿越原理一文中进行讲解，现在你只要知道 NAT 分这4种类型就好了。另外，需要记住的是，对称型NAT 与对称型 NAT 是无法进行P2P穿越的；而对称型NAT与端口限制型NAT也是无法进行 P2P 连接的。</p><h2>ICE</h2><p>了解了上面的知识后，你再来看 ICE 就比较简单了。其实 ICE 就是上面所讲的获取各种类型 Candidate的过程，也就是：<strong>在本机收集所有的 host 类型的 Candidate，通过 STUN 协议收集 srflx 类型的 Candidate，使用 TURN 协议收集 relay类型的 Candidate</strong>。</p><p>因此，有人说 ICE 就是包括了STUN、TURN 协议的一套框架，从某种意义来说，这样描述也并不无道理。</p><h2>小结</h2><p>通过上面的讲解，我想你现在已经基本了解 WebRTC 端对端建立连接的基本过程。在WebRTC中，它首先会尝试NAT穿越，即尝试端到端直连。如果能够穿越成功，那双方就通过直连的方式传输数据，这是最高效的。但如果 NAT 穿越失败，为了保障通信双方的连通性，WebRTC会使用中继方式，当然使用这种方式传输效率会低一些。</p><p>在整个过程中，WebRTC使用<strong>优先级</strong>的方法去建立连接，即局域网内的优先级最高，其次是NAT穿越，再次是通过中继服务器进行中转，这样就巧妙地实现了“既要高效传输，又能保证连通率”这个目标。</p><p>当然，即使 WebRTC 处理得这样好，但还有不够完美的地方。举个例子，对于同一级别多个Candidate的情况，WebRTC 就无法从中选出哪个 Candidate 更优了，它现在的做法是，在同一级别的 Candidate 中，谁排在前面就先用谁进行连接。</p><h2>思考时间</h2><p>若你查阅相关资料，一定会发现Candidate的类型是四种，而不是三种，多了一种 prflx 类型，那么 prflx 类型与 srflx 类型的区别是什么呢？</p><p>欢迎在留言区与我分享你的想法，也欢迎你在留言区记录你的思考过程。感谢阅读，如果你觉得这篇文章对你有帮助的话，也欢迎把它分享给更多的朋友。</p>","neighbors":{"left":{"article_title":"08 | 有话好商量，论媒体协商","id":111675},"right":{"article_title":"10 | WebRTC NAT穿越原理","id":113560}},"comments":[{"had_liked":false,"id":120742,"user_name":"花果山の酸梅汤","can_delete":false,"product_type":"c1","uid":1606018,"ip_address":"","ucode":"E4A71E8AD52CB3","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoicwtj6x3l7NEcODqsXHjUTjzbl99pesNbydQUSfR6IywcKKyyaY9AIhBS0bCz3R8icMRIploDdUQA/132","comment_is_top":false,"comment_ctime":1564987796,"is_pvip":false,"replies":[{"id":"44381","content":"赞，很到位！","user_name":"作者回复","comment_id":120742,"uid":"1507837","ip_address":"","utype":1,"ctime":1565012245,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"53104595348","product_id":100031801,"comment_content":"srflx candidate是通过信令方式向STUN服务器发送binding request，通过该请求找到NAT映射后的地址（server视角）；prflx candidate用于链接检查，当A按照优先级向目标peer B发送binding request，B收到peer A的连通性成功时获得的地址（peer视角）。不知道是否是这样。","like_count":12,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461457,"discussion_content":"赞，很到位！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565012245,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":120331,"user_name":"山石尹口","can_delete":false,"product_type":"c1","uid":1053346,"ip_address":"","ucode":"0BAAEE2FD579B5","user_header":"https://static001.geekbang.org/account/avatar/00/10/12/a2/d18e6394.jpg","comment_is_top":false,"comment_ctime":1564834280,"is_pvip":true,"replies":[{"id":"44198","content":"没错！","user_name":"作者回复","comment_id":120331,"uid":"1507837","ip_address":"","utype":1,"ctime":1564919210,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"18744703464","product_id":100031801,"comment_content":"连通性检测时的超时设置比较重要，设置短了，会把可以连通的判断为不能连通，设置长了，就会在不能连通的配对上浪费时间","like_count":5,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461290,"discussion_content":"没错！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564919210,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":177604,"user_name":"Benjamin","can_delete":false,"product_type":"c1","uid":1168314,"ip_address":"","ucode":"9650EFA8481B41","user_header":"https://static001.geekbang.org/account/avatar/00/11/d3/ba/75f3b73b.jpg","comment_is_top":false,"comment_ctime":1581432309,"is_pvip":false,"replies":[{"id":"70152","content":"是的","user_name":"作者回复","comment_id":177604,"uid":"1507837","ip_address":"","utype":1,"ctime":1582429750,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"14466334197","product_id":100031801,"comment_content":"这篇总算把 STUN 和 TURN 差别搞清楚了<br><br>理论上来说 relay 的 TURN 保证一定可以连接上，但是被中转了一次后，后续音视频 UDP 包效率会受到影响。","like_count":3,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483482,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582429750,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":278043,"user_name":"Hengstar","can_delete":false,"product_type":"c1","uid":1805908,"ip_address":"","ucode":"49F0F259E9F00D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/9EU2n1Rc4FEr2QicklnU0GQUhPMssibCpTSoxvd779pialoSRraibbiakCHgibA3LIMxWPrWMccjaWvWIJZIztqKXTkA/132","comment_is_top":false,"comment_ctime":1612732016,"is_pvip":false,"replies":[{"id":"103796","content":"当发生网络切换时，移动端自己是可以检测出网络变化的，之后你需要调用pc restart，然后用replace复用原来的通道，这样应该就可以达到无缝切换了","user_name":"作者回复","comment_id":278043,"uid":"1507837","ip_address":"","utype":1,"ctime":1617072732,"user_name_real":"音视频专家-李超"}],"discussion_count":1,"race_medal":0,"score":"10202666608","product_id":100031801,"comment_content":"李老师你好。非常喜欢你的课，讲解很详细。我正好工作中有遇到很多麻烦的问题。比如有很多人家里会安装Wifi的扩展器（extender）设备，这样在家里的时候这些人在不同的位置可能会自动连接到不同的wifi设备（可能是路由器或者是扩展器之间来回切换）。对于这种情况，我们移动端用WebRTC实现的app在通过Host local网络连接上以后，切换wifi的时候是不是会断开WebRTC连接呢？我们如何能够判断这种情况？有没有办法可以很好的实现这种无缝的重连呢？","like_count":2,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515263,"discussion_content":"当发生网络切换时，移动端自己是可以检测出网络变化的，之后你需要调用pc restart，然后用replace复用原来的通道，这样应该就可以达到无缝切换了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617072732,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":205273,"user_name":"Geek_82d1fd","can_delete":false,"product_type":"c1","uid":1780653,"ip_address":"","ucode":"642130016EBE1D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJLAxia7JictXmRQ02VwuibKOpib5bMcWbQHZeeQhsV17KeGh5u7ySyibgMVLwcoqCA3ZiayI3dLaVOjibRg/132","comment_is_top":false,"comment_ctime":1586580344,"is_pvip":false,"replies":[{"id":"77610","content":"1.  candidate一开始就是放在 SDP中的，后来因为连接效率的问题所以才被拿出来<br>2. 发 STUN 包是为了 P2P 打洞","user_name":"作者回复","comment_id":205273,"uid":"1507837","ip_address":"","utype":1,"ctime":1587222064,"user_name_real":"garrylee"}],"discussion_count":4,"race_medal":0,"score":"10176514936","product_id":100031801,"comment_content":"老师，我又几个问题<br>1. candidate是不是可以直接设置到SDP里面？<br>2. 跟媒体服务器通信的时候为什么要发Stun包？","like_count":2,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491437,"discussion_content":"1.  candidate一开始就是放在 SDP中的，后来因为连接效率的问题所以才被拿出来\n2. 发 STUN 包是为了 P2P 打洞","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587222064,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1470108,"avatar":"https://static001.geekbang.org/account/avatar/00/16/6e/9c/07580206.jpg","nickname":"James","note":"","ucode":"0FB85E7392E6DF","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":321614,"discussion_content":"请问老师：\n1.  如果candidates不在sdp信令里，A如何知道B的candidates\n2. 连通性检测成功失败的依据是什么，类似ping么","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604595069,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1148770,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIROsBAWicJYLbnzYH3ibiaX2T2am9z4IKxp34uJSgib2ntfh9zKLtndAcfCUJHLZO7Q3jkia3aKu8eOSg/132","nickname":"lqq热爱学习","note":"","ucode":"25795B06CA56A1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1470108,"avatar":"https://static001.geekbang.org/account/avatar/00/16/6e/9c/07580206.jpg","nickname":"James","note":"","ucode":"0FB85E7392E6DF","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":369437,"discussion_content":"1. 如果candidates不在sdp信令里，A如何知道B的candidates 你这个问题问的好啊.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619023266,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":321614,"ip_address":""},"score":369437,"extra":""},{"author":{"id":1148770,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIROsBAWicJYLbnzYH3ibiaX2T2am9z4IKxp34uJSgib2ntfh9zKLtndAcfCUJHLZO7Q3jkia3aKu8eOSg/132","nickname":"lqq热爱学习","note":"","ucode":"25795B06CA56A1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1470108,"avatar":"https://static001.geekbang.org/account/avatar/00/16/6e/9c/07580206.jpg","nickname":"James","note":"","ucode":"0FB85E7392E6DF","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":369527,"discussion_content":"看了一下代码\n1. 这个需要你自己保证，我看PION中的信令服务器是通过连接判断的。相同TCP连接过来的SDP和Candidate就是一个\n2. 类似于ping这个在webrtc内部自己实现了，具体是不是ping我也不太清楚，没有详细了解过ping的流程。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1619066139,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":321614,"ip_address":""},"score":369527,"extra":""}]}]},{"had_liked":false,"id":120395,"user_name":"刘丹","can_delete":false,"product_type":"c1","uid":1081922,"ip_address":"","ucode":"66594D1C957E15","user_header":"https://static001.geekbang.org/account/avatar/00/10/82/42/8b04d489.jpg","comment_is_top":false,"comment_ctime":1564879719,"is_pvip":false,"replies":[{"id":"44195","content":"Interactive Connectivity Establishment (ICE) ，可以参考 https:&#47;&#47;tools.ietf.org&#47;html&#47;rfc5245","user_name":"作者回复","comment_id":120395,"uid":"1507837","ip_address":"","utype":1,"ctime":1564919109,"user_name_real":"garrylee"}],"discussion_count":3,"race_medal":0,"score":"10154814311","product_id":100031801,"comment_content":"请问ICE是哪3个英文单词的缩写？是Internet Communication Engine吗？能否创建一个术语表章节？","like_count":2,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461318,"discussion_content":"Interactive Connectivity Establishment (ICE) ，可以参考 https://tools.ietf.org/html/rfc5245","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564919109,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1630111,"avatar":"https://static001.geekbang.org/account/avatar/00/18/df/9f/6db75dff.jpg","nickname":"Random","note":"","ucode":"4E164C8CF487FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":395964,"discussion_content":"交互式连接建立","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632369316,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1201410,"avatar":"https://static001.geekbang.org/account/avatar/00/12/55/02/8394e215.jpg","nickname":"Suiyek","note":"","ucode":"4B0A2D6C5C4E99","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3874,"discussion_content":"Interactive Connectivity Establishment ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564907966,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":265118,"user_name":"Geek_fc668a","can_delete":false,"product_type":"c1","uid":2344629,"ip_address":"","ucode":"D03DFC7F37E82B","user_header":"","comment_is_top":false,"comment_ctime":1606786259,"is_pvip":false,"replies":[{"id":"103814","content":"stun 协议是专门定义的规范用于打洞的；你这是想自己再实现一套吗？","user_name":"作者回复","comment_id":265118,"uid":"1507837","ip_address":"","utype":1,"ctime":1617074543,"user_name_real":"音视频专家-李超"}],"discussion_count":2,"race_medal":0,"score":"5901753555","product_id":100031801,"comment_content":"老师，有个问题一直很不解，很希望获得您的解答：在一般的C&#47;S架构中，服务器可以很轻松地获取客户端的ip地址，拿为什么不能由信令服务器获取一方的ip交给另一方发起连接，而需要STUN&#47;TURN呢？","like_count":2,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510810,"discussion_content":"stun 协议是专门定义的规范用于打洞的；你这是想自己再实现一套吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617074543,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1148770,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIROsBAWicJYLbnzYH3ibiaX2T2am9z4IKxp34uJSgib2ntfh9zKLtndAcfCUJHLZO7Q3jkia3aKu8eOSg/132","nickname":"lqq热爱学习","note":"","ucode":"25795B06CA56A1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369430,"discussion_content":"打洞比你想象复杂, 你这个可以解决一部分问题, 但是如果是对称性NAT你就没有办法打洞了(建议百度一下为什么), 还有如果在同一个局域网下你就需要绕到公网通信不是很麻烦吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619022050,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":154678,"user_name":"SherwinFeng","can_delete":false,"product_type":"c1","uid":1747728,"ip_address":"","ucode":"1754290DCF5CB7","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJoNVHqRL5iatEoMgfFAaGFZxD8ic6CicxKI9Facp4bzAkNMAfaduSENlPOafs6dOGawibhNv3V9lVowQ/132","comment_is_top":false,"comment_ctime":1574508907,"is_pvip":false,"replies":[{"id":"60364","content":"是的。对于 prflx 来说，它也用的 STUN协议！","user_name":"作者回复","comment_id":154678,"uid":"1507837","ip_address":"","utype":1,"ctime":1575169191,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"5869476203","product_id":100031801,"comment_content":"prflx和srflx都是为了获取内网主机IP映射的公网IP，只是srflx是通过STUN协议，prflx是直接向目的主机发起连接并请求响应的方式。","like_count":1,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475547,"discussion_content":"是的。对于 prflx 来说，它也用的 STUN协议！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575169191,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":120653,"user_name":"Jason","can_delete":false,"product_type":"c1","uid":1053390,"ip_address":"","ucode":"ABB3F1A63E102A","user_header":"https://static001.geekbang.org/account/avatar/00/10/12/ce/a8c8b5e8.jpg","comment_is_top":false,"comment_ctime":1564967275,"is_pvip":false,"replies":[{"id":"44382","content":"在进行NAT穿越时，如果可以进行穿越，则它向对端发送 binding request请求，binding response就会带回 prflx 类型的 IP 地址和端口，它们就形成了 prflx类型的 candidate。如果NAT穿越不过去，就要走 STUN服务，此时就会获 srflx 类型的 candidate","user_name":"作者回复","comment_id":120653,"uid":"1507837","ip_address":"","utype":1,"ctime":1565012498,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"5859934571","product_id":100031801,"comment_content":"是不是这样的？srflx：内网地址被NAT映射后的地址，对称型 NAT 与对称型 NAT 、对称型 NAT 与端口限制型 NAT是无法进行 P2P 穿越的；prflx：TUN Server上为客户端分配的中继地址，与各种NAT类型地址都可以进行P2P连接；","like_count":1,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461419,"discussion_content":"在进行NAT穿越时，如果可以进行穿越，则它向对端发送 binding request请求，binding response就会带回 prflx 类型的 IP 地址和端口，它们就形成了 prflx类型的 candidate。如果NAT穿越不过去，就要走 STUN服务，此时就会获 srflx 类型的 candidate","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565012498,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":281444,"user_name":"piboye","can_delete":false,"product_type":"c1","uid":1066752,"ip_address":"","ucode":"7CFD8712857A85","user_header":"https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg","comment_is_top":false,"comment_ctime":1614752976,"is_pvip":true,"replies":[{"id":"103793","content":"为什么难以部署呢？不分配端口通信双方如何通信呢？","user_name":"作者回复","comment_id":281444,"uid":"1507837","ip_address":"","utype":1,"ctime":1617072148,"user_name_real":"音视频专家-李超"}],"discussion_count":2,"race_medal":0,"score":"1614752976","product_id":100031801,"comment_content":"老师， 我一直纳闷 turn 服务器为什么一定要分配 relay port 出来， 这样分配后服务器很难部署了。 不分配端口也是可以做转发啊？","like_count":1,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":516400,"discussion_content":"为什么难以部署呢？不分配端口通信双方如何通信呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617072148,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1066752,"avatar":"https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg","nickname":"piboye","note":"","ucode":"7CFD8712857A85","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":579915,"discussion_content":"外网一个ip只能绑6w个端口，后面我们通过暴露内网ip的端口解决了，安全性也更好了，谢谢老师的解答","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657771546,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":516400,"ip_address":""},"score":579915,"extra":""}]}]},{"had_liked":false,"id":238989,"user_name":"Geek_7afbfc","can_delete":false,"product_type":"c1","uid":2076242,"ip_address":"","ucode":"8DCC72A80687E1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKcwxhdFicBaG4zozbxwNa1K5slcRP7ia3iacjWf5odJO4WtvFDJlztDRFKRddAAVHwlIS5CatQMD5wA/132","comment_is_top":false,"comment_ctime":1596411046,"is_pvip":false,"replies":[{"id":"88592","content":"内网内不搭turn服务是可以使用的","user_name":"作者回复","comment_id":238989,"uid":"1507837","ip_address":"","utype":1,"ctime":1596691670,"user_name_real":"音视频专家-李超"}],"discussion_count":3,"race_medal":0,"score":"1596411046","product_id":100031801,"comment_content":"老师，无互联网环境，如果是同一网段内网，且未搭建内网的turn服务器，那咱们的Webrtc就不可用吗？","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":502926,"discussion_content":"内网内不搭turn服务是可以使用的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596691670,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2076242,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKcwxhdFicBaG4zozbxwNa1K5slcRP7ia3iacjWf5odJO4WtvFDJlztDRFKRddAAVHwlIS5CatQMD5wA/132","nickname":"Geek_7afbfc","note":"","ucode":"8DCC72A80687E1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":297209,"discussion_content":"那不搭stun服务器呢，这种环境是不是stun和turn服务器必须至少搭一个呢\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1596808846,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1148770,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIROsBAWicJYLbnzYH3ibiaX2T2am9z4IKxp34uJSgib2ntfh9zKLtndAcfCUJHLZO7Q3jkia3aKu8eOSg/132","nickname":"lqq热爱学习","note":"","ucode":"25795B06CA56A1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2076242,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKcwxhdFicBaG4zozbxwNa1K5slcRP7ia3iacjWf5odJO4WtvFDJlztDRFKRddAAVHwlIS5CatQMD5wA/132","nickname":"Geek_7afbfc","note":"","ucode":"8DCC72A80687E1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369431,"discussion_content":"不用搭建, 你只要能把双方的SDP信息设置下就好了.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619022130,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":297209,"ip_address":""},"score":369431,"extra":""}]}]},{"had_liked":false,"id":172038,"user_name":"微~凉","can_delete":false,"product_type":"c1","uid":1747823,"ip_address":"","ucode":"5363D67102CB56","user_header":"https://static001.geekbang.org/account/avatar/00/1a/ab/6f/58ca88b8.jpg","comment_is_top":false,"comment_ctime":1579077123,"is_pvip":false,"replies":[{"id":"66755","content":"应该是网络质量差，丢包严重。收到 ice 断开后音视频还能继续互通吗？","user_name":"作者回复","comment_id":172038,"uid":"1507837","ip_address":"","utype":1,"ctime":1579101002,"user_name_real":"garrylee"}],"discussion_count":2,"race_medal":0,"score":"1579077123","product_id":100031801,"comment_content":"请问老师：我在iOS设备上再若望情况下，相互视频的过程中经常会收到ice断开连接的信息，网络通畅的情况下就没问题，请问是什么原因啊？","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481596,"discussion_content":"应该是网络质量差，丢包严重。收到 ice 断开后音视频还能继续互通吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579101002,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1747823,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/ab/6f/58ca88b8.jpg","nickname":"微~凉","note":"","ucode":"5363D67102CB56","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":143385,"discussion_content":"收到断开连接的信息后，音视频就断开了。但是在同样的网络情况下，安卓和web表现就很好，请问这个和iOS手机WiFi模块联系很大么？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579503928,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":147063,"user_name":"李新","can_delete":false,"product_type":"c1","uid":1707670,"ip_address":"","ucode":"C3F5DB56328417","user_header":"https://static001.geekbang.org/account/avatar/00/1a/0e/96/eca820c7.jpg","comment_is_top":false,"comment_ctime":1572783203,"is_pvip":false,"replies":[{"id":"57402","content":"prflx ==&gt; peer reflex，其原理与srflx是类似的。理论上来说，没有看出peer reflex 可以提高 P2P 成功率。","user_name":"作者回复","comment_id":147063,"uid":"1507837","ip_address":"","utype":1,"ctime":1573191950,"user_name_real":"garrylee"}],"discussion_count":2,"race_medal":0,"score":"1572783203","product_id":100031801,"comment_content":"候选者类型还有一种：prflx，可以提供P2P的打洞成功率。","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473123,"discussion_content":"prflx ==&amp;gt; peer reflex，其原理与srflx是类似的。理论上来说，没有看出peer reflex 可以提高 P2P 成功率。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573191950,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1707670,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/0e/96/eca820c7.jpg","nickname":"李新","note":"","ucode":"C3F5DB56328417","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":54029,"discussion_content":"全锥型和对称型打洞过程，全锥型收到对称型端口改变之后的stun包，会回包。  而这个端口号在前面的信令交互阶段看不到。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574252827,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":126822,"user_name":"Dump","can_delete":false,"product_type":"c1","uid":1027751,"ip_address":"","ucode":"CE00A9B209EF88","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ae/a7/6d3a5d44.jpg","comment_is_top":false,"comment_ctime":1566483889,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566483889","product_id":100031801,"comment_content":"WebRTC看似是用于及时视频通话的，里面涉及的技术如老师所说可以应用到很多方面，真是一个大宝藏，学习了。","like_count":0},{"had_liked":false,"id":120296,"user_name":"许童童","can_delete":false,"product_type":"c1","uid":1003005,"ip_address":"","ucode":"4B799C0C6BC678","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg","comment_is_top":false,"comment_ctime":1564822203,"is_pvip":false,"replies":[{"id":"44199","content":"它与 srflx有什么不同呢？","user_name":"作者回复","comment_id":120296,"uid":"1507837","ip_address":"","utype":1,"ctime":1564919884,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1564822203","product_id":100031801,"comment_content":"prflx candidate (prflx候选者）：是一个候选地址，通过从主机候者选地址发 送一个STUN请求到运行在Peer候选地址上的STUN服务器而获取的候选地址。","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461276,"discussion_content":"它与 srflx有什么不同呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564919884,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":120293,"user_name":"许童童","can_delete":false,"product_type":"c1","uid":1003005,"ip_address":"","ucode":"4B799C0C6BC678","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg","comment_is_top":false,"comment_ctime":1564821828,"is_pvip":false,"replies":[{"id":"44169","content":"因为两端直接建立连接效率高，占用资源少","user_name":"作者回复","comment_id":120293,"uid":"1507837","ip_address":"","utype":1,"ctime":1564851503,"user_name_real":"garrylee"}],"discussion_count":3,"race_medal":0,"score":"1564821828","product_id":100031801,"comment_content":"老师你好，可以解释一下为什么需要 NAT 穿越吗？","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461274,"discussion_content":"因为两端直接建立连接效率高，占用资源少","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564851503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1521949,"avatar":"https://static001.geekbang.org/account/avatar/00/17/39/1d/4a53fb43.jpg","nickname":"从简","note":"","ucode":"146BFD42999EE2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4463,"discussion_content":"两个防火墙后面的客户端通信就需要NAT穿越，穿越是指穿越防火墙，不破坏防火墙现有规则的情况下实现通信","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565440963,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1290317,"avatar":"https://static001.geekbang.org/account/avatar/00/13/b0/4d/1864fcd1.jpg","nickname":"天堂鸟丶网吧","note":"","ucode":"4F33D248ABE9CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3842,"discussion_content":"为了减少延迟","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564850221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":120088,"user_name":"Beast-Of-Prey","can_delete":false,"product_type":"c1","uid":1615956,"ip_address":"","ucode":"C8BAEB1EFA50EE","user_header":"https://static001.geekbang.org/account/avatar/00/18/a8/54/06da255b.jpg","comment_is_top":false,"comment_ctime":1564788966,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564788966","product_id":100031801,"comment_content":"打卡","like_count":0}]}