{"id":535249,"title":"50｜RESTful Web Services（14）：分解任务与Setup测试","content":"<p>你好，我是徐昊。今天我们继续使用TDD的方式实现RESTful Web Services。</p><h2>回顾架构愿景与任务列表</h2><p>目前我们的架构愿景如下：</p><p><img src=\"https://static001.geekbang.org/resource/image/59/24/59ee2d534a4ae87623a736157e848924.jpg?wh=2284x1285\" alt=\"\"><br>\n<img src=\"https://static001.geekbang.org/resource/image/2e/a4/2ef7e84ba450b36d1df67cfce9e61da4.jpg?wh=2284x1285\" alt=\"\"></p><p>目前的任务列表为（仅列出与当前相关的模块），这里的列表我们合并了从ResourceServlet发现的需求，以及在第40讲中分解的任务：</p><ul>\n<li>\n<p>ResourceRouter</p>\n<ul>\n<li>在处理请求派分时，可以支持多级子资源（Sub-Resource）</li>\n<li>在处理请求派分时，可以根据客户端提供的超媒体类型，选择对应的资源方法（Resource Method）</li>\n<li>在处理请求派分时，可以根据客户端提供的Http方法，选择对应的资源方法</li>\n<li>资源方法可以返回Java对象，由Runtime自行推断正确的返回状态</li>\n<li>资源方法可以不明确指定返回的超媒体类型，由Runtime自行推断，比如，资源方法标注了Produces标注，那么就使用标注提供的超媒体类型等</li>\n<li>资源方法可按找期望的类型，访问Http请求的内容</li>\n<li>资源对象和资源方法可接受环境组件的注入</li>\n<li>将Resource Method的返回值包装为Response对象</li>\n</ul>\n</li>\n</ul><p>继续细化任务列表，根据架构愿景，分配到不同的模块：</p><ul>\n<li>\n<p>ResourceRouter</p>\n<ul>\n<li>\n<p>将Resource Method的返回值包装为Response对象</p>\n<ul>\n<li>根据与Path匹配结果，降序排列RootResource，选择第一个的RootResource</li>\n<li>如果没有匹配的RootResource，则构造404的Response</li>\n<li>如果返回的RootResource中无法匹配剩余Path，则构造404的Response</li>\n<li>如果ResourceMethod返回null，则构造204的Response</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>Resource/RootResource/ResourceMethod</p>\n<ul>\n<li>在处理请求派分时，可以支持多级子资源（Sub-Resource）</li>\n<li>在处理请求派分时，可以根据客户端提供的超媒体类型，选择对应的资源方法（Resource Method）</li>\n<li>在处理请求派分时，可以根据客户端提供的Http方法，选择对应的资源方法</li>\n<li>资源方法可以返回Java对象，由Runtime自行推断正确的返回状态</li>\n<li>资源方法可以不明确指定返回的超媒体类型，由Runtime自行推断，比如，资源方法标注了Produces标注，那么就使用标注提供的超媒体类型等</li>\n<li>资源方法可按找期望的类型，访问Http请求的内容</li>\n<li>资源对象和资源方法可接受环境组件的注入</li>\n</ul>\n</li>\n</ul><!-- [[[read_end]]] --><p>可以看到在当前架构愿景下，原本设计的需求被分入了Resource/RootResource/ResourceMethod模块中。</p><h2>视频演示</h2><p>下面进入今日的开发：</p><p><video poster=\"https://media001.geekbang.org/9191311f76844bd793edafef210e3b6a/snapshots/cb666fcb8f424ae4b9c5d64424fcc467-00005.jpg\" preload=\"none\" controls=\"\"><source src=\"https://media001.geekbang.org/customerTrans/7e27d07d27d407ebcc195a0e78395f55/4fd35fb9-181c8132c03-0000-0000-01d-dbacd.mp4\" type=\"video/mp4\"><source src=\" https://media001.geekbang.org/2f0b22219bec4d719a81120b78c4be78/dd2dfa4527dd4b25888d8fab1ae0606b-75aec43273dc87b001f4b8006b1feda7-sd.m3u8\" type=\"application/x-mpegURL\"></video></p><h2>思考题</h2><p>完成后的代码里其实是有一点问题的，请问问题出在哪儿？</p><p>欢迎把你的想法分享在留言区，也欢迎把你的项目代码分享出来。相信经过你的思考与实操，学习效果会更好！</p>","comments":[{"had_liked":false,"id":365906,"user_name":"忘川","can_delete":false,"product_type":"c1","uid":2140262,"ip_address":"上海","ucode":"812CBCEF735457","user_header":"https://static001.geekbang.org/account/avatar/00/20/a8/66/e2781d4a.jpg","comment_is_top":false,"comment_ctime":1673190824,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100109401,"comment_content":"应该是关注点太多了,前面准备上下文替身数据的准备过程复杂,会造成理解难度,而且制造这么多的测试数据,没有整理,对于后面的测试来说,不能复用,挺可惜的.","like_count":1}]}