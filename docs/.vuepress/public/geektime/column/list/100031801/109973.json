{"id":109973,"title":"05 | 原来浏览器还能抓取桌面？","content":"<p>无论是做音视频会议，还是做远程教育，<strong>共享桌面</strong>都是一个必备功能。如果说在 PC 或 Mac 端写个共享桌面程序你不会有太多感受，但通过浏览器也可以共享桌面是不是觉得就有些神奇了呢？</p><p>WebRTC的愿景就是要让这些看似神奇的事情，不知不觉地发生在我们身边。</p><p>你可以想象一下，假如浏览器有了共享桌面功能，这会使得浏览器有更广阔的应用空间，一个最直接的例子就是我们可以直接通过浏览器进行远程办公、远程协助等工作，而不用再下载共享桌面的应用了，这大大提高了我们的工作效率。</p><h2>在WebRTC 处理过程中的位置</h2><p>在正式进行主题之前，我们还是来看看本文在整个 WebRTC 处理过程中的位置，如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/c5/a0/c536a1dd0ed50008d2ada594e052d6a0.png?wh=1142*686\" alt=\"\"></p><center><span class=\"reference\">WebRTC处理过程图</span></center><p>没错，它仍然属于音视频采集的范畴，但是这次采集的不是音视频数据而是桌面。不过这也没什么关系，<strong>桌面也可以当作一种特殊的视频数据来看待</strong>。</p><h2>共享桌面的基本原理</h2><p>共享桌面的基本原理其实非常简单，我们可以分“两头”来说明：</p><ul>\n<li>对于<strong>共享者</strong>，每秒钟抓取多次屏幕（可以是3次、5次等），每次抓取的屏幕都与上一次抓取的屏幕做比较，取它们的差值，然后对差值进行压缩；如果是第一次抓屏或切幕的情况，即本次抓取的屏幕与上一次抓取屏幕的变化率超过80%时，就做全屏的帧内压缩，其过程与JPEG图像压缩类似（有兴趣的可以自行学习）。最后再将压缩后的数据通过传输模块传送到观看端；数据到达观看端后，再进行解码，这样即可还原出整幅图片并显示出来。</li>\n<li>对于<strong>远程控制端</strong>，当用户通过鼠标点击共享桌面的某个位置时，会首先计算出鼠标实际点击的位置，然后将其作为参数，通过信令发送给共享端。共享端收到信令后，会模拟本地鼠标，即调用相关的 API，完成最终的操作。一般情况下，当操作完成后，共享端桌面也发生了一些变化，此时就又回到上面共享者的流程了，我就不再赘述了。</li>\n</ul><!-- [[[read_end]]] --><p>通过上面的描述，可以总结出共享桌面的处理过程为：<strong>抓屏、压缩编码、传输、解码、显示、控制</strong>这几步，你应该可以看出它与音视频的处理过程几乎是一模一样的。</p><p>对于共享桌面，很多人比较熟悉的可能是<strong>RDP（Remote Desktop Protocal）协议</strong>，它是 Windows 系统下的共享桌面协议；还有一种更通用的远程桌面控制协议——<strong>VNC（Virtual Network Console）</strong>，它可以实现在不同的操作系统上共享远程桌面，像TeamViewer、RealVNC都是使用的该协议。</p><p>以上的远程桌面协议一般分为桌面数据处理与信令控制两部分。</p><ul>\n<li><strong>桌面数据</strong>：包括了桌面的抓取(采集)、编码（压缩）、传输、解码和渲染。</li>\n<li><strong>信令控制</strong>：包括键盘事件、鼠标事件以及接收到这些事件消息后的相关处理等。</li>\n</ul><p>其实在WebRTC中也可以实现共享远程桌面的功能。但由于共享桌面与音视频处理的流程是类似的，且<strong>WebRTC 的远程桌面</strong>又不需要远程控制，所以其<strong>处理过程使用了视频的方式，而非传统意义上的RDP/VNC等远程桌面协议</strong>。</p><p>下面我们就按顺序来具体分析一下，在桌面数据处理的各个环节中，WebRTC使用的方式与RDP/VNC等真正的远程桌面协议的异同点吧。</p><p><strong>第一个环节，共享端桌面数据的采集</strong>。WebRTC 对于桌面的采集与RDP/VNC使用的技术是相同的，都是利用各平台所提供的相关API进行桌面的抓取。以 Windows 为例，可以使用下列 API 进行桌面的抓取。</p><ul>\n<li><strong>BitBlt</strong>：XP 系统下经常使用，在 vista之后，开启DWM模式后，速度极慢。</li>\n<li><strong>Hook</strong>：一种黑客技术，实现稍复杂。</li>\n<li><strong>DirectX</strong>：由于DirectX 9/10/11 之间差别比较大，容易出现兼容问题。最新的 WebRTC都是使用的这种方式</li>\n<li><strong>GetWindowDC</strong>：可以通过它来抓取窗口。</li>\n</ul><p><strong>第二个环节，共享端桌面数据的编码</strong>。WebRTC 对桌面的编码使用的是视频编码技术，即 H264/VP8等；但RDP/VNC则不一样，它们使用的是图像压缩技术。使用视频编码技术的好处是压缩率高，而坏处是在网络不好的情况下会有模糊等问题。</p><p><strong>第三个环节，传输</strong>。编码后的桌面数据会通过流媒体传输协议发送到观看端。对于WebRTC来说，当网络有问题时，数据是可以丢失的。但对于 RDP/VNC 来说，桌面数据一定不能丢失。</p><p><strong>第四个环节，观看端解码</strong>。WebRTC 对收到的桌面数据通过视频解码技术解码，而 RDP/VNC 使用的是图像解码技术（可对比第二个环节）。</p><p><strong>第五个环节，观看端渲染</strong>。一般会通过 OpenGL/D3D等GPU进行渲染，这个 WebRTC 与 RDP/VNC 都是类似的。</p><p>通过以上的讲解，相信你应该已经对共享远程桌面有一个基本的认知了，并且也知道在浏览器下使用WebRTC 共享远程桌面，你只需要会使用浏览器提供的API即可。</p><p><strong>因此本文的目标就是：你只需要学会和掌握浏览器提供的抓取屏幕的API就可以了</strong>。至于编码、传输、解码等相关知识，我会在后面的文章中陆续为你讲解。</p><h2>如何共享桌面</h2><p>学习完共享桌面相关的理论知识，接下来，就让我们实践起来，一起来学习如何通过浏览器来抓取桌面吧！</p><h3>1. 抓取桌面</h3><p>首先我们先来了解一下在浏览器下抓取桌面的API的基本格式：</p><pre><code>var promise = navigator.mediaDevices.getDisplayMedia(constraints);\n</code></pre><p>这个API你看着是不是似曾相识？没错，它与前面<a href=\"https://time.geekbang.org/column/article/107948\">《01 | 原来通过浏览器访问摄像头这么容易》</a>一文中介绍的采集视频的 API 基本上是一样的，我们可以再看一下采集视频的 API 的样子：</p><pre><code>var promise = navigator.mediaDevices.getUserMedia(constraints);\n</code></pre><p>二者唯一的区别就是：一个是<strong>getDisaplayMedia</strong>，另一个是<strong>getUserMedia</strong>。</p><p>这两个API都需要一个<strong>constraints</strong>参数来对采集的桌面/视频做一些限制。但需要注意的是，在采集视频时，参数<strong>constraints</strong>也是可以对音频做限制的，而在桌面采集的参数里却不能对音频进行限制了，也就是说，不能在采集桌面的同时采集音频。<strong>这一点要特别注意</strong>。</p><p>下面我们就来看一下<strong>如何通过 getDisplayMedia API 来采集桌面</strong>：</p><pre><code>...\n\n//得到桌面数据流\nfunction getDeskStream(stream){\n        localStream = stream;\n}\n\n//抓取桌面\nfunction shareDesktop(){\n\n        //只有在 PC 下才能抓取桌面\n        if(IsPC()){\n                //开始捕获桌面数据\n                navigator.mediaDevices.getDisplayMedia({video: true})\n                        .then(getDeskStream)\n                        .catch(handleError);\n\n                return true;\n        } \n         \n        return false;\n         \n}  \n\n...\n</code></pre><p>通过上面的方法，就可以获得桌面数据了，让我们来看一下效果图吧：</p><p><img src=\"https://static001.geekbang.org/resource/image/ad/c2/ad24096591c33c5049fcc275491597c2.png?wh=1142*934\" alt=\"\"></p><center><span class=\"reference\">Chrome浏览器共享桌面图</span></center><h3>2. 桌面的展示</h3><p>桌面采集后，就可以通过 HTML 中的<code>&lt;video&gt;</code>标签将采集到的桌面展示出来，具体代码如下所示。</p><p>首先，在 HTML 中增加下面的代码，其中<code>&lt;video&gt;</code>标签用于播放抓取的桌面内容：</p><pre><code>...\n&lt;video autoplay playsinline id=&quot;deskVideo&quot;&gt;&lt;/video&gt;\n...\n</code></pre><p>下面的 JavaScript 则将桌面内容与<code>&lt;video&gt;</code>标签联接到一起：</p><pre><code> ...\n var deskVideo = document.querySelect(&quot;video/deskVideo&quot;);\n ...\n function getDeskStream(stream){\n        localStream = stream;\n        deskVideo.srcObject = stream;\n }\n ...\n</code></pre><p>在 JavaScript中调用<strong>getDisplayMedia</strong>方法抓取桌面数据，当桌面数据被抓到之后，会触发 getDeskStream 函数。我们再在该函数中将获取到的 stream 与video 标签联系起来，这样当数据获取到时就从播放器里显示出来了。</p><h3>3. 录制桌面</h3><p>录制本地桌面与<a href=\"https://time.geekbang.org/column/article/109105\">《04 | 可以把采集到的音视频数据录制下来吗？》</a>一文中所讲的录制本地视频的过程是一样的。首先通过<strong>getDisplayMedia</strong>方法获取到本地桌面数据，然后将该流当作参数传给 MediaRecorder 对象，并实现<strong>ondataavailable</strong>事件，最终将音视频流录制下来。</p><p>具体代码如下所示，我们先看一下 HTML 部分：</p><pre><code>&lt;html&gt;\n...\n&lt;body&gt;\n    ...\n    &lt;button id=&quot;record&quot;&gt;Start Record&lt;/button&gt;\n    ...\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre><p>上面的 HTML 代码片段定义了一个开启录制的<strong>button</strong>，当用户点击该 button 后，就触发下面的JavaScript 代码：</p><pre><code>...\n\nvar buffer;\n\n...\n\nfunction handleDataAvailable(e){\n        if(e &amp;&amp; e.data &amp;&amp; e.data.size &gt; 0){\n                buffer.push(e.data);\n        }\n}\n\nfunction startRecord(){\n        //定义一个数组，用于缓存桌面数据，最终将数据存储到文件中\n        buffer = [];\n\n        var options = {\n                mimeType: 'video/webm;codecs=vp8'\n        }\n\n        if(!MediaRecorder.isTypeSupported(options.mimeType)){\n                console.error(`${options.mimeType} is not supported!`);\n                return;\n        }\n\n        try{\n                //创建录制对象，用于将桌面数据录制下来\n                mediaRecorder = new MediaRecorder(localStream, options);\n        }catch(e){\n                console.error('Failed to create MediaRecorder:', e);\n                return;\n        }\n\n        //当捕获到桌面数据后，该事件触发\n        mediaRecorder.ondataavailable = handleDataAvailable;\n        mediaRecorder.start(10);\n}\n\n...\n</code></pre><p>当用户点击<strong>Record</strong>按钮的时候，就会调用<strong>startRecord</strong>函数。在该函数中首先判断浏览器是否支持指定的多媒体格式，如webm。 如果支持的话，再创建<strong>MediaRecorder</strong>对象，将桌面流录制成指定的媒体格式文件。</p><p>当从localStream获取到数据后，会触发<strong>ondataavailable</strong>事件。也就是会调用 handleDataAvailable 方法，最终将数据存放到Blob中。</p><p>至于将Blob保存成文件就比较容易了，我们在前面的文章<a href=\"https://time.geekbang.org/column/article/109105\">《04 | 可以把采集到的音视频数据录制下来吗？》</a>中都有讲解过，所以这里就不再赘述了！</p><h2>小结</h2><p>本文我向你讲解了如何通过浏览器提供的 API 来抓取桌面，并将它显示出来，以及如何通过前面所讲的<strong>MediaRecorder</strong>对象将桌面录制下来。</p><p>其实，真正的商用客户端录制并不是录制音视频流，而是录制桌面流。这样即使是多人互动的场景，在有多路视频流的情况下，录制桌面的同时就将桌面上显示的所有视频一起录制下来了，这样问题是不是一下就简单了？</p><p>比较遗憾的是，关于我们上述录制桌面的API，目前很多浏览器支持得还不够好，只有 Chrome 浏览器相对比较完善。不过现在WebRTC 1.0规范已经出来了，相信在不久的将来，各浏览器都会实现这个API的。</p><h2>思考时间</h2><p>为什么使用视频的编码方式就容易出现桌面模糊的现象呢？有什么办法可以解决该问题吗？</p><p>欢迎在留言区与我分享你的想法，也欢迎你在留言区记录你的思考过程。感谢阅读，如果你觉得这篇文章对你有帮助的话，也欢迎把它分享给更多的朋友。</p><p><a href=\"https://github.com/avdance/webrtc_web/tree/master/05_desktop/recorder\">所做Demo的GitHub链接（有需要可以点这里）</a></p><p></p>","neighbors":{"left":{"article_title":"04 | 可以把采集到的音视频数据录制下来吗？","id":109105},"right":{"article_title":"06 | WebRTC中的RTP及RTCP详解","id":109999}},"comments":[{"had_liked":false,"id":117431,"user_name":"恋着歌","can_delete":false,"product_type":"c1","uid":1001048,"ip_address":"","ucode":"CFDC00CB9965D9","user_header":"https://static001.geekbang.org/account/avatar/00/0f/46/58/31205087.jpg","comment_is_top":false,"comment_ctime":1564045798,"is_pvip":false,"replies":[{"id":"43023","content":"赞！","user_name":"作者回复","comment_id":117431,"uid":"1507837","ip_address":"","utype":1,"ctime":1564063016,"user_name_real":"garrylee"}],"discussion_count":2,"race_medal":0,"score":"48808686054","product_id":100031801,"comment_content":"如果是解决网络引起的模糊，那么可能就要牺牲实时性，提高延迟，就像我们看视频时卡顿要缓冲一下。<br><br>具体的解决方法是：<br>1，解决网络问题😂<br>2，关闭 Web RTC 的自适应码率，frameRate，width，height 设置固定值或高范围值。","like_count":11,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459967,"discussion_content":"赞！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564063016,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2176294,"avatar":"https://static001.geekbang.org/account/avatar/00/21/35/26/477839ef.jpg","nickname":"LST😘 CYX","note":"","ucode":"19859F5E4542C9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545163,"discussion_content":"抓取桌面时候，设置很高的frameRate，width，height ，没有丢包情况下，清晰度依然不够，虽然参数上很高，该怎么办","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641868625,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":154196,"user_name":"月光伴奏","can_delete":false,"product_type":"c1","uid":1651505,"ip_address":"","ucode":"F8CA499FEE0530","user_header":"https://static001.geekbang.org/account/avatar/00/19/33/31/8db0ff30.jpg","comment_is_top":false,"comment_ctime":1574390012,"is_pvip":false,"replies":[{"id":"59344","content":"不能用同一个 stream进行采集","user_name":"作者回复","comment_id":154196,"uid":"1507837","ip_address":"","utype":1,"ctime":1574501029,"user_name_real":"garrylee"}],"discussion_count":2,"race_medal":0,"score":"31639161084","product_id":100031801,"comment_content":"老师!文中(不能在采集桌面的同时采集音频),好像是能同时采集的,弹出了一个分享音频的选择框,勾上好像就能采集音频了","like_count":7,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475403,"discussion_content":"不能用同一个 stream进行采集","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574501029,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1880765,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/b2/bd/d9ffe75b.jpg","nickname":"空  心  菜","note":"","ucode":"BA281E96F5B56C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302559,"discussion_content":"我也发现可以进行分享音频，但是老师说不能用同一个，是为什么？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1598954273,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":144962,"user_name":"春风吹又生","can_delete":false,"product_type":"c1","uid":1282681,"ip_address":"","ucode":"F9D0CC2400E31C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJMsZRXU5AAdHHqMPMsjAMkpEHIa8hJRXdaIzoEtaicTaRGmFnh0cWzN1Y9lhaoNJz8iacyJvic8xopg/132","comment_is_top":false,"comment_ctime":1572140979,"is_pvip":false,"replies":[{"id":"56195","content":"你是指的播放了的多媒体文件的声音吧？是可以的！","user_name":"作者回复","comment_id":144962,"uid":"1507837","ip_address":"","utype":1,"ctime":1572321622,"user_name_real":"garrylee"}],"discussion_count":2,"race_medal":0,"score":"14457042867","product_id":100031801,"comment_content":"老师，webrtc能否录制系统内声音呢？","like_count":3,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472189,"discussion_content":"你是指的播放了的多媒体文件的声音吧？是可以的！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572321622,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1282681,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJMsZRXU5AAdHHqMPMsjAMkpEHIa8hJRXdaIzoEtaicTaRGmFnh0cWzN1Y9lhaoNJz8iacyJvic8xopg/132","nickname":"春风吹又生","note":"","ucode":"F9D0CC2400E31C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":41527,"discussion_content":"是的，谢谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572445563,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":261273,"user_name":"魏仁勋","can_delete":false,"product_type":"c1","uid":2018067,"ip_address":"","ucode":"48D3CA857B5E11","user_header":"","comment_is_top":false,"comment_ctime":1605255306,"is_pvip":false,"replies":[{"id":"95276","content":"感觉你在调用 vue时，没有真正调用到系统的 API，而是被封装了，你要自己查一下。还有一个种可能是你的electron用的chomre核版本太低了","user_name":"作者回复","comment_id":261273,"uid":"1507837","ip_address":"","utype":1,"ctime":1605768016,"user_name_real":"音视频专家-李超"}],"discussion_count":1,"race_medal":0,"score":"10195189898","product_id":100031801,"comment_content":"老师，我现在在用electron-vue写客户端，但是我想分享我的屏幕，结果报这个错误navigator.mediaDevices.getDisplayMedia is not a function，但是我是能看到视频和听到声音的，我之前在web是可以调的，请问这是为什么呢","like_count":2,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509437,"discussion_content":"感觉你在调用 vue时，没有真正调用到系统的 API，而是被封装了，你要自己查一下。还有一个种可能是你的electron用的chomre核版本太低了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605768016,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":243567,"user_name":"宇宙之王","can_delete":false,"product_type":"c1","uid":1981915,"ip_address":"","ucode":"5E6C28F8CCFF6D","user_header":"","comment_is_top":false,"comment_ctime":1598187967,"is_pvip":false,"replies":[{"id":"91439","content":"chrome对webrtc兼容的最好，共享桌面是一个试验性的功能，所以其它浏览器支持的不好；<br>adapter-latest.js 主要为了兼容老版本chrome浏览器；socket.io.js是 socket.io的js 客户端；","user_name":"作者回复","comment_id":243567,"uid":"1507837","ip_address":"","utype":1,"ctime":1600529533,"user_name_real":"音视频专家-李超"}],"discussion_count":2,"race_medal":0,"score":"10188122559","product_id":100031801,"comment_content":"是不是这一讲的代码只能在Chrome下面运行，别的浏览器不支持，我试了一下，edge和火狐获取不到桌面，另，看到所有代码里面都有&lt;script src=&quot;https:&#47;&#47;webrtc.github.io&#47;adapter&#47;adapter-latest.js&quot;&gt;&lt;&#47;script&gt;<br>        &lt;script src=&quot;https:&#47;&#47;cdnjs.cloudflare.com&#47;ajax&#47;libs&#47;socket.io&#47;2.0.3&#47;socket.io.js&quot;&gt;&lt;&#47;script&gt;<br>为什么要引入这两个js，删掉好像一样可以运行","like_count":2,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":504327,"discussion_content":"chrome对webrtc兼容的最好，共享桌面是一个试验性的功能，所以其它浏览器支持的不好；\nadapter-latest.js 主要为了兼容老版本chrome浏览器；socket.io.js是 socket.io的js 客户端；","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600529533,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1981915,"avatar":"","nickname":"宇宙之王","note":"","ucode":"5E6C28F8CCFF6D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":307234,"discussion_content":"谢谢老师，后两个脚本的意义已经搞懂了！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600565000,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":151922,"user_name":"月光伴奏","can_delete":false,"product_type":"c1","uid":1651505,"ip_address":"","ucode":"F8CA499FEE0530","user_header":"https://static001.geekbang.org/account/avatar/00/19/33/31/8db0ff30.jpg","comment_is_top":false,"comment_ctime":1573813584,"is_pvip":false,"replies":[{"id":"59354","content":"可以分别采集，然后入到同一个stream中。","user_name":"作者回复","comment_id":151922,"uid":"1507837","ip_address":"","utype":1,"ctime":1574502104,"user_name_real":"garrylee"}],"discussion_count":2,"race_medal":0,"score":"10163748176","product_id":100031801,"comment_content":"老师,也就是说webrtc这个分享时没办法实现分享系统声音的嘛？分享游戏听不到声音的嘛？","like_count":2,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474655,"discussion_content":"可以分别采集，然后入到同一个stream中。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574502104,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1651505,"avatar":"https://static001.geekbang.org/account/avatar/00/19/33/31/8db0ff30.jpg","nickname":"月光伴奏","note":"","ucode":"F8CA499FEE0530","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":58099,"discussion_content":"老师！分别采集放到同一个stream会不会造成音画不同步？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574652127,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":254392,"user_name":"Embrace","can_delete":false,"product_type":"c1","uid":2213620,"ip_address":"","ucode":"4BBBE68B99FCA6","user_header":"https://static001.geekbang.org/account/avatar/00/21/c6/f4/78170848.jpg","comment_is_top":false,"comment_ctime":1603110058,"is_pvip":false,"replies":[{"id":"94544","content":"webrtc1.0规范手册，网上查一下","user_name":"作者回复","comment_id":254392,"uid":"1507837","ip_address":"","utype":1,"ctime":1605003895,"user_name_real":"音视频专家-李超"}],"discussion_count":2,"race_medal":0,"score":"5898077354","product_id":100031801,"comment_content":"老师，按照demo写的，录下来的桌面视频好模糊，调整了分辨率和帧率也没啥用，分辨率太大了，录下来的视频会嵌套变成很多层；另外getDisplayMedia接口的具体参数在哪里能查到？ MDN的参数很简单，跟实际要用到的相比少了很多","like_count":1,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":507374,"discussion_content":"webrtc1.0规范手册，网上查一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605003895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1227188,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b9/b4/8b65959a.jpg","nickname":"🎏往事随风🎏","note":"","ucode":"D1A19195FCEAF0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379331,"discussion_content":"桌面视频不清晰，navigator.mediaDevices.getDisplayMedia()\n\t\t\t.then(gotMediaStream)\n\t\t\t.catch(handleError);\n\n把getDisplayMedia参数去掉就好了。\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623831535,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":120393,"user_name":"ZeroIce","can_delete":false,"product_type":"c1","uid":1305369,"ip_address":"","ucode":"30133BA83CE349","user_header":"https://static001.geekbang.org/account/avatar/00/13/eb/19/0d990b03.jpg","comment_is_top":false,"comment_ctime":1564878969,"is_pvip":false,"replies":[{"id":"44196","content":"getUserMedia API 中调整一下分辩率就好了！","user_name":"作者回复","comment_id":120393,"uid":"1507837","ip_address":"","utype":1,"ctime":1564919183,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"5859846265","product_id":100031801,"comment_content":"老师，录制的像素太低怎么办？","like_count":1,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461316,"discussion_content":"getUserMedia API 中调整一下分辩率就好了！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564919183,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":120389,"user_name":"ZeroIce","can_delete":false,"product_type":"c1","uid":1305369,"ip_address":"","ucode":"30133BA83CE349","user_header":"https://static001.geekbang.org/account/avatar/00/13/eb/19/0d990b03.jpg","comment_is_top":false,"comment_ctime":1564876784,"is_pvip":false,"replies":[{"id":"44197","content":"赞！","user_name":"作者回复","comment_id":120389,"uid":"1507837","ip_address":"","utype":1,"ctime":1564919198,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"5859844080","product_id":100031801,"comment_content":"交作业：https:&#47;&#47;codepen.io&#47;vicksiyi&#47;pen&#47;oKGJzL <br><br>&#47;&#47; 判断是否为PC端的Chrome<br>\tlet ifMachine = (() =&gt; {<br>\t\tvar ua = navigator.userAgent,<br>\t\t\tisWindowsPhone = &#47;(?:Windows Phone)&#47;.test(ua),<br>\t\t\tisSymbian = &#47;(?:SymbianOS)&#47;.test(ua) || isWindowsPhone,<br>\t\t\tisAndroid = &#47;(?:Android)&#47;.test(ua),<br>\t\t\tisFireFox = &#47;(?:Firefox)&#47;.test(ua),<br>\t\t\tisChrome = &#47;(?:Chrome|CriOS)&#47;.test(ua),<br>\t\t\tisTablet = &#47;(?:iPad|PlayBook)&#47;.test(ua) || (isAndroid &amp;&amp; !&#47;(?:Mobile)&#47;.test(ua)) || (isFireFox &amp;&amp; &#47;(?:Tablet)&#47;.test(ua)),<br>\t\t\tisPhone = &#47;(?:iPhone)&#47;.test(ua) &amp;&amp; !isTablet,<br>\t\t\tisPc = !isPhone &amp;&amp; !isAndroid &amp;&amp; !isSymbian;<br>\t\treturn {<br>\t\t\tisChrome: isChrome,<br>\t\t\tisPc: isPc<br>\t\t};<br>\t})();<br><br><br>","like_count":1,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461313,"discussion_content":"赞！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564919198,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117491,"user_name":"K","can_delete":false,"product_type":"c1","uid":1179273,"ip_address":"","ucode":"74A783491F6E95","user_header":"https://static001.geekbang.org/account/avatar/00/11/fe/89/ef7b5fe3.jpg","comment_is_top":false,"comment_ctime":1564059434,"is_pvip":true,"replies":[{"id":"43016","content":"赞！","user_name":"作者回复","comment_id":117491,"uid":"1507837","ip_address":"","utype":1,"ctime":1564062345,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"5859026730","product_id":100031801,"comment_content":"&#47;&#47;第一部分代码<br><br>let videoTypes = &quot;video&#47;webm\\;codecs=vp8&quot;;<br>let userMediaSetting = { video: true };<br>let playVideo = document.querySelector(&#39;video#play&#39;);<br>let rePlayVideo = document.querySelector(&#39;video#replay&#39;);<br>let recordingButton = document.querySelector(&#39;button#recording&#39;);<br>let playbackButton = document.querySelector(&#39;button#playback&#39;);<br>let downloadButton = document.querySelector(&#39;button#download&#39;);<br>let buffer;<br>let mediaRecorder;<br>let blob;<br><br>function init() {<br>    if (!(mediaSupport() &amp;&amp; mediaRecorderSupport()))<br>        return;<br>    getVideo();<br>}<br><br>function mediaSupport() {<br>    if (!navigator.mediaDevices) {<br>        console.log(&#39;不支持 mediaDevices&#39;);<br>        return false;<br>    }<br>    console.log(&#39;支持 mediaDevices&#39;);<br>    return true;<br>}<br><br>function mediaRecorderSupport() {<br>    if (!MediaRecorder.isTypeSupported(videoTypes)) {<br>        console.log(`不支持 ${videoTypes}`);<br>        return false;<br>    }<br>    console.log(`支持 ${videoTypes}`);<br>    return true;<br>}<br><br>function getVideo() {<br>    navigator.mediaDevices.getDisplayMedia(userMediaSetting)<br>        .then(handleGetVideo)<br>        .catch(handleGetVideoError)<br>}<br><br>function handleGetVideo(mediaStream) {<br>    playVideo.srcObject = mediaStream;<br>}<br><br>function handleGetVideoError(err) {<br>    console.log(`获取视频输入出错: ${err.name} : ${err.message}`)<br>}<br><br>function recordingVideo() {<br>    if ( typeof(mediaRecorder) != &quot;undefined&quot; &amp;&amp; mediaRecorder.state === &#39;recording&#39;) {<br>        console.log(&#39;已开始录制,请勿重复录制&#39;);<br>        return;<br>    }<br>    console.log(&#39;开始录制&#39;);<br>    buffer = [];<br>    let options = {<br>        mimeType : videoTypes<br>    };<br><br>    mediaRecorder = new MediaRecorder(playVideo.srcObject, options);<br>    mediaRecorder.ondataavailable = handleDataAvailable;<br>    mediaRecorder.start(10);<br>}<br><br>function handleDataAvailable(d) {<br>    if (d &amp;&amp; d.data &amp;&amp; d.data.size &gt; 0) {<br>        buffer.push(d.data);<br>    }<br>}","like_count":1,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459994,"discussion_content":"赞！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564062345,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":357509,"user_name":"| ~浑蛋~","can_delete":false,"product_type":"c1","uid":3024820,"ip_address":"新加坡","ucode":"B6904B44DFA805","user_header":"https://static001.geekbang.org/account/avatar/00/2e/27/b4/df65c0f7.jpg","comment_is_top":false,"comment_ctime":1663321398,"is_pvip":true,"discussion_count":0,"race_medal":3,"score":"1663321398","product_id":100031801,"comment_content":"为啥我的会出现一个一个图片，层层套娃地呈现出来呢","like_count":0},{"had_liked":false,"id":344608,"user_name":"Geek_e46272","can_delete":false,"product_type":"c1","uid":2342925,"ip_address":"","ucode":"FCE5BD40D197FE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/YnUO6TULqJ5WKVhrlE2icRwConvzxicI4Tia5YvMpYGjnS5ay4va2KpEJrBo1jLdGjd9s6zJ5swCW5oERgTg3uVhA/132","comment_is_top":false,"comment_ctime":1651667549,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1651667549","product_id":100031801,"comment_content":"图片编码每一帧都可以独立还原，视频编码丢失关键帧的话就只能马赛克了。怎么解决呢？","like_count":0},{"had_liked":false,"id":330218,"user_name":"LST😘 CYX","can_delete":false,"product_type":"c1","uid":2176294,"ip_address":"","ucode":"19859F5E4542C9","user_header":"https://static001.geekbang.org/account/avatar/00/21/35/26/477839ef.jpg","comment_is_top":false,"comment_ctime":1641868477,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1641868477","product_id":100031801,"comment_content":"采集桌面时，通过设置width,height,frameRate，参数上很高，也没丢包，但是清晰度依然不够，很模糊，怎么办<br>","like_count":0},{"had_liked":false,"id":324456,"user_name":"npersonal","can_delete":false,"product_type":"c1","uid":1337630,"ip_address":"","ucode":"060839D2BF5E33","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKOCkbWo7KTAUYkTk5sqgOSAdjS51ZH8bTxiaBNLVnIFUOMsicBHRJBoXSOX6sZp5uORE2waGyz3ysw/132","comment_is_top":false,"comment_ctime":1638441074,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638441074","product_id":100031801,"comment_content":"老师，想问下webrtc有提供api可以获取到屏幕、窗口这些实时流吗，想自己实现共享框","like_count":0},{"had_liked":false,"id":289648,"user_name":"caidy","can_delete":false,"product_type":"c1","uid":1188783,"ip_address":"","ucode":"AEFB529C32C7EE","user_header":"https://static001.geekbang.org/account/avatar/00/12/23/af/84f4714e.jpg","comment_is_top":false,"comment_ctime":1619108419,"is_pvip":false,"replies":[{"id":"105422","content":"这与你直播时的视频分辨率有关，你可以确定一下你直播时的分辨率是否与录制的分辨率一致","user_name":"作者回复","comment_id":289648,"uid":"1507837","ip_address":"","utype":1,"ctime":1619870842,"user_name_real":"音视频专家-李超"}],"discussion_count":1,"race_medal":0,"score":"1619108419","product_id":100031801,"comment_content":"录制的视频清晰度很差，这个要怎么解决呢？还有显示的时候清晰度也非常差","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518982,"discussion_content":"这与你直播时的视频分辨率有关，你可以确定一下你直播时的分辨率是否与录制的分辨率一致","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619870842,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":286334,"user_name":"CaptainJack","can_delete":false,"product_type":"c1","uid":1854952,"ip_address":"","ucode":"2630B57EE4DFCC","user_header":"https://static001.geekbang.org/account/avatar/00/1c/4d/e8/b94f7438.jpg","comment_is_top":false,"comment_ctime":1617259521,"is_pvip":false,"replies":[{"id":"104064","content":"要重新媒体协商一下试试","user_name":"作者回复","comment_id":286334,"uid":"1507837","ip_address":"","utype":1,"ctime":1617352495,"user_name_real":"音视频专家-李超"}],"discussion_count":1,"race_medal":0,"score":"1617259521","product_id":100031801,"comment_content":"请问，我这边做了一对一的视频连接，这个时候要共享桌面，拿到流之后，要怎么让对端看到这个流呢，我 stream.getTracks().forEach((track) =&gt; this.pc.addTrack(track, stream)) 之后，对端没有收到共享的流","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517951,"discussion_content":"要重新媒体协商一下试试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617352495,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":249885,"user_name":"白马","can_delete":false,"product_type":"c1","uid":1103540,"ip_address":"","ucode":"FD4DA715AC5984","user_header":"https://static001.geekbang.org/account/avatar/00/10/d6/b4/0808999d.jpg","comment_is_top":false,"comment_ctime":1600842976,"is_pvip":false,"replies":[{"id":"94551","content":"这个我没查过，你应该查查浏览器的配置是否可以做到","user_name":"作者回复","comment_id":249885,"uid":"1507837","ip_address":"","utype":1,"ctime":1605004406,"user_name_real":"音视频专家-李超"}],"discussion_count":1,"race_medal":0,"score":"1600842976","product_id":100031801,"comment_content":"李老师，如何实现默认录制全屏呢？按照您教的，录制的时候会弹出提示框让选择是录制桌面还是录制应用的界面。我现在希望直接录制桌面，不弹出选择框。","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506047,"discussion_content":"这个我没查过，你应该查查浏览器的配置是否可以做到","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605004406,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":249149,"user_name":"Ben","can_delete":false,"product_type":"c1","uid":1281885,"ip_address":"","ucode":"BC451666C9921D","user_header":"https://static001.geekbang.org/account/avatar/00/13/8f/5d/497992e9.jpg","comment_is_top":false,"comment_ctime":1600478985,"is_pvip":false,"replies":[{"id":"91436","content":"可以在服务端进行录制，那是一块比较大的知识点，本专栏没有介绍","user_name":"作者回复","comment_id":249149,"uid":"1507837","ip_address":"","utype":1,"ctime":1600529135,"user_name_real":"音视频专家-李超"}],"discussion_count":1,"race_medal":0,"score":"1600478985","product_id":100031801,"comment_content":"老师 本地桌面录制可以放在服务器上自动化吗？比如说在线教育的场景下，不想让学生和老师对录制过程有感知，所以把这个本地录制放到一个第三端中，在第三端录制本地桌面。但是chrome获取桌面视频流的时候好像必须要用户手动同意才行。","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505848,"discussion_content":"可以在服务端进行录制，那是一块比较大的知识点，本专栏没有介绍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600529135,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":242905,"user_name":"于你","can_delete":false,"product_type":"c1","uid":1626759,"ip_address":"","ucode":"6A3F8C38874410","user_header":"https://static001.geekbang.org/account/avatar/00/18/d2/87/e5f78961.jpg","comment_is_top":false,"comment_ctime":1597889041,"is_pvip":false,"replies":[{"id":"89673","content":"切换一下窗口就好了","user_name":"作者回复","comment_id":242905,"uid":"1507837","ip_address":"","utype":1,"ctime":1598018052,"user_name_real":"音视频专家-李超"}],"discussion_count":1,"race_medal":0,"score":"1597889041","product_id":100031801,"comment_content":"抓出来的屏幕不完整，而且全屏都是重叠，是要对constraints 做什么配置吗？","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":504128,"discussion_content":"切换一下窗口就好了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598018052,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":236924,"user_name":"itgou","can_delete":false,"product_type":"c1","uid":1394159,"ip_address":"","ucode":"4F6FFA0DD1ACBA","user_header":"https://wx.qlogo.cn/mmopen/vi_32/pTZS48zWWAhI0zGXrib8s124HSenCS2FTDD0r4SKCqw2ub4adicI4x2wTeH7bHdlsl8QwxeVmzTGs1PIImURxxPg/132","comment_is_top":false,"comment_ctime":1595586615,"is_pvip":false,"replies":[{"id":"87920","content":"webrtc不支持鼠标和键盘的控制，即使你用native也不支持","user_name":"作者回复","comment_id":236924,"uid":"1507837","ip_address":"","utype":1,"ctime":1596023754,"user_name_real":"音视频专家-李超"}],"discussion_count":2,"race_medal":0,"score":"1595586615","product_id":100031801,"comment_content":"如果是远程桌面控制，那么被控制端必须是客户端程序，因为浏览器没办法控制鼠标键盘的动作，我没理解错吧？老师","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":502254,"discussion_content":"webrtc不支持鼠标和键盘的控制，即使你用native也不支持","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596023754,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1394159,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/pTZS48zWWAhI0zGXrib8s124HSenCS2FTDD0r4SKCqw2ub4adicI4x2wTeH7bHdlsl8QwxeVmzTGs1PIImURxxPg/132","nickname":"itgou","note":"","ucode":"4F6FFA0DD1ACBA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295366,"discussion_content":"对，但是native可以引入其他库来支持鼠标和键盘的控制，这样的话，就可以实现远程控制了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596176087,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":227671,"user_name":"我母鸡啊！","can_delete":false,"product_type":"c1","uid":1633705,"ip_address":"","ucode":"7BFB14BC99E978","user_header":"https://static001.geekbang.org/account/avatar/00/18/ed/a9/662318ab.jpg","comment_is_top":false,"comment_ctime":1592450796,"is_pvip":false,"replies":[{"id":"84426","content":"你必须要有HTTPS证书才行","user_name":"作者回复","comment_id":227671,"uid":"1507837","ip_address":"","utype":1,"ctime":1592877350,"user_name_real":"音视频专家-李超"}],"discussion_count":1,"race_medal":0,"score":"1592450796","product_id":100031801,"comment_content":"mac下的 chrome 报错DOMException: Permission denied by system 没有权限可肿么办","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":498742,"discussion_content":"你必须要有HTTPS证书才行","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592877350,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":222410,"user_name":"Jessie","can_delete":false,"product_type":"c1","uid":1241378,"ip_address":"","ucode":"50FB29A445D371","user_header":"https://static001.geekbang.org/account/avatar/00/12/f1/22/d842d9c8.jpg","comment_is_top":false,"comment_ctime":1590799281,"is_pvip":false,"replies":[{"id":"84444","content":"这个不是录制一部分的，而是得到最终桌面的尺寸。现在浏览器不支持你说的那种，只要屏慕的一部分这咱需求。","user_name":"作者回复","comment_id":222410,"uid":"1507837","ip_address":"","utype":1,"ctime":1592879433,"user_name_real":"音视频专家-李超"}],"discussion_count":1,"race_medal":0,"score":"1590799281","product_id":100031801,"comment_content":"老师，这里有个疑问：<br>var constraints = {<br>\t\t\tvideo : {<br>\t\t\t\twidth: 640,\t<br>\t\t\t\theight: 480,<br>\t\t\t\tframeRate:15<br>\t\t\t}, <br>\t\t\taudio : false <br>\t\t}<br>这段设置，修改参数之后，并没有改变，依然是全屏录制，并没有截取一部分。<br>如何设置，仅录制屏幕的一部分呢？ ","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496784,"discussion_content":"这个不是录制一部分的，而是得到最终桌面的尺寸。现在浏览器不支持你说的那种，只要屏慕的一部分这咱需求。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592879433,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":156959,"user_name":"test","can_delete":false,"product_type":"c1","uid":1129610,"ip_address":"","ucode":"C57A175CBC6547","user_header":"https://static001.geekbang.org/account/avatar/00/11/3c/8a/900ca88a.jpg","comment_is_top":false,"comment_ctime":1575002325,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575002325","product_id":100031801,"comment_content":"因为带宽不够，而视频模糊一点也没事，不影响理解","like_count":0},{"had_liked":false,"id":155639,"user_name":"张旭","can_delete":false,"product_type":"c1","uid":1333441,"ip_address":"","ucode":"AAAB38225D9A83","user_header":"https://static001.geekbang.org/account/avatar/00/14/58/c1/6feb01c6.jpg","comment_is_top":false,"comment_ctime":1574731415,"is_pvip":false,"replies":[{"id":"60312","content":"的到你的桌面的track, 然后调用close 方法。","user_name":"作者回复","comment_id":155639,"uid":"1507837","ip_address":"","utype":1,"ctime":1575103776,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1574731415","product_id":100031801,"comment_content":"是否有办法能主动触发桌面流结束，现在做桌面采集后gpu升高，机器变卡，手动切换成采集摄像头内容，采集桌面流的进程似乎没有终止，机器依然很卡顿","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475816,"discussion_content":"的到你的桌面的track, 然后调用close 方法。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575103776,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127728,"user_name":"初音韶歌","can_delete":false,"product_type":"c1","uid":1585331,"ip_address":"","ucode":"2EA5EDE3693CCB","user_header":"https://static001.geekbang.org/account/avatar/00/18/30/b3/527f84de.jpg","comment_is_top":false,"comment_ctime":1566785213,"is_pvip":false,"replies":[{"id":"47578","content":"你切换一下窗口就好了，你可以想一下为什么会这样哈","user_name":"作者回复","comment_id":127728,"uid":"1507837","ip_address":"","utype":1,"ctime":1566878612,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1566785213","product_id":100031801,"comment_content":"老师，我的截取桌面播放的视频内容是嵌套的是怎么回事呢，就是一个桌面内容里又有n层小的内容","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464625,"discussion_content":"你切换一下窗口就好了，你可以想一下为什么会这样哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566878612,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":120115,"user_name":"相见恨晚","can_delete":false,"product_type":"c1","uid":1315722,"ip_address":"","ucode":"74415CD0D727C0","user_header":"https://static001.geekbang.org/account/avatar/00/14/13/8a/40459013.jpg","comment_is_top":false,"comment_ctime":1564794543,"is_pvip":false,"replies":[{"id":"44170","content":"第五篇文章的demo这两天就会有","user_name":"作者回复","comment_id":120115,"uid":"1507837","ip_address":"","utype":1,"ctime":1564851666,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1564794543","product_id":100031801,"comment_content":"大佬，4章以后的代码啥时候能提供，应该每章都有demo吧，再多的理论都不如代码来得实在。","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461204,"discussion_content":"第五篇文章的demo这两天就会有","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564851666,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":120074,"user_name":"ZeroIce","can_delete":false,"product_type":"c1","uid":1305369,"ip_address":"","ucode":"30133BA83CE349","user_header":"https://static001.geekbang.org/account/avatar/00/13/eb/19/0d990b03.jpg","comment_is_top":false,"comment_ctime":1564776718,"is_pvip":false,"replies":[{"id":"44090","content":"9月份","user_name":"作者回复","comment_id":120074,"uid":"1507837","ip_address":"","utype":1,"ctime":1564796375,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1564776718","product_id":100031801,"comment_content":"老师，课程大概什么时候可以完结？","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461195,"discussion_content":"9月份","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564796375,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118477,"user_name":"tommy_zhang","can_delete":false,"product_type":"c1","uid":1607132,"ip_address":"","ucode":"C995F39459467C","user_header":"","comment_is_top":false,"comment_ctime":1564372012,"is_pvip":false,"replies":[{"id":"43424","content":"不能！","user_name":"作者回复","comment_id":118477,"uid":"1507837","ip_address":"","utype":1,"ctime":1564388855,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1564372012","product_id":100031801,"comment_content":"老师，弹出的共享屏幕界面上内容能自定义吗？比如上面的文字&quot;xxx想要共享共享您屏幕上的内容&quot;","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460425,"discussion_content":"不能！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564388855,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117615,"user_name":"LongXiaJun","can_delete":false,"product_type":"c1","uid":1154688,"ip_address":"","ucode":"B5246BF0DAF4F7","user_header":"https://static001.geekbang.org/account/avatar/00/11/9e/80/b87f8b49.jpg","comment_is_top":false,"comment_ctime":1564102471,"is_pvip":false,"replies":[{"id":"43123","content":"打卡！打卡！","user_name":"作者回复","comment_id":117615,"uid":"1507837","ip_address":"","utype":1,"ctime":1564119082,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1564102471","product_id":100031801,"comment_content":"打卡<br>","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460053,"discussion_content":"打卡！打卡！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564119082,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117492,"user_name":"K","can_delete":false,"product_type":"c1","uid":1179273,"ip_address":"","ucode":"74A783491F6E95","user_header":"https://static001.geekbang.org/account/avatar/00/11/fe/89/ef7b5fe3.jpg","comment_is_top":false,"comment_ctime":1564059460,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1564059460","product_id":100031801,"comment_content":"&#47;&#47;第二部分<br><br>function playbackVideo(){<br>    blob = new Blob(buffer, {type:&#39;video&#47;webm&#39;});<br>    rePlayVideo.src = window.URL.createObjectURL(blob);<br>    rePlayVideo.srcObject = null;<br>    rePlayVideo.constructor = true;<br>    rePlayVideo.play();<br>}<br><br>function download(){<br>    blob = new Blob(buffer, {type:&#39;video&#47;webm&#39;});<br>    let a = document.createElement(&#39;a&#39;);<br>    a.href = window.URL.createObjectURL(blob);<br>    a.download = &#39;download.webm&#39;;<br>    a.click();<br>    a.remove();<br>}<br><br>recordingButton.addEventListener(&#39;click&#39;, function () {<br>    recordingVideo();<br>});<br><br>playbackButton.addEventListener(&#39;click&#39;, function () {<br>    playbackVideo();<br>});<br><br>downloadButton.addEventListener(&#39;click&#39;, function () {<br>    download();<br>});<br><br>init();","like_count":0},{"had_liked":false,"id":117400,"user_name":"Jason","can_delete":false,"product_type":"c1","uid":1053390,"ip_address":"","ucode":"ABB3F1A63E102A","user_header":"https://static001.geekbang.org/account/avatar/00/10/12/ce/a8c8b5e8.jpg","comment_is_top":false,"comment_ctime":1564040263,"is_pvip":false,"replies":[{"id":"43019","content":"如果是自适应码率，当发生丢包时，编码器会降低码率，当分辨率不变，码率变低时，就是模糊哈！","user_name":"作者回复","comment_id":117400,"uid":"1507837","ip_address":"","utype":1,"ctime":1564062517,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1564040263","product_id":100031801,"comment_content":"思考题：我猜一下，wenrtc底层主要使用udp传输，网络不好的情况下，会有丢包。所以会有模糊的现象发生。","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459949,"discussion_content":"如果是自适应码率，当发生丢包时，编码器会降低码率，当分辨率不变，码率变低时，就是模糊哈！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564062517,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117398,"user_name":"正向成长","can_delete":false,"product_type":"c1","uid":1197344,"ip_address":"","ucode":"AC4B5E719BA5CD","user_header":"https://static001.geekbang.org/account/avatar/00/12/45/20/24867e59.jpg","comment_is_top":false,"comment_ctime":1564040129,"is_pvip":false,"replies":[{"id":"43020","content":"是使用的https吗？","user_name":"作者回复","comment_id":117398,"uid":"1507837","ip_address":"","utype":1,"ctime":1564062540,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1564040129","product_id":100031801,"comment_content":"使用的chrome提示不支持navigator.mediaDevices.getDisplayMedia API，请问该如何解决？","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459947,"discussion_content":"是使用的https吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564062540,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117384,"user_name":"xiao豪","can_delete":false,"product_type":"c1","uid":1026417,"ip_address":"","ucode":"F7969A9785E37B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a9/71/78796fd5.jpg","comment_is_top":false,"comment_ctime":1564037135,"is_pvip":false,"replies":[{"id":"43022","content":"赞！","user_name":"作者回复","comment_id":117384,"uid":"1507837","ip_address":"","utype":1,"ctime":1564062951,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1564037135","product_id":100031801,"comment_content":"简单demo<br><br>var deskVideo = document.querySelector(&quot;video#deskVideo&quot;);<br>function getDeskStream(stream){<br>    deskVideo.srcObject = stream;<br>}<br><br>&#47;&#47; 对采集的数据做一些限制<br>var constraints = {<br>    video : {<br>            width: 1280,<br>            height: 720,<br>            frameRate:15,<br>    },<br>    audio : false<br>}<br><br>function handleError(err){<br>    console.log(&#39;getUserMedia error:&#39;, err);<br>}<br><br>function IsPC() {<br>    var userAgentInfo = navigator.userAgent;<br>    var Agents = [&quot;Android&quot;, &quot;iPhone&quot;, &quot;SymbianOS&quot;, &quot;Windows Phone&quot;, &quot;iPod&quot;, &quot;iPad&quot;];<br>    var flag = true;<br>    for (var i = 0; i &lt; Agents.length; i++) {<br>        if (userAgentInfo.indexOf(Agents[i]) &gt; 0) {<br>            flag = false;<br>            break;<br>        }<br>    }<br>    return flag;<br>};<br>&#47;&#47; 抓取桌面<br>function shareDesktop(){<br>    &#47;&#47; 只有在 PC 下才能抓取桌面<br>    if(IsPC()){<br>            &#47;&#47; 开始捕获桌面数据<br>            navigator.mediaDevices.getDisplayMedia(constraints)<br>                    .then(getDeskStream)<br>                    .catch(handleError);<br>            return true;<br>    } <br>    return false;<br>}  <br><br>var buffer;<br>&#47;&#47; 创建录制对象<br>var mediaRecorder;<br><br>function handleDataAvailable(e){<br>        if(e &amp;&amp; e.data &amp;&amp; e.data.size &gt; 0){<br>                buffer.push(e.data);<br>        }<br>}<br><br>function startRecord(){<br>        &#47;&#47; 定义一个数组，用于缓存桌面数据，最终将数据存储到文件中<br>        buffer = [];<br><br>        var options = {<br>                mimeType: &#39;video&#47;webm;codecs=vp8&#39;<br>        }<br><br>        if(!MediaRecorder.isTypeSupported(options.mimeType)){<br>                console.error(`${options.mimeType} is not supported!`);<br>                return;<br>        }<br><br>        try{<br>                &#47;&#47; 创建录制对象，用于将桌面数据录制下来<br>                mediaRecorder = new MediaRecorder(deskVideo.srcObject, options);<br>        }catch(e){<br>                console.error(&#39;Failed to create MediaRecorder:&#39;, e);<br>                return;<br>        }<br>        &#47;&#47; 当捕获到桌面数据后，该事件触发<br>        mediaRecorder.ondataavailable = handleDataAvailable;<br>        mediaRecorder.start(10);<br>}<br>document.querySelector(&quot;button#record&quot;).onclick = function (){<br>    startRecord();<br>}<br><br>shareDesktop()","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459939,"discussion_content":"赞！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564062951,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117338,"user_name":"许童童","can_delete":false,"product_type":"c1","uid":1003005,"ip_address":"","ucode":"4B799C0C6BC678","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg","comment_is_top":false,"comment_ctime":1564026026,"is_pvip":false,"replies":[{"id":"42984","content":"这个主题结束之后，会有一个完整的 demo","user_name":"作者回复","comment_id":117338,"uid":"1507837","ip_address":"","utype":1,"ctime":1564040907,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1564026026","product_id":100031801,"comment_content":"老师能否给一个能够完整跑起来的Demo。","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459920,"discussion_content":"这个主题结束之后，会有一个完整的 demo","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564040907,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117336,"user_name":"流浪剑客","can_delete":false,"product_type":"c1","uid":1201855,"ip_address":"","ucode":"0BDB4CA982446B","user_header":"https://static001.geekbang.org/account/avatar/00/12/56/bf/081631a8.jpg","comment_is_top":false,"comment_ctime":1564025313,"is_pvip":false,"replies":[{"id":"42985","content":"打卡！ 打卡！","user_name":"作者回复","comment_id":117336,"uid":"1507837","ip_address":"","utype":1,"ctime":1564040945,"user_name_real":"garrylee"}],"discussion_count":1,"race_medal":0,"score":"1564025313","product_id":100031801,"comment_content":"看完打卡","like_count":0,"discussions":[{"author":{"id":1507837,"avatar":"https://static001.geekbang.org/account/avatar/00/17/01/fd/69869646.jpg","nickname":"音视频专家-李超","note":"","ucode":"5557943CF28441","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459918,"discussion_content":"打卡！ 打卡！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564040945,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}