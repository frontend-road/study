{"id":468171,"title":"05ï½œä»£ç å°è£…ï¼ˆä¸Šï¼‰ï¼šå‡½æ•°æ˜¯å¦‚ä½•è¢«è°ƒç”¨çš„ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯äºèˆªã€‚</p><p>åœ¨å‰ä¸¤è®²ä¸­ï¼Œæˆ‘ä»‹ç»äº† C è¯­è¨€ä¸­çš„è¿ç®—ç¬¦ã€è¡¨è¾¾å¼ã€è¯­å¥æ˜¯å¦‚ä½•è¢«ç¼–è¯‘å™¨å®ç°çš„ã€‚ä¸çŸ¥ä½ æ˜¯å¦è¿˜è®°å¾—ï¼Œåœ¨ä»‹ç»è¿ç®—ç¬¦æ—¶ï¼Œæˆ‘æ²¡æœ‰å±•å¼€è®²è§£æœ‰å…³å‡½æ•°è°ƒç”¨è¿ç®—ç¬¦çš„å†…å®¹ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°±ç”¨ä¸“é—¨çš„ä¸¤è®²å†…å®¹ï¼Œæ¥å¸¦ä½ æ·±å…¥çœ‹çœ‹ C è¯­è¨€ä¸­æœ‰å…³å‡½æ•°è°ƒç”¨çš„é‚£äº›äº‹å„¿ã€‚</p><p>è¿™ä¸€è®²ï¼Œæˆ‘ä»¬é¦–å…ˆæ¥çœ‹ C è¯­è¨€ä¸­ï¼Œç¼–è¯‘å™¨å®ç°å‡½æ•°è°ƒç”¨æ—¶æ‰€éµå¾ªçš„ä¸€ç³»åˆ—è§„åˆ™ã€‚è¿™äº›è§„åˆ™å®é™…å½±å“ç€å‡½æ•°è°ƒç”¨æ—¶ï¼Œåœ¨å¦‚ä½•ä¼ å‚ã€å¦‚ä½•ä½¿ç”¨å¯„å­˜å™¨å’Œæ ˆå†…å­˜ç­‰é—®é¢˜ä¸Šçš„å¤„ç†ç»†èŠ‚ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œç”±äº C è¯­è¨€ä¸­çš„å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸æ ˆå†…å­˜å¯†åˆ‡ç›¸å…³ï¼Œæˆ‘è¿˜ä¼šä»‹ç»æ ˆå’Œæ ˆå¸§çš„æ¦‚å¿µã€‚æ ˆæ˜¯ C ç¨‹åºåœ¨è¿è¡Œæ—¶ç”¨äºå­˜æ”¾ä¸´æ—¶æ•°æ®çš„ä¸€å—å†…å­˜ï¼Œè€Œæ¯ä¸€ä¸ªæ ˆå¸§éƒ½å¯¹åº”ç€æ ˆå†…å­˜ä¸­çš„ä¸€æ®µæ•°æ®ï¼Œè¿™äº›æ•°æ®æ˜¯åœ¨å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­æ‰€å¿…é¡»ä½¿ç”¨çš„ã€‚é€šè¿‡è¿™ä¸€è®²çš„å­¦ä¹ ï¼Œä½ èƒ½äº†è§£åˆ°ç¼–è¯‘å™¨å¯¹ C å‡½æ•°è°ƒç”¨çš„å¤„ç†ç»†èŠ‚ã€‚è€Œåœ¨ä¸‹ä¸€è®²ä¸­ï¼Œæˆ‘ä»¬å°†ä»¥æ­¤ä¸ºåŸºç¡€ï¼Œæ¥æ·±å…¥æ¢è®¨å°¾é€’å½’è°ƒç”¨ä¼˜åŒ–ç­‰æ›´å¤šå‡½æ•°è°ƒç”¨çš„ç›¸å…³å†…å®¹ã€‚</p><h2>å¿«é€Ÿå›é¡¾ C è¯­è¨€ä¸­å‡½æ•°çš„ä½¿ç”¨æ–¹å¼</h2><p>å‡½æ•°çš„æ¦‚å¿µç›¸ä¿¡ä½ å·²ç»ååˆ†ç†Ÿæ‚‰äº†ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆæ¥å¿«é€Ÿå›é¡¾ä¸€ä¸‹ã€‚</p><p>åœ¨ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå‡½æ•°æ˜¯ä¸€ç§ç”¨äºå°è£…å¯é‡ç”¨ä»£ç çš„è¯­æ³•ç»“æ„ã€‚å‡½æ•°å¯ä»¥æ¥æ”¶ä»å¤–éƒ¨è°ƒç”¨ç¯å¢ƒä¼ å…¥çš„æ•°æ®ï¼Œå¹¶åœ¨å‡½æ•°ä½“å†…ä»¥å¤åˆè¯­å¥çš„å½¢å¼ï¼Œä½¿ç”¨è¿™äº›æ•°æ®æ„å»ºç‹¬ç«‹çš„åŠŸèƒ½é€»è¾‘å•å…ƒã€‚<strong>å€ŸåŠ©å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªç¨‹åºçš„å®ç°è¿‡ç¨‹æ‹†åˆ†ä¸ºå¤šä¸ªå­æ­¥éª¤ï¼Œå¹¶ä»¥ç»“æ„åŒ–çš„æ–¹å¼æ¥æ„å»ºç¨‹åºã€‚</strong>è¿™ç§æ–¹å¼å¯ä»¥å‡å°‘ç¨‹åºä¸­çš„é‡å¤ä»£ç ï¼Œå¹¶é€šè¿‡æŠ½è±¡å’Œæ›¿æ¢æ¥æé«˜ä»£ç çš„æ•´ä½“å¯è¯»æ€§ï¼Œä»¥åŠå¯è¿½æº¯æ€§ã€‚</p><!-- [[[read_end]]] --><p>åœ¨ C è¯­è¨€ä¸­ï¼Œå‡½æ•°çš„å®šä¹‰ä¸ä½¿ç”¨æ–¹å¼è·Ÿå…¶ä»–è¯­è¨€å¤§åŒå°å¼‚ï¼Œæˆ‘ä»¬å…ˆé€šè¿‡ä¸€ä¸ªä¾‹å­å¿«é€Ÿå›é¡¾ä¸€ä¸‹ã€‚è¿™é‡Œï¼Œä½ å¯ä»¥å…ˆåœä¸‹æ¥ï¼Œå°è¯•ç¼–è¯‘å’Œè¿è¡Œä¸‹é¢è¿™æ®µä»£ç ï¼Œå¹¶è§‚å¯Ÿå…¶ä¸­çš„å‡½æ•°è°ƒç”¨é€»è¾‘ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨ç¼–è¯‘æ—¶ï¼Œæˆ‘ä»¬è¦ä¸ºç¼–è¯‘å™¨æŒ‡å®š â€œ-lmâ€ å‚æ•°ï¼Œæ¥è®©å®ƒé“¾æ¥ç¨‹åºè¿è¡Œæ‰€éœ€è¦çš„æ•°å­¦åº“ã€‚</p><pre><code class=\"language-c++\">#include &lt;stdio.h&gt;\n#include &lt;tgmath.h&gt;\ntypedef struct {\n&nbsp; int x;\n&nbsp; int y;\n} Point;\nint foo(int x, int y, Point* p, int(handler)(int)) {\n&nbsp; return handler(x + y + p-&gt;x + p-&gt;y);\n}\nint handler(int n) {\n&nbsp; return sqrt(n);\n}\nint main(void) {\n&nbsp; int x = 2;\n&nbsp; int y = 3;\n&nbsp; Point p = { .x = 10, .y = 10 };\n&nbsp; printf(\"%d\", foo(x, y, &amp;p, handler));&nbsp; // 5.\n&nbsp; return 0;\n}&nbsp;\n</code></pre><p>åœ¨ C è¯­è¨€ä¸­ï¼Œå‡½æ•°æœ‰ä¸¤ç§ä¼ é€’å‚æ•°çš„æ–¹å¼ï¼Œå³é€šè¿‡â€œå€¼â€ä¼ é€’å’Œé€šè¿‡â€œæŒ‡é’ˆâ€ä¼ é€’ã€‚å…¶ä¸­ï¼Œå¯¹äºå€¼ä¼ é€’çš„æ–¹å¼ï¼Œç¼–è¯‘å™¨ä¼šåœ¨å‡½æ•°è°ƒç”¨æ—¶ï¼Œå°†ä¼ å…¥å‡½æ•°çš„å‚æ•°å€¼è¿›è¡Œå¤åˆ¶ã€‚å› æ­¤ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè°ƒç”¨æ—¶ä¼ å…¥å‡½æ•°çš„å‚æ•°ä¸åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨çš„å‚æ•°æ˜¯ä¸¤ä¸ªä¸åŒçš„å®ä½“ã€‚è€Œä½¿ç”¨æŒ‡é’ˆå½¢å¼ä¼ å…¥çš„å‚æ•°ï¼Œå› ä¸ºæŒ‡é’ˆæ‰€è¡¨ç¤ºçš„åœ°å€åœ¨ä¼ å…¥å‡½æ•°å‰åå‡ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥å¦‚æœåœ¨å‡½æ•°å†…éƒ¨ä¿®æ”¹æŒ‡é’ˆå‚æ•°æ‰€æŒ‡å‘çš„å€¼ï¼Œåˆ™å‘ç”Ÿåœ¨è¯¥å€¼ä¸Šçš„å˜åŒ–ï¼Œåœ¨å‡½æ•°è°ƒç”¨å®Œæˆåä¹Ÿå°†ä¸€ç›´å­˜åœ¨ã€‚</p><p>è¿™é‡Œåœ¨ä»£ç ä¸­ï¼Œå‡½æ•° foo ä¸€å…±æ¥æ”¶äº†å››ä¸ªå‚æ•°ï¼Œå…¶ä¸­æ•´å‹å‚æ•° x ä¸ y å‡ä»¥å€¼çš„æ–¹å¼ä¼ é€’ã€‚è€Œå¯¹äºç´§æ¥ç€çš„ç»“æ„ä½“ä¸å‡½æ•°ç±»å‹çš„å‚æ•°ï¼Œå®ƒä»¬å¯¹åº”çš„å˜é‡ p ä¸ handler åˆ™ä»¥æŒ‡é’ˆçš„å½¢å¼ä¼ é€’ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºå‡½æ•°æŒ‡é’ˆæ¥è¯´ï¼Œå¯ä»¥åœ¨å£°æ˜å’Œè°ƒç”¨æ—¶ä¸ºå…¶çœç•¥é€šå¸¸ç”¨äºè¡¨æ˜æŒ‡é’ˆç±»å‹çš„ â€œ*â€ ç¬¦å·ã€‚è¿™æ„å‘³ç€å‡½æ•° foo çš„å®šä¹‰ä¹Ÿå¯ä»¥å†™æˆå¦‚ä¸‹å½¢å¼ï¼š</p><pre><code class=\"language-c++\">int foo(int x, int y, Point* p, int(*handler)(int)) {\n&nbsp; return (*handler)(x + y + p-&gt;x + p-&gt;y);\n}\n</code></pre><h2>C å‡½æ•°çš„è°ƒç”¨çº¦å®š</h2><p>æˆ‘åœ¨<a href=\"https://time.geekbang.org/column/article/465228\"> 02 è®² </a>ä¸­å’Œä½ æåˆ°è¿‡ï¼ŒC æ ‡å‡†ä¸­å¹¶æœªè§„å®šï¼Œè¯­è¨€çš„å„ç±»è¯­æ³•ç»“æ„åº”è¯¥ä»¥æ€æ ·çš„æ–¹å¼æ¥å®ç°ã€‚ä½†å®é™…ä¸Šï¼Œä»ç¼–è¯‘å™¨çš„è§’åº¦æ¥çœ‹ï¼Œæ¯ä¸€ä¸ªå‡½æ•°åœ¨è¢«è°ƒç”¨æ—¶ï¼Œåº”è¯¥ä»¥æ€æ ·çš„æ–¹å¼é€šè¿‡æœºå™¨æŒ‡ä»¤æ¥å®ç°å…¶è°ƒç”¨è¿‡ç¨‹ï¼Œå´å­˜åœ¨ç€ç›¸åº”çš„äº‹å®æ ‡å‡†ã€‚è€Œé€šå¸¸ï¼Œæˆ‘ä»¬æŠŠç¼–è¯‘å™¨å®ç°å‡½æ•°è°ƒç”¨æ—¶æ‰€éµå¾ªçš„ä¸€ç³»åˆ—è§„åˆ™ç§°ä¸ºå‡½æ•°çš„â€œè°ƒç”¨çº¦å®šï¼ˆCalling Conventionï¼‰â€ã€‚</p><p>è°ƒç”¨çº¦å®šè§„å®šäº†å‡½æ•°è°ƒç”¨æ—¶éœ€è¦å…³æ³¨çš„ä¸€ç³»åˆ—é—®é¢˜ï¼Œæ¯”å¦‚ï¼šå¦‚ä½•å°†å®å‚ä¼ é€’ç»™è¢«è°ƒç”¨å‡½æ•°ã€å¦‚ä½•å°†è¿”å›å€¼ä»è¢«è°ƒç”¨å‡½æ•°ä¸­è¿”å›ã€å¦‚ä½•ç®¡ç†å¯„å­˜å™¨ï¼Œä»¥åŠå¦‚ä½•ç®¡ç†æ ˆå†…å­˜ï¼Œç­‰ç­‰ã€‚è°ƒç”¨çº¦å®šå¹¶é C è¯­è¨€æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤å®é™…ä¸Šæ¯ä¸ªç¼–è¯‘å™¨éƒ½å¯ä»¥ä½¿ç”¨è‡ªå·±ç‹¬æœ‰çš„è°ƒç”¨çº¦å®šï¼Œæ¥å®ç° C å‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹ã€‚ä½†ç›¸åº”åœ°ï¼Œè¿™ä¹Ÿä¼šå¯¼è‡´å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼šå½“å…·æœ‰å¤–éƒ¨é“¾æ¥çš„å‡½æ•°åœ¨å¤šä¸ªä¸åŒç¼–è¯‘å•å…ƒå†…è¢«ä½¿ç”¨ï¼Œä¸”è¿™äº›ä¸åŒç¼–è¯‘å•å…ƒå¯¹åº”çš„æºæ–‡ä»¶é€šè¿‡ä¸åŒçš„ç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘æ—¶ï¼Œé‚£ä¹ˆå®ƒä»¬å„è‡ªç”Ÿæˆçš„å¯¹è±¡æ–‡ä»¶å¯èƒ½æ— æ³•å†è¢«æ•´åˆåœ¨ä¸€èµ·ï¼Œå¹¶ç”Ÿæˆæœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œå¯¹äº C è¯­è¨€æ¥è¯´ï¼Œè¿è¡Œåœ¨ x86-64 å¹³å°ä¸Šçš„ç¼–è¯‘å™¨åŸºæœ¬éƒ½ä¼šæ ¹æ®æ‰€åœ¨æ“ä½œç³»ç»Ÿçš„ä¸åŒï¼Œé€‰æ‹©ä½¿ç”¨å‡ ç§å¸¸è§çš„è°ƒç”¨çº¦å®šäº‹å®æ ‡å‡†ã€‚æ¯”å¦‚ï¼Œå¯¹äº Windows æ¥è¯´ï¼Œç¼–è¯‘å™¨ä¼šé‡‡ç”¨ä¸“æœ‰çš„ Microsoft x64 æˆ– Vector è°ƒç”¨çº¦å®šã€‚è€Œåœ¨ Unix å’Œç±» Unix ç³»ç»Ÿä¸Šï¼Œåˆ™ä¼šä½¿ç”¨åä¸º System V AMD64 ABIï¼ˆåç®€ç§° â€œSysVâ€ï¼‰çš„è°ƒç”¨çº¦å®šã€‚ç±»ä¼¼åœ°ï¼Œå¯¹äº i386ï¼ˆIA32ï¼‰ã€8086 ç­‰å…¶ä»–å¹³å°ï¼Œå®ƒä»¬ä¹Ÿéƒ½æœ‰ç€å¯¹åº”çš„è°ƒç”¨çº¦å®šäº‹å®æ ‡å‡†ã€‚<strong>è€Œè¾ƒä¸ºç»Ÿä¸€çš„è°ƒç”¨çº¦å®šï¼Œä¹Ÿåœ¨ä¸€å®šç¨‹åº¦ä¸Šä¿è¯äº† C ç¨‹åºåœ¨åŒä¸€å¹³å°ä¸åŒç¼–è¯‘å™¨ä¸‹çš„æœ€å¤§å¯ç§»æ¤æ€§ã€‚</strong></p><p>æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ SysV è°ƒç”¨çº¦å®šä¸­éƒ½è§„å®šäº†å“ªäº›é‡è¦çš„å®ç°ç»†èŠ‚ã€‚ä¸ºäº†æ›´ç›´è§‚åœ°è§‚å¯Ÿè¿™äº›å†…å®¹ï¼Œè®©æˆ‘ä»¬å…ˆæ¥ç¼–å†™ä¸€æ®µç®€å•çš„ C ä»£ç ï¼Œå¹¶åœ¨ x86-64 å¹³å°ä¸Šä½¿ç”¨é»˜è®¤ä¼˜åŒ–ç­‰çº§ï¼Œé€šè¿‡ GCC ç¼–è¯‘ç”Ÿæˆå®ƒæ‰€å¯¹åº”çš„æ±‡ç¼–ä»£ç ã€‚å…·ä½“å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆåœ¨åé¢æåˆ°è¿™å¼ å›¾æ—¶ï¼Œæˆ‘ä¼šç»Ÿä¸€ç”¨â€œå›¾ Aâ€ä»£æ›¿ï¼‰ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/9c/28/9ca51546a4d204c6e5d5da2674c2a928.png?wh=1544x1686\" alt=\"å›¾ç‰‡\"></p><p>åœ¨ä¸Šå›¾ä¸­ï¼Œå·¦ä¾§ä¸º C ä»£ç ï¼Œå³ä¾§ä¸ºå¯¹åº”çš„æ±‡ç¼–ä»£ç ï¼Œç›¸åŒé¢œè‰²çš„ä»£ç å—è¡¨ç¤ºæºä»£ç ä¸æ±‡ç¼–ä»£ç ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚åœ¨ C ä»£ç ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†åä¸º bar ä¸ foo çš„ä¸¤ä¸ªå‡½æ•°ï¼Œå¹¶åœ¨ foo ä¸­è°ƒç”¨äº† barã€‚bar å‡½æ•°ä¸æ¥æ”¶ä»»ä½•å‚æ•°ï¼Œè°ƒç”¨åç›´æ¥è¿”å›æ•´å‹å€¼ 10ã€‚foo å‡½æ•°å…±æ¥æ”¶ 8 ä¸ªå‚æ•°ï¼Œè°ƒç”¨åè¿”å›å…¶å†…éƒ¨æ•´å‹å˜é‡ n ä¸å‡½æ•° bar è°ƒç”¨è¿”å›å€¼çš„å’Œã€‚åœ¨ main å‡½æ•°ä¸­ï¼Œå®šä¹‰æœ‰ä¸¤ä¸ªæ•´å‹å±€éƒ¨å˜é‡ x ä¸ yï¼Œè€Œå½“å‡½æ•° foo è¢«è°ƒç”¨æ—¶ï¼Œç›´æ¥ä½¿ç”¨è¿™ä¸¤ä¸ªå±€éƒ¨å˜é‡ï¼Œä»¥åŠå¦å¤–çš„ 6 ä¸ªå­—é¢é‡æ•°å­—å€¼ä½œä¸ºå®ƒçš„å‚æ•°ã€‚</p><p>å®é™…ä¸Šï¼Œåœ¨ x86-64 çš„æœºå™¨æŒ‡ä»¤ä¸­ï¼Œå‡½æ•°è°ƒç”¨æ˜¯é€šè¿‡ <code>call</code> æŒ‡ä»¤æ¥å®Œæˆã€‚è€Œæ¯ä¸€ä¸ªå‡½æ•°ä½“åœ¨æ‰§è¡Œå®Œæ¯•åï¼Œéƒ½éœ€è¦å†é€šè¿‡ <code>ret</code> æŒ‡ä»¤æ¥é€€å‡ºå‡½æ•°çš„æ‰§è¡Œï¼Œå¹¶è½¬ç§»ä»£ç æ‰§è¡Œæµç¨‹åˆ°ä¹‹å‰å‡½æ•°è°ƒç”¨æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤ä¸Šã€‚ä½ å¯ä»¥é€šè¿‡ä¸‹é¢è¿™å¼ å›¾æ¥ç›´è§‚åœ°æ„Ÿå—è¿™ä¸ªæµç¨‹ã€‚å…¶ä¸­ï¼Œç®­å¤´æ ‡æ³¨å‡ºäº†ä»£ç çš„æ•´ä½“æ‰§è¡Œé¡ºåºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/c9/b0/c906a7d607fcc4cd74b97df718a80cb0.jpg?wh=1920x661\" alt=\"å›¾ç‰‡\"></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å…·ä½“çœ‹çœ‹ SysV è°ƒç”¨çº¦å®šä¸­éƒ½è§„å®šäº†å‡½æ•°è°ƒç”¨æ—¶çš„å“ªäº›å†…å®¹ã€‚</p><h3>å‚æ•°ä¼ é€’</h3><p>SysV è°ƒç”¨çº¦å®šçš„ç¬¬ä¸€ä¸ªè§„åˆ™æ˜¯ï¼šåœ¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œå¯¹äºæ•´å‹å’ŒæŒ‡é’ˆç±»å‹çš„å®å‚ï¼Œéœ€è¦åˆ†åˆ«ä½¿ç”¨å¯„å­˜å™¨ rdiã€rsiã€rdxã€rcxã€r8ã€r9ï¼ŒæŒ‰å‡½æ•°å®šä¹‰æ—¶å‚æ•°ä»å·¦åˆ°å³çš„é¡ºåºè¿›è¡Œä¼ å€¼ã€‚è€Œè‹¥ä¸€ä¸ªå‡½æ•°æ¥æ”¶çš„å‚æ•°è¶…è¿‡äº† 6 ä¸ªï¼Œåˆ™ä½™ä¸‹å‚æ•°å°†é€šè¿‡æ ˆå†…å­˜è¿›è¡Œä¼ é€ã€‚æ­¤æ—¶ï¼Œå¤šå‡ºæ¥çš„å‚æ•°å°†æŒ‰ç…§ä»å³å¾€å·¦ï¼ˆRTLï¼‰çš„é¡ºåºè¢«é€ä¸ªå‹å…¥æ ˆä¸­ã€‚å…³äºè¿™ä¸€ç‚¹ï¼Œä½ å¯ä»¥é€šè¿‡å›¾ A å³ä¾§ç¬¬ 30 åˆ° 40 è¡Œçº¢æ¡†å†…çš„æ±‡ç¼–ä»£ç å¾—åˆ°éªŒè¯ã€‚</p><p>è¿™é‡Œï¼Œå‡½æ•° foo åœ¨è°ƒç”¨å‰ï¼Œåˆ†åˆ«ç”¨å¯„å­˜å™¨ ediã€esi å­˜æ”¾å±€éƒ¨å˜é‡ x ä¸ y çš„å€¼ï¼Œå¹¶ç”¨å¯„å­˜å™¨ edxã€ecxã€r8dã€r9d å­˜æ”¾å­—é¢é‡å€¼ 3ã€4ã€5ã€6ï¼ˆå¦‚æœä½ è¿˜ä¸äº†è§£å¯„å­˜å™¨ rdi ä¸ edi çš„å…³ç³»ï¼Œå¯ä»¥åœ¨<a href=\"https://time.geekbang.org/column/article/464543\">è¯¾å‰çƒ­èº«</a>ä¸€è®²ä¸­å¾—åˆ°ç­”æ¡ˆï¼‰ã€‚è€Œå¤šå‡ºæ¥çš„å¦å¤–ä¸¤ä¸ªå­—é¢é‡å€¼å‚æ•° 7 å’Œ 8 ï¼Œåˆ™ç›´æ¥é€šè¿‡ <code>push</code> æŒ‡ä»¤è¢«æ”¾åœ¨äº†æ ˆå†…å­˜ä¸­ã€‚ä½ éœ€è¦æ³¨æ„è¿™é‡ŒæŒ‡ä»¤æ“ä½œå®ƒä»¬çš„å…ˆåé¡ºåºï¼Œå› ä¸ºè¦ä¿è¯è¿™äº›å‚æ•°ä»¥ä»å³å‘å·¦çš„é¡ºåºè¢«æ”¾å…¥æ ˆä¸­ã€‚å¦å¤–ï¼Œç”±äº xã€y ä¸ºå±€éƒ¨å˜é‡ï¼Œå› æ­¤æœ€å¼€å§‹å®ƒä»¬ä¼šè¢«å­˜å‚¨åœ¨æ ˆå†…å­˜ä¸­ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œå¯¹äºæµ®ç‚¹å‚æ•°ï¼Œç¼–è¯‘å™¨å°†ä¼šä½¿ç”¨å¦å¤–çš„ xmm0åˆ°xmm7ï¼Œå…± 8 ä¸ªå¯„å­˜å™¨è¿›è¡Œå­˜å‚¨ã€‚å¯¹äºæ›´å®½çš„å€¼ï¼Œä¹Ÿå¯èƒ½ä¼šä½¿ç”¨ ymm ä¸ zmm å¯„å­˜å™¨æ¥æ›¿ä»£ xmm å¯„å­˜å™¨ã€‚è€Œä¸Šé¢æåˆ°çš„ xmmã€ymmã€zmm å¯„å­˜å™¨ï¼Œéƒ½æ˜¯ç”± x86 æŒ‡ä»¤é›†æ¶æ„ä¸­åä¸º AVXï¼ˆAdvanced Vector Extensionsï¼‰çš„æ‰©å±•æŒ‡ä»¤é›†ä½¿ç”¨çš„ã€‚è¿™äº›æŒ‡ä»¤é›†ä¸€èˆ¬ä¸“é—¨ç”¨äºæµ®ç‚¹æ•°è®¡ç®—ä»¥åŠ SIMD ç›¸å…³çš„å¤„ç†è¿‡ç¨‹ã€‚</p><h3>è¿”å›å€¼ä¼ é€’</h3><p>å¯¹äºå‡½æ•°è°ƒç”¨äº§ç”Ÿçš„è¿”å›å€¼ï¼ŒSysV è°ƒç”¨çº¦å®šä¹Ÿæœ‰ç›¸åº”çš„è§„åˆ™ï¼šå½“å‡½æ•°è°ƒç”¨äº§ç”Ÿæ•´æ•°ç±»å‹çš„è¿”å›å€¼ï¼Œä¸”å°äºç­‰äº 64 ä½æ—¶ï¼Œé€šè¿‡å¯„å­˜å™¨ rax è¿›è¡Œä¼ é€’ï¼›å½“å¤§äº 64 ä½ï¼Œå°äºç­‰äº 128 ä½æ—¶ï¼Œåˆ™ä½¿ç”¨å¯„å­˜å™¨ rax ä¸ rdx åˆ†åˆ«å­˜å‚¨è¿”å›å€¼çš„ä½ 64 ä½ä¸é«˜ 64 ä½ã€‚ä½ å¯ä»¥å‚è€ƒå›¾ A å³ä¾§ç¬¬ 4ã€21ã€47 è¡Œè“æ¡†å†…çš„ä»£ç ï¼Œæ¥éªŒè¯è¿™ä¸ªè§„åˆ™ã€‚è¿™ä¸‰è¡Œä»£ç åˆ†åˆ«å¤„ç†äº†å‡½æ•° barã€fooï¼Œä»¥åŠ main çš„è¿”å›å€¼ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºå¤åˆç±»å‹ï¼ˆæ¯”å¦‚ç»“æ„ä½“ï¼‰çš„è¿”å›å€¼ï¼Œç¼–è¯‘å™¨å¯èƒ½ä¼šç›´æ¥ä½¿ç”¨æ ˆå†…å­˜è¿›è¡Œâ€œä¸­è½¬â€ã€‚</p><p>å¯¹äºæµ®ç‚¹æ•°ç±»å‹çš„è¿”å›å€¼ï¼ŒåŒå‚æ•°ä¼ é€’ç±»ä¼¼ï¼Œç¼–è¯‘å™¨ä¼šé»˜è®¤ä½¿ç”¨ xmm0 ä¸ xmm1 å¯„å­˜å™¨è¿›è¡Œå­˜å‚¨ã€‚è€Œå½“è¿”å›å€¼è¿‡å¤§æ—¶ï¼Œåˆ™ä¼šé€‰æ‹©æ€§ä½¿ç”¨ ymm ä¸ zmm æ¥æ›¿ä»£ xmm å¯„å­˜å™¨ã€‚</p><h3>å¯„å­˜å™¨ä½¿ç”¨</h3><p>SysV è°ƒç”¨çº¦å®šå¯¹å¯„å­˜å™¨çš„ä½¿ç”¨ä¹Ÿä½œå‡ºäº†è§„å®šï¼šå¯¹äºå¯„å­˜å™¨ rbxã€rbpã€rspï¼Œä»¥åŠ r12 åˆ°r15ï¼Œè‹¥è¢«è°ƒç”¨å‡½æ•°éœ€è¦ä½¿ç”¨å®ƒä»¬ï¼Œåˆ™éœ€è¦è¯¥å‡½æ•°åœ¨ä½¿ç”¨ä¹‹å‰å°†è¿™äº›å¯„å­˜å™¨ä¸­çš„å€¼è¿›è¡Œæš‚å­˜ï¼Œå¹¶åœ¨å‡½æ•°é€€å‡ºä¹‹å‰æ¢å¤å®ƒä»¬çš„å€¼ï¼ˆcallee-savedï¼‰ã€‚è€Œå¯¹äºå…¶ä»–å¯„å­˜å™¨ï¼Œåˆ™æ ¹æ®è°ƒç”¨æ–¹çš„éœ€è¦ï¼Œè‡ªè¡Œä¿å­˜å’Œæ¢å¤å®ƒä»¬çš„å€¼ï¼ˆcaller-savedï¼‰ã€‚</p><h3>å †æ ˆæ¸…ç†</h3><p>æ¯ä¸€ä¸ªå‡½æ•°åœ¨è°ƒç”¨ç»“æŸå‰ï¼Œéƒ½éœ€è¦ç”±å®ƒè‡ªèº«å®Œæˆå †æ ˆçš„æ¸…ç†å·¥ä½œã€‚æ¯”å¦‚åœ¨å›¾ A æ‰€ç¤ºçš„ä»£ç ä¸­ï¼Œfoo å‡½æ•°åœ¨è¢«è°ƒç”¨æ—¶ï¼Œå®ƒåœ¨æ ˆå†…å­˜ä¸­åˆ†é…äº†å¯¹åº”çš„ç©ºé—´ï¼Œç”¨äºå­˜æ”¾å±€éƒ¨å˜é‡ n çš„å€¼ã€‚è€Œåœ¨è¯¥å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œå‡†å¤‡é€€å‡ºå‰ï¼Œä¾¿éœ€è¦ç”±å®ƒè‡ªå·±å°†ä¹‹å‰åœ¨æ ˆä¸Šåˆ†é…çš„æ•°æ®æ¸…ç†å¹²å‡€ã€‚è€Œè¿™ä¸ªä»»åŠ¡æ˜¯å¯ä»¥ç”± <code>leave</code> æŒ‡ä»¤æ¥å®Œæˆçš„ã€‚æˆ‘ä¼šåœ¨æ¥ä¸‹æ¥è®²è§£â€œæ ˆå¸§â€æ—¶ï¼Œå†æ·±å…¥ä»‹ç»ä¸è¯¥æŒ‡ä»¤ç›¸å…³çš„å†…å®¹ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œå¯¹äº foo å‡½æ•°è¢«è°ƒç”¨å‰æ‰€ä¼ å…¥å®å‚çš„æ¸…ç†å·¥ä½œï¼Œåˆ™æ˜¯ç”±è°ƒç”¨å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œçš„ main å‡½æ•°æ¥å®Œæˆçš„ã€‚å¯ä»¥çœ‹åˆ°ï¼Œå½“ foo å‡½æ•°è°ƒç”¨ç»“æŸï¼Œç¨‹åºæ‰§è¡Œæµç¨‹è¿”å›åˆ°ä¹‹å‰ <code>call</code> æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤æ—¶ï¼Œç¨‹åºé€šè¿‡ <code>add</code> æŒ‡ä»¤ä¿®æ”¹äº† rsp å¯„å­˜å™¨çš„å€¼ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œmain å‡½æ•°å¯¹ä¹‹å‰æ”¾å…¥æ ˆä¸­ä¼ é€’ç»™å‡½æ•° foo çš„å®å‚è¿›è¡Œäº†æ¸…ç†ã€‚</p><h3>å…¶ä»–çº¦å®š</h3><p>é™¤æ­¤ä¹‹å¤–ï¼ŒSysV è°ƒç”¨çº¦å®šè¿˜æœ‰ä¸‹é¢è¿™å‡ ç‚¹è§„å®šï¼š</p><ul>\n<li>å‡½æ•°åœ¨è¢« <code>call</code> æŒ‡ä»¤è°ƒç”¨å‰ï¼Œéœ€è¦ä¿è¯æ ˆé¡¶äº 16 å­—èŠ‚å¯¹é½ï¼Œä¹Ÿå°±æ˜¯æ ˆé¡¶çš„æ‰€åœ¨åœ°å€å€¼ï¼ˆä»¥å­—èŠ‚ä¸ºå•ä½ï¼‰æ˜¯ 16 çš„å€æ•°ï¼›</li>\n<li>ä»æ ˆé¡¶å‘ä¸Šä¿ç•™ 128 å­—èŠ‚ä½œä¸º â€œRed Zoneâ€ï¼›</li>\n<li>ä¸åŒäºç”¨æˆ·å‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹ï¼Œç³»ç»Ÿè°ƒç”¨ï¼ˆSystem Callï¼‰å‡½æ•°éœ€ä½¿ç”¨å¯„å­˜å™¨ rdiã€rsiã€rdxã€r10ã€r8ã€r9 ä¼ é€’å‚æ•°ã€‚</li>\n</ul><p>æˆ‘ä»¬æ¥é‡ç‚¹çœ‹çœ‹ç¬¬äºŒç‚¹ï¼šRed Zone æ˜¯ä½äºæ ˆé¡¶å‘ä¸Šï¼ˆä½åœ°å€æ–¹å‘ï¼‰çš„ä¸€æ®µå›ºå®šé•¿åº¦çš„å†…å­˜æ®µï¼Œè¿™å—åŒºåŸŸé€šå¸¸å¯ä»¥è¢«å‡½æ•°è°ƒç”¨æ ˆä¸­çš„â€œå¶å­â€å‡½æ•°ï¼ˆå³ä¸å†è°ƒç”¨å…¶ä»–å‡½æ•°çš„å‡½æ•°ï¼‰ä½¿ç”¨ã€‚è¿™æ ·ï¼Œåœ¨éœ€è¦é¢å¤–çš„æ ˆå†…å­˜æ—¶ï¼Œå°±èƒ½åœ¨ä¸€å®šæ¡ä»¶ä¸‹çœå»å…ˆè°ƒæ•´æ ˆå†…å­˜å¤§å°çš„è¿‡ç¨‹ã€‚è€Œæœ‰å…³ç¬¬ä¸‰ç‚¹ä¸­æ¶‰åŠåˆ°çš„ä¸ç³»ç»Ÿè°ƒç”¨ç›¸å…³çš„å†…å®¹ï¼Œæˆ‘å°†åœ¨è¿™é—¨è¯¾çš„â€œC ç¨‹åºè¿è¡ŒåŸç†ç¯‡â€ä¸­å†ä¸ºä½ æ·±å…¥è®²è§£ã€‚</p><h2>ä¿å­˜å‡½æ•°è°ƒç”¨ä¿¡æ¯çš„æ ˆå¸§</h2><p>å‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹ä¼´éšç€æ ˆå†…å­˜ä¸­æ•°æ®çš„ä¸æ–­å˜åŒ–ã€‚ä»æ•´ä½“ä¸Šæ¥çœ‹ï¼Œæ¯ä¸€ä¸ªå‡½æ•°åœ¨è°ƒç”¨æ—¶ï¼Œéƒ½ä¼šåœ¨æ ˆå†…å­˜ä¸­å‘ˆç°å‡ºåŸºæœ¬ç›¸åŒçš„æ•°æ®å¸ƒå±€ç»“æ„ã€‚è€Œé€šè¿‡è¿™ç§æ–¹å¼åˆ’åˆ†å‡ºæ¥çš„ï¼Œå¯¹åº”äºæ¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨çš„æ ˆå†…å­˜æ•°æ®å—ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°å®ƒä¸ºâ€œæ ˆå¸§â€ã€‚æ ˆå¸§ä¸­å­˜æ”¾æœ‰ä¸æ¯ä¸ªå‡½æ•°è°ƒç”¨ç›¸å…³çš„è¿”å›åœ°å€ã€å®å‚ã€å±€éƒ¨å˜é‡ã€è¿”å›å€¼ï¼Œä»¥åŠæš‚å­˜çš„å¯„å­˜å™¨å€¼ç­‰ä¿¡æ¯ã€‚</p><p>åœ¨è¿›ç¨‹çš„ VAS ä¸­ï¼Œæ ˆå†…å­˜æ˜¯ä»é«˜åœ°å€å‘ä½åœ°å€é€æ¸å¢é•¿çš„ï¼Œå³æ ˆåº•ä½äºé«˜åœ°å€å¤„ï¼Œæ ˆé¡¶ä½äºä½åœ°å€å¤„ã€‚è€Œå½“ä¸€ä¸ªå‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­éœ€è¦ä½¿ç”¨æ›´å¤šçš„æ ˆå†…å­˜ç©ºé—´æ—¶ï¼Œä¾¿éœ€è¦é¦–å…ˆé€šè¿‡æŸç§æ–¹å¼æ¥æ‰©å¤§è¿›ç¨‹çš„å¯ç”¨æ ˆå†…å­˜å¤§å°ã€‚</p><p>é€šè¿‡æ“ä½œå¯„å­˜å™¨ rspï¼Œæˆ‘ä»¬ä¾¿å¯å®Œæˆè¿™ä¸ªæ“ä½œã€‚rsp å¯„å­˜å™¨åˆè¢«ç§°ä¸º Stack Pointerï¼Œè¯¥å¯„å­˜å™¨ä¸­ä¸€ç›´å­˜æ”¾ç€å½“å‰æ ˆå†…å­˜é¡¶éƒ¨ï¼ˆä½ä½åœ°å€ï¼‰çš„åœ°å€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>rsp å¯„<strong><strong>å­˜</strong></strong>å™¨çš„å€¼å†³å®šäº†è¿›ç¨‹æ‰€èƒ½å¤Ÿä½¿ç”¨çš„æ ˆå†…å­˜å¤§å°</strong>ã€‚å› æ­¤ï¼Œé€šè¿‡å‡å°è¯¥å¯„å­˜å™¨çš„å€¼ï¼Œæˆ‘ä»¬ä¾¿èƒ½å¤Ÿæ‰©å¤§è¿›ç¨‹çš„å¯ç”¨æ ˆå†…å­˜ç©ºé—´ã€‚ä½ å¯ä»¥é€šè¿‡ä¸‹å›¾ï¼Œç›´è§‚åœ°ä½“ä¼šåˆ°å®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/04/3f/04ba684d4063355929ff8c4d0714cf3f.jpg?wh=1920x1156\" alt=\"å›¾ç‰‡\"></p><p>ç°åœ¨è®©æˆ‘ä»¬æŠŠç›®å…‰ç§»åŠ¨åˆ°å‡½æ•° bar èº«ä¸Šï¼Œæ¥è¯¦ç»†çœ‹çœ‹ï¼Œå®ƒåœ¨é€šè¿‡ <code>call</code> æŒ‡ä»¤è°ƒç”¨åéƒ½å‘ç”Ÿäº†ä»€ä¹ˆã€‚</p><p>å½“ <code>call</code> æŒ‡ä»¤æ‰§è¡Œæ—¶ï¼Œå‡½æ•°æ‰§è¡Œå®Œæ¯•åçš„è¿”å›åœ°å€ä¼šè¢«é¦–å…ˆæ¨å…¥æ ˆä¸­ã€‚ä»¥ bar å‡½æ•°ä¸ºä¾‹ï¼Œå½“è¯¥å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå›¾ A ä¸­å³ä¾§ä»£ç ç¬¬ 20 è¡Œå¯¹åº”çš„æœºå™¨æŒ‡ä»¤åœ°å€ä¾¿ä¼šè¢«å­˜æ”¾åˆ°æ ˆå†…å­˜ä¸­ã€‚æ¥ä¸‹æ¥ï¼Œå‡½æ•°çš„ç¬¬ä¸€è¡ŒæŒ‡ä»¤ <code>push rbp</code> ä¼šå°†å½“å‰å¯„å­˜å™¨ rbp çš„å€¼æš‚å­˜åˆ°æ ˆä¸­ï¼Œä»¥ä¾¿åœ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•åæ¢å¤è¯¥å¯„å­˜å™¨çš„å€¼ã€‚rbp å¯„å­˜å™¨åˆè¢«ç§°ä¸º Frame Pointerï¼Œå³â€œæ ˆå¸§å¯„å­˜å™¨â€ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå®ƒè¢«ç”¨æ¥å­˜å‚¨å‡½æ•°è°ƒç”¨å‰çš„â€œæ ˆé«˜åº¦â€ï¼Œå³å¯„å­˜å™¨ rsp çš„æ—§å€¼ï¼Œä»¥ä¾¿ç”¨äºåœ¨å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­è¿›è¡Œæ ˆå¸§ä¸­æ•°æ®çš„å¯»å€ï¼Œå¹¶åœ¨å‡½æ•°é€€å‡ºå‰æŠŠæ ˆä¸­çš„æ•°æ®æ¢å¤åˆ°å‡½æ•°è°ƒç”¨å‰çš„çŠ¶æ€ã€‚</p><p>ç´§æ¥ç€ï¼Œç¬¬äºŒå¥æŒ‡ä»¤ <code>mov rbp, rsp</code> ä¾¿å°†å­˜æœ‰æ­¤åˆ»æ ˆé«˜åº¦çš„å¯„å­˜å™¨ rsp çš„å€¼â€œå¤‡ä»½â€åˆ°å¯„å­˜å™¨ rbp ä¸­ã€‚å½“å‡½æ•°ä½“çš„å†…å®¹ï¼ˆç¬¬ä¸‰æ¡è¯­å¥ï¼‰æ‰§è¡Œå®Œæ¯•åï¼Œç¨‹åºé€šè¿‡ <code>pop</code> æŒ‡ä»¤æ¢å¤å¯„å­˜å™¨ rbp çš„å€¼ï¼Œå¹¶é€šè¿‡ <code>ret</code> æŒ‡ä»¤å°†ç¨‹åºçš„æ‰§è¡Œè½¬ç§»åˆ°å‡½æ•°è°ƒç”¨å‰ï¼Œå­˜å…¥æ ˆä¸­çš„é‚£ä¸ªè¿”å›åœ°å€ä¸Šå»ã€‚</p><p>åœ¨å‡½æ•° bar çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”±äºæˆ‘ä»¬æ²¡æœ‰åœ¨æ ˆä¸Šåˆ†é…ä»»ä½•æ•°æ®ï¼Œå› æ­¤åœ¨å‡½æ•°å®é™…æ‰§è¡Œç»“æŸå‰ï¼Œä¹Ÿå¹¶ä¸éœ€è¦å¯¹æ ˆè¿›è¡Œä»»ä½•æ¸…ç†å·¥ä½œã€‚æ‰€ä»¥ä½ ä¼šå‘ç°ï¼Œå’Œ foo å‡½æ•°ä¸ main å‡½æ•°ç›¸æ¯”ï¼Œbar å‡½æ•°åœ¨ <code>ret</code> æŒ‡ä»¤ä¹‹å‰å°‘æ‰§è¡Œäº†ä¸€æ¡ <code>leave</code> æŒ‡ä»¤ã€‚è€Œäº‹å®ä¸Šï¼Œè¿™æ¡æŒ‡ä»¤ä¾¿ä¼šé€šè¿‡æ¢å¤å¯„å­˜å™¨ rsp çš„å€¼æ¥â€œæ¸…ç†â€æ ˆä¸Šçš„æ•°æ®ï¼Œå¹¶åŒæ—¶æ¢å¤å¯„å­˜å™¨ rbp çš„å€¼ã€‚</p><p>è¿›ä¸€æ­¥è§‚å¯Ÿ main å‡½æ•°çš„å®ç°ç»†èŠ‚ï¼Œä½ ä¼šå‘ç°å‡½æ•°åœ¨æ‰§è¡Œæ—¶ä½¿ç”¨æ ˆçš„ç—•è¿¹ã€‚æ¯”å¦‚æ±‡ç¼–ä»£ç ä¸­çš„ç¬¬ 29 è¡Œï¼Œè¿™é‡Œé€šè¿‡ <code>sub</code> æŒ‡ä»¤å‡å°äº†å¯„å­˜å™¨ rsp çš„å€¼ï¼Œä»¥å°†å½“å‰çš„å¯ç”¨æ ˆç©ºé—´æ‰©å¤§ 16 ä¸ªå­—èŠ‚ã€‚æ¥ç€ï¼Œé€šè¿‡ç¬¬ 30ã€31 è¡ŒæŒ‡ä»¤ï¼Œå‡½æ•°ä¸ºå±€éƒ¨å˜é‡ x å’Œ y åˆ†é…ç›¸åº”çš„æ ˆå†…å­˜ï¼Œå¹¶å°†åˆå§‹å€¼ 1 å’Œ 2 åˆ†åˆ«å­˜æ”¾åˆ°äº†æ ˆä¸Š rbp-4 ä¸ rbp-8 çš„ä½ç½®ï¼Œæ¯ä¸€ä¸ªå ç”¨ 4 å­—èŠ‚å¤§å°ã€‚éšåï¼Œåœ¨ä»£ç çš„ç¬¬ 34ã€35 è¡Œï¼Œå€ŸåŠ© <code>push</code> æŒ‡ä»¤ï¼Œé¢å¤–çš„ä¸¤ä¸ª 4 å­—èŠ‚å‚æ•°å€¼åŒæ ·è¢«å­˜æ”¾åˆ°äº†æ ˆå†…å­˜ä¸­ã€‚æ­¤æ—¶ï¼Œmain å‡½æ•°å¯¹åº”çš„æ ˆå¸§å†…å®¹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/01/18/01abd718698251019f7ec97649da0b18.jpg?wh=1920x1259\" alt=\"å›¾ç‰‡\"></p><p>åˆ°è¿™é‡Œï¼Œç›¸ä¿¡ä½ å·²ç»å¯¹å‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹ä»¥åŠæ ˆå¸§çš„æ¦‚å¿µæœ‰äº†å¤§è‡´çš„äº†è§£ã€‚å¯ä»¥çœ‹åˆ°çš„æ˜¯ï¼Œéšç€åµŒå¥—å‡½æ•°çš„ä¸æ–­è°ƒç”¨ï¼Œæ¯ä¸€ä¸ªè°ƒç”¨è¿‡ç¨‹æ‰€äº§ç”Ÿçš„æ ˆå¸§éƒ½ä¼šæŒ‰ç…§å‡½æ•°çš„è°ƒç”¨é¡ºåºè¢«ä¾æ¬¡å­˜æ”¾åœ¨æ ˆå†…å­˜ä¸­ã€‚è€Œå½“åµŒå¥—å‡½æ•°çš„å±‚çº§è¶³å¤Ÿæ·±ï¼Œå¯¼è‡´æ ˆå†…å­˜å·²è¾¾åˆ°å¯ç”¨çš„æœ€å¤§å€¼ï¼Œè¿›è€Œæ— æ³•å†å­˜æ”¾æ ˆå¸§æ—¶ï¼Œä¾¿ä¼šå‘ç”Ÿæˆ‘ä»¬å¸¸è§çš„ â€œStack Overflowâ€ï¼Œå³â€œæ ˆæº¢å‡ºâ€çš„é—®é¢˜ã€‚è€Œåœ¨ä¸‹ä¸€è®²ä¸­ï¼Œæˆ‘ä¼šå¸¦ä½ ä¸€èµ·çœ‹çœ‹ï¼Œå¦‚ä½•å€ŸåŠ©â€œå°¾é€’å½’ä¼˜åŒ–â€æŠ€å·§æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h2>æ€»ç»“</h2><p>å¥½äº†ï¼Œè®²åˆ°è¿™é‡Œï¼Œä»Šå¤©çš„å†…å®¹ä¹Ÿå°±åŸºæœ¬ç»“æŸäº†ã€‚æœ€åæˆ‘æ¥ç»™ä½ æ€»ç»“ä¸€ä¸‹ã€‚</p><p>è¿™ä¸€è®²ï¼Œæˆ‘é¦–å…ˆå¸¦ä½ å¿«é€Ÿå›é¡¾äº† C è¯­è¨€ä¸­å‡½æ•°çš„å…·ä½“ç”¨æ³•ï¼Œç„¶åä»‹ç»äº†ç¼–è¯‘å™¨åœ¨å®ç° C å‡½æ•°è°ƒç”¨æ—¶éœ€è¦å…³æ³¨çš„ä¸€ç³»åˆ—è§„åˆ™ï¼Œå³ C å‡½æ•°ä¸­çš„è°ƒç”¨çº¦å®šã€‚åœ¨ç±» Unix ç³»ç»Ÿä¸Šï¼Œç¼–è¯‘å™¨é€šå¸¸ä¼šä½¿ç”¨åä¸º System V AMD64 ABI çš„è°ƒç”¨çº¦å®šï¼Œæ¥ä½œä¸ºå®ç°å‡½æ•°è°ƒç”¨çš„äº‹å®æ ‡å‡†ã€‚SysV è°ƒç”¨çº¦å®šä¸­è§„å®šäº†å‡½æ•°åœ¨è°ƒç”¨æ—¶éœ€è¦æ³¨æ„çš„å‚æ•°ä¼ é€’ã€å¯„å­˜å™¨ä½¿ç”¨ï¼Œä»¥åŠå †æ ˆæ¸…ç†ç­‰æ–¹é¢çš„å…·ä½“è§„åˆ™ã€‚</p><p>æ¯ä¸€ä¸ªè¢«è°ƒç”¨å‡½æ•°éƒ½ä¼šåœ¨æ ˆå†…å­˜ä¸­å­˜æ”¾ä¸å…¶å¯¹åº”çš„æ ˆå¸§ç»“æ„ã€‚æ ˆå¸§ä¸­åŒ…å«ç€å‡½æ•°åœ¨è¢«è°ƒç”¨æ—¶éœ€è¦çš„æ‰€æœ‰å…³é”®ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…æ‹¬å‡½æ•°è¿”å›åœ°å€ã€æŸäº›å¯„å­˜å™¨çš„æ—§å€¼ã€å‡½æ•°è°ƒç”¨è¿‡ç¨‹ä¸­å±€éƒ¨å˜é‡çš„å€¼ï¼Œç­‰ç­‰ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>åœ¨è¿™ä¸€è®²çš„æœ€åï¼Œæˆ‘ä»¬æ¥ä¸€èµ·åšä¸ªæ€è€ƒé¢˜å§ã€‚</p><p>åœ¨ä¸ä½¿ç”¨ <code>leave</code> æŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œä½ çŸ¥é“åº”è¯¥å¦‚ä½•è¿›è¡Œæ ˆæ¸…ç†ï¼Œå¹¶æ¢å¤å¯„å­˜å™¨ rbp ä¸ rsp çš„å€¼å—ï¼Ÿè€Œä¸å®ƒå¯¹åº”çš„ <code>enter</code> æŒ‡ä»¤åˆæœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºç•™ä¸‹ä½ çš„ç­”æ¡ˆã€‚</p><p>ä»Šå¤©çš„è¯¾ç¨‹å°±ç»“æŸäº†ï¼Œå¸Œæœ›å¯ä»¥å¸®åŠ©åˆ°ä½ ï¼Œä¹Ÿå¸Œæœ›ä½ åœ¨ä¸‹æ–¹çš„ç•™è¨€åŒºå’Œæˆ‘ä¸€èµ·è®¨è®ºã€‚åŒæ—¶ï¼Œæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–åŒäº‹ï¼Œæˆ‘ä»¬ä¸€èµ·äº¤æµã€‚</p>","neighbors":{"left":{"article_title":"04ï½œæ§åˆ¶é€»è¾‘ï¼šè¡¨è¾¾å¼å’Œè¯­å¥æ˜¯å¦‚ä½•åè°ƒç¨‹åºè¿è¡Œçš„ï¼Ÿ","id":467203},"right":{"article_title":"06ï½œä»£ç å°è£…ï¼ˆä¸‹ï¼‰ï¼šå‡½æ•°æ˜¯å¦‚ä½•è¢«è°ƒç”¨çš„ï¼Ÿ","id":469250}},"comments":[{"had_liked":false,"id":336313,"user_name":"é¾è¦","can_delete":false,"product_type":"c1","uid":1000076,"ip_address":"","ucode":"BE1D500833F070","user_header":"https://static001.geekbang.org/account/avatar/00/0f/42/8c/373d4027.jpg","comment_is_top":true,"comment_ctime":1646063440,"is_pvip":true,"replies":[{"id":"122909","content":"å¾ˆå¥½çš„å‘ç°ï¼è¿™é‡Œä¸ºäº†ä¾¿äºç†è§£æˆ‘æ²¡æœ‰ç”»å‡ºå®é™…åœ¨ x86-64 å¹³å°ä¸Šçš„æ ˆå¸ƒå±€ã€‚ä½†å®é™…æƒ…å†µæ˜¯ 1ã€2 ä¸ 8ã€7 ä¹‹é—´æœ‰ 8 å­—èŠ‚ paddingï¼Œç„¶ååˆç”±äº push åœ¨è¿™é‡Œæ˜¯æŒ‰ç…§ 8 å­—èŠ‚å­˜æ”¾æ•°æ®ï¼Œæ‰€ä»¥ 8 å’Œ 7 æ¯ä¸ªæ•°å­—å®é™…â€œå ç”¨â€äº† 8 å­—èŠ‚ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":"1005890","ctime":1646102676,"ip_address":"","comment_id":336313,"utype":1}],"discussion_count":2,"race_medal":0,"score":"9.2233720513857004e+18","product_id":100100701,"comment_content":"è€å¸ˆï¼ŒStack Frame(main) è¿™ä¸ªå›¾æ˜¯ä¸æ˜¯æœ‰æ— è¯¯å‘¢ï¼Ÿ<br>1ã€2 ä¸ 8ã€7 ä¹‹é—´æ˜¯ä¸æ˜¯æœ‰ 8 ä¸ªå­—èŠ‚çš„ç©ºæ´ï¼Ÿ<br>rsp - 16ï¼Œç©ºå‡ºäº† 16 ä¸ªå­—èŠ‚ï¼Œrbp-4ã€rbp-8 ç”¨æ‰ä¸¤ä¸ª4å­—èŠ‚ï¼Œrbp-9 ~ rbp-16 è¿™ 8 ä¸ªå­—èŠ‚æœªç”¨åˆ°ã€‚","like_count":4,"discussions":[{"author":{"id":1005890,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/42/e1757583.jpg","nickname":"Jason Yu äºèˆª","note":"","ucode":"0731492F4BC77D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553807,"discussion_content":"å¾ˆå¥½çš„å‘ç°ï¼è¿™é‡Œä¸ºäº†ä¾¿äºç†è§£æˆ‘æ²¡æœ‰ç”»å‡ºå®é™…åœ¨ x86-64 å¹³å°ä¸Šçš„æ ˆå¸ƒå±€ã€‚ä½†å®é™…æƒ…å†µæ˜¯ 1ã€2 ä¸ 8ã€7 ä¹‹é—´æœ‰ 8 å­—èŠ‚ paddingï¼Œç„¶ååˆç”±äº push åœ¨è¿™é‡Œæ˜¯æŒ‰ç…§ 8 å­—èŠ‚å­˜æ”¾æ•°æ®ï¼Œæ‰€ä»¥ 8 å’Œ 7 æ¯ä¸ªæ•°å­—å®é™…â€œå ç”¨â€äº† 8 å­—èŠ‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646102676,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2436556,"avatar":"https://static001.geekbang.org/account/avatar/00/25/2d/cc/a5fc56f6.jpg","nickname":"ğŸ§¢","note":"","ucode":"BB704C546A13A7","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1005890,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/42/e1757583.jpg","nickname":"Jason Yu äºèˆª","note":"","ucode":"0731492F4BC77D","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":568074,"discussion_content":"è€å¸ˆï¼Œè¿™ä¸ªå›¾é‡Œçš„ Return Address æ˜¯åœ¨å‡½æ•°è°ƒç”¨çš„æ—¶å€™è¢«ä¿å­˜åˆ°æ ˆå¸§çš„å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651062625,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":553807,"ip_address":""},"score":568074,"extra":""}]}]},{"had_liked":false,"id":327590,"user_name":"cc","can_delete":false,"product_type":"c1","uid":1037891,"ip_address":"","ucode":"68E69205A7D5BC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d6/43/0704d7db.jpg","comment_is_top":true,"comment_ctime":1640184320,"is_pvip":false,"replies":[{"id":"119229","content":"æ˜¯è¿™æ ·çš„ï¼Œè¿™é‡Œå¯èƒ½ç¡®å®ä¼šæœ‰äº›è®©äººè¯¯è§£ã€‚æœ¬è´¨ä¸Šéƒ½æ˜¯ä¼ å€¼ï¼Œåªä¸è¿‡ä¸€ä¸ªæ˜¯æŒ‡é’ˆçš„å€¼ï¼Œä¸€ä¸ªæ˜¯æºå€¼æ‹·è´åçš„å€¼ã€‚è¿™é‡Œå…¶å®æƒ³è¡¨è¾¾çš„æ˜¯è¯´â€œå°†æºå€¼æ‹·è´åçš„æ–°å€¼â€ï¼Œä»¥åŠâ€œæºå€¼å¯¹åº”çš„æŒ‡é’ˆâ€è¿™ä¸¤ç§ä¸åŒæ–¹å¼ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1005890","ctime":1640190286,"ip_address":"","comment_id":327590,"utype":1}],"discussion_count":1,"race_medal":0,"score":"9.2233720513799004e+18","product_id":100100701,"comment_content":"åœ¨ C è¯­è¨€ä¸­ï¼Œå‡½æ•°æœ‰ä¸¤ç§ä¼ é€’å‚æ•°çš„æ–¹å¼ï¼Œå³é€šè¿‡â€œå€¼â€ä¼ é€’å’Œé€šè¿‡â€œæŒ‡é’ˆâ€ä¼ é€’ã€‚<br>---<br>å‚æ•°ä¼ é€’çš„æ–¹å¼ï¼Œä¸éƒ½æ˜¯ä¼ å€¼å—<br>","like_count":4,"discussions":[{"author":{"id":1005890,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/42/e1757583.jpg","nickname":"Jason Yu äºèˆª","note":"","ucode":"0731492F4BC77D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540907,"discussion_content":"æ˜¯è¿™æ ·çš„ï¼Œè¿™é‡Œå¯èƒ½ç¡®å®ä¼šæœ‰äº›è®©äººè¯¯è§£ã€‚æœ¬è´¨ä¸Šéƒ½æ˜¯ä¼ å€¼ï¼Œåªä¸è¿‡ä¸€ä¸ªæ˜¯æŒ‡é’ˆçš„å€¼ï¼Œä¸€ä¸ªæ˜¯æºå€¼æ‹·è´åçš„å€¼ã€‚è¿™é‡Œå…¶å®æƒ³è¡¨è¾¾çš„æ˜¯è¯´â€œå°†æºå€¼æ‹·è´åçš„æ–°å€¼â€ï¼Œä»¥åŠâ€œæºå€¼å¯¹åº”çš„æŒ‡é’ˆâ€è¿™ä¸¤ç§ä¸åŒæ–¹å¼ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640190286,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326967,"user_name":"å‹","can_delete":false,"product_type":"c1","uid":2536820,"ip_address":"","ucode":"972A4333A8B101","user_header":"https://static001.geekbang.org/account/avatar/00/26/b5/74/cd80b9f4.jpg","comment_is_top":true,"comment_ctime":1639803727,"is_pvip":false,"replies":[{"id":"119008","content":"å¤§éƒ¨åˆ†ç†è§£éƒ½æ˜¯å¯¹çš„å“ˆã€‚ä¸è¿‡å…³äº rbp é‡Œé¢ä¿å­˜çš„å†…å®¹ï¼Œåªè¦çŸ¥é“å®ƒæ˜¯ä¸Šä¸€ä¸ªæ ˆå¸§éœ€è¦ä½¿ç”¨çš„ã€ç”¨æ¥è®¡ç®—æ ˆé«˜åº¦çš„ä¿¡æ¯å°±å¥½ã€‚è€Œ rsp æŒ‡å‘çš„æ˜¯æ ˆå†…å­˜çš„é¡¶éƒ¨ï¼Œä¹Ÿä¸ç”¨æŠŠå®ƒè·Ÿæ ˆå¸§æ··åœ¨ä¸€èµ·ç†è§£å“ˆã€‚å› ä¸ºå…¶å®æ‰€è°“çš„â€œå¸§é¦–â€å¾ˆéš¾å»ç•Œå®šï¼Œç†è®ºä¸ŠæŒ‰ç…§å°ç«¯åºç†è§£ï¼Œå¯ä»¥è®¤ä¸ºâ€œå½“å‰å‡½æ•°è¿”å›åœ°å€+8â€ï¼ˆ64ä½ï¼‰çš„ä½ç½®æ˜¯ä¸Šä¸€ä¸ªæ ˆå¸§çš„å¼€å¤´ã€‚ä½†ä¸€èˆ¬å¾ˆå°‘è¿™ä¹ˆè®²ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":"1005890","ctime":1639977644,"ip_address":"","comment_id":326967,"utype":1}],"discussion_count":2,"race_medal":0,"score":"9.2233720384945992e+18","product_id":100100701,"comment_content":"push æŒ‡ä»¤ç­‰ä»· å…ˆ sub ç„¶å  mov  rbpï¼Œ(rsp) æ‹¬å·å°±æ˜¯ å°†rbpä¿å­˜åˆ°rsp subä¹‹åçš„åœ°å€å» è¿™é‡Œæˆ‘å°±æ„Ÿè§‰ æ¯æ¬¡pushä¹‹å æŠŠä¸Šä¸€ä¸ªå‡½æ•°çš„ rbpä¿å­˜äº†èµ·æ¥ è¿™é‡Œçš„rbpåº”è¯¥å­˜çš„æ˜¯å½“å‰å‡½æ•°å¸§é¦–åœ°å€ åº”è¯¥å°±æ˜¯ä¿è¯å›åˆ°äº†å½“å‰å‡½æ•°å¹¶ä¸”é‡Œé¢çš„æ•°æ®ä¹Ÿè¿˜ä¿å­˜åœ¨ã€‚ è‡³äº mov rbp rsp åº”è¯¥å°±æ˜¯å°†å½“å‰å¸§é¦–ä¿å­˜åˆ°äº† rbpé‡Œé¢ ç„¶åä¹‹å‰çš„rbpå·²ç»pushåˆ°äº†rspä¸­ æ„Ÿè§‰è¯´çš„æœ‰ç‚¹æ€è·¯ä¸æ¸…æ™°äº†  å®³è¿˜æ˜¯æ²¡æœ‰ç†è§£çš„å¾ˆå¥½ <br> å“¦å¯¹äº†  å…³äº leave å¦‚æœæŒ‰ç…§ä¸Šé¢æ‰€è¿° <br>æˆ‘åªéœ€è¦å°†è¿™ä¸ª mov rbp rsp å°±ç ´åäº†å½“å‰å‡½æ•°çš„æ ˆç»“æ„ ç„¶å pop å°±å›åˆ°äº†ä¸Šä¸€ä¸ªå‡½æ•°çš„æ ˆç»“æ„çš„é¦–åœ°å€  æ­¤æ—¶ rspåº”è¯¥æ˜¯æŒ‡å‘çš„è¿”å›åœ°å€<br> call æŒ‡ä»¤æˆ‘æƒ³åº”è¯¥æ˜¯ push rsp ï¼Œè¿”å›åœ°å€ <br>ret æ˜¯ jmp  (rsp)<br><br> è€å¸ˆä¸Šé¢æ˜¯æˆ‘çš„ä¸€äº›å°ç†è§£ã€‚æˆ‘æ„Ÿè§‰è‚¯å®šæœ‰åœ°æ–¹æœ‰é”™è¯¯å¸Œæœ›è€å¸ˆæŒ‡å¯¼ä¸€ä¸‹æˆ‘ğŸŒğŸŒ","like_count":0,"discussions":[{"author":{"id":1005890,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/42/e1757583.jpg","nickname":"Jason Yu äºèˆª","note":"","ucode":"0731492F4BC77D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540167,"discussion_content":"å¤§éƒ¨åˆ†ç†è§£éƒ½æ˜¯å¯¹çš„å“ˆã€‚ä¸è¿‡å…³äº rbp é‡Œé¢ä¿å­˜çš„å†…å®¹ï¼Œåªè¦çŸ¥é“å®ƒæ˜¯ä¸Šä¸€ä¸ªæ ˆå¸§éœ€è¦ä½¿ç”¨çš„ã€ç”¨æ¥è®¡ç®—æ ˆé«˜åº¦çš„ä¿¡æ¯å°±å¥½ã€‚è€Œ rsp æŒ‡å‘çš„æ˜¯æ ˆå†…å­˜çš„é¡¶éƒ¨ï¼Œä¹Ÿä¸ç”¨æŠŠå®ƒè·Ÿæ ˆå¸§æ··åœ¨ä¸€èµ·ç†è§£å“ˆã€‚å› ä¸ºå…¶å®æ‰€è°“çš„â€œå¸§é¦–â€å¾ˆéš¾å»ç•Œå®šï¼Œç†è®ºä¸ŠæŒ‰ç…§å°ç«¯åºç†è§£ï¼Œå¯ä»¥è®¤ä¸ºâ€œå½“å‰å‡½æ•°è¿”å›åœ°å€+8â€ï¼ˆ64ä½ï¼‰çš„ä½ç½®æ˜¯ä¸Šä¸€ä¸ªæ ˆå¸§çš„å¼€å¤´ã€‚ä½†ä¸€èˆ¬å¾ˆå°‘è¿™ä¹ˆè®²ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1639977644,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2536820,"avatar":"https://static001.geekbang.org/account/avatar/00/26/b5/74/cd80b9f4.jpg","nickname":"å‹","note":"","ucode":"972A4333A8B101","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1005890,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/42/e1757583.jpg","nickname":"Jason Yu äºèˆª","note":"","ucode":"0731492F4BC77D","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":540183,"discussion_content":"å¥½çš„ è€å¸ˆæˆ‘æ˜ç™½äº†ğŸ‚ğŸº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639983235,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":540167,"ip_address":""},"score":540183,"extra":""}]}]},{"had_liked":false,"id":326637,"user_name":"=","can_delete":false,"product_type":"c1","uid":2600127,"ip_address":"","ucode":"104232A8292220","user_header":"https://static001.geekbang.org/account/avatar/00/27/ac/bf/f549183e.jpg","comment_is_top":false,"comment_ctime":1639615553,"is_pvip":false,"replies":[{"id":"118708","content":"å›ç­”æ­£ç¡®ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1005890","ctime":1639652122,"ip_address":"","comment_id":326637,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35999353921","product_id":100100701,"comment_content":"ä¸ä½¿ç”¨leaveï¼Œå¯ä»¥ä½¿ç”¨<br>mov rsp,rbp<br>pop rbp<br>æ¥æ¢å¤rspå’Œrbpçš„å€¼ã€‚<br>å¯¹äºenterï¼Œå®ƒå’Œleaveç›¸åï¼Œç”¨äºè‡ªåŠ¨åˆ›å»ºæ ˆå¸§ï¼Œè¿ç”¨ç›¸å½“äº<br>push rbp<br>mov rbp rsp","like_count":9,"discussions":[{"author":{"id":1005890,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/42/e1757583.jpg","nickname":"Jason Yu äºèˆª","note":"","ucode":"0731492F4BC77D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539265,"discussion_content":"å›ç­”æ­£ç¡®ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639652122,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":331262,"user_name":"zxk","can_delete":false,"product_type":"c1","uid":1221195,"ip_address":"","ucode":"4BB2BD9D2BCD04","user_header":"https://static001.geekbang.org/account/avatar/00/12/a2/4b/b72f724f.jpg","comment_is_top":false,"comment_ctime":1642510142,"is_pvip":false,"replies":[{"id":"122224","content":"å¥½é—®é¢˜ï¼è¿™æ˜¯ç”±äºåœ¨ x86-64 å¹³å°ä¸Šï¼Œpush æŒ‡ä»¤åœ¨é€šå¸¸æƒ…å†µä¸‹ä¼šä»¥å½“å‰å¹³å°çš„å¯„å­˜å™¨å®½åº¦ï¼ˆè¿™é‡Œä¸º 8 å­—èŠ‚ï¼‰ä¸ºå•ä½æ¥è°ƒæ•´ rspã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1005890","ctime":1645029567,"ip_address":"","comment_id":331262,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10232444734","product_id":100100701,"comment_content":"è€å¸ˆå¥½ï¼Œè¿™é‡Œæˆ‘å°è¯•è§‚å¯Ÿå‡½æ•°è¿”å›å rsp çš„å˜åŒ–ï¼Œåšäº†ä»¥ä¸‹è°ƒæ•´ï¼š<br>è°ƒæ•´å‰ï¼š<br>foo(x, y, 3, 4, 5, 6, 7, 8)ï¼Œå…¶ä¸­ 7ã€8 å…¥æ ˆï¼Œå‡½æ•°è¿”å›å add rsp, 16<br>è°ƒæ•´åï¼š<br>foo(x, y, 3, 4, 5, 6, 7, 8, 9)ï¼Œå…¶ä¸­ 7ã€8ã€9 å…¥æ ˆï¼Œå‡½æ•°è¿”å›å add rsp, 24<br>ä½† int ä¸åº”è¯¥æ˜¯ 4 å­—èŠ‚ä¹ˆï¼Œä¸ºä»€ä¹ˆè¿™é‡Œæ˜¯æŒ‰ç…§ 8 é€’å¢çš„ï¼Œå¸Œæœ›è€å¸ˆè§£ç­”ä¸‹ï¼Œç‰ˆæœ¬ä¸º gcc 11.2ã€‚","like_count":3,"discussions":[{"author":{"id":1005890,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/42/e1757583.jpg","nickname":"Jason Yu äºèˆª","note":"","ucode":"0731492F4BC77D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551511,"discussion_content":"å¥½é—®é¢˜ï¼è¿™æ˜¯ç”±äºåœ¨ x86-64 å¹³å°ä¸Šï¼Œpush æŒ‡ä»¤åœ¨é€šå¸¸æƒ…å†µä¸‹ä¼šä»¥å½“å‰å¹³å°çš„å¯„å­˜å™¨å®½åº¦ï¼ˆè¿™é‡Œä¸º 8 å­—èŠ‚ï¼‰ä¸ºå•ä½æ¥è°ƒæ•´ rspã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1645029568,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326819,"user_name":"ZR2021","can_delete":false,"product_type":"c1","uid":1707352,"ip_address":"","ucode":"4F685C7516F057","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKwGurTWOiaZ2O2oCdxK9kbF4PcwGg0ALqsWhNq87hWvwPy8ZU9cxRzmcGOgdIeJkTOoKfbxgEKqrg/132","comment_is_top":false,"comment_ctime":1639709799,"is_pvip":false,"replies":[{"id":"118788","content":"å¾ˆå¥½çš„é—®é¢˜ï¼Œä¸‹é¢æ˜¯å›ç­”å“ˆï¼š<br>é’ˆå¯¹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šéœ€è¦æ³¨æ„çš„æ˜¯æŒ‰ç…§ SysV è°ƒç”¨çº¦å®šï¼Œæ•´å‹å®å‚ä¼šå…ˆä½¿ç”¨ rdiã€rsi ç­‰å¯„å­˜å™¨æŒ‰é¡ºåºå­˜æ”¾ã€‚æ‰€ä»¥è¿™é‡Œåªè¦å‡½æ•°åœ¨è¢«è°ƒç”¨å‰ï¼Œè¿™äº›å¯„å­˜å™¨ä¸­æœ‰æŒ‰é¡ºåºå­˜æ”¾çš„å€¼å°±å¯ä»¥ï¼Œæ±‡ç¼–å±‚é¢å®é™…å…ˆå­˜å‚¨å“ªä¸ªè¿™ä¸ªå–å†³äºç¼–è¯‘å™¨çš„é€‰æ‹©ã€‚è€Œè¶…è¿‡å¯„å­˜å™¨æ•°é‡ä»¥å¤–çš„å‚æ•°éœ€è¦æŒ‰ç…§ä»å³åˆ°å·¦çš„æ–¹å‘è¢«æ”¾å…¥æ ˆä¸­ï¼Œæ‰€ä»¥ä¼šä»æœ€å³ä¾§çš„ 8 å¼€å§‹ pushã€‚è‡³äºä¸ºä½• x çš„å€¼ä¼šè¢«å…ˆæ”¾åˆ° eaxï¼Œè¿™é‡Œæˆ‘æ²¡çœ‹åˆ°æ¯”è¾ƒç‰¹æ®Šçš„ä¼˜åŒ–ç­–ç•¥ï¼Œåº”è¯¥æ˜¯å–å†³äºç¼–è¯‘å™¨çš„å…·ä½“å®ç°ã€‚<br><br>é’ˆå¯¹ç¬¬äºŒä¸ªé—®é¢˜ï¼šæ¸…ç†å®é™…ä¸Šåªä¼šæ¢å¤æ ˆçš„å¯è§çŠ¶æ€åˆ°å‡½æ•°è¢«è°ƒç”¨ä¹‹å‰ï¼Œå…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯ rsp çš„å€¼ï¼Œä½†æ ˆä¸­å­˜æ”¾çš„å€¼å®é™…ä¸Šä¸ä¼šé€šè¿‡å¯è§çš„æŒ‡ä»¤è¿›è¡Œè¯¸å¦‚â€œæ¸… 0â€ç­‰å¤„ç†ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š<br><br>#include &lt;stdio.h&gt;<br>void foo(void) {<br>  int x;<br>  printf(&quot;%d\\n&quot;, x);<br>  x = 10;<br>}<br>int main(void) {<br>   foo();<br>   foo();<br>   return 0;<br>}<br><br>è‡³äºä½ æåˆ°çš„â€œå±€éƒ¨å˜é‡å»ºè®®è¦ç½® 0â€å¯ä»¥ä¸¾ä¸ªä¾‹å­è¯´æ˜ä¸€ä¸‹ä¸ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":"1005890","ctime":1639800384,"ip_address":"","comment_id":326819,"utype":1}],"discussion_count":3,"race_medal":0,"score":"10229644391","product_id":100100701,"comment_content":"è€å¸ˆï¼Œè¯·æ•™æ–‡ç« é‡Œçš„å‡ ä¸ªé—®é¢˜:<br>1.  å‡½æ•°ä¼ å‚æ—¶å‚æ•°çš„ä¼ é€’é¡ºåºæ˜¯ä»å³åˆ°å·¦ï¼Œä¹Ÿå°±æ˜¯ä»8åˆ°7åˆ°6ï¼Œæœ€ååˆ°yå’Œxï¼Œä½†è¿™é‡Œæ˜¯å…ˆyå†xï¼Œç„¶åå†ä»å³åˆ°å·¦ï¼Œè¿™æ˜¯ä¸ºå•¥ï¼Ÿè¿˜æœ‰ä¼ é€’xçš„æ—¶å€™ä¸ºå•¥å…ˆæ”¾åˆ°eax ï¼Œæœ€åå†æ”¾åˆ°edi é‡Œçš„ï¼Œç¼–è¯‘å™¨åšçš„ä»€ä¹ˆä¼˜åŒ–å—ï¼Ÿ<br>2. æ¸…ç†æ ˆä¸Šçš„æ•°æ®å°±æ˜¯ä¸€ä¸ªleaveæˆ–è€…æ“ä½œrspæŒ‡ä»¤ï¼Œæ¸…ç†æ˜¯æŒ‡å°†æ‰€æœ‰æ•°æ®ç½®ä¸º0å—ï¼Ÿè¿˜æœ‰ï¼Œå¦‚æœå‡½æ•°é€€å‡ºéƒ½ä¼šæ¸…ç†çš„è¯ï¼Œé‚£ä¸‹ä¸€æ¬¡å†æ¬¡è¿›å…¥ï¼Œä¸ºå•¥å±€éƒ¨å˜é‡å»ºè®®è¦ç½®0çš„ï¼Œè¿™ä¸ªæ“ä½œrsp è‡ªåŠ¨æ¸…0æ˜¯è·Ÿæ“ä½œç³»ç»Ÿæœ‰å…³å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1005890,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/42/e1757583.jpg","nickname":"Jason Yu äºèˆª","note":"","ucode":"0731492F4BC77D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539653,"discussion_content":"å¾ˆå¥½çš„é—®é¢˜ï¼Œä¸‹é¢æ˜¯å›ç­”å“ˆï¼š\né’ˆå¯¹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šéœ€è¦æ³¨æ„çš„æ˜¯æŒ‰ç…§ SysV è°ƒç”¨çº¦å®šï¼Œæ•´å‹å®å‚ä¼šå…ˆä½¿ç”¨ rdiã€rsi ç­‰å¯„å­˜å™¨æŒ‰é¡ºåºå­˜æ”¾ã€‚æ‰€ä»¥è¿™é‡Œåªè¦å‡½æ•°åœ¨è¢«è°ƒç”¨å‰ï¼Œè¿™äº›å¯„å­˜å™¨ä¸­æœ‰æŒ‰é¡ºåºå­˜æ”¾çš„å€¼å°±å¯ä»¥ï¼Œæ±‡ç¼–å±‚é¢å®é™…å…ˆå­˜å‚¨å“ªä¸ªè¿™ä¸ªå–å†³äºç¼–è¯‘å™¨çš„é€‰æ‹©ã€‚è€Œè¶…è¿‡å¯„å­˜å™¨æ•°é‡ä»¥å¤–çš„å‚æ•°éœ€è¦æŒ‰ç…§ä»å³åˆ°å·¦çš„æ–¹å‘è¢«æ”¾å…¥æ ˆä¸­ï¼Œæ‰€ä»¥ä¼šä»æœ€å³ä¾§çš„ 8 å¼€å§‹ pushã€‚è‡³äºä¸ºä½• x çš„å€¼ä¼šè¢«å…ˆæ”¾åˆ° eaxï¼Œè¿™é‡Œæˆ‘æ²¡çœ‹åˆ°æ¯”è¾ƒç‰¹æ®Šçš„ä¼˜åŒ–ç­–ç•¥ï¼Œåº”è¯¥æ˜¯å–å†³äºç¼–è¯‘å™¨çš„å…·ä½“å®ç°ã€‚\n\né’ˆå¯¹ç¬¬äºŒä¸ªé—®é¢˜ï¼šæ¸…ç†å®é™…ä¸Šåªä¼šæ¢å¤æ ˆçš„å¯è§çŠ¶æ€åˆ°å‡½æ•°è¢«è°ƒç”¨ä¹‹å‰ï¼Œå…¶ä¸­æœ€é‡è¦çš„å°±æ˜¯ rsp çš„å€¼ï¼Œä½†æ ˆä¸­å­˜æ”¾çš„å€¼å®é™…ä¸Šä¸ä¼šé€šè¿‡å¯è§çš„æŒ‡ä»¤è¿›è¡Œè¯¸å¦‚â€œæ¸… 0â€ç­‰å¤„ç†ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š\n\n#include <stdio.h>\nvoid foo(void) {\n  int x;\n  printf(\"%d\\n\", x);\n  x = 10;\n}\nint main(void) {\n   foo();\n   foo();\n   return 0;\n}\n\nè‡³äºä½ æåˆ°çš„â€œå±€éƒ¨å˜é‡å»ºè®®è¦ç½® 0â€å¯ä»¥ä¸¾ä¸ªä¾‹å­è¯´æ˜ä¸€ä¸‹ä¸ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639800384,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1155646,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKotsBr2icbYNYlRSlicGUD1H7lulSTQUAiclsEz9gnG5kCW9qeDwdYtlRMXic3V6sj9UrfKLPJnQojag/132","nickname":"ppd0705","note":"","ucode":"EB63D4E3FD1E9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1005890,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/42/e1757583.jpg","nickname":"Jason Yu äºèˆª","note":"","ucode":"0731492F4BC77D","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":552341,"discussion_content":"è¿™ä¸ªä¾‹å­è®©æˆ‘æ„è¯†åˆ°ï¼šCå±€éƒ¨å˜é‡çš„åˆå§‹å€¼ä¸ä¸€å®šæ˜¯é›¶å€¼!","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645420803,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":539653,"ip_address":""},"score":552341,"extra":""}]},{"author":{"id":1707352,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKwGurTWOiaZ2O2oCdxK9kbF4PcwGg0ALqsWhNq87hWvwPy8ZU9cxRzmcGOgdIeJkTOoKfbxgEKqrg/132","nickname":"ZR2021","note":"","ucode":"4F685C7516F057","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540043,"discussion_content":"è°¢è°¢è€å¸ˆçš„å›ç­”ï¼Œå¤§èµï¼ï¼ï¼å±€éƒ¨å˜é‡ç½®0ï¼Œå°±æ˜¯å‡½æ•°å†…å®šä¹‰çš„å±€éƒ¨å˜é‡è¦åˆå§‹åŒ–ä¸º0æˆ–è€…ç©ºï¼Œæˆ‘ä»¬ä»£ç è§„èŒƒä¸­è¿™ä¹ˆè¦æ±‚çš„ï¼Œçœ‹äº†è€å¸ˆçš„å›ç­”ï¼Œè§‰å¾—è¿˜æ˜¯å¾ˆæœ‰å¿…è¦çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639926259,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326577,"user_name":"=","can_delete":false,"product_type":"c1","uid":2600127,"ip_address":"","ucode":"104232A8292220","user_header":"https://static001.geekbang.org/account/avatar/00/27/ac/bf/f549183e.jpg","comment_is_top":false,"comment_ctime":1639569263,"is_pvip":false,"replies":[{"id":"118647","content":"æ˜¯çš„ï¼Œpush æŒ‡ä»¤ä¼šè‡ªåŠ¨ä¿®æ”¹ rsp ä¸­çš„å€¼ã€‚å¯¹äºå®ƒçš„æ‰§è¡Œï¼Œä½ å¯ä»¥ç†è§£ä¸ºä¸¤æ­¥ï¼šç¬¬ä¸€æ­¥æ˜¯å‡å° rsp ä¸­çš„å€¼ï¼Œâ€œè…¾å‡ºâ€è¶³å¤Ÿçš„æ ˆå†…å­˜ï¼›ç¬¬äºŒæ­¥æ˜¯æŠŠå€¼æ”¾å…¥è¿™å—å†…å­˜ä¸­ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1005890","ctime":1639585792,"ip_address":"","comment_id":326577,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5934536559","product_id":100100701,"comment_content":"è€å¸ˆå¥½ï¼Œè¯·é—®å¦‚æœä¸€ä¸ªå‡½æ•°ç°æœ‰çš„æ ˆå¸§å¤§å°ä¸å¤Ÿç”¨äº†ï¼Œå½“ç»§ç»­å‘æ ˆä¸­pushæ•°æ®çš„æ—¶å€™ï¼Œrspä¸­ä¿å­˜çš„å€¼æ˜¯åŠ¨æ€å˜åŒ–çš„å—","like_count":1,"discussions":[{"author":{"id":1005890,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/42/e1757583.jpg","nickname":"Jason Yu äºèˆª","note":"","ucode":"0731492F4BC77D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539076,"discussion_content":"æ˜¯çš„ï¼Œpush æŒ‡ä»¤ä¼šè‡ªåŠ¨ä¿®æ”¹ rsp ä¸­çš„å€¼ã€‚å¯¹äºå®ƒçš„æ‰§è¡Œï¼Œä½ å¯ä»¥ç†è§£ä¸ºä¸¤æ­¥ï¼šç¬¬ä¸€æ­¥æ˜¯å‡å° rsp ä¸­çš„å€¼ï¼Œâ€œè…¾å‡ºâ€è¶³å¤Ÿçš„æ ˆå†…å­˜ï¼›ç¬¬äºŒæ­¥æ˜¯æŠŠå€¼æ”¾å…¥è¿™å—å†…å­˜ä¸­ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1639585792,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1155646,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKotsBr2icbYNYlRSlicGUD1H7lulSTQUAiclsEz9gnG5kCW9qeDwdYtlRMXic3V6sj9UrfKLPJnQojag/132","nickname":"ppd0705","note":"","ucode":"EB63D4E3FD1E9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1005890,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/42/e1757583.jpg","nickname":"Jason Yu äºèˆª","note":"","ucode":"0731492F4BC77D","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":553320,"discussion_content":"å“¦å“¦ æ‰€ä»¥`push rbp` è‡ªåŠ¨æ”¹äº†rspçš„å€¼å•Šï¼ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645848466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":539076,"ip_address":""},"score":553320,"extra":""}]}]},{"had_liked":false,"id":344510,"user_name":"è°­æ¸Š","can_delete":false,"product_type":"c1","uid":1111451,"ip_address":"","ucode":"E557725004FF74","user_header":"https://static001.geekbang.org/account/avatar/00/10/f5/9b/54495b53.jpg","comment_is_top":false,"comment_ctime":1651598422,"is_pvip":false,"replies":[{"id":"125879","content":"__fastcall æ˜¯å¾®è½¯æå‡ºçš„ä¸€ç§ç‰¹æ®Šçš„è°ƒç”¨çº¦å®šï¼›è€Œ SysV æœ¬è´¨ä¸Šæ˜¯ä¸€å¥— ABIï¼Œå®ƒå†…éƒ¨åŒ…å«æœ‰å¯¹ SysV è°ƒç”¨çº¦å®šçš„å…·ä½“æè¿°ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–æœ‰å…³ ABI çš„ç»†èŠ‚å†…å®¹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1005890","ctime":1651845198,"ip_address":"","comment_id":344510,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1651598422","product_id":100100701,"comment_content":"__fastcallå’ŒSysVå•¥å…³ç³»","like_count":0,"discussions":[{"author":{"id":1005890,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/42/e1757583.jpg","nickname":"Jason Yu äºèˆª","note":"","ucode":"0731492F4BC77D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":570653,"discussion_content":"__fastcall æ˜¯å¾®è½¯æå‡ºçš„ä¸€ç§ç‰¹æ®Šçš„è°ƒç”¨çº¦å®šï¼›è€Œ SysV æœ¬è´¨ä¸Šæ˜¯ä¸€å¥— ABIï¼Œå®ƒå†…éƒ¨åŒ…å«æœ‰å¯¹ SysV è°ƒç”¨çº¦å®šçš„å…·ä½“æè¿°ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–æœ‰å…³ ABI çš„ç»†èŠ‚å†…å®¹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651845198,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337876,"user_name":"Samaritan.","can_delete":false,"product_type":"c1","uid":2523660,"ip_address":"","ucode":"A3730B90313C26","user_header":"https://static001.geekbang.org/account/avatar/00/26/82/0c/cc106ab1.jpg","comment_is_top":false,"comment_ctime":1647102656,"is_pvip":false,"replies":[{"id":"123820","content":"è¿™é‡Œ rdi ä¿å­˜çš„æ˜¯ foo å‡½æ•°ç¬¬ä¸€ä¸ªä¼ å…¥å‚æ•°çš„å€¼ï¼ˆä¹Ÿå°±æ˜¯ 1ï¼‰ï¼Œè¿™ä¸ªæ˜¯ SysV è°ƒç”¨çº¦å®šä¸­è§„å®šçš„ã€‚ä¸è¿‡è¿™é‡Œç¡®å®å¯ä»¥åœ¨ç¬¬ 33 è¡Œç›´æ¥å°† 1 å­˜æ”¾åˆ° rdi ä¸­ï¼Œè€Œä¸éœ€è¦é€šè¿‡ rax æš‚å­˜ï¼Œå…·ä½“ä¸ºä»€ä¹ˆè¿™ä¹ˆåšè·Ÿç¼–è¯‘å™¨çš„å¯„å­˜å™¨åˆ†é…ç­–ç•¥æœ‰å…³ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1005890","ctime":1647753367,"ip_address":"","comment_id":337876,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1647102656","product_id":100100701,"comment_content":"è€å¸ˆä½ å¥½ï¼Œè¯·é—®ä¸‹å›¾Aä¸­çš„ä¸€ä¸ªé—®é¢˜:<br>å³è¾¹å›¾çš„ç¬¬40è¡Œï¼Œä¸ºä»€ä¹ˆè¿˜è¦åœ¨ediå¯„å­˜å™¨ä¿å­˜eaxå¯„å­˜å™¨çš„å€¼å‘¢ï¼Œç›´æ¥ä½¿ç”¨ç¬¬33è¡Œçš„eaxçš„å€¼ä¸å¯ä»¥å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1005890,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/42/e1757583.jpg","nickname":"Jason Yu äºèˆª","note":"","ucode":"0731492F4BC77D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557285,"discussion_content":"è¿™é‡Œ rdi ä¿å­˜çš„æ˜¯ foo å‡½æ•°ç¬¬ä¸€ä¸ªä¼ å…¥å‚æ•°çš„å€¼ï¼ˆä¹Ÿå°±æ˜¯ 1ï¼‰ï¼Œè¿™ä¸ªæ˜¯ SysV è°ƒç”¨çº¦å®šä¸­è§„å®šçš„ã€‚ä¸è¿‡è¿™é‡Œç¡®å®å¯ä»¥åœ¨ç¬¬ 33 è¡Œç›´æ¥å°† 1 å­˜æ”¾åˆ° rdi ä¸­ï¼Œè€Œä¸éœ€è¦é€šè¿‡ rax æš‚å­˜ï¼Œå…·ä½“ä¸ºä»€ä¹ˆè¿™ä¹ˆåšè·Ÿç¼–è¯‘å™¨çš„å¯„å­˜å™¨åˆ†é…ç­–ç•¥æœ‰å…³ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1647753367,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":326535,"user_name":"çˆ±æ–°è§‰ç½—æ™“æ¾","can_delete":false,"product_type":"c1","uid":1720400,"ip_address":"","ucode":"CF83BE67A0AED9","user_header":"https://static001.geekbang.org/account/avatar/00/1a/40/50/26c2cfc0.jpg","comment_is_top":false,"comment_ctime":1639555515,"is_pvip":false,"replies":[{"id":"118649","content":"å›ç­”æ­£ç¡®ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1005890","ctime":1639585818,"ip_address":"","comment_id":326535,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1639555515","product_id":100100701,"comment_content":"åœ¨ä¸ä½¿ç”¨ leave æŒ‡ä»¤çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥ä½¿ç”¨mov rsp, rbp å’Œ pop rbp, å°†rbpå¯„å­˜å™¨çš„å†…å®¹å¤åˆ¶åˆ°rspå¯„å­˜å™¨ä¸­ï¼Œä»¥é‡Šæ”¾åˆ†é…ç»™è¯¥è¿‡ç¨‹çš„æ‰€æœ‰å †æ ˆç©ºé—´ã€‚ç„¶åï¼Œä»å †æ ˆæ¢å¤rspå¯„å­˜å™¨çš„æ—§å€¼ã€‚<br>enterè·Ÿ push rbp å’Œ mov rbp, rspç­‰ä»·ï¼Œåœ¨è°ƒç”¨å‡½æ•°æ—¶ï¼Œåˆ›å»ºå †æ ˆå¸§ã€‚","like_count":0,"discussions":[{"author":{"id":1005890,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/42/e1757583.jpg","nickname":"Jason Yu äºèˆª","note":"","ucode":"0731492F4BC77D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539078,"discussion_content":"å›ç­”æ­£ç¡®ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639585818,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}