{"id":313255,"title":"06 | å®¹å™¨CPUï¼ˆ2ï¼‰ï¼šå¦‚ä½•æ­£ç¡®åœ°æ‹¿åˆ°å®¹å™¨CPUçš„å¼€é”€ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç¨‹è¿œã€‚ä»Šå¤©æˆ‘ä»¬èŠä¸€èŠï¼Œå¦‚ä½•æ­£ç¡®åœ°æ‹¿åˆ°å®¹å™¨CPUçš„å¼€é”€ã€‚</p><p>ä¸ºå•¥è¦è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Œè¿˜æ˜¯æ¥æºäºå®é™…å·¥ä½œä¸­çš„éœ€è¦ã€‚</p><p>æ— è®ºæ˜¯å®¹å™¨çš„æ‰€æœ‰è€…è¿˜æ˜¯å®¹å™¨å¹³å°çš„ç®¡ç†è€…ï¼Œæˆ‘ä»¬æƒ³è¦ç²¾å‡†åœ°å¯¹è¿è¡Œç€ä¼—å¤šå®¹å™¨çš„äº‘å¹³å°åšç›‘æ§ï¼Œå¿«é€Ÿæ’æŸ¥ä¾‹å¦‚åº”ç”¨çš„å¤„ç†èƒ½åŠ›ä¸‹é™ï¼ŒèŠ‚ç‚¹è´Ÿè½½è¿‡é«˜ç­‰é—®é¢˜ï¼Œå°±ç»•ä¸å¼€å®¹å™¨CPUå¼€é”€ã€‚<strong>å› ä¸ºCPUå¼€é”€çš„å¼‚å¸¸ï¼Œå¾€å¾€æ˜¯ç¨‹åºå¼‚å¸¸æœ€æ˜æ˜¾çš„ä¸€ä¸ªæŒ‡æ ‡ã€‚</strong></p><p>åœ¨ä¸€å°ç‰©ç†æœºå™¨æˆ–è€…è™šæ‹Ÿæœºé‡Œï¼Œå¦‚æœä½ æƒ³å¾—åˆ°è¿™ä¸ªèŠ‚ç‚¹çš„CPUä½¿ç”¨ç‡ï¼Œæœ€å¸¸ç”¨çš„å‘½ä»¤å°±æ˜¯topäº†å§ï¼Ÿtopä¸€ä¸‹å­å°±èƒ½çœ‹åˆ°æ•´ä¸ªèŠ‚ç‚¹å½“å‰çš„CPUä½¿ç”¨æƒ…å†µã€‚</p><p>é‚£ä¹ˆåœ¨å®¹å™¨é‡Œï¼Œtopå‘½ä»¤ä¹Ÿå¯ä»¥åšåˆ°è¿™ç‚¹å—ï¼Ÿæƒ³è¦çŸ¥é“ç­”æ¡ˆï¼Œæˆ‘ä»¬è¿˜æ˜¯å¾—å®é™…åŠ¨æ‰‹è¯•ä¸€è¯•ã€‚</p><h2>é—®é¢˜é‡ç°</h2><p>å®é™…ä¸Šï¼Œä½ åœ¨ä½¿ç”¨å®¹å™¨çš„æ—¶å€™ï¼Œå¦‚æœè¿è¡Œtopå‘½ä»¤æ¥æŸ¥çœ‹å½“å‰å®¹å™¨æ€»å…±ä½¿ç”¨äº†å¤šå°‘CPUï¼Œä½ è‚¯å®šé©¬ä¸Šå°±ä¼šå¤±æœ›äº†ã€‚</p><p>è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨å®¹å™¨ä¸­è¿è¡Œtopå‘½ä»¤ï¼Œè™½ç„¶å¯ä»¥çœ‹åˆ°å®¹å™¨ä¸­æ¯ä¸ªè¿›ç¨‹çš„CPUä½¿ç”¨ç‡ï¼Œä½†æ˜¯topä¸­\"%Cpu(s)\"é‚£ä¸€è¡Œä¸­æ˜¾ç¤ºçš„æ•°å€¼ï¼Œå¹¶ä¸æ˜¯è¿™ä¸ªå®¹å™¨çš„CPUæ•´ä½“ä½¿ç”¨ç‡ï¼Œè€Œæ˜¯å®¹å™¨å®¿ä¸»æœºçš„CPUä½¿ç”¨ç‡ã€‚</p><p>å°±åƒä¸‹é¢çš„è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ª12ä¸ªCPUçš„å®¿ä¸»æœºä¸Šï¼Œå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œç„¶ååœ¨å®¹å™¨é‡Œè¿è¡Œtopå‘½ä»¤ã€‚</p><p>è¿™æ—¶æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®¹å™¨é‡Œæœ‰ä¸¤ä¸ªè¿›ç¨‹threads-cpuï¼Œæ€»å…±æ¶ˆè€—äº†200%çš„CPUï¼ˆ2 CPU  Usageï¼‰ï¼Œè€Œ\"%Cpu(s)\"é‚£ä¸€è¡Œçš„\"us cpu\"æ˜¯58.5%ã€‚å¯¹äº12CPUçš„ç³»ç»Ÿæ¥è¯´ï¼Œ12 * 58.5%=7.02ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™é‡Œæ˜¾ç¤ºæ€»å…±æ¶ˆè€—äº†7ä¸ªCPUï¼Œè¿œè¿œå¤§äºå®¹å™¨ä¸­2ä¸ªCPUçš„æ¶ˆè€—ã€‚</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/by/fb/byy517a2ee2e041c5ce0ae4a30753cfb.png?wh=1686*568\" alt=\"\" title=\"è¿è¡Œtopçš„ç¤ºæ„å›¾\"></p><p>è¿™ä¸ªä¾‹å­è¯´æ˜ï¼Œtopè¿™ä¸ªå·¥å…·è™½ç„¶åœ¨ç‰©ç†æœºæˆ–è€…è™šæ‹Ÿæœºä¸Šçœ‹å¾—åˆ°ç³»ç»ŸCPUå¼€é”€ï¼Œä½†æ˜¯å¦‚æœæ˜¯æ”¾åœ¨å®¹å™¨ç¯å¢ƒä¸‹ï¼Œè¿è¡Œtopå°±æ— æ³•å¾—åˆ°å®¹å™¨ä¸­æ€»çš„CPUä½¿ç”¨ç‡ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬è¿˜æœ‰ä»€ä¹ˆå…¶ä»–çš„åŠæ³•å—ï¼Ÿ</p><h2>è¿›ç¨‹CPUä½¿ç”¨ç‡å’Œç³»ç»ŸCPUä½¿ç”¨ç‡</h2><p>é€šè¿‡é—®é¢˜é‡ç°ï¼Œæˆ‘ä»¬å‘ç°topå·¥å…·ä¸»è¦æ˜¾ç¤ºäº†å®¿ä¸»æœºç³»ç»Ÿæ•´ä½“çš„CPUä½¿ç”¨ç‡ï¼Œä»¥åŠå•ä¸ªè¿›ç¨‹çš„CPUä½¿ç”¨ç‡ã€‚æ—¢ç„¶æ²¡æœ‰ç°æˆçš„å·¥å…·å¯ä»¥å¾—åˆ°å®¹å™¨CPUå¼€é”€ï¼Œé‚£æˆ‘ä»¬éœ€è¦è‡ªå·±å¼€å‘ä¸€ä¸ªå·¥å…·æ¥è§£å†³é—®é¢˜äº†ã€‚</p><p>å…¶å®æˆ‘ä»¬è‡ªå·±æ¨å¯¼ï¼Œä¹Ÿæ²¡æœ‰é‚£ä¹ˆéš¾ã€‚æˆ‘è®¤ä¸ºï¼Œæœ€æœ‰æ•ˆçš„æ€è·¯è¿˜æ˜¯ä»åŸç†ä¸Šå»ç†è§£é—®é¢˜ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨è§£å†³æ€æ ·å¾—åˆ°å•ä¸ªå®¹å™¨æ•´ä½“çš„CPUä½¿ç”¨ç‡è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥å­¦ä¹ ä¸€ä¸‹ï¼Œåœ¨Linuxä¸­åˆ°åº•æ˜¯å¦‚ä½•è®¡ç®—å•ä¸ªè¿›ç¨‹çš„CPUä½¿ç”¨ç‡ï¼Œè¿˜æœ‰æ•´ä¸ªç³»ç»Ÿçš„CPUä½¿ç”¨ç‡çš„ã€‚</p><h3>è¿›ç¨‹CPUä½¿ç”¨ç‡</h3><p>Linuxä¸­æ¯ä¸ªè¿›ç¨‹çš„CPUä½¿ç”¨ç‡ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ç”¨topå‘½ä»¤æŸ¥çœ‹ã€‚</p><p>å¯¹ç…§æˆ‘ä»¬å‰é¢çš„é‚£å¼ ç¤ºæ„å›¾ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæ¯ä¸ªè¿›ç¨‹åœ¨topå‘½ä»¤è¾“å‡ºä¸­éƒ½æœ‰å¯¹åº”çš„ä¸€è¡Œï¼Œç„¶åâ€œ%CPUâ€çš„é‚£ä¸€åˆ—å°±æ˜¯è¿™ä¸ªè¿›ç¨‹çš„å®æ—¶CPUä½¿ç”¨ç‡äº†ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œ100%å°±è¡¨ç¤ºè¿™ä¸ªè¿›ç¨‹åœ¨è¿™ä¸ªç¬æ—¶ä½¿ç”¨äº†1ä¸ªCPUï¼Œ200%å°±æ˜¯ä½¿ç”¨äº†2ä¸ªCPUã€‚é‚£ä¹ˆè¿™ä¸ªç™¾åˆ†æ¯”çš„æ•°å€¼æ˜¯æ€ä¹ˆå¾—åˆ°å‘¢ï¼Ÿ</p><p>æœ€ç›´æ¥çš„æ–¹æ³•ï¼Œå°±æ˜¯ä»æºå¤´å¼€å§‹å¯»æ‰¾ç­”æ¡ˆã€‚å› ä¸ºæ˜¯topå‘½ä»¤çš„è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥å»çœ‹ä¸€ä¸‹topå‘½ä»¤çš„<a href=\"https://gitlab.com/procps-ng/procps\">æºä»£ç </a>ã€‚åœ¨ä»£ç ä¸­ä½ ä¼šçœ‹åˆ°å¯¹äºæ¯ä¸ªè¿›ç¨‹ï¼Œtopéƒ½ä¼šä»procæ–‡ä»¶ç³»ç»Ÿä¸­æ¯ä¸ªè¿›ç¨‹å¯¹åº”çš„statæ–‡ä»¶ä¸­è¯»å–2ä¸ªæ•°å€¼ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹è¿™ä¸ªæ–‡ä»¶ï¼Œå†æ¥è§£è¯»æ–‡ä»¶ä¸­å…·ä½“çš„ä¸¤ä¸ªæ•°å€¼ã€‚</p><p>è¿™ä¸ªstatæ–‡ä»¶å°±æ˜¯ <code>/proc/[pid]/stat</code> ï¼Œ <code>[pid]</code> å°±æ˜¯æ›¿æ¢æˆå…·ä½“ä¸€ä¸ªè¿›ç¨‹çš„PIDå€¼ã€‚æ¯”å¦‚PIDå€¼ä¸º1çš„è¿›ç¨‹ï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯ <code>/proc/1/stat</code> ï¼Œé‚£ä¹ˆè¿™ä¸ª <code>/proc/[pid]/stat</code> æ–‡ä»¶é‡Œæœ‰ä»€ä¹ˆä¿¡æ¯å‘¢ï¼Ÿ</p><p>å…¶å®è¿™ä¸ªstatæ–‡ä»¶å®æ—¶è¾“å‡ºäº†è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ï¼Œæ¯”å¦‚è¿›ç¨‹çš„è¿è¡Œæ€ï¼ˆRunningè¿˜æ˜¯ Sleepingï¼‰ã€çˆ¶è¿›ç¨‹PIDã€è¿›ç¨‹ä¼˜å…ˆçº§ã€è¿›ç¨‹ä½¿ç”¨çš„å†…å­˜ç­‰ç­‰æ€»å…±50å¤šé¡¹ã€‚</p><p>å®Œæ•´çš„statæ–‡ä»¶å†…å®¹å’Œæ ¼å¼åœ¨procæ–‡ä»¶ç³»ç»Ÿçš„ <a href=\"https://man7.org/linux/man-pages/man5/proc.5.html\">Linux programmerâ€™s manual</a> é‡Œå®šä¹‰äº†ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åªéœ€è¦é‡ç‚¹å…³æ³¨è¿™ä¸¤é¡¹æ•°å€¼ï¼Œstatæ–‡ä»¶ä¸­çš„ç¬¬14é¡¹utimeå’Œç¬¬15é¡¹stimeã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/53/b1/53c409d607942e8189f73636aafe3cb1.png?wh=790*333\" alt=\"\"></p><p>é‚£ä¹ˆè¿™ä¸¤é¡¹æ•°å€¼utimeå’Œstimeæ˜¯ä»€ä¹ˆå«ä¹‰å‘¢ï¼Ÿutimeæ˜¯è¡¨ç¤ºè¿›ç¨‹çš„ç”¨æˆ·æ€éƒ¨åˆ†åœ¨Linuxè°ƒåº¦ä¸­è·å¾—CPUçš„ticksï¼Œstimeæ˜¯è¡¨ç¤ºè¿›ç¨‹çš„å†…æ ¸æ€éƒ¨åˆ†åœ¨Linuxè°ƒåº¦ä¸­è·å¾—CPUçš„ticksã€‚</p><p>çœ‹åˆ°è¿™ä¸ªè§£é‡Šï¼Œä½ å¯èƒ½åˆå†’å‡ºä¸€ä¸ªæ–°é—®é¢˜ï¼Œç–‘æƒ‘ticksæ˜¯ä»€ä¹ˆ?è¿™ä¸ªtickså°±æ˜¯Linuxæ“ä½œç³»ç»Ÿä¸­çš„ä¸€ä¸ªæ—¶é—´å•ä½ï¼Œä½ å¯ä»¥ç†è§£æˆç±»ä¼¼ç§’ï¼Œæ¯«ç§’çš„æ¦‚å¿µã€‚</p><p>åœ¨Linuxä¸­æœ‰ä¸ªè‡ªå·±çš„æ—¶é’Ÿï¼Œå®ƒä¼šå‘¨æœŸæ€§åœ°äº§ç”Ÿä¸­æ–­ã€‚æ¯æ¬¡ä¸­æ–­éƒ½ä¼šè§¦å‘Linuxå†…æ ¸å»åšä¸€æ¬¡è¿›ç¨‹è°ƒåº¦ï¼Œè€Œè¿™ä¸€æ¬¡ä¸­æ–­å°±æ˜¯ä¸€ä¸ªtickã€‚å› ä¸ºæ˜¯å‘¨æœŸæ€§çš„ä¸­æ–­ï¼Œæ¯”å¦‚1ç§’é’Ÿ100æ¬¡ä¸­æ–­ï¼Œé‚£ä¹ˆä¸€ä¸ªtickä½œä¸ºä¸€ä¸ªæ—¶é—´å•ä½çœ‹çš„è¯ï¼Œä¹Ÿå°±æ˜¯1/100ç§’ã€‚</p><p>æˆ‘ç»™ä½ ä¸¾ä¸ªä¾‹å­è¯´æ˜ï¼Œå‡å¦‚è¿›ç¨‹çš„utimeæ˜¯130ticksï¼Œå°±ç›¸å½“äº130 * 1/100=1.3ç§’ï¼Œä¹Ÿå°±æ˜¯è¿›ç¨‹ä»å¯åŠ¨å¼€å§‹åœ¨ç”¨æˆ·æ€æ€»å…±è¿è¡Œäº†1.3ç§’é’Ÿã€‚</p><p>è¿™é‡Œéœ€è¦ä½ æ³¨æ„ï¼Œutimeå’Œstimeéƒ½æ˜¯ä¸€ä¸ªç´¯è®¡å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´ä»è¿›ç¨‹å¯åŠ¨å¼€å§‹ï¼Œè¿™ä¸¤ä¸ªå€¼å°±æ˜¯ä¸€ç›´åœ¨ç´¯ç§¯å¢é•¿çš„ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆè®¡ç®—ï¼Œæ‰èƒ½çŸ¥é“æŸä¸€è¿›ç¨‹åœ¨ç”¨æˆ·æ€å’Œå†…æ ¸æ€ä¸­ï¼Œåˆ†åˆ«è·å¾—äº†å¤šå°‘CPUçš„tickså‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾è¿™ä¸ªç¬æ—¶æ˜¯1ç§’é’Ÿï¼Œè¿™1ç§’æ˜¯T1æ—¶åˆ»åˆ°T2æ—¶åˆ»ä¹‹é—´çš„ï¼Œé‚£ä¹ˆè¿™æ ·æˆ‘ä»¬å°±èƒ½è·å¾— T1 æ—¶åˆ»çš„utime_1 å’Œstime_1ï¼ŒåŒæ—¶è·å¾—T2æ—¶åˆ»çš„utime_2 å’Œ stime_2ã€‚</p><p>åœ¨è¿™1ç§’çš„ç¬æ—¶ï¼Œè¿›ç¨‹ç”¨æˆ·æ€è·å¾—çš„CPU tickså°±æ˜¯ (utime_2 â€“ utime_1), è¿›ç¨‹å†…æ ¸æ€è·å¾—çš„CPU tickså°±æ˜¯ (stime_2 â€“ stime_1)ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ¨å¯¼å‡ºï¼Œè¿›ç¨‹CPUæ€»çš„å¼€é”€å°±æ˜¯ç”¨æˆ·æ€åŠ ä¸Šå†…æ ¸æ€ï¼Œä¹Ÿå°±æ˜¯åœ¨1ç§’ç¬æ—¶è¿›ç¨‹æ€»çš„CPU ticksç­‰äº (utime_2 â€“ utime_1) + (stime_2 â€“ stime_1)ã€‚</p><p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å¾—åˆ°äº†è¿›ç¨‹ä»¥ticksä¸ºå•ä½çš„CPUå¼€é”€ï¼Œæ¥ä¸‹æ¥è¿˜è¦åšä¸ªè½¬åŒ–ã€‚æˆ‘ä»¬æ€æ ·æ‰èƒ½æŠŠè¿™ä¸ªå€¼è½¬åŒ–æˆæˆ‘ä»¬ç†Ÿæ‚‰çš„ç™¾åˆ†æ¯”å€¼å‘¢ï¼Ÿå…¶å®ä¹Ÿä¸éš¾ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥å»topçš„<a href=\"https://gitlab.com/procps-ng/procps\">æºä»£ç </a>é‡Œå¾—åˆ°è¿™ä¸ªç™¾åˆ†æ¯”çš„è®¡ç®—å…¬å¼ã€‚</p><p>ç®€å•æ€»ç»“ä¸€ä¸‹ï¼Œè¿™ä¸ªå…¬å¼æ˜¯è¿™æ ·çš„ï¼š</p><p><strong>è¿›ç¨‹çš„CPUä½¿ç”¨ç‡=((utime_2 â€“ utime_1) + (stime_2 â€“ stime_1)) * 100.0 / (HZ * et * 1 )</strong></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å†ç»™ä½ è®²ä¸€ä¸‹ï¼Œè¿™ä¸ªå…¬å¼é‡Œæ¯ä¸€ä¸ªéƒ¨åˆ†çš„å«ä¹‰ã€‚</p><p>é¦–å…ˆï¼Œ ((utime_2 â€“ utime_1) + (stime_2 â€“ stime_1))æ˜¯ç¬æ—¶è¿›ç¨‹æ€»çš„CPU ticksã€‚è¿™ä¸ªæˆ‘ä»¬å·²ç»åœ¨å‰é¢è§£é‡Šè¿‡äº†ã€‚</p><p>å…¶æ¬¡ï¼Œæˆ‘ä»¬æ¥çœ‹100.0ï¼Œè¿™é‡Œä¹˜ä»¥100.0çš„ç›®çš„æ˜¯äº§ç”Ÿç™¾åˆ†æ¯”æ•°å€¼ã€‚</p><p>æœ€åï¼Œæˆ‘å†è®²ä¸€ä¸‹  <strong>(HZ * et * 1)</strong>ã€‚è¿™æ˜¯è¢«é™¤æ•°è¿™é‡Œçš„ä¸‰ä¸ªå‚æ•°ï¼Œæˆ‘ç»™ä½ è¯¦ç»†è§£é‡Šä¸€ä¸‹ã€‚</p><p>ç¬¬ä¸€ä¸ªHZæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå‰é¢æˆ‘ä»¬ä»‹ç»ticksé‡Œè¯´äº†ï¼Œticksæ˜¯æŒ‰ç…§å›ºå®šé¢‘ç‡å‘ç”Ÿçš„ï¼Œåœ¨æˆ‘ä»¬çš„Linuxç³»ç»Ÿé‡Œ1ç§’é’Ÿæ˜¯100æ¬¡ï¼Œé‚£ä¹ˆHZå°±æ˜¯1ç§’é’Ÿé‡Œticksçš„æ¬¡æ•°ï¼Œè¿™é‡Œå€¼æ˜¯100ã€‚</p><p>ç¬¬äºŒä¸ªå‚æ•°etæ˜¯æˆ‘ä»¬åˆšæ‰è¯´çš„é‚£ä¸ªâ€œç¬æ—¶â€çš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯å¾—åˆ°utime_1å’Œutime_2è¿™ä¸¤ä¸ªå€¼çš„æ—¶é—´é—´éš”ã€‚</p><p>ç¬¬ä¸‰ä¸ªâ€œ1â€, å°±æ›´å®¹æ˜“ç†è§£äº†ï¼Œå°±æ˜¯1ä¸ªCPUã€‚é‚£ä¹ˆè¿™ä¸‰ä¸ªå€¼ç›¸ä¹˜ï¼Œä½ æ˜¯ä¸æ˜¯ä¹ŸçŸ¥é“äº†å®ƒçš„æ„æ€å‘¢ï¼Ÿå°±æ˜¯åœ¨è¿™â€œç¬æ—¶â€çš„æ—¶é—´ï¼ˆetï¼‰é‡Œï¼Œ1ä¸ªCPUæ‰€åŒ…å«çš„ticksæ•°ç›®ã€‚</p><p>è§£é‡Šäº†è¿™äº›å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªå…¬å¼ç®€åŒ–ä¸€ä¸‹ï¼Œå°±æ˜¯ä¸‹é¢è¿™æ ·ï¼š</p><p>è¿›ç¨‹çš„CPUä½¿ç”¨ç‡=ï¼ˆè¿›ç¨‹çš„ticks/å•ä¸ªCPUæ€»ticksï¼‰*100.0</p><p>çŸ¥é“äº†è¿™ä¸ªå…¬å¼ï¼Œå°±éœ€è¦ä¸Šæ‰‹æ¥éªŒè¯ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•å¯¹ä¸å¯¹ï¼Œæ€ä¹ˆéªŒè¯å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å¯åŠ¨ä¸€ä¸ªæ¶ˆè€—CPUçš„å°ç¨‹åºï¼Œç„¶åè¯»å–ä¸€ä¸‹è¿›ç¨‹å¯¹åº”çš„/proc/[pid]/statä¸­çš„utimeå’Œstimeï¼Œç„¶åç”¨è¿™ä¸ªæ–¹æ³•æ¥è®¡ç®—ä¸€ä¸‹è¿›ç¨‹ä½¿ç”¨ç‡è¿™ä¸ªç™¾åˆ†æ¯”å€¼ï¼Œå¹¶ä¸”å’Œtopçš„è¾“å‡ºå¯¹æ¯”ä¸€ä¸‹ï¼Œçœ‹çœ‹æ˜¯å¦ä¸€è‡´ã€‚</p><p>å…ˆå¯åŠ¨ä¸€ä¸ªæ¶ˆè€—200%çš„å°ç¨‹åºï¼Œå®ƒçš„PIDæ˜¯10021ï¼ŒCPUä½¿ç”¨ç‡æ˜¯200%ã€‚<br>\n<img src=\"https://static001.geekbang.org/resource/image/yy/f9/yy5f601a16cd9c5f8b01157daea0d4f9.png?wh=1644*364\" alt=\"\"></p><p>ç„¶åï¼Œæˆ‘ä»¬æŸ¥çœ‹è¿™ä¸ªè¿›ç¨‹å¯¹åº”çš„statæ–‡ä»¶/proc/10021/statï¼Œé—´éš”1ç§’é’Ÿè¾“å‡ºç¬¬äºŒæ¬¡ï¼Œå› ä¸ºstatæ–‡ä»¶å†…å®¹å¾ˆå¤šï¼Œæˆ‘ä»¬çŸ¥é“utimeå’Œstimeç¬¬14å’Œ15é¡¹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œåªæˆªå–äº†å‰15é¡¹çš„è¾“å‡ºã€‚è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œutime_1 = 399ï¼Œstime_1=0ï¼Œutime_2=600ï¼Œstime_2=0ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/29/b0/29609d255bfd22eab6697f6ccd4923b0.png?wh=1556*102\" alt=\"\"></p><p>æ ¹æ®å‰é¢çš„å…¬å¼ï¼Œæˆ‘ä»¬è®¡ç®—ä¸€ä¸‹è¿›ç¨‹threads-cpuçš„CPUä½¿ç”¨ç‡ã€‚å¥—ç”¨å‰é¢çš„å…¬å¼ï¼Œè®¡ç®—çš„è¿‡ç¨‹æ˜¯ï¼š</p><p>((600 â€“ 399) + (0 â€“ 0)) * 100.0 / (100 * 1 * 1) =201ï¼Œä¹Ÿå°±æ˜¯201%ã€‚ä½ ä¼šå‘ç°è¿™ä¸ªå€¼å’Œæˆ‘ä»¬è¿è¡Œtopé‡Œçš„å€¼æ˜¯ä¸€æ ·çš„ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå°±éªŒè¯äº†è¿™ä¸ªå…¬å¼æ˜¯æ²¡é—®é¢˜çš„ã€‚</p><h3>ç³»ç»ŸCPUä½¿ç”¨ç‡</h3><p>å‰é¢æˆ‘ä»¬ä»‹ç»äº†Linuxä¸­å¦‚ä½•è·å–å•ä¸ªè¿›ç¨‹çš„CPUä½¿ç”¨ç‡ï¼Œä¸‹é¢æˆ‘ä»¬å†æ¥çœ‹çœ‹Linuxé‡Œæ˜¯æ€ä¹ˆè®¡ç®—ç³»ç»Ÿçš„æ•´ä½“CPUä½¿ç”¨ç‡çš„ã€‚</p><p>å…¶å®çŸ¥é“äº†å¦‚ä½•è®¡ç®—å•ä¸ªè¿›ç¨‹çš„CPUä½¿ç”¨ç‡ä¹‹åï¼Œè¦ç†è§£ç³»ç»Ÿæ•´ä½“çš„CPUä½¿ç”¨ç‡è®¡ç®—æ–¹æ³•å°±ç®€å•å¤šäº†ã€‚</p><p>åŒæ ·ï¼Œæˆ‘ä»¬è¦è®¡ç®—CPUä½¿ç”¨ç‡ï¼Œé¦–å…ˆéœ€è¦æ‹¿åˆ°æ•°æ®ï¼Œæ•°æ®æºä¹ŸåŒæ ·å¯ä»¥ä»procæ–‡ä»¶ç³»ç»Ÿé‡Œå¾—åˆ°ï¼Œå¯¹äºæ•´ä¸ªç³»ç»Ÿçš„CPUä½¿ç”¨ç‡ï¼Œè¿™ä¸ªæ–‡ä»¶å°±æ˜¯/proc/statã€‚</p><p>åœ¨/proc/stat æ–‡ä»¶çš„ <code>cpu</code> è¿™è¡Œæœ‰10åˆ—æ•°æ®ï¼ŒåŒæ ·æˆ‘ä»¬å¯ä»¥åœ¨procæ–‡ä»¶ç³»ç»Ÿçš„ <a href=\"https://man7.org/linux/man-pages/man5/proc.5.html\"></a><a href=\"https://man7.org/linux/man-pages/man5/proc.5.html\">Linux programmerâ€™s manual</a> é‡Œï¼Œæ‰¾åˆ°æ¯ä¸€åˆ—æ•°æ®çš„å®šä¹‰ï¼Œè€Œå‰8åˆ—æ•°æ®æ­£å¥½å¯¹åº”topè¾“å‡ºä¸­\"%Cpu(s)\"é‚£ä¸€è¡Œé‡Œçš„8é¡¹æ•°æ®ï¼Œä¹Ÿå°±æ˜¯åœ¨ä¸Šä¸€è®²ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»è¿‡çš„user/system/nice/idle/iowait/irq/softirq/steal è¿™8é¡¹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/7d/9d/7da412b1b9e4f4b235e5dae6c997859d.png?wh=1748*62\" alt=\"\"></p><p>è€Œåœ¨/proc/staté‡Œçš„æ¯ä¸€é¡¹çš„æ•°å€¼ï¼Œå°±æ˜¯ç³»ç»Ÿè‡ªå¯åŠ¨å¼€å§‹çš„ticksã€‚é‚£ä¹ˆè¦è®¡ç®—å‡ºâ€œç¬æ—¶â€çš„CPUä½¿ç”¨ç‡ï¼Œé¦–å…ˆå°±è¦ç®—å‡ºè¿™ä¸ªâ€œç¬æ—¶â€çš„ticksï¼Œæ¯”å¦‚1ç§’é’Ÿçš„â€œç¬æ—¶â€ï¼Œæˆ‘ä»¬å¯ä»¥è®°å½•å¼€å§‹æ—¶åˆ»T1çš„ticks, ç„¶åå†è®°å½•1ç§’é’ŸåT2æ—¶åˆ»çš„ticksï¼Œå†æŠŠè¿™ä¸¤è€…ç›¸å‡ï¼Œå°±å¯ä»¥å¾—åˆ°è¿™1ç§’é’Ÿçš„ticksäº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/fa/60/fa59040d49cb20d808619957ae1e2760.png?wh=1452*140\" alt=\"\"></p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ï¼Œåœ¨è¿™1ç§’é’Ÿé‡Œæ¯ä¸ªCPUä½¿ç”¨ç‡çš„ticksï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/f5/bd/f550d24358e7cc909ff337f4840512bd.jpeg?wh=3200*1800\" alt=\"\"></p><p>æˆ‘ä»¬æƒ³è¦è®¡ç®—æ¯ä¸€ç§CPUä½¿ç”¨ç‡çš„ç™¾åˆ†æ¯”ï¼Œå…¶å®ä¹Ÿå¾ˆç®€å•ã€‚æˆ‘ä»¬åªéœ€è¦æŠŠæ‰€æœ‰åœ¨è¿™1ç§’é‡Œçš„ticksç›¸åŠ å¾—åˆ°ä¸€ä¸ªæ€»å€¼ï¼Œç„¶åæ‹¿æŸä¸€é¡¹çš„tickså€¼ï¼Œé™¤ä»¥è¿™ä¸ªæ€»å€¼ã€‚æ¯”å¦‚è¯´è®¡ç®—idle CPUçš„ä½¿ç”¨ç‡å°±æ˜¯ï¼š</p><p>1203 /ï¼ˆ 0 + 0 + 0 + 1203 + 0 + 0 + 0 + 0ï¼‰=100%</p><p>å¥½äº†ï¼Œæˆ‘ä»¬ç°åœ¨æ¥æ•´ä½“æ¢³ç†ä¸€ä¸‹ï¼Œæˆ‘ä»¬é€šè¿‡Linuxé‡Œçš„å·¥å…·ï¼Œè¦æ€æ ·è®¡ç®—è¿›ç¨‹çš„CPUä½¿ç”¨ç‡å’Œç³»ç»Ÿçš„CPUä½¿ç”¨ç‡ã€‚</p><p>å¯¹äºå•ä¸ªè¿›ç¨‹çš„CPUä½¿ç”¨ç‡è®¡ç®—ï¼Œæˆ‘ä»¬éœ€è¦è¯»å–å¯¹åº”è¿›ç¨‹çš„/proc/[pid]/statæ–‡ä»¶ï¼Œå°†è¿›ç¨‹ç¬æ—¶ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„ticksæ•°ç›¸åŠ ï¼Œå°±èƒ½å¾—åˆ°è¿›ç¨‹çš„æ€»ticksã€‚</p><p>ç„¶åæˆ‘ä»¬è¿ç”¨å…¬å¼â€œ(è¿›ç¨‹çš„ticks / å•ä¸ªCPUæ€»ticks) * 100.0â€è®¡ç®—å‡ºè¿›ç¨‹CPUä½¿ç”¨ç‡çš„ç™¾åˆ†æ¯”å€¼ã€‚</p><p>å¯¹äºç³»ç»Ÿçš„CPUä½¿ç”¨ç‡ï¼Œéœ€è¦è¯»å–/proc/statæ–‡ä»¶ï¼Œå¾—åˆ°ç¬æ—¶å„é¡¹CPUä½¿ç”¨ç‡çš„tickså€¼ï¼Œç›¸åŠ å¾—åˆ°ä¸€ä¸ªæ€»å€¼ï¼Œå•é¡¹å€¼é™¤ä»¥æ€»å€¼å°±æ˜¯å„é¡¹CPUçš„ä½¿ç”¨ç‡ã€‚</p><h2>è§£å†³é—®é¢˜</h2><p>å‰é¢æˆ‘ä»¬å­¦ä¹ äº†åœ¨Linuxä¸­ï¼Œtopå·¥å…·æ˜¯æ€æ ·è®¡ç®—æ¯ä¸ªè¿›ç¨‹çš„CPUä½¿ç”¨ç‡ï¼Œä»¥åŠç³»ç»Ÿæ€»çš„CPUä½¿ç”¨ç‡ã€‚ç°åœ¨æˆ‘ä»¬å†æ¥çœ‹æœ€åˆçš„é—®é¢˜ï¼šä¸ºä»€ä¹ˆåœ¨å®¹å™¨ä¸­è¿è¡Œtopå‘½ä»¤ä¸èƒ½å¾—åˆ°å®¹å™¨ä¸­æ€»çš„CPUä½¿ç”¨ç‡ï¼Ÿ</p><p>è¿™å°±æ¯”è¾ƒå¥½è§£é‡Šäº†ï¼Œå¯¹äºç³»ç»Ÿæ€»çš„CPUä½¿ç”¨ç‡ï¼Œéœ€è¦è¯»å–/proc/statæ–‡ä»¶ï¼Œä½†æ˜¯è¿™ä¸ªæ–‡ä»¶ä¸­çš„å„é¡¹CPU ticksæ˜¯åæ˜ æ•´ä¸ªèŠ‚ç‚¹çš„ï¼Œå¹¶ä¸”è¿™ä¸ª/proc/statæ–‡ä»¶ä¹Ÿä¸åŒ…å«åœ¨ä»»æ„ä¸€ä¸ªNamespaceé‡Œã€‚</p><p>é‚£ä¹ˆï¼Œ<strong>å¯¹äºtopå‘½ä»¤æ¥è¯´ï¼Œå®ƒåªèƒ½æ˜¾ç¤ºæ•´ä¸ªèŠ‚ç‚¹ä¸­å„é¡¹CPUçš„ä½¿ç”¨ç‡ï¼Œä¸èƒ½æ˜¾ç¤ºå•ä¸ªå®¹å™¨çš„å„é¡¹CPUçš„ä½¿ç”¨ç‡</strong>ã€‚æ—¢ç„¶topå‘½ä»¤ä¸è¡Œï¼Œæˆ‘ä»¬è¿˜æœ‰æ²¡æœ‰åŠæ³•å¾—åˆ°æ•´ä¸ªå®¹å™¨çš„CPUä½¿ç”¨ç‡å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ä¹‹å‰å·²ç»å­¦ä¹ è¿‡äº†CPU Cgroupï¼Œæ¯ä¸ªå®¹å™¨éƒ½ä¼šæœ‰ä¸€ä¸ªCPU Cgroupçš„æ§åˆ¶ç»„ã€‚åœ¨è¿™ä¸ªæ§åˆ¶ç»„ç›®å½•ä¸‹é¢æœ‰å¾ˆå¤šå‚æ•°æ–‡ä»¶ï¼Œæœ‰çš„å‚æ•°å¯ä»¥å†³å®šè¿™ä¸ªæ§åˆ¶ç»„é‡Œæœ€å¤§çš„CPUå¯ä½¿ç”¨ç‡å¤–ï¼Œé™¤äº†å®ƒä»¬ä¹‹å¤–ï¼Œç›®å½•ä¸‹é¢è¿˜æœ‰ä¸€ä¸ªå¯è¯»é¡¹cpuacct.statã€‚</p><p>è¿™é‡ŒåŒ…å«äº†ä¸¤ä¸ªç»Ÿè®¡å€¼ï¼Œè¿™ä¸¤ä¸ªå€¼åˆ†åˆ«æ˜¯<strong>è¿™ä¸ªæ§åˆ¶ç»„é‡Œæ‰€æœ‰è¿›ç¨‹çš„å†…æ ¸æ€tickså’Œç”¨æˆ·æ€çš„ticks</strong>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç”¨å‰é¢è®²è¿‡çš„å…¬å¼ï¼Œä¹Ÿå°±æ˜¯è®¡ç®—è¿›ç¨‹CPUä½¿ç”¨ç‡çš„å…¬å¼ï¼Œå»è®¡ç®—æ•´ä¸ªå®¹å™¨çš„CPUä½¿ç”¨ç‡ï¼š</p><p>CPUä½¿ç”¨ç‡=((utime_2 â€“ utime_1) + (stime_2 â€“ stime_1)) * 100.0 / (HZ * et * 1 )</p><p>æˆ‘ä»¬è¿˜æ˜¯ä»¥é—®é¢˜é‡ç°ä¸­çš„ä¾‹å­è¯´æ˜ï¼Œä¹Ÿå°±æ˜¯æœ€å¼€å§‹å¯åŠ¨å®¹å™¨é‡Œçš„é‚£ä¸¤ä¸ªå®¹å™¨threads-cpuè¿›ç¨‹ã€‚</p><p>å°±åƒä¸‹å›¾æ˜¾ç¤ºçš„è¿™æ ·ï¼Œæ•´ä¸ªå®¹å™¨çš„CPUä½¿ç”¨ç‡çš„ç™¾åˆ†æ¯”å°±æ˜¯ ( (174021 - 173820) + (4 â€“ 4)) * 100.0 / (100 * 1 * 1) = 201, ä¹Ÿå°±æ˜¯201%ã€‚<strong>æ‰€ä»¥ï¼Œæˆ‘ä»¬ä»æ¯ä¸ªå®¹å™¨çš„CPU Cgroupæ§åˆ¶ç»„é‡Œçš„cpuacct.statçš„ç»Ÿè®¡å€¼ä¸­ï¼Œ</strong>å¯ä»¥æ¯”è¾ƒå¿«åœ°å¾—åˆ°æ•´ä¸ªå®¹å™¨çš„CPUä½¿ç”¨ç‡ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/fd/95/fdcfd5yy6e593cccea1bed7bfe4e5095.png?wh=1920*321\" alt=\"\"></p><h2>é‡ç‚¹æ€»ç»“</h2><p>Linuxé‡Œè·å–CPUä½¿ç”¨ç‡çš„å·¥å…·ï¼Œæ¯”å¦‚topï¼Œéƒ½æ˜¯é€šè¿‡è¯»å–procæ–‡ä»¶ç³»ç»Ÿä¸‹çš„statæ–‡ä»¶æ¥å¾—åˆ°CPUä½¿ç”¨äº†å¤šå°‘ticksã€‚è€Œè¿™é‡Œçš„ticksï¼Œæ˜¯Linuxæ“ä½œç³»ç»Ÿé‡Œçš„ä¸€ä¸ªæ—¶é—´å•ä½ï¼Œå¯ä»¥ç†è§£æˆç±»ä¼¼ç§’ï¼Œæ¯«ç§’çš„æ¦‚å¿µã€‚</p><p>å¯¹äºæ¯ä¸ªè¿›ç¨‹æ¥è¯´ï¼Œå®ƒçš„statæ–‡ä»¶æ˜¯/proc/[pid]/statï¼Œé‡Œé¢åŒ…å«äº†è¿›ç¨‹ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„ticksæ•°ç›®ï¼›å¯¹äºæ•´ä¸ªèŠ‚ç‚¹ï¼Œå®ƒçš„statæ–‡ä»¶æ˜¯ /proc/statï¼Œé‡Œé¢åŒ…å«äº†user/system/nice/idle/iowaitç­‰ä¸åŒCPUå¼€é”€ç±»å‹çš„ticksã€‚</p><p><strong>ç”±äº/proc/statæ–‡ä»¶æ˜¯æ•´ä¸ªèŠ‚ç‚¹å…¨å±€çš„çŠ¶æ€æ–‡ä»¶ï¼Œä¸å±äºä»»ä½•ä¸€ä¸ªNamespaceï¼Œå› æ­¤åœ¨å®¹å™¨ä¸­æ— æ³•é€šè¿‡è¯»å–/proc/statæ–‡ä»¶æ¥è·å–å•ä¸ªå®¹å™¨çš„CPUä½¿ç”¨ç‡ã€‚</strong></p><p>æ‰€ä»¥è¦å¾—åˆ°å•ä¸ªå®¹å™¨çš„CPUä½¿ç”¨ç‡ï¼Œæˆ‘ä»¬å¯ä»¥ä»CPU Cgroupæ¯ä¸ªæ§åˆ¶ç»„é‡Œçš„ç»Ÿè®¡æ–‡ä»¶cpuacct.statä¸­è·å–ã€‚<strong>å•ä¸ªå®¹å™¨CPUä½¿ç”¨ç‡=((utime_2 â€“ utime_1) + (stime_2 â€“ stime_1)) * 100.0 / (HZ * et * 1 )ã€‚</strong></p><p>å¾—åˆ°å•ä¸ªå®¹å™¨çš„CPUçš„ä½¿ç”¨ç‡ï¼Œé‚£ä¹ˆå½“å®¿ä¸»æœºä¸Šè´Ÿè½½å˜é«˜çš„æ—¶å€™ï¼Œå°±å¯ä»¥å¾ˆå¿«çŸ¥é“æ˜¯å“ªä¸ªå®¹å™¨å¼•èµ·çš„é—®é¢˜ã€‚åŒæ—¶ï¼Œç”¨æˆ·åœ¨ç®¡ç†è‡ªå·±æˆç™¾ä¸Šåƒçš„å®¹å™¨çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥å¾ˆå¿«å‘ç°CPUä½¿ç”¨ç‡å¼‚å¸¸çš„å®¹å™¨ï¼Œè¿™æ ·å°±èƒ½åŠæ—©åœ°ä»‹å…¥å»è§£å†³é—®é¢˜ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>å†™ä¸€ä¸ªå°ç¨‹åºï¼Œåœ¨å®¹å™¨ä¸­æ‰§è¡Œï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºå½“å‰å®¹å™¨ä¸­æ‰€æœ‰è¿›ç¨‹æ€»çš„CPUä½¿ç”¨ç‡ã€‚</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºå’Œæˆ‘äº’åŠ¨ï¼Œä¸€èµ·æ¢è®¨å®¹å™¨CPUçš„ç›¸å…³é—®é¢˜ã€‚å¦‚æœè¿™ç¯‡æ–‡ç« è®©ä½ æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿ä½ åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ï¼Œä¸€èµ·å­¦ä¹ è¿›æ­¥ã€‚</p>","comments":[{"had_liked":false,"id":264832,"user_name":"ä¸Šé‚ªå¿˜å·","can_delete":false,"product_type":"c1","uid":1276588,"ip_address":"","ucode":"1C4459917B038D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIz9dKN1C8rKQoaVtmEGdzObhlia6zAfTsPYOm4ibz39VjTbu7Aia1LyeedHR26b6nxUtcCufpichcYgw/132","comment_is_top":false,"comment_ctime":1606664293,"is_pvip":false,"replies":[{"id":"96237","content":"èµï¼","user_name":"ä½œè€…å›å¤","comment_id":264832,"uid":"2070138","ip_address":"","utype":1,"ctime":1606749276,"user_name_real":"CY"}],"discussion_count":3,"race_medal":0,"score":"87506010213","product_id":100063801,"comment_content":"éšä¾¿å†™äº†ä¸€ä¸ªï¼Œæ¯”è¾ƒç²—ç³™<br>#!&#47;bin&#47;bash<br>cpuinfo1=$(cat &#47;sys&#47;fs&#47;cgroup&#47;cpu,cpuacct&#47;cpuacct.stat)<br>utime1=$(echo $cpuinfo1|awk &#39;{print $2}&#39;)<br>stime1=$(echo $cpuinfo1|awk &#39;{print $4}&#39;)<br>sleep 1<br>cpuinfo2=$(cat &#47;sys&#47;fs&#47;cgroup&#47;cpu,cpuacct&#47;cpuacct.stat)<br>utime2=$(echo $cpuinfo2|awk &#39;{print $2}&#39;)<br>stime2=$(echo $cpuinfo2|awk &#39;{print $4}&#39;)<br>cpus=$((utime2+stime2-utime1-stime1))<br>echo &quot;${cpus}%&quot;<br>","like_count":20,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510701,"discussion_content":"èµï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606749276,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1029376,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b5/00/4093f39a.jpg","nickname":"æ¨èµ›","note":"","ucode":"E26AF8930F78E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351321,"discussion_content":"è¿™ä¸æ˜¯æ‰€æœ‰å®¹å™¨çš„å—, æ€ä¹ˆå¾—åˆ°å•ä¸ªå®¹å™¨çš„?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614242922,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1207457,"avatar":"https://static001.geekbang.org/account/avatar/00/12/6c/a1/80d83f0a.jpg","nickname":"Ellison","note":"","ucode":"A2FB94D4F6A332","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1029376,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b5/00/4093f39a.jpg","nickname":"æ¨èµ›","note":"","ucode":"E26AF8930F78E6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539144,"discussion_content":"åœ¨å®¹å™¨å†…æ‰§è¡Œä»–ï¼Œcgroupså·²ç»é™åˆ¶äº†ï¼Œ æ‰€ä»¥å®¹å™¨å†…çš„è¿™ä¸ªæ–‡ä»¶æ˜¯é’ˆå¯¹å•ä¸ªnamespace cpuè®¡ç®—çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639621932,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":351321,"ip_address":""},"score":539144,"extra":""}]}]},{"had_liked":false,"id":264366,"user_name":"Geek2014","can_delete":false,"product_type":"c1","uid":2028957,"ip_address":"","ucode":"9EB356D8DF287E","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f5/9d/104bb8ea.jpg","comment_is_top":false,"comment_ctime":1606447449,"is_pvip":false,"replies":[{"id":"95891","content":"å¾ˆé«˜å…´ï¼Œè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ã€‚<br><br>https:&#47;&#47;github.com&#47;lxc&#47;lxcfsï¼Œ lxcfså¯ä»¥ä¸ºæ¯ä¸ªå®¹å™¨è™šæ‹Ÿä¸€äº›&#47;procä¸‹çš„æ–‡ä»¶ï¼Œæ¯”å¦‚&#47;proc&#47;stat","user_name":"ä½œè€…å›å¤","comment_id":264366,"uid":"2070138","ip_address":"","utype":1,"ctime":1606480942,"user_name_real":"CY"}],"discussion_count":1,"race_medal":0,"score":"74620891481","product_id":100063801,"comment_content":"å¤šè°¢è€å¸ˆçš„åˆ†äº«ï¼Œä¹‹å‰æƒ³å»ææ˜ç™½è¿›ç¨‹CPUæ—¶é—´çš„è®¡ç®—ï¼Œä¸€ç›´æ²¡æœ‰å»èŠ±æ—¶é—´ç ”ç©¶ï¼Œä»Šå¤©ç»ˆäºé€å½»åœ°æ˜ç™½äº†ã€‚<br><br>æˆ‘æœ‰ä¸ªé—®é¢˜ä¸å¤ªæ˜ç™½ï¼Œæƒ³è¯·æ•™ä¸‹ï¼Œå®¹å™¨è¿è¡Œæ—¶æ¯”å¦‚dockerï¼Œåœ¨åšå®¹å™¨åŒ–çš„æ—¶å€™ï¼Œæœ‰æ²¡æœ‰åŠæ³•æ„é€ å‡ºä¸€ä¸ªå’Œç‰©ç†æœºä¸€æ ·çš„procæ–‡ä»¶ç³»ç»Ÿå‘¢ï¼Ÿè¿™æ ·çš„è¯ï¼Œå®¹å™¨ç¯å¢ƒå’Œè™šæ‹Ÿæœºä¹Ÿæ²¡å•¥å·®åˆ«äº†ï¼Œç‰©ç†æœºä¸Šçš„åº”ç”¨ä¹Ÿå¯ä»¥æ— éšœç¢è¿è¡Œåœ¨å®¹å™¨ç¯å¢ƒä¸­ã€‚","like_count":17,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510541,"discussion_content":"å¾ˆé«˜å…´ï¼Œè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ã€‚\n\nhttps://github.com/lxc/lxcfsï¼Œ lxcfså¯ä»¥ä¸ºæ¯ä¸ªå®¹å™¨è™šæ‹Ÿä¸€äº›/procä¸‹çš„æ–‡ä»¶ï¼Œæ¯”å¦‚/proc/stat","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606480942,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":264362,"user_name":"ä¸œæ–¹å¥‡éª¥","can_delete":false,"product_type":"c1","uid":1354850,"ip_address":"","ucode":"DEE7085F7E55A4","user_header":"https://static001.geekbang.org/account/avatar/00/14/ac/62/37912d51.jpg","comment_is_top":false,"comment_ctime":1606446809,"is_pvip":true,"replies":[{"id":"95879","content":"USER_HZ, å¯ä»¥ç”¨å‘½ä»¤ &quot;getconf CLK_TCK&quot;æ‹¿","user_name":"ä½œè€…å›å¤","comment_id":264362,"uid":"2070138","ip_address":"","utype":1,"ctime":1606479471,"user_name_real":"CY"}],"discussion_count":1,"race_medal":0,"score":"66030956249","product_id":100063801,"comment_content":"è€å¸ˆï¼Œticks 1sä¸­æ˜¯100æ¬¡ï¼Œè¿™ä¸ªæ€ä¹ˆæŸ¥å‘¢ï¼Ÿ","like_count":15,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510538,"discussion_content":"USER_HZ, å¯ä»¥ç”¨å‘½ä»¤ &amp;quot;getconf CLK_TCK&amp;quot;æ‹¿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606479471,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":264392,"user_name":"è’‹æ‚¦","can_delete":false,"product_type":"c1","uid":1490858,"ip_address":"","ucode":"E4DA0A5CE91F02","user_header":"https://static001.geekbang.org/account/avatar/00/16/bf/aa/32a6449c.jpg","comment_is_top":false,"comment_ctime":1606454362,"is_pvip":false,"replies":[{"id":"95892","content":"@è’‹æ‚¦<br>&gt; å®¹å™¨çš„cpuä½¿ç”¨å°±å¿…é¡»è¦åœ¨å®¹å™¨å†…è¿›è¡Œï¼Œä»å®¿ä¸»æœºæ˜¯æ— æ³•è®¡ç®—çš„ï¼Œæ˜¯è¿™æ ·å—?<br><br>ä¸æ˜¯è¿™æ ·çš„ï¼Œä»å®¿ä¸»æœºä¹Ÿå¯ä»¥å¾—åˆ°å®¹å™¨å¯¹åº”çš„CPU Cgroupé‡Œçš„å€¼ã€‚ ","user_name":"ä½œè€…å›å¤","comment_id":264392,"uid":"2070138","ip_address":"","utype":1,"ctime":1606481275,"user_name_real":"CY"}],"discussion_count":1,"race_medal":0,"score":"31671225434","product_id":100063801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œ<br>æˆ‘æœ‰ä¸€ä¸ªé—®é¢˜ã€‚æ ¹æ®æˆ‘çš„ç†è§£ï¼Œå®¹å™¨çš„cpuä½¿ç”¨å°±å¿…é¡»è¦åœ¨å®¹å™¨å†…è¿›è¡Œï¼Œä»å®¿ä¸»æœºæ˜¯æ— æ³•è®¡ç®—çš„ï¼Œæ˜¯è¿™æ ·å—ï¼Ÿå¦‚æœæ˜¯çš„ï¼Œé‚£ä¹ˆï¼Œè¿™ä¸ªç›‘æ§cpuçš„ä»£ç å°±éœ€è¦ä¾µå…¥ç¨‹åºä»£ç (å®¹å™¨ä¸­è·‘çš„ä¸šåŠ¡ä»£ç )ï¼Œè¿™ä¼šä¸ä¼šæœ‰äº›æ— å¥ˆå•Šï¼Ÿå¦å¤–ï¼Œè¿™ä¸ªä¾µå…¥çš„ä»£ç ï¼Œæ‰€åœ¨çš„çº¿ç¨‹å¦‚æœä¸èƒ½è¢«å®æ—¶è°ƒåº¦ï¼Œåˆ™ç¬æ—¶é€Ÿåº¦å°±ç®—çš„ä¸å‡†ç¡®äº†å§ï¼Ÿ<br><br>æœ›è§£ç­”ã€‚","like_count":7,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510552,"discussion_content":"@è’‹æ‚¦\n&amp;gt; å®¹å™¨çš„cpuä½¿ç”¨å°±å¿…é¡»è¦åœ¨å®¹å™¨å†…è¿›è¡Œï¼Œä»å®¿ä¸»æœºæ˜¯æ— æ³•è®¡ç®—çš„ï¼Œæ˜¯è¿™æ ·å—?\n\nä¸æ˜¯è¿™æ ·çš„ï¼Œä»å®¿ä¸»æœºä¹Ÿå¯ä»¥å¾—åˆ°å®¹å™¨å¯¹åº”çš„CPU Cgroupé‡Œçš„å€¼ã€‚ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606481275,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":265326,"user_name":"äº‰å…‰ Alan","can_delete":false,"product_type":"c1","uid":1336328,"ip_address":"","ucode":"338534F909AF03","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/08/0287f41f.jpg","comment_is_top":false,"comment_ctime":1606869768,"is_pvip":false,"replies":[{"id":"96505","content":"@äº‰å…‰ Alan<br>ä½ æ˜¯æŒ‡ cpu&#47;memory ä½¿ç”¨ç‡åœ¨åˆ†åˆ«åœ¨docker stats å’Œcadvisoré‡Œæ˜¯ä¸ä¸€æ ·çš„ï¼Ÿ<br>æˆ‘ä»¬ç”¨cadvisor, çœ‹åˆ°çš„ç»“æœå¤§è‡´å’Œcgroupå·®ä¸å¤šï¼Œdocker statsä¹Ÿæ˜¯é€šè¿‡cgroupè®¡ç®—çš„ã€‚<br>ä½ çœ‹åˆ°çš„å·®å¼‚æœ‰å¤šå¤§ï¼Ÿæˆ–è€…ä½ çœ‹åˆ°çš„ç»“æœï¼Œå’Œä½ è‡ªå·±é€šè¿‡cgroupé‡Œçš„å€¼è®¡ç®—æ¯”è¾ƒä¸€ä¸‹ï¼Œå“ªä¸ªæ›´åŠ æ¥è¿‘ä¸€äº›ï¼Ÿ","user_name":"ä½œè€…å›å¤","comment_id":265326,"uid":"2070138","ip_address":"","utype":1,"ctime":1606916847,"user_name_real":"CY"}],"discussion_count":3,"race_medal":0,"score":"18786738952","product_id":100063801,"comment_content":"è€å¸ˆï¼Œéå¸¸æ„Ÿè°¢ï¼Œä¹‹å‰éƒ½æ˜¯æ¨¡ç³ŠçŸ¥é“å¤§æ¦‚è¿™ä¸ªæ„æ€ï¼Œè¿™æ¬¡æ˜ç™½äº†<br><br>å¦å¤–æœ‰ä¸ªé—®é¢˜ï¼š<br>æˆ‘å½“ç„¶åšç›‘æ§çš„æ—¶å€™å‘ç°docker stats å’Œcadvisor(æˆ–é€šè¿‡cgroupç›´æ¥è®¡ç®—)é€šè¿‡cgroupæ‹¿åˆ°çš„cpuä½¿ç”¨ç‡ï¼Œå†…å­˜ä½¿ç”¨ç‡éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‚¨è¿™è¾¹çŸ¥é“æ ¹æœ¬çš„åŸå› å—ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510879,"discussion_content":"@äº‰å…‰ Alan\nä½ æ˜¯æŒ‡ cpu/memory ä½¿ç”¨ç‡åœ¨åˆ†åˆ«åœ¨docker stats å’Œcadvisoré‡Œæ˜¯ä¸ä¸€æ ·çš„ï¼Ÿ\næˆ‘ä»¬ç”¨cadvisor, çœ‹åˆ°çš„ç»“æœå¤§è‡´å’Œcgroupå·®ä¸å¤šï¼Œdocker statsä¹Ÿæ˜¯é€šè¿‡cgroupè®¡ç®—çš„ã€‚\nä½ çœ‹åˆ°çš„å·®å¼‚æœ‰å¤šå¤§ï¼Ÿæˆ–è€…ä½ çœ‹åˆ°çš„ç»“æœï¼Œå’Œä½ è‡ªå·±é€šè¿‡cgroupé‡Œçš„å€¼è®¡ç®—æ¯”è¾ƒä¸€ä¸‹ï¼Œå“ªä¸ªæ›´åŠ æ¥è¿‘ä¸€äº›ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606916847,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1160951,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b6/f7/3c3b1385.jpg","nickname":"æµ·èƒ†é˜¶æ®µ","note":"","ucode":"7A8C4BB4D0CDB8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544784,"discussion_content":"for docker stat, take a closer look at its description:\nhttps://docs.docker.com/engine/reference/commandline/stats/","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641712679,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1336328,"avatar":"https://static001.geekbang.org/account/avatar/00/14/64/08/0287f41f.jpg","nickname":"äº‰å…‰ Alan","note":"","ucode":"338534F909AF03","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333139,"discussion_content":"cadvisorå’Œcgroupæ›´æ¥è¿‘ï¼Œdocker statä¸çŸ¥é“æ€ä¹ˆç»Ÿè®¡å‡ºæ¥çš„ğŸ˜‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607440051,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":267978,"user_name":"æ°´è’¸è›‹","can_delete":false,"product_type":"c1","uid":1809160,"ip_address":"","ucode":"6F7F853A4BF901","user_header":"https://static001.geekbang.org/account/avatar/00/1b/9b/08/27ac7ecd.jpg","comment_is_top":false,"comment_ctime":1608016445,"is_pvip":false,"replies":[{"id":"97461","content":"è¿™ä¸¤ä¸ªç›®å½•æ˜¯ä¸€æ ·çš„ï¼Œ<br>lrwxrwxrwx 1 root root 11 Dec 14 23:51 cpu -&gt; cpu,cpuacct<br>lrwxrwxrwx 1 root root 11 Dec 14 23:51 cpuacct -&gt; cpu,cpuacct<br>dr-xr-xr-x 5 root root  0 Dec 14 23:51 cpu,cpuacct","user_name":"ä½œè€…å›å¤","comment_id":267978,"uid":"2070138","ip_address":"","utype":1,"ctime":1608216487,"user_name_real":"CY"}],"discussion_count":1,"race_medal":0,"score":"10197951037","product_id":100063801,"comment_content":"è€å¸ˆï¼Œ&#47;sys&#47;fs&#47;cgroup&#47;cpu å’Œ cpuaccï¼Œè¿™2ä¸ªæœ‰ä»€ä¹ˆåŒºåˆ«<br>è¿˜æœ‰è¿™ä¸ªè·å–å®¹å™¨ä¸­æ˜¯è·å–å®¹å™¨çš„CPUä½¿ç”¨ï¼Œå®¿ä¸»æœºæ˜¯è·å–å®¿ä¸»æœºçš„CPUä½¿ç”¨å—","like_count":2,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511806,"discussion_content":"è¿™ä¸¤ä¸ªç›®å½•æ˜¯ä¸€æ ·çš„ï¼Œ\nlrwxrwxrwx 1 root root 11 Dec 14 23:51 cpu -&amp;gt; cpu,cpuacct\nlrwxrwxrwx 1 root root 11 Dec 14 23:51 cpuacct -&amp;gt; cpu,cpuacct\ndr-xr-xr-x 5 root root  0 Dec 14 23:51 cpu,cpuacct","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608216487,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":305608,"user_name":"è·¯ä¸€ç›´åœ¨","can_delete":false,"product_type":"c1","uid":1609567,"ip_address":"","ucode":"42697A3460BD33","user_header":"https://static001.geekbang.org/account/avatar/00/18/8f/5f/11ba01f2.jpg","comment_is_top":false,"comment_ctime":1628068996,"is_pvip":false,"replies":[{"id":"110967","content":"å…¶ä»–çš„cpu usage, å¦‚io&#47;hi&#47;siç­‰æ›´å¤šçš„æ˜¯ä»å®¿ä¸»æœºè§’åº¦ç»Ÿè®¡çš„ï¼Œä¹Ÿä¸èƒ½çŸ¥é“è¿™äº›å¼€é”€æ˜¯å±äºå“ªä¸ªè¿›ç¨‹çš„ï¼Œä¹Ÿå°±å¾ˆéš¾æ”¾åˆ°æ¯ä¸€ä¸ªcgroupé‡Œã€‚","user_name":"ä½œè€…å›å¤","comment_id":305608,"uid":"2070138","ip_address":"","utype":1,"ctime":1628599383,"user_name_real":"CY"}],"discussion_count":2,"race_medal":0,"score":"5923036292","product_id":100063801,"comment_content":"è€å¸ˆï¼Œå¦‚æœè®¡ç®—å®¹å™¨æ•´ä½“çš„cpuä½¿ç”¨ç‡ï¼Œä½¿ç”¨cpuacct.statæ˜¯å¦å®Œæ•´ï¼Œå› ä¸ºcpuacct.statä¸­åªæœ‰uså’Œsysçš„ticksï¼Œå…¶ä»–çš„ç±»ä¼¼iowaitã€idleç­‰çš„ticksä¸ç”¨è®¡ç®—å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524448,"discussion_content":"å…¶ä»–çš„cpu usage, å¦‚io/hi/siç­‰æ›´å¤šçš„æ˜¯ä»å®¿ä¸»æœºè§’åº¦ç»Ÿè®¡çš„ï¼Œä¹Ÿä¸èƒ½çŸ¥é“è¿™äº›å¼€é”€æ˜¯å±äºå“ªä¸ªè¿›ç¨‹çš„ï¼Œä¹Ÿå°±å¾ˆéš¾æ”¾åˆ°æ¯ä¸€ä¸ªcgroupé‡Œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628599383,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1609567,"avatar":"https://static001.geekbang.org/account/avatar/00/18/8f/5f/11ba01f2.jpg","nickname":"è·¯ä¸€ç›´åœ¨","note":"","ucode":"42697A3460BD33","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391948,"discussion_content":"è°¢è°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630726981,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":285465,"user_name":"ç¬ƒå®š","can_delete":false,"product_type":"c1","uid":1316173,"ip_address":"","ucode":"92E06FA13CC046","user_header":"https://static001.geekbang.org/account/avatar/00/14/15/4d/bbfda6b7.jpg","comment_is_top":false,"comment_ctime":1616828733,"is_pvip":false,"replies":[{"id":"104454","content":"cAdvisorå°±æ˜¯é€šè¿‡è¯»å–sys cgroup æˆ–è€… &#47;procä¸‹çš„çŠ¶æ€ä¿¡æ¯æ¥å¾—åˆ°container cpu&#47;mem&#47;net&#47;io metricsçš„ã€‚<br>ä¸€èˆ¬ä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„containeræ•°é‡æ˜¯å°äº1000çš„ï¼Œmetricsè·å–çš„å‘¨æœŸåœ¨10s çš„æƒ…å†µä¸‹ï¼Œ è¿™ä¸ªèµ„æºæ¶ˆè€—ä¸ä¼šå¾ˆå¤§ã€‚","user_name":"ä½œè€…å›å¤","comment_id":285465,"uid":"2070138","ip_address":"","utype":1,"ctime":1618063990,"user_name_real":"CY"}],"discussion_count":1,"race_medal":0,"score":"5911796029","product_id":100063801,"comment_content":"è€å¸ˆé—®ä¸€ä¸‹ï¼ŒåƒPrometheusæˆ–è€…k8sè‡ªå·±çš„metrics serverè·å–åˆ°çš„podå„ä¸ªèµ„æºä½¿ç”¨ç‡(cpu men net io)ä¹Ÿæ˜¯è¿™æ ·é€šè¿‡æŸ¥çœ‹è¿›ç¨‹&#47;procæ¥è®¡ç®—å¾—å‡ºçš„å—ï¼Ÿå¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼ŒæŒ‡æ ‡æ•°æ®å¤ªå¤šï¼Œè¿ç®—å¤ªå¤§ä¼šä¸ä¼šä¹Ÿä¼šæ¶ˆè€—èŠ‚ç‚¹èµ„æºå‘¢","like_count":1,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517683,"discussion_content":"cAdvisorå°±æ˜¯é€šè¿‡è¯»å–sys cgroup æˆ–è€… /procä¸‹çš„çŠ¶æ€ä¿¡æ¯æ¥å¾—åˆ°container cpu/mem/net/io metricsçš„ã€‚\nä¸€èˆ¬ä¸€ä¸ªèŠ‚ç‚¹ä¸Šçš„containeræ•°é‡æ˜¯å°äº1000çš„ï¼Œmetricsè·å–çš„å‘¨æœŸåœ¨10s çš„æƒ…å†µä¸‹ï¼Œ è¿™ä¸ªèµ„æºæ¶ˆè€—ä¸ä¼šå¾ˆå¤§ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1618063990,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":272849,"user_name":"JZ","can_delete":false,"product_type":"c1","uid":2333241,"ip_address":"","ucode":"406D8A32536044","user_header":"https://static001.geekbang.org/account/avatar/00/23/9a/39/a762e79d.jpg","comment_is_top":false,"comment_ctime":1610332404,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"5905299700","product_id":100063801,"comment_content":"è€å¸ˆï¼Œè·å–cpuçš„å¼€é”€å¯ä»¥ä½¿ç”¨kubectl topè¿™ä¸ªå·¥å…·å§ï¼Œè¿™ä¸ªæ‹¿åˆ°çš„å€¼å’Œæ–‡ç« ä¸­å…¬å¼è®¡ç®—çš„åº”è¯¥æ˜¯ä¸€è‡´çš„å§","like_count":1,"discussions":[{"author":{"id":2659191,"avatar":"","nickname":"Geek_1a3949","note":"","ucode":"98113FDBBAAEBC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588543,"discussion_content":"éœ€è¦å®‰è£…metrics-server","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663822717,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2621412,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ff/e4/927547a9.jpg","nickname":"æ— åæ— å§“","note":"","ucode":"487BD5AA2CD305","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":566873,"discussion_content":"åº”è¯¥æ‹¿ä¸åˆ°æŠŠ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650786182,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1160951,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b6/f7/3c3b1385.jpg","nickname":"æµ·èƒ†é˜¶æ®µ","note":"","ucode":"7A8C4BB4D0CDB8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544785,"discussion_content":"kubectl top does not show usage percentage","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641712714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":265285,"user_name":"GCC?","can_delete":false,"product_type":"c1","uid":1747388,"ip_address":"","ucode":"D6EF58F8D595FB","user_header":"https://static001.geekbang.org/account/avatar/00/1a/a9/bc/d3e25886.jpg","comment_is_top":false,"comment_ctime":1606838948,"is_pvip":false,"replies":[{"id":"96506","content":"æ˜¯çš„ã€‚","user_name":"ä½œè€…å›å¤","comment_id":265285,"uid":"2070138","ip_address":"","utype":1,"ctime":1606916960,"user_name_real":"CY"}],"discussion_count":2,"race_medal":0,"score":"5901806244","product_id":100063801,"comment_content":"è€å¸ˆï¼Œåœ¨k8sé›†ç¾¤ä¸­ï¼Œä½¿ç”¨metricsæŸ¥çœ‹åˆ°æ•´ä¸ªpodçš„èµ„æºç”¨é‡ï¼Œè¿™ä¸ªç²’åº¦å·²ç»å¤Ÿäº†å§ï¼Ÿæˆ‘çš„ç†è§£æ˜¯å¦‚æœpodå†…ä¸æ˜¯å•ä¸€å®¹å™¨ï¼Œæˆ–è€…å®¹å™¨å†…æœ‰å¤šä¸ªè¿›ç¨‹ï¼Œè¿™ä¸ªæ—¶å€™æ‰åº”è¯¥è€ƒè™‘è¿›ç¨‹çº§çš„cpuç”¨é‡ã€‚","like_count":1,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510862,"discussion_content":"æ˜¯çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606916960,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1747388,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/a9/bc/d3e25886.jpg","nickname":"GCC?","note":"","ucode":"D6EF58F8D595FB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":331589,"discussion_content":"æˆ‘å‘ç°dockeræ˜¯æœ‰apièƒ½å¤ŸæŸ¥çœ‹å®¹å™¨çš„cpuçš„ï¼Œè¿˜å¯ä»¥åˆ°è¿›ç¨‹çš„ç²’åº¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606907887,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361228,"user_name":"janey","can_delete":false,"product_type":"c1","uid":1619748,"ip_address":"ä¸­å›½é¦™æ¸¯","ucode":"B2160B363F23EB","user_header":"https://static001.geekbang.org/account/avatar/00/18/b7/24/17f6c240.jpg","comment_is_top":false,"comment_ctime":1667352075,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1667352075","product_id":100063801,"comment_content":"æ„Ÿè§‰è¿™ç§è®¡ç®—æ–¹æ³•ä¸æ˜¯å¾ˆç®€ä¾¿ï¼ŒèŠ‚ç‚¹ä¸Šå®¹å™¨å¤šçš„è¯ï¼Œä¸å¥½åˆ¤æ–­æ˜¯å“ªä¸ªå®¹å™¨æ¶ˆè€—CPUæœ€å¤šå§","like_count":0},{"had_liked":false,"id":316108,"user_name":"heyhd9475","can_delete":false,"product_type":"c1","uid":2682873,"ip_address":"","ucode":"3CDB4DC5BF0FEB","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eq30mvo0eATZ3Yfm5POktwic3NJSRkiagtJt1vaxyvCS22PJRm8xrulXqaLJRWQWb6zNI4zL0G2QkCA/132","comment_is_top":false,"comment_ctime":1634140187,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1634140187","product_id":100063801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæˆ‘æƒ³è¯·é—®ä»¥ä¸‹docker statsæ˜¾ç¤ºçš„cpu%ä¾æ—§æ˜¯ä¸æ­£ç¡®çš„å—ï¼Œå¦‚æœæ˜¯æ–‡ä¸­çš„ç»Ÿè®¡æ–¹æ³•æ ¹æ®æˆ‘çš„æµ‹è¯•æ˜¯ä¸æ­£ç¡®çš„ã€‚","like_count":0},{"had_liked":false,"id":303631,"user_name":"æå…µ","can_delete":false,"product_type":"c1","uid":2129632,"ip_address":"","ucode":"291243E3AB889F","user_header":"https://static001.geekbang.org/account/avatar/00/20/7e/e0/ff046b55.jpg","comment_is_top":false,"comment_ctime":1626886123,"is_pvip":false,"replies":[{"id":"111074","content":"å¦‚æœæ˜¯å•çº¯çš„é«˜è®¡ç®—çš„è¿›ç¨‹ï¼ŒçŠ¶æ€å¤šä¸ºR.","user_name":"ä½œè€…å›å¤","comment_id":303631,"uid":"2070138","ip_address":"","utype":1,"ctime":1628689308,"user_name_real":"CY"}],"discussion_count":1,"race_medal":0,"score":"1626886123","product_id":100063801,"comment_content":"è€å¸ˆï¼Œå¦‚å·²ç»æ˜¯é«˜è´Ÿè½½çš„æƒ…å†µä¸‹ã€‚åº”è¯¥ä¼šæœ‰å¾ˆå¤šæ­£å¸¸çš„è¿›ç¨‹è¢«å®‰æ’åœ¨Dè¿›ç¨‹ä¸­ï¼Œå¦‚ä½•åŒºåˆ†é€ æˆé«˜è´Ÿè½½çš„Dè¿›ç¨‹å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523766,"discussion_content":"å¦‚æœæ˜¯å•çº¯çš„é«˜è®¡ç®—çš„è¿›ç¨‹ï¼ŒçŠ¶æ€å¤šä¸ºR.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628689308,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":264721,"user_name":"closer","can_delete":false,"product_type":"c1","uid":1368990,"ip_address":"","ucode":"69F38480DF8491","user_header":"https://static001.geekbang.org/account/avatar/00/14/e3/9e/b26da70d.jpg","comment_is_top":false,"comment_ctime":1606614936,"is_pvip":false,"replies":[{"id":"96158","content":"&gt; é—®é¢˜1<br>nginx ä¼¼ä¹æœ‰è‡ªå·±çš„master process å’Œ client processesä¹‹é—´çš„socketè¿æ¥ã€‚å¦‚æœnginx masterä½œä¸ºå®¹å™¨é‡Œçš„pid 1, å½“å…³é—­å®¹å™¨çš„æ—¶å€™masteræ”¶åˆ°SIGTERM, è€Œå…¶ä»–çš„clientå­è¿›ç¨‹æ˜¯çœ‹åˆ°socketè¿æ¥æ–­å¼€ä¹‹åï¼Œä¸»åŠ¨é€€å‡ºçš„ã€‚<br><br>&gt; é—®é¢˜2<br>æ˜¯çš„ï¼Œ ç”¨cAdvisorå¯ä»¥ç»Ÿè®¡æ•´ä¸ªå®¹å™¨çš„cpu.","user_name":"ä½œè€…å›å¤","comment_id":264721,"uid":"2070138","ip_address":"","utype":1,"ctime":1606710361,"user_name_real":"CY"}],"discussion_count":1,"race_medal":0,"score":"1606614936","product_id":100063801,"comment_content":"é—®é¢˜1ï¼‰ç”Ÿäº§ä¸Šé¢ å¦‚æœæŠŠnginxæ”¾å…¥åˆ°podä¸­ï¼Œæ˜¯ä¸æ˜¯ä¼šç¢°åˆ°ç›®å‰ä¸ºæ­¢è€å¸ˆè¯´çš„é‚£äº›æ‰€æœ‰é—®é¢˜ æ¯”å¦‚å…³é—­å®¹å™¨sigtermä¸»è¿›ç¨‹nginx masterã€‚æ‰€æœ‰çš„nginx workeréƒ½è¢«sigkillã€‚<br>é—®é¢˜2ï¼‰ç„¶åå®¹å™¨é‡Œé¢çš„å„ä¸ªè¿›ç¨‹ç”¨çš„cpuæ€»åˆæ˜¯ä¼šè¢«k8s metricsè®¡ç®—åˆ°çš„å§ã€‚<br>è°¢è°¢ã€‚æœŸå¾…è€å¸ˆç™¾å¿™ä¸­å›å¤","like_count":0,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":510661,"discussion_content":"&amp;gt; é—®é¢˜1\nnginx ä¼¼ä¹æœ‰è‡ªå·±çš„master process å’Œ client processesä¹‹é—´çš„socketè¿æ¥ã€‚å¦‚æœnginx masterä½œä¸ºå®¹å™¨é‡Œçš„pid 1, å½“å…³é—­å®¹å™¨çš„æ—¶å€™masteræ”¶åˆ°SIGTERM, è€Œå…¶ä»–çš„clientå­è¿›ç¨‹æ˜¯çœ‹åˆ°socketè¿æ¥æ–­å¼€ä¹‹åï¼Œä¸»åŠ¨é€€å‡ºçš„ã€‚\n\n&amp;gt; é—®é¢˜2\næ˜¯çš„ï¼Œ ç”¨cAdvisorå¯ä»¥ç»Ÿè®¡æ•´ä¸ªå®¹å™¨çš„cpu.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606710361,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}