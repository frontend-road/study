{"id":99263,"title":"55 | 开源图片框架接触的架构和使用","content":"<p><strong>PDF 课件和源代码下载地址：</strong></p><p><a href=\"https://gitee.com/geektime-geekbang/geektime-ios-course\">https://gitee.com/geektime-geekbang/geektime-ios-course</a></p>","comments":[{"had_liked":false,"id":129946,"user_name":"弟弟","can_delete":false,"product_type":"c3","uid":1075685,"ip_address":"","ucode":"FD9B8DB376B1A3","user_header":"https://static001.geekbang.org/account/avatar/00/10/69/e5/b8bc8fc0.jpg","comment_is_top":false,"comment_ctime":1567333094,"is_pvip":false,"replies":[{"id":48656,"content":"是每次都是重新编译然后断点看的么？ 如果是重新编译了Memory就被清空了。试试在类似TableView滚动过程这个场景看下，默认没有特殊设置的话，SD是会优先取Memory，没有之后在取Disk的","user_name":"作者回复","user_name_real":"朱德权","uid":1041455,"ctime":1567465866,"ip_address":"","comment_id":129946,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"老师我按照您的代码运行后，cacheType的状态从SDImageCacheTypeNone到SDImageCacheTypeDisk之后就一直是Disk，没有显示过Memory，这样正常吗？","like_count":2,"discussions":[{"author":{"id":1041455,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJ3dLlYr6tznfnZXJNsD7Jw48BVnFSib3RO3VWEN0pgebRY1jaR8YXLQ6iaAjTsFiamOWSA3UPAa37A/132","nickname":"Geek_e7jq8k","note":"","ucode":"352964E5D793DA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465728,"discussion_content":"是每次都是重新编译然后断点看的么？ 如果是重新编译了Memory就被清空了。试试在类似TableView滚动过程这个场景看下，默认没有特殊设置的话，SD是会优先取Memory，没有之后在取Disk的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567465866,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108705,"user_name":"Masami","can_delete":false,"product_type":"c3","uid":1505981,"ip_address":"","ucode":"73E03F53335DBC","user_header":"https://static001.geekbang.org/account/avatar/00/16/fa/bd/7bf33188.jpg","comment_is_top":false,"comment_ctime":1561861122,"is_pvip":false,"replies":[{"id":41734,"content":"我看了下你的项目，目前项目中使用的SD是4.4.6 这个版本没有SDWebImage.h，执行下pod update 会更新到最新的5.0.6 就有这个头文件了。但是不管引入那个头文件其实都可以，尤其对于简单的使用，其实引入独立的头文件更为合适，减少不必要的代码。","user_name":"作者回复","user_name_real":"dequanzhu","uid":1041455,"ctime":1563291242,"ip_address":"","comment_id":108705,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"你好，我上传了。我是用的#import &quot;UIImageView+WebCache.h&quot;，老师你项目是直接导入SDWebImage.h，我没有找到这个文件。\n\nhttps:&#47;&#47;github.com&#47;JustFshun&#47;22.SampleApp-SDWebImage-","like_count":1,"discussions":[{"author":{"id":1041455,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJ3dLlYr6tznfnZXJNsD7Jw48BVnFSib3RO3VWEN0pgebRY1jaR8YXLQ6iaAjTsFiamOWSA3UPAa37A/132","nickname":"Geek_e7jq8k","note":"","ucode":"352964E5D793DA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456085,"discussion_content":"我看了下你的项目，目前项目中使用的SD是4.4.6 这个版本没有SDWebImage.h，执行下pod update 会更新到最新的5.0.6 就有这个头文件了。但是不管引入那个头文件其实都可以，尤其对于简单的使用，其实引入独立的头文件更为合适，减少不必要的代码。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563291242,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1529929,"avatar":"","nickname":"起风了001","note":"","ucode":"8DCDBA40B8CC9F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1803,"discussion_content":"你的代码可以正常编译的. 你是不是打开成xcodeproj了.要打开xcworkspace","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562918436,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":107879,"user_name":"Masami","can_delete":false,"product_type":"c3","uid":1505981,"ip_address":"","ucode":"73E03F53335DBC","user_header":"https://static001.geekbang.org/account/avatar/00/16/fa/bd/7bf33188.jpg","comment_is_top":false,"comment_ctime":1561628212,"is_pvip":false,"replies":[{"id":39047,"content":"能上传下代码发下URL么 我看下","user_name":"作者回复","user_name_real":"dequanzhu","uid":1041455,"ctime":1561634952,"ip_address":"","comment_id":107879,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"老师你好，请问我pod好SDWebImage框架后，没有发现SDWebImage.h文件。是框架版本原因吗？如何解决","like_count":1,"discussions":[{"author":{"id":1041455,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJ3dLlYr6tznfnZXJNsD7Jw48BVnFSib3RO3VWEN0pgebRY1jaR8YXLQ6iaAjTsFiamOWSA3UPAa37A/132","nickname":"Geek_e7jq8k","note":"","ucode":"352964E5D793DA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455723,"discussion_content":"能上传下代码发下URL么 我看下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561634952,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2132638,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ergjleMbtpL8qcTqBxShJ8oD6ibfdSuvu0XZtadpj9AB8JicAIkiaQC837NRmwXPQ689wxqPAHwcAMqw/132","nickname":"Geek_3ef812","note":"","ucode":"00339A90F9C117","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326077,"discussion_content":"使用import系统库的方式导入","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605514999,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":152642,"user_name":"Adam","can_delete":false,"product_type":"c3","uid":1505259,"ip_address":"","ucode":"EDEF335CA1FDC0","user_header":"","comment_is_top":false,"comment_ctime":1574055426,"is_pvip":false,"replies":[{"id":58688,"content":"clone成功了没？ 看下clone之后文件夹里有什么，是不是和git上的相同。同时要看下是否当前路径在clone之后的文件夹内，执行pwd看下当前路径。","user_name":"作者回复","user_name_real":"zzz","uid":1041455,"ctime":1574081304,"ip_address":"","comment_id":152642,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"在cd project 时，出现no such file or directory. 是什么问题？网上查好久没解决。","like_count":0,"discussions":[{"author":{"id":1041455,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJ3dLlYr6tznfnZXJNsD7Jw48BVnFSib3RO3VWEN0pgebRY1jaR8YXLQ6iaAjTsFiamOWSA3UPAa37A/132","nickname":"Geek_e7jq8k","note":"","ucode":"352964E5D793DA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474883,"discussion_content":"clone成功了没？ 看下clone之后文件夹里有什么，是不是和git上的相同。同时要看下是否当前路径在clone之后的文件夹内，执行pwd看下当前路径。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574081304,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":111019,"user_name":"Geek_jg3r26","can_delete":false,"product_type":"c3","uid":1454691,"ip_address":"","ucode":"7D093ED7273CBE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEK5icO2A4K7HYTYfQoagTz7VbtgxfS2ibBqLnKVWwQZgsePibZWFvFJEhPT8BtpQSaFx9IEodyp6c0dw/132","comment_is_top":false,"comment_ctime":1562423568,"is_pvip":false,"replies":[{"id":41463,"content":"cache的存储简单的来说是根据url作为key的，当然我们可以在这个key上自定义任何的字段。所以如果不进行特殊处理的话，url链接没换，如果命中了cache，图片是不会进行重新请求的。所以想要更新图片一般的简单办法就是更换图片url。","user_name":"作者回复","user_name_real":"dequanzhu","uid":1041455,"ctime":1563165212,"ip_address":"","comment_id":111019,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"老师，如果缓存到内存中， 第二次刷新到时候，假如这时候服务器有一张图片更换了， 但是服务器返回的链接没换， sdwebimage会去更新这张图片， 这块的逻辑有点没明白？它刷新的时候根据链接更换了去从新请求数据吗？","like_count":0,"discussions":[{"author":{"id":1041455,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJ3dLlYr6tznfnZXJNsD7Jw48BVnFSib3RO3VWEN0pgebRY1jaR8YXLQ6iaAjTsFiamOWSA3UPAa37A/132","nickname":"Geek_e7jq8k","note":"","ucode":"352964E5D793DA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457180,"discussion_content":"cache的存储简单的来说是根据url作为key的，当然我们可以在这个key上自定义任何的字段。所以如果不进行特殊处理的话，url链接没换，如果命中了cache，图片是不会进行重新请求的。所以想要更新图片一般的简单办法就是更换图片url。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563165212,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1529929,"avatar":"","nickname":"起风了001","note":"","ucode":"8DCDBA40B8CC9F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1801,"discussion_content":"这个逻辑是很简单的你别想太复杂, 本地只会根据图片url去做散列运算, 得到图片在缓存中的位置然后取出来. 如果后端修改了图片内容url没变的话, 客户端是不知道的. 实际开发中, 图片的url都是用一个随机生成名字的, 而且比较长, 一般修改了图片之后99.99%都会改了url. 所以不用担心图片是老的. 而对于其他固定url的图片, 比如logo这些, 有特殊要求的话, 你就每次都从网络取就可以了, 不然你就设置一个图片有效期也可以.","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1562917699,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108022,"user_name":"张蒙","can_delete":false,"product_type":"c3","uid":1035858,"ip_address":"","ucode":"CF8727F5DCFD55","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ce/52/4f1911b5.jpg","comment_is_top":false,"comment_ctime":1561648348,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"老师，支持你。作为多年开发，来回顾。也能学到很多思考，分析方法。","like_count":3},{"had_liked":false,"id":113217,"user_name":"起风了001","can_delete":false,"product_type":"c3","uid":1529929,"ip_address":"","ucode":"8DCDBA40B8CC9F","user_header":"","comment_is_top":false,"comment_ctime":1562918181,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"LRC缓存淘汰算法是一个比较常见的算法. 简单的可以用链表实现, 把最近用到的数据都插到链头, 容量到达阀值的时候删除链尾节点. 还可以结合散列表, 把最近使用过的缓存元素的指针放入散列表中, 加快访问缓存的速度.","like_count":1}]}