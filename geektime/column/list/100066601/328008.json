{"id":328008,"title":"09 | K近邻算法：机器学习入门必学算法","content":"<p>你好，我是海丰。</p><p>今天，我们正式进入算法的学习，来学习K 近邻算法（K-Nearest Neighbor），简称 KNN 算法。它是一种用来解决分类问题的算法，简单来说，就是用来预测用户是男是女，或者是否喜欢某件商品。<strong>分类算法有很多，只不过，不同算法的实现机制不同，我们今天要讲的 KNN 算法是基于距离计算的方式来解决分类问题的。</strong></p><p>下面，我就借助生活中常见的例子，给你讲清楚 KNN 算法的原理、优缺点，以及应用场景。</p><h2>如何理解 KNN 算法</h2><p>我们的生活中总是充斥着各种各样的小抉择，这些抉择虽然对我们的影响不大，但总会让我们有些苦恼。比如，手机买什么牌子、买什么型号？午饭吃什么？周末陪女朋友去哪儿玩？你每次遇到这类问题的时候，都会怎么解决呢？</p><p>先别着急回答，我们先来做一个小测试题。如果现在就让你给女朋友选礼物，你会怎么做？我希望你能在 5 秒内，从下面 3 个选项中选一个：</p><ol>\n<li>随便选一个就行了</li>\n<li>问问周围兄弟们都送了什么礼物</li>\n<li>做一份详细的报告，根据女朋友的情况量身定制礼物挑选方案</li>\n</ol><p>好了，我想你有很大可能会选择第2个选项。因为选1，就意味着你会承担更高的风险，选到一个非常不靠谱的礼物，还很有可能踩雷，而选3意味着你会花费大量的时间和成本去做准备，一般人估计也没有这么大的耐心。</p><!-- [[[read_end]]] --><p>事实上也是这样，如果你周围最好的几个朋友都送了女朋友口红，只有少数几个送了香水，那你选择送口红给女友更不容易踩雷，因此，你做出相似决定的概率也会更大。简而言之就是，你周围的环境将影响你的决定。</p><p>你选购礼物的逻辑其实就是 KNN 算法的实现思路了。通俗一点来说，<strong>KNN 的原理就是，对于一个犹豫不决的选择，我们先参考周围最近的一些已经做出的选择，然后再做出相似的决定</strong>，你也可以记成：“近朱者赤，近墨者黑”。</p><p>如果用数学去描述 KNN的原理，<strong>就是对于一个待测的样本点，我们去参考周围最近的已知样本点的分类，如果周围最近的 K 个样本点属于第一类，我们就可以把这个待测样本点归于第一类</strong>。</p><p>这个概念中提到了一个词“最近”，那我们该如何定义样本间距离的远近呢？通常来讲，我们会通过数学公式计算两个样本点之间的距离，最常见的一个计算方法就是欧式距离（Euclidean Space）。最后再做一个简单的统计，找到距离待测样本点最近的 K 个样本点中，哪些类别最多。当然除了欧式距离，还有很多距离计算的方式，如曼哈顿距离、余弦距离等等。</p><p>以上就是运用 KNN 进行分类决策的基本逻辑了。</p><h2>应用场景：预测候选人能不能拿到Offer</h2><p>知道了 KNN 算法的基本原理，接下来，我再通过一个预测候选者是否符合公司标准的例子，来说一说 KNN 算法的应用场景。</p><p>我之前参加过一个算法马拉松竞赛，这个竞赛的题目就是为公司的人事部门开发一套减少招聘成本的 AI 产品。它要求参赛者在已知公司历史<strong>候选者姓名、工作年限、每月收，以及最终是否拿到公司 Offer</strong> 的情况下，通过一个算法模型来预测一个新的候选者是否能通过公司的招聘考核，最终拿到 Offer。</p><p><img src=\"https://static001.geekbang.org/resource/image/97/c8/97e1cf3d04c70c39f5c0fe35876910c8.jpeg?wh=1920*1080\" alt=\"\"></p><p>上面左侧的图表图就是公司历史候选者的数据采样，我们将数据可视化制作出了二维平面图（如上图右）。其中，X 轴代表候选者的工作年限，Y 轴代表候选者目前的月收入，我们对拿到Offer的人用红色进行了标记，对没拿到的用蓝色进行了标记。</p><p>有了这些基础信息之后，我们接下来要解决的问题就是，怎么评估一个新候选者成功拿到 Offer 的概率。我们以上图中的千秋同学为例，他的薪资目前是 12.8 K，有 2.4 年的工作经验。</p><p>在对样本进行了评估之后，我们发现样本特征相对单一，并且数据量也不多，所以我们决定使用 KNN 算法来解决这个问题。具体的实现思路也很简单，就是给定一个人，再去寻找和他的相似度比较大的那些人，看看他们都是什么属性。</p><p>比如说，在这份数据中，我在千秋同学的附近，选出距离他最近的 3 个人，分别是潇然同学、斯南同学和莎佳同学。这三人中，潇然和斯南同学都拿到了 Offer，莎佳同学没拿到 Offer。这样一来，我们就可以直接预测出千秋同学是可以拿到 Offer 的，因为距离最近的三个人当中，拿到 Offer 的人数大于没有拿到 Offer 的人数，或者说“少数服从多数”。</p><p>当然，我知道你看到这个结论之后，肯定有非常多的疑问，别着急，听我接着说。首先，我为什么选择跟预测样本距离最近的 3 个样本呢 ？其实，这里的 3 就是 K 值（即，周围最近的 K 个样本点），你也可以选择 4 个或者 5 个或者其他的数字，但要注意的是 K 值的选取会影响到模型的预测效果。</p><p>当 K 取 1 的时候，就表示我们只评估与待测样本最近的一个样本的值是什么分类就行了，如距离千秋同学最近的是莎佳，她最终没有拿到 Offer ，所以，我们就可以预测千秋同学也拿不到 Offer。</p><p>当 K 取 9 的时候，就表示我们需要评估与样本集个数一样的样本点。可想而知，最终的结果就和整体的样本分布一样了，哪个分类的样本多，预测结果就是哪个分类，模型也就不起作用了。</p><p><strong>总的来说，当 K 越小的时候，模型就越容易过拟合，因为预测结果与最近一个样本点强相关。而 K 越大的时候，就越容易欠拟合，因为预测结果要考虑所有样本的情况，就相当于没有预测。所以，对于 K 的取值，一种有效的办法就是从 1 开始不断地尝试，并对比准确率，然后选取效果最好的那个 K 值。</strong></p><p>刚才这个例子，其实就是 KNN 一个最常见的应用场景：做分类。除此之外，KNN 还有一个比较常见的应用场景就是做推荐。</p><p>比如，在京东图书中，我们已知用户A和用户B的历史购买记录：用户 A 购买了《三体》《太空漫步》《流浪地球》；用户 B 购买了《原则》《影响力》《金字塔原理》。这个时候，如果京东图书要给一个购买了《三体》和《流浪地球》的新用户C进行图书推荐，它的推荐系统就可以通过计算出用户 C 和用户 A 的相似喜好，给用户 C 推荐其他的科幻小说。</p><p>到此，我们已经把 KNN 算法的原理和应用场景都讲完了，下面我们再来看看它的优缺点。</p><h2>KNN算法优缺点</h2><p>虽然产品经理不需要写代码，但只有掌握了算法的优缺点，我们才能更好地评估算法适不适合当前业务需求，并且落地业务场景能达到什么样的效果。</p><p><strong>我们先来说KNN算法的优点。</strong></p><p>KNN 算法最大的优点就是简单易懂，实现起来非常容易，简单到都不需要进行训练了，只要把样本数据整理好，就可以直接预测新数据了。</p><p><strong>除此之外，KNN 在处理边界不规则数据的分类问题时要比线性分类器的效果好。</strong> 线性分类器可以理解成画一条直线对数据进行分类，不规则的数据则很难找到一条线来分割开所有样本点数据。而KNN 的预测方式是以未知样本点作为中心点，然后画一个圈，使得圈里有 K 个数据，这就完全不用考虑数据的边界问题。</p><p>但是，KNN 的缺点也非常明显，首先是它只<strong>适合小数据集</strong>，因为 KNN 是基于距离的分类算法，如果数据量特别大的时候，就需要计算待测样本和每一个已有样本之间的距离，那样计算量是非常大的。对于大数据集，一般会选型 KNN 的优化算法，如 kd-tree 来实现。</p><p><strong>其次，KNN算法对数据容错性偏低。</strong>因为 KNN 对于数据样本的质量依赖度很高，如果训练数据集中存在错误的样本数据，并且又刚好在待测样本的旁边，这样就会直接导致预测的数据不准确。</p><p>也正是因为 KNN 对于数据样本的依赖度很高，如果数据分布不均衡，同样会影响 KNN 的预测效果。比如，有的类别数据量特别多，那么基于 KNN 的预测效果就会很差，因为特别多的数据就会占有绝对的投票优势。针对这种情况改进的方法就是，对待测样本周围 K 个近邻数据增加权重，距离越近，权重越大。</p><h2>总结</h2><p>KNN 算法是机器学习领域中的入门级算法，作为产品经理，我们要掌握它的核心原理、应用场景以及优缺点。</p><p>KNN 核心原理你可以理解为“近朱者赤近墨者黑”，即基于距离的一个简单分类算法。在数据量不多，特征都相对单一的业务场景下（如我们课程中的例子）很适合选择 KNN 算法。因为构建起来不复杂，所以当团队中缺少算法同学的情况下，产品经理就可以提出建设性的建议，根据场景特点来选型 KNN 算法。这样，工程研发同学也可以通过学习完成算法的实现，最终实现业务需求。</p><p>KNN 的优点很明显，简单易实现，可以快速解决多分类问题，并且相对于线性分类算法用一条直线来分割数据的方式来说，KNN 对于边界不规则的数据预测效果会更好。</p><p>对于KNN 缺点，你要记住，KNN 对于数据的容错性很低。比如，当待测样本周围的 K 个数据样本中存在错误样本的时候，就会对预测结果有很大的影响。</p><p>另外，KNN 一般适用于样本数较少的数据集。因为它在处理数据量比较大的样本时会非常耗时，所以，在实际工业中，我们一般会选用 Kd-tree 来进行预测。</p><h2>课后讨论</h2><p>在你现有的业务场景需求中，有适合应用 KNN 算法来实现的吗？</p><p>欢迎在留言区分享你的观点，如果你的朋友也正在学习KNN算法，不妨也把这节课转发给他，我们下节课见！</p>","comments":[{"had_liked":false,"id":278109,"user_name":"徐榕泽","can_delete":false,"product_type":"c1","uid":2425645,"ip_address":"","ucode":"12448253028BED","user_header":"https://static001.geekbang.org/account/avatar/00/25/03/2d/60c79361.jpg","comment_is_top":false,"comment_ctime":1612765460,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"31677536532","product_id":100066601,"comment_content":"老师，这个K值到底是如何计算出来的呢？文章里说一个一个试试，那试的标准是什么？","like_count":6,"discussions":[{"author":{"id":2787003,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/86/bb/9956e057.jpg","nickname":"有机体","note":"","ucode":"EA07F783DD7D56","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545028,"discussion_content":"以二维坐标轴举例，距离=根号下（x1-x2）^2+（y1-y2）^2","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641809027,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2791241,"avatar":"","nickname":"Geek7634","note":"","ucode":"AAF88DBA3CDE71","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":405738,"discussion_content":"一般是先取常用的K值，比如K=3、5、7、10...，根据训练效果再进一步调参吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634634025,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1283016,"avatar":"https://static001.geekbang.org/account/avatar/00/13/93/c8/69512653.jpg","nickname":"种菜的渔民","note":"","ucode":"E864ECDD60DBED","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380247,"discussion_content":"对 相当于最优解是哪个 不能评人工经验去判断吧\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624412337,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":272880,"user_name":"Geek_542a30","can_delete":false,"product_type":"c1","uid":2090257,"ip_address":"","ucode":"ECF7289E93DD69","user_header":"https://static001.geekbang.org/account/avatar/00/1f/e5/11/937f08ed.jpg","comment_is_top":false,"comment_ctime":1610344701,"is_pvip":false,"replies":[{"id":"99145","content":"谢谢，你是一个有想法的产品经理！","user_name":"作者回复","user_name_real":"刘海丰","uid":"1016907","ctime":1610670915,"ip_address":"","comment_id":272880,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23085181181","product_id":100066601,"comment_content":"KNN 核心原理你可以理解为“近朱者赤近墨者黑”，老师解释的很形象啊！我目前不打算深入了解具体算法原理，就是想大致了解一下，以后和模型工程师可以聊聊。您这个解释让我一下子能知道这个算法是什么，很赞！","like_count":5,"discussions":[{"author":{"id":1016907,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/84/4b/2ddce75f.jpg","nickname":"海风","note":"","ucode":"15589C4BA42740","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513418,"discussion_content":"谢谢，你是一个有想法的产品经理！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610670915,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":277109,"user_name":"AsyDong","can_delete":false,"product_type":"c1","uid":2369769,"ip_address":"","ucode":"FB4834CF8A3540","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKGNb0iaXNtliaO2UYrzn6j7DgoH4PC9UCQ1euV7xuI92GQ779IIBhI99GCDASBQ1C7RE7dz2nMPibLg/132","comment_is_top":false,"comment_ctime":1612260764,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10202195356","product_id":100066601,"comment_content":"电商平台里那种看过此商品的人还喜欢XXX这种场景是通过KNN算法推荐","like_count":2,"discussions":[{"author":{"id":2568118,"avatar":"","nickname":"Geek_52525e","note":"","ucode":"3F9202C8937B66","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368415,"discussion_content":"这个场景用到的数量级很大吧，不一定合适KNN？","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1618703214,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":283042,"user_name":"Rosa rugosa","can_delete":false,"product_type":"c1","uid":1480782,"ip_address":"","ucode":"A26068A69D7E9B","user_header":"https://static001.geekbang.org/account/avatar/00/16/98/4e/f42d27e8.jpg","comment_is_top":false,"comment_ctime":1615529654,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5910496950","product_id":100066601,"comment_content":"各种推荐场景如视频推荐，音乐推荐，商品推荐。","like_count":1},{"had_liked":false,"id":346142,"user_name":"Geek_531536","can_delete":false,"product_type":"c1","uid":2872948,"ip_address":"","ucode":"43DC4D651EE0AE","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJGHGcIwT7Lmz14C0sVG1pXjgP13Idhdia7sBFacSIh8r1mibhVHXyMGKDiaMvTS3NsbXOCUVty5WGJA/132","comment_is_top":false,"comment_ctime":1652855369,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652855369","product_id":100066601,"comment_content":"老师你好，“所以，对于 K 的取值，一种有效的办法就是从 1 开始不断地尝试，并对比准确率，然后选取效果最好的那个 K 值。”<br>请问这句是不是这样理解：这是个调参过程，是不是用已知的样本来计算，从而选取效果最好的那个K值，然后用这个K值预测未知样本的分类？<br>毕竟不知道未知样本是哪个分类，因而也不清楚它的分类是否正确。","like_count":1},{"had_liked":false,"id":341789,"user_name":"escray","can_delete":false,"product_type":"c1","uid":1020525,"ip_address":"","ucode":"1F4204930E47C4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","comment_is_top":false,"comment_ctime":1649833876,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1649833876","product_id":100066601,"comment_content":"K 近邻算法，如何定义“最近”，或者说是距离，可能是算法准确与否的关键。<br><br>虽然 KNN 相对比较简单，不过只要有效果，也没什么不可以。可能最终还是要看数据的情况，以及模型的检验结果。<br><br>对于 Kd-tree，二维或者三维的分割比较容易理解，但是更高维度的，就想象不出来了。<br><br>如果在高德地图上找最近的 ATM 机，使用的是 Kd-tree 或者 KNN 么？","like_count":0},{"had_liked":false,"id":330205,"user_name":"有机体","can_delete":false,"product_type":"c1","uid":2787003,"ip_address":"","ucode":"EA07F783DD7D56","user_header":"https://static001.geekbang.org/account/avatar/00/2a/86/bb/9956e057.jpg","comment_is_top":false,"comment_ctime":1641865945,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1641865945","product_id":100066601,"comment_content":"数据量 大 怎么界定","like_count":0},{"had_liked":false,"id":309119,"user_name":"俯瞰风景.","can_delete":false,"product_type":"c1","uid":1044166,"ip_address":"","ucode":"A6DB68B7B84AEE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ee/c6/bebcbcf0.jpg","comment_is_top":false,"comment_ctime":1629949136,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629949136","product_id":100066601,"comment_content":"KNN算法可以用于寻找认知边界，兴趣边界。通过研究学习兴趣相似的同学的学习内容，可以实现个性化的学习内容推荐。","like_count":0},{"had_liked":false,"id":301742,"user_name":"　","can_delete":false,"product_type":"c1","uid":1228485,"ip_address":"","ucode":"E84928BBB4ECF9","user_header":"https://static001.geekbang.org/account/avatar/00/12/be/c5/dd2e313f.jpg","comment_is_top":false,"comment_ctime":1625827708,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625827708","product_id":100066601,"comment_content":"网易云音乐的歌单推荐","like_count":0},{"had_liked":false,"id":291643,"user_name":"一鸣","can_delete":false,"product_type":"c1","uid":2573931,"ip_address":"","ucode":"A01D44A9A951F4","user_header":"https://static001.geekbang.org/account/avatar/00/27/46/6b/6c26c731.jpg","comment_is_top":false,"comment_ctime":1620397219,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1620397219","product_id":100066601,"comment_content":"“对于 K 的取值，一种有效的办法就是从 1 开始不断地尝试，并对比准确率，然后选取效果最好的那个 K 值。”<br><br>求问，和谁对比准确率呢？","like_count":0,"discussions":[{"author":{"id":1262373,"avatar":"https://static001.geekbang.org/account/avatar/00/13/43/25/71a0b899.jpg","nickname":"AnMin","note":"","ucode":"6FE29563F092C3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382172,"discussion_content":"当k等于1的时候，有一个准确率，当k等于2的时候，有一个准确率，以此比较，找到一个准确率最高的\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625458604,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":271415,"user_name":"大次狼","can_delete":false,"product_type":"c1","uid":1154660,"ip_address":"","ucode":"CE9EC8FCF47A7E","user_header":"https://static001.geekbang.org/account/avatar/00/11/9e/64/dd9328c5.jpg","comment_is_top":false,"comment_ctime":1609602050,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1609602050","product_id":100066601,"comment_content":"那个K我一直认为是最后需要分成多少类，优点是简单，缺点是很多业务场景下不能确认那个K到底是多少。","like_count":0,"discussions":[{"author":{"id":1756787,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/ce/73/551f7b09.jpg","nickname":"roger","note":"","ucode":"9D0D9336389926","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339351,"discussion_content":"你记差了，那是kmeans算法，是聚类算法","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1609643125,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}