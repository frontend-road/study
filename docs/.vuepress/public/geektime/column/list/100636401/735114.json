{"id":735114,"title":"05ï½œServeræ€§èƒ½æå‡ï¼šè®¾è®¡å¤šä¸ªProcessor","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯éƒ­å±¹ã€‚ä»Šå¤©æˆ‘ä»¬ç»§ç»­æ‰‹å†™MiniTomcatã€‚</p><p>å­¦å®Œå‰å‡ èŠ‚è¯¾çš„å†…å®¹ä¹‹åï¼Œç°åœ¨æˆ‘ä»¬å·²ç»åšåˆ°æ¥å£æ»¡è¶³Servletè§„èŒƒï¼Œè€Œä¸”åŠŸèƒ½æ¨¡å—æ‹†åˆ†æˆäº†Connectorå’ŒProcessorä¸¤éƒ¨åˆ†ï¼Œå®ƒä»¬å„å¸å…¶èŒï¼Œä¸€ä¸ªè´Ÿè´£ç½‘ç»œè¿æ¥ï¼Œä¸€ä¸ªè´Ÿè´£Servletè°ƒç”¨å¤„ç†ã€‚</p><p>ä½†ç°åœ¨è¿™ä¸ªServerçš„è¿è¡Œæ¨¡å¼æ˜¯ï¼Œä¸€ä¸ªConnectoræœåŠ¡äºä¸€ä¸ªProcessorï¼Œè€Œä¸”æ¯æ¬¡åˆ›å»ºProcessorçš„æ—¶å€™éƒ½æ˜¯é‡æ–°å®ä¾‹åŒ–ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼ŒProcessorè¿˜ä¸æ”¯æŒå¤šçº¿ç¨‹å¤„ç†ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨HttpServeræ€§èƒ½æ–¹é¢è¿˜æœ‰æå‡çš„ç©ºé—´ã€‚</p><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬è®¡åˆ’å¼•å…¥æ± çš„æ¦‚å¿µï¼Œå¢å¼ºProcessorçš„å¤ç”¨æ€§ï¼ŒåŒæ—¶å°†Processorå¼‚æ­¥åŒ–ï¼Œæ”¯æŒä¸€ä¸ªConnectoræœåŠ¡äºå¤šä¸ªProcessorã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/15/c6/1534805c6edf2fb2c2493d34792bbac6.png?wh=2212x944\" alt=\"\"></p><h2>é¡¹ç›®ç»“æ„</h2><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬åªé’ˆå¯¹åŸæœ‰çš„HttpConnectorå’ŒHttpProcessorç±»è¿›è¡Œæ”¹é€ ï¼Œæ‰€ä»¥é¡¹ç›®ç»“æ„å’Œmavenå¼•å…¥ä¾èµ–ä¿æŒä¸å˜ï¼Œè¿˜æ˜¯å»¶ç»­ä¸‹é¢çš„ç»“æ„å’Œé…ç½®ã€‚</p><pre><code class=\"language-plain\">MiniTomcat\nâ”œâ”€ src\nâ”‚  â”œâ”€ main\nâ”‚  â”‚  â”œâ”€ java\nâ”‚  â”‚  â”‚  â”œâ”€ server\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpConnector.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpProcessor.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpServer.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Request.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Response.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ ServletProcessor.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ StatisResourceProcessor.java\nâ”‚  â”‚  â”œâ”€ resources\nâ”‚  â”œâ”€ test\nâ”‚  â”‚  â”œâ”€ java\nâ”‚  â”‚  â”‚  â”œâ”€ test\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HelloServlet.java\nâ”‚  â”‚  â”œâ”€ resources\nâ”œâ”€ webroot\nâ”‚  â”œâ”€ test\nâ”‚  â”‚  â”œâ”€ HelloServlet.class\nâ”‚  â”œâ”€ hello.txt\nâ”œâ”€ pom.xml\n</code></pre><!-- [[[read_end]]] --><p>pom.xmlå‚è€ƒå¦‚ä¸‹ï¼š</p><pre><code class=\"language-xml\">&lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt;\n    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;\n    &lt;groupId&gt;day3&lt;/groupId&gt;\n    &lt;artifactId&gt;day3&lt;/artifactId&gt;\n    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;\n    &lt;dependencies&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;\n            &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;\n            &lt;version&gt;4.0.1&lt;/version&gt;\n        &lt;/dependency&gt;\n        &lt;dependency&gt;\n            &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;\n            &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt;\n            &lt;version&gt;3.4&lt;/version&gt;\n        &lt;/dependency&gt;\n    &lt;/dependencies&gt;\n&lt;/project&gt;  \n</code></pre><h2>æ± åŒ–æŠ€æœ¯å¼•å…¥</h2><p>ç°åœ¨æˆ‘ä»¬åœ¨HttpConnectoré‡Œè·å–åˆ°Socketåï¼Œæ¯æ¬¡éƒ½æ˜¯åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„HttpProcessorå¯¹è±¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-java\">socket = serverSocket.accept();\nHttpProcessor processor = new HttpProcessor();\nprocessor.process(socket);\n</code></pre><p>åœ¨å¹¶å‘è¯·æ±‚é€æ­¥å¢åŠ åï¼Œæ„é€ æ–°å¯¹è±¡ä¼šå¯¹æœåŠ¡å™¨çš„æ€§èƒ½é€ æˆè´Ÿæ‹…ï¼Œæ‰€ä»¥æˆ‘ä»¬æ‰“ç®—å¼•å…¥æ± ï¼ŒæŠŠå¯¹è±¡åˆå§‹åŒ–å¥½ä¹‹åï¼Œéœ€è¦ç”¨çš„æ—¶å€™å†æ‹¿å‡ºæ¥ä½¿ç”¨ï¼Œä¸éœ€è¦ä½¿ç”¨çš„æ—¶å€™å°±å†æ”¾å›æ± é‡Œï¼Œä¸ç”¨å†æ„é€ æ–°çš„å¯¹è±¡ã€‚</p><p>å› æ­¤ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å…ˆæ”¹é€ HttpConnectorç±»ï¼Œä½¿ç”¨ArrayDequeå­˜æ”¾æ„é€ å®Œæ¯•çš„HttpProcessorå¯¹è±¡ã€‚æ”¹é€ å¦‚ä¸‹ï¼š</p><pre><code class=\"language-java\">public class HttpConnector implements Runnable {\n    int minProcessors = 3;\n    int maxProcessors = 10;\n    int curProcessors = 0;\n    //å­˜æ”¾å¤šä¸ªprocessorçš„æ± å­\n    Deque&lt;HttpProcessor&gt; processors = new ArrayDeque&lt;&gt;();\n    public void run() {\n        ServerSocket serverSocket = null;\n        int port = 8080;\n        try {\n            serverSocket = new ServerSocket(port, 1, InetAddress.getByName(\"127.0.0.1\"));\n        } catch (IOException e) {\n            e.printStackTrace();\n            System.exit(1);\n        }\n        // initialize processors pool\n        for (int i = 0; i &lt; minProcessors; i++) {\n            HttpProcessor processor = new HttpProcessor();\n            processors.push(processor);\n        }\n        curProcessors = minProcessors;\n        while (true) {\n            Socket socket = null;\n            try {\n                socket = serverSocket.accept();\n                //å¾—åˆ°ä¸€ä¸ªæ–°çš„processorï¼Œè¿™ä¸ªprocessorä»æ± ä¸­è·å–(æ± ä¸­æœ‰å¯èƒ½æ–°å»º)\n                HttpProcessor processor = createProcessor();\n                if (processor == null) {\n                    socket.close();\n                    continue;\n                }\n                processor.process(socket); //å¤„ç†\n                processors.push(processor); //å¤„ç†å®Œæ¯•åæ”¾å›æ± å­\n                // Close the socket\n                socket.close();\n            } catch (Exception e) {\n                e.printStackTrace();\n            }\n        }\n    }\n    public void start() {\n        Thread thread = new Thread(this);\n        thread.start();\n    }\n    //ä»æ± å­ä¸­è·å–ä¸€ä¸ªprocessorï¼Œå¦‚æœæ± å­ä¸ºç©ºä¸”å°äºæœ€å¤§é™åˆ¶ï¼Œåˆ™æ–°å»ºä¸€ä¸ª\n    private HttpProcessor createProcessor() {\n        synchronized (processors) {\n            if (processors.size() &gt; 0) {\n                //è·å–ä¸€ä¸ª\n                return ((HttpProcessor) processors.pop());\n            }\n            if (curProcessors &lt; maxProcessors) {\n                //æ–°å»ºä¸€ä¸ª\n                return (newProcessor());\n            }\n            else {\n                return (null);\n            }\n        }\n    }\n    //æ–°å»ºä¸€ä¸ªprocessor\n    private HttpProcessor newProcessor() {\n        HttpProcessor initprocessor = new HttpProcessor();\n        processors.push(initprocessor);\n        curProcessors++;\n        return ((HttpProcessor) processors.pop());\n    }\n}\n</code></pre><p>ä»ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œrun()æ–¹æ³•ä¸­å…ˆè¿›è¡Œäº†processorsæ± çš„åˆå§‹åŒ–ï¼Œå°±æ˜¯å¾ªç¯åˆ›å»ºæ–°çš„HttpProcessorå¯¹è±¡åï¼Œpushåˆ°processorsè¿™ä¸ªArrayDequeé‡Œï¼Œprocessorsä½œä¸ºHttpProcessorå¯¹è±¡çš„å­˜å‚¨æ± ä½¿ç”¨ã€‚</p><p>ä¹‹åï¼Œæ¯æ¬¡æ¥æ”¶åˆ°ä¸€ä¸ªsocketï¼Œå°±ç”¨createProcessor()æ–¹æ³•è·å–åˆ°ä¸€ä¸ªprocessorã€‚çœ‹ä¸€ä¸‹createProcessor()æ–¹æ³•çš„ä»£ç ï¼Œå¯ä»¥å‘ç°å½“processorså†…å…ƒç´ ä¸ä¸ºç©ºçš„æ—¶å€™ï¼Œç›´æ¥ä»ArrayDequeå†…è·å–HttpProcessorå¯¹è±¡ï¼Œæ¯æ¬¡ä»æ± é‡Œè·å–ä¸€ä¸ªprocessorã€‚å¦‚æœæ± å­é‡Œæ²¡æœ‰processorï¼Œå°±æ–°åˆ›å»ºä¸€ä¸ªã€‚</p><p>æ— è®ºæ± å­é‡Œæœ‰æ²¡æœ‰ï¼Œæœ€åçš„ç»“æœéƒ½æ˜¯æ‹¿åˆ°äº†ä¸€ä¸ªprocessorï¼Œç„¶åæ‰§è¡Œå®ƒï¼Œä»»åŠ¡æ‰§è¡Œå®Œä¹‹åå†æŠŠå®ƒæ”¾å›æ± é‡Œã€‚å®Œæˆäº†ä¸€æ¬¡è¯·æ±‚å“åº”ã€‚</p><p>ä½†æ˜¯æˆ‘ä»¬è¦æ³¨æ„ï¼Œåˆ°ç°åœ¨ä¸ºæ­¢ï¼ŒHttpProcessorå¹¶æ²¡æœ‰åšåˆ°å¤šçº¿ç¨‹ï¼Œä¹Ÿæ²¡æœ‰å®ç°NIOï¼Œåªæ˜¯åœ¨æ± ä¸­æ”¾ç½®äº†å¤šä¸ªå¯¹è±¡ï¼Œåšåˆ°äº†å¤šè·¯å¤ç”¨ã€‚ç›®å‰æ•´ä½“æ¶æ„è¿˜æ˜¯é˜»å¡å¼è¿è¡Œçš„ï¼ŒSocketæ¯æ¬¡ç”¨ä¹‹åä¹Ÿå…³é—­ä¸¢å¼ƒäº†ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬è¦ç»§ç»­æ”¹é€ ï¼Œä¼˜åŒ–HttpProcessorçš„æ€§èƒ½ã€‚</p><h2>å¤šçº¿ç¨‹HttpProcessor</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è®¡åˆ’è®¾ç½®å¤šçº¿ç¨‹Processorï¼Œé€šè¿‡è¿™ä¸ªæ‰‹æ®µç»§ç»­ä¼˜åŒ–å®ƒçš„æ€§èƒ½ã€‚è¿™å¯ä»¥ä½¿ä¸€ä¸ªConnectoråŒæ—¶æœåŠ¡äºå¤šä¸ªProcessorã€‚</p><p>åŸºæœ¬çš„æ€è·¯æ˜¯ä½¿ç”¨å¤šä¸ªçº¿ç¨‹ï¼Œè®©Connectorå’ŒProcessoråˆ†åˆ«ç”±ä¸åŒçš„çº¿ç¨‹æ¥è¿è¡Œã€‚å·¥ä½œçš„åŸºæœ¬æµç¨‹æ˜¯ç”±Connectoræ¥æ”¶æŸä¸ªSocketè¿æ¥åäº¤ç»™æŸä¸ªProcessorçº¿ç¨‹å¤„ç†ï¼Œè€ŒProcessorçº¿ç¨‹ç­‰å¾…æŸä¸ªSocketè¿æ¥åˆ°æ¥åè¿›è¡Œå¤„ç†ï¼Œå¤„ç†å®Œæ¯•ä¹‹åè¦äº¤å›ç»™Connectorã€‚å› æ­¤ï¼Œ<strong>è¿™é‡Œçš„æ ¸å¿ƒæ˜¯è¦è®¾è®¡ä¸€ä¸ªçº¿ç¨‹ä¹‹é—´çš„åŒæ­¥æœºåˆ¶ã€‚</strong></p><p>é¦–å…ˆæˆ‘ä»¬è®©HttpProcessorå®ç°Runnableæ¥å£ï¼Œè¿™æ ·æ¯ä¸€ä¸ªHttpProcessoréƒ½å¯ä»¥åœ¨ç‹¬ç«‹çš„çº¿ç¨‹ä¸­è¿è¡Œã€‚æ”¹é€ å¦‚ä¸‹ï¼š</p><pre><code class=\"language-java\">public class HttpProcessor implements Runnable{\n    @Override\n    public void run() {\n        while (true) {\n            // ç­‰å¾…socketåˆ†é…è¿‡æ¥\n            Socket socket = await();\n            if (socket == null) continue;\n            // å¤„ç†è¯·æ±‚\n            process(socket);\n            // å›æ”¶processor\n            connector.recycle(this);\n        }\n    }\n}\n</code></pre><p>ä¸Šè¿°Processorçš„run()æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹æ˜¯ï¼Œç­‰å¾…æŸä¸ªSocketï¼Œæ”¶åˆ°Connectoräº¤è¿‡æ¥çš„Socketåï¼ŒProcessæ–¹æ³•å¤„ç†è¿™ä¸ªSocketï¼Œå¤„ç†å®Œæ¯•ä¹‹åäº¤å›ç»™Connectorå›æ”¶ï¼Œå¹¶é‡æ–°æŠŠè¿™ä¸ªprocessoræ”¾å…¥æ± é‡Œã€‚</p><p>è¿™æ˜¯Processoræ¥æ”¶è€…è¿™ä¸€è¾¹ï¼Œè€Œå¦ä¸€è¾¹å°±æ˜¯ä½œä¸ºåˆ†é…è€…çš„Connectorã€‚ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬æä¾›ä¸€ä¸ªassignæ–¹æ³•è®©Connectoråˆ†é…Socketç»™Processorã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬é‡ç‚¹è§£å†³åˆ†é…è€…å’Œæ¥æ”¶è€…å¦‚ä½•åŒæ­¥çš„é—®é¢˜ã€‚å› ä¸ºè¿™æ˜¯ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€å®šéœ€è¦åŒæ­¥æ‰èƒ½ååŒå·¥ä½œã€‚åŸºæœ¬çš„æ€è·¯å°±æ˜¯ <code>await()</code> æ–¹æ³•é‡Œç­‰ç€Socketï¼Œè€Œassign()æ–¹æ³•é‡Œåˆ†é…Socketï¼Œä¸­é—´é€šè¿‡ä¸€ä¸ªæ ‡å¿—æ¥è¡¨ç¤ºåˆ†é…å’Œæ¥æ”¶çŠ¶æ€ï¼Œä»¥æ­¤è¿›è¡ŒåŒæ­¥ã€‚</p><p>è¿™ä¸ªåŒæ­¥çš„æœºåˆ¶å†…éƒ¨å…¶å®å°±æ˜¯ç”¨çš„Javaè‡ªèº«æä¾›çš„notifyå’Œwaitã€‚</p><p>çœ‹ç¨‹åºä»£ç ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-java\">synchronized void assign(Socket socket) {\n    // ç­‰å¾…connectoræä¾›ä¸€ä¸ªæ–°çš„socket\n    while (available) {\n        try {\n            wait();\n        } catch (InterruptedException e) {\n        }\n    }\n    // è·å–åˆ°è¿™ä¸ªæ–°çš„Socket\n    this.socket = socket;\n    // æŠŠæ ‡å¿—è®¾ç½®å›å»\n    available = true;\n    //é€šçŸ¥å¦å¤–çš„çº¿ç¨‹\n    notifyAll();\n}\nprivate synchronized Socket await() {\n    // ç­‰å¾…connectoræä¾›ä¸€ä¸ªæ–°çš„socket\n    while (!available) {\n        try {\n            wait();\n        }catch (InterruptedException e) {\n        }\n    }\n    // è·å¾—è¿™ä¸ªæ–°çš„Socket\n    Socket socket = this.socket;\n    //è®¾ç½®æ ‡å¿—ä¸ºfalse\n    available = false;\n    //é€šçŸ¥å¦å¤–çš„çº¿ç¨‹\n    notifyAll();\n    return (socket);\n}\n</code></pre><p>é¦–å…ˆçœ‹ <code>assign(socket)</code> æ–¹æ³•ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªæ ‡å¿—availableæ¥æ ‡è®°ï¼Œå¦‚æœæ ‡å¿—ä¸ºtrueï¼ŒConnetorçº¿ç¨‹å°±ç»§ç»­æ­»ç­‰ã€‚åˆ°äº†æŸä¸ªæ—¶å€™ï¼ŒProcessorçº¿ç¨‹æŠŠè¿™ä¸ªæ ‡å¿—è®¾ç½®ä¸ºfalseï¼ŒConnectorçº¿ç¨‹å°±è·³å‡ºæ­»ç­‰çš„å¾ªç¯ï¼Œç„¶åæŠŠæ¥æ”¶åˆ°çš„Socketäº¤ç»™Processorã€‚ç„¶åè¦ç«‹åˆ»é‡æ–°æŠŠavailableæ ‡å¿—è®¾ç½®ä¸ºtrueï¼Œå†è°ƒç”¨ <code>notifyAll()</code> é€šçŸ¥å…¶ä»–çº¿ç¨‹ã€‚</p><p>å†çœ‹ <code>await()</code>ï¼Œè¿™æ˜¯ä½œä¸ºæ¥æ”¶è€…Processorçš„çº¿ç¨‹ä½¿ç”¨çš„æ–¹æ³•ã€‚åè¿‡æ¥ï¼Œå¦‚æœavaliableæ ‡å¿—ä¸ºfalseï¼Œé‚£ä¹ˆProcessorçº¿ç¨‹ç»§ç»­æ­»ç­‰ã€‚åˆ°äº†æŸä¸ªæ—¶å€™ï¼ŒConnectorçº¿æŠŠè¿™ä¸ªæ ‡å¿—è®¾ç½®ä¸ºtrueï¼Œé‚£ä¹ˆProcessorçº¿ç¨‹å°±è·³å‡ºæ­»ç­‰çš„å¾ªç¯ï¼Œæ‹¿åˆ°Socketã€‚ç„¶åè¦ç«‹åˆ»é‡æ–°æŠŠavaiableæ ‡å¿—è®¾ç½®ä¸ºfalseï¼Œå†è°ƒç”¨ <code>notifyAll()</code> é€šçŸ¥å…¶ä»–çº¿ç¨‹ã€‚</p><p>è¿™ä¸ªçº¿ç¨‹äº’é”æœºåˆ¶ä¿è¯äº†ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´çš„åŒæ­¥åè°ƒã€‚å›¾ç¤ºå¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/2d/45/2d11aedac65015d24a77116290f1b145.png?wh=2220x1376\" alt=\"\"></p><p>ä¸‹é¢æˆ‘åˆ—å‡ºHttpProcessorçš„å®Œæ•´ä»£ç ï¼Œå› ä¸ºHttpProcessoræ„é€ å‡½æ•°è°ƒæ•´ï¼Œå¢åŠ äº†HttpConnectorçš„å‚æ•°ï¼Œæ‰€ä»¥æˆ‘æŠŠHttpConnectorç±»è°ƒæ•´åçš„ä»£ç ä¸€å¹¶åˆ—å‡ºäº†ï¼Œéšåæˆ‘ä»¬ç»Ÿä¸€è¯´æ˜è°ƒæ•´æ­¥éª¤è¿˜æœ‰è°ƒæ•´çš„ç†ç”±ã€‚</p><p>HttpProcessorä»£ç ï¼š</p><pre><code class=\"language-java\">public class HttpProcessor implements Runnable{\n    Socket socket;\n    boolean available = false;\n    HttpConnector connector;\n    public HttpProcessor(HttpConnector connector) {\n        this.connector = connector;\n    }\n    @Override\n    public void run() {\n        while (true) {\n            // ç­‰å¾…åˆ†é…ä¸‹ä¸€ä¸ª socket\n            Socket socket = await();\n            if (socket == null) continue;\n            // å¤„ç†æ¥è‡ªè¿™ä¸ªsocketçš„è¯·æ±‚\n            process(socket);\n            // å®Œæˆæ­¤è¯·æ±‚\n            connector.recycle(this);\n        }\n    }\n    public void start() {\n        Thread thread = new Thread(this);\n        thread.start();\n    }\n    public void process(Socket socket) {\n        try {\n            Thread.sleep(3000);\n        } catch (InterruptedException e1) {\n            e1.printStackTrace();\n        }\n        InputStream input = null;\n        OutputStream output = null;\n        try {\n            input = socket.getInputStream();\n            output = socket.getOutputStream();\n            // åˆ›å»ºè¯·æ±‚å¯¹è±¡å¹¶è§£æ\n            Request request = new Request(input);\n            request.parse();\n            // åˆ›å»ºå“åº”å¯¹è±¡\n            Response response = new Response(output);\n            response.setRequest(request);\n//               response.sendStaticResource();\n            // æ£€æŸ¥è¿™æ˜¯å¯¹servletè¿˜æ˜¯é™æ€èµ„æºçš„è¯·æ±‚\n            // a request for a servlet begins with \"/servlet/\"\n            if (request.getUri().startsWith(\"/servlet/\")) {\n                ServletProcessor processor = new ServletProcessor();\n                processor.process(request, response);\n            }\n            else {\n                StaticResourceProcessor processor = new StaticResourceProcessor();\n                processor.process(request, response);\n            }\n            // å…³é—­ socket\n            socket.close();\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n    synchronized void assign(Socket socket) {\n        // ç­‰å¾… connector æä¾›æ–°çš„ Socket\n        while (available) {\n            try {\n                wait();\n            } catch (InterruptedException e) {\n            }\n        }\n        // å­˜å‚¨æ–°å¯ç”¨çš„ Socket å¹¶é€šçŸ¥æˆ‘ä»¬çš„çº¿ç¨‹\n        this.socket = socket;\n        available = true;\n        notifyAll();\n    }\n    private synchronized Socket await() {\n        // ç­‰å¾… connector æä¾›ä¸€ä¸ªæ–°çš„ Socket\n        while (!available) {\n            try {\n                wait();\n            }catch (InterruptedException e) {\n            }\n        }\n        // é€šçŸ¥Connectoræˆ‘ä»¬å·²ç»æ”¶åˆ°è¿™ä¸ªSocketäº†\n        Socket socket = this.socket;\n        available = false;\n        notifyAll();\n        return (socket);\n    }\n}\n</code></pre><p>è¦æ³¨æ„availableæ ‡å¿—å’Œ <code>assign()</code> æ–¹æ³•éƒ½æ˜¯å†™åœ¨Processorç±»é‡Œçš„ã€‚</p><pre><code class=\"language-java\">processor.assign(socket);\n</code></pre><p>ä½†æ˜¯è¿™å¹¶ä¸è¡¨ç¤º <code>assign()</code> æ˜¯Processorçº¿ç¨‹æ¥æ‰§è¡Œï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨è€…æ˜¯Connectorã€‚</p><p>HttpConnectorä»£ç ï¼š</p><pre><code class=\"language-java\">public class HttpConnector implements Runnable {\n    int minProcessors = 3;\n    int maxProcessors = 10;\n    int curProcessors = 0;\n    //å­˜æ”¾Processorçš„æ± å­\n    Deque&lt;HttpProcessor&gt; processors = new ArrayDeque&lt;&gt;();\n    public void run() {\n        ServerSocket serverSocket = null;\n        int port = 8080;\n        try {\n            serverSocket = new ServerSocket(port, 1, InetAddress.getByName(\"127.0.0.1\"));\n        } catch (IOException e) {\n            e.printStackTrace();\n            System.exit(1);\n        }\n        // åˆå§‹åŒ–æ± å­initialize processors pool\n        for (int i = 0; i &lt; minProcessors; i++) {\n            HttpProcessor initprocessor = new HttpProcessor(this);\n            initprocessor.start();\n            processors.push(initprocessor);\n        }\n        curProcessors = minProcessors;\n        while (true) {\n            Socket socket = null;\n            try {\n                socket = serverSocket.accept();\n                //å¯¹æ¯ä¸€ä¸ªsocketï¼Œä»æ± å­ä¸­æ‹¿åˆ°ä¸€ä¸ªprocessor\n                HttpProcessor processor = createProcessor();\n                if (processor == null) {\n                    socket.close();\n                    continue;\n                }\n                //åˆ†é…ç»™è¿™ä¸ªprocessor\n                processor.assign(socket);\n                // Close the socket\n//                socket.close();\n            } catch (Exception e) {\n                e.printStackTrace();\n            }\n        }\n    }\n    public void start() {\n        Thread thread = new Thread(this);\n        thread.start();\n    }\n    //ä»æ± å­ä¸­è·å–ä¸€ä¸ªprocessorï¼Œæ± å­ä¸ºç©ºä¸”æ•°é‡å°äºæœ€å¤§é™åˆ¶åˆ™ä¼šæ–°å»ºä¸€ä¸ªprocessor\n    private HttpProcessor createProcessor() {\n        synchronized (processors) {\n            if (processors.size() &gt; 0) {\n                return ((HttpProcessor) processors.pop());\n            }\n            if (curProcessors &lt; maxProcessors) {\n                return (newProcessor());\n            }\n            else {\n                return (null);\n            }\n        }\n    }\n    private HttpProcessor newProcessor() {\n        HttpProcessor initprocessor = new HttpProcessor(this);\n        initprocessor.start();\n        processors.push(initprocessor);\n        curProcessors++;\n        return ((HttpProcessor) processors.pop());\n    }\n    void recycle(HttpProcessor processor) {\n        processors.push(processor);\n    }\n}\n\n</code></pre><p>æˆ‘ä»¬å†å›é¡¾ä¸€ä¸‹HttpProcessorç±»ä¸­çš„assignæ–¹æ³•ä¸awaitæ–¹æ³•ã€‚åœ¨HttpProcessorçš„çº¿ç¨‹å¯åŠ¨ä¹‹åï¼Œavailableçš„æ ‡è¯†ä¸€ç›´æ˜¯falseï¼Œè¿™ä¸ªæ—¶å€™è¿™ä¸ªçº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ã€‚åœ¨HttpConnectorç±»é‡Œæ„é€ Processorï¼Œå¹¶ä¸”è°ƒç”¨ <code>processor.assign(socket)</code> ç»™HttpProcessoråˆ†é…Socketä¹‹åï¼Œæ ‡è¯†ç¬¦availableæ”¹æˆtrueï¼Œå¹¶ä¸”è°ƒç”¨notifyAllè¿™ä¸ªæœ¬åœ°æ–¹æ³•é€šçŸ¥å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ã€‚</p><p>è€Œåœ¨awaitæ–¹æ³•é‡Œï¼ŒHttpProcessoræ‹¿åˆ°HttpConnectorä¼ æ¥çš„Socketä¹‹åï¼Œé¦–å…ˆä¼šæ¥æ”¶Socketï¼Œå¹¶ä¸”ç«‹å³æŠŠavailableç”±trueæ”¹ä¸ºfalseï¼Œæœ€åä»¥æ‹¿åˆ°çš„è¿™ä¸ªSocketä¸ºåŸºå‡†ç»§ç»­è¿›è¡ŒProcessorä¸­çš„å¤„ç†å·¥ä½œã€‚</p><p>è¿™ä¹Ÿæ„å‘³ç€ï¼Œä¸€æ—¦Connectoråˆ†é…äº†ä¸€ä¸ªSocketç»™åˆ°Processorï¼Œåè€…å°±èƒ½ç«‹å³ç»“æŸç­‰å¾…ï¼Œæ‹¿åˆ°Socketåè°ƒç”¨Processæ–¹æ³•ç»§ç»­åé¢çš„å·¥ä½œã€‚è¿™æ—¶availableçš„çŠ¶æ€ç«‹åˆ»ä¿®æ”¹ï¼Œè¿›è€Œç”¨notifyAllæ–¹æ³•å”¤é†’Connectorçš„ç­‰å¾…çº¿ç¨‹ï¼ŒConnectorå°±å¯ä»¥å…¨èº«è€Œé€€ï¼Œå»å¤„ç†ä¸‹ä¸€ä¸ªHttpProcessoräº†ã€‚</p><p>Tomcatä¸­ä¸¤ä¸ªçº¿ç¨‹äº’é”çš„è¿™ç§æœºåˆ¶å¾ˆç»å…¸ï¼Œåœ¨åç»­ç‰ˆæœ¬çš„NIOå’ŒServletåè°ƒçš„è®¾è®¡ä¸­éƒ½ç”¨åˆ°äº†ã€‚</p><p>è¿™æ ·ä¹Ÿå°±åšåˆ°äº†HttpProcessorçš„å¼‚æ­¥åŒ–ï¼Œä¹Ÿæ­£å› ä¸ºåšåˆ°äº†å¼‚æ­¥åŒ–ï¼Œæˆ‘ä»¬å°±ä¸èƒ½å†åˆ©ç”¨Connectorå»å…³é—­Socketäº†ï¼Œå› ä¸ºConnectoræ˜¯ä¸çŸ¥é“Processorä½•æ—¶å¤„ç†å®Œæ¯•çš„ï¼ŒSocketçš„å…³é—­ä»»åŠ¡å°±äº¤ç»™Processorè‡ªå·±å¤„ç†äº†ã€‚</p><p>å› æ­¤åœ¨Connectorç±»é‡Œï¼Œsocket.close()è¿™ä¸€è¡Œè¢«æ³¨é‡Šæ‰äº†ï¼Œè€Œåœ¨Processorç±»é‡Œæ–°å¢äº†é‚£ä¸€è¡Œä»£ç ã€‚</p><h2>æµ‹è¯•</h2><p>åœ¨src/test/java/testç›®å½•ä¸‹ï¼Œä¿®æ”¹HelloServletã€‚</p><pre><code class=\"language-java\">package test;\nimport java.io.IOException;\nimport javax.servlet.Servlet;\nimport javax.servlet.ServletConfig;\nimport javax.servlet.ServletException;\nimport javax.servlet.ServletRequest;\nimport javax.servlet.ServletResponse;\npublic class HelloServlet implements Servlet{\n    @Override\n    public void service(ServletRequest req, ServletResponse res) throws ServletException, IOException {\n        res.setCharacterEncoding(\"UTF-8\");\n        String doc = \"&lt;!DOCTYPE html&gt; \\n\" +\n                \"&lt;html&gt;\\n\" +\n                \"&lt;head&gt;&lt;meta charset=\\\"utf-8\\\"&gt;&lt;title&gt;Test&lt;/title&gt;&lt;/head&gt;\\n\"+\n                \"&lt;body bgcolor=\\\"#f0f0f0\\\"&gt;\\n\" +\n                \"&lt;h1 align=\\\"center\\\"&gt;\" + \"Hello World ä½ å¥½\" + \"&lt;/h1&gt;\\n\";\n        res.getWriter().println(doc);\n    }\n    @Override\n    public void destroy() {\n    }\n    @Override\n    public ServletConfig getServletConfig() {\n        return null;\n    }\n    @Override\n    public String getServletInfo() {\n        return null;\n    }\n    @Override\n    public void init(ServletConfig arg0) throws ServletException {\n    }\n}\n</code></pre><p>è¿™ä¸€æ¬¡æˆ‘ä»¬çš„æµ‹è¯•ç±»è¿˜æ˜¯å’Œä¹‹å‰å·®ä¸å¤šï¼Œä½†åœ¨Processorçš„processæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ–°å¢äº†Thread.sleepæ–¹æ³•ã€‚</p><p>åœ¨å‡†å¤‡å·¥ä½œè¿›è¡Œå®Œæ¯•ä¹‹åï¼Œæˆ‘ä»¬è¿è¡ŒHttpServeræœåŠ¡å™¨ï¼Œåœ¨æµè§ˆå™¨ä¸­å¯ä»¥è¿ç»­æ‰“å¼€å¤šä¸ªé¡µé¢ï¼Œé”®å…¥ <code>http://localhost:8080/hello.txt</code> åï¼Œç­‰å¾…ä¸€å°æ®µæ—¶é—´ï¼ˆè¿™ä¸ªæ—¶é—´ç”±Thread.sleepä¼ å…¥å‚æ•°timeoutå†³å®šï¼Œtimeoutä»¥æ¯«ç§’ä¸ºå•ä½ï¼‰ï¼Œéšåæˆ‘ä»¬å¯ä»¥å‘ç°hello.txté‡Œçš„æ‰€æœ‰æ–‡æœ¬å†…å®¹ï¼Œéƒ½ä½œä¸ºè¿”å›ä½“å±•ç¤ºåœ¨æµè§ˆå™¨é¡µé¢ä¸Šäº†ã€‚</p><p>å†ä»¥åŒæ ·çš„æ–¹æ³•æµ‹è¯•HelloServletï¼Œè¾“å…¥ <code>http://localhost:8080/servlet/test.HelloServlet</code> åç­‰å¾…ä¸€å°ä¼šå„¿è¿˜æ˜¯å¯ä»¥çœ‹åˆ°æµè§ˆå™¨æ˜¾ç¤ºï¼šHello World ä½ å¥½ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨HelloServleté‡Œå®šä¹‰çš„è¿”å›èµ„æºå†…å®¹ã€‚</p><p>è¿™äº›ç»“æœå¯ä»¥è¯æ˜ï¼Œæˆ‘ä»¬æ•´ä½“çš„æ”¹é€ å·²ç»åšåˆ°Processorå¼‚æ­¥åŒ–çš„æ”¹é€ ï¼Œåœ¨å®¢æˆ·ç«¯è¿ç»­è¾“å…¥å¤šæ¬¡è¯·æ±‚åï¼Œèƒ½åšåˆ°å¹¶å‘æ‰§è¡Œï¼Œäº’ä¸å½±å“ã€‚</p><h2>å°ç»“</h2><p><img src=\"https://static001.geekbang.org/resource/image/5d/75/5d5f42c1d99ba37d9b66821ed322ca75.jpg?wh=2308x1172\" alt=\"\"></p><p>è¿™èŠ‚è¯¾æˆ‘ä»¬ä¸»è¦åšäº†ä¸¤ä»¶äº‹ï¼šå¼•å…¥æ± åŒ–æŠ€æœ¯ä»¥åŠProcessorå¤šçº¿ç¨‹ã€‚å‰è€…æˆ‘ä»¬ä»ä¼˜åŒ–å¯¹è±¡æ„é€ ï¼ŒæŒç»­å¤ç”¨çš„è§’åº¦ï¼Œåšåˆ°äº†æ€§èƒ½çš„ä¼˜åŒ–æå‡ï¼Œå‹ç¼©äº†æ„é€ å¯¹è±¡çš„æ€§èƒ½å¼€é”€ï¼›è€Œåè€…åˆ™ä»å¹¶å‘çš„è§’åº¦ï¼Œä½¿Connectorèƒ½åŒæ—¶æœåŠ¡äºå¤šä¸ªProcessorï¼Œå‡å°‘äº†åŸæ¥å› ç­‰å¾…Processorå¤„ç†è€Œäº§ç”Ÿçš„æ—¶é—´æ¶ˆè€—ï¼Œä½†æ˜¯ä¹Ÿéœ€è¦ä»”ç»†ç¼–å†™çº¿ç¨‹åŒæ­¥ä»£ç ã€‚</p><p>æœ¬èŠ‚è¯¾å®Œæ•´ä»£ç å‚è§ï¼š<a href=\"https://gitee.com/yaleguo1/minit-learning-demo/tree/geek_chapter05\">https://gitee.com/yaleguo1/minit-learning-demo/tree/geek_chapter0</a><a href=\"https://gitee.com/yaleguo1/minit-learning-demo/tree/geek_chapter05\">5</a></p><h2>æ€è€ƒé¢˜</h2><p>å­¦å®Œäº†è¿™èŠ‚è¯¾çš„å†…å®¹ï¼Œæˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šTomcatä¸ºä»€ä¹ˆç”¨ä¸€ä¸ªç®€å•çš„queueæ¥å®ç°å¤šçº¿ç¨‹è€Œä¸æ˜¯ç”¨JDKè‡ªå¸¦çš„çº¿ç¨‹æ± ï¼Ÿ</p><p>æ¬¢è¿ä½ æŠŠä½ æ€è€ƒåçš„ç»“æœåˆ†äº«åˆ°è¯„è®ºåŒºï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾çš„å†…å®¹åˆ†äº«ç»™å…¶ä»–æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","neighbors":{"left":{"article_title":"04ï½œå„å¸å…¶èŒçš„Serverï¼šæ‹†åˆ†å“åº”æ¨¡å—ä¸å¤„ç†æ¨¡å—","id":734381},"right":{"article_title":"06ï½œè§„èŒƒåŒ–ï¼šå¼•å…¥HttpRequestä¸HttpResponse","id":735122}},"comments":[{"had_liked":false,"id":386234,"user_name":"é©¬ä»¥","can_delete":false,"product_type":"c1","uid":1344431,"ip_address":"å¹¿ä¸œ","ucode":"3FEA06CA14DE28","user_header":"https://static001.geekbang.org/account/avatar/00/14/83/af/1cb42cd3.jpg","comment_is_top":false,"comment_ctime":1704359989,"is_pvip":false,"replies":[{"id":140784,"content":"èµã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1704380996,"ip_address":"æ¹–å—","comment_id":386234,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"æ€è€ƒé¢˜ï¼štomcatçš„çº¿ç¨‹æ± æ¨¡å‹å’ŒJDKè‡ªå¸¦çº¿ç¨‹æ± æ¨¡å‹åœ¨æ ¸å¿ƒçº¿ç¨‹æ± ç”¨å®Œåçš„å®ç°æ–¹å¼ä¸Šæ˜¯ä¸åŒçš„ï¼›JDKçš„çº¿ç¨‹æ± åœ¨è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ± æ•°é‡åï¼Œåç»­çš„è¯·æ±‚ä¼šè¿›å…¥åˆ°ç­‰å¾…é˜Ÿåˆ—ï¼ˆå¾®è§‚ä¸Šçœ‹å±äºé˜»å¡ï¼‰ï¼Œå› ä¸ºtomcatä½œä¸ºservletæœåŠ¡è¯·æ±‚ï¼Œæœ¬è´¨ä¸Šåªèƒ½å¹¶å‘å¤„ç†æœ‰é™ä¸ªï¼ˆæ ¸å¿ƒçº¿ç¨‹æ•°ï¼‰çš„å¹¶å‘æ•°ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸åˆç†çš„ï¼›æ‰€ä»¥tomcatçš„çº¿ç¨‹æ± æ¨¡å‹æ˜¯è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ± åä¼šç»§ç»­å¯åŠ¨æ–°çº¿ç¨‹å¤„ç†è¯·æ±‚ï¼Œç›´åˆ°è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°ï¼›","like_count":5,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635086,"discussion_content":"èµã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704380996,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¹–å—","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1572356,"avatar":"https://static001.geekbang.org/account/avatar/00/17/fe/04/bb427e47.jpg","nickname":"ç å“¥å­—èŠ‚","note":"","ucode":"362103AD52C8E0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":650680,"discussion_content":"é‚£å¯ä»¥æŠŠæ ¸å¿ƒçº¿ç¨‹æ•°ä¸æœ€å¤§çº¿ç¨‹æ•°è®¾ç½®æˆä¸€æ ·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1725445535,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1344431,"avatar":"https://static001.geekbang.org/account/avatar/00/14/83/af/1cb42cd3.jpg","nickname":"é©¬ä»¥","note":"","ucode":"3FEA06CA14DE28","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1572356,"avatar":"https://static001.geekbang.org/account/avatar/00/17/fe/04/bb427e47.jpg","nickname":"ç å“¥å­—èŠ‚","note":"","ucode":"362103AD52C8E0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":651673,"discussion_content":"è¿˜æ˜¯æœ‰åŒºåˆ«çš„ï¼Œä¸ºäº†è¾¾åˆ°é«˜ååé‡ï¼Œä½ çš„æ ¸å¿ƒçº¿ç¨‹æ•°åŠ¿å¿…è¦è®¾ç½®ä¸€ä¸ªå¤§çš„æ•°å€¼ï¼Œå› ä¸ºæ ¸å¿ƒçº¿ç¨‹æ•°åœ¨ç©ºé—²æ—¶ä¸èƒ½é‡Šæ”¾ï¼Œæ‰€ä»¥ä¼šå¾ˆè€—èµ„æº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1727240677,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":650680,"ip_address":"å¹¿ä¸œ","group_id":0},"score":651673,"extra":""},{"author":{"id":1572356,"avatar":"https://static001.geekbang.org/account/avatar/00/17/fe/04/bb427e47.jpg","nickname":"ç å“¥å­—èŠ‚","note":"","ucode":"362103AD52C8E0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1344431,"avatar":"https://static001.geekbang.org/account/avatar/00/14/83/af/1cb42cd3.jpg","nickname":"é©¬ä»¥","note":"","ucode":"3FEA06CA14DE28","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":654819,"discussion_content":"ä¹Ÿå¯ä»¥è®¾ç½®å›æ”¶ç©ºé—²æ ¸å¿ƒçº¿ç¨‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1733537527,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":651673,"ip_address":"å¹¿ä¸œ","group_id":0},"score":654819,"extra":""}]}]},{"had_liked":false,"id":388526,"user_name":"Geek_ac5e30","can_delete":false,"product_type":"c1","uid":2704281,"ip_address":"ä¸­å›½é¦™æ¸¯","ucode":"D8349339D63A10","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/kgFgg4b6yribq8tSqAht0383fzoGSG9COPiaicLMzbdouGBrtJehiboqnJbbAiaNEtib1wYM9wAlAvCTZFUfYQDaElBA/132","comment_is_top":false,"comment_ctime":1710333248,"is_pvip":false,"replies":[{"id":141538,"content":"æ˜¯","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1711286644,"ip_address":"ç¦å»º","comment_id":388526,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"è¿™é‡Œ available å˜é‡æ˜¯å¦ä½¿ç”¨ volatile ä¿®é¥°ä¼šå¥½ä¸€äº›å‘¢ï¼Ÿè¿™é‡Œæ¶‰åŠåˆ°ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§é—®é¢˜","like_count":4,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":640198,"discussion_content":"æ˜¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1711286644,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ç¦å»º","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2683430,"avatar":"https://static001.geekbang.org/account/avatar/00/28/f2/26/a8ac6b42.jpg","nickname":"å¬é£æœ‰ä¿¡","note":"","ucode":"2CCB467114FF5C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":654030,"discussion_content":"åº”è¯¥ä¸ç”¨ï¼ŒåŒä¸€æŠŠé”çš„è§£é” happens  before äºåŠ é”ï¼Œæ‰€ä»¥ available çš„ä¿®æ”¹æ˜¯å¯è§çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1731722859,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385554,"user_name":"soâ€†long","can_delete":false,"product_type":"c1","uid":1449679,"ip_address":"æµ™æ±Ÿ","ucode":"2A6B47BB32FC18","user_header":"https://static001.geekbang.org/account/avatar/00/16/1e/cf/97cd8be1.jpg","comment_is_top":false,"comment_ctime":1702902658,"is_pvip":false,"replies":[{"id":140508,"content":"æ˜¯çš„ã€‚jdkçº¿ç¨‹æ± ç”¨çš„æ™®é€šé˜Ÿåˆ—ï¼Œä¸é€‚åˆioå‹å¤šä»»åŠ¡å¤„ç†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1702969487,"ip_address":"åŒ—äº¬","comment_id":385554,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"jdkçº¿ç¨‹æ± ï¼Œåœ¨å¹¶å‘æ•°è¶…è¿‡æ ¸å¿ƒçº¿ç¨‹æ•°åï¼Œä¼šå…ˆå°†è¯·æ±‚ä»»åŠ¡æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼Œè€Œä¸æ˜¯åˆ›å»ºæ–°çš„çº¿ç¨‹å¤„ç†è¯·æ±‚ä»»åŠ¡ï¼Œæ‰€ä»¥ä¼šå­˜åœ¨ä¸€å®šçš„å»¶è¿Ÿ","like_count":2,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634072,"discussion_content":"æ˜¯çš„ã€‚jdkçº¿ç¨‹æ± ç”¨çš„æ™®é€šé˜Ÿåˆ—ï¼Œä¸é€‚åˆioå‹å¤šä»»åŠ¡å¤„ç†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1702969487,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385810,"user_name":"åƒå°‘å¹´æ ·é£é©°","can_delete":false,"product_type":"c1","uid":1115033,"ip_address":"ä¸Šæµ·","ucode":"494E9FBA0648D4","user_header":"https://static001.geekbang.org/account/avatar/00/11/03/99/d7737b19.jpg","comment_is_top":false,"comment_ctime":1703426047,"is_pvip":false,"replies":[{"id":140596,"content":"ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯jdkçº¿ç¨‹æ± ä¸æ˜¯å¾ˆé€‚åˆï¼Œæ‰€ä»¥Tomcaté‡‡ç”¨äº†è¿™ä¸ªæ–¹å¼ï¼ˆæœ‰äººä¹Ÿæœ‰ç±»ä¼¼é—®é¢˜ï¼Œè§åˆ«çš„è§£ç­”ï¼‰ã€‚å¯¹æˆ‘ä¸ªäººæ¥è¯´ï¼Œæ˜¯å¿ äºTomcatçš„åŸå§‹å®ç°ï¼Œä»¥åå­¦ä¹ è€…è¯»åˆ°Tomcatè¿™ä¸€æ®µæºä»£ç çš„æ—¶å€™ä¸ä¼šè§‰å¾—éš¾ä»¥ç†è§£ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1703487671,"ip_address":"å¹¿ä¸œ","comment_id":385810,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"è¿™é‡Œé¢çº¿ç¨‹åŒæ­¥æœºåˆ¶éœ€è¦è¿™æ ·å†™ä¹ˆï¼Ÿ ç›´æ¥å‚è€ƒçº¿ç¨‹æ± çš„è®¾è®¡ï¼Œç”¨ä¸€ä¸ªé˜»å¡é˜Ÿåˆ—æ˜¯ä¸æ˜¯å°±å¯ä»¥äº†ï¼Ÿ æœ¬è´¨ä¸Šè¿˜æ˜¯ä¸€ä¸ªç”Ÿäº§å’Œæ¶ˆè´¹çš„æ¨¡å‹å§","like_count":1,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634421,"discussion_content":"ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯jdkçº¿ç¨‹æ± ä¸æ˜¯å¾ˆé€‚åˆï¼Œæ‰€ä»¥Tomcaté‡‡ç”¨äº†è¿™ä¸ªæ–¹å¼ï¼ˆæœ‰äººä¹Ÿæœ‰ç±»ä¼¼é—®é¢˜ï¼Œè§åˆ«çš„è§£ç­”ï¼‰ã€‚å¯¹æˆ‘ä¸ªäººæ¥è¯´ï¼Œæ˜¯å¿ äºTomcatçš„åŸå§‹å®ç°ï¼Œä»¥åå­¦ä¹ è€…è¯»åˆ°Tomcatè¿™ä¸€æ®µæºä»£ç çš„æ—¶å€™ä¸ä¼šè§‰å¾—éš¾ä»¥ç†è§£ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1703487671,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385551,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"åŒ—äº¬","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1702901504,"is_pvip":false,"replies":[{"id":140538,"content":"éƒ½æ˜¯å¥½é—®é¢˜ã€‚notifyallä¼šå”¤é†’å…¨éƒ¨ï¼Œä½†æ˜¯ä»£ç ä¸­ä¸€æ—¦æ ‡å¿—ä¸ç¬¦åˆå°±ä¼šç»§ç»­ç­‰å¾…ï¼Œä¸ä¼šå‡ºç°å‡ ä¸ªåŒæ—¶å¤„ç†ï¼Œä½ ä»”ç»†è·Ÿä»£ç ã€‚recycleæˆ‘ä¹Ÿè®¤ä¸ºä¼šå‡ºç°å¹¶å‘é—®é¢˜ï¼Œä½ è¿™ä¸ªè§‚å¯Ÿå¾ˆå¥½ï¼Œè¿™æ®µä»£ç å–è‡ªTomcat4æºä»£ç ï¼Œåº”è¯¥æ˜¯æœ‰é—®é¢˜ã€‚ çº¿ç¨‹æ± å¤§å°ï¼Œå¾ˆå¤æ‚ï¼Œå¤§å¸ˆä»¬æœ‰ä¸ªå…¬å¼ï¼Œä¾èµ–äºæ ¸è¿˜æœ‰è®¡ç®—æ—¶é—´ç­‰å¾…æ—¶é—´ï¼Œä½†æ˜¯å®é™…ç³»ç»Ÿå¤æ‚ï¼Œå¾ˆä¸å¥½ä¼°ç®—è®¡ç®—æ—¶é—´ç­‰å¾…æ—¶é—´ï¼Œå¹¶ä¸”è¿˜æœ‰åˆ«çš„è¿›ç¨‹å…±ç”¨CPUï¼Œæ‰€ä»¥å‘¢ï¼Œä¸å¥½å›ç­”ï¼Œæˆ‘ä¸€èˆ¬æ‹è„‘è¢‹å°±æ˜¯è®²çº¿ç¨‹æ± å¤§å°è®¾ç½®ä¸ºæ ¸çš„æ•°é‡ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1703033885,"ip_address":"å®‰å¾½","comment_id":385551,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"è¯·æ•™è€å¸ˆå‡ ä¸ªé—®é¢˜ï¼š\nQ1ï¼šç”¨notifyAllå”¤é†’æ‰€æœ‰çº¿ç¨‹ï¼Œä¸å¯¹å§ã€‚\nå‡å¦‚æœ‰5ä¸ªçº¿ç¨‹ï¼ŒconnectoråŒæ—¶å¯åŠ¨è¿™5ä¸ªçº¿ç¨‹ï¼Œ5ä¸ªçº¿ç¨‹å¤„äºwaitçŠ¶æ€ã€‚å‡è®¾æ­¤æ—¶æ¥äº†ä¸€ä¸ªè¿æ¥è¯·æ±‚ï¼Œç”±å…¶ä¸­çš„ä¸€ä¸ªçº¿ç¨‹Aå¤„ç†ï¼Œé‚£ä¹ˆï¼Œconnectoråº”è¯¥åªå”¤é†’è¿™çº¿ç¨‹Aå§ã€‚ç”¨notifyallä¼šå”¤é†’å…¨éƒ¨5ä¸ªçº¿ç¨‹ï¼Œéš¾é“5ä¸ªçº¿ç¨‹å¤„ç†åŒä¸€ä¸ªè¯·æ±‚å—ï¼Ÿ\n\nQ2ï¼šrecycleæ–¹æ³•æœ‰å¤šçº¿ç¨‹é—®é¢˜å—ï¼Ÿ\nå‡è®¾æœ‰5ä¸ªçº¿ç¨‹åœ¨å¤„ç†5ä¸ªè¯·æ±‚ï¼Œè¿™5ä¸ªçº¿ç¨‹éƒ½ä¼šè°ƒç”¨recycleæ–¹æ³•ï¼Œæ­¤æ—¶ä¼šå­˜åœ¨å¹¶å‘é—®é¢˜å—ï¼Ÿ\nQ3ï¼šçº¿ç¨‹æ± çš„å¤§å°ä¸€èˆ¬ä¸ºå¤šå¤§ï¼Ÿ\næœ‰ç»éªŒå…¬å¼å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634127,"discussion_content":"éƒ½æ˜¯å¥½é—®é¢˜ã€‚notifyallä¼šå”¤é†’å…¨éƒ¨ï¼Œä½†æ˜¯ä»£ç ä¸­ä¸€æ—¦æ ‡å¿—ä¸ç¬¦åˆå°±ä¼šç»§ç»­ç­‰å¾…ï¼Œä¸ä¼šå‡ºç°å‡ ä¸ªåŒæ—¶å¤„ç†ï¼Œä½ ä»”ç»†è·Ÿä»£ç ã€‚recycleæˆ‘ä¹Ÿè®¤ä¸ºä¼šå‡ºç°å¹¶å‘é—®é¢˜ï¼Œä½ è¿™ä¸ªè§‚å¯Ÿå¾ˆå¥½ï¼Œè¿™æ®µä»£ç å–è‡ªTomcat4æºä»£ç ï¼Œåº”è¯¥æ˜¯æœ‰é—®é¢˜ã€‚ çº¿ç¨‹æ± å¤§å°ï¼Œå¾ˆå¤æ‚ï¼Œå¤§å¸ˆä»¬æœ‰ä¸ªå…¬å¼ï¼Œä¾èµ–äºæ ¸è¿˜æœ‰è®¡ç®—æ—¶é—´ç­‰å¾…æ—¶é—´ï¼Œä½†æ˜¯å®é™…ç³»ç»Ÿå¤æ‚ï¼Œå¾ˆä¸å¥½ä¼°ç®—è®¡ç®—æ—¶é—´ç­‰å¾…æ—¶é—´ï¼Œå¹¶ä¸”è¿˜æœ‰åˆ«çš„è¿›ç¨‹å…±ç”¨CPUï¼Œæ‰€ä»¥å‘¢ï¼Œä¸å¥½å›ç­”ï¼Œæˆ‘ä¸€èˆ¬æ‹è„‘è¢‹å°±æ˜¯è®²çº¿ç¨‹æ± å¤§å°è®¾ç½®ä¸ºæ ¸çš„æ•°é‡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1703033885,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å®‰å¾½","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2704281,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/kgFgg4b6yribq8tSqAht0383fzoGSG9COPiaicLMzbdouGBrtJehiboqnJbbAiaNEtib1wYM9wAlAvCTZFUfYQDaElBA/132","nickname":"Geek_ac5e30","note":"","ucode":"D8349339D63A10","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":639155,"discussion_content":"è¿™é‡Œ notifyAll å’Œ notify æ²¡åŒºåˆ«çš„ï¼Œå› ä¸ºé”ä½çš„åªæœ‰ä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ª processor ä¸€ä¸ª connector ï¼Œ è¿™å°±æ˜¯ one to one çš„åœºæ™¯","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1710333154,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸­å›½é¦™æ¸¯","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1283181,"avatar":"https://static001.geekbang.org/account/avatar/00/13/94/6d/5cd6e8c7.jpg","nickname":"å¼ è´º","note":"","ucode":"0254E40FB3EB5F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634087,"discussion_content":"å›ç­”ä¸€ä¸‹ Q1: è¿™é‡Œæ¯ä¸ª processor å¯¹è±¡æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œwait é˜»å¡æ˜¯åœ¨ synchronized æ–¹æ³•ä¸­ï¼Œä¹Ÿå°±æ˜¯ åœ¨è¿™ä¸ªå¯¹è±¡é”çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œè¿™ä¸ªç­‰å¾…é˜Ÿåˆ—ä¸­åªæœ‰è¿™ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€ä»¥ notifyall ä¹Ÿåªä¼šé€šçŸ¥ç»™ä¸€ä¸ªçº¿ç¨‹ã€‚å¯ä»¥å‚è€ƒ java å¹¶å‘ç¼–ç¨‹å®æˆ˜ç¬¬å…­è¯¾ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1702982785,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1444698,"avatar":"https://static001.geekbang.org/account/avatar/00/16/0b/5a/453ad411.jpg","nickname":"C.","note":"","ucode":"5AE269220EFD73","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634043,"discussion_content":"å›ç­”ä¸€ä¸‹Q3ï¼š\nçº¿ç¨‹æ•° = CPU æ ¸å¿ƒæ•° *ï¼ˆ1+å¹³å‡ç­‰å¾…æ—¶é—´/å¹³å‡å·¥ä½œæ—¶é—´ï¼‰\nå¹³å‡å·¥ä½œæ—¶é—´ = æ‰§è¡Œä»»åŠ¡æ—¶é—´-æ‰€æœ‰çš„ç­‰å¾…æ—¶é—´\n- çº¿ç¨‹çš„å¹³å‡å·¥ä½œæ—¶é—´æ‰€å æ¯”ä¾‹è¶Šé«˜ï¼Œå°±éœ€è¦è¶Šå°‘çš„çº¿ç¨‹ï¼›\n- çº¿ç¨‹çš„å¹³å‡ç­‰å¾…æ—¶é—´æ‰€å æ¯”ä¾‹è¶Šé«˜ï¼Œå°±éœ€è¦è¶Šå¤šçš„çº¿ç¨‹ï¼›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1702954905,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ±Ÿè‹","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":388350,"user_name":"æ— å¿ƒ","can_delete":false,"product_type":"c1","uid":1405943,"ip_address":"å¹¿ä¸œ","ucode":"81CEB9F80C4675","user_header":"https://static001.geekbang.org/account/avatar/00/15/73/f7/d7581b65.jpg","comment_is_top":false,"comment_ctime":1709975568,"is_pvip":false,"replies":[{"id":141412,"content":"æ²¡åã€‚å°±æ˜¯ä¸€ä¸ªé—¸é—¨ï¼Œæ§åˆ¶ä¸¤è¾¹ã€‚çœ‹ä½ ä»å“ªé¢å»çœ‹è¿™ä¸ªé—®é¢˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1710131643,"ip_address":"æ¾³å¤§åˆ©äºš","comment_id":388350,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"avaliableçš„ ture å’Œ false è¯­æ„æ˜¯ä¸æ˜¯åäº†","like_count":0,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":638934,"discussion_content":"æ²¡åã€‚å°±æ˜¯ä¸€ä¸ªé—¸é—¨ï¼Œæ§åˆ¶ä¸¤è¾¹ã€‚çœ‹ä½ ä»å“ªé¢å»çœ‹è¿™ä¸ªé—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1710131643,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¾³å¤§åˆ©äºš","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2683430,"avatar":"https://static001.geekbang.org/account/avatar/00/28/f2/26/a8ac6b42.jpg","nickname":"å¬é£æœ‰ä¿¡","note":"","ucode":"2CCB467114FF5C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":654031,"discussion_content":"è¡¨ç¤ºæ˜¯å¦æœ‰ socket åœ¨ç”¨ã€‚ä¸æ˜¯ processor æ˜¯å¦å¯ç”¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1731723026,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":387188,"user_name":"Geek_b7bd01","can_delete":false,"product_type":"c1","uid":2438512,"ip_address":"å¹¿ä¸œ","ucode":"5585AF0A3D1797","user_header":"","comment_is_top":false,"comment_ctime":1706682098,"is_pvip":false,"replies":[{"id":141130,"content":"ç›´æ¥ä¸¢ç»™processorä¸è¡Œï¼Œç”Ÿäº§è€…æ¶ˆè´¹è€…ä¹‹é—´è¦åŒæ­¥ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1706919320,"ip_address":"æ¾³å¤§åˆ©äºš","comment_id":387188,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"ä¸ºä»€ä¹ˆconnectorè°ƒç”¨processor.assign()æ–¹æ³•ï¼Œè¿™æ ·ä¸ä¼šå¯¼è‡´connectorçº¿ç¨‹è¿›è¡Œç­‰å¾…å—ï¼Ÿä¸ºä½•ä¸ç›´æ¥å°†ä»»åŠ¡ä¸¢ç»™processorã€‚","like_count":0,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":636767,"discussion_content":"ç›´æ¥ä¸¢ç»™processorä¸è¡Œï¼Œç”Ÿäº§è€…æ¶ˆè´¹è€…ä¹‹é—´è¦åŒæ­¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1706919320,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¾³å¤§åˆ©äºš","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2292255,"avatar":"","nickname":"TKF","note":"","ucode":"167E911262E166","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":636823,"discussion_content":"ä½ èƒ½æ‹¿åˆ°processoråªä¼šæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯æ²¡å¤„ç†è¿‡è¯·æ±‚çš„ï¼Œä¸€ç§æ˜¯å¤„ç†è¿‡è¯·æ±‚åˆè¿˜å›queueé‡Œé¢çš„ï¼Œä¸ç®¡æ˜¯å“ªç§ï¼Œå®ƒæœ¬èº«éƒ½æ˜¯é˜»å¡åœ¨awaitæ–¹æ³•ä¸Šçš„ï¼Œavailableå˜é‡è‚¯å®šä¸ºfalseï¼Œè°ƒç”¨å®ƒçš„assignæ–¹æ³•å¹¶ä¸ä¼šå¯¼è‡´connnectorç­‰å¾…ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1707095990,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":387187,"user_name":"Geek_b7bd01","can_delete":false,"product_type":"c1","uid":2438512,"ip_address":"å¹¿ä¸œ","ucode":"5585AF0A3D1797","user_header":"","comment_is_top":false,"comment_ctime":1706681978,"is_pvip":false,"replies":[{"id":141129,"content":"å¹¶ä¸ä¼šç­‰processoræ‰§è¡Œå®Œï¼Œé‚£å°±æˆäº†ä¸²è¡Œäº†ã€‚äº’é”æœºåˆ¶è§£å†³ç”Ÿäº§è€…æ¶ˆè´¹è€…åŒæ­¥é—®é¢˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1706919269,"ip_address":"æ¾³å¤§åˆ©äºš","comment_id":387187,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"è¿™æ ·connectorä¸æ˜¯å¿…é¡»å¾—ç­‰å¾…processoræ‰§è¡Œå®Œæˆä¹‹åæ‰èƒ½ç»§ç»­å¾€ä¸‹èµ°å—ï¼Œä¸å½±å“æ•ˆç‡å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":636766,"discussion_content":"å¹¶ä¸ä¼šç­‰processoræ‰§è¡Œå®Œï¼Œé‚£å°±æˆäº†ä¸²è¡Œäº†ã€‚äº’é”æœºåˆ¶è§£å†³ç”Ÿäº§è€…æ¶ˆè´¹è€…åŒæ­¥é—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1706919269,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¾³å¤§åˆ©äºš","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385806,"user_name":"ctt","can_delete":false,"product_type":"c1","uid":1126661,"ip_address":"å¹¿ä¸œ","ucode":"FA87B9E86FD308","user_header":"https://static001.geekbang.org/account/avatar/00/11/31/05/9028e9ac.jpg","comment_is_top":false,"comment_ctime":1703415283,"is_pvip":false,"replies":[{"id":140595,"content":"å› ä¸ºæœ¬è´¨ä¸Šæ˜¯éœ€è¦æ‹¿å‡ºä¸€ä¸ªprocessor.åªæ˜¯æ²¡æœ‰çš„æ—¶å€™ä¼šä¸´æ—¶æ–°å»ºä¸€ä¸ªã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1703487395,"ip_address":"å¹¿ä¸œ","comment_id":385806,"utype":1}],"discussion_count":1,"race_medal":1,"score":2,"product_id":100636401,"comment_content":" HttpProcessor initprocessor = new HttpProcessor();       \n processors.push(initprocessor);        \ncurProcessors++;        \nreturn ((HttpProcessor) processors.pop());    è¯·é—®è¿™æ®µä»£ç ä¸ºä»€ä¹ˆpushå®Œå°±ç«‹å³popäº†å‘¢","like_count":0,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634420,"discussion_content":"å› ä¸ºæœ¬è´¨ä¸Šæ˜¯éœ€è¦æ‹¿å‡ºä¸€ä¸ªprocessor.åªæ˜¯æ²¡æœ‰çš„æ—¶å€™ä¼šä¸´æ—¶æ–°å»ºä¸€ä¸ªã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1703487395,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385582,"user_name":"C.","can_delete":false,"product_type":"c1","uid":1444698,"ip_address":"æ±Ÿè‹","ucode":"5AE269220EFD73","user_header":"https://static001.geekbang.org/account/avatar/00/16/0b/5a/453ad411.jpg","comment_is_top":false,"comment_ctime":1702951196,"is_pvip":false,"replies":[{"id":140509,"content":"ä½ çš„ç†è§£åŸåˆ™ä¸Šæ˜¯æ­£ç¡®çš„ã€‚å…·ä½“ä¸€ç‚¹ï¼Œjdkçº¿ç¨‹æ± æ ‡å‡†æ¨¡å¼å½“æ ¸å¿ƒçº¿ç¨‹æ•°è¶…è¿‡åç›´æ¥è¿›é˜Ÿåˆ—ï¼Œä¸æ˜¯æ–°å»ºçº¿ç¨‹ï¼Œè¿™ä¸ªæ–¹å¼ä¸é€‚åˆioå‹å¤šä»»åŠ¡ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1702969652,"ip_address":"åŒ—äº¬","comment_id":385582,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"Tomcat ä¸ºä»€ä¹ˆç”¨ä¸€ä¸ªç®€å•çš„ queue æ¥å®ç°å¤šçº¿ç¨‹è€Œä¸æ˜¯ç”¨ JDK è‡ªå¸¦çš„çº¿ç¨‹æ± ï¼Ÿ\n1.è‡ªå®šä¹‰å¯ä»¥æ›´å¥½åœ°æ§åˆ¶ï¼Œè¿˜æœ‰åæœŸçš„ä¼˜åŒ–\n2.å†å²åŸå› ï¼Œå¯èƒ½å½“æ—¶å†…ç½®çº¿ç¨‹æ± åŠŸèƒ½æ²¡é‚£ä¹ˆå®Œå–„\nç°åœ¨ï¼Œåº”è¯¥ä¹Ÿæ”¯æŒä½¿ç”¨JDKè‡ªå¸¦çš„çº¿ç¨‹æ± \n\näº¤ä¸ªä½œä¸šï¼šhttps:&#47;&#47;github.com&#47;caozhenyuan&#47;mini-tomcat","like_count":0,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634073,"discussion_content":"ä½ çš„ç†è§£åŸåˆ™ä¸Šæ˜¯æ­£ç¡®çš„ã€‚å…·ä½“ä¸€ç‚¹ï¼Œjdkçº¿ç¨‹æ± æ ‡å‡†æ¨¡å¼å½“æ ¸å¿ƒçº¿ç¨‹æ•°è¶…è¿‡åç›´æ¥è¿›é˜Ÿåˆ—ï¼Œä¸æ˜¯æ–°å»ºçº¿ç¨‹ï¼Œè¿™ä¸ªæ–¹å¼ä¸é€‚åˆioå‹å¤šä»»åŠ¡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1702969653,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2737559,"avatar":"https://static001.geekbang.org/account/avatar/00/29/c5/97/f043fb42.jpg","nickname":"Michael","note":"","ucode":"B296AE51768236","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":646909,"discussion_content":"å¦‚æœåœ¨ä½¿ç”¨ JDK çº¿ç¨‹æ± æ—¶ï¼ŒæŠŠ corePoolSize è®¾ç½®æˆè·Ÿ maxPoolSize ç›¸ç­‰ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥ä½¿ç”¨äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1718972310,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å››å·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385515,"user_name":"HHğŸ·ğŸ ","can_delete":false,"product_type":"c1","uid":1133678,"ip_address":"å¹¿ä¸œ","ucode":"C50172BDA604D5","user_header":"https://static001.geekbang.org/account/avatar/00/11/4c/6e/5435e214.jpg","comment_is_top":false,"comment_ctime":1702871395,"is_pvip":false,"replies":[{"id":140507,"content":"ç®€å•æ¥è®²ï¼Œjdkçº¿ç¨‹æ± ä½¿ç”¨æ™®é€šé˜Ÿåˆ—ï¼Œå½“å¹¶å‘ä»»åŠ¡æ•°è¶…è¿‡äº†æ ¸å¿ƒå¤§å°åï¼Œç›´æ¥è¿›é˜Ÿåˆ—ç­‰å¾…ï¼Œè¿™ç§æ–¹å¼æ¯”è¾ƒé€‚åˆCPUå‹å¤šä»»åŠ¡ã€‚ä½†æ˜¯servletçš„åº”ç”¨åœºæ™¯æ˜¯ioå‹çš„ï¼Œæ‰€ä»¥Tomcatè¦è‡ªå·±å®ç°ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ¯”è¾ƒç®€å•åœ°é‡å†™jdké˜Ÿåˆ—çš„offeræ–¹æ³•ï¼Œæ•°é‡æ²¡æœ‰è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°å°±è¿”å›falseï¼Œè®©çº¿ç¨‹æ± æ–°å»ºçº¿ç¨‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":1864890,"ctime":1702969218,"ip_address":"åŒ—äº¬","comment_id":385515,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100636401,"comment_content":"ğŸŒğŸŒè‡ªå¸¦JDKçº¿ç¨‹æ± åˆå§‹åŒ–æŒ‡å®šçº¿ç¨‹æ•°ï¼Œ å…±ç”¨è¿™äº›çº¿ç¨‹ï¼Œ å¯èƒ½è¿™æ¬¡åœ¨Açº¿ç¨‹æ‰§è¡Œï¼Œ ä¸‹æ¬¡åœ¨Bçº¿ç¨‹æ‰§è¡Œï¼Œä¸Šä¸‹æ–‡åˆ‡æ¥åˆ‡å»é€ æˆæ€§èƒ½ä¸å¿…è¦çš„å¼€é”€ï¼Œåœ¨ç½‘ç»œä¸­è¿™ç‚¹å¼€é”€ç®—æ˜¯å¾ˆå¤§äº†ã€‚ åªèƒ½æƒ³åˆ°è¿™ä¸ªç‚¹ï¼Œä¸çŸ¥é“æ˜¯å¦æ­£ç¡®","like_count":0,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634071,"discussion_content":"ç®€å•æ¥è®²ï¼Œjdkçº¿ç¨‹æ± ä½¿ç”¨æ™®é€šé˜Ÿåˆ—ï¼Œå½“å¹¶å‘ä»»åŠ¡æ•°è¶…è¿‡äº†æ ¸å¿ƒå¤§å°åï¼Œç›´æ¥è¿›é˜Ÿåˆ—ç­‰å¾…ï¼Œè¿™ç§æ–¹å¼æ¯”è¾ƒé€‚åˆCPUå‹å¤šä»»åŠ¡ã€‚ä½†æ˜¯servletçš„åº”ç”¨åœºæ™¯æ˜¯ioå‹çš„ï¼Œæ‰€ä»¥Tomcatè¦è‡ªå·±å®ç°ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥æ¯”è¾ƒç®€å•åœ°é‡å†™jdké˜Ÿåˆ—çš„offeræ–¹æ³•ï¼Œæ•°é‡æ²¡æœ‰è¾¾åˆ°æœ€å¤§çº¿ç¨‹æ•°å°±è¿”å›falseï¼Œè®©çº¿ç¨‹æ± æ–°å»ºçº¿ç¨‹ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1702969218,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":391710,"user_name":"å°æ ‘","can_delete":false,"product_type":"c1","uid":1293569,"ip_address":"ç¦å»º","ucode":"EB7656849D8F6C","user_header":"https://static001.geekbang.org/account/avatar/00/13/bd/01/9c6482df.jpg","comment_is_top":false,"comment_ctime":1718876309,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100636401,"comment_content":"æƒ³è¯·æ•™ä¸€ä¸‹è€å¸ˆï¼Œå®é™…ä¸Šæ˜¯ä¸æ˜¯ä¸ä¼šæœ‰ â€œå¦‚æœavailableæ ‡å¿—ä¸º trueï¼ŒConnetor çº¿ç¨‹å°±ç»§ç»­æ­»ç­‰â€è¿™ä¸ªæƒ…å†µå‘¢ã€‚\nå› ä¸ºæ¯ä¸ªprocessorçº¿ç¨‹çš„availableåˆå§‹æ˜¯falseçš„ï¼Œç­‰connectoræ¥æ”¶äº†æ–°è¿æ¥ã€assignäº†socketã€æ›´æ–°äº†availableå˜é‡ä»¥åï¼Œprocessoræ‰èƒ½æ‰§è¡Œï¼›processoræ‰§è¡Œå®Œäº†ä»¥åè¿™ä¸ªprocessorä¹Ÿå°±è¢«å›æ”¶äº†ï¼Œåˆè¿›å…¥äº†æ–°ä¸€è½®çš„ä¸Šè¿°è¿‡ç¨‹ã€‚\næ‰€ä»¥æˆ‘è§‰å¾—ï¼Œå¥½åƒæ°¸è¿œæ˜¯å„ä¸ªprocessorç­‰å¾…connectoræ¥æ‰§è¡Œassignï¼Œè€Œconnectorå®é™…å¹¶æ²¡æœ‰æœºä¼šè¿›å…¥åˆ°assigné‡Œçš„wait()çš„éƒ¨åˆ†ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":3790749,"avatar":"https://static001.geekbang.org/account/avatar/00/39/d7/9d/73390cc0.jpg","nickname":"wild wings.Luv","note":"","ucode":"D76D40B24B4998","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":651047,"discussion_content":"åŒé—®ï¼Œå‰é¢åœ¨åˆ›å»ºprocessoræ—¶å·²ç»ä¿è¯processoræ˜¯ç©ºé—²çŠ¶æ€çš„äº†ï¼Œæˆ‘ä¸æ˜¯å¾ˆç†è§£åŒæ­¥æœºåˆ¶çš„ä½œç”¨åœ¨å“ªé‡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1726127321,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":394212,"user_name":"wild wings.Luv","can_delete":false,"product_type":"c1","uid":3790749,"ip_address":"å¹¿ä¸œ","ucode":"D76D40B24B4998","user_header":"https://static001.geekbang.org/account/avatar/00/39/d7/9d/73390cc0.jpg","comment_is_top":false,"comment_ctime":1726127077,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100636401,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œçœ‹äº†æ‚¨çš„æ–‡ç« æ”¶è·æ»¡æ»¡ã€‚å…¶ä¸­å…³äºå¹¶å‘å¤„ç†è¯·æ±‚çš„æ¶æ„æˆ‘æœ‰ä¸€äº›é—®é¢˜ã€‚ç”±äºconnectorå’Œprocessoræ˜¯ä¸€å¯¹å¤šçš„å…³ç³»ï¼Œæ‰€ä»¥æ¯ä¸ªprocessorè¦å•ç‹¬ç»´æŠ¤è‡ªå·±çš„ä¿¡å·ï¼Œconnectoråœ¨åˆ†é…socketæ—¶ï¼Œè°ƒç”¨processorçš„åŒæ­¥å—assignã€‚ä½†æ˜¯è¿™ä¸ªåŒæ­¥è¿™é‡Œçš„ä»£ç æˆ‘å¥½åƒä¸æ˜¯å¾ˆç†è§£ã€‚connectorå’Œprocessorä¹‹é—´å®é™…ä¸Šæ²¡æœ‰â€åŒæ­¥çš„ç”Ÿäº§æ¶ˆè´¹å…³ç³»â€œï¼šé¦–å…ˆï¼ŒcreateProcessorå¤„æœ‰ç©ºä½™çš„processoræ—¶æ‰ä¼šåˆ†é…ç»™connectorï¼Œæ‰€ä»¥connectorå¹¶ä¸éœ€è¦ç­‰å¾…æŸä¸ªprocessoræ¶ˆè´¹å®Œäº†å†ç»™ä»–socketï¼Œå½“æ²¡æœ‰ç©ºä½™çš„processoræ—¶ç›´æ¥æ”¾å¼ƒå¤„ç†ï¼ˆè¿™é‡Œä¹Ÿæ˜¯æˆ‘è§‰å¾—è®¾è®¡çš„ä¸è¶³ä¹‹å¤„ï¼‰ã€‚å…¶æ¬¡ï¼Œprocessorä¸­çš„åŒæ­¥å—ä¹Ÿå¹¶ä¸æ˜¯ç­‰å¾…processorå¤„ç†å®Œè¯·æ±‚é‡Šæ”¾socketä¹‹åï¼Œæ‰æŠŠçŠ¶æ€è®¾ç½®ä¸ºfalseï¼Œè€Œæ˜¯æ‹¿åˆ°socketä¹‹åå°±é©¬ä¸Šæ›´æ”¹çŠ¶æ€ã€‚è¿™æ ·åšçš„ç›®çš„æˆ‘ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œä¹Ÿå°±æ˜¯è¿™æ ·çš„åŒæ­¥æœºåˆ¶ï¼Œæˆ‘æ²¡æœ‰ç†è§£åˆ°å®ƒçš„ç”¨å¤„ã€‚","like_count":0},{"had_liked":false,"id":394187,"user_name":"ç¬¦æ–¹ç»§","can_delete":false,"product_type":"c1","uid":3956001,"ip_address":"å¹¿ä¸œ","ucode":"B098BE802D2117","user_header":"https://static001.geekbang.org/account/avatar/00/3c/5d/21/afbecbd3.jpg","comment_is_top":false,"comment_ctime":1726066866,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100636401,"comment_content":"@Override public void run() { \nwhile (true) { \n                &#47;&#47; ç­‰å¾…åˆ†é…ä¸‹ä¸€ä¸ª \n               socket Socket socket = await(); \n               if (socket == null) continue; \n               &#47;&#47; å¤„ç†æ¥è‡ªè¿™ä¸ªsocketçš„è¯·æ±‚ process(socket);\n              &#47;&#47; å®Œæˆæ­¤è¯·æ±‚ connector.recycle(this); \n} \n}\nåœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹ï¼Œæ˜¯å¦è¦å¯¹socketçš„outputStreamäº’æ–¥ï¼Ÿå¦‚æœä¸€ä¸ªsocketå‘é€å¤šä¸ªè¯·æ±‚ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½è¿”å›æ•°æ®æ˜¯å¦ä¼šå‡ºç°ç²˜åŒ…ã€æ•°æ®é”™è¯¯ç­‰é—®é¢˜ï¼Ÿ\n","like_count":0},{"had_liked":false,"id":392796,"user_name":"__Alucard","can_delete":false,"product_type":"c1","uid":2625245,"ip_address":"æµ™æ±Ÿ","ucode":"8766ECCC8C7283","user_header":"https://static001.geekbang.org/account/avatar/00/28/0e/dd/4d468ad7.jpg","comment_is_top":false,"comment_ctime":1721805144,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100636401,"comment_content":"1.JDKçº¿ç¨‹æ± ä½¿ç”¨çš„é˜»å¡é˜Ÿåˆ—BlockingQueueæ˜¯å•å‘é˜Ÿåˆ—ï¼Œä¸æ”¯æŒåŒç«¯æ“ä½œï¼Œè€ŒTomcatä½¿ç”¨äº†Dequeä½œä¸ºåŒç«¯é˜Ÿåˆ—æ¥ä¼˜å…ˆä½¿ç”¨æ—§çš„çº¿ç¨‹ï¼Œå¹³è¡¡çº¿ç¨‹é—´çš„å·¥ä½œè´Ÿè½½ã€‚\n2.JDKçº¿ç¨‹æ± çš„å·¥ä½œé˜Ÿåˆ—æœºåˆ¶ä¸é€‚åˆä½œä¸ºWebServerå®¹å™¨æ¥å¤„ç†IOè¯·æ±‚ã€‚\n3.äº‹å®ä¸Šåˆ°è¿™ä¸€èŠ‚å·²ç»å‡ºç°äº†ç»å…¸çš„é€šä¿¡æ¨¡å‹çš„è®¾è®¡ï¼š å•çº¿ç¨‹(å¤šåç¨‹ï¼ŒIOæ“ä½œä¸Šä¸‹æ–‡å¼€é”€å°)å¤„ç†IOæ“ä½œï¼Œå¤šçº¿ç¨‹å¤„ç†åç»­çš„ä¸šåŠ¡é€»è¾‘ï¼ŒNettyä¹Ÿå‚è€ƒäº†è¿™ç§è®¾è®¡ã€‚","like_count":0},{"had_liked":false,"id":391811,"user_name":"chang","can_delete":false,"product_type":"c1","uid":1158800,"ip_address":"æµ™æ±Ÿ","ucode":"54CF3B7BC85297","user_header":"https://static001.geekbang.org/account/avatar/00/11/ae/90/83e0d28d.jpg","comment_is_top":false,"comment_ctime":1719146174,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100636401,"comment_content":"void recycle(HttpProcessor processor) {\n        processors.push(processor);\n    }\nè¿™é‡Œåº”è¯¥åŠ ä¸‹synchronizedï¼Œå¯èƒ½å¤šä¸ªçº¿ç¨‹å¤„ç†å®ŒåŒæ—¶å½’è¿˜","like_count":0}]}