{"id":86590,"title":"33 | æ•´æ•°çš„è¿ç®—æœ‰å“ªäº›å®‰å…¨å¨èƒï¼Ÿ","content":"<p>åœ¨æˆ‘çš„æ—¥å¸¸å·¥ä½œä¸­ï¼Œæœ‰ä¸€ç±»é”™è¯¯ï¼Œæ— è®ºæ˜¯åŸç†è¿˜æ˜¯åæœï¼Œæˆ‘éƒ½ååˆ†æ¸…æ¥šã€‚ä½†æ˜¯å†™ä»£ç çš„æ—¶å€™ï¼Œè¿™ç±»é”™è¯¯æ›¾ç»è¿˜æ˜¯ä¼šåå¤å‡ºç°ã€‚å¦‚æœä¸æ˜¯ä»£ç è¯„å®¡å’Œä»£ç åˆ†æç¯èŠ‚çš„æ ¡æ­£ï¼Œæˆ‘éƒ½å¾ˆéš¾æ„è¯†åˆ°è‡ªå·±çš„ä»£ç ä¸­å­˜åœ¨è¿™æ ·çš„ç¼ºé™·ã€‚ä»Šå¤©ï¼Œæˆ‘æƒ³å’Œä½ èŠèŠï¼Œé‚£äº›â€œ<strong>é“ç†æˆ‘éƒ½æ‡‚ï¼Œä½†ä»£ç å°±æ˜¯å†™ä¸å¥½</strong>â€çš„è€é¡½å›ºé—®é¢˜ã€‚</p><p>ä½ ä¸å¦¨å…ˆåœä¸‹æ¥æƒ³ä¸€æƒ³ï¼Œä½ æœ‰æ²¡æœ‰ç±»ä¼¼çš„ç»å†ï¼Ÿ åˆæ˜¯æ€ä¹ˆè§£å†³çš„å‘¢ï¼Ÿ</p><h2>è¯„å®¡æ¡ˆä¾‹</h2><p>HTTPè¿æ¥ç»å¸¸è¢«ä¸­æ–­æˆ–è€…å–æ¶ˆï¼Œå¦‚æœå®¢æˆ·ç«¯å·²ç»è·å¾—ä¸€éƒ¨åˆ†æ•°æ®ï¼Œå†æ¬¡è¿æ¥æ—¶ï¼Œåº”è¯¥å¯ä»¥è¯·æ±‚è·å–å‰©ä½™çš„æ•°æ®ï¼Œè€Œä¸æ˜¯å†æ¬¡è¯·æ±‚è·å–æ‰€æœ‰æ•°æ®ã€‚è¿™ä¸ªç‰¹æ€§èƒŒåçš„æ”¯æŒåè®®å°±æ˜¯HTTPèŒƒå›´è¯·æ±‚åè®®ï¼ˆRFC 7233ï¼‰ã€‚</p><p>æ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼Œå®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡å™¨è¿”å›image.jpgå›¾åƒçš„å‰1024ä¸ªå­—èŠ‚ã€‚å…¶ä¸­â€œbytes=0-1023â€è¡¨ç¤ºè¯·æ±‚ä¼ è¾“çš„æ•°æ®èŒƒå›´æ˜¯ä»0åˆ°ç¬¬1023ä½çš„å­—èŠ‚ï¼ˆ0-1023ï¼‰ï¼Œä»¥åŠâ€œ-512â€è¡¨ç¤ºè¯·æ±‚ä¼ è¾“æ•°æ®çš„æœ€å512ä¸ªå­—èŠ‚ï¼ˆ-512ï¼‰ã€‚</p><pre><code>GET /image.jpg HTTP/1.1\nHost: www.example.come\nRange: bytes=0-1023,-512\n</code></pre><p>å¦‚æœæœåŠ¡å™¨æ”¯æŒè¯¥åè®®ï¼Œå°±ä¼šåªä¼ è¾“å›¾åƒçš„æŒ‡å®šæ•°æ®æ®µã€‚å“åº”æ¶ˆæ¯çš„ä»£ç å¤§è‡´å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>HTTP/1.1 206 Partial Content\nContent-Type: multipart/byteranges; boundary=THIS_STRING_SEPARATES\nContent-Length: 2345\n\n--THIS_STRING_SEPARATES\nContent-Type: image/jpeg\nContent-Range: bytes 0-1023/2048\n...\n(binary content)\n\n--THIS_STRING_SEPARATES\nContent-Type: image/jpeg\nContent-Range: bytes 1535-2047/2048\n...\n(binary content)\n--THIS_STRING_SEPARATES--\n</code></pre><p>å¦‚æœæœåŠ¡å™¨ç«¯ä½¿ç”¨ä¸‹å±çš„ä»£ç éªŒè¯è¯·æ±‚æ•°æ®çš„æŒ‡å®šæ•°æ®æ®µï¼ˆCè¯­è¨€ï¼‰ï¼Œä½ æ¥çœ‹çœ‹å¯èƒ½å­˜åœ¨ä»€ä¹ˆä¸¥é‡çš„é—®é¢˜ï¼Ÿ</p><pre><code>/**\n * Check if the requested range is valid.\n *\n * start: the first byte position of the range request\n * end: the end byte position of the range request \n * contentLength: the content length of the requested data\n * sum: the sum of bytes of the range request\n */\nbool isValid(int start, int end, int contentLength, int* sum )) {\n    if (start &lt; end) {\n        *sum += end - start;\n        if (*sum &gt; contentLength) {\n            return false;\n        } else {\n            return true;\n        }\n    } else {\n        return false;\n    }\n}\n</code></pre><!-- [[[read_end]]] --><h2>æ¡ˆä¾‹åˆ†æ</h2><p>ä¸Šé¢çš„ä»£ç ç®€åŒ–è‡ªNginx HTTPæœåŠ¡å™¨å…³äºHTTPèŒƒå›´è¯·æ±‚åè®®åœ¨2017å¹´6æœˆä»½çš„å®ç°ç‰ˆæœ¬ã€‚ç”±äºè®¨è®ºçš„éœ€è¦ï¼Œæˆ‘è¾ƒå¤§å¹…åº¦åœ°åˆ å‡å’Œä¿®æ”¹äº†åŸæ¥çš„ä»£ç ã€‚å¦‚æœæœ‰å…´è¶£ï¼Œä½ å¯ä»¥é˜…è¯»å¹¶æ¯”è¾ƒ<a href=\"http://hg.nginx.org/nginx/file/e3723f2a11b7/src/http/modules/ngx_http_range_filter_module.c\">2017å¹´7æœˆä»½çš„å®ç°ç‰ˆæœ¬</a>å’Œ<a href=\"http://hg.nginx.org/nginx/file/aeaac3ccee4f/src/http/modules/ngx_http_range_filter_module.c\">2017å¹´6æœˆä»½çš„å®ç°ç‰ˆæœ¬</a>ï¼Œçœ‹çœ‹éƒ½æœ‰å“ªäº›æ¯”è¾ƒæœ‰æ„æ€çš„æ”¹åŠ¨ã€‚</p><p>ä¸Šé¢çš„ä»£ç æœ‰è®¸å¤šé—®é¢˜ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªè‡´å‘½çš„é­”é¬¼è—åœ¨ä¸‹é¢çš„ä¸€è¡Œä»£ç ä¸­ï¼š</p><pre><code>        *sum += end - start;\n</code></pre><p>æˆ‘ä»¬å‡è®¾æ•°æ®é•¿åº¦ä¸º1024ä¸ªå­—èŠ‚ï¼ŒHTTPè¯·æ±‚çš„èŒƒå›´æœ‰ä¸¤æ®µï¼Œç¬¬ä¸€æ®µçš„è¯·æ±‚å­—èŠ‚æ•°æ˜¯ä¸€ä¸ªæ­£å¸¸çš„æ•°æ® ï¼ˆæ¯”å¦‚ï¼Œ1023ï¼‰ï¼Œè€Œç¬¬äºŒæ®µçš„è¯·æ±‚å­—èŠ‚æ•°çš„æ˜¯ä¸€ä¸ªå·¨å¤§çš„æ•°æ®ï¼ˆæ¯”å¦‚ï¼ŒINT_MAX - 23ï¼‰ï¼Œä»¥è‡³äºä¸¤æ®µæ•°æ®ç›¸åŠ æ—¶ï¼Œå‘ç”Ÿäº†æ•´æ•°æº¢å‡ºã€‚æœ¬æ¥åº”è¯¥æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°ï¼Œå¯æ˜¯è¿™ä¸ªæ•°è¶…å‡ºäº†æ•´æ•°å¯ä»¥è¡¨è¾¾çš„èŒƒå›´ï¼Œç»“æœå°±å‘ç”Ÿæ•´æ•°æº¢å‡ºï¼Œå˜æˆäº†ä¸€ä¸ªå¾ˆå°çš„æ•° ï¼ˆæ¯”å¦‚ï¼Œï¼ˆ1023 + INT_MAX - 23ï¼‰ï¼Œç»“æœæ˜¯999æˆ–è€…-2147482649ã€‚è¿™æ ·å°±é€šè¿‡äº†ä¸Šè¿°çš„HTTPè¯·æ±‚èŒƒå›´éªŒè¯ã€‚</p><p>ç¬¬ä¸€æ®µæ•°æ®ä¹Ÿè®¸å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚ç„¶è€Œï¼Œç”±äºå®é™…çš„æ•°æ®é•¿åº¦ä¸è¶³ä»¥æ»¡è¶³ç¬¬äºŒæ®µæ•°æ®èŒƒå›´è¯·æ±‚ï¼Œå°±æœ‰å¯èƒ½å‡ºç°éå¸¸å¤æ‚çš„çŠ¶å†µã€‚ æ¯”å¦‚è¯´ï¼Œä¸ºäº†åŠ å¿«ååº”é€Ÿåº¦ï¼Œæé«˜æœåŠ¡å™¨æ•ˆç‡ï¼Œå¾ˆå¤šHTTPæœåŠ¡å™¨éƒ½ä½¿ç”¨äº†ç¼“å­˜æŠ€æœ¯ï¼ŒNginxä¹Ÿä¸ä¾‹å¤–ã€‚</p><p>å¦‚æœä½¿ç”¨ç¼“å­˜æŠ€æœ¯ï¼Œæ•°æ®å¯èƒ½å¹¶ä¸æ˜¯ç›´æ¥ä»åŸå§‹æ•°æ®æºè¯»å–ï¼Œè€Œæ˜¯è¯»å–ç¼“å­˜çš„æ•°æ®ï¼Œè€Œç¼“å­˜çš„æ•°æ®æ˜¯ä¸€ä¸ªä¸´æ—¶çš„å¤§é›†åˆï¼Œå¯èƒ½åŒ…æ‹¬å„ç§å„æ ·çš„æ•°æ®ï¼ŒåŒ…æ‹¬æ•æ„Ÿæ•°æ®ã€‚</p><p>å¦‚æœå‘ç”Ÿè¯»å–èŒƒå›´æº¢å‡ºï¼Œç›®æ ‡æ•°æ®æ®µä¹‹å¤–çš„ç¼“å­˜æ•°æ®å¯èƒ½è¢«è¯»å–ã€‚è€Œç›®æ ‡æ•°æ®æ®µä¹‹å¤–çš„æ•°æ®ï¼Œå¯èƒ½å¹¶æ²¡æœ‰æˆæƒç»™è¿™ä¸ªç”¨æˆ·ä½¿ç”¨ï¼Œè¿™æ ·å°±å¯èƒ½å‘ç”Ÿæ•æ„Ÿä¿¡æ¯çš„æ³„éœ²ã€‚ç”šè‡³é€šè¿‡è®¾è®¡ï¼Œæ”»å‡»è€…ä¹Ÿæœ‰å¯èƒ½æ›´æ”¹ç›®æ ‡æ•°æ®ä»¥å¤–çš„éæˆæƒæ•°æ®ã€‚è¿™æ ·å°±é—´æ¥åœ°æ“çºµäº†æœåŠ¡å™¨ã€‚</p><p>å…³äºè¿™ä¸ªå®‰å…¨æ¼æ´çš„æ›´å¤šæè¿°ï¼Œè¯·å‚é˜…<a href=\"https://nvd.nist.gov/vuln/detail/CVE-2017-7529\">CVE-2017-7529</a>ã€‚è¿™æ˜¯ä¸€ä¸ª<a href=\"https://www.first.org/cvss/\">é€šç”¨ç¼ºé™·è¯„åˆ†ç³»ç»Ÿ</a>è¯„åˆ†ä¸º<a href=\"https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:N/A:N\">7.5</a>çš„ä¸¥é‡å®‰å…¨ç¼ºé™·ã€‚ç”±äºNginxçš„å¹¿æ³›éƒ¨ç½²ä¸ä½¿ç”¨ï¼Œè¯¥æ¼æ´å½±å“äº†ä¸€å¤§æ‰¹å®‰è£…äº†NginxæœåŠ¡å™¨çš„ç³»ç»Ÿã€‚</p><p>å‡ºé—®é¢˜çš„è¡¨è¾¾å¼ä½¿ç”¨å¤ªæ™®éäº†ï¼Œè°èƒ½æƒ³åˆ°ä¼šå‡ºç°è¿™ä¹ˆä¸¥é‡çš„å®‰å…¨æ¼æ´å‘¢ã€‚æˆ‘ä»¬æ„Ÿå…´è¶£çš„é—®é¢˜æ˜¯ï¼š<strong>æ•´æ•°çš„åŠ æ³•ï¼Œå¦‚æ­¤æ™®éçš„è¿ç®—ï¼Œå¦‚æœéƒ½è¿™ä¹ˆè„†å¼±ï¼Œåˆ°åº•è¯¥æ€ä¹ˆåŠæ‰å¥½ï¼Ÿ</strong></p><h2>æ•´æ•°çš„é™·é˜±</h2><p>ä¸€ä¸ªä¼˜ç§€çš„è¯­è¨€ï¼Œä¸€å®šæ˜¯ä¾¿äºå­¦ä¹ å’Œä½¿ç”¨çš„è¯­è¨€ã€‚è¯­è¨€è¯­æ³•çš„è®¾è®¡é€šå¸¸ä¼šè€ƒè™‘æˆ‘ä»¬çš„ç°æœ‰ä¹ æƒ¯ï¼Œé™ä½ä½¿ç”¨é—¨æ§›ã€‚æ¯”å¦‚ï¼ŒåŠ æ³•è¿ç®—é€šå¸¸ä¼šè®¾è®¡æˆæˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„æ ·å­ï¼š</p><pre><code>  a = b + c;\n</code></pre><p>æˆ‘ä»¬å¦‚æ­¤ç†Ÿæ‚‰è¿™ç§è¡¨è¾¾å¼ï¼Œä¸€æ—¦éœ€è¦åŠ æ³•è¿ç®—ï¼Œè¿™ç§è¡¨è¾¾å¼ä¸€å®šé¦–å…ˆä»æˆ‘ä»¬çš„è„‘è¢‹é‡Œè‡ªåŠ¨è·³å‡ºæ¥ã€‚æˆ‘ä»¬æ¯«æ— å¯Ÿè§‰ï¼Œä¹Ÿä¸ä¼šæœ‰æ„è¯†åœ°å»è¿½ç©¶è¿™æ ·ä¸€ä¸ªä»å­¦ä¹ ç®—æ•°èµ·å°±å¼€å§‹ä½¿ç”¨çš„è¡¨è¾¾å¼åˆ°åº•æœ‰ä»€ä¹ˆé—®é¢˜ã€‚</p><p>é‚£ä¹ˆåˆ°åº•æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p><p>ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸Šè¿°è¡¨è¾¾å¼æ—¶ï¼Œæ¯ä¸ªæ•°å­—éƒ½å¯ä»¥æ˜¯æ— é™å¤§çš„ï¼›ç„¶è€Œåœ¨è®¡ç®—æœºçš„ä¸–ç•Œé‡Œï¼Œæ•°å­—å¤§å°éƒ½æ˜¯æœ‰é™åˆ¶çš„ã€‚æ¯”å¦‚ï¼Œæ•´æ•°ä¸€èˆ¬ä½¿ç”¨32ä½ï¼ˆbitï¼‰ï¼Œæˆ–è€…4ä¸ªå­—èŠ‚ï¼ˆbyteï¼‰æ¥è¡¨ç¤ºï¼Œæ•´æ•°çš„å¤§å°ä¸èƒ½è¶…è¿‡32ä½èƒ½å¤Ÿå®¹çº³çš„èŒƒå›´ã€‚</p><h3>æ•´æ•°è¿ç®—ï¼Œå¯èƒ½æº¢å‡º</h3><p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨ä¸€ä½ï¼ˆbitï¼‰æ¥è¡¨è¾¾ä¸€ä¸ªæ•´æ•°ï¼Œé‚£ä¹ˆé€šå¸¸å°±ä¼šæ˜¯ä¸‹é¢è¿™ç§æƒ…å†µï¼š</p><pre><code> 0 + 0 = 0\n 0 + 1 = 1\n 1 + 1 = 0\n</code></pre><p>æ³¨æ„ï¼Œ1 + 1çš„ç»“æœä¸æ˜¯æˆ‘ä»¬ä¹ ä»¥ä¸ºå¸¸çš„2ï¼Œè€Œæ˜¯0ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ å› ä¸º2å¤ªå¤§äº†ï¼Œä¸€ä½çš„ç©ºé—´ä¸å¤Ÿç”¨çš„ï¼Œæ‰€ä»¥å°±â€œæº¢å‡ºâ€äº†ã€‚â€œæº¢å‡ºâ€å¯¼è‡´è¿™ä¸ªè¿ç®—çš„ç»“æœæ˜¯0ï¼Œè€Œä¸æ˜¯é¢„æƒ³çš„2ã€‚</p><p>å†æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬è¡¨ç¤ºæ—¶é—´çš„æ—¶å€™ï¼Œå¦‚æœé‡‡ç”¨12å°æ—¶åˆ¶ï¼Œ12ç‚¹è¿‡ä¸€ä¸ªå°æ—¶å°±æ˜¯1ç‚¹ï¼Œè€Œä¸æ˜¯13ç‚¹ï¼›å¦‚æœé‡‡å–24å°æ—¶åˆ¶ï¼Œ24ç‚¹è¿‡ä¸¤ä¸ªå°æ—¶å°±æ˜¯2ç‚¹é’Ÿï¼Œè€Œä¸æ˜¯26ç‚¹ã€‚</p><p>å¦‚æœæˆ‘ä»¬å¯¹äºä¸€ä½çš„æ•°ï¼Œä»¥åŠ24å°æ—¶åˆ¶è¿˜ç®—â€œæ¸…é†’â€çš„è¯ï¼Œé‚£ä¹ˆå¯¹äº32ä½æˆ–è€…64ä½çš„æ•°ï¼Œå¯èƒ½å°±æ²¡é‚£ä¹ˆé‡è§†äº†ã€‚ä½ çš„ä»£ç é‡Œæœ‰æ²¡æœ‰æ¶‰åŠåˆ°æ•´æ•°çš„è¿ç®—ï¼Ÿæœ‰æ²¡æœ‰æ½œåœ¨çš„æº¢å‡ºé—®é¢˜ï¼Ÿ æˆ‘æ˜¯ç»å¸¸ä¼šæ‰å…¥è¿™ä¸ªé™·é˜±çš„ã€‚</p><p>æ•´æ•°æº¢å‡ºçš„é—®é¢˜ï¼Œæ›¾ç»åœ¨1995å¹´å¯¼è‡´<a href=\"https://around.com/ariane.html\">ç«ç®­çš„å è½</a>ï¼› åœ¨2016å¹´å¯¼è‡´<a href=\"https://arstechnica.com/tech-policy/2017/06/sorry-maam-you-didnt-win-43m-there-was-a-slot-machine-malfunction/\">é”™è¯¯åœ°ç­¾å‘äº†å››åƒå¤šä¸‡ç¾å…ƒï¼ˆæœ€é«˜é™é¢åŸä¸º1ä¸‡ç¾å…ƒï¼‰çš„åšå½©å¥–åˆ¸</a>ã€‚è¿˜æœ‰ç»µå»¶ä¸ç»çš„ï¼Œä½ æˆ‘çŸ¥é“æŠ‘æˆ–ä¸çŸ¥é“çš„è½¯ä»¶å®‰å…¨æ¼æ´ã€‚</p><p>æˆ‘ä»¬æ›´å…³å¿ƒçš„æ˜¯ï¼Œè¯¥æ€ä¹ˆé¿å…è¿™ç±»é”™è¯¯ï¼Ÿ</p><p><strong>é¦–å…ˆæœ€é‡è¦çš„ï¼Œæ˜¯è¦å€ŸåŠ©è½¯ä»¶å¼€å‘çš„æœºåˆ¶ï¼Œå‡å°‘ä»£ç é”™è¯¯</strong>ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨ä¸“æ å¼€å§‹è®²çš„<a href=\"https://time.geekbang.org/column/article/76349\">å€ŸåŠ©é‡é‡å…³å¡</a>å‡å°‘é”™è¯¯ã€‚è™½ç„¶æˆ‘åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™ä¼šæ—¶å¸¸å¿˜å´è¿™ä¸ªé—®é¢˜ï¼Œä½†åœ¨è¯„å®¡ä»£ç æ—¶ï¼Œæœ‰æ—¶å€™è¿˜èƒ½å¤Ÿè®°ä½è¿™ä¸ªé—®é¢˜çš„å±å®³ã€‚å¤šä¸€åŒçœ¼ç›ï¼Œå°±å¤šäº†ä¸€å¤„å…³å¡ã€‚</p><p>ç„¶åï¼Œè¿˜è¦äº†è§£ä¸€äº›å°æŠ€å·§ï¼Œæˆ‘ä»¬çœ‹çœ‹éƒ½æœ‰å“ªäº›ï¼Ÿ</p><p>1.<strong>æ¯”è¾ƒè¿ç®—ï¼Œé€‰æ‹©â€œæ¯”è¾ƒå°çš„æ•°â€</strong>ã€‚</p><p>å¦‚æœè¡¨è¾¾å¼å‡ºç°åœ¨æ¯”è¾ƒè¿ç®—ç¬¦çš„ä¸¤ä¾§ï¼Œé€‰æ‹©äº§ç”Ÿè¾ƒå°çš„æ•°çš„è¿ç®—ã€‚æ¯”å¦‚ä¸‹é¢è¿™æ®µä»£ç ï¼š</p><pre><code>// a, b, c are positive integers\nif (a &lt; (b + c)) {    // (b + c) can overflow\n    // snipped\n}\n \n// a, b, c are positive integers\nif ((a - b) &lt; c) {    //  no overflow\n    // snipped\n}\n</code></pre><p>è¿™ä¸ªä¾‹å­é€‚ç”¨äºæ­£æ•°çš„è¿ç®—ï¼Œå¦‚æœæ˜¯è´Ÿæ•°å‘¢ï¼Ÿ å¦‚æœä¸ç¡®å®šæ˜¯æ•´æ•°è¿˜æ˜¯è´Ÿæ•°ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ç•™ç»™ä½ å»æ€è€ƒã€‚</p><p>2.<strong>é™å®šæ•°çš„èŒƒå›´ï¼Œé€‰æ‹©å†—ä½™çš„ç©ºé—´</strong>ã€‚</p><p>å¦‚æœç°å®éœ€è¦32ä½çš„æ•´æ•°ï¼Œå°±é€‰æ‹©64ä½çš„å­˜å‚¨ç©ºé—´ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨64ä½çš„æ•´æ•°ç±»å‹ï¼‰è¿›è¡Œè¿ç®—ã€‚å¦‚æœç°å®éœ€è¦31ä½çš„æ•´æ•°ï¼Œå°±é€‰æ‹©32ä½çš„å­˜å‚¨ç©ºé—´ã€‚é™å®šäº†æ•°çš„èŒƒå›´ï¼Œä¸€å®šè¦è®°å¾—æ£€æŸ¥æ•°æ®çš„èŒƒå›´ï¼Œåƒä¸‡ä¸å¯è¶…è¶Šè¿™ä¸ªèŒƒå›´ã€‚</p><pre><code>private static int MAX_DATA_SIZE = 16384;  // 2^14 bytes at mosts\nprivate final ByteBuffer cache =\n    ByteBuffer.allocate)(MAX_DATA_SIZE);   // limit the capacity\n\nstatic int receive(byte[] data) {\n    if (data == null || data.length == 0) {    // input check\n        // snipped\n    } else if (data.length &gt; MAX_DATA_SIZE) {  // check the range\n        // throw exception, snipped\n    } else {\n        if (data.length &gt; cache.remaining()) { // check the add-up\n            // throw exception, insufficient space, too much data\n        }\n\n        if ((data.length + 1024) &gt; cache.remaining()) {\n            // safe '+', as the numbers are limited to 2^14.\n            // snipped\n        }\n\n        // snipped\n    }\n    // snipped\n}    \n</code></pre><p>ä¸Šé¢ä¾‹å­ä¸­çš„åŠ æ³•è¿ç®—å°±æ˜¯å®‰å…¨çš„ã€‚å› ä¸ºè¿ç®—æ¶‰åŠçš„æ•°æ®éƒ½è¢«é™å®šåœ¨14ä½èŒƒå›´å†…ï¼Œè€Œä¸¤ä¸ªæ•°ç›¸åŠ ï¼Œæœ€å¤šä¸è¶…è¿‡15ä½ã€‚ç”±äºæˆ‘ä»¬ä½¿ç”¨äº†32ä½çš„æ•´æ•°ä½œä¸ºæ•°æ®çš„ç±»å‹ï¼Œé‚£ä¹ˆ15ä½çš„æ•°æ®å°±ä¸ä¼šäº§ç”Ÿæº¢å‡ºé—®é¢˜ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ³•è¦æ±‚æˆ‘ä»¬æ—¶åˆ»ç»·ç´§ç¥ç»ï¼Œä»”ç»†åœ°å®šä¹‰ã€æ£€æŸ¥æ¯ä¸ªæ•°æ®çš„é™å®šèŒƒå›´ï¼Œå¯¹æˆ‘ä»¬è‡ªèº«è¦æ±‚ç›¸å¯¹æœ‰ç‚¹é«˜ã€‚æ‰€ä»¥æ¶‰åŠåˆ°æ¯”è¾ƒè¿ç®—ï¼Œæˆ‘è¿˜æ˜¯å»ºè®®ä½¿ç”¨â€œæ¯”è¾ƒå°çš„æ•°â€çš„åŠæ³•ã€‚</p><pre><code>-           if ((data.length + 1024) &gt; cache.remaining()) {\n+           if ((data.length - cache.remaining()) &gt; 1024) {\n</code></pre><p>3.<strong>æ£€æŸ¥æ•°æ®æº¢å‡º</strong>ã€‚</p><p>æ£€æŸ¥æ•°æ®æº¢å‡ºï¼Œè™½ç„¶ä»£ç çœ‹èµ·æ¥æœ‰ç‚¹å¤šï¼Œä½†è¿™æ€»æ˜¯ä¸€ä¸ªæœ‰æ•ˆå¯è¡Œçš„åŠæ³•ã€‚æ¯”å¦‚ï¼Œè¯„å®¡æ¡ˆä¾‹ä¸­çš„ç¼ºé™·ä¿®å¤ï¼Œå°±é‡‡å–äº†ç±»ä¼¼å¦‚ä¸‹çš„ä¿®æ”¹ï¼š</p><pre><code>+       if (*sum &gt; (NGX_MAX_OFF_T_VALUE - (end - start))) {\n+           return false;\n+       }\n        *sum += end - start;\n</code></pre><p>ä»Java 8å¼€å§‹ï¼ŒJavaæä¾›äº†æ•°æ®æº¢å‡ºä¿æŠ¤çš„è¿ç®—æ–¹æ³•ï¼Œæ¯”å¦‚Math.addExact(int, int)ï¼Œæ‰§è¡Œä¸¤ä¸ªæ•´æ•°ç›¸åŠ çš„è¿ç®—ï¼Œå¦‚æœæœ‰æ•´æ•°æº¢å‡ºï¼Œå°±ä¼šæŠ›å‡ºArithmeticExceptionçš„å¼‚å¸¸ã€‚è¿™äº›æ–¹æ³•ä¹Ÿè®¸å¹¶ä¸å¦‚ç›´æ¥ä½¿ç”¨è¿ç®—ç¬¦ç›´è§‚ï¼Œä½†æ˜¯å®ƒä»¬æä¾›äº†é¢å¤–çš„ä¿æŠ¤æœºåˆ¶ã€‚å¦‚æœæˆ‘ä»¬ä¸èƒ½ç¡®å®šæº¢å‡ºæ˜¯å¦ä¼šå‘ç”Ÿï¼Œä½¿ç”¨è¿™äº›æ–¹æ³•å¯ä»¥è®©æˆ‘ä»¬çš„ä»£ç è·å¾—æ›´åŠ æ·±åº¦çš„ä¿æŠ¤ã€‚</p><pre><code>    int sum = Math.addExact(a, b);   // sum = a + b\n</code></pre><p>æ•´æ•°æº¢å‡ºçš„å±å®³æ˜¯æ•´æ•°å¤ªå¤§äº†ï¼Œè¶…å‡ºäº†è®¸å¯è¾¹ç•Œã€‚å¦‚æœæ•´æ•°è¿˜æ²¡æœ‰å¤§åˆ°æº¢å‡ºçš„ç¨‹åº¦ï¼Œä½†ä¹Ÿè¶³å¤Ÿå¤§ï¼ŒåŒæ ·æ˜¯ä¸€ä¸ªå€¼å¾—è­¦æƒ•çš„é£é™©ã€‚</p><p>å…¶ä»–çš„è¯­è¨€ä¹Ÿå¯èƒ½æœ‰ç±»ä¼¼çš„æ•°æ®æº¢å‡ºä¿æŠ¤æ–¹æ³•ï¼Œæ¬¢è¿ä½ åœ¨è¯„è®ºåŒºç•™è¨€åˆ†äº«ã€‚</p><h3>æ•´æ•°ï¼Œå¯èƒ½å¤ªå¤§</h3><p>ä¸æ¯”æ•°å­¦ä¸–ç•Œé‡Œçš„æ•´æ•°ï¼Œè½¯ä»¶ä¸–ç•Œé‡Œçš„æ•´æ•°ï¼Œå¤§éƒ½å…·æœ‰ç°å®çš„æ„ä¹‰ã€‚ æ¯”å¦‚ï¼Œæ•´æ•°å¯ä»¥ä»£è¡¨äººæ°‘å¸ï¼Œå¯ä»¥ä»£è¡¨ç¾å…ƒï¼Œä¹Ÿå¯ä»¥ä»£è¡¨æ–‡ä»¶é•¿åº¦ï¼Œä»£è¡¨å†…å­˜ç©ºé—´ï¼Œä»£è¡¨è¿ç®—èƒ½åŠ›ã€‚ <strong>ä¸€æ—¦æŠ½è±¡çš„æ•´æ•°è¢«èµ‹äºˆäº†ç°å®æ„ä¹‰ï¼Œå°±ä¼šæœ‰ç°å®çš„çº¦æŸ</strong>ã€‚æ¯”å¦‚ï¼Œ1äº¿å…ƒäººæ°‘å¸è™½ç„¶æ˜¯ä¸ªå°ç›®æ ‡ï¼Œä½†ä½ è¦æ˜¯ç”¨æ¥å‘äººæ‰‹ä¸€ä»½çš„çº¢åŒ…ï¼Œä¹Ÿè®¸å°±æœ‰ç‚¹å¤§äº†ã€‚å†æ¯”å¦‚ï¼Œé’ˆå¯¹32ä½æ•´æ•°ï¼Œè™½ç„¶ç°ä»£è®¡ç®—æœºå·²ç»å¯ä»¥æ¯«æ— éšœç¢åœ°è¡¨è¾¾è¿™ä¸ªæ•°æ®äº†ï¼Œä½†è¦æ˜¯ç”¨æ¥åˆ†é…åº”ç”¨å†…å­˜ï¼Œè¿™ä¸ªæ•°å°±æœ‰ç‚¹å¤§äº†ã€‚</p><p>æˆ‘ä»¬è¦ç‰¹åˆ«è­¦æƒ•å¤§é‡å†…å­˜çš„åŠ¨æ€åˆ†é…ã€‚æ¯”å¦‚è¯´å¾ˆå¤šåè®®çš„è®¾è®¡éƒ½ä¼šæŒ‡å®šå¾…ä¼ è¾“æ•°æ®çš„å¤§å°ï¼Œè€Œæ¥æ”¶ç«¯éœ€è¦æŒ‰ç…§æŒ‡å®šçš„å¤§å°æ¥æ¥æ”¶ç´§æ¥ç€çš„æ•°æ®æµã€‚æœ‰æ—¶å€™éœ€è¦åˆ†é…å†…å­˜ï¼Œæ¥å­˜å‚¨ã€å¤„ç†æ¥æ”¶çš„æ•°æ®ã€‚å…¶ä¸­æœ‰ä¸€ç§å®ç°ï¼Œæ¥æ”¶åˆ°æŒ‡å®šå¤§å°çš„æ•°æ®åï¼Œæ¥æ”¶ç«¯å†æ ¹æ®æŒ‡å®šçš„å¤§å°åˆ†é…å†…å­˜ï¼Œç„¶åæŠŠåç»­çš„æ•°æ®å­˜å‚¨åœ¨è¯¥å†…å­˜é‡Œã€‚æŒ‡å®šæ•°æ®æ¥æ”¶å®Œæ¯•ï¼Œå†å¼€å§‹å¤„ç†è¯¥æ•°æ®ã€‚ä½ çœ‹å‡ºå…¶ä¸­çš„é—®é¢˜äº†å—ï¼Ÿ</p><p>ä¸€ä¸ªæ¯”è¾ƒå…¸å‹çš„å®‰å…¨æ”»å‡»æ˜¯ï¼Œæ”»å‡»è€…ä¼šè®¾ç½®éå¸¸å¤§çš„å¾…ä¼ è¾“æ•°æ®çš„å¤§å°ï¼ˆæ¯”å¦‚2^31)ï¼Œä½†æ˜¯åªä¼ è¾“éå¸¸å°çš„æ•°æ®ï¼ˆæ¯”å¦‚1ä¸ªå­—èŠ‚ï¼‰ï¼Œç„¶ååœ¨å¾ˆçŸ­çš„æ—¶é—´å†…ï¼Œå‘é€å¤šä¸ªè¯·æ±‚ï¼ˆä¸€ä¸ªæœºå™¨æˆ–è€…å¤šä¸ªæœºå™¨ï¼‰ã€‚ä¸€ä¸ª16Gå†…å­˜çš„æœåŠ¡å™¨ï¼Œå¦‚æœæœ‰8ä¸ªè¿™æ ·çš„è¯·æ±‚ï¼Œå†…å­˜å°±çº¢ç¯é«˜æŒ‚äº†ï¼›æœ‰10ä¸ªè¿™æ ·çš„è¯·æ±‚ï¼Œå†…å­˜å¯èƒ½å°±è¦æŒ‚å…æˆ˜ç‰Œäº†ã€‚è¿™å°±ç ´åäº†æœåŠ¡å™¨çš„â€œå¯ç”¨æ€§â€ï¼Œç®—æ˜¯æ¯”è¾ƒä¸¥é‡çš„å®‰å…¨äº‹æ•…ã€‚</p><p>å¥½äº†ï¼Œè¿™å°±æ˜¯ä»Šå¤©çš„å†…å®¹ï¼Œç®—æ˜¯å…³äºæ•°çš„é—®é¢˜çš„æ•²é—¨ç –ï¼Œæ›´å¤šçš„ã€æ›´æ·±å…¥çš„è¯é¢˜ï¼Œå¯ä»¥é˜…è¯»<a href=\"https://cwe.mitre.org/data/definitions/190.html\">CWE-190</a>ï¼Œæˆ–è€…ç•™è¨€ä¸æˆ‘ä¸€èµ·è®¨è®ºã€‚</p><h2>å°ç»“</h2><p>é€šè¿‡å¯¹è¿™ä¸ªè¯„å®¡æ¡ˆä¾‹çš„è®¨è®ºï¼Œæˆ‘æƒ³å’Œä½ åˆ†äº«ä¸‹é¢å‡ ç‚¹ä¸ªäººçœ‹æ³•ã€‚</p><ol>\n<li>\n<p>æ•°å€¼è¿ç®—ï¼Œç†è®ºç»“æœå¯èƒ½ä¼šè¶…å‡ºæ•°å€¼ç±»å‹è®¸å¯çš„ç©ºé—´ï¼Œè¿›è€Œå‘ç”Ÿå®é™…ç»“æœçš„æº¢å‡ºã€‚</p>\n</li>\n<li>\n<p>æŠ½è±¡çš„æ•°æ®ä¸€æ—¦æœ‰äº†ç°å®æ„ä¹‰ï¼Œä¾¿æœ‰äº†å…·ä½“çš„ç°å®çº¦æŸï¼Œæˆ‘ä»¬ä¸€å®šè¦è€ƒè™‘è¿™äº›çº¦æŸã€‚</p>\n</li>\n<li>\n<p>å¾ˆå¤šé—®é¢˜å’Œæˆ‘ä»¬çš„ä¹ æƒ¯å¹¶ä¸ç›¸ç¬¦ï¼Œè¦é€šè¿‡åˆ¶åº¦è®¾ç½®æ¥å‡å°‘ç”±äºäººçš„å›ºæœ‰ç¼ºé™·å¸¦æ¥çš„ç»å¸¸æ€§é—®é¢˜ã€‚</p>\n</li>\n</ol><h2>ä¸€èµ·æ¥åŠ¨æ‰‹</h2><p>æˆ‘ä»¬ä¸€èµ·è®¨è®ºäº†ä¸€äº›æ•´æ•°çš„é—®é¢˜ï¼Œä½ æ„¿ä¸æ„¿æ„æ€»ç»“ä¸‹æµ®ç‚¹æ•°çš„é—®é¢˜ï¼Ÿ æˆ‘ä»¬ä½¿ç”¨äº†Cè¯­è¨€å’ŒJavaè¯­è¨€çš„ç¤ºä¾‹ï¼Œä½ äº†è§£å…¶ä»–è¯­è¨€å…³äºæ•´æ•°æº¢å‡ºçš„æŠ€æœ¯å’Œç»éªŒå—ï¼Ÿ</p><p>æ¬¢è¿ä½ æ¥è¯„å®¡ä¸‹é¢çš„è¿™æ®µCè¯­è¨€ä»£ç ï¼š</p><pre><code>int copy_something(char* buf, int len){\n    char kbuf[800];\n\n    if(len &gt; sizeof(kbuf)){\n        return -1;\n    }\n\n    return memcpy(kbuf, buf, len);\n}\n</code></pre><p>æˆ–è€…è¿™æ®µJavaä»£ç ï¼š</p><pre><code>public static int mixed(int addOn, int multiplied, int scale) {\n    return addOn + (multiplied * scale);\n}\n</code></pre><p>æˆ–è€…ï¼Œæ˜¯ä¸‹é¢è¿™æ®µæˆ‘ä»¬å·²ç»éå¸¸ç†Ÿæ‚‰çš„Javaä»£ç ï¼š</p><pre><code>import java.util.HashMap;\nimport java.util.Map;\n\nclass Solution {\n    /**\n     * Given an array of integers, return indices of the two numbers\n     * such that they add up to a specific target.\n     */\n    public int[] twoSum(int[] nums, int target) {\n        Map&lt;Integer, Integer&gt; map = new HashMap&lt;&gt;();\n        for (int i = 0; i &lt; nums.length; i++) {\n            int complement = target - nums[i];\n            if (map.containsKey(complement)) {\n                return new int[] { map.get(complement), i };\n            }\n            map.put(nums[i], i);\n        }\n        throw new IllegalArgumentException(&quot;No two sum solution&quot;);\n    }\n}\n</code></pre><p>é’ˆå¯¹ä¸Šé¢ä¸‰æ®µä»£ç ï¼Œä½ æœ‰ä»€ä¹ˆæ”¹è¿›çš„å»ºè®®å‘¢ï¼Ÿå¯ä»¥åœ¨è¯„è®ºåŒºä¸æˆ‘åˆ†äº«ä½ çš„æƒ³æ³•ã€‚</p><p>å¦å¤–ï¼Œåˆ†äº«ä¸€ä¸ªæœ€è¿‘ï¼ˆ2019å¹´3æœˆï¼‰å‘ç”Ÿçš„å’Œæ•´æ•°æœ‰å…³çš„å®‰å…¨äº‹æ•…ã€‚</p><p>å®‰å…¨èµ·è§ï¼Œä¸€ä¸ªæ•°å­—è¯ä¹¦çš„åºåˆ—å·åº”è¯¥è‡³å°‘æœ‰64ä½éšæœºæ•°ï¼Œå°‘ä¸€ä½éƒ½ä¸è¡Œã€‚å¦‚æœä½ å¯¹æ•´æ•°è¶³å¤Ÿæ•æ„Ÿçš„è¯ï¼Œå°±ä¼šçŸ¥é“64ä½æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ä½æ•°ã€‚é•¿æ•´å‹ï¼ˆlongï¼‰é€šå¸¸ä½¿ç”¨64ä½å­—èŠ‚æ¥è¡¨è¿°ã€‚æ•°å­—è¯ä¹¦çš„åºåˆ—å·èƒ½ä¸èƒ½ä½¿ç”¨64ä½çš„é•¿æ•´å‹å‘¢ï¼Ÿè¿™å°±æ˜¯ä¸ªå‘ï¼</p><p>ä¸ºäº†ä¿è¯åºåˆ—å·æ˜¯æ­£æ•°ï¼Œ64ä½çš„é•¿æ•´å‹ï¼Œåªæœ‰63ä½æœ‰æ•ˆçš„æ•°å­—ã€‚å› ä¸ºï¼Œ64ä½é•¿æ•´å‹ä¸­ï¼Œæœ‰ä¸€ä½æ˜¯ç”¨æ¥è¡¨ç¤ºæ•°æ®æ­£è´Ÿçš„ã€‚æ‰€ä»¥ï¼Œé•¿æ•´å‹å°±ä¸èƒ½ç”¨åšæ•°å­—è¯ä¹¦çš„åºåˆ—å·ã€‚</p><p>è¿™ä¸ªå‘ï¼Œå°±æ˜¯æœ‰äººè¸©äº†ã€‚æœ‰æ•°ç™¾ä¸‡å¼ æ•°å­—è¯ä¹¦ä»…ä½¿ç”¨äº†63ä½çš„éšæœºæ•°ã€‚æŒ‰ç…§ä¸šç•Œè§„åˆ™ï¼Œè¿™äº›æ•°å­—è¯ä¹¦éœ€è¦é—®é¢˜å‘ç°5å¤©ä»¥å†…æ’¤é”€ï¼Œé‡æ–°ç­¾å‘ã€‚è¿™å‡ ä¹æ˜¯ä¸€é¡¹ä¸å¯èƒ½å®Œæˆçš„ä»»åŠ¡ã€‚2019å¹´3æœˆå’Œ4æœˆï¼Œå¾ˆå¤šå…¬å¸éƒ½ä¼šé¢ä¸´æ•°å­—è¯ä¹¦æ›´æ–°çš„é—®é¢˜ã€‚</p><p>å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰æ‰€å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹å‡»â€œè¯·æœ‹å‹è¯»â€ï¼ŒæŠŠå®ƒåˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–è€…åŒäº‹ï¼Œä¸€èµ·æ¥äº¤æµã€‚</p><p></p>","comments":[{"had_liked":false,"id":77924,"user_name":"hua168","can_delete":false,"product_type":"c1","uid":1065255,"ip_address":"","ucode":"CFF9A7E86EBA48","user_header":"https://static001.geekbang.org/account/avatar/00/10/41/27/3ff1a1d6.jpg","comment_is_top":false,"comment_ctime":1553042499,"is_pvip":false,"replies":[{"id":"28751","content":"å—¯ï¼Œä»Šå¤©å­¦åˆ°æ–°ä¸œè¥¿äº†ï¼Œæˆ‘ä»¥å‰æ²¡æœ‰æ„è¯†åˆ°è¿™ä¸ªæº¢å‡ºé—®é¢˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"èŒƒå­¦é›·","uid":"1111315","ctime":1553317238,"ip_address":"","comment_id":77924,"utype":1}],"discussion_count":1,"race_medal":0,"score":"44502715459","product_id":100019601,"comment_content":"ç¬¬ä¸‰æ®µä»£ç <br>for (int i = 0; i &lt; nums.length; i++) {â€¦}<br>æŠŠnumsè®¾ç½®ä¸ºiçš„æœ€å¤§å€¼ï¼Œè¿™æ ·i++å°±æº¢å‡º","like_count":10,"discussions":[{"author":{"id":1111315,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f5/13/78741b7b.jpg","nickname":"èŒƒå­¦é›·","note":"","ucode":"D7CBE4A33427BD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443898,"discussion_content":"å—¯ï¼Œä»Šå¤©å­¦åˆ°æ–°ä¸œè¥¿äº†ï¼Œæˆ‘ä»¥å‰æ²¡æœ‰æ„è¯†åˆ°è¿™ä¸ªæº¢å‡ºé—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553317238,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99580,"user_name":"å½©è‰²çš„æ²™æ¼ ","can_delete":false,"product_type":"c1","uid":1116183,"ip_address":"","ucode":"19A0975A5E69EA","user_header":"https://static001.geekbang.org/account/avatar/00/11/08/17/e63e50f3.jpg","comment_is_top":false,"comment_ctime":1559262864,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"23034099344","product_id":100019601,"comment_content":"@hua168åŒå­¦<br>ç¬¬ä¸‰æ®µä»£ç <br>for (int i = 0; i &lt; nums.length; i++) {â€¦}<br>æŠŠnumsè®¾ç½®ä¸ºiçš„æœ€å¤§å€¼ï¼Œè¿™æ ·i++å°±æº¢å‡º<br><br>å®é™…è¿™æ®µä»£ç æŠŠnumsè®¾ç½®içš„æœ€å¤§å€¼ï¼Œi++æ˜¯ä¸ä¼šæº¢å‡ºçš„ï¼Œå› ä¸ºæ¡ä»¶æ˜¯i&lt;nums.length;å¦‚æœæ¡ä»¶æ˜¯i&lt;=num.length,é‚£ä¹ˆæŠŠnumsè®¾ç½®içš„æœ€å¤§å€¼ï¼Œi++æ˜¯ä¼šæº¢å‡ºçš„ã€‚","like_count":5,"discussions":[{"author":{"id":1244726,"avatar":"https://static001.geekbang.org/account/avatar/00/12/fe/36/df26de4a.jpg","nickname":"ä¾ç„¶äº¦æ™¨","note":"","ucode":"41F288A69AA4B6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5403,"discussion_content":"èµåŒã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566228502,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77987,"user_name":"ç©ºçŸ¥","can_delete":false,"product_type":"c1","uid":1013283,"ip_address":"","ucode":"C448E98238DD36","user_header":"https://static001.geekbang.org/account/avatar/00/0f/76/23/31e5e984.jpg","comment_is_top":false,"comment_ctime":1553050077,"is_pvip":false,"replies":[{"id":"28752","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"èŒƒå­¦é›·","uid":"1111315","ctime":1553317259,"ip_address":"","comment_id":77987,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23027886557","product_id":100019601,"comment_content":"numsæ•°ç»„æ²¡è¯´æ­£è´Ÿ,è´Ÿæ•°  target - nums å¯èƒ½æº¢å‡º","like_count":5,"discussions":[{"author":{"id":1111315,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f5/13/78741b7b.jpg","nickname":"èŒƒå­¦é›·","note":"","ucode":"D7CBE4A33427BD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443923,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553317259,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78016,"user_name":"æˆ‘æ¥ä¹Ÿ","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1553055060,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18732924244","product_id":100019601,"comment_content":"Cè¯­è¨€çš„ä»£ç æˆ‘çœ‹çš„æ‡‚,å°±å›å¤ä¸‹.<br>éœ€è¦å¯¹å‚æ•°åšåˆæ³•æ€§æ ¡éªŒ. buf ä¸èƒ½ä¸ºNULL. memcopyæ—¶çš„é•¿åº¦ä¸èƒ½ä¸ºè´Ÿæ•°.<br>æˆ‘ä»¬å†™çš„å‡½æ•°,éœ€è¦è€ƒè™‘å¥å£®æ€§.<br>éœ€è¦ä¿è¯ä¸ç®¡åˆ«äººä¼ ä»€ä¹ˆå‚æ•°,æˆ‘ä»¬çš„ä»£ç ä¸å‡ºé—®é¢˜.<br>ä»¥ä¸‹æ˜¯å®Œå–„åçš„ä»£ç .<br>---------------------------<br>int copy_something(char* buf, int len){<br>    char kbuf[800];<br><br>    if ((NULL == buf) || (len &lt;= 0)) { &#47;&#47;lenä¸º0æ—¶æ‹·è´0å­—èŠ‚,æ²¡æ„ä¹‰.<br>        return -1;<br>    }<br><br>    if(len &gt; sizeof(kbuf)){<br>        return -1;<br>    }<br><br>    return memcpy(kbuf, buf, len);<br>}<br><br>","like_count":4},{"had_liked":false,"id":77908,"user_name":"hua168","can_delete":false,"product_type":"c1","uid":1065255,"ip_address":"","ucode":"CFF9A7E86EBA48","user_header":"https://static001.geekbang.org/account/avatar/00/10/41/27/3ff1a1d6.jpg","comment_is_top":false,"comment_ctime":1553040749,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18732909933","product_id":100019601,"comment_content":"public static int mixed(int addOn, int multiplied, int scale) {<br>    return addOn + (multiplied * scale);<br>}<br>1.  (multiplied * scale)å¦‚æœç›¸ä¹˜å¤§äºé»˜è®¤çš„intç±»å‹æœ€å¤§å€¼ä¼šæº¢å‡º<br>2. addOn + (multiplied * scale)ç›¸åŠ å¤§äºintæœ€å¤§å€¼ä¹Ÿä¼šæº¢å‡º","like_count":4},{"had_liked":false,"id":78015,"user_name":"æˆ‘æ¥ä¹Ÿ","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1553054844,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14437956732","product_id":100019601,"comment_content":"Cè¯­è¨€çš„ä»£ç çœ‹å¾—æ‡‚,æˆ‘å°±å›å¤ä¸‹.","like_count":3},{"had_liked":false,"id":111156,"user_name":"ä¸€å‘¨æ€è¿›","can_delete":false,"product_type":"c1","uid":1032125,"ip_address":"","ucode":"00BE5402479B16","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bf/bd/0c40979f.jpg","comment_is_top":false,"comment_ctime":1562492775,"is_pvip":false,"replies":[{"id":"40455","content":"å¯ä»¥ä½¿ç”¨64ä½æ— ç¬¦å·æ•°å‘€ï¼Œä¸ºä»€ä¹ˆä¸å¯ä»¥å‘¢ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"èŒƒå­¦é›·","uid":"1111315","ctime":1562513728,"ip_address":"","comment_id":111156,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10152427367","product_id":100019601,"comment_content":"è¿™ä¸ªæœ€åè¯ä¹¦é—®é¢˜ï¼Œä¸ºä»€ä¹ˆä¸å¯ä»¥ä½¿ç”¨64ä½æ— ç¬¦å·æ•°è¡¨ç¤ºå‘¢ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1111315,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f5/13/78741b7b.jpg","nickname":"èŒƒå­¦é›·","note":"","ucode":"D7CBE4A33427BD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457254,"discussion_content":"å¯ä»¥ä½¿ç”¨64ä½æ— ç¬¦å·æ•°å‘€ï¼Œä¸ºä»€ä¹ˆä¸å¯ä»¥å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562513728,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78686,"user_name":"FengX","can_delete":false,"product_type":"c1","uid":1353041,"ip_address":"","ucode":"B1B0235B1D1935","user_header":"https://static001.geekbang.org/account/avatar/00/14/a5/51/7773d421.jpg","comment_is_top":false,"comment_ctime":1553218194,"is_pvip":false,"replies":[{"id":"28630","content":"1024åœ¨è¿™æ®µä»£ç é‡Œæ²¡æœ‰ç‰¹åˆ«çš„å«ä¹‰ã€‚å› ä¸ºdata.lengthçš„æœ€å¤§å€¼æ˜¯2^14, æˆ‘æƒ³ç”¨data.length + 1024è¯´æ˜ï¼Œè¿™æ ·çš„æ“ä½œä¸ä¼šäº§ç”Ÿæ•´æ•°çš„æº¢å‡ºé—®é¢˜ï¼Œä¹Ÿå°±æ˜¯â€œé™å®šäº†æ•°çš„èŒƒå›´â€œçš„å®‰å…¨æ€§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"èŒƒå­¦é›·","uid":"1111315","ctime":1553229990,"ip_address":"","comment_id":78686,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5848185490","product_id":100019601,"comment_content":"è€å¸ˆï¼Œè¿™æ®µä»£ç if ((data.length + 1024) &gt; cache.remaining()) ï¼Œä¸ºä»€ä¹ˆæ˜¯+1024ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1111315,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f5/13/78741b7b.jpg","nickname":"èŒƒå­¦é›·","note":"","ucode":"D7CBE4A33427BD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444190,"discussion_content":"1024åœ¨è¿™æ®µä»£ç é‡Œæ²¡æœ‰ç‰¹åˆ«çš„å«ä¹‰ã€‚å› ä¸ºdata.lengthçš„æœ€å¤§å€¼æ˜¯2^14, æˆ‘æƒ³ç”¨data.length + 1024è¯´æ˜ï¼Œè¿™æ ·çš„æ“ä½œä¸ä¼šäº§ç”Ÿæ•´æ•°çš„æº¢å‡ºé—®é¢˜ï¼Œä¹Ÿå°±æ˜¯â€œé™å®šäº†æ•°çš„èŒƒå›´â€œçš„å®‰å…¨æ€§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553229990,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78364,"user_name":"Demon.Lee","can_delete":false,"product_type":"c1","uid":1052859,"ip_address":"","ucode":"7F0E5493A8E345","user_header":"https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg","comment_is_top":false,"comment_ctime":1553133512,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"5848100808","product_id":100019601,"comment_content":"kbufå¥½åƒè¿˜è¦memsetåˆå§‹åŒ–ä¸€ä¸‹å§","like_count":1},{"had_liked":false,"id":353034,"user_name":"if...else...","can_delete":false,"product_type":"c1","uid":2550743,"ip_address":"åŒ—äº¬","ucode":"D0565908C99695","user_header":"https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg","comment_is_top":false,"comment_ctime":1659083974,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1659083974","product_id":100019601,"comment_content":"ç¬¬ä¸€ä¸ªcè¯­è¨€ä»£ç ï¼Œlenæ˜¯è´Ÿæ•°æ€ä¹ˆåŠï¼Ÿ","like_count":0},{"had_liked":false,"id":353032,"user_name":"if...else...","can_delete":false,"product_type":"c1","uid":2550743,"ip_address":"åŒ—äº¬","ucode":"D0565908C99695","user_header":"https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg","comment_is_top":false,"comment_ctime":1659083009,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1659083009","product_id":100019601,"comment_content":"é¦–å…ˆæœ€é‡è¦çš„ï¼Œæ˜¯è¦å€ŸåŠ©è½¯ä»¶å¼€å‘çš„æœºåˆ¶ï¼Œå‡å°‘ä»£ç é”™è¯¯ã€‚--è®°ä¸‹æ¥<br>ä»Šå¤©çš„å†…å®¹å¾ˆç¡¬æ ¸","like_count":0},{"had_liked":false,"id":78270,"user_name":"wahaha","can_delete":false,"product_type":"c1","uid":1051402,"ip_address":"","ucode":"E60166599CF31D","user_header":"https://static001.geekbang.org/account/avatar/00/10/0b/0a/fa152399.jpg","comment_is_top":false,"comment_ctime":1553124474,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553124474","product_id":100019601,"comment_content":"gosuæ”¯æŒchecked arithmetic","like_count":0}]}