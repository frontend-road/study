{"id":230978,"title":"23 | 洞察你的服务：使用Kiali观测你的微服务应用","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-servicemesh\">https://gitee.com/geektime-geekbang/geektime-servicemesh</a></p>","comments":[{"had_liked":false,"id":218278,"user_name":"aroll","can_delete":false,"product_type":"c3","uid":1023524,"ip_address":"","ucode":"3A1A1267C88CC3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9e/24/0d6a7987.jpg","comment_is_top":false,"comment_ctime":1589770973,"is_pvip":false,"replies":[{"id":80741,"content":"这块官方文档确实说的比较含糊，从下面name的解释我理解是用来还endpoint对象做关联的，不能随便定义；但概念部分的文档又没有明显的说明。\nhttps:&#47;&#47;kubernetes.io&#47;docs&#47;reference&#47;generated&#47;kubernetes-api&#47;v1.18&#47;#serviceport-v1-core\n因为你这个其实是个k8s的问题，可能还得请教一下k8s方面的专家：）\n","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1589779094,"ip_address":"","comment_id":218278,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"您好，我们的k8s集群中有一个auth2服务，当把其service 所暴露的端口名称定义成TCP时，其他服务通过feign访问auth2服务是没问题的，但定义成其他名称(如http)，则访问auth2服务会报错 401 。我查了k8s api文档 看到那个name 代表NDS label。请问这是什么原因呢？       即： -name: tcp  port: xx  protocol: TCP    targetPort: xx  这样配置就正常。  -name: http  port: xx  protocol: TCP    targetPort: xx   这样配置就报 401 Unauthorized 。我怀疑是配置成http，请求头里的认证参数没带过去。   其他服务配置成  -name: http  port: xx  protocol: TCP    targetPort: xx 就可以正常访问。    ","like_count":1,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495416,"discussion_content":"这块官方文档确实说的比较含糊，从下面name的解释我理解是用来还endpoint对象做关联的，不能随便定义；但概念部分的文档又没有明显的说明。\nhttps://kubernetes.io/docs/reference/generated/kubernetes-api/v1.18/#serviceport-v1-core\n因为你这个其实是个k8s的问题，可能还得请教一下k8s方面的专家：）\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589779094,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":285558,"user_name":"Geek__Phoenix","can_delete":false,"product_type":"c3","uid":1453358,"ip_address":"","ucode":"EEA694C7DBB4A3","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erGficovWwKUXs0zBEb87TtibFg8CC3icvXpPPicia4fkep5540LVfUAjCPWYhrCR8xQxuU97icS9HSfkzw/132","comment_is_top":false,"comment_ctime":1616896187,"is_pvip":false,"replies":[{"id":104298,"content":"删除再重新建svc，或者通过ingress给暴露出去","user_name":"作者回复","user_name_real":"马若飞","uid":1046394,"ctime":1617870555,"ip_address":"","comment_id":285558,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"你好！kiali的svc是ClusterIP，我想把它改成NodeIP，但是直接报错，无法修改。有什么其他的办法让集群外部的地址访问kiali吗？","like_count":0,"discussions":[{"author":{"id":1046394,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f7/7a/55618020.jpg","nickname":"马若飞","note":"","ucode":"3D0327329A10AE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517709,"discussion_content":"删除再重新建svc，或者通过ingress给暴露出去","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617870555,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":367502,"user_name":"Q·sun Ou","can_delete":false,"product_type":"c3","uid":1611616,"ip_address":"广东","ucode":"07D14549CFF504","user_header":"https://static001.geekbang.org/account/avatar/00/18/97/60/aeccca68.jpg","comment_is_top":false,"comment_ctime":1675267181,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"生产环境是arm服务器，没arm版的kiali，相当蛋疼，有什么好的解决办法吗？","like_count":0},{"had_liked":false,"id":329814,"user_name":"login","can_delete":false,"product_type":"c3","uid":1707934,"ip_address":"","ucode":"49297B42014B63","user_header":"https://static001.geekbang.org/account/avatar/00/1a/0f/9e/1a35fb04.jpg","comment_is_top":false,"comment_ctime":1641548481,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"为什么没有出来登录页面。直接是匿名用户。也不知道怎么打开登陆页面","like_count":0},{"had_liked":false,"id":220667,"user_name":"3Golds","can_delete":false,"product_type":"c3","uid":1203477,"ip_address":"","ucode":"A27DEF9616432A","user_header":"https://static001.geekbang.org/account/avatar/00/12/5d/15/7df9df88.jpg","comment_is_top":false,"comment_ctime":1590306426,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100049401,"comment_content":"集群内如果服务多了, kiali查看起来就很卡了\n\n大概有1000多pod","like_count":0}]}