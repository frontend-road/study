{"id":7153,"title":"11 |【实验】客户端模式授权服务器","content":"无","comments":[{"had_liked":false,"id":16382,"user_name":"Geek_u9xw1l","can_delete":false,"product_type":"c3","uid":1149342,"ip_address":"","ucode":"9ADD7336798DB4","user_header":"https://static001.geekbang.org/account/avatar/00/11/89/9e/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1531918573,"is_pvip":false,"replies":[{"id":5710,"content":"谢谢支持🌹","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1531972471,"ip_address":"","comment_id":16382,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"波波老师讲课的方式很好","like_count":3,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420778,"discussion_content":"谢谢支持🌹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1531972471,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":16964,"user_name":"郑59","can_delete":false,"product_type":"c3","uid":1066495,"ip_address":"","ucode":"BA780CDEA3DBB2","user_header":"https://static001.geekbang.org/account/avatar/00/10/45/ff/66d8b04c.jpg","comment_is_top":false,"comment_ctime":1532334918,"is_pvip":false,"replies":[{"id":5927,"content":"https:&#47;&#47;github.com&#47;sqshq&#47;PiggyMetrics，这个案例你可以参考下，它的内部服务调用使用客户端授权模式","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1532424250,"ip_address":"","comment_id":16964,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"希望能出个 微服务间调用的实战 现在这样显得太草草了了。","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420988,"discussion_content":"https://github.com/sqshq/PiggyMetrics，这个案例你可以参考下，它的内部服务调用使用客户端授权模式","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1532424250,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":276564,"user_name":"柳叶儿🐰","can_delete":false,"product_type":"c3","uid":1364589,"ip_address":"","ucode":"6F2D5B3FF1E4AC","user_header":"https://static001.geekbang.org/account/avatar/00/14/d2/6d/98939aeb.jpg","comment_is_top":false,"comment_ctime":1612007272,"is_pvip":false,"replies":[{"id":100438,"content":"请继续看21课有讲解","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1612107819,"ip_address":"","comment_id":276564,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"波波老师好，请问oauth2的state参数是怎么防止CSRF攻击的？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514755,"discussion_content":"请继续看21课有讲解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612107819,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99677,"user_name":"无用且垂死的星辰","can_delete":false,"product_type":"c3","uid":1075962,"ip_address":"","ucode":"EE38E4FF95B1BA","user_header":"https://static001.geekbang.org/account/avatar/00/10/6a/fa/df871eca.jpg","comment_is_top":false,"comment_ctime":1559277343,"is_pvip":false,"replies":[{"id":36219,"content":"开发一个功能完善的sso系统不简单，我的微信号:bulldog2015，加微信请说明来自极客时间。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1559572086,"ip_address":"","comment_id":99677,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"老师您好，我是大三的学生，目前在学您的课程，同时在计划做个sso系统，有一些问题想请教您，请问可以添加您的微信吗，dkyaorui@163.com，这个是我的邮箱。","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452217,"discussion_content":"开发一个功能完善的sso系统不简单，我的微信号:bulldog2015，加微信请说明来自极客时间。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559572086,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":94405,"user_name":"follow","can_delete":false,"product_type":"c3","uid":1509136,"ip_address":"","ucode":"5CB49510077AFD","user_header":"https://static001.geekbang.org/account/avatar/00/17/07/10/7ff147b5.jpg","comment_is_top":false,"comment_ctime":1557802269,"is_pvip":false,"replies":[{"id":34035,"content":"用户名密码模式是针对有人参与场景，需要同时提供client_id&#47;secret（标识客户应用身份）和username&#47;password（标识端用户身份）；客户端模式针对机器，没有端用户参与，只需要提供客户应用身份标识client_id&#47;secret。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1558008709,"ip_address":"","comment_id":94405,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"波波老师您好，客户端模式和密码模式只是感觉只是一个是在参数中取client_id&#47;secret另一个是取username&#47;password和对应配置数据源中的数据进行对比。步骤都一样，只是针对的使用对象不同，一个是针对机器，一个是针对客户的，请问能这样理解吗？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450053,"discussion_content":"用户名密码模式是针对有人参与场景，需要同时提供client_id/secret（标识客户应用身份）和username/password（标识端用户身份）；客户端模式针对机器，没有端用户参与，只需要提供客户应用身份标识client_id/secret。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558008709,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":87907,"user_name":"DDDATM","can_delete":false,"product_type":"c3","uid":1209371,"ip_address":"","ucode":"F1160869A3F103","user_header":"https://static001.geekbang.org/account/avatar/00/12/74/1b/53b8ab09.jpg","comment_is_top":false,"comment_ctime":1555749364,"is_pvip":false,"replies":[{"id":31759,"content":"你好，OAuth2的客户端模式适用于机器对机器的调用授权场景，你讲的对请求payload进行签名和验签也可以认为是一种调用授权方式，通过密钥MD5&#47;RSA等方式保证:1)请求是受信方发出的；2)请求没有被篡改过。OAuth2令牌的特点是具有有效期&#47;时效性，过期重新申请可以换一个令牌，可以集中校验和吊销令牌，你的办法如果考虑有效期&#47;时效性，集中校验&#47;吊销会比较麻烦，另外Key管理有一定复杂性。现在也流程一种方法把OAuth2令牌和签名&#47;验签结合起来，这个就是JWT(JSON Web Token)，它是一种自包含令牌，有时效性，可以包含过期和其它信息，可签名和自校验，可以无状态校验也可以集中校验。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1555944533,"ip_address":"","comment_id":87907,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"波波老师您好。我最近在做开放API的安全方案。之前用的比较多的是，使用https来解决传输加密问题，使用RSA或者MD5算法，对请求payload进行签名和验签的方式，来解决API的授权问题。在学习了您的OAuth2的课程之后，觉得OAuth2的客户端模式非常契合这种开放API授权场景，而且我注意到微信的小程序开发平台API，使用的也是OAuth2的客户端模式。我想请问波波老师，与签名验签方式进行授权相比，OAuth2的客户端模式的优势在哪里，对于开放API的安全方案，我们应该如何选型。还请老师指点一二，谢谢。","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447642,"discussion_content":"你好，OAuth2的客户端模式适用于机器对机器的调用授权场景，你讲的对请求payload进行签名和验签也可以认为是一种调用授权方式，通过密钥MD5/RSA等方式保证:1)请求是受信方发出的；2)请求没有被篡改过。OAuth2令牌的特点是具有有效期/时效性，过期重新申请可以换一个令牌，可以集中校验和吊销令牌，你的办法如果考虑有效期/时效性，集中校验/吊销会比较麻烦，另外Key管理有一定复杂性。现在也流程一种方法把OAuth2令牌和签名/验签结合起来，这个就是JWT(JSON Web Token)，它是一种自包含令牌，有时效性，可以包含过期和其它信息，可签名和自校验，可以无状态校验也可以集中校验。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555944533,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":83096,"user_name":"9080","can_delete":false,"product_type":"c3","uid":1114072,"ip_address":"","ucode":"D4DFBBC1B8394D","user_header":"https://static001.geekbang.org/account/avatar/00/10/ff/d8/fa77b4eb.jpg","comment_is_top":false,"comment_ctime":1554419830,"is_pvip":false,"replies":[{"id":30283,"content":"使用场景不同，客户端模式适用于机器对机器(无人参与)，授权吗模式适用于Web服务端应用(有人参与)。授权码模式对比简化(implict)和用户名密码(username&#47;password)模式更安全。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1554727064,"ip_address":"","comment_id":83096,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"老师您好，听完感觉客户端模式也是相对比较安全的，只要密钥不丢失。这样和授权码对比，又感觉不出授权码模式的安全优势体现到哪了","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445858,"discussion_content":"使用场景不同，客户端模式适用于机器对机器(无人参与)，授权吗模式适用于Web服务端应用(有人参与)。授权码模式对比简化(implict)和用户名密码(username/password)模式更安全。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554727064,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77927,"user_name":"yanshiqin","can_delete":false,"product_type":"c3","uid":1020783,"ip_address":"","ucode":"1073576FBC83C2","user_header":"","comment_is_top":false,"comment_ctime":1553042890,"is_pvip":false,"replies":[{"id":29013,"content":"client模式不是用username&#47;password，而是clientid&#47;secret，也就是说这不是代表用户，而是客户应用(client app)。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1553519660,"ip_address":"","comment_id":77927,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"这个client模式我看用postman也要输入username和password，这个用户名密码模式的区别是啥？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443900,"discussion_content":"client模式不是用username/password，而是clientid/secret，也就是说这不是代表用户，而是客户应用(client app)。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553519660,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62693,"user_name":"高峰","can_delete":false,"product_type":"c3","uid":1046111,"ip_address":"","ucode":"2DFE77FE4970B8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f6/5f/85e82813.jpg","comment_is_top":false,"comment_ctime":1548133487,"is_pvip":false,"replies":[{"id":22285,"content":"app key&#47;secret其实和oauth2里头的client id&#47;secret类似，没有明确规范，公司可以根据场景自己定义，一般client id要保证不重复，secret随机字符串就可以","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1548246374,"ip_address":"","comment_id":62693,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"老师请教，\n一般 互联网开放平台里面的  app key, app secret 生成规则  有基本规范么，还是说 每个公司自己决定？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437307,"discussion_content":"app key/secret其实和oauth2里头的client id/secret类似，没有明确规范，公司可以根据场景自己定义，一般client id要保证不重复，secret随机字符串就可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548246374,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51709,"user_name":"涛涛","can_delete":false,"product_type":"c3","uid":1039256,"ip_address":"","ucode":"4C47A3FB33EEFE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/db/98/60ced4c8.jpg","comment_is_top":false,"comment_ctime":1545226975,"is_pvip":false,"replies":[{"id":19374,"content":"录视频也是个辛苦活，如果大家能有收获就会有喜跃感💪","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1545655566,"ip_address":"","comment_id":51709,"utype":1}],"discussion_count":1,"race_medal":1,"score":2,"product_id":100007001,"comment_content":"bobo一脸淡定，有种莫名的喜感","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433588,"discussion_content":"录视频也是个辛苦活，如果大家能有收获就会有喜跃感💪","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545655566,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}