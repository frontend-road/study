{"id":368125,"title":"17 | æŸ¥è¯¢è´­ç‰©è½¦ï¼šä¸ºä»€ä¹ˆé“ºåº•å‚æ•°ä¸€å®šè¦ç¬¦åˆçœŸå®ä¸šåŠ¡ç‰¹æ€§ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é«˜æ¥¼ã€‚</p><p>ä»Šå¤©æˆ‘ä»¬æ¥çœ‹çœ‹æŸ¥è¯¢è´­ç‰©è½¦æ¥å£ã€‚</p><p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œè¿™æ˜¯æˆ‘ä»¬åˆ†æçš„ç¬¬å…­ä¸ªæ¥å£äº†ã€‚ä¸è¿‡ï¼Œæˆ‘å¸Œæœ›ä½ èƒ½æ˜ç™½ï¼Œæˆ‘ä»¬åˆ†ææ¯ä¸ªæ¥å£ï¼Œå¹¶ä¸æ˜¯ä¸ºäº†ææ¸…æ¥šè¿™ä¸ªæ¥å£æœ¬èº«çš„é€»è¾‘ï¼Œè€Œæ˜¯é€šè¿‡ä¸åŒæ¥å£çš„åŸºå‡†æµ‹è¯•ï¼Œæ¥åˆ†æä¸åŒçš„æ€§èƒ½é—®é¢˜ï¼Œäº‰å–ç»™ä½ å¸¦æ¥æ›´å¤šçš„åˆ†ææ¡ˆä¾‹ã€‚</p><p>ç°åœ¨å¾ˆå¤šäººåœ¨æ€§èƒ½åœºæ™¯æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä»ç„¶ä¼šé—®å‡ºâ€œå½“é“ºåº•æ•°æ®ä¸ç¬¦åˆç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œè¯¥æ€ä¹ˆåŠâ€è¿™æ ·çš„ç–‘é—®ï¼Œå…¶å®ç­”æ¡ˆä¹ŸæŒºç®€å•ï¼Œé‚£å°±æ˜¯æ¨¡æ‹Ÿä¸å‡ºç”Ÿäº§ç¯å¢ƒä¸­çš„é—®é¢˜ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨è¿™èŠ‚è¯¾ä¸­ï¼Œä½ å°†çœ‹åˆ°å½“é“ºåº•æ•°æ®ä¸åˆç†æ—¶ï¼Œä¼šå¯¹TPSäº§ç”Ÿä»€ä¹ˆæ ·å…·ä½“çš„å½±å“ã€‚ç”±æ­¤ï¼Œä½ ä¼šè¿›ä¸€æ­¥ç†è§£ä¸ºä»€ä¹ˆæˆ‘ä¸€ç›´åœ¨è·Ÿä½ å¼ºè°ƒ<strong>é“ºåº•æ•°æ®è¦ç¬¦åˆç”Ÿäº§ç¯å¢ƒé€»è¾‘</strong>ã€‚</p><p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜ä¼šåˆ†æå¦ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªé—®é¢˜å¯èƒ½ä¼šè®©ä½ çœ‹ç€æ¯”è¾ƒéƒé—·ï¼Œä½ ä¼šå‘ç°æˆ‘ä»¬åˆ†æäº†å¾ˆä¹…ï¼Œé€»è¾‘çœ‹ä¼¼éå¸¸åˆç†ï¼Œä½†æ˜¯ç»“æœå¹¶ä¸å¦‚äººæ„ã€‚é¢å¯¹è¿™æ ·çš„æƒ…å†µï¼Œé‚£æˆ‘ä»¬è¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿè¿™é‡Œç•™ä¸ªæ‚¬å¿µï¼Œæˆ‘ä»¬ç›´æ¥å¼€å§‹ä»Šå¤©çš„åˆ†æã€‚</p><h2>å‹åŠ›æ•°æ®</h2><p>å¯¹äºæŸ¥è¯¢è´­ç‰©è½¦è¿™ä¸ªæ¥å£ï¼Œè¿˜æ˜¯ä¸€æ ·ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬ä¸€æ¬¡è¿è¡Œçš„æ€§èƒ½åœºæ™¯ç»“æœã€‚è¿™æ˜¯ä¸€ä¸ªä¸€å¼€å§‹å°±è¶³ä»¥è®©äººå¿ƒç¢çš„æ€§èƒ½æ•°æ®ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/6b/e3/6be835b024ebcdyyb8b37yy716bee1e3.png?wh=1806*655\" alt=\"\"></p><p>ä½ çœ‹ï¼Œçº¿ç¨‹æ•°åœ¨å¢åŠ çš„è¿‡ç¨‹ä¸­ï¼ŒTPSåªè¾¾åˆ°40ï¼Œè€Œå“åº”æ—¶é—´ä»ä¸€å¼€å§‹å°±ä¸æ–­åœ°å¢åŠ ã€‚</p><p>è¿™å¯æ€ä¹ˆåŠå‘¢ï¼Ÿæ ¹æ®æˆ‘ä»¬RESARæ€§èƒ½åˆ†æé€»è¾‘ï¼Œç¬¬ä¸€æ­¥ä»ç„¶æ˜¯çœ‹æ¶æ„å›¾ï¼Œæ¥ç€æ˜¯æ‹†åˆ†å“åº”æ—¶é—´ã€‚å› ä¸ºå“åº”æ—¶é—´åœ¨ä¸æ–­å¢åŠ ï¼Œæ‰€ä»¥æˆ‘ä»¬æƒ³è¦æ‹†åˆ†å“åº”æ—¶é—´éå¸¸å®¹æ˜“ã€‚</p><!-- [[[read_end]]] --><h2>æ¶æ„å›¾</h2><p>åœ¨æ‹†åˆ†å“åº”æ—¶é—´ä¹‹å‰ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹æ¶æ„å›¾ã€‚åœ¨è¿™ä¸€æ­¥ï¼Œä½ åªéœ€è¦æŠŠæ¶æ„å›¾è®°ä¸ªå¤§æ¦‚å°±è¡Œäº†ã€‚å› ä¸ºåé¢è¿˜è¦åå¤å›æ¥çœ‹å¤šæ¬¡ã€‚</p><h2></h2><p><img src=\"https://static001.geekbang.org/resource/image/4d/3c/4d60c5c09byy55e72b058c5871e3bf3c.png?wh=881*676\" alt=\"\"></p><h2>ç¬¬ä¸€é˜¶æ®µåˆ†æ</h2><h3>æ‹†åˆ†å“åº”æ—¶é—´</h3><p>æˆ‘ä»¬ååå¤å¤åœ¨è®²ï¼Œ<strong>åšæ€§èƒ½åˆ†æçš„æ—¶å€™ï¼Œé¦–å…ˆå°±æ˜¯æ‹†åˆ†æ—¶é—´</strong>ã€‚</p><p>åˆ«äººåœ¨é—®æˆ‘é—®é¢˜çš„æ—¶å€™ï¼Œç»å¸¸ä¼šè¿™æ ·æè¿°ï¼šTPSä¸é«˜ï¼Œå“åº”æ—¶é—´é•¿ï¼Œç“¶é¢ˆåœ¨å“ªå‘¢ï¼Ÿä¸€çœ‹åˆ°è¿™ç§é—®é¢˜ï¼Œæˆ‘é€šå¸¸ä¼šåé—®ï¼šå“åº”æ—¶é—´é•¿åœ¨å“ªå‘¢ï¼Ÿç„¶åï¼Œç»å…¸çš„å¯¹è¯ç»“æŸè¯­å°±å‡ºç°äº†â€”â€”æˆ‘ä¸çŸ¥é“å‘€ã€‚æˆ‘ä¹Ÿå¾ˆæƒ³å¸®åŠ©å¯¹æ–¹è§£å†³é—®é¢˜ï¼Œä½†æ˜¯ï¼Œå¯¹äºè¿™æ ·çš„æè¿°ï¼Œæˆ‘æ ¹æœ¬æ— ä»ä¸‹æ‰‹ã€‚</p><p>ä¸€ä¸ªåšæ€§èƒ½çš„äººï¼Œæ€ä¹ˆèƒ½åªæè¿°å“åº”æ—¶é—´é•¿å‘¢ï¼Ÿä½ è‡³å°‘è¦å‘Šè¯‰åˆ«äººæ…¢åœ¨å“ªé‡Œã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä¸€ç›´åœ¨å¼ºè°ƒè¦ç”»æ¶æ„å›¾ã€‚å› ä¸ºæœ‰äº†å›¾ï¼Œæ‰æœ‰æ‹†åˆ†æ—¶é—´çš„æ‰‹æ®µï¼Œè¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬è‡ªç„¶å°±ä¸ä¼šç›²ç›®ï¼Œé™¤éä½ å•¥éƒ½æ²¡æœ‰ã€‚</p><p>åœ¨æ‹†åˆ†æ—¶é—´çš„æ—¶å€™ï¼Œä½ è¿˜è¦æ³¨æ„ä¸€ç‚¹ï¼Œ<strong>è¦æ‰¾å‡†æ—¶é—´æ®µ</strong>ã€‚æ ¹æ®æˆ‘çš„ç»éªŒï¼Œä¸€èˆ¬æ˜¯çœ‹å“åº”æ—¶é—´çš„è¶‹åŠ¿ï¼Œå¦‚æœä¸€ç›´éƒ½é•¿çš„è¯ï¼Œå€’æ˜¯ç®€å•ï¼Œçœ‹å“ªä¸€æ®µå“åº”æ—¶é—´éƒ½è¡Œã€‚è¦æ˜¯æœ‰çš„æ—¶å€™é•¿ï¼Œæœ‰çš„æ—¶å€™çŸ­ï¼Œé‚£ä½ å°±è¦æ³¨æ„äº†ï¼Œåœ¨æ‹†åˆ†å“åº”æ—¶é—´çš„æ—¶å€™ï¼Œè¦æ³¨æ„æŠŠç›‘æ§å·¥å…·ä¸­çš„æ—¶é—´æ®µé€‰æ‹©å¥½ã€‚</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€‰æ‹©SkyWalkingæ—¶é—´æ®µï¼š<code>2021-01-02 13:53:00 - 2021-01-02 13:54:00</code>ã€‚å…·ä½“æ‹†åˆ†æ—¶é—´å¦‚ä¸‹ï¼š</p><ul>\n<li>User - Gatewayï¼š</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/4d/82/4d7a06yy402957608011dd69b8e8fd82.png?wh=276*190\" alt=\"\"></p><ul>\n<li>Gatewayï¼š</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/0d/3b/0d466c07da6d2db5fff60abc32e0ec3b.png?wh=262*184\" alt=\"\"></p><ul>\n<li>Gateway - Cartï¼š</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/5c/ff/5c0fbf24959d98c5787f64def5026fff.png?wh=263*186\" alt=\"\"></p><p><img src=\"https://static001.geekbang.org/resource/image/ce/49/ced9b3920d9d00ab06b3d443bbae8649.png?wh=271*182\" alt=\"\"></p><ul>\n<li>Cartï¼š</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/ba/b5/bayy3fc2a1e2958789e5f3410f6498b5.png?wh=265*185\" alt=\"\"></p><ul>\n<li>Cart - MySQLï¼š</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/d2/b2/d22c0a2ee7180ecde6f97505e467e9b2.png?wh=265*184\" alt=\"\"></p><p>é€šè¿‡ä¸Šé¢æŠ“å–çš„æ•°æ®ï¼Œä½ æ˜æ˜¾å¯ä»¥çœ‹åˆ°ï¼Œæ˜¯è´­ç‰©è½¦æœåŠ¡Carté‚£ä¸€æ®µçš„å“åº”æ—¶é—´é•¿ã€‚</p><p>æˆ‘ä»¬è¦æ³¨æ„ï¼Œæœ‰äº›æ•°æ®æŠ“å–å·¥å…·ç”±äºå·¥å…·æœ¬èº«çš„é—®é¢˜ï¼Œä¼šå­˜åœ¨ä¸å°çš„æ•°æ®åå·®ï¼Œæ¯”å¦‚è¯´å¯¹äºä¸Šé¢çš„SkyWalkingæ—¶é—´æ®µï¼Œæˆ‘ä»¬çœ‹åˆ°Gateway - Cartä¹‹é—´çš„æœåŠ¡ç«¯å¹³å‡å“åº”æ—¶é—´æ˜¯829.25ã€‚ä½†æ˜¯ï¼Œåœ¨Cartä¸Šå´æ˜¯984.50ã€‚åŒæ ·çš„ä¸€æ®µæ—¶é—´ï¼Œè¿™é‡Œå°±å‡ºç°äº†ä¸€äº›åå·®ã€‚</p><p>åœ¨æ¯ä¸€ä¸ªç›‘æ§å·¥å…·ä¸Šï¼Œéƒ½æˆ–å¤šæˆ–å°‘å­˜åœ¨æ€§èƒ½æ•°æ®åå·®ï¼Œå°±æ¯”å¦‚docker statsï¼Œæˆ‘ç®€ç›´æ˜¯ä¸æƒ³çœ‹ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬æœ‰æ—¶å€™è¦ç»“åˆå¤šä¸ªå·¥å…·æ¥å¯¹æ¯”æ•°æ®ã€‚</p><h3>å®šå‘ç›‘æ§åˆ†æ</h3><p>æ‹†åˆ†å®Œå“åº”æ—¶é—´åï¼Œæˆ‘ä»¬ä¸å†ä»å…¨å±€åˆ†æå¼€å§‹ï¼Œè€Œæ˜¯ç›´æ¥è·³åˆ°äº†å®šå‘ç›‘æ§ã€‚å› ä¸ºå¯¹äºæŸ¥è¯¢è´­ç‰©è½¦è¿™ä¸ªæ¥å£ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“CartæœåŠ¡æ˜¯æ…¢çš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å°±ç›´æ¥è¿›å»æŸ¥çœ‹å¯¹åº”çš„æ…¢çš„æ–¹æ³•åœ¨å“ªé‡Œã€‚</p><p>è¿™ä¸ªæ¥å£çš„è°ƒç”¨æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>/**\n * æ ¹æ®ä¼šå‘˜idæŸ¥è¯¢è´­ç‰©è½¦æ•°æ®\n *\n * @param memberId ä¼šå‘˜id\n * @return\n */\n@Override\npublic List&lt;OmsCartItem&gt; list(Long memberId) {\n    if (memberId == null) {\n        return null;\n    }\n    OmsCartItemExample example = new OmsCartItemExample();\n    example.createCriteria().andDeleteStatusEqualTo(0).andMemberIdEqualTo(memberId);\n    return cartItemMapper.selectByExample(example);\n}\n</code></pre><p>é€šè¿‡ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬çŸ¥é“äº†æ–¹æ³•åï¼Œé‚£æˆ‘ä»¬ç›´æ¥ç”¨Arthasæ¥Traceè¿™ä¸ªæ¥å£å°±å¥½äº†ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code>trace com.dunshan.mall.cart.service.imp.CartItemServiceImpl list -v -n 5 --skipJDKMethod false '1==1'\n</code></pre><p>äºæ˜¯ï¼Œæˆ‘ä»¬å¾—åˆ°äº†å¦‚ä¸‹çš„ä¿¡æ¯ï¼š</p><pre><code>[arthas@1]$ trace com.dunshan.mall.cart.service.imp.CartItemServiceImpl list -v -n 5 --skipJDKMethod false '1==1'\nCondition express: 1==1 , result: true\n`---ts=2021-01-02 14:59:53;thread_name=http-nio-8086-exec-556;id=10808;is_daemon=true;priority=5;TCCL=org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedWebappClassLoader@18c26588\n    `---[999.018045ms] com.dunshan.mall.cart.service.imp.CartItemServiceImpl$$EnhancerBySpringCGLIB$$e110d1ef:list()\n        `---[998.970849ms] org.springframework.cglib.proxy.MethodInterceptor:intercept() #57\n\n\nCondition express: 1==1 , result: true\n`---ts=2021-01-02 14:59:54;thread_name=http-nio-8086-exec-513;id=107d3;is_daemon=true;priority=5;TCCL=org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedWebappClassLoader@18c26588\n    `---[1095.593933ms] com.dunshan.mall.cart.service.imp.CartItemServiceImpl$$EnhancerBySpringCGLIB$$e110d1ef:list()\n        `---[1095.502983ms] org.springframework.cglib.proxy.MethodInterceptor:intercept() #57\n\n\nCondition express: 1==1 , result: true\n`---ts=2021-01-02 14:59:53;thread_name=http-nio-8086-exec-505;id=1078b;is_daemon=true;priority=5;TCCL=org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedWebappClassLoader@18c26588\n    `---[2059.097767ms] com.dunshan.mall.cart.service.imp.CartItemServiceImpl$$EnhancerBySpringCGLIB$$e110d1ef:list()\n        `---[2059.013275ms] org.springframework.cglib.proxy.MethodInterceptor:intercept() #57\n\n\nCondition express: 1==1 , result: true\n`---ts=2021-01-02 14:59:54;thread_name=http-nio-8086-exec-541;id=107f6;is_daemon=true;priority=5;TCCL=org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedWebappClassLoader@18c26588\n    `---[1499.559298ms] com.dunshan.mall.cart.service.imp.CartItemServiceImpl$$EnhancerBySpringCGLIB$$e110d1ef:list()\n        `---[1499.498896ms] org.springframework.cglib.proxy.MethodInterceptor:intercept() #\n\né€šè¿‡ä¸Šé¢çš„æ•°æ®å¯ä»¥çœ‹åˆ°list()çš„å“åº”æ—¶é—´ç¡®å®æ˜¯é•¿äº†ï¼Œä½†æ˜¯è¿™ä¸ªæ¥å£å¹¶ä¸å¤æ‚ï¼Œå°±æ˜¯ä¸€ä¸ªselectè¯­å¥è€Œå·²ã€‚å¯¹åº”çš„selectè¯­å¥çš„Mapperå†…å®¹å¦‚ä¸‹ï¼š\n\n&lt;select id=&quot;selectByExample&quot; parameterType=&quot;com.dunshan.mall.model.OmsCartItemExample&quot; resultMap=&quot;BaseResultMap&quot;&gt;\n    select\n    &lt;if test=&quot;distinct&quot;&gt;\n      distinct\n    &lt;/if&gt;\n    &lt;include refid=&quot;Base_Column_List&quot; /&gt;\n    from oms_cart_item\n    &lt;if test=&quot;_parameter != null&quot;&gt;\n      &lt;include refid=&quot;Example_Where_Clause&quot; /&gt;\n    &lt;/if&gt;\n    &lt;if test=&quot;orderByClause != null&quot;&gt;\n      order by ${orderByClause}\n    &lt;/if&gt;\n  &lt;/select&gt;\n</code></pre><p>è¿™ä¸ªMapperå¯¹åº”åˆ°æ•°æ®åº“ä¸­ï¼Œå…·ä½“çš„SQLå°±æ˜¯ï¼š</p><pre><code>SELECT id, product_id, product_sku_id, member_id, quantity, price, product_pic, product_name, product_sub_title, product_sku_code, member_nickname, create_date, modify_date, delete_status, product_category_id, product_brand, product_sn, product_attr FROM oms_cart_item WHERE (  delete_status = 0  AND member_id = 597427  )\n</code></pre><p>æ—¢ç„¶æ˜¯ä¸€ä¸ªselectè¯­å¥æ¶ˆè€—çš„æ—¶é—´é•¿ï¼Œé‚£æˆ‘ä»¬å°±åˆ°æ•°æ®åº“é‡Œï¼Œæ ¹æ®ç›¸åº”çš„SQLæ¥çœ‹å¯¹åº”è¡¨çš„æ•°æ®ç›´æ–¹å›¾ã€‚å‘½ä»¤å¦‚ä¸‹ï¼š</p><pre><code>select member_id,count(*) from oms_cart_item_202101021530 GROUP BY 1 ORDER BY 2 DESC;\n</code></pre><p>ç»“æœå¦‚ä¸‹ï¼Œæˆ‘ä»¬æˆªå–äº†ç›´æ–¹å›¾çš„éƒ¨åˆ†æ•°æ®ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/95/bf/954ca65681d0f21602f6c477c1e5e6bf.png?wh=327*609\" alt=\"\"></p><p>ä»ä¸Šè¿°æ•°æ®åº“ä¸­çš„æ•°æ®æ¥çœ‹ï¼Œä¸€ä¸ªä¼šå‘˜IDçš„ä¸‹é¢å·²ç»åŠ äº†ä¸å°‘æ•°æ®ã€‚è™½ç„¶selectæ˜¯é€šè¿‡ä¼šå‘˜IDæŸ¥çš„ï¼Œä½†æ˜¯æ²¡åšåˆ†é¡µå¤„ç†ã€‚è¿™æ˜¯æœ€ç®€å•ç›´æ¥çš„SQLé—®é¢˜äº†ï¼Œåˆ†æè¿‡ç¨‹ä¹Ÿéå¸¸ç®€å•ã€‚å½“æˆ‘ä»¬ä¸€çœ‹åˆ°SQLæ—¶é—´é•¿çš„æ—¶å€™ï¼Œå°±è¦æŸ¥çœ‹ä¸€ä¸‹æ‰§è¡Œè®¡åˆ’ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/7d/c0/7d1726dd3ea450bef207b96261b883c0.png?wh=927*50\" alt=\"\"></p><p>æ—¢ç„¶ä¸Šé¢çš„typeå€¼æ˜¯ALLï¼Œè¯´æ˜èµ°çš„æ˜¯å…¨è¡¨æ‰«æï¼Œé‚£æˆ‘ä»¬å°±è¦æ ¹æ®SQLä¸­çš„whereæ¡ä»¶æ¥ç¡®å®šä¸€ä¸‹è¦åˆ›å»ºä»€ä¹ˆç´¢å¼•ï¼›å¦‚æœwhereæ¡ä»¶ä¸­çš„æŸ¥è¯¢ç»“æœæ˜¯å¤šæ¡ç»“æœï¼Œå¹¶ä¸”æ•°æ®è¾ƒå¤šï¼Œé‚£å°±éœ€è¦åšåˆ†é¡µã€‚åˆ†æåˆ°è¿™é‡Œï¼Œå…¶å®ä¹Ÿæ¯”è¾ƒå®¹æ˜“æƒ³åˆ°å¯¹åº”çš„è§£å†³æ–¹æ¡ˆï¼Œæœ‰ä¸¤ä¸ªåŠ¨ä½œè¦åšï¼š</p><ol>\n<li>åˆ›å»ºç´¢å¼•ï¼šåˆ›å»ºç´¢å¼•æ˜¯ä¸ºäº†æŸ¥è¯¢çš„æ—¶å€™å¯ä»¥ç²¾å‡†æŸ¥è¯¢ã€‚</li>\n<li>åšåˆ†é¡µï¼šæ˜¯ä¸ºäº†é¿å…è¿”å›åˆ°å‰ç«¯çš„æ•°æ®å¤ªå¤šã€‚</li>\n</ol><h3>ä¼˜åŒ–æ•ˆæœ</h3><p>æˆ‘ä»¬è™½ç„¶è®²çš„æ˜¯â€œä¼˜åŒ–æ•ˆæœâ€ï¼Œä½†ï¼Œå‡†ç¡®æ¥è¯´åªæ˜¯â€œéªŒè¯æ•ˆæœâ€ã€‚å› ä¸ºä¸Šé¢çš„ä¸¤ä¸ªåŠ¨ä½œéƒ½æ˜¯ä¸ºäº†æé«˜SQLçš„æŸ¥è¯¢æ•ˆæœï¼Œç¡®åˆ‡æ¥è¯´å°±ä¸ºäº†å‡å°‘æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®ã€‚é‚£æˆ‘ä»¬ç°åœ¨å°±ç›´æ¥æŠŠæ•°æ®ç»™é™ä¸‹æ¥ï¼Œæ¥éªŒè¯æˆ‘ä»¬çš„åˆ¤æ–­æ˜¯ä¸æ˜¯æ­£ç¡®ã€‚</p><p>ä¸ºäº†éªŒè¯æˆ‘ä»¬çš„åˆ†æè¿‡ç¨‹æ˜¯æ­£ç¡®çš„ï¼Œè¿™é‡Œæˆ‘å…ˆç›´æ¥æŠŠè¡¨ç»™TRUNCATEæ‰ï¼Œå…ˆçœ‹çœ‹å“åº”æ—¶é—´èƒ½ä¸èƒ½ä¸Šæ¥ã€‚å¦‚æœèƒ½ä¸Šæ¥ï¼Œé‚£å°±æ˜¯è¿™é‡Œçš„é—®é¢˜äº†ã€‚</p><p>å¯å¦‚æœä¸æ˜¯å‘¢ï¼Ÿé‚£æˆ‘ä»¬åªèƒ½å›åˆ°è§’è½é»˜é»˜æµæ³ªäº†ã€‚è¿™ä¹ˆç®€å•çš„é—®é¢˜éƒ½æ‰¾ä¸åˆ°ï¼Œæˆ‘ä¸æ˜¯ä¸€ä¸ªåˆæ ¼çš„æ€§èƒ½åˆ†æäººå‘˜ã€‚</p><p>ä¸ç®¡æ€ä¹ˆè¯´ï¼Œæ¥ï¼Œæˆ‘ä»¬çœ‹ä¸‹ç»“æœï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/c0/f1/c0c511412da730a61d7ff0d166d1f1f1.png?wh=1830*527\" alt=\"\"></p><p>å¯ä»¥çœ‹åˆ°ï¼ŒTPSä¸€ä¸‹å­ä¸Šå‡äº†å¾ˆå¤šï¼Œåœ¨åœºæ™¯ä¸é—´æ–­çš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªæ¯”å¯¹å¦‚æ­¤å–œäººã€‚çœ‹æ¥ï¼Œæˆ‘è¿˜èƒ½ç»§ç»­å¹²è¿™ä¸€è¡Œã€‚</p><p>ä¸è¿‡ï¼Œæˆ‘ä»¬çš„åˆ†æåˆ°è¿™é‡Œå¹¶æ²¡æœ‰ç»“æŸï¼Œå±‹æ¼åé€¢è¿å¤œé›¨ï¼Œæˆ‘åœ¨æ¥ç€åšå‹åŠ›çš„è¿‡ç¨‹ä¸­ï¼Œåˆå‡ºç°äº†çŠ¶å†µï¼Œè¿™è®©æˆ‘ä»¬ä¸å¾—ä¸è¿›å…¥ç¬¬äºŒä¸ªé˜¶æ®µçš„åˆ†æã€‚</p><h2>ç¬¬äºŒé˜¶æ®µåˆ†æ</h2><p>åˆ°åº•åˆå‡ºç°äº†ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿå…·ä½“æƒ…å†µå¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/48/02/486a53a0d5d9af7f985e61f91fecd702.png?wh=1816*657\" alt=\"\"></p><p>What? é‚£æ˜¯TPSæ›²çº¿å—ï¼Ÿé‚£æ˜¯æ‰ä¸‹æ¥äº†å—ï¼Ÿæ‰çš„è¿˜è¿™ä¹ˆå¤šå—ï¼ŸåŒæ ·æ˜¯åœºæ™¯ä¸é—´æ–­å•Šã€‚æˆ‘çš„èŒä¸šç”Ÿæ¶¯éš¾é“è¦å°±æ­¤æ–­é€äº†å—ï¼Ÿ</p><p>è¿™ä¸ªé—®é¢˜æœ‰ç‚¹å¤æ‚ã€‚ä½†æ˜¯ä»å“åº”æ—¶é—´æ›²çº¿ä¸Šçœ‹ï¼Œæ˜æ˜¾æ˜¯å“åº”æ—¶é—´å¢åŠ äº†ï¼ŒTPSä¸‹æ¥äº†ã€‚æ—¢ç„¶è¿™æ ·ï¼Œä»ç„¶èµ°æˆ‘ä»¬æ‹†åˆ†å“åº”æ—¶é—´çš„æ€è·¯å°±å¥½äº†ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p><p>é€šè¿‡æ‹†åˆ†æ—¶é—´ï¼Œæˆ‘ä»¬çŸ¥é“å“åº”æ—¶é—´é•¿çš„é—®é¢˜å‡ºåœ¨äº†Gatewayä¸Šã€‚ä¸‹é¢æˆ‘ä»¬å°±æ ¹æ®RESARæ€§èƒ½åˆ†æé€»è¾‘ï¼Œè€è€å®å®å¼€å§‹åˆ†æã€‚</p><h3>å…¨å±€ç›‘æ§åˆ†æ</h3><p>æˆ‘ä»¬ä»ç³»ç»Ÿçº§çš„èµ„æºä¸Šå¯ä»¥æ˜æ˜¾çœ‹åˆ°ï¼Œæ‰€æœ‰çš„workerèŠ‚ç‚¹éƒ½æ— å‹åŠ›ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e3/d4/e351d44ec9be9300597431ca6b28c1d4.png?wh=1417*478\" alt=\"\"></p><p>æˆ‘ä»¬å†ä»Podè§’åº¦æ¥çœ‹ä¸€ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/f3/f0/f355e78f2869e77b1625b4b57555c2f0.png?wh=1882*716\" alt=\"\"></p><p>ä½ çœ‹ï¼Œæœ‰äº›Podæ¶ˆè€—çš„CPUå·²ç»è¾¾åˆ°äº†100%ã€‚æˆ‘æŠŠæ‰€æœ‰çš„Podæ’ä¸ªåºï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/91/ed/9123f41165957b2761ecb02e781133ed.png?wh=380*243\" alt=\"\"></p><p>è™½ç„¶æˆ‘ä»¬çœ‹åˆ°äº†åƒnode_exporterã€ESç›¸å…³çš„Podèµ„æºéƒ½ç”¨å¾—ä¸ä½ï¼Œä½†æ˜¯è¿™äº›CPUä½¿ç”¨ç‡é«˜çš„èŠ‚ç‚¹Podçš„èµ„æºä¹Ÿéƒ½é™åˆ¶äº†ã€‚åŒæ—¶ï¼Œä½ è¦æ³¨æ„ï¼Œè¿™ä¸ªèµ„æºå ç”¨ç‡é«˜çš„Podä¸­å¹¶æ²¡æœ‰æˆ‘ä»¬çš„åº”ç”¨èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åº”ç”¨èŠ‚ç‚¹çš„CPUèµ„æºå¹¶æ²¡æœ‰ç”¨å®Œã€‚</p><p>æˆ‘æœ¬æ¥æƒ³å»çœ‹ä¸€ä¸‹åœ¨è¿™æ®µæ—¶é—´å†…ï¼Œåº”ç”¨æ‰€åœ¨çš„workerä¸Šçš„å†…å­˜æ¶ˆè€—å…·ä½“æ˜¯æ€æ ·çš„ã€‚ä½†æ˜¯ï¼Œåœ¨è¿™æ®µæ—¶é—´å†…å´æ²¡äº†æ•°æ®ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/4d/70/4d8c352b4762747fe30480e43180e170.png?wh=1820*374\" alt=\"\"></p><p>ä½ çœ‹ï¼Œä¸­é—´çš„æ•°æ®å·²ç»æ–­æ‰äº†ï¼Œnode_exporterå·²ç»ä¸ä¼ æ•°äº†ã€‚æ²¡æœ‰åŠæ³•ï¼Œæˆ‘ä»¬åªæœ‰æ”¾å¼ƒçœ‹  workerä¸Šçš„å†…å­˜æ¶ˆè€—äº†ã€‚</p><p>æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£æˆ‘ä»¬å…ˆæŸ¥ä¸€ä¸‹Gatewayåœ¨å“ªä¸ªworkerä¸Šï¼ŒåŒæ—¶ä¹Ÿæ¥çœ‹ä¸€ä¸‹è¿™ä¸ªworkerä¸Šæœ‰å¤šå°‘Podã€‚èµ°è¿™ä¸€æ­¥æ˜¯å› ä¸ºåœ¨æ•´ä¸ªKubernetesä¸­ï¼Œæ‰€æœ‰çš„namespaceéƒ½ç”¨workerä¸»æœºçš„èµ„æºã€‚æ‰€ä»¥ï¼Œä»èµ„æºä½¿ç”¨çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬è¦è€ƒè™‘åˆ°æ‰€æœ‰å‘½åç©ºé—´ä¸­çš„Podã€‚</p><p>æ‰€æœ‰namespaceåœ¨åº”ç”¨èŠ‚ç‚¹ä¸Šçš„æ‰€æœ‰Podå¦‚ä¸‹ï¼š</p><pre><code>- å…ˆæŸ¥è¯¢gatewayæ‰€åœ¨çš„workerèŠ‚ç‚¹å\n\n  [root@k8s-master-2 ~]# kubectl get pods --all-namespaces -o wide | grep gateway\n    default                gateway-mall-gateway-6567c8b49c-pc7rf        1/1     Running   0          15h     10.100.140.2     k8s-worker-2   &lt;none&gt;           &lt;none&gt;\n\n- å†æŸ¥è¯¢å¯¹åº”workerä¸Šçš„æ‰€æœ‰POD\n[root@k8s-master-2 ~]# kubectl get pods --all-namespaces -o wide | grep k8s-worker-2\ndefault                elasticsearch-client-1                       1/1     Running   4          20d     10.100.140.28    k8s-worker-2   &lt;none&gt;           &lt;none&gt;\ndefault                elasticsearch-data-2                         1/1     Running   0          4d2h    10.100.140.35    k8s-worker-2   &lt;none&gt;           &lt;none&gt;\ndefault                elasticsearch-master-2                       1/1     Running   4          20d     10.100.140.30    k8s-worker-2   &lt;none&gt;           &lt;none&gt;\ndefault                gateway-mall-gateway-6567c8b49c-pc7rf        1/1     Running   0          15h     10.100.140.2     k8s-worker-2   &lt;none&gt;           &lt;none&gt;\nkube-system            calico-node-rlhcc                            1/1     Running   0          2d5h    172.16.106.149   k8s-worker-2   &lt;none&gt;           &lt;none&gt;\nkube-system            coredns-59c898cd69-sfd9w                     1/1     Running   4          36d     10.100.140.31    k8s-worker-2   &lt;none&gt;           &lt;none&gt;\nkube-system            kube-proxy-l8xf9                             1/1     Running   6          36d     172.16.106.149   k8s-worker-2   &lt;none&gt;           &lt;none&gt;\nmonitoring             node-exporter-mjsmp                          2/2     Running   0          4d17h   172.16.106.149   k8s-worker-2   &lt;none&gt;           &lt;none&gt;\nnginx-ingress          nginx-ingress-nbhqc                          1/1     Running   0          5d19h   10.100.140.34    k8s-worker-2   &lt;none&gt;           &lt;none&gt;\n[root@k8s-master-2 ~]# \n</code></pre><p>ä»ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬çš„workerèŠ‚ç‚¹ä¸Šæœ‰9ä¸ªPodã€‚</p><p>ä¸è¿‡æˆ‘ä»¬ä¸€å¼€å§‹çœ‹å…¨å±€èµ„æºä¿¡æ¯çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰å‘ç°æ•´ä¸ªworkerèŠ‚ç‚¹çš„èµ„æºä½¿ç”¨ç‡å¾ˆé«˜ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å·²ç»åœ¨Podé‡Œé™åˆ¶äº†èµ„æºã€‚æ‰€ä»¥æˆ‘ä»¬åˆ—ä¸€ä¸‹æ¯ä¸ªPodçš„èµ„æºé™åˆ¶ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/42/11/42e9797ac167e0d058f585c12b762b11.jpg?wh=2000*759\" alt=\"\"></p><p>å¯¹äºé‚£äº›å…¶ä»–èµ„æºå ç”¨ä¸é«˜çš„Podï¼Œæˆ‘ä»¬å°±ä¸çœ‹äº†ã€‚</p><p>æ—¢ç„¶èµ„æºæœ‰é™åˆ¶ï¼Œé‚£æˆ‘ä»¬è¿˜è¦æŠŠç›®å…‰è½¬å›åˆ°Gatewayä¸Šé¢æ¥ã€‚</p><h3>å®šå‘ç›‘æ§åˆ†æ</h3><p>é€šè¿‡æŸ¥çœ‹é“¾è·¯æ—¶é—´ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½çŸ¥é“æ˜¯Gatewayä¸Šæ¶ˆè€—çš„æ—¶é—´è¾ƒé•¿ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/01/a7/0153e9a21e1c4428d6f602bcb11a1da7.png?wh=1424*356\" alt=\"\"></p><p>ä½†æ˜¯ï¼Œè¿™ä¸ªsendRequestæ˜¯å¹²å˜›çš„ï¼Ÿä¸çŸ¥é“ã€‚</p><p>é‚£æˆ‘ä»¬å°±åšä¸€ä¸ªè¯•éªŒï¼Œçœ‹çœ‹è·³è¿‡Gatewayä¹‹åçš„TPSæ˜¯å¤šå°‘ã€‚ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/16/31/1694f3dd8195b96cf0d0fe57254bb331.png?wh=1807*655\" alt=\"\"></p><p>å¯è§ï¼Œèµ°Gatewayï¼ŒTPSåªèƒ½æœ‰400å¤šï¼›ä¸èµ°Gatewayï¼ŒTPSèƒ½è¾¾åˆ°800å¤šã€‚æ‰€ä»¥ï¼Œé—®é¢˜ç¡®å®å‡ºåœ¨äº†Gatewayä¸Šã€‚</p><p>çœ‹åˆ°è¿™é‡Œï¼Œæœ‰ä¸€ä¸ªç¯èŠ‚æˆ‘ä»¬æ˜¯ç¼ºå¤±çš„ï¼Œé‚£å°±æ˜¯æŸ¥çœ‹Kuberneteså®¹å™¨é‡Œçš„Javaè¿›ç¨‹çš„å¥åº·çŠ¶æ€ã€‚å› ä¸ºæˆ‘ä»¬åœ¨å‰é¢æŸ¥äº†workerï¼Œä¹ŸæŸ¥äº†workerä¸Šçš„Podï¼Œæ‰€ä»¥ç°åœ¨å°±åˆ°äº†ç¬¬ä¸‰å±‚ï¼Œä¹Ÿå°±æ˜¯Podä¸­çš„Javaåº”ç”¨ã€‚</p><p>å¯¹æ­¤ï¼Œä½ ä¹Ÿä¸ç”¨æœ‰è´Ÿæ‹…ï¼Œä½ æƒ³æƒ³å¯¹äºä¸€ä¸ªJavaåº”ç”¨æ¥è¯´ï¼Œèƒ½æœ‰ä¸ªå•¥ï¼Ÿæ— éå°±æ˜¯å †ã€æ ˆä¸€é¡¿çœ‹ã€‚æ¥ï¼Œæˆ‘ä»¬æ‰“å°ä¸ªGatewayçš„æ ˆçœ‹ä¸€ä¸‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/48/3f/48930f2e0cd5464def2c0169b7bcdd3f.png?wh=1893*945\" alt=\"\"></p><p>ä»æ ˆä¸Šï¼Œå•¥ä¹Ÿæ²¡çœ‹å‡ºæ¥ï¼Œæ•´ä¸ªçŠ¶æ€ä¼¼ä¹éƒ½æŒºåˆç†çš„ã€‚ æ³¨æ„ï¼Œåœ¨è¿™é‡Œæˆ‘ä¸æ˜¯åªçœ‹ä¸€ä¸ªæˆªå›¾å“¦ï¼Œæˆ‘å·²ç»æŠŠæ•´ä¸ªæ ˆéƒ½æ’¸äº†ä¸€éã€‚ç”±äºCPUä¹Ÿä¸é«˜ï¼Œæˆ‘ä»¬åœ¨åˆ†ææ ˆçš„æ—¶å€™ï¼Œä¸»è¦çœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰é”ç­‰å¾…ã€‚ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œå¹¶æ²¡æœ‰é”ï¼Œç­‰å¾…ä¹Ÿéƒ½åˆç†ã€‚</p><p>çœ‹å®Œæ ˆä¹‹åï¼Œæ¥ä¸‹æ¥è¯¥çœ‹å †äº†ã€‚æˆ‘ä»¬å¾—æƒ³å°½åŠæ³•ï¼ŒæŠŠKubernetesçš„Javaè¿›ç¨‹å †æ‹¿å‡ºæ¥çœ‹çœ‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/90/81/9035c1762a408b1a56650a01b175aa81.png?wh=1793*777\" alt=\"\"></p><p>çœ‹åˆ°æ²¡ï¼å¦‚æ­¤è§„åˆ™çš„å…³è”å…³ç³»ï¼šTPSå’ŒGatewayçš„GCè¶‹åŠ¿æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚</p><p>ä¸è¿‡ï¼Œè¿™æ ·çœ‹è¿˜æ˜¯ä¸å¤Ÿå…·ä½“ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ›´ç»†çš„æ•°æ®ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¿›å»çœ‹ä¸€ä¸‹GCçŠ¶æ€ï¼š</p><pre><code>[root@gateway-mall-gateway-6567c8b49c-pc7rf /]# jstat -gcutil 1 1000 1000\n  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT   \n  0.00  55.45  45.33  52.96  94.74  92.77  38427 1953.428    94  113.940 2067.368\n 57.16   0.00  26.86  53.24  94.74  92.77  38428 1954.006    94  113.940 2067.946\n  0.00  54.30  15.07  53.65  94.74  92.77  38429 1954.110    94  113.940 2068.050\n 39.28   0.00  18.39  53.84  94.74  92.77  38430 1954.495    94  113.940 2068.435\n 39.28   0.00  81.36  53.84  94.74  92.77  38430 1954.495    94  113.940 2068.435\n  0.00  26.13  68.79  53.84  94.74  92.77  38431 1954.597    94  113.940 2068.537\n 39.18   0.00  59.75  53.84  94.74  92.77  38432 1954.683    94  113.940 2068.624\n  0.00  24.70  76.28  53.84  94.74  92.77  38433 1954.794    94  113.940 2068.734\n</code></pre><p>ä½ çœ‹ï¼Œä¸€æ¬¡YGCå¤§æ¦‚éœ€è¦100msï¼Œä¸€ç§’ä¸€æ¬¡YGCï¼Œè¿™æ ·YGCå°±å äº†10%å·¦å³ï¼Œè¿™ä¸ªæ—¶é—´æœ‰ç‚¹å¤šäº†ã€‚</p><p>æ—¢ç„¶YGCæ¶ˆè€—CPUè¾ƒé«˜ï¼Œé‚£æˆ‘ä»¬å°±è€ƒè™‘ä¼˜åŒ–Javaå‚æ•°ã€‚å…ˆæ¥çœ‹ä¸€ä¸‹Javaå‚æ•°ï¼š</p><pre><code>[root@gateway-mall-gateway-6567c8b49c-pc7rf /]# jinfo -flags 1\nAttaching to process ID 1, please wait...\nDebugger attached successfully.\nServer compiler detected.\nJVM version is 25.242-b08\nNon-default VM flags: -XX:CICompilerCount=2 -XX:InitialHeapSize=262144000 -XX:+ManagementServer -XX:MaxHeapSize=4164943872 -XX:MaxNewSize=1388314624 -XX:MinHeapDeltaBytes=196608 -XX:NewSize=87359488 -XX:OldSize=174784512 -XX:+UseCompressedClassPointers -XX:+UseCompressedOops \nCommand line:  -Dapp.id=svc-mall-gateway -javaagent:/opt/skywalking/agent/skywalking-agent.jar -Dskywalking.agent.service_name=svc-mall-gateway -Dskywalking.collector.backend_service=skywalking-oap:11800 -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.port=1100 -Dcom.sun.management.jmxremote.rmi.port=1100 -Djava.rmi.server.hostname=localhost -Dspring.profiles.active=prod -Djava.security.egd=file:/dev/./urandom\n[root@gateway-mall-gateway-6567c8b49c-pc7rf /]# \n</code></pre><p>ä»ä¸Šé¢çš„å‚æ•°ä¸­å°±å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘åœ¨Kubernetesçš„Javaè¿›ç¨‹ä¸­å¹¶æ²¡æœ‰é…ç½®GCå›æ”¶ç›¸å…³çš„å‚æ•°ã€‚æ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘ä»¬åŠ ä¸Šç›¸å…³çš„å‚æ•°ã€‚</p><p>åœ¨ä¸‹é¢çš„å‚æ•°ä¸­ï¼Œæˆ‘åŠ äº†PrintGCç›¸å…³çš„å‚æ•°ä»¥åŠParNewå‚æ•°ï¼š</p><pre><code>[root@gateway-mall-gateway-6c6f486786-mnd6j /]# jinfo -flags 1\nAttaching to process ID 1, please wait...\nDebugger attached successfully.\nServer compiler detected.\nJVM version is 25.261-b12\nNon-default VM flags: -XX:CICompilerCount=2 -XX:CompressedClassSpaceSize=1065353216 -XX:+HeapDumpOnOutOfMemoryError -XX:InitialHeapSize=2147483648 -XX:+ManagementServer -XX:MaxHeapSize=2147483648 -XX:MaxMetaspaceSize=1073741824 -XX:MaxNewSize=1073741824 -XX:MetaspaceSize=1073741824 -XX:MinHeapDeltaBytes=196608 -XX:NewSize=1073741824 -XX:OldSize=1073741824 -XX:ParallelGCThreads=6 -XX:+PrintGC -XX:+PrintGCApplicationConcurrentTime -XX:+PrintGCApplicationStoppedTime -XX:+PrintGCDateStamps -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintTenuringDistribution -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseParNewGC \nCommand line:  -Dapp.id=svc-mall-gateway -javaagent:/opt/skywalking/agent/skywalking-agent.jar -Dskywalking.agent.service_name=svc-mall-gateway -Dskywalking.collector.backend_service=skywalking-oap:11800 -Dcom.sun.management.jmxremote -Dcom.sun.management.jmxremote.authenticate=false -Dcom.sun.management.jmxremote.ssl=false -Dcom.sun.management.jmxremote.port=1100 -Dcom.sun.management.jmxremote.rmi.port=1100 -Djava.rmi.server.hostname=localhost -Xms2g -Xmx2g -XX:MetaspaceSize=1g -XX:MaxMetaspaceSize=1g -Xmn1g -XX:+UseParNewGC -XX:ParallelGCThreads=6 -XX:+HeapDumpOnOutOfMemoryError -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+PrintTenuringDistribution -XX:+PrintGCApplicationStoppedTime -XX:+PrintGCApplicationConcurrentTime -XX:+PrintGCDetails -Xloggc:gc.log -Dspring.profiles.active=prod -Djava.security.egd=file:/dev/./urandom\n[root@gateway-mall-gateway-6c6f486786-mnd6j /]# \n</code></pre><p>æœ¬æ¥æŒ‡æœ›ParNewèƒ½æœ‰å•¥ç”¨ï¼Œç„¶è€Œå¹¶æ²¡æœ‰ä»€ä¹ˆç”¨ã€‚</p><p>æ—¢ç„¶åŠ å‚æ•°ä¸æ˜¯èƒ½å¾ˆå¿«è§æ•ˆçš„ï¼Œé‚£æˆ‘ä»¬å°±å¾—çœ‹ä¸€ä¸‹YGCçš„æ—¶å€™å›æ”¶äº†ä»€ä¹ˆï¼Œç„¶åå†æ¥å†³å®šä»å“ªé‡Œä¸‹æ‰‹æ”¶æ‹¾Javaè¿›ç¨‹å†…å­˜çš„æ¶ˆè€—é—®é¢˜ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬æ‰“å°ä¸€ä¸‹jmap histoä¿¡æ¯ï¼Œæ¥çœ‹ä¸€ä¸‹å¯¹è±¡æ¶ˆè€—å†…å­˜çš„å˜åŒ–ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>[root@gateway-mall-gateway-6c6f486786-mnd6j /]# jmap -histo 1 | head -20\n\n\n num     #instances         #bytes  class name\n----------------------------------------------\n   1:       2010270      124874960  [C\n   2:        787127       91014984  [I\n   3:        601333       42467920  [Ljava.lang.Object;\n   4:       1534551       36829224  java.lang.String\n   5:        420603       31107504  [B\n   6:         21891       21972896  [Ljava.util.concurrent.ConcurrentHashMap$Node;\n   7:        186170       11914880  java.util.regex.Matcher\n   8:        228807       10982736  java.util.StringTokenizer\n   9:        291025        9312800  java.util.concurrent.ConcurrentHashMap$Node\n  10:        274253        8804936  [Ljava.lang.String;\n  11:        179524        8617152  org.springframework.web.util.pattern.PathPattern$MatchingContext\n  12:        210473        8418920  java.util.LinkedHashMap$Entry\n  13:        154562        6182480  io.netty.handler.codec.DefaultHeaders$HeaderEntry\n  14:        191349        6123168  java.util.LinkedList\n  15:        126218        6058464  java.util.TreeMap\n  16:         68528        6030464  java.lang.reflect.Method\n  17:         98411        5363408  [Ljava.util.HashMap$Node;\n[root@gateway-mall-gateway-6c6f486786-mnd6j /]# \n</code></pre><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸ªå‘½ä»¤å¤šæ‰§è¡Œå‡ æ¬¡ï¼Œçœ‹çœ‹å¯¹è±¡æ¶ˆè€—å†…å­˜çš„å˜åŒ–ã€‚å‰é¢æˆ‘ä»¬çœ‹åˆ°YGCè¿‡äºé¢‘ç¹ï¼Œä½†æ˜¯ä»å†…å­˜ä¸Šæ¥çœ‹ï¼Œå¯¹è±¡çš„å†…å­˜å›æ”¶å¾—æŒºå¥½ã€‚</p><p>æ‰€ä»¥ï¼Œå¯¹äºè¿™ç§YGCå¾ˆé«˜ï¼Œä½†ä»å¯¹è±¡å†…å­˜çš„æ¶ˆè€—åˆçœ‹ä¸å‡ºä»€ä¹ˆæœ‰æ•ˆä¿¡æ¯çš„é—®é¢˜ï¼Œåªæœ‰ä¸€ç§å¯èƒ½ï¼Œé‚£å°±æ˜¯å¯¹è±¡åˆ›å»ºå¾—å¿«ï¼Œé”€æ¯ä¹Ÿå¿«ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªåœ°æ–¹å¯ä»¥å‡†ç¡®æŸ¥æ‰¾å¯¹è±¡å†…å­˜çš„æ¶ˆè€—äº†ï¼Œé‚£å°±æ˜¯å¯¹è±¡çš„deltaã€‚æˆ‘ä»¬è¿ä¸ŠJvisualVMï¼Œçœ‹ä¸‹å†…å­˜å¯¹è±¡deltaå˜é‡ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/57/31/572cf090832be1da53f0fd04f8e27e31.png?wh=1540*541\" alt=\"\"></p><p>ï¼ˆæ³¨ï¼šè¿™å¼ å›¾ä¸Šçš„å­—ä¹‹æ‰€ä»¥è¿™ä¹ˆå°ï¼Œæ˜¯å› ä¸ºæˆ‘è¿çš„æ˜¯è¿œç¨‹Windowsæ¡Œé¢ï¼Œåˆ†è¾¨ç‡ä¸é«˜ï¼Œå®åœ¨æ²¡æœ‰åŠæ³•ã€‚ä¸è¿‡ï¼Œä½ è¦æ˜¯ä»”ç»†çœ‹çš„è¯ï¼Œè¿˜æ˜¯èƒ½çœ‹åˆ°æœ€ä¸Šé¢é‚£ä¸ªHashMapã€‚ï¼‰</p><p>æˆ‘æ¯”è¾ƒå–œæ¬¢ç”¨è¿™ç§è§†å›¾æ¥çœ‹deltaå€¼ã€‚ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œå¢åŠ å’Œé”€æ¯éƒ½å¾ˆå¿«ã€‚</p><p>åœ¨å‰é¢æˆ‘ä»¬åŠ äº†æ‰“å°GC logçš„å‚æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬æŠŠGC logæ‹¿å‡ºæ¥åˆ†æä¸€ä¸‹ï¼Œå¾—åˆ°ç»“æœå¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/86/01/86783a376c32ca492f6b0e7efed5d101.png?wh=1706*555\" alt=\"\"></p><p><img src=\"https://static001.geekbang.org/resource/image/69/11/69a1628494465a42dc29361bd1bc2811.png?wh=1709*806\" alt=\"\"></p><p><img src=\"https://static001.geekbang.org/resource/image/93/41/937e064499296cfa20442bf6d3aaec41.png?wh=1742*625\" alt=\"\"></p><p><img src=\"https://static001.geekbang.org/resource/image/a9/f2/a948d415bd3b32d437edbd0816757ff2.png?wh=1691*942\" alt=\"\"></p><p>ä»ä¸Šé¢çš„åˆ†ææ¥çœ‹ï¼Œä¸»è¦æ˜¯YGCåœ¨æ¶ˆè€—å“åº”æ—¶é—´ã€‚è¿™ä¸æˆ‘ä»¬å‰é¢çš„åˆ†æå»åˆï¼Œä½†æ˜¯æˆ‘ä»¬ä»æ—§æ²¡æœ‰æ‰¾åˆ°å…·ä½“çš„é—®é¢˜ç‚¹ã€‚</p><p>åœ¨è¿™ä¸ªé—®é¢˜çš„åˆ†æè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä¸æ–­åœ¨åšåº”ç”¨çš„ä¿®æ”¹ã€é‡å¯ç­‰åŠ¨ä½œã€‚ç»“æœï¼Œæ²¡æƒ³åˆ°æ€§èƒ½é—®é¢˜æ²¡è§£å†³ï¼Œåˆé‡åˆ°äº†ä¸¤ä¸ªå…¶ä»–é—®é¢˜ï¼Œç‰¹åœ°è®°å½•åœ¨è¿™é‡Œã€‚</p><p>ä¹‹æ‰€ä»¥è®°å½•è¿™æ ·çš„é—®é¢˜ï¼Œæ˜¯æƒ³å‘Šè¯‰ä½ ï¼š<strong>åœ¨æˆ‘ä»¬çš„åˆ†æè¿‡ç¨‹ä¸­ï¼Œä»€ä¹ˆæ ·çš„é—®é¢˜éƒ½æœ‰å¯èƒ½å­˜åœ¨ã€‚è€Œæˆ‘ä»¬è™½è¯´æ˜¯åšæ€§èƒ½åˆ†æçš„äººï¼Œä½†ä¹Ÿä¸æ˜¯åªåˆ†ææ€§èƒ½é—®é¢˜ï¼Œè€Œæ˜¯è§åˆ°é—®é¢˜å°±è¦å»è§£å†³ï¼Œè¦ä¸ç„¶ï¼Œä½ å°±èµ°ä¸ä¸‹å»</strong>ã€‚</p><h4>æ”¯çº¿é—®é¢˜ä¸€</h4><p>æˆ‘åœ¨æŸ¥æ‰¾å®¿ä¸»æœºæ—¥å¿—æ—¶å‘ç°å¦‚ä¸‹ä¿¡æ¯ï¼š</p><pre><code>[3594300.447892] ACPI Exception: AE_AML_BUFFER_LIMIT, Evaluating _PMM (20130517/power_meter-339)\n[3594360.439864] ACPI Error: SMBus/IPMI/GenericSerialBus write requires Buffer of length 66, found length 32 (20130517/exfield-389)\n[3594360.439874] ACPI Error: Method parse/execution failed [\\_SB_.PMI0._PMM] (Node ffff8801749b05f0), AE_AML_BUFFER_LIMIT (20130517/psparse-536)\n</code></pre><p>ä»é”™è¯¯ä¿¡æ¯æ¥çœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªACPIç¼“å­˜åŒºå¤§å°çš„é—®é¢˜ã€‚è¿™ä¸ªç¼“å­˜å¤§å°åœ¨BIOSå’Œå†…æ ¸ä¹‹é—´æ²¡æœ‰åå•†ä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯è¯´è¯·æ±‚çš„ç¼“å­˜åŒºå¤§å°æ˜¯66å­—èŠ‚ï¼Œè€Œç»™çš„å´æ˜¯32å­—èŠ‚ã€‚æ‰€ä»¥ï¼Œç”µæºç›‘æ§çš„ç®¡ç†æ¨¡å—å°±æŠ¥äº†å¼‚å¸¸ã€‚</p><p>è¿™æ˜¯ç¼ºå°‘å†…æ ¸æ¨¡å—å¼•èµ·çš„ï¼Œå› ä¸ºè¿™ä¸ªå†…æ ¸æ¨¡å—åœ¨æˆ‘æ‰€ç”¨çš„è¿™ä¸ªå†…æ ¸ç‰ˆæœ¬ä¸­ä¸ä¼šè‡ªåŠ¨æ›´æ–°ã€‚å¯¹åº”çš„è§£å†³æ–¹æ³•å€’ä¹Ÿç®€å•ï¼š</p><pre><code>echo &quot;blacklist acpi_power_meter&quot; &gt;&gt; /etc/modprobe.d/hwmon.conf\nmodprobe ipmi_si\nmodprobe acpi_ipmi\n</code></pre><p>å…¶ä¸­ï¼Œç¬¬ä¸€æ¡å‘½ä»¤æ˜¯ä¸ºäº†ä¸è®©è¿™ä¸ªé”™è¯¯å†æ¬¡å‡ºç°ã€‚å½“ç„¶äº†ï¼Œè¿™ä¸æ˜¯è§£å†³é—®é¢˜ï¼Œåªæ˜¯ä¸æƒ³çœ‹åˆ°è¿™ä¸ªæŠ¥é”™è€Œå¿ƒé‡Œçƒ¦ç‡¥ã€‚åé¢ä¸¤æ¡å‘½ä»¤æ˜¯æ‰‹åŠ¨åŠ è½½æ¨¡å—ï¼Œä½†å‰ææ˜¯ä½ è¦æ›´æ–°å†…æ ¸ç‰ˆæœ¬ã€‚</p><h4>æ”¯çº¿é—®é¢˜äºŒ</h4><p>å†å›åˆ°æˆ‘ä»¬åˆ†æçš„ä¸»çº¿ä¸Šï¼Œå‰é¢æåˆ°ä¸€ä¸ªJavaçš„YGCæ¶ˆè€—çš„CPUæ¯”è¾ƒé«˜ï¼Œä½†æ˜¯ä¸šåŠ¡é€»è¾‘åˆæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚æ‰€ä»¥ï¼Œæˆ‘å°è¯•æ¢ä¸€ä¸ªæœ€ç®€å•çš„Demoç¨‹åºï¼Œå…ˆæ¥æµ‹è¯•ä¸€ä¸‹æ•´ä¸ªé›†ä½“æ˜¯ä¸æ˜¯æ­£å¸¸çš„ã€‚è¿™ä¸ªDemoç¨‹åºæ²¡æœ‰ä»»ä½•ä¸šåŠ¡é€»è¾‘ï¼Œåªè¿”å›247Bçš„ç¤ºä¾‹ç¨‹åºã€‚</p><p>æˆ‘ç®€å•è¯´æ˜ä¸€ä¸‹ï¼Œæˆ‘ä¹‹æ‰€ä»¥æŠŠè¿™ä¸ªæµ‹è¯•è¿‡ç¨‹æ”¾åœ¨è¿™ä¸ªæ”¯çº¿é—®é¢˜ä¸­æ¥æè¿°ï¼Œæ˜¯æƒ³è®©æˆ‘çš„è¡Œä¸ºæ›´åŠ æœ‰æ¡ç†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d8/65/d8c0cbd80d3b2de6bb1c7a0cca0ea165.png?wh=1836*530\" alt=\"\"></p><p>åœ¨è¿™ä¸ªæµ‹è¯•è¿‡ç¨‹ä¸­ï¼Œæˆ‘æ‰§è¡Œäº†ä¸¤æ¬¡ã€‚ä¸Šå›¾çš„å‰åŠéƒ¨åˆ†èµ°äº†Ingressï¼Œåé¢æ²¡æœ‰èµ°Ingressï¼Œå¯æ˜¯åé¢TPSå¹¶æ²¡æœ‰æ‰ä¸‹æ¥ã€‚è¿™æ—¶ï¼Œé—®é¢˜å°±åŸºæœ¬æ¸…æ¥šäº†ã€‚</p><p>æˆ‘è¿™é‡Œåˆ—ä¸ªè¡¨æ ¼æ¢³ç†ä¸€ä¸‹åˆ°ç°åœ¨çœ‹åˆ°çš„ä¿¡æ¯ï¼Œç†ç†æ€è·¯ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/5e/91/5eca82b2dc67e069edbddfc946e8f991.jpg?wh=2000*759\" alt=\"\"></p><p>ä»ä»¥ä¸Šæ•°æ®å¯ä»¥åˆ¤æ–­å‡ºï¼ŒTPSæ‰ä¸‹æ¥å’ŒIngressæœ‰ç»å¯¹çš„å…³ç³»ã€‚é‚£æˆ‘ä»¬å°±æ¥çœ‹çœ‹Ingressçš„æ—¥å¿—ï¼š</p><pre><code>root@nginx-ingress-m9htx:/var/log/nginx# ls -lrt\ntotal 0\nlrwxrwxrwx 1 root root 12 Sep 10  2019 stream-access.log -&gt; /proc/1/fd/1\nlrwxrwxrwx 1 root root 12 Sep 10  2019 error.log -&gt; /proc/1/fd/2\nlrwxrwxrwx 1 root root 12 Sep 10  2019 access.log -&gt; /proc/1/fd/1\nroot@nginx-ingress-m9htx:/proc/1/fd# ls -lrt\ntotal 0\nlrwx------ 1 root root 64 Jan  7 18:00 7 -&gt; 'socket:[211552647]'\nlrwx------ 1 root root 64 Jan  7 18:00 4 -&gt; 'anon_inode:[eventpoll]'\nlrwx------ 1 root root 64 Jan  7 18:00 3 -&gt; 'socket:[211552615]'\nl-wx------ 1 root root 64 Jan  7 18:00 2 -&gt; 'pipe:[211548854]'\nl-wx------ 1 root root 64 Jan  7 18:00 1 -&gt; 'pipe:[211548853]'\nlrwx------ 1 root root 64 Jan  7 18:00 0 -&gt; /dev/null\nroot@nginx-ingress-m9htx:/proc/1/fd# find ./ -inum 212815739\nroot@nginx-ingress-m9htx:/proc/1/fd# find ./ -inum 212815740\n</code></pre><p>æ‚²æ€†çš„æ„Ÿè§‰ï¼ä½ çœ‹ï¼Œæ—¥å¿—ç›´æ¥é‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯äº†ï¼Œè€Œæ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯é»˜è®¤éƒ½æ˜¯å±å¹•ã€‚é‚£æˆ‘ä»¬å°±åˆ°Kubernetesç®¡ç†å·¥å…·ä¸­å»è¿½è¸ªæ—¥å¿—ã€‚å¯æ˜¯ï¼Œç»“æœæ˜¯å•¥ä¹Ÿæ²¡æœ‰ã€‚å”‰ï¼Œè¿™å¯æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>ä»ä¸‹é¢è¿™å¼ å›¾æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œå½“å‹åŠ›ç»è¿‡è¿™ä¸ªIngressæ—¶ï¼ŒæŠ¥é”™æ˜¯å¿…ç„¶çš„ï¼Œå‹åŠ›è¶Šå¤§ï¼ŒæŠ¥é”™è¶Šå¤šã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/ea/3c/ea69119818e9e0e014c979a137efc23c.png?wh=1820*758\" alt=\"\"></p><p>å¯æ˜¯åˆ†æåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å†æ²¡æœ‰å…¶ä»–å¯ä»¥åˆ†æçš„æ—¥å¿—äº†ã€‚æ²¡ä»€ä¹ˆåŠæ³•ï¼Œåªèƒ½æŸ¥ä¸€ä¸‹Ingressçš„ç‰ˆæœ¬äº†ï¼Œç»“æœå‘ç°ï¼Œå½“å‰çš„Ingresså·²ç»æœ‰äº†æ–°çš„ç‰ˆæœ¬ã€‚</p><p>ä¸ºäº†é¿å…å»è¸©Ingressæœ¬èº«å­˜åœ¨çš„ä¸€äº›å‘ï¼Œæˆ‘æŠŠå®ƒçš„ç‰ˆæœ¬ä»1.5.5æ¢åˆ°1.9.1ä¹‹åï¼Œå¾—åˆ°å¦‚ä¸‹ç»“æœï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/61/e9/61dd625bd75c44e2d2dd1f56678202e9.png?wh=1829*829\" alt=\"\"></p><p>ä½ çœ‹å›¾ä¸­æ²¡æœ‰æŠ¥é”™äº†ï¼Œçœ‹æ¥é‚£äº›é”™è¯¯æ˜¯Ingressç‰ˆæœ¬å¯¼è‡´çš„ã€‚</p><p>ç„¶è€Œï¼Œå³ä¾¿å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ²¡æœ‰è§£å†³TPSä¼šæ‰çš„é—®é¢˜ã€‚ä½ å¯èƒ½ä¼šè¯´ï¼Œä¸Šé¢è¿™å¼ å›¾é‡Œçš„TPSä¸æ˜¯æ²¡æœ‰æ‰å—ï¼Ÿå…¶å®ï¼Œè¿™åªæ˜¯å‡è±¡ã€‚åœ¨ä¸Šé¢çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯ä¸ºäº†éªŒè¯Ingressçš„é—®é¢˜ï¼Œæ‰€ä»¥ï¼Œæ‰§è¡Œæ—¶é—´å¹¶ä¸é•¿ã€‚</p><p>è¯·ä½ æ³¨æ„ï¼Œæˆ‘ä»¬åˆ°è¿™é‡Œå¹¶æ²¡æœ‰è§£å†³å‰é¢æ‰€è¯´çš„TPSä¼šæ‰çš„é—®é¢˜ã€‚åº”è¯¥è¯´ï¼Œæˆ‘ä»¬è¿™é‡Œå¯èƒ½æœ‰ä¸¤ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªæ˜¯Ingressï¼Œè€Œå¦ä¸€ä¸ªå¯èƒ½æ˜¯åœ¨å…¶ä»–åœ°æ–¹ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ²¡æœ‰å»éªŒè¯ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¦å›åˆ°ä¸»çº¿ä¸Šï¼Œç»§ç»­æ¥åˆ†æå®ƒã€‚</p><h4>å›åˆ°ä¸»çº¿</h4><p>ç»è¿‡ä¸€ç¿»æŠ˜è…¾ï¼Œä½ æ˜¯ä¸æ˜¯æ„Ÿè§‰è„‘è¢‹å·²ç»æ™•äº†ï¼Ÿå½“æˆ‘ä»¬è¢«ä¸€äº›æŠ€æœ¯ç»†èŠ‚æ·±æ·±æ‹–è¿›å»çš„æ—¶å€™ï¼Œä¸€å®šè¦ä¿æŒæ¸…é†’ã€‚</p><p>æ ¹æ®æˆ‘çš„ç»éªŒï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥åœ¨çº¸ä¸Šç”»ä¸€ä¸‹æ¶æ„å›¾ã€‚å¹¶ä¸æ˜¯è¯´å‰é¢å·²ç»æœ‰æ¶æ„å›¾ï¼Œæˆ‘ä»¬å°±ä¸ç”¨ç”»äº†ã€‚ç”»æ¶æ„å›¾æ˜¯ä¸ºäº†å¸®æˆ‘ä»¬æ¢³ç†æ€è·¯ã€‚å¹¶ä¸”æˆ‘ä»¬è¿˜è¦ç”»å¾—å†ç»†ä¸€ç‚¹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/54/a7/5404ce9653d310167bc0d0b4fabc91a7.jpg?wh=2000*750\" alt=\"\"></p><p>ç»è¿‡æ¢³ç†ï¼Œæˆ‘é‡‡ç”¨åˆ†æ®µæµ‹æ³•æ¥åˆ¤æ–­é—®é¢˜ä¸å“ªä¸€å±‚ç›¸å…³ï¼šå› ä¸ºCartæœåŠ¡éœ€è¦é€šè¿‡å¤–éƒ¨è°ƒç”¨èµ°ç½‘å…³ï¼Œé‚£æˆ‘åœ¨è¿™é‡Œç›´æ¥è°ƒç”¨CartæœåŠ¡ï¼Œä¸èµ°ç½‘å…³ã€‚å¹¶ä¸”æˆ‘ä¹Ÿè·³è¿‡Ingressï¼Œç›´æ¥ç”¨NodePortæ¥æä¾›æœåŠ¡ï¼Œçœ‹çœ‹TPSæœ‰æ²¡æœ‰è°ƒä¸‹æ¥ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ç›´æ¥ä»cartæœåŠ¡çš„NodePortå‹è¿›å»ï¼Œå¾—åˆ°è¿™æ ·çš„ç»“æœï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/44/7e/445d5c2da479e860ca9813b9f4124a7e.png?wh=1838*529\" alt=\"\"></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒCartæœåŠ¡æœ¬èº«å°±ä¼šå¯¼è‡´TPSé™ä¸‹æ¥ï¼Œçœ‹èµ·æ¥ä¹Ÿå¹¶ä¸è§„å¾‹ã€‚</p><p>é‚£æˆ‘ä»¬å°±ä¿®æ”¹Tomcatå‚æ•°ï¼ŒæŠŠçº¿ç¨‹æ•°ã€è¿æ¥æ•°è°ƒå¤§ï¼Œå†æ¥ä¸€æ¬¡ã€‚ä½ å¯èƒ½å¥‡æ€ªï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·è°ƒå‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºåœ¨æŸ¥çœ‹åº”ç”¨çº¿ç¨‹å¥åº·çŠ¶æ€çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘æ³¨æ„åˆ°Spring Booté‡Œçš„Tomcatçº¿ç¨‹å¾ˆå¿™ã€‚</p><p>åœ¨æˆ‘è¿™æ ·åå¤éªŒè¯äº†å‡ æ¬¡ä¹‹åï¼Œå‘ç°TPSå¹¶æ²¡æœ‰æ‰ä¸‹å»ã€‚</p><p>ä¸ºäº†è¿›ä¸€æ­¥éªŒè¯TPSå’Œä¸Šé¢çš„çº¿ç¨‹æ•°ã€è¿æ¥æ•°ç­‰å‚æ•°æœ‰å…³ï¼Œæˆ‘åˆç‰¹æ„æŠŠé…ç½®æ”¹å›å»ï¼Œå†çœ‹æ˜¯ä¸æ˜¯Tomcatå‚æ•°çš„é—®é¢˜ã€‚</p><p>ç»“æœï¼ŒTPSæ‰ä¸‹å»çš„æƒ…å†µæ²¡æœ‰å¤ç°ï¼</p><p><img src=\"https://static001.geekbang.org/resource/image/e5/1a/e5b0fee657d8d6d84f0bc57yy755421a.png?wh=1815*658\" alt=\"\"></p><p>æ°”å¾—æˆ‘ä¸å¾—ä¸åƒä»½éº»è¾£çƒ«å‘æ³„ä¸€ä¸‹ã€‚æœ¬æ¥æˆ‘å·²ç»çœ‹åˆ°äº†TPSæ‰ä¸‹æ¥å’ŒGCæœ‰å…³ã€‚å¹¶ä¸”ï¼Œæˆ‘ä»¬åœ¨GCä¸­ç»è¿‡ä¸€é¡¿åˆ†æå‘ç°ï¼ŒServletçš„hashmap$nodeåœ¨å¿«é€Ÿåœ°åˆ›å»ºå’Œå›æ”¶ï¼Œè¯´æ˜YGCæ¶ˆè€—èµ„æºå¤šå’Œå‹åŠ›å¤§å°æœ‰å…³ï¼Œæ‰€ä»¥è°ƒäº†Tomcatç›¸å…³çš„å‚æ•°ã€‚å¯æ˜¯ï¼Œç°åœ¨åœ¨åŒæ ·çš„å‹åŠ›ä¸‹ï¼Œé—®é¢˜ç«Ÿç„¶ä¸èƒ½å¤ç°ï¼Œä¹ŸçœŸæ˜¯é†‰äº†ã€‚</p><p>åƒè¿™ç§éšæœºçš„é—®é¢˜æ˜¯æ¯”è¾ƒéš¾æ•´çš„ã€‚ä¸çŸ¥é“TPSç¨³å®šçš„å‡è±¡æ˜¯ä¸æ˜¯å’Œä¸­é—´æœ‰è¿‡é‡å¯æœ‰å…³ã€‚è¯è¯´é‡å¯å¤§æ³•ï¼Œåœ¨æŠ€æœ¯é¢†åŸŸä¸­çœŸæ˜¯ç»å¯¹çš„å¤§æ‹›ã€‚</p><p>æ—¢ç„¶è¿™ä¸ªé—®é¢˜æ²¡æœ‰å¤ç°ï¼Œç°åœºä¹Ÿæ²¡æœ‰äº†ï¼Œæˆ‘ä»¬ä¹Ÿåªèƒ½æ”¾å¼ƒã€‚</p><p>è™½ç„¶é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä»å‰åˆ°åçš„åˆ†æé€»è¾‘éƒ½éå¸¸åˆç†ï¼Œä½†æ˜¯ä»ç„¶æ²¡æœ‰æ‰¾åˆ°é—®é¢˜ç‚¹åœ¨å“ªé‡Œã€‚å¦‚æœå®ƒæ˜¯ä¸€ä¸ªéšæœºçš„é—®é¢˜ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬æ²¡æœ‰åœ¨åˆé€‚çš„æ—¶æœºæŠ“åˆ°é—®é¢˜çš„åŸå› ã€‚</p><p>å¯¹äºä¸€ä¸ªé¡¹ç›®æ¥è¯´ï¼Œå¦‚æœå‡ºç°çš„éšæœºé—®é¢˜å¯¹ä¸šåŠ¡é€ æˆçš„å½±å“æ˜¯ä¸èƒ½æ¥å—çš„ï¼Œé‚£æˆ‘ä»¬å°±å¿…é¡»èŠ±å¤§ç²¾åŠ›å»è§£å†³ã€‚å¦‚æœå½±å“ä¸å¤§ï¼Œé‚£ä¹Ÿå¯ä»¥å…ˆæ”¾ä¸€æ”¾ã€‚ä½†æ˜¯æ¯ä¸€ä¸ªé—®é¢˜éƒ½æœ‰å‡ºç°çš„å¿…ç„¶æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œé‚£äº›çœ‹ä¼¼éšæœºçš„é—®é¢˜ï¼Œå…¶å®åœ¨æŠ€æœ¯ä¸­éƒ½æœ‰ç€ç»å¯¹çš„å¿…ç„¶æ€§ã€‚</p><p>é‚£è¿™ä¸ªé—®é¢˜åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿåœ¨è¿™é‡Œï¼Œæˆ‘å…ˆç•™ä¸€ä¸ªæ‚¬å¿µï¼Œå› ä¸ºå†ç»§ç»­åˆ†æä¸‹å»ï¼Œæˆ‘ä»¬è¿™èŠ‚è¯¾å°±å¤ªé•¿äº†ï¼Œä½ çœ‹ç€ä¹Ÿå¾ˆç´¯ã€‚ä¸‹èŠ‚è¯¾æˆ‘ä»¬æ¥ç€åˆ†æã€‚</p><h2>æ€»ç»“</h2><p>åœ¨è¿™èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬è®²äº†ä¸¤ä¸ªé˜¶æ®µçš„æ€§èƒ½åˆ†æã€‚</p><p>ç¬¬ä¸€ä¸ªé˜¶æ®µæ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ªæŸ¥è¯¢çš„é—®é¢˜ã€‚å¯¹äºæŸ¥è¯¢æ¥è¯´ï¼Œåœ¨å®æ—¶äº¤æ˜“çš„è¿‡ç¨‹ä¸­ï¼Œæœ€å¥½èƒ½å¤Ÿç²¾å‡†æŸ¥æ‰¾ã€‚å¦‚æœå‡ºç°èŒƒå›´æŸ¥è¯¢ï¼Œé‚£å°±å¿…é¡»è¦æœ‰åˆ†é¡µã€‚</p><p>ä¸è¿‡ï¼Œå¦‚æœæ˜¯å¤§èŒƒå›´çš„æŸ¥è¯¢ï¼Œé‚£ä¸ä»…ä¼šå¯¹ç½‘ç»œé€ æˆå‹åŠ›ï¼ŒåŒæ—¶è¿˜ä¼šå¯¹åº”ç”¨ã€æ•°æ®åº“ç­‰å„å±‚éƒ½äº§ç”Ÿéå¸¸æ˜æ˜¾çš„å‹åŠ›ã€‚æ‰€ä»¥ï¼Œåœ¨å‡ºç°èŒƒå›´æŸ¥è¯¢æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»åšå¥½æŠ€æœ¯é€‰å‹ã€‚å½“ä¸šåŠ¡å¿…é¡»åšè¿™æ ·çš„èŒƒå›´æŸ¥è¯¢æ—¶ï¼Œä½ å¯ä»¥è€ƒè™‘æ¢ç»„ä»¶ï¼Œåƒå¤§æ•°æ®è¿™æ ·çš„æ€è·¯å°±å¯ä»¥ç”¨èµ·æ¥äº†ã€‚</p><p>ç¬¬äºŒä¸ªé˜¶æ®µæœ‰ç‚¹éº»çƒ¦ï¼Œè™½ç„¶æˆ‘ä»¬èŠ±äº†å¾ˆå¤šæ—¶é—´ç²¾åŠ›ï¼Œä½†æ˜¯åˆ°æœ€åæ²¡æœ‰æ‰¾åˆ°æ ¹æœ¬åŸå› ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬åˆ†æçš„æ–¹å‘å’Œæ€è·¯éƒ½æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚</p><p>å¯¹äºè¿™ç§çœ‹ä¼¼å¾ˆéšæœºçš„é—®é¢˜ï¼Œåœ¨å®é™…çš„é¡¹ç›®ä¸­ä¹Ÿç»å¸¸å‡ºç°ã€‚æˆ‘ä»¬åˆ†æåˆ°æœ€åå¯èƒ½ä¼šå‘ç°è¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„é—®é¢˜ï¼Œè®©äººæ°”å¾—ç›´è·ºè„šã€‚è‡³äºè¿™ä¸ªé—®é¢˜çš„æ ¹æœ¬åŸå› æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†åšè¯´æ˜ã€‚</p><p>æ— è®ºå¦‚ä½•ï¼Œåœ¨è¿™èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬ä»ç„¶æŠŠåˆ†æçš„é€»è¾‘æè¿°å®Œæ•´äº†ï¼Œå¸Œæœ›èƒ½ç»™åˆ°ä½ ä¸€äº›å®Œæ•´çš„æ€è·¯ã€‚</p><h2>è¯¾åä½œä¸š</h2><p>æœ€åï¼Œè¯·ä½ æ€è€ƒä¸€ä¸‹ï¼š</p><ol>\n<li>åœ¨å®æ—¶äº¤æ˜“ä¸­ï¼Œå¦‚ä½•å¿«é€Ÿåˆ¤æ–­æ•°æ®åº“çš„æ•°æ®é‡æ‰€å¼•å‘çš„æ€§èƒ½é—®é¢˜ï¼Ÿå®šå‘åˆ†æçš„è¯æ®é“¾æ˜¯ä»€ä¹ˆï¼Ÿ</li>\n<li>å¦‚ä½•ä»CPUä½¿ç”¨é«˜å®šä½åˆ°GCæ•ˆç‡å¼•å‘çš„æ€§èƒ½é—®é¢˜ï¼Ÿ</li>\n</ol><p>è®°å¾—åœ¨ç•™è¨€åŒºå’Œæˆ‘è®¨è®ºã€äº¤æµä½ çš„æƒ³æ³•ï¼Œæ¯ä¸€æ¬¡æ€è€ƒéƒ½ä¼šè®©ä½ æ›´è¿›ä¸€æ­¥ã€‚</p><p>å¦‚æœä½ è¯»å®Œè¿™ç¯‡æ–‡ç« æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿ä½ åˆ†äº«ç»™ä½ çš„æœ‹å‹ï¼Œå…±åŒå­¦ä¹ è¿›æ­¥ã€‚æˆ‘ä»¬ä¸‹è¿™èŠ‚è¯¾å†è§ï¼</p>","neighbors":{"left":{"article_title":"16 | å•†å“åŠ å…¥è´­ç‰©è½¦ï¼šSQLä¼˜åŒ–å’Œå‹åŠ›å·¥å…·ä¸­çš„å‚æ•°åˆ†æ","id":367285},"right":{"article_title":"18 | è´­ç‰©è½¦ä¿¡æ¯ç¡®å®šè®¢å•ï¼šä¸ºä»€ä¹ˆåŠ¨æ€å‚æ•°åŒ–é€»è¾‘éå¸¸é‡è¦ï¼Ÿ","id":369247}},"comments":[{"had_liked":false,"id":290453,"user_name":"zhian","can_delete":false,"product_type":"c1","uid":2537060,"ip_address":"","ucode":"BA374260112ACC","user_header":"","comment_is_top":false,"comment_ctime":1619572905,"is_pvip":false,"replies":[{"id":"105266","content":"æ ¹æ®æ¶æ„å›¾çš„è·¯å¾„ï¼Œå‰ä¸€èŠ‚ç‚¹åŒ…æ‹¬åé¢æ‰€æœ‰èŠ‚ç‚¹çš„æ—¶é—´ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1619575718,"ip_address":"","comment_id":290453,"utype":1}],"discussion_count":3,"race_medal":0,"score":"10209507497","product_id":100074001,"comment_content":"é«˜è€å¸ˆæ‚¨å¥½ï¼Œæƒ³é—®ä¸€ä¸‹æ‚¨ï¼Œæ€ä¹ˆçœ‹æ‡‚å’Œç†è§£sky walkingå›¾ç‰‡é‡Œå“åº”æ—¶é—´çš„æ‹†åˆ†å‘¢ï¼Œæ¯”å¦‚cart- memberï¼Œcartå®¢æˆ·ç«¯ã€cartæœåŠ¡ç«¯è¿™äº›å“åº”æ—¶é—´msï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519208,"discussion_content":"æ ¹æ®æ¶æ„å›¾çš„è·¯å¾„ï¼Œå‰ä¸€èŠ‚ç‚¹åŒ…æ‹¬åé¢æ‰€æœ‰èŠ‚ç‚¹çš„æ—¶é—´ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619575718,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1421216,"avatar":"https://static001.geekbang.org/account/avatar/00/15/af/a0/617e4144.jpg","nickname":"å¤©ç‹¼","note":"","ucode":"40C47F0480DB87","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372069,"discussion_content":"é‚£å°±æ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹çš„å“åº”æ—¶é—´å°±æ˜¯æœ€åä¸€ä¸ªæœåŠ¡æ‰€èŠ±è´¹çš„æ—¶é—´äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620175500,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1785980,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/40/7c/43bafeb8.jpg","nickname":"å–„è¡Œé€š","note":"","ucode":"AC9159314DEA5A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":370908,"discussion_content":"å¦‚æœæ˜¯æˆ‘çš„è¯ï¼Œå…ˆåˆ†æä¸šåŠ¡ä¹‹é—´çš„è°ƒç”¨å…³ç³»ï¼Œåœ¨çœ‹skywalkingå›¾","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619578104,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":302852,"user_name":"jy","can_delete":false,"product_type":"c1","uid":1785172,"ip_address":"","ucode":"F4E179C435451B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJ6G2xZvNRmhyXBjmGbI5G8icGCCMPupr6yxZ1IcURwp7GTRHcpWGWpg9A0fLlyicmVdDwzqZqwiaOQ/132","comment_is_top":false,"comment_ctime":1626407065,"is_pvip":false,"replies":[{"id":"109635","content":"1. å› ä¸ºè¿™ä¸ªé—®é¢˜å’Œgcæ— å…³ï¼Œæ˜¯ç”±äºèµ„æºäº‰ç”¨æ‰äº§ç”Ÿçš„ygcé¢‘ç¹ã€‚åé¢æ–‡ç« ä¸­æœ‰ç›¸åº”çš„ä¼˜åŒ–åŠ¨ä½œã€‚<br>2. å¹´è€ä»£ä¸å°±æ˜¯cmså—ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1626491682,"ip_address":"","comment_id":302852,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5921374361","product_id":100074001,"comment_content":"è€å¸ˆï¼Œæœ‰ä¸¤ä¸ªç–‘é—®ï¼Œè°¢è°¢ã€‚<br>1ã€çœ‹äº†17å’Œ18ï¼Œå¯¹ygcé¢‘ç¹çš„é—®é¢˜æ²¡çœ‹åˆ°ä¸‹æ–‡å‘¢ï¼Ÿæ˜¯ä¸æ˜¯å¹´è½»ä»£è®¾ç½®ä¸åˆç†å¯¼è‡´ygcé¢‘ç¹ä¸”è€—æ—¶å¤šï¼Ÿæˆ–è€…è€ƒè™‘å¹¶å‘æ”¶é›†å™¨G1å¹¶è®¾ç½®åœé¡¿æ—¶é—´ï¼ˆå¯¹åœé¡¿æ—¶é—´æœ‰è¦æ±‚ï¼‰<br><br>2ã€-XX:+UseParNewGCæ˜¯å¹´è½»ä»£æ”¶é›†å™¨ï¼Œé‚£è€å¹´ä»£æ”¶é›†å™¨æ˜¯ï¼Ÿ æˆ‘è®°å¾—CMSæ˜¯å’ŒParNewé…åˆä½¿ç”¨çš„ï¼Œå¦‚æœæ˜¯cmsï¼Œç›´æ¥æŒ‡å®šï¼š-XX:+UseConcMarkSweepGC","like_count":1,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523456,"discussion_content":"1. å› ä¸ºè¿™ä¸ªé—®é¢˜å’Œgcæ— å…³ï¼Œæ˜¯ç”±äºèµ„æºäº‰ç”¨æ‰äº§ç”Ÿçš„ygcé¢‘ç¹ã€‚åé¢æ–‡ç« ä¸­æœ‰ç›¸åº”çš„ä¼˜åŒ–åŠ¨ä½œã€‚\n2. å¹´è€ä»£ä¸å°±æ˜¯cmså—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626491682,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314048,"user_name":"LQQ","can_delete":false,"product_type":"c1","uid":1529915,"ip_address":"","ucode":"172A84730ED0A3","user_header":"https://static001.geekbang.org/account/avatar/00/17/58/3b/22dbe7c3.jpg","comment_is_top":false,"comment_ctime":1632817970,"is_pvip":false,"replies":[{"id":"114799","content":"è¿™ä¸ªï½æˆ‘æ²¡ä¿å­˜ã€‚ğŸ˜Š","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1634689469,"ip_address":"","comment_id":314048,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1632817970","product_id":100074001,"comment_content":"è€å¸ˆ   è¯·é—®ä¸€ä¸‹   æ”¯çº¿é—®é¢˜2ä¸­æŠ¥çš„é”™å…·ä½“æ˜¯ä»€ä¹ˆé”™è¯¯ï¼Ÿå¯å¦è´´å‡ºæ¥ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527555,"discussion_content":"è¿™ä¸ªï½æˆ‘æ²¡ä¿å­˜ã€‚ğŸ˜Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634689469,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":307706,"user_name":"VeryYoung","can_delete":false,"product_type":"c1","uid":1198965,"ip_address":"","ucode":"50E129987FE4E5","user_header":"https://static001.geekbang.org/account/avatar/00/12/4b/75/71845744.jpg","comment_is_top":false,"comment_ctime":1629207906,"is_pvip":false,"replies":[{"id":"111477","content":"æ–‡ä¸­æœ‰è¯´å‘€ï¼Œåœ¨æ”¯çº¿é—®é¢˜ä¸­ï¼Œç”¨èµ°ingresså’Œä¸èµ°ingresséƒ½æ‰§è¡Œäº†ä¸€ä¸‹åœºæ™¯ã€‚<br>è¿™æ ·åšæ˜¯ä¸ºäº†åˆ†æ®µæµ‹è¯•ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1629292932,"ip_address":"","comment_id":307706,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1629207906","product_id":100074001,"comment_content":"è€å¸ˆä½ å¥½ï¼Œè¯·é—®ä¸‹Ingressçš„é—®é¢˜æ˜¯åœ¨å“ªé‡Œå‘ç°çš„ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525250,"discussion_content":"æ–‡ä¸­æœ‰è¯´å‘€ï¼Œåœ¨æ”¯çº¿é—®é¢˜ä¸­ï¼Œç”¨èµ°ingresså’Œä¸èµ°ingresséƒ½æ‰§è¡Œäº†ä¸€ä¸‹åœºæ™¯ã€‚\nè¿™æ ·åšæ˜¯ä¸ºäº†åˆ†æ®µæµ‹è¯•ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629292932,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":301400,"user_name":"zwm","can_delete":false,"product_type":"c1","uid":1787187,"ip_address":"","ucode":"BDF98B3A1CD406","user_header":"https://static001.geekbang.org/account/avatar/00/1b/45/33/cdea4bca.jpg","comment_is_top":false,"comment_ctime":1625663049,"is_pvip":false,"replies":[{"id":"109162","content":"ä¸Šé¢ä¸æ˜¯è¯´ï¼Œåœ¨gatewayä¸Šæ¶ˆè€—çš„æ—¶é—´é•¿å—ï¼Ÿæ‰€ä»¥è¦çœ‹gatewayæ‰€åœ¨çš„workerä¸Šçš„å†…å­˜èµ„æºï¼Œè€Œworkeræ˜¯ä¸Šåˆæœ‰å¯èƒ½è¿è¡Œç€å…¶ä»–çš„æœåŠ¡ï¼Œæ‰€ä»¥æ¥ç€æŸ¥ä¸‹å»ã€‚ ","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1625755389,"ip_address":"","comment_id":301400,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1625663049","product_id":100074001,"comment_content":"æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£æˆ‘ä»¬å…ˆæŸ¥ä¸€ä¸‹ Gateway åœ¨å“ªä¸ª worker ä¸Š<br><br>è€å¸ˆï¼Œä¸ºä»€ä¹ˆåº”ç”¨æ‰€åœ¨çš„workerçœ‹ä¸åˆ°å†…å­˜ï¼Œä¹‹åå°±è·³åˆ°æ’æŸ¥ ç½‘å…³äº†ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522990,"discussion_content":"ä¸Šé¢ä¸æ˜¯è¯´ï¼Œåœ¨gatewayä¸Šæ¶ˆè€—çš„æ—¶é—´é•¿å—ï¼Ÿæ‰€ä»¥è¦çœ‹gatewayæ‰€åœ¨çš„workerä¸Šçš„å†…å­˜èµ„æºï¼Œè€Œworkeræ˜¯ä¸Šåˆæœ‰å¯èƒ½è¿è¡Œç€å…¶ä»–çš„æœåŠ¡ï¼Œæ‰€ä»¥æ¥ç€æŸ¥ä¸‹å»ã€‚ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625755389,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291619,"user_name":"é“é•¿","can_delete":false,"product_type":"c1","uid":2330999,"ip_address":"","ucode":"15B2E9CEF84634","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/KhQRc8hIxHHyPV3Og2Fc5l8w2y7ibGwGn6odmzl3wTt6fPrNv589uHmia1rgiaZhRiaLVHv9ibhzkxFx1zo42uNIS9A/132","comment_is_top":false,"comment_ctime":1620388269,"is_pvip":false,"replies":[{"id":"105639","content":"æ‰€ä»¥è¦å­¦æ€è·¯å˜›ã€‚å¡ä½çš„åŸå› ä¸æ˜¯å› ä¸ºä¸çŸ¥é“æ‰‹æ®µï¼Œè€Œæ˜¯ä¼šäº†ä¸€å †æ‰‹æ®µï¼Œä¸çŸ¥é“æ€ä¹ˆç”¨ã€‚ ","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1620451407,"ip_address":"","comment_id":291619,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1620388269","product_id":100074001,"comment_content":"å’±è¿™å‹æµ‹ç»ƒä¹ å¥½å¤šæ—¶å€™ï¼Œæ‰¾åˆ°é—®é¢˜äº†ä¸çŸ¥é“å¦‚ä½•å»ä¼˜åŒ–ï¼Œå°±å¡é‚£äº†ã€‚","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519525,"discussion_content":"æ‰€ä»¥è¦å­¦æ€è·¯å˜›ã€‚å¡ä½çš„åŸå› ä¸æ˜¯å› ä¸ºä¸çŸ¥é“æ‰‹æ®µï¼Œè€Œæ˜¯ä¼šäº†ä¸€å †æ‰‹æ®µï¼Œä¸çŸ¥é“æ€ä¹ˆç”¨ã€‚ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620451407,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290695,"user_name":"å¼ ä¸œç‚«","can_delete":false,"product_type":"c1","uid":1169380,"ip_address":"","ucode":"B93BDFF4C2673D","user_header":"https://static001.geekbang.org/account/avatar/00/11/d7/e4/a8fe6d0d.jpg","comment_is_top":false,"comment_ctime":1619690147,"is_pvip":false,"replies":[{"id":"105648","content":"æ­å»ºæ•™ç¨‹å·²ç»ç»™ç¼–è¾‘äº†ï¼Œçœ‹ç¾å¥³ç¼–è¾‘ä»€ä¹ˆæ—¶å€™å‘å‡ºæ¥å§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜æ¥¼(Zee)","uid":"1785562","ctime":1620452699,"ip_address":"","comment_id":290695,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1619690147","product_id":100074001,"comment_content":"é«˜è€å¸ˆï¼Œå¸Œæœ›å°½å¿«å‡ºä¸ª é¡¹ç›®æ­å»ºæ•™ç¨‹ï¼Œå¥½ç…§ç€å®æ“ä¸€ä¸‹","like_count":0,"discussions":[{"author":{"id":1785562,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/da/e686a72b.jpg","nickname":"é«˜æ¥¼(Zee)","note":"","ucode":"149202404A5ABC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519266,"discussion_content":"æ­å»ºæ•™ç¨‹å·²ç»ç»™ç¼–è¾‘äº†ï¼Œçœ‹ç¾å¥³ç¼–è¾‘ä»€ä¹ˆæ—¶å€™å‘å‡ºæ¥å§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620452699,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}