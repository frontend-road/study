{"id":489708,"title":"æœŸä¸­è€ƒè¯• | ç”¨Kotlinå®ç°å›¾ç‰‡å¤„ç†ç¨‹åº","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æœ±æ¶›ã€‚ä¸çŸ¥ä¸è§‰é—´ï¼Œå’±ä»¬çš„è¯¾ç¨‹å°±å·²ç»è¿›è¡Œä¸€åŠäº†ï¼Œæˆ‘ä»¬å·²ç»å­¦å®Œå¾ˆå¤šå†…å®¹ï¼š</p><ul>\n<li>åŸºç¡€ç¯‡ï¼Œæˆ‘ä»¬å­¦å®Œäº†æ‰€æœ‰KotlinåŸºç¡€è¯­æ³•å’Œé‡è¦ç‰¹æ€§ã€‚</li>\n<li>åŠ é¤ç¯‡ï¼Œæˆ‘ä»¬å­¦ä¹ äº†Kotlinç¼–ç¨‹çš„5å¤§ç¼–ç¨‹æ€ç»´ï¼šå‡½æ•°å¼æ€ç»´ã€è¡¨è¾¾å¼æ€ç»´ã€ä¸å˜æ€§æ€ç»´ã€ç©ºå®‰å…¨æ€ç»´ã€åç¨‹æ€ç»´ã€‚</li>\n<li>åç¨‹ç¯‡ï¼Œæˆ‘ä»¬ä¹Ÿå·²ç»å­¦å®Œäº†æ‰€æœ‰åŸºç¡€çš„åç¨‹æ¦‚å¿µã€‚</li>\n</ul><p>æ‰€ä»¥ç°åœ¨ï¼Œæ˜¯æ—¶å€™æ¥ä¸€æ¬¡é˜¶æ®µæ€§çš„éªŒæ”¶äº†ã€‚è¿™æ¬¡ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥åšä¸€ä¸ª<strong>å›¾ç‰‡å¤„ç†ç¨‹åº</strong>ï¼Œæ¥è€ƒå¯Ÿä¸€ä¸‹è‡ªå·±å¯¹äºKotlinç¼–ç¨‹çŸ¥è¯†çš„ç†è§£å’Œåº”ç”¨æŒæ¡æƒ…å†µã€‚åˆå§‹åŒ–å·¥ç¨‹çš„ä»£ç åœ¨è¿™é‡Œ<a href=\"https://github.com/chaxiu/ImageProcessor.git\">GitHub</a>ï¼Œä½ å¯ä»¥åƒå¾€å¸¸é‚£æ ·ï¼Œå°†å…¶cloneä¸‹æ¥ï¼Œç„¶åç”¨IntelliJæ‰“å¼€å³å¯ã€‚</p><p>æˆ‘ä»¬ä»ç„¶ä¼šåˆ†ä¸ºä¸¤ä¸ªç‰ˆæœ¬1.0ã€2.0ï¼Œä¸è¿‡ï¼Œè¿™ä¸€æ¬¡è¦è½®åˆ°ä½ äº²è‡ªåŠ¨æ‰‹å†™ä»£ç äº†ï¼</p><h2>1.0ç‰ˆæœ¬ï¼šå¤„ç†æœ¬åœ°å›¾ç‰‡</h2><p>å½“ä½ å°†åˆå§‹åŒ–å·¥ç¨‹æ‰“å¼€ä»¥åï¼Œä½ ä¼šå‘ç°â€œsrc/main/resources/images/â€è¿™ä¸ªç›®å½•ä¸‹æœ‰ä¸€å¼ å›¾ç‰‡ï¼šandroid.pngï¼Œå®ƒå°±æ˜¯æˆ‘ä»¬è¦å¤„ç†çš„å›¾ç‰‡å¯¹è±¡ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/0d/64/0de4da2977353d97631d88531feff464.png?wh=1817x704\" alt=\"å›¾ç‰‡\"></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬æƒ³è¦å¤„ç†å›¾ç‰‡ï¼Œä¼šç¬¬ä¸€æ—¶é—´æƒ³åˆ°Photoshopï¼Œä½†å…¶å®ç®€å•çš„å›¾ç‰‡å¤„ç†ä»»åŠ¡ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥é€šè¿‡ä»£ç æ¥å®ç°ï¼Œæ¯”å¦‚å›¾ç‰‡æ¨ªå‘ç¿»è½¬ã€å›¾ç‰‡çºµå‘ç¿»è½¬ã€å›¾ç‰‡è£åˆ‡ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/45/c6/456e395f69c12b20e095959046fccac6.png?wh=1128x424\" alt=\"å›¾ç‰‡\"></p><p>å…³äºå›¾ç‰‡çš„åº•å±‚å®šä¹‰ï¼ŒJava SDKå·²ç»æä¾›äº†å¾ˆå¥½çš„æ”¯æŒï¼Œæˆ‘ä»¬åœ¨Kotlinä»£ç å½“ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨ç›¸å…³çš„ç±»ã€‚ä¸ºäº†é˜²æ­¢ä½ å¯¹JDKä¸ç†Ÿæ‚‰ï¼Œæˆ‘åœ¨åˆå§‹åŒ–å·¥ç¨‹å½“ä¸­ï¼Œå·²ç»ä¸ºä½ åšå¥½äº†å‰æœŸå‡†å¤‡å·¥ä½œï¼š</p><!-- [[[read_end]]] --><pre><code class=\"language-plain\">class Image(private val pixels: Array&lt;Array&lt;Color&gt;&gt;) {\n\n    fun height(): Int {\n        return pixels.size\n    }\n\n    fun width(): Int {\n        return pixels[0].size\n    }\n\n    /**\n     * åº•å±‚ä¸å¤„ç†è¶Šç•Œ\n     */\n    fun getPixel(y: Int, x: Int): Color {\n        return pixels[y][x]\n    }\n}\n</code></pre><p>è¿™æ˜¯æˆ‘å®šä¹‰çš„ä¸€ä¸ªImageç±»ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯å°è£…å›¾ç‰‡çš„å†…å­˜å¯¹è±¡ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå›¾ç‰‡çš„æœ¬è´¨æ˜¯ä¸€å †åƒç´ ç‚¹ï¼ˆPixelï¼‰ï¼Œè€Œæ¯ä¸ªåƒç´ ç‚¹ï¼Œéƒ½å¯ä»¥ç”¨RGBæ¥è¡¨ç¤ºï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨Java SDKå½“ä¸­çš„Coloræ¥è¡¨ç¤ºã€‚</p><p>å½“æˆ‘ä»¬æŠŠå›¾ç‰‡æ”¾å¤§åˆ°è¶³å¤Ÿå€æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°å…¶ä¸­çš„<strong>æ­£æ–¹å½¢åƒç´ ç‚¹</strong>äº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/4a/a2/4a833f282d7f56e6c10707f9b36yy4a2.png?wh=1489x862\" alt=\"å›¾ç‰‡\"></p><p>æ‰€ä»¥ï¼Œæœ€ç»ˆæˆ‘ä»¬å°±å¯ä»¥ç”¨â€œ<code>Array&lt;Array&lt;Color&gt;&gt;</code>â€è¿™æ ·ä¸€ä¸ªäºŒç»´æ•°ç»„æ¥è¡¨ç¤ºä¸€å¼ å›¾ç‰‡ã€‚</p><p>å¦å¤–ï¼Œä»æœ¬åœ°åŠ è½½å›¾ç‰‡åˆ°å†…å­˜çš„ä»£ç ï¼Œæˆ‘ä¹Ÿå¸®ä½ å†™å¥½äº†ï¼š</p><pre><code class=\"language-plain\">const val BASE_PATH = \"./src/main/resources/images/\"\n\nfun main() {\n    val image = loadImage(File(\"${BASE_PATH}android.png\"))\n    println(\"Width = ${image.width()};Height = ${image.height()}\")\n}\n\n/**\n * åŠ è½½æœ¬åœ°å›¾ç‰‡åˆ°å†…å­˜ä¸­\n */\nfun loadImage(imageFile: File) =\n    ImageIO.read(imageFile)\n        .let {\n            Array(it.height) { y -&gt;\n                Array(it.width) { x -&gt;\n                    Color(it.getRGB(x, y))\n                }\n            }\n        }.let {\n            Image(it)\n        }\n</code></pre><p>é‚£ä¹ˆï¼Œå”¯ä¸€éœ€è¦ä½ åšçš„ï¼Œå°±æ˜¯å®ç°è¿™å‡ ä¸ªå‡½æ•°çš„åŠŸèƒ½ï¼š<strong>å›¾ç‰‡æ¨ªå‘ç¿»è½¬ã€å›¾ç‰‡çºµå‘ç¿»è½¬ã€å›¾ç‰‡è£åˆ‡</strong>ã€‚</p><pre><code class=\"language-plain\">/**\n * æ¨ªå‘ç¿»è½¬å›¾ç‰‡\n * å¾…å®ç°\n */\nfun Image.flipHorizontal(): Image = TODO()\n\n/**\n * çºµå‘ç¿»è½¬å›¾ç‰‡\n * å¾…å®ç°\n */\nfun Image.flipVertical(): Image = TODO()\n\n/**\n * å›¾ç‰‡è£åˆ‡\n * å¾…å®ç°\n */\nfun Image.crop(startY: Int, startX: Int, width: Int, height: Int): Image = TODO()\n</code></pre><p>å¦å¤–ï¼Œå¦‚æœä½ æœ‰å…´è¶£çš„è¯ï¼Œè¿˜å¯ä»¥å»å®ç°å¯¹åº”çš„å•å…ƒæµ‹è¯•ä»£ç ï¼š</p><pre><code class=\"language-plain\">class TestImageProcessor {\n\n    /**\n     * å¾…å®ç°çš„å•å…ƒæµ‹è¯•\n     */\n    @Test\n    fun testFlipHorizontal() {\n\n    }\n\n    /**\n     * å¾…å®ç°çš„å•å…ƒæµ‹è¯•\n     */\n    @Test\n    fun testFlipVertical() {\n\n    }\n\n    /**\n     * å¾…å®ç°çš„å•å…ƒæµ‹è¯•\n     */\n    @Test\n    fun testCrop() {\n\n    }\n}\n</code></pre><p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬1.0ç‰ˆæœ¬çš„ä»£ç å°±ç®—å®Œæˆäº†ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬è¿˜æ²¡ç”¨ä¸Šåç¨‹çš„çŸ¥è¯†å•Šï¼</p><p>è¯·çœ‹2.0ç‰ˆæœ¬ã€‚</p><h2>2.0ç‰ˆæœ¬ï¼šå¢åŠ å›¾ç‰‡ä¸‹è½½åŠŸèƒ½</h2><p>åœ¨ä¸Šä¸ªç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬çš„ä»£ç ä»…æ”¯æŒæœ¬åœ°å›¾ç‰‡çš„å¤„ç†ï¼Œä½†æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³è¦å¤„ç†ç½‘ç»œä¸Šçš„å›¾ç‰‡è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæ‰€ä»¥è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å¢åŠ ä¸€ä¸ª<strong>ä¸‹è½½ç½‘ç»œå›¾ç‰‡çš„åŠŸèƒ½</strong>ã€‚</p><p>è¿™ä¸ªç‰ˆæœ¬ï¼Œä½ åªéœ€è¦å®ç°ä¸€ä¸ªå‡½æ•°ï¼š</p><pre><code class=\"language-plain\">/**\n * æŒ‚èµ·å‡½æ•°ï¼Œä»¥httpçš„æ–¹å¼ä¸‹è½½å›¾ç‰‡ï¼Œä¿å­˜åˆ°æœ¬åœ°\n * å¾…å®ç°\n */\nsuspend fun downloadImage(url: String, outputFile: File): Boolean = TODO()\n</code></pre><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºä¸‹è½½ç½‘ç»œå›¾ç‰‡æ¯”è¾ƒè€—æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶å®šä¹‰æˆä¸€ä¸ª<strong>æŒ‚èµ·å‡½æ•°</strong>ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬åç»­åœ¨ä½¿ç”¨å®ƒçš„æ—¶å€™å°±å¯ä»¥æ›´å¾—å¿ƒåº”æ‰‹äº†ã€‚</p><pre><code class=\"language-plain\">fun main() = runBlocking {\n    // ä¸ä¸€å®šéè¦ä¸‹è½½æˆ‘æä¾›çš„é“¾æ¥\n    val url = \"https://raw.githubusercontent.com/chaxiu/ImageProcessor/main/src/main/resources/images/android.png\"\n    val path = \"${BASE_PATH}downloaded.png\"\n\n    // è°ƒç”¨æŒ‚èµ·å‡½æ•°\n    downloadImage(url, File(path))\n\n    val image = loadImage(File(path))\n    println(\"Width = ${image.width()};Height = ${image.height()}\")\n}\n</code></pre><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘æ˜¯ä»¥â€œ<a href=\"https://raw.githubusercontent.com/chaxiu/ImageProcessor/main/src/main/resources/images/android.png%E2%80%9D\">https://raw.githubusercontent.com/chaxiu/ImageProcessor/main/src/main/resources/images/android.pngâ€</a> è¿™ä¸ªé“¾æ¥ä¸ºä¾‹ï¼Œè¿™æ˜¯ä¸€ä¸ªHTTPSçš„é“¾æ¥ï¼Œä½ åœ¨å®é™…å¼€å‘çš„æ—¶å€™ï¼Œä¹Ÿå¯ä»¥éšä¾¿å»æ‰¾ä¸€ä¸ªæ™®é€šçš„HTTPå›¾ç‰‡é“¾æ¥ï¼Œè¿™æ ·å°±ä¸å¿…å¤„ç†SSLçš„é—®é¢˜äº†ã€‚</p><p>ç¨‹åºå®é™…è¿è¡Œæ•ˆæœä¼šæ˜¯è¿™æ ·çš„ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/e7/71/e7b549e6e97cffdd67e8379004773171.gif?wh=1026x764\" alt=\"å›¾ç‰‡\"></p><p>åœ¨ä¸‹èŠ‚è¯¾é‡Œï¼Œæˆ‘ä¼šç»™å‡ºæˆ‘çš„ä»£ç å‚è€ƒï¼Œä¸è¿‡åœ¨çœ‹æˆ‘çš„ä»£ç ä¹‹å‰ï¼Œè®°å¾—å…ˆè¦è‡ªå·±åŠ¨æ‰‹å•Šã€‚</p><p>å…¶å®ï¼Œä»¥æˆ‘ä»¬è¿™ä¸ªå·¥ç¨‹ä¸ºåŸºç¡€ï¼Œå†åŠ ä¸Šä¸€äº›å›¾å½¢å­¦ç®—æ³•ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥åšå‡ºPhotoshopå½“ä¸­çš„ä¸€äº›é«˜çº§åŠŸèƒ½ï¼Œæ¯”å¦‚å›¾ç‰‡ç¼©æ”¾ã€å›¾ç‰‡å‚æ•°è°ƒèŠ‚ã€å›¾ç‰‡æ»¤é•œã€æŠ åƒï¼Œç”šè‡³å›¾ç‰‡è¯†åˆ«ï¼Œç­‰ç­‰ã€‚å¦‚æœä½ æœ¬èº«å°±æœ‰å›¾å½¢å­¦æ–¹é¢çš„çŸ¥è¯†å‚¨å¤‡ï¼Œä¹Ÿæ¬¢è¿ä½ åœ¨æ­¤åŸºç¡€ä¸Šå®ç°æ›´å¤æ‚çš„åŠŸèƒ½ï¼</p><p>å¥½äº†ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","neighbors":{"left":{"article_title":"18 | å®æˆ˜ï¼šè®©KtHttpæ”¯æŒæŒ‚èµ·å‡½æ•°","id":488985},"right":{"article_title":"é¢˜ç›®è§£ç­” | æœŸä¸­è€ƒè¯•ç‰ˆæœ¬å‚è€ƒå®ç°","id":490408}},"comments":[{"had_liked":false,"id":336178,"user_name":"better","can_delete":false,"product_type":"c1","uid":1169063,"ip_address":"","ucode":"AF1DB566EBB8A5","user_header":"https://static001.geekbang.org/account/avatar/00/11/d6/a7/ac23f5a6.jpg","comment_is_top":false,"comment_ctime":1645971875,"is_pvip":false,"replies":[{"id":"122939","content":"reverse()ç”¨çš„æŒºå¥½ï¼Œåœ¨è¿™ä¸ªåœºæ™¯ä¸‹å¾ˆåˆé€‚ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1180670","ctime":1646126939,"ip_address":"","comment_id":336178,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10235906467","product_id":100103401,"comment_content":"&#47;&#47; Image æ·»åŠ æ–¹æ³•ï¼ŒåŒæ—¶ å»æ‰ pixels çš„ private<br>fun getHorArray(x: Int): Array&lt;Color&gt; {<br>        return pixels[x]<br>}<br><br>&#47;&#47;&#47;&#47; <br>fun Image.flipHorizontal(): Image {<br>    for (i in (0 until this.height())) {<br>        this.getHorArray(i).reverse()<br>    }<br>    return this<br>}<br><br>fun Image.flipVertical(): Image {<br>    this.pixels.reverse()<br>    return this<br>}<br><br>fun Image.crop(startY: Int, startX: Int, width: Int, height: Int): Image {<br>    return Array(width - startY) { y -&gt;<br>        Array(height - startX) { x -&gt;<br>            Color(this.getPixel(x, y).rgb)<br>        }<br>    }.let {<br>        Image(it)<br>    }<br>}<br>","like_count":3,"discussions":[{"author":{"id":1180670,"avatar":"https://static001.geekbang.org/account/avatar/00/12/03/fe/0f43ef35.jpg","nickname":"æœ±æ¶›","note":"","ucode":"5AB5AFE32B8008","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553885,"discussion_content":"reverse()ç”¨çš„æŒºå¥½ï¼Œåœ¨è¿™ä¸ªåœºæ™¯ä¸‹å¾ˆåˆé€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646126939,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":336371,"user_name":"æ›¾å¸…","can_delete":false,"product_type":"c1","uid":1234319,"ip_address":"","ucode":"322F049DA9284D","user_header":"https://static001.geekbang.org/account/avatar/00/12/d5/8f/d0874a01.jpg","comment_is_top":false,"comment_ctime":1646117863,"is_pvip":false,"replies":[{"id":"122937","content":"ä¸åŒç‰ˆæœ¬ä¹‹é—´ç¡®å®å­˜åœ¨ç±»ä¼¼çš„é—®é¢˜ã€‚æ„Ÿè°¢è¿™ä½åŒå­¦çš„æé†’ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1180670","ctime":1646126059,"ip_address":"","comment_id":336371,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5941085159","product_id":100103401,"comment_content":"git clone ä¹‹åï¼Œæ‰“å¼€ç¼–è¯‘å°±æŠ¥é”™ï¼ŒMultipleCompilationErrorsException ã€‚æŠŠ gradle&#47;wrapper&#47;gradle-wrapper.properties é‡Œé¢çš„ 7.1 ç‰ˆæœ¬æ”¹æˆ 7.2 ä¹‹åé‡æ–°ç¼–è¯‘å°±å¯ä»¥äº†ã€‚<br>æœ‰åŒæ ·é—®é¢˜çš„åŒå­¦å¯ä»¥å‚è€ƒä¸€ä¸‹ã€‚","like_count":2,"discussions":[{"author":{"id":1180670,"avatar":"https://static001.geekbang.org/account/avatar/00/12/03/fe/0f43ef35.jpg","nickname":"æœ±æ¶›","note":"","ucode":"5AB5AFE32B8008","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553882,"discussion_content":"ä¸åŒç‰ˆæœ¬ä¹‹é—´ç¡®å®å­˜åœ¨ç±»ä¼¼çš„é—®é¢˜ã€‚æ„Ÿè°¢è¿™ä½åŒå­¦çš„æé†’ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646126059,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":349983,"user_name":"Michael","can_delete":false,"product_type":"c1","uid":1173761,"ip_address":"","ucode":"D1B972C9164641","user_header":"https://static001.geekbang.org/account/avatar/00/11/e9/01/2885812b.jpg","comment_is_top":false,"comment_ctime":1656485238,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1656485238","product_id":100103401,"comment_content":"ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„ api ä¸‹è½½æ–‡ä»¶<br>suspend fun downloadImage(url: String, outputFile: File): Boolean =<br>    withContext(Dispatchers.IO) {<br>      kotlin.runCatching {<br>        URL(url).openStream().use {<br>          outputFile.writeBytes(it.readAllBytes())<br>        }<br>      }<br>    }.isSuccess","like_count":0},{"had_liked":false,"id":337808,"user_name":"Geek_Adr","can_delete":false,"product_type":"c1","uid":2876897,"ip_address":"","ucode":"129E17B7D3EB88","user_header":"https://static001.geekbang.org/account/avatar/00/2b/e5/e1/a5064f88.jpg","comment_is_top":false,"comment_ctime":1647074064,"is_pvip":false,"replies":[{"id":"123586","content":"ä»£ç ä¸é”™ï¼Œèµ~","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1180670","ctime":1647235791,"ip_address":"","comment_id":337808,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1647074064","product_id":100103401,"comment_content":"&#47;&#47; å…ˆäº¤ä½œä¸šï¼Œåçœ‹å‚è€ƒå®ç°<br>&#47;&#47; å›¾ç‰‡å¤„ç† å•æµ‹Case è¾ƒéš¾å®ç°ï¼Œå·æ‡’å†™æœ¬åœ°è‚‰çœ¼çœ‹<br><br>&#47;**<br> * å†™åˆ°æœ¬åœ°ï¼Œæ–¹ä¾¿å¯çœ‹æ•ˆæœ<br> *&#47;<br>fun Image.writeJPEG(outputFile: File): Boolean =<br>    ImageIO.write(BufferedImage(width(), height(), BufferedImage.TYPE_INT_RGB).apply {<br>        repeat(height) { y -&gt;<br>            repeat(width) { x -&gt;<br>                setRGB(x, y, getPixel(y, x).rgb)<br>            }<br>        }<br>    }, &quot;JPEG&quot;, outputFile)<br><br>&#47;**<br> * å›¾ç‰‡è£åˆ‡<br> *&#47;<br>fun Image.crop(startY: Int, startX: Int, width: Int, height: Int): Image =<br>    Array(height) { y -&gt;<br>        Array(width) { x -&gt;<br>            getPixel(y + startY, x + startX)<br>        }<br>    }.let { Image(it) }<br><br>&#47;**<br> * æ¨ªå‘ç¿»è½¬å›¾ç‰‡<br> *&#47;<br>fun Image.flipHorizontal(): Image =<br>    Array(height()) { y -&gt;<br>        Array(width()) { x -&gt;<br>            getPixel(y, width() - x - 1)<br>        }<br>    }.let { Image(it) }<br><br>&#47;**<br> * çºµå‘ç¿»è½¬å›¾ç‰‡<br> *&#47;<br>fun Image.flipVertical(): Image =<br>    Array(height()) { y -&gt;<br>        Array(width()) { x -&gt;<br>            getPixel(height() - y - 1, x)<br>        }<br>    }.let { Image(it) }<br><br>&#47;**<br> * æŒ‚èµ·å‡½æ•°ï¼Œä»¥httpçš„æ–¹å¼ä¸‹è½½å›¾ç‰‡ï¼Œä¿å­˜åˆ°æœ¬åœ°<br> *&#47;<br>suspend fun downloadImage(url: String, outputFile: File): Boolean =<br>    withContext(Dispatchers.IO) {<br>        OkHttpClient.Builder().build().run {<br>            newCall(Request.Builder().apply {<br>                url(url)<br>                get()<br>            }.build()).execute().run {<br>                if (!isSuccessful) {<br>                    return@run false<br>                }<br>                return@run body?.byteStream()?.source()?.let { outputFile.sink().buffer().writeAll(it) &gt; 0 } ?: false<br>            }<br>        }<br>    }<br>","like_count":0,"discussions":[{"author":{"id":1180670,"avatar":"https://static001.geekbang.org/account/avatar/00/12/03/fe/0f43ef35.jpg","nickname":"æœ±æ¶›","note":"","ucode":"5AB5AFE32B8008","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556163,"discussion_content":"ä»£ç ä¸é”™ï¼Œèµ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647235791,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337029,"user_name":"ç™½ä¹¾æ¶›","can_delete":false,"product_type":"c1","uid":1339841,"ip_address":"","ucode":"0C704B0B90C8D7","user_header":"https://static001.geekbang.org/account/avatar/00/14/71/c1/cbc55e06.jpg","comment_is_top":false,"comment_ctime":1646558199,"is_pvip":false,"replies":[{"id":"123151","content":"è›®å¥½çš„~","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1180670","ctime":1646580793,"ip_address":"","comment_id":337029,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1646558199","product_id":100103401,"comment_content":"fun main() = runBlocking {<br>    File(BASE_PATH).mkdirs()<br>    downloadFile(URL, getPathFile(&quot;origin&quot;))<br>        .loadImage()<br>        .also { it.flipVertical().writeToFile(getPathFile(&quot;vertical&quot;)) }<br>        .also { it.flipHorizontal().writeToFile(getPathFile(&quot;horizontal&quot;)) }<br>        .also { it.crop(0, 0, 100, 50).writeToFile(getPathFile(&quot;crop&quot;)) }<br>    delay(10L)<br>}","like_count":1,"discussions":[{"author":{"id":1180670,"avatar":"https://static001.geekbang.org/account/avatar/00/12/03/fe/0f43ef35.jpg","nickname":"æœ±æ¶›","note":"","ucode":"5AB5AFE32B8008","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554754,"discussion_content":"è›®å¥½çš„~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646580793,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":336205,"user_name":"PoPlus","can_delete":false,"product_type":"c1","uid":1574765,"ip_address":"","ucode":"5F0927921317F2","user_header":"https://static001.geekbang.org/account/avatar/00/18/07/6d/4c1909be.jpg","comment_is_top":false,"comment_ctime":1646009516,"is_pvip":false,"replies":[{"id":"122938","content":"æŒºå¥½çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1180670","ctime":1646126700,"ip_address":"","comment_id":336205,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1646009516","product_id":100103401,"comment_content":"&#47;**<br> * æŒ‚èµ·å‡½æ•°ï¼Œä»¥httpçš„æ–¹å¼ä¸‹è½½å›¾ç‰‡ï¼Œä¿å­˜åˆ°æœ¬åœ°<br> *&#47;<br>suspend fun downloadImage(url: String, outputFile: File) = withContext(Dispatchers.IO) {<br>    val client = OkHttpClient()<br>    val request = Request.Builder()<br>        .url(url)<br>        .build()<br>    val response = client<br>        .newCall(request)<br>        .execute()<br>    var size = 0L<br>    response.body?.byteStream()?.readAllBytes()?.let { bytes -&gt;<br>        outputFile.writeBytes(bytes)<br>        size = bytes.size.toLong()<br>    }<br>    if (size == response.headersContentLength()) {<br>        return@withContext true<br>    }<br>    return@withContext false<br>}<br><br>&#47;**<br> * ä¸»å‡½æ•°<br> *&#47;<br>fun main() = runBlocking {<br>    val url = &quot;https:&#47;&#47;raw.githubusercontent.com&#47;chaxiu&#47;ImageProcessor&#47;main&#47;src&#47;main&#47;resources&#47;images&#47;android.png&quot;<br>    val path = &quot;.&#47;download.png&quot;<br><br>    val success = downloadImage(url, File(path))<br>    println(success)<br><br>    val image = loadImage(File(path))<br>    println(&quot;Width = ${image.width()};Height = ${image.height()}&quot;)<br>}<br><br>çœ‹åˆ°æœ‰åŒå­¦ä½¿ç”¨ suspendCoroutine å‡½æ•°å¤„ç†ï¼Œä¸çŸ¥é“å’Œæˆ‘è¿™ä¸ªæ–¹æ³•æ¯”è¾ƒæœ‰ä»€ä¹ˆåŒºåˆ« ğŸ‘€","like_count":0,"discussions":[{"author":{"id":1180670,"avatar":"https://static001.geekbang.org/account/avatar/00/12/03/fe/0f43ef35.jpg","nickname":"æœ±æ¶›","note":"","ucode":"5AB5AFE32B8008","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553883,"discussion_content":"æŒºå¥½çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646126700,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":335927,"user_name":"A Lonely Cat","can_delete":false,"product_type":"c1","uid":2885349,"ip_address":"","ucode":"382EBFDD8E5115","user_header":"https://static001.geekbang.org/account/avatar/00/2c/06/e5/51ef9735.jpg","comment_is_top":false,"comment_ctime":1645773420,"is_pvip":false,"replies":[{"id":"122841","content":"ä¸é”™ï¼Œä»£ç å†™çš„å¾ˆå¥½ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1180670","ctime":1645967074,"ip_address":"","comment_id":335927,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1645773420","product_id":100103401,"comment_content":"å›¾ç‰‡ä¸‹è½½åŠŸèƒ½<br><br>private val client = OkHttpClient.Builder()<br>    .build()<br><br>&#47;**<br> * æŒ‚èµ·å‡½æ•°ï¼Œä»¥httpçš„æ–¹å¼ä¸‹è½½å›¾ç‰‡ï¼Œä¿å­˜åˆ°æœ¬åœ°<br> *&#47;<br>suspend fun downloadImage(url: String, outputFile: File): Boolean = suspendCoroutine { con -&gt;<br>    val request = Request.Builder()<br>        .url(url)<br>        .get()<br>        .build()<br>    client.newCall(request)<br>        .enqueue(object : Callback {<br>            override fun onFailure(call: Call, e: IOException) {<br>                e.printStackTrace()<br>                con.resume(false)<br>            }<br><br>            override fun onResponse(call: Call, response: Response) {<br>                if (response.isSuccessful) {<br>                    response.body?.bytes()?.let {<br>                        outputFile.writeBytes(it)<br>                    }<br>                    con.resume(true)<br>                } else {<br>                    con.resume(false)<br>                }<br>            }<br>        })<br>}<br><br>fun main() = runBlocking {<br>    val url = &quot;http:&#47;&#47;img.netbian.com&#47;file&#47;2020&#47;1202&#47;smallaaa773e8cc9729977037e80b19f955891606922519.jpg&quot;<br>    val file = File(&quot;${BASE_PATH}wallpaper.png&quot;)<br>    val success = downloadImage(url, file)<br>    println(&quot;Download file status is successï¼š$success&quot;)<br>}","like_count":1,"discussions":[{"author":{"id":1180670,"avatar":"https://static001.geekbang.org/account/avatar/00/12/03/fe/0f43ef35.jpg","nickname":"æœ±æ¶›","note":"","ucode":"5AB5AFE32B8008","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553562,"discussion_content":"ä¸é”™ï¼Œä»£ç å†™çš„å¾ˆå¥½ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645967074,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}