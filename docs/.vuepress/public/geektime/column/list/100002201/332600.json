{"id":332600,"title":"107 | Goç¼–ç¨‹æ¨¡å¼ï¼šåˆ‡ç‰‡ã€æ¥å£ã€æ—¶é—´å’Œæ€§èƒ½","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é™ˆçš“ï¼Œç½‘åå·¦è€³æœµè€—å­ã€‚</p><p>ä»Šå¤©æ˜¯æˆ‘ä»¬çš„ç¬¬ä¸€èŠ‚è¯¾ï¼Œæˆ‘å…ˆå¸¦ä½ å­¦ä¹ ä¸‹Goè¯­è¨€ç¼–ç¨‹æ¨¡å¼çš„ä¸€äº›åŸºæœ¬æŠ€æœ¯å’Œè¦ç‚¹ã€‚äº†è§£äº†è¿™äº›å†…å®¹ï¼Œä½ å°±å¯ä»¥æ›´è½»æ¾åœ°æŒæ¡Goè¯­è¨€ç¼–ç¨‹äº†ï¼Œå…¶ä¸­ä¸»è¦åŒ…æ‹¬æ•°ç»„åˆ‡ç‰‡çš„ä¸€äº›å°å‘ã€æ¥å£ç¼–ç¨‹ï¼Œä»¥åŠæ—¶é—´å’Œç¨‹åºè¿è¡Œæ€§èƒ½ç›¸å…³çš„å†…å®¹ã€‚</p><p>è¯ä¸å¤šè¯´ï¼Œæˆ‘ä»¬ç›´æ¥å¼€å§‹ã€‚</p><h2>Slice</h2><p>é¦–å…ˆï¼Œæˆ‘æ¥ä»‹ç»ä¸‹Sliceï¼Œä¸­æ–‡ç¿»è¯‘å«â€œåˆ‡ç‰‡â€ï¼Œè¿™ä¸ªä¸œè¥¿åœ¨Goè¯­è¨€ä¸­ä¸æ˜¯æ•°ç»„ï¼Œè€Œæ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code>type slice struct {\n    array unsafe.Pointer //æŒ‡å‘å­˜æ”¾æ•°æ®çš„æ•°ç»„æŒ‡é’ˆ\n    len   int            //é•¿åº¦æœ‰å¤šå¤§\n    cap   int            //å®¹é‡æœ‰å¤šå¤§\n}\n</code></pre><p>ä¸€ä¸ªç©ºçš„Sliceçš„è¡¨ç°å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/3e/80/3e82a8bfb0f9cc51430cf9206c8fcf80.jpg?wh=996x945\" alt=\"\"></p><p>ç†Ÿæ‚‰C/C++çš„åŒå­¦ä¸€å®šä¼šçŸ¥é“åœ¨ç»“æ„ä½“é‡Œç”¨æ•°ç»„æŒ‡é’ˆçš„é—®é¢˜â€”â€”<strong>æ•°æ®ä¼šå‘ç”Ÿå…±äº«</strong>ï¼ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹Sliceçš„ä¸€äº›æ“ä½œï¼š</p><pre><code>foo = make([]int, 5)\nfoo[3] = 42\nfoo[4] = 100\n\nbar  := foo[1:4]\nbar[1] = 99\n</code></pre><p>æˆ‘æ¥è§£é‡Šä¸‹è¿™æ®µä»£ç ï¼š</p><ul>\n<li>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªfooçš„Sliceï¼Œå…¶ä¸­çš„é•¿åº¦å’Œå®¹é‡éƒ½æ˜¯5ï¼›</li>\n<li>ç„¶åï¼Œå¼€å§‹å¯¹fooæ‰€æŒ‡å‘çš„æ•°ç»„ä¸­çš„ç´¢å¼•ä¸º3å’Œ4çš„å…ƒç´ è¿›è¡Œèµ‹å€¼ï¼›</li>\n<li>æœ€åï¼Œå¯¹fooåšåˆ‡ç‰‡åèµ‹å€¼ç»™barï¼Œå†ä¿®æ”¹bar[1]ã€‚</li>\n</ul><p>ä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼Œæˆ‘ç”»äº†ä¸€å¼ å›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/66/20/66ed288ef019a8445b639db92d79a420.jpg?wh=1803x1242\" alt=\"\"><br>\nä»è¿™å¼ å›¾ç‰‡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå› ä¸ºfooå’Œbarçš„å†…å­˜æ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥ï¼Œfooå’Œbarå¯¹æ•°ç»„å†…å®¹çš„ä¿®æ”¹éƒ½ä¼šå½±å“åˆ°å¯¹æ–¹ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªæ•°æ®æ“ä½œ <code>append()</code> çš„ç¤ºä¾‹ï¼š</p><pre><code>a := make([]int, 32)\nb := a[1:16]\na = append(a, 1)\na[2] = 42\n</code></pre><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼ŒæŠŠ <code>a[1:16]</code> çš„åˆ‡ç‰‡èµ‹ç»™ <code>b</code> ï¼Œæ­¤æ—¶ï¼Œ<code>a</code> å’Œ <code>b</code> çš„å†…å­˜ç©ºé—´æ˜¯å…±äº«çš„ï¼Œç„¶åï¼Œå¯¹ <code>a</code> åšäº†ä¸€ä¸ª <code>append()</code>çš„æ“ä½œï¼Œè¿™ä¸ªæ“ä½œä¼šè®© <code>a</code> é‡æ–°åˆ†é…å†…å­˜ï¼Œè¿™å°±ä¼šå¯¼è‡´ <code>a</code> å’Œ <code>b</code> ä¸å†å…±äº«ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/90/21/90e91f0e9517594b6c26fb64d531c621.jpg?wh=1743x1482\" alt=\"\"><br>\nä»å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<code>append()</code>æ“ä½œè®© <code>a</code> çš„å®¹é‡å˜æˆäº†64ï¼Œè€Œé•¿åº¦æ˜¯33ã€‚è¿™é‡Œä½ éœ€è¦é‡ç‚¹æ³¨æ„ä¸€ä¸‹ï¼Œ<strong><code>append()</code>è¿™ä¸ªå‡½æ•°åœ¨ <code>cap</code> ä¸å¤Ÿç”¨çš„æ—¶å€™ï¼Œå°±ä¼šé‡æ–°åˆ†é…å†…å­˜ä»¥æ‰©å¤§å®¹é‡ï¼Œå¦‚æœå¤Ÿç”¨ï¼Œå°±ä¸ä¼šé‡æ–°åˆ†é…å†…å­˜äº†</strong>ï¼</p><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><pre><code>func main() {\n    path := []byte(&quot;AAAA/BBBBBBBBB&quot;)\n    sepIndex := bytes.IndexByte(path,'/')\n\n    dir1 := path[:sepIndex]\n    dir2 := path[sepIndex+1:]\n\n    fmt.Println(&quot;dir1 =&gt;&quot;,string(dir1)) //prints: dir1 =&gt; AAAA\n    fmt.Println(&quot;dir2 =&gt;&quot;,string(dir2)) //prints: dir2 =&gt; BBBBBBBBB\n\n    dir1 = append(dir1,&quot;suffix&quot;...)\n\n    fmt.Println(&quot;dir1 =&gt;&quot;,string(dir1)) //prints: dir1 =&gt; AAAAsuffix\n    fmt.Println(&quot;dir2 =&gt;&quot;,string(dir2)) //prints: dir2 =&gt; uffixBBBB\n}\n</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>dir1</code> å’Œ <code>dir2</code> å…±äº«å†…å­˜ï¼Œè™½ç„¶ <code>dir1</code> æœ‰ä¸€ä¸ª <code>append()</code> æ“ä½œï¼Œä½†æ˜¯å› ä¸º cap è¶³å¤Ÿï¼Œäºæ˜¯æ•°æ®æ‰©å±•åˆ°äº†<code>dir2</code> çš„ç©ºé—´ã€‚ä¸‹é¢æ˜¯ç›¸å…³çš„å›¾ç¤ºï¼ˆæ³¨æ„ä¸Šå›¾ä¸­ <code>dir1</code> å’Œ <code>dir2</code> ç»“æ„ä½“ä¸­çš„ <code>cap</code> å’Œ <code>len</code> çš„å˜åŒ–ï¼‰ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/33/01/33b6fb6a551a13cef4e0d9644a410601.jpg?wh=1983x2022\" alt=\"\"><br>\nå¦‚æœè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹ä¸€è¡Œä»£ç ã€‚æˆ‘ä»¬è¦æŠŠä»£ç </p><pre><code>dir1 := path[:sepIndex]\n</code></pre><p>ä¿®æ”¹ä¸ºï¼š</p><pre><code>dir1 := path[:sepIndex:sepIndex]\n</code></pre><p>æ–°çš„ä»£ç ä½¿ç”¨äº† Full Slice Expressionï¼Œæœ€åä¸€ä¸ªå‚æ•°å«â€œLimited Capacityâ€ï¼Œäºæ˜¯ï¼Œåç»­çš„ <code>append()</code> æ“ä½œä¼šå¯¼è‡´é‡æ–°åˆ†é…å†…å­˜ã€‚</p><h2>æ·±åº¦æ¯”è¾ƒ</h2><p>å½“æˆ‘ä»¬å¤åˆ¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œè¿™ä¸ªå¯¹è±¡å¯ä»¥æ˜¯å†…å»ºæ•°æ®ç±»å‹ã€æ•°ç»„ã€ç»“æ„ä½“ã€Mapâ€¦â€¦åœ¨å¤åˆ¶ç»“æ„ä½“çš„æ—¶å€™ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æ¯”è¾ƒä¸¤ä¸ªç»“æ„ä½“ä¸­çš„æ•°æ®æ˜¯å¦ç›¸åŒï¼Œå°±è¦ä½¿ç”¨æ·±åº¦æ¯”è¾ƒï¼Œè€Œä¸åªæ˜¯ç®€å•åœ°åšæµ…åº¦æ¯”è¾ƒã€‚è¿™é‡Œéœ€è¦ä½¿ç”¨åˆ°åå°„ <code>reflect.DeepEqual()</code> ï¼Œä¸‹é¢æ˜¯å‡ ä¸ªç¤ºä¾‹ï¼š</p><pre><code>import (\n    &quot;fmt&quot;\n    &quot;reflect&quot;\n)\n\nfunc main() {\n\n    v1 := data{}\n    v2 := data{}\n    fmt.Println(&quot;v1 == v2:&quot;,reflect.DeepEqual(v1,v2))\n    //prints: v1 == v2: true\n\n    m1 := map[string]string{&quot;one&quot;: &quot;a&quot;,&quot;two&quot;: &quot;b&quot;}\n    m2 := map[string]string{&quot;two&quot;: &quot;b&quot;, &quot;one&quot;: &quot;a&quot;}\n    fmt.Println(&quot;m1 == m2:&quot;,reflect.DeepEqual(m1, m2))\n    //prints: m1 == m2: true\n\n    s1 := []int{1, 2, 3}\n    s2 := []int{1, 2, 3}\n    fmt.Println(&quot;s1 == s2:&quot;,reflect.DeepEqual(s1, s2))\n    //prints: s1 == s2: true\n}\n</code></pre><h2>æ¥å£ç¼–ç¨‹</h2><p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¥çœ‹æ®µä»£ç ï¼Œå…¶ä¸­æ˜¯ä¸¤ä¸ªæ–¹æ³•ï¼Œå®ƒä»¬éƒ½æ˜¯è¦è¾“å‡ºä¸€ä¸ªç»“æ„ä½“ï¼Œå…¶ä¸­ä¸€ä¸ªä½¿ç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå¦ä¸€ä¸ªä½¿ç”¨ä¸€ä¸ªâ€œæˆå‘˜å‡½æ•°â€ã€‚</p><pre><code>func PrintPerson(p *Person) {\n    fmt.Printf(&quot;Name=%s, Sexual=%s, Age=%d\\n&quot;,\n  p.Name, p.Sexual, p.Age)\n}\n\nfunc (p *Person) Print() {\n    fmt.Printf(&quot;Name=%s, Sexual=%s, Age=%d\\n&quot;,\n  p.Name, p.Sexual, p.Age)\n}\n\nfunc main() {\n    var p = Person{\n        Name: &quot;Hao Chen&quot;,\n        Sexual: &quot;Male&quot;,\n        Age: 44,\n    }\n\n    PrintPerson(&amp;p)\n    p.Print()\n}\n</code></pre><p>ä½ æ›´å–œæ¬¢å“ªç§æ–¹å¼å‘¢ï¼Ÿåœ¨ Go è¯­è¨€ä¸­ï¼Œä½¿ç”¨â€œæˆå‘˜å‡½æ•°â€çš„æ–¹å¼å«â€œReceiverâ€ï¼Œè¿™ç§æ–¹å¼æ˜¯ä¸€ç§å°è£…ï¼Œå› ä¸º <code>PrintPerson()</code>æœ¬æ¥å°±æ˜¯å’Œ <code>Person</code>å¼ºè€¦åˆçš„ï¼Œæ‰€ä»¥ç†åº”æ”¾åœ¨ä¸€èµ·ã€‚æ›´é‡è¦çš„æ˜¯ï¼Œè¿™ç§æ–¹å¼å¯ä»¥è¿›è¡Œæ¥å£ç¼–ç¨‹ï¼Œå¯¹äºæ¥å£ç¼–ç¨‹æ¥è¯´ï¼Œä¹Ÿå°±æ˜¯ä¸€ç§æŠ½è±¡ï¼Œä¸»è¦æ˜¯ç”¨åœ¨â€œå¤šæ€â€ï¼Œè¿™ä¸ªæŠ€æœ¯ï¼Œæˆ‘åœ¨ã€Š<a href=\"https://coolshell.cn/articles/8460.html#%E6%8E%A5%E5%8F%A3%E5%92%8C%E5%A4%9A%E6%80%81\">Goè¯­è¨€ç®€ä»‹ï¼ˆä¸Šï¼‰ï¼šæ¥å£ä¸å¤šæ€</a>ã€‹ä¸­è®²è¿‡ï¼Œä½ å¯ä»¥ç‚¹å‡»é“¾æ¥æŸ¥çœ‹ã€‚</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘æƒ³è®²å¦ä¸€ä¸ªGoè¯­è¨€æ¥å£çš„ç¼–ç¨‹æ¨¡å¼ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€æ®µä»£ç ï¼š</p><pre><code>type Country struct {\n    Name string\n}\n\ntype City struct {\n    Name string\n}\n\ntype Printable interface {\n    PrintStr()\n}\nfunc (c Country) PrintStr() {\n    fmt.Println(c.Name)\n}\nfunc (c City) PrintStr() {\n    fmt.Println(c.Name)\n}\n\nc1 := Country {&quot;China&quot;}\nc2 := City {&quot;Beijing&quot;}\nc1.PrintStr()\nc2.PrintStr()\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ®µä»£ç ä¸­ä½¿ç”¨äº†ä¸€ä¸ª <code>Printable</code> çš„æ¥å£ï¼Œè€Œ <code>Country</code> å’Œ <code>City</code> éƒ½å®ç°äº†æ¥å£æ–¹æ³• <code>PrintStr()</code> æŠŠè‡ªå·±è¾“å‡ºã€‚ç„¶è€Œï¼Œè¿™äº›ä»£ç éƒ½æ˜¯ä¸€æ ·çš„ï¼Œèƒ½ä¸èƒ½çœæ‰å‘¢ï¼Ÿ</p><p>å…¶å®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€œç»“æ„ä½“åµŒå…¥â€çš„æ–¹å¼æ¥å®Œæˆè¿™ä¸ªäº‹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>type WithName struct {\n    Name string\n}\n\ntype Country struct {\n    WithName\n}\n\ntype City struct {\n    WithName\n}\n\ntype Printable interface {\n    PrintStr()\n}\n\nfunc (w WithName) PrintStr() {\n    fmt.Println(w.Name)\n}\n\nc1 := Country {WithName{ &quot;China&quot;}}\nc2 := City { WithName{&quot;Beijing&quot;}}\nc1.PrintStr()\nc2.PrintStr()\n</code></pre><p>å¼•å…¥ä¸€ä¸ªå« <code>WithName</code>çš„ç»“æ„ä½“ï¼Œä½†æ˜¯è¿™ä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼šåœ¨åˆå§‹åŒ–çš„æ—¶å€™å˜å¾—æœ‰ç‚¹ä¹±ã€‚é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•å‘¢ï¼Ÿå†æ¥çœ‹å¦å¤–ä¸€ä¸ªè§£ã€‚</p><pre><code>type Country struct {\n    Name string\n}\n\ntype City struct {\n    Name string\n}\n\ntype Stringable interface {\n    ToString() string\n}\nfunc (c Country) ToString() string {\n    return &quot;Country = &quot; + c.Name\n}\nfunc (c City) ToString() string{\n    return &quot;City = &quot; + c.Name\n}\n\nfunc PrintStr(p Stringable) {\n    fmt.Println(p.ToString())\n}\n\nd1 := Country {&quot;USA&quot;}\nd2 := City{&quot;Los Angeles&quot;}\nPrintStr(d1)\nPrintStr(d2)\n</code></pre><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<strong>æˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå«</strong><code>Stringable</code> çš„æ¥å£ï¼Œæˆ‘ä»¬ç”¨è¿™ä¸ªæ¥å£æŠŠâ€œä¸šåŠ¡ç±»å‹â€ <code>Country</code> å’Œ <code>City</code> å’Œâ€œæ§åˆ¶é€»è¾‘â€ <code>Print()</code> ç»™è§£è€¦äº†ã€‚äºæ˜¯ï¼Œåªè¦å®ç°äº†<code>Stringable</code> æ¥å£ï¼Œéƒ½å¯ä»¥ä¼ ç»™ <code>PrintStr()</code> æ¥ä½¿ç”¨ã€‚</p><p>è¿™ç§ç¼–ç¨‹æ¨¡å¼åœ¨Go çš„æ ‡å‡†åº“æœ‰å¾ˆå¤šçš„ç¤ºä¾‹ï¼Œæœ€è‘—åçš„å°±æ˜¯ <code>io.Read</code> å’Œ <code>ioutil.ReadAll</code> çš„ç©æ³•ï¼Œå…¶ä¸­ <code>io.Read</code> æ˜¯ä¸€ä¸ªæ¥å£ï¼Œä½ éœ€è¦å®ç°å®ƒçš„ä¸€ä¸ª <code>Read(p []byte) (n int, err error)</code> æ¥å£æ–¹æ³•ï¼Œåªè¦æ»¡è¶³è¿™ä¸ªè§„åˆ™ï¼Œå°±å¯ä»¥è¢« <code>ioutil.ReadAll</code>è¿™ä¸ªæ–¹æ³•æ‰€ä½¿ç”¨ã€‚<strong>è¿™å°±æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹æ–¹æ³•çš„é»„é‡‘æ³•åˆ™â€”â€”â€œProgram to an interface not an implementationâ€ã€‚</strong></p><h2>æ¥å£å®Œæ•´æ€§æ£€æŸ¥</h2><p>å¦å¤–ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒGoè¯­è¨€çš„ç¼–è¯‘å™¨å¹¶æ²¡æœ‰ä¸¥æ ¼æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å®ç°äº†æŸæ¥å£æ‰€æœ‰çš„æ¥å£æ–¹æ³•ï¼Œå¦‚ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ï¼š</p><pre><code>type Shape interface {\n    Sides() int\n    Area() int\n}\ntype Square struct {\n    len int\n}\nfunc (s* Square) Sides() int {\n    return 4\n}\nfunc main() {\n    s := Square{len: 5}\n    fmt.Printf(&quot;%d\\n&quot;,s.Sides())\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>Square</code> å¹¶æ²¡æœ‰å®ç° <code>Shape</code> æ¥å£çš„æ‰€æœ‰æ–¹æ³•ï¼Œç¨‹åºè™½ç„¶å¯ä»¥è·‘é€šï¼Œä½†æ˜¯è¿™æ ·çš„ç¼–ç¨‹æ–¹å¼å¹¶ä¸ä¸¥è°¨ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦å¼ºåˆ¶å®ç°æ¥å£çš„æ‰€æœ‰æ–¹æ³•ï¼Œé‚£è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>åœ¨Goè¯­è¨€ç¼–ç¨‹åœˆé‡Œï¼Œæœ‰ä¸€ä¸ªæ¯”è¾ƒæ ‡å‡†çš„åšæ³•ï¼š</p><pre><code>var _ Shape = (*Square)(nil)\n</code></pre><p>å£°æ˜ä¸€ä¸ª <code>_</code> å˜é‡ï¼ˆæ²¡äººç”¨ï¼‰ä¼šæŠŠä¸€ä¸ª <code>nil</code> çš„ç©ºæŒ‡é’ˆä» <code>Square</code> è½¬æˆ <code>Shape</code>ï¼Œè¿™æ ·ï¼Œå¦‚æœæ²¡æœ‰å®ç°å®Œç›¸å…³çš„æ¥å£æ–¹æ³•ï¼Œç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ï¼š</p><blockquote>\n<p><em>cannot use (*Square)(nil) (type *Square) as type Shape in assignment: *Square does not implement Shape (missing Area method)</em></p>\n</blockquote><p>è¿™æ ·å°±åšåˆ°äº†å¼ºéªŒè¯çš„æ–¹æ³•ã€‚</p><h2>æ—¶é—´</h2><p>å¯¹äºæ—¶é—´æ¥è¯´ï¼Œè¿™åº”è¯¥æ˜¯ç¼–ç¨‹ä¸­æ¯”è¾ƒå¤æ‚çš„é—®é¢˜äº†ï¼Œç›¸ä¿¡æˆ‘ï¼Œæ—¶é—´æ˜¯ä¸€ç§éå¸¸å¤æ‚çš„äº‹ï¼ˆæ¯”å¦‚ã€Š<a href=\"https://coolshell.cn/articles/5075.html\">ä½ ç¡®ä¿¡ä½ äº†è§£æ—¶é—´å—ï¼Ÿ</a>ã€‹ã€Š<a href=\"https://coolshell.cn/articles/7804.html\">å…³äºé—°ç§’</a>ã€‹ç­‰æ–‡ç« ï¼‰ã€‚è€Œä¸”ï¼Œæ—¶é—´æœ‰æ—¶åŒºã€æ ¼å¼ã€ç²¾åº¦ç­‰é—®é¢˜ï¼Œå…¶å¤æ‚åº¦ä¸æ˜¯ä¸€èˆ¬äººèƒ½å¤„ç†çš„ã€‚æ‰€ä»¥ï¼Œä¸€å®šè¦é‡ç”¨å·²æœ‰çš„æ—¶é—´å¤„ç†ï¼Œè€Œä¸æ˜¯è‡ªå·±å¹²ã€‚</p><p>åœ¨ Go è¯­è¨€ä¸­ï¼Œä½ ä¸€å®šè¦ä½¿ç”¨ <code>time.Time</code> å’Œ <code>time.Duration</code>  è¿™ä¸¤ä¸ªç±»å‹ã€‚</p><ul>\n<li>åœ¨å‘½ä»¤è¡Œä¸Šï¼Œ<code>flag</code> é€šè¿‡ <code>time.ParseDuration</code> æ”¯æŒäº† <code>time.Duration</code>ã€‚</li>\n<li>JSON ä¸­çš„ <code>encoding/json</code> ä¸­ä¹Ÿå¯ä»¥æŠŠ<code>time.Time</code> ç¼–ç æˆ <a href=\"https://tools.ietf.org/html/rfc3339\">RFC 3339</a> çš„æ ¼å¼ã€‚</li>\n<li>æ•°æ®åº“ä½¿ç”¨çš„ <code>database/sql</code> ä¹Ÿæ”¯æŒæŠŠ <code>DATATIME</code> æˆ– <code>TIMESTAMP</code> ç±»å‹è½¬æˆ <code>time.Time</code>ã€‚</li>\n<li>YAMLä¹Ÿå¯ä»¥ä½¿ç”¨ <code>gopkg.in/yaml.v2</code> æ”¯æŒ <code>time.Time</code> ã€<code>time.Duration</code> å’Œ <a href=\"https://tools.ietf.org/html/rfc3339\">RFC 3339</a> æ ¼å¼ã€‚</li>\n</ul><p>å¦‚æœä½ è¦å’Œç¬¬ä¸‰æ–¹äº¤äº’ï¼Œå®åœ¨æ²¡æœ‰åŠæ³•ï¼Œä¹Ÿè¯·ä½¿ç”¨ <a href=\"https://tools.ietf.org/html/rfc3339\">RFC 3339</a> çš„æ ¼å¼ã€‚</p><p>æœ€åï¼Œå¦‚æœä½ è¦åšå…¨çƒåŒ–è·¨æ—¶åŒºçš„åº”ç”¨ï¼Œä¸€å®šè¦æŠŠæ‰€æœ‰æœåŠ¡å™¨å’Œæ—¶é—´å…¨éƒ¨ä½¿ç”¨UTCæ—¶é—´ã€‚</p><h2>æ€§èƒ½æç¤º</h2><p>Go è¯­è¨€æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„è¯­è¨€ï¼Œä½†å¹¶ä¸æ˜¯è¯´è¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨å…³å¿ƒæ€§èƒ½äº†ï¼Œæˆ‘ä»¬è¿˜æ˜¯éœ€è¦å…³å¿ƒçš„ã€‚ä¸‹é¢æˆ‘ç»™ä½ æä¾›ä¸€ä»½åœ¨ç¼–ç¨‹æ–¹é¢å’Œæ€§èƒ½ç›¸å…³çš„æç¤ºã€‚</p><ul>\n<li>å¦‚æœéœ€è¦æŠŠæ•°å­—è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œä½¿ç”¨ <code>strconv.Itoa()</code> æ¯” <code>fmt.Sprintf()</code> è¦å¿«ä¸€å€å·¦å³ã€‚</li>\n<li>å°½å¯èƒ½é¿å…æŠŠ<code>String</code>è½¬æˆ<code>[]Byte</code> ï¼Œè¿™ä¸ªè½¬æ¢ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ã€‚</li>\n<li>å¦‚æœåœ¨for-loopé‡Œå¯¹æŸä¸ªSlice ä½¿ç”¨ <code>append()</code>ï¼Œè¯·å…ˆæŠŠ Sliceçš„å®¹é‡æ‰©å……åˆ°ä½ï¼Œè¿™æ ·å¯ä»¥é¿å…å†…å­˜é‡æ–°åˆ†é…ä»¥åŠç³»ç»Ÿè‡ªåŠ¨æŒ‰2çš„Næ¬¡æ–¹å¹‚è¿›è¡Œæ‰©å±•ä½†åˆç”¨ä¸åˆ°çš„æƒ…å†µï¼Œä»è€Œé¿å…æµªè´¹å†…å­˜ã€‚</li>\n<li>ä½¿ç”¨<code>StringBuffer</code> æˆ–æ˜¯<code>StringBuild</code> æ¥æ‹¼æ¥å­—ç¬¦ä¸²ï¼Œæ€§èƒ½ä¼šæ¯”ä½¿ç”¨ <code>+</code> æˆ– <code>+=</code>é«˜ä¸‰åˆ°å››ä¸ªæ•°é‡çº§ã€‚</li>\n<li>å°½å¯èƒ½ä½¿ç”¨å¹¶å‘çš„ goroutineï¼Œç„¶åä½¿ç”¨ <code>sync.WaitGroup</code> æ¥åŒæ­¥åˆ†ç‰‡æ“ä½œã€‚</li>\n<li>é¿å…åœ¨çƒ­ä»£ç ä¸­è¿›è¡Œå†…å­˜åˆ†é…ï¼Œè¿™æ ·ä¼šå¯¼è‡´gcå¾ˆå¿™ã€‚å°½å¯èƒ½ä½¿ç”¨  <code>sync.Pool</code> æ¥é‡ç”¨å¯¹è±¡ã€‚</li>\n<li>ä½¿ç”¨ lock-freeçš„æ“ä½œï¼Œé¿å…ä½¿ç”¨ mutexï¼Œå°½å¯èƒ½ä½¿ç”¨ <code>sync/Atomic</code>åŒ…ï¼ˆå…³äºæ— é”ç¼–ç¨‹çš„ç›¸å…³è¯é¢˜ï¼Œå¯å‚çœ‹ã€Š<a href=\"https://coolshell.cn/articles/8239.html\">æ— é”é˜Ÿåˆ—å®ç°</a>ã€‹æˆ–ã€Š<a href=\"https://coolshell.cn/articles/9703.html\">æ— é”Hashmapå®ç°</a>ã€‹ï¼‰ã€‚</li>\n<li>ä½¿ç”¨ I/Oç¼“å†²ï¼ŒI/Oæ˜¯ä¸ªéå¸¸éå¸¸æ…¢çš„æ“ä½œï¼Œä½¿ç”¨ <code>bufio.NewWrite()</code> å’Œ <code>bufio.NewReader()</code> å¯ä»¥å¸¦æ¥æ›´é«˜çš„æ€§èƒ½ã€‚</li>\n<li>å¯¹äºåœ¨for-loopé‡Œçš„å›ºå®šçš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸€å®šè¦ä½¿ç”¨ <code>regexp.Compile()</code> ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼ã€‚æ€§èƒ½ä¼šæå‡ä¸¤ä¸ªæ•°é‡çº§ã€‚</li>\n<li>å¦‚æœä½ éœ€è¦æ›´é«˜æ€§èƒ½çš„åè®®ï¼Œå°±è¦è€ƒè™‘ä½¿ç”¨ <a href=\"https://github.com/golang/protobuf\">protobuf</a> æˆ– <a href=\"https://github.com/tinylib/msgp\">msgp</a> è€Œä¸æ˜¯JSONï¼Œå› ä¸ºJSONçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–é‡Œä½¿ç”¨äº†åå°„ã€‚</li>\n<li>ä½ åœ¨ä½¿ç”¨Mapçš„æ—¶å€™ï¼Œä½¿ç”¨æ•´å‹çš„keyä¼šæ¯”å­—ç¬¦ä¸²çš„è¦å¿«ï¼Œå› ä¸ºæ•´å‹æ¯”è¾ƒæ¯”å­—ç¬¦ä¸²æ¯”è¾ƒè¦å¿«ã€‚</li>\n</ul><h2>å‚è€ƒæ–‡æ¡£</h2><p>å…¶å®ï¼Œè¿˜æœ‰å¾ˆå¤šä¸é”™çš„æŠ€å·§ï¼Œæˆ‘ç»™ä½ æ¨èä¸€äº›å‚è€ƒæ–‡æ¡£ï¼Œå®ƒä»¬å¯ä»¥å¸®åŠ©ä½ å†™å‡ºæ›´å¥½çš„Goçš„ä»£ç ï¼Œå¿…è¯»ï¼</p><ul>\n<li><a href=\"https://golang.org/doc/effective_go.html\"><strong>Effective Go</strong></a></li>\n<li><a href=\"https://github.com/uber-go/guide/blob/master/style.md\"><strong>Uber Go Style</strong></a></li>\n<li><a href=\"http://devs.cloudimmunity.com/gotchas-and-common-mistakes-in-go-golang/\"><strong>50 Shades of Go: Traps, Gotchas, and Common Mistakes for New Golang Devs</strong></a></li>\n<li><a href=\"https://github.com/cristaloleg/go-advice\"><strong>Go Advice</strong></a></li>\n<li><a href=\"https://www.instana.com/blog/practical-golang-benchmarks/\"><strong>Practical Go Benchmarks</strong></a></li>\n<li><a href=\"https://github.com/alecthomas/go_serialization_benchmarks\"><strong>Benchmarks of Go serialization methods</strong></a></li>\n<li><a href=\"https://github.com/golang/go/wiki/Performance\"><strong>Debugging performance issues in Go programs</strong></a></li>\n<li><a href=\"https://medium.com/@val_deleplace/go-code-refactoring-the-23x-performance-hunt-156746b522f7\"><strong>Go code refactoring: the 23x performance hunt</strong></a></li>\n</ul><p>å¥½äº†ï¼Œè¿™èŠ‚è¯¾å°±åˆ°è¿™é‡Œã€‚å¦‚æœä½ è§‰å¾—ä»Šå¤©çš„å†…å®¹å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œæ¬¢è¿ä½ å¸®æˆ‘åˆ†äº«ç»™æ›´å¤šäººã€‚</p>","neighbors":{"left":{"article_title":"106 | é«˜æ•ˆæ²Ÿé€šï¼šå¥½å¥½è¯´è¯çš„è‰ºæœ¯","id":41008},"right":{"article_title":"108 | Go ç¼–ç¨‹æ¨¡å¼ï¼šé”™è¯¯å¤„ç†","id":332602}},"comments":[{"had_liked":false,"id":274684,"user_name":"Tony","can_delete":false,"product_type":"c1","uid":1046256,"ip_address":"","ucode":"76613C958AADBC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f6/f0/8ae16401.jpg","comment_is_top":false,"comment_ctime":1611124716,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"44560797676","product_id":100002201,"comment_content":"oh my godsh, è¿™ä¸ªä¸“æ ä¹°çš„æ˜¯çœŸå€¼ï¼Œè¿˜è¿½åŠ  Go çš„é€‰å­¦ğŸ¥•","like_count":10},{"had_liked":false,"id":275420,"user_name":"æˆˆå£æ»©çš„éª†é©¼è‰","can_delete":false,"product_type":"c1","uid":2338580,"ip_address":"","ucode":"333F078AC43DF4","user_header":"https://static001.geekbang.org/account/avatar/00/23/af/14/2113b75d.jpg","comment_is_top":false,"comment_ctime":1611533862,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14496435750","product_id":100002201,"comment_content":"çš“å“¥ï¼Œå¤ªå¼ºäº†ğŸ‘ğŸ‘ğŸ‘","like_count":3},{"had_liked":false,"id":311854,"user_name":"ç‰¹ç«‹ç‹¬è¡Œçš„çŒª","can_delete":false,"product_type":"c1","uid":1164195,"ip_address":"","ucode":"E96B277F45F60E","user_header":"https://static001.geekbang.org/account/avatar/00/11/c3/a3/50aa836d.jpg","comment_is_top":false,"comment_ctime":1631507179,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5926474475","product_id":100002201,"comment_content":"è¿™å°±æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹æ–¹æ³•çš„é»„é‡‘æ³•åˆ™â€”â€”â€œProgram to an interface not an implementationâ€ã€‚ è¿™å‡ ä¸ªå¾ªåºæ¸è¿›çš„ä¾‹å­ï¼Œçœ‹åˆ°è¿™é‡Œçªç„¶å°±é¡¿æ‚Ÿäº†","like_count":1},{"had_liked":false,"id":302978,"user_name":"Moonus","can_delete":false,"product_type":"c1","uid":1813327,"ip_address":"","ucode":"F8261DA1E8DF2C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqia9gfbDeu8RqUlSozxmnzr6micGefNs5QGehBBl23xH6V82GxYwjgFgCKIA9n6iafFVKFoxVw5fHWw/132","comment_is_top":false,"comment_ctime":1626491254,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5921458550","product_id":100002201,"comment_content":"ç¤ºä¾‹ä»£ç ï¼Œfoo = make([]int, 5) åˆå§‹åŒ–å°‘ä¸ª:  =&gt;foo := make([]int, 5)","like_count":1},{"had_liked":false,"id":280452,"user_name":"é‡ç”Ÿä¹‹è“","can_delete":false,"product_type":"c1","uid":2387542,"ip_address":"","ucode":"5C31C785413291","user_header":"https://static001.geekbang.org/account/avatar/00/24/6e/56/0a682bf8.jpg","comment_is_top":false,"comment_ctime":1614220081,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5909187377","product_id":100002201,"comment_content":"è¿™ä¸€ç« çœŸçš„å¾ˆèµï¼Œä½œä¸ºåŠè·¯å‡ºå®¶å­¦ä¹ goçš„ç å†œï¼Œæ¯ä¸ªçŸ¥è¯†ç‚¹éƒ½æ˜¯å®¹æ˜“å¿½ç•¥çš„é—®é¢˜ï¼Œçœ‹äº†è¿™ä¸ªèƒ½é¿å…ä¸å°‘å› ä¸ºå¯¹goç†è§£ä¸åˆ°ä½å¯¼è‡´çš„ç¨‹åºé”™è¯¯æˆ–è€…æ€§èƒ½é—®é¢˜ã€‚","like_count":1},{"had_liked":false,"id":353079,"user_name":"limix","can_delete":false,"product_type":"c1","uid":1166614,"ip_address":"é™•è¥¿","ucode":"76401FF54AE0D8","user_header":"https://static001.geekbang.org/account/avatar/00/11/cd/16/981cc4f8.jpg","comment_is_top":false,"comment_ctime":1659146949,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1659146949","product_id":100002201,"comment_content":"å‡½æ•°ï¼Œæˆå‘˜æ–¹æ³•å’Œæ¥å£ä¹‹é—´çš„äº’åŠ¨å…³ç³»ï¼Œè§£é‡Šåˆ°ä½äº†","like_count":0},{"had_liked":false,"id":340700,"user_name":"é™ˆç¦","can_delete":false,"product_type":"c1","uid":1607864,"ip_address":"","ucode":"48F974137EF0BE","user_header":"https://static001.geekbang.org/account/avatar/00/18/88/b8/7527da95.jpg","comment_is_top":false,"comment_ctime":1649057623,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1649057623","product_id":100002201,"comment_content":"å­¦ä¹ åˆ°äº†","like_count":0},{"had_liked":false,"id":312857,"user_name":"Groot","can_delete":false,"product_type":"c1","uid":1001257,"ip_address":"","ucode":"D3919AFA300C79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/47/29/425a2030.jpg","comment_is_top":false,"comment_ctime":1632061890,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632061890","product_id":100002201,"comment_content":"å…³äºæ¥å£å®Œæ•´æ€§æ£€æŸ¥é‚£å—ï¼Œç›´æ¥å°† s å£°æ˜ä¸º Shape ç±»å‹çš„å˜é‡æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥<br><br>var s Shape<br>s = Square{len: 5}","like_count":0},{"had_liked":false,"id":305903,"user_name":"æåˆš","can_delete":false,"product_type":"c1","uid":1424487,"ip_address":"","ucode":"BFA253F932F01B","user_header":"https://static001.geekbang.org/account/avatar/00/15/bc/67/2e19e8ef.jpg","comment_is_top":false,"comment_ctime":1628225306,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628225306","product_id":100002201,"comment_content":"æ€§èƒ½æç¤ºé‡Œå‡ ä¸ªæ€»ç»“ï¼Œè¿˜è¿‡å¾—å»","like_count":0},{"had_liked":false,"id":287745,"user_name":"å°ä¸¢ğŸ‘£","can_delete":false,"product_type":"c1","uid":1031711,"ip_address":"","ucode":"A7699F00418FC4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/be/1f/57c88dd1.jpg","comment_is_top":false,"comment_ctime":1618130871,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618130871","product_id":100002201,"comment_content":"æ¸…æ™°æ˜äº†ï¼Œä½©æœä½©æœ","like_count":0},{"had_liked":false,"id":282857,"user_name":"ä¸ºéª¨æ¶","can_delete":false,"product_type":"c1","uid":1485422,"ip_address":"","ucode":"5A138000F02466","user_header":"https://static001.geekbang.org/account/avatar/00/16/aa/6e/bd76019e.jpg","comment_is_top":false,"comment_ctime":1615442032,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1615442032","product_id":100002201,"comment_content":"åˆå­¦ï¼Œæ„Ÿè§‰å¾ˆé…·ï¼Œè¿˜å·®çš„è¿œå‘¢ï¼Œå‘è€å¸ˆçœ‹é½","like_count":0},{"had_liked":false,"id":274428,"user_name":"æ±ªè¾‰","can_delete":false,"product_type":"c1","uid":1625869,"ip_address":"","ucode":"2416B890609849","user_header":"https://static001.geekbang.org/account/avatar/00/18/cf/0d/a173e2b8.jpg","comment_is_top":false,"comment_ctime":1611020043,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1611020043","product_id":100002201,"comment_content":"å†™çš„å¾ˆå¥½","like_count":0}]}