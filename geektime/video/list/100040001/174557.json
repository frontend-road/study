{"id":174557,"title":"17 | 文档模型设计之三：模式套用","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-mongodb-course\">https://gitee.com/geektime-geekbang/geektime-mongodb-course</a></p>","comments":[{"had_liked":false,"id":159041,"user_name":"蒋腾飞同学","can_delete":false,"product_type":"c3","uid":1645665,"ip_address":"","ucode":"AF72D93DDAC536","user_header":"https://static001.geekbang.org/account/avatar/00/19/1c/61/0ca1ca43.jpg","comment_is_top":false,"comment_ctime":1575522098,"is_pvip":false,"replies":[{"id":60890,"content":"我会在全部内容更新完后考虑补充这方面","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1575594055,"ip_address":"","comment_id":159041,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"分桶模式太棒了，能再多学几个设计模型就更厉害了！","like_count":10,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476928,"discussion_content":"我会在全部内容更新完后考虑补充这方面","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575594055,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":179505,"user_name":"长脖子树","can_delete":false,"product_type":"c3","uid":1182802,"ip_address":"","ucode":"D9090EF67EEB1B","user_header":"https://static001.geekbang.org/account/avatar/00/12/0c/52/f25c3636.jpg","comment_is_top":false,"comment_ctime":1582017068,"is_pvip":true,"replies":[{"id":70062,"content":"update 语句第三个参数可以使用 upsert 属性，了解一下。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1582339158,"ip_address":"","comment_id":179505,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师好,  我刚刚学了两天mongodb, 我看了在您在课程中 对IOT 飞机的海量数据中的分桶设计, 我在实际操作时, 每次一个数据进来, 都要去查询一下这个小时&#47;分钟对应的文档有没有入库, 如果没有入库, 则新插入一条; 如果已经入库, 则更新这条文档数组里面的数据, 但我感觉每次查询很频繁. \n这种操作对不对, 有没有更好的方案? 比如 update 的时候直接插入了, 就不需要在插入&#47;更新之前的查询了 ","like_count":7,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484285,"discussion_content":"update 语句第三个参数可以使用 upsert 属性，了解一下。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582339158,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":159837,"user_name":"奕","can_delete":false,"product_type":"c3","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1575806513,"is_pvip":false,"replies":[{"id":61200,"content":"db.collection.stats() 的结果里面有索引大小。\n\n....\n\n\t&quot;totalIndexSize&quot; : 32768,\n\t&quot;indexSizes&quot; : {\n\t\t&quot;_id_&quot; : 32768\n\t},\n\t&quot;ok&quot; : 1\n","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1575944327,"ip_address":"","comment_id":159837,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"这个索引需要的 存储空间大小，是怎么计算出来的啊？","like_count":2,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477189,"discussion_content":"db.collection.stats() 的结果里面有索引大小。\n\n....\n\n\t&amp;quot;totalIndexSize&amp;quot; : 32768,\n\t&amp;quot;indexSizes&amp;quot; : {\n\t\t&amp;quot;_id_&amp;quot; : 32768\n\t},\n\t&amp;quot;ok&amp;quot; : 1\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575944327,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1265707,"avatar":"https://static001.geekbang.org/account/avatar/00/13/50/2b/2344cdaa.jpg","nickname":"第一装甲集群司令克莱斯特","note":"","ucode":"4E8FBB23AD860B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":116002,"discussion_content":"这个统计函数很有用。mongo单个文档的大小是16m，这有点不够用吧，而且mongo的开发者也没打算放开这个文档大小容量限制。怎么通过sql查询单个文档的大小呢?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578050213,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1645665,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/61/0ca1ca43.jpg","nickname":"蒋腾飞同学","note":"","ucode":"AF72D93DDAC536","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":87004,"discussion_content":"学到了～","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576637170,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":180535,"user_name":"密码123456","can_delete":false,"product_type":"c3","uid":1126593,"ip_address":"","ucode":"9889463CC0EA71","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/c1/2dde6700.jpg","comment_is_top":false,"comment_ctime":1582325727,"is_pvip":false,"replies":[{"id":70084,"content":"如果一个查询正好要跨越两个或多个桶，可能会略麻烦。比如说，我们每个小时的数据放在一个文档内，从00分到59分。但是如果你想要从15分到下个小时15分之间的数据来统计分析，就没那么直观了。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1582347842,"ip_address":"","comment_id":180535,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"优势是减少读的次数及空间的占用，那劣势是什么呢？","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484699,"discussion_content":"如果一个查询正好要跨越两个或多个桶，可能会略麻烦。比如说，我们每个小时的数据放在一个文档内，从00分到59分。但是如果你想要从15分到下个小时15分之间的数据来统计分析，就没那么直观了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582347842,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":167953,"user_name":"jone","can_delete":false,"product_type":"c3","uid":1318619,"ip_address":"","ucode":"00D0C54BE1005C","user_header":"https://static001.geekbang.org/account/avatar/00/14/1e/db/921367d6.jpg","comment_is_top":false,"comment_ctime":1577968591,"is_pvip":false,"replies":[{"id":66841,"content":"是的，这是个笔误，感谢指出，我看如何更正一下。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1579167936,"ip_address":"","comment_id":167953,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"这个索引，应该是deviceId在前，ts范围时间在后吧。如果范围在前面，查询某个deviceId，某个时间段，只能用上时间段的那个索引。","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480066,"discussion_content":"是的，这是个笔误，感谢指出，我看如何更正一下。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579167936,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":160603,"user_name":"V","can_delete":false,"product_type":"c3","uid":1222072,"ip_address":"","ucode":"1A2EB517472AB8","user_header":"https://static001.geekbang.org/account/avatar/00/12/a5/b8/efe79ce1.jpg","comment_is_top":false,"comment_ctime":1575984426,"is_pvip":false,"replies":[{"id":62987,"content":"第三部分就有。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1577189944,"ip_address":"","comment_id":160603,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"唐师 什么时候讲讲索引的使用？","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477430,"discussion_content":"第三部分就有。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577189944,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1645665,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/61/0ca1ca43.jpg","nickname":"蒋腾飞同学","note":"","ucode":"AF72D93DDAC536","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":87006,"discussion_content":"估计后面应该有讲～","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576637233,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":173880,"user_name":"WING","can_delete":false,"product_type":"c3","uid":1485200,"ip_address":"","ucode":"E4723BA4027407","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/IdElofI20lsCUm1NIQPSpYFzAGLbLs41SL324FkmTb0icqnRJicW6mqX4iag1BQUSNtc7BtKJ2fEUYwU4rN47vEsQ/132","comment_is_top":false,"comment_ctime":1579751921,"is_pvip":false,"replies":[{"id":67868,"content":"这个取决于你的采样点。如果是每秒或者更频繁的话，可能就不太合适了，用分钟会好一点。 ","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1580282594,"ip_address":"","comment_id":173880,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师，如果有个需求是在地图上绘制飞机的某一次航班的行程轨迹，按小时分桶合适吗？","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482226,"discussion_content":"这个取决于你的采样点。如果是每秒或者更频繁的话，可能就不太合适了，用分钟会好一点。 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580282594,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":159997,"user_name":"PHP是世界上最好的需要","can_delete":false,"product_type":"c3","uid":1655326,"ip_address":"","ucode":"EE23A54B831D17","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIma3PJUyqDEQKt40nEh3Jt840af6hKnuK8k8dIscm43EUzJwLvynbxRnvO9Ivibv7KssUSqoBdY1w/132","comment_is_top":false,"comment_ctime":1575855806,"is_pvip":false,"replies":[{"id":61196,"content":"使用合适的索引（mongo支持桶里内嵌字段的索引）就可以。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1575943840,"ip_address":"","comment_id":159997,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"如果按照分桶内的某些时间进行查询数据时，会不会影响查询速度？","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477228,"discussion_content":"使用合适的索引（mongo支持桶里内嵌字段的索引）就可以。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575943840,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1655326,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIma3PJUyqDEQKt40nEh3Jt840af6hKnuK8k8dIscm43EUzJwLvynbxRnvO9Ivibv7KssUSqoBdY1w/132","nickname":"PHP是世界上最好的需要","note":"","ucode":"EE23A54B831D17","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":77848,"discussion_content":"还有一个问题，我们用mongo做日志存储，按月存储，但是数据达到四百万量级时，写入速度会很慢，我应该从哪方面来排查进行解决问题呢？多谢老师","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575947487,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":274995,"user_name":"小乐🌚","can_delete":false,"product_type":"c3","uid":1570064,"ip_address":"","ucode":"DACD61CBCBB666","user_header":"https://static001.geekbang.org/account/avatar/00/17/f5/10/b801454e.jpg","comment_is_top":false,"comment_ctime":1611246894,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师想请教一下，应用场景是一个报价体系，一个报价人会对多个产品进行报价，并且对每个产品的报价可能会不断调整，需要保留历史报价记录。查询的场景是，已知某个产品，需要查出对这个产品报过价的报价人的最新价格。怎么设计模型更合理？","like_count":1},{"had_liked":false,"id":171791,"user_name":"确认过眼神","can_delete":false,"product_type":"c3","uid":1245530,"ip_address":"","ucode":"E6D73A9D27A279","user_header":"https://static001.geekbang.org/account/avatar/00/13/01/5a/f7c989e4.jpg","comment_is_top":false,"comment_ctime":1579012731,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"分桶模式的边界可以是分钟、小时、天数，甚至月份、年份，如何根据实际场景找到这个边界、提高写入或查询的效率？","like_count":1},{"had_liked":false,"id":159344,"user_name":"申学晋","can_delete":false,"product_type":"c3","uid":1748750,"ip_address":"","ucode":"3F329A4DEBEE97","user_header":"https://static001.geekbang.org/account/avatar/00/1a/af/0e/ac955022.jpg","comment_is_top":false,"comment_ctime":1575602813,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"当前一个项目使用了分桶模式，实测效果还不错，想请教一下老师，还有没有更好的优化方案，\n场景：类IoT项目，时间序列数据，每组10000个传感器左右，最快采集一次0.5s，慢的10s一次，当前方案每个传感器按1小时分桶，对不变化的数值进行抽样处理，如果1小时内不变化，只存3个点。当前只实现了1组数据的实时入库和读取，后续要扩展可支持300组数据（每组5000-10000规模）采集最快0.1s一次。应该如何优化？谢谢老师","like_count":1,"discussions":[{"author":{"id":1133194,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4a/8a/c1069412.jpg","nickname":"makermade","note":"","ucode":"03386B90CB8F20","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364381,"discussion_content":"分片集群","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617460536,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360659,"user_name":"newbiner","can_delete":false,"product_type":"c3","uid":1310478,"ip_address":"北京","ucode":"04F4B4FDB79854","user_header":"","comment_is_top":false,"comment_ctime":1666742110,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"老师，有个疑惑，之前您说的文档大小限制在16M，那现在以小时分桶文档大小是800+M，这个是不是矛盾的阿？望老师解答","like_count":0},{"had_liked":false,"id":268455,"user_name":"Mr. 小麦🍔","can_delete":false,"product_type":"c3","uid":2041185,"ip_address":"","ucode":"02ED67FCCE3789","user_header":"https://static001.geekbang.org/account/avatar/00/1f/25/61/0fa1b377.jpg","comment_is_top":false,"comment_ctime":1608204841,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"针对分桶模式有一个疑问，就以飞机传感器的场景为例，由于是随着时间的推移向分桶的数组中插入数据，那么文档的大小一定是随着时间变得越来越大的，当文档大小超过了一开始为改文档在存储上分配的大小后，此时文档刷入磁盘，这时存储的机制是怎样的？是类似关系型数据库行迁移的处理方式，将部分数据存入原来的存储位置，放不下的在存储中额外存储？还是会针对新文档重新分配新的存储位置？","like_count":0},{"had_liked":false,"id":220272,"user_name":"郑文峰","can_delete":false,"product_type":"c3","uid":1511766,"ip_address":"","ucode":"E9DC0BF7942AEB","user_header":"https://static001.geekbang.org/account/avatar/00/17/11/56/126ea599.jpg","comment_is_top":false,"comment_ctime":1590219270,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"分桶模式是真的实用、有效..","like_count":0},{"had_liked":false,"id":194937,"user_name":"追忆似水年华","can_delete":false,"product_type":"c3","uid":1160192,"ip_address":"","ucode":"C1D7C0DD7E7411","user_header":"https://static001.geekbang.org/account/avatar/00/11/b4/00/661fb98d.jpg","comment_is_top":false,"comment_ctime":1585122212,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"分桶模式太赞了，本质就是将那些数据量很大的字段，在不影响实际业务的前提下，通过“降维”，即将原本的一条数据一个文档，转变为一批数据一个文档。乍一看可能是用时间换空间，但很可能是既节约了空间，又没影响时间，很漂亮！","like_count":0},{"had_liked":false,"id":183969,"user_name":"密码123456","can_delete":false,"product_type":"c3","uid":1126593,"ip_address":"","ucode":"9889463CC0EA71","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/c1/2dde6700.jpg","comment_is_top":false,"comment_ctime":1583190357,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"提问。如果要求对时间进行排序。分页怎么做？如果不是查询一个航班，而是所有航班在一起。进行排序，分页怎么办？","like_count":0},{"had_liked":false,"id":176769,"user_name":"初九","can_delete":false,"product_type":"c3","uid":1204202,"ip_address":"","ucode":"133B62AA10D89C","user_header":"https://static001.geekbang.org/account/avatar/00/12/5f/ea/1cd99202.jpg","comment_is_top":false,"comment_ctime":1581160221,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"这个数据写入的操作是每分钟往events插入当前分钟采集到的数据吗？","like_count":0},{"had_liked":false,"id":162439,"user_name":"YoKate","can_delete":false,"product_type":"c3","uid":1204743,"ip_address":"","ucode":"1D65BC35057F89","user_header":"https://static001.geekbang.org/account/avatar/00/12/62/07/953d0f7f.jpg","comment_is_top":false,"comment_ctime":1576533724,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"课程内容真不错，迫不及待的想看事务的介绍。看完就用到我的项目上去。","like_count":0},{"had_liked":false,"id":161878,"user_name":"😳","can_delete":false,"product_type":"c3","uid":1452857,"ip_address":"","ucode":"9AFB87EF308539","user_header":"https://static001.geekbang.org/account/avatar/00/16/2b/39/19041d78.jpg","comment_is_top":false,"comment_ctime":1576388167,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"这个模式真的很厉害啊.优化了这么多,每条数据重复的字段只存一次,不同的数据用文档存起来,很大的减少了数据量啊","like_count":0},{"had_liked":false,"id":159578,"user_name":"Aaron niu","can_delete":false,"product_type":"c3","uid":1315335,"ip_address":"","ucode":"8CB10D7494DDAC","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epujZ0vpjYD4KiaCI400YdfFenDotavczNpxzQ1AZdEichAhdEXWOyoGIksnG5meRibRTwTEibdmcPo1Q/132","comment_is_top":false,"comment_ctime":1575691560,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"分桶太腻害了","like_count":0},{"had_liked":false,"id":158913,"user_name":"长期规划","can_delete":false,"product_type":"c3","uid":1019332,"ip_address":"","ucode":"5EF65E9115834B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","comment_is_top":false,"comment_ctime":1575478030,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100040001,"comment_content":"分桶模式不错","like_count":0}]}