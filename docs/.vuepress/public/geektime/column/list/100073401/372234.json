{"id":372234,"title":"25 | Spark 3.0ï¼ˆäºŒï¼‰ï¼šDPPç‰¹æ€§è¯¥æ€ä¹ˆç”¨ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å´ç£Šã€‚</p><p>DPPï¼ˆDynamic Partition Pruningï¼ŒåŠ¨æ€åˆ†åŒºå‰ªè£ï¼‰æ˜¯Spark 3.0ç‰ˆæœ¬ä¸­ç¬¬äºŒä¸ªå¼•äººæ³¨ç›®çš„ç‰¹æ€§ï¼Œå®ƒæŒ‡çš„æ˜¯åœ¨æ˜Ÿå‹æ•°ä»“çš„æ•°æ®å…³è”åœºæ™¯ä¸­ï¼Œå¯ä»¥å……åˆ†åˆ©ç”¨è¿‡æ»¤ä¹‹åçš„ç»´åº¦è¡¨ï¼Œå¤§å¹…å‰Šå‡äº‹å®è¡¨çš„æ•°æ®æ‰«æé‡ï¼Œä»æ•´ä½“ä¸Šæå‡å…³è”è®¡ç®—çš„æ‰§è¡Œæ€§èƒ½ã€‚</p><p>ä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å°±é€šè¿‡ä¸€ä¸ªç”µå•†åœºæ™¯ä¸‹çš„ä¾‹å­ï¼Œæ¥è¯´è¯´ä»€ä¹ˆæ˜¯åˆ†åŒºå‰ªè£ï¼Œä»€ä¹ˆæ˜¯åŠ¨æ€åˆ†åŒºå‰ªè£ï¼Œå®ƒçš„ä½œç”¨ã€ç”¨æ³•å’Œæ³¨æ„äº‹é¡¹ï¼Œè®©ä½ ä¸€æ¬¡å°±å­¦ä¼šæ€ä¹ˆç”¨å¥½DPPã€‚</p><h2>åˆ†åŒºå‰ªè£</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹è¿™ä¸ªä¾‹å­ã€‚åœ¨æ˜Ÿå‹ï¼ˆStart Schemaï¼‰æ•°ä»“ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸¤å¼ è¡¨ï¼Œä¸€å¼ æ˜¯è®¢å•è¡¨ordersï¼Œå¦ä¸€å¼ æ˜¯ç”¨æˆ·è¡¨usersã€‚æ˜¾ç„¶ï¼Œè®¢å•è¡¨æ˜¯äº‹å®è¡¨ï¼ˆFactï¼‰ï¼Œè€Œç”¨æˆ·è¡¨æ˜¯ç»´åº¦è¡¨ï¼ˆDimensionï¼‰ã€‚ä¸šåŠ¡éœ€æ±‚æ˜¯ç»Ÿè®¡æ‰€æœ‰å¤´éƒ¨ç”¨æˆ·è´¡çŒ®çš„è¥ä¸šé¢ï¼Œå¹¶æŒ‰ç…§è¥ä¸šé¢å€’åºæ’åºã€‚é‚£è¿™ä¸ªéœ€æ±‚è¯¥æ€ä¹ˆå®ç°å‘¢ï¼Ÿ</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ä¸¤å¼ è¡¨çš„å…³é”®å­—æ®µï¼Œçœ‹çœ‹æŸ¥è¯¢è¯­å¥åº”è¯¥æ€ä¹ˆå†™ã€‚</p><pre><code>// è®¢å•è¡¨orderså…³é”®å­—æ®µ\nuserId, Int\nitemId, Int\nprice, Float\nquantity, Int\n \n// ç”¨æˆ·è¡¨userså…³é”®å­—æ®µ\nid, Int\nname, String\ntype, String //æšä¸¾å€¼ï¼Œåˆ†ä¸ºå¤´éƒ¨ç”¨æˆ·å’Œé•¿å°¾ç”¨æˆ·\n\n</code></pre><p>ç»™å®šä¸Šè¿°æ•°æ®è¡¨ï¼Œæˆ‘ä»¬åªéœ€æŠŠä¸¤å¼ è¡¨åšå†…å…³è”ï¼Œç„¶ååˆ†ç»„ã€èšåˆã€æ’åºï¼Œå°±å¯ä»¥å®ç°ä¸šåŠ¡é€»è¾‘ï¼Œå…·ä½“çš„æŸ¥è¯¢è¯­å¥å¦‚ä¸‹ã€‚</p><pre><code>select (orders.price * order.quantity) as income, users.name\nfrom orders inner join users on orders.userId = users.id\nwhere users.type = â€˜Head Userâ€™\ngroup by users.name\norder by income desc\n</code></pre><p>çœ‹åˆ°è¿™æ ·çš„æŸ¥è¯¢è¯­å¥ï¼Œå†ç»“åˆSpark SQLé‚£å‡ è®²å­¦åˆ°çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬å¾ˆå¿«å°±èƒ½ç”»å‡ºå®ƒçš„é€»è¾‘æ‰§è¡Œè®¡åˆ’ã€‚</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/b2/5b/b200746c2c4e462b96f9a2031b7f285b.jpg?wh=1645*1416\" alt=\"\" title=\"é€»è¾‘è®¡åˆ’\"></p><p>ç”±äºæŸ¥è¯¢è¯­å¥ä¸­äº‹å®è¡¨ä¸Šæ²¡æœ‰è¿‡æ»¤æ¡ä»¶ï¼Œå› æ­¤ï¼Œåœ¨æ‰§è¡Œè®¡åˆ’çš„å·¦ä¾§ï¼ŒSpark SQLé€‰æ‹©å…¨è¡¨æ‰«æçš„æ–¹å¼æ¥æŠ•å½±å‡ºuserIdã€priceå’Œquantityè¿™äº›å­—æ®µã€‚ç›¸åï¼Œç»´åº¦è¡¨ä¸Šæœ‰è¿‡æ»¤æ¡ä»¶users.type = â€˜Head Userâ€™ï¼Œå› æ­¤ï¼ŒSpark SQLå¯ä»¥åº”ç”¨è°“è¯ä¸‹æ¨è§„åˆ™ï¼ŒæŠŠè¿‡æ»¤æ“ä½œä¸‹æ¨åˆ°æ•°æ®æºä¹‹ä¸Šï¼Œæ¥å‡å°‘å¿…éœ€çš„ç£ç›˜I/Oå¼€é”€ã€‚</p><p>è™½ç„¶è°“è¯ä¸‹æ¨å·²ç»å¾ˆç»™åŠ›äº†ï¼Œä½†å¦‚æœç”¨æˆ·è¡¨æ”¯æŒåˆ†åŒºå‰ªè£ï¼ˆPartition Pruningï¼‰ï¼ŒI/Oæ•ˆç‡çš„æå‡å°±ä¼šæ›´åŠ æ˜¾è‘—ã€‚é‚£ä»€ä¹ˆæ˜¯åˆ†åŒºå‰ªè£å‘¢ï¼Ÿå®é™…ä¸Šï¼Œåˆ†åŒºå‰ªè£æ˜¯è°“è¯ä¸‹æ¨çš„ä¸€ç§ç‰¹ä¾‹ï¼Œå®ƒæŒ‡çš„æ˜¯åœ¨åˆ†åŒºè¡¨ä¸­ä¸‹æ¨è°“è¯ï¼Œå¹¶ä»¥æ–‡ä»¶ç³»ç»Ÿç›®å½•ä¸ºå•ä½å¯¹æ•°æ®é›†è¿›è¡Œè¿‡æ»¤ã€‚åˆ†åŒºè¡¨å°±æ˜¯é€šè¿‡æŒ‡å®šåˆ†åŒºé”®ï¼Œç„¶åä½¿ç”¨partitioned byè¯­å¥åˆ›å»ºçš„æ•°æ®è¡¨ï¼Œæˆ–è€…æ˜¯ä½¿ç”¨partitionByè¯­å¥å­˜å‚¨çš„åˆ—å­˜æ–‡ä»¶ï¼ˆå¦‚Parquetã€ORCç­‰ï¼‰ã€‚</p><p>ç›¸æ¯”æ™®é€šæ•°æ®è¡¨ï¼Œåˆ†åŒºè¡¨ç‰¹åˆ«çš„åœ°æ–¹å°±åœ¨äºå®ƒçš„å­˜å‚¨æ–¹å¼ã€‚å¯¹äºåˆ†åŒºé”®ä¸­çš„æ¯ä¸€ä¸ªæ•°æ®å€¼ï¼Œåˆ†åŒºè¡¨éƒ½ä¼šåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­åˆ›å»ºå•ç‹¬çš„å­ç›®å½•æ¥å­˜å‚¨ç›¸åº”çš„æ•°æ®åˆ†ç‰‡ã€‚æ‹¿ç”¨æˆ·è¡¨æ¥ä¸¾ä¾‹ï¼Œå‡è®¾ç”¨æˆ·è¡¨æ˜¯åˆ†åŒºè¡¨ï¼Œä¸”ä»¥typeå­—æ®µä½œä¸ºåˆ†åŒºé”®ï¼Œé‚£ä¹ˆç”¨æˆ·è¡¨ä¼šæœ‰ä¸¤ä¸ªå­ç›®å½•ï¼Œå‰ç¼€åˆ†åˆ«æ˜¯â€œHead Userâ€å’Œâ€œTail Userâ€ã€‚æ•°æ®è®°å½•è¢«å­˜å‚¨äºå“ªä¸ªå­ç›®å½•å®Œå…¨å–å†³äºè®°å½•ä¸­typeå­—æ®µçš„å€¼ï¼Œæ¯”å¦‚ï¼šæ‰€æœ‰typeå­—æ®µå€¼ä¸ºâ€œHead Userâ€çš„æ•°æ®è®°å½•éƒ½è¢«å­˜å‚¨åˆ°å‰ç¼€ä¸ºâ€œHead Userâ€çš„å­ç›®å½•ã€‚åŒç†ï¼Œæ‰€æœ‰typeå­—æ®µå€¼ä¸ºâ€œTail Userâ€çš„æ•°æ®è®°å½•ï¼Œå…¨éƒ¨è¢«å­˜æ”¾åˆ°å‰ç¼€ä¸ºâ€œTail Userâ€çš„å­ç›®å½•ã€‚</p><p>ä¸éš¾å‘ç°ï¼Œ<strong>å¦‚æœè¿‡æ»¤è°“è¯ä¸­åŒ…å«åˆ†åŒºé”®ï¼Œé‚£ä¹ˆSpark SQLå¯¹åˆ†åŒºè¡¨åšæ‰«æçš„æ—¶å€™ï¼Œæ˜¯å®Œå…¨å¯ä»¥è·³è¿‡ï¼ˆå‰ªæ‰ï¼‰ä¸æ»¡è¶³è°“è¯æ¡ä»¶çš„åˆ†åŒºç›®å½•ï¼Œè¿™å°±æ˜¯åˆ†åŒºå‰ªè£ã€‚</strong>ä¾‹å¦‚ï¼Œåœ¨æˆ‘ä»¬çš„æŸ¥è¯¢è¯­å¥ä¸­ï¼Œç”¨æˆ·è¡¨çš„è¿‡æ»¤è°“è¯æ˜¯â€œusers.type = â€˜Head Userâ€™â€ã€‚å‡è®¾ç”¨æˆ·è¡¨æ˜¯åˆ†åŒºè¡¨ï¼Œé‚£ä¹ˆå¯¹äºç”¨æˆ·è¡¨çš„æ•°æ®æ‰«æï¼ŒSpark SQLå¯ä»¥å®Œå…¨è·³è¿‡å‰ç¼€ä¸ºâ€œTail Userâ€çš„å­ç›®å½•ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/ee/d9/ee84e71580dc5fc61d0a542fdfca57d9.jpg?wh=4259*1614\" alt=\"\" title=\"è°“è¯ä¸‹æ¨ä¸åˆ†åŒºå‰ªè£\"></p><p>é€šè¿‡ä¸è°“è¯ä¸‹æ¨ä½œå¯¹æ¯”ï¼Œæˆ‘ä»¬å¯ä»¥ç›´è§‚åœ°æ„Ÿå—åˆ†åŒºå‰ªè£çš„å¨åŠ›ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œä¸Šä¸‹ä¸¤è¡Œåˆ†åˆ«è¡¨ç¤ºç”¨æˆ·è¡¨åœ¨ä¸åšåˆ†åŒºå’Œåšåˆ†åŒºçš„æƒ…å†µä¸‹ï¼ŒSpark SQLå¯¹äºç”¨æˆ·è¡¨çš„æ•°æ®æ‰«æã€‚åœ¨ä¸åšåˆ†åŒºçš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·è¡¨æ‰€æœ‰çš„æ•°æ®åˆ†ç‰‡å…¨éƒ¨å­˜äºåŒä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿç›®å½•ï¼Œå°½ç®¡Parquetæ ¼å¼åœ¨æ³¨è„šï¼ˆFooter)ä¸­æä¾›äº†typeå­—æ®µçš„ç»Ÿè®¡å€¼ï¼ŒSpark SQLå¯ä»¥åˆ©ç”¨è°“è¯ä¸‹æ¨æ¥å‡å°‘éœ€è¦æ‰«æçš„æ•°æ®åˆ†ç‰‡ï¼Œä½†ç”±äºå¾ˆå¤šåˆ†ç‰‡æ³¨è„šä¸­çš„typeå­—æ®µåŒæ—¶åŒ…å«â€˜Head Userâ€™å’Œâ€˜Tail Userâ€™ï¼ˆç¬¬ä¸€è¡Œ3ä¸ªæµ…ç»¿è‰²çš„æ•°æ®åˆ†ç‰‡ï¼‰ï¼Œå› æ­¤ï¼Œç”¨æˆ·è¡¨çš„æ•°æ®æ‰«æä»ç„¶ä¼šæ¶‰åŠ4ä¸ªæ•°æ®åˆ†ç‰‡ã€‚</p><p>ç›¸åï¼Œå½“ç”¨æˆ·è¡¨æœ¬èº«å°±æ˜¯åˆ†åŒºè¡¨æ—¶ï¼Œç”±äºtypeå­—æ®µä¸ºâ€˜Head Userâ€™çš„æ•°æ®è®°å½•å…¨éƒ¨å­˜å‚¨åˆ°å‰ç¼€ä¸ºâ€˜Head Userâ€™çš„å­ç›®å½•ï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­ç¬¬äºŒè¡Œæµ…ç»¿è‰²çš„æ–‡ä»¶ç³»ç»Ÿç›®å½•ï¼Œè¿™ä¸ªç›®å½•ä¸­ä»…åŒ…å«ä¸¤ä¸ªtypeå­—æ®µå…¨éƒ¨ä¸ºâ€˜Head Userâ€™çš„æ•°æ®åˆ†ç‰‡ã€‚è¿™æ ·ä¸€æ¥ï¼ŒSpark SQLå¯ä»¥å®Œå…¨è·³è¿‡å…¶ä»–å­ç›®å½•çš„æ‰«æï¼Œä»è€Œå¤§å¹…æå‡I/Oæ•ˆç‡ã€‚</p><p>ä½ å¯èƒ½ä¼šè¯´ï¼šâ€œæ—¢ç„¶åˆ†åŒºå‰ªè£è¿™ä¹ˆå‰å®³ï¼Œé‚£ä¹ˆæˆ‘æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥æŠŠå®ƒåº”ç”¨åˆ°äº‹å®è¡¨ä¸Šå»å‘¢ï¼Ÿæ¯•ç«Ÿäº‹å®è¡¨çš„ä½“é‡æ›´å¤§ï¼Œç›¸æ¯”ç»´åº¦è¡¨ï¼Œäº‹å®è¡¨ä¸ŠI/Oæ•ˆç‡çš„æå‡ç©ºé—´æ›´å¤§ã€‚â€æ²¡é”™ï¼Œå¦‚æœäº‹å®è¡¨æœ¬èº«å°±æ˜¯åˆ†åŒºè¡¨ï¼Œä¸”è¿‡æ»¤è°“è¯ä¸­åŒ…å«åˆ†åŒºé”®ï¼Œé‚£ä¹ˆSpark SQLåŒæ ·ä¼šåˆ©ç”¨åˆ†åŒºå‰ªè£ç‰¹æ€§æ¥å¤§å¹…å‡å°‘æ•°æ®æ‰«æé‡ã€‚</p><p>ä¸è¿‡ï¼Œå¯¹äºå®é™…å·¥ä½œä¸­çš„ç»å¤§å¤šæ•°å…³è”æŸ¥è¯¢æ¥è¯´ï¼Œäº‹å®è¡¨éƒ½ä¸æ»¡è¶³åˆ†åŒºå‰ªè£æ‰€éœ€çš„å‰ææ¡ä»¶ã€‚æ¯”å¦‚è¯´ï¼Œè¦ä¹ˆäº‹å®è¡¨ä¸æ˜¯åˆ†åŒºè¡¨ï¼Œè¦ä¹ˆäº‹å®è¡¨ä¸Šæ²¡æœ‰è¿‡æ»¤è°“è¯ï¼Œæˆ–è€…å°±æ˜¯è¿‡æ»¤è°“è¯ä¸åŒ…å«åˆ†åŒºé”®ã€‚å°±æ‹¿ç”µå•†åœºæ™¯çš„ä¾‹å­æ¥è¯´ï¼ŒæŸ¥è¯¢ä¸­å‹æ ¹å°±æ²¡æœ‰ä¸è®¢å•è¡¨ç›¸å…³çš„è¿‡æ»¤è°“è¯ã€‚å› æ­¤ï¼Œå³ä¾¿è®¢å•è¡¨æœ¬èº«å°±æ˜¯åˆ†åŒºè¡¨ï¼ŒSpark SQLä¹Ÿæ²¡åŠæ³•åˆ©ç”¨åˆ†åŒºå‰ªè£ç‰¹æ€§ã€‚</p><p>å¯¹äºè¿™æ ·çš„å…³è”æŸ¥è¯¢ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯åªèƒ½ä»»ç”±Spark SQLå»å…¨é‡æ‰«æäº‹å®è¡¨å‘¢ï¼Ÿè¦æ˜¯åœ¨ä»¥å‰ï¼Œæˆ‘ä»¬è¿˜æ²¡ä»€ä¹ˆåŠæ³•ã€‚ä¸è¿‡ï¼Œæœ‰äº†Spark 3.0æ¨å‡ºçš„DPPç‰¹æ€§ä¹‹åï¼Œæƒ…å†µå°±å¤§ä¸ä¸€æ ·äº†ã€‚</p><h2>åŠ¨æ€åˆ†åŒºå‰ªè£</h2><p>æˆ‘ä»¬åˆšæ‰è¯´äº†ï¼ŒDPPæŒ‡çš„æ˜¯åœ¨æ•°æ®å…³è”çš„åœºæ™¯ä¸­ï¼ŒSpark SQLåˆ©ç”¨ç»´åº¦è¡¨æä¾›çš„è¿‡æ»¤ä¿¡æ¯ï¼Œå‡å°‘äº‹å®è¡¨ä¸­æ•°æ®çš„æ‰«æé‡ã€é™ä½I/Oå¼€é”€ï¼Œä»è€Œæå‡æ‰§è¡Œæ€§èƒ½ã€‚é‚£ä¹ˆï¼ŒDPPæ˜¯æ€ä¹ˆåšåˆ°è¿™ä¸€ç‚¹çš„å‘¢ï¼Ÿå®ƒèƒŒåçš„é€»è¾‘æ˜¯ä»€ä¹ˆï¼Ÿä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼Œæˆ‘ä»¬è¿˜ç”¨åˆšåˆšçš„ä¾‹å­æ¥è§£é‡Šã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a6/b2/a683004565a3dcc1abb72922319d67b2.jpg?wh=1900*1502\" alt=\"\" title=\"DPPèƒŒåçš„å®ç°é€»è¾‘\"></p><p>é¦–å…ˆï¼Œè¿‡æ»¤æ¡ä»¶users.type = â€˜Head Userâ€™ä¼šå¸®åŠ©ç»´åº¦è¡¨è¿‡æ»¤ä¸€éƒ¨åˆ†æ•°æ®ã€‚ä¸æ­¤åŒæ—¶ï¼Œç»´åº¦è¡¨çš„IDå­—æ®µä¹Ÿé¡ºå¸¦ç€ç»è¿‡ä¸€è½®ç­›é€‰ï¼Œå¦‚å›¾ä¸­çš„æ­¥éª¤1æ‰€ç¤ºã€‚ç»è¿‡è¿™ä¸€è½®ç­›é€‰ä¹‹åï¼Œä¿ç•™ä¸‹æ¥çš„IDå€¼ï¼Œä»…ä»…æ˜¯ç»´åº¦è¡¨IDå…¨é›†çš„ä¸€ä¸ªå­é›†ã€‚</p><p>ç„¶åï¼Œåœ¨å…³è”å…³ç³»ä¹Ÿå°±æ˜¯orders.userId = users.idçš„ä½œç”¨ä¸‹ï¼Œè¿‡æ»¤æ•ˆæœä¼šé€šè¿‡usersçš„IDå­—æ®µä¼ å¯¼åˆ°äº‹å®è¡¨çš„userIdå­—æ®µï¼Œä¹Ÿå°±æ˜¯å›¾ä¸­çš„æ­¥éª¤2ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ»¡è¶³å…³è”å…³ç³»çš„userIdå€¼ï¼Œä¹Ÿæ˜¯äº‹å®è¡¨userIdå…¨é›†ä¸­çš„ä¸€ä¸ªå­é›†ã€‚æŠŠæ»¡è¶³æ¡ä»¶çš„userIdä½œä¸ºè¿‡æ»¤æ¡ä»¶ï¼Œåº”ç”¨ï¼ˆApplyï¼‰åˆ°äº‹å®è¡¨çš„æ•°æ®æºï¼Œå°±å¯ä»¥åšåˆ°å‡å°‘æ•°æ®æ‰«æé‡ï¼Œæå‡I/Oæ•ˆç‡ï¼Œå¦‚å›¾ä¸­çš„æ­¥éª¤3æ‰€ç¤ºã€‚</p><p>DPPæ­£æ˜¯åŸºäºä¸Šè¿°é€»è¾‘ï¼ŒæŠŠç»´åº¦è¡¨ä¸­çš„è¿‡æ»¤æ¡ä»¶ï¼Œé€šè¿‡å…³è”å…³ç³»ä¼ å¯¼åˆ°äº‹å®è¡¨ï¼Œä»è€Œå®Œæˆäº‹å®è¡¨çš„ä¼˜åŒ–ã€‚è™½ç„¶DPPçš„è¿ä½œé€»è¾‘éå¸¸æ¸…æ™°ï¼Œä½†å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ•°æ®å…³è”åœºæ™¯éƒ½å¯ä»¥äº«å—åˆ°DPPçš„ä¼˜åŒ–æœºåˆ¶ï¼Œæƒ³è¦åˆ©ç”¨DPPæ¥åŠ é€Ÿäº‹å®è¡¨æ•°æ®çš„è¯»å–å’Œè®¿é—®ï¼Œæ•°æ®å…³è”åœºæ™¯è¿˜è¦æ»¡è¶³ä¸‰ä¸ªé¢å¤–çš„æ¡ä»¶ã€‚</p><p>é¦–å…ˆï¼ŒDPPæ˜¯ä¸€ç§åˆ†åŒºå‰ªè£æœºåˆ¶ï¼Œå®ƒæ˜¯ä»¥åˆ†åŒºä¸ºå•ä½å¯¹äº‹å®è¡¨è¿›è¡Œè¿‡æ»¤ã€‚ç»“åˆåˆšæ‰çš„é€»è¾‘ï¼Œç»´åº¦è¡¨ä¸Šçš„è¿‡æ»¤æ¡ä»¶ä¼šè½¬åŒ–ä¸ºäº‹å®è¡¨ä¸ŠJoin Keyçš„è¿‡æ»¤æ¡ä»¶ã€‚å…·ä½“åˆ°æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå°±æ˜¯orders.userIdè¿™ä¸ªå­—æ®µã€‚æ˜¾ç„¶ï¼ŒDPPç”Ÿæ•ˆçš„å‰ææ˜¯äº‹å®è¡¨æŒ‰ç…§orders.userIdè¿™ä¸€åˆ—é¢„å…ˆåšå¥½äº†åˆ†åŒºã€‚å› æ­¤ï¼Œ<strong>äº‹å®è¡¨å¿…é¡»æ˜¯åˆ†åŒºè¡¨ï¼Œè€Œä¸”åˆ†åŒºå­—æ®µï¼ˆå¯ä»¥æ˜¯å¤šä¸ªï¼‰å¿…é¡»åŒ…å«Join Key</strong>ã€‚</p><p>å…¶æ¬¡ï¼Œè¿‡æ»¤æ•ˆæœçš„ä¼ å¯¼ï¼Œä¾èµ–çš„æ˜¯ç­‰å€¼çš„å…³è”å…³ç³»ï¼Œæ¯”å¦‚orders.userId = users.idã€‚å› æ­¤ï¼Œ<strong>DPPä»…æ”¯æŒç­‰å€¼Joinsï¼Œä¸æ”¯æŒå¤§äºã€å°äºè¿™ç§ä¸ç­‰å€¼å…³è”å…³ç³»</strong>ã€‚</p><p>æ­¤å¤–ï¼ŒDPPæœºåˆ¶å¾—ä»¥å®æ–½è¿˜æœ‰ä¸€ä¸ªéšå«çš„æ¡ä»¶ï¼š<strong>ç»´åº¦è¡¨è¿‡æ»¤ä¹‹åçš„æ•°æ®é›†è¦å°äºå¹¿æ’­é˜ˆå€¼ã€‚</strong></p><p>æ‹¿ç»´åº¦è¡¨usersæ¥è¯´ï¼Œæ»¡è¶³è¿‡æ»¤æ¡ä»¶users.type = â€˜Head Userâ€™çš„æ•°æ®é›†ï¼Œè¦èƒ½å¤Ÿæ”¾è¿›å¹¿æ’­å˜é‡ï¼ŒDPPä¼˜åŒ–æœºåˆ¶æ‰èƒ½ç”Ÿæ•ˆã€‚ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿè¿™å°±è¦æåˆ°DPPæœºåˆ¶çš„å®ç°åŸç†äº†ã€‚</p><p>ç»“åˆåˆšæ‰å¯¹äºDPPå®ç°é€»è¾‘çš„åˆ†æå’Œæ¨å¯¼ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œå®ç°DPPæœºåˆ¶çš„å…³é”®åœ¨äºï¼Œæˆ‘ä»¬è¦è®©å¤„ç†äº‹å®è¡¨çš„è®¡ç®—åˆ†æ”¯ï¼Œèƒ½å¤Ÿæ‹¿åˆ°æ»¡è¶³è¿‡æ»¤æ¡ä»¶çš„Join Keyåˆ—è¡¨ï¼Œç„¶åç”¨è¿™ä¸ªåˆ—è¡¨æ¥å¯¹äº‹å®è¡¨åšåˆ†åŒºå‰ªè£ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œç”¨ä»€ä¹ˆåŠæ³•æ‰èƒ½æ‹¿åˆ°è¿™ä¸ªåˆ—è¡¨å‘¢ï¼Ÿ</p><p>Spark SQLé€‰æ‹©äº†ä¸€ç§â€œä¸€ç®­åŒé›•â€çš„åšæ³•ï¼š<strong>ä½¿ç”¨å¹¿æ’­å˜é‡å°è£…è¿‡æ»¤ä¹‹åçš„ç»´åº¦è¡¨æ•°æ®</strong>ã€‚å…·ä½“æ¥è¯´ï¼Œåœ¨ç»´åº¦è¡¨åšå®Œè¿‡æ»¤ä¹‹åï¼ŒSpark SQLåœ¨å…¶ä¸Šæ„å»ºå“ˆå¸Œè¡¨ï¼ˆHash Tableï¼‰ï¼Œè¿™ä¸ªå“ˆå¸Œè¡¨çš„Keyå°±æ˜¯ç”¨äºå…³è”çš„Join Keyã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼ŒKeyå°±æ˜¯æ»¡è¶³è¿‡æ»¤users.type = â€˜Head Userâ€™æ¡ä»¶çš„users.idï¼›Valueæ˜¯æŠ•å½±ä¸­éœ€è¦å¼•ç”¨çš„æ•°æ®åˆ—ï¼Œåœ¨ä¹‹å‰è®¢å•è¡¨ä¸ç”¨æˆ·è¡¨çš„æŸ¥è¯¢ä¸­ï¼Œè¿™é‡Œçš„å¼•ç”¨åˆ—å°±æ˜¯users.nameã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/6f/fb/6f7803451b72e07c6cf2d3e1cae583fb.jpg?wh=2444*883\" alt=\"\" title=\"DPPçš„ç‰©ç†è®¡åˆ’\"></p><p>å“ˆå¸Œè¡¨æ„å»ºå®Œæ¯•ä¹‹åï¼ŒSpark SQLå°†å…¶å°è£…åˆ°å¹¿æ’­å˜é‡ä¸­ï¼Œè¿™ä¸ªå¹¿æ’­å˜é‡çš„ä½œç”¨æœ‰äºŒã€‚ç¬¬ä¸€ä¸ªä½œç”¨å°±æ˜¯ç»™äº‹å®è¡¨ç”¨æ¥åšåˆ†åŒºå‰ªè£ï¼Œå¦‚å›¾ä¸­çš„æ­¥éª¤1æ‰€ç¤ºï¼Œå“ˆå¸Œè¡¨ä¸­çš„Key Setåˆšå¥½å¯ä»¥ç”¨æ¥ç»™äº‹å®è¡¨è¿‡æ»¤ç¬¦åˆæ¡ä»¶çš„æ•°æ®åˆ†åŒºã€‚</p><p>ç¬¬äºŒä¸ªä½œç”¨å°±æ˜¯å‚ä¸åç»­çš„Broadcast Joinæ•°æ®å…³è”ï¼Œå¦‚å›¾ä¸­çš„æ­¥éª¤2æ‰€ç¤ºã€‚è¿™é‡Œçš„å“ˆå¸Œè¡¨ï¼Œæœ¬è´¨ä¸Šå°±æ˜¯Hash Joinä¸­çš„Build Tableï¼Œå…¶ä¸­çš„Keyã€Valueï¼Œè®°å½•ç€æ•°æ®å…³è”ä¸­æ‰€éœ€çš„æ‰€æœ‰å­—æ®µï¼Œå¦‚users.idã€users.nameï¼Œåˆšå¥½æ‹¿æ¥å’Œäº‹å®è¡¨åšBroadcast Hash Joinã€‚</p><p>å› æ­¤ä½ çœ‹ï¼Œé‰´äºSpark SQLé€‰æ‹©äº†å¹¿æ’­å˜é‡çš„å®ç°æ–¹å¼ï¼Œè¦æƒ³æœ‰æ•ˆåˆ©ç”¨DPPä¼˜åŒ–æœºåˆ¶ï¼Œæˆ‘ä»¬å°±å¿…é¡»è¦ç¡®ä¿ï¼Œè¿‡æ»¤åçš„ç»´åº¦è¡¨åˆšå¥½èƒ½æ”¾åˆ°å¹¿æ’­å˜é‡ä¸­å»ã€‚ä¹Ÿå› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»è¦è°¨æ…å¯¹å¾…é…ç½®é¡¹spark.sql.autoBroadcastJoinThresholdã€‚</p><h2>å°ç»“</h2><p>è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å›´ç»•åŠ¨æ€åˆ†åŒºå‰ªè£ï¼Œå­¦ä¹ äº†è°“è¯ä¸‹æ¨å’Œåˆ†åŒºå‰ªè£çš„è”ç³»å’ŒåŒºåˆ«ï¼Œä»¥åŠåŠ¨æ€åˆ†åŒºå‰ªè£çš„å®šä¹‰ã€ç‰¹ç‚¹å’Œä½¿ç”¨æ–¹æ³•ã€‚</p><p>ç›¸æ¯”äºè°“è¯ä¸‹æ¨ï¼Œåˆ†åŒºå‰ªè£å¾€å¾€èƒ½æ›´å¥½åœ°æå‡ç£ç›˜è®¿é—®çš„I/Oæ•ˆç‡ã€‚</p><p>è¿™æ˜¯å› ä¸ºï¼Œè°“è¯ä¸‹æ¨æ“ä½œå¾€å¾€æ˜¯æ ¹æ®æ–‡ä»¶æ³¨è„šä¸­çš„ç»Ÿè®¡ä¿¡æ¯å®Œæˆå¯¹æ–‡ä»¶çš„è¿‡æ»¤ï¼Œè¿‡æ»¤æ•ˆæœå–å†³äºæ–‡ä»¶ä¸­å†…å®¹çš„â€œçº¯åº¦â€ã€‚åˆ†åŒºå‰ªè£åˆ™ä¸åŒï¼Œå®ƒçš„åˆ†åŒºè¡¨å¯ä»¥æŠŠåŒ…å«ä¸åŒå†…å®¹çš„æ–‡ä»¶ï¼Œéš”ç¦»åˆ°ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿç›®å½•ä¸‹ã€‚è¿™æ ·ä¸€æ¥ï¼ŒåŒ…å«åˆ†åŒºé”®çš„è¿‡æ»¤æ¡ä»¶èƒ½å¤Ÿä»¥æ–‡ä»¶ç³»ç»Ÿç›®å½•ä¸ºç²’åº¦å¯¹ç£ç›˜æ–‡ä»¶è¿›è¡Œè¿‡æ»¤ï¼Œä»è€Œå¤§å¹…æå‡ç£ç›˜è®¿é—®çš„I/Oæ•ˆç‡ã€‚</p><p>è€ŒåŠ¨æ€åˆ†åŒºå‰ªè£è¿™ä¸ªåŠŸèƒ½ä¸»è¦ç”¨åœ¨æ˜Ÿå‹æ¨¡å‹æ•°ä»“çš„æ•°æ®å…³è”åœºæ™¯ä¸­ï¼Œå®ƒæŒ‡çš„æ˜¯åœ¨è¿è¡Œçš„æ—¶å€™ï¼ŒSpark SQLåˆ©ç”¨ç»´åº¦è¡¨æä¾›çš„è¿‡æ»¤ä¿¡æ¯ï¼Œæ¥å‡å°‘äº‹å®è¡¨ä¸­æ•°æ®çš„æ‰«æé‡ã€é™ä½I/Oå¼€é”€ï¼Œä»è€Œæå‡æ‰§è¡Œæ€§èƒ½ã€‚</p><p>åŠ¨æ€åˆ†åŒºå‰ªè£è¿ä½œçš„èƒŒåé€»è¾‘ï¼Œæ˜¯æŠŠç»´åº¦è¡¨ä¸­çš„è¿‡æ»¤æ¡ä»¶ï¼Œé€šè¿‡å…³è”å…³ç³»ä¼ å¯¼åˆ°äº‹å®è¡¨ï¼Œæ¥å®Œæˆäº‹å®è¡¨çš„ä¼˜åŒ–ã€‚åœ¨æ•°æ®å…³è”çš„åœºæ™¯ä¸­ï¼Œå¼€å‘è€…è¦æƒ³åˆ©ç”¨å¥½åŠ¨æ€åˆ†åŒºå‰ªè£ç‰¹æ€§ï¼Œéœ€è¦æ³¨æ„3ç‚¹ï¼š</p><ul>\n<li>äº‹å®è¡¨å¿…é¡»æ˜¯åˆ†åŒºè¡¨ï¼Œå¹¶ä¸”åˆ†åŒºå­—æ®µå¿…é¡»åŒ…å«Join Key</li>\n<li>åŠ¨æ€åˆ†åŒºå‰ªè£åªæ”¯æŒç­‰å€¼Joinsï¼Œä¸æ”¯æŒå¤§äºã€å°äºè¿™ç§ä¸ç­‰å€¼å…³è”å…³ç³»</li>\n<li>ç»´åº¦è¡¨è¿‡æ»¤ä¹‹åçš„æ•°æ®é›†ï¼Œå¿…é¡»è¦å°äºå¹¿æ’­é˜ˆå€¼ï¼Œå› æ­¤ï¼Œå¼€å‘è€…è¦æ³¨æ„è°ƒæ•´é…ç½®é¡¹spark.sql.autoBroadcastJoinThreshold</li>\n</ul><h2>æ¯æ—¥ä¸€ç»ƒ</h2><ol>\n<li>å¦‚æœè®©ä½ é‡å†™DPPå®ç°æœºåˆ¶ï¼Œä½ æœ‰å¯èƒ½æŠŠå¹¿æ’­é˜ˆå€¼çš„é™åˆ¶å»æ‰å—ï¼Ÿï¼ˆæç¤ºï¼šæ”¾å¼ƒä½¿ç”¨Broadcast Hash Joinçš„å…³è”æ–¹å¼ï¼Œä½†ä»ç„¶ç”¨å¹¿æ’­å˜é‡æ¥åšåˆ†åŒºå‰ªè£ã€‚ï¼‰</li>\n<li>è¦è®©äº‹å®è¡¨æ‹¿åˆ°æ»¡è¶³æ¡ä»¶çš„Join Keyåˆ—è¡¨ï¼Œé™¤äº†ä½¿ç”¨å¹¿æ’­å˜é‡ä¹‹å¤–ï¼Œä½ è§‰å¾—è¿˜æœ‰å…¶ä»–çš„æ–¹æ³•å’Œé€”å¾„å—ï¼Ÿ</li>\n</ol><p>æœŸå¾…åœ¨ç•™è¨€åŒºçœ‹åˆ°ä½ çš„æ€è€ƒå’Œç­”æ¡ˆï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²è§ï¼</p>","neighbors":{"left":{"article_title":"24 | Spark 3.0ï¼ˆä¸€ï¼‰ï¼šAQEçš„3ä¸ªç‰¹æ€§æ€ä¹ˆæ‰èƒ½ç”¨å¥½ï¼Ÿ","id":369687},"right":{"article_title":"26 | Join HintsæŒ‡å—ï¼šä¸åŒåœºæ™¯ä¸‹ï¼Œå¦‚ä½•é€‰æ‹©Joinç­–ç•¥ï¼Ÿ","id":373070}},"comments":[{"had_liked":false,"id":292925,"user_name":"little_fly","can_delete":false,"product_type":"c1","uid":1088288,"ip_address":"","ucode":"0C044A852D0C16","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqF7eNOuMdLqsAIkvfCicD4CqrjzRhiaDGyZKCqzduC3iaogPu5wOiaDnpeUwQXC1X4RTfe6ceKO8pKhg/132","comment_is_top":false,"comment_ctime":1621082912,"is_pvip":false,"replies":[{"id":"106272","content":"éå¸¸å¥½çš„å»ºè®®ï¼Œè¿™å—æˆ‘æ˜¯è¿™ä¹ˆæƒ³çš„ï¼Œåç»­æˆ‘ä¼šæ•´ç†ä¸€ä¸ªgithub repoï¼ŒæŠŠä¸“æ ä¸­æ¶‰åŠçš„ä»£ç ã€æ•°æ®ã€ç»“æœã€ä»¥åŠå¸¸è§é—®é¢˜ç­‰å†…å®¹æ±‡æ€»åˆ°è¿™ä¸ªé¡¹ç›®ä¸­å»ã€‚å½“ç„¶å†…å®¹ä¸æ­¢è¿™äº›ï¼Œç»“åˆå¤§å®¶çš„éœ€è¦ï¼Œæˆ‘ä»¬è¿˜ä¼šæŒç»­ä¸æ–­åœ°å‘å…¶ä¸­æ·»åŠ è¯¸å¦‚ç¬”è¯•é¢è¯•é¢˜ã€å·¥ä½œæœºä¼šã€èŒä¸šå‘å±•ç­‰å†…å®¹ï¼ŒæŠŠpotatoesé¡¹ç›®æ‰“é€ æˆæˆ‘ä»¬å…±æœ‰çš„Sparkç§å¡¾ã€‚çœ‹åˆ°ä½ çš„è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘è§‰å¾—å¯ä»¥å¤šåŠ ä¸€ç±»å†…å®¹ï¼Œå°±æ˜¯å¸¸è§æŠ¥é”™ï¼ŒæŠŠè¿™äº›æŠ¥é”™åˆ†é—¨åˆ«ç±»ï¼ŒæŠ¥é”™åŸå› ã€åº”å¯¹åŠæ³•ï¼Œç­‰ç­‰ã€‚<br><br>å¯¹äºè¿™ä¸ªgithub repoï¼Œæˆ‘æ˜¯æ‰“ç®—ç”¨å¼€æºçš„æ€è·¯æ¥åšï¼Œæ¯”å¦‚å°±è¿™ä¸ªå¸¸è§æŠ¥é”™ï¼Œæˆ‘æ˜¯æœŸæœ›å¤§å®¶ç¾¤ç­–ç¾¤åŠ›ï¼Œä¸€èµ·å…±äº«å·¥ä½œä¸­é‡åˆ°çš„å„ç§æŠ¥é”™ï¼Œç„¶åå¯ä»¥ä¸€èµ·æ¥åˆ†æèƒŒåçš„root causeå’Œè§£å†³åŠæ³•~ ç„¶åä¸æ–­åœ°æŠŠå®ƒä¸°å¯Œã€å®Œå–„~ <br><br>ç­‰ä¸“æ å†™å®Œï¼Œæˆ‘å°±ä¼šç€æ‰‹åšè¿™ä»¶äº‹ï¼Œåˆ°æ—¶å€™ä¸€èµ·å¼„å“ˆ~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1621410449,"ip_address":"","comment_id":292925,"utype":1}],"discussion_count":2,"race_medal":0,"score":"35980821280","product_id":100073401,"comment_content":"è€å¸ˆï¼Œèƒ½ä¸èƒ½å¯¹Sparkåº”ç”¨ç¨‹åºä¸­ç»å¸¸é‡åˆ°çš„ä¸€äº›æŠ¥é”™ï¼Œå†™ç¯‡åˆ†ææ–‡ç« ï¼Ÿæ¯”å¦‚ï¼Œç±»ä¼¼å¦‚ä¸‹çš„æŠ¥é”™ä¿¡æ¯ï¼š<br>1. org.apache.spark.memory.SparkOutOfMemoryError: Unable to acquire 172 bytes of memory, got 0<br>2. ERROR cluster.YarnScheduler: Lost executor 4 on node-3: Container killed by YARN for exceeding memory limits.  5.0 GB of 5 GB physical memory used.<br>3. java.lang.OutOfMemoryError: No enough memory for aggregation<br>4. org.apache.spark.shuffle.FetchFailedException: java.lang.RuntimeException: Executor is not registered<br>5. ERROR shuffle.RetryingBlockFetcher: Exception while beginning fetch of 1 outstanding blocks<br>java.io.IOException: Failed to connect to node-2&#47;192.168.10.1:41977<br><br>ç­‰ç­‰è¯¸å¦‚æ­¤ç±»çš„æŠ¥é”™ï¼Œå¾ˆå¤šä¹Ÿéƒ½ä¸æ˜¯è¯´å¢åŠ èµ„æºå°±èƒ½è§£å†³çš„ã€‚å¸Œæœ›è€å¸ˆèƒ½åˆ†äº«ä¸€ä¸‹æœ‰å“ªäº›æ¯”è¾ƒå¥½çš„åˆ†ææ’é”™æ€è·¯","like_count":9,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520013,"discussion_content":"éå¸¸å¥½çš„å»ºè®®ï¼Œè¿™å—æˆ‘æ˜¯è¿™ä¹ˆæƒ³çš„ï¼Œåç»­æˆ‘ä¼šæ•´ç†ä¸€ä¸ªgithub repoï¼ŒæŠŠä¸“æ ä¸­æ¶‰åŠçš„ä»£ç ã€æ•°æ®ã€ç»“æœã€ä»¥åŠå¸¸è§é—®é¢˜ç­‰å†…å®¹æ±‡æ€»åˆ°è¿™ä¸ªé¡¹ç›®ä¸­å»ã€‚å½“ç„¶å†…å®¹ä¸æ­¢è¿™äº›ï¼Œç»“åˆå¤§å®¶çš„éœ€è¦ï¼Œæˆ‘ä»¬è¿˜ä¼šæŒç»­ä¸æ–­åœ°å‘å…¶ä¸­æ·»åŠ è¯¸å¦‚ç¬”è¯•é¢è¯•é¢˜ã€å·¥ä½œæœºä¼šã€èŒä¸šå‘å±•ç­‰å†…å®¹ï¼ŒæŠŠpotatoesé¡¹ç›®æ‰“é€ æˆæˆ‘ä»¬å…±æœ‰çš„Sparkç§å¡¾ã€‚çœ‹åˆ°ä½ çš„è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘è§‰å¾—å¯ä»¥å¤šåŠ ä¸€ç±»å†…å®¹ï¼Œå°±æ˜¯å¸¸è§æŠ¥é”™ï¼ŒæŠŠè¿™äº›æŠ¥é”™åˆ†é—¨åˆ«ç±»ï¼ŒæŠ¥é”™åŸå› ã€åº”å¯¹åŠæ³•ï¼Œç­‰ç­‰ã€‚\n\nå¯¹äºè¿™ä¸ªgithub repoï¼Œæˆ‘æ˜¯æ‰“ç®—ç”¨å¼€æºçš„æ€è·¯æ¥åšï¼Œæ¯”å¦‚å°±è¿™ä¸ªå¸¸è§æŠ¥é”™ï¼Œæˆ‘æ˜¯æœŸæœ›å¤§å®¶ç¾¤ç­–ç¾¤åŠ›ï¼Œä¸€èµ·å…±äº«å·¥ä½œä¸­é‡åˆ°çš„å„ç§æŠ¥é”™ï¼Œç„¶åå¯ä»¥ä¸€èµ·æ¥åˆ†æèƒŒåçš„root causeå’Œè§£å†³åŠæ³•~ ç„¶åä¸æ–­åœ°æŠŠå®ƒä¸°å¯Œã€å®Œå–„~ \n\nç­‰ä¸“æ å†™å®Œï¼Œæˆ‘å°±ä¼šç€æ‰‹åšè¿™ä»¶äº‹ï¼Œåˆ°æ—¶å€™ä¸€èµ·å¼„å“ˆ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621410449,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1254277,"avatar":"https://static001.geekbang.org/account/avatar/00/13/23/85/e19f8833.jpg","nickname":"tony","note":"","ucode":"D5BBFBEB576BE5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392766,"discussion_content":"é¡¹ç›®ä»“åº“åœ°å€å¤šå°‘å‘€ï¼Œè€å¸ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631113048,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":292507,"user_name":"è¾°","can_delete":false,"product_type":"c1","uid":2172635,"ip_address":"","ucode":"2E898EAC5AA141","user_header":"https://static001.geekbang.org/account/avatar/00/21/26/db/27724a6f.jpg","comment_is_top":false,"comment_ctime":1620866416,"is_pvip":false,"replies":[{"id":"105922","content":"ç†è§£å¾—éå¸¸çš„å¯¹~<br><br>åˆ†åŒºé”®å’ŒJoin Keysçš„é€‰å–ï¼Œç¡®å®æ˜¯ä¸ªåšå¼ˆï¼Œå’±ä»¬è¯¾ä»¶ä¸­çš„ä¾‹å­ï¼Œä¸ºäº†æ–¹ä¾¿è¯´æ˜DPPçš„æœºåˆ¶å’ŒåŸç†ï¼Œæ‰€ä»¥æ²¡æœ‰æ·±ç©¶ã€‚ä½†æ˜¯ä½ è¯´çš„éå¸¸å¯¹ï¼Œå°±æ˜¯è¿™ä¸ªJoin Keysï¼Œç¡®å®æœ¬èº«å°±æ˜¯ä¸ªé™åˆ¶ã€‚å› ä¸ºå°±åƒä½ è¯´çš„ï¼Œå¹³æ—¶çš„æ•°æ®å…³è”ï¼Œéƒ½æ˜¯IDç±»çš„Join Keysæ¯”è¾ƒå¤šï¼Œè€Œè¿™æ ·çš„æ•°æ®åˆ—ï¼Œå¾€å¾€æ˜¯ä¸é€‚åˆåšåˆ†åŒºé”®çš„ã€‚<br><br>æ‰€ä»¥è¦æƒ³å……åˆ†åˆ©ç”¨DPPï¼Œç¡®å®æ˜¯å¾—åœ¨æ•°ä»“è§„åˆ’çš„æœ€å¼€å§‹ï¼Œå°±æŠŠä»¥åè¦ç”¨çš„å¸¸ç”¨æŸ¥è¯¢éƒ½è€ƒè™‘åˆ°ï¼Œåœ¨åšåˆ†åŒºè¡¨è®¾è®¡çš„æ—¶å€™ï¼Œå°½é‡åšåˆ°åˆ†åŒºå¤„ç†æœ¬èº«ä¸æŸ¥è¯¢æ‰§è¡Œæ€§èƒ½ä¹‹é—´çš„å¹³è¡¡ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620885506,"ip_address":"","comment_id":292507,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18800735600","product_id":100073401,"comment_content":"è¿™ä¸ªdppé™åˆ¶å…¶å®è›®å¤šçš„ï¼Œå°±æ¯”å¦‚æ‹¿è¯¾ä»¶ä¸­çš„ä¾‹å­ï¼Œé€šè¿‡user.idå…³è”ï¼Œè€Œä¸”è¿™ä¸ªå…³è”åº”è¯¥ä¹Ÿæ˜¯å¤§éƒ¨åˆ†åœºæ™¯éƒ½ç”¨åˆ°çš„ï¼Œä½†æ˜¯çš„äº‹å®è¡¨å±…ç„¶è¦æŒ‰useridè¿›è¡Œåˆ†åŒºï¼Œä¸ç®¡æ˜¯ç”µå•†é¡¹ç›®è¿˜æ˜¯å…¶ä»–é¡¹ç›®ï¼Œuseridè‚¯å®šæ˜¯æ¯”è¾ƒå¤šçš„ï¼Œæ¯”å¦‚10ä¸‡ä¸ªuserå°±å¯¹åº”10ä¸‡userid,ä¹Ÿå°±å¯¹åº”äº†10ä¸‡ä¸ªåˆ†åŒºï¼Œè¿™æ€•ä¸æ˜¯è¦ç©çˆ†ç³»ç»Ÿå“¦ï¼Œä¸çŸ¥é“ç†è§£çš„å¯¹ä¸å¯¹","like_count":5,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519859,"discussion_content":"ç†è§£å¾—éå¸¸çš„å¯¹~\n\nåˆ†åŒºé”®å’ŒJoin Keysçš„é€‰å–ï¼Œç¡®å®æ˜¯ä¸ªåšå¼ˆï¼Œå’±ä»¬è¯¾ä»¶ä¸­çš„ä¾‹å­ï¼Œä¸ºäº†æ–¹ä¾¿è¯´æ˜DPPçš„æœºåˆ¶å’ŒåŸç†ï¼Œæ‰€ä»¥æ²¡æœ‰æ·±ç©¶ã€‚ä½†æ˜¯ä½ è¯´çš„éå¸¸å¯¹ï¼Œå°±æ˜¯è¿™ä¸ªJoin Keysï¼Œç¡®å®æœ¬èº«å°±æ˜¯ä¸ªé™åˆ¶ã€‚å› ä¸ºå°±åƒä½ è¯´çš„ï¼Œå¹³æ—¶çš„æ•°æ®å…³è”ï¼Œéƒ½æ˜¯IDç±»çš„Join Keysæ¯”è¾ƒå¤šï¼Œè€Œè¿™æ ·çš„æ•°æ®åˆ—ï¼Œå¾€å¾€æ˜¯ä¸é€‚åˆåšåˆ†åŒºé”®çš„ã€‚\n\næ‰€ä»¥è¦æƒ³å……åˆ†åˆ©ç”¨DPPï¼Œç¡®å®æ˜¯å¾—åœ¨æ•°ä»“è§„åˆ’çš„æœ€å¼€å§‹ï¼Œå°±æŠŠä»¥åè¦ç”¨çš„å¸¸ç”¨æŸ¥è¯¢éƒ½è€ƒè™‘åˆ°ï¼Œåœ¨åšåˆ†åŒºè¡¨è®¾è®¡çš„æ—¶å€™ï¼Œå°½é‡åšåˆ°åˆ†åŒºå¤„ç†æœ¬èº«ä¸æŸ¥è¯¢æ‰§è¡Œæ€§èƒ½ä¹‹é—´çš„å¹³è¡¡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620885506,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":292145,"user_name":"kingcall","can_delete":false,"product_type":"c1","uid":1056982,"ip_address":"","ucode":"508884DC684B5B","user_header":"https://static001.geekbang.org/account/avatar/00/10/20/d6/b9513db0.jpg","comment_is_top":false,"comment_ctime":1620702632,"is_pvip":false,"replies":[{"id":"105950","content":"é—®é¢˜1å¯ä»¥å‚è€ƒä¸‹é¢å‡ ä¸ªåŒå­¦çš„æ€è·¯~ å¼ºåˆ¶å¹¿æ’­å’Œä¾é å¹¿æ’­é˜ˆå€¼ï¼ˆä¹Ÿå°±æ˜¯spark.sql.autoBroadcastJoinThreshold ï¼‰æ¥å¹¿æ’­ï¼Œå…¶å®æœ¬è´¨ä¸ŠåŒºåˆ«ä¸å¤§ã€‚<br><br>DPPçš„æ ¸å¿ƒæœºåˆ¶ï¼Œè¿˜æ˜¯ç”¨ç»´è¡¨çš„Key setæ¥è¿‡æ»¤äº‹å®è¡¨æ•°æ®ã€‚è¿™ä¸ªKey setå…¨é›†æ˜¯å¿…éœ€çš„ï¼ŒSparkçš„é»˜è®¤å®ç°ï¼Œæ˜¯é‡‡ç”¨äº†å¹¿æ’­å˜é‡ï¼Œè¿™ä¸ªå¹¿æ’­çš„å“ˆå¸Œè¡¨è¿˜èƒ½ç”¨äºåç»­çš„BHJï¼Œä¸€ç®­åŒé›•ï¼Œä½†æ˜¯ä¹Ÿå› æ­¤è€Œå—é™äºå¹¿æ’­é˜ˆå€¼å’Œ8Gçš„é™åˆ¶ã€‚<br><br>é—®é¢˜2ç­”å¾—ä¸é”™ï¼Œå°±æ˜¯ç”¨å…¶ä»–çš„æ–¹å¼è·å–Key setå…¨é›†ï¼Œåˆ†å¸ƒå¼ç¼“å­˜ã€å­˜å‚¨ï¼Œå…¶å®éƒ½è¡Œï¼Œè™½ç„¶éƒ½ä¼šå¼•å…¥æ•°æ®åˆ†å‘ï¼Œä½†å»æ‰äº†å¹¿æ’­çš„é™åˆ¶~ åœ¨DPPçš„ç¬¬äºŒä¸ªç¯èŠ‚ï¼Œä¹Ÿå°±æ˜¯ä¸¤è¡¨è¿‡æ»¤ä¹‹åçš„Joinï¼Œå…¶å®é‡‡ç”¨SMJæˆ–è€…æ˜¯Shuffle Hash Joinï¼Œå°±å¯ä»¥å†æ¬¡å»æ‰å¹¿æ’­é˜ˆå€¼çš„é™åˆ¶ã€‚<br><br>æ‰€ä»¥æ€»ç»“ä¸‹æ¥ï¼Œè¦æƒ³å»æ‰å¹¿æ’­çš„é™åˆ¶ï¼Œéœ€è¦å¯¹ä¸¤ä¸ªç¯èŠ‚è¿›è¡Œæ”¹è¿›ï¼Œä¸€ä¸ªæ˜¯Key setçš„å…¨é›†å­˜å‚¨ã€åˆ†å‘ï¼›ä¸€ä¸ªæ˜¯è¿‡æ»¤ä¹‹åä¸¤è¡¨çš„Joinã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620915899,"ip_address":"","comment_id":292145,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18800571816","product_id":100073401,"comment_content":"å›ç­”ï¼š<br>é—®é¢˜1 Broadcast Hash Join æœ¬èº«ä¹Ÿæ˜¯ä¾èµ–Broadcast æ¥å®Œæˆçš„ï¼Œæ‰€ä»¥Broadcast è‚¯å®šæ˜¯å¯ä»¥å®Œæˆè¿™ä¸ªéœ€æ±‚çš„ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜  Broadcast Hash Join æœ‰spark.sql.autoBroadcastJoinThreshold è¿™ä¸ªé™åˆ¶æ¡ä»¶ï¼Œä½†æ˜¯è¿™ä¸ªæ¡ä»¶ä¹Ÿä»…ä»…æ˜¯é™åˆ¶äº†æ˜¯å¦è‡ªåŠ¨å‘ç”ŸBroadcast Joinï¼Œæ‰€ä»¥æ‰‹åŠ¨Broadcastè¯å°±æ²¡è¿™ä¸ªé™åˆ¶äº†æˆ–è€…ä½¿ç”¨hintsï¼Œæ‰€ä»¥æƒ³æ€ä¹ˆç©å°±æ€ä¹ˆç©äº†ï¼Œä¸çŸ¥é“å¯¹ä¸å¯¹? ä½†æ˜¯è¿™é‡Œä¾ç„¶æœ‰ä¸€ä¸ªé—®é¢˜é‚£å°±æ˜¯Broadcastå‡ºå»çš„å˜é‡è¿‡å¤§ï¼Œè¿™ä¹Ÿå°±æ˜¯ Broadcast Join ä¸ºå•¥æœ‰ä¸€ä¸ªé˜ˆå€¼äº†ï¼Œè¦æ˜¯è¿™é‡Œèƒ½æœ‰ä¸€ä¸ªè¿™æ ·çš„æœºåˆ¶å°±å¥½äº†ï¼Œé¦–å…ˆåˆ¤æ–­èƒ½å¦å‘ç”ŸPDD ä¼˜åŒ–ï¼Œç„¶åè®©æ¯ä¸ªexecutor å»ä¸»åŠ¨æ‹‰å»è‡ªå·±æ‰€éœ€çš„æ•°æ®å°±å¥½äº†(æ»¡è¶³æ¡ä»¶çš„ Join Key çš„key å’Œ value)ï¼Œè€Œä¸æ˜¯æ•´ä¸ªBroadcast å˜é‡ã€‚<br>é—®é¢˜2 ç¼“å­˜ã€å¤–éƒ¨å­˜å‚¨ä¸»è¦æ˜¯saprk æ²¡æœ‰ç±»ä¼¼flink çš„ Async IO ï¼Œä½†æ˜¯ä¹Ÿå¯ä»¥è‡ªå·±åœ¨map å‡½æ•°ä¸­å®ç°<br>","like_count":4,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519699,"discussion_content":"é—®é¢˜1å¯ä»¥å‚è€ƒä¸‹é¢å‡ ä¸ªåŒå­¦çš„æ€è·¯~ å¼ºåˆ¶å¹¿æ’­å’Œä¾é å¹¿æ’­é˜ˆå€¼ï¼ˆä¹Ÿå°±æ˜¯spark.sql.autoBroadcastJoinThreshold ï¼‰æ¥å¹¿æ’­ï¼Œå…¶å®æœ¬è´¨ä¸ŠåŒºåˆ«ä¸å¤§ã€‚\n\nDPPçš„æ ¸å¿ƒæœºåˆ¶ï¼Œè¿˜æ˜¯ç”¨ç»´è¡¨çš„Key setæ¥è¿‡æ»¤äº‹å®è¡¨æ•°æ®ã€‚è¿™ä¸ªKey setå…¨é›†æ˜¯å¿…éœ€çš„ï¼ŒSparkçš„é»˜è®¤å®ç°ï¼Œæ˜¯é‡‡ç”¨äº†å¹¿æ’­å˜é‡ï¼Œè¿™ä¸ªå¹¿æ’­çš„å“ˆå¸Œè¡¨è¿˜èƒ½ç”¨äºåç»­çš„BHJï¼Œä¸€ç®­åŒé›•ï¼Œä½†æ˜¯ä¹Ÿå› æ­¤è€Œå—é™äºå¹¿æ’­é˜ˆå€¼å’Œ8Gçš„é™åˆ¶ã€‚\n\né—®é¢˜2ç­”å¾—ä¸é”™ï¼Œå°±æ˜¯ç”¨å…¶ä»–çš„æ–¹å¼è·å–Key setå…¨é›†ï¼Œåˆ†å¸ƒå¼ç¼“å­˜ã€å­˜å‚¨ï¼Œå…¶å®éƒ½è¡Œï¼Œè™½ç„¶éƒ½ä¼šå¼•å…¥æ•°æ®åˆ†å‘ï¼Œä½†å»æ‰äº†å¹¿æ’­çš„é™åˆ¶~ åœ¨DPPçš„ç¬¬äºŒä¸ªç¯èŠ‚ï¼Œä¹Ÿå°±æ˜¯ä¸¤è¡¨è¿‡æ»¤ä¹‹åçš„Joinï¼Œå…¶å®é‡‡ç”¨SMJæˆ–è€…æ˜¯Shuffle Hash Joinï¼Œå°±å¯ä»¥å†æ¬¡å»æ‰å¹¿æ’­é˜ˆå€¼çš„é™åˆ¶ã€‚\n\næ‰€ä»¥æ€»ç»“ä¸‹æ¥ï¼Œè¦æƒ³å»æ‰å¹¿æ’­çš„é™åˆ¶ï¼Œéœ€è¦å¯¹ä¸¤ä¸ªç¯èŠ‚è¿›è¡Œæ”¹è¿›ï¼Œä¸€ä¸ªæ˜¯Key setçš„å…¨é›†å­˜å‚¨ã€åˆ†å‘ï¼›ä¸€ä¸ªæ˜¯è¿‡æ»¤ä¹‹åä¸¤è¡¨çš„Joinã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620915899,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":292035,"user_name":"FendoraèŒƒä¸œ_","can_delete":false,"product_type":"c1","uid":1187106,"ip_address":"","ucode":"63EE9DBEE08D70","user_header":"https://static001.geekbang.org/account/avatar/00/12/1d/22/f04cea4c.jpg","comment_is_top":false,"comment_ctime":1620651265,"is_pvip":false,"replies":[{"id":"105903","content":"å¥½é—®é¢˜~<br><br>å…ˆè¯´å‰ä¸¤ä¸ªé—®é¢˜ï¼Œå…¶å®è¿™ä¸ªé—®é¢˜æ˜¯ï¼ŒSparkæ˜¯å…ˆæ‰«æäº‹å®è¡¨ï¼Œè¿˜æ˜¯å…ˆåšDPPï¼Œç­”æ¡ˆè‚¯å®šæ˜¯åè€…ã€‚<br><br>è¯´è¯´DPPçš„æ„ä¹‰ï¼Œè¿™é‡Œæœ‰ä¸ªå…³é”®ï¼Œå°±æ˜¯Sparkâ€œä¸€ä¸Šæ¥â€ã€åœ¨æœ€å¼€å§‹ï¼Œæ˜¯æ€ä¹ˆçŸ¥é“è°æ˜¯äº‹å®è¡¨ã€ç»´åº¦è¡¨çš„ï¼Ÿå…¶å®ï¼ŒSpark SQLçš„é™æ€ä¼˜åŒ–ï¼Œå…³äºæ•°æ®ç»Ÿè®¡ï¼Œæ¯”å¦‚é’ˆå¯¹Parquetã€CSVç­‰ç­‰ä¸åŒçš„æ•°æ®æºï¼Œå®ƒå…¶å®ä¸æ˜¯ä»€ä¹ˆéƒ½ä¸åšï¼Œå®ƒè‡³å°‘ä¼šç»Ÿè®¡â€œè¡¨å¤§å°â€è¿™äº›æœ€åŸºæœ¬çš„ä¿¡æ¯ï¼Œæ ¹æ®è¿™äº›sizeç±»å‹çš„ä¿¡æ¯ï¼Œå®ƒå…¶å®å¯ä»¥åˆ¤æ–­å“ªä¸ªæ˜¯äº‹å®è¡¨ï¼Œå“ªä¸ªæ˜¯ç»´åº¦è¡¨ã€‚<br><br>å¦‚æ­¤ä¸€æ¥ï¼Œå®ƒå…ˆå»åˆ¤æ–­DPPçš„å‰ææ¡ä»¶æ˜¯å¦æˆç«‹ï¼Œæˆç«‹çš„è¯ï¼Œå°±èµ°ä¸€æ³¢DPPã€‚<br><br>å†æ¥è¯´ç¬¬3é¢˜ï¼Œç¡®å®æ˜¯å¥½é—®é¢˜ï¼Œä¸è¿‡è¿™é‡Œå…¶å®æœ¬è´¨ä¸Šæ˜¯å’ŒDPPçš„å®ç°æœºåˆ¶æœ‰å…³ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒç”¨â€œä¸€ç®­åŒé›•â€çš„æ–¹å¼ï¼Œä¸€æ–¹é¢åˆ©ç”¨å¹¿æ’­æ¥è¿‡æ»¤ï¼Œä¸€æ–¹é¢é¡ºæ°´æ¨èˆŸï¼Œç”¨ReuseExchangeï¼ˆå†…å­˜ä¸­çš„reuseï¼Œè·Ÿä¹‹å‰çš„ç£ç›˜reuseä¸åŒï¼‰å†æ¬¡åˆ©ç”¨å¹¿æ’­æ¥å®ŒæˆBroadcast Hash Joinï¼Œä¸€çŸ³äºŒé¸Ÿã€‚<br><br>å†è€…ï¼ŒDPPå®é™…ä¸Šæ˜¯å…ˆäºAQE Joinç­–ç•¥è°ƒæ•´çš„ï¼Œå› ä¸ºè¿™é‡Œè¿˜æ²¡æœ‰Shuffleå‘¢ï¼Œè¿˜è®°å¾—AQEçš„è§¦å‘æœºåˆ¶æ˜¯Shuffleå—ï¼Ÿå› æ­¤DPPç›¸å½“äºæˆªäº†AQEçš„â€œèƒ¡å„¿â€ï¼ˆæ‰“éº»å°†çš„æˆªèƒ¡å„¿ï¼‰ï¼Œä¸è¿‡å…¶å®è°å…ˆè°åçš„ï¼Œæ²¡é‚£ä¹ˆé‡è¦ï¼Œåæ­£æˆ‘ä»¬äº«å—åˆ°äº†Broadcast Hash Joinçš„æ€§èƒ½æå‡ã€‚<br><br>å†è€…ï¼ŒDPPâ€œæ°´åˆ°æ¸ æˆâ€çš„BHJï¼Œå…¶å®è¿˜æœ‰ä¸€ä¸ªä¼˜åŠ¿ï¼Œå°±æ˜¯ç›¸æ¯”AQEï¼Œå®ƒä¸éœ€è¦Shuffleå°±èƒ½è§¦å‘ï¼Œå› æ­¤ä¸éœ€è¦Shuffle Writeé˜¶æ®µçš„è®¡ç®—ï¼Œæ‰èƒ½åšä¼˜åŒ–ï¼Œæ‰€ä»¥è¯´DPPå¸¦æ¥çš„BHJï¼Œç›¸æ¯”AQEçš„Joinç­–ç•¥è°ƒæ•´ï¼Œå…¶å®æ˜¯æ›´ä¼˜çš„ä¼˜åŒ–~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620863945,"ip_address":"","comment_id":292035,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18800520449","product_id":100073401,"comment_content":"æœ‰å‡ ä¸ªç–‘é—®ï¼Œéº»çƒ¦ç£Šå“¥æŒ‡ç‚¹ä¸‹<br>1.æ–‡ä¸­æ‰€å†™SQLï¼Œæœ€ç»ˆæœ‰3ä¸ªstage,è¯»æ•°æ®çš„ä¸¤ä¸ªstageæŒ‰ç†è¯´æ˜¯æ²¡æœ‰ä¾èµ–å…³ç³»çš„ï¼Œèµ„æºè¶³å¤Ÿæƒ…å†µä¸‹æ˜¯å¯ä»¥å¹¶å‘è¿è¡Œçš„ï¼Œè¿™å°±å’ŒDPPè¿è¡Œé€»è¾‘ç›¸è¿èƒŒäº†ï¼Œè¿™å—sparkæ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ<br>2.æœ‰æ²¡æœ‰è¿™æ ·ä¸€ç§å¯èƒ½:DPPç”Ÿæ•ˆï¼Œå³ç»´åº¦è¡¨åšäº†è¿‡æ»¤æŸ¥è¯¢ï¼Œäº‹å®è¡¨åŸºäºç»´åº¦è¡¨å¹¿æ’­è¿‡æ¥çš„hashtableå†åšè¿‡æ»¤æŸ¥è¯¢ï¼Œè¿™ä¸ªè¿‡ç¨‹æ¯”DPPä¸ç”Ÿæ•ˆï¼Œå³ä¸¤å¼ è¡¨å¹¶å‘è¿›è¡Œè¿‡æ»¤æŸ¥è¯¢ï¼Œè¿‡ç¨‹è¿˜æ…¢ï¼Ÿ<br>3.DPPæ„Ÿè§‰åŒ…å«äº†AQE joinç­–ç•¥è°ƒæ•´ã€‚å‡å¦‚æœ¬æ¥æ˜¯SMJï¼Œè¿è¡Œè¿‡ç¨‹ä¸­ç»´åº¦è¡¨ç»è¿‡è¿‡æ»¤å°äºå¹¿æ’­é˜ˆå€¼ï¼Œå˜æˆäº†BHJã€‚","like_count":5,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519644,"discussion_content":"å¥½é—®é¢˜~\n\nå…ˆè¯´å‰ä¸¤ä¸ªé—®é¢˜ï¼Œå…¶å®è¿™ä¸ªé—®é¢˜æ˜¯ï¼ŒSparkæ˜¯å…ˆæ‰«æäº‹å®è¡¨ï¼Œè¿˜æ˜¯å…ˆåšDPPï¼Œç­”æ¡ˆè‚¯å®šæ˜¯åè€…ã€‚\n\nè¯´è¯´DPPçš„æ„ä¹‰ï¼Œè¿™é‡Œæœ‰ä¸ªå…³é”®ï¼Œå°±æ˜¯Sparkâ€œä¸€ä¸Šæ¥â€ã€åœ¨æœ€å¼€å§‹ï¼Œæ˜¯æ€ä¹ˆçŸ¥é“è°æ˜¯äº‹å®è¡¨ã€ç»´åº¦è¡¨çš„ï¼Ÿå…¶å®ï¼ŒSpark SQLçš„é™æ€ä¼˜åŒ–ï¼Œå…³äºæ•°æ®ç»Ÿè®¡ï¼Œæ¯”å¦‚é’ˆå¯¹Parquetã€CSVç­‰ç­‰ä¸åŒçš„æ•°æ®æºï¼Œå®ƒå…¶å®ä¸æ˜¯ä»€ä¹ˆéƒ½ä¸åšï¼Œå®ƒè‡³å°‘ä¼šç»Ÿè®¡â€œè¡¨å¤§å°â€è¿™äº›æœ€åŸºæœ¬çš„ä¿¡æ¯ï¼Œæ ¹æ®è¿™äº›sizeç±»å‹çš„ä¿¡æ¯ï¼Œå®ƒå…¶å®å¯ä»¥åˆ¤æ–­å“ªä¸ªæ˜¯äº‹å®è¡¨ï¼Œå“ªä¸ªæ˜¯ç»´åº¦è¡¨ã€‚\n\nå¦‚æ­¤ä¸€æ¥ï¼Œå®ƒå…ˆå»åˆ¤æ–­DPPçš„å‰ææ¡ä»¶æ˜¯å¦æˆç«‹ï¼Œæˆç«‹çš„è¯ï¼Œå°±èµ°ä¸€æ³¢DPPã€‚\n\nå†æ¥è¯´ç¬¬3é¢˜ï¼Œç¡®å®æ˜¯å¥½é—®é¢˜ï¼Œä¸è¿‡è¿™é‡Œå…¶å®æœ¬è´¨ä¸Šæ˜¯å’ŒDPPçš„å®ç°æœºåˆ¶æœ‰å…³ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒç”¨â€œä¸€ç®­åŒé›•â€çš„æ–¹å¼ï¼Œä¸€æ–¹é¢åˆ©ç”¨å¹¿æ’­æ¥è¿‡æ»¤ï¼Œä¸€æ–¹é¢é¡ºæ°´æ¨èˆŸï¼Œç”¨ReuseExchangeï¼ˆå†…å­˜ä¸­çš„reuseï¼Œè·Ÿä¹‹å‰çš„ç£ç›˜reuseä¸åŒï¼‰å†æ¬¡åˆ©ç”¨å¹¿æ’­æ¥å®ŒæˆBroadcast Hash Joinï¼Œä¸€çŸ³äºŒé¸Ÿã€‚\n\nå†è€…ï¼ŒDPPå®é™…ä¸Šæ˜¯å…ˆäºAQE Joinç­–ç•¥è°ƒæ•´çš„ï¼Œå› ä¸ºè¿™é‡Œè¿˜æ²¡æœ‰Shuffleå‘¢ï¼Œè¿˜è®°å¾—AQEçš„è§¦å‘æœºåˆ¶æ˜¯Shuffleå—ï¼Ÿå› æ­¤DPPç›¸å½“äºæˆªäº†AQEçš„â€œèƒ¡å„¿â€ï¼ˆæ‰“éº»å°†çš„æˆªèƒ¡å„¿ï¼‰ï¼Œä¸è¿‡å…¶å®è°å…ˆè°åçš„ï¼Œæ²¡é‚£ä¹ˆé‡è¦ï¼Œåæ­£æˆ‘ä»¬äº«å—åˆ°äº†Broadcast Hash Joinçš„æ€§èƒ½æå‡ã€‚\n\nå†è€…ï¼ŒDPPâ€œæ°´åˆ°æ¸ æˆâ€çš„BHJï¼Œå…¶å®è¿˜æœ‰ä¸€ä¸ªä¼˜åŠ¿ï¼Œå°±æ˜¯ç›¸æ¯”AQEï¼Œå®ƒä¸éœ€è¦Shuffleå°±èƒ½è§¦å‘ï¼Œå› æ­¤ä¸éœ€è¦Shuffle Writeé˜¶æ®µçš„è®¡ç®—ï¼Œæ‰èƒ½åšä¼˜åŒ–ï¼Œæ‰€ä»¥è¯´DPPå¸¦æ¥çš„BHJï¼Œç›¸æ¯”AQEçš„Joinç­–ç•¥è°ƒæ•´ï¼Œå…¶å®æ˜¯æ›´ä¼˜çš„ä¼˜åŒ–~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620863945,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":292222,"user_name":"zxk","can_delete":false,"product_type":"c1","uid":1221195,"ip_address":"","ucode":"4BB2BD9D2BCD04","user_header":"https://static001.geekbang.org/account/avatar/00/12/a2/4b/b72f724f.jpg","comment_is_top":false,"comment_ctime":1620725611,"is_pvip":false,"replies":[{"id":"105902","content":"æ»¡åˆ†ğŸ’¯ï¼Œç­”å¾—å¥½ï¼Œé—®å¾—ä¹Ÿå¥½~ æ€è€ƒçš„å¾ˆæ·±å…¥<br><br>å…ˆè¯´ç¬¬ä¸€é¢˜ï¼Œæ²¡é”™ï¼Œåªå¹¿æ’­Join Keysï¼Œå¹¿æ’­é˜ˆå€¼çš„é™åˆ¶ä¼šä½å¾ˆå¤šï¼Œä¸è¿‡è¿˜æ˜¯éœ€è¦åˆ©ç”¨å¹¿æ’­æœºåˆ¶ï¼Œæ¥ä¼ é€’â€œè¿‡æ»¤æ¡ä»¶â€ï¼Œäº‹å®è¡¨æ‹¿åˆ°â€œè¿‡æ»¤æ¡ä»¶â€æ¥é™ä½æ‰«æé‡ã€‚å› æ­¤å°±åƒä½ è¯´çš„ï¼Œè™½ç„¶é™åˆ¶é™ä½ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰Join Keysè¶…å¤§æ’‘çˆ†å¹¿æ’­é˜ˆå€¼ã€ç”šè‡³æ˜¯Driverçš„é£é™©ã€‚æ‰€ä»¥è¦æƒ³å®Œå…¨å»æ‰å¹¿æ’­ï¼Œé‚£å°±å¿…é¡»è¦æ¢ä¸€ç§ç½‘ç»œåˆ†å‘æ–¹å¼ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€åˆ†å¸ƒå¼ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰Executorséƒ½å¯ä»¥é€šè¿‡ä»–ä»¬æ‹¿åˆ°â€œè¿‡æ»¤æ¡ä»¶â€ã€‚å½“ç„¶ï¼Œä½ å¯èƒ½ä¼šè¯´ï¼Œè¿™æ ·æ•ˆç‡å°±ä½å¾ˆå¤šäº†ï¼Œç¡®å®ï¼Œä¸è¿‡å…¶å®è¿™é“é¢˜çš„ç›®çš„ï¼Œå°±æ˜¯é¼“åŠ±å¤§å®¶è„‘æ´ã€å¤šæ€è€ƒã€å‘æ•£æ€ç»´ï¼Œæ€ç»´è¶Šå‘æ•£ï¼Œå…¶å®å¯¹äºSparkä¸ºä»€ä¹ˆé‡‡ç”¨å¹¿æ’­æœºåˆ¶çš„ç†è§£å°±è¶Šæ·±åˆ»ã€‚<br><br>å†è¯´ç¬¬äºŒé¢˜ï¼Œå¾ˆä¸é”™çš„æ€è·¯~ ç›¸å½“äºæ˜¯Query rewriteï¼Œå°±æ˜¯ç›´æ¥æŠŠç»´è¡¨Join Keyä¸Šçš„è¿‡æ»¤æ¡ä»¶ï¼Œåœ¨SQLæŸ¥è¯¢ä¼˜åŒ–é˜¶æ®µå°±ä¼ é€’ç»™äº‹å®è¡¨ï¼Œä¸é”™ä¸é”™~ ä¸è¿‡ï¼ŒSparkå¹¶æ²¡æœ‰Query rewriteè¿™ä¸ªé˜¶æ®µï¼Œä½†æ˜¯æ€è·¯æˆ‘å¾ˆå–œæ¬¢~ å…¶å®ä¼ ç»Ÿçš„DBMSéƒ½æ˜¯æœ‰Query rewriteè¿™ä¸ªç¯èŠ‚çš„ï¼ŒSparkå·æ‡’ï¼Œè¿™éƒ¨åˆ†æ²¡åšã€‚<br><br>æœ€åå†è¯´DPPçš„æ„ä¹‰ï¼Œå°±æ˜¯ä½ è¯´çš„ï¼ŒSparkâ€œä¸€ä¸Šæ¥â€ã€æœ€å¼€å§‹æ€ä¹ˆçŸ¥é“è°æ˜¯äº‹å®è¡¨ã€ç»´åº¦è¡¨ã€‚å…¶å®å®ƒè¿˜çœŸæ˜¯çŸ¥é“çš„ï¼ŒSpark SQLçš„é™æ€ä¼˜åŒ–ï¼Œå…³äºæ•°æ®ç»Ÿè®¡ï¼Œæ¯”å¦‚é’ˆå¯¹Parquetã€CSVç­‰ç­‰ä¸åŒçš„æ•°æ®æºï¼Œå®ƒå…¶å®ä¸æ˜¯ä»€ä¹ˆéƒ½ä¸åšï¼Œå®ƒè‡³å°‘ä¼šç»Ÿè®¡â€œè¡¨å¤§å°â€è¿™äº›æœ€åŸºæœ¬çš„ä¿¡æ¯ï¼Œæ ¹æ®è¿™äº›sizeç±»å‹çš„ä¿¡æ¯ï¼Œå®ƒå…¶å®å¯ä»¥åˆ¤æ–­å“ªä¸ªæ˜¯äº‹å®è¡¨ï¼Œå“ªä¸ªæ˜¯ç»´åº¦è¡¨ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620861775,"ip_address":"","comment_id":292222,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10210660203","product_id":100073401,"comment_content":"é—®é¢˜ä¸€ï¼šæ”¾å¼ƒä½¿ç”¨ BHJ çš„è¯ï¼Œå…¶ä¸­ä¸€ä¸ªè¡¨ç»è¿‡è£å‰ªè¿‡æ»¤åï¼Œä½¿ç”¨å¹¿æ’­å˜é‡åªå¹¿æ’­ Join Key è€Œéæ•´ä¸ªè¡¨çš„æ•°æ®ï¼Œä»å¯ä»¥å®ç° DPPï¼Œä½†ä¸ªäººä»ä¸ºä»éœ€è¦é’ˆå¯¹å¹¿æ’­çš„ Join Key åŠ ä¸Šä¸€ä¸ª Thresholdï¼Œå¦åˆ™å¯èƒ½å°† Driver æ’‘çˆ†ã€‚<br>é—®é¢˜äºŒï¼šå¦‚æœç»´åº¦è¡¨çš„è¿‡æ»¤æ¡ä»¶æ­£å¥½æ˜¯ Join keyï¼ŒåŒæ—¶ä¹Ÿæ˜¯äº‹å®è¡¨çš„åˆ†åŒºç›®å½•ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘å…ˆå°†è¿™ä¸ªè¿‡æ»¤æ¡ä»¶ç›´æ¥æ¨åˆ°äº‹å®è¡¨ä½œä¸ºä¸€ä¸ªé è¿‘æ•°æ®æºçš„ filter æ¡ä»¶ã€‚<br><br>æœ‰ä¸ªç–‘é—®è¯·æ•™ä¸‹è€å¸ˆï¼š<br>1DPP çš„æœºåˆ¶å°±æ˜¯å°†ç»è¿‡è¿‡æ»¤åçš„ç»´åº¦è¡¨å¹¿æ’­åˆ°äº‹å®è¡¨è¿›è¡Œè£å‰ªï¼Œå‡å°‘æ‰«ææ•°æ®ï¼Œä½† Spark æ€ä¹ˆæ‰çŸ¥é“å“ªä¸ªæ˜¯ç»´åº¦è¡¨å“ªä¸ªæ˜¯äº‹å®è¡¨ï¼Ÿå› ä¸º Spark ä¸€ä¸Šæ¥æ˜¯ä¸æ¸…æ¥šè¡¨ä¿¡æ¯çš„ï¼Œå¦‚æœä¸€å¼€å§‹å°±æŠŠäº‹å®è¡¨å…ˆæ‰«æäº†ï¼Œé‚£æ„Ÿè§‰ DPP å°±å¤±å»æ„ä¹‰äº†ï¼Œæ˜¯å¦éœ€è¦å¼€å‘è€…å…±ä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519733,"discussion_content":"æ»¡åˆ†ğŸ’¯ï¼Œç­”å¾—å¥½ï¼Œé—®å¾—ä¹Ÿå¥½~ æ€è€ƒçš„å¾ˆæ·±å…¥\n\nå…ˆè¯´ç¬¬ä¸€é¢˜ï¼Œæ²¡é”™ï¼Œåªå¹¿æ’­Join Keysï¼Œå¹¿æ’­é˜ˆå€¼çš„é™åˆ¶ä¼šä½å¾ˆå¤šï¼Œä¸è¿‡è¿˜æ˜¯éœ€è¦åˆ©ç”¨å¹¿æ’­æœºåˆ¶ï¼Œæ¥ä¼ é€’â€œè¿‡æ»¤æ¡ä»¶â€ï¼Œäº‹å®è¡¨æ‹¿åˆ°â€œè¿‡æ»¤æ¡ä»¶â€æ¥é™ä½æ‰«æé‡ã€‚å› æ­¤å°±åƒä½ è¯´çš„ï¼Œè™½ç„¶é™åˆ¶é™ä½ï¼Œä½†æ˜¯è¿˜æ˜¯æœ‰Join Keysè¶…å¤§æ’‘çˆ†å¹¿æ’­é˜ˆå€¼ã€ç”šè‡³æ˜¯Driverçš„é£é™©ã€‚æ‰€ä»¥è¦æƒ³å®Œå…¨å»æ‰å¹¿æ’­ï¼Œé‚£å°±å¿…é¡»è¦æ¢ä¸€ç§ç½‘ç»œåˆ†å‘æ–¹å¼ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿã€åˆ†å¸ƒå¼ç¼“å­˜ï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰Executorséƒ½å¯ä»¥é€šè¿‡ä»–ä»¬æ‹¿åˆ°â€œè¿‡æ»¤æ¡ä»¶â€ã€‚å½“ç„¶ï¼Œä½ å¯èƒ½ä¼šè¯´ï¼Œè¿™æ ·æ•ˆç‡å°±ä½å¾ˆå¤šäº†ï¼Œç¡®å®ï¼Œä¸è¿‡å…¶å®è¿™é“é¢˜çš„ç›®çš„ï¼Œå°±æ˜¯é¼“åŠ±å¤§å®¶è„‘æ´ã€å¤šæ€è€ƒã€å‘æ•£æ€ç»´ï¼Œæ€ç»´è¶Šå‘æ•£ï¼Œå…¶å®å¯¹äºSparkä¸ºä»€ä¹ˆé‡‡ç”¨å¹¿æ’­æœºåˆ¶çš„ç†è§£å°±è¶Šæ·±åˆ»ã€‚\n\nå†è¯´ç¬¬äºŒé¢˜ï¼Œå¾ˆä¸é”™çš„æ€è·¯~ ç›¸å½“äºæ˜¯Query rewriteï¼Œå°±æ˜¯ç›´æ¥æŠŠç»´è¡¨Join Keyä¸Šçš„è¿‡æ»¤æ¡ä»¶ï¼Œåœ¨SQLæŸ¥è¯¢ä¼˜åŒ–é˜¶æ®µå°±ä¼ é€’ç»™äº‹å®è¡¨ï¼Œä¸é”™ä¸é”™~ ä¸è¿‡ï¼ŒSparkå¹¶æ²¡æœ‰Query rewriteè¿™ä¸ªé˜¶æ®µï¼Œä½†æ˜¯æ€è·¯æˆ‘å¾ˆå–œæ¬¢~ å…¶å®ä¼ ç»Ÿçš„DBMSéƒ½æ˜¯æœ‰Query rewriteè¿™ä¸ªç¯èŠ‚çš„ï¼ŒSparkå·æ‡’ï¼Œè¿™éƒ¨åˆ†æ²¡åšã€‚\n\næœ€åå†è¯´DPPçš„æ„ä¹‰ï¼Œå°±æ˜¯ä½ è¯´çš„ï¼ŒSparkâ€œä¸€ä¸Šæ¥â€ã€æœ€å¼€å§‹æ€ä¹ˆçŸ¥é“è°æ˜¯äº‹å®è¡¨ã€ç»´åº¦è¡¨ã€‚å…¶å®å®ƒè¿˜çœŸæ˜¯çŸ¥é“çš„ï¼ŒSpark SQLçš„é™æ€ä¼˜åŒ–ï¼Œå…³äºæ•°æ®ç»Ÿè®¡ï¼Œæ¯”å¦‚é’ˆå¯¹Parquetã€CSVç­‰ç­‰ä¸åŒçš„æ•°æ®æºï¼Œå®ƒå…¶å®ä¸æ˜¯ä»€ä¹ˆéƒ½ä¸åšï¼Œå®ƒè‡³å°‘ä¼šç»Ÿè®¡â€œè¡¨å¤§å°â€è¿™äº›æœ€åŸºæœ¬çš„ä¿¡æ¯ï¼Œæ ¹æ®è¿™äº›sizeç±»å‹çš„ä¿¡æ¯ï¼Œå®ƒå…¶å®å¯ä»¥åˆ¤æ–­å“ªä¸ªæ˜¯äº‹å®è¡¨ï¼Œå“ªä¸ªæ˜¯ç»´åº¦è¡¨ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620861775,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324369,"user_name":"To_Drill","can_delete":false,"product_type":"c1","uid":1415245,"ip_address":"","ucode":"7E6FFAF1986EC8","user_header":"https://static001.geekbang.org/account/avatar/00/15/98/4d/582d24f4.jpg","comment_is_top":false,"comment_ctime":1638407297,"is_pvip":false,"replies":[{"id":"117760","content":"é‚£å€’æ²¡æœ‰å“ˆ~ DPPå¹¶æ²¡æœ‰å…³è”å½¢å¼ï¼ˆinnerã€leftã€rightï¼‰ä¸Šçš„é™åˆ¶","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1043100","ctime":1638458625,"ip_address":"","comment_id":324369,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5933374593","product_id":100073401,"comment_content":"è€å¸ˆï¼ŒæŒ‰ç…§DPPçš„æœºåˆ¶æ¥çœ‹ï¼ŒDPPåªæ”¯æŒå†…è¿æ¥(inner join)ä¸æ”¯æŒå¤–è¿æ¥(left&#47;right join)å§ï¼Ÿå¦‚æœæ˜¯çš„ï¼Œé‚£å°±æœ‰å¤šäº†ä¸ªé™åˆ¶æ¡ä»¶ï¼Œé€‚ç”¨åœºæ™¯æ›´å°‘äº†ã€‚","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535540,"discussion_content":"é‚£å€’æ²¡æœ‰å“ˆ~ DPPå¹¶æ²¡æœ‰å…³è”å½¢å¼ï¼ˆinnerã€leftã€rightï¼‰ä¸Šçš„é™åˆ¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638458625,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1415245,"avatar":"https://static001.geekbang.org/account/avatar/00/15/98/4d/582d24f4.jpg","nickname":"To_Drill","note":"","ucode":"7E6FFAF1986EC8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":535981,"discussion_content":"æˆ‘çš„ç†è§£æ˜¯å¦‚æœæ˜¯å¤–è¿æ¥çš„è¯ï¼Œé‚£ä¹ˆæœ€åçš„ç»“æœä¸­å°±ä¼šä¿ç•™å¤–è¡¨æ‰€æœ‰åˆ†åŒºçš„æ‰€æœ‰éœ€è¦æŠ•å½±çš„æ•°æ®\nï¼ˆå¦‚æœå¤–è¡¨æœ‰è¿‡æ»¤æ¡ä»¶é‚£ä¹ˆå°±ä¿ç•™è¿‡æ»¤åçš„æ‰€æœ‰éœ€è¦æŠ•å½±çš„æ•°æ®ï¼‰\nè¿™æ ·çš„è¯ï¼ŒDPPæ ¹æ®å…³è”æ¡ä»¶ä¼ é€’åˆ°å¤–è¡¨ä¸Šçš„åˆ†åŒºè¿‡æ»¤å°±æ¯«æ— æ–½å±•ç©ºé—´å‘ï¼Ÿå› ä¸ºå¤–è¡¨çš„æ•°æ®æœ¬æ¥å°±è¯¥ä¿ç•™æ ¹æœ¬ä¸éœ€è¦è¿‡æ»¤\næ‹¿æ–‡ç« ä¸­çš„ä¾‹å­æ¥çœ‹\nfrom orders inner join users on orders.userId = users.idwhere users.type = â€˜Head Userâ€™\nå¦‚æœæ”¹æˆleft join\nfrom orders left join users on orders.userId = users.idwhere users.type = â€˜Head Userâ€™\né‚£ä¹ˆæœ€åç»“æœä¸­ï¼ˆå‡è®¾æ²¡æœ‰é‡å¤å…³è”ï¼‰ï¼Œæ•°æ®æ¡æ•°ä¸åº”è¯¥å’Œordersçš„æ•°æ®æ¡æ•°ä¸€è‡´å˜›ï¼Ÿä¸éœ€è¦DPPçš„è¿‡æ»¤\næ˜¯æˆ‘ç†è§£çš„æœ‰é—®é¢˜å˜›ï¼Ÿéº»çƒ¦ç£Šå“¥è§£ä¸‹æƒ‘ï¼Œè°¢è°¢ï¼","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1638625458,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":535540,"ip_address":""},"score":535981,"extra":""}]},{"author":{"id":1591216,"avatar":"https://static001.geekbang.org/account/avatar/00/18/47/b0/cf5529a0.jpg","nickname":"ThomasG","note":"","ucode":"C05D94E0A10662","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587562,"discussion_content":"INNER, LEFT SEMI,  LEFT OUTER (partitioned on right), or RIGHT OUTER (partitioned on left) è¿™é‡Œè¿˜æ˜¯æœ‰ä½¿ç”¨ä¸Šçš„é™åˆ¶çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663145627,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":293237,"user_name":"å¼ å®ˆä¸€","can_delete":false,"product_type":"c1","uid":2037773,"ip_address":"","ucode":"C501842CCA350D","user_header":"","comment_is_top":false,"comment_ctime":1621300191,"is_pvip":false,"replies":[{"id":"106326","content":"å¥½é—®é¢˜ï¼Œè¿™å—ç¡®å®æ˜¯DPPçš„â€œç¡¬ä¼¤â€ã€‚<br><br>å°±åƒä½ è¯´çš„ï¼ŒJoin Keyså¾€å¾€æ˜¯cardinalityæ¯”è¾ƒé«˜çš„å­—æ®µï¼Œæ¯”å¦‚userIdï¼›è€Œåˆ†åŒºé”®å¾€å¾€æ˜¯è¦é€‰æ‹©é‚£äº›cardinalityæ¯”è¾ƒä½çš„å­—æ®µï¼Œå¦åˆ™æ•°æ®çš„å­˜å‚¨å°±ä¼šéå¸¸çš„åˆ†æ•£ã€‚<br><br>ä¸€ä¸ªcardinalityé«˜ï¼Œä¸€ä¸ªcardinalityä½ï¼Œä¸¤è€…ç›¸äº’çŸ›ç›¾ã€‚è¿™å—ç¡®å®æ¯”è¾ƒâ€œè›‹ç–¼â€ï¼Œå¦‚æœæŸ¥è¯¢ä¸­çš„Join Keyså¤šå±äºuserIdè¿™ç§cardinalityéå¸¸é«˜çš„å­—æ®µï¼Œå¦ç™½è¯´å’±ä»¬è¿˜çœŸæ²¡ä»€ä¹ˆå¥½åŠæ³•ã€‚<br><br>å¯¹äºé‚£äº›cardinalityè¾ƒé«˜çš„Join Keyï¼Œæˆ‘ä»¬å°±éœ€è¦åšå–èˆï¼Œä¹Ÿå°±æ˜¯åœ¨å­˜å‚¨æ•ˆç‡å’ŒDPPä¹‹é—´åšæƒè¡¡ã€‚å¦‚æœæŸ¥è¯¢æ•ˆç‡æ˜¯ç¬¬ä¸€ä¼˜å…ˆçº§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…¶å®è¿˜æ˜¯å¯ä»¥å¼ºè¡Œå¯¹cardinalityè¾ƒé«˜çš„Join Keyåšåˆ†åŒºé”®ã€‚ä½†å¦‚æœç›¸åï¼Œå­˜å‚¨æ•ˆç‡æœ€å¤§çš„concernï¼Œé‚£ä¹ˆä¹Ÿå°±åªå¥½æ”¾å¼ƒå–Join Keyåšåˆ†åŒºé”®ï¼Œæ”¾å¼ƒDPPä¼˜åŒ–æœºåˆ¶ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1621434594,"ip_address":"","comment_id":293237,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5916267487","product_id":100073401,"comment_content":"è€å¸ˆ å¦‚æœä»¥useridä½œä¸ºåˆ†åŒºå­—æ®µ ç›¸æ¯”äºæ—¥æœŸç­‰åˆ†åŒºå­—æ®µ åˆ†åŒºè¿‡å¤š ä½†idç­‰å­—æ®µåˆå¸¸å¸¸ä½œä¸ºjoin key è¿™ä¸ªæ€ä¹ˆè§£å†³å‘¢","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520127,"discussion_content":"å¥½é—®é¢˜ï¼Œè¿™å—ç¡®å®æ˜¯DPPçš„â€œç¡¬ä¼¤â€ã€‚\n\nå°±åƒä½ è¯´çš„ï¼ŒJoin Keyså¾€å¾€æ˜¯cardinalityæ¯”è¾ƒé«˜çš„å­—æ®µï¼Œæ¯”å¦‚userIdï¼›è€Œåˆ†åŒºé”®å¾€å¾€æ˜¯è¦é€‰æ‹©é‚£äº›cardinalityæ¯”è¾ƒä½çš„å­—æ®µï¼Œå¦åˆ™æ•°æ®çš„å­˜å‚¨å°±ä¼šéå¸¸çš„åˆ†æ•£ã€‚\n\nä¸€ä¸ªcardinalityé«˜ï¼Œä¸€ä¸ªcardinalityä½ï¼Œä¸¤è€…ç›¸äº’çŸ›ç›¾ã€‚è¿™å—ç¡®å®æ¯”è¾ƒâ€œè›‹ç–¼â€ï¼Œå¦‚æœæŸ¥è¯¢ä¸­çš„Join Keyså¤šå±äºuserIdè¿™ç§cardinalityéå¸¸é«˜çš„å­—æ®µï¼Œå¦ç™½è¯´å’±ä»¬è¿˜çœŸæ²¡ä»€ä¹ˆå¥½åŠæ³•ã€‚\n\nå¯¹äºé‚£äº›cardinalityè¾ƒé«˜çš„Join Keyï¼Œæˆ‘ä»¬å°±éœ€è¦åšå–èˆï¼Œä¹Ÿå°±æ˜¯åœ¨å­˜å‚¨æ•ˆç‡å’ŒDPPä¹‹é—´åšæƒè¡¡ã€‚å¦‚æœæŸ¥è¯¢æ•ˆç‡æ˜¯ç¬¬ä¸€ä¼˜å…ˆçº§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å…¶å®è¿˜æ˜¯å¯ä»¥å¼ºè¡Œå¯¹cardinalityè¾ƒé«˜çš„Join Keyåšåˆ†åŒºé”®ã€‚ä½†å¦‚æœç›¸åï¼Œå­˜å‚¨æ•ˆç‡æœ€å¤§çš„concernï¼Œé‚£ä¹ˆä¹Ÿå°±åªå¥½æ”¾å¼ƒå–Join Keyåšåˆ†åŒºé”®ï¼Œæ”¾å¼ƒDPPä¼˜åŒ–æœºåˆ¶ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621434594,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":292979,"user_name":"aof","can_delete":false,"product_type":"c1","uid":1062864,"ip_address":"","ucode":"5815D63C4926BC","user_header":"https://static001.geekbang.org/account/avatar/00/10/37/d0/26975fba.jpg","comment_is_top":false,"comment_ctime":1621137780,"is_pvip":false,"replies":[{"id":"106275","content":"ä¸é”™çš„æ€è·¯~ ä¸è¿‡è¿™é‡Œæœ‰ä¸ªå‰ææ¡ä»¶ï¼Œå°±æ˜¯å¯¹äºç»´è¡¨ä¸Šçš„è¿‡æ»¤å­—æ®µï¼Œäº‹å®è¡¨ä¸Šä¹Ÿè¦æœ‰æ‰è¡Œã€‚æ¯”å¦‚ï¼Œdim.c1 = &quot;xxx&quot;ï¼Œé‚£ä¹ˆå°±è¦æ±‚factä¸Šé¢ä¹Ÿè¦æœ‰c1å­—æ®µï¼Œå¦åˆ™ä»…åœ¨é€»è¾‘è®¡åˆ’é˜¶æ®µï¼Œæ˜¯åšä¸åˆ°è¿‡æ»¤æ¡ä»¶ä¼ å¯¼çš„ã€‚<br><br>è¿™ä¸ªæ€è·¯æœ¬è´¨ä¸Šå…¶å®æ˜¯Query Re-writerï¼Œå°±æ˜¯åœ¨é€»è¾‘è®¡åˆ’é˜¶æ®µæŠŠæŸ¥è¯¢è¿›è¡Œé‡å†™ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1621411644,"ip_address":"","comment_id":292979,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5916105076","product_id":100073401,"comment_content":"å¯ä»¥åœ¨é€»è¾‘è®¡åˆ’ä¼˜åŒ–çš„æ—¶å€™ï¼Œå°±ç›´æ¥å°†ç»´è¡¨çš„è¿‡æ»¤æ¡ä»¶é€šè¿‡joinæ¡ä»¶ä¼ å¯¼åˆ°äº‹å®è¡¨ï¼Œå‡å°‘æ•°æ®çš„æ‰«æ","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520032,"discussion_content":"ä¸é”™çš„æ€è·¯~ ä¸è¿‡è¿™é‡Œæœ‰ä¸ªå‰ææ¡ä»¶ï¼Œå°±æ˜¯å¯¹äºç»´è¡¨ä¸Šçš„è¿‡æ»¤å­—æ®µï¼Œäº‹å®è¡¨ä¸Šä¹Ÿè¦æœ‰æ‰è¡Œã€‚æ¯”å¦‚ï¼Œdim.c1 = &amp;quot;xxx&amp;quot;ï¼Œé‚£ä¹ˆå°±è¦æ±‚factä¸Šé¢ä¹Ÿè¦æœ‰c1å­—æ®µï¼Œå¦åˆ™ä»…åœ¨é€»è¾‘è®¡åˆ’é˜¶æ®µï¼Œæ˜¯åšä¸åˆ°è¿‡æ»¤æ¡ä»¶ä¼ å¯¼çš„ã€‚\n\nè¿™ä¸ªæ€è·¯æœ¬è´¨ä¸Šå…¶å®æ˜¯Query Re-writerï¼Œå°±æ˜¯åœ¨é€»è¾‘è®¡åˆ’é˜¶æ®µæŠŠæŸ¥è¯¢è¿›è¡Œé‡å†™ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621411644,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":357302,"user_name":"ThomasG","can_delete":false,"product_type":"c1","uid":1591216,"ip_address":"åŒ—äº¬","ucode":"C05D94E0A10662","user_header":"https://static001.geekbang.org/account/avatar/00/18/47/b0/cf5529a0.jpg","comment_is_top":false,"comment_ctime":1663145454,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1663145454","product_id":100073401,"comment_content":"dppä½¿ç”¨æ¡ä»¶ä¸Šä¸å±€é™åœ¨æ˜¯å¦èƒ½å¤Ÿè¿›è¡Œbroadcastjoin ã€‚<br>åœ¨å‚æ•°spark.sql.optimizer.dynamicPartitionPruning.reuseBroadcastOnly=falseæ—¶ï¼Œå¦‚æœæ­¤æ—¶åˆ¤å®šåœ¨åˆ†åŒºè¡¨ä¸­åŠ å…¥ä¸€ä¸ªè¿‡æ»¤å­æŸ¥è¯¢æ˜¯æœ‰æ”¶ç›Šçš„ä»ç„¶ä¼šèµ°dpp,è¿™é‡Œä¼šæŒ‰ç…§è¿‡æ»¤keyå¯¹æ•°æ®èšåˆï¼Œæ’å…¥ä¸€ä¸ªå­æŸ¥è¯¢åˆ°åˆ†åŒºè¡¨ä¸­ï¼Œå¦å¤–å¯¹äºjoin ç±»å‹ä¸Šçš„é™åˆ¶æ˜¯ï¼š<br>INNER, LEFT SEMI,LEFT OUTER (partitioned on right), or RIGHT OUTER (partitioned on left)<br>å³å¯¹äºinner ,left semi æ²¡æœ‰é™åˆ¶ï¼Œleft outer join åˆ†åŒºè¡¨å¿…é¡»æ˜¯å³è¡¨  ï¼Œright out åˆ†å¸ƒè¡¨å¿…é¡»æ˜¯å·¦è¡¨<br>","like_count":0},{"had_liked":false,"id":342696,"user_name":"å¤ªé˜³ä¸å†°","can_delete":false,"product_type":"c1","uid":2742520,"ip_address":"","ucode":"C2B97279BD66C7","user_header":"https://static001.geekbang.org/account/avatar/00/29/d8/f8/a775cde7.jpg","comment_is_top":false,"comment_ctime":1650422316,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1650422316","product_id":100073401,"comment_content":"è¿™ä¸ªdppæˆ‘çœ‹å¾ˆå¤šæ•°æ®åº“é‡Œé¢ä¹Ÿéƒ½åšäº†ç±»ä¼¼å®ç°å•Šï¼Œæ¯”å¦‚åä¸ºçš„é«˜æ–¯dbç­‰ç­‰~","like_count":0},{"had_liked":false,"id":331074,"user_name":"Unknown element","can_delete":false,"product_type":"c1","uid":2028277,"ip_address":"","ucode":"34A129800D0238","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f2/f5/b82f410d.jpg","comment_is_top":false,"comment_ctime":1642409677,"is_pvip":false,"replies":[{"id":"121200","content":"å¥½é—®é¢˜ï¼Œç¡®å®ï¼Œå¦‚æœæ˜¯left joinï¼ŒDPPå°±æ²¡æœ‰æ„ä¹‰äº†ï¼Œæ¯•ç«Ÿå·¦è¡¨çš„æ•°æ®ä¸ç®¡èƒ½ä¸èƒ½å…³è”ä¸Šï¼Œéƒ½éœ€è¦æ‰«æå‡ºæ¥","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1043100","ctime":1642778670,"ip_address":"","comment_id":331074,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1642409677","product_id":100073401,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œé—®ä¸‹å¦‚æœå…³è”æ˜¯left joiné‚£DPPè¿˜èƒ½ç”Ÿæ•ˆå—ï¼Ÿæ­¤æ—¶å·¦è¡¨å¹¶ä¸éœ€è¦è¿‡æ»¤ï¼Œå› ä¸ºç»“æœé›†åº”è¯¥ä¿ç•™å·¦è¡¨æ‰€æœ‰æ•°æ®<br>è°¢è°¢è€å¸ˆ~","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547641,"discussion_content":"å¥½é—®é¢˜ï¼Œç¡®å®ï¼Œå¦‚æœæ˜¯left joinï¼ŒDPPå°±æ²¡æœ‰æ„ä¹‰äº†ï¼Œæ¯•ç«Ÿå·¦è¡¨çš„æ•°æ®ä¸ç®¡èƒ½ä¸èƒ½å…³è”ä¸Šï¼Œéƒ½éœ€è¦æ‰«æå‡ºæ¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642778670,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":311233,"user_name":"tony","can_delete":false,"product_type":"c1","uid":1254277,"ip_address":"","ucode":"D5BBFBEB576BE5","user_header":"https://static001.geekbang.org/account/avatar/00/13/23/85/e19f8833.jpg","comment_is_top":false,"comment_ctime":1631113776,"is_pvip":false,"replies":[{"id":"112911","content":"ç¡®å®ï¼Œå…¶å®å¯ä»¥å€Ÿé‰´ä¼ ç»ŸRDBMSä¸­ç»å…¸çš„ä¼˜åŒ–æ–¹æ³•ï¼Œquery rewriteå°±æ˜¯å…¶ä¸­ä¸€ä¸ªã€‚Spark SQLç¡®å®ç¼ºå°‘query rewriterè¿™ä¸ªç»„ä»¶ï¼Œé‡‡ç”¨é€»è¾‘è§„åˆ™åŠ ç‰©ç†ç­–ç•¥çš„æ–¹å¼ï¼Œå®é™…ä¸Šç¼ºå°‘äº†ä¸€å®šçš„çµæ´»æ€§~<br><br>ä¸è¿‡ï¼Œquery rewriteè¿™å—ï¼Œæˆ‘ç†è§£å’Œæ•°æ®é‡æœ¬èº«åº”è¯¥å…³ç³»ä¸å¤§","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1631345277,"ip_address":"","comment_id":311233,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1631113776","product_id":100073401,"comment_content":"å…¶å®ï¼Œsparkæœ‰å®šä¹‰ruleçš„æœºåˆ¶ï¼Œåœ¨é€»è¾‘è®¡åˆ’é˜¶æ®µè‡ªå·±å®ç°query rewriteï¼Œé€šè¿‡ä¸€äº›å‰ç½®çš„æ£€éªŒæ¡ä»¶ï¼ŒæŠŠç»´è¡¨çš„éåˆ†åŒºå­—æ®µæ¡ä»¶è½¬ä¸ºfilteræ¨åˆ°äº‹å®è¡¨çš„logical planä¸Šã€‚ä¸è¿‡åªèƒ½æ»¡è¶³å°æ•°æ®é‡çš„åœºæ™¯ã€‚","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526531,"discussion_content":"ç¡®å®ï¼Œå…¶å®å¯ä»¥å€Ÿé‰´ä¼ ç»ŸRDBMSä¸­ç»å…¸çš„ä¼˜åŒ–æ–¹æ³•ï¼Œquery rewriteå°±æ˜¯å…¶ä¸­ä¸€ä¸ªã€‚Spark SQLç¡®å®ç¼ºå°‘query rewriterè¿™ä¸ªç»„ä»¶ï¼Œé‡‡ç”¨é€»è¾‘è§„åˆ™åŠ ç‰©ç†ç­–ç•¥çš„æ–¹å¼ï¼Œå®é™…ä¸Šç¼ºå°‘äº†ä¸€å®šçš„çµæ´»æ€§~\n\nä¸è¿‡ï¼Œquery rewriteè¿™å—ï¼Œæˆ‘ç†è§£å’Œæ•°æ®é‡æœ¬èº«åº”è¯¥å…³ç³»ä¸å¤§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631345277,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":309263,"user_name":"sparkjoy","can_delete":false,"product_type":"c1","uid":1000179,"ip_address":"","ucode":"827B3116EED3B8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/42/f3/e945e4ac.jpg","comment_is_top":false,"comment_ctime":1630027290,"is_pvip":false,"replies":[{"id":"112507","content":"è¦çœ‹bucketè¡¨æ˜¯ä¸æ˜¯æ»¡è¶³DPPçš„å‰ææ¡ä»¶ï¼Œå¦‚æœbucketè¡¨æ˜¯åˆ†åŒºè¡¨ï¼Œè€Œä¸”åˆ†åŒºé”®åŒ…å«join keyï¼Œé‚£å°±å¯ä»¥ã€‚å¦‚æœä¸æ»¡è¶³DPPçš„3ä¸ªå‰ææ¡ä»¶ï¼Œbucketè¡¨ä¹Ÿä¸è¡Œã€‚å½“ç„¶äº†ï¼Œbucketè¡¨æœ¬èº«ä¹Ÿæœ‰æå‡I&#47;Oæ•ˆç‡çš„èƒ½åŠ›ï¼Œè¿™ä¸ªæ˜¯æ¯«æ— ç–‘é—®çš„~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1630765557,"ip_address":"","comment_id":309263,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1630027290","product_id":100073401,"comment_content":"è€å¸ˆï¼ŒDPPå¯¹äºbucketæœ‰æ•ˆæœå—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525805,"discussion_content":"è¦çœ‹bucketè¡¨æ˜¯ä¸æ˜¯æ»¡è¶³DPPçš„å‰ææ¡ä»¶ï¼Œå¦‚æœbucketè¡¨æ˜¯åˆ†åŒºè¡¨ï¼Œè€Œä¸”åˆ†åŒºé”®åŒ…å«join keyï¼Œé‚£å°±å¯ä»¥ã€‚å¦‚æœä¸æ»¡è¶³DPPçš„3ä¸ªå‰ææ¡ä»¶ï¼Œbucketè¡¨ä¹Ÿä¸è¡Œã€‚å½“ç„¶äº†ï¼Œbucketè¡¨æœ¬èº«ä¹Ÿæœ‰æå‡I/Oæ•ˆç‡çš„èƒ½åŠ›ï¼Œè¿™ä¸ªæ˜¯æ¯«æ— ç–‘é—®çš„~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630765557,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":292036,"user_name":"FendoraèŒƒä¸œ_","can_delete":false,"product_type":"c1","uid":1187106,"ip_address":"","ucode":"63EE9DBEE08D70","user_header":"https://static001.geekbang.org/account/avatar/00/12/1d/22/f04cea4c.jpg","comment_is_top":false,"comment_ctime":1620651433,"is_pvip":false,"replies":[{"id":"105803","content":"æ€è·¯ä¸é”™~ å…¶å®è¿™é‡Œé¢çš„å…³é”®ç‚¹ï¼Œå°±æ˜¯è®©æ¯ä¸€ä¸ªExecutorséƒ½èƒ½æ‹¿åˆ°è¿‡æ»¤ä¹‹åçš„Join Keysçš„å…¨é›†ã€‚<br><br>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœä»…ä»…å¹¿æ’­Key Setçš„è¯ï¼Œå°±åƒä½ è¯´çš„ï¼Œæ•°æ®é›†å¾ˆå°ï¼Œå¯¹äºå¹¿æ’­é˜ˆå€¼çš„è¦æ±‚ä¼šä½å¾—å¤šã€‚å®é™…ä¸Šï¼Œæœ€æç«¯åœ°ï¼Œè¿˜å¯ä»¥åªå¹¿æ’­Key Setçš„å“ˆå¸Œå€¼ï¼Œå¦‚æœJoin Keysæœ¬èº«å¾ˆå¤§çš„è¯ã€‚ç°åœ¨çš„å®ç°æ–¹å¼ä¹‹æ‰€ä»¥é™„åŠ Payloadsï¼Œæ ¹æœ¬åŸå› æ˜¯åé¢æ‰“ç®—â€œä¸€ç®­åŒé›•â€åœ°ç”¨BHJæ¥å®ç°ä¸¤è¡¨å…³è”ã€‚å®é™…ä¸Šï¼Œä¸¥æ ¼æ¥è¯´ï¼Œåªè¦æ‹¿åˆ°Key Setå…¨é›†ï¼Œåšå®Œè¿‡æ»¤ï¼Œé‡‡ç”¨Shuffle Joinsä¹Ÿä¸æ˜¯ä¸å¯ä»¥ï¼Œæ¯•ç«Ÿè¿‡æ»¤ä¹‹åçš„äº‹å®è¡¨ä¹Ÿå˜å°äº†ã€‚<br><br>ç¬¬äºŒä¸ªé—®é¢˜ï¼Œå°±åƒåˆšåˆšè¯´çš„ï¼Œåªè¦æ˜¯èƒ½æ‹¿åˆ°Key Setå…¨é›†ï¼Œå°±èƒ½æ»¡è¶³é¢„è¿‡æ»¤äº‹å®è¡¨çš„è¿™ä¸ªéœ€æ±‚ï¼Œæ‰€ä»¥åƒæ˜¯Cacheã€åˆ†å¸ƒå¼å­˜å‚¨å…¶å®éƒ½è¡Œï¼Œåªä¸è¿‡æ•ˆç‡ä¸Šä¸å¦‚å¹¿æ’­å˜é‡ï¼Œå› ä¸ºå‰ä¸¤è€…è¿˜ä¼šä»¥Taskä¸ºç²’åº¦èµ°ç½‘ç»œï¼Œå¹¿æ’­ä»…èµ°ä¸€æ¬¡ç½‘ç»œã€ç„¶åæ‰€æœ‰Taskså—ç›Šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620773665,"ip_address":"","comment_id":292036,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1620651433","product_id":100073401,"comment_content":"é—®é¢˜å›ç­”<br>1.åªå¹¿æ’­join keyçš„key setï¼Œè¿™ä¸ªæ•°æ®é‡åº”è¯¥æ˜¯æ¯”è¾ƒå°çš„ã€‚<br>2.å¯ä»¥æŠŠjoin keyçš„key setç¼“å­˜åˆ°å†…å­˜ä¸­ã€‚","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519645,"discussion_content":"æ€è·¯ä¸é”™~ å…¶å®è¿™é‡Œé¢çš„å…³é”®ç‚¹ï¼Œå°±æ˜¯è®©æ¯ä¸€ä¸ªExecutorséƒ½èƒ½æ‹¿åˆ°è¿‡æ»¤ä¹‹åçš„Join Keysçš„å…¨é›†ã€‚\n\nç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœä»…ä»…å¹¿æ’­Key Setçš„è¯ï¼Œå°±åƒä½ è¯´çš„ï¼Œæ•°æ®é›†å¾ˆå°ï¼Œå¯¹äºå¹¿æ’­é˜ˆå€¼çš„è¦æ±‚ä¼šä½å¾—å¤šã€‚å®é™…ä¸Šï¼Œæœ€æç«¯åœ°ï¼Œè¿˜å¯ä»¥åªå¹¿æ’­Key Setçš„å“ˆå¸Œå€¼ï¼Œå¦‚æœJoin Keysæœ¬èº«å¾ˆå¤§çš„è¯ã€‚ç°åœ¨çš„å®ç°æ–¹å¼ä¹‹æ‰€ä»¥é™„åŠ Payloadsï¼Œæ ¹æœ¬åŸå› æ˜¯åé¢æ‰“ç®—â€œä¸€ç®­åŒé›•â€åœ°ç”¨BHJæ¥å®ç°ä¸¤è¡¨å…³è”ã€‚å®é™…ä¸Šï¼Œä¸¥æ ¼æ¥è¯´ï¼Œåªè¦æ‹¿åˆ°Key Setå…¨é›†ï¼Œåšå®Œè¿‡æ»¤ï¼Œé‡‡ç”¨Shuffle Joinsä¹Ÿä¸æ˜¯ä¸å¯ä»¥ï¼Œæ¯•ç«Ÿè¿‡æ»¤ä¹‹åçš„äº‹å®è¡¨ä¹Ÿå˜å°äº†ã€‚\n\nç¬¬äºŒä¸ªé—®é¢˜ï¼Œå°±åƒåˆšåˆšè¯´çš„ï¼Œåªè¦æ˜¯èƒ½æ‹¿åˆ°Key Setå…¨é›†ï¼Œå°±èƒ½æ»¡è¶³é¢„è¿‡æ»¤äº‹å®è¡¨çš„è¿™ä¸ªéœ€æ±‚ï¼Œæ‰€ä»¥åƒæ˜¯Cacheã€åˆ†å¸ƒå¼å­˜å‚¨å…¶å®éƒ½è¡Œï¼Œåªä¸è¿‡æ•ˆç‡ä¸Šä¸å¦‚å¹¿æ’­å˜é‡ï¼Œå› ä¸ºå‰ä¸¤è€…è¿˜ä¼šä»¥Taskä¸ºç²’åº¦èµ°ç½‘ç»œï¼Œå¹¿æ’­ä»…èµ°ä¸€æ¬¡ç½‘ç»œã€ç„¶åæ‰€æœ‰Taskså—ç›Šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620773665,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291922,"user_name":"æ–¯ç›–ä¸¸","can_delete":false,"product_type":"c1","uid":1168504,"ip_address":"","ucode":"B881D14B028F14","user_header":"https://static001.geekbang.org/account/avatar/00/11/d4/78/66b3f2a2.jpg","comment_is_top":false,"comment_ctime":1620609183,"is_pvip":false,"replies":[{"id":"105714","content":"å¯ä»¥çš„å“ˆ~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620634122,"ip_address":"","comment_id":291922,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1620609183","product_id":100073401,"comment_content":"è€å¸ˆï¼Œå¦‚æœäº‹å®è¡¨çš„joinå­—æ®µæœ‰å¥½å‡ ä¸ªï¼Œå…¶ä¸­åªæœ‰ä¸€ä¸ªæ˜¯åˆ†åŒºå­—æ®µï¼Œé‚£è¿˜èƒ½äº«å—åˆ°DPPå—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519607,"discussion_content":"å¯ä»¥çš„å“ˆ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620634122,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}