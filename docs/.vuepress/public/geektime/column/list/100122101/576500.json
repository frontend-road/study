{"id":576500,"title":"05ï½œmapã€reduceå’Œmonadå¦‚ä½•å›´ç»•å€¼è¿›è¡Œæ“ä½œï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯çŸ³å·ã€‚</p><p>ä¸ŠèŠ‚è¯¾é‡Œï¼Œæˆ‘ä»¬åœ¨å­¦ä¹ ç»„åˆå’Œç®¡é“çš„å·¥ä½œæœºåˆ¶çš„æ—¶å€™ï¼Œç¬¬ä¸€æ¬¡è®¤è¯†äº†reducerï¼ŒåŒæ—¶åœ¨è®²åˆ°transduceçš„æ—¶å€™ï¼Œä¹Ÿæ¥è§¦åˆ°äº†mapã€filterå’Œreduceè¿™äº›æ¦‚å¿µã€‚é‚£ä¹ˆä»Šå¤©è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°±é€šè¿‡JSä¸­æ•°ç»„è‡ªå¸¦çš„åŠŸèƒ½æ–¹æ³•ï¼Œæ¥è¿›ä¸€æ­¥äº†è§£ä¸‹transduceçš„åŸç†ï¼Œåšåˆ°æ—¢çŸ¥å…¶ç„¶ï¼ŒåˆçŸ¥å…¶æ‰€ä»¥ç„¶ã€‚</p><p>å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿçœ‹çœ‹ç”±mapä½œä¸ºfunctorå¯ä»¥å¼•ç”³å‡ºçš„monadçš„æ¦‚å¿µï¼Œçœ‹çœ‹å®ƒæ˜¯å¦‚ä½•è®©å‡½æ•°é—´æ›´å¥½åœ°è¿›è¡Œäº¤äº’çš„ã€‚</p><h2>æ•°æ®çš„æ ¸å¿ƒæ“ä½œ</h2><p>é‚£åœ¨æ­£å¼å¼€å§‹ä¹‹å‰ï¼Œæˆ‘å…ˆæ¥è¯´æ˜ä¸‹è¿™èŠ‚è¯¾ä½ è¦å…³æ³¨çš„é‡ç‚¹ã€‚è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä¼šå…ˆå¸¦ä½ é€šè¿‡JavaScriptæœ¬èº«è‡ªå¸¦çš„æ˜ å°„ï¼ˆmapï¼‰ã€è¿‡æ»¤ï¼ˆfilterï¼‰å’Œreduceæ–¹æ³•ï¼Œæ¥äº†è§£ä¸‹è¿™å‡ ç§æ–¹æ³•å¯¹å€¼çš„æ ¸å¿ƒæ“ä½œã€‚åŒæ—¶å‘¢ï¼Œæˆ‘ä¹Ÿç»™ä½ è§£ç­”ä¸‹ä¸ŠèŠ‚è¯¾æå‡ºçš„é—®é¢˜ï¼Œå³å¦‚ä½•é€šè¿‡æ˜ å°„å’Œè¿‡æ»¤æ¥åšåˆ°reduceã€‚<strong>ä½œä¸ºæˆ‘ä»¬åé¢è®²åˆ°functorå’Œmonadçš„åŸºç¡€ã€‚</strong></p><p>å¥½ï¼Œä¸‹é¢æˆ‘ä»¬å°±ä»mapå¼€å§‹è®²èµ·ã€‚</p><h3>mapæ˜ å°„å’Œå‡½å­</h3><p>æˆ‘ä»¬ç»å¸¸å¬è¯´ï¼Œarray.mapå°±æ˜¯ä¸€ä¸ªå‡½å­ï¼ˆfunctorï¼‰ï¼Œé‚£ä»€ä¹ˆæ˜¯ä¸€ä¸ªå‡½å­å‘¢ï¼Ÿ</p><p>å®é™…ä¸Šï¼Œ<strong>å‡½å­æ˜¯ä¸€ä¸ªå¸¦è¿ç®—å·¥å…·çš„æ•°æ®ç±»å‹æˆ–æ•°æ®ç»“æ„å€¼</strong>ã€‚ä¸¾ä¸ªå¸¸ç”¨çš„ä¾‹å­ï¼Œåœ¨JavaScriptä¸­ï¼Œå­—ç¬¦ä¸²ï¼ˆstringï¼‰å°±æ˜¯ä¸€ä¸ªæ•°æ®ç±»å‹ï¼Œè€Œæ•°ç»„ï¼ˆarrayï¼‰æ—¢æ˜¯ä¸€ä¸ªæ•°æ®ç±»å‹ä¹Ÿæ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å­—ç¬¦ä¸²æ¥è¡¨è¾¾ä¸€ä¸ªå•è¯æˆ–å¥å­ã€‚è€Œå¦‚æœæˆ‘ä»¬æƒ³è®©ä¸‹å›¾ä¸­çš„æ¯ä¸ªå­—æ¯éƒ½å˜æˆå¤§å†™ï¼Œé‚£ä¹ˆå°±æ˜¯ä¸€ä¸ªè½¬æ¢å’Œæ˜ å°„çš„è¿‡ç¨‹ã€‚</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/01/4a/0189d359702f28862073228b126a784a.jpeg?wh=1920x1080\" alt=\"\"></p><p>æˆ‘ä»¬å†ç”¨ä¸€æ®µæŠ½è±¡çš„ä»£ç æ¥è¡¨ç¤ºä¸€ä¸ªå­—ç¬¦ä¸²çš„æ˜ å°„å‡½å­stringMapã€‚å¯ä»¥çœ‹åˆ°ï¼ŒstringMapå¯ä»¥æŠŠå­—ç¬¦ä¸²Hello World!ä½œä¸ºè¾“å…¥ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªuppercaseLetterå·¥å…·å‡½æ•°çš„è½¬æ¢ï¼Œå¯¹åº”è¿”å›å¤§å†™çš„HELLO WORLD!ã€‚</p><pre><code class=\"language-javascript\">stringMap( uppercaseLetter, \"Hello World!\" ); // HELLO WORLD!\n</code></pre><p>ç±»ä¼¼åœ°ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªæ•°ç»„çš„æ˜ å°„å‡½å­arrayMapï¼Œä¹Ÿå¯ä»¥æŠŠæ•°ç»„ [â€œ1â€,â€œ2â€,â€œ3â€] ä¸­æ¯ä¸ªå­—ç¬¦ä¸²çš„å…ƒç´ è½¬åŒ–æˆæ•´æ•°ï¼Œç„¶åå†å¯¹åº”è¾“å‡ºä¸€ä¸ªæ•´æ•°æ•°ç»„ [1, 2, 3]ã€‚</p><pre><code class=\"language-javascript\">[\"1\",\"2\",\"3\",\"4\",\"5\"].map( unary( parseInt ) ); // [1,2,3,4,5]\n</code></pre><h3>filterè¿‡æ»¤å’Œç­›é€‰</h3><p>è¯´å®Œäº†å‡½å­ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹è¿‡æ»¤å™¨ï¼ˆfilterï¼‰å’Œæ–­è¨€ï¼ˆpredicateï¼‰ã€‚</p><p>filteré¡¾åæ€ä¹‰ï¼Œå°±æ˜¯è¿‡æ»¤çš„æ„æ€ã€‚ä½†è¦æ³¨æ„ä¸€ç‚¹ï¼Œfilterå¯ä»¥æ˜¯åŒå‘çš„ï¼Œæˆ‘ä»¬å¯ä»¥<strong>è¿‡æ»¤æ‰ï¼ˆfilter outï¼‰</strong>ä¸æƒ³è¦çš„ä¸œè¥¿ï¼Œä¹Ÿå¯ä»¥<strong>ç­›é€‰å‡ºï¼ˆfilter inï¼‰</strong>å‡ºæƒ³è¦çš„ä¸œè¥¿ã€‚</p><p>ç„¶åå†æ¥çœ‹æ–­è¨€ã€‚æˆ‘ä»¬ä¸ŠèŠ‚è¯¾åœ¨è¯´åˆ°<a href=\"https://time.geekbang.org/column/article/574132\">å¤„ç†è¾“å…¥å‚æ•°çš„å·¥å…·</a>çš„æ—¶å€™ï¼Œä¹Ÿæ¥è§¦è¿‡æ–­è¨€ï¼Œæ¯”å¦‚identityå°±å¯ä»¥çœ‹ä½œæ˜¯æ–­è¨€ã€‚åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œ<strong>æ–­è¨€å°±æ˜¯ä¸€ä¸ªä¸ªçš„ç­›é€‰æ¡ä»¶</strong>ï¼Œæ‰€ä»¥åœ¨è¿‡æ»¤å™¨ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨æ–­è¨€å‡½æ•°ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/92/8e/92dcf58f0fc6c36869183f54d3ae478e.jpeg?wh=1920x1080\" alt=\"\"></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚æœ‰ä¸€ä¸ªç”¨æ¥åˆ¤æ–­â€œä¸€ä¸ªå€¼æ˜¯ä¸æ˜¯å¥‡æ•°â€çš„isOddå‡½æ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ–­è¨€ï¼Œè€Œå®ƒçš„ç­›é€‰æ¡ä»¶å°±æ˜¯ç­›é€‰å‡ºæ•°ç»„ä¸­çš„å•æ•°ã€‚æ‰€ä»¥ï¼Œå¦‚æœç”¨å®ƒæ¥ç­›é€‰ [1,2,3,4,5]ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯ [1,3,5]ã€‚</p><pre><code class=\"language-javascript\">[1,2,3,4,5].filter( isOdd ); // [1,3,5]\n</code></pre><p>åœ¨Javascriptä¸­ä¹Ÿæœ‰è‡ªå¸¦çš„ some() å’Œ every() æ–­è¨€æ–¹æ³•ã€‚å®ƒä»¬çš„ä½œç”¨å°±æ˜¯å¯ä»¥åˆ¤æ–­æ•°ç»„ä¸­çš„ä¸€ç»„å…ƒç´ æ˜¯ä¸æ˜¯éƒ½ç¬¦åˆåˆ¤æ–­æ¡ä»¶ã€‚</p><p>æ¯”å¦‚åœ¨ä¸‹é¢ä¸€åˆ—åŒ…å«äº† [1,2,3,4,5] è¿™å‡ ä¸ªæ•°å­—çš„æ•°ç»„ä¸­ï¼Œå¦‚æœæˆ‘ä»¬è¦åˆ¤æ–­å®ƒçš„æ¯ä¸€ä¸ªå…ƒç´ æ˜¯ä¸æ˜¯éƒ½å°äº6ï¼Œç»“æœå°±æ˜¯trueã€‚å¦‚æœæˆ‘ä»¬è¦åˆ¤æ–­å®ƒä»¬æ˜¯ä¸æ˜¯éƒ½æ˜¯å¥‡æ•°ï¼Œç»“æœå°±æ˜¯falseï¼Œå› ä¸ºè¿™é‡Œé¢æ—¢æœ‰å¥‡æ•°ï¼Œä¹Ÿæœ‰å¶æ•°ã€‚</p><pre><code class=\"language-c++\">let arr = [1,2,3,4,5];\narr.every(x =&gt; x &lt; 6)      // =&gt; trueï¼Œæ‰€æœ‰çš„å€¼éƒ½å°äº6\narr.every(x =&gt; x % 2 === 1) // =&gt; falseï¼Œä¸æ˜¯æ‰€æœ‰çš„æ•°éƒ½æ˜¯å¥‡æ•°\n</code></pre><p>ç±»ä¼¼åœ°ï¼Œsome()å¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ¤æ–­è¿™ç»„æ•°ç»„ä¸­æœ‰æ²¡æœ‰ä¸€äº›å°äº6çš„æ•°å­—æˆ–è€…å¥‡æ•°ã€‚è¿™æ—¶ï¼Œè¿™ä¸¤ä¸ªåˆ¤æ–­è¿”å›çš„ç»“æœéƒ½æ˜¯trueã€‚</p><pre><code class=\"language-c++\">let arr = [1,2,3,4,5];\narr.some(x =&gt; x &lt; 6)      // =&gt; trueï¼Œaé‡Œé¢æœ‰å°äº6çš„æ•°å­—\narr.some(x =&gt; x % 2 === 1)  // =&gt; trueï¼Œæ•°ç»„aé‡Œé¢æœ‰ä¸€äº›å¥‡æ•°\n</code></pre><p>è™½ç„¶some() å’Œ every() éƒ½æ˜¯ JavaScriptè‡ªå¸¦çš„æ–­è¨€æ–¹æ³•ï¼Œä½†æ˜¯å¯¹æ¯” filter() ï¼Œå®ƒä»¬å°±æ˜¾å¾—æ²¡æœ‰é‚£ä¹ˆâ€œå‡½æ•°å¼â€äº†ï¼Œå› ä¸ºå®ƒä»¬çš„è¿”å›å€¼åªæ˜¯ä¸€ä¸ª true æˆ– falseï¼Œè€Œæ²¡æœ‰åƒ filter ä¸€æ ·è¿”å›ä¸€ç»„æ•°æ®ä½œä¸ºè¾“å‡ºï¼Œç»§ç»­ç”¨æ¥è¿›è¡Œåç»­ä¸€ç³»åˆ—çš„å‡½æ•°å¼çš„æ“ä½œã€‚</p><h3>reduceå’Œç¼©å‡å™¨</h3><p>æœ€åæˆ‘ä»¬å†æ¥è¯´è¯´reduceã€‚å®é™…ä¸Šï¼Œç¼©å‡ï¼ˆreduceï¼‰ä¸»è¦çš„ä½œç”¨å°±æ˜¯<strong>æŠŠåˆ—è¡¨ä¸­çš„å€¼åˆæˆä¸€ä¸ªå€¼</strong>ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/87/21/8741b90f842643350d34077b9c40f721.jpeg?wh=1920x1080\" alt=\"\"></p><p>åœ¨reduceå½“ä¸­ï¼Œæœ‰ä¸€ä¸ª<strong>ç¼©å‡å™¨ï¼ˆreducerï¼‰</strong>å‡½æ•°å’Œä¸€ä¸ªåˆå§‹å€¼ã€‚æ¯”å¦‚åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œåˆå§‹å€¼æ˜¯3ï¼Œreducerå‡½æ•°ä¼šè®¡ç®—3ä¹˜ä»¥5çš„ç»“æœï¼Œå†ä¹˜ä»¥10ï¼Œå¾—å‡ºçš„ç»“æœå†ä¹˜ä»¥15ï¼Œæœ€åå½’ä¸ºä¸€ä¸ªç»“æœ2250ã€‚</p><pre><code class=\"language-javascript\">[5,10,15].reduce( (arr,val) =&gt; arr * val, 3 ); // 2250\n</code></pre><p>è€Œç¼©å‡reduceé™¤äº†èƒ½ç‹¬ç«‹æ¥å®ç°ä»¥å¤–ï¼Œä¹Ÿå¯ä»¥ç”¨æ˜ å°„mapå’Œè¿‡æ»¤filterçš„æ–¹æ³•æ¥å®ç°ã€‚è¿™æ˜¯å› ä¸º <strong>reduceçš„åˆå§‹å€¼å¯ä»¥æ˜¯ä¸€ä¸ªç©ºæ•°ç»„[]</strong>ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æŠŠè¿­ä»£çš„ç»“æœå½“æˆå¦ä¸€ä¸ªæ•°ç»„äº†ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><pre><code class=\"language-javascript\">var half = v =&gt; v / 2;\n[2,4,6,8,10].map( half ); // [1,2,3,4,5]\n\n[2,4,6,8,10].reduce(\n    (list,v) =&gt; (\n        list.push( half( v ) ),\n        list\n    ), []\n); // [1,2,3,4,5]\n\n\n\nvar isEven = v =&gt; v % 2 == 0;\n[1,2,3,4,5].filter( isEven ); // [2,4]\n\n[1,2,3,4,5].reduce(\n    (list,v) =&gt; (\n        isEven( v ) ? list.push( v ) : undefined,\n        list\n    ), []\n); // [2,4]\n</code></pre><p>å¯ä»¥å‘ç°ï¼Œè¿™é‡Œæˆ‘æ•…æ„åˆ©ç”¨äº†ä¸€ä¸ªå‰¯ä½œç”¨ã€‚é€šè¿‡ç¬¬ä¸€èŠ‚è¯¾çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“array.pushæ˜¯ä¸€ä¸ªéçº¯å‡½æ•°çš„æ–¹æ³•ï¼Œå®ƒæ”¹å˜äº†åŸæ•°ç»„ï¼Œè€Œä¸æ˜¯å¤åˆ¶åä¿®æ”¹ã€‚è€Œå¦‚æœæˆ‘ä»¬æƒ³å®Œå…¨é¿å…å‰¯ä½œç”¨ï¼Œå¯ä»¥ç”¨concatã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¹ŸçŸ¥é“concatè™½ç„¶éµå¾ªçš„æ˜¯çº¯å‡½æ•°ã€ä¸å¯å˜çš„åŸåˆ™ï¼Œä½†æ˜¯æœ‰ä¸€ç‚¹æ˜¯æˆ‘ä»¬éœ€è¦æ³¨æ„çš„ï¼Œå°±æ˜¯å®ƒåœ¨é¢å¯¹å¤§é‡çš„å¤åˆ¶å’Œä¿®æ”¹æ—¶ä¼šäº§ç”Ÿæ€§èƒ½ä¸Šçš„é—®é¢˜ã€‚æ‰€ä»¥ä¼°è®¡åˆ°è¿™é‡Œï¼Œä½ ä¹ŸçŒœåˆ°äº†åœ¨ä¸ŠèŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬æåˆ°çš„transducerçš„åŸç†äº†ã€‚</p><p>æ˜¯çš„ï¼Œè¿™é‡Œæˆ‘ä»¬å°±æ˜¯æ•…æ„åˆ©ç”¨äº†å‰¯ä½œç”¨æ¥æé«˜æ€§èƒ½ï¼</p><p>ä½ æˆ–è®¸ä¼šè®¤ä¸ºï¼Œè¿™æ ·æ˜¯ä¸æ˜¯å°±è¿èƒŒäº†çº¯å‡½æ•°å’Œä¸å¯å˜çš„åŸåˆ™ï¼Ÿå®é™…ä¸Šæ˜¯ä¹Ÿä¸æ˜¯ï¼Œå› ä¸ºåœ¨åŸåˆ™ä¸Šï¼Œæˆ‘ä»¬åšçš„è¿™äº›å˜åŒ–éƒ½æ˜¯åœ¨å‡½æ•°å†…éƒ¨çš„ï¼Œè€Œæˆ‘åœ¨å‰é¢è¯´è¿‡ï¼Œ<strong>éœ€è¦æ³¨æ„çš„å‰¯ä½œç”¨ä¸€èˆ¬å¤šæ˜¯æ¥è‡ªå¤–éƒ¨</strong>ã€‚</p><p>æ‰€ä»¥åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰å¿…è¦ä¸ºäº†å‡ ä¹æ²¡æœ‰è´Ÿé¢å½±å“çš„å‰¯ä½œç”¨è€Œç‰ºç‰²æ€§èƒ½ã€‚è€Œtransduceræ­£æ˜¯åˆ©ç”¨äº†å‰¯ä½œç”¨ï¼Œæ‰åšåˆ°çš„æ€§èƒ½æå‡ã€‚</p><h2>å•å­monad</h2><p>å¥½ï¼Œç°åœ¨è®©æˆ‘ä»¬å›åˆ°è¯¾ç¨‹ä¸€å¼€å§‹æåˆ°çš„é—®é¢˜ï¼šmonadå’Œfunctoræœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p><p>åœ¨<a href=\"https://time.geekbang.org/column/article/572257\">å¼€ç¯‡è¯</a>æˆ‘ä»¬ä¹Ÿæåˆ°è¿‡ï¼Œå‡½å­ï¼ˆfunctorï¼‰å…¶å®å°±æ˜¯ä¸€ä¸ªå€¼å’Œå›´ç»•å€¼çš„ä¸€äº›åŠŸèƒ½ã€‚æ‰€ä»¥æˆ‘ä»¬çŸ¥é“ï¼Œarray.mapå¯ä»¥è¢«çœ‹åšæ˜¯ä¸€ä¸ªfunctorï¼Œå®ƒæœ‰ä¸€ç»„å€¼ï¼Œè€Œå¦‚mapè¿™æ ·çš„æ–¹æ³•å¯ä»¥ä½œç”¨äºæ•°ç»„é‡Œé¢çš„æ¯ä¸€ä¸ªå€¼ï¼Œæä¾›äº†ä¸€ä¸ªæ˜ å°„çš„åŠŸèƒ½ã€‚è€Œmonadå°±æ˜¯åœ¨functorçš„åŸºç¡€ä¸Šï¼Œåˆå¢åŠ äº†ä¸€äº›ç‰¹æ®ŠåŠŸèƒ½ï¼Œå…¶ä¸­æœ€å¸¸è§çš„å°±æ˜¯ <strong>chainå’Œåº”ç”¨å‡½å­ï¼ˆapplicative)</strong>ã€‚ä¸‹é¢æˆ‘å°±å¸¦ä½ å…·ä½“çœ‹çœ‹ã€‚</p><h3><strong>arrayä½œä¸ºfunctor</strong></h3><p>å‰é¢æˆ‘ä»¬è¯´è¿‡ï¼Œarray.mapå°±æ˜¯ä¸€ä¸ªå‡½å­ï¼Œå®ƒæœ‰ä¸€ä¸ªè‡ªå¸¦çš„åŒ…è£…å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡æœ‰ç±»ä¼¼mapè¿™æ ·çš„æ˜ å°„åŠŸèƒ½ã€‚é‚£ä¹ˆåŒæ ·åœ°ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å†™ä¸€ä¸ªå¸¦æœ‰æ˜ å°„æ–¹æ³•çš„Just Monadï¼Œç”¨å®ƒæ¥åŒ…è£…ä¸€ä¸ªå€¼ï¼ˆvalï¼‰ã€‚è¿™ä¸ªæ—¶å€™ï¼Œmonadç›¸å½“äºæ˜¯ä¸€ä¸ªåŸºäºå€¼å½¢æˆçš„æ–°çš„æ•°æ®ç»“æ„ï¼Œè¿™ä¸ªæ•°æ®ç»“æ„é‡Œæœ‰mapçš„æ–¹æ³•å‡½æ•°ã€‚</p><pre><code class=\"language-javascript\">function Just(val) {\n    return { map };\n\n    function map(fn) { return Just( fn( val ) ); }\n\n}\n</code></pre><p>å¯è§ï¼Œå®ƒçš„ä½¿ç”¨æ–¹å¼å°±ç±»ä¼¼äºæˆ‘ä»¬ä¹‹å‰çœ‹åˆ°çš„array.mapæ˜ å°„ã€‚æ¯”å¦‚åœ¨ä¸‹é¢çš„ä¾‹å­é‡Œï¼Œæˆ‘ä»¬ç”¨mapå°†ä¸€ä¸ªå‡½æ•° v =&gt; v * 2 è¿ç”¨åˆ°äº†Just monadå°è£…çš„å€¼10ä¸Šï¼Œå®ƒè¿”å›çš„å°±æ˜¯20ã€‚</p><pre><code class=\"language-javascript\">var A = Just( 10 );\nvar B = A.map( v =&gt; v * 2 ); // 20\n</code></pre><h3><strong>chain</strong>ä½œä¸ºbindã€flatMap</h3><p>å†æ¥è¯´è¯´chainã€‚</p><p>chainé€šå¸¸åˆå«åšflatMapæˆ–bindï¼Œå®ƒçš„ä½œç”¨æ˜¯flattenæˆ–unwrapï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒå¯ä»¥å±•å¼€è¢«Justå°è£…çš„å€¼valã€‚ä½ å¯ä»¥ä½¿ç”¨chainå°†ä¸€ä¸ªå‡½æ•°ä½œç”¨åˆ°ä¸€ä¸ªåŒ…è£…çš„å€¼ä¸Šï¼Œè¿”å›ä¸€ä¸ªç»“æœå€¼ã€‚å¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p><pre><code class=\"language-javascript\">function Just(val) {\n    return { map, chain };\n    \n    function map(fn) { return Just( fn( val ) ); }\n   \n     // aka: bind, flatMap\n    function chain(fn) { return fn( val ); }\n}\n</code></pre><p>æˆ‘å†ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬ç”¨chainæ–¹æ³•å‡½æ•°æŠŠä¸€ä¸ªåŠ ä¸€çš„å‡½æ•°ä½œä¸ºå‚æ•°è¿ç”¨åˆ°monad Aä¸Šï¼Œå¾—åˆ°äº†ä¸€ä¸ª 15+1=16 çš„ç»“æœï¼Œé‚£ä¹ˆä¹‹åè¿”å›çš„å°±æ˜¯ä¸€ä¸ªflattenæˆ–unwrapå±•å¼€çš„16äº†ã€‚</p><pre><code class=\"language-javascript\">var A = Just( 15 );\nvar B = A.chain( v =&gt; v + 1 );\n\nB;          // 16\ntypeof B;   // \"number\"\n</code></pre><h3><strong>monoid</strong></h3><p>OKï¼Œæ—¢ç„¶è¯´åˆ°äº†chainï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹ä¸€ä¸‹monoidã€‚</p><p>åœ¨ä¸ŠèŠ‚è¯¾æˆ‘ä»¬è¯´è¿‡å‡½æ•°ç»„åˆcompostionã€‚è€Œåœ¨ç»„åˆé‡Œï¼Œæœ‰ä¸€ä¸ªæ¦‚å¿µå°±æ˜¯ç­¾åä¸€è‡´æ€§çš„é—®é¢˜ã€‚ä¸¾ä¸ªä¾‹å­å¦‚æœå‰ä¸€ä¸ªå‡½æ•°è¿”å›äº†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåä¸€ä¸ªå‡½æ•°æ¥æ”¶çš„è¾“å…¥æ˜¯æ•°å­—ï¼Œé‚£ä¹ˆå®ƒä»¬æ˜¯æ²¡åŠæ³•ç»„åˆçš„ã€‚æ‰€ä»¥ï¼Œcomposeå‡½æ•°æ¥æ”¶çš„å‡½æ•°éƒ½è¦ç¬¦åˆä¸€è‡´æ€§çš„ fn :: v -&gt; v å‡½æ•°ç­¾åï¼Œä¹Ÿå°±æ˜¯è¯´å‡½æ•°æ¥æ”¶çš„å‚æ•°å’Œè¿”å›çš„å€¼ç±»å‹è¦ä¸€æ ·ã€‚</p><p>é‚£ä¹ˆï¼Œæ»¡è¶³è¿™äº›ç±»å‹ç­¾åçš„å‡½æ•°å°±ç»„æˆäº† <strong>monoid</strong>ã€‚çœ‹åˆ°è¿™ä¸ªå…¬å¼ä½ æ˜¯ä¸æ˜¯è§‰å¾—å¾ˆçœ¼ç†Ÿï¼Ÿæ²¡é”™ï¼Œå®ƒçš„æ¦‚å¿µå°±æ˜¯åŸºäºæˆ‘ä»¬ä¹‹å‰è¯´åˆ°è¿‡çš„ <strong>identityå‡½æ•°</strong>ã€‚åœ¨TypeScriptä¸­ï¼Œidentityä¹Ÿæ˜¯æ³›å‹ä½¿ç”¨ä¸­çš„ä¸€ä¸ªä¾‹å­ã€‚æ¯”å¦‚åœ¨C#å’ŒJavaè¿™æ ·çš„è¯­è¨€ä¸­ï¼Œæ³›å‹å¯ä»¥ç”¨æ¥åˆ›å»ºå¯é‡ç”¨çš„ç»„ä»¶ï¼Œä¸€ä¸ªç»„ä»¶å¯ä»¥æ”¯æŒå¤šç§ç±»å‹çš„æ•°æ®ã€‚ è¿™æ ·ç”¨æˆ·å°±å¯ä»¥ä»¥è‡ªå·±çš„æ•°æ®ç±»å‹æ¥ä½¿ç”¨ç»„ä»¶ã€‚å®ƒçš„åŸºæœ¬åŸç†ä¹Ÿæ˜¯åŸºäºè¿™æ ·çš„ä¸€ä¸ªidentityå‡½æ•°ã€‚</p><pre><code class=\"language-javascript\">function identity&lt;T&gt;(arg: T): T {\n    return arg;\n}\n</code></pre><p>identityåœ¨monadä¸­æœ‰ä¸€ä¸ªç”¨å¤„ï¼Œå°±æ˜¯å¦‚æœæŠŠidentityä½œä¸ºä¸€ä¸ªå‚æ•°ï¼Œå¯ä»¥èµ·åˆ°<strong>è§‚å¯Ÿinspectçš„ä½œç”¨</strong>ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å…ˆç”¨Justæ¥å°è£… 15 è¿™ä¸ªå€¼ï¼Œç„¶åè°ƒç”¨chainçš„æ–¹æ³•æ—¶ï¼ŒæŠŠidentityä½œä¸ºå‚æ•°ï¼Œè¿”å›çš„å°±æ˜¯ä¸€ä¸ªflattenæˆ–unwrapå±•å¼€çš„15ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œå®ƒä¹Ÿè¿™é‡Œä¹Ÿèµ·åˆ°äº†ä¸€ä¸ªlogçš„ä½œç”¨ã€‚</p><pre><code class=\"language-javascript\">var A = Just( 15 );\nA.chain (identity) // è¿”å› 15\n</code></pre><h3><strong>applicative</strong></h3><p>æœ€åï¼Œæˆ‘ä»¬å†æ¥çœ‹åº”ç”¨å‡½å­ï¼ˆapplicativeï¼‰ï¼Œç®€ç§°apã€‚</p><p>apçš„ä½œç”¨å…¶å®ä¹Ÿå¾ˆç®€å•ã€‚åº”ç”¨å‡½å­ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒçš„ä½œç”¨æ˜¯å¯ä»¥æŠŠä¸€ä¸ªå°è£…è¿‡çš„å‡½æ•°åº”ç”¨åˆ°ä¸€ä¸ªåŒ…è£…è¿‡çš„å€¼ä¸Šã€‚</p><pre><code class=\"language-javascript\">function Just(val) {\n    return { map, ap };\n\n    function map(fn) { return Just( fn( val ) ); }\n\n    function ap(anotherMonad) { return anotherMonad.map( val ); }\n\n}\n</code></pre><p>å†æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå¯ä»¥çœ‹åˆ°ï¼ŒapæŠŠmonad Bé‡Œçš„å€¼å–å‡ºæ¥ï¼Œé€šè¿‡monad Açš„æ˜ å°„æŠŠå®ƒåº”ç”¨åˆ°äº†monad Aä¸Šã€‚å› ä¸ºæ˜ å°„æ¥å—çš„å€¼ç±»å‹æ˜¯å‡½æ•°ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¼ å…¥çš„æ˜¯æŸ¯é‡ŒåŒ–çš„addå‡½æ•°ï¼Œå®ƒå…ˆé€šè¿‡é—­åŒ…çš„è®°å¿†åŠŸèƒ½ï¼Œè®°ä½ç¬¬ä¸€ä¸ªå‚æ•°6ï¼Œä¹‹åå†åŠ ä¸Šä¼ å…¥çš„10ï¼Œæœ€åè¾“å‡ºçš„ç»“æœå°±æ˜¯16ã€‚</p><pre><code class=\"language-javascript\">var A = Just( 6 );\nvar B = Just( 10 );\n\nfunction add(x,y) { return x + y; }\n\nvar C = A.map( curry( add ) ).ap( B );\n\nC.chain(identity); // è¿”å› 16\n</code></pre><p>å¦‚æœæˆ‘ä»¬æŠŠä¸Šé¢å‡ ä¸ªåŠŸèƒ½åŠ åœ¨ä¸€èµ·ï¼Œå…¶å¤§è‡´å®ç°å°±å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-javascript\">function Just(val) {\n    return { map, chain, ap, log };\n\n    // *********************\n\n    function map(fn) { return Just( fn( val ) ); }\n\n    // aka: bind, flatMap\n    function chain(fn) { return fn( val ); }\n\n    function ap(anotherMonad) { return anotherMonad.map( val ); }\n\n    function log() {\n        return `simpleMonad(${ val })`;\n    }\n}\n</code></pre><p>è¯´åˆ°å‡½å­å’Œåº”ç”¨å‡½å­ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹ä¸€ä¸‹ï¼Œåœ¨æ•°ç»„ä¸­ï¼Œæœ‰ä¸€ä¸ªarray.ofçš„å·¥å‚æ–¹æ³•ï¼Œå®ƒçš„ä½œç”¨æ˜¯æ¥æ”¶ä¸€ç»„å‚æ•°ï¼Œå½¢æˆä¸€ä¸ªæ–°æ•°ç»„ã€‚</p><pre><code class=\"language-javascript\">var arr = Array.of(1,2,3,4,5); // è¿”å›ï¼š[1,2,3,4,5]\n</code></pre><p>åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç§°å®ç°äº†ofå·¥å‚æ–¹æ³•çš„å‡½å­æ˜¯pointedå‡½å­ã€‚é€šè¿‡pointedå‡½å­ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸€ç»„å€¼æ”¾åˆ°äº†ä¸€ä¸ªæ•°ç»„çš„å®¹å™¨ä¸­ï¼Œä¹‹åè¿˜å¯ä»¥é€šè¿‡æ˜ å°„å‡½å­å¯¹æ¯ä¸ªå€¼åšæ˜ å°„ã€‚è€Œåº”ç”¨å‡½å­ï¼Œï¼ˆapplicative functorï¼‰å°±æ˜¯å®ç°äº†åº”ç”¨æ–¹æ³•çš„pointedå‡½å­ã€‚</p><h2>æ€»ç»“</h2><p>ä»Šå¤©è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å‡½æ•°å¼ç¼–ç¨‹ä¸­é’ˆå¯¹æ•°ç»„çš„å‡ ä¸ªæ ¸å¿ƒæ“ä½œï¼Œè§£ç­”äº†ä¸ŠèŠ‚è¯¾ä¸­çš„å¦‚ä½•é€šè¿‡æ˜ å°„å’Œè¿‡æ»¤åšåˆ°reduceçš„é—®é¢˜ï¼ŒåŒæ—¶ä¹Ÿæ›´æ·±å…¥åœ°ç†è§£äº†reducerå’Œtransduceçš„åŸç†ã€‚</p><p>å¹¶ä¸”ç°åœ¨æˆ‘ä»¬çŸ¥é“ï¼Œarray.mapå…¶å®å°±æ˜¯ä¸€ä¸ªfunctorï¼Œå®ƒåŒ…å«äº†mapåŠŸèƒ½ï¼Œå¯ä»¥å›´ç»•ä¸€ä¸ªæ•°ç»„ä¸­çš„æ¯ä¸ªå€¼è¿›è¡Œæ“ä½œï¼Œè¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„ã€‚è€Œmonadå¯ä»¥è¯´æ˜¯åŸºäºå‡½å­å¢åŠ äº†ä¸€äº›ç‰¹æ®Šçš„åŠŸèƒ½ã€‚å½“ç„¶äº†ï¼Œä¸åŒçš„monadä¹Ÿå¯ä»¥ç›¸äº’ç»„åˆï¼Œæ¯”å¦‚juståŠ ä¸Šnothingï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç©ºå€¼å•å­ï¼Œå¯ä»¥ç»„æˆmaybe monadæ¥å¤„ç†ç©ºå€¼çš„å¼‚å¸¸ã€‚</p><p>å¦å¤–è¯´åˆ°äº†å‡½å­å’Œå•å­ï¼Œåœ¨å‡½æ•°å¼ç¼–ç¨‹å½“ä¸­å…¶å®è¿˜æœ‰eitherã€IOä¹‹ç±»çš„æ¦‚å¿µã€‚å…¶ä¸­eitheræ˜¯ç”¨æ¥ä»£æ›¿æ¯”å¦‚if elseæˆ–è€…æ˜¯try catchçš„æ¡ä»¶è¿ç®—ï¼Œå®ƒçš„valueé‡Œä¿å­˜çš„æ˜¯ä¸€ä¸ªå€¼ï¼›è€ŒIOå¯ä»¥ç”¨æ¥å»¶è¿Ÿå‡½æ•°çš„æ‰§è¡Œï¼Œå®ƒçš„valueé‡Œé¢å­˜å‚¨çš„æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚è¿™é‡Œæˆ‘å°±ä¸å¤šè¯´äº†ï¼Œæ„Ÿå…´è¶£çš„è¯ï¼Œä½ ä¹Ÿå¯ä»¥å»æ·±å…¥äº†è§£ä¸‹ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>ä»å‡½æ•°å¼ç¼–ç¨‹çš„æ€ç»´è§†è§’æ¥çœ‹ï¼Œä½ è§‰å¾—JavaScriptä¸­çš„promiseç®—æ˜¯monadå—ï¼Ÿ</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„æ€è€ƒå’Œç­”æ¡ˆï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠä»Šå¤©çš„å†…å®¹åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ã€‚</p>","neighbors":{"left":{"article_title":"04 | å¦‚ä½•é€šè¿‡ç»„åˆã€ç®¡é“å’Œreducerè®©å‡½æ•°æŠ½è±¡åŒ–ï¼Ÿ","id":574783},"right":{"article_title":"06 | å¦‚ä½•é€šè¿‡æ¨¡å—åŒ–ã€å¼‚æ­¥å’Œè§‚å¯Ÿåšåˆ°åŠ¨æ€åŠ è½½ï¼Ÿ","id":577550}},"comments":[{"had_liked":false,"id":360697,"user_name":"æ€æ–‡","can_delete":false,"product_type":"c1","uid":1304612,"ip_address":"åŒ—äº¬","ucode":"7CF055E67AE1FE","user_header":"https://static001.geekbang.org/account/avatar/00/13/e8/24/a75dae31.jpg","comment_is_top":false,"comment_ctime":1666766044,"is_pvip":false,"replies":[{"id":131923,"content":"Jack Widmanå†™çš„ã€ŠLearning Functional Programmingã€‹æ˜¯ä¸€æœ¬ä¸é”™çš„å…¥é—¨è¯»ç‰©ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2785919,"ctime":1668851434,"ip_address":"åŒ—äº¬","comment_id":360697,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100122101,"comment_content":"å•å­ã€å‡½å­è¿™äº›æ„Ÿå¿µçœ‹å®Œè¿˜æ˜¯æœ‰äº›é™Œç”Ÿï¼Œæœ‰ä»€ä¹ˆåŠæ³•æ·±å…¥ç†è§£ä¸‹å—ï¼Œæ¯”å¦‚éœ€è¦çœ‹é‚£äº›æ–‡ç« ç­‰ç­‰","like_count":4,"discussions":[{"author":{"id":2785919,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/82/7f/c22de3a3.jpg","nickname":"çŸ³å·","note":"","ucode":"99E480A265E25F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":594178,"discussion_content":"Jack Widmanå†™çš„ã€ŠLearning Functional Programmingã€‹æ˜¯ä¸€æœ¬ä¸é”™çš„å…¥é—¨è¯»ç‰©ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668851434,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1389223,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/icOEvL2EQ0a1GcHWykgicVq5iaAHYf29LfRLtyibtj1EIepUd9kNnrPQEzb5xsA8bbIl0ibz0MWUN37UNvDesARR3LQ/132","nickname":"å°é»‘","note":"","ucode":"04CBDEB341A5CA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":594514,"discussion_content":"å¯ä»¥çœ‹ä¸€ä¸‹ æ­é™½ç¹¼è¶…çš„ https://blog.oyanglul.us/grokking-monad/part1 ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1669109302,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸­å›½å°æ¹¾","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1580358,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/ZMALpD4bKCVdsx8ymCC5Oo0oxibxIFGQzT6fP2B8MEgLGLktQRX4ictobkbcNBDTQibjoQNKBmWCKomNibWqHZ5kpg/132","nickname":"Long","note":"","ucode":"D85B99FD0C4B76","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":624607,"discussion_content":"æˆ‘ä¹Ÿæ˜¯çœ‹çš„äº‘é‡Œé›¾é‡Œçš„ï¼Œä¸çŸ¥é“åœ¨è¯´äº›å•¥ã€‚ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1690773348,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ—¥æœ¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2100301,"avatar":"https://static001.geekbang.org/account/avatar/00/20/0c/4d/90ab20d8.jpg","nickname":"Nuvole Bianche","note":"","ucode":"3C059A454C16C7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":599929,"discussion_content":"åŒæ ·çš„æƒ…å†µï¼Œæœ‰ä¸€ç‚¹æ„Ÿè§‰å¯¹å°ç™½ä¸ç®—å‹å¥½ã€‚ä¸ªäººå®Œå…¨ç¬¬ä¸€æ¬¡å¬è¯´å•å­ã€å‡½å­ã€‚ä¹Ÿæ˜¯æˆ‘ä¸ªäººèœçš„åŸå› æœ‰ä¸€éƒ¨åˆ†åŸå› ã€‚åŒæ—¶å¸Œæœ›ä½œè€…å¤§å¤§èƒ½ç®€å•è®²è®²è¦ç†è§£æ–‡ä¸­è¿™äº›è¯æ±‡æˆ–è€…æ›´å¥½çš„ç†è§£æ–‡ç« ï¼ŒæœŸæœ›è¯»è€…æœ‰å“ªäº›å‰ç½®çŸ¥è¯†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673871995,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":359979,"user_name":"Yum.X","can_delete":false,"product_type":"c1","uid":1750038,"ip_address":"åŒ—äº¬","ucode":"B95A118133CAB1","user_header":"https://static001.geekbang.org/account/avatar/00/1a/b4/16/f3c36fd8.jpg","comment_is_top":false,"comment_ctime":1666095226,"is_pvip":false,"replies":[{"id":131623,"content":"å¦‚æœè¦â€œæ‰“å°â€ç»“æœçš„è¯ï¼Œå¯ä»¥åŠ ä¸€ä¸ªæ–¹æ³•ï¼š\nfunction Just(val) {\n  return { map, log };\n  function log() {\n    return `Just(${ val })`;\n  }\n}\nB.log(); &#47;&#47; 20","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2785919,"ctime":1667957129,"ip_address":"åŒ—äº¬","comment_id":359979,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100122101,"comment_content":"\nfunction Just(val) {\n    return { map };\n\n    function map(fn) { return Just( fn( val ) ); }\n\n}\nvar A = Just( 10 );\nvar B = A.map( v =&gt; v * 2 ); &#47;&#47; 20\n\nè¿è¡Œäº†è¿™æ®µä»£ç ï¼Œè¿™é‡Œå›çš„ä¸æ˜¯20","like_count":1,"discussions":[{"author":{"id":2785919,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/82/7f/c22de3a3.jpg","nickname":"çŸ³å·","note":"","ucode":"99E480A265E25F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593099,"discussion_content":"å¦‚æœè¦â€œæ‰“å°â€ç»“æœçš„è¯ï¼Œå¯ä»¥åŠ ä¸€ä¸ªæ–¹æ³•ï¼š\nfunction Just(val) {\n  return { map, log };\n  function log() {\n    return `Just(${ val })`;\n  }\n}\nB.log(); // 20","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667957129,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2100301,"avatar":"https://static001.geekbang.org/account/avatar/00/20/0c/4d/90ab20d8.jpg","nickname":"Nuvole Bianche","note":"","ucode":"3C059A454C16C7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2785919,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/82/7f/c22de3a3.jpg","nickname":"çŸ³å·","note":"","ucode":"99E480A265E25F","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":599932,"discussion_content":"é‚£è¿™ç§æƒ…å†µè¿˜æ˜¯å»ºè®®ä½œè€…æ‚¨èƒ½åœ¨æ–‡ä¸­è¡¥ä¸Šå§ï¼Œæ³¨é‡Šä¸€ä¸ª20ï¼Œç»“æœæœ‰æ‰“å°ä¸å‡ºæ¥ï¼Œä¸€æ—¶æ‘¸ä¸ç€å¤´è„‘ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673874511,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":593099,"ip_address":"ä¸Šæµ·","group_id":0},"score":599932,"extra":""}]},{"author":{"id":1862271,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/nvWeOicPyIbAVkQnt4omOibkzZpG3AxSKy5CH1LicumpucX8hp4gZVSicKm1wnua6uuCRbHdXibh4FQLqLskqtoKiagg/132","nickname":"hsiang271828","note":"","ucode":"5453512A953D0A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591639,"discussion_content":"è¿™é‡ŒBæ—¶Justå‡½æ•°ï¼Œéœ€è¦ç”¨chainæˆ–å…¶ä»–æ–¹æ³•æ‰“å°å‡ºæ¥å€¼æ‰å¯ä»¥çœ‹åˆ°","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1666745844,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":363959,"user_name":"lin","can_delete":false,"product_type":"c1","uid":1444416,"ip_address":"æµ·å—","ucode":"F58E65807B71C5","user_header":"https://static001.geekbang.org/account/avatar/00/16/0a/40/cf70b198.jpg","comment_is_top":false,"comment_ctime":1670395347,"is_pvip":false,"replies":[{"id":133051,"content":"è¦ä½¿ç”¨apçš„è¯ï¼Œmonad ä¸­éœ€è¦æŒæœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”è¿™ä¸ªå‡½æ•°åº”è¯¥è¦æŒæœ‰å¹¶è®°ä½ a çš„å˜é‡ã€‚æˆ‘çœ‹ä¸åˆ°ä½ çš„ addFive() çš„å…·ä½“å®ç°ï¼Œä½†æ˜¯é€šå¸¸ a.map() ä¸­åº”è¯¥æ˜¯ä¸€ä¸ª curry(func)ï¼Œä¾‹å¦‚ï¼ša.map(curry(func))ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2785919,"ctime":1672313141,"ip_address":"æµ·å—","comment_id":363959,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100122101,"comment_content":"ap è¿™é‡Œæˆ‘è¿˜æ˜¯ä¸å¤ªç†è§£ã€‚æ ¹æ® expï¼š\nã€ã€ã€\nconst a = Just(1); &#47;&#47; Just(1)\nconst b = Just(2); &#47;&#47; Just(2)\nconst c = a.map(addFive); &#47;&#47; Just(6)\n\nc.ap(b); &#47;&#47; Error: Just(6(2)) -&gt; 6 is not a function\nã€ã€ã€\n\nè¿™é‡Œçš„è°ƒç”¨åº”è¯¥ä¼šå‡ºç°é—®é¢˜ã€‚","like_count":0,"discussions":[{"author":{"id":2785919,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/82/7f/c22de3a3.jpg","nickname":"çŸ³å·","note":"","ucode":"99E480A265E25F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597907,"discussion_content":"è¦ä½¿ç”¨apçš„è¯ï¼Œmonad ä¸­éœ€è¦æŒæœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”è¿™ä¸ªå‡½æ•°åº”è¯¥è¦æŒæœ‰å¹¶è®°ä½ a çš„å˜é‡ã€‚æˆ‘çœ‹ä¸åˆ°ä½ çš„ addFive() çš„å…·ä½“å®ç°ï¼Œä½†æ˜¯é€šå¸¸ a.map() ä¸­åº”è¯¥æ˜¯ä¸€ä¸ª curry(func)ï¼Œä¾‹å¦‚ï¼ša.map(curry(func))ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672313141,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æµ·å—","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361994,"user_name":"æœ±åŸº","can_delete":false,"product_type":"c1","uid":3198418,"ip_address":"æµ·å—","ucode":"E4BDC177B6FCC8","user_header":"https://static001.geekbang.org/account/avatar/00/30/cd/d2/f9528a87.jpg","comment_is_top":false,"comment_ctime":1668050090,"is_pvip":false,"replies":[{"id":133083,"content":"ä¹‹å‰æœ‰äº›å‹˜è¯¯ï¼Œå·²ç»ä¿®æ”¹äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2785919,"ctime":1672408265,"ip_address":"æµ·å—","comment_id":361994,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100122101,"comment_content":"åœ¨â€œreduce å’Œç¼©å‡å™¨â€è¿™ä¸€èŠ‚çš„è¯¾ç¨‹é‡Œï¼Œçªç„¶æ˜¾ç¤ºäº†ä¸€ä»£ç ç¤ºä¾‹ï¼Œvar getSessionId = partial( prop, &quot;sessId&quot; );â€¦if (orders != null) processOrders( orders ); å®ƒæ˜¯ç”¨æ¥è¯´æ˜ä¸Šé¢æ‰€è¯´çš„ï¼šâ€œæˆ‘ä»¬æ²¡æœ‰å¿…è¦ä¸ºäº†å‡ ä¹æ²¡æœ‰è´Ÿé¢å½±å“çš„å‰¯ä½œç”¨â€”æ”¹å˜äº†åŸæ•°æ®ï¼Œè€Œç‰ºç‰²æ€§èƒ½â€çš„å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2785919,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/82/7f/c22de3a3.jpg","nickname":"çŸ³å·","note":"","ucode":"99E480A265E25F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598005,"discussion_content":"ä¹‹å‰æœ‰äº›å‹˜è¯¯ï¼Œå·²ç»ä¿®æ”¹äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672408265,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æµ·å—","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":359158,"user_name":"ææ»¨","can_delete":false,"product_type":"c1","uid":1848099,"ip_address":"åŒ—äº¬","ucode":"CCEE1312C9F6A7","user_header":"https://static001.geekbang.org/account/avatar/00/1c/33/23/1b8acb62.jpg","comment_is_top":false,"comment_ctime":1665295367,"is_pvip":false,"replies":[{"id":130630,"content":"è¿™é‡Œæ²¡å•¥é—®é¢˜ã€‚æ˜ å°„åï¼Œè¿”å›ä¹‹åçš„ä¹Ÿåº”è¯¥æ˜¯ä¸€ä¸ªJuståŒ…è£…çš„å€¼ã€‚\nä¾‹å¦‚ï¼š\nvar A = Just( 30 ); \nvar B = A.map( v =&gt; v * 2 ); &#47;&#47; Just(60)","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":2785919,"ctime":1665310691,"ip_address":"åŒ—äº¬","comment_id":359158,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100122101,"comment_content":"array ä½œä¸º functor å°èŠ‚ä¸‹é¢çš„é‚£ä¸ªä¾‹å­ : Just return çš„mapå‡½æ•°çš„å®šä¹‰ä¸å¯¹å§ ï¼Œmapåº”è¯¥ç›´æ¥è¿”å› fn(val)å§ï¼Ÿ ","like_count":0,"discussions":[{"author":{"id":2785919,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/82/7f/c22de3a3.jpg","nickname":"çŸ³å·","note":"","ucode":"99E480A265E25F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589797,"discussion_content":"è¿™é‡Œæ²¡å•¥é—®é¢˜ã€‚æ˜ å°„åï¼Œè¿”å›ä¹‹åçš„ä¹Ÿåº”è¯¥æ˜¯ä¸€ä¸ªJuståŒ…è£…çš„å€¼ã€‚\nä¾‹å¦‚ï¼š\nvar A = Just( 30 ); \nvar B = A.map( v =&gt; v * 2 ); // Just(60)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665310691,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1288733,"avatar":"https://static001.geekbang.org/account/avatar/00/13/aa/1d/b8fdd622.jpg","nickname":"laoergege","note":"","ucode":"559CCF36805A04","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590454,"discussion_content":"ä¼°è®¡ä½ è·Ÿæˆ‘ä¸€æ ·ï¼Œä»¥ä¸ºå•å­å°±æ˜¯ map è¿”å›æ–°çš„å•å­ã€‚å•å­å…¶å®æ˜¯æŠŠå‡½å­å¹³é“ºæ‹¿åˆ°å…¶å€¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665755072,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":366524,"user_name":"Nuvole Bianche","can_delete":false,"product_type":"c1","uid":2100301,"ip_address":"ä¸Šæµ·","ucode":"3C059A454C16C7","user_header":"https://static001.geekbang.org/account/avatar/00/20/0c/4d/90ab20d8.jpg","comment_is_top":false,"comment_ctime":1673875887,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100122101,"comment_content":"function Just(val) {\n  return { map, log };\n\n  function map(fn) {\n    return Just(fn(val));\n  }\n\n  function log() {\n    return `Just(${val})`;\n  }\n}\n\nvar A = Just(10);\n\nvar B = A.map((v) =&gt; v * 2); &#47;&#47; 20\nconsole.log(B.log());   &#47;&#47; Just(20)\nconsole.log(A.log());   &#47;&#47; Just(10)\n\n\nåå¤çœ‹åï¼Œæ³¨æ„åˆ°è¿™é‡Œå…¶å®ç”Ÿæˆäº†ä¸¤ä¸ªé—­åŒ…ï¼Œä¸€ä¸ªæ˜¯é’ˆå¯¹Açš„é—­åŒ…è¿™æ—¶valæ˜¯10ï¼ŒäºŒé’ˆå¯¹Bçš„é—­åŒ…ä¸­valå­˜æ”¾çš„æ˜¯20ã€‚ä½œä¸ºå°ç™½çš„çŸ¥é“è¿™ç§å†™æ³•éå¸¸nobilityï¼Œä½†ç°é˜¶æ®µçš„æˆ‘å®Œå…¨ä¸çŸ¥é“è¿™ç§å†™æ³•çš„å…·ä½“ä½¿ç”¨åœºæ™¯ã€‚","like_count":1},{"had_liked":false,"id":366248,"user_name":"æµ·ç»µè–‡è–‡","can_delete":false,"product_type":"c1","uid":1601296,"ip_address":"åŒ—äº¬","ucode":"37C7CC2EB81909","user_header":"https://static001.geekbang.org/account/avatar/00/18/6f/10/bfbf81dc.jpg","comment_is_top":false,"comment_ctime":1673507404,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100122101,"comment_content":"â€œè€Œç¼©å‡ reduce é™¤äº†èƒ½ç‹¬ç«‹æ¥å®ç°ä»¥å¤–ï¼Œä¹Ÿå¯ä»¥ç”¨æ˜ å°„ map å’Œè¿‡æ»¤ filter çš„æ–¹æ³•æ¥å®ç°ã€‚&quot;\n\nè¿™å¥è¯æ˜¯ä¸æ˜¯åäº†ğŸ¤£ï¼Œâ€mapå’Œfilteré™¤äº†èƒ½ç‹¬ç«‹å®ç°ä»¥å¤–ï¼Œä¹Ÿå¯ä»¥ç”¨reduceçš„æ–¹æ³•æ¥å®ç°ã€‚â€œè¿˜æ˜¯æˆ‘ç†è§£çš„æœ‰ç‚¹é—®é¢˜ğŸ¤£ã€‚","like_count":1},{"had_liked":false,"id":368191,"user_name":"è½©çˆ·","can_delete":false,"product_type":"c1","uid":1016658,"ip_address":"åŒ—äº¬","ucode":"1C59F6A4E7ABAE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/83/52/d67f276d.jpg","comment_is_top":false,"comment_ctime":1675995731,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100122101,"comment_content":"function Just(val) {\n    return { map };\n    function map(fn) { return fn( val ) ; }\n}\nvar A = Just( 10 );\nvar B = A.map( v =&gt; v * 2 );  &#47;&#47; 20\n\nfunction Just(val) { \n  return { map }; \n  function map(fn) { return Just( fn( val ) ); }\n}\n\nvar A = Just( 10 );\nvar B = A.map( v =&gt; v * 2 );  &#47;&#47; { map: f} ","like_count":0}]}