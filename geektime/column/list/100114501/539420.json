{"id":539420,"title":"22｜实战演练：玩转Kubernetes（2）","content":"<p>你好，我是Chrono。</p><p>我们的“中级篇”到今天马上就要结束了，感谢你这段时间坚持不懈的学习。</p><p>作为“中级篇”的收尾课程，我照例还是会对前面学过的内容做一个全面的回顾和总结，把知识点都串联起来，加深你对它们的印象。</p><p>下面我先梳理一下“中级篇”里讲过的Kubernetes知识要点，然后是实战演示，搭建WordPress网站。当然这次比前两次又有进步，不用Docker，也不用裸Pod，而是用我们新学习的Deployment、Service、Ingress等对象。</p><h2>Kubernetes技术要点回顾</h2><p>Kubernetes是云原生时代的操作系统，它能够管理大量节点构成的集群，让计算资源“池化”，从而能够自动地调度运维各种形式的应用。</p><p>搭建多节点的Kubernetes集群是一件颇具挑战性的工作，好在社区里及时出现了kubeadm这样的工具，可以“一键操作”，使用 <code>kubeadm init</code>、<code>kubeadm join</code> 等命令从无到有地搭建出生产级别的集群（<a href=\"https://time.geekbang.org/column/article/534762\">17讲</a>）。</p><p>kubeadm使用容器技术封装了Kubernetes组件，所以只要节点上安装了容器运行时（Docker、containerd等），它就可以自动从网上拉取镜像，然后以容器的方式运行组件，非常简单方便。</p><!-- [[[read_end]]] --><p>在这个更接近实际生产环境的Kubernetes集群里，我们学习了<strong>Deployment、DaemonSet、Service、Ingress、Ingress Controller</strong>等API对象。</p><p>（<a href=\"https://time.geekbang.org/column/article/535209\">18讲</a>）Deployment是用来管理Pod的一种对象，它代表了运维工作中最常见的一类在线业务，在集群中部署应用的多个实例，而且可以很容易地增加或者减少实例数量，从容应对流量压力。</p><p>Deployment的定义里有两个关键字段：一个是 <code>replicas</code>，它指定了实例的数量；另一个是 <code>selector</code>，它的作用是使用标签“筛选”出被Deployment管理的Pod，这是一种非常灵活的关联机制，实现了API对象之间的松耦合。</p><p>（<a href=\"https://time.geekbang.org/column/article/536803\">19讲</a>）DaemonSet是另一种部署在线业务的方式，它很类似Deployment，但会在集群里的每一个节点上运行一个Pod实例，类似Linux系统里的“守护进程”，适合日志、监控等类型的应用。</p><p>DaemonSet能够任意部署Pod的关键概念是“污点”（taint）和“容忍度”（toleration）。Node会有各种“污点”，而Pod可以使用“容忍度”来忽略“污点”，合理使用这两个概念就可以调整Pod在集群里的部署策略。</p><p>（<a href=\"https://time.geekbang.org/column/article/536829\">20讲</a>）由Deployment和DaemonSet部署的Pod，在集群中处于“动态平衡”的状态，总数量保持恒定，但也有临时销毁重建的可能，所以IP地址是变化的，这就为微服务等应用架构带来了麻烦。</p><p>Service是对Pod IP地址的抽象，它拥有一个固定的IP地址，再使用iptables规则把流量负载均衡到后面的Pod，节点上的kube-proxy组件会实时维护被代理的Pod状态，保证Service只会转发给健康的Pod。</p><p>Service还基于DNS插件支持域名，所以客户端就不再需要关心Pod的具体情况，只要通过Service这个稳定的中间层，就能够访问到Pod提供的服务。</p><p>（<a href=\"https://time.geekbang.org/column/article/538760\">21讲</a>）Service是四层的负载均衡，但现在的绝大多数应用都是HTTP/HTTPS协议，要实现七层的负载均衡就要使用Ingress对象。</p><p>Ingress定义了基于HTTP协议的路由规则，但要让规则生效，还需要<strong>Ingress Controller</strong>和<strong>Ingress Class</strong>来配合工作。</p><ul>\n<li>Ingress Controller是真正的集群入口，应用Ingress规则调度、分发流量，此外还能够扮演反向代理的角色，提供安全防护、TLS卸载等更多功能。</li>\n<li>Ingress Class是用来管理Ingress和Ingress Controller的概念，方便我们分组路由规则，降低维护成本。</li>\n</ul><p>不过Ingress Controller本身也是一个Pod，想要把服务暴露到集群外部还是要依靠Service。Service支持NodePort、LoadBalancer等方式，但NodePort的端口范围有限，LoadBalancer又依赖于云服务厂商，都不是很灵活。</p><p>折中的办法是用少量NodePort暴露Ingress Controller，用Ingress路由到内部服务，外部再用反向代理或者LoadBalancer把流量引进来。</p><h2>WordPress网站基本架构</h2><p>简略回顾了Kubernetes里这些API对象，下面我们就来使用它们再搭建出WordPress网站，实践加深理解。</p><p>既然我们已经掌握了Deployment、Service、Ingress这些Pod之上的概念，网站自然会有新变化，架构图我放在了这里：</p><p><img src=\"https://static001.geekbang.org/resource/image/96/07/9634b8850c3abf62047689b885d7ef07.jpg?wh=1920x1138\" alt=\"图片\"></p><p>这次的部署形式比起Docker、minikube又有了一些细微的差别，<strong>重点是我们已经完全舍弃了Docker，把所有的应用都放在Kubernetes集群里运行，部署方式也不再是裸Pod，而是使用Deployment，稳定性大幅度提升</strong>。</p><p>原来的Nginx的作用是反向代理，那么在Kubernetes里它就升级成了具有相同功能的Ingress Controller。WordPress原来只有一个实例，现在变成了两个实例（你也可以任意横向扩容），可用性也就因此提高了不少。而MariaDB数据库因为要保证数据的一致性，暂时还是一个实例。</p><p>还有，因为Kubernetes内置了服务发现机制Service，我们再也不需要去手动查看Pod的IP地址了，只要为它们定义Service对象，然后使用域名就可以访问MariaDB、WordPress这些服务。</p><p>网站对外提供服务我选择了两种方式。</p><p>一种是让WordPress的Service对象以NodePort的方式直接对外暴露端口30088，方便测试；另一种是给Nginx Ingress Controller添加“hostNetwork”属性，直接使用节点上的端口号，类似Docker的host网络模式，好处是可以避开NodePort的端口范围限制。</p><p>下面我们就按照这个基本架构来逐步搭建出新版本的WordPress网站，编写YAML声明。</p><p>这里有个小技巧，在实际操作的时候你一定要记得善用 <code>kubectl create</code>、<code>kubectl expose</code> 创建样板文件，节约时间的同时，也能避免低级的格式错误。</p><h2>1. WordPress网站部署MariaDB</h2><p>首先我们还是要部署MariaDB，这个步骤和在<a href=\"https://time.geekbang.org/column/article/534644\">第15讲</a>里做的也差不多。</p><p>先要用ConfigMap定义数据库的环境变量，有 <code>DATABASE</code>、<code>USER</code>、<code>PASSWORD</code>、<code>ROOT_PASSWORD</code>：</p><pre><code class=\"language-yaml\">apiVersion: v1\nkind: ConfigMap\nmetadata:\n&nbsp; name: maria-cm\n\ndata:\n&nbsp; DATABASE: 'db'\n&nbsp; USER: 'wp'\n&nbsp; PASSWORD: '123'\n&nbsp; ROOT_PASSWORD: '123'\n</code></pre><p>然后我们需要<strong>把MariaDB由Pod改成Deployment的方式</strong>，replicas设置成1个，template里面的Pod部分没有任何变化，还是要用 <code>envFrom</code>把配置信息以环境变量的形式注入Pod，相当于把Pod套了一个Deployment的“外壳”：</p><pre><code class=\"language-yaml\">apiVersion: apps/v1\nkind: Deployment\nmetadata:\n&nbsp; labels:\n&nbsp; &nbsp; app: maria-dep\n&nbsp; name: maria-dep\n\nspec:\n&nbsp; replicas: 1\n&nbsp; selector:\n&nbsp; &nbsp; matchLabels:\n&nbsp; &nbsp; &nbsp; app: maria-dep\n\n&nbsp; template:\n&nbsp; &nbsp; metadata:\n&nbsp; &nbsp; &nbsp; labels:\n&nbsp; &nbsp; &nbsp; &nbsp; app: maria-dep\n&nbsp; &nbsp; spec:\n&nbsp; &nbsp; &nbsp; containers:\n&nbsp; &nbsp; &nbsp; - image: mariadb:10\n&nbsp; &nbsp; &nbsp; &nbsp; name: mariadb\n&nbsp; &nbsp; &nbsp; &nbsp; ports:\n&nbsp; &nbsp; &nbsp; &nbsp; - containerPort: 3306\n\n&nbsp; &nbsp; &nbsp; &nbsp; envFrom:\n&nbsp; &nbsp; &nbsp; &nbsp; - prefix: 'MARIADB_'\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; configMapRef:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name: maria-cm\n</code></pre><p>我们还需要再<strong>为MariaDB定义一个Service对象</strong>，映射端口3306，让其他应用不再关心IP地址，直接用Service对象的名字来访问数据库服务：</p><pre><code class=\"language-yaml\">apiVersion: v1\nkind: Service\nmetadata:\n&nbsp; labels:\n&nbsp; &nbsp; app: maria-dep\n&nbsp; name: maria-svc\n\nspec:\n&nbsp; ports:\n&nbsp; - port: 3306\n&nbsp; &nbsp; protocol: TCP\n&nbsp; &nbsp; targetPort: 3306\n&nbsp; selector:\n&nbsp; &nbsp; app: maria-dep\n</code></pre><p>因为这三个对象都是数据库相关的，所以可以在一个YAML文件里书写，对象之间用 <code>---</code> 分开，这样用 <code>kubectl apply</code> 就可以一次性创建好：</p><pre><code class=\"language-plain\">kubectl apply&nbsp;-f wp-maria.yml\n</code></pre><p>执行命令后，你应该用 <code>kubectl get</code> 查看对象是否创建成功，是否正常运行：</p><p><img src=\"https://static001.geekbang.org/resource/image/2f/a4/2fa0050d5bf61224dc17dc67f6da16a4.png?wh=1664x852\" alt=\"图片\"></p><h2>2. WordPress网站部署WordPress</h2><p>第二步是部署WordPress应用。</p><p>因为刚才创建了MariaDB的Service，所以在写ConfigMap配置的时候“HOST”就不应该是IP地址了，而<strong>应该是DNS域名，也就是Service的名字</strong><code>maria-svc</code><strong>，这点需要特别注意</strong>：</p><pre><code class=\"language-yaml\">apiVersion: v1\nkind: ConfigMap\nmetadata:\n&nbsp; name: wp-cm\n\ndata:\n&nbsp; HOST: 'maria-svc'\n&nbsp; USER: 'wp'\n&nbsp; PASSWORD: '123'\n&nbsp; NAME: 'db'\n</code></pre><p>WordPress的Deployment写法和MariaDB也是一样的，给Pod套一个Deployment的“外壳”，replicas设置成2个，用字段“<strong>envFrom</strong>”配置环境变量：</p><pre><code class=\"language-yaml\">apiVersion: apps/v1\nkind: Deployment\nmetadata:\n&nbsp; labels:\n&nbsp; &nbsp; app: wp-dep\n&nbsp; name: wp-dep\n\nspec:\n&nbsp; replicas: 2\n&nbsp; selector:\n&nbsp; &nbsp; matchLabels:\n&nbsp; &nbsp; &nbsp; app: wp-dep\n\n&nbsp; template:\n&nbsp; &nbsp; metadata:\n&nbsp; &nbsp; &nbsp; labels:\n&nbsp; &nbsp; &nbsp; &nbsp; app: wp-dep\n&nbsp; &nbsp; spec:\n&nbsp; &nbsp; &nbsp; containers:\n&nbsp; &nbsp; &nbsp; - image: wordpress:5\n&nbsp; &nbsp; &nbsp; &nbsp; name: wordpress\n&nbsp; &nbsp; &nbsp; &nbsp; ports:\n&nbsp; &nbsp; &nbsp; &nbsp; - containerPort: 80\n\n&nbsp; &nbsp; &nbsp; &nbsp; envFrom:\n&nbsp; &nbsp; &nbsp; &nbsp; - prefix: 'WORDPRESS_DB_'\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; configMapRef:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name: wp-cm\n</code></pre><p>然后我们仍然要为WordPress创建Service对象，这里我使用了“<strong>NodePort</strong>”类型，并且手工指定了端口号“30088”（必须在30000~32767之间）：</p><pre><code class=\"language-yaml\">apiVersion: v1\nkind: Service\nmetadata:\n&nbsp; labels:\n&nbsp; &nbsp; app: wp-dep\n&nbsp; name: wp-svc\n\nspec:\n&nbsp; ports:\n&nbsp; - name: http80\n&nbsp; &nbsp; port: 80\n&nbsp; &nbsp; protocol: TCP\n&nbsp; &nbsp; targetPort: 80\n&nbsp; &nbsp; nodePort: 30088\n\n&nbsp; selector:\n&nbsp; &nbsp; app: wp-dep\n&nbsp; type: NodePort\n</code></pre><p>现在让我们用 <code>kubectl apply</code> 部署WordPress：</p><pre><code class=\"language-plain\">kubectl apply&nbsp; -f wp-dep.yml\n</code></pre><p>这些对象的状态可以从下面的截图看出来：</p><p><img src=\"https://static001.geekbang.org/resource/image/da/4f/daeb742118aca29577e1af91c89aff4f.png?wh=1920x1022\" alt=\"图片\"></p><p>因为WordPress的Service对象是NodePort类型的，我们可以在集群的每个节点上访问WordPress服务。</p><p>比如一个节点的IP地址是“192.168.10.210”，那么你就在浏览器的地址栏里输入“<a href=\"http://192.168.10.210:30088\">http://192.168.10.210:30088</a>”，其中的“30088”就是在Service里指定的节点端口号，然后就能够看到WordPress的安装界面了：</p><p><img src=\"https://static001.geekbang.org/resource/image/1f/38/1f5fa840441d52e94d3e7609a3bb9438.png?wh=874x1162\" alt=\"图片\"></p><h2>3. WordPress网站部署Nginx Ingress Controller</h2><p>现在MariaDB，WordPress都已经部署成功了，第三步就是部署Nginx Ingress Controller。</p><p>首先我们需要定义Ingress Class，名字就叫“wp-ink”，非常简单：</p><pre><code class=\"language-yaml\">apiVersion: networking.k8s.io/v1\nkind: IngressClass\nmetadata:\n&nbsp; name: wp-ink\n\nspec:\n&nbsp; controller: nginx.org/ingress-controller\n</code></pre><p>然后用 <code>kubectl create</code> 命令生成Ingress的样板文件，指定域名是“wp.test”，后端Service是“wp-svc:80”，Ingress Class就是刚定义的“wp-ink”：</p><pre><code class=\"language-plain\">kubectl create ing wp-ing --rule=\"wp.test/=wp-svc:80\" --class=wp-ink $out\n</code></pre><p>得到的Ingress YAML就是这样，注意路径类型我还是用的前缀匹配“<strong>Prefix</strong>”：</p><pre><code class=\"language-yaml\">apiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n&nbsp; name: wp-ing\n\nspec:\n&nbsp; ingressClassName: wp-ink\n\n&nbsp; rules:\n&nbsp; - host: wp.test\n&nbsp; &nbsp; http:\n&nbsp; &nbsp; &nbsp; paths:\n&nbsp; &nbsp; &nbsp; - path: /\n&nbsp; &nbsp; &nbsp; &nbsp; pathType: Prefix\n&nbsp; &nbsp; &nbsp; &nbsp; backend:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; service:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name: wp-svc\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; port:\n&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; number: 80\n</code></pre><p>接下来就是<strong>最关键的Ingress Controller对象了，它仍然需要从Nginx项目的示例YAML修改而来，要改动名字、标签，还有参数里的Ingress Class</strong>。</p><p>在之前讲基本架构的时候我说过了，这个Ingress Controller不使用Service，而是给它的Pod加上一个特殊字段 <code>hostNetwork</code>，让Pod能够使用宿主机的网络，相当于另一种形式的NodePort：</p><pre><code class=\"language-yaml\">apiVersion: apps/v1\nkind: Deployment\nmetadata:\n&nbsp; name: wp-kic-dep\n&nbsp; namespace: nginx-ingress\n\nspec:\n&nbsp; replicas: 1\n&nbsp; selector:\n&nbsp; &nbsp; matchLabels:\n&nbsp; &nbsp; &nbsp; app: wp-kic-dep\n\n&nbsp; template:\n&nbsp; &nbsp; metadata:\n&nbsp; &nbsp; &nbsp; labels:\n&nbsp; &nbsp; &nbsp; &nbsp; app: wp-kic-dep\n\n&nbsp; &nbsp; spec:\n&nbsp; &nbsp; &nbsp; serviceAccountName: nginx-ingress\n\n&nbsp; &nbsp; &nbsp; # use host network\n&nbsp; &nbsp; &nbsp; hostNetwork: true\n\n&nbsp; &nbsp; &nbsp; containers:\n      ...\n</code></pre><p>准备好Ingress资源后，我们创建这些对象：</p><pre><code class=\"language-plain\">kubectl apply -f wp-ing.yml -f wp-kic.yml\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/f5/6a/f57224b4c64ecc6b04651d1986406c6a.png?wh=1614x666\" alt=\"图片\"></p><p>现在所有的应用都已经部署完毕，可以在集群外面访问网站来验证结果了。</p><p>不过你要注意，Ingress使用的是HTTP路由规则，用IP地址访问是无效的，所以在集群外的主机上必须能够识别我们的“wp.test”域名，也就是说要把域名“wp.test”解析到Ingress Controller所在的节点上。</p><p>如果你用的是Mac，那就修改 <code>/etc/hosts</code>；如果你用的是Windows，就修改 <code>C:\\Windows\\System32\\Drivers\\etc\\hosts</code>，添加一条解析规则就行：</p><pre><code class=\"language-plain\">cat /etc/hosts\n192.168.10.210&nbsp; wp.test\n</code></pre><p>有了域名解析，在浏览器里你就不必使用IP地址，直接用域名“wp.test”走Ingress Controller就能访问我们的WordPress网站了：</p><p><img src=\"https://static001.geekbang.org/resource/image/e1/ea/e10a1f53d9d163e74a53fb18d81cf5ea.png?wh=1550x1098\" alt=\"图片\"></p><p>到这里，我们在Kubernetes上部署WordPress网站的工作就全部完成了。</p><h2>小结</h2><p>这节课我们回顾了“中级篇”里的一些知识要点，我把它们总结成了思维导图，你课后可以对照着它查缺补漏，巩固学习成果。</p><p><img src=\"https://static001.geekbang.org/resource/image/6c/7c/6c051e3c12db763851b1yya34a90c67c.jpg?wh=1920x1543\" alt=\"图片\"></p><p>今天我们还在Kubernetes集群里再次搭建了WordPress网站，应用了新对象Deployment、Service、Ingress，为网站增加了横向扩容、服务发现和七层负载均衡这三个非常重要的功能，提升了网站的稳定性和可用性，基本上解决了在“初级篇”所遇到的问题。</p><p>虽然这个网站离真正实用还差得比较远，但框架已经很完善了，你可以在这个基础上添加其他功能，比如创建证书Secret、让Ingress支持HTTPS等等。</p><p>另外，我们保证了网站各项服务的高可用，但对于数据库MariaDB来说，虽然Deployment在发生故障时能够及时重启Pod，新Pod却不会从旧Pod继承数据，之前网站的数据会彻底消失，这个后果是完全不可接受的。</p><p>所以在后续的“高级篇”里，我们会继续学习持久化存储对象PersistentVolume，以及有状态的StatefulSet等对象，进一步完善我们的网站。</p><h2>课下作业</h2><p>最后是课下作业时间，还是两个动手操作题：</p><ol>\n<li>你能否把WordPress和Ingress Controller改成DaemonSet的部署方式？</li>\n<li>你能否为Ingress Controller创建Service对象，让它以NodePort的方式对外提供服务？</li>\n</ol><p>欢迎留言分享你的实操体验，如果觉得这篇文章对你有帮助，也欢迎你分享给身边的朋友一起学习。下节课是视频课，我们下节课再见。</p><p><img src=\"https://static001.geekbang.org/resource/image/60/b2/607a15a372b6dd4fd59d2060d1e811b2.jpg?wh=1920x1377\" alt=\"图片\"></p>","comments":[{"had_liked":false,"id":354380,"user_name":"YueShi","can_delete":false,"product_type":"c1","uid":1625530,"ip_address":"北京","ucode":"8F7AFAE4641A7D","user_header":"https://static001.geekbang.org/account/avatar/00/18/cd/ba/3a348f2d.jpg","comment_is_top":false,"comment_ctime":1660319846,"is_pvip":true,"replies":[{"id":128924,"content":"great","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1660437078,"ip_address":"北京","comment_id":354380,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"使用http:&#47;&#47;wp.test&#47;访问,需要在host改wp-kic-dep部署的那个节点的ip才可以","like_count":8,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583834,"discussion_content":"great","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660437079,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":376498,"user_name":"大毛","can_delete":false,"product_type":"c1","uid":1899599,"ip_address":"北京","ucode":"93B18287F06706","user_header":"https://static001.geekbang.org/account/avatar/00/1c/fc/4f/0a452c94.jpg","comment_is_top":false,"comment_ctime":1686853264,"is_pvip":false,"replies":[{"id":137265,"content":"great!","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1686908330,"ip_address":"北京","comment_id":376498,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"以下是我在进行操作时遇到的坑，给大家填一下：\n1. 在运行 nginx controller 的时候，pod 的状态一直不是 running，查看日志最后显示的是 bind() to 0.0.0.0:80 failed (13: Permission denied)。经过查资料发现，这是因为在运行 pod 的时候会桥接宿主机的 80 端口，而 80 端口是受保护的。解决办法是在 securityContext 中添加 allowPrivilegeEscalation: true，即可以进行特权升级。（https:&#47;&#47;github.com&#47;nginxinc&#47;kubernetes-ingress&#47;issues&#47;3932）\n2. 不管你用什么设备访问 wp.test，请关掉科学上网软件，否则可能 502","like_count":7,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":621204,"discussion_content":"great!","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1686908330,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1104191,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d9/3f/33c758df.jpg","nickname":"毛","note":"","ucode":"84C4B39145D9F9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":626401,"discussion_content":"踩这个坑了，哈哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1692883859,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354725,"user_name":"dao","can_delete":false,"product_type":"c1","uid":1087879,"ip_address":"北京","ucode":"4181FB270462CF","user_header":"https://static001.geekbang.org/account/avatar/00/10/99/87/5066026c.jpg","comment_is_top":false,"comment_ctime":1660721382,"is_pvip":false,"replies":[{"id":129059,"content":"great","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1660726928,"ip_address":"北京","comment_id":354725,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"因为前面几节都是按照文稿来演练，坑都踩完了，本节很轻松完成。\n作业：\n1. 直接可以由 deployment 改编一下：修改 Kind，移除 replicas ； 根据需要添加 tolerations 设置。\n2. 为 Ingress Controller 创建 Service 对象，用YAML样板来实现吧\n```bash\nkubectl expose deploy wp-kic-dep --port=80,443 --type=NodePort --name=wp-kic-svc -n nginx-ingress $out\n```\n大概的 YAML \n```yaml\n  - name: http\n    port: 80\n    protocol: TCP\n    targetPort: 80\n    nodePort: 30080\n  - name: https\n    port: 443\n    protocol: TCP\n    targetPort: 443\n    nodePort: 30443\n```\n记得移除 ingress controller deployment 里的 `hostNetwork: true`。\n现在就可以愉快地访问 https:&#47;&#47;wp.test:30443&#47; 。\n","like_count":7,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584301,"discussion_content":"great","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660726928,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1610197,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKECIWSbdCJHiavP3MHwUlHsCyzbw1AUvichzuiaIYicxIWEA0s1YDWQopGXPq5O8Oe0jC0utick7EGMCQ/132","nickname":"Geek_062cdc","note":"","ucode":"3D61A8597E3615","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":594895,"discussion_content":"ingress controller使用了官方v1.5.1版本，镜像需要翻墙下载，我Pull到了私有仓库，有需要的\nregistry.cn-hangzhou.aliyuncs.com/hongz/controller:v1.5.1\nregistry.cn-hangzhou.aliyuncs.com/hongz/kube-webhook-certgen:v20220916-gd32f8c343","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1669535867,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1405256,"avatar":"https://static001.geekbang.org/account/avatar/00/15/71/48/44df7f4e.jpg","nickname":"凯","note":"","ucode":"60DB11CF72C7B0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":619378,"discussion_content":"这个方式有问题，有一些页面加载不了，还是得用ds，暴露80端口，而且wordpress的副本书不能为2，会话会异常退出","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1685030594,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":366977,"user_name":"Lorry","can_delete":false,"product_type":"c1","uid":1066409,"ip_address":"四川","ucode":"BD4754D0F1D786","user_header":"https://static001.geekbang.org/account/avatar/00/10/45/a9/3d48d6a2.jpg","comment_is_top":false,"comment_ctime":1674726081,"is_pvip":false,"replies":[{"id":133716,"content":"great","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1674777195,"ip_address":"北京","comment_id":366977,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"关于hostNetwork方式，分享一点，就是hostNetwork这种形式虽然可以让外界访问到，但是你一定要让外界机器通过域名，这里是“wp.test”能够路由到这台机器，当然这个很简单，只要在&#47;etc&#47;hosts里面添加一条记录就可以，但是wp.test要映射到哪一台机器？开始我在这个地方卡了好久，以为配置的是master机器，但是其实不是，应该是ingress controller的pod部署的那台机器，通过命令（kubectl get pod -n nginx-ingress -o wide）可以查看到pod是部署的机器，然后决定映射的ip；\n\n这一点文章中有提到，但是容易忽略。","like_count":5,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600709,"discussion_content":"great","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1674777195,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1200179,"avatar":"https://static001.geekbang.org/account/avatar/00/12/50/33/9dcd30c4.jpg","nickname":"斯蒂芬.赵","note":"","ucode":"AA0FF2DA654418","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":629498,"discussion_content":"关于hostNetwork方式，分享一点，就是hostNetwork这种形式虽然可以让外界访问到，但是你一定要让外界机器通过域名，这里是“wp.test”能够路由到这台机器，当然这个很简单，只要在/etc/hosts里面添加一条记录就可以，但是wp.test要映射到哪一台机器？开始我在这个地方卡了好久，以为配置的是master机器，但是其实不是，应该是ingress controller的pod部署的那台机器，通过命令（kubectl get pod -n nginx-ingress -o wide）可以查看到pod是部署的机器，然后决定映射的ip；\n\n这一点文章中有提到，但是容易忽略。\n\n\n指定wp.test 的host为ingress controller的pod部署的那台机器的那台机器后，在浏览器访问wp.test 404是咋回事？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1697122835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"山东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354507,"user_name":"YueShi","can_delete":false,"product_type":"c1","uid":1625530,"ip_address":"北京","ucode":"8F7AFAE4641A7D","user_header":"https://static001.geekbang.org/account/avatar/00/18/cd/ba/3a348f2d.jpg","comment_is_top":false,"comment_ctime":1660474009,"is_pvip":true,"replies":[{"id":128940,"content":"good","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1660519113,"ip_address":"北京","comment_id":354507,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"改成DaemonSet只需要把kind的Deployment变成DeamonSet、把replicas注释掉就可以","like_count":4,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583938,"discussion_content":"good","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660519113,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354187,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"上海","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1660173817,"is_pvip":false,"replies":[{"id":128819,"content":"应该是前面没有安装好Nginx Ingress Controller吧，需要运行Ingress目录里的setup.sh，apply相关的YAML 。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1660185106,"ip_address":"上海","comment_id":354187,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"老师，22讲最后一步，就是创建nginx controller失败，POD状态是“CrashLoopBackOff”。用logs命令查看，错误信息是：\nError when getting IngressClass wp-ink: ingressclasses.networking.k8s.io &quot;wp-ink&quot; is forbidden: User &quot;system:serviceaccount:nginx-ingress:nginx-ingress&quot; cannot get resource &quot;ingressclasses&quot; in API group &quot;networking.k8s.io&quot; at the cluster scope\n\n不知道是什么意思？不知道怎么修改？ （能看懂英文，但不知道说的是什么） （注：kic文件是拷贝老师的，https:&#47;&#47;github.com&#47;chronolaw&#47;k8s_study&#47;blob&#47;master&#47;ch3&#47;wp-kic.yml   完全拷贝，成功创建）","like_count":4,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583532,"discussion_content":"应该是前面没有安装好Nginx Ingress Controller吧，需要运行Ingress目录里的setup.sh，apply相关的YAML 。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660185106,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1346215,"avatar":"https://static001.geekbang.org/account/avatar/00/14/8a/a7/674c1864.jpg","nickname":"William","note":"","ucode":"55F5D9DEE485B1","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635368,"discussion_content":"没错, 我也遇到了这个问题. 执行老师项目内的 .../ingress#setup.sh就OK了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704771295,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"吉林","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":369508,"user_name":"jason","can_delete":false,"product_type":"c1","uid":1167872,"ip_address":"广东","ucode":"3329F08BAF307E","user_header":"https://static001.geekbang.org/account/avatar/00/11/d2/00/9a247b1e.jpg","comment_is_top":false,"comment_ctime":1677630064,"is_pvip":false,"replies":[{"id":134663,"content":"生产环境用的一般是把Ingress Controller的service配置成LoadBalancer，云厂商会自动分配IP地址，我们这个是实验环境，所以比较简陋。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1677635221,"ip_address":"北京","comment_id":369508,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"老师，wp.test这个域名需要指定ingress controller那个pod所在的节点ip，而ingress controller是通过deployment来管理的，pod重建时可能会被部署到别的节点，这样不是又要改host配置了吗？想问一下生产环境是怎样解决这个问题的。","like_count":3,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":607124,"discussion_content":"生产环境用的一般是把Ingress Controller的service配置成LoadBalancer，云厂商会自动分配IP地址，我们这个是实验环境，所以比较简陋。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677635221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3075398,"avatar":"","nickname":"Geek_490f13","note":"","ucode":"A16A3A4BCC1DA6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":646516,"discussion_content":"我也有这个疑问，来问答里面看，真找到答案了哈哈哈哈~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1718159180,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360827,"user_name":"笨晓孩","can_delete":false,"product_type":"c1","uid":1810603,"ip_address":"上海","ucode":"C5A55BB5DEBF27","user_header":"https://static001.geekbang.org/account/avatar/00/1b/a0/ab/5f43eee8.jpg","comment_is_top":false,"comment_ctime":1666883864,"is_pvip":false,"replies":[{"id":131266,"content":"先看一下Service是否正常，里面的endpoint是否是WordPress的pod，在集群节点或者pod里ping WordPress，看pod是否正常。\n\n我感觉应该还是Service没有设置好。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1666914793,"ip_address":"上海","comment_id":360827,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"老师，我部署完wp-svc之后，通过nodeIP:30088的方式没办法访问Wordpress页面，采用的是nodeport的方式","like_count":3,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591883,"discussion_content":"先看一下Service是否正常，里面的endpoint是否是WordPress的pod，在集群节点或者pod里ping WordPress，看pod是否正常。\n\n我感觉应该还是Service没有设置好。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666914793,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354150,"user_name":"Geek_2ce074","can_delete":false,"product_type":"c1","uid":2940560,"ip_address":"北京","ucode":"628B36B652CFD2","user_header":"","comment_is_top":false,"comment_ctime":1660125256,"is_pvip":false,"replies":[{"id":128810,"content":"参考这个：https:&#47;&#47;docs.nginx.com&#47;nginx-ingress-controller&#47;installation&#47;installation-with-manifests&#47;","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1660134279,"ip_address":"北京","comment_id":354150,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"老师你好，Ingress Controller 对象，在哪个 Nginx 项目的示例 YAML 里有呀，根本找不到呀","like_count":3,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583478,"discussion_content":"参考这个：https://docs.nginx.com/nginx-ingress-controller/installation/installation-with-manifests/","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660134279,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354109,"user_name":"romance","can_delete":false,"product_type":"c1","uid":1029768,"ip_address":"北京","ucode":"393DC641CCE86E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b6/88/e8deccbc.jpg","comment_is_top":false,"comment_ctime":1660100230,"is_pvip":false,"replies":[{"id":128797,"content":"应该是WordPress配置的不对吧，看看环境变量的设置。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1660108503,"ip_address":"北京","comment_id":354109,"utype":1}],"discussion_count":6,"race_medal":0,"score":2,"product_id":100114501,"comment_content":"老师，数据库配置没问题，svc也正常，但访问网站时提示 Error establishing a database connection，不知道什么原因","like_count":3,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583417,"discussion_content":"应该是WordPress配置的不对吧，看看环境变量的设置。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660108503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583454,"discussion_content":"可能是dns域名插件没有正常工作，看看Service域名是否能正常解析。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1660123119,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1119563,"avatar":"https://static001.geekbang.org/account/avatar/00/11/15/4b/bd086599.jpg","nickname":"波","note":"","ucode":"F424E8E1CA3C0C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593069,"discussion_content":"也遇到了同样的情况，maria-svc无法解析，按照评论区查看了一遍相关组件状态，没发现问题，最后重启了coredns竟然可以了，目前还是不知道啥原因。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667909263,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1309681,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKvNozkiaiao1IyuCzEIMPiaNicB1hgEcad3X4DS6IAq5lnOiagf2690Q7Q1RmyBN89gNqYHeHHtY2RcqQ/132","nickname":"墨龙","note":"","ucode":"8C63C5D18E0877","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583577,"discussion_content":"下午遇到同样的问题，刚刚看到上面的回复后， kubectl get pod -n kube-system发现coredns确实没有ready。于是重启虚拟机后就好了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660211444,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1029768,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b6/88/e8deccbc.jpg","nickname":"romance","note":"","ucode":"393DC641CCE86E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583408,"discussion_content":"如果把wp-maria.yml里的svc配置删掉，然后wp-dep.yml里的HOST用回pod的IP方式，访问是正常的。应该就是 maria-svc 这个读取不正常，但用kubectl get svc看过是正常的。不知道什么原因","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660103607,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1087879,"avatar":"https://static001.geekbang.org/account/avatar/00/10/99/87/5066026c.jpg","nickname":"dao","note":"","ucode":"4181FB270462CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1029768,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b6/88/e8deccbc.jpg","nickname":"romance","note":"","ucode":"393DC641CCE86E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584185,"discussion_content":"可以试试 kubectl describe svc maria-svc ，看看是否能显示正确的 pod IP","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660666125,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":583408,"ip_address":"新加坡","group_id":0},"score":584185,"extra":""}]}]},{"had_liked":false,"id":363033,"user_name":"菲茨杰拉德","can_delete":false,"product_type":"c1","uid":1875922,"ip_address":"北京","ucode":"4EB29359F39862","user_header":"https://static001.geekbang.org/account/avatar/00/1c/9f/d2/b6d8df48.jpg","comment_is_top":false,"comment_ctime":1669174008,"is_pvip":false,"replies":[{"id":132031,"content":"域名解析是由运行在Kubernetes里的coredns实现的，不是Kubernetes自身的功能，可以认为是插件。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1669181974,"ip_address":"北京","comment_id":363033,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"配置hosts后，解析出来的还是ingress的ip，在七层负载不还是相当于用的ip来访问的吗？这个解析过程不是k8s做的吧。\n我原来理解的是七层负载走http，通过域名来访问。输入域名后，k8s解析然后找到四层的ip和端口然后请求。","like_count":2,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":594558,"discussion_content":"域名解析是由运行在Kubernetes里的coredns实现的，不是Kubernetes自身的功能，可以认为是插件。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1669181974,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1875922,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/9f/d2/b6d8df48.jpg","nickname":"菲茨杰拉德","note":"","ucode":"4EB29359F39862","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":594564,"discussion_content":"多谢，老师","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1669185775,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":594558,"ip_address":"北京","group_id":0},"score":594564,"extra":""}]}]},{"had_liked":false,"id":380526,"user_name":"lesserror","can_delete":false,"product_type":"c1","uid":1351076,"ip_address":"广东","ucode":"25A54D1165FCF6","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","comment_is_top":false,"comment_ctime":1693774991,"is_pvip":false,"replies":[{"id":138584,"content":"good","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1693820679,"ip_address":"北京","comment_id":380526,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"如果你使用的是 minikube 来搭建本节的实验环境，可以参考这里来在macOS本地通过域名访问服务：https:&#47;&#47;github.com&#47;kubernetes&#47;minikube&#47;pull&#47;12089","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":627127,"discussion_content":"good","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1693820679,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":378646,"user_name":"chengyi","can_delete":false,"product_type":"c1","uid":1159322,"ip_address":"江苏","ucode":"0CB689D18FB5EF","user_header":"https://static001.geekbang.org/account/avatar/00/11/b0/9a/561e9d74.jpg","comment_is_top":false,"comment_ctime":1690526118,"is_pvip":false,"replies":[{"id":137969,"content":"意思是综合使用NodePort和LoadBalancer，不要完全依赖云厂商。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1690545560,"ip_address":"上海","comment_id":378646,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"不过 Ingress Controller 本身也是一个 Pod，想要把服务暴露到集群外部还是要依靠 Service。Service 支持 NodePort、LoadBalancer 等方式，但 NodePort 的端口范围有限，LoadBalancer 又依赖于云服务厂商，都不是很灵活。\n折中的办法是用少量 NodePort 暴露 Ingress Controller，用 Ingress 路由到内部服务，外部再用反向代理或者 LoadBalancer 把流量引进来。\n请问这两段话的区别是什么，不太理解。","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":624424,"discussion_content":"意思是综合使用NodePort和LoadBalancer，不要完全依赖云厂商。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1690545560,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":372029,"user_name":"kobe","can_delete":false,"product_type":"c1","uid":1165831,"ip_address":"浙江","ucode":"AB8B599F3D5521","user_header":"https://static001.geekbang.org/account/avatar/00/11/ca/07/22dd76bf.jpg","comment_is_top":false,"comment_ctime":1680607062,"is_pvip":false,"replies":[{"id":135790,"content":"应该是Ingress controller的资源没有完全创建好吧，用GitHub上的setup脚本，把所有相关的yaml都安装一遍。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1680659748,"ip_address":"北京","comment_id":372029,"utype":1}],"discussion_count":5,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"我加上ingress controller后启动，报了这个错，能帮看下是什么原因么：\nNGINX Ingress Controller Version=3.1.0 Commit=057c6d7e4f2361f5d2ddd897e9995bcb48ed7e32 Date=2023-03-27T10:15:43Z DirtyState=false Arch=linux&#47;amd64 Go=go1.20.2\nI0404 10:41:32.746481       1 flags.go:294] Starting with flags: [&quot;-nginx-configmaps=nginx-ingress&#47;nginx-config&quot; &quot;-ingress-class=wp-ink&quot;]\nI0404 10:41:32.761875       1 main.go:234] Kubernetes version: 1.23.3\nI0404 10:41:32.771440       1 main.go:380] Using nginx version: nginx&#47;1.23.3\nE0404 10:41:32.773053       1 main.go:753] Error getting pod: pods &quot;wp-kic-dep-7d46fd4f8d-mnxpk&quot; is forbidden: User &quot;system:serviceaccount:nginx-ingress:nginx-ingress&quot; cannot get resource &quot;pods&quot; in API group &quot;&quot; in the namespace &quot;nginx-ingress&quot;\n2023&#47;04&#47;04 10:41:32 [emerg] 12#12: bind() to 0.0.0.0:80 failed (13: Permission denied)","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612395,"discussion_content":"应该是Ingress controller的资源没有完全创建好吧，用GitHub上的setup脚本，把所有相关的yaml都安装一遍。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680659748,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1899599,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/fc/4f/0a452c94.jpg","nickname":"大毛","note":"","ucode":"93B18287F06706","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":621159,"discussion_content":"解决 bind() to 0.0.0.0:80 failed (13: Permission denied) 的问题：是在 securityContext 中添加 allowPrivilegeEscalation: true\n（https://github.com/nginxinc/kubernetes-ingress/issues/3932）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1686853371,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3231579,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/tjZDHOybO07lltibjmDiaQKdpE1C3ul9c9wmUWwnVohS5fSEOPcfK2d9ZvKEHu6ibMLXYNUSrA23w08Ty5MFYMfzA/132","nickname":"Geek_ec6229","note":"","ucode":"24DF2FDA6BCE13","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":615436,"discussion_content":"大佬问题有解决吗，我也遇到了 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1682259627,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1899599,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/fc/4f/0a452c94.jpg","nickname":"大毛","note":"","ucode":"93B18287F06706","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":3231579,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/tjZDHOybO07lltibjmDiaQKdpE1C3ul9c9wmUWwnVohS5fSEOPcfK2d9ZvKEHu6ibMLXYNUSrA23w08Ty5MFYMfzA/132","nickname":"Geek_ec6229","note":"","ucode":"24DF2FDA6BCE13","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":621160,"discussion_content":"解决 bind() to 0.0.0.0:80 failed (13: Permission denied) 的问题：是在 securityContext 中添加 allowPrivilegeEscalation: true\n（https://github.com/nginxinc/kubernetes-ingress/issues/3932）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1686853376,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":615436,"ip_address":"北京","group_id":0},"score":621160,"extra":""}]},{"author":{"id":1165831,"avatar":"https://static001.geekbang.org/account/avatar/00/11/ca/07/22dd76bf.jpg","nickname":"kobe","note":"","ucode":"AB8B599F3D5521","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612435,"discussion_content":"这个也试了，还是报一样的错，用describe查看pod，信息如下：\nEvents:\n  Type     Reason     Age                 From               Message\n  ----     ------     ----                ----               -------\n  Normal   Scheduled  &lt;invalid&gt;           default-scheduler  Successfully assigned nginx-ingress/wp-kic-dep-7d46fd4f8d-8l9p7 to worker\n  Normal   Pulled     89s                 kubelet            Container image &#34;nginx/nginx-ingress:3.1.0-alpine&#34; already present on machine\n  Normal   Created    89s                 kubelet            Created container nginx-ingress\n  Normal   Started    89s                 kubelet            Started container nginx-ingress\n  Warning  Unhealthy  70s (x22 over 89s)  kubelet            Readiness probe failed: Get &#34;http://192.168.56.106:8081/nginx-ready&#34;: dial tcp 192.168.56.106:8081: connect: connection refused","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680683992,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":372000,"user_name":"kobe","can_delete":false,"product_type":"c1","uid":1165831,"ip_address":"浙江","ucode":"AB8B599F3D5521","user_header":"https://static001.geekbang.org/account/avatar/00/11/ca/07/22dd76bf.jpg","comment_is_top":false,"comment_ctime":1680591703,"is_pvip":false,"replies":[{"id":135789,"content":"用describe看看，有没有错误信息。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1680659690,"ip_address":"北京","comment_id":372000,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"我这个ingress controller启动后没成功，一直在不断的创建pod，如下：\nwp-kic-dep-545dffd6d7-2n9cq    0&#47;1     SysctlForbidden   0          48s\nwp-kic-dep-545dffd6d7-2zkh2    0&#47;1     SysctlForbidden   0          65s\nwp-kic-dep-545dffd6d7-4f42q    0&#47;1     SysctlForbidden   0          20s\nwp-kic-dep-545dffd6d7-4vxlw    0&#47;1     SysctlForbidden   0          53s\nwp-kic-dep-545dffd6d7-6vshx    0&#47;1     SysctlForbidden   0          8s\nwp-kic-dep-545dffd6d7-6zgx7    0&#47;1     SysctlForbidden   0          60s\nwp-kic-dep-545dffd6d7-85mjh    0&#47;1     SysctlForbidden   0          46s\nwp-kic-dep-545dffd6d7-88jcn    0&#47;1     SysctlForbidden   0          55s\nwp-kic-dep-545dffd6d7-8mfjp    0&#47;1     SysctlForbidden   0          35s\nwp-kic-dep-545dffd6d7-8z5ps    0&#47;1     SysctlForbidden   0          72s\nwp-kic-dep-545dffd6d7-9bzgp    0&#47;1     SysctlForbidden   0          41s\nwp-kic-dep-545dffd6d7-9v86q    0&#47;1     SysctlForbidden   0          15s\nwp-kic-dep-545dffd6d7-c42rl    0&#47;1     SysctlForbidden   0          38s\nwp-kic-dep-545dffd6d7-c8zx8    0&#47;1     SysctlForbidden   0          57s\nwp-kic-dep-545dffd6d7-ccjfm    0&#47;1     SysctlForbidden   0          7s\nwp-kic-dep-545dffd6d7-chwt9    0&#47;1     SysctlForbidden   0          16s\nwp-kic-dep-545dffd6d7-crf4s    0&#47;1     SysctlForbidden   0          17s\nwp-kic-dep-545dffd6d7-cx8bx    0&#47;1     SysctlForbidden   0          20s\nwp-kic-dep-545dffd6d7-dc7w2    0&#47;1     SysctlForbidden   0          11s\nwp-kic-dep-545dffd6d7-dzvvx    0&#47;1     SysctlForbidden   0          73s\nwp-kic-dep-545dffd6d7-f72lj    0&#47;1     SysctlForbidden   0          66s\nwp-kic-dep-545dffd6d7-gjdkz    0&#47;1     SysctlForbidden   0          27s","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612394,"discussion_content":"用describe看看，有没有错误信息。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680659690,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3231579,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/tjZDHOybO07lltibjmDiaQKdpE1C3ul9c9wmUWwnVohS5fSEOPcfK2d9ZvKEHu6ibMLXYNUSrA23w08Ty5MFYMfzA/132","nickname":"Geek_ec6229","note":"","ucode":"24DF2FDA6BCE13","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":615276,"discussion_content":" 我也遇到同样的错误，大佬解决了吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1682158682,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":370644,"user_name":"蔡晓慧","can_delete":false,"product_type":"c1","uid":1588301,"ip_address":"中国香港","ucode":"8D177D2B37BD6D","user_header":"https://static001.geekbang.org/account/avatar/00/18/3c/4d/3dec4bfe.jpg","comment_is_top":false,"comment_ctime":1679046755,"is_pvip":false,"replies":[{"id":135244,"content":"good，自己研究并解决问题，会对以后的工作更有帮助。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1679059377,"ip_address":"上海","comment_id":370644,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"apiVersion: v1\nkind: Service\nmetadata:\n  creationTimestamp: null\n  name: wp-kic-svc\n  namespace: nginx-ingress\nspec:\n  ports:\n  - name: http\n    port: 80\n    protocol: TCP\n    targetPort: 80\n    nodePort: 30089\n  selector:\n    app: wp-kic-dep\n  type: NodePort\nstatus:\n  loadBalancer: {}\n\n老师，这是我写的Ingress Controller 的 Service 对象，之前用http:&#47;&#47;wp.test:30089 访问 \n提示\n该网页无法正常运作\nwp.test 目前无法处理此请求。\nHTTP ERROR 502\n\n是因为我电脑开了vpn代理，然后关了就可以访问了，这个大家看看和我是否有同样的问题。","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":609628,"discussion_content":"good，自己研究并解决问题，会对以后的工作更有帮助。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679059377,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":370403,"user_name":"蔡晓慧","can_delete":false,"product_type":"c1","uid":1588301,"ip_address":"北京","ucode":"8D177D2B37BD6D","user_header":"https://static001.geekbang.org/account/avatar/00/18/3c/4d/3dec4bfe.jpg","comment_is_top":false,"comment_ctime":1678789684,"is_pvip":false,"replies":[{"id":135100,"content":"service只能保证在kubernetes集群里使用域名，在外界使用域名要修改hosts文件。\n\nservice是否正常可以用kubectl来检查，还有看coredns的运行状态。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1678848963,"ip_address":"上海","comment_id":370403,"utype":1}],"discussion_count":4,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"apiVersion: v1\nkind: Service\nmetadata:\n  creationTimestamp: null\n  name: wp-kic-svc\n  namespace: nginx-ingress\nspec:\n  ports:\n  - name: http\n    port: 80\n    protocol: TCP\n    targetPort: 80\n    nodePort: 30089\n  selector:\n    app: wp-kic-dep\n  type: NodePort\nstatus:\n  loadBalancer: {}\n\n老师，这是我写的Ingress Controller 的 Service 对象，用http:&#47;&#47;wp.test:30089 访问 提示拒绝连接   有什么排查思路吗？ hostNetwork: true 在wp-kic.yml我也注掉了。","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":609143,"discussion_content":"service只能保证在kubernetes集群里使用域名，在外界使用域名要修改hosts文件。\n\nservice是否正常可以用kubectl来检查，还有看coredns的运行状态。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678848963,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":3,"child_discussions":[{"author":{"id":1588301,"avatar":"https://static001.geekbang.org/account/avatar/00/18/3c/4d/3dec4bfe.jpg","nickname":"蔡晓慧","note":"","ucode":"8D177D2B37BD6D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":609147,"discussion_content":"用IP+端口http://192.168.72.5:30089/ 访问  返回404","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678849166,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":609143,"ip_address":"中国香港","group_id":0},"score":609147,"extra":""},{"author":{"id":1588301,"avatar":"https://static001.geekbang.org/account/avatar/00/18/3c/4d/3dec4bfe.jpg","nickname":"蔡晓慧","note":"","ucode":"8D177D2B37BD6D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":609148,"discussion_content":"kubectl describe svc wp-kic-svc -n nginx-ingress 看上去也正常  Endpoints指向的也是ingress-controller对应的pod","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678849242,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":609143,"ip_address":"中国香港","group_id":0},"score":609148,"extra":""},{"author":{"id":1588301,"avatar":"https://static001.geekbang.org/account/avatar/00/18/3c/4d/3dec4bfe.jpg","nickname":"蔡晓慧","note":"","ucode":"8D177D2B37BD6D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":609155,"discussion_content":"coredns 其中一个里面的日志有这个错误  \n[ERROR] plugin/errors: 2 api.wordpress.org. AAAA: read udp 10.244.0.5:35868-&gt;114.114.114.114:53: i/o timeout\n\n会和这个错误相关吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678851000,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":609143,"ip_address":"中国香港","group_id":0},"score":609155,"extra":""}]}]},{"had_liked":false,"id":362035,"user_name":"菲茨杰拉德","can_delete":false,"product_type":"c1","uid":1875922,"ip_address":"北京","ucode":"4EB29359F39862","user_header":"https://static001.geekbang.org/account/avatar/00/1c/9f/d2/b6d8df48.jpg","comment_is_top":false,"comment_ctime":1668079785,"is_pvip":false,"replies":[{"id":131693,"content":"后面会用kubeadm部署Kubernetes集群，只要是Kubernetes集群，用起来都没什么区别。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1668122618,"ip_address":"北京","comment_id":362035,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"kubeadm部署master和worker。跟实战演练中部署应用有啥区别。看命令行，老师是在minikube上演练这节课的吧","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593345,"discussion_content":"后面会用kubeadm部署Kubernetes集群，只要是Kubernetes集群，用起来都没什么区别。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668122618,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1875922,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/9f/d2/b6d8df48.jpg","nickname":"菲茨杰拉德","note":"","ucode":"4EB29359F39862","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":593346,"discussion_content":"好的。感谢老师","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668122683,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":593345,"ip_address":"北京","group_id":0},"score":593346,"extra":""}]}]},{"had_liked":false,"id":362033,"user_name":"菲茨杰拉德","can_delete":false,"product_type":"c1","uid":1875922,"ip_address":"北京","ucode":"4EB29359F39862","user_header":"https://static001.geekbang.org/account/avatar/00/1c/9f/d2/b6d8df48.jpg","comment_is_top":false,"comment_ctime":1668079127,"is_pvip":false,"replies":[{"id":131692,"content":"可以参考第10讲，看看Kubernetes是如何管理这些集群节点的。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1668086479,"ip_address":"北京","comment_id":362033,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"之前是搭建了k8s的master 和 worker。现在部署应用，在之前的虚拟机上建?那k8s怎么管理这些应用","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593334,"discussion_content":"可以参考第10讲，看看Kubernetes是如何管理这些集群节点的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668086479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1875922,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/9f/d2/b6d8df48.jpg","nickname":"菲茨杰拉德","note":"","ucode":"4EB29359F39862","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":593335,"discussion_content":"好的。多谢老师","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668086539,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":593334,"ip_address":"北京","group_id":0},"score":593335,"extra":""}]}]},{"had_liked":false,"id":359691,"user_name":"天敌","can_delete":false,"product_type":"c1","uid":1059944,"ip_address":"北京","ucode":"CD29A622197197","user_header":"https://static001.geekbang.org/account/avatar/00/10/2c/68/c299bc71.jpg","comment_is_top":false,"comment_ctime":1665755466,"is_pvip":false,"replies":[{"id":130858,"content":"可以试试强制删除，用参数--force。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1665833788,"ip_address":"北京","comment_id":359691,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100114501,"comment_content":"老师，pod 启动启动不了，删除删除不了， describe 之后有如下报错：\nfailed to &quot;KillPodSandbox&quot; for &quot;f295ef40-d765-420b-b004-25d1b613ed3c&quot; with KillPodSandboxError: &quot;rpc error: code = DeadlineExceeded desc = context deadline exceeded\n我该如何操作？","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590518,"discussion_content":"可以试试强制删除，用参数--force。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665833789,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1059944,"avatar":"https://static001.geekbang.org/account/avatar/00/10/2c/68/c299bc71.jpg","nickname":"天敌","note":"","ucode":"CD29A622197197","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":590555,"discussion_content":"可以删除了， 但还是启动不起来 =。=","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665883570,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":590518,"ip_address":"四川","group_id":0},"score":590555,"extra":""}]}]},{"had_liked":false,"id":354176,"user_name":"yhtyht308","can_delete":false,"product_type":"c1","uid":1230354,"ip_address":"北京","ucode":"9A054290B8B284","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/dotGbXAlAZg0bhCq4P96A40mdyavzR33jSqIHk8xLlic4B5PYNDIP5MEa1Fk9yxzdz9scHUM7IUNR71nVZNoV7Q/132","comment_is_top":false,"comment_ctime":1660144012,"is_pvip":false,"replies":[{"id":128817,"content":"用logs看一下Ingress Controller的日志，再看看Ingress是否配置正确。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1660176256,"ip_address":"北京","comment_id":354176,"utype":1}],"discussion_count":3,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"我的Ingress Controller正常运行了，不过打开网页出错: 404 Not Found 下面一行显示nginx&#47;1.21.6。问题可能出在哪？","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583515,"discussion_content":"用logs看一下Ingress Controller的日志，再看看Ingress是否配置正确。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660176256,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1340617,"avatar":"https://static001.geekbang.org/account/avatar/00/14/74/c9/61924a65.jpg","nickname":"古铉","note":"","ucode":"C1D322C06B7895","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":594582,"discussion_content":"我是用前面搭建nginx的yaml文件改的，改的时候忘记修改参数启动参数-ingress-class的值了，修改完后可以这个问题解决了。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1669191077,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1155646,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKotsBr2icbYNYlRSlicGUD1H7lulSTQUAiclsEz9gnG5kCW9qeDwdYtlRMXic3V6sj9UrfKLPJnQojag/132","nickname":"ppd0705","note":"","ucode":"EB63D4E3FD1E9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583848,"discussion_content":"我是wp.test 302  跳转到 wp.test/wp-admin/install.php 遇到 404了， 发现是 pathType 协程 Exact了。要用Prefix","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660443566,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"湖南","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354080,"user_name":"陶乐思","can_delete":false,"product_type":"c1","uid":1961274,"ip_address":"北京","ucode":"45A996B75E8341","user_header":"https://static001.geekbang.org/account/avatar/00/1d/ed/3a/ab8faba0.jpg","comment_is_top":false,"comment_ctime":1660084856,"is_pvip":false,"replies":[{"id":128789,"content":"看看NodePort是否配置正确了，用kubectl get svc。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1660092407,"ip_address":"北京","comment_id":354080,"utype":1}],"discussion_count":5,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"部署完wordpress设置后遇到问题：\nhttp:&#47;&#47;192.168.1.29:30088&#47;\n无法访问此网站192.168.1.29 拒绝了我们的连接请求。\n\n192.168.1.29是Putty ssh到vm的ip地址，请问这个地址不对吗？应该用其他地址？","like_count":1,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583385,"discussion_content":"看看NodePort是否配置正确了，用kubectl get svc。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660092407,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1003511,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4f/f7/771ab517.jpg","nickname":"Kevin Chen","note":"","ucode":"5F8CCFFAE9153B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583466,"discussion_content":"应该是需要查一下节点Node的ip地址\nkuberctl get node -o wide\n其中的 INTERNAL-IP ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1660127634,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583455,"discussion_content":"换一个节点的IP地址试试，只要是NodePort，哪一个节点都可以。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660123216,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1961274,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/ed/3a/ab8faba0.jpg","nickname":"陶乐思","note":"","ucode":"45A996B75E8341","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583406,"discussion_content":"看上去是对的啊\nkubectl get svc wp-svc\nNAME     TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE\nwp-svc   NodePort   10.96.202.115   &lt;none&gt;        80:30088/TCP ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660103254,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"美国","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1087879,"avatar":"https://static001.geekbang.org/account/avatar/00/10/99/87/5066026c.jpg","nickname":"dao","note":"","ucode":"4181FB270462CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1961274,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/ed/3a/ab8faba0.jpg","nickname":"陶乐思","note":"","ucode":"45A996B75E8341","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584282,"discussion_content":"要看 node 的 IP，kubectl get node -o wide","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660721529,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":583406,"ip_address":"新加坡","group_id":0},"score":584282,"extra":""}]}]},{"had_liked":false,"id":393745,"user_name":"起司猫","can_delete":false,"product_type":"c1","uid":1018670,"ip_address":"广西","ucode":"D86EF6FBA10EAC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8b/2e/df74d56a.jpg","comment_is_top":false,"comment_ctime":1724751908,"is_pvip":false,"replies":[{"id":142974,"content":"nice","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1724814399,"ip_address":"上海","comment_id":393745,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"碰到了一个问题：访问网站时提示 Error establishing a database connection。然后我把我已经创建的pod 都手动用 ‘kubectl delete pod’删除，重新生成了 pod 以后，数据库连接就正常了。然后才想起来，我在第一次kubectl apply -f wp-dep.yml 的时候，确实在 wp-cm 里面配错了密码，后面修改过来重新 kubectl apply 了，但是因为用的不是 volume挂载的，所以已生成的 pod 里面的PASSPORT 并不会动态更新。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":650346,"discussion_content":"nice","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1724814400,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":389462,"user_name":"Geek3524","can_delete":false,"product_type":"c1","uid":3711529,"ip_address":"广东","ucode":"FEFB52D60CC897","user_header":"","comment_is_top":false,"comment_ctime":1712647843,"is_pvip":false,"replies":[{"id":141687,"content":"看看master是否去除了污点，是否是以worker node身份运行。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1712709373,"ip_address":"北京","comment_id":389462,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"Hi 老师，\n\n我可以在浏览器上通过worker node的地址访问到wp，但是master node的ip不行，这是正常的吗？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":641495,"discussion_content":"看看master是否去除了污点，是否是以worker node身份运行。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1712709373,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":388538,"user_name":"党","can_delete":false,"product_type":"c1","uid":1071974,"ip_address":"河北","ucode":"EE531DB3EA124D","user_header":"https://static001.geekbang.org/account/avatar/00/10/5b/66/ad35bc68.jpg","comment_is_top":false,"comment_ctime":1710371683,"is_pvip":false,"replies":[{"id":141468,"content":"good","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1710406137,"ip_address":"上海","comment_id":388538,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"测试了一下 pod用  hostNetwork: true可以跟节点宿主机绑定 但是这是随机行为 不知道跟哪个节点绑定","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":639235,"discussion_content":"good","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1710406137,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":386493,"user_name":"你真是个爱xio习的好孩子呀👳","can_delete":false,"product_type":"c1","uid":1965042,"ip_address":"上海","ucode":"22FA25FF7EE685","user_header":"https://static001.geekbang.org/account/avatar/00/1d/fb/f2/fe7f7add.jpg","comment_is_top":false,"comment_ctime":1704959229,"is_pvip":false,"replies":[{"id":140879,"content":"是不是没有安装nginx Ingress controller，找不到名字空间？","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1704961994,"ip_address":"上海","comment_id":386493,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"Error from server (NotFound): error when creating &quot;wp-kic.yaml&quot;: namespaces &quot;nginx-ingress&quot; not found， 不知道为什么","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635593,"discussion_content":"是不是没有安装nginx Ingress controller，找不到名字空间？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704961994,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":386492,"user_name":"你真是个爱xio习的好孩子呀👳","can_delete":false,"product_type":"c1","uid":1965042,"ip_address":"上海","ucode":"22FA25FF7EE685","user_header":"https://static001.geekbang.org/account/avatar/00/1d/fb/f2/fe7f7add.jpg","comment_is_top":false,"comment_ctime":1704958817,"is_pvip":false,"replies":[{"id":140880,"content":"可以按照课程里步骤来，逐步对照，看哪步有问题。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1704962034,"ip_address":"上海","comment_id":386492,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"老师你好，我在配置ingress 和ingress-controller的时候，并没有created service&#47;wp-kic-svc 这个pod，导致后面的工作没办法进行","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635594,"discussion_content":"可以按照课程里步骤来，逐步对照，看哪步有问题。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704962034,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":378898,"user_name":"chengyi","can_delete":false,"product_type":"c1","uid":1159322,"ip_address":"江苏","ucode":"0CB689D18FB5EF","user_header":"https://static001.geekbang.org/account/avatar/00/11/b0/9a/561e9d74.jpg","comment_is_top":false,"comment_ctime":1690951351,"is_pvip":false,"replies":[{"id":138072,"content":"不应该吧，不会存在浏览器的兼容问题，可能是别的原因。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1691027577,"ip_address":"北京","comment_id":378898,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"我用safari浏览器无法访问，换成chrome就可以了，这似乎也是一个坑","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":624876,"discussion_content":"不应该吧，不会存在浏览器的兼容问题，可能是别的原因。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1691027577,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":376339,"user_name":"周Sir","can_delete":false,"product_type":"c1","uid":1150143,"ip_address":"江苏","ucode":"905991012EFF53","user_header":"https://static001.geekbang.org/account/avatar/00/11/8c/bf/182ee8e6.jpg","comment_is_top":false,"comment_ctime":1686720430,"is_pvip":true,"replies":[{"id":137244,"content":"最近没太关注，可以在YAML里找找。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1686810046,"ip_address":"上海","comment_id":376339,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"最新的nginx-ingress的 default-server-secret跑到哪里去了","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":621087,"discussion_content":"最近没太关注，可以在YAML里找找。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1686810046,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":373454,"user_name":"Geek_ec6229","can_delete":false,"product_type":"c1","uid":3231579,"ip_address":"广东","ucode":"24DF2FDA6BCE13","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/tjZDHOybO07lltibjmDiaQKdpE1C3ul9c9wmUWwnVohS5fSEOPcfK2d9ZvKEHu6ibMLXYNUSrA23w08Ty5MFYMfzA/132","comment_is_top":false,"comment_ctime":1682519918,"is_pvip":false,"replies":[{"id":136394,"content":"逐个环节检查，先不通过Ingress controller，直接访问WordPress，看看是否正常。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1682564478,"ip_address":"北京","comment_id":373454,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100114501,"comment_content":"访问：https:&#47;&#47;wp.test&#47;wp-admin&#47;install.php 页面显示：\nUnable to connect\n\nAn error occurred during a connection to wp.test.\n\n    The site could be temporarily unavailable or too busy. Try again in a few moments.\n    If you are unable to load any pages, check your computer’s network connection.\n    If your computer or network is protected by a firewall or proxy, make sure that Firefox is permitted to access the web.\n\n查看ingress controller pod 日志显示：\n27.0.0.1 - - [26&#47;Apr&#47;2023:14:28:32 +0000] &quot;GET &#47; HTTP&#47;1.1&quot; 302 0 &quot;-&quot; &quot;curl&#47;7.81.0&quot; &quot;-&quot;\n127.0.0.1 - - [26&#47;Apr&#47;2023:14:29:21 +0000] &quot;GET &#47; HTTP&#47;1.1&quot; 302 0 &quot;-&quot; &quot;Mozilla&#47;5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko&#47;20100101 Firefox&#47;112.0&quot; &quot;-&quot;\n求求帮忙看下什么问题\n","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":616058,"discussion_content":"逐个环节检查，先不通过Ingress controller，直接访问WordPress，看看是否正常。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1682564478,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":372293,"user_name":"Geek_f2f06e","can_delete":false,"product_type":"c1","uid":3073745,"ip_address":"陕西","ucode":"B7AC635AFF7681","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/g4os8I4iaB6jn06PsvyqI1BooV5XbOC0vI3niaJ4I3SlAhkbBKG2eewlPHHJ4ROcDia18bbPFSZPDXXmgHXtrBlLg/132","comment_is_top":false,"comment_ctime":1680947557,"is_pvip":false,"replies":[{"id":135908,"content":"看看service是否哪里设置的不对。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1681013294,"ip_address":"北京","comment_id":372293,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"Service 对象是 NodePort 类型的，为什么还是只能在worker节点上访问 WordPress 服务。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":612932,"discussion_content":"看看service是否哪里设置的不对。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1681013294,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":370390,"user_name":"蔡晓慧","can_delete":false,"product_type":"c1","uid":1588301,"ip_address":"中国香港","ucode":"8D177D2B37BD6D","user_header":"https://static001.geekbang.org/account/avatar/00/18/3c/4d/3dec4bfe.jpg","comment_is_top":false,"comment_ctime":1678780383,"is_pvip":false,"replies":[{"id":135096,"content":"应该是没有安装Nginx Ingress controller的crd资源吧，看一下GitHub上的脚本，把所有的yaml都安装上。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1678848712,"ip_address":"上海","comment_id":370390,"utype":1}],"discussion_count":2,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"E0315 07:51:23.286819       1 reflector.go:138] pkg&#47;mod&#47;k8s.io&#47;client-go@v0.23.6&#47;tools&#47;cache&#47;reflector.go:167: Failed to watch *v1.VirtualServerRoute: failed to list *v1.VirtualServerRoute: the server could not find the requested resource (get virtualserverroutes.k8s.nginx.org)\n\n老师，ingress-controller pod里的日志报上面这个错误，是ingress-controller安装的有问题吗？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":609138,"discussion_content":"应该是没有安装Nginx Ingress controller的crd资源吧，看一下GitHub上的脚本，把所有的yaml都安装上。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678848713,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1588301,"avatar":"https://static001.geekbang.org/account/avatar/00/18/3c/4d/3dec4bfe.jpg","nickname":"蔡晓慧","note":"","ucode":"8D177D2B37BD6D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":609149,"discussion_content":"是的，谢谢老师，没有安装crd，已经解决了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678849352,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"中国香港","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":369023,"user_name":"一久","can_delete":false,"product_type":"c1","uid":3297421,"ip_address":"重庆","ucode":"287F9C36D154CD","user_header":"https://static001.geekbang.org/account/avatar/00/32/50/8d/ded8482f.jpg","comment_is_top":false,"comment_ctime":1677027849,"is_pvip":false,"replies":[{"id":134378,"content":"连不上数据库，看看dns是否正常，用命令行连接mariaDB试试看问题在哪里。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1677036578,"ip_address":"上海","comment_id":369023,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"Error establishing a database connection\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    app: maria-dep\n  name: maria-svc\nspec:\n  ports:\n  - port: 3306\n    protocol: TCP\n    targetPort: 3306\n  selector:\n    app: maria-dep\n\n\napiVersion: v1\nkind: Service\nmetadata:\n  labels:\n    app: wp-dep\n  name: wp-svc\n\nspec:\n  ports:\n  - name: http80\n    port: 80\n    protocol: TCP\n    targetPort: 80\n\n  selector:\n    app: wp-dep\n老师这个报错咋排查\n这是两个service yaml文件","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":606219,"discussion_content":"连不上数据库，看看dns是否正常，用命令行连接mariaDB试试看问题在哪里。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677036578,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":368420,"user_name":"lpqoang","can_delete":false,"product_type":"c1","uid":1190090,"ip_address":"广东","ucode":"EB1E09117503A3","user_header":"https://static001.geekbang.org/account/avatar/00/12/28/ca/47333d8b.jpg","comment_is_top":false,"comment_ctime":1676334836,"is_pvip":false,"replies":[{"id":134185,"content":"看看coreDNS是否工作正常。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1676352970,"ip_address":"上海","comment_id":368420,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"Nodeport方式可以访问， 使用inggress配置域名解析的方式会404，可能是什么问题呢？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":603894,"discussion_content":"看看coreDNS是否工作正常。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1676352971,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":366313,"user_name":"zero","can_delete":false,"product_type":"c1","uid":1684113,"ip_address":"浙江","ucode":"27019747CA63FF","user_header":"https://static001.geekbang.org/account/avatar/00/19/b2/91/714c0f07.jpg","comment_is_top":false,"comment_ctime":1673577464,"is_pvip":false,"replies":[{"id":133482,"content":"不是很了解WordPress的工作机制，感谢分析。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1673585220,"ip_address":"北京","comment_id":366313,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"pod数量设置为1个，就可以了。wp.test这个域名是不是随机指向多个后端pod，每个pod域名也不一样，而wordpress他使用cookie，感觉存在跨域问题","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":599554,"discussion_content":"不是很了解WordPress的工作机制，感谢分析。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673585220,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":363037,"user_name":"菲茨杰拉德","can_delete":false,"product_type":"c1","uid":1875922,"ip_address":"北京","ucode":"4EB29359F39862","user_header":"https://static001.geekbang.org/account/avatar/00/1c/9f/d2/b6d8df48.jpg","comment_is_top":false,"comment_ctime":1669176125,"is_pvip":false,"replies":[{"id":132032,"content":"Ingress Controller可以在专用的nginx-ingress里运行，没有问题的，可以再看看GitHub上的YAML 。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1669182079,"ip_address":"北京","comment_id":363037,"utype":1}],"discussion_count":2,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"在部署controller之前命名空间都是默认的。后面deploy换成了nginx-ingress,deploy和pod都是在这个空间下，有问题 找不到配置。应该空间一样\n","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":594559,"discussion_content":"Ingress Controller可以在专用的nginx-ingress里运行，没有问题的，可以再看看GitHub上的YAML 。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1669182079,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1875922,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/9f/d2/b6d8df48.jpg","nickname":"菲茨杰拉德","note":"","ucode":"4EB29359F39862","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":594566,"discussion_content":"好，我再试下。多谢老师","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1669185802,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":594559,"ip_address":"北京","group_id":0},"score":594566,"extra":""}]}]},{"had_liked":false,"id":361407,"user_name":"ybc","can_delete":false,"product_type":"c1","uid":2685834,"ip_address":"上海","ucode":"F3CD0B857B1524","user_header":"https://static001.geekbang.org/account/avatar/00/28/fb/8a/3e8f42f1.jpg","comment_is_top":false,"comment_ctime":1667472395,"is_pvip":false,"replies":[{"id":131445,"content":"感觉像是集群里的网络问题，看看网络插件的状态。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1667474807,"ip_address":"上海","comment_id":361407,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"用域名请求service经常失败，查看coredns的日志显示如下报错： [ERROR] plugin&#47;errors: 2 ngx-svc. AAAA: read udp 10.244.1.195:54301-&gt;100.100.2.138:53: i&#47;o timeout， 不知道有没有朋友遇到相同的问题的，求指导。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592550,"discussion_content":"感觉像是集群里的网络问题，看看网络插件的状态。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667474807,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":359292,"user_name":"Geek_4e0320","can_delete":false,"product_type":"c1","uid":3168362,"ip_address":"北京","ucode":"EB758842CA89AE","user_header":"","comment_is_top":false,"comment_ctime":1665393504,"is_pvip":false,"replies":[{"id":130670,"content":"先看看Nginx Ingress Controller是否安装好了，记得要安装crd资源，然后Ingress Controller的参数里要加上-Ingress-class。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1665404688,"ip_address":"北京","comment_id":359292,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100114501,"comment_content":" no matches for kind &quot;IngressClass&quot; in version &quot;networking.k8s.io&#47;v1&quot; 老师这个改成什么啊","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589935,"discussion_content":"先看看Nginx Ingress Controller是否安装好了，记得要安装crd资源，然后Ingress Controller的参数里要加上-Ingress-class。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665404688,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":359164,"user_name":"谁道西风独自凉","can_delete":false,"product_type":"c1","uid":1752264,"ip_address":"北京","ucode":"77620FC906B741","user_header":"https://static001.geekbang.org/account/avatar/00/1a/bc/c8/7c864cca.jpg","comment_is_top":false,"comment_ctime":1665298927,"is_pvip":false,"replies":[{"id":130643,"content":"看看是不是本地没有配置hosts域名解析。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1665355988,"ip_address":"北京","comment_id":359164,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"请教一个问题，所有pod都启动没问题，用ip:30088访问没问题，但是用wp.test访问报错500 Internal Privoxy Error.","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589838,"discussion_content":"看看是不是本地没有配置hosts域名解析。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665355988,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358595,"user_name":"alexgreenbar","can_delete":false,"product_type":"c1","uid":1003655,"ip_address":"北京","ucode":"87ED7233E2767C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/50/87/dde718fa.jpg","comment_is_top":false,"comment_ctime":1664448059,"is_pvip":false,"replies":[{"id":130455,"content":"1G内存还是小了一些，对于Kubernetes运行有点困难，如果可以的话适当加大一些。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1664459649,"ip_address":"北京","comment_id":358595,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100114501,"comment_content":"搭建wordpress的过程中，由于worker node资源有限（1core, 1G, 20G）, 经常某些pod就处于Evicted状态，但稍微等等，系统就能自动恢复，真正体现了k8s的强大之处。","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589162,"discussion_content":"1G内存还是小了一些，对于Kubernetes运行有点困难，如果可以的话适当加大一些。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1664459649,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358214,"user_name":"Geek_b03495","can_delete":false,"product_type":"c1","uid":2206114,"ip_address":"北京","ucode":"EA81E4106DB2D1","user_header":"","comment_is_top":false,"comment_ctime":1664073386,"is_pvip":false,"replies":[{"id":130361,"content":"看看service是否配置正确。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1664092537,"ip_address":"北京","comment_id":358214,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100114501,"comment_content":"访问地址:Error establishing a database connection啥情况,数据库配置没问题啊","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588770,"discussion_content":"看看service是否配置正确。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1664092537,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":357218,"user_name":"西门吹牛","can_delete":false,"product_type":"c1","uid":1508990,"ip_address":"北京","ucode":"E5D3624DDE1E83","user_header":"https://static001.geekbang.org/account/avatar/00/17/06/7e/735968e2.jpg","comment_is_top":false,"comment_ctime":1663072298,"is_pvip":false,"replies":[{"id":130008,"content":"学习永远不晚，加油。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1663109739,"ip_address":"北京","comment_id":357218,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100114501,"comment_content":"最近一月拉下好多课，因为一些事耽搁了，哎","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587493,"discussion_content":"学习永远不晚，加油。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663109739,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356283,"user_name":"$侯","can_delete":false,"product_type":"c1","uid":1019939,"ip_address":"北京","ucode":"488B1BD3924E7E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/90/23/5c74e9b7.jpg","comment_is_top":false,"comment_ctime":1662105643,"is_pvip":false,"replies":[{"id":129686,"content":"看看看coredns是否正常。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1662110121,"ip_address":"北京","comment_id":356283,"utype":1}],"discussion_count":2,"race_medal":0,"score":6,"product_id":100114501,"comment_content":"用域名访问一直返回HTTP ERROR 502，用IP 30088形式可以，请教下老师排查错误的思路","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586334,"discussion_content":"看看看coredns是否正常。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662110121,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1019939,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/23/5c74e9b7.jpg","nickname":"$侯","note":"","ucode":"488B1BD3924E7E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":586344,"discussion_content":"coredns describe 出来的信息：\nEvents:\n  Type     Reason            Age                From               Message\n  ----     ------            ----               ----               -------\n  Warning  FailedScheduling  43m (x2 over 44m)  default-scheduler  0/1 nodes are available: 1 node(s) had taint {node.kubernetes.io/not-ready: }, that the pod didn&#39;t tolerate.\n  Normal   Scheduled         42m                default-scheduler  Successfully assigned kube-system/coredns-64897985d-xdtsw to master\n  Normal   Pulled            42m                kubelet            Container image &#34;k8s.gcr.io/coredns/coredns:v1.8.6&#34; already present on machine\n  Normal   Created           42m                kubelet            Created container coredns\n  Normal   Started           42m                kubelet            Started container coredns\n  Warning  FailedMount       34m                kubelet            MountVolume.SetUp failed for volume &#34;config-volume&#34; : failed to sync configmap cache: timed out waiting for the condition\n  Warning  FailedMount       34m                kubelet            MountVolume.SetUp failed for volume &#34;kube-api-access-4s5z8&#34; : failed to sync configmap cache: timed out waiting for the condition\n  Warning  Unhealthy         33m                kubelet            Liveness probe failed: Get &#34;http://10.10.0.3:8080/health&#34;: context deadline exceeded (Client.Timeout exceeded while awaiting headers)\n  Warning  Unhealthy         26m (x2 over 33m)  kubelet            Readiness probe failed: Get &#34;http://10.10.0.3:8181/ready&#34;: context deadline exceeded (Client.Timeout exceeded while awaiting headers)\n  Warning  NodeNotReady      21m (x2 over 26m)  node-controller    Node is not ready\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662120315,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":586334,"ip_address":"浙江","group_id":0},"score":586344,"extra":""}]}]},{"had_liked":false,"id":355066,"user_name":"摊牌","can_delete":false,"product_type":"c1","uid":1453182,"ip_address":"北京","ucode":"F142596BFE4594","user_header":"https://static001.geekbang.org/account/avatar/00/16/2c/7e/f1efd18b.jpg","comment_is_top":false,"comment_ctime":1661050728,"is_pvip":false,"replies":[{"id":129229,"content":"Ingress Controller有两种部署方式，Deployment和DaemonSet两种，可以自己选一种。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1661144425,"ip_address":"北京","comment_id":355066,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100114501,"comment_content":"本节结尾的Ingress Controller对象为啥按照deployment创建呢？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584812,"discussion_content":"Ingress Controller有两种部署方式，Deployment和DaemonSet两种，可以自己选一种。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661144425,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354134,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"北京","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1660119392,"is_pvip":false,"replies":[{"id":128806,"content":"\n1. 需要安装kubectl，然后拷贝config文件，做法和master节点一样。\n\n2. 这个就是kubeadm的优势了，应该是Linux系统里的sysctl之类的吧，我没有关注过。\n\n3.课程里的wp-kic.yml没有创建Service对象，在GitHub的wp-kic.yml里有，可以参考一下。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1660122849,"ip_address":"北京","comment_id":354134,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100114501,"comment_content":"请教老师几个问题：\nQ1：worker节点，用“kubeadm join”安装后，不能执行kubectl命令，为什么？\nQ2：用minikube时，每次开机都要执行命令来启动集群。采用kubeadm后，每次开机好像自动运行了，这个是在哪里控制的？（不清楚为什么就自动运行了）\nQ3：最后创建Ingress Controller，执行结果没有service。\n专栏中执行“kubectl apply -f wp-ing.yml -f wp-kic.yml”后，查看，有四项内容，最后一项是“service&#47;wp-kic-svc created”，但我的执行结果只有三项，并没有service。这个service需要在wp-kic.yml中定义吗？","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583453,"discussion_content":"\n1. 需要安装kubectl，然后拷贝config文件，做法和master节点一样。\n\n2. 这个就是kubeadm的优势了，应该是Linux系统里的sysctl之类的吧，我没有关注过。\n\n3.课程里的wp-kic.yml没有创建Service对象，在GitHub的wp-kic.yml里有，可以参考一下。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660122849,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354128,"user_name":"密码123456","can_delete":false,"product_type":"c1","uid":1126593,"ip_address":"北京","ucode":"9889463CC0EA71","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/c1/2dde6700.jpg","comment_is_top":false,"comment_ctime":1660118087,"is_pvip":false,"replies":[{"id":128809,"content":"可能是没有安装好Ingress Controller的相关YAML，比如rbac等等，再对照课程看看。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1660134259,"ip_address":"北京","comment_id":354128,"utype":1}],"discussion_count":4,"race_medal":0,"score":6,"product_id":100114501,"comment_content":"Error when getting IngressClass ngx-ink: ingressclasses.networking.k8s.io &quot;ngx-ink&quot; is forbidden: User &quot;system:serviceaccount:nginx-ingress:default&quot; cannot get resource &quot;ingressclasses&quot; in API group &quot;networking.k8s.io&quot; at the cluster scope。这个错误怎么解决呀","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583477,"discussion_content":"可能是没有安装好Ingress Controller的相关YAML，比如rbac等等，再对照课程看看。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660134259,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1126593,"avatar":"https://static001.geekbang.org/account/avatar/00/11/30/c1/2dde6700.jpg","nickname":"密码123456","note":"","ucode":"9889463CC0EA71","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":583882,"discussion_content":"一直都是看着课程手写yaml，突然这次不行了，把git上脚本复制下来就可以了。又重新刷了一遍课程，也看了分享的ingress control的官方教程。才发现，有安装脚本例子。同时也总结了一下，在自己不懂的时候，不能深究。等知识体系比较完备的时候，再深入了解。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660463310,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":583477,"ip_address":"江苏","group_id":0},"score":583882,"extra":""}]},{"author":{"id":1155646,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKotsBr2icbYNYlRSlicGUD1H7lulSTQUAiclsEz9gnG5kCW9qeDwdYtlRMXic3V6sj9UrfKLPJnQojag/132","nickname":"ppd0705","note":"","ucode":"EB63D4E3FD1E9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583849,"discussion_content":"需要执行一下 git仓库 ingress 目录 setup.sh 脚本","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660443611,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"湖南","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1126593,"avatar":"https://static001.geekbang.org/account/avatar/00/11/30/c1/2dde6700.jpg","nickname":"密码123456","note":"","ucode":"9889463CC0EA71","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1155646,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKotsBr2icbYNYlRSlicGUD1H7lulSTQUAiclsEz9gnG5kCW9qeDwdYtlRMXic3V6sj9UrfKLPJnQojag/132","nickname":"ppd0705","note":"","ucode":"EB63D4E3FD1E9A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583881,"discussion_content":"多谢，我一直都是跟着课程手写yaml。突然这次不行了。执行git上的脚本就可以了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660462948,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":583849,"ip_address":"江苏","group_id":0},"score":583881,"extra":""}]}]},{"had_liked":false,"id":354125,"user_name":"校歌","can_delete":false,"product_type":"c1","uid":2054611,"ip_address":"北京","ucode":"CD257668BB1A33","user_header":"https://static001.geekbang.org/account/avatar/00/1f/59/d3/696b1702.jpg","comment_is_top":false,"comment_ctime":1660115530,"is_pvip":true,"replies":[{"id":128811,"content":"里面的具体工作流程可能得看代码了，我也没太细研究过。\n\n大概来说差不多，因为Kubernetes有controller-manager等组件，能够即时监控到Pod的变化，就会通知Service对象。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1660134462,"ip_address":"北京","comment_id":354125,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100114501,"comment_content":"老师你好，有个问题一直不太理解。\n\n文中：节点上的 kube-proxy 组件会实时维护被代理的 Pod 状态，保证 Service 只会转发给健康的 Pod。\n\n这个是怎么做到的呢？能展开讲解下吗？\n\n我之前的理解是这样的： 通过svc访问服务时，svc 根据 selector 选择pod(中间有endpoints 暂不考虑)，对应的流量转发模型是1:n ，如果某一个pod crash，IP:Port无法提供服务，svc 感知其转发链路变更为1: n-1，需要经过svc controller 的工作周期发现 这个POD-IP不可用， 这个动作是有周期的， 不是实时的 ，有可能出现通过svc访问服务时，流量被转发到Crash的pod上。\n","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583479,"discussion_content":"里面的具体工作流程可能得看代码了，我也没太细研究过。\n\n大概来说差不多，因为Kubernetes有controller-manager等组件，能够即时监控到Pod的变化，就会通知Service对象。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660134462,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354083,"user_name":"西门吹牛","can_delete":false,"product_type":"c1","uid":1508990,"ip_address":"北京","ucode":"E5D3624DDE1E83","user_header":"https://static001.geekbang.org/account/avatar/00/17/06/7e/735968e2.jpg","comment_is_top":false,"comment_ctime":1660088960,"is_pvip":false,"replies":[{"id":128790,"content":"还得自己动手做出来才行。","user_name":"作者回复","user_name_real":"编辑","uid":1181974,"ctime":1660092434,"ip_address":"北京","comment_id":354083,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100114501,"comment_content":"思考题，1.能2.能，努力一切皆有可能🤔","like_count":0,"discussions":[{"author":{"id":1181974,"avatar":"https://static001.geekbang.org/account/avatar/00/12/09/16/1161017c.jpg","nickname":"罗剑锋","note":"","ucode":"95678C988F24AB","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583386,"discussion_content":"还得自己动手做出来才行。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660092434,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":389088,"user_name":"Geek_07ead6","can_delete":false,"product_type":"c1","uid":1714992,"ip_address":"广东","ucode":"424137ADA9AA23","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoREZlw6JWh1OXYvcKhOToBPCSqVr33Vhc0gmW9jNT3JHtW7NtaiaiaNJicjjxyVia7Oec3Qq1bzLGreQ/132","comment_is_top":false,"comment_ctime":1711537853,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":6,"product_id":100114501,"comment_content":"老师，加上hostNetwork: true后，Pod无法正常运行，describe一下显示如下信息：\nReadiness probe failed: Get &quot;http:&#47;&#47;192.168.56.105:8081&#47;nginx-ready&quot;: dial tcp 192.168.56.105:8081: connect: connection refused\n\n192.168.56.105是我的worker节点IP，登录到这个节点上进行telnet也是提示“连接被拒绝”，去掉hostNetwork: true就可以正常运行，是需要设置哪里吗？\n","like_count":0}]}