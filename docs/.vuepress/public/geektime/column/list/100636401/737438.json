{"id":737438,"title":"07ï½œå¯¹å†…çš„ä¿æŠ¤ï¼šå¼•å…¥é—¨é¢æ¨¡å¼å°è£…å†…éƒ¨å®ç°ç±»","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯éƒ­å±¹ã€‚ä»Šå¤©æˆ‘ä»¬ç»§ç»­æ‰‹å†™MiniTomcatã€‚</p><p>åœ¨å‰é¢çš„å­¦ä¹ å†…å®¹ä¸­ï¼Œæˆ‘ä»¬ä¸ºäº†ç¬¦åˆServletè§„èŒƒï¼Œæ–°å¢äº†HttpRequestä¸HttpResponseç±»ï¼Œä½†æˆªæ­¢åˆ°ç°åœ¨æˆ‘ä»¬åªå¯¹Requestè¯·æ±‚ç›¸å…³çš„ä»£ç è¿›è¡Œäº†å®ç°ï¼Œæ‰€ä»¥è¿™èŠ‚è¯¾æˆ‘ä»¬å°±æ¥æ”¹é€ Responseè¿”å›ä»£ç ã€‚</p><p>å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿæ³¨æ„åˆ°ï¼Œåœ¨HttpProcessorç±»é‡Œï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨çš„æ˜¯HttpRequestä¸HttpResponseï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡è¦ä¼ å…¥Servleté‡Œï¼Œä½†åœ¨è¿™ä¸¤ä¸ªç±»ä¸­æˆ‘ä»¬ä¹Ÿå®šä¹‰äº†è®¸å¤šå†…éƒ¨çš„æ–¹æ³•ï¼Œä¸€æ—¦è¢«ç”¨æˆ·çŸ¥æ™“æˆ‘ä»¬çš„å®ç°ç±»ï¼Œé‚£ä¹ˆè¿™äº›å†…éƒ¨æ–¹æ³•å°±æš´éœ²åœ¨ç”¨æˆ·é¢å‰äº†ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¸æ„¿çœ‹åˆ°çš„ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬éœ€è¦è§„é¿çš„ã€‚å› æ­¤è¿™èŠ‚è¯¾æˆ‘ä»¬è®¡åˆ’ç”¨é—¨é¢ï¼ˆFacadeï¼‰è®¾è®¡æ¨¡å¼æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>ä¸‹é¢å°±è®©æˆ‘ä»¬ä¸€èµ·æ¥åŠ¨æ‰‹å®ç°ã€‚</p><h2>é¡¹ç›®ç»“æ„</h2><p>è¿™èŠ‚è¯¾çš„é¡¹ç›®ç»“æ„ä¸»è¦æ–°å¢äº†HttpRequestFacade.javaä¸HttpResponseFacade.javaä¸¤ä¸ªç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-plain\">MiniTomcat\nâ”œâ”€ src\nâ”‚  â”œâ”€ main\nâ”‚  â”‚  â”œâ”€ java\nâ”‚  â”‚  â”‚  â”œâ”€ server\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ DefaultHeaders.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpConnector.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpHeader.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpProcessor.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpRequest.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpRequestFacade.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpRequestLine.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpResponse.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpResponseFacade.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpServer.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Request.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Response.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ ServletProcessor.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ SocketInputStream.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ StatisResourceProcessor.java\nâ”‚  â”‚  â”œâ”€ resources\nâ”‚  â”œâ”€ test\nâ”‚  â”‚  â”œâ”€ java\nâ”‚  â”‚  â”‚  â”œâ”€ test\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HelloServlet.java\nâ”‚  â”‚  â”œâ”€ resources\nâ”œâ”€ webroot\nâ”‚  â”œâ”€ test\nâ”‚  â”‚  â”œâ”€ HelloServlet.class\nâ”‚  â”œâ”€ hello.txt\nâ”œâ”€ pom.xml\n</code></pre><!-- [[[read_end]]] --><h2>Responseè¿”å›ä¿¡æ¯è§£æ</h2><p>ä¸Šä¸€èŠ‚è¯¾æˆ‘ä»¬å®Œæˆäº†Requestè¯·æ±‚ä¿¡æ¯è§£æï¼Œæœ‰äº†å‰æ–‡é“ºå«ï¼Œæ¥ä¸‹æ¥é’ˆå¯¹Responseçš„æ”¹é€ å°±å®¹æ˜“å¾ˆå¤šäº†ã€‚</p><p>æˆ‘ä»¬åœ¨å‰é¢æåˆ°è¿‡ï¼ŒHTTPåè®®ä¸­è§„å®šResponseè¿”å›æ ¼å¼ç”±ä»¥ä¸‹å‡ éƒ¨åˆ†ç»„æˆï¼šçŠ¶æ€è¡Œã€å“åº”å¤´ã€ç©ºè¡Œã€å“åº”ä½“ã€‚æˆ‘ä»¬å¸¸ç”¨çš„çŠ¶æ€ç ä¸€èˆ¬ä¸º200ã€401ã€404ã€500ã€503ã€504ç­‰ï¼Œæˆ‘ä»¬åœ¨HttpResponseé‡Œç”¨switchæ¡ä»¶è¯­å¥å…ˆå…³è”å¸¸ç”¨çš„çŠ¶æ€ç ä¸çŠ¶æ€ä¿¡æ¯ã€‚</p><pre><code class=\"language-java\">package server;\npublic class HttpResponse implements HttpServletResponse {\n  protected String getStatusMessage(int status) {\n    switch (status) {\n        case SC_OK:\n            return (\"OK\");\n        case SC_ACCEPTED:\n            return (\"Accepted\");\n        case SC_BAD_GATEWAY:\n            return (\"Bad Gateway\");\n        case SC_BAD_REQUEST:\n            return (\"Bad Request\");\n        case SC_CONTINUE:\n            return (\"Continue\");\n        case SC_FORBIDDEN:\n            return (\"Forbidden\");\n        case SC_INTERNAL_SERVER_ERROR:\n            return (\"Internal Server Error\");\n        case SC_METHOD_NOT_ALLOWED:\n            return (\"Method Not Allowed\");\n        case SC_NOT_FOUND:\n            return (\"Not Found\");\n        case SC_NOT_IMPLEMENTED:\n            return (\"Not Implemented\");\n        case SC_REQUEST_URI_TOO_LONG:\n            return (\"Request URI Too Long\");\n        case SC_SERVICE_UNAVAILABLE:\n            return (\"Service Unavailable\");\n        case SC_UNAUTHORIZED:\n            return (\"Unauthorized\");\n        default:\n            return (\"HTTP Response Status \" + status);\n    }\n}\n</code></pre><p>å…¶ä¸­å®šä¹‰çš„çŠ¶æ€å¸¸é‡éƒ½æ¥è‡ªHttpServletResponseé‡Œçš„å®šä¹‰ã€‚<br>\næ¥ä¸‹æ¥æˆ‘ä»¬å…³æ³¨å¤´éƒ¨ä¿¡æ¯çš„æ“ä½œï¼Œä½¿ç”¨headersè¿™æ ·ä¸€ä¸ªconcurrentHashMapå­˜å‚¨å¤´éƒ¨çš„é”®å€¼ä¿¡æ¯ï¼Œé‡Œé¢æ˜¯content-lengthå’Œcontent-typeçš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜ä¼šè®¾ç½®ç›¸å…³å±æ€§ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-java\">public class HttpResponse implements HttpServletResponse {\n    Map&lt;String, String&gt; headers = new ConcurrentHashMap&lt;&gt;();\n    @Override\n    public void addHeader(String name, String value) {\n        headers.put(name, value);\n        if (name.toLowerCase() == DefaultHeaders.CONTENT_LENGTH_NAME) {\n            setContentLength(Integer.parseInt(value));\n        }\n        if (name.toLowerCase() == DefaultHeaders.CONTENT_TYPE_NAME) {\n            setContentType(value);\n        }\n    }\n    \n    @Override\n    public void setHeader(String name, String value) {\n        headers.put(name, value);\n        if (name.toLowerCase() == DefaultHeaders.CONTENT_LENGTH_NAME) {\n            setContentLength(Integer.parseInt(value));\n        }\n        if (name.toLowerCase() == DefaultHeaders.CONTENT_TYPE_NAME) {\n            setContentType(value);\n        }\n    }\n}\n</code></pre><p>æœ‰äº†å†…éƒ¨çš„å¤´éƒ¨ä¿¡æ¯ï¼Œæˆ‘ä»¬è¿˜ä¼šæä¾›ä¸€ä¸ªsendHeadersæ–¹æ³•ï¼ŒæŒ‰ç…§HTTPåè®®çš„è§„å®šæ‹¼æ¥ï¼ŒåŒ…å«çŠ¶æ€è¡Œã€å¤´ä¿¡æ¯å’Œç©ºè¡Œï¼Œå°†Headeræ‰“å°å‡ºæ¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-java\">public void sendHeaders() throws IOException {\n    PrintWriter outputWriter = getWriter();\n    //ä¸‹é¢è¿™ä¸€ç«¯æ˜¯è¾“å‡ºçŠ¶æ€è¡Œ\n    outputWriter.print(this.getProtocol());\n    outputWriter.print(\" \");\n    outputWriter.print(status);\n    if (message != null) {\n        outputWriter.print(\" \");\n        outputWriter.print(message);\n    }\n    outputWriter.print(\"\\r\\n\");\n    \n    if (getContentType() != null) {\n        outputWriter.print(\"Content-Type: \" + getContentType() + \"\\r\\n\");\n    }\n    if (getContentLength() &gt;= 0) {\n        outputWriter.print(\"Content-Length: \" + getContentLength() + \"\\r\\n\");\n    }\n    \n    //è¾“å‡ºå¤´ä¿¡æ¯\n    Iterator&lt;String&gt; names = headers.keySet().iterator();\n    while (names.hasNext()) {\n        String name = names.next();\n        String value = headers.get(name);\n        outputWriter.print(name);\n        outputWriter.print(\": \");\n        outputWriter.print(value);\n        outputWriter.print(\"\\r\\n\");\n    }\n    \n    //æœ€åè¾“å‡ºç©ºè¡Œ\n    outputWriter.print(\"\\r\\n\");\n    outputWriter.flush();\n}\n</code></pre><p>å®Œæ•´çš„HttpResponseæ”¹é€ å¦‚ä¸‹ï¼Œç”±äºä»£ç å¤ªé•¿ï¼Œå…¶ä¸­éå…³é”®çš„å®ç°æ–¹æ³•å°±ä¸åˆ—åœ¨è¿™é‡Œäº†ã€‚</p><pre><code class=\"language-java\">package server;\npublic class HttpResponse implements HttpServletResponse {\n    HttpRequest request;\n    OutputStream output;\n    PrintWriter writer;\n    String contentType = null;\n    long contentLength = -1;\n    String charset = null;\n    String characterEncoding = null;\n    String protocol = \"HTTP/1.1\";\n    //headersæ˜¯ä¸€ä¸ªä¿å­˜å¤´ä¿¡æ¯çš„map\n    Map&lt;String, String&gt; headers = new ConcurrentHashMap&lt;&gt;();\n    //é»˜è®¤è¿”å›OK\n    String message = getStatusMessage(HttpServletResponse.SC_OK);\n    int status = HttpServletResponse.SC_OK;\n    \n    public HttpResponse(OutputStream output) {\n        this.output = output;\n    }\n    public void setRequest(HttpRequest request) {\n        this.request = request;\n    }\n    //çŠ¶æ€ç ä»¥åŠæ¶ˆæ¯æ–‡æœ¬ï¼Œæ²¡æœ‰è€ƒè™‘å›½é™…åŒ–\n    protected String getStatusMessage(int status) {\n        switch (status) {\n            case SC_OK:\n                return (\"OK\");\n            case SC_ACCEPTED:\n                return (\"Accepted\");\n            case SC_BAD_GATEWAY:\n                return (\"Bad Gateway\");\n            case SC_BAD_REQUEST:\n                return (\"Bad Request\");\n            case SC_CONTINUE:\n                return (\"Continue\");\n            case SC_FORBIDDEN:\n                return (\"Forbidden\");\n            case SC_INTERNAL_SERVER_ERROR:\n                return (\"Internal Server Error\");\n            case SC_METHOD_NOT_ALLOWED:\n                return (\"Method Not Allowed\");\n            case SC_NOT_FOUND:\n                return (\"Not Found\");\n            case SC_NOT_IMPLEMENTED:\n                return (\"Not Implemented\");\n            case SC_REQUEST_URI_TOO_LONG:\n                return (\"Request URI Too Long\");\n            case SC_SERVICE_UNAVAILABLE:\n                return (\"Service Unavailable\");\n            case SC_UNAUTHORIZED:\n                return (\"Unauthorized\");\n            default:\n                return (\"HTTP Response Status \" + status);\n        }\n    }\n    public void sendHeaders() throws IOException {\n        PrintWriter outputWriter = getWriter();\n        //ä¸‹é¢è¿™ä¸€ç«¯æ˜¯è¾“å‡ºçŠ¶æ€è¡Œ\n        outputWriter.print(this.getProtocol());\n        outputWriter.print(\" \");\n        outputWriter.print(status);\n        if (message != null) {\n            outputWriter.print(\" \");\n            outputWriter.print(message);\n        }\n        outputWriter.print(\"\\r\\n\");\n        if (getContentType() != null) {\n            outputWriter.print(\"Content-Type: \" + getContentType() + \"\\r\\n\");\n        }\n        if (getContentLength() &gt;= 0) {\n            outputWriter.print(\"Content-Length: \" + getContentLength() + \"\\r\\n\");\n        }\n        //è¾“å‡ºå¤´ä¿¡æ¯\n        Iterator&lt;String&gt; names = headers.keySet().iterator();\n        while (names.hasNext()) {\n            String name = names.next();\n            String value = headers.get(name);\n            outputWriter.print(name);\n            outputWriter.print(\": \");\n            outputWriter.print(value);\n            outputWriter.print(\"\\r\\n\");\n        }\n        //æœ€åè¾“å‡ºç©ºè¡Œ\n        outputWriter.print(\"\\r\\n\");\n        outputWriter.flush();\n    }\n    @Override\n    public String getCharacterEncoding() {\n        return this.characterEncoding;\n    }\n    @Override\n    public String getContentType() {\n        return this.contentType;\n    }\n    @Override\n    public PrintWriter getWriter() throws IOException {\n        writer = new PrintWriter(new OutputStreamWriter(output, getCharacterEncoding()), true);\n        return writer;\n    }\n    @Override\n    public void setCharacterEncoding(String arg0) {\n        this.characterEncoding = arg0;\n    }\n    @Override\n    public void setContentType(String arg0) {\n        this.contentType = arg0;\n    }\n    @Override\n    public void addHeader(String name, String value) {\n        headers.put(name, value);\n        if (name.toLowerCase() == DefaultHeaders.CONTENT_LENGTH_NAME) {\n            setContentLength(Integer.parseInt(value));\n        }\n        if (name.toLowerCase() == DefaultHeaders.CONTENT_TYPE_NAME) {\n            setContentType(value);\n        }\n    }\n    @Override\n    public String getHeader(String name) {\n        return headers.get(name);\n    }\n    @Override\n    public Collection&lt;String&gt; getHeaderNames() {\n        return headers.keySet();\n    }\n    public void setHeader(String name, String value) {\n        headers.put(name, value);\n        if (name.toLowerCase() == DefaultHeaders.CONTENT_LENGTH_NAME) {\n            setContentLength(Integer.parseInt(value));\n        }\n        if (name.toLowerCase() == DefaultHeaders.CONTENT_TYPE_NAME) {\n            setContentType(value);\n        }\n    }\n\n</code></pre><h2>Processorä¸­çš„æ”¹é€ </h2><p>ä¿®æ”¹å®Œresponseä¹‹åï¼Œè‡ªç„¶åœ°ï¼Œæˆ‘ä»¬åœ¨HttpProcessorä¸­ï¼Œå°†åŸæ¥å¼•ç”¨æˆ–åˆå§‹åŒ–Responseç±»çš„åœ°æ–¹ï¼Œå…¨éƒ¨ç”¨HttpResponseæ›¿ä»£ã€‚</p><pre><code class=\"language-java\">HttpProcessor.java\n&nbsp; // create Response object\n&nbsp; HttpResponse response = new HttpResponse(output);\n&nbsp; response.setRequest(request);\n</code></pre><p>ServletProcessorç±»processä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-java\">public class ServletProcessor {\n    public void process(HttpRequest request, HttpResponse response) {\n        String uri = request.getUri();\n        String servletName = uri.substring(uri.lastIndexOf(\"/\") + 1);\n        URLClassLoader loader = null;\n        try {\n            // create a URLClassLoader\n            URL[] urls = new URL[1];\n            URLStreamHandler streamHandler = null;\n            //è¿™ä¸ªURLClassloaderçš„å·¥ä½œç›®å½•è®¾ç½®åœ¨HttpServer.WEB_ROOT\n            File classPath = new File(HttpServer.WEB_ROOT);\n            String repository = (new URL(\"file\", null, classPath.getCanonicalPath() + File.separator)).toString() ;\n            urls[0] = new URL(null, repository, streamHandler);\n            loader = new URLClassLoader(urls);\n        }\n        catch (IOException e) {\n            System.out.println(e.toString() );\n        }\n        //responseé»˜è®¤ä¸ºUTF-8ç¼–ç \n        response.setCharacterEncoding(\"UTF-8\");\n        Class&lt;?&gt; servletClass = null;\n        try {\n            servletClass = loader.loadClass(servletName);\n        }\n        catch (ClassNotFoundException e) {\n            System.out.println(e.toString());\n        }\n        //å›å†™å¤´ä¿¡æ¯\n        try {\n            response.sendHeaders();\n        } catch (IOException e1) {\n            e1.printStackTrace();\n        }\n        //åˆ›å»ºservletæ–°å®ä¾‹ï¼Œè°ƒç”¨service()\n        Servlet servlet = null;\n        try {\n            servlet = (Servlet) servletClass.newInstance();\n            servlet.service(request, response);\n        }\n        catch (Exception e) {\n            System.out.println(e.toString());\n        }\n        catch (Throwable e) {\n            System.out.println(e.toString());\n        }\n    }\n}\n</code></pre><p>åœ¨æ­¤æˆ‘ä»¬å®Œæˆäº†HttpRequestä¸HttpResponseçš„æ›¿æ¢ã€‚</p><h2>Facadeæ¨¡å¼çš„åº”ç”¨</h2><p>ç°åœ¨æœ‰ä¸€ä¸ªé—®é¢˜éœ€è¦æˆ‘ä»¬è§£å†³ï¼šæˆ‘ä»¬ç›´æ¥ä½¿ç”¨çš„æ˜¯HttpRequestä¸HttpResponseï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡è¦ä¼ å…¥Servletä¸­ï¼Œä½†åœ¨è¿™ä¸¤ä¸ªç±»ä¸­æˆ‘ä»¬ä¹Ÿå®šä¹‰äº†è®¸å¤šå†…éƒ¨çš„æ–¹æ³•ï¼Œä¸€æ—¦è¢«ç”¨æˆ·çŸ¥æ™“æˆ‘ä»¬çš„å®ç°ç±»ï¼Œåˆ™è¿™äº›å†…éƒ¨æ–¹æ³•å°±æš´éœ²åœ¨ç”¨æˆ·é¢å‰äº†ã€‚</p><p>è¿™æ ·å…¶å®æ˜¯ä¸å¥½çš„ã€‚é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æ€æƒ³ï¼Œæ˜¯å°†å†…éƒ¨å®ç°çš„ç»“æ„å’Œå¤æ‚æ€§åŒ…è£…åœ¨ä¸€å±‚å£³é‡Œé¢ï¼Œèƒ½ä¸å¯¹å¤–æš´éœ²å°±ä¸è¦å¯¹å¤–æš´éœ²ã€‚ä½œä¸ºå®¢æˆ·ç¨‹åºï¼Œæœ€å¥½åªçŸ¥é“æœ€å°çŸ¥è¯†é›†ã€‚å¦å¤–ï¼Œè¿™ä¸ªRequestå’ŒResponseç±»æ˜¯è¦ä¼ ç»™å¤–éƒ¨çš„Servletç¨‹åºçš„ï¼Œè·³å‡ºäº†Tomcatæœ¬èº«ï¼Œå¦‚æœè¿™ä¸ªå†™Servletçš„ç¨‹åºå‘˜ä»–çŸ¥é“ä¼ çš„è¿™ä¸ªç±»é‡Œé¢æœ‰ä¸€äº›é¢å¤–çš„æ–¹æ³•ï¼ŒåŸç†ä¸Šä»–å¯ä»¥è¿›è¡Œå¼ºåˆ¶è½¬æ¢ä¹‹åè°ƒç”¨ï¼Œè¿™æ ·ä¹Ÿä¸æ˜¯å¾ˆå®‰å…¨ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨é—¨é¢è®¾è®¡æ¨¡å¼ï¼Œè§„é¿ä¸Šè¿°é—®é¢˜ã€‚</p><p>å…ˆè§£é‡Šä¸€ä¸‹Facadeæ¨¡å¼ï¼ŒFacadeè¿™ä¸ªè¯æ¥è‡ªäºå»ºç­‘å­¦ï¼Œå­—é¢æ„æ€æ˜¯â€œç«‹é¢â€ï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨å¤§è¡—ä¸Šçœ‹åˆ°çš„é—¨é¢ã€‚é—¨é¢æŠŠå»ºç­‘çš„å†…éƒ¨ç»“æ„åŒ…è£…èµ·æ¥ç»™äººä»¬å±•ç¤ºäº†ä¸€ä¸ªæ–°çš„å‹å¥½çš„æœ‰ç‰¹è‰²çš„å¤–è§‚ã€‚è½¯ä»¶ä¸­ç”¨åŒæ ·çš„æ‰‹æ³•ï¼Œå°†è½¯ä»¶çš„å†…éƒ¨ç»“æ„è¿›è¡ŒåŒ…è£…ï¼Œå¯¹å¤–ç”¨ç®€å•çš„APIä¾›äººä½¿ç”¨ã€‚</p><p>ä¸‹é¢æ˜¯Facadeçš„ç»“æ„å›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/80/45/807b51e8b4d226b68e01aca29f121545.png?wh=1920x1229\" alt=\"å›¾ç‰‡\"></p><p>çœ‹ä¸Šå›¾ï¼Œæœ¬æ¥ä¸€ä¸ªè½¯ä»¶ä¸­æœ‰å‡ ä¸ªç±»ï¼Œä¸€ä¸ªç±»é‡Œé¢æœ‰ä¸€å †æ–¹æ³•ï¼Œç»™å¤–é¢çš„clientç¨‹åºç›´æ¥ç”¨ä¼šå¢æ·»å¾ˆå¤šå¤æ‚æ€§è€Œä¸”ä¸å®‰å…¨ï¼Œäºæ˜¯ä¸­é—´åŠ äº†ä¸€å±‚Facadeï¼Œæä¾›ä¸€ä¸ªç®€å•çš„doSomething()æ–¹æ³•ã€‚è¿™æ ·å¯¹ä½¿ç”¨è€…æ¥è¯´å¾ˆç®€å•æ–¹ä¾¿ï¼Œä¹Ÿä¾¿äºå†…éƒ¨ç»“æ„çš„è°ƒæ•´ï¼Œæœªæ¥éœ€è¦æ”¹åŠ¨å†…éƒ¨å®ç°çš„æ—¶å€™ï¼Œå› ä¸ºæœ‰è¿™ä¸ªFacadeå­˜åœ¨ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦æ”¹åŠ¨å¯¹å¤–çš„æ¥å£ã€‚</p><p>Facadeç±»æ˜¯ä¸€ä¸ªæ–°ç±»ï¼Œå¤–éƒ¨ä½¿ç”¨è€…æ²¡æ³•æ ¹æ®å®ƒæ¥å¼ºåˆ¶è½¬æ¢è·å¾—å†…éƒ¨çš„ç»“æ„å’Œæ–¹æ³•ï¼Œè¿™æ ·å°†å®é™…å®ç°çš„å‡ ä¸ªç±»ä¿æŠ¤èµ·æ¥äº†ï¼Œæé«˜äº†å®‰å…¨æ€§ã€‚è¿™æ­£æ˜¯æˆ‘ä»¬ç°åœ¨åœ¨å¤„ç†Requestå’ŒResponseçš„æ—¶å€™æ‰€å¸Œæœ›çœ‹åˆ°çš„ã€‚æˆ‘ä»¬æŒ‰ç…§è¿™ä¸ªæ€è·¯å†™è‡ªå·±çš„Facadeã€‚</p><p>é¦–å…ˆå®šä¹‰HttpRequestFacadeä¸HttpResponseFacadeï¼Œåˆ†åˆ«å®ç°HttpServletRequestä¸HttpServletResponseã€‚ä½ å¯ä»¥çœ‹ä¸€ä¸‹æˆ‘ç»™å‡ºçš„ä»£ç ä¸»ä½“éƒ¨åˆ†ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯ç›´æ¥è½¬åˆ°requestå’Œresponseé‡Œé¢çš„ç›¸åº”è°ƒç”¨ï¼Œå®Œæ•´ä»£ç å°±ä¸ä¸€ä¸€å±•ç¤ºäº†ï¼Œä½ å¯ä»¥çœ‹æœ€åçš„Giteeé“¾æ¥ã€‚</p><p>HttpRequestFacade.javaï¼š</p><pre><code class=\"language-java\">package server;\npublic class HttpRequestFacade implements HttpServletRequest {\n    private HttpServletRequest request;\n    public HttpRequestFacade(HttpRequest request) {\n        this.request = request;\n    }\n    /* implementation of the HttpServletRequest*/\n    public Object getAttribute(String name) {\n        return request.getAttribute(name);\n    }\n    public Enumeration getAttributeNames() {\n        return request.getAttributeNames();\n    }\n    public String getCharacterEncoding() {\n        return request.getCharacterEncoding();\n    }\n    public int getContentLength() {\n        return request.getContentLength();\n    }\n    public String getContentType() {\n        return request.getContentType();\n    }\n    public Cookie[] getCookies() {\n        return request.getCookies();\n    }\n    public Enumeration getHeaderNames() {\n        return request.getHeaderNames();\n    }\n    public String getHeader(String name) {\n        return request.getHeader(name);\n    }\n    public Enumeration getHeaders(String name) {\n        return request.getHeaders(name);\n    }\n    public ServletInputStream getInputStream() throws IOException {\n        return request.getInputStream();\n    }\n    public int getIntHeader(String name) {\n        return request.getIntHeader(name);\n    }\n    public String getMethod() {\n        return request.getMethod();\n    }\n    public String getParameter(String name) {\n        return request.getParameter(name);\n    }\n    public Map getParameterMap() {\n        return request.getParameterMap();\n    }\n    public Enumeration getParameterNames() {\n        return request.getParameterNames();\n    }\n    public String[] getParameterValues(String name) {\n        return request.getParameterValues(name);\n    }\n    public String getQueryString() {\n        return request.getQueryString();\n    }\n    public BufferedReader getReader() throws IOException {\n        return request.getReader();\n    }\n    public String getRequestURI() {\n        return request.getRequestURI();\n    }\n    public StringBuffer getRequestURL() {\n        return request.getRequestURL();\n    }\n    public HttpSession getSession() {\n        return request.getSession();\n    }\n    public HttpSession getSession(boolean create) {\n        return request.getSession(create);\n    }\n    public void removeAttribute(String attribute) {\n        request.removeAttribute(attribute);\n    }\n    public void setAttribute(String key, Object value) {\n        request.setAttribute(key, value);\n    }\n    public void setCharacterEncoding(String encoding) throws UnsupportedEncodingException {\n        request.setCharacterEncoding(encoding);\n    }\n}\n</code></pre><p>HttpResponseFacade.javaç±»ä¸»ä½“å®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code class=\"language-java\">package server;\n\npublic class HttpResponseFacade implements HttpServletResponse {\n    private HttpServletResponse response;\n    public HttpResponseFacade(HttpResponse response) {\n        this.response = response;\n    }\n    public void addDateHeader(String name, long value) {\n        response.addDateHeader(name, value);\n    }\n    public void addHeader(String name, String value) {\n        response.addHeader(name, value);\n    }\n    public boolean containsHeader(String name) {\n        return response.containsHeader(name);\n    }\n    public String encodeUrl(String url) {\n        return response.encodeUrl(url);\n    }\n    public String encodeURL(String url) {\n        return response.encodeURL(url);\n    }\n    public void flushBuffer() throws IOException {\n        response.flushBuffer();\n    }\n    public String getCharacterEncoding() {\n        return response.getCharacterEncoding();\n    }\n    @Override\n    public String getContentType() {\n        return null;\n    }\n    @Override\n    public void setCharacterEncoding(String s) {\n    }\n    public void setContentLength(int length) {\n        response.setContentLength(length);\n    }\n    public void setContentType(String type) {\n        response.setContentType(type);\n    }\n    public void setHeader(String name, String value) {\n        response.setHeader(name, value);\n    }\n    public ServletOutputStream getOutputStream() throws IOException {\n        return response.getOutputStream();\n    }\n    @Override\n    public PrintWriter getWriter() throws IOException {\n        return response.getWriter();\n    }\n    @Override\n    public void addCookie(Cookie arg0) {\n        response.addCookie(arg0);\n    }\n    @Override\n    public String getHeader(String arg0) {\n        return response.getHeader(arg0);\n    }\n    @Override\n    public Collection&lt;String&gt; getHeaderNames() {\n        return response.getHeaderNames();\n    }\n    @Override\n    public Collection&lt;String&gt; getHeaders(String arg0) {\n        return response.getHeaders(arg0);\n    }\n}\n</code></pre><p>åœ¨æ­¤ä¸¤ä¸ªFacadeå°±å®šä¹‰å®Œæ¯•äº†ï¼Œå‰é¢æˆ‘ä»¬ä¹Ÿè¯´è¿‡ï¼Œæˆ‘ä»¬è¦åšçš„æ˜¯å‘Servletä¼ å…¥å‚æ•°æ—¶è§„é¿å†…éƒ¨æ–¹æ³•ï¼Œè€ŒFacadeçš„ä½œç”¨å°±æ˜¯å°è£…ä¸å¸Œæœ›æš´éœ²çš„æ–¹æ³•ï¼Œæ›´æ·±å±‚çš„å†…éƒ¨æ–¹æ³•ä¸äºˆå±•ç¤ºã€‚å› è€Œåœ¨ServletProcessorä¸­ï¼ŒServletè°ƒç”¨serviceæ—¶æˆ‘ä»¬ä¼ å…¥HttpRequestFacadeä¸HttpResponseFacadeï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹éœ€è¦è°ƒæ•´çš„éƒ¨åˆ†ä»£ç ã€‚</p><pre><code class=\"language-java\">ServletProcessor.java\n\nServlet servlet = null;\n//è°ƒç”¨servletçš„service()æ–¹æ³•æ—¶ä¼ å…¥çš„æ˜¯Facadeå¯¹è±¡\ntry {\n    servlet = (Servlet) servletClass.newInstance();\n    HttpRequestFacade requestFacade = new HttpRequestFacade(request);\n    HttpResponseFacade responseFacade = new HttpResponseFacade(response);\n    servlet.service(requestFacade, responseFacade);\n}\n\n</code></pre><p>è¿™æ ·åœ¨Servletä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„åªæ˜¯Facadeï¼Œçœ‹ä¸è§å†…éƒ¨æ–¹æ³•ï¼Œåº”ç”¨ç¨‹åºå‘˜æƒ³è¿›è¡Œå¼ºåˆ¶è½¬åŒ–ä¹Ÿä¸è¡Œï¼Œè¿™æ ·æ—¢ç®€å•åˆå®‰å…¨ã€‚</p><p>è¿˜æœ‰ï¼ŒæŒ‰ç…§Servletçš„è§„èŒƒï¼Œå®¢æˆ·è‡ªå®šä¹‰çš„Servletæ˜¯è¦ç»§æ‰¿HttpServletçš„ï¼Œåœ¨è°ƒç”¨çš„serviceæ–¹æ³•å†…ï¼Œå®ƒçš„å®é™…è¡Œä¸ºæ˜¯é€šè¿‡methodåˆ¤æ–­è°ƒç”¨çš„æ˜¯å“ªä¸€ä¸ªæ–¹æ³•ï¼Œå¦‚æœæ˜¯Getæ–¹æ³•å°±è°ƒç”¨doGet()ï¼Œå¦‚æœæ˜¯Postæ–¹æ³•è°ƒç”¨çš„å°±æ˜¯doPost()ï¼Œå…¶ä»–çš„æ–¹æ³•ä¹Ÿæ˜¯ä¸€æ ·çš„é“ç†ã€‚</p><p>æ‰€ä»¥åœ¨æˆ‘ä»¬è‡ªå®šä¹‰çš„HttpRequesté‡Œï¼Œä¸€å®šè¦å®ç°getMethodæ–¹æ³•ï¼Œæˆ‘ä»¬æ¥è°ƒæ•´ä¸€ä¸‹ã€‚</p><pre><code class=\"language-java\">package server;\npublic class HttpRequest implements HttpServletRequest{\n    @Override\n    public String getMethod() {\n      return new String(this.requestLine.method, 0, this.requestLine.methodEnd);\n    }\n}\n</code></pre><p>è¿™æ ·åšå¯ä»¥ç®€åŒ–å®¢æˆ·ç¨‹åºï¼Œè®©ä¸šåŠ¡ç¨‹åºå‘˜å†™Servletçš„æ—¶å€™åªéœ€è¦é‡è½½doGet()æˆ–doPost()æ–¹æ³•å³å¯ã€‚</p><p>è¿™æ ·æˆ‘ä»¬è¿™ä¸ªé˜¶æ®µçš„æ”¹é€ å°±å®Œæˆäº†ã€‚</p><h2>æµ‹è¯•</h2><p>æˆ‘ä»¬è¿™èŠ‚è¯¾çš„å®ç°åªæ˜¯å†…éƒ¨ç¨‹åºç»“æ„çš„å˜åŠ¨ï¼Œå¹¶ä¸å½±å“ç”¨æˆ·çš„Servletå’Œå®¢æˆ·ç«¯çš„è®¿é—®ã€‚æ‰€ä»¥è¿˜æ˜¯å¯ä»¥æ²¿ç”¨ä»¥å‰çš„æµ‹è¯•åŠæ³•è¿›è¡ŒéªŒè¯ã€‚</p><h2>å°ç»“</h2><p><img src=\"https://static001.geekbang.org/resource/image/02/b2/02f040768f67d31ba4bc8bab64d757b2.jpg?wh=3321x1536\" alt=\"\"></p><p>è¿™èŠ‚è¯¾æˆ‘ä»¬ä¸»è¦åšäº†ä¸¤ä»¶äº‹ï¼šä¸€æ˜¯è§£æResponseçš„è¿”å›ä¿¡æ¯ï¼Œå­˜å‚¨Headerä¿¡æ¯ï¼Œå¯ä»¥è®©æˆ‘ä»¬æ›´å¥½åœ°å¤„ç†æœåŠ¡å™¨å“åº”ï¼›äºŒæ˜¯é‡‡ç”¨Facadeé—¨é¢æ¨¡å¼ï¼Œæ–°å¢HttpRequestFacadeä¸HttpResponseFacadeï¼Œå°è£…æˆ‘ä»¬ä¸å¸Œæœ›æš´éœ²çš„æ–¹æ³•ä½“ï¼Œé¿å…è¢«ä¸šåŠ¡ç¨‹åºå‘˜ç›´æ¥è°ƒç”¨å®ç°ç±»çš„å†…éƒ¨æ–¹æ³•ã€‚</p><p>é€šè¿‡è¿™ä¸¤ä»¶äº‹æƒ…ï¼Œæˆ‘ä»¬æ—¢ç¬¦åˆäº†Servletçš„è§„èŒƒï¼Œåˆè®©MiniTomcatæœ¬èº«åœ¨é¢å¯¹Servletåº”ç”¨ç¨‹åºå‘˜çš„æ—¶å€™æ›´åŠ å®‰å…¨ã€‚è¿™ä¸ªFacadeçš„è®¾è®¡æ˜¯Tomcatä¸­è¢«äººç§°èµçš„ä¼˜ç‚¹ï¼Œæˆ‘ä»¬è‡ªå·±å°è¯•è®¾è®¡æ¡†æ¶çš„æ—¶å€™å¯ä»¥å€Ÿé‰´ã€‚</p><p>æœ¬èŠ‚è¯¾å®Œæ•´ä»£ç å‚è§ï¼š<a href=\"https://gitee.com/yaleguo1/minit-learning-demo/tree/geek_chapter07\">https://gitee.com/yaleguo1/minit-learning-demo/tree/geek_chapter07</a></p><h2>æ€è€ƒé¢˜</h2><p>å­¦å®Œäº†è¿™èŠ‚è¯¾çš„å†…å®¹ï¼Œæˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœæˆ‘ä»¬ä¸å¼•å…¥Facadeï¼Œé‚£ä¹ˆä¸€ä¸ªServletç¨‹åºå‘˜æœ‰å¯èƒ½åšäº›ä»€ä¹ˆæˆ‘ä»¬ä¸å¸Œæœ›ä»–ä»¬åšçš„äº‹æƒ…ï¼Ÿ</p><p>æ¬¢è¿ä½ æŠŠä½ æ€è€ƒåçš„ç»“æœåˆ†äº«åˆ°è¯„è®ºåŒºï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾çš„å†…å®¹åˆ†äº«ç»™å…¶ä»–æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","neighbors":{"left":{"article_title":"06ï½œè§„èŒƒåŒ–ï¼šå¼•å…¥HttpRequestä¸HttpResponse","id":735122},"right":{"article_title":"08ï½œè§£æå‚æ•°ï¼šé€šè¿‡å¼•å…¥Cookieå’ŒSessioné¿å…åå¤ç™»å½•","id":737743}},"comments":[{"had_liked":false,"id":385776,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"åŒ—äº¬","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1703338881,"is_pvip":false,"replies":[{"id":140647,"content":"Q1ï¼Œå®ç°ä»£ç ä¸€æ ·çš„ï¼Œä½†æ˜¯å¯¹å¤–æ˜¯ä¸¤ä¸ªè¯­ä¹‰ã€‚\nQ2ï¼Œæ˜¯å…ˆåè¾“å‡ºçš„ï¼Œä¸€æ¬¡äº¤äº’ä¸­å®Œæˆ\nQ3ï¼Œæ›¿ä»£æ–¹æ³•æ˜¯ç”¨constructoræ¥æ–°å»ºå®ä¾‹\nQ4ï¼Œæ²¡ç”¨åˆ°ï¼Œåªæ˜¯å®šä¹‰åœ¨è¿™é‡Œäº†ï¼Œå¤§å®¶çŸ¥é“åŸç†ã€‚\nQ5ï¼ŒOerrideæ˜¯ç¼–è¯‘æ³¨è§£ï¼ŒåŠ ä¸Šæ˜¯å¥½ä¹ æƒ¯\nQ6ï¼Œä¸çŸ¥é“å¤šå°‘è¡Œï¼Œæ•´ä¸ªæºä»£ç å¤§çº¦æ˜¯18Mï¼Œæˆ‘è§‰å¾—æœ‰30-50ä¸‡è¡Œå§ã€‚æˆ‘ç›´æ¥ç”¨IDEçœ‹çš„æºä»£ç ã€‚\nQ7ï¼ŒURLClassLoaderæ˜¯Javaè‡ªå·±æä¾›çš„ï¼Œå°±æ˜¯â€œä¼ ç»Ÿâ€çš„å•Šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1703668392,"ip_address":"æ¹–å—","comment_id":385776,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"è¯·æ•™è€å¸ˆå‡ ä¸ªé—®é¢˜ï¼š\nQ1ï¼šaddHeaderä¸setHeaderä»£ç ç›¸åŒï¼Œä¸å°±é‡å¤äº†å—ï¼Ÿ\nHttpResponseä¸­çš„è¿™ä¸¤ä¸ªç±»ï¼Œä»£ç å®Œå…¨ç›¸åŒï¼Œé‡å¤å•Šã€‚\n\nQ2ï¼šsendHeadersæ–¹æ³•å’Œservlet.serviceæ˜¯åˆ†åˆ«è¾“å‡ºåˆ°æµè§ˆå™¨å—ï¼Ÿ\nServletProcessorç±»çš„processæ–¹æ³•ä¸­ï¼Œå…ˆæ˜¯è°ƒç”¨response.sendHeaders(); è¿™ä¸ªæ–¹æ³•æ˜¯æŠŠå¤´éƒ¨ä¿¡æ¯è¾“å‡ºåˆ°æµè§ˆå™¨å—ï¼Ÿç´§æ¥ç€åˆè°ƒç”¨servlet.serviceï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯è¾“å‡ºå†…å®¹åˆ°æµè§ˆå™¨ã€‚è¿™ä¸¤æ¬¡è¾“å‡ºæ˜¯é¡ºåºå®Œæˆçš„å—ï¼Ÿæ„Ÿè§‰åº”è¯¥æ˜¯ä¸€èµ·è¾“å‡ºåˆ°æµè§ˆå™¨æ‰å¯¹ï¼Œä¸è¿‡ç”¨äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œæ„Ÿè§‰æ˜¯åˆ†åˆ«è¾“å‡ºåˆ°æµè§ˆå™¨ã€‚\n\nQ3ï¼šnewInstanceè¿‡æ—¶äº†ï¼Œæ›¿ä»£æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Ÿ\næˆ‘ç”¨Idea2019ï¼Œå¯¹äºâ€œservlet = (Servlet) servletClass.newInstance();\nâ€è¿™è¡Œä»£ç ï¼ŒIdeaæç¤ºæ­¤æ–¹æ³•å·²ç»è¿‡æ—¶äº†ã€‚å¦‚æœè¿‡æ—¶äº†ï¼Œæ›¿ä»£æ–¹æ³•æ˜¯ä»€ä¹ˆï¼Ÿ\n\nQ4ï¼šgetMethodå¹¶æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œå¯¹å—ï¼Ÿ\nHttpRequestä¸­è™½ç„¶å®ç°äº†getMethodæ–¹æ³•ï¼Œä½†ç¨‹åºè¿è¡Œå¹¶æ²¡æœ‰ä½¿ç”¨æ­¤æ–¹æ³•ï¼Œå¯¹å—ï¼Ÿï¼ˆä¹Ÿè®¸ç”¨äº†ï¼Œä½†æˆ‘æ²¡æœ‰çœ‹åˆ°ï¼‰\n\nQ5ï¼šHttpRequestFacadeç±»ä¸­çš„æ–¹æ³•ï¼Œä¸ºä»€ä¹ˆæ²¡æœ‰åŠ overrideæ³¨è§£ï¼Ÿ\næˆ‘è¿™é‡ŒIdea2019æœ‰çº¢çº¿æç¤ºï¼Œæç¤ºç¼ºå°‘overrideæ³¨è§£ï¼Œä½†æ˜¯èƒ½è¿è¡Œã€‚\n\nQ6ï¼šTomcatæºç å¤§çº¦å¤šå°‘è¡Œï¼Ÿè€å¸ˆä¸€èˆ¬ç”¨ä»€ä¹ˆçœ‹Tomcatæºç ï¼Ÿ\nç”¨SourceInsight?è¿˜æ˜¯ç›´æ¥ç”¨Ideaçœ‹ï¼Ÿ\n\nQ7ï¼šå¯¹URLä¸ºä»€ä¹ˆè¦ç”¨URLClassLoaderï¼Ÿä¼ ç»Ÿçš„å‡ ä¸ªClassLoaderéš¾é“ä¸èƒ½åŠ è½½å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634570,"discussion_content":"Q1ï¼Œå®ç°ä»£ç ä¸€æ ·çš„ï¼Œä½†æ˜¯å¯¹å¤–æ˜¯ä¸¤ä¸ªè¯­ä¹‰ã€‚\nQ2ï¼Œæ˜¯å…ˆåè¾“å‡ºçš„ï¼Œä¸€æ¬¡äº¤äº’ä¸­å®Œæˆ\nQ3ï¼Œæ›¿ä»£æ–¹æ³•æ˜¯ç”¨constructoræ¥æ–°å»ºå®ä¾‹\nQ4ï¼Œæ²¡ç”¨åˆ°ï¼Œåªæ˜¯å®šä¹‰åœ¨è¿™é‡Œäº†ï¼Œå¤§å®¶çŸ¥é“åŸç†ã€‚\nQ5ï¼ŒOerrideæ˜¯ç¼–è¯‘æ³¨è§£ï¼ŒåŠ ä¸Šæ˜¯å¥½ä¹ æƒ¯\nQ6ï¼Œä¸çŸ¥é“å¤šå°‘è¡Œï¼Œæ•´ä¸ªæºä»£ç å¤§çº¦æ˜¯18Mï¼Œæˆ‘è§‰å¾—æœ‰30-50ä¸‡è¡Œå§ã€‚æˆ‘ç›´æ¥ç”¨IDEçœ‹çš„æºä»£ç ã€‚\nQ7ï¼ŒURLClassLoaderæ˜¯Javaè‡ªå·±æä¾›çš„ï¼Œå°±æ˜¯â€œä¼ ç»Ÿâ€çš„å•Šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1703668392,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¹–å—","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1126661,"avatar":"https://static001.geekbang.org/account/avatar/00/11/31/05/9028e9ac.jpg","nickname":"ctt","note":"","ucode":"FA87B9E86FD308","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634550,"discussion_content":"Q1:å½“ä½¿ç”¨ put æ–¹æ³•æ—¶ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼š\né”®ä¸å­˜åœ¨äºæ˜ å°„ä¸­ï¼šé”®å’Œå€¼ä½œä¸ºæ–°çš„é”®å€¼å¯¹æ’å…¥ã€‚\né”®å·²å­˜åœ¨äºæ˜ å°„ä¸­ï¼šæ˜ å°„ä¸­è¯¥é”®çš„å½“å‰å€¼è¢«æ–°å€¼æ›¿æ¢ï¼Œput æ–¹æ³•è¿”å›è¢«æ›¿æ¢çš„æ—§å€¼ã€‚æ‰€ä»¥çœ‹ä¸Šå»è°ƒç”¨çš„éƒ½æ˜¯putæ–¹æ³•ï¼Œä½†æ˜¯å®é™…çš„æ‰§è¡Œé€»è¾‘æ˜¯ä¸ä¸€æ ·çš„ã€‚å¯ä»¥å»çœ‹concurrentHashMapçš„putæ–¹æ³• \nQ2:\né¦–å…ˆå‘é€å¤´éƒ¨ä¿¡æ¯ï¼Œåªæœ‰åœ¨è¿™äº›å¤´éƒ¨ä¿¡æ¯å®Œå…¨å†™å…¥è¾“å‡ºæµä¹‹åï¼Œæ‰ä¼šå‘é€å®é™…çš„å†…å®¹æ•°æ®ã€‚è¿™æ˜¯å› ä¸º HTTP åè®®è§„å®šäº†å“åº”åº”è¯¥é¦–å…ˆåŒ…å«å¤´éƒ¨ä¿¡æ¯ï¼Œéšåæ˜¯å“åº”ä½“ã€‚å¦‚æœé¡ºåºé¢ å€’æˆ–æ··åˆï¼Œå®¢æˆ·ç«¯å¯èƒ½æ— æ³•æ­£ç¡®è§£æå“åº”ã€‚\nQ4ï¼šgetMethodå¹¶æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œå¯¹å—ï¼Ÿ\nåº”è¯¥æ²¡è¢«ä½¿ç”¨ï¼Œæˆ‘æŠŠgetMethodè¿”å›nullä¸å½±å“ç¨‹åºè¿è¡Œ\nQ7:\nURLClassLoader æ˜¯ java.net.URLClassLoader ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œå®ƒæ‰©å±•äº† ClassLoader ç±»ï¼Œå¹¶æä¾›äº†é¢å¤–çš„åŠŸèƒ½æ¥ä» URL æŒ‡å®šçš„ä½ç½®åŠ è½½ç±»ã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1703648821,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":388789,"user_name":"å°å››","can_delete":false,"product_type":"c1","uid":1103002,"ip_address":"åŒ—äº¬","ucode":"41BAE89BCCF047","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/9a/11134ccc.jpg","comment_is_top":false,"comment_ctime":1710897967,"is_pvip":false,"replies":[{"id":141528,"content":"æ¨¡ä»¿Tomcat","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1711068736,"ip_address":"æ¾³å¤§åˆ©äºš","comment_id":388789,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"è¿™ä¸ªfacadeæ„Ÿè§‰ç”¨wrapperæ›´åˆç†ä¸€äº›å§ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":640011,"discussion_content":"æ¨¡ä»¿Tomcat","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1711068737,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¾³å¤§åˆ©äºš","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":386363,"user_name":"é©¬ä»¥","can_delete":false,"product_type":"c1","uid":1344431,"ip_address":"å¹¿ä¸œ","ucode":"3FEA06CA14DE28","user_header":"https://static001.geekbang.org/account/avatar/00/14/83/af/1cb42cd3.jpg","comment_is_top":false,"comment_ctime":1704684279,"is_pvip":false,"replies":[{"id":140895,"content":"ä½†æ˜¯å¯ä»¥å¼ºåˆ¶è½¬åŒ–åè·å–ï¼ŒFacadeå°±æ˜¯è®©è¿™ç§å¼ºåˆ¶è½¬åŒ–å¤±æ•ˆ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1705024144,"ip_address":"æ¾³å¤§åˆ©äºš","comment_id":386363,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"ä¸å¸Œæœ›å¤–éƒ¨ä¿®æ”¹çš„æŠŠæ–¹æ³•è®¾ç½®ä¸ºç§æœ‰ï¼Œåªå¼€æ”¾å‡ºå¿…è¦çš„æ–¹æ³•ï¼Œè®¾ç½®ä¸ºpublic\n","like_count":0,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635651,"discussion_content":"ä½†æ˜¯å¯ä»¥å¼ºåˆ¶è½¬åŒ–åè·å–ï¼ŒFacadeå°±æ˜¯è®©è¿™ç§å¼ºåˆ¶è½¬åŒ–å¤±æ•ˆ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1705024144,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¾³å¤§åˆ©äºš","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385811,"user_name":"HHğŸ·ğŸ ","can_delete":false,"product_type":"c1","uid":1133678,"ip_address":"å¹¿ä¸œ","ucode":"C50172BDA604D5","user_header":"https://static001.geekbang.org/account/avatar/00/11/4c/6e/5435e214.jpg","comment_is_top":false,"comment_ctime":1703426846,"is_pvip":false,"replies":[{"id":140645,"content":"ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœæ²¡æœ‰Facadeï¼Œè€Œæ˜¯ç›´æ¥ä¼ å…¥äº†å®ç°ç±»ConcreteRequestï¼Œåˆ™å†™servletçš„é‚£ä¸ªç¨‹åºå‘˜ï¼Œä»–åœ¨doGet(request,response)ä¸­å¯ä»¥è¿™ä¹ˆå†™ï¼š(ConcreteRequest)requestè¿›è¡Œå¼ºåˆ¶è½¬æ¢ï¼Œè¿™æ ·å°±å¯ä»¥è°ƒç”¨ConcreteRequestå®ç°ç±»é‡Œé¢çš„æ–¹æ³•äº†ï¼Œé€ æˆéšæ‚£ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1703665575,"ip_address":"æ¹–å—","comment_id":385811,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"ç›®å‰æƒ³åˆ°æœ‰ä¸¤ç‚¹\n1ï¼Œç›´æ¥æ“ä½œè¯·æ±‚å‚æ•°ï¼Œ ä¼šæœ‰æ•°æ®ç¯¡æ”¹å«Œç–‘\n2ï¼Œå½±å“æ­£å¸¸æµç¨‹ï¼Œ æ¯”å¦‚å·²ç»è°ƒç”¨ response.sendHeaders æ–¹æ³•ï¼Œ å¼€å‘äººå‘˜ä¸ç†Ÿæ‚‰æ•´ä¸ªå¤æ‚æµç¨‹æ­¥éª¤ï¼Œæœ‰å¯èƒ½ä¼šé‡å¤è°ƒç”¨ã€‚\n\nè¯·è€å¸ˆæŒ‡ç‚¹","like_count":0,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634566,"discussion_content":"ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœæ²¡æœ‰Facadeï¼Œè€Œæ˜¯ç›´æ¥ä¼ å…¥äº†å®ç°ç±»ConcreteRequestï¼Œåˆ™å†™servletçš„é‚£ä¸ªç¨‹åºå‘˜ï¼Œä»–åœ¨doGet(request,response)ä¸­å¯ä»¥è¿™ä¹ˆå†™ï¼š(ConcreteRequest)requestè¿›è¡Œå¼ºåˆ¶è½¬æ¢ï¼Œè¿™æ ·å°±å¯ä»¥è°ƒç”¨ConcreteRequestå®ç°ç±»é‡Œé¢çš„æ–¹æ³•äº†ï¼Œé€ æˆéšæ‚£ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1703665575,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¹–å—","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":394183,"user_name":"ç å“¥å­—èŠ‚","can_delete":false,"product_type":"c1","uid":1572356,"ip_address":"å¹¿ä¸œ","ucode":"362103AD52C8E0","user_header":"https://static001.geekbang.org/account/avatar/00/17/fe/04/bb427e47.jpg","comment_is_top":false,"comment_ctime":1726054863,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"è¯·æ•™è€å¸ˆä¸€ä¸ªé—®é¢˜ï¼Œå“åº”ç»™æµè§ˆå™¨çš„é¡µé¢å˜æˆäº†htmlæ–‡æœ¬ï¼Œæµè§ˆå™¨f12 å“åº”å¤´ä¸ºç©ºã€‚","like_count":0}]}