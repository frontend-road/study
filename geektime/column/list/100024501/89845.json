{"id":89845,"title":"14 | ä¸´è¿‘ OOMï¼Œå¦‚ä½•è·å–è¯¦ç»†å†…å­˜åˆ†é…ä¿¡æ¯ï¼Œåˆ†æå†…å­˜é—®é¢˜ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æˆ´é“­ã€‚ä»Šå¤©æˆ‘ä»¬æ¥èŠèŠï¼Œä¸´è¿‘OOMï¼Œå¦‚ä½•è·å–è¯¦ç»†çš„å†…å­˜åˆ†é…ä¿¡æ¯ï¼Œåˆ†æå†…å­˜é—®é¢˜çš„è¯é¢˜ã€‚</p><p>OOMï¼Œæ˜¯Out of Memoryçš„ç¼©å†™ï¼ŒæŒ‡çš„æ˜¯Appå ç”¨çš„å†…å­˜è¾¾åˆ°äº†iOSç³»ç»Ÿå¯¹å•ä¸ªAppå ç”¨å†…å­˜ä¸Šé™åï¼Œè€Œè¢«ç³»ç»Ÿå¼ºæ€æ‰çš„ç°è±¡ã€‚è¿™ä¹ˆè¯´çš„è¯ï¼ŒOOMå…¶å®ä¹Ÿå±äºæˆ‘ä»¬åœ¨ç¬¬12ç¯‡æ–‡ç« â€œ<a href=\"https://time.geekbang.org/column/article/88600\">iOS å´©æºƒåƒå¥‡ç™¾æ€ªï¼Œå¦‚ä½•å…¨é¢ç›‘æ§ï¼Ÿ</a>â€ä¸­æåˆ°çš„åº”ç”¨â€œå´©æºƒâ€ä¸­çš„ä¸€ç§ï¼Œæ˜¯ç”±iOSçš„Jetsamæœºåˆ¶å¯¼è‡´çš„ä¸€ç§â€œå¦ç±»â€å´©æºƒï¼Œå¹¶ä¸”æ—¥å¿—æ— æ³•é€šè¿‡ä¿¡å·æ•æ‰åˆ°ã€‚</p><p>JetSamæœºåˆ¶ï¼ŒæŒ‡çš„å°±æ˜¯æ“ä½œç³»ç»Ÿä¸ºäº†æ§åˆ¶å†…å­˜èµ„æºè¿‡åº¦ä½¿ç”¨è€Œé‡‡ç”¨çš„ä¸€ç§èµ„æºç®¡æ§æœºåˆ¶ã€‚</p><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œç‰©ç†å†…å­˜å’Œ CPU å¯¹äºæ‰‹æœºè¿™æ ·çš„ä¾¿æºè®¾å¤‡æ¥è¯´ï¼Œå¯è°“ç¨€ç¼ºèµ„æºã€‚æ‰€ä»¥è¯´ï¼Œåœ¨iOS ç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜ç®¡ç†ä¸­ï¼Œå†…å­˜å‹åŠ›çš„ç®¡æ§å°±æ˜¯ä¸€é¡¹å¾ˆé‡è¦çš„å†…å®¹ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°±è·Ÿä½ ä»‹ç»ä¸€ä¸‹å¦‚ä½•è·å–å†…å­˜ä¸Šé™å€¼ï¼Œä»¥åŠå¦‚ä½•ç›‘æ§åˆ°Appå› ä¸ºå ç”¨å†…å­˜è¿‡å¤§è€Œè¢«å¼ºæ€çš„é—®é¢˜ï¼Ÿ</p><h2>é€šè¿‡ JetsamEvent æ—¥å¿—è®¡ç®—å†…å­˜é™åˆ¶å€¼</h2><p>æƒ³è¦äº†è§£ä¸åŒæœºå™¨åœ¨ä¸åŒç³»ç»Ÿç‰ˆæœ¬çš„æƒ…å†µä¸‹ï¼Œå¯¹ App çš„å†…å­˜é™åˆ¶æ˜¯æ€æ ·çš„ï¼Œæœ‰ä¸€ç§æ–¹æ³•å°±æ˜¯æŸ¥çœ‹æ‰‹æœºä¸­ä»¥ JetsamEvent å¼€å¤´çš„ç³»ç»Ÿæ—¥å¿—ï¼ˆæˆ‘ä»¬å¯ä»¥ä»è®¾ç½®-&gt;éšç§-&gt;åˆ†æä¸­çœ‹åˆ°è¿™äº›æ—¥å¿—ï¼‰ã€‚</p><p>åœ¨è¿™äº›ç³»ç»Ÿæ—¥å¿—ä¸­ï¼ŒæŸ¥æ‰¾å´©æºƒåŸå› æ—¶æˆ‘ä»¬éœ€è¦å…³æ³¨ per-process-limit éƒ¨åˆ†çš„ rpagesã€‚rpages è¡¨ç¤ºçš„æ˜¯ ï¼ŒApp å ç”¨çš„å†…å­˜é¡µæ•°é‡ï¼›per-process-limit è¡¨ç¤ºçš„æ˜¯ï¼ŒApp å ç”¨çš„å†…å­˜è¶…è¿‡äº†ç³»ç»Ÿå¯¹å•ä¸ªApp çš„å†…å­˜é™åˆ¶ã€‚</p><!-- [[[read_end]]] --><p>è¿™éƒ¨åˆ†æ—¥å¿—çš„ç»“æ„å¦‚ä¸‹ï¼š</p><pre><code>&quot;rpages&quot; : 89600,\n&quot;reason&quot; : &quot;per-process-limit&quot;,\n</code></pre><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†å†…å­˜é¡µæ•°é‡  rpages ä¸º 89600ï¼Œåªè¦å†çŸ¥é“å†…å­˜é¡µå¤§å°çš„å€¼ï¼Œå°±å¯ä»¥è®¡ç®—å‡ºç³»ç»Ÿå¯¹å•ä¸ªAppé™åˆ¶çš„å†…å­˜æ˜¯å¤šå°‘äº†ã€‚</p><p>å†…å­˜é¡µå¤§å°çš„å€¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ JetsamEvent å¼€å¤´çš„ç³»ç»Ÿæ—¥å¿—é‡Œæ‰¾åˆ°ï¼Œä¹Ÿå°±æ˜¯pageSizeçš„å€¼ã€‚å¦‚ä¸‹å›¾çº¢æ¡†éƒ¨åˆ†æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/f6/2a/f60391e3109494b411cef7d936b4792a.png?wh=1354*1256\" alt=\"\"><br>\nå¯ä»¥çœ‹åˆ°ï¼Œå†…å­˜é¡µå¤§å° pageSize çš„å€¼æ˜¯16384ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¡ç®—å‡ºå½“å‰ App çš„å†…å­˜é™åˆ¶å€¼ï¼špageSize * rpages / 1024 /1024 =16384 * 89600 / 1024 / 1024 å¾—åˆ°çš„å€¼æ˜¯ 1400 MBï¼Œå³ 1.4Gã€‚</p><p>è¿™äº› JetsamEvent æ—¥å¿—ï¼Œéƒ½æ˜¯ç³»ç»Ÿåœ¨æ€æ‰ App åç•™åœ¨æ‰‹æœºé‡Œçš„ã€‚åœ¨æŸ¥çœ‹è¿™äº›æ—¥å¿—æ—¶ï¼Œæˆ‘ä»¬å°±ä¼šå‘ç°ï¼Œå¾ˆå¤šæ—¥å¿—éƒ½æ˜¯ iOS ç³»ç»Ÿå†…æ ¸å¼ºæ€æ‰é‚£äº›ä¼˜å…ˆçº§ä¸é«˜ï¼Œå¹¶ä¸”å ç”¨çš„å†…å­˜è¶…è¿‡é™åˆ¶çš„ App åç•™ä¸‹çš„ã€‚</p><p>è¿™äº›æ—¥å¿—å±äºç³»ç»Ÿçº§çš„ï¼Œä¼šå­˜åœ¨ç³»ç»Ÿç›®å½•ä¸‹ã€‚Appä¸Šçº¿åå¼€å‘è€…æ˜¯æ²¡æœ‰æƒé™è·å–åˆ°ç³»ç»Ÿç›®å½•å†…å®¹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¢«å¼ºæ€æ‰çš„ App æ˜¯æ— æ³•è·å–åˆ°ç³»ç»Ÿçº§æ—¥å¿—çš„ï¼Œåªèƒ½çº¿ä¸‹è®¾å¤‡é€šè¿‡è¿æ¥ Xcode è·å–åˆ°è¿™éƒ¨åˆ†æ—¥å¿—ã€‚è·å–åˆ°Jetsam åï¼Œå°±èƒ½å¤Ÿç®—å‡ºç³»ç»Ÿå¯¹ App è®¾ç½®çš„å†…å­˜é™åˆ¶å€¼ã€‚</p><p>é‚£ä¹ˆï¼Œ<strong>iOSç³»ç»Ÿæ˜¯æ€ä¹ˆå‘ç° Jetsam çš„å‘¢ï¼Ÿ</strong></p><p>iOS ç³»ç»Ÿä¼šå¼€å¯ä¼˜å…ˆçº§æœ€é«˜çš„çº¿ç¨‹ vm_pressure_monitor æ¥ç›‘æ§ç³»ç»Ÿçš„å†…å­˜å‹åŠ›æƒ…å†µï¼Œå¹¶é€šè¿‡ä¸€ä¸ªå †æ ˆæ¥ç»´æŠ¤æ‰€æœ‰ App çš„è¿›ç¨‹ã€‚å¦å¤–ï¼ŒiOSç³»ç»Ÿè¿˜ä¼šç»´æŠ¤ä¸€ä¸ªå†…å­˜å¿«ç…§è¡¨ï¼Œç”¨äºä¿å­˜æ¯ä¸ªè¿›ç¨‹å†…å­˜é¡µçš„æ¶ˆè€—æƒ…å†µã€‚</p><p>å½“ç›‘æ§ç³»ç»Ÿå†…å­˜çš„çº¿ç¨‹å‘ç°æŸ App å†…å­˜æœ‰å‹åŠ›äº†ï¼Œå°±å‘å‡ºé€šçŸ¥ï¼Œå†…å­˜æœ‰å‹åŠ›çš„ App å°±ä¼šå»æ‰§è¡Œå¯¹åº”çš„ä»£ç†ï¼Œä¹Ÿå°±æ˜¯ä½ æ‰€ç†Ÿæ‚‰çš„ didReceiveMemoryWarning ä»£ç†ã€‚é€šè¿‡è¿™ä¸ªä»£ç†ï¼Œä½ å¯ä»¥è·å¾—æœ€åä¸€ä¸ªç¼–å†™é€»è¾‘ä»£ç é‡Šæ”¾å†…å­˜çš„æœºä¼šã€‚è¿™æ®µä»£ç çš„æ‰§è¡Œï¼Œå°±æœ‰å¯èƒ½ä¼šé¿å…ä½ çš„Appè¢«ç³»ç»Ÿå¼ºæ€ã€‚</p><p>ç³»ç»Ÿåœ¨å¼ºæ€Appå‰ï¼Œä¼šå…ˆåšä¼˜å…ˆçº§åˆ¤æ–­ã€‚é‚£ä¹ˆï¼Œè¿™ä¸ª<strong>ä¼˜å…ˆçº§åˆ¤æ–­çš„ä¾æ®æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</strong></p><p>iOSç³»ç»Ÿå†…æ ¸é‡Œæœ‰ä¸€ä¸ªæ•°ç»„ï¼Œä¸“é—¨ç”¨äºç»´æŠ¤çº¿ç¨‹çš„ä¼˜å…ˆçº§ã€‚è¿™ä¸ªä¼˜å…ˆçº§è§„å®šå°±æ˜¯ï¼šå†…æ ¸ç”¨çº¿ç¨‹çš„ä¼˜å…ˆçº§æ˜¯æœ€é«˜çš„ï¼Œæ“ä½œç³»ç»Ÿçš„ä¼˜å…ˆçº§å…¶æ¬¡ï¼ŒApp çš„ä¼˜å…ˆçº§æ’åœ¨æœ€åã€‚å¹¶ä¸”ï¼Œå‰å° App ç¨‹åºçš„ä¼˜å…ˆçº§æ˜¯é«˜äºåå°è¿è¡Œ App çš„ï¼›çº¿ç¨‹ä½¿ç”¨ä¼˜å…ˆçº§æ—¶ï¼ŒCPU å ç”¨å¤šçš„çº¿ç¨‹çš„ä¼˜å…ˆçº§ä¼šè¢«é™ä½ã€‚</p><p>iOSç³»ç»Ÿåœ¨å› ä¸ºå†…å­˜å ç”¨åŸå› å¼ºæ€æ‰Appå‰ï¼Œè‡³å°‘æœ‰6ç§’é’Ÿçš„æ—¶é—´å¯ä»¥ç”¨æ¥åšä¼˜å…ˆçº§åˆ¤æ–­ã€‚åŒæ—¶ï¼ŒJetSamEventæ—¥å¿—ä¹Ÿæ˜¯åœ¨è¿™6ç§’å†…ç”Ÿæˆçš„ã€‚</p><p>é™¤äº†JetSamEventæ—¥å¿—å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡XNUæ¥è·å–å†…å­˜çš„é™åˆ¶å€¼ã€‚</p><h2>é€šè¿‡ XNU è·å–å†…å­˜é™åˆ¶å€¼</h2><p>åœ¨ XNU ä¸­ï¼Œæœ‰ä¸“é—¨ç”¨äºè·å–å†…å­˜ä¸Šé™å€¼çš„å‡½æ•°å’Œå®ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ memorystatus_priority_entry è¿™ä¸ªç»“æ„ä½“ï¼Œå¾—åˆ°è¿›ç¨‹çš„ä¼˜å…ˆçº§å’Œå†…å­˜é™åˆ¶å€¼ã€‚ç»“æ„ä½“ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>typedef struct memorystatus_priority_entry {\n\tpid_t pid;\n\tint32_t priority;\n\tuint64_t user_data;\n\tint32_t limit;\n\tuint32_t state;\n} memorystatus_priority_entry_t;\n</code></pre><p>åœ¨è¿™ä¸ªç»“æ„ä½“ä¸­ï¼Œpriority è¡¨ç¤ºçš„æ˜¯è¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼Œlimitå°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„è¿›ç¨‹å†…å­˜é™åˆ¶å€¼ã€‚</p><h2>é€šè¿‡å†…å­˜è­¦å‘Šè·å–å†…å­˜é™åˆ¶å€¼</h2><p>é€šè¿‡XNU çš„å®è·å–å†…å­˜é™åˆ¶ï¼Œéœ€è¦æœ‰ root æƒé™ï¼Œè€ŒApp å†…çš„æƒé™æ˜¯ä¸å¤Ÿçš„ï¼Œæ‰€ä»¥æ­£å¸¸æƒ…å†µä¸‹ï¼Œä½œä¸ºAppå¼€å‘è€…ä½ æ˜¯çœ‹ä¸åˆ°è¿™ä¸ªä¿¡æ¯çš„ã€‚é‚£ä¹ˆï¼Œå¦‚æœä½ ä¸æƒ³è¶Šç‹±å»è·å–è¿™ä¸ªæƒé™çš„è¯ï¼Œè¿˜å¯ä»¥åˆ©ç”¨ didReceiveMemoryWarning è¿™ä¸ªå†…å­˜å‹åŠ›ä»£ç†äº‹ä»¶æ¥åŠ¨æ€åœ°è·å–å†…å­˜é™åˆ¶å€¼ã€‚</p><p>iOSç³»ç»Ÿåœ¨å¼ºæ€æ‰Appä¹‹å‰è¿˜æœ‰6ç§’é’Ÿçš„æ—¶é—´ï¼Œè¶³å¤Ÿä½ å»è·å–è®°å½•å†…å­˜ä¿¡æ¯äº†ã€‚é‚£ä¹ˆï¼Œ<strong>å¦‚ä½•è·å–å½“å‰å†…å­˜ä½¿ç”¨æƒ…å†µå‘¢ï¼Ÿ</strong></p><p>iOSç³»ç»Ÿæä¾›äº†ä¸€ä¸ªå‡½æ•° task_infoï¼Œ å¯ä»¥å¸®åŠ©æˆ‘ä»¬è·å–åˆ°å½“å‰ä»»åŠ¡çš„ä¿¡æ¯ã€‚å…³é”®ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>struct mach_task_basic_info info;\nmach_msg_type_number_t size = sizeof(info);\nkern_return_t kl = task_info(mach_task_self(), MACH_TASK_BASIC_INFO, (task_info_t)&amp;info, &amp;size);\n</code></pre><p>ä»£ç ä¸­ï¼Œtask_info_t ç»“æ„é‡ŒåŒ…å«äº†ä¸€ä¸ªresident_size å­—æ®µï¼Œç”¨äºè¡¨ç¤ºä½¿ç”¨äº†å¤šå°‘å†…å­˜ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å–åˆ°å‘ç”Ÿå†…å­˜è­¦å‘Šæ—¶ï¼Œå½“å‰App å ç”¨äº†å¤šå°‘å†…å­˜ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>float used_mem = info.resident_size;\nNSLog(@&quot;ä½¿ç”¨äº† %f MB å†…å­˜&quot;, used_mem / 1024.0f / 1024.0f)\n</code></pre><h2>å®šä½å†…å­˜é—®é¢˜ä¿¡æ¯æ”¶é›†</h2><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥é€šè¿‡ä¸‰ç§æ–¹æ³•æ¥è·å–å†…å­˜ä¸Šé™å€¼äº†ï¼Œè€Œä¸”é€šè¿‡å†…å­˜è­¦å‘Šçš„æ–¹å¼è¿˜èƒ½å¤ŸåŠ¨æ€åœ°è·å–åˆ°è¿™ä¸ªå€¼ã€‚æœ‰äº†è¿™ä¸ªå†…å­˜ä¸Šé™å€¼ä»¥åï¼Œä½ å°±å¯ä»¥è¿›è¡Œå†…å­˜é—®é¢˜çš„ä¿¡æ¯æ”¶é›†å·¥ä½œäº†ã€‚</p><p>è¦æƒ³ç²¾ç¡®åœ°å®šä½é—®é¢˜ï¼Œæˆ‘ä»¬å°±éœ€è¦ dump å‡ºå®Œæ•´çš„å†…å­˜ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ‰€æœ‰å¯¹è±¡åŠå…¶å†…å­˜å ç”¨å€¼ï¼Œåœ¨å†…å­˜æ¥è¿‘ä¸Šé™å€¼çš„æ—¶å€™ï¼Œæ”¶é›†å¹¶è®°å½•ä¸‹æ‰€éœ€ä¿¡æ¯ï¼Œå¹¶åœ¨åˆé€‚çš„æ—¶æœºä¸ŠæŠ¥åˆ°æœåŠ¡å™¨é‡Œï¼Œæ–¹ä¾¿åˆ†æé—®é¢˜ã€‚</p><p>è·å–åˆ°äº†æ¯ä¸ªå¯¹è±¡çš„å†…å­˜å ç”¨é‡è¿˜ä¸å¤Ÿï¼Œä½ è¿˜éœ€è¦çŸ¥é“æ˜¯è°åˆ†é…çš„å†…å­˜ï¼Œè¿™æ ·æ‰å¯ä»¥ç²¾ç¡®å®šä½åˆ°é—®é¢˜çš„å…³é”®æ‰€åœ¨ã€‚ä¸€ä¸ªå¯¹è±¡å¯èƒ½ä¼šåœ¨ä¸åŒçš„å‡½æ•°é‡Œè¢«åˆ†é…äº†å†…å­˜å¹¶è¢«åˆ›å»ºäº†å‡ºæ¥ï¼Œå½“è¿™ä¸ªå¯¹è±¡å†…å­˜å ç”¨è¿‡å¤§æ—¶ï¼Œå¦‚æœä¸çŸ¥é“æ˜¯åœ¨å“ªä¸ªå‡½æ•°é‡Œåˆ›å»ºçš„è¯ï¼Œé—®é¢˜ä¾ç„¶å¾ˆéš¾ç²¾ç¡®å®šä½å‡ºæ¥ã€‚é‚£ä¹ˆï¼Œ<strong>æ€æ ·æ‰èƒ½çŸ¥é“æ˜¯è°åˆ†é…çš„å†…å­˜å‘¢ï¼Ÿ</strong></p><p>è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘è§‰å¾—åº”è¯¥ä»æ ¹å„¿ä¸Šå»æ‰¾ç­”æ¡ˆã€‚å†…å­˜åˆ†é…å‡½æ•° malloc å’Œ calloc ç­‰é»˜è®¤ä½¿ç”¨çš„æ˜¯ nano_zoneã€‚nano_zone æ˜¯256Bä»¥ä¸‹å°å†…å­˜çš„åˆ†é…ï¼Œå¤§äº256B çš„æ—¶å€™ä¼šä½¿ç”¨ scalable_zone æ¥åˆ†é…ã€‚</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä¸»è¦æ˜¯é’ˆå¯¹å¤§å†…å­˜çš„åˆ†é…ç›‘æ§ï¼Œæ‰€ä»¥åªé’ˆå¯¹ scalable_zone è¿›è¡Œåˆ†æï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥è¿‡æ»¤æ‰å¾ˆå¤šå°å†…å­˜åˆ†é…ç›‘æ§ã€‚æ¯”å¦‚ï¼Œmallocå‡½æ•°ç”¨çš„æ˜¯ malloc_zone_mallocï¼Œcalloc ç”¨çš„æ˜¯ malloc_zone_callocã€‚</p><p>ä½¿ç”¨scalable_zone åˆ†é…å†…å­˜çš„å‡½æ•°éƒ½ä¼šè°ƒç”¨ malloc_logger å‡½æ•°ï¼Œå› ä¸ºç³»ç»Ÿæ€»æ˜¯éœ€è¦æœ‰ä¸€ä¸ªåœ°æ–¹æ¥ç»Ÿè®¡å¹¶ç®¡ç†å†…å­˜çš„åˆ†é…æƒ…å†µã€‚</p><p>å…·ä½“å®ç°çš„è¯ï¼Œä½ å¯ä»¥æŸ¥çœ‹ malloc_zone_malloc å‡½æ•°çš„å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code>void *malloc_zone_malloc(malloc_zone_t *zone, size_t size)\n{\n\tMALLOC_TRACE(TRACE_malloc | DBG_FUNC_START, (uintptr_t)zone, size, 0, 0);\n\tvoid *ptr;\n\tif (malloc_check_start &amp;&amp; (malloc_check_counter++ &gt;= malloc_check_start)) {\n\t\tinternal_check();\n\t}\n\tif (size &gt; MALLOC_ABSOLUTE_MAX_SIZE) {\n\t\treturn NULL;\n\t}\n\tptr = zone-&gt;malloc(zone, size);\n\t// åœ¨ zone åˆ†é…å®Œå†…å­˜åå°±å¼€å§‹ä½¿ç”¨ malloc_logger è¿›è¡Œè¿›è¡Œè®°å½•\n\tif (malloc_logger) {\n\t\tmalloc_logger(MALLOC_LOG_TYPE_ALLOCATE | MALLOC_LOG_TYPE_HAS_ZONE, (uintptr_t)zone, (uintptr_t)size, 0, (uintptr_t)ptr, 0);\n\t}\n\tMALLOC_TRACE(TRACE_malloc | DBG_FUNC_END, (uintptr_t)zone, size, (uintptr_t)ptr, 0);\n\treturn ptr;\n}\n</code></pre><p>å…¶ä»–ä½¿ç”¨ scalable_zone åˆ†é…å†…å­˜çš„å‡½æ•°çš„æ–¹æ³•ä¹Ÿç±»ä¼¼ï¼Œæ‰€æœ‰å¤§å†…å­˜çš„åˆ†é…ï¼Œä¸ç®¡å¤–éƒ¨å‡½æ•°æ˜¯æ€ä¹ˆåŒ…è£…çš„ï¼Œæœ€ç»ˆéƒ½ä¼šè°ƒç”¨ malloc_logger å‡½æ•°ã€‚è¿™æ ·çš„è¯ï¼Œé—®é¢˜å°±å¥½è§£å†³äº†ï¼Œä½ å¯ä»¥ä½¿ç”¨ fishhook å» Hook è¿™ä¸ªå‡½æ•°ï¼ŒåŠ ä¸Šè‡ªå·±çš„ç»Ÿè®¡è®°å½•å°±èƒ½å¤Ÿé€šç›˜æŒæ¡å†…å­˜çš„åˆ†é…æƒ…å†µã€‚å‡ºç°é—®é¢˜æ—¶ï¼Œå°†å†…å­˜åˆ†é…è®°å½•çš„æ—¥å¿—æä¸Šæ¥ï¼Œä½ å°±èƒ½å¤Ÿè·Ÿè¸ªåˆ°å¯¼è‡´å†…å­˜ä¸åˆç†å¢å¤§çš„åŸå› äº†ã€‚</p><h2>å°ç»“</h2><p>ä¸ºäº†è¾¾åˆ°ç›‘æ§å†…å­˜çš„ç›®çš„ï¼Œæˆ‘ä»¬éœ€è¦åšä¸¤ä»¶äº‹æƒ…ï¼šä¸€æ˜¯ï¼Œèƒ½å¤Ÿæ ¹æ®ä¸åŒæœºå™¨å’Œç³»ç»Ÿè·å–åˆ°å†…å­˜æœ‰é—®é¢˜çš„é‚£ä¸ªæ—¶é—´ç‚¹ï¼›äºŒæ˜¯ï¼Œåˆ°äº†å‡ºç°å†…å­˜é—®é¢˜çš„é‚£ä¸ªæ—¶é—´ç‚¹æ—¶ï¼Œè¿˜èƒ½è¦å–åˆ°è¶³å¤Ÿå¤šçš„å¯ä»¥åˆ†æå†…å­˜é—®é¢˜çš„ä¿¡æ¯ã€‚</p><p>é’ˆå¯¹è¿™ä¸¤ä»¶äº‹ï¼Œæˆ‘åœ¨ä»Šå¤©è¿™ç¯‡æ–‡ç« é‡Œå’Œä½ åˆ†äº«äº†åœ¨ JetsamEvent æ—¥å¿—é‡Œã€åœ¨ XNU ä»£ç é‡Œã€åœ¨ task_info å‡½æ•°ä¸­æ€ä¹ˆå»æ‰¾å†…å­˜çš„ä¸Šé™å€¼ã€‚ç„¶åï¼Œæˆ‘å’Œä½ ä¸€èµ·åˆ†æäº†åœ¨å†…å­˜åˆ°è¾¾ä¸Šé™å€¼æ—¶ï¼Œæ€ä¹ˆé€šè¿‡å†…å­˜åˆ†é…æ—¶éƒ½ä¼šç»è¿‡çš„ malloc_logger å‡½æ•°æ¥æŒæ¡å†…å­˜åˆ†é…çš„è¯¦ç»†ä¿¡æ¯ï¼Œä»è€Œç²¾ç¡®å®šä½å†…å­˜é—®é¢˜ã€‚</p><p>è¯´åˆ°è¿™é‡Œä½ å¯èƒ½ä¼šå›è¿‡å¤´æ¥æƒ³ï¼Œä¸ºä»€ä¹ˆç”¨äºå ç”¨å†…å­˜è¿‡å¤§æ—¶ä¼šè¢«ç³»ç»Ÿå¼ºæ€å‘¢ï¼ŸmacOS æ‰“å¼€ä¸€å †åº”ç”¨ä¹Ÿä¼šè¿œè¶…ç‰©ç†å†…å­˜ï¼Œæ€ä¹ˆæ²¡è§ç³»ç»Ÿå»å¼ºæ€ macOS çš„åº”ç”¨å‘¢ï¼Ÿ</p><p>å…¶å®ï¼Œè¿™é‡Œæ¶‰åŠåˆ°çš„æ˜¯è®¾å¤‡èµ„æºçš„é—®é¢˜ã€‚è‹¹æœå…¬å¸è€ƒè™‘åˆ°æ‰‹æŒè®¾å¤‡å­˜å‚¨ç©ºé—´å°çš„é—®é¢˜ï¼Œåœ¨ iOS ç³»ç»Ÿé‡Œå»æ‰äº†äº¤æ¢ç©ºé—´ï¼Œè¿™æ ·è™šæ‹Ÿå†…å­˜å°±æ²¡æœ‰åŠæ³•è®°å½•åˆ°å¤–éƒ¨çš„å­˜å‚¨ä¸Šã€‚äºæ˜¯ï¼Œè‹¹æœå…¬å¸å¼•å…¥äº† MemoryStatus æœºåˆ¶ã€‚</p><p>è¿™ä¸ªæœºåˆ¶çš„ä¸»è¦æ€è·¯å°±æ˜¯ï¼Œåœ¨ iOS ç³»ç»Ÿä¸Šå¼¹å‡ºå°½å¯èƒ½å¤šçš„å†…å­˜ä¾›å½“å‰åº”ç”¨ä½¿ç”¨ã€‚æŠŠè¿™ä¸ªæœºåˆ¶è½åˆ°ä¼˜å…ˆçº§ä¸Šï¼Œå°±æ˜¯å…ˆå¼ºæ€åå°åº”ç”¨ï¼›å¦‚æœå†…å­˜è¿˜ä¸å¤Ÿå¤šå°±å¼ºæ€æ‰å½“å‰åº”ç”¨ã€‚è€Œåœ¨macOS ç³»ç»Ÿé‡Œï¼ŒMemoryStatus åªä¼šå¼ºæ€æ‰æ ‡è®°ä¸ºç©ºé—²é€€å‡ºçš„è¿›ç¨‹ã€‚</p><p>åœ¨å®ç°ä¸Šï¼ŒMemoryStatus æœºåˆ¶ä¼šå¼€å¯ä¸€ä¸ªmemorystatus_jetsam_thread çš„çº¿ç¨‹ã€‚è¿™ä¸ªçº¿ç¨‹ï¼Œå’Œå†…å­˜å‹åŠ›ç›‘æµ‹çº¿ç¨‹ vm_pressure_monitor æ²¡æœ‰è”ç³»ï¼Œåªè´Ÿè´£å¼ºæ€åº”ç”¨å’Œè®°å½•æ—¥å¿—ï¼Œä¸ä¼šå‘é€æ¶ˆæ¯ï¼Œæ‰€ä»¥å†…å­˜å‹åŠ›æ£€æµ‹çº¿ç¨‹æ— æ³•è·å–åˆ°å¼ºæ€åº”ç”¨çš„æ¶ˆæ¯ã€‚</p><p>é™¤å†…å­˜è¿‡å¤§è¢«ç³»ç»Ÿå¼ºæ€è¿™ç§å†…å­˜é—®é¢˜ä»¥å¤–ï¼Œè¿˜æœ‰ä»¥ä¸‹ä¸‰ç§å†…å­˜é—®é¢˜ï¼š</p><ul>\n<li>è®¿é—®æœªåˆ†é…çš„å†…å­˜ï¼š XNU ä¼šæŠ¥ EXC_BAD_ACCESSé”™è¯¯ï¼Œä¿¡å·ä¸º SIGSEGV Signal #11 ã€‚</li>\n<li>è®¿é—®å·²åˆ†é…ä½†æœªæäº¤çš„å†…å­˜ï¼šXNU ä¼šæ‹¦æˆªåˆ†é…ç‰©ç†å†…å­˜ï¼Œå‡ºç°é—®é¢˜çš„çº¿ç¨‹åˆ†é…å†…å­˜é¡µæ—¶ä¼šè¢«å†»ç»“ã€‚</li>\n<li>æ²¡æœ‰éµå®ˆæƒé™è®¿é—®å†…å­˜ï¼šå†…å­˜é¡µé¢çš„æƒé™æ ‡å‡†ç±»ä¼¼ UNIX æ–‡ä»¶æƒé™ã€‚å¦‚æœå»å†™åªè¯»æƒé™çš„å†…å­˜é¡µé¢å°±ä¼šå‡ºç°é”™è¯¯ï¼ŒXNU ä¼šå‘å‡º SIGBUS Signal #7 ä¿¡å·ã€‚</li>\n</ul><p>ç¬¬ä¸€ç§å’Œç¬¬ä¸‰ç§é—®é¢˜éƒ½å¯ä»¥é€šè¿‡å´©æºƒä¿¡æ¯è·å–åˆ°ï¼Œåœ¨æ”¶é›†å´©æºƒä¿¡æ¯æ—¶å¦‚æœå‘ç°æ˜¯è¿™ä¸¤ç±»ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŠŠå†…å­˜åˆ†é…çš„è®°å½•åŒæ—¶ä¼ è¿‡æ¥è¿›è¡Œåˆ†æï¼Œå¯¹äºä¸åˆç†çš„å†…å­˜åˆ†é…è¿›è¡Œä¼˜åŒ–å’Œä¿®æ”¹ã€‚</p><h2>è¯¾åå°ä½œä¸š</h2><p>æˆ‘ä»Šå¤©æåˆ°äº†å®šä½å†…å­˜é—®é¢˜éœ€è¦è·å–æ›´å¤šçš„ä¿¡æ¯ï¼Œæ¯”å¦‚å†…å­˜åˆ†é…ã€‚é‚£ä¹ˆï¼Œè¯·ä½ æ¥æ ¹æ®æˆ‘ä»¬ä»Šå¤©æ‰€è®²çš„ hook malloc_logger çš„æ–¹æ³•ï¼Œæ¥å®ç°ä¸€ä¸ªè®°å½•å†…å­˜åˆ†é…çš„å°å·¥å…·å§ã€‚</p><p>æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæ¬¢è¿ä½ åœ¨è¯„è®ºåŒºç»™æˆ‘ç•™è¨€åˆ†äº«ä½ çš„è§‚ç‚¹ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p>","comments":[{"had_liked":false,"id":84897,"user_name":"ç™½å¼€äº†æ¯æ°´","can_delete":false,"product_type":"c1","uid":1156672,"ip_address":"","ucode":"F0328577343AB5","user_header":"https://static001.geekbang.org/account/avatar/00/11/a6/40/6518a188.jpg","comment_is_top":false,"comment_ctime":1554943692,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"61684485836","product_id":100024501,"comment_content":"ä¸€ç›´ä¸çŸ¥é“å†…å­˜åˆ†é…æœ€å¤§å€¼è·å–å’Œæ€ä¹ˆè·å–å½“å‰å†…å­˜åˆ†é…ï¼Œçœ‹äº†æ–‡ç« è±ç„¶å¼€æœ—ï¼Œæƒ³é—®çš„æ˜¯ï¼Œè€å¸ˆè¿™äº›çŸ¥è¯†éƒ½æ˜¯é€šè¿‡åˆ†ææºç å¾—æ¥çš„å—ï¼Ÿ","like_count":15,"discussions":[{"author":{"id":1785940,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/rWMGIQG1z13nekorr9I4PY1w7rlskssf949IQ24SvIewpM7mmZoH2QEZ2aKHu5tkmicGQ7KTGrN9vFYhrDsdp9w/132","nickname":"Geek_9dbcb4","note":"","ucode":"BB92D5E844A743","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":230981,"discussion_content":"å†…åŠŸæ·±åšï¼ŒåŠ ä¸ŠæŸ¥é˜…èµ„æ–™","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586783662,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":219652,"user_name":"æ¬¢ä¹çš„å°é©¬é©¹","can_delete":false,"product_type":"c1","uid":1078951,"ip_address":"","ucode":"B594106688CEE7","user_header":"https://static001.geekbang.org/account/avatar/00/10/76/a7/374e86a7.jpg","comment_is_top":false,"comment_ctime":1590056090,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"48834696346","product_id":100024501,"comment_content":"æˆ‘å»ºè®®ï¼Œä»¥åå†™è¿™æ ·çš„ä¸“æ ï¼Œæœ€åæŠŠæ‰€æœ‰å‚è€ƒçš„åŸå§‹èµ„æ–™éƒ½ä¸‹ã€‚ä½ è§‰å¾—å‘¢ï¼Ÿ","like_count":12},{"had_liked":false,"id":85705,"user_name":"drunkenMouse","can_delete":false,"product_type":"c1","uid":1454037,"ip_address":"","ucode":"AA8CEA703ECBE8","user_header":"","comment_is_top":false,"comment_ctime":1555208016,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"35914946384","product_id":100024501,"comment_content":"iOSé€šè¿‡å †æ ˆç®¡ç†æ‰€æœ‰çš„appè¿›ç¨‹ï¼Œé€šè¿‡ä¸€ä¸ªä¼˜å…ˆçº§æœ€é«˜çš„çº¿ç¨‹å»ç›‘æ§ç³»ç»Ÿå†…å­˜çš„å‹åŠ›ï¼Œè¿˜æœ‰ä¸€ä¸ªå¿«é€Ÿå¯¹ç…§è¡¨è®°å½•æ‰€æœ‰appçš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚å¦‚æœå†…å­˜æœ‰å‹åŠ›äº†ï¼Œå°±æŒ‰ç…§ä¼˜å…ˆçº§å»é‡Šæ”¾ä¼˜å…ˆçº§ä½è¿˜ä½¿ç”¨å†…å­˜å¤šçš„ã€‚<br><br>æ‰€ä»¥appå¾—å†…å­˜é˜ˆå€¼æ˜¯æ²¡æœ‰å›ºå®šå¤§å°çš„ã€‚æˆ‘ä¸€ç›´ä»¥ä¸ºæ¯ä¸ªappå¯ä»¥ä½¿ç”¨çš„å†…å­˜å¤§å°æ˜¯å›ºå®šçš„ã€‚ã€‚","like_count":9},{"had_liked":false,"id":87386,"user_name":"æˆ‘å””çŸ¥ç‚¹æ­»å•Š","can_delete":false,"product_type":"c1","uid":1454319,"ip_address":"","ucode":"032CCE72B8F848","user_header":"","comment_is_top":false,"comment_ctime":1555580691,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"18735449875","product_id":100024501,"comment_content":"fishhookåˆå­¦è€…æé—®ï¼š<br>å…³äºfishhook malloc_loggerï¼Œåœ¨libmallocä¸­æ‰¾åˆ°malloc_loggeræ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼š<br>typedef void(malloc_logger_t)(uint32_t type,<br>\t\tuintptr_t arg1,<br>\t\tuintptr_t arg2,<br>\t\tuintptr_t arg3,<br>\t\tuintptr_t result,<br>\t\tuint32_t num_hot_frames_to_skip);<br><br>fishhook malloc_loggeræ²¡æœ‰ä»»ä½•ä½œç”¨ï¼Œç„¶ååœ¨_malloc_initializeæ–¹æ³•é‡Œé¢ï¼Œæ‰¾åˆ°è¿™å¥malloc_logger = __disk_stack_logging_log_stack;<br>fishhhok __disk_stack_logging_log_stackåŒæ ·ä¸èµ·ä½œç”¨ï¼Œç°åœ¨æ— ä»ä¸‹æ‰‹ï¼Œè¯·æŒ‡æ•™ã€‚<br><br>æˆ‘çš„fishhookæ–¹æ³•å¦‚ä¸‹ï¼š<br>static void (*original_disk_stack_logging_log_stack)(uint32_t type_flags,<br>                               uintptr_t zone_ptr,<br>                               uintptr_t arg2,<br>                               uintptr_t arg3,<br>                               uintptr_t return_val,<br>                                  uint32_t num_hot_to_skip);<br>void new_disk_stack_logging_log_stack(uint32_t type_flags,<br>                               uintptr_t zone_ptr,<br>                               uintptr_t arg2,<br>                               uintptr_t arg3,<br>                               uintptr_t return_val,<br>                               uint32_t num_hot_to_skip) {<br>    NSLog(@&quot;========== __disk_stack_logging_log_stack ==========&quot;);<br>}<br><br>        struct rebinding malloc_logger_rebinding = { &quot;__disk_stack_logging_log_stack&quot;, original_disk_stack_logging_log_stack, (void *)&amp;original_disk_stack_logging_log_stack};<br>        rebind_symbols((struct rebinding[1]){malloc_logger_rebinding}, 1);","like_count":4,"discussions":[{"author":{"id":1471806,"avatar":"https://static001.geekbang.org/account/avatar/00/16/75/3e/71b16443.jpg","nickname":"Struggle","note":"","ucode":"C769D8FFD9C1B6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283751,"discussion_content":"åŸºç¡€ä¸å¥½çš„æˆ‘è¿™ä¸ªåœ°æ–¹ç†è§£äº†è¶…çº§ä¹…ï¼Œä¸è¿‡æœ€ç»ˆè¿˜æ˜¯hookåˆ°äº†ï¼Œæ­£å¦‚æ¥¼ä¸Šè¯´çš„ï¼Œä¸éœ€è¦fishhook,åªéœ€è¦æ·»åŠ å®ç°å°±å¯ä»¥äº†\nå¦‚ä¸‹\n\n1:ä¸‹é¢è¿™æ®µä»£ç æ˜¯ä»libmallocæ‹·è´çš„\ntypedef void(malloc_logger_t)(\n        uint32_t type,\n        uintptr_t arg1,\n        uintptr_t arg2,\n        uintptr_t arg3,\n        uintptr_t result,\n        uint32_t num_hot_frames_to_skip);\nextern malloc_logger_t *malloc_logger; \n\na:è¿™ä»£ç çš„æ„æ€æ˜¯å®šä¹‰äº†ä¸€ä¸ªè¿™æ ·çš„å‡½æ•°\nvoid()(uint32_t, uintptr_t, uintptr_t, uintptr_t, uintptr_t, uint32_t),å‡½æ•°çš„åˆ«åæ˜¯malloc_logger_t;\nb:externè¡¨ç¤ºåé¢çš„æ˜¯ä»å…¶ä»–åœ°æ–¹å¼•ç”¨çš„,å…¶ä»–çš„åœ°æ–¹å®šä¹‰äº†ä¸€ä¸ªmalloc_logger_tç±»å‹çš„å‡½æ•°æŒ‡é’ˆmalloc_logger\nä¸Šé¢è¿™æ®µä»£ç æœ‰ç‚¹ç±»ä¼¼äº \ntypedef int A; //ç»™intæ·»åŠ ä¸€ä¸ªåˆ«å\nA a; //å®šä¹‰ä¸€ä¸ªAç±»å‹çš„å˜é‡,å°±æ˜¯int ç±»å‹çš„å˜é‡\n\n2:æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°å®ç°\nvoid malloc_logger_impl(uint32_t type,uintptr_t arg1,uintptr_t arg2,uintptr_t arg3,uintptr_t result,uint32_t num_hot_frames_to_skip){\n    printf(&#34;%d-%lu-%lu-%lu-%lu-%d\\n&#34;,type,arg1,arg2,arg3,result,num_hot_frames_to_skip);\n}\n3:åœ¨ä½ çš„å…¥å£æ·»åŠ ä»£ç ,å¯ä»¥çœ‹åˆ°libmallocé‡Œé¢çš„malloc_logger=NULLçš„ï¼Œè¿™ä¸ªåœ°æ–¹æˆ‘ä»¬ç»™ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±çš„å‡½æ•°å®ç°,åœ¨if(malloc_logger)çš„æ—¶å€™å°±èƒ½æ‰§è¡Œåˆ°ifé‡Œé¢äº†\nmalloc_logger = malloc_logger_impl\nè¿™æ ·å°±èƒ½å¤ŸæˆåŠŸhook\n\n\n---------------å®Œæ•´ä»£ç \n\n#import <UIKit/UIKit.h>\n#import &#34;AppDelegate.h&#34;\n#import &#34;SyxDemo.h&#34;\ntypedef void(malloc_logger_t)(\n        uint32_t type,\n        uintptr_t arg1,\n        uintptr_t arg2,\n        uintptr_t arg3,\n        uintptr_t result,\n        uint32_t num_hot_frames_to_skip);\nextern malloc_logger_t *malloc_logger;\nvoid malloc_logger_impl(uint32_t type,uintptr_t arg1,uintptr_t arg2,uintptr_t arg3,uintptr_t result,uint32_t num_hot_frames_to_skip){\n    printf(&#34;%d-%lu-%lu-%lu-%lu-%d\\n&#34;,type,arg1,arg2,arg3,result,num_hot_frames_to_skip);\n}\nint main(int argc, char * argv[]) {\n    NSString * appDelegateClassName;\n    @autoreleasepool {\n        appDelegateClassName = NSStringFromClass([AppDelegate class]);\n        malloc_logger = malloc_logger_impl;\n        SyxDemo *demo = [[SyxDemo alloc]init];\n    }\n    return UIApplicationMain(argc, argv, nil, appDelegateClassName);\n}","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1592356185,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1029592,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b5/d8/56148446.jpg","nickname":"å¼ è‹±æ°","note":"","ucode":"4EC0B6D787EBF8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7518,"discussion_content":"å¯ä»¥çœ‹ä¸€ä¸‹libmallocæºç ï¼Œmalloc_loggeræœ¬èº«å°±æ˜¯ä¸€ä¸ªé’©å­å‡½æ•°ï¼Œä¸éœ€è¦ç”¨fishhook","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1567526344,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":107176,"user_name":"æ— å","can_delete":false,"product_type":"c1","uid":1110113,"ip_address":"","ucode":"2D2E877CF97138","user_header":"https://static001.geekbang.org/account/avatar/00/10/f0/61/68462a07.jpg","comment_is_top":false,"comment_ctime":1561473573,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"14446375461","product_id":100024501,"comment_content":"æˆ‘é—®è¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯çœ‹åˆ°SDWebImage 2.6ç‰ˆæœ¬çš„æºç ä¸­é‡Šæ”¾å†…å­˜ç¼“å­˜æœ‰ä¸¤ç§æ–¹å¼ï¼š<br>ç¬¬ä¸€ç§ï¼šç›‘å¬åˆ°å†…å­˜ä¸è¶³æ—¶ï¼Œé‡Šæ”¾æ‰€æœ‰å†…å­˜ç¼“å­˜ï¼›<br>ç¬¬äºŒç§ï¼šå½“ç³»ç»Ÿå‰©ä½™å†…å­˜å°äº12Mæ—¶ï¼Œé‡Šæ”¾å†…å­˜ç¼“å­˜ã€‚<br><br>åˆšå¼€å§‹ç‰ˆæœ¬æ˜¯æ²¡æœ‰åŠ ç¬¬äºŒç§åˆ¤æ–­çš„ã€‚æˆ‘çš„ç–‘é—®æ˜¯åŠ ä¸Šç¬¬äºŒç§åˆ¤æ–­æœ‰å¿…è¦å—ï¼Ÿå¦‚æœæœ‰å¿…è¦çš„è¯ï¼Œé‚£ä¹ˆå°±æ˜¯ï¼Œå½“ç³»ç»Ÿåªå‰©12Må†…å­˜éƒ½è¿˜æ²¡æœ‰è§¦å‘å†…å­˜ä¸è¶³çš„é€šçŸ¥ã€‚<br><br>æ‰€ä»¥è¯´è¿™ä¸ªå†…å­˜ä¸è¶³é€šçŸ¥æ˜¯å¦åœ¨åº”ç”¨èƒ½ç»™å®ƒåˆ†é…çš„æœ€å¤§å†…å­˜éƒ½å…¨éƒ¨ä½¿ç”¨å®Œäº†æ‰å‘å‡ºé€šçŸ¥è¿˜æ˜¯ï¼Ÿ<br>å¦‚ï¼šå½“å‰appèƒ½ä½¿ç”¨çš„æœ€å¤§å†…å­˜ä¸º2Gï¼Œç³»ç»Ÿæ€»å…±å†…å­˜ä¸º4Gã€‚é‚£æ˜¯å¦è¯´ä¸ç®¡ç³»ç»Ÿæ˜¯å¦è¿˜å‰©ä½™å¤šå°‘å†…å­˜ï¼Œåªè¦appçš„å†…å­˜è¾¾åˆ°2Gå°±å‘å‡ºå†…å­˜è­¦å‘Šé€šçŸ¥ï¼Ÿè¿˜æ˜¯è¯´å¿«åˆ°2G,å¦‚è¾¾åˆ°æœ€å¤§å¯ç”¨å†…å­˜çš„ç™¾åˆ†ä¹‹95ä»¥ä¸Šå°±å‘å‡ºå†…å­˜è­¦å‘Šé€šçŸ¥ã€‚æœ‰å“ªé‡Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªå€¼å—ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1460977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/4a/f1/e3b02c6d.jpg","nickname":"è«è¨€","note":"","ucode":"3B5782B58BFD18","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":216529,"discussion_content":"ä½ å¯ä»¥ç®€å•æµ‹è¯•ä¸€ä¸‹ï¼Œå†™ç»™forå¾ªç¯è·å–ä¸åœçš„macllocä¸é‡Šæ”¾å†…å­˜ï¼Œä½ çœ‹å†…å­˜è¾¾åˆ°å•¥ç¨‹åº¦èƒ½æ”¶åˆ°å†…å­˜è­¦å‘Š","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585461010,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1785940,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/rWMGIQG1z13nekorr9I4PY1w7rlskssf949IQ24SvIewpM7mmZoH2QEZ2aKHu5tkmicGQ7KTGrN9vFYhrDsdp9w/132","nickname":"Geek_9dbcb4","note":"","ucode":"BB92D5E844A743","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":230983,"discussion_content":"è¾¾åˆ°æœ€å¤§å€¼æ—¶ï¼Œå‘é€šçŸ¥å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586783830,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86988,"user_name":"å¾ç§€æ»¨","can_delete":false,"product_type":"c1","uid":1457337,"ip_address":"","ucode":"36895D00A181FB","user_header":"https://static001.geekbang.org/account/avatar/00/16/3c/b9/42b228f8.jpg","comment_is_top":false,"comment_ctime":1555493001,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14440394889","product_id":100024501,"comment_content":"è€å¸ˆï¼Œæˆ‘æ²¡æ‰¾åˆ°malloc_loggerè¿™ä¸ªæ–¹æ³•ï¼Œæ²¡æ³•hookï¼Œå’‹æï¼Ÿ","like_count":3},{"had_liked":false,"id":84930,"user_name":"é¼ è¾ˆ","can_delete":false,"product_type":"c1","uid":1457947,"ip_address":"","ucode":"F8CD6602D9320E","user_header":"https://static001.geekbang.org/account/avatar/00/16/3f/1b/40293181.jpg","comment_is_top":false,"comment_ctime":1554946216,"is_pvip":false,"replies":[{"id":"30719","content":"ä½¿ç”¨çš„å­—æ®µä¸åŒï¼Œtask_vm_info_data_t è¿˜æœ‰ä¸ª phys_footprint ä»£è¡¨çš„å®é™…ä½¿ç”¨çš„ç‰©ç†å†…å­˜","user_name":"ä½œè€…å›å¤","user_name_real":"æˆ´é“­","uid":"1140280","ctime":1555139750,"ip_address":"","comment_id":84930,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14439848104","product_id":100024501,"comment_content":"info.resident_sizeè¿™ä¸ªè·å–çš„å†…å­˜å’Œxcodeä¸Šæ˜¾ç¤ºçš„å†…å­˜æ˜¯å¯¹ä¸ä¸Šçš„ã€‚ä¸çŸ¥é“æ‚¨æ€ä¹ˆçœ‹è¿™ä¸ªé—®é¢˜ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"æˆ´é“­","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446501,"discussion_content":"ä½¿ç”¨çš„å­—æ®µä¸åŒï¼Œtask_vm_info_data_t è¿˜æœ‰ä¸ª phys_footprint ä»£è¡¨çš„å®é™…ä½¿ç”¨çš„ç‰©ç†å†…å­˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555139750,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1785940,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/rWMGIQG1z13nekorr9I4PY1w7rlskssf949IQ24SvIewpM7mmZoH2QEZ2aKHu5tkmicGQ7KTGrN9vFYhrDsdp9w/132","nickname":"Geek_9dbcb4","note":"","ucode":"BB92D5E844A743","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":230987,"discussion_content":"å…¶ä»–ç« èŠ‚é‡Œï¼Œæœ‰æåˆ°phys_footprintï¼Œä»£è¡¨å®é™…ä½¿ç”¨çš„ç‰©ç†å†…å­˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586783933,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86501,"user_name":"Jaker","can_delete":false,"product_type":"c1","uid":1460817,"ip_address":"","ucode":"61FCEDE3B94F49","user_header":"https://static001.geekbang.org/account/avatar/00/16/4a/51/02678317.jpg","comment_is_top":false,"comment_ctime":1555384496,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10145319088","product_id":100024501,"comment_content":"æ¥ä¸Šé¢çš„é—®é¢˜ï¼Œé—®ä¸€ä¸‹è€å¸ˆï¼Œtask_vm_info_data_tçš„phys_footprint æ‰“å°è¾“å‡ºçš„å†…å­˜å€¼å’Œxcodeçš„æ˜¾ç¤ºå†…å­˜è¿˜æ˜¯ä¸ä¸€è‡´å•Šï¼Œè¿™æ˜¯æ€ä¹ˆå›äº‹ï¼Œæœ›è§£æƒ‘ï¼Œè°¢è°¢ã€‚","like_count":2},{"had_liked":false,"id":85437,"user_name":"drunkenMouse","can_delete":false,"product_type":"c1","uid":1454037,"ip_address":"","ucode":"AA8CEA703ECBE8","user_header":"","comment_is_top":false,"comment_ctime":1555060099,"is_pvip":false,"replies":[{"id":"30671","content":"åœ¨ä½ è®¾ç½®ç›¸åŒä¼˜å…ˆçº§çš„çº¿ç¨‹ä¸­ï¼Œç³»ç»Ÿä¼šæœ‰æ›´ç»†çš„ä¼˜å…ˆçº§ç­–ç•¥ï¼Œè¿™ä¸ªç­–ç•¥å°±æ˜¯å“ªä¸ªçº¿ç¨‹ CPU å ç”¨é«˜ï¼Œä¼˜å…ˆçº§ä¼šæ¯”é™ä½","user_name":"ä½œè€…å›å¤","user_name_real":"æˆ´é“­","uid":"1140280","ctime":1555123482,"ip_address":"","comment_id":85437,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10144994691","product_id":100024501,"comment_content":"çº¿ç¨‹ä½¿ç”¨ä¼˜å…ˆçº§æ—¶ï¼ŒCPU å ç”¨å¤šçš„çº¿ç¨‹çš„ä¼˜å…ˆçº§ä¼šè¢«é™ä½ã€‚è¿™å¥è¯æ€ä¹ˆè¯»ä¸æ‡‚å‘¢ï¼Ÿ<br><br>åˆ©ç”¨didReceivedMemoryWarning è¿™ä¸ªä»£ç†æ—¶é—´ï¼Œçœ‹å¾—æˆ‘ä¸€æ„£ã€‚ã€‚åº”è¯¥æ˜¯ä»£ç†äº‹ä»¶ï¼Œæˆ‘è¿™ç®—ä¸ç®—é¸¡è›‹é‡Œé¢æŒ‘éª¨å¤´ï¼Ÿ<br><br>task_infkçš„ä½¿ç”¨éœ€è¦å¯¼å…¥&lt;mach&#47;mach.h&gt; <br><br>æœ€åä¸€æ®µæ„æ€æ˜¯ï¼Œç³»ç»Ÿé€šè¿‡malloc_loggeræ¥ç»Ÿè®¡å¹¶ç®¡ç†å†…å­˜çš„åˆ†é…æƒ…å†µï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"æˆ´é“­","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446668,"discussion_content":"åœ¨ä½ è®¾ç½®ç›¸åŒä¼˜å…ˆçº§çš„çº¿ç¨‹ä¸­ï¼Œç³»ç»Ÿä¼šæœ‰æ›´ç»†çš„ä¼˜å…ˆçº§ç­–ç•¥ï¼Œè¿™ä¸ªç­–ç•¥å°±æ˜¯å“ªä¸ªçº¿ç¨‹ CPU å ç”¨é«˜ï¼Œä¼˜å…ˆçº§ä¼šæ¯”é™ä½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555123482,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":307448,"user_name":"D","can_delete":false,"product_type":"c1","uid":2681398,"ip_address":"","ucode":"4112DE94C80A5B","user_header":"https://static001.geekbang.org/account/avatar/00/28/ea/36/7d088c63.jpg","comment_is_top":false,"comment_ctime":1629106121,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5924073417","product_id":100024501,"comment_content":"è…¾è®¯çš„OOMDetectorå°±æ˜¯å¹²è¿™ä¸ªäº‹çš„https:&#47;&#47;github.com&#47;Tencent&#47;OOMDetector","like_count":2},{"had_liked":false,"id":219955,"user_name":"will","can_delete":false,"product_type":"c1","uid":1457442,"ip_address":"","ucode":"93DC3993A50CBB","user_header":"https://static001.geekbang.org/account/avatar/00/16/3d/22/c6ff6e02.jpg","comment_is_top":false,"comment_ctime":1590125551,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5885092847","product_id":100024501,"comment_content":"ç›‘æ§å†…å­˜åˆ†é…çš„æ ¸å¿ƒï¼Œåœ¨äºä½¿ç”¨libmallocåº“çš„malloc_loggeræŒ‡é’ˆå®ç°çš„","like_count":1},{"had_liked":false,"id":186560,"user_name":"Master","can_delete":false,"product_type":"c1","uid":1454833,"ip_address":"","ucode":"642F865923C98A","user_header":"https://static001.geekbang.org/account/avatar/00/16/32/f1/54575096.jpg","comment_is_top":false,"comment_ctime":1583882674,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5878849970","product_id":100024501,"comment_content":"æœ‰ä¸ªç–‘é—®ï¼Œå°±ç®— hook äº†malloc_logger ï¼ŒçŸ¥æ™“äº†å†…å­˜åˆ†é…åœ°å€å’Œå¤§å°ï¼Œåˆå¦‚ä½•çŸ¥é“æ˜¯ä»£ç ä¸­å“ªå—æˆ–è€…å“ªä¸ªå¯¹è±¡ç”³è¯·çš„å‘¢ï¼Ÿæœ›å„ä½å¤§ä½¬ä¸åèµæ•™ï¼","like_count":2,"discussions":[{"author":{"id":2153689,"avatar":"https://static001.geekbang.org/account/avatar/00/20/dc/d9/129f569f.jpg","nickname":"forping","note":"","ucode":"7495E250F0A017","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":340091,"discussion_content":"å‡½æ•°è°ƒç”¨å †æ ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609901881,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125877,"user_name":"RichardJ","can_delete":false,"product_type":"c1","uid":1460444,"ip_address":"","ucode":"24DC2494614DC1","user_header":"","comment_is_top":false,"comment_ctime":1566267021,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5861234317","product_id":100024501,"comment_content":"å°ç»“é‡Œè¯´åˆ°è®¿é—®æœªåˆ†é…å†…å­˜ã€å‘åªè¯»å†…å­˜è¿›è¡Œå†™æ“ä½œçš„é—®é¢˜ï¼Œæˆ´è€å¸ˆå¯ä»¥ä¸¾äº›ä¾‹å­è¯´æ˜ä¸‹è¿™ä¸¤ç§æƒ…å†µæ€ä¹ˆæ’æŸ¥åŸå› å—ï¼Ÿ","like_count":1},{"had_liked":false,"id":85630,"user_name":"Calabash_Boy","can_delete":false,"product_type":"c1","uid":1453760,"ip_address":"","ucode":"19E4D819792983","user_header":"","comment_is_top":false,"comment_ctime":1555148573,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5850115869","product_id":100024501,"comment_content":"è€å¸ˆå¥½,è¯»å®Œåæœ‰å‡ ä¸ªé—®é¢˜ä¸å¾—å…¶è§£:<br>(1) åœ¨ç›¸åŒçš„è®¾å¤‡å’Œç³»ç»Ÿç‰ˆæœ¬ä¸‹,æ¯ä¸ªAppçš„å†…å­˜é™åˆ¶æ˜¯ä¸ä¸€æ ·çš„ä¹ˆ?æˆ‘æŸ¥çœ‹äº†æ‰‹æœºçš„jetsamEvent,åœ¨per-process-limitä¸­å‘ç°ä¸€ä¸ªrpagesæ˜¯196.<br>(2) åœ¨vm_pressure_monitorçº¿ç¨‹çš„æ£€æµ‹ä¸‹,å‘ç°æŸAppæœ‰äº†å†…å­˜å‹åŠ›(ç†è§£ä¸ºå³å°†è¾¾åˆ°å†…å­˜é™åˆ¶),ç„¶åä¼šç»™è¯¥Appå‘é€šçŸ¥,ç„¶åæ‚¨åˆè®²åˆ°äº†ä¼˜å…ˆçº§æœºåˆ¶,è¿™å°±æœ‰ç–‘æƒ‘äº†,å½“æŸä¸ªAppæœ‰å‹åŠ›çš„æ—¶å€™,æ˜¯å¼ºæ€è¿™ä¸ªAppå‘¢è¿˜æ˜¯æ ¹æ®ä¼˜å…ˆçº§å»å¼ºæ€åå°çš„Appå‘¢?<br>(3) åœ¨æµ‹è¯•struct mach_task_basic_info info;è¿™æ®µä»£ç çš„æ—¶å€™,ç¼–è¯‘ä¼šæŠ¥é”™Definition of &#39;mach_task_basic_info&#39; must be imported from module &#39;Darwin.Mach.task_info&#39; before it is required,æ˜¯æˆ‘æ²¡æœ‰å¯¼å…¥æŸä¸ªå¤´æ–‡ä»¶ä¹ˆ?","like_count":1,"discussions":[{"author":{"id":1409087,"avatar":"https://static001.geekbang.org/account/avatar/00/15/80/3f/bc65b009.jpg","nickname":"Yest","note":"","ucode":"1E82B6355890C0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3416,"discussion_content":"(3) #include <Mach/task_info.h>","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564470044,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":85555,"user_name":"drunkenMouse","can_delete":false,"product_type":"c1","uid":1454037,"ip_address":"","ucode":"AA8CEA703ECBE8","user_header":"","comment_is_top":false,"comment_ctime":1555124038,"is_pvip":false,"replies":[{"id":"30747","content":"æ˜¯åœ¨ didReceiveMemoryWarning å›è°ƒé‡Œå»è·å–å½“å‰ Appå†…å­˜ä½¿ç”¨å€¼","user_name":"ä½œè€…å›å¤","user_name_real":"æˆ´é“­","uid":"1140280","ctime":1555146892,"ip_address":"","comment_id":85555,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5850091334","product_id":100024501,"comment_content":"didReceivedMemory åŠ¨æ€è·å–å†…å­˜å€¼çš„æ–¹æ³•ï¼Œæ²¡æœ‰æ‰¾åˆ°å•Š å¤§ä½¬èƒ½è¯´ä¸€ä¸‹å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"æˆ´é“­","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446712,"discussion_content":"æ˜¯åœ¨ didReceiveMemoryWarning å›è°ƒé‡Œå»è·å–å½“å‰ Appå†…å­˜ä½¿ç”¨å€¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555146892,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":85008,"user_name":"æµ©","can_delete":false,"product_type":"c1","uid":1338784,"ip_address":"","ucode":"B29FFC5B489C8C","user_header":"https://static001.geekbang.org/account/avatar/00/14/6d/a0/75cdae30.jpg","comment_is_top":false,"comment_ctime":1554954919,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5849922215","product_id":100024501,"comment_content":"ä¸€ç›´ä¸çŸ¥é“å†…å­˜åˆ†é…æœ€å¤§å€¼è·å–å’Œæ€ä¹ˆè·å–å½“å‰å†…å­˜åˆ†é…ï¼Œçœ‹äº†æ–‡ç« è±ç„¶å¼€æœ—ï¼Œæƒ³é—®çš„æ˜¯ï¼Œè€å¸ˆè¿™äº›çŸ¥è¯†éƒ½æ˜¯é€šè¿‡åˆ†ææºç å¾—æ¥çš„å—ï¼Ÿ","like_count":1},{"had_liked":false,"id":292352,"user_name":"...","can_delete":false,"product_type":"c1","uid":1020427,"ip_address":"","ucode":"35C881D8AA1C5E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/0b/2ccf7908.jpg","comment_is_top":false,"comment_ctime":1620789661,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1620789661","product_id":100024501,"comment_content":"hook å†…å­˜åˆ†é…çš„æ€§èƒ½å¼€é”€åº”è¯¥å¾ˆå¤§ è¿™å—çº¿ä¸Šç¯å¢ƒæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":281827,"user_name":"å¤©ç©ºå¾ˆè“","can_delete":false,"product_type":"c1","uid":1456247,"ip_address":"","ucode":"16B88BEDA8E24F","user_header":"https://static001.geekbang.org/account/avatar/00/16/38/77/5849fbcf.jpg","comment_is_top":false,"comment_ctime":1614915794,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1614915794","product_id":100024501,"comment_content":"å‡ºç°OOMå‰ä¸€å®šä¼šå‡ºç°Memory Warningä¹ˆï¼Ÿè¿™ä¸ªåº”è¯¥æ˜¯ä¸ä¸€å®šå§å¤§ä½¬ï¼›æ—¢ç„¶ä¸ä¸€å®šçš„è¯é‚£ä¸Šé¢ä¸‰ç§æƒ…å†µå°±éƒ½ä¸èƒ½å¾ˆå¥½çš„è·å–åˆ°é‚»è¿‘OOMçš„æ—¶å€™å†…å­˜çš„åˆ†é…ä¿¡æ¯å§ï¼›è¿˜æœ‰å…¶ä»–æ›´å¥½çš„æ–¹å¼å—ï¼Ÿè¿˜æ˜¯æˆ‘ç†è§£çš„æœ‰é—®é¢˜å‘¢ï¼Ÿéº»çƒ¦çŸ¥é“çš„å¤§ä½¬è§£ç­”ä¸€ä¸‹è°¢è°¢ï¼","like_count":1,"discussions":[{"author":{"id":2681398,"avatar":"https://static001.geekbang.org/account/avatar/00/28/ea/36/7d088c63.jpg","nickname":"D","note":"","ucode":"4112DE94C80A5B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388983,"discussion_content":"ç¡®å®ä¸æ˜¯ä¸ä¸€å®šå‡ºç°Memory Warning","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629083913,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114159,"user_name":"å¤œç©ºç¹æ˜Ÿ","can_delete":false,"product_type":"c1","uid":1454291,"ip_address":"","ucode":"6DA00EDEE62FA4","user_header":"https://static001.geekbang.org/account/avatar/00/16/30/d3/b3516304.jpg","comment_is_top":false,"comment_ctime":1563244437,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563244437","product_id":100024501,"comment_content":"é™¤äº†è†œæ‹œï¼Œæ²¡åˆ«çš„ã€‚","like_count":0},{"had_liked":false,"id":107080,"user_name":"æ— å","can_delete":false,"product_type":"c1","uid":1110113,"ip_address":"","ucode":"2D2E877CF97138","user_header":"https://static001.geekbang.org/account/avatar/00/10/f0/61/68462a07.jpg","comment_is_top":false,"comment_ctime":1561455025,"is_pvip":false,"replies":[{"id":"38772","content":"æœ¬æ–‡éƒ½æ˜¯å›´ç»•è¿™ä¸ªé—®é¢˜åœ¨è¯´å‘¢ã€‚ä¼šæ ¹æ®ç³»ç»Ÿå’Œç¡¬ä»¶ä¸åŒè€Œå®š","user_name":"ä½œè€…å›å¤","user_name_real":"æˆ´é“­","uid":"1140280","ctime":1561472691,"ip_address":"","comment_id":107080,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561455025","product_id":100024501,"comment_content":"å½“ç³»ç»Ÿè¿˜å‰©å¤šå°‘å†…å­˜æ—¶ï¼Œä¼šå‘å‡ºå†…å­˜ä¸è¶³çš„é€šçŸ¥ã€‚","like_count":0,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"æˆ´é“­","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455357,"discussion_content":"æœ¬æ–‡éƒ½æ˜¯å›´ç»•è¿™ä¸ªé—®é¢˜åœ¨è¯´å‘¢ã€‚ä¼šæ ¹æ®ç³»ç»Ÿå’Œç¡¬ä»¶ä¸åŒè€Œå®š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561472691,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":106978,"user_name":"äº¡å‘½ä¹‹å¾’","can_delete":false,"product_type":"c1","uid":1096669,"ip_address":"","ucode":"5B0ADD558F9712","user_header":"https://static001.geekbang.org/account/avatar/00/10/bb/dd/5d473145.jpg","comment_is_top":false,"comment_ctime":1561430843,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561430843","product_id":100024501,"comment_content":"çº¿ä¸Šä½¿ç”¨è¿™ç§æ–¹å¼ç›‘æ§å†…å­˜ï¼Œè‹¹æœå®¡æ ¸ä¼šé€šè¿‡å˜›","like_count":0},{"had_liked":false,"id":100231,"user_name":"mersa","can_delete":false,"product_type":"c1","uid":1330156,"ip_address":"","ucode":"A9F0B2FF9457C9","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epzwbJGbUmgEC77J6QY6A5pLPdPbw7sqk4DcsHK8qPw7OiaiaMD7pjzb8uHlkY5uLZRibWVvPDDAgM5A/132","comment_is_top":false,"comment_ctime":1559488071,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559488071","product_id":100024501,"comment_content":"æ€ä¹ˆçŸ¥é“è°è°ƒç”¨äº† mallocï¼Œæ¥æŒ‡å¯¼å¯¹åº”çš„å †æ ˆä¿¡æ¯","like_count":0},{"had_liked":false,"id":89395,"user_name":"äºŒæœ¨åˆåœŸ","can_delete":false,"product_type":"c1","uid":1296963,"ip_address":"","ucode":"7D939045990B4D","user_header":"https://static001.geekbang.org/account/avatar/00/13/ca/43/63bdc516.jpg","comment_is_top":false,"comment_ctime":1556163316,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556163316","product_id":100024501,"comment_content":"JetsamEventæ–‡ä»¶ä¸­æœç´¢rpagesï¼Œä¸ºä»€ä¹ˆæœ‰å¾ˆå¤šå€¼ï¼Œä¸åŒappèƒ½ä½¿ç”¨çš„æœ€å¤§å†…å­˜å¤§å°æ˜¯ä¸ä¸€æ ·çš„ï¼Ÿ","like_count":0},{"had_liked":false,"id":85558,"user_name":"drunkenMouse","can_delete":false,"product_type":"c1","uid":1454037,"ip_address":"","ucode":"AA8CEA703ECBE8","user_header":"","comment_is_top":false,"comment_ctime":1555124337,"is_pvip":false,"replies":[{"id":"30746","content":"å¼ºæ€å‰ç³»ç»Ÿä¼šæ ¹æ®æ–‡åçš„ç­–ç•¥åˆ¤æ–­åº”è¯¥ä¼˜å…ˆå¼ºæ€è°","user_name":"ä½œè€…å›å¤","user_name_real":"æˆ´é“­","uid":"1140280","ctime":1555146794,"ip_address":"","comment_id":85558,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1555124337","product_id":100024501,"comment_content":"ç³»ç»Ÿåœ¨å¼ºæ€Appå‰ï¼Œä¼šå…ˆåšä¼˜å…ˆçº§åˆ¤æ–­ã€‚æ„æ€æ˜¯ï¼šå¦‚æœä¼˜å…ˆçº§é«˜çš„è¯ï¼Œæœ¬æ¥ä¼šå¼ºæ€çš„ä¹Ÿä¸å¼ºæ€äº†ï¼Œè€Œå»å¼ºæ€é‚£äº›æ²¡æœ‰è¾¾åˆ°limitçš„è¿›ç¨‹ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"æˆ´é“­","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446714,"discussion_content":"å¼ºæ€å‰ç³»ç»Ÿä¼šæ ¹æ®æ–‡åçš„ç­–ç•¥åˆ¤æ–­åº”è¯¥ä¼˜å…ˆå¼ºæ€è°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555146794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":85352,"user_name":"Hy","can_delete":false,"product_type":"c1","uid":1239531,"ip_address":"","ucode":"BF6AC9AA9B26A7","user_header":"https://static001.geekbang.org/account/avatar/00/12/e9/eb/2394e520.jpg","comment_is_top":false,"comment_ctime":1555042123,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555042123","product_id":100024501,"comment_content":"ğŸ‘Œ","like_count":0},{"had_liked":false,"id":85017,"user_name":"mÎ±najay","can_delete":false,"product_type":"c1","uid":1067450,"ip_address":"","ucode":"6DE9FBD1BEC8AD","user_header":"https://static001.geekbang.org/account/avatar/00/10/49/ba/23c9246a.jpg","comment_is_top":false,"comment_ctime":1554956945,"is_pvip":false,"replies":[{"id":"30717","content":"OOM æ˜¯å†…å­˜è¶…æ ‡è¢«ç³»ç»Ÿå¼ºæ€æ—¶","user_name":"ä½œè€…å›å¤","user_name_real":"æˆ´é“­","uid":"1140280","ctime":1555139256,"ip_address":"","comment_id":85017,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554956945","product_id":100024501,"comment_content":"hook malloc_logger aopæ”¶é›†æ—¥å¿—ï¼Œç„¶ååœ¨OOMé‚£6ç§’å†…æ”¶é›†æ‰€æœ‰å†…å­˜åˆ†é…ä¿¡æ¯ï¼Œç„¶ååœ¨å†æ¬¡å¯åŠ¨åº”ç”¨æ—¶ ä¸ŠæŠ¥è¿™ä¸¤éƒ¨åˆ†æ—¥å¿—å—ï¼Ÿ <br>oomé‚£ä¸€åˆ»æ˜¯æŒ‡çš„å“ªä¸ªæ—¶æœºï¼Œæ¥å—å†…å­˜è­¦å‘Šï¼Ÿ didReceiveMemoryWarning ä¸­åˆ¤æ–­ æ˜¯å¦é è¿‘ limitå— ","like_count":0,"discussions":[{"author":{"id":1140280,"avatar":"https://static001.geekbang.org/account/avatar/00/11/66/38/f9999b2b.jpg","nickname":"æˆ´é“­","note":"","ucode":"D61E685F962387","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446531,"discussion_content":"OOM æ˜¯å†…å­˜è¶…æ ‡è¢«ç³»ç»Ÿå¼ºæ€æ—¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555139256,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}