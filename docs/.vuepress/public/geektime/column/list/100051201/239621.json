{"id":239621,"title":"12 | å¦‚ä½•è°ƒæ•´TCPæ‹¥å¡æ§åˆ¶çš„æ€§èƒ½ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é™¶è¾‰ã€‚</p><p>ä¸Šä¸€è®²æˆ‘ä»¬è°ˆåˆ°æ¥æ”¶ä¸»æœºçš„å¤„ç†èƒ½åŠ›ä¸è¶³æ—¶ï¼Œæ˜¯é€šè¿‡æ»‘åŠ¨çª—å£æ¥å‡ç¼“å¯¹æ–¹çš„å‘é€é€Ÿåº¦ã€‚è¿™ä¸€è®²æˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œå½“ç½‘ç»œå¤„ç†èƒ½åŠ›ä¸è¶³æ—¶åˆè¯¥å¦‚ä½•ä¼˜åŒ–TCPçš„æ€§èƒ½ã€‚</p><p>å¦‚æœä½ é˜…è¯»è¿‡TCPåè®®ç›¸å…³çš„ä¹¦ç±ï¼Œä¸€å®šçœ‹åˆ°è¿‡æ…¢å¯åŠ¨ã€æ‹¥å¡æ§åˆ¶ç­‰åè¯ã€‚è¿™äº›æ¦‚å¿µä¼¼ä¹ç¦»åº”ç”¨å¼€å‘è€…å¾ˆè¿œï¼Œç„¶è€Œï¼Œå¦‚æœæ²¡æœ‰æ‹¥å¡æ§åˆ¶ï¼Œæ•´ä¸ªç½‘ç»œå°†ä¼šé”æ­»ï¼Œæ‰€æœ‰æ¶ˆæ¯éƒ½æ— æ³•ä¼ è¾“ã€‚</p><p>è€Œä¸”ï¼Œå¦‚æœä½ åœ¨å¼€å‘åˆ†å¸ƒå¼é›†ç¾¤ä¸­çš„é«˜å¹¶å‘æœåŠ¡ï¼Œç†è§£æ‹¥å¡æ§åˆ¶çš„å·¥ä½œåŸç†ï¼Œå°±å¯ä»¥åœ¨å†…æ ¸çš„TCPå±‚ï¼Œæå‡æ‰€æœ‰è¿›ç¨‹çš„ç½‘ç»œæ€§èƒ½ã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½å¬è¿‡ï¼Œ2013å¹´è°·æ­ŒæŠŠåˆå§‹æ‹¥å¡çª—å£ä»3ä¸ªMSSï¼ˆæœ€å¤§æŠ¥æ–‡é•¿åº¦ï¼‰å·¦å³æå‡åˆ°10ä¸ªMSSï¼Œå°†Webç«™ç‚¹çš„ç½‘ç»œæ€§èƒ½æå‡äº†10%ä»¥ä¸Šï¼Œè€Œæœ‰äº›é«˜é€ŸCDNç«™ç‚¹ï¼Œç”šè‡³æŠŠåˆå§‹æ‹¥å¡çª—å£æå‡åˆ°70ä¸ªMSSã€‚</p><p>ç‰¹åˆ«æ˜¯ï¼Œè¿‘å¹´æ¥è°·æ­Œæå‡ºçš„BBRæ‹¥å¡æ§åˆ¶ç®—æ³•å·²ç»åº”ç”¨åœ¨é«˜ç‰ˆæœ¬çš„Linuxå†…æ ¸ä¸­ï¼Œä»å®ƒåœ¨YouTubeä¸Šçš„åº”ç”¨å¯ä»¥çœ‹åˆ°ï¼Œåœ¨é«˜æ€§èƒ½ç«™ç‚¹ä¸Šç½‘ç»œæ—¶å»¶æœ‰20%ä»¥ä¸Šçš„é™ä½ï¼Œä¼ è¾“å¸¦å®½ä¹Ÿæœ‰æé«˜ã€‚</p><p>Linuxå…è®¸æˆ‘ä»¬è°ƒæ•´æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼Œä½†æ˜¯ï¼Œæ­£ç¡®åœ°è®¾ç½®å‚æ•°ï¼Œè¿˜éœ€è¦æ·±å…¥ç†è§£æ‹¥å¡æ§åˆ¶å¯¹TCPè¿æ¥çš„å½±å“ã€‚è¿™ä¸€è®²æˆ‘ä»¬å°†æ²¿ç€ç½‘ç»œå¦‚ä½•å½±å“å‘é€é€Ÿåº¦è¿™æ¡çº¿ï¼Œçœ‹çœ‹å¦‚ä½•è°ƒæ•´Linuxä¸‹çš„æ‹¥å¡æ§åˆ¶å‚æ•°ã€‚</p><h2>æ…¢å¯åŠ¨é˜¶æ®µå¦‚ä½•è°ƒæ•´åˆå§‹æ‹¥å¡çª—å£ï¼Ÿ</h2><!-- [[[read_end]]] --><p>ä¸Šä¸€è®²è°ˆåˆ°ï¼Œåªè¦æ¥æ”¶æ–¹çš„è¯»ç¼“å†²åŒºè¶³å¤Ÿå¤§ï¼Œå°±å¯ä»¥é€šè¿‡æŠ¥æ–‡ä¸­çš„æ¥æ”¶çª—å£ï¼Œè¦æ±‚å¯¹æ–¹æ›´å¿«åœ°å‘é€æ•°æ®ã€‚ç„¶è€Œï¼Œç½‘ç»œçš„ä¼ è¾“é€Ÿåº¦æ˜¯æœ‰é™çš„ï¼Œå®ƒä¼šç›´æ¥ä¸¢å¼ƒè¶…è¿‡å…¶å¤„ç†èƒ½åŠ›çš„æŠ¥æ–‡ã€‚è€Œå‘é€æ–¹åªæœ‰åœ¨é‡ä¼ å®šæ—¶å™¨è¶…æ—¶åï¼Œæ‰èƒ½å‘ç°è¶…å‘çš„æŠ¥æ–‡è¢«ç½‘ç»œä¸¢å¼ƒäº†ï¼Œå‘é€é€Ÿåº¦æä¸ä¸Šå»ã€‚æ›´ä¸ºç³Ÿç³•çš„æ˜¯ï¼Œå¦‚æœç½‘ç»œä¸­çš„æ¯ä¸ªè¿æ¥éƒ½æŒ‰ç…§æ¥æ”¶çª—å£å°½å¯èƒ½åœ°å‘é€æ›´å¤šçš„æŠ¥æ–‡æ—¶ï¼Œå°±ä¼šå½¢æˆæ¶æ€§å¾ªç¯ï¼Œæœ€ç»ˆè¶…é«˜çš„ç½‘ç»œä¸¢åŒ…ç‡ä¼šä½¿å¾—æ¯ä¸ªè¿æ¥éƒ½æ— æ³•å‘é€æ•°æ®ã€‚</p><p>è§£å†³è¿™ä¸€é—®é¢˜çš„æ–¹æ¡ˆå«åšæ‹¥å¡æ§åˆ¶ï¼Œå®ƒåŒ…æ‹¬4ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬é¦–å…ˆæ¥çœ‹TCPè¿æ¥åˆšå»ºç«‹æ—¶çš„æ…¢å¯åŠ¨é˜¶æ®µã€‚ç”±äºTCPè¿æ¥ä¼šç©¿è¶Šè®¸å¤šç½‘ç»œï¼Œæ‰€ä»¥æœ€åˆå¹¶ä¸çŸ¥é“ç½‘ç»œçš„ä¼ è¾“èƒ½åŠ›ï¼Œä¸ºäº†é¿å…å‘é€è¶…è¿‡ç½‘ç»œè´Ÿè½½çš„æŠ¥æ–‡ï¼ŒTCPåªèƒ½å…ˆè°ƒä½å‘é€çª—å£ï¼ˆå…³äºå‘é€çª—å£ï¼Œä½ å¯ä»¥å‚è€ƒ<a href=\"https://time.geekbang.org/column/article/239176\">[ç¬¬11è®²]</a>ï¼‰ï¼Œå‡å°‘é£è¡Œä¸­çš„æŠ¥æ–‡æ¥è®©å‘é€é€Ÿåº¦å˜æ…¢ï¼Œè¿™ä¹Ÿæ˜¯â€œæ…¢å¯åŠ¨â€åå­—çš„ç”±æ¥ã€‚</p><p>è®©å‘é€é€Ÿåº¦å˜æ…¢æ˜¯é€šè¿‡å¼•å…¥æ‹¥å¡çª—å£ï¼ˆå…¨ç§°ä¸ºcongestion windowï¼Œç¼©å†™ä¸ºCWndï¼Œç±»ä¼¼åœ°ï¼Œæ¥æ”¶çª—å£å«åšrwndï¼Œå‘é€çª—å£å«åšswndï¼‰å®ç°çš„ï¼Œå®ƒç”¨äºé¿å…ç½‘ç»œå‡ºç°æ‹¥å¡ã€‚ä¸Šä¸€è®²æˆ‘ä»¬è¯´è¿‡ï¼Œå¦‚æœä¸è€ƒè™‘ç½‘ç»œæ‹¥å¡ï¼Œå‘é€çª—å£å°±ç­‰äºå¯¹æ–¹çš„æ¥æ”¶çª—å£ï¼Œè€Œè€ƒè™‘äº†ç½‘ç»œæ‹¥å¡åï¼Œå‘é€çª—å£åˆ™åº”å½“æ˜¯æ‹¥å¡çª—å£ä¸å¯¹æ–¹æ¥æ”¶çª—å£çš„æœ€å°å€¼ï¼š</p><pre><code>swnd = min(cwnd, rwnd)\n</code></pre><p>è¿™æ ·ï¼Œå‘é€é€Ÿåº¦å°±ç»¼åˆè€ƒè™‘äº†æ¥æ”¶æ–¹å’Œç½‘ç»œçš„å¤„ç†èƒ½åŠ›ã€‚</p><p>è™½ç„¶çª—å£çš„è®¡é‡å•ä½æ˜¯å­—èŠ‚ï¼Œä½†ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œé€šå¸¸æˆ‘ä»¬ç”¨MSSä½œä¸ºæè¿°çª—å£å¤§å°çš„å•ä½ï¼Œå…¶ä¸­MSSæ˜¯TCPæŠ¥æ–‡çš„æœ€å¤§é•¿åº¦ã€‚</p><p>å¦‚æœåˆå§‹æ‹¥å¡çª—å£åªæœ‰1ä¸ªMSSï¼Œå½“MSSæ˜¯1KBï¼Œè€ŒRTTæ—¶å»¶æ˜¯100msæ—¶ï¼Œå‘é€é€Ÿåº¦åªæœ‰10KB/sã€‚æ‰€ä»¥ï¼Œå½“æ²¡æœ‰å‘ç”Ÿæ‹¥å¡æ—¶ï¼Œæ‹¥å¡çª—å£å¿…é¡»å¿«é€Ÿæ‰©å¤§ï¼Œæ‰èƒ½æé«˜äº’è”ç½‘çš„ä¼ è¾“é€Ÿåº¦ã€‚å› æ­¤ï¼Œæ…¢å¯åŠ¨é˜¶æ®µä¼šä»¥æŒ‡æ•°çº§æ‰©å¤§æ‹¥å¡çª—å£ï¼ˆæ‰©å¤§è§„åˆ™æ˜¯è¿™æ ·çš„ï¼šå‘é€æ–¹æ¯æ”¶åˆ°ä¸€ä¸ªACKç¡®è®¤æŠ¥æ–‡ï¼Œæ‹¥å¡çª—å£å°±å¢åŠ 1ä¸ªMSSï¼‰ï¼Œæ¯”å¦‚æœ€åˆçš„åˆå§‹æ‹¥å¡çª—å£ï¼ˆä¹Ÿç§°ä¸ºinitcwndï¼‰æ˜¯1ä¸ªMSSï¼Œç»è¿‡4ä¸ªRTTå°±ä¼šå˜æˆ16ä¸ªMSSã€‚</p><p>è™½ç„¶æŒ‡æ•°çº§æå‡å‘é€é€Ÿåº¦å¾ˆå¿«ï¼Œä½†äº’è”ç½‘ä¸­çš„å¾ˆå¤šèµ„æºä½“ç§¯å¹¶ä¸å¤§ï¼Œå¤šæ•°åœºæ™¯ä¸‹ï¼Œåœ¨ä¼ è¾“é€Ÿåº¦æ²¡æœ‰è¾¾åˆ°æœ€å¤§æ—¶ï¼Œèµ„æºå°±å·²ç»ä¸‹è½½å®Œäº†ã€‚ä¸‹å›¾æ˜¯2010å¹´Googleå¯¹Webå¯¹è±¡å¤§å°çš„CDFç´¯ç§¯åˆ†å¸ƒç»Ÿè®¡ï¼Œå¤§å¤šæ•°å¯¹è±¡åœ¨10KBå·¦å³ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/1a/23/1a93f6622d30ef5a138b37ce7f94e323.png?wh=1368*644\" alt=\"\" title=\"å›¾ç‰‡æ¥æºï¼šã€ŠAn Argument for Increasing TCP's Initial Contestion Windowã€‹\"></p><p>è¿™æ ·ï¼Œå½“MSSæ˜¯1KBæ—¶ï¼Œå¤šæ•°HTTPè¯·æ±‚è‡³å°‘åŒ…å«10ä¸ªæŠ¥æ–‡ï¼Œå³ä½¿ä»¥æŒ‡æ•°çº§å¢åŠ æ‹¥å¡çª—å£ï¼Œä¹Ÿéœ€è¦è‡³å°‘4ä¸ªRTTæ‰èƒ½ä¼ è¾“å®Œï¼Œå‚è§ä¸‹å›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/86/5c/865b14ad43c828fdf494b541bb810f5c.png?wh=865*779\" alt=\"\"></p><p>å› æ­¤ï¼Œ2013å¹´TCPçš„åˆå§‹æ‹¥å¡çª—å£è°ƒæ•´åˆ°äº†10ä¸ªMSSï¼ˆå‚è§<a href=\"https://tools.ietf.org/html/rfc6928\">RFC6928</a>ï¼‰ï¼Œè¿™æ ·1ä¸ªRTTå†…å°±å¯ä»¥ä¼ è¾“10KBçš„è¯·æ±‚ã€‚ç„¶è€Œï¼Œå¦‚æœä½ éœ€è¦ä¼ è¾“çš„å¯¹è±¡ä½“ç§¯æ›´å¤§ï¼ŒBDPå¸¦å®½æ—¶å»¶ç§¯å¾ˆå¤§æ—¶ï¼Œå®Œå…¨å¯ä»¥ç»§ç»­æé«˜åˆå§‹æ‹¥å¡çª—å£çš„å¤§å°ã€‚ä¸‹å›¾æ˜¯2014å¹´ã€2017å¹´å…¨çƒä¸»è¦CDNå‚å•†åˆå§‹æ‹¥å¡çª—å£çš„å˜åŒ–ï¼Œå¯è§ï¼Œéšç€ç½‘é€Ÿçš„å¢åŠ ï¼Œåˆå§‹æ‹¥å¡çª—å£ä¹Ÿå˜å¾—æ›´å¤§äº†ã€‚</p><p><a href=\"https://blog.imaginea.com/look-at-tcp-initcwnd-cdns/\"><img src=\"https://static001.geekbang.org/resource/image/20/d2/20bdd4477ed2d837d398a3b43020abd2.png?wh=1027*733\" alt=\"\" title=\"å›¾ç‰‡æ¥æºï¼šhttps://blog.imaginea.com/look-at-tcp-initcwnd-cdns/\"></a></p><p>å› æ­¤ï¼Œä½ å¯ä»¥æ ¹æ®ç½‘ç»œçŠ¶å†µå’Œä¼ è¾“å¯¹è±¡çš„å¤§å°ï¼Œè°ƒæ•´åˆå§‹æ‹¥å¡çª—å£çš„å¤§å°ã€‚è°ƒæ•´å‰ï¼Œå…ˆè¦æ¸…æ¥šä½ çš„æœåŠ¡å™¨ç°åœ¨çš„åˆå§‹æ‹¥å¡çª—å£æ˜¯å¤šå¤§ã€‚ä½ å¯ä»¥é€šè¿‡sså‘½ä»¤æŸ¥çœ‹å½“å‰æ‹¥å¡çª—å£ï¼š</p><pre><code># ss -nli|fgrep cwnd\n         cubic rto:1000 mss:536 cwnd:10 segs_in:10621866 lastsnd:1716864402 lastrcv:1716864402 lastack:1716864402\n</code></pre><p>å†é€šè¿‡ip route changeå‘½ä»¤ä¿®æ”¹åˆå§‹æ‹¥å¡çª—å£ï¼š</p><pre><code># ip route | while read r; do\n           ip route change $r initcwnd 10;\n       done\n</code></pre><p>å½“ç„¶ï¼Œæ›´å¤§çš„åˆå§‹æ‹¥å¡çª—å£ä»¥åŠæŒ‡æ•°çº§çš„æé€Ÿï¼Œè¿æ¥å¾ˆå¿«å°±ä¼šé­é‡ç½‘ç»œæ‹¥å¡ï¼Œä»è€Œå¯¼è‡´æ…¢å¯åŠ¨é˜¶æ®µçš„ç»“æŸã€‚</p><h2>å‡ºç°ç½‘ç»œæ‹¥å¡æ—¶è¯¥æ€ä¹ˆåŠï¼Ÿ</h2><p>ä»¥ä¸‹3ç§åœºæ™¯éƒ½ä¼šå¯¼è‡´æ…¢å¯åŠ¨é˜¶æ®µç»“æŸï¼š</p><ol>\n<li>é€šè¿‡å®šæ—¶å™¨æ˜ç¡®æ¢æµ‹åˆ°äº†ä¸¢åŒ…ï¼›</li>\n<li>æ‹¥å¡çª—å£çš„å¢é•¿åˆ°è¾¾äº†æ…¢å¯åŠ¨é˜ˆå€¼ssthreshï¼ˆå…¨ç§°ä¸ºslow start thresholdï¼‰ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰å‘ç°ç½‘ç»œæ‹¥å¡æ—¶çš„çª—å£å¤§å°ï¼›</li>\n<li>æ¥æ”¶åˆ°é‡å¤çš„ACKæŠ¥æ–‡ï¼Œå¯èƒ½å­˜åœ¨ä¸¢åŒ…ã€‚</li>\n</ol><p>æˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬1ç§åœºæ™¯ï¼Œåœ¨è§„å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°ACKæŠ¥æ–‡ï¼Œè¿™è¯´æ˜æŠ¥æ–‡ä¸¢å¤±äº†ï¼Œç½‘ç»œå‡ºç°äº†ä¸¥é‡çš„æ‹¥å¡ï¼Œå¿…é¡»å…ˆé™ä½å‘é€é€Ÿåº¦ï¼Œå†è¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µã€‚ä¸åŒçš„æ‹¥å¡æ§åˆ¶ç®—æ³•é™ä½é€Ÿåº¦çš„å¹…åº¦å¹¶ä¸ç›¸åŒï¼Œæ¯”å¦‚CUBICç®—æ³•ä¼šæŠŠæ‹¥å¡çª—å£é™ä¸ºåŸå…ˆçš„0.8å€ï¼ˆä¹Ÿå°±æ˜¯å‘é€é€Ÿåº¦é™åˆ°0.8å€ï¼‰ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬çŸ¥é“äº†å¤šå¤§çš„çª—å£ä¼šå¯¼è‡´æ‹¥å¡ï¼Œå› æ­¤å¯ä»¥æŠŠæ…¢å¯åŠ¨é˜ˆå€¼è®¾ä¸ºå‘ç”Ÿæ‹¥å¡å‰çš„çª—å£å¤§å°ã€‚</p><p>å†çœ‹ç¬¬2ç§åœºæ™¯ï¼Œè™½ç„¶è¿˜æ²¡æœ‰å‘ç”Ÿä¸¢åŒ…ï¼Œä½†å‘é€æ–¹å·²ç»è¾¾åˆ°äº†æ›¾ç»å‘ç”Ÿç½‘ç»œæ‹¥å¡çš„é€Ÿåº¦ï¼ˆæ‹¥å¡çª—å£è¾¾åˆ°äº†æ…¢å¯åŠ¨é˜ˆå€¼ï¼‰ï¼Œæ¥ä¸‹æ¥å‘ç”Ÿæ‹¥å¡çš„æ¦‚ç‡å¾ˆé«˜ï¼Œæ‰€ä»¥è¿›å…¥<strong>æ‹¥å¡é¿å…é˜¶æ®µï¼Œæ­¤æ—¶æ‹¥å¡çª—å£ä¸èƒ½å†ä»¥æŒ‡æ•°æ–¹å¼å¢é•¿ï¼Œè€Œæ˜¯è¦ä»¥çº¿æ€§æ–¹å¼å¢é•¿</strong>ã€‚æ¥ä¸‹æ¥ï¼Œæ‹¥å¡çª—å£ä¼šä»¥æ¯ä¸ªRTTå¢åŠ 1ä¸ªMSSçš„æ–¹å¼ï¼Œä»£æ›¿æ…¢å¯åŠ¨é˜¶æ®µæ¯æ”¶åˆ°1ä¸ªACKå°±å¢åŠ 1ä¸ªMSSçš„æ–¹å¼ã€‚è¿™é‡Œå¯èƒ½æœ‰åŒå­¦ä¼šæœ‰ç–‘é—®ï¼Œåœ¨ç¬¬1ç§åœºæ™¯å‘ç”Ÿå‰ï¼Œæ…¢å¯åŠ¨é˜ˆå€¼æ˜¯å¤šå¤§å‘¢ï¼Ÿäº‹å®ä¸Šï¼Œ<a href=\"https://tools.ietf.org/html/rfc5681#page-5\">RFC5681</a> å»ºè®®æœ€åˆçš„æ…¢å¯åŠ¨é˜ˆå€¼å°½å¯èƒ½çš„å¤§ï¼Œè¿™æ ·æ‰èƒ½åœ¨ç¬¬1ã€3ç§åœºæ™¯é‡Œå¿«é€Ÿå‘ç°ç½‘ç»œç“¶é¢ˆã€‚</p><p>ç¬¬3ç§åœºæ™¯æœ€ä¸ºå¤æ‚ã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒTCPä¼ è¾“çš„æ˜¯å­—èŠ‚æµï¼Œè€Œâ€œæµâ€æ˜¯å¤©ç„¶æœ‰åºçš„ã€‚å› æ­¤ï¼Œå½“æ¥æ”¶æ–¹æ”¶åˆ°ä¸è¿ç»­çš„æŠ¥æ–‡æ—¶ï¼Œå°±å¯èƒ½å‘ç”ŸæŠ¥æ–‡ä¸¢å¤±æˆ–è€…å»¶è¿Ÿï¼Œç­‰å¾…å‘é€æ–¹è¶…æ—¶é‡å‘å¤ªèŠ±æ—¶é—´äº†ï¼Œä¸ºäº†ç¼©çŸ­é‡å‘æ—¶é—´ï¼Œ<strong>å¿«é€Ÿé‡ä¼ ç®—æ³•ä¾¿åº”è¿è€Œç”Ÿã€‚</strong></p><p>å½“è¿ç»­æ”¶åˆ°3ä¸ªé‡å¤ACKæ—¶ï¼Œå‘é€æ–¹ä¾¿å¾—åˆ°äº†ç½‘ç»œå‘ç”Ÿæ‹¥å¡çš„æ˜ç¡®ä¿¡å·ï¼Œé€šè¿‡é‡å¤ACKæŠ¥æ–‡çš„åºå·ï¼Œæˆ‘ä»¬çŸ¥é“ä¸¢å¤±äº†å“ªä¸ªæŠ¥æ–‡ï¼Œè¿™æ ·ï¼Œä¸ç­‰å¾…å®šæ—¶å™¨çš„è§¦å‘ï¼Œç«‹åˆ»é‡å‘ä¸¢å¤±çš„æŠ¥æ–‡ï¼Œå¯ä»¥è®©å‘é€é€Ÿåº¦ä¸‹é™å¾—æ…¢ä¸€äº›ï¼Œè¿™å°±æ˜¯å¿«é€Ÿé‡ä¼ ç®—æ³•ã€‚</p><p>å‡ºç°æ‹¥å¡åï¼Œå‘é€æ–¹ä¼šç¼©å°æ‹¥å¡çª—å£ï¼Œå†è¿›å…¥å‰é¢æåˆ°çš„æ‹¥å¡é¿å…é˜¶æ®µï¼Œç”¨çº¿æ€§é€Ÿåº¦æ…¢æ…¢å¢åŠ æ‹¥å¡çª—å£ã€‚ç„¶è€Œï¼Œ<strong>ä¸ºäº†å¹³æ»‘åœ°é™ä½é€Ÿåº¦ï¼Œå‘é€æ–¹åº”å½“å…ˆè¿›å…¥å¿«é€Ÿæ¢å¤é˜¶æ®µï¼Œåœ¨å¤±åºæŠ¥æ–‡åˆ°è¾¾æ¥æ”¶æ–¹åï¼Œå†è¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µã€‚</strong></p><p>é‚£ä»€ä¹ˆæ˜¯å¿«é€Ÿæ¢å¤å‘¢ï¼Ÿæˆ‘ä»¬ä¸å¦¨æŠŠç½‘ç»œçœ‹æˆä¸€ä¸ªå®¹å™¨ï¼ˆä¸Šä¸€è®²ä¸­è¯´è¿‡å®ƒå¯ä»¥å®¹çº³BDPå­—èŠ‚çš„æŠ¥æ–‡ï¼‰ï¼Œæ¯å½“æ¥æ”¶æ–¹ä»ç½‘ç»œä¸­å–å‡ºä¸€ä¸ªæŠ¥æ–‡ï¼Œå‘é€æ–¹å°±å¯ä»¥å¢åŠ ä¸€ä¸ªæŠ¥æ–‡ã€‚å½“å‘é€æ–¹æ¥æ”¶åˆ°é‡å¤ACKæ—¶ï¼Œå¯ä»¥æ¨æ–­æœ‰å¤±åºæŠ¥æ–‡ç¦»å¼€äº†ç½‘ç»œï¼Œåˆ°è¾¾äº†æ¥æ”¶æ–¹çš„ç¼“å†²åŒºï¼Œå› æ­¤å¯ä»¥å†å¤šå‘é€ä¸€ä¸ªæŠ¥æ–‡ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/92/d9/92980476c93766887cc260f03c5d50d9.png?wh=992*795\" alt=\"\"></p><p>è¿™é‡Œä½ è¦æ³¨æ„ï¼šç¬¬6ä¸ªæŠ¥æ–‡åœ¨æ…¢å¯åŠ¨é˜¶æ®µä¸¢å¤±ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°å¤±åºçš„ç¬¬7ä¸ªæŠ¥æ–‡ä¼šè§¦å‘å¿«é€Ÿé‡ä¼ ç®—æ³•ï¼Œå®ƒå¿…é¡»ç«‹åˆ»è¿”å›ACK6ã€‚è€Œå‘é€æ–¹æ¥æ”¶åˆ°ç¬¬1ä¸ªé‡å¤ACK6æŠ¥æ–‡æ—¶ï¼Œå°±ä»æ…¢å¯åŠ¨è¿›å…¥äº†å¿«é€Ÿé‡ä¼ é˜¶æ®µï¼Œ<strong>æ­¤åˆ»çš„é‡å¤ACKä¸ä¼šæ‰©å¤§æ‹¥å¡çª—å£ã€‚</strong>å½“è¿ç»­æ”¶åˆ°3ä¸ªACK6æ—¶ï¼Œå‘é€æ–¹ä¼šé‡å‘æŠ¥æ–‡6ï¼Œå¹¶æŠŠæ…¢å¯åŠ¨é˜ˆå€¼å’Œæ‹¥å¡çª—å£éƒ½é™åˆ°ä¹‹å‰çš„ä¸€åŠï¼š3ä¸ªMSSï¼Œå†è¿›å…¥å¿«é€Ÿæ¢å¤é˜¶æ®µã€‚æŒ‰ç…§è§„åˆ™ï¼Œç”±äºæ”¶åˆ°3ä¸ªé‡å¤ACKï¼Œæ‰€ä»¥æ‹¥å¡çª—å£ä¼šå¢åŠ 3ä¸ªMSSã€‚ä¹‹åæ”¶åˆ°çš„2ä¸ªACKï¼Œè®©æ‹¥å¡çª—å£å¢åŠ åˆ°äº†8ä¸ªMSSï¼Œç›´åˆ°æ”¶åˆ°æœŸå¾…çš„ACK12ï¼Œå‘é€æ–¹æ‰ä¼šè¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µã€‚</p><p>æ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ã€å¿«é€Ÿé‡ä¼ ã€å¿«é€Ÿæ¢å¤ï¼Œå…±åŒæ„æˆäº†æ‹¥å¡æ§åˆ¶ç®—æ³•ã€‚Linuxä¸Šæä¾›äº†æ›´æ”¹æ‹¥å¡æ§åˆ¶ç®—æ³•çš„é…ç½®ï¼Œä½ å¯ä»¥é€šè¿‡tcp_available_congestion_controlé…ç½®æŸ¥çœ‹å†…æ ¸æ”¯æŒçš„ç®—æ³•åˆ—è¡¨ï¼š</p><pre><code>net.ipv4.tcp_available_congestion_control = cubic reno\n</code></pre><p>å†é€šè¿‡tcp_congestion_controlé…ç½®é€‰æ‹©ä¸€ä¸ªå…·ä½“çš„æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼š</p><pre><code>net.ipv4.tcp_congestion_control = cubic\n</code></pre><p>ä½†æœ‰ä»¶äº‹ä½ å¾—æ¸…æ¥šï¼Œæ‹¥å¡æ§åˆ¶æ˜¯æ§åˆ¶ç½‘ç»œæµé‡çš„ç®—æ³•ï¼Œä¸»æœºé—´ä¼šäº’ç›¸å½±å“ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒæ›´æ”¹ä¹‹å‰å¿…é¡»ç»è¿‡å®Œå–„çš„æµ‹è¯•ã€‚</p><h2>åŸºäºæµ‹é‡çš„æ‹¥å¡æ§åˆ¶ç®—æ³•</h2><p>ä¸Šæ–‡ä»‹ç»çš„æ˜¯ä¼ ç»Ÿæ‹¥å¡æ§åˆ¶ç®—æ³•ï¼Œå®ƒæ˜¯ä»¥ä¸¢åŒ…ä½œä¸ºåˆ¤æ–­æ‹¥å¡çš„ä¾æ®ã€‚ç„¶è€Œï¼Œç½‘ç»œåˆšå‡ºç°æ‹¥å¡æ—¶å¹¶ä¸ä¼šä¸¢åŒ…ï¼Œè€ŒçœŸçš„å‡ºç°ä¸¢åŒ…æ—¶ï¼Œæ‹¥å¡å·²ç»éå¸¸ä¸¥é‡äº†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåƒè·¯ç”±å™¨è¿™æ ·çš„ç½‘ç»œè®¾å¤‡ï¼Œéƒ½ä¼šæœ‰ç¼“å†²é˜Ÿåˆ—åº”å¯¹çªå‘çš„ã€è¶…è¶Šå¤„ç†èƒ½åŠ›çš„æµé‡ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/47/85/4732f8f97aefcb26334f4e7d1d096185.png?wh=957*532\" alt=\"\"></p><p>å½“ç¼“å†²é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œä¼ è¾“é€Ÿåº¦æœ€å¿«ã€‚ä¸€æ—¦é˜Ÿåˆ—å¼€å§‹ç§¯å‹ï¼Œæ¯ä¸ªæŠ¥æ–‡çš„ä¼ è¾“æ—¶é—´éœ€è¦å¢åŠ æ’é˜Ÿæ—¶é—´ï¼Œç½‘é€Ÿå°±å˜æ…¢äº†ã€‚è€Œå½“é˜Ÿåˆ—æº¢å‡ºæ—¶ï¼Œæ‰ä¼šå‡ºç°ä¸¢åŒ…ï¼ŒåŸºäºä¸¢åŒ…çš„æ‹¥å¡æ§åˆ¶ç®—æ³•åœ¨è¿™ä¸ªæ—¶é—´ç‚¹è¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µï¼Œæ˜¾ç„¶å¤ªæ™šäº†ã€‚å› ä¸ºå‡é«˜çš„ç½‘ç»œæ—¶å»¶é™ä½äº†ç”¨æˆ·ä½“éªŒï¼Œè€Œä¸”ä»ä¸¢åŒ…åˆ°é‡å‘è¿™æ®µæ—¶é—´ï¼Œå¸¦å®½ä¹Ÿä¼šå‡ºç°ä¸‹é™ã€‚</p><p>è¿›è¡Œæ‹¥å¡æ§åˆ¶çš„æœ€ä½³æ—¶é—´ç‚¹ï¼Œæ˜¯ç¼“å†²é˜Ÿåˆ—åˆšå‡ºç°ç§¯å‹çš„æ—¶åˆ»ï¼Œ<strong>æ­¤æ—¶ï¼Œç½‘ç»œæ—¶å»¶ä¼šå¢é«˜ï¼Œä½†å¸¦å®½ç»´æŒä¸å˜ï¼Œè¿™ä¸¤ä¸ªæ•°å€¼çš„å˜åŒ–å¯ä»¥ç»™å‡ºæ˜ç¡®çš„æ‹¥å¡ä¿¡å·</strong>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/2c/ca/2cbda9079294ed5da6617f0f0e83acca.png?wh=521*720\" alt=\"\" title=\"å›¾ç‰‡æ¥æºç½‘ç»œï¼šä¼ è¾“é€Ÿåº¦_RTTä¸é£è¡ŒæŠ¥æ–‡çš„å…³ç³»\"></p><p>è¿™ç§ä»¥æµ‹é‡å¸¦å®½ã€æ—¶å»¶æ¥ç¡®å®šæ‹¥å¡çš„æ–¹æ³•ï¼Œåœ¨ä¸¢åŒ…ç‡è¾ƒé«˜çš„ç½‘ç»œä¸­åº”ç”¨æ•ˆæœå°¤å…¶å¥½ã€‚2016å¹´Googleæ¨å‡ºçš„BBRç®—æ³•ï¼ˆå…¨ç§°Bottleneck Bandwidth and Round-trip propagation timeï¼‰ï¼Œå°±æ˜¯æµ‹é‡é©±åŠ¨çš„æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼Œå®ƒåœ¨YouTubeç«™ç‚¹ä¸Šåº”ç”¨åä½¿å¾—ç½‘ç»œæ—¶å»¶ä¸‹é™äº†20%ä»¥ä¸Šï¼Œä¼ è¾“å¸¦å®½ä¹Ÿæœ‰5%å·¦å³çš„æå‡ã€‚</p><p>å½“ç„¶ï¼Œæµ‹é‡é©±åŠ¨çš„æ‹¥å¡ç®—æ³•å¹¶æ²¡æœ‰é‚£ä¹ˆç®€å•ï¼Œå› ä¸ºç½‘ç»œä¼šæ³¢åŠ¨ï¼Œçº¿è·¯ä¹Ÿä¼šå˜åŒ–ï¼Œç®—æ³•å¿…é¡»åŠæ—¶åœ°å“åº”ç½‘ç»œå˜åŒ–ï¼Œè¿™é‡Œä¸å†å±•å¼€ç®—æ³•ç»†èŠ‚ï¼Œä½ å¯ä»¥åœ¨æˆ‘çš„<a href=\"https://www.taohui.pub/2019/08/07/%e4%b8%80%e6%96%87%e8%a7%a3%e9%87%8a%e6%b8%85%e6%a5%9agoogle-bbr%e6%8b%a5%e5%a1%9e%e6%8e%a7%e5%88%b6%e7%ae%97%e6%b3%95%e5%8e%9f%e7%90%86/\">è¿™ç¯‡åšå®¢</a>ä¸­æ‰¾åˆ°BBRç®—æ³•æ›´è¯¦ç»†çš„ä»‹ç»ã€‚</p><p>Linux 4.9ç‰ˆæœ¬ä¹‹åéƒ½æ”¯æŒBBRç®—æ³•ï¼Œå¼€å¯BBRç®—æ³•ä»ç„¶ä½¿ç”¨tcp_congestion_controlé…ç½®ï¼š</p><pre><code>net.ipv4.tcp_congestion_control=bbr\n</code></pre><h2>å°ç»“</h2><p>æˆ‘ä»¬å¯¹è¿™ä¸€è®²çš„å†…å®¹åšä¸ªå°ç»“ã€‚</p><p>å½“TCPè¿æ¥å»ºç«‹æˆåŠŸåï¼Œæ‹¥å¡æ§åˆ¶ç®—æ³•å°±ä¼šå‘ç”Ÿä½œç”¨ï¼Œé¦–å…ˆè¿›å…¥æ…¢å¯åŠ¨é˜¶æ®µã€‚å†³å®šè¿æ¥æ­¤æ—¶ç½‘é€Ÿçš„æ˜¯åˆå§‹æ‹¥å¡çª—å£ï¼ŒLinuxä¸Šå¯ä»¥é€šè¿‡route ip changeå‘½ä»¤ä¿®æ”¹å®ƒã€‚é€šå¸¸ï¼Œåœ¨å¸¦å®½æ—¶å»¶ç§¯è¾ƒå¤§çš„ç½‘ç»œä¸­ï¼Œåº”å½“è°ƒé«˜åˆå§‹æ‹¥å¡çª—å£ã€‚</p><p>ä¸¢åŒ…ä»¥åŠé‡å¤çš„ACKéƒ½æ˜¯æ˜ç¡®çš„æ‹¥å¡ä¿¡å·ï¼Œæ­¤æ—¶ï¼Œå‘é€æ–¹å°±ä¼šè°ƒä½æ‹¥å¡çª—å£å‡é€Ÿï¼ŒåŒæ—¶ä¿®æ­£æ…¢å¯åŠ¨é˜ˆå€¼ã€‚è¿™æ ·ï¼Œå°†æ¥å†æ¬¡åˆ°è¾¾è¿™ä¸ªé€Ÿåº¦æ—¶ï¼Œå°±ä¼šè‡ªåŠ¨è¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µï¼Œç”¨çº¿æ€§é€Ÿåº¦ä»£æ›¿æ…¢å¯åŠ¨é˜¶æ®µçš„æŒ‡æ•°é€Ÿåº¦æå‡çª—å£å¤§å°ã€‚</p><p>å½“ç„¶ï¼Œé‡å¤ACKæ„å‘³ç€å‘é€æ–¹å¯ä»¥æå‰é‡å‘ä¸¢å¤±æŠ¥æ–‡ï¼Œå¿«é€Ÿé‡ä¼ ç®—æ³•å®šä¹‰äº†è¿™ä¸€è¡Œä¸ºã€‚åŒæ—¶ï¼Œä¸ºäº†ä½¿å¾—é‡å‘æŠ¥æ–‡çš„è¿‡ç¨‹ä¸­ï¼Œå‘é€é€Ÿåº¦ä¸è‡³äºå‡ºç°æ–­å´–å¼ä¸‹é™ï¼ŒTCPåˆå®šä¹‰äº†å¿«é€Ÿæ¢å¤ç®—æ³•ï¼Œå‘é€æ–¹åœ¨æŠ¥æ–‡é‡æ–°å˜å¾—æœ‰åºåï¼Œç»“æŸå¿«é€Ÿæ¢å¤è¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µã€‚</p><p>ä½†ä»¥ä¸¢åŒ…ä½œä¸ºç½‘ç»œæ‹¥å¡çš„ä¿¡å·å¾€å¾€ä¸ºæ—¶å·²æ™šï¼Œäºæ˜¯ä»¥BBRç®—æ³•ä¸ºä»£è¡¨çš„æµ‹é‡å‹æ‹¥å¡æ§åˆ¶ç®—æ³•åº”è¿è€Œç”Ÿã€‚å½“é£è¡Œä¸­æŠ¥æ–‡æ•°é‡ä¸å˜ï¼Œè€Œç½‘ç»œæ—¶å»¶å‡é«˜æ—¶ï¼Œå°±è¯´æ˜ç½‘ç»œä¸­çš„ç¼“å†²é˜Ÿåˆ—å‡ºç°äº†ç§¯å‹ï¼Œè¿™æ˜¯è¿›è¡Œæ‹¥å¡æ§åˆ¶çš„æœ€å¥½æ—¶æœºã€‚Linuxé«˜ç‰ˆæœ¬æ”¯æŒBBRç®—æ³•ï¼Œä½ å¯ä»¥é€šè¿‡tcp_congestion_controlé…ç½®æ›´æ”¹æ‹¥å¡æ§åˆ¶ç®—æ³•ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ€åï¼Œè¯·ä½ æ€è€ƒä¸‹ï¼Œå¿«é€Ÿæ¢å¤é˜¶æ®µçš„æ‹¥å¡çª—å£ï¼Œåœ¨æŠ¥æ–‡å˜å¾—æœ‰åºååè€Œä¼šç¼©å°ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºä¸å¤§å®¶ä¸€èµ·æ¢è®¨ã€‚</p><p>æ„Ÿè°¢é˜…è¯»ï¼Œå¦‚æœä½ è§‰å¾—è¿™èŠ‚è¯¾å¯¹ä½ æœ‰ä¸€äº›å¯å‘ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚</p>","neighbors":{"left":{"article_title":"11 | å¦‚ä½•ä¿®æ”¹TCPç¼“å†²åŒºæ‰èƒ½å…¼é¡¾å¹¶å‘æ•°é‡ä¸ä¼ è¾“é€Ÿåº¦ï¼Ÿ","id":239176},"right":{"article_title":"13 | å®æˆ˜ï¼šå•æœºå¦‚ä½•å®ç°ç®¡ç†ç™¾ä¸‡ä¸»æœºçš„å¿ƒè·³æœåŠ¡ï¼Ÿ","id":240656}},"comments":[{"had_liked":false,"id":221409,"user_name":"å¿†æ°´å¯’","can_delete":false,"product_type":"c1","uid":1147453,"ip_address":"","ucode":"E3F86BD8AA8903","user_header":"https://static001.geekbang.org/account/avatar/00/11/82/3d/356fc3d6.jpg","comment_is_top":false,"comment_ctime":1590494908,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"74604938940","product_id":100051201,"comment_content":"1ã€å…³äºè¯¾åæ€è€ƒé¢˜ï¼Œå¿«é€Ÿæ¢å¤é˜¶æ®µçš„æ‹¥å¡çª—å£ï¼Œåœ¨æŠ¥æ–‡å˜å¾—æœ‰åºååè€Œä¼šç¼©å°ï¼Ÿ<br>æˆ‘æƒ³åŸå› å¯èƒ½æ˜¯ TCPè§‰å¾—æ­¤æ—¶ç½‘ç»œè½»åº¦æ‹¥å¡ï¼Œç„¶åæ‹¥å¡é˜ˆå€¼ssthreshé™ä½ä¸ºcwnd çš„ä¸€åŠï¼Œå¹¶è®¾ç½®cwndä¸ºssthreshï¼Œç„¶åæ‹¥å¡çª—å£å†çº¿æ€§å¢é•¿ã€‚<br><br>2ã€æœ¬æ–‡çš„ä¸€äº›æ€è€ƒä¸æ€»ç»“<br>é¦–å…ˆç”±äºæ…¢å¯åŠ¨æ‹¥å¡çª—å£è‚¯å®šä¸èƒ½æ— æ­¢å¢ƒçš„æŒ‡æ•°çº§å¢é•¿ä¸‹å»ï¼Œå¦åˆ™æ‹¥å¡æ§åˆ¶å°±ä¼šå¤±æ§ã€‚<br>è¿™ä¸ªæ—¶å€™ï¼Œssthresh å°±æ˜¯ä¸€é“åˆ¹è½¦ï¼Œè®©æ‹¥å¡çª—å£åˆ«æ¶¨é‚£ä¹ˆå¿«ã€‚<br>  å½“ cwnd&lt;ssthresh æ—¶ï¼Œæ‹¥å¡çª—å£æŒ‰æŒ‡æ•°çº§å¢é•¿ï¼ˆæ…¢å¯åŠ¨ï¼‰<br>  å½“ cwnd&gt;ssthresh æ—¶ï¼Œæ‹¥å¡çª—å£æŒ‰çº¿æ€§å¢é•¿ï¼ˆæ‹¥å¡é¿å…ï¼‰<br><br>  æ‹¥å¡æ§åˆ¶çš„å‡ ç§ç®—æ³•ï¼š<br>æ…¢å¯åŠ¨ï¼šæ‹¥å¡çª—å£ä¸€å¼€å§‹æ˜¯ä¸€ä¸ªå¾ˆå°çš„å€¼ï¼Œç„¶åæ¯ RTT æ—¶é—´ç¿»å€<br>æ‹¥å¡é¿å…ï¼šå½“æ‹¥å¡çª—å£è¾¾åˆ°æ‹¥å¡é˜ˆå€¼ï¼ˆssthreshï¼‰æ—¶ï¼Œæ‹¥å¡çª—å£ä»æŒ‡æ•°å¢é•¿å˜ä¸ºçº¿æ€§å¢é•¿ã€‚<br>å¿«é€Ÿé‡ä¼ ï¼šå‘é€ç«¯æ¥æ”¶åˆ° 3 ä¸ªé‡å¤ ACK æ—¶ç«‹å³è¿›è¡Œé‡ä¼ ã€‚<br>å¿«é€Ÿæ¢å¤ï¼šå½“æ”¶åˆ°ä¸‰æ¬¡é‡å¤ ACK æ—¶ï¼Œè¿›å…¥å¿«é€Ÿæ¢å¤é˜¶æ®µï¼Œæ­¤æ—¶æ‹¥å¡é˜ˆå€¼é™ä¸ºä¹‹å‰çš„ä¸€åŠï¼Œç„¶åè¿›å…¥çº¿æ€§å¢é•¿é˜¶æ®µã€‚","like_count":18,"discussions":[{"author":{"id":1169147,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d6/fb/837af7bf.jpg","nickname":"è‘£æ°¸åˆš","note":"","ucode":"ADA792B226A6CD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368005,"discussion_content":"åˆ°å¤„éƒ½æœ‰  å¿†æ°´å¯’ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618536855,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1147453,"avatar":"https://static001.geekbang.org/account/avatar/00/11/82/3d/356fc3d6.jpg","nickname":"å¿†æ°´å¯’","note":"","ucode":"E3F86BD8AA8903","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1169147,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d6/fb/837af7bf.jpg","nickname":"è‘£æ°¸åˆš","note":"","ucode":"ADA792B226A6CD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368015,"discussion_content":"è§ç¬‘äº†ï¼Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618540950,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":368005,"ip_address":""},"score":368015,"extra":""}]},{"author":{"id":1336475,"avatar":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","nickname":"J.Smile","note":"","ucode":"C4D98DFDBF7584","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":287816,"discussion_content":"ç¬”è®°ä¸é”™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593564333,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":221159,"user_name":"å¦¥å","can_delete":false,"product_type":"c1","uid":1249656,"ip_address":"","ucode":"7201DFE9C12669","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/78/4f0cd172.jpg","comment_is_top":false,"comment_ctime":1590418868,"is_pvip":false,"replies":[{"id":"81568","content":"ä½ å¥½å¦¥åï¼ŒTCPæ˜¯æœ‰åºçš„å­—ç¬¦æµï¼Œå› æ­¤æ¥æ”¶æ–¹æ”¶å®ŒæŠ¥æ–‡5åï¼Œåªèƒ½æ¥æ”¶æŠ¥æ–‡6ï¼Œä½†ç°åœ¨å´æ¥æ”¶åˆ°äº†æŠ¥æ–‡7ã€8ã€9ã€10ï¼Œæ­¤æ—¶æ¥æ”¶æ–¹è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ<br>å½“ç„¶ï¼Œå®ƒå¯ä»¥å½“åšä¸çŸ¥é“ï¼Œä»€ä¹ˆä¹Ÿä¸åšï¼Œåç­‰æŠ¥æ–‡6çš„åˆ°æ¥ã€‚æŠ¥æ–‡6ä»€ä¹ˆæ—¶å€™ä¼šåˆ°å‘¢ï¼ŸRTOæ—¶é—´è¶…æ—¶åï¼Œå‘é€æ–¹ä¼šé‡å‘æŠ¥æ–‡6ï¼Œå› ä¸ºå‘é€æ–¹ä¸€ç›´æ²¡æ”¶åˆ°ACK7ï¼<br>ä½†æ˜¯ï¼ŒRTOæ˜¯å¾ˆé•¿çš„æ—¶é—´ï¼Œæ¥æ”¶æ–¹ç›´æ¥åå¤çš„ä¼ é€’ACK6ï¼Œè¿™æ ·å‘é€æ–¹å°±èƒ½æ˜ç™½ï¼ŒæŠ¥æ–‡6ä¸¢äº†ï¼Œä»–å¯ä»¥æå‰é‡å‘æŠ¥æ–‡6. è¿™å«åšå¿«é€Ÿé‡ä¼ ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1590452646,"ip_address":"","comment_id":221159,"utype":1}],"discussion_count":5,"race_medal":0,"score":"48835059124","product_id":100051201,"comment_content":"ä¸ºä»€ä¹ˆæŠ¥æ–‡5ä¹‹åçš„ackéƒ½æ˜¯ack6å‘€","like_count":12,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496359,"discussion_content":"ä½ å¥½å¦¥åï¼ŒTCPæ˜¯æœ‰åºçš„å­—ç¬¦æµï¼Œå› æ­¤æ¥æ”¶æ–¹æ”¶å®ŒæŠ¥æ–‡5åï¼Œåªèƒ½æ¥æ”¶æŠ¥æ–‡6ï¼Œä½†ç°åœ¨å´æ¥æ”¶åˆ°äº†æŠ¥æ–‡7ã€8ã€9ã€10ï¼Œæ­¤æ—¶æ¥æ”¶æ–¹è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ\nå½“ç„¶ï¼Œå®ƒå¯ä»¥å½“åšä¸çŸ¥é“ï¼Œä»€ä¹ˆä¹Ÿä¸åšï¼Œåç­‰æŠ¥æ–‡6çš„åˆ°æ¥ã€‚æŠ¥æ–‡6ä»€ä¹ˆæ—¶å€™ä¼šåˆ°å‘¢ï¼ŸRTOæ—¶é—´è¶…æ—¶åï¼Œå‘é€æ–¹ä¼šé‡å‘æŠ¥æ–‡6ï¼Œå› ä¸ºå‘é€æ–¹ä¸€ç›´æ²¡æ”¶åˆ°ACK7ï¼\nä½†æ˜¯ï¼ŒRTOæ˜¯å¾ˆé•¿çš„æ—¶é—´ï¼Œæ¥æ”¶æ–¹ç›´æ¥åå¤çš„ä¼ é€’ACK6ï¼Œè¿™æ ·å‘é€æ–¹å°±èƒ½æ˜ç™½ï¼ŒæŠ¥æ–‡6ä¸¢äº†ï¼Œä»–å¯ä»¥æå‰é‡å‘æŠ¥æ–‡6. è¿™å«åšå¿«é€Ÿé‡ä¼ ï¼","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1590452646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3031867,"avatar":"","nickname":"Geek_1ca1a6","note":"","ucode":"F00B9A60D32A3E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579731,"discussion_content":"TCP æ˜¯ç´¯è®¡ç¡®è®¤æœºåˆ¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657637008,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2062265,"avatar":"","nickname":"ææ–°é¾™","note":"","ucode":"72C1B0F07EE526","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308775,"discussion_content":"AKC6ä¸å°±ä»£è¡¨æ”¶åˆ°ä¹ˆï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601082346,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2249227,"avatar":"https://static001.geekbang.org/account/avatar/00/22/52/0b/50bf0f05.jpg","nickname":"æ©™å­æ©™","note":"","ucode":"CD51367A14D955","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2062265,"avatar":"","nickname":"ææ–°é¾™","note":"","ucode":"72C1B0F07EE526","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333748,"discussion_content":"ack6ä»£è¡¨ç°åœ¨å·²ç»æ¥æ”¶åˆ°äº†5, ä¸‹æ¬¡æœŸæœ›æ¥æ”¶åˆ°6","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607608443,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":308775,"ip_address":""},"score":333748,"extra":""}]},{"author":{"id":1336475,"avatar":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","nickname":"J.Smile","note":"","ucode":"C4D98DFDBF7584","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":287748,"discussion_content":"åŸæ¥å¦‚æ­¤ï¼Œå¥½é—®é¢˜ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593526862,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":235025,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1594871194,"is_pvip":false,"replies":[{"id":"90328","content":"å¾ˆå¥½çš„æ€»ç»“ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1599011424,"ip_address":"","comment_id":235025,"utype":1}],"discussion_count":3,"race_medal":0,"score":"35954609562","product_id":100051201,"comment_content":"æ€»ç»“ä¸€ï¼š<br>1 æ¥æ”¶ä¸»æœºçš„å¤„ç†èƒ½åŠ›ä¸è¶³æ—¶ï¼Œæ˜¯é€šè¿‡æ»‘åŠ¨çª—å£æ¥å‡ç¼“å¯¹æ–¹çš„å‘é€é€Ÿåº¦ã€‚<br>2 æ¥æ”¶ä¸»æœºçš„å¤„ç†èƒ½åŠ›å¾ˆå¼ºæ—¶ï¼Œä¹Ÿæ— æ³•é€šè¿‡å¢åŠ å‘é€æ–¹çš„å‘é€çª—å£æ¥æå‡å‘é€é€Ÿåº¦ï¼Œå› ä¸ºç½‘ç»œçš„ä¼ è¾“é€Ÿåº¦æ˜¯æœ‰é™çš„ï¼Œå®ƒä¼šç›´æ¥ä¸¢å¼ƒè¶…è¿‡å…¶å¤„ç†èƒ½åŠ›çš„æŠ¥æ–‡ã€‚<br>å‘é€æ–¹åªæœ‰åœ¨é‡ä¼ RTOæ—¶é—´è¶…æ—¶åæ‰ä¼šå‘ç°æŠ¥æ–‡è¢«ä¸¢å¼ƒç„¶åé‡ä¼ æŠ¥æ–‡ã€‚ è§£å†³è¿™ä¸ªé—®é¢˜åŠæ³•æ˜¯æ‹¥å¡æ§åˆ¶ã€‚<br>3 TCPæ…¢å¯åŠ¨<br>  TCPè¿æ¥ä¼ è¾“ä¸­ä¼šç©¿è¶Šå¤šå±‚ç½‘ç»œå¹¶ä¸æ¸…æ¥šç½‘ç»œä¼ è¾“èƒ½åŠ›ï¼Œæ‰€ä»¥ä¸€å¼€å§‹TCPä¼šè°ƒä½å‘é€çª—å£å¤§å°ï¼Œé¿å…å‘é€è¶…è¿‡ç½‘ç»œä¼ è¾“è´Ÿè½½å¤§å°çš„æŠ¥æ–‡ã€‚è¿™æ ·ä»¥æ¥TCPå‘é€æŠ¥æ–‡é€Ÿåº¦å°±<br>  ä¼šå˜æ…¢ï¼Œè¿™å°±æ˜¯æ…¢å¯åŠ¨ã€‚TCPè°ƒä½å‘é€çª—å£(swnd)çš„å¤§å°æ˜¯é€šè¿‡â€æ‹¥å¡çª—å£â€œ---congestion window(cwnd)å®ç°çš„ã€‚<br>4 å¦‚æœä¸è€ƒè™‘ç½‘ç»œæ‹¥å¡ï¼Œå‘é€çª—å£å°±ç­‰äºå¯¹æ–¹çš„æ¥æ”¶çª—å£ï¼Œè€Œè€ƒè™‘äº†ç½‘ç»œæ‹¥å¡åï¼Œå‘é€çª—å£åˆ™åº”å½“æ˜¯æ‹¥å¡çª—å£(cwnd)ä¸å¯¹æ–¹æ¥æ”¶çª—å£(rwnd)çš„æœ€å°å€¼.<br>swnd = min(cwnd, rwnd),å³å‘é€é€Ÿåº¦å°±ç»¼åˆè€ƒè™‘äº†æ¥æ”¶æ–¹å’Œç½‘ç»œçš„å¤„ç†èƒ½åŠ›ã€‚<br>5 é€šå¸¸ç”¨ MSS ä½œä¸ºæè¿°çª—å£å¤§å°çš„å•ä½ï¼Œå…¶ä¸­ MSS æ˜¯ TCP æŠ¥æ–‡çš„æœ€å¤§é•¿åº¦ã€‚è™½ç„¶çª—å£çš„è®¡é‡å•ä½æ˜¯å­—èŠ‚ã€‚<br>6 æ‹¥å¡çª—å£å¢é•¿åŸç†ï¼š<br>å‡å¦‚ï¼šåˆå§‹æ‹¥å¡çª—å£åªæœ‰ 1 ä¸ª MSSï¼ŒMSSä¸º1KBï¼ŒRTTæ—¶å»¶ä¸º100msã€‚å‘é€é€Ÿåº¦=1KB&#47;100ms=10KB&#47;s<br>6.1 å½“æ²¡æœ‰å‘ç”Ÿæ‹¥å¡æ—¶ï¼Œæ‹¥å¡çª—å£å¿…é¡»å¿«é€Ÿæ‰©å¤§ï¼Œæ‰èƒ½æé«˜äº’è”ç½‘çš„ä¼ è¾“é€Ÿåº¦.<br>6.2 å¯åŠ¨é˜¶æ®µä¼šä»¥æŒ‡æ•°çº§æ‰©å¤§æ‹¥å¡çª—å£,å‘é€æ–¹æ¯æ”¶åˆ°ä¸€ä¸ª ACK ç¡®è®¤æŠ¥æ–‡ï¼Œæ‹¥å¡çª—å£å°±å¢åŠ  1 å€ MSS,æ¯”å¦‚æœ€åˆçš„åˆå§‹æ‹¥å¡çª—å£ï¼ˆä¹Ÿç§°ä¸º initcwndï¼‰æ˜¯ 1 ä¸ª MSSï¼Œç»è¿‡ 4 ä¸ª RTT å°±ä¼šå˜æˆ 16 ä¸ª MSSã€‚<br>6.3 äº’è”ç½‘ä¸­çš„å¾ˆå¤šèµ„æºä½“ç§¯å¹¶ä¸å¤§ï¼Œ 2010 å¹´ Google å¯¹ Web å¯¹è±¡å¤§å°çš„ CDF ç´¯ç§¯åˆ†å¸ƒç»Ÿè®¡ï¼Œå¤§å¤šæ•°å¯¹è±¡åœ¨ 10KB å·¦å³ã€‚<br>==ã€‹å½“ MSS æ˜¯ 1KB æ—¶ï¼Œåˆ™å¤šæ•° HTTP è¯·æ±‚è‡³å°‘åŒ…å« 10 ä¸ªæŠ¥æ–‡æ‰èƒ½ä¸‹è½½å®Œä¸€ä¸ªæ–‡ä»¶ã€‚ä»¥æŒ‡æ•°çº§å¢åŠ æ‹¥å¡çª—å£ï¼Œç»è¿‡4ä¸ªRTTä¹‹åï¼Œæ‰èƒ½æ”¶åˆ°å¤§äº10ä¸ªMSSã€‚<br>6.4 2013 å¹´ TCP çš„åˆå§‹æ‹¥å¡çª—å£è°ƒæ•´åˆ°äº† 10 ä¸ª MSSï¼Œè¿™æ ·ä¸‹è½½ä¸€ä¸ª10KBçš„æ–‡ä»¶ï¼Œåªéœ€è¦ä¸€ä¸ªRTTå°±å¯ä»¥ä¼ è¾“10KBçš„è¯·æ±‚ã€‚<br>å¦‚æœä½ éœ€è¦ä¼ è¾“çš„å¯¹è±¡ä½“ç§¯æ›´å¤§ï¼ŒBDP å¸¦å®½æ—¶å»¶ç§¯å¾ˆå¤§æ—¶ï¼Œå®Œå…¨å¯ä»¥ç»§ç»­æé«˜åˆå§‹æ‹¥å¡çª—å£çš„å¤§å°<br>6.5 æ ¹æ®ç½‘ç»œçŠ¶å†µå’Œä¼ è¾“å¯¹è±¡çš„å¤§å°ï¼Œè°ƒæ•´åˆå§‹æ‹¥å¡çª—å£çš„å¤§å°<br>    â‘ ss å‘½ä»¤æŸ¥çœ‹å½“å‰æ‹¥å¡çª—å£ï¼š<br>    \tss -nli|fgrep cwnd<br>    â‘¡ip route change å‘½ä»¤ä¿®æ”¹åˆå§‹æ‹¥å¡çª—å£ï¼š<br><br>\t\t# ip route | while read r; do<br>\t\t           ip route change $r initcwnd 10;<br>\t\t       done","like_count":9,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501584,"discussion_content":"å¾ˆå¥½çš„æ€»ç»“ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599011424,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2028554,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK8HE5kCNluviaVjzPSk0YuacxXF6HFV2257c4edGGpnZSCR2e2Z7S9c89ahY6A4WsbtLMhfgeicYeA/132","nickname":"ä¸­åå°å¨ç¥","note":"","ucode":"2C4CB3D6777969","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":307247,"discussion_content":"6.2 æ¯æ¥æ”¶ä¸€ä¸ªackï¼Œçª—å£å¢åŠ 1ä¸ªmssã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1600569241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1336475,"avatar":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","nickname":"J.Smile","note":"","ucode":"C4D98DFDBF7584","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2028554,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK8HE5kCNluviaVjzPSk0YuacxXF6HFV2257c4edGGpnZSCR2e2Z7S9c89ahY6A4WsbtLMhfgeicYeA/132","nickname":"ä¸­åå°å¨ç¥","note":"","ucode":"2C4CB3D6777969","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":307250,"discussion_content":"å—¯å—¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600569321,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":307247,"ip_address":""},"score":307250,"extra":""}]}]},{"had_liked":false,"id":220953,"user_name":"å®‰æ’","can_delete":false,"product_type":"c1","uid":1260026,"ip_address":"","ucode":"F78CFA9624CAEF","user_header":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","comment_is_top":false,"comment_ctime":1590365955,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23065202435","product_id":100051201,"comment_content":"æ¯•ç«Ÿè¿˜æ˜¯å‘ç”Ÿäº†ä¸¢åŒ…æˆ–è€…å»¶è¿Ÿï¼Œæ‰€ä»¥å¿«é€Ÿæ¢å¤åé‡æ–°è¿›å»æ‹¥å¡é¿å…ã€‚","like_count":5},{"had_liked":false,"id":235026,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1594871205,"is_pvip":false,"replies":[{"id":"90327","content":"Jeff.Smileçš„æ€»ç»“éå¸¸æ£’ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1599011364,"ip_address":"","comment_id":235026,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14479773093","product_id":100051201,"comment_content":"æ€»ç»“2ï¼š<br>7 æ…¢å¯åŠ¨ç»“æŸçš„ä¸‰ä¸ªåœºæ™¯<br>â‘ æ…¢å¯åŠ¨é˜¶æ®µç»“æŸåœºæ™¯ä¸€ï¼ˆé€šè¿‡å®šæ—¶å™¨æ˜ç¡®æ¢æµ‹åˆ°äº†ä¸¢åŒ…ï¼‰ï¼š<br>å‘é€æ•°æ®åå‘é€æ–¹åœ¨timeoutæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°ackæŠ¥æ–‡ï¼Œè¯´æ˜æŠ¥æ–‡ä¸¢å¤±ï¼Œç½‘ç»œæ‹¥å¡ã€‚é™ä½å‘é€é€Ÿåº¦ï¼Œå³è°ƒå°æ‹¥å¡çª—å£å¤§å°ï¼Œcubicå¯ä»¥å°†æ‹¥å¡çª—å£é™ä½ä¸ºåŸå…ˆçš„0.8å€ã€‚åŒæ—¶è®°å¾—è®¾ç½®æ…¢å¯åŠ¨é˜ˆå€¼ä¸ºå‘ç”Ÿç½‘ç»œæ‹¥å¡ä¹‹å‰çš„æ‹¥å¡çª—å£çš„å¤§å°ã€‚<br>â‘¡æ…¢å¯åŠ¨é˜¶æ®µç»“æŸåœºæ™¯äºŒï¼ˆæ‹¥å¡çª—å£çš„å¢é•¿åˆ°è¾¾äº†æ…¢å¯åŠ¨é˜ˆå€¼ ssthreshï¼‰ï¼š<br>æ…¢å¯åŠ¨é˜¶æ®µï¼Œæ‹¥å¡çª—å£å¤§å°è¾¾åˆ°äº†æ…¢å¯åŠ¨é˜ˆå€¼ï¼Œå¾ˆå¯èƒ½å‡ºç°ç½‘ç»œæ‹¥å¡ï¼Œä¸ºäº†é¿å…æ‹¥å¡ï¼Œæ‹¥å¡çª—å£å¢é•¿é€Ÿåº¦åº”å½“æ›´åŠ ä¿å®ˆçš„ä½¿ç”¨çº¿æ€§å¢é•¿ï¼Œè€Œä¸æ˜¯å¼€å§‹çš„æŒ‡æ•°å¢é•¿ã€‚çº¿æ€§å¢é•¿æ–¹å¼æ—¶æ¯ä¸ªRTTå¢åŠ ä¸€ä¸ªMSSï¼ŒæŒ‡æ•°å¢é•¿æ–¹å¼æ—¶æ¯ä¸ªACKå¢åŠ ä¸€å€MSSã€‚<br>â‘¢æ…¢å¯åŠ¨é˜¶æ®µç»“æŸåœºæ™¯ä¸‰ï¼ˆæ¥æ”¶åˆ°é‡å¤çš„ ACK æŠ¥æ–‡ï¼Œå¯èƒ½å­˜åœ¨ä¸¢åŒ…ï¼‰ï¼š<br>\tå¦‚æœå‘é€æ–¹è¿ç»­å‘é€å¤šä¸ªæŠ¥æ–‡ï¼Œåœ¨æ…¢å¯åŠ¨é˜¶æ®µç¬¬6ä¸ªæŠ¥æ–‡ä¸¢å¤±ã€‚é‚£ä¹ˆæ¥æ”¶æ–¹å°±ä¼šæ¥ä¸‹æ¥ç›´æ¥æ”¶åˆ°å‘é€çš„ç¬¬ä¸ƒä¸ªæŠ¥æ–‡ã€‚æ¥æ”¶æ–¹æ”¶åˆ°å¤±åºçš„ç¬¬7ä¸ªæŠ¥æ–‡ä¼šè§¦å‘å¿«é€Ÿé‡ä¼ ç®—æ³•ï¼Œ<br>ç«‹åˆ»è¿”å›ACK6ã€‚ä»¥åæ”¶åˆ°çš„ç¬¬8ä¸ªã€ç¬¬9ä¸ªæŠ¥æ–‡éƒ½ä¼šè¿”å›ACK6ï¼Œæ¥æ”¶æ–¹ç›´æ¥åå¤çš„ä¼ é€’ACK6ï¼Œè¿™æ ·å‘é€æ–¹å°±èƒ½æ˜ç™½ï¼ŒæŠ¥æ–‡6ä¸¢äº†ï¼Œä»–å¯ä»¥æå‰é‡å‘æŠ¥æ–‡6. è¿™å«åšå¿«é€Ÿé‡ä¼ ï¼<br>è€Œä¸æ˜¯ç­‰å¾…å‘é€æ–¹åœ¨RTOæ—¶é—´å†…æ²¡æ”¶åˆ°æŠ¥æ–‡6çš„ACKå“åº”æ‰é‡ä¼ ï¼Œé‚£æ ·å°±å¤ªæ…¢äº†ï¼<br>åœ¨è§¦å‘å¿«é€Ÿé‡ä¼ ä¹‹åï¼Œå‘é€æ–¹ä¼šæŠŠæ…¢å¯åŠ¨é˜ˆå€¼å’Œæ‹¥å¡çª—å£éƒ½é™åˆ°ä¹‹å‰çš„ä¸€åŠï¼Œè¿›å…¥â€å¿«é€Ÿæ¢å¤é˜¶æ®µâ€œã€‚<br>æ­¤æ—¶å‘é€æ–¹çš„æ‹¥å¡çª—å£ä¼šç”±äºæ¥æ”¶åˆ°é‡å¤çš„ACK6ï¼Œè€Œå¢åŠ ç›¸åº”ä¸ªæ•°çš„MSSã€‚<br>å‘é€æ–¹æ˜ç™½äº†æŠ¥æ–‡6ä¸¢å¤±ä¹‹åï¼Œç«‹å³å‘é€æŠ¥æ–‡6ç»™æ¥æ”¶æ–¹ï¼Œæ¥æ”¶æ–¹è¿™æ¬¡æ”¶åˆ°äº†å¹¶ç»™å‡ºäº†æ­£å¸¸çš„å“åº”ã€‚<br>åç»­ä¸ä¼šå†é‡å¤ACK6çš„å“åº”äº†ã€‚ç„¶åæ‰è¿›å…¥â€æ‹¥å¡é¿å…é˜¶æ®µâ€œï¼ˆä¹Ÿå°±æ˜¯ä»æŒ‡æ•°å˜çº¿ç¨‹å¢é•¿ï¼‰ã€‚<br><br><br>8 æ‹¥å¡æ§åˆ¶ç®—æ³•<br>æ…¢å¯åŠ¨ã€æ‹¥å¡é¿å…ã€å¿«é€Ÿé‡ä¼ ã€å¿«é€Ÿæ¢å¤ï¼Œå…±åŒæ„æˆäº†æ‹¥å¡æ§åˆ¶ç®—æ³•<br>å†…æ ¸æ”¯æŒçš„æ‹¥å¡æ§åˆ¶ç®—æ³•åˆ—è¡¨ï¼š<br>net.ipv4.tcp_available_congestion_control = cubic reno<br>å†…æ ¸é€‰æ‹©çš„æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼š<br>net.ipv4.tcp_congestion_control = cubic<br>Linux 4.9 ç‰ˆæœ¬ä¹‹åéƒ½æ”¯æŒ BBR ç®—æ³•ï¼Œæ˜¯åŸºäºæµ‹é‡çš„æ‹¥å¡æ§åˆ¶ç®—æ³•ï¼Œå¼€å¯ BBR ç®—æ³•ä»ç„¶ä½¿ç”¨ tcp_congestion_control é…ç½®ï¼š<br>net.ipv4.tcp_congestion_control=bbr","like_count":3,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501585,"discussion_content":"Jeff.Smileçš„æ€»ç»“éå¸¸æ£’ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599011364,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":221032,"user_name":"åˆ†æ¸…äº‘æ·¡","can_delete":false,"product_type":"c1","uid":1269873,"ip_address":"","ucode":"7045AE6BF72D31","user_header":"https://static001.geekbang.org/account/avatar/00/13/60/71/895ee6cf.jpg","comment_is_top":false,"comment_ctime":1590386462,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10180321054","product_id":100051201,"comment_content":"bbræ¯”è¾ƒé€‚åˆé«˜rtåœºæ™¯ï¼Œå¯¹æœºæˆ¿å†…ç½‘æ€§èƒ½åè€Œæ›´å·®ï¼Œæ…ç”¨","like_count":2,"discussions":[{"author":{"id":1157201,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a8/51/46a788b1.jpg","nickname":"æˆ˜æ–—æœºäºŒè™ğŸ¯","note":"","ucode":"8AB69AD2D76784","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":279034,"discussion_content":"ä¸ºå•¥å‘¢ï¼Ÿæœ‰æµ‹è¿‡å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591276558,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":250421,"user_name":"ææ–°é¾™","can_delete":false,"product_type":"c1","uid":2062265,"ip_address":"","ucode":"72C1B0F07EE526","user_header":"","comment_is_top":false,"comment_ctime":1601082606,"is_pvip":false,"replies":[{"id":"91802","content":"ä¸ä¼šå•Š","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1601290506,"ip_address":"","comment_id":250421,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5896049902","product_id":100051201,"comment_content":"æ”¶åˆ°é‡å¤çš„ACKåï¼ŒæŠ¥æ–‡æ˜¯ä¸æ˜¯æš‚åœå‘é€äº†","like_count":1,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506202,"discussion_content":"ä¸ä¼šå•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601290506,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":235018,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1594870121,"is_pvip":false,"replies":[{"id":"90329","content":"ä¸æ˜¯å“¦ï¼Œæ¯”å¦‚cwndä¸º1æ—¶ï¼Œæ¯æ”¶åˆ°1ä¸ªACKï¼Œcwndä¸º2ï¼Œå†å‘å‡º2ä¸ªMSSï¼Œæ¥ç€æ”¶åˆ°2ä¸ªACKï¼Œcwndä¸º4ï¼Œä¾æ­¤ç±»æ¨ï¼Œ4ä¸ªRTTåä¼šå˜æˆ16ä¸ªMSSã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é™¶è¾‰","uid":"1283912","ctime":1599011786,"ip_address":"","comment_id":235018,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5889837417","product_id":100051201,"comment_content":"â€æ…¢å¯åŠ¨é˜¶æ®µä¼šä»¥æŒ‡æ•°çº§æ‰©å¤§æ‹¥å¡çª—å£ï¼ˆæ‰©å¤§è§„åˆ™æ˜¯è¿™æ ·çš„ï¼šå‘é€æ–¹æ¯æ”¶åˆ°ä¸€ä¸ª ACK ç¡®è®¤æŠ¥æ–‡ï¼Œæ‹¥å¡çª—å£å°±å¢åŠ  1 ä¸ª MSSï¼‰â€œ<br>---------------------------------<br>è€å¸ˆï¼Œè¿™ä¸€å¥æ˜¯ä¸æ˜¯æœ‰é—®é¢˜ï¼Œå‘é€æ–¹æ”¶æ‰ä¸€ä¸ªackï¼Œæ˜¯å¢åŠ 1å€çš„å§MSSï¼Œè¿™æ ·æ‰è·Ÿåé¢ä¸€è‡´ã€‚4ä¸ªRTTå°±æ˜¯4ä¸ªACKï¼Œé‚£ä¹Ÿå°±å¢åŠ äº†4ä¸ªMSSï¼Œå°±ä¸æ˜¯16äº†ã€‚ã€‚ã€‚<br>â€æ¯”å¦‚æœ€åˆçš„åˆå§‹æ‹¥å¡çª—å£ï¼ˆä¹Ÿç§°ä¸º initcwndï¼‰æ˜¯ 1 ä¸ª MSSï¼Œç»è¿‡ 4 ä¸ª RTT å°±ä¼šå˜æˆ 16 ä¸ª MSSâ€œ","like_count":1,"discussions":[{"author":{"id":1283912,"avatar":"https://static001.geekbang.org/account/avatar/00/13/97/48/550271b0.jpg","nickname":"é™¶è¾‰","note":"","ucode":"F81A9087435953","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501579,"discussion_content":"ä¸æ˜¯å“¦ï¼Œæ¯”å¦‚cwndä¸º1æ—¶ï¼Œæ¯æ”¶åˆ°1ä¸ªACKï¼Œcwndä¸º2ï¼Œå†å‘å‡º2ä¸ªMSSï¼Œæ¥ç€æ”¶åˆ°2ä¸ªACKï¼Œcwndä¸º4ï¼Œä¾æ­¤ç±»æ¨ï¼Œ4ä¸ªRTTåä¼šå˜æˆ16ä¸ªMSSã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599011786,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":224200,"user_name":"Geek_2b3614","can_delete":false,"product_type":"c1","uid":1525522,"ip_address":"","ucode":"6208AB2C5FD4C0","user_header":"https://static001.geekbang.org/account/avatar/00/17/47/12/2c47bf36.jpg","comment_is_top":false,"comment_ctime":1591316945,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5886284241","product_id":100051201,"comment_content":"æ‰©å¤§è§„åˆ™æ˜¯è¿™æ ·çš„ï¼šå‘é€æ–¹æ¯æ”¶åˆ°ä¸€ä¸ª ACK ç¡®è®¤æŠ¥æ–‡ï¼Œæ‹¥å¡çª—å£å°±å¢åŠ  1 ä¸ª MSS---&gt; è²Œä¼¼æ˜¯å¢åŠ ä¸€å€ä¸ªmssï¼Ÿ","like_count":1},{"had_liked":false,"id":221121,"user_name":"å”æœé¦–éƒ½","can_delete":false,"product_type":"c1","uid":1081233,"ip_address":"","ucode":"F72655AE0AE4CA","user_header":"https://static001.geekbang.org/account/avatar/00/10/7f/91/962eba1a.jpg","comment_is_top":false,"comment_ctime":1590410141,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5885377437","product_id":100051201,"comment_content":"æˆ‘ç†è§£ï¼šå¿«é€Ÿé‡ä¼ æ˜¯çª—å£è™½ç„¶æ˜¯8ï¼Œä½†æ˜¯åœ¨ç½‘ç»œä¸­ä¼ è¾“çš„æ•°æ®åŒ…æ•°é‡æ˜¯&lt;=4çš„ï¼Œå› ä¸ºå¦å¤–å‡ ä¸ªè¢«â€œ8ï¼Œ9ï¼Œ10ï¼Œ11â€å äº†ï¼Œæ‰€ä»¥è¿›å…¥æ‹¥å¡é¿å…é˜¶æ®µä¹‹åï¼Œç»§ç»­ä¿æŒ8å®é™…ä¸Šæ˜¯å¯èƒ½é€ æˆæ‹¥å¡ï¼Œä¸å¦‚æ¢å¤çš„å·²ç»è¢«è¯æ˜èƒ½å¤Ÿæ”¯æ’‘çš„cwndï¼Œç„¶åå†çº¿æ€§å¢é•¿ã€‚","like_count":1},{"had_liked":false,"id":221077,"user_name":"æˆ‘æ¥ä¹Ÿ","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1590399055,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5885366351","product_id":100051201,"comment_content":"ç¬¬ä¸€æ¬¡è§BBRè¿˜æ˜¯åœ¨æ­å»ºæ¢¯å­çš„è¿‡ç¨‹ä¸­.<br>é‚£æ—¶ubuntué»˜è®¤å†…æ ¸è¿˜ä¸æ”¯æŒ,éœ€è¦æ‰‹åŠ¨å¼€å¯.","like_count":1},{"had_liked":false,"id":315337,"user_name":"LoveDlei","can_delete":false,"product_type":"c1","uid":1102916,"ip_address":"","ucode":"68065848DF518B","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/44/ec084136.jpg","comment_is_top":false,"comment_ctime":1633845846,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633845846","product_id":100051201,"comment_content":"å¦‚æœåˆå§‹æ‹¥å¡çª—å£åªæœ‰ 1 ä¸ª MSSï¼Œå½“ MSS æ˜¯ 1KBï¼Œè€Œ RTT æ—¶å»¶æ˜¯ 100ms æ—¶ï¼Œå‘é€é€Ÿåº¦åªæœ‰ 10KB&#47;sã€‚æ‰€ä»¥ï¼Œå½“æ²¡æœ‰å‘ç”Ÿæ‹¥å¡æ—¶ï¼Œæ‹¥å¡çª—å£å¿…é¡»å¿«é€Ÿæ‰©å¤§ï¼Œæ‰èƒ½æé«˜äº’è”ç½‘çš„ä¼ è¾“é€Ÿåº¦ã€‚å› æ­¤ï¼Œæ…¢å¯åŠ¨é˜¶æ®µä¼šä»¥æŒ‡æ•°çº§æ‰©å¤§æ‹¥å¡çª—å£ï¼ˆæ‰©å¤§è§„åˆ™æ˜¯è¿™æ ·çš„ï¼šå‘é€æ–¹æ¯æ”¶åˆ°ä¸€ä¸ª ACK ç¡®è®¤æŠ¥æ–‡ï¼Œæ‹¥å¡çª—å£å°±å¢åŠ  1 ä¸ª MSSï¼‰ï¼Œæ¯”å¦‚æœ€åˆçš„åˆå§‹æ‹¥å¡çª—å£ï¼ˆä¹Ÿç§°ä¸º initcwndï¼‰æ˜¯ 1 ä¸ª MSSï¼Œç»è¿‡ 4 ä¸ª RTT å°±ä¼šå˜æˆ 16 ä¸ª MSSã€‚<br><br>è¿™æ®µæ²¡æœ‰æ•´æ˜ç™½ï¼Ÿ","like_count":0},{"had_liked":false,"id":235343,"user_name":"ä¸€æ­¥","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1594978276,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1594978276","product_id":100051201,"comment_content":"linux å¯ä»¥æ§åˆ¶ TCP æ‹¥å¡çª—å£ Cwnd çš„å¤§å° å’Œ æ‹¥å¡æ§åˆ¶ç®—æ³• net.ipv4.tcp_congestion_control è¿™ä¸ªæœ‰ä¸¤ä¸ªå€¼ï¼š bbr åŸºäºå¸¦å®½æ—¶å»¶çš„   cubic åŸºäºä¸¢åŒ…çš„","like_count":0}]}