{"id":364715,"title":"19 | 日志（上）：系统出现问题，如何及时发现？","content":"<p>你好，我是朱晓峰。</p><p>我们曾经开发过一个数据库应用系统，但是却突然遭遇了数据库宕机。在这种情况下，定位宕机的原因就非常关键，毕竟，知道了问题，才能确定解决方案。</p><p>这时，我们就想到了查看数据库的错误日志，因为日志中记录了数据库运行中的诊断信息，包括了错误、警告和注释等信息。从日志中，我们发现，原来某个连接中的SQL操作发生了死循环，导致内存不足，被系统强行终止了。知道了原因，处理起来也就比较轻松了，系统很快就恢复了运行。</p><p>除了发现错误，日志在数据复制、数据恢复、操作审计，以及确保数据的永久性和一致性等方面，都有着不可替代的作用，对提升你的数据库应用的开发能力至关重要。</p><p>今天，我就结合超市项目的实际案例，给你讲解一下怎么通过查看系统日志，来了解数据库中实际发生了什么，从而快速定位原因。</p><p>MySQL的日志种类非常多，包括通用查询日志、慢查询日志、错误日志、二进制日志、中继日志、重做日志和回滚日志，内容比较多，而且都很重要，所以我们来花两节课的时间学习一下。</p><p>这节课，我会先具体讲一讲通用查询日志、慢查询日志和错误日志。</p><h2>通用查询日志</h2><p><strong>通用查询日志记录了所有用户的连接开始时间和截止时间，以及发给MySQL数据库服务器的所有SQL指令</strong>。当我们的数据发生异常时，开启通用查询日志，还原操作时的具体场景，可以帮助我们准确定位问题。</p><!-- [[[read_end]]] --><p>举个小例子，在超市项目实施的过程中，我们曾遇到过这样一件事：超市经营者月底查账的时候发现，超市的1号门店在12月1日销售了5件化妆品，但是当天对应的历史库存并没有减少。化妆品的金额都比较大，库存不对的话，会在报表查询中产生巨额差异，触发到报警机制，对超市经营者的决策产生影响。超市经营者找到我们，对系统的可靠性提出质疑。</p><p>我们对系统进行了仔细检查，没有发现数据问题。可是商品确实卖出去了，当天的历史库存也确实没有消减。这个时候，我们想到了检查通用查询日志，看看当天到底发生了什么。</p><p>查看之后，我们就复原了当天的情况：12月1日下午，门店的收银台销售了5件化妆品，但是由于网络故障，流水没有及时上传到总部。12月1日晚上11:59，总部的历史库存被保存下来，但是因为没有收到门店的流水，所以没有消减库存。12月2日上午，门店的网络恢复了，流水得以上传总部，这个时候，对应化妆品的库存才被消减掉。</p><p>这样，我们就确定了故障的原因，也就是超市的网络问题，而系统本身是没有问题的。</p><p>你看，通用查询日志可以帮助我们了解操作发生的具体时间和操作的细节，对找出异常发生的原因极其关键。</p><p>下面我来具体介绍一下控制通用查询日志的系统变量。通过这些变量，你会清楚怎么控制通用查询日志的开启和关闭，以及保存日志的文件是哪个。</p><pre><code>mysql&gt; SHOW VARIABLES LIKE '%general%';\n+------------------+---------------+\n| Variable_name | Value |\n+------------------+---------------+\n| general_log | OFF | -- 通用查询日志处于关闭状态\n| general_log_file | GJTECH-PC.log | -- 通用查询日志文件的名称是GJTECH-PC.log\n+------------------+---------------+\n2 rows in set, 1 warning (0.00 sec)\n</code></pre><p>在这个查询的结果中，有2点需要我们注意一下。</p><ol>\n<li>系统变量general_log的值是OFF，表示通用查询日志处于关闭状态。在MySQL中，这个参数的默认值是关闭的。因为一旦开启记录通用查询日志，MySQL会记录所有的连接起止和相关的SQL操作，这样会消耗系统资源并且占用磁盘空间。我们可以通过手动修改变量的值，在需要的时候开启日志。</li>\n<li>通用查询日志文件的名称是GJTECH-PC.log。这样我们就知道在哪里可以查看通用查询日志的内容了。</li>\n</ol><p>下面我们来看看如何开启通用查询日志，把所有连接的起止和连接的SQL操作都记录下来。这个操作可以帮助我们追踪SQL操作故障的原因。</p><h3>开启通用查询日志</h3><p>我们可以通过设置系统变量的值，来开启通用查询日志，并且指定通用查询日志的文件夹和文件名为“H:\\mytest.log”。这个操作如下：</p><pre><code>mysql&gt; SET GLOBAL general_log = 'ON';\nQuery OK, 0 rows affected (0.00 sec)\n \nmysql&gt; SET @@global.general_log_file = 'H:\\mytest.log';\nQuery OK, 0 rows affected (0.02 sec)\n</code></pre><p>为了确认我们的设定是否已经生效，我们再来查询一下通用查询日志的状态：</p><pre><code>mysql&gt; SHOW VARIABLES LIKE '%general%';\n+------------------+--------------+\n| Variable_name | Value |\n+------------------+--------------+\n| general_log | ON | -- 通用查询日志开启\n| general_log_file | H:mytest.log |  -- 日志名称也改过了\n+------------------+--------------+\n2 rows in set, 1 warning (0.00 sec)\n</code></pre><p>结果显示，通用查询日志已经开启，文件是“H:\\mytest.log”，这就意味着我们的操作成功了。</p><h3>查看通用查询日志</h3><p>通用查询日志都是文本型数据，可以用记事本打开。下面我们就用记事本打开我电脑上的通用查询日志，实际看一看通用查询日志的内容，包括都有哪些连接，什么时候登录了数据库，都做了哪些操作等信息。</p><pre><code>2021-04-05T06:39:53.621980Z 28 Connect zhangsan@localhost on using SSL/TLS   -- 账号zhangsan从本地登录\n2021-04-05T06:39:53.622085Z 28 Connect Access denied for user 'zhangsan'@'localhost' (using password: NO)  -- 没有使用密码，连接被拒绝了\n2021-04-05T06:40:02.522303Z 29 Connect zhangsan@localhost on using SSL/TLS\n2021-04-05T06:40:02.522913Z 29 Query select @@version_comment limit 1\n2021-04-05T06:40:14.211511Z 29 Query SELECT *\nFROM demo.invcount                         -- 查询数据表demo.invcount内容\n2021-04-05T06:40:37.647625Z 29 Query UPDATE demo.invcount\nSET plquant = - 5                          -- 更新数据表demo.invcount\nWHERE itemnumber = 1\n2021-04-05T06:41:15.047067Z 29 Query SELECT *\nFROM demo.goodsmaster                      -- 查询数据表demo.goodsmaster\n</code></pre><p>在通用查询日志里面，我们可以清楚地看到，账号“zhangsan”是什么时间登录的服务器，登录之后做了什么SQL操作，针对的是哪个数据表等信息。</p><h3>删除通用查询日志</h3><p>当用户对数据库的操作比较频繁时，通用查询日志文件会不断变大。为了节省磁盘空间，我们可以移除旧的日志文件，创建新的日志文件，来对通用查询日志文件进行维护。</p><p>第一步，关闭通用查询日志：</p><pre><code>mysql&gt; SET GLOBAL general_log = 'OFF'; -- 关闭通用查询日志\nQuery OK, 0 rows affected (0.01 sec)\n \nmysql&gt; SHOW VARIABLES LIKE '%general_log%'; -- 查看通用查询日志状态\n+------------------+--------------+\n| Variable_name | Value |\n+------------------+--------------+\n| general_log | OFF |\n| general_log_file | H:mytest.log |\n+------------------+--------------+\n2 rows in set, 1 warning (0.00 sec)\n</code></pre><p>第二步，把通用查询日志文件“H:\\mytest.log”移至备份文件夹，空出磁盘H的空间。</p><p>第三步，开启通用查询日志：</p><pre><code>mysql&gt; SET GLOBAL general_log = 'ON';\nQuery OK, 0 rows affected (0.01 sec)\n \nmysql&gt; SHOW VARIABLES LIKE '%general_log%';\n+------------------+--------------+\n| Variable_name | Value |\n+------------------+--------------+\n| general_log | ON |\n| general_log_file | H:mytest.log |\n+------------------+--------------+\n2 rows in set, 1 warning (0.00 sec)\n</code></pre><p>这个时候，你会发现，MySQL已经给我们准备好了一个新的通用查询日志文件“H:\\mytest.log”，并且记录了我们第一个查询的语句：“SHOW VARIABLES LIKE '%general_log%';”。</p><p>文件内容如下：</p><pre><code>C:\\Program Files\\MySQL\\MySQL Server 8.0\\bin\\mysqld.exe, Version: 8.0.23 (MySQL Community Server - GPL). started with:\nTCP Port: 3306, Named Pipe: MySQL\nTime Id Command Argument\n2021-04-05T07:02:03.007394Z 30 Query SHOW VARIABLES LIKE '%general_log%'\n</code></pre><p>总之，开启了通用查询日志之后，如果遇到用户对数据产生质疑的情况，我们就可以通过查看通用查询日志，还原当时的场景，快速定位并解决问题。</p><h2>慢查询日志</h2><p><strong>慢查询日志用来记录执行时间超过指定时长的查询</strong>。它的主要作用是，帮助我们发现那些执行时间特别长的SQL查询，并且有针对性地进行优化，从而提高系统的整体效率。当我们的数据库服务器发生阻塞、运行变慢的时候，检查一下慢查询日志，找到那些慢查询，对解决问题很有帮助。</p><p>慢查询日志是由MySQL的配置文件进行控制的。下面我先简单介绍一下MySQL的配置文件。</p><p>在MySQL的安装目录中（C:\\ProgramData\\MySQL\\MySQL Server 8.0），我们可以找到MySQL的配置文件“my.ini”。这个文件是一个文本格式的文件，可以直接用记事本打开来阅读。</p><p>我们来看看配置文件中关于慢查询日志变量的相关设定：</p><pre><code>slow-query-log=1 -- 表示开启慢查询日志，系统将会对慢查询进行记录。\n \nslow_query_log_file=&quot;GJTECH-PC-slow.log&quot;  -- 表示慢查询日志的名称是&quot;GJTECH-PC-slow.log&quot;。这里没有指定文件夹，默认就是数据目录：&quot;C:\\ProgramData\\MySQL\\MySQL Server 8.0\\Data&quot;。\n \nlong_query_time=10  -- 表示慢查询的标准是查询执行时间超过10秒\n</code></pre><p>除了刚刚的这些变量，控制慢查询日志的还有一个系统变量：min_examined_row_limit。这个变量的意思是，查询扫描过的最少记录数。这个变量和查询执行时间，共同组成了判别一个查询是否是慢查询的条件。如果查询扫描过的记录数大于等于这个变量的值，并且查询执行时间超过long_query_time的值，那么，这个查询就被记录到慢查询日志中；反之，则不被记录到慢查询日志中。</p><p>如果要查看当前这个系统变量的值，我们就可以用下面的代码：</p><pre><code>mysql&gt; show variables like 'min%';\n+------------------------+-------+\n| Variable_name | Value |\n+------------------------+-------+\n| min_examined_row_limit | 0 |\n+------------------------+-------+\n1 row in set, 1 warning (0.00 sec)\n</code></pre><p>这个值默认是0。与long_query_time=10合在一起，表示只要查询的执行时间超过10秒钟，哪怕一个记录也没有扫描过，都要被记录到慢查询日志中。你也可以根据需要，通过修改“my.ini”文件，来修改查询时长，或者通过SET指令，用SQL语句修改“min_examined_row_limit”的值。</p><p>只是你要注意，如果修改了MySQL的配置文件“my.ini”，就需要重启服务器，这样才能使修改生效。</p><p>来看一个例子：之前我运行的一个慢查询，被记录到了慢查询日志中。这个例子记录了一个运行时间超过10秒的慢查询的发生时间、连接所属的用户、执行的时长、锁表的时长和扫描过的记录数等相关信息。</p><pre><code>C:\\Program Files\\MySQL\\MySQL Server 8.0\\bin\\mysqld.exe, Version: 8.0.23 (MySQL Community Server - GPL). started with:\nTCP Port: 3306, Named Pipe: MySQL\nTime Id Command Argument\n# Time: 2021-03-25T07:20:33.412260Z     -- 执行开始时间\n# User@Host: root[root] @ localhost [::1] Id: 13   -- 用户\n# Query_time: 10.166435 Lock_time: 0.000000 Rows_sent: 0  Rows_examined: 0                        -- 执行时长、锁表时长、检查的记录数\nuse demo;\nSET timestamp=1616656823;\n</code></pre><p>通过这个慢查询日志的记录，我们就可以发现是哪个查询消耗了大量的系统资源，是哪个连接里面的查询，具体什么时间开始的。有了这些信息，我们就可以对慢查询进行分析，决定优化的方式，避免出现同样的问题。</p><p>好了，到这里，通用查询日志和慢查询日志我就讲完了，咱们最后再来学习一种重要的日志：错误日志。</p><h2>错误日志</h2><p><strong>错误日志记录了MySQL服务器启动、停止运行的时间，以及系统启动、运行和停止过程中的诊断信息，包括错误、警告和提示</strong>等。当我们的数据库服务器发生系统故障时，错误日志是发现问题、解决故障的首选。</p><p>错误日志默认是开启的。我们可以在MySQL的配置文件“my.ini”中配置它：</p><pre><code># Error Logging.\nlog-error=&quot;GJTECH-PC.err&quot;\n</code></pre><p>这段代码指定了错误日志的文件名。如果没有指定文件夹，默认就是数据目录：“C:\\ProgramData\\MySQL\\MySQL Server 8.0\\Data”。</p><p>下面我们查看一下错误日志的内容：</p><pre><code>2021-02-28T08:07:07.228880Z 0 [System] [MY-010116] [Server] C:\\Program Files\\MySQL\\MySQL Server 8.0\\bin\\mysqld.exe (mysqld 8.0.23) starting as process 7652\n2021-02-28T08:07:07.270982Z 1 [System] [MY-013576] [InnoDB] InnoDB initialization has started.\n2021-02-28T08:07:08.116433Z 1 [System] [MY-013577] [InnoDB] InnoDB initialization has ended.\n</code></pre><p>可以看到，错误日志文件中记录了服务器启动的时间，以及存储引擎InnoDB启动和停止的时间等。</p><h2>总结</h2><p>今天这节课，我们学习了通用查询日志、慢查询日志和错误日志。</p><ul>\n<li>通用查询日志：可以记录所有连接的起始时间和终止时间，以及连接发送给数据库服务器的所有指令，对我们复原操作的实际场景、发现问题，甚至是对数据库操作的审计都有很大的帮助。</li>\n<li>慢查询日志：可以记录运行时间和检查记录数超过指定值的查询，方便我们对查询进行优化。</li>\n<li>错误日志：它记录了服务器启动、运行和停止过程中的诊断信息，方便我们了解服务器的状态，从而对服务器进行维护。</li>\n</ul><p>最后，我还是想提醒你一句，<strong>千万不要小看日志</strong>。很多看似奇怪的问题，答案往往就藏在日志里。很多情况下，只有通过查看日志才能发现问题的原因，真正解决问题。所以，一定要学会查看日志，养成检查日志的习惯。</p><h2>思考题</h2><p>请你思考一下：怎么设置开启慢查询日志，并且把慢查询日志的指定时长设置为5秒，最少扫描记录数为1？</p><p>欢迎在留言区写下你的思考和答案，我们一起交流讨论。如果你觉得今天的内容对你有所帮助，也欢迎你分享给你的朋友或同事，我们下节课见。</p>","comments":[{"had_liked":false,"id":293649,"user_name":"朱晓峰","can_delete":false,"product_type":"c1","uid":2356905,"ip_address":"","ucode":"D2F84F44329C29","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","comment_is_top":true,"comment_ctime":1621478107,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"9.2233720427712e+18","product_id":100073201,"comment_content":"你好，我是朱晓峰，下面我就来公布一下上节课思考题的答案：<br><br>上节课，我们学习了权限管理。下面是思考题的答案：<br><br>mysql&gt; CREATE ROLE &#39;accountant&#39;;<br>Query OK, 0 rows affected (0.03 sec)<br><br>mysql&gt; GRANT SELECT,UPDATE,INSERT,DELETE ON demo.settlement TO &#39;accountant&#39;;<br>Query OK, 0 rows affected (0.15 sec)<br><br>mysql&gt; GRANT SELECT ON demo.goodsmaster TO &#39;accountant&#39;;<br>Query OK, 0 rows affected (0.01 sec)<br><br>mysql&gt; GRANT SELECT ON demo.invcount TO &#39;accountant&#39;;<br>Query OK, 0 rows affected (0.01 sec)<br><br>mysql&gt; CREATE USER &#39;lisi&#39; IDENTIFIED BY &#39;lisi&#39;;<br>Query OK, 0 rows affected (0.35 sec)<br><br>mysql&gt; GRANT &#39;accountant&#39; TO &#39;lisi&#39;;<br>Query OK, 0 rows affected (0.01 sec)","like_count":1,"discussions":[{"author":{"id":1701572,"avatar":"https://static001.geekbang.org/account/avatar/00/19/f6/c4/e14686d4.jpg","nickname":"shk1230","note":"","ucode":"9E39279C23FF8F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555986,"discussion_content":"用户没生效，set global activate_all_roles_on_login = on","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647158250,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":289972,"user_name":"undefined","can_delete":false,"product_type":"c1","uid":1100750,"ip_address":"","ucode":"768098DBDBE333","user_header":"https://static001.geekbang.org/account/avatar/00/10/cb/ce/d9e00eb5.jpg","comment_is_top":false,"comment_ctime":1619287312,"is_pvip":false,"replies":[{"id":"106460","content":"对的","user_name":"作者回复","user_name_real":"朱晓峰","uid":"2356905","ctime":1621560931,"ip_address":"","comment_id":289972,"utype":1}],"discussion_count":2,"race_medal":0,"score":"31684058384","product_id":100073201,"comment_content":"general query log 目前在开发过程中用的很多，方便查看和分析系统都执行了那些 query 操作。<br>不过，它也有一定性能问题，一般并发高的生产环境中的机器也不建议开启。","like_count":8,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"朱晓峰","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519076,"discussion_content":"对的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621560931,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1701572,"avatar":"https://static001.geekbang.org/account/avatar/00/19/f6/c4/e14686d4.jpg","nickname":"shk1230","note":"","ucode":"9E39279C23FF8F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555991,"discussion_content":"思考题：\nmy.ini文件中\nslow-query-log=1\nlong_query_time=5\n\nmysql变量设置：\nset  min_examined_row_limit = 1;","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647158551,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":289489,"user_name":"giteebravo","can_delete":false,"product_type":"c1","uid":1005290,"ip_address":"","ucode":"C087E8D6B5A98B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/56/ea/32608c44.jpg","comment_is_top":false,"comment_ctime":1619052246,"is_pvip":false,"replies":[{"id":"106455","content":"对的","user_name":"作者回复","user_name_real":"朱晓峰","uid":"2356905","ctime":1621560824,"ip_address":"","comment_id":289489,"utype":1}],"discussion_count":1,"race_medal":1,"score":"5914019542","product_id":100073201,"comment_content":"<br>很多看似奇怪的问题，答案往往就藏在日志里。<br><br>本节课成功引起了我对日志的兴趣。咱一定要学会查看日志，养成定期检查日志的习惯。<br>","like_count":2,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"朱晓峰","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518930,"discussion_content":"对的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621560824,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":333995,"user_name":"SharpBB","can_delete":false,"product_type":"c1","uid":2014573,"ip_address":"","ucode":"D30C5B798B8E8C","user_header":"https://static001.geekbang.org/account/avatar/00/1e/bd/6d/7010f98e.jpg","comment_is_top":false,"comment_ctime":1644658560,"is_pvip":true,"replies":[{"id":"123494","content":"好的","user_name":"作者回复","user_name_real":"编辑","uid":"2356905","ctime":1647075562,"ip_address":"","comment_id":333995,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1644658560","product_id":100073201,"comment_content":"1.通用查询日志<br>\t查看是否开启 默认是关闭的<br>\t\tSHOW VARIABLES LIKE &#39;%general%&#39;;<br>\t设置开启并指定位置<br>\t\tSET GLOBAL general_log = &#39;ON&#39;;<br>\t\tSET @@global.general_log_file = &#39;H:\\mytest.log&#39;;<br>\t\t可以再次查看是否生效<br>\t删除通用查询日志<br>\t\t1.关闭通用查询日志<br>\t\t\tSET GLOBAL general_log = &#39;OFF&#39;;<br>\t\t2.将对应文件移出文件夹<br>\t\t3.再次开启通用查询日志<br>\t\t\tSET GLOBAL general_log = &#39;ON;<br>\t\t\t会再次生成对应的文件 可以每天用定时脚本重复上述操作 不知道有没有更好的办法。。<br>2.慢查询日志<br>\t配置文件开启<br>\t\t重启服务器才会生效<br>\t\tslow-query-log=1 #表示开启慢查询<br>slow_query_log_file=&quot;GJTECH-PC-slow.log&quot; #设置日志的位置<br>long_query_time=10  #设置超过10s的sql语句被记录<br>\t命令行开启<br>\t\tSET GLOBAL slow_query_log = 1;<br>\t\tset global long_query_time=10;<br>\t\t\t只有重新连接才会生效<br>3.错误日志<br>\t配置文件新增 log-error=&quot;GJTECH-PC.err&quot; 文件名自己定<br>\t生效需要重启服务器","like_count":1,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"朱晓峰","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555808,"discussion_content":"好的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647075562,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":333260,"user_name":"道长","can_delete":false,"product_type":"c1","uid":2330999,"ip_address":"","ucode":"15B2E9CEF84634","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/KhQRc8hIxHHyPV3Og2Fc5l8w2y7ibGwGn6odmzl3wTt6fPrNv589uHmia1rgiaZhRiaLVHv9ibhzkxFx1zo42uNIS9A/132","comment_is_top":false,"comment_ctime":1644234607,"is_pvip":false,"replies":[{"id":"123476","content":"MySQL的通用查询日志，可以帮助我们发现一些不易察觉的故障。当然这并不是唯一可以发现故障的手段。比如网络问题，如果数据无法传输，系统得不到数据，肯定会影响应用，那么应用的系统日志，也会记录问题发生的时间，内容等，可以帮助我们排查故障。","user_name":"作者回复","user_name_real":"编辑","uid":"2356905","ctime":1647074353,"ip_address":"","comment_id":333260,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1644234607","product_id":100073201,"comment_content":"老师，请教一下，在没有开启通用日志的前提下，出现你说的网络故障问题，有没有其他方法可以去排查原因呢？","like_count":1,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"朱晓峰","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555786,"discussion_content":"MySQL的通用查询日志，可以帮助我们发现一些不易察觉的故障。当然这并不是唯一可以发现故障的手段。比如网络问题，如果数据无法传输，系统得不到数据，肯定会影响应用，那么应用的系统日志，也会记录问题发生的时间，内容等，可以帮助我们排查故障。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647074353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":333258,"user_name":"道长","can_delete":false,"product_type":"c1","uid":2330999,"ip_address":"","ucode":"15B2E9CEF84634","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/KhQRc8hIxHHyPV3Og2Fc5l8w2y7ibGwGn6odmzl3wTt6fPrNv589uHmia1rgiaZhRiaLVHv9ibhzkxFx1zo42uNIS9A/132","comment_is_top":false,"comment_ctime":1644234355,"is_pvip":false,"replies":[{"id":"123477","content":"这个问题，刚才已经回复，你可以参考","user_name":"作者回复","user_name_real":"编辑","uid":"2356905","ctime":1647074412,"ip_address":"","comment_id":333258,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1644234355","product_id":100073201,"comment_content":"老师，请教一下，在没有开启通用日志的情况下，偶然出现你说的分部网络故障问题，导致数据不一致问题，","like_count":0,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"朱晓峰","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555787,"discussion_content":"这个问题，刚才已经回复，你可以参考","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647074412,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":316215,"user_name":"小pawn爷","can_delete":false,"product_type":"c1","uid":1676706,"ip_address":"","ucode":"13AB91EAE4A8BC","user_header":"https://static001.geekbang.org/account/avatar/00/19/95/a2/2f07f7a3.jpg","comment_is_top":false,"comment_ctime":1634201911,"is_pvip":false,"replies":[{"id":"116466","content":"可以通过打开通用日志，等问题再次发生后，通过查看日志中记录的操作发生的时间，来确定是不是网络延迟导致的问题","user_name":"作者回复","user_name_real":"朱晓峰","uid":"2356905","ctime":1636615592,"ip_address":"","comment_id":316215,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1634201911","product_id":100073201,"comment_content":"老师举的例子定位超市网络延迟的问题，如果默认情况下通用日志没有开启，那是怎样复现这个问题且知道是延迟的，是等到问题出现后，在执行这些语句去复现吗","like_count":0,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"朱晓峰","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528314,"discussion_content":"可以通过打开通用日志，等问题再次发生后，通过查看日志中记录的操作发生的时间，来确定是不是网络延迟导致的问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636615592,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1619597,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er6OV33jHia3U9LYlZEx2HrpsELeh3KMlqFiaKpSAaaZeBttXRAVvDXUgcufpqJ60bJWGYGNpT7752w/132","nickname":"dog_brother","note":"","ucode":"9F64D3C6D815FB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"朱晓峰","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":537694,"discussion_content":"查binlog可以定位吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639145321,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":528314,"ip_address":""},"score":537694,"extra":""}]}]},{"had_liked":false,"id":313204,"user_name":"彭彬","can_delete":false,"product_type":"c1","uid":2680555,"ip_address":"","ucode":"5AF4F4D7163DFE","user_header":"https://static001.geekbang.org/account/avatar/00/28/e6/eb/7b7c0101.jpg","comment_is_top":false,"comment_ctime":1632309725,"is_pvip":false,"replies":[{"id":"116461","content":"主要是通过从服务器读取主服务器的二进制日志实现，从服务器的中继日志也参与了这个过程。","user_name":"作者回复","user_name_real":"朱晓峰","uid":"2356905","ctime":1636614999,"ip_address":"","comment_id":313204,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1632309725","product_id":100073201,"comment_content":"老师：听说MySQL利用日志实现数据同步，请问使用的是哪一种日志？","like_count":0,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"朱晓峰","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527275,"discussion_content":"主要是通过从服务器读取主服务器的二进制日志实现，从服务器的中继日志也参与了这个过程。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636614999,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1619597,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er6OV33jHia3U9LYlZEx2HrpsELeh3KMlqFiaKpSAaaZeBttXRAVvDXUgcufpqJ60bJWGYGNpT7752w/132","nickname":"dog_brother","note":"","ucode":"9F64D3C6D815FB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537695,"discussion_content":"binlog canal","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639145585,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1748863,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/af/7f/584e1327.jpg","nickname":"岁月静好","note":"","ucode":"D86859467245DA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":412167,"discussion_content":"了解一下binlog","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636093020,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":289585,"user_name":"lesserror","can_delete":false,"product_type":"c1","uid":1351076,"ip_address":"","ucode":"25A54D1165FCF6","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","comment_is_top":false,"comment_ctime":1619090034,"is_pvip":false,"replies":[{"id":"106459","content":"是的","user_name":"作者回复","user_name_real":"朱晓峰","uid":"2356905","ctime":1621560920,"ip_address":"","comment_id":289585,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1619090034","product_id":100073201,"comment_content":"MySQL的日志类型大概可分为：通用查询日志、慢查询日志、错误日志、二进制日志、中继日志、重做日志和回滚日志。<br><br>对于任何一种日志来说，都可以准确的帮助我们定位和解决问题。所以MySQL的学习中，对于日志内容的学习是难点，但是不可获取。<br><br>binlog、redolog、undolog内容涉及比较多，MySQL45讲中很多内容涉及这些日志。","like_count":0,"discussions":[{"author":{"id":2356905,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLZKoB7sooIiaCHqcdNGI97WI3ZJLJph4mibIiat1qRvrBmkicZTEYvyT5iax1vlLFFgk2xgUibmnWvkicWA/132","nickname":"朱晓峰","note":"","ucode":"D2F84F44329C29","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518958,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621560920,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}