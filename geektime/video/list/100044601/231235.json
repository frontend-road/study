{"id":231235,"title":"47 | 缓存：为不同的场景设计合适的缓存策略","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/NET-Core\">https://gitee.com/geektime-geekbang/NET-Core</a></p>","comments":[{"had_liked":false,"id":222728,"user_name":"任高良","can_delete":false,"product_type":"c3","uid":1380555,"ip_address":"","ucode":"7C97A6902B4013","user_header":"https://static001.geekbang.org/account/avatar/00/15/10/cb/2a7ef76b.jpg","comment_is_top":false,"comment_ctime":1590899391,"is_pvip":false,"replies":[{"id":82227,"content":"写入缓存时写两份，其中一份过期时间稍微长一些，当第一份不命中时，使用第二份返回，同时设置后台更新两份缓存的值。","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1591006760,"ip_address":"","comment_id":222728,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"老师，二级缓存的实现能简单说一下吗？课程中多次点到却没有演示","like_count":3,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496895,"discussion_content":"写入缓存时写两份，其中一份过期时间稍微长一些，当第一份不命中时，使用第二份返回，同时设置后台更新两份缓存的值。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591006760,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":230239,"user_name":"墨灵","can_delete":false,"product_type":"c3","uid":1409700,"ip_address":"","ucode":"185D70CA20BEEE","user_header":"https://static001.geekbang.org/account/avatar/00/15/82/a4/a92c6eca.jpg","comment_is_top":false,"comment_ctime":1593322981,"is_pvip":false,"replies":[{"id":85999,"content":"缓存越靠前越好，能放controller就别放command，仓储是最后的选择","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1594221992,"ip_address":"","comment_id":230239,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"缓存的最佳实践是放在Repository还是放在Command？","like_count":2,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499815,"discussion_content":"缓存越靠前越好，能放controller就别放command，仓储是最后的选择","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594221992,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1409700,"avatar":"https://static001.geekbang.org/account/avatar/00/15/82/a4/a92c6eca.jpg","nickname":"墨灵","note":"","ucode":"185D70CA20BEEE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":289847,"discussion_content":"原来如此，谢谢老师答疑","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594225902,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":221174,"user_name":"Level","can_delete":false,"product_type":"c3","uid":1026779,"ip_address":"","ucode":"FD2D1EA2B39954","user_header":"https://static001.geekbang.org/account/avatar/00/0f/aa/db/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1590420809,"is_pvip":false,"replies":[{"id":82223,"content":"写入缓存时写两份，其中一份过期时间稍微长一些，当第一份不命中时，使用第二份返回，同时设置后台更新两份缓存的值。","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1591006602,"ip_address":"","comment_id":221174,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"怎么实现二级缓存？","like_count":1,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496370,"discussion_content":"写入缓存时写两份，其中一份过期时间稍微长一些，当第一份不命中时，使用第二份返回，同时设置后台更新两份缓存的值。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591006602,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2490967,"avatar":"https://static001.geekbang.org/account/avatar/00/26/02/57/81fbe97a.jpg","nickname":"李景攀","note":"","ucode":"55361B91E4EE7F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367102,"discussion_content":"假如这样，什么时候更新一级缓存？都进到二级缓存了，等二级过期不是又全部查库了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618271744,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":3838010,"avatar":"","nickname":"8000tank","note":"","ucode":"C5DC98A0EB57CE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2490967,"avatar":"https://static001.geekbang.org/account/avatar/00/26/02/57/81fbe97a.jpg","nickname":"李景攀","note":"","ucode":"55361B91E4EE7F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":644033,"discussion_content":"就是老师回答中的“同时”（命中第二份缓存后，即第二份缓存只会被命中一次）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1714907828,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":367102,"ip_address":"美国","group_id":0},"score":644033,"extra":""}]}]},{"had_liked":false,"id":215644,"user_name":"stg609","can_delete":false,"product_type":"c3","uid":1073025,"ip_address":"","ucode":"FB70A75A891BB8","user_header":"https://static001.geekbang.org/account/avatar/00/10/5f/81/1c614f4a.jpg","comment_is_top":false,"comment_ctime":1589041284,"is_pvip":false,"replies":[{"id":80590,"content":"需要自己实现Cache的逻辑和内容","user_name":"作者回复","user_name_real":"肖伟宇","uid":1756585,"ctime":1589683006,"ip_address":"","comment_id":215644,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"ResponseCache 可以使用分布式缓存吗？","like_count":0,"discussions":[{"author":{"id":1756585,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/cd/a9/791d0f5e.jpg","nickname":"老肖想当外语大佬","note":"","ucode":"F662D1BF671E92","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494506,"discussion_content":"需要自己实现Cache的逻辑和内容","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589683006,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":390254,"user_name":"8000tank","can_delete":false,"product_type":"c3","uid":3838010,"ip_address":"美国","ucode":"C5DC98A0EB57CE","user_header":"","comment_is_top":false,"comment_ctime":1714908031,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"有个问题：如果项目启用了CORS，app.UseCors 应该写在 app.UseResponseCaching 之前吧？","like_count":0},{"had_liked":false,"id":257247,"user_name":"布凡","can_delete":false,"product_type":"c3","uid":1202465,"ip_address":"","ucode":"346FCD332F8BFA","user_header":"https://static001.geekbang.org/account/avatar/00/12/59/21/d2efde18.jpg","comment_is_top":false,"comment_ctime":1603894152,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"老师，请问下ResponseCache缓存的时候，针对https:&#47;&#47;localhost:5003&#47;home&#47;getorder?query=a回车会进入到断点，然后第二次访问依然会进入断点，但是此时如果先用query=b 访问，再切换回 query=a 就不会再进入断点了，请问这是什么原因呢?是我操作的方式有问题吗？","like_count":0,"discussions":[{"author":{"id":3838010,"avatar":"","nickname":"8000tank","note":"","ucode":"C5DC98A0EB57CE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":644035,"discussion_content":"应该因为大部分浏览器都是支持RFC 7234规范的，所以不方便用它们来测试服务器端响应缓存。而Postman默认是忽略RFC 7234规范的，所以觉得应该用它来做测试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1714908141,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"美国","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":253944,"user_name":"刁建忠","can_delete":false,"product_type":"c3","uid":1496562,"ip_address":"","ucode":"EBA9FFB27F5345","user_header":"https://static001.geekbang.org/account/avatar/00/16/d5/f2/511435eb.jpg","comment_is_top":false,"comment_ctime":1602984818,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100044601,"comment_content":"缓存的更新维护是不是也应该独立成一个项目来进行呢？比如提取缓存接口，里面有增删改查的方法，每个领域模型对应一个缓存类，实现缓存接口，这样的代码组织是否合理？ 比如领域模型有几十个，那对应的缓存是不是要设计跟领域模型一一对应的类呢？还有缓存操作应该放在哪一层好些， 是不是基础设施的公共层？","like_count":0,"discussions":[{"author":{"id":3838010,"avatar":"","nickname":"8000tank","note":"","ucode":"C5DC98A0EB57CE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":644034,"discussion_content":"缓存设计应该是“切入式”（即AOP）的我理解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1714907939,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"美国","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}