{"id":601128,"title":"40ï½œé©¯æœæ³›å‹ï¼šå®šä¹‰æ³›å‹çº¦æŸ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯Tony Baiã€‚</p><p>åœ¨ä¸Šä¸€è®²ä¸­æˆ‘ä»¬å¯¹Goæ³›å‹çš„å®ç°æ–¹æ¡ˆ<strong>â€œç±»å‹å‚æ•°è¯­æ³•â€</strong>åšäº†è¾ƒä¸ºå…¨é¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬æŒæ¡äº†æ³›å‹å‡½æ•°ã€æ³›å‹ç±»å‹å’Œæ³›å‹æ–¹æ³•çš„å®šä¹‰å’Œä½¿ç”¨æ–¹æ³•ã€‚ä¸è¿‡è¿˜æœ‰ä¸€å¤„è¯­æ³•ç‚¹æˆ‘ä»¬å¹¶æ²¡æœ‰é‡ç‚¹è¯´æ˜ï¼Œå®ƒå°±æ˜¯ç”¨äºå£°æ˜ç±»å‹å‚æ•°çš„<strong>çº¦æŸ</strong>ï¼ˆconstraintï¼‰ã€‚</p><p>è™½ç„¶æ³›å‹æ˜¯å¼€å‘äººå‘˜è¡¨è¾¾â€œé€šç”¨ä»£ç â€çš„ä¸€ç§é‡è¦æ–¹å¼ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€æ‰€æœ‰æ³›å‹ä»£ç å¯¹æ‰€æœ‰ç±»å‹éƒ½é€‚ç”¨ã€‚æ›´å¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ³›å‹å‡½æ•°çš„ç±»å‹å‚æ•°ä»¥åŠæ³›å‹å‡½æ•°ä¸­çš„å®ç°ä»£ç <strong>è®¾ç½®é™åˆ¶</strong>ã€‚æ³›å‹å‡½æ•°è°ƒç”¨è€…åªèƒ½ä¼ é€’æ»¡è¶³é™åˆ¶æ¡ä»¶çš„ç±»å‹å®å‚ï¼Œæ³›å‹å‡½æ•°å†…éƒ¨ä¹Ÿåªèƒ½ä»¥ç±»å‹å‚æ•°å…è®¸çš„æ–¹å¼ä½¿ç”¨è¿™äº›ç±»å‹å®å‚å€¼ã€‚åœ¨Goæ³›å‹è¯­æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<strong>ç±»å‹å‚æ•°çº¦æŸ</strong>ï¼ˆtype parameter constraintï¼‰ï¼ˆä»¥ä¸‹ç®€ç§°<strong>çº¦æŸ</strong>ï¼‰æ¥è¡¨è¾¾è¿™ç§é™åˆ¶æ¡ä»¶ã€‚</p><p>å°±åƒä¸Šä¸€è®²æåˆ°çš„ï¼Œçº¦æŸä¹‹äºç±»å‹å‚æ•°å°±å¥½æ¯”å‡½æ•°å‚æ•°åˆ—è¡¨ä¸­çš„ç±»å‹ä¹‹äºå‚æ•°ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/d2/7a/d2cf38e3f7834967cb645b2b768ee57a.jpg?wh=781x118\" alt=\"å›¾ç‰‡\"></p><p>å‡½æ•°æ™®é€šå‚æ•°åœ¨å‡½æ•°å®ç°ä»£ç ä¸­å¯ä»¥è¡¨ç°å‡ºæ¥çš„æ€§è´¨ä¸å¯ä»¥å‚ä¸çš„è¿ç®—ç”±å‚æ•°ç±»å‹é™åˆ¶ï¼Œè€Œæ³›å‹å‡½æ•°çš„ç±»å‹å‚æ•°å°±ç”±çº¦æŸï¼ˆconstraintï¼‰æ¥é™åˆ¶ã€‚</p><p>2018å¹´8æœˆç”±ä¼Šæ©Â·æ³°å‹’å’Œç½—ä¼¯ç‰¹Â·æ ¼ç‘å²è«ä¸»å†™çš„Goæ³›å‹ç¬¬ä¸€ç‰ˆè®¾è®¡æ–¹æ¡ˆä¸­ï¼ŒGoå¼•å…¥äº†contractå…³é”®å­—æ¥å®šä¹‰æ³›å‹ç±»å‹å‚æ•°çš„çº¦æŸã€‚ä½†ç»è¿‡çº¦ä¸¤å¹´çš„Goç¤¾åŒºå…¬ç¤ºå’Œè®¨è®ºï¼Œåœ¨2020å¹´6æœˆæœ«å‘å¸ƒçš„æ³›å‹æ–°è®¾è®¡æ–¹æ¡ˆä¸­ï¼ŒGoå›¢é˜Ÿåˆæ”¾å¼ƒäº†æ–°å¼•å…¥çš„contractå…³é”®å­—ï¼Œè½¬è€Œé‡‡ç”¨å·²æœ‰çš„interfaceç±»å‹æ¥æ›¿ä»£contractå®šä¹‰çº¦æŸã€‚è¿™ä¸€æ”¹å˜å¾—åˆ°äº†Goç¤¾åŒºçš„å¤§åŠ›æ”¯æŒã€‚ä½¿ç”¨interfaceç±»å‹ä½œä¸ºçº¦æŸçš„å®šä¹‰æ–¹æ³•èƒ½å¤Ÿæœ€å¤§ç¨‹åº¦åœ°å¤ç”¨å·²æœ‰è¯­æ³•ï¼Œå¹¶æŠ‘åˆ¶è¯­è¨€å¼•å…¥æ³›å‹åçš„å¤æ‚åº¦ã€‚</p><!-- [[[read_end]]] --><p>ä½†åŸæœ‰çš„interfaceè¯­æ³•å°šä¸èƒ½æ»¡è¶³å®šä¹‰çº¦æŸçš„è¦æ±‚ã€‚æ‰€ä»¥ï¼Œåœ¨Goæ³›å‹ç‰ˆæœ¬ä¸­ï¼Œinterfaceè¯­æ³•ä¹Ÿå¾—åˆ°äº†ä¸€äº›æ‰©å±•ï¼Œä¹Ÿæ­£æ˜¯è¿™äº›æ‰©å±•ç»™é‚£äº›åˆšåˆšå…¥é—¨Goæ³›å‹çš„Goå¼€å‘è€…å¸¦å»äº†ä¸€ä¸å›°æƒ‘ï¼Œè¿™ä¹Ÿæ˜¯çº¦æŸè¢«è®¤ä¸ºæ˜¯Goæ³›å‹çš„ä¸€ä¸ªéš¾ç‚¹çš„åŸå› ã€‚</p><p>åœ¨è¿™ä¸€è®²ä¸­ï¼Œæˆ‘ä»¬å°±èšç„¦äºGoç±»å‹å‚æ•°çš„çº¦æŸï¼Œå­¦ä¹ ä¸€ä¸‹GoåŸç”Ÿå†…ç½®çš„çº¦æŸã€å¦‚ä½•å®šä¹‰è‡ªå·±çš„çº¦æŸã€æ–°å¼•å…¥çš„ç±»å‹é›†åˆæ¦‚å¿µç­‰ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹Goè¯­è¨€çš„å†…ç½®çº¦æŸï¼Œä»Goæ³›å‹ä¸­æœ€å®½æ¾çš„çº¦æŸï¼š<strong>any</strong> å¼€å§‹ã€‚</p><h3>æœ€å®½æ¾çš„çº¦æŸï¼šany</h3><p>æ— è®ºæ˜¯æ³›å‹å‡½æ•°è¿˜æ˜¯æ³›å‹ç±»å‹ï¼Œå…¶æ‰€æœ‰ç±»å‹å‚æ•°å£°æ˜ä¸­éƒ½å¿…é¡»æ˜¾å¼åŒ…å«çº¦æŸï¼Œå³ä¾¿ä½ å…è®¸ç±»å‹å½¢å‚æ¥å—æ‰€æœ‰ç±»å‹ä½œä¸ºç±»å‹å®å‚ä¼ å…¥ä¹Ÿæ˜¯ä¸€æ ·ã€‚é‚£ä¹ˆæˆ‘ä»¬å¦‚ä½•è¡¨è¾¾â€œæ‰€æœ‰ç±»å‹â€è¿™ç§çº¦æŸå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>ç©ºæ¥å£ç±»å‹</strong>ï¼ˆinterface{}ï¼‰æ¥ä½œä¸ºç±»å‹å‚æ•°çš„çº¦æŸï¼š</p><pre><code class=\"language-plain\">func Print[T interface{}](sl []T) {\n    // ... ...\n}\n\nfunc doSomething[T1 interface{}, T2 interface{}, T3 interface{}](t1 T1, t2 T2, t3 T3) {\n    // ... ...\n}\n</code></pre><p>ä¸è¿‡ä½¿ç”¨ interface{} ä½œä¸ºçº¦æŸè‡³å°‘æœ‰ä»¥ä¸‹å‡ ç‚¹â€œä¸è¶³â€ï¼š</p><ul>\n<li>å¦‚æœå­˜åœ¨å¤šä¸ªè¿™ç±»çº¦æŸæ—¶ï¼Œæ³›å‹å‡½æ•°å£°æ˜éƒ¨åˆ†ä¼šæ˜¾å¾—å¾ˆå†—é•¿ï¼Œæ¯”å¦‚ä¸Šé¢ç¤ºä¾‹ä¸­çš„doSomethingçš„å£°æ˜éƒ¨åˆ†ï¼›</li>\n<li>interface{} åŒ…å« {} è¿™æ ·çš„ç¬¦å·ï¼Œä¼šè®©æœ¬å·²ç»å¾ˆå¤æ‚çš„ç±»å‹å‚æ•°å£°æ˜éƒ¨åˆ†æ˜¾å¾—æ›´åŠ å¤æ‚ï¼›</li>\n<li>å’Œcomparableã€Sortableã€orderedè¿™æ ·çš„çº¦æŸå‘½åç›¸æ¯”ï¼Œinterface{} ä½œä¸ºçº¦æŸçš„è¡¨æ„ä¸é‚£ä¹ˆç›´æ¥ã€‚</li>\n</ul><p>ä¸ºæ­¤ï¼ŒGoå›¢é˜Ÿåœ¨Go 1.18æ³›å‹è½åœ°çš„åŒæ—¶åˆå¼•å…¥äº†ä¸€ä¸ªé¢„å®šä¹‰æ ‡è¯†ç¬¦ï¼š<strong>any</strong>ã€‚anyæœ¬è´¨ä¸Šæ˜¯ interface{} çš„ä¸€ä¸ªç±»å‹åˆ«åï¼š</p><pre><code class=\"language-plain\">// $GOROOT/src/builtin/buildin.go\n// any is an alias for interface{} and is equivalent to interface{} in all ways.\ntype any = interface{}\n</code></pre><p>è¿™æ ·ï¼Œæˆ‘ä»¬åœ¨æ³›å‹ç±»å‹å‚æ•°å£°æ˜ä¸­å°±å¯ä»¥ä½¿ç”¨anyæ›¿ä»£ interface{}ï¼Œè€Œä¸Šè¿° interface{} ä½œä¸ºç±»å‹å‚æ•°çº¦æŸçš„å‡ ç‚¹â€œä¸è¶³â€ä¹Ÿéšä¹‹è¢«æ¶ˆé™¤æ‰äº†ã€‚</p><p>anyçº¦æŸçš„ç±»å‹å‚æ•°æ„å‘³ç€å¯ä»¥æ¥å—æ‰€æœ‰ç±»å‹ä½œä¸ºç±»å‹å®å‚ã€‚åœ¨å‡½æ•°ä½“å†…ï¼Œä½¿ç”¨anyçº¦æŸçš„å½¢å‚Tå¯ä»¥ç”¨æ¥åšå¦‚ä¸‹æ“ä½œï¼š</p><ul>\n<li>å£°æ˜å˜é‡</li>\n<li>åŒç±»å‹èµ‹å€¼</li>\n<li>å°†å˜é‡ä¼ ç»™å…¶ä»–å‡½æ•°æˆ–ä»å‡½æ•°è¿”å›</li>\n<li>å–å˜é‡åœ°å€</li>\n<li>è½¬æ¢æˆ–èµ‹å€¼ç»™ interface{} ç±»å‹å˜é‡</li>\n<li>ç”¨åœ¨ç±»å‹æ–­è¨€æˆ– type switch ä¸­</li>\n<li>ä½œä¸ºå¤åˆç±»å‹ä¸­çš„å…ƒç´ ç±»å‹</li>\n<li>ä¼ é€’ç»™é¢„å®šä¹‰çš„å‡½æ•°ï¼Œæ¯”å¦‚ new</li>\n</ul><p>ä¸‹é¢æ˜¯anyçº¦æŸçš„ç±»å‹å‚æ•°æ‰§è¡Œè¿™äº›æ“ä½œçš„ä¸€ä¸ªç¤ºä¾‹ï¼š</p><pre><code class=\"language-plain\">// any.go\nfunc doSomething[T1, T2 any](t1 T1, t2 T2) T1 {\n    var a T1        // å£°æ˜å˜é‡\n    var b T2\n    a, b = t1, t2   // åŒç±»å‹èµ‹å€¼\n    _ = b\n\n    f := func(t T1) {\n    }\n    f(a)            // ä¼ ç»™å…¶ä»–å‡½æ•°\n\n    p := &amp;a         // å–å˜é‡åœ°å€\n    _ = p\n\n    var i interface{} = a  // è½¬æ¢æˆ–èµ‹å€¼ç»™interface{}ç±»å‹å˜é‡\n    _ = i\n\n    c := new(T1)    // ä¼ é€’ç»™é¢„å®šä¹‰å‡½æ•°\n    _ = c\n\n    f(a)            // å°†å˜é‡ä¼ ç»™å…¶ä»–å‡½æ•°\n\n    sl := make([]T1, 0, 10) // ä½œä¸ºå¤åˆç±»å‹ä¸­çš„å…ƒç´ ç±»å‹\n    _ = sl\n\n    j, ok := i.(T1) // ç”¨åœ¨ç±»å‹æ–­è¨€ä¸­\n    _ = ok\n    _ = j\n\n    switch i.(type) { // ä½œä¸ºtype switchä¸­çš„caseç±»å‹\n    case T1:\n    case T2:\n    }\n    return a        // ä»å‡½æ•°è¿”å›\n}\n</code></pre><p>ä½†å¦‚æœå¯¹anyçº¦æŸçš„ç±»å‹å‚æ•°è¿›è¡Œäº†éä¸Šè¿°å…è®¸çš„æ“ä½œï¼Œæ¯”å¦‚ç›¸ç­‰æ€§æˆ–ä¸ç­‰æ€§æ¯”è¾ƒï¼Œé‚£ä¹ˆGoç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ï¼š</p><pre><code class=\"language-plain\">// any.go\n\nfunc doSomething[T1, T2 any](t1 T1, t2 T2) T1 {\n    var a T1 \n    if a == t1 { // ç¼–è¯‘å™¨æŠ¥é”™ï¼šinvalid operation: a == t1 (incomparable types in type set)\n    }\n    \n    if a != t1 { // ç¼–è¯‘å™¨æŠ¥é”™ï¼šinvalid operation: a != t1 (incomparable types in type set)\n    }\n    ... ...\n}\n</code></pre><p>æ‰€ä»¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åœ¨æ³›å‹å‡½æ•°ä½“å†…éƒ¨å¯¹ç±»å‹å‚æ•°å£°æ˜çš„å˜é‡å®æ–½ç›¸ç­‰æ€§ï¼ˆ==ï¼‰æˆ–ä¸ç­‰æ€§æ¯”è¾ƒï¼ˆ!=ï¼‰æ“ä½œï¼Œæˆ‘ä»¬å°±éœ€è¦æ›´æ¢çº¦æŸï¼Œè¿™å°±å¼•å‡ºäº†Goå†…ç½®çš„å¦å¤–ä¸€ä¸ªé¢„å®šä¹‰çº¦æŸï¼š<strong>comparable</strong>ã€‚</p><h3>æ”¯æŒæ¯”è¾ƒæ“ä½œçš„å†…ç½®çº¦æŸï¼šcomparable</h3><p>Goæ³›å‹æä¾›äº†é¢„å®šä¹‰çš„çº¦æŸï¼šcomparableï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">// $GOROOT/src/builtin/buildin.go\n\n// comparable is an interface that is implemented by all comparable types\n// (booleans, numbers, strings, pointers, channels, arrays of comparable types,\n// structs whose fields are all comparable types).\n// The comparable interface may only be used as a type parameter constraint,\n// not as the type of a variable.\ntype comparable interface{ comparable }\n</code></pre><p>ä¸è¿‡ä»ä¸Šè¿°è¿™è¡Œæºç æˆ‘ä»¬ä»ç„¶æ— æ³•ç›´è§‚çœ‹åˆ°comparableçš„å®ç°ç»†èŠ‚ï¼ŒGoç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æœŸé—´åˆ¤æ–­æŸä¸ªç±»å‹æ˜¯å¦å®ç°äº†comparableæ¥å£ã€‚</p><p>æ ¹æ®å…¶æ³¨é‡Šè¯´æ˜ï¼Œæ‰€æœ‰å¯æ¯”è¾ƒçš„ç±»å‹éƒ½å®ç°äº†comparableè¿™ä¸ªæ¥å£ï¼ŒåŒ…æ‹¬ï¼šå¸ƒå°”ç±»å‹ã€æ•°å€¼ç±»å‹ã€å­—ç¬¦ä¸²ç±»å‹ã€æŒ‡é’ˆç±»å‹ã€channelç±»å‹ã€å…ƒç´ ç±»å‹å®ç°äº†comparableçš„æ•°ç»„å’Œæˆå‘˜ç±»å‹å‡å®ç°äº†comparableæ¥å£çš„ç»“æ„ä½“ç±»å‹ã€‚ä¸‹é¢çš„ä¾‹å­å¯ä»¥è®©æˆ‘ä»¬ç›´è§‚åœ°çœ‹åˆ°è¿™ä¸€ç‚¹ï¼š</p><pre><code class=\"language-plain\">// comparable.go\n\ntype foo struct {\n    a int\n    s string\n}\n\ntype bar struct {\n    a  int\n    sl []string\n}\n\nfunc doSomething[T comparable](t T) T {\n    var a T\n    if a == t {\n    }\n    \n    if a != t {\n    }\n    return a\n}   \n    \nfunc main() {\n    doSomething(true)\n    doSomething(3)\n    doSomething(3.14)\n    doSomething(3 + 4i)\n    doSomething(\"hello\")\n    var p *int\n    doSomething(p)\n    doSomething(make(chan int))\n    doSomething([3]int{1, 2, 3})\n    doSomething(foo{})\n    doSomething(bar{}) //  bar does not implement comparable\n}\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œæœ€åä¸€è¡Œbarç»“æ„ä½“ç±»å‹å› ä¸ºå†…å«ä¸æ”¯æŒæ¯”è¾ƒçš„åˆ‡ç‰‡ç±»å‹ï¼Œè¢«Goç¼–è¯‘å™¨è®¤ä¸ºæœªå®ç°comparableæ¥å£ï¼Œä½†é™¤æ­¤ä¹‹å¤–çš„å…¶ä»–ç±»å‹ä½œä¸ºç±»å‹å®å‚éƒ½æ»¡è¶³comparableçº¦æŸçš„è¦æ±‚ã€‚</p><p>æ­¤å¤–è¿˜è¦æ³¨æ„ï¼Œcomparableè™½ç„¶ä¹Ÿæ˜¯ä¸€ä¸ªinterfaceï¼Œä½†å®ƒä¸èƒ½åƒæ™®é€šinterfaceç±»å‹é‚£æ ·æ¥ç”¨ï¼Œæ¯”å¦‚ä¸‹é¢ä»£ç ä¼šå¯¼è‡´ç¼–è¯‘å™¨æŠ¥é”™ï¼š</p><pre><code class=\"language-plain\">var i comparable = 5 // ç¼–è¯‘å™¨é”™è¯¯ï¼šcannot use type comparable outside a type constraint: interface is (or embeds) comparable\n</code></pre><p>ä»ç¼–è¯‘å™¨çš„é”™è¯¯æç¤ºï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼š<strong>comparableåªèƒ½ç”¨ä½œä¿®é¥°ç±»å‹å‚æ•°çš„çº¦æŸ</strong>ã€‚</p><p>å¥½äº†ï¼Œå­¦äº†ä¸¤ä¸ªå†…ç½®çº¦æŸäº†ï¼Œä¸‹é¢æˆ‘ä»¬å†æ¥çœ‹çœ‹å¦‚ä½•è‡ªå®šä¹‰çº¦æŸã€‚</p><h3>è‡ªå®šä¹‰çº¦æŸ</h3><p>å‰é¢è¯´è¿‡ï¼ŒGoæ³›å‹æœ€ç»ˆå†³å®šä½¿ç”¨interfaceè¯­æ³•æ¥å®šä¹‰çº¦æŸã€‚è¿™æ ·ä¸€æ¥ï¼Œ<strong>å‡¡æ˜¯æ¥å£ç±»å‹å‡å¯ä½œä¸ºç±»å‹å‚æ•°çš„çº¦æŸ</strong>ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨æ™®é€šæ¥å£ç±»å‹ä½œä¸ºç±»å‹å‚æ•°çº¦æŸçš„ç¤ºä¾‹ï¼š</p><pre><code class=\"language-plain\">// stringify.go\n\nfunc Stringify[T fmt.Stringer](s []T) (ret []string) {\n    for _, v := range s {\n        ret = append(ret, v.String())\n    }\n    return ret\n}\n\ntype MyString string\n\nfunc (s MyString) String() string {\n    return string(s)\n}\n\nfunc main() {\n    sl := Stringify([]MyString{\"I\", \"love\", \"golang\"})\n    fmt.Println(sl) // è¾“å‡ºï¼š[I love golang]\n}\n</code></pre><p>è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯fmt.Stringeræ¥å£ä½œä¸ºçº¦æŸã€‚ä¸€æ–¹é¢ï¼Œè¿™è¦æ±‚ç±»å‹å‚æ•°Tçš„å®å‚å¿…é¡»å®ç°fmt.Stringeræ¥å£çš„æ‰€æœ‰æ–¹æ³•ï¼›å¦ä¸€æ–¹é¢ï¼Œæ³›å‹å‡½æ•°Stringifyçš„å®ç°ä»£ç ä¸­ï¼Œå£°æ˜çš„Tç±»å‹å®ä¾‹ï¼ˆæ¯”å¦‚vï¼‰ä¹Ÿä»…è¢«å…è®¸è°ƒç”¨fmt.Stringerçš„Stringæ–¹æ³•ã€‚</p><p>è¿™ç±»<strong>åŸºäºè¡Œä¸ºï¼ˆæ–¹æ³•é›†åˆï¼‰å®šä¹‰çš„çº¦æŸ</strong>å¯¹äºä¹ æƒ¯äº†Goæ¥å£ç±»å‹çš„å¼€å‘è€…æ¥è¯´ï¼Œæ˜¯ç›¸å¯¹å¥½ç†è§£çš„ï¼Œå®šä¹‰å’Œä½¿ç”¨èµ·æ¥ï¼Œä¸ä¸‹é¢è¿™æ ·çš„ä»¥æ¥å£ç±»å‹ä½œä¸ºå½¢å‚çš„æ™®é€šGoå‡½æ•°ç›¸æ¯”ï¼ŒåŒºåˆ«ä¼¼ä¹ä¸å¤§ï¼š</p><pre><code class=\"language-plain\">func Stringify(s []fmt.Stringer) (ret []string) {\n    for _, v := range s {\n        ret = append(ret, v.String())\n    }\n    return ret\n}\n</code></pre><p>ä½†ç°åœ¨æˆ‘æƒ³æ‰©å±•ä¸€ä¸‹ä¸Šé¢stringify.goè¿™ä¸ªç¤ºä¾‹ï¼Œå°†Stringifyçš„è¯­ä¹‰æ”¹ä¸ºåªå¤„ç†éé›¶å€¼çš„å…ƒç´ ï¼š</p><pre><code class=\"language-plain\">// stringify_without_zero.go\n\nfunc StringifyWithoutZero[T fmt.Stringer](s []T) (ret []string) {\n    var zero T\n    for _, v := range s {\n        if v == zero { // ç¼–è¯‘å™¨æŠ¥é”™ï¼šinvalid operation: v == zero (incomparable types in type set)\n            continue\n        }\n        ret = append(ret, v.String())\n    }\n    return ret\n}\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œé’ˆå¯¹vçš„ç›¸ç­‰æ€§åˆ¤æ–­å¯¼è‡´äº†ç¼–è¯‘å™¨æŠ¥é”™ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºç±»å‹å‚æ•°èµ‹äºˆæ›´å¤šçš„èƒ½åŠ›ï¼Œæ¯”å¦‚æ”¯æŒç›¸ç­‰æ€§å’Œä¸ç­‰æ€§æ¯”è¾ƒã€‚è¿™è®©æˆ‘ä»¬æƒ³èµ·äº†æˆ‘ä»¬åˆšåˆšå­¦è¿‡çš„Goå†…ç½®çº¦æŸcomparableï¼Œå®ç°comparableçš„ç±»å‹ï¼Œä¾¿å¯ä»¥æ”¯æŒç›¸ç­‰æ€§å’Œä¸ç­‰æ€§åˆ¤æ–­æ“ä½œäº†ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œcomparableè™½ç„¶ä¸èƒ½åƒæ™®é€šæ¥å£ç±»å‹é‚£æ ·å£°æ˜å˜é‡ï¼Œä½†å®ƒå´å¯ä»¥ä½œä¸ºç±»å‹åµŒå…¥åˆ°å…¶ä»–æ¥å£ç±»å‹ä¸­ï¼Œä¸‹é¢æˆ‘ä»¬å°±æ‰©å±•ä¸€ä¸‹ä¸Šé¢ç¤ºä¾‹ï¼š</p><pre><code class=\"language-plain\">// stringify_new_without_zero.go\ntype Stringer interface {\n    comparable\n    String() string\n}\n\nfunc StringifyWithoutZero[T Stringer](s []T) (ret []string) {\n    var zero T\n    for _, v := range s {\n        if v == zero {\n            continue\n        }\n        ret = append(ret, v.String())\n    }\n    return ret\n}\n\ntype MyString string\n\nfunc (s MyString) String() string {\n    return string(s)\n}\n\nfunc main() {\n    sl := StringifyWithoutZero([]MyString{\"I\", \"\", \"love\", \"\", \"golang\"}) // è¾“å‡ºï¼š[I love golang]\n    fmt.Println(sl)\n}\n</code></pre><p>åœ¨è¿™ä¸ªç¤ºä¾‹é‡Œï¼Œæˆ‘ä»¬è‡ªå®šä¹‰äº†ä¸€ä¸ªStringeræ¥å£ç±»å‹ä½œä¸ºçº¦æŸã€‚åœ¨è¯¥ç±»å‹ä¸­ï¼Œæˆ‘ä»¬ä¸ä»…å®šä¹‰äº†Stringæ–¹æ³•ï¼Œè¿˜åµŒå…¥äº†comparableï¼Œè¿™æ ·åœ¨æ³›å‹å‡½æ•°ä¸­ï¼Œæˆ‘ä»¬ç”¨Stringerçº¦æŸçš„ç±»å‹å‚æ•°å°±å…·å¤‡äº†è¿›è¡Œç›¸ç­‰æ€§å’Œä¸ç­‰æ€§æ¯”è¾ƒçš„èƒ½åŠ›äº†ï¼</p><p>ä½†æˆ‘ä»¬çš„ç¤ºä¾‹æ¼”è¿›è¿˜æ²¡æœ‰å®Œï¼Œç°åœ¨ç›¸ç­‰æ€§å’Œä¸ç­‰æ€§æ¯”è¾ƒå·²ç»ä¸èƒ½æ»¡è¶³æˆ‘ä»¬éœ€æ±‚äº†ï¼Œæˆ‘ä»¬è¿˜è¦ä¸ºä¹‹<strong>åŠ ä¸Šå¯¹æ’åºè¡Œä¸ºçš„æ”¯æŒï¼Œ</strong>å¹¶åŸºäºæ’åºèƒ½åŠ›å®ç°ä¸‹é¢çš„StringifyLessThanæ³›å‹å‡½æ•°ï¼š</p><pre><code class=\"language-plain\">func StringifyLessThan[T Stringer](s []T, max T) (ret []string) {\n    var zero T\n    for _, v := range s {\n        if v == zero || v &gt;= max {\n            continue\n        }\n        ret = append(ret, v.String())\n    }\n    return ret\n}\n</code></pre><p>ä½†ç°åœ¨å½“æˆ‘ä»¬ç¼–è¯‘ä¸Šé¢StringifyLessThanå‡½æ•°æ—¶ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ç¼–è¯‘å™¨çš„æŠ¥é”™ä¿¡æ¯ <code>invalid operation: v &gt;= max (type parameter T is not comparable with &gt;=)</code>ã€‚Goç¼–è¯‘å™¨è®¤ä¸ºStringerçº¦æŸçš„ç±»å‹å‚æ•°Tä¸å…·å¤‡æ’åºæ¯”è¾ƒèƒ½åŠ›ã€‚</p><p>å¦‚æœè¿æ’åºæ¯”è¾ƒæ€§éƒ½æ— æ³•æ”¯æŒï¼Œè¿™å°†å¤§å¤§<strong>é™åˆ¶æˆ‘ä»¬æ³›å‹å‡½æ•°çš„è¡¨è¾¾èƒ½åŠ›</strong>ã€‚ä½†æ˜¯Goåˆä¸æ”¯æŒè¿ç®—ç¬¦é‡è½½ï¼ˆoperator overloadingï¼‰ï¼Œä¸å…è®¸æˆ‘ä»¬å®šä¹‰å‡ºä¸‹é¢è¿™æ ·çš„æ¥å£ç±»å‹ä½œä¸ºç±»å‹å‚æ•°çš„çº¦æŸï¼š</p><pre><code class=\"language-plain\">type Stringer[T any] interface {\n    String() string\n    comparable\n\t&gt;(t T) bool\n\t&gt;=(t T) bool\n\t&lt;(t T) bool\n\t&lt;=(t T) bool\n}\n</code></pre><p>é‚£æˆ‘ä»¬åˆè¯¥å¦‚ä½•åšå‘¢ï¼Ÿåˆ«æ‹…å¿ƒï¼ŒGoæ ¸å¿ƒå›¢é˜Ÿæ˜¾ç„¶ä¹Ÿæƒ³åˆ°äº†è¿™ä¸€ç‚¹ï¼Œäºæ˜¯å¯¹Goæ¥å£ç±»å‹å£°æ˜è¯­æ³•åšäº†æ‰©å±•ï¼Œ<strong>æ”¯æŒåœ¨æ¥å£ç±»å‹ä¸­æ”¾å…¥ç±»å‹å…ƒç´ ï¼ˆtype elementï¼‰ä¿¡æ¯</strong>ï¼Œæ¯”å¦‚ä¸‹é¢çš„orderedæ¥å£ç±»å‹ï¼š</p><pre><code class=\"language-plain\">type ordered interface {\n\t~int | ~int8 | ~int16 | ~int32 | ~int64 |\n\t~uint | ~uint8 | ~uint16 | ~uint32 | ~uint64 | ~uintptr |\n\t~float32 | ~float64 | ~string\n}\n</code></pre><p>åœ¨è¿™ä¸ªæ¥å£ç±»å‹çš„å£°æ˜ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰çœ‹åˆ°ä»»ä½•æ–¹æ³•ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯ä¸€ç»„ç”±ç«–çº¿ â€œ|â€ åˆ†éš”çš„ã€å¸¦ç€å°å°¾å·´ â€œ~â€ çš„ç±»å‹åˆ—è¡¨ã€‚è¿™ä¸ªåˆ—è¡¨è¡¨ç¤ºçš„æ˜¯ï¼Œä»¥å®ƒä»¬ä¸ºåº•å±‚ç±»å‹ï¼ˆunderlying typeï¼‰çš„ç±»å‹éƒ½æ»¡è¶³orderedçº¦æŸï¼Œéƒ½å¯ä»¥ä½œä¸ºä»¥orderedä¸ºçº¦æŸçš„ç±»å‹å‚æ•°çš„ç±»å‹å®å‚ï¼Œä¼ å…¥æ³›å‹å‡½æ•°ã€‚</p><p>æˆ‘ä»¬å°†å…¶ç»„åˆåˆ°æˆ‘ä»¬å£°æ˜çš„Stringeræ¥å£ä¸­ï¼Œç„¶ååº”ç”¨ä¸€ä¸‹æˆ‘ä»¬çš„StringifyLessThanå‡½æ•°ï¼š</p><pre><code class=\"language-plain\">type Stringer interface {\n    ordered\n    comparable\n    String() string\n}\n\nfunc main() {\n    sl := StringifyLessThan([]MyString{\"I\", \"\", \"love\", \"\", \"golang\"}, MyString(\"cpp\")) // è¾“å‡ºï¼š[I]\n    fmt.Println(sl)\n}\n</code></pre><p>è¿™å›ç¼–è¯‘å™¨æ²¡æœ‰æŠ¥é”™ï¼Œå¹¶ä¸”ç¨‹åºè¾“å‡ºäº†é¢„æœŸçš„ç»“æœã€‚</p><p>å¥½äº†ï¼Œçœ‹äº†é‚£ä¹ˆå¤šä¾‹å­ï¼Œæ˜¯æ—¶å€™æ­£å¼å¯¹Goæ¥å£ç±»å‹è¯­æ³•çš„æ‰©å±•åšä¸€ä¸ªè¯´æ˜äº†ã€‚ä¸‹é¢æ˜¯æ‰©å±•åçš„æ¥å£ç±»å‹å®šä¹‰çš„ç»„æˆç¤ºæ„å›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/69/d7/6977c0bdaebe13c8847a8ee9468c2bd7.jpg?wh=964x431\" alt=\"å›¾ç‰‡\"></p><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œæ–°çš„æ¥å£ç±»å‹ä¾ç„¶å¯ä»¥åµŒå…¥å…¶ä»–æ¥å£ç±»å‹ï¼Œæ»¡è¶³ç»„åˆçš„è®¾è®¡å“²å­¦ï¼›é™¤äº†åµŒå…¥çš„å…¶ä»–æ¥å£ç±»å‹å¤–ï¼Œå…¶ä½™çš„ç»„æˆå…ƒç´ è¢«ç§°ä¸ºæ¥å£å…ƒç´ ï¼ˆinterface elementï¼‰ã€‚</p><p>æ¥å£å…ƒç´ ä¹Ÿæœ‰ä¸¤ç±»ï¼Œä¸€ç±»å°±æ˜¯å¸¸è§„çš„æ–¹æ³•å…ƒç´ ï¼ˆmethod elementï¼‰ï¼Œæ¯ä¸ªæ–¹æ³•å…ƒç´ å¯¹åº”ä¸€ä¸ªæ–¹æ³•åŸå‹ï¼›å¦ä¸€ç±»åˆ™æ˜¯æ­¤æ¬¡æ‰©å±•æ–°å¢çš„ç±»å‹å…ƒç´ ï¼ˆtype elementï¼‰ï¼Œå³åœ¨æ¥å£ç±»å‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾å…¥ä¸€äº›ç±»å‹ä¿¡æ¯ï¼Œå°±åƒå‰é¢çš„orderedæ¥å£é‚£æ ·ã€‚</p><p>ç±»å‹å…ƒç´ å¯ä»¥æ˜¯å•ä¸ªç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ç»„ç”±ç«–çº¿ â€œ|â€ è¿æ¥çš„ç±»å‹ï¼Œç«–çº¿ â€œ|â€ çš„å«ä¹‰æ˜¯â€œå¹¶â€ï¼Œè¿™æ ·çš„ä¸€ç»„ç±»å‹è¢«ç§°ä¸ºunion elementã€‚æ— è®ºæ˜¯å•ä¸ªç±»å‹ï¼Œè¿˜æ˜¯union elementä¸­ç”± â€œ|â€ åˆ†éš”çš„ç±»å‹ï¼Œå¦‚æœç±»å‹ä¸­ä¸å¸¦æœ‰ â€œ~â€ ç¬¦å·çš„ç±»å‹å°±ä»£è¡¨å…¶è‡ªèº«ï¼›è€Œå¸¦æœ‰ â€œ~â€ ç¬¦å·çš„ç±»å‹åˆ™ä»£è¡¨ä»¥è¯¥ç±»å‹ä¸ºåº•å±‚ç±»å‹ï¼ˆunderlying typeï¼‰çš„æ‰€æœ‰ç±»å‹ï¼Œè¿™ç±»å¸¦æœ‰ â€œ~â€ çš„ç±»å‹ä¹Ÿè¢«ç§°ä¸ºapproximation elementï¼Œå¦‚ä¸‹é¢ç¤ºä¾‹ï¼š</p><pre><code class=\"language-plain\">type Ia interface {\n\tint | string  // ä»…ä»£è¡¨intå’Œstring\n}\n\ntype Ib interface {\n\t~int | ~string  // ä»£è¡¨ä»¥intå’Œstringä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹\n}\n</code></pre><p>ä¸‹å›¾æ˜¯ç±»å‹å…ƒç´ çš„åˆ†è§£è¯´æ˜ï¼Œä¾›ä½ å‚è€ƒï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/2d/2d/2d63e16759bd0e4e97faf6ea52f6ed2d.jpg?wh=1678x988\" alt=\"å›¾ç‰‡\"></p><p>ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼š<strong>union elementä¸­ä¸èƒ½åŒ…å«å¸¦æœ‰æ–¹æ³•å…ƒç´ çš„æ¥å£ç±»å‹ï¼Œä¹Ÿä¸èƒ½åŒ…å«é¢„å®šä¹‰çš„çº¦æŸç±»å‹ï¼Œå¦‚comparable</strong>ã€‚</p><p>æ‰©å±•åï¼ŒGoå°†æ¥å£ç±»å‹åˆ†æˆäº†ä¸¤ç±»ï¼Œä¸€ç±»æ˜¯åŸºæœ¬æ¥å£ç±»å‹ï¼ˆbasic interface typeï¼‰ï¼Œå³å…¶è‡ªèº«å’Œå…¶åµŒå…¥çš„æ¥å£ç±»å‹éƒ½åªåŒ…å«æ–¹æ³•å…ƒç´ ï¼Œè€Œä¸åŒ…å«ç±»å‹å…ƒç´ ã€‚åŸºæœ¬æ¥å£ç±»å‹ä¸ä»…å¯ä»¥å½“åšå¸¸è§„æ¥å£ç±»å‹æ¥ç”¨ï¼Œå³å£°æ˜æ¥å£ç±»å‹å˜é‡ã€æ¥å£ç±»å‹å˜é‡èµ‹å€¼ç­‰ï¼Œè¿˜å¯ä»¥ä½œä¸ºæ³›å‹ç±»å‹å‚æ•°çš„çº¦æŸã€‚</p><p>é™¤æ­¤ä¹‹å¤–çš„éç©ºæ¥å£ç±»å‹éƒ½å±äºéåŸºæœ¬æ¥å£ç±»å‹ï¼Œå³ç›´æ¥æˆ–é—´æ¥ï¼ˆé€šè¿‡åµŒå…¥å…¶ä»–æ¥å£ç±»å‹ï¼‰åŒ…å«äº†ç±»å‹å…ƒç´ çš„æ¥å£ç±»å‹ã€‚è¿™ç±»æ¥å£ç±»å‹ä»…å¯ä»¥ç”¨ä½œæ³›å‹ç±»å‹å‚æ•°çš„çº¦æŸï¼Œæˆ–è¢«åµŒå…¥åˆ°å…¶ä»–ä»…ä½œä¸ºçº¦æŸçš„æ¥å£ç±»å‹ä¸­ï¼Œä¸‹é¢çš„ä»£ç å°±å¾ˆç›´è§‚åœ°å±•ç¤ºäº†è¿™ä¸¤ç§æ¥å£ç±»å‹çš„ç‰¹å¾ï¼š</p><pre><code class=\"language-plain\">type BasicInterface interface { // åŸºæœ¬æ¥å£ç±»å‹\n    M1()\n}\n\ntype NonBasicInterface interface { // éåŸºæœ¬æ¥å£ç±»å‹\n    BasicInterface\n    ~int | ~string // åŒ…å«ç±»å‹å…ƒç´ \n}\n\ntype MyString string\n\nfunc (MyString) M1() {\n}  \n   \nfunc foo[T NonBasicInterface](a T) { // éåŸºæœ¬æ¥å£ç±»å‹ä½œä¸ºçº¦æŸ\n}  \n   \nfunc bar[T BasicInterface](a T) { // åŸºæœ¬æ¥å£ç±»å‹ä½œä¸ºçº¦æŸ\n}  \n   \nfunc main() {\n    var s = MyString(\"hello\")\n    var bi BasicInterface = s // åŸºæœ¬æ¥å£ç±»å‹æ”¯æŒå¸¸è§„ç”¨æ³•\n    var nbi NonBasicInterface = s // éåŸºæœ¬æ¥å£ä¸æ”¯æŒå¸¸è§„ç”¨æ³•ï¼Œå¯¼è‡´ç¼–è¯‘å™¨é”™è¯¯ï¼šcannot use type NonBasicInterface outside a type constraint: interface contains type constraints\n    bi.M1()\n    nbi.M1()\n    foo(s)\n    bar(s)           \n}\n</code></pre><p>çœ‹åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½ä¼šè§‰å¾—æœ‰é—®é¢˜äº†ï¼šåŸºæœ¬æ¥å£ç±»å‹ï¼Œç”±äºå…¶ä»…åŒ…å«æ–¹æ³•å…ƒç´ ï¼Œæˆ‘ä»¬ä¾æ—§å¯ä»¥åŸºäºä¹‹å‰è®²è¿‡çš„<strong>æ–¹æ³•é›†åˆï¼Œ</strong>æ¥ç¡®å®šä¸€ä¸ªç±»å‹æ˜¯å¦å®ç°äº†æ¥å£ï¼Œä»¥åŠæ˜¯å¦å¯ä»¥ä½œä¸ºç±»å‹å®å‚ä¼ é€’ç»™çº¦æŸä¸‹çš„ç±»å‹å½¢å‚ã€‚ä½†å¯¹äºåªèƒ½ä½œä¸ºçº¦æŸçš„éåŸºæœ¬æ¥å£ç±»å‹ï¼Œæ—¢æœ‰æ–¹æ³•å…ƒç´ ï¼Œä¹Ÿæœ‰ç±»å‹å…ƒç´ ï¼Œæˆ‘ä»¬å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»å‹æ˜¯å¦æ»¡è¶³çº¦æŸï¼Œå¹¶ä½œä¸ºç±»å‹å®å‚ä¼ ç»™ç±»å‹å½¢å‚å‘¢ï¼Ÿ</p><p>è¿™æ—¶æˆ‘ä»¬å°±è¦ä»‹ç»Goæ³›å‹è½åœ°æ—¶å¼•å…¥çš„æ–°æ¦‚å¿µï¼š<strong>ç±»å‹é›†åˆï¼ˆtype setï¼‰</strong>ï¼Œç±»å‹é›†åˆå°†ä½œä¸ºåç»­åˆ¤æ–­ç±»å‹æ˜¯å¦æ»¡è¶³çº¦æŸçš„åŸºæœ¬æ‰‹æ®µã€‚</p><h3>ç±»å‹é›†åˆï¼ˆtype setï¼‰</h3><p>ç±»å‹é›†åˆï¼ˆtype setï¼‰çš„æ¦‚å¿µæ˜¯Goæ ¸å¿ƒå›¢é˜Ÿåœ¨2021å¹´4æœˆæ›´æ–° <a href=\"https://github.com/golang/go/issues/45346\">Goæ³›å‹è®¾è®¡æ–¹æ¡ˆ</a>æ—¶å¼•å…¥çš„ã€‚åœ¨é‚£ä¸€æ¬¡æ–¹æ¡ˆå˜æ›´ä¸­ï¼ŒåŸæ–¹æ¡ˆä¸­ç”¨äºæ¥å£ç±»å‹ä¸­å®šä¹‰ç±»å‹å…ƒç´ çš„typeå…³é”®å­—è¢«å»é™¤äº†ï¼Œæ³›å‹ç›¸å…³è¯­æ³•å¾—åˆ°äº†è¿›ä¸€æ­¥çš„ç®€åŒ–ã€‚</p><p>ä¸€æ—¦ç¡®å®šäº†ä¸€ä¸ªæ¥å£ç±»å‹çš„ç±»å‹é›†åˆï¼Œç±»å‹é›†åˆä¸­çš„å…ƒç´ å°±å¯ä»¥æ»¡è¶³ä»¥è¯¥æ¥å£ç±»å‹ä½œä¸ºçš„ç±»å‹çº¦æŸï¼Œä¹Ÿå°±æ˜¯å¯ä»¥å°†è¯¥é›†åˆä¸­çš„å…ƒç´ ä½œä¸ºç±»å‹å®å‚ä¼ é€’ç»™è¯¥æ¥å£ç±»å‹çº¦æŸçš„ç±»å‹å‚æ•°ã€‚</p><p>é‚£ä¹ˆç±»å‹é›†åˆç©¶ç«Ÿæ˜¯æ€ä¹ˆå®šä¹‰çš„å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ã€‚</p><p>ç»“åˆGoæ³›å‹è®¾è®¡æ–¹æ¡ˆä»¥åŠ <a href=\"https://go.dev/ref/spec\">Goè¯­æ³•è§„èŒƒ</a>ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆæ¥ç†è§£ç±»å‹é›†åˆï¼š</p><ul>\n<li>æ¯ä¸ªç±»å‹éƒ½æœ‰ä¸€ä¸ªç±»å‹é›†åˆï¼›</li>\n<li>éæ¥å£ç±»å‹çš„ç±»å‹çš„ç±»å‹é›†åˆä¸­ä»…åŒ…å«å…¶è‡ªèº«ï¼Œæ¯”å¦‚éæ¥å£ç±»å‹Tï¼Œå®ƒçš„ç±»å‹é›†åˆä¸º {T}ï¼Œå³é›†åˆä¸­ä»…æœ‰ä¸€ä¸ªå…ƒç´ ä¸”è¿™å”¯ä¸€çš„å…ƒç´ å°±æ˜¯å®ƒè‡ªèº«ã€‚</li>\n</ul><p>ä½†æˆ‘ä»¬æœ€ç»ˆè¦ææ‡‚çš„æ˜¯ç”¨äºå®šä¹‰çº¦æŸçš„æ¥å£ç±»å‹çš„ç±»å‹é›†åˆï¼Œæ‰€ä»¥ä»¥ä¸Šè¿™ä¸¤ç‚¹éƒ½æ˜¯åœ¨ä¸ºä¸‹é¢æ¥å£ç±»å‹çš„ç±»å‹é›†åˆå®šä¹‰åšé“ºå«ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p><ul>\n<li>ç©ºæ¥å£ç±»å‹ï¼ˆanyæˆ–interface{}ï¼‰çš„ç±»å‹é›†åˆæ˜¯ä¸€ä¸ªæ— é™é›†åˆï¼Œè¯¥é›†åˆä¸­çš„å…ƒç´ ä¸ºæ‰€æœ‰éæ¥å£ç±»å‹ã€‚è¿™ä¸ªä¸æˆ‘ä»¬ä¹‹å‰çš„è®¤çŸ¥ä¹Ÿæ˜¯ä¸€è‡´çš„ï¼Œæ‰€æœ‰éæ¥å£ç±»å‹éƒ½å®ç°äº†ç©ºæ¥å£ç±»å‹ï¼›</li>\n<li>éç©ºæ¥å£ç±»å‹çš„ç±»å‹é›†åˆåˆ™æ˜¯å…¶å®šä¹‰ä¸­<strong>æ¥å£å…ƒç´ çš„ç±»å‹é›†åˆçš„äº¤é›†</strong>ï¼ˆå¦‚ä¸‹å›¾ï¼‰ã€‚</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/8a/23/8a374e434e5c3e603d3a61a8eaccd723.jpg?wh=771x398\" alt=\"å›¾ç‰‡\"></p><p>ç”±æ­¤å¯è§ï¼Œè¦æƒ³ç¡®å®šä¸€ä¸ªæ¥å£ç±»å‹çš„ç±»å‹é›†åˆï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“å…¶ä¸­æ¯ä¸ªæ¥å£å…ƒç´ çš„ç±»å‹é›†åˆã€‚</p><p>ä¸Šé¢æˆ‘ä»¬è¯´è¿‡ï¼Œæ¥å£å…ƒç´ å¯ä»¥æ˜¯å…¶ä»–åµŒå…¥æ¥å£ç±»å‹ï¼Œå¯ä»¥æ˜¯å¸¸è§„æ–¹æ³•å…ƒç´ ï¼Œä¹Ÿå¯ä»¥æ˜¯ç±»å‹å…ƒç´ ã€‚å½“æ¥å£å…ƒç´ ä¸ºå…¶ä»–åµŒå…¥æ¥å£ç±»å‹æ—¶ï¼Œè¯¥æ¥å£å…ƒç´ çš„ç±»å‹é›†åˆå°±ä¸ºè¯¥åµŒå…¥æ¥å£ç±»å‹çš„ç±»å‹é›†åˆï¼›è€Œå½“æ¥å£å…ƒç´ ä¸ºå¸¸è§„æ–¹æ³•å…ƒç´ æ—¶ï¼Œæ¥å£å…ƒç´ çš„ç±»å‹é›†åˆå°±ä¸ºè¯¥æ–¹æ³•çš„ç±»å‹é›†åˆã€‚</p><p>åˆ°è¿™é‡Œä½ å¯èƒ½ä¼šå¾ˆç–‘æƒ‘ï¼š<strong>ä¸€ä¸ªæ–¹æ³•ä¹Ÿæœ‰è‡ªå·±çš„ç±»å‹é›†åˆ</strong>ï¼Ÿ</p><p>æ˜¯çš„ã€‚Goè§„å®šä¸€ä¸ªæ–¹æ³•çš„ç±»å‹é›†åˆä¸ºæ‰€æœ‰å®ç°äº†è¯¥æ–¹æ³•çš„éæ¥å£ç±»å‹çš„é›†åˆï¼Œè¿™æ˜¾ç„¶ä¹Ÿæ˜¯ä¸€ä¸ªæ— é™é›†åˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/86/c1/86740d0439afa94bayyccb86c60876c1.jpg?wh=681x391\" alt=\"å›¾ç‰‡\"></p><p>é€šè¿‡æ–¹æ³•å…ƒç´ çš„ç±»å‹é›†åˆï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆç†è§£é‡Šä»…åŒ…å«å¤šä¸ªæ–¹æ³•çš„å¸¸è§„æ¥å£ç±»å‹çš„ç±»å‹é›†åˆï¼Œé‚£å°±æ˜¯è¿™äº›æ–¹æ³•å…ƒç´ çš„ç±»å‹é›†åˆçš„äº¤é›†ï¼Œå³æ‰€æœ‰å®ç°äº†è¿™ä¸‰ä¸ªæ–¹æ³•çš„ç±»å‹æ‰€ç»„æˆçš„é›†åˆã€‚</p><p>æœ€åæˆ‘ä»¬å†æ¥çœ‹çœ‹ç±»å‹å…ƒç´ ã€‚ç±»å‹å…ƒç´ çš„ç±»å‹é›†åˆç›¸å¯¹æ¥è¯´æ˜¯æœ€å¥½ç†è§£çš„ï¼Œæ¯ä¸ªç±»å‹å…ƒç´ çš„ç±»å‹é›†åˆå°±æ˜¯å…¶è¡¨ç¤ºçš„æ‰€æœ‰ç±»å‹ç»„æˆçš„é›†åˆã€‚å¦‚æœæ˜¯ ~T å½¢å¼ï¼Œåˆ™é›†åˆä¸­ä¸ä»…åŒ…å«Tæœ¬èº«ï¼Œè¿˜åŒ…å«æ‰€æœ‰ä»¥Tä¸ºåº•å±‚ç±»å‹çš„ç±»å‹ã€‚å¦‚æœä½¿ç”¨Union elementï¼Œåˆ™ç±»å‹é›†åˆæ˜¯æ‰€æœ‰ç«–çº¿ â€œ|â€ è¿æ¥çš„ç±»å‹çš„ç±»å‹é›†åˆçš„å¹¶é›†ã€‚</p><p>è®²äº†è¿™ä¹ˆå¤šï¼Œæˆ‘ä»¬æ¥åšä¸ªç¨å¤æ‚äº›çš„å®ä¾‹åˆ†æï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ä¸‹é¢æ¥å£ç±»å‹Içš„ç±»å‹é›†åˆï¼š</p><pre><code class=\"language-plain\">type Intf1 interface {\n    ~int | string\n\tF1()\n\tF2()\n}\n\ntype Intf2 interface {\n\t~int | ~float64\n}\n\ntype I interface {\n    Intf1 \n    M1()\n    M2()\n    int | ~string | Intf2\n}\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œæ¥å£ç±»å‹ I ç”±å››ä¸ªæ¥å£å…ƒç´ ç»„æˆï¼Œåˆ†åˆ«æ˜¯Intf1ã€M1ã€M2å’ŒUnion element â€œint | ~string | Intf2â€ï¼Œæˆ‘ä»¬åªè¦åˆ†åˆ«æ±‚å‡ºè¿™å››ä¸ªå…ƒç´ çš„ç±»å‹é›†åˆï¼Œå†å–ä¸€ä¸ªäº¤é›†å³å¯ã€‚</p><ul>\n<li><strong>Intf1çš„ç±»å‹é›†åˆ</strong></li>\n</ul><p>Intf1æ˜¯æ¥å£ç±»å‹Içš„ä¸€ä¸ªåµŒå…¥æ¥å£ï¼Œå®ƒè‡ªèº«ä¹Ÿæ˜¯ç”±ä¸‰ä¸ªæ¥å£å…ƒç´ ç»„æˆï¼Œå®ƒçš„ç±»å‹é›†åˆä¸ºè¿™ä¸‰ä¸ªæ¥å£å…ƒç´ çš„äº¤é›†ï¼Œå³ {ä»¥intä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹ã€stringã€å®ç°äº†F1å’ŒF2æ–¹æ³•çš„æ‰€æœ‰ç±»å‹}ã€‚</p><ul>\n<li><strong>M1å’ŒM2çš„ç±»å‹é›†åˆ</strong></li>\n</ul><p>å°±åƒå‰é¢æ‰€è¯´çš„ï¼Œæ–¹æ³•çš„ç±»å‹é›†åˆæ˜¯ç”±æ‰€æœ‰å®ç°è¯¥æ–¹æ³•çš„ç±»å‹ç»„æˆçš„ï¼Œå› æ­¤M1çš„æ–¹æ³•é›†åˆä¸º {å®ç°äº†M1çš„æ‰€æœ‰ç±»å‹}ï¼ŒM2çš„æ–¹æ³•é›†åˆä¸º {å®ç°äº†M2çš„æ‰€æœ‰ç±»å‹}ã€‚</p><ul>\n<li><strong>int | ~string | Intf2 çš„ç±»å‹é›†åˆ</strong></li>\n</ul><p>è¿™æ˜¯ä¸€ä¸ªç±»å‹å…ƒç´ ï¼Œå®ƒçš„ç±»å‹é›†åˆä¸ºintã€~stringå’ŒIntf2ç±»å‹é›†åˆçš„å¹¶é›†ã€‚intç±»å‹é›†åˆå°±æ˜¯ {int}ï¼Œ~string çš„ç±»å‹é›†åˆä¸º {ä»¥stringä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹}ï¼Œè€ŒIntf2çš„ç±»å‹é›†åˆä¸º {ä»¥intä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹ï¼Œä»¥float64ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹}ã€‚</p><p>ä¸ºäº†æ›´å¥½åœ°è¯´æ˜æœ€ç»ˆç±»å‹é›†åˆæ˜¯å¦‚ä½•å–å¾—çš„ï¼Œæˆ‘ä»¬åœ¨ä¸‹é¢å†åˆ—ä¸€ä¸‹å„ä¸ªæ¥å£å…ƒç´ çš„ç±»å‹é›†åˆï¼š</p><ul>\n<li>Intf1çš„ç±»å‹é›†åˆï¼š{ä»¥intä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹ã€stringã€å®ç°äº†F1å’ŒF2æ–¹æ³•çš„æ‰€æœ‰ç±»å‹}ï¼›</li>\n<li>M1çš„ç±»å‹é›†åˆï¼š{å®ç°äº†M1çš„æ‰€æœ‰ç±»å‹}ï¼›</li>\n<li>M2çš„ç±»å‹é›†åˆï¼š{å®ç°äº†M2çš„æ‰€æœ‰ç±»å‹}ï¼›</li>\n<li>int | ~string | Intf2 çš„ç±»å‹é›†åˆï¼š{ä»¥ int ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹ï¼Œä»¥ float64 ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹ï¼Œä»¥stringä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹}ã€‚</li>\n</ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬å–ä¸€ä¸‹ä¸Šé¢é›†åˆçš„äº¤é›†ï¼Œä¹Ÿå°±æ˜¯ {ä»¥intä¸ºåº•å±‚ç±»å‹çš„ä¸”å®ç°äº†F1ã€F2ã€M1ã€M2è¿™ä¸ªå››ä¸ªæ–¹æ³•çš„æ‰€æœ‰ç±»å‹}ã€‚</p><p>ç°åœ¨æˆ‘ä»¬ç”¨ä»£ç æ¥éªŒè¯ä¸€ä¸‹ï¼š</p><pre><code class=\"language-plain\">// typeset.go\n\nfunc doSomething[T I](t T) {\n}\n\ntype MyInt int\n\nfunc (MyInt) F1() {\n}\nfunc (MyInt) F2() {\n}\nfunc (MyInt) M1() {\n}\nfunc (MyInt) M2() {\n}\n\nfunc main() {\n    var a int = 11\n    //doSomething(a) //int does not implement I (missing F1 method)\n\n    var b = MyInt(a)\n    doSomething(b) // ok\n}\n</code></pre><p>å¦‚ä¸Šä»£ç ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªä»¥intä¸ºåº•å±‚ç±»å‹çš„è‡ªå®šä¹‰ç±»å‹MyIntå¹¶å®ç°äº†å››ä¸ªæ–¹æ³•ï¼Œè¿™æ ·MyIntå°±æ»¡è¶³äº†æ³›å‹å‡½æ•°doSomethingä¸­çº¦æŸIçš„è¦æ±‚ï¼Œå¯ä»¥ä½œä¸ºç±»å‹å®å‚ä¼ é€’ã€‚</p><h3>ç®€åŒ–ç‰ˆçš„çº¦æŸå½¢å¼</h3><p>åœ¨å‰é¢çš„è®²è§£å’Œç¤ºä¾‹ä¸­ï¼Œæ³›å‹å‚æ•°çš„çº¦æŸéƒ½æ˜¯ä¸€ä¸ªå®Œæ•´çš„æ¥å£ç±»å‹ï¼Œè¦ä¹ˆæ˜¯ç‹¬ç«‹å®šä¹‰åœ¨æ³›å‹å‡½æ•°å¤–é¢ï¼ˆæ¯”å¦‚ä¸‹é¢ä»£ç ä¸­çš„Iæ¥å£ï¼‰ï¼Œè¦ä¹ˆä»¥æ¥å£å­—é¢å€¼çš„å½¢å¼ï¼Œç›´æ¥æ”¾åœ¨ç±»å‹å‚æ•°åˆ—è¡¨ä¸­å¯¹ç±»å‹å‚æ•°è¿›è¡Œçº¦æŸï¼Œæ¯”å¦‚ä¸‹é¢ç¤ºä¾‹ä¸­doSomething2ç±»å‹å‚æ•°åˆ—è¡¨ä¸­çš„æ¥å£ç±»å‹å­—é¢å€¼ï¼š</p><pre><code class=\"language-plain\">type I interface { // ç‹¬ç«‹äºæ³›å‹å‡½æ•°å¤–é¢å®šä¹‰\n    ~int | ~string\n}\n\nfunc doSomething1[T I](t T)\nfunc doSomething2[T interface{~int | ~string}](t T) // ä»¥æ¥å£ç±»å‹å­—é¢å€¼ä½œä¸ºçº¦æŸ\n</code></pre><p>ä½†åœ¨<strong>çº¦æŸå¯¹åº”çš„æ¥å£ç±»å‹ä¸­ä»…æœ‰ä¸€ä¸ªæ¥å£å…ƒç´ ï¼Œä¸”è¯¥å…ƒç´ ä¸ºç±»å‹å…ƒç´ </strong>æ—¶ï¼ŒGoæä¾›äº†ç®€åŒ–ç‰ˆçš„çº¦æŸå½¢å¼ï¼Œæˆ‘ä»¬ä¸å¿…å°†çº¦æŸç‹¬ç«‹å®šä¹‰ä¸ºä¸€ä¸ªæ¥å£ç±»å‹ï¼Œæ¯”å¦‚ä¸Šé¢çš„doSomething2å¯ä»¥ç®€å†™ä¸ºä¸‹é¢ç®€åŒ–å½¢å¼ï¼š</p><pre><code class=\"language-plain\">func doSomething2[T ~int | ~string](t T) // ç®€åŒ–ç‰ˆçš„çº¦æŸå½¢å¼\n</code></pre><p>ä½ çœ‹ï¼Œè¿™ä¸ªç®€åŒ–ç‰ˆçš„çº¦æŸå½¢å¼å°±æ˜¯å»æ‰äº†interfaceå…³é”®å­—å’Œå¤–å›´çš„å¤§æ‹¬å·ï¼Œå¦‚æœç”¨ä¸€ä¸ªä¸€èˆ¬å½¢å¼æ¥è¡¨è¿°ï¼Œé‚£å°±æ˜¯ï¼š</p><pre><code class=\"language-plain\">func doSomething[T interface {T1 | T2 | ... | Tn}](t T)\n\nç­‰ä»·äºä¸‹é¢ç®€åŒ–ç‰ˆçš„çº¦æŸå½¢å¼ï¼š\n\nfunc doSomething[T T1 | T2 | ... | Tn](t T) \n</code></pre><p>è¿™ç§ç®€åŒ–å½¢å¼ä¹Ÿå¯ä»¥ç†è§£ä¸ºä¸€ç§ç±»å‹çº¦æŸçš„è¯­æ³•ç³–ã€‚ä¸è¿‡æœ‰ä¸€ç§æƒ…å†µè¦æ³¨æ„ï¼Œé‚£å°±æ˜¯å®šä¹‰ä»…åŒ…å«ä¸€ä¸ªç±»å‹å‚æ•°çš„æ³›å‹ç±»å‹æ—¶ï¼Œå¦‚æœ<strong>çº¦æŸä¸­ä»…æœ‰ä¸€ä¸ª*intå‹ç±»å‹å…ƒç´ </strong>ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸Šè¿°ç®€åŒ–ç‰ˆå½¢å¼å°±ä¼šæœ‰é—®é¢˜ï¼Œæ¯”å¦‚ï¼š</p><pre><code class=\"language-plain\">type MyStruct [T * int]struct{} // ç¼–è¯‘é”™è¯¯ï¼šundefined: T\n                                // ç¼–è¯‘é”™è¯¯ï¼šint (type) is not an expression\n</code></pre><p>å½“é‡åˆ°è¿™ç§æƒ…å†µæ—¶ï¼ŒGoç¼–è¯‘å™¨ä¼šå°†è¯¥è¯­å¥ç†è§£ä¸ºä¸€ä¸ªç±»å‹å£°æ˜ï¼šMyStructä¸ºæ–°ç±»å‹çš„åå­—ï¼Œè€Œå…¶åº•å±‚ç±»å‹ä¸º [T * int]struct{}ï¼Œå³ä¸€ä¸ªå…ƒç´ ä¸ºç©ºç»“æ„ä½“ç±»å‹çš„æ•°ç»„ã€‚</p><p>é‚£ä¹ˆæ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿç›®å‰æœ‰ä¸¤ç§æ–¹æ¡ˆï¼Œä¸€ç§æ˜¯ç”¨å®Œæ•´å½¢å¼çš„çº¦æŸï¼š</p><pre><code class=\"language-plain\">type MyStruct[T interface{*int}] struct{} \n</code></pre><p>å¦å¤–ä¸€ç§åˆ™æ˜¯åœ¨ç®€åŒ–ç‰ˆçº¦æŸçš„ *int ç±»å‹åé¢åŠ ä¸Šä¸€ä¸ªé€—å·ï¼š</p><pre><code class=\"language-plain\">type MyStruct[T *int,] struct{} \n</code></pre><p>æœ€åæˆ‘ä»¬å†æ¥è¯´è¯´ä¸çº¦æŸæœ‰å…³çš„ç±»å‹æ¨æ–­ã€‚</p><h3>çº¦æŸçš„ç±»å‹æ¨æ–­</h3><p>åœ¨ä¸Šä¸€è®²ä¸­ï¼Œæˆ‘ä»¬æåˆ°äº†åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ä½¿ç”¨ç±»å‹æ¨æ–­é¿å…åœ¨è°ƒç”¨æ³›å‹å‡½æ•°æ—¶æ˜¾å¼ä¼ å…¥ç±»å‹å®å‚ï¼ŒGoæ³›å‹å¯ä»¥æ ¹æ®æ³›å‹å‡½æ•°çš„å®å‚æ¨æ–­å‡ºç±»å‹å®å‚ã€‚ä½†å½“æˆ‘ä»¬é‡åˆ°ä¸‹é¢ç¤ºä¾‹ä¸­çš„æ³›å‹å‡½æ•°æ—¶ï¼Œå…‰ä¾é å‡½æ•°ç±»å‹å®å‚çš„æ¨æ–­æ˜¯æ— æ³•å®Œå…¨æ¨æ–­å‡ºæ‰€æœ‰ç±»å‹å®å‚çš„ï¼š</p><pre><code class=\"language-plain\">func DoubleDefined[S ~[]E, E constraints.Integer](s S) S {\n</code></pre><p>å› ä¸ºåƒDoubleDefinedè¿™æ ·çš„æ³›å‹å‡½æ•°ï¼Œå…¶ç±»å‹å‚æ•°Eåœ¨å…¶å¸¸è§„å‚æ•°åˆ—è¡¨ä¸­å¹¶æœªè¢«ç”¨æ¥å£°æ˜è¾“å…¥å‚æ•°ï¼Œå‡½æ•°ç±»å‹å®å‚æ¨æ–­ä»…èƒ½æ ¹æ®ä¼ å…¥çš„Sçš„ç±»å‹ï¼Œæ¨æ–­å‡ºç±»å‹å‚æ•°Sçš„ç±»å‹å®å‚ï¼ŒEæ˜¯æ— æ³•æ¨æ–­å‡ºæ¥çš„ã€‚</p><p>æ‰€ä»¥ä¸ºäº†è¿›ä¸€æ­¥é¿å…å¼€å‘è€…æ˜¾å¼ä¼ å…¥ç±»å‹å®å‚ï¼ŒGoæ³›å‹æ”¯æŒäº†çº¦æŸç±»å‹æ¨æ–­ï¼ˆconstraint type inferenceï¼‰ï¼Œå³åŸºäºä¸€ä¸ªå·²çŸ¥çš„ç±»å‹å®å‚ï¼ˆå·²ç»ç”±å‡½æ•°ç±»å‹å®å‚æ¨æ–­åˆ¤æ–­å‡ºæ¥äº†ï¼‰ï¼Œæ¥æ¨æ–­å…¶ä»–ç±»å‹å‚æ•°çš„ç±»å‹ã€‚</p><p>æˆ‘ä»¬è¿˜ä»¥ä¸Šé¢DoubleDefinedè¿™ä¸ªæ³›å‹å‡½æ•°ä¸ºä¾‹ï¼Œå½“é€šè¿‡å®å‚æ¨æ–­å¾—åˆ°ç±»å‹Såï¼ŒGoä¼šå°è¯•å¯åŠ¨çº¦æŸç±»å‹æ¨æ–­æ¥æ¨æ–­ç±»å‹å‚æ•°Eçš„ç±»å‹ã€‚ä½†ä½ å¯èƒ½ä¹Ÿçœ‹å‡ºæ¥äº†ï¼Œçº¦æŸç±»å‹æ¨æ–­å¯æˆåŠŸåº”ç”¨çš„å‰ææ˜¯ <strong>Sæ˜¯ç”±Eæ‰€è¡¨ç¤ºçš„</strong>ã€‚</p><h3>å°ç»“</h3><p>å¥½äº†ï¼Œä»Šå¤©çš„è¯¾è®²åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œç°åœ¨æˆ‘ä»¬ä¸€èµ·æ¥å›é¡¾ä¸€ä¸‹å§ã€‚</p><p>è¿™ä¸€è®²æˆ‘ä»¬èšç„¦åœ¨Goæ³›å‹çš„ä¸€ä¸ªéš¾ç‚¹ï¼Œçº¦æŸä¸Šé¢ã€‚æˆ‘ä»¬å…ˆä»Goæ³›å‹å†…ç½®çš„çº¦æŸanyå’Œcomparableå…¥æ‰‹ï¼Œå……åˆ†äº†è§£äº†çº¦æŸå¯¹äºæ³›å‹å‡½æ•°çš„ç±»å‹å‚æ•°ä»¥åŠæ³›å‹å‡½æ•°ä¸­çš„å®ç°ä»£ç çš„é™åˆ¶ä¸å½±å“ã€‚ç„¶åï¼Œæˆ‘ä»¬å­¦ä¹ å¦‚ä½•è‡ªå®šä¹‰çº¦æŸï¼ŒçŸ¥é“äº†å› ä¸ºGoä¸æ”¯æŒæ“ä½œç¬¦é‡è½½ï¼Œå•çº¯ä¾èµ–åŸºäºè¡Œä¸ºçš„æ¥å£ç±»å‹(ä»…åŒ…å«æ–¹æ³•å…ƒç´ )ä½œçº¦æŸæ˜¯æ— æ³•æ»¡è¶³æ³›å‹å‡½æ•°çš„è¦æ±‚çš„ã€‚è¿™æ ·æˆ‘ä»¬è¿›ä¸€æ­¥å­¦ä¹ äº†Goæ¥å£ç±»å‹çš„æ‰©å±•è¯­æ³•ï¼šæ”¯æŒç±»å‹å…ƒç´ ã€‚</p><p>æ—¢æœ‰æ–¹æ³•å…ƒç´ ï¼Œä¹Ÿæœ‰ç±»å‹å…ƒç´ ï¼Œå¯¹äºä½œä¸ºçº¦æŸçš„éåŸºæœ¬æ¥å£ç±»å‹ï¼Œæˆ‘ä»¬å°±ä¸èƒ½åƒä»¥å‰é‚£æ ·ä»…å‡­æ˜¯å¦å®ç°æ–¹æ³•é›†åˆæ¥åˆ¤æ–­æ˜¯å¦å®ç°äº†è¯¥æ¥å£ï¼Œæ–°çš„åˆ¤å®šæ‰‹æ®µä¸º<strong>ç±»å‹é›†åˆ</strong>ã€‚</p><p>ç±»å‹é›†åˆå¹¶æ²¡æœ‰æ”¹å˜ä»€ä¹ˆï¼Œåªæ˜¯å¯¹å“ªäº›ç±»å‹å®ç°äº†æŸæ¥å£ç±»å‹è¿›è¡Œäº†é‡æ–°è§£é‡Šã€‚å¹¶ä¸”ï¼Œç±»å‹é›†åˆä¸æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶æ¦‚å¿µï¼Œæˆ‘ä»¬ç›®å‰è¿˜æ— æ³•é€šè¿‡è¿è¡Œæ—¶åå°„ç›´è§‚çœ‹åˆ°ä¸€ä¸ªæ¥å£ç±»å‹çš„ç±»å‹é›†åˆæ˜¯ä»€ä¹ˆï¼</p><p>Goå†…ç½®äº†åƒanyã€comparableçš„çº¦æŸï¼Œåç»­éšç€Goæ ¸å¿ƒå›¢é˜Ÿåœ¨Goæ³›å‹ä½¿ç”¨ä¸Šçš„ç»éªŒçš„é€æ¸ä¸°å¯Œï¼ŒGoæ ‡å‡†åº“ä¸­ä¼šå¢åŠ æ›´å¤šå¯ç›´æ¥ä½¿ç”¨çš„çº¦æŸã€‚åŸè®¡åˆ’åœ¨Go 1.18ç‰ˆæœ¬åŠ å…¥Goæ ‡å‡†åº“çš„ä¸€äº›æ³›å‹çº¦æŸçš„å®šä¹‰æš‚æ”¾åœ¨äº† <a href=\"https://github.com/golang/exp/blob/master/constraints/constraints.go\">Goå®éªŒä»“åº“</a>ä¸­ï¼Œä½ å¯ä»¥è‡ªè¡Œå‚è€ƒã€‚</p><h3>æ€è€ƒé¢˜</h3><p>åœ¨typeset.goé‚£ä¸ªç¤ºä¾‹ä¸­ï¼Œå¦‚æœå°†Intf1ç”±ï¼š</p><pre><code class=\"language-plain\">type Intf1 interface {\n    ~int | string\n\tF1()\n\tF2()\n}\n</code></pre><p>æ”¹ä¸ºï¼š</p><pre><code class=\"language-plain\">type Intf1 interface {\n    int | string\n\tF1()\n\tF2()\n}\n</code></pre><p>é‚£ä¹ˆæ¥å£ç±»å‹Içš„ç±»å‹é›†åˆå˜æˆäº†ä»€ä¹ˆå‘¢ï¼Ÿè¯·ä½ æ€è€ƒä¸€ä¸‹ã€‚</p>","comments":[{"had_liked":false,"id":365730,"user_name":"Geek14","can_delete":false,"product_type":"c1","uid":3253178,"ip_address":"åŒ—äº¬","ucode":"5EE9F880685800","user_header":"","comment_is_top":false,"comment_ctime":1672932966,"is_pvip":false,"replies":[{"id":133214,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1672974899,"ip_address":"åŒ—äº¬","comment_id":365730,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"type Intf1 interface {\n    int | string\n  F1()  F2()\n}\nIntf1çš„ç±»å‹é›†åˆæ˜¯ä¸ªç©ºé›†åˆã€‚å› ä¸ºintå’Œstringéƒ½æ²¡æœ‰å®ç°F1å’ŒF2æ–¹æ³•ã€‚\nä»»ä½•é›†åˆä¸ç©ºé›†åˆæ±‚äº¤é›†ç»“æœè¿˜æ˜¯ç©ºé›†åˆã€‚æ‰€æœ‰Içš„ç±»å‹é›†åˆä¹Ÿæ˜¯ç©ºé›†åˆã€‚","like_count":4},{"had_liked":false,"id":366646,"user_name":"æ’•å½±","can_delete":false,"product_type":"c1","uid":3222094,"ip_address":"æ¹–å—","ucode":"8DC169F8B8E653","user_header":"https://static001.geekbang.org/account/avatar/00/31/2a/4e/a3f53cae.jpg","comment_is_top":false,"comment_ctime":1674012214,"is_pvip":false,"replies":[{"id":133605,"content":"çœ‹çš„å¾ˆç»†è‡´ğŸ‘ã€‚åç»­è¿™ä¸ªå»ºè®®æˆ‘è®©ç¼–è¾‘è€å¸ˆæ›´æ–°ä¸€ä¸‹ï¼ŒåŠ ä¸Šâ€œä»¥string ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹â€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1674102934,"ip_address":"åŒ—äº¬","comment_id":366646,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"int | ~string | Intf2 çš„ç±»å‹é›†åˆï¼š{ä»¥ int ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹ï¼Œä»¥ float64 ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹}\nè¿™ä¸€å¥åº”è¯¥åŠ ä¸Š â€œä»¥string ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹â€\nè¿™é‡Œä¸åŠ ä¸Šä½†ä¼šå¯¹è¯»è€…ç†è§£é€ æˆéšœç¢\nä¸åŠ ä¸Šä¹Ÿä¸å½±å“æœ€ç»ˆç¼–è¯‘ç»“æœ\n~stringæ˜¯è¢«å¤–å±‚æ±‚äº¤é›†æ“ä½œå‰”é™¤çš„ï¼ˆåªå‰©stringæœ¬èº«,ä½†æ˜¯stringæœ¬èº«ä½œä¸ºåŸºæœ¬ç±»å‹åˆä¸èƒ½ä½œä¸ºæ–¹æ³•çš„receiver:ï¼‰","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598653,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672974899,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":379038,"user_name":"lesserror","can_delete":false,"product_type":"c1","uid":1351076,"ip_address":"å¹¿ä¸œ","ucode":"25A54D1165FCF6","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","comment_is_top":false,"comment_ctime":1691173481,"is_pvip":false,"replies":[{"id":138132,"content":"1. typoï¼Œåº”ä¸ºç±»å‹é›†åˆçš„å¹¶é›†ã€‚ç¨åè®©ç¼–è¾‘è€å¸ˆæ”¹ä¸€ä¸‹ï¼Œæ„Ÿè°¢å‘ç°ã€‚\n2. å¯¹çš„ã€‚å› ä¸º Intf2 ä¸­çš„ ï½int åŒ…å«è¿™é‡Œçš„ int ç±»å‹ï¼Œæ‰€ä»¥å¹¶é›†ä¸­å¹¶æ²¡æœ‰å‡ºç° int","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1691400309,"ip_address":"åŒ—äº¬","comment_id":379038,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"Tony bai è€å¸ˆï¼Œæœ‰å‡ ä¸ªå‡ ä¸ªé—®é¢˜ï¼š\n\n1. æ–‡ä¸­è¯´ï¼šâ€œå®ƒçš„ç±»å‹é›†åˆä¸º intã€~string å’Œ Intf2 æ–¹æ³•é›†åˆçš„å¹¶é›†â€ï¼Œè¿™é‡Œ Intf2 æ–¹æ³•ï¼Œè¿™é‡Œçš„æ–¹æ³•è¯¥æ€ä¹ˆç†è§£ï¼Œè¿™é‡Œçš„ Intf2 ä¸æ˜¯ä¸€ä¸ªåªå«æœ‰ç±»å‹å…ƒç´ çš„æ¥å£å—ï¼Ÿ\n\n2. æ–‡ä¸­ï¼šâ€œ int | ~string | Intf2 çš„ç±»å‹é›†åˆï¼š{ä»¥ int ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹ï¼Œä»¥ float64 ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹ï¼Œä»¥ string ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹}ã€‚â€  è¿™é‡Œæ²¡æœ‰åŒ…å« intï¼Œæ˜¯å› ä¸º Intf2 ä¸­çš„ ï½int åŒ…å«è¿™é‡Œçš„ int ç±»å‹ï¼Œæ‰€ä»¥å¹¶é›†ä¸­å¹¶æ²¡æœ‰å‡ºç° intï¼Œæ˜¯è¿™æ ·çš„å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600197,"discussion_content":"çœ‹çš„å¾ˆç»†è‡´ğŸ‘ã€‚åç»­è¿™ä¸ªå»ºè®®æˆ‘è®©ç¼–è¾‘è€å¸ˆæ›´æ–°ä¸€ä¸‹ï¼ŒåŠ ä¸Šâ€œä»¥string ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹â€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1674102935,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":363392,"user_name":"Sunrise","can_delete":false,"product_type":"c1","uid":2820643,"ip_address":"ç¾å›½","ucode":"791BC042992385","user_header":"https://static001.geekbang.org/account/avatar/00/2b/0a/23/c26f4e50.jpg","comment_is_top":false,"comment_ctime":1669622940,"is_pvip":false,"replies":[{"id":132114,"content":"æˆ‘ç†è§£ï¼š ä½¿ç”¨&lt;&gt;å¯¹äºä¸€äº›æƒ…å†µæ˜¯æ— è§£çš„ã€‚è€Œä½¿ç”¨[ ]å°½ç®¡æœ‰äº›æ—¶å€™ä¹Ÿä¼šæ¨¡æ£±ä¸¤å¯ï¼Œä½†è‡³å°‘è¿˜æœ‰è§£ï¼Œæ¯”å¦‚ä¸Šé¢çš„æƒ…å†µã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1669700681,"ip_address":"ç¾å›½","comment_id":363392,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"è¿˜æ˜¯æä¸æ‡‚ä¸ºå•¥ go æ³›å‹ç”¨ä¸­æ‹¬å·è¡¨ç¤ºè€Œä¸ç”¨&lt;&gt;ï¼Œå¦‚æœå•çº¯ä¸ºäº†é¿å…å’Œå°äºå·å¤§äºå·å†²çªé‚£ä¹ˆä¸‹é¢ä¸ä¹Ÿå†²çªäº†å—\ntype MyStruct [T * int]struct{} &#47;&#47; ç¼–è¯‘é”™è¯¯ï¼šundefined: T &#47;&#47; ç¼–è¯‘é”™è¯¯ï¼šint (type) is not an expression\nè¿™å—å¦‚æœç”¨&lt;&gt;è¡¨ç¤ºä¸å°±å¯ä»¥é¿å…äº†å—","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":595059,"discussion_content":"æˆ‘ç†è§£ï¼š ä½¿ç”¨&lt;&gt;å¯¹äºä¸€äº›æƒ…å†µæ˜¯æ— è§£çš„ã€‚è€Œä½¿ç”¨[ ]å°½ç®¡æœ‰äº›æ—¶å€™ä¹Ÿä¼šæ¨¡æ£±ä¸¤å¯ï¼Œä½†è‡³å°‘è¿˜æœ‰è§£ï¼Œæ¯”å¦‚ä¸Šé¢çš„æƒ…å†µã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1669700681,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ç¾å›½","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":393295,"user_name":"Geek_73c432","can_delete":false,"product_type":"c1","uid":2869118,"ip_address":"å¹¿ä¸œ","ucode":"3E11EB02B14DE0","user_header":"","comment_is_top":false,"comment_ctime":1723385706,"is_pvip":false,"replies":[{"id":142866,"content":"ä»¥ int ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹ä¸­åŒ…æ‹¬intï¼Œæ‰€ä»¥äº¤é›†ä¸æ˜¯ç©ºé›†å“¦ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1723708944,"ip_address":"åŒ—äº¬","comment_id":393295,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"è€å¸ˆï¼Œæ€è€ƒé¢˜æˆ‘æ²¡æœ‰æ˜ç™½ï¼ŒIntf1 çš„ç±»å‹é›†åˆä¸æ˜¯ {intã€stringã€å®ç°äº† F1 å’Œ F2 æ–¹æ³•çš„æ‰€æœ‰ç±»å‹} å—ï¼Ÿ\n{ä»¥ int ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹} ä¸ {int} çš„äº¤é›†æ˜¯ç©ºé›†è¿˜æ˜¯ {int} ?","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":649662,"discussion_content":"ä»¥ int ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹ä¸­åŒ…æ‹¬intï¼Œæ‰€ä»¥äº¤é›†ä¸æ˜¯ç©ºé›†å“¦ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1723708944,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361811,"user_name":"ç½—æ°","can_delete":false,"product_type":"c1","uid":1320487,"ip_address":"åŒ—äº¬","ucode":"96BAFAA147341F","user_header":"https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg","comment_is_top":false,"comment_ctime":1667885541,"is_pvip":false,"replies":[{"id":131658,"content":"å°‘æ•²äº†8ä¸ªå­—æ¯å‘¢:)ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1667988457,"ip_address":"åŒ—äº¬","comment_id":361811,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"æ–°é¡¹ç›®å·²ç»ä½¿ç”¨1.19äº†ï¼Œçœ‹æ¥è‡³å°‘ä¸è¦å†ç”¨ interface{}ï¼Œè¿˜æ˜¯ any ç›´è§‚ã€‚","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593181,"discussion_content":"å°‘æ•²äº†8ä¸ªå­—æ¯å‘¢:)ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667988457,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1603004,"avatar":"https://static001.geekbang.org/account/avatar/00/18/75/bc/89d88775.jpg","nickname":"Calvin","note":"","ucode":"0EEF5B207623B5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593025,"discussion_content":"å¸Œæœ›ç©ºç»“æ„ä½“ struct{} ä¹Ÿæœ‰ä¸€ä¸ªåˆ«åæ¥è¡¨ç¤ºï¼Œä¾‹å¦‚ emptyï¼Œå“ˆå“ˆã€‚ğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667891974,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1320487,"avatar":"https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg","nickname":"ç½—æ°","note":"","ucode":"96BAFAA147341F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1603004,"avatar":"https://static001.geekbang.org/account/avatar/00/18/75/bc/89d88775.jpg","nickname":"Calvin","note":"","ucode":"0EEF5B207623B5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593086,"discussion_content":"Go çš„åŸåˆ™æ˜¯å°½å¯èƒ½ä¸åŠ å…³é”®è¯ï¼Œæ‰€ä»¥è¿™ä¸ªåº”è¯¥æš‚æ—¶ä¸ä¼šæœ‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667951595,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":593025,"ip_address":"é™•è¥¿","group_id":0},"score":593086,"extra":""}]}]},{"had_liked":false,"id":366645,"user_name":"æ’•å½±","can_delete":false,"product_type":"c1","uid":3222094,"ip_address":"æ¹–å—","ucode":"8DC169F8B8E653","user_header":"https://static001.geekbang.org/account/avatar/00/31/2a/4e/a3f53cae.jpg","comment_is_top":false,"comment_ctime":1674011609,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"int | ~string | Intf2 çš„ç±»å‹é›†åˆï¼š{ä»¥ int ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹ï¼Œä»¥ float64 ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹}\næ˜¯ä¸æ˜¯è¿˜åº”è¯¥åŠ ä¸Š\nâ€œä»¥ string ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹â€ ï¼Ÿ","like_count":0},{"had_liked":false,"id":362305,"user_name":"wu526","can_delete":false,"product_type":"c1","uid":1022129,"ip_address":"é‡åº†","ucode":"69282EB175B48E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/98/b1/f89a84d0.jpg","comment_is_top":false,"comment_ctime":1668407308,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"ä¸æ”¯æŒ type MyInt int è¿™ç§åŸºäºintä¸ºåº•å±‚æ•°æ®çš„ç±»å‹","like_count":0},{"had_liked":false,"id":365730,"user_name":"Geek14","can_delete":false,"product_type":"c1","uid":3253178,"ip_address":"åŒ—äº¬","ucode":"5EE9F880685800","user_header":"","comment_is_top":false,"comment_ctime":1672932966,"is_pvip":false,"replies":[{"id":133214,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1672974899,"ip_address":"åŒ—äº¬","comment_id":365730,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"type Intf1 interface {\n    int | string\n  F1()  F2()\n}\nIntf1çš„ç±»å‹é›†åˆæ˜¯ä¸ªç©ºé›†åˆã€‚å› ä¸ºintå’Œstringéƒ½æ²¡æœ‰å®ç°F1å’ŒF2æ–¹æ³•ã€‚\nä»»ä½•é›†åˆä¸ç©ºé›†åˆæ±‚äº¤é›†ç»“æœè¿˜æ˜¯ç©ºé›†åˆã€‚æ‰€æœ‰Içš„ç±»å‹é›†åˆä¹Ÿæ˜¯ç©ºé›†åˆã€‚","like_count":4,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598653,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672974899,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":366646,"user_name":"æ’•å½±","can_delete":false,"product_type":"c1","uid":3222094,"ip_address":"æ¹–å—","ucode":"8DC169F8B8E653","user_header":"https://static001.geekbang.org/account/avatar/00/31/2a/4e/a3f53cae.jpg","comment_is_top":false,"comment_ctime":1674012214,"is_pvip":false,"replies":[{"id":133605,"content":"çœ‹çš„å¾ˆç»†è‡´ğŸ‘ã€‚åç»­è¿™ä¸ªå»ºè®®æˆ‘è®©ç¼–è¾‘è€å¸ˆæ›´æ–°ä¸€ä¸‹ï¼ŒåŠ ä¸Šâ€œä»¥string ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹â€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1674102934,"ip_address":"åŒ—äº¬","comment_id":366646,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"int | ~string | Intf2 çš„ç±»å‹é›†åˆï¼š{ä»¥ int ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹ï¼Œä»¥ float64 ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹}\nè¿™ä¸€å¥åº”è¯¥åŠ ä¸Š â€œä»¥string ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹â€\nè¿™é‡Œä¸åŠ ä¸Šä½†ä¼šå¯¹è¯»è€…ç†è§£é€ æˆéšœç¢\nä¸åŠ ä¸Šä¹Ÿä¸å½±å“æœ€ç»ˆç¼–è¯‘ç»“æœ\n~stringæ˜¯è¢«å¤–å±‚æ±‚äº¤é›†æ“ä½œå‰”é™¤çš„ï¼ˆåªå‰©stringæœ¬èº«,ä½†æ˜¯stringæœ¬èº«ä½œä¸ºåŸºæœ¬ç±»å‹åˆä¸èƒ½ä½œä¸ºæ–¹æ³•çš„receiver:ï¼‰","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600197,"discussion_content":"çœ‹çš„å¾ˆç»†è‡´ğŸ‘ã€‚åç»­è¿™ä¸ªå»ºè®®æˆ‘è®©ç¼–è¾‘è€å¸ˆæ›´æ–°ä¸€ä¸‹ï¼ŒåŠ ä¸Šâ€œä»¥string ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹â€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1674102935,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":379038,"user_name":"lesserror","can_delete":false,"product_type":"c1","uid":1351076,"ip_address":"å¹¿ä¸œ","ucode":"25A54D1165FCF6","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","comment_is_top":false,"comment_ctime":1691173481,"is_pvip":false,"replies":[{"id":138132,"content":"1. typoï¼Œåº”ä¸ºç±»å‹é›†åˆçš„å¹¶é›†ã€‚ç¨åè®©ç¼–è¾‘è€å¸ˆæ”¹ä¸€ä¸‹ï¼Œæ„Ÿè°¢å‘ç°ã€‚\n2. å¯¹çš„ã€‚å› ä¸º Intf2 ä¸­çš„ ï½int åŒ…å«è¿™é‡Œçš„ int ç±»å‹ï¼Œæ‰€ä»¥å¹¶é›†ä¸­å¹¶æ²¡æœ‰å‡ºç° int","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1691400309,"ip_address":"åŒ—äº¬","comment_id":379038,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"Tony bai è€å¸ˆï¼Œæœ‰å‡ ä¸ªå‡ ä¸ªé—®é¢˜ï¼š\n\n1. æ–‡ä¸­è¯´ï¼šâ€œå®ƒçš„ç±»å‹é›†åˆä¸º intã€~string å’Œ Intf2 æ–¹æ³•é›†åˆçš„å¹¶é›†â€ï¼Œè¿™é‡Œ Intf2 æ–¹æ³•ï¼Œè¿™é‡Œçš„æ–¹æ³•è¯¥æ€ä¹ˆç†è§£ï¼Œè¿™é‡Œçš„ Intf2 ä¸æ˜¯ä¸€ä¸ªåªå«æœ‰ç±»å‹å…ƒç´ çš„æ¥å£å—ï¼Ÿ\n\n2. æ–‡ä¸­ï¼šâ€œ int | ~string | Intf2 çš„ç±»å‹é›†åˆï¼š{ä»¥ int ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹ï¼Œä»¥ float64 ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹ï¼Œä»¥ string ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹}ã€‚â€  è¿™é‡Œæ²¡æœ‰åŒ…å« intï¼Œæ˜¯å› ä¸º Intf2 ä¸­çš„ ï½int åŒ…å«è¿™é‡Œçš„ int ç±»å‹ï¼Œæ‰€ä»¥å¹¶é›†ä¸­å¹¶æ²¡æœ‰å‡ºç° intï¼Œæ˜¯è¿™æ ·çš„å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":625140,"discussion_content":"1. typoï¼Œåº”ä¸ºç±»å‹é›†åˆçš„å¹¶é›†ã€‚ç¨åè®©ç¼–è¾‘è€å¸ˆæ”¹ä¸€ä¸‹ï¼Œæ„Ÿè°¢å‘ç°ã€‚\n2. å¯¹çš„ã€‚å› ä¸º Intf2 ä¸­çš„ ï½int åŒ…å«è¿™é‡Œçš„ int ç±»å‹ï¼Œæ‰€ä»¥å¹¶é›†ä¸­å¹¶æ²¡æœ‰å‡ºç° int","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1691400309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":363392,"user_name":"Sunrise","can_delete":false,"product_type":"c1","uid":2820643,"ip_address":"ç¾å›½","ucode":"791BC042992385","user_header":"https://static001.geekbang.org/account/avatar/00/2b/0a/23/c26f4e50.jpg","comment_is_top":false,"comment_ctime":1669622940,"is_pvip":false,"replies":[{"id":132114,"content":"æˆ‘ç†è§£ï¼š ä½¿ç”¨&lt;&gt;å¯¹äºä¸€äº›æƒ…å†µæ˜¯æ— è§£çš„ã€‚è€Œä½¿ç”¨[ ]å°½ç®¡æœ‰äº›æ—¶å€™ä¹Ÿä¼šæ¨¡æ£±ä¸¤å¯ï¼Œä½†è‡³å°‘è¿˜æœ‰è§£ï¼Œæ¯”å¦‚ä¸Šé¢çš„æƒ…å†µã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1669700681,"ip_address":"ç¾å›½","comment_id":363392,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"è¿˜æ˜¯æä¸æ‡‚ä¸ºå•¥ go æ³›å‹ç”¨ä¸­æ‹¬å·è¡¨ç¤ºè€Œä¸ç”¨&lt;&gt;ï¼Œå¦‚æœå•çº¯ä¸ºäº†é¿å…å’Œå°äºå·å¤§äºå·å†²çªé‚£ä¹ˆä¸‹é¢ä¸ä¹Ÿå†²çªäº†å—\ntype MyStruct [T * int]struct{} &#47;&#47; ç¼–è¯‘é”™è¯¯ï¼šundefined: T &#47;&#47; ç¼–è¯‘é”™è¯¯ï¼šint (type) is not an expression\nè¿™å—å¦‚æœç”¨&lt;&gt;è¡¨ç¤ºä¸å°±å¯ä»¥é¿å…äº†å—","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":625140,"discussion_content":"1. typoï¼Œåº”ä¸ºç±»å‹é›†åˆçš„å¹¶é›†ã€‚ç¨åè®©ç¼–è¾‘è€å¸ˆæ”¹ä¸€ä¸‹ï¼Œæ„Ÿè°¢å‘ç°ã€‚\n2. å¯¹çš„ã€‚å› ä¸º Intf2 ä¸­çš„ ï½int åŒ…å«è¿™é‡Œçš„ int ç±»å‹ï¼Œæ‰€ä»¥å¹¶é›†ä¸­å¹¶æ²¡æœ‰å‡ºç° int","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1691400309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":393295,"user_name":"Geek_73c432","can_delete":false,"product_type":"c1","uid":2869118,"ip_address":"å¹¿ä¸œ","ucode":"3E11EB02B14DE0","user_header":"","comment_is_top":false,"comment_ctime":1723385706,"is_pvip":false,"replies":[{"id":142866,"content":"ä»¥ int ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹ä¸­åŒ…æ‹¬intï¼Œæ‰€ä»¥äº¤é›†ä¸æ˜¯ç©ºé›†å“¦ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1723708944,"ip_address":"åŒ—äº¬","comment_id":393295,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"è€å¸ˆï¼Œæ€è€ƒé¢˜æˆ‘æ²¡æœ‰æ˜ç™½ï¼ŒIntf1 çš„ç±»å‹é›†åˆä¸æ˜¯ {intã€stringã€å®ç°äº† F1 å’Œ F2 æ–¹æ³•çš„æ‰€æœ‰ç±»å‹} å—ï¼Ÿ\n{ä»¥ int ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹} ä¸ {int} çš„äº¤é›†æ˜¯ç©ºé›†è¿˜æ˜¯ {int} ?","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":595059,"discussion_content":"æˆ‘ç†è§£ï¼š ä½¿ç”¨&lt;&gt;å¯¹äºä¸€äº›æƒ…å†µæ˜¯æ— è§£çš„ã€‚è€Œä½¿ç”¨[ ]å°½ç®¡æœ‰äº›æ—¶å€™ä¹Ÿä¼šæ¨¡æ£±ä¸¤å¯ï¼Œä½†è‡³å°‘è¿˜æœ‰è§£ï¼Œæ¯”å¦‚ä¸Šé¢çš„æƒ…å†µã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1669700681,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ç¾å›½","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361811,"user_name":"ç½—æ°","can_delete":false,"product_type":"c1","uid":1320487,"ip_address":"åŒ—äº¬","ucode":"96BAFAA147341F","user_header":"https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg","comment_is_top":false,"comment_ctime":1667885541,"is_pvip":false,"replies":[{"id":131658,"content":"å°‘æ•²äº†8ä¸ªå­—æ¯å‘¢:)ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1667988457,"ip_address":"åŒ—äº¬","comment_id":361811,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"æ–°é¡¹ç›®å·²ç»ä½¿ç”¨1.19äº†ï¼Œçœ‹æ¥è‡³å°‘ä¸è¦å†ç”¨ interface{}ï¼Œè¿˜æ˜¯ any ç›´è§‚ã€‚","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":649662,"discussion_content":"ä»¥ int ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹ä¸­åŒ…æ‹¬intï¼Œæ‰€ä»¥äº¤é›†ä¸æ˜¯ç©ºé›†å“¦ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1723708944,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":366645,"user_name":"æ’•å½±","can_delete":false,"product_type":"c1","uid":3222094,"ip_address":"æ¹–å—","ucode":"8DC169F8B8E653","user_header":"https://static001.geekbang.org/account/avatar/00/31/2a/4e/a3f53cae.jpg","comment_is_top":false,"comment_ctime":1674011609,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"int | ~string | Intf2 çš„ç±»å‹é›†åˆï¼š{ä»¥ int ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹ï¼Œä»¥ float64 ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹}\næ˜¯ä¸æ˜¯è¿˜åº”è¯¥åŠ ä¸Š\nâ€œä»¥ string ä¸ºåº•å±‚ç±»å‹çš„æ‰€æœ‰ç±»å‹â€ ï¼Ÿ","like_count":0},{"had_liked":false,"id":362305,"user_name":"wu526","can_delete":false,"product_type":"c1","uid":1022129,"ip_address":"é‡åº†","ucode":"69282EB175B48E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/98/b1/f89a84d0.jpg","comment_is_top":false,"comment_ctime":1668407308,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"ä¸æ”¯æŒ type MyInt int è¿™ç§åŸºäºintä¸ºåº•å±‚æ•°æ®çš„ç±»å‹","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593181,"discussion_content":"å°‘æ•²äº†8ä¸ªå­—æ¯å‘¢:)ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667988457,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1603004,"avatar":"https://static001.geekbang.org/account/avatar/00/18/75/bc/89d88775.jpg","nickname":"Calvin","note":"","ucode":"0EEF5B207623B5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593025,"discussion_content":"å¸Œæœ›ç©ºç»“æ„ä½“ struct{} ä¹Ÿæœ‰ä¸€ä¸ªåˆ«åæ¥è¡¨ç¤ºï¼Œä¾‹å¦‚ emptyï¼Œå“ˆå“ˆã€‚ğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667891974,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1320487,"avatar":"https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg","nickname":"ç½—æ°","note":"","ucode":"96BAFAA147341F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1603004,"avatar":"https://static001.geekbang.org/account/avatar/00/18/75/bc/89d88775.jpg","nickname":"Calvin","note":"","ucode":"0EEF5B207623B5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593086,"discussion_content":"Go çš„åŸåˆ™æ˜¯å°½å¯èƒ½ä¸åŠ å…³é”®è¯ï¼Œæ‰€ä»¥è¿™ä¸ªåº”è¯¥æš‚æ—¶ä¸ä¼šæœ‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667951595,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":593025,"ip_address":"é™•è¥¿","group_id":0},"score":593086,"extra":""}]}]}]}