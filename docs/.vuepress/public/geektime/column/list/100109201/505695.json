{"id":505695,"title":"10ï½œå•å…ƒæµ‹è¯•ï¼ˆä¸€ï¼‰ï¼šåŸæ¥æµ‹è¯•å¯ä»¥è¿™ä¹ˆé«˜æ•ˆ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æŸ³èƒœã€‚</p><p>æåˆ°å•å…ƒæµ‹è¯•ï¼Œä½ å¯èƒ½ç¬¬ä¸€ååº”æ˜¯ï¼Œè¿™ä¸ªä¸æ˜¯å½’å¼€å‘åšä¹ˆï¼Ÿä½œä¸ºæµ‹è¯•çš„ä½ ï¼Œä¸ºä»€ä¹ˆä¸ä½†è¦æ‡‚UIã€æ¥å£æµ‹è¯•ï¼Œè¿˜è¦äº†è§£å•å…ƒæµ‹è¯•å‘¢ï¼Ÿå­¦å®Œä»Šå¤©çš„å†…å®¹ï¼Œä½ ä¼šæœ‰è‡ªå·±çš„ç­”æ¡ˆã€‚</p><p>å…ˆä»ä¸€ä¸ªå¸¸è§çš„ä¸šåŠ¡åœºæ™¯è¯´èµ·ï¼Œå¼€å‘åŒå­¦åœ¨å®ç°OrderæœåŠ¡çš„æ—¶å€™ï¼Œéœ€è¦ä»£ç åŒ–ä¸€äº›ä¸šåŠ¡é€»è¾‘ã€‚æ¯”å¦‚å¤„ç†ä¸€ä¸ªè®¢å•ï¼Œè¦è®¡ç®—æ€»ä»·ã€ä¼˜æƒ æ‰£å‡ã€åº“å­˜æŸ¥éªŒç­‰ç­‰ã€‚</p><p>ç°åœ¨OrderæœåŠ¡çš„å¼€å‘æƒ³è¦æµ‹è¯•è‡ªå·±å†™çš„è¿™äº›ä»£ç æ˜¯å¦é¢„æœŸè¿è½¬ï¼Œä»–æœ€å…ˆæƒ³åˆ°çš„åŠæ³•å¯èƒ½æ˜¯ï¼ŒæŠŠOrderæœåŠ¡æ„å»ºå®Œè¿è¡Œèµ·æ¥ï¼Œå‘å®ƒå‘é€HTTP Request â€œPOST /api/v1/ordersâ€, ç„¶åæ£€æŸ¥è¿”å›çš„Responseå†…å®¹ï¼Œçœ‹æ˜¯ä¸æ˜¯è®¢å•å·²ç»å¦‚æœŸç”Ÿæˆã€‚</p><p>è¿™ä¸ªæ–¹æ³•å½“ç„¶ä¹Ÿèƒ½è¾¾åˆ°æµ‹è¯•ç›®æ ‡ï¼Œä½†æ˜¯ä½ å·²ç»å­¦ä¹ è¿‡äº†3KUåŸåˆ™ï¼Œå°±å¯ä»¥é—®å¼€å‘äººå‘˜ä¸€ä¸ªé—®é¢˜ â€œåŒæ ·çš„éªŒè¯ç›®æ ‡ï¼Œèƒ½ä¸èƒ½åœ¨ROIæ›´é«˜çš„å•å…ƒæµ‹è¯•é˜¶æ®µå®ç°ï¼Ÿâ€</p><p>ä½ çœ‹ï¼Œæµ‹è¯•äººå‘˜å’Œå¼€å‘äººå‘˜çš„å•å…ƒæµ‹è¯•å·¥ä½œè”ç³»èµ·æ¥äº†ï¼Œå®ƒä»¬ä¹‹å‰åœ¨å®è·µä¸­ä¸€ç›´æ˜¯ä¸å¤ªäº¤æµçš„ä¸¤ä¸ªé¢†åŸŸï¼Œç°åœ¨éœ€è¦ç›¸äº’é…åˆï¼ŒæœåŠ¡äºæµ‹è¯•çš„æ•´ä½“ç›®æ ‡ã€‚</p><p>è¿™ä¸€è®²ä¼šç”¨ä¸€ä¸ªFoodComeç³»ç»Ÿé‡Œçš„ä¸€ä¸ªOrderæœåŠ¡çš„ä»£ç ä½œä¸ºä¾‹å­ï¼Œå¸®ä½ æ‹æ¸…æ¥šå•å…ƒæµ‹è¯•èƒ½åšä»€ä¹ˆï¼Œæ€ä¹ˆåšã€‚</p><h2>åˆ¶å®šå•å…ƒæµ‹è¯•ç­–ç•¥</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹OrderæœåŠ¡çš„å†…éƒ¨ç»“æ„ï¼Œæˆ‘ç”»äº†ä¸€å¼ Classå…³ç³»å›¾æ¥å±•ç°å†…éƒ¨çš„é€»è¾‘ç»“æ„ã€‚</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/a8/d5/a8b99e099953efc87cf3e34104d413d5.jpg?wh=1920x967\" alt=\"å›¾ç‰‡\"></p><p>æˆ‘ä»¬å…ˆçœ‹å›¾é‡Œçš„è“è‰²è‰²å—ï¼Œé€šè¿‡è¿™äº”ä¸ªClasså°±èƒ½å®ç°OrderæœåŠ¡ã€‚</p><p>å®ƒä»¬æ˜¯è¿™æ ·åˆ†å·¥çš„ï¼š<strong>OrderController</strong>æ¥æ”¶Clientå‘æ¥çš„\"POST /api/v1/orders\" request,  äº¤ä¼ ç»™OrderService createOrderæ–¹æ³•å¤„ç†ï¼Œå†æŠŠç”Ÿæˆçš„è®¢å•ä¿¡æ¯å°è£…æˆResponseè¿”è¿˜ç»™Clientï¼›</p><p><strong>OrderService</strong>æ˜¯ä¸»è¦çš„ä¸šåŠ¡é€»è¾‘ç±»ï¼Œå®ƒçš„createOrderå®Œæˆäº†ä¸€ä¸ªè®¢å•åˆ›å»ºçš„æ‰€æœ‰å·¥ä½œï¼Œè®¡ç®—ä»·æ ¼ã€ä¼˜æƒ æ‰£å‡ï¼Œè°ƒç”¨<strong>AccountClient</strong>åšæ”¯ä»˜éªŒè¯ï¼Œè°ƒç”¨<strong>RestaurantClient</strong>åšé¤é¦†åº“å­˜æŸ¥éªŒã€‚è®¢å•ç”Ÿæˆåï¼Œå°±äº¤ç»™OrderRepositoryå»å†™DBç”Ÿæˆè®¢å•è®°å½•ã€‚</p><p><strong>OrderRepository</strong>å®ç°äº†å’ŒOrderè‡ªå¸¦çš„æ•°æ®åº“äº¤äº’ï¼Œè¯»å†™æ“ä½œã€‚</p><p>çŸ¥é“äº†è¿™äº›ï¼Œè¿˜æ— æ³•é©¬ä¸ŠåŠ¨å·¥å†™å•å…ƒæµ‹è¯•ä»£ç ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘æ¸…æ¥šåé¢è¿™å‡ ä»¶äº‹ã€‚</p><h3>éœ€è¦å†™å¤šå°‘ä¸ªTest Classï¼Ÿ</h3><p>è¿™é‡Œæˆ‘éœ€è¦äº¤ä»£ä¸€ä¸ªèƒŒæ™¯çŸ¥è¯†ï¼Œé‚£å°±æ˜¯å•å…ƒæµ‹è¯•é‡Œçš„â€œå•å…ƒâ€æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>å¦‚æœä½ é—®ä¸åŒçš„å¼€å‘äººå‘˜ï¼Œå¯èƒ½ä¼šå¾—åˆ°éå¸¸ä¸ä¸€æ ·çš„ç­”æ¡ˆã€‚åœ¨è¿‡ç¨‹è¯­è¨€é‡Œï¼Œæ¯”å¦‚Cã€è„šæœ¬è¯­è¨€ï¼Œå•å…ƒåº”è¯¥å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå•å…ƒæµ‹è¯•å°±æ˜¯è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼ŒéªŒè¯å®ƒçš„è¾“å‡ºã€‚è€Œé¢å‘å¯¹è±¡è¯­è¨€ï¼ŒC++æˆ–è€…Javaï¼Œå•å…ƒæ˜¯ä¸€ä¸ªProduction Classã€‚</p><p>FoodComeç³»ç»Ÿæ˜¯Javaé¢å‘å¯¹è±¡è¯­è¨€å¼€å‘çš„ï¼ŒåŒ…å«5ä¸ªProduction Classï¼Œåšå•å…ƒæµ‹è¯•ï¼Œæˆ‘ä»¬æŠŠè§„åˆ™è®¾å¾—ç®€å•ä¸€ç‚¹ï¼Œ<strong>å¼€å‘ä¸€ä¸ªTest Classå»æµ‹è¯•ä¸€ä¸ªProduction Classï¼Œä¿æŒä¸€å¯¹ä¸€çš„å…³ç³»</strong>ã€‚</p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¸€ä¸ªTest Classæœ‰å¤šä¸ªTest Methodã€‚æ¯ä¸ªMethodä¼šSetupå»ºç«‹Production Classçš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼ŒExecuteè°ƒç”¨Production Classçš„Methodï¼ŒAssertéªŒè¯è¾“å‡ºï¼ŒTearDowné”€æ¯ä¸Šä¸‹æ–‡ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e2/77/e28060bbe8048fdc76ca6612d9915877.jpg?wh=1920x889\" alt=\"å›¾ç‰‡\"></p><h3>å­¤ç«‹å‹è¿˜æ˜¯ç¤¾äº¤å‹ï¼Ÿ</h3><p>ä¸€ä¸ªTest Classå¯¹åº”ä¸€ä¸ªProduction Classçœ‹èµ·æ¥ç®€å•æ˜äº†ï¼Œä½†ç†æƒ³è™½ç„¶ç¾å¥½ï¼Œç°å®å´æ˜¯å¤æ‚çš„ã€‚åœ¨å®è·µä¸­ï¼Œå¾ˆå°‘æœ‰Production Classèƒ½ç‹¬ç«‹è¿è¡Œã€‚</p><p>æˆ‘ä»¬æ‹¿å‡ºOrderSereviceè¿™ä¸ªClassçš„æºä»£ç çœ‹ä¸€ä¸‹ï¼š</p><pre><code class=\"language-java\">public class OrderService {\n  //ä¾èµ–æ³¨å…¥OrderRepository, AccountClient, RestaurantClient\n  @Autowired\n  private OrderRepository orderRepository;\n  @Autowired\n  private AccountClient accountClient;\n  @Autowired\n  private RestaurantClient restaurantClient;\n  @Autowired\n  private OrderDomainEventPublisher orderAggregateEventPublisher;\n  public Order createOrder(OrderDetails orderDetails) {\n  //è°ƒç”¨restaurantClientéªŒè¯é¤é¦†æ˜¯å¦å­˜åœ¨\n  Restaurant restaurant = restaurantRepository.findById(orderDetails.getRestaurantID())\n            .orElseThrow(() \n            -&gt; new RestaurantNotFoundException(orderDetails.getRestaurantID()));\n  //è°ƒç”¨AccountClientéªŒè¯å®¢æˆ·æ”¯ä»˜ä¿¡æ¯æ˜¯å¦æœ‰æ•ˆ\n  .............\n  //ç»Ÿè®¡è®¢é¤å„ä¸ªæ¡ç›®ï¼Œæ ¹æ®ä¼˜æƒ ç­–ç•¥ï¼Œå¾—å‡ºè®¢å•ä»·æ ¼\n  float finalPrice = determineFinalPrice(orderDetails.getLineItems());\n  //ç”Ÿæˆè®¢å•\n  Order order = new Order(finalPrice,orderDetails);\n  //å†™å…¥æ•°æ®åº“\n  orderRepository.save(order);\n  return order;\n  }\n}\n</code></pre><p>çœ‹å®Œä»£ç ï¼Œæˆ‘ä»¬å‘ç°é—®é¢˜äº†ï¼ŒcreateOrderè¿è¡Œæ—¶ï¼Œéœ€è¦è°ƒç”¨AccountClientã€RestaurantClientå’ŒOrderRepositoryä¸‰ä¸ªClassï¼Œå¦‚æœå®ƒä»¬ä¸å·¥ä½œçš„è¯ï¼ŒcreateOrderå°±æ²¡æ³•æµ‹è¯•ã€‚</p><p>åœ¨å•å…ƒæµ‹è¯•é‡Œï¼Œè¿™3ä¸ªClasså«åšOrder Classçš„Dependencyï¼Œè¿™3ä¸ªClassè¿˜ä¼šæœ‰å„è‡ªçš„ä¾èµ–ï¼Œä»¥æ­¤é€’å½’ã€‚åˆ°æœ€åä½ ä¼šå‘ç°ï¼Œæƒ³æµ‹è¯•Order Classï¼Œéœ€è¦æ•´ä¸ªæœåŠ¡éƒ½è¦è¿è½¬èµ·æ¥ã€‚</p><p>æˆ‘æ‰“ä¸ªæ¯”æ–¹ï¼Œæ–¹ä¾¿ä½ ç†è§£ã€‚å°±åƒæœ¬æ¥ä½ åªæƒ³è¯·ä¸€ä¸ªæœ‹å‹æ¥æ´¾å¯¹ï¼Œç»“æœæœ‹å‹è¿˜å¸¦æ¥äº†ä»–çš„æœ‹å‹ï¼Œä»¥æ­¤ç±»æ¨ï¼Œä½ æœ€åå‘ç°ï¼Œç°åœºåæ»¡äº†ä½ ä¸è®¤è¯†çš„äººï¼Œè‡ªå·±çš„å¿ƒæƒ…å®Œå…¨è¢«æ¯æ‰äº†ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ‰ä¸¤ç§åº”å¯¹æ–¹æ³•ã€‚</p><p>ç¬¬ä¸€ç§å­¤ç«‹å‹ï¼Œæˆ‘åªå…³æ³¨æˆ‘çš„æµ‹è¯•ç›®æ ‡Classï¼Œè€ŒDependency Classä¸€å¾‹ç”¨Mockæ¥æ›¿ä»£ï¼ŒMockåªæ˜¯æ¨¡ä»¿ç®€å•çš„äº¤äº’ã€‚ç›¸å½“äºæˆ‘ç»™æ´¾å¯¹ç«‹ä¸‹ä¸€ä¸ªè§„çŸ©ï¼šå®¢äººä¸èƒ½å¸¦å®¢ï¼Œå¦‚æœéœ€è¦ï¼Œå°±å¸¦ä¸ªæœºå™¨äººæ¥ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/33/14/33d80dc58f0bd430184c686413cda914.jpg?wh=1920x864\" alt=\"å›¾ç‰‡\"></p><p>å¦ä¸€ç§æ˜¯ç¤¾äº¤å‹ï¼Œæˆ‘è¿˜æ˜¯å…³æ³¨æˆ‘çš„æµ‹è¯•ç›®æ ‡Classï¼Œä½†æ˜¯Depdency Classç”¨çœŸå®çš„ã€å·²ç»å®ç°å¥½çš„Classã€‚è¿™å°±å¥½æ¯”ï¼Œæˆ‘å‘Šè¯‰å¤§å®¶ï¼Œä½ ä»¬å…ˆç©ï¼Œç­‰ä½ ä»¬æ´¾å¯¹ç»“æŸï¼Œæˆ‘æœ€åå†å¼€ä¸ªåªæœ‰æˆ‘è‡ªå·±åœ¨çš„æ´¾å¯¹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/65/25/6561c6yy651cd072225d32ba42bf0c25.jpg?wh=1920x886\" alt=\"å›¾ç‰‡\"></p><p>ç¤¾äº¤å‹å’Œç‹¬ç«‹å‹å„æœ‰ä¼˜ç¼ºç‚¹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/db/68/db7e538918edfae3fc78de89de85c768.jpg?wh=1920x639\" alt=\"å›¾ç‰‡\"></p><p>ç‹¬ç«‹å‹çš„å¥½å¤„æ˜¯ç¡®å®ç‹¬ç«‹ï¼Œä¸å—ä¾èµ–å½±å“ï¼Œè€Œä¸”é€Ÿåº¦å¿«ï¼Œä½†æ˜¯ä½ è¦èŠ±è´¹æˆæœ¬æ¥å¼€å‘Mock Classã€‚</p><p>è€Œç¤¾äº¤å‹çš„å¥½å¤„æ˜¯æ²¡æœ‰ä»»ä½•å¼€å‘æˆæœ¬ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªæµ‹è¯•é¡ºåºçš„è·¯å¾„ä¾èµ–ï¼Œå…ˆæµ‹è¯•ä¾èµ–å°‘çš„Classï¼Œæœ€åæ‰èƒ½æµ‹è¯•ä¾èµ–æœ€å¤šçš„é‚£ä¸ªClassã€‚</p><p>åœ¨å®è·µä¸­ï¼Œå…¶å®æ²¡æœ‰ä¸€å®šè°å¥½çš„è¯´æ³•ï¼Œå°±çœ‹æ€ä¹ˆåšï¼Œæ›´åŠ å¿«æ·æ–¹ä¾¿ã€‚å¯¹äºOrderService Classæ¥è¯´ï¼Œæˆ‘ä»¬ä¸¤ç§ç­–ç•¥éƒ½ç”¨ã€‚</p><p>æˆ‘ä»¬ç”¨ç¤¾äº¤å‹å¤„ç†Dependency OrderRepositoryï¼Œä¹Ÿå°±æ˜¯å…ˆå¼€å‘æµ‹è¯•OrderRepository Classï¼Œå†æµ‹è¯•OrderService Classï¼Œä¸ºä»€ä¹ˆå‘¢ï¼ŸOrderRepositoryå’ŒOrderServiceåœ¨åŒä¸€ä¸ªå¾®æœåŠ¡å†…éƒ¨ï¼Œç”±åŒä¸€ä¸ªå¼€å‘å›¢é˜Ÿç”šè‡³åŒä¸€ä¸ªäººå¼€å‘ï¼Œå®Œå…¨ä¸ç”¨æ‹…å¿ƒä¾èµ–ä¼šé€ æˆå·¥ä½œé˜»å¡ã€‚</p><p>æˆ‘ä»¬ç”¨å­¤ç«‹å‹å¤„ç†Dependency AccountServiceå’ŒRestaurant Serviceï¼Œè‡ªå·±å¼€å‘Mock serviceï¼Œå› ä¸ºè¿™æ¶‰åŠåˆ°è·¨æœåŠ¡çš„ä¾èµ–ã€‚ç­‰åˆ«çš„å›¢é˜ŸAccountServiceå¼€å‘å®Œï¼Œæ‰èƒ½å¼€å§‹æµ‹è‡ªå·±çš„OrderServiceï¼Œè¿™æ ·çš„æƒ…å†µæˆ‘ä»¬ä¸èƒ½æ¥å—ã€‚</p><p>æœ€åæˆ‘ä»¬å¾—å‡ºOrderService Classçš„æµ‹è¯•ç­–ç•¥å›¾å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/0c/44/0c4eaaece99bec7b2815ea7e4e3cfa44.jpg?wh=3370x1519\" alt=\"\"></p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»å¤§æ¦‚æ‹æ¸…æ¥šOrderServiceçš„å•å…ƒæµ‹è¯•è¦åšå“ªäº›äº‹äº†ï¼Œå¯ä»¥åˆ†ä¸‰æ­¥èµ°ã€‚</p><p>1.å¼€å‘ä¸€ä¸ªOrderSerivceTestï¼Œæ¥æµ‹è¯•OrderServiceï¼›<br>\n2.å¼€å‘å‡ºæ¥OrderRepositoryï¼Œä½œä¸ºOrderServiceTestçš„çœŸå®æ³¨å…¥å¯¹è±¡ï¼›<br>\n3.å¼€å‘2ä¸ªMock Classï¼šAccountClientå’ŒRestaurantClientï¼Œè¾…åŠ©OrderServiceTestè¿è¡Œã€‚</p><p>â€œä¸‰æ­¥èµ°â€ç­–ç•¥å·²å®šå¥½ï¼Œä¸‹é¢å°±æ’¸èµ·è¢–å­åŠ æ²¹å¹²å§ã€‚</p><h2>OrderServiceçš„å•å…ƒæµ‹è¯•</h2><p>å›åˆ°è¿™ä¸€è®²å¼€å¤´çš„é‚£ä¸ªé—®é¢˜ â€œåŒæ ·çš„éªŒè¯ç›®æ ‡ï¼Œèƒ½ä¸èƒ½åœ¨ROIæ›´é«˜çš„å•å…ƒæµ‹è¯•é˜¶æ®µå®ç°ï¼Ÿâ€</p><h3>è¿™ä¸ªTestCaseèƒ½ä¸èƒ½åœ¨å•å…ƒæµ‹è¯•é˜¶æ®µåšï¼Ÿ</h3><p>OrderServiceæ˜¯OrderæœåŠ¡é‡Œä¸šåŠ¡é€»è¾‘æœ€å¤šçš„Classï¼Œå› ä¸ºå®ƒåŒ…åŠäº†åˆ›å»ºè®¢å•çš„æ‰€æœ‰å·¥ä½œã€‚æ‰€ä»¥æµ‹è¯•åˆ›å»ºè®¢å•å¯ä»¥ç²—ç•¥å’Œæµ‹è¯•OrderServiceåˆ’ç­‰å·ï¼Œé‚£æˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹OrderServiceTestæ€ä¹ˆå†™ã€‚</p><p>æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªåä¸ºOrderServiceTestçš„Classï¼Œåœ¨è¿™ä¸ªTest Classé‡Œï¼Œå®Œæˆå¯¹OrderServiceå¯¹è±¡çš„ç»„è£…ï¼Œå®ƒä¾èµ–çš„ä¸‰ä¸ªClassï¼Œé€šè¿‡æ„é€ å‡½æ•°çš„æ–¹å¼æ³¨å…¥åˆ°OrderServiceå¯¹è±¡é‡Œã€‚</p><pre><code class=\"language-java\">public class OrderServiceTest {\n  //å£°æ˜testéœ€è¦ç”¨åˆ°çš„å¯¹è±¡\n  private OrderService orderService;\n  private OrderRepository orderRepository;\n  private AccountClient accountClient;\n  private RestaurantClient restaurantClient;\n  @Before\n  public void setup() {\n    orderRepository = new OrderRespistory();  \n    //mock restaurantClientå¯¹è±¡                    \n    restaurantClient = mock(RestaurantClient.class);\n    //mock accountClientå¯¹è±¡\n    accountClient = mock(AccountClient.class);\n    //ç»„è£…è¢«æµ‹orderSerivceå¯¹è±¡\n    orderService = new OrderService(orderRepository, restaurantClientï¼ŒaccountClient);\n  }\n  @Test\n  public void shouldCreateOrder() {\n    //ç»„è£…è®¢å•å†…å®¹\n    OrderDetails orderDetails = OderDetails.builder()\n        .customerID(customerID)\n        .restaurantID(restaurantID)\n        .addItem(CHICKEN)\n        .addItem(BEEF)\n        .build();\n    Order order = orderService.createOrder(orderDetails);\n    //éªŒè¯orderæ˜¯å¦åœ¨æ•°æ®åº“é‡Œåˆ›å»ºæˆåŠŸ\n    verify(orderRepository).save(same(order));                             \n  }\n}\n</code></pre><p>ä¸Šé¢çš„æµ‹è¯•ä»£ç åŸºäºJunitè§„èŒƒå®ç°ï¼Œä¸ºäº†å¸®ä½ ç†è§£æµ‹è¯•çš„ä¸»è¦é€»è¾‘ï¼Œçœå»äº†ä¸€äº›å…³è”åº¦ä¸é«˜çš„ä»£ç ã€‚</p><p>OrderServiceTestè¿è¡Œæ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªOrderServiceå¯¹è±¡ã€‚æˆ‘ä»¬å…ˆæ„é€ å‡ºè®¢å•å†…å®¹OrderDetailsï¼ŒæŠŠå®ƒä½œä¸ºå‚æ•°ä¼ é€’åˆ°createOrderçš„æ–¹æ³•é‡Œã€‚createOrderæ–¹æ³•è¿è¡Œç»“æŸä¹‹åï¼Œé¢„æœŸç»“æœæ˜¯åœ¨æ•°æ®åº“é‡Œç”Ÿæˆä¸€æ¡è®¢å•è®°å½•ã€‚</p><p>è¿™ä¸ªä¸‹è®¢å•çš„TestCaseå¦‚æœé€šè¿‡UIæ¥æµ‹ï¼Œä½ éœ€è¦æ‰“å¼€é¡µé¢æ‰‹å·¥ã€ç™»å½•ã€è¾“å…¥è®¢å•ä¿¡æ¯ã€ç‚¹å‡»ä¸‹è®¢å•æŒ‰é’®ã€‚å†…å®¹å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/64/15/649baef02a7ed64ebd97c0534d607b15.jpg?wh=1920x1242\" alt=\"å›¾ç‰‡\"></p><p>ä¸‹è®¢å•TestCaseå¦‚æœé€šè¿‡æ¥å£æ¥æµ‹ï¼Œä½ éœ€è¦ç”Ÿæˆè®¢å•å†…å®¹æ•°æ®ï¼Œç„¶åå‘é€ä¸€ä¸ªPOSTè¯·æ±‚åˆ°â€œ/api/v1/ordersâ€ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/df/eb/df1564daa38c7bf4b08c92c9bfd9f4eb.jpg?wh=1920x737\" alt=\"å›¾ç‰‡\"></p><p>é‚£æˆ‘ä»¬æ¥å¯¹æ¯”ä¸€ä¸‹ï¼ŒåŒä¸€ä¸ªTestCaseï¼Œåœ¨å•å…ƒã€æ¥å£å’ŒUIä¸Šè¿è¡Œçš„æ•ˆæœå¦‚ä½•ï¼Ÿ</p><p><img src=\"https://static001.geekbang.org/resource/image/82/65/8209e0d25a7c06711138dce735ff2265.jpg?wh=1920x758\" alt=\"å›¾ç‰‡\"></p><p>å•å…ƒæµ‹è¯•èƒ½è¦†ç›–ä¸‹è®¢å•åŠŸèƒ½çš„å¤§éƒ¨åˆ†ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸”åˆæ—©åˆå¿«ï¼Œæ˜¯éå¸¸ç†æƒ³çš„è‡ªåŠ¨åŒ–æµ‹è¯•å®æ–½æˆªé¢ã€‚è¿™å†æ¬¡éªŒè¯äº†åœ¨<a href=\"https://time.geekbang.org/column/article/497405\">ç¬¬äºŒè®²</a>æˆ‘ä»¬å­¦è¿‡çš„3KUæµ‹è¯•é‡‘å­—å¡”ï¼šâ€œå•å…ƒæµ‹è¯•æ˜¯ROIæœ€é«˜çš„è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œè‡ªåŠ¨åŒ–æ¡ˆä¾‹åº”è¯¥æœ€å¤šã€‚â€</p><h3>æé«˜å•å…ƒæµ‹è¯•ROI</h3><p>æ—¢ç„¶å•å…ƒæµ‹è¯•åˆå¥½åˆå¿«ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸å¦¨æŠŠä¸€äº›è´¹åŠ›æ°”çš„æµ‹è¯•å·¥ä½œæŒªåˆ°è¿™ä¸€å±‚ã€‚å“ªäº›æµ‹è¯•æ¯”è¾ƒéº»çƒ¦å‘¢ï¼Ÿ</p><p>çº¿ä¸Šè´­ç‰©çš„åœºæ™¯å°±å¾ˆå…¸å‹ï¼Œä½ åœ¨ç½‘è´­æ—¶ä¸€å®šç”¨è¿‡ä¼˜æƒ åˆ¸ï¼Œè¿™äº›ä¼˜æƒ åˆ¸çš„ä½¿ç”¨æ¡ä»¶ååˆ†å¤æ‚ï¼šè¦çŸ¥é“åœ¨ä»€ä¹ˆæ—¶é—´ã€ä»€ä¹ˆå•†å“ä¼šæœ‰å¤šå¤§æŠ˜æ‰£ï¼Œè€Œä¸”ä¼˜æƒ åˆ¸è¿˜å­˜åœ¨å åŠ ä½¿ç”¨çš„æƒ…å†µï¼Œåˆæœ‰äº†å„ç§è§„åˆ™ï¼Œèƒ½æŠŠäººææ™•ã€‚ä½†ç”¨æˆ·å¯ä»¥æ™•ï¼Œå¹³å°å´ä¸èƒ½æ™•ï¼Œç”¨äº†ä¼˜æƒ åˆ¸ï¼Œæœ€ç»ˆç»“æœè¿˜è¦éå¸¸ç²¾å‡†åœ°ä¿è¯ç›ˆåˆ©ï¼Œä¸èƒ½äºã€‚</p><p>è¦æ˜¯åœ¨UIå±‚é¢æµ‹è¯•ä¼˜æƒ åˆ¸ï¼Œä½ éœ€è¦é‡å¤è¿è¡Œå¤§é‡çš„æµ‹è¯•æ•°æ®ï¼Œæ¥äº§ç”Ÿä¸åŒçš„ä¼˜æƒ æ¡ä»¶ï¼Œè¿™ä¸ªä»£ä»·æ˜¯é«˜æ˜‚çš„ã€‚</p><p>æ”¾åœ¨å•å…ƒæµ‹è¯•é‡Œï¼Œè¿™ä¸ªTestCaseå°±å¥½ç†è§£äº†ã€‚è´Ÿè´£ä»·æ ¼è®¡ç®—çš„æ˜¯OrderServiceé‡Œçš„determineFinalPriceæ–¹æ³•ï¼Œåœ¨determineFinalPriceé‡Œéœ€è¦è€ƒè™‘å’Œè®¡ç®—å„ç§ä¼˜æƒ æ¡ä»¶å’Œè§„åˆ™ï¼Œå†è¾“å‡ºä¸€ä¸ªæœ€ç»ˆä»·æ ¼ã€‚</p><p>å› æ­¤ï¼Œä¼˜æƒ åˆ¸åœ¨å•å…ƒæµ‹è¯•é‡Œï¼Œå°±è½¬æ¢æˆäº†å¯¹determineFinalPriceæ–¹æ³•çš„æµ‹è¯•ã€‚</p><p>æ€ä¹ˆæµ‹è¯•è¿™ä¸ªæ–¹æ³•å‘¢ï¼Ÿ æˆ‘ä»¬è¦æ„å»ºå¤šç»„OrderDetailsæ•°æ®ï¼Œä¼ åˆ°determineFinalPriceæ–¹æ³•é‡Œå»ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬ç”¨JUnitæµ‹è¯•æ¡†æ¶é‡Œçš„DataProvideræ¥å®Œæˆè¿™ä¸ªå·¥ä½œï¼š</p><pre><code class=\"language-java\">@DataProvider\npublic static Object[][] OrderDetails() {\n   return new Object[][]{\n      {1111,2222,\"ä½›è·³å¢™\"},\n      {1112,2223, \"çç ç¿¡ç¿ ç™½ç‰æ±¤\"}\n   };\n}\n\n@DataProvider(\"OrderDetails\")\n@Test\n  public void shouldCreateOrder(OrderDetails orderDetails) {\n    Order order = orderService.createOrder(orderDetails);\n    //éªŒè¯orderæ˜¯å¦åœ¨æ•°æ®åº“é‡Œåˆ›å»ºæˆåŠŸ\n    verify(orderRepository).save(same(order));                             \n  }\n</code></pre><p>å¯¹ç…§ä»£ç å¯ä»¥çœ‹åˆ°ï¼ŒTestæ–¹æ³•ä¸ŠåŠ äº†ä¸€ä¸ªæ³¨è§£@DataProviderï¼ŒæŒ‡å®šäº†Testæ–¹æ³•çš„å…¥å£å‚æ•°æ˜¯æ¥è‡ªäºä¸€ä¸ªåä¸ºOrderDetailsçš„æ•°æ®æºã€‚OrderDetailsæ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œå­˜å‚¨äº†å¤šæ¡OrderDetailsæ•°æ®ï¼Œæœ‰å¤šå°‘æ¡æ•°æ®ï¼Œå°±ä¼šè¿è¡Œå¤šå°‘æ¬¡Testæ–¹æ³•ã€‚</p><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦åœ¨UIä¸Šé‡å¤æäº¤è¡¨å•æ¥åšæµ‹è¯•äº†ï¼Œè¿™ä¸ªå·¥ä½œäº¤ç»™å•å…ƒæµ‹è¯•æ¥åšï¼Œåœ¨å‡ æ¯«ç§’å†…å°±å®Œæˆä¸Šåƒæ¡æµ‹è¯•æ•°æ®çš„æµ‹è¯•äº†ã€‚Oh Yeahï¼ŒåŸæ¥å•å…ƒæµ‹è¯•å¯ä»¥è¿™ä¹ˆCoolï¼</p><p>ç­‰ä»æ¿€åŠ¨ä¸­ç¼“è¿‡ç¥æ¥ï¼Œä½ å¯èƒ½è¿˜å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œä¸å¯¹ï¼Ÿä¸Šé¢çš„Testæ–¹æ³•å¥½åƒæ²¡æœ‰éªŒè¯è¾“å‡ºçš„ä»·æ ¼å‘€ï¼Ÿ</p><p>æ²¡é”™ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå›°éš¾ï¼ŒdetermineFinalPriceæ–¹æ³•å®é™…ä¸Šæ˜¯å®ç°äº†ä¸€ä¸ªä»·æ ¼è®¡ç®—çš„ç®—æ³•ï¼Œå®ƒä¼šæ ¹æ®è¾“å…¥è®¡ç®—è¾“å‡ºä¸€ä¸ªæ•°å€¼ï¼Œç®—æ³•æ€ä¹ˆæµ‹ï¼Ÿæ€ä¹ˆéªŒè¯å®ƒçš„è¾“å‡ºæ˜¯å¯¹çš„ï¼Œè¿˜æ˜¯é”™çš„ï¼Ÿ</p><p>è¿™ä¸ªé¢†åŸŸä¸šç•Œçš„åšæ³•å¾ˆä¸ä¸€æ ·ï¼Œæœ‰çš„ä¼šåœ¨æµ‹è¯•ä»£ç é‡ŒæŠŠç®—æ³•åˆå®ç°äº†ä¸€éï¼Œç„¶åå¾—å‡ºä¸€ä¸ªæ•°å€¼ä½œä¸ºé¢„æœŸå€¼ï¼Œè·Ÿå¼€å‘ä»£ç ç®—å‡ºæ¥çš„æ•°å€¼åšæ¯”å¯¹ã€‚</p><p>è¿™ç§åšæ³•å…¶å®æ˜¯é”™è¯¯çš„ï¼Œ<strong>å› ä¸ºæµ‹è¯•ä»£ç é‡ŒåŠ å…¥äº†è¢«æµ‹å•å…ƒçš„å®ç°ç»†èŠ‚ï¼ˆç®—æ³•é€»è¾‘ï¼‰</strong>ï¼Œä½ æœ¬æ¥æƒ³éªŒè¯äº§å“çº¿ç”Ÿäº§çš„äº§å“Aæ˜¯ä¸æ˜¯åˆæ ¼ï¼Œä½†ä½ é‡‡ç”¨åŠæ³•æ˜¯è®©äº§å“çº¿å†ç”Ÿäº§ä¸€ä¸ªäº§å“Bï¼Œæ¥æ¯”å¯¹Aå’ŒBï¼Œè¿™æ ·éªŒè¯æ²¡æœ‰æ„ä¹‰ï¼Œå› ä¸ºå¦‚æœäº§å“çº¿æœ¬èº«å°±æ˜¯æœ‰é—®é¢˜çš„ï¼ŒAå’ŒBéƒ½ä¼šæ˜¯é”™çš„ã€‚</p><p>ä¸šç•Œç»™è¿™æ ·çš„æµ‹è¯•èµ·äº†ä¸€ä¸ªåï¼Œå«â€œé¢†åŸŸçŸ¥è¯†æ³„æ¼â€ï¼Œä½ å¯ä»¥æœç´¢ä¸€ä¸‹â€œDomain Knowledge Leakageâ€ï¼Œä¼šå‘ç°å„ç§å„æ ·çš„æµ‹è¯•æ–¹æ³•é”™è¯¯ã€‚</p><p>æ­£ç¡®çš„åšæ³•æ˜¯ï¼Œä½ åº”è¯¥åªå…³æ³¨äº§å“Açš„åˆæ ¼æ ‡å‡†ï¼Œç”¨æ ‡å‡†æ¥æ£€æŸ¥Aå°±å¯ä»¥äº†ã€‚</p><p>åœ¨æˆ‘ä»¬çš„æƒ…æ™¯é‡Œï¼Œå¾ˆç®€å•ï¼ŒæŠŠdetermineFinalPriceçš„è¾“å…¥å‚æ•°å’Œè¾“å‡ºå‚æ•°éƒ½å†™å‡ºæ¥ï¼Œä½œä¸ºå¸¸é‡ã€‚åªè¦è¾“å…¥ä¸€ä¸ªx1,x2,x3, é‚£å°±ä¼šå¾—åˆ°yï¼Œç„¶åå°±ç”¨x1,x2,x3,yè¿™ä¸€ç»„æ•°æ®æ¥æµ‹è¯•determineFinalPriceæ–¹æ³•å°±å¯ä»¥ã€‚</p><p>ç°åœ¨ä½ å¯ä»¥æ€è€ƒä¸€ä¸‹ï¼Œä¸Šé¢çš„ä»£ç åº”è¯¥æ€ä¹ˆå˜åŠ¨ï¼Ÿç›¸ä¿¡ä½ å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä¹Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºæ™’ä¸€ä¸‹ä½ çš„â€œä½œä¸šâ€ã€‚</p><h2><strong>å°ç»“</strong></h2><p>å½“ä»Šï¼Œä¸šç•Œä¸€èˆ¬éƒ½ä¼šæŠŠå•å…ƒæµ‹è¯•åˆ’åˆ°å¼€å‘é¢†åŸŸï¼Œæ¥å£æµ‹è¯•å’ŒUIæµ‹è¯•åˆ’åˆ°æµ‹è¯•é¢†åŸŸï¼Œè¿™è®©ä¸¤ä¸ªé¢†åŸŸå¾ˆå°‘äº¤æµã€‚å¯¹äºæµ‹è¯•æ•´ä½“æ¥è¯´ï¼Œè¿™å°±å­˜åœ¨ç€é‡å å’Œèµ„æºæµªè´¹ã€‚</p><p>åšè‡ªåŠ¨åŒ–æµ‹è¯•çš„ä½ ï¼Œå…¶å®åº”è¯¥äº†è§£å•å…ƒæµ‹è¯•èƒ½åšä»€ä¹ˆï¼Œéƒ½åšäº†ä»€ä¹ˆï¼Œç”šè‡³ä½ åº”è¯¥è®¾è®¡å¥½æµ‹è¯•æ¡ˆä¾‹ï¼Œè®©å¼€å‘äººå‘˜å»å®ç°ã€‚å› ä¸ºä½ æ˜¯è‡ªåŠ¨åŒ–æµ‹è¯•çš„Ownerå’Œæ¶æ„å¸ˆï¼Œä½ åº”è¯¥å¯¹æ•´ä½“æ•ˆç›Šè´Ÿè´£ã€‚</p><p>å•å…ƒæµ‹è¯•é‡Œå¾ˆå¤šå†…å®¹ï¼šæ¡†æ¶çš„æ¥å£ã€Mockçš„å¼€å‘ã€Assertè¯­å¥çš„ä½¿ç”¨ç­‰ç­‰ï¼Œä¸€æœ¬ä¹¦éƒ½è®²ä¸å®Œã€‚ä»Šå¤©æˆ‘ä»¬é€šè¿‡FoodComeçš„ä»£ç é‡Œçš„ä¸€ä¸ªOrderServiceTestçš„å®ç°ï¼Œå­¦ä¹ äº†å•å…ƒæµ‹è¯•ç­–ç•¥ï¼Œä»¥ä¸€ä¸ªæµ‹è¯•æ•´ä½“çš„è§†è§’æ¥è§‚å¯Ÿå•å…ƒæµ‹è¯•èƒ½åšä»€ä¹ˆï¼Œåœ¨æ•´ä¸ªæµ‹è¯•æ–¹æ¡ˆé‡Œçš„åŠŸèƒ½ä½œç”¨ã€‚</p><p>é€šè¿‡è¿™ä¸€è®²ï¼Œä½ å¯ä»¥ç›´è§‚æ„Ÿå—åˆ°ï¼Œå•å…ƒæµ‹è¯•çš„ROIåˆé«˜ï¼Œé€Ÿåº¦åˆå¿«ã€‚ä½†åœ¨ç°å®ä¸­ï¼Œè¿™æ˜¯æµ‹è¯•äººå‘˜çš„ä¸€å—çŸ­æ¿ï¼Œä¹Ÿæ˜¯ç›¸å¯¹é™Œç”Ÿçš„é¢†åŸŸã€‚æ‰€ä»¥ï¼Œæˆ‘<a href=\"https://time.geekbang.org/column/article/506638\">ä¸‹ä¸€è®²</a>è¿˜ä¼šç»§ç»­å•å…ƒæµ‹è¯•çš„è¯é¢˜ï¼Œè°ˆè°ˆæ€æ ·æ¨åŠ¨å•å…ƒæµ‹è¯•çš„â€œå¯æµ‹è¯•æ€§â€ï¼Œæ•¬è¯·æœŸå¾…ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>å»äº†è§£ä¸€ä¸‹ä½ å¼€å‘å›¢é˜Ÿé‡Œæœ‰æ²¡æœ‰åšå•å…ƒæµ‹è¯•ï¼Œæœ‰çš„è¯éƒ½åšäº†ä»€ä¹ˆã€‚</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºå’Œæˆ‘äº¤æµäº’åŠ¨ï¼Œä¹Ÿæ¨èä½ æŠŠè¿™ä¸€è®²åˆ†äº«ç»™æ›´å¤šåŒäº‹ã€æœ‹å‹ï¼Œè¯´ä¸å®šå°±èƒ½é€šè¿‡å•å…ƒæµ‹è¯•æ¥è§£æ”¾åŒæ‰‹ï¼Œæé«˜å·¥ä½œæ•ˆç‡å•¦ã€‚</p>","neighbors":{"left":{"article_title":"å¼€ç¯‡è¯ | åšæ€§ä»·æ¯”æœ€é«˜çš„è‡ªåŠ¨åŒ–æµ‹è¯•","id":496850},"right":[]},"comments":[{"had_liked":false,"id":341534,"user_name":"å¤ªåŒ†åŒ†","can_delete":false,"product_type":"c1","uid":1628299,"ip_address":"","ucode":"2F3F273CB65F5D","user_header":"https://static001.geekbang.org/account/avatar/00/18/d8/8b/d81769bf.jpg","comment_is_top":false,"comment_ctime":1649680498,"is_pvip":false,"replies":[{"id":124811,"content":"é¢†åŸŸé€»è¾‘å¤æ‚è€Œé‡çš„è½¯ä»¶äº§å“ï¼Œä¸€å®šè¦åšå¥½å•å…ƒæµ‹è¯•ï¼Œç›®æ ‡æ˜¯æ˜ç¡®çš„ã€‚æ€ä¹ˆæ¨åŠ¨ï¼Œå¯ä»¥çµæ´»ä¸€ç‚¹ï¼Œå°Šé‡äººæ€§çš„è®¤çŸ¥è¿‡ç¨‹ï¼Œæ¯”å¦‚ï¼Œä½ å¯ä»¥æŠŠè€å¤§é‡è§†çš„bugå’Œå¼€å‘å›¢é˜Ÿè¿‡ä¸€éï¼Œè®¨è®ºä¸€ä¸‹è¿™äº›bugèƒ½å¤Ÿæœ€æ—©å‘ç°çš„é˜¶æ®µï¼Œè·å¾—å…±è¯†åï¼Œæ‰¾å°ä¸€å—å•å…ƒæµ‹è¯•çš„è¯•éªŒç”°ï¼Œè·å¾—å®è·µåï¼Œæ¨å¹¿åˆ°æ›´å¤§èŒƒå›´ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1877634,"ctime":1649728877,"ip_address":"","comment_id":341534,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100109201,"comment_content":"Oh Yeahï¼Œæœ‰å¤šå°‘å¼€å‘äººå‘˜æ„¿æ„åšå•å…ƒæµ‹è¯•ï¼Œåˆæœ‰å¤šå°‘é¡¹ç›®ç»ç†å…è®¸å¼€å‘äººå‘˜æœ‰æ—¶é—´å»åšå•å…ƒæµ‹è¯•","like_count":8,"discussions":[{"author":{"id":1877634,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/a6/82/791d0f5e.jpg","nickname":"æŸ³èƒœ","note":"","ucode":"50F35834586E4A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":561830,"discussion_content":"é¢†åŸŸé€»è¾‘å¤æ‚è€Œé‡çš„è½¯ä»¶äº§å“ï¼Œä¸€å®šè¦åšå¥½å•å…ƒæµ‹è¯•ï¼Œç›®æ ‡æ˜¯æ˜ç¡®çš„ã€‚æ€ä¹ˆæ¨åŠ¨ï¼Œå¯ä»¥çµæ´»ä¸€ç‚¹ï¼Œå°Šé‡äººæ€§çš„è®¤çŸ¥è¿‡ç¨‹ï¼Œæ¯”å¦‚ï¼Œä½ å¯ä»¥æŠŠè€å¤§é‡è§†çš„bugå’Œå¼€å‘å›¢é˜Ÿè¿‡ä¸€éï¼Œè®¨è®ºä¸€ä¸‹è¿™äº›bugèƒ½å¤Ÿæœ€æ—©å‘ç°çš„é˜¶æ®µï¼Œè·å¾—å…±è¯†åï¼Œæ‰¾å°ä¸€å—å•å…ƒæµ‹è¯•çš„è¯•éªŒç”°ï¼Œè·å¾—å®è·µåï¼Œæ¨å¹¿åˆ°æ›´å¤§èŒƒå›´ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649728877,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":341469,"user_name":"swordman","can_delete":false,"product_type":"c1","uid":1002980,"ip_address":"","ucode":"F6719BD5E20B37","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/e4/94b543c3.jpg","comment_is_top":false,"comment_ctime":1649646514,"is_pvip":false,"replies":[{"id":124812,"content":"ğŸ‘ æ­£ç¡®åˆå¹²å‡€ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1877634,"ctime":1649729030,"ip_address":"","comment_id":341469,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100109201,"comment_content":"@DataProvider\npublic static Object[][] FinalPrice() {\n   return new Object[][]{\n      {1111, 2222, &quot;ä½›è·³å¢™&quot;, 200, -20, 180},\n      {1112, 2223, &quot;çç ç¿¡ç¿ ç™½ç‰æ±¤&quot;, 100, -10, 90}\n   };\n}\n\n@DataProvider(&quot;FinalPrice&quot;)\n@Test\n  public void shouldFinalPrice(FinalPrice finalPrice) {\n    int price = orderService.determineFinalPrice(finalPrice);\n    &#47;&#47;éªŒè¯orderæ˜¯å¦åœ¨æ•°æ®åº“é‡Œåˆ›å»ºæˆåŠŸ\n    verify(æ¯”è¾ƒpriceå’ŒfinalPriceçš„æœ€åä¸€ä¸ªå¸¸é‡æ˜¯å¦ç›¸ç­‰);                             \n  }","like_count":8,"discussions":[{"author":{"id":1877634,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/a6/82/791d0f5e.jpg","nickname":"æŸ³èƒœ","note":"","ucode":"50F35834586E4A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":561832,"discussion_content":"ğŸ‘ æ­£ç¡®åˆå¹²å‡€ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649729030,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1330305,"avatar":"https://static001.geekbang.org/account/avatar/00/14/4c/81/34398512.jpg","nickname":"PCC","note":"","ucode":"BA27B7737E232B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":609542,"discussion_content":"ä½†æ˜¯å½“è¿™ä¸ªä»·æ ¼ç®—æ³•è¶³å¤Ÿå¤æ‚æ—¶ï¼Œæµ‹è¯•äººå‘˜ä¸ºäº†å¾—å‡º180è¿™ä¸ªé¢„æœŸçš„ä»·æ ¼yï¼ŒåŸºæœ¬ä¸Šä¹Ÿæ˜¯è¦ç”¨å…¶ä»–ç®—æ³•æˆ–å·¥å…·å†æŠŠè¿™ä¸ªä»·æ ¼è®¡ç®—é€»è¾‘å†å®ç°ä¸€éğŸ˜’","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1679019744,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1345640,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKubuofHB43wdIwvnWSIdL6YzfGZhic7abWu06ia8BwnMBDCbCFDIF1RQB4nN46Ldv6ALQf025E2mRA/132","nickname":"Geek_palmlan","note":"","ucode":"B62A6372CB6376","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1330305,"avatar":"https://static001.geekbang.org/account/avatar/00/14/4c/81/34398512.jpg","nickname":"PCC","note":"","ucode":"BA27B7737E232B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631004,"discussion_content":"æˆ‘ä¸ªäººå»ºè®®æµ‹è¯•å¯ä»¥é‡å¤å®ç°ç®—æ³•ï¼Œç”¨æ¥å¿«é€Ÿç»™å‡ºå¯ç”¨æµ‹è¯•é›†ï¼Œä½†ç”¨ä¾‹è¾“å…¥åº”è¯¥æ˜¯ä¸»è¦æ˜¯é™æ€çš„ï¼Œå³éªŒè¯è¿‡çš„è¾“å…¥ã€‚è€Œä¸æ˜¯ç›´æ¥ç»™åŠ¨æ€çš„è¾“å…¥ï¼Œé™¤éç®—æ³•é€»è¾‘è¶³å¤Ÿç®€å•ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1699232554,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":609542,"ip_address":"å¹¿ä¸œ","group_id":0},"score":631004,"extra":""}]},{"author":{"id":1823586,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/d3/62/791d0f5e.jpg","nickname":"é‘«å®","note":"","ucode":"60834DB676C8BD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":623047,"discussion_content":"æœ‰é“ç†ã€‚ ä½†æ˜¯å¦‚æœè¿™ä¸ªç®—æ³•ä¸€ç›´ä¸å˜çš„è¯ï¼Œåªéœ€è¦æ‰‹å·¥è®¡ç®—ä¸€æ¬¡ï¼Œå°±å¯ä»¥ä¸€ç›´ç”¨äº†ã€‚å½“ç„¶ï¼Œå¦‚æœç®—æ³•å˜çš„è¯ï¼Œ æµ‹è¯•ä»£ç æ˜¯è‚¯å®šè¦å˜çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1688972261,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":342536,"user_name":"Sarah","can_delete":false,"product_type":"c1","uid":2391650,"ip_address":"","ucode":"2B35D90CE51B8C","user_header":"https://static001.geekbang.org/account/avatar/00/24/7e/62/48045bee.jpg","comment_is_top":false,"comment_ctime":1650330668,"is_pvip":false,"replies":[{"id":125267,"content":"å¸Œæœ›èƒ½çœ‹åˆ°ä½ æ›´å¤šçš„åˆ†äº«ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1877634,"ctime":1650548869,"ip_address":"","comment_id":342536,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100109201,"comment_content":"åœ¨é¡¹ç›®ä¸­ä¸€ç›´åœ¨å®è·µå•å…ƒæµ‹è¯•å’ŒUIè‡ªåŠ¨åŒ–æµ‹è¯•ç»“åˆçš„æ–¹å¼è®©æ•´ä¸ªè‡ªåŠ¨åŒ–æµ‹è¯•æ›´é«˜æ•ˆï¼Œå•å…ƒæµ‹è¯•è¦†ç›–ç»†ç²’åº¦çš„åŠŸèƒ½å•å…ƒï¼ŒUIè‡ªåŠ¨åŒ–æ¥è¾¾åˆ°ä¸²èµ·æ•´ä¸ªç”¨æˆ·æµç¨‹çš„éªŒè¯","like_count":2,"discussions":[{"author":{"id":1877634,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/a6/82/791d0f5e.jpg","nickname":"æŸ³èƒœ","note":"","ucode":"50F35834586E4A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":565845,"discussion_content":"å¸Œæœ›èƒ½çœ‹åˆ°ä½ æ›´å¤šçš„åˆ†äº«ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650548870,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":346491,"user_name":"å¤©åšvipå®˜ç½‘ç½‘é¡µç‰ˆ","can_delete":false,"product_type":"c1","uid":1170752,"ip_address":"","ucode":"0D21F56EE1F2AC","user_header":"https://static001.geekbang.org/account/avatar/00/11/dd/40/904952ac.jpg","comment_is_top":false,"comment_ctime":1653196085,"is_pvip":false,"replies":[{"id":126665,"content":"å•å…ƒæµ‹è¯•æ˜¯åŠ¨æ€æµ‹è¯•ã€‚æ€ä¹ˆåŠ¨èµ·æ¥å‘¢ï¼Œæœ‰ä¸¤ç§æ€è·¯ï¼Œç¬¬ä¸€ç§æ€è·¯ï¼ŒSpringåº”ç”¨æœ¬èº«å°±æ˜¯æ³¨è§£é©±åŠ¨çš„ï¼Œå…ˆå¯åŠ¨åº”ç”¨ï¼Œå†å¯åŠ¨å•å…ƒæµ‹è¯•ã€‚å¦å¤–ä¸€ç§æ€è·¯å‘¢ï¼Œé€šè¿‡å•å…ƒæµ‹è¯•ï¼Œæ¥é©±åŠ¨è¢«æµ‹å•å…ƒï¼Œæ¯”å¦‚ç®—æ³•ï¼ŒUtilityç­‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1877634,"ctime":1654064181,"ip_address":"","comment_id":346491,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100109201,"comment_content":"OrderServiceçš„å•å…ƒæµ‹è¯•åº”è¯¥æ˜¯éœ€è¦æ‹‰èµ·æ•´ä¸ªé¡¹ç›®æ‰èƒ½è¿›è¡Œæµ‹å§ï¼Œæœ¬åœ°è·‘æ²¡åŠæ³•åŠ è½½Springæ³¨è§£å’Œé…ç½®æ–‡æ¡£ï¼Œè¿˜æ˜¯æœ‰å…¶ä»–çš„åŠæ³•ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1877634,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/a6/82/791d0f5e.jpg","nickname":"æŸ³èƒœ","note":"","ucode":"50F35834586E4A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":574437,"discussion_content":"å•å…ƒæµ‹è¯•æ˜¯åŠ¨æ€æµ‹è¯•ã€‚æ€ä¹ˆåŠ¨èµ·æ¥å‘¢ï¼Œæœ‰ä¸¤ç§æ€è·¯ï¼Œç¬¬ä¸€ç§æ€è·¯ï¼ŒSpringåº”ç”¨æœ¬èº«å°±æ˜¯æ³¨è§£é©±åŠ¨çš„ï¼Œå…ˆå¯åŠ¨åº”ç”¨ï¼Œå†å¯åŠ¨å•å…ƒæµ‹è¯•ã€‚å¦å¤–ä¸€ç§æ€è·¯å‘¢ï¼Œé€šè¿‡å•å…ƒæµ‹è¯•ï¼Œæ¥é©±åŠ¨è¢«æµ‹å•å…ƒï¼Œæ¯”å¦‚ç®—æ³•ï¼ŒUtilityç­‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654064181,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345091,"user_name":"On","can_delete":false,"product_type":"c1","uid":1526359,"ip_address":"","ucode":"E260187B398E15","user_header":"https://static001.geekbang.org/account/avatar/00/17/4a/57/3f68946c.jpg","comment_is_top":false,"comment_ctime":1652015917,"is_pvip":false,"replies":[{"id":126067,"content":"TDDæ˜¯Test Drive Developmentï¼Œæ˜¯æ–¹æ³•è®ºï¼Œå•å…ƒæµ‹è¯•æ˜¯TDDçš„å®ç°åŸºç¡€ã€‚TDDä¸€èˆ¬æŒ‡çš„æ˜¯å…ˆè®¾è®¡æµ‹è¯•æ¡ˆä¾‹ï¼Œå†å¼€å‘ä»£ç ï¼Œæ‰€ä»¥å«åšæµ‹è¯•é©±åŠ¨å¼€å‘ã€‚\néå¸¸ç†è§£æ‚¨çš„å·¥ä½œå®é™…ï¼Œå•å…ƒæµ‹è¯•å¿…é¡»è¦æ¨åŠ¨ï¼Œä½†æ˜¯ä»å“ªä¸ªåœ°æ–¹å…¥æ‰‹ï¼ŒèŒƒå›´å¤šå¤§ï¼Œå¯ä»¥è®²ç‚¹ç­–ç•¥ï¼Œçµæ´»ä¸€ç‚¹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1877634,"ctime":1652234245,"ip_address":"","comment_id":345091,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100109201,"comment_content":"å•å…ƒæµ‹è¯•æ˜¯å¿…é¡»å¾—åšçš„ï¼Œè™½ç„¶å®é™…æƒ…å†µæ˜¯è¿«äºäº¤ä»˜è¿›åº¦çš„å‹åŠ›æˆ–è€…å¼€å‘çš„ä¸è‰¯ä¹ æƒ¯ç­‰ç­‰åŸå› ï¼Œå•å…ƒæµ‹è¯•ä¸åšæˆ–è€…åšä¸åˆ°ä½ï¼Œç»™æµ‹è¯•å’Œé¡¹ç›®è´¨é‡åŸ‹ä¸‹ç¼ºé™·çš„éšæ‚£ã€‚è¿™é‡Œæƒ³åˆ°å¦ä¸€ä¸ªé—®é¢˜ï¼šå•å…ƒæµ‹è¯•å’Œtddåˆ°åº•æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿæ˜¯ä¸æ˜¯åè€…æ›´å½»åº•ã€æ›´èƒ½ä¿è¯å¼€å‘çš„ä»£ç çš„è´¨é‡ï¼ï¼Ÿè°¢è°¢ã€‚","like_count":1,"discussions":[{"author":{"id":1877634,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/a6/82/791d0f5e.jpg","nickname":"æŸ³èƒœ","note":"","ucode":"50F35834586E4A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571459,"discussion_content":"TDDæ˜¯Test Drive Developmentï¼Œæ˜¯æ–¹æ³•è®ºï¼Œå•å…ƒæµ‹è¯•æ˜¯TDDçš„å®ç°åŸºç¡€ã€‚TDDä¸€èˆ¬æŒ‡çš„æ˜¯å…ˆè®¾è®¡æµ‹è¯•æ¡ˆä¾‹ï¼Œå†å¼€å‘ä»£ç ï¼Œæ‰€ä»¥å«åšæµ‹è¯•é©±åŠ¨å¼€å‘ã€‚\néå¸¸ç†è§£æ‚¨çš„å·¥ä½œå®é™…ï¼Œå•å…ƒæµ‹è¯•å¿…é¡»è¦æ¨åŠ¨ï¼Œä½†æ˜¯ä»å“ªä¸ªåœ°æ–¹å…¥æ‰‹ï¼ŒèŒƒå›´å¤šå¤§ï¼Œå¯ä»¥è®²ç‚¹ç­–ç•¥ï¼Œçµæ´»ä¸€ç‚¹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652234245,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":368889,"user_name":"lisa","can_delete":false,"product_type":"c1","uid":1508049,"ip_address":"å¹¿ä¸œ","ucode":"62CB6333CBF7B6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLw3jpao45frZibQIAicWBfc7ofgrm5gJLiaFQSj5u2DDvkjy3ia5goicJLJlgVtZ0HryiaXb2VqpTSQT5Q/132","comment_is_top":false,"comment_ctime":1676868433,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100109201,"comment_content":"é¢†åŸŸçŸ¥è¯†æ³„æ¼å­˜åœ¨çš„å¾ˆå¤§åŸå› æ˜¯åœ¨è¿è¡ŒæŸä¸ªæµ‹è¯•ä¹‹å‰ï¼Œè¾“å…¥æ˜¯åœ¨è¿™æ¬¡æµ‹è¯•æ—¶æ‰ç¡®å®šï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨å†™æµ‹è¯•ç”¨ä¾‹çš„æ—¶å€™å¹¶çŸ¥é“è¾“å‡ºæ˜¯ä»€ä¹ˆï¼Œæ‰€ä»¥å°±æ²¡åŠæ³•ä¸€å¼€å§‹ç¡®å®šã€‚","like_count":2}]}