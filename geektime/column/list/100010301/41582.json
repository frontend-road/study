{"id":41582,"title":"36 | SubstrateVMï¼šAOTç¼–è¯‘æ¡†æ¶","content":"<p>ä»Šå¤©æˆ‘ä»¬æ¥èŠèŠGraalVMä¸­çš„Ahead-Of-Timeï¼ˆAOTï¼‰ç¼–è¯‘æ¡†æ¶SubstrateVMã€‚</p>\n<p>å…ˆæ¥ä»‹ç»ä¸€ä¸‹AOTç¼–è¯‘ï¼Œæ‰€è°“AOTç¼–è¯‘ï¼Œæ˜¯ä¸å³æ—¶ç¼–è¯‘ç›¸å¯¹ç«‹çš„ä¸€ä¸ªæ¦‚å¿µã€‚æˆ‘ä»¬çŸ¥é“ï¼Œå³æ—¶ç¼–è¯‘æŒ‡çš„æ˜¯åœ¨ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå°†å­—èŠ‚ç è½¬æ¢ä¸ºå¯åœ¨ç¡¬ä»¶ä¸Šç›´æ¥è¿è¡Œçš„æœºå™¨ç ï¼Œå¹¶éƒ¨ç½²è‡³æ‰˜ç®¡ç¯å¢ƒä¸­çš„è¿‡ç¨‹ã€‚</p>\n<p>è€ŒAOTç¼–è¯‘æŒ‡çš„åˆ™æ˜¯ï¼Œåœ¨<strong>ç¨‹åºè¿è¡Œä¹‹å‰</strong>ï¼Œä¾¿å°†å­—èŠ‚ç è½¬æ¢ä¸ºæœºå™¨ç çš„è¿‡ç¨‹ã€‚å®ƒçš„æˆæœå¯ä»¥æ˜¯éœ€è¦é“¾æ¥è‡³æ‰˜ç®¡ç¯å¢ƒä¸­çš„åŠ¨æ€å…±äº«åº“ï¼Œä¹Ÿå¯ä»¥æ˜¯ç‹¬ç«‹è¿è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</p>\n<p>ç‹­ä¹‰çš„AOTç¼–è¯‘é’ˆå¯¹çš„ç›®æ ‡ä»£ç éœ€è¦ä¸å³æ—¶ç¼–è¯‘çš„ä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯é’ˆå¯¹é‚£äº›åŸæœ¬å¯ä»¥è¢«å³æ—¶ç¼–è¯‘çš„ä»£ç ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç®€å•åœ°å°†AOTç¼–è¯‘ç†è§£ä¸ºç±»ä¼¼äºGCCçš„é™æ€ç¼–è¯‘å™¨ã€‚</p>\n<p>AOTç¼–è¯‘çš„ä¼˜ç‚¹æ˜¾è€Œæ˜“è§ï¼šæˆ‘ä»¬æ— é¡»åœ¨è¿è¡Œè¿‡ç¨‹ä¸­è€—è´¹CPUèµ„æºæ¥è¿›è¡Œå³æ—¶ç¼–è¯‘ï¼Œè€Œç¨‹åºä¹Ÿèƒ½å¤Ÿåœ¨å¯åŠ¨ä¼Šå§‹å°±è¾¾åˆ°ç†æƒ³çš„æ€§èƒ½ã€‚</p>\n<p>ç„¶è€Œï¼Œä¸å³æ—¶ç¼–è¯‘ç›¸æ¯”ï¼ŒAOTç¼–è¯‘æ— æ³•å¾—çŸ¥ç¨‹åºè¿è¡Œæ—¶çš„ä¿¡æ¯ï¼Œå› æ­¤ä¹Ÿæ— æ³•è¿›è¡ŒåŸºäºç±»å±‚æ¬¡åˆ†æçš„å®Œå…¨è™šæ–¹æ³•å†…è”ï¼Œæˆ–è€…åŸºäºç¨‹åºprofileçš„æŠ•æœºæ€§ä¼˜åŒ–ï¼ˆå¹¶éç¡¬æ€§é™åˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é™åˆ¶è¿è¡ŒèŒƒå›´ï¼Œæˆ–è€…åˆ©ç”¨ä¸Šä¸€æ¬¡è¿è¡Œçš„ç¨‹åºprofileæ¥ç»•å¼€è¿™ä¸¤ä¸ªé™åˆ¶ï¼‰ã€‚è¿™ä¸¤è€…éƒ½ä¼šå½±å“ç¨‹åºçš„å³°å€¼æ€§èƒ½ã€‚</p>\n<p>Java 9å¼•å…¥äº†å®éªŒæ€§AOTç¼–è¯‘å·¥å…·<a href=\"http://openjdk.java.net/jeps/295\">jaotc</a>ã€‚å®ƒå€ŸåŠ©äº†Graalç¼–è¯‘å™¨ï¼Œå°†æ‰€è¾“å…¥çš„Javaç±»æ–‡ä»¶è½¬æ¢ä¸ºæœºå™¨ç ï¼Œå¹¶å­˜æ”¾è‡³ç”Ÿæˆçš„åŠ¨æ€å…±äº«åº“ä¹‹ä¸­ã€‚</p><!-- [[[read_end]]] -->\n<p>åœ¨å¯åŠ¨è¿‡ç¨‹ä¸­ï¼ŒJavaè™šæ‹Ÿæœºå°†åŠ è½½å‚æ•°<code>-XX:AOTLibrary</code>æ‰€æŒ‡å®šçš„åŠ¨æ€å…±äº«åº“ï¼Œå¹¶éƒ¨ç½²å…¶ä¸­çš„æœºå™¨ç ã€‚è¿™äº›æœºå™¨ç çš„ä½œç”¨æœºç†å’Œå³æ—¶ç¼–è¯‘ç”Ÿæˆçš„æœºå™¨ç ä½œç”¨æœºç†ä¸€æ ·ï¼Œéƒ½æ˜¯åœ¨æ–¹æ³•è°ƒç”¨æ—¶åˆ‡å…¥ï¼Œå¹¶èƒ½å¤Ÿå»ä¼˜åŒ–è‡³è§£é‡Šæ‰§è¡Œã€‚</p>\n<p>ç”±äºJavaè™šæ‹Ÿæœºå¯èƒ½é€šè¿‡Java agentæˆ–è€…C agentæ”¹åŠ¨æ‰€åŠ è½½çš„å­—èŠ‚ç ï¼Œæˆ–è€…è¿™ä»½AOTç¼–è¯‘ç”Ÿæˆçš„æœºå™¨ç é’ˆå¯¹çš„æ˜¯æ—§ç‰ˆæœ¬çš„Javaç±»ï¼Œå› æ­¤å®ƒéœ€è¦é¢å¤–çš„éªŒè¯æœºåˆ¶ï¼Œæ¥ä¿è¯å³å°†é“¾æ¥çš„æœºå™¨ç çš„è¯­ä¹‰ä¸å¯¹åº”çš„Javaç±»çš„è¯­ä¹‰æ˜¯ä¸€è‡´çš„ã€‚</p>\n<p>jaotcä½¿ç”¨çš„æœºåˆ¶ä¾¿æ˜¯ç±»æŒ‡çº¹ï¼ˆclass fingerprintingï¼‰ã€‚å®ƒä¼šåœ¨åŠ¨æ€å…±äº«åº“ä¸­ä¿å­˜è¢«AOTç¼–è¯‘çš„Javaç±»çš„æ‘˜è¦ä¿¡æ¯ã€‚åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒJavaè™šæ‹Ÿæœºè´Ÿè´£å°†è¯¥æ‘˜è¦ä¿¡æ¯ä¸å·²åŠ è½½çš„Javaç±»ç›¸æ¯”è¾ƒï¼Œä¸€æ—¦ä¸åŒ¹é…ï¼Œåˆ™ç›´æ¥èˆå¼ƒè¿™ä»½AOTç¼–è¯‘çš„æœºå™¨ç ã€‚</p>\n<p>jaotcçš„ä¸€å¤§åº”ç”¨ä¾¿æ˜¯ç¼–è¯‘java.base moduleï¼Œä¹Ÿå°±æ˜¯Javaæ ¸å¿ƒç±»åº“ä¸­æœ€ä¸ºåŸºç¡€çš„ç±»ã€‚è¿™äº›ç±»å¾ˆæœ‰å¯èƒ½ä¼šè¢«åº”ç”¨ç¨‹åºæ‰€è°ƒç”¨ï¼Œä½†è°ƒç”¨é¢‘ç‡æœªå¿…é«˜åˆ°èƒ½å¤Ÿè§¦å‘å³æ—¶ç¼–è¯‘ã€‚</p>\n<p>å› æ­¤ï¼Œå¦‚æœJavaè™šæ‹Ÿæœºèƒ½å¤Ÿä½¿ç”¨AOTç¼–è¯‘æŠ€æœ¯ï¼Œå°†å®ƒä»¬æå‰ç¼–è¯‘ä¸ºæœºå™¨ç ï¼Œé‚£ä¹ˆå°†é¿å…åœ¨æ‰§è¡Œå³æ—¶ç¼–è¯‘ç”Ÿæˆçš„æœºå™¨ç æ—¶ï¼Œå› ä¸ºâ€œä¸å°å¿ƒâ€è°ƒç”¨åˆ°è¿™äº›åŸºç¡€ç±»ï¼Œè€Œéœ€è¦åˆ‡æ¢è‡³è§£é‡Šæ‰§è¡Œçš„æ€§èƒ½æƒ©ç½šã€‚</p>\n<p>ä¸è¿‡ï¼Œä»Šå¤©è¦ä»‹ç»çš„ä¸»è§’å¹¶éjaotcï¼Œè€Œæ˜¯åŒæ ·ä½¿ç”¨äº†Graalç¼–è¯‘å™¨çš„AOTç¼–è¯‘æ¡†æ¶SubstrateVMã€‚</p>\n<h2>SubstrateVMçš„è®¾è®¡ä¸å®ç°</h2>\n<p>SubstrateVMçš„è®¾è®¡åˆè¡·æ˜¯æä¾›ä¸€ä¸ªé«˜å¯åŠ¨æ€§èƒ½ã€ä½å†…å­˜å¼€é”€ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ— ç¼è¡”æ¥Cä»£ç çš„Javaè¿è¡Œæ—¶ã€‚å®ƒä¸jaotcçš„åŒºåˆ«ä¸»è¦æœ‰ä¸¤å¤„ã€‚</p>\n<p>ç¬¬ä¸€ï¼ŒSubstrateVMè„±ç¦»äº†HotSpotè™šæ‹Ÿæœºï¼Œå¹¶æ‹¥æœ‰ç‹¬ç«‹çš„è¿è¡Œæ—¶ï¼ŒåŒ…å«å¼‚å¸¸å¤„ç†ï¼ŒåŒæ­¥ï¼Œçº¿ç¨‹ç®¡ç†ï¼Œå†…å­˜ç®¡ç†ï¼ˆåƒåœ¾å›æ”¶ï¼‰å’ŒJNIç­‰ç»„ä»¶ã€‚</p>\n<p>ç¬¬äºŒï¼ŒSubstrateVMè¦æ±‚ç›®æ ‡ç¨‹åºæ˜¯å°é—­çš„ï¼Œå³ä¸èƒ½åŠ¨æ€åŠ è½½å…¶ä»–ç±»åº“ç­‰ã€‚åŸºäºè¿™ä¸ªå‡è®¾ï¼ŒSubstrateVMå°†æ¢ç´¢æ•´ä¸ªç¼–è¯‘ç©ºé—´ï¼Œå¹¶é€šè¿‡é™æ€åˆ†ææ¨ç®—å‡ºæ‰€æœ‰è™šæ–¹æ³•è°ƒç”¨çš„ç›®æ ‡æ–¹æ³•ã€‚æœ€ç»ˆï¼ŒSubstrateVMä¼šå°†æ‰€æœ‰å¯èƒ½æ‰§è¡Œåˆ°çš„æ–¹æ³•éƒ½çº³å…¥ç¼–è¯‘èŒƒå›´ä¹‹ä¸­ï¼Œä»è€Œå…äºå®ç°é¢å¤–çš„è§£é‡Šæ‰§è¡Œå™¨ã€‚</p>\n<blockquote>\n<p>æœ‰å…³SubstrateVMçš„å…¶ä»–é™åˆ¶ï¼Œä½ å¯ä»¥å‚è€ƒ<a href=\"https://github.com/oracle/graal/blob/master/substratevm/LIMITATIONS.md\">è¿™ç¯‡æ–‡æ¡£</a>ã€‚</p>\n</blockquote>\n<p>ä»æ‰§è¡Œæ—¶é—´ä¸Šæ¥åˆ’åˆ†ï¼ŒSubstrateVMå¯åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼šnative image generatorä»¥åŠSubstrateVMè¿è¡Œæ—¶ã€‚åè€…SubstrateVMè¿è¡Œæ—¶ä¾¿æ˜¯å‰é¢æåˆ°çš„ç²¾ç®€è¿è¡Œæ—¶ï¼Œç»è¿‡AOTç¼–è¯‘çš„ç›®æ ‡ç¨‹åºå°†è·‘åœ¨è¯¥è¿è¡Œæ—¶ä¹‹ä¸Šã€‚</p>\n<p>native image generatoråˆ™åŒ…å«äº†çœŸæ­£çš„AOTç¼–è¯‘é€»è¾‘ã€‚å®ƒæœ¬èº«æ˜¯ä¸€ä¸ªJavaç¨‹åºï¼Œå°†ä½¿ç”¨Graalç¼–è¯‘å™¨å°†Javaç±»æ–‡ä»¶ç¼–è¯‘ä¸ºå¯æ‰§è¡Œæ–‡ä»¶æˆ–è€…åŠ¨æ€é“¾æ¥åº“ã€‚</p>\n<p>åœ¨è¿›è¡Œç¼–è¯‘ä¹‹å‰ï¼Œnative image generatorå°†é‡‡ç”¨æŒ‡é’ˆåˆ†æï¼ˆpoints-to analysisï¼‰ï¼Œä»ç”¨æˆ·æä¾›çš„ç¨‹åºå…¥å£å‡ºå‘ï¼Œæ¢ç´¢æ‰€æœ‰å¯è¾¾çš„ä»£ç ã€‚åœ¨æ¢ç´¢çš„åŒæ—¶ï¼Œå®ƒè¿˜å°†æ‰§è¡Œåˆå§‹åŒ–ä»£ç ï¼Œå¹¶åœ¨æœ€ç»ˆç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œå°†å·²åˆå§‹åŒ–çš„å †ä¿å­˜è‡³ä¸€ä¸ªå †å¿«ç…§ä¹‹ä¸­ã€‚è¿™æ ·ä¸€æ¥ï¼ŒSubstrateVMå°†ç›´æ¥ä»ç›®æ ‡ç¨‹åºå¼€å§‹è¿è¡Œï¼Œè€Œæ— é¡»é‡å¤è¿›è¡ŒJavaè™šæ‹Ÿæœºçš„åˆå§‹åŒ–ã€‚</p>\n<p>SubstrateVMä¸»è¦ç”¨äºJavaè™šæ‹Ÿæœºè¯­è¨€çš„AOTç¼–è¯‘ï¼Œä¾‹å¦‚Javaã€Scalaä»¥åŠKotlinã€‚Truffleè¯­è¨€å®ç°æœ¬è´¨ä¸Šå°±æ˜¯Javaç¨‹åºï¼Œè€Œä¸”å®ƒæ‰€æœ‰ç”¨åˆ°çš„ç±»éƒ½æ˜¯ç¼–è¯‘æ—¶å·²çŸ¥çš„ï¼Œå› æ­¤ä¹Ÿé€‚åˆåœ¨SubstrateVMä¸Šè¿è¡Œã€‚ä¸è¿‡ï¼Œå®ƒå¹¶ä¸ä¼šAOTç¼–è¯‘ç”¨Truffleè¯­è¨€å†™å°±çš„ç¨‹åºã€‚</p>\n<h2>SubstrateVMçš„å¯åŠ¨æ—¶é—´ä¸å†…å­˜å¼€é”€</h2>\n<p>SubstrateVMçš„å¯åŠ¨æ—¶é—´å’Œå†…å­˜å¼€é”€éå¸¸å°‘ã€‚æˆ‘ä»¬æ›¾æ¯”è¾ƒè¿‡ç”¨Cå’Œç”¨Javaä¸¤ç§è¯­è¨€å†™å°±çš„Hello Worldç¨‹åºã€‚Cç¨‹åºçš„æ‰§è¡Œæ—¶é—´åœ¨10msä»¥ä¸‹ï¼Œå†…å­˜å¼€é”€åœ¨500KBä»¥ä¸‹ã€‚åœ¨HotSpotè™šæ‹Ÿæœºä¸Šè¿è¡Œçš„Javaç¨‹åºåˆ™éœ€è¦40msï¼Œå†…å­˜å¼€é”€ä¸º24MBã€‚</p>\n<p>ä½¿ç”¨SubstrateVMçš„Javaç¨‹åºçš„æ‰§è¡Œæ—¶é—´åˆ™ä¸Cç¨‹åºæŒå¹³ï¼Œå†…å­˜å¼€é”€åœ¨850KBå·¦å³ã€‚è¿™å¾—ç›ŠäºSubstrateVMæ‰€ä¿å­˜çš„å †å¿«ç…§ï¼Œä»¥åŠæ— é¡»é¢å¤–åˆå§‹åŒ–ï¼Œç›´æ¥æ‰§è¡Œç›®æ ‡ä»£ç çš„ç‰¹æ€§ã€‚</p>\n<p>åŒæ ·ï¼Œæˆ‘ä»¬è¿˜æ¯”è¾ƒäº†ç”¨JavaScriptç¼–å†™çš„Hello Worldç¨‹åºã€‚è¿™é‡Œçš„æµ‹è¯•å¯¹è±¡æ˜¯Googleçš„V8ä»¥åŠåŸºäºTruffleçš„Graal.jsã€‚è¿™ä¸¤ä¸ªæ‰§è¡Œå¼•æ“éƒ½æ¶‰åŠäº†å¤§é‡çš„è§£æä»£ç ä»¥åŠæ‰§è¡Œä»£ç ï¼Œå› æ­¤å¯ä»¥å½“ä½œå¤§å‹åº”ç”¨ç¨‹åºæ¥çœ‹å¾…ã€‚</p>\n<p>V8çš„æ‰§è¡Œæ•ˆç‡éå¸¸é«˜ï¼Œèƒ½å¤Ÿä¸Cç¨‹åºçš„Hello Worldç›¸åª²ç¾ï¼Œä½†æ˜¯å®ƒä½¿ç”¨äº†çº¦18MBçš„å†…å­˜ã€‚è¿è¡Œåœ¨HotSpotè™šæ‹Ÿæœºä¸Šçš„Graal.jsåˆ™éœ€è¦650msæ–¹èƒ½æ‰§è¡Œå®Œè¿™æ®µJavaScriptçš„Hello Worldç¨‹åºï¼Œè€Œä¸”å†…å­˜å¼€é”€åœ¨120MBå·¦å³ã€‚</p>\n<p>è¿è¡Œåœ¨SubstrateVMä¸Šçš„Graal.jsæ— è®ºæ˜¯æ‰§è¡Œæ—¶é—´è¿˜æ˜¯å†…å­˜å¼€é”€éƒ½ååˆ†ä¼˜è¶Šï¼Œåˆ†åˆ«ä¸º10msä»¥ä¸‹ä»¥åŠ4.2MBã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®ƒåœ¨è¿è¡Œæ—¶é—´ä¸V8æŒå¹³çš„æƒ…å†µä¸‹ï¼Œå†…å­˜å¼€é”€è¿œå°äºV8ã€‚</p>\n<p>ç”±äºSubstrateVMçš„è½»é‡ç‰¹æ€§ï¼Œå®ƒååˆ†é€‚åˆäºåµŒå…¥è‡³å…¶ä»–ç³»ç»Ÿä¹‹ä¸­ã€‚Oracle Labsçš„å¦ä¸€ä¸ªå›¢é˜Ÿä¾¿æ˜¯å°†Truffleè¯­è¨€å®ç°åµŒå…¥è‡³Oracleæ•°æ®åº“ä¹‹ä¸­ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨æ•°æ®åº“ä¸­è¿è¡Œä»»æ„è¯­è¨€çš„é¢„å‚¨ç¨‹åºï¼ˆstored procedureï¼‰ã€‚å¦‚æœä½ æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥æœç´¢Oracle Database Multilingual Engineï¼ˆMLEï¼‰ï¼Œæˆ–è€…å‚é˜…è¿™ä¸ª<a href=\"https://www.oracle.com/technetwork/database/multilingual-engine/overview/index.html\">ç½‘å€</a>ã€‚æˆ‘ä»¬å›¢é˜Ÿä¹Ÿåœ¨ä¸MySQLåˆä½œï¼Œå¼€å‘MySQL MLEï¼Œè¯¦æƒ…å¯ç•™æ„æˆ‘ä»¬åœ¨ä»Šå¹´Oracle Code Oneçš„<a href=\"https://oracle.rainfocus.com/widget/oracle/oow18/catalogcodeone18?search=MySQL%20JavaScript\">è®²åº§</a>ã€‚</p>\n<h2>Metropolisé¡¹ç›®</h2>\n<p>å»å¹´OpenJDKæ¨å‡ºäº†<a href=\"http://openjdk.java.net/projects/metropolis/\">Metropolisé¡¹ç›®</a>ï¼Œä»–ä»¬å¸Œæœ›å¯ä»¥å®ç°â€œJava-on-Javaâ€çš„è¿œå¤§ç›®æ ‡ã€‚</p>\n<p>æˆ‘ä»¬çŸ¥é“ï¼Œç›®å‰HotSpotè™šæ‹Ÿæœºçš„ç»å¤§éƒ¨åˆ†ä»£ç éƒ½æ˜¯ç”¨C++å†™çš„ã€‚è¿™ä¹Ÿé€ å°±äº†ä¸€ä¸ªéå¸¸æœ‰è¶£çš„ç°è±¡ï¼Œé‚£ä¾¿æ˜¯å¯¹Javaè¯­è¨€æœ¬èº«çš„è´¡çŒ®éœ€è¦ç²¾é€šC++ã€‚æ­¤å¤–ï¼Œéšç€HotSpoté¡¹ç›®æ—¥æ¸åºå¤§ï¼Œç»´æŠ¤éš¾åº¦ä¹Ÿé€æ¸ä¸Šå‡ã€‚</p>\n<p>ç”±äºä¸Šè¿°ç§ç§åŸå› ï¼Œä½¿ç”¨Javaæ¥å¼€å‘Javaè™šæ‹Ÿæœºçš„å‘¼å£°è¶Šæ¥è¶Šé«˜ã€‚Oracleçš„æ¶æ„å¸ˆJohn Roseä¾¿æå‡ºäº†ä½¿ç”¨Javaå¼€å‘Javaè™šæ‹Ÿæœºçš„å››å¤§å¥½å¤„ï¼š</p>\n<ol>\n<li>èƒ½å¤Ÿå®Œå…¨æ§åˆ¶ç¼–è¯‘Javaè™šæ‹Ÿæœºæ—¶æ‰€ä½¿ç”¨çš„ä¼˜åŒ–æŠ€æœ¯ï¼›</li>\n<li>èƒ½å¤Ÿä¸C++è¯­è¨€çš„æ›´æ–°è§£è€¦åˆï¼›</li>\n<li>èƒ½å¤Ÿå‡è½»å¼€å‘äººå‘˜ä»¥åŠç»´æŠ¤äººå‘˜çš„è´Ÿæ‹…ï¼›</li>\n<li>èƒ½å¤Ÿä»¥æ›´ä¸ºæ•æ·çš„æ–¹å¼å®ç°Javaçš„æ–°åŠŸèƒ½ã€‚</li>\n</ol>\n<p>å½“ç„¶ï¼ŒMetropolisé¡¹ç›®å¹¶éç¬¬ä¸€ä¸ªæå‡ºJava-on-Javaæ¦‚å¿µçš„é¡¹ç›®ã€‚å®é™…ä¸Šï¼Œ<a href=\"https://www.jikesrvm.org/\">JikesRVMé¡¹ç›®</a>å’Œ<a href=\"https://github.com/beehive-lab/Maxine-VM\">Maxine VMé¡¹ç›®</a>éƒ½å·²ç”¨Javaå®Œæ•´åœ°å®ç°äº†ä¸€å¥—Javaè™šæ‹Ÿæœºï¼ˆåè€…çš„å³æ—¶ç¼–è¯‘å™¨C1Xä¾¿æ˜¯Graalç¼–è¯‘å™¨çš„å‰èº«ï¼‰ã€‚</p>\n<p>ç„¶è€Œï¼ŒJava-on-JavaæŠ€æœ¯é€šå¸¸ä¼šå¹²æ‰°åº”ç”¨ç¨‹åºçš„åƒåœ¾å›æ”¶ã€å³æ—¶ç¼–è¯‘ä¼˜åŒ–ï¼Œä»è€Œä¸¥é‡å½±å“Javaè™šæ‹Ÿæœºçš„å¯åŠ¨æ€§èƒ½ã€‚</p>\n<p>ä¸¾ä¾‹æ¥è¯´ï¼Œç›®å‰ä½¿ç”¨äº†Graalç¼–è¯‘å™¨çš„HotSpotè™šæ‹Ÿæœºä¼šåœ¨å³æ—¶ç¼–è¯‘è¿‡ç¨‹ä¸­ç”Ÿæˆå¤§é‡çš„Javaå¯¹è±¡ï¼Œè¿™äº›Javaå¯¹è±¡åŒæ ·ä¼šå æ®åº”ç”¨ç¨‹åºçš„å †ç©ºé—´ï¼Œä»è€Œä½¿å¾—åƒåœ¾å›æ”¶æ›´åŠ é¢‘ç¹ã€‚</p>\n<p>å¦å¤–ï¼ŒGraalç¼–è¯‘å™¨æœ¬èº«ä¹Ÿä¼šè§¦å‘å³æ—¶ç¼–è¯‘ï¼Œå¹¶ä¸åº”ç”¨ç¨‹åºçš„å³æ—¶ç¼–è¯‘ç«äº‰ç¼–è¯‘çº¿ç¨‹çš„CPUèµ„æºã€‚è¿™å°†é€ æˆåº”ç”¨ç¨‹åºä»è§£é‡Šæ‰§è¡Œåˆ‡æ¢è‡³å³æ—¶ç¼–è¯‘ç”Ÿæˆçš„æœºå™¨ç çš„æ—¶é—´å¤§å¤§åœ°å¢é•¿ï¼Œä»è€Œé™ä½åº”ç”¨ç¨‹åºçš„å¯åŠ¨æ€§èƒ½ã€‚</p>\n<p>Metropolisé¡¹ç›®çš„ç¬¬ä¸€ä¸ªå­é¡¹ç›®ä¾¿æ˜¯æ¢ç´¢éƒ¨ç½²å·²AOTç¼–è¯‘çš„Graalç¼–è¯‘å™¨çš„å¯èƒ½æ€§ã€‚è¿™ä¸ªå­é¡¹ç›®å°†å€ŸåŠ©SubstrateVMæŠ€æœ¯ï¼ŒæŠŠæ•´ä¸ªGraalç¼–è¯‘å™¨AOTç¼–è¯‘ä¸ºæœºå™¨ç ã€‚</p>\n<p>è¿™æ ·ä¸€æ¥ï¼Œåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒGraalç¼–è¯‘å™¨ä¸å†éœ€è¦è¢«å³æ—¶ç¼–è¯‘ï¼Œå› æ­¤ä¹Ÿä¸ä¼šå†å æ®å¯ç”¨äºå³æ—¶ç¼–è¯‘åº”ç”¨ç¨‹åºçš„CPUèµ„æºï¼Œä½¿ç”¨Graalç¼–è¯‘å™¨çš„HotSpotè™šæ‹Ÿæœºçš„å¯åŠ¨æ€§èƒ½å°†å¾—åˆ°å¤§å¹…åº¦åœ°æå‡ã€‚</p>\n<p>æ­¤å¤–ï¼Œç”±äºSubstrateVMç¼–è¯‘å¾—åˆ°çš„Graalç¼–è¯‘å™¨å°†ä½¿ç”¨ç‹¬ç«‹çš„å †ç©ºé—´ï¼Œå› æ­¤Graalç¼–è¯‘å™¨åœ¨å³æ—¶ç¼–è¯‘è¿‡ç¨‹ä¸­ç”Ÿæˆçš„Javaå¯¹è±¡å°†ä¸å†å¹²æ‰°åº”ç”¨ç¨‹åºæ‰€ä½¿ç”¨çš„å †ç©ºé—´ã€‚</p>\n<p>ç›®å‰Metropolisé¡¹ç›®ä»å¤„äºå‰æœŸéªŒè¯é˜¶æ®µï¼Œå¦‚æœä½ æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥å…³æ³¨ä¹‹åçš„å‘å±•æƒ…å†µã€‚</p>\n<h2>æ€»ç»“ä¸å®è·µ</h2>\n<p>ä»Šå¤©æˆ‘ä»‹ç»äº†GraalVMä¸­çš„AOTç¼–è¯‘æ¡†æ¶SubstrateVMã€‚</p>\n<p>SubstrateVMçš„è®¾è®¡åˆè¡·æ˜¯æä¾›ä¸€ä¸ªé«˜å¯åŠ¨æ€§èƒ½ã€ä½å†…å­˜å¼€é”€ï¼Œå’Œèƒ½å¤Ÿæ— ç¼è¡”æ¥Cä»£ç çš„Javaè¿è¡Œæ—¶ã€‚å®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿è¡Œæ—¶ï¼Œæ‹¥æœ‰è‡ªå·±çš„å†…å­˜ç®¡ç†ç­‰ç»„ä»¶ã€‚</p>\n<p>SubstrateVMè¦æ±‚æ‰€è¦AOTç¼–è¯‘çš„ç›®æ ‡ç¨‹åºæ˜¯å°é—­çš„ï¼Œå³ä¸èƒ½åŠ¨æ€åŠ è½½å…¶ä»–ç±»åº“ç­‰ã€‚åœ¨è¿›è¡ŒAOTç¼–è¯‘æ—¶ï¼Œå®ƒä¼šæ¢ç´¢æ‰€æœ‰å¯èƒ½è¿è¡Œåˆ°çš„æ–¹æ³•ï¼Œå¹¶å…¨éƒ¨çº³å…¥ç¼–è¯‘èŒƒå›´ä¹‹å†…ã€‚</p>\n<p>SubstrateVMçš„å¯åŠ¨æ—¶é—´å’Œå†…å­˜å¼€é”€éƒ½éå¸¸å°‘ï¼Œè¿™ä¸»è¦å¾—ç›Šäºåœ¨AOTç¼–è¯‘æ—¶ä¾¿å·²ä¿å­˜äº†å·²åˆå§‹åŒ–å¥½çš„å †å¿«ç…§ï¼Œå¹¶æ”¯æŒä»ç¨‹åºå…¥å£ç›´æ¥å¼€å§‹è¿è¡Œã€‚ä½œä¸ºå¯¹æ¯”ï¼ŒHotSpotè™šæ‹Ÿæœºåœ¨æ‰§è¡Œmainæ–¹æ³•å‰éœ€è¦æ‰§è¡Œä¸€ç³»åˆ—çš„åˆå§‹åŒ–æ“ä½œï¼Œå› æ­¤å¯åŠ¨æ—¶é—´å’Œå†…å­˜å¼€é”€éƒ½è¦è¿œå¤§äºè¿è¡Œåœ¨SubstrateVMä¸Šçš„ç¨‹åºã€‚</p>\n<p>Metropolisé¡¹ç›®å°†è¿ç”¨SubstrateVMé¡¹ç›®ï¼Œé€æ­¥åœ°å°†HotSpotè™šæ‹Ÿæœºä¸­çš„C++ä»£ç æ›¿æ¢æˆJavaä»£ç ï¼Œä»è€Œæå‡HotSpotè™šæ‹Ÿæœºçš„å¯ç»´æŠ¤æ€§ï¼Œä¹ŸåŠ å¿«æ–°JavaåŠŸèƒ½çš„å¼€å‘æ•ˆç‡ã€‚</p>\n<hr />\n<p>ä»Šå¤©çš„å®è·µç¯èŠ‚ï¼Œè¯·ä½ å‚è€ƒæˆ‘ä»¬å®˜ç½‘çš„<a href=\"https://www.graalvm.org/docs/examples/java-kotlin-aot/\">SubstrateVMæ•™ç¨‹</a>ï¼ŒAOTç¼–è¯‘ä¸€æ®µJava-Kotlinä»£ç ã€‚</p>\n<p></p>\n","comments":[{"had_liked":false,"id":31951,"user_name":"Jimbol","can_delete":false,"product_type":"c1","uid":1178008,"ip_address":"","ucode":"8D9190B3B3E08B","user_header":"https://static001.geekbang.org/account/avatar/00/11/f9/98/95b13446.jpg","comment_is_top":false,"comment_ctime":1539340769,"is_pvip":false,"replies":[{"id":"11574","content":"å—¯å—¯ï¼Œç­‰æˆ‘æ­‡ä¸€æ®µæ—¶é—´å“ˆï¼Œè¿™è¿ç»­è¿™ä¹ˆå¤šæœŸå†™å¾—å¤ªç´¯äº†ã€‚","user_name":"ä½œè€…å›å¤","comment_id":31951,"uid":"1176688","ip_address":"","utype":1,"ctime":1539359289,"user_name_real":"éƒ‘é›¨è¿ª"}],"discussion_count":3,"race_medal":0,"score":"53078948321","product_id":100010301,"comment_content":"è€å¸ˆå¥½ï¼Œå†™äº†è¿™ä¹ˆå¤šæœŸï¼Œè€å¸ˆè¾›è‹¦äº†ï¼è€å¸ˆèƒ½å¦å¤šå†™ä¸€äº›å…³äºjvmæ€§èƒ½ä¼˜åŒ–è°ƒä¼˜ï¼Œæˆ–è€…å¼€å‘ä¸­å¸¸è§çš„å‘å‘¢ï¼Ÿå¤ªæ·±å¥¥çš„å†…å®¹å¯¹ä¸€çº¿å¼€å‘æ¥è¯´å¥½é¥è¿œ","like_count":12,"discussions":[{"author":{"id":1176688,"avatar":"https://static001.geekbang.org/account/avatar/00/11/f4/70/2f61fa20.jpg","nickname":"éƒ‘é›¨è¿ª","note":"","ucode":"F7CA1AE501EAFF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426578,"discussion_content":"å—¯å—¯ï¼Œç­‰æˆ‘æ­‡ä¸€æ®µæ—¶é—´å“ˆï¼Œè¿™è¿ç»­è¿™ä¹ˆå¤šæœŸå†™å¾—å¤ªç´¯äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539359289,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005042,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/55/f2/ba68d931.jpg","nickname":"æœ‰ç±³","note":"","ucode":"C9A10B7A67BC12","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":236122,"discussion_content":"è€å¸ˆï¼Œæ­‡å¤Ÿäº†å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587055089,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1109640,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ee/88/a890b41e.jpg","nickname":"chris","note":"","ucode":"6663E3E09457E3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":210483,"discussion_content":"æœŸå¾…å®æˆ˜ä¸­çš„JVMè°ƒä¼˜ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584730582,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":34281,"user_name":"dyangx","can_delete":false,"product_type":"c1","uid":1255862,"ip_address":"","ucode":"D33CF4BAC3100D","user_header":"https://static001.geekbang.org/account/avatar/00/13/29/b6/37ad78e0.jpg","comment_is_top":false,"comment_ctime":1540085881,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"18719955065","product_id":100010301,"comment_content":"ä»Šåæœ‰å¯èƒ½java 11ä¼šæ”¶è´¹å—","like_count":4,"discussions":[{"author":{"id":1360093,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLEIsgI4ub1VOKWtVOfouAzSqx8Yt8ibQEsAnwNJsJHmuJzzpQqG79HullvYwpic8hgiclgON2GwXSjw/132","nickname":"cv0cv0","note":"","ucode":"93FF9277F03FD0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555602,"discussion_content":"å¯ä»¥ç”¨openJDKã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646986923,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1164626,"avatar":"https://static001.geekbang.org/account/avatar/00/11/c5/52/63008fc7.jpg","nickname":"xuwei","note":"","ucode":"07268C1743839F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":29858,"discussion_content":"è€å¸ˆåœ¨Oracleå·¥ä½œï¼Œä¸èƒ½å›ç­”è¿™æ ·çš„é—®é¢˜ã€‚è‡³äºæ”¶ä¸æ”¶è´¹ï¼Œçœ‹openjdk","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570787702,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62941,"user_name":"BD","can_delete":false,"product_type":"c1","uid":1228560,"ip_address":"","ucode":"A95CF8C3EDC228","user_header":"https://static001.geekbang.org/account/avatar/00/12/bf/10/b7974690.jpg","comment_is_top":false,"comment_ctime":1548211200,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5843178496","product_id":100010301,"comment_content":"åœ¨Javaå¼€æºæ¡†æ¶æºç é‡Œç»å¸¸çœ‹åˆ°ä¸€ç§å†™æ³•ï¼Œobject a=new object; object b=a; æ¥ä¸‹æ¥ç›´æ¥æ“ä½œbã€‚æˆ‘æƒ³é—®è¿™é‡Œä¸ºä»€ä¹ˆä¸ç›´æ¥æ“ä½œaéè¦â€œå¤šæ­¤ä¸€ä¸¾â€çš„èµ‹å€¼ç»™bå†æ“ä½œbå‘¢","like_count":2},{"had_liked":false,"id":32673,"user_name":"æ¨ªäº‘æ–­å²­","can_delete":false,"product_type":"c1","uid":1182078,"ip_address":"","ucode":"C7BD049A408398","user_header":"https://static001.geekbang.org/account/avatar/00/12/09/7e/11cf22de.jpg","comment_is_top":false,"comment_ctime":1539661242,"is_pvip":false,"replies":[{"id":"11920","content":"å¯¹äºèƒ½å¤Ÿè¢«SVMç¼–è¯‘çš„(ä¹Ÿå°±æ˜¯ä¸åŒ…å«åŠ¨æ€ç±»åŠ è½½ç­‰)Javaåº”ç”¨ç¨‹åºè€Œè¨€ï¼ŒåŸåˆ™ä¸ŠSVMå’ŒHotSpot VMåº”è¯¥æ˜¯ç­‰ä»·çš„ï¼Œèƒ½åœ¨HSè·‘å°±åº”è¯¥èƒ½åœ¨SVMä¸Šè·‘ï¼Œå¦åˆ™å°±æ˜¯SVMçš„bugäº†ã€‚<br><br>å¦‚æœæƒ³è¦è°ƒè¯•SVMæœ¬èº«æˆ–è€…SVMç¼–è¯‘çš„Javaåº”ç”¨çš„è¯ï¼Œåªèƒ½ä¸ŠGDBäº†ã€‚å¦‚æœæ˜¯SVMç¼–è¯‘çš„Truffleè¯­è¨€çš„è¯ï¼Œæˆ‘ä»¬åœ¨Truffleè¯­è¨€å±‚é¢å®ç°äº†Chrome DevTools Protocalï¼Œå¯ä»¥ç›´æ¥ç”¨Chromeè°ƒè¯•ã€‚","user_name":"ä½œè€…å›å¤","comment_id":32673,"uid":"1176688","ip_address":"","utype":1,"ctime":1539680487,"user_name_real":"éƒ‘é›¨è¿ª"}],"discussion_count":1,"race_medal":0,"score":"5834628538","product_id":100010301,"comment_content":"è¯·é—®SubstrateVMæ€æ ·è°ƒè¯•ï¼Ÿå› ä¸ºä¼ ç»Ÿçš„javaæ’æŸ¥å·¥å…·éƒ½å¤±æ•ˆäº†ã€‚ä½¿ç”¨æ–¹æ›´åŠ å…³æ³¨çš„æ˜¯æ˜“ç”¨æ€§ã€‚","like_count":1,"discussions":[{"author":{"id":1176688,"avatar":"https://static001.geekbang.org/account/avatar/00/11/f4/70/2f61fa20.jpg","nickname":"éƒ‘é›¨è¿ª","note":"","ucode":"F7CA1AE501EAFF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426852,"discussion_content":"å¯¹äºèƒ½å¤Ÿè¢«SVMç¼–è¯‘çš„(ä¹Ÿå°±æ˜¯ä¸åŒ…å«åŠ¨æ€ç±»åŠ è½½ç­‰)Javaåº”ç”¨ç¨‹åºè€Œè¨€ï¼ŒåŸåˆ™ä¸ŠSVMå’ŒHotSpot VMåº”è¯¥æ˜¯ç­‰ä»·çš„ï¼Œèƒ½åœ¨HSè·‘å°±åº”è¯¥èƒ½åœ¨SVMä¸Šè·‘ï¼Œå¦åˆ™å°±æ˜¯SVMçš„bugäº†ã€‚\n\nå¦‚æœæƒ³è¦è°ƒè¯•SVMæœ¬èº«æˆ–è€…SVMç¼–è¯‘çš„Javaåº”ç”¨çš„è¯ï¼Œåªèƒ½ä¸ŠGDBäº†ã€‚å¦‚æœæ˜¯SVMç¼–è¯‘çš„Truffleè¯­è¨€çš„è¯ï¼Œæˆ‘ä»¬åœ¨Truffleè¯­è¨€å±‚é¢å®ç°äº†Chrome DevTools Protocalï¼Œå¯ä»¥ç›´æ¥ç”¨Chromeè°ƒè¯•ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539680487,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":139054,"user_name":"NullPointer","can_delete":false,"product_type":"c1","uid":1179184,"ip_address":"","ucode":"83B7DA926A0411","user_header":"https://static001.geekbang.org/account/avatar/00/11/fe/30/c9b568c3.jpg","comment_is_top":false,"comment_ctime":1570536735,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570536735","product_id":100010301,"comment_content":"è°¢è°¢è€å¸ˆè¾›å‹¤ä»˜å‡ºï¼Œå¯¹äºJVMæœ‰äº†é€šç›˜çš„ç†è§£ï¼Œä¹Ÿæœ‰jvmæœªæ¥å‘å±•ã€‚svmæ— æ„ä¹‹é—´ä¹Ÿä¸ºjava-on-javaåšå‡ºä¸å°‘åŠªåŠ›ï¼ŒğŸ˜","like_count":1},{"had_liked":false,"id":32089,"user_name":"wahaha","can_delete":false,"product_type":"c1","uid":1051402,"ip_address":"","ucode":"E60166599CF31D","user_header":"https://static001.geekbang.org/account/avatar/00/10/0b/0a/fa152399.jpg","comment_is_top":false,"comment_ctime":1539411799,"is_pvip":false,"replies":[{"id":"12166","content":"32ä½X86æš‚æ—¶æ²¡è®¡åˆ’ï¼ŒARMåº”è¯¥ä¼šæœ‰ï¼Œå–å†³äºRedHatä»¥åŠæˆ‘ä»¬è´Ÿè´£Aarch64çš„å·¥ç¨‹å¸ˆçš„æ•ˆç‡ã€‚","user_name":"ä½œè€…å›å¤","comment_id":32089,"uid":"1176688","ip_address":"","utype":1,"ctime":1539955676,"user_name_real":"éƒ‘é›¨è¿ª"}],"discussion_count":1,"race_medal":0,"score":"1539411799","product_id":100010301,"comment_content":"è€å¸ˆï¼ŒSubstrateVMä»¥åä¼šæ”¯æŒ32ä½çš„X86å’ŒARMå¤„ç†å™¨å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1176688,"avatar":"https://static001.geekbang.org/account/avatar/00/11/f4/70/2f61fa20.jpg","nickname":"éƒ‘é›¨è¿ª","note":"","ucode":"F7CA1AE501EAFF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426631,"discussion_content":"32ä½X86æš‚æ—¶æ²¡è®¡åˆ’ï¼ŒARMåº”è¯¥ä¼šæœ‰ï¼Œå–å†³äºRedHatä»¥åŠæˆ‘ä»¬è´Ÿè´£Aarch64çš„å·¥ç¨‹å¸ˆçš„æ•ˆç‡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539955676,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}