{"id":633063,"title":"31ï½œCQRSï¼ˆä¸Šï¼‰ï¼šå®ç°æŸ¥è¯¢åŠŸèƒ½æœ‰ä»€ä¹ˆè¯€çªï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é’Ÿæ•¬ã€‚</p><p>å‰é¢å‡ èŠ‚è¯¾æˆ‘ä»¬è®²å®Œäº†é™ç•Œä¸Šä¸‹æ–‡ã€‚æ¥ä¸‹æ¥çš„ä¸¤èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°†å­¦ä¹ ä¸€ä¸ªå’ŒæŸ¥è¯¢åŠŸèƒ½ç›¸å…³çš„æ¨¡å¼â€”â€”CQRSã€‚è™½ç„¶ ã€Šé¢†åŸŸé©±åŠ¨è®¾è®¡ã€‹åŸä¹¦é‡Œæ²¡æœ‰è¿™ä¸ªæ¨¡å¼ï¼Œä½†è¿‘å¹´æ¥ï¼ŒCQRS å¸¸å¸¸å’Œ DDD ç»“åˆä½¿ç”¨ã€‚</p><p>ä¸è¿‡ä¹Ÿæœ‰äººå¯¹ CQRSæœ‰ä¸åŒæ„è§ã€‚è¿™æ˜¯å› ä¸ºï¼ŒCQRS å®é™…ä¸Šä¹Ÿæœ‰ä¸åŒçš„å˜åŒ–ï¼Œè¿™å°±é€ æˆäº†ä¸åŒçš„äººå¯¹ CQRS çš„ç†è§£ä¹Ÿä¸å¤ªä¸€æ ·ã€‚å­¦å®Œè¿™ä¸¤èŠ‚è¯¾ï¼Œæˆ‘æƒ³ä½ å°±çŸ¥é“æ€ä¹ˆåˆ†è¾¨äº†ã€‚</p><p>CQRS æ˜¯ Command Query Responsibility Segregation çš„ç®€ç§°ï¼Œä¸­æ–‡æ˜¯ â€œå‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»â€ã€‚è¿™ä¸ªåå­—ä¹å¬èµ·æ¥ä¹Ÿä¸å¤ªå¥½ç†è§£ï¼Œå’±ä»¬è¿˜æ˜¯ä»ä¸šåŠ¡éœ€æ±‚å¼€å§‹ï¼Œä¸€æ­¥ä¸€æ­¥åœ°ç†è§£ã€‚</p><h2>æŸ¥è¯¢åŠŸèƒ½é‡åˆ°çš„é—®é¢˜</h2><p>åœ¨ç¬¬ä¸‰ä¸ªè¿­ä»£ä¸­ï¼Œåœ¨å·¥æ—¶ç®¡ç†ä¸Šä¸‹æ–‡ï¼Œå¢åŠ äº†æ›´å¤šçš„æŸ¥è¯¢å’Œç»Ÿè®¡éœ€æ±‚ã€‚</p><p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªç®€å•çš„éœ€æ±‚ï¼Œç»™å®šä¸€ä¸ªå·¥æ—¶é¡¹ï¼Œè¦æ±‚æŸ¥è¯¢å‡ºè¿™ä¸ªå·¥æ—¶é¡¹ä¸‹çš„æ‰€æœ‰å·¥æ—¶è®°å½•ï¼Œå¹¶æ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚è¦æ±‚æ¯æ¡è¿”å›è®°å½•çš„å­—æ®µåŒ…æ‹¬â€œå‘˜å·¥å·â€â€œå‘˜å·¥å§“åâ€â€œæ—¥æœŸâ€â€œå·¥æ—¶â€å’Œâ€œå¤‡æ³¨â€ï¼Œå¹¶æ ¹æ®å‘˜å·¥å·å’Œæ—¥æœŸå‡åºæ’åºã€‚ä¸ºäº†ç®€åŒ–é—®é¢˜ï¼Œæˆ‘ä»¬å…ˆä¸è€ƒè™‘â€œä¸åœ¨æœ¬çº§æŠ¥å·¥æ—¶â€ä»¥åŠâ€œçˆ¶å­å·¥æ—¶é¡¹â€çš„é—®é¢˜ã€‚</p><p>æˆ‘ä»¬å›å¿†ä¸€ä¸‹å·¥æ—¶é¡¹ç®¡ç†çš„é¢†åŸŸæ¨¡å‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/6a/66/6a7c2bd3bc372920b99f6e2a97cfbf66.jpg?wh=3118x2324\" alt=\"\"></p><p>æ ¹æ®ä¹‹å‰å­¦ä¹ çš„æ•°æ®åº“è®¾è®¡ä»¥åŠä¸Šä¸‹æ–‡æ˜ å°„çš„æ–¹æ³•ï¼Œå‡å®šæˆ‘ä»¬é€‰æ‹©çš„æ˜¯åœ¨æœ¬åœ°å»ºç«‹å‘˜å·¥è¡¨ï¼Œå¹¶ä»â€œåŸºç¡€ä¿¡æ¯ç®¡ç†â€ä¸Šä¸‹æ–‡æ˜ å°„<strong>å‘˜å·¥</strong>ä¿¡æ¯çš„ç­–ç•¥ã€‚é‚£ä¹ˆæœ¬åœ°æ•°æ®åº“ä¼šæœ‰<strong>å‘˜å·¥</strong>ï¼ˆempï¼‰è¡¨å’Œ<strong>å·¥æ—¶è®°å½•</strong>ï¼ˆeffort_recordï¼‰è¡¨ã€‚</p><!-- [[[read_end]]] --><p>åœ¨æ²¡æœ‰å­¦ä¹ DDDä¹‹å‰ï¼Œå…¶å®è¿™ä¸ªéœ€æ±‚å¾ˆç®€å•ï¼Œåªè¦ä¸€æ¡SQLè¯­å¥å°±å¯ä»¥æå®šäº†ã€‚å¤§æ¦‚æ˜¯åé¢è¿™æ ·ã€‚</p><pre><code class=\"language-sql\">select em.num, em.name, er.work_date, er.effort, er.notes\nfrom effort_record as er\n  left join emp as em\n    on er.emp_id = em.id\n       and er.tenant_id = em.tenant_id\nwhere er.tenant_id = ?\n  and er.effort_item_id = ?\n  order by em.num, er.work_date;\n</code></pre><p>è¿™ä¸ªæŸ¥è¯¢æ˜¯æŠŠ effort_recordï¼ˆå·¥æ—¶è®°å½•è¡¨ï¼‰å’Œ empï¼ˆå‘˜å·¥ï¼‰è¡¨åšäº†ä¸€ä¸ªè¡¨è¿æ¥ï¼Œç„¶åæ ¹æ® effort_item_id ï¼ˆå·¥æ—¶é¡¹IDï¼‰æŸ¥å‡ºç›¸åº”çš„æ•°æ®ã€‚</p><p>ä½†æ˜¯ï¼Œç°åœ¨å­¦äº† DDDï¼Œå†è¦å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œä½ å¯èƒ½ä¼šè§‰å¾—åè€Œæ›´éº»çƒ¦äº†ã€‚å› ä¸ºè¿™æ—¶å€™è¦ç»è¿‡é¢†åŸŸæ¨¡å‹å¾—åˆ°è¿™ä¸ªæŸ¥è¯¢ç»“æœã€‚æˆ‘æŠŠè®¾è®¡å±‚é¢çš„ç±»å›¾ç”»å‡ºæ¥ï¼Œæ¥è¾…åŠ©æˆ‘ä»¬çš„æ€è€ƒã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/06/96/06865f9634e4d935714dcdd1310f7896.jpg?wh=3600x3185\" alt=\"\"></p><p>æˆ‘ä»¬ä» EffortRecordServiceï¼ˆä¹Ÿå°±æ˜¯å·¥æ—¶è®°å½•æœåŠ¡ï¼‰å¼€å§‹çœ‹ã€‚è¿™ä¸ªæœåŠ¡ä¸­çš„æ–¹æ³•ä¼šæ¥æ”¶ä¸€ä¸ªEffortItemIDï¼ˆå·¥æ—¶é¡¹IDï¼‰ï¼Œæœ€åè¿”å›ä¸€ä¸ªå«æœ‰æ‰€éœ€æ•°æ®çš„åˆ—è¡¨ã€‚æ¯ä¸€æ¡æ•°æ®è®°å½•å°è£…åœ¨åä¸º EmpEffortRecordDto çš„DTOé‡Œã€‚</p><p>å…·ä½“åŒ…æ‹¬ä¸‰æ­¥ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œå·¥æ—¶è®°å½•æœåŠ¡ä¼šè°ƒç”¨ EffortRecordRepositoryï¼Œæ ¹æ®å·¥æ—¶é¡¹IDå–å¾—ä¸€å † EffortRecord ï¼ˆå·¥æ—¶è®°å½•ï¼‰å®ä½“ã€‚</p><p>ç¬¬äºŒæ­¥ï¼Œå†æ ¹æ®æ¯ä¸ªå·¥æ—¶è®°å½•å®ä½“ä¸­çš„å‘˜å·¥IDï¼Œè°ƒç”¨ EmpRepository ï¼Œä¸ºæ¯ä¸ªå·¥æ—¶è®°å½•å–å¾—ç›¸åº”çš„å‘˜å·¥å®ä½“ã€‚è¿™é‡Œè¦æ³¨æ„é¿å…å¯¹åŒä¸€ä¸ªå‘˜å·¥å®ä½“é‡å¤æŸ¥è¯¢æ•°æ®åº“ã€‚</p><p>ç¬¬ä¸‰æ­¥ï¼ŒæŠŠæ‰€æœ‰å·¥æ—¶è®°å½•å’Œå¯¹åº”çš„å‘˜å·¥å®ä½“ä¿¡æ¯æ‹¼æˆç›¸åº”çš„ EmpEffortRecordDto ï¼Œæ’åºåç»„è£…æˆåˆ—è¡¨è¿”å›ã€‚</p><p>é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œæˆ‘åœ¨è¿™é‡Œæ²¡æœ‰è´´ä»£ç ï¼Œè€Œæ˜¯ç»™å‡ºäº†è®¾è®¡å›¾ã€‚è¿™ä¸ªå›¾å’Œä»£ç å…¶å®æ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚å¸Œæœ›ä½ èƒ½å¤Ÿå¤šç»ƒä¸€ä¸‹çœ‹ç€å›¾å†™å‡ºä»£ç ã€çœ‹ç€ä»£ç åæ¨å‡ºå›¾çš„æŠ€å·§ã€‚</p><p>ä¸Šé¢çš„åšæ³•ç¡®å®ç¬¦åˆæˆ‘ä»¬ä¹‹å‰è¯´çš„â€œä»£ç å’Œæ¨¡å‹ä¸€è‡´â€è¿™ä¸ªè¦æ±‚ï¼Œä½†æ˜¯ä½ å¯èƒ½å·²ç»å‘ç°è¿™ä¹ˆåšä¼šå¸¦æ¥çš„é—®é¢˜äº†ã€‚</p><ul>\n<li>ç¨‹åºç¼–å†™æ¯”è¾ƒéº»çƒ¦ï¼ŒåŸæ¥ä¸€å¥ SQL å°±å¯ä»¥è§£å†³çš„é—®é¢˜ï¼Œç°åœ¨è¦åˆ†å‡ æ­¥å®ç°ã€‚</li>\n<li>è¿™æ ·çš„ç¨‹åºå¯èƒ½å¸¦æ¥æ€§èƒ½é—®é¢˜ã€‚</li>\n</ul><p>é‚£ä¹ˆè¯¥æ€ä¹ˆè§£å†³å‘¢ï¼Ÿè¿™é‡Œçš„æ ¸å¿ƒé—®é¢˜æ˜¯ï¼ŒæŸ¥è¯¢åŠŸèƒ½æ˜¯å¦å¿…é¡»ç»è¿‡é¢†åŸŸæ¨¡å‹å‘¢ï¼Ÿ</p><p>è¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é¦–å…ˆè¦è€ƒè™‘ä¸€ä¸‹ä¸ºä»€ä¹ˆä¹‹å‰çš„é€»è¾‘è¦ç»è¿‡é¢†åŸŸæ¨¡å‹ã€‚å…¶ä¸­ä¸€ä¸ªä¸»è¦åŸå› æ˜¯ï¼Œå¦‚æœç»•è¿‡é¢†åŸŸæ¨¡å‹ï¼Œé¢†åŸŸé€»è¾‘å’Œæ•°æ®å°±å¯èƒ½åˆ†æ•£åœ¨ç¨‹åºå„ä¸ªåœ°æ–¹ï¼Œæ— æ³•ä¿è¯æ•°æ®çš„å®Œæ•´å’Œä¸€è‡´æ€§ï¼Œç¨‹åºä¹Ÿå°†å¾ˆéš¾ç†è§£å’Œç»´æŠ¤ã€‚å¯¹äºå¢ã€åˆ ã€æ”¹è¿™æ ·çš„é€»è¾‘ï¼Œè¿™æ ·çš„åŸå› ç¡®å®è¯´å¾—é€šã€‚ä½†æ˜¯ï¼ŒæŸ¥è¯¢çš„é€»è¾‘å¹¶ä¸ä¼šæ”¹å˜æ•°æ®ï¼Œæ‰€ä»¥å¹¶ä¸ä¼šé€ æˆæ•°æ®çš„ä¸å®Œæ•´å’Œä¸ä¸€è‡´ã€‚</p><p>äº‹å®ä¸Šï¼Œå‰äººå·²ç»æ„è¯†åˆ°äº†æŸ¥è¯¢å’Œå…¶ä»–åŠŸèƒ½çš„ä¸åŒä¹‹å¤„ï¼Œä¸»å¼ é‡‡ç”¨ä¸åŒçš„æ–¹å¼æ¥å¤„ç†æŸ¥è¯¢é€»è¾‘ï¼Œå¹¶æå‡ºäº†æ‰€è°“ CQRS æ¶æ„ã€‚</p><p>æœ€æ—©æå‡ºè¿™ä¸ªè¯´æ³•çš„æ˜¯ Greg Youngã€‚ä»–æŠŠå¢ã€åˆ ã€æ”¹åŠŸèƒ½ç§°ä¸º Commandï¼ˆå‘½ä»¤ï¼‰ï¼ŒæŠŠæŸ¥è¯¢ç§°ä¸º Queryï¼Œè¿™ä¸¤ç§åŠŸèƒ½çš„èŒè´£ä¸åŒï¼Œåº”è¯¥é‡‡ç”¨ä¸åŒçš„æ–¹å¼æ¥å¤„ç†ï¼Œå› æ­¤å«åšâ€œå‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»â€ï¼ˆCommand Query Responsibility Segregation ï¼‰ï¼Œç®€ç§° CQRSã€‚æˆ‘ä»¬å¯ä»¥å…ˆç²—æ”¾ä¸€ç‚¹æ¥ç†è§£ï¼Œä¸€å…±æ˜¯ä¸¤æ¡è§„åˆ™ã€‚</p><p><strong>ç¬¬ä¸€ï¼Œå‘½ä»¤è¦èµ°é¢†åŸŸæ¨¡å‹ã€‚</strong></p><p><strong>ç¬¬äºŒï¼ŒæŸ¥è¯¢ä¸èµ°é¢†åŸŸæ¨¡å‹ï¼Œç›´æ¥ç”¨ SQL å’Œ DTOã€‚</strong></p><p>åæ¥ï¼Œä¸šç•Œå¯¹ CQRS åˆå½¢æˆäº†ä¸€äº›ä¸å¤ªä¸€æ ·çš„ç†è§£ã€‚è¿™æ˜¯å› ä¸ºï¼ŒCQRS å…¶å®å¯ä»å‡ ä¸ªä¸åŒçš„å±‚é¢æ¥è€ƒè™‘ï¼Œæˆ‘ä»¬åˆ†åˆ«æ¥çœ‹çœ‹ã€‚</p><h2>ä»£ç ç»“æ„åˆ†ç¦»</h2><p>ç¬¬ä¸€ä¸ªå±‚é¢æ˜¯ä»£ç ç»“æ„çš„åˆ†ç¦»ã€‚ä¸ºäº†è¯´æ˜è¿™ä¸ªé—®é¢˜ï¼Œå’±ä»¬å…ˆçœ‹å›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/17/15/1781a13a29f5624e0e54c8e46e437d15.jpg?wh=3791x3584\" alt=\"\"></p><p>åœ¨è¿™ä¸ªå›¾é‡Œï¼Œä»£ç é¦–å…ˆåˆ†æˆäº†ä¸¤ä¸ªåŒ…ï¼Œä¸€ä¸ªæ˜¯ command processorï¼ˆå‘½ä»¤å¤„ç†å™¨ï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯ query processorï¼ˆæŸ¥è¯¢å¤„ç†å™¨ï¼‰ã€‚å…¶ä¸­ï¼Œå‘½ä»¤å¤„ç†å™¨é‡‡ç”¨çš„å°±æ˜¯ä¹‹å‰åŸºäºé¢†åŸŸæ¨¡å‹çš„åˆ†å±‚æ¶æ„ã€‚</p><p>å…³é”®çœ‹<strong>æŸ¥è¯¢å¤„ç†å™¨</strong>ï¼Œä½ ä¼šå‘ç°é‡Œé¢æ ¹æœ¬å°±æ²¡æœ‰é¢†åŸŸå±‚äº†ï¼Œå½“ç„¶ä¹Ÿå°±æ²¡æœ‰é¢†åŸŸå¯¹è±¡äº†ã€‚è¿™é‡Œç›´æ¥ç”¨ EmpEffortRecordDto æ¥è¡¨ç¤ºæ•°æ®ã€‚åº”ç”¨æœåŠ¡è°ƒç”¨ä»“åº“ï¼Œä»“åº“é‡Œç”¨ SQL è¯­å¥è¿›è¡Œè¿è¡¨æŸ¥è¯¢ï¼Œå¾—åˆ°çš„æ•°æ®ç›´æ¥å¡«åˆ° DTO é‡Œã€‚åº”ç”¨æœåŠ¡å¯èƒ½è¿˜è¦å¯¹DTOå†åšå°‘è®¸åŠ å·¥ï¼Œå°±å¯ä»¥ç›´æ¥è¿”å›äº†ã€‚</p><p>ç”±äº EmpEffortRecordDto è¡¨ç¤ºçš„æ˜¯è¦æŸ¥è¯¢çš„æ•°æ®çš„ç»“æ„ï¼Œæ‰€ä»¥ï¼Œä¹Ÿæœ‰äººæŠŠç”±è¿™äº›å¯¹è±¡ç»„æˆçš„æ¨¡å‹ç§°ä¸ºâ€œæŸ¥è¯¢æ¨¡å‹â€ï¼ˆquery modelï¼‰æˆ–è€…â€œè¯»æ¨¡å‹â€ï¼ˆread modelï¼‰ã€‚åœ¨å‘½åä¸Šï¼Œå¦‚æœç®€æ´ä¸€äº›ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨ Dto è¿™ä¸ªåç¼€ã€‚</p><p>æœ€åï¼Œåœ¨å›¾é‡Œæˆ‘ä»¬æŠŠæ•°æ®åº“ä¹Ÿçœ‹åšç»„ä»¶ï¼Œç”¨ç»„ä»¶å›¾æ¥è¡¨ç¤ºï¼Œå®ƒå¯¹å¤–æš´éœ²çš„æ¥å£å°±æ˜¯ SQLã€‚</p><p>è¿™ç§ä»£ç ç»“æ„çš„åˆ†ç¦»ï¼Œæ˜¯æœ€ç®€å•çš„ CQRSï¼Œå¤šæ•°é‡‡ç”¨äº† DDD åˆ†å±‚æ¶æ„çš„ç¨‹åºéƒ½å¯ä»¥å°è¯•ä½¿ç”¨ã€‚</p><p>é™¤äº†è¿™ç§æœ€ç®€å•çš„ç”¨æ³•ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹å…¶ä»–å‡ ç§ç­–ç•¥ï¼Œå®ƒä»¬åœ¨å¸¦æ¥æ”¶ç›Šçš„åŒæ—¶ï¼Œä¹Ÿä¼šæœ‰æ¯”è¾ƒæ˜æ˜¾çš„ä»£ä»·ï¼Œè¿™æ—¶æˆ‘ä»¬å°±è¦å¤šæƒè¡¡ä¸€ä¸‹äº†ã€‚</p><h2>æ•°æ®åº“ç»“æ„åˆ†ç¦»</h2><p>å‰é¢ç¨‹åºé‡Œçš„ SQL ç”¨äº†è¿è¡¨æŸ¥è¯¢ï¼Œæœ‰æ—¶å€™ä¼šé€ æˆæ€§èƒ½é—®é¢˜ã€‚</p><p>æœ¬è´¨åŸå› æ˜¯ï¼Œç¨‹åºé‡Œçš„æŸ¥è¯¢æ¨¡å‹å’Œæ•°æ®åº“é‡Œçš„è¡¨æ¶æ„ä¸ä¸€è‡´ã€‚è¿™æ˜¯å› ä¸ºï¼Œæ•°æ®åº“é‡Œçš„è¡¨ç»“æ„ï¼Œæˆ–è€…è¯´ç‰©ç†æ•°æ®æ¨¡å‹ï¼Œæ˜¯æ ¹æ®é¢†åŸŸæ¨¡å‹ï¼Œè€Œä¸æ˜¯æŸ¥è¯¢æ¨¡å‹è®¾è®¡çš„ã€‚ä»ç‰©ç†æ•°æ®æ¨¡å‹åˆ°ç¨‹åºä¸­çš„æŸ¥è¯¢æ¨¡å‹çš„è½¬æ¢ï¼Œæ˜¯é€šè¿‡ SQLå®Œæˆçš„ã€‚è€Œè¿™ç§è½¬æ¢éœ€è¦è¡¨è¿æ¥ï¼Œå°±å¯èƒ½é€ æˆæ€§èƒ½é—®é¢˜ã€‚</p><p>é‚£æ€ä¹ˆè§£å†³è¿™ç§æ€§èƒ½é—®é¢˜å‘¢ï¼Ÿ</p><p>ä¸€ç§è§£å†³æ€è·¯æ˜¯ä¸ºæŸ¥è¯¢å•ç‹¬åˆ›å»ºä¸€å¥—è¡¨ï¼Œå…¶ä¸­é‡‡ç”¨â€œåè§„èŒƒåŒ–è®¾è®¡â€ï¼Œä¹Ÿå°±æ˜¯å¼•å…¥å†—ä½™å­—æ®µï¼Œä½¿è¡¨ç»“æ„å’ŒæŸ¥è¯¢æ¨¡å‹å»åˆï¼Œä»è€Œé¿å…æˆ–å‡å°‘è¡¨è¿æ¥ã€‚</p><p>æˆ‘ç”»å‡ºäº†è¿™ç§è®¾è®¡çš„æ¶æ„å›¾ï¼Œä¾›ä½ å‚è€ƒã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b7/6b/b7e1d8a47336ceafe40abe34913cb16b.jpg?wh=3600x3956\" alt=\"\"></p><p>ç”±äºåŒ…å†…éƒ¨çš„ç»“æ„æ˜¯ç±»ä¼¼çš„ï¼Œæ‰€ä»¥è¿™å¼ å›¾å¿½ç•¥äº†å†…éƒ¨ç»†èŠ‚ï¼ŒåªåŒ…å«å¤–å±‚çš„åŒ…ç»“æ„ã€‚</p><p>æ•°æ®åº“é‡Œçš„è¡¨åˆ†æˆäº†ä¸¤å¥—â€”â€”å‘½ä»¤æ¨¡å‹ï¼ˆcommand modelï¼‰å’ŒæŸ¥è¯¢æ¨¡å‹ï¼ˆquery modelï¼‰ï¼Œåˆ†åˆ«ç”±å‘½ä»¤å¤„ç†å™¨å’ŒæŸ¥è¯¢å¤„ç†å™¨è®¿é—®ã€‚å…¶ä¸­å‘½ä»¤æ¨¡å‹ä¸­çš„è¡¨æ˜¯æ ¹æ®é¢†åŸŸæ¨¡å‹è®¾è®¡çš„ï¼ŒæŸ¥è¯¢æ¨¡å‹éƒ¨åˆ†çš„è¡¨å°±æ˜¯æ ¹æ®æŸ¥è¯¢éœ€æ±‚è¿›è¡Œäº†åè§„èŒƒåŒ–è®¾è®¡ã€‚</p><p>å‘½ä»¤å¤„ç†å™¨å¯¹å‘½ä»¤æ¨¡å‹é‡Œçš„è¡¨è¿›è¡Œæ“ä½œåï¼Œè¦æŠŠæ•°æ®åŒæ­¥ç»™æŸ¥è¯¢æ¨¡å‹ã€‚æœ‰å¤šç§åŒæ­¥æ–¹æ¡ˆå¯ä¾›é€‰æ‹©ï¼Œæ¯”å¦‚è¯´ï¼Œå‘½ä»¤æ¨¡å‹ä¸­çš„ä»“åº“ï¼ŒåŒæ—¶å†™ä¸¤è¾¹çš„æ•°æ®è¡¨ï¼Œæˆ–è€…ä½¿ç”¨è§¦å‘å™¨ï¼Œè¿˜å¯ä»¥ç”¨åŒæ­¥æˆ–å¼‚æ­¥çš„äº‹ä»¶é©±åŠ¨æœºåˆ¶ã€‚</p><h2>åè§„èŒƒåŒ–è®¾è®¡</h2><p>ä¸ºäº†å®ç°æ•°æ®åº“ç»“æ„åˆ†ç¦»ï¼Œéœ€è¦è¿›è¡Œåè§„èŒƒåŒ–è®¾è®¡ã€‚ä¸ºäº†å¸®ä½ æ·±å…¥äº†è§£è¿™ä¸€ç‚¹ï¼Œæˆ‘ç»™ä½ </p><p>ä¸¾ä¾‹è¯´æ˜ä¸€ä¸‹åè§„èŒƒåŒ–çš„è¡¨ç»“æ„è®¾è®¡ã€‚</p><p>å‘½ä»¤æ¨¡å‹é‡Œçš„<strong>å·¥æ—¶è®°å½•</strong>è¡¨æ˜¯åé¢è¿™æ ·ã€‚<br>\n<img src=\"https://static001.geekbang.org/resource/image/b0/00/b02654yy4bf7e1f64534a51c6d025800.jpg?wh=3600x2260\" alt=\"\"></p><p>è¿™ä¸ªè¡¨æˆ‘ä»¬åœ¨è¿­ä»£ä¸€è§è¿‡ç±»ä¼¼çš„ï¼Œç°åœ¨å”¯ä¸€çš„ä¸åŒæ˜¯åŸæ¥çš„ project_id ï¼ˆé¡¹ç›®IDï¼‰æ¢æˆäº†ç°åœ¨çš„ effort_item_idï¼ˆå·¥æ—¶é¡¹IDï¼‰ã€‚è¿™æ˜¯å› ä¸ºæœ€åˆçš„éœ€æ±‚åªæ˜¯ä¸ºé¡¹ç›®æŠ¥å·¥æ—¶ï¼Œè€Œç°åœ¨è¦ä¸ºæ›´å¹¿ä¹‰çš„å·¥æ—¶é¡¹æŠ¥å·¥æ—¶äº†ã€‚</p><p>æŸ¥è¯¢æ¨¡å‹é‡Œçš„<strong>å‘˜å·¥å·¥æ—¶è®°å½•</strong>è¡¨æ˜¯åé¢è¿™æ ·ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/0f/a0/0f98102d7bffd82b823cea6b78d55ea0.jpg?wh=3600x2179\" alt=\"\"></p><p>å…¶å®è¡¨è®¾è®¡çš„å˜åŒ–å¾ˆç®€å•ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨è¡¨é‡Œå¢åŠ äº† emp_numï¼ˆå‘˜å·¥å·ï¼‰å’Œ emp_nameï¼ˆå‘˜å·¥å§“åï¼‰ä¸¤ä¸ªå­—æ®µã€‚åŒæ—¶åœ¨åŸæ¥çš„è¡¨åå‰é¢å¢åŠ äº† emp ï¼Œè¡¨ç¤ºæ˜¯å‘˜å·¥è¡¨å’Œå·¥æ—¶è®°å½•è¡¨åˆå¹¶çš„è¡¨ã€‚</p><p>ä¸ºä»€ä¹ˆè¯´è¿™æ ·å°±â€œåè§„èŒƒåŒ–â€äº†å‘¢ï¼Ÿ</p><p>è¿™æ˜¯å› ä¸ºåœ¨è¿™ä¸ªè¡¨é‡Œï¼Œemp_num å’Œ emp_name æ˜¯å¯ä»¥ç”±emp_id å”¯ä¸€ç¡®å®šçš„ã€‚è¿™ç§æƒ…å†µåœ¨æ•°æ®åº“è®¾è®¡æœ¯è¯­ä¸Šå«åš â€œemp_num å’Œ emp_name å‡½æ•°ä¾èµ–äº emp_idâ€ï¼Œç®€ç§° â€œemp_num å’Œ emp_name ä¾èµ–äº emp_idâ€ã€‚æ³¨æ„ï¼Œè¿™é‡Œè¯´çš„æ•°æ®åº“è®¾è®¡æ„ä¹‰ä¸Šçš„ä¾èµ–ï¼Œå’Œ UML é‡Œçš„ä¾èµ–ä¸æ˜¯ä¸€ä¸ªæ¦‚å¿µã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œemp_id åˆæ˜¯ä¾èµ–äºè¿™ä¸ªè¡¨çš„ id çš„ã€‚è¿™æ—¶å°±å¯ä»¥è¯´ï¼Œemp_num å’Œ emp_name ä¼ é€’ä¾èµ–äº id ã€‚å‡¡æ˜¯ä¸€ä¸ªè¡¨é‡Œæœ‰ä¼ é€’ä¾èµ–å…³ç³»çš„ï¼Œè¿™ä¸ªè¡¨å°±è¿åäº†ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰ã€‚</p><p>è‡³äºç¬¬äºŒèŒƒå¼æ˜¯æ€ä¹ˆå›äº‹ï¼Œä½ æœ‰å…´è¶£çš„è¯ï¼Œæ‰¾ä¸€æœ¬æ•°æ®åº“è®¾è®¡çš„ä¹¦çœ‹çœ‹å°±å¯ä»¥äº†ã€‚æˆ‘è¿™é‡Œåªè¯´ä¸€å¥ï¼Œå¦‚æœä¸€ä¸ªè¡¨é‡Œåªæœ‰ä¸€ä¸ªå­—æ®µï¼ˆä¾‹å¦‚ idï¼‰åšä¸»é”®ï¼Œé‚£ä¹ˆåœ¨åŸç†ä¸Šå°±æ˜¯ä¸å¯èƒ½è¿åç¬¬äºŒèŒƒå¼çš„ã€‚</p><p>åœ¨å‘½ä»¤æ¨¡å‹é‡Œï¼Œä¸€èˆ¬æ˜¯ä¸ä¸»å¼ è¿åèŒƒå¼çš„ï¼Œè¿™æ˜¯å› ä¸ºè¿åèŒƒå¼å¿…ç„¶é€ æˆæ•°æ®å†—ä½™ï¼Œæ•°æ®å†—ä½™å°±ä¼šé€ æˆæ½œåœ¨çš„æ•°æ®ä¸ä¸€è‡´é£é™©ã€‚è€Œåœ¨æŸ¥è¯¢æ¨¡å‹ä¸­ï¼Œä¸ä»…å…è®¸ï¼Œç”šè‡³æ˜¯é¼“åŠ±åè§„èŒƒåŒ–è®¾è®¡ã€‚è¿™æ˜¯å› ä¸ºï¼Œå¯¹äºæŸ¥è¯¢æ¨¡å‹ï¼Œåè§„èŒƒåŒ–çš„é£é™©æ˜¯å¯æ§çš„ã€‚å°±ç®—æ•°æ®å‘ç”Ÿäº†ä¸ä¸€è‡´ï¼Œæ€»å¯ä»¥ä»å‘½ä»¤æ¨¡å‹é‡ŒæŒ‰æ­£ç¡®çš„é€»è¾‘é‡æ–°ç”Ÿæˆä¸€éã€‚</p><p>å¦‚æœä½ ä¸æ»¡è¶³äºä»…ä»…åœ¨ç‰©ç†æ•°æ®æ¨¡å‹ä¸Šè¡¨ç¤ºå‡ºæŸ¥è¯¢æ¨¡å‹ï¼Œè¿˜æƒ³åœ¨é¢†åŸŸæ¨¡å‹å±‚é¢æŠŠå‘½ä»¤æ¨¡å‹å’ŒæŸ¥è¯¢æ¨¡å‹çš„å…³ç³»è¡¨ç¤ºå¾—æ›´æ¸…æ¥šï¼Œå¯ä»¥æŠŠå›¾ç”»æˆè¿™æ ·ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/c1/80/c151bbe9021c2ayy412c562c72ac5880.jpg?wh=3600x2179\" alt=\"\"></p><p>åœ¨è¿™ä¸ªå›¾é‡Œï¼Œ<strong>å·¥æ—¶è®°å½•</strong>å’Œ<strong>å‘˜å·¥</strong>æ˜¯åŸæ¥é¢†åŸŸæ¨¡å‹é‡Œçš„å®ä½“ï¼Œæ²¡æœ‰å˜åŒ–ã€‚è€Œ<strong>å‘˜å·¥å·¥æ—¶è®°å½•</strong>åˆ™æ˜¯æŸ¥è¯¢æ¨¡å‹ä¸­çš„â€œæŸ¥è¯¢å®ä½“â€ï¼ˆæˆ‘ä»¬å§‘ä¸”è¿™ä¹ˆå‘½åå§ï¼‰ã€‚æˆ‘ä»¬ç”¨è‡ªå®šä¹‰çš„&lt;&lt;query model&gt;&gt;è¡å‹æ¥è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ªæŸ¥è¯¢æ¨¡å‹é‡Œçš„æŸ¥è¯¢å®ä½“ã€‚</p><p><strong>å‘˜å·¥å·¥æ—¶è®°å½•</strong>ä¸­çš„æ•°æ®æ˜¯æ¥æºäº<strong>å·¥æ—¶è®°å½•</strong>å’Œ<strong>å‘˜å·¥</strong>çš„ï¼Œæ‰€ä»¥å¯¹è¿™ä¸¤ä¸ªå®ä½“æœ‰ä¾èµ–å…³ç³»ã€‚å¦å¤–ï¼Œæˆ‘ä»¬åœ¨ä¾èµ–å…³ç³»ä¸ŠåŠ äº†&lt;&lt;trace&gt;&gt;ã€‚è¿™æ˜¯ UML é‡Œçš„æ ‡å‡†è¡å‹ï¼Œè¡¨ç¤ºâ€œè¿½æº¯â€çš„æ„æ€ã€‚è¿™æ˜¯å› ä¸ºï¼Œ<strong>å‘˜å·¥å·¥æ—¶è®°å½•</strong>é‡Œçš„ä¿¡æ¯ï¼Œæ€»èƒ½è¿½æº¯å›<strong>å·¥æ—¶è®°å½•</strong>å’Œ<strong>å‘˜å·¥</strong>ï¼Œä»è€ŒçŸ¥é“æ•°æ®çš„æ¥æºã€‚</p><p>é¡ºä¾¿è¯´ä¸€å¥ï¼Œæˆ‘ä»¬åŸæ¥è¯´è¿‡é¢†åŸŸæ¨¡å‹å’Œè®¾è®¡æ¨¡å‹çš„åŒºåˆ«ï¼Œå¦‚æœä½ æ„¿æ„çš„è¯ï¼Œé¢†åŸŸæ¨¡å‹é‡Œçš„ä¸€ä¸ªå®ä½“å’Œè®¾è®¡æ¨¡å‹é‡Œçš„å¯¹åº”å®ä½“ï¼Œä¹Ÿå¯ä»¥ç”¨ &lt;&lt;trace&gt;&gt; ä¾èµ–æ¥å…³è”èµ·æ¥ï¼Œè¡¨ç¤ºä¸¤è€…ä¹‹é—´çš„æ¥æºå…³ç³»ã€‚</p><p>æˆ‘æŠŠè¿™ç§å›¾ç§°ä¸ºâ€œæŸ¥è¯¢æ¨¡å‹å›¾â€ï¼Œä¸€èˆ¬ä¼šå•ç‹¬ç”»å‡ºæ¥ï¼Œåªä¿ç•™å’ŒæŸ¥è¯¢æ¨¡å‹æœ‰å…³çš„å®ä½“å’Œå…³è”ã€‚å¦‚æœéƒ½ç”»åœ¨é¢†åŸŸæ¨¡å‹å›¾é‡Œï¼Œå°±å¤ªæ··ä¹±äº†ã€‚å½“æŸ¥è¯¢æ¨¡å‹é‡Œçš„è¡¨æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œå¦‚æœé æ‹è„‘è¢‹è®¾è®¡ï¼Œå°±å¯èƒ½è®¾è®¡å‡ºæ··ä¹±é‡å¤çš„è¡¨ç»“æ„ï¼Œæœ€ç»ˆå¯¼è‡´è®¾è®¡å¤±æ§ã€‚æœ‰äº†æŸ¥è¯¢æ¨¡å‹å›¾ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ä¸€ç§å—æ§çš„æ–¹å¼è¿›è¡Œåè§„èŒƒåŒ–çš„æ¨¡å‹è®¾è®¡äº†ã€‚</p><p>æ•°æ®åº“ç»“æ„åˆ†ç¦»ç­–ç•¥çš„å¥½å¤„æ˜¯æé«˜äº†æ€§èƒ½ã€‚ä½†è¿™ä¹ˆåšä¹Ÿæœ‰æ˜æ˜¾ä»£ä»·ï¼ŒåŒ…æ‹¬åé¢ä¸‰ä¸ªæ–¹é¢ã€‚</p><p>1.å¢åŠ äº†ä¸¤ç§æ•°æ®æ¨¡å‹åŒæ­¥çš„å¤æ‚æ€§å’Œå‡ºé”™çš„å¯èƒ½æ€§ã€‚<br>\n2.æ•°æ®åŒæ­¥å¯èƒ½å¸¦æ¥æ€§èƒ½æŸå¤±ã€‚<br>\n3.ä¼šå ç”¨é¢å¤–çš„å­˜å‚¨ç©ºé—´ã€‚</p><h2>æ€»ç»“</h2><p>å¥½ï¼Œè¿™èŠ‚è¯¾å…ˆè®²åˆ°è¿™ï¼Œä¸‹é¢æ¥æ€»ç»“ä¸€ä¸‹ã€‚</p><p>ä»Šå¤©æˆ‘ä»¬å­¦ä¹ äº† CQRS ï¼ˆCommand Query Responsibility Segregationï¼‰ï¼Œä¹Ÿå°±æ˜¯â€œå‘½ä»¤å’ŒæŸ¥è¯¢èŒè´£åˆ†ç¦»â€æ¨¡å¼ã€‚</p><p>å°½ç®¡é€šè¿‡ DDD çš„é¢†åŸŸæ¨¡å‹å®Œæˆå¢ã€åˆ ã€æ”¹ç­‰åŠŸèƒ½æ˜¯å¾ˆé€‚åˆçš„ï¼Œä½†æ˜¯é€šè¿‡é¢†åŸŸæ¨¡å‹æ¥å®ç°æŸ¥è¯¢åŠŸèƒ½ï¼Œå¸¸å¸¸æ˜¯æ¯”è¾ƒç¹ççš„ï¼Œè€Œä¸”æ€§èƒ½ä¹Ÿä¸é«˜ã€‚å› æ­¤ï¼Œ CQRS å°±æˆäº† DDD çš„æœ‰åŠ›è¡¥å……ã€‚</p><p>æ ¹æ® CQRS ï¼Œå‘½ä»¤ï¼ˆä¹Ÿå°±æ˜¯å¢ã€åˆ ã€æ”¹åŠŸèƒ½ï¼‰å’ŒæŸ¥è¯¢åŠŸèƒ½çš„å®ç°é€»è¾‘åº”è¯¥æ˜¯ä¸ä¸€æ ·çš„ã€‚ä¸ºäº†å¤„ç†è¿™ç§ä¸ä¸€æ ·çš„é€»è¾‘ï¼Œæˆ‘ä»¬ä»Šå¤©è®²äº†ä¸¤ç§ç­–ç•¥ï¼šä»£ç ç»“æ„åˆ†ç¦»å’Œæ•°æ®åº“ç»“æ„åˆ†ç¦»ã€‚</p><p>ä¸ºäº†å®ç°æ•°æ®åº“ç»“æ„åˆ†ç¦»ï¼Œæˆ‘ä»¬ä¹Ÿè®¨è®ºäº†æ€æ ·è¿›è¡Œåè§„èŒƒåŒ–è®¾è®¡ï¼Œä»¥åŠè¿™ç§è®¾è®¡æ˜¯æ€æ ·è¿åç¬¬ä¸‰èŒƒå¼çš„ï¼Œä»è€Œè®©ä½ äº†è§£èƒŒåçš„æ‰€ä»¥ç„¶ã€‚</p><p>å¦å¤–ï¼Œæˆ‘ä»¬è¿˜ä»‹ç»äº†â€œæŸ¥è¯¢æ¨¡å‹å›¾â€ï¼Œæœ‰äº†å®ƒï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æ›´é«˜çš„å±‚é¢ï¼Œå¯¹æŸ¥è¯¢æ¨¡å‹è¿›è¡Œç³»ç»ŸåŒ–çš„è®¾è®¡ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ€åç»™ä½ ç•™ä¸¤é“æ€è€ƒé¢˜ã€‚</p><p>1.ä»Šå¤©è¯¾ç¨‹ä¸­çš„éœ€æ±‚å…¶å®åšäº†ç®€åŒ–ï¼Œæ²¡æœ‰è€ƒè™‘â€œçˆ¶å­å·¥æ—¶é¡¹â€ä»¥åŠâ€œä¸åœ¨æœ¬çº§æŠ¥å·¥æ—¶â€çš„æƒ…å†µï¼Œå¦‚æœè€ƒè™‘äº†è¿™ä¸¤ç§æƒ…å†µï¼Œç”šè‡³æœ¬çº§å’Œä¸‹çº§å­å·¥æ—¶é¡¹éƒ½èƒ½æŠ¥å·¥æ—¶ï¼Œé‚£ä¹ˆ SQL è¯­å¥å°±ä¸å¤ªå¥½å†™äº†ã€‚è¿™æ—¶å€™ï¼Œä½ è§‰å¾—å¯ä»¥ç”¨ä»€ä¹ˆåŠæ³•å¤„ç†å‘¢ï¼Ÿ</p><p>2.æˆ‘ä»¬ä»Šå¤©è°ˆåè§„èŒƒåŒ–çš„æ—¶å€™ï¼Œæ˜¯å¦å¤–å»ºç«‹äº†ä¸€å¥—è¡¨ã€‚è¿˜æœ‰ä¸€ç§ç­–ç•¥ï¼Œæ˜¯ç›´æ¥åœ¨åŸæ¥ä¸ºé¢†åŸŸæ¨¡å‹å»ºçš„è¡¨ä¸Šè¿›è¡Œåè§„èŒƒåŒ–ã€‚ä½ è§‰å¾—è¿™ä¸¤ç§ç­–ç•¥å„è‡ªçš„åˆ©å¼Šæ˜¯ä»€ä¹ˆï¼Ÿ</p><p>å¥½ï¼Œä»Šå¤©çš„è¯¾ç¨‹ç»“æŸäº†ï¼Œæœ‰ä»€ä¹ˆé—®é¢˜æ¬¢è¿ä½ åœ¨è¯„è®ºåŒºç•™è¨€ã€‚ä¸‹èŠ‚è¯¾ï¼Œæˆ‘å†å¸¦ä½ äº†è§£å®ç° CQRS çš„å¦å¤–å‡ ç§ç­–ç•¥ï¼Œæ•¬è¯·æœŸå¾…ã€‚</p>","comments":[{"had_liked":false,"id":369186,"user_name":"è™šç«¹","can_delete":false,"product_type":"c1","uid":1691109,"ip_address":"åŒ—äº¬","ucode":"8D8C96C793724E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJIocn8OMjfSGqyeSJEV3ID2rquLR0S6xo0ibdNYQgzicib6L6VlqWjhgxOqD2iaicX1KhbWXWCsmBTskA/132","comment_is_top":false,"comment_ctime":1677211021,"is_pvip":false,"replies":[{"id":134797,"content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1288110,"ctime":1677939378,"ip_address":"å¹¿ä¸œ","comment_id":369186,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100311801,"comment_content":"è¿˜æœ‰ä¸€ç§å¸¸ç”¨æ–¹å¼ï¼Œæ˜¯å†™åˆ°mysqlé‡Œï¼Œå¼‚æ„åˆ°mongoé‡Œä¸€ä»½ç”¨æ¥æŸ¥è¯¢ï¼Œ","like_count":6,"discussions":[{"author":{"id":1288110,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VBLEAcychgbs5CicUczSYcibicoicZmyk1JHHFiae94KuvVsibAKtcQAvnOPWp0C4yvia8mzvQAORiazjWSoc1XQ9QkLrQ/132","nickname":"é’Ÿæ•¬","note":"","ucode":"20B3D31A2C8C86","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":607560,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677939378,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3326979,"avatar":"https://static001.geekbang.org/account/avatar/00/32/c4/03/511aa353.jpg","nickname":"H","note":"","ucode":"06D57447BF1A47","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":608675,"discussion_content":"è¯·é—®ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨mongoï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1678600447,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3506330,"avatar":"https://static001.geekbang.org/account/avatar/00/35/80/9a/692637f6.jpg","nickname":"æ›¹å¤æ˜","note":"","ucode":"23B55F5F10881E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":609741,"discussion_content":"æ˜¯ä¸æ˜¯è¯´åäº†å‘€ï¼Œç”¨mongoDBä½œä¸ºå†™æ•°æ®åº“ï¼ˆæ²¡æœ‰é˜»æŠ—é€‚é…é—®é¢˜ï¼‰ï¼Œç„¶åç”¨å…³ç³»æ•°æ®åº“ä½œä¸ºè¯»æ•°æ®åº“ï¼Œæé«˜æŸ¥è¯¢çš„çµæ´»æ€§ï¼Œæ˜¯ä¸æ˜¯æ›´å¥½ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679153366,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸­å›½å°æ¹¾","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1129601,"avatar":"https://static001.geekbang.org/account/avatar/00/11/3c/81/7ccdb399.jpg","nickname":"+ ç³ ","note":"","ucode":"2D5A91900FCA43","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":3506330,"avatar":"https://static001.geekbang.org/account/avatar/00/35/80/9a/692637f6.jpg","nickname":"æ›¹å¤æ˜","note":"","ucode":"23B55F5F10881E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634885,"discussion_content":"å†™è¿˜æ˜¯ä»¥å…³ç³»å‹æ•°æ®åº“ä¸ºä¸»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704180420,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":609741,"ip_address":"å¹¿ä¸œ","group_id":0},"score":634885,"extra":""}]}]},{"had_liked":false,"id":370115,"user_name":"èµµæ™é¾™","can_delete":false,"product_type":"c1","uid":2673605,"ip_address":"æ¹–å—","ucode":"F15730BCA97EE0","user_header":"https://static001.geekbang.org/account/avatar/00/28/cb/c5/c1d7ca5e.jpg","comment_is_top":false,"comment_ctime":1678410634,"is_pvip":false,"replies":[{"id":134939,"content":"CQRSçš„æœ¬è´¨ï¼Œé™¤äº†å†—ä½™ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯å¦ç»•è¿‡é¢†åŸŸæ¨¡å‹çš„é—®é¢˜ï¼Œæˆ–è€…è¯´ï¼Œåœ¨é¢†åŸŸæ¨¡å‹ä¹‹å¤–ï¼Œæ˜¯å¦ä¸“é—¨è€ƒè™‘â€œæŸ¥è¯¢æ¨¡å‹â€çš„é—®é¢˜ã€‚\n\nç¬¬ä¸€é¢˜ï¼Œæ˜¯ä¸ªä¸é”™çš„æ€è·¯\nç¬¬äºŒé¢˜ï¼Œè¿˜æœ‰ä¸€ä¸ªè§’åº¦ä¾›æ‚¨å‚è€ƒï¼Œå¦‚æœåˆ†å¼€ä¸¤å¥—è¡¨ï¼Œç”±äºå„è‡ªæ¯”è¾ƒå•çº¯ï¼Œæ˜¯å¦åè€Œé™ä½äº†è®¤çŸ¥è´Ÿè½½ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1288110,"ctime":1678506867,"ip_address":"å¹¿ä¸œ","comment_id":370115,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100311801,"comment_content":"å¥½å¤šäººéƒ½è§‰å¾—CQRSå°±ä¸€å®šæ˜¯EventSourcingï¼Œå°±ä¸€å®šæ˜¯ä¸¤ä¸ªåº“ã€‚æˆ‘ä¹Ÿæ˜¯å»å¹´çš„æ—¶å€™çªç„¶é¡¿æ‚Ÿï¼Œå…¶å®CQRSçš„æœ¬è´¨å°±æ˜¯å†—ä½™ã€‚\n1ã€æˆ‘ä¼šè€ƒè™‘è¿›ä¸€æ­¥æŠ½è±¡ï¼Œç”šè‡³æŸ¥è¯¢æ¨¡å‹ç›´æ¥è®°å½•ç»Ÿè®¡çš„æœ€ç»ˆæ•°æ®ã€‚\n2ã€åˆ†è¡¨èƒ½å¤Ÿåˆ†ç¦»å˜ä¸ä¸å˜çš„ä¸œè¥¿ï¼Œä½†ä¼šå¢åŠ é¢å¤–çš„æ•°æ®åŒæ­¥å¼€å‘å·¥ä½œå’Œè®¤çŸ¥è´Ÿè½½ï¼Œå¦‚æœåŠ ä¸Šå†å²æ•°æ®çš„è¿ç§»ï¼Œå·¥ä½œé‡ä¼šè¶Šæ¥è¶Šå¤šã€‚ä¸åˆ†è¡¨ä¼šå½±å“é¢†åŸŸçš„ç›¸å¯¹ä¸å˜æ€§ï¼Œä½†æ˜¯è®¤çŸ¥è´Ÿè½½å¯èƒ½ä¼šç›¸å¯¹è¾ƒä½ã€‚è¿™å°†ä¼šæ˜¯ä¸€ä¸ªæƒè¡¡ï¼Œæ²¡æœ‰é“¶å¼¹ã€‚","like_count":4,"discussions":[{"author":{"id":1288110,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VBLEAcychgbs5CicUczSYcibicoicZmyk1JHHFiae94KuvVsibAKtcQAvnOPWp0C4yvia8mzvQAORiazjWSoc1XQ9QkLrQ/132","nickname":"é’Ÿæ•¬","note":"","ucode":"20B3D31A2C8C86","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":608540,"discussion_content":"CQRSçš„æœ¬è´¨ï¼Œé™¤äº†å†—ä½™ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯å¦ç»•è¿‡é¢†åŸŸæ¨¡å‹çš„é—®é¢˜ï¼Œæˆ–è€…è¯´ï¼Œåœ¨é¢†åŸŸæ¨¡å‹ä¹‹å¤–ï¼Œæ˜¯å¦ä¸“é—¨è€ƒè™‘â€œæŸ¥è¯¢æ¨¡å‹â€çš„é—®é¢˜ã€‚\n\nç¬¬ä¸€é¢˜ï¼Œæ˜¯ä¸ªä¸é”™çš„æ€è·¯\nç¬¬äºŒé¢˜ï¼Œè¿˜æœ‰ä¸€ä¸ªè§’åº¦ä¾›æ‚¨å‚è€ƒï¼Œå¦‚æœåˆ†å¼€ä¸¤å¥—è¡¨ï¼Œç”±äºå„è‡ªæ¯”è¾ƒå•çº¯ï¼Œæ˜¯å¦åè€Œé™ä½äº†è®¤çŸ¥è´Ÿè½½ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1678506867,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2673605,"avatar":"https://static001.geekbang.org/account/avatar/00/28/cb/c5/c1d7ca5e.jpg","nickname":"èµµæ™é¾™","note":"","ucode":"F15730BCA97EE0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1288110,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VBLEAcychgbs5CicUczSYcibicoicZmyk1JHHFiae94KuvVsibAKtcQAvnOPWp0C4yvia8mzvQAORiazjWSoc1XQ9QkLrQ/132","nickname":"é’Ÿæ•¬","note":"","ucode":"20B3D31A2C8C86","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":608798,"discussion_content":"ç¡®å®æœ‰æ›´ä½çš„å¯èƒ½ã€‚æˆ‘å†æƒ³æƒ³","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678668269,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":608540,"ip_address":"æ¹–å—","group_id":0},"score":608798,"extra":""}]},{"author":{"id":1177832,"avatar":"https://static001.geekbang.org/account/avatar/00/11/f8/e8/bbd1b66d.jpg","nickname":"ğŸ„ğŸ»ç±³å…°çš„å¤§é“åŒ ğŸ¤ğŸˆ","note":"","ucode":"704DB6905F96D1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":620221,"discussion_content":"è¿™ä¸ªé—®é¢˜é˜¿é‡Œå¼€å‘è§„èŒƒä¸Šå¥½åƒæåˆ°è¿‡ï¼Œä¸æå€¡å†—ä½™çš„æ–¹å¼ï¼Œå»ºè®®ç”¨&#34;å­æŸ¥è¯¢&#34;çš„æ–¹å¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1685958473,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¤©æ´¥","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":369756,"user_name":"å—å±±","can_delete":false,"product_type":"c1","uid":1119593,"ip_address":"æ±Ÿè‹","ucode":"94656FE4A6C378","user_header":"https://static001.geekbang.org/account/avatar/00/11/15/69/187b9968.jpg","comment_is_top":false,"comment_ctime":1677890490,"is_pvip":false,"replies":[{"id":134722,"content":"é¦–å…ˆï¼Œè¯¾ç¨‹é‡Œæ²¡æœ‰è¯´æŸ¥è¯¢ä»£ç çš„repositoryä¾èµ–DTOã€‚\nå…¶æ¬¡ï¼ŒæŸ¥è¯¢çš„repositoryç”¨æ¥ç›´æ¥æŸ¥å‡ºå®¢æˆ·ç«¯éœ€è¦çš„DTOï¼Œé¢†åŸŸå±‚çš„æŸ¥å‡ºèšåˆï¼Œè¿™ä¸€ç‚¹æ˜¯ä¸åŒçš„ã€‚ä¸¤è€…çš„åå­—ä¸€æ ·ï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿ã€‚ä¹Ÿå¯ä»¥èµ·ä¸åŒçš„åå­—ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1288110,"ctime":1677918319,"ip_address":"å¹¿ä¸œ","comment_id":369756,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100311801,"comment_content":"æŸ¥è¯¢çš„ä»£ç ä¸­ repositoryæ”¾åœ¨äº†applicationå±‚ï¼Œä¾èµ–dtoï¼Œè¿™é‡Œçš„repositoryè·Ÿé¢†åŸŸå±‚çš„é‚£ä¸ªæ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿæˆ–è€…æ˜¯ä¸¤ä¸ªå—ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1288110,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VBLEAcychgbs5CicUczSYcibicoicZmyk1JHHFiae94KuvVsibAKtcQAvnOPWp0C4yvia8mzvQAORiazjWSoc1XQ9QkLrQ/132","nickname":"é’Ÿæ•¬","note":"","ucode":"20B3D31A2C8C86","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":607470,"discussion_content":"é¦–å…ˆï¼Œè¯¾ç¨‹é‡Œæ²¡æœ‰è¯´æŸ¥è¯¢ä»£ç çš„repositoryä¾èµ–DTOã€‚\nå…¶æ¬¡ï¼ŒæŸ¥è¯¢çš„repositoryç”¨æ¥ç›´æ¥æŸ¥å‡ºå®¢æˆ·ç«¯éœ€è¦çš„DTOï¼Œé¢†åŸŸå±‚çš„æŸ¥å‡ºèšåˆï¼Œè¿™ä¸€ç‚¹æ˜¯ä¸åŒçš„ã€‚ä¸¤è€…çš„åå­—ä¸€æ ·ï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿ã€‚ä¹Ÿå¯ä»¥èµ·ä¸åŒçš„åå­—ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677918319,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":369610,"user_name":"Fredo","can_delete":false,"product_type":"c1","uid":1438470,"ip_address":"å¹¿ä¸œ","ucode":"681D6692617DAB","user_header":"https://static001.geekbang.org/account/avatar/00/15/f3/06/8da1bf0c.jpg","comment_is_top":false,"comment_ctime":1677725274,"is_pvip":false,"replies":[{"id":134730,"content":"ä¸é”™","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1288110,"ctime":1677919783,"ip_address":"å¹¿ä¸œ","comment_id":369610,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100311801,"comment_content":"1. å•ç‹¬æä¸€å¼ å®½è¡¨ï¼Œå†—ä½™å­˜ç”¨æ¥æŸ¥è¯¢å‘¢ã€‚å¦‚æœæ˜¯æŠ¥è¡¨å¯èƒ½ä¼šè¿™æ ·åš\n2. ç›´æ¥åœ¨åŸå…ˆçš„è¡¨ä¸Šå¼„ä¼šæœ‰ä¸€å®šçš„é£é™©ï¼Œæ•°æ®ä¸€è‡´æ€§è¦ç‰¹åˆ«å…³æ³¨ï¼›ç»´æŠ¤ä¸¤å¥—çš„è¯ï¼Œå…³æ³¨ç‚¹åˆ†ç¦»ï¼ŒèŒè´£æ¸…æ™°ï¼Œä½†ç»´æŠ¤æˆæœ¬ä¸Šå»äº†ã€‚","like_count":2,"discussions":[{"author":{"id":1288110,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VBLEAcychgbs5CicUczSYcibicoicZmyk1JHHFiae94KuvVsibAKtcQAvnOPWp0C4yvia8mzvQAORiazjWSoc1XQ9QkLrQ/132","nickname":"é’Ÿæ•¬","note":"","ucode":"20B3D31A2C8C86","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":607481,"discussion_content":"ä¸é”™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677919783,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1803623,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/85/67/0d121bc4.jpg","nickname":"ç¥ç»è›™","note":"","ucode":"2D71FC12E420AB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":607430,"discussion_content":"æ•°æ®é‡ä¸€å¤§ä¸€updateé”ä¸€å †è®°å½•ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677856950,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":369513,"user_name":"aoe","can_delete":false,"product_type":"c1","uid":1121758,"ip_address":"æµ™æ±Ÿ","ucode":"1C6201EDB4E954","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","comment_is_top":false,"comment_ctime":1677633135,"is_pvip":false,"replies":[{"id":134734,"content":"æ˜¯çš„ï¼Œè¿™å·²ç»æ˜¯CQRSæ€æƒ³çš„è¿ç”¨äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1288110,"ctime":1677920326,"ip_address":"å¹¿ä¸œ","comment_id":369513,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100311801,"comment_content":"æˆ‘ä»¬å¤§éƒ¨åˆ†è®©äººå¤´ç–¼çš„ç»Ÿè®¡æ•°æ®ï¼Œå°±æ˜¯ç‹¬ç«‹ä¸€å¼ è¡¨å­˜å‚¨çš„ï¼Œå•è¡¨æŸ¥è¯¢å‡ºç»“æœï¼Œé‡åˆ°æ•°æ®æœ‰é—®é¢˜æ—¶ï¼Œé‡æ–°è®¡ç®—ä¸€éã€‚\nç›¸æ¯”å¤æ‚çš„è¿è¡¨æŸ¥è¯¢ï¼Œè¿™ç§æ–¹å¼è½»æ¾æ„‰å¿«ï¼Œå®ç°ç®€å•ï¼Œé¢å¤–æ”¯å‡ºçš„å­˜å‚¨ç©ºé—´å€¼äº†ï¼šç©ºé—´æ¢æ—¶é—´","like_count":1,"discussions":[{"author":{"id":1288110,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VBLEAcychgbs5CicUczSYcibicoicZmyk1JHHFiae94KuvVsibAKtcQAvnOPWp0C4yvia8mzvQAORiazjWSoc1XQ9QkLrQ/132","nickname":"é’Ÿæ•¬","note":"","ucode":"20B3D31A2C8C86","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":607485,"discussion_content":"æ˜¯çš„ï¼Œè¿™å·²ç»æ˜¯CQRSæ€æƒ³çš„è¿ç”¨äº†ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1677920327,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":393114,"user_name":"æ¨±èŠ±","can_delete":false,"product_type":"c1","uid":1057456,"ip_address":"å¹¿ä¸œ","ucode":"432F43127D847A","user_header":"https://static001.geekbang.org/account/avatar/00/10/22/b0/050676f5.jpg","comment_is_top":false,"comment_ctime":1722913251,"is_pvip":false,"replies":[{"id":143639,"content":"ä¸æ˜¯åŒä¸€ä¸ªèšåˆã€‚è·¨èšåˆæŸ¥è¯¢ï¼Œå¯¹äºâ€œCâ€è€Œè¨€ä¸å¯ä»¥ï¼Œå¯¹äº&quot;Q&quot;è€Œè¨€å¯ä»¥ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1288110,"ctime":1731400307,"ip_address":"å¹¿ä¸œ","comment_id":393114,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100311801,"comment_content":"empå’Œemp_effort_recordç®—ä¸€ä¸ªèšåˆé‡Œçš„å¯¹è±¡å—ï¼Ÿ\næˆ–è€…è¯´ä¸€ä¸ªrepoå¯ä»¥è·¨èšåˆæŸ¥è¯¢å—","like_count":0,"discussions":[{"author":{"id":1288110,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VBLEAcychgbs5CicUczSYcibicoicZmyk1JHHFiae94KuvVsibAKtcQAvnOPWp0C4yvia8mzvQAORiazjWSoc1XQ9QkLrQ/132","nickname":"é’Ÿæ•¬","note":"","ucode":"20B3D31A2C8C86","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":653696,"discussion_content":"ä¸æ˜¯åŒä¸€ä¸ªèšåˆã€‚è·¨èšåˆæŸ¥è¯¢ï¼Œå¯¹äºâ€œCâ€è€Œè¨€ä¸å¯ä»¥ï¼Œå¯¹äº&#34;Q&#34;è€Œè¨€å¯ä»¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1731400308,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":391365,"user_name":"InfoQ_å°æ±¤","can_delete":false,"product_type":"c1","uid":1739070,"ip_address":"æ±Ÿè‹","ucode":"E4C30DB7A9B54C","user_header":"https://static001.geekbang.org/account/avatar/00/1a/89/3e/0dd8e96b.jpg","comment_is_top":false,"comment_ctime":1718117343,"is_pvip":false,"replies":[{"id":143667,"content":"è¿™é‡Œæœ‰ä¸€ä¸ªå¾®å¦™çš„åœ°æ–¹ï¼šå…¶å®æŸ¥è¯¢æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ä¸ºäº†å®ç°å¢åˆ æ”¹é€»è¾‘è€ŒæŸ¥ï¼Œå®¢æˆ·ç«¯çš„ç›®çš„æ˜¯å¢åˆ æ”¹ï¼Œè€Œä¸æ˜¯â€œæŸ¥â€ï¼Œå°½ç®¡åœ¨å¢åˆ æ”¹é€»è¾‘å†…éƒ¨ç¡®å®è¦æŸ¥ä¸€ä¸‹ï¼›å¦ä¸€ç§æ˜¯çº¯ç²¹çš„æŸ¥ï¼Œå®¢æˆ·ç«¯çš„ç›®çš„å°±æ˜¯æŸ¥è¯¢æœ¬èº«ã€‚\nCQRSä¸­çš„ Q å®é™…ä¸ŠæŒ‡ç¬¬äºŒç§çº¯ç²¹çš„æŸ¥ã€‚è€Œç¬¬ä¸€ç§æŸ¥è¯¢ä¸æ˜¯CQRSæ„ä¹‰ä¸Šçš„ Qã€‚\nä¸¤ç§æŸ¥è¯¢ä¸€èˆ¬åˆ†åˆ«å®ç°ï¼Œç¬¬ä¸€ç§æŸ¥è¯¢è¿”å›é¢†åŸŸå¯¹è±¡æœ¬èº«ï¼Œç¬¬äºŒç§è¿”å›DTOã€‚è¿™æ ·ï¼Œå°±ä¸å­˜åœ¨ä½ è¯´çš„è½¬æ¢é—®é¢˜äº†ã€‚\nå½“ç„¶ï¼Œè¿™åˆå¼•å‡ºå¦ä¸€ä¸ªé—®é¢˜ï¼Œå¯èƒ½ä¼šæœ‰é€»è¾‘é‡å¤çš„é—®é¢˜ï¼Œè¿™å°±è¦æƒè¡¡äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1288110,"ctime":1731490103,"ip_address":"å¹¿ä¸œ","comment_id":391365,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100311801,"comment_content":"å¦‚æœæ‰§è¡Œcqrsæ‹†å° è¿™ä¸ªæ—¶å€™æŸäº›å¢åˆ æ”¹çš„é€»è¾‘æ˜¯éœ€è¦æŸ¥è¯¢ä½œä¸ºè¾…åŠ©çš„ è¿™ä¸ªæ—¶å€™åšé¢†åŸŸé€»è¾‘ æ˜¯ä¸æ˜¯è¿˜ä¼šæ¶‰åŠåˆ°æŸ¥è¯¢dtoè·Ÿé¢†åŸŸå¯¹è±¡çš„è½¬æ¢å¤„ç†åœºæ™¯","like_count":0,"discussions":[{"author":{"id":1288110,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VBLEAcychgbs5CicUczSYcibicoicZmyk1JHHFiae94KuvVsibAKtcQAvnOPWp0C4yvia8mzvQAORiazjWSoc1XQ9QkLrQ/132","nickname":"é’Ÿæ•¬","note":"","ucode":"20B3D31A2C8C86","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":653870,"discussion_content":"è¿™é‡Œæœ‰ä¸€ä¸ªå¾®å¦™çš„åœ°æ–¹ï¼šå…¶å®æŸ¥è¯¢æœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯ä¸ºäº†å®ç°å¢åˆ æ”¹é€»è¾‘è€ŒæŸ¥ï¼Œå®¢æˆ·ç«¯çš„ç›®çš„æ˜¯å¢åˆ æ”¹ï¼Œè€Œä¸æ˜¯â€œæŸ¥â€ï¼Œå°½ç®¡åœ¨å¢åˆ æ”¹é€»è¾‘å†…éƒ¨ç¡®å®è¦æŸ¥ä¸€ä¸‹ï¼›å¦ä¸€ç§æ˜¯çº¯ç²¹çš„æŸ¥ï¼Œå®¢æˆ·ç«¯çš„ç›®çš„å°±æ˜¯æŸ¥è¯¢æœ¬èº«ã€‚\nCQRSä¸­çš„ Q å®é™…ä¸ŠæŒ‡ç¬¬äºŒç§çº¯ç²¹çš„æŸ¥ã€‚è€Œç¬¬ä¸€ç§æŸ¥è¯¢ä¸æ˜¯CQRSæ„ä¹‰ä¸Šçš„ Qã€‚\nä¸¤ç§æŸ¥è¯¢ä¸€èˆ¬åˆ†åˆ«å®ç°ï¼Œç¬¬ä¸€ç§æŸ¥è¯¢è¿”å›é¢†åŸŸå¯¹è±¡æœ¬èº«ï¼Œç¬¬äºŒç§è¿”å›DTOã€‚è¿™æ ·ï¼Œå°±ä¸å­˜åœ¨ä½ è¯´çš„è½¬æ¢é—®é¢˜äº†ã€‚\nå½“ç„¶ï¼Œè¿™åˆå¼•å‡ºå¦ä¸€ä¸ªé—®é¢˜ï¼Œå¯èƒ½ä¼šæœ‰é€»è¾‘é‡å¤çš„é—®é¢˜ï¼Œè¿™å°±è¦æƒè¡¡äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1731490103,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":388194,"user_name":"å‘¨æ˜Œæ­¦","can_delete":false,"product_type":"c1","uid":1115521,"ip_address":"å¹¿ä¸œ","ucode":"BA1408541DBAF9","user_header":"https://static001.geekbang.org/account/avatar/00/11/05/81/22fdfc58.jpg","comment_is_top":false,"comment_ctime":1709607211,"is_pvip":false,"replies":[{"id":141401,"content":"ç¬¬äºŒç§æ¯”è¾ƒå¥½","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1288110,"ctime":1709973466,"ip_address":"å¹¿ä¸œ","comment_id":388194,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100311801,"comment_content":"å¦‚æœåç»­æŸ¥è¯¢éœ€æ±‚å˜åŒ–ï¼Œéœ€è¦æ–°å¢æ˜¾ç¤ºå­—æ®µï¼Œå†—ä½™çš„ emp_effort_recordæ˜¯ä¸æ˜¯å°±å˜å¾—é¸¡è‚‹äº†ï¼Ÿè¿™ç§æƒ…å†µæœ‰å“ªäº›è§£å†³æ–¹æ¡ˆï¼Ÿ\n1. æå‰è€ƒè™‘emp_effort_recordè¡¨å¤šå†—ä½™äº›å­—æ®µï¼ˆå­˜åœ¨æœªæ¥å˜åŒ–ä¸ç¡®å®šæ€§ï¼Œè™½ç„¶æ˜¯é™ä½äº†ï¼‰\n2. éœ€æ±‚å˜åŒ–æ—¶emp_effort_recordæ·»åŠ æ–°å­—æ®µï¼ŒåŒæ—¶ä¿®æ”¹åŒæ­¥æ–¹æ¡ˆï¼ˆå¯èƒ½éœ€è¦è¡¥å†å²æ•°æ®ï¼Œæ ¹æ®å¯¹å†å²æ•°æ®æ˜¾ç¤ºè¦æ±‚è€Œå®šï¼‰\n\né’Ÿè€å¸ˆè¿˜æœ‰å…¶ä»–å¥½çš„æ–¹æ¡ˆå—","like_count":0,"discussions":[{"author":{"id":1288110,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VBLEAcychgbs5CicUczSYcibicoicZmyk1JHHFiae94KuvVsibAKtcQAvnOPWp0C4yvia8mzvQAORiazjWSoc1XQ9QkLrQ/132","nickname":"é’Ÿæ•¬","note":"","ucode":"20B3D31A2C8C86","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":638830,"discussion_content":"ç¬¬äºŒç§æ¯”è¾ƒå¥½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1709973466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":382241,"user_name":"æ— é—®","can_delete":false,"product_type":"c1","uid":1546586,"ip_address":"ä¸Šæµ·","ucode":"F841A16374CC84","user_header":"https://static001.geekbang.org/account/avatar/00/17/99/5a/32f3df3c.jpg","comment_is_top":false,"comment_ctime":1696928701,"is_pvip":false,"replies":[{"id":139702,"content":"ä¸å¤ªç†è§£æ‚¨çš„é—®é¢˜ï¼Œæ‚¨è¯´çš„æ¨¡å‹è½¬æ¢æŒ‡ä»€ä¹ˆï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1288110,"ctime":1699078512,"ip_address":"å¹¿ä¸œ","comment_id":382241,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100311801,"comment_content":"cqrsçš„æ¨¡å‹è½¬æ¢è¦å¦å¤–åœ¨å¼„ä¸€å¥—builderäº†å˜›","like_count":0,"discussions":[{"author":{"id":1288110,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VBLEAcychgbs5CicUczSYcibicoicZmyk1JHHFiae94KuvVsibAKtcQAvnOPWp0C4yvia8mzvQAORiazjWSoc1XQ9QkLrQ/132","nickname":"é’Ÿæ•¬","note":"","ucode":"20B3D31A2C8C86","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":630931,"discussion_content":"ä¸å¤ªç†è§£æ‚¨çš„é—®é¢˜ï¼Œæ‚¨è¯´çš„æ¨¡å‹è½¬æ¢æŒ‡ä»€ä¹ˆï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1699078512,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":377230,"user_name":"+ ç³ ","can_delete":false,"product_type":"c1","uid":1129601,"ip_address":"å¹¿ä¸œ","ucode":"2D5A91900FCA43","user_header":"https://static001.geekbang.org/account/avatar/00/11/3c/81/7ccdb399.jpg","comment_is_top":false,"comment_ctime":1688106492,"is_pvip":false,"replies":[{"id":137719,"content":"æœåŠ¡ä¸åº”è¯¥æ ¹æ®èšåˆæ‹†åˆ†ï¼Œåº”è¯¥æ ¹æ®é™ç•Œä¸Šä¸‹æ–‡æ‹†åˆ†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1288110,"ctime":1689499149,"ip_address":"","comment_id":377230,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100311801,"comment_content":"\ncqrsæ²¡æœ‰é¢†åŸŸå±‚ï¼Œä¼šä¸ä¼šä»¥åæœåŠ¡æ ¹æ®èšåˆæ‹†åˆ†ï¼Œæ”¹èµ·æ¥ä¹Ÿæ¯”è¾ƒéº»çƒ¦ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1288110,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VBLEAcychgbs5CicUczSYcibicoicZmyk1JHHFiae94KuvVsibAKtcQAvnOPWp0C4yvia8mzvQAORiazjWSoc1XQ9QkLrQ/132","nickname":"é’Ÿæ•¬","note":"","ucode":"20B3D31A2C8C86","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":623448,"discussion_content":"æœåŠ¡ä¸åº”è¯¥æ ¹æ®èšåˆæ‹†åˆ†ï¼Œåº”è¯¥æ ¹æ®é™ç•Œä¸Šä¸‹æ–‡æ‹†åˆ†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1689499149,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":1129601,"avatar":"https://static001.geekbang.org/account/avatar/00/11/3c/81/7ccdb399.jpg","nickname":"+ ç³ ","note":"","ucode":"2D5A91900FCA43","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1288110,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VBLEAcychgbs5CicUczSYcibicoicZmyk1JHHFiae94KuvVsibAKtcQAvnOPWp0C4yvia8mzvQAORiazjWSoc1XQ9QkLrQ/132","nickname":"é’Ÿæ•¬","note":"","ucode":"20B3D31A2C8C86","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":623449,"discussion_content":"ä¸€ä¸ªé™ç•Œä¸Šä¸‹æ–‡çš„å¤šä¸ªèšåˆï¼Œå¯èƒ½æ ¹æ®åæœŸä¸šåŠ¡å‘å±•ï¼Œæ¯ä¸ªèšåˆæˆä¸ºä¸€ä¸ªé™ç•Œä¸Šä¸‹æ–‡ï¼Œé‚£è¯»æ¨¡å‹æ‹†èµ·æ¥ä¸æ˜¯å¾ˆéº»çƒ¦ä¹ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1689499321,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":623448,"ip_address":"å¹¿ä¸œ","group_id":0},"score":623449,"extra":""},{"author":{"id":1588683,"avatar":"https://static001.geekbang.org/account/avatar/00/18/3d/cb/791d0f5e.jpg","nickname":"çŒ´å“¥","note":"","ucode":"63A1BFDF13D85D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1129601,"avatar":"https://static001.geekbang.org/account/avatar/00/11/3c/81/7ccdb399.jpg","nickname":"+ ç³ ","note":"","ucode":"2D5A91900FCA43","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":650100,"discussion_content":"ä¸ºäº†æŸ¥è¯¢æ€§èƒ½å˜›ï¼Œæ€»è¦ä»˜å‡ºä»£ä»·ã€‚çœŸèƒ½æ‹†çš„å‡ºå»äº†ï¼Œå†æŠ•å…¥å‘—ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1724370776,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":623449,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":650100,"extra":""}]}]},{"had_liked":false,"id":374626,"user_name":"é›¨","can_delete":false,"product_type":"c1","uid":1088488,"ip_address":"åŒ—äº¬","ucode":"FCBA5DE66F07A7","user_header":"","comment_is_top":false,"comment_ctime":1684240114,"is_pvip":false,"replies":[{"id":137145,"content":"é—®é¢˜1:ä¹Ÿå¯ä»¥å•ç‹¬å»ºä¸€ä¸ªç¬¦åˆæŸ¥è¯¢æ¶æ„çš„è¡¨ï¼Œé¢„å…ˆæŠŠæ•°æ®å¤„ç†å¥½ï¼Œä¹‹åç›´æ¥æŸ¥è¯¢ã€‚\né—®é¢˜2: è¡¥å……ä¸€ç‚¹ï¼Œå¦‚æœä¸€å¥—è¡¨çš„è¯ï¼Œè®¾è®¡æ›´å®¹æ˜“è…åŒ–ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1288110,"ctime":1685969490,"ip_address":"å¹¿ä¸œ","comment_id":374626,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100311801,"comment_content":"é—®é¢˜1ï¼šå…ˆæŸ¥è¯¢å‡ºç¬¦åˆæ¡ä»¶çš„çˆ¶å­å·¥æ—¶é¡¹idï¼Œå†ç”¨å¤šä¸ªå·¥æ—¶é¡¹idè¿›è¡ŒæŸ¥è¯¢\né—®é¢˜2ï¼šåŸæ¥é¢†åŸŸæ¨¡å‹è¡¨åè§„èŒƒåŒ–çš„æ–¹å¼é¿å…äº†2å¥—æ•°æ®æºåŒæ­¥çš„å¤æ‚åº¦ï¼Œå¢åŠ äº†å†™é€»è¾‘çš„å¤æ‚åº¦ï¼Œå¦å¤–ä¸€å¥—è¡¨çš„æ–¹å¼å…³æ³¨ç‚¹æ¸…æ™°ï¼Œèƒ½å®ç°ä¸šåŠ¡å±‚çš„è¯»å†™åˆ†ç¦»ï¼Œä½†éœ€è¦ä¿è¯æ•°æ®åŒæ­¥çš„ç¨³å®šæ€§åŠæ—¶æ•ˆæ€§\nè¿˜è¯·è€å¸ˆç­”ç–‘ï¼Œè°¢è°¢","like_count":0,"discussions":[{"author":{"id":1288110,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VBLEAcychgbs5CicUczSYcibicoicZmyk1JHHFiae94KuvVsibAKtcQAvnOPWp0C4yvia8mzvQAORiazjWSoc1XQ9QkLrQ/132","nickname":"é’Ÿæ•¬","note":"","ucode":"20B3D31A2C8C86","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":620244,"discussion_content":"é—®é¢˜1:ä¹Ÿå¯ä»¥å•ç‹¬å»ºä¸€ä¸ªç¬¦åˆæŸ¥è¯¢æ¶æ„çš„è¡¨ï¼Œé¢„å…ˆæŠŠæ•°æ®å¤„ç†å¥½ï¼Œä¹‹åç›´æ¥æŸ¥è¯¢ã€‚\né—®é¢˜2: è¡¥å……ä¸€ç‚¹ï¼Œå¦‚æœä¸€å¥—è¡¨çš„è¯ï¼Œè®¾è®¡æ›´å®¹æ˜“è…åŒ–ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1685969490,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":369745,"user_name":"ç¥ç»è›™","can_delete":false,"product_type":"c1","uid":1803623,"ip_address":"å¹¿ä¸œ","ucode":"2D71FC12E420AB","user_header":"https://static001.geekbang.org/account/avatar/00/1b/85/67/0d121bc4.jpg","comment_is_top":false,"comment_ctime":1677856833,"is_pvip":false,"replies":[{"id":134720,"content":"å‡å¦‚è§‰å¾—CQRSå¸¦æ¥çš„éº»çƒ¦å¤§äºæ”¶ç›Šï¼Œå°±ä¸è¦ç”¨ã€‚ç›´åˆ°æŸä¸€å¤©å‘ç°æƒ…å†µé€†è½¬ï¼Œå†ç”¨ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1288110,"ctime":1677917973,"ip_address":"å¹¿ä¸œ","comment_id":369745,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100311801,"comment_content":"é™¤äº†åšä¸»è¿™ç¯‡æ–‡ç« çš„è§‚ç‚¹ä¹‹å¤–ï¼Œæˆ‘è¿˜æœ‰ä¸€ç§ç†è§£ï¼Œä¿®æ”¹ä¼šå¯¹ä¸€ä¸ªå¯¹è±¡äº§ç”Ÿå½±å“ï¼Œå±äºä¸šåŠ¡ã€‚è€ŒæŸ¥è¯¢æ²¡æœ‰ä¸šåŠ¡å±æ€§ï¼Œå®ƒåªæ˜¯æŸ¥è¯¢å‡ºæŸä¸€æ—¶åˆ»å†…æŸä¸ªé¢†åŸŸå®ä½“å¯¹è±¡çš„çŠ¶æ€ã€‚æ‰€ä»¥æŠŠä»–ä»¬åˆ†ç¦»èƒ½æ›´å¥½çš„è®©å¼€å‘å…³æ³¨åˆ°ä¸šåŠ¡ä¸Šå»ã€‚ä½†æ˜¯æˆ‘è§‰å¾—cqrsè¿™æ ·æ‹†å¥½ç¹çã€‚dddæœ¬èº«è½åœ°å°±å¤Ÿç¹ççš„äº†ã€‚ã€‚","like_count":0,"discussions":[{"author":{"id":1288110,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/VBLEAcychgbs5CicUczSYcibicoicZmyk1JHHFiae94KuvVsibAKtcQAvnOPWp0C4yvia8mzvQAORiazjWSoc1XQ9QkLrQ/132","nickname":"é’Ÿæ•¬","note":"","ucode":"20B3D31A2C8C86","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":607468,"discussion_content":"å‡å¦‚è§‰å¾—CQRSå¸¦æ¥çš„éº»çƒ¦å¤§äºæ”¶ç›Šï¼Œå°±ä¸è¦ç”¨ã€‚ç›´åˆ°æŸä¸€å¤©å‘ç°æƒ…å†µé€†è½¬ï¼Œå†ç”¨ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677917973,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}