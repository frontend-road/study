{"id":317216,"title":"10 | Swapï¼šå®¹å™¨å¯ä»¥ä½¿ç”¨Swapç©ºé—´å—ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç¨‹è¿œã€‚è¿™ä¸€è®²ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å®¹å™¨ä¸­æ˜¯å¦å¯ä»¥ä½¿ç”¨Swapç©ºé—´ã€‚</p><p>ç”¨è¿‡Linuxçš„åŒå­¦åº”è¯¥éƒ½å¾ˆç†Ÿæ‚‰Swapç©ºé—´äº†ï¼Œç®€å•æ¥è¯´å®ƒå°±æ˜¯å°±æ˜¯ä¸€å—ç£ç›˜ç©ºé—´ã€‚</p><p>å½“å†…å­˜å†™æ»¡çš„æ—¶å€™ï¼Œå°±å¯ä»¥æŠŠå†…å­˜ä¸­ä¸å¸¸ç”¨çš„æ•°æ®æš‚æ—¶å†™åˆ°è¿™ä¸ªSwapç©ºé—´ä¸Šã€‚è¿™æ ·ä¸€æ¥ï¼Œå†…å­˜ç©ºé—´å°±å¯ä»¥é‡Šæ”¾å‡ºæ¥ï¼Œç”¨æ¥æ»¡è¶³æ–°çš„å†…å­˜ç”³è¯·çš„éœ€æ±‚ã€‚</p><p>å®ƒçš„å¥½å¤„æ˜¯å¯ä»¥<strong>åº”å¯¹ä¸€äº›ç¬æ—¶çªå‘çš„å†…å­˜å¢å¤§éœ€æ±‚</strong>ï¼Œä¸è‡³äºå› ä¸ºå†…å­˜ä¸€æ—¶ä¸å¤Ÿè€Œè§¦å‘OOM Killerï¼Œå¯¼è‡´è¿›ç¨‹è¢«æ€æ­»ã€‚</p><p>é‚£ä¹ˆå¯¹äºä¸€ä¸ªå®¹å™¨ï¼Œç‰¹åˆ«æ˜¯å®¹å™¨è¢«è®¾ç½®äº†Memory Cgroupä¹‹åï¼Œå®ƒè¿˜å¯ä»¥ä½¿ç”¨Swapç©ºé—´å—ï¼Ÿä¼šä¸ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ</p><h2>é—®é¢˜å†ç°</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ç»“åˆä¸€ä¸ªå°ä¾‹å­ï¼Œä¸€èµ·æ¥çœ‹çœ‹å§ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨ä¸€ä¸ªæœ‰Swapç©ºé—´çš„èŠ‚ç‚¹ä¸Šå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œè®¾ç½®å¥½å®ƒçš„Memory Cgroupçš„é™åˆ¶ï¼Œä¸€èµ·æ¥çœ‹çœ‹æ¥ä¸‹æ¥ä¼šå‘ç”Ÿä»€ä¹ˆã€‚</p><p>å¦‚æœä½ çš„èŠ‚ç‚¹ä¸Šæ²¡æœ‰Swapåˆ†åŒºï¼Œä¹Ÿæ²¡æœ‰å…³ç³»ï¼Œä½ å¯ä»¥ç”¨ä¸‹é¢çš„<a href=\"https://github.com/chengyli/training/blob/main/memory/swap/create_swap.sh\">è¿™ç»„å‘½ä»¤</a>æ¥æ–°å»ºä¸€ä¸ªã€‚</p><p>è¿™ä¸ªä¾‹å­é‡Œï¼ŒSwapç©ºé—´çš„å¤§å°æ˜¯20Gï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±ç£ç›˜ç©ºé—²ç©ºé—´æ¥å†³å®šè¿™ä¸ªSwapçš„å¤§å°ã€‚æ‰§è¡Œå®Œè¿™ç»„å‘½ä»¤ä¹‹åï¼Œæˆ‘ä»¬æ¥è¿è¡Œfreeå‘½ä»¤ï¼Œå°±å¯ä»¥çœ‹åˆ°Swapç©ºé—´æœ‰20Gã€‚</p><p>è¾“å‡ºçš„ç»“æœä½ å¯ä»¥å‚è€ƒä¸‹é¢çš„æˆªå›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/33/5b/337a5efa84fc64f5a7ab2b12295e8b5b.png?wh=1622*496\" alt=\"\"></p><p>ç„¶åæˆ‘ä»¬å†å¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œå’ŒOOMé‚£ä¸€è®²é‡Œçš„<a href=\"https://github.com/chengyli/training/blob/main/memory/oom/start_container.sh\">ä¾‹å­</a>å·®ä¸å¤šï¼Œå®¹å™¨çš„Memory Cgroupé™åˆ¶ä¸º512MBï¼Œå®¹å™¨ä¸­çš„mem_allocç¨‹åºå»ç”³è¯·2GBå†…å­˜ã€‚</p><!-- [[[read_end]]] --><p>ä½ ä¼šå‘ç°ï¼Œè¿™æ¬¡å’Œä¸Šæ¬¡OOMé‚£ä¸€è®²é‡Œçš„æƒ…å†µä¸ä¸€æ ·äº†ï¼Œå¹¶æ²¡æœ‰å‘ç”ŸOOMå¯¼è‡´å®¹å™¨é€€å‡ºçš„æƒ…å†µï¼Œå®¹å™¨è¿è¡Œå¾—å¥½å¥½çš„ã€‚</p><p>ä»ä¸‹é¢çš„å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œmem_allocè¿›ç¨‹çš„RSSå†…å­˜ä¸€ç›´åœ¨512MBï¼ˆRES: 515596ï¼‰å·¦å³ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f3/dd/f3be95c49af5bed1965654dd79db7bdd.png?wh=1584*196\" alt=\"\"><br>\né‚£æˆ‘ä»¬å†çœ‹ä¸€ä¸‹Swapç©ºé—´ï¼Œä½¿ç”¨äº†1.5GB (used 1542144KB)ã€‚è¾“å‡ºçš„ç»“æœå¦‚ä¸‹å›¾ï¼Œç®€å•è®¡ç®—ä¸€ä¸‹ï¼Œ1.5GB + 512MBï¼Œç»“æœæ­£å¥½æ˜¯mem_allocè¿™ä¸ªç¨‹åºç”³è¯·çš„2GBå†…å­˜ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e9/3f/e922df98666ab06e80f816d81e11883f.png?wh=1658*198\" alt=\"\"></p><p>é€šè¿‡åˆšåˆšçš„ä¾‹å­ï¼Œä½ ä¹Ÿè®¸ä¼šè¿™ä¹ˆæƒ³ï¼Œå› ä¸ºæœ‰äº†Swapç©ºé—´ï¼Œæœ¬æ¥ä¼šè¢«OOM Killçš„å®¹å™¨ï¼Œå¯ä»¥å¥½å¥½åœ°è¿è¡Œäº†ã€‚åˆçœ‹è¿™æ ·ä¼¼ä¹ä¹ŸæŒºå¥½çš„ï¼Œä¸è¿‡ä½ ä»”ç»†æƒ³æƒ³ï¼Œè¿™æ ·ä¸€æ¥ï¼ŒMemory Cgroupå¯¹å†…å­˜çš„é™åˆ¶ä¸å°±å¤±å»äº†ä½œç”¨ä¹ˆï¼Ÿ</p><p>æˆ‘ä»¬å†è¿›ä¸€æ­¥åˆ†æï¼Œå¦‚æœä¸€ä¸ªå®¹å™¨ä¸­çš„ç¨‹åºå‘ç”Ÿäº†å†…å­˜æ³„æ¼ï¼ˆMemory leakï¼‰ï¼Œé‚£ä¹ˆæœ¬æ¥Memory Cgroupå¯ä»¥åŠæ—¶æ€æ­»è¿™ä¸ªè¿›ç¨‹ï¼Œè®©å®ƒä¸å½±å“æ•´ä¸ªèŠ‚ç‚¹ä¸­çš„å…¶ä»–åº”ç”¨ç¨‹åºã€‚ç»“æœç°åœ¨è¿™ä¸ªå†…å­˜æ³„æ¼çš„è¿›ç¨‹æ²¡è¢«æ€æ­»ï¼Œè¿˜ä¼šä¸æ–­åœ°è¯»å†™Swapç£ç›˜ï¼Œåè€Œå½±å“äº†æ•´ä¸ªèŠ‚ç‚¹çš„æ€§èƒ½ã€‚</p><p>ä½ çœ‹ï¼Œè¿™æ ·ä¸€åˆ†æï¼Œå¯¹äºè¿è¡Œå®¹å™¨çš„èŠ‚ç‚¹ï¼Œä½ æ˜¯ä¸æ˜¯åˆè§‰å¾—åº”è¯¥ç¦æ­¢ä½¿ç”¨Swapäº†å‘¢?</p><p>æˆ‘æƒ³æé†’ä½ ï¼Œä¸èƒ½ä¸€åˆ€åˆ‡åœ°ä¸‹ç»“è®ºï¼Œæˆ‘ä»¬æ€»æ˜¯è¯´ï¼Œå…·ä½“æƒ…å†µè¦å…·ä½“åˆ†æï¼Œæˆ‘ä»¬è½åœ°åˆ°å…·ä½“çš„åœºæ™¯é‡Œï¼Œå°±ä¼šå‘ç°æƒ…å†µåˆæ²¡æœ‰åŸå…ˆæˆ‘ä»¬æƒ³å¾—é‚£ä¹ˆç®€å•ã€‚</p><p>æ¯”å¦‚è¯´ï¼ŒæŸä¸€ç±»ç¨‹åºå°±æ˜¯éœ€è¦Swapç©ºé—´ï¼Œæ‰èƒ½é˜²æ­¢å› ä¸ºå¶å°”çš„å†…å­˜çªç„¶å¢åŠ è€Œè¢«OOM Killeræ€æ­»ã€‚å› ä¸ºè¿™ç±»ç¨‹åºé‡æ–°å¯åŠ¨çš„åˆå§‹åŒ–æ—¶é—´ä¼šå¾ˆé•¿ï¼Œè¿™æ ·ç¨‹åºé‡å¯çš„ä»£ä»·å°±å¾ˆå¤§äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰“å¼€Swapå¯¹è¿™ç±»ç¨‹åºæ˜¯æœ‰æ„ä¹‰çš„ã€‚</p><p>è¿™ä¸€ç±»ç¨‹åºä¸€æ—¦æ”¾åˆ°å®¹å™¨ä¸­è¿è¡Œï¼Œå°±æ„å‘³ç€å®ƒä¼šå’Œâ€œåˆ«çš„å®¹å™¨â€åœ¨åŒä¸€ä¸ªå®¿ä¸»æœºä¸Šå…±åŒè¿è¡Œï¼Œé‚£å¦‚æœè¿™ä¸ªâ€œåˆ«çš„å®¹å™¨â€ å¦‚æœä¸éœ€è¦Swapï¼Œè€Œæ˜¯å¸Œæœ›Memory Cgroupçš„ä¸¥æ ¼å†…å­˜é™åˆ¶ã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼Œåœ¨è¿™ä¸€ä¸ªå®¿ä¸»æœºä¸Šçš„ä¸¤ä¸ªå®¹å™¨å°±ä¼šæœ‰å†²çªäº†ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿè¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹Linuxé‡Œçš„Swappinessè¿™ä¸ªæ¦‚å¿µï¼Œåé¢å®ƒå¯ä»¥å¸®åˆ°æˆ‘ä»¬ã€‚</p><h2>å¦‚ä½•æ­£ç¡®ç†è§£swappinesså‚æ•°ï¼Ÿ</h2><p>åœ¨æ™®é€šLinuxç³»ç»Ÿä¸Šï¼Œå¦‚æœä½ ä½¿ç”¨è¿‡Swapç©ºé—´ï¼Œé‚£ä¹ˆä½ å¯èƒ½é…ç½®è¿‡procæ–‡ä»¶ç³»ç»Ÿä¸‹çš„swappiness è¿™ä¸ªå‚æ•° (/proc/sys/vm/swappiness)ã€‚swappinessçš„å®šä¹‰åœ¨<a href=\"https://www.kernel.org/doc/Documentation/sysctl/vm.txt\">Linux å†…æ ¸æ–‡æ¡£</a>ä¸­å¯ä»¥æ‰¾åˆ°ï¼Œå°±æ˜¯ä¸‹é¢è¿™æ®µè¯ã€‚</p><blockquote>\n<p>swappiness</p>\n</blockquote><blockquote>\n<p>This control is used to define how aggressive the kernel will swap memory pages.  Higher values will increase aggressiveness, lower values decrease the amount of swap.  A value of 0 instructs the kernel not to initiate swap until the amount of free and file-backed pages is less than the high water mark in a zone.</p>\n</blockquote><blockquote>\n<p>The default value is 60.</p>\n</blockquote><p>å‰é¢ä¸¤å¥è¯å¤§è‡´ç¿»è¯‘è¿‡æ¥ï¼Œæ„æ€å°±æ˜¯ <strong>swappinesså¯ä»¥å†³å®šç³»ç»Ÿå°†ä¼šæœ‰å¤šé¢‘ç¹åœ°ä½¿ç”¨äº¤æ¢åˆ†åŒºã€‚</strong></p><p>ä¸€ä¸ªè¾ƒé«˜çš„å€¼ä¼šä½¿å¾—å†…æ ¸æ›´é¢‘ç¹åœ°ä½¿ç”¨äº¤æ¢åˆ†åŒºï¼Œè€Œä¸€ä¸ªè¾ƒä½çš„å–å€¼ï¼Œåˆ™ä»£è¡¨ç€å†…æ ¸ä¼šå°½é‡é¿å…ä½¿ç”¨äº¤æ¢åˆ†åŒºã€‚swappinessçš„å–å€¼èŒƒå›´æ˜¯0â€“100ï¼Œç¼ºçœå€¼60ã€‚</p><p>æˆ‘ç¬¬ä¸€æ¬¡è¯»åˆ°è¿™ä¸ªå®šä¹‰ï¼Œå†çŸ¥é“äº†è¿™ä¸ªå–å€¼èŒƒå›´åï¼Œæˆ‘è§‰å¾—è¿™æ˜¯ä¸€ä¸ªç™¾åˆ†æ¯”å€¼ï¼Œä¹Ÿå°±æ˜¯å®šä¹‰äº†ä½¿ç”¨Swapç©ºé—´çš„é¢‘ç‡ã€‚</p><p>å½“è¿™ä¸ªå€¼æ˜¯100çš„æ—¶å€™ï¼Œå“ªæ€•è¿˜æœ‰ç©ºé—²å†…å­˜ï¼Œä¹Ÿä¼šå»åšå†…å­˜äº¤æ¢ï¼Œå°½é‡æŠŠå†…å­˜æ•°æ®å†™å…¥åˆ°Swapç©ºé—´é‡Œï¼›å€¼æ˜¯0çš„æ—¶å€™ï¼ŒåŸºæœ¬ä¸Šå°±ä¸åšå†…å­˜äº¤æ¢äº†ï¼Œä¹Ÿå°±ä¸å†™Swapç©ºé—´äº†ã€‚</p><p>åæ¥å†å›é¡¾çš„æ—¶å€™ï¼Œæˆ‘å‘ç°è¿™ä¸ªæƒ³æ³•ä¸èƒ½è¯´æ˜¯å®Œå…¨é”™çš„ï¼Œä½†æ˜¯æƒ³å¾—ç®€å•äº†äº›ã€‚é‚£è¿™æ®µswappinessçš„å®šä¹‰ï¼Œåº”è¯¥æ€ä¹ˆæ­£ç¡®åœ°ç†è§£å‘¢ï¼Ÿ</p><p>ä½ è¿˜è®°å¾—ï¼Œæˆ‘ä»¬åœ¨ä¸Šä¸€è®²é‡Œè¯´è¿‡çš„ä¸¤ç§å†…å­˜ç±»å‹Page Cache å’ŒRSSä¹ˆ?</p><p>åœ¨æœ‰ç£ç›˜æ–‡ä»¶è®¿é—®çš„æ—¶å€™ï¼ŒLinuxä¼šå°½é‡æŠŠç³»ç»Ÿçš„ç©ºé—²å†…å­˜ç”¨ä½œPage Cacheæ¥æé«˜æ–‡ä»¶çš„è¯»å†™æ€§èƒ½ã€‚åœ¨æ²¡æœ‰æ‰“å¼€Swapç©ºé—´çš„æƒ…å†µä¸‹ï¼Œä¸€æ—¦å†…å­˜ä¸å¤Ÿï¼Œè¿™ç§æƒ…å†µä¸‹å°±åªèƒ½æŠŠPage Cacheé‡Šæ”¾äº†ï¼Œè€ŒRSSå†…å­˜æ˜¯ä¸èƒ½é‡Šæ”¾çš„ã€‚</p><p>åœ¨RSSé‡Œçš„å†…å­˜ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯æ²¡æœ‰å¯¹åº”ç£ç›˜æ–‡ä»¶çš„å†…å­˜ï¼Œæ¯”å¦‚ç”¨malloc()ç”³è¯·å¾—åˆ°çš„å†…å­˜ï¼Œè¿™ç§å†…å­˜ä¹Ÿè¢«ç§°ä¸º<strong>åŒ¿åå†…å­˜ï¼ˆAnonymous memoryï¼‰</strong>ã€‚é‚£ä¹ˆå½“Swapç©ºé—´æ‰“å¼€åï¼Œå¯ä»¥å†™å…¥Swapç©ºé—´çš„ï¼Œå°±æ˜¯è¿™äº›åŒ¿åå†…å­˜ã€‚</p><p>æ‰€ä»¥åœ¨Swapç©ºé—´æ‰“å¼€çš„æ—¶å€™ï¼Œé—®é¢˜ä¹Ÿå°±æ¥äº†ï¼Œåœ¨å†…å­˜ç´§å¼ çš„æ—¶å€™ï¼ŒLinuxç³»ç»Ÿæ€ä¹ˆå†³å®šæ˜¯å…ˆé‡Šæ”¾Page Cacheï¼Œè¿˜æ˜¯å…ˆæŠŠåŒ¿åå†…å­˜é‡Šæ”¾å¹¶å†™å…¥åˆ°Swapç©ºé—´é‡Œå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬ä¸€èµ·æ¥åˆ†æåˆ†æï¼Œéƒ½å¯èƒ½å‘ç”Ÿæ€æ ·çš„æƒ…å†µã€‚æœ€å¯èƒ½å‘ç”Ÿçš„æ˜¯ä¸‹é¢ä¸¤ç§æƒ…å†µï¼š</p><p>ç¬¬ä¸€ç§æƒ…å†µæ˜¯ï¼Œå¦‚æœç³»ç»Ÿå…ˆæŠŠPage Cacheéƒ½é‡Šæ”¾äº†ï¼Œé‚£ä¹ˆä¸€æ—¦èŠ‚ç‚¹é‡Œæœ‰é¢‘ç¹çš„æ–‡ä»¶è¯»å†™æ“ä½œï¼Œç³»ç»Ÿçš„æ€§èƒ½å°±ä¼šä¸‹é™ã€‚</p><p>è¿˜æœ‰å¦ä¸€ç§æƒ…å†µï¼Œå¦‚æœLinuxç³»ç»Ÿå…ˆæŠŠåŒ¿åå†…å­˜éƒ½é‡Šæ”¾å¹¶å†™å…¥åˆ°Swapï¼Œé‚£ä¹ˆä¸€æ—¦è¿™äº›è¢«é‡Šæ”¾çš„åŒ¿åå†…å­˜é©¬ä¸Šéœ€è¦ä½¿ç”¨ï¼Œåˆéœ€è¦ä»Swapç©ºé—´è¯»å›åˆ°å†…å­˜ä¸­ï¼Œè¿™æ ·åˆä¼šè®©Swapï¼ˆå…¶å®ä¹Ÿæ˜¯ç£ç›˜ï¼‰çš„è¯»å†™é¢‘ç¹ï¼Œå¯¼è‡´ç³»ç»Ÿæ€§èƒ½ä¸‹é™ã€‚</p><p>æ˜¾ç„¶ï¼Œæˆ‘ä»¬åœ¨é‡Šæ”¾å†…å­˜çš„æ—¶å€™ï¼Œéœ€è¦å¹³è¡¡Page Cacheçš„é‡Šæ”¾å’ŒåŒ¿åå†…å­˜çš„é‡Šæ”¾ï¼Œè€Œswappinessï¼Œå°±æ˜¯ç”¨æ¥å®šä¹‰è¿™ä¸ªå¹³è¡¡çš„å‚æ•°ã€‚</p><p>é‚£ä¹ˆswappinesså…·ä½“æ˜¯æ€ä¹ˆæ¥æ§åˆ¶è¿™ä¸ªå¹³è¡¡çš„ï¼Ÿæˆ‘ä»¬çœ‹ä¸€ä¸‹åœ¨Linuxå†…æ ¸ä»£ç é‡Œæ˜¯æ€ä¹ˆç”¨è¿™ä¸ªswappinesså‚æ•°ã€‚</p><p>æˆ‘ä»¬å‰é¢è¯´äº†swappinessçš„è¿™ä¸ªå€¼çš„èŒƒå›´æ˜¯0åˆ°100ï¼Œä½†æ˜¯è¯·ä½ ä¸€å®šè¦æ³¨æ„ï¼Œ<strong>å®ƒä¸æ˜¯ä¸€ä¸ªç™¾åˆ†æ¯”ï¼Œæ›´åƒæ˜¯ä¸€ä¸ªæƒé‡</strong>ã€‚å®ƒæ˜¯ç”¨æ¥å®šä¹‰Page Cacheå†…å­˜å’ŒåŒ¿åå†…å­˜çš„é‡Šæ”¾çš„ä¸€ä¸ªæ¯”ä¾‹ã€‚</p><p>æˆ‘ç»“åˆä¸‹é¢çš„è¿™æ®µä»£ç å…·ä½“ç»™ä½ è®²ä¸€è®²ã€‚</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ¯”ä¾‹æ˜¯anon_prio: file_prioï¼Œè¿™é‡Œanon_prioçš„å€¼å°±ç­‰äºswappinessã€‚ä¸‹é¢æˆ‘ä»¬åˆ†ä¸‰ä¸ªæƒ…å†µåšè®¨è®ºï¼š</p><p>ç¬¬ä¸€ç§æƒ…å†µï¼Œå½“swappinessçš„å€¼æ˜¯100çš„æ—¶å€™ï¼ŒåŒ¿åå†…å­˜å’ŒPage Cacheå†…å­˜çš„é‡Šæ”¾æ¯”ä¾‹å°±æ˜¯100: 100ï¼Œä¹Ÿå°±æ˜¯ç­‰æ¯”ä¾‹é‡Šæ”¾äº†ã€‚</p><p>ç¬¬äºŒç§æƒ…å†µï¼Œå°±æ˜¯swappinessç¼ºçœå€¼æ˜¯60çš„æ—¶å€™ï¼ŒåŒ¿åå†…å­˜å’ŒPage Cacheå†…å­˜çš„é‡Šæ”¾æ¯”ä¾‹å°±æ˜¯60 : 140ï¼ŒPage Cacheå†…å­˜çš„é‡Šæ”¾è¦ä¼˜å…ˆäºåŒ¿åå†…å­˜ã€‚</p><pre><code class=\"language-shell\">        /*\n         * With swappiness at 100, anonymous and file have the same priority.\n         * This scanning priority is essentially the inverse of IO cost.\n         */\n\n        anon_prio = swappiness;\n        file_prio = 200 - anon_prio;\n</code></pre><p>è¿˜æœ‰ä¸€ç§æƒ…å†µï¼Œ å½“swappinessçš„å€¼æ˜¯0çš„æ—¶å€™ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿè¿™ç§æƒ…å†µä¸‹ï¼ŒLinuxç³»ç»Ÿæ˜¯ä¸å…è®¸åŒ¿åå†…å­˜å†™å…¥Swapç©ºé—´äº†å—ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥å›åˆ°å‰é¢ï¼Œå†çœ‹ä¸€ä¸‹é‚£æ®µswappinessçš„è‹±æ–‡å®šä¹‰ï¼Œé‡Œé¢ç‰¹åˆ«å¼ºè°ƒäº†swappinessä¸º0çš„æƒ…å†µã€‚</p><p>å½“ç©ºé—²å†…å­˜å°‘äºå†…å­˜ä¸€ä¸ªzoneçš„\"high water mark\"ä¸­çš„å€¼çš„æ—¶å€™ï¼ŒLinuxè¿˜æ˜¯ä¼šåšå†…å­˜äº¤æ¢ï¼Œä¹Ÿå°±æ˜¯æŠŠåŒ¿åå†…å­˜å†™å…¥åˆ°Swapç©ºé—´åé‡Šæ”¾å†…å­˜ã€‚</p><p>åœ¨è¿™é‡Œzoneæ˜¯Linuxåˆ’åˆ†ç‰©ç†å†…å­˜çš„ä¸€ä¸ªåŒºåŸŸï¼Œé‡Œé¢æœ‰3ä¸ªæ°´ä½çº¿ï¼ˆwater markï¼‰ï¼Œæ°´ä½çº¿å¯ä»¥ç”¨æ¥è­¦ç¤ºç©ºé—²å†…å­˜çš„ç´§å¼ ç¨‹åº¦ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥å†åšä¸ªè¯•éªŒæ¥éªŒè¯ä¸€ä¸‹ï¼Œå…ˆè¿è¡Œ <code>echo 0 &gt; /proc/sys/vm/swappiness</code> å‘½ä»¤æŠŠswappinessè®¾ç½®ä¸º0ï¼Œ ç„¶åç”¨æˆ‘ä»¬ä¹‹å‰ä¾‹å­é‡Œçš„mem_allocç¨‹åºæ¥ç”³è¯·å†…å­˜ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬çš„è¿™ä¸ªèŠ‚ç‚¹ä¸Šå†…å­˜æœ‰12GBï¼ŒåŒæ—¶æœ‰2GBçš„Swapï¼Œç”¨mem_allocç”³è¯·12GBçš„å†…å­˜ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°Swapç©ºé—´åœ¨mem_allocè°ƒç”¨ä¹‹å‰ï¼Œused=0ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/35/50/35b806bd26e089506d909d31f1e87550.png?wh=1496*340\" alt=\"\"></p><p>æ¥ä¸‹æ¥ï¼Œè°ƒç”¨mem_allocä¹‹åï¼ŒSwapç©ºé—´å°±è¢«ä½¿ç”¨äº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e2/ec/e245d137131b1yyc1e169a24fd10b5ec.png?wh=1618*200\" alt=\"\"></p><p>å› ä¸ºmem_allocç”³è¯·12GBå†…å­˜å·²ç»å’ŒèŠ‚ç‚¹æœ€å¤§å†…å­˜å·®ä¸å¤šäº†ï¼Œæˆ‘ä»¬å¦‚æœæŸ¥çœ‹ <code>cat /proc/zoneinfo</code> ï¼Œä¹Ÿå¯ä»¥çœ‹åˆ°normal zoneé‡Œhigh ï¼ˆwater markï¼‰çš„å€¼å’Œfreeçš„å€¼å·®ä¸å¤šï¼Œè¿™æ ·åœ¨free&lt;highçš„æ—¶å€™ï¼Œç³»ç»Ÿå°±ä¼šå›æ”¶åŒ¿åå†…å­˜é¡µé¢å¹¶å†™å…¥Swapç©ºé—´ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/21/1d/212f4dde0982f656610cd8a3b293051d.png?wh=630*240\" alt=\"\"><br>\nå¥½äº†ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä»‹ç»äº†Linuxç³»ç»Ÿé‡Œswappinessçš„æ¦‚å¿µï¼Œå®ƒæ˜¯ç”¨æ¥å†³å®šåœ¨å†…å­˜ç´§å¼ æ—¶å€™ï¼Œå›æ”¶åŒ¿åå†…å­˜å’ŒPage Cacheå†…å­˜çš„æ¯”ä¾‹ã€‚</p><p><strong>swappinessçš„å–å€¼èŒƒå›´åœ¨0åˆ°100ï¼Œå€¼ä¸º100çš„æ—¶å€™ç³»ç»Ÿå¹³ç­‰å›æ”¶åŒ¿åå†…å­˜å’ŒPage Cacheå†…å­˜ï¼›ä¸€èˆ¬ç¼ºçœå€¼ä¸º60ï¼Œå°±æ˜¯ä¼˜å…ˆå›æ”¶Page Cacheï¼›å³ä½¿swappinessä¸º0ï¼Œä¹Ÿä¸èƒ½å®Œå…¨ç¦æ­¢Swapåˆ†åŒºçš„ä½¿ç”¨ï¼Œå°±æ˜¯è¯´åœ¨å†…å­˜ç´§å¼ çš„æ—¶å€™ï¼Œä¹Ÿä¼šä½¿ç”¨Swapæ¥å›æ”¶åŒ¿åå†…å­˜ã€‚</strong></p><h2>è§£å†³é—®é¢˜</h2><p>é‚£ä¹ˆè¿è¡Œäº†å®¹å™¨ï¼Œä½¿ç”¨äº†Memory Cgroupä¹‹åï¼Œswappinessæ€ä¹ˆå·¥ä½œå‘¢ï¼Ÿ</p><p>å¦‚æœä½ æŸ¥çœ‹ä¸€ä¸‹Memory Cgroupæ§åˆ¶ç»„ä¸‹é¢çš„å‚æ•°ï¼Œä½ ä¼šçœ‹åˆ°æœ‰ä¸€ä¸ªmemory.swappinesså‚æ•°ã€‚è¿™ä¸ªå‚æ•°æ˜¯å¹²å•¥çš„å‘¢ï¼Ÿ</p><p>memory.swappinesså¯ä»¥æ§åˆ¶è¿™ä¸ªMemroy Cgroupæ§åˆ¶ç»„ä¸‹é¢åŒ¿åå†…å­˜å’Œpage cacheçš„å›æ”¶ï¼Œå–å€¼çš„èŒƒå›´å’Œå·¥ä½œæ–¹å¼å’Œå…¨å±€çš„swappinesså·®ä¸å¤šã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä¼˜å…ˆé¡ºåºï¼Œåœ¨Memory Cgorupçš„æ§åˆ¶ç»„é‡Œï¼Œå¦‚æœä½ è®¾ç½®äº†memory.swappinesså‚æ•°ï¼Œå®ƒå°±ä¼šè¦†ç›–å…¨å±€çš„swappinessï¼Œè®©å…¨å±€çš„swappinessåœ¨è¿™ä¸ªæ§åˆ¶ç»„é‡Œä¸èµ·ä½œç”¨ã€‚</p><p>ä¸è¿‡ï¼Œè¿™é‡Œæœ‰ä¸€ç‚¹ä¸åŒï¼Œéœ€è¦ä½ ç•™æ„ï¼š<strong>å½“memory.swappiness = 0çš„æ—¶å€™ï¼Œå¯¹åŒ¿åé¡µçš„å›æ”¶æ˜¯å§‹ç»ˆç¦æ­¢çš„ï¼Œä¹Ÿå°±æ˜¯å§‹ç»ˆéƒ½ä¸ä¼šä½¿ç”¨Swapç©ºé—´ã€‚</strong></p><p>è¿™æ—¶Linuxç³»ç»Ÿä¸ä¼šå†å»æ¯”è¾ƒfreeå†…å­˜å’Œzoneé‡Œçš„high water markçš„å€¼ï¼Œå†å†³å®šä¸€ä¸ªMemory Cgroupä¸­çš„åŒ¿åå†…å­˜è¦ä¸è¦å›æ”¶äº†ã€‚</p><p>è¯·ä½ æ³¨æ„ï¼Œå½“æˆ‘ä»¬è®¾ç½®äº†\"memory.swappiness=0æ—¶ï¼Œåœ¨Memory Cgroupä¸­çš„è¿›ç¨‹ï¼Œå°±ä¸ä¼šå†ä½¿ç”¨Swapç©ºé—´ï¼ŒçŸ¥é“è¿™ä¸€ç‚¹å¾ˆé‡è¦ã€‚</p><p>æˆ‘ä»¬å¯ä»¥è·‘ä¸ªå®¹å™¨è¯•ä¸€è¯•ï¼Œè¿˜æ˜¯åœ¨ä¸€ä¸ªæœ‰Swapç©ºé—´çš„èŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œè¿è¡Œå’Œè¿™ä¸€è®²å¼€å§‹ä¸€æ ·çš„å®¹å™¨ï¼Œå”¯ä¸€ä¸åŒçš„æ˜¯æŠŠå®¹å™¨å¯¹åº”Memory Cgroupé‡Œçš„memory.swappinessè®¾ç½®ä¸º0ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/46/a7/46a1a06abfa2f817570c8cyy5faa62a7.png?wh=1920*495\" alt=\"\"></p><p>è¿™æ¬¡æˆ‘ä»¬åœ¨å®¹å™¨ä¸­ç”³è¯·å†…å­˜ä¹‹åï¼ŒSwapç©ºé—´å°±æ²¡æœ‰è¢«ä½¿ç”¨äº†ï¼Œè€Œå½“å®¹å™¨ç”³è¯·çš„å†…å­˜è¶…è¿‡memory.limit_in_bytesä¹‹åï¼Œå°±å‘ç”Ÿäº†OOM Killã€‚</p><p>å¥½äº†ï¼Œæœ‰äº†\"memory.swappiness = 0\"çš„é…ç½®å’ŒåŠŸèƒ½ï¼Œå°±å¯ä»¥è§£å†³æˆ‘ä»¬åœ¨è¿™ä¸€è®²é‡Œæœ€å¼€å§‹æå‡ºçš„é—®é¢˜äº†ã€‚</p><p>åœ¨åŒä¸€ä¸ªå®¿ä¸»æœºä¸Šï¼Œå‡è®¾åŒæ—¶å­˜åœ¨å®¹å™¨Aå’Œå…¶ä»–å®¹å™¨ï¼Œå®¹å™¨Aä¸Šè¿è¡Œç€éœ€è¦ä½¿ç”¨Swapç©ºé—´çš„åº”ç”¨ï¼Œè€Œåˆ«çš„å®¹å™¨ä¸éœ€è¦ä½¿ç”¨Swapç©ºé—´ã€‚</p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥åœ¨å®¿ä¸»æœºèŠ‚ç‚¹ä¸Šæ‰“å¼€Swapç©ºé—´ï¼ŒåŒæ—¶åœ¨å…¶ä»–å®¹å™¨å¯¹åº”çš„Memory Cgroupsæ§åˆ¶ç»„é‡Œï¼ŒæŠŠmemory.swappinessè¿™ä¸ªå‚æ•°è®¾ç½®ä¸º0ã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬ä¸ä½†æ»¡è¶³äº†å®¹å™¨Açš„éœ€æ±‚ï¼Œè€Œä¸”åˆ«çš„å®¹å™¨ä¹Ÿä¸ä¼šå—åˆ°å½±å“ï¼Œä»ç„¶å¯ä»¥ä¸¥æ ¼æŒ‰ç…§Memory Cgroupsé‡Œçš„memory.limit_in_bytesæ¥é™åˆ¶å†…å­˜çš„ä½¿ç”¨ã€‚</p><p>æ€»ä¹‹ï¼Œmemory.swappinessè¿™ä¸ªå‚æ•°å¾ˆæœ‰ç”¨ï¼Œé€šè¿‡å®ƒå¯ä»¥è®©éœ€è¦ä½¿ç”¨Swapç©ºé—´çš„å®¹å™¨å’Œä¸éœ€è¦Swapçš„å®¹å™¨ï¼ŒåŒæ—¶è¿è¡Œåœ¨åŒä¸€ä¸ªå®¿ä¸»æœºä¸Šã€‚</p><h2>é‡ç‚¹æ€»ç»“</h2><p>è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä¸»è¦è®¨è®ºçš„é—®é¢˜æ˜¯åœ¨å®¹å™¨ä¸­æ˜¯å¦å¯ä»¥ä½¿ç”¨Swapï¼Ÿ</p><p>è¿™ä¸ªé—®é¢˜æ²¡æœ‰çœ‹èµ·æ¥é‚£ä¹ˆç®€å•ã€‚å½“ç„¶äº†ï¼Œåªè¦åœ¨å®¿ä¸»æœºèŠ‚ç‚¹ä¸Šæ‰“å¼€Swapç©ºé—´ï¼Œåœ¨å®¹å™¨ä¸­å°±æ˜¯å¯ä»¥ç”¨åˆ°Swapçš„ã€‚ä½†å‡ºç°çš„é—®é¢˜æ˜¯åœ¨åŒä¸€ä¸ªå®¿ä¸»æœºä¸Šï¼Œå¯¹äºä¸éœ€è¦ä½¿ç”¨swapçš„å®¹å™¨ï¼Œ å®ƒçš„Memory Cgroupsçš„é™åˆ¶ä¹Ÿå¤±å»äº†ä½œç”¨ã€‚</p><p>é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å­¦ä¹ äº†Linuxä¸­çš„swappinessè¿™ä¸ªå‚æ•°ã€‚swappinesså‚æ•°å€¼çš„ä½œç”¨æ˜¯ï¼Œåœ¨ç³»ç»Ÿé‡Œæœ‰Swapç©ºé—´ä¹‹åï¼Œå½“ç³»ç»Ÿéœ€è¦å›æ”¶å†…å­˜çš„æ—¶å€™ï¼Œæ˜¯ä¼˜å…ˆé‡Šæ”¾Page Cacheä¸­çš„å†…å­˜ï¼Œè¿˜æ˜¯ä¼˜å…ˆé‡Šæ”¾åŒ¿åå†…å­˜ï¼ˆä¹Ÿå°±æ˜¯å†™å…¥Swapï¼‰ã€‚</p><p>swappinessçš„å–å€¼èŒƒå›´åœ¨0åˆ°100ä¹‹é—´ï¼Œæˆ‘ä»¬å¯ä»¥è®°ä½ä¸‹é¢ä¸‰ä¸ªå€¼ï¼š</p><ul>\n<li>å€¼ä¸º100çš„æ—¶å€™ï¼Œ é‡Šæ”¾Page Cacheå’ŒåŒ¿åå†…å­˜æ˜¯åŒç­‰ä¼˜å…ˆçº§çš„ã€‚</li>\n<li>å€¼ä¸º60ï¼Œè¿™æ˜¯å¤§å¤šæ•°Linuxç³»ç»Ÿçš„ç¼ºçœå€¼ï¼Œè¿™æ—¶å€™Page Cacheçš„é‡Šæ”¾ä¼˜å…ˆçº§é«˜äºåŒ¿åå†…å­˜çš„é‡Šæ”¾ã€‚</li>\n<li>å€¼ä¸º0çš„æ—¶å€™ï¼Œå½“ç³»ç»Ÿä¸­ç©ºé—²å†…å­˜ä½äºä¸€ä¸ªä¸´ç•Œå€¼çš„æ—¶å€™ï¼Œä»ç„¶ä¼šé‡Šæ”¾åŒ¿åå†…å­˜å¹¶æŠŠé¡µé¢å†™å…¥Swapç©ºé—´ã€‚</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/6a/11/6aa89d2b88493ddeb7d37ab9db275811.jpeg?wh=3200*1800\" alt=\"\"></p><p>swappinesså‚æ•°é™¤äº†åœ¨procæ–‡ä»¶ç³»ç»Ÿä¸‹æœ‰ä¸ªå…¨å±€çš„å€¼å¤–ï¼Œåœ¨æ¯ä¸ªMemory Cgroupæ§åˆ¶ç»„é‡Œä¹Ÿæœ‰ä¸€ä¸ªmemory.swappinessï¼Œé‚£å®ƒä»¬æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿ</p><p>ä¸åŒå°±æ˜¯æ¯ä¸ªMemory Cgroupæ§åˆ¶ç»„é‡Œçš„swappinesså‚æ•°å€¼ä¸º0çš„æ—¶å€™ï¼Œå°±å¯ä»¥è®©æ§åˆ¶ç»„é‡Œçš„å†…å­˜åœæ­¢å†™å…¥Swapã€‚è¿™æ ·ä¸€æ¥ï¼Œæœ‰äº†memory.swappinessè¿™ä¸ªå‚æ•°åï¼Œéœ€è¦ä½¿ç”¨Swapå’Œä¸éœ€è¦Swapçš„å®¹å™¨å°±å¯ä»¥åœ¨åŒä¸€ä¸ªå®¿ä¸»æœºä¸ŠåŒæ—¶è¿è¡Œäº†ï¼Œè¿™æ ·å¯¹äºç¡¬ä»¶èµ„æºçš„åˆ©ç”¨ç‡ä¹Ÿå°±æ›´é«˜äº†ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>åœ¨ä¸€ä¸ªæœ‰Swapåˆ†åŒºçš„èŠ‚ç‚¹ä¸Šç”¨Dockerå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼Œå¯¹å®ƒçš„Memory Cgroupæ§åˆ¶ç»„è®¾ç½®ä¸€ä¸ªå†…å­˜ä¸Šé™Nï¼Œå¹¶ä¸”å°†memory.swappinessè®¾ç½®ä¸º0ã€‚è¿™æ—¶ï¼Œå¦‚æœåœ¨å®¹å™¨ä¸­å¯åŠ¨ä¸€ä¸ªä¸æ–­è¯»å†™æ–‡ä»¶çš„ç¨‹åºï¼ŒåŒæ—¶è¿™ä¸ªç¨‹åºå†ç”³è¯·1/2Nçš„å†…å­˜ï¼Œè¯·ä½ åˆ¤æ–­ä¸€ä¸‹ï¼ŒSwapåˆ†åŒºä¸­ä¼šæœ‰æ•°æ®å†™å…¥å—ï¼Ÿ</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„æ”¶è·å’Œç–‘é—®ã€‚å¦‚æœè¿™ç¯‡æ–‡ç« è®©ä½ æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿åˆ†äº«ç»™ä½ çš„æœ‹å‹ï¼Œä¸€èµ·äº¤æµå’Œå­¦ä¹ ã€‚</p>","neighbors":{"left":{"article_title":"09 | Page Cacheï¼šä¸ºä»€ä¹ˆæˆ‘çš„å®¹å™¨å†…å­˜ä½¿ç”¨é‡æ€»æ˜¯åœ¨ä¸´ç•Œç‚¹?","id":316436},"right":{"article_title":"11 | å®¹å™¨æ–‡ä»¶ç³»ç»Ÿï¼šæˆ‘åœ¨å®¹å™¨ä¸­è¯»å†™æ–‡ä»¶æ€ä¹ˆå˜æ…¢äº†ï¼Ÿ","id":318173}},"comments":[{"had_liked":false,"id":266456,"user_name":"ä¼Ÿå¹³","can_delete":false,"product_type":"c1","uid":1441606,"ip_address":"","ucode":"2D3E55238FC8B3","user_header":"https://static001.geekbang.org/account/avatar/00/15/ff/46/7e4039ea.jpg","comment_is_top":false,"comment_ctime":1607344683,"is_pvip":false,"replies":[{"id":"96823","content":"kubeletç¼ºçœä¸èƒ½åœ¨æ‰“å¼€swapçš„èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚<br>é…ç½®â€œfailSwapOn: falseâ€å‚æ•°ï¼Œkubeletå¯ä»¥åœ¨swap enabledçš„èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1607439694,"ip_address":"","comment_id":266456,"utype":1}],"discussion_count":2,"race_medal":0,"score":"66031854123","product_id":100063801,"comment_content":"k8sä¸‹å®¹å™¨è²Œä¼¼ä¸èƒ½ç”¨swap","like_count":16,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511274,"discussion_content":"kubeletç¼ºçœä¸èƒ½åœ¨æ‰“å¼€swapçš„èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚\né…ç½®â€œfailSwapOn: falseâ€å‚æ•°ï¼Œkubeletå¯ä»¥åœ¨swap enabledçš„èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607439694,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1286588,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a1/bc/ef0f26fa.jpg","nickname":"é¦–å¯Œæ‰‹è®°","note":"","ucode":"879DED4078303C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387358,"discussion_content":"ç›®å‰æœ€æ–°ç‰ˆæœ¬å¯ä»¥è¿›è¡Œswap","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628133366,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":267224,"user_name":"Khirye","can_delete":false,"product_type":"c1","uid":1080985,"ip_address":"","ucode":"6C54C126FA54B8","user_header":"https://static001.geekbang.org/account/avatar/00/10/7e/99/c4302030.jpg","comment_is_top":false,"comment_ctime":1607653671,"is_pvip":false,"replies":[{"id":"97150","content":"å¯¹äºk8sæ¥è¯´ï¼Œçš„ç¡®æ²¡æœ‰å¿…è¦å†ç”¨dockeräº†ã€‚<br>è¿™æ˜¯æˆ‘ä»¬ç»„ä¹‹å‰åšçš„ä»dockeråˆ‡æ¢åˆ°containerdçš„æŠ€æœ¯åˆ†äº«:<br>https:&#47;&#47;www.infoq.cn&#47;article&#47;odslclsjvo8bnx*mbrbk","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1607786896,"ip_address":"","comment_id":267224,"utype":1}],"discussion_count":2,"race_medal":0,"score":"35967392039","product_id":100063801,"comment_content":" æƒ³é—®ä¸‹è€å¸ˆï¼Œå¯¹äºæœ€è¿‘k8så®£å¸ƒæ”¾å¼ƒdockeræœ‰ä»€ä¹ˆçœ‹æ³•ï¼Ÿ","like_count":8,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511552,"discussion_content":"å¯¹äºk8sæ¥è¯´ï¼Œçš„ç¡®æ²¡æœ‰å¿…è¦å†ç”¨dockeräº†ã€‚\nè¿™æ˜¯æˆ‘ä»¬ç»„ä¹‹å‰åšçš„ä»dockeråˆ‡æ¢åˆ°containerdçš„æŠ€æœ¯åˆ†äº«:\nhttps://www.infoq.cn/article/odslclsjvo8bnx*mbrbk","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1607786896,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1132009,"avatar":"https://static001.geekbang.org/account/avatar/00/11/45/e9/133553d1.jpg","nickname":"æ™´å¤©ğŸƒ","note":"","ucode":"5AE4A042B94010","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":541681,"discussion_content":"è¿˜æ˜¯ç¦»ä¸å¼€dockeré•œåƒï¼Œå¥½å¤šå…¬ä¼—å·è¯´çš„å®Œå…¨ä¸ç”¨dockeræŠ€æœ¯ä¼¼çš„","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1640517106,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":511552,"ip_address":""},"score":541681,"extra":""}]}]},{"had_liked":false,"id":266401,"user_name":"è«å","can_delete":false,"product_type":"c1","uid":1007254,"ip_address":"","ucode":"E28F2602BA25DD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5e/96/a03175bc.jpg","comment_is_top":false,"comment_ctime":1607324896,"is_pvip":false,"replies":[{"id":"96759","content":"@è«å, æ²¡é”™","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1607354552,"ip_address":"","comment_id":266401,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27377128672","product_id":100063801,"comment_content":"Memory Cgroup å‚æ•° memory.swappiness èµ·åˆ°å±€éƒ¨æ§åˆ¶çš„ä½œç”¨ï¼Œå‰ææ˜¯èŠ‚ç‚¹å¼€å¯äº† swap åŠŸèƒ½ï¼Œä¸ç„¶æ— è®ºå¦‚ä½•è®¾ç½®éƒ½æ— æµäºäº‹ã€‚","like_count":6,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511249,"discussion_content":"@è«å, æ²¡é”™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607354552,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":266346,"user_name":"kimoti","can_delete":false,"product_type":"c1","uid":1897671,"ip_address":"","ucode":"0A78077408C2B1","user_header":"https://static001.geekbang.org/account/avatar/00/1c/f4/c7/037235c9.jpg","comment_is_top":false,"comment_ctime":1607308483,"is_pvip":false,"replies":[{"id":"96822","content":"@kimoti <br>æ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1607437977,"ip_address":"","comment_id":266346,"utype":1}],"discussion_count":2,"race_medal":0,"score":"27377112259","product_id":100063801,"comment_content":"æ—¢ç„¶memory.swappinessè®¾ç½®ä¸º0äº†,Swapåˆ†åŒºæ˜¯ä¸ä¼šæœ‰æ•°æ®å†™å…¥çš„ã€‚","like_count":6,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511222,"discussion_content":"@kimoti \næ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607437977,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1580926,"avatar":"","nickname":"ch_ort","note":"","ucode":"B79746E687F29E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":575250,"discussion_content":"æ–‡ç« é‡Œè¯´ â€œä½†æ˜¯è¦æ³¨æ„ï¼Œåœ¨å®¿ä¸»æœºä¸Šï¼Œå³ä½¿ swappiness ä¸º 0ï¼Œä¹Ÿä¸èƒ½å®Œå…¨ç¦æ­¢ Swap åˆ†åŒºçš„ä½¿ç”¨ï¼Œå°±æ˜¯è¯´åœ¨å†…å­˜ç´§å¼ çš„æ—¶å€™ï¼Œä¹Ÿä¼šä½¿ç”¨ Swap \næ¥å›æ”¶åŒ¿åå†…å­˜ã€‚â€\n\næ—¢ç„¶ä¸ä¼šå†™å…¥äº†ä¸ºä»€ä¹ˆè¿˜ä¸èƒ½å®Œå…¨ç¦æ­¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654686403,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":511222,"ip_address":""},"score":575250,"extra":""}]}]},{"had_liked":false,"id":266426,"user_name":"Geek4329","can_delete":false,"product_type":"c1","uid":2028951,"ip_address":"","ucode":"D6FB8D1B2D5DAC","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f5/97/9a7ee7b3.jpg","comment_is_top":false,"comment_ctime":1607333371,"is_pvip":false,"replies":[{"id":"96818","content":"@Geek4329<br>å¾ˆé«˜å…´æˆ‘çš„åˆ†äº«å¯¹ä½ æœ‰å¸®åŠ©ï¼<br>","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1607437612,"ip_address":"","comment_id":266426,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10197267963","product_id":100063801,"comment_content":"æ„Ÿè°¢è€å¸ˆçš„åˆ†äº«ï¼Œå­¦ä¹ çš„è¶Šå¤šï¼Œè¶Šæ„Ÿåˆ°è‡ªå·±çš„è‡ªä¿¡ğŸ˜¼<br><br>å­¦å®Œè¿™ä¸ªè¯¾ç¨‹ï¼Œå¹¶å®Œå…¨å¸æ”¶çš„è¯ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥è¯´è‡ªå·±æ¥è¿‘ç²¾é€šå®¹å™¨æŠ€æœ¯äº†ğŸ˜","like_count":2,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511260,"discussion_content":"@Geek4329\nå¾ˆé«˜å…´æˆ‘çš„åˆ†äº«å¯¹ä½ æœ‰å¸®åŠ©ï¼\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607437612,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314617,"user_name":"åˆ˜å®","can_delete":false,"product_type":"c1","uid":2592318,"ip_address":"","ucode":"1C4632027E6933","user_header":"https://static001.geekbang.org/account/avatar/00/27/8e/3e/bdfb6dc3.jpg","comment_is_top":false,"comment_ctime":1633259415,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5928226711","product_id":100063801,"comment_content":"è¯·é—®ä¸€ä¸‹åœ¨å®¹å™¨é‡Œå¦‚ä½•åŠ å¿«page cacheçš„é‡Šæ”¾é€Ÿåº¦ï¼ŒåŸå› æ˜¯å‘ç°scpçš„æ—¶å€™ï¼Œpage cacheä¼šå¾ˆå¿«å°†å†…å­˜å æ»¡ï¼Œé€Ÿåº¦ä¼šéª¤ç„¶ä¸‹é™ï¼Œdrop cacheä»¥åï¼Œé€Ÿåº¦èƒ½æ˜¾è‘—æå‡ï¼›é…ç½®äº†vm.vfs_cache_pressureä¸º1wï¼Œä¾æ—§åœ¨å®¹å™¨é‡Œæ²¡æ”¹å–„","like_count":1,"discussions":[{"author":{"id":2058258,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/68/12/031a05c3.jpg","nickname":"Aå…å¸…å«å“¥","note":"","ucode":"76D2522E602AEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":407685,"discussion_content":"è¯•è¯•è°ƒæ•´å†…å­˜æ°´ä½çš„å€¼ï¼Œææ—©è§¦å‘å†…å­˜å›æ”¶ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635085678,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":292083,"user_name":"chong chong","can_delete":false,"product_type":"c1","uid":1028296,"ip_address":"","ucode":"4A0BC020787424","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b0/c8/cae61286.jpg","comment_is_top":false,"comment_ctime":1620663681,"is_pvip":false,"replies":[{"id":"111208","content":"å¯ä»¥ä¿®æ”¹kubeä»£ç ","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1628863275,"ip_address":"","comment_id":292083,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5915630977","product_id":100063801,"comment_content":"è€å¸ˆï¼Œk8s podé»˜è®¤çš„memory.swappiness å€¼æ˜¯60ï¼Œå¦‚ä½•è®¾ç½®æ‰èƒ½ä½¿å¾—é»˜è®¤æ˜¯0å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519673,"discussion_content":"å¯ä»¥ä¿®æ”¹kubeä»£ç ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628863275,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":267972,"user_name":"po","can_delete":false,"product_type":"c1","uid":1023905,"ip_address":"","ucode":"7DB36C278F34D7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9f/a1/d75219ee.jpg","comment_is_top":false,"comment_ctime":1608013912,"is_pvip":true,"replies":[{"id":"97462","content":"1. memory.swappiness æ˜¯æŒ‡cgroupä¸­çš„å‚æ•°<br>2. è¿™é‡Œè¯´çš„æ˜¯&#47;proc&#47;sys&#47;vm&#47;swappiness","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1608216596,"ip_address":"","comment_id":267972,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5902981208","product_id":100063801,"comment_content":"è€å¸ˆï¼Œæ–‡ç« ä¸­ä½ è¯´çš„è¿™ä¸¤å¥è¯å¥½åƒæ˜¯çŸ›ç›¾çš„ï¼Œswappinessè®¾ç½®ä¸º0çš„æ—¶å€™ï¼Œåˆ°åº•ä¼šä¸ä¼šå›æ”¶åŒ¿åå†…å­˜å‘¢ï¼Ÿ<br>1. ä¸è¿‡ï¼Œè¿™é‡Œæœ‰ä¸€ç‚¹ä¸åŒï¼Œéœ€è¦ä½ ç•™æ„ï¼šå½“ memory.swappiness = 0 çš„æ—¶å€™ï¼Œå¯¹åŒ¿åé¡µçš„å›æ”¶æ˜¯å§‹ç»ˆç¦æ­¢çš„ï¼Œä¹Ÿå°±æ˜¯å§‹ç»ˆéƒ½ä¸ä¼šä½¿ç”¨ Swap ç©ºé—´ã€‚è¿™æ—¶ Linux ç³»ç»Ÿä¸ä¼šå†å»æ¯”è¾ƒ free å†…å­˜å’Œ zone é‡Œçš„ high water mark çš„å€¼ï¼Œå†å†³å®šä¸€ä¸ª Memory Cgroup ä¸­çš„åŒ¿åå†…å­˜è¦ä¸è¦å›æ”¶äº†ã€‚è¯·ä½ æ³¨æ„ï¼Œå½“æˆ‘ä»¬è®¾ç½®äº†&quot;memory.swappiness=0 æ—¶ï¼Œåœ¨ Memory Cgroup ä¸­çš„è¿›ç¨‹ï¼Œå°±ä¸ä¼šå†ä½¿ç”¨ Swap ç©ºé—´ï¼ŒçŸ¥é“è¿™ä¸€ç‚¹å¾ˆé‡è¦.<br><br>2. å€¼ä¸º 0 çš„æ—¶å€™ï¼Œå½“ç³»ç»Ÿä¸­ç©ºé—²å†…å­˜ä½äºä¸€ä¸ªä¸´ç•Œå€¼çš„æ—¶å€™ï¼Œä»ç„¶ä¼šé‡Šæ”¾åŒ¿åå†…å­˜å¹¶æŠŠé¡µé¢å†™å…¥ Swap ç©ºé—´ã€‚","like_count":1,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511805,"discussion_content":"1. memory.swappiness æ˜¯æŒ‡cgroupä¸­çš„å‚æ•°\n2. è¿™é‡Œè¯´çš„æ˜¯/proc/sys/vm/swappiness","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608216596,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1019218,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8d/52/ec992ca9.jpg","nickname":"è±ª--","note":"","ucode":"62DB9611D6FE7F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350499,"discussion_content":"ä¸€ä¸ªå…¨å±€å‚æ•°ï¼Œä¸€ä¸ªæ˜¯cgroupå‚æ•°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613896266,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1361330,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c5/b2/5b339c64.jpg","nickname":"K-Li","note":"","ucode":"3091322142E43E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335213,"discussion_content":"memory.swappiness != swappiness è®¤çœŸå¬è®²å“¦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608123104,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":267890,"user_name":"haha","can_delete":false,"product_type":"c1","uid":1041547,"ip_address":"","ucode":"F4F3EAB4A15989","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e4/8b/8a0a6c86.jpg","comment_is_top":false,"comment_ctime":1607976211,"is_pvip":false,"replies":[{"id":"97296","content":"æ˜¯çš„ï¼Œ å¦‚æœåªæ˜¯è®¾ç½® memory.limit_in_bytes","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1607999653,"ip_address":"","comment_id":267890,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5902943507","product_id":100063801,"comment_content":"æ‰€ä»¥å¯¹äºå¼€å¯äº†swapï¼Œä¸”swapç©ºé—´å¤Ÿå¤§çš„å‰æä¸‹ï¼Œgoupçš„mem limitæ²¡ç”¨å’¯?","like_count":2,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511775,"discussion_content":"æ˜¯çš„ï¼Œ å¦‚æœåªæ˜¯è®¾ç½® memory.limit_in_bytes","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607999653,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":266441,"user_name":"è°¢å“ˆå“ˆ","can_delete":false,"product_type":"c1","uid":2326880,"ip_address":"","ucode":"5AADE70B5AFE27","user_header":"https://static001.geekbang.org/account/avatar/00/23/81/60/71ed6ac7.jpg","comment_is_top":false,"comment_ctime":1607341311,"is_pvip":false,"replies":[{"id":"96820","content":"@è°¢å“ˆå“ˆ<br>æ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"CY","uid":"2070138","ctime":1607437956,"ip_address":"","comment_id":266441,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5902308607","product_id":100063801,"comment_content":"å·²ç»è®¾ç½®memory.swappinesså‚æ•°ï¼Œå…¨å±€å‚æ•°swappinesså‚æ•°å¤±æ•ˆï¼Œé‚£ä¹ˆå®¹å™¨é‡Œå°±ä¸èƒ½ä½¿ç”¨swapäº†","like_count":1,"discussions":[{"author":{"id":2070138,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/96/7a/8a14d008.jpg","nickname":"CY","note":"","ucode":"4AF98230985918","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511268,"discussion_content":"@è°¢å“ˆå“ˆ\næ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607437956,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355094,"user_name":"Yannå½¦","can_delete":false,"product_type":"c1","uid":2053796,"ip_address":"å¹¿ä¸œ","ucode":"1F3676A18E4904","user_header":"https://static001.geekbang.org/account/avatar/00/1f/56/a4/9d4089e8.jpg","comment_is_top":false,"comment_ctime":1661073691,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1661073691","product_id":100063801,"comment_content":"k8sé›†ç¾¤ä¸­æ˜¯å¦å»ºè®®æ‰“å¼€swapå‘¢ï¼Ÿæ‰“å¼€è¿‡å…³é—­æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":340711,"user_name":"å†Œä¹¦ä¸€å¹•","can_delete":false,"product_type":"c1","uid":1281389,"ip_address":"","ucode":"75FA281B772DF6","user_header":"https://static001.geekbang.org/account/avatar/00/13/8d/6d/8c0a487b.jpg","comment_is_top":false,"comment_ctime":1649068342,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1649068342","product_id":100063801,"comment_content":"â€œä¸è¿‡ï¼Œè¿™é‡Œæœ‰ä¸€ç‚¹ä¸åŒï¼Œéœ€è¦ä½ ç•™æ„ï¼šå½“ memory.swappiness = 0 çš„æ—¶å€™ï¼Œå¯¹åŒ¿åé¡µçš„å›æ”¶æ˜¯å§‹ç»ˆç¦æ­¢çš„ï¼Œä¹Ÿå°±æ˜¯å§‹ç»ˆéƒ½ä¸ä¼šä½¿ç”¨ Swap ç©ºé—´ã€‚â€<br>è¿™å¥è¯æ˜¯æŒ‡çš„ä»…åœ¨cgroupæƒ…å†µä¸‹å—ï¼Ÿåœ¨ä¸»æœºä¸‹ï¼Œmemory.swappiness = 0æ˜¯ä¸ä¼šåˆ†é…swapä½†æ˜¯ä¼šå›æ”¶","like_count":0,"discussions":[{"author":{"id":1532691,"avatar":"https://static001.geekbang.org/account/avatar/00/17/63/13/6aca76ab.jpg","nickname":"Geek_Hanson","note":"","ucode":"F6CB550D797C0C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":567192,"discussion_content":"1ã€memory.swappinessæ˜¯cgroupå‚æ•°ï¼Œ/proc/sys/vm/swappinessæ˜¯å…¨å±€å‚æ•°\n2ã€swappinesså…¨å±€å‚æ•°ï¼Œå³ä½¿ä¸º0ï¼Œä¹Ÿä¸èƒ½å®Œå…¨ç¦æ­¢ Swap åˆ†åŒºçš„ä½¿ç”¨ï¼Œå°±æ˜¯è¯´åœ¨å†…å­˜ç´§å¼ çš„æ—¶å€™ï¼Œä¹Ÿä¼šä½¿ç”¨ Swap æ¥å›æ”¶åŒ¿åå†…å­˜ã€‚\n3ã€å¦‚æœå®¹å™¨åœ¨swapç¯å¢ƒè¿è¡Œï¼Œå½“ memory.swappiness = 0 çš„æ—¶å€™ï¼Œå¯¹åŒ¿åé¡µçš„å›æ”¶æ˜¯å§‹ç»ˆç¦æ­¢çš„ï¼Œä¹Ÿå°±æ˜¯å§‹ç»ˆéƒ½ä¸ä¼šä½¿ç”¨ Swap ç©ºé—´ã€‚\n4ã€å¦‚æœswapè¢«ç¦ç”¨ï¼Œåœ¨cgroupä¸­memory.swappinessæ€ä¹ˆè®¾ç½®éƒ½æ˜¯æ— æ•ˆçš„ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1650856091,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1281389,"avatar":"https://static001.geekbang.org/account/avatar/00/13/8d/6d/8c0a487b.jpg","nickname":"å†Œä¹¦ä¸€å¹•","note":"","ucode":"75FA281B772DF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1532691,"avatar":"https://static001.geekbang.org/account/avatar/00/17/63/13/6aca76ab.jpg","nickname":"Geek_Hanson","note":"","ucode":"F6CB550D797C0C","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":582068,"discussion_content":"æ˜¯è¿™ä¹ˆä¸ªç†ï¼Œä½†æ˜¯Cgroupé‡Œçš„swappinessè·Ÿå…¨å±€çš„swappinessæœ‰å•¥ä¸åŒå‘¢?ä¸ºå•¥å…¨å±€ä¸º0è¿˜å­˜åœ¨è¢«ä½¿ç”¨çš„å¯èƒ½ï¼Œè€ŒCgroupé‡Œçš„swappinesså°±ä¸è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659175300,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":567192,"ip_address":"é™•è¥¿"},"score":582068,"extra":""}]}]},{"had_liked":false,"id":340710,"user_name":"å†Œä¹¦ä¸€å¹•","can_delete":false,"product_type":"c1","uid":1281389,"ip_address":"","ucode":"75FA281B772DF6","user_header":"https://static001.geekbang.org/account/avatar/00/13/8d/6d/8c0a487b.jpg","comment_is_top":false,"comment_ctime":1649068260,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1649068260","product_id":100063801,"comment_content":"ä¸è¿‡ï¼Œè¿™é‡Œæœ‰ä¸€ç‚¹ä¸åŒï¼Œéœ€è¦ä½ ç•™æ„ï¼šå½“ memory.swappiness = 0 çš„æ—¶å€™ï¼Œå¯¹åŒ¿åé¡µçš„å›æ”¶æ˜¯å§‹ç»ˆç¦æ­¢çš„ï¼Œä¹Ÿå°±æ˜¯å§‹ç»ˆéƒ½ä¸ä¼šä½¿ç”¨ Swap ç©ºé—´ã€‚","like_count":0},{"had_liked":false,"id":320341,"user_name":"æ™¯b","can_delete":false,"product_type":"c1","uid":1025641,"ip_address":"","ucode":"70E04E6B30432C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a6/69/cf2eb6be.jpg","comment_is_top":false,"comment_ctime":1636266100,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636266100","product_id":100063801,"comment_content":"å¦‚æœæœ‰åˆ†å¸ƒå¼å­˜å‚¨çš„èƒ½åŠ›ä¸”èƒ½åšåˆ°æŒ‰å·çº§åˆ«åšé™é€Ÿï¼Œæ¯ä¸ªå®¹å™¨éƒ½æ˜¯å•ç‹¬æŒ‚ä¸€ä¸ªå·è¿›å»ï¼Œæ˜¯ä¸æ˜¯å¼€swapå°±åˆ©å¤§äºå¼Šã€‚å¯ä»¥è¿™ä¹ˆç†è§£ä¸","like_count":0},{"had_liked":false,"id":300978,"user_name":"BertGeek","can_delete":false,"product_type":"c1","uid":1452799,"ip_address":"","ucode":"8E1D72C9F9778C","user_header":"https://static001.geekbang.org/account/avatar/00/16/2a/ff/a9d72102.jpg","comment_is_top":false,"comment_ctime":1625474176,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625474176","product_id":100063801,"comment_content":"1ã€swappinessï¼ˆ&#47;proc&#47;sys&#47;vm&#47;swappinessï¼‰ çš„å–å€¼èŒƒå›´åœ¨ 0 åˆ° 100 ä¹‹é—´ï¼Œæˆ‘ä»¬å¯ä»¥è®°ä½ä¸‹é¢ä¸‰ä¸ªå€¼ï¼š<br>1.1 å€¼ä¸º 100 çš„æ—¶å€™ï¼Œé‡Šæ”¾ Page Cache å’ŒåŒ¿åå†…å­˜æ˜¯åŒç­‰ä¼˜å…ˆçº§çš„ã€‚<br>1.2 å€¼ä¸º 60ï¼Œè¿™æ˜¯å¤§å¤šæ•° Linux ç³»ç»Ÿçš„ç¼ºçœå€¼ï¼Œè¿™æ—¶å€™ Page Cache çš„é‡Šæ”¾ä¼˜å…ˆçº§é«˜äºåŒ¿åå†…å­˜çš„é‡Šæ”¾ã€‚<br>1.3 å€¼ä¸º0ï¼Œä¹Ÿä¸èƒ½å®Œå…¨ç¦æ­¢ Swap åˆ†åŒºçš„ä½¿ç”¨ï¼Œå°±æ˜¯å½“ç³»ç»Ÿä¸­ç©ºé—²å†…å­˜ä½äºä¸€ä¸ªä¸´ç•Œå€¼çš„æ—¶å€™ï¼Œä»ç„¶ä¼šé€šè¿‡swapå›æ”¶åŒ¿åå†…å­˜ï¼ˆé‡Šæ”¾åŒ¿åå†…å­˜å¹¶æŠŠé¡µé¢å†™å…¥ Swap ç©ºé—´ï¼‰ã€‚<br><br>2ã€Memroy Cgroup æ§åˆ¶ç»„ä¸­çš„memory.swappinesså‚æ•°<br>    å¦‚æœè®¾ç½®memory.swappinesså‚æ•°ï¼Œæ­¤å®¹å™¨ä¸­çš„å…¨å±€swappinesså‚æ•°å¤±æ•ˆï¼Œé‚£ä¹ˆæ­¤å®¹å™¨é‡Œå°±ä¸èƒ½ä½¿ç”¨swapäº†","like_count":1}]}