{"id":557500,"title":"15 ï½œ Androidå¹³å°æ˜¯å¦‚ä½•é‡‡é›†è§†é¢‘ç”»é¢çš„ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å±•æ™“å‡¯ã€‚ä»Šå¤©æˆ‘ä»¬æ¥ä¸€èµ·å­¦ä¹ Androidå¹³å°è§†é¢‘ç”»é¢çš„é‡‡é›†ã€‚</p><p><a href=\"https://time.geekbang.org/column/article/556012\">ä¸Šä¸€èŠ‚è¯¾</a>æˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†iOSå¹³å°çš„è§†é¢‘ç”»é¢é‡‡é›†ï¼ŒAndroidå¹³å°çš„é‡‡é›†ç›¸å¯¹æ¥è®²ä¼šæ›´å¤æ‚ä¸€äº›ï¼Œå› ä¸ºæˆ‘ä»¬æ•´ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒéƒ¨åˆ†éƒ½æ˜¯åœ¨Nativeå±‚æ„å»ºçš„ï¼Œæ‰€ä»¥è¿™å°±ä¼šæ¶‰åŠJNIå±‚çš„ä¸€äº›è½¬æ¢æ“ä½œã€‚ä¸è¿‡ä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä¼šå¸¦ç€ä½ ä¸€æ­¥æ­¥æ„å»ºèµ·æ•´ä¸ªç³»ç»Ÿã€‚</p><h2>æƒé™é…ç½®</h2><p>è¦æƒ³ä½¿ç”¨Androidå¹³å°æä¾›çš„æ‘„åƒå¤´ï¼Œå¿…é¡»åœ¨é…ç½®æ–‡ä»¶é‡Œæ·»åŠ æƒé™è¦æ±‚ã€‚</p><pre><code class=\"language-plain\">&lt;uses-permission android:name=\"android.permission.CAMERA\" /&gt;\n</code></pre><p>Android 6.0åŠä»¥ä¸Šçš„ç³»ç»Ÿï¼Œéœ€è¦åŠ¨æ€ç”³è¯·æƒé™ã€‚</p><pre><code class=\"language-plain\">if (ContextCompat.checkSelfPermission(MainActivity.this, android.Manifest.permission.CAMERA)!= PackageManager.PERMISSION_GRANTED){\n  //æ²¡æœ‰æƒé™å°±åœ¨è¿™é‡Œç”³è¯· \n  ActivityCompat.requestPermissions(MainActivity.this, new String[]{Manifest.permission.CAMERA}, CAMERA_OK); \n}else { \n  //è¯´æ˜å·²ç»è·å–åˆ°æ‘„åƒå¤´æƒé™äº† \n}\n</code></pre><!-- [[[read_end]]] --><p>éšç€Androidç³»ç»Ÿçš„å‘å±•ï¼Œæ‘„åƒå¤´APIä¹Ÿæœ‰äº†éå¸¸å¤šçš„å˜åŒ–ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ç»™Cameraè®¾ç½®é¢„è§ˆçº¹ç†çš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç»™Cameraè®¾ç½®æ¥æ”¶YUVæ•°æ®å›è°ƒçš„æ–¹å¼ã€‚è¿™æ˜¯å› ä¸ºå¾—åˆ°çº¹ç†IDä¹‹åï¼Œè¿›å…¥æˆ‘ä»¬çš„OpenGL ESæ¸²æŸ“é“¾è·¯ä¼šæ›´æ–¹ä¾¿ï¼ŒåŒæ—¶è§†é¢‘æ»¤é•œå¤„ç†ã€Viewçš„æ¸²æŸ“ä¹Ÿä¼šæ–¹ä¾¿ä¸€äº›ã€‚</p><h2>é…ç½®æ‘„åƒå¤´</h2><p>ä½¿ç”¨Androidçš„æ‘„åƒå¤´é‡‡é›†æ•°æ®ï¼Œéœ€è¦æ‰“å¼€æ‘„åƒå¤´å¹¶è¿›è¡Œä¸€äº›é…ç½®ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹æ‰“å¼€æ‘„åƒå¤´çš„æ“ä½œã€‚</p><h3>æ‰“å¼€æ‘„åƒå¤´</h3><p>Androidå¹³å°æä¾›çš„æ‰“å¼€æ‘„åƒå¤´çš„æ¥å£å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">public static Camera open(int cameraId)\n</code></pre><p>éœ€è¦ä¼ å…¥çš„å‚æ•°å°±æ˜¯æ‘„åƒå¤´çš„IDã€‚æˆ‘ä»¬çŸ¥é“ï¼Œæ˜¯å…ˆæœ‰çš„åç½®æ‘„åƒå¤´ï¼Œåæœ‰çš„å‰ç½®æ‘„åƒå¤´ï¼Œç”šè‡³ç›®å‰éƒ¨åˆ†æ‰‹æœºå·²ç»æœ‰äº†æ›´å¤šçš„è¾…åŠ©æ‘„åƒå¤´ï¼Œæ‰€ä»¥æ‘„åƒå¤´çš„IDä¹Ÿæ˜¯æŒ‰å…ˆåé¡ºåºæ’åˆ—çš„ï¼Œåç½®æ‘„åƒå¤´æ˜¯0ï¼Œå‰ç½®æ‘„åƒå¤´æ˜¯1ï¼Œç„¶åæ‰æ˜¯å…¶ä»–çš„æ‘„åƒå¤´ï¼Œéœ€è¦ä½¿ç”¨CameraInfoè¿™ä¸ªç±»é‡Œé¢çš„ä¸¤ä¸ªå¸¸é‡ï¼ŒCAMERA_FACING_BACKåç½®æ‘„åƒå¤´å’ŒCAMERA_FACING_FRONTå‰ç½®æ‘„åƒå¤´</p><p>è¿™ä¸ªå‡½æ•°è¿”å›çš„å°±æ˜¯ä¸€ä¸ªæ‘„åƒå¤´çš„å®ä¾‹ï¼Œå¦‚æœè¿”å›çš„æ˜¯NULLï¼Œæˆ–è€…æŠ›å‡ºå¼‚å¸¸<span class=\"reference\">ï¼ˆå› ä¸ºä¸åŒå‚å•†æ‰€ç»™å‡ºçš„è¿”å›ä¸ä¸€è‡´ï¼‰</span>ï¼Œä»£è¡¨ç”¨æˆ·æ²¡æœ‰ç»™è¿™ä¸ªåº”ç”¨æˆæƒï¼Œå°±ä¸å¯ä»¥è®¿é—®æ‘„åƒå¤´ã€‚æ‹¿åˆ°è¿™ä¸ªæ‘„åƒå¤´å®ä¾‹ä¹‹åï¼Œè¦ä¸ºè¿™ä¸ªæ‘„åƒå¤´å®ä¾‹åšä¸€äº›é…ç½®ï¼Œå‚æ•°çš„é…ç½®ä¸»è¦å°±æ˜¯é¢„è§ˆæ ¼å¼å’Œé¢„è§ˆçš„å°ºå¯¸ã€‚å…ˆæ¥çœ‹é¢„è§ˆæ ¼å¼çš„è®¾ç½®ã€‚</p><h3>é¢„è§ˆæ ¼å¼</h3><p>é¢„è§ˆæ ¼å¼ä¸€èˆ¬è®¾ç½®ä¸ºNV21æ ¼å¼ï¼Œå®é™…ä¸Šå°±æ˜¯YUV420SPæ ¼å¼ï¼Œå³UVæ˜¯äº¤é”™<span class=\"reference\">ï¼ˆinterleavedï¼‰</span>å­˜æ”¾çš„ï¼Œè®¾ç½®ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">List&lt;Integer&gt; supportedPreviewFormats = parameters.getSupportedPreviewFormats();\nif (supportedPreviewFormats.contains(ImageFormat.NV21)) {\n&nbsp;&nbsp;&nbsp; parameters.setPreviewFormat(ImageFormat.NV21);\n} else {\n&nbsp;&nbsp;&nbsp; throw new CameraParamSettingException(\"è§†é¢‘å‚æ•°è®¾ç½®é”™è¯¯:è®¾ç½®é¢„è§ˆå›¾åƒæ ¼å¼å¼‚å¸¸\");\n}\n</code></pre><p>ä»£ç æ˜¾ç¤ºï¼Œå…ˆå–å‡ºæ‘„åƒå¤´æ”¯æŒçš„æ‰€æœ‰çš„é¢„è§ˆæ ¼å¼ï¼Œç„¶ååˆ¤æ–­ä¸€ä¸‹æœ‰æ²¡æœ‰æˆ‘ä»¬è¦è®¾å®šçš„æ ¼å¼ï¼Œå¦‚æœæœ‰ï¼Œå°±è®¾ç½®è¿›å»ï¼›å¦‚æœæ²¡æœ‰ï¼Œå°±æŠ›å‡ºå¼‚å¸¸ï¼Œç•™ç»™ä¸šåŠ¡å±‚å¤„ç†ã€‚</p><h3>é¢„è§ˆå°ºå¯¸</h3><p>æ¥ä¸‹æ¥æ˜¯é¢„è§ˆå°ºå¯¸çš„è®¾ç½®ï¼Œä¸€èˆ¬è®¾ç½®æˆ1280<em>720ï¼Œå½“ç„¶åœ¨æŸäº›ç‰¹æ®Šåœºæ™¯ï¼Œä¹Ÿå¯ä»¥è®¾ç½®æˆ640</em>480çš„åˆ†è¾¨ç‡ï¼Œè®¾ç½®ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">List&lt;Size&gt; supportedPreviewSizes = parameters.getSupportedPreviewSizes();\nint previewWidth = 640;//1280\nint previewHeight = 480;//720\nboolean isSupportPreviewSize = isSupportPreviewSize(\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; supportedPreviewSizes, previewWidth, previewHeight);\nif (isSupportPreviewSize) {\n&nbsp;&nbsp;&nbsp; parameters.setPreviewSize(previewWidth, previewHeight);\n} else {\n&nbsp;&nbsp;&nbsp; throw new CameraParamSettingException(\"è§†é¢‘å‚æ•°è®¾ç½®é”™è¯¯:è®¾ç½®é¢„è§ˆçš„å°ºå¯¸å¼‚å¸¸\");\n}\n</code></pre><p>æ‰§è¡Œä»£ç å°±ä¼šè·å–æ‘„åƒå¤´æ”¯æŒçš„æ‰€æœ‰åˆ†è¾¨ç‡åˆ—è¡¨ï¼Œç„¶ååˆ¤æ–­è¦è®¾ç½®çš„åˆ†è¾¨ç‡æ˜¯å¦åœ¨æ”¯æŒçš„åˆ—è¡¨ä¸­ï¼Œå¦‚æœåœ¨çš„è¯å°±è®¾ç½®è¿›å»ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œç•™ç»™ä¸šåŠ¡å±‚å»å¤„ç†ã€‚</p><p>é…ç½®å®Œä¸Šé¢çš„å‚æ•°ä¹‹åï¼Œå°±è¦æŠŠè¿™ä¸ªå‚æ•°è®¾ç½®ç»™Cameraè¿™ä¸ªå®ä¾‹äº†ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">try {\n&nbsp;&nbsp;&nbsp; mCamera.setParameters(parameters);\n} catch (Exception e) {\n&nbsp;&nbsp;&nbsp; throw new CameraParamSettingException(\"è§†é¢‘å‚æ•°è®¾ç½®é”™è¯¯\");\n}\n</code></pre><p>åœ¨å®½é«˜çš„è®¾ç½®ä¸­ï¼Œè¦æ³¨æ„å®½æ˜¯1280<span class=\"reference\">ï¼ˆæˆ–è€…640ï¼‰</span>ï¼Œé«˜æ˜¯720<span class=\"reference\">ï¼ˆæˆ–è€…480ï¼‰</span>ï¼Œè¿™æ˜¯å› ä¸ºæ‘„åƒå¤´é»˜è®¤é‡‡é›†å‡ºæ¥çš„è§†é¢‘ç”»é¢æ˜¯æ¨ªç‰ˆçš„ã€‚åœ¨æ˜¾ç¤ºçš„æ—¶å€™ï¼Œéœ€è¦è·å–å½“å‰æ‘„åƒå¤´é‡‡é›†å‡ºæ¥çš„ç”»é¢çš„æ—‹è½¬è§’åº¦ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢è¿™æ®µä»£ç æ¥è·å–æ—‹è½¬è§’åº¦ã€‚</p><pre><code class=\"language-plain\">int degrees = 0;\nCameraInfo info = new CameraInfo();\nCamera.getCameraInfo(cameraId, info);\nif (info.facing == Camera.CameraInfo.CAMERA_FACING_FRONT) {\n&nbsp;&nbsp; &nbsp;degrees = (info.orientation) % 360;\n} else { // back-facing\n&nbsp;&nbsp;&nbsp; degrees = (info.orientation + 360) % 360;\n}\n</code></pre><p>æ ¹æ®ä¸åŒçš„æ‘„åƒå¤´å–å‡ºå¯¹åº”çš„CameraInfoï¼Œè¿™ä¸ªCameraInfoé‡Œçš„orientationå±æ€§è¡¨ç¤ºçš„å°±æ˜¯ç”»é¢çš„æ—‹è½¬è§’åº¦ï¼Œä¸è¿‡è¦æƒ³æ­£ç¡®åœ°æ—‹è½¬è¿˜è¦å†å¤„ç†ä¸€ä¸‹ã€‚å¦‚æœæ˜¯å‰ç½®æ‘„åƒå¤´ï¼Œå°±ç›´æ¥å¯¹360è¿›è¡Œå–æ¨¡ï¼›å¦‚æœæ˜¯åç½®æ‘„åƒå¤´ï¼Œè¦åŠ ä¸Š360åº¦å†å–æ¨¡360ï¼Œä»è€Œå¾—åˆ°è¦æ—‹è½¬çš„è§’åº¦ã€‚è¿™ä¸ªè§’åº¦å¯¹äºå°†è§†é¢‘å¸§æ­£ç¡®åœ°æ˜¾ç¤ºåˆ°å±å¹•ä¸Šæ˜¯è‡³å…³é‡è¦çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¸¦ç€è¿™ä¸ªè§’åº¦è¿›å…¥æ‘„åƒå¤´é¢„è§ˆéƒ¨åˆ†çš„å­¦ä¹ å§ã€‚</p><h2>æ‘„åƒå¤´çš„é¢„è§ˆ</h2><p>æ‘„åƒå¤´çš„åŸºç¡€å‚æ•°é…ç½®å¥½ä¹‹åï¼Œå°±å¯ä»¥æ¥æ”¶æ‘„åƒå¤´é‡‡é›†çš„å›¾åƒï¼Œç„¶åå°†å›¾åƒæ¸²æŸ“åˆ°å±å¹•ä¸Šäº†ã€‚OpenGL ESæ¸²æŸ“å›¾åƒçš„åŸºæœ¬æµç¨‹æ˜¯ï¼Œå…ˆæŠŠå›¾åƒè§£ç æˆRGBAæ ¼å¼ï¼Œç„¶åå°†RGBAæ ¼å¼çš„å­—èŠ‚æ•°ç»„ä¸Šä¼ åˆ°ä¸€ä¸ªçº¹ç†ä¸Šï¼Œæœ€ç»ˆå°†çº¹ç†æ¸²æŸ“åˆ°å±å¹•Viewä¸Šï¼Œè€Œè¿™é‡Œçš„æ¸²æŸ“ä¹Ÿä¼šä½¿ç”¨OpenGL ESå®ç°ã€‚</p><h3>æ¸²æŸ“é“¾è·¯</h3><p>æ•´ä½“æ¸²æŸ“æ¶æ„æˆ‘ä»¬åœ¨Javaå±‚æ„é€ ä¸€ä¸ªSurface(Texture)Viewï¼Œæ¥æ˜¾ç¤ºæ¸²æŸ“çš„ç»“æœï¼Œç„¶ååœ¨Nativeå±‚ç”¨EGLå’ŒOpenGL ESç»™è¿™ä¸ªSurfaceViewåšæ¸²æŸ“ã€‚æ ¸å¿ƒçš„è¿æ¥ç‚¹å¦‚ä¸‹ï¼š</p><ul>\n<li>åœ¨Nativeå±‚çš„OpenGLçº¿ç¨‹ä¸­ï¼Œç”Ÿæˆä¸€ä¸ªçº¹ç†IDå¹¶ä¼ é€’åˆ°Javaå±‚ï¼ŒJavaå±‚åˆ©ç”¨è¿™ä¸ªçº¹ç†IDæ„é€ å‡ºä¸€ä¸ªSurfaceTextureã€‚</li>\n<li>æŠŠè¿™ä¸ªSurfaceTextureè®¾ç½®ç»™Cameraçš„é¢„è§ˆçº¹ç†ï¼Œç„¶åè°ƒç”¨Cameraçš„å¼€å§‹é¢„è§ˆæ–¹æ³•ã€‚</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/9a/37/9a85b7aa0208536735bb39b2cbe5f237.png?wh=1920x1001\" alt=\"å›¾ç‰‡\" title=\"å¼€å§‹é¢„è§ˆ\"></p><p>ä½†æ˜¯æˆ‘ä»¬æ€ä¹ˆèƒ½å¤ŸçŸ¥é“æ‘„åƒå¤´æ•æ‰åˆ°äº†ä¸€å¼ æ–°çš„å›¾ç‰‡å‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ç»™è¿™ä¸ªSurfaceTextureè®¾ç½®è§†é¢‘å¸§å¯ç”¨ç›‘å¬è€…ã€‚å½“Cameraè®¾å¤‡é‡‡é›†åˆ°ä¸€å¸§å†…å®¹çš„æ—¶å€™ï¼Œå°±ä¼šå›è°ƒè¿™ä¸ªListenerï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹ä»£ç ã€‚</p><pre><code class=\"language-plain\">mCameraSurfaceTexture = new SurfaceTexture(textureId);\ntry {\n&nbsp;&nbsp;&nbsp; mCamera.setPreviewTexture(mCameraSurfaceTexture);\n&nbsp;&nbsp;&nbsp; mCameraSurfaceTexture.setOnFrameAvailableListener(frameAvailableListener);\n&nbsp;&nbsp;&nbsp; mCamera.startPreview();\n} catch (Exception e) {\n&nbsp;&nbsp;&nbsp; throw new CameraParamSettingException(\"è®¾ç½®é¢„è§ˆçº¹ç†é”™è¯¯\");\n}\n</code></pre><p>ä»£ç é‡Œçš„frameAvailableListeneræ˜¯ç»§æ‰¿è‡ªOnFrameAvailableListenerçš„å†…éƒ¨ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œè¿™ä¸ªå†…éƒ¨ç±»é‡Œéœ€è¦é‡å†™onFrameAvailableæ–¹æ³•ã€‚å½“æ‘„åƒå¤´é‡‡é›†åˆ°ä¸€å¸§å›¾åƒåï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨æ–¹æ³•ä¸­æˆ‘ä»¬è°ƒç”¨Nativeå±‚çš„æ–¹æ³•æ¥æ¸²æŸ“å‡ºæ‘„åƒå¤´åˆšåˆšæ•æ‰çš„å›¾åƒã€‚</p><p>Nativeå±‚çš„è¿™ä¸ªæ–¹æ³•ä¼šè½¬æ¢åˆ°æ¸²æŸ“çº¿ç¨‹ä¸­è°ƒç”¨SurfaceTextureçš„updateTexImageæ–¹æ³•<span class=\"reference\">ï¼ˆå› ä¸ºå¿…é¡»åœ¨OpenGL ESçº¿ç¨‹æ‰å¯ä»¥è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥ç»•äº†ä¸€å¤§åœˆï¼‰</span>ã€‚è¿™ä¸ªæ–¹æ³•è°ƒç”¨å®Œæ¯•ä¹‹åï¼Œæ‘„åƒå¤´é‡‡é›†çš„è§†é¢‘å¸§å°±æ”¾åˆ°äº†Nativeå±‚ç”Ÿæˆçš„çº¹ç†ä¸Šå»äº†ï¼Œæ¸²æŸ“çº¿ç¨‹å°±å¯ä»¥ç»§ç»­æŠŠè¿™ä¸ªçº¹ç†æ¸²æŸ“åˆ°ç•Œé¢ä¸Šå»äº†ã€‚å½“æ‘„åƒå¤´å†ä¸€æ¬¡é‡‡é›†åˆ°ä¸€å¸§æ–°å›¾åƒçš„æ—¶å€™ï¼Œå°±å‘¨è€Œå¤å§‹åœ°æ‰§è¡Œä¸Šè¿°è¿‡ç¨‹ï¼Œè¿™æ ·åœ¨è®¾å¤‡å±å¹•ä¸Šå°±å¯ä»¥æµç•…åœ°é¢„è§ˆæ‘„åƒå¤´é‡‡é›†çš„å†…å®¹äº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/74/d0/744eyy84604f78a1bc065652fb6357d0.png?wh=1920x673\" alt=\"å›¾ç‰‡\" title=\"åˆ·æ–°é¢„è§ˆ\"></p><h3>æ¸²æŸ“è¿‡ç¨‹ä¸OESçº¹ç†</h3><p>ä¸Šé¢æˆ‘ä»¬åœ¨Nativeå±‚çš„OpenGLçº¿ç¨‹ä¸­ç”Ÿæˆä¸€ä¸ªçº¹ç†IDï¼Œç„¶åä¼ é€’åˆ°Javaå±‚ï¼Œç”±Javaå±‚æ„é€ æˆä¸€ä¸ªSurfaceTextureç±»å‹çš„å¯¹è±¡ï¼Œå¹¶å°†Cameraçš„PreviewCallbackè®¾ç½®ä¸ºè¿™ä¸ªSurfaceTextureå¯¹è±¡ã€‚</p><p>è¿˜è®°å¾—åœ¨æ‘„åƒå¤´é…ç½®é˜¶æ®µï¼Œæˆ‘ä»¬ç»™æ‘„åƒå¤´é…ç½®çš„è§†é¢‘é¢‘å¸§æ ¼å¼æ˜¯NV21å—ï¼Ÿä¹Ÿå°±æ˜¯YUV420SPæ ¼å¼çš„ï¼Œè¿™ä¸ªæ ¼å¼ä¸­width * heightä¸ªåƒç´ ç‚¹éœ€è¦å ç”¨width * height * 3 / 2ä¸ªå­—èŠ‚æ•°ï¼Œå³æ¯ä¸€ä¸ªåƒç´ ç‚¹éƒ½ä¼šæœ‰ä¸€ä¸ªYæ”¾åˆ°æ•°æ®å­˜å‚¨çš„å‰width * heightä¸ªæ•°æ®ä¸­ï¼Œæ¯å››ä¸ªåƒç´ ç‚¹å…±äº«ä¸€ä¸ªUVæ”¾åˆ°ååŠéƒ¨åˆ†è¿›è¡Œäº¤é”™å­˜å‚¨ã€‚</p><p>è€Œåœ¨OpenGLä¸­ä½¿ç”¨çš„ç»å¤§éƒ¨åˆ†çº¹ç†å¯¹è±¡éƒ½æ˜¯RGBAçš„æ ¼å¼ï¼Œå¦å¤–ä¹‹å‰åœ¨è®²æ’­æ”¾å™¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿè®²è¿‡Luminanceæ ¼å¼ï¼Œä½†æ˜¯é‚£é‡Œé¢æ˜¯å¼€è¾Ÿ3ä¸ªçº¹ç†æ¥è¡¨ç¤ºä¸€å¼ YUVçš„å›¾ç‰‡ï¼Œè€Œè¿™é‡Œå¿…é¡»ä½¿ç”¨ä¸€ä¸ªçº¹ç†IDæ¥ç»™Cameraæ›´æ–°æ•°æ®ï¼Œé‚£åº”è¯¥æ€ä¹ˆæŠŠ3ä¸ªLuminanceçš„çº¹ç†åˆå¹¶æˆä¸€ä¸ªçº¹ç†å¯¹è±¡å‘¢ï¼Ÿ</p><p>å¹¸å¥½OpenGL ESæä¾›äº†ä¸€ä¸ªæ‰©å±•ç±»å‹ï¼šGL_TEXTURE_EXTERNAL_OESï¼Œè¿™ç§çº¹ç†åœ¨ä½¿ç”¨ä¸Šä¼šæœ‰ä¸€äº›ç‰¹æ®Šï¼Œæ¯”å¦‚ï¼Œçº¹ç†éœ€è¦ç»‘å®šåˆ°ç±»å‹GL_TEXTURE_EXTERNAL_OESä¸Šï¼Œè€Œä¸æ˜¯ç±»å‹GL_TEXTURE_2Dä¸Šï¼Œç»™çº¹ç†è®¾ç½®å‚æ•°çš„æ—¶å€™ä¹Ÿè¦ä½¿ç”¨GL_TEXTURE_EXTERNAL_OESç±»å‹ï¼Œç”Ÿæˆè¿™ç§ç±»å‹çš„çº¹ç†ä¸è®¾ç½®å‚æ•°çš„ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">glGenTextures(1, &amp;texId);\nglBindTexture(GL_TEXTURE_EXTERNAL_OES, texId);\nglTexParameteri(GL_TEXTURE_EXTERNAL_OES, GL_TEXTURE_MAG_FILTER, GL_LINEAR);\nglTexParameteri(GL_TEXTURE_EXTERNAL_OES, GL_TEXTURE_MIN_FILTER, GL_LINEAR);\nglTexParameteri(GL_TEXTURE_EXTERNAL_OES, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE);\nglTexParameteri(GL_TEXTURE_EXTERNAL_OES, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE);\n</code></pre><p>åœ¨å®é™…çš„æ¸²æŸ“è¿‡ç¨‹ä¸­ç»‘å®šçº¹ç†çš„ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">glActiveTexture(GL_TEXTURE0);\nglBindTexture(GL_TEXTURE_EXTERNAL_OES, texId);\nglUniform1i(uniformSamplers, 0);\n</code></pre><p>åœ¨OpenGL ESçš„shaderä¸­éœ€è¦å£°æ˜å¯¹æ­¤æ‰©å±•çš„ä½¿ç”¨ï¼ŒæŒ‡ä»¤å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">#extension GL_OES_EGL_image_external : require\n</code></pre><p>åœ¨shaderé‡Œä¹Ÿå¿…é¡»ä½¿ç”¨samplerExternalOESé‡‡æ ·æ–¹å¼æ¥å£°æ˜çº¹ç†ï¼ŒFragmentShaderä¸­çš„ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">static char* GPU_FRAME_FRAGMENT_SHADER =\n\"#extension GL_OES_EGL_image_external : require&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \\n\"\n\"precision mediump float;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \\n\"\n\"uniform samplerExternalOES yuvTexSampler;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \\n\"\n\"varying vec2 yuvTexCoords;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \\n\"\n\"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \\n\"\n\"void main() {&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \\n\"\n\"&nbsp;&nbsp;&nbsp; gl_FragColor = texture2D(yuvTexSampler, yuvTexCoords);\\n\"\n\"}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; \\n\";\n</code></pre><p>ä»ç”Ÿæˆçº¹ç†åˆ°è®¾ç½®å‚æ•°ï¼Œå†åˆ°çœŸæ­£æ¸²æŸ“è¿™ä¸€æ•´ä¸ªæµç¨‹ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¼„æ¸…æ¥šäº†è¿™ç§ç‰¹æ®Šæ ¼å¼çš„çº¹ç†çš„ä½¿ç”¨æ–¹æ³•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å†çœ‹ä¸€ä¸‹æ‘„åƒå¤´é‡‡é›†å›¾åƒæ—‹è½¬è§’åº¦çš„é—®é¢˜ã€‚</p><h3>çº¹ç†æ—‹è½¬è§’åº¦</h3><p>åœ¨ä½¿ç”¨æ‘„åƒå¤´çš„æ—¶å€™ï¼Œå¾ˆå®¹æ˜“åœ¨è¿™ä¸ªåœ°æ–¹è¸©å‘ï¼Œæ¯”å¦‚æ‰‹æœºæ‘„åƒå¤´é¢„è§ˆçš„æ—¶å€™ä¼šå‡ºç°å€’ç«‹ã€é•œåƒç­‰é—®é¢˜ï¼Œä¸‹é¢æˆ‘å°±å¸¦ä½ å½»åº•åœ°æå®šå®ƒã€‚</p><p>ç”±äºæ‘„åƒå¤´é‡‡é›†å‡ºæ¥çš„è§†é¢‘éƒ½æ˜¯æ¨ªå‘çš„ï¼Œæ¯”å¦‚æ‘„åƒå¤´çš„é¢„è§ˆå¤§å°æ˜¯640 * 480ï¼Œå…¶å®æ‘„åƒå¤´é‡‡é›†å‡ºæ¥çš„è§†é¢‘å¸§å®½æ˜¯640ï¼Œé«˜æ˜¯480ï¼Œå¹¶ä¸”å›¾ç‰‡ä¹Ÿæ˜¯æ¨ªå‘é‡‡é›†çš„ã€‚å¦‚æœè¦èƒ½æ­£ç¡®åœ°é¢„è§ˆå‡ºæ¥éœ€è¦æ—‹è½¬ä¸€ä¸ª90åº¦æˆ–270åº¦ï¼Œå…·ä½“æ—‹è½¬å¤šå°‘åº¦éœ€è¦åœ¨å½“å‰è¿™ä¸ªæ‘„åƒå¤´çš„CameraInfoé‡Œé¢è·å–ã€‚</p><p>ä¸åŒçš„æ‰‹æœºç”šè‡³æ˜¯ä¸åŒçš„ç³»ç»Ÿéƒ½ä¼šä¸ä¸€æ ·ï¼Œå¹¶ä¸”å¦‚æœæ˜¯å‰ç½®æ‘„åƒå¤´çš„è¯ï¼Œè¿˜éœ€è¦å†åšä¸€ä¸ªVFlip<span class=\"reference\">ï¼ˆå‚ç›´é•œåƒï¼‰</span>ç”¨æ¥ä¿®å¤é•œåƒçš„é—®é¢˜ã€‚å‡è®¾å›¾åƒæ˜¯æ¨ªå‘é‡‡é›†å‡ºæ¥çš„ï¼Œå°±åšç«–ç›´ç¿»è½¬ï¼Œå¦‚æœå·²ç»æ—‹è½¬è¿‡äº†ï¼Œå°±åšæ¨ªå‘ç¿»è½¬ã€‚ä¸‹é¢æˆ‘ä»¬ç”¨å®é™…çš„å›¾ç‰‡ï¼Œæ¥åˆ†åˆ«çœ‹ä¸€ä¸‹å‰ç½®æ‘„åƒå¤´å’Œåç½®æ‘„åƒå¤´å…·ä½“çš„æ¸²æŸ“æµç¨‹ã€‚å…ˆçœ‹ä¸€å¼ å®é™…æ‘„åƒå¤´è¦é‡‡é›†çš„ç‰©ä½“ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/54/dc/5483e188bef86567c2f1f3aeeed100dc.png?wh=1696x578\" alt=\"å›¾ç‰‡\"></p><p>åœ¨ä½¿ç”¨<strong>å‰ç½®æ‘„åƒå¤´</strong>å»é‡‡é›†è¿™ä¸ªç‰©ä½“çš„æ—¶å€™ï¼Œå¾—åˆ°æœ€å·¦è¾¹çš„å›¾ç‰‡ï¼Œè¿™ä¸ªæ—¶å€™åœ¨æ‘„åƒå¤´çš„CameraInfoé‡Œå–å‡ºæ¥çš„è§’åº¦ä¸€èˆ¬æ˜¯270åº¦ã€‚æŒ‰ç…§æ—‹è½¬è§’åº¦ï¼Œæˆ‘ä»¬æŠŠå›¾ç‰‡é¡ºæ—¶é’ˆæ—‹è½¬270åº¦ï¼Œå¾—åˆ°ä¸­é—´çš„å›¾ç‰‡ï¼Œå†è¿›è¡Œé•œåƒå¤„ç†ï¼Œå¾—åˆ°æœ€å³è¾¹çš„å›¾ç‰‡ã€‚æœ€åæˆ‘ä»¬åœ¨æ‰‹æœºå±å¹•ä¸Šçœ‹åˆ°çš„æ‰æ˜¯é¢„æœŸçš„å›¾åƒã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/af/c0/af629d66a6dcbe8592b5d82ba34730c0.png?wh=1916x560\" alt=\"å›¾ç‰‡\"></p><p>å¦‚æœæ˜¯<strong>åç½®æ‘„åƒå¤´</strong>ï¼Œä¸€èˆ¬åœ¨æ‘„åƒå¤´çš„CameraInfoé‡Œå–å‡ºæ¥çš„è§’åº¦æ˜¯90åº¦ï¼Œå½“ç„¶è¿™æ˜¯ROMå‚å•†å®šçš„ï¼Œæ¯”å¦‚LGå‚å•†çš„Nexus5Xè¿™ä¸ªè®¾å¤‡å–å‡ºæ¥çš„è§’åº¦å°±æ˜¯270åº¦ã€‚ä¸è¿‡æ— è®ºæ˜¯å¤šå°‘åº¦ï¼Œæ‘„åƒå¤´é‡‡é›†å‡ºæ¥çš„å›¾åƒï¼Œæ ¹æ®è¿™ä¸ªè§’åº¦åœ¨æ—‹è½¬è¿‡åï¼Œå°±èƒ½å¾—åˆ°ä¸€ä¸ªæ­£å¸¸çš„å›¾åƒäº†ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹å®ƒçš„æ—‹è½¬æµç¨‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f4/7f/f488a98ffyy778f2535dc4768620907f.png?wh=1692x580\" alt=\"å›¾ç‰‡\"></p><p>å¦‚æœæ˜¯LGå‚å•†çš„Nexus5Xæˆ–è€…HUAWEIå‚å•†çš„Nexus6Pè¿™ä¸¤æ¬¾è®¾å¤‡ï¼Œå›¾åƒçš„åç½®æ‘„åƒå¤´éœ€è¦é¡ºæ—¶é’ˆæ—‹è½¬270åº¦ï¼Œå¾—åˆ°æ­£å¸¸æ˜¾ç¤ºçš„å›¾åƒã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f8/13/f88385f2591a1b34d2e03c606eb02813.png?wh=1680x584\" alt=\"å›¾ç‰‡\" title=\"Nexus 5/6På‡çº§ç³»ç»Ÿä¹‹å\n\"></p><h3>ç¡®å®šç‰©ä½“åæ ‡ä¸çº¹ç†åæ ‡</h3><p>ä¸Šè¿°å›¾åƒçš„æ—‹è½¬å’Œé•œåƒï¼Œåœ¨OpenGL ESä¸­éœ€è¦é€šè¿‡ç‰©ä½“åæ ‡å’Œçº¹ç†åæ ‡å˜æ¢æ¥å®ç°ã€‚æˆ‘ä»¬å¯ä»¥å†å›çœ‹ä¸€ä¸‹ä¹‹å‰ç‰©ä½“åæ ‡ç³»å’Œçº¹ç†åæ ‡ç³»çš„å›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/45/4b/451583e39a93e7b42ef62e38e7c9964b.png?wh=1920x865\" alt=\"å›¾ç‰‡\"></p><p>è€Œæˆ‘ä»¬è¿™é‡Œçš„ç‰©ä½“åæ ‡ä¹Ÿæ˜¯ä¸€ä¸ªé€šç”¨çš„åæ ‡ã€‚</p><pre><code class=\"language-plain\">GLfloat squareVertices[8] = {\n&nbsp;&nbsp;&nbsp; -1.0, -1.0, //ç‰©ä½“å·¦ä¸‹è§’\n&nbsp;&nbsp;&nbsp; 1.0ï¼Œ-1.0ï¼Œ&nbsp; //ç‰©ä½“å³ä¸‹è§’\n&nbsp;&nbsp;&nbsp; -1.0ï¼Œ1.0ï¼Œ &nbsp;//ç‰©ä½“å·¦ä¸Šè§’\n&nbsp;&nbsp;&nbsp; 1.0ï¼Œ1.0&nbsp; &nbsp;&nbsp;&nbsp;//ç‰©ä½“å³ä¸Šè§’\n};\n</code></pre><p>ä¸‹é¢æ˜¯ä¸åšä»»ä½•æ—‹è½¬ä¸é•œåƒçš„OpenGLçº¹ç†åæ ‡ã€‚</p><pre><code class=\"language-plain\">GLfloat textureCoordNoRotation[8] = {\n&nbsp;&nbsp;&nbsp; 0.0ï¼Œ0.0ï¼Œ//å›¾åƒçš„å·¦ä¸‹è§’\n&nbsp;&nbsp;&nbsp; 1.0ï¼Œ0.0ï¼Œ//å›¾åƒçš„å³ä¸‹è§’\n&nbsp;&nbsp;&nbsp; 0.0ï¼Œ1.0ï¼Œ//å›¾åƒçš„å·¦ä¸Šè§’\n&nbsp;&nbsp;&nbsp; 1.0ï¼Œ1.0&nbsp; //å›¾åƒçš„å³ä¸Šè§’\n};\n</code></pre><p>ç„¶åï¼Œç»™å‡ºé¡ºæ—¶é’ˆæ—‹è½¬90åº¦çš„çº¹ç†åæ ‡ï¼Œä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼ŒæŠŠOpenGLçš„çº¹ç†åæ ‡ç³»çš„å›¾é¡ºæ—¶é’ˆæ—‹è½¬90åº¦ï¼Œç„¶åå†æŠŠå¯¹åº”çš„å·¦ä¸‹ã€å³ä¸‹ã€å·¦ä¸Šã€å³ä¸Šçš„åæ ‡ç‚¹å†™ä¸‹æ¥ã€‚</p><pre><code class=\"language-plain\">GLfloat textureCoords[8] = {\n&nbsp;&nbsp; &nbsp;1.0ï¼Œ0.0ï¼Œ//å›¾åƒçš„å³ä¸‹è§’\n&nbsp;&nbsp;&nbsp; 1.0ï¼Œ1.0ï¼Œ//å›¾åƒçš„å³ä¸Šè§’\n&nbsp;&nbsp;&nbsp; 0.0ï¼Œ0.0ï¼Œ//å›¾åƒçš„å·¦ä¸‹è§’\n&nbsp;&nbsp;&nbsp; 0.0ï¼Œ1.0&nbsp; //å›¾åƒçš„å·¦ä¸Šè§’\n};\n</code></pre><p>ç»™å‡ºé¡ºæ—¶é’ˆæ—‹è½¬180åº¦çš„çº¹ç†åæ ‡ã€‚</p><pre><code class=\"language-plain\">GLfloat textureCoords[8] = {\n&nbsp;&nbsp;&nbsp; 1.0ï¼Œ1.0ï¼Œ//å›¾åƒçš„å³ä¸Šè§’\n&nbsp;&nbsp;&nbsp; 0.0ï¼Œ1.0ï¼Œ//å›¾åƒçš„å·¦ä¸Šè§’\n&nbsp;&nbsp;&nbsp; 1.0ï¼Œ0.0ï¼Œ//å›¾åƒçš„å³ä¸‹è§’\n&nbsp;&nbsp;&nbsp; 0.0ï¼Œ0.0&nbsp; //å›¾åƒçš„å·¦ä¸‹è§’\n};\n</code></pre><p>ç„¶åï¼Œç»™å‡ºé¡ºæ—¶é’ˆæ—‹è½¬270åº¦çš„çº¹ç†åæ ‡ã€‚</p><pre><code class=\"language-plain\">GLfloat textureCoords[8] = {\n&nbsp;&nbsp;&nbsp; 0.0ï¼Œ1.0ï¼Œ//å›¾åƒçš„å·¦ä¸Šè§’\n&nbsp;&nbsp;&nbsp; 0.0ï¼Œ0.0ï¼Œ//å›¾åƒçš„å·¦ä¸‹è§’\n&nbsp;&nbsp;&nbsp; 1.0ï¼Œ1.0ï¼Œ//å›¾åƒçš„å³ä¸Šè§’\n&nbsp;&nbsp;&nbsp; 1.0ï¼Œ0.0&nbsp; //å›¾åƒçš„å³ä¸‹è§’\n};\n</code></pre><p>è¿˜è®°å¾—å‰é¢æˆ‘ä»¬è®²è¿‡è®¡ç®—æœºå›¾åƒçš„åæ ‡ç³»ä¸OpenGLçš„åæ ‡ç³»ä¸åŒå—ï¼Ÿå®ƒä»¬çš„Yæ°å¥½æ˜¯ç›¸åçš„ï¼Œæ‰€ä»¥è¿™é‡Œè¦æŠŠæ¯ä¸€ä¸ªçº¹ç†åæ ‡åšä¸€ä¸ªVFlipçš„å˜æ¢<span class=\"reference\">ï¼ˆå‚ç›´é•œåƒï¼Œå³æŠŠæ¯ä¸€ä¸ªé¡¶ç‚¹çš„yå€¼ç”±0å˜ä¸º1æˆ–è€…ç”±1å˜ä¸º0ï¼‰</span>ï¼Œè¿™æ ·å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªæ­£ç¡®çš„å›¾åƒæ—‹è½¬äº†ã€‚è€Œæˆ‘ä»¬çš„å‰ç½®æ‘„åƒå¤´å­˜åœ¨é•œåƒçš„é—®é¢˜ï¼Œè¿™æ—¶å€™éœ€è¦å¯¹æ¯ä¸€ä¸ªçº¹ç†åæ ‡åšä¸€ä¸ªHFlipå˜æ¢<span class=\"reference\">ï¼ˆæ°´å¹³é•œåƒï¼Œå³æŠŠæ¯ä¸€ä¸ªé¡¶ç‚¹çš„xå€¼ç”±0å˜ä¸º1æˆ–è€…ç”±1å˜ä¸º0ï¼‰</span>ï¼Œä»è€Œè®©å›¾ç‰‡åœ¨é¢„è§ˆç•Œé¢ä¸­çœ‹èµ·æ¥å’Œåœ¨é•œå­ä¸­ä¸€æ ·ã€‚</p><h3>è‡ªé€‚åº”æ¸²æŸ“</h3><p>ä¸Šé¢çš„æ­¥éª¤å…¶å®å°±æ˜¯ä¸€ä¸ªç‰¹æ®Šæ ¼å¼<span class=\"reference\">ï¼ˆOESï¼‰</span>çš„çº¹ç†ç»è¿‡æ—‹è½¬å’Œæ¸²æŸ“ï¼Œå˜æˆäº†æ­£å¸¸æ ¼å¼<span class=\"reference\">ï¼ˆRGBAï¼‰</span>çš„ä¸€ä¸ªçº¹ç†ï¼Œé‚£æ¥ä¸‹æ¥å°±å¯ä»¥æŠŠè¿™ä¸ªæ­£å¸¸æ ¼å¼çš„çº¹ç†æ¸²æŸ“åˆ°å±å¹•ä¸Šå»äº†ã€‚</p><p>ä½†è¿™é‡Œéœ€è¦è¡¥å……ä¸€å¥ï¼Œç”±äºè¿™ä¸ªçº¹ç†çš„å®½å’Œé«˜å®é™…ä¸Šæ˜¯æ‘„åƒå¤´æ•æ‰è¿‡æ¥çš„å›¾åƒçš„é«˜å’Œå®½<span class=\"reference\">ï¼ˆåšäº†ä¸€ä¸ª90åº¦æˆ–è€…270åº¦çš„æ—‹è½¬ï¼‰</span>ï¼Œè€Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯è¦æ¸²æŸ“åˆ°SurfaceViewä¸Šé¢å»ï¼Œä½†æ˜¯å¦‚æœJavaå±‚æä¾›çš„SurfaceViewçš„å®½é«˜å’Œå¤„ç†è¿‡åçš„è¿™ä¸ªçº¹ç†IDçš„å®½é«˜ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆè¿™ä¸€å¸§å›¾åƒå°±ä¼šå‡ºç°è¢«å‹ç¼©æˆ–è€…æ‹‰ä¼¸çš„é—®é¢˜ï¼Œæ‰€ä»¥åœ¨æ¸²æŸ“åˆ°å±å¹•ä¸Šçš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦åšä¸€ä¸ªè‡ªé€‚é…ï¼Œè®©çº¹ç†æŒ‰ç…§å±å¹•Viewçš„æ¯”ä¾‹è‡ªåŠ¨å¡«å……ã€‚</p><p>å…ˆæ¥çœ‹çº¹ç†åæ ‡ï¼Œxä»0.0åˆ°1.0å°±è¯´æ˜è¦æŠŠçº¹ç†çš„xè½´æ–¹å‘å…¨éƒ¨éƒ½ç»˜åˆ¶åˆ°ç‰©ä½“è¡¨é¢<span class=\"reference\">ï¼ˆæ•´ä¸ªSurfaceViewï¼‰</span>ä¸Šå»ï¼Œè€Œå¦‚æœæˆ‘ä»¬åªæƒ³ç»˜åˆ¶ä¸€éƒ¨åˆ†ï¼Œæ¯”å¦‚ä¸­é—´çš„ä¸€åŠï¼Œé‚£ä¹ˆå°±å¯ä»¥å°†xè½´çš„åæ ‡å†™æˆ0.25åˆ°0.75ï¼Œç±»ä¼¼çš„é€‚é…ä¹Ÿå¯ä»¥åº”ç”¨åˆ°yè½´ä¸Šã€‚ä½†è¿™ä¸ª0.25å’Œ0.75æ˜¯å¦‚ä½•å¾—å‡ºæ¥çš„å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆå¾ˆç®€å•ï¼Œå¦‚æœä¸æƒ³è¢«æ‹‰ä¼¸ï¼ŒSurfaceViewçš„å®½é«˜æ¯”ä¾‹å’Œçº¹ç†çš„å®½é«˜æ¯”ä¾‹å°±åº”è¯¥æ˜¯ç›¸åŒçš„ã€‚å‡è®¾è¿™ä¸€å¼ çº¹ç†çš„å®½ä¸ºtexWidthï¼Œé«˜ä¸ºtexHeightï¼Œè€Œç‰©ä½“è¡¨é¢çš„å®½ä¸ºscreenWidthï¼Œé«˜ä¸ºscreenHeightï¼Œå°±å¯ä»¥åˆ©ç”¨ä¸‹é¢çš„å…¬å¼æ¥å®Œæˆè‡ªåŠ¨å¡«å……çš„åæ ‡è®¡ç®—ã€‚</p><pre><code class=\"language-plain\">float textureAspectRatio = texHeight / texWidth;\nfloat viewAspectRatio = screenHeight / screenWidth;\nfloat xOffset = 0.0f;\nfloat yOffset = 0.0f;\nif(textureAspectRatio &gt; viewAspectRatio){\n&nbsp;&nbsp;&nbsp; //Update Y Offset\n&nbsp;&nbsp;&nbsp; int expectedHeight = texHeight*screenWidth/texWidth+0.5f;\n&nbsp;&nbsp;&nbsp; yOffset = (expectedHeight - screenHeight) / (2 * expectedHeight);\n} else if(textureAspectRatio &lt; viewAspectRatio){\n&nbsp;&nbsp;&nbsp; //Update X Offset\n&nbsp;&nbsp;&nbsp; int expectedWidth = texHeight * screenWidth / screenHeight + 0.5);\n&nbsp;&nbsp;&nbsp; xOffset = (texWidth - expectedWidth)/(2*texWidth);\n}\n</code></pre><p>è®¡ç®—å¾—åˆ°çš„xOffsetå’ŒyOffsetåœ¨çº¹ç†åæ ‡ä¸­åˆ†åˆ«æ›¿æ¢æ‰0.0çš„ä½ç½®ï¼Œåˆ©ç”¨1.0-xOffsetä»¥åŠ1.0-yOffsetæ›¿æ¢æ‰1.0çš„ä½ç½®ï¼Œæœ€ç»ˆå¾—åˆ°ä¸€ä¸ªçº¹ç†åæ ‡çŸ©é˜µã€‚</p><pre><code class=\"language-plain\">GLfloat textureCoordNoRotation[8] = {\n&nbsp;&nbsp;&nbsp; xOffsetï¼Œ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; yOffsetï¼Œ\n&nbsp;&nbsp;&nbsp; 1.0 - xOffsetï¼Œ&nbsp;&nbsp;&nbsp;&nbsp; yOffsetï¼Œ\n&nbsp;&nbsp;&nbsp; xOffsetï¼Œ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1.0 - yOffsetï¼Œ\n&nbsp;&nbsp;&nbsp; 1.0 - yOffsetï¼Œ&nbsp;&nbsp;&nbsp;&nbsp; 1.0 - yOffset&nbsp;\n};\n</code></pre><p>åˆ°è¿™é‡Œï¼Œæ‘„åƒå¤´é¢„è§ˆæµç¨‹å°±å¯ä»¥éšç€æ‘„åƒå¤´æ‰€é‡‡é›†çš„å›¾åƒä¸€å¸§ä¸€å¸§åœ°ç»˜åˆ¶ä¸‹å»äº†ï¼Œä¹Ÿå°±å®ç°äº†æ•´ä¸ªé¢„è§ˆè¿‡ç¨‹ã€‚</p><h3>åˆ‡æ¢æ‘„åƒå¤´ä¸å…³é—­é¢„è§ˆ</h3><p>å½“ç”¨æˆ·åˆ‡æ¢æ‘„åƒå¤´çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç»™Nativeå±‚å‘ä¸€ä¸ªæŒ‡ä»¤ï¼ŒNativeå±‚ä¼šåœ¨OpenGLçº¿ç¨‹ä¸­å…³é—­å½“å‰æ‘„åƒå¤´ï¼Œç„¶åé‡æ–°æ‰“å¼€å¦å¤–ä¸€ä¸ªæ‘„åƒå¤´ï¼Œå¹¶é…ç½®å‚æ•°ï¼Œç„¶åè®¾ç½®é¢„è§ˆçš„SurfaceTextureï¼Œæœ€åè°ƒç”¨å¼€å§‹é¢„è§ˆæ–¹æ³•ï¼Œè¿™æ ·å°±å¯ä»¥åˆ‡æ¢æˆåŠŸäº†ï¼Œç”¨æˆ·çœ‹åˆ°çš„å°±æ˜¯åˆ‡æ¢æ‘„åƒå¤´ä¹‹åçš„é¢„è§ˆç”»é¢ã€‚</p><p>æœ€ç»ˆå…³é—­é¢„è§ˆæ—¶ï¼Œè¦å…ˆåœæ‰æ•´ä¸ªæ¸²æŸ“çº¿ç¨‹ï¼Œç„¶åå…³é—­Cameraï¼Œå½“ç„¶è¿˜è¦é‡Šæ”¾ä¹‹å‰å»ºç«‹çš„SurfaceTextureï¼ŒæŠŠæ‘„åƒå¤´çš„PreviewCallbackè®¾ç½®ä¸ºnullï¼Œæœ€ç»ˆé‡Šæ”¾æ‰æ‘„åƒå¤´ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/99/ec/994dd896159418becf7e6536395b20ec.png?wh=1920x524\" alt=\"å›¾ç‰‡\" title=\"ç»“æŸé¢„è§ˆ\"></p><p>åˆ°è¿™é‡Œï¼Œæ‘„åƒå¤´é¢„è§ˆç›¸å…³çš„æ“ä½œå°±å…¨éƒ½è®²å®Œäº†ï¼Œè¿™ä¸ªéƒ¨åˆ†çš„å†…å®¹æ˜¯ååˆ†é‡è¦çš„ï¼Œå¯¹åé¢æ­å»ºæ•´ä¸ªå½•åˆ¶è§†é¢‘çš„é¡¹ç›®æ¥è¯´ï¼Œæ˜¯æœ€åŸºç¡€çš„éƒ¨åˆ†ï¼Œæ‰€ä»¥ä¸€å®šè¦æŒæ¡ã€‚</p><h2>å°ç»“</h2><p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥ä¸€èµ·æ¥å›é¡¾ä¸€ä¸‹è¿™èŠ‚è¯¾çš„ä¸»è¦å†…å®¹ã€‚è¿™èŠ‚è¯¾æˆ‘ä»¬ä»æƒé™é…ç½®å¼€å§‹ï¼Œç„¶åè®²è§£äº†æ‘„åƒå¤´çš„é…ç½®ä¸æ‰“å¼€æ‘„åƒå¤´çš„æ“ä½œï¼Œæ¥ç€è¯¦ç»†è®²è§£äº†å¦‚ä½•å°†æ‘„åƒå¤´é‡‡é›†åˆ°çš„å›¾åƒä¸€æ­¥æ­¥æ¸²æŸ“åˆ°å±å¹•Viewä¸Šï¼Œæ•´ä½“æµç¨‹å¦‚ä¸‹ï¼š</p><ul>\n<li>åœ¨Nativeå±‚åˆ›å»ºä¸€ä¸ªOpenGLçº¿ç¨‹ï¼Œå¹¶ä¸”æ„å»ºå‡ºä¸€ä¸ªOESç±»å‹çš„çº¹ç†IDä¼ é€’ç»™Javaå±‚æ„é€ æˆä¸€ä¸ªSurfaceTextureï¼Œç„¶åé…ç½®ç»™æ‘„åƒå¤´ã€‚</li>\n<li>å½“æ‘„åƒå¤´é‡‡é›†åˆ°ä¸€å¸§å›¾åƒä¹‹åï¼Œå°±ä¼šé€šè¿‡å›è°ƒçš„æ–¹å¼å‘Šè¯‰æˆ‘ä»¬ï¼Œæˆ‘ä»¬å°†åœ¨OpenGLçº¿ç¨‹ä¸­è°ƒç”¨updateæ–¹æ³•å°†è¿™ä¸€å¸§å›¾åƒæ›´æ–°åˆ°çº¹ç†IDä¸Šã€‚</li>\n<li>æ¥ç€æŒ‰ç…§æ—‹è½¬è§’åº¦ç¡®å®šçº¹ç†çŸ©é˜µï¼Œå°†OESçš„çº¹ç†æ¸²æŸ“æˆä¸ºä¸€ä¸ªæ ‡å‡†çš„RGBAçš„çº¹ç†ã€‚</li>\n<li>æœ€åå°†RGBAç±»å‹çš„çº¹ç†åœ¨æ¸²æŸ“åˆ°å±å¹•ä¸Šã€‚</li>\n</ul><p>å¦‚æœä½ äº†è§£æ¸…æ¥šæ•´ä¸ªè¿‡ç¨‹ï¼Œé‚£ä¹ˆåé¢å­¦ä¹ ç¼–ç ä¹Ÿä¼šæ›´åŠ é¡ºç•…ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e3/be/e3306e85566c35d565032124fde097be.png?wh=1898x1384\" alt=\"å›¾ç‰‡\"></p><h2>æ€è€ƒé¢˜</h2><p>è¿™èŠ‚è¯¾æˆ‘ä»¬å­¦ä¹ äº†æ‘„åƒå¤´é¢„è§ˆçš„æµç¨‹ï¼Œé‚£æˆ‘æ¥è€ƒè€ƒä½ ï¼Œæ‘„åƒå¤´é‡‡é›†çš„å‡ºæ¥çš„çº¹ç†ç±»å‹æ˜¯ä»€ä¹ˆç±»å‹ï¼Œå®ƒåˆæ˜¯æ€ä¹ˆè¢«ç»˜åˆ¶åˆ°å±å¹•Viewä¸Šå»çš„å‘¢ï¼Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™æ›´å¤šå¯¹éŸ³è§†é¢‘æ„Ÿå…´è¶£çš„æœ‹å‹ï¼Œæˆ‘ä»¬ä¸€èµ·äº¤æµã€å…±åŒè¿›æ­¥ã€‚ä¸‹èŠ‚è¯¾å†è§ï¼</p>","neighbors":{"left":{"article_title":"14 ï½œ iOSå¹³å°å¦‚ä½•é‡‡é›†è§†é¢‘ç”»é¢ï¼Ÿ","id":556012},"right":{"article_title":"16 ï½œè§†é¢‘ç¼–ç çš„å·¥ä½œåŸç†ä¸H.264å°è£…æ ¼å¼","id":559245}},"comments":[{"had_liked":false,"id":355570,"user_name":"å¤§åœŸè±†","can_delete":false,"product_type":"c1","uid":1121636,"ip_address":"åŒ—äº¬","ucode":"67445DC3EC9DB0","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/64/52a5863b.jpg","comment_is_top":false,"comment_ctime":1661502430,"is_pvip":true,"replies":[{"id":"129420","content":"å¯ä»¥é‚®ç®±è”ç³»(zhanxiaokai2008@126.com)ï¼Œç§èŠã€‚","user_name":"ä½œè€…å›å¤","comment_id":355570,"uid":"3069513","ip_address":"åŒ—äº¬","utype":1,"ctime":1661589696,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1661502430","product_id":100117601,"comment_content":"è€å¸ˆå¯ä»¥åŠ ä¸ªå¾®ä¿¡ï¼Œæˆ–è€…å…¬ä¼—å·å¯ä»¥å…³æ³¨å—ï¼ŸğŸ˜„","like_count":0,"discussions":[{"author":{"id":3069513,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/d6/49/27f68f7d.jpg","nickname":"Kevin","note":"","ucode":"5FCE361CB8C187","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585486,"discussion_content":"å¯ä»¥é‚®ç®±è”ç³»(zhanxiaokai2008@126.com)ï¼Œç§èŠã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661589696,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355536,"user_name":"cc","can_delete":false,"product_type":"c1","uid":1239833,"ip_address":"åŒ—äº¬","ucode":"AA1B8EA613E3A9","user_header":"https://static001.geekbang.org/account/avatar/00/12/eb/19/19e706a5.jpg","comment_is_top":false,"comment_ctime":1661478878,"is_pvip":false,"replies":[{"id":"129418","content":"å¯¹çš„ï¼Œè¿™å°±æ˜¯OpenGLåæ ‡ä¸è®¡ç®—æœºç³»ç»Ÿåæ ‡çš„å·®å¼‚ç‚¹ï¼Œåœ¨æ–‡ä¸­æœ‰è®²è§£çš„å“ˆã€‚","user_name":"ä½œè€…å›å¤","comment_id":355536,"uid":"3069513","ip_address":"åŒ—äº¬","utype":1,"ctime":1661589442,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1661478878","product_id":100117601,"comment_content":"è€å¸ˆï¼Œæˆ‘çœ‹æ–‡ç« ä¸­ï¼Œä½ è¯´çº¹ç†åæ ‡æ˜¯ä»å·¦ä¸‹è§’å¼€å§‹çš„ï¼Œä½†æ˜¯åœ¨Androidåæ ‡åŸç‚¹å¥½åƒæ˜¯å·¦ä¸Šè§’","like_count":0,"discussions":[{"author":{"id":3069513,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/d6/49/27f68f7d.jpg","nickname":"Kevin","note":"","ucode":"5FCE361CB8C187","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585484,"discussion_content":"å¯¹çš„ï¼Œè¿™å°±æ˜¯OpenGLåæ ‡ä¸è®¡ç®—æœºç³»ç»Ÿåæ ‡çš„å·®å¼‚ç‚¹ï¼Œåœ¨æ–‡ä¸­æœ‰è®²è§£çš„å“ˆã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661589442,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355533,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"åŒ—äº¬","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1661476921,"is_pvip":true,"replies":[{"id":"129419","content":"A1: ASç‰ˆæœ¬é—®é¢˜ä¸å¤§ï¼Œä¸»è¦æ˜¯gradleå’Œndkç‰ˆæœ¬åˆ°æ—¶å€™ä¸€è‡´å°±å¯ä»¥äº†ã€‚<br>A2: ä½ è¯´çš„è¿™ä¸ªæœ¯è¯­éŸ³é¢‘çš„ç¼–è¾‘èƒ½åŠ›ï¼Œå¯ä»¥å®ç°çš„ï¼Œæ¯”å¦‚ä¹‹å‰è¯´çš„å›æ£®çš„å¼¹å¹•å°±å’Œä½ æè¿°çš„åœºæ™¯ä¸€æ¨¡ä¸€æ ·ï¼Œåªè¦è‡ªå·±æ¥å®ç°ä¸€ä¸ªè¿™ç§è§£ç ã€MixéŸ³è½¨çš„ç³»ç»Ÿå°±å¯ä»¥äº†ï¼Œåœ¨ä»»ä½•å¹³å°éƒ½å¯ä»¥ã€‚","user_name":"ä½œè€…å›å¤","comment_id":355533,"uid":"3069513","ip_address":"åŒ—äº¬","utype":1,"ctime":1661589665,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1661476921","product_id":100117601,"comment_content":"è¯·æ•™è€å¸ˆä¸¤ä¸ªé—®é¢˜ï¼š<br>Q1ï¼šè€å¸ˆç”¨çš„ASæ˜¯ä»€ä¹ˆç‰ˆæœ¬ï¼Ÿ<br>æˆ‘ç›®å‰å®‰è£…äº†ä¸¤ä¸ªç‰ˆæœ¬ï¼Œä¸€ä¸ªæ˜¯AS3.5ï¼Œå¦å¤–ä¸€ä¸ªæ˜¯AS2021(å…å®‰è£…ç‰ˆæœ¬)ã€‚å¦‚æœæˆ‘çš„ç‰ˆæœ¬å’Œè€å¸ˆçš„ä¸åŒï¼Œå¯èƒ½ä¼šå‡ºå¾ˆå¤šé—®é¢˜ã€‚æœ€å¥½ä¿æŒASç‰ˆæœ¬ä¸€æ ·ï¼Œé¿å…ä¸å¿…è¦çš„é—®é¢˜ã€‚<br><br>Q2ï¼šFFmpegå…·æœ‰â€œç¼–è¾‘â€éŸ³é¢‘çš„èƒ½åŠ›å—ï¼Ÿ <br>åœ¨win10ä¸‹ï¼Œæˆ‘åšè¿‡è¿™æ ·çš„æ“ä½œï¼Œä¸€ä¸ª3åˆ†é’Ÿçš„é•¿éŸ³é¢‘ï¼Œä¸€ä¸ª5ç§’çš„çŸ­éŸ³é¢‘ï¼Œç”¨FFmpegå¯ä»¥å°†ä¸¤ä¸ªéŸ³é¢‘åˆæˆä¸ºä¸€ä¸ªéŸ³é¢‘ï¼Œæ’­æ”¾æ—¶ï¼Œå‰äº”ç§’é’Ÿï¼ŒåŒæ—¶å¬åˆ°ä¸¤ä¸ªéŸ³é¢‘çš„å£°éŸ³ï¼Œäº”ç§’ä¹‹åï¼Œåªæœ‰é•¿éŸ³é¢‘çš„å£°éŸ³ã€‚è¿›ä¸€æ­¥åœ°ï¼Œé€šè¿‡è®¾ç½®å‚æ•°ï¼Œå¯ä»¥è®©çŸ­éŸ³é¢‘é‡å¤æ’­æ”¾ï¼Œåˆæˆåçš„æ•ˆæœæ˜¯ï¼šåœ¨é•¿éŸ³é¢‘æ–‡ä»¶çš„æ’­æ”¾è¿‡ç¨‹ä¸­ï¼ŒçŸ­éŸ³é¢‘æ–‡ä»¶ä¸åœåœ°é‡å¤æ’­æ”¾ï¼ŒåŒæ—¶å¬åˆ°ä¸¤ä¸ªéŸ³é¢‘æ–‡ä»¶çš„å£°éŸ³ã€‚<br>è¿™ç®—æ˜¯â€œéŸ³é¢‘â€ç¼–è¾‘çš„èƒ½åŠ›å—ï¼Ÿ<br>åœ¨win10ä¸‹é¢å¯ä»¥åˆæˆå£°éŸ³ï¼Œåœ¨ç§»åŠ¨ç«¯ä¹Ÿèƒ½å®ç°â€œéŸ³é¢‘åˆæˆâ€çš„åŠŸèƒ½å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":3069513,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/d6/49/27f68f7d.jpg","nickname":"Kevin","note":"","ucode":"5FCE361CB8C187","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585485,"discussion_content":"A1: ASç‰ˆæœ¬é—®é¢˜ä¸å¤§ï¼Œä¸»è¦æ˜¯gradleå’Œndkç‰ˆæœ¬åˆ°æ—¶å€™ä¸€è‡´å°±å¯ä»¥äº†ã€‚\nA2: ä½ è¯´çš„è¿™ä¸ªæœ¯è¯­éŸ³é¢‘çš„ç¼–è¾‘èƒ½åŠ›ï¼Œå¯ä»¥å®ç°çš„ï¼Œæ¯”å¦‚ä¹‹å‰è¯´çš„å›æ£®çš„å¼¹å¹•å°±å’Œä½ æè¿°çš„åœºæ™¯ä¸€æ¨¡ä¸€æ ·ï¼Œåªè¦è‡ªå·±æ¥å®ç°ä¸€ä¸ªè¿™ç§è§£ç ã€MixéŸ³è½¨çš„ç³»ç»Ÿå°±å¯ä»¥äº†ï¼Œåœ¨ä»»ä½•å¹³å°éƒ½å¯ä»¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661589665,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}