{"id":481889,"title":"04 | è¿è¡ŒåŸç†ï¼šeBPFæ˜¯ä¸€ä¸ªæ–°çš„è™šæ‹Ÿæœºå—ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å€ªæœ‹é£ã€‚</p><p>ä¸Šä¸€è®²ï¼Œæˆ‘å¸¦ä½ ä¸€èµ·æ­å»ºäº† eBPF çš„å¼€å‘ç¯å¢ƒï¼Œå¹¶ä»æœ€ç®€å•çš„ Hello World å¼€å§‹ï¼Œå¸¦ä½ å€ŸåŠ© BCC åº“ä»é›¶å¼€å‘äº†ä¸€ä¸ªè·Ÿè¸ª <a href=\"https://man7.org/linux/man-pages/man2/open.2.html\">openat()</a>&nbsp;ç³»ç»Ÿè°ƒç”¨çš„ eBPF ç¨‹åºã€‚</p><p>ä¸è¿‡ï¼Œè™½ç„¶ç¬¬ä¸€ä¸ª eBPF ç¨‹åºå·²ç»æˆåŠŸè¿è¡Œèµ·æ¥äº†ï¼Œä½ å¾ˆå¯èƒ½è¿˜åœ¨æƒ³ï¼šè¿™ä¸ª eBPF ç¨‹åºåˆ°åº•æ˜¯å¦‚ä½•ç¼–è¯‘æˆå†…æ ¸å¯è¯†åˆ«çš„æ ¼å¼çš„ï¼Ÿåˆæ˜¯å¦‚ä½•åœ¨å†…æ ¸ä¸­è¿è¡Œèµ·æ¥çš„ï¼Ÿè¿˜æœ‰ï¼Œæ—¢ç„¶å…è®¸æ™®é€šç”¨æˆ·å»ä¿®æ”¹å†…æ ¸çš„è¡Œä¸ºï¼Œå®ƒåˆæ˜¯å¦‚ä½•ç¡®ä¿å†…æ ¸å®‰å…¨çš„å‘¢ï¼Ÿ</p><p>ä»Šå¤©ï¼Œæˆ‘å°±å¸¦ä½ ä¸€èµ·æ·±å…¥çœ‹çœ‹ eBPF è™šæ‹Ÿæœºçš„åŸç†ï¼Œä»¥åŠ&nbsp;eBPF ç¨‹åºæ˜¯å¦‚ä½•æ‰§è¡Œçš„ã€‚</p><h2>eBPF è™šæ‹Ÿæœºæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h2><p>eBPF æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨å†…æ ¸ä¸­çš„è™šæ‹Ÿæœºï¼Œå¾ˆå¤šäººåœ¨åˆæ¬¡æ¥è§¦å®ƒæ—¶ï¼Œä¼šæŠŠå®ƒè·Ÿç³»ç»Ÿè™šæ‹ŸåŒ–ï¼ˆæ¯”å¦‚kvmï¼‰ä¸­çš„è™šæ‹Ÿæœºå¼„æ··ã€‚å…¶å®ï¼Œè™½ç„¶éƒ½è¢«ç§°ä¸ºâ€œè™šæ‹Ÿæœºâ€ï¼Œç³»ç»Ÿè™šæ‹ŸåŒ–å’Œ eBPF è™šæ‹Ÿæœºè¿˜æ˜¯æœ‰ç€æœ¬è´¨ä¸åŒçš„ã€‚</p><p>ç³»ç»Ÿè™šæ‹ŸåŒ–åŸºäº x86 æˆ– arm64 ç­‰é€šç”¨æŒ‡ä»¤é›†ï¼Œè¿™äº›æŒ‡ä»¤é›†è¶³ä»¥å®Œæˆå®Œæ•´è®¡ç®—æœºçš„æ‰€æœ‰åŠŸèƒ½ã€‚è€Œä¸ºäº†ç¡®ä¿åœ¨å†…æ ¸ä¸­å®‰å…¨åœ°æ‰§è¡Œï¼ŒeBPF åªæä¾›äº†éå¸¸æœ‰é™çš„æŒ‡ä»¤é›†ã€‚è¿™äº›æŒ‡ä»¤é›†å¯ç”¨äºå®Œæˆä¸€éƒ¨åˆ†å†…æ ¸çš„åŠŸèƒ½ï¼Œä½†å´è¿œä¸è¶³ä»¥æ¨¡æ‹Ÿå®Œæ•´çš„è®¡ç®—æœºã€‚ä¸ºäº†æ›´é«˜æ•ˆåœ°ä¸å†…æ ¸è¿›è¡Œäº¤äº’ï¼ŒeBPF æŒ‡ä»¤è¿˜æœ‰æ„é‡‡ç”¨äº† C è°ƒç”¨çº¦å®šï¼Œå…¶æä¾›çš„è¾…åŠ©å‡½æ•°å¯ä»¥åœ¨ C è¯­è¨€ä¸­ç›´æ¥è°ƒç”¨ï¼Œæå¤§åœ°æ–¹ä¾¿äº† eBPF ç¨‹åºçš„å¼€å‘ã€‚</p><!-- [[[read_end]]] --><p>å¦‚ä¸‹å›¾ï¼ˆå›¾ç‰‡æ¥è‡ª <a href=\"https://www.usenix.org/conference/lisa21/presentation/gregg-bpf\">BPF Internals</a>ï¼‰æ‰€ç¤ºï¼ŒeBPF åœ¨å†…æ ¸ä¸­çš„è¿è¡Œæ—¶ä¸»è¦ç”±&nbsp;5&nbsp;ä¸ªæ¨¡å—ç»„æˆï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/45/d2/453f8d99cea1b35da8f6c57e552yy3d2.png?wh=915x503\" alt=\"å›¾ç‰‡\" title=\"eBPF è¿è¡Œæ—¶\"></p><ul>\n<li>ç¬¬ä¸€ä¸ªæ¨¡å—æ˜¯&nbsp;<strong>eBPF è¾…åŠ©å‡½æ•°</strong>ã€‚å®ƒæä¾›äº†ä¸€ç³»åˆ—ç”¨äº eBPF ç¨‹åºä¸å†…æ ¸å…¶ä»–æ¨¡å—è¿›è¡Œäº¤äº’çš„å‡½æ•°ã€‚è¿™äº›å‡½æ•°å¹¶ä¸æ˜¯ä»»æ„ä¸€ä¸ª eBPF ç¨‹åºéƒ½å¯ä»¥è°ƒç”¨çš„ï¼Œå…·ä½“å¯ç”¨çš„å‡½æ•°é›†ç”± BPF ç¨‹åºç±»å‹å†³å®šã€‚å…³äº BPF ç¨‹åºç±»å‹ï¼Œæˆ‘ä¼šåœ¨ 06 è®² ä¸­è¿›è¡Œè®²è§£ã€‚</li>\n<li>ç¬¬äºŒä¸ªæ¨¡å—æ˜¯&nbsp;<strong>eBPF éªŒè¯å™¨</strong>ã€‚å®ƒç”¨äºç¡®ä¿ eBPF ç¨‹åºçš„å®‰å…¨ã€‚éªŒè¯å™¨ä¼šå°†å¾…æ‰§è¡Œçš„æŒ‡ä»¤åˆ›å»ºä¸ºä¸€ä¸ªæœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰ï¼Œç¡®ä¿ç¨‹åºä¸­ä¸åŒ…å«ä¸å¯è¾¾æŒ‡ä»¤ï¼›æ¥ç€å†æ¨¡æ‹ŸæŒ‡ä»¤çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œç¡®ä¿ä¸ä¼šæ‰§è¡Œæ— æ•ˆæŒ‡ä»¤ã€‚</li>\n<li>ç¬¬ä¸‰ä¸ªæ¨¡å—æ˜¯ç”±&nbsp;<strong>11 ä¸ª 64 ä½å¯„å­˜å™¨ã€ä¸€ä¸ªç¨‹åºè®¡æ•°å™¨å’Œä¸€ä¸ª 512 å­—èŠ‚çš„æ ˆç»„æˆçš„å­˜å‚¨æ¨¡å—</strong>ã€‚è¿™ä¸ªæ¨¡å—ç”¨äºæ§åˆ¶ eBPF ç¨‹åºçš„æ‰§è¡Œã€‚å…¶ä¸­ï¼ŒR0 å¯„å­˜å™¨ç”¨äºå­˜å‚¨å‡½æ•°è°ƒç”¨å’Œ eBPF ç¨‹åºçš„è¿”å›å€¼ï¼Œè¿™æ„å‘³ç€å‡½æ•°è°ƒç”¨æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªè¿”å›å€¼ï¼›R1-R5 å¯„å­˜å™¨ç”¨äºå‡½æ•°è°ƒç”¨çš„å‚æ•°ï¼Œå› æ­¤å‡½æ•°è°ƒç”¨çš„å‚æ•°æœ€å¤šä¸èƒ½è¶…è¿‡ 5 ä¸ªï¼›è€Œ R10 åˆ™æ˜¯ä¸€ä¸ªåªè¯»å¯„å­˜å™¨ï¼Œç”¨äºä»æ ˆä¸­è¯»å–æ•°æ®ã€‚</li>\n<li>ç¬¬å››ä¸ªæ¨¡å—æ˜¯<strong>å³æ—¶ç¼–è¯‘å™¨</strong>ï¼Œå®ƒå°† eBPF å­—èŠ‚ç ç¼–è¯‘æˆæœ¬åœ°æœºå™¨æŒ‡ä»¤ï¼Œä»¥ä¾¿æ›´é«˜æ•ˆåœ°åœ¨å†…æ ¸ä¸­æ‰§è¡Œã€‚</li>\n<li>ç¬¬äº”ä¸ªæ¨¡å—æ˜¯&nbsp;<strong>BPF æ˜ å°„ï¼ˆmapï¼‰</strong>ï¼Œå®ƒç”¨äºæä¾›å¤§å—çš„å­˜å‚¨ã€‚è¿™äº›å­˜å‚¨å¯è¢«ç”¨æˆ·ç©ºé—´ç¨‹åºç”¨æ¥è¿›è¡Œè®¿é—®ï¼Œè¿›è€Œæ§åˆ¶ eBPF ç¨‹åºçš„è¿è¡ŒçŠ¶æ€ã€‚</li>\n</ul><p>å…³äº BPF è¾…åŠ©å‡½æ•°å’Œ BPF æ˜ å°„çš„å…·ä½“å†…å®¹ï¼Œæˆ‘åœ¨åé¢çš„è¯¾ç¨‹ä¸­è¿˜ä¼šä¸ºä½ è¯¦ç»†ä»‹ç»ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ BPF æŒ‡ä»¤çš„å…·ä½“æ ¼å¼ï¼Œä»¥åŠå®ƒæ˜¯å¦‚ä½•åŠ è½½åˆ°å†…æ ¸ä¸­ï¼Œåˆæ˜¯ä½•æ—¶è¿è¡Œçš„ã€‚</p><h2>BPF æŒ‡ä»¤æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿ</h2><p>åªçœ‹å›¾ä¸­çš„è¿™äº›æ¨¡å—ï¼Œä½ å¯èƒ½è§‰å¾—å®ƒä»¬å¹¶ä¸æ˜¯å¤ªç›´è§‚ã€‚æ‰€ä»¥æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿˜æ˜¯ç”¨ä¸Šä¸€è®²çš„ Hello World ä½œä¸ºä¾‹å­ï¼Œä¸€èµ·çœ‹ä¸‹ BPF æŒ‡ä»¤åˆ°åº•æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚</p><p>é¦–å…ˆï¼Œå›é¡¾ä¸€ä¸‹ä¸Šä¸€è®²çš„  eBPF ç¨‹åº&nbsp;Hello World&nbsp;çš„æºä»£ç ã€‚å®ƒçš„é€»è¾‘å…¶å®å¾ˆç®€å•ï¼Œå…ˆè°ƒç”¨&nbsp;  <code>bpf_trace_printk</code>  è¾“å‡ºä¸€ä¸ª â€œHello, World!â€ å­—ç¬¦ä¸²ï¼Œç„¶åå°±è¿”å›æˆåŠŸäº†ï¼š</p><pre><code class=\"language-c++\">int hello_world(void *ctx)\n{\n&nbsp; bpf_trace_printk(\"Hello, World!\");\n&nbsp; return 0;\n}\n</code></pre><p>ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡ BCC çš„ Python åº“ï¼ŒåŠ è½½å¹¶è¿è¡Œäº†è¿™ä¸ª eBPF ç¨‹åºï¼š</p><pre><code class=\"language-python\">#!/usr/bin/env python3\n# This is a Hello World example of BPF.\nfrom bcc import BPF\n\n# load BPF program\nb = BPF(src_file=\"hello.c\")\nb.attach_kprobe(event=\"do_sys_openat2\", fn_name=\"hello_world\")\nb.trace_print()\n</code></pre><p>åœ¨ç»ˆç«¯ä¸­è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå°±å¯ä»¥å¯åŠ¨è¿™ä¸ª eBPF ç¨‹åºï¼ˆæ³¨æ„ï¼Œ BCC å¸®ä½ å®Œæˆäº†ç¼–è¯‘å’ŒåŠ è½½çš„è¿‡ç¨‹ï¼‰ï¼š</p><pre><code class=\"language-python\">sudo python3 hello.py\n</code></pre><p><strong>æ¥ä¸‹æ¥ï¼Œæˆ‘ä¸ºä½ ä»‹ç»ä¸€ä¸ªæ–°çš„å·¥å…· bpftoolï¼Œ<strong><strong>ç”¨å®ƒå¯ä»¥</strong></strong>æŸ¥çœ‹ eBPF ç¨‹åºçš„è¿è¡ŒçŠ¶æ€ã€‚</strong></p><p>é¦–å…ˆï¼Œæ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼ŒæŸ¥è¯¢ç³»ç»Ÿä¸­æ­£åœ¨è¿è¡Œçš„ eBPF ç¨‹åºï¼š</p><pre><code class=\"language-bash\"># sudo bpftool prog list\n89: kprobe  name hello_world  tag 38dd440716c4900f  gpl\n      loaded_at 2021-11-27T13:20:45+0000  uid 0\n      xlated 104B  jited 70B  memlock 4096B\n      btf_id 131\n      pids python3(152027)\n</code></pre><p>è¾“å‡ºä¸­ï¼Œ89 æ˜¯è¿™ä¸ª eBPF ç¨‹åºçš„ç¼–å·ï¼Œkprobe æ˜¯ç¨‹åºçš„ç±»å‹ï¼Œè€Œ hello_world æ˜¯ç¨‹åºçš„åå­—ã€‚</p><p>æœ‰äº† eBPF ç¨‹åºç¼–å·ä¹‹åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°±å¯ä»¥å¯¼å‡ºè¿™ä¸ª eBPF ç¨‹åºçš„æŒ‡ä»¤ï¼ˆæ³¨æ„æŠŠ 89 æ›¿æ¢æˆä½ æŸ¥è¯¢åˆ°çš„ç¼–å·ï¼‰ï¼š</p><pre><code class=\"language-bash\">sudo bpftool prog dump xlated id 89\n</code></pre><p>ä½ ä¼šçœ‹åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„è¾“å‡ºï¼š</p><pre><code class=\"language-bash\">int hello_world(void * ctx):\n; int hello_world(void *ctx)\n&nbsp; &nbsp;0: (b7) r1 = 33&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /* ! */\n; ({ char _fmt[] = \"Hello, World!\"; bpf_trace_printk_(_fmt, sizeof(_fmt)); });\n&nbsp; &nbsp;1: (6b) *(u16 *)(r10 -4) = r1\n&nbsp; &nbsp;2: (b7) r1 = 1684828783&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /*&nbsp;dlro */\n&nbsp; &nbsp;3: (63) *(u32 *)(r10 -8) = r1\n&nbsp; &nbsp;4: (18) r1 = 0x57202c6f6c6c6548&nbsp; /*&nbsp;W ,olleH */\n&nbsp; &nbsp;6: (7b) *(u64 *)(r10 -16) = r1\n&nbsp; &nbsp;7: (bf) r1 = r10\n;\n&nbsp; &nbsp;8: (07) r1 += -16\n; ({ char _fmt[] = \"Hello, World!\"; bpf_trace_printk_(_fmt, sizeof(_fmt)); });\n&nbsp; &nbsp;9: (b7) r2 = 14\n&nbsp; 10: (85) call bpf_trace_printk#-61616\n; return 0;\n&nbsp; 11: (b7) r0 = 0\n&nbsp; 12: (95) exit\n</code></pre><p>å…¶ä¸­ï¼Œåˆ†å·å¼€å¤´çš„éƒ¨åˆ†ï¼Œæ­£æ˜¯æˆ‘ä»¬å‰é¢å†™çš„ C ä»£ç ï¼Œè€Œå…¶ä»–è¡Œåˆ™æ˜¯å…·ä½“çš„ BPF æŒ‡ä»¤ã€‚å…·ä½“æ¯ä¸€è¡Œçš„ BPF æŒ‡ä»¤åˆåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼š</p><ul>\n<li>ç¬¬ä¸€éƒ¨åˆ†ï¼Œå†’å·å‰é¢çš„æ•°å­— 0-12 ï¼Œä»£è¡¨ BPF æŒ‡ä»¤è¡Œæ•°ï¼›</li>\n<li>ç¬¬äºŒéƒ¨åˆ†ï¼Œæ‹¬å·ä¸­çš„16è¿›åˆ¶æ•°å€¼ï¼Œè¡¨ç¤º BPF æŒ‡ä»¤ç ã€‚å®ƒçš„å…·ä½“å«ä¹‰ä½ å¯ä»¥å‚è€ƒ <a href=\"https://github.com/iovisor/bpf-docs/blob/master/eBPF.md\">IOVisor BPF æ–‡æ¡£</a>ï¼Œæ¯”å¦‚ç¬¬ 0 è¡Œçš„ 0xb7 è¡¨ç¤ºä¸º 64 ä½å¯„å­˜å™¨èµ‹å€¼ã€‚</li>\n<li>ç¬¬ä¸‰éƒ¨åˆ†ï¼Œæ‹¬å·åé¢çš„éƒ¨åˆ†ï¼Œå°±æ˜¯ BPF æŒ‡ä»¤çš„ä¼ªä»£ç ã€‚</li>\n</ul><p>ç»“åˆå‰é¢è®²è¿°çš„å„ä¸ªå¯„å­˜å™¨çš„ä½œç”¨ï¼Œä¸éš¾ç†è§£è¿™äº› BPF æŒ‡ä»¤çš„å«ä¹‰ï¼š</p><ul>\n<li>ç¬¬0-8è¡Œï¼Œå€ŸåŠ© R10 å¯„å­˜å™¨ä»æ ˆä¸­æŠŠå­—ç¬¦ä¸² â€œHello, World!â€ è¯»å‡ºæ¥ï¼Œå¹¶æ”¾å…¥ R1 å¯„å­˜å™¨ä¸­ï¼›</li>\n<li>ç¬¬9è¡Œï¼Œå‘ R2 å¯„å­˜å™¨å†™å…¥å­—ç¬¦ä¸²çš„é•¿åº¦ 14ï¼ˆå³ä»£ç æ³¨é‡Šé‡Œé¢çš„  <code>sizeof(_fmt)</code> ï¼‰ï¼›</li>\n<li>ç¬¬10è¡Œï¼Œè°ƒç”¨ BPF è¾…åŠ©å‡½æ•°  <code>bpf_trace_printk</code>  è¾“å‡ºå­—ç¬¦ä¸²ï¼›</li>\n<li>ç¬¬11è¡Œï¼Œå‘ R0 å¯„å­˜å™¨å†™å…¥0ï¼Œè¡¨ç¤ºç¨‹åºçš„è¿”å›å€¼æ˜¯0ï¼›</li>\n<li>æœ€åä¸€è¡Œï¼Œç¨‹åºæ‰§è¡ŒæˆåŠŸé€€å‡ºã€‚</li>\n</ul><p>æ€»ç»“èµ·æ¥ï¼Œ<strong>è¿™äº›æŒ‡ä»¤å…ˆé€šè¿‡ R1 å’Œ R2 å¯„å­˜å™¨è®¾ç½®äº†</strong> <code>bpf_trace_printk</code> <strong>çš„å‚æ•°ï¼Œç„¶åè°ƒç”¨</strong> <code>bpf_trace_printk</code> <strong>å‡½æ•°è¾“å‡ºå­—ç¬¦ä¸²ï¼Œæœ€åå†é€šè¿‡ R0 å¯„å­˜å™¨è¿”å›æˆåŠŸã€‚</strong></p><p>å®é™…ä¸Šï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ç±»ä¼¼çš„ <a href=\"https://man7.org/linux/man-pages/man2/bpf.2.html#EXAMPLES\">BPF æŒ‡ä»¤</a>æ¥å¼€å‘ eBPF ç¨‹åºï¼ˆå…·ä½“æŒ‡ä»¤çš„å®šä¹‰ï¼Œè¯·å‚è€ƒ <a href=\"https://elixir.bootlin.com/linux/v5.4/source/include/uapi/linux/bpf_common.h\">include/uapi/linux/bpf_common.h</a> ä»¥åŠ <a href=\"https://elixir.bootlin.com/linux/v5.4/source/include/uapi/linux/bpf.h\">include/uapi/linux/bpf.h</a>ï¼‰ï¼Œä¸è¿‡é€šå¸¸å¹¶ä¸æ¨èä½ è¿™ä¹ˆåšã€‚è·Ÿä¸€å¼€å§‹çš„ C ç¨‹åºç›¸æ¯”ï¼Œä½ ä¼šå‘ç° BPF æŒ‡ä»¤çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§æ˜æ˜¾è¦å·®å¾—å¤šã€‚æ‰€ä»¥ï¼Œæˆ‘å»ºè®®ä½ è¿˜æ˜¯ä½¿ç”¨ C è¯­è¨€æ¥å¼€å‘ eBPF ç¨‹åºï¼Œè€ŒåªæŠŠ&nbsp;BPF æŒ‡ä»¤ä½œä¸ºæ’æŸ¥ eBPF ç¨‹åºç–‘éš¾æ‚ç—‡æ—¶çš„å‚è€ƒã€‚</p><p>è¿™é‡Œï¼Œæˆ‘æ¥ç®€å•è®²è®²&nbsp;BPF æŒ‡ä»¤åŠ è½½åæ˜¯å¦‚ä½•è¿è¡Œçš„ã€‚å½“è¿™äº› BPF æŒ‡ä»¤åŠ è½½åˆ°å†…æ ¸åï¼Œ BPF å³æ—¶ç¼–è¯‘å™¨ä¼šå°†å…¶ç¼–è¯‘æˆæœ¬åœ°æœºå™¨æŒ‡ä»¤ï¼Œæœ€åæ‰ä¼šæ‰§è¡Œç¼–è¯‘åçš„æœºå™¨æŒ‡ä»¤ï¼š</p><pre><code class=\"language-bash\"># bpftool prog dump jited id 89\nint hello_world(void * ctx):\nbpf_prog_38dd440716c4900f_hello_world:\n; int hello_world(void *ctx)\n&nbsp; &nbsp;0:\tnopl&nbsp; &nbsp;0x0(%rax,%rax,1)\n&nbsp; &nbsp;5:\txchg&nbsp; &nbsp;%ax,%ax\n&nbsp; &nbsp;7:\tpush&nbsp; &nbsp;%rbp\n&nbsp; &nbsp;8:\tmov&nbsp; &nbsp; %rsp,%rbp\n&nbsp; &nbsp;b:\tsub&nbsp; &nbsp; $0x10,%rsp\n&nbsp; 12:\tmov&nbsp; &nbsp; $0x21,%edi\n; ({ char _fmt[] = \"Hello, World!\"; bpf_trace_printk_(_fmt, sizeof(_fmt)); });\n&nbsp; 17:\tmov&nbsp; &nbsp; %di,-0x4(%rbp)\n&nbsp; 1b:\tmov&nbsp; &nbsp; $0x646c726f,%edi\n&nbsp; 20:\tmov&nbsp; &nbsp; %edi,-0x8(%rbp)\n&nbsp; 23:\tmovabs $0x57202c6f6c6c6548,%rdi\n&nbsp; 2d:\tmov&nbsp; &nbsp; %rdi,-0x10(%rbp)\n&nbsp; 31:\tmov&nbsp; &nbsp; %rbp,%rdi\n;\n&nbsp; 34:\tadd&nbsp; &nbsp; $0xfffffffffffffff0,%rdi\n; ({ char _fmt[] = \"Hello, World!\"; bpf_trace_printk_(_fmt, sizeof(_fmt)); });\n&nbsp; 38:\tmov&nbsp; &nbsp; $0xe,%esi\n&nbsp; 3d:\tcall&nbsp; &nbsp;0xffffffffd8c7e834\n; return 0;\n&nbsp; 42:\txor&nbsp; &nbsp; %eax,%eax\n&nbsp; 44:\tleave\n&nbsp; 45:\tret\n</code></pre><p>è¿™äº›æœºå™¨æŒ‡ä»¤çš„å«ä¹‰è·Ÿå‰é¢çš„ BPF æŒ‡ä»¤æ˜¯ç±»ä¼¼çš„ï¼Œä½†å…·ä½“çš„æŒ‡ä»¤å’Œå¯„å­˜å™¨éƒ½æ¢æˆäº† x86 çš„æ ¼å¼ã€‚ä½ ä¸éœ€è¦æŒæ¡è¿™äº›æœºå™¨æŒ‡ä»¤çš„å…·ä½“å«ä¹‰ï¼Œåªè¦çŸ¥é“æŸ¥è¯¢çš„å…·ä½“æ–¹æ³•å°±è¶³å¤Ÿäº†ã€‚è¿™æ˜¯å› ä¸ºï¼Œå°±åƒä½ æ›¾æ¥è§¦è¿‡çš„å…¶ä»–é«˜çº§è¯­è¨€ä¸€æ ·ï¼Œåœ¨å®é™…çš„ eBPF ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¹¶ä¸éœ€è¦ç›´æ¥ä½¿ç”¨æœºå™¨æŒ‡ä»¤ï¼Œè€Œæ˜¯ eBPF è™šæ‹Ÿæœºå¸®ä½ è‡ªåŠ¨å®Œæˆäº†è½¬æ¢ã€‚</p><h2>eBPF ç¨‹åºæ˜¯ä»€ä¹ˆæ—¶å€™æ‰§è¡Œçš„ï¼Ÿ</h2><p>åˆ°è¿™é‡Œï¼Œæˆ‘æƒ³ä½ å·²ç»ç†è§£äº† BPF æŒ‡ä»¤çš„å…·ä½“æ ¼å¼ï¼Œä»¥åŠå®ƒä¸  C æºä»£ç ä¹‹é—´çš„å¯¹åº”å…³ç³»ã€‚ä¸è¿‡ï¼Œè¿™ä¸ª eBPF ç¨‹åºåˆ°åº•æ˜¯ä»€ä¹ˆæ—¶å€™æ‰§è¡Œçš„å‘¢ï¼Ÿæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†ä¸€èµ·çœ‹çœ‹ BPF æŒ‡ä»¤çš„åŠ è½½å’Œæ‰§è¡Œè¿‡ç¨‹ã€‚</p><p>åœ¨ä¸Šä¸€è®²ä¸­æˆ‘æåˆ°ï¼ŒBCC è´Ÿè´£äº† eBPF ç¨‹åºçš„ç¼–è¯‘å’ŒåŠ è½½è¿‡ç¨‹ã€‚å› è€Œï¼Œè¦äº†è§£ BPF æŒ‡ä»¤çš„åŠ è½½è¿‡ç¨‹ï¼Œå°±å¯ä»¥ä» BCC æ‰§è¡Œ eBPF ç¨‹åºçš„è¿‡ç¨‹å…¥æ‰‹ã€‚</p><p>é‚£ä¹ˆï¼Œæ€ä¹ˆæ‰èƒ½æŸ¥çœ‹åˆ° BCC çš„æ‰§è¡Œè¿‡ç¨‹å‘¢ï¼Ÿæˆ‘æƒ³ï¼Œä½ ä¸€å®šæƒ³åˆ°äº†ï¼Œé‚£å°±æ˜¯è·Ÿè¸ªå®ƒçš„ç³»ç»Ÿè°ƒç”¨è¿‡ç¨‹ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªç»ˆç«¯ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š</p><pre><code class=\"language-bash\"># -ebpfè¡¨ç¤ºåªè·Ÿè¸ªbpfç³»ç»Ÿè°ƒç”¨\nsudo strace -v -f -ebpf ./hello.py\n</code></pre><p>ç¨ç­‰ä¸€ä¼šï¼Œä½ ä¼šçœ‹åˆ°å¦‚ä¸‹çš„è¾“å‡ºï¼š</p><pre><code class=\"language-bash\">bpf(BPF_PROG_LOAD,\n    {\n        prog_type=BPF_PROG_TYPE_KPROBE,\n        insn_cnt=13,\n        insns=[\n            {code=BPF_ALU64|BPF_K|BPF_MOV, dst_reg=BPF_REG_1, src_reg=BPF_REG_0, off=0, imm=0x21},\n            {code=BPF_STX|BPF_H|BPF_MEM, dst_reg=BPF_REG_10, src_reg=BPF_REG_1, off=-4, imm=0},\n            {code=BPF_ALU64|BPF_K|BPF_MOV, dst_reg=BPF_REG_1, src_reg=BPF_REG_0, off=0, imm=0x646c726f},\n            {code=BPF_STX|BPF_W|BPF_MEM, dst_reg=BPF_REG_10, src_reg=BPF_REG_1, off=-8, imm=0},\n            {code=BPF_LD|BPF_DW|BPF_IMM, dst_reg=BPF_REG_1, src_reg=BPF_REG_0, off=0, imm=0x6c6c6548},\n            {code=BPF_LD|BPF_W|BPF_IMM, dst_reg=BPF_REG_0, src_reg=BPF_REG_0, off=0, imm=0x57202c6f},\n            {code=BPF_STX|BPF_DW|BPF_MEM, dst_reg=BPF_REG_10, src_reg=BPF_REG_1, off=-16, imm=0},\n            {code=BPF_ALU64|BPF_X|BPF_MOV, dst_reg=BPF_REG_1, src_reg=BPF_REG_10, off=0, imm=0},\n            {code=BPF_ALU64|BPF_K|BPF_ADD, dst_reg=BPF_REG_1, src_reg=BPF_REG_0, off=0, imm=0xfffffff0},\n            {code=BPF_ALU64|BPF_K|BPF_MOV, dst_reg=BPF_REG_2, src_reg=BPF_REG_0, off=0, imm=0xe},\n            {code=BPF_JMP|BPF_K|BPF_CALL, dst_reg=BPF_REG_0, src_reg=BPF_REG_0, off=0, imm=0x6},\n            {code=BPF_ALU64|BPF_K|BPF_MOV, dst_reg=BPF_REG_0, src_reg=BPF_REG_0, off=0, imm=0},\n            {code=BPF_JMP|BPF_K|BPF_EXIT, dst_reg=BPF_REG_0, src_reg=BPF_REG_0, off=0, imm=0}\n        ],\n        prog_name=\"hello_world\",\n        ...\n    },\n    128) = 4\n</code></pre><p>è¿™äº›å‚æ•°çœ‹èµ·æ¥å¾ˆå¤æ‚ï¼Œä½†å®é™…ä¸Šï¼Œå¦‚æœä½ æŸ¥è¯¢  <code>bpf</code> ç³»ç»Ÿè°ƒç”¨çš„æ ¼å¼ï¼ˆæ‰§è¡Œ  <code>man bpf</code> å‘½ä»¤ï¼‰ï¼Œå°±å¯ä»¥å‘ç°ï¼Œå®ƒå®é™…ä¸Šåªéœ€è¦ä¸‰ä¸ªå‚æ•°ï¼š</p><pre><code class=\"language-bash\">int bpf(int cmd, union bpf_attr *attr, unsigned int size);\n</code></pre><p>å¯¹åº”å‰é¢çš„ strace è¾“å‡ºç»“æœï¼Œè¿™ä¸‰ä¸ªå‚æ•°çš„å…·ä½“å«ä¹‰å¦‚ä¸‹ã€‚</p><ul>\n<li>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯  <code>BPF_PROG_LOAD</code> ï¼Œ è¡¨ç¤ºåŠ è½½ BPF ç¨‹åºã€‚</li>\n<li>ç¬¬äºŒä¸ªå‚æ•°æ˜¯  <code>bpf_attr</code>  ç±»å‹çš„ç»“æ„ä½“ï¼Œè¡¨ç¤º BPF ç¨‹åºçš„å±æ€§ã€‚å…¶ä¸­ï¼Œæœ‰å‡ ä¸ªéœ€è¦ä½ ç•™æ„çš„å‚æ•°ï¼Œæ¯”å¦‚ï¼š\n<ul>\n<li><code>prog_type</code>  è¡¨ç¤º BPF ç¨‹åºçš„ç±»å‹ï¼Œè¿™å„¿æ˜¯  <code>BPF_PROG_TYPE_KPROBE</code> ï¼Œè·Ÿæˆ‘ä»¬Python ä»£ç ä¸­çš„  <code>attach_kprobe</code>  ä¸€è‡´ï¼›</li>\n<li><code>insn_cnt</code>  (instructions count) è¡¨ç¤ºæŒ‡ä»¤æ¡æ•°ï¼›</li>\n<li><code>insns</code>  (instructions) åŒ…å«äº†å…·ä½“çš„æ¯ä¸€æ¡æŒ‡ä»¤ï¼Œè¿™å„¿çš„ 13 æ¡æŒ‡ä»¤è·Ÿæˆ‘ä»¬å‰é¢  <code>bpftool prog dump</code>  çš„ç»“æœæ˜¯ä¸€è‡´çš„ï¼ˆå…·ä½“çš„æŒ‡ä»¤æ ¼å¼ï¼Œä½ å¯ä»¥å‚è€ƒå†…æ ¸ä¸­ <a href=\"https://elixir.bootlin.com/linux/v5.4/source/include/uapi/linux/bpf.h#L65\">bpf_insn</a> çš„å®šä¹‰ï¼‰ï¼›</li>\n<li><code>prog_name</code>  åˆ™è¡¨ç¤º BPF ç¨‹åºçš„åå­—ï¼Œå³  <code>hello_world</code> ã€‚</li>\n</ul>\n</li>\n<li>ç¬¬ä¸‰ä¸ªå‚æ•° 128 è¡¨ç¤ºå±æ€§çš„å¤§å°ã€‚</li>\n</ul><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº† bpf ç³»ç»Ÿè°ƒç”¨çš„åŸºæœ¬æ ¼å¼ã€‚å¯¹äº  <code>bpf</code>  ç³»ç»Ÿè°ƒç”¨åœ¨å†…æ ¸ä¸­çš„å®ç°åŸç†ï¼Œä½ å¹¶ä¸éœ€è¦è¯¦ç»†äº†è§£ã€‚æˆ‘ä»¬åªè¦çŸ¥é“å®ƒçš„å…·ä½“åŠŸèƒ½ï¼Œå°±å¯ä»¥æŒæ¡ eBPF çš„æ ¸å¿ƒåŸç†äº†ã€‚å½“ç„¶ï¼Œå¦‚æœä½ å¯¹å®ƒçš„å®ç°æ–¹æ³•æœ‰å…´è¶£çš„è¯ï¼Œå¯ä»¥å‚è€ƒå†…æ ¸æºç  kernel/bpf/syscall.c ä¸­ <a href=\"https://elixir.bootlin.com/linux/v5.4/source/kernel/bpf/syscall.c#L2837\">SYSCALL_DEFINE3</a> çš„å®ç°ã€‚</p><p>BPF ç¨‹åºåŠ è½½åˆ°å†…æ ¸åï¼Œå¹¶ä¸ä¼šç«‹åˆ»æ‰§è¡Œï¼Œé‚£ä¹ˆå®ƒä»€ä¹ˆæ—¶å€™æ‰ä¼šæ‰§è¡Œå‘¢ï¼Ÿè¿™é‡Œï¼Œå›æƒ³ä¸€ä¸‹æˆ‘åœ¨ <a href=\"https://time.geekbang.org/column/article/479384\">01 è®²</a> ä¸­æåˆ°çš„ eBPF çš„åŸºæœ¬åŸç†ï¼š</p><blockquote>\n<p>eBPF ç¨‹åºå¹¶ä¸åƒå¸¸è§„çš„çº¿ç¨‹é‚£æ ·ï¼Œå¯åŠ¨åå°±ä¸€ç›´è¿è¡Œåœ¨é‚£é‡Œï¼Œå®ƒéœ€è¦äº‹ä»¶è§¦å‘åæ‰ä¼šæ‰§è¡Œã€‚è¿™äº›äº‹ä»¶åŒ…æ‹¬ç³»ç»Ÿè°ƒç”¨ã€å†…æ ¸è·Ÿè¸ªç‚¹ã€å†…æ ¸å‡½æ•°å’Œç”¨æˆ·æ€å‡½æ•°çš„è°ƒç”¨é€€å‡ºã€ç½‘ç»œäº‹ä»¶ï¼Œç­‰ç­‰ã€‚</p>\n</blockquote><p>å¯¹äºæˆ‘ä»¬çš„ Hello World æ¥è¯´ï¼Œç”±äºè°ƒç”¨äº†  <code>attach_kprobe</code>  å‡½æ•°ï¼Œå¾ˆæ˜æ˜¾ï¼Œè¿™æ˜¯ä¸€ä¸ªå†…æ ¸è·Ÿè¸ªäº‹ä»¶ï¼š</p><pre><code class=\"language-bash\">b.attach_kprobe(event=\"do_sys_openat2\", fn_name=\"hello_world\")\n</code></pre><p>æ‰€ä»¥ï¼Œé™¤äº†æŠŠ eBPF ç¨‹åºåŠ è½½åˆ°å†…æ ¸ä¹‹å¤–ï¼Œè¿˜éœ€è¦æŠŠåŠ è½½åçš„ç¨‹åºè·Ÿå…·ä½“çš„å†…æ ¸å‡½æ•°è°ƒç”¨äº‹ä»¶è¿›è¡Œç»‘å®šã€‚åœ¨ eBPF çš„å®ç°ä¸­ï¼Œè¯¸å¦‚å†…æ ¸è·Ÿè¸ªï¼ˆkprobeï¼‰ã€ç”¨æˆ·è·Ÿè¸ªï¼ˆuprobeï¼‰ç­‰çš„äº‹ä»¶ç»‘å®šï¼Œéƒ½æ˜¯é€šè¿‡  <code>perf_event_open()</code>  æ¥å®Œæˆçš„ã€‚</p><p>ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿæˆ‘ä»¬å†ç”¨  <code>strace</code>  æ¥ç¡®è®¤ä¸€ä¸‹ã€‚æŠŠå‰é¢  <code>strace</code>  å‘½ä»¤ä¸­çš„  <code>-ebpf</code>  å‚æ•°å»æ‰ï¼Œé‡æ–°æ‰§è¡Œï¼š</p><pre><code class=\"language-bash\">sudo strace -v -f ./hello.py\n</code></pre><p>å¿½ç•¥æ— å…³çš„è¾“å‡ºåï¼Œä½ ä¼šå‘ç°å¦‚ä¸‹çš„ç³»ç»Ÿè°ƒç”¨ï¼š</p><pre><code class=\"language-c++\">...\n/* 1) åŠ è½½BPFç¨‹åº */\nbpf(BPF_PROG_LOAD,...) = 4\n...\n\n/* 2ï¼‰æŸ¥è¯¢äº‹ä»¶ç±»å‹ */\nopenat(AT_FDCWD, \"/sys/bus/event_source/devices/kprobe/type\", O_RDONLY) = 5\nread(5, \"6\\n\", 4096)                    = 2\nclose(5)                                = 0\n...\n\n/* 3ï¼‰åˆ›å»ºæ€§èƒ½ç›‘æ§äº‹ä»¶ */\nperf_event_open(\n    {\n        type=0x6 /* PERF_TYPE_??? */,\n        size=PERF_ATTR_SIZE_VER7,\n        ...\n        wakeup_events=1,\n        config1=0x7f275d195c50,\n        ...\n    },\n    -1,\n    0,\n    -1,\n    PERF_FLAG_FD_CLOEXEC) = 5\n\n/* 4ï¼‰ç»‘å®šBPFåˆ°kprobeäº‹ä»¶ */\nioctl(5, PERF_EVENT_IOC_SET_BPF, 4)     = 0\n...\n</code></pre><p>ä»è¾“å‡ºä¸­ï¼Œä½ å¯ä»¥çœ‹å‡º BPF ä¸æ€§èƒ½äº‹ä»¶çš„ç»‘å®šè¿‡ç¨‹åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p><ul>\n<li>é¦–å…ˆï¼Œå€ŸåŠ© bpf ç³»ç»Ÿè°ƒç”¨ï¼ŒåŠ è½½ BPF ç¨‹åºï¼Œå¹¶è®°ä½è¿”å›çš„æ–‡ä»¶æè¿°ç¬¦ï¼›</li>\n<li>ç„¶åï¼ŒæŸ¥è¯¢ kprobe ç±»å‹çš„äº‹ä»¶ç¼–å·ã€‚BCC å®é™…ä¸Šæ˜¯é€šè¿‡  <code>/sys/bus/event_source/devices/kprobe/type</code> æ¥æŸ¥è¯¢çš„ï¼›</li>\n<li>æ¥ç€ï¼Œè°ƒç”¨  <code>perf_event_open</code>  åˆ›å»ºæ€§èƒ½ç›‘æ§äº‹ä»¶ã€‚æ¯”å¦‚ï¼Œäº‹ä»¶ç±»å‹ï¼ˆtype æ˜¯ä¸Šä¸€æ­¥æŸ¥è¯¢åˆ°çš„ 6ï¼‰ã€äº‹ä»¶çš„å‚æ•°ï¼ˆ <code>config1 åŒ…å«äº†å†…æ ¸å‡½æ•° do_sys_openat2</code> ï¼‰ç­‰ï¼›</li>\n<li>æœ€åï¼Œå†é€šè¿‡  <code>ioctl</code>  çš„  <code>PERF_EVENT_IOC_SET_BPF</code>  å‘½ä»¤ï¼Œå°† BPF ç¨‹åºç»‘å®šåˆ°æ€§èƒ½ç›‘æ§äº‹ä»¶ã€‚</li>\n</ul><p>å¯¹äºç»‘å®šæ€§èƒ½ç›‘æ§ï¼ˆperf eventï¼‰çš„å†…æ ¸å®ç°åŸç†ï¼Œä½ ä¹Ÿä¸éœ€è¦è¯¦ç»†äº†è§£ï¼Œåªéœ€è¦çŸ¥é“å®ƒçš„å…·ä½“åŠŸèƒ½ï¼Œå°±è¶³å¤Ÿæˆ‘ä»¬æŒæ¡ eBPF äº†ã€‚å¦‚æœä½ å¯¹å®ƒçš„å®ç°æ–¹æ³•æœ‰å…´è¶£çš„è¯ï¼Œå¯ä»¥å‚è€ƒå†…æ ¸æºç  <a href=\"https://elixir.bootlin.com/linux/v5.4/source/kernel/events/core.c#L9039\">perf_event_set_bpf_prog</a> çš„å®ç°ï¼›è€Œæœ€ç»ˆæ€§èƒ½ç›‘æ§è°ƒç”¨ BPF ç¨‹åºçš„å®ç°ï¼Œåˆ™å¯ä»¥å‚è€ƒå†…æ ¸æºç  <a href=\"https://elixir.bootlin.com/linux/v5.4/source/kernel/trace/trace_kprobe.c#L1351\">kprobe_perf_func</a> çš„å®ç°ã€‚</p><h2>å°ç»“</h2><p>ä»Šå¤©ï¼Œæˆ‘å¸¦ä½ ä¸€èµ·æ¢³ç†äº† eBPF åœ¨å†…æ ¸ä¸­çš„å®ç°åŸç†ï¼Œå¹¶ä»¥ä¸Šä¸€è®²çš„ Hello World ç¨‹åºä¸ºä¾‹ï¼Œå€ŸåŠ© bpftoolã€strace ç­‰å·¥å…·ï¼Œå¸¦ä½ è§‚å¯Ÿäº† BPF æŒ‡ä»¤çš„å…·ä½“æ ¼å¼ã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬ä» BCC æ‰§è¡Œ eBPF ç¨‹åºçš„è¿‡ç¨‹å…¥æ‰‹ï¼Œä¸€èµ·çœ‹äº†BPF æŒ‡ä»¤çš„åŠ è½½å’Œæ‰§è¡Œè¿‡ç¨‹ã€‚ç”¨é«˜çº§è¯­è¨€å¼€å‘çš„ eBPF ç¨‹åºï¼Œéœ€è¦é¦–å…ˆç¼–è¯‘ä¸º BPF å­—èŠ‚ç ï¼ˆå³ BPF æŒ‡ä»¤ï¼‰ï¼Œç„¶åå€ŸåŠ©  <code>bpf</code>  ç³»ç»Ÿè°ƒç”¨åŠ è½½åˆ°å†…æ ¸ä¸­ï¼Œæœ€åå†é€šè¿‡æ€§èƒ½ç›‘æ§ç­‰æ¥å£ï¼Œä¸å…·ä½“çš„å†…æ ¸äº‹ä»¶è¿›è¡Œç»‘å®šã€‚è¿™æ ·ï¼Œå†…æ ¸çš„æ€§èƒ½ç›‘æ§æ¨¡å—æ‰ä¼šåœ¨å†…æ ¸äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œè‡ªåŠ¨æ‰§è¡Œæˆ‘ä»¬å¼€å‘çš„ eBPF ç¨‹åºã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ€åï¼Œæˆ‘æƒ³é‚€è¯·ä½ æ¥èŠä¸€èŠè¿™ä¸¤ä¸ªé—®é¢˜ã€‚</p><ol>\n<li>ä½ é€šå¸¸æ˜¯å¦‚ä½•å¿«é€Ÿç†è§£ä¸€é—¨æ–°æŠ€æœ¯çš„è¿è¡ŒåŸç†çš„ï¼Ÿ</li>\n<li>åœ¨ä»Šå¤©çš„å†…å®¹ä¸­ï¼Œæˆ‘ä½¿ç”¨ strace è·Ÿè¸ª BCC ç¨‹åºï¼Œè¿›è€Œæ‰¾åˆ°äº†ç›¸å…³çš„ç³»ç»Ÿè°ƒç”¨ã€‚é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰å¯èƒ½ç›´æ¥ä½¿ç”¨ BCC æ¥è·Ÿè¸ª  <code>bpf</code> ç³»ç»Ÿè°ƒç”¨å‘¢ï¼Ÿå¦‚æœä½ çš„ç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œå¯ä»¥è¯•ç€æŠŠå®ƒå¼€å‘å‡ºæ¥ï¼Œå¹¶åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„å®è·µç»éªŒã€‚</li>\n</ol><p>æ¬¢è¿åœ¨ç•™è¨€åŒºå’Œæˆ‘è®¨è®ºï¼Œä¹Ÿæ¬¢è¿æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™ä½ çš„åŒäº‹ã€æœ‹å‹ã€‚æˆ‘ä»¬ä¸€èµ·åœ¨å®æˆ˜ä¸­æ¼”ç»ƒï¼Œåœ¨äº¤æµä¸­è¿›æ­¥ã€‚</p>","neighbors":{"left":{"article_title":"03 | åˆçª¥é—¨å¾„ï¼šå¼€å‘å¹¶è¿è¡Œä½ çš„ç¬¬ä¸€ä¸ªeBPFç¨‹åº","id":481090},"right":{"article_title":"05 | ç¼–ç¨‹æ¥å£ï¼šeBPFç¨‹åºæ˜¯æ€ä¹ˆè·Ÿå†…æ ¸è¿›è¡Œäº¤äº’çš„ï¼Ÿ","id":482459}},"comments":[{"had_liked":false,"id":332031,"user_name":"è«å","can_delete":false,"product_type":"c1","uid":1007254,"ip_address":"","ucode":"E28F2602BA25DD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5e/96/a03175bc.jpg","comment_is_top":false,"comment_ctime":1642990792,"is_pvip":false,"replies":[{"id":121329,"content":"è°¢è°¢åˆ†äº«å®è·µç»éªŒğŸ‘ï¼ŒBCCå†…ç½®çš„å¾ˆå¤šå®çš„ç¡®éå¸¸æ–¹ä¾¿ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1001282,"ctime":1643031358,"ip_address":"","comment_id":332031,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100104501,"comment_content":"è¿½è¸ª bpf ç³»ç»Ÿè°ƒç”¨ï¼Œå€ŸåŠ© BCC å®å®šä¹‰ TRACEPOINT_PROBE(category, event) æ¯”è¾ƒæ–¹ä¾¿ï¼Œä¾‹å¦‚ï¼š\n\n-------------- example.c ----------------\n\nTRACEPOINT_PROBE(syscalls, sys_enter_bpf)\n{\n    bpf_trace_printk(&quot;%d\\\\n&quot;, args-&gt;cmd);\n    return 0;\n}\n\n-------------- example.py -----------------\n\n#!&#47;usr&#47;bin&#47;env python3\n\nfrom bcc import BPF\n\n# load BPF program\nb = BPF(src_file=&quot;example.c&quot;)\nb.trace_print()\n\n","like_count":23,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548108,"discussion_content":"è°¢è°¢åˆ†äº«å®è·µç»éªŒğŸ‘ï¼ŒBCCå†…ç½®çš„å¾ˆå¤šå®çš„ç¡®éå¸¸æ–¹ä¾¿ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643031358,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ec/0e/d64d4663.jpg","nickname":"k8svip","note":"","ucode":"89F02243735432","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":620302,"discussion_content":"root@ebpf2:/home/ebpf/Documents/ebpfstudy# python example.py\n\nb&#39;           &lt;...&gt;-20457   [001] d..31 66652.737628: bpf_trace_printk: 5\\\\n&#39;\nb&#39;           &lt;...&gt;-20457   [001] d..31 66652.737877: bpf_trace_printk: 18\\\\n&#39;\nb&#39;           &lt;...&gt;-20457   [001] d..31 66652.737930: bpf_trace_printk: 5\\\\n&#39;\nb&#39;           &lt;...&gt;-20457   [001] d..31 66652.738017: bpf_trace_printk: 0\\\\n&#39;\nb&#39;           &lt;...&gt;-20457   [001] d..31 66652.738288: bpf_trace_printk: 5\\\\n&#39;\nb&#39;          python-20457   [001] d..31 66652.758857: bpf_trace_printk: 2\\\\n&#39;\nb&#39;          python-20457   [001] d..31 66652.758973: bpf_trace_printk: 2\\\\n&#39;\nb&#39;          python-20457   [001] d..31 66652.759060: bpf_trace_printk: 2\\\\n&#39;\nb&#39;          python-20457   [001] d..31 66652.759232: bpf_trace_printk: 2\\\\n&#39;\n\nb&#39;          python-20457   [003] d..31 66717.186311: bpf_trace_printk: 3\\\\n&#39;\nb&#39;          python-20457   [003] d..31 66717.186441: bpf_trace_printk: 3\\\\n&#39;\nb&#39;          python-20457   [003] d..31 66717.186513: bpf_trace_printk: 3\\\\n&#39;\nb&#39;          python-20457   [003] d..31 66717.186556: bpf_trace_printk: 3\\\\n&#39;\n\nè¿™é‡Œçš„bpf_trace_printk(&#34;%d\\\\n&#34;, args-&gt;cmd); è¿™å¥è¯æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1686037517,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2613059,"avatar":"https://static001.geekbang.org/account/avatar/00/27/df/43/0773c064.jpg","nickname":"ä¸ä¼šMATLAB","note":"","ucode":"725795EDB38F5A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548250,"discussion_content":"è¿™å°±æ˜¯å¤§ä½¬å—ï¼Œæˆ‘çœ‹çš„æœ‰ç‚¹æ™•ï¼Œå¾—åå¤å¤šçœ‹çœ‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643100353,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":333525,"user_name":"18646333118","can_delete":false,"product_type":"c1","uid":1202411,"ip_address":"","ucode":"35576AC4E5ADDD","user_header":"https://static001.geekbang.org/account/avatar/00/12/58/eb/cf3608bd.jpg","comment_is_top":false,"comment_ctime":1644393670,"is_pvip":false,"replies":[{"id":122030,"content":"ğŸ‘ è°¢è°¢åˆ†äº«æºç ç¼–è¯‘bpftoolçš„è¯¦ç»†æ­¥éª¤ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1001282,"ctime":1644730950,"ip_address":"","comment_id":333525,"utype":1}],"discussion_count":7,"race_medal":0,"score":2,"product_id":100104501,"comment_content":"è§£å†³æ–¹æ³•:\n{\n    &quot;features&quot;: {\n        &quot;libbfd&quot;: false\n    }\n}\n\nuname -r\n5.13.0-19-generic\n\napt-cache search linux-source\napt install linux-source-5.13.0\n\ncd  &#47;usr&#47;src&#47;\ntar -jxvf linux-source-5.13.0.tar.bz2\n\napt install libelf-dev\ncd linux-source-5.13.0&#47;tools\nmake -C  bpf&#47;bpftool\n.&#47;bpf&#47;bpftool&#47;bpftool version -p\n{\n    &quot;version&quot;: &quot;5.13.19&quot;,\n    &quot;features&quot;: {\n        &quot;libbfd&quot;: true,\n        &quot;skeletons&quot;: true\n    }\n}\n","like_count":12,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550780,"discussion_content":"ğŸ‘ è°¢è°¢åˆ†äº«æºç ç¼–è¯‘bpftoolçš„è¯¦ç»†æ­¥éª¤ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644730950,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1384605,"avatar":"https://static001.geekbang.org/account/avatar/00/15/20/9d/61efb39e.jpg","nickname":"èµµæ¨å¥","note":"","ucode":"31B003271E8CD1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":609051,"discussion_content":"è¿™ç”¨çš„é‚£ä¸ªaptæº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678797174,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":550780,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":609051,"extra":""}]},{"author":{"id":2930048,"avatar":"","nickname":"woJA1wCgAAbjKldokPvO1h9ZEJTUP8ug","note":"","ucode":"F329F4882868C4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556449,"discussion_content":"é‡åˆ°äº†ä¸€æ ·çš„é—®é¢˜ï¼Œuname -aä¸º5.13.0-35-genericï¼Œå±‚ä¸»æ–¹æ³•èµ°ä¸é€š\nåŸå› æ˜¯aptæ²¡èƒ½æŸ¥è¯¢å¹¶ä¸‹è½½åˆ°linux-source-5.13.0æºç \næœ€ç»ˆé€šè¿‡ä¸‹é¢çš„æ–¹å¼è§£å†³ï¼š\nç¬¬ä¸€æ­¥ï¼šgit clone -b v5.13 --depth 1 https://github.com/torvalds/linux\nç¬¬äºŒæ­¥ï¼šcd linux/tools/bpf/bpftool\nç¬¬ä¸‰æ­¥ï¼šmake &amp;&amp; make install\næœŸé—´æŠ¥é”™ä¸€äº›éœ€è¦çš„åº“ï¼Œæœ€æ–¹ä¾¿çš„æ˜¯ç›´æ¥ä»apt install åå­—-devï¼Œå…¶ä¸­libbfdå·²ç»æ•´åˆåˆ°binutils-dev\næœ€åä½ å¯èƒ½ä¼šå‘ç°bpftoolä»ç„¶ä½¿ç”¨jitedæ—¶æŠ¥é”™ï¼Œå› ä¸ºé»˜è®¤ä½¿ç”¨çš„/usr/sbinä¸‹å¯æ‰§è¡Œç¨‹åºï¼Œè‡ªè¡Œæ›¿æ¢å½“å‰ç›®å½•ä¸‹æ–°ç¼–è¯‘å¥½çš„bpftoolå°±è¡Œ\nå…¶ä½™ç‰ˆæœ¬åŒç†ï¼Œå¯ä»¥ç›´æ¥è®¿é—®ä¸Šé¢çš„githubä»“åº“ï¼ŒæŸ¥çœ‹tagsæ‰¾åˆ°ä½ å¯¹åº”çš„ç‰ˆæœ¬æ›¿æ¢ç¬¬ä¸€æ­¥-båå‚æ•°\n","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1647362351,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2942126,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/e4/ae/3e922744.jpg","nickname":"zer0_1s","note":"","ucode":"7ABE2092CAE54B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":599413,"discussion_content":"# ç»¼åˆæ¥¼ä¸Šçš„ä¾‹å­\nuname -r\n5.15.0-57-generic\napt-cache search linux-source\napt install linux-source-5.15.0\n\ncd  /usr/src/\ntar -jxvf linux-source-5.15.0.tar.bz2\n\napt install libelf-dev\ncd linux-source-5.15.0/tools\n# å¼€å¯libbfd\nsudo apt-get install binutils-dev\nmake -C  bpf/bpftool\ncd   bpf/bpftool\nmake install\n\nAuto-detecting system features:\n...                        libbfd: [ on  ]\n...        disassembler-four-args: [ on  ]\n...                          zlib: [ on  ]\n...                        libcap: [ OFF ]\n...               clang-bpf-co-re: [ on  ]\n\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1673507459,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ²³åŒ—","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1628811,"avatar":"https://static001.geekbang.org/account/avatar/00/18/da/8b/34f44e9f.jpg","nickname":"Rodger","note":"","ucode":"F9F5A7B34E2756","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551411,"discussion_content":"makeæ—¶æç¤ºlibbfdæœªå¯ç”¨ï¼š\nAuto-detecting system features:\n...                        libbfd: [ OFF ]\næ–¹æ³•ï¼šå®‰è£…binutils-devåé‡æ–°make\nsudo apt-get install binutils-dev","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1645011360,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2905523,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIDqHQQByGiaXcAk94MdDn3ftupZLXyR6bAKibxOzMxy5h3uBwZ7QiaCiaIfbCMK0cIQfGNax8iawoiaQAg/132","nickname":"nuan","note":"","ucode":"55FF98EB85404D","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":609206,"discussion_content":"è¯·æ•™ä¸‹ï¼Œè¿™ä¸ªé€‰é¡¹ clang-bpf-co-re: [ OFF ] æ€ä¹ˆæ‰èƒ½å˜æˆ on å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678871333,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2898964,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/3c/14/86507b52.jpg","nickname":"èŒ¹èŒ¹","note":"","ucode":"08C233CE22C63D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554310,"discussion_content":"æ„Ÿè°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646311054,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332546,"user_name":"ä¸äº†å³°","can_delete":false,"product_type":"c1","uid":1013424,"ip_address":"","ucode":"E23B96D6A3D4EC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","comment_is_top":false,"comment_ctime":1643334949,"is_pvip":false,"replies":[{"id":121565,"content":"è°¢è°¢åˆ†äº«ã€‚æˆ‘çš„ç†è§£æ˜¯ï¼Œè¦æ·±å…¥ä¸€é—¨æŠ€æœ¯çš„æ¯ä¸ªç»†èŠ‚éœ€è¦çœ‹å¾ˆå¤šä¹¦ç±ï¼Œä½†ä¸€å¼€å§‹è¦æœ‰ä¸ªä¾§é‡ç‚¹ï¼Œä¸è¦å‘æ•£çš„å¤ªå¹¿äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1001282,"ctime":1643461116,"ip_address":"","comment_id":332546,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100104501,"comment_content":"ä½ é€šå¸¸æ˜¯å¦‚ä½•å¿«é€Ÿç†è§£ä¸€é—¨æ–°æŠ€æœ¯çš„è¿è¡ŒåŸç†çš„ï¼Ÿ\n--- çœ‹ä¸€ä¸‹å®˜æ–¹æ–‡æ¡£ï¼Œäº†è§£ä½“ç³»æ¶æ„ï¼Œå¤šçœ‹å‡ éã€‚ä¹°ä¹¦çœ‹æ„Ÿè§‰ä¹Ÿæ˜¯ä¸€ä¸ªå¿«é€Ÿå…¥é—¨çš„æ–¹æ³•ã€‚\nä½†æ˜¯å¯¹äºæ²¡æœ‰ç¼–ç¨‹ç»éªŒï¼Œå¯¹äº å­—èŠ‚ç ã€cpuå¯„å­˜å™¨ã€jit ï¼Œç¼–è¯‘å™¨çš„ç†è§£è¿˜æ˜¯å¾ˆæŠ½è±¡ï¼Œå­¦åˆ°è¿™é‡Œè¿˜æ˜¯æœ‰ç‚¹æ™•ã€‚æ„Ÿè§‰è¿˜æ˜¯è¦æŠŠè¿™è¯¾ç¨‹ä»å¤´å†çœ‹ä¸€éã€‚","like_count":5,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548962,"discussion_content":"è°¢è°¢åˆ†äº«ã€‚æˆ‘çš„ç†è§£æ˜¯ï¼Œè¦æ·±å…¥ä¸€é—¨æŠ€æœ¯çš„æ¯ä¸ªç»†èŠ‚éœ€è¦çœ‹å¾ˆå¤šä¹¦ç±ï¼Œä½†ä¸€å¼€å§‹è¦æœ‰ä¸ªä¾§é‡ç‚¹ï¼Œä¸è¦å‘æ•£çš„å¤ªå¹¿äº†ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1643461116,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":336086,"user_name":"ç«ç«å¯»","can_delete":false,"product_type":"c1","uid":1120541,"ip_address":"","ucode":"B6DC003A5D89AF","user_header":"https://static001.geekbang.org/account/avatar/00/11/19/1d/d2b6e006.jpg","comment_is_top":false,"comment_ctime":1645888343,"is_pvip":false,"replies":[{"id":122898,"content":"ğŸ‘ ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1001282,"ctime":1646046366,"ip_address":"","comment_id":336086,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100104501,"comment_content":"1ã€ä½ é€šå¸¸æ˜¯å¦‚ä½•å¿«é€Ÿç†è§£ä¸€é—¨æ–°æŠ€æœ¯çš„è¿è¡ŒåŸç†çš„ï¼Ÿ\nGet Essentialsï¼Œ ADEPTäº”æ­¥æ³•ï¼šç±»æ¯”ï¼Œç”»å›¾ï¼Œä¾‹å­ï¼Œæ–‡å­—è¯´æ˜ï¼Œå®šä¹‰ã€‚\n\nå‰©ä¸‹çš„å°±æ˜¯æ ¹æ®éœ€è¦ä¾§é‡åœ°æ·±å…¥åˆ°ç»†èŠ‚ã€‚","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553740,"discussion_content":"ğŸ‘ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646046367,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332897,"user_name":"ä¸ƒé‡Œ","can_delete":false,"product_type":"c1","uid":1042604,"ip_address":"","ucode":"614A35DE72C739","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e8/ac/7324d5ca.jpg","comment_is_top":false,"comment_ctime":1643793746,"is_pvip":false,"replies":[{"id":121735,"content":"å¯ä»¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥è¯¢bpftoolæ”¯æŒçš„ç‰¹æ€§ï¼š\n\nsudo bpftool version -p\n\nå¦‚æœå‡ºç°ä¸‹é¢çš„è¾“å‡ºè¯´æ˜å‘è¡Œç‰ˆè‡ªå¸¦çš„bpftoolé»˜è®¤ä¸æ”¯æŒlibbfdï¼Œéœ€è¦ä¸‹è½½å†…æ ¸æºç å¹¶å®‰è£…binutils-devä¹‹åé‡æ–°ç¼–è¯‘bpftoolï¼š\n{\n    &quot;features&quot;: {\n        &quot;libbfd&quot;: false\n    }\n}","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1001282,"ctime":1644117788,"ip_address":"","comment_id":332897,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100104501,"comment_content":"è¯·é—®ï¼Œä¸èƒ½æ‰§è¡Œ&#39;bpftool prog dump jited id 78&#39;æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿbpfç›¸å…³çš„åŒ…éƒ½æŒ‰ç…§ä¸Šä¸€è®²çš„æç¤ºæŒ‰ç…§ä¸Šäº†\n\nroot@maqi-ubt:~# bpftool prog dump xlated id 78\nint hello_world(void * ctx):\n; int hello_world(void *ctx)\n   0: (b7) r1 = 33\n; ({ char _fmt[] = &quot;Hello, World!&quot;; bpf_trace_printk_(_fmt, sizeof(_fmt)); });\n   1: (6b) *(u16 *)(r10 -4) = r1\n   2: (b7) r1 = 1684828783\n   3: (63) *(u32 *)(r10 -8) = r1\n   4: (18) r1 = 0x57202c6f6c6c6548\n   6: (7b) *(u64 *)(r10 -16) = r1\n   7: (bf) r1 = r10\n;\n   8: (07) r1 += -16\n; ({ char _fmt[] = &quot;Hello, World!&quot;; bpf_trace_printk_(_fmt, sizeof(_fmt)); });\n   9: (b7) r2 = 14\n  10: (85) call bpf_trace_printk#-63952\n; return 0;\n  11: (b7) r0 = 0\n  12: (95) exit\nroot@maqi-ubt:~#\nroot@maqi-ubt:~# bpftool prog dump jited id 78\nError: No libbfd support","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549597,"discussion_content":"å¯ä»¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥è¯¢bpftoolæ”¯æŒçš„ç‰¹æ€§ï¼š\n\nsudo bpftool version -p\n\nå¦‚æœå‡ºç°ä¸‹é¢çš„è¾“å‡ºè¯´æ˜å‘è¡Œç‰ˆè‡ªå¸¦çš„bpftoolé»˜è®¤ä¸æ”¯æŒlibbfdï¼Œéœ€è¦ä¸‹è½½å†…æ ¸æºç å¹¶å®‰è£…binutils-devä¹‹åé‡æ–°ç¼–è¯‘bpftoolï¼š\n{\n    &#34;features&#34;: {\n        &#34;libbfd&#34;: false\n    }\n}","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644117788,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332678,"user_name":"å†™ç‚¹å•¥å‘¢","can_delete":false,"product_type":"c1","uid":1065272,"ip_address":"","ucode":"C19032CF1C41BA","user_header":"https://static001.geekbang.org/account/avatar/00/10/41/38/4f89095b.jpg","comment_is_top":false,"comment_ctime":1643461635,"is_pvip":false,"replies":[{"id":121660,"content":"ç³»ç»Ÿè°ƒç”¨æœ€å¤šåªæœ‰6ä¸ªå‚æ•°ï¼Œä¸ä¼šæ›´å¤šçš„ï¼Œå…·ä½“å¯ä»¥å‚è€ƒå†…æ ¸æºç  https:&#47;&#47;elixir.bootlin.com&#47;linux&#47;v5.13&#47;source&#47;include&#47;linux&#47;syscalls.h#L216ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1001282,"ctime":1643812117,"ip_address":"","comment_id":332678,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100104501,"comment_content":"è¯·é—®è€å¸ˆï¼Œåƒä¸ŠèŠ‚è¯¾ä¾‹å­ä¸­ trace openatç³»ç»Ÿè°ƒç”¨çš„è¿™ä¸ªå‡½æ•°int hello_world(struct pt_regs *ctx, int dfd, const char __user * filename, struct open_how *how)ï¼Œbpfä¼šè‡ªåŠ¨æŠŠç³»ç»Ÿè°ƒç”¨å‚æ•°æ³¨å…¥bpfå‡½æ•°æ‰§è¡Œä¸­ã€‚æœ¬èŠ‚è¯¾æåˆ°bpfè™šæ‹Ÿæœºä¸­å¯¹bpfå‡½æ•°çš„å‚æ•°ä¸ªæ•°æœ‰é™åˆ¶ï¼Œé‚£å¦‚æœç¢°åˆ°ç³»ç»Ÿè°ƒç”¨å‚æ•°ä¸ªæ•°å¤§äºbpfé™åˆ¶äº†ï¼Œè¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ\n\nè°¢è°¢è€å¸ˆ","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549291,"discussion_content":"ç³»ç»Ÿè°ƒç”¨æœ€å¤šåªæœ‰6ä¸ªå‚æ•°ï¼Œä¸ä¼šæ›´å¤šçš„ï¼Œå…·ä½“å¯ä»¥å‚è€ƒå†…æ ¸æºç  https://elixir.bootlin.com/linux/v5.13/source/include/linux/syscalls.h#L216ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1643812117,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1065272,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/38/4f89095b.jpg","nickname":"å†™ç‚¹å•¥å‘¢","note":"","ucode":"C19032CF1C41BA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":549294,"discussion_content":"å¤šè°¢è€å¸ˆè§£ç­”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643812358,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":549291,"ip_address":"","group_id":0},"score":549294,"extra":""}]}]},{"had_liked":false,"id":369258,"user_name":"22","can_delete":false,"product_type":"c1","uid":3228321,"ip_address":"æ±Ÿè‹","ucode":"CA72DF07C8C49F","user_header":"https://static001.geekbang.org/account/avatar/00/31/42/a1/716f3c50.jpg","comment_is_top":false,"comment_ctime":1677294759,"is_pvip":false,"replies":[{"id":134625,"content":"å»æ‰straceï¼Œåªæ‰§è¡Œ .&#47;hello.py å¯ä»¥æ­£å¸¸æ‰§è¡Œå—ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1001282,"ctime":1677498663,"ip_address":"ä¸Šæµ·","comment_id":369258,"utype":1}],"discussion_count":5,"race_medal":0,"score":2,"product_id":100104501,"comment_content":"è€å¸ˆï¼Œsudo strace -v -f -ebpf .&#47;hello.py\nstrace: exec: å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼é”™è¯¯\n+++ exited with 1 +++\næƒ³è¯·é—®ä¸€ä¸‹è¿™æ˜¯ä»€ä¹ˆåŸå› å•Šï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":606934,"discussion_content":"å»æ‰straceï¼Œåªæ‰§è¡Œ ./hello.py å¯ä»¥æ­£å¸¸æ‰§è¡Œå—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677498663,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2905523,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIDqHQQByGiaXcAk94MdDn3ftupZLXyR6bAKibxOzMxy5h3uBwZ7QiaCiaIfbCMK0cIQfGNax8iawoiaQAg/132","nickname":"nuan","note":"","ucode":"55FF98EB85404D","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":609200,"discussion_content":"hello.py éœ€è¦æœ‰å¯æ‰§è¡Œæƒé™æˆ–è€…æ‰§è¡Œ sudo strace -v -f -ebpf python3 ./hello.py","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1678870334,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1039351,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/db/f7/29cff40f.jpg","nickname":"æ˜Ÿ","note":"","ucode":"652BF9B9DB377B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":625970,"discussion_content":"æŸ¥çœ‹hello.pyçš„æƒé™\n$ ls -l \nå¤§æ¦‚ç‡æ²¡æœ‰å¯æ‰§è¡Œæƒé™ï¼Œç»™å…¶å¢åŠ æƒé™\n$ chmod +x hello.py\nç„¶åå°±å¯ä»¥äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1692363974,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2562558,"avatar":"https://static001.geekbang.org/account/avatar/00/27/19/fe/d31344db.jpg","nickname":"lJ","note":"","ucode":"CC29D06A16FF93","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":614911,"discussion_content":"which python3ï¼Œç¡®è®¤pythonè§£é‡Šå™¨çš„è·¯å¾„ï¼Œæ¯”å¦‚æˆ‘çš„ç¯å¢ƒæ˜¯ï¼š/usr/bin/python3ï¼Œç„¶åç”¨è¿™ä¸ªè·¯å¾„æ›¿æ¢hello.pyçš„shebangè¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1681965780,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ±Ÿè‹","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1769504,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJGXndj5N66z9BL1ic9GibZzWWgoVeWaWTL2XUnCYic7iba2kAEvN9WfjmlXELD5lqt8IJ1P023N5ZWicg/132","nickname":"Geek_f93234","note":"","ucode":"1E5DC903A5429E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":610413,"discussion_content":"hello.pyæ–‡ä»¶é¦–è¡Œæ·»åŠ python3ç¯å¢ƒå˜é‡\n#!/usr/bin/env python3","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679552239,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":369246,"user_name":"22","can_delete":false,"product_type":"c1","uid":3228321,"ip_address":"æ±Ÿè‹","ucode":"CA72DF07C8C49F","user_header":"https://static001.geekbang.org/account/avatar/00/31/42/a1/716f3c50.jpg","comment_is_top":false,"comment_ctime":1677288264,"is_pvip":false,"replies":[{"id":134624,"content":"å»æ‰straceï¼Œåªæ‰§è¡Œ .&#47;hello.py å¯ä»¥æ­£å¸¸æ‰§è¡Œå—ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1001282,"ctime":1677498652,"ip_address":"ä¸Šæµ·","comment_id":369246,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100104501,"comment_content":"è¿½è¸ªç³»ç»Ÿè°ƒç”¨ï¼Œæ˜¾ç¤ºæ²¡æœ‰æƒé™è¯¥æ€ä¹ˆè§£å†³å•Š\nsudo strace -v -f -ebpf .&#47;hello.py\nstrace: exec: æƒé™ä¸å¤Ÿ\n+++ exited with 1 +++\n","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":606933,"discussion_content":"å»æ‰straceï¼Œåªæ‰§è¡Œ ./hello.py å¯ä»¥æ­£å¸¸æ‰§è¡Œå—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677498652,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1769504,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJGXndj5N66z9BL1ic9GibZzWWgoVeWaWTL2XUnCYic7iba2kAEvN9WfjmlXELD5lqt8IJ1P023N5ZWicg/132","nickname":"Geek_f93234","note":"","ucode":"1E5DC903A5429E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":610414,"discussion_content":"chmod +x hello.py","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679552278,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358227,"user_name":"å´”ä¼Ÿå","can_delete":false,"product_type":"c1","uid":1022452,"ip_address":"å¹¿ä¸œ","ucode":"ACDEEDF2A10999","user_header":"https://static001.geekbang.org/account/avatar/00/0f/99/f4/e0484cac.jpg","comment_is_top":false,"comment_ctime":1664092264,"is_pvip":false,"replies":[{"id":134622,"content":"ä¸æ˜¯çš„ï¼ŒeBPFæœ‰éå¸¸å¤šçš„é™åˆ¶ï¼Œå†…æ ¸éœ€è¦éªŒè¯æ‰€æœ‰æ‰§è¡Œè·¯å¾„æ˜¯ç¡®å®šçš„æ‰å¯ä»¥åŠ è½½ï¼ˆå¦‚æœå»æ‰éªŒè¯ï¼Œåªè€ƒè™‘å†…æ ¸ä¸­çš„eBPFè™šæ‹Ÿæœºï¼Œæˆ‘çš„ç†è§£å®ƒæ˜¯å›¾çµå®Œå¤‡çš„ï¼‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1001282,"ctime":1677498440,"ip_address":"ä¸Šæµ·","comment_id":358227,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100104501,"comment_content":"ebpfæ˜¯å›¾çµå®Œå¤‡çš„å—","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":606931,"discussion_content":"ä¸æ˜¯çš„ï¼ŒeBPFæœ‰éå¸¸å¤šçš„é™åˆ¶ï¼Œå†…æ ¸éœ€è¦éªŒè¯æ‰€æœ‰æ‰§è¡Œè·¯å¾„æ˜¯ç¡®å®šçš„æ‰å¯ä»¥åŠ è½½ï¼ˆå¦‚æœå»æ‰éªŒè¯ï¼Œåªè€ƒè™‘å†…æ ¸ä¸­çš„eBPFè™šæ‹Ÿæœºï¼Œæˆ‘çš„ç†è§£å®ƒæ˜¯å›¾çµå®Œå¤‡çš„ï¼‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677498440,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337848,"user_name":"woo","can_delete":false,"product_type":"c1","uid":1133195,"ip_address":"","ucode":"3076FEA9A60DBC","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ibpASCYk5eF1lAEbJ3TSI0fuMtiaVDb7dNuBZDRPL6QjEict8Wrb8iax2OibbEBxSs4bicCYf3yMEkGmXB2b2UVypaIg/132","comment_is_top":false,"comment_ctime":1647092483,"is_pvip":false,"replies":[{"id":123548,"content":"å®ƒé»˜è®¤æ˜¯æ²¡æœ‰æ¢è¡Œçš„ã€‚ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹è¾“å‡ºä¸­çš„å‚æ•°æ ¼å¼ï¼Œè¯¾ç¨‹ä¸­æˆ‘æ‰‹åŠ¨åšäº†å¯¹é½","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1001282,"ctime":1647165746,"ip_address":"","comment_id":337848,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100104501,"comment_content":"ä¸ºå•¥æˆ‘çš„straceè¾“å‡ºçš„ä¸åƒè€å¸ˆé‚£ç§jsonæ ¼å¼å¾ˆæ¼‚äº®ï¼Œæ˜¯ä»¥è¡Œä¸ºå•ä½çš„æ˜¾ç¤ºï¼Œæ˜¯è£…äº†ä»€ä¹ˆå·¥å…·å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556020,"discussion_content":"å®ƒé»˜è®¤æ˜¯æ²¡æœ‰æ¢è¡Œçš„ã€‚ä¸ºäº†æ–¹ä¾¿æŸ¥çœ‹è¾“å‡ºä¸­çš„å‚æ•°æ ¼å¼ï¼Œè¯¾ç¨‹ä¸­æˆ‘æ‰‹åŠ¨åšäº†å¯¹é½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647165746,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332482,"user_name":"ä¸äº†å³°","can_delete":false,"product_type":"c1","uid":1013424,"ip_address":"","ucode":"E23B96D6A3D4EC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","comment_is_top":false,"comment_ctime":1643272004,"is_pvip":false,"replies":[{"id":121469,"content":"å¯ä»¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥è¯¢bpftoolæ”¯æŒçš„ç‰¹æ€§ï¼š\n\nsudo bpftool version -p\n\nå¦‚æœå‡ºç°ä¸‹é¢çš„è¾“å‡ºè¯´æ˜é»˜è®¤ä¸æ”¯æŒlibbfdï¼Œéœ€è¦ä¸‹è½½å†…æ ¸æºç å¹¶å®‰è£…binutils-devä¹‹åé‡æ–°ç¼–è¯‘bpftoolï¼š\n{\n    &quot;features&quot;: {\n        &quot;libbfd&quot;: false\n    }\n}","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1001282,"ctime":1643291039,"ip_address":"","comment_id":332482,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100104501,"comment_content":"root@ubuntu-impish:~# bpftool prog dump jited id 331\nError: No libbfd support   \nroot@ubuntu-impish:~# \n----\nroot@ubuntu-impish:~# bpftool -V\n&#47;usr&#47;lib&#47;linux-tools&#47;5.13.0-27-generic&#47;bpftool v5.13.19\nfeatures:\nroot@ubuntu-impish:~# \n-----\næ˜¯ä¸æ˜¯å› ä¸ºæ–°ç‰ˆçš„bpftool  Remove bpf_jit_enable=2 debugging modeã€‚\n\n-----\nroot@ubuntu-impish:~#  bpftool prog profile\nError: bpftool prog profile command is not supported. Please build bpftool with clang &gt;= 10.0.0\nroot@ubuntu-impish:~# clang -v\nUbuntu clang version 13.0.0-2\nTarget: x86_64-pc-linux-gnu","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548645,"discussion_content":"å¯ä»¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥è¯¢bpftoolæ”¯æŒçš„ç‰¹æ€§ï¼š\n\nsudo bpftool version -p\n\nå¦‚æœå‡ºç°ä¸‹é¢çš„è¾“å‡ºè¯´æ˜é»˜è®¤ä¸æ”¯æŒlibbfdï¼Œéœ€è¦ä¸‹è½½å†…æ ¸æºç å¹¶å®‰è£…binutils-devä¹‹åé‡æ–°ç¼–è¯‘bpftoolï¼š\n{\n    &#34;features&#34;: {\n        &#34;libbfd&#34;: false\n    }\n}","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643291039,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332452,"user_name":"ZR2021","can_delete":false,"product_type":"c1","uid":1707352,"ip_address":"","ucode":"4F685C7516F057","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKwGurTWOiaZ2O2oCdxK9kbF4PcwGg0ALqsWhNq87hWvwPy8ZU9cxRzmcGOgdIeJkTOoKfbxgEKqrg/132","comment_is_top":false,"comment_ctime":1643259608,"is_pvip":false,"replies":[{"id":121470,"content":"å¯ä»¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥è¯¢bpftoolæ”¯æŒçš„ç‰¹æ€§ï¼š\n\nsudo bpftool version -p\n\nå¦‚æœå‡ºç°ä¸‹é¢çš„è¾“å‡ºè¯´æ˜é»˜è®¤ä¸æ”¯æŒlibbfdï¼Œéœ€è¦ä¸‹è½½å†…æ ¸æºç å¹¶å®‰è£…binutils-devä¹‹åé‡æ–°ç¼–è¯‘bpftoolï¼š\n{\n    &quot;features&quot;: {\n        &quot;libbfd&quot;: false\n    }\n}","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1001282,"ctime":1643291054,"ip_address":"","comment_id":332452,"utype":1}],"discussion_count":3,"race_medal":0,"score":3,"product_id":100104501,"comment_content":"è€å¸ˆï¼Œæˆ‘è¿™è¾¹æ‰§è¡Œ bpftool prog dump jited id xxxï¼ŒæŠ¥&quot;Error: No libbfd support&quot; é”™è¯¯ï¼Œç½‘ä¸Šä¹Ÿæ²¡æ‰¾åˆ°åŸå› ï¼Œç³»ç»Ÿæ˜¯æœ€æ–°çš„ubuntu 21.10ï¼Œvmvareçš„è™šæ‹Ÿæœºï¼Œæ‰§è¡Œxlatedæ˜¯å¯ä»¥æ‰“å°å‡ºæŒ‡ä»¤çš„ï¼Œä¸çŸ¥é“å•¥ä¸ªæƒ…å†µ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548646,"discussion_content":"å¯ä»¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥è¯¢bpftoolæ”¯æŒçš„ç‰¹æ€§ï¼š\n\nsudo bpftool version -p\n\nå¦‚æœå‡ºç°ä¸‹é¢çš„è¾“å‡ºè¯´æ˜é»˜è®¤ä¸æ”¯æŒlibbfdï¼Œéœ€è¦ä¸‹è½½å†…æ ¸æºç å¹¶å®‰è£…binutils-devä¹‹åé‡æ–°ç¼–è¯‘bpftoolï¼š\n{\n    &#34;features&#34;: {\n        &#34;libbfd&#34;: false\n    }\n}","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643291054,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1707352,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKwGurTWOiaZ2O2oCdxK9kbF4PcwGg0ALqsWhNq87hWvwPy8ZU9cxRzmcGOgdIeJkTOoKfbxgEKqrg/132","nickname":"ZR2021","note":"","ucode":"4F685C7516F057","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":548715,"discussion_content":"å¥½çš„ï¼Œè°¢è°¢è€å¸ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643339692,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":548646,"ip_address":"","group_id":0},"score":548715,"extra":""}]},{"author":{"id":1013424,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/b0/14fec62f.jpg","nickname":"ä¸äº†å³°","note":"","ucode":"E23B96D6A3D4EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548698,"discussion_content":"$ sudo bpftool version -p\n{\n    &#34;version&#34;: &#34;5.13.19&#34;,\n    &#34;features&#34;: {\n        &#34;libbfd&#34;: false,\n        &#34;skeletons&#34;: false\n    }\nã€\n\n---å°±å…ˆåˆ°è¿™å„¿å§ï¼Œ å…ˆå­¦ä¸‹é¢çš„è¯¾ç¨‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643334807,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332268,"user_name":"ZR2021","can_delete":false,"product_type":"c1","uid":1707352,"ip_address":"","ucode":"4F685C7516F057","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKwGurTWOiaZ2O2oCdxK9kbF4PcwGg0ALqsWhNq87hWvwPy8ZU9cxRzmcGOgdIeJkTOoKfbxgEKqrg/132","comment_is_top":false,"comment_ctime":1643130473,"is_pvip":false,"replies":[{"id":121418,"content":"éªŒè¯å™¨æ˜¯å‘ç”Ÿåœ¨åŠ è½½è¿‡ç¨‹ä¸­ï¼Œè€Œè¿™å„¿çœ‹åˆ°çš„æ˜¯å·²ç»åŠ è½½åˆ°å†…æ ¸å†…å­˜ä¸­äº†ï¼ˆéªŒè¯å¤±è´¥å°±ä¸ä¼šåŠ è½½äº†ï¼‰","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1001282,"ctime":1643203450,"ip_address":"","comment_id":332268,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100104501,"comment_content":"è€å¸ˆï¼Œsudo bpftool prog dump xlated id 89ï¼Œè¿™æ¡å‘½ä»¤è¾“å‡ºçš„æŒ‡ä»¤æ˜¯å­˜å‚¨æ¨¡å—å­˜å‚¨çš„æŒ‡ä»¤å—ï¼Œè¿™ä¸ªæŒ‡ä»¤æ˜¯åœ¨éªŒè¯å™¨é‡Œè¿›è¡Œè½¬æ¢çš„å—ï¼ŒéªŒè¯å™¨ç”¨è½¬æ¢åçš„æŒ‡ä»¤å»æ¨¡æ‹Ÿæ‰§è¡Œæ˜¯å¦å®‰å…¨ï¼Œå¯¹bpf æ¥è§¦çš„æ¯”è¾ƒå°‘ï¼Œå¯èƒ½é—®çš„æœ‰ç‚¹ä½çº§â€¦â€¦","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548461,"discussion_content":"éªŒè¯å™¨æ˜¯å‘ç”Ÿåœ¨åŠ è½½è¿‡ç¨‹ä¸­ï¼Œè€Œè¿™å„¿çœ‹åˆ°çš„æ˜¯å·²ç»åŠ è½½åˆ°å†…æ ¸å†…å­˜ä¸­äº†ï¼ˆéªŒè¯å¤±è´¥å°±ä¸ä¼šåŠ è½½äº†ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643203450,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1707352,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKwGurTWOiaZ2O2oCdxK9kbF4PcwGg0ALqsWhNq87hWvwPy8ZU9cxRzmcGOgdIeJkTOoKfbxgEKqrg/132","nickname":"ZR2021","note":"","ucode":"4F685C7516F057","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"å€ªæœ‹é£","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":548526,"discussion_content":"å¥½çš„ï¼Œè°¢è°¢è€å¸ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643248375,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":548461,"ip_address":"","group_id":0},"score":548526,"extra":""}]}]},{"had_liked":false,"id":343430,"user_name":"Geek_b84e15","can_delete":false,"product_type":"c1","uid":2983630,"ip_address":"","ucode":"F8AC53A9D8F0D5","user_header":"","comment_is_top":false,"comment_ctime":1650850812,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100104501,"comment_content":"å€ªè€å¸ˆæ‚¨å¥½ï¼Œæˆ‘çœ‹hello_worldçš„å‚æ•°åˆ—è¡¨æ˜¯(void * ctx)ï¼Œè€Œæœ‰çš„ä¾‹å­é‡Œå‚æ•°æ˜¯è¿™æ ·çš„ï¼šint hello_world(struct pt_regs *ctx, int dfd, const char __user * filename, struct open_how *how)ï¼Œè¯·é—®æ€ä¹ˆç¡®å®šå‚æ•°çš„ä¸ªæ•°å’Œå‚æ•°çš„ç±»å‹å‘¢ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":2233803,"avatar":"https://static001.geekbang.org/account/avatar/00/22/15/cb/257f73c5.jpg","nickname":"yamowner","note":"","ucode":"D3BBBDD53F5F70","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571235,"discussion_content":"struct pt_regs* ctxæ˜¯bccç¨‹åºç”¨çš„ä¸Šä¸‹æ–‡å‚æ•°ï¼Œå¯¹è¯¥å‚æ•°çš„ç†è§£æˆ‘ä¹Ÿä¸æ·±å…¥ï¼›åé¢çš„å‚æ•°æ˜¯é€šè¿‡æŒ‚è½½ç‚¹å‡½æ•°æ¥ç¡®å®šçš„ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤: sudo bpftrace -lv &#39;*do_sys_openat2*&#39;æ¥æŸ¥çœ‹ï¼›","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1652151097,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":377532,"user_name":"Sudouble","can_delete":false,"product_type":"c1","uid":1365574,"ip_address":"åŒ—äº¬","ucode":"B369B09DAF8D20","user_header":"https://static001.geekbang.org/account/avatar/00/14/d6/46/5eb5261b.jpg","comment_is_top":false,"comment_ctime":1688650166,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100104501,"comment_content":"å¯¹äºè¿è¡Œäº†sudo strace -v -f -ebpf .&#47;hello.pyæŠ¥äº†ä»¥ä¸‹é”™è¯¯çš„å°ä¼™ä¼´\nstrace: exec: Exec format error\n+++ exited with 1 +++\n\næ›¿æ¢æˆè¿™ä¸ªå‘½ä»¤å°±å¯ä»¥å‡ºç»“æœå•¦ï¼šsudo strace -v -f -ebpf python3 hello.py","like_count":2},{"had_liked":false,"id":371083,"user_name":"Geek_f93234","can_delete":false,"product_type":"c1","uid":1769504,"ip_address":"åŒ—äº¬","ucode":"1E5DC903A5429E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJGXndj5N66z9BL1ic9GibZzWWgoVeWaWTL2XUnCYic7iba2kAEvN9WfjmlXELD5lqt8IJ1P023N5ZWicg/132","comment_is_top":false,"comment_ctime":1679536143,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100104501,"comment_content":"# strace -v -f -ebpf .&#47;hello.py\nstrace: exec: Exec format error\n+++ exited with 1 +++\n","like_count":1,"discussions":[{"author":{"id":1494491,"avatar":"https://static001.geekbang.org/account/avatar/00/16/cd/db/7467ad23.jpg","nickname":"Bachue Zhou","note":"","ucode":"3175754775CA32","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":611807,"discussion_content":"ä½ è¿™ä¸ª strace æ˜¯ä»å…¶ä»–åœ°æ–¹å¤åˆ¶è¿‡æ¥çš„å§ï¼Ÿæ ¹æœ¬ä¸æ˜¯å¯ä»¥è¯†åˆ«çš„åº”ç”¨ç¨‹åºæ ¼å¼ã€‚ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1680334618,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":370414,"user_name":"èµµæ¨å¥","can_delete":false,"product_type":"c1","uid":1384605,"ip_address":"æµ™æ±Ÿ","ucode":"31B003271E8CD1","user_header":"https://static001.geekbang.org/account/avatar/00/15/20/9d/61efb39e.jpg","comment_is_top":false,"comment_ctime":1678795975,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100104501,"comment_content":"æœ‰å­¦ä¹ ç¾¤å—ï¼Ÿé‡åˆ°ä¸€äº›ç¯å¢ƒé—®é¢˜","like_count":1},{"had_liked":false,"id":358903,"user_name":"ç©¿é´å­çš„outman","can_delete":false,"product_type":"c1","uid":1492385,"ip_address":"é‡åº†","ucode":"51DAC34D6C2642","user_header":"https://static001.geekbang.org/account/avatar/00/16/c5/a1/f6a2d80d.jpg","comment_is_top":false,"comment_ctime":1664992686,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100104501,"comment_content":"1.ä½ é€šå¸¸æ˜¯å¦‚ä½•å¿«é€Ÿç†è§£ä¸€é—¨æ–°æŠ€æœ¯çš„è¿è¡ŒåŸç†çš„ï¼Ÿ\n\na.æˆ‘é€šå¸¸é¦–å…ˆææ¸…æ¥šè¿™é—¨æ–°æŠ€æœ¯æƒ³è§£å†³ä»€ä¹ˆé—®é¢˜ç­‰èƒŒæ™¯çŸ¥è¯†.è°åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹,ä¼šé‡åˆ°ä»€ä¹ˆé—®é¢˜.äººæ°¸è¿œæ˜¯ç¬¬ä¸€ä½çš„.\nc.æŒ‰ç…§helloworldç­‰ä¾‹ç¨‹å®æ“ä¸€é.\nb.æ ¹æ®å®é™…ä½“éªŒ,é‡æ–°æ€è€ƒè¿™é—¨æŠ€æœ¯,æœ‰å“ªäº›æ¦‚å¿µ,ç»„ä»¶,ç»„ä»¶ä¹‹é—´çš„å…³ç³»æ˜¯æ€æ ·.å„ä¸ªç»„ä»¶çš„è¾“å…¥è¾“å‡ºæ€ä¹ˆæ ·çš„,æ€ä¹ˆç»„åˆèµ·æ¥è§£å†³äº†è¿™ä¸ªé—®é¢˜.æ­¤æ—¶å¯ä»¥å€ŸåŠ©æ—¶åºå›¾,æµç¨‹å›¾ç­‰å·¥å…·.åŠ æ·±ç†è§£.","like_count":1},{"had_liked":false,"id":388682,"user_name":"ææ¸…æ³‰ğŸ»","can_delete":false,"product_type":"c1","uid":2840236,"ip_address":"å¹¿ä¸œ","ucode":"376F9F294307E2","user_header":"https://static001.geekbang.org/account/avatar/00/2b/56/ac/a047a944.jpg","comment_is_top":false,"comment_ctime":1710677740,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100104501,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œbpfå¯¹æ€§èƒ½è¦æ±‚è¿™ä¹ˆæ˜¯ï¼Œæ€ä¹ˆä¼šç”¨pythonå†™å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":377531,"user_name":"Sudouble","can_delete":false,"product_type":"c1","uid":1365574,"ip_address":"åŒ—äº¬","ucode":"B369B09DAF8D20","user_header":"https://static001.geekbang.org/account/avatar/00/14/d6/46/5eb5261b.jpg","comment_is_top":false,"comment_ctime":1688649794,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100104501,"comment_content":"å¯¹äºé—®é¢˜1ï¼šä¸»è¦æ›´å¤šçš„ä»æŠ€æœ¯æ¶æ„ã€æŠ€æœ¯ç‰¹ç‚¹ã€è§£å†³çš„ä¸šåŠ¡éš¾é¢˜ç­‰è§’åº¦ï¼Œå…ˆæœ‰ä¸€ä¸ªæ€»ä½“çš„æ¦‚è§ˆã€‚ä¹‹åå†é€æ­¥æ·±å…¥ï¼Œçœ‹æ›´å¤šçš„ç»†èŠ‚ï¼Œé¿å…ä¸€å¤´æ‰è¿›ç»†èŠ‚çš„æµ·æ´‹ä¸­ã€‚","like_count":0},{"had_liked":false,"id":376832,"user_name":"æœ‰è¯†ä¹‹å£«","can_delete":false,"product_type":"c1","uid":1120024,"ip_address":"åŒ—äº¬","ucode":"23F5594193D200","user_header":"https://static001.geekbang.org/account/avatar/00/11/17/18/e4382a8e.jpg","comment_is_top":false,"comment_ctime":1687521653,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100104501,"comment_content":"root@instance-00qqerhq:~&#47;jike# sudo strace -v -f .&#47;hello.py\nexecve(&quot;.&#47;hello.py&quot;, [&quot;.&#47;hello.py&quot;], [&quot;LANGUAGE=en_US:&quot;, &quot;LANG=en_US.UTF-8&quot;, &quot;LS_COLORS=rs=0:di=01;34:ln=01;36&quot;..., &quot;TERM=xterm-256color&quot;, &quot;PATH=&#47;usr&#47;local&#47;sbin:&#47;usr&#47;local&#47;&quot;..., &quot;MAIL=&#47;var&#47;mail&#47;root&quot;, &quot;LOGNAME=root&quot;, &quot;USER=root&quot;, &quot;HOME=&#47;root&quot;, &quot;SHELL=&#47;bin&#47;bash&quot;, &quot;SUDO_COMMAND=&#47;usr&#47;bin&#47;strace -v &quot;..., &quot;SUDO_USER=root&quot;, &quot;SUDO_UID=0&quot;, &quot;SUDO_GID=0&quot;]) = -1 EACCES (Permission denied)\nstrace: exec: Permission denied\n+++ exited with 1 +++\n\nå¦‚æœæŠ¥ä¸Šè¿°é”™è¯¯ï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š chmod +x hello.py","like_count":0},{"had_liked":false,"id":361392,"user_name":"Geek_5ada4a","can_delete":false,"product_type":"c1","uid":2228781,"ip_address":"å¹¿ä¸œ","ucode":"C1532F4A4AAC9A","user_header":"","comment_is_top":false,"comment_ctime":1667461796,"is_pvip":false,"replies":null,"discussion_count":3,"race_medal":0,"score":4,"product_id":100104501,"comment_content":"strace .&#47;hello.py\nexecve(&quot;.&#47;hello.py&quot;, [&quot;.&#47;hello.py&quot;], 0x7ffed513d760 &#47;* 30 vars *&#47;) = -1 EACCES (Permission denied)\nstrace: exec: Permission denied\n+++ exited with 1 +++\n\nå“ªä½å¤§ä½¬å¸®å¿™çœ‹çœ‹ï¼Œæ˜¯ root ç”¨æˆ·ï¼Œls -l hello.py çš„ç»“æœæ˜¯\n-rw-r--r-- 1 root root 147 Nov  3 14:44 .&#47;hello.py","like_count":0,"discussions":[{"author":{"id":3228321,"avatar":"https://static001.geekbang.org/account/avatar/00/31/42/a1/716f3c50.jpg","nickname":"22","note":"","ucode":"CA72DF07C8C49F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":606677,"discussion_content":"æˆ‘ä¸€å¼€å§‹ä¹Ÿæ˜¯ä½ è¿™æ ·çš„é—®é¢˜ï¼Œåé¢ç”¨æ¥¼ä¸Šçš„æ–¹æ³•ä¹‹åï¼Œæˆäº†å¯æ‰§è¡Œæ–‡ä»¶æ ¼å¼é”™è¯¯ã€‚\nç›®å‰è¿˜ä¸çŸ¥é“è¯¥æ€ä¹ˆè§£å†³\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677294677,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ±Ÿè‹","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ec/0e/d64d4663.jpg","nickname":"k8svip","note":"","ucode":"89F02243735432","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":601620,"discussion_content":"[root@iZbp1dpl8hfbkhmrjga5yfZ ebpf]# ll\ntotal 24\n-rw-r--r-- 1 root root 102 Feb  2 15:25 example.c\n-rwxrwxrwx 1 root root 110 Feb  2 15:26 example.py\n-rwxrwxrwx 1 root root 725 Feb  2 14:42 hello2.py\n-rw-r--r-- 1 root root  84 Feb  2 14:26 hello.c\n-rwxrwxrwx 1 root root 274 Feb  2 14:27 hello.py\n-rw-r--r-- 1 root root 754 Feb  2 14:41 trace-open.c\n[root@iZbp1dpl8hfbkhmrjga5yfZ ebpf]# strace -v -f -ebpf ./hello.py\nstrace: exec: Exec format error\n+++ exited with 1 +++\n[root@iZbp1dpl8hfbkhmrjga5yfZ ebpf]#\n\næˆ‘è¿™æ˜¯è¿™æ ·ï¼Œæ€ä¹ˆå›äº‹å‘¢ã€‚ä¸æ˜¯å¾ˆäº†è§£ã€‚\næ¥¼ä¸»è§£å†³äº†å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675322971,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1447129,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJibvQ9Dpib9EbBy6WCicjqTwGQ9CucFrYFHclCqAfp4ohNX4a7iagBibd8QoWygsB6IKELrjZ5nvJtktg/132","nickname":"Geek_1e4754","note":"","ucode":"996925D5E52A8B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":595033,"discussion_content":"chmod 777 hello.py","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1669651962,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361143,"user_name":"Geek_5ada4a","can_delete":false,"product_type":"c1","uid":2228781,"ip_address":"å¹¿ä¸œ","ucode":"C1532F4A4AAC9A","user_header":"","comment_is_top":false,"comment_ctime":1667272014,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100104501,"comment_content":"openat(AT_FDCWD, &quot;&#47;sys&#47;bus&#47;event_source&#47;devices&#47;kprobe&#47;type&quot;, O_RDONLY) = 5\nread(5, &quot;6\\n&quot;, 4096) = 2\nclose(5) = 0\n\nä¸ºä»€ä¹ˆä¸‹é¢çš„ type = 0x6 ï¼Œå¯¹ä¸ä¸Šè¯¶\nå¦å¤–è¿™ä¸ª read ä½œç”¨æ˜¯ï¼Ÿ\n\n","like_count":0},{"had_liked":false,"id":357847,"user_name":"Geek_ee7838","can_delete":false,"product_type":"c1","uid":3182525,"ip_address":"æµ™æ±Ÿ","ucode":"49EED93124B501","user_header":"","comment_is_top":false,"comment_ctime":1663679322,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":4,"product_id":100104501,"comment_content":"root@iZbp18xpd2ia89yqcrhi48Z:~&#47;eBPF# ll\ntotal 24\ndrwxr-xr-x 2 root root 4096 Sep 20 20:03 .&#47;\ndrwx------ 8 root root 4096 Sep 20 20:49 ..&#47;\n-rw-r--r-- 1 root root   85 Sep 20 19:14 hello.c\n-rwxr-xr-x 1 root root  274 Sep 20 19:18 hello.py*\n-rw-r--r-- 1 root root  753 Sep 20 20:03 trace-open.c\n-rw-r--r-- 1 root root  725 Sep 20 20:02 trace-open.py\nroot@iZbp18xpd2ia89yqcrhi48Z:~&#47;eBPF# sudo strace -v -f -ebpf .&#47;hello.py\nstrace: exec: Exec format error\n+++ exited with 1 +++\nä¸ºä»€ä¹ˆæˆ‘çš„straceè·Ÿè¸ªä¸äº†ebpfæ•°æ®åŒ…ï¼Œstraceç‰ˆæœ¬æ˜¯5.16çš„ï¼Œæˆ‘æŸ¥çœ‹å‘½ä»¤å¸®åŠ©ä¼¼ä¹å¹¶æ²¡æœ‰-ebpfçš„å‘½ä»¤å‚æ•°","like_count":0,"discussions":[{"author":{"id":1769504,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJGXndj5N66z9BL1ic9GibZzWWgoVeWaWTL2XUnCYic7iba2kAEvN9WfjmlXELD5lqt8IJ1P023N5ZWicg/132","nickname":"Geek_f93234","note":"","ucode":"1E5DC903A5429E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":610349,"discussion_content":"hello.py ç¬¬1è¡Œæ·»åŠ python3ç¯å¢ƒå˜é‡ #!/usr/bin/env python3\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679538849,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354527,"user_name":"MoGeJiErğŸ”","can_delete":false,"product_type":"c1","uid":1882960,"ip_address":"æ±Ÿè‹","ucode":"B7F0477730F294","user_header":"https://static001.geekbang.org/account/avatar/00/1c/bb/50/c8ebd5e1.jpg","comment_is_top":false,"comment_ctime":1660487519,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100104501,"comment_content":"â€œR1-R5å¯„å­˜å™¨ç”¨äºå‡½æ•°è°ƒç”¨çš„å‚æ•°ï¼Œå› æ­¤è¿™é‡Œçš„å‡½æ•°è°ƒç”¨å‚æ•°ä¸èƒ½è¶…è¿‡5ä¸ªâ€æ˜¯æŒ‡bpf-helperå‡½æ•°çš„å‚æ•°ä¸èƒ½è¶…è¿‡5ä¸ªå˜›ï¼Ÿ","like_count":0},{"had_liked":false,"id":352476,"user_name":"magina","can_delete":false,"product_type":"c1","uid":1138499,"ip_address":"","ucode":"9546701896A09F","user_header":"https://static001.geekbang.org/account/avatar/00/11/5f/43/3799a0f3.jpg","comment_is_top":false,"comment_ctime":1658720049,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100104501,"comment_content":"eBPF è¿è¡Œæ—¶å›¾ä¸­ï¼Œä¸æ”¯æŒJITæ˜¯ä»€ä¹ˆè¿‡ç¨‹å‘¢ï¼Ÿæ–‡ä¸­ä¹Ÿæ²¡æœ‰æä»€ä¹ˆæƒ…å†µä¸‹èµ°JITï¼Œä»€ä¹ˆæƒ…å†µä¸èµ°JITï¼Ÿ","like_count":0},{"had_liked":false,"id":352283,"user_name":"æœ‰è¯†ä¹‹å£«","can_delete":false,"product_type":"c1","uid":1120024,"ip_address":"","ucode":"23F5594193D200","user_header":"https://static001.geekbang.org/account/avatar/00/11/17/18/e4382a8e.jpg","comment_is_top":false,"comment_ctime":1658499324,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100104501,"comment_content":"æˆ‘çš„æŠ¥é”™\n\nroot@3358d0bf1a7b:~# bpftool prog list\nWARNING: bpftool not found for kernel 5.10.25\n\n  You may need to install the following packages for this specific kernel:\n    linux-tools-5.10.25-linuxkit\n    linux-cloud-tools-5.10.25-linuxkit\n\n  You may also want to install one of the following packages to keep up to date:\n    linux-tools-linuxkit\n    linux-cloud-tools-linuxkit\n\nroot@3358d0bf1a7b:~# bpftool\nWARNING: bpftool not found for kernel 5.10.25\n\n  You may need to install the following packages for this specific kernel:\n    linux-tools-5.10.25-linuxkit\n    linux-cloud-tools-5.10.25-linuxkit\n\n  You may also want to install one of the following packages to keep up to date:\n    linux-tools-linuxkit\n    linux-cloud-tools-linuxkit","like_count":0},{"had_liked":false,"id":352281,"user_name":"æœ‰è¯†ä¹‹å£«","can_delete":false,"product_type":"c1","uid":1120024,"ip_address":"","ucode":"23F5594193D200","user_header":"https://static001.geekbang.org/account/avatar/00/11/17/18/e4382a8e.jpg","comment_is_top":false,"comment_ctime":1658495876,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":4,"product_id":100104501,"comment_content":"è¯·æ•™é€‰ï¼Œè¿™ä¸ªebpf è™šæ‹ŸæœºåŠŸèƒ½ç±»ä¼¼  java jvm ç¼–è¯‘æˆclass å­—èŠ‚ç ï¼Ÿè¿˜æ˜¯æœ‰å¾ˆå¤§çš„ä¸åŒç‚¹ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1494491,"avatar":"https://static001.geekbang.org/account/avatar/00/16/cd/db/7467ad23.jpg","nickname":"Bachue Zhou","note":"","ucode":"3175754775CA32","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":611656,"discussion_content":"æˆ‘è§‰å¾—åŒºåˆ«ä¸å¤§ï¼Œåªæ˜¯ jvm è·‘åœ¨ç”¨æˆ·æ€ï¼Œebpf è·‘åœ¨å†…æ ¸æ€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680225314,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":344981,"user_name":"cmz","can_delete":false,"product_type":"c1","uid":2622586,"ip_address":"","ucode":"33658440075507","user_header":"https://static001.geekbang.org/account/avatar/00/28/04/7a/1306bf9c.jpg","comment_is_top":false,"comment_ctime":1651911599,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":4,"product_id":100104501,"comment_content":"ebpfä¸ºä»€ä¹ˆè¦è®¾è®¡æˆè™šæ‹Ÿæœºçš„å½¢å¼","like_count":0,"discussions":[{"author":{"id":1494491,"avatar":"https://static001.geekbang.org/account/avatar/00/16/cd/db/7467ad23.jpg","nickname":"Bachue Zhou","note":"","ucode":"3175754775CA32","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":611657,"discussion_content":"ä»£ç åœ¨å†…æ ¸ä¸­æ‰§è¡Œï¼Œä¸ºäº†ä¿è¯å†…æ ¸çš„å®‰å…¨ï¼Œè™šæ‹Ÿæœºå†…æ‰§è¡Œçš„æŒ‡ä»¤å¿…é¡»æœ‰ç›¸åº”çš„é™åˆ¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680225379,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":344980,"user_name":"cmz","can_delete":false,"product_type":"c1","uid":2622586,"ip_address":"","ucode":"33658440075507","user_header":"https://static001.geekbang.org/account/avatar/00/28/04/7a/1306bf9c.jpg","comment_is_top":false,"comment_ctime":1651911280,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":4,"product_id":100104501,"comment_content":"å†…æ ¸äº‹ä»¶è§¦å‘åï¼Œå³æ—¶ç¼–è¯‘å™¨æ‰ä¼šæŠŠbpfæŒ‡ä»¤ç¼–è¯‘æˆæœºå™¨æŒ‡ä»¤å—ï¼Œè¿˜æ˜¯è¯´åŠ è½½åˆ°å†…æ ¸æ—¶å€™å°±ç¼–è¯‘äº†ï¼Ÿ","like_count":0},{"had_liked":false,"id":341890,"user_name":"ç¨‹åºå‘˜ç­å‰","can_delete":false,"product_type":"c1","uid":1478098,"ip_address":"","ucode":"BD48CF7649609A","user_header":"https://static001.geekbang.org/account/avatar/00/16/8d/d2/498cd2d1.jpg","comment_is_top":false,"comment_ctime":1649903945,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":5,"product_id":100104501,"comment_content":"çŒœæµ‹ï¼Œbpfå­—èŠ‚ç åº”è¯¥æ˜¯åŠ¨æ€é“¾æ¥ã€‚\n","like_count":0}]}