{"id":101288,"title":"18 | metaclassï¼Œæ˜¯æ½˜å¤šæ‹‰é­”ç›’è¿˜æ˜¯é˜¿æ‹‰ä¸ç¥ç¯ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯è”¡å…ƒæ¥ ï¼Œæå®¢æ—¶é—´ã€Šå¤§è§„æ¨¡æ•°æ®å¤„ç†å®æˆ˜ã€‹ä¸“æ çš„ä½œè€…ã€‚ä»Šå¤©æˆ‘æƒ³å’Œä½ åˆ†äº«çš„ä¸»é¢˜æ˜¯ï¼šmetaclassï¼Œæ˜¯æ½˜å¤šæ‹‰é­”ç›’è¿˜æ˜¯é˜¿æ‹‰ä¸ç¥ç¯ï¼Ÿ</p><p>Pythonä¸­æœ‰å¾ˆå¤šé»‘é­”æ³•ï¼Œæ¯”å¦‚ä»Šå¤©æˆ‘å°†åˆ†äº«çš„metaclassã€‚æˆ‘è®¤è¯†è®¸å¤šäººï¼Œå¯¹äºè¿™äº›è¯­è¨€ç‰¹æ€§æœ‰ä¸¤ç§æç«¯çš„è§‚ç‚¹ã€‚</p><ul>\n<li>ä¸€ç§äººè§‰å¾—è¿™äº›è¯­è¨€ç‰¹æ€§å¤ªç‰›é€¼äº†ï¼Œç®€ç›´æ˜¯æ— æ‰€ä¸èƒ½çš„é˜¿æ‹‰ä¸ç¥ç¯ï¼Œå¿…é¡»æ‰¾æœºä¼šç”¨ä¸Šæ‰èƒ½æ˜¾ç¤ºè‡ªå·±çš„Pythonå®åŠ›ã€‚</li>\n<li>å¦ä¸€ç§è§‚ç‚¹åˆ™æ˜¯è®¤ä¸ºè¿™äº›è¯­è¨€ç‰¹æ€§å¤ªå±é™©äº†ï¼Œä¼šè›Šæƒ‘äººå¿ƒå»æ»¥ç”¨ï¼Œä¸€æ—¦æ‰“å¼€å°±ä¼šé‡Šæ”¾â€œæ¶é­”â€ï¼Œè®©æ•´ä¸ªä»£ç åº“å˜å¾—éš¾ä»¥ç»´æŠ¤ã€‚</li>\n</ul><p>å…¶å®è¿™ä¸¤ç§çœ‹æ³•éƒ½æœ‰é“ç†ï¼Œå´åˆéƒ½æµ…å°è¾„æ­¢ã€‚ä»Šå¤©ï¼Œæˆ‘å°±å¸¦ä½ æ¥çœ‹çœ‹ï¼Œmetaclassåˆ°åº•æ˜¯æ½˜å¤šæ‹‰é­”ç›’è¿˜æ˜¯é˜¿æ‹‰ä¸ç¥ç¯ï¼Ÿ</p><p>å¸‚é¢ä¸Šçš„å¾ˆå¤šä¸­æ–‡ä¹¦ï¼Œéƒ½æŠŠmetaclassè¯‘ä¸ºâ€œå…ƒç±»â€ã€‚æˆ‘ä¸€ç›´è®¤ä¸ºè¿™ä¸ªç¿»è¯‘å¾ˆç³Ÿç³•ï¼Œæ‰€ä»¥ä¹Ÿä¸æƒ³åœ¨è¿™é‡Œç§°metaclassä¸ºå…ƒç±»ã€‚å› ä¸ºå¦‚æœä»…ä»å­—é¢ç†è§£ï¼Œâ€œå…ƒâ€æ˜¯â€œæœ¬æºâ€â€œåŸºæœ¬â€çš„æ„æ€ï¼Œâ€œå…ƒç±»â€ä¼šè®©äººä»¥ä¸ºæ˜¯â€œåŸºæœ¬ç±»â€ã€‚éš¾é“Pythonçš„metaclassï¼ŒæŒ‡çš„æ˜¯Python 2çš„Objectå—ï¼Ÿè¿™å°±è®©äººä¸€å¤´é›¾æ°´äº†ã€‚</p><p>äº‹å®ä¸Šï¼Œmeta-classçš„metaè¿™ä¸ªè¯æ ¹ï¼Œèµ·æºäºå¸Œè…Šè¯­è¯æ±‡metaï¼ŒåŒ…å«ä¸‹é¢ä¸¤ç§æ„æ€ï¼š</p><ol>\n<li>â€œBeyondâ€ï¼Œä¾‹å¦‚æŠ€æœ¯è¯æ±‡metadataï¼Œæ„æ€æ˜¯æè¿°æ•°æ®çš„è¶…è¶Šæ•°æ®ï¼›</li>\n<li>â€œChangeâ€ï¼Œä¾‹å¦‚æŠ€æœ¯è¯æ±‡metamorphosisï¼Œæ„æ€æ˜¯æ”¹å˜çš„å½¢æ€ã€‚</li>\n</ol><!-- [[[read_end]]] --><p>metaclassï¼Œä¸€å¦‚å…¶åï¼Œå®é™…ä¸ŠåŒæ—¶åŒ…å«äº†â€œè¶…è¶Šç±»â€å’Œâ€œå˜å½¢ç±»â€çš„å«ä¹‰ï¼Œå®Œå…¨ä¸æ˜¯â€œåŸºæœ¬ç±»â€çš„æ„æ€ã€‚æ‰€ä»¥ï¼Œè¦æ·±å…¥ç†è§£metaclassï¼Œæˆ‘ä»¬å°±è¦å›´ç»•å®ƒçš„<strong>è¶…è¶Šå˜å½¢</strong>ç‰¹æ€§ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°†ä¸ºä½ å±•å¼€metaclassçš„è¶…è¶Šå˜å½¢èƒ½åŠ›ï¼Œè®²æ¸…æ¥šmetaclassç©¶ç«Ÿæœ‰ä»€ä¹ˆç”¨ï¼Ÿæ€ä¹ˆåº”ç”¨ï¼ŸPythonè¯­è¨€è®¾è®¡å±‚é¢æ˜¯å¦‚ä½•å®ç°metaclassçš„ ï¼Ÿä»¥åŠä½¿ç”¨metaclassçš„é£é™©ã€‚</p><h2>metaclassçš„è¶…è¶Šå˜å½¢ç‰¹æ€§æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</h2><p><a href=\"https://pyyaml.org/wiki/PyYAMLDocumentation\">YAML</a>æ˜¯ä¸€ä¸ªå®¶å–»æˆ·æ™“çš„Pythonå·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿åœ°åºåˆ—åŒ–/é€†åºåˆ—åŒ–ç»“æ„æ•°æ®ã€‚YAMLObjectçš„ä¸€ä¸ª<strong>è¶…è¶Šå˜å½¢èƒ½åŠ›</strong>ï¼Œå°±æ˜¯å®ƒçš„ä»»æ„å­ç±»æ”¯æŒåºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼ˆserialization &amp; deserializationï¼‰ã€‚æ¯”å¦‚è¯´ä¸‹é¢è¿™æ®µä»£ç ï¼š</p><pre><code>class Monster(yaml.YAMLObject):\n  yaml_tag = u'!Monster'\n  def __init__(self, name, hp, ac, attacks):\n    self.name = name\n    self.hp = hp\n    self.ac = ac\n    self.attacks = attacks\n  def __repr__(self):\n    return &quot;%s(name=%r, hp=%r, ac=%r, attacks=%r)&quot; % (\n       self.__class__.__name__, self.name, self.hp, self.ac,      \n       self.attacks)\n\nyaml.load(&quot;&quot;&quot;\n--- !Monster\nname: Cave spider\nhp: [2,6]    # 2d6\nac: 16\nattacks: [BITE, HURT]\n&quot;&quot;&quot;)\n\nMonster(name='Cave spider', hp=[2, 6], ac=16, attacks=['BITE', 'HURT'])\n\nprint yaml.dump(Monster(\n    name='Cave lizard', hp=[3,6], ac=16, attacks=['BITE','HURT']))\n\n# è¾“å‡º\n!Monster\nac: 16\nattacks: [BITE, HURT]\nhp: [3, 6]\nname: Cave lizard\n</code></pre><p>è¿™é‡ŒYAMLObjectçš„ç‰¹å¼‚åŠŸèƒ½ä½“ç°åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p><p>ä½ çœ‹ï¼Œè°ƒç”¨ç»Ÿä¸€çš„yaml.load()ï¼Œå°±èƒ½æŠŠä»»æ„ä¸€ä¸ªyamlåºåˆ—è½½å…¥æˆä¸€ä¸ªPython Objectï¼›è€Œè°ƒç”¨ç»Ÿä¸€çš„yaml.dump()ï¼Œå°±èƒ½æŠŠä¸€ä¸ªYAMLObjectå­ç±»åºåˆ—åŒ–ã€‚å¯¹äºload()å’Œdump()çš„ä½¿ç”¨è€…æ¥è¯´ï¼Œä»–ä»¬å®Œå…¨ä¸éœ€è¦æå‰çŸ¥é“ä»»ä½•ç±»å‹ä¿¡æ¯ï¼Œè¿™è®©è¶…åŠ¨æ€é…ç½®ç¼–ç¨‹æˆäº†å¯èƒ½ã€‚åœ¨æˆ‘çš„å®æˆ˜ç»éªŒä¸­ï¼Œè®¸å¤šå¤§å‹é¡¹ç›®éƒ½éœ€è¦åº”ç”¨è¿™ç§è¶…åŠ¨æ€é…ç½®çš„ç†å¿µã€‚</p><p>æ¯”æ–¹è¯´ï¼Œåœ¨ä¸€ä¸ªæ™ºèƒ½è¯­éŸ³åŠ©æ‰‹çš„å¤§å‹é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬æœ‰1ä¸‡ä¸ªè¯­éŸ³å¯¹è¯åœºæ™¯ï¼Œæ¯ä¸€ä¸ªåœºæ™¯éƒ½æ˜¯ä¸åŒå›¢é˜Ÿå¼€å‘çš„ã€‚ä½œä¸ºæ™ºèƒ½è¯­éŸ³åŠ©æ‰‹çš„æ ¸å¿ƒå›¢é˜Ÿæˆå‘˜ï¼Œæˆ‘ä¸å¯èƒ½å»äº†è§£æ¯ä¸ªå­åœºæ™¯çš„å®ç°ç»†èŠ‚ã€‚</p><p>åœ¨åŠ¨æ€é…ç½®å®éªŒä¸åŒåœºæ™¯æ—¶ï¼Œç»å¸¸æ˜¯ä»Šå¤©æˆ‘è¦å®éªŒåœºæ™¯Aå’ŒBçš„é…ç½®ï¼Œæ˜å¤©å®éªŒBå’ŒCçš„é…ç½®ï¼Œå…‰é…ç½®æ–‡ä»¶å°±æœ‰å‡ ä¸‡è¡Œé‡çº§ï¼Œå·¥ä½œé‡çœŸæ˜¯ä¸å°ã€‚è€Œåº”ç”¨è¿™æ ·çš„åŠ¨æ€é…ç½®ç†å¿µï¼Œæˆ‘å°±å¯ä»¥è®©å¼•æ“æ ¹æ®æˆ‘çš„æ–‡æœ¬é…ç½®æ–‡ä»¶ï¼ŒåŠ¨æ€åŠ è½½æ‰€éœ€è¦çš„Pythonç±»ã€‚</p><p>å¯¹äºYAMLçš„ä½¿ç”¨è€…ï¼Œè¿™ä¸€ç‚¹ä¹Ÿå¾ˆæ–¹ä¾¿ï¼Œä½ åªè¦ç®€å•åœ°ç»§æ‰¿yaml.YAMLObjectï¼Œå°±èƒ½è®©ä½ çš„Python Objectå…·æœ‰åºåˆ—åŒ–å’Œé€†åºåˆ—åŒ–èƒ½åŠ›ã€‚æ˜¯ä¸æ˜¯ç›¸æ¯”æ™®é€šPythonç±»ï¼Œæœ‰ä¸€ç‚¹â€œå˜æ€â€ï¼Œæœ‰ä¸€ç‚¹â€œè¶…è¶Šâ€ï¼Ÿ</p><p>äº‹å®ä¸Šï¼Œæˆ‘åœ¨Googleè§è¿‡å¾ˆå¤šPythonå¼€å‘è€…ï¼Œå‘ç°èƒ½æ·±å…¥è§£é‡ŠYAMLè¿™ç§è®¾è®¡æ¨¡å¼ä¼˜ç‚¹çš„äººï¼Œå¤§æ¦‚åªæœ‰10%ã€‚è€Œèƒ½çŸ¥é“ç±»ä¼¼YAMLçš„è¿™ç§åŠ¨æ€åºåˆ—åŒ–/é€†åºåˆ—åŒ–åŠŸèƒ½æ­£æ˜¯ç”¨metaclasså®ç°çš„äººï¼Œæ›´æ˜¯å‡¤æ¯›éºŸè§’ï¼Œå¯èƒ½åªæœ‰1%äº†ã€‚</p><h2>metaclassçš„è¶…è¶Šå˜å½¢ç‰¹æ€§æ€ä¹ˆç”¨ï¼Ÿ</h2><p>åˆšåˆšæåˆ°ï¼Œä¼°è®¡åªæœ‰1%çš„Pythonå¼€å‘è€…ï¼ŒçŸ¥é“YAMLçš„åŠ¨æ€åºåˆ—åŒ–/é€†åºåˆ—åŒ–æ˜¯ç”±metaclasså®ç°çš„ã€‚å¦‚æœä½ è¿½é—®ï¼ŒYAMLæ€æ ·ç”¨metaclasså®ç°åŠ¨æ€åºåˆ—åŒ–/é€†åºåˆ—åŒ–åŠŸèƒ½ï¼Œå¯èƒ½åªæœ‰0.1%çš„äººèƒ½è¯´å¾—å‡ºä¸€äºŒäº†ã€‚</p><p>å› ä¸ºç¯‡å¹…åŸå› ï¼Œæˆ‘ä»¬è¿™é‡Œåªçœ‹YAMLObjectçš„load()åŠŸèƒ½ã€‚ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå…¨å±€çš„æ³¨å†Œå™¨ï¼Œè®©YAMLçŸ¥é“ï¼Œåºåˆ—åŒ–æ–‡æœ¬ä¸­çš„ <code>!Monster</code> éœ€è¦è½½å…¥æˆ Monsterè¿™ä¸ªPythonç±»å‹ã€‚</p><p>ä¸€ä¸ªå¾ˆè‡ªç„¶çš„æƒ³æ³•å°±æ˜¯ï¼Œé‚£æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªå…¨å±€å˜é‡å« registryï¼ŒæŠŠæ‰€æœ‰éœ€è¦é€†åºåˆ—åŒ–çš„YAMLObjectï¼Œéƒ½æ³¨å†Œè¿›å»ã€‚æ¯”å¦‚ä¸‹é¢è¿™æ ·ï¼š</p><pre><code>registry = {}\n\ndef add_constructor(target_class):\n    registry[target_class.yaml_tag] = target_class\n</code></pre><p>ç„¶åï¼Œåœ¨Monster ç±»å®šä¹‰åé¢åŠ ä¸Šä¸‹é¢è¿™è¡Œä»£ç ï¼š</p><pre><code>add_constructor(Monster)\n</code></pre><p>ä½†è¿™æ ·çš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå¯¹äºYAMLçš„ä½¿ç”¨è€…æ¥è¯´ï¼Œæ¯ä¸€ä¸ªYAMLçš„å¯é€†åºåˆ—åŒ–çš„ç±»Fooå®šä¹‰åï¼Œéƒ½éœ€è¦åŠ ä¸Šä¸€å¥è¯ï¼Œ<code>add_constructor(Foo)</code>ã€‚è¿™æ— ç–‘ç»™å¼€å‘è€…å¢åŠ äº†éº»çƒ¦ï¼Œä¹Ÿæ›´å®¹æ˜“å‡ºé”™ï¼Œæ¯•ç«Ÿå¼€å‘è€…å¾ˆå®¹æ˜“å¿˜äº†è¿™ä¸€ç‚¹ã€‚</p><p>é‚£ä¹ˆï¼Œæ›´ä¼˜çš„å®ç°æ–¹å¼æ˜¯ä»€ä¹ˆæ ·å‘¢ï¼Ÿå¦‚æœä½ çœ‹è¿‡YAMLçš„æºç ï¼Œå°±ä¼šå‘ç°ï¼Œæ­£æ˜¯metaclassè§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p><pre><code># Python 2/3 ç›¸åŒéƒ¨åˆ†\nclass YAMLObjectMetaclass(type):\n  def __init__(cls, name, bases, kwds):\n    super(YAMLObjectMetaclass, cls).__init__(name, bases, kwds)\n    if 'yaml_tag' in kwds and kwds['yaml_tag'] is not None:\n      cls.yaml_loader.add_constructor(cls.yaml_tag, cls.from_yaml)\n  # çœç•¥å…¶ä½™å®šä¹‰\n\n# Python 3\nclass YAMLObject(metaclass=YAMLObjectMetaclass):\n  yaml_loader = Loader\n  # çœç•¥å…¶ä½™å®šä¹‰\n\n# Python 2\nclass YAMLObject(object):\n  __metaclass__ = YAMLObjectMetaclass\n  yaml_loader = Loader\n  # çœç•¥å…¶ä½™å®šä¹‰\n</code></pre><p>ä½ å¯ä»¥å‘ç°ï¼ŒYAMLObjectæŠŠmetaclasséƒ½å£°æ˜æˆäº†YAMLObjectMetaclassï¼Œå°½ç®¡å£°æ˜æ–¹å¼åœ¨Python 2 å’Œ3ä¸­ç•¥æœ‰ä¸åŒã€‚åœ¨YAMLObjectMetaclassä¸­ï¼Œ ä¸‹é¢è¿™è¡Œä»£ç å°±æ˜¯é­”æ³•å‘ç”Ÿçš„åœ°æ–¹ï¼š</p><pre><code>cls.yaml_loader.add_constructor(cls.yaml_tag, cls.from_yaml) \n</code></pre><p>YAMLåº”ç”¨metaclassï¼Œæ‹¦æˆªäº†æ‰€æœ‰YAMLObjectå­ç±»çš„å®šä¹‰ã€‚ä¹Ÿå°±è¯´è¯´ï¼Œåœ¨ä½ å®šä¹‰ä»»ä½•YAMLObjectå­ç±»æ—¶ï¼ŒPythonä¼šå¼ºè¡Œæ’å…¥è¿è¡Œä¸‹é¢è¿™æ®µä»£ç ï¼ŒæŠŠæˆ‘ä»¬ä¹‹å‰æƒ³è¦çš„<code>add_constructor(Foo)</code>ç»™è‡ªåŠ¨åŠ ä¸Šã€‚</p><pre><code>cls.yaml_loader.add_constructor(cls.yaml_tag, cls.from_yaml)\n</code></pre><p>æ‰€ä»¥YAMLçš„ä½¿ç”¨è€…ï¼Œæ— éœ€è‡ªå·±å»æ‰‹å†™<code>add_constructor(Foo)</code> ã€‚æ€ä¹ˆæ ·ï¼Œæ˜¯ä¸æ˜¯å…¶å®å¹¶ä¸å¤æ‚ï¼Ÿ</p><p>çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»æŒæ¡äº†metaclassçš„ä½¿ç”¨æ–¹æ³•ï¼Œè¶…è¶Šäº†ä¸–ç•Œä¸Š99.9%çš„Pythonå¼€å‘è€…ã€‚æ›´è¿›ä¸€æ­¥ï¼Œå¦‚æœä½ èƒ½å¤Ÿæ·±å…¥ç†è§£ï¼ŒPythonçš„è¯­è¨€è®¾è®¡å±‚é¢æ˜¯æ€æ ·å®ç°metaclassçš„ï¼Œä½ å°±æ˜¯ä¸–é—´ç½•è§çš„â€œPythonå¤§å¸ˆâ€äº†ã€‚</p><h2><strong>Pythonåº•å±‚è¯­è¨€è®¾è®¡å±‚é¢æ˜¯å¦‚ä½•å®ç°metaclassçš„ï¼Ÿ</strong></h2><p>åˆšæ‰æˆ‘ä»¬æåˆ°ï¼Œmetaclassèƒ½å¤Ÿæ‹¦æˆªPythonç±»çš„å®šä¹‰ã€‚å®ƒæ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Ÿ</p><p>è¦ç†è§£metaclassçš„åº•å±‚åŸç†ï¼Œä½ éœ€è¦æ·±å…¥ç†è§£Pythonç±»å‹æ¨¡å‹ã€‚ä¸‹é¢ï¼Œæˆ‘å°†åˆ†ä¸‰ç‚¹æ¥è¯´æ˜ã€‚</p><h3>ç¬¬ä¸€ï¼Œæ‰€æœ‰çš„Pythonçš„ç”¨æˆ·å®šä¹‰ç±»ï¼Œéƒ½æ˜¯typeè¿™ä¸ªç±»çš„å®ä¾‹ã€‚</h3><p>å¯èƒ½ä¼šè®©ä½ æƒŠè®¶ï¼Œäº‹å®ä¸Šï¼Œç±»æœ¬èº«ä¸è¿‡æ˜¯ä¸€ä¸ªåä¸º type ç±»çš„å®ä¾‹ã€‚åœ¨Pythonçš„ç±»å‹ä¸–ç•Œé‡Œï¼Œtypeè¿™ä¸ªç±»å°±æ˜¯é€ ç‰©çš„ä¸Šå¸ã€‚è¿™å¯ä»¥åœ¨ä»£ç ä¸­éªŒè¯ï¼š</p><pre><code># Python 3å’ŒPython 2ç±»ä¼¼\nclass MyClass:\n  pass\n\ninstance = MyClass()\n\ntype(instance)\n# è¾“å‡º\n&lt;class '__main__.C'&gt;\n\ntype(MyClass)\n# è¾“å‡º\n&lt;class 'type'&gt;\n</code></pre><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œinstanceæ˜¯MyClassçš„å®ä¾‹ï¼Œè€ŒMyClassä¸è¿‡æ˜¯â€œä¸Šå¸â€typeçš„å®ä¾‹ã€‚</p><h3>ç¬¬äºŒï¼Œç”¨æˆ·è‡ªå®šä¹‰ç±»ï¼Œåªä¸è¿‡æ˜¯typeç±»çš„<code>__call__</code>è¿ç®—ç¬¦é‡è½½ã€‚</h3><p>å½“æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç±»çš„è¯­å¥ç»“æŸæ—¶ï¼ŒçœŸæ­£å‘ç”Ÿçš„æƒ…å†µï¼Œæ˜¯Pythonè°ƒç”¨typeçš„<code>__call__</code>è¿ç®—ç¬¦ã€‚ç®€å•æ¥è¯´ï¼Œå½“ä½ å®šä¹‰ä¸€ä¸ªç±»æ—¶ï¼Œå†™æˆä¸‹é¢è¿™æ ·æ—¶ï¼š</p><pre><code>class MyClass:\n  data = 1\n</code></pre><p>PythonçœŸæ­£æ‰§è¡Œçš„æ˜¯ä¸‹é¢è¿™æ®µä»£ç ï¼š</p><pre><code>class = type(classname, superclasses, attributedict)\n</code></pre><p>è¿™é‡Œç­‰å·å³è¾¹çš„<code>type(classname, superclasses, attributedict)</code>ï¼Œå°±æ˜¯typeçš„<code>__call__</code>è¿ç®—ç¬¦é‡è½½ï¼Œå®ƒä¼šè¿›ä¸€æ­¥è°ƒç”¨ï¼š</p><pre><code>type.__new__(typeclass, classname, superclasses, attributedict)\ntype.__init__(class, classname, superclasses, attributedict)\n</code></pre><p>å½“ç„¶ï¼Œè¿™ä¸€åˆ‡éƒ½å¯ä»¥é€šè¿‡ä»£ç éªŒè¯ï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ®µä»£ç ç¤ºä¾‹ï¼š</p><pre><code>class MyClass:\n  data = 1\n  \ninstance = MyClass()\nMyClass, instance\n# è¾“å‡º\n(__main__.MyClass, &lt;__main__.MyClass instance at 0x7fe4f0b00ab8&gt;)\ninstance.data\n# è¾“å‡º\n1\n\nMyClass = type('MyClass', (), {'data': 1})\ninstance = MyClass()\nMyClass, instance\n# è¾“å‡º\n(__main__.MyClass, &lt;__main__.MyClass at 0x7fe4f0aea5d0&gt;)\n\ninstance.data\n# è¾“å‡º\n1\n</code></pre><p>ç”±æ­¤å¯è§ï¼Œæ­£å¸¸çš„MyClasså®šä¹‰ï¼Œå’Œä½ æ‰‹å·¥å»è°ƒç”¨typeè¿ç®—ç¬¦çš„ç»“æœæ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚</p><h3>ç¬¬ä¸‰ï¼Œmetaclassæ˜¯typeçš„å­ç±»ï¼Œé€šè¿‡æ›¿æ¢typeçš„<code>__call__</code>è¿ç®—ç¬¦é‡è½½æœºåˆ¶ï¼Œâ€œè¶…è¶Šå˜å½¢â€æ­£å¸¸çš„ç±»ã€‚</h3><p>å…¶å®ï¼Œç†è§£äº†ä»¥ä¸Šå‡ ç‚¹ï¼Œæˆ‘ä»¬å°±ä¼šæ˜ç™½ï¼Œæ­£æ˜¯Pythonçš„ç±»åˆ›å»ºæœºåˆ¶ï¼Œç»™äº†metaclasså¤§å±•èº«æ‰‹çš„æœºä¼šã€‚</p><p>ä¸€æ—¦ä½ æŠŠä¸€ä¸ªç±»å‹MyClassçš„metaclassè®¾ç½®æˆMyMetaï¼ŒMyClasså°±ä¸å†ç”±åŸç”Ÿçš„typeåˆ›å»ºï¼Œè€Œæ˜¯ä¼šè°ƒç”¨MyMetaçš„<code>__call__</code>è¿ç®—ç¬¦é‡è½½ã€‚</p><pre><code>class = type(classname, superclasses, attributedict) \n# å˜ä¸ºäº†\nclass = MyMeta(classname, superclasses, attributedict)\n</code></pre><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬æ‰èƒ½åœ¨ä¸Šé¢YAMLçš„ä¾‹å­ä¸­ï¼Œåˆ©ç”¨YAMLObjectMetaclassçš„<code>__init__</code>æ–¹æ³•ï¼Œä¸ºæ‰€æœ‰YAMLObjectå­ç±»å·å·æ‰§è¡Œ<code>add_constructor()</code>ã€‚</p><h2><strong>ä½¿ç”¨metaclassçš„é£é™©</strong></h2><p>å‰é¢çš„ç¯‡å¹…ï¼Œæˆ‘éƒ½æ˜¯åœ¨è®²metaclassçš„åŸç†å’Œä¼˜ç‚¹ã€‚çš„çš„ç¡®ç¡®ï¼Œåªæœ‰æ·±å…¥ç†è§£metaclassçš„æœ¬è´¨ï¼Œä½ æ‰èƒ½ç”¨å¥½metaclassã€‚è€Œä¸å¹¸çš„æ˜¯ï¼Œæ­£å¦‚æˆ‘å¼€å¤´æ‰€è¯´ï¼Œæ·±å…¥ç†è§£metaclassçš„Pythonå¼€å‘è€…ï¼Œåªå äº†0.1%ä¸åˆ°ã€‚</p><p>ä¸è¿‡ï¼Œå‡¡äº‹æœ‰åˆ©å¿…æœ‰å¼Šï¼Œå°¤å…¶æ˜¯metaclassè¿™æ ·â€œé€†å¤©â€çš„å­˜åœ¨ã€‚æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„é‚£æ ·ï¼Œmetaclassä¼š\"æ‰­æ›²å˜å½¢\"æ­£å¸¸çš„Pythonç±»å‹æ¨¡å‹ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½¿ç”¨ä¸æ…ï¼Œå¯¹äºæ•´ä¸ªä»£ç åº“é€ æˆçš„é£é™©æ˜¯ä¸å¯ä¼°é‡çš„ã€‚</p><p>æ¢å¥è¯è¯´ï¼Œmetaclassä»…ä»…æ˜¯ç»™å°éƒ¨åˆ†Pythonå¼€å‘è€…ï¼Œåœ¨å¼€å‘æ¡†æ¶å±‚é¢çš„Pythonåº“æ—¶ä½¿ç”¨çš„ã€‚è€Œåœ¨åº”ç”¨å±‚ï¼Œmetaclasså¾€å¾€ä¸æ˜¯å¾ˆå¥½çš„é€‰æ‹©ã€‚</p><p>ä¹Ÿæ­£å› ä¸ºè¿™æ ·ï¼Œæ®æˆ‘æ‰€çŸ¥ï¼Œåœ¨å¾ˆå¤šç¡…è°·ä¸€çº¿å¤§å‚ï¼Œä½¿ç”¨Python metaclasséœ€è¦ç‰¹ä¾‹ç‰¹æ‰¹ã€‚</p><h2>æ€»ç»“</h2><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬é€šè¿‡è§£è¯»YAMLçš„æºç ï¼Œå›´ç»•metaclassçš„è®¾è®¡æœ¬æ„â€œè¶…è¶Šå˜å½¢â€ï¼Œè§£æäº†metaclassçš„ä½¿ç”¨åœºæ™¯å’Œä½¿ç”¨æ–¹æ³•ã€‚æ¥ç€ï¼Œæˆ‘ä»¬åˆè¿›ä¸€æ­¥æ·±å…¥åˆ°Pythonè¯­è¨€è®¾è®¡å±‚é¢ï¼Œææ˜ç™½äº†metaclassçš„å®ç°æœºåˆ¶ã€‚</p><p>æ­£å¦‚æˆ‘å–çš„æ ‡é¢˜é‚£æ ·ï¼Œmetaclassæ˜¯Pythoné»‘é­”æ³•çº§åˆ«çš„è¯­è¨€ç‰¹æ€§ã€‚å¤©å ‚å’Œåœ°ç‹±åªæœ‰ä¸€æ­¥ä¹‹é¥ï¼Œä½ ä½¿ç”¨å¥½metaclassï¼Œå¯ä»¥å®ç°åƒYAMLé‚£æ ·ç¥å¥‡çš„ç‰¹æ€§ï¼›è€Œä½¿ç”¨ä¸å¥½ï¼Œå¯èƒ½å°±ä¼šæ‰“å¼€æ½˜å¤šæ‹‰é­”ç›’äº†ã€‚</p><p>æ‰€ä»¥ï¼Œä»Šå¤©çš„å†…å®¹ï¼Œä¸€æ–¹é¢æ˜¯å¸®åŠ©æœ‰éœ€è¦çš„åŒå­¦ï¼Œæ·±å…¥ç†è§£metaclassï¼Œæ›´å¥½åœ°æŒæ¡å’Œåº”ç”¨ï¼›å¦ä¸€æ–¹é¢ï¼Œä¹Ÿæ˜¯å¯¹åˆå­¦è€…çš„ç§‘æ™®å’Œè­¦å‘Šï¼šä¸è¦è½»æ˜“å°è¯•metaclassã€‚</p><h2>æ€è€ƒé¢˜</h2><p>å­¦å®Œäº†ä¸ŠèŠ‚è¯¾çš„Pythonè£…é¥°å™¨å’Œè¿™èŠ‚è¯¾çš„metaclassï¼Œä½ çŸ¥é“äº†ï¼Œå®ƒä»¬éƒ½èƒ½å¹²é¢„æ­£å¸¸çš„Pythonç±»å‹æœºåˆ¶ã€‚é‚£ä¹ˆï¼Œä½ è§‰å¾—è£…é¥°å™¨å’Œmetaclassæœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿæ¬¢è¿ç•™è¨€å’Œæˆ‘è®¨è®ºã€‚</p>","comments":[{"had_liked":false,"id":105137,"user_name":"å¥”è·‘çš„èœ—ç‰›","can_delete":false,"product_type":"c1","uid":1394019,"ip_address":"","ucode":"88D855ED42F134","user_header":"https://static001.geekbang.org/account/avatar/00/15/45/63/d3319b80.jpg","comment_is_top":false,"comment_ctime":1560927564,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"504072101196","product_id":100026901,"comment_content":"çœ‹ä¸æ‡‚äº† ğŸ˜„","like_count":118,"discussions":[{"author":{"id":1219179,"avatar":"https://static001.geekbang.org/account/avatar/00/12/9a/6b/e8ef2989.jpg","nickname":"äº‘èˆèˆ","note":"","ucode":"19B1597DB49819","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294561,"discussion_content":"æˆ‘éƒ½ä»¥ä¸ºæˆ‘çœ‹é”™ä¹¦äº†","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1595928402,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1922298,"avatar":"","nickname":"patience","note":"","ucode":"46BEA083F550A8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288125,"discussion_content":"è¿˜æ²¡çœ‹å®Œï¼Œä¹Ÿçœ‹ä¸æ‡‚äº†","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1593655474,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1021741,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/97/2d/8e4836f3.jpg","nickname":"Bonaparte","note":"","ucode":"27E9CEE38A30C3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369077,"discussion_content":"æˆ‘ä»¥ä¸ºè¦å¯¼å…¥ YAML","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1618922470,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2660939,"avatar":"","nickname":"Geek_76801d","note":"","ucode":"1E85D8A5475E54","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1021741,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/97/2d/8e4836f3.jpg","nickname":"Bonaparte","note":"","ucode":"27E9CEE38A30C3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568582,"discussion_content":"å“ˆå“ˆå“ˆå“ˆå“ˆ\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651162252,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":369077,"ip_address":""},"score":568582,"extra":""}]},{"author":{"id":1324970,"avatar":"https://static001.geekbang.org/account/avatar/00/14/37/aa/177d46f2.jpg","nickname":"é˜¿æ³•","note":"","ucode":"EC1928BEA0DA8B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":569879,"discussion_content":"å®Œå…¨çœ‹ä¸æ‡‚äº†å“ˆå“ˆå“ˆå“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651584868,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":105440,"user_name":"å°˜å¢¨","can_delete":false,"product_type":"c1","uid":1239472,"ip_address":"","ucode":"2B46B4E5ECDF83","user_header":"https://static001.geekbang.org/account/avatar/00/12/e9/b0/7be55531.jpg","comment_is_top":false,"comment_ctime":1561000567,"is_pvip":false,"replies":[{"id":"38221","content":"æ£’","user_name":"ä½œè€…å›å¤","comment_id":105440,"uid":"1257426","ip_address":"","utype":1,"ctime":1561046560,"user_name_real":"Yuannanè”¡å…ƒæ¥ "}],"discussion_count":9,"race_medal":0,"score":"375223155319","product_id":100026901,"comment_content":"æˆ‘å°è¯•ç€è‡ªå·±å†™äº†ä¸€ä¸ªä¾‹å­ï¼Œå‘ç°å¥½åƒæ¸…æ™°å¤šäº†ï¼Œæ²¡æœ‰çœ‹æ‡‚çš„å¤§å®¶å¯ä»¥çœ‹ä¸€ä¸‹<br>class Mymeta(type):<br>    def __init__(self, name, bases, dic):<br>        super().__init__(name, bases, dic)<br>        print(&#39;===&gt;Mymeta.__init__&#39;)<br>        print(self.__name__)<br>        print(dic)<br>        print(self.yaml_tag)<br><br>    def __new__(cls, *args, **kwargs):<br>        print(&#39;===&gt;Mymeta.__new__&#39;)<br>        print(cls.__name__)<br>        return type.__new__(cls, *args, **kwargs)<br><br>    def __call__(cls, *args, **kwargs):<br>        print(&#39;===&gt;Mymeta.__call__&#39;)<br>        obj = cls.__new__(cls)<br>        cls.__init__(cls, *args, **kwargs)<br>        return obj<br>    <br>class Foo(metaclass=Mymeta):<br>    yaml_tag = &#39;!Foo&#39;<br><br>    def __init__(self, name):<br>        print(&#39;Foo.__init__&#39;)<br>        self.name = name<br><br>    def __new__(cls, *args, **kwargs):<br>        print(&#39;Foo.__new__&#39;)<br>        return object.__new__(cls)<br><br>foo = Foo(&#39;foo&#39;)<br>æŠŠä¸Šé¢çš„ä¾‹å­è¿è¡Œå®Œä¹‹åå°±ä¼šæ˜ç™½å¾ˆå¤šäº†ï¼Œæ­£å¸¸æƒ…å†µä¸‹æˆ‘ä»¬åœ¨çˆ¶ç±»ä¸­æ˜¯ä¸èƒ½å¯¹å­ç±»çš„å±æ€§è¿›è¡Œæ“ä½œï¼Œä½†æ˜¯å…ƒç±»å¯ä»¥ã€‚æ¢ç§æ–¹å¼ç†è§£ï¼šå…ƒç±»ã€è£…é¥°å™¨ã€ç±»è£…é¥°å™¨éƒ½å¯ä»¥å½’ä¸ºå…ƒç¼–ç¨‹(å¼•ç”¨è‡ª python-cook-book ä¸­çš„ä¸€å¥è¯)ã€‚","like_count":88,"discussions":[{"author":{"id":1257426,"avatar":"https://static001.geekbang.org/account/avatar/00/13/2f/d2/0b6a8945.jpg","nickname":"Yuannanè”¡å…ƒæ¥ ","note":"","ucode":"695E183CE496A8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454685,"discussion_content":"æ£’","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561046560,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2313563,"avatar":"https://static001.geekbang.org/account/avatar/00/23/4d/5b/a435ee83.jpg","nickname":"variance","note":"","ucode":"EADB5E1697BC51","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334703,"discussion_content":"class MyMeta(type):\n    def __init__(cls, name, bases, dict):\n        super().__init__(name, bases, dict)\n        print(&#39;===>MyMeta.__init__&#39;)\n        print(cls.__name__)\n        print(bases)\n        print(dict)\n        print(cls.yaml_tag)\n\n    def __new__(mcs, *args, **kwargs):\n        print(&#39;===>MyMeta.__new__&#39;)\n        print(mcs.__name__)\n        return type.__new__(mcs, *args, **kwargs)\n\n    def __call__(cls, *args, **kwargs):\n        print(&#39;===>MyMeta.__call__&#39;)\n        obj = cls.__new__(cls)\n        cls.__init__(cls, *args, **kwargs)\n        return obj\n\n\nclass Foo(metaclass=MyMeta):\n    yaml_tag = &#39;!Foo&#39;\n\n    def __init__(self, name):\n        print(&#39;Foo.__init__&#39;)\n        self.name = name\n\n    def __new__(cls, *args, **kwargs):\n        print(&#39;Foo.__new__&#39;)\n        return object.__new__(cls)\n\n\nif __name__ == &#39;__main__&#39;:\n    foo = Foo(&#39;foo&#39;)\n\n=======è¾“å‡ºç»“æœ=======\n/usr/bin/python3.8 /home/lm/spider/search_engine/metaclass/MyMeta.py\n===>MyMeta.__new__\nMyMeta\n===>MyMeta.__init__\nFoo\n()\n{&#39;__module__&#39;: &#39;__main__&#39;, &#39;__qualname__&#39;: &#39;Foo&#39;, &#39;yaml_tag&#39;: &#39;!Foo&#39;, &#39;__init__&#39;: <function Foo.__init__ at 0x7f88f5becca0>, &#39;__new__&#39;: <function Foo.__new__ at 0x7f88f5becdc0>}\n!Foo\n===>MyMeta.__call__\nFoo.__new__\nFoo.__init__\n\nProcess finished with exit code 0\n\nmetaclassç›¸å½“äºè£…é¥°å™¨ï¼Œå½“å®ä¾‹åŒ–Fooçš„å®ä¾‹çš„æ—¶å€™ï¼Œä¼šä»è‡ªå®šä¹‰çš„typeç±»çš„__new__æ–¹æ³•å…ˆç”Ÿæˆç±»ä¼¼äº&#39;type&#39;è¿™ä¸ªç¥–å…ˆçš„&#39;æŠ½è±¡ç±»&#39;çš„å…·ä½“å­ç±»MyMetaè¿™ä¸ªç±»çš„å®ä¾‹, ä½†MyMetaç±»é‡å†™äº†__new__æ–¹æ³•ï¼Œæ•…ä»MyMetaç±»çš„__new__æ–¹æ³•å¼€å§‹æ‰§è¡Œï¼Œè¿”å›ä¸€ä¸ªæ–°ç”Ÿæˆçš„å¯¹è±¡ï¼Œå°±åŒæ ·è°ƒç”¨MyMetaçš„æ„é€ æ–¹æ³•__init__æ–¹æ³•ã€‚è€Œåœ¨MyMetaæ„é€ æ–¹æ³•ä¸­ï¼Œå®é™…ä¼ è¿›æ¥çš„å°±æ˜¯Fooçš„å¯¹è±¡ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡clsæ‹¿åˆ°æ–°ç”Ÿæˆçš„Fooå¯¹è±¡ï¼Œä»¥åŠFooçš„æˆå‘˜å˜é‡ã€‚æˆ‘çŒœæµ‹ï¼šè¿™æ—¶å€™MyMeta.__init__ä¸­çš„clsè¿™ä¸ªå¯¹è±¡å®ä¾‹å°±æ˜¯Fooçš„ä¸€ä¸ªè™šæ‹Ÿçš„ï¼Œä¸æ˜¯çœŸæ­£å‘åœ¨å†…å­˜é‡Œçš„ï¼Œé‚£æ˜¯å› ä¸ºæˆ‘ä»¬å®šä¹‰class Foo(metaclass=MyMeta),å°±ç›¸å½“äºå°†Fooçš„ç›¸å…³ä¿¡æ¯ä¼ é€’ç»™MyMetaä¸­å»ï¼Œæ•…æˆ‘ä»¬æ‰§è¡Œcls.__name__å’Œcls.yaml_tagæ˜¯å¾—åˆ°FooåŠå…¶ç›¸å…³ä¿¡æ¯ï¼Œåªæœ‰åœ¨è°ƒç”¨MyMeta.__call__çš„æ—¶å€™ï¼ŒFooç±»çš„newæ–¹æ³•å’Œæ„é€ æ–¹æ³•æ‰é¡ºåºæ‰§è¡Œï¼Œä¹Ÿå°±è¯´åªæœ‰è¿™å”®åfooè¿™ä¸ªå®ä¾‹æ‰çœŸæ­£åœ¨å†…å­˜çœŸå®å­˜åœ¨ã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1607945853,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1915554,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/3a/a2/d9f736c6.jpg","nickname":"æµ·æ™","note":"","ucode":"38E998D2036115","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290247,"discussion_content":"1ã€pythonä¸­æ‰€æœ‰çš„ç±»éƒ½æ˜¯typeçš„å­ç±»\n2ã€clså°±æ˜¯metaclassï¼Œclsæ˜¯çˆ¶ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œä¹Ÿå³å½“å‰è¿™ä¸ªç±»æœ¬èº«\n3ã€selfæ˜¯å½“å‰ç±»çš„ä¸€ä¸ªå®ä¾‹\n4ã€pythonä¸­æ¯è°ƒç”¨ä¸€æ¬¡ç±»çš„å®ä¾‹ï¼Œ__call__å°±ä¼šè¢«æ‰§è¡Œä¸€æ¬¡\n5ã€__new__()ï¼šå…ˆè°ƒç”¨__new__(),å__init__()åˆå§‹åŒ–\nï¼ˆ1ï¼‰é™æ€æ–¹æ³•ï¼Œè‡³å°‘è¦ä¼ é€’ä¸€ä¸ªå‚æ•°clsï¼Œclsè¡¨ç¤ºéœ€è¦å®ä¾‹åŒ–çš„ç±»\nï¼ˆ2ï¼‰å¿…é¡»è¦æœ‰è¿”å›å€¼ï¼Œè¿”å›å®ä¾‹åŒ–å‡ºæ¥çš„å®ä¾‹ï¼Œä¹Ÿå¯ä»¥è¿”å›çˆ¶ç±»å’Œobjectçš„__new__()å‡ºæ¥çš„å®ä¾‹\nï¼ˆ3ï¼‰__init__()çš„å‚æ•°self,å°±æ˜¯__new__()å‡ºæ¥çš„å®ä¾‹è¿”å›ï¼Œå› æ­¤__init__()åˆå§‹åŒ–ä¹‹å‰ï¼Œä¼šå…ˆè°ƒç”¨__new__()\n6ã€æŠŠMymeta.__call__()ä¸­çš„clså…¨éƒ¨æ›¿æ¢æˆselfï¼Œä¸å½±å“Eight, Nineçš„è¾“å‡º","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1594389182,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":3020434,"avatar":"","nickname":"Geek_d4ab3d","note":"","ucode":"B57E178ABFBB80","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1915554,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/3a/a2/d9f736c6.jpg","nickname":"æµ·æ™","note":"","ucode":"38E998D2036115","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575689,"discussion_content":"ç‰›çš®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655027362,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":290247,"ip_address":""},"score":575689,"extra":""}]},{"author":{"id":1922298,"avatar":"","nickname":"patience","note":"","ucode":"46BEA083F550A8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288185,"discussion_content":"è¿˜æ˜¯æ²¡çœ‹å¤ªæ‡‚ï¼Œè¿è¡Œäº†ä¸€ä¸‹ï¼Œè¾“å‡ºäº†ç»“æœã€‚ä¸å¤ªç†è§£çš„æ˜¯ï¼š\n1ã€æœ€åä¸€å¥foo = Foo(&#39;foo&#39;)ï¼Œæ˜¯åœ¨å®ä¾‹åŒ–Fooç±»ï¼Œå¹¶ä¸”ç»™å…¥äº†ä¸€ä¸ªå‚æ•°â€˜fooâ€™ï¼Œåˆå§‹åŒ–çš„æ—¶å€™ï¼Œä¸æ˜¯åº”è¯¥å…ˆè¾“å‡ºprint(&#39;Foo.__init__&#39;)å˜›ï¼Œå³è¾“å‡ºçˆ¶ç±»Mymetaä¸­çš„print(&#39;===>Mymeta.__init__&#39;)å˜›ï¼Ÿä¸ºä»€ä¹ˆå®é™…è¿è¡Œå…ˆå¾—åˆ°çš„ç»“æœæ˜¯===>Mymeta.__new__ï¼Ÿä¸å¤ªç†è§£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593672741,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1502093,"avatar":"https://static001.geekbang.org/account/avatar/00/16/eb/8d/8ee78d3d.jpg","nickname":"ç‘å“²","note":"","ucode":"9F170728A055AD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":237787,"discussion_content":"===>Mymeta.__new__\nMymeta\n===>Mymeta.__init__\nFoo\n\nè¿™é‡Œå®šä¹‰Fooè¿™ä¸ªç±»çš„æ—¶å€™ï¼ŒæŒ‡å®šmetaclassæ˜¯Mymetaï¼Œä¸ºä»€ä¹ˆMymetaçš„__call__æ–¹æ³•æ²¡æœ‰è¢«è°ƒç”¨å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587184543,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1123304,"avatar":"https://static001.geekbang.org/account/avatar/00/11/23/e8/abd99392.jpg","nickname":"ashen-one","note":"","ucode":"F80F924DB220A1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":159662,"discussion_content":"MyMetaçš„__call__å‡½æ•°ä¸­cls.__init__(cls, *args, **kwargs)ï¼Œç¬¬ä¸€ä¸ªè¾“å…¥å‚æ•°æ˜¯ä¸æ˜¯åº”è¯¥æ˜¯ä¸Šä¸€è¯­å¥è¿”å›çš„objï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580721880,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1591665,"avatar":"https://static001.geekbang.org/account/avatar/00/18/49/71/fc2b5cf2.jpg","nickname":"éš”å£å®¶è€é²","note":"","ucode":"560030862CC24A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":83861,"discussion_content":"é—®ä¸ªé—®é¢˜ï¼Œè¿™é‡Œçš„Foo.newå¥½åƒæ²¡è¢«è°ƒç”¨ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576470524,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1076161,"avatar":"https://static001.geekbang.org/account/avatar/00/10/6b/c1/331b91c4.jpg","nickname":"éƒ‘æ–‡æ·","note":"","ucode":"98C08BB54F0974","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":70457,"discussion_content":"æ‰§è¡Œä»£ç æŠ¥é”™\nMymeta __init__æ–¹æ³•ä¸­ï¼Œself.name è¿™ä¸ªnameæç¤ºä¸å­˜åœ¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575359136,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":105196,"user_name":"ä½ æ›¾æ˜¯å°‘å¹´","can_delete":false,"product_type":"c1","uid":1326701,"ip_address":"","ucode":"83BBA0754EA1C9","user_header":"https://static001.geekbang.org/account/avatar/00/14/3e/6d/323995f4.jpg","comment_is_top":false,"comment_ctime":1560937197,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"164769694445","product_id":100026901,"comment_content":"åŸºç¡€ä¸å¤Ÿï¼Œä¹‹å‰æ²¡æ¥è§¦è¿‡metaclassï¼Œè¿™ä¸€è®²è¯»èµ·æ¥å¤ªè´¹åŠ²äº†","like_count":38},{"had_liked":false,"id":105127,"user_name":"ç¨‹åºå‘˜äººç”Ÿ","can_delete":false,"product_type":"c1","uid":1113668,"ip_address":"","ucode":"C5C5073D89AAA2","user_header":"https://static001.geekbang.org/account/avatar/00/10/fe/44/3e3040ac.jpg","comment_is_top":false,"comment_ctime":1560925351,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"134704911527","product_id":100026901,"comment_content":"è£…é¥°å™¨åƒAOPï¼Œmetaclassåƒåå°„æœºåˆ¶","like_count":32,"discussions":[{"author":{"id":1099513,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c6/f9/caf27bd3.jpg","nickname":"å¤§ç‹å«æˆ‘æ¥å·¡å±±","note":"","ucode":"1B8D0C701BC95E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2527,"discussion_content":"æˆ‘æ„Ÿè§‰æˆ‘ä¹Ÿæ˜¯è¿™ä¹ˆç†è§£çš„ï¼Œå¥½åƒè¯­è¨€è®¾è®¡çš„æœ¬èº«ä¹Ÿæœ‰é—®é¢˜å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563760610,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":105028,"user_name":"Hoo-Ah","can_delete":false,"product_type":"c1","uid":1306913,"ip_address":"","ucode":"823093A6C7DEE7","user_header":"https://static001.geekbang.org/account/avatar/00/13/f1/21/52e8267b.jpg","comment_is_top":false,"comment_ctime":1560906701,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"113230056397","product_id":100026901,"comment_content":"ä¹‹å‰è®²è£…é¥°å™¨çš„æ—¶å€™è®²åˆ°å‡½æ•°è£…é¥°å™¨å’Œç±»è£…é¥°å™¨ï¼Œè€Œç±»è£…é¥°å™¨å°±æ˜¯åœ¨é›·é‡Œé¢å®šä¹‰äº†__call__æ–¹æ³•ï¼Œä¹‹ååœ¨å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ä¼šè°ƒç”¨ç±»çš„__call__æ–¹æ³•ã€‚<br>åœ¨metaclassä¸­é‡è½½äº†__call__æ–¹æ³•ï¼Œåœ¨ä½¿ç”¨metaclasså®ä¾‹åŒ–ç”Ÿæˆç±»çš„æ—¶å€™ä¹Ÿæ˜¯è°ƒç”¨äº†__call__æ–¹æ³•ï¼Œä»è¿™æ–¹é¢æ¥è®²æ˜¯å¾ˆåƒã€‚<br>è¦è¯´ä¸ä¸€æ ·çš„è¯ï¼Œä¸€ä¸ªæ˜¯åœ¨æ‰§è¡Œå±‚é¢ï¼Œä¸€ä¸ªæ˜¯åœ¨ç”Ÿæˆå±‚é¢ã€‚<br>å¯ä»¥è®²è®²typeå’Œobjectçš„åŒºåˆ«å—ä»¥åŠå¯ä»¥ç”¨ä¸€ç¯‡ä¸“æ è®²è®²pythonçš„é­”æœ¯æ–¹æ³•ã€‚","like_count":26},{"had_liked":false,"id":136226,"user_name":"å»ºå¼º","can_delete":false,"product_type":"c1","uid":1397126,"ip_address":"","ucode":"62B03D0E0C64EC","user_header":"https://static001.geekbang.org/account/avatar/00/15/51/86/b5fd8dd8.jpg","comment_is_top":false,"comment_ctime":1569390845,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"70288867581","product_id":100026901,"comment_content":"1.metaclassæ‹¦æˆªäº†ç±»çš„æ„é€ ï¼Œç±»ä¼¼äºé»‘å®¢ï¼Œæ”¹å˜äº†ç±»çš„è¡Œä¸ºï¼Œåœ¨æŸäº›åœºåˆå¯ç®€åŒ–ç¨‹åºè®¾è®¡ã€‚<br>2.pythonè£…é¥°å™¨ï¼šä¸ä¼šå»æ”¹å˜ç±»çš„è¡Œä¸ºï¼Œä½†é€šè¿‡è£…é¥°ç±»ï¼Œå¯ä»¥åŠ å¼ºç±»çš„åŠŸèƒ½ï¼Œé€šè¿‡ä¸åŒçš„è£…é¥°å™¨ä½¿ç±»çš„åŠŸèƒ½æ›´åŠ ä¸°å¯Œã€‚","like_count":17},{"had_liked":false,"id":105055,"user_name":"ä½ çœ‹èµ·æ¥å¾ˆå¥½åƒ","can_delete":false,"product_type":"c1","uid":1188854,"ip_address":"","ucode":"F9079138EC3D7C","user_header":"https://static001.geekbang.org/account/avatar/00/12/23/f6/1ef70cab.jpg","comment_is_top":false,"comment_ctime":1560909067,"is_pvip":false,"discussion_count":7,"race_medal":0,"score":"40215614731","product_id":100026901,"comment_content":"â€˜ç”¨æˆ·è‡ªå®šä¹‰ç±»ï¼Œåªä¸è¿‡æ˜¯ type ç±»çš„__call__è¿ç®—ç¬¦â€™<br>æ™¯è€å¸ˆï¼Œè¿™é‡Œè¿™æ®µæ˜¯ä¸æ˜¯æœ‰ç‚¹é—®é¢˜ï¼Œæˆ‘åšäº†ä»¥ä¸‹å®éªŒï¼š<br><br>class MyMeta(type):<br>    def __init__(cls, name, bases, dict):<br>        print(&#39;MyMeta __init__&#39;)<br><br>    def __new__(cls, name, bases, dict):<br>        print(&#39;MyMeta __new__&#39;)<br>        return type.__new__(cls, name, bases, dict)<br><br>    def __call__(cls):<br>        print(&#39;MyMeta __call__&#39;)<br>        return type.__call__(cls)<br><br>class Test(metaclass=MyMeta):<br>    a = 10<br><br>    def __init__(self):<br>        pass<br><br>    def __new__(cls):<br>        return super(Test, cls).__new__(cls)<br><br>test = Test()<br>æˆ‘å‘ç°åœ¨ä½¿ç”¨class Test()å®šä¹‰ç±»æ—¶ï¼Œä¼šä¾æ¬¡è°ƒç”¨MyMetaçš„__new__å’Œ__init__æ–¹æ³•æ„å»ºTestç±»ï¼Œç„¶ååœ¨ä½¿ç”¨test = Test()åˆ›å»ºç±»å¯¹è±¡æ—¶ï¼Œæ‰ä¼šè°ƒç”¨MyMetaçš„__call__æ–¹æ³•æ¥è°ƒç”¨Testç±»çš„__new__å’Œ__init__æ–¹æ³•ã€‚å¥½åƒå’Œæ‚¨è¯´çš„ä¸ä¸€æ ·ï¼Ÿ<br>æˆ‘çœ‹æ‚¨è¯´çš„æ„æ€æ˜¯ï¼Œåœ¨ä½¿ç”¨classå®šä¹‰ç±»çš„æ—¶å€™ï¼Œå…ˆè°ƒç”¨metaclassçš„__call__,ç„¶åå†è°ƒç”¨metaclassçš„__new__å’Œ__init__ï¼Ÿ","like_count":9,"discussions":[{"author":{"id":1263561,"avatar":"https://static001.geekbang.org/account/avatar/00/13/47/c9/0ff8bc5f.jpg","nickname":"ç¨‹è¿æ¥","note":"","ucode":"8A09A42770C31D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1023,"discussion_content":"è¿™å°èŠ‚ï¼Œä¸“æ å†™é”™äº†ã€‚metaclass è·Ÿ__call__ ä¸€ç‚¹å…³ç³»éƒ½æ²¡æœ‰ã€‚åªæœ‰å½“å®ä¾‹åŒ–ç±»æ—¶ï¼Œæ‰ä¼šè°ƒç”¨metaclassçš„__call__æ–¹æ³•ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1562244374,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1502093,"avatar":"https://static001.geekbang.org/account/avatar/00/16/eb/8d/8ee78d3d.jpg","nickname":"ç‘å“²","note":"","ucode":"9F170728A055AD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1263561,"avatar":"https://static001.geekbang.org/account/avatar/00/13/47/c9/0ff8bc5f.jpg","nickname":"ç¨‹è¿æ¥","note":"","ucode":"8A09A42770C31D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":237795,"discussion_content":"é‡è½½äº†Fooçš„__call__æ–¹æ³•ï¼Œå‘ç°åœ¨foo=Foo(&#39;foo&#39;)çš„æ—¶å€™ä½¿ç”¨çš„è¿˜æ˜¯Mymetaçš„__call__æ–¹æ³•ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587185138,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":1023,"ip_address":""},"score":237795,"extra":""},{"author":{"id":1502093,"avatar":"https://static001.geekbang.org/account/avatar/00/16/eb/8d/8ee78d3d.jpg","nickname":"ç‘å“²","note":"","ucode":"9F170728A055AD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1263561,"avatar":"https://static001.geekbang.org/account/avatar/00/13/47/c9/0ff8bc5f.jpg","nickname":"ç¨‹è¿æ¥","note":"","ucode":"8A09A42770C31D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":237799,"discussion_content":"æ˜ç™½äº†ï¼Œ__call__æ–¹æ³•æ˜¯å®ä¾‹åœ¨åƒå‡½æ•°ä¸€æ ·è°ƒç”¨æ—¶ä½¿ç”¨çš„æ–¹æ³•ï¼Œfoo=Foo(&#39;foo&#39;)ï¼›foo()ï¼Œè¿™æ—¶ä¼šä½¿ç”¨Fooçš„__call__æ–¹æ³•ã€‚è€Œfoo=Foo(&#39;foo&#39;)æ—¶ï¼Œæ‰§è¡Œçš„æ˜¯Mymeta(classname, superclasses, attributedict)ï¼ŒMymetaæ˜¯typeçš„å®ä¾‹ã€‚è¿™é‡Œå‘ç°ï¼ŒMymetaçš„__call__, __new__, __init__éƒ½æ˜¯ç‰¹æ®Šæ–¹æ³•ï¼Œå¯ä»¥åƒç±»æ–¹æ³•ä¸€æ ·ä½¿ç”¨ï¼Œç›¸å½“äºè¿™é‡Œå°±æ˜¯Mymeta.__call__(classname, superclasses, attributedict)ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587186313,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":1023,"ip_address":""},"score":237799,"extra":""},{"author":{"id":1000076,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/8c/373d4027.jpg","nickname":"é¾è¦","note":"","ucode":"BE1D500833F070","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1502093,"avatar":"https://static001.geekbang.org/account/avatar/00/16/eb/8d/8ee78d3d.jpg","nickname":"ç‘å“²","note":"","ucode":"9F170728A055AD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301688,"discussion_content":"```\nclass MyMetaclass(type):\n    def __new__(mcs, name, bases, dict, **kwargs):\n        return type.__new__(mcs, name, bases, dict)\n\n    def __call__(cls, *args, **kwargs):\n        print(&#34;MyMetaclass.__call__():&#34;, args, kwargs)\n        return type.__call__(cls, *args, **kwargs)\n\n\nif __name__ == &#34;__main__&#34;:\n    print(MyMetaclass(&#34;MyClass&#34;, (), {}))\n```\n\nä¸Šé¢çš„ä»£ç ï¼Œä½ ä¼šå‘ç° `Mymeta(classname, superclasses, attributedict)` ä¸æ˜¯ `Mymeta.__call__(classname, superclasses, attributedict)`\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598607588,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":237799,"ip_address":""},"score":301688,"extra":""}]},{"author":{"id":1837149,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/08/5d/8e720217.jpg","nickname":"Sugushu","note":"","ucode":"CAE52AF3DF2B21","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":214570,"discussion_content":"class nameä¸ºå¯æ‰§è¡Œè¯­å¥ï¼Œæ ¹æ®metaclassçš„æŒ‡ç¤ºï¼Œå»å¯»æ‰¾__new__å’Œ__init__æ–¹æ³•\n__new__æ–¹æ³•åˆ›å»ºäº†Fooç±»ï¼Œ__init__æ–¹æ³•åˆ›å»ºäº†Fooç±»å¯¹è±¡\ninstance = Class()ï¼Œå®ä¾‹åŒ–è¿‡ç¨‹ä¸­ï¼Œè°ƒç”¨metaclassæŒ‡ç¤ºçš„ç±»å†…çš„__call__æ–¹æ³•ï¼Œå¦‚æœæœªé‡è½½ï¼Œåˆ™å»è°ƒç”¨ç±»å¯¹è±¡å†…çš„__new__æ–¹æ³•ä»¥åŠ__init__æ–¹æ³•å®Œæˆå®ä¾‹åˆ›å»º","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585208875,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1837149,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/08/5d/8e720217.jpg","nickname":"Sugushu","note":"","ucode":"CAE52AF3DF2B21","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":214564,"discussion_content":"class MyMetaä¸def è¯­æ³•ç±»ä¼¼ï¼Œéƒ½æ˜¯å¯æ‰§è¡Œçš„è¯­å¥ï¼Œæ‰€ä»¥æ²¡æœ‰test=Test()å®ä¾‹åŒ–ä¹‹å‰ï¼Œæ‰“å°çš„ç»“æœå¯ä»¥çœ‹å‡ºï¼Œ__new__å’Œ__init__æ–¹æ³•å·²ç»æ‰§è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585208585,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1526614,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4b/56/6e4fa81b.jpg","nickname":"Leo","note":"","ucode":"A8C97D54966476","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4367,"discussion_content":"callå°±æ˜¯è°ƒç”¨çš„æ—¶å€™æ‰§è¡Œçš„è¯­å¥ï¼Œå®šä¹‰çš„æ—¶å€™æ˜¯ä¸æ‰§è¡Œçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565339007,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":106111,"user_name":"WingÂ·ä¸‰é‡‘","can_delete":false,"product_type":"c1","uid":1341402,"ip_address":"","ucode":"6B9F5822C3717F","user_header":"https://static001.geekbang.org/account/avatar/00/14/77/da/54c663f3.jpg","comment_is_top":false,"comment_ctime":1561177225,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"31625948297","product_id":100026901,"comment_content":"ä¸ªäººç²—æµ…çš„ç†è§£æ˜¯ï¼šmetaclass ä¸ ç±»è£…é¥°å™¨ç›¸ä¼¼ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹æœ¬è´¨ä¸Šéƒ½æ˜¯é‡è½½äº† __call__ å‡½æ•°ï¼Œä½†æœ‰ä¸€ä¸ªæ˜æ˜¾çš„åŒºåˆ«æ˜¯å‰è€…å¯¹ã€ç»§æ‰¿äº† metaclass çš„å­ç±»æœ¬èº«ã€‘çš„å±æ€§é€ æˆäº†å½±å“ï¼Œè€Œç±»è£…é¥°å™¨æ˜¯å¯¹ã€ä½œä¸ºè£…é¥°å™¨æœ¬èº«çš„ç±»ã€‘é€ æˆå½±å“è€Œå·²ï¼Œå¯¹ã€è¢«è£…é¥°çš„ç±»ã€‘çš„å±æ€§æ²¡æœ‰ç›´æ¥å½±å“ï¼ˆé—´æ¥å½±å“å°±çœ‹è¢«è£…é¥°çš„å‡½æ•°æ€ä¹ˆæ“ä½œäº†ï¼‰ã€‚","like_count":7,"discussions":[{"author":{"id":1484184,"avatar":"https://static001.geekbang.org/account/avatar/00/16/a5/98/a65ff31a.jpg","nickname":"djfhchdh","note":"","ucode":"E71D75328CE398","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":9696,"discussion_content":"æˆ‘è§‰å¾—è¯´çš„å¾ˆå¯¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568206073,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":105486,"user_name":"Jonå¾","can_delete":false,"product_type":"c1","uid":1206774,"ip_address":"","ucode":"D203B6848C1D9C","user_header":"https://static001.geekbang.org/account/avatar/00/12/69/f6/40c497a3.jpg","comment_is_top":false,"comment_ctime":1561013889,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"31625784961","product_id":100026901,"comment_content":"ä¹‹å‰æ²¡æœ‰æ¥è§¦è¿‡ metaclassï¼Œæ„Ÿè§‰ç”¨metaclassçš„ä½œç”¨å°±æ˜¯è¶…åŠ¨æ€ç”Ÿæˆç±»ã€‚è¿™èŠ‚è¯¾æ„Ÿè§‰ç¡®å®æ¯”è¾ƒé­”æœ¯ï¼Œè·Ÿä¸Šä¸€èŠ‚è£…é¥°å™¨è¿˜è¦å†ç»†æƒ³ä¸€ä¸‹ã€‚<br><br>pyyaml 5.1ä»¥ä¸Šï¼Œè¿™æ®µä»£ç ä¼šæŠ¥é”™ï¼Œè¦æŠŠ yaml.load() æ”¹æˆ yaml.load_all()<br>yaml.load(&quot;&quot;&quot;<br>--- !Monster<br>name: Cave spider<br>hp: [2,6]    # 2d6<br>ac: 16<br>attacks: [BITE, HURT]<br>&quot;&quot;&quot;)<br><br><br>","like_count":7,"discussions":[{"author":{"id":2369413,"avatar":"https://static001.geekbang.org/account/avatar/00/24/27/85/ddeeaf30.jpg","nickname":"dived","note":"","ucode":"141916A3BAF5A1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374399,"discussion_content":"win10 5.4.1æ²¡æŠ¥é”™ï¼Œä¸è¿‡ä¸å¦¨ç¢è¿™èŠ‚è¯¾æ²¡å¬æ‡‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621164882,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1526614,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4b/56/6e4fa81b.jpg","nickname":"Leo","note":"","ucode":"A8C97D54966476","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4372,"discussion_content":"èµï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565339854,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1596386,"avatar":"","nickname":"ç³æ¢¦","note":"","ucode":"A86FC44F6321BD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1694,"discussion_content":"æˆåŠŸwork, thanks","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562818400,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":185783,"user_name":"å‘å—","can_delete":false,"product_type":"c1","uid":1325700,"ip_address":"","ucode":"E6072AD7CA6798","user_header":"https://static001.geekbang.org/account/avatar/00/14/3a/84/70340e87.jpg","comment_is_top":false,"comment_ctime":1583678567,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23058515047","product_id":100026901,"comment_content":"metaclassçš„åº”ç”¨ï¼šå•ä¾‹æ¨¡å¼ã€ORMæ¨¡å¼","like_count":5},{"had_liked":false,"id":180625,"user_name":"Ray","can_delete":false,"product_type":"c1","uid":1253774,"ip_address":"","ucode":"A7059C7D505AA0","user_header":"","comment_is_top":false,"comment_ctime":1582354397,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23057190877","product_id":100026901,"comment_content":"æˆ‘çš„æ„Ÿè§‰è£…é¥°å™¨æ˜¯é€šè¿‡æ­£å¸¸çš„å‡½æ•°çš„è°ƒç”¨ã€é—­åŒ…ç­‰æ–¹æ³•å®ç°é™„åŠ çš„åŠŸèƒ½ã€‚metaclassç›´æ¥å°±æ˜¯ä¸€ç§hackçš„æ–¹æ³•ã€‚å¦å¤–ï¼Œåœ¨å‰é¢typeç±»çš„è¯´æ˜ä»£ç ä¸­ï¼š<br>type(instance)# è¾“å‡º &lt;class &#39;__main__.C&#39;&gt;  --&gt; åº”è¯¥æ˜¯&lt;class &#39;__main__.MyClass&#39;&gt;ï¼Ÿ","like_count":5},{"had_liked":false,"id":105868,"user_name":"å›¾Â·ç¾å…‹å°”","can_delete":false,"product_type":"c1","uid":1076720,"ip_address":"","ucode":"021FB5AE110066","user_header":"https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eppQqDE6TNibvr3DNdxG323AruicIgWo5DpVr6U7yZVNkbF2rKluyDfhdpgAEcYEOZTAnbrMdTzFkUw/0","comment_is_top":false,"comment_ctime":1561096757,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"23035933237","product_id":100026901,"comment_content":"è£…é¥°å™¨å’Œmetaclasséƒ½æ˜¯ç»™å¯¹è±¡å¢åŠ ä¸€äº›é¢å¤–çš„å…¬å…±é…ä»¶ï¼Œä½†è£…é¥°å™¨ä¸å½±å“å¯¹è±¡æœ¬èº«ï¼Œè€Œmetaclassæ˜¯å°†å¯¹è±¡æœ¬èº«è¿›è¡Œæ”¹é€ ã€‚æ˜¯è®¾è®¡æ¨¡å¼å±‚é¢çš„ä¸œè¥¿ã€‚","like_count":5},{"had_liked":false,"id":105185,"user_name":"SCAR","can_delete":false,"product_type":"c1","uid":1031209,"ip_address":"","ucode":"38C0927FA3C5FC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bc/29/022905e6.jpg","comment_is_top":false,"comment_ctime":1560934623,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23035771103","product_id":100026901,"comment_content":"å“ï¼Œå¯¹metaclassçš„æœºåˆ¶çœŸæ˜¯ä¸€çŸ¥åŠè§£å•Šï¼Œæ˜¯90%é‚£å¨çš„ï¼<br>metaclasså’Œç±»è£…é¥°å™¨éƒ½å¯ä»¥åŠ¨æ€å®šåˆ¶æˆ–ä¿®æ”¹ç±»ï¼Œç±»è£…é¥°å™¨æ¯”metaclassä»¥æ›´ç®€å•çš„æ–¹å¼åšåˆ°åˆ›å»ºç±»æ—¶å®šåˆ¶ç±»ï¼Œä½†å®ƒåªèƒ½å®šåˆ¶è¢«è£…é¥°çš„è¿™ä¸ªç±»ï¼Œè€Œå¯¹ç»§æ‰¿è¿™ä¸ªç±»çš„ç±»å¤±æ•ˆã€‚metaclassçš„åŠŸèƒ½åˆ™æ˜¯è¦å¼ºå¤§çš„å¤šï¼Œå®ƒå¯ä»¥å®šåˆ¶ç±»çš„ç»§æ‰¿å…³ç³»ã€‚","like_count":5},{"had_liked":false,"id":105181,"user_name":"KaitoShy","can_delete":false,"product_type":"c1","uid":1038415,"ip_address":"","ucode":"E2E2E9BD3F5048","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d8/4f/65abc6f0.jpg","comment_is_top":false,"comment_ctime":1560934150,"is_pvip":false,"replies":[{"id":"38222","content":"å¾ˆå¥½","user_name":"ä½œè€…å›å¤","comment_id":105181,"uid":"1257426","ip_address":"","utype":1,"ctime":1561046630,"user_name_real":"Yuannanè”¡å…ƒæ¥ "}],"discussion_count":3,"race_medal":0,"score":"23035770630","product_id":100026901,"comment_content":"yaml.load(&quot;&quot;&quot;<br>--- !Monster<br>name: Cave spider<br>hp: [2,6]    # 2d6<br>ac: 16<br>attacks: [BITE, HURT]<br>&quot;&quot;&quot;)<br>è¿è¡Œæ—¶æŠ¥é”™ï¼Œpyyamlç‰ˆæœ¬PyYAML-5.1ï¼Œå°†è¯­å¥æ”¹æˆ<br>yaml.load(&quot;&quot;&quot;<br>--- !Monster<br>name: Cave spider<br>hp: [2,6]    # 2d6<br>ac: 16<br>attacks: [BITE, HURT]<br>&quot;&quot;&quot;ï¼ŒLoader=yaml.Loader)å³å¯ï¼Œå‚è§&quot;https:&#47;&#47;github.com&#47;yaml&#47;pyyaml&#47;issues&#47;266&quot;","like_count":5,"discussions":[{"author":{"id":1257426,"avatar":"https://static001.geekbang.org/account/avatar/00/13/2f/d2/0b6a8945.jpg","nickname":"Yuannanè”¡å…ƒæ¥ ","note":"","ucode":"695E183CE496A8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454586,"discussion_content":"å¾ˆå¥½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561046630,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1159983,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b3/2f/d08a1363.jpg","nickname":"èªå°‘ Jeff","note":"","ucode":"C791ACA9B47679","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536990,"discussion_content":"Thanksï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638929647,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2317044,"avatar":"https://static001.geekbang.org/account/avatar/00/23/5a/f4/077903da.jpg","nickname":"Aaron","note":"","ucode":"232FB93BDC5C93","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381644,"discussion_content":"Just warning~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625151012,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":165977,"user_name":"èµ·ä¸ªå•¥åå­—å‘¢","can_delete":false,"product_type":"c1","uid":1168839,"ip_address":"","ucode":"C71AA544A79834","user_header":"https://static001.geekbang.org/account/avatar/00/11/d5/c7/5a78596a.jpg","comment_is_top":false,"comment_ctime":1577354829,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18757224013","product_id":100026901,"comment_content":"ä¸€ç‚¹æ²¡æ‡‚","like_count":4},{"had_liked":false,"id":322072,"user_name":"ä»²è–›è’²","can_delete":false,"product_type":"c1","uid":2807170,"ip_address":"","ucode":"C98EC9D6179B93","user_header":"https://static001.geekbang.org/account/avatar/00/2a/d5/82/fc50e63a.jpg","comment_is_top":false,"comment_ctime":1637155764,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14522057652","product_id":100026901,"comment_content":"æ¨èçŸ¥ä¹ä¸Šä¸€ç¯‡æ–‡ç« è¾…åŠ©ç†è§£ https:&#47;&#47;zhuanlan.zhihu.com&#47;p&#47;65214982 ","like_count":3},{"had_liked":false,"id":166798,"user_name":"Sean","can_delete":false,"product_type":"c1","uid":1536078,"ip_address":"","ucode":"9619A9C79538D3","user_header":"https://static001.geekbang.org/account/avatar/00/17/70/4e/2808a1af.jpg","comment_is_top":false,"comment_ctime":1577600468,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14462502356","product_id":100026901,"comment_content":"å†è¡¥å……ä¸€æ®µï¼Œå¿˜è®°è¯´â€œè£…é¥°å™¨â€å’Œâ€œmetaclassâ€çš„åŒºåˆ«äº†ï¼Œè£…é¥°å™¨å°±æ²¡æœ‰åŸºå› ç¼–è¾‘é‚£ä¹ˆç¥å¥‡äº†ï¼Œå®ƒæ˜¯ç”¨æ¥è£…é¥°ç”¨çš„ï¼Œç›¸å½“äºä¸€ä¸ªå¤–åœ¨çš„è¾…åŠ©åŠŸèƒ½ï¼Œè€Œä¸”åªå¯¹è¢«è£…é¥°çš„å‡½æ•°æœ‰æ•ˆæœï¼Œå¥½æ¯”ç¾é¢œç›¸æœºçš„åŠŸèƒ½ï¼Œæ¯ä¸€å¼ è¦è¢«è£…é¥°çš„é¢å­”éƒ½éœ€è¦ç”¨ç¾é¢œç›¸æœºè¿›è¡Œä¸€æ¬¡è£…é¥°ï¼ˆ@è£…é¥°å‡½æ•°ï¼‰ï¼Œè€Œä¸”ï¼Œä½ è¢«è£…é¥°ä¹‹åï¼Œä½ çš„å­å¥³ä¸ä¼šè¢«è£…é¥°ï¼Œå°±ä¸å­˜åœ¨ä»£ä»£ç»§æ‰¿çš„æ•ˆæœäº†ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ›´åŠ çµæ´»ï¼Œä½ å¯ä»¥é€‰æ‹©ç¾é¢œåå†å‘åœˆï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä¸ç¾é¢œç›´æ¥å‘åœˆã€‚","like_count":3},{"had_liked":false,"id":105037,"user_name":"TKbook","can_delete":false,"product_type":"c1","uid":1073829,"ip_address":"","ucode":"F6E0E99CC79059","user_header":"https://static001.geekbang.org/account/avatar/00/10/62/a5/43aa0c27.jpg","comment_is_top":false,"comment_ctime":1560907855,"is_pvip":false,"replies":[{"id":"38223","content":"è°¢è°¢","user_name":"ä½œè€…å›å¤","comment_id":105037,"uid":"1257426","ip_address":"","utype":1,"ctime":1561046796,"user_name_real":"Yuannanè”¡å…ƒæ¥ "}],"discussion_count":2,"race_medal":0,"score":"14445809743","product_id":100026901,"comment_content":"ä¸€å¼€å§‹è¿˜ä»¥ä¸ºæˆ‘æ‰“å¼€é”™ä¸“æ äº†ã€‚   ç›®å‰çœ‹äº†å¥½å¤šè§£é‡Šmetaclassçš„æ–‡ç« ï¼Œæ„Ÿè§‰è¿™ä¸€ç¯‡çœ‹èµ·æ¥æœ€æ˜äº†ã€‚","like_count":3,"discussions":[{"author":{"id":1257426,"avatar":"https://static001.geekbang.org/account/avatar/00/13/2f/d2/0b6a8945.jpg","nickname":"Yuannanè”¡å…ƒæ¥ ","note":"","ucode":"695E183CE496A8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454532,"discussion_content":"è°¢è°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561046796,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1484184,"avatar":"https://static001.geekbang.org/account/avatar/00/16/a5/98/a65ff31a.jpg","nickname":"djfhchdh","note":"","ucode":"E71D75328CE398","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":9664,"discussion_content":"å“ˆå“ˆï¼Œâ€œä½ å¥½ï¼Œæˆ‘æ˜¯è”¡å…ƒæ¥ â€","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1568201667,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110724,"user_name":"å´æœˆæœˆé¸Ÿ","can_delete":false,"product_type":"c1","uid":1115064,"ip_address":"","ucode":"2F068EDD166B49","user_header":"https://static001.geekbang.org/account/avatar/00/11/03/b8/961a5342.jpg","comment_is_top":false,"comment_ctime":1562319686,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10152254278","product_id":100026901,"comment_content":"è¿™ç¯‡è›®å¥½ç©çš„ï¼Œå¤©å ‚å’Œåœ°ç‹±åªæœ‰ä¸€æ­¥ä¹‹é¥ã€‚","like_count":2},{"had_liked":false,"id":162196,"user_name":"éš”å£å®¶è€é²","can_delete":false,"product_type":"c1","uid":1591665,"ip_address":"","ucode":"560030862CC24A","user_header":"https://static001.geekbang.org/account/avatar/00/18/49/71/fc2b5cf2.jpg","comment_is_top":false,"comment_ctime":1576475463,"is_pvip":false,"replies":[{"id":"63091","content":"é—®é¢˜å¾ˆå¥½ï¼Œä¿®é¥°å™¨çš„ç¡®å’Œmetaclassæœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„","user_name":"ä½œè€…å›å¤","comment_id":162196,"uid":"1257426","ip_address":"","utype":1,"ctime":1577248083,"user_name_real":"Yuannanè”¡å…ƒæ¥ "}],"discussion_count":1,"race_medal":0,"score":"5871442759","product_id":100026901,"comment_content":"æ„Ÿè§‰å…¥é—¨äº†ï¼Œä¸è¿‡è¿˜æ˜¯æœ‰ä¸€äº›é—®é¢˜<br>@ä¿®é¥°ç¬¦æ˜¯åœ¨pythoné‡Œæ˜¯æ€ä¹ˆå®ç°çš„å‘¢<br>è€å¸ˆå¦‚æœçœ‹åˆ°äº†å¯ä»¥ç»™ç‚¹æ„è§ä¹ˆ","like_count":1,"discussions":[{"author":{"id":1257426,"avatar":"https://static001.geekbang.org/account/avatar/00/13/2f/d2/0b6a8945.jpg","nickname":"Yuannanè”¡å…ƒæ¥ ","note":"","ucode":"695E183CE496A8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477979,"discussion_content":"é—®é¢˜å¾ˆå¥½ï¼Œä¿®é¥°å™¨çš„ç¡®å’Œmetaclassæœ‰å¾ˆå¤šç›¸ä¼¼ä¹‹å¤„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577248083,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132860,"user_name":"djfhchdh","can_delete":false,"product_type":"c1","uid":1484184,"ip_address":"","ucode":"E71D75328CE398","user_header":"https://static001.geekbang.org/account/avatar/00/16/a5/98/a65ff31a.jpg","comment_is_top":false,"comment_ctime":1568254352,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5863221648","product_id":100026901,"comment_content":"# Python 3 å’Œ Python 2 ç±»ä¼¼<br>class MyClass:<br>  pass<br><br>instance = MyClass()<br><br>type(instance)<br># è¾“å‡º<br>&lt;class &#39;__main__.C&#39;&gt;  ##è¿™é‡Œå†™é”™äº†ï¼Œåº”è¯¥æ˜¯&lt;class &#39;__main__.MyClass&#39;&gt;<br><br>type(MyClass)<br># è¾“å‡º<br>&lt;class &#39;type&#39;&gt;<br>","like_count":1},{"had_liked":false,"id":110064,"user_name":"ä¿Šä¼Ÿ","can_delete":false,"product_type":"c1","uid":1111175,"ip_address":"","ucode":"7905B4F25637F4","user_header":"https://static001.geekbang.org/account/avatar/00/10/f4/87/644c0c5d.jpg","comment_is_top":false,"comment_ctime":1562164039,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"5857131335","product_id":100026901,"comment_content":"æˆ‘è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¥½å¤šæ¡†æ¶çš„æºç æ¯”å¦‚djangoçš„metaclasséƒ½é‡å†™äº†newæ–¹æ³•è€Œä¸æ˜¯é‡å†™initæ–¹æ³•ï¼Œè¿™æœ‰ä»€ä¹ˆåŒºåˆ«å—ï¼Ÿé‡æ–°è¿™ä¸¤ä¸ªæ–¹æ³•ä»»æ„ä¸€ä¸ªéƒ½å¯ä»¥å§ï¼Œä¸ºä»€ä¹ˆæ€»é‡å†™newæ–¹æ³•å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1579113,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLGTgnCUZbXpDCeia2RdXVmP5aQdxTPNR5iaGUhhUfyEMHL9wnOHIsTmt4FJicceB0DBQZlUYTcqkLkw/132","nickname":"jumpingwa","note":"","ucode":"78005B31EFF335","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379478,"discussion_content":"__new__æ–¹æ³•æ‰æ˜¯ç±»çš„æ„é€ æ–¹æ³•ï¼Œè€Œ__init__åªæ˜¯åˆå§‹åŒ–","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1623921553,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109723,"user_name":"Michael","can_delete":false,"product_type":"c1","uid":1118976,"ip_address":"","ucode":"35F4FFAC4A4B15","user_header":"https://static001.geekbang.org/account/avatar/00/11/13/00/a4a2065f.jpg","comment_is_top":false,"comment_ctime":1562082525,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5857049821","product_id":100026901,"comment_content":"class TestMetaClass(type):<br><br>    def __new__(mcs, *args, **kwargs):<br>        print(&#39;TestMetaClass.__new__&#39;, mcs)<br>        return type.__new__(mcs, *args, **kwargs)<br><br>    def __init__(cls, name, bases, kwds):<br>        print(&#39;TestMetaClass.__init__&#39;, cls)<br>        super(TestMetaClass, cls).__init__(name, bases, kwds)<br><br>    def __call__(cls, *args, **kwargs):<br>        print(&#39;TestMetaClass.__call__&#39;)<br>        return super(TestMetaClass, cls).__call__(*args, **kwargs)<br><br><br>class A(metaclass=TestMetaClass):<br><br>    def __new__(cls, *args, **kwargs):<br>        print(&#39;A.__new__&#39;)<br>        return super(A, cls).__new__(cls)<br><br>    def __init__(self, name=None):<br>        self.name = name<br>        print(&#39;A.__init__&#39;)<br><br><br>A(&#39;hello&#39;)","like_count":1},{"had_liked":false,"id":109322,"user_name":"å´æ—è¾‰","can_delete":false,"product_type":"c1","uid":1222971,"ip_address":"","ucode":"56F117300FF33D","user_header":"https://static001.geekbang.org/account/avatar/00/12/a9/3b/f4ca20d8.jpg","comment_is_top":false,"comment_ctime":1561999171,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5856966467","product_id":100026901,"comment_content":"æœ‰ä¸ªç–‘é—®è¯·æ•™ä¸‹è€å¸ˆï¼Œä¾‹å­é‡ŒYAMLObject æŠŠ metaclass å£°æ˜æˆäº† YAMLObjectMetaclassï¼Œæ¢æˆYAMLObject ç»§æ‰¿ YAMLObjectMetaclass ï¼Œå•çº¯çš„åšYAMLObjectMetaclassçš„å­ç±»ï¼Œç„¶åsuperçˆ¶ç±»çš„__init__ æ–¹æ³•ï¼Œä¸æ˜¯ä¹Ÿèƒ½å®ç°ä¸€æ ·çš„åŠŸèƒ½ä¹ˆ<br>","like_count":1},{"had_liked":false,"id":106317,"user_name":"Geek_Wison","can_delete":false,"product_type":"c1","uid":1504371,"ip_address":"","ucode":"2CD880F07FDD57","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er4HlmmWfWicNmo3x3HKaOwz3ibcicDFlV5xILbILKGFCXbnaLf2fZRARfBdVBC5NhIPmXxaxA0T9Jhg/132","comment_is_top":false,"comment_ctime":1561263257,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"5856230553","product_id":100026901,"comment_content":"è€å¸ˆä½ å¥½ï¼Œä¸ºä»€ä¹ˆæˆ‘æ‰§è¡Œç¤ºä¾‹ä»£ç ä¼šä¸€ä¸ªconstructoré”™è¯¯ï¼ŒæŸ¥äº†å¥½ä¹…èµ„æ–™éƒ½è§£å†³ä¸äº†ã€‚<br>import yaml<br>class Monster(yaml.YAMLObject):<br>  yaml_tag = u&#39;!Monster&#39;<br>  def __init__(self, name, hp, ac, attacks):<br>    self.name = name<br>    self.hp = hp<br>    self.ac = ac<br>    self.attacks = attacks<br>  def __repr__(self):<br>    return &quot;%s(name=%r, hp=%r, ac=%r, attacks=%r)&quot; % (<br>       self.__class__.__name__, self.name, self.hp, self.ac,      <br>       self.attacks)<br><br>yaml.load(&quot;&quot;&quot;<br>--- !Monster<br>name: Cave spider<br>hp: [2,6]    # 2d6<br>ac: 16<br>attacks: [BITE, HURT]<br>&quot;&quot;&quot;)<br><br>é”™è¯¯ä¿¡æ¯ï¼š<br>ConstructorError: could not determine a constructor for the tag &#39;!Monster&#39;<br>  in &quot;&lt;unicode string&gt;&quot;, line 2, column 5:<br>    --- !Monster<br>        ^","like_count":1,"discussions":[{"author":{"id":1319215,"avatar":"https://static001.geekbang.org/account/avatar/00/14/21/2f/b29e8af8.jpg","nickname":"è½»é£æ‚ æ‰¬","note":"","ucode":"F2276CE113BED1","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343581,"discussion_content":"yaml.loadéœ€è¦æ·»åŠ ä¸€ä¸ªå‚æ•°ï¼ŒLoader=yaml.Loader","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611103377,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1526614,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4b/56/6e4fa81b.jpg","nickname":"Leo","note":"","ucode":"A8C97D54966476","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4368,"discussion_content":"æˆ‘ä¹Ÿæ˜¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565339129,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1596386,"avatar":"","nickname":"ç³æ¢¦","note":"","ucode":"A86FC44F6321BD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1693,"discussion_content":"æˆ‘ä¹Ÿé‡åˆ°äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562818308,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":105163,"user_name":"hlz-123","can_delete":false,"product_type":"c1","uid":1433586,"ip_address":"","ucode":"B7E5EF0C260BD2","user_header":"","comment_is_top":false,"comment_ctime":1560931927,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5855899223","product_id":100026901,"comment_content":"å…³äºç±»è£…é¥°å™¨å’Œmetaclassï¼Œæˆ‘çš„ç†è§£å¦‚ä¸‹ï¼š<br>1ã€ç±»è£…é¥°å™¨å®ç°åŠŸèƒ½<br>     class A:<br>            def __init__:<br>            ......<br>            def __call__:<br>      @class A<br>       def my_func():<br>       æ¯æ¬¡æ‰§è¡Œå‡½æ•°my_fund()æ—¶ï¼Œé¦–å…ˆæ‰§è¡ŒAç±»ä¸­__call__å‡½æ•°ï¼Œå†æ‰§è¡Œmy_func()ã€‚<br>2ã€metaclasså®ç°åŠŸèƒ½<br>     class A:<br>     class B(metaclass=A) <br>     Bç±»çš„åŸºç±»å°±æ”¹å˜åˆ°äº†Aç±»ï¼Œä¸æ˜¯åŸæ¥ä»¥å‰ç¼ºçœçš„åŸºç±»ï¼Œæ¯”å¦‚object,<br>     åœ¨pythonä¸­ï¼Œç”Ÿæˆç±»æ—¶ï¼Œæœ€ç»ˆçš„åŸºç±»åº”è¯¥æ˜¯typeï¼Œä½†metaclasså¯ä»¥æ”¹å˜åŸºç±»ï¼Œæ‰€ä»¥ç¿»è¯‘æˆå…ƒç±»ä¹Ÿæœ‰ <br>     å‡ åˆ†é“ç†ã€‚<br>3ã€ç›¸åŒç‚¹å’ŒåŒºåˆ«<br>     ç›¸åŒç‚¹ï¼šç±»è£…é¥°å™¨å’Œmetaclasséƒ½æŒ‡å®šäº†ä¸€ä¸ªç±»<br>     åŒºåˆ«ï¼šç±»è£…é¥°å™¨æ˜¯å»æ‰§è¡Œå…¶æŒ‡å®šç±»ä¸­çš„__call__å‡½æ•°ï¼Œè€Œmeataclassæ˜¯æŒ‡å®šåŸºç±»ï¼ŒåŸºç±»çš„æ„æˆå‡½æ•°å’Œ <br>     å±æ€§ èƒ½å¤Ÿè¢«å­ç±»ç»§æ‰¿ã€‚ ","like_count":1},{"had_liked":false,"id":356160,"user_name":"é›•åˆ»æ—¶å…‰","can_delete":false,"product_type":"c1","uid":2737073,"ip_address":"å¹¿ä¸œ","ucode":"F69EB721AC706A","user_header":"https://static001.geekbang.org/account/avatar/00/29/c3/b1/e2e846d0.jpg","comment_is_top":false,"comment_ctime":1662019173,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1662019173","product_id":100026901,"comment_content":"è£…é¥°å™¨åƒAOPï¼Œmetaclassåƒåå°„æœºåˆ¶","like_count":0},{"had_liked":false,"id":342873,"user_name":"simple_å­™","can_delete":false,"product_type":"c1","uid":1873629,"ip_address":"","ucode":"A77203E242D652","user_header":"https://static001.geekbang.org/account/avatar/00/1c/96/dd/1620a744.jpg","comment_is_top":false,"comment_ctime":1650513492,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1650513492","product_id":100026901,"comment_content":"æŠŠadd_constructoræ”¾åˆ°YAMLObjectçš„__new__æ–¹æ³•é‡Œå¯ä»¥å—ï¼Œä¹Ÿä¼šæ¯æ¬¡éƒ½æ‰§è¡Œçš„","like_count":0},{"had_liked":false,"id":338748,"user_name":"å¾å…ˆç”Ÿ","can_delete":false,"product_type":"c1","uid":1233506,"ip_address":"","ucode":"F1749C79FB1F8E","user_header":"https://static001.geekbang.org/account/avatar/00/12/d2/62/d223b5e9.jpg","comment_is_top":false,"comment_ctime":1647699573,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1647699573","product_id":100026901,"comment_content":"Meta classæ˜¯è¿è¡Œæ—¶ç¼–ç¨‹çš„åŸºç¡€ï¼Œå¸¸ç”¨çš„æ–¹æ³•hook,çƒ­æ›´æ–°ç­‰æŠ€æœ¯éƒ½æ˜¯é€šè¿‡ runtimeæœºåˆ¶å®Œæˆ","like_count":0},{"had_liked":false,"id":329937,"user_name":"twigle","can_delete":false,"product_type":"c1","uid":1228894,"ip_address":"","ucode":"9D2439BFF8B99F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKRLfnpj6j5SNVFyH4bQxxKibqIDEIsYQZYmGqcEbQdxfDWMvCQFtnI9sKIa8C7sl4aYbuWZr2tK3w/132","comment_is_top":false,"comment_ctime":1641657979,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1641657979","product_id":100026901,"comment_content":"åˆ›å»ºç±»å°±æ˜¯è°ƒç”¨typeæˆ–è€…ç»§æ‰¿typeçš„å…ƒç±»çš„__call__æ–¹æ³•ï¼Œå…ƒç±»ç»§æ‰¿typeï¼Œé‡è½½å…¶__call__ï¼ŒæŒ‡å®šmetaclassï¼Œç›¸åº”å…ƒç±»ä»£æ›¿typeåˆ›å»ºç±»ï¼Œè™šæ‹Ÿæœºè´Ÿè´£è°ƒç”¨__call__, å…ƒç±»æ²¡æœ‰é‡è½½çš„è¯ç”¨typeçš„__call__<br><br>typeçš„__call__æ–¹æ³•åº•å±‚æ˜¯<br>type.__new__(typeclass, classname, superclasses, attributedict)<br>type.__init__(class, classname, superclasses, attributedict)<br>æ‰§è¡Œå­ç±»çš„__new__æ–¹æ³•è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œç›¸å½“äºæ„é€ å™¨ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç±»<br>æ‰§è¡Œå­ç±»__init__æ–¹æ³•ï¼Œç›¸å½“äºåˆå§‹åŒ–ä»£ç å—ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å®ä¾‹<br>è‡³äºç±»åŠ è½½è™šæ‹Ÿæœºçš„æ—¶æœºå’Œç±»å¯¹è±¡åˆå§‹åŒ–ï¼Œåº”è¯¥åœ¨è°ƒç”¨__call__ä¹‹å‰ï¼Œpythonè™šæ‹Ÿæœºä¿è¯<br>","like_count":0},{"had_liked":false,"id":329928,"user_name":"twigle","can_delete":false,"product_type":"c1","uid":1228894,"ip_address":"","ucode":"9D2439BFF8B99F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKRLfnpj6j5SNVFyH4bQxxKibqIDEIsYQZYmGqcEbQdxfDWMvCQFtnI9sKIa8C7sl4aYbuWZr2tK3w/132","comment_is_top":false,"comment_ctime":1641653736,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1641653736","product_id":100026901,"comment_content":"ç”Ÿäº§ä¸­é‡åˆ°å…ƒç±»çš„é—®é¢˜åå†æ¥çœ‹çš„ï¼Œéå¸¸æ£’çš„ä¸€èŠ‚è¯¾ï¼","like_count":0},{"had_liked":false,"id":319874,"user_name":"H.H","can_delete":false,"product_type":"c1","uid":2668479,"ip_address":"","ucode":"3C0BB1E2A3EC51","user_header":"https://static001.geekbang.org/account/avatar/00/28/b7/bf/815f0ec6.jpg","comment_is_top":false,"comment_ctime":1635994214,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1635994214","product_id":100026901,"comment_content":"çœ‹åˆ°è¿™ï¼Œè£…é¥°å™¨ã€metaclassã€ç»§æ‰¿ï¼Œç°åœ¨æœ‰ç‚¹ä¸€å›¢æµ†ç³Šï¼Œæ„Ÿè§‰åˆèƒ½æ„Ÿè§‰åˆ°å®ƒä»¬çš„åŒºåˆ«ï¼Œä½†æ˜¯åˆè¯´ä¸ä¸Šæ¥ã€‚","like_count":0},{"had_liked":false,"id":315734,"user_name":"Clany","can_delete":false,"product_type":"c1","uid":1238495,"ip_address":"","ucode":"1C4B6321172D87","user_header":"https://static001.geekbang.org/account/avatar/00/12/e5/df/ae7f8e00.jpg","comment_is_top":false,"comment_ctime":1633956290,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633956290","product_id":100026901,"comment_content":"__new__æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¿™ä¸ªç±»ï¼Œè€Œå…¶ä½™çš„å‚æ•°ä¼šåœ¨è°ƒç”¨æˆåŠŸåå…¨éƒ¨ä¼ é€’ç»™__init__æ–¹æ³•åˆå§‹åŒ–ï¼Œè¿™ä¸€ä¸‹å­å°±çœ‹å‡ºäº†è°æ˜¯è€å­è°æ˜¯å°å­çš„å…³ç³»ã€‚<br>æ‰€ä»¥ï¼Œ__new__æ–¹æ³•ï¼ˆç¬¬ä¸€ä¸ªæ‰§è¡Œï¼‰å…ˆäº__init__æ–¹æ³•æ‰§è¡Œï¼š<br>class A:â€¨\tpassâ€¨â€¨class B(A):â€¨\tdef __new__(cls):â€¨\t\tprint(&quot;__new__æ–¹æ³•è¢«æ‰§è¡Œ&quot;)â€¨\t\treturn super().__new__(cls)<br>â€¨\tdef __init__(self):â€¨\t\tprint(&quot;__init__æ–¹æ³•è¢«æ‰§è¡Œ&quot;)<br>â€¨b = B()â€¨<br>æ‰§è¡Œç»“æœä¸ºï¼š<br>__new__æ–¹æ³•è¢«æ‰§è¡Œâ€¨__init__æ–¹æ³•è¢«æ‰§è¡Œ<br>æˆ‘æ¯”è¾ƒä¸¤ä¸ªæ–¹æ³•çš„å‚æ•°ï¼Œå‘ç°__new__æ–¹æ³•æ˜¯ä¼ å…¥ç±»(cls)ï¼Œè€Œ__init__æ–¹æ³•ä¼ å…¥ç±»çš„å®ä¾‹åŒ–å¯¹è±¡(self)ï¼Œè€Œæœ‰æ„æ€çš„æ˜¯ï¼Œ__new__æ–¹æ³•è¿”å›çš„å€¼å°±æ˜¯ä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡ï¼ˆps:å¦‚æœ__new__æ–¹æ³•è¿”å›Noneï¼Œåˆ™__init__æ–¹æ³•ä¸ä¼šè¢«æ‰§è¡Œï¼Œå¹¶ä¸”è¿”å›å€¼åªèƒ½è°ƒç”¨çˆ¶ç±»ä¸­çš„__new__æ–¹æ³•ï¼Œè€Œä¸èƒ½è°ƒç”¨æ¯«æ— å…³ç³»çš„ç±»çš„__new__æ–¹æ³•ï¼‰ã€‚æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆç†è§£å®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼Œ__new__æ˜¯å¼€è¾Ÿç–†åŸŸçš„å¤§å°†å†›ï¼Œè€Œ__init__æ˜¯åœ¨è¿™ç‰‡ç–†åŸŸä¸Šè¾›å‹¤åŠ³ä½œçš„å°è€ç™¾å§“ï¼Œåªæœ‰__new__æ‰§è¡Œå®Œåï¼Œå¼€è¾Ÿå¥½ç–†åŸŸåï¼Œ__init__æ‰èƒ½å·¥ä½œï¼Œç»“åˆåˆ°ä»£ç ï¼Œä¹Ÿå°±æ˜¯__new__çš„è¿”å›å€¼æ­£æ˜¯__init__ä¸­selfã€‚<br>æˆ‘ä»¬å¯ä»¥çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼šâ€¨class CapStr(str):â€¨    def __new__(cls, string):â€¨        self_in_init = super().__new__(cls, string)â€¨        print(id(self_in_init))â€¨        return self_in_initâ€¨â€¨    def __init__(self,string):â€¨        print(id(self))â€¨â€¨a = CapStr(&quot;I love China!&quot;)â€¨print(id(a))â€¨<br>æ‰§è¡Œç»“æœä¸ºï¼š<br>2691640428616â€¨2691640428616â€¨2691640428616<br>ä¸Šé¢è¿™æ®µä»£ç çš„å†…å®¹å¾ˆç®€å•ï¼Œåœ¨__new__ä¸­æ‰“å°ä¸€ä¸‹è¿”å›å€¼çš„idï¼Œåœ¨__init__ä¸­æ‰“å°ä¸€ä¸‹selfçš„idå€¼ï¼Œæœ€åå†æ‰“å°ä¸€ä¸‹åˆ›å»ºçš„è¿™ä¸ªç±»çš„idå€¼ï¼ˆæ‰€è°“çš„idå€¼ä¹Ÿå°±æ˜¯å†…å­˜åœ°å€ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ€åçš„è¾“å‡ºç»“æœæ˜¯ä¸€è‡´çš„ï¼Œè¿™ä¹Ÿå°±è¯´æ˜ï¼Œæ•´ä¸ªç±»çš„åœ°ç›˜æ˜¯ç”±__new__å‡½æ•°&quot;å¼€è¾Ÿå‡ºæ¥çš„&quot;ï¼Œè€Œåˆ°äº†__init__å†…éƒ¨å°±åªèƒ½åœ¨è¿™ç‰‡åœ°ç›˜ä¸Š&quot;ä¿®ä¿®è¡¥è¡¥&quot;äº†ã€‚<br>å°ç»“ï¼š__new__å’Œ__init__ç›¸é…åˆæ‰æ˜¯pythonä¸­çœŸæ­£çš„ç±»æ„é€ å™¨ã€‚","like_count":0},{"had_liked":false,"id":298158,"user_name":"Fullmetal Alchemist","can_delete":false,"product_type":"c1","uid":1528865,"ip_address":"","ucode":"4D260084DBC2B2","user_header":"https://static001.geekbang.org/account/avatar/00/17/54/21/aaf74594.jpg","comment_is_top":false,"comment_ctime":1623928600,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1623928600","product_id":100026901,"comment_content":"Jsonçš„dumpså’Œloadsä¹Ÿæ˜¯ç”¨metaclassæ¥å®ç°çš„å—","like_count":0},{"had_liked":false,"id":297235,"user_name":"æ‡’çŒ«","can_delete":false,"product_type":"c1","uid":2538092,"ip_address":"","ucode":"094F30C802C0F6","user_header":"","comment_is_top":false,"comment_ctime":1623387742,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1623387742","product_id":100026901,"comment_content":"æ€è€ƒé¢˜æœ‰å¤§ä½¬æ¥å›ç­”ä¸€ä¸‹å—ï¼Ÿæˆ‘è§‰å¾—metaclasså°±æ˜¯ç±»çš„è£…é¥°å™¨","like_count":0},{"had_liked":false,"id":289691,"user_name":"å–µ(à¹‘â€¢ÌÏ‰à¸Ì€à¹‘)","can_delete":false,"product_type":"c1","uid":1241361,"ip_address":"","ucode":"66CCF45ACA61BF","user_header":"https://static001.geekbang.org/account/avatar/00/12/f1/11/2f2819bd.jpg","comment_is_top":false,"comment_ctime":1619145159,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1619145159","product_id":100026901,"comment_content":"æ²¡çœ‹æ‡‚ï¼Œå†å»æŸ¥æŸ¥metaclasså…¶å®ƒèµ„æ–™è¾…åŠ©ç†è§£ä¸‹","like_count":0},{"had_liked":false,"id":275468,"user_name":"æµ·æœ‹æ£®","can_delete":false,"product_type":"c1","uid":1165084,"ip_address":"","ucode":"212BADF1F9E962","user_header":"https://static001.geekbang.org/account/avatar/00/11/c7/1c/e59a699b.jpg","comment_is_top":false,"comment_ctime":1611554138,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1611554138","product_id":100026901,"comment_content":"åœ¨æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•çš„æ–¹é¢ï¼Œä¼šæœ‰äººæŠŠæ¥å£é…ç½®å†™åœ¨yamlæ¥ï¼Œè¿›è¡Œè½¬æ¥è½¬å»","like_count":0},{"had_liked":false,"id":258988,"user_name":"èŒ«å†œ","can_delete":false,"product_type":"c1","uid":1206365,"ip_address":"","ucode":"71F7143644C9CB","user_header":"https://static001.geekbang.org/account/avatar/00/12/68/5d/1ccee378.jpg","comment_is_top":false,"comment_ctime":1604590671,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1604590671","product_id":100026901,"comment_content":"è£…é¥°å™¨åƒåŠ¨æ€ä»£ç†ï¼Œmetaclassåƒjavaagent","like_count":0},{"had_liked":false,"id":233907,"user_name":"Robertå°ä¸ƒ","can_delete":false,"product_type":"c1","uid":1165254,"ip_address":"","ucode":"6BBF4674673AF5","user_header":"https://static001.geekbang.org/account/avatar/00/11/c7/c6/35cc7c7c.jpg","comment_is_top":false,"comment_ctime":1594515076,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1594515076","product_id":100026901,"comment_content":"æ—¶è¿‡ä¸€å¹´ï¼Œå†æ¥çœ‹è¿™ç¯‡æ–‡ç« ï¼Œç®€ç›´å°ç¥","like_count":0,"discussions":[{"author":{"id":1000076,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/8c/373d4027.jpg","nickname":"é¾è¦","note":"","ucode":"BE1D500833F070","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301671,"discussion_content":"__call__è¿ç®—ç¬¦é‡è½½çš„æè¿°ï¼Œä½ ç¡®å®šçœ‹æ‡‚äº†ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598604118,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1165254,"avatar":"https://static001.geekbang.org/account/avatar/00/11/c7/c6/35cc7c7c.jpg","nickname":"Robertå°ä¸ƒ","note":"","ucode":"6BBF4674673AF5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1000076,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/8c/373d4027.jpg","nickname":"é¾è¦","note":"","ucode":"BE1D500833F070","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":301834,"discussion_content":"ä½ æœ‰ä»€ä¹ˆç–‘é—®ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598675216,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":301671,"ip_address":""},"score":301834,"extra":""}]}]},{"had_liked":false,"id":221001,"user_name":"lcqbug","can_delete":false,"product_type":"c1","uid":1268609,"ip_address":"","ucode":"08FA17F21BCEC5","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epbyHPGNLu9sDQOs1V6brMcDwia55pyIlP9n62oO6IYS6kIFDnOSON4ugSeBSy6WhDUnYyJC6vtnHQ/132","comment_is_top":false,"comment_ctime":1590376536,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590376536","product_id":100026901,"comment_content":"è£…é¥°å™¨å’Œå’Œmetaclasséƒ½å¯ä»¥æ”¹å˜ä»£ç è¿è¡Œç»“æœï¼Œä¸€ä¸ªæ˜¯æŒ‰ç€æ­£å¸¸è§„åˆ™æœ‰çš„ï¼Œä¸€ä¸ªæ˜¯ä»åº•å±‚æ”¹å˜çš„ã€‚2ï¼Œæˆ‘çš„ç†è§£ï¼Œtypeç¿»è¯‘ä¸ºå…ƒç±»ï¼Œmetaclassæ˜¯æ§åˆ¶å…ƒç±»çš„è¡Œä¸ºçš„ï¼Œæœ‰â˜è¶…è¶Šæ”¹å˜çš„æ„æ€ã€‚objectç¿»è¯‘ä¸ºåŸºç±»ã€‚åŸºç±»ä¸ºä¼—ç¥ä¹‹çˆ¶ï¼Œå…ƒç±»ä¸ºé€ ç‰©ä¸»ã€‚","like_count":0},{"had_liked":false,"id":217160,"user_name":"æˆ‘æ˜¯å­¦ğŸ¤“","can_delete":false,"product_type":"c1","uid":1524623,"ip_address":"","ucode":"4407BDA2278E9F","user_header":"https://static001.geekbang.org/account/avatar/00/17/43/8f/78d29569.jpg","comment_is_top":false,"comment_ctime":1589428600,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1589428600","product_id":100026901,"comment_content":"ç¬¬ä¸‰éé˜…è¯»ï¼Œç»ˆäºæ‡‚äº† metaclass","like_count":0,"discussions":[{"author":{"id":1695261,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/9doFL0ZzcWf5gkQ10cHsOziamhHicjq1k2KHvJibkicBjHsKyvf9jMepvdgLFiadiaI8PScf73Pl7QK3ibp6MYicWn9BuQ/132","nickname":"Geek_6df977","note":"","ucode":"4F26A42C9BD901","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375143,"discussion_content":"å¤§ä½¬èƒ½è®²ä¸€ä¸‹å—ï¼Ÿæˆ‘çœ‹çš„äº‘é‡Œé›¾é‡Œçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621495209,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":206158,"user_name":"kaizen","can_delete":false,"product_type":"c1","uid":1675966,"ip_address":"","ucode":"313EEA97AEC7C3","user_header":"https://static001.geekbang.org/account/avatar/00/19/92/be/8de4e1fe.jpg","comment_is_top":false,"comment_ctime":1586796615,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1586796615","product_id":100026901,"comment_content":"è€å¸ˆï¼Œçœ‹å®Œè€å¸ˆè¿™ç¯‡å®Œå…¨æ˜¯æ‡µçš„ï¼Œè¯•å›¾åœ¨è¯„è®ºä¸­æ‰¾åˆ°æ›´é€šä¿—çš„ç†è§£ï¼Œå¦‚æœè¯´è£…é¥°å™¨æ˜¯ä¸ºäº†åœ¨ä¸æ”¹å˜è¢«è£…é¥°è€…çš„å‰æä¸‹è¿›è¡Œé¢å¤–çš„å¤„ç†ï¼Œé‚£ä¹ˆmetaclassæ˜¯ä¸ºäº†è®©å¾ˆå¤šä¸åŒçš„classï¼Œåœ¨å®ä¾‹åŒ–æ—¶èƒ½å¤Ÿåšä¸€ä»¶ç»Ÿä¸€çš„äº‹å§<br>è€å¸ˆè¿™ç¯‡æ–‡ç« ï¼Œå¼€ç¯‡é—¨æ§›å°±ä¸ä½~ï¼Œyamlï¼Œåºåˆ—ä¸ååºåˆ—ç­‰ç­‰","like_count":0},{"had_liked":false,"id":177344,"user_name":"è¾°æ˜Ÿ","can_delete":false,"product_type":"c1","uid":1037406,"ip_address":"","ucode":"C05AF875B85718","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d4/5e/b8bfa75d.jpg","comment_is_top":false,"comment_ctime":1581350383,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581350383","product_id":100026901,"comment_content":"çœ‹ä¸æ‡‚ï¼ˆï¼ƒï¼.ï¼ï¼‰","like_count":0},{"had_liked":false,"id":171021,"user_name":"jackstraw","can_delete":false,"product_type":"c1","uid":1137207,"ip_address":"","ucode":"C967D2D6158F99","user_header":"https://static001.geekbang.org/account/avatar/00/11/5a/37/8775d714.jpg","comment_is_top":false,"comment_ctime":1578823491,"is_pvip":false,"replies":[{"id":"66800","content":"é‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Ÿè¿™äº›ä»£ç æˆ‘éƒ½æ ¡éªŒè¿‡","user_name":"ä½œè€…å›å¤","user_name_real":"Yuannanè”¡å…ƒæ¥ ","uid":"1257426","ctime":1579136372,"ip_address":"","comment_id":171021,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1578823491","product_id":100026901,"comment_content":"è¿™ä»£ç è·‘éƒ½è·‘ä¸é€š","like_count":0,"discussions":[{"author":{"id":1257426,"avatar":"https://static001.geekbang.org/account/avatar/00/13/2f/d2/0b6a8945.jpg","nickname":"Yuannanè”¡å…ƒæ¥ ","note":"","ucode":"695E183CE496A8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481202,"discussion_content":"é‡åˆ°ä»€ä¹ˆé—®é¢˜ï¼Ÿè¿™äº›ä»£ç æˆ‘éƒ½æ ¡éªŒè¿‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579136372,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":166796,"user_name":"Sean","can_delete":false,"product_type":"c1","uid":1536078,"ip_address":"","ucode":"9619A9C79538D3","user_header":"https://static001.geekbang.org/account/avatar/00/17/70/4e/2808a1af.jpg","comment_is_top":false,"comment_ctime":1577599962,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577599962","product_id":100026901,"comment_content":"æ¯æ¬¡å­¦å®Œåï¼Œéƒ½ä¼šçœ‹ä¸€éå¤§å®¶çš„ç•™è¨€ï¼Œå¾ˆå¤šç•™è¨€éƒ½å¾ˆç²¾å½©ï¼Œæœ¬ç« å†…å®¹ç‰¹åˆ«æœ‰æ„æ€ï¼Œä¹Ÿé¢†ç•¥åˆ°äº†Pythonçš„ç¥å¥‡ä¹‹å¤„ï¼Œæˆ‘ä¹Ÿç•™è¨€ä¸€æ¬¡å§ï¼Œå“ˆå“ˆå“ˆå“ˆã€‚<br>ä¸ªäººå¯¹äºmetaclassè®¤çŸ¥ï¼Œé¦–å…ˆå®ƒåŒ…å«äº†â€œè¶…è¶Šç±»â€å’Œâ€œå˜å½¢ç±»â€å«ä¹‰ã€‚<br>è¶…è¶Šç±»ï¼šæ˜¯å› ä¸ºç»§æ‰¿äº†è‡ªå®šä¹‰metaclassçš„ç±»ï¼Œéƒ½ä¼šå—åˆ°å½±å“ã€‚<br>å˜å½¢ç±»ï¼šç±»çš„è¿è¡Œæœºåˆ¶è·Ÿæ™®é€šç±»çš„æœºåˆ¶ä¸åŒï¼Œä¼šå¢åŠ æŸç§åŠŸèƒ½ã€‚<br>å‡ºç°ä¸¤ç§ç‰¹æ€§çš„æ ¹æœ¬åŸå› å°±æ˜¯å› ä¸ºPythonæœ¬èº«çš„è¿è¡Œæœºåˆ¶ï¼Œæ¯ä¸€ä¸ªå®šä¹‰çš„ç±»éƒ½æ¶‰åŠåˆ°ç»§æ‰¿ã€é‡è½½ï¼Œä¸­é€”ä¿®æ”¹äº†çˆ¶ç±»çš„ç‰¹æ€§ï¼Œå­ç±»è‡ªç„¶å—å½±å“ï¼Œä¹‹å‰è¯´Pythoné‡Œé¢ï¼Œå¤„å¤„çš†å¯¹è±¡ï¼Œçœ‹æ¥å¯ä»¥ä¿®æ”¹ä¸ºâ€œPythonä¸­å¤„å¤„çš†å¯¹è±¡ï¼Œå¤„å¤„çš†å¯¹è±¡çš„ç»§æ‰¿ã€é‡è½½â€ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½¿ç”¨metaclassæœ‰ç‚¹ç±»ä¼¼äºåŸºå› ç¼–è¾‘ï¼Œå¯¹æŸä¸€ä½å­•å¦‡é‡‡ç”¨äº†åŸºå› ç¼–è¾‘çš„æŠ€æœ¯ï¼Œå¦‚æœç¼–è¾‘åå¯ä»¥æé«˜æ¯äº²çš„æ™ºå•†ï¼Œè‡ªç„¶å¥¹çš„å­å­è¾ˆè¾ˆçš„æ™ºå•†éƒ½èƒ½æé«˜ï¼ˆé˜¿æ‹‰ä¸ç¥ç¯çš„æ•ˆæœï¼‰ï¼›å¦‚æœç¼–è¾‘åä¼šå¯¼è‡´æ¯äº²çš„å…ç–«åŠ›ä¸‹é™ï¼Œè‡ªç„¶å¥¹çš„å­å­è¾ˆè¾ˆçš„å…ç–«åŠ›éƒ½ä¼šä¸‹é™ï¼ˆæ½˜å¤šæ‹‰é­”ç›’å¸¦æ¥çš„ç¾éš¾ï¼‰ï¼Œæ‰€ä»¥ï¼ŒåŸºå› ç¼–è¾‘ä¹Ÿè¦æ…é‡ï¼Œå½“ç„¶ï¼Œç›®å‰æ¥è¯´æ˜¯æ˜ä»¤ç¦æ­¢ã€‚","like_count":0},{"had_liked":false,"id":152728,"user_name":"Paul Shan","can_delete":false,"product_type":"c1","uid":1593140,"ip_address":"","ucode":"32D99989028284","user_header":"","comment_is_top":false,"comment_ctime":1574070809,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574070809","product_id":100026901,"comment_content":"Python ï¼šåˆ›å»ºæ™®é€šç±»å‹å¯¹è±¡ï¼Œè°ƒç”¨çš„æ˜¯ç³»ç»Ÿå®šä¹‰çš„type(classname, superclasses, attributedict)<br>åˆ›å»ºmetaclassï¼Œè°ƒç”¨çš„æ˜¯è‡ªå®šä¹‰çš„MyMeta(classname, superclasses, attributedict)ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥åšå¾ˆå¤šæ‰‹è„šã€‚<br>ä½†æ˜¯è¿™äº›æ‰‹è„šæ˜æ˜¾è¿èƒŒå°è£…çš„ç‰¹æ€§ï¼Œä¸æ˜¯ç‰¹åˆ«å¿…è¦è¿˜æ˜¯ä¸è¦ç”¨ã€‚","like_count":0},{"had_liked":false,"id":147200,"user_name":"æ²¢æ°‘","can_delete":false,"product_type":"c1","uid":1142644,"ip_address":"","ucode":"426A76C0DC00A5","user_header":"https://static001.geekbang.org/account/avatar/00/11/6f/74/90097b9d.jpg","comment_is_top":false,"comment_ctime":1572837175,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572837175","product_id":100026901,"comment_content":"è€å¸ˆï¼Œè¿™æ®µä»£ç æœ‰Python3çš„ç‰ˆæœ¬çš„å—ï¼Ÿè¿è¡Œä¸é€šå‘¢ã€‚","like_count":0},{"had_liked":false,"id":138575,"user_name":"è‡ªç”±æ°‘","can_delete":false,"product_type":"c1","uid":1346236,"ip_address":"","ucode":"435C67531697F1","user_header":"https://static001.geekbang.org/account/avatar/00/14/8a/bc/cb39ed38.jpg","comment_is_top":false,"comment_ctime":1570344556,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570344556","product_id":100026901,"comment_content":"æ€è€ƒé¢˜ï¼šè£…é¥°å™¨æ˜¯ä¸æ”¹å˜å‡½æ•°ï¼Œè€Œä¸ºå‡½æ•°å¢åŠ æ–°çš„åŠŸèƒ½ï¼Œåœ¨å‡½æ•°å’Œç±»ä¸Šéƒ½èƒ½ç”¨ã€‚metaclassæ˜¯æ”¹å˜è‡ªå®šä¹‰ç±»å‹çš„metaclassï¼Œä½¿å…¶ä¸å†é‡è½½é»˜è®¤çš„typeçš„__call__è€Œæ˜¯è½¬è€Œé‡è½½è‡ªå®šä¹‰çš„metaclassçš„__call__ã€‚<br>æ€»ç»“ï¼šæ…ç”¨metaclassã€‚","like_count":0},{"had_liked":false,"id":133108,"user_name":"djfhchdh","can_delete":false,"product_type":"c1","uid":1484184,"ip_address":"","ucode":"E71D75328CE398","user_header":"https://static001.geekbang.org/account/avatar/00/16/a5/98/a65ff31a.jpg","comment_is_top":false,"comment_ctime":1568362496,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568362496","product_id":100026901,"comment_content":"ä¸ªäººæ„Ÿè§‰ï¼Œmetaclassé€šè¿‡é‡è½½__call__æ¥ä¿®æ”¹ç±»çš„è¡Œä¸ºï¼Œè€Œè£…é¥°å™¨æ˜¯é€šè¿‡å°†åŸå‡½æ•°è¿›è¡ŒåŒ…è£…æ¥ä¿®æ”¹åŸå‡½æ•°çš„åŠŸèƒ½ï¼Œä¸¤è€…éƒ½å¯¹åŸæœ‰çš„åŠŸèƒ½è¿›è¡Œäº†æ‰©å±•ï¼Œä½†æ˜¯å®ç°æ€è·¯ä¸ä¸€æ ·ï¼Œmetaclassæ˜¯ä»ç±»å‹æœºåˆ¶è¿™ä¸ªè§’åº¦ï¼Œè€Œè£…é¥°å™¨ä¸»è¦ä»å‡½æ•°çš„è§’åº¦ï¼Œä¸ªäººæ„Ÿè§‰è£…é¥°å™¨æ›´åŠ è½»é‡çº§ï¼ˆå› æ­¤æ›´åŠ é€‚åˆä¸šåŠ¡åº”ç”¨å±‚é¢ï¼‰ï¼Œè€Œmetaclassæ›´åŠ é‡é‡çº§ä¸€äº›ï¼ˆå¯ä»¥çœ‹æˆæ˜¯â€œå¤§æ‹›â€ï¼Œä¹Ÿå› æ­¤æ›´åŠ é€‚åˆæ¡†æ¶å±‚é¢ï¼‰","like_count":0},{"had_liked":false,"id":131592,"user_name":"é•¿æœŸè§„åˆ’","can_delete":false,"product_type":"c1","uid":1019332,"ip_address":"","ucode":"5EF65E9115834B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","comment_is_top":false,"comment_ctime":1567820937,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567820937","product_id":100026901,"comment_content":"è®²çš„å¾ˆæ£’ï¼Œç»ˆäºæ˜ç™½äº†ï¼ŒğŸ‘","like_count":0},{"had_liked":false,"id":121179,"user_name":"ä¹˜åTornadoçš„çº¿ç¨‹é­”æ³•å¸ˆ","can_delete":false,"product_type":"c1","uid":1132661,"ip_address":"","ucode":"C4C9915866E769","user_header":"https://static001.geekbang.org/account/avatar/00/11/48/75/02b4366a.jpg","comment_is_top":false,"comment_ctime":1565071295,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565071295","product_id":100026901,"comment_content":"å…³äºæ–‡ä¸­çš„ä»£ç æ®µï¼š<br><br># Python 3 å’Œ Python 2 ç±»ä¼¼<br>class MyClass:<br>  pass<br><br>instance = MyClass()<br><br>type(instance)<br># è¾“å‡º<br>&lt;class &#39;__main__.C&#39;&gt;<br><br>type(MyClass)<br># è¾“å‡º<br>&lt;class &#39;type&#39;&gt;<br><br><br>ç»éªŒè¯ï¼ŒMyClassæ˜¯æ—§å¼ç±»å†™æ³•ï¼Œå‘½ä»¤è¡Œè¾“å‡ºä¸º&lt;type &#39;classobj&#39;&gt;<br>å¦‚æœå°†MyClassæ”¹æˆæ–°å¼ç±»å†™æ³•: MyClass(object)ï¼Œåˆ™è¾“å‡ºä¸º&lt;type&#39;type&#39;&gt;<br><br>å¦‚æœä»¥ä¸ŠéªŒè¯æ­£ç¡®ï¼Œè¯·ä¿®æ”¹ä¸‹æ–‡ä¸­å†…å®¹ã€‚<br>","like_count":0},{"had_liked":false,"id":108865,"user_name":"magician","can_delete":false,"product_type":"c1","uid":1483968,"ip_address":"","ucode":"1BD1125C7C907A","user_header":"https://static001.geekbang.org/account/avatar/00/16/a4/c0/c6880c07.jpg","comment_is_top":false,"comment_ctime":1561905127,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561905127","product_id":100026901,"comment_content":"å¯ä»¥è®²è®²typeå’Œobjectçš„åŒºåˆ«å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":108512,"user_name":"ä¿Šä¼Ÿ","can_delete":false,"product_type":"c1","uid":1111175,"ip_address":"","ucode":"7905B4F25637F4","user_header":"https://static001.geekbang.org/account/avatar/00/10/f4/87/644c0c5d.jpg","comment_is_top":false,"comment_ctime":1561789673,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1561789673","product_id":100026901,"comment_content":"è£…é¥°å™¨å­ç±»æ— æ³•ç»§æ‰¿ï¼Œè€Œmetaclassä¸ç”¨æ‹…å¿ƒæ— æ³•ç»§æ‰¿çš„é—®é¢˜ã€‚è¿™ç¯‡æ–‡ç« å†™çš„çœŸçš„å¥½ï¼Œä»¥å‰å¯¹metaclassçš„äº†è§£ï¼Œåªæ˜¯æŠŠå®ƒå½“æˆä¸€ä¸ªæ¯”è£…é¥°å™¨é«˜çº§ä¸€ç‚¹çš„å·¥å…·ã€‚åˆ›å»ºç±»çš„æ—¶å€™ï¼Œå°±æ˜¯é‡è½½äº†typeçš„__call__æ–¹æ³•ï¼Œè€Œtypeçš„callæ–¹æ³•ä¸è¿‡æ˜¯è°ƒç”¨äº†newå’Œinitæ–¹æ³•ã€‚è¿™é‡Œæˆ‘æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œnewæ˜¯åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•ï¼Œé‚£ä¹ˆé‡å†™äº†newæ–¹æ³•ï¼Œé‚£ä¹ˆæˆ‘å°±èƒ½æ ¹æ®æ¡ä»¶è¿”å›ä¸åŒçš„ç±»å‹ã€‚è€Œinitæ–¹æ³•ï¼Œæ˜¯åˆå§‹åŒ–å¯¹è±¡å±æ€§çš„æ–¹æ³•ï¼Œåœ¨è¿™é‡Œæˆ‘å¯ä»¥æ ¹æ®æ¡ä»¶ç»™ç±»æ·»åŠ ä¸€äº›å±æ€§ã€‚ä¸çŸ¥é“æˆ‘ä¸Šé¢å…³äºå…ƒç±»çš„ç†è§£å¯¹ä¸å¯¹ã€‚","like_count":0},{"had_liked":false,"id":106342,"user_name":"lllong33","can_delete":false,"product_type":"c1","uid":1528751,"ip_address":"","ucode":"5D012385994C3D","user_header":"https://static001.geekbang.org/account/avatar/00/17/53/af/e5bf5d08.jpg","comment_is_top":false,"comment_ctime":1561274372,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561274372","product_id":100026901,"comment_content":"metaclass å¼€å‘æ¡†æ¶å±‚é¢çš„ Python åº“æ—¶ä½¿ç”¨ï¼Œåº”ç”¨å±‚ä¸é€‚ç”¨ã€‚å”¯ä¸€çœ‹åˆ°è¿‡å°±æ˜¯çœ‹åˆ«äººå†™çš„ç®€æ˜“çˆ¬è™«æ¡†æ¶æºç è§è¿‡ã€‚yamlæ¨¡å—ä¹Ÿæ²¡æœ‰ç”¨ï¼Œjsonç”¨çš„æœ€å¤šï¼Œè·¯å¾ˆé•¿å•Šï¼Œ","like_count":0},{"had_liked":false,"id":106182,"user_name":"å°ä¾ é¾™æ—‹é£","can_delete":false,"product_type":"c1","uid":1126441,"ip_address":"","ucode":"073F3924A99835","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/29/d6816ebf.jpg","comment_is_top":false,"comment_ctime":1561197192,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561197192","product_id":100026901,"comment_content":"æˆ‘é»˜è®¤å®‰è£…æœ€æ–°çš„pyyaml5.1ç‰ˆæœ¬ä¸Šé¢çš„æ¡ˆä¾‹æ²¡è¿è¡Œé€šè¿‡ï¼Œéœ€è¦pip install PyYAML==3.10å®‰è£…è¿™ä¸ªç‰ˆæœ¬æ‰è¡Œã€‚<br>è¯·æ•™è€å¸ˆï¼Œç»§æ‰¿äºyaml.YAMLObjectçš„ç±»èƒ½å¦é‡å†™__call__()ä½¿ä¹‹å˜æˆç±»è£…é¥°å™¨ï¼Œè¿™æ ·ä½¿ç”¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä¼šä¸ä¼šæ›´ç®€ä¾¿å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":105609,"user_name":"Geek_974cd5","can_delete":false,"product_type":"c1","uid":1528654,"ip_address":"","ucode":"5A6BC28919AD4D","user_header":"","comment_is_top":false,"comment_ctime":1561041108,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561041108","product_id":100026901,"comment_content":"è£…é¥°å™¨åœ¨ä¸å½±å“ä»£ç æ•´ä½“ä¸šåŠ¡é€»è¾‘çš„åŸºç¡€ä¸Šï¼Œæ–¹ä¾¿ä»£ç çš„è°ƒè¯•ï¼Œè·Ÿè¸ªï¼Œæ—¥å¿—è®°å½•ç­‰ï¼›<br>metaclassæ›´å¤šçš„å¼ºè°ƒåŠ¨æ€æ€§ï¼Œéœ€è¦æœ‰å®‰å…¨æ€§ï¼Œå®Œæ•´æ€§æ ¡éªŒçš„ä»£ç åšä¿éšœï¼Œå®¹æ˜“é€ æˆååºåˆ—åŒ–æ¼æ´ï¼›","like_count":0},{"had_liked":false,"id":105415,"user_name":"yshan","can_delete":false,"product_type":"c1","uid":1136788,"ip_address":"","ucode":"A2ECDCDA52B8EE","user_header":"https://static001.geekbang.org/account/avatar/00/11/58/94/c8bc2b59.jpg","comment_is_top":false,"comment_ctime":1560995205,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560995205","product_id":100026901,"comment_content":"å¦ä¸€æ–¹é¢ï¼Œä¹Ÿæ˜¯å¯¹åˆå­¦è€…çš„ç§‘æ™®å’Œè­¦å‘Šï¼šä¸è¦è½»æ˜“å°è¯• mateclassã€‚","like_count":0},{"had_liked":false,"id":105292,"user_name":"zengyunda","can_delete":false,"product_type":"c1","uid":1359389,"ip_address":"","ucode":"3F08F16FB92C8E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ic76sMTwXTJYJQglBTHVian3OHibEuvGXuRH5QibvwqVIsUNa8pzRYkmsbXjLp1eacN1vC77EVKe4k5u7RRVFb3dOg/132","comment_is_top":false,"comment_ctime":1560956110,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560956110","product_id":100026901,"comment_content":"æ³¨å®šæˆä¸ºä¸äº†1%çš„äººï¼Œè¿™ä¸€è®²ä¼¼æ‡‚éæ‡‚çš„","like_count":0},{"had_liked":false,"id":105164,"user_name":"John Si","can_delete":false,"product_type":"c1","uid":1526611,"ip_address":"","ucode":"705B90724A4BD4","user_header":"https://static001.geekbang.org/account/avatar/00/17/4b/53/67c08006.jpg","comment_is_top":false,"comment_ctime":1560931963,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560931963","product_id":100026901,"comment_content":"è£…é¥°å™¨è·Ÿmetaclassè¿™ä¸¤èŠ‚è¯¾å†…å®¹éƒ½å¾ˆå¤æ‚ï¼Œä¸çŸ¥è€å¸ˆèƒ½å¦å†è¯¦ç»†è¯´æ˜ä¸€ä¸‹ï¼Œè°¢è°¢è€å¸ˆ","like_count":0},{"had_liked":false,"id":105009,"user_name":"enjoylearning","can_delete":false,"product_type":"c1","uid":1000237,"ip_address":"","ucode":"DCAF8538DEA277","user_header":"https://static001.geekbang.org/account/avatar/00/0f/43/2d/af86d73f.jpg","comment_is_top":false,"comment_ctime":1560905165,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560905165","product_id":100026901,"comment_content":"è§‰å¾—metaclassæ›´åƒc#ç­‰ç±»å‹ç¼–è¯‘è¯­è¨€çš„åå°„","like_count":0},{"had_liked":false,"id":104992,"user_name":"code2","can_delete":false,"product_type":"c1","uid":1281792,"ip_address":"","ucode":"BBA5748FB6A01C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/8OPzdpDraQMvCNWAicicDt54sDaIYJZicBLfMyibXVs4V0ZibEdkZlbzxxL7aGpRoeyvibag5LaAaaGKSdwYQMY2hUrQ/132","comment_is_top":false,"comment_ctime":1560903681,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560903681","product_id":100026901,"comment_content":"metaclassè¯‘ä¸º å˜å¼‚ç±» å¦‚ä½•ï¼Ÿ","like_count":0},{"had_liked":false,"id":104942,"user_name":"å¤œè·¯ç ´æ™“","can_delete":false,"product_type":"c1","uid":1353577,"ip_address":"","ucode":"9B875F94B759B9","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/3hZfficKPGCq2kjFBu9SgaMjibJTEl7iaW1ta6pZNyiaWP8XEsNpunlnsiaOtBpWTXfT5BvRP3qNByml6p9rtBvqewg/132","comment_is_top":false,"comment_ctime":1560876290,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1560876290","product_id":100026901,"comment_content":"è¯·é€šä¿—åœ°è§£é‡Šä¸‹ï¼Œobjectå’Œtypeä¹‹é—´çš„å…³ç³»ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1051873,"avatar":"https://static001.geekbang.org/account/avatar/00/10/0c/e1/f663213e.jpg","nickname":"æ‹¾æ‡æ‹¾æ‡","note":"","ucode":"D775F374C2A1D3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":170561,"discussion_content":"objectæ˜¯typeçš„å®ä¾‹ï¼Œtypeåˆæ˜¯objectçš„å­ç±»ï¼Œtypeæ˜¯è‡ªå·±çš„å®ä¾‹ã€‚listã€strã€dictã€tupleæ˜¯objectçš„å­ç±»ï¼Œä¹Ÿæ˜¯typeçš„å®ä¾‹ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1581679499,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}