{"id":164829,"title":"33 | 实现客户端编解码","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geek_netty\">https://gitee.com/geektime-geekbang/geek_netty</a></p>","comments":[{"had_liked":false,"id":193526,"user_name":"yang","can_delete":false,"product_type":"c3","uid":1074310,"ip_address":"","ucode":"1AA1497C5A293C","user_header":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","comment_is_top":false,"comment_ctime":1584923643,"is_pvip":false,"replies":[{"id":78823,"content":"我的机器上是：alt+shift+r，如果不行，你看下reactor-&gt;rename你的机器上是什么就可以了。","user_name":"作者回复","user_name_real":"stroller","uid":1638649,"ctime":1588056069,"ip_address":"","comment_id":193526,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"1. 服务端编码的，客户端需要解码；\n    客户端编码的，服务端需要解码。\n    成对出现。\n2. 解决粘包&#47;半包问题采用了定长的Frame来解决。\n3. 代码量是真的好少。\n老师，你那个快捷键 — 改一个局部变量的名称，倍用到的地方也被修改了，这个快捷键是啥组合啊？","like_count":1,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488575,"discussion_content":"我的机器上是：alt+shift+r，如果不行，你看下reactor-&amp;gt;rename你的机器上是什么就可以了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588056069,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1107153,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e4/d1/002f9955.jpg","nickname":"小马哥","note":"","ucode":"376833AC2A1589","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":222730,"discussion_content":"Shift+F6","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586169618,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1074310,"avatar":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","nickname":"yang","note":"","ucode":"1AA1497C5A293C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1107153,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e4/d1/002f9955.jpg","nickname":"小马哥","note":"","ucode":"376833AC2A1589","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":222766,"discussion_content":"谢谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586173357,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":222730,"ip_address":"","group_id":0},"score":222766,"extra":""}]}]},{"had_liked":false,"id":189158,"user_name":"留白的艺术","can_delete":false,"product_type":"c3","uid":1512848,"ip_address":"","ucode":"285B86B5D53DB8","user_header":"https://static001.geekbang.org/account/avatar/00/17/15/90/b5b662ff.jpg","comment_is_top":false,"comment_ctime":1584461693,"is_pvip":false,"replies":[{"id":78829,"content":"我特地查了下他长啥样，哈哈","user_name":"作者回复","user_name_real":"stroller","uid":1638649,"ctime":1588056370,"ip_address":"","comment_id":189158,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"咋一看还以为是郭晋安在讲Netty","like_count":1,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487619,"discussion_content":"我特地查了下他长啥样，哈哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588056370,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1512848,"avatar":"https://static001.geekbang.org/account/avatar/00/17/15/90/b5b662ff.jpg","nickname":"留白的艺术","note":"","ucode":"285B86B5D53DB8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":252020,"discussion_content":"明明可以靠颜值，偏偏靠实力取胜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588133802,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":176025,"user_name":"Fly55","can_delete":false,"product_type":"c3","uid":1251563,"ip_address":"","ucode":"FFA9D5C6EDD6F4","user_header":"https://static001.geekbang.org/account/avatar/00/13/18/eb/fd0b4a1f.jpg","comment_is_top":false,"comment_ctime":1580913639,"is_pvip":false,"replies":[{"id":68849,"content":"同样如此，没办法，在家就是给社会做贡献！","user_name":"作者回复","user_name_real":"stroller","uid":1638649,"ctime":1581360794,"ip_address":"","comment_id":176025,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"在家办公打卡","like_count":1,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483000,"discussion_content":"同样如此，没办法，在家就是给社会做贡献！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581360794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":185704,"user_name":"被过去推开","can_delete":false,"product_type":"c3","uid":1276690,"ip_address":"","ucode":"8B4F34FE93FD5B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Cib5umA0W17N9pichI08pnrXAExdbyh7AVzH4nEhD6KN3FXuELk4LJJuqUPPD7xmIy9nq5Hjbgnzic7sVZG5BKiaUQ/132","comment_is_top":false,"comment_ctime":1583667993,"is_pvip":false,"replies":[{"id":79278,"content":"是的","user_name":"作者回复","user_name_real":"stroller","uid":1638649,"ctime":1588641667,"ip_address":"","comment_id":185704,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"改一改就可以了，相当轻松","like_count":0,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486469,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588641667,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":176664,"user_name":"孤帆","can_delete":false,"product_type":"c3","uid":1053914,"ip_address":"","ucode":"8CC9AAF28944EB","user_header":"https://static001.geekbang.org/account/avatar/00/10/14/da/0a012c26.jpg","comment_is_top":false,"comment_ctime":1581133355,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"哈哈 天下代码一大抄 👍","like_count":1},{"had_liked":false,"id":151169,"user_name":"吴玉","can_delete":false,"product_type":"c3","uid":1099289,"ip_address":"","ucode":"AFB99044202760","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/19/d9350a8e.jpg","comment_is_top":false,"comment_ctime":1573660208,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"👍","like_count":1},{"had_liked":false,"id":299938,"user_name":"何妨","can_delete":false,"product_type":"c3","uid":1385377,"ip_address":"","ucode":"EC3983BFF7992A","user_header":"https://static001.geekbang.org/account/avatar/00/15/23/a1/b08f3ee7.jpg","comment_is_top":false,"comment_ctime":1624929137,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"问下，统一成一个 message 不是更好吗？一套编解码就行了","like_count":0},{"had_liked":false,"id":236936,"user_name":"思绪走了灬光✨","can_delete":false,"product_type":"c3","uid":1101661,"ip_address":"","ucode":"512DD0FA5C024C","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/5d/99756164.jpg","comment_is_top":false,"comment_ctime":1595593405,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"老师不知道您有没有读过netty-socketio 这个框架，想请教一下其中的AckManager 的设计思想，有个疑问，调用client.sendEvent(String event,AckCallback&lt;?&gt; ackCallback ,Object ...data) 如果服务端没有收到客户端的ack,那要如何设置重发？","like_count":0},{"had_liked":false,"id":229907,"user_name":"旭","can_delete":false,"product_type":"c3","uid":1664437,"ip_address":"","ucode":"EB7B3C3FE2044F","user_header":"https://static001.geekbang.org/account/avatar/00/19/65/b5/bcbe963e.jpg","comment_is_top":false,"comment_ctime":1593184038,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"老师，今天做netty 客户端调用服务端。客户端抛出了这么一个异常，搞了一下午也没有解决，求教老师。\n16:54:37.978 spring-boot-logging [http-nio-18081-exec-2] WARN  io.netty.channel.AbstractChannel - Force-closing a channel whose registration task was not accepted by an event loop: [id: 0xa6e31f29]\njava.util.concurrent.RejectedExecutionException: event executor terminated\n\tat io.netty.util.concurrent.SingleThreadEventExecutor.reject(SingleThreadEventExecutor.java:987)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor.offerTask(SingleThreadEventExecutor.java:388)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor.addTask(SingleThreadEventExecutor.java:381)\n\tat io.netty.util.concurrent.SingleThreadEventExecutor.execute(SingleThreadEventExecutor.java:886)\n\tat io.netty.channel.AbstractChannel$AbstractUnsafe.register(AbstractChannel.java:472)\n\tat io.netty.channel.SingleThreadEventLoop.register(SingleThreadEventLoop.java:87)\n\tat io.netty.channel.SingleThreadEventLoop.register(SingleThreadEventLoop.java:81)\n\tat io.netty.channel.MultithreadEventLoopGroup.register(MultithreadEventLoopGroup.java:86)\n\tat io.netty.bootstrap.AbstractBootstrap.initAndRegister(AbstractBootstrap.java:311)\n\tat io.netty.bootstrap.Bootstrap.doResolveAndConnect(Bootstrap.java:157)\n\tat io.netty.bootstrap.Bootstrap.connect(Bootstrap.java:118)\n\n这个情况是，我把服务重启一下。第一次调用没问题，第二次调用就会出这个错误。\n出这个错误，是因为传输的xml 数据中有图片，数据量较大。就会出现这个问题。\n同样的netty客户端，调用另外一个接口，传输的数据不携带图片。就不会出现这个错误。\n求教老师解答，谢谢啦","like_count":0},{"had_liked":false,"id":193869,"user_name":"NoBody","can_delete":false,"product_type":"c3","uid":1173766,"ip_address":"","ucode":"72E1B4FCDA2469","user_header":"https://static001.geekbang.org/account/avatar/00/11/e9/06/038a9cea.jpg","comment_is_top":false,"comment_ctime":1584975613,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"打卡打卡","like_count":0}]}