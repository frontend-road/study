{"id":169944,"title":"27 | API网关：系统的门面要如何做呢？","content":"<p>你好，我是唐扬。</p><p>到目前为止，你的垂直电商系统在经过微服务化拆分之后已经运行了一段时间了，系统的扩展性得到了很大的提升，也能够比较平稳地度过高峰期的流量了。</p><p>不过最近你发现，随着自己的电商网站知名度越来越高，系统迎来了一些“不速之客”，在凌晨的时候，系统中的搜索商品和用户接口的调用量会急剧上升，持续一段时间之后又回归正常。</p><p><strong>这些搜索请求有一个共同特征是来自固定的几台设备。</strong>当你在搜索服务上加一个针对设备ID的限流功能之后，凌晨的高峰搜索请求不见了。但是不久之后，用户服务也出现了大量爬取用户信息的请求，商品接口出现了大量爬取商品信息的请求。你不得不在这两个服务上也增加一样的限流策略。</p><p><strong>但是这样会有一个问题：</strong>不同的三个服务上使用同一种策略，在代码上会有冗余，无法做到重用，如果其他服务上也出现类似的问题，还要通过拷贝代码来实现，肯定是不行的。</p><p>不过作为Java程序员，<strong>你很容易想到：</strong>将限流的功能独立成一个单独的jar包给这三个服务来引用。不过你忽略了一种情况，那就是你的电商团队使用的除了Java，还有PHP和Go等多种语言。</p><p>用多种语言开发的服务是没有办法使用jar包来实现限流功能的，<strong>这时你需要引入API网关。</strong></p><!-- [[[read_end]]] --><h2>API网关起到的作用</h2><p>API网关（API Gateway）不是一个开源组件，而是一种架构模式，它是将一些服务共有的功能整合在一起，独立部署为单独的一层，用来解决一些服务治理的问题。你可以把它看作系统的边界，它可以对出入系统的流量做统一的管控。</p><p>在我看来，API网关可以分为两类：<strong>一类叫做入口网关，一类叫做出口网关。</strong></p><p>入口网关是我们经常使用的网关种类，它部署在负载均衡服务器和应用服务器之间，<strong>主要有几方面的作用。</strong></p><ol>\n<li>\n<p>它提供客户端一个统一的接入地址，API网关可以将用户的请求动态路由到不同的业务服务上，并且做一些必要的协议转换工作。<strong>在你的系统中，你部署的微服务对外暴露的协议可能不同：</strong>有些提供的是HTTP服务；有些已经完成RPC改造，对外暴露RPC服务；有些遗留系统可能还暴露的是Web Service服务。API网关可以对客户端屏蔽这些服务的部署地址以及协议的细节，给客户端的调用带来很大的便捷。</p>\n</li>\n<li>\n<p>另一方面，在API网关中，我们可以植入一些服务治理的策略，比如服务的熔断、降级、流量控制和分流等等（关于服务降级和流量控制的细节，我会在后面的课程中具体讲解，在这里你只要知道它们可以在API网关中实现就可以了）。</p>\n</li>\n<li>\n<p>再有，客户端的认证和授权的实现，也可以放在API网关中。你要知道，不同类型的客户端使用的认证方式是不同的。<strong>在我之前项目中，</strong>手机APP使用Oauth协议认证，HTML5端和Web端使用Cookie认证，内部服务使用自研的Token认证方式。这些认证方式在API网关上可以得到统一处理，应用服务不需要了解认证的细节。</p>\n</li>\n<li>\n<p>另外，API网关还可以做一些与黑白名单相关的事情，比如针对设备ID、用户IP、用户ID等维度的黑白名单。</p>\n</li>\n<li>\n<p>最后，在API网关中也可以做一些日志记录的事情，比如记录HTTP请求的访问日志，我在<a href=\"https://time.geekbang.org/column/article/167979\">25讲</a>中讲述分布式追踪系统时，提到的标记一次请求的requestId也可以在网关中来生成。</p>\n</li>\n</ol><p><img src=\"https://static001.geekbang.org/resource/image/e7/25/e7fef913472514fb01f4c8ee112d0325.jpg?wh=1142*472\" alt=\"\"></p><p><strong>出口网关就没有这么丰富的功能和作用了。</strong>我们在系统开发中，会依赖很多外部的第三方系统，典型的例子：第三方账户登录、使用第三方工具支付等等。我们可以在应用服务器和第三方系统之间，部署出口网关，在出口网关中，对调用外部的API做统一的认证、授权、审计以及访问控制。</p><p><img src=\"https://static001.geekbang.org/resource/image/cd/63/cd4174a43b289b0538811293a93daf63.jpg?wh=1142*662\" alt=\"\"></p><p>我花一定的篇幅去讲API网关起到的作用，主要是想让你了解，API网关可以解决什么样的实际问题。这样一来，当你在面对这些问题时，你就会有解决的思路，不会手足无措了。</p><h2>API网关要如何实现</h2><p>了解API网关的作用之后，接下来，我们来看看API网关在实现中需要关注哪些点，以及常见的开源API网关有哪些，这样，你在实际工作中，无论是考虑自研API网关还是使用开源的实现都会比较自如了。</p><p>在实现一个API网关时，你首先要考虑的是它的性能。这很好理解，API入口网关承担从客户端的所有流量。假如业务服务处理时间是10ms，而API网关的耗时在1ms，那么相当于每个接口的响应时间都要增加10%，这对于性能的影响无疑是巨大的。而提升API网关性能的关键还是在I/O模型上（我在<a href=\"https://time.geekbang.org/column/article/165765\">23讲</a>中详细讲到过），这里只是举一个例子来说明I/O模型对于性能的影响。</p><p>Netfix开源的API网关Zuul，在1.0版本的时候使用的是同步阻塞I/O模型，整体系统其实就是一个servlet，在接收到用户的请求，然后执行在网关中配置的认证、协议转换等逻辑之后，调用后端的服务获取数据返回给用户。</p><p>而在Zuul2.0中，Netfix团队将servlet改造成了一个netty server（netty服务），采用I/O多路复用的模型处理接入的I/O请求，并且将之前同步阻塞调用后端服务的方式，改造成使用netty client（netty客户端）非阻塞调用的方式。改造之后，Netfix团队经过测试发现性能提升了20%左右。</p><p>除此之外，API网关中执行的动作有些是可以预先定义好的，比如黑白名单的设置，接口动态路由；有些则是需要业务方依据自身业务来定义。<strong>所以，API网关的设计要注意扩展性，</strong>也就是你可以随时在网关的执行链路上增加一些逻辑，也可以随时下掉一些逻辑（也就是所谓的热插拔）。</p><p>所以一般来说，我们可以把每一个操作定义为一个filter（过滤器），然后使用“责任链模式”将这些filter串起来。责任链可以动态地组织这些filter，解耦filter之间的关系，无论是增加还是减少filter，都不会对其他的filter有任何的影响。</p><p><strong>Zuul就是采用责任链模式，</strong>Zuul1中将filter定义为三类：pre routing filter（路由前过滤器）、routing filter（路由过滤器）和after routing filter（路由后过滤器）。每一个filter定义了执行的顺序，在filter注册时，会按照顺序插入到filter chain（过滤器链）中。这样Zuul在接收到请求时，就会按照顺序依次执行插入到filter chain中的filter了。</p><p><img src=\"https://static001.geekbang.org/resource/image/a1/88/a1c11d4059e55b0521dd0cf19cf73488.jpg?wh=1142*884\" alt=\"\"></p><p><strong>另外还需要注意的一点是，</strong>为了提升网关对于请求的并行处理能力，我们一般会使用线程池来并行的执行请求。<strong>不过，这就带来一个问题：</strong>如果商品服务出现问题造成响应缓慢，那么调用商品服务的线程就会被阻塞无法释放，久而久之，线程池中的线程就会被商品服务所占据，那么其他服务也会受到级联的影响。因此，我们需要针对不同的服务做线程隔离或者保护。<strong>在我看来有两种思路：</strong></p><ul>\n<li>\n<p>如果你后端的服务拆分得不多，可以针对不同的服务，采用不同的线程池，这样商品服务的故障就不会影响到支付服务和用户服务了；</p>\n</li>\n<li>\n<p>在线程池内部可以针对不同的服务甚至不同的接口做线程的保护。比如说，线程池的最大线程数是1000，那么可以给每个服务设置一个最多可以使用的配额。</p>\n</li>\n</ul><p>一般来说，服务的执行时间应该在毫秒级别，线程被使用后会很快被释放回到线程池给后续请求使用，同时处于执行中的线程数量不会很多，对服务或者接口设置线程的配额不会影响到正常的执行。可是一旦发生故障，某个接口或者服务的响应时间变长，造成线程数暴涨，但是因为有配额的限制，也就不会影响到其他的接口或者服务了。</p><p><strong>你在实际应用中也可以将这两种方式结合，</strong>比如说针对不同的服务使用不同的线程池，在线程池内部针对不同的接口设置配额。</p><p>以上就是实现API网关的一些关键的点，你如果要自研API网关服务的话可以参考借鉴。另外API网关也有很多开源的实现，目前使用比较广泛的有以下几个：</p><ul>\n<li>\n<p><a href=\"https://konghq.com/faqs/\">Kong</a>是在Nginx中运行的Lua程序。得益于Nginx的性能优势，Kong相比于其它的开源API网关来说，性能方面是最好的。由于大中型公司对于Nginx运维能力都比较强，所以选择Kong作为API网关，无论是在性能还是在运维的把控力上，都是比较好的选择；</p>\n</li>\n<li>\n<p><a href=\"https://github.com/Netflix/zuul\">Zuul</a>是Spring Cloud全家桶中的成员，如果你已经使用了Spring Cloud中的其他组件，那么也可以考虑使用Zuul和它们无缝集成。不过，Zuul1因为采用同步阻塞模型，所以在性能上并不是很高效，而Zuul2推出时间不长，难免会有坑。但是Zuul的代码简单易懂，可以很好地把控，并且你的系统的量级很可能达不到Netfix这样的级别，所以对于Java技术栈的团队，使用Zuul也是一个不错的选择；</p>\n</li>\n<li>\n<p><a href=\"https://tyk.io/\">Tyk</a>是一种Go语言实现的轻量级API网关，有着丰富的插件资源，对于Go语言栈的团队来说，也是一种不错的选择。</p>\n</li>\n</ul><p><strong>那么你要考虑的是，</strong>这些开源项目适不适合作为API网关供自己使用。而接下来，我以电商系统为例，带你将API网关引入我们的系统之中。</p><h2>如何在你的系统中引入API网关</h2><p>目前为止，我们的电商系统已经经过了服务化改造，在服务层和客户端之间有一层薄薄的Web层，<strong>这个Web层做的事情主要有两方面：</strong></p><p>一方面是对服务层接口数据的聚合。比如，商品详情页的接口可能会聚合服务层中，获取商品信息、用户信息、店铺信息以及用户评论等多个服务接口的数据；</p><p>另一方面Web层还需要将HTTP请求转换为RPC请求，并且对前端的流量做一些限制，对于某些请求添加设备ID的黑名单等等。</p><p>因此，我们在做改造的时候，可以先将API网关从Web层中独立出来，将协议转换、限流、黑白名单等事情挪到API网关中来处理，形成独立的入口网关层；</p><p>而针对服务接口数据聚合的操作，<strong>一般有两种解决思路：</strong></p><ol>\n<li>\n<p>再独立出一组网关专门做服务聚合、超时控制方面的事情，我们一般把前一种网关叫做流量网关，后一种可以叫做业务网关；</p>\n</li>\n<li>\n<p>抽取独立的服务层，专门做接口聚合的操作。这样服务层就大概分为原子服务层和聚合服务层。</p>\n</li>\n</ol><p>我认为，接口数据聚合是业务操作，与其放在通用的网关层来实现，不如放在更贴近业务的服务层来实现，<strong>所以，我更倾向于第二种方案。</strong></p><p><img src=\"https://static001.geekbang.org/resource/image/ab/f2/ab701c40ed8229606a4bf90db327c2f2.jpg?wh=1142*496\" alt=\"\"></p><p>同时，我们可以在系统和第三方支付服务，以及登陆服务之间部署出口网关服务。原先，你会在拆分出来的支付服务中完成对于第三方支付接口所需要数据的加密、签名等操作，再调用第三方支付接口完成支付请求。现在，你把对数据的加密、签名的操作放在出口网关中，这样一来，支付服务只需要调用出口网关的统一支付接口就可以了。</p><p>在引入了API网关之后，我们的系统架构就变成了下面这样：</p><p><img src=\"https://static001.geekbang.org/resource/image/76/da/766076d1193755a50a325e744bc452da.jpg?wh=1142*832\" alt=\"\"></p><h2>课程小结</h2><p>本节课我带你了解了API网关在系统中的作用，在实现中的一些关键的点，以及如何将API网关引入你的系统，<strong>我想强调的重点如下：</strong></p><ol>\n<li>\n<p>API网关分为入口网关和出口网关两类，入口网关作用很多，可以隔离客户端和微服务，从中提供协议转换、安全策略、认证、限流、熔断等功能。出口网关主要是为调用第三方服务提供统一的出口，在其中可以对调用外部的API做统一的认证、授权、审计以及访问控制；</p>\n</li>\n<li>\n<p>API网关的实现重点在于性能和扩展性，你可以使用多路I/O复用模型和线程池并发处理，来提升网关性能，使用责任链模式来提升网关的扩展性；</p>\n</li>\n<li>\n<p>API网关中的线程池可以针对不同的接口或者服务做隔离和保护，这样可以提升网关的可用性；</p>\n</li>\n<li>\n<p>API网关可以替代原本系统中的Web层，将Web层中的协议转换、认证、限流等功能挪入到API网关中，将服务聚合的逻辑下沉到服务层。</p>\n</li>\n</ol><p>API网关可以为API的调用提供便捷，也可以为将一些服务治理的功能独立出来，达到复用的目的，虽然在性能上可能会有一些损耗，<strong>但是一般来说，</strong>使用成熟的开源API网关组件，这些损耗都是可以接受的。所以，当你的微服务系统越来越复杂时，你可以考虑使用API网关作为整体系统的门面。</p><h2>一课一思</h2><p>你的项目中是否有使用API网关呢？你在使用API网关的时候，遇到过什么样的问题吗？欢迎在留言区与我分享你的经验。</p><p>最后，感谢你的阅读，如果这篇文章让你有所收获，也欢迎你将它分享给更多的朋友。</p>","neighbors":{"left":{"article_title":"26 | 负载均衡：怎样提升系统的横向扩展能力？","id":169011},"right":{"article_title":"28 | 多机房部署：跨地域的分布式系统如何做？","id":171115}},"comments":[{"had_liked":false,"id":155022,"user_name":"Julien","can_delete":false,"product_type":"c1","uid":1204568,"ip_address":"","ucode":"2A3F0CF46B4034","user_header":"https://static001.geekbang.org/account/avatar/00/12/61/58/7b078879.jpg","comment_is_top":false,"comment_ctime":1574637413,"is_pvip":false,"replies":[{"id":"59474","content":"作用不同，负载均衡作用是分流，API网关作用是服务治理","user_name":"作者回复","comment_id":155022,"uid":"1448977","ip_address":"","utype":1,"ctime":1574642203,"user_name_real":"唐扬"}],"discussion_count":1,"race_medal":0,"score":"113243787109","product_id":100035801,"comment_content":"上一讲的负载均衡和这一讲的API网关是什么关系呢？","like_count":27,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475638,"discussion_content":"作用不同，负载均衡作用是分流，API网关作用是服务治理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574642203,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":177482,"user_name":"小洛","can_delete":false,"product_type":"c1","uid":1005062,"ip_address":"","ucode":"227EC21891012B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/56/06/ea49b29d.jpg","comment_is_top":false,"comment_ctime":1581402639,"is_pvip":false,"replies":[{"id":"68988","content":"这样也好","user_name":"作者回复","comment_id":177482,"uid":"1448977","ip_address":"","utype":1,"ctime":1581490101,"user_name_real":"唐扬"}],"discussion_count":3,"race_medal":0,"score":"78890813967","product_id":100035801,"comment_content":"之前用zuul做过网关，思路和老师说的大同小异，有授权，有检验，有限流熔断，也有线程池隔离等，就是聚合服务没有抽成单独的服务来做，因为在组织架构上，大家都不想接手这种聚合别人接口的服务，有时候这种非技术的问题让人特别困惑！所以当初就设计了一个配置api中可以配置多个服务接口，网关把结果整合，然后json返回了！","like_count":19,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483443,"discussion_content":"这样也好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581490101,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1307497,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f3/69/7039d03f.jpg","nickname":"书策稠浊","note":"","ucode":"A29875CE15FDA3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":399020,"discussion_content":"这个行不通吧，因为组合是个业务过程，中间应该会有业务逻辑的。除非业务极其简单，但是业务极其简单的话就不需要微服务了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632887826,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1316926,"avatar":"https://static001.geekbang.org/account/avatar/00/14/18/3e/f8632713.jpg","nickname":"EveryDayIsNew","note":"","ucode":"776B81EF6830FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":340955,"discussion_content":"先点个赞，这种做法我理解也会带来其他的问题，比如返回的结果内容比较难解析，相关的不相关的都会组合在一起，不同场景也会对组合要求不一样，并且有的字段多，有的字段少会造成整体返回的内容整体格式不可控。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610242287,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":201097,"user_name":"Darren","can_delete":false,"product_type":"c1","uid":1254968,"ip_address":"","ucode":"CCD2B2C492BE9A","user_header":"https://static001.geekbang.org/account/avatar/00/13/26/38/ef063dc2.jpg","comment_is_top":false,"comment_ctime":1585714777,"is_pvip":true,"replies":[{"id":"75829","content":"是的","user_name":"作者回复","comment_id":201097,"uid":"1448977","ip_address":"","utype":1,"ctime":1586087689,"user_name_real":"唐扬"}],"discussion_count":2,"race_medal":0,"score":"53125322329","product_id":100035801,"comment_content":"Spring cloud gateway 性能比zuul好一些，并且是异步的","like_count":13,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490239,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586087689,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1271918,"avatar":"https://static001.geekbang.org/account/avatar/00/13/68/6e/eb079ed7.jpg","nickname":"永健_何","note":"","ucode":"7746F1B2A7542A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":304582,"discussion_content":"我想请教下，有没有通过apache knox的网关实现方案啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599620160,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":155421,"user_name":"张德","can_delete":false,"product_type":"c1","uid":1101929,"ip_address":"","ucode":"31FE63E8725EFC","user_header":"https://static001.geekbang.org/account/avatar/00/10/d0/69/5dbdc245.jpg","comment_is_top":false,"comment_ctime":1574687482,"is_pvip":false,"replies":[{"id":"60242","content":"就是请求在经过网关后，先做oauth的认证，认证成功后，将一些用户信息写入到request里面，这样业务服务器就不需要关心认证了","user_name":"作者回复","comment_id":155421,"uid":"1448977","ip_address":"","utype":1,"ctime":1575015807,"user_name_real":"唐扬"}],"discussion_count":2,"race_medal":0,"score":"35934425850","product_id":100035801,"comment_content":"老师   请教一下   这个oauth2.0的登录认证   请求是先经过网关后验证是否登录了  还是什么别的流程  能否讲一下这个架构下   登录鉴权应该怎么做？？？","like_count":9,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475747,"discussion_content":"就是请求在经过网关后，先做oauth的认证，认证成功后，将一些用户信息写入到request里面，这样业务服务器就不需要关心认证了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1575015807,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1022247,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/99/27/47aa9dea.jpg","nickname":"阿卡牛","note":"","ucode":"0BC43A904C3199","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":60571,"discussion_content":"网上相关资源一大堆，建议自行搜索解决","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574738794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":156034,"user_name":"刘冲","can_delete":false,"product_type":"c1","uid":1000439,"ip_address":"","ucode":"0C4F66921AE76C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/43/f7/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1574814682,"is_pvip":false,"replies":[{"id":"60247","content":"这种安全策略可以放在API网关中来做","user_name":"作者回复","comment_id":156034,"uid":"1448977","ip_address":"","utype":1,"ctime":1575016170,"user_name_real":"唐扬"}],"discussion_count":4,"race_medal":0,"score":"23049651162","product_id":100035801,"comment_content":"请问，像sql注入拦截这种工作，是后端每个微服务要做的事情呢？还是都应该只需要放在api网关来做？","like_count":4,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475965,"discussion_content":"这种安全策略可以放在API网关中来做","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575016170,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1024486,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a1/e6/50da1b2d.jpg","nickname":"旭东(Frank)","note":"","ucode":"176FA629800062","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":85337,"discussion_content":"网关就是公路进京安检站😂","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1576541159,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1013283,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/23/31e5e984.jpg","nickname":"空知","note":"","ucode":"C448E98238DD36","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":203025,"discussion_content":"每个服务也要做!安全没有100%~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583986223,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1730331,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/67/1b/0f564174.jpg","nickname":"陈景军","note":"","ucode":"493D28C70B14B0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":176075,"discussion_content":"api不应该是尽量不要涉及跟业务逻辑的嘛？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582020268,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":181372,"user_name":"Xiang","can_delete":false,"product_type":"c1","uid":1000070,"ip_address":"","ucode":"374744FF627C00","user_header":"https://static001.geekbang.org/account/avatar/00/0f/42/86/d05de870.jpg","comment_is_top":false,"comment_ctime":1582530330,"is_pvip":true,"replies":[{"id":"71112","content":"谢谢，我研究一下","user_name":"作者回复","comment_id":181372,"uid":"1448977","ip_address":"","utype":1,"ctime":1583115475,"user_name_real":"唐扬"}],"discussion_count":1,"race_medal":0,"score":"18762399514","product_id":100035801,"comment_content":"apisix 这个API网关性能很好  https:&#47;&#47;github.com&#47;apache&#47;incubator-apisix","like_count":4,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484977,"discussion_content":"谢谢，我研究一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583115475,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":221225,"user_name":"Hesher","can_delete":false,"product_type":"c1","uid":1026832,"ip_address":"","ucode":"99AB8B1704CB7E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ab/10/b812ff3e.jpg","comment_is_top":false,"comment_ctime":1590451114,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14475353002","product_id":100035801,"comment_content":"出口网关这个概念还是第一次听到，感谢老师。对于出口网关，做与三方机构接口调用的封装、鉴权和审计。<br><br>但问题是第三方接口调用逻辑（比如调用哪几个接口、顺序是什么样的）、鉴权方式差异很大，都放在出口网关去封装，不是反而互相耦合了吗？我这边支付系统是把同类逻辑抽离出来，具体的接口调用和鉴权流程，是对每个二方或三方平台单独部署的微服务。<br><br>老师能否在细化讲一下出口网关呢？","like_count":4,"discussions":[{"author":{"id":1308729,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f8/39/4089c9b5.jpg","nickname":"胖子罗","note":"","ucode":"AF45AEED6064B3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547411,"discussion_content":"嗯 同问老师能否多讲讲出口网关","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642662391,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":211898,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1588037265,"is_pvip":false,"replies":[{"id":"78851","content":"是的，可能开发同学了解不多","user_name":"作者回复","comment_id":211898,"uid":"1448977","ip_address":"","utype":1,"ctime":1588069858,"user_name_real":"唐扬"}],"discussion_count":2,"race_medal":0,"score":"10177971857","product_id":100035801,"comment_content":"API网关，这个也一定使用过，不过距离自己的编码距离有些远，没实际直接接触过。<br>类似一个村子的主路口，进村时做安全、鉴权、限流、熔断等控制，出村时做认证、审计、授权等工作。","like_count":3,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493393,"discussion_content":"是的，可能开发同学了解不多","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588069858,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1592279,"avatar":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","nickname":"William Ning","note":"","ucode":"4DB8D05E69E5F3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371713,"discussion_content":"比喻不够恰当","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619929377,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":189814,"user_name":"sami","can_delete":false,"product_type":"c1","uid":1033240,"ip_address":"","ucode":"9A66FCA00D8A37","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJkwbyTYtSCx6Qc7cQPnnRWv38Jybh3etziaPmuP8gHcgS6FMxcdftrKgWiamH6fc2iciaicDKDVEwcEibQ/132","comment_is_top":false,"comment_ctime":1584569392,"is_pvip":true,"replies":[{"id":"73087","content":"也是一种网关选型","user_name":"作者回复","comment_id":189814,"uid":"1448977","ip_address":"","utype":1,"ctime":1584590407,"user_name_real":"唐扬"}],"discussion_count":1,"race_medal":0,"score":"5879536688","product_id":100035801,"comment_content":"Spring推出了一个spring cloud gateway","like_count":1,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487802,"discussion_content":"也是一种网关选型","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584590407,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":186256,"user_name":"JOHN","can_delete":false,"product_type":"c1","uid":1692942,"ip_address":"","ucode":"6936DE275AA543","user_header":"https://static001.geekbang.org/account/avatar/00/19/d5/0e/dae566c7.jpg","comment_is_top":false,"comment_ctime":1583809532,"is_pvip":false,"replies":[{"id":"72215","content":"api网关有转换协议，限流，熔断等功能","user_name":"作者回复","comment_id":186256,"uid":"1448977","ip_address":"","utype":1,"ctime":1584020273,"user_name_real":"唐扬"}],"discussion_count":1,"race_medal":0,"score":"5878776828","product_id":100035801,"comment_content":"看了本文，这边我有几个问题想请教下老师？<br>1、不太清楚业务网关与聚合服务层之间的区别<br>2、在服务调用上，我觉得很多接口并不是聚合接口，那是否api网关也可以直接调用原子服务层<br>3、api网关与web服务的最大区别点就是 web服务多了服务聚合的功能么？？","like_count":2,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486693,"discussion_content":"api网关有转换协议，限流，熔断等功能","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584020273,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":169145,"user_name":"古德","can_delete":false,"product_type":"c1","uid":1037755,"ip_address":"","ucode":"E3F646BB73F60E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d5/bb/98b93862.jpg","comment_is_top":false,"comment_ctime":1578280243,"is_pvip":false,"replies":[{"id":"66181","content":"可以认为是BFF层","user_name":"作者回复","comment_id":169145,"uid":"1448977","ip_address":"","utype":1,"ctime":1578727708,"user_name_real":"唐扬"}],"discussion_count":1,"race_medal":0,"score":"5873247539","product_id":100035801,"comment_content":"我的理解聚合业务层就是BFF层吧，一般是按照业务范围来分，应该放网关层后面，网关层和业务要无关","like_count":2,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480437,"discussion_content":"可以认为是BFF层","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578727708,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":158945,"user_name":"电光火石","can_delete":false,"product_type":"c1","uid":1013160,"ip_address":"","ucode":"3AD33BB4AA940F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/75/a8/dfe4cade.jpg","comment_is_top":false,"comment_ctime":1575505329,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5870472625","product_id":100035801,"comment_content":"聚合服务是否可以考虑用graphql来做？","like_count":1,"discussions":[{"author":{"id":1592279,"avatar":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","nickname":"William Ning","note":"","ucode":"4DB8D05E69E5F3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371714,"discussion_content":"个人认为可以，目前公司的一些接口就是这么做的～","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619929520,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":155036,"user_name":"刘楠","can_delete":false,"product_type":"c1","uid":1120773,"ip_address":"","ucode":"9F19D44CBEE039","user_header":"https://static001.geekbang.org/account/avatar/00/11/1a/05/f154d134.jpg","comment_is_top":false,"comment_ctime":1574639906,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5869607202","product_id":100035801,"comment_content":"好像一个过滤器，系统","like_count":1},{"had_liked":false,"id":155033,"user_name":"stubborn","can_delete":false,"product_type":"c1","uid":1206335,"ip_address":"","ucode":"49D7CE5F015345","user_header":"https://static001.geekbang.org/account/avatar/00/12/68/3f/40d1cd7f.jpg","comment_is_top":false,"comment_ctime":1574639580,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"5869606876","product_id":100035801,"comment_content":"请教一下老师，增加聚合服务有什么约束条件吗？比如聚合服务要同时写入服务A和服务B，这样很容易引起分布式事务。","like_count":1,"discussions":[{"author":{"id":1730331,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/67/1b/0f564174.jpg","nickname":"陈景军","note":"","ucode":"493D28C70B14B0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":176076,"discussion_content":"同求解！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582020337,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1489957,"avatar":"https://static001.geekbang.org/account/avatar/00/16/bc/25/1c92a90c.jpg","nickname":"tt","note":"","ucode":"7753B79AD5A9AC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":58052,"discussion_content":"可以用之前讲的消息队列对聚合解耦吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574650518,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1329995,"avatar":"https://static001.geekbang.org/account/avatar/00/14/4b/4b/97926cba.jpg","nickname":"Luciano李鑫","note":"","ucode":"5FBE5F86FD5B2C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1489957,"avatar":"https://static001.geekbang.org/account/avatar/00/16/bc/25/1c92a90c.jpg","nickname":"tt","note":"","ucode":"7753B79AD5A9AC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":58098,"discussion_content":"这里应该是用消息事务异步解决分布式事务问题","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1574652035,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":58052,"ip_address":""},"score":58098,"extra":""},{"author":{"id":1489957,"avatar":"https://static001.geekbang.org/account/avatar/00/16/bc/25/1c92a90c.jpg","nickname":"tt","note":"","ucode":"7753B79AD5A9AC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1329995,"avatar":"https://static001.geekbang.org/account/avatar/00/14/4b/4b/97926cba.jpg","nickname":"Luciano李鑫","note":"","ucode":"5FBE5F86FD5B2C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":63582,"discussion_content":"消息事物具体怎么做呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574897070,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":58098,"ip_address":""},"score":63582,"extra":""},{"author":{"id":1033240,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJkwbyTYtSCx6Qc7cQPnnRWv38Jybh3etziaPmuP8gHcgS6FMxcdftrKgWiamH6fc2iciaicDKDVEwcEibQ/132","nickname":"sami","note":"","ucode":"9A66FCA00D8A37","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1489957,"avatar":"https://static001.geekbang.org/account/avatar/00/16/bc/25/1c92a90c.jpg","nickname":"tt","note":"","ucode":"7753B79AD5A9AC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":208628,"discussion_content":"rocketmq可以支持分布式事务，第一次请求时发送半事务的消息，等业务库执行成功之后再真正发送到队列中。类似两阶段的分布式事务","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584569290,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":63582,"ip_address":""},"score":208628,"extra":""}]}]},{"had_liked":false,"id":316834,"user_name":"刘聪为","can_delete":false,"product_type":"c1","uid":1139128,"ip_address":"","ucode":"8DFDCA7B37D04E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEJh4fE4WryeIpjKCYB7TuWS2IEFV0paiaZt3hSh8jrPZRD8cvalPWndTv1VbdDiaEKibY0IgGGPEMbCw/132","comment_is_top":false,"comment_ctime":1634562518,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634562518","product_id":100035801,"comment_content":"线程池配额怎么做的","like_count":0},{"had_liked":false,"id":266506,"user_name":"codewor","can_delete":false,"product_type":"c1","uid":2343990,"ip_address":"","ucode":"2715765269385B","user_header":"https://static001.geekbang.org/account/avatar/00/23/c4/36/4f7239de.jpg","comment_is_top":false,"comment_ctime":1607358605,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607358605","product_id":100035801,"comment_content":"老师，请教一个问题，聚合服务与原子服务是同级还是父子关系的？","like_count":0},{"had_liked":false,"id":262958,"user_name":"windfly","can_delete":false,"product_type":"c1","uid":1045258,"ip_address":"","ucode":"E41DCAD04366D1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f3/0a/23a7afb1.jpg","comment_is_top":false,"comment_ctime":1605923854,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1605923854","product_id":100035801,"comment_content":"老师，我是做前端的，我经常听说用nodejs搭建BFF，这里的BFF层和API网关是不是同一个意思，或者说BFF层是API网关架构的一种实现？","like_count":0,"discussions":[{"author":{"id":1033096,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c3/88/d16816a8.jpg","nickname":"如来神掌","note":"","ucode":"45E20FF935BD2F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":328185,"discussion_content":"并不是，职责不一样。BFF其实就是业务网关，主要做业务数据聚合，也可以叫聚合层。API网关主要关注鉴权，限流，熔断等等的非业务功能。业务网关随着业务迭代上线会比较频繁，而API网关很少重发布。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1606097565,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":250600,"user_name":"null","can_delete":false,"product_type":"c1","uid":1024294,"ip_address":"","ucode":"F9039EFED6B55D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","comment_is_top":false,"comment_ctime":1601167159,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601167159","product_id":100035801,"comment_content":"老师，您好，原文提到的：针对不同的服务使用不同的线程池，在线程池内部针对不同的接口设置配额。<br><br>这是针对自研网关的方案么？像使用开源的网关如 zuul，spring cloud gateway，是不是就不太好应用这个解决方案了？<br><br><br>还想问一个问题，springmvc 它属于网关框架么？因为文中提到了 zuul 和 spring cloud gateway，却没有提到 springmvc。或者说，springmvc 和这两者有啥不同？<br><br>谢谢老师！！","like_count":0},{"had_liked":false,"id":246762,"user_name":"Frank Zeng","can_delete":false,"product_type":"c1","uid":1236355,"ip_address":"","ucode":"E496CA402768BC","user_header":"https://static001.geekbang.org/account/avatar/00/12/dd/83/c0e013fb.jpg","comment_is_top":false,"comment_ctime":1599471431,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1599471431","product_id":100035801,"comment_content":"老师，有2个问题请教下，1） 网关如果是系统的瓶颈，可否像注册中心动态扩展网关服务？2) 现在流行的服务中台和服务聚合网关有啥区别联系？","like_count":0},{"had_liked":false,"id":246638,"user_name":"Jaime","can_delete":false,"product_type":"c1","uid":1078333,"ip_address":"","ucode":"904192CC4E916F","user_header":"https://static001.geekbang.org/account/avatar/00/10/74/3d/54bbc1df.jpg","comment_is_top":false,"comment_ctime":1599444610,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1599444610","product_id":100035801,"comment_content":"请教一下老师，协议转换假设从http转换到grpc是不是要放到业务网关来处理，我的想法是在业务网关部署一个nodejs或者python来做协议转换，不知道这个想法对不对? ","like_count":0},{"had_liked":false,"id":245222,"user_name":"王新栋","can_delete":false,"product_type":"c1","uid":1352303,"ip_address":"","ucode":"0A5D089B8E1E9D","user_header":"https://static001.geekbang.org/account/avatar/00/14/a2/6f/d239ed80.jpg","comment_is_top":false,"comment_ctime":1598868187,"is_pvip":true,"replies":[{"id":"90313","content":"谢谢","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1599008880,"ip_address":"","comment_id":245222,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1598868187","product_id":100035801,"comment_content":"讲的非常好，API入口网关中提到的OAuth更详细的内容可以参考极客时间的另外一篇专栏《OAuth 2.0实战课》，另外出口网关还有一种演化是叫做SPI。","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":504813,"discussion_content":"谢谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599008880,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":234233,"user_name":"helloworld","can_delete":false,"product_type":"c1","uid":1015754,"ip_address":"","ucode":"00DF2FEC58D2E6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","comment_is_top":false,"comment_ctime":1594625089,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594625089","product_id":100035801,"comment_content":"老师有一个疑问，网关可以提供协议转换功能，但是具体到代码项目部署上应该怎么做呢？那Zuul来说，是不是这些转换功能已经内置好了？感谢老师。","like_count":0},{"had_liked":false,"id":228187,"user_name":"Jaime","can_delete":false,"product_type":"c1","uid":1078333,"ip_address":"","ucode":"904192CC4E916F","user_header":"https://static001.geekbang.org/account/avatar/00/10/74/3d/54bbc1df.jpg","comment_is_top":false,"comment_ctime":1592583392,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1592583392","product_id":100035801,"comment_content":"老师你好，这个协议转换困扰好多天了，比如从http转grpc，这个协议转换没有办法做到自动转换，目前我只想到两种思路，一个是一大堆reflect操作，一个是动态生成代码去做映射。都觉得好麻烦，想着简单点，目前是想着提供一个sdk给各个微服务，然后在每个微服务端去做协议的映射转换，不知道我这个想法对不对? 多谢老师了😬","like_count":0},{"had_liked":false,"id":200792,"user_name":"高志强","can_delete":false,"product_type":"c1","uid":1276563,"ip_address":"","ucode":"68737002043752","user_header":"https://static001.geekbang.org/account/avatar/00/13/7a/93/c9302518.jpg","comment_is_top":false,"comment_ctime":1585651679,"is_pvip":false,"replies":[{"id":"75192","content":"是的，服务要保证可用性呀","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1585703010,"ip_address":"","comment_id":200792,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1585651679","product_id":100035801,"comment_content":"老师我想问一下，这个api网关处在，负载均衡服务和应用服务之间么，都用它这个api网关万一挂了怎么办？","like_count":1,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490136,"discussion_content":"是的，服务要保证可用性呀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585703010,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1307497,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f3/69/7039d03f.jpg","nickname":"书策稠浊","note":"","ucode":"A29875CE15FDA3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":399089,"discussion_content":"高可用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632905261,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":196783,"user_name":"陆江","can_delete":false,"product_type":"c1","uid":1918835,"ip_address":"","ucode":"0F2F8D21D4C1AC","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK310IyFbYZjgYgDvaxibZOic5zbk28FpjLfccfYMSAgt11kd3jicA4Db3NbF8lLl4Cs9m6uRY7EFVWA/132","comment_is_top":false,"comment_ctime":1585312598,"is_pvip":false,"replies":[{"id":"74924","content":"可以的","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1585553438,"ip_address":"","comment_id":196783,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1585312598","product_id":100035801,"comment_content":"API网关层可以实现灰度发布","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489386,"discussion_content":"可以的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585553438,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":195339,"user_name":"安排","can_delete":false,"product_type":"c1","uid":1260026,"ip_address":"","ucode":"F78CFA9624CAEF","user_header":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","comment_is_top":false,"comment_ctime":1585181930,"is_pvip":false,"replies":[{"id":"75193","content":"一般在7层负载和微服务之间，有时候也会替代负载层","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1585703068,"ip_address":"","comment_id":195339,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1585181930","product_id":100035801,"comment_content":"文中说入口api网关会提供客户端一个统一的接入地址，这里的客户端是说app或浏览器吗？<br>api网关前面是不是还有nginx负载均衡，那nginx不才是统一的入口吗？<br>如果api网关前面有nginx，那么nginx会和api网关建立连接吗？然后由api网关再去访问后面的具体服务，并将结果一层层的返回来，最终返回到app用户？<br>能讲一下用户app访问一个服务的时候，中间经过的组件的具体流程吗？希望能得到老师回答。","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489035,"discussion_content":"一般在7层负载和微服务之间，有时候也会替代负载层","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585703068,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1592279,"avatar":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","nickname":"William Ning","note":"","ucode":"4DB8D05E69E5F3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371715,"discussion_content":"发现老师一个问题，总是答非所问～～ 要么就是只回答一部分","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1619929820,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":191852,"user_name":"kamida","can_delete":false,"product_type":"c1","uid":1904146,"ip_address":"","ucode":"16D7CA59870AC0","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/jXbwicoDwia7ooDfwBTRyvNYQkefnVwF1CMicMS8FqKfuFAdvVZo2pqc4ic0R9kSdHTIxaE6YyqxwX8BdNGv5PqSIw/132","comment_is_top":false,"comment_ctime":1584800256,"is_pvip":false,"replies":[{"id":"73901","content":"有web server呀，静态资源放cdn","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1585020108,"ip_address":"","comment_id":191852,"utype":1}],"discussion_count":4,"race_medal":0,"score":"1584800256","product_id":100035801,"comment_content":"web 层被api网关取代了后 那我们还有web server吗 静态文件比如html，css等放到哪里呢","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488271,"discussion_content":"有web server呀，静态资源放cdn","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585020108,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1592279,"avatar":"https://static001.geekbang.org/account/avatar/00/18/4b/d7/f46c6dfd.jpg","nickname":"William Ning","note":"","ucode":"4DB8D05E69E5F3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371716,"discussion_content":"看图，应该前面， 如果是后面，就不能称为网关了～","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619929904,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1904146,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/jXbwicoDwia7ooDfwBTRyvNYQkefnVwF1CMicMS8FqKfuFAdvVZo2pqc4ic0R9kSdHTIxaE6YyqxwX8BdNGv5PqSIw/132","nickname":"kamida","note":"","ucode":"16D7CA59870AC0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":212891,"discussion_content":"多谢老师回答\n那api网关一般在web server前面还是后面啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585029077,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1904146,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/jXbwicoDwia7ooDfwBTRyvNYQkefnVwF1CMicMS8FqKfuFAdvVZo2pqc4ic0R9kSdHTIxaE6YyqxwX8BdNGv5PqSIw/132","nickname":"kamida","note":"","ucode":"16D7CA59870AC0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":211956,"discussion_content":"老师能解答一下吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584906908,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":184266,"user_name":"WulalaOlala","can_delete":false,"product_type":"c1","uid":1532794,"ip_address":"","ucode":"39E2501F42D052","user_header":"https://static001.geekbang.org/account/avatar/00/17/63/7a/e91c3771.jpg","comment_is_top":false,"comment_ctime":1583280393,"is_pvip":false,"replies":[{"id":"72209","content":"有利必有弊","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1584020073,"ip_address":"","comment_id":184266,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1583280393","product_id":100035801,"comment_content":"加了api网关，不是每个请求多了一层服务调用？","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485954,"discussion_content":"有利必有弊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584020073,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":174824,"user_name":"皮蛋","can_delete":false,"product_type":"c1","uid":1202619,"ip_address":"","ucode":"8384CC338549EB","user_header":"https://static001.geekbang.org/account/avatar/00/12/59/bb/caf2b06c.jpg","comment_is_top":false,"comment_ctime":1580402787,"is_pvip":false,"replies":[{"id":"68361","content":"还是需要","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1580873002,"ip_address":"","comment_id":174824,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1580402787","product_id":100035801,"comment_content":"有了api网关还需要ng吗","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482535,"discussion_content":"还是需要","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580873002,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":156392,"user_name":"longslee","can_delete":false,"product_type":"c1","uid":1465986,"ip_address":"","ucode":"C24E32E5B1B6F5","user_header":"https://static001.geekbang.org/account/avatar/00/16/5e/82/438c8534.jpg","comment_is_top":false,"comment_ctime":1574866081,"is_pvip":false,"replies":[{"id":"60232","content":"出口网关是直接调用第三方的服务的","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1575015162,"ip_address":"","comment_id":156392,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1574866081","product_id":100035801,"comment_content":"打卡。只是简单的使用nginx。职责链模式是我最喜欢的设计模式没有之一，哈哈哈。<br>提个问题：出口网关这里，还是倾向于设计一个直接调用的出口网关吗？那这样的话出口网关怎样通知调用它的下游呢？ 是否采用消息队列？<br>","like_count":1,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476093,"discussion_content":"出口网关是直接调用第三方的服务的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575015162,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":156312,"user_name":"任鹏斌","can_delete":false,"product_type":"c1","uid":1104086,"ip_address":"","ucode":"34319B05EA6E74","user_header":"https://static001.geekbang.org/account/avatar/00/10/d8/d6/47da34bf.jpg","comment_is_top":false,"comment_ctime":1574855494,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574855494","product_id":100035801,"comment_content":"刚完成网关改造，选用了zuul1.0，主要是简单可控，另外业务量级别也没那么大。只实现了统一认证和鉴权，下一步将引入限流讲理，监控，过滤器热加载等。","like_count":0},{"had_liked":false,"id":155696,"user_name":"蓝魔丶","can_delete":false,"product_type":"c1","uid":1219438,"ip_address":"","ucode":"2AE4359E263558","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/6e/edd2da0c.jpg","comment_is_top":false,"comment_ctime":1574737663,"is_pvip":false,"replies":[{"id":"60259","content":"我觉得是可以代替的","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1575016869,"ip_address":"","comment_id":155696,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1574737663","product_id":100035801,"comment_content":"请教老师一下，如果有了性能很不错的入口网关的时候，还有必要使用nginx等web端代理工具嘛？","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475838,"discussion_content":"我觉得是可以代替的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575016869,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":155690,"user_name":"蓝魔丶","can_delete":false,"product_type":"c1","uid":1219438,"ip_address":"","ucode":"2AE4359E263558","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/6e/edd2da0c.jpg","comment_is_top":false,"comment_ctime":1574737010,"is_pvip":false,"replies":[{"id":"60256","content":"聚合层可以做单独的一层微服务~","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1575016550,"ip_address":"","comment_id":155690,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1574737010","product_id":100035801,"comment_content":"最后的服务蓝图中web层应该还是保留吧，把它放到网关和微服务之间，比如提到了聚合服务就是web层服务","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475836,"discussion_content":"聚合层可以做单独的一层微服务~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575016550,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":155250,"user_name":"约书亚","can_delete":false,"product_type":"c1","uid":1046714,"ip_address":"","ucode":"81EA27ADD9EC1A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","comment_is_top":false,"comment_ctime":1574671512,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"1574671512","product_id":100035801,"comment_content":"我经历的网关变化挺复杂，最早是nginx + spring cloud zuul + 人工手写的BFF（BFF近似于聚合服务），其实这时候nginx意义不大<br>后来做改造了spring cloud zuul部分功能，和BFF逐渐合并。<br>目前是用traefik顶在前面做限流熔断鉴权服务发现等工作，后接具体微服务或者BFF，相当于又将网关功能拆分了。<br>未来考虑去掉BFF中的Zuul换成其他更容易进行复杂编程的异步IO的网关，比如spring cloud gateway<br><br>","like_count":0,"discussions":[{"author":{"id":1101929,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d0/69/5dbdc245.jpg","nickname":"张德","note":"","ucode":"31FE63E8725EFC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":59351,"discussion_content":"我们现在也是NGINX+spring cloud zuul+后端的服务   麻烦问一下 登录鉴权是在哪里实现的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574687311,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1046714,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","nickname":"约书亚","note":"","ucode":"81EA27ADD9EC1A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1101929,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d0/69/5dbdc245.jpg","nickname":"张德","note":"","ucode":"31FE63E8725EFC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":59728,"discussion_content":"zuul的时候是用zuul filter做的，换成traefik之后通过forward把评书发往后端验证接口。我们情况比较特殊，是多租户系统，始终没使用oauth等通用鉴权方式。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574693425,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":59351,"ip_address":""},"score":59728,"extra":""},{"author":{"id":2756576,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/0f/e0/b53a7701.jpg","nickname":"骑车上天空","note":"","ucode":"364365E2721122","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1101929,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d0/69/5dbdc245.jpg","nickname":"张德","note":"","ucode":"31FE63E8725EFC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583197,"discussion_content":"一般放在API网关层","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659945977,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":59351,"ip_address":"广东"},"score":583197,"extra":""}]}]},{"had_liked":false,"id":155084,"user_name":"XD","can_delete":false,"product_type":"c1","uid":1079293,"ip_address":"","ucode":"DC9DCFB3841A4E","user_header":"https://static001.geekbang.org/account/avatar/00/10/77/fd/c6619535.jpg","comment_is_top":false,"comment_ctime":1574644280,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574644280","product_id":100035801,"comment_content":"用过kong，当时倒腾了一个很简陋的lua脚本做防刷，打算抽空看一下tyk","like_count":0},{"had_liked":false,"id":155066,"user_name":"峰","can_delete":false,"product_type":"c1","uid":1390326,"ip_address":"","ucode":"527BB65559F0B0","user_header":"https://static001.geekbang.org/account/avatar/00/15/36/f6/d65b7302.jpg","comment_is_top":false,"comment_ctime":1574642859,"is_pvip":false,"replies":[{"id":"60250","content":"RPC这一节","user_name":"作者回复","user_name_real":"唐扬","uid":"1448977","ctime":1575016283,"ip_address":"","comment_id":155066,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1574642859","product_id":100035801,"comment_content":"多路同步复用在哪一节课讲的？","like_count":0,"discussions":[{"author":{"id":1448977,"avatar":"https://static001.geekbang.org/account/avatar/00/16/1c/11/4b45993d.jpg","nickname":"唐扬","note":"","ucode":"1AF4C4A4DBC6EF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475650,"discussion_content":"RPC这一节","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575016283,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":155051,"user_name":"博弈","can_delete":false,"product_type":"c1","uid":1433344,"ip_address":"","ucode":"B1A69837E41972","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/EcYNib1bnDf5dz6JcrE8AoyZYMdqic2VNmbBtCcVZTO9EoDZZxqlQDEqQKo6klCCmklOtN9m0dTd2AOXqSneJYLw/132","comment_is_top":false,"comment_ctime":1574641599,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1574641599","product_id":100035801,"comment_content":"老师您好，我们最近项目中使用到了Spring cloud gateway，配置为使用https访问，在用jmeter进行压力测试时，1秒钟发送2000个请求，会出现ssl hand shake timeout错误，也在配置文件中设置了handshake timeout时间为60秒，还是会出现，请问老师有没有好的解决办法？谢谢","like_count":0,"discussions":[{"author":{"id":1701821,"avatar":"https://static001.geekbang.org/account/avatar/00/19/f7/bd/29c3a868.jpg","nickname":"栋丶哥","note":"","ucode":"2CE58E87A49102","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":58695,"discussion_content":"gateway内置的httpclient是基于netty，可以改netty本身的超时时间试试。看下源码在config包下。gateway坑太多了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574683646,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1433344,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/EcYNib1bnDf5dz6JcrE8AoyZYMdqic2VNmbBtCcVZTO9EoDZZxqlQDEqQKo6klCCmklOtN9m0dTd2AOXqSneJYLw/132","nickname":"博弈","note":"","ucode":"B1A69837E41972","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1701821,"avatar":"https://static001.geekbang.org/account/avatar/00/19/f7/bd/29c3a868.jpg","nickname":"栋丶哥","note":"","ucode":"2CE58E87A49102","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":62041,"discussion_content":"感觉是有点坑，不知道是不是每秒钟发送的请求数太多了还是其他，可以留个联系方式交流吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574814618,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":58695,"ip_address":""},"score":62041,"extra":""}]}]}]}