{"id":601538,"title":"41 | é©¯æœæ³›å‹ï¼šæ˜ç¡®ä½¿ç”¨æ—¶æœº","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯Tony Baiã€‚</p><p>åœ¨å‰é¢å…³äºGoæ³›å‹çš„ä¸¤è®²ä¸­ï¼Œæˆ‘ä»¬å­¦ä¹ äº†Goæ³›å‹çš„åŸºæœ¬è¯­æ³•ç±»å‹å‚æ•°ï¼ŒæŒæ¡äº†ä½¿ç”¨Goå†…ç½®çº¦æŸå’Œè‡ªå®šä¹‰çº¦æŸçš„æ–¹æ³•ï¼Œå¹¶å¯¹Goæ³›å‹æ–°å¼•å…¥çš„ç±»å‹é›†åˆæ¦‚å¿µåšäº†å…¨é¢è¯´æ˜ã€‚æœ‰äº†ä¸Šé¢çš„çŸ¥è¯†é“ºå«åï¼Œæˆ‘ç›¸ä¿¡ä½ å·²ç»å…·å¤‡äº†åº”ç”¨æ³›å‹è¯­æ³•ç¼–å†™æ³›å‹å‡½æ•°ã€å®šä¹‰æ³›å‹ç±»å‹å’Œæ–¹æ³•çš„èƒ½åŠ›äº†ã€‚</p><p>ä¸è¿‡ï¼ŒGoå¯¹æ³›å‹çš„æ”¯æŒï¼Œåœ¨æå‡äº†Goè¯­è¨€è¡¨è¾¾åŠ›çš„åŒæ—¶ï¼Œä¹Ÿå¸¦æ¥äº†ä¸å°çš„å¤æ‚æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨äº†æ³›å‹è¯­æ³•ç¼–å†™çš„ä»£ç åœ¨å¯è¯»æ€§ã€å¯ç†è§£æ€§ä»¥åŠå¯ç»´æŠ¤æ€§æ–¹é¢ï¼Œç›¸æ¯”äºéæ³›å‹ä»£ç éƒ½æœ‰ä¸€å®šç¨‹åº¦çš„ä¸‹é™ã€‚Goå½“åˆæ²¡æœ‰åŠæ—¶å¼•å…¥æ³›å‹çš„ä¸€ä¸ªåŸå› å°±æ˜¯æ³›å‹ä¸Goè¯­è¨€â€œç®€å•â€çš„è®¾è®¡å“²å­¦æœ‰æ‚–ï¼Œç°åœ¨åŠ å…¥äº†æ³›å‹ï¼Œ<strong>Goæ ¸å¿ƒå›¢é˜Ÿä»¥åŠGoç¤¾åŒºå´åˆå¼€å§‹æ‹…å¿ƒâ€œæ³›å‹è¢«æ»¥ç”¨â€</strong>ã€‚</p><p>ä¸è¿‡ä½œä¸ºGoè¯­è¨€å¼€å‘äººå‘˜ï¼Œæˆ‘ä»¬æ¯ä¸ªäººéƒ½æœ‰ä¹‰åŠ¡å»æ­£ç¡®ã€é€‚å½“çš„ä½¿ç”¨æ³›å‹ï¼Œè€Œä¸æ˜¯æ»¥ç”¨æˆ–åˆ©ç”¨æ³›å‹ç‚«æŠ€ï¼Œå› æ­¤åœ¨æ³›å‹ç¯‡çš„è¿™æœ€åä¸€è®²ä¸­ï¼Œæˆ‘å°±æ¥è¯´è¯´ä»€ä¹ˆæ—¶æœºé€‚åˆä½¿ç”¨æ³›å‹ï¼Œä¾›ä½ å‚è€ƒã€‚</p><h2>ä½•æ—¶é€‚åˆä½¿ç”¨æ³›å‹ï¼Ÿ</h2><p>Goæ³›å‹è¯­æ³•ä½“ç°åœ¨<strong>ç±»å‹å‚æ•°</strong>ä¸Šï¼Œæ‰€ä»¥è¯´ï¼Œç±»å‹å‚æ•°é€‚åˆçš„åœºæ™¯å°±æ˜¯é€‚åˆåº”ç”¨æ³›å‹ç¼–ç¨‹çš„æ—¶æœºã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ç±»å‹å‚æ•°é€‚åˆçš„ç¬¬ä¸€ç§åœºæ™¯ã€‚</p><h4>åœºæ™¯ä¸€ï¼šç¼–å†™é€šç”¨æ•°æ®ç»“æ„æ—¶</h4><p>åœ¨Goå°šä¸æ”¯æŒæ³›å‹çš„æ—¶å€™ï¼Œå¦‚æœè¦å®ç°ä¸€ä¸ªé€šç”¨çš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚ä¸€ä¸ªå…ˆå…¥åå‡ºçš„stackæ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬é€šå¸¸æœ‰ä¸¤ä¸ªæ–¹æ¡ˆã€‚</p><!-- [[[read_end]]] --><p>ç¬¬ä¸€ç§æ–¹æ¡ˆæ˜¯ä¸ºæ¯ç§è¦ä½¿ç”¨çš„å…ƒç´ ç±»å‹å•ç‹¬å®ç°ä¸€å¥—æ ˆç»“æ„ã€‚å¦‚æœæˆ‘ä»¬è¦åœ¨æ ˆé‡Œç®¡ç†intå‹æ•°æ®ï¼Œæˆ‘ä»¬å°±å®ç°ä¸€ä¸ªIntStackï¼›å¦‚æœè¦ç®¡ç†stringç±»å‹æ•°æ®ï¼Œæˆ‘ä»¬å°±å†å®ç°ä¸€ä¸ªStringStackâ€¦â€¦æ€»ä¹‹ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®å¯èƒ½ä½¿ç”¨åˆ°çš„å…ƒç´ ç±»å‹å®ç°å‡º<strong>å¤šç§ä¸“ç”¨çš„æ ˆç»“æ„</strong>ã€‚</p><p>è¿™ç§æ–¹æ¡ˆçš„ä¼˜ç‚¹æ˜¯ä¾¿äºç¼–è¯‘å™¨çš„é™æ€ç±»å‹æ£€æŸ¥ï¼Œä¿è¯ç±»å‹å®‰å…¨ï¼Œä¸”è¿è¡Œæ€§èƒ½å¾ˆå¥½ï¼Œå› ä¸ºGoç¼–è¯‘å™¨å¯ä»¥å¯¹ä»£ç åšå‡ºå¾ˆå¥½çš„ä¼˜åŒ–ã€‚ä¸è¿‡è¿™ç§æ–¹æ¡ˆçš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œé‚£å°±æ˜¯ä¼šæœ‰<strong>å¤§é‡çš„é‡å¤ä»£ç </strong>ã€‚</p><p>ç¬¬äºŒç§æ–¹æ¡ˆæ˜¯ä½¿ç”¨ interface{} å®ç°é€šç”¨æ•°æ®ç»“æ„ã€‚</p><p>åœ¨æ³›å‹ä¹‹å‰ï¼ŒGoè¯­è¨€ä¸­å”¯ä¸€å…·æœ‰â€œé€šç”¨â€è¯­ä¹‰çš„è¯­æ³•å°±æ˜¯ interface{} äº†ã€‚æ— è®ºGoæ ‡å‡†åº“è¿˜æ˜¯ç¬¬ä¸‰æ–¹å®ç°çš„é€šç”¨æ•°æ®ç»“æ„éƒ½æ˜¯åŸºäº interface{} å®ç°çš„ï¼Œæ¯”å¦‚ä¸‹é¢æ ‡å‡†åº“ä¸­ringåŒ…ä¸­Ringç»“æ„å°±æ˜¯ä½¿ç”¨ interface{} ä½œä¸ºå…ƒç´ ç±»å‹çš„ï¼š</p><pre><code class=\"language-plain\">// $GOROOT/src/container/ring/ring.go\ntype Ring struct {\n    next, prev *Ring\n    Value      interface{} \n}\n</code></pre><p>ä½¿ç”¨ interface{} å›ºç„¶å¯ä»¥å®ç°é€šç”¨æ•°æ®ç»“æ„ï¼Œä½† interface{} æ¥å£ç±»å‹çš„å›ºæœ‰ç‰¹æ€§ä¹Ÿå†³å®šäº†è¿™ä¸ªæ–¹æ¡ˆä¹Ÿè‡ªå¸¦ä»¥ä¸‹â€œå…ˆå¤©ä¸è¶³â€ï¼š</p><ul>\n<li>Goç¼–è¯‘å™¨æ— æ³•åœ¨ç¼–è¯‘é˜¶æ®µå¯¹è¿›å…¥æ•°æ®ç»“æ„ä¸­çš„å…ƒç´ çš„ç±»å‹è¿›è¡Œé™æ€ç±»å‹æ£€æŸ¥ï¼›</li>\n<li>è¦æƒ³å¾—åˆ°å…ƒç´ çš„çœŸå®ç±»å‹ï¼Œä¸å¯é¿å…è¦è¿›è¡Œç±»å‹æ–­è¨€æˆ–type switchæ“ä½œï¼›</li>\n<li>ä¸åŒç±»å‹æ•°æ®èµ‹å€¼ç»™ interface{} æˆ–ä» interface{} è¿˜åŸæ—¶æ‰§è¡Œçš„è£…ç®±å’Œæ‹†ç®±æ“ä½œå¸¦æ¥çš„é¢å¤–å¼€é”€ã€‚</li>\n</ul><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä»¥ä¸Šä¸¤ä¸ªæ–¹æ¡ˆéƒ½æœ‰å„è‡ªçš„ä¸è¶³ï¼Œé‚£ä¹ˆæœ‰æ¯”è¾ƒç†æƒ³çš„æ–¹æ¡ˆä¹ˆï¼Ÿ</p><p>æœ‰çš„ï¼Œé‚£å°±æ˜¯ä½¿ç”¨Goæ³›å‹ã€‚å…¶å®ä¸æ­¢Goè¯­è¨€ï¼Œå…¶ä»–æ”¯æŒæ³›å‹çš„ä¸»æµç¼–ç¨‹è¯­è¨€çš„é€šç”¨æ•°æ®ç»“æ„å®ç°ä¹Ÿéƒ½ä½¿ç”¨äº†æ³›å‹ã€‚ä¸‹é¢æ˜¯ç”¨Goæ³›å‹å®ç°ä¸€ä¸ªstackæ•°æ®ç»“æ„çš„ç¤ºä¾‹ä»£ç ï¼š</p><pre><code class=\"language-plain\">// stack.go\npackage stack\n\ntype Stack[T any] []T\n\nfunc (s *Stack[T]) Top() (t T) {\n    l := len(*s)\n    if l == 0 {\n        return t\n    }\n    return (*s)[l-1]\n}\n\nfunc (s *Stack[T]) Push(v T) {\n    (*s) = append((*s), v)\n}\n\nfunc (s *Stack[T]) Len() int {\n    return len(*s)\n}\n\nfunc (s *Stack[T]) Pop() (T, bool) {\n    var zero T\n    if len(*s) &lt; 1 {\n        return zero, false\n    }\n\n    // Get the last element from the stack.\n    result := (*s)[len(*s)-1]\n\n    // Remove the last element from the stack.\n    *s = (*s)[:len(*s)-1]\n\n    return result, true\n}\n</code></pre><p>æ³›å‹ç‰ˆå®ç°åŸºæœ¬æ¶ˆé™¤äº†å‰é¢ä¸¤ç§æ–¹æ¡ˆçš„ä¸è¶³ï¼Œå¦‚æœéè¦è¯´å’ŒIntStackã€StringStackç­‰çš„å·®å¼‚ï¼Œé‚£å¯èƒ½å°±æ˜¯åœ¨æ‰§è¡Œæ€§èƒ½ä¸Šè¦å·®ä¸€äº›äº†ã€‚</p><pre><code class=\"language-plain\">$go test -bench .\ngoos: darwin\ngoarch: amd64\npkg: stack\nBenchmarkStack-8      \t72775926\t        19.53 ns/op\t      40 B/op\t       0 allocs/op\nBenchmarkIntStack-8   \t100000000\t        10.43 ns/op\t      45 B/op\t       0 allocs/op\nPASS\n</code></pre><p>å½“ç„¶ï¼Œæ³›å‹ç‰ˆæœ¬æ€§èƒ½ç•¥å·®ä¸æ³›å‹çš„å®ç°åŸç†æœ‰å…³ï¼Œè¿™ä¸ªæˆ‘ä»¬åé¢å†ç»†è¯´ã€‚</p><h4>åœºæ™¯äºŒï¼šå‡½æ•°æ“ä½œçš„æ˜¯GoåŸç”Ÿçš„å®¹å™¨ç±»å‹æ—¶</h4><p>å¦‚æœå‡½æ•°å…·æœ‰åˆ‡ç‰‡ã€mapæˆ–channelè¿™äº›Goå†…ç½®å®¹å™¨ç±»å‹çš„å‚æ•°ï¼Œå¹¶ä¸”å‡½æ•°ä»£ç æœªå¯¹å®¹å™¨ä¸­çš„å…ƒç´ ç±»å‹åšä»»ä½•ç‰¹å®šå‡è®¾ï¼Œé‚£æˆ‘ä»¬ä½¿ç”¨ç±»å‹å‚æ•°å¯èƒ½å¾ˆæœ‰å¸®åŠ©ã€‚</p><p><a href=\"https://time.geekbang.org/column/article/600122\">ç¬¬39è®²</a>ä¸­çš„maxGenericsé‚£ä¸ªä¾‹å­å°±æ˜¯è¿™ä¸ªæƒ…å†µï¼Œæˆ‘ä»¬å†å›é¡¾ä¸€ä¸‹ã€‚</p><pre><code class=\"language-plain\">// max_generics.go\ntype ordered interface {\n    ~int | ~int8 | ~int16 | ~int32 | ~int64 |\n        ~uint | ~uint8 | ~uint16 | ~uint32 | ~uint64 | ~uintptr |\n        ~float32 | ~float64 |\n        ~string\n}\n\nfunc maxGenerics[T ordered](sl []T) T {\n    if len(sl) == 0 {\n        panic(\"slice is empty\")\n    }\n    \n    max := sl[0]\n    for _, v := range sl[1:] {\n        if v &gt; max {\n            max = v\n        }\n    }\n    return max\n}\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œç±»å‹å‚æ•°ä½¿å¾—æ­¤ç±»å®¹å™¨ç®—æ³•ä¸å®¹å™¨å†…å…ƒç´ ç±»å‹å½»åº•è§£è€¦ã€‚åœ¨æ²¡æœ‰æ³›å‹è¯­æ³•ä¹‹å‰ï¼Œå®ç°è¿™æ ·çš„å‡½æ•°é€šå¸¸éœ€è¦ä½¿ç”¨åå°„ã€‚ä¸è¿‡ä½¿ç”¨åå°„ï¼Œä¼šè®©ä»£ç å¯è¯»æ€§å¤§å¹…ä¸‹é™ï¼Œç¼–è¯‘å™¨ä¹Ÿæ— æ³•åšé™æ€ç±»å‹æ£€æŸ¥ï¼Œå¹¶ä¸”è¿è¡Œæ—¶å¼€é”€ä¹Ÿå¤§å¾—å¾ˆã€‚</p><h4>åœºæ™¯ä¸‰ï¼šä¸åŒç±»å‹å®ç°ä¸€äº›æ–¹æ³•çš„é€»è¾‘ç›¸åŒæ—¶</h4><p>åœ¨Goç¼–ç è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°è¿™æ ·ä¸€ç§æƒ…å†µï¼ŒæŸä¸ªå‡½æ•°æ¥å—ä¸€ä¸ªè‡ªå®šä¹‰æ¥å£ç±»å‹ä½œä¸ºå‚æ•°ï¼Œå°±åƒä¸‹é¢çš„doSomethingå‡½æ•°ä»¥åŠå…¶å‚æ•°ç±»å‹MyInterfaceæ¥å£ã€‚</p><pre><code class=\"language-plain\">type MyInterface interface {\n    M1()\n    M2()\n    M3()\n}\n\nfunc doSomething(i MyInterface) {\n}\n</code></pre><p>åªæœ‰å®ç°äº†MyInterfaceä¸­å…¨éƒ¨ä¸‰ä¸ªæ–¹æ³•çš„ç±»å‹ï¼Œæ‰è¢«å…è®¸ä½œä¸ºå®å‚ä¼ é€’ç»™doSomethingå‡½æ•°ã€‚å½“è¿™äº›ç±»å‹å®ç°M1ã€M2å’ŒM3çš„é€»è¾‘çœ‹èµ·æ¥éƒ½ç›¸åŒæ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ç±»å‹å‚æ•°æ¥å¸®åŠ©å®ç°M1~M3è¿™äº›æ–¹æ³•äº†ï¼Œä¸‹é¢å°±æ˜¯é€šè¿‡ç±»å‹å‚æ•°å®ç°è¿™äº›æ–¹æ³•çš„é€šç”¨é€»è¾‘ä»£ç ï¼ˆå®é™…é€»è¾‘åšäº†çœç•¥å¤„ç†ï¼‰ï¼š</p><pre><code class=\"language-plain\">// common_method.go\n\ntype commonMethod[T any] struct{}\n  \nfunc (commonMethod[T]) M1() {}\nfunc (commonMethod[T]) M2() {}\nfunc (commonMethod[T]) M3() {}\n\nfunc main() {\n    var intThings commonMethod[int]\n    var stringThings commonMethod[string]\n    doSomething(intThings)\n    doSomething(stringThings)\n}\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œä½¿ç”¨ä¸åŒç±»å‹ï¼Œæ¯”å¦‚intã€stringç­‰ä½œä¸ºcommonMethodçš„ç±»å‹å®å‚å°±å¯ä»¥å¾—åˆ°ç›¸åº”å®ç°äº†M1~M3çš„ç±»å‹çš„å˜é‡ï¼Œæ¯”å¦‚intThingsã€stringThingsï¼Œè¿™äº›å˜é‡å¯ä»¥ç›´æ¥ä½œä¸ºå®å‚ä¼ é€’ç»™doSomethingå‡½æ•°ã€‚</p><p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å†å°è£…ä¸€ä¸ªæ³›å‹å‡½æ•°æ¥ç®€åŒ–ä¸Šè¿°è°ƒç”¨ï¼š</p><pre><code class=\"language-plain\">func doSomethingCM[T any]() {\n    doSomething(commonMethod[T]{})\n}\n\nfunc main() {\n    doSomethingCM[int]()\n    doSomethingCM[string]()\n}\n</code></pre><p>è¿™é‡Œçš„doSomethingCMæ³›å‹å‡½æ•°å°†commonMethodæ³›å‹ç±»å‹å®ä¾‹åŒ–ä¸è°ƒç”¨doSomethingå‡½æ•°çš„è¿‡ç¨‹å°è£…åˆ°ä¸€èµ·ï¼Œä½¿å¾—commonMethodæ³›å‹ç±»å‹çš„ä½¿ç”¨è¿›ä¸€æ­¥ç®€åŒ–äº†ã€‚</p><p>å…¶å®ï¼ŒGoæ ‡å‡†åº“çš„sort.Sortå°±æ˜¯è¿™æ ·çš„æƒ…å†µï¼Œå…¶å‚æ•°ç±»å‹ä¸ºsort.Interfaceï¼Œè€Œsort.Interfaceæ¥å£ä¸­å®šä¹‰äº†ä¸‰ä¸ªæ–¹æ³•ï¼š</p><pre><code class=\"language-plain\">// $GOROOT/src/sort/sort.go\nfunc Sort(data Interface)\n\ntype Interface interface {\n\tLen() int\n\tLess(i, j int) bool\n\tSwap(i, j int)\n}\n</code></pre><p>æ‰€æœ‰å®ç°sort.Interfaceç±»å‹æ¥å£çš„ç±»å‹ï¼Œåœ¨å®ç°Lenã€Lesså’ŒSwapè¿™ä¸‰ä¸ªé€šç”¨æ–¹æ³•çš„é€»è¾‘çœ‹èµ·æ¥éƒ½ç›¸åŒï¼Œæ¯”å¦‚sort.goä¸­æä¾›çš„StringSliceå’ŒIntSliceä¸¤ç§ç±»å‹çš„ä¸‰ä¸ªæ–¹æ³•çš„å®ç°å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">type StringSlice []string\n\nfunc (x StringSlice) Len() int           { return len(x) }\nfunc (x StringSlice) Less(i, j int) bool { return x[i] &lt; x[j] }\nfunc (x StringSlice) Swap(i, j int)      { x[i], x[j] = x[j], x[i] }\n\ntype IntSlice []int\n\nfunc (x IntSlice) Len() int           { return len(x) }\nfunc (x IntSlice) Less(i, j int) bool { return x[i] &lt; x[j] }\nfunc (x IntSlice) Swap(i, j int)      { x[i], x[j] = x[j], x[i] }\n</code></pre><p>åœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç±»å‹å‚æ•°æ¥ç»™å‡ºè¿™ä¸‰ä¸ªæ–¹æ³•çš„é€šç”¨å®ç°ï¼Œ<strong>è¿™é‡Œæˆ‘å°†å…¶ä½œä¸ºæœ¬è®²çš„æ€è€ƒé¢˜ç•™ç»™ä½ è‡ªå·±å»å®ç°</strong>ã€‚</p><p>ä¸è¿‡è¦æ³¨æ„ï¼šå¦‚æœå¤šä¸ªç±»å‹å®ç°ä¸Šè¿°æ–¹æ³•çš„é€»è¾‘å¹¶ä¸ç›¸åŒï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸åº”è¯¥ä½¿ç”¨ç±»å‹å‚æ•°ã€‚</p><p>å¥½äº†ï¼Œåˆ°è¿™é‡Œæœ€é€‚åˆä½¿ç”¨æ³›å‹çš„æ—¶æœºæˆ‘éƒ½å·²ç»ä»‹ç»äº†ä¸€éã€‚å¦‚æœéè¦æ€»ç»“ä¸ºä¸€æ¡ï¼Œé‚£å°±æ˜¯ï¼š<strong>å¦‚æœä½ å‘ç°è‡ªå·±å¤šæ¬¡ç¼–å†™å®Œå…¨ç›¸åŒçš„ä»£ç ï¼Œå…¶ä¸­å‰¯æœ¬ä¹‹é—´çš„å”¯ä¸€åŒºåˆ«æ˜¯ä»£ç ä½¿ç”¨ä¸åŒçš„ç±»å‹ï¼Œé‚£ä¹ˆå¯è€ƒè™‘ä½¿ç”¨ç±»å‹å‚æ•°äº†</strong>ã€‚</p><p>å‡ä½¿ä½ ç›®å‰é‡åˆ°çš„åœºæ™¯é€‚åˆä½¿ç”¨æ³›å‹ï¼Œä½ å¯èƒ½ä¾ç„¶ä¼šçŠ¹è±«è¦ä¸è¦ä½¿ç”¨æ³›å‹ï¼Œå› ä¸ºä½ è¿˜ä¸æ¸…æ¥šæ³›å‹å¯¹ä»£ç æ‰§è¡Œæ€§èƒ½çš„å½±å“ã€‚ç‰¹åˆ«æ˜¯åœ¨ä¸€äº›æ€§èƒ½æ•æ„Ÿçš„ç³»ç»Ÿä¸­ï¼Œè¿™ä¸€ç‚¹å°¤ä¸ºé‡è¦ã€‚é‚£ä¹ˆå¦‚ä½•çŸ¥é“æ³›å‹å¯¹æ‰§è¡Œæ€§èƒ½çš„å½±å“å‘¢ï¼Ÿè¿™å°±è¦ä»Goæ³›å‹å®ç°åŸç†è¯´èµ·äº†ã€‚</p><h2>Goæ³›å‹å®ç°åŸç†ç®€ä»‹</h2><p>æˆ‘åœ¨æ³›å‹åŠ é¤ä¸€æ–‡ä¸­æ›¾æè¿‡ï¼šGoæ ¸å¿ƒå›¢é˜Ÿå¯¹æ³›å‹å®ç°çš„æ¢ç´¢å¼€å§‹å¾—å¾ˆæ—©ï¼Œåœ¨2009å¹´12æœˆï¼ŒGoå›¢é˜ŸæŠ€æœ¯é¢†å¯¼è€…Russ Coxå°±åœ¨å…¶åšå®¢ç«™ç‚¹ä¸Šå‘è¡¨ä¸€ç¯‡åä¸º<a href=\"https://research.swtch.com/generic\">â€œæ³›å‹çª˜å¢ƒâ€</a>çš„æ–‡ç« ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼ŒRuss Coxæå‡ºäº†Goé¢å¯¹æ³›å‹å¯éµå¾ªçš„ä¸‰ä¸ªè·¯å¾„ä»¥åŠæ¯ä¸ªè·¯å¾„çš„ä¸è¶³ï¼Œä¹Ÿå°±æ˜¯ä¸‰ä¸ªslowï¼ˆæ‹–æ…¢ï¼‰ã€‚</p><ul>\n<li>Cè¯­è¨€è·¯å¾„ï¼šä¸å®ç°æ³›å‹ï¼Œä¸ä¼šå¼•å…¥å¤æ‚æ€§ï¼Œä½†è¿™ä¼š<strong>â€œæ‹–æ…¢ç¨‹åºå‘˜â€</strong>ï¼Œå› ä¸ºå¯èƒ½éœ€è¦ç¨‹åºå‘˜èŠ±è´¹ç²¾åŠ›åšå¾ˆå¤šé‡å¤å®ç°ï¼›</li>\n<li>C++è¯­è¨€è·¯å¾„ï¼šå°±åƒC++çš„æ³›å‹å®ç°æ–¹æ¡ˆé‚£æ ·ï¼Œé€šè¿‡å¢åŠ ç¼–è¯‘å™¨è´Ÿæ‹…ä¸ºæ¯ä¸ªç±»å‹å®å‚ç”Ÿæˆä¸€ä»½å•ç‹¬çš„æ³›å‹å‡½æ•°çš„å®ç°ï¼Œè¿™ç§æ–¹æ¡ˆäº§ç”Ÿäº†å¤§é‡çš„ä»£ç ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†æ˜¯å¤šä½™çš„ï¼Œæœ‰æ—¶å€™è¿˜éœ€è¦ä¸€ä¸ªå¥½çš„é“¾æ¥å™¨æ¥æ¶ˆé™¤é‡å¤çš„æ‹·è´ï¼Œæ˜¾ç„¶è¿™ä¸ªå®ç°è·¯å¾„ä¼š<strong>â€œæ‹–æ…¢ç¼–è¯‘å™¨â€</strong>ï¼›</li>\n<li>Javaè·¯å¾„ï¼šå°±åƒJavaçš„æ³›å‹å®ç°æ–¹æ¡ˆé‚£æ ·ï¼Œé€šè¿‡éšå¼çš„è£…ç®±å’Œæ‹†ç®±æ“ä½œæ¶ˆé™¤ç±»å‹å·®å¼‚ï¼Œè™½ç„¶èŠ‚çœäº†ç©ºé—´ï¼Œä½†ä»£ç æ‰§è¡Œæ•ˆç‡ä½ï¼Œå³<strong>â€œæ‹–æ…¢æ‰§è¡Œæ€§èƒ½â€</strong>ã€‚</li>\n</ul><p>å¦‚ä»ŠGoåŠ å…¥äº†æ³›å‹ï¼Œæ˜¾ç„¶Cè¯­è¨€çš„â€œæ‹–æ…¢ç¨‹åºå‘˜â€è¿™ä¸ªè·¯å¾„è¢«å¦å†³äº†ï¼Œé‚£ä¹ˆåœ¨å‰©ä¸‹ä¸¤ä¸ªè·¯å¾„ä¸­ï¼ŒGoé€‰æ‹©äº†å“ªæ¡å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬å°±æ¥çœŸæ­£çœ‹ä¸€ä¸‹Goæ³›å‹çš„å®ç°æ–¹æ¡ˆã€‚</p><p>Goæ ¸å¿ƒå›¢é˜Ÿåœ¨è¯„ä¼°Goæ³›å‹å®ç°æ–¹æ¡ˆæ—¶æ˜¯éå¸¸è°¨æ…çš„ï¼Œè´Ÿè´£æ³›å‹å®ç°è®¾è®¡çš„ <a href=\"https://github.com/randall77\">Keith Randallåšå£«</a>ä¸€å£æ°”æäº¤äº†ä¸‰ä¸ªå®ç°æ–¹æ¡ˆï¼Œä¾›å¤§å®¶è®¨è®ºå’Œé€‰æ‹©ï¼š</p><ul>\n<li><a href=\"https://github.com/golang/proposal/blob/master/design/generics-implementation-stenciling.md\">Stencilingæ–¹æ¡ˆ</a></li>\n<li><a href=\"https://github.com/golang/proposal/blob/master/design/generics-implementation-dictionaries.md\">Dictionariesæ–¹æ¡ˆ</a></li>\n<li><a href=\"https://github.com/golang/proposal/blob/master/design/generics-implementation-gcshape.md\">GC Shape Stencilingæ–¹æ¡ˆ</a></li>\n</ul><p>ä¸ºäº†è®©ä½ æ›´å¥½åœ°ç†è§£æ³›å‹å®ç°åŸç†ï¼Œæˆ‘å…ˆæ¥é€ä¸€å¯¹ä¸Šè¿°æ–¹æ¡ˆåšä¸ªç®€å•ä»‹ç»ã€‚æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹Stencilingæ–¹æ¡ˆã€‚</p><h4>Stencilingæ–¹æ¡ˆ</h4><p><img src=\"https://static001.geekbang.org/resource/image/a5/70/a5613f1568aa4faf23a10be88206a470.png?wh=839x945\" alt=\"å›¾ç‰‡\"></p><p>Stencilingæ–¹æ¡ˆä¹Ÿç§°ä¸ºæ¨¡æ¿æ–¹æ¡ˆï¼ˆå¦‚ä¸Šå›¾ï¼‰ï¼Œ å®ƒä¹Ÿæ˜¯C++ã€Rustç­‰è¯­è¨€ä½¿ç”¨çš„å®ç°æ–¹æ¡ˆã€‚å…¶ä¸»è¦æ€è·¯å°±æ˜¯åœ¨ç¼–è¯‘é˜¶æ®µï¼Œæ ¹æ®æ³›å‹å‡½æ•°è°ƒç”¨æ—¶ç±»å‹å®å‚æˆ–çº¦æŸä¸­çš„ç±»å‹å…ƒç´ ï¼Œä¸ºæ¯ä¸ªå®å‚ç±»å‹æˆ–ç±»å‹å…ƒç´ ä¸­çš„ç±»å‹ç”Ÿæˆä¸€ä»½å•ç‹¬å®ç°ã€‚è¿™ä¹ˆè¯´è¿˜æ˜¯å¾ˆæŠ½è±¡ï¼Œä¸‹å›¾å¾ˆå½¢è±¡åœ°è¯´æ˜äº†è¿™ä¸€è¿‡ç¨‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/58/80/587fa465f4ceedb1bc7807e116012980.jpg?wh=841x496\" alt=\"å›¾ç‰‡\"></p><p>æˆ‘ä»¬çœ‹åˆ°ï¼ŒGoç¼–è¯‘å™¨ä¸ºæ¯ä¸ªè°ƒç”¨ç”Ÿæˆä¸€ä¸ªå•ç‹¬çš„å‡½æ•°å‰¯æœ¬ï¼ˆå›¾ä¸­å‡½æ•°åç§°å¹¶éçœŸå®çš„ï¼Œä»…ä¸ºä¾¿äºè¯´æ˜è€Œåšçš„å‘½åï¼‰ï¼Œç›¸åŒç±»å‹å®å‚çš„å‡½æ•°åªç”Ÿæˆä¸€æ¬¡ï¼Œæˆ–é€šè¿‡é“¾æ¥å™¨æ¶ˆé™¤ä¸åŒåŒ…çš„ç›¸åŒå‡½æ•°å®ç°ã€‚</p><p>å›¾ç¤ºçš„è¿™ä¸€è¿‡ç¨‹åœ¨å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­ä¹Ÿè¢«ç§°ä¸ºâ€œå•æ€åŒ–ï¼ˆmonomorphizationï¼‰â€ã€‚å•æ€æ˜¯ç›¸å¯¹äºæ³›å‹å‡½æ•°çš„å‚æ•°åŒ–å¤šæ€ï¼ˆparametric polymorphismï¼‰è€Œè¨€çš„ã€‚</p><p>Randallåšå£«ä¹Ÿæåˆ°äº†è¿™ç§æ–¹æ¡ˆçš„ä¸è¶³ï¼Œé‚£å°±æ˜¯<strong>æ‹–æ…¢ç¼–è¯‘å™¨</strong>ã€‚æ³›å‹å‡½æ•°éœ€è¦é’ˆå¯¹ä¸åŒç±»å‹è¿›è¡Œå•ç‹¬ç¼–è¯‘å¹¶ç”Ÿæˆä¸€ä»½ç‹¬ç«‹çš„ä»£ç ã€‚å¦‚æœç±»å‹éå¸¸å¤šï¼Œé‚£ä¹ˆç¼–è¯‘å‡ºæ¥çš„æœ€ç»ˆæ–‡ä»¶å¯èƒ½ä¼šéå¸¸å¤§ã€‚åŒæ—¶ç”±äºCPUç¼“å­˜æ— æ³•å‘½ä¸­ã€æŒ‡ä»¤åˆ†æ”¯é¢„æµ‹ç­‰é—®é¢˜ï¼Œå¯èƒ½å¯¼è‡´ç”Ÿæˆçš„ä»£ç è¿è¡Œæ•ˆç‡ä¸é«˜ã€‚</p><p>å½“ç„¶ï¼Œå¯¹äºæ€§èƒ½ä¸é«˜è¿™ä¸ªè¯´è¾ï¼Œæˆ‘ä¸ªäººæŒä¿ç•™æ€åº¦ï¼Œå› ä¸ºæ¨¡æ¿æ–¹æ¡ˆåœ¨å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­åŸºæœ¬ä¸Šæ˜¯æ²¡æœ‰é¢å¤–çš„è¿è¡Œæ—¶å¼€é”€çš„ï¼Œå¹¶ä¸”æ˜¯åº”è¯¥æ˜¯å¯¹ç¼–è¯‘å™¨ä¼˜åŒ–å‹å¥½çš„ã€‚å¾ˆå¤šé¢å‘ç³»ç»Ÿç¼–ç¨‹çš„è¯­è¨€éƒ½é€‰æ‹©è¯¥æ–¹æ¡ˆï¼Œæ¯”å¦‚C++ã€Dè¯­è¨€ã€Rustç­‰ã€‚</p><h4>Dictionariesæ–¹æ¡ˆ</h4><p>Dictionariesæ–¹æ¡ˆä¸Stencilingæ–¹æ¡ˆçš„å®ç°æ€è·¯æ­£ç›¸åï¼Œå®ƒä¸ä¼šä¸ºæ¯ä¸ªç±»å‹å®å‚å•ç‹¬åˆ›å»ºä¸€å¥—ä»£ç ï¼Œåä¹‹å®ƒä»…ä¼šæœ‰ä¸€å¥—å‡½æ•°é€»è¾‘ï¼Œä½†è¿™ä¸ªå‡½æ•°ä¼šå¤šå‡ºä¸€ä¸ªå‚æ•°dictï¼Œè¿™ä¸ªå‚æ•°ä¼šä½œä¸ºè¯¥å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¿™å’ŒGoæ–¹æ³•çš„receiverå‚æ•°åœ¨æ–¹æ³•è°ƒç”¨æ—¶è‡ªåŠ¨ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°æœ‰äº›ç±»ä¼¼ã€‚è¿™ä¸ªdictå‚æ•°ä¸­ä¿å­˜æ³›å‹å‡½æ•°è°ƒç”¨æ—¶çš„ç±»å‹å®å‚çš„ç±»å‹ç›¸å…³ä¿¡æ¯ã€‚ä¸‹é¢æ˜¯Dictionariesæ–¹æ¡ˆçš„ç¤ºæ„å›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/61/34/614a821e9bf836fd6f7b689c178aec34.png?wh=991x556\" alt=\"\"></p><p>åŒ…å«ç±»å‹ä¿¡æ¯çš„å­—å…¸æ˜¯Goç¼–è¯‘å™¨åœ¨ç¼–è¯‘æœŸé—´ç”Ÿæˆçš„ï¼Œå¹¶ä¸”è¢«ä¿å­˜åœ¨ELFçš„åªè¯»æ•°æ®åŒºæ®µï¼ˆ.dataï¼‰ä¸­ï¼Œä¼ ç»™å‡½æ•°çš„dictå‚æ•°ä¸­åŒ…å«äº†åˆ°ç‰¹å®šå­—å…¸çš„æŒ‡é’ˆã€‚ä»æ–¹æ¡ˆæè¿°æ¥çœ‹ï¼Œæ¯ä¸ªdictä¸­çš„ç±»å‹ä¿¡æ¯è¿˜æ˜¯ååˆ†å¤æ‚çš„ï¼Œä¸è¿‡æˆ‘ä»¬äº†è§£è¿™äº›å°±å¤Ÿäº†ï¼Œå¯¹dictçš„ç»“æ„å°±ä¸å±•å¼€è¯´æ˜äº†ã€‚</p><p>è¿™ç§æ–¹æ¡ˆä¹Ÿæœ‰è‡ªèº«çš„é—®é¢˜ï¼Œæ¯”å¦‚<strong>å­—å…¸é€’å½’</strong>çš„é—®é¢˜ï¼Œå¦‚æœè°ƒç”¨æŸä¸ªæ³›å‹å‡½æ•°çš„ç±»å‹å®å‚æœ‰å¾ˆå¤šï¼Œé‚£ä¹ˆdictä¿¡æ¯ä¹Ÿä¼šè¿‡å¤šç­‰ç­‰ã€‚æ›´é‡è¦çš„æ˜¯å®ƒå¯¹<strong>æ€§èƒ½</strong>å¯èƒ½æœ‰æ¯”è¾ƒå¤§çš„å½±å“ï¼Œæ¯”å¦‚é€šè¿‡dictçš„æŒ‡é’ˆçš„é—´æ¥ç±»å‹ä¿¡æ¯å’Œæ–¹æ³•çš„è®¿é—®å¯¼è‡´è¿è¡Œæ—¶å¼€é”€è¾ƒå¤§ï¼›å†æ¯”å¦‚ï¼Œå¦‚æœæ³›å‹å‡½æ•°è°ƒç”¨æ—¶çš„ç±»å‹å®å‚æ˜¯intï¼Œé‚£ä¹ˆå¦‚æœä½¿ç”¨Stencilingæ–¹æ¡ˆï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å¯„å­˜å™¨å¤åˆ¶å³å¯å®ç°x=yçš„æ“ä½œï¼Œä½†åœ¨Dictionariesæ–¹æ¡ˆä¸­ï¼Œå¿…é¡»é€šè¿‡memmoveäº†ã€‚</p><h4>Goæœ€ç»ˆé‡‡ç”¨çš„æ–¹æ¡ˆï¼šGC Shape Stencilingæ–¹æ¡ˆ</h4><p>GC Shape Stencilingæ–¹æ¡ˆé¡¾åæ€ä¹‰ï¼Œå®ƒåŸºäºStencilingæ–¹æ¡ˆï¼Œä½†åˆæ²¡æœ‰ä¸ºæ‰€æœ‰ç±»å‹å®å‚ç”Ÿæˆå•ç‹¬çš„å‡½æ•°ä»£ç ï¼Œè€Œæ˜¯<strong>ä»¥ä¸€ä¸ªç±»å‹çš„GC Shapeä¸ºå•å…ƒè¿›è¡Œå‡½æ•°ä»£ç ç”Ÿæˆ</strong>ã€‚ä¸€ä¸ªç±»å‹çš„GC Shapeæ˜¯æŒ‡è¯¥ç±»å‹åœ¨Goå†…å­˜åˆ†é…å™¨/åƒåœ¾æ”¶é›†å™¨ä¸­çš„è¡¨ç¤ºï¼Œè¿™ä¸ªè¡¨ç¤ºç”±ç±»å‹çš„å¤§å°ã€æ‰€éœ€çš„å¯¹é½æ–¹å¼ä»¥åŠç±»å‹ä¸­åŒ…å«æŒ‡é’ˆçš„éƒ¨åˆ†æ‰€å†³å®šã€‚</p><p>è¿™æ ·ä¸€æ¥åŠ¿å¿…å°±æœ‰GC Shapeç›¸åŒçš„ç±»å‹å…±äº«ä¸€ä¸ªå®ä¾‹åŒ–åçš„å‡½æ•°ä»£ç ï¼Œé‚£ä¹ˆæ³›å‹è°ƒç”¨æ—¶åˆæ˜¯å¦‚ä½•åŒºåˆ†è¿™äº›ç±»å‹çš„å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆå°±æ˜¯å­—å…¸ã€‚è¯¥æ–¹æ¡ˆåŒæ ·åœ¨æ¯ä¸ªå®ä¾‹åŒ–åçš„å‡½æ•°ä»£ç ä¸­è‡ªåŠ¨å¢åŠ äº†ä¸€ä¸ªdictå‚æ•°ï¼Œç”¨äºåŒºåˆ«GC Shapeç›¸åŒçš„ä¸åŒç±»å‹ã€‚å¯è§ï¼ŒGC Shape Stencilingæ–¹æ¡ˆæœ¬è´¨ä¸Šæ˜¯Stencilingæ–¹æ¡ˆå’ŒDictionariesæ–¹æ¡ˆçš„æ··åˆç‰ˆï¼Œå®ƒä¹Ÿæ˜¯Go 1.18æ³›å‹æœ€ç»ˆé‡‡ç”¨çš„å®ç°æ–¹æ¡ˆï¼Œä¸ºæ­¤Goå›¢é˜Ÿè¿˜ç»™å‡º<a href=\"https://github.com/golang/proposal/blob/master/design/generics-implementation-dictionaries-go1.18.md\">ä¸€ä¸ªæ›´ç»†åŒ–ã€æ›´æ¥è¿‘äºå®ç°çš„GC Shape Stencilingå®ç°æ–¹æ¡ˆ</a>ã€‚</p><p>ä¸‹é¢æ˜¯GC Shape Stencilingæ–¹æ¡ˆçš„ç¤ºæ„å›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/44/01/445f90d42868f0b653371ef4a2cc3701.jpg?wh=1192x839\" alt=\"å›¾ç‰‡\"></p><p>é‚£ä¹ˆå¦‚ä»Šçš„Goç‰ˆæœ¬ï¼ˆGo 1.19.xï¼‰ç©¶ç«Ÿä¼šä¸ºå“ªäº›ç±»å‹å®ä¾‹åŒ–å‡ºä¸€ä»½ç‹¬ç«‹çš„å‡½æ•°ä»£ç å‘¢ï¼Ÿæˆ‘ä»¬é€šè¿‡ä¸‹é¢ç¤ºä¾‹æ¥çœ‹ä¸€ä¸‹ï¼š</p><pre><code class=\"language-plain\">// gcshape.go\nfunc f[T any](t T) T {\n    var zero T\n    return zero\n}\n\ntype MyInt int\n\nfunc main() {\n    f[int](5)\n    f[MyInt](15)\n    f[int64](6)\n    f[uint64](7)\n    f[int32](8)\n    f[rune](18)\n    f[uint32](9)\n    f[float64](3.14)\n    f[string](\"golang\")\n\n    var a int = 5\n    f[*int](&amp;a)\n    var b int32 = 15\n    f[*int32](&amp;b)\n    var c float64 = 8.88\n    f[*float64](&amp;c)\n    var s string = \"hello\"\n    f[*string](&amp;s)\n}\n</code></pre><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªç®€å•çš„æ³›å‹å‡½æ•°fï¼Œç„¶ååˆ†åˆ«ç”¨ä¸åŒçš„GoåŸç”Ÿç±»å‹ã€è‡ªå®šä¹‰ç±»å‹ä»¥åŠæŒ‡é’ˆç±»å‹ä½œä¸ºç±»å‹å®å‚å¯¹fè¿›è¡Œè°ƒç”¨ï¼Œæˆ‘ä»¬é€šè¿‡å·¥å…·ä¸ºä¸Šè¿°goshape.goç”Ÿæˆçš„æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/0e/22/0ee0bc5b7f34670c1d03795a97628e22.jpg?wh=1540x1678\" alt=\"å›¾ç‰‡\"></p><p>ä»ä¸Šå›¾æˆ‘ä»¬çœ‹åˆ°ï¼ŒGoç¼–è¯‘å™¨ä¸ºæ¯ä¸ªåº•å±‚ç±»å‹ç›¸åŒçš„ç±»å‹ç”Ÿæˆä¸€ä»½å‡½æ•°ä»£ç ï¼ŒåƒMyIntå’Œintã€runeå’Œ int32ï¼›å¯¹äºæ‰€æœ‰æŒ‡é’ˆç±»å‹ï¼Œåƒä¸Šé¢çš„*float64ã€*intå’Œ *int32ï¼Œä»…ç”Ÿæˆä¸€ä»½åä¸º main.f[go.shape.*uint8_0] çš„å‡½æ•°ä»£ç ã€‚</p><p>è¿™ä¸<a href=\"https://github.com/golang/proposal/blob/master/design/generics-implementation-dictionaries-go1.18.md\">æ–°ç‰ˆGC Shapeæ–¹æ¡ˆ</a>ä¸­çš„æè¿°æ˜¯ä¸€è‡´çš„ï¼šâ€œæˆ‘ä»¬ç›®å‰æ­£åœ¨ä»¥ä¸€ç§ç›¸å½“ç²¾ç»†çš„æ–¹å¼å®ç°GC Shapesã€‚å½“ä¸”ä»…å½“ä¸¤ä¸ªå…·ä½“ç±»å‹å…·æœ‰ç›¸åŒçš„åº•å±‚ç±»å‹æˆ–è€…å®ƒä»¬éƒ½æ˜¯æŒ‡é’ˆç±»å‹æ—¶ï¼Œå®ƒä»¬æ‰ä¼šåœ¨åŒä¸€ä¸ªGC Shapeåˆ†ç»„ä¸­â€ã€‚</p><h2>æ³›å‹å¯¹æ‰§è¡Œæ•ˆç‡çš„å½±å“</h2><p>é€šè¿‡ä¸Šé¢å¯¹Goæ³›å‹å®ç°åŸç†çš„äº†è§£ï¼Œæˆ‘ä»¬çœ‹åˆ°ç›®å‰çš„Goæ³›å‹å®ç°<strong>é€‰æ‹©äº†ä¸€æ¡æŠ˜ä¸­çš„è·¯çº¿</strong>ï¼šæ—¢æ²¡æœ‰é€‰æ‹©çº¯Stencilingæ–¹æ¡ˆï¼Œé¿å…äº†å¯¹Goç¼–è¯‘æ€§èƒ½å¸¦å»è¾ƒå¤§å½±å“ï¼Œä¹Ÿæ²¡æœ‰é€‰æ‹©åƒJavaé‚£æ ·æ³›å‹é‚£æ ·çš„çº¯è£…ç®±å’Œæ‹†ç®±æ–¹æ¡ˆï¼Œç»™è¿è¡Œæ—¶å¸¦å»è¾ƒå¤§å¼€é”€ã€‚</p><p>ä½†GC Shape + Dictionariesçš„æ··åˆæ–¹æ¡ˆä¹Ÿç¡®å®ä¼šç»™æ³›å‹åœ¨è¿è¡Œæ—¶çš„æ‰§è¡Œæ•ˆç‡å¸¦å»å½±å“ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•çš„å®ä¾‹ï¼š</p><pre><code class=\"language-plain\">// benchmark_simple/add.go\ntype plusable interface {\n    ~int | ~string\n}\n\nfunc add[T plusable](a, b T) T {\n    return a + b\n}\n\nfunc addInt(a, b int) int {\n    return a + b\n}\nfunc addString(a, b string) string {\n    return a + b\n}\n</code></pre><p>è¿™ä¸ªç¤ºä¾‹ç”¨äºå¯¹æ¯”æ³›å‹å‡½æ•°å®ä¾‹åŒ–åçš„å‡½æ•°ä»£ç ï¼ˆå¦‚ add[int]ï¼‰çš„æ€§èƒ½ä¸å•æ€ä¸‹çš„å‡½æ•°ï¼ˆå¦‚addIntï¼‰æ€§èƒ½ï¼Œä¸‹é¢æ˜¯benchmarkä»£ç ï¼š</p><pre><code class=\"language-plain\">// benchmark_simple/add_test.go\nfunc BenchmarkAddInt(b *testing.B) {\n    b.ReportAllocs()\n    var m, n int = 5, 6\n    for i := 0; i &lt; b.N; i++ {\n        addInt(m, n)\n    }\n}\nfunc BenchmarkAddIntGeneric(b *testing.B) {\n    b.ReportAllocs()\n    var m, n int = 5, 6\n    for i := 0; i &lt; b.N; i++ {\n        add(m, n)\n    }\n}\n</code></pre><p>è¿è¡Œè¿™ä¸ªbenchmarkï¼š</p><pre><code class=\"language-plain\"> $go test -bench .\ngoos: darwin\ngoarch: amd64\npkg: demo\nBenchmarkAddInt-8          \t1000000000\t         0.2692 ns/op\t       0 B/op\t       0 allocs/op\nBenchmarkAddIntGeneric-8   \t1000000000\t         1.074 ns/op\t       0 B/op\t       0 allocs/op\nPASS\nok  \tdemo\t1.491s\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œä¸å•æ€åŒ–çš„addIntç›¸æ¯”ï¼Œæ³›å‹å‡½æ•°addå®ä¾‹åŒ–åçš„ add[int] çš„æ‰§è¡Œæ€§èƒ½è¿˜æ˜¯ä¸‹é™äº†å¾ˆå¤šã€‚è¿™ä¸ªé—®é¢˜åœ¨ <a href=\"https://github.com/golang/go/issues/54238\">Goå®˜æ–¹issue</a> ä¸­ä¹Ÿæœ‰Gopheræå‡ºã€‚</p><p>ä¸è¿‡å¥½æ¶ˆæ¯æ˜¯ï¼šåœ¨Go 1.20ç‰ˆæœ¬ä¸­ï¼Œç”±äºå°†ä½¿ç”¨Unified IRï¼ˆä¸­é—´ä»£ç è¡¨ç¤ºï¼‰æ›¿æ¢ç°æœ‰çš„IRè¡¨ç¤ºï¼ŒGoæ³›å‹å‡½æ•°çš„æ‰§è¡Œæ€§èƒ½å°†å¾—åˆ°è¿›ä¸€æ­¥ä¼˜åŒ–ï¼Œä¸Šè¿°çš„benchmarkä¸­ä¸¤ä¸ªå‡½æ•°çš„æ‰§è¡Œæ€§èƒ½å°†ä¸åˆ†ä¼¯ä»²ï¼ŒGo 1.19ä¸­ä¹Ÿå¯ä½¿ç”¨GOEXPERIMENT=unifiedæ¥å¼€å¯Unified IRè¯•éªŒæ€§åŠŸèƒ½ã€‚</p><p>æˆ‘ä»¬åœ¨Unified IRå¼€å¯çš„æƒ…å†µä¸‹å†è·‘ä¸€æ¬¡ä¸Šé¢çš„benchmarkï¼š</p><pre><code class=\"language-plain\">$GOEXPERIMENT=unified go test -bench .\ngoos: darwin\ngoarch: amd64\npkg: demo\nBenchmarkAddInt-8          \t1000000000\t         0.2713 ns/op\t       0 B/op\t       0 allocs/op\nBenchmarkAddIntGeneric-8   \t1000000000\t         0.2723 ns/op\t       0 B/op\t       0 allocs/op\n</code></pre><p>è¿™æ¬¡çš„å¯¹æ¯”ç»“æœå°±éå¸¸ç†æƒ³äº†ï¼</p><p>ç»¼ä¸Šï¼Œæˆ‘å»ºè®®ä½ åœ¨ä¸€äº›æ€§èƒ½æ•æ„Ÿçš„ç³»ç»Ÿä¸­ï¼Œè¿˜æ˜¯è¦æ…ç”¨å°šæœªå¾—åˆ°è¶³å¤Ÿæ€§èƒ½ä¼˜åŒ–çš„æ³›å‹ï¼›è€Œåœ¨æ€§èƒ½ä¸é‚£ä¹ˆæ•æ„Ÿçš„æƒ…å†µä¸‹ï¼Œåœ¨ç¬¦åˆå‰é¢æ³›å‹ä½¿ç”¨æ—¶æœºçš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥å¤§èƒ†ä½¿ç”¨æ³›å‹è¯­æ³•çš„ã€‚</p><h2>å°ç»“</h2><p>å¥½äº†ï¼Œä»Šå¤©çš„è¯¾è®²åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œç°åœ¨æˆ‘ä»¬ä¸€èµ·æ¥å›é¡¾ä¸€ä¸‹å§ã€‚</p><p>åœ¨è¿™ä¸€è®²ä¸­ï¼Œæˆ‘ä»¬æ¢è®¨äº†æœ‰å…³Goæ³›å‹çš„ä¸€ä¸ªé‡è¦çš„é—®é¢˜ï¼š<strong>ä½•æ—¶ä½¿ç”¨æ³›å‹</strong>ã€‚æ³›å‹è¯­æ³•çš„åŠ å…¥ï¼Œä¸å¯é¿å…åœ°æå‡äº†Goè¯­æ³•çš„å¤æ‚æ€§ï¼Œä¸ºäº†é˜²æ­¢Gopheræ»¥ç”¨æ³›å‹ï¼Œæˆ‘ä»¬ç»™å‡ºäº†å‡ ä¸ªGoæ³›å‹æœ€é€‚åˆåº”ç”¨çš„åœºæ™¯ï¼ŒåŒ…æ‹¬ï¼šç¼–å†™é€šç”¨æ•°æ®ç»“æ„ã€ç¼–å†™æ“ä½œGoåŸç”Ÿå®¹å™¨ç±»å‹æ—¶ä»¥åŠä¸åŒç±»å‹å®ç°ä¸€äº›æ–¹æ³•çš„é€»è¾‘çœ‹èµ·æ¥ç›¸åŒæ—¶ã€‚é™¤æ­¤ä¹‹å¤–çš„å…¶ä»–åœºæ™¯ä¸‹ï¼Œå¦‚æœä½ è¦ä½¿ç”¨æ³›å‹ï¼ŒåŠ¡å¿…æ…é‡å¹¶æ·±æ€ç†Ÿè™‘ã€‚</p><p>Goæ³›å‹çš„ç¼–è¯‘æ€§èƒ½å’Œæ‰§è¡Œæ€§èƒ½ä¹Ÿæ˜¯å½±å“æˆ‘ä»¬æ˜¯å¦åº”ç”¨æ³›å‹çš„é‡è¦å› ç´ ï¼ŒGoæ ¸å¿ƒå›¢é˜Ÿåœ¨Goæ³›å‹å®ç°æ–¹æ¡ˆçš„é€‰æ‹©ä¸Šä¹Ÿæ˜¯ç…è´¹è‹¦å¿ƒï¼Œæœ€ç»ˆé€‰æ‹©äº†GC Shape Stencilingçš„æ··åˆæ–¹æ¡ˆï¼Œç›®å‰è¿™ä¸ªæ–¹æ¡ˆå¾ˆå¤§ç¨‹åº¦é¿å…äº†å¯¹Goç¼–è¯‘æ€§èƒ½çš„å½±å“ï¼Œä½†å¯¹Goæ³›å‹ä»£ç çš„æ‰§è¡Œæ•ˆç‡ä¾ç„¶å­˜åœ¨ä¸å°å½±å“ã€‚ç›¸ä¿¡ç»è¿‡å‡ ä¸ªç‰ˆæœ¬æ‰“ç£¨å’Œä¼˜åŒ–åï¼ŒGoæ³›å‹çš„æ‰§è¡Œæ€§èƒ½ä¼šæœ‰æå‡ï¼Œç”šè‡³èƒ½æ¥è¿‘äºéæ³›å‹çš„å•æ€ç‰ˆã€‚</p><p>è¿™é‡Œæˆ‘è¿˜è¦æä¸€ä¸‹ï¼ŒGoæ³›å‹çš„å®ç°æ–¹æ¡ˆä¹Ÿå¯èƒ½åœ¨æœªæ¥ç‰ˆæœ¬ä¸­å‘ç”Ÿå˜åŒ–ï¼Œä»ç›®å‰çœ‹ï¼Œæœ¬è®²ä¸­çš„å†…å®¹ä»…é’ˆå¯¹Go 1.18å’ŒGo 1.19çš„GC Shape Stencilingæ–¹æ¡ˆé€‚ç”¨ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>è¯·ä½ ä¸ºGoæ ‡å‡†åº“sort.Interfaceæ¥å£ç±»å‹æä¾›ä¸€ä¸ªåƒæ–‡ä¸­ç¤ºä¾‹common_method.goä¸­é‚£æ ·çš„é€šç”¨æ–¹æ³•çš„æ³›å‹å®ç°ã€‚</p><p>è‡³æ­¤ï¼Œæ³›å‹ç¯‡ä¸‰è®²å°±å½»åº•è®²å®Œäº†ã€‚å¦‚æœä½ æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€ã€‚</p>","neighbors":{"left":{"article_title":"40ï½œé©¯æœæ³›å‹ï¼šå®šä¹‰æ³›å‹çº¦æŸ","id":601128},"right":{"article_title":"åŠ é¤ï½œæˆ‘â€œç§è—â€çš„é‚£äº›ä¼˜è´¨ä¸”æƒå¨çš„Goè¯­è¨€å­¦ä¹ èµ„æ–™","id":468213}},"comments":[{"had_liked":false,"id":365767,"user_name":"Geek14","can_delete":false,"product_type":"c1","uid":3253178,"ip_address":"è¾½å®","ucode":"5EE9F880685800","user_header":"","comment_is_top":false,"comment_ctime":1672988705,"is_pvip":false,"replies":[{"id":133277,"content":"éƒ½æ˜¯å¥½é—®é¢˜ã€‚\n\né—®é¢˜1ï¼šè¿™å¥è¯æ¥è‡ªäºRuss Cox çš„â€œæ³›å‹çª˜å¢ƒâ€çš„æ–‡ç« ã€‚ä¸çŸ¥é“ä½ å¯¹c++çš„ç¼–è¯‘è¿‡ç¨‹äº†è§£æ€æ ·ã€‚åƒc&#47;c++è¿™æ ·çš„æºç çš„ç¼–è¯‘åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šç¼–è¯‘å’Œé“¾æ¥ã€‚å…¶ä¸­ç¼–è¯‘é˜¶æ®µæ˜¯ä»¥.c&#47;.cppä¸ºç¼–è¯‘å•å…ƒï¼Œå°†æºç ç¼–è¯‘ä¸ºä¸€ä¸ªä¸ª.oæ–‡ä»¶ï¼Œæ¯ä¸ªç¼–è¯‘å•å…ƒçš„ç¼–è¯‘éƒ½æ˜¯ç‹¬ç«‹çš„ã€‚å› æ­¤å¦‚æœä¸€ä¸ªæ³›å‹å‡½æ•°åœ¨å¤šä¸ªç¼–è¯‘å•å…ƒéƒ½ä¼šè¢«è°ƒç”¨(æ¯”å¦‚å®å‚æ˜¯int)ï¼Œé‚£ä¹ˆæ¯ä¸ªç¼–è¯‘å•å…ƒç¼–è¯‘æ—¶éƒ½ä¼šä¸ºintç”Ÿæˆä¸€ä»½ç‹¬ç«‹çš„æ³›å‹å‡½æ•°ä»£ç ï¼Œè¿™æ ·å°±æ‹–æ…¢äº†ç¼–è¯‘å™¨çš„ç¼–è¯‘æ—¶é—´ã€‚ä¹‹ååœ¨é“¾æ¥é˜¶æ®µï¼Œé“¾æ¥å™¨æ‰ä¼šå°†ä½äºå„ä¸ª.oä¸­çš„è¿™äº›å†—ä½™çš„é‡å¤ä»£ç è¿›è¡Œæ¸…é™¤ï¼Œåªä¿ç•™ä¸€ä»½ã€‚\n\né—®é¢˜2ï¼šè°ƒç”¨æ³›å‹å‡½æ•°æ—¶ä¼ å…¥çš„å®å‚è‚¯å®šæ˜¯å®å‚ç±»å‹å•Šã€‚è¿™å—ç¼–è¯‘å™¨ä¼šå°†å…¶è½¬æ¢ä¸ºç‰¹å®šçš„å‡½æ•°è°ƒç”¨ï¼Œæ¯”å¦‚ï¼šf(dict.float64, 3.14)ã€‚è‡³äºå…·ä½“å®ç°ï¼Œhttps:&#47;&#47;github.com&#47;golang&#47;proposal&#47;blob&#47;master&#47;design&#47;generics-implementation-dictionaries.md è¿™ä¸ªproposal designç»™å‡ºäº†ä¸€ä¸ªä¼ªç çš„ä¾‹å­ï¼Œå¯ä»¥çœ‹çœ‹é‚£ä¸ªã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":1026224,"ctime":1673184991,"ip_address":"è¾½å®","comment_id":365767,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"è¯·æ•™è€å¸ˆä¸¤ä¸ªé—®é¢˜ï¼š\n1ã€åœ¨è®²è§£æ³›å‹å®ç°åŸç†æ—¶ï¼Œæ–‡ä¸­æåˆ°â€œC++ è¯­è¨€è·¯å¾„ï¼šå°±åƒ C++ çš„æ³›å‹å®ç°æ–¹æ¡ˆé‚£æ ·ï¼Œé€šè¿‡å¢åŠ ç¼–è¯‘å™¨è´Ÿæ‹…ä¸ºæ¯ä¸ªç±»å‹å®å‚ç”Ÿæˆä¸€ä»½å•ç‹¬çš„æ³›å‹å‡½æ•°çš„å®ç°ï¼Œè¿™ç§æ–¹æ¡ˆäº§ç”Ÿäº†å¤§é‡çš„ä»£ç ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†æ˜¯å¤šä½™çš„ï¼Œâ€¦â€¦â€â€¨ä¸ºå•¥â€œå…¶ä¸­å¤§éƒ¨åˆ†æ˜¯å¤šä½™çš„â€ï¼Œæ¯ä¸ªç±»å‹å®å‚ä¸€ä¸ªå•ç‹¬çš„å®ç°ï¼Œè¿™ä¸æ˜¯åˆšåˆšå¥½å—ï¼Œä¸ºå•¥ä¼šæœ‰å¤šä½™çš„å®ç°ï¼Ÿ\n2ã€Dictionaries æ–¹æ¡ˆæ²¡çœ‹æ˜ç™½ã€‚æ¨¡æ¿æ–¹æ¡ˆæ¯”è¾ƒå¥½ç†è§£ã€‚ç¼–è¯‘é˜¶æ®µä¸ºæ¯ä¸ªç±»å‹å®å‚åˆ›å»ºä¸€ä¸ªæ³›å‹å‡½æ•°çš„å•ç‹¬å®ç°ï¼Œå•ç‹¬å®ç°åå‡½æ•°å†…ä½¿ç”¨çš„æ³›å‹ç±»å‹éƒ½ä¼šæ˜¯å…·ä½“çš„ç±»å‹ã€‚é‚£Dictionaries æ–¹æ¡ˆç§æ³›å‹å‡½æ•°ä¸­çš„æ³›å‹ç±»å‹æ˜¯å…·ä½“ç±»å‹å®å‚ç±»å‹å—ï¼Ÿå¦‚æœæ˜¯å…·ä½“çš„å®å‚çš„ç±»å‹ï¼Œæ˜¯æ€ä¹ˆåšåˆ°ï¼Ÿ\nå¸Œæœ›è€å¸ˆæœ‰æ—¶é—´å¸®å¿™è§£ç­”ä¸‹ç–‘æƒ‘ã€‚","like_count":4},{"had_liked":false,"id":365796,"user_name":"Geek14","can_delete":false,"product_type":"c1","uid":3253178,"ip_address":"è¾½å®","ucode":"5EE9F880685800","user_header":"","comment_is_top":false,"comment_ctime":1673018749,"is_pvip":false,"replies":[{"id":133276,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1673181435,"ip_address":"è¾½å®","comment_id":365796,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"&#47;&#47; å®šä¹‰ä¸€ä¸ªæ”¯æŒæ¯”è¾ƒçš„æ¥å£ï¼Œç”¨äºç±»å‹å‚æ•°çº¦æŸ\ntype ordered interface {\n\t~int | ~int8 | ~int16 | ~int32 | ~int64 |\n\t~uint | ~uint8 | ~uint16 | ~uint32 | ~uint64 | ~uintptr |\n\t~float32 | ~float64 | ~string\n}\n&#47;&#47; å®šä¹‰æ”¯æŒæ’åºçš„æ³›å‹åˆ‡ç‰‡\ntype SortableSlice[T ordered]  []T\n&#47;&#47; è®©æ³›å‹åˆ‡ç‰‡å®ç°sort.Interface\nfunc (s SortableSlice[T]) Len() int           { return len(s) }\nfunc (s SortableSlice[T]) Swap(i, j int)      { s[i], s[j] = s[j], s[i] }\nfunc (s SortableSlice[T]) Less(i, j int) bool { return s[i] &lt; s[j] }\n\n&#47;&#47; å®šä¹‰ä¸€ä¸ªæ³›å‹æ’åºå‡½æ•°\nfunc SortGeneric[T ordered](s SortableSlice[T])  {\n\tsort.Sort(s)\n}","like_count":3,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598882,"discussion_content":"éƒ½æ˜¯å¥½é—®é¢˜ã€‚\n\né—®é¢˜1ï¼šè¿™å¥è¯æ¥è‡ªäºRuss Cox çš„â€œæ³›å‹çª˜å¢ƒâ€çš„æ–‡ç« ã€‚ä¸çŸ¥é“ä½ å¯¹c++çš„ç¼–è¯‘è¿‡ç¨‹äº†è§£æ€æ ·ã€‚åƒc/c++è¿™æ ·çš„æºç çš„ç¼–è¯‘åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šç¼–è¯‘å’Œé“¾æ¥ã€‚å…¶ä¸­ç¼–è¯‘é˜¶æ®µæ˜¯ä»¥.c/.cppä¸ºç¼–è¯‘å•å…ƒï¼Œå°†æºç ç¼–è¯‘ä¸ºä¸€ä¸ªä¸ª.oæ–‡ä»¶ï¼Œæ¯ä¸ªç¼–è¯‘å•å…ƒçš„ç¼–è¯‘éƒ½æ˜¯ç‹¬ç«‹çš„ã€‚å› æ­¤å¦‚æœä¸€ä¸ªæ³›å‹å‡½æ•°åœ¨å¤šä¸ªç¼–è¯‘å•å…ƒéƒ½ä¼šè¢«è°ƒç”¨(æ¯”å¦‚å®å‚æ˜¯int)ï¼Œé‚£ä¹ˆæ¯ä¸ªç¼–è¯‘å•å…ƒç¼–è¯‘æ—¶éƒ½ä¼šä¸ºintç”Ÿæˆä¸€ä»½ç‹¬ç«‹çš„æ³›å‹å‡½æ•°ä»£ç ï¼Œè¿™æ ·å°±æ‹–æ…¢äº†ç¼–è¯‘å™¨çš„ç¼–è¯‘æ—¶é—´ã€‚ä¹‹ååœ¨é“¾æ¥é˜¶æ®µï¼Œé“¾æ¥å™¨æ‰ä¼šå°†ä½äºå„ä¸ª.oä¸­çš„è¿™äº›å†—ä½™çš„é‡å¤ä»£ç è¿›è¡Œæ¸…é™¤ï¼Œåªä¿ç•™ä¸€ä»½ã€‚\n\né—®é¢˜2ï¼šè°ƒç”¨æ³›å‹å‡½æ•°æ—¶ä¼ å…¥çš„å®å‚è‚¯å®šæ˜¯å®å‚ç±»å‹å•Šã€‚è¿™å—ç¼–è¯‘å™¨ä¼šå°†å…¶è½¬æ¢ä¸ºç‰¹å®šçš„å‡½æ•°è°ƒç”¨ï¼Œæ¯”å¦‚ï¼šf(dict.float64, 3.14)ã€‚è‡³äºå…·ä½“å®ç°ï¼Œhttps://github.com/golang/proposal/blob/master/design/generics-implementation-dictionaries.md è¿™ä¸ªproposal designç»™å‡ºäº†ä¸€ä¸ªä¼ªç çš„ä¾‹å­ï¼Œå¯ä»¥çœ‹çœ‹é‚£ä¸ªã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1673184991,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":3253178,"avatar":"","nickname":"Geek14","note":"","ucode":"5EE9F880685800","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":599206,"discussion_content":"æ„Ÿè°¢è€å¸ˆçš„è€å¿ƒç»†è‡´çš„å›å¤ï¼Œè§£å†³äº†æˆ‘å¿ƒä¸­çš„ç–‘æƒ‘[æ‰‹åŠ¨å¼ºèµ]ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673402794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":598882,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":599206,"extra":""}]}]},{"had_liked":false,"id":363933,"user_name":"return","can_delete":false,"product_type":"c1","uid":1135528,"ip_address":"å¹¿ä¸œ","ucode":"42B8A3380DF04B","user_header":"https://static001.geekbang.org/account/avatar/00/11/53/a8/abc96f70.jpg","comment_is_top":false,"comment_ctime":1670374725,"is_pvip":false,"replies":[{"id":132326,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1670453493,"ip_address":"å¹¿ä¸œ","comment_id":363933,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"è€å¸ˆè®²çš„å¥½å‘€ï¼Œæ„Ÿè°¢è€å¸ˆã€‚\næœŸå¾…è€å¸ˆæ–°ä½œå“ã€‚","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598875,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673181435,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":362058,"user_name":"Calvin","can_delete":false,"product_type":"c1","uid":1603004,"ip_address":"åŒ—äº¬","ucode":"0EEF5B207623B5","user_header":"https://static001.geekbang.org/account/avatar/00/18/75/bc/89d88775.jpg","comment_is_top":false,"comment_ctime":1668091980,"is_pvip":false,"replies":[{"id":131790,"content":"ğŸ‘ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1668406667,"ip_address":"åŒ—äº¬","comment_id":362058,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"æ€è€ƒé¢˜ï¼š\n&#47;&#47; sort.Interface -&gt; IntSlice &#47; StringSlice æ³›å‹ç‰ˆ\ntype xsl interface {\n\t~int | ~string\n}\n\ntype xSlice[T xsl] []T\n\nfunc (x xSlice[T]) Len() int           { return len(x) }\nfunc (x xSlice[T]) Less(i, j int) bool { return x[i] &lt; x[j] }\nfunc (x xSlice[T]) Swap(i, j int)      { x[i], x[j] = x[j], x[i] }\n\nfunc sortX[T xsl](data xSlice[T]) {\n\tsort.Sort(data)\n}\n\nfunc TestXSlice(t *testing.T) {\n\tx1 := make(xSlice[int], 0, 5)\n\tx1 = append(x1, 3)\n\tx1 = append(x1, 10)\n\tx1 = append(x1, 2)\n\tx1 = append(x1, 0)\n\tx1 = append(x1, 9)\n\tsortX(x1)\n\tt.Logf(&quot;[]~int x = %#v&quot;, x1)\n\n\ttype mystr string\n\tx2 := []mystr{&quot;ab&quot;, &quot;ca&quot;, &quot;fc&quot;, &quot;ce&quot;, &quot;bf&quot;}\n\tsortX(x2)\n\tt.Logf(&quot;[]~string x = %#v&quot;, x2)\n}","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":595889,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1670453493,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":379121,"user_name":"lesserror","can_delete":false,"product_type":"c1","uid":1351076,"ip_address":"å¹¿ä¸œ","ucode":"25A54D1165FCF6","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","comment_is_top":false,"comment_ctime":1691386443,"is_pvip":false,"replies":[{"id":138157,"content":"ELF æ˜¯ Executable and Linkable Formatçš„ç¼©å†™ã€‚æ˜¯linuxä¸Šä¸€ç§æ ‡å‡†çš„å¯æ‰§è¡Œæ–‡ä»¶çš„æ ¼å¼ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1691476673,"ip_address":"åŒ—äº¬","comment_id":379121,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"tony bai è€å¸ˆï¼Œæ–‡ä¸­çš„ï¼šâ€œå¹¶ä¸”è¢«ä¿å­˜åœ¨ ELF çš„åªè¯»æ•°æ®åŒºæ®µï¼ˆ.dataï¼‰ä¸­â€ï¼Œè¿™é‡Œçš„ELFæ˜¯ä»€ä¹ˆçš„ç¼©å†™å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593639,"discussion_content":"ğŸ‘ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668406667,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361872,"user_name":"ç½—æ°","can_delete":false,"product_type":"c1","uid":1320487,"ip_address":"åŒ—äº¬","ucode":"96BAFAA147341F","user_header":"https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg","comment_is_top":false,"comment_ctime":1667952469,"is_pvip":false,"replies":[{"id":131659,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1667988471,"ip_address":"åŒ—äº¬","comment_id":361872,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"çœ‹ä¸€éè‚¯å®šæ˜¯ä¸å¤Ÿçš„ï¼ŒğŸ‰ï¸å¥½å¥½å¸æ”¶","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":625235,"discussion_content":"ELF æ˜¯ Executable and Linkable Formatçš„ç¼©å†™ã€‚æ˜¯linuxä¸Šä¸€ç§æ ‡å‡†çš„å¯æ‰§è¡Œæ–‡ä»¶çš„æ ¼å¼ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1691476674,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365767,"user_name":"Geek14","can_delete":false,"product_type":"c1","uid":3253178,"ip_address":"è¾½å®","ucode":"5EE9F880685800","user_header":"","comment_is_top":false,"comment_ctime":1672988705,"is_pvip":false,"replies":[{"id":133277,"content":"éƒ½æ˜¯å¥½é—®é¢˜ã€‚\n\né—®é¢˜1ï¼šè¿™å¥è¯æ¥è‡ªäºRuss Cox çš„â€œæ³›å‹çª˜å¢ƒâ€çš„æ–‡ç« ã€‚ä¸çŸ¥é“ä½ å¯¹c++çš„ç¼–è¯‘è¿‡ç¨‹äº†è§£æ€æ ·ã€‚åƒc&#47;c++è¿™æ ·çš„æºç çš„ç¼–è¯‘åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šç¼–è¯‘å’Œé“¾æ¥ã€‚å…¶ä¸­ç¼–è¯‘é˜¶æ®µæ˜¯ä»¥.c&#47;.cppä¸ºç¼–è¯‘å•å…ƒï¼Œå°†æºç ç¼–è¯‘ä¸ºä¸€ä¸ªä¸ª.oæ–‡ä»¶ï¼Œæ¯ä¸ªç¼–è¯‘å•å…ƒçš„ç¼–è¯‘éƒ½æ˜¯ç‹¬ç«‹çš„ã€‚å› æ­¤å¦‚æœä¸€ä¸ªæ³›å‹å‡½æ•°åœ¨å¤šä¸ªç¼–è¯‘å•å…ƒéƒ½ä¼šè¢«è°ƒç”¨(æ¯”å¦‚å®å‚æ˜¯int)ï¼Œé‚£ä¹ˆæ¯ä¸ªç¼–è¯‘å•å…ƒç¼–è¯‘æ—¶éƒ½ä¼šä¸ºintç”Ÿæˆä¸€ä»½ç‹¬ç«‹çš„æ³›å‹å‡½æ•°ä»£ç ï¼Œè¿™æ ·å°±æ‹–æ…¢äº†ç¼–è¯‘å™¨çš„ç¼–è¯‘æ—¶é—´ã€‚ä¹‹ååœ¨é“¾æ¥é˜¶æ®µï¼Œé“¾æ¥å™¨æ‰ä¼šå°†ä½äºå„ä¸ª.oä¸­çš„è¿™äº›å†—ä½™çš„é‡å¤ä»£ç è¿›è¡Œæ¸…é™¤ï¼Œåªä¿ç•™ä¸€ä»½ã€‚\n\né—®é¢˜2ï¼šè°ƒç”¨æ³›å‹å‡½æ•°æ—¶ä¼ å…¥çš„å®å‚è‚¯å®šæ˜¯å®å‚ç±»å‹å•Šã€‚è¿™å—ç¼–è¯‘å™¨ä¼šå°†å…¶è½¬æ¢ä¸ºç‰¹å®šçš„å‡½æ•°è°ƒç”¨ï¼Œæ¯”å¦‚ï¼šf(dict.float64, 3.14)ã€‚è‡³äºå…·ä½“å®ç°ï¼Œhttps:&#47;&#47;github.com&#47;golang&#47;proposal&#47;blob&#47;master&#47;design&#47;generics-implementation-dictionaries.md è¿™ä¸ªproposal designç»™å‡ºäº†ä¸€ä¸ªä¼ªç çš„ä¾‹å­ï¼Œå¯ä»¥çœ‹çœ‹é‚£ä¸ªã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":1026224,"ctime":1673184991,"ip_address":"è¾½å®","comment_id":365767,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"è¯·æ•™è€å¸ˆä¸¤ä¸ªé—®é¢˜ï¼š\n1ã€åœ¨è®²è§£æ³›å‹å®ç°åŸç†æ—¶ï¼Œæ–‡ä¸­æåˆ°â€œC++ è¯­è¨€è·¯å¾„ï¼šå°±åƒ C++ çš„æ³›å‹å®ç°æ–¹æ¡ˆé‚£æ ·ï¼Œé€šè¿‡å¢åŠ ç¼–è¯‘å™¨è´Ÿæ‹…ä¸ºæ¯ä¸ªç±»å‹å®å‚ç”Ÿæˆä¸€ä»½å•ç‹¬çš„æ³›å‹å‡½æ•°çš„å®ç°ï¼Œè¿™ç§æ–¹æ¡ˆäº§ç”Ÿäº†å¤§é‡çš„ä»£ç ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†æ˜¯å¤šä½™çš„ï¼Œâ€¦â€¦â€â€¨ä¸ºå•¥â€œå…¶ä¸­å¤§éƒ¨åˆ†æ˜¯å¤šä½™çš„â€ï¼Œæ¯ä¸ªç±»å‹å®å‚ä¸€ä¸ªå•ç‹¬çš„å®ç°ï¼Œè¿™ä¸æ˜¯åˆšåˆšå¥½å—ï¼Œä¸ºå•¥ä¼šæœ‰å¤šä½™çš„å®ç°ï¼Ÿ\n2ã€Dictionaries æ–¹æ¡ˆæ²¡çœ‹æ˜ç™½ã€‚æ¨¡æ¿æ–¹æ¡ˆæ¯”è¾ƒå¥½ç†è§£ã€‚ç¼–è¯‘é˜¶æ®µä¸ºæ¯ä¸ªç±»å‹å®å‚åˆ›å»ºä¸€ä¸ªæ³›å‹å‡½æ•°çš„å•ç‹¬å®ç°ï¼Œå•ç‹¬å®ç°åå‡½æ•°å†…ä½¿ç”¨çš„æ³›å‹ç±»å‹éƒ½ä¼šæ˜¯å…·ä½“çš„ç±»å‹ã€‚é‚£Dictionaries æ–¹æ¡ˆç§æ³›å‹å‡½æ•°ä¸­çš„æ³›å‹ç±»å‹æ˜¯å…·ä½“ç±»å‹å®å‚ç±»å‹å—ï¼Ÿå¦‚æœæ˜¯å…·ä½“çš„å®å‚çš„ç±»å‹ï¼Œæ˜¯æ€ä¹ˆåšåˆ°ï¼Ÿ\nå¸Œæœ›è€å¸ˆæœ‰æ—¶é—´å¸®å¿™è§£ç­”ä¸‹ç–‘æƒ‘ã€‚","like_count":4,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598882,"discussion_content":"éƒ½æ˜¯å¥½é—®é¢˜ã€‚\n\né—®é¢˜1ï¼šè¿™å¥è¯æ¥è‡ªäºRuss Cox çš„â€œæ³›å‹çª˜å¢ƒâ€çš„æ–‡ç« ã€‚ä¸çŸ¥é“ä½ å¯¹c++çš„ç¼–è¯‘è¿‡ç¨‹äº†è§£æ€æ ·ã€‚åƒc/c++è¿™æ ·çš„æºç çš„ç¼–è¯‘åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šç¼–è¯‘å’Œé“¾æ¥ã€‚å…¶ä¸­ç¼–è¯‘é˜¶æ®µæ˜¯ä»¥.c/.cppä¸ºç¼–è¯‘å•å…ƒï¼Œå°†æºç ç¼–è¯‘ä¸ºä¸€ä¸ªä¸ª.oæ–‡ä»¶ï¼Œæ¯ä¸ªç¼–è¯‘å•å…ƒçš„ç¼–è¯‘éƒ½æ˜¯ç‹¬ç«‹çš„ã€‚å› æ­¤å¦‚æœä¸€ä¸ªæ³›å‹å‡½æ•°åœ¨å¤šä¸ªç¼–è¯‘å•å…ƒéƒ½ä¼šè¢«è°ƒç”¨(æ¯”å¦‚å®å‚æ˜¯int)ï¼Œé‚£ä¹ˆæ¯ä¸ªç¼–è¯‘å•å…ƒç¼–è¯‘æ—¶éƒ½ä¼šä¸ºintç”Ÿæˆä¸€ä»½ç‹¬ç«‹çš„æ³›å‹å‡½æ•°ä»£ç ï¼Œè¿™æ ·å°±æ‹–æ…¢äº†ç¼–è¯‘å™¨çš„ç¼–è¯‘æ—¶é—´ã€‚ä¹‹ååœ¨é“¾æ¥é˜¶æ®µï¼Œé“¾æ¥å™¨æ‰ä¼šå°†ä½äºå„ä¸ª.oä¸­çš„è¿™äº›å†—ä½™çš„é‡å¤ä»£ç è¿›è¡Œæ¸…é™¤ï¼Œåªä¿ç•™ä¸€ä»½ã€‚\n\né—®é¢˜2ï¼šè°ƒç”¨æ³›å‹å‡½æ•°æ—¶ä¼ å…¥çš„å®å‚è‚¯å®šæ˜¯å®å‚ç±»å‹å•Šã€‚è¿™å—ç¼–è¯‘å™¨ä¼šå°†å…¶è½¬æ¢ä¸ºç‰¹å®šçš„å‡½æ•°è°ƒç”¨ï¼Œæ¯”å¦‚ï¼šf(dict.float64, 3.14)ã€‚è‡³äºå…·ä½“å®ç°ï¼Œhttps://github.com/golang/proposal/blob/master/design/generics-implementation-dictionaries.md è¿™ä¸ªproposal designç»™å‡ºäº†ä¸€ä¸ªä¼ªç çš„ä¾‹å­ï¼Œå¯ä»¥çœ‹çœ‹é‚£ä¸ªã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1673184991,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":3253178,"avatar":"","nickname":"Geek14","note":"","ucode":"5EE9F880685800","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":599206,"discussion_content":"æ„Ÿè°¢è€å¸ˆçš„è€å¿ƒç»†è‡´çš„å›å¤ï¼Œè§£å†³äº†æˆ‘å¿ƒä¸­çš„ç–‘æƒ‘[æ‰‹åŠ¨å¼ºèµ]ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673402794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":598882,"ip_address":"æµ™æ±Ÿ","group_id":0},"score":599206,"extra":""}]}]},{"had_liked":false,"id":365796,"user_name":"Geek14","can_delete":false,"product_type":"c1","uid":3253178,"ip_address":"è¾½å®","ucode":"5EE9F880685800","user_header":"","comment_is_top":false,"comment_ctime":1673018749,"is_pvip":false,"replies":[{"id":133276,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1673181435,"ip_address":"è¾½å®","comment_id":365796,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"&#47;&#47; å®šä¹‰ä¸€ä¸ªæ”¯æŒæ¯”è¾ƒçš„æ¥å£ï¼Œç”¨äºç±»å‹å‚æ•°çº¦æŸ\ntype ordered interface {\n\t~int | ~int8 | ~int16 | ~int32 | ~int64 |\n\t~uint | ~uint8 | ~uint16 | ~uint32 | ~uint64 | ~uintptr |\n\t~float32 | ~float64 | ~string\n}\n&#47;&#47; å®šä¹‰æ”¯æŒæ’åºçš„æ³›å‹åˆ‡ç‰‡\ntype SortableSlice[T ordered]  []T\n&#47;&#47; è®©æ³›å‹åˆ‡ç‰‡å®ç°sort.Interface\nfunc (s SortableSlice[T]) Len() int           { return len(s) }\nfunc (s SortableSlice[T]) Swap(i, j int)      { s[i], s[j] = s[j], s[i] }\nfunc (s SortableSlice[T]) Less(i, j int) bool { return s[i] &lt; s[j] }\n\n&#47;&#47; å®šä¹‰ä¸€ä¸ªæ³›å‹æ’åºå‡½æ•°\nfunc SortGeneric[T ordered](s SortableSlice[T])  {\n\tsort.Sort(s)\n}","like_count":3,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598875,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673181435,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":363933,"user_name":"return","can_delete":false,"product_type":"c1","uid":1135528,"ip_address":"å¹¿ä¸œ","ucode":"42B8A3380DF04B","user_header":"https://static001.geekbang.org/account/avatar/00/11/53/a8/abc96f70.jpg","comment_is_top":false,"comment_ctime":1670374725,"is_pvip":false,"replies":[{"id":132326,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1670453493,"ip_address":"å¹¿ä¸œ","comment_id":363933,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"è€å¸ˆè®²çš„å¥½å‘€ï¼Œæ„Ÿè°¢è€å¸ˆã€‚\næœŸå¾…è€å¸ˆæ–°ä½œå“ã€‚","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":595889,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1670453493,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":362058,"user_name":"Calvin","can_delete":false,"product_type":"c1","uid":1603004,"ip_address":"åŒ—äº¬","ucode":"0EEF5B207623B5","user_header":"https://static001.geekbang.org/account/avatar/00/18/75/bc/89d88775.jpg","comment_is_top":false,"comment_ctime":1668091980,"is_pvip":false,"replies":[{"id":131790,"content":"ğŸ‘ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1668406667,"ip_address":"åŒ—äº¬","comment_id":362058,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"æ€è€ƒé¢˜ï¼š\n&#47;&#47; sort.Interface -&gt; IntSlice &#47; StringSlice æ³›å‹ç‰ˆ\ntype xsl interface {\n\t~int | ~string\n}\n\ntype xSlice[T xsl] []T\n\nfunc (x xSlice[T]) Len() int           { return len(x) }\nfunc (x xSlice[T]) Less(i, j int) bool { return x[i] &lt; x[j] }\nfunc (x xSlice[T]) Swap(i, j int)      { x[i], x[j] = x[j], x[i] }\n\nfunc sortX[T xsl](data xSlice[T]) {\n\tsort.Sort(data)\n}\n\nfunc TestXSlice(t *testing.T) {\n\tx1 := make(xSlice[int], 0, 5)\n\tx1 = append(x1, 3)\n\tx1 = append(x1, 10)\n\tx1 = append(x1, 2)\n\tx1 = append(x1, 0)\n\tx1 = append(x1, 9)\n\tsortX(x1)\n\tt.Logf(&quot;[]~int x = %#v&quot;, x1)\n\n\ttype mystr string\n\tx2 := []mystr{&quot;ab&quot;, &quot;ca&quot;, &quot;fc&quot;, &quot;ce&quot;, &quot;bf&quot;}\n\tsortX(x2)\n\tt.Logf(&quot;[]~string x = %#v&quot;, x2)\n}","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593639,"discussion_content":"ğŸ‘ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668406667,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":379121,"user_name":"lesserror","can_delete":false,"product_type":"c1","uid":1351076,"ip_address":"å¹¿ä¸œ","ucode":"25A54D1165FCF6","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","comment_is_top":false,"comment_ctime":1691386443,"is_pvip":false,"replies":[{"id":138157,"content":"ELF æ˜¯ Executable and Linkable Formatçš„ç¼©å†™ã€‚æ˜¯linuxä¸Šä¸€ç§æ ‡å‡†çš„å¯æ‰§è¡Œæ–‡ä»¶çš„æ ¼å¼ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1691476673,"ip_address":"åŒ—äº¬","comment_id":379121,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"tony bai è€å¸ˆï¼Œæ–‡ä¸­çš„ï¼šâ€œå¹¶ä¸”è¢«ä¿å­˜åœ¨ ELF çš„åªè¯»æ•°æ®åŒºæ®µï¼ˆ.dataï¼‰ä¸­â€ï¼Œè¿™é‡Œçš„ELFæ˜¯ä»€ä¹ˆçš„ç¼©å†™å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":625235,"discussion_content":"ELF æ˜¯ Executable and Linkable Formatçš„ç¼©å†™ã€‚æ˜¯linuxä¸Šä¸€ç§æ ‡å‡†çš„å¯æ‰§è¡Œæ–‡ä»¶çš„æ ¼å¼ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1691476674,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361872,"user_name":"ç½—æ°","can_delete":false,"product_type":"c1","uid":1320487,"ip_address":"åŒ—äº¬","ucode":"96BAFAA147341F","user_header":"https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg","comment_is_top":false,"comment_ctime":1667952469,"is_pvip":false,"replies":[{"id":131659,"content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1667988471,"ip_address":"åŒ—äº¬","comment_id":361872,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"çœ‹ä¸€éè‚¯å®šæ˜¯ä¸å¤Ÿçš„ï¼ŒğŸ‰ï¸å¥½å¥½å¸æ”¶","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593182,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667988471,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}