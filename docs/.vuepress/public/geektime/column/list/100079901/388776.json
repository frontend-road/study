{"id":388776,"title":"14 | ä½¿ç”¨æµ®åŠ¨å±‚ï¼šå¦‚ä½•å±•ç¤ºå¯¹è¯æ¡†ï¼Œå¹¶ç»™å¯¹è¯æ¡†ä¼ é€’å‚æ•°ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹æ²›ã€‚ä»Šå¤©æˆ‘ä»¬æ¥èŠèŠå¦‚ä½•åœ¨ React ä¸­å¤„ç†å¯¹è¯æ¡†ã€‚</p><p>å¯¹è¯æ¡†æ˜¯å‰ç«¯åº”ç”¨ä¸­éå¸¸å¸¸ç”¨çš„ä¸€ç§ç•Œé¢æ¨¡å¼ï¼Œå®ƒä»¬é€šå¸¸æ˜¯åº”ç”¨ä¸­çš„ä¸€ä¸ªç‹¬ç«‹çª—å£ï¼Œç”¨äºå±•ç¤ºä¿¡æ¯æˆ–è€…è¾“å…¥ä¿¡æ¯ã€‚</p><p>ä½†æ˜¯åœ¨ React ä¸­ï¼Œä½¿ç”¨å¯¹è¯æ¡†å…¶å®å¹¶ä¸å®¹æ˜“ï¼Œä¸»è¦åŸå› åœ¨äºä¸¤ç‚¹ï¼š</p><p>ä¸€æ–¹é¢ï¼Œå¯¹è¯æ¡†éœ€è¦å…ˆåœ¨çˆ¶ç»„ä»¶ä¸­å£°æ˜ï¼Œæ‰èƒ½åœ¨å­ç»„ä»¶ä¸­æ§åˆ¶å…¶æ˜¯å¦æ˜¾ç¤ºã€‚</p><p>æ¯”å¦‚è¯´æˆ‘ä»¬éœ€è¦åŒæ—¶åœ¨å¸ƒå±€çš„ header å’Œ sider ä¸Šç”¨èœå•å»æ§åˆ¶æŸä¸ªå¯¹è¯æ¡†æ˜¯å¦æ˜¾ç¤ºï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è¯æ¡†å°±å¿…é¡»å®šä¹‰åœ¨æ ¹ç»„ä»¶ä¸Šã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œç»™å¯¹è¯æ¡†ä¼ é€’å‚æ•°åªèƒ½ç”± props ä¼ å…¥ï¼Œè¿™æ„å‘³ç€æ‰€æœ‰çš„çŠ¶æ€ç®¡ç†éƒ½éœ€è¦åœ¨æ›´é«˜çº§åˆ«çš„ç»„ä»¶ä¸Šã€‚è€Œå®é™…ä¸Šå‘¢ï¼Œè¿™ä¸ªå¯¹è¯æ¡†çš„å‚æ•°å¯èƒ½åªåœ¨å­ç»„ä»¶ä¸­æ‰ä¼šç»´æŠ¤ï¼Œè¿™æ—¶æˆ‘ä»¬å°±éœ€è¦åˆ©ç”¨è‡ªå®šä¹‰äº‹ä»¶å°†å‚æ•°å›ä¼ ï¼Œéå¸¸éº»çƒ¦ã€‚</p><h2>æ¡ˆä¾‹å¯¼å…¥ï¼šå¤„ç†å¯¹è¯æ¡†çš„è¯¯åŒº</h2><p>ä¸ºäº†æ–¹ä¾¿ä½ ç†è§£è¿™ä¸¤ç‚¹ï¼Œæˆ‘ç»™ä½ ä¸¾ä¸€ä¸ªå®é™…åœºæ™¯çš„ä¾‹å­ï¼Œä½ å°±èƒ½æ˜ç™½ä¸ºä»€ä¹ˆè¯´åœ¨ React ä¸­ï¼Œå¸¸ç”¨çš„å¯¹è¯æ¡†æ˜¯æ¯”è¾ƒéš¾å¤„ç†çš„ã€‚æ¯”å¦‚è¯´æˆ‘ä»¬éœ€è¦å®ç°ä¸‹é¢è¿™ä¸ªæˆªå›¾æ¼”ç¤ºçš„åŠŸèƒ½ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/f8/2d/f8be7ed1yyac44c70caa9bfc74ce4c2d.png?wh=1470x726\" alt=\"\"></p><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå·¦å³å¸ƒå±€çš„é¡µé¢ã€‚å·¦è¾¹æ æœ‰ä¸€ä¸ªæ–°å»ºç”¨æˆ·çš„æŒ‰é’®ï¼Œå³è¾¹æ˜¯ä¸€ä¸ªç”¨æˆ·åˆ—è¡¨ã€‚ç‚¹å‡»æ–°å»ºç”¨æˆ·çš„æŒ‰é’®ï¼Œæˆ–è€…ç‚¹å‡»è¡¨æ ¼ä¸­çš„ç¼–è¾‘æŒ‰é’®ï¼Œéƒ½ä¼šæ˜¾ç¤ºåŒä¸€ä¸ªå¯¹è¯æ¡†ã€‚è¿™ä¸ªå¯¹è¯æ¡†æ ¹æ®æ˜¯å¦ä¼ å…¥ç”¨æˆ·æ•°æ®ä½œä¸ºå‚æ•°ï¼Œæ¥å†³å®šæ˜¯æ–°å»ºè¿˜æ˜¯ç¼–è¾‘ç”¨æˆ·ã€‚</p><!-- [[[read_end]]] --><p>è¿™ä¸ªé¡µé¢çš„ä»£ç ä¸€èˆ¬ä¼šç”¨ä¸‹é¢çš„ JSX å»å®ç°ï¼š</p><pre><code>&lt;div className=&quot;main-layout&quot;&gt;\n  &lt;Sider /&gt;\n  &lt;UserList /&gt;\n&lt;/div&gt;\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„ä¸»å¸ƒå±€åŒ…å«äº†Sider å’Œ UserList ä¸¤ä¸ªåŒå±‚çº§çš„ç»„ä»¶ã€‚ä½†æ˜¯å®ƒä»¬è¦ä½¿ç”¨åŒä¸€ä¸ªå¯¹è¯æ¡†ä»¥æ˜¾ç¤ºç¼–è¾‘ç”¨æˆ·ã€‚è€Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œåœ¨ React ä¸­ï¼Œæ‰€æœ‰çš„ UI éƒ½æ˜¯çŠ¶æ€é©±åŠ¨ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¿…é¡»å°†å¯¹è¯æ¡†ç›¸å…³çš„çŠ¶æ€ï¼Œä»¥åŠçŠ¶æ€ç®¡ç†é€»è¾‘æå‡åˆ°çˆ¶ç»„ä»¶ä¸­å»å®ç°ï¼Œä¹Ÿå°±æ˜¯è¿™é‡Œçš„ Layout ç»„ä»¶ã€‚</p><p>é‚£ä¹ˆï¼Œä¸€èˆ¬ä¼šç”¨ç±»ä¼¼ä¸‹é¢çš„ä»£ç é€»è¾‘å»å®ç°ï¼š</p><pre><code>function MainLayout() {\n  const [modalVisible, setModalVisible] = useState(false);\n  const [user, setUser] = useState(null);\n  const showUserModal = (user) =&gt; {\n    setModalVisible(true);\n    setUser(user);\n  }\n  return (\n    &lt;div className=&quot;main-layout&quot;&gt;\n      &lt;Sider onNewUser={showUserModal}/&gt;\n      &lt;UserList onEditUser={user =&gt; showUserModal(user)}/&gt;\n      &lt;UserInfoModal visible={modalVisible} user={user} /&gt;\n    &lt;/div&gt;\n  );\n}\n</code></pre><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬å°† UserInfoModal è¿™ä¸ªå¯¹è¯æ¡†ç»„ä»¶å®šä¹‰åœ¨äº†çˆ¶ç»„ä»¶ Layout ä¸­ï¼Œé€šè¿‡ visible æ§åˆ¶å…¶æ˜¯å¦æ˜¾ç¤ºã€‚ç„¶åå†åœ¨ Sider å’Œ UserList è¿™ä¸¤ä¸ªç»„ä»¶ä¸­ï¼Œç”¨è‡ªå®šä¹‰äº‹ä»¶æ¥å‘ŠçŸ¥çˆ¶ç»„ä»¶ï¼Œç”¨æˆ·ç‚¹å‡»äº†æŸä¸ªæŒ‰é’®äº†ï¼Œåº”è¯¥æ˜¾ç¤ºå¯¹è¯æ¡†ã€‚</p><p>è¿™æ ·çš„ç”¨æ³•å›ºç„¶æ˜¯å¯ä»¥æ­£ç¡®å·¥ä½œçš„ï¼Œä¹Ÿæ˜¯æˆ‘çœ‹åˆ°çš„å¤§å¤šæ•°åŒå­¦çš„å¸¸è§„å†™æ³•ã€‚ä½†è¿™ç§å†™æ³•å…¶å®éšå«ç€å¦‚ä¸‹ä¸¤ä¸ªé—®é¢˜ã€‚</p><p>ç¬¬ä¸€ï¼Œ<strong>è¯­ä¹‰éš”ç¦»ä¸æ˜ç¡®</strong>ã€‚MainLayout è¿™ä¸ªç»„ä»¶åº”è¯¥åªåšå¸ƒå±€çš„äº‹æƒ…ï¼Œè€Œä¸åº”è¯¥æœ‰å…¶ä»–çš„ä¸šåŠ¡é€»è¾‘ã€‚ä½†æ˜¯åœ¨è¿™é‡Œï¼Œç”±äºæˆ‘ä»¬åŠ å…¥äº†ç”¨æˆ·ä¿¡æ¯å¤„ç†çš„é€»è¾‘ï¼Œå°±è®©æœ¬ä¸ç›¸å…³çš„ä¸¤å—åŠŸèƒ½äº§ç”Ÿäº†ä¾èµ–ã€‚</p><p>è€Œä¸”ï¼Œå¦‚æœè¦å¢åŠ å¦å¤–ä¸€ä¸ªå¯¹è¯æ¡†ï¼Œé‚£æ„å‘³ç€åˆè¦åœ¨ Layout ä¸Šå¢åŠ æ–°çš„ä¸šåŠ¡é€»è¾‘äº†ã€‚è¿™æ ·çš„è¯ï¼Œä»£ç å¾ˆå¿«å°±ä¼šå˜å¾—è‡ƒè‚¿ï¼Œä¸”éš¾ä»¥ç†è§£å’Œç»´æŠ¤ã€‚</p><p>ç¬¬äºŒï¼Œ<strong>éš¾ä»¥æ‰©å±•</strong>ã€‚ç°åœ¨æˆ‘ä»¬åªæ˜¯åœ¨ MainLayout ä¸‹é¢çš„ä¸¤ä¸ªç»„ä»¶å…±äº«äº†å¯¹è¯æ¡†ï¼Œä½†æ˜¯å¦‚æœå’ŒMainLayout åŒçº§çš„ç»„ä»¶ä¹Ÿè¦è®¿é—®è¿™ä¸ªå¯¹è¯æ¡†å‘¢ï¼Ÿåˆæˆ–è€…ï¼Œ MainLayout ä¸‹é¢çš„æŸä¸ªæ·±å±‚çº§çš„å­™å­ç»„ä»¶ä¹Ÿè¦èƒ½æ˜¾ç¤ºåŒä¸€ä¸ªå¯¹è¯æ¡†å‘¢ï¼Ÿ</p><p>è¿™æ ·å¤„ç†çš„è¯å°±ä¼šéå¸¸éº»çƒ¦ã€‚å‰è€…æ„å‘³ç€ä»£ç éœ€è¦é‡æ„ï¼Œç»§ç»­æå‡çŠ¶æ€åˆ°çˆ¶ç»„ä»¶ï¼›åè€…æ„å‘³ç€ä¸šåŠ¡é€»è¾‘å¤„ç†æ›´å¤æ‚ï¼Œéœ€è¦é€šè¿‡å±‚å±‚çš„è‡ªå®šä¹‰äº‹ä»¶å›è°ƒæ¥å®Œæˆã€‚</p><p>æ‰€ä»¥ï¼ŒæŒ‰ç…§ React æ–¹å¼çš„åšæ³•ï¼Œæˆ–è€…å¤§å¤šæ•°æ•™ç¨‹ä¸Šæ¼”ç¤ºçš„å¯¹è¯æ¡†çš„ç”¨æ³•ï¼Œå…¶å®åœ¨å®é™…é¡¹ç›®ä¸­æ˜¯ä¼šé‡åˆ°ä¸Šé¢æ‰€è¿°çš„å„ç§é—®é¢˜ã€‚è€Œè¿™äº›é—®é¢˜çš„æœ¬è´¨å°±æ˜¯ï¼Œ<strong>ä¸€ä¸ªå®ç°ä¸šåŠ¡é€»è¾‘çš„ Modal ç©¶ç«Ÿåº”è¯¥åœ¨å“ªä¸ªç»„ä»¶ä¸­å»å£°æ˜ï¼Ÿåˆè¯¥æ€ä¹ˆå’Œå®ƒè¿›è¡Œäº¤äº’å‘¢ï¼Ÿ</strong></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šå’Œä½ åˆ†äº«åœ¨ä¸€ä¸ªæ¯”è¾ƒå¤§å‹çš„é¡¹ç›®ä¸­ï¼Œ<strong>å¦‚ä½•ç”¨ä¸€ä¸ªç»Ÿä¸€çš„æ–¹å¼å»ç®¡ç†å¯¹è¯æ¡†ï¼Œä»è€Œè®©å¯¹è¯æ¡†ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘èƒ½å¤Ÿæ›´åŠ æ¨¡å—åŒ–ï¼Œä»¥åŠå’Œå…¶ä»–ä¸šåŠ¡é€»è¾‘è¿›è¡Œè§£è€¦</strong>ã€‚</p><p>ä¸è¿‡ä¹Ÿç‰¹åˆ«è¯´æ˜ä¸€ä¸‹ï¼Œè¿™ç§æ–¹å¼æ›´å¤šçš„æ˜¯æˆ‘ä¸ªäººç»éªŒçš„æ€»ç»“ï¼Œå¹¶ä¸ä¸€å®šæ˜¯å”¯ä¸€çš„ï¼Œæˆ–è€…è¯´æœ€ä½³çš„æ–¹å¼ã€‚æ‰€ä»¥å¦‚æœä½ æœ‰ä»»ä½•ç–‘é—®ï¼Œæ¬¢è¿åœ¨ç•™è¨€åŒºå’Œæˆ‘äº¤æµè®¨è®ºã€‚</p><h2>æ€è·¯ï¼šä½¿ç”¨å…¨å±€çŠ¶æ€ç®¡ç†æ‰€æœ‰å¯¹è¯æ¡†</h2><p>è¦è§£å†³ä¸Šé¢ä¾‹å­ä¸­æ¼”ç¤ºçš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆä»”ç»†æ€è€ƒä¸‹å¯¹è¯æ¡†è¿™ç§ UI æ¨¡å¼çš„æœ¬è´¨ã€‚</p><p>å¯¹è¯æ¡†åœ¨æœ¬è´¨ä¸Šï¼Œå…¶å®æ˜¯<strong>ç‹¬ç«‹äºå…¶ä»–ç•Œé¢çš„ä¸€ä¸ªçª—å£ï¼Œç”¨äºå®Œæˆä¸€ä¸ªç‹¬ç«‹çš„åŠŸèƒ½</strong>ã€‚</p><p>å¦‚æœä»è§†è§‰è§’åº¦å‡ºå‘ï¼Œä½ ä¼šå‘ç°åœ¨ä½¿ç”¨å¯¹è¯æ¡†çš„æ—¶å€™ï¼Œä½ å®Œå…¨ä¸ä¼šå…³å¿ƒå®ƒæ˜¯ä»å“ªä¸ªå…·ä½“çš„ç»„ä»¶ä¸­å¼¹å‡ºæ¥çš„ï¼Œè€Œåªä¼šå…³å¿ƒå¯¹æ¡†æœ¬èº«çš„å†…å®¹ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œä¸€ä¸ªè®¾ç½®ç”¨æˆ·é€‰é¡¹çš„å¯¹è¯æ¡†ï¼Œå®ƒå¯èƒ½æ˜¯ä»é¡¶éƒ¨èœå•ä¸­ç‚¹å‡ºæ¥çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯åœ¨æŸä¸ªå…·ä½“é¡µé¢çš„æŒ‰é’®ç‚¹å‡ºæ¥çš„ï¼Œä½†éƒ½è‡ªåŠ¨æ˜¾ç¤ºäº†ä¸Šä¸‹æ–‡ç›¸å…³çš„è®¾ç½®é€‰é¡¹ã€‚</p><p>å¯¹è¯æ¡†çš„è¿™æ ·ä¸€ä¸ªæœ¬è´¨ï¼Œå°±å†³å®šäº†åœ¨ç»„ä»¶å±‚çº§ä¸Šï¼Œå®ƒå…¶å®æ˜¯åº”è¯¥ç‹¬ç«‹äºå„ä¸ªç»„ä»¶ä¹‹å¤–çš„ã€‚è™½ç„¶å¾ˆå¯èƒ½åœ¨ä¸€å¼€å§‹è¿™ä¸ªå¯¹è¯æ¡†çš„å®ç°å’ŒæŸä¸ªç»„ä»¶éå¸¸é«˜çš„ç›¸å…³åº¦ï¼Œä½†æ˜¯åœ¨æ•´ä¸ªåº”ç”¨çš„ä¸æ–­å¼€å‘å’Œæ¼”è¿›è¿‡ç¨‹ä¸­ï¼Œæ˜¯å¾ˆå¯èƒ½ä¸æ–­å˜åŒ–çš„ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨å®šä¹‰ä¸€ä¸ªå¯¹è¯æ¡†çš„æ—¶å€™ï¼Œå…¶å®šä½åŸºæœ¬ä¼šç­‰ä»·äº<strong>å®šä¹‰ä¸€ä¸ªå…·æœ‰å”¯ä¸€ URL è·¯å¾„çš„é¡µé¢</strong>ã€‚åªæ˜¯å‰è€…ç”±å¼¹å‡ºå±‚å®ç°ï¼Œåè€…æ˜¯é¡µé¢çš„åˆ‡æ¢ã€‚</p><p>å¯¹äºé¡µé¢çº§åˆ«çš„ UI åˆ‡æ¢ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“ç†è§£ï¼Œå°±æ˜¯å®šä¹‰å…¨å±€çš„è·¯ç”±å˜›ã€‚é‚£ä¹ˆåŒæ ·çš„ï¼Œå¦‚æœæˆ‘ä»¬ä»¥åŒæ ·çš„æ–¹å¼å»æ€è€ƒå¯¹è¯æ¡†ï¼Œå…¶å®å°±æ˜¯å°†å¯¹è¯æ¡†å…¨å±€åŒ–ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå…¨å±€çš„æœºåˆ¶æ¥ç®¡ç†è¿™äº›å¯¹è¯æ¡†ã€‚</p><p>è¿™ä¸ªè¿‡ç¨‹å’Œé¡µé¢ URL çš„åˆ‡æ¢éå¸¸ç±»ä¼¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ç»™æ¯ä¸€ä¸ªå¯¹è¯æ¡†å®šä¹‰ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ IDï¼Œç„¶åé€šè¿‡è¿™ä¸ª ID å»æ˜¾ç¤ºæˆ–è€…éšè—ä¸€ä¸ªå¯¹è¯æ¡†ï¼Œå¹¶ä¸”ç»™å®ƒä¼ é€’å‚æ•°ã€‚</p><p>åŸºäºè¿™æ ·ä¸€ä¸ªè®¾æƒ³ï¼Œæˆ‘ä»¬å°±æ¥å°è¯•å»è®¾è®¡ä¸€ä¸ª API å»åšå¯¹è¯æ¡†çš„å…¨å±€ç®¡ç†ã€‚å‡è®¾æˆ‘ä»¬å°†è¿™ä¸ªå¯¹è¯æ¡†çš„å®ç°å‘½åä¸º NiceModalï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯èƒ½å¤Ÿç”¨ä»¥ä¸‹çš„æ–¹å¼å»æ“ä½œå¯¹è¯æ¡†ï¼š</p><pre><code>// é€šè¿‡ create API åˆ›å»ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œä¸»è¦ä¸ºäº†èƒ½å¤Ÿå…¨å±€çš„æ§åˆ¶å¯¹è¯æ¡†çš„å±•ç°\nconst UserInfoModal = NiceModal.create(\n  'user-info-modal',\n  RealUserInfoModal\n);\n\n// åˆ›å»ºä¸€ä¸ª useNiceModal è¿™æ ·çš„ Hookï¼Œç”¨äºè·å–æŸä¸ª id çš„å¯¹è¯æ¡†çš„æ“ä½œå¯¹è±¡\nconst modal = useNiceModal('user-info-modal');\n// é€šè¿‡ modal.show æ˜¾ç¤ºä¸€ä¸ªå¯¹è¯æ¡†ï¼Œå¹¶èƒ½å¤Ÿç»™å®ƒä¼ é€’å‚æ•°\nmodal.show(args);\n// é€šè¿‡ modal.hide å…³é—­å¯¹è¯æ¡†\nmodal.hide();\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœæœ‰è¿™æ ·çš„ APIï¼Œé‚£ä¹ˆæ— è®ºåœ¨å“ªä¸ªå±‚çº§çš„ç»„ä»¶ï¼Œåªè¦çŸ¥é“æŸä¸ª Modal çš„ IDï¼Œé‚£å°±éƒ½å¯ä»¥ç»Ÿä¸€ä½¿ç”¨è¿™äº›å¯¹è¯æ¡†ï¼Œè€Œä¸å†éœ€è¦è€ƒè™‘è¯¥åœ¨å“ªä¸ªå±‚çº§çš„ç»„ä»¶å»å®šä¹‰äº†ï¼Œä½¿ç”¨èµ·æ¥ä¼šæ›´åŠ ç›´è§‚ã€‚</p><p>æ‰€ä»¥ï¼Œé€šè¿‡ä¸Šé¢çš„æ€è€ƒå’ŒéªŒè¯ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºå¯¹è¯æ¡†è¿™ç§æ¨¡å¼çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„çª—å£ï¼Œå®ƒå’Œä¸€ä¸ªæ‹¥æœ‰ç‹¬ç«‹ URL çš„é¡µé¢åœ¨åŠŸèƒ½ä¸Šå’Œå½¢å¼ä¸Šéƒ½æ˜¯æä¸ºç±»ä¼¼çš„ã€‚è¿™å°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥ç”¨å’Œ URL ä¸€æ ·çš„æ–¹æ³•å»å®ç°é€šç”¨çš„å¯¹è¯æ¡†ç®¡ç†ã€‚</p><h2>å®ç°ï¼šåˆ›å»º NiceModal ç»„ä»¶å’Œç›¸å…³ API</h2><p>ä¸‹é¢ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹å¦‚ä½•å»å®ç°è¿™æ ·çš„ä¸€ä¸ª NiceModal æœºåˆ¶ã€‚ä¸ºäº†è®©ä½ æ¯”è¾ƒå¥½åœ°ç†è§£å®ç°çš„é€»è¾‘ï¼Œæˆ‘å°½é‡é€šè¿‡ä»£ç æ³¨é‡Šçš„æ–¹å¼æ¥è§£é‡Šå®ç°æ€è·¯å’ŒåŸç†ï¼Œæ‰€ä»¥ä½ è¦ä»”ç»†é˜…è¯»ä»£ç ï¼Œç¡®ä¿ç†è§£äº†å®ç°çš„ç»†èŠ‚ã€‚</p><p>é¦–å…ˆè¦è€ƒè™‘çš„ä¾¿æ˜¯å¦‚ä½•ç®¡ç†å…¨å±€çŠ¶æ€ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ä»¥ Redux ä¸ºä¾‹ï¼Œæ¥åˆ›å»ºä¸€ä¸ªå¯ä»¥å¤„ç†æ‰€æœ‰å¯¹è¯æ¡†çŠ¶æ€çš„ reducerï¼š</p><pre><code>const modalReducer = (state = { hiding: {} }, action) =&gt; {\n  switch (action.type) {\n    case &quot;nice-modal/show&quot;:\n      const { modalId, args } = action.payload;\n      return {\n        ...state,\n        // å¦‚æœå­˜åœ¨ modalId å¯¹åº”çš„çŠ¶æ€ï¼Œå°±æ˜¾ç¤ºè¿™ä¸ªå¯¹è¯æ¡†\n        [modalId]: args || true,\n        // å®šä¹‰ä¸€ä¸ª hiding çŠ¶æ€ç”¨äºå¤„ç†å¯¹è¯æ¡†å…³é—­åŠ¨ç”»\n        hiding: {\n          ...state.hiding,\n          [modalId]: false,\n        },\n      };\n    case &quot;nice-modal/hide&quot;:\n     const { modalId, force } = action.payload;\n      // åªæœ‰ force æ—¶æ‰çœŸæ­£ç§»é™¤å¯¹è¯æ¡†\n      return action.payload.force\n        ? {\n            ...state,\n            [modalId]: false,\n            hiding: { [modalId]: false },\n          }\n        : { ...state, hiding: { [.modalId]: true } };\n    default:\n      return state;\n  }\n};\n</code></pre><p>è¿™æ®µä»£ç çš„<strong>ä¸»è¦æ€è·¯</strong>å°±æ˜¯é€šè¿‡ Redux çš„ store å»å­˜å‚¨æ¯ä¸ªå¯¹è¯æ¡†çŠ¶æ€å’Œå‚æ•°ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è®¾è®¡äº†ä¸¤ä¸ª action ï¼Œåˆ†åˆ«ç”¨æ¥æ˜¾ç¤ºå’Œéšè—å¯¹è¯æ¡†ã€‚</p><p>ç‰¹åˆ«è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œæˆ‘ä»¬åŠ å…¥äº† hiding è¿™æ ·ä¸€ä¸ªçŠ¶æ€ï¼Œç”¨æ¥å¤„ç†å¯¹è¯æ¡†å…³é—­è¿‡ç¨‹çš„åŠ¨ç”»ï¼Œç¡®ä¿ç”¨æˆ·ä½“éªŒã€‚</p><p>ä¸ºäº†è®© Redux çš„ action ä½¿ç”¨èµ·æ¥æ›´æ–¹ä¾¿ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ª useNiceModal è¿™æ ·çš„ Hookï¼Œåœ¨å…¶å†…éƒ¨å°è£…å¯¹ Store çš„æ“ä½œï¼Œä»è€Œå®ç°å¯¹è¯æ¡†çŠ¶æ€ç®¡ç†çš„é€»è¾‘é‡ç”¨ï¼Œå¹¶ä»¥æ›´å‹å¥½çš„æ–¹å¼æš´éœ²ç»™ç”¨æˆ·ï¼š</p><pre><code>// ä½¿ç”¨ action creator æ¥åˆ›å»ºæ˜¾ç¤ºå’Œéšè—å¯¹è¯æ¡†çš„ action\nfunction showModal(modalId, args) {\n  return {\n    type: &quot;nice-modal/show&quot;,\n    payload: {\n      modalId,\n      args,\n    },\n  };\n}\n\nfunction hideModal(modalId, force) {\n  return {\n    type: &quot;nice-modal/hide&quot;,\n    payload: {\n      modalId,\n      force,\n    },\n  };\n}\n\n// åˆ›å»ºè‡ªå®šä¹‰ Hook ç”¨äºå¤„ç†å¯¹è¯æ¡†é€»è¾‘\nexport const useNiceModal = (modalId) =&gt; {\n  const dispatch = useDispatch();\n  // å°è£… Redux action ç”¨äºæ˜¾ç¤ºå¯¹è¯æ¡†\n  const show = useCallback((args) =&gt; {\n    dispatch(showModal(modalId, args));\n  }, [\n    dispatch,\n    modalId,\n  ]);\n  // å°è£… Redux action ç”¨äºéšè—å¯¹è¯æ¡†\n  const hide = useCallback((force) =&gt; {\n    dispatch(hideModal(modalId, force));\n  }, [\n    dispatch,\n    modalId,\n  ]);\n\n  const args = useSelector((s) =&gt; s[modalId]);\n  const hiding = useSelector((s) =&gt; s.hiding[modalId]);\n\n  // åªè¦æœ‰å‚æ•°å°±è®¤ä¸ºå¯¹è¯æ¡†åº”è¯¥æ˜¾ç¤ºï¼Œå¦‚æœæ²¡æœ‰ä¼ é€’ argsï¼Œåœ¨reducer ä¸­ä¼šä½¿ç”¨\n  // é»˜è®¤å€¼ true\n  return { args, hiding, visible: !!args, show, hide };\n};\n</code></pre><p>åŒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å®ç° NiceModal è¿™æ ·ä¸€ä¸ªç»„ä»¶ï¼Œå»å°è£…é€šç”¨çš„å¯¹è¯æ¡†æ“ä½œé€»è¾‘ã€‚æ¯”å¦‚å…³é—­æŒ‰é’®ï¼Œç¡®å®šæŒ‰é’®çš„äº‹ä»¶å¤„ç†ï¼Œç­‰ç­‰ã€‚ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œæˆ‘ä»¬ä»¥ Ant Design ä¸­çš„ Modal ç»„ä»¶ä¸ºä¾‹ï¼š</p><pre><code>function NiceModal({ id, children, ...rest }) {\n  const modal = useNiceModal(id);\n  return (\n    &lt;Modal\n      onCancel={() =&gt; modal.hide()} // é»˜è®¤ç‚¹å‡» cancel æ—¶å…³é—­å¯¹è¯æ¡†\n      onOk={() =&gt; modal.hide()} // é»˜è®¤ç‚¹å‡»ç¡®å®šå…³é—­å¯¹è¯æ¡†\n      afterClose={() =&gt; modal.hide(true)} // åŠ¨ç”»å®ŒæˆåçœŸæ­£å…³é—­\n      visible={!modal.hiding}\n      {...rest} // å…è®¸åœ¨ä½¿ç”¨ NiceModal æ—¶é€ä¼ å‚æ•°ç»™å®é™…çš„ Modal\n    &gt;\n      {children}\n    &lt;/Modal&gt;\n  );\n}\n\n</code></pre><p>æœ€åå‘¢ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªç¬¬10è®²æåˆ°çš„å®¹å™¨æ¨¡å¼ï¼Œå®ƒä¼šåœ¨å¯¹è¯æ¡†ä¸å¯è§æ—¶ç›´æ¥è¿”å› nullï¼Œä»è€Œä¸æ¸²æŸ“ä»»ä½•å†…å®¹ï¼›å¹¶ä¸”ç¡®ä¿å³ä½¿é¡µé¢ä¸Šå®šä¹‰äº†100ä¸ªå¯¹è¯æ¡†ï¼Œä¹Ÿä¸ä¼šå½±å“æ€§èƒ½ï¼š</p><pre><code>export const createNiceModal = (modalId, Comp) =&gt; {\n  return (props) =&gt; {\n    const { visible, args } = useNiceModal(modalId);\n    if (!visible) return null;\n    return &lt;Comp {...args} {...props} /&gt;;\n  };\n};\n</code></pre><p>è¿™æ ·ï¼Œæˆ‘ä»¬å°±å®ç°äº†ä¸€ä¸ª NiceModal è¿™æ ·çš„å…¨å±€å¯¹è¯æ¡†ç®¡ç†æ¡†æ¶ã€‚åŸºäºè¿™æ ·ä¸€ä¸ªæ¡†æ¶ï¼Œä½¿ç”¨å¯¹è¯æ¡†çš„æ—¶å€™å°±ä¼šéå¸¸æ–¹ä¾¿ã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p><pre><code>import { Button } from &quot;antd&quot;;\nimport NiceModal, {\n  createNiceModal,\n  useNiceModal,\n} from &quot;./NiceModal&quot;;\n\nconst MyModal = createNiceModal(&quot;my-modal&quot;, () =&gt; {\n  return (\n    &lt;NiceModal id=&quot;my-modal&quot; title=&quot;Nice Modal&quot;&gt;\n      Hello NiceModal!\n    &lt;/NiceModal&gt;\n  );\n});\n\nfunction MyModalExample() {\n  const modal = useNiceModal(&quot;my-modal&quot;);\n  return (\n    &lt;&gt;\n      &lt;Button type=&quot;primary&quot; onClick={() =&gt; modal.show()}&gt;\n        Show Modal\n      &lt;/Button&gt;\n      &lt;MyModal /&gt;\n    &lt;/&gt;\n  );\n}\n</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªç®€å•çš„ MyModal ç»„ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æŠŠå¤šç”»æ¡†é€»è¾‘å†™åœ¨å•ç‹¬çš„ç»„ä»¶ä¸­ï¼Œè€Œä¸æ˜¯åµŒå…¥åˆ°çˆ¶ç»„ä»¶ã€‚åœ¨è¿™ä¸ª MyModal ç»„ä»¶å†…éƒ¨ä½¿ç”¨äº† NiceModal ä½œä¸ºåŸºç¡€ï¼Œä»è€Œå¯ä»¥ç»‘å®šå¯¹è¯æ¡† IDï¼Œå¹¶é‡ç”¨é€šç”¨çš„å¯¹è¯æ¡†é€»è¾‘ã€‚</p><p>é€šè¿‡è¿™ä¸ª Modal IDï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿåœ¨åº”ç”¨çš„ä»»ä½•ç»„ä»¶ä¸­å»ç®¡ç†è¿™ä¸ªå¯¹è¯æ¡†äº†ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨è¿™éƒ¨åˆ†æˆ‘ä»¬åŸºæœ¬å®Œæ•´å®ç°äº†ä¸€ä¸ª NiceModal çš„æœºåˆ¶ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ å¾ˆå¥½åœ°å»å…¨å±€ç®¡ç†å¯¹è¯æ¡†ã€‚ä¸è¿‡ä½ å†ä»”ç»†ç‚¹çš„è¯ï¼Œä¼šå‘ç°è¿™é‡Œå…¶å®è¿˜ç¼ºå°‘äº†ä¸€ä¸ªç›´è§‚çš„æœºåˆ¶ï¼Œé‚£å°±æ˜¯<strong>å¦‚ä½•å¤„ç†å¯¹è¯æ¡†çš„è¿”å›å€¼</strong>ã€‚</p><h2>å¤„ç†å¯¹è¯æ¡†è¿”å›å€¼</h2><p>å¦‚æœè¯´å¯¹è¯æ¡†å’Œé¡µé¢è¿™ä¸¤ç§ UI æ¨¡å¼åŸºæœ¬ä¸Šæ˜¯ä¸€è‡´çš„ï¼Œéƒ½æ˜¯ç‹¬ç«‹çª—å£å®Œæˆç‹¬ç«‹é€»è¾‘ã€‚ä½†æ˜¯åœ¨ç”¨æˆ·äº¤äº’ä¸Šï¼Œå´æ˜¯æœ‰ä¸€å®šçš„å·®åˆ«ï¼Œ</p><ul>\n<li>å¯¹è¯æ¡†å¯èƒ½éœ€è¦è¿”å›å€¼ç»™è°ƒç”¨è€…ï¼›</li>\n<li>è€Œé¡µé¢åˆ‡æ¢ä¸€èˆ¬ä¸ä¼šå…³å¿ƒé¡µé¢æ‰§è¡Œçš„ç»“æœæ˜¯ä»€ä¹ˆã€‚</li>\n</ul><p>é‚£ä¹ˆåŸºäºä¸Šé¢çš„ NiceModal å®ç°é€»è¾‘ï¼Œç°åœ¨çš„é—®é¢˜å°±æ˜¯ï¼Œ<strong>æˆ‘ä»¬åº”è¯¥å¦‚ä½•è®©è°ƒç”¨è€…è·å¾—è¿”å›å€¼å‘¢ï¼Ÿ</strong></p><p>è€ƒè™‘åˆ°æˆ‘ä»¬å¯ä»¥æŠŠç”¨æˆ·åœ¨å¯¹è¯æ¡†ä¸­çš„æ“ä½œçœ‹æˆä¸€ä¸ªå¼‚æ­¥æ“ä½œé€»è¾‘ï¼Œé‚£ä¹ˆç”¨æˆ·åœ¨å®Œæˆäº†å¯¹è¯æ¡†ä¸­å†…å®¹çš„æ“ä½œä¹‹åï¼Œå°±è®¤ä¸ºå¼‚æ­¥é€»è¾‘å®Œæˆäº†ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥<strong>åˆ©ç”¨ Promise</strong> æ¥å®Œæˆè¿™æ ·çš„é€»è¾‘ã€‚</p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬è¦å®ç°çš„ API å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>const modal = useNiceModal('my-modal');\n// å®ç°ä¸€ä¸ª promise API æ¥å¤„ç†è¿”å›å€¼\nmodal.show(args).then(result =&gt; {});\n</code></pre><p>äº‹å®ä¸Šï¼Œè¦å®ç°è¿™æ ·ä¸€ä¸ªæœºåˆ¶å¹¶ä¸å›°éš¾ï¼Œå°±æ˜¯åœ¨ useNiceModal è¿™ä¸ª Hook çš„å®ç°ä¸­æä¾›ä¸€ä¸ª modal.resolve è¿™æ ·çš„æ–¹æ³•ï¼Œèƒ½å¤Ÿå» resolve modal.show è¿”å›çš„ Promiseã€‚</p><p>å®ç°çš„ä»£ç æ€è·¯å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>const modal = useNiceModal('my-modal');\n// å®ç°ä¸€ä¸ª promise API æ¥å¤„ç†è¿”å›å€¼\nmodal.show(args).then(result =&gt; {});\n</code></pre><p>ä»£ç çš„æ ¸å¿ƒæ€è·¯å°±æ˜¯<strong>å°† show å’Œ resolve ä¸¤ä¸ªå‡½æ•°é€šè¿‡ Promise è”ç³»èµ·æ¥</strong>ã€‚å› ä¸ºä¸¤ä¸ªå‡½æ•°çš„è°ƒç”¨ä½ç½®ä¸ä¸€æ ·ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªå±€éƒ¨çš„ä¸´æ—¶å˜é‡ï¼Œæ¥å­˜æ”¾ resolve å›è°ƒå‡½æ•°ã€‚é€šè¿‡è¿™æ ·çš„æœºåˆ¶ï¼Œå°±å¯ä»¥åœ¨å¯¹è¯æ¡†ä¸­å»è°ƒç”¨ modal.resolve æ¥è¿”å›å€¼äº†ã€‚</p><p>ä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†å…·ä½“ä½¿ç”¨çš„ä¸€ä¸ªä¾‹å­ï¼š</p><pre><code>// ä½¿ç”¨ä¸€ä¸ª object ç¼“å­˜ promise çš„ resolve å›è°ƒå‡½æ•°\nconst modalCallbacks = {};\nexport const useNiceModal = (modalId) =&gt; {\n  const dispatch = useDispatch();\n  const show = useCallback(\n    (args) =&gt; {\n      return new Promise((resolve) =&gt; {\n        // æ˜¾ç¤ºå¯¹è¯æ¡†æ—¶ï¼Œè¿”å› promise å¹¶ä¸”å°† resolve æ–¹æ³•ä¸´æ—¶å­˜èµ·æ¥\n        modalCallbacks[modalId] = resolve;\n        dispatch(showModal(modalId, args));\n      });\n    },\n    [dispatch, modalId],\n  );\n  const resolve = useCallback(\n    (args) =&gt; {\n      if (modalCallbacks[modalId]) {\n        // å¦‚æœå­˜åœ¨ resolve å›è°ƒå‡½æ•°ï¼Œé‚£ä¹ˆå°±è°ƒç”¨\n        modalCallbacks[modalId](args);\n        // ç¡®ä¿åªèƒ½ resolve ä¸€æ¬¡\n        delete modalCallbacks[modalId];\n      }\n    },\n    [modalId],\n  );\n  \n  // å…¶å®ƒé€»è¾‘...\n\n  // å°† resolve ä¹Ÿä½œä¸ºè¿”å›å€¼çš„ä¸€éƒ¨åˆ†\n  return { show, hide, resolve, visible, hiding };\n};\n</code></pre><p>è¿™æ®µç¤ºæ„ä»£ç åŒ…æ‹¬ä¸¤ä¸ªéƒ¨åˆ†ã€‚</p><p>é¦–å…ˆæ˜¯åœ¨ UserList çš„è¡¨æ ¼ç»„ä»¶ä¸­ï¼Œç”±ç¼–è¾‘æŒ‰é’®è§¦å‘å¯¹è¯æ¡†çš„æ˜¾ç¤ºï¼Œå¹¶åœ¨å¯¹è¯æ¡†è¿”å›åï¼Œå°†ç”¨æˆ·è¾“å…¥æ›´æ–°åˆ°è¡¨æ ¼ã€‚</p><p>ç¬¬äºŒéƒ¨åˆ†åˆ™æ˜¯åœ¨å¯¹è¯æ¡†ä¸­ï¼Œç”¨æˆ·ç‚¹å‡»äº†ç¡®å®šæŒ‰é’®åè°ƒç”¨ modal.resolve æ–¹æ³•ï¼Œå°†ç”¨æˆ·è¾“å…¥è¿”å›ç»™ UserList ç»„ä»¶ï¼Œä»è€Œå®Œæˆæ•´ä¸ªç¼–è¾‘æµç¨‹ã€‚</p><h2>å°ç»“</h2><p>åœ¨è¿™èŠ‚è¯¾æˆ‘ä»¬ä¸»è¦å­¦ä¹ äº†åœ¨ React ä¸­ä½¿ç”¨å¯¹è¯æ¡†çš„ä¸€ç§å®è·µæ–¹å¼ï¼š<strong>åˆ©ç”¨å…¨å±€çŠ¶æ€æ¥ç®¡ç†å¯¹è¯æ¡†ã€‚</strong></p><p>å…¶æ ¸å¿ƒæ€è·¯åœ¨äº<strong>ä» UI æ¨¡å¼çš„è§’åº¦å‡ºå‘ï¼Œè®¤è¯†åˆ°å¯¹è¯æ¡†å’Œé¡µé¢åœ¨å¾ˆå¤šæ—¶å€™æ˜¯éå¸¸ç±»ä¼¼çš„ï¼Œéƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹åŠŸèƒ½çš„ UI å±•ç°</strong>ã€‚</p><p>å› æ­¤ï¼Œç”¨å…¨å±€çš„æ–¹å¼å»ç®¡ç†å¯¹è¯æ¡†å°±æ˜¯ä¸€ç§éå¸¸åˆç†çš„æ–¹å¼ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½è§£å†³å¾ˆå¤šåœ¨ React å¼€å‘ä¸­ç»å¸¸é‡åˆ°çš„å„ç§å¯¹è¯æ¡†å®ç°éš¾é¢˜ï¼Œä»è€Œè®©ç»„ä»¶çš„è¯­ä¹‰æ›´åŠ æ¸…æ¥šï¼Œä»£ç æ›´å®¹æ˜“ç†è§£å’Œç»´æŠ¤ã€‚</p><p>è¿™é‡Œè¦ç€é‡å¼ºè°ƒä¸€ç‚¹ã€‚åœ¨å®ç°éƒ¨åˆ†ï¼Œæˆ‘ä»¬ç”¨åˆ°äº† Redux ä½œä¸ºå…¨å±€çŠ¶æ€ç®¡ç†æ¡†æ¶æ¥ç®¡ç†å¯¹è¯æ¡†çš„çŠ¶æ€ï¼Œå¹¶åˆ©ç”¨äº†è‡ªå®šä¹‰ Hook useNiceModal å»å®ç°çŠ¶æ€ç®¡ç†é€»è¾‘çš„é‡ç”¨ã€‚</p><p>è™½ç„¶çœ‹ä¸Šå»æ˜¯å®ç°äº†ä¸€ä¸ªæ¡†æ¶çº§åˆ«çš„æœºåˆ¶ï¼Œä½†æ˜¯å®é™…ä¸Šæ ¸å¿ƒä»£ç åªæœ‰100è¡Œå·¦å³ï¼Œä½ åœ¨å®é™…é¡¹ç›®ä¸­å®Œå…¨å¯ä»¥å°†å…¶å¤åˆ¶åˆ°ä½ çš„é¡¹ç›®ä¸­ï¼Œå¹¶åœ¨ç†è§£çš„åŸºç¡€ä¸Šï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚å’Œåœºæ™¯å»å®šåˆ¶ä½¿ç”¨ã€‚åˆ°æ—¶å€™ä½ å°±èƒ½æ„Ÿå—åˆ°è¿™ä¸ªæœºåˆ¶å¸¦ç»™ä½ çš„æƒŠå–œäº†ã€‚</p><p>è¿™é‡Œä¹Ÿè¦è¯´æ˜ä¸€ç‚¹ï¼Œä½¿ç”¨äº†å…¨å±€æ–¹å¼ç®¡ç†å¯¹è¯æ¡†ï¼Œå¹¶ä¸æ„å‘³ç€ä½ å°±ä¸èƒ½ä½¿ç”¨æœ¬åœ°çŠ¶æ€çš„å¯¹è¯æ¡†äº†ã€‚å¯¹äºä¸€äº›éå¸¸ç®€å•çš„åœºæ™¯ï¼Œæ¯”å¦‚ä½ å¾ˆç¡®å®šæŸä¸ªå¯¹è¯æ¡†ä¸€å®šåªåœ¨æŸä¸ªç»„ä»¶å†…æ‰è¢«ä½¿ç”¨ï¼Œä¹Ÿæ˜¯å¯ä»¥ç»§ç»­ä½¿ç”¨æœ¬åœ°å£°æ˜çš„å¯¹è¯æ¡†çš„ã€‚æˆ‘ä»¬è¦æ˜ç™½ï¼Œå…¨å±€æ–¹å¼å’Œæœ¬åœ°æ–¹å¼æ˜¯å®Œå…¨ä¸å†²çªçš„ï¼Œæ˜¯å¯ä»¥å…±å­˜çš„ã€‚</p><p>æ–‡ä¸­æ‰€æœ‰çš„ç¤ºä¾‹ä»£ç å’Œè¿è¡Œæ•ˆæœéƒ½å¯ä»¥é€šè¿‡ codesandbox æŸ¥çœ‹ï¼š<a href=\"https://codesandbox.io/s/react-hooks-course-20vzg\">https://codesandbox.io/s/react-hooks-course-20vzg</a> ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Redux æ¥ç®¡ç†æ‰€æœ‰å¯¹è¯æ¡†çš„æ‰€æœ‰çŠ¶æ€ã€‚ä½†æœ‰æ—¶å€™ä½ çš„é¡¹ç›®å¹¶ä¸ä¸€å®šä½¿ç”¨äº† Reduxï¼Œé‚£ä¹ˆæˆ‘ä»¬å…¶å®ä¹Ÿå¯ä»¥ä½¿ç”¨ Context æ¥ç®¡ç†å¯¹è¯æ¡†çš„å…¨å±€çŠ¶æ€ã€‚é‚£ä¹ˆè¯·ä½ æ€è€ƒä¸€ä¸‹ï¼Œå¦‚æœåŸºäº Context ï¼Œåº”è¯¥å¦‚ä½•å®ç° NiceModal å‘¢ï¼Ÿ</p><p>æ¬¢è¿æŠŠä½ çš„æƒ³æ³•å’Œæ€è€ƒåˆ†äº«åœ¨ç•™è¨€åŒºï¼Œæˆ‘ä¼šå’Œä½ äº¤æµã€‚åŒæ—¶ï¼Œæˆ‘ä¹Ÿä¼šæŠŠå…¶ä¸­ä¸€äº›ä¸é”™çš„å›ç­”åœ¨ç•™è¨€åŒºç½®é¡¶ï¼Œä¾›å¤§å®¶å­¦ä¹ è®¨è®ºã€‚</p>","neighbors":{"left":{"article_title":"13ï½œFormï¼šHooks ç»™ Form å¤„ç†å¸¦æ¥äº†å“ªäº›æ–°å˜åŒ–ï¼Ÿ","id":387824},"right":{"article_title":"15 | è·¯ç”±ç®¡ç†ï¼šä¸ºä»€ä¹ˆæ¯ä¸€ä¸ªå‰ç«¯åº”ç”¨éƒ½éœ€è¦ä½¿ç”¨è·¯ç”±æœºåˆ¶ï¼Ÿ","id":389596}},"comments":[{"had_liked":false,"id":314775,"user_name":"å’šé—¨","can_delete":false,"product_type":"c1","uid":1448473,"ip_address":"","ucode":"DD4E8734370BBF","user_header":"https://static001.geekbang.org/account/avatar/00/16/1a/19/5e4ca139.jpg","comment_is_top":false,"comment_ctime":1633419928,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"57467994776","product_id":100079901,"comment_content":"å…¶å®æˆ‘æ„Ÿè§‰æœ‰ç‚¹ç®€å•é—®é¢˜å¤æ‚åŒ–äº†ï¼Œæ–‡ç« ä¸€å¼€å§‹è¦è§£å†³çš„é—®é¢˜æ˜¯ä¸¤ä¸ªç»„ä»¶éœ€è¦ç”¨åˆ°åŒä¸€ä¸ªmodalçš„é—®é¢˜ï¼Œè¿™æ—¶å€™æœ¬èº«å°±ä¸è¯¥æŠŠUserInfoModalæ”¾åˆ°Siderå’ŒUserInfoçš„çˆ¶äº²ç»„ä»¶ï¼Œè¿™ä¸ç¬¦åˆreactçš„ç»„åˆæ€æƒ³ï¼Œè€Œæ˜¯åº”è¯¥åœ¨Siderå’ŒUserInfoé‡Œåˆ†åˆ«è°ƒç”¨UserInfoModal å¹¶æ§åˆ¶æ˜¾ç¤ºä¸å¦å°±å¥½äº†ã€‚å®šä¹‰å…¨å±€modalçŠ¶æ€ç®¡ç†è¿èƒŒäº†å‰é¢å‡ ç« è®²çš„æ–‡ä»¶ç»„åˆå»ä¾èµ–è¿™ä¸ªåŸåˆ™å§ï¼Œæ•´ä¸ªç³»ç»Ÿçš„modalé«˜åº¦è€¦åˆï¼Œæ–°äººæ¥äº†å¾—èŠ±å¾ˆå¤šæ—¶é—´ç†è§£ã€‚å¹¶ä¸”ï¼Œçœ‹ä»£ç è™½ç„¶åˆ¤æ–­äº†visibleåå›null,ä½†æ˜¯æœ¬èº«æ˜¯æœ‰å¤šå°‘ä¸ªmodalå°±ä¸€ç›´å­˜åœ¨äº†å°‘ä¸ª instance,è€Œmodalå¾€å¾€åªèƒ½åŒæ—¶å­˜åœ¨ä¸€ä¸ªã€‚","like_count":13},{"had_liked":false,"id":300020,"user_name":"çæƒœçœ¼å‰äºº","can_delete":false,"product_type":"c1","uid":1387988,"ip_address":"","ucode":"7443DA4F24E35B","user_header":"https://static001.geekbang.org/account/avatar/00/15/2d/d4/76ffbdfc.jpg","comment_is_top":false,"comment_ctime":1624956876,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"40279662540","product_id":100079901,"comment_content":"å»ºè®®å¤§å®¶ä¸€å®šè¦è·Ÿç€è€å¸ˆçš„ä»£ç æ•²ï¼Œè¿™èŠ‚å¯¹äºæˆ‘è¿™ä¸ªæ–°æ‰‹æ¥è¯´æœ‰ç‚¹éš¾åº¦","like_count":9},{"had_liked":false,"id":308124,"user_name":"Brave","can_delete":false,"product_type":"c1","uid":1378339,"ip_address":"","ucode":"4F66150D471D3B","user_header":"https://static001.geekbang.org/account/avatar/00/15/08/23/1cc7d190.jpg","comment_is_top":false,"comment_ctime":1629422699,"is_pvip":false,"replies":[{"id":"111729","content":"å›ç­”çš„å¾ˆå¥½ï¼Œç»“åˆäº† useReducer å’Œ useContext ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œä» redux è½¬åˆ° contextï¼ŒåŸºæœ¬ä»£ç é€»è¾‘æ˜¯æ²¡æœ‰å˜åŒ–çš„ï¼Œéƒ½æ˜¯ dispatch actionã€‚è¿™é‡Œä¹Ÿçœ‹åˆ°äº† useReducer çš„ä½¿ç”¨åœºæ™¯ï¼Œé€šå¸¸éƒ½ä¼šå’Œ useContext ç»“åˆæ¥å®Œæˆä¸€äº›æ¯”è¾ƒå¤æ‚çš„æ•°æ®ç®¡ç†é€»è¾‘ï¼Œåœ¨ä¸€å®šç¨‹åº¦å¯ä»¥å–ä»£ reduxã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Nate","uid":"1018676","ctime":1629726225,"ip_address":"","comment_id":308124,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35989161067","product_id":100079901,"comment_content":"å¯¹äºæ€è€ƒé¢˜è¿™æ˜¯æˆ‘çš„æƒ³æ³•ï¼š<br><br>import React, {useContext, useReducer} from &#39;react&#39;<br>import {reducer, ModalContext} from &quot;.&#47;NiceModal&#47;modalContext&quot;;<br>import Demo1 from &quot;.&#47;demo1&quot;;<br><br>const Main = () =&gt; {<br><br>    const context = useContext(ModalContext)<br>    const [state, dispatch] = useReducer(reducer, context.state)<br>    return (<br>        &lt;ModalContext.Provider value={{<br>            state,<br>            dispatch,<br>        }}&gt;<br>            &lt;Demo1&#47;&gt;<br>        &lt;&#47;ModalContext.Provider&gt;<br>    )<br>}<br><br>export default Main<br><br>åˆ›å»ºuseNiceModalï¼š<br><br>const useNiceModal = (modalId) =&gt; {<br>    const {state, dispatch} = useContext(ModalContext)<br>    const args = state[modalId]<br><br>    const show = useCallback((args) =&gt; {<br>        dispatch({<br>            type: &#39;show&#39;,<br>            modalId,<br>            args<br>        })<br>    }, [modalId, args, dispatch])<br><br>    const hide = useCallback(() =&gt; {<br>        dispatch({<br>            type: &#39;hide&#39;,<br>            modalId<br>        })<br>    }, [dispatch, modalId])<br><br>    return {<br>        show,<br>        hide,<br>        args,<br>        visible: !!args,<br>    }<br>}<br><br>export default useNiceModal<br><br>åœ¨Demo1ä¸­ï¼š<br><br>const Demo1 = () =&gt; {<br><br>    const modalId = &#39;my-first-modal&#39;<br><br>    const Content = (props) =&gt; {<br>        return (<br>            &lt;div&gt;Hello world!&lt;&#47;div&gt;<br>        )<br>    }<br><br>    const MyModal = createNiceModal({<br>        modalId,<br>        title: &#39;è¿™æ˜¯æˆ‘çš„æ ‡é¢˜&#39;,<br>        content: &#39;è¿™æ˜¯æˆ‘çš„å†…å®¹&#39;<br>    }, Content)<br><br>    const modal = useNiceModal(modalId)<br><br>    return (<br>        &lt;div&gt;<br>            &lt;button onClick={() =&gt; modal.show()}&gt;<br>                æ‰“å¼€å¼¹çª—<br>            &lt;&#47;button&gt;<br>            &lt;MyModal&#47;&gt;<br>        &lt;&#47;div&gt;<br>    )<br>}<br><br>export default Demo1<br>","like_count":8,"discussions":[{"author":{"id":1018676,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/34/61035278.jpg","nickname":"Nate","note":"","ucode":"844B4C20BB3D6E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525399,"discussion_content":"å›ç­”çš„å¾ˆå¥½ï¼Œç»“åˆäº† useReducer å’Œ useContext ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œä» redux è½¬åˆ° contextï¼ŒåŸºæœ¬ä»£ç é€»è¾‘æ˜¯æ²¡æœ‰å˜åŒ–çš„ï¼Œéƒ½æ˜¯ dispatch actionã€‚è¿™é‡Œä¹Ÿçœ‹åˆ°äº† useReducer çš„ä½¿ç”¨åœºæ™¯ï¼Œé€šå¸¸éƒ½ä¼šå’Œ useContext ç»“åˆæ¥å®Œæˆä¸€äº›æ¯”è¾ƒå¤æ‚çš„æ•°æ®ç®¡ç†é€»è¾‘ï¼Œåœ¨ä¸€å®šç¨‹åº¦å¯ä»¥å–ä»£ reduxã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629726225,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":299473,"user_name":"ä½•ç”¨","can_delete":false,"product_type":"c1","uid":1377393,"ip_address":"","ucode":"B0C6E8176AE6FD","user_header":"https://static001.geekbang.org/account/avatar/00/15/04/71/0b949a4c.jpg","comment_is_top":false,"comment_ctime":1624663929,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14509565817","product_id":100079901,"comment_content":"å¼¹å‡ºå±‚å¹¶ä¸ä»…é™äº Modal, è¿˜æœ‰ Drawer ç­‰ç­‰ã€‚è¿™äº›å¼¹å‡ºå±‚æ˜¾éšå¤„ç†é€»è¾‘éƒ½å¾ˆç›¸ä¼¼ï¼Œå› è€Œå¯ä»¥è€ƒè™‘ä¸ªæ›´é€šç”¨çš„å‘½åï¼Œæ¯”å¦‚è¯´å« Overlayã€‚","like_count":3},{"had_liked":false,"id":314774,"user_name":"å’šé—¨","can_delete":false,"product_type":"c1","uid":1448473,"ip_address":"","ucode":"DD4E8734370BBF","user_header":"https://static001.geekbang.org/account/avatar/00/16/1a/19/5e4ca139.jpg","comment_is_top":false,"comment_ctime":1633419817,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10223354409","product_id":100079901,"comment_content":"å…¶å®æˆ‘æ„Ÿè§‰æœ‰ç‚¹ç®€å•é—®é¢˜å¤æ‚åŒ–äº†ï¼Œæ–‡ç« ä¸€å¼€å§‹è¦è§£å†³çš„é—®é¢˜æ˜¯ä¸¤ä¸ªç»„ä»¶éœ€è¦ç”¨åˆ°åŒä¸€ä¸ªmodalçš„é—®é¢˜ï¼Œè¿™æ—¶å€™æœ¬èº«å°±ä¸è¯¥æŠŠUserInfoModalæ”¾åˆ°Siderå’ŒUserInfoçš„çˆ¶äº²ç»„ä»¶ï¼Œè¿™ä¸ç¬¦åˆreactçš„ç»„åˆæ€æƒ³ï¼Œè€Œæ˜¯åº”è¯¥åœ¨Siderå’ŒUserInfoé‡Œåˆ†åˆ«è°ƒç”¨UserInfoModal å¹¶æ§åˆ¶æ˜¾ç¤ºä¸å¦å°±å¥½äº†ã€‚å®šä¹‰å…¨å±€modalçŠ¶æ€ç®¡ç†è¿èƒŒäº†å‰é¢å‡ ç« è®²çš„æ–‡ä»¶ç»„åˆå»ä¾èµ–è¿™ä¸ªåŸåˆ™å§ï¼Œæ•´ä¸ªç³»ç»Ÿçš„modalé«˜åº¦è€¦åˆï¼Œæ–°äººæ¥äº†å¾—èŠ±å¾ˆå¤šæ—¶é—´ç†è§£ã€‚å¹¶ä¸”ï¼Œçœ‹ä»£ç è™½ç„¶åˆ¤æ–­äº†visibleåå›null,ä½†æ˜¯æœ¬èº«æ˜¯æœ‰å¤šå°‘ä¸ªmodalå°±ä¸€ç›´å­˜åœ¨äº†å°‘ä¸ª instance,è€Œmodalå¾€å¾€åªèƒ½åŒæ—¶å­˜åœ¨ä¸€ä¸ªã€‚","like_count":2},{"had_liked":false,"id":300877,"user_name":"Bugèˆ¬çš„å­˜åœ¨","can_delete":false,"product_type":"c1","uid":1573766,"ip_address":"","ucode":"7A61F7AA3B49A3","user_header":"https://static001.geekbang.org/account/avatar/00/18/03/86/c9051c6a.jpg","comment_is_top":false,"comment_ctime":1625412722,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10215347314","product_id":100079901,"comment_content":"modal.show().then() æ„Ÿè§‰è¿™ä¸ªæ€è·¯æ‰“æ­»æˆ‘æˆ‘ä¹Ÿæƒ³ä¸å‡ºæ¥ï¼Œæˆ‘ä¸é…åšç¨‹åºå‘˜ğŸ˜‚","like_count":2,"discussions":[{"author":{"id":1573766,"avatar":"https://static001.geekbang.org/account/avatar/00/18/03/86/c9051c6a.jpg","nickname":"Bugèˆ¬çš„å­˜åœ¨","note":"","ucode":"7A61F7AA3B49A3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382154,"discussion_content":"æœ€è¿‘åŠ è…¾è®¯é˜²æ°´å¢™ï¼Œæ­£å¥½åˆ©ç”¨è¿™ä¸ªæ€è·¯æ”¹é€ äº†ä¸€ä¸‹\nä¸€å¼€å§‹å°±æƒ³æ€ä¹ˆæ‹¿åˆ°é˜²æ°´å¢™çš„`res` ï¼Œæ²¡æœ‰æ€è·¯ï¼Œå°±åªå¥½ä¼ å…¥äº†ä¸€ä¸ªå›è°ƒï¼Œä½†æ˜¯å¾ˆä¸çµæ´»ã€‚æ”¹é€ åå¯ä»¥ç›´æ¥ä»å¤–éƒ¨æ‹¿åˆ°ç»“æœï¼Œæƒ³æ€ä¹ˆç”¨å°±æ€ä¹ˆç”¨ï¼Œçˆ½~ğŸ˜„\næœ‰ä¸ªç–‘é—®ï¼šæˆ‘è¿™æ®µä»£ç å¯èƒ½ä¼šç”Ÿæˆå¤§é‡ `pending` çŠ¶æ€çš„ promiseï¼Œä¸çŸ¥é“ä¼šä¸ä¼šæœ‰å½±å“ï¼Œè¦ä¸è¦æŠŠ `if (res.ret !== 0) return;` å»æ‰å‘¢\n\n```js\nclass TencentCaptcha {\n// ...\nprivate initCaptcha() {\n    this.tencentCaptcha = new window.TencentCaptcha(\n      tencentCaptchaAppId,\n      (res) => {\n        if (res.ret !== 0) return;\n        this.getResult({\n          randstr: res.randstr,\n          ticket: res.ticket,\n        });\n      },\n      this.options,\n    );\n  }\n\n  show() {\n    this.tencentCaptcha.show();\n    return new Promise((resolve) => {\n      this.getResult = resolve\n    })\n  }\n// ...\n}\n```","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625453072,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":336070,"user_name":"Geek_6304e3","can_delete":false,"product_type":"c1","uid":2905630,"ip_address":"","ucode":"8DD9A6D8E7DC60","user_header":"","comment_is_top":false,"comment_ctime":1645879824,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5940847120","product_id":100079901,"comment_content":"æ„Ÿè§‰æ²¡å¿…è¦ï¼Œè¿™æ ·å­ç®€å•çš„é—®é¢˜å¤æ‚åŒ–äº†","like_count":1},{"had_liked":false,"id":299472,"user_name":"ä½•ç”¨","can_delete":false,"product_type":"c1","uid":1377393,"ip_address":"","ucode":"B0C6E8176AE6FD","user_header":"https://static001.geekbang.org/account/avatar/00/15/04/71/0b949a4c.jpg","comment_is_top":false,"comment_ctime":1624663663,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5919630959","product_id":100079901,"comment_content":"å•çº¯ç”¨ react æ¥ç®¡ç†å¯¹è¯æ¡†çš„å…¨å±€çŠ¶æ€ï¼Œå¯ä»¥ä½¿ç”¨ Context + useReducer API æ¥å®ç°ï¼Œæ€è·¯å¤§åŒå°å¼‚","like_count":1},{"had_liked":false,"id":360400,"user_name":"Geek_3656b2","can_delete":false,"product_type":"c1","uid":1306962,"ip_address":"ç¦å»º","ucode":"8562CCE7E86951","user_header":"","comment_is_top":false,"comment_ctime":1666540949,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1666540949","product_id":100079901,"comment_content":"åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªç®€å•çš„ MyModal ç»„ä»¶ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æŠŠå¤šç”»æ¡†é€»è¾‘å†™åœ¨å•ç‹¬çš„ç»„ä»¶ä¸­â€¦<br><br>å¤šç”»æ¡†åº”è¯¥æ˜¯å¯¹è¯æ¡†ã€‚","like_count":0},{"had_liked":false,"id":353955,"user_name":"ææµ…","can_delete":false,"product_type":"c1","uid":2819061,"ip_address":"ç¦å»º","ucode":"351D5C13345B5C","user_header":"https://static001.geekbang.org/account/avatar/00/2b/03/f5/ed243c62.jpg","comment_is_top":false,"comment_ctime":1659950744,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1659950744","product_id":100079901,"comment_content":"æˆ‘æ„Ÿè§‰åªæ˜¯å¤ç”¨åŒä¸€ä¸ªå¯¹è¯æ¡†ï¼Œæ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†å¯¹äºæ¯ä¸€ä¸ªé¡µé¢æ¥è¯´ï¼Œå¯¹è¯æ¡†æ˜¾ç¤ºçš„å†…å®¹éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼ï¼Œä¹Ÿä¸æ˜¯éå¸¸æ–¹ä¾¿","like_count":0},{"had_liked":false,"id":349607,"user_name":"é²æ»¨é€Š","can_delete":false,"product_type":"c1","uid":1387826,"ip_address":"","ucode":"AD58F1115DF311","user_header":"https://static001.geekbang.org/account/avatar/00/15/2d/32/43595745.jpg","comment_is_top":false,"comment_ctime":1656134127,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1656134127","product_id":100079901,"comment_content":"æ„Ÿè§‰ä»£ç æ¯”è¾ƒå¤šçš„ç« èŠ‚è¿˜æ˜¯éœ€è¦å» codesandboxä¸Šçœ‹å®Œæ•´çš„ä»£ç å®ç°ï¼Œç„¶åè‡ªå·±æ•²ä¸€éï¼Œæœ€å¥½åœ¨æ‰¾å‡ ä¸ªåœºæ™¯ç”¨ä¸€ä¸‹ï¼Œä¸ç„¶è¿˜æ˜¯æŒæ¡ä¸äº†","like_count":0},{"had_liked":false,"id":347276,"user_name":"Geek_4e92cc","can_delete":false,"product_type":"c1","uid":2995810,"ip_address":"","ucode":"1DD2764FD8C4E8","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eotuhVFN9phZsthxdS2bBAV9Cjb1NqIFbSQhiclmtsUDCn1cOKrzU8Ie1ickxlWC4kIlI3S69XrST7w/132","comment_is_top":false,"comment_ctime":1653894010,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1653894010","product_id":100079901,"comment_content":"ä¸ºä»€ä¹ˆä¸ç”¨ä¼ é€é—¨ä¼ åˆ°æ ¹èŠ‚ç‚¹renderå‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":343056,"user_name":"Sun ğŸ™ƒ","can_delete":false,"product_type":"c1","uid":1396293,"ip_address":"","ucode":"342590FE20F231","user_header":"https://static001.geekbang.org/account/avatar/00/15/4e/45/1e463459.jpg","comment_is_top":false,"comment_ctime":1650612366,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1650612366","product_id":100079901,"comment_content":"Modalä¸ºä»€ä¹ˆä¸èƒ½æ”¾åœ¨å­ç»„ä»¶ä¸­å‘¢ï¼Œå“ªä¸ªç»„ä»¶è°ƒç”¨modalå°±æŠŠè¿™ä¸ªmodalç»„ä»¶æ”¾åœ¨å“ªä¸ªç»„ä»¶ä¸­ä¸è¡Œå—ï¼Ÿ","like_count":0},{"had_liked":false,"id":335609,"user_name":"Geek_ccb74b","can_delete":false,"product_type":"c1","uid":1284027,"ip_address":"","ucode":"3C3C1C87238170","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Uc6N5Zug5c195JzkUslt08GvVgLDWcleRcsgUOrIwXPHlAib65GJtEFHESVeQ9sfklLSXMPMsU1UqNb4q4B6gxw/132","comment_is_top":false,"comment_ctime":1645602829,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1645602829","product_id":100079901,"comment_content":"æ²¡çœ‹æ‡‚ï¼Œé€šè¯»å®Œå›å¤´ä¾¿æ•²è¾¹çœ‹ï¼Œè¿™ä¸€ç« æˆ‘å®šä¼šææ˜ç™½ï¼Œå› ä¸ºå¹³æ—¶å†™ modal å¤ªç—›è‹¦äº†ã€‚","like_count":0},{"had_liked":false,"id":320619,"user_name":"å¤©å¤©","can_delete":false,"product_type":"c1","uid":2000254,"ip_address":"","ucode":"2B9414A72EB338","user_header":"https://static001.geekbang.org/account/avatar/00/1e/85/7e/dc5ee66c.jpg","comment_is_top":false,"comment_ctime":1636424843,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636424843","product_id":100079901,"comment_content":"è¿™ä¸€ç¯‡ç¡®å®æ€è·¯å¯ä»¥å€Ÿé‰´ï¼Œä½†æ˜¯æ„Ÿè§‰è¿˜æ˜¯åšå¾—æœ‰ç‚¹é‡äº†ï¼Œå¯èƒ½æœ‰å¤§è§„æ¨¡å¼¹çª—çš„ä¸šåŠ¡é€‚åˆ","like_count":0},{"had_liked":false,"id":317655,"user_name":"æ–¯å¡”å…‹","can_delete":false,"product_type":"c1","uid":2019446,"ip_address":"","ucode":"8BE17C01CADF0F","user_header":"","comment_is_top":false,"comment_ctime":1634881762,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634881762","product_id":100079901,"comment_content":"model idæ˜¯ä¸æ˜¯å¯ä»¥ç”¨æšä¸¾ç®¡ç†","like_count":0},{"had_liked":false,"id":314223,"user_name":"å°ç‚­","can_delete":false,"product_type":"c1","uid":1109544,"ip_address":"","ucode":"E20E3958CAF06C","user_header":"https://static001.geekbang.org/account/avatar/00/10/ee/28/c04a0c83.jpg","comment_is_top":false,"comment_ctime":1632906012,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1632906012","product_id":100079901,"comment_content":"è€å¸ˆï¼Œé—®ä¸€ä¸ªè¯­æ³•é—®é¢˜ï¼Œâ€œexport const useNiceModal = (modalId) =&gt; { â€ ä»£ç ä¸­çš„export const è¿™ç§å†™æ³•æœ‰å“ªäº›å¥½å¤„ï¼Ÿ","like_count":0},{"had_liked":false,"id":302806,"user_name":"SenjougaharaSama","can_delete":false,"product_type":"c1","uid":1007787,"ip_address":"","ucode":"B90D94A3763045","user_header":"https://static001.geekbang.org/account/avatar/00/0f/60/ab/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1626394912,"is_pvip":false,"replies":[{"id":"109873","content":"æ–‡ä¸­ç¤ºä¾‹çš„ antd modal å°±æ˜¯åŸºäº portal å®ç°çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Nate","uid":"1018676","ctime":1626855137,"ip_address":"","comment_id":302806,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1626394912","product_id":100079901,"comment_content":"ä¸ºå•¥ä¸ç›´æ¥é€šè¿‡portalï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1018676,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/34/61035278.jpg","nickname":"Nate","note":"","ucode":"844B4C20BB3D6E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523435,"discussion_content":"æ–‡ä¸­ç¤ºä¾‹çš„ antd modal å°±æ˜¯åŸºäº portal å®ç°çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626855137,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":301382,"user_name":"å‘èŠ½çš„ç´«èœ","can_delete":false,"product_type":"c1","uid":1055836,"ip_address":"","ucode":"49450F3287DF28","user_header":"https://static001.geekbang.org/account/avatar/00/10/1c/5c/f5f24221.jpg","comment_is_top":false,"comment_ctime":1625654950,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625654950","product_id":100079901,"comment_content":"NiceModalé‡Œé¢æœ‰  const modal = useNiceModal(id);  <br>åœ¨MyModalExampleä¹Ÿç”¨äº†  const modal = useNiceModal(&quot;my-modal&quot;);  <br>ç”¨äº†ä¸¤æ¬¡useNiceModalï¼Œè¿”å›å€¼çš„ä¸¤ä¸ªmodalåº”è¯¥æ˜¯ä¸åŒçš„å¯¹è±¡å§ï¼Ÿ modalé‡Œé¢çš„hideã€showå‡½æ•°åº”è¯¥ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œå¯¹å—ï¼Ÿ<br>ä¸è¿‡æ•°æ®éƒ½å­˜åœ¨const store = createStore(modalReducer); çš„storeé‡Œäº†ï¼Œæ˜¯å…¨å±€çš„","like_count":0},{"had_liked":false,"id":301054,"user_name":"å¸…æ°”å°ç†ŠçŒ«","can_delete":false,"product_type":"c1","uid":1022199,"ip_address":"","ucode":"88FE6B57F55063","user_header":"https://static001.geekbang.org/account/avatar/00/0f/98/f7/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1625498637,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625498637","product_id":100079901,"comment_content":"<br>è¿™ç§å…¨å±€çš„ä¸œè¥¿ æˆ‘è§‰å¾—ç”¨ react.creatPortal æ›´åˆé€‚.","like_count":0},{"had_liked":false,"id":300872,"user_name":"Bugèˆ¬çš„å­˜åœ¨","can_delete":false,"product_type":"c1","uid":1573766,"ip_address":"","ucode":"7A61F7AA3B49A3","user_header":"https://static001.geekbang.org/account/avatar/00/18/03/86/c9051c6a.jpg","comment_is_top":false,"comment_ctime":1625412203,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625412203","product_id":100079901,"comment_content":"æ„Ÿè§‰reducerä¸­çš„stateå®šä¹‰ä¸æ˜¯å¾ˆå¥½ç†è§£ï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯æ›´æ·±å±‚æ¬¡çš„è€ƒè™‘<br><br>æˆ‘æ˜¯å®šä¹‰æˆäº†ä¸‰ä¸ªçŠ¶æ€<br><br>enum TModalStatusEnum {<br>  SHOWN = &#39;å¯è§çš„&#39;,<br>  HIDING = &#39;æ­£åœ¨éšè—&#39;,<br>  HIDDEN = &#39;ä¸å¯è§&#39;,<br>}<br><br>interface TState {<br>  [modalId: string]: {<br>    status: TModalStatusEnum;<br>    args: any;<br>  }<br>}<br><br>&#47;&#47; reducerä¸­<br><br> case TNiceModalActionEnum.HIDE:<br>      return {<br>        ...state,<br>        [modalId]: {<br>          args: null,<br>          status: force ? TModalStatusEnum.HIDDEN : TModalStatusEnum.HIDING,<br>        },<br>      }<br><br>export const createNiceModal = &lt;T, P&gt;(<br>  modalId: string,<br>  Component: React.ComponentType&lt;T &amp; P&gt;<br>) =&gt; {<br>  &#47;&#47; è¿™é‡Œçš„ props æ˜¯ &lt;UserInfoModal props &#47;&gt; ä¸­çš„ props<br>  return (props: P) =&gt; {<br>    const { status, args } = useNiceModal&lt;T&gt;(modalId)<br>    &#47;&#47; å®Œå…¨éšè—åé”€æ¯ modal<br>    if (status === TModalStatusEnum.HIDDEN) return null<br>    return &lt;Component {...props} {...args} &#47;&gt;<br>  }<br>}<br><br>psï¼šä¸ªäººä¹ æƒ¯ type çš„å®šä¹‰ä»¥ T å¼€å¤´","like_count":0},{"had_liked":false,"id":299578,"user_name":"å‡¡å‡¡","can_delete":false,"product_type":"c1","uid":1374266,"ip_address":"","ucode":"CAEA596A037D9A","user_header":"https://static001.geekbang.org/account/avatar/00/14/f8/3a/dbf7bdee.jpg","comment_is_top":false,"comment_ctime":1624720646,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1624720646","product_id":100079901,"comment_content":" æ‰è™«ï¼šmodal.resolve è¿™æ ·çš„æ–¹æ³•åé¢çš„ä»£ç ç¤ºä¾‹é‡å¤ä¸Šä¸€æ®µçš„ä»£ç ç¤ºä¾‹","like_count":0}]}