{"id":424002,"title":"18ï½œé”™è¯¯å¤„ç†ï¼šä¸ºä»€ä¹ˆRustçš„é”™è¯¯å¤„ç†ä¸ä¼—ä¸åŒï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é™ˆå¤©ã€‚</p><p>ä½œä¸ºè¢«çº¿ä¸Šä¸šåŠ¡æ¯’æ‰“è¿‡çš„å¼€å‘è€…ï¼Œæˆ‘ä»¬éƒ½å¯¹å¢¨è²å®šå¾‹åˆ»éª¨é“­å¿ƒã€‚ä»»ä½•ä¸€ä¸ªç³»ç»Ÿï¼Œåªè¦è¿è¡Œçš„æ—¶é—´è¶³å¤Ÿä¹…ï¼Œæˆ–è€…ç”¨æˆ·çš„è§„æ¨¡è¶³å¤Ÿå¤§ï¼Œæå°æ¦‚ç‡çš„é”™è¯¯å°±ä¸€å®šä¼šå‘ç”Ÿã€‚æ¯”å¦‚ï¼Œä¸»æœºçš„ç£ç›˜å¯èƒ½è¢«å†™æ»¡ã€æ•°æ®åº“ç³»ç»Ÿå¯èƒ½ä¼šè„‘è£‚ã€ä¸Šæ¸¸çš„æœåŠ¡æ¯”å¦‚ CDN å¯èƒ½ä¼šå®•æœºï¼Œç”šè‡³æ‰¿è½½æœåŠ¡çš„ç¡¬ä»¶æœ¬èº«å¯èƒ½æŸåç­‰ç­‰ã€‚</p><p>å› ä¸ºæˆ‘ä»¬å¹³æ—¶å†™ç»ƒä¹ ä»£ç ï¼Œä¸€èˆ¬åªä¼šå…³æ³¨æ­£å¸¸è·¯å¾„ï¼Œå¯ä»¥å¯¹å°æ¦‚ç‡å‘ç”Ÿçš„é”™è¯¯è·¯å¾„ç½®ä¹‹ä¸ç†ï¼›<strong>ä½†åœ¨å®é™…ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä»»ä½•é”™è¯¯åªè¦æ²¡æœ‰å¾—åˆ°å¦¥å–„å¤„ç†ï¼Œå°±ä¼šç»™ç³»ç»ŸåŸ‹ä¸‹éšæ‚£</strong>ï¼Œè½»åˆ™å½±å“å¼€å‘è€…ç”¨æˆ·ä½“éªŒï¼Œé‡åˆ™ä¼šç»™ç³»ç»Ÿå¸¦æ¥å®‰å…¨ä¸Šçš„é—®é¢˜ï¼Œé©¬è™ä¸å¾—ã€‚</p><p>åœ¨ä¸€é—¨ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œæ§åˆ¶æµç¨‹æ˜¯è¯­è¨€çš„æ ¸å¿ƒæµç¨‹ï¼Œè€Œé”™è¯¯å¤„ç†åˆæ˜¯æ§åˆ¶æµç¨‹çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚</p><p>è¯­è¨€ä¼˜ç§€çš„é”™è¯¯å¤„ç†èƒ½åŠ›ï¼Œä¼šå¤§å¤§å‡å°‘é”™è¯¯å¤„ç†å¯¹æ•´ä½“æµç¨‹çš„ç ´åï¼Œè®©æˆ‘ä»¬å†™ä»£ç æ›´è¡Œäº‘æµæ°´ï¼Œè¯»èµ·æ¥å¿ƒæ™ºè´Ÿæ‹…ä¹Ÿæ›´å°ã€‚<br>\n<img src=\"https://static001.geekbang.org/resource/image/5b/a0/5bd062993b268ea982708203a4e2a5a0.jpg?wh=2485x1046\" alt=\"\"></p><p>å¯¹æˆ‘ä»¬å¼€å‘è€…æ¥è¯´ï¼Œé”™è¯¯å¤„ç†åŒ…å«è¿™ä¹ˆå‡ éƒ¨åˆ†ï¼š</p><ol>\n<li>å½“é”™è¯¯å‘ç”Ÿæ—¶ï¼Œç”¨åˆé€‚çš„é”™è¯¯ç±»å‹æ•è·è¿™ä¸ªé”™è¯¯ã€‚</li>\n<li>é”™è¯¯æ•è·åï¼Œå¯ä»¥ç«‹åˆ»å¤„ç†ï¼Œä¹Ÿå¯ä»¥å»¶è¿Ÿåˆ°ä¸å¾—ä¸å¤„ç†çš„åœ°æ–¹å†å¤„ç†ï¼Œè¿™å°±æ¶‰åŠåˆ°é”™è¯¯çš„ä¼ æ’­ï¼ˆpropagateï¼‰ã€‚</li>\n<li>æœ€åï¼Œæ ¹æ®ä¸åŒçš„é”™è¯¯ç±»å‹ï¼Œç»™ç”¨æˆ·è¿”å›åˆé€‚çš„ã€å¸®åŠ©ä»–ä»¬ç†è§£é—®é¢˜æ‰€åœ¨çš„é”™è¯¯æ¶ˆæ¯ã€‚</li>\n</ol><p>ä½œä¸ºä¸€é—¨æå…¶æ³¨é‡ç”¨æˆ·ä½“éªŒçš„ç¼–ç¨‹è¯­è¨€ï¼ŒRust ä»å…¶å®ƒä¼˜ç§€çš„è¯­è¨€ä¸­ï¼Œå°¤å…¶æ˜¯ Haskell ï¼Œå¸æ”¶äº†é”™è¯¯å¤„ç†çš„ç²¾é«“ï¼Œå¹¶ä»¥è‡ªå·±ç‹¬åˆ°çš„æ–¹å¼å±•ç°å‡ºæ¥ã€‚</p><!-- [[[read_end]]] --><h2>é”™è¯¯å¤„ç†çš„ä¸»æµæ–¹æ³•</h2><p>åœ¨è¯¦ç»†ä»‹ç» Rust çš„é”™è¯¯å¤„ç†æ–¹å¼ä¹‹å‰ï¼Œè®©æˆ‘ä»¬ç¨ç¨æ”¾æ…¢è„šæ­¥ï¼Œçœ‹çœ‹é”™è¯¯å¤„ç†çš„ä¸‰ç§ä¸»æµæ–¹æ³•ä»¥åŠå…¶ä»–è¯­è¨€æ˜¯å¦‚ä½•åº”ç”¨è¿™äº›æ–¹æ³•çš„ã€‚</p><h3>ä½¿ç”¨è¿”å›å€¼ï¼ˆé”™è¯¯ç ï¼‰</h3><p>ä½¿ç”¨è¿”å›å€¼æ¥è¡¨å¾é”™è¯¯ï¼Œæ˜¯æœ€å¤è€ä¹Ÿæ˜¯æœ€å®ç”¨çš„ä¸€ç§æ–¹å¼ï¼Œå®ƒçš„ä½¿ç”¨èŒƒå›´å¾ˆå¹¿ï¼Œä»å‡½æ•°è¿”å›å€¼ï¼Œåˆ°æ“ä½œç³»ç»Ÿçš„ç³»ç»Ÿè°ƒç”¨çš„é”™è¯¯ç  errnoã€è¿›ç¨‹é€€å‡ºçš„é”™è¯¯ç retvalï¼Œç”šè‡³ HTTP API çš„çŠ¶æ€ç ï¼Œéƒ½èƒ½çœ‹åˆ°è¿™ç§æ–¹æ³•çš„èº«å½±ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼Œåœ¨ C è¯­è¨€ä¸­ï¼Œå¦‚æœ fopen(filename) æ— æ³•æ‰“å¼€æ–‡ä»¶ï¼Œä¼šè¿”å› NULLï¼Œè°ƒç”¨è€…é€šè¿‡åˆ¤æ–­è¿”å›å€¼æ˜¯å¦ä¸º NULLï¼Œæ¥è¿›è¡Œç›¸åº”çš„é”™è¯¯å¤„ç†ã€‚</p><p>æˆ‘ä»¬å†çœ‹ä¸ªä¾‹å­ï¼š</p><pre><code class=\"language-c++\">size_t fread(void *ptr, size_t size, size_t nmemb, FILE *stream)\n</code></pre><p>å•çœ‹è¿™ä¸ªæ¥å£ï¼Œæˆ‘ä»¬å¾ˆéš¾ç›´è§‚äº†è§£ï¼Œå½“è¯»æ–‡ä»¶å‡ºé”™æ—¶ï¼Œé”™è¯¯æ˜¯å¦‚ä½•è¿”å›çš„ã€‚ä»æ–‡æ¡£ä¸­ï¼Œæˆ‘ä»¬å¾—çŸ¥ï¼Œå¦‚æœè¿”å›çš„ size_t å’Œä¼ å…¥çš„ size_t ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆè¦ä¹ˆå‘ç”Ÿäº†é”™è¯¯ï¼Œè¦ä¹ˆæ˜¯è¯»åˆ°æ–‡ä»¶å°¾ï¼ˆEOFï¼‰ï¼Œè°ƒç”¨è€…è¦è¿›ä¸€æ­¥é€šè¿‡ ferror æ‰èƒ½å¾—åˆ°æ›´è¯¦ç»†çš„é”™è¯¯ã€‚</p><p>åƒ C è¿™æ ·ï¼Œé€šè¿‡è¿”å›å€¼æºå¸¦é”™è¯¯ä¿¡æ¯ï¼Œæœ‰å¾ˆå¤šå±€é™ã€‚è¿”å›å€¼æœ‰å®ƒåŸæœ¬çš„è¯­ä¹‰ï¼Œå¼ºè¡ŒæŠŠé”™è¯¯ç±»å‹åµŒå…¥åˆ°è¿”å›å€¼åŸæœ¬çš„è¯­ä¹‰ä¸­ï¼Œéœ€è¦å…¨é¢ä¸”å®æ—¶æ›´æ–°çš„æ–‡æ¡£ï¼Œæ¥ç¡®ä¿å¼€å‘è€…èƒ½æ­£ç¡®åŒºåˆ«å¯¹å¾…ï¼Œæ­£å¸¸è¿”å›å’Œé”™è¯¯è¿”å›ã€‚</p><p>æ‰€ä»¥ Golang å¯¹å…¶åšäº†æ‰©å±•ï¼Œåœ¨å‡½æ•°è¿”å›çš„æ—¶å€™ï¼Œå¯ä»¥ä¸“é—¨æºå¸¦ä¸€ä¸ªé”™è¯¯å¯¹è±¡ã€‚æ¯”å¦‚ä¸Šæ–‡çš„ freadï¼Œåœ¨ Golang ä¸‹å¯ä»¥è¿™ä¹ˆå®šä¹‰ï¼š</p><pre><code class=\"language-go\">func Fread(file *File, b []byte) (n int, err error)\n</code></pre><p>Golangè¿™æ ·ï¼ŒåŒºåˆ†å¼€é”™è¯¯è¿”å›å’Œæ­£å¸¸è¿”å›ï¼Œç›¸å¯¹ C æ¥è¯´è¿›äº†ä¸€å¤§æ­¥ã€‚<br>\nä½†æ˜¯ä½¿ç”¨è¿”å›å€¼çš„æ–¹å¼ï¼Œå§‹ç»ˆæœ‰ä¸ªè‡´å‘½çš„é—®é¢˜ï¼š<strong>åœ¨è°ƒç”¨è€…è°ƒç”¨æ—¶ï¼Œé”™è¯¯å°±å¿…é¡»å¾—åˆ°å¤„ç†æˆ–è€…æ˜¾å¼çš„ä¼ æ’­</strong>ã€‚</p><p>å¦‚æœå‡½æ•° A è°ƒç”¨äº†å‡½æ•° Bï¼Œåœ¨ A è¿”å›é”™è¯¯çš„æ—¶å€™ï¼Œå°±è¦æŠŠ B çš„é”™è¯¯è½¬æ¢æˆ A çš„é”™è¯¯ï¼Œæ˜¾ç¤ºå‡ºæ¥ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/64/cb/64b6730d159faf374fd0762bd912f0cb.jpg?wh=2096x1125\" alt=\"\"></p><p>è¿™æ ·å†™å‡ºæ¥çš„ä»£ç ä¼šéå¸¸å†—é•¿ï¼Œå¯¹æˆ‘ä»¬å¼€å‘è€…çš„ç”¨æˆ·ä½“éªŒä¸å¤ªå¥½ã€‚å¦‚æœä¸å¤„ç†ï¼Œåˆä¼šä¸¢æ‰è¿™ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œé€ æˆéšæ‚£ã€‚</p><p>å¦å¤–ï¼Œ<strong>å¤§éƒ¨åˆ†ç”Ÿäº§ç¯å¢ƒä¸‹çš„é”™è¯¯æ˜¯åµŒå¥—çš„</strong>ã€‚ä¸€ä¸ª SQL æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ›å‡ºçš„é”™è¯¯ï¼Œå¯èƒ½æ˜¯æœåŠ¡å™¨å‡ºé”™ï¼Œè€Œæ›´æ·±å±‚æ¬¡çš„é”™è¯¯å¯èƒ½æ˜¯ï¼Œè¿æ¥æ•°æ®åº“æœåŠ¡å™¨çš„ TLS session çŠ¶æ€å¼‚å¸¸ã€‚</p><p>å…¶å®çŸ¥é“æœåŠ¡å™¨å‡ºé”™ä¹‹å¤–ï¼Œæˆ‘ä»¬æ›´éœ€è¦æ¸…æ¥šæœåŠ¡å™¨å‡ºé”™çš„å†…åœ¨åŸå› ã€‚å› ä¸ºæœåŠ¡å™¨å‡ºé”™è¿™ä¸ªè¡¨å±‚é”™è¯¯ä¼šæä¾›ç»™æœ€ç»ˆç”¨æˆ·ï¼Œè€Œå‡ºé”™çš„æ·±å±‚åŸå› è¦æä¾›ç»™æˆ‘ä»¬è‡ªå·±ï¼ŒæœåŠ¡çš„ç»´æŠ¤è€…ã€‚ä½†æ˜¯è¿™æ ·çš„åµŒå¥—é”™è¯¯åœ¨ C / Golang éƒ½æ˜¯å¾ˆéš¾å®Œç¾è¡¨è¿°çš„ã€‚</p><h3>ä½¿ç”¨å¼‚å¸¸</h3><p>å› ä¸ºè¿”å›å€¼ä¸åˆ©äºé”™è¯¯çš„ä¼ æ’­ï¼Œæœ‰è¯¸å¤šé™åˆ¶ï¼ŒJava ç­‰å¾ˆå¤šè¯­è¨€ä½¿ç”¨å¼‚å¸¸æ¥å¤„ç†é”™è¯¯ã€‚</p><p>ä½ å¯ä»¥æŠŠå¼‚å¸¸çœ‹æˆä¸€ç§<strong>å…³æ³¨ç‚¹åˆ†ç¦»</strong>ï¼ˆSeparation of Concernsï¼‰ï¼š<strong>é”™è¯¯çš„äº§ç”Ÿå’Œé”™è¯¯çš„å¤„ç†å®Œå…¨è¢«åˆ†éš”å¼€ï¼Œè°ƒç”¨è€…ä¸å¿…å…³å¿ƒé”™è¯¯ï¼Œè€Œè¢«è°ƒè€…ä¹Ÿä¸å¼ºæ±‚è°ƒç”¨è€…å…³å¿ƒé”™è¯¯</strong>ã€‚</p><p>ç¨‹åºä¸­ä»»ä½•å¯èƒ½å‡ºé”™çš„åœ°æ–¹ï¼Œéƒ½å¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼›è€Œå¼‚å¸¸å¯ä»¥é€šè¿‡æ ˆå›æº¯ï¼ˆstack unwindï¼‰è¢«ä¸€å±‚å±‚è‡ªåŠ¨ä¼ é€’ï¼Œç›´åˆ°é‡åˆ°æ•è·å¼‚å¸¸çš„åœ°æ–¹ï¼Œå¦‚æœå›æº¯åˆ° main å‡½æ•°è¿˜æ— äººæ•è·ï¼Œç¨‹åºå°±ä¼šå´©æºƒã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/c2/83/c2fe73ded8d172ba6c86e75d060a4783.jpg?wh=2438x2315\" alt=\"\"></p><p>ä½¿ç”¨å¼‚å¸¸æ¥è¿”å›é”™è¯¯å¯ä»¥æå¤§åœ°ç®€åŒ–é”™è¯¯å¤„ç†çš„æµç¨‹ï¼Œå®ƒè§£å†³äº†è¿”å›å€¼çš„ä¼ æ’­é—®é¢˜ã€‚</p><p>ç„¶è€Œï¼Œä¸Šå›¾ä¸­å¼‚å¸¸è¿”å›çš„è¿‡ç¨‹çœ‹ä¸Šå»å¾ˆç›´è§‚ï¼Œå°±åƒæ•°æ®åº“ä¸­çš„äº‹åŠ¡ï¼ˆtransactionï¼‰åœ¨å‡ºé”™æ—¶ä¼šè¢«æ•´ä½“æ’¤é”€ï¼ˆrollbackï¼‰ä¸€æ ·ã€‚ä½†å®é™…ä¸Šï¼Œè¿™ä¸ªè¿‡ç¨‹è¿œæ¯”ä½ æƒ³è±¡çš„å¤æ‚ï¼Œè€Œä¸”éœ€è¦é¢å¤–æ“å¿ƒ<a href=\"http://www.lighterra.com/papers/exceptionsharmful/\">å¼‚å¸¸å®‰å…¨ï¼ˆexception safetyï¼‰</a>ã€‚</p><p>æˆ‘ä»¬çœ‹ä¸‹é¢ç”¨æ¥åˆ‡æ¢èƒŒæ™¯å›¾ç‰‡çš„ï¼ˆä¼ªï¼‰ä»£ç ï¼š</p><pre><code class=\"language-c++\">void transition(...) {\n  lock(&amp;mutex);\n  delete background;\n  ++changed;\n  background = new Background(...);\n  unlock(&amp;mutex);\n}\n</code></pre><p>è¯•æƒ³ï¼Œå¦‚æœåœ¨åˆ›å»ºæ–°çš„èƒŒæ™¯æ—¶å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼Œä¼šè·³è¿‡åç»­çš„å¤„ç†æµç¨‹ï¼Œä¸€è·¯æ ˆå›æº¯åˆ° try catch çš„ä»£ç ï¼Œé‚£ä¹ˆï¼Œè¿™é‡Œé”ä½çš„ mutex æ— æ³•å¾—åˆ°é‡Šæ”¾ï¼Œè€Œå·²æœ‰çš„èƒŒæ™¯è¢«æ¸…ç©ºï¼Œæ–°çš„èƒŒæ™¯æ²¡æœ‰åˆ›å»ºï¼Œç¨‹åºè¿›å…¥åˆ°ä¸€ä¸ªå¥‡æ€ªçš„çŠ¶æ€ã€‚</p><p>ç¡®å®åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç”¨å¼‚å¸¸æ›´å®¹æ˜“å†™ä»£ç ï¼Œä½†<strong>å½“å¼‚å¸¸å®‰å…¨æ— æ³•ä¿è¯æ—¶ï¼Œç¨‹åºçš„æ­£ç¡®æ€§ä¼šå—åˆ°å¾ˆå¤§çš„æŒ‘æˆ˜</strong>ã€‚å› æ­¤ï¼Œä½ åœ¨ä½¿ç”¨å¼‚å¸¸å¤„ç†æ—¶ï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„å¼‚å¸¸å®‰å…¨ï¼Œå°¤å…¶æ˜¯åœ¨å¹¶å‘ç¯å¢ƒä¸‹ã€‚</p><p>è€Œæ¯”è¾ƒè®½åˆºçš„æ˜¯ï¼Œä¿è¯å¼‚å¸¸å®‰å…¨çš„ç¬¬ä¸€ä¸ªåŸåˆ™å°±æ˜¯ï¼š<a href=\"https://en.wikipedia.org/wiki/Exception_safety\">é¿å…æŠ›å‡ºå¼‚å¸¸</a>ã€‚è¿™ä¹Ÿæ˜¯ Golang åœ¨è¯­è¨€è®¾è®¡æ—¶é¿å¼€äº†å¸¸è§„çš„å¼‚å¸¸ï¼Œ<a href=\"https://golang.org/doc/faq#exceptions\">èµ°å›è¿”å›å€¼çš„è€è·¯</a>çš„åŸå› ã€‚</p><p><strong>å¼‚å¸¸å¤„ç†å¦å¤–ä¸€ä¸ªæ¯”è¾ƒä¸¥é‡çš„é—®é¢˜æ˜¯ï¼šå¼€å‘è€…ä¼šæ»¥ç”¨å¼‚å¸¸</strong>ã€‚åªè¦æœ‰é”™è¯¯ï¼Œä¸è®ºæ˜¯å¦ä¸¥é‡ã€æ˜¯å¦å¯æ¢å¤ï¼Œéƒ½ä¸€è‚¡è„‘æŠ›ä¸ªå¼‚å¸¸ã€‚åˆ°äº†éœ€è¦çš„åœ°æ–¹ï¼Œæ•è·ä¸€ä¸‹äº†ä¹‹ã€‚æ®Šä¸çŸ¥ï¼Œå¼‚å¸¸å¤„ç†çš„å¼€é”€è¦æ¯”å¤„ç†è¿”å›å€¼å¤§å¾—å¤šï¼Œæ»¥ç”¨ä¼šæœ‰å¾ˆå¤šé¢å¤–çš„å¼€é”€ã€‚</p><h3>ä½¿ç”¨ç±»å‹ç³»ç»Ÿ</h3><p>ç¬¬ä¸‰ç§é”™è¯¯å¤„ç†çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨ç±»å‹ç³»ç»Ÿã€‚å…¶å®ï¼Œåœ¨ä½¿ç”¨è¿”å›å€¼å¤„ç†é”™è¯¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†ç±»å‹ç³»ç»Ÿçš„é›å½¢ã€‚</p><p>é”™è¯¯ä¿¡æ¯æ—¢ç„¶å¯ä»¥é€šè¿‡å·²æœ‰çš„ç±»å‹æºå¸¦ï¼Œæˆ–è€…é€šè¿‡å¤šè¿”å›å€¼çš„æ–¹å¼æä¾›ï¼Œé‚£ä¹ˆ<strong>é€šè¿‡ç±»å‹æ¥è¡¨å¾é”™è¯¯ï¼Œä½¿ç”¨ä¸€ä¸ªå†…éƒ¨åŒ…å«æ­£å¸¸è¿”å›ç±»å‹å’Œé”™è¯¯è¿”å›ç±»å‹çš„å¤åˆç±»å‹</strong>ï¼Œé€šè¿‡ç±»å‹ç³»ç»Ÿæ¥å¼ºåˆ¶é”™è¯¯çš„å¤„ç†å’Œä¼ é€’ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥è¾¾åˆ°æ›´å¥½çš„æ•ˆæœå‘¢ï¼Ÿ</p><p>çš„ç¡®å¦‚æ­¤ã€‚è¿™ç§æ–¹å¼è¢«å¤§é‡ä½¿ç”¨åœ¨æœ‰å¼ºå¤§ç±»å‹ç³»ç»Ÿæ”¯æŒçš„å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå¦‚ Haskell/Scala/Swiftã€‚å…¶ä¸­æœ€å…¸å‹çš„åŒ…å«äº†é”™è¯¯ç±»å‹çš„å¤åˆç±»å‹æ˜¯ Haskell çš„ Maybe å’Œ Either ç±»å‹ã€‚</p><p>Maybe ç±»å‹å…è®¸æ•°æ®åŒ…å«ä¸€ä¸ªå€¼ï¼ˆJustï¼‰æˆ–è€…æ²¡æœ‰å€¼ï¼ˆNothingï¼‰ï¼Œè¿™å¯¹ç®€å•çš„ä¸éœ€è¦ç±»å‹çš„é”™è¯¯å¾ˆæœ‰ç”¨ã€‚è¿˜æ˜¯ä»¥æ‰“å¼€æ–‡ä»¶ä¸ºä¾‹ï¼Œå¦‚æœæˆ‘ä»¬åªå…³å¿ƒæˆåŠŸæ‰“å¼€æ–‡ä»¶çš„å¥æŸ„ï¼Œé‚£ä¹ˆ Maybe å°±è¶³å¤Ÿäº†ã€‚</p><p>å½“æˆ‘ä»¬éœ€è¦æ›´ä¸ºå¤æ‚çš„é”™è¯¯å¤„ç†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Either ç±»å‹ã€‚å®ƒå…è®¸æ•°æ®æ˜¯ Left a æˆ–è€… Right b ã€‚å…¶ä¸­ï¼Œa æ˜¯è¿è¡Œå‡ºé”™çš„æ•°æ®ç±»å‹ï¼Œb å¯ä»¥æ˜¯æˆåŠŸçš„æ•°æ®ç±»å‹ã€‚<br>\n<img src=\"https://static001.geekbang.org/resource/image/73/9d/73130a2429da91d10c433100fca3089d.jpg?wh=1934x802\" alt=\"\"></p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç§æ–¹æ³•ä¾æ—§æ˜¯é€šè¿‡è¿”å›å€¼è¿”å›é”™è¯¯ï¼Œä½†æ˜¯é”™è¯¯è¢«åŒ…è£¹åœ¨ä¸€ä¸ªå®Œæ•´çš„ã€å¿…é¡»å¤„ç†çš„ç±»å‹ä¸­ï¼Œæ¯” Golang çš„æ–¹æ³•æ›´å®‰å…¨ã€‚</p><p>æˆ‘ä»¬å‰é¢æåˆ°ï¼Œä½¿ç”¨è¿”å›å€¼è¿”å›é”™è¯¯çš„ä¸€å¤§ç¼ºç‚¹æ˜¯ï¼Œé”™è¯¯éœ€è¦è¢«è°ƒç”¨è€…ç«‹å³å¤„ç†æˆ–è€…æ˜¾å¼ä¼ é€’ã€‚ä½†æ˜¯ä½¿ç”¨ Maybe / Either è¿™æ ·çš„ç±»å‹æ¥å¤„ç†é”™è¯¯çš„å¥½å¤„æ˜¯ï¼Œ<strong>æˆ‘ä»¬å¯ä»¥ç”¨å‡½æ•°å¼ç¼–ç¨‹çš„æ–¹æ³•ç®€åŒ–é”™è¯¯çš„å¤„ç†ï¼Œæ¯”å¦‚mapã€fold ç­‰å‡½æ•°ï¼Œè®©ä»£ç ç›¸å¯¹ä¸é‚£ä¹ˆå†—ä½™</strong>ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¾ˆå¤šä¸å¯æ¢å¤çš„é”™è¯¯ï¼Œå¦‚â€œç£ç›˜å†™æ»¡ï¼Œæ— æ³•å†™å…¥â€çš„é”™è¯¯ï¼Œä½¿ç”¨å¼‚å¸¸å¤„ç†å¯ä»¥é¿å…ä¸€å±‚å±‚ä¼ é€’é”™è¯¯ï¼Œè®©ä»£ç ç®€æ´é«˜æ•ˆï¼Œæ‰€ä»¥å¤§å¤šæ•°ä½¿ç”¨ç±»å‹ç³»ç»Ÿæ¥å¤„ç†é”™è¯¯çš„è¯­è¨€ï¼Œä¼šåŒæ—¶ä½¿ç”¨å¼‚å¸¸å¤„ç†ä½œä¸ºè¡¥å……ã€‚</p><h2>Rust çš„é”™è¯¯å¤„ç†</h2><p>ç”±äºè¯ç”Ÿçš„å¹´ä»£æ¯”è¾ƒæ™šï¼ŒRust æœ‰æœºä¼šä»å·²æœ‰çš„è¯­è¨€ä¸­å­¦ä¹ åˆ°å„ç§é”™è¯¯å¤„ç†çš„ä¼˜åŠ£ã€‚å¯¹äº Rust æ¥è¯´ï¼Œç›®å‰çš„å‡ ç§æ–¹å¼ç›¸æ¯”è€Œè¨€ï¼Œæœ€ä½³çš„æ–¹æ³•æ˜¯ï¼Œä½¿ç”¨ç±»å‹ç³»ç»Ÿæ¥æ„å»ºä¸»è¦çš„é”™è¯¯å¤„ç†æµç¨‹ã€‚</p><p>Rust å·å¸ˆ Haskellï¼Œæ„å»ºäº†å¯¹æ ‡ Maybe çš„ Option ç±»å‹å’Œ å¯¹æ ‡ Either çš„ Result ç±»å‹ã€‚<br>\n<img src=\"https://static001.geekbang.org/resource/image/8c/a2/8c9cf4152609baccb6ddee422c48a8a2.jpg?wh=1934x802\" alt=\"\"></p><h3>Option å’Œ Result</h3><p>Option æ˜¯ä¸€ä¸ª enumï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code class=\"language-rust\">pub enum Option&lt;T&gt; {\n    None,\n    Some(T),\n}\n</code></pre><p>å®ƒå¯ä»¥æ‰¿è½½æœ‰å€¼/æ— å€¼è¿™ç§æœ€ç®€å•çš„é”™è¯¯ç±»å‹ã€‚<br>\nResult æ˜¯ä¸€ä¸ªæ›´åŠ å¤æ‚çš„ enumï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code class=\"language-rust\">#[must_use = \"this `Result` may be an `Err` variant, which should be handled\"]\npub enum Result&lt;T, E&gt; {\n    Ok(T),\n    Err(E),\n}\n</code></pre><p>å½“å‡½æ•°å‡ºé”™æ—¶ï¼Œå¯ä»¥è¿”å› Err(E)ï¼Œå¦åˆ™ Ok(T)ã€‚</p><p>æˆ‘ä»¬çœ‹åˆ°ï¼ŒResult ç±»å‹å£°æ˜æ—¶è¿˜æœ‰ä¸ª must_use çš„æ ‡æ³¨ï¼Œç¼–è¯‘å™¨ä¼šå¯¹æœ‰ must_use æ ‡æ³¨çš„æ‰€æœ‰ç±»å‹åšç‰¹æ®Šå¤„ç†ï¼šå¦‚æœè¯¥ç±»å‹å¯¹åº”çš„å€¼æ²¡æœ‰è¢«æ˜¾å¼ä½¿ç”¨ï¼Œåˆ™ä¼šå‘Šè­¦ã€‚è¿™æ ·ï¼Œä¿è¯é”™è¯¯è¢«å¦¥å–„å¤„ç†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/e2/53/e2100e3f17a9587c4d4bf50523c10653.png?wh=1680x320\" alt=\"\"></p><p>è¿™é‡Œï¼Œå¦‚æœæˆ‘ä»¬è°ƒç”¨ read_file å‡½æ•°æ—¶ï¼Œç›´æ¥ä¸¢å¼ƒè¿”å›å€¼ï¼Œç”±äº #[must_use] çš„æ ‡æ³¨ï¼ŒRust ç¼–è¯‘å™¨æŠ¥è­¦ï¼Œè¦æ±‚æˆ‘ä»¬ä½¿ç”¨å…¶è¿”å›å€¼ã€‚</p><p>è¿™è™½ç„¶å¯ä»¥æå¤§é¿å…é—å¿˜é”™è¯¯çš„æ˜¾ç¤ºå¤„ç†ï¼Œä½†å¦‚æœæˆ‘ä»¬å¹¶ä¸å…³å¿ƒé”™è¯¯ï¼Œåªéœ€è¦ä¼ é€’é”™è¯¯ï¼Œè¿˜æ˜¯ä¼šå†™å‡ºåƒ C æˆ–è€… Golang ä¸€æ ·æ¯”è¾ƒå†—ä½™çš„ä»£ç ã€‚æ€ä¹ˆåŠï¼Ÿ</p><h3>? æ“ä½œç¬¦</h3><p>å¥½åœ¨ Rust é™¤äº†æœ‰å¼ºå¤§çš„ç±»å‹ç³»ç»Ÿå¤–ï¼Œè¿˜å…·å¤‡å…ƒç¼–ç¨‹çš„èƒ½åŠ›ã€‚æ—©æœŸ Rust æä¾›äº† try! å®æ¥ç®€åŒ–é”™è¯¯çš„æ˜¾å¼å¤„ç†ï¼Œåæ¥ä¸ºäº†è¿›ä¸€æ­¥æå‡ç”¨æˆ·ä½“éªŒï¼Œtry! è¢«è¿›åŒ–æˆ ? æ“ä½œç¬¦ã€‚</p><p>æ‰€ä»¥åœ¨ Rust ä»£ç ä¸­ï¼Œå¦‚æœä½ åªæƒ³ä¼ æ’­é”™è¯¯ï¼Œä¸æƒ³å°±åœ°å¤„ç†ï¼Œå¯ä»¥ç”¨ ? æ“ä½œç¬¦ï¼Œæ¯”å¦‚ï¼ˆ<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=68df876a2165793142fb0897b1130b59\">ä»£ç </a>ï¼‰:</p><pre><code class=\"language-rust\">use std::fs::File;\nuse std::io::Read;\n\nfn read_file(name: &amp;str) -&gt; Result&lt;String, std::io::Error&gt; {\n&nbsp; let mut f = File::open(name)?;\n&nbsp; let mut contents = String::new();\n&nbsp; f.read_to_string(&amp;mut contents)?;\n&nbsp; Ok(contents)\n}\n</code></pre><p>é€šè¿‡ ? æ“ä½œç¬¦ï¼ŒRust è®©é”™è¯¯ä¼ æ’­çš„ä»£ä»·å’Œå¼‚å¸¸å¤„ç†ä¸ç›¸ä¸Šä¸‹ï¼ŒåŒæ—¶åˆé¿å…äº†å¼‚å¸¸å¤„ç†çš„è¯¸å¤šé—®é¢˜ã€‚</p><p>? æ“ä½œç¬¦å†…éƒ¨è¢«å±•å¼€æˆç±»ä¼¼è¿™æ ·çš„ä»£ç ï¼š</p><pre><code class=\"language-rust\">match result {\n  Ok(v) =&gt; v,\n  Err(e) =&gt; return Err(e.into())\n}\n</code></pre><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ°å†™å‡ºç±»ä¼¼è¿™æ ·çš„ä»£ç ï¼Œç®€æ´æ˜“æ‡‚ï¼Œå¯è¯»æ€§å¾ˆå¼ºï¼š</p><pre><code class=\"language-rust\">fut\n  .await?\n  .process()?\n  .next()\n  .await?;\n</code></pre><p>æ•´ä¸ªä»£ç çš„æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/19/0f/1931bac666fd3596a06ef3700b79f60f.jpg?wh=2839x1089\" alt=\"\"></p><p>è™½ç„¶ ? æ“ä½œç¬¦ä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œä½†ä½ è¦æ³¨æ„åœ¨ä¸åŒçš„é”™è¯¯ç±»å‹ä¹‹é—´æ˜¯æ— æ³•ç›´æ¥ä½¿ç”¨çš„ï¼Œéœ€è¦å®ç° From trait åœ¨äºŒè€…ä¹‹é—´å»ºç«‹èµ·è½¬æ¢çš„æ¡¥æ¢ï¼Œè¿™ä¼šå¸¦æ¥é¢å¤–çš„éº»çƒ¦ã€‚æˆ‘ä»¬æš‚ä¸”æŠŠè¿™ä¸ªé—®é¢˜æ”¾ä¸‹ï¼Œç¨åæˆ‘ä»¬ä¼šè°ˆåˆ°è§£å†³æ–¹æ¡ˆã€‚</p><h3>å‡½æ•°å¼é”™è¯¯å¤„ç†</h3><p>Rust è¿˜ä¸º Option å’Œ Result æä¾›äº†å¤§é‡çš„è¾…åŠ©å‡½æ•°ï¼Œå¦‚ map / map_err / and_thenï¼Œä½ å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¤„ç†æ•°æ®ç»“æ„ä¸­éƒ¨åˆ†æƒ…å†µã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/0c/e0/0c3ae02cc6d8994e500fc02385a605e0.jpg?wh=2140x2132\" alt=\"\"></p><p>é€šè¿‡è¿™äº›å‡½æ•°ï¼Œä½ å¯ä»¥å¾ˆæ–¹ä¾¿åœ°å¯¹é”™è¯¯å¤„ç†å¼•å…¥<a href=\"https://www.slideshare.net/ScottWlaschin/railway-oriented-programming\"> Railroad oriented programming èŒƒå¼</a>ã€‚æ¯”å¦‚ç”¨æˆ·æ³¨å†Œçš„æµç¨‹ï¼Œä½ éœ€è¦æ ¡éªŒç”¨æˆ·è¾“å…¥ï¼Œå¯¹æ•°æ®è¿›è¡Œå¤„ç†ï¼Œè½¬æ¢ï¼Œç„¶åå­˜å…¥æ•°æ®åº“ä¸­ã€‚ä½ å¯ä»¥è¿™ä¹ˆæ’°å†™è¿™ä¸ªæµç¨‹ï¼š</p><pre><code class=\"language-rust\">Ok(data)\n  .and_then(validate)\n  .and_then(process)\n  .map(transform)\n  .and_then(store)\n  .map_error(...)\n</code></pre><p>æ‰§è¡Œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/fd/4c/fdbbbee8e125205efd00f8648fc8b04c.jpg?wh=2753x844\" alt=\"\"></p><p>æ­¤å¤–ï¼ŒOption å’Œ Resultçš„äº’ç›¸è½¬æ¢ä¹Ÿå¾ˆæ–¹æ¢ï¼Œè¿™ä¹Ÿå¾—ç›Šäº Rust æ„å»ºçš„å¼ºå¤§çš„å‡½æ•°å¼ç¼–ç¨‹çš„èƒ½åŠ›ã€‚</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ— è®ºæ˜¯é€šè¿‡ ? æ“ä½œç¬¦ï¼Œè¿˜æ˜¯å‡½æ•°å¼ç¼–ç¨‹è¿›è¡Œé”™è¯¯å¤„ç†ï¼ŒRust éƒ½åŠ›æ±‚è®©é”™è¯¯å¤„ç†çµæ´»é«˜æ•ˆï¼Œè®©å¼€å‘è€…ä½¿ç”¨èµ·æ¥ç®€å•ç›´è§‚ã€‚</p><h3>panic! å’Œ catch_unwind</h3><p>ä½¿ç”¨ Option å’Œ Result æ˜¯ Rust ä¸­å¤„ç†é”™è¯¯çš„é¦–é€‰ï¼Œç»å¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬ä¹Ÿåº”è¯¥ä½¿ç”¨ï¼Œä½† Rust ä¹Ÿæä¾›äº†ç‰¹æ®Šçš„å¼‚å¸¸å¤„ç†èƒ½åŠ›ã€‚</p><p>åœ¨ Rust çœ‹æ¥ï¼Œä¸€æ—¦ä½ éœ€è¦æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£æŠ›å‡ºçš„ä¸€å®šæ˜¯ä¸¥é‡çš„é”™è¯¯ã€‚æ‰€ä»¥ï¼ŒRust è·Ÿ Golang ä¸€æ ·ï¼Œä½¿ç”¨äº†è¯¸å¦‚ panic! è¿™æ ·çš„å­—çœ¼è­¦ç¤ºå¼€å‘è€…ï¼šæƒ³æ¸…æ¥šäº†å†ä½¿ç”¨æˆ‘ã€‚åœ¨ä½¿ç”¨ Option å’Œ Result  ç±»å‹æ—¶ï¼Œå¼€å‘è€…ä¹Ÿå¯ä»¥å¯¹å…¶ unwarp() æˆ–è€… expect()ï¼Œå¼ºåˆ¶æŠŠ Option&lt;T&gt; å’Œ Result&lt;T, E&gt; è½¬æ¢æˆ Tï¼Œå¦‚æœæ— æ³•å®Œæˆè¿™ç§è½¬æ¢ï¼Œä¹Ÿä¼š panic! å‡ºæ¥ã€‚</p><p>ä¸€èˆ¬è€Œè¨€ï¼Œpanic! æ˜¯ä¸å¯æ¢å¤æˆ–è€…ä¸æƒ³æ¢å¤çš„é”™è¯¯ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨æ­¤åˆ»ï¼Œç¨‹åºç»ˆæ­¢è¿è¡Œå¹¶å¾—åˆ°å´©æºƒä¿¡æ¯ã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼Œå®ƒè§£æ <a href=\"https://noiseprotocol.org/noise.html#protocol-names-and-modifiers\">noise protoco</a>çš„åè®®å˜é‡ï¼š</p><pre><code class=\"language-rust\">let params: NoiseParams = \"Noise_XX_25519_AESGCM_SHA256\".parse().unwrap();\n</code></pre><p>å¦‚æœå¼€å‘è€…ä¸å°å¿ƒæŠŠåè®®å˜é‡å†™é”™äº†ï¼Œæœ€ä½³çš„æ–¹å¼æ˜¯ç«‹åˆ» panic! å‡ºæ¥ï¼Œè®©é”™è¯¯ç«‹åˆ»æš´éœ²ï¼Œä»¥ä¾¿è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>æœ‰äº›åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿå¸Œæœ›èƒ½å¤Ÿåƒå¼‚å¸¸å¤„ç†é‚£æ ·èƒ½å¤Ÿæ ˆå›æº¯ï¼ŒæŠŠç¯å¢ƒæ¢å¤åˆ°æ•è·å¼‚å¸¸çš„ä¸Šä¸‹æ–‡ã€‚Rust æ ‡å‡†åº“ä¸‹æä¾›äº† catch_unwind() ï¼ŒæŠŠè°ƒç”¨æ ˆå›æº¯åˆ° catch_unwind è¿™ä¸€åˆ»ï¼Œä½œç”¨å’Œå…¶å®ƒè¯­è¨€çš„ try {â€¦} catch {â€¦} ä¸€æ ·ã€‚è§å¦‚ä¸‹<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=c2fbc68b5b4b1bcd2559ea20a025074e\">ä»£ç </a>ï¼š</p><pre><code class=\"language-rust\">use std::panic;\n\nfn main() {\n&nbsp; &nbsp; let result = panic::catch_unwind(|| {\n&nbsp; &nbsp; &nbsp; &nbsp; println!(\"hello!\");\n&nbsp; &nbsp; });\n&nbsp; &nbsp; assert!(result.is_ok());\n&nbsp; &nbsp; let result = panic::catch_unwind(|| {\n&nbsp; &nbsp; &nbsp; &nbsp; panic!(\"oh no!\");\n&nbsp; &nbsp; });\n&nbsp; &nbsp; assert!(result.is_err());\n&nbsp; &nbsp; println!(\"panic captured: {:#?}\", result);\n}\n</code></pre><p>å½“ç„¶ï¼Œå’Œå¼‚å¸¸å¤„ç†ä¸€æ ·ï¼Œå¹¶ä¸æ„å‘³ç€ä½ å¯ä»¥æ»¥ç”¨è¿™ä¸€ç‰¹æ€§ï¼Œæˆ‘æƒ³ï¼Œè¿™ä¹Ÿæ˜¯ Rust æŠŠæŠ›å‡ºå¼‚å¸¸ç§°ä½œ panic! ï¼Œè€Œæ•è·å¼‚å¸¸ç§°ä½œ catch_unwindçš„åŸå› ï¼Œè®©åˆå­¦è€…æœ›è€Œç”Ÿç•ï¼Œä¸æ•¢è½»æ˜“ä½¿ç”¨ã€‚è¿™ä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„ç”¨æˆ·ä½“éªŒã€‚</p><p>catch_unwind åœ¨æŸäº›åœºæ™¯ä¸‹éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚ä½ åœ¨ä½¿ç”¨ Rust ä¸º erlang VM æ’°å†™ <a href=\"https://erlang.org/doc/tutorial/nif.html\">NIF</a>ï¼Œä½ ä¸å¸Œæœ› Rust ä»£ç ä¸­çš„ä»»ä½• panic! å¯¼è‡´ erlang VM å´©æºƒã€‚å› ä¸ºå´©æºƒæ˜¯ä¸€ä¸ªéå¸¸ä¸å¥½çš„ä½“éªŒï¼Œå®ƒè¿èƒŒäº† erlang çš„è®¾è®¡åŸåˆ™ï¼šprocess å¯ä»¥ let it crashï¼Œä½†é”™è¯¯ä»£ç ä¸è¯¥å¯¼è‡´ VM å´©æºƒã€‚</p><p>æ­¤åˆ»ï¼Œä½ å°±å¯ä»¥æŠŠ Rust ä»£ç æ•´ä¸ªå°è£…åœ¨ catch_unwind() å‡½æ•°æ‰€éœ€è¦ä¼ å…¥çš„é—­åŒ…ä¸­ã€‚è¿™æ ·ï¼Œä¸€æ—¦ä»»ä½•ä»£ç ä¸­ï¼ŒåŒ…æ‹¬ç¬¬ä¸‰æ–¹ crates çš„ä»£ç ï¼Œå«æœ‰èƒ½å¤Ÿå¯¼è‡´ panic! çš„ä»£ç ï¼Œéƒ½ä¼šè¢«æ•è·ï¼Œå¹¶è¢«è½¬æ¢ä¸ºä¸€ä¸ª Resultã€‚</p><h3>Error trait å’Œé”™è¯¯ç±»å‹çš„è½¬æ¢</h3><p>ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬è®²åˆ° Result&lt;T, E&gt; é‡Œ E æ˜¯ä¸€ä¸ªä»£è¡¨é”™è¯¯çš„æ•°æ®ç±»å‹ã€‚ä¸ºäº†è§„èŒƒè¿™ä¸ªä»£è¡¨é”™è¯¯çš„æ•°æ®ç±»å‹çš„è¡Œä¸ºï¼ŒRust å®šä¹‰äº† Error traitï¼š</p><pre><code class=\"language-rust\">pub trait Error: Debug + Display {\n    fn source(&amp;self) -&gt; Option&lt;&amp;(dyn Error + 'static)&gt; { ... }\n    fn backtrace(&amp;self) -&gt; Option&lt;&amp;Backtrace&gt; { ... }\n    fn description(&amp;self) -&gt; &amp;str { ... }\n    fn cause(&amp;self) -&gt; Option&lt;&amp;dyn Error&gt; { ... }\n}\n</code></pre><p>æˆ‘ä»¬å¯ä»¥å®šä¹‰æˆ‘ä»¬è‡ªå·±çš„æ•°æ®ç±»å‹ï¼Œç„¶åä¸ºå…¶å®ç° Error traitã€‚</p><p>ä¸è¿‡ï¼Œè¿™æ ·çš„å·¥ä½œå·²ç»æœ‰äººæ›¿æˆ‘ä»¬ç®€åŒ–äº†ï¼šæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a href=\"https://github.com/dtolnay/thiserror\">thiserror</a>å’Œ<a href=\"https://github.com/dtolnay/anyhow\"> anyhow</a>æ¥ç®€åŒ–è¿™ä¸ªæ­¥éª¤ã€‚thiserror  æä¾›äº†ä¸€ä¸ªæ´¾ç”Ÿå®ï¼ˆderive macroï¼‰æ¥ç®€åŒ–é”™è¯¯ç±»å‹çš„å®šä¹‰ï¼Œæ¯”å¦‚ï¼š</p><pre><code class=\"language-rust\">use thiserror::Error;\n#[derive(Error, Debug)]\n#[non_exhaustive]\npub enum DataStoreError {\n    #[error(\"data store disconnected\")]\n    Disconnect(#[from] io::Error),\n    #[error(\"the data for key `{0}` is not available\")]\n    Redaction(String),\n    #[error(\"invalid header (expected {expected:?}, found {found:?})\")]\n    InvalidHeader {\n        expected: String,\n        found: String,\n    },\n    #[error(\"unknown data store error\")]\n    Unknown,\n}\n</code></pre><p>å¦‚æœä½ åœ¨æ’°å†™ä¸€ä¸ª Rust åº“ï¼Œé‚£ä¹ˆ thiserror å¯ä»¥å¾ˆå¥½åœ°ååŠ©ä½ å¯¹è¿™ä¸ªåº“é‡Œæ‰€æœ‰å¯èƒ½å‘ç”Ÿçš„é”™è¯¯è¿›è¡Œå»ºæ¨¡ã€‚</p><p>è€Œ anyhow å®ç°äº† anyhow::Error å’Œä»»æ„ç¬¦åˆ Error trait  çš„é”™è¯¯ç±»å‹ä¹‹é—´çš„è½¬æ¢ï¼Œè®©ä½ å¯ä»¥ä½¿ç”¨ ? æ“ä½œç¬¦ï¼Œä¸å¿…å†æ‰‹å·¥è½¬æ¢é”™è¯¯ç±»å‹ã€‚anyhow è¿˜å¯ä»¥è®©ä½ å¾ˆå®¹æ˜“åœ°æŠ›å‡ºä¸€äº›ä¸´æ—¶çš„é”™è¯¯ï¼Œè€Œä¸å¿…è´¹åŠ›å®šä¹‰é”™è¯¯ç±»å‹ï¼Œå½“ç„¶ï¼Œæˆ‘ä»¬ä¸æå€¡æ»¥ç”¨è¿™ä¸ªèƒ½åŠ›ã€‚</p><p>ä½œä¸ºä¸€åä¸¥è‚ƒçš„å¼€å‘è€…ï¼Œæˆ‘éå¸¸å»ºè®®ä½ åœ¨å¼€å‘å‰ï¼Œå…ˆç”¨ç±»ä¼¼ thiserror çš„åº“å®šä¹‰å¥½ä½ é¡¹ç›®ä¸­ä¸»è¦çš„é”™è¯¯ç±»å‹ï¼Œå¹¶éšç€é¡¹ç›®çš„æ·±å…¥ï¼Œä¸æ–­å¢åŠ æ–°çš„é”™è¯¯ç±»å‹ï¼Œè®©ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ½œåœ¨é”™è¯¯éƒ½æ— æ‰€éå½¢ã€‚</p><h2>å°ç»“</h2><p>è¿™ä¸€è®²æˆ‘ä»¬è®¨è®ºäº†é”™è¯¯å¤„ç†çš„ä¸‰ç§æ–¹å¼ï¼šä½¿ç”¨è¿”å›å€¼ã€å¼‚å¸¸å¤„ç†å’Œç±»å‹ç³»ç»Ÿã€‚è€ŒRust ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼Œé‡‡å„å®¶ä¹‹é•¿ï¼Œå½¢æˆäº†æˆ‘ä»¬ç›®å‰çœ‹åˆ°çš„æ–¹æ¡ˆï¼š<strong>ä¸»è¦ç”¨ç±»å‹ç³»ç»Ÿæ¥å¤„ç†é”™è¯¯ï¼Œè¾…ä»¥å¼‚å¸¸æ¥åº”å¯¹ä¸å¯æ¢å¤çš„é”™è¯¯</strong>ã€‚</p><ul>\n<li>ç›¸æ¯” C/Golang ç›´æ¥ç”¨è¿”å›å€¼çš„é”™è¯¯å¤„ç†æ–¹å¼ï¼ŒRust åœ¨ç±»å‹ä¸Šæ›´å®Œå¤‡ï¼Œæ„å»ºäº†é€»è¾‘æ›´ä¸ºä¸¥è°¨çš„ Option ç±»å‹å’Œ Result ç±»å‹ï¼Œæ—¢é¿å…äº†é”™è¯¯è¢«ä¸æ…å¿½ç•¥ï¼Œä¹Ÿé¿å…äº†ç”¨å•°å—¦çš„è¡¨è¾¾æ–¹å¼ä¼ é€’é”™è¯¯ï¼›</li>\n<li>ç›¸å¯¹äº C++ / Java ä½¿ç”¨å¼‚å¸¸çš„æ–¹å¼ï¼ŒRust åŒºåˆ†äº†å¯æ¢å¤é”™è¯¯å’Œä¸å¯æ¢å¤é”™è¯¯ï¼Œåˆ†åˆ«ä½¿ç”¨ Option / Resultï¼Œä»¥åŠ panic! / catch_unwind æ¥åº”å¯¹ï¼Œæ›´å®‰å…¨é«˜æ•ˆï¼Œé¿å…äº†å¼‚å¸¸å®‰å…¨å¸¦æ¥çš„è¯¸å¤šé—®é¢˜ï¼›</li>\n<li>è€Œå¯¹æ¯”å®ƒçš„è€å¸ˆ Haskellï¼ŒRust çš„é”™è¯¯å¤„ç†æ›´åŠ å®ç”¨ç®€æ´ï¼Œè¿™å¾—ç›Šäºå®ƒå¼ºå¤§çš„å…ƒç¼–ç¨‹åŠŸèƒ½ï¼Œä½¿ç”¨ ï¼Ÿæ“ä½œç¬¦æ¥ç®€åŒ–é”™è¯¯çš„ä¼ é€’ã€‚</li>\n</ul><p>æ€»ç»“ä¸€ä¸‹ï¼šRust çš„é”™è¯¯å¤„ç†å¾ˆå®ç”¨ã€è¶³å¤Ÿå¼ºå¤§ã€å¤„ç†èµ·æ¥åˆä¸ä¼šè¿‡äºå†—é•¿ï¼Œå……åˆ†ä½¿ç”¨ Rust è¯­è¨€æœ¬èº«çš„èƒ½åŠ›ï¼Œå¤§å¤§ç®€åŒ–äº†é”™è¯¯ä¼ é€’çš„ä»£ç ï¼Œç®€æ´æ˜äº†ï¼Œå‡ ä¹æ¥è¿‘äºå¼‚å¸¸å¤„ç†çš„æ–¹å¼ã€‚</p><p>å½“ç„¶ï¼ŒRust é”™è¯¯å¤„ç†è¿˜æœ‰å¾ˆå¤šæå‡ç©ºé—´ï¼Œå°¤å…¶æ ‡å‡†åº“æ²¡æœ‰ç»™å‡ºè¶³å¤Ÿçš„å·¥å…·ï¼Œå¯¼è‡´ç¤¾åŒºé‡Œæœ‰å¤§é‡çš„äº’ä¸å…¼å®¹çš„è¾…åŠ©åº“ã€‚ä¸è¿‡è¿™äº›éƒ½ç‘•ä¸æ©ç‘œï¼Œå¯¹ Rust è¯­è¨€æ¥è¯´ï¼Œé”™è¯¯å¤„ç†è¿˜å¤„äºä¸€ä¸ªä¸æ–­è¿›åŒ–çš„é˜¶æ®µï¼Œç›¸ä¿¡æœªæ¥æ ‡å‡†åº“ä¼šç»™å‡ºæ›´å¥½æ›´æ–¹ä¾¿çš„ç­”æ¡ˆã€‚</p><h3>æ€è€ƒé¢˜</h3><p>å¦‚æœä½ è¦å¼€å‘ä¸€ä¸ªç±»ä¼¼Redis çš„ç¼“å­˜æœåŠ¡å™¨ï¼Œä½ éƒ½ä¼šå®šä¹‰å“ªäº›é”™è¯¯ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„æ€è€ƒã€‚ä½ å·²ç»æ‰“å¡Rustå­¦ä¹ ç¬¬18æ¬¡å•¦ï¼Œå¦‚æœä½ è§‰å¾—æœ‰æ”¶è·ï¼Œä¹Ÿæ¬¢è¿ä½ åˆ†äº«ç»™èº«è¾¹çš„æœ‹å‹ï¼Œé‚€ä»–ä¸€èµ·è®¨è®ºã€‚</p><h3>æ‹“å±•é˜…è¯»</h3><p>1.<a href=\"http://www.lighterra.com/papers/exceptionsharmful/\">Exception handling considered harmful</a><br>\n2.<a href=\"https://en.wikipedia.org/wiki/Exception_safety\">Exception safety</a><br>\n3.<a href=\"https://golang.org/doc/faq#exceptions\">Why does go not have exceptions</a><br>\n4.å¯¹&nbsp;Railroad oriented programming èŒƒå¼æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥çœ‹çœ‹è¿™ä¸ª <a href=\"https://www.slideshare.net/ScottWlaschin/railway-oriented-programming\">slides</a><br>\n5.<a href=\"https://noiseprotocol.org/noise.html#protocol-names-and-modifiers\">Noise protocol</a><br>\n6.<a href=\"https://erlang.org/doc/tutorial/nif.html\">Erlang NIF</a><br>\n7.<a href=\"https://github.com/dtolnay/thiserror\">thiserror</a><br>\n8.<a href=\"https://github.com/dtolnay/anyhow\">anyhow</a></p>","neighbors":{"left":{"article_title":"17ï½œæ•°æ®ç»“æ„ï¼šè½¯ä»¶ç³»ç»Ÿæ ¸å¿ƒéƒ¨ä»¶å“ˆå¸Œè¡¨ï¼Œå†…å­˜å¦‚ä½•å¸ƒå±€ï¼Ÿ","id":423923},"right":{"article_title":"19ï½œé—­åŒ…ï¼šFnOnceã€FnMutå’ŒFnï¼Œä¸ºä»€ä¹ˆæœ‰è¿™ä¹ˆå¤šç±»å‹ï¼Ÿ","id":424009}},"comments":[{"had_liked":false,"id":333588,"user_name":"nuan","can_delete":false,"product_type":"c1","uid":2905523,"ip_address":"","ucode":"55FF98EB85404D","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIDqHQQByGiaXcAk94MdDn3ftupZLXyR6bAKibxOzMxy5h3uBwZ7QiaCiaIfbCMK0cIQfGNax8iawoiaQAg/132","comment_is_top":false,"comment_ctime":1644413487,"is_pvip":true,"discussion_count":0,"race_medal":5,"score":"31709184559","product_id":100085301,"comment_content":"æ™•äº†å‡ ç« åï¼Œç¨ç¨è½»æ¾ä¸€ä¸‹ã€‚","like_count":8},{"had_liked":false,"id":325937,"user_name":"Marvichov","can_delete":false,"product_type":"c1","uid":1111835,"ip_address":"","ucode":"7482099415C41C","user_header":"https://static001.geekbang.org/account/avatar/00/10/f7/1b/db7a0edc.jpg","comment_is_top":false,"comment_ctime":1639255059,"is_pvip":false,"replies":[{"id":"118810","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1079375","ctime":1639804512,"ip_address":"","comment_id":325937,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23114091539","product_id":100085301,"comment_content":"https:&#47;&#47;github.com&#47;dtolnay&#47;thiserror<br><br>&gt; Use **thiserror** if you care about designing your own dedicated error type(s) so that the caller receives exactly the information that you choose in the event of failure. This most often applies to library-like code. Use **Anyhow** if you **don&#39;t care** what error type your functions return, you just want it to be easy. This is common in application-like code.","like_count":6,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539683,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639804512,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314708,"user_name":"è®°äº‹æœ¬","can_delete":false,"product_type":"c1","uid":1401568,"ip_address":"","ucode":"FA942636EE0CC8","user_header":"https://static001.geekbang.org/account/avatar/00/15/62/e0/d2ff52da.jpg","comment_is_top":false,"comment_ctime":1633339126,"is_pvip":false,"replies":[{"id":"114176","content":"åŠ æ²¹ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1633813651,"ip_address":"","comment_id":314708,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14518241014","product_id":100085301,"comment_content":"è¿™ç« æ¯”è¾ƒç®€å•ï¼Œæ‰“å¡ï¼","like_count":3,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527769,"discussion_content":"åŠ æ²¹ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633813651,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":320965,"user_name":"ddh","can_delete":false,"product_type":"c1","uid":2806043,"ip_address":"","ucode":"8E852375365F16","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLBFkSq1oiaEMRjtyyv4ZpCI0OuaSsqs04ODm0OkZF6QhsAh3SvqhxibS2n7PLAVZE3QRSn5Hic0DyXg/132","comment_is_top":false,"comment_ctime":1636599516,"is_pvip":false,"replies":[{"id":"116572","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1636641437,"ip_address":"","comment_id":320965,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5931566812","product_id":100085301,"comment_content":"ä¹‹å‰çœ‹è¿‡rusté”™è¯¯å¤„ç†çš„çŸ¥è¯†ï¼Œä¸æ˜¯å¾ˆæ¸…ç¨€ï¼Œä»Šå¤©å®Œå…¨æ˜æœ—äº†ï¼Œ å“ˆå“ˆ","like_count":1,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530172,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636641437,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314706,"user_name":"qinsi","can_delete":false,"product_type":"c1","uid":1667175,"ip_address":"","ucode":"090D9C4068FF12","user_header":"https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg","comment_is_top":false,"comment_ctime":1633338765,"is_pvip":true,"replies":[{"id":"114179","content":"ä¼šçš„ã€‚æœªæ¥ä¸æ’é™¤ç±»ä¼¼ thiserror çš„åº“è¢«å¸æ”¶è¿›å»ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1633814373,"ip_address":"","comment_id":314706,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5928306061","product_id":100085301,"comment_content":"golang ä¸­å¯ç”¨ errors.Errorf æˆ– (go1.13+)fmt.Errorf å®ç°é”™è¯¯åµŒå¥—ã€‚<br><br>å¤§è‡´çœ‹äº†ä¸‹rustä¸­è¦å®ç°ç›¸åŒçš„åŠŸèƒ½çš„è¯ï¼Œä¹Ÿæ˜¯è¦å…ˆå®šä¹‰è‡ªå®šä¹‰çš„é”™è¯¯ç±»å‹ï¼Œç„¶åå®ç°Error traitã€‚è¿™ä¸€æ­¥å¯ä»¥æ‰‹åŠ¨å®ç°ï¼Œæˆ–æ˜¯ä½¿ç”¨thiserroræ¥deriveã€‚wrapé”™è¯¯æ—¶åˆ™å¯ä»¥ç”¨Box&lt;Error&gt;æˆ–anyhowï¼Œä¸è¿‡å°±å¤±å»äº†è‡ªå®šä¹‰é”™è¯¯ç±»å‹çš„å¥½å¤„ã€‚è¿˜æ˜¯é€šè¿‡thiserroræ¥ç”ŸæˆFrom traitçš„å®ç°ä¸ºå¥½ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡`?`ä¸€è·¯&quot;å¼€ç«è½¦&quot;ä¸‹å»äº†ã€‚<br><br>æœ‰æ„æ€çš„æ˜¯ä¸Šè¿°golangä¸­çš„errors pkgåŸæœ¬å°±æ˜¯ä¸ºäº†è§£å†³æ ‡å‡†åº“ä¸­Erroræ— æ³•åµŒå¥—ç­‰é—®é¢˜è€Œäº§ç”Ÿçš„ç¬¬ä¸‰æ–¹åº“ï¼Œåœ¨ç¤¾åŒºæµè¡Œå¼€ä¹‹åå°±è¢«æ ‡å‡†åº“å¸æ”¶äº†å…¶ä¸­çš„æ€æƒ³ã€‚rustç”Ÿæ€ä¸­çš„é”™è¯¯å¤„ç†åº”è¯¥ä¹Ÿä¼šç»å†ç›¸ä¼¼çš„å‘å±•é˜¶æ®µå§ã€‚<br>","like_count":1,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527768,"discussion_content":"ä¼šçš„ã€‚æœªæ¥ä¸æ’é™¤ç±»ä¼¼ thiserror çš„åº“è¢«å¸æ”¶è¿›å»ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633814373,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314648,"user_name":"ç½—æ°","can_delete":false,"product_type":"c1","uid":1320487,"ip_address":"","ucode":"96BAFAA147341F","user_header":"https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg","comment_is_top":false,"comment_ctime":1633277729,"is_pvip":false,"replies":[{"id":"113989","content":"å“ˆå“ˆæ£’ğŸ‘","user_name":"ç¼–è¾‘å›å¤","user_name_real":"å¶å¦‚èŠŠ","uid":"2547771","ctime":1633323866,"ip_address":"","comment_id":314648,"utype":2}],"discussion_count":1,"race_medal":2,"score":"5928245025","product_id":100085301,"comment_content":"ç¬¬ä¸€æ—¶é—´æ‰“å¡","like_count":1,"discussions":[{"author":{"id":2547771,"avatar":"https://static001.geekbang.org/account/avatar/00/26/e0/3b/8ec916b2.jpg","nickname":"å¤šå°‘","note":"","ucode":"0A6EF7AA6E4BB7","race_medal":0,"user_type":4,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527750,"discussion_content":"å“ˆå“ˆæ£’ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633323866,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356574,"user_name":"Geek_a6c6ce","can_delete":false,"product_type":"c1","uid":3074996,"ip_address":"ç¾å›½","ucode":"21DC76D3225403","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/TusRVU51UggZGpicXMgH64Cb8jek0wyTOpagtUHNAj0EPbhbEv0FJpFU2K3glbtOdJXiaQ9o6QoEfv5PiaIu7rwng/132","comment_is_top":false,"comment_ctime":1662432206,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1662432206","product_id":100085301,"comment_content":"å’”å“’","like_count":0},{"had_liked":false,"id":347871,"user_name":"Kurobane","can_delete":false,"product_type":"c1","uid":2456500,"ip_address":"","ucode":"D25DF1E26A76F6","user_header":"https://static001.geekbang.org/account/avatar/00/25/7b/b4/9efded98.jpg","comment_is_top":false,"comment_ctime":1654523543,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1654523543","product_id":100085301,"comment_content":"&gt; å¼€å‘è€…ä¹Ÿå¯ä»¥å¯¹å…¶ unwarp() æˆ–è€…<br>unwarp() =&gt; unwrap()","like_count":0},{"had_liked":false,"id":331652,"user_name":"è€å®äººHoney","can_delete":false,"product_type":"c1","uid":1080653,"ip_address":"","ucode":"EA4AB5C0C33090","user_header":"https://static001.geekbang.org/account/avatar/00/10/7d/4d/d98865b2.jpg","comment_is_top":false,"comment_ctime":1642686142,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1642686142","product_id":100085301,"comment_content":"è¿æ¥é”™è¯¯è¶…æ—¶<br>å‘½ä»¤é”™è¯¯<br>ç©ºé—´æ»¡<br>","like_count":0},{"had_liked":false,"id":314728,"user_name":"é˜¿æµ·","can_delete":false,"product_type":"c1","uid":1281585,"ip_address":"","ucode":"2589431F840C42","user_header":"https://static001.geekbang.org/account/avatar/00/13/8e/31/28972804.jpg","comment_is_top":false,"comment_ctime":1633359712,"is_pvip":true,"replies":[{"id":"114177","content":"æˆ‘æœ‰ä¸ªå…¬ä¼—å·ï¼šprogrammer_life","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1633813671,"ip_address":"","comment_id":314728,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1633359712","product_id":100085301,"comment_content":"ä»è¿™ç« å°±å¯ä»¥çœ‹å‡ºè€å¸ˆå¹³æ—¶ç†è§£äº†å¾ˆå¤šæŠ€æœ¯é¢†åŸŸçš„ä¸œè¥¿ï¼Œå¾ˆæƒ³çŸ¥é“è€å¸ˆæœ‰åšå®¢ä¹‹ç±»çš„çš„å—","like_count":0,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527774,"discussion_content":"æˆ‘æœ‰ä¸ªå…¬ä¼—å·ï¼šprogrammer_life","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633813671,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}