{"id":380891,"title":"05ï½œè¿›ä¸€æ­¥è®¤è¯† Hooks ï¼šå¦‚ä½•æ­£ç¡®ç†è§£å‡½æ•°ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹æ²›ã€‚ä»Šå¤©æˆ‘ä»¬æ¥èŠèŠReactç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><p>è¿™ä¸€è®²æˆ‘ä¼šå¸¦ä½ ä» Hooks çš„è§’åº¦è¿›ä¸€æ­¥ç†è§£ React å‡½æ•°ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚ä½ å¯èƒ½ä¼šæœ‰ç–‘é—®ï¼Œå‰é¢å‡ èŠ‚è¯¾æˆ‘ä»¬å·²ç»å­¦ä¹ äº† Hooks çš„æ¦‚å¿µå’Œå†…ç½® Hooks çš„ç”¨æ³•ï¼Œé‚£ä¸ºä»€ä¹ˆè¿˜ä¼šæœ‰ä¸“é—¨ä¸€è®²æ¥è¿›ä¸€æ­¥ä»‹ç» Hooks å‘¢ï¼Ÿ</p><p>åŸå› ä¸»è¦æœ‰ä¸¤ä¸ªã€‚ä¸€æ–¹é¢ï¼Œå¦‚æœä½ å·²ç»ç†Ÿæ‚‰äº† Class ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸï¼Œé‚£ä¹ˆè¿˜éœ€è¦ä¸€ä¸ªè½¬æ¢ç¼–ç¨‹æ€æƒ³åˆ° Hooks çš„è¿‡ç¨‹ï¼Œè¿™æ ·æ‰èƒ½é¿å…è¡¨é¢ä¸Šç”¨äº† Hooksï¼Œå´ä»ç„¶ç”¨ Class ç»„ä»¶çš„æ–¹å¼æ€è€ƒé—®é¢˜ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœä½ æ˜¯æ–°æ¥è§¦ Reactï¼Œé‚£ä¹ˆè¿™ä¸€è®²ä¹Ÿèƒ½å¸®ä½ äº†è§£åŸæ¥ Class ç»„ä»¶çš„å·¥ä½œæ–¹å¼ï¼Œä»è€Œå¦‚æœçœ‹åˆ°æˆ–æ¥æ‰‹å·²æœ‰çš„ React é¡¹ç›®ï¼Œä¹Ÿèƒ½ä»å®¹åº”å¯¹ã€‚</p><h1>å¿˜æ‰ Classç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</h1><p>åŸºäº Class çš„ç»„ä»¶ä½œä¸º React è¯ç”Ÿä¹‹å¤„å°±å­˜åœ¨çš„æœºåˆ¶ï¼Œå®ƒçš„ç”¨æ³•æ—©å·²æ·±å…¥äººå¿ƒï¼Œç”šè‡³è‡³ä»Šä¸ºæ­¢ React çš„å®˜æ–¹æ–‡æ¡£ä¸­ä»ç„¶æ˜¯ä»¥ Class ç»„ä»¶ä¸ºåŸºç¡€çš„ï¼Œè€Œå‡½æ•°ç»„ä»¶å’Œ Hooks åˆ™æ˜¯ä½œä¸ºæ–°ç‰¹æ€§åšäº†è¡¥å……è¯´æ˜å’Œè§£é‡Šã€‚</p><p>è¿™å…¶å®æœ‰ä¸¤ä¸ªåŸå› ï¼š</p><ul>\n<li>ä¸€æ˜¯ React å›¢é˜Ÿå°½æœ€å¤§åŠªåŠ›ä¿æŒ API çš„ç¨³å®šï¼Œä¸å¸Œæœ›ç»™ä½ é€ æˆä¸€ç§ Class ç»„ä»¶å°†è¢«åºŸå¼ƒçš„æ„Ÿè§‰ï¼›</li>\n<li>äºŒæ˜¯å¤§é‡çš„å­˜é‡åº”ç”¨å…¶å®è¿˜éƒ½æ˜¯ç”¨ Class ç»„ä»¶å®ç°çš„ï¼Œæ— è®ºæ˜¯å¯¹äºç»´æŠ¤è€…è¿˜æ˜¯åŠ å…¥è€…æ¥è¯´ï¼Œäº†è§£ Class ç»„ä»¶éƒ½æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚</li>\n</ul><!-- [[[read_end]]] --><p>æ‰€ä»¥å°½ç®¡å‡½æ•°ç»„ä»¶å’Œ Hooks æ˜¯æœªæ¥å‘å±•çš„è¶‹åŠ¿ï¼Œä½†ä½ è¿˜æ˜¯åº”è¯¥å¯¹ Class ç»„ä»¶çš„ç”¨æ³•æœ‰ä¸€ä¸ªäº†è§£ï¼Œè¾¾åˆ°è‡³å°‘æ˜¯èƒ½çœ‹æ‡‚çš„ç¨‹åº¦ã€‚</p><p>Class ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶æ˜¯ä¸¤ç§å®ç° React åº”ç”¨çš„æ–¹å¼ï¼Œè™½ç„¶å®ƒä»¬æ˜¯ç­‰ä»·çš„ï¼Œä½†æ˜¯å¼€å‘çš„æ€æƒ³æœ‰å¾ˆå¤§ä¸åŒã€‚å¦‚æœä½ æ˜¯ä» Class ç»„ä»¶è½¬æ¢åˆ° Hooks çš„æ–¹å¼ï¼Œé‚£ä¹ˆå¾ˆé‡è¦çš„ä¸€ç‚¹å°±æ˜¯ï¼Œä½ è¦å­¦ä¼šå¿˜æ‰ Class ç»„ä»¶ä¸­çš„ç”Ÿå‘½å‘¨æœŸæ¦‚å¿µï¼Œåƒä¸‡ä¸è¦å°†åŸæ¥ä¹ æƒ¯çš„ Class ç»„ä»¶å¼€å‘æ–¹å¼æ˜ å°„åˆ°å‡½æ•°ç»„ã€‚</p><p>æ¯”å¦‚å¦‚ä½•åœ¨å‡½æ•°ç»„ä»¶ä¸­å®ç° componentDidMount, componentDidUpdate è¿™æ ·çš„ Class ç»„ä»¶æ‰æœ‰çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œä½ åº”è¯¥é€šè¿‡ç†è§£ Hooks çš„æ–¹å¼å»æ€è€ƒä¸šåŠ¡éœ€æ±‚åº”è¯¥å¦‚ä½•å®ç°ã€‚</p><p>ä¸ºäº†ç†è§£å‡½æ•°ç»„ä»¶çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œæˆ‘ä»¬ä¸å¦¨æ€è€ƒä¸‹ React çš„æœ¬è´¨ï¼š<strong>ä» Model åˆ° View çš„æ˜ å°„</strong>ã€‚å‡è®¾çŠ¶æ€æ°¸è¿œä¸å˜ï¼Œé‚£ä¹ˆå®é™…ä¸Šå‡½æ•°ç»„ä»¶å°±ç›¸å½“äºæ˜¯ä¸€ä¸ªæ¨¡æ¿å¼•æ“ï¼Œåªæ‰§è¡Œä¸€æ¬¡ã€‚ä½†æ˜¯ React æœ¬èº«æ­£æ˜¯ä¸ºåŠ¨æ€çš„çŠ¶æ€å˜åŒ–è€Œè®¾è®¡çš„ï¼Œè€Œå¯èƒ½å¼•èµ·çŠ¶æ€å˜åŒ–çš„åŸå› åŸºæœ¬åªæœ‰ä¸¤ä¸ªï¼š</p><ol>\n<li>ç”¨æˆ·æ“ä½œäº§ç”Ÿçš„äº‹ä»¶ï¼Œæ¯”å¦‚ç‚¹å‡»äº†æŸä¸ªæŒ‰é’®ã€‚</li>\n<li>å‰¯ä½œç”¨äº§ç”Ÿçš„äº‹ä»¶ï¼Œæ¯”å¦‚å‘èµ·æŸä¸ªè¯·æ±‚æ­£ç¡®è¿”å›äº†ã€‚</li>\n</ol><p>è¿™ä¸¤ç§äº‹ä»¶æœ¬èº«å¹¶ä¸ä¼šå¯¼è‡´ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ï¼Œä½†æˆ‘ä»¬åœ¨è¿™ä¸¤ç§äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ï¼Œä¸€å®šæ˜¯å› ä¸ºæ”¹å˜äº†æŸä¸ªçŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€å¯èƒ½æ˜¯ State æˆ–è€… Contextï¼Œä»è€Œå¯¼è‡´äº† UI çš„é‡æ–°æ¸²æŸ“ã€‚</p><p>å¯¹äºç¬¬ä¸€ç§æƒ…å†µï¼Œå…¶å®å‡½æ•°ç»„ä»¶å’Œ Class ç»„ä»¶çš„æ€è·¯å‡ ä¹å®Œå…¨ä¸€æ ·ï¼šé€šè¿‡äº‹ä»¶å¤„ç†å‡½æ•°æ¥æ”¹å˜æŸä¸ªçŠ¶æ€ï¼›å¯¹äºç¬¬äºŒç§æƒ…å†µï¼Œåœ¨å‡½æ•°ç»„ä»¶ä¸­æ˜¯é€šè¿‡ useEffect è¿™ä¸ª Hook æ›´åŠ ç›´è§‚å’Œè¯­ä¹‰åŒ–çš„æ–¹å¼æ¥æè¿°ã€‚å¯¹åº”åˆ° Class ç»„ä»¶ï¼Œåˆ™æ˜¯é€šè¿‡æ‰‹åŠ¨åˆ¤æ–­ Props æˆ–è€… State çš„å˜åŒ–æ¥æ‰§è¡Œçš„ã€‚</p><p>æ¯”å¦‚å¯¹äºåœ¨ç¬¬ä¸‰è®²ä»‹ç»çš„ä¾‹å­ï¼Œä¸€ä¸ªç”¨äºæ˜¾ç¤ºåšå®¢æ–‡ç« çš„ç»„ä»¶æ¥æ”¶ä¸€ä¸ªæ–‡ç« çš„ id ä½œä¸ºå‚æ•°ï¼Œç„¶åæ ¹æ®è¿™ä¸ª id ä»æœåŠ¡å™¨ç«¯è·å–æ–‡ç« çš„å†…å®¹å¹¶æ˜¾ç¤ºå‡ºæ¥ã€‚é‚£ä¹ˆå½“ id å˜åŒ–çš„æ—¶å€™ï¼Œä½ å°±éœ€è¦æ£€æµ‹åˆ°è¿™ä¸ªå˜åŒ–ï¼Œå¹¶é‡æ–°å‘é€è¯·æ±‚ï¼Œæ˜¾ç¤ºåœ¨ç•Œé¢ä¸Šã€‚åœ¨ Class ç»„ä»¶ä¸­ï¼Œä½ é€šå¸¸è¦ç”¨å¦‚ä¸‹çš„ä»£ç å®ç°ï¼š</p><pre><code>class BlogView extends React.Component {\n  // ...\n  componentDidMount() {\n    // ç»„ä»¶ç¬¬ä¸€æ¬¡åŠ è½½æ—¶å»è·å– Blog æ•°æ®\n    fetchBlog(this.props.id);\n  }\n  componentDidUpdate(prevProps) {\n    if (prevProps.id !== this.props.id) {\n      // å½“ Blog çš„ id å‘ç”Ÿå˜åŒ–æ—¶å»è·å–åšå®¢æ–‡ç« \n      fetchBlog(this.props.id);\n    }\n  }\n  // ...\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ Class ç»„ä»¶ä¸­ï¼Œéœ€è¦åœ¨ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­å»å®ç°å‰¯ä½œç”¨ï¼Œä¸€ä¸ªæ˜¯é¦–æ¬¡åŠ è½½ï¼Œå¦å¤–ä¸€ä¸ªåˆ™æ˜¯æ¯æ¬¡ UI æ›´æ–°åã€‚è€Œåœ¨å‡½æ•°ç»„ä»¶ä¸­ä¸å†æœ‰ç”Ÿå‘½å‘¨æœŸçš„æ¦‚å¿µï¼Œè€Œæ˜¯æä¾›äº† useEffect è¿™æ ·ä¸€ä¸ª Hook ä¸“é—¨ç”¨æ¥æ‰§è¡Œå‰¯ä½œç”¨ï¼Œå› æ­¤ï¼Œåªéœ€ä¸‹é¢çš„ä»£ç å³å¯å®ç°åŒæ ·çš„åŠŸèƒ½ï¼š</p><pre><code>function BlogView({ id }) {\n  useEffect(() =&gt; {\n    // å½“ id å˜åŒ–æ—¶é‡æ–°è·å–åšå®¢æ–‡ç« \n    fetchBlog(id);\n  }, [id]); // å®šä¹‰äº†ä¾èµ–é¡¹ id\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å‡½æ•°ç»„ä»¶ä¸­ä½ è¦æ€è€ƒçš„æ–¹å¼æ°¸è¿œæ˜¯ï¼š<strong>å½“æŸä¸ªçŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæˆ‘è¦åšä»€ä¹ˆï¼Œ</strong>è€Œä¸å†æ˜¯åœ¨ Class ç»„ä»¶ä¸­çš„æŸä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­æˆ‘è¦åšä»€ä¹ˆã€‚</p><p>æ‰€ä»¥å¦‚æœä½ æ˜¯ä» Class ç»„ä»¶è½¬å‹åˆ°å‡½æ•°ç»„ä»¶ï¼Œé‚£ä¹ˆä½ è¦åšçš„å°±æ˜¯å¿˜æ‰ Class ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæœºåˆ¶ï¼Œå»é€æ¸ä¹ æƒ¯å‡½æ•°ç»„ä»¶çš„æ€è€ƒæ–¹å¼ã€‚ç›¸ä¿¡è¿™æ ·ä½ å°±èƒ½å¤Ÿä½“ä¼šåˆ°å‡½æ•°ç»„ä»¶å¸¦æ¥çš„ç›´è§‚ã€ç®€æ´çš„å¥½å¤„äº†ã€‚</p><p>å½“ç„¶ï¼Œè¦ä¸€ä¸‹å­å½»åº•è½¬å˜æ˜¯å¾ˆéš¾çš„ï¼Œä½ éœ€è¦åœ¨å®é™…å¼€å‘ä¸­ä¸æ–­ç»ƒä¹ ã€‚é‚£å…·ä½“è¿™æ ·æ‰èƒ½ç®—æ˜¯ç”¨ Hooks æ–¹å¼æ€è€ƒå‘¢ï¼Ÿæ¥ä¸‹æ¥æˆ‘ä»¬å°±ä¸€èµ·æ¥å¯¹æ¯”çœ‹ä¸ªä¾‹å­ï¼Œå½“ä¸€ä¸ªéœ€æ±‚æ¥çš„æ—¶å€™ï¼ŒåŸºäºç±»ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæœºåˆ¶æ˜¯å¦‚ä½•åšçš„ï¼Œè€Œåœ¨å‡½æ•°ç»„ä»¶ä¸­åˆæ˜¯å¦‚ä½•åšçš„ã€‚</p><h1>é‡æ–°æ€è€ƒç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ</h1><p>åœ¨ä¼ ç»Ÿçš„ç±»ç»„ä»¶ä¸­ï¼Œæœ‰ä¸“é—¨å®šä¹‰çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ç”¨äºæ‰§è¡Œä¸åŒçš„é€»è¾‘ï¼Œé‚£ä¹ˆå®ƒä»¬åœ¨å‡½æ•°ç»„ä»¶çš„å­˜åœ¨çš„å½¢å¼åˆæ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿæ¥ä¸‹æ¥æˆ‘å°±å¸¦ä½ ä¸€èµ·çœ‹çœ‹åœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œæ˜¯å¦‚ä½•æ€è€ƒç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸçš„ã€‚</p><h2>æ„é€ å‡½æ•°</h2><p>åœ¨ç±»ç»„ä»¶ä¸­æœ‰ä¸€ä¸ªä¸“é—¨çš„æ–¹æ³•å« constructorï¼Œä¹Ÿå°±æ˜¯æ„é€ å‡½æ•°ï¼Œåœ¨é‡Œé¢æˆ‘ä»¬ä¼šåšä¸€äº›åˆå§‹åŒ–çš„äº‹æƒ…ï¼Œæ¯”å¦‚è®¾ç½® State çš„åˆå§‹çŠ¶æ€ï¼Œæˆ–è€…å®šä¹‰ä¸€äº›ç±»çš„å®ä¾‹çš„æˆå‘˜ã€‚</p><p>è€Œç°åœ¨ï¼Œå‡½æ•°ç»„ä»¶åªæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ²¡æœ‰æ‰€è°“çš„å¯¹è±¡ï¼Œæˆ–è€…è¯´ç±»çš„å®ä¾‹è¿™æ ·çš„æ¦‚å¿µï¼Œé‚£è‡ªç„¶ä¹Ÿå°±æ²¡æœ‰æ„é€ å‡½æ•°çš„è¯´æ³•äº†ã€‚</p><p>é‚£ä¹ˆåœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥å¦‚ä½•å»åšä¸€äº›åˆå§‹åŒ–çš„äº‹æƒ…å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ï¼šå‡½æ•°ç»„ä»¶åŸºæœ¬ä¸Šæ²¡æœ‰ç»Ÿä¸€çš„åˆå§‹åŒ–éœ€è¦ï¼Œå› ä¸º Hooks è‡ªå·±ä¼šè´Ÿè´£è‡ªå·±çš„åˆå§‹åŒ–ã€‚æ¯”å¦‚ useState è¿™ä¸ª Hookï¼Œæ¥æ”¶çš„å‚æ•°å°±æ˜¯å®šä¹‰çš„ State åˆå§‹å€¼ã€‚è€Œåœ¨è¿‡å»çš„ç±»ç»„ä»¶ä¸­ï¼Œä½ é€šå¸¸éœ€è¦åœ¨æ„é€ å‡½æ•°ä¸­ç›´æ¥è®¾ç½® this.state ï¼Œä¹Ÿå°±æ˜¯è®¾ç½®æŸä¸ªå€¼æ¥å®Œæˆåˆå§‹åŒ–ã€‚</p><p>ä½†æ˜¯è¦æ³¨æ„äº†ï¼Œæˆ‘æåˆ°çš„â€œåŸºæœ¬ä¸Šæ²¡æœ‰åˆå§‹åŒ–éœ€è¦â€ï¼Œä¹Ÿå°±æ˜¯å¹¶ä¸æ˜¯å®Œå…¨æ²¡æœ‰ã€‚ä¸¥æ ¼æ¥è¯´ï¼Œè™½ç„¶éœ€æ±‚ä¸å¤šï¼Œä½†ç±»ç»„ä»¶ä¸­æ„é€ å‡½æ•°èƒ½åšçš„ä¸åªæ˜¯åˆå§‹åŒ– Stateï¼Œè¿˜å¯èƒ½æœ‰å…¶å®ƒçš„é€»è¾‘ã€‚é‚£ä¹ˆå¦‚æœä¸€å®šè¦åœ¨å‡½æ•°ç»„ä»¶ä¸­å®ç°æ„é€ å‡½æ•°åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p><p>è¿™æ—¶å€™æˆ‘ä»¬ä¸å¦¨æ€è€ƒä¸‹æ„é€ å‡½æ•°çš„æœ¬è´¨ï¼Œå…¶å®å°±æ˜¯ï¼šåœ¨æ‰€ä»¥å…¶å®ƒä»£ç æ‰§è¡Œä¹‹å‰çš„ä¸€æ¬¡æ€§åˆå§‹åŒ–å·¥ä½œã€‚åœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œå› ä¸ºæ²¡æœ‰ç”Ÿå‘½å‘¨æœŸçš„æœºåˆ¶ï¼Œé‚£ä¹ˆè½¬æ¢ä¸€ä¸‹æ€è·¯ï¼Œå…¶å®æˆ‘ä»¬è¦å®ç°çš„æ˜¯ï¼šä¸€æ¬¡æ€§çš„ä»£ç æ‰§è¡Œã€‚</p><p>è™½ç„¶æ²¡æœ‰ç›´æ¥çš„æœºåˆ¶å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼Œä½†æ˜¯åˆ©ç”¨ useRef è¿™ä¸ª Hookï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ä¸€ä¸ª useSingleton è¿™æ ·çš„ä¸€æ¬¡æ€§æ‰§è¡ŒæŸæ®µä»£ç çš„è‡ªå®šä¹‰ Hookï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code>import { useRef } from 'react';\n\n// åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰ Hook ç”¨äºæ‰§è¡Œä¸€æ¬¡æ€§ä»£ç \nfunction useSingleton(callback) {\n  // ç”¨ä¸€ä¸ª called ref æ ‡è®° callback æ˜¯å¦æ‰§è¡Œè¿‡\n  const called = useRef(false);\n  // å¦‚æœå·²ç»æ‰§è¡Œè¿‡ï¼Œåˆ™ç›´æ¥è¿”å›\n  if (called.current) return;\n  // ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶ç›´æ¥æ‰§è¡Œ\n  callBack();\n  // è®¾ç½®æ ‡è®°ä¸ºå·²æ‰§è¡Œè¿‡\n  called.current = true;\n}\n</code></pre><p>ä»è€Œåœ¨ä¸€ä¸ªå‡½æ•°ç»„ä»¶ä¸­ï¼Œå¯ä»¥è°ƒç”¨è¿™ä¸ªè‡ªå®šä¹‰ Hook æ¥æ‰§è¡Œä¸€äº›ä¸€æ¬¡æ€§çš„åˆå§‹åŒ–é€»è¾‘ï¼š</p><pre><code>import useSingleton from './useSingleton';\n\nconst MyComp = () =&gt; {\n  // ä½¿ç”¨è‡ªå®šä¹‰ Hook\n  useSingleton(() =&gt; {\n    console.log('è¿™æ®µä»£ç åªæ‰§è¡Œä¸€æ¬¡');\n  });\n\n  return (\n    &lt;div&gt;My Component&lt;/div&gt;\n  );\n};\n</code></pre><p>ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒuseSingleton è¿™ä¸ª Hook çš„æ ¸å¿ƒé€»è¾‘å°±æ˜¯å®šä¹‰åªæ‰§è¡Œä¸€æ¬¡çš„ä»£ç ã€‚è€Œæ˜¯å¦åœ¨æ‰€æœ‰ä»£ç ä¹‹å‰æ‰§è¡Œï¼Œåˆ™å–å†³äºåœ¨å“ªé‡Œè°ƒç”¨ï¼Œå¯ä»¥è¯´ï¼Œå®ƒçš„åŠŸèƒ½å…¶å®æ˜¯åŒ…å«äº†æ„é€ å‡½æ•°çš„åŠŸèƒ½çš„ã€‚</p><p>æ‰€ä»¥ä½ åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæ˜¯æ— éœ€å»å°†åŠŸèƒ½æ˜ å°„åˆ°ä¼ ç»Ÿçš„ç”Ÿå‘½å‘¨æœŸçš„æ„é€ å‡½æ•°çš„æ¦‚å¿µï¼Œè€Œæ˜¯è¦ä»å‡½æ•°çš„è§’åº¦å‡ºå‘ï¼Œå»æ€è€ƒåŠŸèƒ½å¦‚ä½•å»å®ç°ã€‚æ¯”å¦‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬éœ€è¦çš„å…¶å®å°±æ˜¯æŠ“ä½æŸæ®µä»£ç åªéœ€è¦æ‰§è¡Œä¸€æ¬¡è¿™æ ·ä¸€ä¸ªæœ¬è´¨çš„éœ€æ±‚ï¼Œä»è€Œèƒ½å¤Ÿæ›´è‡ªç„¶åœ°ç”¨ Hooks è§£å†³é—®é¢˜ã€‚</p><h2>ä¸‰ç§å¸¸ç”¨çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</h2><p>åœ¨ç±»ç»„ä»¶ä¸­ï¼ŒcomponentDidMountï¼ŒcomponentWillUnmountï¼Œå’ŒcomponentDidUpdateè¿™ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•å¯ä»¥è¯´æ˜¯æ—¥å¸¸å¼€å‘æœ€å¸¸ç”¨çš„ã€‚ä¸šåŠ¡é€»è¾‘é€šå¸¸è¦åˆ†æ•£åˆ°ä¸åŒçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­ï¼Œæ¯”å¦‚è¯´åœ¨ä¸Šé¢çš„ Blog æ–‡ç« çš„ä¾‹å­ä¸­ï¼Œä½ éœ€è¦åŒæ—¶åœ¨ componentDidMount å’Œ componentDidUpdate ä¸­å»è·å–æ•°æ®ã€‚</p><p>è€Œåœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼Œè¿™å‡ ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•å¯ä»¥ç»Ÿä¸€åˆ° useEffect è¿™ä¸ª Hookï¼Œæ­£å¦‚useEffect çš„å­—é¢å«ä¹‰ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯è§¦å‘ä¸€ä¸ªå‰¯ä½œç”¨ï¼Œå³åœ¨ç»„ä»¶æ¯æ¬¡ render ä¹‹åå»æ‰§è¡Œã€‚</p><p>åœ¨ç¬¬ä¸‰è®²ä¸­å…¶å®ä½ å·²ç»çœ‹åˆ°äº† useEffect çš„ç”¨æ³•ï¼Œä¸‹é¢çš„ä»£ç æ¼”ç¤ºäº†è¿™ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•æ˜¯å¦‚ä½•ç”¨ useEffect å®ç°çš„ï¼š</p><pre><code>useEffect(() =&gt; {\n  // componentDidMount + componentDidUpdate\n  console.log('è¿™é‡ŒåŸºæœ¬ç­‰ä»·äº componentDidMount + componentDidUpdate');\n  return () =&gt; {\n    // componentWillUnmount\n    console.log('è¿™é‡ŒåŸºæœ¬ç­‰ä»·äº componentWillUnmount');\n  }\n}, [deps])\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒuseEffect æ¥æ”¶çš„ callback å‚æ•°ï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªç”¨äºæ¸…ç†èµ„æºçš„å‡½æ•°ï¼Œä»è€Œåœ¨ä¸‹ä¸€æ¬¡åŒæ ·çš„ Effect è¢«æ‰§è¡Œä¹‹å‰è¢«è°ƒç”¨ã€‚</p><p>ä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°äº†ï¼Œåœ¨ä»£ç é‡Œæˆ‘ç”¨äº†â€œåŸºæœ¬ç­‰ä»·äºâ€è¿™ä¸ªè¯´æ³•ï¼Œä»€ä¹ˆæ„æ€å‘¢ï¼ŸæŒ‡çš„å°±æ˜¯è¿™ä¸ªå†™æ³•å¹¶æ²¡æœ‰å®Œå…¨ç­‰ä»·äºä¼ ç»Ÿçš„è¿™å‡ ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•ã€‚ä¸»è¦æœ‰ä¸¤ä¸ªåŸå› ã€‚</p><p>ä¸€æ–¹é¢ï¼ŒuseEffect(callback) è¿™ä¸ª Hook æ¥æ”¶çš„ callbackï¼Œåªæœ‰åœ¨ä¾èµ–é¡¹å˜åŒ–æ—¶æ‰è¢«æ‰§è¡Œã€‚è€Œä¼ ç»Ÿçš„ componentDidUpdate åˆ™ä¸€å®šä¼šæ‰§è¡Œã€‚è¿™æ ·æ¥çœ‹ï¼ŒHook çš„æœºåˆ¶å…¶å®æ›´å…·æœ‰è¯­ä¹‰åŒ–ï¼Œå› ä¸ºè¿‡å»åœ¨ componentDidUpdate ä¸­ï¼Œæˆ‘ä»¬é€šå¸¸éƒ½éœ€è¦æ‰‹åŠ¨åˆ¤æ–­æŸä¸ªçŠ¶æ€æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œç„¶åå†æ‰§è¡Œç‰¹å®šçš„é€»è¾‘ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œcallback è¿”å›çš„å‡½æ•°ï¼ˆä¸€èˆ¬ç”¨äºæ¸…ç†å·¥ä½œï¼‰åœ¨ä¸‹ä¸€æ¬¡ä¾èµ–é¡¹å‘ç”Ÿå˜åŒ–ä»¥åŠç»„ä»¶é”€æ¯ä¹‹å‰æ‰§è¡Œï¼Œè€Œä¼ ç»Ÿçš„ componentWillUnmount åªåœ¨ç»„ä»¶é”€æ¯æ—¶æ‰ä¼šæ‰§è¡Œã€‚</p><p>ç¬¬äºŒç‚¹å¯èƒ½æœ‰ç‚¹éš¾ç†è§£ï¼Œæˆ‘ä»¬ä¸å¦¨ç»§ç»­çœ‹åšå®¢æ–‡ç« è¿™ä¸ªä¾‹å­ã€‚å‡è®¾å½“æ–‡ç«  id å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæˆ‘ä»¬ä¸ä»…éœ€è¦è·å–æ–‡ç« ï¼ŒåŒæ—¶è¿˜è¦ç›‘å¬æŸä¸ªäº‹ä»¶ï¼Œè¿™æ ·åœ¨æœ‰æ–°çš„è¯„è®ºæ—¶è·å¾—é€šçŸ¥ï¼Œå°±èƒ½æ˜¾ç¤ºæ–°çš„è¯„è®ºäº†ã€‚è¿™æ—¶å€™çš„ä»£ç ç»“æ„å¦‚ä¸‹ï¼š</p><pre><code>import React, { useEffect } from 'react';\nimport comments from './comments';\n\nfunction BlogView({ id }) {\n  const handleCommentsChange = useCallback(() =&gt; {\n    // å¤„ç†è¯„è®ºå˜åŒ–çš„é€šçŸ¥\n  }, []);\n  useEffect(() =&gt; {\n    // è·å–åšå®¢å†…å®¹\n    fetchBlog(id);\n    // ç›‘å¬æŒ‡å®š id çš„åšå®¢æ–‡ç« çš„è¯„è®ºå˜åŒ–é€šçŸ¥\n    const listener = comments.addListener(id, handleCommentsChange);\n    \n    return () =&gt; {\n      // å½“ id å‘ç”Ÿå˜åŒ–æ—¶ï¼Œç§»é™¤ä¹‹å‰çš„ç›‘å¬\n      comments.removeListener(listener);\n    };\n  }, [id, handleCommentsChange])\n}\n</code></pre><p>é‚£ä¹ˆå¯ä»¥æ¯”è¾ƒæ¸…æ¥šåœ°çœ‹åˆ°ï¼ŒuseEffect æ¥æ”¶çš„è¿”å›å€¼æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°ä¸åªæ˜¯ä¼šåœ¨ç»„ä»¶é”€æ¯æ—¶æ‰§è¡Œï¼Œè€Œä¸”æ˜¯æ¯æ¬¡ Effect é‡æ–°æ‰§è¡Œä¹‹å‰éƒ½ä¼šæ‰§è¡Œï¼Œç”¨äºæ¸…ç†ä¸Šä¸€æ¬¡ Effect çš„æ‰§è¡Œç»“æœã€‚</p><p>ç†è§£è¿™ä¸€ç‚¹éå¸¸é‡è¦ã€‚useEffect ä¸­è¿”å›çš„å›è°ƒå‡½æ•°ï¼Œåªæ˜¯æ¸…ç†å½“å‰æ‰§è¡Œçš„ Effect æœ¬èº«ã€‚è¿™å…¶å®æ˜¯æ›´åŠ è¯­ä¹‰åŒ–çš„ï¼Œå› æ­¤ä½ ä¸ç”¨å°†å…¶æ˜ å°„åˆ° componentWillUnmountï¼Œå®ƒä¹Ÿå®Œå…¨ä¸ç­‰ä»·äº componentWillUnmountã€‚ä½ åªéœ€è®°ä½å®ƒçš„ä½œç”¨å°±æ˜¯ç”¨äºæ¸…ç†ä¸Šä¸€æ¬¡ Effect çš„ç»“æœå°±è¡Œäº†ï¼Œè¿™æ ·åœ¨å®é™…çš„å¼€å‘ä¸­æ‰èƒ½å¤Ÿä½¿ç”¨å¾—æ›´åŠ è‡ªç„¶å’Œåˆç†ã€‚</p><h2>å…¶å®ƒçš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•</h2><p>åˆšæ‰æˆ‘åˆ—ä¸¾äº†å‡ ä¸ª Class ç»„ä»¶ä¸­æœ€ä¸ºå¸¸ç”¨çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œå¹¶ä»‹ç»äº†å¯¹äºåŒæ ·çš„éœ€æ±‚ï¼Œåœ¨å‡½æ•°ç»„ä»¶ä¸­åº”è¯¥å¦‚ä½•å»ç”¨ Hooks çš„æœºåˆ¶é‡æ–°æ€è€ƒå®ƒä»¬çš„å®ç°ã€‚è¿™å·²ç»èƒ½è¦†ç›–ç»å¤§å¤šæ•°çš„åº”ç”¨åœºæ™¯äº†ã€‚</p><p>ä½†æ˜¯ Class ç»„ä»¶ä¸­è¿˜æœ‰å…¶å®ƒä¸€äº›æ¯”è¾ƒå°‘ç”¨çš„æ–¹æ³•ï¼Œæ¯”å¦‚ getSnapshotBeforeUpdate, componentDidCatch, getDerivedStateFromErrorã€‚æ¯”è¾ƒé—æ†¾çš„æ˜¯ç›®å‰ Hooks è¿˜æ²¡æ³•å®ç°è¿™äº›åŠŸèƒ½ã€‚å› æ­¤å¦‚æœå¿…é¡»ç”¨åˆ°ï¼Œä½ çš„ç»„ä»¶ä»ç„¶éœ€è¦ç”¨ç±»ç»„ä»¶å»å®ç°ã€‚</p><h1>å·²æœ‰åº”ç”¨æ˜¯å¦åº”è¯¥è¿ç§»åˆ° Hooksï¼Ÿ</h1><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œä½ å¯èƒ½ä¼šè§‰å¾—å†™ React åº”ç”¨å°±ä¸€å®šé Hooks ä¸å¯äº†ï¼Œå…¶å®ä¹Ÿå¹¶éç»å¯¹ã€‚æ¯”å¦‚è¯´å¾ˆå¤šæ—¶å€™ï¼Œä½ é¢ä¸´çš„å¯èƒ½å¹¶ä¸æ˜¯å¼€å§‹ä¸€ä¸ªå…¨æ–°çš„é¡¹ç›®ï¼Œè€Œæ˜¯å‚ä¸åˆ°ä¸€ä¸ªå·²æœ‰çš„é¡¹ç›®ä¸­ã€‚é‚£ä¹ˆå°±å¾ˆå¯èƒ½ä¼šé‡åˆ°è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šå¯¹äºå·²æœ‰é¡¹ç›®ä¸­çš„ Class ç»„ä»¶ï¼Œæ˜¯å¦è¦é‡æ„åˆ°å‡½æ•°ç»„ä»¶å’Œ Hooks å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆå…¶å®å¾ˆæ˜ç¡®ï¼šå®Œå…¨æ²¡å¿…è¦ã€‚</p><p>åœ¨ React ä¸­ï¼ŒClass ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶æ˜¯å®Œå…¨å¯ä»¥å…±å­˜çš„ã€‚å¯¹äºæ–°çš„åŠŸèƒ½ï¼Œæˆ‘ä¼šæ›´æ¨èä½¿ç”¨å‡½æ•°ç»„ä»¶ã€‚è€Œå¯¹äºå·²æœ‰çš„åŠŸèƒ½ï¼Œåˆ™ç»´æŒç°çŠ¶å°±å¯ä»¥ã€‚é™¤éè¦è¿›è¡Œå¤§çš„åŠŸèƒ½æ”¹å˜ï¼Œå¯ä»¥é¡ºä¾¿æŠŠç›¸å…³çš„ç±»ç»„ä»¶è¿›è¡Œé‡æ„ï¼Œå¦åˆ™æ˜¯æ²¡æœ‰å¿…è¦è¿›è¡Œè¿ç§»çš„ã€‚</p><p>å› ä¸ºç»ˆç©¶æ¥è¯´ï¼Œèƒ½æ­£ç¡®å·¥ä½œçš„ä»£ç å°±æ˜¯å¥½ä»£ç ã€‚React ç»„ä»¶çš„ä¸¤ç§å†™æ³•æœ¬èº«å°±å¯ä»¥å¾ˆå¥½åœ°ä¸€èµ·å·¥ä½œäº†ï¼š</p><ol>\n<li>\n<p>ç±»ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶å¯ä»¥äº’ç›¸å¼•ç”¨ï¼›</p>\n</li>\n<li>\n<p>Hooks å¾ˆå®¹æ˜“å°±èƒ½è½¬æ¢æˆé«˜é˜¶ç»„ä»¶ï¼Œå¹¶ä¾›ç±»ç»„ä»¶ä½¿ç”¨ã€‚</p>\n</li>\n</ol><p>æ€»ç»“æ¥è¯´ï¼Œæˆ‘ä»¬å®Œå…¨æ²¡å¿…è¦ä¸ºäº†è¿ç§»è€Œè¿ç§»ã€‚</p><h1>å°ç»“</h1><p>è¿™ä¸€è®²æˆ‘ä»¬ä¸»è¦å­¦ä¹ äº†å‡½æ•°ç»„ä»¶å’Œç±»ç»„ä»¶åœ¨æ€è€ƒæ–¹å¼ä¸Šçš„åŒºåˆ«ï¼Œè™½ç„¶ Hooks åœ¨åŠŸèƒ½ä¸ŠåŸºæœ¬å¯ä»¥æ˜ å°„åˆ°ä¼ ç»Ÿçš„ Class ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œä½†æ˜¯å®ƒä»¬å´åˆä¸æ˜¯å®Œå…¨ç­‰ä»·çš„ã€‚åœ¨å®ç°å…·ä½“çš„ä¸šåŠ¡åŠŸèƒ½çš„æ—¶å€™ï¼Œéƒ½åº”è¯¥å°½é‡ä» Hooks çš„è¯­ä¹‰è§’åº¦å‡ºå‘å»æ€è€ƒç»„ä»¶æ˜¯å¦‚ä½•å±•ç°å’Œäº¤äº’çš„ï¼Œè¿™æ ·æ‰èƒ½æ›´åŠ é¡ºæ»‘åœ°åˆ‡æ¢åˆ°å‡½æ•°ç»„ä»¶çš„å¼€å‘æ–¹å¼ã€‚</p><h1>æ€è€ƒé¢˜</h1><p>ä»Šå¤©è¿™èŠ‚è¯¾æˆ‘ä»¬åªæè¿°äº† componentWillUnmount è¿‘ä¼¼çš„å®ç°ï¼šç»„ä»¶é”€æ¯å’Œæ–‡ç«  id å˜åŒ–æ—¶æ‰§è¡Œã€‚é‚£ä¹ˆåœ¨å‡½æ•°ç»„ä»¶ä¸­å¦‚æœè¦å®ç°ä¸¥æ ¼çš„ componentWillUnmountï¼Œä¹Ÿå°±æ˜¯åªåœ¨ç»„ä»¶é”€æ¯æ—¶æ‰§è¡Œï¼Œåº”è¯¥å¦‚ä½•å®ç°ï¼Ÿ</p><p>æ¬¢è¿æŠŠä½ çš„æ€è€ƒå’Œæƒ³æ³•åˆ†äº«åœ¨ç•™è¨€åŒºï¼Œæˆ‘ä¼šå’Œä½ äº¤æµè®¨è®ºã€‚ä¸‹èŠ‚è¯¾å†è§ï¼</p>","comments":[{"had_liked":true,"id":295987,"user_name":"Ada","can_delete":false,"product_type":"c1","uid":1565813,"ip_address":"","ucode":"C52BDD0DBF618D","user_header":"https://static001.geekbang.org/account/avatar/00/17/e4/75/57809f30.jpg","comment_is_top":false,"comment_ctime":1622693763,"is_pvip":false,"replies":[{"id":"107463","content":"å› ä¸ºéœ€è¦åœ¨å‡½æ•°ä½“æ‰§è¡Œä¹‹å‰æ‰§è¡Œã€‚useEffect æ˜¯åœ¨ render å®Œåæ‰§è¡Œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Nate","uid":"1018676","ctime":1622727965,"ip_address":"","comment_id":295987,"utype":1}],"discussion_count":2,"race_medal":0,"score":"220666025859","product_id":100079901,"comment_content":"å¦‚æœæƒ³è¦å®ç°åªæ‰§è¡Œä¸€æ¬¡çš„åŠŸèƒ½ï¼Œç”¨useEffectï¼Œä¾èµ–é¡¹ä¼ ç©ºæ•°ç»„ï¼Œä¸æ˜¯å¯ä»¥å®ç°å—ï¼Ÿ<br>ä¸ºä»€ä¹ˆè¦å†™ä¸€ä¸ªè‡ªå®šä¹‰é’©å­ï¼Ÿ","like_count":52,"discussions":[{"author":{"id":1018676,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/34/61035278.jpg","nickname":"Nate","note":"","ucode":"844B4C20BB3D6E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521290,"discussion_content":"å› ä¸ºéœ€è¦åœ¨å‡½æ•°ä½“æ‰§è¡Œä¹‹å‰æ‰§è¡Œã€‚useEffect æ˜¯åœ¨ render å®Œåæ‰§è¡Œã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1622727965,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1388657,"avatar":"https://static001.geekbang.org/account/avatar/00/15/30/71/ba69f480.jpg","nickname":"æ¯›æ¯›å¼€é£æœº","note":"","ucode":"EC2CEBA13BF92C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377536,"discussion_content":"è¿™ä¸ªåªèƒ½åœ¨é¦–æ¬¡æ¸²æŸ“åæ‰§è¡Œä¸€æ¬¡ï¼Œä¸èƒ½æ§åˆ¶æ‰§è¡Œæ—¶æœº","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1622700858,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295977,"user_name":"æ¯›æ¯›å¼€é£æœº","can_delete":false,"product_type":"c1","uid":1388657,"ip_address":"","ucode":"EC2CEBA13BF92C","user_header":"https://static001.geekbang.org/account/avatar/00/15/30/71/ba69f480.jpg","comment_is_top":false,"comment_ctime":1622688523,"is_pvip":false,"replies":[{"id":"107467","content":"æ­£ç¡®~","user_name":"ä½œè€…å›å¤","user_name_real":"Nate","uid":"1018676","ctime":1622728134,"ip_address":"","comment_id":295977,"utype":1}],"discussion_count":1,"race_medal":0,"score":"117586805515","product_id":100079901,"comment_content":"useEffect(() =&gt; {<br>  return () =&gt; {<br>    &#47;&#47; è¿™é‡Œåªä¼šåœ¨ç»„ä»¶é”€æ¯å‰ï¼ˆcomponentWillUnmountï¼‰æ‰§è¡Œä¸€æ¬¡<br>  }<br>}, [])","like_count":28,"discussions":[{"author":{"id":1018676,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/34/61035278.jpg","nickname":"Nate","note":"","ucode":"844B4C20BB3D6E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521284,"discussion_content":"æ­£ç¡®~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622728134,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295941,"user_name":"æµ·æ´‹","can_delete":false,"product_type":"c1","uid":1377447,"ip_address":"","ucode":"5CC1E17E5C455D","user_header":"https://static001.geekbang.org/account/avatar/00/15/04/a7/ea22485a.jpg","comment_is_top":false,"comment_ctime":1622674477,"is_pvip":false,"replies":[{"id":"107461","content":"æ²¡é”™~ ä¼ å…¥ç©ºæ•°ç»„å°±å¯ä»¥äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Nate","uid":"1018676","ctime":1622727925,"ip_address":"","comment_id":295941,"utype":1}],"discussion_count":2,"race_medal":0,"score":"27392478253","product_id":100079901,"comment_content":"useEffect ç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ç©ºï¼Œå°±åªåœ¨ç»„ä»¶åˆå§‹åŒ–æ—¶å’Œé”€æ¯å‰åˆ†åˆ«æ‰§è¡Œä¸€æ¬¡","like_count":6,"discussions":[{"author":{"id":1018676,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/34/61035278.jpg","nickname":"Nate","note":"","ucode":"844B4C20BB3D6E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521274,"discussion_content":"æ²¡é”™~ ä¼ å…¥ç©ºæ•°ç»„å°±å¯ä»¥äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622727925,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1374337,"avatar":"https://static001.geekbang.org/account/avatar/00/14/f8/81/bff52f91.jpg","nickname":"1830","note":"","ucode":"246FEF7C97F39C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385213,"discussion_content":"ä¸æ˜¯è¿˜è¦return ä¸€ä¸ªå‡½æ•°å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626943629,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":305410,"user_name":"Geek_12f953","can_delete":false,"product_type":"c1","uid":2686412,"ip_address":"","ucode":"13C8FDB4617450","user_header":"","comment_is_top":false,"comment_ctime":1627962210,"is_pvip":false,"replies":[{"id":"110627","content":"ç¡®å®å¦‚æ­¤ï¼ŒuseState ä¼šå¯¼è‡´å¤šä½™çš„æ¸²æŸ“ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Nate","uid":"1018676","ctime":1628155077,"ip_address":"","comment_id":305410,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18807831394","product_id":100079901,"comment_content":"è€å¸ˆï¼ŒuseSingletonè¿™ä¸ªHooké‡Œé¢ä½¿ç”¨useRefæ¥å®šä¹‰calledæ ‡è®°è€Œä¸æ˜¯ç”¨useStateï¼Œæ˜¯å› ä¸ºcalledå¹¶ä¸ä¼šå½±å“UIæ¸²æŸ“å—ï¼Ÿæˆ‘å°è¯•äº†ç”¨useStateå¥½åƒä¹Ÿå¯ä»¥å®ç°åªæ‰§è¡Œä¸€æ¬¡çš„æ•ˆæœ","like_count":4,"discussions":[{"author":{"id":1018676,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/34/61035278.jpg","nickname":"Nate","note":"","ucode":"844B4C20BB3D6E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524377,"discussion_content":"ç¡®å®å¦‚æ­¤ï¼ŒuseState ä¼šå¯¼è‡´å¤šä½™çš„æ¸²æŸ“ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628155077,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":305133,"user_name":"èŠ±å„¿ä¸å°‘å¹´","can_delete":false,"product_type":"c1","uid":1046304,"ip_address":"","ucode":"E2D685737E4F1B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f7/20/e2dfa9c2.jpg","comment_is_top":false,"comment_ctime":1627839759,"is_pvip":false,"replies":[{"id":"110408","content":"useEffect æ¥æ”¶çš„ callback æ˜¯åœ¨ ä¾èµ–å‘ç”Ÿå˜åŒ–ä»¥åŠç¬¬ä¸€æ¬¡æ—¶æ‰§è¡Œï¼Œreturn çš„å‡½æ•°æ˜¯åœ¨ä¸‹ä¸€æ¬¡ callback  æ‰§è¡Œä¹‹å‰æ‰§è¡Œï¼Œæˆ–è€…é”€æ¯æ—¶æ‰§è¡Œã€‚è¿™æ®µä»£ç çš„ ä¾èµ–é¡¹ä¸ºç©ºï¼Œæ‰€ä»¥åªä¼šåœ¨æœ€åç»„ä»¶é”€æ¯æ—¶æ‰§è¡Œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Nate","uid":"1018676","ctime":1627890770,"ip_address":"","comment_id":305133,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18807708943","product_id":100079901,"comment_content":"è¯·æ•™ï¼š ä»¥ä¸‹ä»£ç ä¸æ˜¯æ¯æ¬¡renderåéƒ½ä¼šæ‰§è¡Œå—ï¼Œreturnçš„å‡½æ•°åœ¨æ¯æ¬¡effectæ‰§è¡Œå‰æ‰§è¡Œï¼Ÿ<br><br>useEffect(() =&gt; {<br>  return () =&gt; {<br>    &#47;&#47; è¿™é‡Œåªä¼šåœ¨ç»„ä»¶é”€æ¯å‰ï¼ˆcomponentWillUnmountï¼‰æ‰§è¡Œä¸€æ¬¡<br>  }<br>}, [])<br>","like_count":4,"discussions":[{"author":{"id":1018676,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/34/61035278.jpg","nickname":"Nate","note":"","ucode":"844B4C20BB3D6E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524287,"discussion_content":"useEffect æ¥æ”¶çš„ callback æ˜¯åœ¨ ä¾èµ–å‘ç”Ÿå˜åŒ–ä»¥åŠç¬¬ä¸€æ¬¡æ—¶æ‰§è¡Œï¼Œreturn çš„å‡½æ•°æ˜¯åœ¨ä¸‹ä¸€æ¬¡ callback  æ‰§è¡Œä¹‹å‰æ‰§è¡Œï¼Œæˆ–è€…é”€æ¯æ—¶æ‰§è¡Œã€‚è¿™æ®µä»£ç çš„ ä¾èµ–é¡¹ä¸ºç©ºï¼Œæ‰€ä»¥åªä¼šåœ¨æœ€åç»„ä»¶é”€æ¯æ—¶æ‰§è¡Œã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1627890770,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296874,"user_name":"Isaac","can_delete":false,"product_type":"c1","uid":1110607,"ip_address":"","ucode":"038C349AB508AB","user_header":"https://static001.geekbang.org/account/avatar/00/10/f2/4f/59bd4141.jpg","comment_is_top":false,"comment_ctime":1623208587,"is_pvip":false,"replies":[{"id":"107977","content":"DOM æ¸²æŸ“åæ‰§è¡Œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Nate","uid":"1018676","ctime":1623470396,"ip_address":"","comment_id":296874,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14508110475","product_id":100079901,"comment_content":"è€å¸ˆï¼ŒuseEffect çš„æ‰§è¡Œæ—¶æœºæ˜¯ DOM æ¸²æŸ“å®Œæ¯•åæ‰§è¡Œï¼Œè¿˜æ˜¯ä¾èµ–å‘ç”Ÿå˜åŒ–ï¼Œä¸ç®¡ DOM æœ‰æ²¡æœ‰æ›´æ–°å®Œæ¯•å°±ç«‹å³æ‰§è¡Œï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1018676,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/34/61035278.jpg","nickname":"Nate","note":"","ucode":"844B4C20BB3D6E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521623,"discussion_content":"DOM æ¸²æŸ“åæ‰§è¡Œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623470396,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":true,"id":296082,"user_name":"å¤§å¤§å°å°","can_delete":false,"product_type":"c1","uid":2178133,"ip_address":"","ucode":"8A21DC629A24F5","user_header":"https://static001.geekbang.org/account/avatar/00/21/3c/55/74844d08.jpg","comment_is_top":false,"comment_ctime":1622735143,"is_pvip":false,"replies":[{"id":"107738","content":"æ‰€æœ‰åœ¨ useEffect ä¸­ç”¨åˆ°çš„å˜é‡éƒ½åº”è¯¥è¢«ä½œä¸ºä¾èµ–çš„å‚æ•°ï¼Œè¿™æ ·åœ¨ useEffect æ‰§è¡Œçš„æ—¶å€™æ‰ä¼šæ‰§è¡Œæ­£ç¡®çš„å›è°ƒå‡½æ•°ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Nate","uid":"1018676","ctime":1623081182,"ip_address":"","comment_id":296082,"utype":1}],"discussion_count":3,"race_medal":0,"score":"14507637031","product_id":100079901,"comment_content":"BlogViewé‚£ä¸ªä¾‹å­ï¼Œä¸ºä»€ä¹ˆè¦æŠŠuseCallbackè¿”å›çš„å‡½æ•°ä½œä¸ºuseEffectçš„ä¾èµ–å‘¢ï¼Ÿæ˜¯è¦è¾¾åˆ°ä»€ä¹ˆç›®çš„å—ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1018676,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/34/61035278.jpg","nickname":"Nate","note":"","ucode":"844B4C20BB3D6E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521315,"discussion_content":"æ‰€æœ‰åœ¨ useEffect ä¸­ç”¨åˆ°çš„å˜é‡éƒ½åº”è¯¥è¢«ä½œä¸ºä¾èµ–çš„å‚æ•°ï¼Œè¿™æ ·åœ¨ useEffect æ‰§è¡Œçš„æ—¶å€™æ‰ä¼šæ‰§è¡Œæ­£ç¡®çš„å›è°ƒå‡½æ•°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623081182,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1376899,"avatar":"https://static001.geekbang.org/account/avatar/00/15/02/83/8799b1f4.jpg","nickname":"chentianxin","note":"","ucode":"0B106B86360FFB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378043,"discussion_content":"usecall usememoç¼“å­˜çš„å€¼åœ¨useeffectä¸­ä½¿ç”¨éƒ½è¦æ·»åŠ åˆ°ä¾èµ–é¡¹ä¸­","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1623029262,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1376899,"avatar":"https://static001.geekbang.org/account/avatar/00/15/02/83/8799b1f4.jpg","nickname":"chentianxin","note":"","ucode":"0B106B86360FFB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378042,"discussion_content":"ä¸ç”¨usecallbackåŒ…è£¹çš„è¯ï¼Œfnæ¯æ¬¡rerenderéƒ½æ˜¯å…¨æ–°çš„ï¼Œå¯¼è‡´useeffectä¸€ç›´æ‰§è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623029188,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296911,"user_name":"Geek_sky","can_delete":false,"product_type":"c1","uid":1733288,"ip_address":"","ucode":"BBFE6FF1193873","user_header":"https://static001.geekbang.org/account/avatar/00/1a/72/a8/c24a66a1.jpg","comment_is_top":false,"comment_ctime":1623223024,"is_pvip":false,"replies":[{"id":"107975","content":"useRef æ˜¯å®šä¹‰ä¸€ä¸ªå½“å‰ç»„ä»¶å®ä¾‹ä¸Šçš„ä¸€ä¸ªå˜é‡ã€‚æ‰€ä»¥ç»„ä»¶é‡æ–° mountï¼Œæˆ–è€…å¤šå®ä¾‹ï¼Œæ˜¯äº’ä¸ç›¸å…³çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Nate","uid":"1018676","ctime":1623470370,"ip_address":"","comment_id":296911,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10213157616","product_id":100079901,"comment_content":"è€å¸ˆï¼Œæˆ‘çœ‹åˆ°useRefçš„ç”¨æ³•æœ‰ä¸€ä¸ªç–‘é—®ï¼šä¾‹å­ä¸­useSingletonåŒ…å«äº†ä¸€ä¸ªuseRefçš„å®šä¹‰ä¸ºfalseï¼Œå¦‚æœæˆ‘åœ¨MyCompä¸­å®šä¹‰å¤šä¸ªuseSingletonï¼Œç¨‹åºåœ¨å¯åŠ¨çš„æ—¶å€™ç¬¬äºŒæ¬¡åŠä¹‹åçš„è°ƒç”¨useRefæ˜¯æ€ä¹ˆç¡®è®¤éœ€è¦åˆ›å»ºæ–°çš„è¿˜æ˜¯ä½¿ç”¨ä¹‹å‰çš„ï¼Ÿé‚£ä¹ˆç•Œé¢åœ¨åˆ·æ–°ä¹‹åï¼ŒuseSingletonä¼šå†æ¬¡è¢«è°ƒç”¨ï¼Œé‚£æ—¶ä¼šæœ‰å¤šä¸ªuseRefçš„æ£€æŸ¥ï¼Œé‚£ä¹ˆç¨‹åºåˆæ˜¯å¦‚ä½•åˆ¤å®šçš„ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1018676,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/34/61035278.jpg","nickname":"Nate","note":"","ucode":"844B4C20BB3D6E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521642,"discussion_content":"useRef æ˜¯å®šä¹‰ä¸€ä¸ªå½“å‰ç»„ä»¶å®ä¾‹ä¸Šçš„ä¸€ä¸ªå˜é‡ã€‚æ‰€ä»¥ç»„ä»¶é‡æ–° mountï¼Œæˆ–è€…å¤šå®ä¾‹ï¼Œæ˜¯äº’ä¸ç›¸å…³çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623470370,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":330530,"user_name":"MarkTang","can_delete":false,"product_type":"c1","uid":1165689,"ip_address":"","ucode":"58F3439A070B7E","user_header":"https://static001.geekbang.org/account/avatar/00/11/c9/79/68a73484.jpg","comment_is_top":false,"comment_ctime":1642030353,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5936997649","product_id":100079901,"comment_content":"ä¹‹å‰ä¹°è¿‡è€å¸ˆçš„Reactè§†é¢‘è¯¾ï¼Œå¹²è´§éå¸¸å¤šï¼Œçœ‹äº†å¾ˆå¤šéï¼Œè¿™æ¬¡æœæ–­ä¹°äº†ã€‚è¿˜æ˜¯æœŸå¾…è€å¸ˆä»¥åçš„è§†é¢‘è¯¾","like_count":1},{"had_liked":false,"id":296349,"user_name":"JosephğŸ˜ˆ","can_delete":false,"product_type":"c1","uid":1057319,"ip_address":"","ucode":"BC1621CD3DB7E0","user_header":"https://static001.geekbang.org/account/avatar/00/10/22/27/134d9a49.jpg","comment_is_top":false,"comment_ctime":1622910456,"is_pvip":false,"replies":[{"id":"107943","content":"useEffect æ˜¯åœ¨ç»„ä»¶ render å®Œåæ‰æ‰§è¡Œçš„ï¼Œè¿™é‡Œçš„ useSingleton å¯ä»¥åœ¨å‡½æ•°ä½“å†…ç›´æ¥æ‰§è¡Œï¼Œè€Œä¸æ˜¯ render å®Œä¹‹åã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Nate","uid":"1018676","ctime":1623387981,"ip_address":"","comment_id":296349,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5917877752","product_id":100079901,"comment_content":"è¯·é—®ä¸‹è€å¸ˆï¼Œå¦‚æœåªæ˜¯ä¸ºäº†åšåˆå§‹åŒ–å·¥ä½œï¼Œå³åªåœ¨é¦–æ¬¡renderå‰æ‰§è¡Œä¸€æ¬¡ã€‚useSingletonè¿™ä¸ªè‡ªå®šä¹‰hookä¼¼ä¹æ¢æˆuseStateæˆ–useEffectä¼¼ä¹éƒ½èƒ½åšå‘€ï¼Œè·ŸuseRefç›¸æ¯”æœ‰æ²¡æœ‰ä»€ä¹ˆä¼˜åŠ£å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1018676,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/34/61035278.jpg","nickname":"Nate","note":"","ucode":"844B4C20BB3D6E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521406,"discussion_content":"useEffect æ˜¯åœ¨ç»„ä»¶ render å®Œåæ‰æ‰§è¡Œçš„ï¼Œè¿™é‡Œçš„ useSingleton å¯ä»¥åœ¨å‡½æ•°ä½“å†…ç›´æ¥æ‰§è¡Œï¼Œè€Œä¸æ˜¯ render å®Œä¹‹åã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623387981,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1110607,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f2/4f/59bd4141.jpg","nickname":"Isaac","note":"","ucode":"038C349AB508AB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378390,"discussion_content":"1. è€å¸ˆæ˜¯æƒ³æ¨¡æ‹Ÿ constructor çš„é€»è¾‘å’Œå®ç°ï¼Œå³ calss ç»„ä»¶ä¸‹çš„ constructor ä¸­çš„é€»è¾‘åªæ‰§è¡Œä¸€éï¼Œå³åœ¨ç»„ä»¶æ¸²æŸ“å‰å°±æ‰§è¡Œï¼Œä¸”åé¢å¤šæ¬¡æ›´æ–°éƒ½ä¸ä¼šå†æ¬¡æ‰§è¡Œã€‚\n2. useState æ˜¯å­˜å‚¨ state çš„åœ°æ–¹ï¼Œæ˜¾ç„¶ä¸é€‚åˆå­˜æ”¾ä¸€æ®µé€»è¾‘ä»£ç ã€‚\n3. useEffect ç”¨æ¥ç›‘å¬æŸä¸ªä¾èµ–ï¼Œç„¶åæ‰§è¡Œå‰¯ä½œç”¨ã€‚ä½†æ˜¯å› ä¸º useEffect çš„æ‰§è¡Œå®æ—¶æœºï¼Œå¯¼è‡´å¹¶ä¸èƒ½å®ç°ç¬¬ä¸€ç‚¹çš„è¦æ±‚ã€‚\n4. æ ¹æ®å‰é¢å‡ ç‚¹ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™æˆ‘ä»¬åªèƒ½å°†éœ€è¦çš„é€»è¾‘ä»£ç å†™åœ¨ function ç»„ä»¶å†…ï¼Œreturn ä¹‹å‰ï¼Œè¿™æ ·å°±èƒ½ä¿è¯åœ¨ç»„ä»¶åˆå§‹åŒ–å°±èƒ½æ‰§è¡Œè¿™æ®µé€»è¾‘ã€‚\n5. è™½ç„¶ç¬¬ 4 ç‚¹åšåˆ°äº†åœ¨ç»„ä»¶æ¸²æŸ“ä¹‹å‰æ‰§è¡Œï¼Œä½†æ˜¯ä¾æ—§æ²¡æ»¡è¶³åªæ‰§è¡Œä¸€æ¬¡çš„è¦æ±‚ï¼Œå› ä¸ºæ¯æ¬¡ React æ›´æ–°çš„æ—¶å€™ï¼Œéƒ½ä¼šå»è°ƒç”¨ functionç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯é‡æ–°æ‰§è¡Œä¸€é functionï¼Œè¿›è€Œå¯¼è‡´æˆ‘ä»¬çš„é€»è¾‘æ¯æ¬¡éƒ½ä¼šæ‰§è¡Œã€‚æ‰€ä»¥ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦å€ŸåŠ© useRef æ¥åšåˆ¤æ–­äº†ï¼Œä¹Ÿå°±æ˜¯è€å¸ˆæ–‡ç« ä¸­çš„ä¾‹å­ã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1623204740,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1376899,"avatar":"https://static001.geekbang.org/account/avatar/00/15/02/83/8799b1f4.jpg","nickname":"chentianxin","note":"","ucode":"0B106B86360FFB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378040,"discussion_content":"useSingletonç›¸å½“äºè‡ªå®šä¹‰äº†ä¸€ä¸ªhooksï¼Œ\nä¸“äº‹ä¸“å¹²\nç±»ä¼¼äºuseMountæˆ–è€…useUnmount","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623029101,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353186,"user_name":"å¥”è·‘çš„å°èš‚èš","can_delete":false,"product_type":"c1","uid":2130267,"ip_address":"å¹¿ä¸œ","ucode":"BA462E6022209A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epibNpKIwo4zFXMLIaucTicJBQ4iasrPXYNwLKiaBaOCic09mrWHPtSAA7zTVFDhXJoWBz2MWQclhlzkRg/132","comment_is_top":false,"comment_ctime":1659244491,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1659244491","product_id":100079901,"comment_content":"è¿™ä¸ªå’Œclassç»„ä»¶å¾—é‚£ä¸ªè¿˜æœ‰ç‚¹ä¸åŒå¾—æ˜¯ï¼ŒuseEffectæ˜¯åœ¨æ•°æ®è·Ÿæ–°åæ‰æ‰§è¡Œå¾—ï¼Œä¸ä¼šé˜»å¡uiï¼Œè¿™é‡Œæ¯æ¬¡æ‰§è¡Œéƒ½ä¼šå…ˆå»æ‰ä¸Šä¸€æ¬¡çš„å‰¯ä½œç”¨ï¼Œæˆ–è€…é”€æ¯çš„æ—¶å€™å»æ‰å‰¯ä½œç”¨ä¾èµ–é¡¹ä¸ä¸º[]ï¼›ä¾èµ–èµ–é¡¹ä¸º[]åªæ‰§è¡Œä¸€æ¬¡effectå‡½æ•°ï¼›æ²¡æœ‰ä¾èµ–é¡¹æ›´æ–°çš„æ—¶å€™æ¯æ¬¡éƒ½ä¼šæ‰§è¡Œ effectå‡½æ•°","like_count":0},{"had_liked":false,"id":348880,"user_name":"é²æ»¨é€Š","can_delete":false,"product_type":"c1","uid":1387826,"ip_address":"","ucode":"AD58F1115DF311","user_header":"https://static001.geekbang.org/account/avatar/00/15/2d/32/43595745.jpg","comment_is_top":false,"comment_ctime":1655490637,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1655490637","product_id":100079901,"comment_content":"useSingleton(() =&gt; {}) å’Œ useEffect(() =&gt; {}, [])  æ˜¯ç­‰ä»·çš„ ï¼Ÿéƒ½æ˜¯å‡½æ•°ç»„ä»¶åˆå§‹åŒ–çš„æ—¶å€™æ‰§è¡Œä¸€æ¬¡ ï¼Ÿ","like_count":0},{"had_liked":false,"id":345701,"user_name":"Geek_fcdf7b","can_delete":false,"product_type":"c1","uid":2115742,"ip_address":"","ucode":"55A2DBA5C6DF79","user_header":"https://static001.geekbang.org/account/avatar/00/20/48/9e/9bbaa97d.jpg","comment_is_top":false,"comment_ctime":1652517459,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652517459","product_id":100079901,"comment_content":"è€å¸ˆï¼Œä»€ä¹ˆæ—¶å€™å‡ºæ–°è¯¾ï¼Ÿ","like_count":0},{"had_liked":false,"id":298547,"user_name":"æ²³é©¬éé©¬","can_delete":false,"product_type":"c1","uid":1376612,"ip_address":"","ucode":"777FA1743534B7","user_header":"https://static001.geekbang.org/account/avatar/00/15/01/64/5f5e3886.jpg","comment_is_top":false,"comment_ctime":1624185736,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624185736","product_id":100079901,"comment_content":"useEffect æ¥æ”¶çš„ callback å‚æ•°ï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªç”¨äºæ¸…ç†èµ„æºçš„å‡½æ•°ï¼Œä»è€Œåœ¨ä¸‹ä¸€æ¬¡åŒæ ·çš„ Effect è¢«æ‰§è¡Œä¹‹å‰è¢«è°ƒç”¨ï¼Œè€å¸ˆï¼Œè¯·é—®è¿™é‡Œçš„callbackä¸­returnçš„å‡½æ•°æ˜¯ä¼šåœ¨ä¸‹æ¬¡æ‰§è¡Œå‰å’Œæœ¬æ¬¡ç»„ä»¶é”€æ¯æ—¶è‡ªåŠ¨æ‰§è¡Œå—ï¼Ÿçœ‹æ–‡æ¡£æ—¶ä¸€ç›´æ²¡æ¸…æ¥šä»–æ˜¯reactè‡ªåŠ¨å®ç°çš„è§„åˆ™ï¼Œè¿˜æ˜¯å¼€å‘è€…è‡ªå·±å®šä¹‰çš„è§„åˆ™ã€‚","like_count":0},{"had_liked":false,"id":298265,"user_name":"JuntÃ­ng","can_delete":false,"product_type":"c1","uid":1039290,"ip_address":"","ucode":"F6A3B528D6F3FD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/db/ba/304a9a4a.jpg","comment_is_top":false,"comment_ctime":1623987654,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1623987654","product_id":100079901,"comment_content":"ä¾æ® useEffect æ‰§è¡Œæœºåˆ¶ï¼Œdeps ä¼ é€’ç©ºæ•°ç»„ï¼Œå°±èƒ½ä¿è¯åªåœ¨ç»„ä»¶é”€æ¯æ—¶æ‰§è¡Œæ¶ˆé™¤å‰¯ä½œç”¨","like_count":0},{"had_liked":false,"id":296494,"user_name":"äº¦æ«ä¸¶","can_delete":false,"product_type":"c1","uid":1436276,"ip_address":"","ucode":"A8D09693C760E0","user_header":"https://static001.geekbang.org/account/avatar/00/15/ea/74/7dd9c65e.jpg","comment_is_top":false,"comment_ctime":1623006821,"is_pvip":false,"replies":[{"id":"107750","content":"ä¸è¡Œå“¦ï¼Œè¿™æ ·æ¯æ¬¡éƒ½ä¼šæ‰§è¡Œ callback()","user_name":"ä½œè€…å›å¤","user_name_real":"Nate","uid":"1018676","ctime":1623082211,"ip_address":"","comment_id":296494,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1623006821","product_id":100079901,"comment_content":"useSingleton æ˜¯ä¸æ˜¯å¯ä»¥ç›´æ¥ `useRef(callback())`","like_count":0,"discussions":[{"author":{"id":1018676,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/34/61035278.jpg","nickname":"Nate","note":"","ucode":"844B4C20BB3D6E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521461,"discussion_content":"ä¸è¡Œå“¦ï¼Œè¿™æ ·æ¯æ¬¡éƒ½ä¼šæ‰§è¡Œ callback()","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623082211,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295971,"user_name":"æµ©ç„¶","can_delete":false,"product_type":"c1","uid":1378201,"ip_address":"","ucode":"FC771E92869796","user_header":"https://static001.geekbang.org/account/avatar/00/15/07/99/2c12c56c.jpg","comment_is_top":false,"comment_ctime":1622686556,"is_pvip":false,"replies":[{"id":"107462","content":"æ­£ç¡®ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"Nate","uid":"1018676","ctime":1622727935,"ip_address":"","comment_id":295971,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1622686556","product_id":100079901,"comment_content":"useEffect(() =&gt; {<br>    return () =&gt; {<br>        &#47;&#47; ç»„ä»¶é”€æ¯æ—¶æ‰§è¡Œ<br>    }<br>}, [])","like_count":0,"discussions":[{"author":{"id":1018676,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/34/61035278.jpg","nickname":"Nate","note":"","ucode":"844B4C20BB3D6E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521281,"discussion_content":"æ­£ç¡®ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622727935,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}