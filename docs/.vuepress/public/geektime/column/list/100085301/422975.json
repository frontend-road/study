{"id":422975,"title":"16ï½œæ•°æ®ç»“æ„ï¼šVec<T>ã€&[T]ã€Box<[T]> ï¼Œä½ çœŸçš„äº†è§£é›†åˆå®¹å™¨ä¹ˆï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é™ˆå¤©ã€‚ä»Šå¤©æ¥å­¦é›†åˆå®¹å™¨ã€‚</p><p>ç°åœ¨æˆ‘ä»¬æ¥è§¦åˆ°äº†è¶Šæ¥è¶Šå¤šçš„æ•°æ®ç»“æ„ï¼Œæˆ‘æŠŠ Rust ä¸­ä¸»è¦çš„æ•°æ®ç»“æ„ä»åŸç”Ÿç±»å‹ã€å®¹å™¨ç±»å‹å’Œç³»ç»Ÿç›¸å…³ç±»å‹å‡ ä¸ªç»´åº¦æ•´ç†ä¸€ä¸‹ï¼Œä½ å¯ä»¥æ•°æ•°è‡ªå·±æŒæ¡äº†å“ªäº›ã€‚<br>\n<img src=\"https://static001.geekbang.org/resource/image/d9/4c/d9c1d7ce878b5ef17eb1c8c69e17404c.jpg?wh=2364x1718\" alt=\"\"><br>\nå¯ä»¥çœ‹åˆ°ï¼Œå®¹å™¨å æ®äº†æ•°æ®ç»“æ„çš„åŠå£æ±Ÿå±±ã€‚</p><p>æåˆ°å®¹å™¨ï¼Œå¾ˆå¯èƒ½ä½ é¦–å…ˆä¼šæƒ³åˆ°çš„å°±æ˜¯æ•°ç»„ã€åˆ—è¡¨è¿™äº›å¯ä»¥éå†çš„å®¹å™¨ï¼Œä½†å…¶å®<strong>åªè¦æŠŠæŸç§ç‰¹å®šçš„æ•°æ®å°è£…åœ¨æŸä¸ªæ•°æ®ç»“æ„ä¸­</strong>ï¼Œè¿™ä¸ªæ•°æ®ç»“æ„å°±æ˜¯ä¸€ä¸ªå®¹å™¨ã€‚æ¯”å¦‚ Option&lt;T&gt;ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒ…è£¹äº† T å­˜åœ¨æˆ–ä¸å­˜åœ¨çš„å®¹å™¨ï¼Œè€ŒCow æ˜¯ä¸€ä¸ªå°è£…äº†å†…éƒ¨æ•°æ® B æˆ–è¢«å€Ÿç”¨æˆ–æ‹¥æœ‰æ‰€æœ‰æƒçš„å®¹å™¨ã€‚</p><p>å¯¹äºå®¹å™¨çš„ä¸¤å°ç±»ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œåƒ Cow è¿™æ ·ï¼Œä¸ºç‰¹å®šç›®çš„è€Œäº§ç”Ÿçš„å®¹å™¨æˆ‘ä»¬å·²ç»ä»‹ç»äº†ä¸å°‘ï¼ŒåŒ…æ‹¬ Boxã€Rcã€Arcã€RefCellã€è¿˜æ²¡è®²åˆ°çš„ Option å’Œ Result ç­‰ã€‚</p><p>ä»Šå¤©æˆ‘ä»¬æ¥è¯¦ç»†è®²è®²å¦ä¸€ç±»ï¼Œé›†åˆå®¹å™¨ã€‚</p><h2>é›†åˆå®¹å™¨</h2><p>é›†åˆå®¹å™¨ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æŠŠä¸€ç³»åˆ—æ‹¥æœ‰ç›¸åŒç±»å‹çš„æ•°æ®æ”¾åœ¨ä¸€èµ·ï¼Œç»Ÿä¸€å¤„ç†ï¼Œæ¯”å¦‚ï¼š</p><ul>\n<li>æˆ‘ä»¬ç†Ÿæ‚‰çš„å­—ç¬¦ä¸² Stringã€æ•°ç»„ [T; n]ã€åˆ—è¡¨ Vec&lt;T&gt;å’Œå“ˆå¸Œè¡¨ HashMap&lt;K, V&gt;ç­‰ï¼›</li>\n<li>è™½ç„¶åˆ°å¤„åœ¨ä½¿ç”¨ï¼Œä½†è¿˜å¹¶ä¸ç†Ÿæ‚‰çš„åˆ‡ç‰‡ sliceï¼›</li>\n<li>åœ¨å…¶ä»–è¯­è¨€ä¸­ä½¿ç”¨è¿‡ï¼Œä½†åœ¨ Rust ä¸­è¿˜æ²¡æœ‰ç”¨è¿‡çš„å¾ªç¯ç¼“å†²åŒº VecDeque&lt;T&gt;ã€åŒå‘åˆ—è¡¨ LinkedList&lt;T&gt; ç­‰ã€‚</li>\n</ul><!-- [[[read_end]]] --><p>è¿™äº›é›†åˆå®¹å™¨æœ‰å¾ˆå¤šå…±æ€§ï¼Œæ¯”å¦‚å¯ä»¥è¢«éå†ã€å¯ä»¥è¿›è¡Œ map-reduce æ“ä½œã€å¯ä»¥ä»ä¸€ç§ç±»å‹è½¬æ¢æˆå¦ä¸€ç§ç±»å‹ç­‰ç­‰ã€‚</p><p>æˆ‘ä»¬ä¼šé€‰å–ä¸¤ç±»å…¸å‹çš„é›†åˆå®¹å™¨ï¼šåˆ‡ç‰‡å’Œå“ˆå¸Œè¡¨ï¼Œæ·±å…¥è§£è¯»ï¼Œç†è§£äº†è¿™ä¸¤ç±»å®¹å™¨ï¼Œå…¶å®ƒçš„é›†åˆå®¹å™¨è®¾è®¡æ€è·¯éƒ½å·®ä¸å¤šï¼Œå¹¶ä¸éš¾å­¦ä¹ ã€‚ä»Šå¤©å…ˆä»‹ç»åˆ‡ç‰‡ä»¥åŠå’Œåˆ‡ç‰‡ç›¸å…³çš„å®¹å™¨ï¼Œä¸‹ä¸€è®²æˆ‘ä»¬å­¦ä¹ å“ˆå¸Œè¡¨ã€‚</p><h2>åˆ‡ç‰‡ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>åœ¨ Rust é‡Œï¼Œåˆ‡ç‰‡æ˜¯æè¿°ä¸€ç»„å±äºåŒä¸€ç±»å‹ã€é•¿åº¦ä¸ç¡®å®šçš„ã€åœ¨å†…å­˜ä¸­è¿ç»­å­˜æ”¾çš„æ•°æ®ç»“æ„ï¼Œç”¨ [T] æ¥è¡¨è¿°ã€‚å› ä¸ºé•¿åº¦ä¸ç¡®å®šï¼Œæ‰€ä»¥åˆ‡ç‰‡æ˜¯ä¸ª DSTï¼ˆDynamically Sized Typeï¼‰ã€‚</p><p>åˆ‡ç‰‡ä¸€èˆ¬åªå‡ºç°åœ¨æ•°æ®ç»“æ„çš„å®šä¹‰ä¸­ï¼Œä¸èƒ½ç›´æ¥è®¿é—®ï¼Œåœ¨ä½¿ç”¨ä¸­ä¸»è¦ç”¨ä»¥ä¸‹å½¢å¼ï¼š</p><ul>\n<li>&amp;[T]ï¼šè¡¨ç¤ºä¸€ä¸ªåªè¯»çš„åˆ‡ç‰‡å¼•ç”¨ã€‚</li>\n<li>&amp;mut [T]ï¼šè¡¨ç¤ºä¸€ä¸ªå¯å†™çš„åˆ‡ç‰‡å¼•ç”¨ã€‚</li>\n<li>Box&lt;[T]&gt;ï¼šä¸€ä¸ªåœ¨å †ä¸Šåˆ†é…çš„åˆ‡ç‰‡ã€‚</li>\n</ul><p>æ€ä¹ˆç†è§£åˆ‡ç‰‡å‘¢ï¼Ÿæˆ‘æ‰“ä¸ªæ¯”æ–¹ï¼Œ<strong>åˆ‡ç‰‡ä¹‹äºå…·ä½“çš„æ•°æ®ç»“æ„ï¼Œå°±åƒæ•°æ®åº“ä¸­çš„è§†å›¾ä¹‹äºè¡¨</strong>ã€‚ä½ å¯ä»¥æŠŠå®ƒçœ‹æˆä¸€ç§å·¥å…·ï¼Œè®©æˆ‘ä»¬å¯ä»¥ç»Ÿä¸€è®¿é—®è¡Œä¸ºç›¸åŒã€ç»“æ„ç±»ä¼¼ä½†æœ‰äº›è®¸å·®å¼‚çš„ç±»å‹ã€‚</p><p>æ¥çœ‹ä¸‹é¢çš„<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=73d5c0dd98f17a31a8e9bf914eb5ea2f\">ä»£ç </a>ï¼Œè¾…åŠ©ç†è§£ï¼š</p><pre><code class=\"language-rust\">fn main() {\n    let arr = [1, 2, 3, 4, 5];\n    let vec = vec![1, 2, 3, 4, 5];\n    let s1 = &amp;arr[..2];\n    let s2 = &amp;vec[..2];\n    println!(\"s1: {:?}, s2: {:?}\", s1, s2);\n\n    // &amp;[T] å’Œ &amp;[T] æ˜¯å¦ç›¸ç­‰å–å†³äºé•¿åº¦å’Œå†…å®¹æ˜¯å¦ç›¸ç­‰\n    assert_eq!(s1, s2);\n    // &amp;[T] å¯ä»¥å’Œ Vec&lt;T&gt;/[T;n] æ¯”è¾ƒï¼Œä¹Ÿä¼šçœ‹é•¿åº¦å’Œå†…å®¹\n    assert_eq!(&amp;arr[..], vec);\n    assert_eq!(&amp;vec[..], arr);\n}\n</code></pre><p>å¯¹äº array å’Œ vectorï¼Œè™½ç„¶æ˜¯ä¸åŒçš„æ•°æ®ç»“æ„ï¼Œä¸€ä¸ªæ”¾åœ¨æ ˆä¸Šï¼Œä¸€ä¸ªæ”¾åœ¨å †ä¸Šï¼Œä½†å®ƒä»¬çš„åˆ‡ç‰‡æ˜¯ç±»ä¼¼çš„ï¼›è€Œä¸”å¯¹äºç›¸åŒå†…å®¹æ•°æ®çš„ç›¸åŒåˆ‡ç‰‡ï¼Œæ¯”å¦‚ &amp;arr[1â€¦3] å’Œ &amp;vec[1â€¦3]ï¼Œè¿™ä¸¤è€…æ˜¯ç­‰ä»·çš„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåˆ‡ç‰‡å’Œå¯¹åº”çš„æ•°æ®ç»“æ„ä¹Ÿå¯ä»¥ç›´æ¥æ¯”è¾ƒï¼Œè¿™æ˜¯å› ä¸ºå®ƒä»¬ä¹‹é—´å®ç°äº† PartialEq traitï¼ˆ<a href=\"https://doc.rust-lang.org/std/vec/struct.Vec.html#impl-PartialEq%3C%26%27_%20%5BU%5D%3E\">æºç å‚è€ƒèµ„æ–™</a>ï¼‰ã€‚</p><p>ä¸‹å›¾æ¯”è¾ƒæ¸…æ™°åœ°å‘ˆç°äº†åˆ‡ç‰‡å’Œæ•°æ®ä¹‹é—´çš„å…³ç³»ï¼š<img src=\"https://static001.geekbang.org/resource/image/79/b2/798cd47df85772e243b6af4ba17f18b2.jpg?wh=2364x1422\" alt=\"\"></p><p>å¦å¤–åœ¨ Rust ä¸‹ï¼Œåˆ‡ç‰‡æ—¥å¸¸ä¸­éƒ½æ˜¯ä½¿ç”¨å¼•ç”¨ &amp;[T]ï¼Œæ‰€ä»¥å¾ˆå¤šåŒå­¦å®¹æ˜“æä¸æ¸…æ¥š &amp;[T] å’Œ &amp;Vec&lt;T&gt; çš„åŒºåˆ«ã€‚æˆ‘ç”»äº†å¼ å›¾ï¼Œå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£å®ƒä»¬çš„å…³ç³»ï¼š<img src=\"https://static001.geekbang.org/resource/image/91/b7/91b4f63c619bf35cf2e5fc22c6d486b7.jpg?wh=2364x1422\" alt=\"\"></p><p>åœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œæ”¯æŒåˆ‡ç‰‡çš„å…·ä½“æ•°æ®ç±»å‹ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦ï¼Œè§£å¼•ç”¨è½¬æ¢æˆåˆ‡ç‰‡ç±»å‹ã€‚æ¯”å¦‚ Vec&lt;T&gt; å’Œ [T; n] ä¼šè½¬åŒ–æˆä¸º &amp;[T]ï¼Œè¿™æ˜¯å› ä¸º Vec&lt;T&gt; å®ç°äº† Deref traitï¼Œè€Œ array å†…å»ºäº†åˆ° &amp;[T] çš„è§£å¼•ç”¨ã€‚æˆ‘ä»¬å¯ä»¥å†™ä¸€æ®µä»£ç éªŒè¯è¿™ä¸€è¡Œä¸ºï¼ˆ<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=984d9ee43c82f3774798f16c9176761e\">ä»£ç </a>ï¼‰ï¼š</p><pre><code class=\"language-rust\">use std::fmt;\nfn main() {\n    let v = vec![1, 2, 3, 4];\n\n    // Vec å®ç°äº† Derefï¼Œ&amp;Vec&lt;T&gt; ä¼šè¢«è‡ªåŠ¨è§£å¼•ç”¨ä¸º &amp;[T]ï¼Œç¬¦åˆæ¥å£å®šä¹‰\n    print_slice(&amp;v);\n    // ç›´æ¥æ˜¯ &amp;[T]ï¼Œç¬¦åˆæ¥å£å®šä¹‰\n    print_slice(&amp;v[..]);\n\n    // &amp;Vec&lt;T&gt; æ”¯æŒ AsRef&lt;[T]&gt;\n    print_slice1(&amp;v);\n    // &amp;[T] æ”¯æŒ AsRef&lt;[T]&gt;\n    print_slice1(&amp;v[..]);\n    // Vec&lt;T&gt; ä¹Ÿæ”¯æŒ AsRef&lt;[T]&gt;\n    print_slice1(v);\n\n    let arr = [1, 2, 3, 4];\n    // æ•°ç»„è™½æ²¡æœ‰å®ç° Derefï¼Œä½†å®ƒçš„è§£å¼•ç”¨å°±æ˜¯ &amp;[T]\n    print_slice(&amp;arr);\n    print_slice(&amp;arr[..]);\n    print_slice1(&amp;arr);\n    print_slice1(&amp;arr[..]);\n    print_slice1(arr);\n}\n\n// æ³¨æ„ä¸‹é¢çš„æ³›å‹å‡½æ•°çš„ä½¿ç”¨\nfn print_slice&lt;T: fmt::Debug&gt;(s: &amp;[T]) {\n    println!(\"{:?}\", s);\n}\n\nfn print_slice1&lt;T, U&gt;(s: T)\nwhere\n    T: AsRef&lt;[U]&gt;,\n    U: fmt::Debug,\n{\n    println!(\"{:?}\", s.as_ref());\n}\n</code></pre><p>è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œé€šè¿‡è§£å¼•ç”¨ï¼Œè¿™å‡ ä¸ªå’Œåˆ‡ç‰‡æœ‰å…³çš„æ•°æ®ç»“æ„éƒ½ä¼šè·å¾—åˆ‡ç‰‡çš„æ‰€æœ‰èƒ½åŠ›ï¼ŒåŒ…æ‹¬ï¼šbinary_searchã€chunksã€concatã€containsã€start_withã€end_withã€group_byã€iterã€joinã€sortã€splitã€swap ç­‰ä¸€ç³»åˆ—ä¸°å¯Œçš„åŠŸèƒ½ï¼Œæ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥çœ‹<a href=\"https://doc.rust-lang.org/std/primitive.slice.html\">åˆ‡ç‰‡çš„æ–‡æ¡£</a>ã€‚</p><h2>åˆ‡ç‰‡å’Œè¿­ä»£å™¨ Iterator</h2><p>è¿­ä»£å™¨å¯ä»¥è¯´æ˜¯åˆ‡ç‰‡çš„å­ªç”Ÿå…„å¼Ÿã€‚<strong>åˆ‡ç‰‡æ˜¯é›†åˆæ•°æ®çš„è§†å›¾ï¼Œè€Œè¿­ä»£å™¨å®šä¹‰äº†å¯¹é›†åˆæ•°æ®çš„å„ç§å„æ ·çš„è®¿é—®æ“ä½œ</strong>ã€‚</p><p>é€šè¿‡åˆ‡ç‰‡çš„ <a href=\"https://doc.rust-lang.org/std/primitive.slice.html#method.iter\">iter() æ–¹æ³•</a>ï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿæˆä¸€ä¸ªè¿­ä»£å™¨ï¼Œå¯¹åˆ‡ç‰‡è¿›è¡Œè¿­ä»£ã€‚</p><p>åœ¨<a href=\"https://time.geekbang.org/column/article/420021\">ç¬¬12è®²</a>Rustç±»å‹æ¨å¯¼å·²ç»è§è¿‡äº† iterator traitï¼ˆç”¨ <code>collect</code> æ–¹æ³•æŠŠè¿‡æ»¤å‡ºæ¥çš„æ•°æ®å½¢æˆæ–°åˆ—è¡¨ï¼‰ã€‚iterator trait æœ‰å¤§é‡çš„æ–¹æ³•ï¼Œä½†ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦å®šä¹‰å®ƒçš„å…³è”ç±»å‹ Item å’Œ next() æ–¹æ³•ã€‚</p><ul>\n<li>Item å®šä¹‰äº†æ¯æ¬¡æˆ‘ä»¬ä»è¿­ä»£å™¨ä¸­å–å‡ºçš„æ•°æ®ç±»å‹ï¼›</li>\n<li>next() æ˜¯ä»è¿­ä»£å™¨é‡Œå–ä¸‹ä¸€ä¸ªå€¼çš„æ–¹æ³•ã€‚å½“ä¸€ä¸ªè¿­ä»£å™¨çš„ next() æ–¹æ³•è¿”å› None æ—¶ï¼Œè¡¨æ˜è¿­ä»£å™¨ä¸­æ²¡æœ‰æ•°æ®äº†ã€‚</li>\n</ul><pre><code class=\"language-rust\">#[must_use = \"iterators are lazy and do nothing unless consumed\"]\npub trait Iterator {\n    type Item;\n    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt;;\n    // å¤§é‡ç¼ºçœçš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ size_hint, count, chain, zip, map, \n    // filter, for_each, skip, take_while, flat_map, flatten\n    // collect, partition ç­‰\n\t\t... \n}\n</code></pre><p>çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå¯¹ Vec&lt;T&gt; ä½¿ç”¨ iter() æ–¹æ³•ï¼Œå¹¶è¿›è¡Œå„ç§ map / filter / take æ“ä½œã€‚åœ¨å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œè¿™æ ·çš„å†™æ³•å¾ˆå¸¸è§ï¼Œä»£ç çš„å¯è¯»æ€§å¾ˆå¼ºã€‚Rust ä¹Ÿæ”¯æŒè¿™ç§å†™æ³•ï¼ˆ<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=64917cb8aae8e8476a8fdf21c81d6810\">ä»£ç </a>ï¼‰ï¼š</p><pre><code class=\"language-rust\">fn main() {\n    // è¿™é‡Œ Vec&lt;T&gt; åœ¨è°ƒç”¨ iter() æ—¶è¢«è§£å¼•ç”¨æˆ &amp;[T]ï¼Œæ‰€ä»¥å¯ä»¥è®¿é—® iter()\n    let result = vec![1, 2, 3, 4]\n        .iter()\n        .map(|v| v * v)\n        .filter(|v| *v &lt; 16)\n        .take(1)\n        .collect::&lt;Vec&lt;_&gt;&gt;();\n\n    println!(\"{:?}\", result);\n}\n</code></pre><p>éœ€è¦æ³¨æ„çš„æ˜¯ Rust ä¸‹çš„è¿­ä»£å™¨æ˜¯ä¸ªæ‡’æ¥å£ï¼ˆlazy interfaceï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>è¿™æ®µä»£ç ç›´åˆ°è¿è¡Œåˆ° collect æ—¶æ‰çœŸæ­£å¼€å§‹æ‰§è¡Œï¼Œä¹‹å‰çš„éƒ¨åˆ†ä¸è¿‡æ˜¯åœ¨ä¸æ–­åœ°ç”Ÿæˆæ–°çš„ç»“æ„</strong>ï¼Œæ¥ç´¯ç§¯å¤„ç†é€»è¾‘è€Œå·²ã€‚ä½ å¯èƒ½å¥½å¥‡ï¼Œè¿™æ˜¯æ€ä¹ˆåšåˆ°çš„å‘¢ï¼Ÿ</p><p>åœ¨ VS Code é‡Œï¼Œå¦‚æœä½ ä½¿ç”¨äº† rust-analyzer æ’ä»¶ï¼Œå°±å¯ä»¥å‘ç°è¿™ä¸€å¥¥ç§˜ï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/49/3b/49b8692d2b03df66c0e4e02390a4153b.png?wh=1658x582\" alt=\"\"></p><p>åŸæ¥ï¼ŒIterator å¤§éƒ¨åˆ†æ–¹æ³•éƒ½è¿”å›ä¸€ä¸ªå®ç°äº† Iterator çš„æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥å¯ä»¥è¿™æ ·ä¸€è·¯é“¾å¼ä¸‹å»ï¼Œåœ¨ Rust æ ‡å‡†åº“ä¸­ï¼Œè¿™äº›æ•°æ®ç»“æ„è¢«ç§°ä¸º <a href=\"https://doc.rust-lang.org/src/core/iter/adapters/mod.rs.html\">Iterator Adapter</a>ã€‚æ¯”å¦‚ä¸Šé¢çš„ map æ–¹æ³•ï¼Œå®ƒè¿”å› Map ç»“æ„ï¼Œè€Œ Map ç»“æ„å®ç°äº† Iteratorï¼ˆ<a href=\"https://doc.rust-lang.org/src/core/iter/adapters/map.rs.html#93-133\">æºç </a>ï¼‰ã€‚</p><p>æ•´ä¸ªè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼ˆé“¾æ¥å‡ä¸ºæºç èµ„æ–™ï¼‰ï¼š</p><ul>\n<li>åœ¨ collect() æ‰§è¡Œçš„æ—¶å€™ï¼Œå®ƒå®é™…<a href=\"https://doc.rust-lang.org/src/core/iter/traits/iterator.rs.html#1744-1749\">è¯•å›¾ä½¿ç”¨ FromIterator ä»è¿­ä»£å™¨ä¸­æ„å»ºä¸€ä¸ªé›†åˆç±»å‹</a>ï¼Œè¿™ä¼šä¸æ–­è°ƒç”¨ next() è·å–ä¸‹ä¸€ä¸ªæ•°æ®ï¼›</li>\n<li>æ­¤æ—¶çš„ Iterator æ˜¯ Takeï¼ŒTake è°ƒè‡ªå·±çš„ next()ï¼Œä¹Ÿå°±æ˜¯å®ƒä¼š<a href=\"https://doc.rust-lang.org/src/core/iter/adapters/take.rs.html#34-41\">è°ƒç”¨ Filter çš„ next()</a>ï¼›</li>\n<li>Filter çš„ next() å®é™…ä¸Š<a href=\"https://doc.rust-lang.org/src/core/iter/adapters/filter.rs.html#55-57\">è°ƒç”¨è‡ªå·±å†…éƒ¨çš„ iter çš„ find()</a>ï¼Œæ­¤æ—¶å†…éƒ¨çš„ iter æ˜¯ Mapï¼Œfind() ä¼š<a href=\"https://doc.rust-lang.org/src/core/iter/traits/iterator.rs.html#2312-2325\">ä½¿ç”¨ try_fold()</a>ï¼Œå®ƒä¼š<a href=\"https://doc.rust-lang.org/src/core/iter/traits/iterator.rs.html#2382-2406\">ç»§ç»­è°ƒç”¨ next()</a>ï¼Œä¹Ÿå°±æ˜¯ Map çš„ next()ï¼›</li>\n<li>Map çš„ next() ä¼š<a href=\"https://doc.rust-lang.org/src/core/iter/adapters/map.rs.html#100-102\">è°ƒç”¨å…¶å†…éƒ¨çš„ iter å– next() ç„¶åæ‰§è¡Œ map å‡½æ•°</a>ã€‚è€Œæ­¤æ—¶å†…éƒ¨çš„ iter æ¥è‡ª Vec&lt;i32&gt;ã€‚</li>\n</ul><p>æ‰€ä»¥ï¼Œåªæœ‰åœ¨ collect() æ—¶ï¼Œæ‰è§¦å‘ä»£ç ä¸€å±‚å±‚è°ƒç”¨ä¸‹å»ï¼Œå¹¶ä¸”è°ƒç”¨ä¼šæ ¹æ®éœ€è¦éšæ—¶ç»“æŸã€‚è¿™æ®µä»£ç ä¸­æˆ‘ä»¬ä½¿ç”¨äº† take(1)ï¼Œæ•´ä¸ªè°ƒç”¨é“¾å¾ªç¯ä¸€æ¬¡ï¼Œå°±èƒ½æ»¡è¶³ take(1) ä»¥åŠæ‰€æœ‰ä¸­é—´è¿‡ç¨‹çš„è¦æ±‚ï¼Œæ‰€ä»¥å®ƒåªä¼šå¾ªç¯ä¸€æ¬¡ã€‚</p><p>ä½ å¯èƒ½ä¼šæœ‰ç–‘æƒ‘ï¼šè¿™ç§å‡½æ•°å¼ç¼–ç¨‹çš„å†™æ³•ï¼Œä»£ç æ˜¯æ¼‚äº®äº†ï¼Œç„¶è€Œè¿™ä¹ˆå¤šæ— è°“çš„å‡½æ•°è°ƒç”¨ï¼Œæ€§èƒ½è‚¯å®šå¾ˆå·®å§ï¼Ÿæ¯•ç«Ÿï¼Œå‡½æ•°å¼ç¼–ç¨‹è¯­è¨€çš„ä¸€å¤§æ¶åå°±æ˜¯æ€§èƒ½å·®ã€‚</p><p>è¿™ä¸ªä½ å®Œå…¨ä¸ç”¨æ‹…å¿ƒï¼Œ Rust å¤§é‡ä½¿ç”¨äº† inline ç­‰ä¼˜åŒ–æŠ€å·§ï¼Œè¿™æ ·éå¸¸æ¸…æ™°å‹å¥½çš„è¡¨è¾¾æ–¹å¼ï¼Œæ€§èƒ½å’Œ C è¯­è¨€çš„ for å¾ªç¯å·®åˆ«ä¸å¤§ã€‚å¦‚æœä½ å¯¹æ€§èƒ½å¯¹æ¯”æ„Ÿå…´è¶£ï¼Œå¯ä»¥å»æœ€åçš„å‚è€ƒèµ„æ–™åŒºçœ‹çœ‹ã€‚</p><p>ä»‹ç»å®Œæ˜¯ä»€ä¹ˆï¼ŒæŒ‰æƒ¯ä¾‹æˆ‘ä»¬å°±è¦ä¸Šä»£ç å®é™…ä½¿ç”¨ä¸€ä¸‹äº†ã€‚ä¸è¿‡è¿­ä»£å™¨æ˜¯éå¸¸é‡è¦çš„ä¸€ä¸ªåŠŸèƒ½ï¼ŒåŸºæœ¬ä¸Šæ¯ç§è¯­è¨€éƒ½æœ‰å¯¹è¿­ä»£å™¨çš„å®Œæ•´æ”¯æŒï¼Œæ‰€ä»¥åªè¦ä½ ä¹‹å‰ç”¨è¿‡ï¼Œå¯¹æ­¤åº”è¯¥å¹¶ä¸é™Œç”Ÿï¼Œå¤§éƒ¨åˆ†çš„æ–¹æ³•ï¼Œä½ ä¸€çœ‹å°±èƒ½æ˜ç™½æ˜¯åœ¨åšä»€ä¹ˆã€‚æ‰€ä»¥è¿™é‡Œå°±ä¸å†é¢å¤–å±•ç¤ºï¼Œç­‰ä½ é‡åˆ°å…·ä½“éœ€æ±‚æ—¶ï¼Œå¯ä»¥ç¿» <a href=\"https://doc.rust-lang.org/std/iter/trait.Iterator.html\">Iterator çš„æ–‡æ¡£</a>æŸ¥é˜…ã€‚</p><p>å¦‚æœæ ‡å‡†åº“ä¸­çš„åŠŸèƒ½è¿˜ä¸èƒ½æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œä½ å¯ä»¥çœ‹çœ‹ <a href=\"https://docs.rs/itertools/0.10.1/itertools/trait.Itertools.html\">itertools</a>ï¼Œå®ƒæ˜¯å’Œ Python ä¸‹ itertools åŒåä¸”åŠŸèƒ½ç±»ä¼¼çš„å·¥å…·ï¼Œæä¾›äº†å¤§é‡é¢å¤–çš„ adapterã€‚å¯ä»¥çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼ˆ<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=b32253334d886a5ccd263f9870fb8a3d\">ä»£ç </a>ï¼‰ï¼š</p><pre><code class=\"language-rust\">use itertools::Itertools;\n\nfn main() {\n    let err_str = \"bad happened\";\n    let input = vec![Ok(21), Err(err_str), Ok(7)];\n    let it = input\n        .into_iter()\n        .filter_map_ok(|i| if i &gt; 10 { Some(i * 2) } else { None });\n    // ç»“æœåº”è¯¥æ˜¯ï¼švec![Ok(42), Err(err_str)]\n    println!(\"{:?}\", it.collect::&lt;Vec&lt;_&gt;&gt;());\n}\n</code></pre><p>åœ¨å®é™…å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½ä»ä¸€ç»„ Future ä¸­æ±‡èšå‡ºä¸€ç»„ç»“æœï¼Œé‡Œé¢æœ‰æˆåŠŸæ‰§è¡Œçš„ç»“æœï¼Œä¹Ÿæœ‰å¤±è´¥çš„é”™è¯¯ä¿¡æ¯ã€‚å¦‚æœæƒ³å¯¹æˆåŠŸçš„ç»“æœè¿›ä¸€æ­¥åš filter/mapï¼Œé‚£ä¹ˆæ ‡å‡†åº“å°±æ— æ³•å¸®å¿™äº†ï¼Œå°±éœ€è¦ç”¨ itertools é‡Œçš„ filter_map_ok()ã€‚</p><h2>ç‰¹æ®Šçš„åˆ‡ç‰‡ï¼š&amp;str</h2><p>å¥½ï¼Œå­¦å®Œäº†æ™®é€šçš„åˆ‡ç‰‡ &amp;[T]ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ç§ç‰¹æ®Šçš„åˆ‡ç‰‡ï¼š&amp;strã€‚ä¹‹å‰è®²è¿‡ï¼ŒString æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ Vec&lt;u8&gt;ï¼Œæ‰€ä»¥åœ¨ String ä¸Šåšåˆ‡ç‰‡ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ç»“æ„ &amp;strã€‚</p><p>å¯¹äº Stringã€&amp;Stringã€&amp;strï¼Œå¾ˆå¤šäººä¹Ÿç»å¸¸åˆ†ä¸æ¸…å®ƒä»¬çš„åŒºåˆ«ï¼Œæˆ‘ä»¬åœ¨ä¹‹å‰çš„ä¸€ç¯‡åŠ é¤ä¸­ç®€å•èŠäº†è¿™ä¸ªé—®é¢˜ï¼Œåœ¨ä¸Šä¸€è®²æ™ºèƒ½æŒ‡é’ˆä¸­ï¼Œä¹Ÿå¯¹æ¯”è¿‡Stringå’Œ&amp;strã€‚å¯¹äº&amp;String å’Œ &amp;strï¼Œå¦‚æœä½ ç†è§£äº†ä¸Šæ–‡ä¸­ &amp;Vec&lt;T&gt; å’Œ &amp;[T] çš„åŒºåˆ«ï¼Œé‚£ä¹ˆå®ƒä»¬ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼š<img src=\"https://static001.geekbang.org/resource/image/ea/0a/ea816d6fbdd1d14b00bb6ea6c7ef3a0a.jpg?wh=2364x1422\" alt=\"\"></p><p><strong>String åœ¨è§£å¼•ç”¨æ—¶ï¼Œä¼šè½¬æ¢æˆ &amp;str</strong>ã€‚å¯ä»¥ç”¨ä¸‹é¢çš„ä»£ç éªŒè¯ï¼ˆ<a href=\"https://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=fc4ceb67d2da2e99e11c390f4ce6317d\">ä»£ç </a>ï¼‰ï¼š</p><pre><code class=\"language-rust\">use std::fmt;\nfn main() {\n    let s = String::from(\"hello\");\n    // &amp;String ä¼šè¢«è§£å¼•ç”¨æˆ &amp;str\n    print_slice(&amp;s);\n    // &amp;s[..] å’Œ s.as_str() ä¸€æ ·ï¼Œéƒ½ä¼šå¾—åˆ° &amp;str\n    print_slice(&amp;s[..]);\n\n    // String æ”¯æŒ AsRef&lt;str&gt;\n    print_slice1(&amp;s);\n    print_slice1(&amp;s[..]);\n    print_slice1(s.clone());\n\n    // String ä¹Ÿå®ç°äº† AsRef&lt;[u8]&gt;ï¼Œæ‰€ä»¥ä¸‹é¢çš„ä»£ç æˆç«‹\n    // æ‰“å°å‡ºæ¥æ˜¯ [104, 101, 108, 108, 111]\n    print_slice2(&amp;s);\n    print_slice2(&amp;s[..]);\n    print_slice2(s);\n}\n\nfn print_slice(s: &amp;str) {\n    println!(\"{:?}\", s);\n}\n\nfn print_slice1&lt;T: AsRef&lt;str&gt;&gt;(s: T) {\n    println!(\"{:?}\", s.as_ref());\n}\n\nfn print_slice2&lt;T, U&gt;(s: T)\nwhere\n    T: AsRef&lt;[U]&gt;,\n    U: fmt::Debug,\n{\n    println!(\"{:?}\", s.as_ref());\n}\n</code></pre><p>æœ‰åŒå­¦ä¼šæœ‰ç–‘é—®ï¼šé‚£ä¹ˆå­—ç¬¦çš„åˆ—è¡¨å’Œå­—ç¬¦ä¸²æœ‰ä»€ä¹ˆå…³ç³»å’ŒåŒºåˆ«ï¼Ÿæˆ‘ä»¬ç›´æ¥å†™ä¸€æ®µä»£ç æ¥çœ‹çœ‹ï¼š</p><pre><code class=\"language-rust\">use std::iter::FromIterator;\n\nfn main() {\n    let arr = ['h', 'e', 'l', 'l', 'o'];\n    let vec = vec!['h', 'e', 'l', 'l', 'o'];\n    let s = String::from(\"hello\");\n    let s1 = &amp;arr[1..3];\n    let s2 = &amp;vec[1..3];\n    // &amp;str æœ¬èº«å°±æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„ slice\n    let s3 = &amp;s[1..3];\n    println!(\"s1: {:?}, s2: {:?}, s3: {:?}\", s1, s2, s3);\n\n    // &amp;[char] å’Œ &amp;[char] æ˜¯å¦ç›¸ç­‰å–å†³äºé•¿åº¦å’Œå†…å®¹æ˜¯å¦ç›¸ç­‰\n    assert_eq!(s1, s2);\n    // &amp;[char] å’Œ &amp;str ä¸èƒ½ç›´æ¥å¯¹æ¯”ï¼Œæˆ‘ä»¬æŠŠ s3 å˜æˆ Vec&lt;char&gt;\n    assert_eq!(s2, s3.chars().collect::&lt;Vec&lt;_&gt;&gt;());\n    // &amp;[char] å¯ä»¥é€šè¿‡è¿­ä»£å™¨è½¬æ¢æˆ Stringï¼ŒString å’Œ &amp;str å¯ä»¥ç›´æ¥å¯¹æ¯”\n    assert_eq!(String::from_iter(s2), s3);\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œå­—ç¬¦åˆ—è¡¨å¯ä»¥é€šè¿‡è¿­ä»£å™¨è½¬æ¢æˆ Stringï¼ŒString ä¹Ÿå¯ä»¥é€šè¿‡ chars() å‡½æ•°è½¬æ¢æˆå­—ç¬¦åˆ—è¡¨ï¼Œå¦‚æœä¸è½¬æ¢ï¼ŒäºŒè€…ä¸èƒ½æ¯”è¾ƒã€‚</p><p>ä¸‹å›¾æˆ‘æŠŠæ•°ç»„ã€åˆ—è¡¨ã€å­—ç¬¦ä¸²ä»¥åŠå®ƒä»¬çš„åˆ‡ç‰‡æ”¾åœ¨ä¸€èµ·æ¯”è¾ƒï¼Œå¯ä»¥å¸®ä½ æ›´å¥½åœ°ç†è§£å®ƒä»¬çš„åŒºåˆ«ï¼š<img src=\"https://static001.geekbang.org/resource/image/e0/93/e05210d20yy4d20bf54e670e958a7a93.jpg?wh=2364x1422\" alt=\"\"></p><h2>åˆ‡ç‰‡çš„å¼•ç”¨å’Œå †ä¸Šçš„åˆ‡ç‰‡ï¼Œå®ƒä»¬æ˜¯ä¸€å›äº‹ä¹ˆï¼Ÿ</h2><p>å¼€å¤´æˆ‘ä»¬è®²è¿‡ï¼Œåˆ‡ç‰‡ä¸»è¦æœ‰ä¸‰ç§ä½¿ç”¨æ–¹å¼ï¼šåˆ‡ç‰‡çš„åªè¯»å¼•ç”¨ &amp;[T]ã€åˆ‡ç‰‡çš„å¯å˜å¼•ç”¨ &amp;mut [T] ä»¥åŠ Box&lt;[T]&gt;ã€‚åˆšæ‰å·²ç»è¯¦ç»†å­¦ä¹ äº†åªè¯»åˆ‡ç‰‡ &amp;[T]ï¼Œä¹Ÿå’Œå…¶ä»–å„ç§æ•°æ®ç»“æ„è¿›è¡Œäº†å¯¹æ¯”å¸®åŠ©ç†è§£ï¼Œå¯å˜åˆ‡ç‰‡ &amp;mut [T] å’Œå®ƒç±»ä¼¼ï¼Œä¸å¿…ä»‹ç»ã€‚</p><p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹ Box&lt;[T]&gt;ã€‚</p><p>Box&lt;[T]&gt; æ˜¯ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„å­˜åœ¨ï¼Œå®ƒå’Œ Vec&lt;T&gt; æœ‰ä¸€ç‚¹ç‚¹å·®åˆ«ï¼šVec&lt;T&gt; æœ‰é¢å¤–çš„ capacityï¼Œå¯ä»¥å¢é•¿ï¼›<strong>è€Œ Box&lt;[T]&gt; ä¸€æ—¦ç”Ÿæˆå°±å›ºå®šä¸‹æ¥ï¼Œæ²¡æœ‰ capacityï¼Œä¹Ÿæ— æ³•å¢é•¿</strong>ã€‚</p><p>Box&lt;[T]&gt;å’Œåˆ‡ç‰‡çš„å¼•ç”¨&amp;[T] ä¹Ÿå¾ˆç±»ä¼¼ï¼šå®ƒä»¬éƒ½æ˜¯åœ¨æ ˆä¸Šæœ‰ä¸€ä¸ªåŒ…å«é•¿åº¦çš„èƒ–æŒ‡é’ˆï¼ŒæŒ‡å‘å­˜å‚¨æ•°æ®çš„å†…å­˜ä½ç½®ã€‚åŒºåˆ«æ˜¯ï¼šBox&lt;[T]&gt; åªä¼šæŒ‡å‘å †ï¼Œ&amp;[T] æŒ‡å‘çš„ä½ç½®å¯ä»¥æ˜¯æ ˆä¹Ÿå¯ä»¥æ˜¯å †ï¼›æ­¤å¤–ï¼ŒBox&lt;[T]&gt; å¯¹æ•°æ®å…·æœ‰æ‰€æœ‰æƒï¼Œè€Œ &amp;[T] åªæ˜¯ä¸€ä¸ªå€Ÿç”¨ã€‚<img src=\"https://static001.geekbang.org/resource/image/a1/eb/a12b61b5e70a9a4625c071576f0717eb.jpg?wh=2364x1532\" alt=\"\"></p><p>é‚£ä¹ˆå¦‚ä½•äº§ç”Ÿ Box&lt;[T]&gt; å‘¢ï¼Ÿç›®å‰å¯ç”¨çš„æ¥å£å°±åªæœ‰ä¸€ä¸ªï¼šä»å·²æœ‰çš„ Vec&lt;T&gt; ä¸­è½¬æ¢ã€‚æˆ‘ä»¬çœ‹ä»£ç ï¼š</p><pre><code class=\"language-rust\">use std::ops::Deref;\n\nfn main() {\n    let mut v1 = vec![1, 2, 3, 4];\n    v1.push(5);\n    println!(\"cap should be 8: {}\", v1.capacity());\n\n    // ä» Vec&lt;T&gt; è½¬æ¢æˆ Box&lt;[T]&gt;ï¼Œæ­¤æ—¶ä¼šä¸¢å¼ƒå¤šä½™çš„ capacity\n    let b1 = v1.into_boxed_slice();\n    let mut b2 = b1.clone();\n\n    let v2 = b1.into_vec();\n    println!(\"cap should be exactly 5: {}\", v2.capacity());\n\n    assert!(b2.deref() == v2);\n\n    // Box&lt;[T]&gt; å¯ä»¥æ›´æ”¹å…¶å†…éƒ¨æ•°æ®ï¼Œä½†æ— æ³• push\n    b2[0] = 2;\n    // b2.push(6);\n    println!(\"b2: {:?}\", b2);\n\n    // æ³¨æ„ Box&lt;[T]&gt; å’Œ Box&lt;[T; n]&gt; å¹¶ä¸ç›¸åŒ\n    let b3 = Box::new([2, 2, 3, 4, 5]);\n    println!(\"b3: {:?}\", b3);\n\n    // b2 å’Œ b3 ç›¸ç­‰ï¼Œä½† b3.deref() å’Œ v2 æ— æ³•æ¯”è¾ƒ\n    assert!(b2 == b3);\n    // assert!(b3.deref() == v2);\n}\n</code></pre><p>è¿è¡Œä»£ç å¯ä»¥çœ‹åˆ°ï¼ŒVec&lt;T&gt; å¯ä»¥é€šè¿‡ into_boxed_slice() è½¬æ¢æˆ Box&lt;[T]&gt;ï¼ŒBox&lt;[T]&gt; ä¹Ÿå¯ä»¥é€šè¿‡ into_vec() è½¬æ¢å› Vec&lt;T&gt;ã€‚</p><p>è¿™ä¸¤ä¸ªè½¬æ¢éƒ½æ˜¯å¾ˆè½»é‡çš„è½¬æ¢ï¼Œåªæ˜¯å˜æ¢ä¸€ä¸‹ç»“æ„ï¼Œä¸æ¶‰åŠæ•°æ®çš„æ‹·è´ã€‚åŒºåˆ«æ˜¯ï¼Œå½“ Vec&lt;T&gt; è½¬æ¢æˆ Box&lt;[T]&gt; æ—¶ï¼Œæ²¡æœ‰ä½¿ç”¨åˆ°çš„å®¹é‡å°±ä¼šè¢«ä¸¢å¼ƒï¼Œæ‰€ä»¥æ•´ä½“å ç”¨çš„å†…å­˜å¯èƒ½ä¼šé™ä½ã€‚è€Œä¸”Box&lt;[T]&gt; æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ç‰¹æ€§æ˜¯ï¼Œä¸åƒ Box&lt;[T;n]&gt; é‚£æ ·åœ¨ç¼–è¯‘æ—¶å°±è¦ç¡®å®šå¤§å°ï¼Œå®ƒå¯ä»¥åœ¨è¿è¡ŒæœŸç”Ÿæˆï¼Œä»¥åå¤§å°ä¸ä¼šå†æ”¹å˜ã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>å½“æˆ‘ä»¬éœ€è¦åœ¨å †ä¸Šåˆ›å»ºå›ºå®šå¤§å°çš„é›†åˆæ•°æ®ï¼Œä¸”ä¸å¸Œæœ›è‡ªåŠ¨å¢é•¿ï¼Œé‚£ä¹ˆï¼Œå¯ä»¥å…ˆåˆ›å»º Vec&lt;T&gt;ï¼Œå†è½¬æ¢æˆ Box&lt;[T]&gt;</strong>ã€‚tokio åœ¨æä¾› broadcast channel æ—¶ï¼Œå°±ä½¿ç”¨äº† Box&lt;[T]&gt; è¿™ä¸ªç‰¹æ€§ï¼Œä½ æ„Ÿå…´è¶£çš„è¯ï¼Œå¯ä»¥è‡ªå·±çœ‹çœ‹<a href=\"https://github.com/tokio-rs/tokio/blob/master/tokio/src/sync/broadcast.rs#L447\">æºç </a>ã€‚</p><h2>å°ç»“</h2><p>æˆ‘ä»¬è®¨è®ºäº†åˆ‡ç‰‡ä»¥åŠå’Œåˆ‡ç‰‡ç›¸å…³çš„ä¸»è¦æ•°æ®ç±»å‹ã€‚åˆ‡ç‰‡æ˜¯ä¸€ä¸ªå¾ˆé‡è¦çš„æ•°æ®ç±»å‹ï¼Œä½ å¯ä»¥ç€é‡ç†è§£å®ƒå­˜åœ¨çš„æ„ä¹‰ï¼Œä»¥åŠä½¿ç”¨æ–¹å¼ã€‚</p><p>ä»Šå¤©å­¦å®Œç›¸ä¿¡ä½ ä¹Ÿçœ‹åˆ°äº†ï¼Œå›´ç»•ç€åˆ‡ç‰‡æœ‰å¾ˆå¤šæ•°æ®ç»“æ„ï¼Œè€Œ<strong>åˆ‡ç‰‡å°†å®ƒä»¬æŠ½è±¡æˆç›¸åŒçš„è®¿é—®æ–¹å¼ï¼Œå®ç°äº†åœ¨ä¸åŒæ•°æ®ç»“æ„ä¹‹ä¸Šçš„åŒä¸€æŠ½è±¡</strong>ï¼Œè¿™ç§æ–¹æ³•å¾ˆå€¼å¾—æˆ‘ä»¬å­¦ä¹ ã€‚æ­¤å¤–ï¼Œå½“æˆ‘ä»¬æ„å»ºè‡ªå·±çš„æ•°æ®ç»“æ„æ—¶ï¼Œå¦‚æœå®ƒå†…éƒ¨ä¹Ÿæœ‰è¿ç»­æ’åˆ—çš„ç­‰é•¿çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥è€ƒè™‘ AsRef æˆ–è€… Deref åˆ°åˆ‡ç‰‡ã€‚</p><p>ä¸‹å›¾æè¿°äº†åˆ‡ç‰‡å’Œæ•°ç»„ [T;n]ã€åˆ—è¡¨ Vec&lt;T&gt;ã€åˆ‡ç‰‡å¼•ç”¨ &amp;[T] /&amp;mut [T]ï¼Œä»¥åŠåœ¨å †ä¸Šåˆ†é…çš„åˆ‡ç‰‡ Box&lt;[T]&gt; ä¹‹é—´çš„å…³ç³»ã€‚å»ºè®®ä½ èŠ±äº›æ—¶é—´ç†è§£è¿™å¼ å›¾ï¼Œä¹Ÿå¯ä»¥ç”¨ç›¸åŒçš„æ–¹å¼å»æ€»ç»“å­¦åˆ°çš„å…¶ä»–æœ‰å…³è”çš„æ•°æ®ç»“æ„ã€‚<br>\n<img src=\"https://static001.geekbang.org/resource/image/62/91/62c55a1733d7b674a9e815c45d4a6f91.jpg?wh=2364x1740\" alt=\"\"></p><p>ä¸‹ä¸€è®²æˆ‘ä»¬ç»§ç»­å­¦ä¹ å“ˆå¸Œè¡¨â€¦â€¦</p><h3>æ€è€ƒé¢˜</h3><p>1.åœ¨è®² &amp;str æ—¶ï¼Œé‡Œé¢çš„ print_slice1 å‡½æ•°ï¼Œå¦‚æœå†™æˆè¿™æ ·å¯ä¸å¯ä»¥ï¼Ÿä½ å¯ä»¥å°è¯•ä¸€ä¸‹ï¼Œç„¶åè¯´æ˜ç†ç”±ã€‚</p><pre><code class=\"language-rust\">// fn print_slice1&lt;T: AsRef&lt;str&gt;&gt;(s: T) {\n//    println!(\"{:?}\", s.as_ref());\n// }\n\nfn print_slice1&lt;T, U&gt;(s: T)\nwhere\n    T: AsRef&lt;U&gt;,\n    U: fmt::Debug,\n{\n    println!(\"{:?}\", s.as_ref());\n}\n</code></pre><p>2.ç±»ä¼¼ itertoolsï¼Œä½ å¯ä»¥è¯•ç€å¼€å‘ä¸€ä¸ªæ–°çš„ Iterator trait IteratorExtï¼Œä¸ºå…¶æä¾› window_count å‡½æ•°ï¼Œä½¿å…¶å¯ä»¥åšä¸‹å›¾ä¸­çš„åŠ¨ä½œï¼ˆ<a href=\"https://rxjs.dev/api/operators/windowCount\">æ¥æº</a>ï¼‰ï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/f3/5b/f30947af9dff50521ccd4ddae42f0d5b.png?wh=1280x634\" alt=\"\"></p><p>æ„Ÿè°¢ä½ çš„é˜…è¯»ï¼Œå¦‚æœä½ è§‰å¾—æœ‰æ”¶è·ï¼Œä¹Ÿæ¬¢è¿ä½ åˆ†äº«ç»™ä½ èº«è¾¹çš„æœ‹å‹ï¼Œé‚€ä»–ä¸€èµ·è®¨è®ºã€‚ä½ å·²ç»å®Œæˆäº†Rustå­¦ä¹ çš„ç¬¬16æ¬¡æ‰“å¡å•¦ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p><h3>å‚è€ƒèµ„æ–™ï¼šRust çš„ Iterator ç©¶ç«Ÿæœ‰å¤šå¿«ï¼Ÿ</h3><p>å½“ä½¿ç”¨ Iterator æä¾›çš„è¿™ç§å‡½æ•°å¼ç¼–ç¨‹é£æ ¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šæ‹…å¿ƒæ€§èƒ½ã€‚è™½ç„¶æˆ‘å‘Šè¯‰ä½  Rust å¤§é‡ä½¿ç”¨ inline æ¥ä¼˜åŒ–ï¼Œä½†ä½ å¯èƒ½è¿˜å¿ƒå­˜ç–‘æƒ‘ã€‚</p><p>ä¸‹é¢çš„ä»£ç å’Œæˆªå›¾æ¥è‡ªä¸€ä¸ª Youtube è§†é¢‘ï¼š<a href=\"https://youtu.be/-hGbMp0sBvM?t=913\">Sharing code between iOS &amp; Android with Rust</a>ï¼Œæ¼”è®²è€…é€šè¿‡åœ¨ä½¿ç”¨ Iterator å¤„ç†ä¸€ä¸ªå¾ˆå¤§çš„å›¾ç‰‡ï¼Œæ¯”è¾ƒ Rust / Swift / Kotlin native / C è¿™å‡ ç§è¯­è¨€çš„æ€§èƒ½ã€‚ä½ ä¹Ÿå¯ä»¥çœ‹åˆ°åœ¨å¤„ç†è¿­ä»£å™¨æ—¶ï¼Œ Rust ä»£ç å’Œ Kotlin æˆ–è€… Swift ä»£ç éå¸¸ç±»ä¼¼ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/6d/81/6de6b2d91fe28b0228e748220dbe3281.png?wh=1388x1022\" alt=\"\" title=\"Rust / Kotlin ä»£ç \"></p><p><img src=\"https://static001.geekbang.org/resource/image/73/af/73dd5214bd0d15409006f99ac78fbdaf.png?wh=1390x1022\" alt=\"\" title=\"Swift ä»£ç \"></p><p>è¿è¡Œç»“æœï¼Œåœ¨å‡½æ•°å¼ç¼–ç¨‹æ–¹å¼ä¸‹ï¼ˆC æ²¡æœ‰å‡½æ•°å¼ç¼–ç¨‹æ”¯æŒï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨äº† for å¾ªç¯ï¼‰ï¼ŒRust å’Œ C å‡ ä¹ç›¸å½“åœ¨1s å·¦å³ï¼ŒC æ¯” Rust å¿« 20%ï¼ŒSwift èŠ±äº† 11.8sï¼Œè€Œ Kotlin native ç›´æ¥è¶…æ—¶ï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/c1/d4/c1e1c1909b761cfa3348115bb417d4d4.png?wh=1430x1072\" alt=\"\"></p><p>æ‰€ä»¥ Rust åœ¨å¯¹å‡½æ•°å¼ç¼–ç¨‹ï¼Œå°¤å…¶æ˜¯ Iterator ä¸Šçš„ä¼˜åŒ–ï¼Œè¿˜æ˜¯éå¸¸ä¸é”™çš„ã€‚è¿™é‡Œé¢é™¤äº† inline å¤–ï¼ŒRust é—­åŒ…çš„ä¼˜å¼‚æ€§èƒ½ä¹Ÿæä¾›äº†å¾ˆå¤šæ”¯æŒï¼ˆæœªæ¥æˆ‘ä»¬ä¼šè®²ä¸ºä»€ä¹ˆï¼‰ã€‚åœ¨ä½¿ç”¨æ—¶ï¼Œä½ å®Œå…¨ä¸ç”¨æ‹…å¿ƒæ€§èƒ½ã€‚</p>","neighbors":{"left":{"article_title":"15ï½œæ•°æ®ç»“æ„ï¼šè¿™äº›æµ“çœ‰å¤§çœ¼çš„ç»“æ„ç«Ÿç„¶éƒ½æ˜¯æ™ºèƒ½æŒ‡é’ˆï¼Ÿ","id":422182},"right":{"article_title":"17ï½œæ•°æ®ç»“æ„ï¼šè½¯ä»¶ç³»ç»Ÿæ ¸å¿ƒéƒ¨ä»¶å“ˆå¸Œè¡¨ï¼Œå†…å­˜å¦‚ä½•å¸ƒå±€ï¼Ÿ","id":423923}},"comments":[{"had_liked":false,"id":314130,"user_name":"pedro","can_delete":false,"product_type":"c1","uid":1200704,"ip_address":"","ucode":"F40C839DDFD599","user_header":"https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg","comment_is_top":false,"comment_ctime":1632872835,"is_pvip":false,"replies":[{"id":"113984","content":"å¦‚æœå•çº¿ç¨‹ï¼Œå¯ä»¥ç”¨ Rc&lt;T&gt;ï¼Œå¤šçº¿ç¨‹ç”¨ Arc&lt;T&gt;ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1633322251,"ip_address":"","comment_id":314130,"utype":1}],"discussion_count":1,"race_medal":0,"score":"70352349571","product_id":100085301,"comment_content":"é—®è€å¸ˆä¸€ä¸ªå·¥ç¨‹æ€§ä¸Šçš„é—®é¢˜ï¼Œä¹Ÿå›°æ‰°äº†æˆ‘å¥½ä¹…ï¼Œä¹‹å‰æˆ‘åœ¨ç”¨rustå¼€å‘é¡¹ç›®çš„æ—¶å€™ï¼Œæ•°æ®è§£ææ€§é¡¹ç›®ï¼Œä¼šå­˜åœ¨ä¸€ä¸ªå­—æ®µè¢«å¤šä¸ªç±»ï¼Œæˆ–è€…å‡½æ•°ä½¿ç”¨ï¼Œç”±äºæ‰€æœ‰æƒçš„é—®é¢˜ï¼Œå¯¼è‡´ä»£ç ä¸­å‡ºç°äº†å¤§é‡çš„cloneå‡½æ•°ï¼Œåé¢åœ¨åšæ€§èƒ½åˆ†æçš„æ—¶å€™ï¼Œå‘ç°20%çš„æ—¶é—´ç«Ÿç„¶æµªè´¹åœ¨cloneä¸Šï¼Œæ±‚é—®è€å¸ˆï¼Œå¦‚ä½•å‡å°‘cloneçš„è°ƒç”¨æ¬¡æ•°ï¼Ÿ","like_count":17,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527582,"discussion_content":"å¦‚æœå•çº¿ç¨‹ï¼Œå¯ä»¥ç”¨ Rc&amp;lt;T&amp;gt;ï¼Œå¤šçº¿ç¨‹ç”¨ Arc&amp;lt;T&amp;gt;ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633322251,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314377,"user_name":"lisiur","can_delete":false,"product_type":"c1","uid":1201350,"ip_address":"","ucode":"CEB2DBCE29CAA7","user_header":"https://static001.geekbang.org/account/avatar/00/12/54/c6/c2481790.jpg","comment_is_top":false,"comment_ctime":1632990506,"is_pvip":false,"replies":[{"id":"113986","content":"å—¯ã€‚æŒºä¸é”™ã€‚ç¬¬äºŒé¢˜å¯ä»¥çœ‹çœ‹æˆ‘çš„å‚è€ƒå®ç°ï¼š<br><br>https:&#47;&#47;play.rust-lang.org&#47;?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=c51bf256df8be1c51c16bbe4885b810a","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1633322464,"ip_address":"","comment_id":314377,"utype":1}],"discussion_count":2,"race_medal":0,"score":"27402794282","product_id":100085301,"comment_content":"1. ä¸å¯ä»¥ï¼Œä½†ç¨å¾®æ”¹é€ ä¸‹ä¹Ÿæ˜¯å¯ä»¥çš„<br><br>str å®ç°äº† AsRef&lt;[u8]&gt;ï¼ŒAsRef&lt;OsStr&gt;ï¼ŒAsRef&lt;Path&gt;ï¼ŒAsRef&lt;str&gt;<br><br>å¦‚æœ T: AsRef&lt;[U]&gt;ï¼Œç¼–è¯‘å™¨å¯ä»¥æ¨æ–­å‡º str æ˜¯ AsRef&lt;[u8]&gt;ï¼Œå³ U æ˜¯ u8 ç±»å‹<br><br>å¦‚æœ T: AsRef&lt;U&gt;ï¼Œç¼–è¯‘å™¨å°±æ‡µé€¼äº†ï¼Œå› ä¸ºå®ƒæœ‰å››ç§é€‰æ‹©ã€‚<br><br>é—®é¢˜çš„å…³é”®å°±åœ¨äºç¼–è¯‘å™¨æ— æ³•æ¨æ–­å‡º U çš„ç±»å‹ï¼Œå› æ­¤å¦‚æœç¨å¾®æ”¹é€ ä¸‹ï¼Œå…¶å®è¿˜æ˜¯å¯ä»¥é€šè¿‡æ‰‹åŠ¨æ ‡è®°æ¥é€šè¿‡ç¼–è¯‘çš„ï¼š<br><br>```rust<br>use std::fmt;<br><br>fn main() {<br>    let s = String::from(&quot;hello&quot;);<br>    print_slice1::&lt;_, [u8]&gt;(&amp;s); &#47;&#47; [104, 101, 108, 108, 111]<br>    print_slice1::&lt;_, str&gt;(&amp;s);  &#47;&#47; &quot;hello&quot;<br>}<br><br>fn print_slice1&lt;T, U: ?Sized&gt;(s: T)<br>where<br>    T: AsRef&lt;U&gt;,<br>    U: fmt::Debug,<br>{<br>    println!(&quot;{:?}&quot;, s.as_ref());<br>}<br>```<br><br>2. çœ‹äº†ä¸‹ rxjs çš„å®šä¹‰ï¼Œç¬¬äºŒä¸ªå‚æ•°å¦‚æœå°äºç¬¬ä¸€ä¸ªå‚æ•°çš„è¯ï¼Œå¾—åˆ°çš„ç»“æœå¥½åƒæ²¡å•¥æ„ä¹‰ï¼ˆåæ­£æˆ‘ä¸ªäººæ˜¯æ²¡çœ‹æ‡‚ï¼‰ï¼Œ<br>æ‰€ä»¥åªå¤„ç†äº†ç¬¬äºŒä¸ªå‚æ•°ä¸å°äºç¬¬ä¸€ä¸ªå‚æ•°çš„æƒ…å†µã€‚<br><br>```rust<br>struct WindowCountIter&lt;T: Iterator&gt; {<br>    iter: T,<br>    window_size: usize,<br>    start_window_every: usize,<br>}<br><br>impl&lt;T: Iterator&gt; Iterator for WindowCountIter&lt;T&gt; {<br>    type Item = Vec&lt;&lt;T as Iterator&gt;::Item&gt;;<br><br>    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt; {<br>        let mut item = Vec::with_capacity(self.window_size);<br><br>        for _ in 0..self.window_size {<br>            if let Some(v) = self.iter.next() {<br>                item.push(v);<br>            }<br>        }<br><br>        for _ in 0..(self.start_window_every - self.window_size) {<br>            self.iter.next();<br>        }<br><br>        if item.is_empty() {<br>            None<br>        } else {<br>            Some(item)<br>        }<br>    }<br>}<br><br>trait IteratorExt: Iterator {<br>    fn window_count(self, window_size: usize, start_window_every: usize) -&gt; WindowCountIter&lt;Self&gt;<br>    where<br>        Self: Sized,<br>    {<br>        if start_window_every &gt; 0 &amp;&amp; start_window_every &lt; window_size {<br>            panic!(&quot;start_window_every ä¸èƒ½å°äº window_size&quot;)<br>        }<br>        WindowCountIter {<br>            iter: self,<br>            window_size,<br>            start_window_every: if start_window_every == 0 {<br>                window_size<br>            } else {<br>                start_window_every<br>            },<br>        }<br>    }<br>}<br><br>impl&lt;T: Iterator&gt; IteratorExt for T {}<br>```","like_count":7,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527665,"discussion_content":"å—¯ã€‚æŒºä¸é”™ã€‚ç¬¬äºŒé¢˜å¯ä»¥çœ‹çœ‹æˆ‘çš„å‚è€ƒå®ç°ï¼š\n\nhttps://play.rust-lang.org/?version=stable&amp;amp;mode=debug&amp;amp;edition=2018&amp;amp;gist=c51bf256df8be1c51c16bbe4885b810a","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633322464,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2888176,"avatar":"","nickname":"æ— ä¸‹é™HENTAI","note":"","ucode":"8D45A12C25861A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554689,"discussion_content":"ä¸çŸ¥é“ä½ é‚£ä¸ªæ—¶å€™å’Œç°åœ¨æ˜¯ä¸æ˜¯ä¸ä¸€æ ·äº†ï¼Œå¯¹ç¬¬ä¸€é¢˜æ¥è¯´ï¼Œç°åœ¨å¦‚æœä½¿ç”¨Uè€Œä¸æ˜¯[U]çš„è¯ï¼ŒUåé¢è¿˜å¿…é¡»åŠ ä¸Š?Sizedå‘Šè¯‰ç¼–è¯‘å™¨é•¿åº¦ä¸å®šï¼Œå¦åˆ™ç¼–è¯‘æ— æ³•é€šè¿‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646551263,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324178,"user_name":"é˜¿æˆ","can_delete":false,"product_type":"c1","uid":1390032,"ip_address":"","ucode":"CEC3CD65FB9333","user_header":"https://static001.geekbang.org/account/avatar/00/15/35/d0/f2ac6d91.jpg","comment_is_top":false,"comment_ctime":1638327086,"is_pvip":false,"replies":[{"id":"118869","content":"ğŸ‘ å¾ˆå¥½çš„æ€è€ƒã€‚ä¸€èˆ¬æˆ‘éƒ½ä¼šæŠŠé¢˜ç›®çš„ç­”æ¡ˆæ”¾åœ¨ github repo ä¸‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1079375","ctime":1639849070,"ip_address":"","comment_id":324178,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18818196270","product_id":100085301,"comment_content":"æ€ä¹ˆç•™è¨€è¶Šæ¥è¶Šå°‘äº†â€¦â€¦<br>ä¸è¦æ”¾å¼ƒå•Šï¼Œæˆ‘ä¹Ÿæœ‰è¢«å¡å¥½å‡ å¤©çš„æ—¶å€™ï¼Œä½†æ…¢æ…¢åœ°å°±èµ°å‡ºæ¥äº†ã€‚<br>1. ç¼–è¯‘å™¨æ¨æ–­ä¸å‡º U çš„ç±»å‹ï¼Œå› ä¸º T å®ç°äº†å¤šä¸ª AsRef traitã€‚å¯ä»¥ä½¿ç”¨ turbofish æ‰‹åŠ¨æŒ‡å®š Uï¼ŒåŒæ—¶ä¹Ÿè¦æ³¨æ„åˆ°å¯¹äº str å’Œ [u8] æ¥è¯´ï¼ŒU éœ€è¦æ˜¯ ?Sizedã€‚<br>2. ä¸€å¼€å§‹æˆ‘ä»¥ä¸º WindowCount ç»“æ„ä½“ next æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªæ–°çš„ Iteratorï¼Œè¿™ä¸ªæ–°çš„ Iterator é‡Œæ˜¯ count ä¸ª Itemã€‚åæ¥æˆ‘å‘ç°è¿™ä¸å¯èƒ½å®ç°å•Šâ€¦â€¦æˆ‘ä¸ºä»€ä¹ˆä¸€å¼€å§‹æ˜¯è¿™ä¹ˆæƒ³çš„å‘¢ï¼Œæ˜¯å— slice çš„ chunks æ–¹æ³•å½±å“ï¼Œchunks æ–¹æ³•è¿™ä¸æ˜¯æ­£å¥½ç¬¦åˆé¢˜ç›®è¦æ±‚ä¹ˆï¼Œä½† slice æ˜¯æœ‰é•¿åº¦ä¿¡æ¯çš„ï¼Œè€Œ Iterator åªèƒ½ä¸€ç›´ nextã€‚åæ¥æˆ‘å·ç„äº†è€å¸ˆçš„å®ç°ï¼Œå‘ç°åŸæ¥æ˜¯æƒ³ç”¨ Vec æ¥æ‰¿è½½æ¯ä¸€ç»„æ•°æ®â€¦â€¦ å…·ä½“å®ç°ä»£ç å°±ä¸è´´äº†ï¼Œå’Œè€å¸ˆçš„å·®ä¸å¤šã€‚<br><br>ä½†æˆ‘åˆå›è¿‡å¤´æ¥æƒ³ rxjs çš„ windowCount å¥½åƒä¸æ˜¯è¿™ä¸ªæ„æ€ï¼Œå®ƒçš„æ¯ä¸€ç»„æ•°æ®è¿˜æ˜¯ä¸€ä¸ªæµã€‚é‚£å®ƒæ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ<br>æˆ‘æƒ³è¿™å¯èƒ½è·Ÿ rxjs çš„è®¾è®¡æœ‰å…³ï¼Œå®ƒæ˜¯æŠŠæ•°æ® push åˆ°è®¢é˜…è€…ï¼Œè€Œ Iterator æ˜¯ pullã€‚<br>rxjs å•ç‹¬ä½¿ç”¨ windowCount æ˜¯è¿™æ ·çš„æ•ˆæœï¼šå‡å¦‚æ•°æ®æºæ˜¯ç‚¹å‡»äº‹ä»¶ï¼Œcount æ˜¯ 3ï¼Œä¸€å¼€å§‹è¿˜æ²¡ç‚¹å‡»å°±äº§ç”Ÿä¸€ä¸ª Observableï¼ˆæˆ‘ä»¬å«å®ƒ Aï¼‰ï¼Œç„¶åæˆ‘ç‚¹å‡»ç¬¬ä¸€ä¸‹ï¼Œè¿™æ¬¡ç‚¹å‡»å°±è¢«æ¨é€åˆ° A äº†ï¼Œç‚¹å‡»ç¬¬äºŒä¸‹ï¼Œä¹Ÿæ¨é€åˆ° Aï¼Œç‚¹å‡»ç¬¬ä¸‰ä¸‹ï¼Œä¹Ÿæ¨é€åˆ° Aï¼Œè¿™æ—¶å€™ A å·²ç»å 3 ä¸ªæ•°æ®äº†ï¼Œç´§æ¥ç€å°±ä¼šäº§ç”Ÿä¸‹ä¸€ä¸ªé«˜é˜¶ Observable Bï¼Œç”¨æ¥æ‰¿è½½æ¥ä¸‹æ¥çš„ä¸‰æ¬¡ç‚¹å‡»â€¦â€¦<br>ä½†è¿™ä¸ª Iterator æ˜¯ä¸ªåŒæ­¥æ¨¡å‹ï¼Œè€Œä¸”è¿˜æ²¡æœ‰æ•°æ®æ€»é‡çš„ä¿¡æ¯ï¼Œæˆ‘æ ¹æœ¬æ— æ³•åˆ¤æ–­è¿™æ¬¡ next æ˜¯åº”è¯¥è¿”å› None è¿˜æ˜¯ Someã€‚<br><br>å»ºè®®ç±»ä¼¼é¢˜ç›®å¯ä»¥ç»™å‡ºå¤šä¸€ç‚¹çš„æç¤ºâ€¦â€¦<br>","like_count":4,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539829,"discussion_content":"ğŸ‘ å¾ˆå¥½çš„æ€è€ƒã€‚ä¸€èˆ¬æˆ‘éƒ½ä¼šæŠŠé¢˜ç›®çš„ç­”æ¡ˆæ”¾åœ¨ github repo ä¸‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639849070,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314318,"user_name":"Marvichov","can_delete":false,"product_type":"c1","uid":1111835,"ip_address":"","ucode":"7482099415C41C","user_header":"https://static001.geekbang.org/account/avatar/00/10/f7/1b/db7a0edc.jpg","comment_is_top":false,"comment_ctime":1632969839,"is_pvip":false,"replies":[{"id":"113976","content":"FromIterator ç›®å‰è¿˜æ²¡æœ‰åŠ å…¥ Rust çš„ preludeï¼Œ2021 edition æ‰ä¼šè‡ªåŠ¨åŠ å…¥ï¼š<br><br>The first new feature that Rust 2021 will have is a new prelude that includes TryInto, TryFrom and FromIterator from the Rust standard library.<br><br>å¯¹äº trait æ–¹æ³•ï¼Œå¦‚æœä½ è¦ä½¿ç”¨ï¼Œéœ€è¦å…ˆç¡®ä¿åœ¨ä¸Šä¸‹æ–‡ä¸­å¼•å…¥äº†è¿™ä¸ª traitã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1633320720,"ip_address":"","comment_id":314318,"utype":1}],"discussion_count":3,"race_medal":0,"score":"14517871727","product_id":100085301,"comment_content":"è¿˜æœ‰ä¸ªé—®é¢˜, ä¸ºå•¥éœ€è¦ import FromIterator æ‰èƒ½ä½¿ç”¨ String::from_iterå‘¢? Stringä¸éƒ½å·²ç»impläº†å—? https:&#47;&#47;doc.rust-lang.org&#47;src&#47;alloc&#47;string.rs.html#1866-1872","like_count":3,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527641,"discussion_content":"FromIterator ç›®å‰è¿˜æ²¡æœ‰åŠ å…¥ Rust çš„ preludeï¼Œ2021 edition æ‰ä¼šè‡ªåŠ¨åŠ å…¥ï¼š\n\nThe first new feature that Rust 2021 will have is a new prelude that includes TryInto, TryFrom and FromIterator from the Rust standard library.\n\nå¯¹äº trait æ–¹æ³•ï¼Œå¦‚æœä½ è¦ä½¿ç”¨ï¼Œéœ€è¦å…ˆç¡®ä¿åœ¨ä¸Šä¸‹æ–‡ä¸­å¼•å…¥äº†è¿™ä¸ª traitã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633320720,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1201350,"avatar":"https://static001.geekbang.org/account/avatar/00/12/54/c6/c2481790.jpg","nickname":"lisiur","note":"","ucode":"CEB2DBCE29CAA7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":399559,"discussion_content":"æˆ‘çŒœåº”è¯¥æ˜¯ std::prelude é‡Œé»˜è®¤æ²¡æœ‰å¯¼å‡º FromIteratorï¼Œç­‰2021ç‰ˆå‘å¸ƒä¹‹åï¼Œåº”è¯¥å°±ä¸éœ€è¦äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1632991401,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1111835,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/1b/db7a0edc.jpg","nickname":"Marvichov","note":"","ucode":"7482099415C41C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":399792,"discussion_content":"æ„Ÿè°¢å›å¤. å¬èµ·æ¥æœ‰ç‚¹åƒheader file?\n\nç¬¬ä¸‰æ–¹crateçš„traitå¯¹Stringçš„å®ç°, æˆ‘å¯ä»¥ç†è§£è¦importé‚£ä¸ªtrait, è¿™æ ·ç¼–è¯‘å™¨æ‰çŸ¥é“ä»å“ªé‡Œå»æ‰¾å®šä¹‰ (å› ä¸ºStringçš„æºç é‡Œé¢æ‰¾ä¸åˆ°). ç›¸å½“äºå¯¹Stringçš„extension.\n\nä½†æ˜¯, åœ¨Stringçš„æºç ä¸­, String impläº†è¿™ä¸ªtrait, å¯¹åº”çš„æ–¹æ³•ä¸åº”è¯¥å˜æˆStringçš„ä¸€éƒ¨åˆ†äº†å—? æˆ‘çš„ç†è§£æ˜¯, ä½¿ç”¨Stringçš„æ—¶å€™, è¿™ä¸ªæ–¹æ³•å°±é»˜è®¤è¢«importäº†? ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633063784,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314315,"user_name":"Marvichov","can_delete":false,"product_type":"c1","uid":1111835,"ip_address":"","ucode":"7482099415C41C","user_header":"https://static001.geekbang.org/account/avatar/00/10/f7/1b/db7a0edc.jpg","comment_is_top":false,"comment_ctime":1632969358,"is_pvip":false,"replies":[{"id":"113987","content":"å¯¹ã€‚<br><br>ç¬¬äºŒé¢˜å¯ä»¥çœ‹çœ‹æˆ‘çš„å®ç°ï¼šhttps:&#47;&#47;play.rust-lang.org&#47;?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=c51bf256df8be1c51c16bbe4885b810a<br><br>å¦‚æœä½ çº ç»“ lazyï¼Œå¯ä»¥çœ‹çœ‹ slice chunk çš„å®ç°ï¼šhttps:&#47;&#47;doc.rust-lang.org&#47;src&#47;core&#47;slice&#47;iter.rs.html#1363","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1633322995,"ip_address":"","comment_id":314315,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10222903950","product_id":100085301,"comment_content":"1. æœ‰æ­§ä¹‰, Uå¯ä»¥æ˜¯str, ä¹Ÿå¯ä»¥æ˜¯[u8];<br><br>2. ç”¨vecä½œå¼Šäº†: eagerly load window_sizeå¤§å°çš„element; æ²¡æœ‰lazy load<br><br>https:&#47;&#47;play.rust-lang.org&#47;?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=e6759f0d43bfbbb9f9a4b4aaf4a8ed8b<br><br>æ²¡æœ‰è´´tests; åœ¨linké‡Œé¢æœ‰<br><br>```<br>struct WindowCount&lt;T&gt;<br>where<br>    T: Iterator,<br>{<br>    window_size: usize,<br>    start_window_every: usize,<br>    iter: T,<br>}<br><br>impl&lt;T&gt; Iterator for WindowCount&lt;T&gt;<br>where<br>    T: Iterator,<br>{<br>    type Item = &lt;Vec&lt;&lt;T as Iterator&gt;::Item&gt; as IntoIterator&gt;::IntoIter;<br>    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt; {<br>        if self.window_size == 0 {<br>            return None;<br>        }<br><br>        let mut v = Vec::with_capacity(self.window_size);<br>        for _ in 0..self.window_size {<br>            if let Some(item) = self.iter.next() {<br>                v.push(item);<br>            } else {<br>                break;<br>            }<br>        }<br><br>        &#47;&#47; advance steps<br>        for _ in 0..self.start_window_every {<br>            if self.iter.next().is_none() {<br>                break;<br>            }<br>        }<br>        if v.is_empty() {<br>            None<br>        } else {<br>            Some(v.into_iter())<br>        }<br>    }<br>}<br>trait IteratorExt: Iterator {<br>    fn window_count(self, window_size: usize, start_window_every: usize) -&gt; WindowCount&lt;Self&gt;<br>    where<br>        Self::Item: std::fmt::Debug,<br>        Self: Sized,<br>    {<br>        WindowCount {<br>            window_size,<br>            start_window_every,<br>            iter: self,<br>        }<br>    }<br>}<br><br>impl&lt;T: Iterator&gt; IteratorExt for T {}<br>```","like_count":2,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527640,"discussion_content":"å¯¹ã€‚\n\nç¬¬äºŒé¢˜å¯ä»¥çœ‹çœ‹æˆ‘çš„å®ç°ï¼šhttps://play.rust-lang.org/?version=stable&amp;amp;mode=debug&amp;amp;edition=2018&amp;amp;gist=c51bf256df8be1c51c16bbe4885b810a\n\nå¦‚æœä½ çº ç»“ lazyï¼Œå¯ä»¥çœ‹çœ‹ slice chunk çš„å®ç°ï¼šhttps://doc.rust-lang.org/src/core/slice/iter.rs.html#1363","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633322995,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1080653,"avatar":"https://static001.geekbang.org/account/avatar/00/10/7d/4d/d98865b2.jpg","nickname":"è€å®äººHoney","note":"","ucode":"EA4AB5C0C33090","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547099,"discussion_content":"ä½ è¿™ä¸ªå†™æ³•å¯ä»¥ç”¨skipæ¥å¤„ç†å—\n    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt; {\n        let data = (0..self.window_size)\n            .filter_map(|_| self.iter.next())\n            .skip(self.start_window_every as usize)\n            .collect::&lt;Vec&lt;_&gt;&gt;();\n        if data.is_empty() {\n            None\n        } else {\n            Some(data)\n        }\n    }","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642522684,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314188,"user_name":"é˜¿æµ·","can_delete":false,"product_type":"c1","uid":1281585,"ip_address":"","ucode":"2589431F840C42","user_header":"https://static001.geekbang.org/account/avatar/00/13/8e/31/28972804.jpg","comment_is_top":false,"comment_ctime":1632891876,"is_pvip":true,"replies":[{"id":"113979","content":"&amp;T æ˜¯å¼•ç”¨ï¼Œ*T æ˜¯è§£å¼•ç”¨ã€‚æ¯”å¦‚ä½ æœ‰ä¸€ä¸ª b = &amp;mut u32ï¼Œä½ å¯ä»¥ *b = 10 æ¥è§£å¼•ç”¨æ›´æ”¹ b æŒ‡å‘çš„å†…å­˜ã€‚<br><br>Rust å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½ä¼šåšè‡ªåŠ¨è§£å¼•ç”¨ï¼ˆä½¿ç”¨ . çš„æ—¶å€™ï¼‰ã€‚æ‰€ä»¥ä½ ä¼šæ„Ÿè§‰å¾ˆå°‘éœ€è¦ç”¨ *ã€‚https:&#47;&#47;stackoverflow.com&#47;questions&#47;28519997&#47;what-are-rusts-exact-auto-dereferencing-rules&#47;28552082","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1633321408,"ip_address":"","comment_id":314188,"utype":1}],"discussion_count":3,"race_medal":0,"score":"10222826468","product_id":100085301,"comment_content":"è€å¸ˆé—®ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆrustè§£å¼•ç”¨æ˜¯ç”¨&amp;T æ¥è¡¨ç¤ºï¼Œè€Œä¸æ˜¯ç”¨*T","like_count":2,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527603,"discussion_content":"&amp;amp;T æ˜¯å¼•ç”¨ï¼Œ*T æ˜¯è§£å¼•ç”¨ã€‚æ¯”å¦‚ä½ æœ‰ä¸€ä¸ª b = &amp;amp;mut u32ï¼Œä½ å¯ä»¥ *b = 10 æ¥è§£å¼•ç”¨æ›´æ”¹ b æŒ‡å‘çš„å†…å­˜ã€‚\n\nRust å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½ä¼šåšè‡ªåŠ¨è§£å¼•ç”¨ï¼ˆä½¿ç”¨ . çš„æ—¶å€™ï¼‰ã€‚æ‰€ä»¥ä½ ä¼šæ„Ÿè§‰å¾ˆå°‘éœ€è¦ç”¨ *ã€‚https://stackoverflow.com/questions/28519997/what-are-rusts-exact-auto-dereferencing-rules/28552082","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633321408,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1201350,"avatar":"https://static001.geekbang.org/account/avatar/00/12/54/c6/c2481790.jpg","nickname":"lisiur","note":"","ucode":"CEB2DBCE29CAA7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":399511,"discussion_content":"rust è§£å¼•ç”¨æ˜¯ç”¨ * çš„ï¼Œæˆ‘çŒœä½ æƒ³é—®çš„åº”è¯¥æ˜¯å¼ºåˆ¶è§£å¼•ç”¨çš„ç”¨æ³•ã€‚æ‰€è°“å¼ºåˆ¶è§£å¼•ç”¨æˆ‘è§‰å¾—å’Œc é‡Œçš„è§£å¼•ç”¨è¿˜æ˜¯ä¸ä¸€æ ·çš„ï¼Œå¼ºåˆ¶è§£å¼•ç”¨çš„ç»“æœä¸€å®šè¿˜æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼Œè€Œä¸æ˜¯åŸå§‹å€¼ã€‚\n\nå¯ä»¥å‚è€ƒæ–‡æ¡£é‡Œå…³äºå¼ºåˆ¶è§£å¼•ç”¨çš„è¯´æ˜ï¼šhttps://doc.rust-lang.org/std/ops/trait.Deref.html#more-on-deref-coercion\n\nç®€å•è§£è¯»ä¸‹å°±æ˜¯ï¼š\n\nå¦‚æœ T å®ç°äº† Deref<Target = U>ï¼Œè€Œä¸” x æ˜¯ T ç±»å‹çš„å®ä¾‹ï¼Œé‚£ä¹ˆï¼š\n\n1. åœ¨ immutable çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œ *x ç­‰ä»·äº *Deref::deref(&amp;x)  (ä½ çœ‹è¿™é‡Œè¿˜æ˜¯ç”¨ * æ¥è§£å¼•ç”¨çš„)\n2. &amp;T ä¼šè¢«å¼ºåˆ¶è§£å¼•ç”¨åˆ° &amp;U ï¼ˆè§£å¼•ç”¨æ˜¯æŠŠå€¼ä»ä¸€ä¸ªå¼•ç”¨ç±»å‹è½¬æ¢æˆå¦ä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼‰\n3. T éšå¼å®ç°äº† U æ‰€æœ‰ immutable æ–¹æ³• ï¼ˆå› ä¸º immutable æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ &amp;selfï¼Œ&amp;self å¯ä»¥è§¦å‘å¼ºåˆ¶è§£å¼•ç”¨åˆ° &amp;Uï¼Œè‡ªç„¶å°±å¯ä»¥ä½¿ç”¨ U çš„ immutable æ–¹æ³•äº†ï¼‰\n\nå¦å¤–å¼ºåˆ¶è§£å¼•ç”¨ä¸€èˆ¬æ˜¯éšå¼è§¦å‘çš„ï¼Œç›®çš„ä¹Ÿæ˜¯ä¸ºäº†æ–¹ä¾¿ä»£ç çš„ä¹¦å†™ï¼Œå‡å°‘æ¨¡æ¿ä»£ç ï¼Œç®—æ˜¯ä¸€ä¸ªå·¥ç¨‹ä¸Šçš„ä¼˜åŒ–ï¼Œå’ŒçœŸæ­£çš„è§£å¼•ç”¨è¿˜æ˜¯æœ‰æŒºå¤§åŒºåˆ«çš„ã€‚ï¼ˆä»¥ä¸Šéƒ½æ˜¯ä¸ªäººç†è§£ï¼Œä»…ä¾›å‚è€ƒï¼‰","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1632980659,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1390032,"avatar":"https://static001.geekbang.org/account/avatar/00/15/35/d0/f2ac6d91.jpg","nickname":"é˜¿æˆ","note":"","ucode":"CEC3CD65FB9333","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534725,"discussion_content":"deref coercionç¿»è¯‘æˆå¼ºåˆ¶è§£å¼•ç”¨æŒºæœ‰è¯¯å¯¼æ€§çš„â€¦â€¦è‡³å°‘ä¸ªäººè¿™ä¹ˆæ„Ÿè§‰â€¦â€¦\næˆ‘ä¹Ÿä¸çŸ¥é“æ€ä¹ˆç¿»è¯‘â€¦â€¦\nå¤§æ¦‚å¯ä»¥å«â€œè§£å¼•ç”¨è½¬æ¢â€\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638263011,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314168,"user_name":"ç»™æˆ‘ç‚¹é˜³å…‰å°±ç¿çƒ‚","can_delete":false,"product_type":"c1","uid":1462209,"ip_address":"","ucode":"F3B0439BE0D062","user_header":"https://static001.geekbang.org/account/avatar/00/16/4f/c1/7f596aba.jpg","comment_is_top":false,"comment_ctime":1632883662,"is_pvip":true,"replies":[{"id":"113990","content":"æ²¡æœ‰å¤ªå¥½çš„æƒ³æ³•ã€‚ä¸è¿‡ï¼Œç®—æ³•ä¸Šçš„ O1ï¼ˆHashMap + LinkedListï¼‰ å’Œ box&#47;raw å…³ç³»ä¸å¤§ã€‚<br><br>å¦‚æœæµ‹é‡çš„ç»“æœæ˜¯é¢‘ç¹åœ°åˆ†é…é‡Šæ”¾æ˜¯ç½ªé­ç¥¸é¦–ï¼Œé‚£ä¹ˆï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ slab æ¥é¢„åˆ†é… RawLRU çš„ entryã€‚<br><br><br>","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1633325756,"ip_address":"","comment_id":314168,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5927850958","product_id":100085301,"comment_content":"å†™äº†ä¸€ä¸ªç¼“å­˜åº“ï¼Œæƒ³é—®ä¸€ä¸‹è€å¸ˆå¦‚ä½•ä¼˜åŒ–hashmapçš„æ€§èƒ½ï¼Œç›®å‰ä¸ºäº†ç®—æ³•ä¸Šçš„O1ï¼Œä½¿ç”¨äº†boxå’ŒrawæŒ‡é’ˆï¼Œä½†æ˜¯ä¼šboxå’Œreboxåˆè®©æ€§èƒ½æ…¢äº†ä¸€äº›ã€‚https:&#47;&#47;github.com&#47;al8n&#47;caches-rs","like_count":1,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527596,"discussion_content":"æ²¡æœ‰å¤ªå¥½çš„æƒ³æ³•ã€‚ä¸è¿‡ï¼Œç®—æ³•ä¸Šçš„ O1ï¼ˆHashMap + LinkedListï¼‰ å’Œ box/raw å…³ç³»ä¸å¤§ã€‚\n\nå¦‚æœæµ‹é‡çš„ç»“æœæ˜¯é¢‘ç¹åœ°åˆ†é…é‡Šæ”¾æ˜¯ç½ªé­ç¥¸é¦–ï¼Œé‚£ä¹ˆï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ slab æ¥é¢„åˆ†é… RawLRU çš„ entryã€‚\n\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633325756,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356462,"user_name":"Geek_a6c6ce","can_delete":false,"product_type":"c1","uid":3074996,"ip_address":"ç¾å›½","ucode":"21DC76D3225403","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/TusRVU51UggZGpicXMgH64Cb8jek0wyTOpagtUHNAj0EPbhbEv0FJpFU2K3glbtOdJXiaQ9o6QoEfv5PiaIu7rwng/132","comment_is_top":false,"comment_ctime":1662344299,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1662344299","product_id":100085301,"comment_content":"å’”å“’","like_count":0},{"had_liked":false,"id":352538,"user_name":"æ²ˆç•…","can_delete":false,"product_type":"c1","uid":1077953,"ip_address":"","ucode":"7404E41356B36B","user_header":"https://static001.geekbang.org/account/avatar/00/10/72/c1/59509397.jpg","comment_is_top":false,"comment_ctime":1658749843,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1658749843","product_id":100085301,"comment_content":"å®˜æ–¹æ–‡æ¡£ filteré‡Œé¢ç”¨äº†ä¸¤ä¸ª **<br>let a = [0, 1, 2];<br><br>let mut iter = a.iter().filter(|x| **x &gt; 1); &#47;&#47; need two *s!<br><br>assert_eq!(iter.next(), Some(&amp;2));<br>assert_eq!(iter.next(), None);<br><br>ä¸ºå•¥ æˆ‘ä»¬åªç”¨ä¸€ä¸ªå°±è¡Œï¼Ÿ<br>let v = vec![1,2,3,4];<br>    let ret = v.iter()<br>               .map(|v| v*v)<br>               .filter(|v| *v &lt; 16)<br>               .take(5)<br>               .collect::&lt;Vec&lt;_&gt;&gt;();","like_count":0},{"had_liked":false,"id":316603,"user_name":"æœ±ä¸­å–œ","can_delete":false,"product_type":"c1","uid":2029033,"ip_address":"","ucode":"AEEBDF4BB0E53F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJlLmHNjThjiahjUNav9W5PI1IQCic5PcbM700V9YlAWDibjeeOOlAKGvAv4zU7ic0OQJZ0KKZicvbEKPw/132","comment_is_top":false,"comment_ctime":1634444127,"is_pvip":true,"replies":[{"id":"114686","content":"Box&lt;T&gt; å®ç°äº† Deref å•Šï¼šhttps:&#47;&#47;doc.rust-lang.org&#47;std&#47;boxed&#47;struct.Box.html#impl-Derefã€‚æ³¨æ„ä½ è¿™é‡Œ T æ˜¯ä¸ª sliceï¼Œæ‰€ä»¥ b2.deref() å’Œ v2ï¼ˆVecï¼‰å¯ä»¥æ¯”è¾ƒï¼Œå› ä¸ºå®ç°äº†ç›¸åº”çš„ eq","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1634539941,"ip_address":"","comment_id":316603,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1634444127","product_id":100085301,"comment_content":" let b1 = v1.into_boxed_slice();<br>    let mut b2 = b1.clone();<br>    let v2 = b1.into_vec();<br>    println!(&quot;cap should be exactly 5: {}&quot;, v2.capacity());<br>    assert!(b2.deref() == v2);<br><br>b2çš„ç±»å‹æ˜¯Box([T]), ä¸ºä½•å¯¹b2åšderefå°±å˜æˆVecäº†ï¼Ÿåœ¨æ ‡å‡†åº“é‡Œæ²¡æ‰¾åˆ°é’ˆå¯¹Box sliceçš„Derefå®ç°ğŸ˜­","like_count":0,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528430,"discussion_content":"Box&amp;lt;T&amp;gt; å®ç°äº† Deref å•Šï¼šhttps://doc.rust-lang.org/std/boxed/struct.Box.html#impl-Derefã€‚æ³¨æ„ä½ è¿™é‡Œ T æ˜¯ä¸ª sliceï¼Œæ‰€ä»¥ b2.deref() å’Œ v2ï¼ˆVecï¼‰å¯ä»¥æ¯”è¾ƒï¼Œå› ä¸ºå®ç°äº†ç›¸åº”çš„ eq","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634539941,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314270,"user_name":"D. D","can_delete":false,"product_type":"c1","uid":2186992,"ip_address":"","ucode":"C416E5602C8814","user_header":"https://static001.geekbang.org/account/avatar/00/21/5e/f0/62d8cf9e.jpg","comment_is_top":false,"comment_ctime":1632925353,"is_pvip":true,"replies":[{"id":"113988","content":"1. å¯¹ï¼<br>2. å¯ä»¥çœ‹çœ‹æˆ‘çš„å‚è€ƒå®ç°ï¼šhttps:&#47;&#47;play.rust-lang.org&#47;?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=c51bf256df8be1c51c16bbe4885b810a","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1633323091,"ip_address":"","comment_id":314270,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1632925353","product_id":100085301,"comment_content":"1. å¯ä»¥ä¸ºåŒä¸€ä¸ªå…·ä½“ç±»å‹å®ç°ä¸åŒçš„AsRef Trait, ç¼–è¯‘å™¨æ— æ³•ä»ä¸Šä¸‹æ–‡ä¸­æ¨æ–­å‡ºUçš„å…·ä½“ç±»å‹ï¼Œæ‰€ä»¥ä¸èƒ½è¿™æ ·å†™ã€‚<br><br>2. ä¸çŸ¥é“å®ç°çš„ç¬¦ä¸ç¬¦åˆè¦æ±‚ï¼Œä»¥åŠæœ‰ä»€ä¹ˆé—®é¢˜ã€‚<br>pub struct Window&lt;I&gt; {<br>    iter: I,<br>    count: usize,<br>    start: usize,<br>}<br><br>pub trait IteratorExt: Iterator {<br>    fn window_count(self, count: usize, start: usize) -&gt; Window&lt;Self&gt;<br>    where<br>        Self: Sized,<br>    {<br>        Window {<br>            iter: self,<br>            count,<br>            start,<br>        }<br>    }<br>}<br><br>impl&lt;T: Iterator&gt; IteratorExt for T {}<br><br>impl&lt;I: Iterator&gt; Iterator for Window&lt;I&gt; {<br>    type Item = Vec&lt;&lt;I as Iterator&gt;::Item&gt;;<br><br>    fn next(&amp;mut self) -&gt; Option&lt;Self::Item&gt; {<br>        if self.count == 0 {<br>            return None;<br>        }<br><br>        for _ in 0..self.start {<br>            self.iter.next()?;<br>        }<br><br>        let mut v = Vec::with_capacity(self.count);<br><br>        for _ in 0..self.count {<br>            v.push(self.iter.next()?);<br>        }<br>        Some(v)<br>    }<br>}<br><br>#[test]<br>fn if_it_works() {<br>    let v1 = vec![&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;, &#39;g&#39;, &#39;h&#39;, &#39;i&#39;];<br><br>    let mut window = v1.iter().window_count(0, 0);<br>    assert_eq!(window.next(), None);<br><br>    let mut window = v1.into_iter().window_count(3, 0);<br>    assert_eq!(window.next(), Some(vec![&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]));<br>    assert_eq!(window.next(), Some(vec![&#39;d&#39;, &#39;e&#39;, &#39;f&#39;]));<br>    assert_eq!(window.next(), Some(vec![&#39;g&#39;, &#39;h&#39;, &#39;i&#39;]));<br>    assert_eq!(window.next(), None);<br><br>    let v2 = vec![&#39;a&#39;, &#39;b&#39;, &#39;c&#39;, &#39;d&#39;, &#39;e&#39;, &#39;f&#39;, &#39;g&#39;, &#39;h&#39;];<br>    let mut window = v2.into_iter().window_count(3, 0);<br>    assert_eq!(window.next(), Some(vec![&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]));<br>    assert_eq!(window.next(), Some(vec![&#39;d&#39;, &#39;e&#39;, &#39;f&#39;]));<br>    assert_eq!(window.next(), None);<br><br>    let v3 = vec![1, 2, 3, 4, 5, 6, 7, 8];<br>    let mut window = v3.into_iter().window_count(3, 3);<br>    assert_eq!(window.next(), Some(vec![4, 5, 6]));<br>    assert_eq!(window.next(), None);<br><br>    let v4 = [1, 2, 3, 4, 5, 6, 7, 8];<br>    let mut window = v4.iter().window_count(3, 100);<br>    assert_eq!(window.next(), None);<br>}<br>","like_count":0,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527624,"discussion_content":"1. å¯¹ï¼\n2. å¯ä»¥çœ‹çœ‹æˆ‘çš„å‚è€ƒå®ç°ï¼šhttps://play.rust-lang.org/?version=stable&amp;amp;mode=debug&amp;amp;edition=2018&amp;amp;gist=c51bf256df8be1c51c16bbe4885b810a","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633323091,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2186992,"avatar":"https://static001.geekbang.org/account/avatar/00/21/5e/f0/62d8cf9e.jpg","nickname":"D. D","note":"","ucode":"C416E5602C8814","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":399506,"discussion_content":"è¿™æ ·æ¯æ¬¡nextçš„æ—¶å€™éƒ½ä¼šè·³è¿‡startä¸ªå…ƒç´ ã€‚ç”¨OptionåŒ…è£¹ç€startç¨å¾®ä¿®æ”¹äº†ä¸€ä¸‹ğŸ˜‚\npub struct Window<I> {\n    iter: I,\n    count: usize,\n    start: Option<usize>,\n}\n\npub trait IteratorExt: Iterator {\n    fn window_count(self, count: usize, start: usize) -> Window<Self>\n    where\n        Self: Sized,\n    {\n        let start = if start == 0 { None } else { Some(start) };\n\n        Window {\n            iter: self,\n            count,\n            start,\n        }\n    }\n}\n\nimpl<T: Iterator> IteratorExt for T {}\n\nimpl<I: Iterator> Iterator for Window<I> {\n    type Item = Vec<<I as Iterator>::Item>;\n\n    fn next(&amp;mut self) -> Option<Self::Item> {\n        if self.count == 0 {\n            return None;\n        }\n\n        if let Some(start) = self.start.take() {\n            for _ in 0..start {\n                self.iter.next()?;\n            }\n        }\n\n        let mut v = Vec::with_capacity(self.count);\n\n        for _ in 0..self.count {\n            v.push(self.iter.next()?);\n        }\n        Some(v)\n    }\n}\n\nhttps://play.rust-lang.org/?version=stable&amp;mode=debug&amp;edition=2018&amp;gist=fef88e3b1eaf3ff93102141c30c6dae1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632979324,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314149,"user_name":"ç½—æ°","can_delete":false,"product_type":"c1","uid":1320487,"ip_address":"","ucode":"96BAFAA147341F","user_header":"https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg","comment_is_top":false,"comment_ctime":1632878863,"is_pvip":false,"replies":[{"id":"113983","content":"Rust ä¹Ÿå¯ä»¥ä½¿ç”¨ for &#47; while &#47; loopï¼Œå¹¶ä¸è§å¾—éƒ½éœ€è¦ç”¨å‡½æ•°å¼ç¼–ç¨‹æ–¹å¼ã€‚é€‰æ‹©æœ€åˆé€‚çš„æ–¹å¼å¤„ç†å°±å¥½ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Tyr","uid":"1079375","ctime":1633322211,"ip_address":"","comment_id":314149,"utype":1}],"discussion_count":4,"race_medal":2,"score":"1632878863","product_id":100085301,"comment_content":"æ¼‚äº®ï¼Œè€å¸ˆå•è§£ç­”äº†æˆ‘çš„å¥½å¤šç–‘æƒ‘ã€‚ç°åœ¨å”¯ä¸€æœ‰ç‚¹è¦é€‚åº”çš„å°±æ˜¯å‡½æ•°æ•°å¼ç¼–ç¨‹ã€‚C++ å’Œ Go å†™å¤šäº†ï¼Œä¸€ä¸Šæ¥å°±æ˜¯ for å¾ªç¯ï¼Œè¦é€‚åº” Rust çš„æƒ³æ³•ä¹Ÿæ˜¯ä¸ªä¸å°çš„æŒ‘æˆ˜ã€‚","like_count":0,"discussions":[{"author":{"id":1079375,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/4f/e74f870c.jpg","nickname":"Tyr","note":"","ucode":"EAAFC8063202E0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527588,"discussion_content":"Rust ä¹Ÿå¯ä»¥ä½¿ç”¨ for / while / loopï¼Œå¹¶ä¸è§å¾—éƒ½éœ€è¦ç”¨å‡½æ•°å¼ç¼–ç¨‹æ–¹å¼ã€‚é€‰æ‹©æœ€åˆé€‚çš„æ–¹å¼å¤„ç†å°±å¥½ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1633322211,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1102367,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d2/1f/2ef2514b.jpg","nickname":"newzai","note":"","ucode":"D5E34D427D65FD","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":402271,"discussion_content":"å¯ä»¥ç»å¸¸ç”¨clippyè¿›è¡Œä»£ç é£æ ¼æ£€æŸ¥ï¼Œæ…¢æ…¢çš„å°±ä¼šç†Ÿæ‚‰rustçš„ä»£ç é£æ ¼äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1633851231,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2763179,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/29/ab/59a6e437.jpg","nickname":"Kevin","note":"","ucode":"3588850B3370C8","race_medal":5,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":558338,"discussion_content":"ä¸ºä»€ä¹ˆC++å’Œgoä½ ä¸ç”¨å‡½æ•°å¼å†™æ³•ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648214154,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2226242,"avatar":"https://static001.geekbang.org/account/avatar/00/21/f8/42/7f66197c.jpg","nickname":"äººæ¥äººå¾€@","note":"","ucode":"F0687F6C0CDD13","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547806,"discussion_content":"å‰ç«¯erè¡¨ç¤ºè§‰å¾—è¿™ä¸ªå‡½æ•°å¼é“¾å¼è°ƒç”¨å¾ˆåƒJSçš„ æ¯”å¦‚ [].filter.map.someä¹‹ç±»çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642864302,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}