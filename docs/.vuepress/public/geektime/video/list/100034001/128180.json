{"id":128180,"title":"19 | 为了Optional：合并空值运算符","content":"<p><strong>课件地址</strong></p><p><a href=\"https://gitee.com/geektime-geekbang/swift-course\">https://gitee.com/geektime-geekbang/swift-course</a></p>","comments":[{"had_liked":false,"id":208685,"user_name":"Sinduke","can_delete":false,"product_type":"c3","uid":1962093,"ip_address":"","ucode":"857356DCDD77F9","user_header":"https://static001.geekbang.org/account/avatar/00/1d/f0/6d/74754084.jpg","comment_is_top":false,"comment_ctime":1587402266,"is_pvip":false,"replies":[{"id":79909,"content":"+ 的优先级 比 ??的优先级更高，要加括号次啊可以","user_name":"作者回复","user_name_real":"Geek_f72435","uid":1341726,"ctime":1589164984,"ip_address":"","comment_id":208685,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"return (x ?? 0) + (y ?? 0) \nreturn x ?? 0 + y ?? 0 \n运算的结果不一样","like_count":1,"discussions":[{"author":{"id":1341726,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLxtKhpmvzx2VB4iajicfJVFmQR3eP3xBpdpQEovpSqUfAOrNImvYwVb7P37ibI0ONziau9sbFEk8oDaA/132","nickname":"elfgate","note":"","ucode":"3C0B5F7C1F664C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492578,"discussion_content":"+ 的优先级 比 ??的优先级更高，要加括号次啊可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589164984,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1251437,"avatar":"https://static001.geekbang.org/account/avatar/00/13/18/6d/7eb839d4.jpg","nickname":"七崽","note":"","ucode":"7C7AFEA71A76B8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":242055,"discussion_content":"return x ?? 0 + y ?? 0\n报错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587461624,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":379087,"user_name":"Geek_Nexus","can_delete":false,"product_type":"c3","uid":3688246,"ip_address":"广东","ucode":"02EA23208BE993","user_header":"https://static001.geekbang.org/account/avatar/00/38/47/36/791d0f5e.jpg","comment_is_top":false,"comment_ctime":1691327619,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"原来在这有解释，之前看课程视频，我还纳闷这个运算符是啥意思，虽然敲代码的时候有说明，但是有点疑惑","like_count":0},{"had_liked":false,"id":352218,"user_name":"畅畅","can_delete":false,"product_type":"c3","uid":1834962,"ip_address":"","ucode":"6BCDEF603F2C14","user_header":"https://static001.geekbang.org/account/avatar/00/1b/ff/d2/67090203.jpg","comment_is_top":false,"comment_ctime":1658461065,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"类似js的 || , Kotlin 的 ?:","like_count":0},{"had_liked":false,"id":291939,"user_name":"Geek__2099","can_delete":false,"product_type":"c3","uid":1457784,"ip_address":"","ucode":"01444B60F18A66","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep8unibCib9rdHib0D6Rf6TjecPQu1yic0G9sjzriczlTcwGHP6DaxtEmHyN7pCrD9zV7OSegyf7EUBvaA/132","comment_is_top":false,"comment_ctime":1620617448,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"??符号是对optional type的使命进行了增强，通常??后面的b，是a在不同场景下的缺省值。\n它避免了本不需要的!nil判断，尤其多个optional type的变量一起运算的场景。\n\n即变量本身的非空判断，应该是在变量表现其值之前就要完成，而非在表现其值之后再用if条件判断。\n\n所以官方文档的说明是：\n1,  a最好是optional type，这是？？符号本来诞生的意义\n2，b与a的值的类型要一致，因为是缺省值。\n\n所以？？符号，翻译为合并空值运算符，其本质上还是对类型的值空间的处理。\n","like_count":0},{"had_liked":false,"id":280052,"user_name":"船长","can_delete":false,"product_type":"c3","uid":2418752,"ip_address":"","ucode":"5AD71A6E0A7C8C","user_header":"https://static001.geekbang.org/account/avatar/00/24/e8/40/fcf2fb9b.jpg","comment_is_top":false,"comment_ctime":1614066095,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"let a : Int? = nil\nprint(a ?? &quot;空值&quot;) 正常，不会报错。\nprint((a ?? &quot;空值&quot;) + 2) 报错：Cannot convert value of type &#39;String&#39; to expected argument type &#39;Int&#39;\nprint((a ?? &quot;空值&quot;).endIndex)报错：Cannot convert value of type &#39;String&#39; to expected argument type &#39;Int&#39;\n\n这个应该怎么理解呢？ 是合并空值运算符，类型不一致的时候， 导致类型模糊？","like_count":0,"discussions":[{"author":{"id":1457784,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep8unibCib9rdHib0D6Rf6TjecPQu1yic0G9sjzriczlTcwGHP6DaxtEmHyN7pCrD9zV7OSegyf7EUBvaA/132","nickname":"Geek__2099","note":"","ucode":"01444B60F18A66","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373105,"discussion_content":"第一句 将 ( a ?? “空值” )  强制转换为Any类型，所以不报错。\n第2，3句  将 ( a ?? “空值” )  强制转换为Int类型，所以报错。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620615318,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":268359,"user_name":"Geek_jg3r26","can_delete":false,"product_type":"c3","uid":1454691,"ip_address":"","ucode":"7D093ED7273CBE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEK5icO2A4K7HYTYfQoagTz7VbtgxfS2ibBqLnKVWwQZgsePibZWFvFJEhPT8BtpQSaFx9IEodyp6c0dw/132","comment_is_top":false,"comment_ctime":1608168901,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"这个会抱个警告，意思右边的表达式永远不执行","like_count":0},{"had_liked":false,"id":253559,"user_name":"geek","can_delete":false,"product_type":"c3","uid":1023245,"ip_address":"","ucode":"6A40AB43730A11","user_header":"","comment_is_top":false,"comment_ctime":1602775993,"is_pvip":false,"replies":null,"discussion_count":2,"race_medal":0,"score":2,"product_id":100034001,"comment_content":"a ?? b 和 (a !=nil ? a! : b) 还是不太一样的。\n如果b是可选类型且a不为nil，\n那么a ?? b的值还是a(不会解包)；\n而(a !=nil ? a! : b)的值为a!","like_count":0,"discussions":[{"author":{"id":1457784,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep8unibCib9rdHib0D6Rf6TjecPQu1yic0G9sjzriczlTcwGHP6DaxtEmHyN7pCrD9zV7OSegyf7EUBvaA/132","nickname":"Geek__2099","note":"","ucode":"01444B60F18A66","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373108,"discussion_content":"按官方要求b不能是optional类型。此时两者是一致的。\n当b是可选类型时，结果会根据b值类型是否与a值类型一致出现分化。那就复杂了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620616662,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1454691,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEK5icO2A4K7HYTYfQoagTz7VbtgxfS2ibBqLnKVWwQZgsePibZWFvFJEhPT8BtpQSaFx9IEodyp6c0dw/132","nickname":"Geek_jg3r26","note":"","ucode":"7D093ED7273CBE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335263,"discussion_content":"let opa: Int? = 8\nlet opb = opa ?? 10\nprint(opb)\n我测试的可以解包，输出8, 不是 Optional(8)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608131824,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}