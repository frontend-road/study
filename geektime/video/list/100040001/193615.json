{"id":193615,"title":"41 | MongoDB应用场景及选型","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-mongodb-course\">https://gitee.com/geektime-geekbang/geektime-mongodb-course</a></p>","comments":[{"had_liked":false,"id":186471,"user_name":"hello","can_delete":false,"product_type":"c3","uid":1464199,"ip_address":"","ucode":"854500026E2187","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKhuGLVRYZibOTfMumk53Wn8Q0Rkg0o6DzTicbibCq42lWQoZ8lFeQvicaXuZa7dYsr9URMrtpXMVDDww/132","comment_is_top":false,"comment_ctime":1583849894,"is_pvip":false,"replies":[{"id":72144,"content":"很多团队还是会用关系型数据库，譬如：\n\n- 不需要处理大数据高并发\n- 数据模型迭代性不强，或者对团队不觉得是个痛点\n- 没有时间去了解一个新的技术\n\n","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1584002308,"ip_address":"","comment_id":186471,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师，像您这样对比，感觉没关系数据库什么事了哟","like_count":5,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486768,"discussion_content":"很多团队还是会用关系型数据库，譬如：\n\n- 不需要处理大数据高并发\n- 数据模型迭代性不强，或者对团队不觉得是个痛点\n- 没有时间去了解一个新的技术\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584002308,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1438475,"avatar":"https://static001.geekbang.org/account/avatar/00/15/f3/0b/4560079e.jpg","nickname":"王宇","note":"","ucode":"0E9BC3AD99C8E5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":220720,"discussion_content":"来个深入的sql nosql的对比才行 ","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1585920523,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":200541,"user_name":"李英权","can_delete":false,"product_type":"c3","uid":1076081,"ip_address":"","ucode":"FECAC14A9C414B","user_header":"https://static001.geekbang.org/account/avatar/00/10/6b/71/e833b14a.jpg","comment_is_top":false,"comment_ctime":1585617321,"is_pvip":false,"replies":[{"id":75809,"content":"同意！","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1586081183,"ip_address":"","comment_id":200541,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"数据仓库需要汇集同步很多来源的数据，而且实时性高的同步可能出现高并发写入，所以数据中台也很适合。\n金融风控类系统 需要对接很多外部征信数据接口，数据结构比较杂、不稳定，也非常适合mongodb。\nerp等逻辑模型特别多的，也适合，哈哈哈","like_count":2,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490060,"discussion_content":"同意！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586081183,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":198244,"user_name":"hellojd_gk","can_delete":false,"product_type":"c3","uid":1679543,"ip_address":"","ucode":"319AF4C1AD568D","user_header":"https://static001.geekbang.org/account/avatar/00/19/a0/b7/1327ae60.jpg","comment_is_top":false,"comment_ctime":1585436603,"is_pvip":false,"replies":[{"id":75818,"content":"这个很合适。可以存更多天的数据，甚至几个月，如果你采用分片的话。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1586082474,"ip_address":"","comment_id":198244,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"我们有个系统消息表，每天要推送的消息特别多。涉及到规则匹配【json格式，与用户标签匹配】，未读消息拉取，消息的推送流程【请求，响应】管理，消息文本大小变化也有点大，为了追求效率，只保留7天数据。我们用的是mysql,改到mongo合适吗？用到什么模式比较好","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489672,"discussion_content":"这个很合适。可以存更多天的数据，甚至几个月，如果你采用分片的话。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586082474,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":182869,"user_name":"密码123456","can_delete":false,"product_type":"c3","uid":1126593,"ip_address":"","ucode":"9889463CC0EA71","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/c1/2dde6700.jpg","comment_is_top":false,"comment_ctime":1582879986,"is_pvip":false,"replies":[{"id":70939,"content":"非常到位！","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1583027857,"ip_address":"","comment_id":182869,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"JSON建模、复制集、分片、事务。我觉得是最大亮点和特色","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485478,"discussion_content":"非常到位！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583027857,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":176646,"user_name":"风萧雨瑟","can_delete":false,"product_type":"c3","uid":1317323,"ip_address":"","ucode":"5E832ABE126393","user_header":"https://static001.geekbang.org/account/avatar/00/14/19/cb/70a2b47e.jpg","comment_is_top":false,"comment_ctime":1581128634,"is_pvip":false,"replies":[{"id":68934,"content":"MongoDB 3.6版本开始支持JSON Schema，可以用来做比较严谨的数据模型管理。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1581429691,"ip_address":"","comment_id":176646,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师您好，mongodb灵活的涉及模式，但本身无schema管理，导致容易产生一些脏数据，除了做好校验外，有没有更好一点的办法？","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483170,"discussion_content":"MongoDB 3.6版本开始支持JSON Schema，可以用来做比较严谨的数据模型管理。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581429691,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":251360,"user_name":"jackhance","can_delete":false,"product_type":"c3","uid":1261634,"ip_address":"","ucode":"934B0D20CCD06C","user_header":"https://static001.geekbang.org/account/avatar/00/13/40/42/d5c23178.jpg","comment_is_top":false,"comment_ctime":1601481058,"is_pvip":true,"replies":[{"id":93807,"content":"MongoDB依赖内存缓存加速所以是需要更多一些资源","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1604037255,"ip_address":"","comment_id":251360,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"事务、复制集、分片、数据格式（比如新增字段），感觉都比关系型数据库来的方便很多\n但是运行起来，内存方面好像是比关系型数据库要高","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506464,"discussion_content":"MongoDB依赖内存缓存加速所以是需要更多一些资源","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604037255,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":198245,"user_name":"hellojd_gk","can_delete":false,"product_type":"c3","uid":1679543,"ip_address":"","ucode":"319AF4C1AD568D","user_header":"https://static001.geekbang.org/account/avatar/00/19/a0/b7/1327ae60.jpg","comment_is_top":false,"comment_ctime":1585437075,"is_pvip":false,"replies":[{"id":75817,"content":"内存里会占用更多一些空间因为字段名重复的原因，但是落盘还好，因为有落盘压缩（默认开启）。我很久以前比较过一个，落盘后反而更小。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1586082420,"ip_address":"","comment_id":198245,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"说到json格式，我就会想到灵活，扩展好。但缺点也有，耗费空间，不知道和mysql对比，空间这块怎么样。老师课程里一直，没明确说明","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489673,"discussion_content":"内存里会占用更多一些空间因为字段名重复的原因，但是落盘还好，因为有落盘压缩（默认开启）。我很久以前比较过一个，落盘后反而更小。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586082420,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":178840,"user_name":"qbit","can_delete":false,"product_type":"c3","uid":1262927,"ip_address":"","ucode":"96C70A1E47B93D","user_header":"https://static001.geekbang.org/account/avatar/00/13/45/4f/f94caf47.jpg","comment_is_top":false,"comment_ctime":1581839445,"is_pvip":false,"replies":[{"id":70080,"content":"可以放，但是不一定是最理想的。 我可能不会这么做。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1582347356,"ip_address":"","comment_id":178840,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"看到“内容管理”的部分，似乎说 MongoDB 可以用来存放视频？真的可以将几百兆或者更大的视频直接存在 MongoDB 里面吗？或者说这样说是合理的吗？","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483990,"discussion_content":"可以放，但是不一定是最理想的。 我可能不会这么做。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582347356,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312044,"user_name":"Kian.Lee","can_delete":false,"product_type":"c3","uid":1086568,"ip_address":"","ucode":"3FB08A00F2DFD7","user_header":"https://static001.geekbang.org/account/avatar/00/10/94/68/56794ea3.jpg","comment_is_top":false,"comment_ctime":1631603298,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"其实和单机关系型数据库比较有些降维打击，MongoDB 的真正对手应该是关系型分布式数据库（如：Spanner、TiDB、CockroachDB、OceanBase等），而后者完整的继承了关系型数据库生态，使得开发者可以使用自己熟悉的技术及对现有项目不做改动或少量改动即可实现海量并发、海量存储、高可靠的项目目标，这个可能是技术选型时 MongoDB 面临的主要挑战。","like_count":14},{"had_liked":false,"id":312187,"user_name":"木头发芽","can_delete":false,"product_type":"c3","uid":1419723,"ip_address":"","ucode":"657B381C5DA963","user_header":"https://static001.geekbang.org/account/avatar/00/15/a9/cb/a431bde5.jpg","comment_is_top":false,"comment_ctime":1631676119,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"@Kian.Lee \n同意,跟分布式关系型数据库比,mongodb的唯一优势就是模型灵活这点了, 但像交易,订单类的这种模型相对固定的还是分布式关系型数据库来的好. \n所以选型的时候有些业务部分可以用关系型 有的用nosql的, 灵活搭配.并不是非此即彼","like_count":2},{"had_liked":false,"id":283032,"user_name":"。","can_delete":false,"product_type":"c3","uid":1222200,"ip_address":"","ucode":"75B163F01F20F3","user_header":"https://static001.geekbang.org/account/avatar/00/12/a6/38/55483b8c.jpg","comment_is_top":false,"comment_ctime":1615527441,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"唐老师好，不知道是否还能得到回复。\n\n我现在有一个使用场景，不知道采用mongodb是否适用：前台传过来一个大的json数组（20MB左右）由5000个左右的小json数据组成。\n\n1.我想把这个大json数组拆分成小json来存储，那就是5000个左右的json文档，批量插入的性能怎么样？\n2.前台需要查询上一步插入的大json数组，我拆分成5000个文档后，一次查询这么多数据或者分几次查询之后通过业务代码拼装。这个性能怎么样？\n\n以上两个问题，麻烦唐老师解惑：）","like_count":1,"discussions":[{"author":{"id":1419723,"avatar":"https://static001.geekbang.org/account/avatar/00/15/a9/cb/a431bde5.jpg","nickname":"木头发芽","note":"","ucode":"657B381C5DA963","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393973,"discussion_content":"既然你查询也是要一次性获取大json,那你存的时候要要拆干啥?  如果是查询的时候需要查小json的,那也可以用大json的_id加小json的条件的方式去查啊,","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1631675821,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":363445,"user_name":"王周敬","can_delete":false,"product_type":"c3","uid":1989737,"ip_address":"北京","ucode":"ABAC941339CBED","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/qUHuge7oea6mA4bUTyJ4ro9RYsGNOrXe6XccO7fV90xyaC5HgjG2DwJvauQiavcuS0KQFq5U1JUFLHtH6gZULag/132","comment_is_top":false,"comment_ctime":1669690980,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"在数据分析方面 mongodb和clickhouse哪个更好","like_count":0},{"had_liked":false,"id":362957,"user_name":"wljs","can_delete":false,"product_type":"c3","uid":1306543,"ip_address":"广东","ucode":"6B88A664972AD2","user_header":"https://static001.geekbang.org/account/avatar/00/13/ef/af/adce8c49.jpg","comment_is_top":false,"comment_ctime":1669079588,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"唐建法老师你好！我有大事情要联系你，请问mongodb的性能调优和压力测试怎么做才能达到100万并发？收到请联系我微信 huangguirong6 好吗","like_count":0},{"had_liked":false,"id":275441,"user_name":"fmouse","can_delete":false,"product_type":"c3","uid":1202325,"ip_address":"","ucode":"9A8858CFFAB858","user_header":"https://static001.geekbang.org/account/avatar/00/12/58/95/640b6465.jpg","comment_is_top":false,"comment_ctime":1611542257,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"老师，我有点疑问。mongo是OLTP数据库，聚合运算和报表等更适合用OLAP数据库处理吧。不知道mongo的存储结构是什么样的。","like_count":0},{"had_liked":false,"id":243739,"user_name":"韦善运","can_delete":false,"product_type":"c3","uid":1308569,"ip_address":"","ucode":"6D3812E664FED8","user_header":"https://static001.geekbang.org/account/avatar/00/13/f7/99/5b7062fa.jpg","comment_is_top":false,"comment_ctime":1598261589,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"老师，mongodb索引结构也是B+数，为什么它的聚合查询能够比mysql 好","like_count":0}]}