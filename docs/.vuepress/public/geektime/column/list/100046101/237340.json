{"id":237340,"title":"åŠ é¤ | ZABåè®®ï¼ˆäºŒï¼‰ï¼šå¦‚ä½•ä»æ•…éšœä¸­æ¢å¤ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯éŸ©å¥ã€‚</p><p>æˆ‘ä»¬ä¸Šä¸€è®²æåˆ°äº†ZABçš„é¢†å¯¼è€…é€‰ä¸¾ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œå®ƒåªæ˜¯é€‰ä¸¾äº†ä¸€ä¸ªé€‚åˆå½“é¢†å¯¼è€…çš„èŠ‚ç‚¹ï¼Œç„¶åæŠŠè¿™ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€è®¾ç½®æˆLEADINGçŠ¶æ€ã€‚æ­¤æ—¶ï¼Œè¿™ä¸ªèŠ‚ç‚¹è¿˜ä¸èƒ½ä½œä¸ºä¸»èŠ‚ç‚¹å¤„ç†å†™è¯·æ±‚ï¼Œä¹Ÿä¸èƒ½ä½¿ç”¨é¢†å¯¼èŒèƒ½ï¼ˆæ¯”å¦‚ï¼Œå®ƒæ²¡åŠæ³•é˜»æ­¢å…¶ä»–â€œé¢†å¯¼è€…â€å¹¿æ’­ææ¡ˆï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé›†ç¾¤è¿˜æ²¡æœ‰ä»æ•…éšœä¸­æ¢å¤è¿‡æ¥ï¼Œè€Œæˆå‘˜å‘ç°å’Œæ•°æ®åŒæ­¥ä¼šè§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œæˆå‘˜å‘ç°å’Œæ•°æ®åŒæ­¥ä¸ä»…è®©æ–°é¢†å¯¼è€…æ­£å¼æˆä¸ºé¢†å¯¼è€…ï¼Œç¡®ç«‹äº†å®ƒçš„é¢†å¯¼å…³ç³»ï¼Œè¿˜è§£å†³äº†å„å‰¯æœ¬çš„æ•°æ®å†²çªï¼Œå®ç°äº†æ•°æ®å‰¯æœ¬çš„ä¸€è‡´æ€§ã€‚è¿™æ ·ä¸€æ¥ï¼Œé›†ç¾¤å°±èƒ½æ­£å¸¸å¤„ç†å†™è¯·æ±‚äº†ã€‚åœ¨è¿™å¥è¯é‡Œï¼š</p><ul>\n<li>ç¡®ç«‹é¢†å¯¼å…³ç³»ï¼Œä¹Ÿå°±æ˜¯åœ¨æˆå‘˜å‘ç°ï¼ˆDISCOVERYï¼‰é˜¶æ®µï¼Œé¢†å¯¼è€…å’Œå¤§å¤šæ•°è·Ÿéšè€…å»ºç«‹è¿æ¥ï¼Œå¹¶å†æ¬¡ç¡®è®¤å„èŠ‚ç‚¹å¯¹è‡ªå·±å½“é€‰é¢†å¯¼è€…æ²¡æœ‰å¼‚è®®ï¼Œç¡®ç«‹è‡ªå·±çš„é¢†å¯¼å…³ç³»ï¼›</li>\n<li>å¤„ç†å†²çªæ•°æ®ï¼Œä¹Ÿå°±æ˜¯åœ¨æ•°æ®åŒæ­¥ï¼ˆSYNCHRONIZATIONï¼‰é˜¶æ®µï¼Œé¢†å¯¼è€…ä»¥è‡ªå·±çš„æ•°æ®ä¸ºå‡†ï¼Œè§£å†³å„èŠ‚ç‚¹æ•°æ®å‰¯æœ¬çš„ä¸ä¸€è‡´ã€‚</li>\n</ul><p>å¯¹ä½ æ¥è¯´ï¼Œç†è§£è¿™ä¸¤ç‚¹ï¼Œå¯ä»¥æ›´å¥½åœ°ç†è§£ZooKeeperæ€ä¹ˆæ¢å¤æ•…éšœï¼Œä»¥åŠå½“ä¸»èŠ‚ç‚¹å´©æºƒäº†ï¼Œå“ªäº›æ•°æ®ä¼šä¸¢å¤±ï¼Œå“ªäº›ä¸ä¼šï¼Œä»¥åŠèƒŒåçš„åŸå› ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä½ èƒ½æ›´åŠ æ·±åˆ»åœ°ç†è§£ZooKeeperçš„èŠ‚ç‚¹æ•…éšœå®¹é”™èƒ½åŠ›ã€‚</p><p>é‚£ä¹ˆè¯´äº†è¿™ä¹ˆå¤šï¼Œé›†ç¾¤å…·ä½“æ˜¯æ€ä¹ˆä»æ•…éšœä¸­æ¢å¤è¿‡æ¥çš„å‘¢ï¼Ÿå¸¦ç€è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬è¿›å…¥ä»Šå¤©çš„å­¦ä¹ ã€‚</p><!-- [[[read_end]]] --><h2>ZABé›†ç¾¤æ€ä¹ˆä»æ•…éšœä¸­æ¢å¤è¿‡æ¥ï¼Ÿ</h2><p>å¦‚æœæˆ‘ä»¬æƒ³æŠŠZABé›†ç¾¤æ¢å¤åˆ°æ­£å¸¸çŠ¶æ€ï¼Œé‚£ä¹ˆæ–°é¢†å¯¼è€…å°±è¦ç¡®ç«‹è‡ªå·±çš„é¢†å¯¼å…³ç³»ï¼Œæˆä¸ºå”¯ä¸€æœ‰æ•ˆçš„é¢†å¯¼è€…ï¼Œç„¶åä½œä¸ºä¸»èŠ‚ç‚¹â€œé¢†å¯¼â€å„å¤‡ä»½èŠ‚ç‚¹ä¸€èµ·å¤„ç†è¯»å†™è¯·æ±‚ã€‚</p><h3>å¦‚ä½•ç¡®ç«‹é¢†å¯¼å…³ç³»ï¼Ÿ</h3><p>é‚£ä¹ˆé€šè¿‡å¼€ç¯‡ï¼Œä½ å¯ä»¥çŸ¥é“ï¼Œé€‰ä¸¾å‡ºçš„é¢†å¯¼è€…ï¼Œæ˜¯åœ¨æˆå‘˜å‘ç°é˜¶æ®µç¡®ç«‹é¢†å¯¼å…³ç³»çš„ã€‚</p><p>åœ¨å½“é€‰åï¼Œé¢†å¯¼è€…ä¼šé€’å¢è‡ªå·±çš„ä»»æœŸç¼–å·ï¼Œå¹¶åŸºäºä»»æœŸç¼–å·å€¼çš„å¤§å°ï¼Œæ¥å’Œè·Ÿéšè€…åå•†ï¼Œæœ€ç»ˆå»ºç«‹é¢†å¯¼å…³ç³»ã€‚<strong>å…·ä½“è¯´çš„è¯ï¼Œå°±æ˜¯è·Ÿéšè€…ä¼šé€‰æ‹©ä»»æœŸç¼–å·å€¼æœ€å¤§çš„èŠ‚ç‚¹ï¼Œä½œä¸ºè‡ªå·±çš„é¢†å¯¼è€…ï¼Œè€Œè¢«å¤§å¤šæ•°èŠ‚ç‚¹è®¤åŒçš„é¢†å¯¼è€…ï¼Œå°†æˆä¸ºçœŸæ­£çš„é¢†å¯¼è€…ã€‚</strong></p><p>æˆ‘ä¸¾ä¸ªä¾‹å­ï¼Œå…·ä½“å¸®ä½ ç†è§£ä¸€ä¸‹ã€‚</p><p>å‡è®¾ä¸€ä¸ªZooKeeperé›†ç¾¤ï¼Œç”±èŠ‚ç‚¹Aã€Bã€Cç»„æˆã€‚å…¶ä¸­ï¼Œé¢†å¯¼è€…Aå·²ç»å®•æœºï¼ŒCæ˜¯æ–°é€‰å‡ºæ¥çš„é¢†å¯¼è€…ï¼ŒBæ˜¯æ–°çš„è·Ÿéšè€…ï¼ˆä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œå‡è®¾Bã€Cå·²æäº¤ææ¡ˆçš„äº‹åŠ¡æ ‡è¯†ç¬¦æœ€å¤§å€¼åˆ†åˆ«æ˜¯&lt;1, 10&gt;å’Œ&lt;1, 11&gt;ï¼Œå…¶ä¸­1æ˜¯ä»»æœŸç¼–å·ï¼Œ10ã€11æ˜¯äº‹åŠ¡æ ‡è¯†ç¬¦ä¸­çš„è®¡æ•°å™¨å€¼ï¼ŒAå®•æœºå‰çš„ä»»æœŸç¼–å·ä¹Ÿæ˜¯1ï¼‰ã€‚é‚£ä¹ˆBã€Cå¦‚ä½•åå•†å»ºç«‹é¢†å¯¼å…³ç³»å‘¢ï¼Ÿ</p><p><img src=\"https://static001.geekbang.org/resource/image/9a/34/9a31fd8f5d888abfb014b07408c4be34.jpg?wh=1142*596\" alt=\"\" title=\"å›¾1\"></p><p>é¦–å…ˆï¼ŒBã€Cä¼šæŠŠè‡ªå·±çš„ZABçŠ¶æ€è®¾ç½®ä¸ºæˆå‘˜å‘ç°ï¼ˆDISCOVERYï¼‰ï¼Œè¿™å°±è¡¨æ˜ï¼Œé€‰ä¸¾ï¼ˆELECTIONï¼‰é˜¶æ®µç»“æŸäº†ï¼Œè¿›å…¥äº†ä¸‹ä¸€ä¸ªé˜¶æ®µï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/5c/8c/5c933b8033238c2f58ea19c39bf12f8c.jpg?wh=1142*564\" alt=\"\" title=\"å›¾2\"></p><p>åœ¨è¿™é‡Œï¼Œæˆ‘æƒ³è¡¥å……ä¸€ä¸‹ï¼ŒZABå®šä¹‰äº†4ç§çŠ¶æ€ï¼Œæ¥æ ‡è¯†èŠ‚ç‚¹çš„è¿è¡ŒçŠ¶æ€ã€‚</p><ul>\n<li>ELECTIONï¼ˆé€‰ä¸¾çŠ¶æ€ï¼‰ï¼šè¡¨æ˜èŠ‚ç‚¹åœ¨è¿›è¡Œé¢†å¯¼è€…é€‰ä¸¾ï¼›</li>\n<li>DISCOVERYï¼ˆæˆå‘˜å‘ç°çŠ¶æ€ï¼‰ï¼šè¡¨æ˜èŠ‚ç‚¹åœ¨åå•†æ²Ÿé€šé¢†å¯¼è€…çš„åˆæ³•æ€§ï¼›</li>\n<li>SYNCHRONIZATIONï¼ˆæ•°æ®åŒæ­¥çŠ¶æ€ï¼‰ï¼šè¡¨æ˜é›†ç¾¤çš„å„èŠ‚ç‚¹ä»¥é¢†å¯¼è€…çš„æ•°æ®ä¸ºå‡†ï¼Œä¿®å¤æ•°æ®å‰¯æœ¬çš„ä¸€è‡´æ€§ï¼›</li>\n<li>BROADCASTï¼ˆå¹¿æ’­çŠ¶æ€ï¼‰ï¼šè¡¨æ˜é›†ç¾¤å„èŠ‚ç‚¹åœ¨æ­£å¸¸å¤„ç†å†™è¯·æ±‚ã€‚</li>\n</ul><p>å…³äºè¿™4ç§çŠ¶æ€ï¼Œä½ çŸ¥é“å®ƒä»¬æ˜¯åšä»€ä¹ˆçš„å°±å¯ä»¥äº†ã€‚æˆ‘å°±å¼ºè°ƒä¸€ç‚¹ï¼Œ<strong>åªæœ‰å½“é›†ç¾¤å¤§å¤šæ•°èŠ‚ç‚¹å¤„äºå¹¿æ’­çŠ¶æ€çš„æ—¶å€™ï¼Œé›†ç¾¤æ‰èƒ½æäº¤ææ¡ˆã€‚</strong></p><p>æ¥ä¸‹æ¥ï¼ŒBä¼šä¸»åŠ¨è”ç³»Cï¼Œå‘é€ç»™å®ƒåŒ…å«è‡ªå·±æ¥æ”¶è¿‡çš„é¢†å¯¼è€…ä»»æœŸç¼–å·æœ€å¤§å€¼ï¼ˆä¹Ÿå°±æ˜¯å‰é¢†å¯¼è€…Açš„ä»»æœŸç¼–å·ï¼Œ1ï¼‰çš„FOLLOWINFOæ¶ˆæ¯ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f5/56/f5209e12171cffbe1ed4a9b4835eca56.jpg?wh=1142*556\" alt=\"\" title=\"å›¾3\"></p><p>å½“Cæ¥æ”¶æ¥è‡ªBçš„ä¿¡æ¯æ—¶ï¼Œå®ƒä¼šå°†åŒ…å«è‡ªå·±äº‹åŠ¡æ ‡è¯†ç¬¦æœ€å¤§å€¼çš„LEADINFOæ¶ˆæ¯å‘ç»™è·Ÿéšè€…ã€‚</p><p>ä½ è¦æ³¨æ„ï¼Œé¢†å¯¼è€…è¿›å…¥åˆ°æˆå‘˜å‘ç°é˜¶æ®µåï¼Œä¼šå¯¹ä»»æœŸç¼–å·åŠ 1ï¼Œåˆ›å»ºæ–°çš„ä»»æœŸç¼–å·ï¼Œç„¶ååŸºäºæ–°ä»»æœŸç¼–å·ï¼Œåˆ›å»ºæ–°çš„äº‹åŠ¡æ ‡è¯†ç¬¦ï¼ˆä¹Ÿå°±æ˜¯&lt;2, 0&gt;ï¼‰ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f5/15/f54d28ba395fa1fd8bfa1f95e2574815.jpg?wh=1142*565\" alt=\"\" title=\"å›¾4\"></p><p>å½“æ¥æ”¶åˆ°é¢†å¯¼è€…çš„å“åº”åï¼Œè·Ÿéšè€…ä¼šåˆ¤æ–­é¢†å¯¼è€…çš„ä»»æœŸç¼–å·æ˜¯å¦æœ€æ–°ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±å‘èµ·æ–°çš„é€‰ä¸¾ï¼›å¦‚æœæ˜¯ï¼Œè·Ÿéšè€…è¿”å›ACKEPOCHæ¶ˆæ¯ç»™é¢†å¯¼è€…ã€‚åœ¨è¿™é‡Œï¼ŒCçš„ä»»æœŸç¼–å·ï¼ˆä¹Ÿå°±æ˜¯2ï¼‰å¤§äºBæ¥å—è¿‡çš„å…¶ä»–é¢†å¯¼ä»»æœŸç¼–å·ï¼ˆä¹Ÿå°±æ˜¯æ—§é¢†å¯¼è€…Açš„ä»»æœŸç¼–å·ï¼Œ1ï¼‰ï¼Œæ‰€ä»¥Bè¿”å›ç¡®è®¤å“åº”ç»™Cï¼Œå¹¶è®¾ç½®ZABçŠ¶æ€ä¸ºæ•°æ®åŒæ­¥ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/ef/79/ef46c226ad137738100c9764dff96879.jpg?wh=1142*543\" alt=\"\" title=\"å›¾5\"></p><p>æœ€åï¼Œå½“é¢†å¯¼è€…æ¥æ”¶åˆ°æ¥è‡ªå¤§å¤šæ•°èŠ‚ç‚¹çš„ACKEPOCHæ¶ˆæ¯æ—¶ï¼Œå°±è®¾ç½®ZABçŠ¶æ€ä¸ºæ•°æ®åŒæ­¥ã€‚åœ¨è¿™é‡Œï¼ŒCæ¥æ”¶åˆ°äº†Bçš„æ¶ˆæ¯ï¼Œå†åŠ ä¸ŠCè‡ªå·±ï¼Œå°±æ˜¯å¤§å¤šæ•°äº†ï¼Œæ‰€ä»¥ï¼Œåœ¨æ¥æ”¶åˆ°æ¥è‡ªBçš„æ¶ˆæ¯åï¼ŒCè®¾ç½®ZABçŠ¶æ€ä¸ºæ•°æ®åŒæ­¥ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/0f/41/0f7569a56088a5df3383b64313d55541.jpg?wh=1142*544\" alt=\"\" title=\"å›¾6\"></p><p><strong>ç°åœ¨ï¼ŒZABåœ¨æˆå‘˜å‘ç°é˜¶æ®µç¡®ç«‹äº†é¢†å¯¼è€…çš„é¢†å¯¼å…³ç³»ï¼Œä¹‹åé¢†å¯¼è€…å°±å¯ä»¥è¡Œä½¿é¢†å¯¼èŒèƒ½äº†ã€‚</strong>è€Œè¿™æ—¶å®ƒé¦–å…ˆè¦è§£å†³çš„å°±æ˜¯æ•°æ®å†²çªï¼Œå®ç°å„èŠ‚ç‚¹æ•°æ®çš„ä¸€è‡´æ€§ï¼Œé‚£ä¹ˆå®ƒæ˜¯æ€ä¹ˆåšçš„å‘¢ï¼Ÿ</p><h3>å¦‚ä½•å¤„ç†å†²çªæ•°æ®ï¼Ÿ</h3><p>å½“è¿›å…¥åˆ°æ•°æ®åŒæ­¥çŠ¶æ€åï¼Œé¢†å¯¼è€…ä¼šæ ¹æ®è·Ÿéšè€…çš„äº‹åŠ¡æ ‡è¯†ç¬¦æœ€å¤§å€¼ï¼Œåˆ¤æ–­ä»¥å“ªç§æ–¹å¼å¤„ç†ä¸ä¸€è‡´æ•°æ®ï¼ˆæœ‰DIFFã€TRUNCã€SNAPè¿™3ç§æ–¹å¼ï¼Œåé¢æˆ‘ä¼šå…·ä½“è¯´ä¸€è¯´ï¼‰ã€‚</p><p>å› ä¸ºCå·²æäº¤ææ¡ˆçš„äº‹åŠ¡æ ‡è¯†ç¬¦æœ€å¤§å€¼ï¼ˆä¹Ÿå°±æ˜¯&lt;1, 11&gt;ï¼‰å¤§äºBå·²æäº¤ææ¡ˆçš„äº‹åŠ¡æ ‡è¯†ç¬¦æœ€å¤§å€¼ï¼ˆä¹Ÿå°±æ˜¯&lt;1, 10&gt;ï¼‰ï¼Œæ‰€ä»¥Cä¼šç”¨DIFFçš„æ–¹å¼ä¿®å¤æ•°æ®å‰¯æœ¬çš„ä¸ä¸€è‡´ï¼Œå¹¶è¿”å›å·®å¼‚æ•°æ®ï¼ˆä¹Ÿå°±æ˜¯äº‹åŠ¡æ ‡è¯†ç¬¦ä¸º&lt;1, 11&gt;çš„ææ¡ˆï¼‰å’ŒNEWLEADERæ¶ˆæ¯ç»™Bã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/aa/7a/aa434b6ef27b7e702857d796ae53257a.jpg?wh=1142*534\" alt=\"\" title=\"å›¾7\"></p><p><strong>åœ¨è¿™é‡Œï¼Œæˆ‘æƒ³å¼ºè°ƒä¸€ç‚¹ï¼šBå·²æäº¤ææ¡ˆçš„æœ€å¤§å€¼ï¼Œä¹Ÿæ˜¯å®ƒæœ€æ–°ææ¡ˆçš„æœ€å¤§å€¼ã€‚</strong>å› ä¸ºåœ¨ZooKeeperå®ç°ä¸­ï¼ŒèŠ‚ç‚¹é€€å‡ºè·Ÿéšè€…çŠ¶æ€æ—¶ï¼ˆä¹Ÿå°±æ˜¯åœ¨è¿›å…¥é€‰ä¸¾å‰ï¼‰ï¼Œæ‰€æœ‰æœªæäº¤çš„ææ¡ˆéƒ½ä¼šè¢«æäº¤ã€‚è¿™æ˜¯ZooKeeperçš„è®¾è®¡ï¼Œä½ çŸ¥é“æœ‰è¿™ä¹ˆä¸ªäº‹å°±å¯ä»¥äº†ã€‚</p><p>ç„¶åï¼ŒBä¿®å¤ä¸ä¸€è‡´æ•°æ®ï¼Œè¿”å›NEWLEADERæ¶ˆæ¯çš„ç¡®è®¤å“åº”ç»™é¢†å¯¼è€…ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/87/06/87308ab8b9ba6eabc9217d0eeba03d06.jpg?wh=1142*509\" alt=\"\" title=\"å›¾8\"></p><p>æ¥ç€ï¼Œå½“é¢†å¯¼è€…æ¥æ”¶åˆ°æ¥è‡ªå¤§å¤šæ•°èŠ‚ç‚¹çš„NEWLEADERæ¶ˆæ¯çš„ç¡®è®¤å“åº”ï¼Œå°†è®¾ç½®ZABçŠ¶æ€ä¸ºå¹¿æ’­ã€‚åœ¨è¿™é‡Œï¼ŒCæ¥æ”¶åˆ°Bçš„ç¡®è®¤å“åº”ï¼ŒåŠ ä¸ŠCè‡ªå·±ï¼Œå°±æ˜¯å¤§å¤šæ•°ç¡®è®¤äº†ã€‚æ‰€ä»¥ï¼Œåœ¨æ¥æ”¶åˆ°æ¥è‡ªBçš„ç¡®è®¤å“åº”åï¼ŒCè®¾ç½®è‡ªå·±çš„ZABçŠ¶æ€ä¸ºå¹¿æ’­ï¼Œå¹¶å‘é€UPTODATEæ¶ˆæ¯ç»™æ‰€æœ‰è·Ÿéšè€…ï¼Œé€šçŸ¥å®ƒä»¬æ•°æ®åŒæ­¥å·²ç»å®Œæˆäº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a5/26/a53e5ea1bbc85f2d80e766bd85382d26.jpg?wh=1142*537\" alt=\"\" title=\"å›¾9\"></p><p>æœ€åå½“Bæ¥æ”¶åˆ°UPTODATEæ¶ˆæ¯æ—¶ï¼Œå®ƒå°±çŸ¥é“æ•°æ®åŒæ­¥å®Œæˆäº†ï¼Œå°±è®¾ç½®ZABçŠ¶æ€ä¸ºå¹¿æ’­ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/42/65/42d2162cb833a3b50fd44ba00556ed65.jpg?wh=1142*535\" alt=\"\" title=\"å›¾10\"></p><p>è¿™ä¸ªæ—¶å€™ï¼Œé›†ç¾¤å°±å¯ä»¥æ­£å¸¸å¤„ç†å†™è¯·æ±‚äº†ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘å·²ç»è®²å®Œäº†æ•…éšœæ¢å¤çš„åŸç†ï¼Œé‚£æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥çœ‹ä¸€çœ‹ZooKeeperåˆ°åº•æ˜¯æ€ä¹ˆå®ç°çš„å§ã€‚</p><h2>ZooKeeperå¦‚ä½•æ¢å¤æ•…éšœï¼Ÿ</h2><h3>æˆå‘˜å‘ç°</h3><p>æˆå‘˜å‘ç°æ˜¯é€šè¿‡è·Ÿéšè€…å’Œé¢†å¯¼è€…äº¤äº’æ¥å®Œæˆçš„ï¼Œ<strong>ç›®æ ‡æ˜¯ç¡®ä¿å¤§å¤šæ•°èŠ‚ç‚¹å¯¹é¢†å¯¼è€…çš„é¢†å¯¼å…³ç³»æ²¡æœ‰å¼‚è®®ï¼Œä¹Ÿå°±æ˜¯ç¡®ç«‹é¢†å¯¼è€…çš„é¢†å¯¼åœ°ä½ã€‚</strong></p><p>å¤§æ¦‚çš„å®ç°æµç¨‹ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/90/c6/900afb50caffdee9d0fa46cc121893c6.jpg?wh=1142*865\" alt=\"\" title=\"å›¾11\"></p><p>ä¸ºå¸®ä½ æ›´å¥½åœ°ç†è§£è¿™ä¸ªæµç¨‹ï¼Œæˆ‘ä»¬æ¥èµ°ä¸€éæ ¸å¿ƒä»£ç çš„æµç¨‹ï¼ŒåŠ æ·±ä¸‹å°è±¡ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œé¢†å¯¼è€…é€‰ä¸¾ç»“æŸï¼ŒèŠ‚ç‚¹è¿›å…¥è·Ÿéšè€…çŠ¶æ€æˆ–è€…é¢†å¯¼è€…çŠ¶æ€åï¼Œå®ƒä»¬ä¼šåˆ†åˆ«è®¾ç½®ZABçŠ¶æ€ä¸ºæˆå‘˜å‘ç°ã€‚å…·ä½“æ¥è¯´å°±æ˜¯ï¼š</p><ul>\n<li>è·Ÿéšè€…ä¼šè¿›å…¥åˆ°Follower.followLeader()å‡½æ•°ä¸­æ‰§è¡Œï¼Œè®¾ç½®ZABçŠ¶æ€ä¸ºæˆå‘˜å‘ç°ã€‚</li>\n</ul><pre><code>self.setZabState(QuorumPeer.ZabState.DISCOVERY);\n</code></pre><ul>\n<li>é¢†å¯¼è€…ä¼šè¿›å…¥åˆ°Leader.lead()å‡½æ•°ä¸­æ‰§è¡Œï¼Œå¹¶è®¾ç½®ZABçŠ¶æ€ä¸ºæˆå‘˜å‘ç°ã€‚</li>\n</ul><pre><code>self.setZabState(QuorumPeer.ZabState.DISCOVERY);\n\n</code></pre><p>ç¬¬äºŒï¼Œè·Ÿéšè€…ä¼šä¸»åŠ¨è”ç³»é¢†å¯¼è€…ï¼Œå‘é€è‡ªå·±å·²æ¥å—çš„é¢†å¯¼è€…ä»»æœŸç¼–å·æœ€å¤§å€¼ï¼ˆä¹Ÿå°±æ˜¯acceptedEpochï¼‰çš„FOLLOWINFOæ¶ˆæ¯ç»™é¢†å¯¼è€…ã€‚</p><pre><code>// è·Ÿé¢†å¯¼è€…å»ºç«‹ç½‘ç»œè¿æ¥\nconnectToLeader(leaderServer.addr, leaderServer.hostname);\nconnectionTime = System.currentTimeMillis();\n// å‘é¢†å¯¼è€…æŠ¥é“ï¼Œå¹¶è·å–é¢†å¯¼è€…çš„äº‹åŠ¡æ ‡è¯†ç¬¦æœ€å¤§å€¼\nlong newEpochZxid = registerWithLeader(Leader.FOLLOWERINFO);\n</code></pre><p>ç¬¬ä¸‰ï¼Œæ¥æ”¶åˆ°æ¥è‡ªè·Ÿéšè€…çš„FOLLOWINFOæ¶ˆæ¯åï¼Œåœ¨LearnerHandler.run()å‡½æ•°ä¸­ï¼Œé¢†å¯¼è€…å°†åˆ›å»ºåŒ…å«è‡ªå·±äº‹åŠ¡æ ‡è¯†ç¬¦æœ€å¤§å€¼çš„LEADINFOæ¶ˆæ¯ï¼Œå¹¶å“åº”ç»™è·Ÿéšè€…ã€‚</p><pre><code>// åˆ›å»ºLEADINFOæ¶ˆæ¯\nQuorumPacket newEpochPacket = new \nQuorumPacket(Leader.LEADERINFO, newLeaderZxid, ver, null);\n// å‘é€LEADINFOæ¶ˆæ¯ç»™è·Ÿéšè€…\noa.writeRecord(newEpochPacket, &quot;packet&quot;);\n</code></pre><p>ç¬¬å››ï¼Œæ¥æ”¶åˆ°æ¥è‡ªé¢†å¯¼è€…çš„LEADINFOæ¶ˆæ¯åï¼Œè·Ÿéšè€…ä¼šåŸºäºé¢†å¯¼è€…çš„ä»»æœŸç¼–å·ï¼Œåˆ¤æ–­é¢†å¯¼è€…æ˜¯å¦åˆæ³•ï¼Œå¦‚æœé¢†å¯¼è€…ä¸åˆæ³•ï¼Œè·Ÿéšè€…å‘èµ·æ–°çš„é€‰ä¸¾ï¼Œå¦‚æœé¢†å¯¼è€…åˆæ³•ï¼Œå“åº”ACKEPOCHæ¶ˆæ¯ç»™é¢†å¯¼è€…ã€‚</p><pre><code>// åˆ›å»ºACKEPOCHæ¶ˆæ¯ï¼ŒåŒ…å«å·²æäº¤ææ¡ˆçš„äº‹åŠ¡æ ‡è¯†ç¬¦æœ€å¤§å€¼\nQuorumPacket ackNewEpoch = new QuorumPacket(Leader.ACKEPOCH, lastLoggedZxid, epochBytes, null);\n// å“åº”ACKEPOCHæ¶ˆæ¯ç»™é¢†å¯¼è€…\nwritePacket(ackNewEpoch, true);\n</code></pre><p>ç¬¬äº”ï¼Œè·Ÿéšè€…è®¾ç½®ZABçŠ¶æ€ä¸ºæ•°æ®åŒæ­¥ã€‚</p><pre><code>self.setZabState(QuorumPeer.ZabState.SYNCHRONIZATION);\n</code></pre><p>ç¬¬å…­ï¼Œéœ€è¦ä½ æ³¨æ„çš„æ˜¯ï¼Œåœ¨LearnerHandler.run()å‡½æ•°ä¸­ï¼ˆä»¥åŠLeader.lead()å‡½æ•°ï¼‰ï¼Œé¢†å¯¼è€…ä¼šè°ƒç”¨waitForEpochAck()å‡½æ•°ï¼Œæ¥é˜»å¡å’Œç­‰å¾…æ¥è‡ªå¤§å¤šæ•°èŠ‚ç‚¹çš„ACKEPOCHæ¶ˆæ¯ã€‚</p><pre><code>ss = new StateSummary(bbepoch.getInt(), ackEpochPacket.getZxid());\nlearnerMaster.waitForEpochAck(this.getSid(), ss);\n</code></pre><p>ç¬¬ä¸ƒï¼Œå½“é¢†å¯¼è€…æ¥æ”¶åˆ°æ¥è‡ªå¤§å¤šæ•°èŠ‚ç‚¹çš„ACKEPOCHæ¶ˆæ¯åï¼Œåœ¨Leader.lead()å‡½æ•°ä¸­ï¼Œé¢†å¯¼è€…å°†è®¾ç½®ZABçŠ¶æ€ä¸ºæ•°æ®åŒæ­¥ã€‚</p><pre><code>self.setZabState(QuorumPeer.ZabState.SYNCHRONIZATION);\n</code></pre><p>è¿™æ ·ï¼ŒZooKeeperå°±å®ç°äº†æˆå‘˜å‘ç°ï¼Œå„èŠ‚ç‚¹å°±é¢†å¯¼è€…çš„é¢†å¯¼å…³ç³»è¾¾æˆäº†å…±è¯†ã€‚</p><p>å½“è·Ÿéšè€…å’Œé¢†å¯¼è€…è®¾ç½®ZABçŠ¶æ€ä¸ºæ•°æ®åŒæ­¥ï¼Œå®ƒä»¬ä¹Ÿå°±æ˜¯è¿›å…¥äº†æ•°æ®åŒæ­¥é˜¶æ®µï¼Œé‚£åœ¨ZooKeeperä¸­æ•°æ®åŒæ­¥æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p><h3>æ•°æ®åŒæ­¥</h3><p>æ•°æ®åŒæ­¥ä¹Ÿæ˜¯é€šè¿‡è·Ÿéšè€…å’Œé¢†å¯¼è€…äº¤äº’æ¥å®Œæˆçš„ï¼Œç›®æ ‡æ˜¯ç¡®ä¿è·Ÿéšè€…èŠ‚ç‚¹ä¸Šçš„æ•°æ®ä¸é¢†å¯¼è€…èŠ‚ç‚¹ä¸Šæ•°æ®æ˜¯ä¸€è‡´çš„ã€‚å¤§æ¦‚çš„å®ç°æµç¨‹ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/6e/44/6ea74f1a56a9fd0f39b82b25d2814c44.jpg?wh=1142*866\" alt=\"\" title=\"å›¾12\"></p><p>ä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼Œå’±ä»¬ä¸€èµ·èµ°ä¸€éæ ¸å¿ƒä»£ç çš„æµç¨‹ï¼ŒåŠ æ·±ä¸‹å°è±¡ã€‚</p><p>ç¬¬ä¸€ï¼Œåœ¨LearnerHandler.run()å‡½æ•°ä¸­ï¼Œé¢†å¯¼è€…è°ƒç”¨syncFollower()å‡½æ•°ï¼Œæ ¹æ®è·Ÿéšè€…çš„äº‹åŠ¡æ ‡è¯†ç¬¦å€¼æœ€å¤§å€¼ï¼Œåˆ¤æ–­ç”¨å“ªç§æ–¹å¼å¤„ç†ä¸ä¸€è‡´æ•°æ®ï¼ŒæŠŠå·²ç»æäº¤ææ¡ˆå’Œæœªæäº¤ææ¡ˆéƒ½åŒæ­¥ç»™è·Ÿéšè€…ï¼š</p><pre><code>peerLastZxid = ss.getLastZxid();\nboolean needSnap = syncFollower(peerLastZxid, learnerMaster);\n</code></pre><p>åœ¨è¿™é‡Œï¼Œéœ€è¦ä½ äº†è§£é¢†å¯¼è€…å‘è·Ÿéšè€…åŒæ­¥æ•°æ®çš„ä¸‰ç§æ–¹å¼ï¼ˆTRUNCã€DIFFã€SNAPï¼‰ï¼Œå®ƒä»¬æ˜¯ä»€ä¹ˆå«ä¹‰å‘¢ï¼Ÿè¦æƒ³äº†è§£è¿™éƒ¨åˆ†å†…å®¹ï¼Œä½ é¦–å…ˆè¦äº†è§£ä¸€ä¸‹syncFollower()ä¸­ï¼Œ3ä¸ªå…³é”®å˜é‡çš„å«ä¹‰ã€‚</p><ul>\n<li>peerLastZxidï¼šè·Ÿéšè€…èŠ‚ç‚¹ä¸Šï¼Œææ¡ˆçš„äº‹åŠ¡æ ‡è¯†ç¬¦æœ€å¤§å€¼ã€‚</li>\n<li>maxCommittedLogã€minCommittedLogï¼šé¢†å¯¼è€…èŠ‚ç‚¹å†…å­˜é˜Ÿåˆ—ä¸­ï¼Œå·²æäº¤ææ¡ˆçš„äº‹åŠ¡æ ‡è¯†ç¬¦æœ€å¤§å€¼å’Œæœ€å°å€¼ã€‚éœ€è¦ä½ æ³¨æ„çš„æ˜¯ï¼ŒmaxCommittedLogã€minCommittedLogä¸ZooKeeperçš„è®¾è®¡æœ‰å…³ã€‚åœ¨ZooKeeperä¸­ï¼Œä¸ºäº†æ›´é«˜æ•ˆåœ°å¤åˆ¶ææ¡ˆåˆ°è·Ÿéšè€…ä¸Šï¼Œé¢†å¯¼è€…ä¼šå°†ä¸€å®šæ•°é‡ï¼ˆé»˜è®¤å€¼ä¸º500ï¼‰çš„å·²æäº¤ææ¡ˆæ”¾åœ¨å†…å­˜é˜Ÿåˆ—é‡Œï¼Œè€ŒmaxCommittedLogã€minCommittedLogåˆ†åˆ«æ ‡è¯†çš„æ˜¯å†…å­˜é˜Ÿåˆ—ä¸­ï¼Œå·²æäº¤ææ¡ˆçš„äº‹åŠ¡æ ‡è¯†ç¬¦æœ€å¤§å€¼å’Œæœ€å°å€¼ã€‚</li>\n</ul><p>è¯´å®Œ3ä¸ªå˜é‡çš„å«ä¹‰ï¼Œæˆ‘æ¥è¯´è¯´3ç§åŒæ­¥æ–¹å¼ã€‚</p><ul>\n<li>\n<p>TRUNCï¼šå½“peerLastZxidå¤§äºmaxCommittedLogæ—¶ï¼Œé¢†å¯¼è€…ä¼šé€šçŸ¥è·Ÿéšè€…ä¸¢å¼ƒè¶…å‡ºçš„é‚£éƒ¨åˆ†ææ¡ˆã€‚æ¯”å¦‚ï¼Œå¦‚æœè·Ÿéšè€…çš„peerLastZxidä¸º11ï¼Œé¢†å¯¼è€…çš„maxCommittedLogä¸º10ï¼Œé‚£ä¹ˆé¢†å¯¼è€…å°†é€šçŸ¥è·Ÿéšè€…ä¸¢å¼ƒäº‹åŠ¡æ ‡è¯†ç¬¦å€¼ä¸º11çš„ææ¡ˆã€‚</p>\n</li>\n<li>\n<p>DIFFï¼šå½“peerLastZxidå°äºmaxCommittedLogï¼Œä½†peerLastZxidå¤§äºminCommittedLogæ—¶ï¼Œé¢†å¯¼è€…ä¼šåŒæ­¥ç»™è·Ÿéšè€…ç¼ºå¤±çš„å·²æäº¤çš„ææ¡ˆï¼Œæ¯”å¦‚ï¼Œå¦‚æœè·Ÿéšè€…çš„peerLastZxidä¸º9ï¼Œé¢†å¯¼è€…çš„maxCommittedLogä¸º10ï¼ŒminCommittedLogä¸º9ï¼Œé‚£ä¹ˆé¢†å¯¼è€…å°†åŒæ­¥äº‹åŠ¡æ ‡è¯†ç¬¦å€¼ä¸º10çš„ææ¡ˆï¼Œç»™è·Ÿéšè€…ã€‚</p>\n</li>\n<li>\n<p>SNAPï¼šå½“peerLastZxidå°äºminCommittedLogæ—¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè·Ÿéšè€…ç¼ºå¤±çš„ææ¡ˆæ¯”è¾ƒå¤šï¼Œé‚£ä¹ˆï¼Œé¢†å¯¼è€…åŒæ­¥å¿«ç…§æ•°æ®ç»™è·Ÿéšè€…ï¼Œå¹¶ç›´æ¥è¦†ç›–è·Ÿéšè€…æœ¬åœ°çš„æ•°æ®ã€‚</p>\n</li>\n</ul><p>åœ¨è¿™é‡Œï¼Œæˆ‘æƒ³è¡¥å……ä¸€ä¸‹ï¼Œé¢†å¯¼è€…å…ˆå°±å·²æäº¤ææ¡ˆå’Œè·Ÿéšè€…è¾¾æˆä¸€è‡´ï¼Œç„¶åè°ƒç”¨learnerMaster.startForwarding()ï¼Œå°†æœªæäº¤ææ¡ˆï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ä¹Ÿç¼“å­˜åœ¨å‘é€é˜Ÿåˆ—ï¼ˆqueuedPacketsï¼‰ï¼Œå¹¶æœ€ç»ˆå¤åˆ¶ç»™è·Ÿéšè€…èŠ‚ç‚¹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>é¢†å¯¼è€…ä»¥è‡ªå·±çš„æ•°æ®ä¸ºå‡†ï¼Œå®ç°å„èŠ‚ç‚¹æ•°æ®å‰¯æœ¬çš„ä¸€è‡´çš„ã€‚</strong></p><p>éœ€è¦ä½ æ³¨æ„çš„æ˜¯ï¼Œåœ¨syncFolower()ä¸­ï¼Œé¢†å¯¼è€…åªæ˜¯å°†éœ€è¦å‘é€çš„å·®å¼‚æ•°æ®ç¼“å­˜åœ¨å‘é€é˜Ÿåˆ—ï¼ˆqueuedPacketsï¼‰ï¼Œè¿™ä¸ªæ—¶å€™è¿˜æ²¡æœ‰å‘é€ã€‚</p><p>ç¬¬äºŒï¼Œåœ¨LearnerHandler.run()å‡½æ•°ä¸­ï¼Œé¢†å¯¼è€…åˆ›å»ºNEWLEADERæ¶ˆæ¯ï¼Œå¹¶ç¼“å­˜åœ¨å‘é€é˜Ÿåˆ—ä¸­ã€‚</p><pre><code>// åˆ›å»ºNEWLEADERæ¶ˆæ¯\nQuorumPacket newLeaderQP = new QuorumPacket(Leader.NEWLEADER, newLeaderZxid, learnerMaster.getQuorumVerifierBytes(), null);\n// ç¼“å­˜NEWLEADERæ¶ˆæ¯åˆ°å‘é€é˜Ÿåˆ—ä¸­\nqueuedPackets.add(newLeaderQP);\n</code></pre><p>ç¬¬ä¸‰ï¼Œåœ¨LearnerHandler.run()å‡½æ•°ä¸­ï¼Œé¢†å¯¼è€…è°ƒç”¨startSendingPackets()å‡½æ•°ï¼Œå¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œå¹¶å°†ç¼“å­˜çš„æ•°æ®å‘é€ç»™è·Ÿéšè€…ã€‚</p><pre><code>// å‘é€ç¼“å­˜é˜Ÿåˆ—ä¸­çš„æ•°æ®\nstartSendingPackets();\n</code></pre><p>ç¬¬å››ï¼Œè·Ÿéšè€…è°ƒç”¨syncWithLeader()å‡½æ•°ï¼Œå¤„ç†æ¥è‡ªé¢†å¯¼è€…çš„æ•°æ®åŒæ­¥ã€‚</p><pre><code>// å¤„ç†æ•°æ®åŒæ­¥\nsyncWithLeader(newEpochZxid);\n</code></pre><p>ç¬¬äº”ï¼Œåœ¨syncWithLeader()å‡½æ•°ï¼Œè·Ÿéšè€…æ¥æ”¶åˆ°æ¥è‡ªé¢†å¯¼è€…çš„NEWLEADERæ¶ˆæ¯åï¼Œè¿”å›ç¡®è®¤å“åº”ç»™é¢†å¯¼è€…ã€‚</p><pre><code>writePacket(new QuorumPacket(Leader.ACK, newLeaderZxid, null, null), true);\n</code></pre><p>ç¬¬å…­ï¼Œåœ¨LearnerHandler.run()å‡½æ•°ä¸­ï¼ˆä»¥åŠLeader.lead()å‡½æ•°ï¼‰ï¼Œé¢†å¯¼è€…ç­‰å¾…æ¥è‡ªå¤§å¤šæ•°èŠ‚ç‚¹çš„NEWLEADERæ¶ˆæ¯çš„å“åº”ã€‚</p><pre><code>learnerMaster.waitForNewLeaderAck(getSid(), qp.getZxid());\n</code></pre><p>ç¬¬ä¸ƒï¼Œå½“é¢†å¯¼è€…æ¥æ”¶åˆ°æ¥è‡ªå¤§å¤šæ•°èŠ‚ç‚¹çš„NEWLEADERæ¶ˆæ¯çš„å“åº”æ—¶ï¼Œåœ¨Leader.lead()å‡½æ•°ä¸­ï¼Œé¢†å¯¼è€…è®¾ç½®ZABçŠ¶æ€ä¸ºå¹¿æ’­çŠ¶æ€ã€‚</p><pre><code>self.setZabState(QuorumPeer.ZabState.BROADCAST);\n</code></pre><p>å¹¶åœ¨LearnerHandler.run()ä¸­å‘é€UPTODATEæ¶ˆæ¯ç»™æ‰€æœ‰è·Ÿéšè€…ï¼Œé€šçŸ¥å®ƒä»¬æ•°æ®åŒæ­¥å·²å®Œæˆäº†ã€‚</p><pre><code>queuedPackets.add(new QuorumPacket(Leader.UPTODATE, -1, null, null));\n</code></pre><p>ç¬¬å…«ï¼Œå½“è·Ÿéšè€…æ¥æ”¶åˆ°UPTODATEæ¶ˆæ¯æ—¶ï¼Œå°±çŸ¥é“è‡ªå·±ä¿®å¤å®Œæ•°æ®ä¸ä¸€è‡´äº†ï¼Œå¯ä»¥å¤„ç†å†™è¯·æ±‚äº†ï¼Œå°±è®¾ç½®ZABçŠ¶æ€ä¸ºå¹¿æ’­ã€‚</p><pre><code>// æ•°æ®åŒæ­¥å®Œæˆåï¼Œä¹Ÿå°±æ˜¯å¯ä»¥æ­£å¸¸å¤„ç†æ¥è‡ªé¢†å¯¼è€…çš„å¹¿æ’­æ¶ˆæ¯äº†ï¼Œè®¾ç½®ZABçŠ¶æ€ä¸ºå¹¿æ’­\nself.setZabState(QuorumPeer.ZabState.BROADCAST);\n</code></pre><p>ä½ çœ‹ï¼Œè¿™æ ·å°±ç¡®ä¿å„èŠ‚ç‚¹æ•°æ®çš„ä¸€è‡´äº†ï¼Œæ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥ä»¥é¢†å¯¼è€…ä¸ºä¸»ï¼Œå‘å…¶ä»–èŠ‚ç‚¹å¹¿æ’­æ¶ˆæ¯äº†ã€‚</p><h2>å†…å®¹å°ç»“</h2><p>æœ¬èŠ‚è¯¾æˆ‘ä¸»è¦å¸¦ä½ äº†è§£äº†ZABå¦‚ä½•æ¢å¤æ•…éšœï¼Œæˆ‘å¸Œæœ›ä½ æ˜ç¡®è¿™æ ·å‡ ä¸ªé‡ç‚¹ã€‚</p><p>1.æˆå‘˜å‘ç°ï¼Œæ˜¯ä¸ºäº†å»ºç«‹è·Ÿéšè€…å’Œé¢†å¯¼è€…ä¹‹é—´çš„é¢†å¯¼è€…å…³ç³»ï¼Œå¹¶é€šè¿‡ä»»æœŸç¼–å·æ¥ç¡®è®¤è¿™ä¸ªé¢†å¯¼è€…æ˜¯å¦ä¸ºæœ€åˆé€‚çš„é¢†å¯¼è€…ã€‚</p><p>2.æ•°æ®åŒæ­¥ï¼Œæ˜¯é€šè¿‡ä»¥é¢†å¯¼è€…çš„æ•°æ®ä¸ºå‡†çš„æ–¹å¼ï¼Œæ¥å®ç°å„èŠ‚ç‚¹æ•°æ®å‰¯æœ¬çš„ä¸€è‡´ï¼Œéœ€è¦ä½ æ³¨æ„çš„æ˜¯ï¼ŒåŸºäºâ€œå¤§å¤šæ•°â€çš„æäº¤åŸåˆ™å’Œé€‰ä¸¾åŸåˆ™ï¼Œèƒ½ç¡®ä¿è¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹å¹¶æäº¤çš„ææ¡ˆï¼Œå°±ä¸å†æ”¹å˜ã€‚</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘æƒ³ç‰¹åˆ«å¼ºè°ƒä¸€ä¸‹ï¼Œåœ¨ZooKeeperçš„ä»£ç å®ç°ä¸­ï¼Œå¤„äºæäº¤ï¼ˆCommittedï¼‰çŠ¶æ€çš„ææ¡ˆæ˜¯å¯èƒ½ä¼šæ”¹å˜çš„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>åœ¨ZooKeeperä¸­ï¼Œä¸€ä¸ªææ¡ˆè¿›å…¥æäº¤ï¼ˆCommittedï¼‰çŠ¶æ€ï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul>\n<li>\n<p>è¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šï¼Œè¢«é¢†å¯¼è€…æäº¤æˆ–æ¥æ”¶åˆ°æ¥è‡ªé¢†å¯¼è€…çš„æäº¤æ¶ˆæ¯ï¼ˆleader.COMMITï¼‰è€Œè¢«æäº¤ã€‚åœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼Œæäº¤çš„ææ¡ˆæ˜¯ä¸ä¼šæ”¹å˜çš„ã€‚</p>\n</li>\n<li>\n<p>å¦å¤–ï¼Œåœ¨ZooKeeperçš„è®¾è®¡ä¸­ï¼Œåœ¨èŠ‚ç‚¹é€€å‡ºè·Ÿéšè€…çŠ¶æ€æ—¶ï¼ˆåœ¨follower.shutdown()å‡½æ•°ä¸­ï¼‰ï¼Œä¼šå°†æ‰€æœ‰æœ¬åœ°æœªæäº¤çš„ææ¡ˆéƒ½æäº¤ã€‚éœ€è¦ä½ æ³¨æ„çš„æ˜¯ï¼Œæ­¤æ—¶æäº¤çš„ææ¡ˆï¼Œå¯èƒ½å¹¶æœªè¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šï¼Œè€Œä¸”è¿™ç§è®¾è®¡ï¼Œå°±ä¼šå¯¼è‡´ZooKeeperä¸­å‡ºç°ï¼Œå¤„äºâ€œæäº¤â€çŠ¶æ€çš„ææ¡ˆå¯èƒ½ä¼šè¢«åˆ é™¤ï¼ˆä¹Ÿå°±æ˜¯æ¥æ”¶åˆ°é¢†å¯¼è€…çš„TRUNCæ¶ˆæ¯è€Œåˆ é™¤çš„ææ¡ˆï¼‰ã€‚</p>\n</li>\n</ul><p>æ›´å‡†ç¡®çš„è¯´ï¼Œ<strong>åœ¨ZooKeeperä¸­ï¼Œè¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šçš„ææ¡ˆï¼Œæœ€ç»ˆä¼šè¢«æäº¤ï¼Œå¹¶ä¸ä¼šå†æ”¹å˜ï¼›è€Œåªåœ¨å°‘æ•°èŠ‚ç‚¹å­˜åœ¨çš„ææ¡ˆï¼Œå¯èƒ½ä¼šè¢«æäº¤å’Œä¸å†æ”¹å˜ï¼Œä¹Ÿå¯èƒ½ä¼šè¢«åˆ é™¤ã€‚</strong>ä¸ºäº†å¸®åŠ©ä½ ç†è§£ï¼Œæˆ‘æ¥ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ã€‚</p><ul>\n<li>\n<p>å¦‚æœå†™è¯·æ±‚å¯¹åº”çš„ææ¡ˆâ€œSET X = 1â€å·²ç»å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆå®ƒæ˜¯æœ€ç»ˆä¼šè¢«æäº¤ï¼Œä¹‹åä¹Ÿä¸ä¼šå†æ”¹å˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ²¡æœ‰æ–°çš„Xèµ‹å€¼æ“ä½œçš„å‰æä¸‹ï¼Œä¸ç®¡èŠ‚ç‚¹æ€ä¹ˆå´©æºƒã€é¢†å¯¼è€…å¦‚ä½•å˜æ›´ï¼Œä½ æŸ¥è¯¢åˆ°çš„Xçš„å€¼éƒ½ä¸º1ã€‚</p>\n</li>\n<li>\n<p>å¦‚æœå†™è¯·æ±‚å¯¹åº”çš„ææ¡ˆâ€œSET X = 1â€æœªè¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šï¼Œæ¯”å¦‚åœ¨é¢†å¯¼è€…å¹¿æ’­æ¶ˆæ¯è¿‡ç¨‹ä¸­ï¼Œé¢†å¯¼è€…å´©æºƒäº†ï¼Œé‚£ä¹ˆï¼Œææ¡ˆâ€œSET X = 1â€ï¼Œå¯èƒ½è¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šï¼Œå¹¶æäº¤å’Œä¹‹åå°±ä¸å†æ”¹å˜ï¼Œä¹Ÿå¯èƒ½ä¼šè¢«åˆ é™¤ã€‚è¿™ä¸ªè¡Œä¸ºæ˜¯æœªç¡®å®šçš„ï¼Œå–å†³äºæ–°çš„é¢†å¯¼è€…æ˜¯å¦åŒ…å«è¯¥ææ¡ˆã€‚</p>\n</li>\n</ul><p>å¦å¤–ï¼Œæˆ‘æƒ³è¡¥å……ä¸‹ï¼Œåœ¨ZABä¸­ï¼Œé€‰ä¸¾å‡ºäº†æ–°çš„é¢†å¯¼è€…åï¼Œè¯¥é¢†å¯¼è€…ä¸èƒ½ç«‹å³å¤„ç†å†™è¯·æ±‚ï¼Œè¿˜éœ€è¦é€šè¿‡æˆå‘˜å‘ç°ã€æ•°æ®åŒæ­¥2ä¸ªé˜¶æ®µè¿›è¡Œæ•…éšœæ¢å¤ã€‚è¿™æ˜¯ZABåè®®çš„è®¾è®¡å†³å®šçš„ï¼Œä¸æ˜¯æ‰€æœ‰çš„å…±è¯†ç®—æ³•éƒ½å¿…é¡»è¿™æ ·ï¼Œæ¯”å¦‚Rafté€‰ä¸¾å‡ºæ–°çš„é¢†å¯¼è€…åï¼Œé¢†å¯¼è€…æ˜¯å¯ä»¥ç«‹å³å¤„ç†å†™è¯·æ±‚çš„ã€‚</p><p>æœ€åï¼Œå®Œæˆæ•°æ®åŒæ­¥åï¼ŒèŠ‚ç‚¹å°†è¿›å…¥å¹¿æ’­çŠ¶æ€ï¼Œé‚£ZABæ˜¯å¦‚ä½•å¤„ç†è¯»å†™è¯·æ±‚ï¼Œåˆæ˜¯å¦‚ä½•å¹¿æ’­æ¶ˆæ¯çš„å‘¢ï¼Ÿä¸‹èŠ‚è¯¾ï¼Œæˆ‘ä¼šé‡ç‚¹å¸¦ä½ äº†è§£è¿™éƒ¨åˆ†å†…å®¹ã€‚</p><h2>è¯¾å ‚æ€è€ƒ</h2><p>æˆ‘æåˆ°åœ¨ZABä¸­ï¼Œææ¡ˆæäº¤çš„å¤§å¤šæ•°åŸåˆ™å’Œé¢†å¯¼è€…é€‰ä¸¾çš„å¤§å¤šæ•°åŸåˆ™ï¼Œç¡®ä¿äº†è¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹çš„ææ¡ˆå°±ä¸å†æ”¹å˜äº†ã€‚é‚£ä¹ˆä½ ä¸å¦¨æ€è€ƒå’Œæ¨æ¼”ä¸€ä¸‹ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„çœ‹æ³•ï¼Œä¸æˆ‘ä¸€åŒè®¨è®ºã€‚</p><p>æœ€åï¼Œæ„Ÿè°¢ä½ çš„é˜…è¯»ï¼Œå¦‚æœè¿™èŠ‚è¯¾è®©ä½ æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿ä½ å°†å®ƒåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ã€‚</p>","neighbors":{"left":{"article_title":"åŠ é¤ | ZABåè®®ï¼ˆä¸€ï¼‰ï¼šä¸»èŠ‚ç‚¹å´©æºƒäº†ï¼Œæ€ä¹ˆåŠï¼Ÿ","id":232412},"right":{"article_title":"åŠ é¤ | ZABåè®®ï¼ˆä¸‰ï¼‰ï¼šå¦‚ä½•å¤„ç†è¯»å†™è¯·æ±‚ï¼Ÿ","id":237950}},"comments":[{"had_liked":false,"id":219535,"user_name":"å°æ³¢èœ","can_delete":false,"product_type":"c1","uid":1938076,"ip_address":"","ucode":"14A53D3F2E13C2","user_header":"https://static001.geekbang.org/account/avatar/00/1d/92/9c/1312b3ca.jpg","comment_is_top":false,"comment_ctime":1590037591,"is_pvip":false,"replies":[{"id":"86972","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œé—®é¢˜1ï¼šæ–°é¢†å¯¼è€…ä¸æ˜¯æ‰€æœ‰èŠ‚ç‚¹ä¸­ZXIDæœ€å¤§çš„èŠ‚ç‚¹ï¼Œè€Œæ˜¯å¤§å¤šæ•°èŠ‚ç‚¹ä¸­ZXIDæœ€å¤§çš„èŠ‚ç‚¹ï¼Œå¦‚æœâ€œset x = 1â€åªå¤åˆ¶åˆ°å°‘æ•°èŠ‚ç‚¹ä¸Šï¼ŒZABçš„é¢†å¯¼è€…é€‰ä¸¾è§„åˆ™ï¼Œä¸èƒ½ä¿è¯æˆä¸ºé¢†å¯¼è€…çš„èŠ‚ç‚¹ä¸€å®šæ˜¯è¿™äº›â€œå°‘æ•°èŠ‚ç‚¹â€ã€‚<br>é—®é¢˜2ï¼šå¯¹å®¢æˆ·ç«¯è€Œè¨€ï¼Œéœ€è¦æ”¯æŒæ“ä½œçš„å†¥ç­‰æ€§ï¼Œå¦‚æœå†™å…¥è¶…æ—¶ï¼ˆå³åœ¨æŒ‡å®šæ—¶é—´å†…ï¼ŒæœåŠ¡å™¨æ²¡æœ‰æˆåŠŸå°†æŒ‡ä»¤å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šï¼‰ï¼Œé‡è¯•å°±å¯ä»¥äº†ã€‚è€Œæ“ä½œçš„å†¥ç­‰æ€§ï¼Œèƒ½ä¿è¯æœ€åçš„ç»“æœæ˜¯é¢„æœŸçš„ç»“æœï¼ˆå³Xçš„å€¼ä¸º1ï¼‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1595042439,"ip_address":"","comment_id":219535,"utype":1}],"discussion_count":2,"race_medal":0,"score":"66014547031","product_id":100046101,"comment_content":"â€œå¦‚æœå†™è¯·æ±‚å¯¹åº”çš„ææ¡ˆâ€œSET X = 1â€æœªè¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šï¼Œæ¯”å¦‚åœ¨é¢†å¯¼è€…å¹¿æ’­æ¶ˆæ¯è¿‡ç¨‹ä¸­ï¼Œé¢†å¯¼è€…å´©æºƒäº†ï¼Œé‚£ä¹ˆï¼Œææ¡ˆâ€œSET X = 1â€ï¼Œå¯èƒ½è¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šï¼Œå¹¶æäº¤å’Œä¹‹åå°±ä¸å†æ”¹å˜ï¼Œä¹Ÿå¯èƒ½ä¼šè¢«åˆ é™¤ã€‚è¿™ä¸ªè¡Œä¸ºæ˜¯æœªç¡®å®šçš„ï¼Œå–å†³äºæ–°çš„é¢†å¯¼è€…æ˜¯å¦åŒ…å«è¯¥ææ¡ˆã€‚â€<br>è¯·æ•™éŸ©è€å¸ˆï¼š<br>è¿™è¾¹set x=1åªå¤åˆ¶åˆ°å°‘æ•°èŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆè¿™äº›å°‘æ•°èŠ‚ç‚¹çš„zxidåº”è¯¥æ˜¯æœ€å¤§ï¼Œåº”è¯¥å›æˆä¸ºæ–°çš„leaderï¼Œä¹Ÿå°±ä¸ä¼šä¸¢æ•°æ®äº†å•Šï¼Ÿ<br>ç„¶åè¿™ä¸ªé—®é¢˜åˆè¯¥å¦‚ä½•é¿å…å‘¢ï¼Ÿ","like_count":16,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495844,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œé—®é¢˜1ï¼šæ–°é¢†å¯¼è€…ä¸æ˜¯æ‰€æœ‰èŠ‚ç‚¹ä¸­ZXIDæœ€å¤§çš„èŠ‚ç‚¹ï¼Œè€Œæ˜¯å¤§å¤šæ•°èŠ‚ç‚¹ä¸­ZXIDæœ€å¤§çš„èŠ‚ç‚¹ï¼Œå¦‚æœâ€œset x = 1â€åªå¤åˆ¶åˆ°å°‘æ•°èŠ‚ç‚¹ä¸Šï¼ŒZABçš„é¢†å¯¼è€…é€‰ä¸¾è§„åˆ™ï¼Œä¸èƒ½ä¿è¯æˆä¸ºé¢†å¯¼è€…çš„èŠ‚ç‚¹ä¸€å®šæ˜¯è¿™äº›â€œå°‘æ•°èŠ‚ç‚¹â€ã€‚\né—®é¢˜2ï¼šå¯¹å®¢æˆ·ç«¯è€Œè¨€ï¼Œéœ€è¦æ”¯æŒæ“ä½œçš„å†¥ç­‰æ€§ï¼Œå¦‚æœå†™å…¥è¶…æ—¶ï¼ˆå³åœ¨æŒ‡å®šæ—¶é—´å†…ï¼ŒæœåŠ¡å™¨æ²¡æœ‰æˆåŠŸå°†æŒ‡ä»¤å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šï¼‰ï¼Œé‡è¯•å°±å¯ä»¥äº†ã€‚è€Œæ“ä½œçš„å†¥ç­‰æ€§ï¼Œèƒ½ä¿è¯æœ€åçš„ç»“æœæ˜¯é¢„æœŸçš„ç»“æœï¼ˆå³Xçš„å€¼ä¸º1ï¼‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595042439,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1076487,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIKoEicqUZTJly55qoUXRmK4wia7YbnibsMncJaO6tKgKAQNJRfpMsibvfeiaukIibsCsuaic8QjQ3gOoTGA/132","nickname":"å¼ å¯å¤«æ–¯åŸº","note":"","ucode":"3B8DF6D98583F2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554415,"discussion_content":"ä¸ºå•¥è€æ˜¯å°†å¹‚(mi)ç­‰æ€§å†™æˆå†¥(ming)ç­‰æ€§ã€‚ã€‚æ˜¯å£éŸ³å¤ªé‡äº†å—ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646369741,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":218455,"user_name":"Tim","can_delete":false,"product_type":"c1","uid":1393323,"ip_address":"","ucode":"A3ECD9832D630D","user_header":"https://static001.geekbang.org/account/avatar/00/15/42/ab/75fb1cd6.jpg","comment_is_top":false,"comment_ctime":1589804123,"is_pvip":false,"replies":[{"id":"80773","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼ŒZABèƒ½ä¿è¯ææ¡ˆçš„é¡ºåºæ€§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1589822456,"ip_address":"","comment_id":218455,"utype":1}],"discussion_count":5,"race_medal":0,"score":"31654575195","product_id":100046101,"comment_content":"æœ‰ä¸ªé—®é¢˜è¯·æ•™ä¸‹éŸ©è€å¸ˆï¼Œåœ¨åšæ•…éšœæ¢å¤æ•°æ®åŒæ­¥æ—¶å€™ï¼Œå¦‚æœ minCommittedLog &lt; peerLastZxid &lt; maxCommittedLog, æ¯”å¦‚leader æ˜¯ ã€5ï¼Œ6ï¼Œ7ï¼Œ8ï¼Œ9ã€‘ï¼Œè€Œfolloweræ˜¯ã€5ï¼Œ7ã€‘ï¼Œfollowerä¸­é—´å°‘äº†ä¸€ä¸ªzxid 6çš„äº‹åŠ¡ï¼Œè¿™æ—¶å€™æ•°æ®åŒæ­¥ä¼šæ¢å¤å˜›ï¼Ÿè°¢è°¢è€å¸ˆè§£ç­”ã€‚","like_count":7,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495462,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼ŒZABèƒ½ä¿è¯ææ¡ˆçš„é¡ºåºæ€§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589822456,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1698192,"avatar":"https://static001.geekbang.org/account/avatar/00/19/e9/90/2932d464.jpg","nickname":"å·¦è€³æœµçŒ«","note":"","ucode":"C79FCDD9B61303","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":328187,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606098220,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1047581,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/fc/1d/f46a76e1.jpg","nickname":"xiangakun","note":"","ucode":"720CDB4F792695","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":297342,"discussion_content":"ä¸å¤ªæ˜ç™½è¿™ç§æƒ…å†µä¸ºä»€ä¹ˆä¸ä¼šå‡ºç°ï¼Œzabèƒ½ä¿è¯ææ¡ˆçš„é¡ºåºæ€§ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¦æ±‚ææ¡ˆçš„è¿ç»­æ€§å§ï¼Œå‡å¦‚ A,B,C ä¸‰ä¸ªèŠ‚ç‚¹ï¼ŒAæ˜¯ä¸»èŠ‚ç‚¹ï¼Œæ¥æ”¶åˆ°æ¶ˆæ¯6ï¼Œå¹¿æ’­ç»™Cçš„æ—¶å€™ï¼ŒCå› ä¸ºç½‘ç»œæˆ–å…¶ä»–åŸå› å¯¼è‡´æ¶ˆæ¯6ä¸¢å¤±ï¼Œä½†æ˜¯Cå¾ˆå¿«ä»ç½‘ç»œä¸­æ¢å¤è¿‡æ¥ï¼Œæ ¹æ®å¤šæ•°èŠ‚ç‚¹åŸåˆ™6å·²ç»è¢«Aï¼ŒBæˆåŠŸæ¥æ”¶ã€‚æ¥ç€ç³»ç»Ÿæ”¶åˆ°æ¶ˆæ¯7ï¼ŒAå¹¿æ’­æ¶ˆæ¯ç»™Cçš„æ—¶å€™ï¼ŒCæˆåŠŸæ¥æ”¶äº†ã€‚éš¾é“è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼ŒCåœ¨æ²¡æœ‰å®Œå…¨åŒæ­¥Açš„æ¶ˆæ¯æ—¶ï¼Œæ˜¯ä¸ä¼šæ¥æ”¶æ–°çš„æ¶ˆæ¯å—ï¼Ÿè¿˜è¯·è€å¸ˆå¸®å¿™è§£æƒ‘ï¼Œéå¸¸æ„Ÿè°¢ï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596880517,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1039813,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/dd/c5/9ae99a7f.jpg","nickname":"Â¾é˜³å…‰","note":"","ucode":"C67D0E18F6158D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1047581,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/fc/1d/f46a76e1.jpg","nickname":"xiangakun","note":"","ucode":"720CDB4F792695","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334853,"discussion_content":"lead ä¼šç»™æ¯ä¸ªfolloweréƒ½å•ç‹¬ä¸€ä¸ªFIFOé˜Ÿåˆ—ç®¡ç†ææ¡ˆï¼Œå¦‚æœæ”¶åˆ°followerçš„ACKï¼Œåˆ™ä¼šæŠŠææ¡ˆå‡ºé˜Ÿåˆ—ï¼Œå¦åˆ™ä¸€ç›´æ”¾åœ¨é˜Ÿåˆ—ä¸­ï¼ŒåŒæ—¶ä¹Ÿä¿è¯äº†followeræ¥æ”¶åˆ°çš„Proposalææ¡ˆæ˜¯æŒ‰ç…§zxidå¤§å°é¡ºåºå‘å‡ºçš„ã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1608011148,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":297342,"ip_address":""},"score":334853,"extra":""},{"author":{"id":1106631,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e2/c7/f671bd93.jpg","nickname":"amy","note":"","ucode":"C6DAA11AFD3EC9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1039813,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/dd/c5/9ae99a7f.jpg","nickname":"Â¾é˜³å…‰","note":"","ucode":"C67D0E18F6158D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374970,"discussion_content":"æˆ‘ä¹‹å‰ä¹Ÿæ˜¯ä¸€ç›´æ²¡æƒ³æ˜ç™½zkæ˜¯æ€ä¹ˆä¿è¯æ¶ˆæ¯çš„é¡ºåºæ€§çš„ï¼Œçœ‹åˆ°ä½ çš„è¿™ä¸ªå›å¤æ€»ç®—æ˜ç™½äº†ï¼Œæ„Ÿè°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621424535,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":334853,"ip_address":""},"score":374970,"extra":""}]}]},{"had_liked":false,"id":247508,"user_name":"è¦åŠªåŠ›çš„å…µé•¿","can_delete":false,"product_type":"c1","uid":1204868,"ip_address":"","ucode":"0144DF1BB82763","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/YicovLZyvibpkfJwuAib1FEyibVDN6Oia1Wsg7jibT0uTj0UDH75KAX6vfSvstjy1IHTW7WpNbMlZZO9SnGoPj3AE2DQ/132","comment_is_top":false,"comment_ctime":1599728826,"is_pvip":false,"replies":[{"id":"96351","content":"åŠ ä¸€é¢—æ˜Ÿ:ï¼‰ï¼Œæœ‰å¯èƒ½è¿™ä¸ªèŠ‚ç‚¹ä¹Ÿå‡ºç°äº†ç½‘ç»œæ•…éšœï¼Œæ²¡æœ‰å‚ä¸é¢†å¯¼è€…é€‰ä¸¾ï¼Œåªæœ‰â€œå¤§å¤šæ•°â€ï¼Œæ‰ä¸ä¼šå†æ”¹å˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1606820987,"ip_address":"","comment_id":247508,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18779598010","product_id":100046101,"comment_content":"å¦‚æœå†™è¯·æ±‚å¯¹åº”çš„ææ¡ˆâ€œSET X = 1â€æœªè¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šï¼Œæ¯”å¦‚åœ¨é¢†å¯¼è€…å¹¿æ’­æ¶ˆæ¯è¿‡ç¨‹ä¸­ï¼Œé¢†å¯¼è€…å´©æºƒäº†ï¼Œé‚£ä¹ˆï¼Œææ¡ˆâ€œSET X = 1â€ï¼Œå¯èƒ½è¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šï¼Œå¹¶æäº¤å’Œä¹‹åå°±ä¸å†æ”¹å˜ï¼Œä¹Ÿå¯èƒ½ä¼šè¢«åˆ é™¤ã€‚è¿™ä¸ªè¡Œä¸ºæ˜¯æœªç¡®å®šçš„ï¼Œå–å†³äºæ–°çš„é¢†å¯¼è€…æ˜¯å¦åŒ…å«è¯¥ææ¡ˆ  ----------åƒè¿™ç§ ææ¡ˆçš„ äº‹åŠ¡IDæ˜æ˜¾æ˜¯æœ€å¤§çš„å§ã€‚ é‚£é€‰ä¸¾æ–°leader çš„æ—¶å€™ï¼Œ ä¹Ÿä¸å¯èƒ½é€‰ä¸¾å‡º æ²¡æœ‰æ¥å—çš„è¯¥ææ¡ˆçš„é‚£ç§èŠ‚ç‚¹å§ (ä»»æœŸç›¸åŒçš„æƒ…å†µä¸‹ï¼Œé€‰ä¸¾  äº‹åŠ¡IDæœ€å¤§çš„   ä½œä¸ºé¢†å¯¼è€…)","like_count":5,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505420,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:ï¼‰ï¼Œæœ‰å¯èƒ½è¿™ä¸ªèŠ‚ç‚¹ä¹Ÿå‡ºç°äº†ç½‘ç»œæ•…éšœï¼Œæ²¡æœ‰å‚ä¸é¢†å¯¼è€…é€‰ä¸¾ï¼Œåªæœ‰â€œå¤§å¤šæ•°â€ï¼Œæ‰ä¸ä¼šå†æ”¹å˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606820987,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":242762,"user_name":"Heaven","can_delete":false,"product_type":"c1","uid":1694207,"ip_address":"","ucode":"FA33FBCC66C911","user_header":"https://static001.geekbang.org/account/avatar/00/19/d9/ff/b23018a6.jpg","comment_is_top":false,"comment_ctime":1597834773,"is_pvip":false,"replies":[{"id":"96359","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œä¸æ»¡è¶³â€œå¤§å¤šæ•°â€åŸåˆ™ï¼Œå…±è¯†ç®—æ³•æœ¬è´¨ä¸Šæ˜¯â€œå¤šæ•°æ´¾â€ç®—æ³•ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1606826342,"ip_address":"","comment_id":242762,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10187769365","product_id":100046101,"comment_content":"å°‘æ•°èŠ‚ç‚¹ä¸ºä½•æˆ‘XIDæœ€å¤§æˆ‘ä¸èƒ½æˆä¸ºé¢†å¯¼è€…å‘¢?","like_count":3,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":504091,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œä¸æ»¡è¶³â€œå¤§å¤šæ•°â€åŸåˆ™ï¼Œå…±è¯†ç®—æ³•æœ¬è´¨ä¸Šæ˜¯â€œå¤šæ•°æ´¾â€ç®—æ³•ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606826342,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1292669,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIaaDFHiag4sFcO7JUn028Mtk1YvFpibIibLzcTE7Qak0icJklMpqh7k5dSK27dibicMuNgYMozgaibeYppA/132","nickname":"Bball","note":"","ucode":"E483CAFE50CB99","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550372,"discussion_content":"åº”è¯¥ä¹Ÿæœ‰å¯èƒ½æ˜¯è¿™ä¸ªå°‘æ•°èŠ‚ç‚¹æˆä¸ºäº†é¢†å¯¼è€…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644500136,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":331751,"user_name":"å°éº¦","can_delete":false,"product_type":"c1","uid":1618709,"ip_address":"","ucode":"2C800B598A2CDE","user_header":"https://static001.geekbang.org/account/avatar/00/18/b3/15/30822e33.jpg","comment_is_top":false,"comment_ctime":1642750425,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"5937717721","product_id":100046101,"comment_content":"ã€åœ¨ ZooKeeper ä¸­ï¼Œè¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šçš„ææ¡ˆï¼Œæœ€ç»ˆä¼šè¢«æäº¤ã€‘<br><br>å¦‚æœä¸€ä¸ªææ¡ˆå·²ç»è¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šäº†ï¼Œä½†æ˜¯åœ¨ Leader å‘èŠ‚ç‚¹å‘é€ commit ä¹‹å‰å´©æºƒäº†ï¼Œé‚£ä¹ˆ follower æ˜¯æ²¡æœ‰æ”¶åˆ° commit è¯·æ±‚çš„ï¼Œé‚£è¿™ä¸ªææ¡ˆæœ€ç»ˆä¹Ÿä¼šè¢«æäº¤å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1580185,"avatar":"https://static001.geekbang.org/account/avatar/00/18/1c/99/5e1a2118.jpg","nickname":"mylife","note":"","ucode":"D802160BFB29FC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590256,"discussion_content":"ä¼šçš„ï¼Œå› ä¸ºå·²ç»è¢«å¤åˆ¶åˆ°äº†å¤§å¤šæ•°èŠ‚ç‚¹ï¼Œè€Œleaderé€‰ä¸¾éœ€è¦è¿‡åŠåŸåˆ™ï¼Œåˆ™æ–°é€‰å–çš„leaderè‚¯å®šæœ‰è¯¥æœ€æ–°ææ¡ˆï¼Œå› è€Œæœ€ç»ˆä¼šè¢«æäº¤ã€‚å¦å¤–å¦‚æœåªæ˜¯å¤åˆ¶åˆ°å°‘æ•°çš„èŠ‚ç‚¹ï¼Œåˆ™ä¸ä¸€å®šä¼šè¢«æäº¤ï¼Œæ¯”å¦‚åˆšå¥½åªå¤åˆ¶åˆ°1ä¸ªèŠ‚ç‚¹è€Œè¯¥èŠ‚ç‚¹åˆåˆšå¥½å¤„åœ¨ç½‘ç»œéš”ç¦»æƒ…å†µä¸‹ï¼Œåˆ™è¯¥ææ¡ˆä¸ä¼šè¢«æäº¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665642735,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":246307,"user_name":"kylexy_0817","can_delete":false,"product_type":"c1","uid":1068372,"ip_address":"","ucode":"392DD9DD5E4B6E","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/54/9c214885.jpg","comment_is_top":false,"comment_ctime":1599272611,"is_pvip":false,"replies":[{"id":"92465","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œåœ¨ä»»æ„æ—¶åˆ»ï¼Œæ¯ä¸ªèŠ‚ç‚¹åªèƒ½å¤„äºä¸€ç§çŠ¶æ€ï¼Œä½†é›†ç¾¤ä¸­çš„å„èŠ‚ç‚¹å¯èƒ½å¤„äºä¸åŒçš„çŠ¶æ€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1602597412,"ip_address":"","comment_id":246307,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5894239907","product_id":100046101,"comment_content":"éŸ©è€å¸ˆå¥½ï¼Œâ€œåªæœ‰å½“é›†ç¾¤å¤§å¤šæ•°èŠ‚ç‚¹å¤„äºå¹¿æ’­çŠ¶æ€çš„æ—¶å€™ï¼Œé›†ç¾¤æ‰èƒ½æäº¤ææ¡ˆâ€ï¼Œæ˜¯å¦æ„å‘³ç€BROADCASTå¹¿æ’­çŠ¶æ€ï¼Œæ˜¯ä¼šä¸å…¶å®ƒä¸‰ä¸ªçŠ¶æ€åŒæ—¶å­˜åœ¨çš„å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505107,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œåœ¨ä»»æ„æ—¶åˆ»ï¼Œæ¯ä¸ªèŠ‚ç‚¹åªèƒ½å¤„äºä¸€ç§çŠ¶æ€ï¼Œä½†é›†ç¾¤ä¸­çš„å„èŠ‚ç‚¹å¯èƒ½å¤„äºä¸åŒçš„çŠ¶æ€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602597412,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":232986,"user_name":"æ˜¥é£","can_delete":false,"product_type":"c1","uid":1103971,"ip_address":"","ucode":"76947E35A76C67","user_header":"https://static001.geekbang.org/account/avatar/00/10/d8/63/e4c28138.jpg","comment_is_top":false,"comment_ctime":1594182564,"is_pvip":false,"replies":[{"id":"88136","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œé—®é¢˜1ï¼šæš‚æ—¶æ²¡æƒ³åˆ°å…·ä½“ä¾‹å­ï¼Œæˆ‘å†æƒ³æƒ³:)ã€‚é—®é¢˜2ï¼šå“åº”å®ƒè®¤ä¸ºæ˜¯é¢†å¯¼è€…çš„èŠ‚ç‚¹ä¿¡æ¯ç»™è¿™ä¸ªé€‰ä¸¾çŠ¶æ€çš„èŠ‚ç‚¹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1596215348,"ip_address":"","comment_id":232986,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5889149860","product_id":100046101,"comment_content":"å½“æ¥æ”¶åˆ°é¢†å¯¼è€…çš„å“åº”åï¼Œè·Ÿéšè€…ä¼šåˆ¤æ–­é¢†å¯¼è€…çš„ä»»æœŸç¼–å·æ˜¯å¦æœ€æ–°ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±å‘èµ·æ–°çš„é€‰ä¸¾ï¼›<br><br>è€å¸ˆï¼Œä»€ä¹ˆæƒ…å†µä¸‹é¢†å¯¼è€…çš„ä»»æœŸç¼–å·ä¼šä¸æ˜¯æœ€æ–°å‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™å‘èµ·æ–°çš„é€‰ä¸¾ï¼Œå…¶ä»–èŠ‚ç‚¹çš„çŠ¶æ€æ˜¯ä¸æ˜¯åº”è¯¥æ˜¯followingçŠ¶æ€ï¼ŒzabçŠ¶æ€åº”è¯¥æ˜¯discoveryçŠ¶æ€ï¼Œè¿™ä¸ªæ—¶å€™æ˜¯æ€ä¹ˆå“åº”é€‰ä¸¾çš„å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500838,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œé—®é¢˜1ï¼šæš‚æ—¶æ²¡æƒ³åˆ°å…·ä½“ä¾‹å­ï¼Œæˆ‘å†æƒ³æƒ³:)ã€‚é—®é¢˜2ï¼šå“åº”å®ƒè®¤ä¸ºæ˜¯é¢†å¯¼è€…çš„èŠ‚ç‚¹ä¿¡æ¯ç»™è¿™ä¸ªé€‰ä¸¾çŠ¶æ€çš„èŠ‚ç‚¹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596215348,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":230975,"user_name":"Kvicii.Y","can_delete":false,"product_type":"c1","uid":1442588,"ip_address":"","ucode":"446BFA633569EA","user_header":"https://static001.geekbang.org/account/avatar/00/16/03/1c/c9fe6738.jpg","comment_is_top":false,"comment_ctime":1593536665,"is_pvip":false,"replies":[{"id":"87636","content":"åŠ ä¸€é¢—æ˜Ÿ:ï¼‰ï¼Œç°åœ¨çœ‹æ¥ï¼Œè¿™ä¸¤ä¸ªé˜¶æ®µå…¶å®æ˜¯å¯ä»¥çœå»çš„ï¼Œæ¯”å¦‚Raftå°±æ²¡æœ‰è¿™ä¸¤ä¸ªé˜¶æ®µï¼ŒæŠ€æœ¯æ˜¯åœ¨ä¸æ–­å‘å±•çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1595751584,"ip_address":"","comment_id":230975,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5888503961","product_id":100046101,"comment_content":"æ„Ÿè§‰æˆå‘˜å‘ç°åº”è¯¥ç®—æ˜¯é€‰ä¸¾è¿‡åçš„ä¸€ä¸ªé€‰ä¸¾è¡¥å¿ï¼Œè€Œæ•°æ®åŒæ­¥åˆ™æ˜¯æ•°æ®è¡¥å¿","like_count":2,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500099,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:ï¼‰ï¼Œç°åœ¨çœ‹æ¥ï¼Œè¿™ä¸¤ä¸ªé˜¶æ®µå…¶å®æ˜¯å¯ä»¥çœå»çš„ï¼Œæ¯”å¦‚Raftå°±æ²¡æœ‰è¿™ä¸¤ä¸ªé˜¶æ®µï¼ŒæŠ€æœ¯æ˜¯åœ¨ä¸æ–­å‘å±•çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595751584,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321303,"user_name":"simple_å­™","can_delete":false,"product_type":"c1","uid":1873629,"ip_address":"","ucode":"A77203E242D652","user_header":"https://static001.geekbang.org/account/avatar/00/1c/96/dd/1620a744.jpg","comment_is_top":false,"comment_ctime":1636772510,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1636772510","product_id":100046101,"comment_content":"ZABå¿…é¡»æœ‰æ•°æ®åŒæ­¥çš„æ“ä½œæ˜¯ä¸æ˜¯å› ä¸ºRaftåœ¨æäº¤æ•°æ®çš„æ—¶å€™ï¼Œè·Ÿéšè€…ä¼šæ£€æŸ¥ä¸Šä¸€æ¡æ•°æ®æ˜¯å¦æäº¤æˆåŠŸï¼Œæ²¡æˆåŠŸçš„è¯å°±ä¼šé‡æ–°åŒæ­¥ï¼›è€ŒZABçš„æ•°æ®åŒæ­¥å°±æ˜¯ä¸€ä¸ªäºŒé˜¶æ®µæäº¤ï¼Œæ²¡æ³•æ£€æŸ¥ä¸Šä¸€ä¸ªä½ç½®çš„åŒæ­¥ç»“æœã€‚","like_count":0,"discussions":[{"author":{"id":1580185,"avatar":"https://static001.geekbang.org/account/avatar/00/18/1c/99/5e1a2118.jpg","nickname":"mylife","note":"","ucode":"D802160BFB29FC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590271,"discussion_content":"ä¸ªäººç†è§£ï¼Œå› ä¸ºzabæ˜¯é€šè¿‡FIFO+TCPæ¥ä¿è¯å‘é€é¡ºåºï¼Œå¦å¤–å‰ä¸€ä¸ªææ¡ˆæå‰ä¹‹å‰ä¸ä¼šæäº¤åä¸€ä¸ªï¼Œzxidåœ¨åŒä¸€ä»»æœŸæ˜¯è¿ç»­çš„ï¼Œéƒ¨åˆ†æ¶ˆæ¯å¯èƒ½è¿˜æ²¡åŒæ­¥å®Œï¼Œè¿™æ—¶leaderå´©æºƒï¼Œåˆ™éƒ¨åˆ†followerçš„æ•°æ®æ˜¯ä¸åŒæ­¥çš„ï¼Œå½“æ–°çš„leaderé€‰ä¸¾å‡ºæ¥åï¼ˆä»»æœŸ+1,è®¡æ•°ä»0å¼€å§‹ï¼‰ï¼Œå¦‚æœä¸å…ˆåŒæ­¥çš„è¯ï¼Œzxidåˆä¸æ˜¯å…¨å±€è¿ç»­çš„ï¼Œfolloweræ˜¯æ— æ³•çŸ¥é“å…¶æ˜¯å¦æ˜¯æœ€æ–°çš„äº†ï¼›è€Œraftä¸ä¸€æ ·ï¼Œå…¶æ˜¯é€šè¿‡æ—¥å¿—çš„ç´¢å¼•ï¼ˆè¿ç»­ï¼Œæ— ç©ºæ´ï¼‰æ¥ç¡®è®¤çš„ï¼Œè¿™æ ·å½“ä¸€ä¸ªæ–°ææ¡ˆè¿‡æ¥åï¼Œå…¶æ˜¯èƒ½é€šè¿‡ç´¢å¼•æ¥åˆ¤æ–­æ˜¯å¦å®Œæ•´ï¼ˆå¦å¤–åŒä¸ªç´¢å¼•ä¹Ÿä¼šæ ¡éªŒé‡Œé¢ä»»æœŸå†…å®¹ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665644021,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":300216,"user_name":"æˆ‘å¯èƒ½æ˜¯ä¸ªå‡å¼€å‘","can_delete":false,"product_type":"c1","uid":1424106,"ip_address":"","ucode":"B4EA4E48D6595A","user_header":"https://static001.geekbang.org/account/avatar/00/15/ba/ea/eb6ec134.jpg","comment_is_top":false,"comment_ctime":1625048995,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1625048995","product_id":100046101,"comment_content":"åº”è¯¥æ€ä¹ˆæ ·ç†è§£å¤§å¤šæ•°å½“é€‰é¢†å¯¼å‘¢ï¼Ÿ<br>å³æ˜¯LOOKINGçŠ¶æ€çš„èŠ‚ç‚¹ä¼šåœ¨ä¸€æ®µæ—¶é—´å†…ï¼ˆå¤šä¹…å‘¢ï¼‰æ”¶é›†é€‰ç¥¨ï¼Ÿå¯¹äºepochç›¸åŒçš„æƒ…å†µï¼ŒæŒ‰zxidä»å¤§åˆ°å°éå†é€‰ç¥¨ï¼Œå¦‚æœçœ‹åˆ°æŸä¸€ä¸ªzxidçš„æ•°é‡æ»¡è¶³å¤§å¤šæ•°æ¡ä»¶ï¼ˆcount(zxid)&gt;(n&#47;2)+1)ï¼Œåˆ™æŠ•ç¥¨è¯¥zxidä¸­é›†ç¾¤idæœ€å¤§çš„èŠ‚ç‚¹ä¸ºé¢†å¯¼è€…ï¼Ÿ","like_count":0},{"had_liked":false,"id":284481,"user_name":"Geek_672f79","can_delete":false,"product_type":"c1","uid":2325033,"ip_address":"","ucode":"F4BEFC33AEC33B","user_header":"","comment_is_top":false,"comment_ctime":1616297988,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"1616297988","product_id":100046101,"comment_content":"éŸ©è€å¸ˆï¼Œ ä½ åœ¨ZABåè®®ï¼ˆ1ï¼‰ æœ‰è¿™ä¹ˆä¸€å¥è¯ï¼šZAB çš„é¢†å¯¼è€…é€‰ä¸¾ï¼Œé€‰ä¸¾å‡ºçš„æ˜¯å¤§å¤šæ•°èŠ‚ç‚¹ä¸­æ•°æ®æœ€å®Œæ•´çš„èŠ‚ç‚¹ã€‚<br> ä½†åœ¨æœ¬ç« æœ‰è¿™ä¹ˆä¸€å¥è¯ ï¼šå¦‚æœå†™è¯·æ±‚å¯¹åº”çš„ææ¡ˆâ€œSET X = 1â€æœªè¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šï¼Œæ¯”å¦‚åœ¨é¢†å¯¼è€…å¹¿æ’­æ¶ˆæ¯è¿‡ç¨‹ä¸­ï¼Œé¢†å¯¼è€…å´©æºƒäº†ï¼Œé‚£ä¹ˆï¼Œææ¡ˆâ€œSET X = 1â€ï¼Œå¯èƒ½è¢«å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹ä¸Šï¼Œå¹¶æäº¤å’Œä¹‹åå°±ä¸å†æ”¹å˜ï¼Œä¹Ÿå¯èƒ½ä¼šè¢«åˆ é™¤ã€‚è¿™ä¸ªè¡Œä¸ºæ˜¯æœªç¡®å®šçš„ï¼Œå–å†³äºæ–°çš„é¢†å¯¼è€…æ˜¯å¦åŒ…å«è¯¥ææ¡ˆã€‚<br><br>    æˆ‘è¯¥å¦‚ä½•å»ç†è§£ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2358506,"avatar":"https://static001.geekbang.org/account/avatar/00/23/fc/ea/3fd73bb7.jpg","nickname":"ğŸ³","note":"","ucode":"7264FC66E53D7F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387281,"discussion_content":"æˆ‘è§‰å¾—éŸ©è€å¸ˆçš„æ„æ€å¯èƒ½æ˜¯ï¼Œå°±æ˜¯å¦‚æœä¸Šä¸€è½®leaderèŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œå¹¶ä¸”åªå¤åˆ¶åˆ°äº†å°‘æ•°followerèŠ‚ç‚¹ä¸Šï¼Œé‡æ–°é€‰ä¸¾çš„æ—¶å€™ï¼Œè¿™äº›å°‘æ•°èŠ‚ç‚¹å‡å› ä¸ºç½‘ç»œåŸå› æ–­å¼€æ— æ³•å‚ä¸é€‰ä¸¾ï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰è¶…è¿‡ä¸€èˆ¬çš„èŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œleaderä»»ç„¶èƒ½å¤Ÿé€‰ä¸¾æˆåŠŸï¼ˆæ–°é€‰å‡ºçš„leaderææ¡ˆæœªåŒ…å«SET X=1ï¼‰ï¼Œç­‰åˆ°è¿›å…¥èŠ‚ç‚¹å‘ç°å’ŒåŒæ­¥çš„çŠ¶æ€çš„æ—¶å€™ï¼Œè¿™äº›æ–­å¼€çš„èŠ‚ç‚¹åˆæ¢å¤äº†ï¼Œæ­¤æ—¶æ–°çš„leaderå·²ç»é€‰å‡ºï¼Œåˆ™ä»¥æ–°çš„leaderä¸ºæ ‡å‡†è¿›è¡ŒåŒæ­¥ï¼Œæ‰€ä»¥è¿™äº›æœ€æ–°çš„ææ¡ˆä¼šè¢«åˆ é™¤ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1628085056,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2113978,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLLniccwC1Mootc7IQsRGUTX3ZkkCKPc7lYV0g8CAqscWtAjd8xkHYcY3UFbYvicm42FXuAO5bZP6WQ/132","nickname":"Geek_417e74","note":"","ucode":"BEA8915879274D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552209,"discussion_content":"æ¯”å¦‚æœ‰1ã€2ã€3ã€4ã€5ã€6ä¸ªèŠ‚ç‚¹ç»„æˆçš„é›†ç¾¤ï¼Œå¤§å¤šæ•°ä¸º4ã€‚å‡è®¾1æ˜¯ä¸»èŠ‚ç‚¹ä¸”set x = 1åªè¢«å¤åˆ¶åˆ° 2 è¿™ä¸ªèŠ‚ç‚¹ã€‚æ­¤æ—¶1èŠ‚ç‚¹å®•æœºäº†ï¼Œå‡è®¾ç°åœ¨3-6è¿™4ä¸ªèŠ‚ç‚¹é€‰æ‹©å‡ºäº†3ä¸ºä¸»èŠ‚ç‚¹ï¼ˆæ»¡è¶³é€‰ä¸¾å¤§å¤šæ•°ï¼Œå¤§å¤šæ•°å¹¶ä¸æ˜¯æ´»ç€çš„æ‰€æœ‰èŠ‚ç‚¹ä¸­æ•°æ®æœ€å®Œæ•´çš„ï¼‰ï¼Œé‚£ä¹ˆèŠ‚ç‚¹2çš„set x=1 å°±ä¼šè¢«ä¸¢å¼ƒï¼Œå½“å®ƒä¸èŠ‚ç‚¹3åŒæ­¥æ•°æ®æ—¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645347812,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1227789,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bc/0d/e65ca230.jpg","nickname":"ğŸ‘»","note":"","ucode":"1648C82AC73C1D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2113978,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLLniccwC1Mootc7IQsRGUTX3ZkkCKPc7lYV0g8CAqscWtAjd8xkHYcY3UFbYvicm42FXuAO5bZP6WQ/132","nickname":"Geek_417e74","note":"","ucode":"BEA8915879274D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560407,"discussion_content":"èŠ‚ç‚¹2ä¸ºå•¥ä¸èƒ½å½“é€‰ğŸ˜…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649317063,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":552209,"ip_address":""},"score":560407,"extra":""},{"author":{"id":3162149,"avatar":"","nickname":"Geek_38348a","note":"","ucode":"6184C1FA9B91D5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1227789,"avatar":"https://static001.geekbang.org/account/avatar/00/12/bc/0d/e65ca230.jpg","nickname":"ğŸ‘»","note":"","ucode":"1648C82AC73C1D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584883,"discussion_content":"ä»–çš„æ„æ€åº”è¯¥æ˜¯1å’Œ2èŠ‚ç‚¹éƒ½å› ä¸ºç½‘ç»œåˆ†åŒºè¿ä¸ä¸Šäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661180925,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":560407,"ip_address":"å¹¿ä¸œ"},"score":584883,"extra":""}]}]}]}