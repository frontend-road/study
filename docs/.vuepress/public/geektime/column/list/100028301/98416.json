{"id":98416,"title":"03 | 揪出隐藏在背后的那些子项目","content":"<p>你好，我是温铭。</p><p>我们先来揭晓上一节最后留下的思考题，如何把 Lua 代码从 nginx.conf 里面抽取出来，保持代码的可读性和可维护性呢？</p><p>操作其实很简单。</p><p>我们先在 geektime 的工作目录下，创建一个名为 lua 的目录，专门用来存放代码：</p><pre><code>$ mkdir lua\n$ cat lua/hello.lua\nngx.say(&quot;hello, world&quot;)\n</code></pre><p>然后修改 nginx.conf 的配置，把 content_by_lua_block 改为 content_by_lua_file：</p><pre><code>pid logs/nginx.pid;\nevents {\n\tworker_connections 1024;\n}\n\nhttp {\n\tserver {\n\t\tlisten 8080;\n\t\tlocation / {\n\t\t\tcontent_by_lua_file lua/hello.lua;\n\t\t\t}\n\t\t}\n\t}\n</code></pre><p>最后，重启 OpenResty 的服务就可以了：</p><pre><code>$ sudo kill -HUP `cat logs/nginx.pid`\n</code></pre><p>你可以使用 curl ，验证是否返回了预期的结果。至于后面 Lua 代码的变更，你就可以直接修改 hello.lua 这个文件，而不是 nginx.conf 了。</p><p>其实，在上面这个小例子里面，也有几个有趣的地方：</p><ol>\n<li>\n<p>content_by_lua_file lua/hello.lua; 里面写的是相对路径，那么 OpenResty 是如何找到这个 Lua 文件的？</p>\n</li>\n<li>\n<p>Lua 代码内容的变更，需要重启 OpenResty 服务才会生效，这样显然不方便调试，那么有没有什么即时生效的方法呢？</p>\n</li>\n<li>\n<p>如何把 lua 代码所在的文件夹，加入到 OpenResty 的查找路径中呢？</p>\n</li>\n</ol><p>这几个问题，我鼓励你先自己思考一下，它们都可以在官方文档里面找到<a href=\"https://github.com/openresty/lua-nginx-module#content_by_lua_file\">答案</a>。这也是为什么，我一直强调文档的重要性。</p><!-- [[[read_end]]] --><p>接下来我们一起来解答。先看第一个问题。如果原本给出的是相对路径，那么 OpenResty 在启动时，会把 OpenResty 启动的命令行参数中的 -p PATH 作为前缀，将相对路径拼接为绝对路径。这样，自然就可以顺利找到Lua 文件。</p><p>再来看第二个问题。Lua 代码在第一个请求时会被加载，并默认缓存起来。所以在你每次修改 Lua 源文件后，都必须重新加载 OpenResty 才会生效。其实，在 nginx.conf 中关闭 lua_code_cache 就能避免重新加载，这一点你可以自己试试看。不过，特别需要注意的是，这种方法<strong>只能临时</strong>用于开发和调试，如果是线上部署，一定要记得打开缓存，否则会非常影响性能。</p><p>最后一个问题，OpenResty 提供了 lua_package_path 指令，可以设置 Lua 模块的查找路径。针对上面的例子，我们可以把 lua_package_path 设置为 <code>$prefix/lua/?.lua;;</code>，其中，</p><ul>\n<li>\n<p><code>$prefix</code>就是启动参数中的 -p PATH；</p>\n</li>\n<li>\n<p><code>/lua/?.lua</code>表示 lua 目录下所有以 .lua 作为后缀的文件；</p>\n</li>\n<li>\n<p>最后的两个分号，则代表内置的代码搜索路径。</p>\n</li>\n</ul><h2>OpenResty 安装后的目录结构</h2><p>了解完第一个 hello world 程序后，我们继续追根究底，来看下 OpenResty 自身安装完成后，它的目录结构是怎样的，以及里面包含哪些文件。</p><p>我们先通过 -V 选项，查看 OpenResty 安装到了哪一个目录。下面的这个结果，我省略了很多模块的编译参数，这些我们稍后再来补上：</p><pre><code>$ openresty -V\nnginx version: openresty/1.13.6.2\nbuilt by clang 10.0.0 (clang-1000.10.44.4)\nbuilt with OpenSSL 1.1.0h  27 Mar 2018\nTLS SNI support enabled\nconfigure arguments: --prefix=/usr/local/Cellar/openresty/1.13.6.2/nginx ...\n</code></pre><p>我本地是通过 brew 安装的，所以目录是<code>/usr/local/Cellar/openresty/1.13.6.2/nginx</code> ，和你的本地环境很可能不同。这其中主要包含了 bin、luajit、lualib、nginx、pod 这几个子目录。理解这几个文件夹的含义很重要，可以帮我们更好地学习 OpenResty。接下来，我们逐个来看一下。</p><p>首先是最重要的 bin 目录：</p><pre><code>$ ll /usr/local/Cellar/openresty/1.13.6.2/bin\ntotal 320\n-r-xr-xr-x  1 ming  admin    19K  3 27 12:54 md2pod.pl\n-r-xr-xr-x  1 ming  admin    15K  3 27 12:54 nginx-xml2pod\nlrwxr-xr-x  1 ming  admin    19B  3 27 12:54 openresty -&gt; ../nginx/sbin/nginx\n-r-xr-xr-x  1 ming  admin    62K  3 27 12:54 opm\n-r-xr-xr-x  1 ming  admin    29K  3 27 12:54 resty\n-r-xr-xr-x  1 ming  admin    15K  3 27 12:54 restydoc\n-r-xr-xr-x  1 ming  admin   8.3K  3 27 12:54 restydoc-index\n</code></pre><p>这里面既有我们上一节中提到的 OpenResty CLI resty，也有最核心的可执行文件 openresty，它其实是 nginx 的一个软链接。至于目录里面其他的一些工具，没有任何悬念，它们和 resty 一样，都是 Perl 脚本。</p><p>在这其中，opm 是包管理工具，可以通过它来管理各类第三方包，后面会有一节内容专门来讲；而 restydoc，则是我们第一节提到过的“老朋友”了，它是 OpenResty 提供的文档查看工具，你可以通过它来查看 OpenResty 和 NGINX 的使用文档：</p><pre><code>$ restydoc -s ngx.say\n$ restydoc -s proxy_pass\n</code></pre><p>这段代码中的两个例子，分别查询了 OpenResty 的 API 和 NGINX 的指令。restydoc 这个工具，对服务端工程师的专注开发有很大帮助。</p><p>浏览完了 bin 目录，我们接着看下 pod 目录。先强调一点，这里的“pod”，和 k8s 里“pod”的概念完全没有关系。pod 是 Perl 里面的一种标记语言，用于给 Perl 的模块编写文档。pod 目录中存放的就是 OpenResty、 NGINX、lua-resty-*、LuaJIT 的文档， 这些就和刚才提到的 restydoc 联系在一起了。</p><p>接下来是熟悉的 nginx 和 luajit 这两个目录。这两个很好理解，主要存放  NGINX 和 LuaJIT 的可执行文件和依赖，是 OpenResty 的基石。很多人说 OpenResty 基于 Lua，这个说法其实并不准确，从上面我们可以看出， OpenResty 其实是基于 LuaJIT的。</p><p>事实上，早期的 OpenResty 同时带有 Lua 和 LuaJIT，你可以通过编译选项，来决定使用 Lua 还是 LuaJIT。不过到了现在，Lua逐渐被淘汰，就只支持更高性能的 LuaJIT了。</p><p>最后，我们看下 lualib 目录。它里面存放的是 OpenResty 中使用到的 Lua 库，主要分为 ngx 和 resty 两个子目录。</p><ul>\n<li>\n<p>前者存放的是 <a href=\"https://github.com/openresty/lua-resty-core/tree/master/lib/ngx\">lua-resty-core</a> 这个官方项目中的 Lua 代码，里面都是基于 FFI 重新实现的 OpenResty API，后面我会用专门的文章来解释为什么要重新实现，这里你有个大概印象即可，不必深究。</p>\n</li>\n<li>\n<p>而 resty 目录中存放的则是各种 lua-resty-* 项目包含的 Lua 代码，接下来我们会接触到。</p>\n</li>\n</ul><p>按照我讲课的惯例，到这一步我会给出这些目录源头的出处。这也是开源项目的乐趣之一，如果你喜欢打破砂锅问到底，那你总发现更多好玩的东西。</p><p>下面是 OpenResty 在 CentOS 中的<a href=\"https://github.com/openresty/openresty-packaging/blob/master/rpm/SPECS/openresty.spec#L218\">打包脚本</a>，里面包含了上面提到的所有目录，你可以自己了解一下。</p><pre><code>%files\n%defattr(-,root,root,-)\n\n/etc/init.d/%{name}\n/usr/bin/%{name}\n%{orprefix}/bin/openresty\n%{orprefix}/site/lualib/\n%{orprefix}/luajit/*\n%{orprefix}/lualib/*\n%{orprefix}/nginx/html/*\n%{orprefix}/nginx/logs/\n%{orprefix}/nginx/sbin/*\n%{orprefix}/nginx/tapset/*\n%config(noreplace) %{orprefix}/nginx/conf/*\n%{orprefix}/COPYRIGHT\n</code></pre><h2>OpenResty 项目概览</h2><p>提到 OpenResty，你应该会想到 lua-nginx-module。没错，<strong>这个 NGINX 的 C 模块确实是 OpenResty 的核心，但它并不等价于 OpenResty</strong>。很多工程师都会把 OpenResty 叫做 ngx lua，有不少技术大会的分享和出版的书籍中也是用的这个叫法，这其实是不严谨的，也是 OpenResty 社区不提倡的。</p><p>下面我来讲讲为什么，以及 OpenResty 中除了 lua-nginx-module ，还有哪些其他的关联项目。</p><p>打开 OpenResty 在 GitHub 的  <a href=\"https://github.com/openresty/\">项目主页</a>，你可以看到 OpenResty 包含了 68 个公开的项目，大概分为以下 7 类, 下面我来分别简单介绍下，让你有个初步的印象，这样你后面学习起来也轻松一些。</p><h3><strong>NGINX C 模块</strong></h3><p>OpenResty 的项目命名都是有规范的，以 <code>*-nginx-module</code>命名的就是 NGINX 的 C 模块。</p><p>OpenResty 中一共包含了 20 多个 C 模块，我们在本节最开始使用的openresty -V 中，也可以看到这些 C 模块：</p><pre><code>$ openresty -V\nnginx version: openresty/1.13.6.2\nbuilt by clang 10.0.0 (clang-1000.10.44.4)\nbuilt with OpenSSL 1.1.0h  27 Mar 2018\nTLS SNI support enabled\nconfigure arguments: --prefix=/usr/local/Cellar/openresty/1.13.6.2/nginx --with-cc-opt='-O2 -I/usr/local/include -I/usr/local/opt/pcre/include -I/usr/local/opt/openresty-openssl/include' --add-module=../ngx_devel_kit-0.3.0 --add-module=../echo-nginx-module-0.61 --add-module=../xss-nginx-module-0.06 --add-module=../ngx_coolkit-0.2rc3 --add-module=../set-misc-nginx-module-0.32 --add-module=../form-input-nginx-module-0.12 --add-module=../encrypted-session-nginx-module-0.08 --add-module=../srcache-nginx-module-0.31 --add-module=../ngx_lua-0.10.13 --add-module=../ngx_lua_upstream-0.07 --add-module=../headers-more-nginx-module-0.33 --add-module=../array-var-nginx-module-0.05 --add-module=../memc-nginx-module-0.19 --add-module=../redis2-nginx-module-0.15 --add-module=../redis-nginx-module-0.3.7 --add-module=../ngx_stream_lua-0.0.5 --with-ld-opt='-Wl,-rpath,/usr/local/Cellar/openresty/1.13.6.2/luajit/lib -L/usr/local/lib -L/usr/local/opt/pcre/lib -L/usr/local/opt/openresty-openssl/lib' --pid-path=/usr/local/var/run/openresty.pid --lock-path=/usr/local/var/run/openresty.lock --conf-path=/usr/local/etc/openresty/nginx.conf --http-log-path=/usr/local/var/log/nginx/access.log --error-log-path=/usr/local/var/log/nginx/error.log --with-pcre-jit --with-ipv6 --with-stream --with-stream_ssl_module --with-stream_ssl_preread_module --with-http_v2_module --without-mail_pop3_module --without-mail_imap_module --without-mail_smtp_module --with-http_stub_status_module --with-http_realip_module --with-http_addition_module --with-http_auth_request_module --with-http_secure_link_module --with-http_random_index_module --with-http_geoip_module --with-http_gzip_static_module --with-http_sub_module --with-http_dav_module --with-http_flv_module --with-http_mp4_module --with-http_gunzip_module --with-threads --with-dtrace-probes --with-stream --with-stream_ssl_module --with-http_ssl_module\n</code></pre><p>这里<code>--add-module=</code>后面跟着的，就是 OpenResty 的 C 模块。其中，最核心的就是 lua-nginx-module 和 stream-lua-nginx-module，前者用来处理七层流量，后者用来处理四层流量。</p><p><strong>这些 C 模块中，有些是需要特别注意的，虽然默认编译进入了 OpenResty，但并不推荐使用</strong>。 比如 redis2-nginx-module、redis-nginx-module 和 memc-nginx-module，它们是用来和 redis以及memcached 交互使用的。这些 C 库是 OpenResty 早期推荐使用的，但在 cosocket 功能加入之后，它们都已经被 lua-resty-redis 和 lua-resty-memcached 替代，处于疏于维护的状态。</p><p>OpenResty 后面也不会开发更多的 NGINX C 库，而是专注在基于 cosocket 的 Lua 库上，后者才是未来。</p><h3>lua-resty-周边库</h3><p>OpenResty 官方仓库中包含 18 个 lua-resty-* 库，涵盖 Redis、MySQL、memcached、websocket、dns、流量控制、字符串处理、进程内缓存等常用库。除了官方自带的之外，还有更多的第三方库。它们非常重要，所以下一章节，我们会花更多的篇幅来专门介绍这些周边库。</p><h3>自己维护的 LuaJIT 分支</h3><p>OpenResty 除了维护自己的 OpenSSL patch 外，还维护了自己的 <a href=\"https://github.com/openresty/luajit2\">LuaJIT 分支</a>。在 2015 年，LuaJIT 的作者 Mike Pall 宣布退休，寻找新的 LuaJIT 维护者，但 Mike 并没有找到合适的维护者，他现在主要是做 bugfix 的维护工作，新功能的开发也已经暂停，所以 OpenResty 维护着自己的 LuaJIT 分支。</p><p><strong>相对于 Lua，LuaJIT 增加了不少独有的函数，这些函数非常重要</strong>，但知道的工程师并不多，算是_半隐藏技能_，后面我也会专门介绍。</p><h3>测试框架</h3><p>OpenResty 的测试框架是<a href=\"https://github.com/openresty/test-nginx\">test-nginx</a>，同样也是用 Perl 语言来开发的，从名字上就能看出来，它是专门用来测试 NGINX 相关的项目。OpenResty 官方的所有 C 模块和 lua-resty 库的测试案例，都是由 test-nginx 驱动的。</p><p>这个框架和常见的基于断言的框架不同，是一套更强大和独立的系统，我们后面会花几节课来专门学习。</p><p>事实上，有些 OpenResty 的代码贡献者也没有搞清楚这个测试框架，有时候提交的 PR 中包含了不少复杂的 C 和 Lua 代码，但对编写对应的测试案例一事，还是经常发怵。所以，如果你已经查看过一些 OpenResty 项目中<code>/t</code>目录里面的测试案例，却仍然一头雾水，先别急着怀疑自己，大部分人都是一样的。</p><p>除了 test-nginx 之外，<a href=\"https://github.com/openresty/mockeagain\">mockeagain</a> 这个项目可以模拟慢速的网络，让程序每次只读写一个字节。对于 web 服务器来说，这是一个很有用的工具。</p><h3>调试工具链</h3><p>OpenResty 项目在如何科学和动态地调试代码上，花费了大量的精力，可以说是达到了极致。OpenResty 的作者章亦春专门写了<a href=\"https://openresty.org/posts/dynamic-tracing/\">一篇文章</a>，来介绍动态追踪技术。我强烈推荐给你，看完也有助于理解对应的工具链。</p><p><a href=\"https://github.com/openresty/openresty-systemtap-toolkit\">openresty-systemtap-toolkit</a> 和 <a href=\"https://github.com/openresty/stapxx\">stapxx</a> 这两个 OpenResty 的项目，都基于 systemtap 这个动态调试和追踪工具。使用 systemtap 最大的优势，便是实现活体分析，同时对目标程序完全无侵入。</p><p>打个比方，systemtap，就像是我们去医院照了个 CT，无痛无感知。更棒的是，systemtap 可以生成直观的火焰图来做性能分析，后面我也会专门介绍，这里先放一个火焰图，让你直观上有个感性的认识：</p><p><img src=\"https://static001.geekbang.org/resource/image/dc/7f/dcc1340a7622ba1643e8d8b9347a417f.png?wh=736*492\" alt=\"\"></p><h3>打包相关</h3><p>OpenResty 在不同发行操作系统（比如 CentOS、Ubuntu、MacOS 等）版本中的打包脚本，出于更细可控力度的目的，都是手工编写的。我们在介绍安装后目录结构的时候，就已经涉及到了这些打包相关的项目：<a href=\"https://github.com/openresty/openresty-packaging\">openresty-packaging</a>  和 <a href=\"https://github.com/openresty/homebrew-brew\">home-brew</a>。如果你对此有兴趣，可以自行学习，这里我就不再赘述了。</p><h3>工程化工具</h3><p>除了上面这些比较大块儿的项目之外，OpenResty 还有一些负责工程化的工具，大都也是“深藏闺中”。</p><p>比如 <a href=\"https://github.com/openresty/openresty-devel-utils\">openresty-devel-utils</a> 就是开发 OpenResty 和 NGINX 的工具集。它们也都使用 Perl 开发，其中大部分的工具都是没有文档的。但对于 OpenResty 的开发者来说，这些工具又是非常有用的。</p><p>这里我先挑几个简单介绍一下。</p><p><a href=\"https://github.com/openresty/openresty-devel-utils/blob/master/lj-releng\">lj-releng</a> 是一个简单有效的 LuaJIT 代码检测工具，类似 luacheck，可以找出全局变量等潜在的问题。</p><p><a href=\"https://github.com/openresty/openresty-devel-utils/blob/master/reindex\">reindex</a> 从名字来看是重建索引的意思，它其实是格式化 test-nginx 测试案例的工具，可以重新排列测试案例的编号，以及去除多余的空白符。reindex 可以说是 OpenResty 开发者每天都会用到的工具之一。</p><p><a href=\"https://github.com/openresty/opsboy\">opsboy</a> 也是一个深藏不露的项目，主要用于自动化部署。OpenResty 每次发布版本前，都会在 AWS EC2 集群上做完整的回归测试，详细的文档你可以参考<a href=\"https://openresty.org/en/ec2-test-cluster.html\">官方文档</a>，而这个回归测试正是由 opsboy 来部署和驱动的。</p><p>opsboy 是一个用 Perl 实现的 DSL（领域特定语言）。实际上， OpenResty 的作者非常喜欢创造各种不同的 DSL 来解决问题。</p><h2>写在最后</h2><p>今天，我们主要学习了OpenResty 安装后的目录结构，以及背后的一些子项目。希望你学完今天的内容后，能够了解更多 OpenResty 的项目。OpenResty 已经远远超出了 NGINX 负载均衡和反向代理的范畴，实现了自己的生态，下一次我们会详细聊聊这方面。</p><p>对于今天的内容，你有哪些疑惑和问题吗？欢迎留言和我分享，也欢迎你把这篇文章转发给你的同事、朋友，一起学习高效开发。</p>","neighbors":{"left":{"article_title":"02 | 如何写出你的“hello world”？","id":97475},"right":{"article_title":"04 | 如何管理第三方包？从包管理工具luarocks和opm说起","id":98660}},"comments":[{"had_liked":false,"id":99874,"user_name":"oatlmy","can_delete":false,"product_type":"c1","uid":1019438,"ip_address":"","ucode":"D5B0291801F902","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8e/2e/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1559350905,"is_pvip":false,"replies":[{"id":"36149","content":"加油：）","user_name":"作者回复","comment_id":99874,"uid":"1017955","ip_address":"","utype":1,"ctime":1559551966,"user_name_real":"温铭@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"35919089273","product_id":100028301,"comment_content":"看了温大15年底的文章《OpenResty的现状、趋势、使用及学习方法》，对比在三年半后的这几篇文章中讲到的特性模块，真是太优秀了！","like_count":8,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"温铭@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452302,"discussion_content":"加油：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559551966,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99609,"user_name":"红鲤鱼与绿鲤鱼与驴baci","can_delete":false,"product_type":"c1","uid":1199902,"ip_address":"","ucode":"CB7D8A522D665E","user_header":"https://static001.geekbang.org/account/avatar/00/12/4f/1e/cb8ddbe9.jpg","comment_is_top":false,"comment_ctime":1559266182,"is_pvip":false,"replies":[{"id":"35801","content":"是的，多谢指正","user_name":"作者回复","comment_id":99609,"uid":"1017955","ip_address":"","utype":1,"ctime":1559271246,"user_name_real":"温铭@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"23034102662","product_id":100028301,"comment_content":"sudo kill -HUP cat logs&#47;nginx.pid<br> 代码  应该是<br>sudo kill -HUP `cat logs&#47;nginx.pid` 吧 ","like_count":5,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"温铭@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452189,"discussion_content":"是的，多谢指正","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559271246,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":287861,"user_name":"KevinGao","can_delete":false,"product_type":"c1","uid":1030494,"ip_address":"","ucode":"DDA27A8961D720","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b9/5e/accb1628.jpg","comment_is_top":false,"comment_ctime":1618198067,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18798067251","product_id":100028301,"comment_content":"CentOS 下 OpenResty 安装后需要手动安装 resty，doc 和 opm<br><br>1，安装 openresty-resty<br>```<br>yum install openresty-resty<br>```<br>2，安装 opm<br>```<br>yum install openresty-opm<br>```<br><br>3，安装 restydoc (其实安装 OPM 时会自动安装 doc)<br>```<br>yum install openresty-doc<br>```<br><br>4，列出可用的 openresty 包<br>```<br>yum --disablerepo=&quot;*&quot; --enablerepo=&quot;openresty&quot; list available<br>```","like_count":5},{"had_liked":false,"id":99516,"user_name":"石仔","can_delete":false,"product_type":"c1","uid":1177921,"ip_address":"","ucode":"974E4604CE2213","user_header":"https://static001.geekbang.org/account/avatar/00/11/f9/41/411b1753.jpg","comment_is_top":false,"comment_ctime":1559234114,"is_pvip":false,"replies":[{"id":"35802","content":"专栏最后也会搭建一个 api 网关：）","user_name":"作者回复","comment_id":99516,"uid":"1017955","ip_address":"","utype":1,"ctime":1559271303,"user_name_real":"温铭@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"18739103298","product_id":100028301,"comment_content":"之前项目需要做个nginx为基础的api网关，我用了nginx + lua-nginx-module模块 模拟kong的编码结构做了一个半吊子的实践。当时的文档和生态都没有现在丰富，都是摸着石头过河，现在终于找到宝了，能让我系统化的窥探这架构了，非常感谢作者","like_count":4,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"温铭@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452145,"discussion_content":"专栏最后也会搭建一个 api 网关：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559271303,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":129118,"user_name":"写点啥呢","can_delete":false,"product_type":"c1","uid":1065272,"ip_address":"","ucode":"C19032CF1C41BA","user_header":"https://static001.geekbang.org/account/avatar/00/10/41/38/4f89095b.jpg","comment_is_top":false,"comment_ctime":1567044539,"is_pvip":false,"replies":[{"id":"49341","content":"是的，你的理解是对的","user_name":"作者回复","comment_id":129118,"uid":"1017955","ip_address":"","utype":1,"ctime":1567650273,"user_name_real":"温铭@OpenResty"}],"discussion_count":2,"race_medal":0,"score":"14451946427","product_id":100028301,"comment_content":"请问老师，lua_package_path似乎配置的是lua依赖的搜索路径，对于content_by_lua_file, 我试验发现它只在prefix下去根据指令提供的文件相对路径去搜索，而不会到lua_package_path下搜索，不知道我的理解对不对？","like_count":3,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"温铭@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465288,"discussion_content":"是的，你的理解是对的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567650273,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065272,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/38/4f89095b.jpg","nickname":"写点啥呢","note":"","ucode":"C19032CF1C41BA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7722,"discussion_content":"明白了，谢谢老师","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567651549,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101192,"user_name":"业余草","can_delete":false,"product_type":"c1","uid":1126538,"ip_address":"","ucode":"99BDC1E629049D","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/8a/b5ca7286.jpg","comment_is_top":false,"comment_ctime":1559736923,"is_pvip":false,"replies":[{"id":"36602","content":"OpenResty 的名字来历？<br>OpenResty 最早是雅虎中国的一个公司项目，起步于 2007 年 10 月。当时兴起了 OpenAPI 的热潮，于是春哥想做一个类似的东西，可以支持各种 Web Service 的需求。<br>Open 取自 OpenAPI， Resty 取自 rest API。","user_name":"作者回复","comment_id":101192,"uid":"1017955","ip_address":"","utype":1,"ctime":1559864299,"user_name_real":"温铭@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"14444638811","product_id":100028301,"comment_content":"这是第3张了。但是我看到现在我还没有看懂这个名字的来历。就是现在有人问的话，我也是一脸懵逼啊。","like_count":4,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"温铭@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452847,"discussion_content":"OpenResty 的名字来历？\nOpenResty 最早是雅虎中国的一个公司项目，起步于 2007 年 10 月。当时兴起了 OpenAPI 的热潮，于是春哥想做一个类似的东西，可以支持各种 Web Service 的需求。\nOpen 取自 OpenAPI， Resty 取自 rest API。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1559864299,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":166259,"user_name":"莫得办法","can_delete":false,"product_type":"c1","uid":1073958,"ip_address":"","ucode":"D3E07A4CFD1AAA","user_header":"https://static001.geekbang.org/account/avatar/00/10/63/26/8c8be018.jpg","comment_is_top":false,"comment_ctime":1577425835,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10167360427","product_id":100028301,"comment_content":"为什么centos7安装的没有restydoc，&#47;usr&#47;local&#47;openresty&#47;bin中只有一个openresty的软连接，一个CLI resty，再没有其他了","like_count":2,"discussions":[{"author":{"id":1030494,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b9/5e/accb1628.jpg","nickname":"KevinGao","note":"","ucode":"DDA27A8961D720","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366817,"discussion_content":"需要手动安装一下，命令如下：\n```\nyum install openresty-resty\n```\nopm 和 restydoc 的安装也类似。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1618198143,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99724,"user_name":"K1","can_delete":false,"product_type":"c1","uid":1069409,"ip_address":"","ucode":"B0F7B3CE522934","user_header":"https://static001.geekbang.org/account/avatar/00/10/51/61/e4b1b737.jpg","comment_is_top":false,"comment_ctime":1559286078,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"10149220670","product_id":100028301,"comment_content":"需要出一本书，OpenResty开发权威指南","like_count":2},{"had_liked":false,"id":242112,"user_name":"向阳","can_delete":false,"product_type":"c1","uid":1782743,"ip_address":"","ucode":"2F82A31B8D1263","user_header":"https://static001.geekbang.org/account/avatar/00/1b/33/d7/ce91d1d3.jpg","comment_is_top":false,"comment_ctime":1597592102,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5892559398","product_id":100028301,"comment_content":"centos7 使用wget https:&#47;&#47;openresty.org&#47;package&#47;centos&#47;openresty.repo及yum install -y openresty-resty安装之后默认没有安装resty-doc帮助工具咋办","like_count":1,"discussions":[{"author":{"id":1030494,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b9/5e/accb1628.jpg","nickname":"KevinGao","note":"","ucode":"DDA27A8961D720","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366820,"discussion_content":"需要手动安装一下，命令如下：\n```\nyum install openresty-resty\n```\nopm 和 restydoc 的安装也类似。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618198746,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":120175,"user_name":"ZeroIce","can_delete":false,"product_type":"c1","uid":1305369,"ip_address":"","ucode":"30133BA83CE349","user_header":"https://static001.geekbang.org/account/avatar/00/13/eb/19/0d990b03.jpg","comment_is_top":false,"comment_ctime":1564803561,"is_pvip":false,"replies":[{"id":"46066","content":"慢慢来，现有一个印象。用到的话才能理解深入","user_name":"作者回复","comment_id":120175,"uid":"1017955","ip_address":"","utype":1,"ctime":1566197464,"user_name_real":"温铭@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"5859770857","product_id":100028301,"comment_content":"初学者对于这些模块有什么作用，听起来一脸懵","like_count":1,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"温铭@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461224,"discussion_content":"慢慢来，现有一个印象。用到的话才能理解深入","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566197464,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":105288,"user_name":"洁","can_delete":false,"product_type":"c1","uid":1510376,"ip_address":"","ucode":"154C10D830FB70","user_header":"https://static001.geekbang.org/account/avatar/00/17/0b/e8/1deb2efc.jpg","comment_is_top":false,"comment_ctime":1560955351,"is_pvip":false,"replies":[{"id":"38897","content":"看看 error.log 的信息，是不是 lua 代码没有被找到？","user_name":"作者回复","comment_id":105288,"uid":"1017955","ip_address":"","utype":1,"ctime":1561550194,"user_name_real":"温铭@OpenResty"}],"discussion_count":9,"race_medal":0,"score":"5855922647","product_id":100028301,"comment_content":"[root@localhost geektime]# sudo kill -HUP `cat logs&#47;nginx.pid`<br>[root@localhost geektime]# curl -i 127.0.0.1:8080<br>HTTP&#47;1.1 404 Not Found<br>Server: openresty&#47;1.15.8.1<br>Date: Wed, 19 Jun 2019 14:41:34 GMT<br>Content-Type: text&#47;html<br>Content-Length: 159<br>Connection: keep-alive<br><br>&lt;html&gt;<br>&lt;head&gt;&lt;title&gt;404 Not Found&lt;&#47;title&gt;&lt;&#47;head&gt;<br>&lt;body&gt;<br>&lt;center&gt;&lt;h1&gt;404 Not Found&lt;&#47;h1&gt;&lt;&#47;center&gt;<br>&lt;hr&gt;&lt;center&gt;openresty&#47;1.15.8.1&lt;&#47;center&gt;<br>&lt;&#47;body&gt;<br>&lt;&#47;html&gt;<br>[root@localhost geektime]# <br>为什么我运行出来是404？？","like_count":1,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"温铭@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454623,"discussion_content":"看看 error.log 的信息，是不是 lua 代码没有被找到？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561550194,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1546623,"avatar":"https://static001.geekbang.org/account/avatar/00/17/99/7f/a4bed858.jpg","nickname":"shunjingxu","note":"","ucode":"0AABE09F605223","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511,"discussion_content":"应该是root启动openresty·，和我遇到的是一样的，error.log是 Permission denied\n切换成普通用户启动","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1561627815,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1078003,"avatar":"https://static001.geekbang.org/account/avatar/00/10/72/f3/0c870296.jpg","nickname":"文心","note":"","ucode":"E5DD9BEC4D7BC7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549464,"discussion_content":"nginx默认用户是“nobody”（ps -ef|grep nginx 可以查看你的nginx运行用户），需要在nginx.conf里开头加一个 &#34;user 当前用户;&#34;，比如你是用root自己玩的，就加上“user root;”","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1643994626,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1611025,"avatar":"https://static001.geekbang.org/account/avatar/00/18/95/11/eb431e52.jpg","nickname":"沈康","note":"","ucode":"02AFA50738AB8E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308261,"discussion_content":"网上说是worker进程没有权限的问题？nobody用户启动的worker导致没有权限打开lua脚本\n不是很清楚这个，使用普通用户启动正常使用了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1600878190,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1237588,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e2/54/f836054a.jpg","nickname":"耿斌","note":"","ucode":"6535D0B012D78E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":192452,"discussion_content":"猜测是 nginx.conf 中没有配置 &#34;location /&#34;，最好是把 nginx.conf 贴上来瞧瞧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583074586,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1317115,"avatar":"https://static001.geekbang.org/account/avatar/00/14/18/fb/c1334976.jpg","nickname":"王崧霁","note":"","ucode":"4F3284634293A8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5419,"discussion_content":"路径不对","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566259290,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1545885,"avatar":"https://static001.geekbang.org/account/avatar/00/17/96/9d/a1610593.jpg","nickname":"开心","note":"","ucode":"19026197177BF3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":952,"discussion_content":"换个目录启动就好了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562203613,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1545885,"avatar":"https://static001.geekbang.org/account/avatar/00/17/96/9d/a1610593.jpg","nickname":"开心","note":"","ucode":"19026197177BF3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":949,"discussion_content":"我也遇到这个问题了 不知道怎么回事","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562202997,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1559537,"avatar":"https://static001.geekbang.org/account/avatar/00/17/cb/f1/80a8eb3e.jpg","nickname":"RX-78ACE","note":"","ucode":"162E1693378DA4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":65,"discussion_content":"同问，找到原因了吗？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1561046957,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":103819,"user_name":"小飞哥 ‍超級會員","can_delete":false,"product_type":"c1","uid":1110049,"ip_address":"","ucode":"417F9563B3005B","user_header":"https://static001.geekbang.org/account/avatar/00/10/f0/21/104b9565.jpg","comment_is_top":false,"comment_ctime":1560520786,"is_pvip":false,"replies":[{"id":"37592","content":"大写的 V","user_name":"作者回复","comment_id":103819,"uid":"1017955","ip_address":"","utype":1,"ctime":1560567331,"user_name_real":"温铭@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"5855488082","product_id":100028301,"comment_content":"为什么我openresty -v之后只有一条，我没有后面几行？","like_count":1,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"温铭@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454010,"discussion_content":"大写的 V","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560567331,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101190,"user_name":"大裤衩子","can_delete":false,"product_type":"c1","uid":1387321,"ip_address":"","ucode":"D81B173A49D680","user_header":"https://static001.geekbang.org/account/avatar/00/15/2b/39/91c23066.jpg","comment_is_top":false,"comment_ctime":1559736716,"is_pvip":false,"replies":[{"id":"36600","content":"因为这里的 nginx 并不等同于官方的 nginx，而是把很多 c 模块打包重新生成的。<br>所以，为了和你本地已经安装好的 nginx 做区分，就做了一个软链接，名字是 OpenResty","user_name":"作者回复","comment_id":101190,"uid":"1017955","ip_address":"","utype":1,"ctime":1559864066,"user_name_real":"温铭@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"5854704012","product_id":100028301,"comment_content":"Openresty可执行文件是nginx的一个软连接？这样的话为什么不直接基于本地已经装好的nginx呢？","like_count":1,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"温铭@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452845,"discussion_content":"因为这里的 nginx 并不等同于官方的 nginx，而是把很多 c 模块打包重新生成的。\n所以，为了和你本地已经安装好的 nginx 做区分，就做了一个软链接，名字是 OpenResty","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559864066,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101026,"user_name":"初音未来","can_delete":false,"product_type":"c1","uid":1274518,"ip_address":"","ucode":"3AE23DBC649B97","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erKFNFAQl3ibwlic54a5SQYAMhQYeVtMnSmMahZZjyqG2d66whxbEE3I3IyD07pSmte5DSibr71m6A9g/132","comment_is_top":false,"comment_ctime":1559702577,"is_pvip":false,"replies":[{"id":"36598","content":"后面会讲到代码热更新","user_name":"作者回复","comment_id":101026,"uid":"1017955","ip_address":"","utype":1,"ctime":1559863868,"user_name_real":"温铭@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"5854669873","product_id":100028301,"comment_content":"老师你好,lua_code_cache 打开之后怎么解决lua代码更新及时生效的问题呢","like_count":1,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"温铭@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452783,"discussion_content":"后面会讲到代码热更新","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559863868,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":100439,"user_name":"王金全","can_delete":false,"product_type":"c1","uid":1005614,"ip_address":"","ucode":"473D9FC05A66E8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/58/2e/da4058c6.jpg","comment_is_top":false,"comment_ctime":1559556195,"is_pvip":false,"replies":[{"id":"36555","content":"是的，指定 pid 就行","user_name":"作者回复","comment_id":100439,"uid":"1017955","ip_address":"","utype":1,"ctime":1559805443,"user_name_real":"温铭@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"5854523491","product_id":100028301,"comment_content":"指定pid就可以了，02节例子中没有指定pid","like_count":1,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"温铭@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452550,"discussion_content":"是的，指定 pid 就行","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559805443,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":100133,"user_name":"howei","can_delete":false,"product_type":"c1","uid":1301215,"ip_address":"","ucode":"D4D0A9C99AB0B7","user_header":"https://static001.geekbang.org/account/avatar/00/13/da/df/3739e120.jpg","comment_is_top":false,"comment_ctime":1559455722,"is_pvip":false,"replies":[{"id":"36152","content":"可以更换个目录来存放 lua 代码，或者指定 user","user_name":"作者回复","comment_id":100133,"uid":"1017955","ip_address":"","utype":1,"ctime":1559552137,"user_name_real":"温铭@OpenResty"}],"discussion_count":2,"race_medal":0,"score":"5854423018","product_id":100028301,"comment_content":"配置文件有个权限问题,如果不指定user 用户默认是nobody 无法执行lua 文件就会报错[error] 31322#31322: *1 failed to load external Lua file &quot;&#47;root&#47;geektime&#47;lua&#47;hello.lua&quot;: cannot open &#47;root&#47;geektime&#47;lua&#47;hello.lua: Permission denied, client: 127.0.0.1, server: ,","like_count":1,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"温铭@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452423,"discussion_content":"可以更换个目录来存放 lua 代码，或者指定 user","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559552137,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1717937,"avatar":"","nickname":"胡化敏","note":"","ucode":"D6574E9AAFC294","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":208602,"discussion_content":"user root;\npid logs/nginx.pid;\nevents {\n  worker_connections 1024;\n}\n\nhttp {\n  server {\n    listen 8080;\n    location / {\n      content_by_lua_file lua/hello.lua;\n      }\n    }\n  }","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584551253,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":100012,"user_name":"Panda","can_delete":false,"product_type":"c1","uid":1095740,"ip_address":"","ucode":"911A200C7B18BE","user_header":"https://static001.geekbang.org/account/avatar/00/10/b8/3c/1a294619.jpg","comment_is_top":false,"comment_ctime":1559386770,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5854354066","product_id":100028301,"comment_content":"分析项目结构 如庖丁解牛 ","like_count":1},{"had_liked":false,"id":99993,"user_name":"王金全","can_delete":false,"product_type":"c1","uid":1005614,"ip_address":"","ucode":"473D9FC05A66E8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/58/2e/da4058c6.jpg","comment_is_top":false,"comment_ctime":1559381470,"is_pvip":false,"replies":[{"id":"36150","content":"nginx.conf 中是否有 pid 的设置呢？","user_name":"作者回复","comment_id":99993,"uid":"1017955","ip_address":"","utype":1,"ctime":1559552052,"user_name_real":"温铭@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"5854348766","product_id":100028301,"comment_content":"我在macOS下，按照官方文档安装，按照例子执行，logs&#47;nginx.pid找不到,能找到&#47;usr&#47;local&#47;var&#47;run&#47;openresty.pid文件，不知道是不是有问题？","like_count":1,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"温铭@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452356,"discussion_content":"nginx.conf 中是否有 pid 的设置呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559552052,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99961,"user_name":"洁","can_delete":false,"product_type":"c1","uid":1510376,"ip_address":"","ucode":"154C10D830FB70","user_header":"https://static001.geekbang.org/account/avatar/00/17/0b/e8/1deb2efc.jpg","comment_is_top":false,"comment_ctime":1559373090,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5854340386","product_id":100028301,"comment_content":"老师你好，我发现在geektime文件中有很多以_temp结尾的文件夹，这些文件夹有什么作用吗？","like_count":2},{"had_liked":false,"id":99959,"user_name":"洁","can_delete":false,"product_type":"c1","uid":1510376,"ip_address":"","ucode":"154C10D830FB70","user_header":"https://static001.geekbang.org/account/avatar/00/17/0b/e8/1deb2efc.jpg","comment_is_top":false,"comment_ctime":1559372945,"is_pvip":false,"replies":[{"id":"36160","content":"这些没有什么用的","user_name":"作者回复","comment_id":99959,"uid":"1017955","ip_address":"","utype":1,"ctime":1559552695,"user_name_real":"温铭@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"5854340241","product_id":100028301,"comment_content":"老师，我打开geektime文件夹后，多出了很多不是自己创建的文件夹，都是以_temp结尾的，这些文件夹有什么作用吗？","like_count":1,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"温铭@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452340,"discussion_content":"这些没有什么用的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559552695,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99630,"user_name":"helloworld","can_delete":false,"product_type":"c1","uid":1105161,"ip_address":"","ucode":"1EECCA0F43E278","user_header":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","comment_is_top":false,"comment_ctime":1559270539,"is_pvip":false,"replies":[{"id":"35818","content":"--add-module=..&#47;ngx_lua-0.10.13, --add-module=..&#47;ngx_stream_lua-0.0.5 这两个就是的。","user_name":"作者回复","user_name_real":"温铭@OpenResty","uid":"1017955","ctime":1559282076,"ip_address":"","comment_id":99630,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5854237835","product_id":100028301,"comment_content":"&quot;这里--add-module=后面跟着的，就是 OpenResty 的 C 模块。其中，最核心的就是 lua-nginx-module 和 stream-lua-nginx-module，前者用来处理七层流量，后者用来处理四层流量。&quot;  为什么openresty -V输出的内容并不包含lua-nginx-module 和 stream-lua-nginx-module这俩模块？","like_count":1,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"温铭@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452195,"discussion_content":"--add-module=../ngx_lua-0.10.13, --add-module=../ngx_stream_lua-0.0.5 这两个就是的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559282076,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":349756,"user_name":"刘宇飞","can_delete":false,"product_type":"c1","uid":1437132,"ip_address":"","ucode":"BE47BFCAB1BEEE","user_header":"https://static001.geekbang.org/account/avatar/00/15/ed/cc/cb651edb.jpg","comment_is_top":false,"comment_ctime":1656311725,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1656311725","product_id":100028301,"comment_content":"温大：<br>    lua_package_path &#39;$prefix&#47;conf&#47;lua&#47;?.lua;;&#39; 这个指令与<br>   这种直接指定相对路径 的指令， content_by_lua_file conf&#47;lua&#47;decode_info.lua 有什么区别吗？<br>    lua_package_path &#39;$prefix&#47;conf&#47;lua&#47;?.lua;;&#39;这个指令应该怎么用？什么情况下用？有没有例子","like_count":0},{"had_liked":false,"id":328731,"user_name":"Paradise","can_delete":false,"product_type":"c1","uid":1618275,"ip_address":"","ucode":"9CA103A82F5F38","user_header":"https://static001.geekbang.org/account/avatar/00/18/b1/63/68239c70.jpg","comment_is_top":false,"comment_ctime":1640854576,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1640854576","product_id":100028301,"comment_content":"$ sudo kill -HUP `cat logs&#47;nginx.pid`<br><br>hello 温老师，我为啥这个logs目录下没有这个nginx.pid呢？","like_count":0},{"had_liked":false,"id":273141,"user_name":"Geek_a3849b","can_delete":false,"product_type":"c1","uid":1651086,"ip_address":"","ucode":"43C4BF293FF117","user_header":"","comment_is_top":false,"comment_ctime":1610454784,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1610454784","product_id":100028301,"comment_content":"老师，我用springboot经常用到二级缓存，但是即使用二级缓存由于tomcat的原因qps也并不高，这些用二级缓存的数据实时性要求并不高，我想能不能用openresty直接读取某些接口返回结果缓存在luacache中 在nginx直接返回，或者是否已经有类似的工具","like_count":0,"discussions":[{"author":{"id":1223771,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ac/5b/5b7e9eb2.jpg","nickname":"晚风","note":"","ucode":"7B5E05B7DC6053","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591622,"discussion_content":"肯定可以的，之前就见到这种缓存的方式了。看这个课程就是具体弄明白怎么实现的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666711625,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"福建"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":252120,"user_name":"攻城狮","can_delete":false,"product_type":"c1","uid":1197444,"ip_address":"","ucode":"7D2C2836052C4C","user_header":"https://static001.geekbang.org/account/avatar/00/12/45/84/4b309ba9.jpg","comment_is_top":false,"comment_ctime":1602131389,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602131389","product_id":100028301,"comment_content":"你好，老师，我是用yum install 安装openresty  我要想扩展新模块，怎么做啊","like_count":0},{"had_liked":false,"id":215152,"user_name":"TomShine","can_delete":false,"product_type":"c1","uid":1003894,"ip_address":"","ucode":"81B7B6628BCE31","user_header":"https://static001.geekbang.org/account/avatar/00/0f/51/76/bebe6133.jpg","comment_is_top":false,"comment_ctime":1588916503,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588916503","product_id":100028301,"comment_content":"提供的工具看着挺多，慢慢学习","like_count":0},{"had_liked":false,"id":174558,"user_name":"春来草自青","can_delete":false,"product_type":"c1","uid":1033087,"ip_address":"","ucode":"C5F7EF54B6B9F4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/rkfQQekacJcVEP7icwfF1ibvzolibHgibibPqg9aIich1vd4ffmMj4CJH64BcqJsXcSFB9BVxb9YUH5rb5T78EUOcKJQ/132","comment_is_top":false,"comment_ctime":1580275764,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580275764","product_id":100028301,"comment_content":"示例中的location &#47; { content_by_lua_file lua&#47;hello.lua; }似乎应该是<br>        location &#47; {<br>                default_type text&#47;html;<br>                content_by_lua_file lua&#47;hello.lua;<br>        }","like_count":0},{"had_liked":false,"id":104049,"user_name":"王金全","can_delete":false,"product_type":"c1","uid":1005614,"ip_address":"","ucode":"473D9FC05A66E8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/58/2e/da4058c6.jpg","comment_is_top":false,"comment_ctime":1560601537,"is_pvip":false,"replies":[{"id":"37676","content":"可以看下这个例子：https:&#47;&#47;github.com&#47;iresty&#47;apisix&#47;blob&#47;master&#47;conf&#47;nginx.conf#L22","user_name":"作者回复","user_name_real":"温铭@OpenResty","uid":"1017955","ctime":1560668794,"ip_address":"","comment_id":104049,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560601537","product_id":100028301,"comment_content":"lua_package_path 老师能否给个demo,自己配的不生效","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"温铭@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454102,"discussion_content":"可以看下这个例子：https://github.com/iresty/apisix/blob/master/conf/nginx.conf#L22","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560668794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101154,"user_name":"我是张鹏","can_delete":false,"product_type":"c1","uid":1172960,"ip_address":"","ucode":"8852F3A9959E0A","user_header":"https://static001.geekbang.org/account/avatar/00/11/e5/e0/2cbdb1e4.jpg","comment_is_top":false,"comment_ctime":1559728640,"is_pvip":false,"replies":[{"id":"36601","content":"yum 下需要单独安装：sudo yum install openresty-doc","user_name":"作者回复","user_name_real":"温铭@OpenResty","uid":"1017955","ctime":1559864115,"ip_address":"","comment_id":101154,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1559728640","product_id":100028301,"comment_content":"为什么通过yum安装openresty 后，bin目录下没有restydoc ","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"温铭@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452824,"discussion_content":"yum 下需要单独安装：sudo yum install openresty-doc","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559864115,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":100544,"user_name":"mrmsl","can_delete":false,"product_type":"c1","uid":1113160,"ip_address":"","ucode":"38BBF13C98985C","user_header":"https://static001.geekbang.org/account/avatar/00/10/fc/48/b5a57b72.jpg","comment_is_top":false,"comment_ctime":1559574813,"is_pvip":true,"replies":[{"id":"36553","content":"yep","user_name":"作者回复","user_name_real":"温铭@OpenResty","uid":"1017955","ctime":1559805394,"ip_address":"","comment_id":100544,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1559574813","product_id":100028301,"comment_content":"`restydoc` 太赞了","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"温铭@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452593,"discussion_content":"yep","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559805394,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1646879,"avatar":"","nickname":"玫","note":"","ucode":"A3F70DD9EC47EE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7730,"discussion_content":"restydoc -s ngx.say   后出现了api解释， 然后怎么退出来啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567654730,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1336951,"avatar":"https://static001.geekbang.org/account/avatar/00/14/66/77/194ba21d.jpg","nickname":"lzh","note":"","ucode":"C3D83DF4230109","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1646879,"avatar":"","nickname":"玫","note":"","ucode":"A3F70DD9EC47EE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":402949,"discussion_content":"重启电脑（手动狗头","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633966626,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":7730,"ip_address":""},"score":402949,"extra":""}]}]},{"had_liked":false,"id":100128,"user_name":"我也曾是少年","can_delete":false,"product_type":"c1","uid":1503970,"ip_address":"","ucode":"8E2EA108C24E9F","user_header":"https://static001.geekbang.org/account/avatar/00/16/f2/e2/f48d094a.jpg","comment_is_top":false,"comment_ctime":1559453591,"is_pvip":false,"replies":[{"id":"36151","content":"这方面书不多，建议从官方文档和本专栏入手","user_name":"作者回复","user_name_real":"温铭@OpenResty","uid":"1017955","ctime":1559552094,"ip_address":"","comment_id":100128,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1559453591","product_id":100028301,"comment_content":"老师，我才接触opnrestry,有没有什么书籍，系统的学习下，烦请老师推介下","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"温铭@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452420,"discussion_content":"这方面书不多，建议从官方文档和本专栏入手","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559552094,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99841,"user_name":"旺旺","can_delete":false,"product_type":"c1","uid":1159196,"ip_address":"","ucode":"FE2CF90F446BFB","user_header":"https://static001.geekbang.org/account/avatar/00/11/b0/1c/2e30eeb8.jpg","comment_is_top":false,"comment_ctime":1559319676,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559319676","product_id":100028301,"comment_content":"websocket模块，能对upstream返回的内容进行判断吗？比如返回内容里面包含某个消息提示之类的。<br>因为现在有个需求是代理很多ws后端，如果后端返回的内容有某种业务异常，需要向另一个ws后端继续请求。","like_count":0},{"had_liked":false,"id":99683,"user_name":"亞","can_delete":false,"product_type":"c1","uid":1548143,"ip_address":"","ucode":"2AF0771F869F59","user_header":"https://static001.geekbang.org/account/avatar/00/17/9f/6f/0e341408.jpg","comment_is_top":false,"comment_ctime":1559279106,"is_pvip":false,"replies":[{"id":"35829","content":"比如 tcp、udp 是四层协议，http 是七层协议","user_name":"作者回复","user_name_real":"温铭@OpenResty","uid":"1017955","ctime":1559297463,"ip_address":"","comment_id":99683,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1559279106","product_id":100028301,"comment_content":"老师你好，四层流量和七层流量怎么理解的？","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"温铭@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452220,"discussion_content":"比如 tcp、udp 是四层协议，http 是七层协议","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559297463,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99618,"user_name":"Leon📷","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1559267127,"is_pvip":false,"replies":[{"id":"35797","content":"并非全部。OpenResty 的很多子项目是测试、调试和打包相关的","user_name":"作者回复","user_name_real":"温铭@OpenResty","uid":"1017955","ctime":1559270774,"ip_address":"","comment_id":99618,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1559267127","product_id":100028301,"comment_content":"老师，我用openresty的源代码编译后的目录中多出来的很多文件夹就是文章说的openresty的子项目吗","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"温铭@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452192,"discussion_content":"并非全部。OpenResty 的很多子项目是测试、调试和打包相关的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559270774,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99607,"user_name":"兴才","can_delete":false,"product_type":"c1","uid":1042502,"ip_address":"","ucode":"CB09E0387C5F1A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e8/46/922dc4e7.jpg","comment_is_top":false,"comment_ctime":1559265795,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559265795","product_id":100028301,"comment_content":"老师好，最近项目中用到lua-websocket 测试后发现上传数据过大时会被截断，这个大小限制是可以调整的吗？解决办法是什么","like_count":0}]}