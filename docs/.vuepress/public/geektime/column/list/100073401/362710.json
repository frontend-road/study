{"id":362710,"title":"14 | CPUè§†è§’ï¼šå¦‚ä½•é«˜æ•ˆåœ°åˆ©ç”¨CPUï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å´ç£Šã€‚</p><p>åœ¨æ—¥å¸¸çš„å¼€å‘ä¸è°ƒä¼˜å·¥ä½œä¸­ï¼Œæ€»æœ‰åŒå­¦å‘æˆ‘æŠ±æ€¨ï¼šâ€œä¸ºä»€ä¹ˆæˆ‘çš„åº”ç”¨CPUåˆ©ç”¨ç‡è¿™ä¹ˆä½ï¼ŸåŒå¤§çš„é›†ç¾¤ï¼ŒCPUåˆ©ç”¨ç‡æ‰10%ï¼â€ç¡®å®ï¼Œè¾ƒä½çš„CPUåˆ©ç”¨ç‡ä¸ä»…å¯¹å®è´µçš„ç¡¬ä»¶èµ„æºæ¥è¯´æ˜¯ä¸€ç§éå¸¸å¤§çš„æµªè´¹ï¼Œä¹Ÿä¼šè®©åº”ç”¨ç«¯åˆ°ç«¯çš„æ‰§è¡Œæ€§èƒ½å¾ˆéš¾è¾¾åˆ°ä»¤äººæ»¡æ„çš„æ•ˆæœã€‚é‚£ä¹ˆï¼Œåœ¨åˆ†å¸ƒå¼åº”ç”¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬åˆ°åº•è¯¥å¦‚ä½•é«˜æ•ˆåœ°åˆ©ç”¨CPUï¼Ÿ</p><p>æˆ‘ä»¬è¯´è¿‡ï¼Œæ€§èƒ½è°ƒä¼˜çš„æœ€ç»ˆç›®çš„ï¼Œæ˜¯åœ¨<strong>æ‰€æœ‰å‚ä¸è®¡ç®—çš„ç¡¬ä»¶èµ„æºä¹‹é—´å¯»æ±‚ååŒä¸å¹³è¡¡</strong>ï¼Œè®©ç¡¬ä»¶èµ„æºè¾¾åˆ°ä¸€ç§å¹³è¡¡ã€æ— ç“¶é¢ˆçš„çŠ¶æ€ã€‚å¯¹äºCPUæ¥è¯´ï¼Œæœ€éœ€è¦ååŒå’Œå¹³è¡¡çš„ç¡¬ä»¶èµ„æºéå†…å­˜è«å±ã€‚åŸå› ä¸»è¦æœ‰ä¸¤æ–¹é¢ï¼šä¸€æ–¹é¢ï¼Œåœ¨å¤„ç†å»¶è¿Ÿæ–¹é¢ï¼Œåªæœ‰å†…å­˜èƒ½æœ›å…¶é¡¹èƒŒï¼›å¦ä¸€æ–¹é¢ï¼Œåœ¨ä¸»æ¿ä¸Šå†…å­˜é€šè¿‡æ•°æ®æ€»çº¿ç›´æ¥å‘CPUå¯„å­˜å™¨ä¾›ç»™æ•°æ®ã€‚å› æ­¤ï¼Œç†é¡ºå®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼Œå¯ä»¥ä¸ºæ€§èƒ½è°ƒä¼˜å¥ å®šæ›´å¥½çš„åŸºç¡€ã€‚</p><p>é‚£ä¹ˆï¼Œä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å°±ä»ç¡¬ä»¶èµ„æºå¹³è¡¡çš„è§’åº¦å…¥æ‰‹ï¼Œå»åˆ†æCPUä¸å†…å­˜åˆ°åº•è¯¥å¦‚ä½•åˆä½œã€‚</p><h2>CPUä¸å†…å­˜çš„å¹³è¡¡æœ¬è´¨ä¸Šæ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>æˆ‘ä»¬çŸ¥é“ï¼ŒSparkå°†å†…å­˜åˆ†æˆäº†Execution Memoryå’ŒStorage Memoryä¸¤ç±»ï¼Œåˆ†åˆ«ç”¨äºåˆ†å¸ƒå¼ä»»åŠ¡æ‰§è¡Œå’ŒRDDç¼“å­˜ã€‚å…¶ä¸­ï¼ŒRDDç¼“å­˜è™½ç„¶æœ€ç»ˆå ç”¨çš„æ˜¯Storage Memoryï¼Œä½†åœ¨RDDå±•å¼€ï¼ˆUnrollï¼‰ä¹‹å‰ï¼Œè®¡ç®—ä»»åŠ¡æ¶ˆè€—çš„è¿˜æ˜¯Execution Memoryã€‚<strong>å› æ­¤ï¼ŒSparkä¸­CPUä¸å†…å­˜çš„å¹³è¡¡ï¼Œå…¶å®å°±æ˜¯CPUä¸æ‰§è¡Œå†…å­˜ä¹‹é—´çš„ååŒä¸é…æ¯”ã€‚</strong></p><!-- [[[read_end]]] --><p>è¦æƒ³å¹³è¡¡CPUä¸æ‰§è¡Œå†…å­˜ä¹‹é—´çš„ååŒå’Œé…æ¯”ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨3ç±»é…ç½®å‚æ•°ï¼Œå®ƒä»¬åˆ†åˆ«æ§åˆ¶ç€å¹¶è¡Œåº¦ã€æ‰§è¡Œå†…å­˜å¤§å°å’Œé›†ç¾¤çš„å¹¶è¡Œè®¡ç®—èƒ½åŠ›ã€‚åªæœ‰å®ƒä»¬è®¾ç½®å¾—å½“ï¼ŒCPUå’Œæ‰§è¡Œå†…å­˜æ‰èƒ½åŒæ—¶å¾—åˆ°å……åˆ†åˆ©ç”¨ã€‚å¦åˆ™CPUä¸æ‰§è¡Œå†…å­˜ä¹‹é—´çš„å¹³è¡¡å°±ä¼šè¢«æ‰“ç ´ï¼Œè¦ä¹ˆCPUå·¥ä½œä¸é¥±å’Œï¼Œè¦ä¹ˆOOMå†…å­˜æº¢å‡ºã€‚</p><p>æƒ³è¦çŸ¥é“è¿™3ç±»å‚æ•°éƒ½åŒ…å«å“ªäº›å…·ä½“çš„é…ç½®é¡¹ï¼Œä»¥åŠå®ƒä»¬åˆ°åº•æ˜¯æ€ä¹ˆé…ç½®çš„ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå¼„æ¸…æ¥šä¸€äº›åŸºç¡€çŸ¥è¯†ï¼Œä¹Ÿå°±æ˜¯å¹¶è¡Œè®¡ç®—çš„çº¿ç¨‹ä¹‹é—´æ˜¯å¦‚ä½•ç“œåˆ†æ‰§è¡Œå†…å­˜çš„ã€‚ä¸ºäº†å¸®åŠ©ä½ ç†è§£ï¼Œæˆ‘å…ˆæ¥ç»™ä½ è®²ä¸ªæ•…äº‹ã€‚</p><h2>é»„å°ä¹™çš„å¦‚æ„ç®—ç›˜ï¼šå¹¶è¡Œè®¡ç®—çš„çº¿ç¨‹å¦‚ä½•ç“œåˆ†æ‰§è¡Œå†…å­˜ï¼Ÿ</h2><p>è¿˜è®°å¾—åœ°ä¸»æ‹›ç§Ÿçš„æ•…äº‹å—ï¼Ÿä¸å¼ éº»å­ç­¾è®¢å åœ°åè®®ä¹‹åï¼Œé»„å°ä¹™å°±å¼€å§‹ç›˜ç®—ï¼Œè‡ªå·±åˆ†å¾—çš„é‚£å—ç”°åœ°æ€ä¹ˆç»è¥æ‰æœ€åˆ’ç®—ã€‚</p><p>ä»–å¿ƒæƒ³ï¼šâ€œè¿™ä¹ˆä¸€å¤§å—åœ°ï¼Œæˆ‘äº²è‡ªç§è‚¯å®šåˆ’ä¸æ¥ã€‚ä¸€ï¼Œæˆ‘æ²¡æœ‰å¼ éº»å­å‹¤å¿«ï¼›äºŒï¼Œä¸ç®¡æ˜¯ç§æ£‰èŠ±è¿˜æ˜¯å’–å•¡éƒ½å¾ˆè€—æ—¶ã€è´¹åŠ›ï¼Œé¢æœé»„åœŸèƒŒæœå¤©ï¼Œæˆ‘å¯è€½è¯¯ä¸èµ·é‚£åŠŸå¤«ï¼ä¸å¦‚ï¼Œæˆ‘æŠŠåœŸåœ°è½¬è®©å‡ºå»ï¼Œè®©åˆ«äººæ¥ç§ï¼Œæˆ‘åªç®¡æ”¶è´­ã€é”€å”®ï¼Œèµšåˆ°çš„å·®ä»·ä¹Ÿå¤Ÿæˆ‘åƒç©¿ä¸æ„äº†ï¼â€</p><p>äºæ˜¯ï¼Œä»–æ‰“å®šä¸»æ„ï¼Œè´´å‡ºäº†ä¸€å¼ å‘Šç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d2/11/d27f69b8aca76677700914873fce7911.jpg?wh=2000*1213\" alt=\"\" title=\"é»„å°ä¹™çš„å‘Šç¤º\"></p><p>å‘Šç¤ºè´´å‡ºå»ä¸åˆ°ä¸‰å¤©ï¼Œåé‡Œå…«æ‘çš„äººéƒ½èµ¶æ¥æ‰¿è®©åœŸåœ°ï¼Œä»–ä»¬å¤§éƒ¨åˆ†éƒ½æ˜¯åƒè‹¦è€åŠ³çš„åº„ç¨¼æ±‰ï¼Œä¸€å¿ƒæƒ³å‡­å€Ÿè¿™æ¬¡æœºä¼šæ”¹å–„ç”Ÿæ´»ï¼Œæ‰€ä»¥æ¯ä¸ªäººæ¨ä¸èƒ½æŠŠ500é¡·çš„ç”°åœ°å…¨éƒ½æ‰¿è®©è¿‡æ¥ã€‚</p><p>é»„å°ä¹™è§çŠ¶ï¼Œå¿ƒä¸­å¤§å–œï¼Œè®¤ä¸ºä¸ä»…è‡ªå·±çš„åœŸåœ°å¾ˆå¿«å°±å¯ä»¥è¢«ç§æ»¡ï¼Œè¿˜èƒ½åæ­£è¨€é¡ºåœ°å»æŠ¢å å¼ éº»å­çš„é‚£å—åœ°ã€‚ä¸è¿‡ï¼Œä¹Ÿä¸èƒ½å…‰å›¾è§„æ¨¡ï¼Œè¿˜è¦ç¡®ä¿æ£‰èŠ±ã€å’–å•¡çš„äº§å‡ºè´¨é‡ï¼Œæ›´é‡è¦çš„æ˜¯å¾—æƒ³ä¸ªåŠæ³•è®©è¿™ç§è¿ä½œæ¨¡å¼å¯æŒç»­ã€‚</p><p>äºæ˜¯ï¼Œé»„å°ä¹™è¿½åŠ äº†ä¸€é¡¹è¡¥å……æ¡æ¬¾ï¼šâ€œé‰´äºè€ä¹¡ä»¬å‚ä¸çƒ­æƒ…é«˜æ¶¨ï¼Œå…¬å¹³èµ·è§ï¼Œæˆ‘åˆåˆ¶å®šäº†æ–°çš„åœŸåœ°è½¬è®©è§„åˆ™ï¼š<strong>é¦–å…ˆï¼Œæ¯ä½è€ä¹¡èƒ½å¤Ÿè·å¾—çš„åœŸåœ°é¢ç§¯æœ‰ä¸Šä¸‹é™ï¼Œå®ƒçš„å…·ä½“æ•°å€¼ç”±å¯è€•ç§åœŸåœ°æ€»é¢ç§¯å’Œç”³è¯·äººæ•°å…±åŒå†³å®šï¼›å…¶æ¬¡ï¼ŒåœŸåœ°è½¬è®©æƒçš„æœ‰æ•ˆæ—¶é—´ä¸å†œä½œç‰©ç”Ÿé•¿å‘¨æœŸä¸€è‡´ï¼Œä¸€æ—¦ä½œç‰©ä¸°æ”¶ï¼Œæ‰¿è®©äººéœ€è®©å‡ºåœŸåœ°ï¼Œå¦‚æœ‰æ„æ„¿å†æ¬¡è€•ç§éœ€é‡æ–°ç”³è¯·ã€‚</strong>â€</p><p><img src=\"https://static001.geekbang.org/resource/image/18/54/182c868dc11e99b6dyy4cd5536711b54.jpg?wh=4778*1210\" alt=\"\" title=\"åœŸåœ°è½¬è®©è§„åˆ™\"></p><p>æ¯”å¦‚è¯´ï¼Œç°é˜¶æ®µå¯è€•ç§åœŸåœ°æ€»é¢ç§¯å·²ç”±500é¡·æ‰©å¼ ä¸º800é¡·ï¼ˆè¿™æ˜¯é»„å°ä¹™å°±æŠ¢å äº†å¼ éº»å­çš„åœ°ä¹‹åçš„åœŸåœ°æ€»é¢ç§¯ï¼‰ï¼Œå¦‚æœæœ‰400ä½è€ä¹¡ç”³è¯·åœŸåœ°è½¬è®©æƒï¼Œé‚£ä¹ˆæ¯ä½è€ä¹¡æœ€é«˜å¯å¾—2é¡·ï¼ˆ800/400ï¼‰çš„åœŸåœ°ï¼Œæœ€ä½å¯å¾—1é¡·ï¼ˆ800/400/2ï¼‰åœŸåœ°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè€ä¹¡äººæ•°ä¸ºNï¼Œé‚£ä¹ˆæ¯ä½è€ä¹¡èƒ½å¤Ÿè·å¾—çš„åœŸåœ°é¢ç§¯ä¼šåœ¨ï¼ˆ1/N/2ï¼Œ1/Nï¼‰ä¹‹é—´æµ®åŠ¨ã€‚</p><p>è¿™ä¸ªè§„å®šå¤§ä¼™å„¿éƒ½å¿ƒæœå£æœï¼Œæ²¡è¿‡å¤šä¹…ï¼Œ800é¡·åœŸåœ°å°±å…¨éƒ¨è½¬è®©å®Œäº†ã€‚ä¸€ç¬”å¤šèµ¢çš„ä¹°å–è®©å¤§ä¼™éƒ½èƒ½å„å–æ‰€éœ€ï¼Œä¹Ÿè®©è€è°‹æ·±ç®—çš„é»„å››éƒéƒ½ä¸ç¦å¿ƒæŒ‘å¤§æŒ‡ï¼Œæ„Ÿå¹é“â€œçœŸæ˜¯é•¿æ±Ÿæ°´åæµªå‚¬å‰æµªï¼Œä¸€ä»£æ–°äººæ¢æ—§äººï¼â€</p><p>å¥½å•¦ï¼Œæ•…äº‹åˆ°è¿™é‡Œæš‚æ—¶å‘Šä¸€æ®µè½ï¼Œä½†æ˜¯é»„å°ä¹™è¿™ä»½å¦‚æ„ç®—ç›˜å’Œä»Šå¤©è¦è®²çš„å†…å®¹æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬è®²è¿‡ï¼Œé»„å°ä¹™ç§Ÿèµçš„åœŸåœ°ç±»æ¯”çš„æ˜¯å†…å­˜åŒºåŸŸä¸­çš„Execution Memoryã€‚<strong>åœ¨ä»Šå¤©çš„æ•…äº‹é‡Œï¼Œé»„å°ä¹™æ‹›å‹Ÿçš„æ£‰å†œå’Œå’–å•¡å†œå¯¹åº”çš„å°±æ˜¯ï¼ŒExecutorçº¿ç¨‹æ± ä¸­ä¸€ä¸ªåˆä¸€ä¸ªæ‰§è¡Œåˆ†å¸ƒå¼ä»»åŠ¡çš„çº¿ç¨‹ã€‚åœŸåœ°å‡ºè®©è§„åˆ™å¯¹åº”çš„å°±æ˜¯ï¼Œä»»åŠ¡å¹¶å‘è¿‡ç¨‹ä¸­å¤šä¸ªçº¿ç¨‹æŠ¢å å†…å­˜èµ„æºæ—¶éœ€è¦éµå¾ªçš„åŸºæœ¬é€»è¾‘ã€‚</strong></p><p>é‚£ä¹ˆï¼Œæ‰§è¡Œå†…å­˜æŠ¢å è§„åˆ™å°±æ˜¯ï¼Œåœ¨åŒä¸€ä¸ªExecutorä¸­ï¼Œå½“æœ‰å¤šä¸ªï¼ˆè®°ä¸ºNï¼‰çº¿ç¨‹å°è¯•æŠ¢å æ‰§è¡Œå†…å­˜æ—¶ï¼Œéœ€è¦éµå¾ª2æ¡åŸºæœ¬åŸåˆ™ï¼š</p><ul>\n<li>æ‰§è¡Œå†…å­˜æ€»å¤§å°ï¼ˆè®°ä¸ºMï¼‰ä¸ºä¸¤éƒ¨åˆ†ä¹‹å’Œï¼Œä¸€éƒ¨åˆ†æ˜¯Execution Memoryåˆå§‹å¤§å°ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯Storage Memoryå‰©ä½™ç©ºé—´</li>\n<li>æ¯ä¸ªçº¿ç¨‹åˆ†åˆ°çš„å¯ç”¨å†…å­˜æœ‰ä¸€å®šçš„ä¸Šä¸‹é™ï¼Œä¸‹é™æ˜¯M/N/2ï¼Œä¸Šé™æ˜¯M/Nï¼Œä¹Ÿå°±æ˜¯å‡å€¼</li>\n</ul><h2>ä¸‰è¶³é¼ç«‹ï¼šå¹¶è¡Œåº¦ã€å¹¶å‘åº¦ä¸æ‰§è¡Œå†…å­˜</h2><p>ç†æ¸…äº†çº¿ç¨‹ä¸æ‰§è¡Œå†…å­˜çš„å…³ç³»ä¹‹åï¼Œæˆ‘ä»¬å†æ¥è¯´è¯´ä¸å¹¶å‘åº¦ã€æ‰§è¡Œå†…å­˜å’Œå¹¶è¡Œåº¦è¿™ä¸‰è€…å¯¹åº”çš„3ç±»é…ç½®é¡¹åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Œä»¥åŠå®ƒä»¬å¦‚ä½•å½±å“CPUä¸è®¡ç®—å†…å­˜ä¹‹é—´çš„å¹³è¡¡ã€‚</p><h3>3ç±»é…ç½®é¡¹</h3><p>æˆ‘ä»¬è®²è¿‡ï¼Œå¹¶è¡Œåº¦æŒ‡çš„æ˜¯ä¸ºäº†å®ç°åˆ†å¸ƒå¼è®¡ç®—ï¼Œåˆ†å¸ƒå¼æ•°æ®é›†è¢«åˆ’åˆ†å‡ºæ¥çš„ä»½æ•°ã€‚<strong>å¹¶è¡Œåº¦æ˜ç¡®äº†æ•°æ®åˆ’åˆ†çš„ç²’åº¦ï¼šå¹¶è¡Œåº¦è¶Šé«˜ï¼Œæ•°æ®çš„ç²’åº¦è¶Šç»†ï¼Œæ•°æ®åˆ†ç‰‡è¶Šå¤šï¼Œæ•°æ®è¶Šåˆ†æ•£ã€‚</strong></p><p>å¹¶è¡Œåº¦å¯ä»¥é€šè¿‡ä¸¤ä¸ªå‚æ•°æ¥è®¾ç½®ï¼Œ<strong>åˆ†åˆ«æ˜¯spark.default.parallelismå’Œspark.sql.shuffle.partitions</strong>ã€‚å‰è€…ç”¨äºè®¾ç½®RDDçš„é»˜è®¤å¹¶è¡Œåº¦ï¼Œåè€…åœ¨Spark SQLå¼€å‘æ¡†æ¶ä¸‹ï¼ŒæŒ‡å®šäº†Shuffle Reduceé˜¶æ®µé»˜è®¤çš„å¹¶è¡Œåº¦ã€‚</p><p>é‚£ä»€ä¹ˆæ˜¯å¹¶å‘åº¦å‘¢ï¼Ÿæˆ‘ä»¬åœ¨<a href=\"https://time.geekbang.org/column/article/357342\">é…ç½®é¡¹é‚£ä¸€è®²</a>æåˆ°è¿‡ï¼ŒExecutorçš„çº¿ç¨‹æ± å¤§å°ç”±å‚æ•°spark.executor.coreså†³å®šï¼Œæ¯ä¸ªä»»åŠ¡åœ¨æ‰§è¡ŒæœŸé—´éœ€è¦æ¶ˆè€—çš„çº¿ç¨‹æ•°ç”±spark.task.cpusé…ç½®é¡¹ç»™å®šã€‚ä¸¤è€…ç›¸é™¤å¾—åˆ°çš„å•†å°±æ˜¯å¹¶å‘åº¦ï¼Œä¹Ÿå°±æ˜¯åŒä¸€æ—¶é—´å†…ï¼Œä¸€ä¸ªExecutorå†…éƒ¨å¯ä»¥åŒæ—¶è¿è¡Œçš„æœ€å¤§ä»»åŠ¡æ•°é‡ã€‚åˆå› ä¸ºï¼Œspark.task.cpusé»˜è®¤æ•°å€¼ä¸º1ï¼Œå¹¶ä¸”é€šå¸¸ä¸éœ€è¦è°ƒæ•´ï¼Œæ‰€ä»¥ï¼Œ<strong>å¹¶å‘åº¦åŸºæœ¬ç”±spark.executor.coreså‚æ•°æ•²å®š</strong>ã€‚</p><p>å°±Executorçš„çº¿ç¨‹æ± æ¥è¯´ï¼Œå°½ç®¡çº¿ç¨‹æœ¬èº«å¯ä»¥å¤ç”¨ï¼Œä½†æ¯ä¸ªçº¿ç¨‹åœ¨åŒä¸€æ—¶é—´åªèƒ½è®¡ç®—ä¸€ä¸ªä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡è´Ÿè´£å¤„ç†ä¸€ä¸ªæ•°æ®åˆ†ç‰‡ã€‚å› æ­¤ï¼Œ<strong>åœ¨è¿è¡Œæ—¶ï¼Œçº¿ç¨‹ã€ä»»åŠ¡ä¸åˆ†åŒºæ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»</strong>ã€‚</p><p>åˆ†å¸ƒå¼ä»»åŠ¡ç”±Driveråˆ†å‘åˆ°Executoråï¼ŒExecutorå°†Taskå°è£…ä¸ºTaskRunnerï¼Œç„¶åå°†å…¶äº¤ç»™å¯å›æ”¶ç¼“å­˜çº¿ç¨‹æ± ï¼ˆnewCachedThreadPoolï¼‰ã€‚çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹é¢†å–åˆ°TaskRunnerä¹‹åï¼Œå‘Execution Memoryç”³è¯·å†…å­˜ï¼Œç„¶åå¼€å§‹æ‰§è¡Œä»»åŠ¡ã€‚</p><p>å¦‚æœæˆ‘ä»¬æŠŠæ£‰å†œã€å’–å•¡å†œç±»æ¯”CPUçº¿ç¨‹ï¼Œé‚£ä¹ˆTaskRunnerå°±å¯ä»¥ç†è§£ä¸ºé”„å…·ï¼ŒTaskè¦å¤„ç†çš„æ•°æ®åˆ†ç‰‡å¯ä»¥ç†è§£ä¸ºä½œç‰©ç§å­ã€‚æœ‰äº†é”„å…·å’Œç§å­ä¹‹åï¼Œè€ä¹¡ä»¬å¾—å»é»„å°ä¹™é‚£å„¿ç”³è¯·å—åœ°ï¼Œæ‰èƒ½å¼€å§‹è€•ç§ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬å†æ¥è¯´è¯´æ‰§è¡Œå†…å­˜ã€‚é»„å°ä¹™çš„åœ°å°±æ˜¯æ‰§è¡Œå†…å­˜ï¼Œå †å†…æ‰§è¡Œå†…å­˜çš„åˆå§‹å€¼ç”±å¾ˆå¤šå‚æ•°å…±åŒå†³å®šï¼Œå…·ä½“çš„è®¡ç®—å…¬å¼æ˜¯ï¼šspark.executor.memory * spark.memory.fraction * (1 - spark.memory.storageFraction)ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œå †å¤–æ‰§è¡Œå†…å­˜çš„è®¡ç®—ç¨å¾®ç®€å•ä¸€äº›ï¼šspark.memory.offHeap.size * (1 - spark.memory.storageFraction)ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨ç»Ÿä¸€å†…å­˜ç®¡ç†æ¨¡å¼ä¸‹ï¼Œåœ¨Storage Memoryæ²¡æœ‰è¢«RDDç¼“å­˜å æ»¡çš„æƒ…å†µä¸‹ï¼Œæ‰§è¡Œä»»åŠ¡å¯ä»¥åŠ¨æ€åœ°æŠ¢å Storage Memoryã€‚å› æ­¤ï¼Œåœ¨è®¡ç®—å¯ç”¨äºåˆ†é…ç»™æ‰§è¡Œä»»åŠ¡çš„å†…å­˜æ€»é‡æ—¶ï¼Œè¿˜è¦æŠŠæœ‰å¸Œæœ›æŠ¢å è¿‡æ¥çš„è¿™éƒ¨åˆ†å†…å­˜ç©ºé—´è€ƒè™‘è¿›æ¥ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆé»„å°ä¹™çš„å¯è€•ç§åœŸåœ°æ€»é¢ç§¯ï¼Œä¼šä»æœ€å¼€å§‹çš„500é¡·é€æ¸æ‰©å±•åˆ°800é¡·ã€‚</p><p>ç”±æ­¤å¯è§ï¼Œ<strong>å¯åˆ†é…çš„æ‰§è¡Œå†…å­˜æ€»é‡ä¼šéšç€ç¼“å­˜ä»»åŠ¡å’Œæ‰§è¡Œä»»åŠ¡çš„æ­¤æ¶ˆå½¼é•¿ï¼Œè€ŒåŠ¨æ€å˜åŒ–ã€‚ä½†æ— è®ºæ€ä¹ˆå˜ï¼Œå¯ç”¨çš„æ‰§è¡Œå†…å­˜æ€»é‡ï¼Œéƒ½ä¸ä¼šä½äºé…ç½®é¡¹è®¾å®šçš„åˆå§‹å€¼</strong>ã€‚</p><p>å¥½å•¦ï¼Œææ˜ç™½å¹¶è¡Œåº¦ã€å¹¶å‘åº¦å’Œæ‰§è¡Œå†…å­˜çš„æ¦‚å¿µï¼Œä»¥åŠå„è‡ªçš„é…ç½®é¡¹ä¹‹åï¼Œæˆ‘ä»¬å†é€šè¿‡ä¸¤ä¸ªç»å¸¸å½±å“CPUåˆ©ç”¨ç‡çš„ä¾‹å­ï¼Œæ¥è¯´è¯´å®ƒä»¬æ˜¯æ€ä¹ˆå½±å“CPUä¸è®¡ç®—å†…å­˜ä¹‹é—´çš„å¹³è¡¡çš„ï¼Œç”±æ­¤æ€»ç»“å‡ºæå‡CPUåˆ©ç”¨ç‡çš„åŠæ³•ã€‚</p><h3>CPUä½æ•ˆåŸå› ä¹‹ä¸€ï¼šçº¿ç¨‹æŒ‚èµ·</h3><p>åœ¨ç»™å®šæ‰§è¡Œå†…å­˜æ€»é‡Må’Œçº¿ç¨‹æ€»æ•°Nçš„æƒ…å†µä¸‹ï¼Œä¸ºäº†ä¿è¯æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰æœºä¼šæ‹¿åˆ°é€‚é‡çš„å†…å­˜å»å¤„ç†æ•°æ®ï¼ŒSparkç”¨HashMapæ•°æ®ç»“æ„ï¼Œä»¥ï¼ˆKeyï¼ŒValueï¼‰çš„æ–¹å¼æ¥è®°å½•æ¯ä¸ªçº¿ç¨‹æ¶ˆè€—çš„å†…å­˜å¤§å°ï¼Œå¹¶ç¡®ä¿æ‰€æœ‰çš„Valueå€¼éƒ½ä¸è¶…è¿‡M/Nã€‚åœ¨ä¸€äº›æç«¯æƒ…å†µä¸‹ï¼Œæœ‰äº›çº¿ç¨‹ç”³è¯·ä¸åˆ°æ‰€éœ€çš„å†…å­˜ç©ºé—´ï¼Œèƒ½æ‹¿åˆ°çš„å†…å­˜åˆè®¡è¿˜ä¸åˆ°M/N/2ã€‚è¿™ä¸ªæ—¶å€™ï¼ŒSparkå°±ä¼šæŠŠçº¿ç¨‹æŒ‚èµ·ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹é‡Šæ”¾äº†è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ä¸ºæ­¢ã€‚</p><p>ä½ å¯èƒ½ä¼šé—®ï¼šâ€œæ—¢ç„¶æ¯ä¸ªçº¿ç¨‹èƒ½æ‹¿åˆ°çš„å†…å­˜ä¸Šé™æ˜¯M/Nï¼Œä¹Ÿå°±æ˜¯å†…å­˜æ€»é‡å¯¹çº¿ç¨‹æ•°å–å¹³å‡å€¼ï¼Œä¸ºä»€ä¹ˆè¿˜ä¼šå‡ºç°æœ‰çš„çº¿ç¨‹è¿M/N/2éƒ½æ‹¿ä¸åˆ°å‘¢ï¼Ÿè¿™åœ¨æ•°å­¦ä¸Šä¹Ÿä¸æˆç«‹å‘€ï¼â€è¿™æ˜¯ä¸ªå¥½é—®é¢˜ã€‚è¿™ç§æƒ…å†µçš„å‡ºç°ï¼Œæºäº3æ–¹é¢çš„å˜åŒ–å’Œä½œç”¨ï¼š</p><ul>\n<li><strong>åŠ¨æ€å˜åŒ–çš„æ‰§è¡Œå†…å­˜æ€»é‡M</strong></li>\n<li><strong>åŠ¨æ€å˜åŒ–çš„å¹¶å‘åº¦N~</strong></li>\n<li><strong>åˆ†å¸ƒå¼æ•°æ®é›†çš„æ•°æ®åˆ†å¸ƒ</strong></li>\n</ul><p>é¦–å…ˆï¼ŒåŠ¨æ€å˜åŒ–çš„æ‰§è¡Œå†…å­˜æ€»é‡Mæˆ‘ä»¬åˆšåˆšå·²ç»è¯´è¿‡äº†ã€‚Mçš„ä¸‹é™æ˜¯Execution Memoryåˆå§‹å€¼ï¼Œä¸Šé™æ˜¯spark.executor.memory * spark.memory.fractionåˆ’å®šçš„æ‰€æœ‰å†…å­˜åŒºåŸŸã€‚åœ¨åº”ç”¨åˆšåˆšå¼€å§‹æ‰§è¡Œçš„æ—¶å€™ï¼ŒMçš„å–å€¼å°±æ˜¯è¿™ä¸ªä¸Šé™ï¼Œä½†éšç€RDDç¼“å­˜é€æ¸å¡«å……Storage Memoryï¼ŒMçš„å–å€¼ä¹Ÿä¼šè·Ÿç€å›æ’¤ã€‚</p><p>å¦å¤–ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œï¼ˆ1/N/2ï¼Œ1/Nï¼‰ä¸Šä¸‹é™çš„è®¡ç®—æˆ‘ä»¬ç”¨çš„éƒ½æ˜¯çº¿ç¨‹æ€»æ•°Nï¼Œçº¿ç¨‹æ€»æ•°Næ˜¯å›ºå®šçš„ã€‚Nçš„å–å€¼å«ä¹‰æ˜¯ä¸€ä¸ªExecutorå†…æœ€å¤§çš„å¹¶å‘åº¦ï¼Œæ›´ä¸¥æ ¼çš„è®¡ç®—å…¬å¼æ˜¯spark.executor.coresé™¤ä»¥spark.task.cpusã€‚ä½†å®é™…ä¸Šï¼Œä¸Šä¸‹é™å…¬å¼çš„è®¡ç®—ç”¨çš„ä¸æ˜¯Nï¼Œè€Œæ˜¯N~ã€‚N~çš„å«ä¹‰æ˜¯Executorå†…å½“å‰çš„å¹¶å‘åº¦ï¼Œä¹Ÿå°±æ˜¯Executorä¸­å½“å‰å¹¶è¡Œæ‰§è¡Œçš„ä»»åŠ¡æ•°ã€‚æ˜¾ç„¶N~ &lt;= Nã€‚</p><p>æ¢å¥è¯è¯´ï¼Œå°½ç®¡ä¸€ä¸ªExecutorä¸­æœ‰Nä¸ªCPUçº¿ç¨‹ï¼Œä½†è¿™Nä¸ªçº¿ç¨‹ä¸ä¸€å®šéƒ½åœ¨å¹²æ´»ã€‚åœ¨Sparkä»»åŠ¡è°ƒåº¦çš„è¿‡ç¨‹ä¸­ï¼Œè¿™Nä¸ªçº¿ç¨‹ä¸è§å¾—èƒ½åŒæ—¶æ‹¿åˆ°åˆ†å¸ƒå¼ä»»åŠ¡ï¼Œæ‰€ä»¥å…ˆæ‹¿åˆ°ä»»åŠ¡çš„çº¿ç¨‹å°±æœ‰æœºä¼šç”³è¯·åˆ°æ›´å¤šçš„å†…å­˜ã€‚åœ¨æŸäº›æç«¯çš„æƒ…å†µä¸‹ï¼Œåæ‹¿åˆ°ä»»åŠ¡çš„çº¿ç¨‹ç”šè‡³è¿ä¸€å¯¸å†…å­˜éƒ½ç”³è¯·ä¸åˆ°ã€‚ä¸è¿‡ï¼Œéšç€ä»»åŠ¡æ‰§è¡Œå’Œä»»åŠ¡è°ƒåº¦çš„æ¨è¿›ï¼ŒN~ä¼šè¿…é€Ÿåœ°è¶‹è¿‘äºNï¼ŒCPUçº¿ç¨‹æŒ‚èµ·å’Œå†…å­˜åˆ†é…çš„æƒ…å†µä¹Ÿä¼šé€æ¸å¾—åˆ°æ”¹å–„ã€‚</p><p>å°±åƒé»„å°ä¹™çš„è¡¥å……æ¡æ¬¾ä¸­ä¸¾çš„é‚£ä¸ªä¾‹å­ä¸€æ ·ï¼Œå½“å¯è€•ç§åœŸåœ°æ€»é¢ç§¯ä¸º800é¡·çš„æ—¶å€™ï¼Œå¦‚æœæœ‰400ä½è€ä¹¡ç”³è¯·åœŸåœ°è½¬è®©æƒï¼Œé‚£ä¹ˆæ¯ä½è€ä¹¡æœ€å¤šå¯å¾—800/400=2é¡·åœŸåœ°ï¼Œæœ€ä½å¯å¾—800/400/2=1é¡·åœŸåœ°ã€‚</p><p>ä½†å¦‚æœè¿™400ä½è€ä¹¡ä¸æ˜¯åŒæ—¶æ¥çš„ï¼Œè€Œæ˜¯åˆ†ä¸¤æ‰¹æ¥çš„ï¼Œæ¯æ‰¹æ¥200äººçš„è¯ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚æŒ‰ç…§ä»–çš„è§„åˆ™ï¼Œå…ˆæ¥çš„è¿™200ä½è€ä¹¡ï¼Œæ¯äººæœ€å¤šå¯å¾—800/200 = 4é¡·åœŸåœ°ã€‚å’±ä»¬å‰é¢è¯´äº†ï¼Œæ¯ä¸ªç”³è¯·çš„è€ä¹¡éƒ½æƒ³é€šè¿‡è¿™æ¬¡æœºä¼šå‘ç‚¹å°è´¢ï¼Œäºæ˜¯è¿™200ä½è€ä¹¡æ¯äººéƒ½ç”³è¯·äº†4é¡·åœ°ï¼Œé»„å°ä¹™çš„åœ°ä¸€ä¸‹å­å°±è¢«åˆ†å…‰äº†ï¼åæ¥çš„200ä½è€ä¹¡å°±æ²¡åœ°å¯ç§äº†ï¼Œä»–ä»¬åªèƒ½ç­‰åˆ°ç¬¬ä¸€æ‰¹è€ä¹¡çš„æ£‰èŠ±å’Œå’–å•¡ä¸°æ”¶äº†ï¼Œå†é‡æ–°ä¸€èµ·ç”³è¯·åœŸåœ°è½¬è®©æƒã€‚</p><p>å‡è®¾ç¬¬ä¸€æ‰¹è€ä¹¡åŒæ—¶å¤§ä¸°æ”¶ï¼ŒæŒ‰ç…§é»„å°ä¹™è½¬è®©è§„åˆ™çš„ç¬¬ä¸€æ¡ï¼Œç¬¬ä¸€æ‰¹è€ä¹¡è¦äº¤å‡ºåœŸåœ°ä½¿ç”¨æƒï¼Œå¦‚æœæƒ³è¦ç»§ç»­è€•ç§çš„è¯ï¼Œå°±å¾—å’Œç¬¬äºŒæ‰¹è€ä¹¡ä¸€èµ·é‡æ–°ç”³è¯·ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸Šä¸‹é™çš„è®¡ç®—æ‰æ˜¯é»„å°ä¹™æœ€å¼€å§‹ä¸¾ä¾‹çš„é‚£ç§ç®—æ³•ã€‚</p><p>ç¬¬ä¸‰ä¸ªå½±å“ä»»åŠ¡å¹¶å‘åº¦å’Œå†…å­˜åˆ†é…çš„å› ç´ ï¼Œæ˜¯åˆ†å¸ƒå¼æ•°æ®é›†çš„åˆ†å¸ƒæƒ…å†µã€‚åœ¨åˆšæ‰çš„ä¾‹å­ä¸­ï¼Œå¦‚æœç¬¬ä¸€æ‰¹è€ä¹¡æ¯äººåªç”³è¯·2é¡·åœŸåœ°ï¼Œé‚£ä¹ˆç¬¬äºŒæ‰¹è€ä¹¡æ¥äº†ä¹‹åä¾ç„¶æœ‰åœ°å¯ç§ã€‚æ¯äººç”³è¯·å¤šå¤§çš„åœŸåœ°ï¼Œå–å†³äºä»–æ‰‹é‡Œæœ‰å¤šå°‘å†œä½œç‰©ç§å­ï¼Œæˆ‘ä»¬ä¹‹å‰æŠŠæ¯ä¸ªTaskéœ€è¦å¤„ç†çš„æ•°æ®åˆ†ç‰‡æ¯”ä½œæ˜¯ä½œç‰©ç§å­ï¼Œé‚£ä¹ˆï¼Œæ•°æ®åˆ†ç‰‡çš„æ•°æ®é‡å†³å®šäº†æ‰§è¡Œä»»åŠ¡éœ€è¦ç”³è¯·å¤šå°‘å†…å­˜ã€‚<strong>å¦‚æœåˆ†å¸ƒå¼æ•°æ®é›†çš„å¹¶è¡Œåº¦è®¾ç½®å¾—å½“ï¼Œå› ä»»åŠ¡è°ƒåº¦æ»åè€Œå¯¼è‡´çš„çº¿ç¨‹æŒ‚èµ·é—®é¢˜å°±ä¼šå¾—åˆ°ç¼“è§£</strong>ã€‚</p><h3>CPUä½æ•ˆåŸå› ä¹‹äºŒï¼šè°ƒåº¦å¼€é”€</h3><p>çº¿ç¨‹æŒ‚èµ·çš„é—®é¢˜å¾—åˆ°ç¼“è§£ï¼ŒCPUåˆ©ç”¨ç‡å°±ä¼šæœ‰æ‰€æ”¹å–„ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œæ˜¯ä¸æ˜¯æŠŠå¹¶è¡Œåº¦è®¾ç½®åˆ°æœ€å¤§ï¼Œæ¯ä¸ªæ•°æ®åˆ†ç‰‡å°±éƒ½èƒ½è¶³å¤Ÿå°ï¼Œå°åˆ°æ¯ä¸ªCPUçº¿ç¨‹éƒ½èƒ½ç”³è¯·åˆ°å†…å­˜ï¼Œçº¿ç¨‹ä¸å†æŒ‚èµ·å°±ä¸‡äº‹å¤§å‰äº†å‘¢ï¼Ÿ</p><p>å½“ç„¶ä¸æ˜¯ï¼Œå¹¶è¡Œåº¦è¶³å¤Ÿå¤§ï¼Œç¡®å®ä¼šè®©æ•°æ®åˆ†ç‰‡æ›´åˆ†æ•£ã€æ•°æ®ç²’åº¦æ›´ç»†ï¼Œå› æ­¤ï¼Œæ¯ä¸ªæ‰§è¡Œä»»åŠ¡æ‰€éœ€æ¶ˆè€—çš„å†…å­˜æ›´å°‘ã€‚<strong>ä½†æ˜¯ï¼Œæ•°æ®è¿‡äºåˆ†æ•£ä¼šå¸¦æ¥ä¸¥é‡çš„å‰¯ä½œç”¨ï¼šè°ƒåº¦å¼€é”€éª¤å¢ã€‚</strong></p><p>å¯¹äºæ¯ä¸€ä¸ªåˆ†å¸ƒå¼ä»»åŠ¡ï¼ŒDirverä¼šå°†å…¶å°è£…ä¸ºTaskDescriptionï¼Œç„¶ååˆ†å‘ç»™å„ä¸ªExecutorã€‚TaskDescriptionåŒ…å«ç€ä¸ä»»åŠ¡è¿è¡Œæœ‰å…³çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå¦‚ä»»åŠ¡IDã€å°è¯•IDã€è¦å¤„ç†çš„æ•°æ®åˆ†ç‰‡IDã€å¼€å‘è€…æ·»åŠ çš„æœ¬åœ°æ–‡ä»¶å’ŒJaråŒ…ã€ä»»åŠ¡å±æ€§ã€åºåˆ—åŒ–çš„ä»»åŠ¡ä»£ç ç­‰ç­‰ã€‚Executoræ¥æ”¶åˆ°TaskDescriptionä¹‹åï¼Œé¦–å…ˆéœ€è¦å¯¹TaskDescriptionååºåˆ—åŒ–æ‰èƒ½è¯»å–ä»»åŠ¡ä¿¡æ¯ï¼Œç„¶åå°†ä»»åŠ¡ä»£ç å†ååºåˆ—åŒ–å¾—åˆ°å¯æ‰§è¡Œä»£ç ï¼Œæœ€åå†ç»“åˆå…¶ä»–ä»»åŠ¡ä¿¡æ¯åˆ›å»ºTaskRunnerã€‚</p><p>å› æ­¤ä½ çœ‹ï¼Œæ¯ä¸ªä»»åŠ¡çš„è°ƒåº¦ä¸æ‰§è¡Œéƒ½éœ€è¦Executoræ¶ˆè€—CPUå»æ‰§è¡Œä¸Šè¿°ä¸€ç³»åˆ—çš„æ“ä½œæ­¥éª¤ã€‚æ•°æ®åˆ†ç‰‡ä¸çº¿ç¨‹ã€æ‰§è¡Œä»»åŠ¡ä¸€ä¸€å¯¹åº”ï¼Œ<strong>å½“æ•°æ®è¿‡äºåˆ†æ•£ï¼Œåˆ†å¸ƒå¼ä»»åŠ¡æ•°é‡ä¼šå¤§å¹…å¢åŠ ï¼Œä½†æ¯ä¸ªä»»åŠ¡éœ€è¦å¤„ç†çš„æ•°æ®é‡å´å°‘ä¹‹åˆå°‘ï¼Œå°±CPUæ¶ˆè€—æ¥è¯´ï¼Œç›¸æ¯”èŠ±åœ¨æ•°æ®å¤„ç†ä¸Šçš„æ¯”ä¾‹ï¼Œä»»åŠ¡è°ƒåº¦ä¸Šçš„å¼€é”€å‡ ä¹ä¸ä¹‹åˆ†åº­æŠ—ç¤¼</strong>ã€‚æ˜¾ç„¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒCPUçš„æœ‰æ•ˆåˆ©ç”¨ç‡ä¹Ÿæ˜¯æä½çš„ã€‚</p><h3>å¦‚ä½•ä¼˜åŒ–CPUåˆ©ç”¨ç‡ï¼Ÿ</h3><p>ä½ å¯èƒ½ä¼šè¯´ï¼šâ€œè¿™ä¹Ÿå¤ªå°´å°¬äº†ï¼Œå¹¶è¡Œåº¦ä½äº†ä¸è¡Œï¼Œå®¹æ˜“è®©CPUçº¿ç¨‹æŒ‚èµ·ï¼›é«˜äº†ä¹Ÿä¸è¡Œï¼Œè°ƒåº¦å¼€é”€å¤ªå¤§ï¼ŒCPUæœ‰æ•ˆåˆ©ç”¨ç‡ä¹Ÿä¸é«˜ã€‚é«˜ä¹Ÿä¸è¡Œã€ä½ä¹Ÿä¸è¡Œï¼Œé‚£æˆ‘è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿâ€</p><p>å’±ä»¬ä¸å¦¨æ¥ç®—ç¬”è´¦ã€‚æˆ‘ä»¬è¿˜æ˜¯æ‹¿é»„å°ä¹™çš„å¦‚æ„ç®—ç›˜æ¥ä¸¾ä¾‹ï¼Œå¦‚æœ400ä¸ªè€ä¹¡åŒæ—¶æ¥ç”³è¯·ä»–çš„800é¡·åœ°ï¼Œé‚£ä¹ˆæ¯ä¸ªè€ä¹¡èƒ½åˆ†åˆ°1åˆ°2é¡·åœŸåœ°ä¸ç­‰ã€‚ç›¸åº”åœ°ï¼Œæ¯ä½è€ä¹¡éœ€è¦è´­ä¹°çš„ç§å­åº”è¯¥åˆšå¥½å¤Ÿç§æ»¡1åˆ°2é¡·åœ°ã€‚å› ä¸ºï¼Œä¹°å¤šäº†ç§ä¸ä¸‹ï¼Œä¹°å°‘äº†è¿˜äºã€‚å‡è®¾æ´¼å­æ‘å†œäº§å“äº¤æ˜“å¸‚åœºçš„ç§å­æ€»é‡åˆšå¥½å¤Ÿç§1000é¡·åœ°ï¼Œä»å–å®¶çš„è§†è§’å‡ºå‘ï¼Œè¿™äº›ç§å­åº”è¯¥å”®å–1000/2 =500åˆ°1000/1 = 1000æ¬¡ï¼Œæ‰èƒ½èµšåˆ°æœ€å¤šçš„é’±ã€‚</p><p>å› æ­¤ï¼Œåœ¨ç»™å®šExecutorçº¿ç¨‹æ± å’Œæ‰§è¡Œå†…å­˜å¤§å°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å‚è€ƒä¸Šé¢çš„ç®—æ³•ï¼Œ<strong>å»è®¡ç®—ä¸€ä¸ªèƒ½å¤Ÿè®©æ•°æ®åˆ†ç‰‡å¹³å‡å¤§å°åœ¨ï¼ˆM/N/2, M/Nï¼‰ä¹‹é—´çš„å¹¶è¡Œåº¦ï¼Œè¿™å¾€å¾€æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©</strong>ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œå¯¹CPUåˆ©ç”¨ç‡æ¥è¯´ï¼Œå¹¶è¡Œåº¦ã€å¹¶å‘åº¦ä¸æ‰§è¡Œå†…å­˜çš„å…³ç³»å°±å¥½åƒæ˜¯ä¸€å°Šç››æ»¡æ²¸æ°´çš„ä¸‰è¶³é¼ï¼Œä¸‰è¶³é½å¹³åˆ™ä¸‡äº‹å¤§å‰ï¼Œä½†å‡¡å“ªä¸€æ–¹ç˜¸è…¿å„¿ï¼Œé¼å†…çš„æ²¸æ°´å°±ä¼šå€¾å‡ºä¼¤åŠæ— è¾œã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/4a/ce/4a5dc54813346924ec5611f6d1fa8fce.jpg?wh=4101*1043\" alt=\"\" title=\"ä¸‰è¶³é¼ç«‹\"></p><h2>å°ç»“</h2><p>ä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»CPUä¸æ‰§è¡Œå†…å­˜å¹³è¡¡çš„è§’åº¦ï¼Œé€šè¿‡æ¢³ç†Executorå¹¶è¡Œåº¦ã€å¹¶å‘åº¦å’Œæ‰§è¡Œå†…å­˜ä¹‹é—´çš„å…³ç³»ï¼Œä»¥åŠå®ƒä»¬å¯¹CPUåˆ©ç”¨ç‡çš„å½±å“ï¼Œæ€»ç»“å‡ºäº†æœ‰æ•ˆæå‡CPUåˆ©ç”¨ç‡çš„æ–¹æ³•ã€‚</p><p>é¦–å…ˆï¼Œåœ¨ä¸€ä¸ªExecutorä¸­ï¼Œæ¯ä¸ªCPUçº¿ç¨‹èƒ½å¤Ÿç”³è¯·åˆ°çš„å†…å­˜æ¯”ä¾‹æ˜¯æœ‰ä¸Šä¸‹é™çš„ï¼Œæœ€é«˜ä¸è¶…è¿‡1/Nï¼Œæœ€ä½ä¸å°‘äº1/N/2ï¼Œå…¶ä¸­Nä»£è¡¨çº¿ç¨‹æ± å¤§å°ã€‚</p><p>å…¶æ¬¡ï¼Œåœ¨ç»™å®šçº¿ç¨‹æ± å¤§å°å’Œæ‰§è¡Œå†…å­˜çš„æ—¶å€™ï¼Œå¹¶è¡Œåº¦è¾ƒä½ã€æ•°æ®åˆ†ç‰‡è¾ƒå¤§å®¹æ˜“å¯¼è‡´CPUçº¿ç¨‹æŒ‚èµ·ï¼Œçº¿ç¨‹é¢‘ç¹æŒ‚èµ·ä¸åˆ©äºæå‡CPUåˆ©ç”¨ç‡ï¼Œè€Œå¹¶è¡Œåº¦è¿‡é«˜ã€æ•°æ®è¿‡äºåˆ†æ•£ä¼šè®©è°ƒåº¦å¼€é”€æ›´æ˜¾è‘—ï¼Œä¹Ÿä¸åˆ©äºæå‡CPUåˆ©ç”¨ç‡ã€‚</p><p>æœ€åï¼Œåœ¨ç»™å®šæ‰§è¡Œå†…å­˜Mã€çº¿ç¨‹æ± å¤§å°Nå’Œæ•°æ®æ€»é‡Dçš„æ—¶å€™ï¼Œæƒ³è¦æœ‰æ•ˆåœ°æå‡CPUåˆ©ç”¨ç‡ï¼Œæˆ‘ä»¬å°±è¦è®¡ç®—å‡ºæœ€ä½³å¹¶è¡Œåº¦Pï¼Œè®¡ç®—æ–¹æ³•æ˜¯è®©æ•°æ®åˆ†ç‰‡çš„å¹³å‡å¤§å°D/Påè½åœ¨ï¼ˆM/N/2, M/Nï¼‰åŒºé—´ã€‚è¿™æ ·ï¼Œåœ¨è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬çš„CPUåˆ©ç”¨ç‡å¾€å¾€ä¸ä¼šå¤ªå·®ã€‚</p><h2>æ¯æ—¥ä¸€ç»ƒ</h2><ol>\n<li>ä»Executorå¹¶å‘åº¦ã€æ‰§è¡Œå†…å­˜å¤§å°å’Œåˆ†å¸ƒå¼ä»»åŠ¡å¹¶è¡Œåº¦å‡ºå‘ï¼Œä½ è®¤ä¸ºåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç°OOMçš„é—®é¢˜ï¼Ÿ</li>\n<li>ç”±äºæ‰§è¡Œå†…å­˜æ€»é‡Mæ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œå¹¶å‘ä»»åŠ¡æ•°N~ä¹Ÿæ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œå› æ­¤æ¯ä¸ªçº¿ç¨‹ç”³è¯·å†…å­˜çš„ä¸Šä¸‹é™ä¹Ÿæ˜¯åŠ¨æ€è°ƒæ•´çš„ï¼Œä½ çŸ¥é“è¿™ä¸ªè°ƒæ•´å‘¨æœŸä»¥ä»€ä¹ˆä¸ºå‡†ï¼Ÿ</li>\n</ol><p>æœŸå¾…åœ¨ç•™è¨€åŒºçœ‹åˆ°ä½ çš„æ€è€ƒå’Œç­”æ¡ˆï¼Œå¦‚æœä½ çš„æœ‹å‹ä¹Ÿåœ¨ä¸ºæé«˜CPUåˆ©ç”¨ç‡è‹¦æ¼ï¼Œæ¬¢è¿ä½ æŠŠè¿™ä¸€è®²è½¬å‘ç»™ä»–ï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²è§ï¼</p>","comments":[{"had_liked":false,"id":288582,"user_name":"Geek_d794f8","can_delete":false,"product_type":"c1","uid":2485585,"ip_address":"","ucode":"1E20DA4FF8B800","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIiaeebUYxl7e4jicPshDRKMbiculHUjKgZZ2ygDibn2S7bbsjeqYIdsEUdVyoryKNa43ZGnDQmWjv3ibQ/132","comment_is_top":false,"comment_ctime":1618551187,"is_pvip":false,"replies":[{"id":"104749","content":"éƒ½éœ€è¦è€ƒè™‘ï¼Œç»“åˆä½ è¿™ä¸ªä¾‹å­ï¼Œæ•´ä½“é€»è¾‘æ˜¯è¿™æ ·çš„ã€‚<br><br>é¦–å…ˆï¼ŒSparkè¯»å–åˆ†å¸ƒå¼æ–‡ä»¶ï¼Œè·å–æ•°æ®æºï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¹¶è¡Œåº¦å°±æ˜¯æ–‡ä»¶åœ¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿä¸Šçš„å¹¶è¡Œåº¦ï¼Œæ¯”å¦‚HDFSã€æ¯”å¦‚S3ã€‚HDFSçš„åˆ†ç‰‡å¯èƒ½æ˜¯128Mæˆ–æ˜¯256Mï¼Œé‚£ä¹ˆå®ƒçš„å¹¶è¡Œåº¦ï¼Œå°±å–å†³äºæ–‡ä»¶æ€»å¤§å°å’Œåˆ†ç‰‡å¤§å°çš„å•†ã€‚<br><br>è¿™ä¸ªæ—¶å€™ï¼Œç”±äºåˆ†ç‰‡å¤§å°æ˜¯å›ºå®šçš„ï¼Œä½ å¯ä»¥ç»“åˆåˆ†ç‰‡å¤§å°ï¼Œå»è®¾ç½®æ‰§è¡Œå†…å­˜å’Œå¹¶å‘åº¦ï¼ˆexecutorçº¿ç¨‹æ± ï¼‰ï¼Œè®©ä»–ä»¬æ»¡è¶³ï¼ˆ1&#47;N&#47;2ï¼Œ1&#47;Nï¼‰çš„å…³ç³»ã€‚<br><br>ç„¶åï¼Œä½ è®¾ç½®çš„spark.sql.shuffle.partitionsï¼Œä¼šæ§åˆ¶Joinsä¹‹ä¸­çš„Shuffle Reduceé˜¶æ®µå¹¶è¡Œåº¦ï¼Œè¿™ä¸ªå‚æ•°è®¾ç½®å¤šå°‘ã€‚å…¶å®å–å†³äºä½ Shuffleè¿‡åæ¯ä¸ªReduce Taskéœ€è¦å¤„ç†çš„æ•°æ®åˆ†ç‰‡å¤§å°ã€‚ç”±äºä½ ä¹‹å‰æ˜¯æŒ‰ç…§128Mæˆ–æ˜¯256Mæ¥è®¾ç½®çš„æ‰§è¡Œå†…å­˜ï¼Œ å’Œå¹¶å‘åº¦ã€‚è¿™ä¸ªæ—¶å€™ï¼Œåœ¨è®¾ç½®spark.sql.shuffle.partitionsè¿™ä¸ªå€¼çš„æ—¶å€™ï¼Œåªè¦ä¿è¯æ•°æ®åˆ†ç‰‡å¤§å°è¿˜æ˜¯åœ¨128Mæˆ–æ˜¯256Må·¦å³ï¼ˆshuffleå‰å¯èƒ½æœ‰è¿‡æ»¤ã€è¿‡ç¨‹ä¸­è¿˜ä¼šæœ‰èšåˆï¼Œæ‰€ä»¥åŸæ¥çš„å¹¶è¡Œåº¦å°±ä¸åˆé€‚äº†ï¼‰ï¼Œå°±ä¾ç„¶èƒ½ç»´æŒâ€œä¸‰è¶³é¼ç«‹â€çš„è®¡ç®—å¹³è¡¡ã€‚<br><br>æ‰€ä»¥è¯´ï¼Œæ ¸å¿ƒæ˜¯ç»´æŒè¿™ä¸ªå¹³è¡¡ã€‚åœ¨ä½ è¿™ä¸ªcaseï¼Œæ ¸å¿ƒæ€è·¯æ˜¯ï¼Œæ ¹æ®â€œå®šä¸‹æ¥çš„â€ï¼Œå»è°ƒæ•´â€œæœªå®šä¸‹æ¥çš„â€ï¼Œå°±å¯ä»¥å»è®¾ç½®æ¯ä¸€ä¸ªå‚æ•°äº†ã€‚<br><br>åœ¨æœ€å¼€å§‹ï¼Œâ€œå®šä¸‹æ¥çš„â€æ˜¯å¹¶è¡Œåº¦ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯æ–‡ä»¶ç³»ç»Ÿå†³å®šçš„ï¼Œä½†æ˜¯æ‰§è¡Œå†…å­˜å’Œå¹¶å‘åº¦æœªå®šï¼Œæ‰€ä»¥ä½ å¯ä»¥ç›¸åº”åœ°å»è°ƒæ•´è¿™ä¸¤ç±»å‚æ•°ã€‚<br><br>åé¢Shuffleçš„æ—¶å€™ï¼Œæ‰§è¡Œå†…å­˜å’Œå¹¶å‘åº¦å·²ç»å®šä¸‹æ¥äº†ï¼Œä½†æ˜¯spark.sql.shuffle.partitionsæœªå®šï¼Œä½ å†ç»“åˆé‚£ä¸ªå…¬å¼ï¼Œå»å®šè¿™ä¸ªå‚æ•°çš„å€¼å°±å¥½äº†ã€‚æ€è·¯å°±æ˜¯è¿™ä¹ˆä¸ªæ€è·¯ï¼Œå…¶å®è¿˜æ˜¯ä¸‡å˜ä¸ç¦»å…¶å®—ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1618566432,"ip_address":"","comment_id":288582,"utype":1}],"discussion_count":6,"race_medal":0,"score":"96107831699","product_id":100073401,"comment_content":"è€å¸ˆï¼Œåœ¨è€ƒè™‘å¹¶è¡Œåº¦,å†…å­˜,çº¿ç¨‹æ•°ä¸‰è€…ä¹‹é—´çš„å¹³è¡¡æ—¶ï¼Œspark.sql.shuffle.partitionsçš„å€¼æ˜¯shuffleçš„reduceré˜¶æ®µçš„å¹¶è¡Œåº¦ï¼Œé‚£ä¹ˆå¯¹äºä»æ•°æ®æºè¯»å–(æ¯”å¦‚è¯»hiveè¡¨)è¿™ä¸ªèµ·å§‹çš„mapé˜¶æ®µçš„å¹¶è¡Œåº¦æ˜¯å¦éœ€è¦è€ƒè™‘ï¼Ÿè¿™ä¸ªé˜¶æ®µsparkåº•å±‚æœ‰æŸç§é»˜è®¤çš„åˆ‡ç‰‡è§„åˆ™å—ï¼Œéœ€è¦åœ¨ä»£ç ä¸­äººä¸ºçš„å¹²é¢„å—(æ¯”å¦‚coalesce)ï¼Ÿ æˆ‘ä½¿ç”¨çš„æ˜¯DataFrameå’ŒDataSetçš„apiã€‚","like_count":23,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518671,"discussion_content":"éƒ½éœ€è¦è€ƒè™‘ï¼Œç»“åˆä½ è¿™ä¸ªä¾‹å­ï¼Œæ•´ä½“é€»è¾‘æ˜¯è¿™æ ·çš„ã€‚\n\né¦–å…ˆï¼ŒSparkè¯»å–åˆ†å¸ƒå¼æ–‡ä»¶ï¼Œè·å–æ•°æ®æºï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¹¶è¡Œåº¦å°±æ˜¯æ–‡ä»¶åœ¨åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿä¸Šçš„å¹¶è¡Œåº¦ï¼Œæ¯”å¦‚HDFSã€æ¯”å¦‚S3ã€‚HDFSçš„åˆ†ç‰‡å¯èƒ½æ˜¯128Mæˆ–æ˜¯256Mï¼Œé‚£ä¹ˆå®ƒçš„å¹¶è¡Œåº¦ï¼Œå°±å–å†³äºæ–‡ä»¶æ€»å¤§å°å’Œåˆ†ç‰‡å¤§å°çš„å•†ã€‚\n\nè¿™ä¸ªæ—¶å€™ï¼Œç”±äºåˆ†ç‰‡å¤§å°æ˜¯å›ºå®šçš„ï¼Œä½ å¯ä»¥ç»“åˆåˆ†ç‰‡å¤§å°ï¼Œå»è®¾ç½®æ‰§è¡Œå†…å­˜å’Œå¹¶å‘åº¦ï¼ˆexecutorçº¿ç¨‹æ± ï¼‰ï¼Œè®©ä»–ä»¬æ»¡è¶³ï¼ˆ1/N/2ï¼Œ1/Nï¼‰çš„å…³ç³»ã€‚\n\nç„¶åï¼Œä½ è®¾ç½®çš„spark.sql.shuffle.partitionsï¼Œä¼šæ§åˆ¶Joinsä¹‹ä¸­çš„Shuffle Reduceé˜¶æ®µå¹¶è¡Œåº¦ï¼Œè¿™ä¸ªå‚æ•°è®¾ç½®å¤šå°‘ã€‚å…¶å®å–å†³äºä½ Shuffleè¿‡åæ¯ä¸ªReduce Taskéœ€è¦å¤„ç†çš„æ•°æ®åˆ†ç‰‡å¤§å°ã€‚ç”±äºä½ ä¹‹å‰æ˜¯æŒ‰ç…§128Mæˆ–æ˜¯256Mæ¥è®¾ç½®çš„æ‰§è¡Œå†…å­˜ï¼Œ å’Œå¹¶å‘åº¦ã€‚è¿™ä¸ªæ—¶å€™ï¼Œåœ¨è®¾ç½®spark.sql.shuffle.partitionsè¿™ä¸ªå€¼çš„æ—¶å€™ï¼Œåªè¦ä¿è¯æ•°æ®åˆ†ç‰‡å¤§å°è¿˜æ˜¯åœ¨128Mæˆ–æ˜¯256Må·¦å³ï¼ˆshuffleå‰å¯èƒ½æœ‰è¿‡æ»¤ã€è¿‡ç¨‹ä¸­è¿˜ä¼šæœ‰èšåˆï¼Œæ‰€ä»¥åŸæ¥çš„å¹¶è¡Œåº¦å°±ä¸åˆé€‚äº†ï¼‰ï¼Œå°±ä¾ç„¶èƒ½ç»´æŒâ€œä¸‰è¶³é¼ç«‹â€çš„è®¡ç®—å¹³è¡¡ã€‚\n\næ‰€ä»¥è¯´ï¼Œæ ¸å¿ƒæ˜¯ç»´æŒè¿™ä¸ªå¹³è¡¡ã€‚åœ¨ä½ è¿™ä¸ªcaseï¼Œæ ¸å¿ƒæ€è·¯æ˜¯ï¼Œæ ¹æ®â€œå®šä¸‹æ¥çš„â€ï¼Œå»è°ƒæ•´â€œæœªå®šä¸‹æ¥çš„â€ï¼Œå°±å¯ä»¥å»è®¾ç½®æ¯ä¸€ä¸ªå‚æ•°äº†ã€‚\n\nåœ¨æœ€å¼€å§‹ï¼Œâ€œå®šä¸‹æ¥çš„â€æ˜¯å¹¶è¡Œåº¦ï¼Œå› ä¸ºè¿™ä¸ªæ˜¯æ–‡ä»¶ç³»ç»Ÿå†³å®šçš„ï¼Œä½†æ˜¯æ‰§è¡Œå†…å­˜å’Œå¹¶å‘åº¦æœªå®šï¼Œæ‰€ä»¥ä½ å¯ä»¥ç›¸åº”åœ°å»è°ƒæ•´è¿™ä¸¤ç±»å‚æ•°ã€‚\n\nåé¢Shuffleçš„æ—¶å€™ï¼Œæ‰§è¡Œå†…å­˜å’Œå¹¶å‘åº¦å·²ç»å®šä¸‹æ¥äº†ï¼Œä½†æ˜¯spark.sql.shuffle.partitionsæœªå®šï¼Œä½ å†ç»“åˆé‚£ä¸ªå…¬å¼ï¼Œå»å®šè¿™ä¸ªå‚æ•°çš„å€¼å°±å¥½äº†ã€‚æ€è·¯å°±æ˜¯è¿™ä¹ˆä¸ªæ€è·¯ï¼Œå…¶å®è¿˜æ˜¯ä¸‡å˜ä¸ç¦»å…¶å®—ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618566432,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1199213,"avatar":"https://static001.geekbang.org/account/avatar/00/12/4c/6d/c20f2d5a.jpg","nickname":"LJK","note":"","ucode":"12B2441099FF1D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391918,"discussion_content":"ShufflePartitionsçš„é…ç½®æ˜¯é™æ€çš„ï¼Œè¿è¡Œè¿‡ç¨‹ä¸­æ•°æ®é‡æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œè¿™ç§æƒ…å†µä¸‹å¦‚ä½•èƒ½è®¾ç½®ä¸€ä¸ªå¥½çš„ShufflePartitionså‘¢ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1630705339,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1813026,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJO944A1HeBCrewW7YHE1Ha3OVWDEz8iaXwD23iczWrG9eG6deJ0dK5qD1qJuLB0u7LnU4ujtokvjAg/132","nickname":"keeprun","note":"","ucode":"0D1FBBB98567D0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":412736,"discussion_content":"è¯»å–æ–‡ä»¶çš„åˆ†åŒºæ•°è¿˜ä¸æ–‡ä»¶ä¸ªæ•°ç›¸å…³ï¼Œåˆ‡å‰²æ–‡ä»¶æ—¶ä¸ä¼šè·¨æ–‡ä»¶ã€‚å»ºè®®çœ‹ä¸‹textFileå¯¹åº”çš„æºç :getSplitã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636274402,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1789481,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/4e/29/adcb78e7.jpg","nickname":"é™å¿ƒ","note":"","ucode":"B80DE4B5C923D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":403480,"discussion_content":"hdfsåˆ†ç‰‡æ”¾ç½®åœ¨å†…å­˜ï¼Œä¼šè†¨èƒ€ï¼è¿™æ€ä¹ˆæ¥è°ƒå‚æ•°å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634088801,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2828185,"avatar":"","nickname":"Geek_73cee2","note":"","ucode":"54848FF6BE74B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1789481,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/4e/29/adcb78e7.jpg","nickname":"é™å¿ƒ","note":"","ucode":"B80DE4B5C923D3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575590,"discussion_content":"ä½ ç›´æ¥çœ‹è†¨èƒ€ä¹‹åçš„å¤§å°ä¸å°±è¡Œäº†  ä¸»è¦è¿˜æ˜¯å› ä¸ºä½ å­˜å‚¨çš„æ—¶å€™æ•°æ®å‹ç¼©æˆ–è€…æ ¼å¼é—®é¢˜ åŠ è½½åˆ°å†…å­˜å°±ä¸ä¸€æ ·äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654942669,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":403480,"ip_address":""},"score":575590,"extra":""}]},{"author":{"id":1549032,"avatar":"","nickname":"Zzz","note":"","ucode":"9323254354868B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394504,"discussion_content":"æœ‰ç‚¹è¿‡äºç†è®ºåŒ–ï¼Œå®é™…çœŸçš„æ˜¯è¿™æ ·è°ƒæ•´è¿‡ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631926421,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288772,"user_name":"zxk","can_delete":false,"product_type":"c1","uid":1221195,"ip_address":"","ucode":"4BB2BD9D2BCD04","user_header":"https://static001.geekbang.org/account/avatar/00/12/a2/4b/b72f724f.jpg","comment_is_top":false,"comment_ctime":1618664736,"is_pvip":false,"replies":[{"id":"104856","content":"æ²¡é—®é¢˜ï¼Œæ»¡åˆ†ğŸ’¯ ~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1618760635,"ip_address":"","comment_id":288772,"utype":1}],"discussion_count":3,"race_medal":0,"score":"57453239584","product_id":100073401,"comment_content":"é—®é¢˜ä¸€ï¼šå¹¶å‘åº¦å†³å®šäº†æ•°æ®åˆ†ç‰‡çš„å¤§å°ï¼š<br>- åœ¨æ¯ä¸ªçº¿ç¨‹éƒ½åˆ†é…åˆ°äº†æœ€å¤§å†…å­˜ï¼Œå³ M&#47;N çš„å†…å­˜æ—¶ï¼Œå¦‚æœ task è¿˜éœ€è¦æ›´å¤šçš„å†…å­˜ï¼Œé‚£ä¹ˆå°±ä¼šå‘ç”Ÿ OOMã€‚<br>- åœ¨æ¯ä¸ªçº¿ç¨‹éƒ½åˆ†é…åˆ°äº†æœ€å°‘å†…å­˜ï¼Œå³ M&#47;2Nçš„å†…å­˜æ—¶ï¼Œå¦‚æœ task è¿˜éœ€è¦æ›´å¤šçš„å†…å­˜ï¼Œæ­¤æ—¶åˆæ²¡æœ‰å…¶ä»–çº¿ç¨‹é‡Šæ”¾å†…å­˜ä¾›å…¶ä½¿ç”¨ï¼Œé‚£ä¹ˆä¹Ÿä¼šå¯¼è‡´OOMã€‚","like_count":14,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518733,"discussion_content":"æ²¡é—®é¢˜ï¼Œæ»¡åˆ†ğŸ’¯ ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618760635,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1233398,"avatar":"https://static001.geekbang.org/account/avatar/00/12/d1/f6/d75afb79.jpg","nickname":"åœ¨è·¯ä¸Š","note":"","ucode":"F4CEB45076F9B8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535504,"discussion_content":"å¹¶å‘åº¦å†³å®šæ•°æ®åˆ†ç‰‡å¤§å°æ²¡çœ‹æ‡‚ï¼Œä¸æ˜¯å¹¶è¡Œåº¦å†³å®šæ•°æ®åˆ†ç‰‡å¤§å°ä¹ˆ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1638455574,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2955154,"avatar":"https://static001.geekbang.org/account/avatar/00/2d/17/92/0af520ef.jpg","nickname":"åæœˆ","note":"","ucode":"95877CD3753595","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1233398,"avatar":"https://static001.geekbang.org/account/avatar/00/12/d1/f6/d75afb79.jpg","nickname":"åœ¨è·¯ä¸Š","note":"","ucode":"F4CEB45076F9B8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":570803,"discussion_content":"å› ä¸ºå¹¶å‘åº¦å†³å®šæ¯ä¸ªçº¿ç¨‹æœ€å¤šå¯ä½¿ç”¨çš„å†…å­˜å¤§å°ï¼Œä»è€Œå½±å“æ¯ä¸ªåˆ†ç‰‡å¯ä½¿ç”¨çš„å†…å­˜å¤§å°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651914541,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":535504,"ip_address":""},"score":570803,"extra":""}]}]},{"had_liked":false,"id":288299,"user_name":"qconljk","can_delete":false,"product_type":"c1","uid":1005711,"ip_address":"","ucode":"E382B3C9041BB6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIibtTdDicknUHXgxmEAs8ib88kGhcjOzeHo5GBs6RfFHjGypRicKYcMPFZ5dm5edlpqALoibPK90icuwwQ/132","comment_is_top":false,"comment_ctime":1618399583,"is_pvip":false,"replies":[{"id":"104700","content":"å¥½é—®é¢˜ï¼Œå…¶å®æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„å«ä¹‰ï¼Œå°±æ˜¯ä¸€ç§å…¬å¹³æœºåˆ¶ï¼Œå°±æ˜¯ä¿è¯è‡³å°‘æœ‰å‡å€¼çš„1&#47;2å¯ä»¥æ»¡è¶³ï¼Œå¦åˆ™å°±ä¸è¿›è¡Œè®¡ç®—ã€‚<br><br>å…¶å®ä½ è¯´æŠŠå®ƒæ”¹æˆ3æˆä¸æˆï¼Œæˆ‘è§‰å¾—ä¹Ÿæ²¡ä»€ä¹ˆä¸å¯ä»¥ã€‚ä½†æ˜¯ï¼Œæ”¹æˆ3ä¹‹åï¼Œtaskæœ€ä½å†…å­˜ä¿éšœæ›´ä½äº†ï¼Œå³ä¾¿ä½ æœ‰1&#47;3ç»™å®ƒï¼Œå®ƒä¹Ÿå®Œä¸æˆè®¡ç®—ï¼Œå…¶å®è¿˜æ˜¯å¾—æŒ‚èµ·ã€‚<br><br>1&#47;2çš„ä¿åº•ï¼Œå…¶å®æ›´make senseï¼Œå› ä¸º1&#47;2çš„å†…å­˜ç›¸æ¯”å‡å€¼æ¥è¯´ï¼Œåªå·®äº†ä¸€åŠï¼Œè¿™æ ·æœ‰äº›ä»»åŠ¡ä½ å…ˆåˆ†é…äº†1&#47;2ï¼Œè¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå…¶ä»–taskè¿˜ä¼šé‡Šæ”¾å†…å­˜ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œè¿™ä¸ªtaskè¿˜æ˜¯å¯ä»¥æˆåŠŸæ‰§è¡Œçš„ã€‚ä½†å¦‚æœæ˜¯1&#47;3ï¼Œä½ äºç©ºçš„å†…å­˜æ›´å¤šï¼Œéœ€è¦ç­‰å¾…çš„æ¦‚ç‡è¶Šå¤§ï¼ŒæŒ‚èµ·çš„æ¦‚ç‡ä¹Ÿå°±è¶Šå¤§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1618487218,"ip_address":"","comment_id":288299,"utype":1}],"discussion_count":4,"race_medal":0,"score":"35978137951","product_id":100073401,"comment_content":"é¦–å…ˆï¼Œåœ¨ä¸€ä¸ª Executor ä¸­ï¼Œæ¯ä¸ª CPU çº¿ç¨‹èƒ½å¤Ÿç”³è¯·åˆ°çš„å†…å­˜æ¯”ä¾‹æ˜¯æœ‰ä¸Šä¸‹é™çš„ï¼Œæœ€é«˜ä¸è¶…è¿‡ 1&#47;Nï¼Œæœ€ä½ä¸å°‘äº 1&#47;N&#47;2ï¼Œå…¶ä¸­ N ä»£è¡¨çº¿ç¨‹æ± å¤§å°ã€‚è¿™ä¸ªé™¤ä»¥2ï¼Œ2ä»£è¡¨ä»€ä¹ˆï¼Ÿ","like_count":8,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518579,"discussion_content":"å¥½é—®é¢˜ï¼Œå…¶å®æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„å«ä¹‰ï¼Œå°±æ˜¯ä¸€ç§å…¬å¹³æœºåˆ¶ï¼Œå°±æ˜¯ä¿è¯è‡³å°‘æœ‰å‡å€¼çš„1/2å¯ä»¥æ»¡è¶³ï¼Œå¦åˆ™å°±ä¸è¿›è¡Œè®¡ç®—ã€‚\n\nå…¶å®ä½ è¯´æŠŠå®ƒæ”¹æˆ3æˆä¸æˆï¼Œæˆ‘è§‰å¾—ä¹Ÿæ²¡ä»€ä¹ˆä¸å¯ä»¥ã€‚ä½†æ˜¯ï¼Œæ”¹æˆ3ä¹‹åï¼Œtaskæœ€ä½å†…å­˜ä¿éšœæ›´ä½äº†ï¼Œå³ä¾¿ä½ æœ‰1/3ç»™å®ƒï¼Œå®ƒä¹Ÿå®Œä¸æˆè®¡ç®—ï¼Œå…¶å®è¿˜æ˜¯å¾—æŒ‚èµ·ã€‚\n\n1/2çš„ä¿åº•ï¼Œå…¶å®æ›´make senseï¼Œå› ä¸º1/2çš„å†…å­˜ç›¸æ¯”å‡å€¼æ¥è¯´ï¼Œåªå·®äº†ä¸€åŠï¼Œè¿™æ ·æœ‰äº›ä»»åŠ¡ä½ å…ˆåˆ†é…äº†1/2ï¼Œè¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå…¶ä»–taskè¿˜ä¼šé‡Šæ”¾å†…å­˜ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œè¿™ä¸ªtaskè¿˜æ˜¯å¯ä»¥æˆåŠŸæ‰§è¡Œçš„ã€‚ä½†å¦‚æœæ˜¯1/3ï¼Œä½ äºç©ºçš„å†…å­˜æ›´å¤šï¼Œéœ€è¦ç­‰å¾…çš„æ¦‚ç‡è¶Šå¤§ï¼ŒæŒ‚èµ·çš„æ¦‚ç‡ä¹Ÿå°±è¶Šå¤§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618487218,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367861,"discussion_content":"ç€æ€¥æ‰“å­—ï¼Œæ²¡è¯´å®Œï¼Œå†è€…ï¼Œå¦‚æœæ˜¯1/3ï¼ŒOOMçš„å‡ ç‡ä¹Ÿæ›´å¤§ã€‚å› ä¸ºç›¸å½“äºå¯¹äºä»»åŠ¡è¯·æ±‚æ¥è¯´ï¼Œä½ æ˜¯å®½è¿›ä¸¥å‡ºï¼Œå°±æ˜¯åªè¦æœ‰1/3ï¼Œä½ å°±æ¥å—taskè¯·æ±‚ï¼Œç»“æœäººå®¶éœ€è¦çš„å†…å­˜ç©ºé—´ï¼Œä½ æ ¹æœ¬æ»¡è¶³ä¸äº†ï¼Œtaskè·‘åˆ°ä¸€åŠï¼Œéœ€è¦æ›´å¤šå†…å­˜ï¼Œä½†æ˜¯å…¶ä»–taskåˆæ²¡æœ‰é‡Šæ”¾é¢å¤–çš„å†…å­˜ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œè¦ä¹ˆæŒ‚èµ·ã€è¦ä¹ˆOOMã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618487391,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1789481,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/4e/29/adcb78e7.jpg","nickname":"é™å¿ƒ","note":"","ucode":"B80DE4B5C923D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":404612,"discussion_content":"è€å¸ˆï¼Œæ‚¨è¯´çš„è¿™ç§æƒ…å†µï¼Œåˆ°åº•æ˜¯æŒ‚èµ·è¿˜æ˜¯ä¼šoomé˜¿ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634357364,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":367861,"ip_address":""},"score":404612,"extra":""}]},{"author":{"id":1271157,"avatar":"https://static001.geekbang.org/account/avatar/00/13/65/75/f9d7e8b7.jpg","nickname":"L3nvy","note":"","ucode":"0B74B27C121D56","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367732,"discussion_content":"ç–‘é—®åŠ ä¸€ï¼ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618452536,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288188,"user_name":"æ–¯ç›–ä¸¸","can_delete":false,"product_type":"c1","uid":1168504,"ip_address":"","ucode":"B881D14B028F14","user_header":"https://static001.geekbang.org/account/avatar/00/11/d4/78/66b3f2a2.jpg","comment_is_top":false,"comment_ctime":1618355050,"is_pvip":false,"replies":[{"id":"104645","content":"Spark UIæœ‰ä¸“é—¨çš„é…ç½®é¡µï¼Œè®°å½•äº†ä¸åŒé…ç½®é¡¹çš„è®¾ç½®å€¼ï¼Œå…¶ä¸­æœ‰é»˜è®¤å¹¶è¡Œåº¦è®¾ç½®ã€‚<br><br>ä½†é‡ç‚¹ä¸åœ¨è¿™ï¼Œé‡ç‚¹æ˜¯åè°ƒã€å¹³è¡¡â€œä¸‰è¶³é¼ç«‹â€ï¼Œä¹Ÿå°±æ˜¯å¹¶è¡Œåº¦ã€å¹¶å‘åº¦ã€æ‰§è¡Œå†…å­˜ï¼Œå»æå‡CPUåˆ©ç”¨ç‡ï¼Œæ‰€ä»¥ä½ æ›´éœ€è¦ä½¿ç”¨ç³»ç»Ÿå·¥å…·ã€ç›‘æ§å·¥å…·ï¼Œæ¯”å¦‚gangliaã€Prometheusã€Grafanaã€nmonã€htopç­‰ç­‰ï¼Œè¿™äº›å·¥å…·ï¼Œå»è§‚å¯Ÿä½ çš„CPUåˆ©ç”¨ç‡ï¼Œç„¶åå›è¿‡å¤´æ¥ï¼Œå¹³è¡¡ä¸‰è€…ï¼Œç„¶åå†å»è§‚å¯ŸCPUåˆ©ç”¨ç‡æ˜¯ä¸æ˜¯æå‡äº†ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ¥å»è°ƒä¼˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1618394759,"ip_address":"","comment_id":288188,"utype":1}],"discussion_count":1,"race_medal":0,"score":"31683126122","product_id":100073401,"comment_content":"è¿™è®²çœ‹å¾—æœ‰äº›è¿·ï¼Œæƒ³è¯·é—®ä¸‹è€å¸ˆå¦‚ä½•ä»UIè§’åº¦çœ‹å‡ºæ¥æˆ‘ä»»åŠ¡çš„å¹¶è¡Œåº¦æ˜¯å¦åˆé€‚å‘¢ï¼Ÿ","like_count":7,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518541,"discussion_content":"Spark UIæœ‰ä¸“é—¨çš„é…ç½®é¡µï¼Œè®°å½•äº†ä¸åŒé…ç½®é¡¹çš„è®¾ç½®å€¼ï¼Œå…¶ä¸­æœ‰é»˜è®¤å¹¶è¡Œåº¦è®¾ç½®ã€‚\n\nä½†é‡ç‚¹ä¸åœ¨è¿™ï¼Œé‡ç‚¹æ˜¯åè°ƒã€å¹³è¡¡â€œä¸‰è¶³é¼ç«‹â€ï¼Œä¹Ÿå°±æ˜¯å¹¶è¡Œåº¦ã€å¹¶å‘åº¦ã€æ‰§è¡Œå†…å­˜ï¼Œå»æå‡CPUåˆ©ç”¨ç‡ï¼Œæ‰€ä»¥ä½ æ›´éœ€è¦ä½¿ç”¨ç³»ç»Ÿå·¥å…·ã€ç›‘æ§å·¥å…·ï¼Œæ¯”å¦‚gangliaã€Prometheusã€Grafanaã€nmonã€htopç­‰ç­‰ï¼Œè¿™äº›å·¥å…·ï¼Œå»è§‚å¯Ÿä½ çš„CPUåˆ©ç”¨ç‡ï¼Œç„¶åå›è¿‡å¤´æ¥ï¼Œå¹³è¡¡ä¸‰è€…ï¼Œç„¶åå†å»è§‚å¯ŸCPUåˆ©ç”¨ç‡æ˜¯ä¸æ˜¯æå‡äº†ï¼Œé€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ¥å»è°ƒä¼˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618394759,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":305240,"user_name":"wow_xiaodi","can_delete":false,"product_type":"c1","uid":1511712,"ip_address":"","ucode":"B3FB301556A7EA","user_header":"https://static001.geekbang.org/account/avatar/00/17/11/20/9f31c4f4.jpg","comment_is_top":false,"comment_ctime":1627889894,"is_pvip":false,"replies":[{"id":"110541","content":"å¥½é—®é¢˜~ æ˜¯è¿™æ ·ï¼Œè¿™ä¸ªå…¬å¼çš„ç›®çš„ï¼Œä¸»è¦æ˜¯è®©æ¯ä¸ªTaskèƒ½å¤Ÿæ‹¿åˆ°å¹¶å¤„ç†é€‚é‡çš„æ•°æ®ï¼Œä¸è‡³äºå› ä¸ºæ•°æ®åˆ†å¸ƒæœ¬èº«ï¼Œè€Œå¸¦æ¥OOMã€‚<br><br>D&#47;P ~ ï¼ˆM&#47;N&#47;2, M&#47;Nï¼‰ï¼Œä¹Ÿå°±æ˜¯æ•°æ®åˆ†ç‰‡å¤§å°ï¼Œè®©ä»–ä¸M&#47;Nåœ¨åŒä¸€ä¸ªå½“é‡ã€‚è¿™æ ·åŸºæœ¬èƒ½å¤Ÿä¿è¯æ¯ä¸ªTaskå¤„ç†çš„æ•°æ®æ˜¯é€‚é‡çš„ã€‚<br><br>æ€ä¹ˆç†è§£é€‚é‡å‘¢ï¼Œå°±æ˜¯åœ¨æ¶ˆè€—ä¸€å®šå†…å­˜ï¼ˆå¦‚AppendOnlyMapï¼‰çš„åŸºç¡€ä¸Šï¼Œæœ‰å°‘é‡çš„æº¢å‡ºã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒD&#47;Pæ˜¯åŸå§‹æ•°æ®çš„å°ºå¯¸ï¼ŒçœŸæ­£åˆ°å†…å­˜é‡Œå»ï¼Œæ˜¯ä¼šç¿»å€çš„ï¼Œè‡³äºç¿»å¤šå°‘å€ï¼Œè¿™ä¸ªå’Œæ–‡ä»¶æ ¼å¼æœ‰å…³ç³»ã€‚ä¸è¿‡ï¼Œä¸ç®¡ä»–ç¿»å¤šå°‘å€ï¼Œåªè¦åŸå§‹çš„D&#47;På’ŒM&#47;Nåœ¨ä¸€ä¸ªå½“é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¤§æ¦‚ç‡å°±èƒ½é¿å¼€OOMçš„é—®é¢˜ï¼Œä¸è‡³äºæŸäº›Taskséœ€è¦å¤„ç†çš„æ•°æ®åˆ†ç‰‡è¿‡å¤§è€ŒOOMã€‚<br><br>æ•´ä½“ä¸Šæ˜¯è¿™ä¹ˆä¸ªé€»è¾‘ï¼Œä¸ç¡®å®šæˆ‘è¯´æ¸…æ¥šäº†æ²¡ï¼Œæœ‰é—®é¢˜å†è®¨è®ºå“ˆ~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1628060003,"ip_address":"","comment_id":305240,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27397693670","product_id":100073401,"comment_content":"æœ€ä½³å¹¶è¡Œåº¦ Pï¼Œè®¡ç®—æ–¹æ³•æ˜¯è®©æ•°æ®åˆ†ç‰‡çš„å¹³å‡å¤§å° D&#47;P åè½åœ¨ï¼ˆM&#47;N&#47;2, M&#47;Nï¼‰åŒºé—´<br>è¿™é‡Œå¾ˆä¸è§£ä¸ºä½•å†…å­˜çš„å¤§å°å’Œåˆ†ç‰‡å¤§å°æœ‰ç›´æ¥è”ç³»ï¼Œæ— è®ºæ˜¯è®¡ç®—è¿‡ç¨‹è¿˜æ˜¯shuffleè¿‡ç¨‹ï¼Œéƒ½æ˜¯ç”¨åˆ°ä¸€äº›å†…å­˜å ç”¨è¾ƒå°çš„æ•°æ®ç»“æ„å»åšçš„ï¼Œå°±ç®—å†…å­˜ä¸å¤Ÿç”¨ï¼Œä¹Ÿä¼šæœ‰gcå»ä¿è¯ã€‚è¿™ä¸ªå…¬å¼æ„Ÿè§‰å°±æ˜¯è®©æ•°æ®åˆ†ç‰‡å¤§å°å’Œæ‰§è¡Œå†…å­˜ç­‰ä»·äº†ï¼Œè®©æ‰€æœ‰æ•°æ®éƒ½åœ¨å¾…åœ¨å†…å­˜ä¸­ä¸€æ¬¡æ€§æ‰¹å¤„ç†ï¼Œè€Œä¸æ˜¯å¤„ç†ä¸€éƒ¨åˆ†æº¢å‡ºè½ç›˜å†ç»§ç»­å¤„ç†ï¼Ÿè¯·è€å¸ˆæŒ‡æ­£","like_count":6,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524330,"discussion_content":"å¥½é—®é¢˜~ æ˜¯è¿™æ ·ï¼Œè¿™ä¸ªå…¬å¼çš„ç›®çš„ï¼Œä¸»è¦æ˜¯è®©æ¯ä¸ªTaskèƒ½å¤Ÿæ‹¿åˆ°å¹¶å¤„ç†é€‚é‡çš„æ•°æ®ï¼Œä¸è‡³äºå› ä¸ºæ•°æ®åˆ†å¸ƒæœ¬èº«ï¼Œè€Œå¸¦æ¥OOMã€‚\n\nD/P ~ ï¼ˆM/N/2, M/Nï¼‰ï¼Œä¹Ÿå°±æ˜¯æ•°æ®åˆ†ç‰‡å¤§å°ï¼Œè®©ä»–ä¸M/Nåœ¨åŒä¸€ä¸ªå½“é‡ã€‚è¿™æ ·åŸºæœ¬èƒ½å¤Ÿä¿è¯æ¯ä¸ªTaskå¤„ç†çš„æ•°æ®æ˜¯é€‚é‡çš„ã€‚\n\næ€ä¹ˆç†è§£é€‚é‡å‘¢ï¼Œå°±æ˜¯åœ¨æ¶ˆè€—ä¸€å®šå†…å­˜ï¼ˆå¦‚AppendOnlyMapï¼‰çš„åŸºç¡€ä¸Šï¼Œæœ‰å°‘é‡çš„æº¢å‡ºã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒD/Pæ˜¯åŸå§‹æ•°æ®çš„å°ºå¯¸ï¼ŒçœŸæ­£åˆ°å†…å­˜é‡Œå»ï¼Œæ˜¯ä¼šç¿»å€çš„ï¼Œè‡³äºç¿»å¤šå°‘å€ï¼Œè¿™ä¸ªå’Œæ–‡ä»¶æ ¼å¼æœ‰å…³ç³»ã€‚ä¸è¿‡ï¼Œä¸ç®¡ä»–ç¿»å¤šå°‘å€ï¼Œåªè¦åŸå§‹çš„D/På’ŒM/Nåœ¨ä¸€ä¸ªå½“é‡ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¤§æ¦‚ç‡å°±èƒ½é¿å¼€OOMçš„é—®é¢˜ï¼Œä¸è‡³äºæŸäº›Taskséœ€è¦å¤„ç†çš„æ•°æ®åˆ†ç‰‡è¿‡å¤§è€ŒOOMã€‚\n\næ•´ä½“ä¸Šæ˜¯è¿™ä¹ˆä¸ªé€»è¾‘ï¼Œä¸ç¡®å®šæˆ‘è¯´æ¸…æ¥šäº†æ²¡ï¼Œæœ‰é—®é¢˜å†è®¨è®ºå“ˆ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628060003,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288580,"user_name":"Geek_d794f8","can_delete":false,"product_type":"c1","uid":2485585,"ip_address":"","ucode":"1E20DA4FF8B800","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIiaeebUYxl7e4jicPshDRKMbiculHUjKgZZ2ygDibn2S7bbsjeqYIdsEUdVyoryKNa43ZGnDQmWjv3ibQ/132","comment_is_top":false,"comment_ctime":1618550437,"is_pvip":false,"replies":[{"id":"104750","content":"å¯¹ï¼Œæ²¡é”™~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1618566505,"ip_address":"","comment_id":288580,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18798419621","product_id":100073401,"comment_content":"æˆ‘çš„ç†è§£æ˜¯æ¯ä¸ªçº¿ç¨‹ç”³è¯·çš„å†…å­˜ä¸Šé™æ˜¯M&#47;N,é‚£ä¹ˆå½“æ•°æ®åˆ†ç‰‡è¿‡å°‘ï¼ŒæŸä¸ªtaskéœ€è¦å¤„ç†çš„æ•°æ®é‡è¾ƒå¤§ï¼ŒM&#47;Nçš„ä¸Šé™æ‰§è¡Œå†…å­˜ä¹Ÿä¸å¤Ÿæ—¶ï¼Œå°±ä¼šå‡ºç°OOMã€‚<br>ä¸çŸ¥é“è¿™ä¹ˆç†è§£å¯¹ä¸å¯¹ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518670,"discussion_content":"å¯¹ï¼Œæ²¡é”™~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618566505,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288212,"user_name":"kingcall","can_delete":false,"product_type":"c1","uid":1056982,"ip_address":"","ucode":"508884DC684B5B","user_header":"https://static001.geekbang.org/account/avatar/00/10/20/d6/b9513db0.jpg","comment_is_top":false,"comment_ctime":1618365972,"is_pvip":false,"replies":[{"id":"104643","content":"æ²¡å†™é”™å“Ÿï¼Œä¸Šé™å°±æ˜¯ spark.executor.memory * spark.memory.fraction ï¼Œä¹Ÿå°±æ˜¯storage memory + execution memoryä¹‹å’Œã€‚Unified memory managerï¼Œåœ¨ç»Ÿä¸€ç®¡ç†æ¨¡å¼ä¸‹ï¼Œå¤§å®¶æ˜¯å¯ä»¥äº’ç›¸æŠ¢å çš„ï¼Œå› æ­¤ï¼Œå¦‚æœæ²¡æœ‰åˆ†å¸ƒå¼æ•°æ®é›†ç¼“å­˜ï¼Œstorage memoryé‚£ç‰‡å†…å­˜åŒºåŸŸï¼Œæ‰§è¡Œä»»åŠ¡æ˜¯éƒ½å¯ä»¥æŠ¢è¿‡æ¥çš„ï¼Œæ‰€ä»¥ä¸Šé™å°±æ˜¯ä¸¤è€…ä¹‹å’Œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1618394477,"ip_address":"","comment_id":288212,"utype":1}],"discussion_count":3,"race_medal":0,"score":"10208300564","product_id":100073401,"comment_content":"M çš„ä¸‹é™æ˜¯ Execution Memory åˆå§‹å€¼ï¼Œä¸Šé™æ˜¯ spark.executor.memory * spark.memory.fraction åˆ’å®šçš„æ‰€æœ‰å†…å­˜åŒºåŸŸã€‚è¿™ä¸ªè€å¸ˆç¬”è¯¯ï¼Œå†™é”™äº†å§ï¼","like_count":2,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518549,"discussion_content":"æ²¡å†™é”™å“Ÿï¼Œä¸Šé™å°±æ˜¯ spark.executor.memory * spark.memory.fraction ï¼Œä¹Ÿå°±æ˜¯storage memory + execution memoryä¹‹å’Œã€‚Unified memory managerï¼Œåœ¨ç»Ÿä¸€ç®¡ç†æ¨¡å¼ä¸‹ï¼Œå¤§å®¶æ˜¯å¯ä»¥äº’ç›¸æŠ¢å çš„ï¼Œå› æ­¤ï¼Œå¦‚æœæ²¡æœ‰åˆ†å¸ƒå¼æ•°æ®é›†ç¼“å­˜ï¼Œstorage memoryé‚£ç‰‡å†…å­˜åŒºåŸŸï¼Œæ‰§è¡Œä»»åŠ¡æ˜¯éƒ½å¯ä»¥æŠ¢è¿‡æ¥çš„ï¼Œæ‰€ä»¥ä¸Šé™å°±æ˜¯ä¸¤è€…ä¹‹å’Œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618394477,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1056982,"avatar":"https://static001.geekbang.org/account/avatar/00/10/20/d6/b9513db0.jpg","nickname":"kingcall","note":"","ucode":"508884DC684B5B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367578,"discussion_content":"æˆ‘ç†è§£é”™äº†ï¼Œè€å¸ˆè§è°…ï¼æäº¤ç‚¹çš„é‚£ä¸€åˆ»æ‰æ„è¯†åˆ°ï¼Œå¥ˆä½•å·²ç»æäº¤äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1618398847,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367865,"discussion_content":"æ²¡äº‹çš„ï¼Œå¤šè®¨è®ºè®¨è®ºæŒºå¥½çš„~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618487797,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290873,"user_name":"å°çµèŠ","can_delete":false,"product_type":"c1","uid":2071355,"ip_address":"","ucode":"6DCB7CF8D5A7F1","user_header":"https://static001.geekbang.org/account/avatar/00/1f/9b/3b/dc3f819f.jpg","comment_is_top":false,"comment_ctime":1619798030,"is_pvip":false,"replies":[{"id":"105412","content":"ç¨æœ‰å·®åˆ«ï¼ŒMã€Næ˜¯é’ˆå¯¹Executorçš„ï¼Œä¹Ÿå°±æ˜¯Executorçš„æ‰§è¡Œå†…å­˜Mã€çº¿ç¨‹æ± å¤§å°Nã€‚<br><br>Då’ŒPä¸ä¸€æ ·ï¼Œå®ƒæŒ‡çš„æ˜¯ä½ çš„åˆ†å¸ƒå¼æ•°æ®é›†ï¼ŒDæ˜¯æ•°æ®æ€»é‡ï¼Œæ¯”å¦‚20GBï¼›è€ŒPæŒ‡çš„æ˜¯è¿™ä»½æ•°æ®é›†çš„å¹¶è¡Œåº¦ï¼Œæ¯”å¦‚200ï¼Œé‚£ä¹ˆä½ çš„æ¯ä¸ªæ•°æ®åˆ†ç‰‡çš„å¤§å°D&#47;Pï¼Œå°±æ˜¯20GB&#47;200 = 100MBã€‚<br><br>å¦‚æœä½ çš„Mæ˜¯2GBï¼Œä¹Ÿå°±æ˜¯2GBçš„æ‰§è¡Œå†…å­˜ï¼ŒNæ˜¯20ï¼Œä¹Ÿå°±æ˜¯20ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼ŒM&#47;Nå°±æ˜¯100MBã€‚é‚£ä¹ˆï¼Œä½ çš„D&#47;På°±åˆšå¥½åè½åœ¨(M&#47;N&#47;2, M&#47;N)è¿™ä¸ªåŒºé—´é‡Œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1619861364,"ip_address":"","comment_id":290873,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5914765326","product_id":100073401,"comment_content":"â€œåœ¨ç»™å®šæ‰§è¡Œå†…å­˜ Mã€çº¿ç¨‹æ± å¤§å° N å’Œæ•°æ®æ€»é‡ D çš„æ—¶å€™ï¼Œæƒ³è¦æœ‰æ•ˆåœ°æå‡ CPU åˆ©ç”¨ç‡ï¼Œæˆ‘ä»¬å°±è¦è®¡ç®—å‡ºæœ€ä½³å¹¶è¡Œåº¦ Pï¼Œè®¡ç®—æ–¹æ³•æ˜¯è®©æ•°æ®åˆ†ç‰‡çš„å¹³å‡å¤§å° D&#47;P åè½åœ¨ï¼ˆM&#47;N&#47;2, M&#47;Nï¼‰åŒºé—´ã€‚è¿™æ ·ï¼Œåœ¨è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬çš„ CPU åˆ©ç”¨ç‡å¾€å¾€ä¸ä¼šå¤ªå·®ã€‚â€<br><br>è¯·é—®è€å¸ˆï¼Œè¿™é‡Œçš„M, Nï¼Œ D éƒ½æ˜¯é’ˆå¯¹ä¸€ä¸ªexecutorè€Œè¨€çš„å¯¹å§ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":2855459,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/icJzoUc02ECdBbFgGzVIwYfpRgL3TXuRRE5GsDqZFmAlAAm1KUQS1rHewgj5FB4TChovo3YaceicEZE2MgZJ1ftw/132","nickname":"Geek_eb29a4","note":"","ucode":"CF88D4ED5F4A25","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538003,"discussion_content":"çº¿ç¨‹æ± å¤§å°N ï¼Œè¿™ä¸ªå‚æ•°æ€ä¹ˆè®¾ç½®ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639295649,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288523,"user_name":"æ¥ä¸–æ„¿åšå‹äºº A","can_delete":false,"product_type":"c1","uid":1181606,"ip_address":"","ucode":"EF20966B0F27E1","user_header":"https://static001.geekbang.org/account/avatar/00/12/07/a6/662bcc6b.jpg","comment_is_top":false,"comment_ctime":1618504418,"is_pvip":false,"replies":[{"id":"104758","content":"ç¬¬äºŒé¢˜å®Œç¾~<br><br>ç¬¬ä¸€é¢˜ä¹Ÿå¯¹ï¼Œä¸è¿‡ç®—æ˜¯edge caseäº†ã€‚å¯ä»¥æƒ³æƒ³ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œin generalï¼Œä¸ºå•¥taskä¼šOOMï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1618585766,"ip_address":"","comment_id":288523,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5913471714","product_id":100073401,"comment_content":"1. excutor å¹¶å‘åº¦å¦‚æœè¿‡é«˜ï¼Œè€ƒè™‘æç«¯æƒ…å†µï¼ŒstorageMemery è¿˜æ²¡æœ‰ä½¿ç”¨ï¼Œè¿™æ—¶å€™è¿™éƒ¨åˆ†å†…å­˜æ˜¯ä¼šè¢« task æ‰€æŠ¢å çš„ï¼Œæ¯ä¸ªä»»åŠ¡çš„ä¸Šé™æ˜¯ 1&#47;Nã€‚ä½†æ˜¯å¯¹äº storage å’Œ execute pool çš„æ± é”ä¸æ˜¯åŒä¸€ä¸ªé”ã€‚å¹¶å‘é«˜çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç° execute å‰©ä½™å†…å­˜å‡è®¾ 1Mï¼Œtask ç”³è¯· execute å†…å­˜å¹¶ä¸” size ç”³è¯·æˆåŠŸï¼Œä½†æ˜¯è¿˜æ²¡ alloc å†…å­˜ã€‚å¹¶è¡Œæ¡ä»¶ä¸‹ï¼Œæ­¤æ—¶åˆ«çš„ task çº¿ç¨‹åˆšå¥½ç”³è¯·äº† storage pool çš„å†…å­˜ 0.8M è¿›è¡Œ block å­˜å‚¨ï¼Œå¹¶ä¸”ç”³è¯·æˆåŠŸã€‚ç„¶åç”³è¯· 1M çš„ task çº¿ç¨‹æ‰ allocateï¼Œå´å‘ç°å†…å­˜ä¸å¤Ÿ OOM äº†ã€‚ä¸çŸ¥é“è¿™æ ·å¯¹ä¸å¯¹<br>2. å…¶å®åœ¨ task æ¯æ¬¡çš„ allocatePageï¼Œéƒ½ä¼šåŠ¨æ€è®¡ç®— task å½“å…ˆçš„ä¸Šä¸‹é™çš„ç”³è¯·å¤§å°ã€‚æ»¡è¶³ç”³è¯·æ¡ä»¶ï¼Œè¿”å›ã€‚ç”³è¯·åå¯ç”¨å¤§å°åŠ ä¸Šå½“å‰å·²ç”¨ä¸æ»¡è¶³ä¸‹é™ï¼Œåˆ™æŒ‚èµ·ç­‰å¾…å…¶å®ƒ task å”¤é†’æŠ¢å ã€‚","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518649,"discussion_content":"ç¬¬äºŒé¢˜å®Œç¾~\n\nç¬¬ä¸€é¢˜ä¹Ÿå¯¹ï¼Œä¸è¿‡ç®—æ˜¯edge caseäº†ã€‚å¯ä»¥æƒ³æƒ³ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œin generalï¼Œä¸ºå•¥taskä¼šOOMï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618585766,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1181606,"avatar":"https://static001.geekbang.org/account/avatar/00/12/07/a6/662bcc6b.jpg","nickname":"æ¥ä¸–æ„¿åšå‹äºº A","note":"","ucode":"EF20966B0F27E1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368193,"discussion_content":"çœ‹äº†@Geek çš„è¯„è®ºï¼ŒçŒœæµ‹å¯èƒ½çœ‹æ¼äº†é‚£å—ï¼Œå»çœ‹äº†ä¸‹æºç ã€‚çº æ­£äº†è‡ªå·±çš„æƒ³æ³•ï¼Œä»¥ä¸ºä¸€æ¬¡ page å†…å­˜ç”³è¯·ä¸å¤Ÿä¼šæŒ‚èµ·ï¼ŒåŸæ¥æ˜¯å°½é‡å…¨éƒ¨åˆ†é…ï¼Œå¦‚æœç”³è¯·çš„ page ä¸º null æˆ–è€… size å°äºè¯·æ±‚çš„å¤§å°ï¼Œspark å°±ä¼šé‡Šæ”¾ æŠ›å‡º SparkOutOfMemoryError","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1618590609,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353970,"user_name":"ì¹­ì°¬í•˜ë‹¤","can_delete":false,"product_type":"c1","uid":1276001,"ip_address":"ç¦å»º","ucode":"F6E3F358F3EBDF","user_header":"https://static001.geekbang.org/account/avatar/00/13/78/61/a1189d65.jpg","comment_is_top":false,"comment_ctime":1659963482,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1659963482","product_id":100073401,"comment_content":"è€å¸ˆï¼Œ<br>ã€Œé—®é¢˜èƒŒæ™¯ã€ï¼šæ‚¨æåˆ°â€œExecutor çš„çº¿ç¨‹æ± å¤§å°ç”±å‚æ•° spark.executor.cores å†³å®šï¼Œæ¯ä¸ªä»»åŠ¡åœ¨æ‰§è¡ŒæœŸé—´éœ€è¦æ¶ˆè€—çš„çº¿ç¨‹æ•°ç”± spark.task.cpus é…ç½®é¡¹ç»™å®šã€‚ä¸¤è€…ç›¸é™¤å¾—åˆ°çš„å•†å°±æ˜¯å¹¶å‘åº¦â€<br>ã€Œé—®é¢˜æè¿°ã€ï¼šè¿™é‡Œçš„å•†æ˜¯ä¸æ˜¯å¹¶è¡Œåº¦å‘¢ï¼Ÿ<br>ã€Œæˆ‘çš„ç†è§£ã€ï¼šå¹¶è¡ŒæŒ‡æœ€å¤šå¯ä»¥åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°ï¼Œçº¿ç¨‹é—´æ˜¯äº’ä¸æŠ¢å  CPU èµ„æºçš„ã€‚å¹¶å‘æŒ‡ä¸€ä¸ª CPU è¿è¡Œå¤šä¸ªçº¿ç¨‹ï¼Œä¼šäº’ç›¸æŠ¢å  CPU èµ„æºã€‚è¿™é‡Œå•†æ˜¯ä¸ä¼šäº’ç›¸æŠ¢å  CPU èµ„æºçš„ã€‚<br>","like_count":0},{"had_liked":false,"id":348523,"user_name":"æ¡é›¨","can_delete":false,"product_type":"c1","uid":2719845,"ip_address":"","ucode":"AEE92AEE03778A","user_header":"https://static001.geekbang.org/account/avatar/00/29/80/65/9ec76b46.jpg","comment_is_top":false,"comment_ctime":1655170954,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1655170954","product_id":100073401,"comment_content":"æ²¡æœ‰æƒ³æ¸…æ¥šä¸ºå•¥ å¹¶å‘åº¦ ç­‰äºspark.executor.cores &#47; spark.task.cpus , è¦è¯´æ˜¯è¿™ä¸¤è€…ä¹‹é—´çš„ä¹˜ç§¯å€’æ˜¯èƒ½ç†è§£ , è¿™ä¸¤è€…ä¹‹é—´çš„å•†æ˜¯ä»€ä¹ˆå«ä¹‰å‘¢?","like_count":0,"discussions":[{"author":{"id":1947809,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/b8/a1/019574ad.jpg","nickname":"æ¾èŠ±é…¿é…’ï¼Œæ˜¥æ°´ç…èŒ¶","note":"","ucode":"843A6AB55FCF99","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580714,"discussion_content":"spark.executor.coresè¡¨ç¤ºå•ä¸ªexecutoråˆ†é…åˆ°çš„æ ¸æ•°ï¼Œspark.task.cpuså•ä¸ªä»»åŠ¡éœ€è¦æ¶ˆè€—çš„æ ¸æ•°ï¼Œä¸¤è€…ç›¸é™¤å°±è¡¨ç¤ºå•ä¸ªexecutoræœ€å¤šèƒ½åŒæ—¶å¯åŠ¨çš„taskçº¿ç¨‹æ•°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658332871,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":346617,"user_name":"æ–¯ç›–ä¸¸","can_delete":false,"product_type":"c1","uid":1168504,"ip_address":"","ucode":"B881D14B028F14","user_header":"https://static001.geekbang.org/account/avatar/00/11/d4/78/66b3f2a2.jpg","comment_is_top":false,"comment_ctime":1653292876,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1653292876","product_id":100073401,"comment_content":"è€å¸ˆï¼Œå‡è®¾æˆ‘ä¸€ä¸ª Databricksé›†ç¾¤ 10 å°ï¼Œæ¯å°çš„executor memory56Gï¼Œæ¯å°çš„executor cores16 ä¸ªï¼Œé‚£æŒ‰ç…§æ‚¨çš„å…¬å¼ï¼Œæˆ‘çš„æ•°æ®åˆ†ç‰‡å¤§å°åº”è¯¥åœ¨ (56&#47;32, 56&#47;16)ï¼Œä¹Ÿå°±æ˜¯(1.75G, 3.5G)ä¹‹é—´å—ï¼Ÿæ„Ÿè§‰è¿™ä¸ªå€¼å¤ªå¤§äº†å§ã€‚ã€‚ã€‚","like_count":0,"discussions":[{"author":{"id":3011130,"avatar":"","nickname":"Geek_3aa2a6","note":"","ucode":"1757BE9C365D9F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":574258,"discussion_content":"è¿™é‡Œçš„executor_memory è‚¯å®šè¦å°äº56Gï¼Œé»˜è®¤åº”è¯¥æ˜¯0.3å€å§ï¼Œfraction * ï¼ˆ1-strorageFractionï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653925753,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":344376,"user_name":"æˆ‘çˆ±å¤œæ¥é¦™","can_delete":false,"product_type":"c1","uid":2609930,"ip_address":"","ucode":"10761E677EF05F","user_header":"https://static001.geekbang.org/account/avatar/00/27/d3/0a/92640aae.jpg","comment_is_top":false,"comment_ctime":1651499685,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1651499685","product_id":100073401,"comment_content":"è€å¸ˆ,å¦‚æœè®¾ç½®shuffle.partitionè¿‡å¤§,AQEä¸æ˜¯ä¼šè‡ªåŠ¨åˆå¹¶å—?å¯¹reducerçš„æ•°é‡è®¾ç½®è¦æ±‚æ˜¯ä¸æ˜¯æ²¡é‚£ä¹ˆä¸¥æ ¼äº†","like_count":0},{"had_liked":false,"id":341013,"user_name":"Ebdaoli","can_delete":false,"product_type":"c1","uid":1722878,"ip_address":"","ucode":"E45C113C1AFD12","user_header":"https://static001.geekbang.org/account/avatar/00/1a/49/fe/48846a6d.jpg","comment_is_top":false,"comment_ctime":1649295562,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1649295562","product_id":100073401,"comment_content":"ç£Šå“¥ï¼Œè¯·æ•™ä¸€ä¸‹ï¼Œå¦‚æœæ˜¯åœ¨spark sqlåœºæ™¯ä¸­ï¼Œa join b join c join d è¿™ç±»ä¼¼å¤šè¡¨Joinçš„æƒ…å†µä¸‹ï¼Œåœ¨è®¡ç®—æ€»æ•°æ®é›†å¤§å°Dçš„æ—¶å€™ï¼Œè¿™æ—¶å€™åº”è¯¥æ€ä¹ˆè®¡ç®—å‘¢ï¼Ÿæ˜¯å¦å–åŠ äº†filteræ¡ä»¶åï¼ˆè¿˜æ˜¯scanå‰çš„æ•°æ®å¤§å°ï¼Ÿï¼‰çš„æ•°æ®è®¡ç®—å‘¢ï¼Ÿä»¥åŠæ˜¯å¦éœ€è¦å¯¹æ¯ä¸€å¼ è¡¨çš„æ€»æ•°æ®é›†å¤§å°è¿›è¡Œè®¡ç®—ï¼ˆæˆ–è€…åªå–æœ€å¤§çš„ä¸€å¼ è¡¨è¿›è¡Œè®¡ç®—ï¼‰ï¼Œåº”è¯¥å–å“ªä¸€ä¸ªç»“æœä½œä¸ºå…¬å¼ä¸­çš„Dï¼Ÿ","like_count":0},{"had_liked":false,"id":331378,"user_name":"Sampson","can_delete":false,"product_type":"c1","uid":1418226,"ip_address":"","ucode":"BA78CA29A6D898","user_header":"https://static001.geekbang.org/account/avatar/00/15/a3/f2/ab8c5183.jpg","comment_is_top":false,"comment_ctime":1642565626,"is_pvip":true,"replies":[{"id":"121203","content":"è¿™ä¸ªéœ€è¦ç†Ÿæ‚‰shuffleé‡Œé¢ï¼Œç”¨åˆ°çš„å†…å­˜æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚AppendOnlyMapï¼ŒPartitionedPairBufferï¼Œç­‰ç­‰ã€‚åœ¨Shuffle map taské˜¶æ®µï¼ŒSparkä¼šåˆ©ç”¨ç±»ä¼¼çš„æ•°æ®ç»“æ„ï¼Œæ¥è®¡ç®—æ•°æ®ï¼Œå½“è¿™äº›æ•°æ®ç»“æ„ç©ºé—´ä¸è¶³çš„æ—¶å€™ï¼ŒSparkä¼šæˆå€æ‰©å®¹è¿™äº›æ•°æ®ç»“æ„ï¼Œä½†æ˜¯åªä¼šæ‰©å®¹ä¸€æ¬¡ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰Spillæœºåˆ¶ï¼Œå®é™…ä¸ŠSparkå¾ˆå®¹æ˜“OOMï¼Œå› ä¸ºæ‰©å®¹ä¸€æ¬¡ä¹‹åï¼Œä¹Ÿå¾ˆéš¾å®¹ä¸‹å•ä¸ªæ•°æ®åˆ†ç‰‡çš„å…¨éƒ¨æ•°æ®","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1043100","ctime":1642779554,"ip_address":"","comment_id":331378,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1642565626","product_id":100073401,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œè¯·æ•™ä¸€ä¸‹ï¼Œåœ¨ä¸Šæ–‡ä¸­æœ‰æåˆ°spillæœºåˆ¶å¯ä»¥ä¿æŠ¤oom çš„æº¢å‡ºï¼Œè¿™ä¸ªæ˜¯æ€ä¹ˆåˆ¤æ–­çš„å‘¢ ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547648,"discussion_content":"è¿™ä¸ªéœ€è¦ç†Ÿæ‚‰shuffleé‡Œé¢ï¼Œç”¨åˆ°çš„å†…å­˜æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚AppendOnlyMapï¼ŒPartitionedPairBufferï¼Œç­‰ç­‰ã€‚åœ¨Shuffle map taské˜¶æ®µï¼ŒSparkä¼šåˆ©ç”¨ç±»ä¼¼çš„æ•°æ®ç»“æ„ï¼Œæ¥è®¡ç®—æ•°æ®ï¼Œå½“è¿™äº›æ•°æ®ç»“æ„ç©ºé—´ä¸è¶³çš„æ—¶å€™ï¼ŒSparkä¼šæˆå€æ‰©å®¹è¿™äº›æ•°æ®ç»“æ„ï¼Œä½†æ˜¯åªä¼šæ‰©å®¹ä¸€æ¬¡ã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæ²¡æœ‰Spillæœºåˆ¶ï¼Œå®é™…ä¸ŠSparkå¾ˆå®¹æ˜“OOMï¼Œå› ä¸ºæ‰©å®¹ä¸€æ¬¡ä¹‹åï¼Œä¹Ÿå¾ˆéš¾å®¹ä¸‹å•ä¸ªæ•°æ®åˆ†ç‰‡çš„å…¨éƒ¨æ•°æ®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642779554,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328140,"user_name":"Unknown element","can_delete":false,"product_type":"c1","uid":2028277,"ip_address":"","ucode":"34A129800D0238","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f2/f5/b82f410d.jpg","comment_is_top":false,"comment_ctime":1640571091,"is_pvip":false,"replies":[{"id":"119853","content":"å…ˆæ¥è¯´ç¬¬ä¸€ä¸ªå“ˆ<br>ï¼ˆ11765[Finished] + 6[Ongoing]) &#47; 11769[Total]<br>æœ€åä¸€ä¸ªï¼Œ11769ï¼Œæ˜¯Total tasksï¼Œæ‰€æœ‰tasksçš„æ•°é‡ï¼›11765ï¼Œæ˜¯Finishedçš„tasksæ•°é‡ï¼ŒåŒ…æ‹¬Failedï¼Œ6æ˜¯æ­£åœ¨æ‰§è¡Œçš„tasksï¼Œä¸¤è¾¹åŠ èµ·æ¥ä¸ä¸€æ ·ï¼Œæˆ‘ç†è§£æ˜¯Finishedé‡Œé¢æœ‰Failedï¼Œç„¶åé‡è¯•çš„<br><br>Taskså¤šå€’ä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ï¼Œä¸»è¦æ˜¯è¦ç»“åˆâ€œä¸‰è¶³é¼ç«‹â€ï¼Œè°ƒæ•´å¹¶è¡Œåº¦ï¼Œè®©CPUã€å†…å­˜ã€å¹¶è¡Œåº¦ä¿æŒä¸€è‡´å°±è¡Œ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1043100","ctime":1641003654,"ip_address":"","comment_id":328140,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1640571091","product_id":100073401,"comment_content":"è€å¸ˆæ‚¨å¥½ sparkåœ¨è®¡ç®—è¿‡ç¨‹ä¸­ä¼šè¾“å‡ºç±»ä¼¼è¿™æ ·çš„æ—¥å¿—ï¼š<br>[Stage 1:==================================================&gt;(11765 + 6) &#47; 11769]<br>æƒ³é—®ä¸‹è¿™é‡Œçš„æ•°å­—æ˜¯ task æ•°å—ï¼Ÿä¸ºä»€ä¹ˆæ‹¬å·é‡Œçš„ä¸¤ä¸ªtaskæ•°åŠ èµ·æ¥ä¸ç­‰äºå¤–é¢taskæ•°å‘¢ï¼Ÿ<br>å¦å¤–è¿™é‡Œçš„taskæ˜¯ä¸æ˜¯åå¤šï¼Ÿåº”è¯¥ä»å“ªäº›æ–¹é¢å»æ’æŸ¥é—®é¢˜å‘¢ï¼Ÿ<br>è°¢è°¢è€å¸ˆ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543192,"discussion_content":"å…ˆæ¥è¯´ç¬¬ä¸€ä¸ªå“ˆ\nï¼ˆ11765[Finished] + 6[Ongoing]) / 11769[Total]\næœ€åä¸€ä¸ªï¼Œ11769ï¼Œæ˜¯Total tasksï¼Œæ‰€æœ‰tasksçš„æ•°é‡ï¼›11765ï¼Œæ˜¯Finishedçš„tasksæ•°é‡ï¼ŒåŒ…æ‹¬Failedï¼Œ6æ˜¯æ­£åœ¨æ‰§è¡Œçš„tasksï¼Œä¸¤è¾¹åŠ èµ·æ¥ä¸ä¸€æ ·ï¼Œæˆ‘ç†è§£æ˜¯Finishedé‡Œé¢æœ‰Failedï¼Œç„¶åé‡è¯•çš„\n\nTaskså¤šå€’ä¸æ˜¯ä»€ä¹ˆå¤§é—®é¢˜ï¼Œä¸»è¦æ˜¯è¦ç»“åˆâ€œä¸‰è¶³é¼ç«‹â€ï¼Œè°ƒæ•´å¹¶è¡Œåº¦ï¼Œè®©CPUã€å†…å­˜ã€å¹¶è¡Œåº¦ä¿æŒä¸€è‡´å°±è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641003654,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":322168,"user_name":"å­å…®","can_delete":false,"product_type":"c1","uid":2767208,"ip_address":"","ucode":"BA213EAB26DF16","user_header":"https://static001.geekbang.org/account/avatar/00/2a/39/68/56dfc8c0.jpg","comment_is_top":false,"comment_ctime":1637218394,"is_pvip":false,"replies":[{"id":"117229","content":"å…ˆè¯´1ï¼Œå®Œå…¨æœ‰å¯èƒ½~ taskå¯¹äºå†…å­˜çš„ç”³è¯·ï¼Œæ˜¯éšéœ€éšç”¨çš„ï¼Œå¹¶ä¸æ˜¯ä¸€å¼€å§‹å°±åˆ†é…M&amp;#47;N&amp;#47;2ï¼Œæ‰€ä»¥è·‘å¾—å¿«çš„å°taskç»“æŸä¹‹åï¼Œç©ºé—²çš„å†…å­˜ï¼Œå°±å¯ä»¥ç•™ç»™å¤§çš„taskï¼Œå½“ç„¶ï¼Œè¿™é‡Œè¿˜è¦è€ƒè™‘gcçš„å»¶è¿Ÿã€‚taskæ•°é‡æœ‰å˜åŒ–ï¼ŒSparkå°±ä¼šé‡æ–°è®¡ç®—M&amp;#47;Nï¼Œä¹Ÿå°±æ˜¯ä½ ç»™çš„5&amp;#47;2=22.5Mï¼Œæ‰€ä»¥18Mçš„taskï¼Œå°±ä¸ä¼šOOM~<br><br>é—®é¢˜2çš„è¯ï¼Œè¿™ä¸ªæ¯”è¾ƒtrickyï¼Œè¿™ä¸ªå’±ä»¬å¾ˆéš¾on the flyåœ°å†å»åšè°ƒæ•´ï¼Œæ¯”è¾ƒè¡Œä¹‹æœ‰æ•ˆçš„åŠæ³•ï¼Œå°±æ˜¯åœ¨æœ€å¼€å§‹ï¼Œç»“åˆåŸå§‹æ•°æ®é‡å¤§å°ï¼ˆå†…å­˜ä¸­çš„å¤§å°ï¼‰ï¼Œå†ç»“åˆCPUã€å†…å­˜é…ç½®ï¼ŒæŒ‰ç…§â€œä¸‰è¶³é¼ç«‹â€çš„æ€è·¯ï¼Œå»è®¾ç½®","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1043100","ctime":1637662147,"ip_address":"","comment_id":322168,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1637218394","product_id":100073401,"comment_content":"è€å¸ˆï¼Œæœ‰æ²¡æœ‰å¯èƒ½ï¼šM&#47;N =45M&#47;3core=15Mï¼Œ æœ‰ä¸‰ä¸ªåˆ†ç‰‡ 5M ï¼Œ12Mï¼Œ18M,  ç†è®ºæ¥è®²ï¼Œ18M çš„task ä¼šå‡ºç°oomï¼Œä¸‰ä¸ªtask åŒæ—¶æ‰§è¡Œï¼Œä½†åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç”±äº5M çš„task è¿…é€Ÿæ‰§è¡Œå®Œæˆï¼Œä½¿å¾—å†…å­˜é‡Šæ”¾ï¼Œè¿™æ—¶18M åœ¨æ‰§è¡Œæ—¶è·å¾—45&#47;2=22.5Mï¼Œæ²¡æœ‰æŠ¥oom ï¼Ÿ<br>2 spark graphx åœ¨æ‰§è¡Œæ—¶æ¯ä¸ªjob æ‰€éœ€è¦å¤„ç†çš„æ•°æ®é‡éƒ½ä¸åŒï¼Œæ²¡æœ‰åŠæ³•å®æ—¶è¯„ä¼°æ›´æ”¹ï¼Œè¿™æ—¶çš„è®¾ç½®åº”è¯¥æ€æ ·æ€è€ƒå‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532658,"discussion_content":"å…ˆè¯´1ï¼Œå®Œå…¨æœ‰å¯èƒ½~ taskå¯¹äºå†…å­˜çš„ç”³è¯·ï¼Œæ˜¯éšéœ€éšç”¨çš„ï¼Œå¹¶ä¸æ˜¯ä¸€å¼€å§‹å°±åˆ†é…M&amp;#47;N&amp;#47;2ï¼Œæ‰€ä»¥è·‘å¾—å¿«çš„å°taskç»“æŸä¹‹åï¼Œç©ºé—²çš„å†…å­˜ï¼Œå°±å¯ä»¥ç•™ç»™å¤§çš„taskï¼Œå½“ç„¶ï¼Œè¿™é‡Œè¿˜è¦è€ƒè™‘gcçš„å»¶è¿Ÿã€‚taskæ•°é‡æœ‰å˜åŒ–ï¼ŒSparkå°±ä¼šé‡æ–°è®¡ç®—M&amp;#47;Nï¼Œä¹Ÿå°±æ˜¯ä½ ç»™çš„5&amp;#47;2=22.5Mï¼Œæ‰€ä»¥18Mçš„taskï¼Œå°±ä¸ä¼šOOM~\n\né—®é¢˜2çš„è¯ï¼Œè¿™ä¸ªæ¯”è¾ƒtrickyï¼Œè¿™ä¸ªå’±ä»¬å¾ˆéš¾on the flyåœ°å†å»åšè°ƒæ•´ï¼Œæ¯”è¾ƒè¡Œä¹‹æœ‰æ•ˆçš„åŠæ³•ï¼Œå°±æ˜¯åœ¨æœ€å¼€å§‹ï¼Œç»“åˆåŸå§‹æ•°æ®é‡å¤§å°ï¼ˆå†…å­˜ä¸­çš„å¤§å°ï¼‰ï¼Œå†ç»“åˆCPUã€å†…å­˜é…ç½®ï¼ŒæŒ‰ç…§â€œä¸‰è¶³é¼ç«‹â€çš„æ€è·¯ï¼Œå»è®¾ç½®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637662147,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":318619,"user_name":"ç‹—å“­","can_delete":false,"product_type":"c1","uid":2725399,"ip_address":"","ucode":"56E48A6FC1298A","user_header":"https://static001.geekbang.org/account/avatar/00/29/96/17/200c21f0.jpg","comment_is_top":false,"comment_ctime":1635350359,"is_pvip":false,"replies":[{"id":"115572","content":"å…¶å®æˆ‘ç†è§£è¿™æ˜¯ä¸¤ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªæ˜¯locality waité—®é¢˜ï¼Œä¸€ä¸ªæ˜¯CPUåˆ©ç”¨ç‡ä½çš„é—®é¢˜ã€‚<br><br>å…ˆè¯´CPUåˆ©ç”¨ç‡ä½çš„äº‹å„¿ï¼Œå…¶å®è¿™ä¸ªå°±æ˜¯æœ¬è®²çš„é‡ç‚¹ï¼Œè€å¼Ÿå¯ä»¥è€ƒè™‘é‡‡ç”¨â€œä¸‰è¶³é¼ç«‹â€çš„æ€è·¯æ¥å°è¯•<br><br>è‡³äºlocality waitï¼Œè¿™ä¸ªæœ¬è´¨ä¸Šæ˜¯ä¸ªå¹³è¡¡ï¼Œè¦ä¹ˆå¤šèŠ±æ—¶é—´ç­‰å¾…æ›´å¥½çš„localityï¼Œæ¯”å¦‚ç­‰å¾…PROCESS_LOCALæˆ–æ˜¯NODE_LOCALï¼›è¦ä¹ˆï¼Œé©¬ä¸Šè°ƒåº¦å‡ºå»ï¼Œä¸è€ƒè™‘localityã€‚å…¶å®å°±æ˜¯è°ƒåº¦å¼€é”€ä¸æ‰§è¡Œæ•ˆç‡çš„å¹³è¡¡ã€‚<br><br>æˆ‘è§‰å¾—å¯ä»¥ä¸¤æ­¥èµ°ï¼Œç¬¬ä¸€æ­¥å…ˆç”¨â€œä¸‰è¶³é¼ç«‹â€ï¼Œæ¶ˆé™¤CPUã€å†…å­˜ã€æ•°æ®ä¹‹é—´çš„ä¸ä¸€è‡´ï¼Œè€Œå¯¼è‡´çš„CPUåˆ©ç”¨ç‡è¿‡ä½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå…ˆé€šè¿‡ä¸‰è¶³é¼ç«‹ï¼Œä¿è¯è¿™3è€…æ˜¯ä¸€è‡´çš„ã€‚ç„¶åï¼Œå†å»è€ƒè™‘localityçš„å½±å“ã€‚<br><br>å› ä¸ºï¼Œå°±ç»éªŒæ¥è¯´ï¼Œlocalityå¯¹äºæ‰§è¡Œæ€§èƒ½æ¥è¯´ï¼Œä½œç”¨ç›¸å¯¹æ¬¡ä¹‹ã€‚è€Œå¯¹äºå¦‚ä½•å¹³è¡¡waitçš„è®¾ç½®ï¼Œå¦ç™½è¯´ï¼Œæˆ‘ä¹Ÿç»™ä¸å‡ºä¸€ä¸ªé‡åŒ–çš„åŠæ³•æˆ–è€…æ˜¯å…¬å¼ï¼Œåªèƒ½æ˜¯case by caseåœ°å»å°è¯•ã€åˆ†æï¼Œæ‰¾åˆ°ä¸€ä¸ªåˆç†çš„ä¸­é—´å€¼~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1635425166,"ip_address":"","comment_id":318619,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1635350359","product_id":100073401,"comment_content":"è€å¸ˆè¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼Œsparkä¸­æœ‰è¿™ä¹ˆä¸€ä¸ªé…ç½®ï¼Œspark.locality.waitç”¨æ¥é…ç½®taskæ•°æ®æœ¬åœ°åŒ–çº§åˆ«ç­‰å¾…æ—¶å¸¸ï¼Œé»˜è®¤æ˜¯3sï¼Œä½†æ˜¯å‘ç°æœ‰æ—¶å€™cpuåˆ©ç”¨ç‡å°±å¾ˆä½ï¼Œå¦‚æœé…æˆ0å‘ç°taskçš„æ•°æ®æœ¬åœ°åŒ–çº§åˆ«å¾ˆå¤šæ˜¯nodeç”šè‡³rackçº§åˆ«çš„ï¼Œè¯·é—®è¿™ä¸ªè¯¥æ€ä¹ˆå¹³è¡¡å‘¢ï¼Ÿæˆ–è€…æœ‰ä»€ä¹ˆå¥½çš„åŠæ³•è§£å†³å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529316,"discussion_content":"å…¶å®æˆ‘ç†è§£è¿™æ˜¯ä¸¤ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªæ˜¯locality waité—®é¢˜ï¼Œä¸€ä¸ªæ˜¯CPUåˆ©ç”¨ç‡ä½çš„é—®é¢˜ã€‚\n\nå…ˆè¯´CPUåˆ©ç”¨ç‡ä½çš„äº‹å„¿ï¼Œå…¶å®è¿™ä¸ªå°±æ˜¯æœ¬è®²çš„é‡ç‚¹ï¼Œè€å¼Ÿå¯ä»¥è€ƒè™‘é‡‡ç”¨â€œä¸‰è¶³é¼ç«‹â€çš„æ€è·¯æ¥å°è¯•\n\nè‡³äºlocality waitï¼Œè¿™ä¸ªæœ¬è´¨ä¸Šæ˜¯ä¸ªå¹³è¡¡ï¼Œè¦ä¹ˆå¤šèŠ±æ—¶é—´ç­‰å¾…æ›´å¥½çš„localityï¼Œæ¯”å¦‚ç­‰å¾…PROCESS_LOCALæˆ–æ˜¯NODE_LOCALï¼›è¦ä¹ˆï¼Œé©¬ä¸Šè°ƒåº¦å‡ºå»ï¼Œä¸è€ƒè™‘localityã€‚å…¶å®å°±æ˜¯è°ƒåº¦å¼€é”€ä¸æ‰§è¡Œæ•ˆç‡çš„å¹³è¡¡ã€‚\n\næˆ‘è§‰å¾—å¯ä»¥ä¸¤æ­¥èµ°ï¼Œç¬¬ä¸€æ­¥å…ˆç”¨â€œä¸‰è¶³é¼ç«‹â€ï¼Œæ¶ˆé™¤CPUã€å†…å­˜ã€æ•°æ®ä¹‹é—´çš„ä¸ä¸€è‡´ï¼Œè€Œå¯¼è‡´çš„CPUåˆ©ç”¨ç‡è¿‡ä½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå…ˆé€šè¿‡ä¸‰è¶³é¼ç«‹ï¼Œä¿è¯è¿™3è€…æ˜¯ä¸€è‡´çš„ã€‚ç„¶åï¼Œå†å»è€ƒè™‘localityçš„å½±å“ã€‚\n\nå› ä¸ºï¼Œå°±ç»éªŒæ¥è¯´ï¼Œlocalityå¯¹äºæ‰§è¡Œæ€§èƒ½æ¥è¯´ï¼Œä½œç”¨ç›¸å¯¹æ¬¡ä¹‹ã€‚è€Œå¯¹äºå¦‚ä½•å¹³è¡¡waitçš„è®¾ç½®ï¼Œå¦ç™½è¯´ï¼Œæˆ‘ä¹Ÿç»™ä¸å‡ºä¸€ä¸ªé‡åŒ–çš„åŠæ³•æˆ–è€…æ˜¯å…¬å¼ï¼Œåªèƒ½æ˜¯case by caseåœ°å»å°è¯•ã€åˆ†æï¼Œæ‰¾åˆ°ä¸€ä¸ªåˆç†çš„ä¸­é—´å€¼~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635425166,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":316495,"user_name":"é™å¿ƒ","can_delete":false,"product_type":"c1","uid":1789481,"ip_address":"","ucode":"B80DE4B5C923D3","user_header":"https://static001.geekbang.org/account/avatar/00/1b/4e/29/adcb78e7.jpg","comment_is_top":false,"comment_ctime":1634355449,"is_pvip":false,"replies":[{"id":"114671","content":"ç¡®å®~<br><br>ä¸è¿‡èµ„æºè¿™å‡ è®²ï¼Œéƒ½åè¿è¡Œæ—¶ä¸€äº›ï¼Œæ¯”è¾ƒéš¾ç”¨ç›´è§‚çš„æ–¹å¼åšæ¼”ç¤ºï¼Œæ›´å¤šçš„æ˜¯ç†è®ºä¸Šçš„æŒ‡å¯¼å’Œæ–¹æ³•è®º~ éœ€è¦å¤§å®¶ç»“åˆæ—¥å¸¸çš„å®æˆ˜ï¼Œå¤šå®è·µã€å¤šåæ€ã€å¤šæ€è€ƒ","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1634534095,"ip_address":"","comment_id":316495,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1634355449","product_id":100073401,"comment_content":"è€å¸ˆï¼Œè¿™ä¸€è®²å¤ªç†è®ºèŒƒäº†ï¼Œèƒ½ä¸èƒ½ä¸¾ä¸€äº›å®é™…çš„ä¾‹å­ï¼Œä¾›å¤§å®¶å­¦ä¹ åŠ æ·±ç†è§£ï¼Œè°¢è°¢è€å¸ˆ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528393,"discussion_content":"ç¡®å®~\n\nä¸è¿‡èµ„æºè¿™å‡ è®²ï¼Œéƒ½åè¿è¡Œæ—¶ä¸€äº›ï¼Œæ¯”è¾ƒéš¾ç”¨ç›´è§‚çš„æ–¹å¼åšæ¼”ç¤ºï¼Œæ›´å¤šçš„æ˜¯ç†è®ºä¸Šçš„æŒ‡å¯¼å’Œæ–¹æ³•è®º~ éœ€è¦å¤§å®¶ç»“åˆæ—¥å¸¸çš„å®æˆ˜ï¼Œå¤šå®è·µã€å¤šåæ€ã€å¤šæ€è€ƒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634534095,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":315007,"user_name":"é™å¿ƒ","can_delete":false,"product_type":"c1","uid":1789481,"ip_address":"","ucode":"B80DE4B5C923D3","user_header":"https://static001.geekbang.org/account/avatar/00/1b/4e/29/adcb78e7.jpg","comment_is_top":false,"comment_ctime":1633656454,"is_pvip":false,"replies":[{"id":"114415","content":"å¥½é—®é¢˜~ Taskå¯¹äºå†…å­˜çš„ç”³è¯·ï¼Œæ˜¯on demandçš„ï¼Œä¹Ÿå°±æ˜¯éšç”¨éšç”³è¯·ï¼Œå¹¶ä¸æ˜¯ä¸€å¼€å§‹å°±ä¸€ä¸‹å­ç»™å®ƒallocate M&#47;2é‚£ä¹ˆå¤§çš„ç©ºé—´ï¼Œæ‰€ä»¥è¯´å¹¶ä¸å­˜åœ¨æµªè´¹çš„é—®é¢˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡è®¾Taskæ‰€éœ€çš„å†…å­˜ï¼Œè¿M&#47;2éƒ½ä¸åˆ°ï¼Œé‚£ä¹ˆSparkæ˜¯ä¸ä¼šå¼ºè¡Œå¡ç»™å®ƒæ›´å¤šå†…å­˜çš„ã€‚<br><br>M&#47;N&#47;2åˆ°M&#47;Nï¼Œè¿™é‡Œçš„é™åˆ¶ï¼Œæ›´å¤šçš„æ˜¯å¤šä¸ªTasksä¹‹é—´å¯¹äºExecutorsä¸­æœ‰é™çš„å†…å­˜å½¢æˆæŠ¢å å…³ç³»çš„æ—¶å€™ï¼ŒSparkä»ç»Ÿè®¡ä¸Šçš„ä¸€ç§é™åˆ¶ï¼Œä¸»è¦æ˜¯ä¸ºäº†ç»´æŒTaskä¹‹é—´å¯¹äºå†…å­˜æ¶ˆè€—ä¸Šçš„ä¸€ç§å…¬å¹³æˆ–è€…è¯´å¹³è¡¡æœºåˆ¶ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1633962733,"ip_address":"","comment_id":315007,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1633656454","product_id":100073401,"comment_content":"è€å¸ˆï¼Œå…³äºexecutoræ¯ä¸ªcoreåˆ†é…åˆ°çš„æ‰§è¡Œå†…å­˜å¤§å°åŒºé—´æ˜¯M&#47;N&#47;2åˆ°M&#47;Nï¼Œé‚£è‹¥åœ¨æŸä¸ªæ—¶åˆ»åªæœ‰ä¸€ä¸ªtaskè°ƒåº¦äº†è¯¥executorï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹ç”³è¯·çš„å†…å­˜å¤§å°è‡³å°‘æ˜¯M&#47;2å—ï¼Œç›¸å½“äºè‡³å°‘ç”³è¯·ä¸€åŠçš„æ‰§è¡Œå†…å­˜ã€‚è‹¥å®é™…ç”¨ä¸åˆ°è¿™ä¹ˆå¤šé‚£ä¸å°±æµªè´¹äº†ã€‚","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527854,"discussion_content":"å¥½é—®é¢˜~ Taskå¯¹äºå†…å­˜çš„ç”³è¯·ï¼Œæ˜¯on demandçš„ï¼Œä¹Ÿå°±æ˜¯éšç”¨éšç”³è¯·ï¼Œå¹¶ä¸æ˜¯ä¸€å¼€å§‹å°±ä¸€ä¸‹å­ç»™å®ƒallocate M/2é‚£ä¹ˆå¤§çš„ç©ºé—´ï¼Œæ‰€ä»¥è¯´å¹¶ä¸å­˜åœ¨æµªè´¹çš„é—®é¢˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡è®¾Taskæ‰€éœ€çš„å†…å­˜ï¼Œè¿M/2éƒ½ä¸åˆ°ï¼Œé‚£ä¹ˆSparkæ˜¯ä¸ä¼šå¼ºè¡Œå¡ç»™å®ƒæ›´å¤šå†…å­˜çš„ã€‚\n\nM/N/2åˆ°M/Nï¼Œè¿™é‡Œçš„é™åˆ¶ï¼Œæ›´å¤šçš„æ˜¯å¤šä¸ªTasksä¹‹é—´å¯¹äºExecutorsä¸­æœ‰é™çš„å†…å­˜å½¢æˆæŠ¢å å…³ç³»çš„æ—¶å€™ï¼ŒSparkä»ç»Ÿè®¡ä¸Šçš„ä¸€ç§é™åˆ¶ï¼Œä¸»è¦æ˜¯ä¸ºäº†ç»´æŒTaskä¹‹é—´å¯¹äºå†…å­˜æ¶ˆè€—ä¸Šçš„ä¸€ç§å…¬å¹³æˆ–è€…è¯´å¹³è¡¡æœºåˆ¶ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633962733,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":315002,"user_name":"é™å¿ƒ","can_delete":false,"product_type":"c1","uid":1789481,"ip_address":"","ucode":"B80DE4B5C923D3","user_header":"https://static001.geekbang.org/account/avatar/00/1b/4e/29/adcb78e7.jpg","comment_is_top":false,"comment_ctime":1633654829,"is_pvip":false,"replies":[{"id":"114464","content":"æˆ‘ä»¬ä¸€ç›´åœ¨æ¨èï¼š<br>D&#47;P ~ ï¼ˆM&#47;N&#47;2ï¼ŒM&#47;Nï¼‰è¿™æ ·ä¸€ä¸ªæœ€å…·é…æ¯”å…¬å¼ï¼Œå…¶ä¸­~çº¿ï¼Œè¡¨ç¤ºå·¦å³ä¸¤è¾¹åœ¨ä¸€ä¸ªæ•°é‡çº§ã€‚<br><br>ä½†è¿™é‡Œæœ‰ä¸ªåœ°æ–¹éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œå°±æ˜¯Taskçš„å†…å­˜åˆ†é…ï¼Œæ˜¯on demandçš„ï¼Œå°±æ˜¯éšç€è®¡ç®—çš„éœ€è¦ï¼Œè€Œä¸æ–­åœ°åˆ†é…å†…å­˜ï¼Œè€Œå†…å­˜çš„ä¸Šä¸‹é™ï¼Œç”±ï¼ˆM&#47;N&#47;2ï¼ŒM&#47;Nï¼‰åˆ’å®šã€‚<br><br>æ‰€ä»¥ï¼Œæ‰§è¡Œå†…å­˜çš„æ¶ˆè€—ï¼Œä¸€å®šæ˜¯è·Ÿæ•°æ®é›†ï¼ˆä»¥åŠå¹¶è¡Œåº¦ï¼‰æœ‰å…³çš„ï¼Œå’ŒMã€Nçš„å…³ç³»å°±æ›´å¤§äº†ã€‚ä¸å¦¨ä»éœ€æ±‚å’Œä¾›ç»™çš„è§’åº¦ï¼Œå»ç†è§£è¿™ä¸ªå…¬å¼ã€‚<br><br>å·¦è¾¹çš„D&#47;Pï¼Œæ˜¯éœ€æ±‚ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªTaskéœ€è¦å¤„ç†çš„æ•°æ®é‡ï¼Œå¯¹åº”ç€çš„ï¼Œå°±æ˜¯å†…å­˜éœ€æ±‚ï¼›<br><br>è€Œå³è¾¹çš„ï¼ˆM&#47;N&#47;2ï¼ŒM&#47;Nï¼‰ï¼Œæ˜¯ç³»ç»Ÿå¯ä»¥æä¾›çš„per Taskçš„å†…å­˜ä¾›ç»™ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç³»ç»Ÿå±‚é¢ï¼Œèµ„æºå±‚é¢ï¼Œèƒ½å¤Ÿç»™æ¯ä¸ªTaskæä¾›å¤šå°‘å†…å­˜èµ„æºã€‚<br><br>éœ€æ±‚ä¸ä¾›ç»™ï¼Œä¸€å®šè¦åŒ¹é…æˆ–è€…è¯´ä¸€è‡´ï¼Œæ‰èƒ½è¾¾åˆ°ä¸€ç§å¹³è¡¡çš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸€ç›´å¼ºè°ƒçš„â€œæ— ç“¶é¢ˆâ€çš„çŠ¶æ€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1634050877,"ip_address":"","comment_id":315002,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1633654829","product_id":100073401,"comment_content":"è€å¸ˆå…³äºcpuçº¿ç¨‹æŒ‚èµ·ï¼Œæè¿°çš„æ˜¯æœ‰cpuèµ„æºè€Œæ²¡æ‰§è¡Œå†…å­˜ä½¿ç”¨è€ŒæŒ‚èµ·çš„æƒ…å†µï¼Œä¸»è¦è¿˜æ˜¯åŠ¨æ€å˜åŒ–çš„Mï¼ˆæ‰§è¡Œå†…å­˜ï¼‰ä¸åŠ¨æ€å˜åŒ–Nï¼ˆå½“å‰ä½¿ç”¨çš„coresï¼‰çš„é—®é¢˜ï¼Œæ–‡ä¸­æåˆ°çº¿ç¨‹ç”³è¯·å†…å­˜çš„å¤§å°ä¹Ÿæ˜¯é€šè¿‡Må’ŒNè®¡ç®—çš„ã€‚ä½†æ–‡ä¸­ä¹Ÿæåˆ°å’Œåˆ†å¸ƒå¼æ•°æ®é›†çš„æ•°æ®åˆ†å¸ƒä¹Ÿæœ‰å…³ç³»ï¼Œè¿™é‡Œæˆ‘ä¸å¤ªç†è§£ï¼Œçº¿ç¨‹å¯ä½¿ç”¨æ‰§è¡Œå†…å­˜å¤§å°æ˜¯é€šè¿‡Må’ŒNè®¡ç®—çš„ï¼Œè¿™å’Œåˆ†å¸ƒå¼æ•°æ®é›†çš„æ•°æ®åˆ†å¸ƒæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527853,"discussion_content":"æˆ‘ä»¬ä¸€ç›´åœ¨æ¨èï¼š\nD/P ~ ï¼ˆM/N/2ï¼ŒM/Nï¼‰è¿™æ ·ä¸€ä¸ªæœ€å…·é…æ¯”å…¬å¼ï¼Œå…¶ä¸­~çº¿ï¼Œè¡¨ç¤ºå·¦å³ä¸¤è¾¹åœ¨ä¸€ä¸ªæ•°é‡çº§ã€‚\n\nä½†è¿™é‡Œæœ‰ä¸ªåœ°æ–¹éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œå°±æ˜¯Taskçš„å†…å­˜åˆ†é…ï¼Œæ˜¯on demandçš„ï¼Œå°±æ˜¯éšç€è®¡ç®—çš„éœ€è¦ï¼Œè€Œä¸æ–­åœ°åˆ†é…å†…å­˜ï¼Œè€Œå†…å­˜çš„ä¸Šä¸‹é™ï¼Œç”±ï¼ˆM/N/2ï¼ŒM/Nï¼‰åˆ’å®šã€‚\n\næ‰€ä»¥ï¼Œæ‰§è¡Œå†…å­˜çš„æ¶ˆè€—ï¼Œä¸€å®šæ˜¯è·Ÿæ•°æ®é›†ï¼ˆä»¥åŠå¹¶è¡Œåº¦ï¼‰æœ‰å…³çš„ï¼Œå’ŒMã€Nçš„å…³ç³»å°±æ›´å¤§äº†ã€‚ä¸å¦¨ä»éœ€æ±‚å’Œä¾›ç»™çš„è§’åº¦ï¼Œå»ç†è§£è¿™ä¸ªå…¬å¼ã€‚\n\nå·¦è¾¹çš„D/Pï¼Œæ˜¯éœ€æ±‚ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªTaskéœ€è¦å¤„ç†çš„æ•°æ®é‡ï¼Œå¯¹åº”ç€çš„ï¼Œå°±æ˜¯å†…å­˜éœ€æ±‚ï¼›\n\nè€Œå³è¾¹çš„ï¼ˆM/N/2ï¼ŒM/Nï¼‰ï¼Œæ˜¯ç³»ç»Ÿå¯ä»¥æä¾›çš„per Taskçš„å†…å­˜ä¾›ç»™ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç³»ç»Ÿå±‚é¢ï¼Œèµ„æºå±‚é¢ï¼Œèƒ½å¤Ÿç»™æ¯ä¸ªTaskæä¾›å¤šå°‘å†…å­˜èµ„æºã€‚\n\néœ€æ±‚ä¸ä¾›ç»™ï¼Œä¸€å®šè¦åŒ¹é…æˆ–è€…è¯´ä¸€è‡´ï¼Œæ‰èƒ½è¾¾åˆ°ä¸€ç§å¹³è¡¡çš„çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸€ç›´å¼ºè°ƒçš„â€œæ— ç“¶é¢ˆâ€çš„çŠ¶æ€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634050877,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1947809,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/b8/a1/019574ad.jpg","nickname":"æ¾èŠ±é…¿é…’ï¼Œæ˜¥æ°´ç…èŒ¶","note":"","ucode":"843A6AB55FCF99","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580715,"discussion_content":"D/P ~ ï¼ˆM/N/2ï¼ŒM/Nï¼‰å¯¹è¿™ä¸ªå…¬å¼è¿˜æ˜¯æœ‰ç‚¹å›°æƒ‘ï¼Œå‡å¦‚æˆ‘çš„ä»»åŠ¡æ˜¯Aè¡¨Join Bè¡¨ï¼Œé‚£ä¹ˆæˆ‘çš„Dæ˜¯ä»¥Aè¡¨çš„æ•°æ®é‡ä¸ºå‡†ï¼Œè¿˜æ˜¯ä»¥Bè¡¨çš„æ•°æ®é‡ä¸ºå‡†å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658333984,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":309461,"user_name":"Sean","can_delete":false,"product_type":"c1","uid":2162751,"ip_address":"","ucode":"69234046BFD81B","user_header":"https://static001.geekbang.org/account/avatar/00/21/00/3f/a0f84788.jpg","comment_is_top":false,"comment_ctime":1630146380,"is_pvip":false,"replies":[{"id":"112653","content":"D&#47;P =&gt; (M&#47;N&#47;2,M&#47;N) ï¼š<br> (6&#47;4&#47;2 ,6&#47;4)ï¼Œè¿™é‡Œæ²¡æœ‰--num-executors 80ä»€ä¹ˆäº‹ï¼Œè¿™ä¸ªå…¬å¼æ˜¯per executoræ¥è®¡ç®—çš„ï¼Œä¸èƒ½æŠŠexecutorsä¸ªæ•°éƒ½åŠ ä¸Šï¼Œå»ºè®®å†è¯»è¯»åŸæ–‡å“ˆ~<br><br>è€Œä¸”ï¼Œå®é™…ä¸Šè¿™é‡Œä¹Ÿä¸èƒ½æŒ‰6gæ¥ç®—ï¼Œåº”è¯¥æ˜¯Storage + Executionä¸¤éƒ¨åˆ†å†…å­˜æ‰å¯¹ï¼Œå…·ä½“ç®—æ³•ï¼Œä½ å¯ä»¥å†çœ‹çœ‹æ–‡ç¨¿~ 6gæ˜¯æ‰€æœ‰çš„å†…å­˜ï¼Œæ˜¯Reserved + User + Storage + Executionã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1630940278,"ip_address":"","comment_id":309461,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1630146380","product_id":100073401,"comment_content":"è€å¸ˆæåˆ°çš„ä»åˆ†ç‰‡å¤§å°200Måæ¨,æ¥é…ç½®spark.sql.shuffle.partitions,spark.executor.memory,spark.executor.coreså‚æ•°,ä¸çŸ¥é“ç†è§£çš„å¯¹ä¸å¯¹,åœ¨ä¸è€ƒè™‘æ•°æ®å‹ç¼©çš„æƒ…å†µä¸‹,æ¯”å¦‚æœ‰1Tçš„æ•°æ®,é‚£ä¹ˆæŒ‰200åˆ†ç‰‡è€ƒè™‘,æœ€ä½³å¹¶è¡Œåº¦è®¡ç®—æŒ‰1048576M&#47;200Mâ‰ˆ5243è®¡ç®—å—,set spark.sql.shuffle.partitions=5243,å¥½åƒè¿˜æ²¡æœ‰getåˆ°è¿™ä¸ªèµ„æºè®¡ç®—å…¬å¼çš„åº”ç”¨,<br>æˆ‘ç»“åˆè¿™å‡ ä¸ªé…ç½®æ¨å¯¼æ–¹å¼å¦‚ä¸‹:--executor-cores 4  --executor-memory 6g  --num-executors 80<br>D&#47;P =&gt; (M&#47;N&#47;2,M&#47;N) =&gt; (6*80&#47;4&#47;2,6*80&#47;4) =&gt; (60G,120G) è¿™ä¸ªé…ç½®æ˜¾ç„¶ä¸åˆé€‚,ä¿®æ”¹ä¸€ä¸‹å‚æ•°--executor-cores 1500 å¾—åˆ°:<br>D&#47;P =&gt; (M&#47;N&#47;2,M&#47;N) =&gt; (6*80&#47;1500&#47;2,6*80&#47;1500) =&gt; (164M,327M) çœ‹ç€è¿™ä¸ªé…ç½®ç®—æ˜¯åˆç†çš„åˆ©ç”¨cpuå—<br>æ ¹æ®è¿™ä¸ªé…ç½®å¾—åˆ°çš„åŒºé—´åœ¨ç»§ç»­æ¨å¯¼:<br>å¦‚æœæ•°æ®æ€»é‡D=1Tâ‰ˆ1048576M,é‚£å¹¶è¡Œåº¦P:spark.sql.shuffle.partitionsçš„å¤§å°åœ¨è¿™(1048576&#47;164,1048576&#47;327)=&gt;(6394,3207)åŒºé—´,æ„Ÿè§‰è¿™ä¸ªå¹¶è¡Œåº¦å¥½åƒå¤ªå¤§,ä¹Ÿä¸æ˜¯å¾ˆåˆç†,ä¸çŸ¥é“æˆ‘ç†è§£çš„å¯¹ä¸å¯¹","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525882,"discussion_content":"D/P =&amp;gt; (M/N/2,M/N) ï¼š\n (6/4/2 ,6/4)ï¼Œè¿™é‡Œæ²¡æœ‰--num-executors 80ä»€ä¹ˆäº‹ï¼Œè¿™ä¸ªå…¬å¼æ˜¯per executoræ¥è®¡ç®—çš„ï¼Œä¸èƒ½æŠŠexecutorsä¸ªæ•°éƒ½åŠ ä¸Šï¼Œå»ºè®®å†è¯»è¯»åŸæ–‡å“ˆ~\n\nè€Œä¸”ï¼Œå®é™…ä¸Šè¿™é‡Œä¹Ÿä¸èƒ½æŒ‰6gæ¥ç®—ï¼Œåº”è¯¥æ˜¯Storage + Executionä¸¤éƒ¨åˆ†å†…å­˜æ‰å¯¹ï¼Œå…·ä½“ç®—æ³•ï¼Œä½ å¯ä»¥å†çœ‹çœ‹æ–‡ç¨¿~ 6gæ˜¯æ‰€æœ‰çš„å†…å­˜ï¼Œæ˜¯Reserved + User + Storage + Executionã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630940278,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":299629,"user_name":"ä½•è¥¿ä¸œ","can_delete":false,"product_type":"c1","uid":1394628,"ip_address":"","ucode":"70A75C12DEC34B","user_header":"https://static001.geekbang.org/account/avatar/00/15/47/c4/c070afcf.jpg","comment_is_top":false,"comment_ctime":1624767885,"is_pvip":false,"replies":[{"id":"108791","content":"200Mæ˜¯ä¸ªç»éªŒä¹‹è°ˆå“ˆï¼Œåœ¨ä¹‹å‰ç¢°åˆ°çš„å¤§å¤šæ•°çš„è®¡ç®—åœºæ™¯é‡Œï¼Œ200Méƒ½æ˜¯ä¸ªä¸é”™çš„èµ·ç‚¹ï¼Œèƒ½å¤Ÿæ¯”è¾ƒå¥½åœ°å¹³è¡¡ä¸‰è¶³é¼ç«‹é‡Œé¢æ¶‰åŠçš„ï¼šæ•°æ®ã€CPUä¸å†…å­˜ã€‚<br><br>å…¶å®200Mç®—æ˜¯ä¸€ç§å·æ‡’çš„åšæ³•ï¼Œå°±æ˜¯è·³è¿‡â€œä¸‰è¶³é¼ç«‹â€çš„å¤æ‚è®¡ç®—ï¼Œè·³è¿‡æ–‡ä¸­ä»‹ç»çš„è®¡ç®—å…¬å¼ï¼Œå¿«é€Ÿè¿›è¡Œé…ç½®çš„ä¸€ç§æ–¹æ³•ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1624955123,"ip_address":"","comment_id":299629,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1624767885","product_id":100073401,"comment_content":"è€å¸ˆ,200mçš„ä¾æ®æ˜¯é˜²æ­¢ä»»åŠ¡è°ƒåº¦æ»åè€Œå¯¼è‡´çº¿ç¨‹æŒ‚èµ·å—","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522489,"discussion_content":"200Mæ˜¯ä¸ªç»éªŒä¹‹è°ˆå“ˆï¼Œåœ¨ä¹‹å‰ç¢°åˆ°çš„å¤§å¤šæ•°çš„è®¡ç®—åœºæ™¯é‡Œï¼Œ200Méƒ½æ˜¯ä¸ªä¸é”™çš„èµ·ç‚¹ï¼Œèƒ½å¤Ÿæ¯”è¾ƒå¥½åœ°å¹³è¡¡ä¸‰è¶³é¼ç«‹é‡Œé¢æ¶‰åŠçš„ï¼šæ•°æ®ã€CPUä¸å†…å­˜ã€‚\n\nå…¶å®200Mç®—æ˜¯ä¸€ç§å·æ‡’çš„åšæ³•ï¼Œå°±æ˜¯è·³è¿‡â€œä¸‰è¶³é¼ç«‹â€çš„å¤æ‚è®¡ç®—ï¼Œè·³è¿‡æ–‡ä¸­ä»‹ç»çš„è®¡ç®—å…¬å¼ï¼Œå¿«é€Ÿè¿›è¡Œé…ç½®çš„ä¸€ç§æ–¹æ³•ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624955123,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":297655,"user_name":"æ…¢æ…¢å¢","can_delete":false,"product_type":"c1","uid":1329566,"ip_address":"","ucode":"853D399100D83B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/IcDlyK6DaBrssVGlmosXnahdJ4bwCesjXa98iaapSDozBiagZTqSCok6iaktu2wOibvpNv9Pd6nfwMg7N7KTSTzYRw/132","comment_is_top":false,"comment_ctime":1623710521,"is_pvip":false,"replies":[{"id":"108105","content":"è¿™ä¸ªå¯ä»¥å‚è€ƒæœ¬ç« çš„â€œä¸‰è¶³é¼ç«‹â€å“ˆ~ ä¸‰è¶³é¼ç«‹å…¶å®å¯ä»¥éå¸¸çµæ´»ï¼Œå¹¶è¡Œåº¦ã€å¹¶å‘åº¦ä¸æ‰§è¡Œå†…å­˜ä¸‰è€…ä¹‹é—´ç›¸äº’ç‰µè¿ã€ç›¸äº’é’³åˆ¶ã€‚å½“å…¶ä¸­ä¸€ä¸ªå› ç´ å—é™æ—¶ï¼Œå…¶ä»–ä¸¤ä¸ªå› ç´ å¯ä»¥ç›¸åº”åœ°åšè°ƒæ•´ã€åšé€‚é…ï¼Œä»è€Œè¾¾åˆ°ä¸€ç§å¹³è¡¡çš„çŠ¶æ€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1623748381,"ip_address":"","comment_id":297655,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1623710521","product_id":100073401,"comment_content":"è€å¸ˆèƒ½è®²ä¸€è®²spark.executor.coreçš„é…ç½®åŸåˆ™å—","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521895,"discussion_content":"è¿™ä¸ªå¯ä»¥å‚è€ƒæœ¬ç« çš„â€œä¸‰è¶³é¼ç«‹â€å“ˆ~ ä¸‰è¶³é¼ç«‹å…¶å®å¯ä»¥éå¸¸çµæ´»ï¼Œå¹¶è¡Œåº¦ã€å¹¶å‘åº¦ä¸æ‰§è¡Œå†…å­˜ä¸‰è€…ä¹‹é—´ç›¸äº’ç‰µè¿ã€ç›¸äº’é’³åˆ¶ã€‚å½“å…¶ä¸­ä¸€ä¸ªå› ç´ å—é™æ—¶ï¼Œå…¶ä»–ä¸¤ä¸ªå› ç´ å¯ä»¥ç›¸åº”åœ°åšè°ƒæ•´ã€åšé€‚é…ï¼Œä»è€Œè¾¾åˆ°ä¸€ç§å¹³è¡¡çš„çŠ¶æ€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623748381,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":294972,"user_name":"æ–¯ç›–ä¸¸","can_delete":false,"product_type":"c1","uid":1168504,"ip_address":"","ucode":"B881D14B028F14","user_header":"https://static001.geekbang.org/account/avatar/00/11/d4/78/66b3f2a2.jpg","comment_is_top":false,"comment_ctime":1622168691,"is_pvip":false,"replies":[{"id":"107202","content":"å¥½é—®é¢˜ï¼Œè¿™ä¸ªå…¬å¼çš„ä½œç”¨å…¶å®æ˜¯åŒå‘çš„ï¼Œä¹Ÿå³æ˜¯ç»™å®šèµ„æºï¼Œä½ å¯ä»¥ç®—å‡ºå¹¶è¡Œåº¦ï¼›åè¿‡æ¥ï¼Œæ‰¾åˆ°åˆé€‚çš„å¹¶è¡Œåº¦ï¼Œä½ ä¹Ÿå¯ä»¥æŒ‡å¯¼Sparké›†ç¾¤èµ„æºçš„è®¾å®šã€‚<br><br>ä½ è¯´çš„æ²¡é”™ï¼Œ2GBçš„åˆ†ç‰‡ï¼Œç¡®å®å¤ªå¤§äº†ï¼Œé€šå¸¸æ¥è¯´ï¼Œåˆ†ç‰‡å¤§å°åœ¨200MBå·¦å³ï¼Œæ˜¯æ¯”è¾ƒåˆé€‚çš„ï¼Œæ¨èæŠŠåˆ†ç‰‡å¤§å°è®¾å®šåœ¨è¿™ä¸ªèŒƒå›´ã€‚<br><br>æœ‰äº†åˆ†ç‰‡å¤§å°ï¼Œå…¶å®å°±å¯ä»¥åå‘æŒ‡å¯¼Sparkèµ„æºè®¾å®šäº†ã€‚åœ¨ä½ çš„ä¾‹å­é‡Œé¢ï¼Œæˆ‘ç†è§£èµ„æºæ˜¯æå‰è®¾å®šå¥½äº†ï¼Œä¹Ÿå°±æ˜¯ä½ è¯´çš„å †å†…å¤–åˆ†åˆ«9Gï¼Œ5ä¸ªcoresï¼Œä¹Ÿè®¸è¿™ä¸ªè®¾å®šæ˜¯åŸºäºç»éªŒã€ä¹Ÿè®¸æ˜¯å‡ºäºç›´è§‰ã€‚<br><br>å¦‚æœç”¨200MBåˆ†ç‰‡å¤§å°åæ¨è¿‡æ¥çš„è¯ï¼Œå…¶å®ä½ å¯ä»¥è€ƒè™‘é™ä½Executorsçš„å†…å­˜é…ç½®ï¼Œæˆ–æ˜¯æé«˜å®ƒçš„CPU coresé…ç½®ï¼Œè¿™æ ·æŠŠå†…å­˜ä¸CPUåšåˆ°ä¸€ä¸ªå‡è¡¡é…æ¯”ï¼Œç›¸æ¯”ç°åœ¨ä¸€ä¸ªtaskè¦å¤„ç†2GBçš„æ•°æ®ï¼Œæ•ˆæœè¦æ›´å¥½~<br><br>æ¯•ç«Ÿå’±ä»¬æ€§èƒ½è°ƒä¼˜çš„æœ¬è´¨ï¼Œæ˜¯è®©ç¡¬ä»¶èµ„æºä¹‹é—´å°½é‡å»å¹³è¡¡ï¼Œè°ƒèŠ‚å¹¶è¡Œåº¦ä¹Ÿå¥½ã€åˆ†ç‰‡å¤§å°ä¹Ÿå¥½ã€å„ç§èµ„æºå‚æ•°ä¹Ÿå¥½ï¼Œå®é™…ä¸Šéƒ½æ˜¯æ‰‹æ®µã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1622390292,"ip_address":"","comment_id":294972,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1622168691","product_id":100073401,"comment_content":"è€å¸ˆï¼Œé¡ºç€ç‹å¤©é›¨åŒå­¦çš„é—®é¢˜æˆ‘æ¥ç€é—®ã€‚æˆ‘çš„executor memoryä¸º9Gï¼Œexecutorçš„off heap memoryä¹Ÿä¸º9Gï¼Œexecutor coresä¸º5ä¸ªï¼Œexecutor instancesä¸º30ä¸ªã€‚<br>ä»¥ä¸Šæ˜¯æˆ‘çš„é…ç½®ã€‚<br>ç…§æ‚¨çš„å…¬å¼ï¼Œæˆ‘çš„æ•°æ®åˆ†ç‰‡çš„å¤§å°å°±åº”è¯¥åœ¨(9G+9G)&#47;5&#47;2=1.8Gåˆ°(9G+9G)&#47;5=3.6ï¼Œå³æ•°æ®åˆ†ç‰‡åœ¨ï¼ˆ1.8Gï¼Œ3.6Gï¼‰çš„èŒƒå›´å†…å—ï¼Œé‚£è¿›ä¸€æ­¥è¯´ï¼Œæˆ‘åœ¨Spark UIé‡Œï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªè¯»å–parquetçš„ä»»åŠ¡ï¼Œçœ‹shuffle read sizeè¿™ä¸ªæŒ‡æ ‡ï¼Œå¦‚æœåœ¨ï¼ˆ1.8Gï¼Œ3.6Gï¼‰è¿™ä¸ªåŒºé—´ä¹‹å†…ï¼Œè¯´æ˜å°±æ˜¯å¯ä»¥çš„ï¼Œæ˜¯è¿™æ ·å—?<br><br>æ„Ÿè§‰è¿™ä¸ªåˆ†ç‰‡å¥½å¤§å“¦~~","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520899,"discussion_content":"å¥½é—®é¢˜ï¼Œè¿™ä¸ªå…¬å¼çš„ä½œç”¨å…¶å®æ˜¯åŒå‘çš„ï¼Œä¹Ÿå³æ˜¯ç»™å®šèµ„æºï¼Œä½ å¯ä»¥ç®—å‡ºå¹¶è¡Œåº¦ï¼›åè¿‡æ¥ï¼Œæ‰¾åˆ°åˆé€‚çš„å¹¶è¡Œåº¦ï¼Œä½ ä¹Ÿå¯ä»¥æŒ‡å¯¼Sparké›†ç¾¤èµ„æºçš„è®¾å®šã€‚\n\nä½ è¯´çš„æ²¡é”™ï¼Œ2GBçš„åˆ†ç‰‡ï¼Œç¡®å®å¤ªå¤§äº†ï¼Œé€šå¸¸æ¥è¯´ï¼Œåˆ†ç‰‡å¤§å°åœ¨200MBå·¦å³ï¼Œæ˜¯æ¯”è¾ƒåˆé€‚çš„ï¼Œæ¨èæŠŠåˆ†ç‰‡å¤§å°è®¾å®šåœ¨è¿™ä¸ªèŒƒå›´ã€‚\n\næœ‰äº†åˆ†ç‰‡å¤§å°ï¼Œå…¶å®å°±å¯ä»¥åå‘æŒ‡å¯¼Sparkèµ„æºè®¾å®šäº†ã€‚åœ¨ä½ çš„ä¾‹å­é‡Œé¢ï¼Œæˆ‘ç†è§£èµ„æºæ˜¯æå‰è®¾å®šå¥½äº†ï¼Œä¹Ÿå°±æ˜¯ä½ è¯´çš„å †å†…å¤–åˆ†åˆ«9Gï¼Œ5ä¸ªcoresï¼Œä¹Ÿè®¸è¿™ä¸ªè®¾å®šæ˜¯åŸºäºç»éªŒã€ä¹Ÿè®¸æ˜¯å‡ºäºç›´è§‰ã€‚\n\nå¦‚æœç”¨200MBåˆ†ç‰‡å¤§å°åæ¨è¿‡æ¥çš„è¯ï¼Œå…¶å®ä½ å¯ä»¥è€ƒè™‘é™ä½Executorsçš„å†…å­˜é…ç½®ï¼Œæˆ–æ˜¯æé«˜å®ƒçš„CPU coresé…ç½®ï¼Œè¿™æ ·æŠŠå†…å­˜ä¸CPUåšåˆ°ä¸€ä¸ªå‡è¡¡é…æ¯”ï¼Œç›¸æ¯”ç°åœ¨ä¸€ä¸ªtaskè¦å¤„ç†2GBçš„æ•°æ®ï¼Œæ•ˆæœè¦æ›´å¥½~\n\næ¯•ç«Ÿå’±ä»¬æ€§èƒ½è°ƒä¼˜çš„æœ¬è´¨ï¼Œæ˜¯è®©ç¡¬ä»¶èµ„æºä¹‹é—´å°½é‡å»å¹³è¡¡ï¼Œè°ƒèŠ‚å¹¶è¡Œåº¦ä¹Ÿå¥½ã€åˆ†ç‰‡å¤§å°ä¹Ÿå¥½ã€å„ç§èµ„æºå‚æ•°ä¹Ÿå¥½ï¼Œå®é™…ä¸Šéƒ½æ˜¯æ‰‹æ®µã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1622390292,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1943439,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/a7/8f/0d8e6d34.jpg","nickname":"é™ˆå­","note":"","ucode":"CDC23530B6235A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":399352,"discussion_content":"å‡è®¾æ–¯ç›–ä¸¸åŒå­¦ executor core çš„æ•°é‡æé«˜åˆ° 10ï¼Œä½†æ˜¯ç‰©ç†æœºå™¨çš„ core ä¾ç„¶æ˜¯ 5ï¼Œåœ¨å•ä½æ—¶é—´é‡Œ executor å†…åŒæ—¶å¹¶è¡Œçš„çº¿ç¨‹ä¾ç„¶æ˜¯ 5 ä¸ªï¼Œè¿™æ ·çš„è°ƒæ•´åªèƒ½èµ·åˆ°åŠ å¤§ executor å¹¶å‘èƒ½åŠ›çš„ä½œç”¨ï¼Œåœ¨æ•´ä½“ä¸Šè®©æ¯ä¸ª task çš„å¤„ç†æ—¶é—´å˜çŸ­ï¼Œtask æ‰§è¡Œçš„æ•°é‡å˜å¤šå¯¹å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632936651,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1172778,"avatar":"https://static001.geekbang.org/account/avatar/00/11/e5/2a/738f90d7.jpg","nickname":"Virgil é˜¿åŸ","note":"","ucode":"308AA431057EC7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378769,"discussion_content":"è€å¸ˆï¼Œèƒ½ç»™ä¸€ä¸ªå…·ä½“çš„åæ¨æ¡ˆä¾‹å—ï¼Ÿ\nè§‰å¾—è¯¾ç¨‹è®²çš„å¾ˆå¥½ï¼Œä½†ä½œä¸ºä¸€åå°ç™½ï¼ŒshuffleæŠ¥é”™çš„è¯¦ç»†åé¦ˆè¿‡ç¨‹ï¼Œè§£å†³æ­¥éª¤ï¼Œè¿˜æ˜¯æ²¡æ˜ç™½ï¼ˆè‹¦ç¬‘ï¼‰ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623396576,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":293194,"user_name":"Geek","can_delete":false,"product_type":"c1","uid":2532766,"ip_address":"","ucode":"52E93A8CEEAFC3","user_header":"https://static001.geekbang.org/account/avatar/00/26/a5/9e/19871ffb.jpg","comment_is_top":false,"comment_ctime":1621260689,"is_pvip":false,"replies":[{"id":"106296","content":"å¥½é—®é¢˜~<br><br>æˆ‘ä»¬å…ˆè¯´ç¬¬äºŒä¸ªé—®é¢˜ï¼ŒSparkè€ƒè™‘çš„ï¼Œä¸æ˜¯æ•°æ®åœ¨ç£ç›˜ä¸­çš„å­˜å‚¨å¤§å°ï¼Œæ˜¯å†…å­˜ä¸­çš„å­˜å‚¨å¤§å°ï¼Œæ‰€ä»¥æ°æ°æ˜¯Parquet+Snappyè§£å‹åã€åœ¨å†…å­˜ä¸­çš„å­˜å‚¨å¤§å°~<br><br>å†æ¥è¯´ç¬¬ä¸€ä¸ªï¼Œæºæ–‡ä»¶é€šå¸¸æŒ‡çš„æ˜¯ç£ç›˜ä¸­çš„æ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿè¦è®¡ç®—å®ƒåŠ è½½è¿›å†…å­˜çš„å­˜å‚¨å¤§å°ã€‚ç°åœ¨å‡è®¾åŠ è½½è¿›å†…å­˜çš„å¤§å°æ˜¯Xï¼Œå®ƒæ¯”M&#47;Nå¤§ã€‚è¿™ä¸ªæ—¶å€™ï¼Œé€šå¸¸æ¥è¯´ï¼ŒSparkå¹¶ä¸ä¼šç«‹å³å†…å­˜æº¢å‡ºOOMï¼Œå› ä¸ºå®ƒæœ‰Spillæœºåˆ¶åšä¿æŠ¤ï¼Œè¿™éƒ¨åˆ†ç»†èŠ‚å¯ä»¥å‚è€ƒShuffleåŸç†é‚£ä¸€è®²ã€‚Spillæœºåˆ¶ä¿è¯åœ¨Taskå†…å­˜ä¸è¶³çš„æƒ…å†µä¸‹ï¼ŒæŠŠå†…å­˜ä¸­çš„æ•°æ®æ’åºå¹¶æº¢å‡ºåˆ°ä¸´æ—¶æ–‡ä»¶ï¼Œå› æ­¤ï¼Œå½“Xç¨å¤§äºM&#47;Nçš„æƒ…å†µä¸‹ï¼ŒSparkçš„Spillæœºåˆ¶å¯ä»¥é¿å…OOMçš„å‘ç”Ÿã€‚<br><br>ä½†æ˜¯ï¼Œå½“æŸä¸ªTaskçš„Xè¿œå¤§äºM&#47;Nï¼Œæˆ–æ˜¯æ‰€æœ‰çš„Taskçš„Xéƒ½è¶…è¿‡äº†M&#47;Nï¼Œè¿™ä¸ªæ—¶å€™ï¼ŒOOMçš„æ¦‚ç‡ä¼šé™¡ç„¶ä¸Šå‡ã€‚<br><br>ä¸ºäº†æœ‰æ•ˆé™ä½OOMçš„æ¦‚ç‡å’Œå¯èƒ½ï¼ŒåŒæ—¶ä¸ºäº†å™è¿°æ–¹ä¾¿ï¼Œæˆ‘ä»¬åœ¨æ–‡ä¸­å»ºè®®å¤§å®¶æŠŠXæ§åˆ¶åœ¨[M&#47;N&#47;2ï¼ŒM&#47;N]ä¹‹é—´ã€‚è¿™ä¹ˆåšåˆ°ç›®çš„æœ‰å‡ ä¸ªï¼š<br>1ï¼‰ä¸€ä¸ªæ˜¯æå‡CPUåˆ©ç”¨ç‡<br>2ï¼‰ä¸€ä¸ªæ˜¯æå‡å†…å­˜åˆ©ç”¨ç‡<br>3ï¼‰å†æœ‰ä¸€ä¸ªï¼Œå°±æ˜¯æœ‰æ•ˆé¿å…OOM","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1621422006,"ip_address":"","comment_id":293194,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1621260689","product_id":100073401,"comment_content":"å´è€å¸ˆ è¯·æ•™2ä¸ªé—®é¢˜å“ˆ<br>1ã€å½“ä¸€ä¸ªæºæ–‡ä»¶çš„å¤§å°è¶…è¿‡äº†M&#47;N çš„å†…å­˜æ—¶ï¼Œè¿™ç§æƒ…å†µæ˜¯ä¸æ˜¯ä¼šæŠ¥OOMï¼Ÿ<br>2ã€sparkåœ¨åŠ è½½parquet+snappyå‹ç¼©æ–‡ä»¶æ—¶ï¼Œå®ƒä¼šè€ƒè™‘è§£å‹ä¹‹åçš„æ–‡ä»¶å¤§å°å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":520109,"discussion_content":"å¥½é—®é¢˜~\n\næˆ‘ä»¬å…ˆè¯´ç¬¬äºŒä¸ªé—®é¢˜ï¼ŒSparkè€ƒè™‘çš„ï¼Œä¸æ˜¯æ•°æ®åœ¨ç£ç›˜ä¸­çš„å­˜å‚¨å¤§å°ï¼Œæ˜¯å†…å­˜ä¸­çš„å­˜å‚¨å¤§å°ï¼Œæ‰€ä»¥æ°æ°æ˜¯Parquet+Snappyè§£å‹åã€åœ¨å†…å­˜ä¸­çš„å­˜å‚¨å¤§å°~\n\nå†æ¥è¯´ç¬¬ä¸€ä¸ªï¼Œæºæ–‡ä»¶é€šå¸¸æŒ‡çš„æ˜¯ç£ç›˜ä¸­çš„æ–‡ä»¶ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿè¦è®¡ç®—å®ƒåŠ è½½è¿›å†…å­˜çš„å­˜å‚¨å¤§å°ã€‚ç°åœ¨å‡è®¾åŠ è½½è¿›å†…å­˜çš„å¤§å°æ˜¯Xï¼Œå®ƒæ¯”M/Nå¤§ã€‚è¿™ä¸ªæ—¶å€™ï¼Œé€šå¸¸æ¥è¯´ï¼ŒSparkå¹¶ä¸ä¼šç«‹å³å†…å­˜æº¢å‡ºOOMï¼Œå› ä¸ºå®ƒæœ‰Spillæœºåˆ¶åšä¿æŠ¤ï¼Œè¿™éƒ¨åˆ†ç»†èŠ‚å¯ä»¥å‚è€ƒShuffleåŸç†é‚£ä¸€è®²ã€‚Spillæœºåˆ¶ä¿è¯åœ¨Taskå†…å­˜ä¸è¶³çš„æƒ…å†µä¸‹ï¼ŒæŠŠå†…å­˜ä¸­çš„æ•°æ®æ’åºå¹¶æº¢å‡ºåˆ°ä¸´æ—¶æ–‡ä»¶ï¼Œå› æ­¤ï¼Œå½“Xç¨å¤§äºM/Nçš„æƒ…å†µä¸‹ï¼ŒSparkçš„Spillæœºåˆ¶å¯ä»¥é¿å…OOMçš„å‘ç”Ÿã€‚\n\nä½†æ˜¯ï¼Œå½“æŸä¸ªTaskçš„Xè¿œå¤§äºM/Nï¼Œæˆ–æ˜¯æ‰€æœ‰çš„Taskçš„Xéƒ½è¶…è¿‡äº†M/Nï¼Œè¿™ä¸ªæ—¶å€™ï¼ŒOOMçš„æ¦‚ç‡ä¼šé™¡ç„¶ä¸Šå‡ã€‚\n\nä¸ºäº†æœ‰æ•ˆé™ä½OOMçš„æ¦‚ç‡å’Œå¯èƒ½ï¼ŒåŒæ—¶ä¸ºäº†å™è¿°æ–¹ä¾¿ï¼Œæˆ‘ä»¬åœ¨æ–‡ä¸­å»ºè®®å¤§å®¶æŠŠXæ§åˆ¶åœ¨[M/N/2ï¼ŒM/N]ä¹‹é—´ã€‚è¿™ä¹ˆåšåˆ°ç›®çš„æœ‰å‡ ä¸ªï¼š\n1ï¼‰ä¸€ä¸ªæ˜¯æå‡CPUåˆ©ç”¨ç‡\n2ï¼‰ä¸€ä¸ªæ˜¯æå‡å†…å­˜åˆ©ç”¨ç‡\n3ï¼‰å†æœ‰ä¸€ä¸ªï¼Œå°±æ˜¯æœ‰æ•ˆé¿å…OOM","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621422006,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2635387,"avatar":"https://static001.geekbang.org/account/avatar/00/28/36/7b/b06aad84.jpg","nickname":"ç©º","note":"","ucode":"01F63669AE814A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378190,"discussion_content":"è€å¸ˆshuffle spilæœ‰æº¢å‡ºåˆ°å†…å­˜æœ‰æº¢å‡ºåˆ°ç£ç›˜ï¼Œè¿™é‡Œæ˜¯æŒ‡å“ªä¸ªå‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623082484,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291897,"user_name":"Geek_81beba","can_delete":false,"product_type":"c1","uid":2540707,"ip_address":"","ucode":"FCED45C338D00F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJt9RvLXn5KxqNiccCyxRGy0IDHdqOOiazoH7aqku4GlELB4guibOGibEqPF740iaNwKoe6BjicgmgjR6Vw/132","comment_is_top":false,"comment_ctime":1620576329,"is_pvip":false,"replies":[{"id":"105710","content":"é»˜è®¤å¹¶è¡Œåº¦æˆ‘ç†è§£ä½ è¯´çš„æ˜¯ä¸‹é¢è¿™ä¸¤ä¸ªå‚æ•°ï¼š<br>spark.default.parallelism<br>spark.sql.shuffle.partitions<br><br>ä¸çŸ¥é“ä½ è¯´çš„shuffle partitionsæŒ‡çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620624987,"ip_address":"","comment_id":291897,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1620576329","product_id":100073401,"comment_content":"é»˜è®¤å¹¶è¡Œåº¦å’Œshuffle partitionså“ªä¸ªæ›´ä¼˜å…ˆå‘¢","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519597,"discussion_content":"é»˜è®¤å¹¶è¡Œåº¦æˆ‘ç†è§£ä½ è¯´çš„æ˜¯ä¸‹é¢è¿™ä¸¤ä¸ªå‚æ•°ï¼š\nspark.default.parallelism\nspark.sql.shuffle.partitions\n\nä¸çŸ¥é“ä½ è¯´çš„shuffle partitionsæŒ‡çš„æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620624987,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291235,"user_name":"aof","can_delete":false,"product_type":"c1","uid":1062864,"ip_address":"","ucode":"5815D63C4926BC","user_header":"https://static001.geekbang.org/account/avatar/00/10/37/d0/26975fba.jpg","comment_is_top":false,"comment_ctime":1620133814,"is_pvip":false,"replies":[{"id":"105747","content":"æ²¡é”™ï¼Œè€å¼Ÿä»£ç çœ‹çš„å¾ˆç»†è‡´~ ","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1620658720,"ip_address":"","comment_id":291235,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1620133814","product_id":100073401,"comment_content":"æ¯ä¸ªçº¿ç¨‹ç”³è¯·æ‰§è¡Œå†…å­˜çš„æ—¶å€™éƒ½ä¼šè·Ÿæ‰€è¯·æ±‚çš„å†…å­˜å¤§å°è¿›è¡Œæ¯”è¾ƒã€‚ä¸ºä¸€ä¸ªå†…å­˜æ¶ˆè´¹è€…ï¼ˆMemoryConsumerï¼‰ç”³è¯·æ‰§è¡Œå†…å­˜çš„å…·ä½“å®ç°é€»è¾‘åœ¨TaskMemoryManager#acquireExecutionMemory()æ–¹æ³•ä¸­ï¼Œè¿™ä¸ªæ–¹æ³•ä¸ºå†…å­˜æ¶ˆè´¹è€…ï¼ˆconsumerï¼‰ç”³è¯·æŒ‡å®šå¤§å°çš„å†…å­˜ç©ºé—´ï¼Œå¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ï¼Œå°†ä¼šå¯¹consumerè¿›è¡Œspill()æ¥é‡Šæ”¾æ›´å¤šå†…å­˜ï¼Œå…·ä½“è¦å¯¹å“ªäº›consumerè¿›è¡Œspill()ï¼Œä¼šæœ‰ä¸€ä¸ªæ’åºç®—æ³•ï¼ˆä½¿ç”¨äº†TreeMapï¼‰ã€‚","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519409,"discussion_content":"æ²¡é”™ï¼Œè€å¼Ÿä»£ç çœ‹çš„å¾ˆç»†è‡´~ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620658720,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290867,"user_name":"å°çµèŠ","can_delete":false,"product_type":"c1","uid":2071355,"ip_address":"","ucode":"6DCB7CF8D5A7F1","user_header":"https://static001.geekbang.org/account/avatar/00/1f/9b/3b/dc3f819f.jpg","comment_is_top":false,"comment_ctime":1619794295,"is_pvip":false,"replies":[{"id":"105415","content":"å¯¹ï¼Œçœ‹ä½ çš„åº”ç”¨ä½¿ç”¨å“ªä¸ªAPIï¼ŒRDDçš„è¯ï¼Œç”¨å‰è€…ï¼›DFæˆ–æ˜¯DSçš„è¯ï¼Œç”¨åè€…ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1619862591,"ip_address":"","comment_id":290867,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1619794295","product_id":100073401,"comment_content":"â€œå¹¶è¡Œåº¦å¯ä»¥é€šè¿‡ä¸¤ä¸ªå‚æ•°æ¥è®¾ç½®ï¼Œåˆ†åˆ«æ˜¯ spark.default.parallelism å’Œ spark.sql.shuffle.partitionsã€‚å‰è€…ç”¨äºè®¾ç½® RDD çš„é»˜è®¤å¹¶è¡Œåº¦ï¼Œåè€…åœ¨ Spark SQL å¼€å‘æ¡†æ¶ä¸‹ï¼ŒæŒ‡å®šäº† Shuffle Reduce é˜¶æ®µé»˜è®¤çš„å¹¶è¡Œåº¦ã€‚â€<br><br>è¯·é—®è€å¸ˆï¼Œè¿™ä¸¤ä¸ªå‚æ•°æ˜¯éƒ½è¦è®¾ç½®å—ï¼Ÿè¿˜æ˜¯è¯´åœ¨ç”¨RDDçš„æ—¶å€™è®¾ç½®å‰è€…ï¼ŒDataframeæˆ–è€…Datasetçš„æ—¶å€™è®¾ç½®åè€…å³å¯ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519301,"discussion_content":"å¯¹ï¼Œçœ‹ä½ çš„åº”ç”¨ä½¿ç”¨å“ªä¸ªAPIï¼ŒRDDçš„è¯ï¼Œç”¨å‰è€…ï¼›DFæˆ–æ˜¯DSçš„è¯ï¼Œç”¨åè€…ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619862591,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288349,"user_name":"FendoraèŒƒä¸œ_","can_delete":false,"product_type":"c1","uid":1187106,"ip_address":"","ucode":"63EE9DBEE08D70","user_header":"https://static001.geekbang.org/account/avatar/00/12/1d/22/f04cea4c.jpg","comment_is_top":false,"comment_ctime":1618417042,"is_pvip":false,"replies":[{"id":"104701","content":"ç¬¬äºŒé¢˜ç­”å¾—å¾ˆå®Œç¾~ ğŸ’¯<br><br>ç¬¬ä¸€é¢˜ä¹Ÿå¯¹ã€‚ä¸è¿‡ï¼Œç»“åˆï¼ˆ1&#47;N&#47;2ï¼Œ1&#47;Nï¼‰çš„ä¸Šä¸‹é™ï¼Œèƒ½å†å¾€ç»†äº†è¯´ä¸€è¯´å—ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1618487759,"ip_address":"","comment_id":288349,"utype":1}],"discussion_count":4,"race_medal":0,"score":"1618417042","product_id":100073401,"comment_content":"1.å½“executorå†…æ‰€æœ‰çº¿ç¨‹éƒ½åœ¨è¿è¡Œï¼Œå®é™…éœ€è¦å†…å­˜æ¯”é¢„ä¼°ç”³è¯·å†…å­˜å¤§ï¼Œè¿™ä¸ªæ—¶å€™æ‰§è¡Œå†…å­˜åˆä¸èƒ½ç»§ç»­æ‰©å±•ï¼Œå°±ä¼šå‡ºç°oom<br>2.executorå†…æ­£åœ¨è¿è¡Œçš„è¿™æ‰¹ä»»åŠ¡æ‰§è¡Œå®Œï¼Œä¸‹ä¸€æ‰¹ä»»åŠ¡è¢«æ‰§è¡Œå‰ï¼Œå°±è¿›è¡Œèµ„æºè°ƒæ•´ã€‚æ ¹æ®æ­¤æ—¶æ‰§è¡Œå†…å­˜å¤§å°&#47;min(å¾…åˆ†é…ä»»åŠ¡æ•°ï¼Œexecutor.cores)è¿›è¡Œå†…å­˜åˆ†é…","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518597,"discussion_content":"ç¬¬äºŒé¢˜ç­”å¾—å¾ˆå®Œç¾~ ğŸ’¯\n\nç¬¬ä¸€é¢˜ä¹Ÿå¯¹ã€‚ä¸è¿‡ï¼Œç»“åˆï¼ˆ1/N/2ï¼Œ1/Nï¼‰çš„ä¸Šä¸‹é™ï¼Œèƒ½å†å¾€ç»†äº†è¯´ä¸€è¯´å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618487759,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2840248,"avatar":"","nickname":"Geek_e1ac69","note":"","ucode":"EE0B98D91211EA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":555930,"discussion_content":"è€å¸ˆè¯·é—®ä¸‹ï¼Œç¬¬äºŒé¢˜çš„ç­”æ¡ˆé‡Œè®²çš„åˆ†æ‰¹æ‰§è¡Œå®Œå…·ä½“æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿå‡è®¾executoræœ‰2ä¸ªcoreï¼Œæ˜¯ç­‰ç€ä¸¤ä¸ªä»»åŠ¡éƒ½æ‰§è¡Œå®Œäº†ï¼Œå†å»èµ„æºè°ƒæ•´ï¼Ÿè¿˜æ˜¯æ‰§è¡Œå®Œå…¶ä¸­ä¸€ä¸ªä»»åŠ¡åï¼Œä¸‹ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå‰å°±å»èµ„æºè°ƒæ•´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647132592,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":518597,"ip_address":""},"score":555930,"extra":""}]},{"author":{"id":1187106,"avatar":"https://static001.geekbang.org/account/avatar/00/12/1d/22/f04cea4c.jpg","nickname":"FendoraèŒƒä¸œ_","note":"","ucode":"63EE9DBEE08D70","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367887,"discussion_content":"ç¬¬ä¸€é¢˜:å‚è€ƒäº†ç£Šå“¥å…¶ä»–ç•™è¨€ä¸‹çš„å›ç­”ï¼Œæœ‰å‡ ä¸ªç–‘é—®:\n1.å†…å­˜åˆ†é…å°±æ˜¯å‡åˆ†ï¼ŒèŒƒå›´æ˜¯[1/2n,1/n]ï¼Œåªæ˜¯æˆ‘ä»¬è‡ªå·±è¦ä¿è¯æ•°æ®åˆ†ç‰‡çš„å¤§å°ä¹Ÿè¦è½åˆ°è¿™ä¸ªåŒºé—´ï¼Œä»¥æ­¤æ¥ä¿è¯åˆ†é…ç»™taskå†…å­˜æ˜¯å¤Ÿç”¨çš„ã€‚é‚£è¿™å—å°±æœ‰é—®é¢˜ï¼Œæˆ‘ç†è§£æ•°æ®åˆ†ç‰‡æ˜¯ç£ç›˜å­˜å‚¨çš„å‹ç¼©å¤§å°ï¼Œä¸€è§£å‹ä¸å°±å¤§äºä¸Šé¢é‚£ä¸ªåŒºé—´èŒƒå›´äº†å—ï¼Ÿ\n2.taskæ‹¿åˆ°å¯è¿è¡Œæ‰€éœ€å†…å­˜ä¸‹é™æ—¶ï¼Œå¤§æ¦‚ç‡ä¸­é—´æŸä¸ªè¿‡ç¨‹å°±éœ€è¦æ›´å¤šå†…å­˜ã€‚æ‰€ä»¥è¿™ä¸ªæ—¶å€™taskè¢«æŒ‚èµ·è¿˜æ˜¯oomæ”¹å¦‚ä½•æŠ‰æ‹©å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618491462,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":1187106,"avatar":"https://static001.geekbang.org/account/avatar/00/12/1d/22/f04cea4c.jpg","nickname":"FendoraèŒƒä¸œ_","note":"","ucode":"63EE9DBEE08D70","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369114,"discussion_content":"éƒ½æ˜¯å¥½é—®é¢˜ï¼Œæ€è€ƒçš„å¾ˆç»†è‡´~ å’±ä»¬ä¸€ä¸ªä¸ªè¯´ï¼š\n1. æˆ‘ä»¬ç®—å¹¶è¡Œåº¦çš„æ—¶å€™ï¼Œé¢„ä¼°æ¯ä¸ªåˆ†ç‰‡å¤§å°ï¼Œåº”è¯¥æ˜¯å†…å­˜ä¸­çš„å­˜å‚¨å¤§å°ã€‚å¯¹äºä»ç£ç›˜è¯»å–åˆ†å¸ƒå¼æ–‡ä»¶çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¹‹å‰ä»‹ç»è¿‡æ€ä¹ˆè®¡ç®—å®ƒåœ¨å†…å­˜ä¸­çš„å­˜å‚¨å¤§å°ã€‚å¦å¤–ï¼Œè¿˜æœ‰ä¸€ç§å¿«æ·æ–¹å¼ï¼Œå°±æ˜¯é€šè¿‡Spark UIæ¥é¢„ä¼°â€œç£ç›˜æ–‡ä»¶åœ¨å†…å­˜ä¸­çš„è†¨èƒ€ç³»æ•°â€ï¼Œæœ‰äº†è¿™ä¸ªç³»æ•°ï¼Œå¤§æ¦‚å°±èƒ½ç®—å‡ºç£ç›˜æ•°æ®åœ¨å†…å­˜ä¼šç¿»å¤šå°‘å€ã€‚è¿™ä¸ªé¢„ä¼°æ–¹æ³•æ˜¯ï¼šMemory Expansion Rate â‰ˆ Shuffle spill (memory) / Shuffle spill (disk)\n\n2. OOMï¼Œtaskå·²ç»å¼€å§‹æ‰§è¡Œï¼Œå¦‚æœä¸­é€”ç”³è¯·å†…å­˜è¢«æ‹’ï¼Œå°±ç›´æ¥æŠ›OOMäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618930565,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":367887,"ip_address":""},"score":369114,"extra":""}]}]},{"had_liked":false,"id":288240,"user_name":"ç‹å¤©é›¨","can_delete":false,"product_type":"c1","uid":2531597,"ip_address":"","ucode":"C2E4D769DA0BFA","user_header":"","comment_is_top":false,"comment_ctime":1618375594,"is_pvip":false,"replies":[{"id":"104641","content":"å•ä¸ªExecutorçš„å†…å­˜å’Œæ ¸æ•°ï¼ŒMå’ŒNï¼Œéƒ½æ˜¯ä¸€ä¸ªExecutorå†…çš„èŒƒç•´ï¼Œæ–¹ä¾¿ç†è§£å’Œè®¨è®º~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1618394334,"ip_address":"","comment_id":288240,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1618375594","product_id":100073401,"comment_content":"è¯·é—®M å’Œ N åˆ†åˆ«å¯¹åº”çš„æ˜¯å•ä¸ªExecutorçš„å†…å­˜å’Œæ ¸æ•°ï¼Œè¿˜æ˜¯é’ˆå¯¹æŸä¸ªsparkä»»åŠ¡åˆ†é…çš„æ€»Executoræ•°é‡å’Œæ ¸æ•°å‘¢","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518559,"discussion_content":"å•ä¸ªExecutorçš„å†…å­˜å’Œæ ¸æ•°ï¼ŒMå’ŒNï¼Œéƒ½æ˜¯ä¸€ä¸ªExecutorå†…çš„èŒƒç•´ï¼Œæ–¹ä¾¿ç†è§£å’Œè®¨è®º~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618394334,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288236,"user_name":"FendoraèŒƒä¸œ_","can_delete":false,"product_type":"c1","uid":1187106,"ip_address":"","ucode":"63EE9DBEE08D70","user_header":"https://static001.geekbang.org/account/avatar/00/12/1d/22/f04cea4c.jpg","comment_is_top":false,"comment_ctime":1618374917,"is_pvip":false,"replies":[{"id":"104642","content":"æ˜¯å•Šï¼Œä½ è¯´çš„æ²¡é”™ï¼ŒM&#47;2Nï¼ŒM&#47;N&#47;2ï¼Œä¸€ä¸ªæ„æ€å“ˆ~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1618394373,"ip_address":"","comment_id":288236,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1618374917","product_id":100073401,"comment_content":"ç£Šå“¥ï¼Œæ¯ä¸ªçº¿ç¨‹åˆ†é…å†…å­˜ä¸‹é™  æˆ‘ç†è§£åº”è¯¥æ˜¯M&#47;2Nå‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518558,"discussion_content":"æ˜¯å•Šï¼Œä½ è¯´çš„æ²¡é”™ï¼ŒM/2Nï¼ŒM/N/2ï¼Œä¸€ä¸ªæ„æ€å“ˆ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618394373,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}