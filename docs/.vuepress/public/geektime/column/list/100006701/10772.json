{"id":10772,"title":"ç¬¬29è®² | Javaå†…å­˜æ¨¡å‹ä¸­çš„happen-beforeæ˜¯ä»€ä¹ˆï¼Ÿ","content":"<p>Javaè¯­è¨€åœ¨è®¾è®¡ä¹‹åˆå°±å¼•å…¥äº†çº¿ç¨‹çš„æ¦‚å¿µï¼Œä»¥å……åˆ†åˆ©ç”¨ç°ä»£å¤„ç†å™¨çš„è®¡ç®—èƒ½åŠ›ï¼Œè¿™æ—¢å¸¦æ¥äº†å¼ºå¤§ã€çµæ´»çš„å¤šçº¿ç¨‹æœºåˆ¶ï¼Œä¹Ÿå¸¦æ¥äº†çº¿ç¨‹å®‰å…¨ç­‰ä»¤äººæ··æ·†çš„é—®é¢˜ï¼Œè€ŒJavaå†…å­˜æ¨¡å‹ï¼ˆJava Memory Modelï¼ŒJMMï¼‰ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªåœ¨çº·ä¹±ä¹‹ä¸­è¾¾æˆä¸€è‡´çš„æŒ‡å¯¼å‡†åˆ™ã€‚</p>\n<p>ä»Šå¤©æˆ‘è¦é—®ä½ çš„é—®é¢˜æ˜¯ï¼Œ<span class=\"orange\">Javaå†…å­˜æ¨¡å‹ä¸­çš„happen-beforeæ˜¯ä»€ä¹ˆï¼Ÿ</span></p>\n<h2>å…¸å‹å›ç­”</h2>\n<p>Happen-beforeå…³ç³»ï¼Œæ˜¯Javaå†…å­˜æ¨¡å‹ä¸­ä¿è¯å¤šçº¿ç¨‹æ“ä½œå¯è§æ€§çš„æœºåˆ¶ï¼Œä¹Ÿæ˜¯å¯¹æ—©æœŸè¯­è¨€è§„èŒƒä¸­å«ç³Šçš„å¯è§æ€§æ¦‚å¿µçš„ä¸€ä¸ªç²¾ç¡®å®šä¹‰ã€‚</p>\n<p>å®ƒçš„å…·ä½“è¡¨ç°å½¢å¼ï¼ŒåŒ…æ‹¬ä½†è¿œä¸æ­¢æ˜¯æˆ‘ä»¬ç›´è§‰ä¸­çš„synchronizedã€volatileã€lockæ“ä½œé¡ºåºç­‰æ–¹é¢ï¼Œä¾‹å¦‚ï¼š</p>\n<ul>\n<li>\n<p>çº¿ç¨‹å†…æ‰§è¡Œçš„æ¯ä¸ªæ“ä½œï¼Œéƒ½ä¿è¯happen-beforeåé¢çš„æ“ä½œï¼Œè¿™å°±ä¿è¯äº†åŸºæœ¬çš„ç¨‹åºé¡ºåºè§„åˆ™ï¼Œè¿™æ˜¯å¼€å‘è€…åœ¨ä¹¦å†™ç¨‹åºæ—¶çš„åŸºæœ¬çº¦å®šã€‚</p>\n</li>\n<li>\n<p>å¯¹äºvolatileå˜é‡ï¼Œå¯¹å®ƒçš„å†™æ“ä½œï¼Œä¿è¯happen-beforeåœ¨éšåå¯¹è¯¥å˜é‡çš„è¯»å–æ“ä½œã€‚</p>\n</li>\n<li>\n<p>å¯¹äºä¸€ä¸ªé”çš„è§£é”æ“ä½œï¼Œä¿è¯happen-beforeåŠ é”æ“ä½œã€‚</p>\n</li>\n<li>\n<p>å¯¹è±¡æ„å»ºå®Œæˆï¼Œä¿è¯happen-beforeäºfinalizerçš„å¼€å§‹åŠ¨ä½œã€‚</p>\n</li>\n<li>\n<p>ç”šè‡³æ˜¯ç±»ä¼¼çº¿ç¨‹å†…éƒ¨æ“ä½œçš„å®Œæˆï¼Œä¿è¯happen-beforeå…¶ä»–Thread.join()çš„çº¿ç¨‹ç­‰ã€‚</p>\n</li>\n</ul><!-- [[[read_end]]] -->\n<p>è¿™äº›happen-beforeå…³ç³»æ˜¯å­˜åœ¨ç€ä¼ é€’æ€§çš„ï¼Œå¦‚æœæ»¡è¶³a happen-before bå’Œb happen-before cï¼Œé‚£ä¹ˆa happen-before cä¹Ÿæˆç«‹ã€‚</p>\n<p>å‰é¢æˆ‘ä¸€ç›´ç”¨happen-beforeï¼Œè€Œä¸æ˜¯ç®€å•è¯´å‰åï¼Œæ˜¯å› ä¸ºå®ƒä¸ä»…ä»…æ˜¯å¯¹æ‰§è¡Œæ—¶é—´çš„ä¿è¯ï¼Œä¹ŸåŒ…æ‹¬å¯¹å†…å­˜è¯»ã€å†™æ“ä½œé¡ºåºçš„ä¿è¯ã€‚ä»…ä»…æ˜¯æ—¶é’Ÿé¡ºåºä¸Šçš„å…ˆåï¼Œå¹¶ä¸èƒ½ä¿è¯çº¿ç¨‹äº¤äº’çš„å¯è§æ€§ã€‚</p>\n<h2>è€ƒç‚¹åˆ†æ</h2>\n<p>ä»Šå¤©çš„é—®é¢˜æ˜¯ä¸€ä¸ªå¸¸è§çš„è€ƒå¯ŸJavaå†…å­˜æ¨¡å‹åŸºæœ¬æ¦‚å¿µçš„é—®é¢˜ï¼Œæˆ‘å‰é¢ç»™å‡ºçš„å›ç­”å°½é‡é€‰æ‹©äº†å’Œæ—¥å¸¸å¼€å‘ç›¸å…³çš„è§„åˆ™ã€‚</p>\n<p>JMMæ˜¯é¢è¯•çš„çƒ­ç‚¹ï¼Œå¯ä»¥çœ‹ä½œæ˜¯æ·±å…¥ç†è§£Javaå¹¶å‘ç¼–ç¨‹ã€ç¼–è¯‘å™¨å’ŒJVMå†…éƒ¨æœºåˆ¶çš„å¿…è¦æ¡ä»¶ï¼Œä½†è¿™åŒæ—¶ä¹Ÿæ˜¯ä¸ªå®¹æ˜“è®©åˆå­¦è€…æ— æ‰€é€‚ä»çš„ä¸»é¢˜ã€‚å¯¹äºå­¦ä¹ JMMï¼Œæˆ‘æœ‰ä¸€äº›ä¸ªäººå»ºè®®ï¼š</p>\n<ul>\n<li>\n<p>æ˜ç¡®ç›®çš„ï¼Œå…‹åˆ¶ä½æŠ€æœ¯çš„è¯±æƒ‘ã€‚é™¤éä½ æ˜¯ç¼–è¯‘å™¨æˆ–è€…JVMå·¥ç¨‹å¸ˆï¼Œå¦åˆ™æˆ‘å»ºè®®ä¸è¦ä¸€å¤´æ‰è¿›å„ç§CPUä½“ç³»ç»“æ„ï¼Œçº ç»“äºä¸åŒçš„ç¼“å­˜ã€æµæ°´çº¿ã€æ‰§è¡Œå•å…ƒç­‰ã€‚è¿™äº›ä¸œè¥¿è™½ç„¶å¾ˆé…·ï¼Œä½†å…¶å¤æ‚æ€§æ˜¯è¶…ä¹æƒ³è±¡çš„ï¼Œå¾ˆå¯èƒ½ä¼šæ— è°“å¢åŠ å­¦ä¹ éš¾åº¦ï¼Œä¹Ÿæœªå¿…æœ‰å®è·µä»·å€¼ã€‚</p>\n</li>\n<li>\n<p>å…‹åˆ¶ä½å¯¹â€œç§˜ç±â€çš„è¯±æƒ‘ã€‚æœ‰äº›æ—¶å€™ï¼ŒæŸäº›ç¼–ç¨‹æ–¹å¼çœ‹èµ·æ¥èƒ½èµ·åˆ°ç‰¹å®šæ•ˆæœï¼Œä½†åˆ†ä¸æ¸…æ˜¯å®ç°å·®å¼‚å¯¼è‡´çš„â€œè¡¨ç°â€ï¼Œè¿˜æ˜¯â€œè§„èŒƒâ€è¦æ±‚çš„è¡Œä¸ºï¼Œå°±ä¸è¦ä¾èµ–äºè¿™ç§â€œè¡¨ç°â€å»ç¼–ç¨‹ï¼Œå°½é‡éµå¾ªè¯­è¨€è§„èŒƒè¿›è¡Œï¼Œè¿™æ ·æˆ‘ä»¬çš„åº”ç”¨è¡Œä¸ºæ‰èƒ½æ›´åŠ å¯é ã€å¯é¢„è®¡ã€‚</p>\n</li>\n</ul>\n<p>åœ¨è¿™ä¸€è®²ä¸­ï¼Œå…¼é¡¾é¢è¯•å’Œç¼–ç¨‹å®è·µï¼Œæˆ‘ä¼šç»“åˆä¾‹å­æ¢³ç†ä¸‹é¢ä¸¤ç‚¹ï¼š</p>\n<ul>\n<li>\n<p>ä¸ºä»€ä¹ˆéœ€è¦JMMï¼Œå®ƒè¯•å›¾è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p>\n</li>\n<li>\n<p>JMMæ˜¯å¦‚ä½•è§£å†³å¯è§æ€§ç­‰å„ç§é—®é¢˜çš„ï¼Ÿç±»ä¼¼volatileï¼Œä½“ç°åœ¨å…·ä½“ç”¨ä¾‹ä¸­æœ‰ä»€ä¹ˆæ•ˆæœï¼Ÿ</p>\n</li>\n</ul>\n<p>æ³¨æ„ï¼Œä¸“æ ä¸­Javaå†…å­˜æ¨¡å‹å°±æ˜¯ç‰¹æŒ‡JSR-133ä¸­é‡æ–°å®šä¹‰çš„JMMè§„èŒƒã€‚åœ¨ç‰¹å®šçš„ä¸Šä¸‹æ–‡é‡Œï¼Œä¹Ÿè®¸ä¼šä¸JVMï¼ˆJavaï¼‰å†…å­˜ç»“æ„ç­‰æ··æ·†ï¼Œå¹¶ä¸å­˜åœ¨ç»å¯¹çš„å¯¹é”™ï¼Œä½†ä¸€å®šè¦æ¸…æ¥šé¢è¯•å®˜çš„æœ¬æ„ï¼Œæœ‰çš„é¢è¯•å®˜ä¹Ÿä¼šç‰¹æ„è€ƒå¯Ÿæ˜¯å¦æ¸…æ¥šè¿™ä¸¤ç§æ¦‚å¿µçš„åŒºåˆ«ã€‚</p>\n<h2>çŸ¥è¯†æ‰©å±•</h2>\n<p><strong>ä¸ºä»€ä¹ˆéœ€è¦JMMï¼Œå®ƒè¯•å›¾è§£å†³ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></p>\n<p>Javaæ˜¯æœ€æ—©å°è¯•æä¾›å†…å­˜æ¨¡å‹çš„è¯­è¨€ï¼Œè¿™æ˜¯ç®€åŒ–å¤šçº¿ç¨‹ç¼–ç¨‹ã€ä¿è¯ç¨‹åºå¯ç§»æ¤æ€§çš„ä¸€ä¸ªé£è·ƒã€‚æ—©æœŸç±»ä¼¼Cã€C++ç­‰è¯­è¨€ï¼Œå¹¶ä¸å­˜åœ¨å†…å­˜æ¨¡å‹çš„æ¦‚å¿µï¼ˆC++ 11ä¸­ä¹Ÿå¼•å…¥äº†æ ‡å‡†å†…å­˜æ¨¡å‹ï¼‰ï¼Œå…¶è¡Œä¸ºä¾èµ–äºå¤„ç†å™¨æœ¬èº«çš„<a href=\"https://en.wikipedia.org/wiki/Memory_ordering\">å†…å­˜ä¸€è‡´æ€§æ¨¡å‹</a>ï¼Œä½†ä¸åŒçš„å¤„ç†å™¨å¯èƒ½å·®å¼‚å¾ˆå¤§ï¼Œæ‰€ä»¥ä¸€æ®µC++ç¨‹åºåœ¨å¤„ç†å™¨Aä¸Šè¿è¡Œæ­£å¸¸ï¼Œå¹¶ä¸èƒ½ä¿è¯å…¶åœ¨å¤„ç†å™¨Bä¸Šä¹Ÿæ˜¯ä¸€è‡´çš„ã€‚</p>\n<p>å³ä½¿å¦‚æ­¤ï¼Œæœ€åˆçš„Javaè¯­è¨€è§„èŒƒä»ç„¶æ˜¯å­˜åœ¨ç€ç¼ºé™·çš„ï¼Œå½“æ—¶çš„ç›®æ ‡æ˜¯ï¼Œå¸Œæœ›Javaç¨‹åºå¯ä»¥å……åˆ†åˆ©ç”¨ç°ä»£ç¡¬ä»¶çš„è®¡ç®—èƒ½åŠ›ï¼ŒåŒæ—¶ä¿æŒâ€œä¹¦å†™ä¸€æ¬¡ï¼Œåˆ°å¤„æ‰§è¡Œâ€çš„èƒ½åŠ›ã€‚</p>\n<p>ä½†æ˜¯ï¼Œæ˜¾ç„¶é—®é¢˜çš„å¤æ‚åº¦è¢«ä½ä¼°äº†ï¼Œéšç€Javaè¢«è¿è¡Œåœ¨è¶Šæ¥è¶Šå¤šçš„å¹³å°ä¸Šï¼Œäººä»¬å‘ç°ï¼Œè¿‡äºæ³›æ³›çš„å†…å­˜æ¨¡å‹å®šä¹‰ï¼Œå­˜åœ¨å¾ˆå¤šæ¨¡æ£±ä¸¤å¯ä¹‹å¤„ï¼Œå¯¹synchronizedæˆ–volatileç­‰ï¼Œç±»ä¼¼æŒ‡ä»¤é‡æ’åºæ—¶çš„è¡Œä¸ºï¼Œå¹¶æ²¡æœ‰æä¾›æ¸…æ™°è§„èŒƒã€‚è¿™é‡Œè¯´çš„æŒ‡ä»¤é‡æ’åºï¼Œæ—¢å¯ä»¥æ˜¯<a href=\"https://en.wikipedia.org/wiki/Instruction_scheduling\">ç¼–è¯‘å™¨ä¼˜åŒ–è¡Œä¸º</a>ï¼Œä¹Ÿå¯èƒ½æ˜¯æºè‡ªäºç°ä»£å¤„ç†å™¨çš„<a href=\"https://en.wikipedia.org/wiki/Out-of-order_execution\">ä¹±åºæ‰§è¡Œ</a>ç­‰ã€‚</p>\n<p>æ¢å¥è¯è¯´ï¼š</p>\n<ul>\n<li>\n<p>æ—¢ä¸èƒ½ä¿è¯ä¸€äº›å¤šçº¿ç¨‹ç¨‹åºçš„æ­£ç¡®æ€§ï¼Œä¾‹å¦‚æœ€è‘—åçš„å°±æ˜¯åŒæ£€é”ï¼ˆDouble-Checked Lockingï¼ŒDCLï¼‰çš„å¤±æ•ˆé—®é¢˜ï¼Œå…·ä½“å¯ä»¥å‚è€ƒæˆ‘åœ¨<a href=\"http://time.geekbang.org/column/article/8624\">ç¬¬14è®²</a>å¯¹å•ä¾‹æ¨¡å¼çš„è¯´æ˜ï¼ŒåŒæ£€é”å¯èƒ½å¯¼è‡´æœªå®Œæ•´åˆå§‹åŒ–çš„å¯¹è±¡è¢«è®¿é—®ï¼Œç†è®ºä¸Šè¿™å«å¹¶å‘ç¼–ç¨‹ä¸­çš„å®‰å…¨å‘å¸ƒï¼ˆSafe Publicationï¼‰å¤±è´¥ã€‚</p>\n</li>\n<li>\n<p>ä¹Ÿä¸èƒ½ä¿è¯åŒä¸€æ®µç¨‹åºåœ¨ä¸åŒçš„å¤„ç†å™¨æ¶æ„ä¸Šè¡¨ç°ä¸€è‡´ï¼Œä¾‹å¦‚æœ‰çš„å¤„ç†å™¨æ”¯æŒç¼“å­˜ä¸€è‡´æ€§ï¼Œæœ‰çš„ä¸æ”¯æŒï¼Œå„è‡ªéƒ½æœ‰è‡ªå·±çš„å†…å­˜æ’åºæ¨¡å‹ã€‚</p>\n</li>\n</ul>\n<p>æ‰€ä»¥ï¼ŒJavaè¿«åˆ‡éœ€è¦ä¸€ä¸ªå®Œå–„çš„JMMï¼Œèƒ½å¤Ÿè®©æ™®é€šJavaå¼€å‘è€…å’Œç¼–è¯‘å™¨ã€JVMå·¥ç¨‹å¸ˆï¼Œèƒ½å¤Ÿ<strong>æ¸…æ™°åœ°</strong>è¾¾æˆå…±è¯†ã€‚æ¢å¥è¯è¯´ï¼Œå¯ä»¥ç›¸å¯¹ç®€å•å¹¶å‡†ç¡®åœ°åˆ¤æ–­å‡ºï¼Œå¤šçº¿ç¨‹ç¨‹åºä»€ä¹ˆæ ·çš„æ‰§è¡Œåºåˆ—æ˜¯ç¬¦åˆè§„èŒƒçš„ã€‚</p>\n<p>æ‰€ä»¥ï¼š</p>\n<ul>\n<li>\n<p>å¯¹äºç¼–è¯‘å™¨ã€JVMå¼€å‘è€…ï¼Œå…³æ³¨ç‚¹å¯èƒ½æ˜¯å¦‚ä½•ä½¿ç”¨ç±»ä¼¼<a href=\"https://en.wikipedia.org/wiki/Memory_barrier\">å†…å­˜å±éšœ</a>ï¼ˆMemory-Barrierï¼‰ä¹‹ç±»æŠ€æœ¯ï¼Œä¿è¯æ‰§è¡Œç»“æœç¬¦åˆJMMçš„æ¨æ–­ã€‚</p>\n</li>\n<li>\n<p>å¯¹äºJavaåº”ç”¨å¼€å‘è€…ï¼Œåˆ™å¯èƒ½æ›´åŠ å…³æ³¨volatileã€synchronizedç­‰è¯­ä¹‰ï¼Œå¦‚ä½•åˆ©ç”¨ç±»ä¼¼happen-beforeçš„è§„åˆ™ï¼Œå†™å‡ºå¯é çš„å¤šçº¿ç¨‹åº”ç”¨ï¼Œè€Œä¸æ˜¯åˆ©ç”¨ä¸€äº›â€œç§˜ç±â€å»ç³Šå¼„ç¼–è¯‘å™¨ã€JVMã€‚</p>\n</li>\n</ul>\n<p>æˆ‘ç”»äº†ä¸€ä¸ªç®€å•çš„è§’è‰²å±‚æ¬¡å›¾ï¼Œä¸åŒå·¥ç¨‹å¸ˆåˆ†å·¥åˆä½œï¼Œå…¶å®æ‰€å¤„çš„å±‚é¢æ˜¯æœ‰åŒºåˆ«çš„ã€‚JMMä¸ºJavaå·¥ç¨‹å¸ˆéš”ç¦»äº†ä¸åŒå¤„ç†å™¨å†…å­˜æ’åºçš„åŒºåˆ«ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆæˆ‘é€šå¸¸ä¸å»ºè®®è¿‡æ—©æ·±å…¥å¤„ç†å™¨ä½“ç³»ç»“æ„ï¼ŒæŸç§æ„ä¹‰ä¸Šæ¥è¯´ï¼Œè¿™æ ·æœ¬å°±è¿èƒŒäº†JMMçš„åˆè¡·ã€‚<br />\n<img src=\"https://static001.geekbang.org/resource/image/5d/e5/5d74ad650fa5d1cdf80df3b3062357e5.png?wh=755*445\" alt=\"\" /></p>\n<p><strong>JMMæ˜¯æ€ä¹ˆè§£å†³å¯è§æ€§ç­‰é—®é¢˜çš„å‘¢ï¼Ÿ</strong></p>\n<p>åœ¨è¿™é‡Œï¼Œæˆ‘æœ‰å¿…è¦ç®€è¦ä»‹ç»ä¸€ä¸‹å…¸å‹çš„é—®é¢˜åœºæ™¯ã€‚</p>\n<p>æˆ‘åœ¨<a href=\"http://time.geekbang.org/column/article/10192\">ç¬¬25è®²</a>é‡Œä»‹ç»äº†JVMå†…éƒ¨çš„è¿è¡Œæ—¶æ•°æ®åŒºï¼Œä½†æ˜¯çœŸæ­£ç¨‹åºæ‰§è¡Œï¼Œå®é™…æ˜¯è¦è·‘åœ¨å…·ä½“çš„å¤„ç†å™¨å†…æ ¸ä¸Šã€‚ä½ å¯ä»¥ç®€å•ç†è§£ä¸ºï¼ŒæŠŠæœ¬åœ°å˜é‡ç­‰æ•°æ®ä»å†…å­˜åŠ è½½åˆ°ç¼“å­˜ã€å¯„å­˜å™¨ï¼Œç„¶åè¿ç®—ç»“æŸå†™å›ä¸»å†…å­˜ã€‚ä½ å¯ä»¥ä»ä¸‹é¢ç¤ºæ„å›¾ï¼Œçœ‹è¿™ä¸¤ç§æ¨¡å‹çš„å¯¹åº”ã€‚<br />\n<img src=\"https://static001.geekbang.org/resource/image/ff/61/ff8afc2561e8891bc74a0112905fed61.png?wh=665*420\" alt=\"\" /></p>\n<p>çœ‹ä¸Šå»å¾ˆç¾å¥½ï¼Œä½†æ˜¯å½“å¤šçº¿ç¨‹å…±äº«å˜é‡æ—¶ï¼Œæƒ…å†µå°±å¤æ‚äº†ã€‚è¯•æƒ³ï¼Œå¦‚æœå¤„ç†å™¨å¯¹æŸä¸ªå…±äº«å˜é‡è¿›è¡Œäº†ä¿®æ”¹ï¼Œå¯èƒ½åªæ˜¯ä½“ç°åœ¨è¯¥å†…æ ¸çš„ç¼“å­˜é‡Œï¼Œè¿™æ˜¯ä¸ªæœ¬åœ°çŠ¶æ€ï¼Œè€Œè¿è¡Œåœ¨å…¶ä»–å†…æ ¸ä¸Šçš„çº¿ç¨‹ï¼Œå¯èƒ½è¿˜æ˜¯åŠ è½½çš„æ—§çŠ¶æ€ï¼Œè¿™å¾ˆå¯èƒ½å¯¼è‡´ä¸€è‡´æ€§çš„é—®é¢˜ã€‚ä»ç†è®ºä¸Šæ¥è¯´ï¼Œå¤šçº¿ç¨‹å…±äº«å¼•å…¥äº†å¤æ‚çš„æ•°æ®ä¾èµ–æ€§ï¼Œä¸ç®¡ç¼–è¯‘å™¨ã€å¤„ç†å™¨æ€ä¹ˆåšé‡æ’åºï¼Œéƒ½å¿…é¡»å°Šé‡æ•°æ®ä¾èµ–æ€§çš„è¦æ±‚ï¼Œå¦åˆ™å°±æ‰“ç ´äº†æ­£ç¡®æ€§ï¼è¿™å°±æ˜¯JMMæ‰€è¦è§£å†³çš„é—®é¢˜ã€‚</p>\n<p>JMMå†…éƒ¨çš„å®ç°é€šå¸¸æ˜¯ä¾èµ–äºæ‰€è°“çš„å†…å­˜å±éšœï¼Œé€šè¿‡ç¦æ­¢æŸäº›é‡æ’åºçš„æ–¹å¼ï¼Œæä¾›å†…å­˜å¯è§æ€§ä¿è¯ï¼Œä¹Ÿå°±æ˜¯å®ç°äº†å„ç§happen-beforeè§„åˆ™ã€‚ä¸æ­¤åŒæ—¶ï¼Œæ›´å¤šå¤æ‚åº¦åœ¨äºï¼Œéœ€è¦å°½é‡ç¡®ä¿å„ç§ç¼–è¯‘å™¨ã€å„ç§ä½“ç³»ç»“æ„çš„å¤„ç†å™¨ï¼Œéƒ½èƒ½å¤Ÿæä¾›ä¸€è‡´çš„è¡Œä¸ºã€‚</p>\n<p>æˆ‘ä»¥volatileä¸ºä¾‹ï¼Œçœ‹çœ‹å¦‚ä½•åˆ©ç”¨å†…å­˜å±éšœå®ç°JMMå®šä¹‰çš„å¯è§æ€§ï¼Ÿ</p>\n<p>å¯¹äºä¸€ä¸ªvolatileå˜é‡ï¼š</p>\n<ul>\n<li>\n<p>å¯¹è¯¥å˜é‡çš„å†™æ“ä½œ<strong>ä¹‹å</strong>ï¼Œç¼–è¯‘å™¨ä¼šæ’å…¥ä¸€ä¸ª<strong>å†™å±éšœ</strong>ã€‚</p>\n</li>\n<li>\n<p>å¯¹è¯¥å˜é‡çš„è¯»æ“ä½œ<strong>ä¹‹å‰</strong>ï¼Œç¼–è¯‘å™¨ä¼šæ’å…¥ä¸€ä¸ª<strong>è¯»å±éšœ</strong>ã€‚</p>\n</li>\n</ul>\n<p>å†…å­˜å±éšœèƒ½å¤Ÿåœ¨ç±»ä¼¼å˜é‡è¯»ã€å†™æ“ä½œä¹‹åï¼Œä¿è¯å…¶ä»–çº¿ç¨‹å¯¹volatileå˜é‡çš„ä¿®æ”¹å¯¹å½“å‰çº¿ç¨‹å¯è§ï¼Œæˆ–è€…æœ¬åœ°ä¿®æ”¹å¯¹å…¶ä»–çº¿ç¨‹æä¾›å¯è§æ€§ã€‚æ¢å¥è¯è¯´ï¼Œçº¿ç¨‹å†™å…¥ï¼Œå†™å±éšœä¼šé€šè¿‡ç±»ä¼¼å¼ºè¿«åˆ·å‡ºå¤„ç†å™¨ç¼“å­˜çš„æ–¹å¼ï¼Œè®©å…¶ä»–çº¿ç¨‹èƒ½å¤Ÿæ‹¿åˆ°æœ€æ–°æ•°å€¼ã€‚</p>\n<p>å¦‚æœä½ å¯¹æ›´å¤šå†…å­˜å±éšœçš„ç»†èŠ‚æ„Ÿå…´è¶£ï¼Œæˆ–è€…æƒ³äº†è§£ä¸åŒä½“ç³»ç»“æ„çš„å¤„ç†å™¨æ¨¡å‹ï¼Œå»ºè®®å‚è€ƒJSR-133<a href=\"http://gee.cs.oswego.edu/dl/jmm/cookbook.html\">ç›¸å…³æ–‡æ¡£</a>ï¼Œæˆ‘ä¸ªäººè®¤ä¸ºè¿™äº›éƒ½æ˜¯å’Œç‰¹å®šç¡¬ä»¶ç›¸å…³çš„ï¼Œå†…å­˜å±éšœä¹‹ç±»åªæ˜¯å®ç°JMMè§„èŒƒçš„æŠ€æœ¯æ‰‹æ®µï¼Œå¹¶ä¸æ˜¯è§„èŒƒçš„è¦æ±‚ã€‚</p>\n<p><strong>ä»åº”ç”¨å¼€å‘è€…çš„è§’åº¦ï¼ŒJMMæä¾›çš„å¯è§æ€§ï¼Œä½“ç°åœ¨ç±»ä¼¼volatileä¸Šï¼Œå…·ä½“è¡Œä¸ºæ˜¯ä»€ä¹ˆæ ·å‘¢ï¼Ÿ</strong></p>\n<p>æˆ‘è¿™é‡Œå¾ªåºæ¸è¿›çš„ä¸¾ä¸¤ä¸ªä¾‹å­ã€‚</p>\n<p>é¦–å…ˆï¼Œå‰å‡ å¤©æœ‰åŒå­¦é—®æˆ‘ä¸€ä¸ªé—®é¢˜ï¼Œè¯·çœ‹ä¸‹é¢çš„ä»£ç ç‰‡æ®µï¼Œå¸Œæœ›è¾¾åˆ°çš„æ•ˆæœæ˜¯ï¼Œå½“conditionè¢«èµ‹å€¼ä¸ºfalseæ—¶ï¼Œçº¿ç¨‹Aèƒ½å¤Ÿä»å¾ªç¯ä¸­é€€å‡ºã€‚</p>\n<pre><code>// Thread A\nwhile (condition) {\n}\n\n// Thread B\ncondition = false;\n</code></pre>\n<p>è¿™é‡Œå°±éœ€è¦conditionè¢«å®šä¹‰ä¸ºvolatileå˜é‡ï¼Œä¸ç„¶å…¶æ•°å€¼å˜åŒ–ï¼Œå¾€å¾€å¹¶ä¸èƒ½è¢«çº¿ç¨‹Aæ„ŸçŸ¥ï¼Œè¿›è€Œæ— æ³•é€€å‡ºã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥åœ¨whileä¸­ï¼Œæ·»åŠ èƒ½å¤Ÿç›´æ¥æˆ–é—´æ¥èµ·åˆ°ç±»ä¼¼æ•ˆæœçš„ä»£ç ã€‚</p>\n<p>ç¬¬äºŒï¼Œæˆ‘æƒ³ä¸¾Brian Goetzæä¾›çš„ä¸€ä¸ªç»å…¸ç”¨ä¾‹ï¼Œä½¿ç”¨volatileä½œä¸ºå®ˆå«å¯¹è±¡ï¼Œå®ç°æŸç§ç¨‹åº¦ä¸Šè½»é‡çº§çš„åŒæ­¥ï¼Œè¯·çœ‹ä»£ç ç‰‡æ®µï¼š</p>\n<pre><code>Map configOptions;\nchar[] configText;\nvolatile boolean initialized = false;\n \n// Thread A\nconfigOptions = new HashMap();\nconfigText = readConfigFile(fileName);\nprocessConfigOptions(configText, configOptions);\ninitialized = true;\n \n// Thread B\nwhile (!initialized)\n Â sleep();\n// use configOptions\n</code></pre>\n<p>JSR-133é‡æ–°å®šä¹‰çš„JMMæ¨¡å‹ï¼Œèƒ½å¤Ÿä¿è¯çº¿ç¨‹Bè·å–çš„configOptionsæ˜¯æ›´æ–°åçš„æ•°å€¼ã€‚</p>\n<p>ä¹Ÿå°±æ˜¯è¯´volatileå˜é‡çš„å¯è§æ€§å‘ç”Ÿäº†å¢å¼ºï¼Œèƒ½å¤Ÿèµ·åˆ°å®ˆæŠ¤å…¶ä¸Šä¸‹æ–‡çš„ä½œç”¨ã€‚çº¿ç¨‹Aå¯¹volatileå˜é‡çš„èµ‹å€¼ï¼Œä¼šå¼ºåˆ¶å°†è¯¥å˜é‡è‡ªå·±å’Œå½“æ—¶å…¶ä»–å˜é‡çš„çŠ¶æ€éƒ½åˆ·å‡ºç¼“å­˜ï¼Œä¸ºçº¿ç¨‹Bæä¾›å¯è§æ€§ã€‚å½“ç„¶ï¼Œè¿™ä¹Ÿæ˜¯ä»¥ä¸€å®šçš„æ€§èƒ½å¼€é”€ä½œä¸ºä»£ä»·çš„ï¼Œä½†æ¯•ç«Ÿå¸¦æ¥äº†æ›´åŠ ç®€å•çš„å¤šçº¿ç¨‹è¡Œä¸ºã€‚</p>\n<p>æˆ‘ä»¬ç»å¸¸ä¼šè¯´volatileæ¯”synchronizedä¹‹ç±»æ›´åŠ è½»é‡ï¼Œä½†è½»é‡ä¹Ÿä»…ä»…æ˜¯ç›¸å¯¹çš„ï¼Œvolatileçš„è¯»ã€å†™ä»ç„¶è¦æ¯”æ™®é€šçš„è¯»å†™è¦å¼€é”€æ›´å¤§ï¼Œæ‰€ä»¥å¦‚æœä½ æ˜¯åœ¨æ€§èƒ½é«˜åº¦æ•æ„Ÿçš„åœºæ™¯ï¼Œé™¤éä½ ç¡®å®šéœ€è¦å®ƒçš„è¯­ä¹‰ï¼Œä¸ç„¶æ…ç”¨ã€‚</p>\n<p>ä»Šå¤©ï¼Œæˆ‘ä»happen-beforeå…³ç³»å¼€å§‹ï¼Œå¸®ä½ ç†è§£äº†ä»€ä¹ˆæ˜¯Javaå†…å­˜æ¨¡å‹ã€‚ä¸ºäº†æ›´æ–¹ä¾¿ç†è§£ï¼Œæˆ‘ä½œäº†ç®€åŒ–ï¼Œä»ä¸åŒå·¥ç¨‹å¸ˆçš„è§’è‰²åˆ’åˆ†ç­‰è§’åº¦ï¼Œé˜è¿°äº†é—®é¢˜çš„ç”±æ¥ï¼Œä»¥åŠJMMæ˜¯å¦‚ä½•é€šè¿‡ç±»ä¼¼å†…å­˜å±éšœç­‰æŠ€æœ¯å®ç°çš„ã€‚æœ€åï¼Œæˆ‘ä»¥volatileä¸ºä¾‹ï¼Œåˆ†æäº†å¯è§æ€§åœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸­çš„å…¸å‹ç”¨ä¾‹ã€‚</p>\n<h2>ä¸€è¯¾ä¸€ç»ƒ</h2>\n<p>å…³äºä»Šå¤©æˆ‘ä»¬è®¨è®ºçš„é¢˜ç›®ä½ åšåˆ°å¿ƒä¸­æœ‰æ•°äº†å—ï¼Ÿä»Šå¤©ç•™ç»™ä½ çš„æ€è€ƒé¢˜æ˜¯ï¼Œç»™å®šä¸€æ®µä»£ç ï¼Œå¦‚ä½•éªŒè¯æ‰€æœ‰ç¬¦åˆJMMæ‰§è¡Œå¯èƒ½ï¼Ÿæœ‰ä»€ä¹ˆå·¥å…·å¯ä»¥è¾…åŠ©å—ï¼Ÿ</p>\n<p>è¯·ä½ åœ¨ç•™è¨€åŒºå†™å†™ä½ å¯¹è¿™ä¸ªé—®é¢˜çš„æ€è€ƒï¼Œæˆ‘ä¼šé€‰å‡ºç»è¿‡è®¤çœŸæ€è€ƒçš„ç•™è¨€ï¼Œé€ç»™ä½ ä¸€ä»½å­¦ä¹ å¥–åŠ±ç¤¼åˆ¸ï¼Œæ¬¢è¿ä½ ä¸æˆ‘ä¸€èµ·è®¨è®ºã€‚</p>\n<p>ä½ çš„æœ‹å‹æ˜¯ä¸æ˜¯ä¹Ÿåœ¨å‡†å¤‡é¢è¯•å‘¢ï¼Ÿä½ å¯ä»¥â€œè¯·æœ‹å‹è¯»â€ï¼ŒæŠŠä»Šå¤©çš„é¢˜ç›®åˆ†äº«ç»™å¥½å‹ï¼Œæˆ–è®¸ä½ èƒ½å¸®åˆ°ä»–ã€‚</p>\n<p></p>\n","neighbors":{"left":{"article_title":"ç¬¬28è®² | è°ˆè°ˆä½ çš„GCè°ƒä¼˜æ€è·¯?","id":10651},"right":{"article_title":"ç¬¬30è®² | Javaç¨‹åºè¿è¡Œåœ¨Dockerç­‰å®¹å™¨ç¯å¢ƒæœ‰å“ªäº›æ–°é—®é¢˜ï¼Ÿ","id":10975}},"comments":[{"had_liked":false,"id":19523,"user_name":"clz1341521","can_delete":false,"product_type":"c1","uid":1179557,"ip_address":"","ucode":"3BDB4AB454C918","user_header":"https://static001.geekbang.org/account/avatar/00/11/ff/a5/eccc7653.jpg","comment_is_top":true,"comment_ctime":1533866450,"is_pvip":false,"replies":[{"id":"6856","content":"volatileåªä¿è¯å¯è§æ€§","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1533995218,"ip_address":"","comment_id":19523,"utype":1}],"discussion_count":6,"race_medal":0,"score":"9.2233721801225994e+18","product_id":100006701,"comment_content":"æ¨è€å¸ˆï¼Œè¯·æ•™ä¸€ä¸ªé—®é¢˜ï¼Œæœ›ç­”å¤ã€‚<br>volatile booleanå’Œatomicboolean ä¸€æ ·æ˜¯åŸå­æ€§çš„å—ï¼Ÿ","like_count":34,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":421879,"discussion_content":"volatileåªä¿è¯å¯è§æ€§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1533995218,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1397351,"avatar":"https://static001.geekbang.org/account/avatar/00/15/52/67/fcba0967.jpg","nickname":"zapup","note":"","ucode":"388D6BB5D7B137","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318592,"discussion_content":"volatile int state=1;\nstate++; // æ­¤å¤„ä¸ä¿è¯è¯»ã€å†™åŸå­æ€§","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1603788620,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1097836,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c0/6c/29be1864.jpg","nickname":"éšå¿ƒè€Œè‡³","note":"","ucode":"31866865255101","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":340132,"discussion_content":"å¯ä»¥å†™ç¨‹åºéªŒè¯çš„ï¼Œå¹¶ä¸”å¯ä»¥åœ¨Javaå­—èŠ‚ç å’Œæœºå™¨ç å±‚é¢æ¥éªŒè¯ï¼Œå¯ä»¥å‚è§æˆ‘çš„ä¸€ç¯‡æ–‡ç« ã€‚https://www.jianshu.com/p/aa6a9a7035a9","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609912523,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1000015,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/4f/ff1ac464.jpg","nickname":"åˆåŒå’å•æ˜¯ä¸€å¹´å•Š","note":"","ucode":"E067320E537DEE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4833,"discussion_content":"volatileä¸èƒ½ç¦æ­¢æŒ‡ä»¤é‡æ’ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565761527,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1329547,"avatar":"https://static001.geekbang.org/account/avatar/00/14/49/8b/844e70df.jpg","nickname":"çƒ­å¿ƒç½‘å‹","note":"","ucode":"8779205D59C409","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1000015,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/4f/ff1ac464.jpg","nickname":"åˆåŒå’å•æ˜¯ä¸€å¹´å•Š","note":"","ucode":"E067320E537DEE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6756,"discussion_content":"è¿™é‡Œæ¨è€å¸ˆå›ç­”çš„æ„æ€ä¸»è¦æ˜¯é’ˆå¯¹åŸå­æ€§æ¥è¯´çš„","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1567085692,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":4833,"ip_address":""},"score":6756,"extra":""},{"author":{"id":1144504,"avatar":"https://static001.geekbang.org/account/avatar/00/11/76/b8/e4cd7997.jpg","nickname":"KAGEMUSHA","note":"","ucode":"DFC05BE62A9C10","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1000015,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/4f/ff1ac464.jpg","nickname":"åˆåŒå’å•æ˜¯ä¸€å¹´å•Š","note":"","ucode":"E067320E537DEE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":307088,"discussion_content":"volatileå°±æ˜¯ç”¨æ¥ç¦æ­¢æŒ‡ä»¤é‡æ’çš„ï¼Œä½†è¿™ä¸ç­‰äºåŸå­æ€§å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600492296,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":4833,"ip_address":""},"score":307088,"extra":""}]}]},{"had_liked":false,"id":16531,"user_name":"- -","can_delete":false,"product_type":"c1","uid":1090880,"ip_address":"","ucode":"BACB2763FD2D5D","user_header":"https://static001.geekbang.org/account/avatar/00/10/a5/40/ad00a484.jpg","comment_is_top":false,"comment_ctime":1532009128,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"259230046888","product_id":100006701,"comment_content":"ä¸ªäººè§‰å¾—happens-beforeåŸåˆ™æœ€éš¾ç†è§£çš„å°±æ˜¯å’Œæ—¶é—´æ¬¡åºä¸Šçš„å…³ç³»ï¼Œå°±æ¯”å¦‚volatileå˜é‡çš„å†™æ“ä½œhappens-beforeå…¶åçš„è¯»æ“ä½œï¼Œä¹‹å‰å¾ˆéš¾ç†è§£â€œå…¶åâ€çš„å«ä¹‰ï¼Œä¸€ç›´è®¤ä¸ºæ—¢ç„¶æ˜¯å…ˆå‘ç”Ÿçš„æ“ä½œï¼Œç»“æœè‚¯å®šå¯¹åç»­çš„æ“ä½œå¯è§å•Šï¼Œä»¥è‡³äºè®¤ä¸ºè¿™ä¸ªåŸåˆ™æ˜¯ä¸æ˜¯å¤šä½™çš„ã€‚ç»“åˆäº†jmmå†…å­˜æ¨¡å‹æ¥çœ‹çš„è¯å°±å¾ˆå¥½ç†è§£äº†ï¼Œä¸€ä¸ªæ“ä½œå®Œæˆï¼Œå…¶ç»“æœåªæ˜¯åœ¨çº¿ç¨‹å†…å¯è§çš„ï¼Œåœ¨ç»“æœå†™å›ä¸»å­˜å¹¶è¢«å…¶ä»–çº¿ç¨‹è¯»å–å‰ï¼Œå³ä½¿å…¶ä»–çº¿ç¨‹æ“ä½œé åï¼Œä¹Ÿæ— æ³•çœ‹è§å…¶æ“ä½œç»“æœã€‚æ‰€ä»¥æ‰ä¼šæœ‰volatileã€é”ç­‰ä¸€ç³»åˆ—å¯è§æ€§åŸåˆ™çš„çº¦æŸ","like_count":61,"discussions":[{"author":{"id":1510177,"avatar":"https://static001.geekbang.org/account/avatar/00/17/0b/21/f1aea35b.jpg","nickname":"let_me_go","note":"","ucode":"A5936F5C5E3D65","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":363905,"discussion_content":"æ·±æœ‰åŒæ„Ÿ,æœ€å¼€å§‹è§‰å¾—å¾ˆå¤šè§„å®šéƒ½æ˜¯å¤šæ­¤ä¸€ä¸¾,æ˜¯å› ä¸ºæˆ‘ä¸€ç›´ç«™åœ¨äº†å•çº¿ç¨‹çš„è§’åº¦æ¥çœ‹,è®¤ä¸ºå¾ˆå¤šè§„å®šæœ¬è¯¥å¦‚æ­¤,ä½†æ˜¯æ”¾åœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹,å¾ˆå¤šå•çº¿ç¨‹ä¸‹ç†æ‰€åº”åˆ°çš„äº‹å°±ä¸æ˜¯é‚£ä¹ˆç†æ‰€åº”å½“äº†ã€‚æ€ç»´æå‡","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1617325076,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2302962,"avatar":"","nickname":"Geek_30bf18","note":"","ucode":"63DB0CA5C040F6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377526,"discussion_content":"æ‰€ä»¥å«å†…å­˜å¯è§æ€§ï¼Œå†…å­˜ä¿©å­—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622695726,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":16313,"user_name":"Ab","can_delete":false,"product_type":"c1","uid":1039466,"ip_address":"","ucode":"8E9261782F025D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/dc/6a/b5478b65.jpg","comment_is_top":false,"comment_ctime":1531878191,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"83136256815","product_id":100006701,"comment_content":"jmmå¯ä»¥ä»ä¸¤ä¸ªæ–¹é¢ç†è§£ï¼Œä¸€æ˜¯æŠ½è±¡å†…å­˜ç»“æ„ï¼ŒjmmæŠŠå†…å­˜ç»“æ„æŠ½è±¡æˆä¸»å†…å­˜å’Œçº¿ç¨‹æœ¬åœ°å†…å­˜ä¸¤ç§ï¼Œåœ¨è®¡ç®—æ—¶ï¼Œä»ä¸»å†…å­˜ä¸­åŠ è½½æ•°æ®ï¼Œåœ¨æœ¬åœ°å†…å­˜è®¡ç®—ï¼Œç„¶ååœ¨åˆ·æ–°åˆ°ä¸»å†…å­˜ï¼Œä½†è¿™ç§æ¨¡å‹æœ‰æ˜æ˜¾çš„ä¸€è‡´æ€§é—®é¢˜ï¼ŒäºŒæ˜¯jmmå¯ä»¥ç†è§£æˆ‘ä¸€ç»„ä¿ä½å†…å­˜å¯è§æ€§åŠæˆæ­£ç¡®æ€§çš„è§„èŒƒï¼Œå› ä¸ºè¿™ç§æ¨¡å‹å­˜åœ¨æ˜æ˜¾çš„ä¸€è‡´æ€§é—®é¢˜ï¼ŒåŒæ—¶ï¼Œç”±äºjavaç¼–è¯‘å™¨æŒ‡ä»¤é‡æ’åºä¼˜åŒ–å’Œcpuä¹±åºæ‰§è¡Œä¼˜åŒ–çš„å­˜åœ¨ï¼Œä½¿é—®é¢˜å˜å¾—æ›´åŠ å¤æ‚ï¼Œæ‰€ä»¥jmmåŸºäºå†…å­˜å±éšœæä¾›äº†ç±»ä¼¼sa if serialä»¥åŠhappens beforeçš„ä¿éšœã€‚ä»ä½¿ç”¨è€…çš„è§’åº¦ç†è§£ï¼Œjmmå¹³è¡¡äº†jvmå·¥ç¨‹å¸ˆä»¥åŠcpuå·¥ç¨‹å¸ˆåœ¨æ€§èƒ½ä¸Šçš„éœ€æ±‚å’Œjavaç¨‹åºå‘˜åœ¨ç®€å•æ€§ä¸Šçš„æ¸´æœ›ï¼Œæ‰€ä»¥jmmåœ¨ä¿è¯æ­£ç¡®æ€§çš„åŒæ—¶ä¼šæœ€å¤§é™åº¦çš„æ”¾å®½å¯¹æŒ‡ä»¤é‡æ’å’Œä¹±åºæ‰§è¡Œçš„é™åˆ¶ã€‚å¯¹äºjavaç¨‹åºå‘˜ï¼Œjmmæä¾›äº†å¦‚volatileå’Œsynchronizedè¿™æ ·çš„é¡¶å±‚æœºåˆ¶ä¸ºç¨‹åºå‘˜æä¾›ç®€å•çš„ç¼–ç¨‹æ¨¡å‹ã€‚ï¼ˆå‚è€ƒè€å¸ˆçš„æ–‡ç« åŠjavaå¹¶å‘ç¼–ç¨‹è‰ºæœ¯ ç†è§£ï¼‰","like_count":20},{"had_liked":false,"id":15664,"user_name":"æäºŒæœ¨","can_delete":false,"product_type":"c1","uid":1103091,"ip_address":"","ucode":"30E03BB84ADB27","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/f3/129d6dfe.jpg","comment_is_top":false,"comment_ctime":1531363337,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"57365938185","product_id":100006701,"comment_content":"åˆšçœ‹å®Œæ–‡ç« ï¼Œåœ¨çœ‹äº†ä¸‹ã€Šæ·±å…¥JAVAè™šæ‹Ÿæœºã€‹çš„javaå†…å­˜æ¨¡å‹ç« èŠ‚ï¼ŒåˆåŠ æ·±ç‚¹å°è±¡ã€‚è¿™æœ¬ä¹¦çœŸä¸èƒ½åƒå°è¯´ä¸€æ ·è¯»ï¼","like_count":14,"discussions":[{"author":{"id":1142198,"avatar":"https://static001.geekbang.org/account/avatar/00/11/6d/b6/67f8f097.jpg","nickname":"L","note":"","ucode":"AFF206EF3DF651","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":562396,"discussion_content":"ä½†æ˜¯ç¬¬ä¸€éçœŸçš„åªèƒ½åƒè¯»å°è¯´ä¸€æ ·å»è¯»ï¼Œè¦ä¸ç„¶è¯»ä¸ä¸‹å»ï¼ï¼ï¼","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1649818854,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":20020,"user_name":"è ¢è ¢æ¬²åŠ¨çš„è…¹è‚Œ","can_delete":false,"product_type":"c1","uid":1007326,"ip_address":"","ucode":"B10550BF463017","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5e/de/4e7ec66d.jpg","comment_is_top":false,"comment_ctime":1534216427,"is_pvip":false,"replies":[{"id":"7564","content":"å¯¹ï¼Œè¿™é‡Œæœ‰å„ç§trickyçš„æŠ€å·§","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1535038387,"ip_address":"","comment_id":20020,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35893954795","product_id":100006701,"comment_content":"åœ¨ç½‘ä¸Šçœ‹äº†ä¸‹è®©åŒæ£€é”ç”Ÿæ•ˆçš„æ–¹æ³•ï¼Œé™¤äº†ç”¨volatileä¿®é¥°å˜é‡å¤–ï¼Œè¿˜æœ‰å…¶ä»–ä¸¤ç§æ–¹å¼<br>1ã€ç”¨final ä¿®é¥°å˜é‡<br>2ã€ç”¨æœ¬åœ°çº¿ç¨‹çš„æ–¹å¼ä¿®å¤ï¼Œå³åœ¨åˆ›å»ºå¯¹è±¡æ—¶å­˜å–æœ¬åœ°çº¿ç¨‹ï¼ˆfinalçš„ï¼‰ï¼Œåœ¨getçš„æ—¶å€™å†ä»æœ¬åœ°å–<br>","like_count":8,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":422066,"discussion_content":"å¯¹ï¼Œè¿™é‡Œæœ‰å„ç§trickyçš„æŠ€å·§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1535038387,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":16317,"user_name":"Ab","can_delete":false,"product_type":"c1","uid":1039466,"ip_address":"","ucode":"8E9261782F025D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/dc/6a/b5478b65.jpg","comment_is_top":false,"comment_ctime":1531879646,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"31596650718","product_id":100006701,"comment_content":"jmmå¯ä»¥ä»ä¸¤ä¸ªæ–¹é¢ç†è§£ï¼Œç¬¬ä¸€ä¸ªæ–¹é¢æ˜¯jmmè§„èŒƒäº†ä¸€ä¸ªæŠ½è±¡çš„å†…å­˜ç»“æ„ï¼Œjmmè¿è¡Œæ—¶å†…å­˜è¿›è¡Œç®€åŒ–æŠ½è±¡å¾—åˆ°äº†ä¸»å†…å­˜å’Œæœ¬åœ°å†…å­˜ä¸¤å—å†…å­˜åŒºåŸŸï¼Œåœ¨çº¿ç¨‹è¿è¡Œæ—¶ï¼Œä»ä¸»å†…å­˜ä¸­åŠ è½½æ•°æ®åˆ°æœ¬åœ°å†…å­˜ï¼Œåœ¨æœ¬åœ°å†…å­˜ä¸­å®Œæˆè®¡ç®—åï¼Œåœ¨åˆ·æ–°åˆ°ä¸»å†…å­˜ã€‚ç¬¬äºŒä¸ªæ–¹é¢æ˜¯jmmå¯ä»¥ç†è§£æˆ‘ä¸€ç»„ä¿è¯æ•°æ®å†…å­˜å¯è§æ€§å’Œç¨‹åºæ­£ç¡®æ€§çš„è§„åˆ™ï¼Œç”±äºè¿™ç§å†…å­˜æ¨¡å‹å­˜åœ¨å¾ˆæ˜æ˜¾çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œå†åŠ ä¸Šç¼–è¯‘å™¨çš„æŒ‡ä»¤é‡æ’åºå’Œcpuä¹±åºæ‰§è¡Œä¼˜åŒ–ï¼Œä½¿é—®é¢˜æ›´åŠ å¤æ‚äº†ï¼Œè€Œjmmå°±æ˜¯é€šè¿‡ç±»ä¼¼å†…å­˜å±éšœç­‰æ‰‹æ®µä¿è¯äº†å†…å­˜å¯è§æ€§é—®é¢˜ä»¥åŠåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¹±åºä¼˜åŒ–å’ŒæŒ‡ä»¤é‡æ’åºå¸¦æ¥çš„çº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ã€‚ä»ä½¿ç”¨è€…çš„è§’åº¦ç†è§£ï¼Œjmmå®é™…ä¸Šå¹³è¡¡äº†javaç¨‹åºå‘˜å¯¹ç®€å•æ€§çš„æ¸´æœ›å’Œjvmå·¥ç¨‹å¸ˆcpuå·¥ç¨‹å¸ˆå¯¹æ€§èƒ½çš„è¿½æ±‚çš„å¹³è¡¡ï¼Œé¢å‘åº•å±‚æ—¶ï¼Œjmmåœ¨ä¿è¯æ­£ç¡®æ€§çš„åŒæ—¶æœ€å¤§é™åº¦çš„æ”¾å®½äº†å¯¹æŒ‡ä»¤é‡æ’åºå’Œä¹±åºæ‰§è¡Œä¼˜åŒ–çš„é™åˆ¶ï¼Œé¢å‘ä¸Šå±‚jmmé€šè¿‡å†…å­˜å±éšœå®ç°äº†volatileå’Œsynchronizedç­‰å†…å­˜è¯­æ„ï¼Œä½¿ç¨‹åºå‘˜å¯ä»¥ç®€å•æ–¹ä¾¿çš„åº”ç”¨è¿™äº›ç‰¹æ€§æ¥ä¿è¯ç¨‹åºçš„ç¨‹åºçš„æ­£ç¡®æ€§ã€‚<br>","like_count":8},{"had_liked":false,"id":223511,"user_name":"å¼ ä¸‰","can_delete":false,"product_type":"c1","uid":1004092,"ip_address":"","ucode":"1155528FAE1546","user_header":"https://static001.geekbang.org/account/avatar/00/0f/52/3c/d6fcb93a.jpg","comment_is_top":false,"comment_ctime":1591104457,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27360908233","product_id":100006701,"comment_content":"volitaileçš„æ„ä¹‰åœ¨äºç¦ç”¨ç¼“å­˜","like_count":7},{"had_liked":false,"id":20038,"user_name":"é£è½¨","can_delete":false,"product_type":"c1","uid":1185844,"ip_address":"","ucode":"7B8A5233B61EB0","user_header":"https://static001.geekbang.org/account/avatar/00/12/18/34/c082419c.jpg","comment_is_top":false,"comment_ctime":1534224331,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27304028107","product_id":100006701,"comment_content":"å…ˆçœ‹äº†ä¸¤éï¼Œå§‹ç»ˆå¤„äºæ‡µé€¼çš„çŠ¶æ€ï¼Œåæ¥å»æŠŠã€Šæ·±å…¥ç†è§£javaè™šæ‹Ÿæœºã€‹ç›¸å…³éƒ¨åˆ†ä»”ç»†é˜…è¯»ä¸€ä¸‹ï¼Œå†å›æ¥çœ‹ç»ˆäºçœ‹æ‡‚äº†ï¼","like_count":7},{"had_liked":false,"id":272017,"user_name":"éšå¿ƒè€Œè‡³","can_delete":false,"product_type":"c1","uid":1097836,"ip_address":"","ucode":"31866865255101","user_header":"https://static001.geekbang.org/account/avatar/00/10/c0/6c/29be1864.jpg","comment_is_top":false,"comment_ctime":1609912359,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10199846951","product_id":100006701,"comment_content":"æˆ‘ä¹‹å‰ç¿»è¯‘è¿‡JSR-133 Cookbook, æ˜¯ä¸­è‹±æ–‡å¯¹ç…§ç‰ˆçš„ï¼Œè‹±æ–‡ä¸å¥½çš„åŒå­¦å¯ä»¥å¯¹ç…§çœ‹çœ‹ã€‚<br>https:&#47;&#47;yellowstar5.cn&#47;direct&#47;The%20JSR-133%20Cookbook-chinese.html<br>","like_count":3},{"had_liked":false,"id":19482,"user_name":"clz1341521","can_delete":false,"product_type":"c1","uid":1179557,"ip_address":"","ucode":"3BDB4AB454C918","user_header":"https://static001.geekbang.org/account/avatar/00/11/ff/a5/eccc7653.jpg","comment_is_top":false,"comment_ctime":1533861539,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10123796131","product_id":100006701,"comment_content":"1,éªŒè¯å‡º â€œå¯è§æ€§é—®é¢˜â€,è¿™ä¸ªå¾ˆå®¹å¤ç°<br>2,éªŒè¯å‡ºâ€œcpuæŒ‡ä»¤ä¼˜åŒ–é‡æ’â€å¯¼è‡´çš„å¦‚ åŒæ£€é” ä¸­å¯¹è±¡æœªåˆå§‹åŒ–å®Œæ¯•ï¼Œå³è¢«ä½¿ç”¨é—®é¢˜ã€‚è¿™ä¸ªå¯¹è±¡æ„é€ è¦æ…¢ï¼Œæ‰å®¹æ˜“å¤ç°<br>","like_count":2},{"had_liked":false,"id":134856,"user_name":"éšå¿ƒè€Œè‡³","can_delete":false,"product_type":"c1","uid":1097836,"ip_address":"","ucode":"31866865255101","user_header":"https://static001.geekbang.org/account/avatar/00/10/c0/6c/29be1864.jpg","comment_is_top":false,"comment_ctime":1568943400,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5863910696","product_id":100006701,"comment_content":"é…åˆæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºç¬¬12ç« é£Ÿç”¨ï¼Œæ•ˆæœæ›´ä½³","like_count":1},{"had_liked":false,"id":15614,"user_name":"ç”²éŸ­","can_delete":false,"product_type":"c1","uid":1052321,"ip_address":"","ucode":"2E998B8CB17F4E","user_header":"https://static001.geekbang.org/account/avatar/00/10/0e/a1/152a5de1.jpg","comment_is_top":false,"comment_ctime":1531352657,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5826319953","product_id":100006701,"comment_content":"è€å¸ˆğŸ™‹â€â™‚ï¸æˆ‘æœ‰ä¸ªé—®é¢˜ï¼š<br>æœ‰ä¸€ä¸ªå…¨å±€çš„ConcurrentHashMap&lt;String,Set&lt;Foo&gt;&gt;<br>Keyæ˜¯Fooçš„ä¸€ä¸ªå­—ç¬¦ä¸²å±æ€§<br>ç„¶åæœ‰ä¸€ä¸ªæ–¹æ³•<br>é€šè¿‡Foo.getStr() ä»¥æ­¤ä¸ºkeyåˆ¤æ–­æ˜¯å¦å­˜åœ¨map ä¸­å¦‚æœä¸å­˜åœ¨å°±åˆ›å»ºä¸€ä¸ªsetæ·»åŠ åˆ°map<br>ç°åœ¨è¿™ä¸ªæ–¹æ³•å¹¶å‘æƒ…å†µä¸‹ç¬¬ä¸€æ¬¡åˆ›å»ºSetæ—¶ä¼šå‡ºç°æ›¿æ¢Setçš„é—®é¢˜ï¼Œæˆ‘æƒ³å¦‚ä½•é€šè¿‡volitileè§£å†³ï¼ŸåŸè°…å­¦ç”Ÿæ„šé’.","like_count":1},{"had_liked":false,"id":315382,"user_name":"å‰‘å…«","can_delete":false,"product_type":"c1","uid":1297630,"ip_address":"","ucode":"0A09F41DB8A4E7","user_header":"https://static001.geekbang.org/account/avatar/00/13/cc/de/e28c01e1.jpg","comment_is_top":false,"comment_ctime":1633872023,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1633872023","product_id":100006701,"comment_content":"jmmå°±æ˜¯javaå†…å­˜æ¨¡å‹è§„èŒƒï¼Œè§£å†³é—®é¢˜-<br>è®©ç¨‹åºå‘˜ä¸éœ€è¦ç‰¹åˆ«å…³å¿ƒåº•å±‚cpuæ¶æ„å¯¹äºå¹¶å‘çš„å½±å“ã€‚<br>jmmæŠ½è±¡äº†å…±äº«å†…å­˜ä¸å·¥ä½œå†…å­˜ï¼ŒåŒ…å«äº†ä¸€ç³»åˆ—è§„åˆ™ï¼Œå¦‚happen beforï¼Œåªè¦éµå¾ªè¿™ä¸ªè§„èŒƒå°±å¯ä»¥è§£å†³å¤šçº¿ç¨‹å¹¶å‘é—®é¢˜","like_count":0},{"had_liked":false,"id":307262,"user_name":"è´æ°å€­ç‹çŒ´","can_delete":false,"product_type":"c1","uid":1100690,"ip_address":"","ucode":"0A89A70C48629C","user_header":"https://static001.geekbang.org/account/avatar/00/10/cb/92/cfc1cfd3.jpg","comment_is_top":false,"comment_ctime":1628993409,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628993409","product_id":100006701,"comment_content":"&quot;ä½ å¯ä»¥ç®€å•ç†è§£ä¸ºï¼ŒæŠŠæœ¬åœ°å˜é‡ç­‰æ•°æ®ä»å†…å­˜åŠ è½½åˆ°ç¼“å­˜ã€å¯„å­˜å™¨ï¼Œç„¶åè¿ç®—ç»“æŸå†™å›ä¸»å†…å­˜ã€‚&quot;è¿™å¥è¯æœ‰ç‚¹ç–‘é—®ï¼Œå› ä¸ºä»æ±‡ç¼–æŒ‡ä»¤æ¥è¯´ï¼Œå¤„ç†å™¨ä¹Ÿæ˜¯å¯ä»¥æ¥å—ä¸»å­˜ä½œä¸ºå•ä¸ªæ“ä½œæ•°çš„ã€‚éš¾é“JVMçš„æ“ä½œéƒ½æ˜¯æŠŠä¸»å­˜æ‹·å…¥å¯„å­˜å™¨ä¹‹åå†æ“ä½œï¼Œä¸ç”¨ä¸»å­˜å½“æˆå•ä¸ªæ“ä½œç¬¦çš„æ±‡ç¼–æŒ‡ä»¤ï¼Ÿ","like_count":0},{"had_liked":false,"id":305638,"user_name":"ä¸å½’æ©™","can_delete":false,"product_type":"c1","uid":1319969,"ip_address":"","ucode":"4F3D84E9395F61","user_header":"https://static001.geekbang.org/account/avatar/00/14/24/21/90b748a2.jpg","comment_is_top":false,"comment_ctime":1628081266,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1628081266","product_id":100006701,"comment_content":"äºŒåˆ·ï¼Œæ„Ÿè§‰å¯¹â€œå…‹åˆ¶ä½å¯¹â€œç§˜ç±â€çš„è¯±æƒ‘â€çš„æè¿°ä¸æ˜¯å¾ˆç†è§£ï¼Œè€å¸ˆå¯ä»¥ä¸¾ä¸ªä¾‹å­å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1013056,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/75/40/279c1a86.jpg","nickname":"å”äºŒå“¥","note":"","ucode":"43B1642C78A915","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547205,"discussion_content":"é¢å¯¹é—®é¢˜å¾ˆå¤šæ—¶å€™æœ‰å„ç§å°æŠ€å·§æ¥è§£å†³ï¼Œç®€ç§°ç§˜ç±ï¼Œä½†é‚£äº›æ—¢ä¸æˆä½“ç³»ï¼Œä¹Ÿæ²¡å¿…è¦ï¼Œä¸è¦æ²‰è¿·å…¶ä¸­è‡ªå—¨ï¼Œè¿˜æ˜¯è¦èµ°å¤§è·¯ä¼šæ¯”è¾ƒé¡ºã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1642579960,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296880,"user_name":"ğŸŸğŸ™ğŸ¬ğŸ†ğŸ¦ŒğŸ¦ğŸ‘ğŸ¦ƒ","can_delete":false,"product_type":"c1","uid":1531189,"ip_address":"","ucode":"2F954654BCE13B","user_header":"https://static001.geekbang.org/account/avatar/00/17/5d/35/b1eb964a.jpg","comment_is_top":false,"comment_ctime":1623209257,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1623209257","product_id":100006701,"comment_content":"è€å¸ˆï¼Œçº¿ç¨‹åœ¨è‡ªå·±çš„å·¥ä½œå†…å­˜ä¸­è¯»å†™å˜é‡ï¼Œå˜é‡æ˜¯é€šè¿‡read loadæ“ä½œä»ä¸»å†…å­˜åˆ°å·¥ä½œå†…å­˜çš„ï¼Œåœ¨readåŸå­æ“ä½œè¯´æŠŠå˜é‡ä»ä¸»å†…å­˜è¯»å–åˆ°å·¥ä½œå†…å­˜ï¼Œä»¥ä¾¿éšåçš„loadæ“ä½œï¼Œè€ŒloadåŸå­æ“ä½œå®šä¸ºæŠŠä»ä¸»å†…å­˜readçš„å˜é‡load å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ï¼Œè¿™é‡Œreadå’Œloadå¦‚ä½•ç†è§£ï¼Œå®é™…ä¸Šä¸å°±æ˜¯å§å†…å­˜çš„å˜é‡æ”¾å…¥CPUé«˜é€Ÿç¼“å­˜ä¹ˆï¼Œæ€ä¹ˆå°±æœ‰2ä¸ªæ“ä½œï¼Œreadå’Œload","like_count":0},{"had_liked":false,"id":282148,"user_name":"é±¼","can_delete":false,"product_type":"c1","uid":1487584,"ip_address":"","ucode":"89EC9CE3AD0281","user_header":"https://static001.geekbang.org/account/avatar/00/16/b2/e0/d856f5a4.jpg","comment_is_top":false,"comment_ctime":1615107478,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615107478","product_id":100006701,"comment_content":"è¯·é—®å†…å­˜å±éšœå’ŒCPU fenceæŒ‡ä»¤æ˜¯ä¸€ä¸ªæ¦‚å¿µå—ï¼Ÿçœ‹äº†å¥½å‡ ç¯‡æ–‡æ¡£ï¼Œæ²¡æœ‰æŠŠä¸¤è€…åŒºåˆ†å¼€æ¥ã€‚","like_count":0},{"had_liked":false,"id":272025,"user_name":"éšå¿ƒè€Œè‡³","can_delete":false,"product_type":"c1","uid":1097836,"ip_address":"","ucode":"31866865255101","user_header":"https://static001.geekbang.org/account/avatar/00/10/c0/6c/29be1864.jpg","comment_is_top":false,"comment_ctime":1609913043,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609913043","product_id":100006701,"comment_content":"ä¸ºä»€ä¹ˆéœ€è¦JMMï¼Ÿ<br>ä¸åŒCPUæ¶æ„æä¾›ä¸åŒçš„å†…å­˜å±éšœæŒ‡ä»¤å’Œå†…å­˜ä¸€è‡´æ€§æ¨¡å‹ï¼ˆä¸»è¦ç”±ç¡¬ä»¶å·¥ç¨‹å¸ˆå®ç°ï¼‰ï¼›ä¸ºäº†å¯¹ä¸Šå±‚éšè—å„ç§CPUæ¶æ„çš„ä¸åŒï¼ŒDoug LeaåŸºäºæ­¤åˆæå‡ºäº†JVMå±‚é¢çš„LoadLoadï¼ŒStoreStoreç­‰å†…å­˜å±éšœï¼ˆç”±JVMå®ç°è€…å®ç°ï¼‰ï¼›ç„¶åJVMå®ç°è€…åˆ™æä¾›ç»Ÿä¸€çš„Javaå†…å­˜æ¨¡å‹ï¼ˆæ¯”å¦‚Javaè¯­è¨€è§„èŒƒ ç¬¬å…«ç‰ˆ 17ç« ï¼‰ï¼›ç„¶åæˆ‘ä»¬è¿™äº›æ™®é€šçš„Javaå¼€å‘è€…å°±åœ¨è¿™ç»Ÿä¸€çš„Javaå†…å­˜æ¨¡å‹ä¸Šå†™è·¨å¹³å°çš„åº”ç”¨ã€‚<br>","like_count":0},{"had_liked":false,"id":192708,"user_name":"æŠ¤çˆ½ä½¿è€…","can_delete":false,"product_type":"c1","uid":1275464,"ip_address":"","ucode":"12DC35DD74671C","user_header":"https://static001.geekbang.org/account/avatar/00/13/76/48/5ab89daa.jpg","comment_is_top":false,"comment_ctime":1584869159,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584869159","product_id":100006701,"comment_content":"volatile ä¿è¯å¯è§æ€§ï¼Œvolatile çš„ happens-before æ€ä¹ˆç†è§£ï¼Ÿ","like_count":0},{"had_liked":false,"id":175159,"user_name":"S","can_delete":false,"product_type":"c1","uid":1518689,"ip_address":"","ucode":"2B02E9548DA952","user_header":"https://static001.geekbang.org/account/avatar/00/17/2c/61/bede8a20.jpg","comment_is_top":false,"comment_ctime":1580575723,"is_pvip":true,"discussion_count":2,"race_medal":0,"score":"1580575723","product_id":100006701,"comment_content":"æ¨è€å¸ˆï¼Œè¯·æ•™ä¸ªé—®é¢˜ï¼š<br>åœ¨è¯´volatileå¯è§æ€§ä¸¾çš„ä¸¤ä¸ªä¾‹å­ä¸­ï¼Œé’ˆå¯¹ç¬¬ä¸€ä¸ªï¼Œä¸ºä»€ä¹ˆåœ¨æ­»å¾ªç¯ä¸­æ·»åŠ äº†ä¸€ä¸ªSystem.outå°±ä¼šä½¿æ­»å¾ªç¯é€€å‡ºï¼Ÿè¿™ä¸ªSystem.outä¸ºå•¥ä¼šèµ·åˆ°ä½œç”¨","like_count":1,"discussions":[{"author":{"id":1014665,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7b/89/34f2cbcc.jpg","nickname":"æ¨å®‡","note":"","ucode":"EB74DF6E269F03","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":263200,"discussion_content":"ä¸æ¢è¡Œçš„printæ–¹æ³•è°ƒç”¨äº†java.io.PrintStream#write(String)ï¼ŒåŒæ ·çš„synchronized(this)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589186847,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1014665,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7b/89/34f2cbcc.jpg","nickname":"æ¨å®‡","note":"","ucode":"EB74DF6E269F03","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":263199,"discussion_content":"java.io.PrintStream#printlnçš„å„ç§é‡è½½æ–¹æ³•éƒ½è°ƒç”¨äº†newLine()ï¼Œè€Œåè€…ä½¿ç”¨äº†synchronized(this)ã€‚æ­¤å¤–println(String)æ–¹æ³•ä¸€ä¸Šæ¥å°±ä¼šsynchronized (this)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589186763,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":150218,"user_name":"ç‹ç››æ­¦","can_delete":false,"product_type":"c1","uid":1182516,"ip_address":"","ucode":"DE7EF246D3DCE8","user_header":"https://static001.geekbang.org/account/avatar/00/12/0b/34/f41d73a4.jpg","comment_is_top":false,"comment_ctime":1573479949,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573479949","product_id":100006701,"comment_content":"è€å¸ˆè®²äº†JSR133é‡Œçš„1ä¸ªè§„åˆ™, volatile","like_count":0},{"had_liked":false,"id":146375,"user_name":"dddddğŸ³","can_delete":false,"product_type":"c1","uid":1451640,"ip_address":"","ucode":"EFEA2FBB27ECFE","user_header":"https://static001.geekbang.org/account/avatar/00/16/26/78/ed0252c2.jpg","comment_is_top":false,"comment_ctime":1572509602,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572509602","product_id":100006701,"comment_content":"å…³äºvolatileçš„è¿™å¥æè¿°-â€œå¯¹äº volatile å˜é‡ï¼Œå¯¹å®ƒçš„å†™æ“ä½œï¼Œä¿è¯ happen-before åœ¨éšåå¯¹è¯¥å˜é‡çš„è¯»å–æ“ä½œã€‚â€ï¼Œæˆ‘å§‹ç»ˆä¸ç†è§£ï¼Œå†™äº†å¾ˆå¤šdemoæµ‹è¯•ï¼Œä¹Ÿæ²¡å¼„æ¸…æ¥šï¼Œè€å¸ˆèƒ½ç»™ä¸ªç®€å•çš„demo codeå—ï¼Ÿï¼›","like_count":0},{"had_liked":false,"id":124353,"user_name":"yzh","can_delete":false,"product_type":"c1","uid":1395798,"ip_address":"","ucode":"B6C06FEB731BDC","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKcGBqEZQKHjq3XaSZRLmxrCykMEotI0yKWX7RbbPZh6xTdmNRsum2YxtHv33zHGFdVqxic1pIEn8Q/132","comment_is_top":false,"comment_ctime":1565865240,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565865240","product_id":100006701,"comment_content":"è€æ˜¯ï¼Œå…·ä½“æœ‰ä»€ä¹ˆå·¥å…·å¯ä»¥éªŒè¯JMMçš„æ‰€æœ‰æ‰§è¡Œå¯èƒ½","like_count":0},{"had_liked":false,"id":109928,"user_name":"æµªå°–","can_delete":false,"product_type":"c1","uid":1221820,"ip_address":"","ucode":"65A009976AFC6C","user_header":"https://static001.geekbang.org/account/avatar/00/12/a4/bc/02596f1a.jpg","comment_is_top":false,"comment_ctime":1562135807,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1562135807","product_id":100006701,"comment_content":"è¯»æ“ä½œæ’å…¥çš„å±éšœï¼Œä¸éƒ½æ˜¯åœ¨volatileè¯»ä¹‹åå—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1221820,"avatar":"https://static001.geekbang.org/account/avatar/00/12/a4/bc/02596f1a.jpg","nickname":"æµªå°–","note":"","ucode":"65A009976AFC6C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":895,"discussion_content":"å¯¹äºvolatileè¯»åº”æ˜¯è¿™æ ·çš„å§ï¼š\n    åœ¨æ¯ä¸ªvolatileè¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ªLoadLoadå±éšœï¼›\n    åœ¨æ¯ä¸ªvolatileè¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ªLoadStoreå±éšœã€‚\nè€Œæ–‡ä¸­æ˜¯ï¼š\n    å¯¹è¯¥å˜é‡çš„è¯»æ“ä½œä¹‹å‰ï¼Œç¼–è¯‘å™¨ä¼šæ’å…¥ä¸€ä¸ªè¯»å±éšœ\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562142134,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":101505,"user_name":"è°¢æ¶›","can_delete":false,"product_type":"c1","uid":1108586,"ip_address":"","ucode":"458E15EB79A196","user_header":"https://static001.geekbang.org/account/avatar/00/10/ea/6a/e4443e5e.jpg","comment_is_top":false,"comment_ctime":1559832016,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1559832016","product_id":100006701,"comment_content":"èŒ…å¡é¡¿å¼€äº†ï¼Œèµ","like_count":0},{"had_liked":false,"id":72426,"user_name":"å†°æ¿€å‡Œçš„çœ¼æ³ª","can_delete":false,"product_type":"c1","uid":1087945,"ip_address":"","ucode":"5DCB974667E93A","user_header":"https://static001.geekbang.org/account/avatar/00/10/99/c9/a7c77746.jpg","comment_is_top":false,"comment_ctime":1551622912,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1551622912","product_id":100006701,"comment_content":"å•çº¿ç¨‹å†…çš„happens beforeå’Œä¼˜åŒ–åçš„æœ‰åºæ€§ä¸å†²çªå—ï¼Ÿè¿™é‡Œçš„happens beforeæ˜¯æŒ‡çš„é«˜çº§è¯­è¨€è¯­å¥çº§è¿˜æ˜¯cpuæŒ‡ä»¤çº§å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1541386,"avatar":"https://static001.geekbang.org/account/avatar/00/17/85/0a/e564e572.jpg","nickname":"N_H","note":"","ucode":"109B67557AB3CE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":19212,"discussion_content":"jvmçº§åˆ«å§ï¼Œjvmä»¥åŠjavaç¼–è¯‘å™¨å®ç°äº†è¿™æ ·çš„è§„èŒƒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569151122,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69082,"user_name":"","can_delete":false,"product_type":"c1","uid":1027170,"ip_address":"","ucode":"","user_header":"","comment_is_top":false,"comment_ctime":1550657399,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1550657399","product_id":100006701,"comment_content":"æ¨è€å¸ˆï¼Œè¯·æ•™ä¸ªé—®é¢˜ï¼Œå‰é¢è¯´åˆ°çš„volatileå˜é‡æ˜¯åœ¨å†™æ“ä½œä¹‹åï¼Œç¼–è¯‘å™¨æ’å…¥ä¸€ä¸ªå†™å±éšœï¼Œä¸ºä»€ä¹ˆä¸æ˜¯åœ¨å†™æ“ä½œä¹‹å‰ï¼Œå’Œæˆ‘ç†è§£æœ‰ç‚¹å‡ºå…¥ï¼Œæœ›èµæ•™ã€‚","like_count":0,"discussions":[{"author":{"id":2938089,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/V71ITElU4RwprR74pPXB6LhIMrfeAHuHjicZmS7smy2tibBSMoA9awaTe86wziatYzoy3qVOGs0DnSTy6ah5L6bKA/132","nickname":"å››å–œä¸¸å­","note":"","ucode":"33D46CC1B747BA","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578005,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656469653,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":18189,"user_name":"ç”²éŸ­","can_delete":false,"product_type":"c1","uid":1052321,"ip_address":"","ucode":"2E998B8CB17F4E","user_header":"https://static001.geekbang.org/account/avatar/00/10/0e/a1/152a5de1.jpg","comment_is_top":false,"comment_ctime":1533181554,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1533181554","product_id":100006701,"comment_content":"ä¹‹å‰çš„é—®é¢˜æ‰¾åˆ°è§£å†³æ–¹æ³•äº†ï¼Œå°±æ˜¯ä½¿ç”¨concurrenthashmapçš„computeIfAbsentæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯åŠ é”çš„.<br>æ–‡ä¸­æåˆ°çš„volatileçš„ä¾‹å­ï¼Œæˆ‘è¯•äº†ä¸€ä¸‹å¹¶æ²¡æœ‰å¤ç°å‡ºæ¥ï¼Œæ ¹æ®ã€Šæ·±å…¥ç†è§£JVMã€‹è¿™æœ¬ä¹¦å…³äºvolatileçš„ä¾‹å­å¤ç°å‡ºæ¥äº†ï¼Œäº†è§£äº†volatileå¹¶ä¸èƒ½ä¿è¯å­—æ®µçº¿ç¨‹å®‰å…¨<br>ç„¶åBrian Goetzçš„ã€Šjava theory and practice:managing volatilityã€‹ä»”ç»†æ‹œè¯»äº†ä¸€ä¸‹ï¼Œè¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°èƒ½å¤Ÿç™¾åˆ†ç™¾å¤ç°å‡ºæ¥çš„åŠæ³•<br>è¯·é—®æœ‰ä»€ä¹ˆæ–¹æ³•èƒ½å¤Ÿç¨³å®šå¤ç°å‡ºæ¥æ–‡ä¸­çš„ä¾‹å­å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":16548,"user_name":"philip","can_delete":false,"product_type":"c1","uid":1176596,"ip_address":"","ucode":"BBEF738A26800D","user_header":"https://static001.geekbang.org/account/avatar/00/11/f4/14/629d3a2d.jpg","comment_is_top":false,"comment_ctime":1532016422,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1532016422","product_id":100006701,"comment_content":"è€å¸ˆvolatileå˜é‡çš„happens_beforä¸­uesä¹‹å‰å¿…é¡»loadã€‚ä½†æ˜¯loadäº†ä¸ä¸­é—´ä¸å¯¹å˜é‡è¿›è¡Œæ“ä½œï¼Œè¿‡ä¸€ä¼šå†æ“ä½œï¼Œä½†æ˜¯å…¶ä»–çº¿ç¨‹å·²ç»æ“ä½œäº†volitileå˜é‡ã€‚æ­¤æ—¶è¢«åŠ è½½åˆ°å·¥ä½œåŒºçš„volatileå˜é‡å†æ‰§è¡Œassginæ“ä½œæ—¶åº”è¯¥ä¸ä¼šé‡æ–°åŠ è½½ä¸»å­˜æ•°æ®äº†å¯¹ä¸ï¼Ÿ","like_count":0},{"had_liked":false,"id":16437,"user_name":"é¥­ç£Š","can_delete":false,"product_type":"c1","uid":1111359,"ip_address":"","ucode":"5008C387B423DE","user_header":"https://static001.geekbang.org/account/avatar/00/10/f5/3f/5777c705.jpg","comment_is_top":false,"comment_ctime":1531961257,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1531961257","product_id":100006701,"comment_content":"è€å¸ˆæˆ‘æƒ³é—®ä¸‹ ä¸ºä»€ä¹ˆjvmé‡Œé¢æœ‰æ—¶å€™è¯´çš„æ˜¯ç»‘å®šï¼Œæœ‰æ—¶å€™è¯´æ˜¯åˆ†æ´¾ï¼Œè¯·é—®è¿™ä¿©ä»€ä¹ˆåŒºåˆ«å‘€","like_count":0},{"had_liked":false,"id":16427,"user_name":"è¶…çº§ç©å®¶","can_delete":false,"product_type":"c1","uid":1029874,"ip_address":"","ucode":"D37E44E6C2E679","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b6/f2/c78f79e1.jpg","comment_is_top":false,"comment_ctime":1531958774,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1531958774","product_id":100006701,"comment_content":"æ¨å¤§å¤§ï¼Œfinalé™¤äº†ä¸å¯å˜çš„ä½œç”¨ï¼Œä¹Ÿèƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥èµ·åˆ°çº¿ç¨‹å®‰å…¨çš„ä½œç”¨ï¼Ÿfinalæ˜¯é€šè¿‡ä»€ä¹ˆæ–¹å¼æ¥åšåˆ°çº¿ç¨‹å®‰å…¨çš„ä½œç”¨çš„ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":2391701,"avatar":"","nickname":"Geek_a3890b","note":"","ucode":"BF67D080DAF96D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":403978,"discussion_content":"ä¸å¯å˜æ‰€ä»¥å®‰å…¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634202930,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":16066,"user_name":"mao","can_delete":false,"product_type":"c1","uid":1114652,"ip_address":"","ucode":"C8E0700E9A108A","user_header":"https://static001.geekbang.org/account/avatar/00/11/02/1c/a0aba121.jpg","comment_is_top":false,"comment_ctime":1531757042,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1531757042","product_id":100006701,"comment_content":"javaè™šæ‹Ÿæœºè§„èŒƒä¸­å¯¹å¯¹æ™®é€šå˜é‡çš„èµ‹å€¼æ˜¯ä¸æ˜¯ä¹Ÿå¼ºåˆ¶åˆ·æ–°åˆ°ä¸»å†…å­˜","like_count":0},{"had_liked":false,"id":15724,"user_name":"åˆ˜æ°","can_delete":false,"product_type":"c1","uid":1106503,"ip_address":"","ucode":"4B91701B322624","user_header":"https://static001.geekbang.org/account/avatar/00/10/e2/47/e910afec.jpg","comment_is_top":false,"comment_ctime":1531413949,"is_pvip":false,"replies":[{"id":"5471","content":"ä¸æ¸…æ¥šï¼Œè¿™ä¸ªæˆ‘æ²¡æƒ³åˆ°è§„èŒƒä¸­å“ªä¸€æ¡å¯ä»¥ä¿è¯ï¼›<br>å»ºè®®çœ‹çœ‹æ¯”è¾ƒæƒå¨çš„æ–‡ç«  https:&#47;&#47;shipilev.net&#47;blog&#47;2014&#47;safe-public-construction&#47;#_safe_initialization","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1531576088,"ip_address":"","comment_id":15724,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1531413949","product_id":100006701,"comment_content":"æ‚¨åˆè¯´åˆ°äº†å•ä¾‹æ¨¡å¼ä¸­çš„é‚£ä¸ªå…¶ä»–çº¿ç¨‹è®¿é—®åˆ°æœªåˆå§‹å®Œæˆå¯¹è±¡çš„é—®é¢˜ï¼Œå¿ä¸ä½å†é—®ä¸‹ï¼Œæ˜¯å¦å¯ä»¥å…ˆç”¨ä¸€ä¸ªå±€éƒ¨å˜é‡åˆå§‹åŒ–å¯¹è±¡ï¼Œå†æŠŠå±€éƒ¨å˜é‡èµ‹å€¼ç»™ç±»æˆå‘˜ï¼Ÿè¿™æ ·å¯ä»¥è§£å†³å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420533,"discussion_content":"ä¸æ¸…æ¥šï¼Œè¿™ä¸ªæˆ‘æ²¡æƒ³åˆ°è§„èŒƒä¸­å“ªä¸€æ¡å¯ä»¥ä¿è¯ï¼›\nå»ºè®®çœ‹çœ‹æ¯”è¾ƒæƒå¨çš„æ–‡ç«  https://shipilev.net/blog/2014/safe-public-construction/#_safe_initialization","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1531576088,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":15642,"user_name":"3W1H","can_delete":false,"product_type":"c1","uid":1066430,"ip_address":"","ucode":"F6B4864128103C","user_header":"https://static001.geekbang.org/account/avatar/00/10/45/be/c04a40ce.jpg","comment_is_top":false,"comment_ctime":1531358007,"is_pvip":false,"replies":[{"id":"5469","content":"å’Œå‡ ä¸ªæ–¹æ³•æ²¡å…³ç³»","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1531572078,"ip_address":"","comment_id":15642,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1531358007","product_id":100006701,"comment_content":"è€å¸ˆçš„ä¾‹å­é‡Œé¢çš„thread a,bçš„é€»è¾‘æ˜¯åœ¨ä¸€ä¸ªæ–¹æ³•é‡Œé¢å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420491,"discussion_content":"å’Œå‡ ä¸ªæ–¹æ³•æ²¡å…³ç³»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1531572078,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}