{"id":74059,"title":"18 | 为什么这些SQL语句逻辑相同，性能却差异巨大？","content":"<p>在MySQL中，有很多看上去逻辑相同，但性能却差异巨大的SQL语句。对这些语句使用不当的话，就会不经意间导致整个数据库的压力变大。</p><p>我今天挑选了三个这样的案例和你分享。希望再遇到相似的问题时，你可以做到举一反三、快速解决问题。</p><h1>案例一：条件字段函数操作</h1><p>假设你现在维护了一个交易系统，其中交易记录表tradelog包含交易流水号（tradeid）、交易员id（operator）、交易时间（t_modified）等字段。为了便于描述，我们先忽略其他字段。这个表的建表语句如下：</p><pre><code>mysql&gt; CREATE TABLE `tradelog` (\n  `id` int(11) NOT NULL,\n  `tradeid` varchar(32) DEFAULT NULL,\n  `operator` int(11) DEFAULT NULL,\n  `t_modified` datetime DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  KEY `tradeid` (`tradeid`),\n  KEY `t_modified` (`t_modified`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n</code></pre><p>假设，现在已经记录了从2016年初到2018年底的所有数据，运营部门有一个需求是，要统计发生在所有年份中7月份的交易记录总数。这个逻辑看上去并不复杂，你的SQL语句可能会这么写：</p><pre><code>mysql&gt; select count(*) from tradelog where month(t_modified)=7;\n</code></pre><p>由于t_modified字段上有索引，于是你就很放心地在生产库中执行了这条语句，但却发现执行了特别久，才返回了结果。</p><p>如果你问DBA同事为什么会出现这样的情况，他大概会告诉你：如果对字段做了函数计算，就用不上索引了，这是MySQL的规定。</p><p>现在你已经学过了InnoDB的索引结构了，可以再追问一句为什么？为什么条件是where t_modified='2018-7-1’的时候可以用上索引，而改成where month(t_modified)=7的时候就不行了？</p><!-- [[[read_end]]] --><p>下面是这个t_modified索引的示意图。方框上面的数字就是month()函数对应的值。</p><p><img src=\"https://static001.geekbang.org/resource/image/3e/86/3e30d9a5e67f711f5af2e2599e800286.png?wh=1142*856\" alt=\"\"></p><center><span class=\"reference\">图1 t_modified索引示意图</span></center><p>如果你的SQL语句条件用的是where t_modified='2018-7-1’的话，引擎就会按照上面绿色箭头的路线，快速定位到 t_modified='2018-7-1’需要的结果。</p><p>实际上，B+树提供的这个快速定位能力，来源于同一层兄弟节点的有序性。</p><p>但是，如果计算month()函数的话，你会看到传入7的时候，在树的第一层就不知道该怎么办了。</p><p>也就是说，<strong>对索引字段做函数操作，可能会破坏索引值的有序性，因此优化器就决定放弃走树搜索功能。</strong></p><p>需要注意的是，优化器并不是要放弃使用这个索引。</p><p>在这个例子里，放弃了树搜索功能，优化器可以选择遍历主键索引，也可以选择遍历索引t_modified，优化器对比索引大小后发现，索引t_modified更小，遍历这个索引比遍历主键索引来得更快。因此最终还是会选择索引t_modified。</p><p>接下来，我们使用explain命令，查看一下这条SQL语句的执行结果。</p><p><img src=\"https://static001.geekbang.org/resource/image/27/55/27c2f5ff3549b18ba37a28f4919f3655.png?wh=1637*143\" alt=\"\"></p><center><span class=\"reference\">图2 explain 结果</span></center><p>key=\"t_modified\"表示的是，使用了t_modified这个索引；我在测试表数据中插入了10万行数据，rows=100335，说明这条语句扫描了整个索引的所有值；Extra字段的Using index，表示的是使用了覆盖索引。</p><p>也就是说，由于在t_modified字段加了month()函数操作，导致了全索引扫描。为了能够用上索引的快速定位能力，我们就要把SQL语句改成基于字段本身的范围查询。按照下面这个写法，优化器就能按照我们预期的，用上t_modified索引的快速定位能力了。</p><pre><code>mysql&gt; select count(*) from tradelog where\n    -&gt; (t_modified &gt;= '2016-7-1' and t_modified&lt;'2016-8-1') or\n    -&gt; (t_modified &gt;= '2017-7-1' and t_modified&lt;'2017-8-1') or \n    -&gt; (t_modified &gt;= '2018-7-1' and t_modified&lt;'2018-8-1');\n</code></pre><p>当然，如果你的系统上线时间更早，或者后面又插入了之后年份的数据的话，你就需要再把其他年份补齐。</p><p>到这里我给你说明了，由于加了month()函数操作，MySQL无法再使用索引快速定位功能，而只能使用全索引扫描。</p><p>不过优化器在个问题上确实有“偷懒”行为，即使是对于不改变有序性的函数，也不会考虑使用索引。比如，对于select * from tradelog where id + 1 = 10000这个SQL语句，这个加1操作并不会改变有序性，但是MySQL优化器还是不能用id索引快速定位到9999这一行。所以，需要你在写SQL语句的时候，手动改写成 where id = 10000 -1才可以。</p><h1>案例二：隐式类型转换</h1><p>接下来我再跟你说一说，另一个经常让程序员掉坑里的例子。</p><p>我们一起看一下这条SQL语句：</p><pre><code>mysql&gt; select * from tradelog where tradeid=110717;\n</code></pre><p>交易编号tradeid这个字段上，本来就有索引，但是explain的结果却显示，这条语句需要走全表扫描。你可能也发现了，tradeid的字段类型是varchar(32)，而输入的参数却是整型，所以需要做类型转换。</p><p>那么，现在这里就有两个问题：</p><ol>\n<li>\n<p>数据类型转换的规则是什么？</p>\n</li>\n<li>\n<p>为什么有数据类型转换，就需要走全索引扫描？</p>\n</li>\n</ol><p>先来看第一个问题，你可能会说，数据库里面类型这么多，这种数据类型转换规则更多，我记不住，应该怎么办呢？</p><p>这里有一个简单的方法，看 select “10” &gt; 9的结果：</p><ol>\n<li>\n<p>如果规则是“将字符串转成数字”，那么就是做数字比较，结果应该是1；</p>\n</li>\n<li>\n<p>如果规则是“将数字转成字符串”，那么就是做字符串比较，结果应该是0。</p>\n</li>\n</ol><p>验证结果如图3所示。</p><p><img src=\"https://static001.geekbang.org/resource/image/2b/14/2b67fc38f1651e2622fe21d49950b214.png?wh=289*142\" alt=\"\"></p><center><span class=\"reference\">图3 MySQL中字符串和数字转换的效果示意图</span></center><p>从图中可知，select “10” &gt; 9返回的是1，所以你就能确认MySQL里的转换规则了：在MySQL中，字符串和数字做比较的话，是将字符串转换成数字。</p><p>这时，你再看这个全表扫描的语句：</p><pre><code>mysql&gt; select * from tradelog where tradeid=110717;\n</code></pre><p>就知道对于优化器来说，这个语句相当于：</p><pre><code>mysql&gt; select * from tradelog where  CAST(tradid AS signed int) = 110717;\n</code></pre><p>也就是说，这条语句触发了我们上面说到的规则：对索引字段做函数操作，优化器会放弃走树搜索功能。</p><p>现在，我留给你一个小问题，id的类型是int，如果执行下面这个语句，是否会导致全表扫描呢？</p><pre><code>select * from tradelog where id=&quot;83126&quot;;\n</code></pre><p>你可以先自己分析一下，再到数据库里面去验证确认。</p><p>接下来，我们再来看一个稍微复杂点的例子。</p><h1>案例三：隐式字符编码转换</h1><p>假设系统里还有另外一个表trade_detail，用于记录交易的操作细节。为了便于量化分析和复现，我往交易日志表tradelog和交易详情表trade_detail这两个表里插入一些数据。</p><pre><code>mysql&gt; CREATE TABLE `trade_detail` (\n  `id` int(11) NOT NULL,\n  `tradeid` varchar(32) DEFAULT NULL,\n  `trade_step` int(11) DEFAULT NULL, /*操作步骤*/\n  `step_info` varchar(32) DEFAULT NULL, /*步骤信息*/\n  PRIMARY KEY (`id`),\n  KEY `tradeid` (`tradeid`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n\ninsert into tradelog values(1, 'aaaaaaaa', 1000, now());\ninsert into tradelog values(2, 'aaaaaaab', 1000, now());\ninsert into tradelog values(3, 'aaaaaaac', 1000, now());\n\ninsert into trade_detail values(1, 'aaaaaaaa', 1, 'add');\ninsert into trade_detail values(2, 'aaaaaaaa', 2, 'update');\ninsert into trade_detail values(3, 'aaaaaaaa', 3, 'commit');\ninsert into trade_detail values(4, 'aaaaaaab', 1, 'add');\ninsert into trade_detail values(5, 'aaaaaaab', 2, 'update');\ninsert into trade_detail values(6, 'aaaaaaab', 3, 'update again');\ninsert into trade_detail values(7, 'aaaaaaab', 4, 'commit');\ninsert into trade_detail values(8, 'aaaaaaac', 1, 'add');\ninsert into trade_detail values(9, 'aaaaaaac', 2, 'update');\ninsert into trade_detail values(10, 'aaaaaaac', 3, 'update again');\ninsert into trade_detail values(11, 'aaaaaaac', 4, 'commit');\n</code></pre><p>这时候，如果要查询id=2的交易的所有操作步骤信息，SQL语句可以这么写：</p><pre><code>mysql&gt; select d.* from tradelog l, trade_detail d where d.tradeid=l.tradeid and l.id=2; /*语句Q1*/\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/ad/22/adfe464af1d15f3261b710a806c0fa22.png?wh=1412*171\" alt=\"\"></p><center><span class=\"reference\">图4 语句Q1的explain 结果</span></center><p>我们一起来看下这个结果：</p><ol>\n<li>\n<p>第一行显示优化器会先在交易记录表tradelog上查到id=2的行，这个步骤用上了主键索引，rows=1表示只扫描一行；</p>\n</li>\n<li>\n<p>第二行key=NULL，表示没有用上交易详情表trade_detail上的tradeid索引，进行了全表扫描。</p>\n</li>\n</ol><p>在这个执行计划里，是从tradelog表中取tradeid字段，再去trade_detail表里查询匹配字段。因此，我们把tradelog称为驱动表，把trade_detail称为被驱动表，把tradeid称为关联字段。</p><p>接下来，我们看下这个explain结果表示的执行流程：</p><p><img src=\"https://static001.geekbang.org/resource/image/82/a9/8289c184c8529acea0269a7460dc62a9.png?wh=1142*856\" alt=\"\"></p><center><span class=\"reference\">图5 语句Q1的执行过程</span></center><p>图中：</p><ul>\n<li>第1步，是根据id在tradelog表里找到L2这一行；</li>\n<li>第2步，是从L2中取出tradeid字段的值；</li>\n<li>第3步，是根据tradeid值到trade_detail表中查找条件匹配的行。explain的结果里面第二行的key=NULL表示的就是，这个过程是通过遍历主键索引的方式，一个一个地判断tradeid的值是否匹配。</li>\n</ul><p>进行到这里，你会发现第3步不符合我们的预期。因为表trade_detail里tradeid字段上是有索引的，我们本来是希望通过使用tradeid索引能够快速定位到等值的行。但，这里并没有。</p><p>如果你去问DBA同学，他们可能会告诉你，因为这两个表的字符集不同，一个是utf8，一个是utf8mb4，所以做表连接查询的时候用不上关联字段的索引。这个回答，也是通常你搜索这个问题时会得到的答案。</p><p>但是你应该再追问一下，为什么字符集不同就用不上索引呢？</p><p>我们说问题是出在执行步骤的第3步，如果单独把这一步改成SQL语句的话，那就是：</p><pre><code>mysql&gt; select * from trade_detail where tradeid=$L2.tradeid.value; \n</code></pre><p>其中，$L2.tradeid.value的字符集是utf8mb4。</p><p>参照前面的两个例子，你肯定就想到了，字符集utf8mb4是utf8的超集，所以当这两个类型的字符串在做比较的时候，MySQL内部的操作是，先把utf8字符串转成utf8mb4字符集，再做比较。</p><blockquote>\n<p>这个设定很好理解，utf8mb4是utf8的超集。类似地，在程序设计语言里面，做自动类型转换的时候，为了避免数据在转换过程中由于截断导致数据错误，也都是“按数据长度增加的方向”进行转换的。</p>\n</blockquote><p>因此， 在执行上面这个语句的时候，需要将被驱动数据表里的字段一个个地转换成utf8mb4，再跟L2做比较。</p><p>也就是说，实际上这个语句等同于下面这个写法：</p><pre><code>select * from trade_detail  where CONVERT(traideid USING utf8mb4)=$L2.tradeid.value; \n</code></pre><p>CONVERT()函数，在这里的意思是把输入的字符串转成utf8mb4字符集。</p><p>这就再次触发了我们上面说到的原则：对索引字段做函数操作，优化器会放弃走树搜索功能。</p><p>到这里，你终于明确了，字符集不同只是条件之一，<strong>连接过程中要求在被驱动表的索引字段上加函数操作</strong>，是直接导致对被驱动表做全表扫描的原因。</p><p>作为对比验证，我给你提另外一个需求，“查找trade_detail表里id=4的操作，对应的操作者是谁”，再来看下这个语句和它的执行计划。</p><pre><code>mysql&gt;select l.operator from tradelog l , trade_detail d where d.tradeid=l.tradeid and d.id=4;\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/92/11/92cb498ceb3557e41700fae53ce9bd11.png?wh=1328*194\" alt=\"\"></p><center><span class=\"reference\">图6 explain 结果</span></center><p>这个语句里trade_detail 表成了驱动表，但是explain结果的第二行显示，这次的查询操作用上了被驱动表tradelog里的索引(tradeid)，扫描行数是1。</p><p>这也是两个tradeid字段的join操作，为什么这次能用上被驱动表的tradeid索引呢？我们来分析一下。</p><p>假设驱动表trade_detail里id=4的行记为R4，那么在连接的时候（图5的第3步），被驱动表tradelog上执行的就是类似这样的SQL 语句：</p><pre><code>select operator from tradelog  where traideid =$R4.tradeid.value; \n</code></pre><p>这时候$R4.tradeid.value的字符集是utf8, 按照字符集转换规则，要转成utf8mb4，所以这个过程就被改写成：</p><pre><code>select operator from tradelog  where traideid =CONVERT($R4.tradeid.value USING utf8mb4); \n</code></pre><p>你看，这里的CONVERT函数是加在输入参数上的，这样就可以用上被驱动表的traideid索引。</p><p>理解了原理以后，就可以用来指导操作了。如果要优化语句</p><pre><code>select d.* from tradelog l, trade_detail d where d.tradeid=l.tradeid and l.id=2;\n</code></pre><p>的执行过程，有两种做法：</p><ul>\n<li>比较常见的优化方法是，把trade_detail表上的tradeid字段的字符集也改成utf8mb4，这样就没有字符集转换的问题了。</li>\n</ul><pre><code>alter table trade_detail modify tradeid varchar(32) CHARACTER SET utf8mb4 default null;\n</code></pre><ul>\n<li>如果能够修改字段的字符集的话，是最好不过了。但如果数据量比较大， 或者业务上暂时不能做这个DDL的话，那就只能采用修改SQL语句的方法了。</li>\n</ul><pre><code>mysql&gt; select d.* from tradelog l , trade_detail d where d.tradeid=CONVERT(l.tradeid USING utf8) and l.id=2; \n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/aa/d6/aa844a7bf35d330b9ec96fc159331bd6.png?wh=1332*187\" alt=\"\"></p><center>图7 SQL语句优化后的explain结果</center><p>这里，我主动把 l.tradeid转成utf8，就避免了被驱动表上的字符编码转换，从explain结果可以看到，这次索引走对了。</p><h1>小结</h1><p>今天我给你举了三个例子，其实是在说同一件事儿，即：<strong>对索引字段做函数操作，可能会破坏索引值的有序性，因此优化器就决定放弃走树搜索功能。</strong></p><p>第二个例子是隐式类型转换，第三个例子是隐式字符编码转换，它们都跟第一个例子一样，因为要求在索引字段上做函数操作而导致了全索引扫描。</p><p>MySQL的优化器确实有“偷懒”的嫌疑，即使简单地把where id+1=1000改写成where id=1000-1就能够用上索引快速查找，也不会主动做这个语句重写。</p><p>因此，每次你的业务代码升级时，把可能出现的、新的SQL语句explain一下，是一个很好的习惯。</p><p>最后，又到了思考题时间。</p><p>今天我留给你的课后问题是，你遇到过别的、类似今天我们提到的性能问题吗？你认为原因是什么，又是怎么解决的呢？</p><p>你可以把你经历和分析写在留言区里，我会在下一篇文章的末尾选取有趣的评论跟大家一起分享和分析。感谢你的收听，也欢迎你把这篇文章分享给更多的朋友一起阅读。</p><h1>上期问题时间</h1><p>我在上篇文章的最后，留给你的问题是：我们文章中最后的一个方案是，通过三次limit Y,1 来得到需要的数据，你觉得有没有进一步的优化方法。</p><p>这里我给出一种方法，取Y1、Y2和Y3里面最大的一个数，记为M，最小的一个数记为N，然后执行下面这条SQL语句：</p><pre><code>mysql&gt; select * from t limit N, M-N+1;\n</code></pre><p>再加上取整个表总行数的C行，这个方案的扫描行数总共只需要C+M+1行。</p><p>当然也可以先取回id值，在应用中确定了三个id值以后，再执行三次where id=X的语句也是可以的。@倪大人 同学在评论区就提到了这个方法。</p><p>这次评论区出现了很多很棒的留言：</p><blockquote>\n<p>@老杨同志 提出了重新整理的方法、@雪中鼠[悠闲] 提到了用rowid的方法，是类似的思路，就是让表里面保存一个无空洞的自增值，这样就可以用我们的随机算法1来实现；<br>\n@吴宇晨 提到了拿到第一个值以后，用id迭代往下找的方案，利用了主键索引的有序性。</p>\n</blockquote><p></p>","comments":[{"had_liked":false,"id":53252,"user_name":"老杨同志","can_delete":false,"product_type":"c1","uid":1246199,"ip_address":"","ucode":"3F334F0CFD3DE6","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/f7/3a493bec.jpg","comment_is_top":true,"comment_ctime":1545619652,"is_pvip":false,"replies":[{"id":"19286","content":"你最后这个id预估，加上between ，<br>有种神来之笔的感觉😄<br>感觉隐约里面有二分法的思想<br>👍🏿","user_name":"作者回复","comment_id":53252,"uid":"1264162","ip_address":"","utype":1,"ctime":1545623215,"user_name_real":"林晓斌"}],"discussion_count":29,"race_medal":0,"score":"9.2233727170051994e+18","product_id":100020801,"comment_content":"感谢老师鼓励，我本人工作时间比较长，有一定的基础，听老师的课还是收获很大。每次公司内部有技术分享，我都去听课，但是多数情况，一两个小时的分享，就只有一两句话受益。老师的每篇文章都能命中我的知识盲点，感觉太别爽。<br><br>对应今天的隐式类型转换问题也踩过坑。<br>我们有个任务表记录待执行任务，表结构简化后如下：<br>CREATE TABLE `task` (<br>  `task_id` int(11) NOT NULL AUTO_INCREMENT COMMENT &#39;自增主键&#39;,<br>  `task_type` int(11) DEFAULT NULL COMMENT &#39;任务类型id&#39;,<br>  `task_rfid` varchar(50) COLLATE utf8_unicode_ci DEFAULT NULL COMMENT &#39;关联外键1&#39;,<br>  PRIMARY KEY (`task_id`)<br>) ENGINE=InnoDB AUTO_INCREMENT CHARSET=utf8 COLLATE=utf8_unicode_ci COMMENT=&#39;任务表&#39;;<br><br>task_rfid 是业务主键，当然都是数字，查询时使用sql：<br>select * from task where task_rfid =123;<br>其实这个语句也有隐式转换问题，但是待执行任务只有几千条记录，并没有什么感觉。<br>这个表还有个对应的历史表，数据有几千万<br>忽然有一天，想查一下历史记录，执行语句<br>select * from task_history where task_rfid =99;<br>直接就等待很长时间后超时报错了。<br>如果仔细看，其实我的表没有task_rfid 索引，写成task_rfid =‘99’也一样是全表扫描。<br>运维时的套路是，猜测主键task_id的范围，怎么猜，我原表有creat_time字段，我会先查<br>select max(task_id) from task_history   然后再看看 select * from task_history  where task_id = maxId - 10000的时间，估计出大概的id范围。然后语句变成<br>select * from task_history where task_rfid =99 and id between ？ and ？;<br>","like_count":159,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434083,"discussion_content":"你最后这个id预估，加上between ，\n有种神来之笔的感觉😄\n感觉隐约里面有二分法的思想\n👍🏿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545623215,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1324314,"avatar":"https://static001.geekbang.org/account/avatar/00/14/35/1a/9fa38dc9.jpg","nickname":"子瞻","note":"","ucode":"5C26FF10934534","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":165590,"discussion_content":"看了两遍我也看懵了，最后的task_history和前面的task两个有点混乱","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1581304794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1335293,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKR3ibELhjgVicCNShZCBwvaDxibnzibggG4wUzVkS2mkDxUBZyIs87nDEdJ7PiahJBVoZcuhQ84RxAziag/132","nickname":"周治慧","note":"","ucode":"7D56C4E66BEE17","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1324314,"avatar":"https://static001.geekbang.org/account/avatar/00/14/35/1a/9fa38dc9.jpg","nickname":"子瞻","note":"","ucode":"5C26FF10934534","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":194074,"discussion_content":"因为task_rfid没有索引,需要进行全表扫描,可能由于业务表数据太大给字段加索引耗时和没有适当的时机去处理   所以将sql进行优化,先通过id来定位区间减少主键索引上的全表扫描范围来提高sql的性能","likes_number":20,"is_delete":false,"is_hidden":false,"ctime":1583186255,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":165590,"ip_address":""},"score":194074,"extra":""}]},{"author":{"id":2497728,"avatar":"https://static001.geekbang.org/account/avatar/00/26/1c/c0/b8ff566a.jpg","nickname":"我是大橙子132","note":"","ucode":"61660568CF07C9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560423,"discussion_content":"牛，果然实践是检验真理的唯一标准\n","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1649322032,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2369545,"avatar":"https://static001.geekbang.org/account/avatar/00/24/28/09/0ac42cff.jpg","nickname":"慕苏","note":"","ucode":"7ED14D00429C21","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336564,"discussion_content":"我一开始还以为这案例跟隐式转换有关系...","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1608625900,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1134574,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4f/ee/bd08cfab.jpg","nickname":"一魄","note":"","ucode":"71541125D4AA5A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2369545,"avatar":"https://static001.geekbang.org/account/avatar/00/24/28/09/0ac42cff.jpg","nickname":"慕苏","note":"","ucode":"7ED14D00429C21","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":402248,"discussion_content":"是啊，说到最后又没索引……","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1633841341,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":336564,"ip_address":""},"score":402248,"extra":""}]},{"author":{"id":1494921,"avatar":"https://static001.geekbang.org/account/avatar/00/16/cf/89/3796d969.jpg","nickname":"懒羊羊","note":"","ucode":"D0FF5CCC60874A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7578,"discussion_content":"竟然没看懂🙂","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1567576589,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1450291,"avatar":"https://static001.geekbang.org/account/avatar/00/16/21/33/bb18d6f0.jpg","nickname":"小光光","note":"","ucode":"34F6AF83910441","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1494921,"avatar":"https://static001.geekbang.org/account/avatar/00/16/cf/89/3796d969.jpg","nickname":"懒羊羊","note":"","ucode":"D0FF5CCC60874A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":9549,"discussion_content":"我也是","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568186349,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":7578,"ip_address":""},"score":9549,"extra":""}]},{"author":{"id":1896985,"avatar":"","nickname":"Geek_b51de5","note":"","ucode":"05726E62E7A915","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":292615,"discussion_content":"感觉看到了我自己，😂，，也有那么一张任务表，也有那么一张任务历史表，也那么查历史数据","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1595287336,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1232527,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ce/8f/6daf02db.jpg","nickname":"心灵捕手","note":"","ucode":"6D0BC463A000C8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1896985,"avatar":"","nickname":"Geek_b51de5","note":"","ucode":"05726E62E7A915","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":405735,"discussion_content":"奥利给！！","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1634632750,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":292615,"ip_address":""},"score":405735,"extra":""}]},{"author":{"id":1832759,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/f7/37/8d3be740.jpg","nickname":"逸枫枫枫","note":"","ucode":"29C1CA3628456B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":223438,"discussion_content":"为什么不建索引 不允许吗\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1586223941,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1240624,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ee/30/cfdd1b86.jpg","nickname":"刘浩","note":"","ucode":"81F5D6E62751C6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":39664,"discussion_content":"我看蒙了，如何确定task_rfid=99的所有值都在最后那个id区间里？还是说反复查？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1571974129,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1895744,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJxUlVydHpM5PNRvg9C29H0cQQ0Uby1LZyK5hdn9sqUy1OGOpVOfMHYn578WyYiaCNOrzcaor6KzjQ/132","nickname":"Geek_b403af","note":"","ucode":"686D2606E47EF5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1240624,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ee/30/cfdd1b86.jpg","nickname":"刘浩","note":"","ucode":"81F5D6E62751C6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":252280,"discussion_content":"应该是反复查吧，先缩小范围，全部查完再整合","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1588147772,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":39664,"ip_address":""},"score":252280,"extra":""}]},{"author":{"id":3014916,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqKiaa7OE3FelFiaUmFCiaMUTn1kG3UrR3ZuzTOl5bSGDTjThn3ujFQgcbeZBPump30Jfzb4EEZeUhaQ/132","nickname":"Geek_e009ee","note":"","ucode":"EB5DB9A8D6DBA2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586181,"discussion_content":"太猛了\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662022142,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"福建"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1253652,"avatar":"https://static001.geekbang.org/account/avatar/00/13/21/14/423a821f.jpg","nickname":"Steven","note":"","ucode":"3FE64459842015","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568521,"discussion_content":"这就是一种没办法的办法，体力活","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651154911,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2821728,"avatar":"","nickname":"600988292","note":"","ucode":"24BAE2B7A7B1E5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539991,"discussion_content":"task表中的id，为啥叫task_id？叫id就行了把","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639911457,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1251860,"avatar":"","nickname":"小飞","note":"","ucode":"A3169067DF31B5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380831,"discussion_content":"根据条件获取到最大最小的id  然后循环根据I’d去查询  每次把最小id加上一个变量  到最大id就结束","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624718392,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1556358,"avatar":"https://static001.geekbang.org/account/avatar/00/17/bf/86/c0cb35f0.jpg","nickname":"8.13.3.27.30","note":"","ucode":"2DE3CE3E338BAB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":277482,"discussion_content":"我有个问题，既然是历史表，应该查询频率很低，加个索引应该很容易做吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591060878,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":8,"child_discussions":[{"author":{"id":1038593,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/d9/01/2f389a93.jpg","nickname":"夏虫","note":"","ucode":"0A7EF68F703237","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1556358,"avatar":"https://static001.geekbang.org/account/avatar/00/17/bf/86/c0cb35f0.jpg","nickname":"8.13.3.27.30","note":"","ucode":"2DE3CE3E338BAB","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283135,"discussion_content":"我想主要是历史表查询频率低，新增频率高，容易导致索引频繁变更，收益角度来看，加索引是不划算的","likes_number":15,"is_delete":false,"is_hidden":false,"ctime":1592192670,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":277482,"ip_address":""},"score":283135,"extra":""},{"author":{"id":2086624,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/d6/e0/3ccaaa7b.jpg","nickname":"领子","note":"","ucode":"64AC4E6AB74E68","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1038593,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/d9/01/2f389a93.jpg","nickname":"夏虫","note":"","ucode":"0A7EF68F703237","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294748,"discussion_content":"一个字段加索引的成本，并没有你想象的那么大，占用的磁盘多一点，请参考《数据库索引设计与优化》第一章的误区与误解","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1595988016,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":283135,"ip_address":""},"score":294748,"extra":""},{"author":{"id":1038593,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/d9/01/2f389a93.jpg","nickname":"夏虫","note":"","ucode":"0A7EF68F703237","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2086624,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/d6/e0/3ccaaa7b.jpg","nickname":"领子","note":"","ucode":"64AC4E6AB74E68","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":300236,"discussion_content":"是的，成本不是很高，我估计每次的新增记录成本大概是两次b+树搜索和一次插入，但我主要是在想查询频率是会比维护索引的频率低，在这个场景是否有必要\n\n不过如果这个功能虽然使用频率低，但需要快速反应什么的话，增加索引也许是有必要的","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1597996488,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":294748,"ip_address":""},"score":300236,"extra":""}]},{"author":{"id":1210699,"avatar":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","nickname":"-W.LI-","note":"","ucode":"3556786538664F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7279,"discussion_content":"查询条件变成字符串也不走索引，是因为重复率很高么?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567472927,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1204525,"avatar":"https://static001.geekbang.org/account/avatar/00/12/61/2d/5ca0a3da.jpg","nickname":"常文龙","note":"","ucode":"4A126159D24766","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1210699,"avatar":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","nickname":"-W.LI-","note":"","ucode":"3556786538664F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":26507,"discussion_content":"同问，还是因为压根没在task_rfid字段上建立索引？","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1570605012,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":7279,"ip_address":""},"score":26507,"extra":""},{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"温故而知新可以为师矣","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1204525,"avatar":"https://static001.geekbang.org/account/avatar/00/12/61/2d/5ca0a3da.jpg","nickname":"常文龙","note":"","ucode":"4A126159D24766","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":135192,"discussion_content":"没索引，只是基于业务使用主键索引缩小了范围，其实只要增加task_rfid就基本从根上解决问题了，修改业务代码反而更麻烦，可能楼主有具体的业务限制吧","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1579076773,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":26507,"ip_address":""},"score":135192,"extra":""}]}]},{"had_liked":false,"id":53350,"user_name":"赖阿甘","can_delete":false,"product_type":"c1","uid":1351988,"ip_address":"","ucode":"77493FE85CBAF8","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTICBNZjA9hW65x6g9b2iaicKUJW5gxFxtgPXH9Cqp6eyFfY1sD2hVY4dZrY5pmoK2r1KZEiaaIKocdZQ/132","comment_is_top":true,"comment_ctime":1545630500,"is_pvip":false,"replies":[{"id":"19305","content":"这个问题不是等号顺序决定的哈<br><br><br><br>好问题","user_name":"作者回复","comment_id":53350,"uid":"1264162","ip_address":"","utype":1,"ctime":1545639203,"user_name_real":"林晓斌"}],"discussion_count":11,"race_medal":0,"score":"9.2233722016091996e+18","product_id":100020801,"comment_content":"“mysql&gt;select l.operator from tradelog l , trade_detail d where d.tradeid=l.tradeid and d.id=4;”<br>图6上面那句sql是不是写错了。d.tradeid=l.tradeid是不是该写成l.tradeid = d.tradeid？不然函数会作用在索引字段上，就只能全表扫描了","like_count":39,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434106,"discussion_content":"这个问题不是等号顺序决定的哈\n\n\n\n好问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545639203,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2086624,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/d6/e0/3ccaaa7b.jpg","nickname":"领子","note":"","ucode":"64AC4E6AB74E68","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294750,"discussion_content":"表的访问顺序与连接方式，条件字段有关，跟书写顺序无关，请参考《数据库索引设计与优化》第八章的表访问顺序对索引设计的影响","likes_number":10,"is_delete":false,"is_hidden":false,"ctime":1595988276,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1797135,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/6c/0f/7d242cc2.jpg","nickname":"吃水不用钱","note":"","ucode":"8A5D5978F0D4E5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":215684,"discussion_content":"解释下顺序无关。从trade_detail取出的trace_id为utf8，拿到tracelog比较时，由于tracelog的trace_id字段类型为utf8mb4，不需要对索引上的字段做函数转换，可以直接使用该索引组织的数据结构，比较时只需要将trade_detail的trace_id转为utf8比较即可。\nl.trace_id = convert(d.trace_id using utf8mb4)","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1585372063,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1721168,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/43/50/abb4ca1e.jpg","nickname":"凡","note":"","ucode":"80C2A6452AB9EA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":133789,"discussion_content":"@王斯拉 你说的有问题，问题中的 d 表是驱动表，不是被驱动表，别误导其他同学","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1578989417,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1593957,"avatar":"https://static001.geekbang.org/account/avatar/00/18/52/65/320eccb3.jpg","nickname":"王斯拉","note":"","ucode":"D00DD3CE432189","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2952,"discussion_content":"补充一下，当执行到d.tradeid=l.tradeid的时候其实是在对d表（被驱动表）进行操作，关键问题是因为被驱动表是utf8，而驱动表是utf8mb4，所以对条件列进行了默默函数化导致了不能运用索引。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1564060032,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2039219,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/1d/b3/05729e06.jpg","nickname":"阿飞","note":"","ucode":"CD3293EEC33F14","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1593957,"avatar":"https://static001.geekbang.org/account/avatar/00/18/52/65/320eccb3.jpg","nickname":"王斯拉","note":"","ucode":"D00DD3CE432189","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311070,"discussion_content":"select l.operator from tradelog l , trade_detail d where d.tradeid=l.tradeid and d.id=4;这里是d.id=4，驱动表是trade_detail，被驱动表是tradelog，你搞混了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602210795,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":2952,"ip_address":""},"score":311070,"extra":""}]},{"author":{"id":1049510,"avatar":"https://static001.geekbang.org/account/avatar/00/10/03/a6/956b8734.jpg","nickname":"莫失铭忘","note":"","ucode":"BF0951AF9610E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554293,"discussion_content":"什么是驱动表，什么是被驱动表，这两个概念在查询中有时容易让人搞混，有下面几种情况，大家需要了解。\n\n当连接查询没有where条件时，左连接查询时，前面的表是驱动表，后面的表是被驱动表，右连接查询时相反，内连接查询时，哪张表的数据较少，哪张表就是驱动表\n当连接查询有where条件时，带where条件的表是驱动表，否则是被驱动表","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1646303384,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2871461,"avatar":"","nickname":"Geek_f9f6b9","note":"","ucode":"90095DA80410D9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1049510,"avatar":"https://static001.geekbang.org/account/avatar/00/10/03/a6/956b8734.jpg","nickname":"莫失铭忘","note":"","ucode":"BF0951AF9610E8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554805,"discussion_content":"请教一下，如果左连接时选择了后边的表做where条件，依然是where条件的表做驱动表嘛","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646622832,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":554293,"ip_address":""},"score":554805,"extra":""}]},{"author":{"id":2552742,"avatar":"https://static001.geekbang.org/account/avatar/00/26/f3/a6/1dd784f6.jpg","nickname":"里河","note":"","ucode":"0A05A5F7A19EFA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":370615,"discussion_content":"哪个表是驱动表的问题","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1619485594,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1938214,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/93/26/df549718.jpg","nickname":"松","note":"","ucode":"327DF555AB9E7B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388282,"discussion_content":"这个语句比较简单容易感觉出来哪个是驱动表,哪个是被驱动.   那决定哪个是驱动表的因素是什么呢? 当语句复杂一点的时候还看不出来了呢?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628678375,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1465990,"avatar":"https://static001.geekbang.org/account/avatar/00/16/5e/86/40877404.jpg","nickname":"星星滴蓝天","note":"","ucode":"2F2F56F93AD828","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":20424,"discussion_content":"老师讲的这里有点绕。\n第一步，是根据id在tradelog表里找到L2这一行；（tradelog是驱动表，从这里开始）\n第二步，是从L2中取出tradeid字段的值；\n第三步，是根据tradeid值到trade_detai表中查找条件匹配的行。.....\n(select * from trade_detail  where CONVERT(traideid USING utf8mb4)=$L2.tradeid.value; \n)\n=================\n所以问题在第三步这里有个函数转换；\n至于为啥是这三步，我一开始以为是l.id = 2 造成的；后来我把这个条件去了......\n\nSELECT\td.* FROM \ttrade_detail d,  tradelog l\t WHERE \tCONVERT(l.tradeid USING utf8) =  d.tradeid;\nSELECT\td.* FROM \t tradelog l,\ttrade_detail d   WHERE \t CONVERT(d.tradeid USING utf8mb4) = l.tradeid;\n发现第一个SQL用到了索引tradeid；第二个还是ALL.......\n\n最后新建了个库，字符集是utf8mb4 第二个SQL把d.* 改为  l.* 就可以走索引了(在utf8上改为l.* 也不好使)....\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569313929,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63961,"user_name":"冠超","can_delete":false,"product_type":"c1","uid":1031306,"ip_address":"","ucode":"230FD3AAF63B48","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bc/8a/9420cf2a.jpg","comment_is_top":true,"comment_ctime":1548631009,"is_pvip":false,"replies":[{"id":"22624","content":"是这样的，其实我们整个专栏大部分的文章，最后都是为了说明 “怎么设计表”、“怎么考虑优化SQL语句”<br><br>但是因为这个不是一成不变的，很多是需要考虑现实的情况，<br>所以这个专栏就是想把对应的原理说一下，这样大家在应对不同场景的时候，可以组合来考虑。<br><br>也就是说没有一段话可以把“怎么设计表”讲清楚（或者说硬写出来很可能就是一些general的没有什么针对性作用的描述）<br><br>你可以把你的业务背景抽象说下，我们来具体讨论吧","user_name":"作者回复","comment_id":63961,"uid":"1264162","ip_address":"","utype":1,"ctime":1548636267,"user_name_real":"林晓斌"}],"discussion_count":2,"race_medal":0,"score":"9.2233721500726006e+18","product_id":100020801,"comment_content":"非常感谢老师分享的内容，实打实地学到了。这里提个建议，希望老师能介绍一下设计表的时候要怎么考虑这方面的知识哈😊","like_count":27,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437783,"discussion_content":"是这样的，其实我们整个专栏大部分的文章，最后都是为了说明 “怎么设计表”、“怎么考虑优化SQL语句”\n\n但是因为这个不是一成不变的，很多是需要考虑现实的情况，\n所以这个专栏就是想把对应的原理说一下，这样大家在应对不同场景的时候，可以组合来考虑。\n\n也就是说没有一段话可以把“怎么设计表”讲清楚（或者说硬写出来很可能就是一些general的没有什么针对性作用的描述）\n\n你可以把你的业务背景抽象说下，我们来具体讨论吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548636267,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1938214,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/93/26/df549718.jpg","nickname":"松","note":"","ucode":"327DF555AB9E7B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388283,"discussion_content":"叫原理,应用要随机应变.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628678876,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53603,"user_name":"可凡不凡","can_delete":false,"product_type":"c1","uid":1296289,"ip_address":"","ucode":"9D42D6C5274D48","user_header":"https://static001.geekbang.org/account/avatar/00/13/c7/a1/273bff58.jpg","comment_is_top":true,"comment_ctime":1545700231,"is_pvip":false,"replies":[{"id":"19478","content":"1. 你好😄<br>2. CODE不是关键字呀， 另外优化器选择跟关键字无关哈，关键字的话，要用 反‘ 括起来<br>3. 不是bug, update如果把 or 改成 and , 就能走索引😄","user_name":"作者回复","comment_id":53603,"uid":"1264162","ip_address":"","utype":1,"ctime":1545702548,"user_name_real":"林晓斌"}],"discussion_count":20,"race_medal":0,"score":"9.2233721242998006e+18","product_id":100020801,"comment_content":"1.老师好<br>2.如果在用一个 MySQL 关键字做字段,并且字段上索引,当我用这个索引作为唯一查询条件的时候 ,会 造  成隐式的转换吗? <br>例如:SELECT * FROM b_side_order WHERE CODE = 332924 ; (code 上有索引)<br>3. mysql5.6  code 上有索引  intime 上没有索引<br>语句一:<br>SELECT * FROM b_side_order WHERE CODE = 332924 ;<br>语句二;<br>  UPDATE b_side_order SET in_time = &#39;2018-08-04 08:34:44&#39; WHERE 1=2 or CODE = 332924;<br><br>这两个语句 执行计划走 select 走了索引,update 没有走索引 是执行计划的bug 吗??<br><br> <br><br><br>","like_count":21,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434200,"discussion_content":"1. 你好😄\n2. CODE不是关键字呀， 另外优化器选择跟关键字无关哈，关键字的话，要用 反‘ 括起来\n3. 不是bug, update如果把 or 改成 and , 就能走索引😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545702548,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1465412,"avatar":"https://static001.geekbang.org/account/avatar/00/16/5c/44/d07c0865.jpg","nickname":"Geek_d960af","note":"","ucode":"C59AEF44BD8691","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":298563,"discussion_content":"1=2 恒假，or 然后就会看后面，不应该是会走索引吗?  要是1=2 and xx   那前面整个表达式不也是恒假了，还会看后面吗?","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1597327641,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2254917,"avatar":"https://static001.geekbang.org/account/avatar/00/22/68/45/ddf89612.jpg","nickname":"bestgopher","note":"","ucode":"D89735C8CA9C6E","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":1465412,"avatar":"https://static001.geekbang.org/account/avatar/00/16/5c/44/d07c0865.jpg","nickname":"Geek_d960af","note":"","ucode":"C59AEF44BD8691","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551165,"discussion_content":"and的第一个条件为假会短路吧？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644915820,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":298563,"ip_address":""},"score":551165,"extra":""}]},{"author":{"id":2397875,"avatar":"https://static001.geekbang.org/account/avatar/00/24/96/b3/942aaf99.jpg","nickname":"swagger～","note":"","ucode":"332A839889F581","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388170,"discussion_content":"个人理解or条件是有一个条件没有索引会做全表扫描，因为那个字段没索引会走全表扫描，其他字段就没必要走索引了","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1628642543,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2130032,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/mpsOZBaHEA5oZ4A43dU21tNsakMyLRcmjn1liaJctPYfVkzB18dspeoOFNUxmEBq7I6Bjib0qPiaoF5uu0icNYek5g/132","nickname":"BestRiven","note":"","ucode":"D2642BC46EE9FC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":307792,"discussion_content":"https://blog.csdn.net/qq_41191715/article/details/106221505?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-5.add_param_isCf&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-5.add_param_isCf","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1600760750,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1285652,"avatar":"","nickname":"mycat","note":"","ucode":"6878BD32D042F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2130032,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/mpsOZBaHEA5oZ4A43dU21tNsakMyLRcmjn1liaJctPYfVkzB18dspeoOFNUxmEBq7I6Bjib0qPiaoF5uu0icNYek5g/132","nickname":"BestRiven","note":"","ucode":"D2642BC46EE9FC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308385,"discussion_content":"这是开发过程中的一个小技巧。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600935666,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":307792,"ip_address":""},"score":308385,"extra":""}]},{"author":{"id":1310187,"avatar":"","nickname":"三丰","note":"","ucode":"CA69A069D3061D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":36497,"discussion_content":"为啥不改为1=1 and呢？","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1571385533,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1745179,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/j0gBKF8EKfRMTnBOqXR3xcqquJdzYUibXOIb32HejppBPo644p6JB3Et08Su4TUaDRWt8DzPxYtm8iabEJN2uJKw/132","nickname":"一个顶三","note":"","ucode":"165596847783D9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1310187,"avatar":"","nickname":"三丰","note":"","ucode":"CA69A069D3061D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":166346,"discussion_content":"应该是跟业务逻辑有关。\n你可以考虑这么一种情形：  默认条件是where 1=2， 如果用户有输入， 则根据用户的输入更新表； 如果用户没有输入， 那么1=2不成立， 则不更新表。\n如果改成1=1那么对于上面这种update的情形简直就是灾难（每次用户没有输入则更新全表数据）\n不对之处请指正！","likes_number":18,"is_delete":false,"is_hidden":false,"ctime":1581386443,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":36497,"ip_address":""},"score":166346,"extra":""},{"author":{"id":1601661,"avatar":"","nickname":"GEEKBANG_8559966","note":"","ucode":"C3C87C3D7164FD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1745179,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/j0gBKF8EKfRMTnBOqXR3xcqquJdzYUibXOIb32HejppBPo644p6JB3Et08Su4TUaDRWt8DzPxYtm8iabEJN2uJKw/132","nickname":"一个顶三","note":"","ucode":"165596847783D9","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":405230,"discussion_content":"最骚的是你这个名字和层主的名字","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1634536166,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":166346,"ip_address":""},"score":405230,"extra":""}]},{"author":{"id":1241770,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f2/aa/32fc0d54.jpg","nickname":"失火的夏天","note":"","ucode":"10C6E66EB2A65F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":101986,"discussion_content":"1=2后面来个or是什么骚操作。。没意义啊，直接去掉不就完了么","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1577320884,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1124075,"avatar":"https://static001.geekbang.org/account/avatar/00/11/26/eb/24e0ac9c.jpg","nickname":"嬴梦川","note":"","ucode":"104CDFD26A1711","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1241770,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f2/aa/32fc0d54.jpg","nickname":"失火的夏天","note":"","ucode":"10C6E66EB2A65F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369741,"discussion_content":"这明显是用于业务sql拼接用的。如果后面有where则返回这个where的筛选结果，如果没有则返回当前表的结构(即获取表中的属性)","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1619146084,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":101986,"ip_address":""},"score":369741,"extra":""}]},{"author":{"id":1353645,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqj0HqmCbKPaW84jZaru1xa0icAEcDHgCszTO4tPwZBalXkib5CsISnAUAlO2hwDadoYPGUjIw0xBwg/132","nickname":"kiddkidd","note":"","ucode":"5CFD9C737F0AEE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":32942,"discussion_content":"UPDATE b_side_order SET in_time = &#39;2018-08-04 08:34:44&#39; WHERE 1=2 or CODE = 332924;\n这里1=2是恒假，请问不是应该相当于没这个条件吗？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1571067535,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1147151,"avatar":"https://static001.geekbang.org/account/avatar/00/11/81/0f/8f7ebd2d.jpg","nickname":"不二","note":"","ucode":"67E0E3BA3EEC26","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1353645,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqj0HqmCbKPaW84jZaru1xa0icAEcDHgCszTO4tPwZBalXkib5CsISnAUAlO2hwDadoYPGUjIw0xBwg/132","nickname":"kiddkidd","note":"","ucode":"5CFD9C737F0AEE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":270504,"discussion_content":"他的应该是动态的sql，where后必须保留一个条件.默认where 1=2不执行任何更新操作,当有用户输入的时候再执行用户输入的操作。","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1590022183,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":32942,"ip_address":""},"score":270504,"extra":""}]},{"author":{"id":2871461,"avatar":"","nickname":"Geek_f9f6b9","note":"","ucode":"90095DA80410D9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554811,"discussion_content":"奇怪，我自己模拟的表，update是可以走索引的；如果改成and，那1=2找不到任何一行，更新肯定失败啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646624042,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2853618,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/8a/f2/6c6f7886.jpg","nickname":"。。","note":"","ucode":"A52A6043D27D87","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553491,"discussion_content":"3. mysql5.7.17，自测可以走索引","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645928569,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1308729,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f8/39/4089c9b5.jpg","nickname":"胖子罗","note":"","ucode":"AF45AEED6064B3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387233,"discussion_content":"UPDATE b_side_order SET in_time = &#39;2018-08-04 08:34:44&#39; WHERE 1=2 or CODE = 332924;\n这个什么会不走索引呢？我自己模拟相似表是可以走索引的\nMySQL [alice]> explain update User set  regtime = &#39;2018-08-04 08:34:44&#39;  where 1=2 or platformUid=&#39;7646301&#39; ;\n+----+-------------+-------+------------+-------+---------------+-------------+---------+-------+------+----------+-------------+\n| id | select_type | table | partitions | type  | possible_keys | key         | key_len | ref   | rows | filtered | Extra       |\n+----+-------------+-------+------------+-------+---------------+-------------+---------+-------+------+----------+-------------+\n|  1 | UPDATE      | User  | NULL       | range | platformUid   | platformUid | 98      | const |    1 |   100.00 | Using where |\n+----+-------------+-------+------------+-------+---------------+-------------+---------+-------+------+----------+-------------+\n1 row in set (0.00 sec)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628065050,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1526355,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","nickname":"moonfox","note":"","ucode":"902BFF40EFA9FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1308729,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f8/39/4089c9b5.jpg","nickname":"胖子罗","note":"","ucode":"AF45AEED6064B3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538504,"discussion_content":"你的 platformUid 是索引字段吧，你加一个没有索引的字段 到 where里，不走了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639413733,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":387233,"ip_address":""},"score":538504,"extra":""}]},{"author":{"id":1285652,"avatar":"","nickname":"mycat","note":"","ucode":"6878BD32D042F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308386,"discussion_content":"为什么SQL中的or改为and就会走索引了呢？\n  UPDATE b_side_order SET in_time = &#39;2018-08-04 08:34:44&#39; WHERE 1=2 or CODE = 332924;\n\n有大神指导一下吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600935710,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1541014,"avatar":"https://static001.geekbang.org/account/avatar/00/17/83/96/73ff13a0.jpg","nickname":"天亮前说晚安","note":"","ucode":"1D82EE562A7C71","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":135209,"discussion_content":"SELECT * FROM post WHERE &#39;1&#39;=module_id AND omit = 0 or 1=2  这边可以走索引啊 你的mysql版本太低了吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579077616,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1762252,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/e3/cc/0947ff0b.jpg","nickname":"nestle","note":"","ucode":"469800BED81B54","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":98234,"discussion_content":"难道每一行都执行了一下1=2的判断？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577150298,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61821,"user_name":"700","can_delete":false,"product_type":"c1","uid":1072896,"ip_address":"","ucode":"E4BD0CBADAF951","user_header":"","comment_is_top":true,"comment_ctime":1547809921,"is_pvip":false,"replies":[{"id":"21949","content":"这个查询语句会对t3做全索引扫描，是使用了索引的，只是没有用上快速搜索功能","user_name":"作者回复","comment_id":61821,"uid":"1264162","ip_address":"","utype":1,"ctime":1547863244,"user_name_real":"林晓斌"}],"discussion_count":4,"race_medal":0,"score":"9.2233720641724006e+18","product_id":100020801,"comment_content":"老师您好，有个问题恳请指教。背景如下，我长话短说：<br><br>mysql&gt;select @@version;<br>5.6.30-log<br><br> CREATE TABLE `t1` ( `id` int(11) unsigned NOT NULL AUTO_INCREMENT,<br>  `user_id` int(11) NOT NULL,  `plan_id` int(11) NOT NULL DEFAULT &#39;0&#39; ,  PRIMARY KEY (`id`),<br>  KEY `userid` (`user_id`) USING BTREE,  KEY `idx_planid` (`plan_id`)<br>) ENGINE=InnoDB DEFAULT CHARSET=gb2312;<br><br> CREATE TABLE `t3` (<br>  `id` int(11) NOT NULL AUTO_INCREMENT,<br>  `status` int(4) NOT NULL DEFAULT &#39;0&#39;,<br>  `ootime` varchar(11) DEFAULT NULL,<br>  PRIMARY KEY (`id`),<br>  KEY `idx_xxoo` (`status`,`ootime`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;<br><br>t1 和 t3 表的字符集不一样<br><br>sql 执行计划如下：<br>explain<br>SELECT t1.id, t1.user_id<br>  FROM t1, t3<br> WHERE t1.plan_id = t3.id<br>   AND t3.ootime &lt; UNIX_TIMESTAMP(&#39;2022-01-18&#39;)<br>+----+-------------+-------+-------+---------------+--------------+---------+--------------+-------+----------------------------------------+<br>| id | select_type | table | type  | possible_keys | key          | key_len | ref          | rows  | Extra                                  |<br>+----+-------------+-------+-------+---------------+--------------+---------+--------------+-------+----------------------------------------+<br>|  1 | SIMPLE      | t3    | index | PRIMARY       | idx_xxoo     | 51      | NULL         | 39106 | Using where; Using index               |<br>|  1 | SIMPLE      | t1    | ref   | idx_planid    | idx_planid   | 4       |        t3.id |   401 | Using join buffer (Batched Key Access) |<br>+----+-------------+-------+-------+---------------+--------------+---------+--------------+-------+----------------------------------------+<br><br>我的疑惑是<br>1)t3 的 status 没出现在 where 条件中，但执行计划为什么用到了 idex_xxoo 索引？<br>2)为什么 t3.ootime 也用到索引了，从 key_len 看出。t3.ootime 是 varchar 类型的，而 UNIX_TIMESTAMP(&#39;2022-01-18&#39;) 是数值，不是发生了隐式转换吗？<br><br>请老师指点。<br>","like_count":7,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437007,"discussion_content":"这个查询语句会对t3做全索引扫描，是使用了索引的，只是没有用上快速搜索功能","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547863244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1529262,"avatar":"https://static001.geekbang.org/account/avatar/00/17/55/ae/7af3f742.jpg","nickname":"科学界","note":"","ucode":"E84BFE2C025209","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":223204,"discussion_content":"全索引扫描加覆盖索引。\n如果把连接条件改成t3的非id字段，执行计划的key就会显示null了","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1586189324,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1563985,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKdiaUiaCYQe9tibemaNU5ya7RrU3MYcSGEIG7zF27u0ZDnZs5lYxPb7KPrAsj3bibM79QIOnPXAatfIw/132","nickname":"Geek_a8be59","note":"","ucode":"BEC0F57B51DC44","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":269760,"discussion_content":"这个问题我感觉是因为t3.ootime做了隐式类型转化了，所以要扫描全表，但是他会判断主键索引树（id）和联合索引树（idx_xxoo）的大小，发现idx_xxoo的大小相对小，就选择idx_xxoo。又因为联合索引包括了主键id，所以用到了覆盖索引","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589946836,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2389270,"avatar":"https://static001.geekbang.org/account/avatar/00/24/75/16/6e28bf17.jpg","nickname":"初晨","note":"","ucode":"C5D95D13E49127","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1563985,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKdiaUiaCYQe9tibemaNU5ya7RrU3MYcSGEIG7zF27u0ZDnZs5lYxPb7KPrAsj3bibM79QIOnPXAatfIw/132","nickname":"Geek_a8be59","note":"","ucode":"BEC0F57B51DC44","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583777,"discussion_content":"这里跟隐式转换没有关系吧，索引是联合索引 `idx_xxoo` (`status`,`ootime`)，按照索引最左匹配原则，ootime是匹配不到索引的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660372477,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":269760,"ip_address":"陕西"},"score":583777,"extra":""}]}]},{"had_liked":false,"id":59324,"user_name":"探索无止境","can_delete":false,"product_type":"c1","uid":1044178,"ip_address":"","ucode":"91D2A9907DFA79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ee/d2/7024431c.jpg","comment_is_top":false,"comment_ctime":1547351089,"is_pvip":false,"replies":[{"id":"21394","content":"(这题目改成100万禾10000万比较好)<br>如果是考察语句写法，这两个表谁放前面都一样，优化器会调整顺序选择合适的驱动表；<br><br>如果是考察优化器怎么实现的，你可以这么想，每次在树搜索里面做一次查找都是log(n), 所以对比的是100*log(10000)和 10000*log(100)哪个小，显然是前者，所以结论应该是让小表驱动大表。","user_name":"作者回复","comment_id":59324,"uid":"1264162","ip_address":"","utype":1,"ctime":1547356983,"user_name_real":"林晓斌"}],"discussion_count":12,"race_medal":0,"score":"873425712177","product_id":100020801,"comment_content":"老师，有道面试题困扰了很久，求指教！题目是这样的，a表有100条记录，b表有10000条记录，两张表做关联查询时，是将a表放前面效率高，还是b表放前面效率高？网上各种答案，但感觉都没有十分的说服力，期待老师的指点！","like_count":204,"discussions":[{"author":{"id":1228424,"avatar":"https://static001.geekbang.org/account/avatar/00/12/be/88/8d15796f.jpg","nickname":"John","note":"","ucode":"A46AF2906C38C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":310598,"discussion_content":"如果是 where 子句中只有连表条件，没有其它筛选条件呢？如下：\n\n\nselect d.* from tradelog l, trade_detail d where d.tradeid=l.tradeid\n因为两个表在 where 子句中没有筛选条件，只有连接条件，所以驱动表肯定会扫描全表，所以时间复杂度是O(N)；然后连接条件可以相当于被驱动表的筛选条件了，此时时间复杂度为 N * log(M)。所以总的时间复杂度为 O(N) + N * log(M)，此时 N 为驱动表的行数，M 为被驱动表的行数，显然当 N > M 的时候，时间复杂度相对是大于当 M > N 的时候的（可以画函数曲线看看），也就是说大表作为驱动表的时候效率相对较低。所以 MySQL 在针对这种情况的时候，会使用小表驱动大表。\n\n","likes_number":19,"is_delete":false,"is_hidden":false,"ctime":1601945124,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1124075,"avatar":"https://static001.geekbang.org/account/avatar/00/11/26/eb/24e0ac9c.jpg","nickname":"嬴梦川","note":"","ucode":"104CDFD26A1711","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1228424,"avatar":"https://static001.geekbang.org/account/avatar/00/12/be/88/8d15796f.jpg","nickname":"John","note":"","ucode":"A46AF2906C38C1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369746,"discussion_content":"说的很清楚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619147171,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":310598,"ip_address":""},"score":369746,"extra":""}]},{"author":{"id":2249670,"avatar":"","nickname":"mofee888","note":"","ucode":"F1FB6F68DCF802","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337675,"discussion_content":"如果使用 straight_join ，left join 那小表放前面，如果使用 right join 小表放后面，如果使用inner join 那无所谓了优化器自己选择。","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1609037301,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2753462,"avatar":"","nickname":"谷峦坚","note":"","ucode":"AEF7DA5991E2FB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2249670,"avatar":"","nickname":"mofee888","note":"","ucode":"F1FB6F68DCF802","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391988,"discussion_content":"...left join 和 right join 本来就依赖于表顺序，改了不就违背业务初衷了吗，拿不到对应结果了。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1630747592,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":337675,"ip_address":""},"score":391988,"extra":""}]},{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436325,"discussion_content":"(这题目改成100万禾10000万比较好)\n如果是考察语句写法，这两个表谁放前面都一样，优化器会调整顺序选择合适的驱动表；\n\n如果是考察优化器怎么实现的，你可以这么想，每次在树搜索里面做一次查找都是log(n), 所以对比的是100*log(10000)和 10000*log(100)哪个小，显然是前者，所以结论应该是让小表驱动大表。","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1547356983,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1104568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/da/b8/01b76df7.jpg","nickname":"蓝色骨头","note":"","ucode":"79F0F2153F4E29","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":133996,"discussion_content":"个人简单理解，小表驱动大表就是100次大表的随机IO，大表驱动小表就是10000次小表的随机IO，但是实际情况是优化器会帮我们选择最小代价的执行计划，两种写法应该区别不太大","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1579006016,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"一元(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303545,"discussion_content":"这里完全没有明白为什可以抽象成 100*log(10000)和 10000*log(100) 的比较。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1599294031,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2280126,"avatar":"https://static001.geekbang.org/account/avatar/00/22/ca/be/3771706c.jpg","nickname":"卖火柴的加菲猫","note":"","ucode":"9146C9E232A156","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1809802,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/8a/a2d34896.jpg","nickname":"一元(wx:abley1874)","note":"","ucode":"5E7A33642FC767","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":330386,"discussion_content":"第一张表是要全表扫描的，先在第一张表中取一条数据，去第二张表里面查对应的数据，这一次查询的时间复杂度是log(n)的","likes_number":11,"is_delete":false,"is_hidden":false,"ctime":1606610065,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":303545,"ip_address":""},"score":330386,"extra":""}]},{"author":{"id":1052994,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/226NabDEu1IGMN7Om1gQqG22hk2dZKojpB0KDpAK0vtujQLdlgZsVaPbIc4ymcib0NdH3Syh8YibRuL7Lv5kVCkg/132","nickname":"果子","note":"","ucode":"D7B288A3E722F7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":402856,"discussion_content":"其实就是循环次数不一样，大表做驱动明显循环次数多","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633957774,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1114326,"avatar":"https://static001.geekbang.org/account/avatar/00/11/00/d6/d976dd07.jpg","nickname":"解骥盛","note":"","ucode":"7E790CA9CFCECD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285695,"discussion_content":"如果小表能加载到内存呢，这种会如何选择","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592917379,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2086624,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/d6/e0/3ccaaa7b.jpg","nickname":"领子","note":"","ucode":"64AC4E6AB74E68","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1114326,"avatar":"https://static001.geekbang.org/account/avatar/00/11/00/d6/d976dd07.jpg","nickname":"解骥盛","note":"","ucode":"7E790CA9CFCECD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294752,"discussion_content":"小表:   非常小的表及其索引可能长期存在于数据库的缓冲池中，至少在一个连接查询中，没有页会被读取多次。在这样的表和索引上进行随机读取所耗费的时间很小，至少在页被第一次读取之后是这样的。所以，当这样的表不是外层表时，对其大量的随机读取也不会成为问题\n摘至: 《数据库索引设计与优化》","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1595988866,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":285695,"ip_address":""},"score":294752,"extra":""}]},{"author":{"id":1206544,"avatar":"https://static001.geekbang.org/account/avatar/00/12/69/10/275ae749.jpg","nickname":"懒猫","note":"","ucode":"B4B567A11B491D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":48806,"discussion_content":"100*log(10000)，我的理解是小表使用了全表扫描，大表使用了索引(log10000)，也就是说大表查询有where id=&#39;xxx&#39;，即大表使用了固定值匹配，不应该是大表驱动小表吗，有点糊涂了~~~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573528925,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53249,"user_name":"Leon📷","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1545619348,"is_pvip":false,"replies":[{"id":"19285","content":"精辟😄","user_name":"作者回复","comment_id":53249,"uid":"1264162","ip_address":"","utype":1,"ctime":1545622985,"user_name_real":"林晓斌"}],"discussion_count":9,"race_medal":0,"score":"426747381652","product_id":100020801,"comment_content":"索引字段不能进行函数操作，但是索引字段的参数可以玩函数，一言以蔽之","like_count":99,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434082,"discussion_content":"精辟😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545622985,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2601228,"avatar":"https://static001.geekbang.org/account/avatar/00/27/b1/0c/0764e1f7.jpg","nickname":"不愿将就","note":"","ucode":"482C6D5AD3B090","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540402,"discussion_content":"这句话的意思是不是等号右边可以随便玩","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1640053594,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1055810,"avatar":"https://static001.geekbang.org/account/avatar/00/10/1c/42/d3a0e33a.jpg","nickname":"希德小子","note":"","ucode":"0F3DA846858DBD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":2601228,"avatar":"https://static001.geekbang.org/account/avatar/00/27/b1/0c/0764e1f7.jpg","nickname":"不愿将就","note":"","ucode":"482C6D5AD3B090","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576104,"discussion_content":"我感觉就是这个意思","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1655279196,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":540402,"ip_address":""},"score":576104,"extra":""}]},{"author":{"id":1102781,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d3/bd/f028955a.jpg","nickname":"金华","note":"","ucode":"938163D760007B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":107772,"discussion_content":"索引字段的参数可以玩函数， 是啥意思？求详解","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1577605711,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1104568,"avatar":"https://static001.geekbang.org/account/avatar/00/10/da/b8/01b76df7.jpg","nickname":"蓝色骨头","note":"","ucode":"79F0F2153F4E29","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1102781,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d3/bd/f028955a.jpg","nickname":"金华","note":"","ucode":"938163D760007B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":134002,"discussion_content":"就是表中索引字段不能加函数，可能会导致索引丢失有序性，但是入参可以随便操作，因为不影响索引有序性","likes_number":9,"is_delete":false,"is_hidden":false,"ctime":1579006288,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":107772,"ip_address":""},"score":134002,"extra":""}]},{"author":{"id":1642651,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/M3WupzuEFNtAhibsvbVxdOPTFUDDxWxicYdtN95WlPXZshsMibibB0wiaS0BEjXJ6PrpApEYDNw9tSMHrroyL2qgAiag/132","nickname":"Yvan","note":"","ucode":"CA6D6FCA672F87","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":414888,"discussion_content":"并不一定，我遇到一种情况，自定义函数操作参数，执行计划看到不走索引，不知道老师还在不在使用极客时间看不看得到这个","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636915776,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1947977,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/yxHqAIqgfibHVg6VCSlNRLxajk4f2FT2kicWUpd4TD4HegNdS5UU0P7fB5agppt3N1J1NRsbfXeayZiarLouzbc3A/132","nickname":"天空下的海","note":"","ucode":"0EBA6366E86040","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":287855,"discussion_content":"MySQL 官网 “In all other cases, the arguments are compared as floating-point (real) numbers.” 字段为int，值为string这种情况，字段也要进行转换的，怎么解释？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593569818,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1285652,"avatar":"","nickname":"mycat","note":"","ucode":"6878BD32D042F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1947977,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/yxHqAIqgfibHVg6VCSlNRLxajk4f2FT2kicWUpd4TD4HegNdS5UU0P7fB5agppt3N1J1NRsbfXeayZiarLouzbc3A/132","nickname":"天空下的海","note":"","ucode":"0EBA6366E86040","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308400,"discussion_content":"字段为int，值为string，就是把string转换为int，然后和字段比较呀？","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1600939748,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":287855,"ip_address":""},"score":308400,"extra":""}]},{"author":{"id":1018696,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/48/e2279b0e.jpg","nickname":"绵阳米粉儿真好吃","note":"","ucode":"F82499FD76B5EF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4244,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565249537,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53406,"user_name":"某、人","can_delete":false,"product_type":"c1","uid":1308784,"ip_address":"","ucode":"ADB42AA12A11C1","user_header":"https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg","comment_is_top":false,"comment_ctime":1545639684,"is_pvip":false,"discussion_count":12,"race_medal":0,"score":"276423546628","product_id":100020801,"comment_content":"SQL逻辑相同,性能差异较大的,通过老师所讲学习到的,和平时碰到的,大概有以下几类:<br>一.字段发生了转换,导致本该使用索引而没有用到索引<br>1.条件字段函数操作<br>2.隐式类型转换<br>3.隐式字符编码转换<br>(如果驱动表的字符集比被驱动表得字符集小，关联列就能用到索引,如果更大,需要发生隐式编码转换,则不能用到索引,latin&lt;gbk&lt;utf8&lt;utf8mb4)<br><br>二.嵌套循环,驱动表与被驱动表选择错误<br>1.连接列上没有索引,导致大表驱动小表,或者小表驱动大表(但是大表走的是全表扫描) --连接列上建立索引<br>2.连接列上虽然有索引,但是驱动表任然选择错误。--通过straight_join强制选择关联表顺序<br>3.子查询导致先执行外表在执行子查询,也是驱动表与被驱动表选择错误。 <br>--可以考虑把子查询改写为内连接,或者改写内联视图(子查询放在from后组成一个临时表,在于其他表进行关联)<br>4.只需要内连接的语句,但是写成了左连接或者右连接。比如select * from t left join b on t.id=b.id where b.name=&#39;abc&#39;驱动表被固定,大概率会扫描更多的行,导致效率降低.  <br> --根据业务情况或sql情况,把左连接或者右连接改写为内连接<br><br>三.索引选择不同,造成性能差异较大<br>1.select * from t where aid= and create_name&gt;&#39;&#39; order by id limit 1;<br>选择走id索引或者选择走(aid,create_time)索引,性能差异较大.结果集都有可能不一致<br>--这个可以通过where条件过滤的值多少来大概判断,该走哪个索引<br><br>四.其它一些因素<br>1.比如之前学习到的是否有MDL X锁<br>2.innodb_buffer_pool设置得太小,innodb_io_capacity设置得太小,刷脏速度跟不上<br>3.是否是对表做了DML语句之后,马上做select,导致change buffer收益不高<br>4.是否有数据空洞<br>5.select选取的数据是否在buffer_pool中<br>6.硬件原因,资源抢占<br>原因多种多样,还需要慢慢补充。<br><br>老师我问一个问题:<br>连接列上一个是int一个是bigint或者一个是char一个varchar,为什么被驱动表上会出现(using index condition)?","like_count":65,"discussions":[{"author":{"id":1114963,"avatar":"https://static001.geekbang.org/account/avatar/00/11/03/53/49ad47bc.jpg","nickname":"张永胜 潮阳。","note":"","ucode":"531E29A708A525","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580152,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657928070,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1770180,"avatar":"","nickname":"Geek_f5dbdf","note":"","ucode":"E21FBF68F7C6D0","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572625,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652876854,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2065035,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/82/8b/74996124.jpg","nickname":"Suarge","note":"","ucode":"89F0B968E472ED","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557377,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647782831,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2375518,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJjUlpicxYn2HMHiahGFIficiaOfrZia5s8sY2XTgYtFtRUXjgecuyr4hhrpLA9vx48qxLajvZn7D2qdibA/132","nickname":"Geek_382cd1","note":"","ucode":"33387CE620FC7A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351968,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614531434,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1627397,"avatar":"https://static001.geekbang.org/account/avatar/00/18/d5/05/8fd8ca4c.jpg","nickname":"快快乐乐","note":"","ucode":"D093D8D5836FF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343895,"discussion_content":"差距不是一点点","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611210607,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1785448,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3e/68/c2b2a285.jpg","nickname":"will","note":"","ucode":"6843B14B09192F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":340781,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610156792,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1813207,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/aa/d7/a417ad5b.jpg","nickname":"CharAt","note":"","ucode":"D7D44B48FC4E79","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318874,"discussion_content":"这差距太大了 我这是第三次回来重新看 任然学不少东西","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603871579,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1308784,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg","nickname":"某、人","note":"","ucode":"ADB42AA12A11C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1813207,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/aa/d7/a417ad5b.jpg","nickname":"CharAt","note":"","ucode":"D7D44B48FC4E79","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":324797,"discussion_content":"加油������","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605171969,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":318874,"ip_address":""},"score":324797,"extra":""}]},{"author":{"id":1194527,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3a/1f/5b8f0d71.jpg","nickname":"张俭","note":"","ucode":"6A94534F11C4BF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":286190,"discussion_content":"老哥，请问结果集啥情况会不一致呢?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593082264,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1194527,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3a/1f/5b8f0d71.jpg","nickname":"张俭","note":"","ucode":"6A94534F11C4BF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587574,"discussion_content":"limit，堆排序不稳定","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663150386,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":286190,"ip_address":"广东"},"score":587574,"extra":""}]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":160696,"discussion_content":"用到索引还不好?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580823977,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1000060,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/7c/8ef14715.jpg","nickname":"🄽🄸🅇🅄🅂","note":"","ucode":"853763C229A5AA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":19391,"discussion_content":"老哥，你真是神一样的存在","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569166622,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91276,"user_name":"乔纳森","can_delete":false,"product_type":"c1","uid":1045107,"ip_address":"","ucode":"51EC9FAE071388","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f2/73/1c7bceae.jpg","comment_is_top":false,"comment_ctime":1556960828,"is_pvip":true,"discussion_count":2,"race_medal":0,"score":"254960031292","product_id":100020801,"comment_content":"执行explain 语句后，使用show warnings; 可以看到MySQL 实际执行的SQL，包括字符集的转换","like_count":60,"discussions":[{"author":{"id":2562181,"avatar":"https://static001.geekbang.org/account/avatar/00/27/18/85/83ac977e.jpg","nickname":"半年 2号","note":"","ucode":"7F23C4532A5513","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539269,"discussion_content":"点赞","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639653263,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"温故而知新可以为师矣","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":135227,"discussion_content":"niubility","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579078454,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53212,"user_name":"风轨","can_delete":false,"product_type":"c1","uid":1185844,"ip_address":"","ucode":"7B8A5233B61EB0","user_header":"https://static001.geekbang.org/account/avatar/00/12/18/34/c082419c.jpg","comment_is_top":false,"comment_ctime":1545616469,"is_pvip":false,"replies":[{"id":"19282","content":"👍🏿","user_name":"作者回复","comment_id":53212,"uid":"1264162","ip_address":"","utype":1,"ctime":1545622874,"user_name_real":"林晓斌"}],"discussion_count":4,"race_medal":0,"score":"242063785045","product_id":100020801,"comment_content":"刚试了文中穿插得思考题:当主键是整数类型条件是字符串时，会走索引。<br>文中提到了当字符串和数字比较时会把字符串转化为数字，所以隐式转换不会应用到字段上，所以可以走索引。<br>另外，select &#39;a&#39; = 0 ; 的结果是1，说明无法转换成数字的字符串都被转换成0来处理了。","like_count":56,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434067,"discussion_content":"👍🏿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545622874,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1617939,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b0/13/5cb3459c.jpg","nickname":"浑浑噩噩cium","note":"","ucode":"358C0BCFF62B40","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":35187,"discussion_content":"同理select &#34;13m456&#34;=13;结果为1，说明为截断式的转换，遇到一个不能转换的停止转换，并且返回前面已经转换成功的数字作为结果","likes_number":30,"is_delete":false,"is_hidden":false,"ctime":1571239922,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1314724,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0f/a4/0b49469f.jpg","nickname":"木子00","note":"","ucode":"8F78CA722EB29B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1617939,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b0/13/5cb3459c.jpg","nickname":"浑浑噩噩cium","note":"","ucode":"358C0BCFF62B40","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":307292,"discussion_content":"学习了。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1600592091,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":35187,"ip_address":""},"score":307292,"extra":""}]},{"author":{"id":2278559,"avatar":"https://static001.geekbang.org/account/avatar/00/22/c4/9f/a01e4bd1.jpg","nickname":"海浪","note":"","ucode":"091941B3556B4B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":327172,"discussion_content":"所以隐式转换不会应用到字段上  --这句话改为：id字段上不会有隐式转换  比较好","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1605758795,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54249,"user_name":"crazyone","can_delete":false,"product_type":"c1","uid":1115042,"ip_address":"","ucode":"705E34642E41F5","user_header":"https://static001.geekbang.org/account/avatar/00/11/03/a2/ceb37046.jpg","comment_is_top":false,"comment_ctime":1545815516,"is_pvip":false,"replies":[{"id":"19615","content":"Using index是覆盖索引<br>Using index condition 是索引下推","user_name":"作者回复","comment_id":54249,"uid":"1264162","ip_address":"","utype":1,"ctime":1545818286,"user_name_real":"林晓斌"}],"discussion_count":4,"race_medal":0,"score":"194819343836","product_id":100020801,"comment_content":"老师你好，我在执行explain的时候，发现extra 里面 有using where，using index ，using index condition 能具体讲下这几个的区别吗？","like_count":46,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434408,"discussion_content":"Using index是覆盖索引\nUsing index condition 是索引下推","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1545818286,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1641319,"avatar":"https://static001.geekbang.org/account/avatar/00/19/0b/67/dc49a1a8.jpg","nickname":"在路上","note":"","ucode":"E1184E76B14431","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582214,"discussion_content":"那using where呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659318815,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"美国"},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1641319,"avatar":"https://static001.geekbang.org/account/avatar/00/19/0b/67/dc49a1a8.jpg","nickname":"在路上","note":"","ucode":"E1184E76B14431","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587575,"discussion_content":"using where 说明执行器还会进行过滤；\n一般where语句会被拆解成 index key，index filter，table filter\nindex key：树搜索\nindex filter: icp\ntable filter: 执行器过滤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663150952,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":582214,"ip_address":"广东"},"score":587575,"extra":""}]},{"author":{"id":2562181,"avatar":"https://static001.geekbang.org/account/avatar/00/27/18/85/83ac977e.jpg","nickname":"半年 2号","note":"","ucode":"7F23C4532A5513","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539270,"discussion_content":"mark  。using index覆盖索引，using index condition索引下推，即能上索引的，先做过滤，再按剩下的条件过滤。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639653455,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70501,"user_name":"饭粒","can_delete":false,"product_type":"c1","uid":1153455,"ip_address":"","ucode":"4C3220B0D43997","user_header":"https://static001.geekbang.org/account/avatar/00/11/99/af/d29273e2.jpg","comment_is_top":false,"comment_ctime":1551108132,"is_pvip":false,"replies":[{"id":"25166","content":"👍 总结得很好<br><br>“顺势而查”才能用上索引😆","user_name":"作者回复","comment_id":70501,"uid":"1264162","ip_address":"","utype":1,"ctime":1551139403,"user_name_real":"林晓斌"}],"discussion_count":1,"race_medal":0,"score":"113220257828","product_id":100020801,"comment_content":"感觉要使用索引就不能“破坏”索引原有的顺序，这节的函数操作，隐式转换都“破坏”了原有的顺序。前一节的select * from t where city in in (“杭州”,&quot; 苏州 &quot;) order by name limit 100; 同样是破坏了 (city,name) 联合索引的递增顺序，类似的还有使用联合索引，一个字段DESC，一个ASC。","like_count":26,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440668,"discussion_content":"👍 总结得很好\n\n“顺势而查”才能用上索引😆","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551139403,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57199,"user_name":"匿名的朋友","can_delete":false,"product_type":"c1","uid":1316471,"ip_address":"","ucode":"D1A2A8E466FDD1","user_header":"https://static001.geekbang.org/account/avatar/00/14/16/77/73bd9d18.jpg","comment_is_top":false,"comment_ctime":1546680843,"is_pvip":false,"replies":[{"id":"20631","content":"有，先where ,再order by 最后limit ","user_name":"作者回复","comment_id":57199,"uid":"1264162","ip_address":"","utype":1,"ctime":1546689922,"user_name_real":"林晓斌"}],"discussion_count":2,"race_medal":0,"score":"108920863243","product_id":100020801,"comment_content":"丁奇老师，我有个疑问，就是sql语句执行时那些order by group by  limit 以及where条件，有执行的先后顺序吗？","like_count":25,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435459,"discussion_content":"有，先where ,再order by 最后limit ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1546689922,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1447569,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/WtHCCMoLJ2DvzqQwPYZyj2RlN7eibTLMHDMTSO4xIKjfKR1Eh9L98AMkkZY7FmegWyGLahRQJ5ibPzeeFtfpeSow/132","nickname":"脱缰的野马__","note":"","ucode":"D5F993E7232C61","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":298265,"discussion_content":"老师前面的文章讲过的一些SQL例子详细执行过程就有啦","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1597230096,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63755,"user_name":"涛哥哥","can_delete":false,"product_type":"c1","uid":1361159,"ip_address":"","ucode":"329A1384E3AB5E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqJobg767PUeqrqQQ4B6YvMatj2SRyOicKZZ4gWTf30dMketiaj58Gc3RFTmckGxAXlL9ERSxGovq9g/132","comment_is_top":false,"comment_ctime":1548489207,"is_pvip":false,"replies":[{"id":"22563","content":"1. 优化器会排个序，目的是如果这几个记录对应的数据都不在内存里，可以触发顺序读盘，后面文章我们介绍到join的时候，会提到MRR，你关注下<br><br>2. in里面值多就是多次执行树搜索，跟全表扫描的速度对比，就看in里面的数据个数的比例了。 你的in里面一般多少个value呀","user_name":"作者回复","comment_id":63755,"uid":"1264162","ip_address":"","utype":1,"ctime":1548515501,"user_name_real":"林晓斌"}],"discussion_count":9,"race_medal":0,"score":"83152867831","product_id":100020801,"comment_content":"老师，您好！我是做后端开发的。想问一下 mysql in关键字 的内部原理，能抽一点点篇幅讲一下吗？比如：select * from T where id in (a,b,d,c,,e,f); id是主键。1、为什么查询出来的结果集会按照id排一次序呢（是跟去重有关系么）？2、如果 in 里面的值较多的时候，就会比较慢啊（是还不如全表扫描么）？问我们公司很多后端的，都不太清楚，问我们DBA，他说默认就是这样（这不跟没说一样吗）。希望老师可以帮忙解惑。祝老师身体健康！微笑~","like_count":19,"discussions":[{"author":{"id":1334463,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIdIwR8uj8espUpYYMV0QhP88U4dx3hU5G58RGKuubUiaRgzj5e8WAgucxZibySICEF2rX4ErLJn6lg/132","nickname":"平凡中的不平凡","note":"","ucode":"D1235E6E8378A6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":224850,"discussion_content":"in里面每个值都单独执行树搜索的话，那还怎么进行顺序读盘呢？有点困惑","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1586334894,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1214347,"avatar":"https://static001.geekbang.org/account/avatar/00/12/87/8b/79c1203a.jpg","nickname":"拉上板车上高速","note":"","ucode":"3F948501BED87D","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1334463,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIdIwR8uj8espUpYYMV0QhP88U4dx3hU5G58RGKuubUiaRgzj5e8WAgucxZibySICEF2rX4ErLJn6lg/132","nickname":"平凡中的不平凡","note":"","ucode":"D1235E6E8378A6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334840,"discussion_content":"有一个局部性原理，当计算机在读取数据加载到内存中时，会把该数据后面的一些数据也读到内存里。。应该是这个原理，好像有这么一个实验，性能好一点的机械硬盘的顺序读是和内存的随机读快的。。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1608005911,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":224850,"ip_address":""},"score":334840,"extra":""},{"author":{"id":1601661,"avatar":"","nickname":"GEEKBANG_8559966","note":"","ucode":"C3C87C3D7164FD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1334463,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIdIwR8uj8espUpYYMV0QhP88U4dx3hU5G58RGKuubUiaRgzj5e8WAgucxZibySICEF2rX4ErLJn6lg/132","nickname":"平凡中的不平凡","note":"","ucode":"D1235E6E8378A6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":405236,"discussion_content":"比如说，你现在id=1和id=2的数据挨在一块，然后你在读1的时候不是要把数据源1这行加载到内存嘛，操作系统在加载的时候，是一块一块加载的，很有可能就把2也一并搞进来了，然后你去读2的时候，他已经在内存里面了。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1634537948,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":224850,"ip_address":""},"score":405236,"extra":""}]},{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437706,"discussion_content":"1. 优化器会排个序，目的是如果这几个记录对应的数据都不在内存里，可以触发顺序读盘，后面文章我们介绍到join的时候，会提到MRR，你关注下\n\n2. in里面值多就是多次执行树搜索，跟全表扫描的速度对比，就看in里面的数据个数的比例了。 你的in里面一般多少个value呀","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1548515501,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1937317,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/8f/a5/d613dfc7.jpg","nickname":"小正","note":"","ucode":"D6D68DCC9650FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333030,"discussion_content":"mysql在这个case的处理上，为什么不能只扫描一次，然后拿结果跟in里面所有的记录做对比，非要用in里面每个值去扫一遍呢，这个有点想不通","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607418824,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1361159,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqJobg767PUeqrqQQ4B6YvMatj2SRyOicKZZ4gWTf30dMketiaj58Gc3RFTmckGxAXlL9ERSxGovq9g/132","nickname":"涛哥哥","note":"","ucode":"329A1384E3AB5E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1937317,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/8f/a5/d613dfc7.jpg","nickname":"小正","note":"","ucode":"D6D68DCC9650FA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336243,"discussion_content":"难道你要挨个遍历数据去和in里面的值对比吗？大量数据的话遍历非常耗时，少数据量才可以按你说的来做。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1608538450,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":333030,"ip_address":""},"score":336243,"extra":""},{"author":{"id":1052994,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/226NabDEu1IGMN7Om1gQqG22hk2dZKojpB0KDpAK0vtujQLdlgZsVaPbIc4ymcib0NdH3Syh8YibRuL7Lv5kVCkg/132","nickname":"果子","note":"","ucode":"D7B288A3E722F7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1937317,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/8f/a5/d613dfc7.jpg","nickname":"小正","note":"","ucode":"D6D68DCC9650FA","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":402858,"discussion_content":"那就变成全表扫描了，失去了 in 的意义","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633957948,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":333030,"ip_address":""},"score":402858,"extra":""}]},{"author":{"id":1006421,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5b/55/2a465781.jpg","nickname":"Hurray","note":"","ucode":"88ED3859A2736B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":220493,"discussion_content":"一般1000个内性能还好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585884162,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1361159,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqJobg767PUeqrqQQ4B6YvMatj2SRyOicKZZ4gWTf30dMketiaj58Gc3RFTmckGxAXlL9ERSxGovq9g/132","nickname":"涛哥哥","note":"","ucode":"329A1384E3AB5E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1006421,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5b/55/2a465781.jpg","nickname":"Hurray","note":"","ucode":"88ED3859A2736B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336244,"discussion_content":"主要看总数据量和in里面的数据量之比","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608538497,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":220493,"ip_address":""},"score":336244,"extra":""}]}]},{"had_liked":false,"id":96744,"user_name":"greatcl","can_delete":false,"product_type":"c1","uid":1009449,"ip_address":"","ucode":"44D3C55394EC08","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/29/b0ec5430.jpg","comment_is_top":false,"comment_ctime":1558496300,"is_pvip":false,"replies":[{"id":"35325","content":"👍 这个感觉太赞啦","user_name":"作者回复","comment_id":96744,"uid":"1264162","ip_address":"","utype":1,"ctime":1559062132,"user_name_real":"林晓斌"}],"discussion_count":1,"race_medal":0,"score":"61688038444","product_id":100020801,"comment_content":"刚刚帮一个同事看SQL慢的问题，帮他找出来问题，并拿出这篇文章让他看，哈哈","like_count":14,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450999,"discussion_content":"👍 这个感觉太赞啦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559062132,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53351,"user_name":"可凡不凡","can_delete":false,"product_type":"c1","uid":1296289,"ip_address":"","ucode":"9D42D6C5274D48","user_header":"https://static001.geekbang.org/account/avatar/00/13/c7/a1/273bff58.jpg","comment_is_top":false,"comment_ctime":1545630554,"is_pvip":false,"replies":[{"id":"19316","content":"额，你是第三个提这个问题的了，我得好好考虑下安排😄","user_name":"作者回复","comment_id":53351,"uid":"1264162","ip_address":"","utype":1,"ctime":1545639859,"user_name_real":"林晓斌"}],"discussion_count":2,"race_medal":0,"score":"57380205402","product_id":100020801,"comment_content":"1.老师对于多表联合查询中,MySQL 对索引的选择 以后会详细介绍吗?<br>","like_count":13,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434107,"discussion_content":"额，你是第三个提这个问题的了，我得好好考虑下安排😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545639859,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"一步","note":"","ucode":"73CEA468CE70C3","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":66997,"discussion_content":"这个问题 老师安排了吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575119622,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53593,"user_name":"探索无止境","can_delete":false,"product_type":"c1","uid":1044178,"ip_address":"","ucode":"91D2A9907DFA79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ee/d2/7024431c.jpg","comment_is_top":false,"comment_ctime":1545698944,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"44495371904","product_id":100020801,"comment_content":"多表连接时，mysql是怎么选择驱动表和被驱动表的？这个很重要，希望老师可以讲讲","like_count":10,"discussions":[{"author":{"id":1255051,"avatar":"https://static001.geekbang.org/account/avatar/00/13/26/8b/2bb5f68f.jpg","nickname":"ymeh","note":"","ucode":"6404D4B0DD1E44","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":182474,"discussion_content":"在join那章节有讲到 主要看后面的筛选条件 筛选条件之后数据更少的会被作为驱动表","likes_number":9,"is_delete":false,"is_hidden":false,"ctime":1582428410,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2070879,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/99/5f/9232a19f.jpg","nickname":"Lion","note":"","ucode":"BD8DDC17EAE6FD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293726,"discussion_content":"老师的例子里面的驱动表不是where的条件定的吗？\nmysql>select l.operator from tradelog l , trade_detail d where d.tradeid=l.tradeid and d.id=4;这句因为是D.ID=4,所以drade_detail是驱动表","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1595649398,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"温故而知新可以为师矣","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":135228,"discussion_content":"时间复杂度","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579078535,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53865,"user_name":"Wrelon","can_delete":false,"product_type":"c1","uid":1306021,"ip_address":"","ucode":"8670BDBF317A36","user_header":"https://static001.geekbang.org/account/avatar/00/13/ed/a5/ca3b4cc4.jpg","comment_is_top":false,"comment_ctime":1545744552,"is_pvip":false,"replies":[{"id":"19522","content":"👍🏿 对大家有帮助我最开心啦😄","user_name":"作者回复","comment_id":53865,"uid":"1264162","ip_address":"","utype":1,"ctime":1545746949,"user_name_real":"林晓斌"}],"discussion_count":1,"race_medal":0,"score":"35905482920","product_id":100020801,"comment_content":"在第10章的时候提问过一次，当时表述的不够清楚，现在知道了，应该是因为隐式类型转换导致了全索引扫描。这个课程真实太棒了，我踩过的坑都说了。","like_count":8,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434272,"discussion_content":"👍🏿 对大家有帮助我最开心啦😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545746949,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54579,"user_name":"TKbook","can_delete":false,"product_type":"c1","uid":1073829,"ip_address":"","ucode":"F6E0E99CC79059","user_header":"https://static001.geekbang.org/account/avatar/00/10/62/a5/43aa0c27.jpg","comment_is_top":false,"comment_ctime":1545903840,"is_pvip":false,"replies":[{"id":"19803","content":"取其中三条…","user_name":"作者回复","comment_id":54579,"uid":"1264162","ip_address":"","utype":1,"ctime":1545905132,"user_name_real":"林晓斌"}],"discussion_count":3,"race_medal":0,"score":"27315707616","product_id":100020801,"comment_content":"老师，对于最后回答上一课的问题：mysql&gt; select * from t limit N, M-N+1;<br>这个语句也不是取3条记录。 没理解。","like_count":6,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434500,"discussion_content":"取其中三条…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545905132,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1672786,"avatar":"https://static001.geekbang.org/account/avatar/00/19/86/52/91c7d112.jpg","nickname":"Garen","note":"","ucode":"0608C88F83EF0C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":35769,"discussion_content":"完全不理解，那我直接取所有数据，再取其中3条，那扫描行数还更少呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571304053,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1544282,"avatar":"https://static001.geekbang.org/account/avatar/00/17/90/5a/9664cb4f.jpg","nickname":"sighting","note":"","ucode":"C2ABCB756AD28B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1672786,"avatar":"https://static001.geekbang.org/account/avatar/00/19/86/52/91c7d112.jpg","nickname":"Garen","note":"","ucode":"0608C88F83EF0C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":347062,"discussion_content":"取所有数据扫描行数就是所有行数了，limitN, M-N+1;扫描行数是M+1（从表的开始到取得最大值）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612146267,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":35769,"ip_address":""},"score":347062,"extra":""}]}]},{"had_liked":false,"id":53538,"user_name":"书策稠浊","can_delete":false,"product_type":"c1","uid":1307497,"ip_address":"","ucode":"A29875CE15FDA3","user_header":"https://static001.geekbang.org/account/avatar/00/13/f3/69/7039d03f.jpg","comment_is_top":false,"comment_ctime":1545666448,"is_pvip":false,"replies":[{"id":"19486","content":"取回来以后再挑那三个呀😄","user_name":"作者回复","comment_id":53538,"uid":"1264162","ip_address":"","utype":1,"ctime":1545702972,"user_name_real":"林晓斌"}],"discussion_count":1,"race_medal":0,"score":"27315470224","product_id":100020801,"comment_content":"上期问题答案是取三个数，但是这里貌似不是三个数，不理解。","like_count":6,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434173,"discussion_content":"取回来以后再挑那三个呀😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545702972,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53335,"user_name":"asdf100","can_delete":false,"product_type":"c1","uid":1043738,"ip_address":"","ucode":"39D8D71453E575","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ed/1a/ce7f7d54.jpg","comment_is_top":false,"comment_ctime":1545627738,"is_pvip":false,"replies":[{"id":"19306","content":"优化器信息是引擎给的，<br>引擎是这么判断的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545639256,"ip_address":"","comment_id":53335,"utype":1}],"discussion_count":3,"race_medal":0,"score":"27315431514","product_id":100020801,"comment_content":"在这个例子里，放弃了树搜索功能，优化器可以选择遍历主键索引，也可以选择遍历索引 t_modified，优化器对比索引大小后发现，索引 t_modified 更小，遍历这个索引比遍历主键索引来得更快。<br><br>优化器如何对比的，根据参与字段字段类型占用空间大小吗？","like_count":6,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434101,"discussion_content":"优化器信息是引擎给的，\n引擎是这么判断的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545639256,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1620479,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b9/ff/ea6c2e86.jpg","nickname":"景梦园","note":"","ucode":"0A17708457ACB2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":287549,"discussion_content":"我也有疑问，int 比 datetime 更小才对啊","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1593481163,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2344609,"avatar":"https://static001.geekbang.org/account/avatar/00/23/c6/a1/3bdcde91.jpg","nickname":"向陽花开花向陽🌸","note":"","ucode":"9FDD01BE0E42CD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375335,"discussion_content":"遍历主键索引的话，每条记录是完整的，占用的数据页可能要多。在相同的记录数前提下，优化器取占用页面少的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621582262,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58064,"user_name":"运斤成风","can_delete":false,"product_type":"c1","uid":1350812,"ip_address":"","ucode":"BAFF69C29FDFA5","user_header":"https://static001.geekbang.org/account/avatar/00/14/9c/9c/e02a0daf.jpg","comment_is_top":false,"comment_ctime":1546987843,"is_pvip":false,"replies":[{"id":"21119","content":"只要是要“使用树搜索的索引字段”，都不应该有函数操作","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547119049,"ip_address":"","comment_id":58064,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23021824323","product_id":100020801,"comment_content":"说下我的理解：驱动表的索引字段不能添加函数运算或算术运算，若是则无法用到快速索引。而被驱动表则没有这个限制。","like_count":5,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435886,"discussion_content":"只要是要“使用树搜索的索引字段”，都不应该有函数操作","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547119049,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54252,"user_name":"向前走","can_delete":false,"product_type":"c1","uid":1112651,"ip_address":"","ucode":"8956E92DCEFB60","user_header":"https://static001.geekbang.org/account/avatar/00/10/fa/4b/c385f755.jpg","comment_is_top":false,"comment_ctime":1545815725,"is_pvip":false,"replies":[{"id":"19618","content":"没有，语义一样的😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545818701,"ip_address":"","comment_id":54252,"utype":1}],"discussion_count":2,"race_medal":0,"score":"23020652205","product_id":100020801,"comment_content":"老师您好,问个可能低级的问题,个人不太明白,望解惑下,就是我看您写的那些多个表的关联查询里面没有使用join关键字来关联两个表的查询,想问下是mysql默认作了join操作,还是join的写法对性能有什么影响而不使用join么,谢谢","like_count":5,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434409,"discussion_content":"没有，语义一样的😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545818701,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"温故而知新可以为师矣","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":135250,"discussion_content":"最终执行还是join","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579080021,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53608,"user_name":"Leon📷","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1545700504,"is_pvip":false,"replies":[{"id":"19477","content":"有没有好的业务表的设计，这类问题我第一次听到，能不能展开一下，这样说不要清楚面试官的考核点是啥…","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545702321,"ip_address":"","comment_id":53608,"utype":1}],"discussion_count":3,"race_medal":0,"score":"23020536984","product_id":100020801,"comment_content":"老师，经常面试被问到工作中做了什么优化，有没有好的业务表的设计，请问老师课程结束后能不能给我们一个提纲挈领的大纲套路，让我们有个脉络和思路来应付这种面试套路","like_count":5,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434204,"discussion_content":"有没有好的业务表的设计，这类问题我第一次听到，能不能展开一下，这样说不要清楚面试官的考核点是啥…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545702321,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":160704,"discussion_content":"我估计面试官脑子也是浆糊","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1580824154,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2869154,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/c7/a2/e7c3b76d.jpg","nickname":"无影","note":"","ucode":"7576140A634BB2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583689,"discussion_content":"如何反击？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660294672,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":160704,"ip_address":"广东"},"score":583689,"extra":""}]}]},{"had_liked":false,"id":53227,"user_name":"Enterprize","can_delete":false,"product_type":"c1","uid":1215130,"ip_address":"","ucode":"3C120E9023B6C5","user_header":"https://static001.geekbang.org/account/avatar/00/12/8a/9a/7270d764.jpg","comment_is_top":false,"comment_ctime":1545617450,"is_pvip":false,"replies":[{"id":"19284","content":"字符串都选Utf8mb4 好了","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545622968,"ip_address":"","comment_id":53227,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23020453930","product_id":100020801,"comment_content":"再选字符集和排序集上有什么最佳实践么","like_count":5,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434073,"discussion_content":"字符串都选Utf8mb4 好了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545622968,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58065,"user_name":"运斤成风","can_delete":false,"product_type":"c1","uid":1350812,"ip_address":"","ucode":"BAFF69C29FDFA5","user_header":"https://static001.geekbang.org/account/avatar/00/14/9c/9c/e02a0daf.jpg","comment_is_top":false,"comment_ctime":1546988947,"is_pvip":false,"replies":[{"id":"21120","content":"没有。。","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547119059,"ip_address":"","comment_id":58065,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18726858131","product_id":100020801,"comment_content":"老师好，用explain工具能看到索引是否被用，而无法看到索引为什么没有被用，比如优化内部做了隐藏转换导致索引无法使用。我的问题是有没有工具能看到这一步的具体转换？谢谢","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435887,"discussion_content":"没有。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547119059,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55130,"user_name":"sky","can_delete":false,"product_type":"c1","uid":1008071,"ip_address":"","ucode":"9FE5F43055D3AB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/61/c7/b64ac05e.jpg","comment_is_top":false,"comment_ctime":1546049707,"is_pvip":false,"replies":[{"id":"19999","content":"咱们这个例子里是假定数据其实是没差别的😓","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1546051397,"ip_address":"","comment_id":55130,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18725918891","product_id":100020801,"comment_content":"字符集 utf8mb4 是 utf8 的超集，所以当这两个类型的字符相互转换的时候，小的转大的精度不会丢失，大的转小的再比较不会有问题么， 就像long 转int 的时候会截断","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434681,"discussion_content":"咱们这个例子里是假定数据其实是没差别的😓","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546051397,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53615,"user_name":"大坤","can_delete":false,"product_type":"c1","uid":1246962,"ip_address":"","ucode":"48CA8F926F134F","user_header":"https://static001.geekbang.org/account/avatar/00/13/06/f2/1f511b7f.jpg","comment_is_top":false,"comment_ctime":1545700730,"is_pvip":false,"replies":[{"id":"19476","content":"总体来说就是判断哪种方式消耗更小，选哪种<br>","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545702079,"ip_address":"","comment_id":53615,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18725569914","product_id":100020801,"comment_content":"之前遇到过按时间范围查询大表不走索引的情况，如果缩小时间范围，又会走索引，记得在一些文章中看到过结果数据超过全表的30%就会走全表扫描，但是前面说的时间范围查询大表，这个时间范围绝对是小于30%的情况，想请教下老师，这个优化器都是在什么情况下会放弃索引呢？","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434207,"discussion_content":"总体来说就是判断哪种方式消耗更小，选哪种\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545702079,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53150,"user_name":"约书亚","can_delete":false,"product_type":"c1","uid":1046714,"ip_address":"","ucode":"81EA27ADD9EC1A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","comment_is_top":false,"comment_ctime":1545612280,"is_pvip":false,"replies":[{"id":"19312","content":"可以简单看where之后剩下的行数（预判不一定准哈）<br>","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545639466,"ip_address":"","comment_id":53150,"utype":1}],"discussion_count":2,"race_medal":0,"score":"18725481464","product_id":100020801,"comment_content":"谁是驱动表谁是被驱动表，是否大多数情况看where条件就可以了？这是否本质上涉及到mysql底层决定用什么算法进行级联查询的问题？后面会有课程详细说明嘛？<br>","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434048,"discussion_content":"可以简单看where之后剩下的行数（预判不一定准哈）\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545639466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2344609,"avatar":"https://static001.geekbang.org/account/avatar/00/23/c6/a1/3bdcde91.jpg","nickname":"向陽花开花向陽🌸","note":"","ucode":"9FDD01BE0E42CD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375336,"discussion_content":"选择哪个表作为驱动表，优化器会自动判断，小表驱动大表。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621582445,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53595,"user_name":"果然如此","can_delete":false,"product_type":"c1","uid":1210003,"ip_address":"","ucode":"C7543BD0A67505","user_header":"https://static001.geekbang.org/account/avatar/00/12/76/93/c78a132a.jpg","comment_is_top":false,"comment_ctime":1545699261,"is_pvip":false,"replies":[{"id":"19480","content":"内存里准备个set这样的数据结构，重读的不算，这样可以不😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545702670,"ip_address":"","comment_id":53595,"utype":1}],"discussion_count":4,"race_medal":0,"score":"14430601149","product_id":100020801,"comment_content":"我想问一个上期的问题，随机算法2虽然效率高，但是还是有个瑕疵，比如我们的随机出题算法无法直接应用，因为每次随机一个试题id，多次随机没有关联，会产生重复id，有没有更好的解决方法？","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434195,"discussion_content":"内存里准备个set这样的数据结构，重读的不算，这样可以不😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545702670,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1667987,"avatar":"https://static001.geekbang.org/account/avatar/00/19/73/93/0a3a1e5b.jpg","nickname":"Ryan","note":"","ucode":"95BBBEE5B23878","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":216602,"discussion_content":"那就用redis的set数据类型了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585469281,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1810051,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK0uyg1IicbEhLwsgM2A2ROoyVdWdmUqZfQfs6G67w9m3hdRNBMOQJatQoACj3qNGgj2KVIgricaYiaQ/132","nickname":"木得感情的编码机器","note":"","ucode":"9C6CD47ADCB8E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":185114,"discussion_content":"真的建议上redis","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582596130,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":160710,"discussion_content":"如果题多的话，这种概率应该不高吧。如果就上百道，那是应该考虑老师的方法。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580824578,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53514,"user_name":"长杰","can_delete":false,"product_type":"c1","uid":1312212,"ip_address":"","ucode":"DD52C9494005F7","user_header":"https://static001.geekbang.org/account/avatar/00/14/05/d4/e06bf86d.jpg","comment_is_top":false,"comment_ctime":1545661372,"is_pvip":false,"replies":[{"id":"19489","content":"你说的对👍🏿，我改下","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545703289,"ip_address":"","comment_id":53514,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14430563260","product_id":100020801,"comment_content":"这里我给出一种方法，取 Y1、Y2 和 Y3 里面最大的一个数，记为 M，最小的一个数记为 N，然后执行下面这条 SQL 语句：<br><br>mysql&gt; select * from t limit N, M-N+1;<br>再加上取整个表总行数的 C 行，这个方案的扫描行数总共只需要 C+M 行。<br>优化后的方案应该是C+M+1行吧？","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434164,"discussion_content":"你说的对👍🏿，我改下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545703289,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53332,"user_name":"mz","can_delete":false,"product_type":"c1","uid":1003581,"ip_address":"","ucode":"1D714C23F78446","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/MlmSR4YXUfrNlZdMv7bv1ic64HaxxVKcVtaxjzhXCvNC4XByICCmYUTprhOESzIV8p59N6DnSJ7HywfvGr5nicgA/132","comment_is_top":false,"comment_ctime":1545627565,"is_pvip":false,"replies":[{"id":"19308","content":"😄👍🏿","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545639275,"ip_address":"","comment_id":53332,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14430529453","product_id":100020801,"comment_content":"吓得我赶紧去检查一下有没有索引是字符串参数是整型的 SQL","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434100,"discussion_content":"😄👍🏿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545639275,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":343984,"user_name":"程序员阿杜","can_delete":false,"product_type":"c1","uid":2717502,"ip_address":"","ucode":"701F330435A784","user_header":"https://static001.geekbang.org/account/avatar/00/29/77/3e/d89c0fff.jpg","comment_is_top":false,"comment_ctime":1651153991,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10241088583","product_id":100020801,"comment_content":"索引失效的场景顺口溜：<br><br>&#39;模型数空运最快&#39;<br><br>模：模糊查询like以&#39;%&#39;开头<br>型：数据类型错误 比如索引是int 条件用char<br>数：对索引字段使用内部函数<br>空：索引字段为NULL<br>运：索引进行四则运算<br>最：查询条件不满足最左前缀法制<br>快：数据引擎预警 全表扫描比走索引快","like_count":2},{"had_liked":false,"id":185748,"user_name":"乔丹","can_delete":false,"product_type":"c1","uid":1217413,"ip_address":"","ucode":"D832A9F97A0C7E","user_header":"https://static001.geekbang.org/account/avatar/00/12/93/85/f5d9474c.jpg","comment_is_top":false,"comment_ctime":1583674144,"is_pvip":false,"replies":[{"id":"71800","content":"看你select的是什么<br><br>如果是select * 就是<br><br>如果是select字段a，而字段a本身有索引，会选择a这个索引，因为这棵树小","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1583715475,"ip_address":"","comment_id":185748,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10173608736","product_id":100020801,"comment_content":"老师，做全表扫描，怎么不是用primary key做索引扫描呢？","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486484,"discussion_content":"看你select的是什么\n\n如果是select * 就是\n\n如果是select字段a，而字段a本身有索引，会选择a这个索引，因为这棵树小","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583715475,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1217413,"avatar":"https://static001.geekbang.org/account/avatar/00/12/93/85/f5d9474c.jpg","nickname":"乔丹","note":"","ucode":"D832A9F97A0C7E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":200996,"discussion_content":"谢谢老师的耐心解答。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583750479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":75936,"user_name":"唯她命","can_delete":false,"product_type":"c1","uid":1240398,"ip_address":"","ucode":"8F687E8D306840","user_header":"https://static001.geekbang.org/account/avatar/00/12/ed/4e/ef406442.jpg","comment_is_top":false,"comment_ctime":1552494012,"is_pvip":false,"replies":[{"id":"28921","content":"是的<br><br>前提是l.tradeid 没有utf8mb4的哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1553420566,"ip_address":"","comment_id":75936,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10142428604","product_id":100020801,"comment_content":"优化方案 CONVERT(l.tradeid USING utf8)   会丢精度吧？","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443097,"discussion_content":"是的\n\n前提是l.tradeid 没有utf8mb4的哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553420566,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68465,"user_name":"刘十一","can_delete":false,"product_type":"c1","uid":1035899,"ip_address":"","ucode":"5927D77D248E30","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ce/7b/fa0f9368.jpg","comment_is_top":false,"comment_ctime":1550503855,"is_pvip":false,"replies":[{"id":"24998","content":"1. 就是优化器认为where id + 1 算是函数操作；<br>2. 就是说如果一个语句是 where id= fun_1(10); 这样还是可以用上索引的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1550999831,"ip_address":"","comment_id":68465,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10140438447","product_id":100020801,"comment_content":"老师我有2个问题：<br>1.案例一最后您提到：select * from tradelog where id + 1 = 10000 为什么说改成这个where id = 10000 -1就可以走索引快速定位到了？<br>2.有个同学留言：“索引字段不能进行函数操作，但是索引字段的参数可以玩函数，一言以蔽之”您回答精辟，前面一句能够理解，后面这句【但是索引字段的参数可以玩函数】不是很理解，方便举个例子吗？<br>老师能翻我牌吗？","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439689,"discussion_content":"1. 就是优化器认为where id + 1 算是函数操作；\n2. 就是说如果一个语句是 where id= fun_1(10); 这样还是可以用上索引的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550999831,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62189,"user_name":"杰之7","can_delete":false,"product_type":"c1","uid":1297232,"ip_address":"","ucode":"F7DA2E21085332","user_header":"https://static001.geekbang.org/account/avatar/00/13/cb/50/66d0bd7f.jpg","comment_is_top":false,"comment_ctime":1547973591,"is_pvip":false,"replies":[{"id":"22010","content":"👍<br><br>中间有任何问题都提出来，<br>平时自己找个MySQL，跟着验证例子","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547990079,"ip_address":"","comment_id":62189,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10137908183","product_id":100020801,"comment_content":"通过这一节的学习，理解了即使逻辑相同的查询语句，在不知道数据库里面的运行机制时，性能差异会非常明显。<br><br>老师通过三个案例都是在说明同一件事，在使用索性字段做函数操作时，函数会破坏索引值的有序性，导致做全表扫描而让性能降低。<br><br>在后面的两个案例中，隐式类型转换中，字符串和数字做比较是将字符串转化成数字，所以在Select * from tradelog where tradeid=110717中，对字符串做了CAST函数操作。在隐式字符编码转换中，两个表存在字符集的不同，Convert函数将utf8转换成utf8mb4。<br><br>老师，我目前没有回答您的课后思考，您的文章难度对于我这种还没有接触过计算机专业和数据库工作的同学来有一定的难度，我先跟着您学习完整个专栏的内容，之后复习时有一点数据库底子后会思考并回复每一篇的问答题。<br>","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437130,"discussion_content":"👍\n\n中间有任何问题都提出来，\n平时自己找个MySQL，跟着验证例子","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547990079,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53331,"user_name":"南山","can_delete":false,"product_type":"c1","uid":1119593,"ip_address":"","ucode":"94656FE4A6C378","user_header":"https://static001.geekbang.org/account/avatar/00/11/15/69/187b9968.jpg","comment_is_top":false,"comment_ctime":1545627083,"is_pvip":true,"replies":[{"id":"19309","content":"也一样呀，<br>驱动表一行，被驱动表查询；<br>然后循环","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545639318,"ip_address":"","comment_id":53331,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10135561675","product_id":100020801,"comment_content":"老师，多表join如何计算他的总扫描行呢？如果这种情况有没有优化的思路啊？","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434099,"discussion_content":"也一样呀，\n驱动表一行，被驱动表查询；\n然后循环","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545639318,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53191,"user_name":"沙漠里的骆驼","can_delete":false,"product_type":"c1","uid":1012559,"ip_address":"","ucode":"5EC18A71B3A594","user_header":"https://static001.geekbang.org/account/avatar/00/0f/73/4f/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1545614654,"is_pvip":true,"replies":[{"id":"19264","content":"对，好例子","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545616008,"ip_address":"","comment_id":53191,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10135549246","product_id":100020801,"comment_content":"参数一样，但结果数据集不一样；<br>比如一个字段有索引(非唯一)，满足条件的只有几条，和有几万条甚至几十万条，执行后性能差异会比较大；这也是非常不可控的。","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434059,"discussion_content":"对，好例子","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545616008,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53103,"user_name":"Justin","can_delete":false,"product_type":"c1","uid":1305601,"ip_address":"","ucode":"D49723FEA66731","user_header":"https://static001.geekbang.org/account/avatar/00/13/ec/01/978d54af.jpg","comment_is_top":false,"comment_ctime":1545585086,"is_pvip":false,"replies":[{"id":"19268","content":"对的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545616369,"ip_address":"","comment_id":53103,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10135519678","product_id":100020801,"comment_content":"现在，我留给你一个小问题，id 的类型是 int，如果执行下面这个语句，是否会导致全表扫描呢？ <br>回答文中问题 我觉得不会 因为string类型是在参数侧，即使被cast 成 int 也会走索引的 不知理解的对不对？","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434033,"discussion_content":"对的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545616369,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":294795,"user_name":"李二木","can_delete":false,"product_type":"c1","uid":1103091,"ip_address":"","ucode":"30E03BB84ADB27","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/f3/129d6dfe.jpg","comment_is_top":false,"comment_ctime":1622094706,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5917062002","product_id":100020801,"comment_content":"一句话：对索引字段做函数操作，可能会破坏索引值的有序性，因此优化器就决定放弃走树搜索功能","like_count":1},{"had_liked":false,"id":203570,"user_name":"纸飞机","can_delete":false,"product_type":"c1","uid":1108954,"ip_address":"","ucode":"E83EB9A453ACE2","user_header":"https://static001.geekbang.org/account/avatar/00/10/eb/da/09feef5a.jpg","comment_is_top":false,"comment_ctime":1586234993,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5881202289","product_id":100020801,"comment_content":"能请教您一个问题吗。 对索引字段进行函数操作会破坏索引的有序性从而使用不了索引的树搜索功能。mysql在数字与字符串类型比较的时候，会自动把字符串转换为数字。 但是mysql的文档中写着字符串和数字比较的时候 会转换成浮点数比较。 这是不是相矛盾了？<br><br><br>In all other cases, the arguments are compared as floating-point (real) numbers. For example, a comparison of string and numeric operands takes places as a comparison of floating-point numbers.<br>那么即使索引是数字类型， 参数是字符串类型  两个都得先转换为浮点数。 这样岂不是也对索引字段做了函数操作吗？<br>","like_count":1},{"had_liked":false,"id":187255,"user_name":"蛋炒饭加鸡蛋","can_delete":false,"product_type":"c1","uid":1628398,"ip_address":"","ucode":"C75E27B9FB3336","user_header":"https://static001.geekbang.org/account/avatar/00/18/d8/ee/17f220b6.jpg","comment_is_top":false,"comment_ctime":1584069913,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5879037209","product_id":100020801,"comment_content":"老师，全索引扫描和全表扫描的区别是什么呢，是扫描二级索引和主键索引的区别吗？","like_count":1,"discussions":[{"author":{"id":2146530,"avatar":"https://static001.geekbang.org/account/avatar/00/20/c0/e2/b45e4c91.jpg","nickname":"王飞","note":"","ucode":"6AB74544EE1364","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391908,"discussion_content":"是的，就是主键和二级树搜索的区别，主键索引一般里面存有数据，所以比较大，二级索引小一些，扫描起来更快，所以如果能选择二级索引，mysql肯定有优先选择二级索引","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630683959,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1451509,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/P5EIPG3R01lW2MG1HfcPUDLKajMy7BGg8rKn5dKDbdrCreIwabwJ1RqWOJMVKqAusLaf7Y0Utomibp6ibxajflvQ/132","nickname":"我要放大🐂","note":"","ucode":"B280A95E02E7C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288660,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593834036,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":145571,"user_name":"helloworld","can_delete":false,"product_type":"c1","uid":1015754,"ip_address":"","ucode":"00DF2FEC58D2E6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","comment_is_top":false,"comment_ctime":1572317858,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5867285154","product_id":100020801,"comment_content":"如果我所学习的所有的技术都能有这么通俗易懂的解释的话，该多好，给老师点赞！","like_count":1},{"had_liked":false,"id":123002,"user_name":"遇见阳光","can_delete":false,"product_type":"c1","uid":1203576,"ip_address":"","ucode":"378E5D37B3CD0E","user_header":"https://static001.geekbang.org/account/avatar/00/12/5d/78/f011d586.jpg","comment_is_top":false,"comment_ctime":1565586076,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5860553372","product_id":100020801,"comment_content":"Datetime长度不是8个字节吗，为何索引长度显示6","like_count":1},{"had_liked":false,"id":67241,"user_name":"念你如昔","can_delete":false,"product_type":"c1","uid":1323531,"ip_address":"","ucode":"FCAD88AB57D084","user_header":"https://static001.geekbang.org/account/avatar/00/14/32/0b/981b4e93.jpg","comment_is_top":false,"comment_ctime":1550114444,"is_pvip":false,"replies":[{"id":"23799","content":"如果用不上覆盖索引，确实可能直接走全表扫描","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1550127431,"ip_address":"","comment_id":67241,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5845081740","product_id":100020801,"comment_content":"隐式类型转换和隐式字符编码转换 没有 全索引扫描啊，我看执行计划 的key为null。","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439109,"discussion_content":"如果用不上覆盖索引，确实可能直接走全表扫描","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550127431,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61144,"user_name":"zhxleon","can_delete":false,"product_type":"c1","uid":1309140,"ip_address":"","ucode":"4ADCCEBC6B0FB6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJoyqXrhQS7Chvj4yNxUlZ1Ltribiat2uQMiabQURjwA9KQojKicjjQOdJDZ85VwaI5t4LrOHOHjOLRgw/132","comment_is_top":false,"comment_ctime":1547627041,"is_pvip":false,"replies":[{"id":"21777","content":"好问题👍<br><br>ifnull(id,0) 就是在字段上加函数哦，等于其实就是放弃了这个字段。<br><br>这种方法强行走索引，就会触发排序。<br><br>你要看一下这个 “解决”是不是真的提升了速度，（也是有可能的）。<br><br>至于原理的话，就是因为order by ifnull(id,0) ，不论使用什么索引，都会排序。(改成order by id-0是一样的）<br><br>但是这么写，还不如直接用force index()来得直接和好理解哈。<br><br>这个原理跟我们在第10篇文章，图10的那个优化是同一个原理的。","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547633318,"ip_address":"","comment_id":61144,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5842594337","product_id":100020801,"comment_content":"之前一直忙，今天才看到这篇文章，希望老师能给解释一下order by xxx + limit 有时候不走索引的问题<br>解决办法就是用ifnull函数，比如order by ifnull(id,0) desc  limit 0,500 这样就可以确保走索引<br>虽然知道如何解决，但是一直搞不清为什么有时候就是不走索引","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436759,"discussion_content":"好问题👍\n\nifnull(id,0) 就是在字段上加函数哦，等于其实就是放弃了这个字段。\n\n这种方法强行走索引，就会触发排序。\n\n你要看一下这个 “解决”是不是真的提升了速度，（也是有可能的）。\n\n至于原理的话，就是因为order by ifnull(id,0) ，不论使用什么索引，都会排序。(改成order by id-0是一样的）\n\n但是这么写，还不如直接用force index()来得直接和好理解哈。\n\n这个原理跟我们在第10篇文章，图10的那个优化是同一个原理的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547633318,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53570,"user_name":"heat nan","can_delete":false,"product_type":"c1","uid":1153826,"ip_address":"","ucode":"52D5CB17CE80E5","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/22/dd04892a.jpg","comment_is_top":false,"comment_ctime":1545696178,"is_pvip":false,"replies":[{"id":"19484","content":"咱们这个只是举例哈😄<br><br>为啥不能在循环内执行SQL，直接这么一刀切是不对的，还是要听听有什么具体原因？","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545702875,"ip_address":"","comment_id":53570,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5840663474","product_id":100020801,"comment_content":"咨询老师一个问题，有第一个栗子引出来了的。当月份比较多的话，写出来的sql岂不是很抓狂，很长。一般情况会有每月的统计表吧!如果没有可以通过变量来标记月份，程序拼接sql查询，但这个时候查询过多月份可能使用到循环内执行sql，一些观点指出不应在循环内执行sql，请问这种说法是否有道理？","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434186,"discussion_content":"咱们这个只是举例哈😄\n\n为啥不能在循环内执行SQL，直接这么一刀切是不对的，还是要听听有什么具体原因？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545702875,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1336951,"avatar":"https://static001.geekbang.org/account/avatar/00/14/66/77/194ba21d.jpg","nickname":"lzh","note":"","ucode":"C3D83DF4230109","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6258,"discussion_content":"循环内执行sql可能考虑的是N+1查询吧...N+1查询确实是应该避免的,可以用In代替...但不是sql一定不要在循环内执行","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566814557,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53490,"user_name":"王金龙","can_delete":false,"product_type":"c1","uid":1106058,"ip_address":"","ucode":"E1BD8BC7CB426B","user_header":"https://static001.geekbang.org/account/avatar/00/10/e0/8a/38118387.jpg","comment_is_top":false,"comment_ctime":1545656358,"is_pvip":true,"replies":[{"id":"19391","content":"Crc加在参数值上的，不是加在字段上的","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545661639,"ip_address":"","comment_id":53490,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5840623654","product_id":100020801,"comment_content":"在11节中怎么给字段加索引中您提到crc函数用了计算函数能用到索引，在这一节中，您又提到如果对字段做了函数计算，就用不上索引了，这是 MySQL 的规定。为什么crc函数能用到索引，有点不太明白？","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434155,"discussion_content":"Crc加在参数值上的，不是加在字段上的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545661639,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53246,"user_name":"MixxxWang","can_delete":false,"product_type":"c1","uid":1004741,"ip_address":"","ucode":"91350E1758526F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/c5/d3c08f11.jpg","comment_is_top":false,"comment_ctime":1545619047,"is_pvip":false,"replies":[{"id":"19310","content":"核心还是判断代价，<br><br>这个得从join的算法说起😓 这边写不下，我看看安排到后面的文章中","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545639387,"ip_address":"","comment_id":53246,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5840586343","product_id":100020801,"comment_content":"老师，我是微博上问你的童鞋。多表连接时，mysql是怎么选择驱动表和被驱动表的？","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434079,"discussion_content":"核心还是判断代价，\n\n这个得从join的算法说起😓 这边写不下，我看看安排到后面的文章中","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545639387,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":357206,"user_name":"木偶小玩家","can_delete":false,"product_type":"c1","uid":1632895,"ip_address":"湖北","ucode":"809685E45F1FA2","user_header":"https://static001.geekbang.org/account/avatar/00/18/ea/7f/6e984ca8.jpg","comment_is_top":false,"comment_ctime":1663061806,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1663061806","product_id":100020801,"comment_content":"通过字符编码转换来显示的编码，问题是这样的。select d.* from tradelog l , trade_detail d where d.tradeid=CONVERT(l.tradeid USING utf8) and l.id=2; <br>使用explain type 是 ref 可以用到索引。然而我把语句改成  select d.* from tradelog l,trade_detail d WHERE l.tradeid  = CONVERT(d.tradeid USING utf8mb4) and l.id=2。<br>type 就是 all了。按字面理解应该是可以，然而实际就不行了，我猜测应该是和字符编码有关，字符编码从大的转小的可以，小的转到大的就不行，不清楚是什么原因？<br>","like_count":0},{"had_liked":false,"id":345714,"user_name":"whyly","can_delete":false,"product_type":"c1","uid":1798882,"ip_address":"","ucode":"D34D6B7164C982","user_header":"https://static001.geekbang.org/account/avatar/00/1b/72/e2/95b0543c.jpg","comment_is_top":false,"comment_ctime":1652521438,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652521438","product_id":100020801,"comment_content":"老师有没有进行了函数操作，不会破坏索引有序性的例子呢？","like_count":0},{"had_liked":false,"id":342590,"user_name":"亚林","can_delete":false,"product_type":"c1","uid":1018972,"ip_address":"","ucode":"4A5A6D24314B79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8c/5c/3f164f66.jpg","comment_is_top":false,"comment_ctime":1650357007,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1650357007","product_id":100020801,"comment_content":"MySQL8好像把案例二问题修了","like_count":0},{"had_liked":false,"id":342589,"user_name":"亚林","can_delete":false,"product_type":"c1","uid":1018972,"ip_address":"","ucode":"4A5A6D24314B79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8c/5c/3f164f66.jpg","comment_is_top":false,"comment_ctime":1650356953,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1650356953","product_id":100020801,"comment_content":"将left join改成了inner join，因为当时左表巨大，inner后行数变少，然后进行业务操作变快了。","like_count":0},{"had_liked":false,"id":342185,"user_name":"再见理想","can_delete":false,"product_type":"c1","uid":1245999,"ip_address":"","ucode":"FAC88B3F6F6DFD","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/2f/0a5e0751.jpg","comment_is_top":false,"comment_ctime":1650091397,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1650091397","product_id":100020801,"comment_content":"引起索引失效的几个原因<br>1.对查询字段进行函数操作<br>2.查询字段隐式类型转换<br>3.查询字符串的字符编码转换<br>","like_count":0},{"had_liked":false,"id":336768,"user_name":"弋延","can_delete":false,"product_type":"c1","uid":2708966,"ip_address":"","ucode":"D04AAEDF8C658A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epRo9GU1yic8fZwJp2ia9qq0RL7nCvDcosxwwIMZxSHtxjh4aLezyuvYdzgsEY2cib9ibSJNIqb8gFqHw/132","comment_is_top":false,"comment_ctime":1646360277,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646360277","product_id":100020801,"comment_content":"当sql中的函数、隐式类型转化，隐式编码转化作用于DB中的数据而不是入参时，因为需要将db的数据都进行一次转化处理，才能跟入参比较，导致每次的查询条件出现无序性，因此无法使用索引的树进行搜索。","like_count":0},{"had_liked":false,"id":336102,"user_name":"。。","can_delete":false,"product_type":"c1","uid":2853618,"ip_address":"","ucode":"A52A6043D27D87","user_header":"https://static001.geekbang.org/account/avatar/00/2b/8a/f2/6c6f7886.jpg","comment_is_top":false,"comment_ctime":1645929414,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1645929414","product_id":100020801,"comment_content":"老师，我有个疑惑是如果要满足业务需求，非要在索引字段上加函数，这个怎么解决呢，改写 SQL 吗？之前遇到过这么一个 SQL：select * from t where length(a) = 2。a 字段是 varchar类型，想了半天不知道这个SQL怎么改写。。","like_count":0,"discussions":[{"author":{"id":2268210,"avatar":"https://static001.geekbang.org/account/avatar/00/22/9c/32/d7a8c3ad.jpg","nickname":"joeson","note":"","ucode":"0E1BF0916A1944","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579477,"discussion_content":"表加字段len_a存长度","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657469505,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":330916,"user_name":"idiot","can_delete":false,"product_type":"c1","uid":2526391,"ip_address":"","ucode":"D7A6E980B530B4","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/fcftgBsticCicEEkuzB0GTkHIocX62YVTSvnhR1c94sccj42lVaYXrmcZyhzUI3l9NcvuN1rXLhXt2eBrZZ0Tw7A/132","comment_is_top":false,"comment_ctime":1642296300,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1642296300","product_id":100020801,"comment_content":"笔记：用了索引不一定就快了，也可能是全索引扫描。","like_count":0},{"had_liked":false,"id":327233,"user_name":"Geek_8c2d52","can_delete":false,"product_type":"c1","uid":2208756,"ip_address":"","ucode":"49CEF85C68C16D","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/PQ7ibjt61nV1WbUbwEHqCKkvt5WMXibKjvhDhedhFSz6L1dxMSxpYYIL4kM0cqe6cwz9fTALueyYbUKNkibXX2pZw/132","comment_is_top":false,"comment_ctime":1639993234,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1639993234","product_id":100020801,"comment_content":"小白求问：案例二为什么会走覆盖索引呢","like_count":0},{"had_liked":false,"id":326853,"user_name":"键盘上的魔术","can_delete":false,"product_type":"c1","uid":2697700,"ip_address":"","ucode":"A731D721FB8D3A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/LFJZ4x47rvShGhsePLIxc8EzdlBxAmVAIjJ2FQZ4NEpo8E4JCZQEOb2NIfOuiaQLL6Otkt7W3Rmu6Tv3AkgYdRA/132","comment_is_top":false,"comment_ctime":1639722065,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1639722065","product_id":100020801,"comment_content":"老师写的案例1的解决方案<br>mysql&gt; select count(*) from tradelog where<br>    -&gt; (t_modified &gt;= &#39;2016-7-1&#39; and t_modified&lt;&#39;2016-8-1&#39;) or<br>    -&gt; (t_modified &gt;= &#39;2017-7-1&#39; and t_modified&lt;&#39;2017-8-1&#39;) or <br>    -&gt; (t_modified &gt;= &#39;2018-7-1&#39; and t_modified&lt;&#39;2018-8-1&#39;);<br><br>其实也有类型转换，t_modified是datetime，而&#39;2016-7-1&#39;是字符串<br>datetime和字符串比较，是字符串转成datetime去比较。而不是datetime转成字符串去比较。<br>如果是datetime转字符串比较的话，这里也会存在索引字段使用函数从而导致不走索引树了吧","like_count":0},{"had_liked":false,"id":326656,"user_name":"🐻","can_delete":false,"product_type":"c1","uid":1043072,"ip_address":"","ucode":"534EDAD496A0E6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ea/80/8759e4c1.jpg","comment_is_top":false,"comment_ctime":1639619376,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1639619376","product_id":100020801,"comment_content":"不知道2021年了，老师是否还会回复。<br><br>我们公司的 dba 规范写着，如果一个 varchar 字段预期只会使用 ascii 的可打印字符，那么使用 latin1 字符集。<br><br>这样导致的结果是，不仅表和表之间字符集不同，同一个表内的不同字段也会有不同的字符集。<br><br>原因是 latin1 相比 utf8mb4 ，它占用的空间小。表和索引都会使用更少的空间，能够节省内存。<br><br>请问一下老师，<br><br>1. utf8mb4 建立的索引真的比 latin1 索引占用的空间大吗？有具体数据么，10万行长度在100以内的字符串，索引预计会大多少？<br>2. 这是一种好的规范么，和省内存相比，感觉字符集隐式转换的坑带来了更多的开发成本。","like_count":0},{"had_liked":false,"id":324678,"user_name":"cake","can_delete":false,"product_type":"c1","uid":1966533,"ip_address":"","ucode":"55A7FC6CC1204C","user_header":"https://static001.geekbang.org/account/avatar/00/1e/01/c5/b48d25da.jpg","comment_is_top":false,"comment_ctime":1638539831,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638539831","product_id":100020801,"comment_content":"如果能够修改字段的字符集的话，是最好不过了。但如果数据量比较大， 或者业务上暂时不能做这个 DDL 的话，那就只能采用修改 SQL 语句的方法了   老师我觉得你这句话有点问题，你说业务暂时不允许DDL，使用修改SQL的方式，但是你没用查询重写的方式，SQL会生效吗？","like_count":0},{"had_liked":false,"id":322860,"user_name":"艾尔文","can_delete":false,"product_type":"c1","uid":2526014,"ip_address":"","ucode":"E87C0957619A94","user_header":"https://static001.geekbang.org/account/avatar/00/26/8b/3e/3d77e020.jpg","comment_is_top":false,"comment_ctime":1637635881,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1637635881","product_id":100020801,"comment_content":"老师，您好，在第一个案例中，select count(*) from tradelog where year(t_modified)=2016; 这个为什么不能用到索引的最左匹配？","like_count":0,"discussions":[{"author":{"id":1803215,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/83/cf/1f3b5b17.jpg","nickname":"Jaden~お張嘉楽","note":"","ucode":"FA2737D6A1D2C9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556743,"discussion_content":"实际上，B+ 树提供的这个快速定位能力，来源于同一层兄弟节点的有序性。\n但是，如果计算 year() 函数的话，你会看到传入 2016 的时候，在树的第一层就不知道该怎么办了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647496337,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":319617,"user_name":"上海","can_delete":false,"product_type":"c1","uid":2678569,"ip_address":"","ucode":"6A4F9D80D25028","user_header":"https://static001.geekbang.org/account/avatar/00/28/df/29/3c956177.jpg","comment_is_top":false,"comment_ctime":1635865469,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635865469","product_id":100020801,"comment_content":"感觉改过的这一版好多内容看起来特别吃力，一方面我感觉是作者的文字表达没有以前那么清楚了","like_count":0},{"had_liked":false,"id":312707,"user_name":"prader26","can_delete":false,"product_type":"c1","uid":1433707,"ip_address":"","ucode":"5EFFFC374ADECE","user_header":"https://static001.geekbang.org/account/avatar/00/15/e0/6b/f61d7466.jpg","comment_is_top":false,"comment_ctime":1631947716,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631947716","product_id":100020801,"comment_content":"<br><br><br>1 对mysql中的表的索引字段做函数操作，会导致索引失效，mysql 查询时，走全表扫描。<br>2 mysql 中字符串和数字进行比较，会把字符串转化成数字。<br>3 不同的表在根据索引进行join 查询的时候，如果这两张表的字符集不同，会导致索引失效。","like_count":0},{"had_liked":false,"id":310182,"user_name":"louis","can_delete":false,"product_type":"c1","uid":2416570,"ip_address":"","ucode":"4923669B2F0748","user_header":"https://static001.geekbang.org/account/avatar/00/24/df/ba/4b9d2569.jpg","comment_is_top":false,"comment_ctime":1630537669,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630537669","product_id":100020801,"comment_content":"老师，是所有函数都会影响索引的顺序吗？","like_count":0},{"had_liked":false,"id":308426,"user_name":"张冉","can_delete":false,"product_type":"c1","uid":2716412,"ip_address":"","ucode":"E8E9666D09CF72","user_header":"https://static001.geekbang.org/account/avatar/00/29/72/fc/0c465fe9.jpg","comment_is_top":false,"comment_ctime":1629617504,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629617504","product_id":100020801,"comment_content":"字符集导致不走索引的情况刚遇到，当时大家都没有注意字符集不同，以为数据倾斜，各种分析。","like_count":0},{"had_liked":false,"id":303609,"user_name":"月月飞","can_delete":false,"product_type":"c1","uid":1120265,"ip_address":"","ucode":"1974D44B0D63CC","user_header":"https://static001.geekbang.org/account/avatar/00/11/18/09/ab1758bb.jpg","comment_is_top":false,"comment_ctime":1626872554,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1626872554","product_id":100020801,"comment_content":"老师，date类型输入字符串会做转换吗","like_count":0},{"had_liked":false,"id":298935,"user_name":"Hero","can_delete":false,"product_type":"c1","uid":1321726,"ip_address":"","ucode":"33D7939CC3C815","user_header":"https://static001.geekbang.org/account/avatar/00/14/2a/fe/197449a0.jpg","comment_is_top":false,"comment_ctime":1624381931,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1624381931","product_id":100020801,"comment_content":"隐式类型转换问题深深的猜过坑，有一张表每天至少300万数据量，有一个进程专门去扫这张表的未处理数据，在数据量在一千万量级的时候没感觉到影响，但是在数据量在两千万左右就处理不动了，问题定位了一条，最后发现就是类型转换到问题，没用上索引。导致每执行一次都会全表扫描。现在写sql都会 explian 一下看一下执行计划。","like_count":0},{"had_liked":false,"id":292754,"user_name":"ub8","can_delete":false,"product_type":"c1","uid":1481811,"ip_address":"","ucode":"0D937C3EAEB781","user_header":"https://static001.geekbang.org/account/avatar/00/16/9c/53/ade0afb0.jpg","comment_is_top":false,"comment_ctime":1620962592,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1620962592","product_id":100020801,"comment_content":"引用-&quot;如果能够修改字段的字符集的话，是最好不过了。但如果[数据量比较大]， 或者业务上暂时不能做这个 DDL 的话，那就只能采用修改 SQL 语句的方法了。&quot; 老师这个”数据量比较大“ 到底是多大？有概念么？","like_count":0},{"had_liked":false,"id":289496,"user_name":"张三丰","can_delete":false,"product_type":"c1","uid":1155275,"ip_address":"","ucode":"3A6215A40B3B21","user_header":"https://static001.geekbang.org/account/avatar/00/11/a0/cb/aab3b3e7.jpg","comment_is_top":false,"comment_ctime":1619054255,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619054255","product_id":100020801,"comment_content":"全表扫描和全索引扫描还是有区别的，老师能否讲讲他们扫描时的底层逻辑是什么？","like_count":0},{"had_liked":false,"id":284900,"user_name":"拉鲁","can_delete":false,"product_type":"c1","uid":1594125,"ip_address":"","ucode":"FBB65945605862","user_header":"https://static001.geekbang.org/account/avatar/00/18/53/0d/c4643e0e.jpg","comment_is_top":false,"comment_ctime":1616515598,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616515598","product_id":100020801,"comment_content":"两个表都是utf8<br>","like_count":0},{"had_liked":false,"id":277508,"user_name":"小白白不白","can_delete":false,"product_type":"c1","uid":1757797,"ip_address":"","ucode":"270EC3A197A8D9","user_header":"https://static001.geekbang.org/account/avatar/00/1a/d2/65/79d89c77.jpg","comment_is_top":false,"comment_ctime":1612436158,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612436158","product_id":100020801,"comment_content":"隐式转换这一步是在分析器完成的吗？","like_count":0},{"had_liked":false,"id":269092,"user_name":"执芳之手","can_delete":false,"product_type":"c1","uid":1436422,"ip_address":"","ucode":"8199F569D6A8F1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLRKgow8PPLLgCqt6ZWiaylrFG1ButvHRSqOZ8hvFZFHoUGaoYCLlasbRiaaM0pTWKeeLbW4xBM4vjg/132","comment_is_top":false,"comment_ctime":1608520938,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608520938","product_id":100020801,"comment_content":"老师，你好。<br>①Mysql扫描行的统计信息，是根据数据页，采样统计的。<br>②Mysql一般判断在查询超过整个表20%的数据时(可能不是20%，我举个例子)，就会考虑使用聚族索引来查找数据，即使有二级索引(因为可能有需要回表等操作)。那这个20%的比率是怎么得出的？","like_count":0},{"had_liked":false,"id":267495,"user_name":"Master","can_delete":false,"product_type":"c1","uid":1613760,"ip_address":"","ucode":"79D0145B853C9E","user_header":"https://static001.geekbang.org/account/avatar/00/18/9f/c0/86febfff.jpg","comment_is_top":false,"comment_ctime":1607769797,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607769797","product_id":100020801,"comment_content":"这里再总结一下，影响了索引字段使用，实际就是对索引字段本身做了函数处理，导致无法使用定位能力，这里关键字是定位能力；至于explain出来的结果，显示发现竟然使用了索引，那仅仅是因为优化器从中做了一个判定，比如索引大小、覆盖索引等等情况，只是以此完成了遍历取数据而已。","like_count":0},{"had_liked":false,"id":257465,"user_name":"丁丁历险记","can_delete":false,"product_type":"c1","uid":1661704,"ip_address":"","ucode":"A43829E454C067","user_header":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","comment_is_top":false,"comment_ctime":1603980323,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603980323","product_id":100020801,"comment_content":"年数不多，直接用程序生成sql 再查。","like_count":0},{"had_liked":false,"id":251872,"user_name":"John","can_delete":false,"product_type":"c1","uid":1228424,"ip_address":"","ucode":"A46AF2906C38C1","user_header":"https://static001.geekbang.org/account/avatar/00/12/be/88/8d15796f.jpg","comment_is_top":false,"comment_ctime":1601943268,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601943268","product_id":100020801,"comment_content":"之前做数据迁移的时候就遇到过连表的时候两张表的连接字段都是 trade_id，加了索引怎么都用不到上，后面就是想到会不会是长度、编码的问题，看了下原来是编码不一致，不过当时也没细想到宽化转换，只是把 utf8 的表改成了 utf8mb4 就可以了。就目前的学习过程看来，长度不一样的话，不会影响到是否走索引树搜索。","like_count":0},{"had_liked":false,"id":251227,"user_name":"慎独明强","can_delete":false,"product_type":"c1","uid":1965699,"ip_address":"","ucode":"DC2F7F2C0C8F60","user_header":"https://static001.geekbang.org/account/avatar/00/1d/fe/83/df562574.jpg","comment_is_top":false,"comment_ctime":1601429915,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601429915","product_id":100020801,"comment_content":"总结下老师说的，字符串转数字不会导致索引失效，数字转字符串会出现隐式类型转换","like_count":0},{"had_liked":false,"id":251068,"user_name":"贺武康","can_delete":false,"product_type":"c1","uid":2129784,"ip_address":"","ucode":"E424A8540FCD13","user_header":"https://static001.geekbang.org/account/avatar/00/20/7f/78/c2f3c511.jpg","comment_is_top":false,"comment_ctime":1601350987,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601350987","product_id":100020801,"comment_content":"对于我们这种mysql稍微有点基础但是又不是很通的 每一个点都能收益 慢慢开始了结合学到的思想去考虑问题 相信自己一定会越来越吊 哈哈哈哈","like_count":0},{"had_liked":false,"id":245967,"user_name":"赵茭茭","can_delete":false,"product_type":"c1","uid":2060978,"ip_address":"","ucode":"502C8A2B10C09B","user_header":"","comment_is_top":false,"comment_ctime":1599122815,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599122815","product_id":100020801,"comment_content":"explain select d.* from tradelog l, trade_detail d where d.tradeid=l.tradeid and l.id=2; <br><br>explain select d.* from tradelog l left join trade_detail d on d.tradeid=l.tradeid where l.id=2;<br><br>咨询一下 这两个语句为什么 用left join的会快一点","like_count":0},{"had_liked":false,"id":243140,"user_name":"lobby","can_delete":false,"product_type":"c1","uid":1181960,"ip_address":"","ucode":"8D81722BE36AD4","user_header":"https://static001.geekbang.org/account/avatar/00/12/09/08/f3547e77.jpg","comment_is_top":false,"comment_ctime":1597974858,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597974858","product_id":100020801,"comment_content":"看到这里之后，慢慢理解了公司的建表规范，自增id的作用，还是要多学习才行","like_count":0},{"had_liked":false,"id":241365,"user_name":"Geek_34da94","can_delete":false,"product_type":"c1","uid":1739267,"ip_address":"","ucode":"6431CF45D80FE7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/fKdnfLia75cdWrMCIiaoSfLKcjMJYyGN769hSd492L0gUlIf0vwHciaia9YQwIfJDyDkHL59HcYEJSfxQ8PpeDDkibQ/132","comment_is_top":false,"comment_ctime":1597280364,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597280364","product_id":100020801,"comment_content":"感觉是SQL语句导致需要对索引字段进行转换，然后才能和输入量比较","like_count":0},{"had_liked":false,"id":238347,"user_name":"jjyyun","can_delete":false,"product_type":"c1","uid":1592576,"ip_address":"","ucode":"8824654F673087","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLIzE6JOuXsOamCWiaq8sHHVyCK44bdIOEqnE42veoZPEqxs5IJ8RT1Hicz0ZlPQFcbEFSwjV7icrfEw/132","comment_is_top":false,"comment_ctime":1596127271,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596127271","product_id":100020801,"comment_content":"函数是server层的，如果作用在字段上，只能等执行器返回数据才能计算，不知道这个理解对不对","like_count":0},{"had_liked":false,"id":233992,"user_name":"凌风","can_delete":false,"product_type":"c1","uid":1007253,"ip_address":"","ucode":"E675357C22299F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5e/95/68b69251.jpg","comment_is_top":false,"comment_ctime":1594546669,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594546669","product_id":100020801,"comment_content":"对mysql来说，联合索引是由多列组成的主键索引，复合索引也是一种特殊的联合索引，特殊之处在于作为复合索引的每列必须是其他表的主键，不知理解的对不对？","like_count":0},{"had_liked":false,"id":231217,"user_name":"Damo","can_delete":false,"product_type":"c1","uid":1599197,"ip_address":"","ucode":"F332EA67F5A40C","user_header":"https://static001.geekbang.org/account/avatar/00/18/66/dd/c9f17139.jpg","comment_is_top":false,"comment_ctime":1593610575,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593610575","product_id":100020801,"comment_content":"&quot;select * from tradelog where id=&quot;83126&quot;;&quot;<br><br>也有转换函数的加入，同样回走ALL Index。","like_count":0},{"had_liked":false,"id":230527,"user_name":"Amo,","can_delete":false,"product_type":"c1","uid":1675087,"ip_address":"","ucode":"B77CBE5C61CDEB","user_header":"https://static001.geekbang.org/account/avatar/00/19/8f/4f/d42fdb9c.jpg","comment_is_top":false,"comment_ctime":1593410080,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593410080","product_id":100020801,"comment_content":"老师，为什么这个sql select count(*) from tradelog where month(t_modified)=7;的执行计划的可能索引为空呢 possible_keys","like_count":0},{"had_liked":false,"id":228154,"user_name":"天亮前说晚安","can_delete":false,"product_type":"c1","uid":1541014,"ip_address":"","ucode":"1D82EE562A7C71","user_header":"https://static001.geekbang.org/account/avatar/00/17/83/96/73ff13a0.jpg","comment_is_top":false,"comment_ctime":1592568005,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592568005","product_id":100020801,"comment_content":"为什么t_modifier索引更小啊？","like_count":0},{"had_liked":false,"id":222650,"user_name":"蓝猫","can_delete":false,"product_type":"c1","uid":1128676,"ip_address":"","ucode":"A2E11FF854013C","user_header":"https://static001.geekbang.org/account/avatar/00/11/38/e4/17ffa30b.jpg","comment_is_top":false,"comment_ctime":1590857688,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590857688","product_id":100020801,"comment_content":"查询二：select sum(t1.amount) from table2 t1 where not exists (select 1 from table1 t2 where t1.payment_id=t2.id);<br>用了几个小时也查询不出结果<br>执行计划如下：<br>+----+--------------------+-------+------------+------+------------------------------+------+---------+------+--------+----------+------------------------------------------------+<br>| id | select_type        | table | partitions | type | possible_keys                | key  | key_len | ref  | rows   | filtered | Extra                                          |<br>+----+--------------------+-------+------------+------+------------------------------+------+---------+------+--------+----------+------------------------------------------------+<br>|  1 | PRIMARY            | t1    | NULL       | ALL  | NULL                         | NULL | NULL    | NULL | 214182 |   100.00 | Using where                                    |<br>|  2 | DEPENDENT SUBQUERY | t2    | NULL       | ALL  | PRIMARY,table1_idx1 | NULL | NULL    | NULL | 200946 |    10.00 | Range checked for each record (index map: 0x3) |<br>+----+--------------------+-------+------------+------+------------------------------+------+---------+------+--------+----------+------------------------------------------------+<br>请问为什么会这样？有什么办法可以优化第二个查询？","like_count":0},{"had_liked":false,"id":222649,"user_name":"蓝猫","can_delete":false,"product_type":"c1","uid":1128676,"ip_address":"","ucode":"A2E11FF854013C","user_header":"https://static001.geekbang.org/account/avatar/00/11/38/e4/17ffa30b.jpg","comment_is_top":false,"comment_ctime":1590857677,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590857677","product_id":100020801,"comment_content":"查询一：select sum(t1.amount) from table1 t1 where not exists(select 1 from table2 t2 where t1.id=t2.payment_id);<br>用了几秒钟，执行计划如下：<br>+----+--------------------+-------+------------+------+------------------------+------------------------+---------+-------------+--------+----------+--------------------------+<br>| id | select_type        | table | partitions | type | possible_keys          | key                    | key_len | ref         | rows   | filtered | Extra                    |<br>+----+--------------------+-------+------------+------+------------------------+------------------------+---------+-------------+--------+----------+--------------------------+<br>|  1 | PRIMARY            | t1    | NULL       | ALL  | NULL                   | NULL                   | NULL    | NULL        | 200946 |   100.00 | Using where              |<br>|  2 | DEPENDENT SUBQUERY | t2    | NULL       | ref  | index_payment_id | index_payment_id | 203     | audit.t1.id |      1 |   100.00 | Using where; Using index |<br>+----+--------------------+-------+------------+------+------------------------+------------------------+---------+-------------+--------+----------+--------------------------+","like_count":0},{"had_liked":false,"id":222648,"user_name":"蓝猫","can_delete":false,"product_type":"c1","uid":1128676,"ip_address":"","ucode":"A2E11FF854013C","user_header":"https://static001.geekbang.org/account/avatar/00/11/38/e4/17ffa30b.jpg","comment_is_top":false,"comment_ctime":1590857600,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590857600","product_id":100020801,"comment_content":"请教一个问题：<br>有两张表<br>CREATE TABLE `table1` (<br>  `id` varchar(50) NOT NULL DEFAULT &#39;&#39;,<br>  `amount` varchar(30) DEFAULT NULL<br>  PRIMARY KEY (`id`),<br>  UNIQUE KEY `table1_idx1` (`id`) USING BTREE<br>) ENGINE=InnoDB;<br><br>CREATE TABLE `table2` (<br>  `id` varchar(50) COLLATE utf8mb4_bin NOT NULL,<br>  `payment_id` varchar(50) COLLATE utf8mb4_bin DEFAULT NULL,<br>  `amount` varchar(50) COLLATE utf8mb4_bin DEFAULT NULL,<br>  PRIMARY KEY (`id`),<br>  KEY `index_payment_id` (`payment_id`)<br>) ENGINE=InnoDB;<br><br>各自表记录数：<br>table1表有203834条记录，table2表有217295条记录<br>table1.id=t2.payment_id的记录数有217288条；<br>针对这两个表做not exists查询，性能差异巨大，具体情况见下一条留意","like_count":0},{"had_liked":false,"id":218638,"user_name":"赫拉","can_delete":false,"product_type":"c1","uid":1700634,"ip_address":"","ucode":"F8368316AA6F01","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJrGia7c6VRslfS3YJfHib84mibKGnGshUn3cWFJxhm9MjEMuwJibsTpvZI2yW2LJO1bLBgcglVdRxMZA/132","comment_is_top":false,"comment_ctime":1589849343,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589849343","product_id":100020801,"comment_content":"老师，<br>mysql&gt; select d.* from tradelog l , trade_detail d where d.tradeid=CONVERT(l.tradeid USING utf8) and l.id=2; 这条语句将utf8md4转换成utf8，意味着会出现截断可能，不就不能保证查询结果的准确性了？","like_count":0},{"had_liked":false,"id":217353,"user_name":"Dolphin","can_delete":false,"product_type":"c1","uid":1284855,"ip_address":"","ucode":"0481DE78AE7CB5","user_header":"https://static001.geekbang.org/account/avatar/00/13/9a/f7/6ff76318.jpg","comment_is_top":false,"comment_ctime":1589468478,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589468478","product_id":100020801,"comment_content":"老师你好，我不是很明白在解答上期问题中 select * from t limit N, M-N+1;语句，要是是取出随机的三条数据，但是这个结果种种取出的是 M-N 条数据。是需要在业务代码中再进行判断嘛 ？","like_count":0},{"had_liked":false,"id":210327,"user_name":"Geek_GWood","can_delete":false,"product_type":"c1","uid":1903710,"ip_address":"","ucode":"2D4AF55C67D692","user_header":"https://static001.geekbang.org/account/avatar/00/1d/0c/5e/05cd886e.jpg","comment_is_top":false,"comment_ctime":1587721645,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587721645","product_id":100020801,"comment_content":"我遇到一个问题，统计查询的时候，时间范围选0401-0422，只要2s；0402-0423，只要2s；但是选择0401-0423，就需要42s，查找的内容多了2千万（关联的某张表是2千万的记录），这是怎么回事呢","like_count":0},{"had_liked":false,"id":201529,"user_name":"亲斤弓虽😈","can_delete":false,"product_type":"c1","uid":1412163,"ip_address":"","ucode":"575893ECF0B7AA","user_header":"https://static001.geekbang.org/account/avatar/00/15/8c/43/af33659f.jpg","comment_is_top":false,"comment_ctime":1585799838,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585799838","product_id":100020801,"comment_content":"老师有个问题想请教下.<br>表中有个字段是 taskId. i是大写.但是使用taskid=&#39;xxxxx&#39;查询时也可以查询的到.这是为什么呢?mysql可以忽略大小写吗?","like_count":0},{"had_liked":false,"id":198746,"user_name":"Ryan","can_delete":false,"product_type":"c1","uid":1667987,"ip_address":"","ucode":"95BBBEE5B23878","user_header":"https://static001.geekbang.org/account/avatar/00/19/73/93/0a3a1e5b.jpg","comment_is_top":false,"comment_ctime":1585466478,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585466478","product_id":100020801,"comment_content":"本篇的结论是：对索引字段做函数操作，可能会破坏索引值的有序性，因此优化器就决定放弃走树搜索功能。 工作中要尽可能的避免对字段进行函数操作。切记切记！","like_count":0},{"had_liked":false,"id":198731,"user_name":"Ryan","can_delete":false,"product_type":"c1","uid":1667987,"ip_address":"","ucode":"95BBBEE5B23878","user_header":"https://static001.geekbang.org/account/avatar/00/19/73/93/0a3a1e5b.jpg","comment_is_top":false,"comment_ctime":1585465910,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585465910","product_id":100020801,"comment_content":"隐式类型转换里面的 问题答案作者已经写在文章里了：“这里的 CONVERT 函数是加在输入参数上的，这样就可以用上被驱动表的 traideid 索引。”","like_count":0},{"had_liked":false,"id":185749,"user_name":"乔丹","can_delete":false,"product_type":"c1","uid":1217413,"ip_address":"","ucode":"D832A9F97A0C7E","user_header":"https://static001.geekbang.org/account/avatar/00/12/93/85/f5d9474c.jpg","comment_is_top":false,"comment_ctime":1583674205,"is_pvip":false,"replies":[{"id":"71801","content":"就是从主键索引扫的<br>只是实际执行的时候，扫到满足条数的时候，查询就会停止","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1583715514,"ip_address":"","comment_id":185749,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1583674205","product_id":100020801,"comment_content":"explain select * from t  limit 0,5;<br>为何是全表扫描？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486485,"discussion_content":"就是从主键索引扫的\n只是实际执行的时候，扫到满足条数的时候，查询就会停止","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583715514,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1217413,"avatar":"https://static001.geekbang.org/account/avatar/00/12/93/85/f5d9474c.jpg","nickname":"乔丹","note":"","ucode":"D832A9F97A0C7E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":200995,"discussion_content":"mysql 5.7.25\nEXPLAIN SELECT id FROM nt_accumulation_funds_process_project_file_record ORDER BY id LIMIT 0, 5;\nrows: 5\nEXPLAIN SELECT id FROM nt_accumulation_funds_process_project_file_record  LIMIT 1;\nrows:43\n第二条sql很颠覆我的认知，照理来说，它应该是只查询一行就返回了，但是它却遍历了43行才返回。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583750417,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":184659,"user_name":"三三","can_delete":false,"product_type":"c1","uid":1054201,"ip_address":"","ucode":"4A76933C29BDA1","user_header":"https://static001.geekbang.org/account/avatar/00/10/15/f9/0b14785a.jpg","comment_is_top":false,"comment_ctime":1583378839,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1583378839","product_id":100020801,"comment_content":"2020.03.05看的这篇文章有一些疑问：<br>使用函数的情况下，导致不走索引搜索树，文中第一个例子走了索引覆盖扫描，为什么在字符集隐式转换的例子中 语句类似convert函数，不走索引搜索树与不走tradeid全索引扫描了。是因为隐式转换只是在效果上类似上用了函数转换，实际上不是函数转换才导致不走tradeid索引搜索树吗","like_count":0},{"had_liked":false,"id":184517,"user_name":"Geek_039934","can_delete":false,"product_type":"c1","uid":1762889,"ip_address":"","ucode":"44188DEC3E675D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqCiaodjket8HgvF6hD676ofTXDQX3wB7qOna0icS1aJFFciayhel9zsFUIiaia1BOMxgCO5O2jMcXKpLw/132","comment_is_top":false,"comment_ctime":1583332416,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583332416","product_id":100020801,"comment_content":"老师你好，请问mysql在做select条件查询时(例：select * from T where name=&#39;zhangsan&#39;;)，会把整个表数据都加载到内存中，然后再做遍历查询吗，如果是，当表数据量很大时，不会出现oom的问题吗？","like_count":0},{"had_liked":false,"id":182967,"user_name":"Geek_0222ff","can_delete":false,"product_type":"c1","uid":1807633,"ip_address":"","ucode":"DE44842D795762","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJekvtmpE0KxtyYuaalNs9YUabEl2R67O6icnJs1EWib1ZVgPI4h1iaz6DMjjxKLeV2BicSus8icdAHwkw/132","comment_is_top":false,"comment_ctime":1582899941,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582899941","product_id":100020801,"comment_content":"优化器不会主动改写sql语句，会不会也是出于一些别的考虑，比如用户万一就是不想用索引呢？<br>一个小小的想法","like_count":0},{"had_liked":false,"id":174623,"user_name":"华融科技","can_delete":false,"product_type":"c1","uid":1808280,"ip_address":"","ucode":"B6BA3C47C05073","user_header":"","comment_is_top":false,"comment_ctime":1580300069,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1580300069","product_id":100020801,"comment_content":"老师，你好。 <br>取 Y1、Y2 和 Y3 里面最大的一个数，记为 M，最小的一个数记为 N，然后执行下面这条 SQL 语句：select * from t limit N, M-N+1;  为什么就一定能取出3个值？  还是取出一个集合》=3， 然后程序在里面再取3个值 ？","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":161040,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580865176,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":172050,"user_name":"天亮前说晚安","can_delete":false,"product_type":"c1","uid":1541014,"ip_address":"","ucode":"1D82EE562A7C71","user_header":"https://static001.geekbang.org/account/avatar/00/17/83/96/73ff13a0.jpg","comment_is_top":false,"comment_ctime":1579079038,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"1579079038","product_id":100020801,"comment_content":"想问一下老师：为什么字符类型和bit类型不会互转？SELECT * FROM post WHERE post.omit = &#39;0&#39; LIMIT 1; 查询出来是无匹配数据。","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":161376,"discussion_content":"可以，没问题。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580894753,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1541014,"avatar":"https://static001.geekbang.org/account/avatar/00/17/83/96/73ff13a0.jpg","nickname":"天亮前说晚安","note":"","ucode":"1D82EE562A7C71","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":162175,"discussion_content":"啥意思？\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580968238,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":161376,"ip_address":""},"score":162175,"extra":""},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1541014,"avatar":"https://static001.geekbang.org/account/avatar/00/17/83/96/73ff13a0.jpg","nickname":"天亮前说晚安","note":"","ucode":"1D82EE562A7C71","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":162217,"discussion_content":"通过在自己库里面实验，可以搜出来","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580974244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":162175,"ip_address":""},"score":162217,"extra":""},{"author":{"id":1541014,"avatar":"https://static001.geekbang.org/account/avatar/00/17/83/96/73ff13a0.jpg","nickname":"天亮前说晚安","note":"","ucode":"1D82EE562A7C71","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":180234,"discussion_content":"难道是版本问题嘛？或者配置问题？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582287578,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":162217,"ip_address":""},"score":180234,"extra":""}]}]},{"had_liked":false,"id":171033,"user_name":"ipromiseu","can_delete":false,"product_type":"c1","uid":1159317,"ip_address":"","ucode":"775E2CC0E7CA69","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erbUHD8KH3mYz39QuHj5BXB06VqCus5WR4oHfNuSYdPVLno3Tq61yhMiaugxpMicKibDFQ4KwX7icoDWQ/132","comment_is_top":false,"comment_ctime":1578827594,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1578827594","product_id":100020801,"comment_content":"索引 t_modified 比主键索引更小是如何比较出来的 ","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":161042,"discussion_content":"扫描行数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580865355,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":169234,"user_name":"Shine Sunner","can_delete":false,"product_type":"c1","uid":1334754,"ip_address":"","ucode":"8CCECE7F64C06B","user_header":"https://static001.geekbang.org/account/avatar/00/14/5d/e2/3331ad9e.jpg","comment_is_top":false,"comment_ctime":1578298507,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1578298507","product_id":100020801,"comment_content":"老师您好，请问关于“对索引字段做函数操作，可能会破坏索引值的有序性，因此优化器就决定放弃走树搜索功能。”这句话中的“索引字段”包括主键索引么？<br>","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":161043,"discussion_content":"包括","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580865391,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":166850,"user_name":"Geek_1a7057","can_delete":false,"product_type":"c1","uid":1748664,"ip_address":"","ucode":"6A244037A612C8","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/fNVk5gZGGvQeic4wU2T4s5lkO85elfUKHLr2HBBVc63TbJ9xyOUAQeWia0VjBqOfonRrLAXNMIjMiaLFZpV8PiahJQ/132","comment_is_top":false,"comment_ctime":1577614561,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577614561","product_id":100020801,"comment_content":"工作上遇到一个问题：<br>select (select max(date) from T2 where...) as max_date, T1.id from T1 order by max_date,T1.id<br>id上有索引，这句其实是很复杂的sql，我省略写了。explain没什么大问题，就是跑起来50000条数据特别慢。最后查到是这个max_date的排序问题，删掉这个排序字段，查询立马就出结果了。最后的修改方法是：在T1表中追加一个max_date的字段，从业务上将select max这个操作以更新的方式更新到T1的这个max_date中，那么就可以order by T1.max_date了。老师我有两个问题：<br>1. 感觉这个方法好low，因为T2的date字段一旦变更了，T1的max_date就需要更新，有其他好办法吗？<br>2. 不需要给max_date建索引，更改过的sql本身就很快。order by不走索引，max_date又没索引，为什么还能很快呢？什么原理？","like_count":0},{"had_liked":false,"id":166821,"user_name":"金华","can_delete":false,"product_type":"c1","uid":1102781,"ip_address":"","ucode":"938163D760007B","user_header":"https://static001.geekbang.org/account/avatar/00/10/d3/bd/f028955a.jpg","comment_is_top":false,"comment_ctime":1577606266,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1577606266","product_id":100020801,"comment_content":"请教老师一个问题：一个SQL中，where条件字段有多个时A,B,C，  并且字段A、B、 C都建立了索引，是不是每次只能用到一个索引列啊 ？ 而 order by 中 可能会用到多个索引列 ？<br>","like_count":0,"discussions":[{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"温故而知新可以为师矣","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":135279,"discussion_content":"索引只会用到一个，会综合扫描行，排序等因素选出最优的","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1579082325,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":160458,"user_name":"Anthony","can_delete":false,"product_type":"c1","uid":1309908,"ip_address":"","ucode":"9E0C98A9123365","user_header":"https://static001.geekbang.org/account/avatar/00/13/fc/d4/743d3f02.jpg","comment_is_top":false,"comment_ctime":1575954022,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575954022","product_id":100020801,"comment_content":"老师，我的理解是优先级高的去寻找优先级低的表中去寻找数据，就会出现文中的情况，所以我们要想方设法的去让优先级低的去优先级高的表中去匹配数据，或者是让优先级高去请求时转成优先级低的再去匹配","like_count":0},{"had_liked":false,"id":157359,"user_name":"一步","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1575120301,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1575120301","product_id":100020801,"comment_content":"老师我这边实现了这一句查询语句：<br>select l.operator from tradelog l , trade_detail d where d.tradeid=l.tradeid and l.id=2;<br><br>按照上面说的 tradelog 是驱动表， trade_detail 为被驱动表 l.tradeid 字符集为utf8mb4 ,在于 d.tradeid 进行比较的时候， d 表中的数据不是应该做类型转化了吗？ 这时候就不会走索引了，但是 explain 的结果是走tradeid 索引的<br>1\tSIMPLE\tl\t\tconst\t        PRIMARY,tradeid\tPRIMARY\t4<br>1\tSIMPLE\td\t\tindex\t\t                         tradeid\t99<br><br>mysql 的版本为5.7.18<br><br>麻烦老师解答下的","like_count":0},{"had_liked":false,"id":153830,"user_name":"Jason","can_delete":false,"product_type":"c1","uid":1575729,"ip_address":"","ucode":"321ED9E1AC3483","user_header":"https://static001.geekbang.org/account/avatar/00/18/0b/31/f412465b.jpg","comment_is_top":false,"comment_ctime":1574314434,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1574314434","product_id":100020801,"comment_content":"有个问题，当函数是作用在被驱动表的时候为什么还可以走被驱动表的索引？根据老师讲的，加上函数之后就没法利用索引的搜索特性了。<br>那 执行<br>explain select l.operator from tradelog l , trade_detail d where d.tradeid=l.tradeid and d.id=4<br>为什么被驱动表的rows = 1？说明这并不是全索引搜索吧？","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":161067,"discussion_content":"utf8mb4是utf8的超集，当这两个类型的字符串在做比较的时候，先把utf8字符串转换成utf8mb4字符集，再做比较。\n所以，函数计算并没有作用到字段上，而是作用在参数上。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580866487,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":150273,"user_name":"zjc","can_delete":false,"product_type":"c1","uid":1705108,"ip_address":"","ucode":"69CCFA8E6A2C5D","user_header":"https://static001.geekbang.org/account/avatar/00/1a/04/94/1490cdce.jpg","comment_is_top":false,"comment_ctime":1573488686,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573488686","product_id":100020801,"comment_content":"为什么例子1里面的or也用到了索引呢老师","like_count":0},{"had_liked":false,"id":145719,"user_name":"鑫","can_delete":false,"product_type":"c1","uid":1614472,"ip_address":"","ucode":"AE4F60490E9A81","user_header":"https://static001.geekbang.org/account/avatar/00/18/a2/88/387f84f9.jpg","comment_is_top":false,"comment_ctime":1572351642,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1572351642","product_id":100020801,"comment_content":"三种情况都可以一句话理解, 都是找不到当前值排好序的b+树了,或者原来b+顺序已不可用","like_count":0},{"had_liked":false,"id":142008,"user_name":"小予","can_delete":false,"product_type":"c1","uid":1442580,"ip_address":"","ucode":"3F5EAEE1746074","user_header":"https://static001.geekbang.org/account/avatar/00/16/03/14/e9ca2d09.jpg","comment_is_top":false,"comment_ctime":1571278530,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1571278530","product_id":100020801,"comment_content":"关于“隐式字符编码转换“有个问题想问一下老师。<br>表a【字符集为utf8】，其中有字段 name，age<br>表b【字符集为utf8mb4】，其中有字段 name，sex<br>当执行表连接时 select * from a inner join b on a.name = b.name 是会自动“隐式字符编码转换“的<br>但是当执行 select * from a where name = &#39;fancy🎥&#39;（其中🎥属于utf8mb4字符集，不属于utf8字符集），会发生异常  ==&gt;  [Err] 1267 - Illegal mix of collations (utf8_general_ci,IMPLICIT) and (utf8mb4_general_ci,COERCIBLE) for operation &#39;=&#39;  <br>是DBA对数据库做了限制么，还是说MySQL在字段和字符串直接比较时不支持“隐式字符编码转换“，<br>必须改成 select * from a where convert(name using utf8mb4) = &#39;fancy🎥&#39;才行","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":161070,"discussion_content":"应该是做了限制吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580866690,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":134470,"user_name":"丁丁历险记","can_delete":false,"product_type":"c1","uid":1661704,"ip_address":"","ucode":"A43829E454C067","user_header":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","comment_is_top":false,"comment_ctime":1568853250,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568853250","product_id":100020801,"comment_content":"太多，有些优化完都不知道为啥。。","like_count":0},{"had_liked":false,"id":133750,"user_name":"懵逼猴","can_delete":false,"product_type":"c1","uid":1204947,"ip_address":"","ucode":"BDC748A96AC316","user_header":"https://static001.geekbang.org/account/avatar/00/12/62/d3/663de972.jpg","comment_is_top":false,"comment_ctime":1568645416,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1568645416","product_id":100020801,"comment_content":"老师好，如果把例子中关联查询改为inner join的查询，驱动和被驱动表的字符集必须相同吧？","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":161071,"discussion_content":"跟inner join没关系吧，不同字符集的时候也会涉及字符集编码转换。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580866755,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130167,"user_name":"lucian","can_delete":false,"product_type":"c1","uid":1093620,"ip_address":"","ucode":"DFF29F0E91491E","user_header":"","comment_is_top":false,"comment_ctime":1567395476,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1567395476","product_id":100020801,"comment_content":"面试遇到一个问题， 表只有3条数据， delete from t1 limit 3 和  delete from t1有什么区别？","like_count":0,"discussions":[{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"温故而知新可以为师矣","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":135297,"discussion_content":"多一步排序吧","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1579083880,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":129578,"user_name":"Hinimix","can_delete":false,"product_type":"c1","uid":1316937,"ip_address":"","ucode":"7994136C93BD89","user_header":"https://static001.geekbang.org/account/avatar/00/14/18/49/b1d864e5.jpg","comment_is_top":false,"comment_ctime":1567157540,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567157540","product_id":100020801,"comment_content":"老师，我的测试表里trade_detail里有联合索引<br>explain select trade_detail.* from trade_log,  trade_detail where CONVERT(trade_log.id USING utf8mb4)=CONVERT(trade_detail.id USING utf8mb4);<br>执行的时候显示trade_detail使用了联合索引，我理解不通，为什么我查询条件是id也用联合索引呢","like_count":0},{"had_liked":false,"id":125113,"user_name":"我家门前有只猪","can_delete":false,"product_type":"c1","uid":1488035,"ip_address":"","ucode":"F8CF618CF4681E","user_header":"https://static001.geekbang.org/account/avatar/00/16/b4/a3/a159ca86.jpg","comment_is_top":false,"comment_ctime":1566092134,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1566092134","product_id":100020801,"comment_content":"全索引扫描和全表扫描有什么区别 ，扫描的函数应该都是一样的吧？","like_count":0,"discussions":[{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"温故而知新可以为师矣","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":135298,"discussion_content":"InnoDB的话一个意思，因为本身就是使用索引结构存储数据","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579083949,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":119124,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1564528877,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564528877","product_id":100020801,"comment_content":"课前思考<br><br>1：一些SQL语句逻辑一样，为啥性能相差巨大？<br><br>我认为应该是，是否走索引的引起的，SQL的逻辑一样应该指的是人想取的数据的逻辑一样，但是数据库的存储引擎取数的逻辑是不一样的<br><br>课后思考<br><br>1：课前思考猜对了一部分，不过没有进一步追问，为啥存储引擎的取数逻辑变化了？通过阅读理解到了MySQL的一个原则——对索引字段做函数操作，可能会破坏索引值的有序性，因此优化器就决定放弃走树搜索功能。一个SQL语句跑的快慢，关键在于是否走了索引搜索，使用函数修饰索引字段，会破坏索引字段的有序性，因为索引上并没有使用函数修饰后的值建立索引，当然索引字段会继续使用的，只是会判断是遍历主键索引还是这个索引而已，遍历那个索引的代价小就会走那个啦！<br><br>2：有哪些破坏索引顺序的方式？<br><br>第一明着对索引字段使用函数转换<br><br>第二隐式对索引字段使用函数转换，比较常见的场景是：字段类型的隐式函数转换，字段字符集的隐式函数转换，计算引起的隐式函数转换<br><br>另外，针对索引字段的参数使用函数，不会破坏索引的有些性<br><br>3：索引，对于查找太重要了，只要慢了，大多数情况都是索引使用不当引起的，只是不当使用的方式太多了，针对明显使用不当的还比较容易排查，比如：针对索引字段使用函数转换，对于隐式的使用不当就需要，记住隐式破坏的类型逐一排查啦！<br><br>4：休假回来发现极客时间越来越好用了，如果再加上点细微功能就更好了，比如：选择是否显示老师没回答的问题，看这个专栏比较花时间，专栏内容好，评论的质量高，数量也多，每次都想看一下，不过评论确实太多了，如果只看老师回复的，通过老师的回复先过滤一下，估计会少一些，也能知道老师回复的量有多少，另外，不知道精选留言的判断逻辑是啥？是老师判断的还是极客时间的编辑判断的？想必已经过滤过一波留言了？","like_count":0},{"had_liked":false,"id":115578,"user_name":"尘封","can_delete":false,"product_type":"c1","uid":1247006,"ip_address":"","ucode":"CEE0C006387A03","user_header":"https://static001.geekbang.org/account/avatar/00/13/07/1e/bdbe93f4.jpg","comment_is_top":false,"comment_ctime":1563634631,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563634631","product_id":100020801,"comment_content":"两个表关联查询时，比如select * from tb1,tb2 where tb1.name=tb2.name;<br>tb1.name排序规则         tb2.name排序规则<br>utf8_bin        和 utf8_general_ci    关联查询OK<br>utf8_bin        和 utf8mb4_general_ci 关联查询OK<br>utf8_bin        和 utf8mb4_unicode_ci 关联查询OK<br>utf8_general_ci 和 utf8mb4_unicode_ci 关联查询OK <br>utf8_general_ci 和 utf8mb4_general_ci 关联查询OK<br><br>utf8_general_ci 和 utf8_unicode_ci       报错 <br>utf8mb4_general_ci 和 utf8mb4_unicode_ci 报错 <br>报错内容如下 <br>ERROR 1267 (HY000): Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_unicode_ci,IMPLICIT) for operation &#39;=&#39; <br>想问下，为什么两种报错，上面的几种不报错？","like_count":0},{"had_liked":false,"id":111981,"user_name":"佑儿","can_delete":false,"product_type":"c1","uid":1226196,"ip_address":"","ucode":"0629888E7A5E16","user_header":"https://static001.geekbang.org/account/avatar/00/12/b5/d4/3bd5b77b.jpg","comment_is_top":false,"comment_ctime":1562647129,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1562647129","product_id":100020801,"comment_content":"如何区分驱动表和被驱动表呢？","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":161073,"discussion_content":"这个就是评估谁的行数少，谁就是驱动表。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580867015,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108832,"user_name":"Geek_jychen","can_delete":false,"product_type":"c1","uid":1581375,"ip_address":"","ucode":"183409DA65485F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PXT6vnzzI60Pkgh6bTNr9Q3S0OoYvyUgYupqQTVPs8A5z7VEf0ea8ZvCCzBvj5U68PaF5DPLibfUSENfZt0jLPA/132","comment_is_top":false,"comment_ctime":1561896748,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1561896748","product_id":100020801,"comment_content":"想问一下使用force index反而增大了查询条数？","like_count":0},{"had_liked":false,"id":104066,"user_name":"do it","can_delete":false,"product_type":"c1","uid":1309911,"ip_address":"","ucode":"E0753912E8F2AF","user_header":"https://static001.geekbang.org/account/avatar/00/13/fc/d7/b102034a.jpg","comment_is_top":false,"comment_ctime":1560609649,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560609649","product_id":100020801,"comment_content":"索引失效情况<br>1、索引字段使用了函数转换<br>2、隐式类型转换<br>3、隐式字符集转换<br>","like_count":0},{"had_liked":false,"id":99159,"user_name":"风行年华","can_delete":false,"product_type":"c1","uid":1303474,"ip_address":"","ucode":"427B741831D5E9","user_header":"https://static001.geekbang.org/account/avatar/00/13/e3/b2/cf2412da.jpg","comment_is_top":false,"comment_ctime":1559173063,"is_pvip":false,"replies":[{"id":"36698","content":"看个人哈  我是前者","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1560003829,"ip_address":"","comment_id":99159,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1559173063","product_id":100020801,"comment_content":"老师，一直很好奇编写源码的能力，是指直接干预数据库的流程还是说在数据库之外另外走一套","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451997,"discussion_content":"看个人哈  我是前者","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560003829,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96166,"user_name":"Rayjun","can_delete":false,"product_type":"c1","uid":1002514,"ip_address":"","ucode":"61A3D1A3D03569","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4c/12/f0c145d4.jpg","comment_is_top":false,"comment_ctime":1558347791,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1558347791","product_id":100020801,"comment_content":"之前有看到一个说法，如果使用 or，那么 or 所关联的字段就应该全部都加上索引，如果有一个字段没有加上索引，那么最后的查询就不会使用索引，这个要怎么解释呢？","like_count":0},{"had_liked":false,"id":90199,"user_name":"不似旧日","can_delete":false,"product_type":"c1","uid":1161271,"ip_address":"","ucode":"DF4C5E3AB9570C","user_header":"https://static001.geekbang.org/account/avatar/00/11/b8/37/98991aeb.jpg","comment_is_top":false,"comment_ctime":1556445966,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556445966","product_id":100020801,"comment_content":"索引失效<br>1.字段做了函数计算<br>2.隐式类型转换,隐式字符编码转换(本质上都是对字段进行了函数操作)","like_count":0},{"had_liked":false,"id":89548,"user_name":"kissrain","can_delete":false,"product_type":"c1","uid":1120583,"ip_address":"","ucode":"2177C53E3B2DCC","user_header":"https://static001.geekbang.org/account/avatar/00/11/19/47/b27f1314.jpg","comment_is_top":false,"comment_ctime":1556201599,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556201599","product_id":100020801,"comment_content":"老师您好，请教一下，<br>放弃了树搜索功能，选择t_modified索引的过程下下面这样吗？<br>当使用t_modified索引的时候，对索引上的每个t_modified值先取出来，再进行转换和7进行对比，如果是等于7，那么记录成一行数据，依次遍历。<br>如果不是，可以详细说明一下在使用函数的情况下选t_modified索引的执行流程吗？","like_count":0},{"had_liked":false,"id":79441,"user_name":"三胖","can_delete":false,"product_type":"c1","uid":1373454,"ip_address":"","ucode":"CD69FCD606FC5C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/1hp9kzzuLUVHzmmddIPIO2OgUWr1ibJRr8cMoB7K0fwx8Vmn34L8yN2NoYUtgNicfPGaXKF02pQ2huXd59r2I0kw/132","comment_is_top":false,"comment_ctime":1553484077,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1553484077","product_id":100020801,"comment_content":"老师，这是我结合平时的归纳，帮我过目一下哈：<br>对索引列进行函数操作，会迫使mysql弃用索引。<br>对参数进行函数操作，若函数为自定义函数，mysql会进行全表扫描；若是内置函数，一般不会导致弃用索引(特殊函数find_in_set()等除外，其实我只知道find_in_set()哈哈哈)","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":161078,"discussion_content":"不是弃用索引，是放弃b+树搜索，该用索引还是要用的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580867181,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":72910,"user_name":"rm","can_delete":false,"product_type":"c1","uid":1129548,"ip_address":"","ucode":"17EAF6256277E4","user_header":"https://static001.geekbang.org/account/avatar/00/11/3c/4c/cd7c8019.jpg","comment_is_top":false,"comment_ctime":1551753787,"is_pvip":false,"replies":[{"id":"27088","content":"如你所说，区分度小，就会导致优化器不使用这个索引了。<br><br>这个解决方案没看懂，你用device_type来做聚合，换成id好像并没有什么改善哦","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1552111460,"ip_address":"","comment_id":72910,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551753787","product_id":100020801,"comment_content":"老师您好！<br>表结构：CREATE TABLE `view_statistics` (<br>  `statistic_id` int(11) NOT NULL AUTO_INCREMENT COMMENT &#39;统计id&#39;,<br>  `enter_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;访问时间，精确到天&#39;,<br>  `device_type` int(1) NOT NULL COMMENT &#39;设备类型：1安卓设备 2苹果设备 3WP设备 4电脑&#39;,<br>  `show_count` int(11) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;展示总数&#39;,<br>  PRIMARY KEY (`statistic_id`) USING BTREE,<br>  KEY `enter_time` (`enter_time`) USING BTREE<br>) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COMMENT=&#39;页面访问来路统计&#39;;<br>有如下SQL；<br>SELECT `device_type` AS `device_type`, SUM(show_count) AS pv FROM `sp_view_referrer_statistics` WHERE `enter_time` BETWEEN &#39;2019-01-24 00:00:00&#39; AND &#39;2019-02-22 23:59:59&#39; GROUP BY `device_type` <br>通过explain分析，它没有走enter_time索引，这是为什么？<br>通过分析： show index from view_statistics; <br>enter_time索引的区分度不高，总数据cardinality是4443740，而它只有117。<br>我解决方案是查出这个时间区间的最大和最小的statistic_id，再由statistic_id去统计这个SQL，<br>不知道是否有其他好方法吗？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441822,"discussion_content":"如你所说，区分度小，就会导致优化器不使用这个索引了。\n\n这个解决方案没看懂，你用device_type来做聚合，换成id好像并没有什么改善哦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552111460,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70829,"user_name":"不惑ing","can_delete":false,"product_type":"c1","uid":1207079,"ip_address":"","ucode":"AF04E417D38027","user_header":"https://static001.geekbang.org/account/avatar/00/12/6b/27/8c964e52.jpg","comment_is_top":false,"comment_ctime":1551191273,"is_pvip":false,"replies":[{"id":"25364","content":"1. order 对优化器评估执行代价的影响确实比较大。如果是你举的这个例子，过滤性好，是可能走name索引的<br>2. 没说一定变快😆","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1551195437,"ip_address":"","comment_id":70829,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551191273","product_id":100020801,"comment_content":"您好，看了@zhxleon 同学提的问题和您的回复有点懵，没理解：<br><br>第一个问题：<br>order by ifnull(id,0)  在id字段上加函数了为啥一定会走id索引，如果结合第10篇文章理解因为要用到id排序所以优化器选择使用id索引，但是我觉得不一定吧？难道排序对优化器的影响权重很大，大到会完全忽略where后面的带索引的筛选条件么？<br><br>比如：select * from t where name=&#39;abc&#39; order by isfull(id,0) limt 0,500  ，name上有索引而且查询出来的行很少（极端点只有1行），这个时候应该走name上的索引的吧？<br><br>第二个问题：<br>而且即使走id索引，因为字段加了函数也是走全索引扫描吧？为啥查询会变快？<br><br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440850,"discussion_content":"1. order 对优化器评估执行代价的影响确实比较大。如果是你举的这个例子，过滤性好，是可能走name索引的\n2. 没说一定变快😆","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551195437,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68269,"user_name":"菜鸡一只","can_delete":false,"product_type":"c1","uid":1336004,"ip_address":"","ucode":"5FBA9A68E0E9B9","user_header":"https://static001.geekbang.org/account/avatar/00/14/62/c4/98a9e594.jpg","comment_is_top":false,"comment_ctime":1550473446,"is_pvip":false,"replies":[{"id":"24171","content":"需要做类型转换的时候，比如说两个不同类型字符串的等值判断","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1550479430,"ip_address":"","comment_id":68269,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550473446","product_id":100020801,"comment_content":"老师您好，什么情况mysql会将字符串utf8自动转为utf8mb4?","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439600,"discussion_content":"需要做类型转换的时候，比如说两个不同类型字符串的等值判断","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550479430,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":64302,"user_name":"Lukia","can_delete":false,"product_type":"c1","uid":1028698,"ip_address":"","ucode":"C19472337BCCC6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b2/5a/574f5bb0.jpg","comment_is_top":false,"comment_ctime":1548739620,"is_pvip":false,"replies":[{"id":"22772","content":"第34、35两篇就会说到了，今晚关注下😆","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1548740841,"ip_address":"","comment_id":64302,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548739620","product_id":100020801,"comment_content":"老师好，之前看了《数据索引与优化》，提到表之间的连接操作可以有嵌套循环连接（本文中提到的驱动表和被驱动表）和合并扫描连接（先在临时表中针对谓词作排序）还有哈希连接。请问MySQL中是否存在后面两种方式的连接，如果有的话优化器会在什么情况下选择呢？谢谢！","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437949,"discussion_content":"第34、35两篇就会说到了，今晚关注下😆","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548740841,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62848,"user_name":"八百","can_delete":false,"product_type":"c1","uid":1253530,"ip_address":"","ucode":"79F1F79ADF5A00","user_header":"https://static001.geekbang.org/account/avatar/00/13/20/9a/3b1c65fd.jpg","comment_is_top":false,"comment_ctime":1548172674,"is_pvip":false,"replies":[{"id":"23033","content":"这个看得不是很清楚<br><br>是说在执行 update xx where a= :a的时候，传了一个double类型给:a这个参数吗<br><br>","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1549005020,"ip_address":"","comment_id":62848,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548172674","product_id":100020801,"comment_content":"前几天别人刚碰到，大概是这样的，<br>在web开发中，前端传了一个Json格式的http请求，json内容:{a:1，b:1}，其中a对的数据字段类型为varchar。在服务端用fastjson解析的，fastjson将a解析成了int类型，然后根据update xx where a= :a 执行sql时，老是报字段转换溢出，貌似转换成double溢出了。而且报别的行记录中的a字段的值😂","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437371,"discussion_content":"这个看得不是很清楚\n\n是说在执行 update xx where a= :a的时候，传了一个double类型给:a这个参数吗\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549005020,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61183,"user_name":"刘育飞","can_delete":false,"product_type":"c1","uid":1363642,"ip_address":"","ucode":"06600614E898CC","user_header":"https://static001.geekbang.org/account/avatar/00/14/ce/ba/f73555c7.jpg","comment_is_top":false,"comment_ctime":1547633531,"is_pvip":true,"replies":[{"id":"21793","content":"这个其实没有定数，因为要看行大小、数据库系统当时的压力、你要开多少并发。。。不过如果让我选，我大概会先试1000","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547658683,"ip_address":"","comment_id":61183,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547633531","product_id":100020801,"comment_content":"总共插入一百万的数据 该怎么处理。分批插入的 每次最好为多大 1000还是1万跪求 大佬解答 ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436776,"discussion_content":"这个其实没有定数，因为要看行大小、数据库系统当时的压力、你要开多少并发。。。不过如果让我选，我大概会先试1000","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547658683,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60392,"user_name":"forest","can_delete":false,"product_type":"c1","uid":1308788,"ip_address":"","ucode":"12D0D625FD0A9A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epUJdFmCMjlCCAJYGygibpiahBrLB9MDIhNia8c8BWXBMYLa4gUoa7rVes5BF144BnZYHcAZI6zZ9TdQ/132","comment_is_top":false,"comment_ctime":1547468358,"is_pvip":false,"replies":[{"id":"21563","content":"你前面的select是怎么写的~，贴个完整的语句和表结构哦","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547495325,"ip_address":"","comment_id":60392,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547468358","product_id":100020801,"comment_content":"请问丁老师，where a=1 and b=2 group by c order by d这个语句如何建索引才能避免explain中的using temporary","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436490,"discussion_content":"你前面的select是怎么写的~，贴个完整的语句和表结构哦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547495325,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57930,"user_name":"雪候鸟","can_delete":false,"product_type":"c1","uid":1121047,"ip_address":"","ucode":"B7A82676DFD39F","user_header":"https://static001.geekbang.org/account/avatar/00/11/1b/17/64e18a78.jpg","comment_is_top":false,"comment_ctime":1546943839,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546943839","product_id":100020801,"comment_content":"找到问题了，我是用SQLyog工具改的，这种改法好像不会改历史数据，用alter改完字符集之后，索引就生效了","like_count":0},{"had_liked":false,"id":57927,"user_name":"雪候鸟","can_delete":false,"product_type":"c1","uid":1121047,"ip_address":"","ucode":"B7A82676DFD39F","user_header":"https://static001.geekbang.org/account/avatar/00/11/1b/17/64e18a78.jpg","comment_is_top":false,"comment_ctime":1546943031,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546943031","product_id":100020801,"comment_content":"老师你好，EXPLAIN SELECT d.* FROM tradelog l, trade_detail d WHERE d.tradeid=l.tradeid AND l.id=2; 这个例子，我把字符集改成一样的，还是第二个表用不上索引，这个是怎么回事？","like_count":0},{"had_liked":false,"id":57486,"user_name":"刘鹏","can_delete":false,"product_type":"c1","uid":1230417,"ip_address":"","ucode":"44F3D4DB3F5678","user_header":"https://static001.geekbang.org/account/avatar/00/12/c6/51/e39b5828.jpg","comment_is_top":false,"comment_ctime":1546821854,"is_pvip":false,"replies":[{"id":"20729","content":"select d.* from tradelog l right  join trade_detail d on  d.tradeid=l.tradeid where l.id=2;<br>是说这个语句吗？怎么改呢？","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1546827977,"ip_address":"","comment_id":57486,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1546821854","product_id":100020801,"comment_content":"老师，字符格式转换的例子，如果换成left join，应该换一下连接表达式的顺序就可以了吧","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435600,"discussion_content":"select d.* from tradelog l right  join trade_detail d on  d.tradeid=l.tradeid where l.id=2;\n是说这个语句吗？怎么改呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546827977,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":161084,"discussion_content":"改了left也没用，因为l的值是参数，怎么也得对d字段做函数转换。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580867718,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56608,"user_name":"xm","can_delete":false,"product_type":"c1","uid":1254296,"ip_address":"","ucode":"9A08EB6F201D74","user_header":"https://static001.geekbang.org/account/avatar/00/13/23/98/bd96932f.jpg","comment_is_top":false,"comment_ctime":1546505117,"is_pvip":false,"replies":[{"id":"21095","content":"你举几个你觉得特别“异常”的例子哈","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1547116654,"ip_address":"","comment_id":56608,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546505117","product_id":100020801,"comment_content":"老师好，关于in  or语句走不走的索引的问题能分析一下吗？  这一块好像很蒙，查询和更新时的情况好像还不一样，对他们的执行流程不是特别明白，总感觉有很多不明白的问题，还有关于这类业务的优化有哪些技巧？比如in有时可以用exist 1代替啥的优化手段等？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435145,"discussion_content":"你举几个你觉得特别“异常”的例子哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547116654,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54236,"user_name":"o9","can_delete":false,"product_type":"c1","uid":1101332,"ip_address":"","ucode":"E373E82A39BBFE","user_header":"https://static001.geekbang.org/account/avatar/00/10/ce/14/b488f241.jpg","comment_is_top":false,"comment_ctime":1545813076,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1545813076","product_id":100020801,"comment_content":"老师好, 还是 mariadb 10.3.11 的问题<br><br>表结构; 6万多数据<br>CREATE TABLE `umc` (<br>  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,<br>  `user_id` int(11) unsigned NOT NULL DEFAULT 0,<br>  `ai` int(11) unsigned NOT NULL DEFAULT 0,<br>  `status` tinyint(1) unsigned NOT NULL DEFAULT 0,<br>  `cc` int(11) unsigned NOT NULL DEFAULT 0,<br>  `lc` int(11) unsigned NOT NULL DEFAULT 0,<br>  `des` varchar(200) NOT NULL DEFAULT &#39;&#39;,<br>  `isd` tinyint(1) unsigned NOT NULL DEFAULT 0,<br>  `at` int(11) unsigned NOT NULL DEFAULT 0,<br>  `at1` int(11) unsigned NOT NULL DEFAULT 0,<br>  `ycs` tinyint(1) unsigned NOT NULL DEFAULT 0,<br>  PRIMARY KEY (`id`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;<br><br>语句:<br>SELECT `id` FROM `umc` WHERE `user_id` IN (1021个user_id);<br><br>我这边在 mariadb执行时间是 7s多<br>id\tselect_type\ttable\ttype\tpossible_keys\tkey\tkey_len\tref\trows\tExtra<br>1\tPRIMARY\tumc\tALL\tNULL\tNULL\tNULL\tNULL\t65621\t<br>1\tPRIMARY\t&lt;derived3&gt;\tALL\tNULL\tNULL\tNULL\tNULL\t1010\tUsing where; FirstMatch(umc); Using join buffer (flat, BNL join)<br>3\tDERIVED\tNULL\tNULL\tNULL\tNULL\tNULL\tNULL\tNULL\tNo tables used","like_count":0},{"had_liked":false,"id":54173,"user_name":"o9","can_delete":false,"product_type":"c1","uid":1101332,"ip_address":"","ucode":"E373E82A39BBFE","user_header":"https://static001.geekbang.org/account/avatar/00/10/ce/14/b488f241.jpg","comment_is_top":false,"comment_ctime":1545800283,"is_pvip":false,"replies":[{"id":"19605","content":"差别这么大呀<br><br>表结构（脱敏后）和语句发一下","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545809166,"ip_address":"","comment_id":54173,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1545800283","product_id":100020801,"comment_content":"老师好, 还是 mariadb 10.3.11 的那个问题<br><br>在 mysql 5.7 上<br>id\tselect_type\ttable\tpartitions\ttype\tpossible_keys\tkey\tkey_len\tref\trows\tfiltered\tExtra<br>1\tSIMPLE\tuser_moments\tNULL\tindex\tNULL\tPRIMARY\t4\tNULL\t67428\t2.00\tUsing where<br><br>mariadb 10.3.11<br>id\tselect_type\ttable\ttype\tpossible_keys\tkey\tkey_len\tref\trows\tExtra<br>1\tPRIMARY\tuser_moments\tALL\tNULL\tNULL\tNULL\tNULL\t67211\tUsing where; Using temporary; Using filesort<br>1\tPRIMARY\t&lt;derived3&gt;\tALL\tNULL\tNULL\tNULL\tNULL\t1010\tUsing where; FirstMatch(user_moments); Using join buffer (flat, BNL join)<br>3\tDERIVED\tNULL\tNULL\tNULL\tNULL\tNULL\tNULL\tNULL\tNo tables used","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434379,"discussion_content":"差别这么大呀\n\n表结构（脱敏后）和语句发一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545809166,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53940,"user_name":"Long","can_delete":false,"product_type":"c1","uid":1318970,"ip_address":"","ucode":"2417242560360A","user_header":"https://static001.geekbang.org/account/avatar/00/14/20/3a/90db6a24.jpg","comment_is_top":false,"comment_ctime":1545771651,"is_pvip":false,"replies":[{"id":"19559","content":"取样统计这个在“为什么MySQL 会选错索引”这篇有提，你看下<br><br>优化器的选择逻辑太复杂了😓，这45篇里估计不会讲","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545789544,"ip_address":"","comment_id":53940,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545771651","product_id":100020801,"comment_content":"老师，你好，我的提问帮忙看下呢？<br>大部分大家都总结了，遇到最多的就是字符集隐式转换，嵌套连接问题，还有一类就是数据表大量的新增删除以后，free date比较大，字段的cardnanity统计有问题，导致优化器选择不走索引的问题，select还好，delete会超级慢，并且锁表严重，不是精确的根据where条件的索引行锁。老师能不能解释下，free data，information schema里面的，tables ，index这些取样统计原理，以及优化器参考这些信息的选择逻辑，多谢","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434292,"discussion_content":"取样统计这个在“为什么MySQL 会选错索引”这篇有提，你看下\n\n优化器的选择逻辑太复杂了😓，这45篇里估计不会讲","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545789544,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53835,"user_name":"o9","can_delete":false,"product_type":"c1","uid":1101332,"ip_address":"","ucode":"E373E82A39BBFE","user_header":"https://static001.geekbang.org/account/avatar/00/10/ce/14/b488f241.jpg","comment_is_top":false,"comment_ctime":1545738797,"is_pvip":false,"replies":[{"id":"19528","content":"把结果贴一下嘛，最好还再贴一下在MySQL 5.7版本的对照结果😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545753721,"ip_address":"","comment_id":53835,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1545738797","product_id":100020801,"comment_content":"老师，我们遇到一个特别奇怪的问题，Mariadb 10.3.11版本 where in 里的值如果过大 比如说上千个，它的 explain的结果特别奇怪，实在是找不到原因了，希望大牛给看看","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434258,"discussion_content":"把结果贴一下嘛，最好还再贴一下在MySQL 5.7版本的对照结果😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545753721,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53632,"user_name":"Leon📷","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1545702775,"is_pvip":false,"replies":[{"id":"19496","content":"嗯，这个我得考虑下哈。<br><br>一般是这样，如果面试官问这么空泛的问题，我大概会请他描述一个具体的场景…<br><br>主要是因为架构优化的方向太多了😓<br><br>","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545715835,"ip_address":"","comment_id":53632,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545702775","product_id":100020801,"comment_content":"我想面试官的意思就是针对业务的设计要注意哪些点提升性能和避免哪些问题，并且依靠这些点来设计自己的业务的数据库的表，我之前的业务量很小，没有这么多优化，我想老师课程结束的时候给我们一个大纲，让我们拿到一个新的业务和需求，应该着手考虑哪些点，怎么设计，怎么切入，这样我出去吹牛逼的有章可循","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434209,"discussion_content":"嗯，这个我得考虑下哈。\n\n一般是这样，如果面试官问这么空泛的问题，我大概会请他描述一个具体的场景…\n\n主要是因为架构优化的方向太多了😓\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545715835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53513,"user_name":"封建的风","can_delete":false,"product_type":"c1","uid":1302600,"ip_address":"","ucode":"811C24F093AF0F","user_header":"https://static001.geekbang.org/account/avatar/00/13/e0/48/3d72e81c.jpg","comment_is_top":false,"comment_ctime":1545661368,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545661368","product_id":100020801,"comment_content":"之前同事碰过索引截断造成的性能问题。印象例子如下<br>table_a(ID int primary key,b varchar(10)),有b字段的索引,其中b字段前面10位字符相同的数据（aaaaaaaaaa）最多的有100万行，执行select * from where b=&#39;aaaaaaaaaa132456789&#39;非常慢，这个应该也是把b扩长了吧,当时看tracer计划是把变量截断为varchar(10)了，按理说走索引直接能判出结果为空，但感觉计划去scan索引最后用where筛选了","like_count":0},{"had_liked":false,"id":53459,"user_name":"Long","can_delete":false,"product_type":"c1","uid":1318970,"ip_address":"","ucode":"2417242560360A","user_header":"https://static001.geekbang.org/account/avatar/00/14/20/3a/90db6a24.jpg","comment_is_top":false,"comment_ctime":1545650019,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545650019","product_id":100020801,"comment_content":"大部分大家都总结了，遇到最多的就是字符集隐式转换，嵌套连接问题，还有一类就是数据表大量的新增删除以后，free date比较大，字段的cardnanity统计有问题，导致优化器选择不走索引的问题，select还好，delete会超级慢，并且锁表严重，不是精确的根据where条件的索引行锁。老师能不能解释下，free data，information schema里面的，tables ，index这些取样统计原理，以及优化器参考这些信息的选择逻辑，多谢","like_count":0},{"had_liked":false,"id":53408,"user_name":"风动草","can_delete":false,"product_type":"c1","uid":1303051,"ip_address":"","ucode":"6ED975DC4DD0D0","user_header":"https://static001.geekbang.org/account/avatar/00/13/e2/0b/e3c8765a.jpg","comment_is_top":false,"comment_ctime":1545639794,"is_pvip":false,"replies":[{"id":"19321","content":"嗯这个APP现在还不能支持原评论追问<br><br><br>这些我觉得你可以从binlog的格式来反推，<br>控制的话，就是执行这个update的线程本身呀","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545642326,"ip_address":"","comment_id":53408,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545639794","product_id":100020801,"comment_content":"这个不可以在原有的留言上回复吗？<br><br>我就是想知道这个线程是什么线程，这个线程在工作的时候都占用了哪些资源，还有一个就是写binlog的时候是写入哪些内容（比如 参数调整row模式和statment模式后写入的不同内容是谁来控制的），有这方面的文档参考下吗？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434130,"discussion_content":"嗯这个APP现在还不能支持原评论追问\n\n\n这些我觉得你可以从binlog的格式来反推，\n控制的话，就是执行这个update的线程本身呀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545642326,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53402,"user_name":"风动草","can_delete":false,"product_type":"c1","uid":1303051,"ip_address":"","ucode":"6ED975DC4DD0D0","user_header":"https://static001.geekbang.org/account/avatar/00/13/e2/0b/e3c8765a.jpg","comment_is_top":false,"comment_ctime":1545639137,"is_pvip":false,"replies":[{"id":"19313","content":"没明白你的问题<br><br>Binlog就是执行语句的线程写的，先写binlog cache, 事务提交就落盘，主要流程是这个，你的问题是？","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545639597,"ip_address":"","comment_id":53402,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545639137","product_id":100020801,"comment_content":"丁奇老师好！<br>     最近研究binlog日志提交的问题，延伸到了，mysql写binlog的进程和体系结构。这个在网络上好像都找不到类似的信息，可以请您提供一些中文的说明文档给我参考下吗？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434129,"discussion_content":"没明白你的问题\n\nBinlog就是执行语句的线程写的，先写binlog cache, 事务提交就落盘，主要流程是这个，你的问题是？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545639597,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53220,"user_name":"豆瓣","can_delete":false,"product_type":"c1","uid":1314432,"ip_address":"","ucode":"992F953CE12591","user_header":"https://static001.geekbang.org/account/avatar/00/14/0e/80/e6055a60.jpg","comment_is_top":false,"comment_ctime":1545617267,"is_pvip":false,"replies":[{"id":"19283","content":"额 你这么描述我也复现不出来。<br><br>有复现方法吗","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545622939,"ip_address":"","comment_id":53220,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545617267","product_id":100020801,"comment_content":"老师，在工作中遇到过这么一个问题，方式一个创建时间的字段created，类型是datetime的，我们当时就用created  &gt;’2018-08-08 12:23’这种形式去取数据，开始的时候是没问题的，但是一跨年之后就出现问题，数据完全取不出来，当时我们是转成时间戳去解决了这个问题，但是为什么会出现这种问题还是有点不明白，希望老师能解答一下","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434071,"discussion_content":"额 你这么描述我也复现不出来。\n\n有复现方法吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545622939,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53180,"user_name":"undifined","can_delete":false,"product_type":"c1","uid":1068920,"ip_address":"","ucode":"449CB4CD2DC089","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/78/c3d8ecb0.jpg","comment_is_top":false,"comment_ctime":1545614053,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1545614053","product_id":100020801,"comment_content":"1. select * from tradelog where id=&quot;83126&quot;; 不会全表扫描，因为会先将 &quot;83126&quot;转换成整数，并不会影响到索引<br>2.查询 id=2 的交易的所有操作步骤信息的 SQL <br>select d.* from tradelog l, trade_detail d where d.tradeid=l.tradeid and l.id=2; <br>改成子查询<br>SELECT * FROM trade_detail WHERE tradeid = (SELECT tradeid FROM tradelog WHERE id = 2);<br>可以避免编码转换的问题，请问老师子查询和原来的查询效率会有差别吗<br><br>3.遇到过一个类型转换的问题: order 表的 status 字段是int 类型的，但是传入的参数是字符串：<br>select * from order where status = &#39;s&#39;; 这里查到了 status 为 0 的数据，我的理解是对 &#39;s&#39;做了隐式类型转换，但是转换的过程没有匹配 &#39;s&#39;的数值，所以使用了默认值 0，老师这样理解对吗<br>4. select * 和 select 所有字段的差别是什么，会有效率问题吗，麻烦老师帮忙解答一下，谢谢老师","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":161093,"discussion_content":"3,可以这么理解。\n4,应该是一样的吧。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580868057,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53178,"user_name":"小文","can_delete":false,"product_type":"c1","uid":1198258,"ip_address":"","ucode":"4D6257B8D63FA4","user_header":"https://static001.geekbang.org/account/avatar/00/12/48/b2/cca85581.jpg","comment_is_top":false,"comment_ctime":1545614024,"is_pvip":false,"replies":[{"id":"19311","content":"把你的sql_mode这个参数show 出来看看😄","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545639417,"ip_address":"","comment_id":53178,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545614024","product_id":100020801,"comment_content":"如果tradeid是字符串类型，where tradeid=110717不是直接就报错了么⊙∀⊙！","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434057,"discussion_content":"把你的sql_mode这个参数show 出来看看😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545639417,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53165,"user_name":"asdf100","can_delete":false,"product_type":"c1","uid":1043738,"ip_address":"","ucode":"39D8D71453E575","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ed/1a/ce7f7d54.jpg","comment_is_top":false,"comment_ctime":1545613286,"is_pvip":false,"replies":[{"id":"19281","content":"嗯嗯。改成datetime了","user_name":"作者回复","user_name_real":"林晓斌","uid":"1264162","ctime":1545622858,"ip_address":"","comment_id":53165,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545613286","product_id":100020801,"comment_content":"t_modified 是 time类型可以使用 month函数求出来月份？","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"林晓斌","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434053,"discussion_content":"嗯嗯。改成datetime了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545622858,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53116,"user_name":"慧鑫coming","can_delete":false,"product_type":"c1","uid":1324385,"ip_address":"","ucode":"7BAC9CA255630E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLE4LYb3jrH63ZV98Zpc8DompwDgb1O3nffMoZCmiaibauRyEFv6NDNsST9RWxZExvMLMWb50zaanoQ/132","comment_is_top":false,"comment_ctime":1545607530,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545607530","product_id":100020801,"comment_content":"意犹未尽","like_count":0},{"had_liked":false,"id":53112,"user_name":"尘封","can_delete":false,"product_type":"c1","uid":1247006,"ip_address":"","ucode":"CEE0C006387A03","user_header":"https://static001.geekbang.org/account/avatar/00/13/07/1e/bdbe93f4.jpg","comment_is_top":false,"comment_ctime":1545604638,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1545604638","product_id":100020801,"comment_content":"老师，多表关联时，执行计划里的id是否有规律可寻？比如id相同的是从上到下执行？id不同的是从小到大执行。","like_count":0,"discussions":[{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":161098,"discussion_content":"ID还可以相同么？ID一般是主键。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580868153,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}