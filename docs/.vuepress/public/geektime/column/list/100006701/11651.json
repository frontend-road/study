{"id":11651,"title":"第33讲 | 后台服务出现明显“变慢”，谈谈你的诊断思路？","content":"<p>在日常工作中，应用或者系统出现性能问题往往是不可避免的，除了在有一定规模的IT企业或者专注于特定性能领域的企业，可能大多数工程师并不会成为专职的性能工程师，但是掌握基本的性能知识和技能，往往是日常工作的需要，并且也是工程师进阶的必要条件之一，能否定位和解决性能问题也是对你知识、技能和能力的检验。</p>\n<p>今天我要问你的问题是，<span class=\"orange\">后台服务出现明显“变慢”，谈谈你的诊断思路？</span></p>\n<h2>典型回答</h2>\n<p>首先，需要对这个问题进行更加清晰的定义:</p>\n<ul>\n<li>\n<p>服务是突然变慢还是长时间运行后观察到变慢？类似问题是否重复出现？</p>\n</li>\n<li>\n<p>“慢”的定义是什么，我能够理解是系统对其他方面的请求的反应延时变长吗?</p>\n</li>\n</ul>\n<p>第二，理清问题的症状，这更便于定位具体的原因，有以下一些思路：</p>\n<ul>\n<li>\n<p>问题可能来自于Java服务自身，也可能仅仅是受系统里其他服务的影响。初始判断可以先确认是否出现了意外的程序错误，例如检查应用本身的错误日志。<br />\n对于分布式系统，很多公司都会实现更加系统的日志、性能等监控系统。一些Java诊断工具也可以用于这个诊断，例如通过JFR（<a href=\"https://docs.oracle.com/javacomponents/jmc-5-4/jfr-runtime-guide/about.htm#JFRUH173\">Java Flight Recorder</<!-- [[[read_end]]] -->a>），监控应用是否大量出现了某种类型的异常。<br />\n如果有，那么异常可能就是个突破点。<br />\n如果没有，可以先检查系统级别的资源等情况，监控CPU、内存等资源是否被其他进程大量占用，并且这种占用是否不符合系统正常运行状况。</p>\n</li>\n<li>\n<p>监控Java服务自身，例如GC日志里面是否观察到Full GC等恶劣情况出现，或者是否Minor GC在变长等；利用jstat等工具，获取内存使用的统计信息也是个常用手段；利用jstack等工具检查是否出现死锁等。</p>\n</li>\n<li>\n<p>如果还不能确定具体问题，对应用进行Profiling也是个办法，但因为它会对系统产生侵入性，如果不是非常必要，大多数情况下并不建议在生产系统进行。</p>\n</li>\n<li>\n<p>定位了程序错误或者JVM配置的问题后，就可以采取相应的补救措施，然后验证是否解决，否则还需要重复上面部分过程。</p>\n</li>\n</ul>\n<h2>考点分析</h2>\n<p>今天我选择的是一个常见的并且比较贴近实际应用的的性能相关问题，我提供的回答包括两部分。</p>\n<ul>\n<li>\n<p>在正面回答之前，先探讨更加精确的问题定义是什么。有时候面试官并没有表达清楚，有必要确认自己的理解正确，然后再深入回答。</p>\n</li>\n<li>\n<p>从系统、应用的不同角度、不同层次，逐步将问题域尽量缩小，隔离出真实原因。具体步骤未必千篇一律，在处理过较多这种问题之后，经验会令你的直觉分外敏感。</p>\n</li>\n</ul>\n<p>大多数工程师也许并没有全面的性能问题诊断机会，如果被问到也不必过于紧张，你可以向面试官展示诊断问题的思考方式，展现自己的知识和综合运用的能力。接触到一个陌生的问题，通过沟通，能够条理清晰地将排查方案逐步确定下来，也是能力的体现。</p>\n<p>面试官可能会针对某个角度的诊断深入询问，兼顾工作和面试的需求，我会针对下面一些方面进行介绍。目的是让你对性能分析有个整体的印象，在遇到特定领域问题时，即使不知道具体细节的工具和手段，至少也可以找到探索、查询的方向。</p>\n<ul>\n<li>\n<p>我将介绍业界常见的性能分析方法论。</p>\n</li>\n<li>\n<p>从系统分析到JVM、应用性能分析，把握整体思路和主要工具。对于线程状态、JVM内存使用等很多方面，我在专栏前面已经陆陆续续介绍了很多，今天这一讲也可以看作是聚焦性能角度的一个小结。</p>\n</li>\n</ul>\n<p>如果你有兴趣进行系统性的学习，我建议参考Charlie Hunt编撰的《Java Performance》或者Scott Oaks的《Java Performance：The Definitive Guide》。另外，如果不希望出现理解偏差，最好是阅读英文版。</p>\n<h2>知识扩展</h2>\n<p>首先，我们来了解一下业界最广泛的性能分析方法论。</p>\n<p>根据系统架构不同，分布式系统和大型单体应用也存在着思路的区别，例如，分布式系统的性能瓶颈可能更加集中。传统意义上的性能调优大多是针对单体应用的调优，专栏的侧重点也是如此，Charlie Hunt曾将其方法论总结为两类：</p>\n<ul>\n<li>\n<p>自上而下。从应用的顶层，逐步深入到具体的不同模块，或者更近一步的技术细节单元，找到可能的问题和解决办法。这是最常见的性能分析思路，也是大多数工程师的选择。</p>\n</li>\n<li>\n<p>自下而上。从类似CPU这种硬件底层，判断类似<a href=\"https://en.wikipedia.org/wiki/CPU_cache#Cache_miss\">Cache-Miss</a>之类的问题和调优机会，出发点是指令级别优化。这往往是专业的性能工程师才能掌握的技能，并且需要专业工具配合，大多数是移植到新的平台上，或需要提供极致性能时才会进行。</p>\n</li>\n</ul>\n<p>例如，将大数据应用移植到SPARC体系结构的硬件上，需要对比和尽量释放性能潜力，但又希望尽量不改源代码。</p>\n<p>我所给出的回答，首先是试图排除功能性错误，然后就是典型的自上而下分析思路。</p>\n<p>第二，我们一起来看看自上而下分析中，各个阶段的常见工具和思路。需要注意的是，具体的工具在不同的操作系统上可能区别非常大。</p>\n<p><strong>系统性能分析</strong>中，CPU、内存和IO是主要关注项。</p>\n<p>对于CPU，如果是常见的Linux，可以先用top命令查看负载状况，下图是我截取的一个状态。<br />\n<img src=\"https://static001.geekbang.org/resource/image/3b/01/3b927b63bec67f99e8dd72860a292601.png?wh=645*150\" alt=\"\" /></p>\n<p>可以看到，其平均负载（load average）的三个值（分别是1分钟、5分钟、15分钟）非常低，并且暂时看并没有升高迹象。如果这些数值非常高（例如，超过50%、60%），并且短期平均值高于长期平均值，则表明负载很重；如果还有升高的趋势，那么就要非常警惕了。</p>\n<p>进一步的排查有很多思路，例如，我在专栏第18讲曾经问过，怎么找到最耗费CPU的Java线程，简要介绍步骤：</p>\n<ul>\n<li>利用top命令获取相应pid，“-H”代表thread模式，你可以配合grep命令更精准定位。</li>\n</ul>\n<pre><code>top –H\n</code></pre>\n<ul>\n<li>然后转换成为16进制。</li>\n</ul>\n<pre><code>printf &quot;%x&quot; your_pid\n</code></pre>\n<ul>\n<li>最后利用jstack获取的线程栈，对比相应的ID即可。</li>\n</ul>\n<p>当然，还有更加通用的诊断方向，利用vmstat之类，查看上下文切换的数量，比如下面就是指定时间间隔为1，收集10次。</p>\n<pre><code>vmstat -1 -10\n</code></pre>\n<p>输出如下：<br />\n<img src=\"https://static001.geekbang.org/resource/image/ab/a0/abd28cb4a771365211e1a01d628213a0.png?wh=657*162\" alt=\"\" /></p>\n<p>如果每秒上下文（cs，<a href=\"https://en.wikipedia.org/wiki/Context_switch\">context switch</a>）切换很高，并且比系统中断高很多（in，system <a href=\"https://en.wikipedia.org/wiki/Interrupt\"></a> <a href=\"https://en.wikipedia.org/wiki/Interrupt\">interrupt</a>），就表明很有可能是因为不合理的多线程调度所导致。当然还需要利用<a href=\"https://linux.die.net/man/1/pidstat\">pidstat</a>等手段，进行更加具体的定位，我就不再进一步展开了。</p>\n<p>除了CPU，内存和IO是重要的注意事项，比如：</p>\n<ul>\n<li>\n<p>利用free之类查看内存使用。</p>\n</li>\n<li>\n<p>或者，进一步判断swap使用情况，top命令输出中Virt作为虚拟内存使用量，就是物理内存（Res）和swap求和，所以可以反推swap使用。显然，JVM是不希望发生大量的swap使用的。</p>\n</li>\n<li>\n<p>对于IO问题，既可能发生在磁盘IO，也可能是网络IO。例如，利用iostat等命令有助于判断磁盘的健康状况。我曾经帮助诊断过Java服务部署在国内的某云厂商机器上，其原因就是IO表现较差，拖累了整体性能，解决办法就是申请替换了机器。</p>\n</li>\n</ul>\n<p>讲到这里，如果你对系统性能非常感兴趣，我建议参考<a href=\"http://www.brendangregg.com/linuxperf.html\">Brendan Gregg</a>提供的完整图谱，我所介绍的只能算是九牛一毛。但我还是建议尽量结合实际需求，免得迷失在其中。<br />\n<img src=\"https://static001.geekbang.org/resource/image/93/40/93aa8c4516fd2266472ca4eab1b0cc40.png?wh=822*546\" alt=\"\" /></p>\n<p>对于<strong>JVM层面的性能分析</strong>，我们已经介绍过非常多了：</p>\n<ul>\n<li>\n<p>利用JMC、JConsole等工具进行运行时监控。</p>\n</li>\n<li>\n<p>利用各种工具，在运行时进行堆转储分析，或者获取各种角度的统计数据（如<a href=\"https://docs.oracle.com/javase/7/docs/technotes/tools/share/jstat.html\">jstat</a> -gcutil分析GC、内存分带等）。</p>\n</li>\n<li>\n<p>GC日志等手段，诊断Full GC、Minor GC，或者引用堆积等。</p>\n</li>\n</ul>\n<p>这里并不存在放之四海而皆准的办法，具体问题可能非常不同，还要看你是否能否充分利用这些工具，从种种迹象之中，逐步判断出问题所在。</p>\n<p>对于<strong>应用</strong><a href=\"https://en.wikipedia.org/wiki/Profiling_(computer_programming)\"><strong>Profiling</strong></a>，简单来说就是利用一些侵入性的手段，收集程序运行时的细节，以定位性能问题瓶颈。所谓的细节，就是例如内存的使用情况、最频繁调用的方法是什么，或者上下文切换的情况等。</p>\n<p>我在前面给出的典型回答里提到，一般不建议生产系统进行Profiling，大多数是在性能测试阶段进行。但是，当生产系统确实存在这种需求时，也不是没有选择。我建议使用JFR配合<a href=\"http://www.oracle.com/technetwork/java/javaseproducts/mission-control/java-mission-control-1998576.html\">JMC</a>来做Profiling，因为它是从Hotspot JVM内部收集底层信息，并经过了大量优化，性能开销非常低，通常是低于 <strong>2%</strong> 的；并且如此强大的工具，也已经被Oracle开源出来！</p>\n<p>所以，JFR/JMC完全具备了生产系统Profiling的能力，目前也确实在真正大规模部署的云产品上使用过相关技术，快速地定位了问题。</p>\n<p>它的使用也非常方便，你不需要重新启动系统或者提前增加配置。例如，你可以在运行时启动JFR记录，并将这段时间的信息写入文件：</p>\n<pre><code>Jcmd &lt;pid&gt; JFR.start duration=120s filename=myrecording.jfr\n</code></pre>\n<p>然后，使用JMC打开“.jfr文件”就可以进行分析了，方法、异常、线程、IO等应有尽有，其功能非常强大。如果你想了解更多细节，可以参考相关<a href=\"https://blog.takipi.com/oracle-java-mission-control-the-ultimate-guide/\">指南</a>。</p>\n<p>今天我从一个典型性能问题出发，从症状表现到具体的系统分析、JVM分析，系统性地整理了常见性能分析的思路；并且在知识扩展部分，从方法论和实际操作的角度，让你将理论和实际结合，相信一定可以对你有所帮助。</p>\n<h2>一课一练</h2>\n<p>关于今天我们讨论的题目你做到心中有数了吗？ 今天的思考题是，Profiling工具获取数据的主要方式有哪些？各有什么优缺点。</p>\n<p>请你在留言区写写你对这个问题的思考，我会选出经过认真思考的留言，送给你一份学习奖励礼券，欢迎你与我一起讨论。</p>\n<p>你的朋友是不是也在准备面试呢？你可以“请朋友读”，把今天的题目分享给好友，或许你能帮到他。</p>\n<p></p>\n","comments":[{"had_liked":false,"id":19613,"user_name":"江南白衣Calvin","can_delete":false,"product_type":"c1","uid":1178188,"ip_address":"","ucode":"5B0E375C7C9DFD","user_header":"https://static001.geekbang.org/account/avatar/00/11/fa/4c/3484fe23.jpg","comment_is_top":false,"comment_ctime":1533908066,"is_pvip":false,"replies":[{"id":"6848","content":"白衣出品必是精品","user_name":"作者回复","user_name_real":"杨晓峰","uid":"1009360","ctime":1533993837,"ip_address":"","comment_id":19613,"utype":1}],"discussion_count":4,"race_medal":0,"score":"796102857826","product_id":100006701,"comment_content":"找繁忙线程时，top -h , 再jstack， 再换算tid比较累，而且jstack会造成停顿。推荐用vjtools里的vjtop,  不断显示繁忙的javaj线程，不造成停顿。","like_count":186,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"杨晓峰","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":421918,"discussion_content":"白衣出品必是精品","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1533993837,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1597200,"avatar":"https://static001.geekbang.org/account/avatar/00/18/5f/10/ed332d5a.jpg","nickname":"warriorSL","note":"","ucode":"902DA345FD2623","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":353262,"discussion_content":"jstack 命令执行过程，是进行一次栈快照的过程，但是如果只是grep 某个线程，是不是不会造成停顿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615101928,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1243901,"avatar":"https://static001.geekbang.org/account/avatar/00/12/fa/fd/ec24cba7.jpg","nickname":"fcb的鱼","note":"","ucode":"88667EBF09CEC0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2773,"discussion_content":"jstack为啥会造成停顿呢？之前看jstack原理的时候没有看到这部分？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563930503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1001145,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/46/b9/e6b4a431.jpg","nickname":"都是弟弟","note":"","ucode":"BEAFD64167FD23","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1109,"discussion_content":"精品","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562318552,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":17021,"user_name":"杨东yy","can_delete":false,"product_type":"c1","uid":1125212,"ip_address":"","ucode":"2355344A5D6C01","user_header":"https://static001.geekbang.org/account/avatar/00/11/2b/5c/a00fef79.jpg","comment_is_top":false,"comment_ctime":1532391853,"is_pvip":false,"replies":[{"id":"5960","content":"很实用","user_name":"作者回复","user_name_real":"杨晓峰","uid":"1009360","ctime":1532446047,"ip_address":"","comment_id":17021,"utype":1}],"discussion_count":1,"race_medal":0,"score":"143266312621","product_id":100006701,"comment_content":"确实不错，还有个命令，sar,主要看iowait的值，如果它比较高，也说明磁盘io写入慢，当时我们的系统是虚拟机，和别的业务共用物理机，所以当别人并发大，也影响了我们，我们有切面写日志，系统日志写的比较多，就出现整个服务慢了，后来减少不必要的日志，找运维换机器","like_count":34,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"杨晓峰","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":421009,"discussion_content":"很实用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1532446047,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":17048,"user_name":"盼盼","can_delete":false,"product_type":"c1","uid":1173633,"ip_address":"","ucode":"D0E1E20FBF058E","user_header":"https://static001.geekbang.org/account/avatar/00/11/e8/81/0be4db59.jpg","comment_is_top":false,"comment_ctime":1532396718,"is_pvip":false,"replies":[{"id":"5958","content":"不错的总结","user_name":"作者回复","user_name_real":"杨晓峰","uid":"1009360","ctime":1532445803,"ip_address":"","comment_id":17048,"utype":1}],"discussion_count":1,"race_medal":0,"score":"117496513710","product_id":100006701,"comment_content":"profiling收集程序运行时信息的方式主要有以下三种：<br>事件方法：对于 Java，可以采用 JVMTI（JVM Tools Interface）API 来捕捉诸如方法调用、类载入、类卸载、进入 &#47; 离开线程等事件，然后基于这些事件进行程序行为的分析。<br>统计抽样方法（sampling）: 该方法每隔一段时间调用系统中断，然后收集当前的调用栈（call stack）信息，记录调用栈中出现的函数及这些函数的调用结构，基于这些信息得到函数的调用关系图及每个函数的 CPU 使用信息。由于调用栈的信息是每隔一段时间来获取的，因此不是非常精确的，但由于该方法对目标程序的干涉比较少，目标程序的运行速度几乎不受影响。<br>植入附加指令方法（BCI）: 该方法在目标程序中插入指令代码，这些指令代码将记录 profiling 所需的信息，包括运行时间、计数器的值等，从而给出一个较为精确的内存使用情况、函数调用关系及函数的 CPU 使用信息。该方法对程序执行速度会有一定的影响，因此给出的程序执行时间有可能不准确。但是该方法在统计程序的运行轨迹方面有一定的优势。","like_count":28,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"杨晓峰","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":421022,"discussion_content":"不错的总结","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1532445803,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":16716,"user_name":"Yano","can_delete":false,"product_type":"c1","uid":1028394,"ip_address":"","ucode":"742EA1602E9A52","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b1/2a/c1432fff.jpg","comment_is_top":false,"comment_ctime":1532135168,"is_pvip":false,"replies":[{"id":"6055","content":"恭喜，很高兴能体现出价值","user_name":"作者回复","user_name_real":"杨晓峰","uid":"1009360","ctime":1532680759,"ip_address":"","comment_id":16716,"utype":1}],"discussion_count":4,"race_medal":0,"score":"100316382976","product_id":100006701,"comment_content":"一直以来看老师的专栏没有留言过，今天特意来留言。我看了13讲（当时只出到13讲）面试就轻松通过了～老师每一篇文章，都让我非常收益，赞一个～！","like_count":24,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"杨晓峰","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420907,"discussion_content":"恭喜，很高兴能体现出价值","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1532680759,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1336475,"avatar":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","nickname":"J.Smile","note":"","ucode":"C4D98DFDBF7584","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":154053,"discussion_content":"那说明你还是个新手","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1580109741,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1344289,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLEYbNElGIxY6Le1rfiakWJecz8JIOp06Y9JQFR2YBn3T3gx3icI5CKxZNgxgqiaKbfVOicXquO3QBw9w/132","nickname":"july","note":"","ucode":"E081987929063A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1336475,"avatar":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","nickname":"J.Smile","note":"","ucode":"C4D98DFDBF7584","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":230712,"discussion_content":"就你皮，瞎说什么大实话？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586765831,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":154053,"ip_address":""},"score":230712,"extra":""},{"author":{"id":1336475,"avatar":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","nickname":"J.Smile","note":"","ucode":"C4D98DFDBF7584","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1344289,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLEYbNElGIxY6Le1rfiakWJecz8JIOp06Y9JQFR2YBn3T3gx3icI5CKxZNgxgqiaKbfVOicXquO3QBw9w/132","nickname":"july","note":"","ucode":"E081987929063A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":230895,"discussion_content":"😂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586779504,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":230712,"ip_address":""},"score":230895,"extra":""}]}]},{"had_liked":false,"id":19662,"user_name":"clz1341521","can_delete":false,"product_type":"c1","uid":1179557,"ip_address":"","ucode":"3BDB4AB454C918","user_header":"https://static001.geekbang.org/account/avatar/00/11/ff/a5/eccc7653.jpg","comment_is_top":false,"comment_ctime":1533950922,"is_pvip":false,"replies":[{"id":"6854","content":"谢谢，以前没有过，刚才查了一下，“dstat命令是一个用来替换vmstat、iostat、netstat、nfsstat和ifstat这些命令的工具，是一个全能系统信息统计工具” 回头试一下","user_name":"作者回复","user_name_real":"杨晓峰","uid":"1009360","ctime":1533994019,"ip_address":"","comment_id":19662,"utype":1}],"discussion_count":1,"race_medal":0,"score":"96023231434","product_id":100006701,"comment_content":"dstat这个命令也很有用","like_count":23,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"杨晓峰","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":421931,"discussion_content":"谢谢，以前没有过，刚才查了一下，“dstat命令是一个用来替换vmstat、iostat、netstat、nfsstat和ifstat这些命令的工具，是一个全能系统信息统计工具” 回头试一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1533994019,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":20513,"user_name":"有福","can_delete":false,"product_type":"c1","uid":1045377,"ip_address":"","ucode":"3DEAB5CEBE0F85","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f3/81/42e29d40.jpg","comment_is_top":false,"comment_ctime":1534501483,"is_pvip":false,"replies":[{"id":"7378","content":"确实是利器","user_name":"作者回复","user_name_real":"杨晓峰","uid":"1009360","ctime":1534858331,"ip_address":"","comment_id":20513,"utype":1}],"discussion_count":2,"race_medal":0,"score":"53074109035","product_id":100006701,"comment_content":"喜欢用火焰图来辅助定位","like_count":12,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"杨晓峰","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":422282,"discussion_content":"确实是利器","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1534858331,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1241064,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ef/e8/076a6f59.jpg","nickname":"张翀","note":"","ucode":"835A01424FDD5E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580434,"discussion_content":"请问火焰图具体如何使用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658186679,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":182876,"user_name":"张永峰","can_delete":false,"product_type":"c1","uid":1106891,"ip_address":"","ucode":"209823D8151A3D","user_header":"https://static001.geekbang.org/account/avatar/00/10/e3/cb/d13986f7.jpg","comment_is_top":false,"comment_ctime":1582881312,"is_pvip":true,"discussion_count":2,"race_medal":0,"score":"40237586976","product_id":100006701,"comment_content":"我都是一边看服务层，一边找DBA，80%都是DB慢SQL导致服务慢，经验之谈。","like_count":9,"discussions":[{"author":{"id":1066508,"avatar":"https://static001.geekbang.org/account/avatar/00/10/46/0c/773ba2f3.jpg","nickname":"下个目标45k","note":"","ucode":"193BA8C3AA9A61","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335869,"discussion_content":"的确是这样 , 绝大部分都是等io,除非代码中有循环","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608361222,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1002938,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4d/ba/83e6dcbf.jpg","nickname":"skyline","note":"","ucode":"4E73F9049751F6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":321321,"discussion_content":"哈哈，那些年一起跳过多次的坑","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604564482,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":87835,"user_name":"硅谷居士","can_delete":false,"product_type":"c1","uid":1018463,"ip_address":"","ucode":"BD3D3BA142F280","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8a/5f/c60d0ffe.jpg","comment_is_top":false,"comment_ctime":1555727364,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"31620498436","product_id":100006701,"comment_content":"阿里的 arthas 不错。淘宝也有一个 profiler。","like_count":7,"discussions":[{"author":{"id":1002938,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4d/ba/83e6dcbf.jpg","nickname":"skyline","note":"","ucode":"4E73F9049751F6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":321323,"discussion_content":"arthas还是挺好用的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604564633,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":16724,"user_name":"甲韭","can_delete":false,"product_type":"c1","uid":1052321,"ip_address":"","ucode":"2E998B8CB17F4E","user_header":"https://static001.geekbang.org/account/avatar/00/10/0e/a1/152a5de1.jpg","comment_is_top":false,"comment_ctime":1532137750,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"31596908822","product_id":100006701,"comment_content":"百度搜索 profiling是什么","like_count":7},{"had_liked":false,"id":229847,"user_name":"颇忒妥","can_delete":false,"product_type":"c1","uid":1026448,"ip_address":"","ucode":"AA86AD1049BC2E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a9/90/0c5ed3d9.jpg","comment_is_top":false,"comment_ctime":1593161990,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23067998470","product_id":100006701,"comment_content":"我们应用跑在K8S上，我一般是看thread dump和gc log 。thread dump可以通过jstack或者spring boot actuator可以得到（推荐这个办法），然后交给fastthread.io分析。gc log 则在jvm启动时增加参数，然后交给gceasy.io 分析。内存泄露则是jvm 启动时增加参数，如果oom则heap dump到某个目录，而这个目录用emptyDir 卷挂载。","like_count":6},{"had_liked":false,"id":168753,"user_name":"ub8","can_delete":false,"product_type":"c1","uid":1481811,"ip_address":"","ucode":"0D937C3EAEB781","user_header":"https://static001.geekbang.org/account/avatar/00/16/9c/53/ade0afb0.jpg","comment_is_top":false,"comment_ctime":1578150267,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14463052155","product_id":100006701,"comment_content":" Full GC ，Minor GC 频率是多少算是频繁呢？","like_count":3,"discussions":[{"author":{"id":1184658,"avatar":"https://static001.geekbang.org/account/avatar/00/12/13/92/0b4c8e30.jpg","nickname":"飞翔","note":"","ucode":"0641211EE9DA5C","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534727,"discussion_content":"我们系统里发生full gc会发P1报警，应该是尽量避免fullgc吧。。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638263479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":21789,"user_name":"大神仙","can_delete":false,"product_type":"c1","uid":1151944,"ip_address":"","ucode":"8179D170A97936","user_header":"https://static001.geekbang.org/account/avatar/00/11/93/c8/9eb6c644.jpg","comment_is_top":false,"comment_ctime":1535335156,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14420237044","product_id":100006701,"comment_content":"老师，minor gc变长的通常情况有哪些，除了young配置小以外，和系统io有关系么","like_count":3},{"had_liked":false,"id":49397,"user_name":"james.h.fu","can_delete":false,"product_type":"c1","uid":1330945,"ip_address":"","ucode":"B5773B8DCB1F7A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKib804LQiawZc7KHzerDF2B4zGvPByXKTVR1h6HibRlc8sQFAujIO3M02GicOg9Qia9ibBZlbmDyJcCKyQ/132","comment_is_top":false,"comment_ctime":1544680459,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5839647755","product_id":100006701,"comment_content":"老师，我感觉很需要高质量的面向对象分析和设计。看代码的时候，总感觉有些地方OO写不好。","like_count":1},{"had_liked":false,"id":16727,"user_name":"One day","can_delete":false,"product_type":"c1","uid":1126868,"ip_address":"","ucode":"F71F465ABB3A6A","user_header":"https://static001.geekbang.org/account/avatar/00/11/31/d4/3dcddc04.jpg","comment_is_top":false,"comment_ctime":1532139355,"is_pvip":false,"replies":[{"id":"6054","content":"有，仅仅能做个抛砖引玉，范围太大专栏就不伦不类了","user_name":"作者回复","user_name_real":"杨晓峰","uid":"1009360","ctime":1532680695,"ip_address":"","comment_id":16727,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5827106651","product_id":100006701,"comment_content":"之前看到目录上还有讲spring和数据库等等，后面还会讲吧！","like_count":1,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"杨晓峰","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420911,"discussion_content":"有，仅仅能做个抛砖引玉，范围太大专栏就不伦不类了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1532680695,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":342234,"user_name":"David","can_delete":false,"product_type":"c1","uid":1021825,"ip_address":"","ucode":"22CBBC13FC97A9","user_header":"https://static001.geekbang.org/account/avatar/00/0f/97/81/e1eaf621.jpg","comment_is_top":false,"comment_ctime":1650118887,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1650118887","product_id":100006701,"comment_content":"找繁忙线程时，top -h , 再jstack， 再换算tid比较累，而且jstack会造成停顿。推荐用vjtools里的vjtop,  不断显示繁忙的javaj线程，不造成停顿。","like_count":0,"discussions":[{"author":{"id":2238635,"avatar":"https://static001.geekbang.org/account/avatar/00/22/28/ab/b8905658.jpg","nickname":"AsYouWish99","note":"","ucode":"A5CE38DAD56115","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577867,"discussion_content":"找繁忙线程时，top -h , 再jstack， 再换算tid比较累，而且jstack会造成停顿。推荐用vjtools里的vjtop,  不断显示繁忙的javaj线程，不造成停顿。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656398228,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":206118,"user_name":"阳春面","can_delete":false,"product_type":"c1","uid":1693492,"ip_address":"","ucode":"27493CAD3D7EF3","user_header":"https://static001.geekbang.org/account/avatar/00/19/d7/34/b67c74b8.jpg","comment_is_top":false,"comment_ctime":1586789511,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"1586789511","product_id":100006701,"comment_content":"老师，请问下服务器负载高但cpu使用率低可能是什么原因","like_count":0,"discussions":[{"author":{"id":1014649,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7b/79/df384bdc.jpg","nickname":"修愿三秋","note":"","ucode":"0AEE445D8DBFF4","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":292893,"discussion_content":"看看iowait","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1595380432,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2063962,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/7e/5a/da39f489.jpg","nickname":"Ethan New","note":"","ucode":"9CA2EF39E58030","race_medal":4,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388243,"discussion_content":"应该是IO的问题，看看IO的指标","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628665660,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1718746,"avatar":"","nickname":"林新潜","note":"","ucode":"386EA326AD1009","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":356322,"discussion_content":"并发高，存在阻塞","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615561557,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}