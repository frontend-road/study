{"id":234928,"title":"25 | å¼‚æ­¥å¤„ç†å¥½ç”¨ï¼Œä½†éå¸¸å®¹æ˜“ç”¨é”™","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æœ±æ™”ã€‚ä»Šå¤©ï¼Œæˆ‘æ¥å’Œä½ èŠèŠå¥½ç”¨ä½†å®¹æ˜“å‡ºé”™çš„å¼‚æ­¥å¤„ç†ã€‚</p><p>å¼‚æ­¥å¤„ç†æ˜¯äº’è”ç½‘åº”ç”¨ä¸å¯æˆ–ç¼ºçš„ä¸€ç§æ¶æ„æ¨¡å¼ï¼Œå¤§å¤šæ•°ä¸šåŠ¡é¡¹ç›®éƒ½æ˜¯ç”±åŒæ­¥å¤„ç†ã€å¼‚æ­¥å¤„ç†å’Œå®šæ—¶ä»»åŠ¡å¤„ç†ä¸‰ç§æ¨¡å¼ç›¸è¾…ç›¸æˆå®ç°çš„ã€‚</p><p>åŒºåˆ«äºåŒæ­¥å¤„ç†ï¼Œå¼‚æ­¥å¤„ç†æ— éœ€åŒæ­¥ç­‰å¾…æµç¨‹å¤„ç†å®Œæ¯•ï¼Œå› æ­¤é€‚ç”¨åœºæ™¯ä¸»è¦åŒ…æ‹¬ï¼š</p><ul>\n<li>æœåŠ¡äºä¸»æµç¨‹çš„åˆ†æ”¯æµç¨‹ã€‚æ¯”å¦‚ï¼Œåœ¨æ³¨å†Œæµç¨‹ä¸­ï¼ŒæŠŠæ•°æ®å†™å…¥æ•°æ®åº“çš„æ“ä½œæ˜¯ä¸»æµç¨‹ï¼Œä½†æ³¨å†Œåç»™ç”¨æˆ·å‘ä¼˜æƒ åˆ¸æˆ–æ¬¢è¿çŸ­ä¿¡çš„æ“ä½œæ˜¯åˆ†æ”¯æµç¨‹ï¼Œæ—¶æ•ˆæ€§ä¸é‚£ä¹ˆå¼ºï¼Œå¯ä»¥è¿›è¡Œå¼‚æ­¥å¤„ç†ã€‚</li>\n<li>ç”¨æˆ·ä¸éœ€è¦å®æ—¶çœ‹åˆ°ç»“æœçš„æµç¨‹ã€‚æ¯”å¦‚ï¼Œä¸‹å•åçš„é…è´§ã€é€è´§æµç¨‹å®Œå…¨å¯ä»¥è¿›è¡Œå¼‚æ­¥å¤„ç†ï¼Œæ¯ä¸ªé˜¶æ®µå¤„ç†å®Œæˆåï¼Œå†ç»™ç”¨æˆ·å‘æ¨é€æˆ–çŸ­ä¿¡è®©ç”¨æˆ·çŸ¥æ™“å³å¯ã€‚</li>\n</ul><p>åŒæ—¶ï¼Œå¼‚æ­¥å¤„ç†å› ä¸ºå¯ä»¥æœ‰MQä¸­é—´ä»¶çš„ä»‹å…¥ç”¨äºä»»åŠ¡çš„ç¼“å†²çš„åˆ†å‘ï¼Œæ‰€ä»¥ç›¸æ¯”äºåŒæ­¥å¤„ç†ï¼Œåœ¨åº”å¯¹æµé‡æ´ªå³°ã€å®ç°æ¨¡å—è§£è€¦å’Œæ¶ˆæ¯å¹¿æ’­æ–¹é¢æœ‰åŠŸèƒ½ä¼˜åŠ¿ã€‚</p><p>ä¸è¿‡ï¼Œå¼‚æ­¥å¤„ç†è™½ç„¶å¥½ç”¨ï¼Œä½†åœ¨å®ç°çš„æ—¶å€™å´æœ‰ä¸‰ä¸ªæœ€å®¹æ˜“çŠ¯çš„é”™ï¼Œåˆ†åˆ«æ˜¯å¼‚æ­¥å¤„ç†æµç¨‹çš„å¯é æ€§é—®é¢˜ã€æ¶ˆæ¯å‘é€æ¨¡å¼çš„åŒºåˆ†é—®é¢˜ï¼Œä»¥åŠå¤§é‡æ­»ä¿¡æ¶ˆæ¯å µå¡é˜Ÿåˆ—çš„é—®é¢˜ã€‚ä»Šå¤©ï¼Œæˆ‘å°±ç”¨ä¸‰ä¸ªä»£ç æ¡ˆä¾‹ç»“åˆç›®å‰å¸¸ç”¨çš„MQç³»ç»ŸRabbitMQï¼Œæ¥å’Œä½ å…·ä½“èŠèŠã€‚</p><p>ä»Šå¤©è¿™ä¸€è®²çš„æ¼”ç¤ºï¼Œæˆ‘éƒ½ä¼šä½¿ç”¨Spring AMQPæ¥æ“ä½œRabbitMQï¼Œæ‰€ä»¥ä½ éœ€è¦å…ˆå¼•å…¥amqpä¾èµ–ï¼š</p><!-- [[[read_end]]] --><pre><code>&lt;dependency&gt;\n    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;\n    &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;\n&lt;/dependency&gt;\n</code></pre><h2>å¼‚æ­¥å¤„ç†éœ€è¦æ¶ˆæ¯è¡¥å¿é—­ç¯</h2><p>ä½¿ç”¨ç±»ä¼¼RabbitMQã€RocketMQç­‰MQç³»ç»Ÿæ¥åšæ¶ˆæ¯é˜Ÿåˆ—å®ç°å¼‚æ­¥å¤„ç†ï¼Œè™½ç„¶è¯´æ¶ˆæ¯å¯ä»¥è½åœ°åˆ°ç£ç›˜ä¿å­˜ï¼Œå³ä½¿MQå‡ºç°é—®é¢˜æ¶ˆæ¯æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ï¼Œä½†æ˜¯å¼‚æ­¥æµç¨‹åœ¨æ¶ˆæ¯å‘é€ã€ä¼ è¾“ã€å¤„ç†ç­‰ç¯èŠ‚ï¼Œéƒ½å¯èƒ½å‘ç”Ÿæ¶ˆæ¯ä¸¢å¤±ã€‚æ­¤å¤–ï¼Œä»»ä½•MQä¸­é—´ä»¶éƒ½æ— æ³•ç¡®ä¿100%å¯ç”¨ï¼Œéœ€è¦è€ƒè™‘ä¸å¯ç”¨æ—¶å¼‚æ­¥æµç¨‹å¦‚ä½•ç»§ç»­è¿›è¡Œã€‚</p><p>å› æ­¤ï¼Œ<strong>å¯¹äºå¼‚æ­¥å¤„ç†æµç¨‹ï¼Œå¿…é¡»è€ƒè™‘è¡¥å¿æˆ–è€…è¯´å»ºç«‹ä¸»å¤‡åŒæ´»æµç¨‹</strong>ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç”¨æˆ·æ³¨å†Œåå¼‚æ­¥å‘é€æ¬¢è¿æ¶ˆæ¯çš„åœºæ™¯ã€‚ç”¨æˆ·æ³¨å†Œè½æ•°æ®åº“çš„æµç¨‹ä¸ºåŒæ­¥æµç¨‹ï¼Œä¼šå‘˜æœåŠ¡æ”¶åˆ°æ¶ˆæ¯åå‘é€æ¬¢è¿æ¶ˆæ¯çš„æµç¨‹ä¸ºå¼‚æ­¥æµç¨‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/62/93/629d9f0557cd7f06ac9ee2e871524893.png?wh=1596*836\" alt=\"\"></p><p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ï¼š</p><ul>\n<li>è“è‰²çš„çº¿ï¼Œä½¿ç”¨MQè¿›è¡Œçš„å¼‚æ­¥å¤„ç†ï¼Œæˆ‘ä»¬ç§°ä½œä¸»çº¿ï¼Œå¯èƒ½å­˜åœ¨æ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µï¼ˆè™šçº¿ä»£è¡¨å¼‚æ­¥è°ƒç”¨ï¼‰ï¼›</li>\n<li>ç»¿è‰²çš„çº¿ï¼Œä½¿ç”¨è¡¥å¿Jobå®šæœŸè¿›è¡Œæ¶ˆæ¯è¡¥å¿ï¼Œæˆ‘ä»¬ç§°ä½œå¤‡çº¿ï¼Œç”¨æ¥è¡¥å¿ä¸»çº¿ä¸¢å¤±çš„æ¶ˆæ¯ï¼›</li>\n<li>è€ƒè™‘åˆ°æç«¯çš„MQä¸­é—´ä»¶å¤±æ•ˆçš„æƒ…å†µï¼Œæˆ‘ä»¬è¦æ±‚å¤‡çº¿çš„å¤„ç†ååèƒ½åŠ›è¾¾åˆ°ä¸»çº¿çš„èƒ½åŠ›æ°´å¹³ã€‚</li>\n</ul><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ç›¸å…³çš„å®ç°ä»£ç ã€‚</p><p>é¦–å…ˆï¼Œå®šä¹‰UserControllerç”¨äºæ³¨å†Œ+å‘é€å¼‚æ­¥æ¶ˆæ¯ã€‚å¯¹äºæ³¨å†Œæ–¹æ³•ï¼Œæˆ‘ä»¬ä¸€æ¬¡æ€§æ³¨å†Œ10ä¸ªç”¨æˆ·ï¼Œç”¨æˆ·æ³¨å†Œæ¶ˆæ¯ä¸èƒ½å‘é€å‡ºå»çš„æ¦‚ç‡ä¸º50%ã€‚</p><pre><code>@RestController\n@Slf4j\n@RequestMapping(&quot;user&quot;)\npublic class UserController {\n    @Autowired\n    private UserService userService;\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @GetMapping(&quot;register&quot;)\n    public void register() {\n        //æ¨¡æ‹Ÿ10ä¸ªç”¨æˆ·æ³¨å†Œ\n        IntStream.rangeClosed(1, 10).forEach(i -&gt; {\n            //è½åº“\n            User user = userService.register();\n            //æ¨¡æ‹Ÿ50%çš„æ¶ˆæ¯å¯èƒ½å‘é€å¤±è´¥\n            if (ThreadLocalRandom.current().nextInt(10) % 2 == 0) {\n                //é€šè¿‡RabbitMQå‘é€æ¶ˆæ¯\n               rabbitTemplate.convertAndSend(RabbitConfiguration.EXCHANGE, RabbitConfiguration.ROUTING_KEY, user);\n                log.info(&quot;sent mq user {}&quot;, user.getId());\n            }\n        });\n    }\n}\n</code></pre><p>ç„¶åï¼Œå®šä¹‰MemberServiceç±»ç”¨äºæ¨¡æ‹Ÿä¼šå‘˜æœåŠ¡ã€‚ä¼šå‘˜æœåŠ¡ç›‘å¬ç”¨æˆ·æ³¨å†ŒæˆåŠŸçš„æ¶ˆæ¯ï¼Œå¹¶å‘é€æ¬¢è¿çŸ­ä¿¡ã€‚æˆ‘ä»¬ä½¿ç”¨ConcurrentHashMapæ¥å­˜æ”¾é‚£äº›å‘è¿‡çŸ­ä¿¡çš„ç”¨æˆ·IDå®ç°å¹‚ç­‰ï¼Œé¿å…ç›¸åŒçš„ç”¨æˆ·è¿›è¡Œè¡¥å¿æ—¶é‡å¤å‘é€çŸ­ä¿¡ï¼š</p><pre><code>@Component\n@Slf4j\npublic class MemberService {\n    //å‘é€æ¬¢è¿æ¶ˆæ¯çš„çŠ¶æ€\n    private Map&lt;Long, Boolean&gt; welcomeStatus = new ConcurrentHashMap&lt;&gt;();\n    //ç›‘å¬ç”¨æˆ·æ³¨å†ŒæˆåŠŸçš„æ¶ˆæ¯ï¼Œå‘é€æ¬¢è¿æ¶ˆæ¯\n    @RabbitListener(queues = RabbitConfiguration.QUEUE)\n    public void listen(User user) {\n        log.info(&quot;receive mq user {}&quot;, user.getId());\n        welcome(user);\n    }\n    //å‘é€æ¬¢è¿æ¶ˆæ¯\n    public void welcome(User user) {\n        //å»é‡æ“ä½œ\n        if (welcomeStatus.putIfAbsent(user.getId(), true) == null) {\n            try {\n                TimeUnit.SECONDS.sleep(2);\n            } catch (InterruptedException e) {\n            }\n            log.info(&quot;memberService: welcome new user {}&quot;, user.getId());\n        }\n    }\n}\n</code></pre><p>å¯¹äºMQæ¶ˆè´¹ç¨‹åºï¼Œå¤„ç†é€»è¾‘åŠ¡å¿…è€ƒè™‘å»é‡ï¼ˆæ”¯æŒå¹‚ç­‰ï¼‰ï¼ŒåŸå› æœ‰å‡ ä¸ªï¼š</p><ul>\n<li>MQæ¶ˆæ¯å¯èƒ½ä¼šå› ä¸ºä¸­é—´ä»¶æœ¬èº«é…ç½®é”™è¯¯ã€ç¨³å®šæ€§ç­‰åŸå› å‡ºç°é‡å¤ã€‚</li>\n<li>è‡ªåŠ¨è¡¥å¿é‡å¤ï¼Œæ¯”å¦‚æœ¬ä¾‹ï¼ŒåŒä¸€æ¡æ¶ˆæ¯å¯èƒ½æ—¢èµ°MQä¹Ÿèµ°è¡¥å¿ï¼Œè‚¯å®šä¼šå‡ºç°é‡å¤ï¼Œè€Œä¸”è€ƒè™‘åˆ°é«˜å†…èšï¼Œè¡¥å¿Jobæœ¬èº«ä¸ä¼šåšå»é‡å¤„ç†ã€‚</li>\n<li>äººå·¥è¡¥å¿é‡å¤ã€‚å‡ºç°æ¶ˆæ¯å †ç§¯æ—¶ï¼Œå¼‚æ­¥å¤„ç†æµç¨‹å¿…ç„¶ä¼šå»¶è¿Ÿã€‚å¦‚æœæˆ‘ä»¬æä¾›äº†é€šè¿‡åå°è¿›è¡Œè¡¥å¿çš„åŠŸèƒ½ï¼Œé‚£ä¹ˆåœ¨å¤„ç†é‡åˆ°å»¶è¿Ÿçš„æ—¶å€™ï¼Œå¾ˆå¯èƒ½ä¼šå…ˆè¿›è¡Œäººå·¥è¡¥å¿ï¼Œè¿‡äº†ä¸€æ®µæ—¶é—´åå¤„ç†ç¨‹åºåˆæ”¶åˆ°æ¶ˆæ¯äº†ï¼Œé‡å¤å¤„ç†ã€‚æˆ‘ä¹‹å‰å°±é‡åˆ°è¿‡ä¸€æ¬¡ç”±MQæ•…éšœå¼•å‘çš„äº‹æ•…ï¼ŒMQä¸­å †ç§¯äº†å‡ åä¸‡æ¡å‘æ”¾èµ„é‡‘çš„æ¶ˆæ¯ï¼Œå¯¼è‡´ä¸šåŠ¡æ— æ³•åŠæ—¶å¤„ç†ï¼Œè¿è¥ä»¥ä¸ºç¨‹åºå‡ºé”™äº†å°±å…ˆé€šè¿‡åå°è¿›è¡Œäº†äººå·¥å¤„ç†ï¼Œç»“æœMQç³»ç»Ÿæ¢å¤åæ¶ˆæ¯åˆè¢«é‡å¤å¤„ç†äº†ä¸€æ¬¡ï¼Œé€ æˆå¤§é‡èµ„é‡‘é‡å¤å‘æ”¾ã€‚</li>\n</ul><p>æ¥ä¸‹æ¥ï¼Œå®šä¹‰è¡¥å¿Jobä¹Ÿå°±æ˜¯å¤‡çº¿æ“ä½œã€‚</p><p>æˆ‘ä»¬åœ¨CompensationJobä¸­å®šä¹‰ä¸€ä¸ª@Scheduledå®šæ—¶ä»»åŠ¡ï¼Œ5ç§’åšä¸€æ¬¡è¡¥å¿æ“ä½œï¼Œå› ä¸ºJobå¹¶ä¸çŸ¥é“å“ªäº›ç”¨æˆ·æ³¨å†Œçš„æ¶ˆæ¯å¯èƒ½ä¸¢å¤±ï¼Œæ‰€ä»¥æ˜¯å…¨é‡è¡¥å¿ï¼Œè¡¥å¿é€»è¾‘æ˜¯ï¼šæ¯5ç§’è¡¥å¿ä¸€æ¬¡ï¼ŒæŒ‰é¡ºåºä¸€æ¬¡è¡¥å¿5ä¸ªç”¨æˆ·ï¼Œä¸‹ä¸€æ¬¡è¡¥å¿æ“ä½œä»ä¸Šä¸€æ¬¡è¡¥å¿çš„æœ€åä¸€ä¸ªç”¨æˆ·IDå¼€å§‹ï¼›å¯¹äºè¡¥å¿ä»»åŠ¡æˆ‘ä»¬æäº¤åˆ°çº¿ç¨‹æ± è¿›è¡Œâ€œå¼‚æ­¥â€å¤„ç†ï¼Œæé«˜å¤„ç†èƒ½åŠ›ã€‚</p><pre><code>@Component\n@Slf4j\npublic class CompensationJob {\n    //è¡¥å¿Jobå¼‚æ­¥å¤„ç†çº¿ç¨‹æ± \n    private static ThreadPoolExecutor compensationThreadPool = new ThreadPoolExecutor(\n            10, 10,\n            1, TimeUnit.HOURS,\n            new ArrayBlockingQueue&lt;&gt;(1000),\n            new ThreadFactoryBuilder().setNameFormat(&quot;compensation-threadpool-%d&quot;).get());\n    @Autowired\n    private UserService userService;\n    @Autowired\n    private MemberService memberService;\n    //ç›®å‰è¡¥å¿åˆ°å“ªä¸ªç”¨æˆ·ID\n    private long offset = 0;\n\n    //10ç§’åå¼€å§‹è¡¥å¿ï¼Œ5ç§’è¡¥å¿ä¸€æ¬¡\n    @Scheduled(initialDelay = 10_000, fixedRate = 5_000)\n    public void compensationJob() {\n        log.info(&quot;å¼€å§‹ä»ç”¨æˆ·ID {} è¡¥å¿&quot;, offset);\n        //è·å–ä»offsetå¼€å§‹çš„ç”¨æˆ·\n        userService.getUsersAfterIdWithLimit(offset, 5).forEach(user -&gt; {\n            compensationThreadPool.execute(() -&gt; memberService.welcome(user));\n            offset = user.getId();\n        });\n    }\n}\n</code></pre><p>ä¸ºäº†å®ç°é«˜å†…èšï¼Œä¸»çº¿å’Œå¤‡çº¿å¤„ç†æ¶ˆæ¯ï¼Œæœ€å¥½ä½¿ç”¨åŒä¸€ä¸ªæ–¹æ³•ã€‚æ¯”å¦‚ï¼Œæœ¬ä¾‹ä¸­MemberServiceç›‘å¬åˆ°MQæ¶ˆæ¯å’ŒCompensationJobè¡¥å¿ï¼Œè°ƒç”¨çš„éƒ½æ˜¯welcomeæ–¹æ³•ã€‚</p><p>æ­¤å¤–å€¼å¾—ä¸€è¯´çš„æ˜¯ï¼ŒDemoä¸­çš„è¡¥å¿é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œç”Ÿäº§çº§çš„ä»£ç åº”è¯¥åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡ŒåŠ å¼ºï¼š</p><ul>\n<li>è€ƒè™‘é…ç½®è¡¥å¿çš„é¢‘æ¬¡ã€æ¯æ¬¡å¤„ç†æ•°é‡ï¼Œä»¥åŠè¡¥å¿çº¿ç¨‹æ± å¤§å°ç­‰å‚æ•°ä¸ºåˆé€‚çš„å€¼ï¼Œä»¥æ»¡è¶³è¡¥å¿çš„ååé‡ã€‚</li>\n<li>è€ƒè™‘å¤‡çº¿è¡¥å¿æ•°æ®è¿›è¡Œé€‚å½“å»¶è¿Ÿã€‚æ¯”å¦‚ï¼Œå¯¹æ³¨å†Œæ—¶é—´åœ¨30ç§’ä¹‹å‰çš„ç”¨æˆ·å†è¿›è¡Œè¡¥å¿ï¼Œä»¥æ–¹ä¾¿å’Œä¸»çº¿MQå®æ—¶æµç¨‹é”™å¼€ï¼Œé¿å…å†²çªã€‚</li>\n<li>è¯¸å¦‚å½“å‰è¡¥å¿åˆ°å“ªä¸ªç”¨æˆ·çš„offsetæ•°æ®ï¼Œéœ€è¦è½åœ°æ•°æ®åº“ã€‚</li>\n<li>è¡¥å¿Jobæœ¬èº«éœ€è¦é«˜å¯ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ç±»ä¼¼XXLJobæˆ–ElasticJobç­‰ä»»åŠ¡ç³»ç»Ÿã€‚</li>\n</ul><p>è¿è¡Œç¨‹åºï¼Œæ‰§è¡Œæ³¨å†Œæ–¹æ³•æ³¨å†Œ10ä¸ªç”¨æˆ·ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</p><pre><code>[17:01:16.570] [http-nio-45678-exec-1] [INFO ] [o.g.t.c.a.compensation.UserController:28  ] - sent mq user 1\n[17:01:16.571] [http-nio-45678-exec-1] [INFO ] [o.g.t.c.a.compensation.UserController:28  ] - sent mq user 5\n[17:01:16.572] [http-nio-45678-exec-1] [INFO ] [o.g.t.c.a.compensation.UserController:28  ] - sent mq user 7\n[17:01:16.573] [http-nio-45678-exec-1] [INFO ] [o.g.t.c.a.compensation.UserController:28  ] - sent mq user 8\n[17:01:16.594] [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] [INFO ] [o.g.t.c.a.compensation.MemberService:18  ] - receive mq user 1\n[17:01:18.597] [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] [INFO ] [o.g.t.c.a.compensation.MemberService:28  ] - memberService: welcome new user 1\n[17:01:18.601] [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] [INFO ] [o.g.t.c.a.compensation.MemberService:18  ] - receive mq user 5\n[17:01:20.603] [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] [INFO ] [o.g.t.c.a.compensation.MemberService:28  ] - memberService: welcome new user 5\n[17:01:20.604] [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] [INFO ] [o.g.t.c.a.compensation.MemberService:18  ] - receive mq user 7\n[17:01:22.605] [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] [INFO ] [o.g.t.c.a.compensation.MemberService:28  ] - memberService: welcome new user 7\n[17:01:22.606] [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] [INFO ] [o.g.t.c.a.compensation.MemberService:18  ] - receive mq user 8\n[17:01:24.611] [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] [INFO ] [o.g.t.c.a.compensation.MemberService:28  ] - memberService: welcome new user 8\n[17:01:25.498] [scheduling-1] [INFO ] [o.g.t.c.a.compensation.CompensationJob:29  ] - å¼€å§‹ä»ç”¨æˆ·ID 0 è¡¥å¿\n[17:01:27.510] [compensation-threadpool-1] [INFO ] [o.g.t.c.a.compensation.MemberService:28  ] - memberService: welcome new user 2\n[17:01:27.510] [compensation-threadpool-3] [INFO ] [o.g.t.c.a.compensation.MemberService:28  ] - memberService: welcome new user 4\n[17:01:27.511] [compensation-threadpool-2] [INFO ] [o.g.t.c.a.compensation.MemberService:28  ] - memberService: welcome new user 3\n[17:01:30.496] [scheduling-1] [INFO ] [o.g.t.c.a.compensation.CompensationJob:29  ] - å¼€å§‹ä»ç”¨æˆ·ID 5 è¡¥å¿\n[17:01:32.500] [compensation-threadpool-6] [INFO ] [o.g.t.c.a.compensation.MemberService:28  ] - memberService: welcome new user 6\n[17:01:32.500] [compensation-threadpool-9] [INFO ] [o.g.t.c.a.compensation.MemberService:28  ] - memberService: welcome new user 9\n[17:01:35.496] [scheduling-1] [INFO ] [o.g.t.c.a.compensation.CompensationJob:29  ] - å¼€å§‹ä»ç”¨æˆ·ID 9 è¡¥å¿\n[17:01:37.501] [compensation-threadpool-0] [INFO ] [o.g.t.c.a.compensation.MemberService:28  ] - memberService: welcome new user 10\n[17:01:40.495] [scheduling-1] [INFO ] [o.g.t.c.a.compensation.CompensationJob:29  ] - å¼€å§‹ä»ç”¨æˆ·ID 10 è¡¥å¿\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼š</p><ul>\n<li>æ€»å…±10ä¸ªç”¨æˆ·ï¼ŒMQå‘é€æˆåŠŸçš„ç”¨æˆ·æœ‰å››ä¸ªï¼Œåˆ†åˆ«æ˜¯ç”¨æˆ·1ã€5ã€7ã€8ã€‚</li>\n<li>è¡¥å¿ä»»åŠ¡ç¬¬ä¸€æ¬¡è¿è¡Œï¼Œè¡¥å¿äº†ç”¨æˆ·2ã€3ã€4ï¼Œç¬¬äºŒæ¬¡è¿è¡Œè¡¥å¿äº†ç”¨æˆ·6ã€9ï¼Œç¬¬ä¸‰æ¬¡è¿è¡Œè¡¥å……äº†ç”¨æˆ·10ã€‚</li>\n</ul><p>æœ€åæä¸€ä¸‹ï¼Œé’ˆå¯¹æ¶ˆæ¯çš„è¡¥å¿é—­ç¯å¤„ç†çš„æœ€é«˜æ ‡å‡†æ˜¯ï¼Œèƒ½å¤Ÿè¾¾åˆ°è¡¥å¿å…¨é‡æ•°æ®çš„ååé‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœè¡¥å¿å¤‡çº¿è¶³å¤Ÿå®Œå–„ï¼Œå³ä½¿ç›´æ¥æŠŠMQåœæœºï¼Œè™½ç„¶ä¼šç•¥å¾®å½±å“å¤„ç†çš„åŠæ—¶æ€§ï¼Œä½†è‡³å°‘ç¡®ä¿æµç¨‹éƒ½èƒ½æ­£å¸¸æ‰§è¡Œã€‚</p><h2>æ³¨æ„æ¶ˆæ¯æ¨¡å¼æ˜¯å¹¿æ’­è¿˜æ˜¯å·¥ä½œé˜Ÿåˆ—</h2><p>åœ¨ä»Šå¤©è¿™ä¸€è®²çš„ä¸€å¼€å§‹ï¼Œæˆ‘ä»¬æåˆ°å¼‚æ­¥å¤„ç†çš„ä¸€ä¸ªé‡è¦ä¼˜åŠ¿ï¼Œæ˜¯å®ç°æ¶ˆæ¯å¹¿æ’­ã€‚</p><p>æ¶ˆæ¯å¹¿æ’­ï¼Œå’Œæˆ‘ä»¬å¹³æ—¶è¯´çš„â€œå¹¿æ’­â€æ„æ€å·®ä¸å¤šï¼Œå°±æ˜¯å¸Œæœ›åŒä¸€æ¡æ¶ˆæ¯ï¼Œä¸åŒæ¶ˆè´¹è€…éƒ½èƒ½åˆ†åˆ«æ¶ˆè´¹ï¼›è€Œé˜Ÿåˆ—æ¨¡å¼ï¼Œå°±æ˜¯ä¸åŒæ¶ˆè´¹è€…å…±äº«æ¶ˆè´¹åŒä¸€ä¸ªé˜Ÿåˆ—çš„æ•°æ®ï¼Œç›¸åŒæ¶ˆæ¯åªèƒ½è¢«æŸä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ä¸€æ¬¡ã€‚</p><p>æ¯”å¦‚ï¼ŒåŒä¸€ä¸ªç”¨æˆ·çš„æ³¨å†Œæ¶ˆæ¯ï¼Œä¼šå‘˜æœåŠ¡éœ€è¦ç›‘å¬ä»¥å‘é€æ¬¢è¿çŸ­ä¿¡ï¼Œè¥é”€æœåŠ¡åŒæ ·éœ€è¦ç›‘å¬ä»¥å‘é€æ–°ç”¨æˆ·å°ç¤¼ç‰©ã€‚ä½†æ˜¯ï¼Œä¼šå‘˜æœåŠ¡ã€è¥é”€æœåŠ¡éƒ½å¯èƒ½æœ‰å¤šä¸ªå®ä¾‹ï¼Œæˆ‘ä»¬æœŸæœ›çš„æ˜¯åŒä¸€ä¸ªç”¨æˆ·çš„æ¶ˆæ¯ï¼Œå¯ä»¥åŒæ—¶å¹¿æ’­ç»™ä¸åŒçš„æœåŠ¡ï¼ˆå¹¿æ’­æ¨¡å¼ï¼‰ï¼Œä½†å¯¹äºåŒä¸€ä¸ªæœåŠ¡çš„ä¸åŒå®ä¾‹ï¼ˆæ¯”å¦‚ä¼šå‘˜æœåŠ¡1å’Œä¼šå‘˜æœåŠ¡2ï¼‰ï¼Œä¸ç®¡å“ªä¸ªå®ä¾‹æ¥å¤„ç†ï¼Œå¤„ç†ä¸€æ¬¡å³å¯ï¼ˆå·¥ä½œé˜Ÿåˆ—æ¨¡å¼ï¼‰ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/79/14/79994116247045ff90652254770a6d14.png?wh=1548*814\" alt=\"\"></p><p>åœ¨å®ç°ä»£ç çš„æ—¶å€™ï¼Œæˆ‘ä»¬åŠ¡å¿…ç¡®è®¤MQç³»ç»Ÿçš„æœºåˆ¶ï¼Œç¡®ä¿æ¶ˆæ¯çš„è·¯ç”±æŒ‰ç…§æˆ‘ä»¬çš„æœŸæœ›ã€‚</p><p>å¯¹äºç±»ä¼¼RocketMQè¿™æ ·çš„MQæ¥è¯´ï¼Œå®ç°ç±»ä¼¼åŠŸèƒ½æ¯”è¾ƒç®€å•ç›´ç™½ï¼šå¦‚æœæ¶ˆè´¹è€…å±äºä¸€ä¸ªç»„ï¼Œé‚£ä¹ˆæ¶ˆæ¯åªä¼šç”±åŒä¸€ä¸ªç»„çš„ä¸€ä¸ªæ¶ˆè´¹è€…æ¥æ¶ˆè´¹ï¼›å¦‚æœæ¶ˆè´¹è€…å±äºä¸åŒç»„ï¼Œé‚£ä¹ˆæ¯ä¸ªç»„éƒ½èƒ½æ¶ˆè´¹ä¸€éæ¶ˆæ¯ã€‚</p><p>è€Œå¯¹äºRabbitMQæ¥è¯´ï¼Œæ¶ˆæ¯è·¯ç”±çš„æ¨¡å¼é‡‡ç”¨çš„æ˜¯é˜Ÿåˆ—+äº¤æ¢å™¨ï¼Œé˜Ÿåˆ—æ˜¯æ¶ˆæ¯çš„è½½ä½“ï¼Œäº¤æ¢å™¨å†³å®šäº†æ¶ˆæ¯è·¯ç”±åˆ°é˜Ÿåˆ—çš„æ–¹å¼ï¼Œé…ç½®æ¯”è¾ƒå¤æ‚ï¼Œå®¹æ˜“å‡ºé”™ã€‚æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥æˆ‘é‡ç‚¹å’Œä½ è®²è®²RabbitMQçš„ç›¸å…³ä»£ç å®ç°ã€‚</p><p>æˆ‘ä»¬è¿˜æ˜¯ä»¥ä¸Šé¢çš„æ¶æ„å›¾ä¸ºä¾‹ï¼Œæ¥æ¼”ç¤ºä½¿ç”¨RabbitMQå®ç°å¹¿æ’­æ¨¡å¼å’Œå·¥ä½œé˜Ÿåˆ—æ¨¡å¼çš„å‘ã€‚</p><p><strong>ç¬¬ä¸€æ­¥ï¼Œå®ç°ä¼šå‘˜æœåŠ¡ç›‘å¬ç”¨æˆ·æœåŠ¡å‘å‡ºçš„æ–°ç”¨æˆ·æ³¨å†Œæ¶ˆæ¯çš„é‚£éƒ¨åˆ†é€»è¾‘ã€‚</strong></p><p>å¦‚æœæˆ‘ä»¬å¯åŠ¨ä¸¤ä¸ªä¼šå‘˜æœåŠ¡ï¼Œé‚£ä¹ˆåŒä¸€ä¸ªç”¨æˆ·çš„æ³¨å†Œæ¶ˆæ¯åº”è¯¥åªèƒ½è¢«å…¶ä¸­ä¸€ä¸ªå®ä¾‹æ¶ˆè´¹ã€‚</p><p>æˆ‘ä»¬åˆ†åˆ«å®ç°RabbitMQé˜Ÿåˆ—ã€äº¤æ¢å™¨ã€ç»‘å®šä¸‰ä»¶å¥—ã€‚å…¶ä¸­ï¼Œé˜Ÿåˆ—ç”¨çš„æ˜¯åŒ¿åé˜Ÿåˆ—ï¼Œäº¤æ¢å™¨ç”¨çš„æ˜¯ç›´æ¥äº¤æ¢å™¨DirectExchangeï¼Œäº¤æ¢å™¨ç»‘å®šåˆ°åŒ¿åé˜Ÿåˆ—çš„è·¯ç”±Keyæ˜¯ç©ºå­—ç¬¦ä¸²ã€‚åœ¨æ”¶åˆ°æ¶ˆæ¯ä¹‹åï¼Œæˆ‘ä»¬ä¼šæ‰“å°æ‰€åœ¨å®ä¾‹ä½¿ç”¨çš„ç«¯å£ï¼š</p><pre><code>//ä¸ºäº†ä»£ç ç®€æ´ç›´è§‚ï¼Œæˆ‘ä»¬æŠŠæ¶ˆæ¯å‘å¸ƒè€…ã€æ¶ˆè´¹è€…ã€ä»¥åŠMQçš„é…ç½®ä»£ç éƒ½æ”¾åœ¨äº†ä¸€èµ·\n@Slf4j\n@Configuration\n@RestController\n@RequestMapping(&quot;workqueuewrong&quot;)\npublic class WorkQueueWrong {\n\n    private static final String EXCHANGE = &quot;newuserExchange&quot;;\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @GetMapping\n    public void sendMessage() {\n        rabbitTemplate.convertAndSend(EXCHANGE, &quot;&quot;, UUID.randomUUID().toString());\n    }\n\n    //ä½¿ç”¨åŒ¿åé˜Ÿåˆ—ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—\n    @Bean\n    public Queue queue() {\n        return new AnonymousQueue();\n    }\n  \n    //å£°æ˜DirectExchangeäº¤æ¢å™¨ï¼Œç»‘å®šé˜Ÿåˆ—åˆ°äº¤æ¢å™¨\n    @Bean\n    public Declarables declarables() {\n        DirectExchange exchange = new DirectExchange(EXCHANGE);\n        return new Declarables(queue(), exchange,\n                BindingBuilder.bind(queue()).to(exchange).with(&quot;&quot;));\n    }\n\n    //ç›‘å¬é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—åç§°ç›´æ¥é€šè¿‡SpELè¡¨è¾¾å¼å¼•ç”¨Bean\n    @RabbitListener(queues = &quot;#{queue.name}&quot;)\n    public void memberService(String userName) {\n        log.info(&quot;memberService: welcome message sent to new user {} from {}&quot;, userName, System.getProperty(&quot;server.port&quot;));\n\n    }\n}   \n</code></pre><p>ä½¿ç”¨12345å’Œ45678ä¸¤ä¸ªç«¯å£å¯åŠ¨ä¸¤ä¸ªç¨‹åºå®ä¾‹åï¼Œè°ƒç”¨sendMessageæ¥å£å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œè¾“å‡ºçš„æ—¥å¿—ï¼Œæ˜¾ç¤º<strong>åŒä¸€ä¸ªä¼šå‘˜æœåŠ¡ä¸¤ä¸ªå®ä¾‹éƒ½æ”¶åˆ°äº†æ¶ˆæ¯</strong>ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/bd/5f/bd649f78f2f3a7c732b8883fd4d5255f.png?wh=2918*120\" alt=\"\"></p><p><img src=\"https://static001.geekbang.org/resource/image/96/04/96278ba64ac411d5910d7ce8073c7304.png?wh=2898*126\" alt=\"\"></p><p><strong>å‡ºç°è¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯ï¼Œæˆ‘ä»¬æ²¡æœ‰ç†æ¸…æ¥šRabbitMQç›´æ¥äº¤æ¢å™¨å’Œé˜Ÿåˆ—çš„ç»‘å®šå…³ç³»ã€‚</strong></p><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒRabbitMQçš„ç›´æ¥äº¤æ¢å™¨æ ¹æ®routingKeyå¯¹æ¶ˆæ¯è¿›è¡Œè·¯ç”±ã€‚ç”±äºæˆ‘ä»¬çš„ç¨‹åºæ¯æ¬¡å¯åŠ¨éƒ½ä¼šåˆ›å»ºåŒ¿åï¼ˆéšæœºå‘½åï¼‰çš„é˜Ÿåˆ—ï¼Œæ‰€ä»¥ç›¸å½“äºæ¯ä¸€ä¸ªä¼šå‘˜æœåŠ¡å®ä¾‹éƒ½å¯¹åº”ç‹¬ç«‹çš„é˜Ÿåˆ—ï¼Œä»¥ç©ºroutingKeyç»‘å®šåˆ°ç›´æ¥äº¤æ¢å™¨ã€‚ç”¨æˆ·æœåŠ¡å‘å‡ºæ¶ˆæ¯çš„æ—¶å€™ä¹Ÿè®¾ç½®äº†routingKeyä¸ºç©ºï¼Œæ‰€ä»¥ç›´æ¥äº¤æ¢å™¨æ”¶åˆ°æ¶ˆæ¯ä¹‹åï¼Œå‘ç°æœ‰ä¸¤æ¡é˜Ÿåˆ—åŒ¹é…ï¼Œäºæ˜¯éƒ½è½¬å‘äº†æ¶ˆæ¯ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/c6/f8/c685c1a07347b040ee5ba1b48ce00af8.png?wh=1864*446\" alt=\"\"></p><p>è¦ä¿®å¤è¿™ä¸ªé—®é¢˜å…¶å®å¾ˆç®€å•ï¼Œå¯¹äºä¼šå‘˜æœåŠ¡ä¸è¦ä½¿ç”¨åŒ¿åé˜Ÿåˆ—ï¼Œè€Œæ˜¯ä½¿ç”¨åŒä¸€ä¸ªé˜Ÿåˆ—å³å¯ã€‚æŠŠä¸Šé¢ä»£ç ä¸­çš„åŒ¿åé˜Ÿåˆ—æ›¿æ¢ä¸ºä¸€ä¸ªæ™®é€šé˜Ÿåˆ—ï¼š</p><pre><code>private static final String QUEUE = &quot;newuserQueue&quot;;\n@Bean\npublic Queue queue() {\n    return new Queue(QUEUE);\n}\n</code></pre><p>æµ‹è¯•å‘ç°ï¼Œå¯¹äºåŒä¸€æ¡æ¶ˆæ¯æ¥è¯´ï¼Œä¸¤ä¸ªå®ä¾‹ä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹å¯ä»¥æ”¶åˆ°ï¼Œä¸åŒçš„æ¶ˆæ¯æŒ‰ç…§è½®è¯¢åˆ†å‘ç»™ä¸åŒçš„å®ä¾‹ã€‚ç°åœ¨ï¼Œäº¤æ¢å™¨å’Œé˜Ÿåˆ—çš„å…³ç³»æ˜¯è¿™æ ·çš„ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/65/7b/65205002a2cdde62d55330263afd317b.png?wh=1724*424\" alt=\"\"></p><p><strong>ç¬¬äºŒæ­¥ï¼Œè¿›ä¸€æ­¥å®Œæ•´å®ç°ç”¨æˆ·æœåŠ¡éœ€è¦å¹¿æ’­æ¶ˆæ¯ç»™ä¼šå‘˜æœåŠ¡å’Œè¥é”€æœåŠ¡çš„é€»è¾‘ã€‚</strong></p><p>æˆ‘ä»¬å¸Œæœ›ä¼šå‘˜æœåŠ¡å’Œè¥é”€æœåŠ¡éƒ½å¯ä»¥æ”¶åˆ°å¹¿æ’­æ¶ˆæ¯ï¼Œä½†ä¼šå‘˜æœåŠ¡æˆ–è¥é”€æœåŠ¡ä¸­çš„æ¯ä¸ªå®ä¾‹åªéœ€è¦æ”¶åˆ°ä¸€æ¬¡æ¶ˆæ¯ã€‚</p><p>ä»£ç å¦‚ä¸‹ï¼Œæˆ‘ä»¬å£°æ˜äº†ä¸€ä¸ªé˜Ÿåˆ—å’Œä¸€ä¸ªå¹¿æ’­äº¤æ¢å™¨FanoutExchangeï¼Œç„¶åæ¨¡æ‹Ÿä¸¤ä¸ªç”¨æˆ·æœåŠ¡å’Œä¸¤ä¸ªè¥é”€æœåŠ¡ï¼š</p><pre><code>@Slf4j\n@Configuration\n@RestController\n@RequestMapping(&quot;fanoutwrong&quot;)\npublic class FanoutQueueWrong {\n    private static final String QUEUE = &quot;newuser&quot;;\n    private static final String EXCHANGE = &quot;newuser&quot;;\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n\n    @GetMapping\n    public void sendMessage() {\n        rabbitTemplate.convertAndSend(EXCHANGE, &quot;&quot;, UUID.randomUUID().toString());\n    }\n    //å£°æ˜FanoutExchangeï¼Œç„¶åç»‘å®šåˆ°é˜Ÿåˆ—ï¼ŒFanoutExchangeç»‘å®šé˜Ÿåˆ—çš„æ—¶å€™ä¸éœ€è¦routingKey\n    @Bean\n    public Declarables declarables() {\n        Queue queue = new Queue(QUEUE);\n        FanoutExchange exchange = new FanoutExchange(EXCHANGE);\n        return new Declarables(queue, exchange,\n                BindingBuilder.bind(queue).to(exchange));\n    }\n    //ä¼šå‘˜æœåŠ¡å®ä¾‹1\n    @RabbitListener(queues = QUEUE)\n    public void memberService1(String userName) {\n        log.info(&quot;memberService1: welcome message sent to new user {}&quot;, userName);\n\n    }\n    //ä¼šå‘˜æœåŠ¡å®ä¾‹2\n    @RabbitListener(queues = QUEUE)\n    public void memberService2(String userName) {\n        log.info(&quot;memberService2: welcome message sent to new user {}&quot;, userName);\n\n    }\n    //è¥é”€æœåŠ¡å®ä¾‹1\n    @RabbitListener(queues = QUEUE)\n    public void promotionService1(String userName) {\n        log.info(&quot;promotionService1: gift sent to new user {}&quot;, userName);\n    }\n    //è¥é”€æœåŠ¡å®ä¾‹2\n    @RabbitListener(queues = QUEUE)\n    public void promotionService2(String userName) {\n        log.info(&quot;promotionService2: gift sent to new user {}&quot;, userName);\n    }\n}\n</code></pre><p>æˆ‘ä»¬è¯·æ±‚å››æ¬¡sendMessageæ¥å£ï¼Œæ³¨å†Œå››ä¸ªç”¨æˆ·ã€‚é€šè¿‡æ—¥å¿—å¯ä»¥å‘ç°ï¼Œ<strong>ä¸€æ¡ç”¨æˆ·æ³¨å†Œçš„æ¶ˆæ¯ï¼Œè¦ä¹ˆè¢«ä¼šå‘˜æœåŠ¡æ”¶åˆ°ï¼Œè¦ä¹ˆè¢«è¥é”€æœåŠ¡æ”¶åˆ°ï¼Œæ˜¾ç„¶è¿™ä¸æ˜¯å¹¿æ’­</strong>ã€‚é‚£ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„FanoutExchangeï¼Œçœ‹åå­—å°±åº”è¯¥æ˜¯å®ç°å¹¿æ’­çš„äº¤æ¢å™¨ï¼Œä¸ºä»€ä¹ˆæ ¹æœ¬æ²¡æœ‰èµ·ä½œç”¨å‘¢ï¼Ÿ</p><p><img src=\"https://static001.geekbang.org/resource/image/34/6d/34e2ea5e0f38ac029ff3d909d8b9606d.png?wh=2974*390\" alt=\"\"></p><p>å…¶å®ï¼Œå¹¿æ’­äº¤æ¢å™¨éå¸¸ç®€å•ï¼Œå®ƒä¼šå¿½ç•¥routingKeyï¼Œå¹¿æ’­æ¶ˆæ¯åˆ°æ‰€æœ‰ç»‘å®šçš„é˜Ÿåˆ—ã€‚åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œä¸¤ä¸ªä¼šå‘˜æœåŠ¡å’Œä¸¤ä¸ªè¥é”€æœåŠ¡éƒ½ç»‘å®šäº†åŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œæ‰€ä»¥è¿™å››ä¸ªæœåŠ¡åªèƒ½æ”¶åˆ°ä¸€æ¬¡æ¶ˆæ¯ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/20/cb/20adae38645d1cc169756fb4888211cb.png?wh=1656*462\" alt=\"\"></p><p>ä¿®æ”¹æ–¹å¼å¾ˆç®€å•ï¼Œæˆ‘ä»¬æŠŠé˜Ÿåˆ—è¿›è¡Œæ‹†åˆ†ï¼Œä¼šå‘˜å’Œè¥é”€ä¸¤ç»„æœåŠ¡åˆ†åˆ«ä½¿ç”¨ä¸€æ¡ç‹¬ç«‹é˜Ÿåˆ—ç»‘å®šåˆ°å¹¿æ’­äº¤æ¢å™¨å³å¯ï¼š</p><pre><code>@Slf4j\n@Configuration\n@RestController\n@RequestMapping(&quot;fanoutright&quot;)\npublic class FanoutQueueRight {\n    private static final String MEMBER_QUEUE = &quot;newusermember&quot;;\n    private static final String PROMOTION_QUEUE = &quot;newuserpromotion&quot;;\n    private static final String EXCHANGE = &quot;newuser&quot;;\n    @Autowired\n    private RabbitTemplate rabbitTemplate;\n    @GetMapping\n    public void sendMessage() {\n        rabbitTemplate.convertAndSend(EXCHANGE, &quot;&quot;, UUID.randomUUID().toString());\n    }\n    @Bean\n    public Declarables declarables() {\n        //ä¼šå‘˜æœåŠ¡é˜Ÿåˆ—\n        Queue memberQueue = new Queue(MEMBER_QUEUE);\n        //è¥é”€æœåŠ¡é˜Ÿåˆ—\n        Queue promotionQueue = new Queue(PROMOTION_QUEUE);\n        //å¹¿æ’­äº¤æ¢å™¨\n        FanoutExchange exchange = new FanoutExchange(EXCHANGE);\n        //ä¸¤ä¸ªé˜Ÿåˆ—ç»‘å®šåˆ°åŒä¸€ä¸ªäº¤æ¢å™¨\n        return new Declarables(memberQueue, promotionQueue, exchange,\n                BindingBuilder.bind(memberQueue).to(exchange),\n                BindingBuilder.bind(promotionQueue).to(exchange));\n    }\n    @RabbitListener(queues = MEMBER_QUEUE)\n    public void memberService1(String userName) {\n        log.info(&quot;memberService1: welcome message sent to new user {}&quot;, userName);\n    }\n    @RabbitListener(queues = MEMBER_QUEUE)\n    public void memberService2(String userName) {\n        log.info(&quot;memberService2: welcome message sent to new user {}&quot;, userName);\n    }\n    @RabbitListener(queues = PROMOTION_QUEUE)\n    public void promotionService1(String userName) {\n        log.info(&quot;promotionService1: gift sent to new user {}&quot;, userName);\n    }\n    @RabbitListener(queues = PROMOTION_QUEUE)\n    public void promotionService2(String userName) {\n        log.info(&quot;promotionService2: gift sent to new user {}&quot;, userName);\n    }\n}\n</code></pre><p>ç°åœ¨ï¼Œäº¤æ¢å™¨å’Œé˜Ÿåˆ—çš„ç»“æ„æ˜¯è¿™æ ·çš„ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/9a/78/9a3b06605913aa17025854dfbe6a5778.png?wh=1640*434\" alt=\"\"></p><p>ä»æ—¥å¿—è¾“å‡ºå¯ä»¥éªŒè¯ï¼Œå¯¹äºæ¯ä¸€æ¡MQæ¶ˆæ¯ï¼Œä¼šå‘˜æœåŠ¡å’Œè¥é”€æœåŠ¡åˆ†åˆ«éƒ½ä¼šæ”¶åˆ°ä¸€æ¬¡ï¼Œä¸€æ¡æ¶ˆæ¯å¹¿æ’­åˆ°ä¸¤ä¸ªæœåŠ¡çš„åŒæ—¶ï¼Œåœ¨æ¯ä¸€ä¸ªæœåŠ¡çš„ä¸¤ä¸ªå®ä¾‹ä¸­é€šè¿‡è½®è¯¢æ¥æ”¶ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/29/63/2975386cec273f3ca54b42872d9f4b63.png?wh=2886*390\" alt=\"\"></p><p>æ‰€ä»¥è¯´ï¼Œç†è§£äº†RabbitMQç›´æ¥äº¤æ¢å™¨ã€å¹¿æ’­äº¤æ¢å™¨çš„å·¥ä½œæ–¹å¼ä¹‹åï¼Œæˆ‘ä»¬å¯¹æ¶ˆæ¯çš„è·¯ç”±æ–¹å¼äº†è§£å¾—å¾ˆæ¸…æ™°äº†ï¼Œå®ç°ä»£ç å°±ä¸ä¼šå‡ºé”™ã€‚</p><p>å¯¹äºå¼‚æ­¥æµç¨‹æ¥è¯´ï¼Œæ¶ˆæ¯è·¯ç”±æ¨¡å¼ä¸€æ—¦é…ç½®å‡ºé”™ï¼Œè½»åˆ™å¯èƒ½å¯¼è‡´æ¶ˆæ¯çš„é‡å¤å¤„ç†ï¼Œé‡åˆ™å¯èƒ½å¯¼è‡´é‡è¦çš„æœåŠ¡æ— æ³•æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œæœ€ç»ˆé€ æˆä¸šåŠ¡é€»è¾‘é”™è¯¯ã€‚</p><p>æ¯ä¸ªMQä¸­é—´ä»¶å¯¹æ¶ˆæ¯çš„è·¯ç”±å¤„ç†çš„é…ç½®å„ä¸ç›¸åŒï¼Œæˆ‘ä»¬ä¸€å®šè¦å…ˆäº†è§£åŸç†å†ç€æ‰‹ç¼–ç ã€‚</p><h2>åˆ«è®©æ­»ä¿¡å µå¡äº†æ¶ˆæ¯é˜Ÿåˆ—</h2><p>æˆ‘ä»¬åœ¨ä»‹ç»<a href=\"https://time.geekbang.org/column/article/210337\">çº¿ç¨‹æ± </a>çš„æ—¶å€™æåˆ°ï¼Œå¦‚æœçº¿ç¨‹æ± çš„ä»»åŠ¡é˜Ÿåˆ—æ²¡æœ‰ä¸Šé™ï¼Œé‚£ä¹ˆæœ€ç»ˆå¯èƒ½ä¼šå¯¼è‡´OOMã€‚ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—å¤„ç†å¼‚æ­¥æµç¨‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹ŸåŒæ ·è¦æ³¨æ„æ¶ˆæ¯é˜Ÿåˆ—çš„ä»»åŠ¡å †ç§¯é—®é¢˜ã€‚å¯¹äºçªå‘æµé‡å¼•èµ·çš„æ¶ˆæ¯é˜Ÿåˆ—å †ç§¯ï¼Œé—®é¢˜å¹¶ä¸å¤§ï¼Œé€‚å½“è°ƒæ•´æ¶ˆè´¹è€…çš„æ¶ˆè´¹èƒ½åŠ›åº”è¯¥å°±å¯ä»¥è§£å†³ã€‚<strong>ä½†åœ¨å¾ˆå¤šæ—¶å€™ï¼Œæ¶ˆæ¯é˜Ÿåˆ—çš„å †ç§¯å µå¡ï¼Œæ˜¯å› ä¸ºæœ‰å¤§é‡å§‹ç»ˆæ— æ³•å¤„ç†çš„æ¶ˆæ¯</strong>ã€‚</p><p>æ¯”å¦‚ï¼Œç”¨æˆ·æœåŠ¡åœ¨ç”¨æˆ·æ³¨å†Œåå‘å‡ºä¸€æ¡æ¶ˆæ¯ï¼Œä¼šå‘˜æœåŠ¡ç›‘å¬åˆ°æ¶ˆæ¯åç»™ç”¨æˆ·æ´¾å‘ä¼˜æƒ åˆ¸ï¼Œä½†å› ä¸ºç”¨æˆ·å¹¶æ²¡æœ‰ä¿å­˜æˆåŠŸï¼Œä¼šå‘˜æœåŠ¡å¤„ç†æ¶ˆæ¯å§‹ç»ˆå¤±è´¥ï¼Œæ¶ˆæ¯é‡æ–°è¿›å…¥é˜Ÿåˆ—ï¼Œç„¶åè¿˜æ˜¯å¤„ç†å¤±è´¥ã€‚è¿™ç§åœ¨MQä¸­åƒå¹½çµä¸€æ ·å›è¡çš„åŒä¸€æ¡æ¶ˆæ¯ï¼Œå°±æ˜¯æ­»ä¿¡ã€‚</p><p>éšç€MQè¢«è¶Šæ¥è¶Šå¤šçš„æ­»ä¿¡å¡«æ»¡ï¼Œæ¶ˆè´¹è€…éœ€è¦èŠ±è´¹å¤§é‡æ—¶é—´åå¤å¤„ç†æ­»ä¿¡ï¼Œå¯¼è‡´æ­£å¸¸æ¶ˆæ¯çš„æ¶ˆè´¹å—é˜»ï¼Œ<strong>æœ€ç»ˆMQå¯èƒ½å› ä¸ºæ•°æ®é‡è¿‡å¤§è€Œå´©æºƒ</strong>ã€‚</p><p>æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹è¿™ä¸ªåœºæ™¯ã€‚é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ªé˜Ÿåˆ—ã€ä¸€ä¸ªç›´æ¥äº¤æ¢å™¨ï¼Œç„¶åæŠŠé˜Ÿåˆ—ç»‘å®šåˆ°äº¤æ¢å™¨ï¼š</p><pre><code>@Bean\npublic Declarables declarables() {\n    //é˜Ÿåˆ—\n    Queue queue = new Queue(Consts.QUEUE);\n    //äº¤æ¢å™¨\n    DirectExchange directExchange = new DirectExchange(Consts.EXCHANGE);\n    //å¿«é€Ÿå£°æ˜ä¸€ç»„å¯¹è±¡ï¼ŒåŒ…å«é˜Ÿåˆ—ã€äº¤æ¢å™¨ï¼Œä»¥åŠé˜Ÿåˆ—åˆ°äº¤æ¢å™¨çš„ç»‘å®š\n    return new Declarables(queue, directExchange,\n            BindingBuilder.bind(queue).to(directExchange).with(Consts.ROUTING_KEY));\n}\n</code></pre><p>ç„¶åï¼Œå®ç°ä¸€ä¸ªsendMessageæ–¹æ³•æ¥å‘é€æ¶ˆæ¯åˆ°MQï¼Œè®¿é—®ä¸€æ¬¡æäº¤ä¸€æ¡æ¶ˆæ¯ï¼Œä½¿ç”¨è‡ªå¢æ ‡è¯†ä½œä¸ºæ¶ˆæ¯å†…å®¹ï¼š</p><pre><code>//è‡ªå¢æ¶ˆæ¯æ ‡è¯†\nAtomicLong atomicLong = new AtomicLong();\n@Autowired\nprivate RabbitTemplate rabbitTemplate;\n\n@GetMapping(&quot;sendMessage&quot;)\npublic void sendMessage() {\n    String msg = &quot;msg&quot; + atomicLong.incrementAndGet();\n    log.info(&quot;send message {}&quot;, msg);\n    //å‘é€æ¶ˆæ¯\n    rabbitTemplate.convertAndSend(Consts.EXCHANGE, msg);\n}\n</code></pre><p>æ”¶åˆ°æ¶ˆæ¯åï¼Œç›´æ¥æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œæ¨¡æ‹Ÿå¤„ç†å‡ºé”™çš„æƒ…å†µï¼š</p><pre><code>@RabbitListener(queues = Consts.QUEUE)\npublic void handler(String data) {\n    log.info(&quot;got message {}&quot;, data);\n    throw new NullPointerException(&quot;error&quot;);\n}\n</code></pre><p>è°ƒç”¨sendMessageæ¥å£å‘é€ä¸¤æ¡æ¶ˆæ¯ï¼Œç„¶åæ¥åˆ°RabbitMQç®¡ç†å°ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸¤æ¡æ¶ˆæ¯å§‹ç»ˆåœ¨é˜Ÿåˆ—ä¸­ï¼Œä¸æ–­è¢«é‡æ–°æŠ•é€’ï¼Œå¯¼è‡´é‡æ–°æŠ•é€’QPSè¾¾åˆ°äº†1063ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/11/54/1130fc65dee6acba4df08227baf4d554.jpg?wh=2284*1281\" alt=\"\"></p><p>åŒæ—¶ï¼Œåœ¨æ—¥å¿—ä¸­å¯ä»¥çœ‹åˆ°å¤§é‡å¼‚å¸¸ä¿¡æ¯ï¼š</p><pre><code>[20:02:31.533] [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] [WARN ] [o.s.a.r.l.ConditionalRejectingErrorHandler:129 ] - Execution of Rabbit message listener failed.\norg.springframework.amqp.rabbit.support.ListenerExecutionFailedException: Listener method 'public void org.geekbang.time.commonmistakes.asyncprocess.deadletter.MQListener.handler(java.lang.String)' threw exception\n\tat org.springframework.amqp.rabbit.listener.adapter.MessagingMessageListenerAdapter.invokeHandler(MessagingMessageListenerAdapter.java:219)\n\tat org.springframework.amqp.rabbit.listener.adapter.MessagingMessageListenerAdapter.invokeHandlerAndProcessResult(MessagingMessageListenerAdapter.java:143)\n\tat org.springframework.amqp.rabbit.listener.adapter.MessagingMessageListenerAdapter.onMessage(MessagingMessageListenerAdapter.java:132)\n\tat org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:1569)\n\tat org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.actualInvokeListener(AbstractMessageListenerContainer.java:1488)\n\tat org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:1476)\n\tat org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:1467)\n\tat org.springframework.amqp.rabbit.listener.AbstractMessageListenerContainer.executeListener(AbstractMessageListenerContainer.java:1411)\n\tat org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.doReceiveAndExecute(SimpleMessageListenerContainer.java:958)\n\tat org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.receiveAndExecute(SimpleMessageListenerContainer.java:908)\n\tat org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer.access$1600(SimpleMessageListenerContainer.java:81)\n\tat org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer.mainLoop(SimpleMessageListenerContainer.java:1279)\n\tat org.springframework.amqp.rabbit.listener.SimpleMessageListenerContainer$AsyncMessageProcessingConsumer.run(SimpleMessageListenerContainer.java:1185)\n\tat java.lang.Thread.run(Thread.java:748)\nCaused by: java.lang.NullPointerException: error\n\tat org.geekbang.time.commonmistakes.asyncprocess.deadletter.MQListener.handler(MQListener.java:14)\n\tat sun.reflect.GeneratedMethodAccessor46.invoke(Unknown Source)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n\tat org.springframework.messaging.handler.invocation.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:171)\n\tat org.springframework.messaging.handler.invocation.InvocableHandlerMethod.invoke(InvocableHandlerMethod.java:120)\n\tat org.springframework.amqp.rabbit.listener.adapter.HandlerAdapter.invoke(HandlerAdapter.java:50)\n\tat org.springframework.amqp.rabbit.listener.adapter.MessagingMessageListenerAdapter.invokeHandler(MessagingMessageListenerAdapter.java:211)\n\t... 13 common frames omitted\n</code></pre><p>è§£å†³æ­»ä¿¡æ— é™é‡å¤è¿›å…¥é˜Ÿåˆ—æœ€ç®€å•çš„æ–¹å¼æ˜¯ï¼Œåœ¨ç¨‹åºå¤„ç†å‡ºé”™çš„æ—¶å€™ï¼Œç›´æ¥æŠ›å‡ºAmqpRejectAndDontRequeueExceptionå¼‚å¸¸ï¼Œé¿å…æ¶ˆæ¯é‡æ–°è¿›å…¥é˜Ÿåˆ—ï¼š</p><pre><code>throw new AmqpRejectAndDontRequeueException(&quot;error&quot;);\n</code></pre><p>ä½†ï¼Œæˆ‘ä»¬æ›´å¸Œæœ›çš„é€»è¾‘æ˜¯ï¼Œå¯¹äºåŒä¸€æ¡æ¶ˆæ¯ï¼Œèƒ½å¤Ÿå…ˆè¿›è¡Œå‡ æ¬¡é‡è¯•ï¼Œè§£å†³å› ä¸ºç½‘ç»œé—®é¢˜å¯¼è‡´çš„å¶å‘æ¶ˆæ¯å¤„ç†å¤±è´¥ï¼Œå¦‚æœè¿˜æ˜¯ä¸è¡Œçš„è¯ï¼Œå†æŠŠæ¶ˆæ¯æŠ•é€’åˆ°ä¸“é—¨çš„ä¸€ä¸ªæ­»ä¿¡é˜Ÿåˆ—ã€‚å¯¹äºæ¥è‡ªæ­»ä¿¡é˜Ÿåˆ—çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯èƒ½åªæ˜¯è®°å½•æ—¥å¿—å‘é€æŠ¥è­¦ï¼Œå³ä½¿å‡ºç°å¼‚å¸¸ä¹Ÿä¸ä¼šå†é‡å¤æŠ•é€’ã€‚æ•´ä¸ªé€»è¾‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/40/28/40f0cf14933178fd07690372199e8428.png?wh=1478*684\" alt=\"\"></p><p>é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼ŒSpring AMQPæä¾›äº†éå¸¸æ–¹ä¾¿çš„è§£å†³æ–¹æ¡ˆï¼š</p><ul>\n<li>é¦–å…ˆï¼Œå®šä¹‰æ­»ä¿¡äº¤æ¢å™¨å’Œæ­»ä¿¡é˜Ÿåˆ—ã€‚å…¶å®ï¼Œè¿™äº›éƒ½æ˜¯æ™®é€šçš„äº¤æ¢å™¨å’Œé˜Ÿåˆ—ï¼Œåªä¸è¿‡è¢«æˆ‘ä»¬ä¸“é—¨ç”¨äºå¤„ç†æ­»ä¿¡æ¶ˆæ¯ã€‚</li>\n<li>ç„¶åï¼Œé€šè¿‡RetryInterceptorBuilderæ„å»ºä¸€ä¸ªRetryOperationsInterceptorï¼Œç”¨äºå¤„ç†å¤±è´¥æ—¶å€™çš„é‡è¯•ã€‚è¿™é‡Œçš„ç­–ç•¥æ˜¯ï¼Œæœ€å¤šå°è¯•5æ¬¡ï¼ˆé‡è¯•4æ¬¡ï¼‰ï¼›å¹¶ä¸”é‡‡å–æŒ‡æ•°é€€é¿é‡è¯•ï¼Œé¦–æ¬¡é‡è¯•å»¶è¿Ÿ1ç§’ï¼Œç¬¬äºŒæ¬¡2ç§’ï¼Œä»¥æ­¤ç±»æ¨ï¼Œæœ€å¤§å»¶è¿Ÿæ˜¯10ç§’ï¼›å¦‚æœç¬¬4æ¬¡é‡è¯•è¿˜æ˜¯å¤±è´¥ï¼Œåˆ™ä½¿ç”¨RepublishMessageRecovereræŠŠæ¶ˆæ¯é‡æ–°æŠ•å…¥ä¸€ä¸ªâ€œæ­»ä¿¡äº¤æ¢å™¨â€ä¸­ã€‚</li>\n<li>æœ€åï¼Œå®šä¹‰æ­»ä¿¡é˜Ÿåˆ—çš„å¤„ç†ç¨‹åºã€‚è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯ç®€å•è®°å½•æ—¥å¿—ã€‚</li>\n</ul><p>å¯¹åº”çš„å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>//å®šä¹‰æ­»ä¿¡äº¤æ¢å™¨å’Œé˜Ÿåˆ—ï¼Œå¹¶ä¸”è¿›è¡Œç»‘å®š\n@Bean\npublic Declarables declarablesForDead() {\n    Queue queue = new Queue(Consts.DEAD_QUEUE);\n    DirectExchange directExchange = new DirectExchange(Consts.DEAD_EXCHANGE);\n    return new Declarables(queue, directExchange,\n            BindingBuilder.bind(queue).to(directExchange).with(Consts.DEAD_ROUTING_KEY));\n}\n//å®šä¹‰é‡è¯•æ“ä½œæ‹¦æˆªå™¨\n@Bean\npublic RetryOperationsInterceptor interceptor() {\n    return RetryInterceptorBuilder.stateless()\n            .maxAttempts(5) //æœ€å¤šå°è¯•ï¼ˆä¸æ˜¯é‡è¯•ï¼‰5æ¬¡\n            .backOffOptions(1000, 2.0, 10000) //æŒ‡æ•°é€€é¿é‡è¯•\n            .recoverer(new RepublishMessageRecoverer(rabbitTemplate, Consts.DEAD_EXCHANGE, Consts.DEAD_ROUTING_KEY)) //é‡æ–°æŠ•é€’é‡è¯•è¾¾åˆ°ä¸Šé™çš„æ¶ˆæ¯\n            .build();\n}\n//é€šè¿‡å®šä¹‰SimpleRabbitListenerContainerFactoryï¼Œè®¾ç½®å…¶adviceChainå±æ€§ä¸ºä¹‹å‰å®šä¹‰çš„RetryOperationsInterceptoræ¥å¯ç”¨é‡è¯•æ‹¦æˆªå™¨\n@Bean\npublic SimpleRabbitListenerContainerFactory rabbitListenerContainerFactory(ConnectionFactory connectionFactory) {\n    SimpleRabbitListenerContainerFactory factory = new SimpleRabbitListenerContainerFactory();\n    factory.setConnectionFactory(connectionFactory);\n    factory.setAdviceChain(interceptor());\n    return factory;\n}\n//æ­»ä¿¡é˜Ÿåˆ—å¤„ç†ç¨‹åº\n@RabbitListener(queues = Consts.DEAD_QUEUE)\npublic void deadHandler(String data) {\n    log.error(&quot;got dead message {}&quot;, data);\n}\n</code></pre><p>æ‰§è¡Œç¨‹åºï¼Œå‘é€ä¸¤æ¡æ¶ˆæ¯ï¼Œæ—¥å¿—å¦‚ä¸‹ï¼š</p><pre><code>[11:22:02.193] [http-nio-45688-exec-1] [INFO ] [o.g.t.c.a.d.DeadLetterController:24  ] - send message msg1\n[11:22:02.219] [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] [INFO ] [o.g.t.c.a.deadletter.MQListener:13  ] - got message msg1\n[11:22:02.614] [http-nio-45688-exec-2] [INFO ] [o.g.t.c.a.d.DeadLetterController:24  ] - send message msg2\n[11:22:03.220] [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] [INFO ] [o.g.t.c.a.deadletter.MQListener:13  ] - got message msg1\n[11:22:05.221] [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] [INFO ] [o.g.t.c.a.deadletter.MQListener:13  ] - got message msg1\n[11:22:09.223] [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] [INFO ] [o.g.t.c.a.deadletter.MQListener:13  ] - got message msg1\n[11:22:17.224] [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] [INFO ] [o.g.t.c.a.deadletter.MQListener:13  ] - got message msg1\n[11:22:17.226] [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] [WARN ] [o.s.a.r.retry.RepublishMessageRecoverer:172 ] - Republishing failed message to exchange 'deadtest' with routing key deadtest\n[11:22:17.227] [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] [INFO ] [o.g.t.c.a.deadletter.MQListener:13  ] - got message msg2\n[11:22:17.229] [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] [ERROR] [o.g.t.c.a.deadletter.MQListener:20  ] - got dead message msg1\n[11:22:18.232] [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] [INFO ] [o.g.t.c.a.deadletter.MQListener:13  ] - got message msg2\n[11:22:20.237] [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] [INFO ] [o.g.t.c.a.deadletter.MQListener:13  ] - got message msg2\n[11:22:24.241] [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] [INFO ] [o.g.t.c.a.deadletter.MQListener:13  ] - got message msg2\n[11:22:32.245] [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] [INFO ] [o.g.t.c.a.deadletter.MQListener:13  ] - got message msg2\n[11:22:32.246] [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#0-1] [WARN ] [o.s.a.r.retry.RepublishMessageRecoverer:172 ] - Republishing failed message to exchange 'deadtest' with routing key deadtest\n[11:22:32.250] [org.springframework.amqp.rabbit.RabbitListenerEndpointContainer#1-1] [ERROR] [o.g.t.c.a.deadletter.MQListener:20  ] - got dead message msg2\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼š</p><ul>\n<li>msg1çš„4æ¬¡é‡è¯•é—´éš”åˆ†åˆ«æ˜¯1ç§’ã€2ç§’ã€4ç§’ã€8ç§’ï¼Œå†åŠ ä¸Šé¦–æ¬¡çš„å¤±è´¥ï¼Œæ‰€ä»¥æœ€å¤§å°è¯•æ¬¡æ•°æ˜¯5ã€‚</li>\n<li>4æ¬¡é‡è¯•åï¼ŒRepublishMessageRecovereræŠŠæ¶ˆæ¯å‘å¾€äº†æ­»ä¿¡äº¤æ¢å™¨ã€‚</li>\n<li>æ­»ä¿¡å¤„ç†ç¨‹åºè¾“å‡ºäº†got dead messageæ—¥å¿—ã€‚</li>\n</ul><p>è¿™é‡Œéœ€è¦å°¤å…¶æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œè™½ç„¶æˆ‘ä»¬å‡ ä¹åŒæ—¶å‘é€äº†ä¸¤æ¡æ¶ˆæ¯ï¼Œä½†æ˜¯msg2æ˜¯åœ¨msg1çš„å››æ¬¡é‡è¯•å…¨éƒ¨ç»“æŸåæ‰å¼€å§‹å¤„ç†ã€‚åŸå› æ˜¯ï¼Œ<strong>é»˜è®¤æƒ…å†µä¸‹SimpleMessageListenerContaineråªæœ‰ä¸€ä¸ªæ¶ˆè´¹çº¿ç¨‹</strong>ã€‚å¯ä»¥é€šè¿‡å¢åŠ æ¶ˆè´¹çº¿ç¨‹æ¥é¿å…æ€§èƒ½é—®é¢˜ï¼Œå¦‚ä¸‹æˆ‘ä»¬ç›´æ¥è®¾ç½®concurrentConsumerså‚æ•°ä¸º10ï¼Œæ¥å¢åŠ åˆ°10ä¸ªå·¥ä½œçº¿ç¨‹ï¼š</p><pre><code>@Bean\npublic SimpleRabbitListenerContainerFactory rabbitListenerContainerFactory(ConnectionFactory connectionFactory) {\n    SimpleRabbitListenerContainerFactory factory = new SimpleRabbitListenerContainerFactory();\n    factory.setConnectionFactory(connectionFactory);\n    factory.setAdviceChain(interceptor());\n    factory.setConcurrentConsumers(10);\n    return factory;\n}\n</code></pre><p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è®¾ç½®maxConcurrentConsumerså‚æ•°ï¼Œæ¥è®©SimpleMessageListenerContainerè‡ªå·±åŠ¨æ€åœ°è°ƒæ•´æ¶ˆè´¹è€…çº¿ç¨‹æ•°ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬éœ€è¦ç‰¹åˆ«æ³¨æ„å®ƒçš„åŠ¨æ€å¼€å¯æ–°çº¿ç¨‹çš„ç­–ç•¥ã€‚ä½ å¯ä»¥é€šè¿‡<a href=\"https://docs.spring.io/spring-amqp/docs/2.2.1.RELEASE/reference/html/#listener-concurrency\">å®˜æ–¹æ–‡æ¡£</a>ï¼Œæ¥äº†è§£è¿™ä¸ªç­–ç•¥ã€‚</p><h2>é‡ç‚¹å›é¡¾</h2><p>åœ¨ä½¿ç”¨å¼‚æ­¥å¤„ç†è¿™ç§æ¶æ„æ¨¡å¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½ä¼šä½¿ç”¨MQä¸­é—´ä»¶é…åˆå®ç°å¼‚æ­¥æµç¨‹ï¼Œéœ€è¦é‡ç‚¹è€ƒè™‘å››ä¸ªæ–¹é¢çš„é—®é¢˜ã€‚</p><p>ç¬¬ä¸€ï¼Œè¦è€ƒè™‘å¼‚æ­¥æµç¨‹ä¸¢æ¶ˆæ¯æˆ–å¤„ç†ä¸­æ–­çš„æƒ…å†µï¼Œå¼‚æ­¥æµç¨‹éœ€è¦æœ‰å¤‡çº¿è¿›è¡Œè¡¥å¿ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬ä»Šå¤©ä»‹ç»çš„å…¨é‡è¡¥å¿æ–¹å¼ï¼Œå³ä¾¿å¼‚æ­¥æµç¨‹å½»åº•å¤±æ•ˆï¼Œé€šè¿‡è¡¥å¿ä¹Ÿèƒ½è®©ä¸šåŠ¡ç»§ç»­è¿›è¡Œã€‚</p><p>ç¬¬äºŒï¼Œå¼‚æ­¥å¤„ç†çš„æ—¶å€™éœ€è¦è€ƒè™‘æ¶ˆæ¯é‡å¤çš„å¯èƒ½æ€§ï¼Œå¤„ç†é€»è¾‘éœ€è¦å®ç°å¹‚ç­‰ï¼Œé˜²æ­¢é‡å¤å¤„ç†ã€‚</p><p>ç¬¬ä¸‰ï¼Œå¾®æœåŠ¡åœºæ™¯ä¸‹ä¸åŒæœåŠ¡å¤šä¸ªå®ä¾‹ç›‘å¬æ¶ˆæ¯çš„æƒ…å†µï¼Œä¸€èˆ¬ä¸åŒæœåŠ¡éœ€è¦åŒæ—¶æ”¶åˆ°ç›¸åŒçš„æ¶ˆæ¯ï¼Œè€Œç›¸åŒæœåŠ¡çš„å¤šä¸ªå®ä¾‹åªéœ€è¦è½®è¯¢æ¥æ”¶æ¶ˆæ¯ã€‚æˆ‘ä»¬éœ€è¦ç¡®è®¤MQçš„æ¶ˆæ¯è·¯ç”±é…ç½®æ˜¯å¦æ»¡è¶³éœ€æ±‚ï¼Œä»¥é¿å…æ¶ˆæ¯é‡å¤æˆ–æ¼å‘é—®é¢˜ã€‚</p><p>ç¬¬å››ï¼Œè¦æ³¨æ„å§‹ç»ˆæ— æ³•å¤„ç†çš„æ­»ä¿¡æ¶ˆæ¯ï¼Œå¯èƒ½ä¼šå¼•å‘å µå¡MQçš„é—®é¢˜ã€‚ä¸€èˆ¬åœ¨é‡åˆ°æ¶ˆæ¯å¤„ç†å¤±è´¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€å®šçš„é‡è¯•ç­–ç•¥ã€‚å¦‚æœé‡è¯•è¿˜æ˜¯ä¸è¡Œï¼Œé‚£å¯ä»¥æŠŠè¿™ä¸ªæ¶ˆæ¯æ‰”åˆ°ä¸“æœ‰çš„æ­»ä¿¡é˜Ÿåˆ—ç‰¹åˆ«å¤„ç†ï¼Œä¸è¦è®©æ­»ä¿¡å½±å“åˆ°æ­£å¸¸æ¶ˆæ¯çš„å¤„ç†ã€‚</p><p>ä»Šå¤©ç”¨åˆ°çš„ä»£ç ï¼Œæˆ‘éƒ½æ”¾åœ¨äº†GitHubä¸Šï¼Œä½ å¯ä»¥ç‚¹å‡»<a href=\"https://github.com/JosephZhu1983/java-common-mistakes\">è¿™ä¸ªé“¾æ¥</a>æŸ¥çœ‹ã€‚</p><h2>æ€è€ƒä¸è®¨è®º</h2><ol>\n<li>åœ¨ç”¨æˆ·æ³¨å†Œåå‘é€æ¶ˆæ¯åˆ°MQï¼Œç„¶åä¼šå‘˜æœåŠ¡ç›‘å¬æ¶ˆæ¯è¿›è¡Œå¼‚æ­¥å¤„ç†çš„åœºæ™¯ä¸‹ï¼Œæœ‰äº›æ—¶å€™æˆ‘ä»¬ä¼šå‘ç°ï¼Œè™½ç„¶ç”¨æˆ·æœåŠ¡å…ˆä¿å­˜æ•°æ®å†å‘é€MQï¼Œä½†ä¼šå‘˜æœåŠ¡æ”¶åˆ°æ¶ˆæ¯åå»æŸ¥è¯¢æ•°æ®åº“ï¼Œå´å‘ç°æ•°æ®åº“ä¸­è¿˜æ²¡æœ‰æ–°ç”¨æˆ·çš„ä¿¡æ¯ã€‚ä½ è§‰å¾—ï¼Œè¿™å¯èƒ½æ˜¯ä»€ä¹ˆé—®é¢˜å‘¢ï¼Œåˆè¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</li>\n<li>é™¤äº†ä½¿ç”¨Spring AMQPå®ç°æ­»ä¿¡æ¶ˆæ¯çš„é‡æŠ•é€’å¤–ï¼ŒRabbitMQ 2.8.0 åæ”¯æŒçš„æ­»ä¿¡äº¤æ¢å™¨DLXä¹Ÿå¯ä»¥å®ç°ç±»ä¼¼åŠŸèƒ½ã€‚ä½ èƒ½å°è¯•ç”¨DLXå®ç°å—ï¼Œå¹¶æ¯”è¾ƒä¸‹è¿™ä¸¤ç§å¤„ç†æœºåˆ¶ï¼Ÿ</li>\n</ol><p>å…³äºä½¿ç”¨MQè¿›è¡Œå¼‚æ­¥å¤„ç†æµç¨‹ï¼Œä½ è¿˜é‡åˆ°è¿‡å…¶ä»–é—®é¢˜å—ï¼Ÿæˆ‘æ˜¯æœ±æ™”ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºä¸æˆ‘ç•™è¨€åˆ†äº«ä½ çš„æƒ³æ³•ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠä»Šå¤©çš„å†…å®¹åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–åŒäº‹ï¼Œä¸€èµ·äº¤æµã€‚</p>","neighbors":{"left":{"article_title":"24 | ä¸šåŠ¡ä»£ç å†™å®Œï¼Œå°±æ„å‘³ç€ç”Ÿäº§å°±ç»ªäº†ï¼Ÿ","id":231568},"right":{"article_title":"26 | æ•°æ®å­˜å‚¨ï¼šNoSQLä¸RDBMSå¦‚ä½•å–é•¿è¡¥çŸ­ã€ç›¸è¾…ç›¸æˆï¼Ÿ","id":234930}},"comments":[{"had_liked":false,"id":216285,"user_name":"vivi","can_delete":false,"product_type":"c1","uid":1632728,"ip_address":"","ucode":"1A02D8396F538B","user_header":"https://static001.geekbang.org/account/avatar/00/18/e9/d8/026493cc.jpg","comment_is_top":false,"comment_ctime":1589214899,"is_pvip":true,"replies":[{"id":"80038","content":"è¿™ä¸ªå®ç°å¾ˆèµ","user_name":"ä½œè€…å›å¤","comment_id":216285,"uid":"1001470","ip_address":"","utype":1,"ctime":1589241550,"user_name_real":"æœ±æ™”"}],"discussion_count":7,"race_medal":0,"score":"126143266483","product_id":100047701,"comment_content":"æˆ‘ä¹‹å‰åšè¿‡ä¸€ä¸ªdemo æ˜¯åŸºäºcanalåšmysqlæ•°æ®åŒæ­¥ï¼Œéœ€è¦å°†è§£æå¥½çš„æ•°æ®å‘åˆ°kafkaé‡Œé¢ï¼Œå†è¿›è¡Œå¤„ç†ã€‚åœ¨ä½¿ç”¨çš„æ—¶å€™å‘ç°è¿™ä¹ˆä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯kafkaå¤špartitionæ¶ˆè´¹æ—¶ä¸èƒ½ä¿è¯æ¶ˆæ¯çš„é¡ºåºæ¶ˆè´¹ï¼Œè¿›è€Œå¯¼è‡´mysqlæ•°æ®åŒæ­¥å¼‚å¸¸ã€‚<br>ç”±äºkafkaå¯ä»¥ä¿è¯åœ¨åŒä¸€ä¸ªpartitionå†…æ¶ˆæ¯æœ‰åºï¼Œäºæ˜¯æˆ‘è‡ªå®šä¹‰äº†ä¸€ä¸ªåˆ†åŒºå™¨ï¼Œå°†æ•°æ®çš„idå–hashcodeç„¶åæ ¹æ®partitionçš„æ•°é‡å–ä½™ä½œä¸ºåˆ†åŒºå·ï¼Œä¿è¯åŒä¸€æ¡æ•°æ®çš„binlogèƒ½æŠ•é€’åˆ°åŒä¸€ä¸ªpartitionä¸­ï¼Œä»è€Œè¾¾åˆ°æ¶ˆæ¯é¡ºåºæ¶ˆè´¹çš„ç›®çš„ã€‚","like_count":30,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494752,"discussion_content":"è¿™ä¸ªå®ç°å¾ˆèµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589241550,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1623626,"avatar":"https://static001.geekbang.org/account/avatar/00/18/c6/4a/3bd896fc.jpg","nickname":"Heiky","note":"","ucode":"03AA79E1BC4AE4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":274032,"discussion_content":"æˆ‘æœ€è¿‘ä¸€ç›´ç ”ç©¶canalï¼Œcanalæœ¬èº«åšäº†é¡ºåºæ¶ˆè´¹çš„é—®é¢˜ï¼Œå•topicå•åˆ†åŒºï¼Œå•topicå¤šåˆ†åŒºï¼Œå¤štopicå•åˆ†åŒºï¼Œå¤štopicå¤šåˆ†åŒºï¼Œå…¶ä¸­åˆ†åŒºå°±æ˜¯æ ¹æ®hashæ¥åšçš„ï¼Œå¯ä»¥åšåˆ°è¡¨çº§ï¼Œåº“çº§éƒ½æŠ•æ”¾åŒä¸€ä¸ªåˆ†åŒºï¼Œæœ€ä½³å®è·µï¼Œåˆ†åŒºæ•°=æ¶ˆè´¹è€…æ•°ï¼Œå°±å¯ä»¥å®ç°æœ‰åºï¼Œæˆ‘ç”¨çš„rocketmqï¼Œkafkaå’ŒrocketmqåŸºäºcanalçš„å®ç°å¤§åŒå°å¼‚ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1590537912,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1965236,"avatar":"","nickname":"Geek_c703f7","note":"","ucode":"0D49860F83534E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":266227,"discussion_content":"canal_clientæœ¬æ¥å°±å¯ä»¥ä¿è¯æœ‰åºï¼Œä¸ºä½•ä¸­é—´éè¦åŠ ä¸ªkafkaå‘¢ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1589472511,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1632728,"avatar":"https://static001.geekbang.org/account/avatar/00/18/e9/d8/026493cc.jpg","nickname":"vivi","note":"","ucode":"1A02D8396F538B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1965236,"avatar":"","nickname":"Geek_c703f7","note":"","ucode":"0D49860F83534E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":266930,"discussion_content":"é‚£ä¼šåˆšæ¥è§¦canal å°±å¤šæ­¤ä¸€ä¸¾äº†ğŸ˜‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589560045,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":266227,"ip_address":""},"score":266930,"extra":""},{"author":{"id":1024486,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a1/e6/50da1b2d.jpg","nickname":"æ—­ä¸œ(Frank)","note":"","ucode":"176FA629800062","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1965236,"avatar":"","nickname":"Geek_c703f7","note":"","ucode":"0D49860F83534E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":326658,"discussion_content":"æœ‰å¼‚å¸¸canalä¼šæš‚åœæ¶ˆè´¹å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605657474,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":266227,"ip_address":""},"score":326658,"extra":""}]},{"author":{"id":1178235,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fa/7b/f89a398b.jpg","nickname":"Charles | å§œæµ·é¾™","note":"","ucode":"17BA74D1684184","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":282649,"discussion_content":"viviå¾ˆå‰å®³å•Šï¼Œæ¯æ¬¡éƒ½èƒ½æå‡ºè‡ªå·±ä¸é”™çš„è§è§£ï¼Œæƒ³æ¥åŒ—äº¬å‘å±•å—ï¼Œç»™ä½ å†…æ¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592037357,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1632728,"avatar":"https://static001.geekbang.org/account/avatar/00/18/e9/d8/026493cc.jpg","nickname":"vivi","note":"","ucode":"1A02D8396F538B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1178235,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fa/7b/f89a398b.jpg","nickname":"Charles | å§œæµ·é¾™","note":"","ucode":"17BA74D1684184","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":286300,"discussion_content":"ä¸å¥½æ„æ€å•Š  æ‰çœ‹åˆ°æ‚¨çš„æ¶ˆæ¯  è¯·é—®æ‚¨è¿™è¾¹æ˜¯ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593112941,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":282649,"ip_address":""},"score":286300,"extra":""}]}]},{"had_liked":false,"id":216303,"user_name":"æ¯å¤©æ™’ç™½ç‰™","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1589237666,"is_pvip":false,"replies":[{"id":"80037","content":"æ˜¯çš„ï¼Œæˆ–è®¸æœ¬æ–‡æ ‡é¢˜å¯ä»¥æ”¹ä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼šXXX ğŸ˜€ï¼Œä¸è¿‡æ–‡ä¸­çš„ä¸€äº›ç‚¹æ˜¯å¯ä»¥æ³›åŒ–åˆ°ä½ æåˆ°çš„ä¸¤ç§å¼‚æ­¥å¤„ç†çš„<br><br>æ€è€ƒé¢˜ä¸€æ˜¯æˆ‘çœŸå®é‡åˆ°çš„é—®é¢˜ï¼Œå½“æ—¶å€’ä¸æ˜¯å› ä¸ºä¸»ä»çš„é—®é¢˜ï¼Œè€Œæ˜¯å› ä¸ºä¸šåŠ¡ä»£ç æŠŠä¿å­˜æ•°æ®å’Œå‘MQæ¶ˆæ¯æ”¾åœ¨äº†ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œæœ‰æ¦‚ç‡æ”¶åˆ°æ¶ˆæ¯çš„æ—¶å€™äº‹åŠ¡è¿˜æ²¡æœ‰æäº¤å®Œæˆï¼Œå½“æ—¶å¼€å‘åŒå­¦çš„å¤„ç†æ–¹å¼æ˜¯æ”¶MQæ¶ˆæ¯çš„æ—¶å€™sleep 1ç§’ï¼Œæˆ–è®¸åº”è¯¥æ˜¯å…ˆæäº¤äº‹åŠ¡ï¼Œå®Œæˆåå†å‘MQæ¶ˆæ¯ï¼Œä½†æ˜¯è¿™åˆå‡ºæ¥ä¸€ä¸ªé—®é¢˜MQæ¶ˆæ¯å‘é€å¤±è´¥æ€ä¹ˆåŠï¼Ÿæ‰€ä»¥åæ¥æ¼”åŒ–ä¸ºå»ºç«‹æœ¬åœ°æ¶ˆæ¯è¡¨æ¥ç¡®ä¿MQæ¶ˆæ¯å¯è¡¥å¿ï¼ŒæŠŠä¸šåŠ¡å¤„ç†å’Œä¿å­˜MQæ¶ˆæ¯åˆ°æœ¬åœ°æ¶ˆæ¯è¡¨æ“ä½œåœ¨ç›¸åŒäº‹åŠ¡å†…å¤„ç†ï¼Œç„¶åå¼‚æ­¥å‘é€å’Œè¡¥å¿å‘é€æ¶ˆæ¯è¡¨ä¸­çš„æ¶ˆæ¯åˆ°MQ","user_name":"ä½œè€…å›å¤","comment_id":216303,"uid":"1001470","ip_address":"","utype":1,"ctime":1589241443,"user_name_real":"æœ±æ™”"}],"discussion_count":9,"race_medal":1,"score":"87488583586","product_id":100047701,"comment_content":"è€å¸ˆï¼Œæˆ‘ç†è§£çš„å¼‚æ­¥å¤„ç†ä¸ä»…ä»…æ˜¯é€šè¿‡ MQ æ¥å®ç°ï¼Œè¿˜æœ‰å…¶ä»–æ–¹å¼<br>æ¯”å¦‚å¼€æ–°çº¿ç¨‹æ‰§è¡Œï¼Œè¿”å› Future<br>è¿˜æœ‰å„ç§å¼‚æ­¥æ¡†æ¶ï¼Œæ¯”å¦‚ Vertxï¼Œå®ƒæ˜¯é€šè¿‡ callback çš„æ–¹å¼å®ç°<br><br>æ€è€ƒé¢˜<br>1.å¯èƒ½æ˜¯æ•°æ®å†™åˆ°äº†ä¸»åº“ï¼Œç„¶åæŸ¥è¯¢äº†ä»åº“ã€‚ä½†å› ä¸ºä¸»ä»åŒæ­¥æœ‰å»¶è¿Ÿï¼Œå¯¼è‡´æ²¡æœ‰æŸ¥è¯¢åˆ°","like_count":21,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494761,"discussion_content":"æ˜¯çš„ï¼Œæˆ–è®¸æœ¬æ–‡æ ‡é¢˜å¯ä»¥æ”¹ä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼šXXX ğŸ˜€ï¼Œä¸è¿‡æ–‡ä¸­çš„ä¸€äº›ç‚¹æ˜¯å¯ä»¥æ³›åŒ–åˆ°ä½ æåˆ°çš„ä¸¤ç§å¼‚æ­¥å¤„ç†çš„\n\næ€è€ƒé¢˜ä¸€æ˜¯æˆ‘çœŸå®é‡åˆ°çš„é—®é¢˜ï¼Œå½“æ—¶å€’ä¸æ˜¯å› ä¸ºä¸»ä»çš„é—®é¢˜ï¼Œè€Œæ˜¯å› ä¸ºä¸šåŠ¡ä»£ç æŠŠä¿å­˜æ•°æ®å’Œå‘MQæ¶ˆæ¯æ”¾åœ¨äº†ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œæœ‰æ¦‚ç‡æ”¶åˆ°æ¶ˆæ¯çš„æ—¶å€™äº‹åŠ¡è¿˜æ²¡æœ‰æäº¤å®Œæˆï¼Œå½“æ—¶å¼€å‘åŒå­¦çš„å¤„ç†æ–¹å¼æ˜¯æ”¶MQæ¶ˆæ¯çš„æ—¶å€™sleep 1ç§’ï¼Œæˆ–è®¸åº”è¯¥æ˜¯å…ˆæäº¤äº‹åŠ¡ï¼Œå®Œæˆåå†å‘MQæ¶ˆæ¯ï¼Œä½†æ˜¯è¿™åˆå‡ºæ¥ä¸€ä¸ªé—®é¢˜MQæ¶ˆæ¯å‘é€å¤±è´¥æ€ä¹ˆåŠï¼Ÿæ‰€ä»¥åæ¥æ¼”åŒ–ä¸ºå»ºç«‹æœ¬åœ°æ¶ˆæ¯è¡¨æ¥ç¡®ä¿MQæ¶ˆæ¯å¯è¡¥å¿ï¼ŒæŠŠä¸šåŠ¡å¤„ç†å’Œä¿å­˜MQæ¶ˆæ¯åˆ°æœ¬åœ°æ¶ˆæ¯è¡¨æ“ä½œåœ¨ç›¸åŒäº‹åŠ¡å†…å¤„ç†ï¼Œç„¶åå¼‚æ­¥å‘é€å’Œè¡¥å¿å‘é€æ¶ˆæ¯è¡¨ä¸­çš„æ¶ˆæ¯åˆ°MQ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589241443,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1002939,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4d/bb/abb7bfe3.jpg","nickname":"csyangchsh","note":"","ucode":"8604F5C839710B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":268569,"discussion_content":"å…¶å®è¦ä¿è¯æ•°æ®åº“äº‹åŠ¡æäº¤æˆåŠŸåå†å‘é€æ¶ˆæ¯ï¼ŒSpringé‡Œé¢å¯ä»¥è€ƒè™‘ä½¿ç”¨TransactionSynchronizationã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1589803224,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1324190,"avatar":"https://static001.geekbang.org/account/avatar/00/14/34/9e/96f6b34e.jpg","nickname":"â„ƒä¸è¦è¯´è¯","note":"","ucode":"59A4BBD34BFE1C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":352919,"discussion_content":"rocketmqçš„äº‹åŠ¡æ¶ˆæ¯ä¹Ÿå¯ä»¥å¤„ç†è¿™ç§åœºæ™¯","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1614910667,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1004698,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","nickname":"æ¯å¤©æ™’ç™½ç‰™","note":"","ucode":"A1B102CD933DEA","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":263675,"discussion_content":"çœ‹å®Œè€å¸ˆçš„æ¡ˆä¾‹åˆ†äº«ï¼Œæˆ‘æƒ³çš„è¿˜æ˜¯å¤ªç®€å•äº†ï¼Œå­¦åˆ°äº†ï¼Œè°¢è°¢è€å¸ˆ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1589241673,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1023101,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/9c/7d/774e07f9.jpg","nickname":"studyçš„ç¨‹åºå‘˜","note":"","ucode":"E5AE9037D24429","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536094,"discussion_content":"å¯ä»¥ç”¨å»¶æ—¶é˜Ÿåˆ—å‘€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638684230,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2378309,"avatar":"https://static001.geekbang.org/account/avatar/00/24/4a/45/e048531a.jpg","nickname":"è¿ªç±³ä¹Œæ ¼æ–¯","note":"","ucode":"1D4393746DCBCE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373515,"discussion_content":"ç¡®å®,æˆ‘ä¹Ÿåªæƒ³åˆ°äº†ä¸»ä»å»¶è¿Ÿ, å¯¹äºäº‹åŠ¡è¿™ä¸€å—æ²¡æœ‰è€ƒè™‘åˆ°,è°¢è°¢è€å¸ˆçš„æŒ‡ç‚¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620754139,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1046545,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f8/11/c62a583d.jpg","nickname":"333","note":"","ucode":"A0BA53EBAD81EF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338036,"discussion_content":"è¿™ä¸ªä¸å°±æ˜¯äº‹åŠ¡æ€§å‘ä»¶ç®±å—ï¼ŸTransaction Outboxï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609159212,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1162714,"avatar":"https://static001.geekbang.org/account/avatar/00/11/bd/da/3d76ea74.jpg","nickname":"çœ‹ä¸åˆ°deé¢œè‰²","note":"","ucode":"88348CCAE81931","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285125,"discussion_content":"è€å¸ˆè¯´çš„æ¡ˆä¾‹åº”è¯¥å°±æ˜¯æ¶ˆæ¯é˜Ÿåˆ—å®ç°åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸€ç§å¤„ç†æ–¹å¼å§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592747472,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1200858,"avatar":"https://static001.geekbang.org/account/avatar/00/12/52/da/a6f990b6.jpg","nickname":"tttw","note":"","ucode":"36EF5E82704346","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":263930,"discussion_content":"é€šè¿‡æ¶ˆæ¯é˜Ÿåˆ—å®ç°æœ€ç»ˆä¸€è‡´æ€§åˆ†å¸ƒå¼äº‹åŠ¡ä¹Ÿæ˜¯è¿™ç§æ–¹å¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589267397,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":216458,"user_name":"Darren","can_delete":false,"product_type":"c1","uid":1254968,"ip_address":"","ucode":"CCD2B2C492BE9A","user_header":"https://static001.geekbang.org/account/avatar/00/13/26/38/ef063dc2.jpg","comment_is_top":false,"comment_ctime":1589263574,"is_pvip":true,"replies":[{"id":"80103","content":"æ„Ÿè°¢åˆ†äº« ğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","comment_id":216458,"uid":"1001470","ip_address":"","utype":1,"ctime":1589265021,"user_name_real":"æœ±æ™”"}],"discussion_count":6,"race_medal":0,"score":"78898674902","product_id":100047701,"comment_content":"ç¬¬ä¸€ä¸ªé—®é¢˜ï¼š<br>\tæ¯å¤©æ™’ç™½ç‰™å¤§ä½¬çš„å›ç­”å’Œè€å¸ˆçš„å›å¤å·²ç»å¾ˆæ£’äº†ï¼Œæˆ‘å°±ä¸ç­é—¨å¼„æ–§äº†ã€‚<br>ç¬¬äºŒä¸ªé—®é¢˜ï¼š<br>\tè‡ªå®šä¹‰çš„ç§ä¿¡é˜Ÿåˆ—ï¼Œå…¶å®æ˜¯å‘é€å¤±è´¥ï¼Œä¸»è¦æ˜¯ç”Ÿäº§è€…å‘é€åˆ°mqçš„æ—¶å€™ï¼Œå‘é€å¤±è´¥ï¼Œè¿›äº†è‡ªå®šä¹‰çš„ç§ä¿¡é˜Ÿåˆ—ï¼›<br>\tDLXçš„æ–¹å¼çš„æ–¹å¼å…¶å®è§£å†³å·²åˆ°äº†mqï¼Œä½†æ˜¯å› ä¸ºå„ç§åŸå› ï¼Œæ— æ³•åˆ°è¾¾æ­£å¸¸çš„é˜Ÿåˆ—ä¸­ï¼Œå¤§æ¦‚åˆ†ç±»ä¸‹é¢å‡ ç§å§ï¼š<br>\t\tæ¶ˆæ¯æ¶ˆè´¹æ—¶è¢«æ‹’ç»(basic.reject &#47; basic.nack)ï¼Œå¹¶ä¸”requeue = false<br>\t\tæ¶ˆæ¯TTLè¿‡æœŸ<br>\t\té˜Ÿåˆ—è¾¾åˆ°æœ€å¤§é•¿åº¦<br><br>åˆ†äº«ä¸€ä¸‹ä¹‹å‰åœ¨å…¬å¸å†…éƒ¨åˆ†äº«çš„RabbitMQçš„èµ„æ–™ï¼Œæ¬¢è¿å¤§å®¶äº¤æµ<br>githubä¸Šä¼ ä¸ä¸Šå»ï¼Œåªèƒ½ç”¨æœ‰é“äº‘ç¬”è®°ï¼Œè¯·å¤§å®¶è§è°…<br>èµ„æ–™ä¸»è¦ä»ï¼š<br>    MQé€‰å‹åŠç‰¹ç‚¹ï¼›<br>    AMQPä¸RabbitMQæ¨¡å‹ï¼›<br>    RabbitMQæ ¸å¿ƒæ¦‚å¿µï¼›<br>    RabbitMQç›¸å…³æœºåˆ¶ï¼›<br>è¿™å‡ ä¸ªç‚¹å»åˆ†æçš„ï¼Œè¯·å¤§å®¶å¤šå¤šæŒ‡æ•™ã€‚<br>http:&#47;&#47;note.youdao.com&#47;noteshare?id=e9f2f88c6c7fcb7ac690463eb230650a<br>","like_count":19,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494826,"discussion_content":"æ„Ÿè°¢åˆ†äº« ğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589265021,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1791614,"avatar":"","nickname":"èŒä¸šé€å¥¶å·¥","note":"","ucode":"422666312C0BBA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341608,"discussion_content":"æ„Ÿè°¢~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610461120,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1015483,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7e/bb/947c329a.jpg","nickname":"ç¨‹åºå‘˜å°è·ƒ","note":"","ucode":"25BB96E0791A60","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":317232,"discussion_content":"æ„Ÿè°¢å¤§ä½¬çš„åˆ†äº«","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603519614,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1992424,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep3sqfTQey7eKYgGibLnAvaNj9k8gVvIYKVADicOA3DxmXZcDrAkeM8iaJLruiblmEVUr3q2LOVLvYicTw/132","nickname":"éƒ‘å…ˆç”Ÿ","note":"","ucode":"AA0BA751C4F132","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303249,"discussion_content":"å¤§ä½¬éƒ½å¤ªè°¦è™šäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599200528,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1344529,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI85Y2Va9sKp8bOCCsjK7ABt6H6qzxunXk2zUJpdrOgoXergdAGfibEVoqKs0Zz8RicxmQyQiaRcx5nA/132","nickname":"asia","note":"","ucode":"1876DD836EFCE3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285906,"discussion_content":"çœ‹å®Œäº† åœ¨çœ‹çš„è¿‡ç¨‹ä¸­ å¯¹mqçš„ä¸€äº›ç–‘é—®æ‰¾åˆ°äº†ç­”æ¡ˆ è°¢è°¢åˆ†äº« thank you very much","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592987791,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1232129,"avatar":"https://static001.geekbang.org/account/avatar/00/12/cd/01/c7c9f2f4.jpg","nickname":"kfighter","note":"","ucode":"741CE8A22E5391","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":264021,"discussion_content":"èµ„æ–™å¾ˆæ£’","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589281633,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":216471,"user_name":"203ã€‚","can_delete":false,"product_type":"c1","uid":1903586,"ip_address":"","ucode":"25D508AB07A2FE","user_header":"https://static001.geekbang.org/account/avatar/00/1d/0b/e2/a4eddbe6.jpg","comment_is_top":false,"comment_ctime":1589267013,"is_pvip":false,"replies":[{"id":"80107","content":"æ¯”å¦‚ä¸‹é¢çš„ç±»ï¼Œid1å’Œid2é‡å¤è®¤ä¸ºæ˜¯é‡å¤çš„ï¼Œid3ä¸éœ€è¦è€ƒè™‘<br>@Data<br>\t@Builder<br>\t@NoArgsConstructor<br>\t@AllArgsConstructor<br>\tstatic class Test {<br>\t\tprivate String id1;<br>\t\tprivate String id2;<br>\t\t@EqualsAndHashCode.Exclude<br>\t\tprivate String id3;<br>\t}<br><br>é€šè¿‡Setå»é‡æˆ–è€…é€šè¿‡distinctå»é‡å³å¯ï¼š<br><br>List&lt;Test&gt; list = new ArrayList&lt;&gt;();<br>\t\tlist.add(new Test(&quot;a&quot;,&quot;b&quot;,&quot;c&quot;));<br>\t\tlist.add(new Test(&quot;a&quot;,&quot;b&quot;,&quot;d&quot;));<br>\t\tSystem.out.println(list.stream().collect(Collectors.toSet()));<br>\t\tSystem.out.println(list.stream().distinct().collect(Collectors.toList()));","user_name":"ä½œè€…å›å¤","comment_id":216471,"uid":"1001470","ip_address":"","utype":1,"ctime":1589269911,"user_name_real":"æœ±æ™”"}],"discussion_count":2,"race_medal":0,"score":"31654038085","product_id":100047701,"comment_content":"è€å¸ˆ æˆ‘è¿™é‡Œæœ‰ä¸ªé—®é¢˜ å…³äºStreamçš„ï¼Œä¸šåŠ¡éœ€æ±‚é‡Œéœ€è¦æŒ‰æŸå‡ ä¸ªå­—æ®µå»é‡(acctId,billingCycleId,prodInstId,offerId)<br>æˆ‘è¿™é‡Œæƒ³åˆ°äº†éå†é›†åˆareaDatas åç”¨containsæ–¹æ³•åˆ¤æ–­ é‡å†™AcctItemYzfBeanå®ä½“ç±»çš„equalsæ–¹æ³•å®ç°ï¼Œ<br>è¯·é—®æœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Ÿ ä»£ç å¦‚ä¸‹<br><br>List&lt;AcctItemYzfBean&gt; newList = new CopyOnWriteArrayList&lt;&gt;();<br>&#47;&#47;å¾ªç¯è¿‡æ»¤ã€å¢å¼ºç¿¼æ”¯ä»˜æ•°æ®<br>Optional.ofNullable(areaDatas)&#47;&#47;é›†åˆåˆ¤ç©º<br>\t\t.orElse(new ArrayList&lt;&gt;())<br>\t\t.stream()&#47;&#47;è½¬åŒ–ä¸ºæµ ä¾¿äºä¸‹é¢è¿‡æ»¤å’Œå¢å¼ºæ•°æ®<br>\t\t.filter(Objects::nonNull)&#47;&#47;å…ƒç´ åˆ¤ç©º<br>\t\t.filter(yzfBean -&gt; this.judgeIfOfferId(yzfBean))&#47;&#47;åˆ¤æ–­é”€å”®å“IDæ˜¯å¦ç›¸åŒ<br>\t\t.filter(yzfBean -&gt; this.enhanceYzfBean(yzfBean))&#47;&#47;å¢å¼ºè¿‡æ»¤accNbrå’ŒacctId<br>\t\t.filter(yzfBean -&gt; this.judgeIfArrears(yzfBean))&#47;&#47;åˆ¤æ–­æ˜¯å¦ä¸æ¬ è´¹<br>\t\t.filter(yzfBean -&gt; this.judgeIfCancel(yzfBean))&#47;&#47;åˆ¤æ–­æ˜¯å¦é”€è´¦é‡‘é¢å¤§äº0<br>\t\t.filter(yzfBean -&gt; this.judgeIfReturn(yzfBean))&#47;&#47;åˆ¤æ–­æ˜¯å¦ä¸Šæœˆæœªè¿”è¿˜<br>\t\t.forEach(yzfBean -&gt; {<br>\t\t\t&#47;&#47;å»é‡ é‡å†™AcctItemYzfBean.equalsæ–¹æ³•<br>\t\t\tif(!newList.contains(yzfBean)) {<br>\t\t\t\t&#47;&#47;å¢å¼ºlatnName<br>\t\t\t\tyzfBean.setLatnName(commonRegionMap.get(yzfBean.getRegionId()));<br>\t\t\t\t&#47;&#47;å¢å¼ºareaCode<br>\t\t\t\tyzfBean.setAreaCode(areaCode);<br>\t\t\t\t&#47;&#47;æ•°æ®å°è£…<br>\t\t\t\tnewList.add(yzfBean);<br>\t\t\t}<br>\t\t});<br><br>é‡å†™çš„equalsæ–¹æ³•\t\t<br>@Override<br>public boolean equals(Object yzfBeanObj) {<br>\tif(yzfBeanObj instanceof AcctItemYzfBean) {<br>\t\tAcctItemYzfBean yzfBean = (AcctItemYzfBean) yzfBeanObj;<br>\t\tif(Tools.isEmpty(yzfBean.getAcctId(), yzfBean.getBillingCycleId(), yzfBean.getProdInstId(),  yzfBean.getOfferId())) {<br>\t\t\treturn false;<br>\t\t}<br>\t\tif(yzfBean.getAcctId().equals(this.acctId) &amp;&amp; yzfBean.getBillingCycleId().equals(this.billingCycleId)<br>\t\t\t\t&amp;&amp; yzfBean.getProdInstId().equals(this.prodInstId) &amp;&amp; yzfBean.getOfferId().equals(this.offerId)) {<br>\t\t\treturn true;<br>\t\t}<br>\t}<br>\treturn super.equals(yzfBeanObj);<br>}","like_count":7,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494832,"discussion_content":"æ¯”å¦‚ä¸‹é¢çš„ç±»ï¼Œid1å’Œid2é‡å¤è®¤ä¸ºæ˜¯é‡å¤çš„ï¼Œid3ä¸éœ€è¦è€ƒè™‘\n@Data\n\t@Builder\n\t@NoArgsConstructor\n\t@AllArgsConstructor\n\tstatic class Test {\n\t\tprivate String id1;\n\t\tprivate String id2;\n\t\t@EqualsAndHashCode.Exclude\n\t\tprivate String id3;\n\t}\n\né€šè¿‡Setå»é‡æˆ–è€…é€šè¿‡distinctå»é‡å³å¯ï¼š\n\nList&amp;lt;Test&amp;gt; list = new ArrayList&amp;lt;&amp;gt;();\n\t\tlist.add(new Test(&amp;quot;a&amp;quot;,&amp;quot;b&amp;quot;,&amp;quot;c&amp;quot;));\n\t\tlist.add(new Test(&amp;quot;a&amp;quot;,&amp;quot;b&amp;quot;,&amp;quot;d&amp;quot;));\n\t\tSystem.out.println(list.stream().collect(Collectors.toSet()));\n\t\tSystem.out.println(list.stream().distinct().collect(Collectors.toList()));","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589269911,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1903586,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/0b/e2/a4eddbe6.jpg","nickname":"203ã€‚","note":"","ucode":"25D508AB07A2FE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":264538,"discussion_content":"å“¦å“¦ï¼Œæ„æ€æ˜¯distinctå»é‡å¿…é¡»é‡å†™å®ä½“ç±»çš„equalsæ–¹æ³•å’ŒhashCodeæ–¹æ³•ï¼Œæˆ‘æ˜ç™½äº† è°¢è°¢è€å¸ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589332714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":218148,"user_name":"ä¼¼æ›¾ç›¸è¯†","can_delete":false,"product_type":"c1","uid":1971079,"ip_address":"","ucode":"DCBA5F6ABC7401","user_header":"https://static001.geekbang.org/account/avatar/00/1e/13/87/73a17c60.jpg","comment_is_top":false,"comment_ctime":1589724540,"is_pvip":false,"replies":[{"id":"80702","content":"è¿™åªæ˜¯demoç”Ÿäº§åº”ç”¨è‚¯å®šç”¨æ•°æ®åº“åšå¹‚ç­‰çš„","user_name":"ä½œè€…å›å¤","comment_id":218148,"uid":"1001470","ip_address":"","utype":1,"ctime":1589764427,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"14474626428","product_id":100047701,"comment_content":"è€å¸ˆ <br>1.å¦‚æœå®é™…ç”Ÿäº§ä¸­ç”¨ä½¿ç”¨ ConcurrentHashMap æ¥å­˜æ”¾é‚£äº›å‘è¿‡çŸ­ä¿¡çš„ç”¨æˆ· ID å®ç°å¹‚ç­‰ï¼Œå¦‚ä½•ä¸€ç›´å¾€mapä¸­å¢åŠ ï¼Œä¼šä¸ä¼šoomå‘¢ï¼Ÿ<br>2.å¦‚æœæ•°æ®é‡å·¨å¤§ ä½¿ç”¨ConcurrentSkipListMap è·³è¡¨ä¼šä¸ä¼šæ›´å¥½ä¸€äº›å‘¢ï¼Ÿ<br>","like_count":4,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495362,"discussion_content":"è¿™åªæ˜¯demoç”Ÿäº§åº”ç”¨è‚¯å®šç”¨æ•°æ®åº“åšå¹‚ç­‰çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589764427,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":256076,"user_name":"ç¨‹åºå‘˜å°è·ƒ","can_delete":false,"product_type":"c1","uid":1015483,"ip_address":"","ucode":"25BB96E0791A60","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7e/bb/947c329a.jpg","comment_is_top":false,"comment_ctime":1603520372,"is_pvip":true,"discussion_count":2,"race_medal":0,"score":"10193454964","product_id":100047701,"comment_content":"é—®é¢˜ä¸€å‡ºç°çš„é—®é¢˜æˆ‘ä¹Ÿé‡åˆ°äº†ï¼Œå’Œè¯„è®ºåŒºåŒ…æ‹¬å’Œè€å¸ˆé‡åˆ°çš„é—®é¢˜ä¸€æ ·ï¼Œè¿˜æ˜¯å› ä¸ºåœ¨äº‹åŠ¡æ²¡å®Œæˆçš„æ—¶å€™è¿›è¡Œäº†æäº¤ï¼Œå°±ä¼šäº§ç”Ÿæ¦‚ç‡æ€§çš„æŸ¥è¯¢ä¸åˆ°ç»“æœã€‚<br><br>è¿™ç§é”™è¯¯ï¼Œç»å†è¿‡ä¸€æ¬¡ï¼Œåé¢çš„äº‹æƒ…å°±å¥½åŠäº†ï¼Œä¼šå½“åšä¸€ä¸ªtipså§‹ç»ˆè®°åœ¨å¿ƒé‡Œï¼Œç¼–ç çš„æ—¶å€™ä¹Ÿä¸€ç›´æ³¨æ„ç€ ã€‚æ²¡æƒ³åˆ°åœ¨è¿™é‡Œè¿˜èƒ½å’Œå¤§å®¶é‡åˆ°ç±»ä¼¼çš„é—®é¢˜ï¼Œå¹¸ä¼šå¹¸ä¼š","like_count":3,"discussions":[{"author":{"id":1848364,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/34/2c/cd158db1.jpg","nickname":"å°åˆ˜","note":"","ucode":"F50BCF1E9D285A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":411839,"discussion_content":"æˆ‘ä¹Ÿé‡åˆ°äº†ï¼Œç¡®å®æ˜¯æ·±åˆ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636016314,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2378309,"avatar":"https://static001.geekbang.org/account/avatar/00/24/4a/45/e048531a.jpg","nickname":"è¿ªç±³ä¹Œæ ¼æ–¯","note":"","ucode":"1D4393746DCBCE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373517,"discussion_content":"ç¡®å®, æ•°æ®åº“äº‹åŠ¡è¿™ç§æƒ…å†µå…¶å®é‡åˆ°ä¸€æ¬¡å°±å¾ˆéš¾å¿˜è®°äº†,å¤ªç»å…¸äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620754260,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":216611,"user_name":"ç‹é¹","can_delete":false,"product_type":"c1","uid":1934785,"ip_address":"","ucode":"B79003C125BE00","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Pu41KPIhAp72l0N7kOFL738owSAIT5EyH0oUUMacQRWzeFV77QDjSDNTSFNvjNZib1myibvxAfQAsAY5KzsIia73w/132","comment_is_top":false,"comment_ctime":1589295539,"is_pvip":false,"replies":[{"id":"80132","content":"æ˜¯ï¼Œæˆ‘é‡åˆ°çš„å°±æ˜¯è¿™ä¸ªæƒ…å†µ","user_name":"ä½œè€…å›å¤","comment_id":216611,"uid":"1001470","ip_address":"","utype":1,"ctime":1589296867,"user_name_real":"æœ±æ™”"}],"discussion_count":3,"race_medal":0,"score":"10179230131","product_id":100047701,"comment_content":"mqå‘ä¿¡æ¯å†™åˆ°äº†äº‹åŠ¡ä¸­ï¼Œå¯¼è‡´äº†mqçš„æ¶ˆè´¹æ—¶ï¼Œäº‹åŠ¡è¿˜æ²¡æœ‰æäº¤","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494881,"discussion_content":"æ˜¯ï¼Œæˆ‘é‡åˆ°çš„å°±æ˜¯è¿™ä¸ªæƒ…å†µ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589296867,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2405757,"avatar":"https://static001.geekbang.org/account/avatar/00/24/b5/7d/d2b40599.jpg","nickname":"Joker","note":"","ucode":"5D6838BF021AE2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":340433,"discussion_content":"è¿™ç§è§£å†³åŠæ³•æ˜¯å§å‘æ¶ˆæ¯çš„æ“ä½œæ”¾åˆ°controllerï¼Ÿæ¶ˆæ¯å‘é€æ˜¯å¦æˆåŠŸåˆ©ç”¨rabbitmqçš„confirmæœºåˆ¶æ¥ç¡®ä¿ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610005653,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1195258,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3c/fa/e2990931.jpg","nickname":"æ–‡æ•¦å¤","note":"","ucode":"B8F4A6BD5D7805","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2405757,"avatar":"https://static001.geekbang.org/account/avatar/00/24/b5/7d/d2b40599.jpg","nickname":"Joker","note":"","ucode":"5D6838BF021AE2","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387940,"discussion_content":"ã€‚ã€‚ã€‚ä½ å®Œå…¨å¯ä»¥ç”¨ä¸€ä¸ªXXManageræˆ–è€…å¦å¤–çš„ServerviceåŒ…è£…ä¸‹å•Šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628503356,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":340433,"ip_address":""},"score":387940,"extra":""}]}]},{"had_liked":false,"id":216340,"user_name":"éƒ­çŸ³é¾™","can_delete":false,"product_type":"c1","uid":1998819,"ip_address":"","ucode":"EB963343AA10DD","user_header":"","comment_is_top":false,"comment_ctime":1589244569,"is_pvip":false,"replies":[{"id":"80054","content":"è¡¥å¿éœ€è¦é…åˆå¹‚ç­‰","user_name":"ä½œè€…å›å¤","comment_id":216340,"uid":"1001470","ip_address":"","utype":1,"ctime":1589246441,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"10179179161","product_id":100047701,"comment_content":"è€å¸ˆï¼Œä½ å¥½ï¼Œå¦‚æœæœ‰å¤šä¸ªè¡¥å¿å®ä¾‹ï¼Œä¼šä¸ä¼šé€ æˆæ¶ˆæ¯é‡å¤ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494782,"discussion_content":"è¡¥å¿éœ€è¦é…åˆå¹‚ç­‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589246441,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":250324,"user_name":"é²é¸£","can_delete":false,"product_type":"c1","uid":2152306,"ip_address":"","ucode":"974BA3C3E64630","user_header":"https://static001.geekbang.org/account/avatar/00/20/d7/72/cbef720d.jpg","comment_is_top":false,"comment_ctime":1601025263,"is_pvip":false,"replies":[{"id":"91669","content":"è¿™å°±æ˜¯æ¶ˆæ¯äº‹åŠ¡è¡¨æ¨¡å¼","user_name":"ä½œè€…å›å¤","comment_id":250324,"uid":"1001470","ip_address":"","utype":1,"ctime":1601033179,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"5895992559","product_id":100047701,"comment_content":"åœ¨event sourcingçš„æ—¶å€™ï¼Œæœ‰ä¸€ç§æ–¹æ¡ˆæ˜¯outboxï¼Œåœ¨å‘é€æ–¹ç»´æŒä¸€ä¸ªæ•°æ®è¡¨ï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ¶ˆæ¯å’Œä¸šåŠ¡æ•°æ®åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œä¹Ÿæ˜¯ä¸€ç§æ¶ˆæ¯å‘é€è®°å½•çš„æ–¹å¼","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506184,"discussion_content":"è¿™å°±æ˜¯æ¶ˆæ¯äº‹åŠ¡è¡¨æ¨¡å¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601033179,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":217578,"user_name":"Gå°è°ƒ","can_delete":false,"product_type":"c1","uid":1145529,"ip_address":"","ucode":"8F3D50E2C1A559","user_header":"https://static001.geekbang.org/account/avatar/00/11/7a/b9/c3d3a92f.jpg","comment_is_top":false,"comment_ctime":1589536805,"is_pvip":true,"replies":[{"id":"80487","content":"å…¶å®è¿™å°±æ˜¯æœ¬åœ°äº‹åŠ¡æ¶ˆæ¯çš„å®ç°  ç¬¬äºŒæ­¥ä¸ä¸€å®šéœ€è¦å®šæ—¶ä»»åŠ¡æ‹‰å– ç¬¬ä¸€æ­¥å®Œæˆåç›´æ¥å‘mqå³å¯ å®šæ—¶ä»»åŠ¡æ‹‰å–åªç”¨æ¥è¡¥å¿","user_name":"ä½œè€…å›å¤","comment_id":217578,"uid":"1001470","ip_address":"","utype":1,"ctime":1589547251,"user_name_real":"æœ±æ™”"}],"discussion_count":2,"race_medal":0,"score":"5884504101","product_id":100047701,"comment_content":"ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œæ˜¯å¦å¯ä»¥è¿™æ ·è§£å†³<br>1.å…ˆä¿å­˜ç”¨æˆ·æ³¨å†Œçš„æ•°æ®ï¼ŒåŒæ—¶è®°å½•ä¸‹è¦å‘é€mqçš„æ¶ˆæ¯ï¼Œå…¥åº“åœ¨ä¸€ä¸ªäº‹åŠ¡é‡Œ<br>2.é€šè¿‡å¼‚æ­¥ä»»åŠ¡å®šæ—¶æ‹‰å–mqçš„æ¶ˆæ¯è¡¨ï¼Œå‘é€åˆ°mqï¼Œè¿›è¡Œå¤„ç†<br><br>ä½†è¿™ä¸ªæœ‰ä¸ªé—®é¢˜ï¼Œå¼‚æ­¥ä»»åŠ¡å°±èƒ½æ‰§è¡Œmqçš„çš„ä¸šåŠ¡ï¼Œé‚£mqçš„ä»·å€¼æ˜¯ä¸æ˜¯å‡å°‘äº†","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495187,"discussion_content":"å…¶å®è¿™å°±æ˜¯æœ¬åœ°äº‹åŠ¡æ¶ˆæ¯çš„å®ç°  ç¬¬äºŒæ­¥ä¸ä¸€å®šéœ€è¦å®šæ—¶ä»»åŠ¡æ‹‰å– ç¬¬ä¸€æ­¥å®Œæˆåç›´æ¥å‘mqå³å¯ å®šæ—¶ä»»åŠ¡æ‹‰å–åªç”¨æ¥è¡¥å¿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589547251,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1195258,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3c/fa/e2990931.jpg","nickname":"æ–‡æ•¦å¤","note":"","ucode":"B8F4A6BD5D7805","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387939,"discussion_content":"ç”¨æˆ·æ³¨å†Œå’Œå­˜å‚¨MQæ”¾ä¸€ä¸ªäº‹åŠ¡å¹¶ä¸å¥½ï¼Œå› ä¸ºå°†ç”¨æˆ·æ³¨å†Œæ‰æ˜¯ç›®çš„ï¼Œä¸èƒ½å› ä¸ºå­˜å‚¨MQçš„æ¶ˆæ¯çš„å¤±è´¥è€Œå¯¼è‡´ç”¨æˆ·éƒ½æ³¨å†Œä¸æˆåŠŸã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628503285,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":216796,"user_name":"æ±æ—å¤–å²","can_delete":false,"product_type":"c1","uid":1188906,"ip_address":"","ucode":"3C66C0F0537A99","user_header":"https://static001.geekbang.org/account/avatar/00/12/24/2a/33441e2b.jpg","comment_is_top":false,"comment_ctime":1589344980,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5884312276","product_id":100047701,"comment_content":"å“ˆå“ˆï¼Œå†™ä¸€ä¸ªå‡ ç‡æ¯”è¾ƒå°çš„æƒ…å†µï¼šæ³¨å†Œregisterçš„ä»£ç ä¸­æŠŠå¼‚å¸¸éƒ½åƒæ‰äº†ï¼Œæ²¡æŠ›å‡ºæ¥ï¼Œæ³¨å†ŒåˆæŠ¥é”™äº†ï¼Œä½†è¿˜æ˜¯ç»§ç»­æ‰§è¡Œå¹¶ä¸”å‘äº†æ¶ˆæ¯ã€‚","like_count":1},{"had_liked":false,"id":328254,"user_name":"","can_delete":false,"product_type":"c1","uid":2877195,"ip_address":"","ucode":"","user_header":"","comment_is_top":false,"comment_ctime":1640623986,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1640623986","product_id":100047701,"comment_content":"ä½ å¥½ï¼Œè¯·é—®ä¸€ä¸‹ï¼Œ<br>1.æ¯”å¦‚å¼€å¯prefetchã€å¤šå®ä¾‹ã€å¤šæ¶ˆè´¹æ—¶æ˜¯å¦ä¼šå‡ºç°é¢„å–æ¶ˆæ¯é‡å¤ã€‚","like_count":0},{"had_liked":false,"id":302117,"user_name":"walleæ–Œ","can_delete":false,"product_type":"c1","uid":1062848,"ip_address":"","ucode":"0DB3243004951F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","comment_is_top":false,"comment_ctime":1626086695,"is_pvip":false,"replies":[{"id":"109331","content":"@Asyncå’ŒMQåŸç†å®Œå…¨ä¸åŒ","user_name":"ä½œè€…å›å¤","comment_id":302117,"uid":"1001470","ip_address":"","utype":1,"ctime":1626142078,"user_name_real":"æœ±æ™”"}],"discussion_count":2,"race_medal":0,"score":"1626086695","product_id":100047701,"comment_content":"å¯¹äº†  è®¸å¤šåŒæ—¶ç”¨@Asyncæ ‡ç­¾å®ç° å¸Œæœ›èƒ½å¤Ÿåšåˆ°ï¼Œä½†æ˜¯åˆä¸ç”¨100%ä¿è¯çš„è§£è€¦åŠ¨ä½œã€‚å®é™…ä¹Ÿæœ‰éšæ‚£ï¼Œä¸æ”¾æŠŠ@Asyncæ ‡ç­¾åº•å±‚å®ç°æ›´æ¢ä¸ºmqï¼Œæ˜¯ä¸æ˜¯æ›´åˆé€‚ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523187,"discussion_content":"@Asyncå’ŒMQåŸç†å®Œå…¨ä¸åŒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626142078,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1062848,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","nickname":"walleæ–Œ","note":"","ucode":"0DB3243004951F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":544447,"discussion_content":"ğŸ˜ƒæˆ‘è¿™è‡ªç ”äº†ç±»asycæ ‡ç­¾ï¼Œåº•å±‚ç”¨mqå®ç°ï¼Œè§£å†³å…¶é—®é¢˜ï¼Œè¡¥å……äº†ç¼ºé™·ï¼Œä¸è¿‡æœ‰å¾—æœ‰å¤±ï¼Œåº•å±‚mqå®ç°è‚¯å®šæƒ³æ¯”ç›®å‰çº¯çº¿ç¨‹é‡äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641524944,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":523187,"ip_address":""},"score":544447,"extra":""}]}]},{"had_liked":false,"id":302115,"user_name":"walleæ–Œ","can_delete":false,"product_type":"c1","uid":1062848,"ip_address":"","ucode":"0DB3243004951F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ersGSic8ib7OguJv6CJiaXY0s4n9C7Z51sWxTTljklFpq3ZAIWXoFTPV5oLo0GMTkqW5sYJRRnibNqOJQ/132","comment_is_top":false,"comment_ctime":1626086629,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1626086629","product_id":100047701,"comment_content":"é¢ çœ‹å®Œè€å¸ˆç”¨rabbitmq ï¼Œå¾ˆåº†å¹¸å½“æ—¶æŠ€æœ¯é€‰å‹é€‰äº†rocketmqï¼Œè‡ªå¸¦è¡¥å¿ï¼Œæ—¶é—´é€’å¢é‡è¯•ã€‚ã€‚å¤–åŠ æ¶ˆè´¹ç«¯å¤©ç„¶æ”¯æŒå¹¶å‘æ¶ˆè´¹ã€‚æ¶ˆè´¹å¹¶å‘èƒ½åŠ›=  è¯»é˜Ÿåˆ—æ•°* æ¶ˆè´¹ç«¯çš„çº¿ç¨‹æ•°ã€‚ <br>å¤–åŠ rocketmq æ”¯æŒåˆ†å¸ƒå¼äº‹ç‰©ã€‚ã€‚é«˜æ•ˆçš„tagså¹¿æ’­æ¶ˆæ¯æ¶ˆè´¹ï¼Œä½æ•ˆä½†æ˜¯å®šåˆ¶åŒ–æå¼ºçš„sqlç­›é€‰æ¶ˆæ¯æ¶ˆè´¹ï¼Œè€Œä¸”å»¶è¿Ÿä½ï¼Œæ”¯æŒæ¶ˆæ¯å †ç§¯èƒ½åŠ›å¼ºã€‚<br>æ€»ä½“è€Œè¨€ï¼Œã€‚å¯¹äºä¸šåŠ¡è€Œè¨€rocketmqçš„æ˜“ç”¨åº¦ æ˜¯å¥½äºrabbitmqçš„ã€‚è®¸å¤šæ˜¯å› ä¸ºä¹ æƒ¯çš„æƒ¯æ€§è¿˜åœ¨ç”¨rabbitmq","like_count":1},{"had_liked":false,"id":272248,"user_name":"Joker","can_delete":false,"product_type":"c1","uid":2405757,"ip_address":"","ucode":"5D6838BF021AE2","user_header":"https://static001.geekbang.org/account/avatar/00/24/b5/7d/d2b40599.jpg","comment_is_top":false,"comment_ctime":1610005124,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1610005124","product_id":100047701,"comment_content":"å¦‚æœæ˜¯ç”¨æˆ·æ³¨å†Œååœ¨ä¸€ä¸ª db äº‹åŠ¡ä¸­åŒæ—¶æ’å…¥ä¸€æ¡æ¶ˆæ¯åˆ°å‘é€è¡¨ï¼Œå¦‚æœå‘è‡ªå·±çš„ mq æˆåŠŸåˆ™åœ¨äº‹åŠ¡ä¸­åˆ é™¤å‘é€è¡¨çš„æ¶ˆæ¯ï¼Œå¦‚æœ mqbroker å‡ºç°æ•…éšœå‘é€ä¸äº†åˆ™ä¸åˆ é™¤ï¼Œæˆ–è€…åšä¸€ä¸ªæ¶ˆæ¯çŠ¶æ€å­—æ®µæ¥è®°å½•æ˜¯å¦æˆåŠŸå‘é€ï¼Œè¿™æ ·ä¼šçœ‹åˆ°æˆåŠŸå‘mqå¤±è´¥ï¼Œä½†å‘é€è¡¨ä¸­æœ‰å¤±è´¥çš„æ¶ˆæ¯ï¼Œä¹‹åé€šè¿‡ä¸€ä¸ªå®šæ—¶ä»»åŠ¡å®šæœŸé‡å‘å¤±è´¥è¡¨ä¸­çš„å¤±è´¥æ¶ˆæ¯å³å¯ã€‚ä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªè¡¨æ¥ç¡®è®¤æ•°æ®æ˜¯å¦å…¥åº“ï¼Ÿ","like_count":0},{"had_liked":false,"id":256061,"user_name":"Bug? Feature!","can_delete":false,"product_type":"c1","uid":1164531,"ip_address":"","ucode":"F8FA8A0094FBA0","user_header":"https://static001.geekbang.org/account/avatar/00/11/c4/f3/92f654f1.jpg","comment_is_top":false,"comment_ctime":1603516672,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603516672","product_id":100047701,"comment_content":"å¼‚æ­¥å¤„ç†ï¼Œæ­»ä¿¡é˜Ÿåˆ—ï¼Œå­¦ä¹ äº†ï¼Œè°¢è°¢è€å¸ˆ","like_count":0},{"had_liked":false,"id":254466,"user_name":"è¡Œåˆ™å°†è‡³","can_delete":false,"product_type":"c1","uid":1542987,"ip_address":"","ucode":"DB972F2DF059C4","user_header":"https://static001.geekbang.org/account/avatar/00/17/8b/4b/fa52d222.jpg","comment_is_top":false,"comment_ctime":1603118714,"is_pvip":false,"replies":[{"id":"92883","content":"ThreadFactoryBuilderå®Œå…¨å¯ä»¥è‡ªå·±å†™ä¸€ä¸ªï¼Œéå¸¸ç®€å•ï¼Œæ²¡å¿…è¦åƒæˆ‘ä¸€æ ·å¼•å…¥ä¸‰æ–¹åº“","user_name":"ä½œè€…å›å¤","comment_id":254466,"uid":"1001470","ip_address":"","utype":1,"ctime":1603163100,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":1,"score":"1603118714","product_id":100047701,"comment_content":"æˆ‘å‰å‡ å¤©å°±é‡åˆ°äº†é—®é¢˜ä¸€ã€‚æ˜¯å› ä¸ºmqå‘é€æ¶ˆæ¯åœ¨äº‹åŠ¡æ–¹æ³•é‡Œã€‚mqå‘æ¶ˆæ¯æ—¶ï¼Œæ•°æ®åº“äº‹åŠ¡å¯èƒ½è¿˜æ²¡æœ‰æäº¤(ä¸æ˜¯å¿…ç°)ã€‚<br>è€å¸ˆï¼Œä½ ç”¨çš„ThreadFactoryBuilderï¼Œæˆ‘å¼•å…¥å¯¹åº”çš„ä¾èµ–ä¹‹åï¼Œå‘ç°ä¼šè¯¥ä¾èµ–ä¼šå¼•å…¥å…¶ä»–Nå¤šä¸ªä¸ç›¸å¹²çš„ä¾èµ–ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚æ‚¨æ˜¯å’‹è§£å†³çš„ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":507409,"discussion_content":"ThreadFactoryBuilderå®Œå…¨å¯ä»¥è‡ªå·±å†™ä¸€ä¸ªï¼Œéå¸¸ç®€å•ï¼Œæ²¡å¿…è¦åƒæˆ‘ä¸€æ ·å¼•å…¥ä¸‰æ–¹åº“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603163100,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":252720,"user_name":"Carter","can_delete":false,"product_type":"c1","uid":1030842,"ip_address":"","ucode":"1FD476D8F2BE27","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ba/ba/83de3488.jpg","comment_is_top":false,"comment_ctime":1602466368,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602466368","product_id":100047701,"comment_content":"ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šå‘é€æ¶ˆæ¯åœ¨MySQLäº‹åŠ¡é‡Œï¼Œäº‹åŠ¡æœªæäº¤ï¼Œä½†æ˜¯æ¶ˆæ¯è¢«æ¶ˆè´¹äº†ã€‚","like_count":0},{"had_liked":false,"id":247191,"user_name":"è‹—","can_delete":false,"product_type":"c1","uid":1088710,"ip_address":"","ucode":"5ECCC6C855E541","user_header":"https://static001.geekbang.org/account/avatar/00/10/9c/c6/05a6798f.jpg","comment_is_top":false,"comment_ctime":1599629899,"is_pvip":false,"replies":[{"id":"90781","content":"æ ¹æ®é˜Ÿåˆ—ç§¯å‹æƒ…å†µæˆ–è€…è¯´å…¥æµé‡å’Œå‡ºæµé‡å¯¹æ¯”æƒ…å†µæ¥è®¾ç½®æ¶ˆè´¹çº¿ç¨‹æ•°ï¼Œå¹¶ä¸”éœ€è¦ç¡®ä¿æ¶ˆè´¹æœ‰2xçš„å†—ä½™é‡","user_name":"ä½œè€…å›å¤","comment_id":247191,"uid":"1001470","ip_address":"","utype":1,"ctime":1599640056,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"1599629899","product_id":100047701,"comment_content":"è€å¸ˆï¼šrabbitmqä¸­çš„SimpleRabbitListenerContainerFactoryè®¾ç½®çš„æœ€å¤§æ¶ˆè´¹çº¿ç¨‹æ•°å’Œç›‘å¬çš„é˜Ÿåˆ—æ•°ä¹‹é—´åº”è¯¥æ˜¯ä»€ä¹ˆå…³ç³»æ¯”è¾ƒåˆé€‚ï¼Ÿæ˜¯ç›‘æ§æ¶ˆè´¹qpsï¼Œæ¶ˆæ¯æ€»é‡ç­‰æƒ…å†µï¼Œè°ƒæ•´æœ€å¤§æ¶ˆè´¹çº¿ç¨‹æ•°å—ï¼Ÿ<br>       ","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505336,"discussion_content":"æ ¹æ®é˜Ÿåˆ—ç§¯å‹æƒ…å†µæˆ–è€…è¯´å…¥æµé‡å’Œå‡ºæµé‡å¯¹æ¯”æƒ…å†µæ¥è®¾ç½®æ¶ˆè´¹çº¿ç¨‹æ•°ï¼Œå¹¶ä¸”éœ€è¦ç¡®ä¿æ¶ˆè´¹æœ‰2xçš„å†—ä½™é‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599640056,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":225258,"user_name":"Geek_3b086e","can_delete":false,"product_type":"c1","uid":2015738,"ip_address":"","ucode":"FCEE6511B1F397","user_header":"","comment_is_top":false,"comment_ctime":1591697923,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591697923","product_id":100047701,"comment_content":"å¼‚æ­¥çš„æœ¬è´¨æ˜¯å˜è¢«åŠ¨å¤„ç†ä¸ºä¸»åŠ¨å¤„ç†ï¼Œè¿™ä¸ªè½¬å˜å°±éœ€è¦ä¸€ä¸ªè“„æ°´æ± ï¼Œä¸ç®¡æ˜¯çº¿ç¨‹æ± ä¸­çš„é˜Ÿåˆ—è¿˜æ˜¯æŠŠé˜Ÿåˆ—å½»åº•ç‹¬ç«‹çš„mqå½¢å¼ã€‚","like_count":0},{"had_liked":false,"id":222478,"user_name":"é£ç¿”","can_delete":false,"product_type":"c1","uid":1068571,"ip_address":"","ucode":"65AF6AF292DAD6","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/1b/f4b786b9.jpg","comment_is_top":false,"comment_ctime":1590815323,"is_pvip":true,"replies":[{"id":"82050","content":"ä½ æ˜¯æŒ‡è¡¥å¿å—ï¼Ÿæˆ‘é‡åˆ°è¿‡mqç˜«ç—ªçš„æƒ…å†µï¼Œæ²¡æœ‰è¡¥å¿è¿™ä¸ªæ—¶å€™é™¤äº†å¹²ç€æ€¥æˆ‘ä»¬è¿˜èƒ½åšå•¥","user_name":"ä½œè€…å›å¤","user_name_real":"æœ±æ™”","uid":"1001470","ctime":1590829991,"ip_address":"","comment_id":222478,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1590815323","product_id":100047701,"comment_content":"è€å¸ˆ ç”Ÿäº§è€…å‘é€ç»™mqæ¶ˆæ¯ å³ä½¿å¼‚æ­¥å‘é€ä¹Ÿä¼šæœ‰listener æ¥ç›‘å¬æŠ•é€’æ¶ˆæ¯æ˜¯å¦æˆåŠŸ å¦‚æœå¤±è´¥ é‡è¯•ä¸å°±è¡Œäº† ï¼Ÿ ä¸æ˜¯ç±»ä¼¼kafka æœ‰100%æŠ•é€’ 100%ä¿è¯æ¶ˆè´¹çš„é…ç½®å˜›","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496814,"discussion_content":"ä½ æ˜¯æŒ‡è¡¥å¿å—ï¼Ÿæˆ‘é‡åˆ°è¿‡mqç˜«ç—ªçš„æƒ…å†µï¼Œæ²¡æœ‰è¡¥å¿è¿™ä¸ªæ—¶å€™é™¤äº†å¹²ç€æ€¥æˆ‘ä»¬è¿˜èƒ½åšå•¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590829991,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":218150,"user_name":"ä¼¼æ›¾ç›¸è¯†","can_delete":false,"product_type":"c1","uid":1971079,"ip_address":"","ucode":"DCBA5F6ABC7401","user_header":"https://static001.geekbang.org/account/avatar/00/1e/13/87/73a17c60.jpg","comment_is_top":false,"comment_ctime":1589724813,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1589724813","product_id":100047701,"comment_content":"â€œConcurrentHashMap æ¥å­˜æ”¾é‚£äº›å‘è¿‡çŸ­ä¿¡çš„ç”¨æˆ· ID å®ç°å¹‚ç­‰â€<br>è€å¸ˆ 3.èƒ½å°†ConcurrentHashMapæ¢æˆ LinkedHashmapå—ï¼Ÿé€šè¿‡LUR è¿˜å¯ä»¥å®šæ—¶ åˆ é™¤ä¸€äº›æ•°æ®ï¼Œé¿å…é›†åˆè¿‡å¤§ï¼Œè¿™æ ·åšå¯¹å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1239462,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e9/a6/69907ec1.jpg","nickname":"æä¼Ÿ","note":"","ucode":"F0EF60EB250B20","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288106,"discussion_content":"ä¸€èˆ¬ç”Ÿäº§ä¸Šåº”è¯¥æ˜¯é€šè¿‡æ•°æ®åº“æ¥åŒºåˆ†åˆ°åº•æœ‰æ²¡æœ‰å‘è¿‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593653153,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}