{"id":739356,"title":"11ï½œ å¤šå±‚å®¹å™¨ï¼šå¦‚ä½•é€šè¿‡å®ç°Contextä¸Wrapperå½¢æˆå¤šå±‚å®¹å™¨ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯éƒ­å±¹ã€‚ä»Šå¤©æˆ‘ä»¬ç»§ç»­æ‰‹å†™MiniTomcatã€‚</p><p>ä¸Šä¸€èŠ‚è¯¾ç»“æŸåï¼Œæˆ‘ä»¬å¼•å…¥äº†Containerå¯¹Servletè¿›è¡Œç®¡ç†ï¼Œå°†åŸæœ¬çš„ConnectoråŠŸèƒ½èŒè´£è¿›è¡Œæ‹†åˆ†ï¼Œè®©å®ƒä¸“é—¨è´Ÿè´£é€šä¿¡çš„ç®¡ç†ã€‚å¹¶ä¸”åœ¨ç¬¬äºŒä¸ªéƒ¨åˆ†ä¸­ï¼ŒæŠŠContainerè¿›ä¸€æ­¥å°è£…æˆWrapperï¼Œå®ç°Servletæ›´åŠ ç²¾ç¡®ã€å®Œå–„çš„ç®¡ç†ã€‚</p><p>äº‹å®ä¸Šï¼ŒTomcatæŠŠWrapperä¹Ÿçœ‹ä½œä¸€ç§å®¹å™¨ï¼Œä¹Ÿå°±æ˜¯éš¶å±äºContextä¹‹ä¸‹çš„å­å®¹å™¨ï¼ˆChild Containerï¼‰ï¼Œæ‰€ä»¥åœ¨åŸç†ä¸Šæ˜¯å­˜åœ¨å¤šå±‚å®¹å™¨çš„ã€‚ä¸€ä¸ªServerå¯¹å¤–æä¾›HTTPæœåŠ¡ï¼Œå®ƒçš„å†…éƒ¨æ”¯æŒç®¡ç†å¤šä¸ªè™šæ‹Ÿä¸»æœºï¼Œè€Œæ¯ä¸ªè™šæ‹Ÿä¸»æœºä¸‹åˆæœ‰å¤šä¸ªåº”ç”¨ï¼Œåœ¨æ¯ä¸ªåº”ç”¨å†…åˆåŒ…å«å¤šä¸ªServletã€‚å› æ­¤Containerå­˜åœ¨å¤šä¸ªï¼Œå±äºå±‚å±‚åµŒå¥—çš„å…³ç³»ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/4d/5c/4d787012c15e8034a5167a341c3a0a5c.png?wh=1920x1184\" alt=\"å›¾ç‰‡\"></p><p>æŒ‰ç…§Tomcatå®˜æ–¹çš„å®šä¹‰ï¼Œè‡ªå¤–å‘å†…åˆ†åˆ«åˆ†ä¸ºEngineå±‚ã€Hostå±‚ã€Contextå±‚ä¸Wrapperå±‚ã€‚æˆ‘ä»¬ä¹Ÿå‚è€ƒè¿™ä¸ªæ€è·¯ï¼ŒæŠŠServletContaineræ”¹æˆContextï¼Œä½†æ˜¯æˆ‘ä»¬ä¸æ‰“ç®—å®ç°Engineå’ŒHostï¼Œåªç”¨ä¸¤å±‚Containerã€‚</p><p>ä¸è€ƒè™‘ä½¿ç”¨è¿™ä¹ˆå¤šå±‚Containerçš„ä¸»è¦åŸå› åœ¨äºï¼ŒEngineä¸Hostæœ¬èº«çš„ç»“æ„å¤æ‚ï¼Œè€Œä¸”å…¶æ€æƒ³å·²ç»ä¸å†ç¬¦åˆç°åœ¨çš„ä¸»æµï¼Œç°åœ¨æˆ‘ä»¬ä½¿ç”¨äº†å®¹å™¨æŠ€æœ¯ä¹‹åï¼ŒEngineå’ŒHostçš„æ¦‚å¿µå·²ç»å¼±åŒ–å¾ˆå¤šäº†ã€‚å®é™…ä¸Šï¼Œå½“æˆ‘ä»¬éƒ¨ç½²çš„æ—¶å€™ï¼Œä¸€ä¸ªTomcatä¸€èˆ¬å°±åªç”¨ä¸€ä¸ªEngineå’Œä¸€ä¸ªHostï¼Œå¦‚æœéœ€è¦å¤šä¸ªï¼Œå°±ç”¨å¤šä¸ªå®¹å™¨ã€‚ç”¨Contextå’ŒWrapperä¸¤å±‚å®¹å™¨ä¹Ÿå¯ä»¥æ˜ç™½åœ°è¯´æ˜Tomcatçš„å¤šå±‚å®¹å™¨çš„æ¦‚å¿µã€‚</p><!-- [[[read_end]]] --><p>å®ç°äº†è¿™äº›åŠŸèƒ½ä¹‹åï¼Œæˆ‘ä»¬çš„MiniTomcatä¹Ÿå˜å¾—æœ‰æ¨¡æœ‰æ ·äº†ã€‚ä½†æ˜¯å¦‚æœæ‰€æœ‰çš„ç±»å…¨éƒ¨éƒ½æ”¾åœ¨ServeråŒ…ä¸‹ï¼Œæ˜¾ç„¶æ˜¯ä¸åˆé€‚çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜ä¼šå‚è€ƒå®é™…çš„Tomcaté¡¹ç›®ç»“æ„ï¼ŒæŠŠå„éƒ¨åˆ†ä»£ç æ–‡ä»¶åˆ†é—¨åˆ«ç±»åœ°æ•´ç†å¥½ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·æ¥åŠ¨æ‰‹å®ç°ã€‚</p><h2>é¡¹ç›®ç»“æ„</h2><p>è¿™èŠ‚è¯¾çš„é¡¹ç›®ç»“æ„ä¸­æˆ‘ä»¬æ–°å¢Containeræ¥å£å’ŒContainerBaseä¸¤ä¸ªæ–‡ä»¶ï¼ŒæŠŠåŸæ¥çš„ServletContaineræ”¹åä¸ºServletContextï¼Œå…¶ä»–çš„æš‚æ—¶æ²¡æœ‰ä»€ä¹ˆå˜åŒ–ã€‚</p><pre><code class=\"language-plain\">MiniTomcat\nâ”œâ”€ src\nâ”‚  â”œâ”€ main\nâ”‚  â”‚  â”œâ”€ java\nâ”‚  â”‚  â”‚  â”œâ”€ server\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Container.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ ContainerBase.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ CookieTools.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ DefaultHeaders.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpConnector.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpHeader.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpProcessor.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpRequest.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpRequestFacade.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpRequestLine.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpResponse.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpResponseFacade.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpServer.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Request.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Response.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ ServletContext.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ ServletProcessor.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ ServletWrapper.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Session.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ SessionFacade.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ SocketInputStream.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ StatisResourceProcessor.java\nâ”‚  â”‚  â”œâ”€ resources\nâ”‚  â”œâ”€ test\nâ”‚  â”‚  â”œâ”€ java\nâ”‚  â”‚  â”‚  â”œâ”€ test\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HelloServlet.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ TestServlet.java\nâ”‚  â”‚  â”œâ”€ resources\nâ”œâ”€ webroot\nâ”‚  â”œâ”€ test\nâ”‚  â”‚  â”œâ”€ HelloServlet.class\nâ”‚  â”‚  â”œâ”€ TestServlet.class\nâ”‚  â”œâ”€ hello.txt\nâ”œâ”€ pom.xml\n</code></pre><h2>Contextç»“æ„æ”¹é€ </h2><p>åŸºäºä¹‹å‰çš„ç§¯ç´¯ï¼Œæˆ‘ä»¬å…ˆè¿›è¡Œä¸€å±‚æŠ½è±¡ï¼Œå®šä¹‰ä¸€ä¸ªContainerç±»ã€‚</p><pre><code class=\"language-java\">package server;\npublic interface Container {\n    public static final String ADD_CHILD_EVENT = \"addChild\";\n    public static final String REMOVE_CHILD_EVENT = \"removeChild\";\n    public String getInfo();\n    public ClassLoader getLoader();\n    public void setLoader(ClassLoader loader);\n    public String getName();\n    public void setName(String name);\n    public Container getParent();\n    public void setParent(Container container);\n    public void addChild(Container child);\n    public Container findChild(String name);\n    public Container[] findChildren();\n    public void invoke(HttpServletRequest request, HttpServletResponse response)\n            throws IOException, ServletException;\n    public void removeChild(Container child);\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°æœ‰Classloaderçš„æ“ä½œæ–¹æ³•ã€Childå’ŒParentçš„æ“ä½œæ–¹æ³•ï¼Œè¿˜æœ‰invokeç­‰åŸºç¡€æ–¹æ³•ã€‚</p><p>å› ä¸ºå­˜åœ¨å¤šå±‚Containerï¼Œå¾ˆå¤šç‰¹æ€§æ˜¯å…±æœ‰çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å†å®šä¹‰ContainerBaseä½œä¸ºåŸºç¡€ç±»ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹ContainerBaseçš„å®šä¹‰ã€‚</p><pre><code class=\"language-java\">package server;\nimport java.util.Map;\nimport java.util.concurrent.ConcurrentHashMap;\npublic abstract class ContainerBase implements Container {\n    //å­å®¹å™¨\n    protected Map&lt;String, Container&gt; children = new ConcurrentHashMap&lt;&gt;();\n    //ç±»åŠ è½½å™¨\n    protected ClassLoader loader = null;\n    protected String name = null;\n    //çˆ¶å®¹å™¨\n    protected Container parent = null;\n    \n    //ä¸‹é¢æ˜¯åŸºæœ¬çš„getå’Œsetæ–¹æ³•\n    public abstract String getInfo();\n    public ClassLoader getLoader() {\n        if (loader != null)\n            return (loader);\n        if (parent != null)\n            return (parent.getLoader());\n        return (null);\n    }\n    public synchronized void setLoader(ClassLoader loader) {\n        ClassLoader oldLoader = this.loader;\n        if (oldLoader == loader) {\n            return;\n        }\n        this.loader = loader;\n    }\n    public String getName() {\n        return (name);\n    }\n\n    public void setName(String name) {\n        this.name = name;\n    }\n    public Container getParent() {\n        return (parent);\n    }\n\n    public void setParent(Container container) {\n        Container oldParent = this.parent;\n        this.parent = container;\n    }\n\n    //ä¸‹é¢æ˜¯å¯¹children mapçš„å¢åˆ æ”¹æŸ¥æ“ä½œ\n    public void addChild(Container child) {\n        addChildInternal(child);\n    }\n    private void addChildInternal(Container child) {\n        synchronized(children) {\n            if (children.get(child.getName()) != null)\n                throw new IllegalArgumentException(\"addChild:  Child name '\" +\n                        child.getName() +\n                        \"' is not unique\");\n            child.setParent((Container) this);  \n            children.put(child.getName(), child);\n        }\n    }\n    public Container findChild(String name) {\n        if (name == null)\n            return (null);\n        synchronized (children) {       // Required by post-start changes\n            return ((Container) children.get(name));\n        }\n    }\n\n    public Container[] findChildren() {\n        synchronized (children) {\n            Container results[] = new Container[children.size()];\n            return ((Container[]) children.values().toArray(results));\n        }\n    }\n    public void removeChild(Container child) {\n        synchronized(children) {\n            if (children.get(child.getName()) == null)\n                return;\n            children.remove(child.getName());\n        }\n        child.setParent(null);\n    }\n}\n</code></pre><p>é€šè¿‡ä¸Šé¢è¿™æ®µä»£ç ï¼Œæˆ‘ä»¬å®ç°äº†Containeræ¥å£ï¼Œæä¾›äº†éƒ¨åˆ†æ–¹æ³•çš„é€šç”¨å®ç°ã€‚</p><p>æ¥ä¸‹æ¥è¦åšçš„ï¼Œå°±æ˜¯æŠŠServletContaineræ›´åä¸ºServletContextï¼Œæˆ‘ä»¬éœ€è¦æ”¹åŠ¨å‡ å¤„å†…å®¹ã€‚</p><p>ç¬¬ä¸€å¤„ï¼šHttpServer.java</p><pre><code class=\"language-java\">public class HttpServer {\n    public static final String WEB_ROOT =\n            System.getProperty(\"user.dir\") + File.separator + \"webroot\";\n    public static void main(String[] args) {\n        HttpConnector connector = new HttpConnector();\n        ServletContext container = new ServletContext();\n        connector.setContainer(container);\n        container.setConnector(connector);\n        connector.start();\n    }\n}\n</code></pre><p>è¿™é‡Œçš„Containeræ›¿æ¢ä¸ºServletContextç±»äº†ã€‚</p><p>ç¬¬äºŒå¤„ï¼šHttpConnector.java</p><pre><code class=\"language-java\">public class HttpConnector implements Runnable {\n    ServletContext container = null;\n    public ServletContext getContainer() {\n        return container;\n    }\n    public void setContainer(ServletContext container) {\n        this.container = container;\n    }\n}\n</code></pre><p>ç¬¬ä¸‰å¤„ï¼šServletWrapper.java</p><pre><code class=\"language-java\">public class ServletWrapper extends ContainerBase{\n    private Servlet instance = null;\n    private String servletClass;\n    public ServletWrapper(String servletClass,ServletContext parent) {\n        this.parent = parent;\n        this.servletClass = servletClass;\n        try {\n            loadServlet();\n        } catch (ServletException e) {\n            e.printStackTrace();\n        }\n    }\n}\n</code></pre><p>ServletContextæ˜¯Wrapperçš„parentã€‚</p><p>è°ƒæ•´å®Œç±»åä¹‹åï¼Œæˆ‘ä»¬è®©ServletContextç»§æ‰¿ContainerBaseåŸºç±»ï¼ŒServletWrapperä¹Ÿå¯ä»¥ç®—ä½œContainerï¼Œæ‰€ä»¥ä¹Ÿç»§æ‰¿ContainerBaseåŸºç±»ã€‚</p><p>é¦–å…ˆæ˜¯ServletContext.javaï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹æˆ‘ä»¬è°ƒæ•´çš„éƒ¨åˆ†ã€‚</p><pre><code class=\"language-java\">package server;\nimport javax.servlet.ServletException;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport java.io.File;\nimport java.io.IOException;\nimport java.net.URL;\nimport java.net.URLClassLoader;\nimport java.net.URLStreamHandler;\nimport java.util.Map;\nimport java.util.concurrent.ConcurrentHashMap;\npublic class ServletContext extends ContainerBase{\n    //ä¸æœ¬å®¹å™¨å…³è”çš„connector\n    HttpConnector connector = null;\n    //å†…éƒ¨ç®¡ç†çš„servletç±»å’Œå®ä¾‹\n    Map&lt;String,String&gt; servletClsMap = new ConcurrentHashMap&lt;&gt;(); //servletName - ServletClassName\n    Map&lt;String,ServletWrapper&gt; servletInstanceMap = new ConcurrentHashMap&lt;&gt;();//servletName - servletWrapper\n    public ServletContext() {\n        try {\n            // create a URLClassLoader\n            URL[] urls = new URL[1];\n            URLStreamHandler streamHandler = null;\n            File classPath = new File(HttpServer.WEB_ROOT);\n            String repository = (new URL(\"file\", null, classPath.getCanonicalPath() + File.separator)).toString() ;\n            urls[0] = new URL(null, repository, streamHandler);\n            loader = new URLClassLoader(urls);\n        } catch (IOException e) {\n            System.out.println(e.toString() );\n        }\n    }\n    public String getInfo() {\n        return \"Minit Servlet Context, vesion 0.1\";\n    }\n    public HttpConnector getConnector() {\n        return connector;\n    }\n    public void setConnector(HttpConnector connector) {\n        this.connector = connector;\n    }\n    //è°ƒç”¨servletçš„æ–¹æ³•\n    public void invoke(HttpServletRequest request, HttpServletResponse response)\n            throws IOException, ServletException {\n        ServletWrapper servletWrapper = null;\n        String uri = ((HttpRequest)request).getUri();\n        String servletName = uri.substring(uri.lastIndexOf(\"/\") + 1);\n        String servletClassName = servletName;\n        //ä»å®¹å™¨ä¸­è·å–servlet wrapper\n        servletWrapper = servletInstanceMap.get(servletName);\n        if ( servletWrapper == null) {\n            servletWrapper = new ServletWrapper(servletClassName,this);\n            //servletWrapper.setParent(this);\n            this.servletClsMap.put(servletName, servletClassName);\n            this.servletInstanceMap.put(servletName, servletWrapper);\n        }\n        //å°†è°ƒç”¨ä¼ é€’åˆ°ä¸‹å±‚å®¹å™¨å³wrapperä¸­\n        try {\n            HttpServletRequest requestFacade = new HttpRequestFacade(request);\n            HttpServletResponse responseFacade = new HttpResponseFacade(response);\n            System.out.println(\"Call service()\");\n            servletWrapper.invoke(requestFacade, responseFacade);\n        }\n        catch (Exception e) {\n            System.out.println(e.toString());\n        }\n        catch (Throwable e) {\n            System.out.println(e.toString());\n        }\n    }\n}\n</code></pre><p>ä¸Šè¿°ä»£ç ä¸­ï¼ŒHttpRequestFacadeå’ŒHttpResponseFacadeä¸¤ä¸ªç±»çš„æ„é€ å‡½æ•°çš„å…¥å‚å’Œinvokeæ–¹æ³•ä¿æŒä¸€è‡´ï¼Œä¹Ÿéœ€è¦å¯¹åº”åœ°åšä¸€äº›è°ƒæ•´ã€‚</p><pre><code class=\"language-java\">package server;\npublic class HttpRequestFacade implements HttpServletRequest {\n    public HttpRequestFacade(HttpServletRequest request) {\n        this.request = request;\n    }\n}\n</code></pre><pre><code class=\"language-java\">package server;\npublic class HttpResponseFacade implements HttpServletResponse {\n    public HttpResponseFacade(HttpServletResponse response) {\n        this.response = response;\n    }\n}\n</code></pre><p>æ¥ä¸‹æ¥æˆ‘ä»¬å…³æ³¨ä¸€ä¸‹ServletWrapperç±»çš„è°ƒæ•´ã€‚</p><pre><code class=\"language-java\">package server;\npublic class ServletWrapper extends ContainerBase{\n    //wrapperå†…å«äº†ä¸€ä¸ªservletå®ä¾‹å’Œç±»\n    private Servlet instance = null;\n    private String servletClass;\n    \n    public ServletWrapper(String servletClass,ServletContext parent) {\n        //ä»¥ServletContextä¸ºparent\n        this.parent = parent;\n        this.servletClass = servletClass;\n        try {\n            loadServlet();\n        } catch (ServletException e) {\n            e.printStackTrace();\n        }\n    }\n    public String getServletClass() {\n        return servletClass;\n    }\n    public void setServletClass(String servletClass) {\n        this.servletClass = servletClass;\n    }\n    public Servlet getServlet(){\n        return this.instance;\n    }\n    //load servletç±»ï¼Œåˆ›å»ºæ–°å®ä¾‹ï¼Œå¹¶è°ƒç”¨init()æ–¹æ³•\n    public Servlet loadServlet() throws ServletException {\n        if (instance!=null)\n            return instance;\n        Servlet servlet = null;\n        String actualClass = servletClass;\n        if (actualClass == null) {\n            throw new ServletException(\"servlet class has not been specified\");\n        }\n        ClassLoader classLoader = getLoader();\n        Class classClass = null;\n        try {\n            if (classLoader!=null) {\n                classClass = classLoader.loadClass(actualClass);\n            }\n        }\n        catch (ClassNotFoundException e) {\n            throw new ServletException(\"Servlet class not found\");\n        }\n        try {\n            servlet = (Servlet) classClass.newInstance();\n        }\n        catch (Throwable e) {\n            throw new ServletException(\"Failed to instantiate servlet\");\n        }\n        try {\n            servlet.init(null);\n        }\n        catch (Throwable f) {\n            throw new ServletException(\"Failed initialize servlet.\");\n        }\n        instance =servlet;\n        return servlet;\n    }\n    //wrapperæ˜¯æœ€åº•å±‚å®¹å™¨ï¼Œè°ƒç”¨å°†è½¬åŒ–ä¸ºservice()æ–¹æ³•\n    public void invoke(HttpServletRequest request, HttpServletResponse response)\n            throws IOException, ServletException {\n        if (instance != null) {\n            instance.service(request, response);\n        }\n    }\n    @Override\n    public String getInfo() {\n        return \"Minit Servlet Wrapper, version 0.1\";\n    }\n    public void addChild(Container child) {}\n    public Container findChild(String name) {return null;}\n    public Container[] findChildren() {return null;}\n    public void removeChild(Container child) {}\n}\n</code></pre><p>ServletWrapperç»§æ‰¿äº†ContainerBaseæŠ½è±¡ç±»ï¼Œä¸»è¦æœ‰ä¸¤ä¸ªå˜åŒ–ã€‚</p><ol>\n<li>åŸæœ¬å®šä¹‰çš„loaderã€nameã€parentåŸŸç›´æ¥ä½¿ç”¨ContainerBaseé‡Œçš„å®šä¹‰ã€‚</li>\n<li>å®ç°getInfoã€addChildã€findChildã€findChildrenã€removeChildæ–¹æ³•ã€‚</li>\n</ol><p>åˆ°è¿™é‡Œæˆ‘ä»¬å°±æ”¹é€ å®Œäº†ã€‚</p><h2>å‘Tomcatç›®å½•å¯¹é½</h2><p>åœ¨è¿™ä¸€éƒ¨åˆ†æˆ‘ä»¬å¼€å§‹å‚è€ƒTomcatçš„ç›®å½•ç»“æ„ï¼Œæ¥æ¢³ç†MiniTomcatçš„ç¨‹åºç»“æ„ã€‚åœ¨Tomcatçš„é¡¹ç›®ç»“æ„ä¸­ï¼Œä¸»è¦çš„ç±»éƒ½æ”¾åœ¨org.apache.catalinaåŒ…é‡Œï¼ŒåŸºæœ¬çš„å­åŒ…æœ‰startupã€coreã€connectorã€loaderã€loggerã€sessionå’Œutilç­‰ç­‰ã€‚</p><p>æˆ‘ä»¬ä¹Ÿå‚è€ƒè¿™ä¸ªç»“æ„ï¼ŒæŠŠå¤§çš„åŒ…å‘½åä¸ºcom.minitï¼Œåœ¨è¿™ä¸ªåŒ…ä¸‹æ„å»ºstartupã€coreã€connectorã€loaderã€loggerã€sessionã€utilå¤šä¸ªå­åŒ…ã€‚</p><p>ä¸ºäº†æ›´åŠ è§„èŒƒï¼Œæˆ‘ä»¬åœ¨com.minitåŒ…ä¸‹æ–°å¢å‡ ä¸ªæ¥å£ï¼šConnectorã€Contextã€Wrapperã€Requestã€Responseã€Sessionã€Containerã€‚å…¶ä¸­Containerç›´æ¥å¤ç”¨ä¹‹å‰å®šä¹‰çš„åŒåæ¥å£ï¼ŒåŸæœ¬å®šä¹‰çš„Requestä¸Responseä¸¤ä¸ªç±»ä¸å†éœ€è¦ä½¿ç”¨ï¼Œå¯ä»¥ç›´æ¥åˆ é™¤ã€‚</p><p>åŒæ—¶ï¼Œä¿®æ”¹ä¸‹é¢è¿™äº›ç±»çš„åå­—å¹¶å®ç°ä¸Šè¿°æ¥å£ï¼Œå°½å¯èƒ½å’ŒTomcatä¿æŒä¸€è‡´ã€‚</p><pre><code class=\"language-plain\">ServletContextæ”¹ä¸ºStandardContext\nServletWrapperæ”¹ä¸ºStandardWrapper\nSessionæ”¹ä¸ºStandardSession\nSessionFacadeæ”¹ä¸ºStandardSessionFacade\nHttpRequestæ”¹ä¸ºHttpRequestImpl\nHttpResponseæ”¹ä¸ºHttpResponseImpl\nHttpServeræ”¹ä¸ºBootstrap\n</code></pre><p>æ”¹é€ åçš„é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">MiniTomcat\nâ”œâ”€ src\nâ”‚  â”œâ”€ main\nâ”‚  â”‚  â”œâ”€ java\nâ”‚  â”‚  â”‚  â”œâ”€ com\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ minit\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ connector\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ http\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ DefaultHeaders.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpConnector.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpHeader.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpProcessor.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpRequestImpl.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpRequestLine.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpResponseImpl.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ ServletProcessor.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ SocketInputStream.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StatisResourceProcessor.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpRequestFacade.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ HttpResponseFacade.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ core\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ ContainerBase.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StandardContext.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StandardWrapper.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ logger\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ session\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StandardSession.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ StandardSessionFacade.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ startup\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ Bootstrap.java\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ util\nâ”‚  â”‚  â”‚  â”‚  â”‚  â”‚  â”œâ”€ CookieTools.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Connector.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Container.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Contexts.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Request.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Responses.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Session.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ Wrapper.java\nâ”‚  â”‚  â”œâ”€ resources\nâ”‚  â”œâ”€ test\nâ”‚  â”‚  â”œâ”€ java\nâ”‚  â”‚  â”‚  â”œâ”€ test\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ HelloServlet.java\nâ”‚  â”‚  â”‚  â”‚  â”œâ”€ TestServlet.java\nâ”‚  â”‚  â”œâ”€ resources\nâ”œâ”€ webroot\nâ”‚  â”œâ”€ test\nâ”‚  â”‚  â”œâ”€ HelloServlet.class\nâ”‚  â”‚  â”œâ”€ TestServlet.class\nâ”‚  â”œâ”€ hello.txt\nâ”œâ”€ pom.xml\n</code></pre><p>æ¥ä¸‹æ¥æˆ‘ä»¬åˆ†åˆ«å®šä¹‰Connectorã€Contextã€Wrapperã€Requestã€Responseã€Sessionè¿™å‡ ä¸ªæ¥å£ã€‚</p><p>Connector.javaï¼š</p><pre><code class=\"language-java\">package com.minit;\npublic interface Connector {\n    public Container getContainer();\n    public void setContainer(Container container);\n    public String getInfo();\n    public String getScheme();\n    public void setScheme(String scheme);\n    public Request createRequest();\n    public Response createResponse();\n    public void initialize();\n}\n</code></pre><p>Context.javaï¼š</p><pre><code class=\"language-java\">package com.minit;\npublic interface Context extends Container {\n    public static final String RELOAD_EVENT = \"reload\";\n    public String getDisplayName();\n    public void setDisplayName(String displayName);\n    public String getDocBase();\n    public void setDocBase(String docBase);\n    public String getPath();\n    public void setPath(String path);\n    public ServletContext getServletContext();\n    public int getSessionTimeout();\n    public void setSessionTimeout(int timeout);\n    public String getWrapperClass();\n    public void setWrapperClass(String wrapperClass);\n    public Wrapper createWrapper();\n    public String findServletMapping(String pattern);\n    public String[] findServletMappings();\n    public void reload();\n}\n</code></pre><p>Wrapper.javaï¼š</p><pre><code class=\"language-java\">package com.minit;\npublic interface Wrapper {\n    public int getLoadOnStartup();\n    public void setLoadOnStartup(int value);\n    public String getServletClass();\n    public void setServletClass(String servletClass);\n    public void addInitParameter(String name, String value);\n    public Servlet allocate() throws ServletException;\n    public String findInitParameter(String name);\n    public String[] findInitParameters();\n    public void load() throws ServletException;\n    public void removeInitParameter(String name);\n}\n</code></pre><p>Request.javaï¼š</p><pre><code class=\"language-java\">package com.minit;\npublic interface Request {\n    public Connector getConnector();\n    public void setConnector(Connector connector);\n    public Context getContext();\n    public void setContext(Context context);\n    public String getInfo();\n    public ServletRequest getRequest();\n    public Response getResponse();\n    public void setResponse(Response response);\n    public Socket getSocket();\n    public void setSocket(Socket socket);\n    public InputStream getStream();\n    public void setStream(InputStream stream);\n    public Wrapper getWrapper();\n    public void setWrapper(Wrapper wrapper);\n    public ServletInputStream createInputStream() throws IOException;\n    public void finishRequest() throws IOException;\n    public void recycle();\n    public void setContentLength(int length);\n    public void setContentType(String type);\n    public void setProtocol(String protocol);\n    public void setRemoteAddr(String remote);\n    public void setScheme(String scheme);\n    public void setServerPort(int port);\n}\n</code></pre><p>Response.javaï¼š</p><pre><code class=\"language-java\">package com.minit;\npublic interface Response {\n    public Connector getConnector();\n    public void setConnector(Connector connector);\n    public int getContentCount();\n    public Context getContext();\n    public void setContext(Context context);\n    public String getInfo();\n    public Request getRequest();\n    public void setRequest(Request request);\n    public ServletResponse getResponse();\n    public OutputStream getStream();\n    public void setStream(OutputStream stream);\n    public void setError();\n    public boolean isError();\n    public ServletOutputStream createOutputStream() throws IOException;\n    public void finishResponse() throws IOException;\n    public int getContentLength();\n    public String getContentType();\n    public PrintWriter getReporter();\n    public void recycle();\n    public void resetBuffer();\n    public void sendAcknowledgement() throws IOException;\n}\n\n</code></pre><p>Session.javaï¼š</p><pre><code class=\"language-java\">package com.minit;\npublic interface Session {\n    public static final String SESSION_CREATED_EVENT = \"createSession\";\n    public static final String SESSION_DESTROYED_EVENT = \"destroySession\";\n    public long getCreationTime();\n    public void setCreationTime(long time);\n    public String getId();\n    public void setId(String id);\n    public String getInfo();\n    public long getLastAccessedTime();\n    public int getMaxInactiveInterval();\n    public void setMaxInactiveInterval(int interval);\n    public void setNew(boolean isNew);\n    public HttpSession getSession();\n    public void setValid(boolean isValid);\n    public boolean isValid();\n    public void access();\n    public void expire();\n    public void recycle();\n}\n</code></pre><p>æœ€åå†ç»™StandardContextã€StandardWrapperå’ŒStandardSessionåˆ†åˆ«å®ç°Contextã€Wrapperä¸Sessionæ¥å£ï¼Œè¿™èŠ‚è¯¾çš„æ”¹é€ å°±å®ç°å®Œäº†ã€‚æœ€åæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹è°ƒæ•´åéœ€è¦æ–°å¢çš„å®ç°æ–¹æ³•ã€‚</p><p>StandardContext.javaï¼š</p><pre><code class=\"language-java\">package com.minit.core;\npublic class StandardContext extends ContainerBase implements Context {\n    @Override\n    public String getDisplayName() {\n        return null;\n    }\n    @Override\n    public void setDisplayName(String displayName) {\n    }\n    @Override\n    public String getDocBase() {\n        return null;\n    }\n    @Override\n    public void setDocBase(String docBase) {\n    }\n    @Override\n    public String getPath() {\n        return null;\n    }\n    @Override\n    public void setPath(String path) {\n    }\n    @Override\n    public ServletContext getServletContext() {\n        return null;\n    }\n    @Override\n    public int getSessionTimeout() {\n        return 0;\n    }\n    @Override\n    public void setSessionTimeout(int timeout) {\n    }\n    @Override\n    public String getWrapperClass() {\n        return null;\n    }\n    @Override\n    public void setWrapperClass(String wrapperClass) {\n    }\n    @Override\n    public Wrapper createWrapper() {\n        return null;\n    }\n    @Override\n    public String findServletMapping(String pattern) {\n        return null;\n    }\n    @Override\n    public String[] findServletMappings() {\n        return null;\n    }\n    @Override\n    public void reload() {\n    }\n}\n</code></pre><p>StandardWrapper.javaï¼š</p><pre><code class=\"language-java\">package com.minit.core;\npublic class StandardWrapper extends ContainerBase implements Wrapper {\n   @Override\n    public int getLoadOnStartup() {\n        return 0;\n    }\n    @Override\n    public void setLoadOnStartup(int value) {\n    }\n    @Override\n    public void addInitParameter(String name, String value) {\n    }\n    @Override\n    public Servlet allocate() throws ServletException {\n        return null;\n    }\n    @Override\n    public String findInitParameter(String name) {\n        return null;\n    }\n    @Override\n    public String[] findInitParameters() {\n        return null;\n    }\n    @Override\n    public void load() throws ServletException {\n    }\n    @Override\n    public void removeInitParameter(String name) {\n    }\n}\n</code></pre><p>StandardSession.javaï¼š</p><pre><code class=\"language-java\">package com.minit.session;\npublic class StandardSession implements HttpSession, Session {\n   @Override\n    public String getInfo() {\n        return null;\n    }\n    @Override\n    public void setNew(boolean isNew) {\n    }\n    @Override\n    public HttpSession getSession() {\n        return null;\n    }\n    @Override\n    public boolean isValid() {\n        return false;\n    }\n    @Override\n    public void access() {\n    }\n    @Override\n    public void expire() {\n    }\n    @Override\n    public void recycle() {\n    }\n}\n</code></pre><p>åˆ°è¿™é‡Œæˆ‘ä»¬å°±å®Œæˆäº†é¡¹ç›®ç»“æ„çš„æ”¹é€ ï¼Œå¯ä»¥çœ‹å‡ºï¼ŒMiniTomcatå’ŒTomcatå·²ç»é•¿å¾—æ¯”è¾ƒåƒäº†ã€‚</p><h2>æµ‹è¯•</h2><p>è¿™èŠ‚è¯¾æ²¡æœ‰æ–°å¢ä»€ä¹ˆå¯¹å¤–çš„åŠŸèƒ½ï¼Œæ‰€ä»¥æµ‹è¯•è¿˜æ˜¯å’Œä¹‹å‰çš„æµ‹è¯•æ–¹å¼ä¸€æ ·ã€‚</p><h2>å°ç»“</h2><p>è¿™èŠ‚è¯¾æˆ‘ä»¬æŠŠé¡¹ç›®ç»“æ„è¿›ä¸€æ­¥æŠ½è±¡æˆäº†ä¸¤å±‚Containerï¼Œåˆ†åˆ«æ˜¯Contextå’ŒWrapperï¼ŒContextå¯¹åº”äºæˆ‘ä»¬å¹³å¸¸æ‰€è¯´çš„ä¸€ä¸ªåº”ç”¨ï¼ŒWrapperæ˜¯å¯¹åº”çš„ä¸€ä¸ªServletçš„åŒ…è£…ã€‚åœ¨Contextè¿™ä¸ªå®¹å™¨ä¸­æœ‰ä¸€ä¸ªmapåŒ…å«äº†å¤šä¸ªWrapperï¼Œè¿™æ ·æ„æˆäº†çˆ¶å­å®¹å™¨çš„ä¸¤å±‚ç»“æ„ã€‚</p><p>ç„¶åæˆ‘ä»¬è¿›ä¸€æ­¥é€šç”¨åŒ–ï¼Œæå‡ºContainerBaseï¼Œåªè¦ä¸€ä¸ªç±»åŸºäºbaseï¼Œå°±å¯ä»¥å½“æˆä¸€ä¸ªæ–°çš„å®¹å™¨ã€‚é€šè¿‡è¿™äº›æ‰‹æ®µå®ç°äº†ä¸€ä¸ªæœåŠ¡å™¨ç®¡ç†å¤šä¸ªå®¹å™¨ï¼Œè€Œå®¹å™¨åˆå¯ä»¥ç®¡ç†å¤šä¸ªServletï¼Œå±‚å±‚åµŒå¥—ï¼Œå®ç°ç³»ç»Ÿç»“æ„çš„æ‰©å±•å’Œç®¡ç†æ¸…æ™°åŒ–ã€‚ç„¶ååœ¨æ­¤åŸºç¡€ä¸Šï¼Œå‚è€ƒTomcatçš„é¡¹ç›®ç»“æ„ï¼Œè¿›è¡Œå¯¹åº”è°ƒæ•´ï¼Œè®©å®ƒæ›´è´´è¿‘Tomcatæºç æœ¬èº«ã€‚è¿™æ ·ä¸€æ¥ï¼Œä½ å»é˜…è¯»Tomcatæºç ï¼Œéš¾åº¦å°±ä¼šå¤§å¤§é™ä½ã€‚</p><p>è¿™èŠ‚è¯¾ä»£ç å‚è§ï¼š<a href=\"https://gitee.com/yaleguo1/minit-learning-demo/tree/geek_chapter11\">https://gitee.com/yaleguo1/minit-learning-demo/tree/geek_chapter11</a></p><h2>æ€è€ƒé¢˜</h2><p>å­¦å®Œäº†è¿™èŠ‚è¯¾çš„å†…å®¹ï¼Œæˆ‘ä»¬æ¥æ€è€ƒä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬ç°åœ¨çš„ä»£ç ä¸­ï¼ŒservletContextçš„invoke()æ–¹æ³•ä»…ä»…åªæ˜¯ç®€å•åœ°è°ƒç”¨äº†å­å®¹å™¨Wrapperçš„invoke()ï¼Œä½†æ˜¯åŸåˆ™ä¸Šæ¯ä¸€å±‚çš„å®¹å™¨çš„invoke()å¯ä»¥å¦å¤–åŠ å…¥æœ¬å±‚å®¹å™¨ç‰¹æ®Šçš„é€»è¾‘ï¼Œæœ‰æ²¡æœ‰åˆé€‚çš„è®¾è®¡æ–¹æ¡ˆï¼Ÿ</p><p>æ¬¢è¿ä½ æŠŠä½ æƒ³åˆ°çš„æ–¹æ¡ˆåˆ†äº«åˆ°è¯„è®ºåŒºï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾çš„å†…å®¹åˆ†äº«ç»™å…¶ä»–æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","comments":[{"had_liked":false,"id":386112,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"åŒ—äº¬","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1704117766,"is_pvip":false,"replies":[{"id":140774,"content":"ç”¨ä¸åŒçš„åŸŸåè¡¨ç¤ºä¸åŒä¸»æœºï¼Œå…¶å®æ˜¯è™šæ‹Ÿä¸»æœº\nå°†connectorå’Œhostå®¹å™¨ç»„åˆåœ¨ä¸€èµ·çš„å°±æ˜¯engineï¼Œç”±å®ƒæ¥å®ç°å¯¹å¤–çš„service","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1704206287,"ip_address":"æ¹–å—","comment_id":386112,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"è¯·æ•™è€å¸ˆä¸¤ä¸ªé—®é¢˜ï¼š\nQ1ï¼šTomcatä¸­æ€ä¹ˆè¡¨ç¤ºå¤šä¸ªHostï¼Ÿç”¨ä¸åŒçš„IPå—ï¼Ÿ\nQ2ï¼šEngineä¸»è¦åŠŸèƒ½æ˜¯ä»€ä¹ˆï¼Ÿæ„Ÿè§‰æ‰€æœ‰çš„ä¸»è¦åŠŸèƒ½éƒ½å·²ç»åŒ…å«åœ¨è¿æ¥å¤„ç†ã€servletå¤„ç†äº†ï¼Œè¿˜èƒ½æœ‰ä»€ä¹ˆæ¯”è¾ƒå¤§çš„åŠŸèƒ½ç”±Engineæ¥å¤„ç†ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634946,"discussion_content":"ç”¨ä¸åŒçš„åŸŸåè¡¨ç¤ºä¸åŒä¸»æœºï¼Œå…¶å®æ˜¯è™šæ‹Ÿä¸»æœº\nå°†connectorå’Œhostå®¹å™¨ç»„åˆåœ¨ä¸€èµ·çš„å°±æ˜¯engineï¼Œç”±å®ƒæ¥å®ç°å¯¹å¤–çš„service","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704206287,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¹–å—","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":386090,"user_name":"HHğŸ·ğŸ ","can_delete":false,"product_type":"c1","uid":1133678,"ip_address":"å¹¿ä¸œ","ucode":"C50172BDA604D5","user_header":"https://static001.geekbang.org/account/avatar/00/11/4c/6e/5435e214.jpg","comment_is_top":false,"comment_ctime":1704071708,"is_pvip":false,"replies":[{"id":140773,"content":"æˆ‘æœ€åˆä¹Ÿæ˜¯è¿™ä¹ˆæƒ³çš„ï¼Œç”¨interceptorï¼Œè¿™ä¹ˆåšæ˜¯å¯ä»¥çš„ã€‚è€ŒTomcatç”¨äº†pipelineï¼Œç»“æ„æ›´åŠ å®å¤§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1864890,"ctime":1704205210,"ip_address":"æ¹–å—","comment_id":386090,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"åŠ å…¥æœ¬å±‚ç‰¹æ®Šé€»è¾‘ï¼Œæˆ‘çš„æƒ³æ³•æ˜¯åŠ å…¥ä¸€ä¸ªå‰ç½®æ–¹æ³•å’Œåç½®æ–¹æ³•ï¼Œ å¹¶ä¸”å­ç±»å¯ä»¥é‡å†™è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚","like_count":0,"discussions":[{"author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634945,"discussion_content":"æˆ‘æœ€åˆä¹Ÿæ˜¯è¿™ä¹ˆæƒ³çš„ï¼Œç”¨interceptorï¼Œè¿™ä¹ˆåšæ˜¯å¯ä»¥çš„ã€‚è€ŒTomcatç”¨äº†pipelineï¼Œç»“æ„æ›´åŠ å®å¤§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704205211,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¹–å—","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":1,"child_discussions":[{"author":{"id":1133678,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4c/6e/5435e214.jpg","nickname":"HHğŸ·ğŸ ","note":"","ucode":"C50172BDA604D5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1864890,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cojb2AA3eM620kb7hj7YoOpq8XI0iaPyfajnQLO6icAhuSoYWR1vrdOZB2nmSuETxmuheo3sxec698SD6RhTFxgQ/132","nickname":"Yale Guo","note":"","ucode":"6736810620B3F0","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":634961,"discussion_content":"ğŸ˜„æˆ‘å¾—å¥½å¥½è§è¯†ä¸€ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704241625,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":634945,"ip_address":"å¹¿ä¸œ","group_id":0},"score":634961,"extra":""}]}]},{"had_liked":false,"id":390914,"user_name":"å¶æ¥äººé—´ï¼Œé£åº¦ç¿©ç¿©","can_delete":false,"product_type":"c1","uid":1768374,"ip_address":"æ±Ÿè‹","ucode":"DDABD0E3EB7104","user_header":"https://static001.geekbang.org/account/avatar/00/1a/fb/b6/728e2d02.jpg","comment_is_top":false,"comment_ctime":1716735345,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100636401,"comment_content":"æ–‡ç« ä¸€å¼€å¤´è¯´çš„ã€å¹¶ä¸”åœ¨ç¬¬äºŒä¸ªéƒ¨åˆ†ä¸­ï¼ŒæŠŠ Container è¿›ä¸€æ­¥å°è£…æˆ Wrapperï¼Œå®ç° Servlet æ›´åŠ ç²¾ç¡®ã€å®Œå–„çš„ç®¡ç†ã€‚ã€‘ï¼Œæ˜¯ä¸æ˜¯åº”è¯¥æ˜¯ã€æŠŠ Servlet è¿›ä¸€æ­¥å°è£…æˆ Wrapperï¼Œã€‘å‘€ï¼Ÿ","like_count":0}]}