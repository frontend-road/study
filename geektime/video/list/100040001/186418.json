{"id":186418,"title":"38 | 实验：搭建两地三中心集群","content":"<p><strong>亲爱的学员：</strong><br>\n你好，在回答学员问题的过程中，我发现大家对于第二章的事务处理, 特别是隔离级别，以及第三章的分片集群有相对较多的问题。在这里我给大家推荐一些补充的学习材料可以从另外一个角度来加深一些这些概念的理解。<br>\nMongoDB事务的原子性<br>\n<a href=\"https://docs.mongodb.com/manual/core/write-operations-atomicity/\">https://docs.mongodb.com/manual/core/write-operations-atomicity/</a><br>\nMongoDB事务的隔离级别和一致性模型<br>\n<a href=\"https://docs.mongodb.com/manual/core/read-isolation-consistency-recency/\">https://docs.mongodb.com/manual/core/read-isolation-consistency-recency/</a><br>\n如果英文不太感冒，在MongoDB中文网站上有不少内容，比如分片相关的：<br>\n<a href=\"http://www.mongoing.com/?s=%E5%88%86%E7%89%87%E9%9B%86%E7%BE%A4\">http://www.mongoing.com/?s=分片集群</a></p><p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-mongodb-course\">https://gitee.com/geektime-geekbang/geektime-mongodb-course</a></p>","comments":[{"had_liked":false,"id":173156,"user_name":"garyyang","can_delete":false,"product_type":"c3","uid":1802381,"ip_address":"","ucode":"874A484C8A6EBC","user_header":"","comment_is_top":false,"comment_ctime":1579440093,"is_pvip":false,"replies":[{"id":67375,"content":"4.2 版本的驱动程序会自动在换主节点的时候重试读写操作。假设你有三台复制集群节点 A,B,C， A为主节点。你只需要执行以下操作，你的程序应该可以持续运行\n\n1） 确定客户端应用使用的是最新版驱动程序\n2） 停止C节点，并升级到4.2.2，然后启动服务\n3） 停止B节点，并升级到4.2.2，然后启动服务\n4） 停止A节点，并升级到4.2.2，然后启动服务","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1579702785,"ip_address":"","comment_id":173156,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师，您好，请问这一系列的课程，其中有一个课程(04 | MongoDB特色及优势)，有描述到有一个企业从1.x升级到4.X，影片时间落在9:48的位置，透过滚动服务升级，透过replica set升级的升级。未来是否有课程会讨论到这一块，我想尝试不下线的方式，从4.2升级到4.22，不知道是否有该实作的教学？谢谢","like_count":3,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481979,"discussion_content":"4.2 版本的驱动程序会自动在换主节点的时候重试读写操作。假设你有三台复制集群节点 A,B,C， A为主节点。你只需要执行以下操作，你的程序应该可以持续运行\n\n1） 确定客户端应用使用的是最新版驱动程序\n2） 停止C节点，并升级到4.2.2，然后启动服务\n3） 停止B节点，并升级到4.2.2，然后启动服务\n4） 停止A节点，并升级到4.2.2，然后启动服务","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579702785,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":175741,"user_name":"cheriston","can_delete":false,"product_type":"c3","uid":1309984,"ip_address":"","ucode":"617CBFCE0925C4","user_header":"https://static001.geekbang.org/account/avatar/00/13/fd/20/2761ef0e.jpg","comment_is_top":false,"comment_ctime":1580815720,"is_pvip":false,"replies":[{"id":68555,"content":"一个ip地址本来就可以对应多个域名。 多个域名指向同一个IP是很常见的。Apache的 Virtual Host就是这个道理。\n\n在这里，因为我们用一台机器部署多个mongodb实例，我们给每个实例用了一个不同的域名，所以就看到了一个ip对应多个域名。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1581090743,"ip_address":"","comment_id":175741,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"192.168.1.1 geekdemo1 member1.example.com member2.example.com,老师为什么1个ip地址对应2个域名 ？","like_count":2,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482882,"discussion_content":"一个ip地址本来就可以对应多个域名。 多个域名指向同一个IP是很常见的。Apache的 Virtual Host就是这个道理。\n\n在这里，因为我们用一台机器部署多个mongodb实例，我们给每个实例用了一个不同的域名，所以就看到了一个ip对应多个域名。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581090743,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":174859,"user_name":"女干部","can_delete":false,"product_type":"c3","uid":1242122,"ip_address":"","ucode":"38843F447B03F2","user_header":"https://static001.geekbang.org/account/avatar/00/12/f4/0a/4b973b2b.jpg","comment_is_top":false,"comment_ctime":1580439685,"is_pvip":false,"replies":[{"id":67966,"content":"对。使用dump&#47;restore 可以加速这个过程。如果不用dump也是可以，时间需要更多点，但是也是可以完成的。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1580446150,"ip_address":"","comment_id":174859,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师，我一直有个疑问，\n如果刚开始只有一台单体，后面想扩容，做分片，搭复制集，但是这台单体上已经有相当的数据，那搭建复制集的时候是不是要先用dump等工具备份恢复一下数据？","like_count":2,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482548,"discussion_content":"对。使用dump/restore 可以加速这个过程。如果不用dump也是可以，时间需要更多点，但是也是可以完成的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580446150,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":173154,"user_name":"garyyang","can_delete":false,"product_type":"c3","uid":1802381,"ip_address":"","ucode":"874A484C8A6EBC","user_header":"","comment_is_top":false,"comment_ctime":1579440013,"is_pvip":false,"replies":[{"id":67871,"content":"\n其实比较简单的，假设ABC三个节点，A是当前主节点，大致可以按照以下步骤：\n\n- 停止C的mongo服务，升级C的mongodb binary文件\n- 重启C服务，等待集群稳定\n- 停止B的mongo服务，升级B的mongodb binary文件\n- 重启B服务，等待集群稳定\n- 停止A，升级A的mongodb binary文件\n- 重启A，等待集群稳定\n\n这里有个中文翻译\nhttp:&#47;&#47;www.mongoing.com&#47;docs&#47;release-notes&#47;3.0-upgrade.html\n","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1580282812,"ip_address":"","comment_id":173154,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师，您好，请问这一系列的课程，其中有一个课程(04 | MongoDB特色及优势)，有描述到有一个企业从1.x升级到4.X，影片时间落在9:48的位置，透过滚动服务升级，透过replica set升级的升级。未来是否有课程会讨论到这一块，我想尝试不下线的方式，从4.2升级到4.22，不知道是否有该实作的教学？谢谢","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481977,"discussion_content":"\n其实比较简单的，假设ABC三个节点，A是当前主节点，大致可以按照以下步骤：\n\n- 停止C的mongo服务，升级C的mongodb binary文件\n- 重启C服务，等待集群稳定\n- 停止B的mongo服务，升级B的mongodb binary文件\n- 重启B服务，等待集群稳定\n- 停止A，升级A的mongodb binary文件\n- 重启A，等待集群稳定\n\n这里有个中文翻译\nhttp://www.mongoing.com/docs/release-notes/3.0-upgrade.html\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580282812,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":173153,"user_name":"garyyang","can_delete":false,"product_type":"c3","uid":1802381,"ip_address":"","ucode":"874A484C8A6EBC","user_header":"","comment_is_top":false,"comment_ctime":1579439988,"is_pvip":false,"replies":[{"id":67872,"content":"假设ABC三个节点，A是当前主节点，以下就是步骤：\n\n- 停止C服务，升级C的mongodb binary文件\n- 重启C服务，等待集群稳定\n- 停止B服务，升级B的mongodb binary文件\n- 重启B服务，等待集群稳定\n- 停止A服务，升级A的mongodb binary文件\n- 重启A服务\n\n很简单。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1580283020,"ip_address":"","comment_id":173153,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"老师，您好，请问这一系列的课程，其中有一个课程(04 | MongoDB特色及优势)，有描述到有一个企业从1.x升级到4.X，影片时间落在9:48的位置，透过滚动服务升级，透过replica set升级的升级。未来是否有课程会讨论到这一块，我想尝试不下线的方式，从4.2升级到4.22，不知道是否有该实作的教学？谢谢","like_count":1,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481976,"discussion_content":"假设ABC三个节点，A是当前主节点，以下就是步骤：\n\n- 停止C服务，升级C的mongodb binary文件\n- 重启C服务，等待集群稳定\n- 停止B服务，升级B的mongodb binary文件\n- 重启B服务，等待集群稳定\n- 停止A服务，升级A的mongodb binary文件\n- 重启A服务\n\n很简单。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580283020,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":206282,"user_name":"HAN","can_delete":false,"product_type":"c3","uid":1308348,"ip_address":"","ucode":"DA651622AA6F5A","user_header":"https://static001.geekbang.org/account/avatar/00/13/f6/bc/9c7e9267.jpg","comment_is_top":false,"comment_ctime":1586834340,"is_pvip":false,"replies":[{"id":77489,"content":"默认只需要配路由节点就可以。副本集切换是透明的。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1587096874,"ip_address":"","comment_id":206282,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"唐老师您好 请教一下，对于分片集群来说，应用端怎样去配置连接串呢？只需要指定对应的几个分片路由节点连接信息就可以了么，后面的副本集发生切换对路由节点或应用有没有感知或者影响呢？\n","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491739,"discussion_content":"默认只需要配路由节点就可以。副本集切换是透明的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587096874,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":175275,"user_name":"Julien","can_delete":false,"product_type":"c3","uid":1204568,"ip_address":"","ucode":"2A3F0CF46B4034","user_header":"https://static001.geekbang.org/account/avatar/00/12/61/58/7b078879.jpg","comment_is_top":false,"comment_ctime":1580638903,"is_pvip":false,"replies":[{"id":68543,"content":"只会重试一次， 会一直等到primary选举成功才会试。如果30秒还没选出来，这个写操作就失败了。\n\n30秒选不出来，这个大概率集群出故障了。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1581086782,"ip_address":"","comment_id":175275,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"Retrywrite 只会重试一次吗？如果重试第二次时新的primary还没被选举出来，是不是会写失败？","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482673,"discussion_content":"只会重试一次， 会一直等到primary选举成功才会试。如果30秒还没选出来，这个写操作就失败了。\n\n30秒选不出来，这个大概率集群出故障了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581086782,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":174788,"user_name":"深藏Blue","can_delete":false,"product_type":"c3","uid":1031616,"ip_address":"","ucode":"CBEBCBDA47281C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bd/c0/57b06721.jpg","comment_is_top":false,"comment_ctime":1580386651,"is_pvip":false,"replies":[{"id":67981,"content":"已经录制，正在等排期发布","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1580476709,"ip_address":"","comment_id":174788,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"是被疫情耽误了更新吗？一直想知道TJ老师对MongoDb的应用场景和选型的讲解","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482517,"discussion_content":"已经录制，正在等排期发布","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580476709,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":173821,"user_name":"hello","can_delete":false,"product_type":"c3","uid":1464199,"ip_address":"","ucode":"854500026E2187","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKhuGLVRYZibOTfMumk53Wn8Q0Rkg0o6DzTicbibCq42lWQoZ8lFeQvicaXuZa7dYsr9URMrtpXMVDDww/132","comment_is_top":false,"comment_ctime":1579708000,"is_pvip":false,"replies":[{"id":67804,"content":"谢谢建议！","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1580254074,"ip_address":"","comment_id":173821,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"就是更新慢了点😀","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482213,"discussion_content":"谢谢建议！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580254074,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":173761,"user_name":"奔奔奔跑","can_delete":false,"product_type":"c3","uid":1210265,"ip_address":"","ucode":"F86EC205DCAACE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Gswh7ibY4tubXhp0BXOmV2pXZ3XsXic1d942ZMAEgWrRSF99bDskOTsG1g172ibORXxSCWTn9HWUX5vSSUVWU5I4A/132","comment_is_top":false,"comment_ctime":1579680894,"is_pvip":false,"replies":[{"id":67806,"content":"MongoDB采用的是B+树。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1580254757,"ip_address":"","comment_id":173761,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"看完了， 每期都做了笔记，老师会有一些答疑篇么，例如mongoDB采用B-树，和mysql 采用B+树这是出于什么方面考虑的，好像还有LVM树","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482198,"discussion_content":"MongoDB采用的是B+树。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580254757,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1121593,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/39/1be8b56c.jpg","nickname":"snzhaoch","note":"","ucode":"033111124D15DC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":161204,"discussion_content":"MongoDB 官网上写的是 B-树啊，https://docs.mongodb.com/manual/indexes/#b-tree","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580875716,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1102022,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d0/c6/0358a528.jpg","nickname":"Jin","note":"","ucode":"B298DB78C72769","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1121593,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/39/1be8b56c.jpg","nickname":"snzhaoch","note":"","ucode":"033111124D15DC","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":348883,"discussion_content":"翻车了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612767927,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":161204,"ip_address":"","group_id":0},"score":348883,"extra":""}]}]},{"had_liked":false,"id":172368,"user_name":"吴亚楠","can_delete":false,"product_type":"c3","uid":1285800,"ip_address":"","ucode":"9582C4086FD13E","user_header":"https://static001.geekbang.org/account/avatar/00/13/9e/a8/09106237.jpg","comment_is_top":false,"comment_ctime":1579162166,"is_pvip":false,"replies":[{"id":66858,"content":"非常好！","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1579171348,"ip_address":"","comment_id":172368,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"看完了，很好\n","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481713,"discussion_content":"非常好！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579171348,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1285800,"avatar":"https://static001.geekbang.org/account/avatar/00/13/9e/a8/09106237.jpg","nickname":"吴亚楠","note":"","ucode":"9582C4086FD13E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":136911,"discussion_content":"会不会讲一些 版本升级的相关内容呀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579171630,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":329500,"user_name":"Julia.SQL","can_delete":false,"product_type":"c3","uid":2657631,"ip_address":"","ucode":"D5E9550547F451","user_header":"https://static001.geekbang.org/account/avatar/00/28/8d/5f/cfc12526.jpg","comment_is_top":false,"comment_ctime":1641375129,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"TJ 您好：\n我遇到的情境是4.4.10的Replicate set，3個節點。\n我參考文件，想要增加新的節點\nhttps:&#47;&#47;docs.mongodb.com&#47;v4.4&#47;reference&#47;method&#47;rs.add&#47;#add-a-secondary-to-an-existing-replica-set\n\nrs.add( { host: &quot;mongodbd4.example.net:27017&quot;, priority: 0, votes: 0 } )\n\n就在資料完成同步，新節點更新狀態\n&quot;msg&quot;:&quot;Member is in new state&quot;,&quot;attr&quot;:{&quot;hostAndPort&quot;:&quot;mongodbd4.example.net:27017&quot;,&quot;newState&quot;:&quot;SECONDARY&quot;}}\n這個時間點，會觀察到有1 秒 Client全斷線重連。\n\n要怎麼操作，才不會是 全部斷線 的現象呢？\n","like_count":0},{"had_liked":false,"id":328748,"user_name":"howdyli","can_delete":false,"product_type":"c3","uid":1190718,"ip_address":"","ucode":"DD949639D29F5E","user_header":"https://static001.geekbang.org/account/avatar/00/12/2b/3e/7ef8f24c.jpg","comment_is_top":false,"comment_ctime":1640862089,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"老师搭建复制集，添加认证有样例吗？","like_count":0},{"had_liked":false,"id":280627,"user_name":"奔跑的脑细胞","can_delete":false,"product_type":"c3","uid":2059107,"ip_address":"","ucode":"84D3DCDE2C96BE","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/cabLXAUXiavUplEOz3rdXFmbiary8v28mrE3f0IEDYogiarKCGFWiaMUTWJBOJ71osicT5r1MFpAQIAm4l43I6QYvBw/132","comment_is_top":false,"comment_ctime":1614298596,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"老师，我想请问下，mongoDB集群可以应用在k8s容器中吗，实现的思路是怎样的？","like_count":0},{"had_liked":false,"id":173366,"user_name":"Lee","can_delete":false,"product_type":"c3","uid":1755439,"ip_address":"","ucode":"0768D6F20B4D0E","user_header":"https://static001.geekbang.org/account/avatar/00/1a/c9/2f/5dd9f654.jpg","comment_is_top":false,"comment_ctime":1579512424,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100040001,"comment_content":"每期更新都看，很不错","like_count":0}]}