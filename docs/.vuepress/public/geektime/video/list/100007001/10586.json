{"id":10586,"title":"58 | Zuul网关对接Apollo(Lab04)","content":"无","comments":[{"had_liked":false,"id":108518,"user_name":"又双叒叕是一年啊","can_delete":false,"product_type":"c3","uid":1000015,"ip_address":"","ucode":"E067320E537DEE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/42/4f/ff1ac464.jpg","comment_is_top":false,"comment_ctime":1561790841,"is_pvip":false,"replies":[{"id":39525,"content":"我的经验，网关集中限流熔断可以覆盖80%场景，还有一些特别的可以由服务单独做熔断限流，比如调用第三方不稳定服务，可以单独用Hystrix做。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1561982072,"ip_address":"","comment_id":108518,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"波波老师，请教一个问题： 微服务的 熔断 和 限流 操作 到底是应该在微服务api接口中 通过hystrix包实现 还是 应该在网关中 统一处理？","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456020,"discussion_content":"我的经验，网关集中限流熔断可以覆盖80%场景，还有一些特别的可以由服务单独做熔断限流，比如调用第三方不稳定服务，可以单独用Hystrix做。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561982072,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69400,"user_name":"超","can_delete":false,"product_type":"c3","uid":1048159,"ip_address":"","ucode":"554F5C30D1B1B2","user_header":"","comment_is_top":false,"comment_ctime":1550735406,"is_pvip":false,"replies":[{"id":25118,"content":"有两个办法：1)将yml格式改成properties格式，apollo原生支持properties配置；2)在zuul中，直接集成apollo原生客户端，需要做一些定制开发(filter)，但是代码量也不会很多。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1551099927,"ip_address":"","comment_id":69400,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"apollo上采用yml格式配置路由规则，zuul要实现动态路由，zuul怎么解析yml文件呢","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440100,"discussion_content":"有两个办法：1)将yml格式改成properties格式，apollo原生支持properties配置；2)在zuul中，直接集成apollo原生客户端，需要做一些定制开发(filter)，但是代码量也不会很多。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551099927,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":31905,"user_name":"钏","can_delete":false,"product_type":"c3","uid":1103237,"ip_address":"","ucode":"FC819B35E8E0ED","user_header":"https://static001.geekbang.org/account/avatar/00/10/d5/85/2975c2a3.jpg","comment_is_top":false,"comment_ctime":1539327040,"is_pvip":false,"replies":[{"id":11728,"content":"可以这样认为，变色龙是spring和apollo之间的一个配置桥接。当然不用变色龙，spring app直接集成apollo也可以，只是有一定耦合性。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1539515608,"ip_address":"","comment_id":31905,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"是不是可以认为，集成了变色龙组件的服务，都可以接入appolo，比如其他用spring boot开发的服务，集成了变色龙组件，也可以对接appolo后，也可以直接动态替换配置文件值？","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426556,"discussion_content":"可以这样认为，变色龙是spring和apollo之间的一个配置桥接。当然不用变色龙，spring app直接集成apollo也可以，只是有一定耦合性。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539515608,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":156644,"user_name":"正是那朵玫瑰","can_delete":false,"product_type":"c3","uid":1048261,"ip_address":"","ucode":"73D630B654573F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fe/c5/3467cf94.jpg","comment_is_top":false,"comment_ctime":1574929362,"is_pvip":false,"replies":[{"id":60217,"content":"具体要看你的apollo和hystrix是怎么对接的。\n\nhystrix原生和archaius集成，archaius支持动态属性(dynamic property)，只要值变更就会实时生效，具体建议看archaius的文档或源码。\n\n如果通过apollo -&gt; archaius -&gt; hystrix这种方式集成，那么这个是archaius定期拉模式，拉到更新以后，archaius会负责实时变更通知到hystrix。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1575008331,"ip_address":"","comment_id":156644,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"波波老师，现在我们spring boot集成了apollo，我们没有做其他任何配置，为什么hystrix的超时时间，线程池的数量都是动态生效的，修改apollo的配置，立即就生效的？ribbon的超时时间也是一样？正常不是应该不生效么？不太明白是哪里让其生效了","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476185,"discussion_content":"具体要看你的apollo和hystrix是怎么对接的。\n\nhystrix原生和archaius集成，archaius支持动态属性(dynamic property)，只要值变更就会实时生效，具体建议看archaius的文档或源码。\n\n如果通过apollo -&amp;gt; archaius -&amp;gt; hystrix这种方式集成，那么这个是archaius定期拉模式，拉到更新以后，archaius会负责实时变更通知到hystrix。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575008331,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":95759,"user_name":"Alpha","can_delete":false,"product_type":"c3","uid":1001861,"ip_address":"","ucode":"60CA15A25EC796","user_header":"https://static001.geekbang.org/account/avatar/00/0f/49/85/3f161d95.jpg","comment_is_top":false,"comment_ctime":1558166950,"is_pvip":false,"replies":[{"id":34424,"content":"一般通过系统属性设置变色龙Archaius对接远程HTTP的配置，参考：https:&#47;&#47;github.com&#47;Netflix&#47;archaius&#47;wiki&#47;Getting-Started(-Darchaius.configurationSource.additionalUrls)，这个配置可以指向Apollo的对应App的配置地址，其中包含AppId。另外参考：https:&#47;&#47;github.com&#47;spring2go&#47;s2g-zuul&#47;blob&#47;master&#47;s2g-zuul-mobile&#47;src&#47;main&#47;java&#47;io&#47;spring2go&#47;zuul&#47;servlet&#47;InitializeServletListener.java，其中的InitializeServletListener方法，里头有Archaius对接Apollo的Url设置（暂时被注释掉），Url中包含有AppId。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1558356106,"ip_address":"","comment_id":95759,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"老师  请问变色龙对接apollo服务器时appid是在哪里设置的？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450588,"discussion_content":"一般通过系统属性设置变色龙Archaius对接远程HTTP的配置，参考：https://github.com/Netflix/archaius/wiki/Getting-Started(-Darchaius.configurationSource.additionalUrls)，这个配置可以指向Apollo的对应App的配置地址，其中包含AppId。另外参考：https://github.com/spring2go/s2g-zuul/blob/master/s2g-zuul-mobile/src/main/java/io/spring2go/zuul/servlet/InitializeServletListener.java，其中的InitializeServletListener方法，里头有Archaius对接Apollo的Url设置（暂时被注释掉），Url中包含有AppId。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558356106,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56396,"user_name":"杨槐","can_delete":false,"product_type":"c3","uid":1178889,"ip_address":"","ucode":"A07D7FA4569F5F","user_header":"https://static001.geekbang.org/account/avatar/00/11/fd/09/13f8a4ab.jpg","comment_is_top":false,"comment_ctime":1546435545,"is_pvip":false,"replies":[{"id":20561,"content":"对，zuul网关实际案例代码在lab05中，过滤器代码在s2g-zuul项目中，其它实验说明中有对lab05代码和过滤器代码的引用。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1546606134,"ip_address":"","comment_id":56396,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"拉取代码只有lab05有代码啊，其余的代码没有啊","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435018,"discussion_content":"对，zuul网关实际案例代码在lab05中，过滤器代码在s2g-zuul项目中，其它实验说明中有对lab05代码和过滤器代码的引用。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546606134,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51051,"user_name":"王盛武","can_delete":false,"product_type":"c3","uid":1182516,"ip_address":"","ucode":"DE7EF246D3DCE8","user_header":"https://static001.geekbang.org/account/avatar/00/12/0b/34/f41d73a4.jpg","comment_is_top":false,"comment_ctime":1545106063,"is_pvip":false,"replies":[{"id":18446,"content":"apollo的一个应用app本身就支持多个名字空间的，你用apollo client就可以获取到不同名字空间内做配置，和zuul没有关系。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1545135582,"ip_address":"","comment_id":51051,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"如果1个zuul要获取apollo的1个集群下的多个名字空间，如何实现？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433251,"discussion_content":"apollo的一个应用app本身就支持多个名字空间的，你用apollo client就可以获取到不同名字空间内做配置，和zuul没有关系。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545135582,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":35471,"user_name":"钏","can_delete":false,"product_type":"c3","uid":1103237,"ip_address":"","ucode":"FC819B35E8E0ED","user_header":"https://static001.geekbang.org/account/avatar/00/10/d5/85/2975c2a3.jpg","comment_is_top":false,"comment_ctime":1540610135,"is_pvip":false,"replies":[{"id":12653,"content":"1，用apollo注解可支持动态修改，spring的value麻烦点要用refresh scope，2，变色龙+apollo可用于启动初期的配置，且支持动态更新","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1540731418,"ip_address":"","comment_id":35471,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"那appllo加上变色龙组件是不是只能解决动态配置文件替换的需求，而且使用的时候，需要用变色龙的api取动态值，如果用spring 的value注解，在启动时候就注入修改不了了？\n如果类似于启动初期的配置，比如数据库，redis之类的，是不是无法用变色龙+appllo满足？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427547,"discussion_content":"1，用apollo注解可支持动态修改，spring的value麻烦点要用refresh scope，2，变色龙+apollo可用于启动初期的配置，且支持动态更新","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540731418,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":28243,"user_name":"学明","can_delete":false,"product_type":"c3","uid":1033677,"ip_address":"","ucode":"1A499A2557F74D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c5/cd/7d3e4355.jpg","comment_is_top":false,"comment_ctime":1538031149,"is_pvip":false,"replies":[{"id":10667,"content":"因为zuul原生支持archaius，netflix把配置都集成好了，对接apollo就不用改代码了。也可以用apollo直接对接zull，用apollo的客户端集成，这时要改代码重新集成。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1538478423,"ip_address":"","comment_id":28243,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"为什么要用 archaius 来对接 apollo，有什么好处？\n为什么不直接在 zuul 中加入 apollo 的 client 来对接？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425192,"discussion_content":"因为zuul原生支持archaius，netflix把配置都集成好了，对接apollo就不用改代码了。也可以用apollo直接对接zull，用apollo的客户端集成，这时要改代码重新集成。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538478423,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1036703,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/d1/9f/d6042f62.jpg","nickname":"liaozd","note":"","ucode":"ABC90DA2F03985","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":581874,"discussion_content":"这样是不是要单独再起一个archaius的服务","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659056920,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":18487,"user_name":"Alex","can_delete":false,"product_type":"c3","uid":1024763,"ip_address":"","ucode":"F6B5C64BC99FB7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a2/fb/94af9cf1.jpg","comment_is_top":false,"comment_ctime":1533368188,"is_pvip":false,"replies":[{"id":6620,"content":"因为zuul原生支持的是archaius，改造成直接用apollo client成本高。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1533695159,"ip_address":"","comment_id":18487,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"为什么不用apollo client对接apollo 而用archaius","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":421550,"discussion_content":"因为zuul原生支持的是archaius，改造成直接用apollo client成本高。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1533695159,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}