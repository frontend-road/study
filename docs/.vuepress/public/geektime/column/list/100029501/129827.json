{"id":129827,"title":"39丨WebSQL：如何在H5中存储一个本地数据库？","content":"<p>上一篇文章中，我们讲到了如何在Excel中使用SQL进行查询。在Web应用中，即使不通过后端语言与数据库进行操作，在Web前端中也可以使用WebSQL。WebSQL是一种操作本地数据库的网页API接口，通过它，我们就可以操作客户端的本地存储。</p><p>今天的课程主要包括以下几方面的内容：</p><ol>\n<li>本地存储都有哪些，什么是WebSQL？</li>\n<li>使用WebSQL的三个核心方法是什么？</li>\n<li>如何使用WebSQL在本地浏览器中创建一个王者荣耀英雄数据库，并对它进行查询和页面的呈现？</li>\n</ol><h2>本地存储都有哪些？什么是WebSQL？</h2><p>我刚才讲到了WebSQL实际上是本地存储。其实本地存储是个更大的概念，你现在可以打开Chrome浏览器，看下本地存储都包括了哪些。</p><p>Cookies是最早的本地存储，是浏览器提供的功能，并且对服务器和JS开放，这意味着我们可以通过服务器端和客户端保存Cookies。不过可以存储的数据总量大小只有4KB，如果超过了这个限制就会忽略，没法进行保存。</p><p>Local Storage与Session Storage都属于Web Storage。Web Storage和Cookies类似，区别在于它有更大容量的存储。其中Local Storage是持久化的本地存储，除非我们主动删除数据，否则会一直存储在本地。Session Storage只存在于Session会话中，也就是说只有在同一个Session的页面才能使用，当Session会话结束后，数据也会自动释放掉。</p><!-- [[[read_end]]] --><p>WebSQL与IndexedDB都是最新的HTML5本地缓存技术，相比于Local Storage和Session Storage来说，存储功能更强大，支持的数据类型也更多，比如图片、视频等。</p><p>WebSQL更准确的说是WebSQL DB API，它是一种操作本地数据库的网页API接口，通过API可以完成客户端数据库的操作。当我们使用WebSQL的时候，可以方便地用SQL来对数据进行增删改查。而这些浏览器客户端，比如Chrome和Safari会用SQLite实现本地存储。</p><p>如果说WebSQL方便我们对RDBMS进行操作，那么IndexedDB则是一种NoSQL方式。它存储的是key-value类型的数据，允许存储大量的数据，通常可以超过250M，并且支持事务，当我们对数据进行增删改查（CRUD）的时候可以通过事务来进行。</p><p><img src=\"https://static001.geekbang.org/resource/image/58/a2/58a474019f55d9854034ed244c4ec4a2.png?wh=1729*665\" alt=\"\"><br>\n你能看到本地存储包括了多种存储方式，它可以很方便地将数据存储在客户端中，在使用的时候避免重复调用服务器的资源。</p><p>需要说明的是，今天我要讲的WebSQL并不属于HTML5规范的一部分，它是一个单独的规范，只是随着HTML5规范一起加入到了浏览器端。主流的浏览器比如Chrome、Safari和Firefox都支持WebSQL，我们可以在JavaScript脚本中使用WebSQL对客户端数据库进行操作。</p><h2>如何使用WebSQL</h2><p>如果你的浏览器不是上面说的那三种，怎么检测你的浏览器是否支持WebSQL呢？这里你可以检查下window对象中是否存在openDatabase属性，方法如下：</p><pre><code>if (!window.openDatabase) {\n  alert('浏览器不支持WebSQL');\n}\n                                \n完整代码如下：\n&lt;!DOCTYPE HTML&gt;\n&lt;html&gt;\n   &lt;head&gt;\n      &lt;meta charset=&quot;UTF-8&quot;&gt;\n      &lt;title&gt;SQL必知必会&lt;/title&gt; \n      &lt;script type=&quot;text/javascript&quot;&gt;                   \n        if (!window.openDatabase) {\n                 alert('浏览器不支持WebSQL');\n        }                               \n      &lt;/script&gt;                    \n   &lt;/head&gt;\n           \n   &lt;body&gt;\n      &lt;div id=&quot;status&quot; name=&quot;status&quot;&gt;WebSQL Test&lt;/div&gt;\n   &lt;/body&gt;       \n&lt;/html&gt;\n</code></pre><p>如果浏览器不支持WebSQL，会有弹窗提示“浏览器不支持WebSQL”，否则就不会有弹窗提示。使用WebSQL也比较简单，主要的方法有3个。</p><h3>打开数据库：openDatabase()</h3><p>我们可以使用openDatabase打开一个已经存在的数据库，也可以创建新的数据库。如果数据库已经存在了，就会直接打开；如果不存在则会创建。方法如下：</p><pre><code>var db = window.openDatabase(dbname, version, dbdesc, dbsize,function() {});\n</code></pre><p>这里openDatabase方法中一共包括了5个参数，分别为数据库名、版本号、描述、数据库大小、创建回调。其中创建回调可以缺省。</p><p>使用openDatabase方法会返回一个数据库句柄，我们可以将它保存在变量db中，方便我们后续进行使用。</p><p>如果我们想要创建一个名为wucai的数据库，版本号为1.0，数据库的描述是“王者荣耀数据库”，大小是1024*1024，创建方法为下面这样。</p><pre><code>var db = openDatabase('wucai', '1.0', '王者荣耀数据库', 1024 * 1024);\n</code></pre><h3>事务操作：transaction()</h3><p>我们使用transaction方法来对事务进行处理，执行提交或回滚操作，方法如下：</p><pre><code>transaction(callback, errorCallback, successCallback); \n</code></pre><p>这里的3个参数代表的含义如下：</p><ol>\n<li>处理事务的回调函数（必选），在回调函数中可以执行SQL语句，会使用到ExecuteSQL方法；</li>\n<li>执行失败时的回调函数（可选）；</li>\n<li>执行成功时的回调函数（可选）。</li>\n</ol><p>如果我们进行了一个事务处理，包括创建heros数据表，想要插入一条数据，方法如下：</p><pre><code>db.transaction(function (tx) {\n    tx.executeSql('CREATE TABLE IF NOT EXISTS heros (id unique, name, hp_max, mp_max, role_main)');\n    tx.executeSql('INSERT INTO heros (id, name, hp_max, mp_max, role_main) VALUES (10000, &quot;夏侯惇&quot;, 7350, 1746, &quot;坦克&quot;)');\n});\n</code></pre><p>这里执行的事务就是一个方法，包括两条SQL语句。tx表示的是回调函数的接收参数，也就是transaction对象的引用，方便我们在方法中进行使用。</p><h3>SQL执行：executeSql()</h3><p>ExecuteSQL命令用来执行SQL语句，即增删改查。方法如下：</p><pre><code>tx.executeSql(sql, [], callback, errorCallback);\n</code></pre><p>这里包括了4个参数，它们代表的含义如下所示：</p><ol>\n<li>要执行的sql语句。</li>\n<li>SQL语句中的占位符（?）所对应的参数。</li>\n<li>执行SQL成功时的回调函数。</li>\n<li>执行SQL失败时的回调函数。</li>\n</ol><p>假如我们想要创建一个heros数据表，可以使用如下命令：</p><pre><code>tx.executeSql('CREATE TABLE IF NOT EXISTS heros (id unique, name, hp_max, mp_max, role_main)');\n</code></pre><p>假如我们想要对刚创建的heros数据表插入一条数据，可以使用：</p><pre><code>tx.executeSql('INSERT INTO heros (id, name, hp_max, mp_max, role_main) VALUES (10000, &quot;夏侯惇&quot;, 7350, 1746, &quot;坦克&quot;)');\n</code></pre><h2>在浏览器端做一个王者荣耀英雄的查询页面</h2><p>刚才我讲解了WebSQL的基本语法，现在我们就来用刚学到的东西做一个小练习：在浏览器端做一个王者荣耀英雄的创建和查询页面。</p><p>具体步骤如下：</p><ol>\n<li>初始化数据：我们需要在HTML中设置一个id为datatable的table表格，然后在JavaScript中创建init()函数，获取id为datatable的元素。</li>\n<li>创建showData方法：参数为查询出来的数据row，showData方法可以方便地展示查询出来的一行数据我们在数据表中的字段为id、name、hp_max、mp_max和role_main，因此我们可以使用row.id、row.name、row.hp_max、row.mp_max和row.role_main来获取这些字段的数值，并且创建相应的标签，将这5个字段放到一个里面。</li>\n<li>使用openDatabase方法打开数据库：这里我们定义的数据库名为wucai，版本号为1.0，数据库描述为“王者荣耀英雄数据”，大小为1024 * 1024。</li>\n<li>使用transaction方法执行两个事务：第一个事务是创建heros数据表，并且插入5条数据。第二个事务是对heros数据表进行查询，并且对查询出来的数据行使用showData方法进行展示。</li>\n</ol><p>完整代码如下（也可以通过<a href=\"(https://github.com/cystanford/WebSQL)\">GitHub</a>下载）：</p><pre><code>&lt;!DOCTYPE HTML&gt;\n&lt;html&gt;\n   &lt;head&gt;\n      &lt;meta charset=&quot;UTF-8&quot;&gt;\n      &lt;title&gt;SQL必知必会&lt;/title&gt; \n      &lt;script type=&quot;text/javascript&quot;&gt;\n         // 初始化\n         function init() {\n            datatable = document.getElementById(&quot;datatable&quot;);\n         }\n         // 显示每个英雄的数据\n         function showData(row){\n            var tr = document.createElement(&quot;tr&quot;);\n            var td1 = document.createElement(&quot;td&quot;);\n            var td2 = document.createElement(&quot;td&quot;);\n            var td3 = document.createElement(&quot;td&quot;);\n            var td4 = document.createElement(&quot;td&quot;);\n            var td5 = document.createElement(&quot;td&quot;); \n            td1.innerHTML = row.id;\n            td2.innerHTML = row.name;\n            td3.innerHTML = row.hp_max;\n            td4.innerHTML = row.mp_max;\n            td5.innerHTML = row.role_main;\n            tr.appendChild(td1);\n            tr.appendChild(td2);\n            tr.appendChild(td3);\n            tr.appendChild(td4);\n            tr.appendChild(td5);\n            datatable.appendChild(tr);   \n         }\n         // 设置数据库信息\n         var db = openDatabase('wucai', '1.0', '王者荣耀英雄数据', 1024 * 1024);\n         var msg;\n           // 插入数据\n         db.transaction(function (tx) {\n            tx.executeSql('CREATE TABLE IF NOT EXISTS heros (id unique, name, hp_max, mp_max, role_main)');\n            tx.executeSql('INSERT INTO heros (id, name, hp_max, mp_max, role_main) VALUES (10000, &quot;夏侯惇&quot;, 7350, 1746, &quot;坦克&quot;)');\n            tx.executeSql('INSERT INTO heros (id, name, hp_max, mp_max, role_main) VALUES (10001, &quot;钟无艳&quot;, 7000, 1760, &quot;战士&quot;)');\n            tx.executeSql('INSERT INTO heros (id, name, hp_max, mp_max, role_main) VALUES (10002, &quot;张飞&quot;, 8341, 100, &quot;坦克&quot;)');\n            tx.executeSql('INSERT INTO heros (id, name, hp_max, mp_max, role_main) VALUES (10003, &quot;牛魔&quot;, 8476, 1926, &quot;坦克&quot;)');\n            tx.executeSql('INSERT INTO heros (id, name, hp_max, mp_max, role_main) VALUES (10004, &quot;吕布&quot;, 7344, 0, &quot;战士&quot;)');\n            msg = '&lt;p&gt;heros数据表创建成功，一共插入5条数据。&lt;/p&gt;';\n            document.querySelector('#status').innerHTML =  msg;\n         });\n         // 查询数据\n         db.transaction(function (tx) {\n            tx.executeSql('SELECT * FROM heros', [], function (tx, data) {\n               var len = data.rows.length;\n               msg = &quot;&lt;p&gt;查询记录条数: &quot; + len + &quot;&lt;/p&gt;&quot;;\n               document.querySelector('#status').innerHTML +=  msg;\n                  // 将查询的英雄数据放到 datatable中\n               for (i = 0; i &lt; len; i++){\n                  showData(data.rows.item(i));\n               }\n            });\n\n         });\n      &lt;/script&gt;\n   &lt;/head&gt; \n   &lt;body&gt;\n      &lt;div id=&quot;status&quot; name=&quot;status&quot;&gt;状态信息&lt;/div&gt;\n      &lt;table border=&quot;1&quot; id=&quot;datatable&quot;&gt;&lt;/table&gt;\n   &lt;/body&gt; \n&lt;/html&gt;\n</code></pre><p>演示结果如下：</p><p><img src=\"https://static001.geekbang.org/resource/image/3e/33/3e7e08ea2c5d768ed0bdbd757c6b8f33.png?wh=1009*703\" alt=\"\"><br>\n你能看到使用WebSQL来操作本地存储还是很方便的。</p><p>刚才我们讲的是创建本地存储，那么如何删除呢？你可以直接通过浏览器来删除，比如在Chrome浏览器中找到Application中的Clear storage，然后使用Clear site data即可：</p><p><img src=\"https://static001.geekbang.org/resource/image/0e/db/0eec0b6cd8a11e6e52af6595b02ac9db.png?wh=1291*790\" alt=\"\"></p><h2>总结</h2><p>今天我讲解了如何在浏览器中通过WebSQL来操作本地存储，如果想使用SQL来管理和查询本地存储，我们可以使用WebSQL，通过三个核心的方法就可以方便让我们对数据库的连接，事务处理，以及SQL语句的执行来进行操作。我在Github上提供了操作的HTML代码，如果还没有使用过WebSQL就快来使用下吧。</p><p><img src=\"\" alt=\"\"></p><p>我今天讲到了本地存储，在浏览器中包括了Cookies、Local Storage、Session Storage、WebSQL和IndexedDB这5种形式的本地存储，你能说下它们之间的区别么？</p><p>最后是一道动手题，请你使用WebSQL创建数据表heros，并且插入5个以上的英雄数据，字段为id、name、hp_max、mp_max、role_main。在HTML中添加一个输入框，可以输入英雄的姓名，并对该英雄的数据进行查询，如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/dc/08/dcdefa40424e4e9910dbef9dd6938d08.png?wh=1028*305\" alt=\"\"></p><p>欢迎你在评论区写下你的答案，我会和你一起交流，也欢迎把这篇文章分享给你的朋友或者同事，与他们一起交流一下。</p>","neighbors":{"left":{"article_title":"38丨如何在Excel中使用SQL语言？","id":128758},"right":{"article_title":"40丨SQLite：为什么微信用SQLite存储聊天记录？","id":131660}},"comments":[{"had_liked":false,"id":130264,"user_name":"Middleware","can_delete":false,"product_type":"c1","uid":1072015,"ip_address":"","ucode":"C0028293ECDD47","user_header":"https://static001.geekbang.org/account/avatar/00/10/5b/8f/4b0ab5db.jpg","comment_is_top":false,"comment_ctime":1567414956,"is_pvip":true,"replies":[{"id":"62733","content":"赞下认真做作业的同学","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577087384,"ip_address":"","comment_id":130264,"utype":1}],"discussion_count":2,"race_medal":1,"score":"40222120620","product_id":100029501,"comment_content":"```php<br>&lt;body&gt;<br>    &lt;div class=&quot;content&quot;&gt;<br>        &lt;label for=&quot;name&quot;&gt;&lt;&#47;label&gt;<br>        &lt;input id=&quot;name&quot; type=&quot;text&quot; name=&quot;name&quot;&gt; <br>        &lt;input type=&quot;button&quot; value=&quot;查询&quot; onclick=&quot;query()&quot;&gt;<br>    &lt;&#47;div&gt;<br>    &lt;script type=&quot;text&#47;javascript&quot;&gt;<br>        if(!window.openDatabase)<br>        {<br>            alert(&#39;您的浏览器不支持 WebSQL&#39;);<br>        }<br>        var db = openDatabase(&#39;wucai&#39;, &#39;1.0&#39;, &#39;王者荣耀数据库&#39;, 1024 * 1024);<br><br>        db.transaction(function (tx) {<br>            tx.executeSql(&#39;CREATE TABLE IF NOT EXISTS heros (id unique, name, hp_max, mp_max, role_main)&#39;);<br>            tx.executeSql(&#39;INSERT INTO heros (id, name, hp_max, mp_max, role_main) VALUES (10000, &quot;夏侯惇&quot;, 7350, 1746, &quot; 坦克 &quot;)&#39;);<br>            tx.executeSql(&#39;INSERT INTO heros (id, name, hp_max, mp_max, role_main) VALUES (10001, &quot;钟无艳&quot;, 7000, 1760, &quot; 战士 &quot;)&#39;);<br>            tx.executeSql(&#39;INSERT INTO heros (id, name, hp_max, mp_max, role_main) VALUES (10002, &quot;张飞&quot;, 8341, 100, &quot; 坦克 &quot;)&#39;);<br>            tx.executeSql(&#39;INSERT INTO heros (id, name, hp_max, mp_max, role_main) VALUES (10003, &quot;牛魔&quot;, 8476, 1926, &quot; 坦克 &quot;)&#39;);<br>            tx.executeSql(&#39;INSERT INTO heros (id, name, hp_max, mp_max, role_main) VALUES (10004, &quot;吕布&quot;, 7344, 0, &quot; 战士 &quot;)&#39;);<br>            msg = &#39; 数据表创建成功，一共插入 5 条数据&#39;;<br>            <br>            console.log(msg);<br>         });<br><br>         function query(){<br>            var name = document.getElementById(&#39;name&#39;).value;<br>            <br>            var sql = &#39;SELECT * FROM heros where name like ?&#39;;<br>             &#47;&#47; 查询数据<br>            db.transaction(function (tx) {<br>                tx.executeSql(sql, [&#39;%&#39;+name+&#39;%&#39;], function (tx, data) {<br>                var len = data.rows.length;<br>                console.log(&#39;查找到：&#39; +len +&#39;条记录&#39;);<br>                console.log(data.rows);<br>                });<br><br>            });<br>         }<br>    &lt;&#47;script&gt;<br>&lt;&#47;body&gt;<br>```","like_count":10,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465880,"discussion_content":"赞下认真做作业的同学","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577087384,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1072015,"avatar":"https://static001.geekbang.org/account/avatar/00/10/5b/8f/4b0ab5db.jpg","nickname":"Middleware","note":"","ucode":"C0028293ECDD47","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":7177,"discussion_content":"MD都不支持。。。。。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1567416270,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":155048,"user_name":"ABC","can_delete":false,"product_type":"c1","uid":1054958,"ip_address":"","ucode":"7501AD9C0C4A70","user_header":"https://static001.geekbang.org/account/avatar/00/10/18/ee/a1ed60d1.jpg","comment_is_top":false,"comment_ctime":1574641121,"is_pvip":false,"replies":[{"id":"62643","content":"这个不错，多谢分享","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577080419,"ip_address":"","comment_id":155048,"utype":1}],"discussion_count":2,"race_medal":0,"score":"23049477601","product_id":100029501,"comment_content":"localForage这个库可以兼容处理IndexDB,localStorage,webSQL等","like_count":6,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475646,"discussion_content":"这个不错，多谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577080419,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1514919,"avatar":"","nickname":"Geek_e39088","note":"","ucode":"F4A84207C9088A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":259775,"discussion_content":"这个现在的浏览器都支持吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588816503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130234,"user_name":"Middleware","can_delete":false,"product_type":"c1","uid":1072015,"ip_address":"","ucode":"C0028293ECDD47","user_header":"https://static001.geekbang.org/account/avatar/00/10/5b/8f/4b0ab5db.jpg","comment_is_top":false,"comment_ctime":1567410004,"is_pvip":true,"replies":[{"id":"63508","content":"对 可以使用localForage","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577515354,"ip_address":"","comment_id":130234,"utype":1}],"discussion_count":1,"race_medal":1,"score":"23042246484","product_id":100029501,"comment_content":"WebSQL 这项标准已经废弃了吧<br><br>https:&#47;&#47;dev.w3.org&#47;html5&#47;webdatabase&#47;","like_count":6,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465868,"discussion_content":"对 可以使用localForage","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577515354,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130211,"user_name":"许童童","can_delete":false,"product_type":"c1","uid":1003005,"ip_address":"","ucode":"4B799C0C6BC678","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg","comment_is_top":false,"comment_ctime":1567403934,"is_pvip":false,"replies":[{"id":"63509","content":"嗯 多一个了解","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577515365,"ip_address":"","comment_id":130211,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14452305822","product_id":100029501,"comment_content":"WebSQL的功能确实很强大，但是在目前的项目中还没有用到过。","like_count":4,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465858,"discussion_content":"嗯 多一个了解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577515365,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130089,"user_name":"nimil","can_delete":false,"product_type":"c1","uid":1197925,"ip_address":"","ucode":"19933068972746","user_header":"https://static001.geekbang.org/account/avatar/00/12/47/65/cce8eb34.jpg","comment_is_top":false,"comment_ctime":1567385480,"is_pvip":false,"replies":[{"id":"53386","content":"嗯 虽然标准已经废弃了，不过在一些浏览器中还是可以使用","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1570431750,"ip_address":"","comment_id":130089,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10157320072","product_id":100029501,"comment_content":"这个功能厉害了","like_count":3,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465797,"discussion_content":"嗯 虽然标准已经废弃了，不过在一些浏览器中还是可以使用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570431750,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1514919,"avatar":"","nickname":"Geek_e39088","note":"","ucode":"F4A84207C9088A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":259774,"discussion_content":"一些还是不能作为主流在项目中应用，除非是特定的管理系统，","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588816425,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":226932,"user_name":"RRR","can_delete":false,"product_type":"c1","uid":1014991,"ip_address":"","ucode":"F32A579D201EC5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7c/cf/d5382404.jpg","comment_is_top":false,"comment_ctime":1592230934,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5887198230","product_id":100029501,"comment_content":"webSQL 已经被规范废弃，现在只支持 IndexDB。","like_count":2},{"had_liked":false,"id":195329,"user_name":"博弈","can_delete":false,"product_type":"c1","uid":1433344,"ip_address":"","ucode":"B1A69837E41972","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/EcYNib1bnDf5dz6JcrE8AoyZYMdqic2VNmbBtCcVZTO9EoDZZxqlQDEqQKo6klCCmklOtN9m0dTd2AOXqSneJYLw/132","comment_is_top":false,"comment_ctime":1585180661,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5880147957","product_id":100029501,"comment_content":"了解了浏览器端的五种存储方式：Cookie,Local storage,Session storage,WebSQL,IndexedDB","like_count":2},{"had_liked":false,"id":192777,"user_name":"victor666","can_delete":false,"product_type":"c1","uid":1073136,"ip_address":"","ucode":"20C9BE10E07D55","user_header":"https://static001.geekbang.org/account/avatar/00/10/5f/f0/a73607b3.jpg","comment_is_top":false,"comment_ctime":1584872604,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5879839900","product_id":100029501,"comment_content":"挺有意思的。可以拿来做SQL语句测试","like_count":2},{"had_liked":false,"id":150605,"user_name":"雪飞鸿","can_delete":false,"product_type":"c1","uid":1012325,"ip_address":"","ucode":"65D7B030828809","user_header":"https://static001.geekbang.org/account/avatar/00/0f/72/65/68bd8177.jpg","comment_is_top":false,"comment_ctime":1573566960,"is_pvip":true,"replies":[{"id":"59736","content":"对的 IndexedDB有自己的事务处理机制","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1574738649,"ip_address":"","comment_id":150605,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1573566960","product_id":100029501,"comment_content":"看了下文档IndexedDB虽然是NoSql，但也是基于事务来处理数据的。","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474216,"discussion_content":"对的 IndexedDB有自己的事务处理机制","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574738649,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1919541,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/4a/35/66caeed9.jpg","nickname":"完美坚持","note":"","ucode":"AE0261D8DDEF64","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377981,"discussion_content":"你好，请问下你看的是什么文档","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622987335,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1012325,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/72/65/68bd8177.jpg","nickname":"雪飞鸿","note":"","ucode":"65D7B030828809","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1919541,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/4a/35/66caeed9.jpg","nickname":"完美坚持","note":"","ucode":"AE0261D8DDEF64","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378104,"discussion_content":"MDN网站上","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623056721,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":377981,"ip_address":""},"score":378104,"extra":""}]}]},{"had_liked":false,"id":130458,"user_name":"asdf100","can_delete":false,"product_type":"c1","uid":1043738,"ip_address":"","ucode":"39D8D71453E575","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ed/1a/ce7f7d54.jpg","comment_is_top":false,"comment_ctime":1567469743,"is_pvip":false,"replies":[{"id":"51478","content":"除了在浏览器里手动删除以外，完全可以通过程序来控制本地的SQLite。<br>同样使用executeSql函数即可，在executeSql函数后面可以有两个function分别代表成功之后的调用，以及SQL执行失败的调用。比如想要删除本地SQLite的heros数据表，可以使用：<br>tx.executeSql(&quot;DROP TABLE heros&quot;,[], <br>function(tx, result) {alert(&#39;Drop 成功&#39;);},<br>function(tx, error) {alert(&#39;Drop 失败&#39; + error.message);});","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1568790216,"ip_address":"","comment_id":130458,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1567469743","product_id":100029501,"comment_content":"这两个都是长期有效，只能用户手动删除才可以的吗？","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465963,"discussion_content":"除了在浏览器里手动删除以外，完全可以通过程序来控制本地的SQLite。\n同样使用executeSql函数即可，在executeSql函数后面可以有两个function分别代表成功之后的调用，以及SQL执行失败的调用。比如想要删除本地SQLite的heros数据表，可以使用：\ntx.executeSql(&amp;quot;DROP TABLE heros&amp;quot;,[], \nfunction(tx, result) {alert(&amp;#39;Drop 成功&amp;#39;);},\nfunction(tx, error) {alert(&amp;#39;Drop 失败&amp;#39; + error.message);});","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568790216,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043738,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ed/1a/ce7f7d54.jpg","nickname":"asdf100","note":"","ucode":"39D8D71453E575","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":15076,"discussion_content":"答非所问呀？我的疑问是记录有效期问题，是长期有效吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568802642,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130155,"user_name":"humor","can_delete":false,"product_type":"c1","uid":1181867,"ip_address":"","ucode":"9B48C4C7BEC92C","user_header":"https://static001.geekbang.org/account/avatar/00/12/08/ab/caec7bca.jpg","comment_is_top":false,"comment_ctime":1567392719,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1567392719","product_id":100029501,"comment_content":"session是什么概念呢？http请求不是无状态的么，难道一次http请求就是一个session吗","like_count":1,"discussions":[{"author":{"id":1012325,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/72/65/68bd8177.jpg","nickname":"雪飞鸿","note":"","ucode":"65D7B030828809","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":49238,"discussion_content":"本地存储并不需要和服务器交互，也就没有HTTP通讯。这里的session指的是page session，即从打开浏览器开始到关闭浏览器这段时间，即使刷新了当前页面或关闭当前页面后再重新打开，也是同一个page session。但是打开一个新页面（即使同一个url）就属于不同的page session。\n你可以在浏览器开发者工具控制台中使用sessionStroage写入数据实验下。\n另外，所有本地存储都受同源策略限制。\n可以参考下文档：\nhttps://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1573566388,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}