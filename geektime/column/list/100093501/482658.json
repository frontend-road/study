{"id":482658,"title":"37ï½œä»£ç æ“ç»ƒï¼šæ€ä¹ˆå®ç°ä¸€ä¸ªTCPæœåŠ¡å™¨ï¼Ÿï¼ˆä¸­ï¼‰","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯Tony Baiã€‚</p><p>ä¸Šä¸€è®²ä¸­ï¼Œæˆ‘ä»¬è®²è§£äº†è§£å†³Goè¯­è¨€å­¦ä¹ â€œæœ€åä¸€å…¬é‡Œâ€çš„å®ç”¨æ€è·¯ï¼Œé‚£å°±æ˜¯â€œç†è§£é—®é¢˜â€ -&gt; â€œæŠ€æœ¯é¢„ç ”ä¸å‚¨å¤‡â€ -&gt; â€œè®¾è®¡ä¸å®ç°â€çš„ä¸‰è§’å¾ªç¯ï¼Œå¹¶ä¸”æˆ‘ä»¬ä¹Ÿå®Œæˆäº†â€œç†è§£é—®é¢˜â€å’Œâ€œæŠ€æœ¯é¢„ç ”ä¸å‚¨å¤‡â€è¿™ä¸¤ä¸ªç¯èŠ‚ï¼ŒæŒ‰ç…§â€œä¸‰è§’å¾ªç¯â€ä¸­çš„æ€è·¯ï¼Œè¿™ä¸€è®²æˆ‘ä»¬åº”è¯¥é’ˆå¯¹å®é™…é—®é¢˜è¿›è¡Œä¸€è½®è®¾è®¡ä¸å®ç°äº†ã€‚</p><p>ä»Šå¤©ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯å®ç°ä¸€ä¸ªåŸºäºTCPçš„è‡ªå®šä¹‰åº”ç”¨å±‚åè®®çš„é€šä¿¡æœåŠ¡ç«¯ï¼Œè¦å®Œæˆè¿™ä¸€ç›®æ ‡ï¼Œæˆ‘ä»¬éœ€è¦å»ºç«‹åè®®çš„æŠ½è±¡ã€å®ç°åè®®çš„æ‰“åŒ…ä¸è§£åŒ…ã€æœåŠ¡ç«¯çš„ç»„è£…ã€éªŒè¯ä¸ä¼˜åŒ–ç­‰å·¥ä½œã€‚ä¸€æ­¥ä¸€æ­¥æ¥ï¼Œæˆ‘ä»¬å…ˆåœ¨ç¨‹åºä¸–ç•Œå»ºç«‹ä¸€ä¸ªå¯¹ä¸Šä¸€è®²ä¸­è‡ªå®šä¹‰åº”ç”¨å±‚åè®®çš„æŠ½è±¡ã€‚</p><h2>å»ºç«‹å¯¹åè®®çš„æŠ½è±¡</h2><p>ç¨‹åºæ˜¯å¯¹ç°å®ä¸–ç•Œçš„æŠ½è±¡ã€‚å¯¹äºç°å®ä¸–ç•Œçš„è‡ªå®šä¹‰åº”ç”¨åè®®è§„èŒƒï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç¨‹åºä¸–ç•Œå»ºç«‹èµ·å¯¹è¿™ä»½åè®®çš„æŠ½è±¡ã€‚åœ¨è¿›è¡ŒæŠ½è±¡ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå»ºç«‹è¿™æ¬¡å®ç°è¦ç”¨çš„æºç é¡¹ç›®tcp-server-demo1ï¼Œå»ºç«‹çš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">$mkdir tcp-server-demo1\n$cd tcp-server-demo1\n$go mod init github.com/bigwhite/tcp-server-demo1\ngo: creating new go.mod: module github.com/bigwhite/tcp-server-demo1\n</code></pre><!-- [[[read_end]]] --><p>ä¸ºäº†æ–¹ä¾¿å­¦ä¹ ï¼Œæˆ‘è¿™é‡Œå†å°†ä¸Šä¸€è®²ä¸­çš„è‡ªå®šä¹‰åè®®è§„èŒƒè´´å‡ºæ¥å¯¹ç…§å‚è€ƒï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/70/21/70b43197100a790f3a78db50997c1d21.jpg?wh=1980x1080\" alt=\"\"></p><h3>æ·±å…¥åè®®å­—æ®µ</h3><p>ä¸Šä¸€è®²ï¼Œæˆ‘ä»¬æ²¡æœ‰æ·±å…¥åˆ°åè®®è§„èŒƒä¸­å¯¹åè®®çš„å„ä¸ªå­—æ®µè¿›è¡Œè®²è§£ï¼Œä½†åœ¨å»ºç«‹æŠ½è±¡ä¹‹å‰ï¼Œæˆ‘ä»¬æœ‰å¿…è¦äº†è§£ä¸€ä¸‹å„ä¸ªå­—æ®µçš„å…·ä½“å«ä¹‰ã€‚</p><p>è¿™æ˜¯ä¸€ä¸ªé«˜åº¦ç®€åŒ–çš„ã€åŸºäºäºŒè¿›åˆ¶æ¨¡å¼å®šä¹‰çš„åè®®ã€‚äºŒè¿›åˆ¶æ¨¡å¼å®šä¹‰çš„ç‰¹ç‚¹ï¼Œå°±æ˜¯é‡‡ç”¨é•¿åº¦å­—æ®µæ ‡è¯†ç‹¬ç«‹æ•°æ®åŒ…çš„è¾¹ç•Œã€‚</p><p>åœ¨è¿™ä¸ªåè®®è§„èŒƒä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼šè¯·æ±‚åŒ…å’Œåº”ç­”åŒ…çš„ç¬¬ä¸€ä¸ªå­—æ®µï¼ˆtotalLengthï¼‰éƒ½æ˜¯åŒ…çš„æ€»é•¿åº¦ï¼Œå®ƒå°±æ˜¯ç”¨æ¥æ ‡è¯†åŒ…è¾¹ç•Œçš„é‚£ä¸ªå­—æ®µï¼Œä¹Ÿæ˜¯åœ¨åº”ç”¨å±‚ç”¨äºâ€œåˆ†å‰²åŒ…â€çš„æœ€é‡è¦å­—æ®µã€‚</p><p>è¯·æ±‚åŒ…ä¸åº”ç­”åŒ…çš„ç¬¬äºŒä¸ªå­—æ®µä¹Ÿä¸€æ ·ï¼Œéƒ½æ˜¯commandIDï¼Œè¿™ä¸ªå­—æ®µç”¨äºæ ‡è¯†åŒ…ç±»å‹ï¼Œè¿™é‡Œæˆ‘ä»¬å®šä¹‰å››ç§åŒ…ç±»å‹ï¼š</p><ul>\n<li>è¿æ¥è¯·æ±‚åŒ…ï¼ˆå€¼ä¸º0x01ï¼‰</li>\n<li>æ¶ˆæ¯è¯·æ±‚åŒ…ï¼ˆå€¼ä¸º0x02ï¼‰</li>\n<li>è¿æ¥å“åº”åŒ…ï¼ˆå€¼ä¸º0x81ï¼‰</li>\n<li>æ¶ˆæ¯å“åº”åŒ…ï¼ˆå€¼ä¸º0x82ï¼‰</li>\n</ul><p>æ¢ä¸ºå¯¹åº”çš„ä»£ç å°±æ˜¯ï¼š</p><pre><code class=\"language-plain\">const (\n    CommandConn   = iota + 0x01 // 0x01ï¼Œè¿æ¥è¯·æ±‚åŒ…\n    CommandSubmit               // 0x02ï¼Œæ¶ˆæ¯è¯·æ±‚åŒ…\n)\n\nconst (\n    CommandConnAck   = iota + 0x81 // 0x81ï¼Œè¿æ¥è¯·æ±‚çš„å“åº”åŒ…\n    CommandSubmitAck               // 0x82ï¼Œæ¶ˆæ¯è¯·æ±‚çš„å“åº”åŒ…\n)\n</code></pre><p>è¯·æ±‚åŒ…ä¸åº”ç­”åŒ…çš„ç¬¬ä¸‰ä¸ªå­—æ®µéƒ½æ˜¯IDï¼ŒIDæ˜¯æ¯ä¸ªè¿æ¥ä¸Šè¯·æ±‚åŒ…çš„æ¶ˆæ¯æµæ°´å·ï¼Œé¡ºåºç´¯åŠ ï¼Œæ­¥é•¿ä¸º1ï¼Œå¾ªç¯ä½¿ç”¨ï¼Œå¤šç”¨æ¥è¯·æ±‚å‘é€æ–¹ååŒ¹é…å“åº”åŒ…ï¼Œæ‰€ä»¥è¦æ±‚ä¸€å¯¹è¯·æ±‚ä¸å“åº”æ¶ˆæ¯çš„æµæ°´å·å¿…é¡»ç›¸åŒã€‚</p><p>è¯·æ±‚åŒ…ä¸å“åº”åŒ…å”¯ä¸€çš„ä¸åŒä¹‹å¤„ï¼Œå°±åœ¨äºæœ€åä¸€ä¸ªå­—æ®µï¼šè¯·æ±‚åŒ…å®šä¹‰äº†æœ‰æ•ˆè½½è·ï¼ˆpayloadï¼‰ï¼Œè¿™ä¸ªå­—æ®µæ‰¿è½½äº†åº”ç”¨å±‚éœ€è¦çš„ä¸šåŠ¡æ•°æ®ï¼›è€Œå“åº”åŒ…åˆ™å®šä¹‰äº†è¯·æ±‚åŒ…çš„å“åº”çŠ¶æ€å­—æ®µï¼ˆresultï¼‰ï¼Œè¿™é‡Œå…¶å®ç®€åŒ–äº†å“åº”çŠ¶æ€å­—æ®µçš„å–å€¼ï¼ŒæˆåŠŸçš„å“åº”ç”¨0è¡¨ç¤ºï¼Œå¦‚æœæ˜¯å¤±è´¥çš„å“åº”ï¼Œæ— è®ºå¤±è´¥åŸå› æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬éƒ½ç”¨1æ¥è¡¨ç¤ºã€‚</p><p>æ˜ç¡®äº†åº”ç”¨å±‚åè®®çš„å„ä¸ªå­—æ®µå®šä¹‰ä¹‹åï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥å°±çœ‹çœ‹å¦‚ä½•å»ºç«‹èµ·å¯¹è¿™ä¸ªåè®®çš„æŠ½è±¡ã€‚</p><h3>å»ºç«‹Frameå’ŒPacketæŠ½è±¡</h3><p>é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“ï¼ŒTCPè¿æ¥ä¸Šçš„æ•°æ®æ˜¯ä¸€ä¸ªæ²¡æœ‰è¾¹ç•Œçš„å­—èŠ‚æµï¼Œä½†åœ¨ä¸šåŠ¡å±‚çœ¼ä¸­ï¼Œæ²¡æœ‰å­—èŠ‚æµï¼Œåªæœ‰å„ç§åè®®æ¶ˆæ¯ã€‚å› æ­¤ï¼Œæ— è®ºæ˜¯ä»å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯ï¼Œè¿˜æ˜¯ä»æœåŠ¡ç«¯åˆ°å®¢æˆ·ç«¯ï¼Œä¸šåŠ¡å±‚åœ¨è¿æ¥ä¸Šçœ‹åˆ°çš„éƒ½åº”è¯¥æ˜¯ä¸€ä¸ªæŒ¨ç€ä¸€ä¸ªçš„åè®®æ¶ˆæ¯æµã€‚</p><p>ç°åœ¨æˆ‘ä»¬å»ºç«‹ç¬¬ä¸€ä¸ªæŠ½è±¡ï¼š<strong>Frame</strong>ã€‚æ¯ä¸ªFrameè¡¨ç¤ºä¸€ä¸ªåè®®æ¶ˆæ¯ï¼Œè¿™æ ·åœ¨ä¸šåŠ¡å±‚çœ¼ä¸­ï¼Œè¿æ¥ä¸Šçš„å­—èŠ‚æµå°±æ˜¯ç”±ä¸€ä¸ªæ¥ç€ä¸€ä¸ªFrameç»„æˆçš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/96/34/962d1839064759e3180a78d168700034.jpg?wh=1920x1080\" alt=\"\"></p><p>æˆ‘ä»¬çš„è‡ªå®šä¹‰åè®®å°±å°è£…åœ¨è¿™ä¸€ä¸ªä¸ªçš„Frameä¸­ã€‚åè®®è§„å®šäº†å°†Frameåˆ†å‰²å¼€æ¥çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯åˆ©ç”¨æ¯ä¸ªFrameå¼€å§‹å¤„çš„totalLengthï¼Œæ¯ä¸ªFrameç”±ä¸€ä¸ªtotalLengthå’ŒFrameçš„è´Ÿè½½ï¼ˆpayloadï¼‰æ„æˆï¼Œæ¯”å¦‚ä½ å¯ä»¥çœ‹çœ‹ä¸‹å›¾ä¸­å·¦ä¾§çš„Frameç»“æ„ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/cd/cf/cdcc981fdc752dea66f4ba01f7da91cf.jpg?wh=1980x1080\" alt=\"\"></p><p>è¿™æ ·ï¼Œæˆ‘ä»¬é€šè¿‡Frame header: totalLengthå°±å¯ä»¥å°†Frameä¹‹é—´éš”ç¦»å¼€æ¥ã€‚</p><p>åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å»ºç«‹åè®®çš„ç¬¬äºŒä¸ªæŠ½è±¡ï¼š<strong>Packet</strong>ã€‚æˆ‘ä»¬å°†Frame payloadå®šä¹‰ä¸ºä¸€ä¸ªPacketã€‚ä¸Šå›¾å³ä¾§å±•ç¤ºçš„å°±æ˜¯Packetçš„ç»“æ„ã€‚</p><p>Packetå°±æ˜¯ä¸šåŠ¡å±‚çœŸæ­£éœ€è¦çš„æ¶ˆæ¯ï¼Œæ¯ä¸ªPacketç”±Packetå¤´å’ŒPacket Bodyéƒ¨åˆ†ç»„æˆã€‚Packetå¤´å°±æ˜¯commandIDï¼Œç”¨äºæ ‡è¯†è¿™ä¸ªæ¶ˆæ¯çš„ç±»å‹ï¼›è€ŒIDå’Œpayloadï¼ˆpacket payloadï¼‰æˆ–resultå­—æ®µç»„æˆäº†Packetçš„Bodyéƒ¨åˆ†ï¼Œå¯¹ä¸šåŠ¡å±‚æœ‰ä»·å€¼çš„æ•°æ®éƒ½åŒ…å«åœ¨Packet Bodyéƒ¨åˆ†ã€‚</p><p>é‚£ä¹ˆåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±é€šè¿‡Frameå’ŒPacketä¸¤ä¸ªç±»å‹ç»“æ„ï¼Œå®Œæˆäº†ç¨‹åºä¸–ç•Œå¯¹æˆ‘ä»¬ç§æœ‰åè®®è§„èŒƒçš„æŠ½è±¡ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯åŸºäºFrameå’ŒPacketè¿™ä¸¤ä¸ªæ¦‚å¿µï¼Œå®ç°å¯¹æˆ‘ä»¬ç§æœ‰åè®®çš„è§£åŒ…ä¸æ‰“åŒ…æ“ä½œã€‚</p><h2>åè®®çš„è§£åŒ…ä¸æ‰“åŒ…</h2><p>æ‰€è°“åè®®çš„<strong>è§£åŒ…ï¼ˆdecodeï¼‰</strong>ï¼Œå°±æ˜¯æŒ‡è¯†åˆ«TCPè¿æ¥ä¸Šçš„å­—èŠ‚æµï¼Œå°†ä¸€ç»„å­—èŠ‚â€œè½¬æ¢â€æˆä¸€ä¸ªç‰¹å®šç±»å‹çš„åè®®æ¶ˆæ¯ç»“æ„ï¼Œç„¶åè¿™ä¸ªæ¶ˆæ¯ç»“æ„ä¼šè¢«ä¸šåŠ¡å¤„ç†é€»è¾‘ä½¿ç”¨ã€‚</p><p>è€Œ<strong>æ‰“åŒ…ï¼ˆencodeï¼‰</strong>åˆšåˆšå¥½ç›¸åï¼Œæ˜¯æŒ‡å°†ä¸€ä¸ªç‰¹å®šç±»å‹çš„æ¶ˆæ¯ç»“æ„è½¬æ¢ä¸ºä¸€ç»„å­—èŠ‚ï¼Œç„¶åè¿™ç»„å­—èŠ‚æ•°æ®ä¼šè¢«æ”¾åœ¨è¿æ¥ä¸Šå‘é€å‡ºå»ã€‚</p><p>å…·ä½“åˆ°æˆ‘ä»¬è¿™ä¸ªè‡ªå®šä¹‰åè®®ä¸Šï¼Œè§£åŒ…å°±æ˜¯æŒ‡<code>å­—èŠ‚æµ -&gt; Frame</code>ï¼Œæ‰“åŒ…æ˜¯æŒ‡ <code>Frame -&gt; å­—èŠ‚æµ</code>ã€‚ä½ å¯ä»¥çœ‹ä¸€ä¸‹é’ˆå¯¹è¿™ä¸ªåè®®çš„æœåŠ¡ç«¯è§£åŒ…ä¸æ‰“åŒ…çš„æµç¨‹å›¾ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/2b/2b/2be4e8b5b2f3c973199be6dc8f454c2b.jpg?wh=1980x1080\" alt=\"\"></p><p>æˆ‘ä»¬çœ‹åˆ°ï¼ŒTCPæµæ•°æ®å…ˆåç»è¿‡frame decodeå’Œpacket decodeï¼Œå¾—åˆ°åº”ç”¨å±‚æ‰€éœ€çš„packetæ•°æ®ï¼Œè€Œä¸šåŠ¡å±‚å›å¤çš„å“åº”ï¼Œåˆ™å…ˆåç»è¿‡packetçš„encodeä¸frameçš„encodeï¼Œå†™å…¥TCPæ•°æ®æµä¸­ã€‚</p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å®é™…ä¸Šå·²ç»å®Œæˆäº†åè®®æŠ½è±¡çš„è®¾è®¡ä¸è§£åŒ…æ‰“åŒ…åŸç†çš„è®¾è®¡è¿‡ç¨‹äº†ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ç§æœ‰åè®®éƒ¨åˆ†çš„ç›¸å…³ä»£ç å®ç°ã€‚</p><h3>Frameçš„å®ç°</h3><p>å‰é¢è¯´è¿‡ï¼Œåè®®éƒ¨åˆ†æœ€é‡è¦çš„ä¸¤ä¸ªæŠ½è±¡æ˜¯Frameå’ŒPacketï¼Œäºæ˜¯æˆ‘ä»¬å°±åœ¨é¡¹ç›®ä¸­å»ºç«‹frameåŒ…ä¸packetåŒ…ï¼Œåˆ†åˆ«ä¸ä¸¤ä¸ªåè®®æŠ½è±¡å¯¹åº”ã€‚frameåŒ…çš„èŒè´£æ˜¯æä¾›è¯†åˆ«TCPæµè¾¹ç•Œçš„ç¼–è§£ç å™¨ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“ä¸ºè¿™æ ·çš„ç¼–è§£ç å™¨ï¼Œå®šä¹‰å‡ºä¸€ä¸ªç»Ÿä¸€çš„æ¥å£ç±»å‹StreamFrameCodecï¼š</p><pre><code class=\"language-plain\">// tcp-server-demo1/frame/frame.go\n\ntype FramePayload []byte\n\ntype StreamFrameCodec interface {\n    Encode(io.Writer, FramePayload) error   // data -&gt; frameï¼Œå¹¶å†™å…¥io.Writer\n    Decode(io.Reader) (FramePayload, error) // ä»io.Readerä¸­æå–frame payloadï¼Œå¹¶è¿”å›ç»™ä¸Šå±‚\n}\n</code></pre><p>StreamFrameCodecæ¥å£ç±»å‹æœ‰ä¸¤ä¸ªæ–¹æ³•Encodeä¸Decodeã€‚Encodeæ–¹æ³•ç”¨äºå°†è¾“å…¥çš„Frame payloadç¼–ç ä¸ºä¸€ä¸ªFrameï¼Œç„¶åå†™å…¥io.Writeræ‰€ä»£è¡¨çš„è¾“å‡ºï¼ˆoutboundï¼‰TCPæµä¸­ã€‚è€ŒDecodeæ–¹æ³•æ­£å¥½ç›¸åï¼Œå®ƒä»ä»£è¡¨è¾“å…¥ï¼ˆinboundï¼‰TCPæµçš„io.Readerä¸­è¯»å–ä¸€ä¸ªå®Œæ•´Frameï¼Œå¹¶å°†å¾—åˆ°çš„Frame payloadè§£æå‡ºæ¥å¹¶è¿”å›ã€‚</p><p>è¿™é‡Œï¼Œæˆ‘ä»¬ç»™å‡ºä¸€ä¸ªé’ˆå¯¹æˆ‘ä»¬åè®®çš„StreamFrameCodecæ¥å£çš„å®ç°ï¼š</p><pre><code class=\"language-plain\">// tcp-server-demo1/frame/frame.go\n\nvar ErrShortWrite = errors.New(\"short write\")\nvar ErrShortRead = errors.New(\"short read\")\n\ntype myFrameCodec struct{}\n\nfunc NewMyFrameCodec() StreamFrameCodec {\n    return &amp;myFrameCodec{}\n}\n\nfunc (p *myFrameCodec) Encode(w io.Writer, framePayload FramePayload) error {\n    var f = framePayload\n    var totalLen int32 = int32(len(framePayload)) + 4\n\n    err := binary.Write(w, binary.BigEndian, &amp;totalLen)\n    if err != nil {\n        return err\n    }\n\n    n, err := w.Write([]byte(f)) // write the frame payload to outbound stream\n    if err != nil {\n        return err\n    }\n  \n    if n != len(framePayload) {\n        return ErrShortWrite\n    }\n\n    return nil\n}\n\nfunc (p *myFrameCodec) Decode(r io.Reader) (FramePayload, error) {\n    var totalLen int32\n    err := binary.Read(r, binary.BigEndian, &amp;totalLen)\n    if err != nil {\n        return nil, err\n    }\n\n    buf := make([]byte, totalLen-4)\n    n, err := io.ReadFull(r, buf)\n    if err != nil {\n        return nil, err\n    }\n  \n    if n != int(totalLen-4) {\n        return nil, ErrShortRead\n    }\n\n    return FramePayload(buf), nil\n}\n</code></pre><p>åœ¨åœ¨è¿™æ®µå®ç°ä¸­ï¼Œæœ‰ä¸‰ç‚¹äº‹é¡¹éœ€è¦æˆ‘ä»¬æ³¨æ„ï¼š</p><ul>\n<li>ç½‘ç»œå­—èŠ‚åºä½¿ç”¨å¤§ç«¯å­—èŠ‚åºï¼ˆBigEndianï¼‰ï¼Œå› æ­¤æ— è®ºæ˜¯Encodeè¿˜æ˜¯Decodeï¼Œæˆ‘ä»¬éƒ½æ˜¯ç”¨binary.BigEndianï¼›</li>\n<li>binary.Readæˆ–Writeä¼šæ ¹æ®å‚æ•°çš„å®½åº¦ï¼Œè¯»å–æˆ–å†™å…¥å¯¹åº”çš„å­—èŠ‚ä¸ªæ•°çš„å­—èŠ‚ï¼Œè¿™é‡ŒtotalLenä½¿ç”¨int32ï¼Œé‚£ä¹ˆReadæˆ–Writeåªä¼šæ“ä½œæ•°æ®æµä¸­çš„4ä¸ªå­—èŠ‚ï¼›</li>\n<li>è¿™é‡Œæ²¡æœ‰è®¾ç½®ç½‘ç»œI/Oæ“ä½œçš„Deadlineï¼Œio.ReadFullä¸€èˆ¬ä¼šè¯»æ»¡ä½ æ‰€éœ€çš„å­—èŠ‚æ•°ï¼Œé™¤éé‡åˆ°EOFæˆ–ErrUnexpectedEOFã€‚</li>\n</ul><p>åœ¨å·¥ç¨‹å®è·µä¸­ï¼Œä¿è¯æ‰“åŒ…ä¸è§£åŒ…æ­£ç¡®çš„æœ€æœ‰æ•ˆæ–¹å¼å°±æ˜¯<strong>ç¼–å†™å•å…ƒæµ‹è¯•</strong>ï¼ŒStreamFrameCodecæ¥å£çš„Decodeå’ŒEncodeæ–¹æ³•çš„å‚æ•°éƒ½æ˜¯æ¥å£ç±»å‹ï¼Œè¿™è®©æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“ä¸ºStreamFrameCodecæ¥å£çš„å®ç°ç¼–å†™æµ‹è¯•ç”¨ä¾‹ã€‚ä¸‹é¢æ˜¯æˆ‘ä¸ºmyFrameCodecç¼–å†™äº†ä¸¤ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼š</p><pre><code class=\"language-plain\">// tcp-server-demo1/frame/frame_test.go\n\nfunc TestEncode(t *testing.T) {\n    codec := NewMyFrameCodec()\n    buf := make([]byte, 0, 128)\n    rw := bytes.NewBuffer(buf)\n\n    err := codec.Encode(rw, []byte(\"hello\"))\n    if err != nil {\n        t.Errorf(\"want nil, actual %s\", err.Error())\n    }\n\n    // éªŒè¯Encodeçš„æ­£ç¡®æ€§\n    var totalLen int32\n    err = binary.Read(rw, binary.BigEndian, &amp;totalLen)\n    if err != nil {\n        t.Errorf(\"want nil, actual %s\", err.Error())\n    }\n\n    if totalLen != 9 {\n        t.Errorf(\"want 9, actual %d\", totalLen)\n    }\n\n    left := rw.Bytes()\n    if string(left) != \"hello\" {\n        t.Errorf(\"want hello, actual %s\", string(left))\n    }\n}\n\nfunc TestDecode(t *testing.T) {\n    codec := NewMyFrameCodec()\n    data := []byte{0x0, 0x0, 0x0, 0x9, 'h', 'e', 'l', 'l', 'o'}\n\n    payload, err := codec.Decode(bytes.NewReader(data))\n    if err != nil {\n        t.Errorf(\"want nil, actual %s\", err.Error())\n    }\n\n    if string(payload) != \"hello\" {\n        t.Errorf(\"want hello, actual %s\", string(payload))\n    }\n}\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œæµ‹è¯•Encodeæ–¹æ³•ï¼Œæˆ‘ä»¬å…¶å®ä¸éœ€è¦å»ºç«‹çœŸå®çš„ç½‘ç»œè¿æ¥ï¼Œåªè¦ç”¨ä¸€ä¸ªæ»¡è¶³io.Writerçš„bytes.Bufferå®ä¾‹â€œå†’å……â€çœŸå®ç½‘ç»œè¿æ¥å°±å¯ä»¥äº†ï¼ŒåŒæ—¶bytes.Bufferç±»å‹ä¹Ÿå®ç°äº†io.Readeræ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä»ä¸­è¯»å–å‡ºEncodeåçš„å†…å®¹ï¼Œå¹¶è¿›è¡Œæ ¡éªŒæ¯”å¯¹ã€‚</p><p>ä¸ºäº†æå‡æµ‹è¯•è¦†ç›–ç‡ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°½å¯èƒ½è®©æµ‹è¯•è¦†ç›–åˆ°æ‰€æœ‰å¯æµ‹çš„é”™è¯¯æ‰§è¡Œåˆ†æ”¯ä¸Šã€‚è¿™é‡Œï¼Œæˆ‘æ¨¡æ‹Ÿäº†Readæˆ–Writeå‡ºé”™çš„æƒ…å†µï¼Œè®©æ‰§è¡Œæµè¿›å…¥åˆ°Decodeæˆ–Encodeæ–¹æ³•çš„é”™è¯¯åˆ†æ”¯ä¸­ï¼š</p><pre><code class=\"language-plain\">type ReturnErrorWriter struct {\n    W  io.Writer\n    Wn int // ç¬¬å‡ æ¬¡è°ƒç”¨Writeè¿”å›é”™è¯¯\n    wc int // å†™æ“ä½œæ¬¡æ•°è®¡æ•°\n}\n\nfunc (w *ReturnErrorWriter) Write(p []byte) (n int, err error) {\n    w.wc++\n    if w.wc &gt;= w.Wn {\n        return 0, errors.New(\"write error\")\n    }\n    return w.W.Write(p)\n}\n\ntype ReturnErrorReader struct {\n    R  io.Reader\n    Rn int // ç¬¬å‡ æ¬¡è°ƒç”¨Readè¿”å›é”™è¯¯\n    rc int // è¯»æ“ä½œæ¬¡æ•°è®¡æ•°\n}\n\nfunc (r *ReturnErrorReader) Read(p []byte) (n int, err error) {\n    r.rc++\n    if r.rc &gt;= r.Rn {\n        return 0, errors.New(\"read error\")\n    }\n    return r.R.Read(p)\n}\n\nfunc TestEncodeWithWriteFail(t *testing.T) {\n    codec := NewMyFrameCodec()\n    buf := make([]byte, 0, 128)\n    w := bytes.NewBuffer(buf)\n\n    // æ¨¡æ‹Ÿbinary.Writeè¿”å›é”™è¯¯\n    err := codec.Encode(&amp;ReturnErrorWriter{\n        W:  w,\n        Wn: 1,\n    }, []byte(\"hello\"))\n    if err == nil {\n        t.Errorf(\"want non-nil, actual nil\")\n    }\n\n    // æ¨¡æ‹Ÿw.Writeè¿”å›é”™è¯¯\n    err = codec.Encode(&amp;ReturnErrorWriter{\n        W:  w,\n        Wn: 2,\n    }, []byte(\"hello\"))\n    if err == nil {\n        t.Errorf(\"want non-nil, actual nil\")\n    }\n}\n\nfunc TestDecodeWithReadFail(t *testing.T) {\n    codec := NewMyFrameCodec()\n    data := []byte{0x0, 0x0, 0x0, 0x9, 'h', 'e', 'l', 'l', 'o'}\n\n    // æ¨¡æ‹Ÿbinary.Readè¿”å›é”™è¯¯\n    _, err := codec.Decode(&amp;ReturnErrorReader{\n        R:  bytes.NewReader(data),\n        Rn: 1,\n    })\n    if err == nil {\n        t.Errorf(\"want non-nil, actual nil\")\n    }\n\n    // æ¨¡æ‹Ÿio.ReadFullè¿”å›é”™è¯¯\n    _, err = codec.Decode(&amp;ReturnErrorReader{\n        R:  bytes.NewReader(data),\n        Rn: 2,\n    })\n    if err == nil {\n        t.Errorf(\"want non-nil, actual nil\")\n    }\n}\n</code></pre><p>ä¸ºäº†å®ç°é”™è¯¯åˆ†æ”¯çš„æµ‹è¯•ï¼Œæˆ‘ä»¬åœ¨æµ‹è¯•ä»£ç æºæ–‡ä»¶ä¸­åˆ›å»ºäº†ä¸¤ä¸ªç±»å‹ï¼šReturnErrorWriterå’ŒReturnErrorReaderï¼Œå®ƒä»¬åˆ†åˆ«å®ç°äº†io.Writerä¸io.Readerã€‚</p><p>æˆ‘ä»¬å¯ä»¥æ§åˆ¶åœ¨ç¬¬å‡ æ¬¡è°ƒç”¨è¿™ä¸¤ä¸ªç±»å‹çš„Writeæˆ–Readæ–¹æ³•æ—¶ï¼Œè¿”å›é”™è¯¯ï¼Œè¿™æ ·å°±å¯ä»¥è®©Encodeæˆ–Decodeæ–¹æ³•æŒ‰ç…§æˆ‘ä»¬çš„æ„å›¾ï¼Œè¿›å…¥åˆ°ä¸åŒé”™è¯¯åˆ†æ”¯ä¸­å»ã€‚æœ‰äº†è¿™ä¸¤ä¸ªç”¨ä¾‹ï¼Œæˆ‘ä»¬çš„frameåŒ…çš„æµ‹è¯•è¦†ç›–ç‡ï¼ˆé€šè¿‡go test -cover .å¯ä»¥æŸ¥çœ‹ï¼‰å°±å¯ä»¥è¾¾åˆ°90%ä»¥ä¸Šäº†ã€‚</p><h3>Packetçš„å®ç°</h3><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹çœ‹Packetè¿™ä¸ªæŠ½è±¡çš„å®ç°ã€‚å’ŒFrameä¸åŒï¼ŒPacketæœ‰å¤šç§ç±»å‹ï¼ˆè¿™é‡Œåªå®šä¹‰äº†Connã€submitã€connackã€submit ack)ã€‚æ‰€ä»¥æˆ‘ä»¬è¦å…ˆæŠ½è±¡ä¸€ä¸‹è¿™äº›ç±»å‹éœ€è¦éµå¾ªçš„å…±åŒæ¥å£ï¼š</p><pre><code class=\"language-plain\">// tcp-server-demo1/packet/packet.go\n\ntype Packet interface {\n    Decode([]byte) error     // []byte -&gt; struct\n    Encode() ([]byte, error) //  struct -&gt; []byte\n}\n</code></pre><p>å…¶ä¸­ï¼ŒDecodeæ˜¯å°†ä¸€æ®µå­—èŠ‚æµæ•°æ®è§£ç ä¸ºä¸€ä¸ªPacketç±»å‹ï¼Œå¯èƒ½æ˜¯connï¼Œå¯èƒ½æ˜¯submitç­‰ï¼Œå…·ä½“æˆ‘ä»¬è¦æ ¹æ®è§£ç å‡ºæ¥çš„commandIDåˆ¤æ–­ã€‚è€ŒEncodeåˆ™æ˜¯å°†ä¸€ä¸ªPacketç±»å‹ç¼–ç ä¸ºä¸€æ®µå­—èŠ‚æµæ•°æ®ã€‚</p><p>è€ƒè™‘åˆ°ç¯‡å¹…ä¸å¤æ‚æ€§ï¼Œæˆ‘ä»¬è¿™é‡Œåªå®Œæˆsubmitå’Œsubmitackç±»å‹çš„Packetæ¥å£å®ç°ï¼Œçœç•¥äº†connæµç¨‹ï¼Œä¹Ÿçœç•¥connä»¥åŠconnackç±»å‹çš„å®ç°ï¼Œä½ å¯ä»¥è¯¾åè‡ªå·±æ€è€ƒä¸€ä¸‹æœ‰connæµç¨‹æ—¶ä»£ç åº”è¯¥å¦‚ä½•è°ƒæ•´ã€‚</p><pre><code class=\"language-plain\">// tcp-server-demo1/packet/packet.go\n\ntype Submit struct {\n    ID      string\n    Payload []byte\n}\n\nfunc (s *Submit) Decode(pktBody []byte) error {\n    s.ID = string(pktBody[:8])\n    s.Payload = pktBody[8:]\n    return nil\n}\n\nfunc (s *Submit) Encode() ([]byte, error) {\n    return bytes.Join([][]byte{[]byte(s.ID[:8]), s.Payload}, nil), nil\n}\n\ntype SubmitAck struct {\n    ID     string\n    Result uint8\n}\n\nfunc (s *SubmitAck) Decode(pktBody []byte) error {\n    s.ID = string(pktBody[0:8])\n    s.Result = uint8(pktBody[8])\n    return nil\n}\n\nfunc (s *SubmitAck) Encode() ([]byte, error) {\n    return bytes.Join([][]byte{[]byte(s.ID[:8]), []byte{s.Result}}, nil), nil\n}\n</code></pre><p>è¿™é‡Œå„ç§ç±»å‹çš„ç¼–è§£ç è¢«è°ƒç”¨çš„å‰æï¼Œæ˜¯æ˜ç¡®æ•°æ®æµæ˜¯ä»€ä¹ˆç±»å‹çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨åŒ…çº§æä¾›ä¸€ä¸ªå¯¼å‡ºçš„å‡½æ•°Decodeï¼Œè¿™ä¸ªå‡½æ•°è´Ÿè´£ä»å­—èŠ‚æµä¸­è§£æå‡ºå¯¹åº”çš„ç±»å‹ï¼ˆæ ¹æ®commandIDï¼‰ï¼Œå¹¶è°ƒç”¨å¯¹åº”ç±»å‹çš„Decodeæ–¹æ³•ï¼š</p><pre><code class=\"language-plain\">// tcp-server-demo1/packet/packet.go\n\nfunc Decode(packet []byte) (Packet, error) {\n\tcommandID := packet[0]\n\tpktBody := packet[1:]\n\n\tswitch commandID {\n\tcase CommandConn:\n\t\treturn nil, nil\n\tcase CommandConnAck:\n\t\treturn nil, nil\n\tcase CommandSubmit:\n\t\ts := Submit{}\n\t\terr := s.Decode(pktBody)\n\t\tif err != nil {\n\t\t\treturn nil, err\n\t\t}\n\t\treturn &amp;s, nil\n\tcase CommandSubmitAck:\n\t\ts := SubmitAck{}\n\t\terr := s.Decode(pktBody)\n\t\tif err != nil {\n\t\t\treturn nil, err\n\t\t}\n\t\treturn &amp;s, nil\n\tdefault:\n\t\treturn nil, fmt.Errorf(\"unknown commandID [%d]\", commandID)\n\t}\n}\n</code></pre><p>åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦åŒ…çº§çš„Encodeå‡½æ•°ï¼Œæ ¹æ®ä¼ å…¥çš„packetç±»å‹è°ƒç”¨å¯¹åº”çš„Encodeæ–¹æ³•å®ç°å¯¹è±¡çš„ç¼–ç ï¼š</p><pre><code class=\"language-plain\">// tcp-server-demo1/packet/packet.go\n\nfunc Encode(p Packet) ([]byte, error) {\n\tvar commandID uint8\n\tvar pktBody []byte\n\tvar err error\n\n\tswitch t := p.(type) {\n\tcase *Submit:\n\t\tcommandID = CommandSubmit\n\t\tpktBody, err = p.Encode()\n\t\tif err != nil {\n\t\t\treturn nil, err\n\t\t}\n\tcase *SubmitAck:\n\t\tcommandID = CommandSubmitAck\n\t\tpktBody, err = p.Encode()\n\t\tif err != nil {\n\t\t\treturn nil, err\n\t\t}\n\tdefault:\n\t\treturn nil, fmt.Errorf(\"unknown type [%s]\", t)\n\t}\n\treturn bytes.Join([][]byte{[]byte{commandID}, pktBody}, nil), nil\n}\n</code></pre><p>ä¸è¿‡ï¼Œå¯¹packetåŒ…ä¸­å„ä¸ªç±»å‹çš„Encodeå’ŒDecodeæ–¹æ³•çš„æµ‹è¯•ï¼Œä¸frameåŒ…çš„ç›¸ä¼¼ï¼Œè¿™é‡Œæˆ‘å°±æŠŠä¸ºpacketåŒ…ç¼–å†™å•å…ƒæµ‹è¯•çš„ä»»åŠ¡å°±äº¤ç»™ä½ è‡ªå·±å®Œæˆäº†ï¼Œå¦‚æœæœ‰ä»€ä¹ˆé—®é¢˜æ¬¢è¿åœ¨ç•™è¨€åŒºç•™è¨€ã€‚</p><p>å¥½äº†ï¼Œä¸‡äº‹ä¿±å¤‡ï¼Œåªæ¬ ä¸œé£ï¼ä¸‹é¢æˆ‘ä»¬å°±æ¥ç¼–å†™æœåŠ¡ç«¯çš„ç¨‹åºç»“æ„ï¼Œå°†tcp connä¸Frameã€Packetè¿æ¥èµ·æ¥ã€‚</p><h2>æœåŠ¡ç«¯çš„ç»„è£…</h2><p>åœ¨ä¸Šä¸€è®²ä¸­ï¼Œæˆ‘ä»¬æŒ‰ç…§æ¯ä¸ªè¿æ¥ä¸€ä¸ªGoroutineçš„æ¨¡å‹ï¼Œç»™å‡ºäº†å…¸å‹Goç½‘ç»œæœåŠ¡ç«¯ç¨‹åºçš„ç»“æ„ï¼Œè¿™é‡Œæˆ‘ä»¬å°±ä»¥è¿™ä¸ªç»“æ„ä¸ºåŸºç¡€ï¼Œå°†Frameã€PacketåŠ è¿›æ¥ï¼Œå½¢æˆæˆ‘ä»¬çš„ç¬¬ä¸€ç‰ˆæœåŠ¡ç«¯å®ç°ï¼š</p><pre><code class=\"language-plain\">// tcp-server-demo1/cmd/server/main.go\n\npackage main\n\nimport (\n\t\"fmt\"\n\t\"net\"\n\n\t\"github.com/bigwhite/tcp-server-demo1/frame\"\n\t\"github.com/bigwhite/tcp-server-demo1/packet\"\n)\n\nfunc handlePacket(framePayload []byte) (ackFramePayload []byte, err error) {\n\tvar p packet.Packet\n\tp, err = packet.Decode(framePayload)\n\tif err != nil {\n\t\tfmt.Println(\"handleConn: packet decode error:\", err)\n\t\treturn\n\t}\n\n\tswitch p.(type) {\n\tcase *packet.Submit:\n\t\tsubmit := p.(*packet.Submit)\n\t\tfmt.Printf(\"recv submit: id = %s, payload=%s\\n\", submit.ID, string(submit.Payload))\n\t\tsubmitAck := &amp;packet.SubmitAck{\n\t\t\tID:     submit.ID,\n\t\t\tResult: 0,\n\t\t}\n\t\tackFramePayload, err = packet.Encode(submitAck)\n\t\tif err != nil {\n\t\t\tfmt.Println(\"handleConn: packet encode error:\", err)\n\t\t\treturn nil, err\n\t\t}\n\t\treturn ackFramePayload, nil\n\tdefault:\n\t\treturn nil, fmt.Errorf(\"unknown packet type\")\n\t}\n}\n\nfunc handleConn(c net.Conn) {\n\tdefer c.Close()\n\tframeCodec := frame.NewMyFrameCodec()\n\n\tfor {\n\t\t// decode the frame to get the payload\n\t\tframePayload, err := frameCodec.Decode(c)\n\t\tif err != nil {\n\t\t\tfmt.Println(\"handleConn: frame decode error:\", err)\n\t\t\treturn\n\t\t}\n\n\t\t// do something with the packet\n\t\tackFramePayload, err := handlePacket(framePayload)\n\t\tif err != nil {\n\t\t\tfmt.Println(\"handleConn: handle packet error:\", err)\n\t\t\treturn\n\t\t}\n\n\t\t// write ack frame to the connection\n\t\terr = frameCodec.Encode(c, ackFramePayload)\n\t\tif err != nil {\n\t\t\tfmt.Println(\"handleConn: frame encode error:\", err)\n\t\t\treturn\n\t\t}\n\t}\n}\n\nfunc main() {\n\tl, err := net.Listen(\"tcp\", \":8888\")\n\tif err != nil {\n\t\tfmt.Println(\"listen error:\", err)\n\t\treturn\n\t}\n\n\tfor {\n\t\tc, err := l.Accept()\n\t\tif err != nil {\n\t\t\tfmt.Println(\"accept error:\", err)\n\t\t\tbreak\n\t\t}\n\t\t// start a new goroutine to handle the new connection.\n\t\tgo handleConn(c)\n\t}\n}\n</code></pre><p>è¿™ä¸ªç¨‹åºçš„é€»è¾‘éå¸¸æ¸…æ™°ï¼ŒæœåŠ¡ç«¯ç¨‹åºç›‘å¬8888ç«¯å£ï¼Œå¹¶åœ¨æ¯æ¬¡è°ƒç”¨Acceptæ–¹æ³•åå¾—åˆ°ä¸€ä¸ªæ–°è¿æ¥ï¼ŒæœåŠ¡ç«¯ç¨‹åºå°†è¿™ä¸ªæ–°è¿æ¥äº¤åˆ°ä¸€ä¸ªæ–°çš„Goroutineä¸­å¤„ç†ã€‚</p><p>æ–°Goroutineçš„ä¸»å‡½æ•°ä¸ºhandleConnï¼Œæœ‰äº†Packetå’ŒFrameè¿™ä¸¤ä¸ªæŠ½è±¡çš„åŠ æŒï¼Œè¿™ä¸ªå‡½æ•°åŒæ ·æ‹¥æœ‰æ¸…æ™°çš„ä»£ç è°ƒç”¨ç»“æ„ï¼š</p><pre><code class=\"language-plain\">// handleConnçš„è°ƒç”¨ç»“æ„\n\nread frame from conn\n    -&gt;frame decode\n\t    -&gt; handle packet\n\t\t    -&gt; packet decode\n\t\t    -&gt; packet(ack) encode\n    -&gt;frame(ack) encode\nwrite ack frame to conn\n</code></pre><p>åˆ°è¿™é‡Œï¼Œä¸€ä¸ªåŸºäºTCPçš„è‡ªå®šä¹‰åº”ç”¨å±‚åè®®çš„ç»å…¸é˜»å¡å¼çš„æœåŠ¡ç«¯å°±å®Œæˆäº†ã€‚ä¸è¿‡è¿™é‡Œçš„æœåŠ¡ç«¯ä¾æ—§æ˜¯ä¸€ä¸ªç®€åŒ–çš„å®ç°ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œæ²¡æœ‰è€ƒè™‘æ”¯æŒä¼˜é›…é€€å‡ºã€æ²¡æœ‰æ•æ‰æŸä¸ªé“¾æ¥ä¸Šå‡ºç°çš„å¯èƒ½å¯¼è‡´æ•´ä¸ªç¨‹åºé€€å‡ºçš„panicç­‰ï¼Œè¿™äº›æˆ‘ä¹Ÿæƒ³ä½œä¸ºä½œä¸šç•™ç»™ä½ ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥éªŒè¯ä¸€ä¸‹è¿™ä¸ªæœåŠ¡ç«¯å®ç°æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œã€‚</p><h2>éªŒè¯æµ‹è¯•</h2><p>è¦éªŒè¯æœåŠ¡ç«¯çš„å®ç°æ˜¯å¦å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦å®ç°ä¸€ä¸ªè‡ªå®šä¹‰åº”ç”¨å±‚åè®®çš„å®¢æˆ·ç«¯ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬åŒæ ·åŸºäºframeã€packetä¸¤ä¸ªåŒ…ï¼Œå®ç°äº†ä¸€ä¸ªè‡ªå®šä¹‰åº”ç”¨å±‚åè®®çš„å®¢æˆ·ç«¯ã€‚ä¸‹é¢æ˜¯å®¢æˆ·ç«¯çš„mainå‡½æ•°ï¼š</p><pre><code class=\"language-plain\">// tcp-server-demo1/cmd/client/main.go\nfunc main() {\n    var wg sync.WaitGroup\n    var num int = 5\n\n    wg.Add(5)\n\n    for i := 0; i &lt; num; i++ {\n        go func(i int) {\n            defer wg.Done()\n            startClient(i)\n        }(i + 1)\n    }\n    wg.Wait()\n}\n</code></pre><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œå®¢æˆ·ç«¯å¯åŠ¨äº†5ä¸ªGoroutineï¼Œæ¨¡æ‹Ÿ5ä¸ªå¹¶å‘è¿æ¥ã€‚startClientå‡½æ•°æ˜¯æ¯ä¸ªè¿æ¥çš„ä¸»å¤„ç†å‡½æ•°ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ï¼š</p><pre><code class=\"language-plain\">func startClient(i int) {\n    quit := make(chan struct{})\n    done := make(chan struct{})\n    conn, err := net.Dial(\"tcp\", \":8888\")\n    if err != nil {\n        fmt.Println(\"dial error:\", err)\n        return\n    }\n    defer conn.Close()\n    fmt.Printf(\"[client %d]: dial ok\", i)\n\n    // ç”Ÿæˆpayload\n    rng, err := codename.DefaultRNG()\n    if err != nil {\n        panic(err)\n    }\n\n    frameCodec := frame.NewMyFrameCodec()\n    var counter int\n\n    go func() {\n        // handle ack\n        for {\n            select {\n            case &lt;-quit:\n                done &lt;- struct{}{}\n                return\n            default:\n            }\n\n            conn.SetReadDeadline(time.Now().Add(time.Second * 5))\n            ackFramePayLoad, err := frameCodec.Decode(conn)\n            if err != nil {\n                if e, ok := err.(net.Error); ok {\n                    if e.Timeout() {\n                        continue\n                    }\n                }\n                panic(err)\n            }\n\n            p, err := packet.Decode(ackFramePayLoad)\n            submitAck, ok := p.(*packet.SubmitAck)\n            if !ok {\n                panic(\"not submitack\")\n            }\n            fmt.Printf(\"[client %d]: the result of submit ack[%s] is %d\\n\", i, submitAck.ID, submitAck.Result)\n        }\n    }()\n\n    for {\n        // send submit\n        counter++\n        id := fmt.Sprintf(\"%08d\", counter) // 8 byte string\n        payload := codename.Generate(rng, 4)\n        s := &amp;packet.Submit{\n            ID:      id,\n            Payload: []byte(payload),\n        }\n\n        framePayload, err := packet.Encode(s)\n        if err != nil {\n            panic(err)\n        }\n\n        fmt.Printf(\"[client %d]: send submit id = %s, payload=%s, frame length = %d\\n\",\n            i, s.ID, s.Payload, len(framePayload)+4)\n\n        err = frameCodec.Encode(conn, framePayload)\n        if err != nil {\n            panic(err)\n        }\n\n        time.Sleep(1 * time.Second)\n        if counter &gt;= 10 {\n            quit &lt;- struct{}{}\n            &lt;-done\n            fmt.Printf(\"[client %d]: exit ok\", i)\n            return\n        }\n    }\n}\n</code></pre><p>å…³äºstartClientå‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦ç®€å•è¯´æ˜å‡ ç‚¹ã€‚</p><p>é¦–å…ˆï¼ŒstartClientå‡½æ•°å¯åŠ¨äº†ä¸¤ä¸ªGoroutineï¼Œä¸€ä¸ªè´Ÿè´£å‘æœåŠ¡ç«¯å‘é€submitæ¶ˆæ¯è¯·æ±‚ï¼Œå¦å¤–ä¸€ä¸ªGoroutineåˆ™è´Ÿè´£è¯»å–æœåŠ¡ç«¯è¿”å›çš„å“åº”ï¼›</p><p>å…¶æ¬¡ï¼Œå®¢æˆ·ç«¯å‘é€çš„submitè¯·æ±‚çš„è´Ÿè½½ï¼ˆpayloadï¼‰æ˜¯ç”±ç¬¬ä¸‰æ–¹åŒ…github.com/lucasepe/codenameè´Ÿè´£ç”Ÿæˆçš„ï¼Œè¿™ä¸ªåŒ…ä¼šç”Ÿæˆä¸€äº›å¯¹äººç±»å¯è¯»çš„éšæœºå­—ç¬¦ä¸²ï¼Œæ¯”å¦‚ï¼šfirm-ironã€ moving-colleenã€game-novaè¿™æ ·çš„å­—ç¬¦ä¸²ï¼›</p><p>å¦å¤–ï¼Œè´Ÿè´£è¯»å–æœåŠ¡ç«¯è¿”å›å“åº”çš„Goroutineï¼Œä½¿ç”¨SetReadDeadlineæ–¹æ³•è®¾ç½®äº†è¯»è¶…æ—¶ï¼Œè¿™ä¸»è¦æ˜¯è€ƒè™‘è¯¥Goroutineå¯ä»¥åœ¨æ”¶åˆ°é€€å‡ºé€šçŸ¥æ—¶ï¼Œèƒ½åŠæ—¶ä»Readé˜»å¡ä¸­è·³å‡ºæ¥ã€‚</p><p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å°±æ¥æ„å»ºå’Œè¿è¡Œä¸€ä¸‹è¿™ä¸¤ä¸ªç¨‹åºã€‚</p><p>æˆ‘åœ¨tcp-server-demo1ç›®å½•ä¸‹æä¾›äº†Makefileï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯Linuxæˆ–macOSæ“ä½œç³»ç»Ÿï¼Œå¯ä»¥ç›´æ¥æ•²å…¥makeæ„å»ºä¸¤ä¸ªç¨‹åºï¼Œå¦‚æœä½ æ˜¯åœ¨Windowsä¸‹æ„å»ºï¼Œå¯ä»¥ç›´æ¥æ•²å…¥ä¸‹é¢çš„go buildå‘½ä»¤æ„å»ºï¼š</p><pre><code class=\"language-plain\">$make\ngo build github.com/bigwhite/tcp-server-demo1/cmd/server\ngo build github.com/bigwhite/tcp-server-demo1/cmd/client\n</code></pre><p>æ„å»ºæˆåŠŸåï¼Œæˆ‘ä»¬å…ˆæ¥å¯åŠ¨serverç¨‹åºï¼š</p><pre><code class=\"language-plain\">$./server\nserver start ok(on *.8888)\n</code></pre><p>ç„¶åï¼Œæˆ‘ä»¬å¯åŠ¨clientç¨‹åºï¼Œå¯åŠ¨åclientç¨‹åºä¾¿ä¼šå‘æœåŠ¡ç«¯å»ºç«‹5æ¡è¿æ¥ï¼Œå¹¶å‘é€submitè¯·æ±‚ï¼Œclientç«¯çš„éƒ¨åˆ†æ—¥å¿—å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">$./client\n[client 5]: dial ok\n[client 1]: dial ok\n[client 5]: send submit id = 00000001, payload=credible-deathstrike-33e1, frame length = 38\n[client 3]: dial ok\n[client 1]: send submit id = 00000001, payload=helped-lester-8f15, frame length = 31\n[client 4]: dial ok\n[client 4]: send submit id = 00000001, payload=strong-timeslip-07fa, frame length = 33\n[client 3]: send submit id = 00000001, payload=wondrous-expediter-136e, frame length = 36\n[client 5]: the result of submit ack[00000001] is 0\n[client 1]: the result of submit ack[00000001] is 0\n[client 3]: the result of submit ack[00000001] is 0\n[client 2]: dial ok\n... ...\n[client 3]: send submit id = 00000010, payload=bright-monster-badoon-5719, frame length = 39\n[client 4]: send submit id = 00000010, payload=crucial-wallop-ec2d, frame length = 32\n[client 2]: send submit id = 00000010, payload=pro-caliban-c803, frame length = 29\n[client 1]: send submit id = 00000010, payload=legible-shredder-3d81, frame length = 34\n[client 5]: send submit id = 00000010, payload=settled-iron-monger-bf78, frame length = 37\n[client 3]: the result of submit ack[00000010] is 0\n[client 4]: the result of submit ack[00000010] is 0\n[client 1]: the result of submit ack[00000010] is 0\n[client 2]: the result of submit ack[00000010] is 0\n[client 5]: the result of submit ack[00000010] is 0\n[client 4]: exit ok\n[client 1]: exit ok\n[client 3]: exit ok\n[client 5]: exit ok\n[client 2]: exit ok\n</code></pre><p>clientåœ¨æ¯æ¡è¿æ¥ä¸Šå‘é€10ä¸ªsubmitè¯·æ±‚åé€€å‡ºã€‚è¿™æœŸé—´æœåŠ¡ç«¯ä¼šè¾“å‡ºå¦‚ä¸‹æ—¥å¿—ï¼š</p><pre><code class=\"language-plain\">recv submit: id = 00000001, payload=credible-deathstrike-33e1\nrecv submit: id = 00000001, payload=helped-lester-8f15\nrecv submit: id = 00000001, payload=wondrous-expediter-136e\nrecv submit: id = 00000001, payload=strong-timeslip-07fa\nrecv submit: id = 00000001, payload=delicate-leatherneck-4b12\nrecv submit: id = 00000002, payload=certain-deadpool-779d\nrecv submit: id = 00000002, payload=clever-vapor-25ce\nrecv submit: id = 00000002, payload=causal-guardian-4f84\nrecv submit: id = 00000002, payload=noted-tombstone-1b3e\n... ...\nrecv submit: id = 00000010, payload=settled-iron-monger-bf78\nrecv submit: id = 00000010, payload=pro-caliban-c803\nrecv submit: id = 00000010, payload=legible-shredder-3d81\nhandleConn: frame decode error: EOF\nhandleConn: frame decode error: EOF\nhandleConn: frame decode error: EOF\nhandleConn: frame decode error: EOF\nhandleConn: frame decode error: EOF\n</code></pre><p>ä»ç»“æœæ¥çœ‹ï¼Œæˆ‘ä»¬å®ç°çš„è¿™ä¸€ç‰ˆæœåŠ¡ç«¯è¿è¡Œæ­£å¸¸ï¼</p><h2>å°ç»“</h2><p>å¥½äº†ï¼Œä»Šå¤©çš„è¯¾è®²åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œç°åœ¨æˆ‘ä»¬ä¸€èµ·æ¥å›é¡¾ä¸€ä¸‹å§ã€‚</p><p>åœ¨ä¸Šä¸€è®²å®Œæˆå¯¹socketç¼–ç¨‹æ¨¡å‹ã€ç½‘ç»œI/Oæ“ä½œçš„æŠ€æœ¯é¢„ç ”åï¼Œè¿™ä¸€è®²æˆ‘ä»¬æ­£å¼è¿›å…¥åŸºäºTCPçš„è‡ªå®šä¹‰åº”ç”¨å±‚åè®®çš„é€šä¿¡æœåŠ¡ç«¯çš„è®¾è®¡ä¸å®ç°ç¯èŠ‚ã€‚</p><p>åœ¨è¿™ä¸€ç¯èŠ‚ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå»ºç«‹äº†å¯¹åè®®çš„æŠ½è±¡ï¼Œè¿™æ˜¯å®ç°é€šä¿¡æœåŠ¡ç«¯çš„åŸºçŸ³ã€‚æˆ‘ä»¬ä½¿ç”¨Frameçš„æ¦‚å¿µæ¥è¡¨ç¤ºTCPå­—èŠ‚æµä¸­çš„æ¯ä¸€ä¸ªåè®®æ¶ˆæ¯ï¼Œè¿™ä½¿å¾—åœ¨ä¸šåŠ¡å±‚çš„è§†è§’ä¸‹ï¼Œè¿æ¥ä¸Šçš„å­—èŠ‚æµå°±æ˜¯ç”±ä¸€ä¸ªæ¥ç€ä¸€ä¸ªFrameç»„æˆçš„ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆå»ºç«‹äº†ç¬¬äºŒä¸ªæŠ½è±¡Packetï¼Œæ¥è¡¨ç¤ºä¸šåŠ¡å±‚çœŸæ­£éœ€è¦çš„æ¶ˆæ¯ã€‚</p><p>åœ¨è¿™ä¸¤ä¸ªæŠ½è±¡çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å®ç°äº†frameä¸packetå„è‡ªçš„æ‰“åŒ…ä¸è§£åŒ…ï¼Œæ•´ä¸ªå®ç°æ˜¯ä½è€¦åˆçš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¯¹frameç¼–å†™æµ‹è¯•ç”¨ä¾‹æ—¶ä½“ä¼šåˆ°è¿™ä¸€ç‚¹ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬æŠŠä¸Šä¸€è®²æåˆ°çš„ã€ä¸€ä¸ªGoroutineè´Ÿè´£å¤„ç†ä¸€ä¸ªè¿æ¥çš„å…¸å‹Goç½‘ç»œæœåŠ¡ç«¯ç¨‹åºç»“æ„ä¸frameã€packetçš„å®ç°ç»„è£…åˆ°ä¸€èµ·ï¼Œå°±å®ç°äº†æˆ‘ä»¬çš„ç¬¬ä¸€ç‰ˆæœåŠ¡ç«¯ã€‚ä¹‹åï¼Œæˆ‘ä»¬è¿˜ç¼–å†™äº†å®¢æˆ·ç«¯æ¨¡æ‹Ÿå™¨å¯¹è¿™ä¸ªæœåŠ¡ç«¯çš„å®ç°åšäº†éªŒè¯ã€‚</p><p>è¿™ä¸ªæœåŠ¡ç«¯é‡‡ç”¨çš„æ˜¯Goç»å…¸é˜»å¡I/Oçš„ç¼–ç¨‹æ¨¡å‹ï¼Œä½ æ˜¯ä¸æ˜¯å·²ç»æ„Ÿå—åˆ°äº†è¿™ç§æ¨¡å‹åœ¨å¼€å‘é˜¶æ®µå¸¦æ¥çš„å¥½å¤„äº†å‘¢ï¼</p><h2>æ€è€ƒé¢˜</h2><p>åœ¨è¿™è®²çš„ä¸­é—´éƒ¨åˆ†ï¼Œæˆ‘å·²ç»æŠŠä½œä¸šç•™ç»™ä½ äº†ï¼š</p><ol>\n<li>ä¸ºpacketåŒ…ç¼–å†™å•å…ƒæµ‹è¯•ï¼›</li>\n<li>ä¸ºæˆ‘ä»¬çš„æœåŠ¡ç«¯å¢åŠ ä¼˜é›…é€€å‡ºæœºåˆ¶ï¼Œä»¥åŠæ•æ‰æŸä¸ªé“¾æ¥ä¸Šå‡ºç°çš„å¯èƒ½å¯¼è‡´æ•´ä¸ªç¨‹åºé€€å‡ºçš„panicã€‚</li>\n</ol><h3><a href=\"https://github.com/bigwhite/publication/tree/master/column/timegeek/go-first-course/37\">é¡¹ç›®çš„æºä»£ç åœ¨è¿™é‡Œï¼</a></h3>","comments":[{"had_liked":false,"id":347911,"user_name":"Aeins","can_delete":false,"product_type":"c1","uid":1045910,"ip_address":"","ucode":"D5BF220767541D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f5/96/0cf9f3c7.jpg","comment_is_top":false,"comment_ctime":1654575995,"is_pvip":false,"replies":[{"id":126809,"content":"é—®é¢˜å¾ˆæ£’ï¼\n\nè¿™é‡Œé€ä¸€å›ç­”ä¸€ä¸‹ï¼š\n1ã€2ï¼šç½‘ç»œå­—èŠ‚åºæ˜¯TCP&#47;IPä¸­è§„å®šå¥½çš„ä¸€ç§æ•°æ®è¡¨ç¤ºæ ¼å¼,å®ƒä¸å…·ä½“çš„CPUç±»å‹ã€æ“ä½œç³»ç»Ÿç­‰æ— å…³,ä»è€Œå¯ä»¥ä¿è¯æ•°æ®åœ¨ä¸åŒä¸»æœºä¹‹é—´ä¼ è¾“æ—¶èƒ½å¤Ÿè¢«æ­£ç¡®è§£é‡Šã€‚\n3. æŒ‰ç…§æ¯ä¸ªè¿æ¥ä¸€ä¸ª Goroutine çš„æ¨¡å‹ï¼Œä¸æ˜¯å¹¶å‘å†™ï¼Œä¸å­˜åœ¨ä½ è¯´çš„é—®é¢˜ã€‚\n4.  go doc io.ReadFullä¸€ä¸‹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒReadFulléƒ½ä¼šè¯»å‡ºä½ æƒ³è¦çš„é•¿åº¦çš„æ•°æ®ã€‚ä½ é‡åˆ°é”™è¯¯æ—¶ï¼ŒReadFullè¿”å›ä»€ä¹ˆerrorå‘¢ã€‚ \n [upd]ï¼š å‘ç°é—®é¢˜äº†ã€‚æ˜¯clientçš„SetReadDeadlineè®¾ç½®ä¸º1sï¼Œå¤ªçŸ­äº†ã€‚å·²æ”¹ï¼Œè¯·pullæœ€æ–°demoä»£ç ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":1026224,"ctime":1654610362,"ip_address":"","comment_id":347911,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"å‡ ç‚¹ç–‘é—®\n\n1. åè®®å¤„ç†ç¨‹åºä¿è¯ä½¿ç”¨ç›¸åŒçš„å­—èŠ‚åºçš„æƒ…å†µä¸‹ï¼Œæœ‰å¿…è¦ä¸€å®šç”¨å¤§ç«¯åºå—ï¼Œæ”¹æˆå°ç«¯åºï¼Œä¹Ÿèƒ½æˆåŠŸã€‚\n\n2. TCP ä¿è¯é¡ºåºäº¤ä»˜çš„ï¼Œä¸æŒ‡å®šå­—èŠ‚åºï¼Œé¡ºåºå¤„ç†æ•°æ®æµå¯ä»¥å—ã€‚è¿™æ—¶ä¼šæœ‰å­—èŠ‚åºé—®é¢˜å—ï¼Œå¦‚æœåè®®æ ˆéƒ½ä½¿ç”¨åŒä¸€ç§å­—èŠ‚åºå‘¢ã€‚ï¼ˆæˆ‘è®¤ä¸ºå­—èŠ‚åºå’Œç¨‹åºä½¿ç”¨çš„å­—èŠ‚åºæœ‰å…³ï¼Œå¦‚æœæ¯ä¸ªç¨‹åºéƒ½ä½¿ç”¨åŒä¸€ç§å­—èŠ‚åºï¼Œé‚£åº”è¯¥å°±ä¸å­˜åœ¨å­—èŠ‚åºé—®é¢˜äº†ï¼Œæ¯”å¦‚æœ¬ç¨‹åºï¼Œæ”¶å‘éƒ½ç”¨ç›¸åŒçš„å­—èŠ‚åºå¤„ç†ï¼Œä¸çŸ¥é“è¿™ä¸ªç»“è®ºå¯¹ä¸å¯¹ï¼‰\n\n3. åè®®å¤´å’Œåè®®ä½“ï¼Œåˆ†ä¸¤æ¬¡å†™å…¥çš„ï¼Œä¼šä¸ä¼šæœ‰å¹¶å‘å®‰å…¨é—®é¢˜ï¼Œä¸ºä»€ä¹ˆï¼Ÿè¿™é‡Œåº”è¯¥æ²¡åšåˆ°ä¸ŠèŠ‚è¯¾è¯´çš„ï¼Œä¸€æ¬¡å†™å…¥ä¸€ä¸ªâ€œä¸šåŠ¡åŒ…â€å§ã€‚\n\n4. å¤šæ¬¡è¿è¡Œ clientï¼Œé”™è¯¯å¶å‘ã€‚æœ‰æ—¶ io.ReadFull è¯»ä¸æ»¡æ•°æ®ï¼Œæœ‰æ—¶è¯»å–çš„æ•°æ®é•¿åº¦ä¸å¯¹ï¼Œä¼šæ˜¯å“ªäº›åŸå› å¯¼è‡´çš„å‘¢ï¼Ÿ","like_count":7},{"had_liked":false,"id":333960,"user_name":"å·¦è€³æœµä¸œ","can_delete":false,"product_type":"c1","uid":1160678,"ip_address":"","ucode":"60134ACF12BB52","user_header":"https://static001.geekbang.org/account/avatar/00/11/b5/e6/c67f12bd.jpg","comment_is_top":false,"comment_ctime":1644639288,"is_pvip":false,"replies":[{"id":122064,"content":"è¿™é‡Œçš„ç¡®æ²¡å¿…è¦ã€‚ä½†æ˜¯å¦‚æœhandle ackçš„goroutineåœ¨é€€å‡ºå‰éœ€è¦æ‰§è¡Œä¸€äº›æ¸…ç†å·¥ä½œï¼Œé‚£ä¹ˆdoneå°±æœ‰å¿…è¦äº†ã€‚å¦åˆ™å¯èƒ½ä¼šå‡ºç°handle ackçš„goroutineæ²¡æœ‰æ‰§è¡Œå®Œæ¸…ç†å·¥ä½œï¼Œsend goroutineå°±é€€å‡ºçš„è¿›è€Œå¯¼è‡´main goroutineé€€å‡ºå‰æŸhandle ackçš„goroutineéƒ½æ²¡æœ‰æ‰§è¡Œå®Œæ¸…ç†å·¥ä½œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1644763211,"ip_address":"","comment_id":333960,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"client ä»£ç ä¸­çš„ done chan å¥½åƒæ²¡å¿…è¦å§ï¼Œå»æ‰å®ƒä¹Ÿèƒ½æ­£å¸¸é€€å‡º","like_count":4,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575145,"discussion_content":"é—®é¢˜å¾ˆæ£’ï¼\n\nè¿™é‡Œé€ä¸€å›ç­”ä¸€ä¸‹ï¼š\n1ã€2ï¼šç½‘ç»œå­—èŠ‚åºæ˜¯TCP/IPä¸­è§„å®šå¥½çš„ä¸€ç§æ•°æ®è¡¨ç¤ºæ ¼å¼,å®ƒä¸å…·ä½“çš„CPUç±»å‹ã€æ“ä½œç³»ç»Ÿç­‰æ— å…³,ä»è€Œå¯ä»¥ä¿è¯æ•°æ®åœ¨ä¸åŒä¸»æœºä¹‹é—´ä¼ è¾“æ—¶èƒ½å¤Ÿè¢«æ­£ç¡®è§£é‡Šã€‚\n3. æŒ‰ç…§æ¯ä¸ªè¿æ¥ä¸€ä¸ª Goroutine çš„æ¨¡å‹ï¼Œä¸æ˜¯å¹¶å‘å†™ï¼Œä¸å­˜åœ¨ä½ è¯´çš„é—®é¢˜ã€‚\n4.  go doc io.ReadFullä¸€ä¸‹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒReadFulléƒ½ä¼šè¯»å‡ºä½ æƒ³è¦çš„é•¿åº¦çš„æ•°æ®ã€‚ä½ é‡åˆ°é”™è¯¯æ—¶ï¼ŒReadFullè¿”å›ä»€ä¹ˆerrorå‘¢ã€‚ \n [upd]ï¼š å‘ç°é—®é¢˜äº†ã€‚æ˜¯clientçš„SetReadDeadlineè®¾ç½®ä¸º1sï¼Œå¤ªçŸ­äº†ã€‚å·²æ”¹ï¼Œè¯·pullæœ€æ–°demoä»£ç ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654610362,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":352901,"user_name":"æ«","can_delete":false,"product_type":"c1","uid":3043622,"ip_address":"é™•è¥¿","ucode":"2850902F61B46C","user_header":"https://static001.geekbang.org/account/avatar/00/2e/71/26/773e6dcb.jpg","comment_is_top":false,"comment_ctime":1659000395,"is_pvip":false,"replies":[{"id":128374,"content":"å¦‚æœæ²¡æœ‰ä»quitä¸­æ”¶åˆ°å€¼ï¼Œæ˜¯ä¼šè½®è¯¢å•Šã€‚ä¸è¿‡æ¯æ¬¡è½®è¯¢çš„é—´éš”æ˜¯5sï¼Œç¨‹åºä¼šå…ˆåœ¨socketä¸Šåšé˜»å¡è¯»ï¼Œç›´åˆ°è¶…æ—¶ã€‚è¶…æ—¶åå°±å›åˆ°forå¼€å§‹å¤„ï¼Œè¿™ä¹Ÿç»™äº†goroutineä¸€ä¸ªä¼˜é›…é€€å‡ºçš„æœºä¼šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1659104237,"ip_address":"é™•è¥¿","comment_id":352901,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"&#47;&#47;\nselect {\n\t\tcase &lt;-quit:\n\t\t\tdone &lt;- struct{}{}\n\t\t\treturn\n\t\tdefault:\n}\nè€å¸ˆï¼Œclientä¸­è¯»å–æœåŠ¡ç«¯è¿”å›å“åº”çš„è¿™ä¸ªgoroutineä¸­ï¼Œè¿™æ®µselectçš„ä½œç”¨ä¸æ˜¯å¾ˆç†è§£ï¼Œå¦‚æœæ²¡æœ‰ä»quitä¸­æ”¶åˆ°å€¼å°±ä¼šä¸€ç›´è½®è¯¢ï¼Œä½†æ˜¯ä»quitä¸­æ”¶åˆ°å€¼åˆä¼šreturnï¼Œé‚£ä¸‹é¢çš„ä»£ç ä¸æ˜¯ä¸€ç›´éƒ½æ²¡æœ‰æœºä¼šæ‰§è¡Œäº†å—","like_count":3,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":581992,"discussion_content":"å¦‚æœæ²¡æœ‰ä»quitä¸­æ”¶åˆ°å€¼ï¼Œæ˜¯ä¼šè½®è¯¢å•Šã€‚ä¸è¿‡æ¯æ¬¡è½®è¯¢çš„é—´éš”æ˜¯5sï¼Œç¨‹åºä¼šå…ˆåœ¨socketä¸Šåšé˜»å¡è¯»ï¼Œç›´åˆ°è¶…æ—¶ã€‚è¶…æ—¶åå°±å›åˆ°forå¼€å§‹å¤„ï¼Œè¿™ä¹Ÿç»™äº†goroutineä¸€ä¸ªä¼˜é›…é€€å‡ºçš„æœºä¼šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659104237,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é™•è¥¿","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1002201,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4a/d9/75dd7cf9.jpg","nickname":"Mew151","note":"","ucode":"D4793F5874F345","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590189,"discussion_content":" select èµ°åˆ°äº† default åˆ†æ”¯ï¼Œæ˜¯ä¼šç»§ç»­å¾€ä¸‹èµ°çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665576769,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ²³åŒ—","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345145,"user_name":"æ™šæ«","can_delete":false,"product_type":"c1","uid":1315439,"ip_address":"","ucode":"B0EF439E28BF35","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKfYfHAvhZmsKiauxPAt9T2D7ntiaZrP8mial07CAdWiaCEJMawZwficjL3PFvZl35WM7D6ibcYf6miaERJQ/132","comment_is_top":false,"comment_ctime":1652077582,"is_pvip":false,"replies":[{"id":125996,"content":"å­—èŠ‚åºæ˜¯é’ˆå¯¹size&gt;=2ä¸ªå­—èŠ‚çš„æ•´å‹æ•°è€Œè¨€çš„ã€‚payloadå¯¹äºè¯¥åè®®æ¥è¯´åªæ˜¯ä¸€ä¸ªâ€œå­—èŠ‚åºåˆ—â€ã€‚åè®®çš„ä»»åŠ¡å°±æ˜¯è§£æå‡ºpayloadï¼Œç„¶åäº¤ç»™ä¸Šå±‚å¤„ç†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1652147847,"ip_address":"","comment_id":345145,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"ä¸ºä»€ä¹ˆtotalLenæŒ‡å®šäº†å­—èŠ‚åºï¼Œpayloadä¸éœ€è¦æŒ‡å®šå—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571229,"discussion_content":"å­—èŠ‚åºæ˜¯é’ˆå¯¹size&gt;=2ä¸ªå­—èŠ‚çš„æ•´å‹æ•°è€Œè¨€çš„ã€‚payloadå¯¹äºè¯¥åè®®æ¥è¯´åªæ˜¯ä¸€ä¸ªâ€œå­—èŠ‚åºåˆ—â€ã€‚åè®®çš„ä»»åŠ¡å°±æ˜¯è§£æå‡ºpayloadï¼Œç„¶åäº¤ç»™ä¸Šå±‚å¤„ç†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652147847,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1315439,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKfYfHAvhZmsKiauxPAt9T2D7ntiaZrP8mial07CAdWiaCEJMawZwficjL3PFvZl35WM7D6ibcYf6miaERJQ/132","nickname":"æ™šæ«","note":"","ucode":"B0EF439E28BF35","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571657,"discussion_content":"å¤šè°¢è€å¸ˆè§£ç­”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652331588,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332278,"user_name":"ç½—æ°","can_delete":false,"product_type":"c1","uid":1320487,"ip_address":"","ucode":"96BAFAA147341F","user_header":"https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg","comment_is_top":false,"comment_ctime":1643154125,"is_pvip":false,"replies":[{"id":121506,"content":"ğŸ‘ ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1643361508,"ip_address":"","comment_id":332278,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"è¿˜æ˜¯è€å¸ˆå®ç°çš„ä»£ç ä¼˜é›…ï¼Œæˆ‘ä»¬é¡¹ç›®çš„è¿™å—ä»£ç æ˜¯åˆšå¼€å§‹å­¦ Go æ—¶å®ç°çš„ï¼Œåªèƒ½è¯´å¯ä»¥ç”¨ã€‚ä½†å¯¹æ¯”è€å¸ˆçš„å®ç°ï¼Œæˆ‘è§‰å¾—æˆ‘ä»¬çš„ä»£ç å¯ä»¥å¥½å¥½ä¼˜åŒ–ä¸€ä¸‹äº†ã€‚","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548773,"discussion_content":"ğŸ‘ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643361508,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365118,"user_name":"å¼ å°˜","can_delete":false,"product_type":"c1","uid":1069524,"ip_address":"åŒ—äº¬","ucode":"67A404FA68B7DA","user_header":"https://static001.geekbang.org/account/avatar/00/10/51/d4/ca703443.jpg","comment_is_top":false,"comment_ctime":1672128719,"is_pvip":false,"replies":[{"id":132979,"content":"å¯ä»¥ç›´æ¥ä½¿ç”¨[]byteç±»å‹ï¼Œè¿™é‡Œå®šä¹‰FramePayloadæ›´å¤šä¸ºäº†å¼ºè°ƒå…¶æ˜¯frameçš„payloadï¼Œä»…æ­¤è€Œå·²ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1672201500,"ip_address":"åŒ—äº¬","comment_id":365118,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"ç™½è€å¸ˆå¥½, æœ¬èŠ‚è¯¾å—ç›Šé¢‡å¤š, æœ‰ç‚¹ç–‘é—®, è¿˜æœ›æœ‰æ—¶é—´èƒ½å¤Ÿå¸®å¿™è§£ç­”ä¸‹:\nframeCodec.Decodeè¿”å›å€¼æ˜¯è‡ªå®šä¹‰æ•°æ®ç»“æ„FramePayload\npacket.Decodeçš„å…¥å‚æ˜¯[]byte\nclient&#47;server ä»£ç ä¸­ç›´æ¥å°†FramePayloadå½“åš[]byteä½¿ç”¨\n\nframeCodec.Decodeä¸ºä»€ä¹ˆè¦è¿”å›è‡ªå®šä¹‰æ•°æ®ç»“æ„FramePayloadè€Œä¸æ˜¯[]byteå‘¢? æ˜¯å› ä¸ºFramePayloadçš„ç»“æ„å¯èƒ½æ”¹å˜å—? FramePayloadå¯èƒ½ä¸æ˜¯[]byteå—? FramePayloadå¯èƒ½åŒ…å«Packetä¹‹å¤–çš„å…¶å®ƒæ•°æ®å—?\nå¯æ˜¯å¦‚æœFramePayloadçš„ç»“æ„æ”¹å˜, é‚£client&#47;server çš„ä»£ç ä¸­ç›´æ¥å°†FramePayloadå½“åš[]byteçš„ç”¨æ³•ä¸æ˜¯å°±æœ‰é—®é¢˜äº†å—?","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548773,"discussion_content":"ğŸ‘ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643361508,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":363139,"user_name":"Sunrise","can_delete":false,"product_type":"c1","uid":2820643,"ip_address":"è¾½å®","ucode":"791BC042992385","user_header":"https://static001.geekbang.org/account/avatar/00/2b/0a/23/c26f4e50.jpg","comment_is_top":false,"comment_ctime":1669282406,"is_pvip":false,"replies":[{"id":132083,"content":"â€œç›´æ¥ä½¿ç”¨ framePayload â€ ä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1669491424,"ip_address":"è¾½å®","comment_id":363139,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"æœ‰ä¸ªå°ç–‘é—®ï¼š\nfunc (p *myFrameCodec) Encode(w io.Writer, framePayload FramePayload) error { \n  var f = framePayload\n  ...\n}\nvar f = framePayload è¿™ä¸ªåœ°æ–¹æœ‰å¿…è¦é‡æ–°å®šä¹‰ä¸€ä¸ª f å—ï¼Œç›´æ¥ä½¿ç”¨ framePayload ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":594865,"discussion_content":"â€œç›´æ¥ä½¿ç”¨ framePayload â€ ä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1669491424,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361290,"user_name":"å†œæ°‘å›­ä¸","can_delete":false,"product_type":"c1","uid":1155913,"ip_address":"åŒ—äº¬","ucode":"6A91EBBC9DCE6C","user_header":"https://static001.geekbang.org/account/avatar/00/11/a3/49/4a488f4c.jpg","comment_is_top":false,"comment_ctime":1667387111,"is_pvip":false,"replies":[{"id":131599,"content":"net.Connå¯ä»¥ç†è§£ä¸ºio.Readerè¿™ä¸ªæ¥å£ç±»å‹çš„æ–¹æ³•é›†åˆçš„è¶…é›†ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰å®ç°äº†net.Connçš„ç±»å‹ï¼Œä¹Ÿéƒ½å®ç°äº†io.Readeræ¥å£ç±»å‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1667818103,"ip_address":"åŒ—äº¬","comment_id":361290,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"è¯·é—®è€å¸ˆï¼ŒframePayload, err := frameCodec.Decode(c)\nä»¥ä¸Šä»£ç ä¸­&quot;c&quot;æ˜¯net.Conn ç±»å‹ï¼Œ\nè€ŒframeCodec.Decode(io.Reader)çš„è¾“å…¥å‚æ•°æ˜¯io.Reader,\nè¿™ä¸¤ä¸ªä¸ºä»€ä¹ˆå¯ä»¥ä¸ä¸€æ ·ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":594865,"discussion_content":"â€œç›´æ¥ä½¿ç”¨ framePayload â€ ä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1669491424,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":348982,"user_name":"Geek_25f93f","can_delete":false,"product_type":"c1","uid":2917509,"ip_address":"","ucode":"D5932373E8EEA2","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/5JKZO1Ziax3Ky03noshpVNyEvZw0pUwjLcHrHRo1XNPKXdmCE88homb6ltA15CdVRnjzjgGs3Ex42CaDbeYzNuQ/132","comment_is_top":false,"comment_ctime":1655621871,"is_pvip":false,"replies":[{"id":127025,"content":"ä½ æŒ‡çš„æ˜¯TestEncodeWithWriteFailè¿™ä¸ªunit test? è¿™ä¸ªæµ‹è¯•å°±æ˜¯ä¸ºäº†æµ‹è¯•Encodeå¤±è´¥çš„æƒ…å†µã€‚åªæœ‰err == nilçš„æƒ…å†µä¸‹ï¼Œæ‰ä¸ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1655702843,"ip_address":"","comment_id":348982,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"è€å¸ˆï¼Œå•å…ƒæµ‹è¯•çš„ä»£ç æ˜¯ä¸æ˜¯æœ‰ç‚¹é—®é¢˜ï¼Œå°±åˆ¤æ–­æ¡ä»¶æ˜¯if err == nil","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592952,"discussion_content":"net.Connå¯ä»¥ç†è§£ä¸ºio.Readerè¿™ä¸ªæ¥å£ç±»å‹çš„æ–¹æ³•é›†åˆçš„è¶…é›†ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰å®ç°äº†net.Connçš„ç±»å‹ï¼Œä¹Ÿéƒ½å®ç°äº†io.Readeræ¥å£ç±»å‹ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1667818103,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":348186,"user_name":"qiutian","can_delete":false,"product_type":"c1","uid":1313498,"ip_address":"","ucode":"99658A8E342498","user_header":"https://static001.geekbang.org/account/avatar/00/14/0a/da/dcf8f2b1.jpg","comment_is_top":false,"comment_ctime":1654829552,"is_pvip":false,"replies":[{"id":126864,"content":"returnè¯­å¥æœ€åçš„nilæ˜¯ä»£è¡¨err=nilï¼Œå°±æ˜¯ä¸€åˆ‡okï¼Œæ²¡æœ‰æŠ¥é”™ã€‚Encodeå‡½æ•°çš„åŸå‹ï¼Œæœ€åä¸€ä¸ªè¿”å›å€¼æ˜¯ä¸€ä¸ªerrorç±»å‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1654835054,"ip_address":"","comment_id":348186,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"\n&#47;&#47; tcp-server-demo1&#47;packet&#47;packet.go\n\nfunc Encode(p Packet) ([]byte, error) {\n  var commandID uint8\n  var pktBody []byte\n  var err error\n\n  switch t := p.(type) {\n  case *Submit:\n    commandID = CommandSubmit\n    pktBody, err = p.Encode()\n    if err != nil {\n      return nil, err\n    }\n  case *SubmitAck:\n    commandID = CommandSubmitAck\n    pktBody, err = p.Encode()\n    if err != nil {\n      return nil, err\n    }\n  default:\n    return nil, fmt.Errorf(&quot;unknown type [%s]&quot;, t)\n  }\n  return bytes.Join([][]byte{[]byte{commandID}, pktBody}, nil), nil\n}\nè€å¸ˆï¼Œè¿™æ®µä»£ç çš„æœ€åçš„ return bytes.Join(), nilè¿™ä¸ªåœ¨ä»€ä¹ˆæƒ…å†µä¸‹å›è¿è¡Œåˆ°å‘¢?ä¸æ˜¯å¾ˆç†è§£","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575443,"discussion_content":"returnè¯­å¥æœ€åçš„nilæ˜¯ä»£è¡¨err=nilï¼Œå°±æ˜¯ä¸€åˆ‡okï¼Œæ²¡æœ‰æŠ¥é”™ã€‚Encodeå‡½æ•°çš„åŸå‹ï¼Œæœ€åä¸€ä¸ªè¿”å›å€¼æ˜¯ä¸€ä¸ªerrorç±»å‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654835054,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1313498,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0a/da/dcf8f2b1.jpg","nickname":"qiutian","note":"","ucode":"99658A8E342498","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":575459,"discussion_content":"å“¦ï¼Œæˆ‘æ‡‚äº†ï¼Œè°¢è°¢è€å¸ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654848704,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":575443,"ip_address":"","group_id":0},"score":575459,"extra":""}]}]},{"had_liked":false,"id":347911,"user_name":"Aeins","can_delete":false,"product_type":"c1","uid":1045910,"ip_address":"","ucode":"D5BF220767541D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f5/96/0cf9f3c7.jpg","comment_is_top":false,"comment_ctime":1654575995,"is_pvip":false,"replies":[{"id":126809,"content":"é—®é¢˜å¾ˆæ£’ï¼\n\nè¿™é‡Œé€ä¸€å›ç­”ä¸€ä¸‹ï¼š\n1ã€2ï¼šç½‘ç»œå­—èŠ‚åºæ˜¯TCP&#47;IPä¸­è§„å®šå¥½çš„ä¸€ç§æ•°æ®è¡¨ç¤ºæ ¼å¼,å®ƒä¸å…·ä½“çš„CPUç±»å‹ã€æ“ä½œç³»ç»Ÿç­‰æ— å…³,ä»è€Œå¯ä»¥ä¿è¯æ•°æ®åœ¨ä¸åŒä¸»æœºä¹‹é—´ä¼ è¾“æ—¶èƒ½å¤Ÿè¢«æ­£ç¡®è§£é‡Šã€‚\n3. æŒ‰ç…§æ¯ä¸ªè¿æ¥ä¸€ä¸ª Goroutine çš„æ¨¡å‹ï¼Œä¸æ˜¯å¹¶å‘å†™ï¼Œä¸å­˜åœ¨ä½ è¯´çš„é—®é¢˜ã€‚\n4.  go doc io.ReadFullä¸€ä¸‹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒReadFulléƒ½ä¼šè¯»å‡ºä½ æƒ³è¦çš„é•¿åº¦çš„æ•°æ®ã€‚ä½ é‡åˆ°é”™è¯¯æ—¶ï¼ŒReadFullè¿”å›ä»€ä¹ˆerrorå‘¢ã€‚ \n [upd]ï¼š å‘ç°é—®é¢˜äº†ã€‚æ˜¯clientçš„SetReadDeadlineè®¾ç½®ä¸º1sï¼Œå¤ªçŸ­äº†ã€‚å·²æ”¹ï¼Œè¯·pullæœ€æ–°demoä»£ç ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":1026224,"ctime":1654610362,"ip_address":"","comment_id":347911,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"å‡ ç‚¹ç–‘é—®\n\n1. åè®®å¤„ç†ç¨‹åºä¿è¯ä½¿ç”¨ç›¸åŒçš„å­—èŠ‚åºçš„æƒ…å†µä¸‹ï¼Œæœ‰å¿…è¦ä¸€å®šç”¨å¤§ç«¯åºå—ï¼Œæ”¹æˆå°ç«¯åºï¼Œä¹Ÿèƒ½æˆåŠŸã€‚\n\n2. TCP ä¿è¯é¡ºåºäº¤ä»˜çš„ï¼Œä¸æŒ‡å®šå­—èŠ‚åºï¼Œé¡ºåºå¤„ç†æ•°æ®æµå¯ä»¥å—ã€‚è¿™æ—¶ä¼šæœ‰å­—èŠ‚åºé—®é¢˜å—ï¼Œå¦‚æœåè®®æ ˆéƒ½ä½¿ç”¨åŒä¸€ç§å­—èŠ‚åºå‘¢ã€‚ï¼ˆæˆ‘è®¤ä¸ºå­—èŠ‚åºå’Œç¨‹åºä½¿ç”¨çš„å­—èŠ‚åºæœ‰å…³ï¼Œå¦‚æœæ¯ä¸ªç¨‹åºéƒ½ä½¿ç”¨åŒä¸€ç§å­—èŠ‚åºï¼Œé‚£åº”è¯¥å°±ä¸å­˜åœ¨å­—èŠ‚åºé—®é¢˜äº†ï¼Œæ¯”å¦‚æœ¬ç¨‹åºï¼Œæ”¶å‘éƒ½ç”¨ç›¸åŒçš„å­—èŠ‚åºå¤„ç†ï¼Œä¸çŸ¥é“è¿™ä¸ªç»“è®ºå¯¹ä¸å¯¹ï¼‰\n\n3. åè®®å¤´å’Œåè®®ä½“ï¼Œåˆ†ä¸¤æ¬¡å†™å…¥çš„ï¼Œä¼šä¸ä¼šæœ‰å¹¶å‘å®‰å…¨é—®é¢˜ï¼Œä¸ºä»€ä¹ˆï¼Ÿè¿™é‡Œåº”è¯¥æ²¡åšåˆ°ä¸ŠèŠ‚è¯¾è¯´çš„ï¼Œä¸€æ¬¡å†™å…¥ä¸€ä¸ªâ€œä¸šåŠ¡åŒ…â€å§ã€‚\n\n4. å¤šæ¬¡è¿è¡Œ clientï¼Œé”™è¯¯å¶å‘ã€‚æœ‰æ—¶ io.ReadFull è¯»ä¸æ»¡æ•°æ®ï¼Œæœ‰æ—¶è¯»å–çš„æ•°æ®é•¿åº¦ä¸å¯¹ï¼Œä¼šæ˜¯å“ªäº›åŸå› å¯¼è‡´çš„å‘¢ï¼Ÿ","like_count":7,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575145,"discussion_content":"é—®é¢˜å¾ˆæ£’ï¼\n\nè¿™é‡Œé€ä¸€å›ç­”ä¸€ä¸‹ï¼š\n1ã€2ï¼šç½‘ç»œå­—èŠ‚åºæ˜¯TCP/IPä¸­è§„å®šå¥½çš„ä¸€ç§æ•°æ®è¡¨ç¤ºæ ¼å¼,å®ƒä¸å…·ä½“çš„CPUç±»å‹ã€æ“ä½œç³»ç»Ÿç­‰æ— å…³,ä»è€Œå¯ä»¥ä¿è¯æ•°æ®åœ¨ä¸åŒä¸»æœºä¹‹é—´ä¼ è¾“æ—¶èƒ½å¤Ÿè¢«æ­£ç¡®è§£é‡Šã€‚\n3. æŒ‰ç…§æ¯ä¸ªè¿æ¥ä¸€ä¸ª Goroutine çš„æ¨¡å‹ï¼Œä¸æ˜¯å¹¶å‘å†™ï¼Œä¸å­˜åœ¨ä½ è¯´çš„é—®é¢˜ã€‚\n4.  go doc io.ReadFullä¸€ä¸‹ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒReadFulléƒ½ä¼šè¯»å‡ºä½ æƒ³è¦çš„é•¿åº¦çš„æ•°æ®ã€‚ä½ é‡åˆ°é”™è¯¯æ—¶ï¼ŒReadFullè¿”å›ä»€ä¹ˆerrorå‘¢ã€‚ \n [upd]ï¼š å‘ç°é—®é¢˜äº†ã€‚æ˜¯clientçš„SetReadDeadlineè®¾ç½®ä¸º1sï¼Œå¤ªçŸ­äº†ã€‚å·²æ”¹ï¼Œè¯·pullæœ€æ–°demoä»£ç ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654610362,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":333960,"user_name":"å·¦è€³æœµä¸œ","can_delete":false,"product_type":"c1","uid":1160678,"ip_address":"","ucode":"60134ACF12BB52","user_header":"https://static001.geekbang.org/account/avatar/00/11/b5/e6/c67f12bd.jpg","comment_is_top":false,"comment_ctime":1644639288,"is_pvip":false,"replies":[{"id":122064,"content":"è¿™é‡Œçš„ç¡®æ²¡å¿…è¦ã€‚ä½†æ˜¯å¦‚æœhandle ackçš„goroutineåœ¨é€€å‡ºå‰éœ€è¦æ‰§è¡Œä¸€äº›æ¸…ç†å·¥ä½œï¼Œé‚£ä¹ˆdoneå°±æœ‰å¿…è¦äº†ã€‚å¦åˆ™å¯èƒ½ä¼šå‡ºç°handle ackçš„goroutineæ²¡æœ‰æ‰§è¡Œå®Œæ¸…ç†å·¥ä½œï¼Œsend goroutineå°±é€€å‡ºçš„è¿›è€Œå¯¼è‡´main goroutineé€€å‡ºå‰æŸhandle ackçš„goroutineéƒ½æ²¡æœ‰æ‰§è¡Œå®Œæ¸…ç†å·¥ä½œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1644763211,"ip_address":"","comment_id":333960,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"client ä»£ç ä¸­çš„ done chan å¥½åƒæ²¡å¿…è¦å§ï¼Œå»æ‰å®ƒä¹Ÿèƒ½æ­£å¸¸é€€å‡º","like_count":4,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550867,"discussion_content":"è¿™é‡Œçš„ç¡®æ²¡å¿…è¦ã€‚ä½†æ˜¯å¦‚æœhandle ackçš„goroutineåœ¨é€€å‡ºå‰éœ€è¦æ‰§è¡Œä¸€äº›æ¸…ç†å·¥ä½œï¼Œé‚£ä¹ˆdoneå°±æœ‰å¿…è¦äº†ã€‚å¦åˆ™å¯èƒ½ä¼šå‡ºç°handle ackçš„goroutineæ²¡æœ‰æ‰§è¡Œå®Œæ¸…ç†å·¥ä½œï¼Œsend goroutineå°±é€€å‡ºçš„è¿›è€Œå¯¼è‡´main goroutineé€€å‡ºå‰æŸhandle ackçš„goroutineéƒ½æ²¡æœ‰æ‰§è¡Œå®Œæ¸…ç†å·¥ä½œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644763212,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1160678,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b5/e6/c67f12bd.jpg","nickname":"å·¦è€³æœµä¸œ","note":"","ucode":"60134ACF12BB52","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":551271,"discussion_content":"è°¢è°¢è€å¸ˆè§£ç­”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644971207,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":550867,"ip_address":"","group_id":0},"score":551271,"extra":""}]}]},{"had_liked":false,"id":352901,"user_name":"æ«","can_delete":false,"product_type":"c1","uid":3043622,"ip_address":"é™•è¥¿","ucode":"2850902F61B46C","user_header":"https://static001.geekbang.org/account/avatar/00/2e/71/26/773e6dcb.jpg","comment_is_top":false,"comment_ctime":1659000395,"is_pvip":false,"replies":[{"id":128374,"content":"å¦‚æœæ²¡æœ‰ä»quitä¸­æ”¶åˆ°å€¼ï¼Œæ˜¯ä¼šè½®è¯¢å•Šã€‚ä¸è¿‡æ¯æ¬¡è½®è¯¢çš„é—´éš”æ˜¯5sï¼Œç¨‹åºä¼šå…ˆåœ¨socketä¸Šåšé˜»å¡è¯»ï¼Œç›´åˆ°è¶…æ—¶ã€‚è¶…æ—¶åå°±å›åˆ°forå¼€å§‹å¤„ï¼Œè¿™ä¹Ÿç»™äº†goroutineä¸€ä¸ªä¼˜é›…é€€å‡ºçš„æœºä¼šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1659104237,"ip_address":"é™•è¥¿","comment_id":352901,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"&#47;&#47;\nselect {\n\t\tcase &lt;-quit:\n\t\t\tdone &lt;- struct{}{}\n\t\t\treturn\n\t\tdefault:\n}\nè€å¸ˆï¼Œclientä¸­è¯»å–æœåŠ¡ç«¯è¿”å›å“åº”çš„è¿™ä¸ªgoroutineä¸­ï¼Œè¿™æ®µselectçš„ä½œç”¨ä¸æ˜¯å¾ˆç†è§£ï¼Œå¦‚æœæ²¡æœ‰ä»quitä¸­æ”¶åˆ°å€¼å°±ä¼šä¸€ç›´è½®è¯¢ï¼Œä½†æ˜¯ä»quitä¸­æ”¶åˆ°å€¼åˆä¼šreturnï¼Œé‚£ä¸‹é¢çš„ä»£ç ä¸æ˜¯ä¸€ç›´éƒ½æ²¡æœ‰æœºä¼šæ‰§è¡Œäº†å—","like_count":3,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550867,"discussion_content":"è¿™é‡Œçš„ç¡®æ²¡å¿…è¦ã€‚ä½†æ˜¯å¦‚æœhandle ackçš„goroutineåœ¨é€€å‡ºå‰éœ€è¦æ‰§è¡Œä¸€äº›æ¸…ç†å·¥ä½œï¼Œé‚£ä¹ˆdoneå°±æœ‰å¿…è¦äº†ã€‚å¦åˆ™å¯èƒ½ä¼šå‡ºç°handle ackçš„goroutineæ²¡æœ‰æ‰§è¡Œå®Œæ¸…ç†å·¥ä½œï¼Œsend goroutineå°±é€€å‡ºçš„è¿›è€Œå¯¼è‡´main goroutineé€€å‡ºå‰æŸhandle ackçš„goroutineéƒ½æ²¡æœ‰æ‰§è¡Œå®Œæ¸…ç†å·¥ä½œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644763212,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1160678,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b5/e6/c67f12bd.jpg","nickname":"å·¦è€³æœµä¸œ","note":"","ucode":"60134ACF12BB52","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":551271,"discussion_content":"è°¢è°¢è€å¸ˆè§£ç­”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644971207,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":550867,"ip_address":"","group_id":0},"score":551271,"extra":""}]}]},{"had_liked":false,"id":345145,"user_name":"æ™šæ«","can_delete":false,"product_type":"c1","uid":1315439,"ip_address":"","ucode":"B0EF439E28BF35","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKfYfHAvhZmsKiauxPAt9T2D7ntiaZrP8mial07CAdWiaCEJMawZwficjL3PFvZl35WM7D6ibcYf6miaERJQ/132","comment_is_top":false,"comment_ctime":1652077582,"is_pvip":false,"replies":[{"id":125996,"content":"å­—èŠ‚åºæ˜¯é’ˆå¯¹size&gt;=2ä¸ªå­—èŠ‚çš„æ•´å‹æ•°è€Œè¨€çš„ã€‚payloadå¯¹äºè¯¥åè®®æ¥è¯´åªæ˜¯ä¸€ä¸ªâ€œå­—èŠ‚åºåˆ—â€ã€‚åè®®çš„ä»»åŠ¡å°±æ˜¯è§£æå‡ºpayloadï¼Œç„¶åäº¤ç»™ä¸Šå±‚å¤„ç†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1652147847,"ip_address":"","comment_id":345145,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"ä¸ºä»€ä¹ˆtotalLenæŒ‡å®šäº†å­—èŠ‚åºï¼Œpayloadä¸éœ€è¦æŒ‡å®šå—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":581992,"discussion_content":"å¦‚æœæ²¡æœ‰ä»quitä¸­æ”¶åˆ°å€¼ï¼Œæ˜¯ä¼šè½®è¯¢å•Šã€‚ä¸è¿‡æ¯æ¬¡è½®è¯¢çš„é—´éš”æ˜¯5sï¼Œç¨‹åºä¼šå…ˆåœ¨socketä¸Šåšé˜»å¡è¯»ï¼Œç›´åˆ°è¶…æ—¶ã€‚è¶…æ—¶åå°±å›åˆ°forå¼€å§‹å¤„ï¼Œè¿™ä¹Ÿç»™äº†goroutineä¸€ä¸ªä¼˜é›…é€€å‡ºçš„æœºä¼šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659104237,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"é™•è¥¿","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1002201,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4a/d9/75dd7cf9.jpg","nickname":"Mew151","note":"","ucode":"D4793F5874F345","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590189,"discussion_content":" select èµ°åˆ°äº† default åˆ†æ”¯ï¼Œæ˜¯ä¼šç»§ç»­å¾€ä¸‹èµ°çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665576769,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ²³åŒ—","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332278,"user_name":"ç½—æ°","can_delete":false,"product_type":"c1","uid":1320487,"ip_address":"","ucode":"96BAFAA147341F","user_header":"https://static001.geekbang.org/account/avatar/00/14/26/27/eba94899.jpg","comment_is_top":false,"comment_ctime":1643154125,"is_pvip":false,"replies":[{"id":121506,"content":"ğŸ‘ ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1643361508,"ip_address":"","comment_id":332278,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"è¿˜æ˜¯è€å¸ˆå®ç°çš„ä»£ç ä¼˜é›…ï¼Œæˆ‘ä»¬é¡¹ç›®çš„è¿™å—ä»£ç æ˜¯åˆšå¼€å§‹å­¦ Go æ—¶å®ç°çš„ï¼Œåªèƒ½è¯´å¯ä»¥ç”¨ã€‚ä½†å¯¹æ¯”è€å¸ˆçš„å®ç°ï¼Œæˆ‘è§‰å¾—æˆ‘ä»¬çš„ä»£ç å¯ä»¥å¥½å¥½ä¼˜åŒ–ä¸€ä¸‹äº†ã€‚","like_count":2,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571229,"discussion_content":"å­—èŠ‚åºæ˜¯é’ˆå¯¹size&gt;=2ä¸ªå­—èŠ‚çš„æ•´å‹æ•°è€Œè¨€çš„ã€‚payloadå¯¹äºè¯¥åè®®æ¥è¯´åªæ˜¯ä¸€ä¸ªâ€œå­—èŠ‚åºåˆ—â€ã€‚åè®®çš„ä»»åŠ¡å°±æ˜¯è§£æå‡ºpayloadï¼Œç„¶åäº¤ç»™ä¸Šå±‚å¤„ç†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652147847,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1315439,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKfYfHAvhZmsKiauxPAt9T2D7ntiaZrP8mial07CAdWiaCEJMawZwficjL3PFvZl35WM7D6ibcYf6miaERJQ/132","nickname":"æ™šæ«","note":"","ucode":"B0EF439E28BF35","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571657,"discussion_content":"å¤šè°¢è€å¸ˆè§£ç­”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652331588,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":365118,"user_name":"å¼ å°˜","can_delete":false,"product_type":"c1","uid":1069524,"ip_address":"åŒ—äº¬","ucode":"67A404FA68B7DA","user_header":"https://static001.geekbang.org/account/avatar/00/10/51/d4/ca703443.jpg","comment_is_top":false,"comment_ctime":1672128719,"is_pvip":false,"replies":[{"id":132979,"content":"å¯ä»¥ç›´æ¥ä½¿ç”¨[]byteç±»å‹ï¼Œè¿™é‡Œå®šä¹‰FramePayloadæ›´å¤šä¸ºäº†å¼ºè°ƒå…¶æ˜¯frameçš„payloadï¼Œä»…æ­¤è€Œå·²ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1672201500,"ip_address":"åŒ—äº¬","comment_id":365118,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"ç™½è€å¸ˆå¥½, æœ¬èŠ‚è¯¾å—ç›Šé¢‡å¤š, æœ‰ç‚¹ç–‘é—®, è¿˜æœ›æœ‰æ—¶é—´èƒ½å¤Ÿå¸®å¿™è§£ç­”ä¸‹:\nframeCodec.Decodeè¿”å›å€¼æ˜¯è‡ªå®šä¹‰æ•°æ®ç»“æ„FramePayload\npacket.Decodeçš„å…¥å‚æ˜¯[]byte\nclient&#47;server ä»£ç ä¸­ç›´æ¥å°†FramePayloadå½“åš[]byteä½¿ç”¨\n\nframeCodec.Decodeä¸ºä»€ä¹ˆè¦è¿”å›è‡ªå®šä¹‰æ•°æ®ç»“æ„FramePayloadè€Œä¸æ˜¯[]byteå‘¢? æ˜¯å› ä¸ºFramePayloadçš„ç»“æ„å¯èƒ½æ”¹å˜å—? FramePayloadå¯èƒ½ä¸æ˜¯[]byteå—? FramePayloadå¯èƒ½åŒ…å«Packetä¹‹å¤–çš„å…¶å®ƒæ•°æ®å—?\nå¯æ˜¯å¦‚æœFramePayloadçš„ç»“æ„æ”¹å˜, é‚£client&#47;server çš„ä»£ç ä¸­ç›´æ¥å°†FramePayloadå½“åš[]byteçš„ç”¨æ³•ä¸æ˜¯å°±æœ‰é—®é¢˜äº†å—?","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597742,"discussion_content":"å¯ä»¥ç›´æ¥ä½¿ç”¨[]byteç±»å‹ï¼Œè¿™é‡Œå®šä¹‰FramePayloadæ›´å¤šä¸ºäº†å¼ºè°ƒå…¶æ˜¯frameçš„payloadï¼Œä»…æ­¤è€Œå·²ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672201500,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":363139,"user_name":"Sunrise","can_delete":false,"product_type":"c1","uid":2820643,"ip_address":"è¾½å®","ucode":"791BC042992385","user_header":"https://static001.geekbang.org/account/avatar/00/2b/0a/23/c26f4e50.jpg","comment_is_top":false,"comment_ctime":1669282406,"is_pvip":false,"replies":[{"id":132083,"content":"â€œç›´æ¥ä½¿ç”¨ framePayload â€ ä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1669491424,"ip_address":"è¾½å®","comment_id":363139,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"æœ‰ä¸ªå°ç–‘é—®ï¼š\nfunc (p *myFrameCodec) Encode(w io.Writer, framePayload FramePayload) error { \n  var f = framePayload\n  ...\n}\nvar f = framePayload è¿™ä¸ªåœ°æ–¹æœ‰å¿…è¦é‡æ–°å®šä¹‰ä¸€ä¸ª f å—ï¼Œç›´æ¥ä½¿ç”¨ framePayload ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":597742,"discussion_content":"å¯ä»¥ç›´æ¥ä½¿ç”¨[]byteç±»å‹ï¼Œè¿™é‡Œå®šä¹‰FramePayloadæ›´å¤šä¸ºäº†å¼ºè°ƒå…¶æ˜¯frameçš„payloadï¼Œä»…æ­¤è€Œå·²ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1672201500,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361290,"user_name":"å†œæ°‘å›­ä¸","can_delete":false,"product_type":"c1","uid":1155913,"ip_address":"åŒ—äº¬","ucode":"6A91EBBC9DCE6C","user_header":"https://static001.geekbang.org/account/avatar/00/11/a3/49/4a488f4c.jpg","comment_is_top":false,"comment_ctime":1667387111,"is_pvip":false,"replies":[{"id":131599,"content":"net.Connå¯ä»¥ç†è§£ä¸ºio.Readerè¿™ä¸ªæ¥å£ç±»å‹çš„æ–¹æ³•é›†åˆçš„è¶…é›†ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰å®ç°äº†net.Connçš„ç±»å‹ï¼Œä¹Ÿéƒ½å®ç°äº†io.Readeræ¥å£ç±»å‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1667818103,"ip_address":"åŒ—äº¬","comment_id":361290,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"è¯·é—®è€å¸ˆï¼ŒframePayload, err := frameCodec.Decode(c)\nä»¥ä¸Šä»£ç ä¸­&quot;c&quot;æ˜¯net.Conn ç±»å‹ï¼Œ\nè€ŒframeCodec.Decode(io.Reader)çš„è¾“å…¥å‚æ•°æ˜¯io.Reader,\nè¿™ä¸¤ä¸ªä¸ºä»€ä¹ˆå¯ä»¥ä¸ä¸€æ ·ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592952,"discussion_content":"net.Connå¯ä»¥ç†è§£ä¸ºio.Readerè¿™ä¸ªæ¥å£ç±»å‹çš„æ–¹æ³•é›†åˆçš„è¶…é›†ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰å®ç°äº†net.Connçš„ç±»å‹ï¼Œä¹Ÿéƒ½å®ç°äº†io.Readeræ¥å£ç±»å‹ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1667818103,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":348982,"user_name":"Geek_25f93f","can_delete":false,"product_type":"c1","uid":2917509,"ip_address":"","ucode":"D5932373E8EEA2","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/5JKZO1Ziax3Ky03noshpVNyEvZw0pUwjLcHrHRo1XNPKXdmCE88homb6ltA15CdVRnjzjgGs3Ex42CaDbeYzNuQ/132","comment_is_top":false,"comment_ctime":1655621871,"is_pvip":false,"replies":[{"id":127025,"content":"ä½ æŒ‡çš„æ˜¯TestEncodeWithWriteFailè¿™ä¸ªunit test? è¿™ä¸ªæµ‹è¯•å°±æ˜¯ä¸ºäº†æµ‹è¯•Encodeå¤±è´¥çš„æƒ…å†µã€‚åªæœ‰err == nilçš„æƒ…å†µä¸‹ï¼Œæ‰ä¸ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1655702843,"ip_address":"","comment_id":348982,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"è€å¸ˆï¼Œå•å…ƒæµ‹è¯•çš„ä»£ç æ˜¯ä¸æ˜¯æœ‰ç‚¹é—®é¢˜ï¼Œå°±åˆ¤æ–­æ¡ä»¶æ˜¯if err == nil","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576610,"discussion_content":"ä½ æŒ‡çš„æ˜¯TestEncodeWithWriteFailè¿™ä¸ªunit test? è¿™ä¸ªæµ‹è¯•å°±æ˜¯ä¸ºäº†æµ‹è¯•Encodeå¤±è´¥çš„æƒ…å†µã€‚åªæœ‰err == nilçš„æƒ…å†µä¸‹ï¼Œæ‰ä¸ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655702843,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":348186,"user_name":"qiutian","can_delete":false,"product_type":"c1","uid":1313498,"ip_address":"","ucode":"99658A8E342498","user_header":"https://static001.geekbang.org/account/avatar/00/14/0a/da/dcf8f2b1.jpg","comment_is_top":false,"comment_ctime":1654829552,"is_pvip":false,"replies":[{"id":126864,"content":"returnè¯­å¥æœ€åçš„nilæ˜¯ä»£è¡¨err=nilï¼Œå°±æ˜¯ä¸€åˆ‡okï¼Œæ²¡æœ‰æŠ¥é”™ã€‚Encodeå‡½æ•°çš„åŸå‹ï¼Œæœ€åä¸€ä¸ªè¿”å›å€¼æ˜¯ä¸€ä¸ªerrorç±»å‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1654835054,"ip_address":"","comment_id":348186,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100093501,"comment_content":"\n&#47;&#47; tcp-server-demo1&#47;packet&#47;packet.go\n\nfunc Encode(p Packet) ([]byte, error) {\n  var commandID uint8\n  var pktBody []byte\n  var err error\n\n  switch t := p.(type) {\n  case *Submit:\n    commandID = CommandSubmit\n    pktBody, err = p.Encode()\n    if err != nil {\n      return nil, err\n    }\n  case *SubmitAck:\n    commandID = CommandSubmitAck\n    pktBody, err = p.Encode()\n    if err != nil {\n      return nil, err\n    }\n  default:\n    return nil, fmt.Errorf(&quot;unknown type [%s]&quot;, t)\n  }\n  return bytes.Join([][]byte{[]byte{commandID}, pktBody}, nil), nil\n}\nè€å¸ˆï¼Œè¿™æ®µä»£ç çš„æœ€åçš„ return bytes.Join(), nilè¿™ä¸ªåœ¨ä»€ä¹ˆæƒ…å†µä¸‹å›è¿è¡Œåˆ°å‘¢?ä¸æ˜¯å¾ˆç†è§£","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576610,"discussion_content":"ä½ æŒ‡çš„æ˜¯TestEncodeWithWriteFailè¿™ä¸ªunit test? è¿™ä¸ªæµ‹è¯•å°±æ˜¯ä¸ºäº†æµ‹è¯•Encodeå¤±è´¥çš„æƒ…å†µã€‚åªæœ‰err == nilçš„æƒ…å†µä¸‹ï¼Œæ‰ä¸ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655702843,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332390,"user_name":"Calvin","can_delete":false,"product_type":"c1","uid":1603004,"ip_address":"","ucode":"0EEF5B207623B5","user_header":"https://static001.geekbang.org/account/avatar/00/18/75/bc/89d88775.jpg","comment_is_top":false,"comment_ctime":1643196727,"is_pvip":false,"replies":[{"id":121503,"content":"å¯¹çš„ï¼Œconnæµç¨‹ä¸€èˆ¬æœ‰ä¸€ä¸ªèº«ä»½éªŒè¯çš„è¿‡ç¨‹ã€‚è€ƒè™‘åˆ°ç¯‡å¹…ï¼Œæ–‡ä¸­æ²¡æœ‰åŠ connå’Œconnackï¼Œå¦‚æœåŠ ä¸Šï¼Œç¯‡å¹…å°±è¦è¶…å‡ºè®¸å¤šã€‚æƒ³æƒ³æ€è·¯å°±å¥½ï¼Œå¦‚æœè¦å®ç°ï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªconnæ¶ˆæ¯ä½“ï¼Œç„¶åç»ƒç»ƒæ‰‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1643361321,"ip_address":"","comment_id":332390,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"è€å¸ˆï¼ŒConn å’Œ ConnAck è¦å®ç°çš„è¯ï¼Œè¯·é—®ä»ä¸šåŠ¡ä¸­æ¥è®²ï¼Œä¸€èˆ¬ä¼šéœ€è¦å‘é€ä¸€äº›ä»€ä¹ˆ Payload å‘¢ï¼Ÿæˆ‘çœ‹è¿™é‡Œçš„ä¾‹å­æ²¡æœ‰ä»–ä»¬ä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œæ•´ä¸ªæµç¨‹ï¼Œæ˜¯ç±»ä¼¼ éœ€è¦è®¤è¯çš„ç³»ç»Ÿä¸­çš„ç™»å½•è´¦å·å’Œå¯†ç  çš„è¿™ç§å†…å®¹å—ï¼Ÿ","like_count":1},{"had_liked":false,"id":332290,"user_name":"éª¨æ±¤é¸¡è›‹é¢","can_delete":false,"product_type":"c1","uid":1050002,"ip_address":"","ucode":"2AC141A523E710","user_header":"https://static001.geekbang.org/account/avatar/00/10/05/92/b609f7e3.jpg","comment_is_top":false,"comment_ctime":1643161595,"is_pvip":false,"replies":[{"id":121616,"content":"æˆ‘è§‰å¾—æ›´å¤šæ˜¯å¯¹é€šä¿¡ä¸¤ç«¯äº¤äº’æ¨¡å¼çš„æŠ½è±¡ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1643543012,"ip_address":"","comment_id":332290,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"è€å¸ˆï¼Œä¸€äº›rpcæ¡†æ¶å­¦ä¹  http2 çš„streamæ¦‚å¿µï¼Œåœ¨connectionä¸åè®®ä¹‹é—´åŠ äº†ä¸€ä¸ªstreamå±‚ï¼Œ è¿™å—ä¸»è¦æŠ½è±¡äº†å•¥ï¼Œå¾ˆæƒ³å¬ä¸€ä¸‹è€å¸ˆçš„çœ‹æ³•ã€‚ ","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548770,"discussion_content":"å¯¹çš„ï¼Œconnæµç¨‹ä¸€èˆ¬æœ‰ä¸€ä¸ªèº«ä»½éªŒè¯çš„è¿‡ç¨‹ã€‚è€ƒè™‘åˆ°ç¯‡å¹…ï¼Œæ–‡ä¸­æ²¡æœ‰åŠ connå’Œconnackï¼Œå¦‚æœåŠ ä¸Šï¼Œç¯‡å¹…å°±è¦è¶…å‡ºè®¸å¤šã€‚æƒ³æƒ³æ€è·¯å°±å¥½ï¼Œå¦‚æœè¦å®ç°ï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªconnæ¶ˆæ¯ä½“ï¼Œç„¶åç»ƒç»ƒæ‰‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643361321,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383797,"user_name":"çˆ±åƒèƒ¡èåœ","can_delete":false,"product_type":"c1","uid":1459413,"ip_address":"å¹¿ä¸œ","ucode":"35FCF84D1E04C5","user_header":"https://static001.geekbang.org/account/avatar/00/16/44/d5/ca522e83.jpg","comment_is_top":false,"comment_ctime":1699666136,"is_pvip":false,"replies":[{"id":139984,"content":"1. ç½‘ç»œå­—èŠ‚åºé»˜è®¤å¤§ç«¯ã€‚ä½†æ²¡æœ‰â€œæœ¬åœ°ç£ç›˜â€è¿™ç§è¯´æ³•ï¼Œåªæœ‰æœ¬åœ°å­—èŠ‚åº(æˆ–ä¸»æœºå­—èŠ‚åº)è¿™ç§è¯´æ³•ï¼Œåªä¸cpué‡‡ç”¨çš„å­—èŠ‚åºæœ‰å…³ã€‚x86 cpuéƒ½æ˜¯å°ç«¯ï¼Œä»¥å‰çš„sun sparcå¤„ç†å™¨æ˜¯å¤§ç«¯ã€‚armé»˜è®¤å°ç«¯ï¼Œä½†ä¹Ÿæ”¯æŒå¤§ç«¯ã€‚\n2. ç›®å‰æ²¡æœ‰å®˜æ–¹å‘½åè§„èŒƒæ¥åŒºåˆ†è¯¥ç±»å‹å…·ä½“æ˜¯å˜é‡ï¼Œè¿˜æ˜¯ç»“æ„ä½“æ¥å£ç±»å‹ã€‚å¦‚æœ‰éœ€æ±‚ï¼Œè¿™ä¸ªå¯ä»¥å…¬å¸&#47;ç»„ç»‡å†…éƒ¨è‡ªå·±å®šä¹‰ã€‚å¾ˆéš¾æ ‡å‡†åŒ–ã€‚\n3. å»ºè®®å›çœ‹ä¸€ä¸‹è®²å¸¸é‡å’Œiotaé‚£ä¸€è®²ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1699826920,"ip_address":"è¾½å®","comment_id":383797,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"è€å¸ˆè¿™èŠ‚è¯¾å­¦å®Œäº†ï¼Œä¸»è¦è¿˜æ˜¯æœ‰ä¸€ä¸‹å‡ ç‚¹å›°æƒ‘ï¼Œçƒ¦è¯·è§£ç­”\n1.å…³äºå¤§ç«¯å°ç«¯å°é—®é¢˜\nç½‘ç»œå­—èŠ‚æ˜¯ä¸æ˜¯éƒ½æ˜¯å¤§ç«¯\nè€Œæœ¬åœ°çš„çš„æ¯”å¦‚ç£ç›˜è¿™ç§ é»˜è®¤çš„æ˜¯å°ç«¯\n\n2. å…³äºå‘½åè§„èŒƒ\ngoè¯­è¨€é€šè¿‡å¤§å°å†™åŒºåˆ†publicå’Œinternelæƒé™\né‚£ä¹ˆè¿™é‡Œæˆ‘æ€ä¹ˆé€šè¿‡å‘½åå»åŒºåˆ†è¯¥ç±»å‹å…·ä½“æ˜¯å˜é‡ï¼Œè¿˜æ˜¯ç»“æ„ä½“æ¥å£ç±»å‹å‘¢\næœ‰ä»€ä¹ˆå…·ä½“è§„èŒƒæ²¡æœ‰ï¼Œå› ä¸ºä¹‹å‰æ¥è§¦çš„è¯­è¨€éƒ½æ˜¯é€šè¿‡å¤§å°å†™åŒºåˆ†å˜é‡å’Œç»“æ„ä½“å›ºæœ‰æ¬¡ä¸€é—®\næˆ‘çœ‹ä»£ç é‡Œå¾ˆå¤šå‚æ•° éƒ½æ˜¯ä»¥çŸ­å­—ç¬¦å‘½åï¼Œæˆ‘æ¥è§¦åˆ°è¯­è¨€å‘½åéƒ½æ˜¯å°½å¯èƒ½é•¿ï¼Œä»¥åšåˆ°æœ›æ–‡çŸ¥ä¹‰ï¼Œ\nä»¥çŸ­å­—ç¬¦å‘½åè¿™ä¸ªç¬¦åˆgoçš„ç¼–ç è§„èŒƒå—\n\n3. const ç±»å‹æ¨æ–­\n\nconst (\n\tCommonConn  = iota + 0x01\n\tCommonSumbit\n)\n\nconst (\n\tCommonConnAck  = iota + 0x81\n\tCommonSumbitAck\n)\n\nç¼–è¯‘å™¨æ˜¯å¦‚ä½•è¯†åˆ«å®ƒçš„å…·ä½“ç±»å‹çš„ï¼Œå› ä¸ºè¿™ä¸ªå­—æ®µæœ€ç»ˆä¼šè¢«encodeæ‰€ä»¥æœ‰æ¬¡ä¸€é—® ä¸‡ä¸€ç¼–è¯‘å™¨è¯†åˆ«æˆintå‹é‚£ç¼–ç å°±æ˜¯å¤±è´¥äº†\næˆ‘æŠŠå®ƒç®€å•é‡æ„äº†ä¸€ä¸‹\n\nconst (\n\tCommonConn uint8 = iota + 0x01\n\tCommonSumbit\n)\n\nconst (\n\tCommonConnAck uint8 = iota + 0x81\n\tCommonSumbitAck\n)","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631607,"discussion_content":"1. ç½‘ç»œå­—èŠ‚åºé»˜è®¤å¤§ç«¯ã€‚ä½†æ²¡æœ‰â€œæœ¬åœ°ç£ç›˜â€è¿™ç§è¯´æ³•ï¼Œåªæœ‰æœ¬åœ°å­—èŠ‚åº(æˆ–ä¸»æœºå­—èŠ‚åº)è¿™ç§è¯´æ³•ï¼Œåªä¸cpué‡‡ç”¨çš„å­—èŠ‚åºæœ‰å…³ã€‚x86 cpuéƒ½æ˜¯å°ç«¯ï¼Œä»¥å‰çš„sun sparcå¤„ç†å™¨æ˜¯å¤§ç«¯ã€‚armé»˜è®¤å°ç«¯ï¼Œä½†ä¹Ÿæ”¯æŒå¤§ç«¯ã€‚\n2. ç›®å‰æ²¡æœ‰å®˜æ–¹å‘½åè§„èŒƒæ¥åŒºåˆ†è¯¥ç±»å‹å…·ä½“æ˜¯å˜é‡ï¼Œè¿˜æ˜¯ç»“æ„ä½“æ¥å£ç±»å‹ã€‚å¦‚æœ‰éœ€æ±‚ï¼Œè¿™ä¸ªå¯ä»¥å…¬å¸/ç»„ç»‡å†…éƒ¨è‡ªå·±å®šä¹‰ã€‚å¾ˆéš¾æ ‡å‡†åŒ–ã€‚\n3. å»ºè®®å›çœ‹ä¸€ä¸‹è®²å¸¸é‡å’Œiotaé‚£ä¸€è®²ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1699826920,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":373305,"user_name":"Geek_1cc6d1","can_delete":false,"product_type":"c1","uid":1850248,"ip_address":"åŒ—äº¬","ucode":"3E083616DD0742","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erZCyXaP2gbxwFHxvtnyaaF2Pyy5KkSMsk9kh7SJl8icp1CD6wicb6VJibiblGibbpDo6IuHrdST6AnWQg/132","comment_is_top":false,"comment_ctime":1682383282,"is_pvip":false,"replies":[{"id":136357,"content":"æ¯ä¸ªåŒ…å•å…ƒçš„æ€»é•¿æ˜¯totallengthï¼Œè€Œtotallengthå­—æ®µæœ¬èº«é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œè¿™æ ·å°±å¯ä»¥ç®—å‡ºåŒ…å•å…ƒçš„å‰©ä½™å¤§å°ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1682400548,"ip_address":"åŒ—äº¬","comment_id":373305,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"æ€ä¹ˆæ ¹æ®totalLengthæ‹†åŒ…çš„ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631607,"discussion_content":"1. ç½‘ç»œå­—èŠ‚åºé»˜è®¤å¤§ç«¯ã€‚ä½†æ²¡æœ‰â€œæœ¬åœ°ç£ç›˜â€è¿™ç§è¯´æ³•ï¼Œåªæœ‰æœ¬åœ°å­—èŠ‚åº(æˆ–ä¸»æœºå­—èŠ‚åº)è¿™ç§è¯´æ³•ï¼Œåªä¸cpué‡‡ç”¨çš„å­—èŠ‚åºæœ‰å…³ã€‚x86 cpuéƒ½æ˜¯å°ç«¯ï¼Œä»¥å‰çš„sun sparcå¤„ç†å™¨æ˜¯å¤§ç«¯ã€‚armé»˜è®¤å°ç«¯ï¼Œä½†ä¹Ÿæ”¯æŒå¤§ç«¯ã€‚\n2. ç›®å‰æ²¡æœ‰å®˜æ–¹å‘½åè§„èŒƒæ¥åŒºåˆ†è¯¥ç±»å‹å…·ä½“æ˜¯å˜é‡ï¼Œè¿˜æ˜¯ç»“æ„ä½“æ¥å£ç±»å‹ã€‚å¦‚æœ‰éœ€æ±‚ï¼Œè¿™ä¸ªå¯ä»¥å…¬å¸/ç»„ç»‡å†…éƒ¨è‡ªå·±å®šä¹‰ã€‚å¾ˆéš¾æ ‡å‡†åŒ–ã€‚\n3. å»ºè®®å›çœ‹ä¸€ä¸‹è®²å¸¸é‡å’Œiotaé‚£ä¸€è®²ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1699826920,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":370019,"user_name":"Six Days","can_delete":false,"product_type":"c1","uid":1322463,"ip_address":"å¹¿ä¸œ","ucode":"8587F2EEFFFD11","user_header":"https://static001.geekbang.org/account/avatar/00/14/2d/df/4949b250.jpg","comment_is_top":false,"comment_ctime":1678265090,"is_pvip":false,"replies":[{"id":134927,"content":"ç¡è§‰è¿™ç§ï¼Œå“ªç§è®¾è®¡æ›´åˆç†ï¼Œè¿˜æ˜¯è¦çœ‹éœ€æ±‚ä¸Šä¸‹æ–‡å§ï¼Œè¿™é‡Œä»…ä»…æ˜¯ä¸€ä¸ªdemoã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1678432569,"ip_address":"åŒ—äº¬","comment_id":370019,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"frame encode çš„æ–¹æ³•å°†æ•°æ®ç¼–ç ä¸å‘é€è€¦åˆåœ¨ä¸€èµ·ï¼Œåœ¨å¤–ç•Œè°ƒç”¨çš„æ—¶å€™æ— æ³•ç›´è§‚çš„æ„Ÿå—åˆ°æ¶ˆæ¯å‘é€ï¼Œå»ºè®®å¯ä»¥åšä¸‹åˆç†æ‹†åˆ†ï¼Œå¯¹ä½“éªŒæ¶ˆæ¯å‘é€ä¸æ¥æ”¶æ›´å®¹æ˜“ç†è§£","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":615696,"discussion_content":"æ¯ä¸ªåŒ…å•å…ƒçš„æ€»é•¿æ˜¯totallengthï¼Œè€Œtotallengthå­—æ®µæœ¬èº«é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œè¿™æ ·å°±å¯ä»¥ç®—å‡ºåŒ…å•å…ƒçš„å‰©ä½™å¤§å°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1682400548,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":366726,"user_name":"zhuè§è§","can_delete":false,"product_type":"c1","uid":1141494,"ip_address":"é‡åº†","ucode":"22F745AA60503D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erwcUXd1YciaE2VmCRZUjbm0hscIAwvXJOQtibK2aor2DrmxxPszsfecZ11dibniakRSkMYrhp8ibsHWoA/132","comment_is_top":false,"comment_ctime":1674117640,"is_pvip":false,"replies":[{"id":133608,"content":"çœ‹ä¸€ä¸‹æœ¬è®²çš„è¯„è®ºåŒºçš„ç±»ä¼¼çš„é—®é¢˜çš„ç­”å¤å§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1674123480,"ip_address":"åŒ—äº¬","comment_id":366726,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"done è¿™ä¸ªchançš„æ„ä¹‰æ˜¯å•¥å‘¢ï¼Ÿä¸ºäº†è®©startClient æ™šäºå†…éƒ¨çš„go func æ‰§è¡Œå®Œå—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":608411,"discussion_content":"ç¡è§‰è¿™ç§ï¼Œå“ªç§è®¾è®¡æ›´åˆç†ï¼Œè¿˜æ˜¯è¦çœ‹éœ€æ±‚ä¸Šä¸‹æ–‡å§ï¼Œè¿™é‡Œä»…ä»…æ˜¯ä¸€ä¸ªdemoã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678432569,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358186,"user_name":"Jay","can_delete":false,"product_type":"c1","uid":1070670,"ip_address":"è¾½å®","ucode":"ED9970F7E66080","user_header":"https://static001.geekbang.org/account/avatar/00/10/56/4e/9291fac0.jpg","comment_is_top":false,"comment_ctime":1664011373,"is_pvip":false,"replies":[{"id":130368,"content":"è¿™å—çš„få¯ä»¥ä¸ç”¨ï¼Œç›´æ¥ç”¨framePayloadåº”è¯¥æ²¡æœ‰é—®é¢˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1664113750,"ip_address":"è¾½å®","comment_id":358186,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"func (p *myFrameCodec) Encode(w io.Writer, framePayload FramePayload) error { \nvar f = framePayload \nvar totalLen int32 = int32(len(framePayload)) + 4 \n...\n}\nä»¥ä¸Šæ–¹æ³•çš„ç¬¬äºŒè¡Œå¤„æœ‰ä¸ªç–‘é—®ï¼š\n\nä¸ºä»€ä¹ˆè¦é¢å¤–åˆ›å»ºä¸€ä¸ªæ–¹æ³•å‚æ•° framePayload çš„æ‹·è´ f å‘¢ï¼Ÿç›´æ¥ä½¿ç”¨ framePayload ä¼ å…¥ w.Write() æ–¹æ³•ä¼šæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600230,"discussion_content":"çœ‹ä¸€ä¸‹æœ¬è®²çš„è¯„è®ºåŒºçš„ç±»ä¼¼çš„é—®é¢˜çš„ç­”å¤å§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1674123481,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350125,"user_name":"ä¸­å¹´ç¼–ç¨‹äººå‘˜","can_delete":false,"product_type":"c1","uid":1979090,"ip_address":"","ucode":"8692C6FA9B0ED3","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/x3gOkI2Dl1Gb3WRic44roicJMILgHfdFRic8nfR7oh0asf0KONEj7U2or6YHMmCcyibskvVE5Pjypz2ALGwBXRyMPA/132","comment_is_top":false,"comment_ctime":1656583591,"is_pvip":false,"replies":[{"id":127394,"content":"åŠ ä¸ŠtotalLenè‡ªèº«çš„é•¿åº¦å•Šï¼šç”¨4ä¸ªå­—èŠ‚è¡¨ç¤ºtotalLenã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1656598819,"ip_address":"","comment_id":350125,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"è€å¸ˆä½ å¥½ï¼Œframeä¸­ï¼Œvar totalLen int32 = int32(len(framePayload)) + 4ï¼›è¿™ä¸ªtotalLenä¸ºå•¥è¦åŠ 4å‘¢ï¼Ÿï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588793,"discussion_content":"è¿™å—çš„få¯ä»¥ä¸ç”¨ï¼Œç›´æ¥ç”¨framePayloadåº”è¯¥æ²¡æœ‰é—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1664113750,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":347968,"user_name":"å—æ–¹è™šå¿ƒç«¹","can_delete":false,"product_type":"c1","uid":1598063,"ip_address":"","ucode":"1816A2C9BA82B3","user_header":"https://static001.geekbang.org/account/avatar/00/18/62/6f/8fb1a57b.jpg","comment_is_top":false,"comment_ctime":1654614627,"is_pvip":false,"replies":[{"id":126858,"content":"çš„ç¡®æ˜¯é—®é¢˜ã€‚ä½†ä¸æ˜¯è¿™é‡Œçš„é—®é¢˜ã€‚æ˜¯demoä¸­clientçš„SetReadDeadlineè®¾ç½®ä¸º1sï¼Œå¤ªçŸ­äº†ã€‚å·²æ”¹ï¼Œè¯·pullæœ€æ–°demoä»£ç ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1654828176,"ip_address":"","comment_id":347968,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"frame.go:  \n\nfunc (p *myFrameCodec) Decode(r io.Reader) (FramePayload, error) {\n    ...\n    buf := make([]byte, totalLen-4)   &#47;&#47; è¿™è¡Œåœ¨è¿è¡Œçš„æ—¶å€™åœ¨è·‘çš„æ—¶å€™ä¼španic \n   ...\n}\n&#47;&#47; panic: runtime error: makeslice: len out of range\næ‰“å°å‡ºæ¥æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„è´Ÿæ•°\n\nå¤§æ¦‚ç‡ä¼španicï¼Œå°æ¦‚ç‡ä¼špassï¼Œæ„Ÿè§‰æ˜¯å¤šçº¿ç¨‹ä¸‹å‡ºç°çš„é—®é¢˜\n\næ±‚è€å¸ˆè§£ç­”ä¸€ä¸‹\n","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578246,"discussion_content":"åŠ ä¸ŠtotalLenè‡ªèº«çš„é•¿åº¦å•Šï¼šç”¨4ä¸ªå­—èŠ‚è¡¨ç¤ºtotalLenã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656598819,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":347966,"user_name":"å—æ–¹è™šå¿ƒç«¹","can_delete":false,"product_type":"c1","uid":1598063,"ip_address":"","ucode":"1816A2C9BA82B3","user_header":"https://static001.geekbang.org/account/avatar/00/18/62/6f/8fb1a57b.jpg","comment_is_top":false,"comment_ctime":1654613509,"is_pvip":false,"replies":[{"id":126852,"content":"pktBody[:8] å’Œ pktBody[0:8] æ˜¯ç­‰ä»·çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1654762919,"ip_address":"","comment_id":347966,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"packet.go ä¸­ Submit æ˜ å°„çš„Decodeæ–¹æ³• \nç¬¬äºŒè¡Œä¸­ä½¿ç”¨ s.ID = string(pktBody[:8])  å†™æ³•åœ¨è¿è¡Œclientçš„æ—¶å€™å’Œä¼šå‡ºç° \npanic: runtime error: makeslice: len out of range\nä¿®æ”¹ä¸ºè€å¸ˆgitå½“ä¸­çš„s.ID = string(pktBody[0:8]) åå¯ä»¥æ­£å¸¸è¿è¡Œã€‚ï¼ˆæˆ‘çš„ç¯å¢ƒæ˜¯MacOS12-intelCPUï¼‰\n\næƒ³è¯·æ•™ä¸‹è€å¸ˆè¿™é‡Œçš„ pktBody[:8] å’Œ pktBody[0:8] ä¸æ˜¯ç­‰ä»·çš„å—ï¼Ÿ\n\n&#47;&#47; é™„ä¸Šæ–‡ç« ä¸­çš„ä»£ç \nfunc (s *Submit) Decode(pktBody []byte) error { \n    s.ID = string(pktBody[:8]) \n    s.Payload = pktBody[8:] \n    return nil\n}","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575427,"discussion_content":"çš„ç¡®æ˜¯é—®é¢˜ã€‚ä½†ä¸æ˜¯è¿™é‡Œçš„é—®é¢˜ã€‚æ˜¯demoä¸­clientçš„SetReadDeadlineè®¾ç½®ä¸º1sï¼Œå¤ªçŸ­äº†ã€‚å·²æ”¹ï¼Œè¯·pullæœ€æ–°demoä»£ç ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654828176,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332390,"user_name":"Calvin","can_delete":false,"product_type":"c1","uid":1603004,"ip_address":"","ucode":"0EEF5B207623B5","user_header":"https://static001.geekbang.org/account/avatar/00/18/75/bc/89d88775.jpg","comment_is_top":false,"comment_ctime":1643196727,"is_pvip":false,"replies":[{"id":121503,"content":"å¯¹çš„ï¼Œconnæµç¨‹ä¸€èˆ¬æœ‰ä¸€ä¸ªèº«ä»½éªŒè¯çš„è¿‡ç¨‹ã€‚è€ƒè™‘åˆ°ç¯‡å¹…ï¼Œæ–‡ä¸­æ²¡æœ‰åŠ connå’Œconnackï¼Œå¦‚æœåŠ ä¸Šï¼Œç¯‡å¹…å°±è¦è¶…å‡ºè®¸å¤šã€‚æƒ³æƒ³æ€è·¯å°±å¥½ï¼Œå¦‚æœè¦å®ç°ï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªconnæ¶ˆæ¯ä½“ï¼Œç„¶åç»ƒç»ƒæ‰‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1643361321,"ip_address":"","comment_id":332390,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"è€å¸ˆï¼ŒConn å’Œ ConnAck è¦å®ç°çš„è¯ï¼Œè¯·é—®ä»ä¸šåŠ¡ä¸­æ¥è®²ï¼Œä¸€èˆ¬ä¼šéœ€è¦å‘é€ä¸€äº›ä»€ä¹ˆ Payload å‘¢ï¼Ÿæˆ‘çœ‹è¿™é‡Œçš„ä¾‹å­æ²¡æœ‰ä»–ä»¬ä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œæ•´ä¸ªæµç¨‹ï¼Œæ˜¯ç±»ä¼¼ éœ€è¦è®¤è¯çš„ç³»ç»Ÿä¸­çš„ç™»å½•è´¦å·å’Œå¯†ç  çš„è¿™ç§å†…å®¹å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548770,"discussion_content":"å¯¹çš„ï¼Œconnæµç¨‹ä¸€èˆ¬æœ‰ä¸€ä¸ªèº«ä»½éªŒè¯çš„è¿‡ç¨‹ã€‚è€ƒè™‘åˆ°ç¯‡å¹…ï¼Œæ–‡ä¸­æ²¡æœ‰åŠ connå’Œconnackï¼Œå¦‚æœåŠ ä¸Šï¼Œç¯‡å¹…å°±è¦è¶…å‡ºè®¸å¤šã€‚æƒ³æƒ³æ€è·¯å°±å¥½ï¼Œå¦‚æœè¦å®ç°ï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªconnæ¶ˆæ¯ä½“ï¼Œç„¶åç»ƒç»ƒæ‰‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643361321,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332290,"user_name":"éª¨æ±¤é¸¡è›‹é¢","can_delete":false,"product_type":"c1","uid":1050002,"ip_address":"","ucode":"2AC141A523E710","user_header":"https://static001.geekbang.org/account/avatar/00/10/05/92/b609f7e3.jpg","comment_is_top":false,"comment_ctime":1643161595,"is_pvip":false,"replies":[{"id":121616,"content":"æˆ‘è§‰å¾—æ›´å¤šæ˜¯å¯¹é€šä¿¡ä¸¤ç«¯äº¤äº’æ¨¡å¼çš„æŠ½è±¡ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1643543012,"ip_address":"","comment_id":332290,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"è€å¸ˆï¼Œä¸€äº›rpcæ¡†æ¶å­¦ä¹  http2 çš„streamæ¦‚å¿µï¼Œåœ¨connectionä¸åè®®ä¹‹é—´åŠ äº†ä¸€ä¸ªstreamå±‚ï¼Œ è¿™å—ä¸»è¦æŠ½è±¡äº†å•¥ï¼Œå¾ˆæƒ³å¬ä¸€ä¸‹è€å¸ˆçš„çœ‹æ³•ã€‚ ","like_count":1,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549077,"discussion_content":"æˆ‘è§‰å¾—æ›´å¤šæ˜¯å¯¹é€šä¿¡ä¸¤ç«¯äº¤äº’æ¨¡å¼çš„æŠ½è±¡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643543013,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1667175,"avatar":"https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg","nickname":"qinsi","note":"","ucode":"090D9C4068FF12","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548666,"discussion_content":"çŒœæµ‹æ˜¯ä¸‹æ¸¸çš„å¤šä¸ªè¯·æ±‚å¯ä»¥å…±ç”¨ä¸€ä¸ªåˆ°ä¸Šæ¸¸çš„è¿æ¥ï¼Œä»¥èŠ‚çœé‡å¤å»ºç«‹è¿æ¥çš„å¼€é”€å’Œå‡å°‘åˆ°ä¸Šæ¸¸çš„è¿æ¥æ•°é‡ã€‚å¥½å¥‡åœ¨goé‡Œæœ‰ä»€ä¹ˆä¼˜é›…çš„å®ç°æ–¹å¼ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643300147,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383797,"user_name":"çˆ±åƒèƒ¡èåœ","can_delete":false,"product_type":"c1","uid":1459413,"ip_address":"å¹¿ä¸œ","ucode":"35FCF84D1E04C5","user_header":"https://static001.geekbang.org/account/avatar/00/16/44/d5/ca522e83.jpg","comment_is_top":false,"comment_ctime":1699666136,"is_pvip":false,"replies":[{"id":139984,"content":"1. ç½‘ç»œå­—èŠ‚åºé»˜è®¤å¤§ç«¯ã€‚ä½†æ²¡æœ‰â€œæœ¬åœ°ç£ç›˜â€è¿™ç§è¯´æ³•ï¼Œåªæœ‰æœ¬åœ°å­—èŠ‚åº(æˆ–ä¸»æœºå­—èŠ‚åº)è¿™ç§è¯´æ³•ï¼Œåªä¸cpué‡‡ç”¨çš„å­—èŠ‚åºæœ‰å…³ã€‚x86 cpuéƒ½æ˜¯å°ç«¯ï¼Œä»¥å‰çš„sun sparcå¤„ç†å™¨æ˜¯å¤§ç«¯ã€‚armé»˜è®¤å°ç«¯ï¼Œä½†ä¹Ÿæ”¯æŒå¤§ç«¯ã€‚\n2. ç›®å‰æ²¡æœ‰å®˜æ–¹å‘½åè§„èŒƒæ¥åŒºåˆ†è¯¥ç±»å‹å…·ä½“æ˜¯å˜é‡ï¼Œè¿˜æ˜¯ç»“æ„ä½“æ¥å£ç±»å‹ã€‚å¦‚æœ‰éœ€æ±‚ï¼Œè¿™ä¸ªå¯ä»¥å…¬å¸&#47;ç»„ç»‡å†…éƒ¨è‡ªå·±å®šä¹‰ã€‚å¾ˆéš¾æ ‡å‡†åŒ–ã€‚\n3. å»ºè®®å›çœ‹ä¸€ä¸‹è®²å¸¸é‡å’Œiotaé‚£ä¸€è®²ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1699826920,"ip_address":"è¾½å®","comment_id":383797,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"è€å¸ˆè¿™èŠ‚è¯¾å­¦å®Œäº†ï¼Œä¸»è¦è¿˜æ˜¯æœ‰ä¸€ä¸‹å‡ ç‚¹å›°æƒ‘ï¼Œçƒ¦è¯·è§£ç­”\n1.å…³äºå¤§ç«¯å°ç«¯å°é—®é¢˜\nç½‘ç»œå­—èŠ‚æ˜¯ä¸æ˜¯éƒ½æ˜¯å¤§ç«¯\nè€Œæœ¬åœ°çš„çš„æ¯”å¦‚ç£ç›˜è¿™ç§ é»˜è®¤çš„æ˜¯å°ç«¯\n\n2. å…³äºå‘½åè§„èŒƒ\ngoè¯­è¨€é€šè¿‡å¤§å°å†™åŒºåˆ†publicå’Œinternelæƒé™\né‚£ä¹ˆè¿™é‡Œæˆ‘æ€ä¹ˆé€šè¿‡å‘½åå»åŒºåˆ†è¯¥ç±»å‹å…·ä½“æ˜¯å˜é‡ï¼Œè¿˜æ˜¯ç»“æ„ä½“æ¥å£ç±»å‹å‘¢\næœ‰ä»€ä¹ˆå…·ä½“è§„èŒƒæ²¡æœ‰ï¼Œå› ä¸ºä¹‹å‰æ¥è§¦çš„è¯­è¨€éƒ½æ˜¯é€šè¿‡å¤§å°å†™åŒºåˆ†å˜é‡å’Œç»“æ„ä½“å›ºæœ‰æ¬¡ä¸€é—®\næˆ‘çœ‹ä»£ç é‡Œå¾ˆå¤šå‚æ•° éƒ½æ˜¯ä»¥çŸ­å­—ç¬¦å‘½åï¼Œæˆ‘æ¥è§¦åˆ°è¯­è¨€å‘½åéƒ½æ˜¯å°½å¯èƒ½é•¿ï¼Œä»¥åšåˆ°æœ›æ–‡çŸ¥ä¹‰ï¼Œ\nä»¥çŸ­å­—ç¬¦å‘½åè¿™ä¸ªç¬¦åˆgoçš„ç¼–ç è§„èŒƒå—\n\n3. const ç±»å‹æ¨æ–­\n\nconst (\n\tCommonConn  = iota + 0x01\n\tCommonSumbit\n)\n\nconst (\n\tCommonConnAck  = iota + 0x81\n\tCommonSumbitAck\n)\n\nç¼–è¯‘å™¨æ˜¯å¦‚ä½•è¯†åˆ«å®ƒçš„å…·ä½“ç±»å‹çš„ï¼Œå› ä¸ºè¿™ä¸ªå­—æ®µæœ€ç»ˆä¼šè¢«encodeæ‰€ä»¥æœ‰æ¬¡ä¸€é—® ä¸‡ä¸€ç¼–è¯‘å™¨è¯†åˆ«æˆintå‹é‚£ç¼–ç å°±æ˜¯å¤±è´¥äº†\næˆ‘æŠŠå®ƒç®€å•é‡æ„äº†ä¸€ä¸‹\n\nconst (\n\tCommonConn uint8 = iota + 0x01\n\tCommonSumbit\n)\n\nconst (\n\tCommonConnAck uint8 = iota + 0x81\n\tCommonSumbitAck\n)","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549077,"discussion_content":"æˆ‘è§‰å¾—æ›´å¤šæ˜¯å¯¹é€šä¿¡ä¸¤ç«¯äº¤äº’æ¨¡å¼çš„æŠ½è±¡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643543013,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1667175,"avatar":"https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg","nickname":"qinsi","note":"","ucode":"090D9C4068FF12","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548666,"discussion_content":"çŒœæµ‹æ˜¯ä¸‹æ¸¸çš„å¤šä¸ªè¯·æ±‚å¯ä»¥å…±ç”¨ä¸€ä¸ªåˆ°ä¸Šæ¸¸çš„è¿æ¥ï¼Œä»¥èŠ‚çœé‡å¤å»ºç«‹è¿æ¥çš„å¼€é”€å’Œå‡å°‘åˆ°ä¸Šæ¸¸çš„è¿æ¥æ•°é‡ã€‚å¥½å¥‡åœ¨goé‡Œæœ‰ä»€ä¹ˆä¼˜é›…çš„å®ç°æ–¹å¼ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643300147,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":373305,"user_name":"Geek_1cc6d1","can_delete":false,"product_type":"c1","uid":1850248,"ip_address":"åŒ—äº¬","ucode":"3E083616DD0742","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erZCyXaP2gbxwFHxvtnyaaF2Pyy5KkSMsk9kh7SJl8icp1CD6wicb6VJibiblGibbpDo6IuHrdST6AnWQg/132","comment_is_top":false,"comment_ctime":1682383282,"is_pvip":false,"replies":[{"id":136357,"content":"æ¯ä¸ªåŒ…å•å…ƒçš„æ€»é•¿æ˜¯totallengthï¼Œè€Œtotallengthå­—æ®µæœ¬èº«é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œè¿™æ ·å°±å¯ä»¥ç®—å‡ºåŒ…å•å…ƒçš„å‰©ä½™å¤§å°ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1682400548,"ip_address":"åŒ—äº¬","comment_id":373305,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"æ€ä¹ˆæ ¹æ®totalLengthæ‹†åŒ…çš„ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":615696,"discussion_content":"æ¯ä¸ªåŒ…å•å…ƒçš„æ€»é•¿æ˜¯totallengthï¼Œè€Œtotallengthå­—æ®µæœ¬èº«é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œè¿™æ ·å°±å¯ä»¥ç®—å‡ºåŒ…å•å…ƒçš„å‰©ä½™å¤§å°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1682400548,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":370019,"user_name":"Six Days","can_delete":false,"product_type":"c1","uid":1322463,"ip_address":"å¹¿ä¸œ","ucode":"8587F2EEFFFD11","user_header":"https://static001.geekbang.org/account/avatar/00/14/2d/df/4949b250.jpg","comment_is_top":false,"comment_ctime":1678265090,"is_pvip":false,"replies":[{"id":134927,"content":"ç¡è§‰è¿™ç§ï¼Œå“ªç§è®¾è®¡æ›´åˆç†ï¼Œè¿˜æ˜¯è¦çœ‹éœ€æ±‚ä¸Šä¸‹æ–‡å§ï¼Œè¿™é‡Œä»…ä»…æ˜¯ä¸€ä¸ªdemoã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1678432569,"ip_address":"åŒ—äº¬","comment_id":370019,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"frame encode çš„æ–¹æ³•å°†æ•°æ®ç¼–ç ä¸å‘é€è€¦åˆåœ¨ä¸€èµ·ï¼Œåœ¨å¤–ç•Œè°ƒç”¨çš„æ—¶å€™æ— æ³•ç›´è§‚çš„æ„Ÿå—åˆ°æ¶ˆæ¯å‘é€ï¼Œå»ºè®®å¯ä»¥åšä¸‹åˆç†æ‹†åˆ†ï¼Œå¯¹ä½“éªŒæ¶ˆæ¯å‘é€ä¸æ¥æ”¶æ›´å®¹æ˜“ç†è§£","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":608411,"discussion_content":"ç¡è§‰è¿™ç§ï¼Œå“ªç§è®¾è®¡æ›´åˆç†ï¼Œè¿˜æ˜¯è¦çœ‹éœ€æ±‚ä¸Šä¸‹æ–‡å§ï¼Œè¿™é‡Œä»…ä»…æ˜¯ä¸€ä¸ªdemoã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678432569,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":366726,"user_name":"zhuè§è§","can_delete":false,"product_type":"c1","uid":1141494,"ip_address":"é‡åº†","ucode":"22F745AA60503D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erwcUXd1YciaE2VmCRZUjbm0hscIAwvXJOQtibK2aor2DrmxxPszsfecZ11dibniakRSkMYrhp8ibsHWoA/132","comment_is_top":false,"comment_ctime":1674117640,"is_pvip":false,"replies":[{"id":133608,"content":"çœ‹ä¸€ä¸‹æœ¬è®²çš„è¯„è®ºåŒºçš„ç±»ä¼¼çš„é—®é¢˜çš„ç­”å¤å§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1674123480,"ip_address":"åŒ—äº¬","comment_id":366726,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"done è¿™ä¸ªchançš„æ„ä¹‰æ˜¯å•¥å‘¢ï¼Ÿä¸ºäº†è®©startClient æ™šäºå†…éƒ¨çš„go func æ‰§è¡Œå®Œå—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600230,"discussion_content":"çœ‹ä¸€ä¸‹æœ¬è®²çš„è¯„è®ºåŒºçš„ç±»ä¼¼çš„é—®é¢˜çš„ç­”å¤å§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1674123481,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358186,"user_name":"Jay","can_delete":false,"product_type":"c1","uid":1070670,"ip_address":"è¾½å®","ucode":"ED9970F7E66080","user_header":"https://static001.geekbang.org/account/avatar/00/10/56/4e/9291fac0.jpg","comment_is_top":false,"comment_ctime":1664011373,"is_pvip":false,"replies":[{"id":130368,"content":"è¿™å—çš„få¯ä»¥ä¸ç”¨ï¼Œç›´æ¥ç”¨framePayloadåº”è¯¥æ²¡æœ‰é—®é¢˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1664113750,"ip_address":"è¾½å®","comment_id":358186,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"func (p *myFrameCodec) Encode(w io.Writer, framePayload FramePayload) error { \nvar f = framePayload \nvar totalLen int32 = int32(len(framePayload)) + 4 \n...\n}\nä»¥ä¸Šæ–¹æ³•çš„ç¬¬äºŒè¡Œå¤„æœ‰ä¸ªç–‘é—®ï¼š\n\nä¸ºä»€ä¹ˆè¦é¢å¤–åˆ›å»ºä¸€ä¸ªæ–¹æ³•å‚æ•° framePayload çš„æ‹·è´ f å‘¢ï¼Ÿç›´æ¥ä½¿ç”¨ framePayload ä¼ å…¥ w.Write() æ–¹æ³•ä¼šæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":588793,"discussion_content":"è¿™å—çš„få¯ä»¥ä¸ç”¨ï¼Œç›´æ¥ç”¨framePayloadåº”è¯¥æ²¡æœ‰é—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1664113750,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"è¾½å®","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350125,"user_name":"ä¸­å¹´ç¼–ç¨‹äººå‘˜","can_delete":false,"product_type":"c1","uid":1979090,"ip_address":"","ucode":"8692C6FA9B0ED3","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/x3gOkI2Dl1Gb3WRic44roicJMILgHfdFRic8nfR7oh0asf0KONEj7U2or6YHMmCcyibskvVE5Pjypz2ALGwBXRyMPA/132","comment_is_top":false,"comment_ctime":1656583591,"is_pvip":false,"replies":[{"id":127394,"content":"åŠ ä¸ŠtotalLenè‡ªèº«çš„é•¿åº¦å•Šï¼šç”¨4ä¸ªå­—èŠ‚è¡¨ç¤ºtotalLenã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1656598819,"ip_address":"","comment_id":350125,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"è€å¸ˆä½ å¥½ï¼Œframeä¸­ï¼Œvar totalLen int32 = int32(len(framePayload)) + 4ï¼›è¿™ä¸ªtotalLenä¸ºå•¥è¦åŠ 4å‘¢ï¼Ÿï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578246,"discussion_content":"åŠ ä¸ŠtotalLenè‡ªèº«çš„é•¿åº¦å•Šï¼šç”¨4ä¸ªå­—èŠ‚è¡¨ç¤ºtotalLenã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656598819,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":347968,"user_name":"å—æ–¹è™šå¿ƒç«¹","can_delete":false,"product_type":"c1","uid":1598063,"ip_address":"","ucode":"1816A2C9BA82B3","user_header":"https://static001.geekbang.org/account/avatar/00/18/62/6f/8fb1a57b.jpg","comment_is_top":false,"comment_ctime":1654614627,"is_pvip":false,"replies":[{"id":126858,"content":"çš„ç¡®æ˜¯é—®é¢˜ã€‚ä½†ä¸æ˜¯è¿™é‡Œçš„é—®é¢˜ã€‚æ˜¯demoä¸­clientçš„SetReadDeadlineè®¾ç½®ä¸º1sï¼Œå¤ªçŸ­äº†ã€‚å·²æ”¹ï¼Œè¯·pullæœ€æ–°demoä»£ç ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1654828176,"ip_address":"","comment_id":347968,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"frame.go:  \n\nfunc (p *myFrameCodec) Decode(r io.Reader) (FramePayload, error) {\n    ...\n    buf := make([]byte, totalLen-4)   &#47;&#47; è¿™è¡Œåœ¨è¿è¡Œçš„æ—¶å€™åœ¨è·‘çš„æ—¶å€™ä¼španic \n   ...\n}\n&#47;&#47; panic: runtime error: makeslice: len out of range\næ‰“å°å‡ºæ¥æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„è´Ÿæ•°\n\nå¤§æ¦‚ç‡ä¼španicï¼Œå°æ¦‚ç‡ä¼špassï¼Œæ„Ÿè§‰æ˜¯å¤šçº¿ç¨‹ä¸‹å‡ºç°çš„é—®é¢˜\n\næ±‚è€å¸ˆè§£ç­”ä¸€ä¸‹\n","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575427,"discussion_content":"çš„ç¡®æ˜¯é—®é¢˜ã€‚ä½†ä¸æ˜¯è¿™é‡Œçš„é—®é¢˜ã€‚æ˜¯demoä¸­clientçš„SetReadDeadlineè®¾ç½®ä¸º1sï¼Œå¤ªçŸ­äº†ã€‚å·²æ”¹ï¼Œè¯·pullæœ€æ–°demoä»£ç ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654828176,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":347966,"user_name":"å—æ–¹è™šå¿ƒç«¹","can_delete":false,"product_type":"c1","uid":1598063,"ip_address":"","ucode":"1816A2C9BA82B3","user_header":"https://static001.geekbang.org/account/avatar/00/18/62/6f/8fb1a57b.jpg","comment_is_top":false,"comment_ctime":1654613509,"is_pvip":false,"replies":[{"id":126852,"content":"pktBody[:8] å’Œ pktBody[0:8] æ˜¯ç­‰ä»·çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1654762919,"ip_address":"","comment_id":347966,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100093501,"comment_content":"packet.go ä¸­ Submit æ˜ å°„çš„Decodeæ–¹æ³• \nç¬¬äºŒè¡Œä¸­ä½¿ç”¨ s.ID = string(pktBody[:8])  å†™æ³•åœ¨è¿è¡Œclientçš„æ—¶å€™å’Œä¼šå‡ºç° \npanic: runtime error: makeslice: len out of range\nä¿®æ”¹ä¸ºè€å¸ˆgitå½“ä¸­çš„s.ID = string(pktBody[0:8]) åå¯ä»¥æ­£å¸¸è¿è¡Œã€‚ï¼ˆæˆ‘çš„ç¯å¢ƒæ˜¯MacOS12-intelCPUï¼‰\n\næƒ³è¯·æ•™ä¸‹è€å¸ˆè¿™é‡Œçš„ pktBody[:8] å’Œ pktBody[0:8] ä¸æ˜¯ç­‰ä»·çš„å—ï¼Ÿ\n\n&#47;&#47; é™„ä¸Šæ–‡ç« ä¸­çš„ä»£ç \nfunc (s *Submit) Decode(pktBody []byte) error { \n    s.ID = string(pktBody[:8]) \n    s.Payload = pktBody[8:] \n    return nil\n}","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575347,"discussion_content":"pktBody[:8] å’Œ pktBody[0:8] æ˜¯ç­‰ä»·çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654762919,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":343688,"user_name":"$ä¾¯","can_delete":false,"product_type":"c1","uid":1019939,"ip_address":"","ucode":"488B1BD3924E7E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/90/23/5c74e9b7.jpg","comment_is_top":false,"comment_ctime":1650982958,"is_pvip":false,"replies":[{"id":125492,"content":"0x0ã€0x9éƒ½æ˜¯ä»¥16è¿›åˆ¶æ•°è¡¨ç¤ºçš„byteå€¼å•Šã€‚byteæœ¬è´¨ä¸Šå°±æ˜¯uint8(type byte = uint8)ï¼Œä¸€ä¸ªæ•´å‹æ•°è€Œå·²ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":1026224,"ctime":1651049096,"ip_address":"","comment_id":343688,"utype":1}],"discussion_count":3,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"è¯·é—® data := []byte{0x0, 0x0, 0x0, 0x9, &#39;h&#39;, &#39;e&#39;, &#39;l&#39;, &#39;l&#39;, &#39;o&#39;} ä¸­çš„0x0, 0x0, 0x0, 0x9ä»£è¡¨çš„æ˜¯ä»€ä¹ˆæ„æ€","like_count":0},{"had_liked":false,"id":337042,"user_name":"é…’é†’ä½•å¤„","can_delete":false,"product_type":"c1","uid":2839701,"ip_address":"","ucode":"2F890DD0BEB0F0","user_header":"","comment_is_top":false,"comment_ctime":1646563726,"is_pvip":false,"replies":[{"id":123240,"content":"çœ‹çš„çœŸç»†è‡´ï¼ğŸ‘ æ„Ÿè°¢æŒ‡å‡ºç¬”è¯¯ï¼Œåç»­è®©ç¼–è¾‘è€å¸ˆæ”¹ä¸€ä¸‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1646722894,"ip_address":"","comment_id":337042,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"CommandConnAck = iota + 0x80 &#47;&#47; 0x81ï¼Œè¿æ¥è¯·æ±‚çš„å“åº”åŒ…\nè¿™å„¿åº”è¯¥æ˜¯ï¼š\nCommandConnAck = iota + 0x81 &#47;&#47; 0x81ï¼Œè¿æ¥è¯·æ±‚çš„å“åº”åŒ…","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568037,"discussion_content":"0x0ã€0x9éƒ½æ˜¯ä»¥16è¿›åˆ¶æ•°è¡¨ç¤ºçš„byteå€¼å•Šã€‚byteæœ¬è´¨ä¸Šå°±æ˜¯uint8(type byte = uint8)ï¼Œä¸€ä¸ªæ•´å‹æ•°è€Œå·²ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651049096,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2839499,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/qCv5IcP1lkO2jicrTic9KicycZXZ7WylG49GZHJCibuFQfBlJMsCpVHARuaLxIB23f3enRL4ls6EOr9wxu40K0Hl8Q/132","nickname":"tcyi","note":"","ucode":"043F49F99D7037","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":625794,"discussion_content":"æˆ‘ä¹Ÿæœ‰è¿™ä¸ªç–‘é—®ï¼Œè°ƒç”¨codec.Encode(rw, []byte(&#34;hello&#34;))ï¼Œæˆ‘è¾“å‡ºfmt.Println(rw.Bytes()) æ‰“å°çš„æ˜¯ [0 0 0 9 104 101 108 108 111]","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1692192767,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1019939,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/23/5c74e9b7.jpg","nickname":"$ä¾¯","note":"","ucode":"488B1BD3924E7E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568390,"discussion_content":"å•Šï¼Œæˆ‘çš„æ„æ€æ˜¯è¿™é‡Œä¸ºå•¥è¦å å››ä¸ªå€¼ï¼Œæ˜¯å› ä¸ºéœ€è¦åŠ ä¸ŠtotalLengthè‡ªèº«çš„4ä¸ªå­—èŠ‚å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651124824,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":336552,"user_name":"é¡·","can_delete":false,"product_type":"c1","uid":1132878,"ip_address":"","ucode":"096B6859C1FA80","user_header":"https://static001.geekbang.org/account/avatar/00/11/49/4e/8798cd01.jpg","comment_is_top":false,"comment_ctime":1646210283,"is_pvip":true,"replies":[{"id":123105,"content":"Makefileåœ¨æœ¬ä¸“æ ä¸­ä¸ä¼šå±•å¼€è¯´äº†ã€‚ä¸€æ–¹é¢ï¼ŒMakefileä¸Goå¹¶éç´§è€¦åˆï¼Œä¹Ÿå¹¶éå¿…é¡»ï¼Œåªæ˜¯æ„å»ºè¾…åŠ©å·¥å…·çš„ä¸€ç§ã€‚å¦ä¸€æ–¹é¢ï¼Œæœ¬ä¸“æ ä¸­ä½¿ç”¨çš„Makefileçš„å†…å®¹éƒ½æ˜¯æœ€ç®€å•çš„ï¼Œä¸€èˆ¬åªæœ‰ä¸€ä¸ªtargetï¼Œå®¹æ˜“ç†è§£ï¼Œä¸éœ€è¦å±•å¼€å¤§å®¶åº”è¯¥éƒ½èƒ½ç†è§£ã€‚\n\nå­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œæœ‰æœ‰å…³makefileçš„é—®é¢˜ï¼Œå¯ä»¥åœ¨ç•™è¨€åŒºæå‡ºï¼Œæˆ‘å°½åŠ›è§£ç­”ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":1026224,"ctime":1646469688,"ip_address":"","comment_id":336552,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"è€å¸ˆï¼ŒMakefileçš„ç›¸å…³çŸ¥è¯†è€ƒè™‘åœ¨åŠ é¤è¦è¯´ä¸‹å—","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555022,"discussion_content":"çœ‹çš„çœŸç»†è‡´ï¼ğŸ‘ æ„Ÿè°¢æŒ‡å‡ºç¬”è¯¯ï¼Œåç»­è®©ç¼–è¾‘è€å¸ˆæ”¹ä¸€ä¸‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646722894,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332417,"user_name":"é™ˆä¸œ","can_delete":false,"product_type":"c1","uid":2213995,"ip_address":"","ucode":"FCDE6D237CC621","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Ge7uhlEVxicQT73YuomDPrVKI8UmhqxKWrhtO5GMNlFjrHWfd3HAjgaSribR4Pzorw8yalYGYqJI4VPvUyPzicSKg/132","comment_is_top":false,"comment_ctime":1643242454,"is_pvip":true,"replies":[{"id":121504,"content":"è¿™ä¸ªéœ€è¦åç»­å’Œç¼–è¾‘è€å¸ˆå•†é‡ä¸€ä¸‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1643361383,"ip_address":"","comment_id":332417,"utype":1}],"discussion_count":2,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"è€å¸ˆèƒ½åŠ é¤ä¸€èŠ‚å•å…ƒæµ‹è¯•å—ï¼ŸæŸ¥å¾ˆå¤šèµ„æ–™ï¼Œæ²¡æœ‰å­¦åˆ°æµ‹è¯•çš„å…¥é—¨ã€‚è°¢è°¢ã€‚","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554567,"discussion_content":"Makefileåœ¨æœ¬ä¸“æ ä¸­ä¸ä¼šå±•å¼€è¯´äº†ã€‚ä¸€æ–¹é¢ï¼ŒMakefileä¸Goå¹¶éç´§è€¦åˆï¼Œä¹Ÿå¹¶éå¿…é¡»ï¼Œåªæ˜¯æ„å»ºè¾…åŠ©å·¥å…·çš„ä¸€ç§ã€‚å¦ä¸€æ–¹é¢ï¼Œæœ¬ä¸“æ ä¸­ä½¿ç”¨çš„Makefileçš„å†…å®¹éƒ½æ˜¯æœ€ç®€å•çš„ï¼Œä¸€èˆ¬åªæœ‰ä¸€ä¸ªtargetï¼Œå®¹æ˜“ç†è§£ï¼Œä¸éœ€è¦å±•å¼€å¤§å®¶åº”è¯¥éƒ½èƒ½ç†è§£ã€‚\n\nå­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œæœ‰æœ‰å…³makefileçš„é—®é¢˜ï¼Œå¯ä»¥åœ¨ç•™è¨€åŒºæå‡ºï¼Œæˆ‘å°½åŠ›è§£ç­”ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646469688,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":343688,"user_name":"$ä¾¯","can_delete":false,"product_type":"c1","uid":1019939,"ip_address":"","ucode":"488B1BD3924E7E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/90/23/5c74e9b7.jpg","comment_is_top":false,"comment_ctime":1650982958,"is_pvip":false,"replies":[{"id":125492,"content":"0x0ã€0x9éƒ½æ˜¯ä»¥16è¿›åˆ¶æ•°è¡¨ç¤ºçš„byteå€¼å•Šã€‚byteæœ¬è´¨ä¸Šå°±æ˜¯uint8(type byte = uint8)ï¼Œä¸€ä¸ªæ•´å‹æ•°è€Œå·²ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":1026224,"ctime":1651049096,"ip_address":"","comment_id":343688,"utype":1}],"discussion_count":3,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"è¯·é—® data := []byte{0x0, 0x0, 0x0, 0x9, &#39;h&#39;, &#39;e&#39;, &#39;l&#39;, &#39;l&#39;, &#39;o&#39;} ä¸­çš„0x0, 0x0, 0x0, 0x9ä»£è¡¨çš„æ˜¯ä»€ä¹ˆæ„æ€","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568037,"discussion_content":"0x0ã€0x9éƒ½æ˜¯ä»¥16è¿›åˆ¶æ•°è¡¨ç¤ºçš„byteå€¼å•Šã€‚byteæœ¬è´¨ä¸Šå°±æ˜¯uint8(type byte = uint8)ï¼Œä¸€ä¸ªæ•´å‹æ•°è€Œå·²ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651049096,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2839499,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/qCv5IcP1lkO2jicrTic9KicycZXZ7WylG49GZHJCibuFQfBlJMsCpVHARuaLxIB23f3enRL4ls6EOr9wxu40K0Hl8Q/132","nickname":"tcyi","note":"","ucode":"043F49F99D7037","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":625794,"discussion_content":"æˆ‘ä¹Ÿæœ‰è¿™ä¸ªç–‘é—®ï¼Œè°ƒç”¨codec.Encode(rw, []byte(&#34;hello&#34;))ï¼Œæˆ‘è¾“å‡ºfmt.Println(rw.Bytes()) æ‰“å°çš„æ˜¯ [0 0 0 9 104 101 108 108 111]","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1692192767,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1019939,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/90/23/5c74e9b7.jpg","nickname":"$ä¾¯","note":"","ucode":"488B1BD3924E7E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":568390,"discussion_content":"å•Šï¼Œæˆ‘çš„æ„æ€æ˜¯è¿™é‡Œä¸ºå•¥è¦å å››ä¸ªå€¼ï¼Œæ˜¯å› ä¸ºéœ€è¦åŠ ä¸ŠtotalLengthè‡ªèº«çš„4ä¸ªå­—èŠ‚å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651124824,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337042,"user_name":"é…’é†’ä½•å¤„","can_delete":false,"product_type":"c1","uid":2839701,"ip_address":"","ucode":"2F890DD0BEB0F0","user_header":"","comment_is_top":false,"comment_ctime":1646563726,"is_pvip":false,"replies":[{"id":123240,"content":"çœ‹çš„çœŸç»†è‡´ï¼ğŸ‘ æ„Ÿè°¢æŒ‡å‡ºç¬”è¯¯ï¼Œåç»­è®©ç¼–è¾‘è€å¸ˆæ”¹ä¸€ä¸‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1646722894,"ip_address":"","comment_id":337042,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"CommandConnAck = iota + 0x80 &#47;&#47; 0x81ï¼Œè¿æ¥è¯·æ±‚çš„å“åº”åŒ…\nè¿™å„¿åº”è¯¥æ˜¯ï¼š\nCommandConnAck = iota + 0x81 &#47;&#47; 0x81ï¼Œè¿æ¥è¯·æ±‚çš„å“åº”åŒ…","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555022,"discussion_content":"çœ‹çš„çœŸç»†è‡´ï¼ğŸ‘ æ„Ÿè°¢æŒ‡å‡ºç¬”è¯¯ï¼Œåç»­è®©ç¼–è¾‘è€å¸ˆæ”¹ä¸€ä¸‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646722894,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":336552,"user_name":"é¡·","can_delete":false,"product_type":"c1","uid":1132878,"ip_address":"","ucode":"096B6859C1FA80","user_header":"https://static001.geekbang.org/account/avatar/00/11/49/4e/8798cd01.jpg","comment_is_top":false,"comment_ctime":1646210283,"is_pvip":true,"replies":[{"id":123105,"content":"Makefileåœ¨æœ¬ä¸“æ ä¸­ä¸ä¼šå±•å¼€è¯´äº†ã€‚ä¸€æ–¹é¢ï¼ŒMakefileä¸Goå¹¶éç´§è€¦åˆï¼Œä¹Ÿå¹¶éå¿…é¡»ï¼Œåªæ˜¯æ„å»ºè¾…åŠ©å·¥å…·çš„ä¸€ç§ã€‚å¦ä¸€æ–¹é¢ï¼Œæœ¬ä¸“æ ä¸­ä½¿ç”¨çš„Makefileçš„å†…å®¹éƒ½æ˜¯æœ€ç®€å•çš„ï¼Œä¸€èˆ¬åªæœ‰ä¸€ä¸ªtargetï¼Œå®¹æ˜“ç†è§£ï¼Œä¸éœ€è¦å±•å¼€å¤§å®¶åº”è¯¥éƒ½èƒ½ç†è§£ã€‚\n\nå­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œæœ‰æœ‰å…³makefileçš„é—®é¢˜ï¼Œå¯ä»¥åœ¨ç•™è¨€åŒºæå‡ºï¼Œæˆ‘å°½åŠ›è§£ç­”ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":1026224,"ctime":1646469688,"ip_address":"","comment_id":336552,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"è€å¸ˆï¼ŒMakefileçš„ç›¸å…³çŸ¥è¯†è€ƒè™‘åœ¨åŠ é¤è¦è¯´ä¸‹å—","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554567,"discussion_content":"Makefileåœ¨æœ¬ä¸“æ ä¸­ä¸ä¼šå±•å¼€è¯´äº†ã€‚ä¸€æ–¹é¢ï¼ŒMakefileä¸Goå¹¶éç´§è€¦åˆï¼Œä¹Ÿå¹¶éå¿…é¡»ï¼Œåªæ˜¯æ„å»ºè¾…åŠ©å·¥å…·çš„ä¸€ç§ã€‚å¦ä¸€æ–¹é¢ï¼Œæœ¬ä¸“æ ä¸­ä½¿ç”¨çš„Makefileçš„å†…å®¹éƒ½æ˜¯æœ€ç®€å•çš„ï¼Œä¸€èˆ¬åªæœ‰ä¸€ä¸ªtargetï¼Œå®¹æ˜“ç†è§£ï¼Œä¸éœ€è¦å±•å¼€å¤§å®¶åº”è¯¥éƒ½èƒ½ç†è§£ã€‚\n\nå­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œæœ‰æœ‰å…³makefileçš„é—®é¢˜ï¼Œå¯ä»¥åœ¨ç•™è¨€åŒºæå‡ºï¼Œæˆ‘å°½åŠ›è§£ç­”ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646469688,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332417,"user_name":"é™ˆä¸œ","can_delete":false,"product_type":"c1","uid":2213995,"ip_address":"","ucode":"FCDE6D237CC621","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Ge7uhlEVxicQT73YuomDPrVKI8UmhqxKWrhtO5GMNlFjrHWfd3HAjgaSribR4Pzorw8yalYGYqJI4VPvUyPzicSKg/132","comment_is_top":false,"comment_ctime":1643242454,"is_pvip":true,"replies":[{"id":121504,"content":"è¿™ä¸ªéœ€è¦åç»­å’Œç¼–è¾‘è€å¸ˆå•†é‡ä¸€ä¸‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1026224,"ctime":1643361383,"ip_address":"","comment_id":332417,"utype":1}],"discussion_count":2,"race_medal":0,"score":4,"product_id":100093501,"comment_content":"è€å¸ˆèƒ½åŠ é¤ä¸€èŠ‚å•å…ƒæµ‹è¯•å—ï¼ŸæŸ¥å¾ˆå¤šèµ„æ–™ï¼Œæ²¡æœ‰å­¦åˆ°æµ‹è¯•çš„å…¥é—¨ã€‚è°¢è°¢ã€‚","like_count":0,"discussions":[{"author":{"id":1026224,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/b0/6f87ab08.jpg","nickname":"Tony Bai","note":"","ucode":"B6B08985F6FA89","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548771,"discussion_content":"è¿™ä¸ªéœ€è¦åç»­å’Œç¼–è¾‘è€å¸ˆå•†é‡ä¸€ä¸‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643361384,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1121758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","nickname":"aoe","note":"","ucode":"1C6201EDB4E954","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550925,"discussion_content":"å…³äºå•å…ƒæµ‹è¯•çš„å…¥é—¨æ¨èå­¦ä¹ éƒ‘æ™”è€å¸ˆåœ¨æå®¢æ—¶é—´çš„3ä¸ªä¸“æ ï¼ˆå­¦ä¹ å¦‚ä½•å†™å¯¹æµ‹è¯•å‹å¥½çš„ä»£ç ï¼‰\n1. è½¯ä»¶è®¾è®¡ä¹‹ç¾\n2. ä»£ç ä¹‹ä¸‘\n3. ç¨‹åºå‘˜çš„æµ‹è¯•è¯¾\nä¸“æ ä¸­è€å¸ˆæ¨èäº†éå¸¸å¥½çš„ä¹¦ç±ï¼š\nã€Šä»£ç æ•´æ´ä¹‹é“ã€‹\nã€Šä¿®æ”¹ä»£ç çš„è‰ºæœ¯ã€‹\nå­¦ä¹  TDD æ—¶è¿˜å¯ä»¥å‚è€ƒè¿™ä¸¤æœ¬ä¹¦\nã€ŠJava æµ‹è¯•é©±åŠ¨å¼€å‘ã€‹\nã€Šæµ‹è¯•é©±åŠ¨å¼€å‘çš„è‰ºæœ¯ã€‹\n\næç¤ºï¼šæ³¨æ„åŒºåˆ†å•å…ƒæµ‹è¯•ä¸é›†æˆæµ‹è¯•\nå­˜åœ¨ä»¥ä¸‹ä»»ä½•ä¸€ä¸ªæƒ…å½¢éƒ½ä¸æ˜¯å•å…ƒæµ‹è¯•ï¼šï¼ˆè§ã€Šä¿®æ”¹ä»£ç çš„è‰ºæœ¯ã€‹ï¼‰\n\nè®¿é—®äº†æ•°æ®åº“\næœ‰ç½‘ç»œé€šä¿¡\nè®¿é—®äº†æ–‡ä»¶ç³»ç»Ÿ\nä¸ä¸å…¶ä»–ä»»ä½•å•å…ƒæµ‹è¯•åŒæ—¶è¿è¡Œ\nå¿…é¡»é…ç½®å¥½ç¯å¢ƒåæ‰èƒ½è¿è¡Œ\n\nâ€”â€”ã€Šæµ‹è¯•é©±åŠ¨å¼€å‘çš„è‰ºæœ¯ã€‹","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1644814118,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}