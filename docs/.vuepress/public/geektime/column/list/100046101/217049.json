{"id":217049,"title":"19 | åŸºäºRaftçš„åˆ†å¸ƒå¼KVç³»ç»Ÿå¼€å‘å®æˆ˜ï¼ˆä¸€ï¼‰ï¼šå¦‚ä½•è®¾è®¡æ¶æ„ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯éŸ©å¥ã€‚</p><p>å­¦å®Œå‰é¢2è®²ä¹‹åï¼Œç›¸ä¿¡ä½ å·²ç»å¤§è‡´äº†è§£äº†Raftç®—æ³•çš„ä»£ç å®ç°ï¼ˆHashcorp Raftï¼‰ï¼Œä¹ŸæŒæ¡äº†å¸¸ç”¨APIæ¥å£çš„ç”¨æ³•ï¼Œå¯¹Raftç®—æ³•çš„ç†è§£ä¹Ÿæ›´æ·±åˆ»äº†ã€‚é‚£ä¹ˆï¼Œæ˜¯ä¸æ˜¯æŒæ¡è¿™äº›ï¼Œå°±èƒ½å¾—å¿ƒåº”æ‰‹çš„å¤„ç†å®é™…åœºæ™¯çš„é—®é¢˜äº†å‘¢ï¼Ÿ</p><p>åœ¨æˆ‘çœ‹æ¥ï¼ŒæŒæ¡çš„è¿˜ä¸å¤Ÿï¼Œå› ä¸ºRaftç®—æ³•çš„å®ç°åªæ˜¯å·¥å…·ã€‚è€ŒæŒæ¡äº†å·¥å…·çš„ç”¨æ³•ï¼Œå’Œèƒ½ä½¿ç”¨å·¥å…·å¾—å¿ƒåº”æ‰‹åœ°å¤„ç†å®é™…åœºæ™¯çš„é—®é¢˜ï¼Œæ˜¯ä¸¤å›äº‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æŒæ¡ä½¿ç”¨Raftç®—æ³•å¼€å‘åˆ†å¸ƒå¼ç³»ç»Ÿçš„å®æˆ˜èƒ½åŠ›ï¼Œç„¶åæ‰èƒ½æ¸¸åˆƒæœ‰ä½™çš„å¤„ç†å®é™…åœºæ™¯çš„é—®é¢˜ã€‚</p><p>æˆ‘ä»è¿™ä¸ªè§’åº¦å‡ºå‘ï¼Œåœ¨æ¥ä¸‹æ¥çš„2èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä¼šåˆ†åˆ«ä»æ¶æ„å’Œä»£ç å®ç°çš„è§’åº¦ï¼Œä»¥ä¸€ä¸ªåŸºæœ¬çš„åˆ†å¸ƒå¼KVç³»ç»Ÿä¸ºä¾‹ï¼Œå…·ä½“è¯´ä¸€è¯´ï¼Œå¦‚ä½•åŸºäºRaftç®—æ³•æ„å»ºä¸€ä¸ªåˆ†å¸ƒå¼KVç³»ç»Ÿã€‚<strong>é‚£ä¹ˆæˆ‘å¸Œæœ›ä½ èƒ½è¯¾ä¸‹å¤šåŠ¨æ‰‹ï¼Œè‡ªå·±å†™ä¸€éï¼Œä¸ç»™è‡ªå·±ç•™ä¸‹ç›²åŒºã€‚</strong>å¦‚æœæ¡ä»¶å…è®¸çš„è¯ï¼Œä½ è¿˜å¯ä»¥æŒ‰éœ€å¼€å‘å®ç°éœ€è¦çš„åŠŸèƒ½ï¼Œå¹¶å°†è¿™å¥—ç³»ç»Ÿä½œä¸ºè‡ªå·±çš„â€œé…ç½®ä¸­å¿ƒâ€â€œåå­—è·¯ç”±â€ç»´æŠ¤ä¸‹å»ï¼Œä¸æ–­åœ¨å®æˆ˜ä¸­åŠ æ·±è‡ªå·±å¯¹æŠ€æœ¯çš„ç†è§£ã€‚</p><p>å¯èƒ½æœ‰åŒå­¦ä¼šé—®ï¼šâ€œè€éŸ©ï¼Œä¸ºä»€ä¹ˆä¸ä»¥Etcdä¸ºä¾‹å‘¢ï¼Ÿå®ƒä¸æ˜¯å·²ç»åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è½åœ°äº†å—ï¼Ÿâ€</p><p>æˆ‘æ˜¯è¿™ä¹ˆè€ƒè™‘çš„ï¼Œè¿™ä¸ªåŸºæœ¬çš„åˆ†å¸ƒå¼KVç³»ç»Ÿçš„ä»£ç æ¯”è¾ƒå°‘ï¼Œç›¸å¯¹çº¯ç²¹èšç„¦åœ¨æŠ€æœ¯æœ¬èº«ï¼Œæ¶‰åŠçš„KVä¸šåŠ¡å±‚é¢çš„é€»è¾‘å°‘ï¼Œé€‚åˆå…¥é—¨å­¦ä¹ ï¼ˆæ¯”å¦‚ä½ å¯ä»¥ä»é›¶å¼€å§‹ï¼ŒåŠ¨æ‰‹ç¼–ç¨‹å®ç°ï¼‰ï¼Œæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å­¦ä¹ æ¡ˆä¾‹ã€‚</p><!-- [[[read_end]]] --><p>å¦å¤–ï¼Œå¯¹ä¸€äº›æœ‰ç»éªŒçš„å¼€å‘è€…æ¥è¯´ï¼Œè¿™éƒ¨åˆ†çŸ¥è¯†èƒ½å¤Ÿå¸®åŠ©ä½ æŒæ¡Raftç®—æ³•ä¸­ï¼Œä¸€äº›æ·±å±‚æ¬¡çš„æŠ€æœ¯å®ç°ï¼Œæ¯”å¦‚å¦‚ä½•å®ç°å¤šç§è¯»ä¸€è‡´æ€§æ¨¡å‹ï¼Œè®©ä½ æ›´åŠ æ·±åˆ»åœ°ç†è§£Raftç®—æ³•ã€‚</p><p>ä»Šå¤©è¿™èŠ‚è¯¾ï¼Œæˆ‘ä¼šå…·ä½“è¯´ä¸€è¯´å¦‚ä½•è®¾è®¡ä¸€ä¸ªåŸºæœ¬çš„åˆ†å¸ƒå¼KVç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯éœ€è¦å®ç°å“ªäº›åŠŸèƒ½ï¼Œä»¥åŠåœ¨æ¶æ„è®¾è®¡çš„æ—¶å€™ï¼Œä½ éœ€è¦è€ƒè™‘å“ªäº›ç‚¹ï¼ˆæ¯”å¦‚è·Ÿéšè€…æ˜¯å¦è¦è½¬å‘å†™è¯·æ±‚ç»™é¢†å¯¼è€…ï¼Ÿæˆ–è€…å¦‚ä½•è®¾è®¡æ¥å…¥è®¿é—®çš„APIï¼Ÿï¼‰</p><p>å¥½äº†ï¼Œè¯ä¸å¤šè¯´ï¼Œä¸€èµ·è¿›å…¥ä»Šå¤©çš„è¯¾ç¨‹å§ï¼</p><p>åœ¨æˆ‘çœ‹æ¥ï¼ŒåŸºäºæŠ€æœ¯æ·±åº¦ã€å¼€å‘å·¥ä½œé‡ã€å­¦ä¹ å¤æ‚åº¦ç­‰ç»¼åˆè€ƒè™‘ï¼Œä¸€ä¸ªåŸºæœ¬çš„åˆ†å¸ƒå¼KVç³»ç»Ÿï¼Œè‡³å°‘éœ€è¦å…·å¤‡è¿™æ ·å‡ å—åŠŸèƒ½ï¼Œå°±åƒä¸‹å›¾çš„æ ·å­ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/1e/6d/1e8e7cac5c9159aa1dbf9a72cd90416d.jpg?wh=1142*483\" alt=\"\"></p><ul>\n<li>æ¥å…¥åè®®ï¼šä¾›å®¢æˆ·ç«¯è®¿é—®ç³»ç»Ÿçš„æ¥å…¥å±‚APIï¼Œä»¥åŠä¸å®¢æˆ·ç«¯äº¤äº’çš„é€šè®¯åè®®ã€‚</li>\n<li>KVæ“ä½œï¼šæˆ‘ä»¬éœ€è¦æ”¯æŒçš„KVæ“ä½œï¼ˆæ¯”å¦‚èµ‹å€¼æ“ä½œï¼‰ã€‚</li>\n<li>åˆ†å¸ƒå¼é›†ç¾¤ï¼šä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è¦åŸºäºRaftç®—æ³•å®ç°ä¸€ä¸ªåˆ†å¸ƒå¼å­˜å‚¨é›†ç¾¤ï¼Œç”¨äºå­˜æ”¾KVæ•°æ®ã€‚</li>\n</ul><p>éœ€è¦ä½ æ³¨æ„çš„æ˜¯ï¼Œè¿™3ç‚¹å°±æ˜¯åˆ†å¸ƒå¼KVç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦ç¼–ç¨‹å®ç°çš„éœ€æ±‚ã€‚</p><p>åœ¨æˆ‘çœ‹æ¥ï¼Œè¦å®ç°ä¸€ä¸ªåŸºæœ¬çš„åˆ†å¸ƒå¼KVç³»ç»Ÿï¼Œé¦–å…ˆè¦åšçš„ç¬¬ä¸€ä»¶äº‹ï¼Œå°±æ˜¯å®ç°è®¿é—®æ¥å…¥çš„é€šè®¯åè®®ã€‚å› ä¸ºå¦‚æœç”¨æˆ·æƒ³ä½¿ç”¨è¿™å¥—ç³»ç»Ÿï¼Œå¯¹ä»–è€Œè¨€çš„ç¬¬ä¸€ä»¶äº‹ï¼Œå°±æ˜¯å¦‚ä½•è®¿é—®è¿™å¥—ç³»ç»Ÿã€‚é‚£ä¹ˆï¼Œå¦‚ä½•å®ç°è®¿é—®æ¥å…¥çš„é€šè®¯åè®®å‘¢ï¼Ÿ</p><h2>å¦‚ä½•è®¾è®¡æ¥å…¥åè®®ï¼Ÿ</h2><p>æˆ‘æƒ³è¯´çš„æ˜¯ï¼Œåœ¨æ—©äº›æ—¶å€™ï¼Œç¡¬ä»¶æ€§èƒ½ä½ï¼ŒæœåŠ¡ä¹Ÿä¸æ˜¯å¾ˆå¤šï¼Œå¼€å‘ç³»ç»Ÿçš„æ—¶å€™ï¼Œä¸»è¦çŸ›ç›¾æ˜¯æ€§èƒ½ç“¶é¢ˆï¼Œæ‰€ä»¥ï¼Œæ›´å¤šçš„æ˜¯åŸºäºæ€§èƒ½çš„è€ƒè™‘ï¼Œé‡‡ç”¨UDPåè®®å’Œå®ç°ç§æœ‰çš„äºŒè¿›åˆ¶åè®®ï¼Œæ¯”å¦‚ï¼Œæ—©æœŸçš„QQåå°ç»„ä»¶ï¼Œå°±æ˜¯è¿™ä¹ˆåšçš„ã€‚</p><p>ç°åœ¨å‘¢ï¼Œç¡¬ä»¶æ€§èƒ½æœ‰äº†å¾ˆå¤§å¹…åº¦çš„æå‡ï¼Œåå°æœåŠ¡å™¨çš„CPUæ ¸æ•°éƒ½è¿‘ç™¾äº†ï¼Œå¼€å‘ç³»ç»Ÿçš„æ—¶å€™ï¼Œä¸»è¦çš„çŸ›ç›¾å·²ç»ä¸æ˜¯æ€§èƒ½ç“¶é¢ˆäº†ï¼Œè€Œæ˜¯å¿«é€Ÿå¢é•¿çš„æµ·é‡æœåŠ¡å’Œå¼€å‘æ•ˆç‡ï¼Œæ‰€ä»¥è¿™æ—¶ï¼ŒåŸºäºå¼€å‘æ•ˆç‡å’Œå¯ç»´æŠ¤æ€§çš„è€ƒè™‘ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¼˜å…ˆè€ƒè™‘æ ‡å‡†çš„åè®®äº†ï¼ˆæ¯”å¦‚HTTPï¼‰ã€‚</p><p>å¦‚æœä½¿ç”¨HTTPåè®®ï¼Œé‚£ä¹ˆå°±éœ€è¦è®¾è®¡HTTP RESTful APIï¼Œä½œä¸ºè®¿é—®æ¥å£ã€‚å…·ä½“æ€ä¹ˆè®¾è®¡å‘¢ï¼Ÿ</p><p>æˆ‘æƒ³è¯´çš„æ˜¯ï¼Œå› ä¸ºæˆ‘ä»¬è®¾è®¡å®ç°çš„æ˜¯KVç³»ç»Ÿï¼Œè‚¯å®šè¦æ¶‰åŠåˆ°KVæ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¸€å®šéœ€è¦è®¾è®¡ä¸ªAPIï¼ˆæ¯”å¦‚\"/key\"ï¼‰æ¥æ”¯æŒKVæ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œé€šè¿‡è®¿é—®è¿™ä¸ªAPIï¼Œæˆ‘ä»¬èƒ½æ‰§è¡Œç›¸å…³çš„KVæ“ä½œäº†ï¼Œå°±åƒä¸‹é¢çš„æ ·å­ï¼ˆæŸ¥è¯¢æŒ‡å®škeyï¼ˆå°±æ˜¯fooï¼‰å¯¹åº”çš„å€¼ï¼‰ã€‚</p><pre><code>curl -XGET http://raft-cluster-host01:8091/key/foo\n</code></pre><p>å¦å¤–ï¼Œéœ€è¦ä½ æ³¨æ„çš„æ˜¯ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªRafté›†ç¾¤ç³»ç»Ÿï¼Œé™¤äº†ä¸šåŠ¡å±‚é¢ï¼ˆKVæ“ä½œï¼‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å®ç°å¹³å°æœ¬èº«çš„ä¸€äº›æ“ä½œçš„APIæ¥å£ï¼Œæ¯”å¦‚å¢åŠ ã€ç§»é™¤é›†ç¾¤èŠ‚ç‚¹ç­‰ã€‚æˆ‘ä»¬ç°åœ¨åªè€ƒè™‘å¢åŠ èŠ‚ç‚¹æ“ä½œçš„APIï¼ˆæ¯”å¦‚\"/join\"ï¼‰ï¼Œå°±åƒä¸‹é¢çš„æ ·å­ã€‚</p><pre><code>http://raft-cluster-host01:8091/join\n</code></pre><p>å¦å¤–ï¼Œåœ¨æ•…éšœæˆ–ç¼©å®¹æƒ…å†µä¸‹ï¼Œå¦‚ä½•æ›¿æ¢èŠ‚ç‚¹ã€ç§»é™¤èŠ‚ç‚¹ï¼Œæˆ‘å»ºè®®ä½ åœ¨çº¿ä¸‹å¯¹æ¯”ç€å¢åŠ èŠ‚ç‚¹çš„æ“ä½œï¼Œè‡ªä¸»å®ç°ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨æˆ‘çœ‹æ¥ï¼Œå®ç°HTTP RESTful APIï¼Œè¿˜æœ‰éå¸¸é‡è¦çš„ä¸€ä»¶äº‹æƒ…è¦åšï¼Œé‚£å°±æ˜¯åœ¨è®¾è®¡APIæ—¶ï¼Œè€ƒè™‘å¦‚ä½•å®ç°è·¯ç”±ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿä½ è¿™ä¹ˆæƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœæˆ‘ä»¬å®ç°äº†å¤šä¸ªAPIï¼Œæ¯”å¦‚\"/key\"å’Œ\"/join\"ï¼Œé‚£ä¹ˆå°±éœ€è¦å°†APIå¯¹åº”çš„è¯·æ±‚å’Œå®ƒå¯¹åº”çš„å¤„ç†å‡½æ•°ä¸€ä¸€æ˜ å°„èµ·æ¥ã€‚</p><p>æˆ‘æƒ³è¯´çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨serveHTTP()å‡½æ•°ï¼ˆGolangï¼‰ä¸­ï¼Œé€šè¿‡æ£€æµ‹URLè·¯å¾„ï¼Œæ¥è®¾ç½®è¯·æ±‚å¯¹åº”å¤„ç†å‡½æ•°ï¼Œå®ç°è·¯ç”±ã€‚å¤§æ¦‚çš„åŸç†ï¼Œå°±åƒä¸‹é¢çš„æ ·å­ã€‚</p><pre><code>func (s *Service) ServeHTTP(w http.ResponseWriter, r *http.Request) {    // è®¾ç½®HTTPè¯·æ±‚å¯¹åº”çš„è·¯ç”±ä¿¡æ¯\n        if strings.HasPrefix(r.URL.Path, &quot;/key&quot;) {\n                s.handleKeyRequest(w, r)\n        } else if r.URL.Path == &quot;/join&quot; {\n                s.handleJoin(w, r)\n        } else {\n                w.WriteHeader(http.StatusNotFound)\n        }\n}\n</code></pre><p>ä»ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå½“æ£€æµ‹åˆ°URLè·¯å¾„ä¸ºâ€œ/keyâ€æ—¶ï¼Œä¼šè°ƒç”¨handleKeyRequest()å‡½æ•°ï¼Œæ¥å¤„ç†KVæ“ä½œè¯·æ±‚ï¼›å½“æ£€æµ‹åˆ°URLè·¯å¾„ä¸º\"/join\"æ—¶ï¼Œä¼šè°ƒç”¨handleJoin()å‡½æ•°ï¼Œå°†æŒ‡å®šèŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­ã€‚</p><p>ä½ çœ‹ï¼Œé€šè¿‡\"/key\"å’Œ\"/join\"2ä¸ªAPIï¼Œæˆ‘ä»¬å°±èƒ½æ»¡è¶³è¿™ä¸ªåŸºæœ¬çš„åˆ†å¸ƒå¼KVç³»ç»Ÿçš„è¿è¡Œè¦æ±‚äº†ï¼Œæ—¢èƒ½æ”¯æŒæ¥è‡ªå®¢æˆ·ç«¯çš„KVæ“ä½œï¼Œä¹Ÿèƒ½æ–°å¢èŠ‚ç‚¹å¹¶å°†é›†ç¾¤è¿è¡Œèµ·æ¥ã€‚</p><p>å½“å®¢æˆ·ç«¯é€šè¿‡é€šè®¯åè®®è®¿é—®åˆ°ç³»ç»Ÿåï¼Œå®ƒæœ€ç»ˆçš„ç›®æ ‡ï¼Œè¿˜æ˜¯æ‰§è¡ŒKVæ“ä½œã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•è®¾è®¡KVæ“ä½œå‘¢ï¼Ÿ</p><h2>å¦‚ä½•è®¾è®¡KVæ“ä½œï¼Ÿ</h2><p>æˆ‘æƒ³è¯´çš„æ˜¯ï¼Œå¸¸è§çš„KVæ“ä½œæ˜¯èµ‹å€¼ã€æŸ¥è¯¢ã€åˆ é™¤ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å®ç°è¿™ä¸‰ä¸ªæ“ä½œå°±å¯ä»¥äº†ï¼Œå…¶ä»–çš„æ“ä½œå¯ä»¥å…ˆä¸è€ƒè™‘ã€‚å…·ä½“å¯ä»¥è¿™ä¹ˆå®ç°ã€‚</p><ul>\n<li><strong>èµ‹å€¼æ“ä½œï¼š</strong>æˆ‘ä»¬å¯ä»¥é€šè¿‡HTTP POSTè¯·æ±‚ï¼Œæ¥å¯¹æŒ‡å®škeyè¿›è¡Œèµ‹å€¼ï¼Œå°±åƒä¸‹é¢çš„æ ·å­ã€‚</li>\n</ul><pre><code>curl -XPOST http://raft-cluster-host01:8091/key -d '{&quot;foo&quot;: &quot;bar&quot;}'\n</code></pre><ul>\n<li><strong>æŸ¥è¯¢æ“ä½œï¼š</strong>æˆ‘ä»¬å¯ä»¥é€šè¿‡HTTP GETè¯·æ±‚ï¼Œæ¥æŸ¥è¯¢æŒ‡å®škeyçš„å€¼ï¼Œå°±åƒä¸‹é¢çš„æ ·å­ã€‚</li>\n</ul><pre><code>curl -XGET http://raft-cluster-host01:8091/key/foo\n\n</code></pre><ul>\n<li><strong>åˆ é™¤æ“ä½œï¼š</strong>æˆ‘ä»¬å¯ä»¥é€šè¿‡HTTP DELETEè¯·æ±‚ï¼Œæ¥åˆ é™¤æŒ‡å®škeyå’Œkeyå¯¹åº”çš„å€¼ï¼Œå°±åƒä¸‹é¢çš„æ ·å­ã€‚</li>\n</ul><pre><code>curl -XDELETE http://raft-cluster-host01:8091/key/foo\n</code></pre><p>åœ¨è¿™é‡Œï¼Œå°¤å…¶éœ€è¦ä½ æ³¨æ„çš„æ˜¯ï¼Œæ“ä½œéœ€è¦å…·æœ‰å¹‚ç­‰æ€§ã€‚å¹‚ç­‰æ€§è¿™ä¸ªè¯å„¿ä½ ä¼°è®¡ä¸ä¼šé™Œç”Ÿï¼Œä½ å¯ä»¥è¿™æ ·ç†è§£å®ƒï¼šåŒä¸€ä¸ªæ“ä½œï¼Œä¸ç®¡æ‰§è¡Œå¤šå°‘æ¬¡ï¼Œæœ€ç»ˆçš„ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯ï¼Œè¿™ä¸ªæ“ä½œæ˜¯å¯ä»¥é‡å¤æ‰§è¡Œçš„ï¼Œè€Œæ˜¯é‡å¤æ‰§è¡Œä¸ä¼šå¯¹ç³»ç»Ÿäº§ç”Ÿé¢„æœŸå¤–çš„å½±å“ã€‚</p><p>ä¸ºä»€ä¹ˆæ“ä½œè¦å…·æœ‰å¹‚ç­‰æ€§å‘¢ï¼Ÿ</p><p>å› ä¸ºå…±è¯†ç®—æ³•èƒ½ä¿è¯è¾¾æˆå…±è¯†åçš„å€¼ï¼ˆä¹Ÿå°±æ˜¯æŒ‡ä»¤ï¼‰å°±ä¸å†æ”¹å˜äº†ï¼Œä½†ä¸èƒ½ä¿è¯å€¼åªè¢«æäº¤ä¸€æ¬¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå…±è¯†ç®—æ³•æ˜¯ä¸€ä¸ªâ€œat least onceâ€çš„æŒ‡ä»¤æ‰§è¡Œæ¨¡å‹ï¼Œæ˜¯å¯èƒ½ä¼šå‡ºç°åŒä¸€ä¸ªæŒ‡ä»¤è¢«é‡å¤æäº¤çš„æƒ…å†µï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¥Raftç®—æ³•ä¸ºä¾‹ï¼Œå…·ä½“è¯´ä¸€è¯´ã€‚</p><p>æ¯”å¦‚ï¼Œå¦‚æœå®¢æˆ·ç«¯æ¥æ”¶åˆ°Raftçš„è¶…æ—¶å“åº”åï¼Œä¹Ÿå°±æ˜¯è¿™æ—¶æ—¥å¿—é¡¹è¿˜æ²¡æœ‰æäº¤æˆåŠŸï¼Œå¦‚æœæ­¤æ—¶å®ƒé‡è¯•ï¼Œå‘é€ä¸€ä¸ªæ–°çš„è¯·æ±‚ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™Raftä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ—¥å¿—é¡¹ï¼Œå¹¶æœ€ç»ˆå°†æ–°æ—§2ä¸ªæ—¥å¿—é¡¹éƒ½æäº¤äº†ï¼Œå‡ºç°äº†æŒ‡ä»¤é‡å¤æ‰§è¡Œçš„æƒ…å†µã€‚</p><p>åœ¨è¿™é‡Œæˆ‘æƒ³å¼ºè°ƒçš„æ˜¯ï¼Œä½ ä¸€å®šè¦æ³¨æ„åˆ°è¿™æ ·çš„æƒ…å†µï¼Œåœ¨ä½¿ç”¨Raftç­‰å…±è¯†ç®—æ³•æ—¶ï¼Œè¦å……åˆ†è¯„ä¼°æ“ä½œæ˜¯å¦å…·æœ‰å¹‚ç­‰æ€§ï¼Œé¿å…å¯¹ç³»ç»Ÿé€ æˆé¢„æœŸå¤–çš„å½±å“ï¼Œæ¯”å¦‚ï¼Œç›´æ¥ä½¿ç”¨â€œAddâ€æ“ä½œï¼Œå°±ä¼šå› é‡å¤æäº¤ï¼Œå¯¼è‡´æœ€ç»ˆçš„æ‰§è¡Œç»“æœä¸å‡†äº†ï¼Œå½±å“åˆ°ä¸šåŠ¡ã€‚è¿™å°±å¯èƒ½ä¼šå‡ºç°ï¼Œç”¨æˆ·è´­ä¹°äº†100Qå¸ï¼Œç³»ç»Ÿå´ç»™ä»–å……å€¼äº†500Qå¸ï¼Œè‚¯å®šä¸è¡Œäº†ã€‚</p><p>è¯´å®Œå¦‚ä½•è®¾è®¡KVæ“ä½œåï¼Œå› ä¸ºæˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡æ˜¯å®ç°åˆ†å¸ƒå¼KVç³»ç»Ÿï¼Œé‚£ä¹ˆï¼Œå°±è®©æˆ‘ä»¬å›åˆ°åˆ†å¸ƒå¼ç³»ç»Ÿæœ€æœ¬æºçš„ä¸€ä¸ªé—®é¢˜ä¸Šï¼Œå¦‚ä½•å®ç°åˆ†å¸ƒå¼é›†ç¾¤ï¼Ÿ</p><h2>å¦‚ä½•å®ç°åˆ†å¸ƒå¼é›†ç¾¤ï¼Ÿ</h2><p>æˆ‘æƒ³è¯´çš„æ˜¯ï¼Œæ­£å¦‚åœ¨09è®²ä¸­æåˆ°çš„ï¼Œæˆ‘æ¨èä½¿ç”¨Raftç®—æ³•å®ç°åˆ†å¸ƒå¼é›†ç¾¤ã€‚è€Œå®ç°ä¸€ä¸ªRafté›†ç¾¤ï¼Œæˆ‘ä»¬é¦–å…ˆè¦è€ƒè™‘çš„æ˜¯å¦‚ä½•åˆ›å»ºé›†ç¾¤ï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬æš‚æ—¶ä¸è€ƒè™‘èŠ‚ç‚¹çš„ç§»é™¤å’Œæ›¿æ¢ç­‰ã€‚</p><p><strong>åˆ›å»ºé›†ç¾¤</strong></p><p>åœ¨Raftç®—æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åˆ›å»ºé›†ç¾¤ã€‚</p><ul>\n<li>å…ˆå°†ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œé€šè¿‡Bootstrapçš„æ–¹å¼å¯åŠ¨ï¼Œå¹¶ä½œä¸ºé¢†å¯¼è€…èŠ‚ç‚¹ã€‚</li>\n<li>å…¶ä»–èŠ‚ç‚¹ä¸é¢†å¯¼è€…èŠ‚ç‚¹é€šè®¯ï¼Œå°†è‡ªå·±çš„é…ç½®ä¿¡æ¯å‘é€ç»™é¢†å¯¼è€…èŠ‚ç‚¹ï¼Œç„¶åé¢†å¯¼è€…èŠ‚ç‚¹è°ƒç”¨AddVoter()å‡½æ•°ï¼Œå°†æ–°èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­ã€‚</li>\n</ul><p>åˆ›å»ºäº†é›†ç¾¤åï¼Œåœ¨é›†ç¾¤è¿è¡Œä¸­ï¼Œå› ä¸ºRafté›†ç¾¤çš„é¢†å¯¼è€…ä¸æ˜¯å›ºå®šä¸å˜çš„ï¼Œè€Œå†™è¯·æ±‚æ˜¯å¿…é¡»è¦åœ¨é¢†å¯¼è€…èŠ‚ç‚¹ä¸Šå¤„ç†çš„ï¼Œé‚£ä¹ˆå¦‚ä½•å®ç°å†™æ“ä½œï¼Œæ¥ä¿è¯å†™è¯·æ±‚éƒ½ä¼šå‘ç»™é¢†å¯¼è€…å‘¢ï¼Ÿ</p><p><strong>å†™æ“ä½œ</strong><br>\nä¸€èˆ¬è€Œè¨€ï¼Œæœ‰2ç§æ–¹æ³•æ¥å®ç°å†™æ“ä½œã€‚æˆ‘æ¥å…·ä½“è¯´è¯´ã€‚</p><p><strong>æ–¹æ³•1ï¼š</strong>è·Ÿéšè€…æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„å†™è¯·æ±‚åï¼Œæ‹’ç»å¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œå¹¶å°†é¢†å¯¼è€…çš„åœ°å€ä¿¡æ¯è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œç„¶åå®¢æˆ·ç«¯ç›´æ¥è®¿é—®é¢†å¯¼è€…èŠ‚ç‚¹ï¼Œç›´åˆ°è¯¥é¢†å¯¼è€…é€€ä½ï¼Œå°±åƒä¸‹å›¾çš„æ ·å­ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/59/c8/591314be65729ae2ca242e5e016e84c8.jpg?wh=1142*515\" alt=\"\"></p><p><strong>æ–¹æ³•2ï¼š</strong>è·Ÿéšè€…æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„å†™è¯·æ±‚åï¼Œå°†å†™è¯·æ±‚è½¬å‘ç»™é¢†å¯¼è€…ï¼Œå¹¶å°†é¢†å¯¼è€…å¤„ç†åçš„ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ—¶è·Ÿéšè€…åœ¨æ‰®æ¼”â€œä»£ç†â€çš„è§’è‰²ï¼Œå°±åƒä¸‹å›¾çš„æ ·å­ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/ac/96/ac7f6e9226c0dc3f323abb70b9a3b596.jpg?wh=1142*398\" alt=\"\"></p><p>åœ¨æˆ‘çœ‹æ¥ï¼Œè™½ç„¶ç¬¬ä¸€ç§æ–¹æ³•éœ€è¦å®¢æˆ·ç«¯çš„é…åˆï¼Œä½†å®ç°èµ·æ¥å¤æ‚åº¦ä¸é«˜ï¼›å¦å¤–ï¼Œç¬¬äºŒç§æ–¹æ³•ï¼Œè™½ç„¶èƒ½é™ä½å®¢æˆ·ç«¯çš„å¤æ‚åº¦ï¼Œå®¢æˆ·ç«¯åƒè®¿é—®ä¸€ä¸ªé»‘ç›’ä¸€æ ·ï¼Œè®¿é—®ç³»ç»Ÿï¼Œå¯¹é¢†å¯¼è€…å˜æ›´å®Œå…¨æ— æ„ŸçŸ¥ã€‚</p><p>ä½†æ˜¯è¿™ä¸ªæ–¹æ³•ä¼šå¼•å…¥ä¸€ä¸ªä¸­é—´èŠ‚ç‚¹ï¼ˆè·Ÿéšè€…ï¼‰ï¼Œå¢åŠ äº†é—®é¢˜åˆ†ææ’æŸ¥çš„å¤æ‚åº¦ã€‚è€Œä¸”ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨ç»å¤§éƒ¨åˆ†çš„æ—¶é—´å†…ï¼ˆæ¯”å¦‚Google Chubbyå›¢é˜Ÿè§‚å¯Ÿåˆ°çš„å€¼æ˜¯æ•°å¤©ï¼‰ï¼Œé¢†å¯¼è€…æ˜¯å¤„äºç¨³å®šçŠ¶æ€çš„ï¼ŒæŸä¸ªèŠ‚ç‚¹ä¸€ç›´æ˜¯é¢†å¯¼è€…ï¼Œé‚£ä¹ˆå¼•å…¥ä¸­é—´èŠ‚ç‚¹ï¼Œå°±ä¼šå¢åŠ å¤§é‡çš„ä¸å¿…è¦çš„æ¶ˆæ¯å’Œæ€§èƒ½æ¶ˆè€—ã€‚æ‰€ä»¥ï¼Œç»¼åˆè€ƒè™‘ï¼Œæˆ‘æ¨èæ–¹æ³•1ã€‚</p><p>å­¦ä¹ äº†Raftç®—æ³•åï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œç›¸æ¯”å†™æ“ä½œï¼ˆåªè¦åœ¨é¢†å¯¼è€…èŠ‚ç‚¹æ‰§è¡Œå°±å¯ä»¥äº†ï¼‰è€Œè¨€ï¼Œè¯»æ“ä½œè¦å¤æ‚äº›ï¼Œå› ä¸ºå¦‚ä½•å®ç°è¯»æ“ä½œï¼Œå…³ä¹ç€ä¸€è‡´æ€§çš„å®ç°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ€ä¹ˆå®ç°è¯»æ“ä½œï¼Œå†³å®šäº†å®¢æˆ·ç«¯æ˜¯å¦ä¼šè¯»å–åˆ°æ—§æ•°æ®ã€‚é‚£ä¹ˆå¦‚ä½•å®ç°è¯»æ“ä½œå‘¢ï¼Ÿ</p><p><strong>è¯»æ“ä½œ</strong><br>\nå…¶å®ï¼Œåœ¨å®é™…ç³»ç»Ÿä¸­ï¼Œå¹¶ä¸æ˜¯å®ç°äº†å¼ºä¸€è‡´æ€§å°±æ˜¯æœ€å¥½çš„ï¼Œå› ä¸ºå®ç°äº†å¼ºä¸€è‡´æ€§ï¼Œå¿…ç„¶ä¼šé™åˆ¶é›†ç¾¤çš„æ•´ä½“æ€§èƒ½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®å®é™…åœºæ™¯ç‰¹ç‚¹è¿›è¡Œæƒè¡¡æŠ˜ä¸­ï¼Œè¿™æ ·ï¼Œæ‰èƒ½è®¾è®¡å‡ºæœ€é€‚åˆè¯¥åœºæ™¯ç‰¹ç‚¹çš„è¯»æ“ä½œã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ç±»ä¼¼Consulçš„3ç§è¯»ä¸€è‡´æ€§æ¨¡å‹ã€‚</p><ul>\n<li>defaultï¼šå¶å°”è¯»åˆ°æ—§æ•°æ®ã€‚</li>\n<li>consistentï¼šä¸€å®šä¸ä¼šè¯»åˆ°æ—§æ•°æ®ã€‚</li>\n<li>staleï¼šä¼šè¯»åˆ°æ—§æ•°æ®ã€‚</li>\n</ul><p>å¦‚æœä½ ä¸è®°å¾—è¿™3ç§æ¨¡å‹çš„å«ä¹‰äº†ï¼Œä½ å¯ä»¥å»09è®²å›é¡¾ä¸‹ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘å°±ä¸å•°å—¦äº†ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°å¤šç§è¯»ä¸€è‡´æ€§æ¨¡å‹ï¼Œå°†æœ€ç»ˆçš„ä¸€è‡´æ€§é€‰æ‹©æƒäº¤ç»™ç”¨æˆ·ï¼Œè®©ç”¨æˆ·å»é€‰æ‹©ï¼Œå°±åƒä¸‹é¢çš„æ ·å­ã€‚</p><pre><code>curl -XGET http://raft-cluster-host02:8091/key/foo?level=consistent  -L\n</code></pre><h2>å†…å®¹å°ç»“</h2><p>æœ¬èŠ‚è¯¾æˆ‘ä¸»è¦å¸¦ä½ äº†è§£äº†ä¸€ä¸ªåŸºæœ¬çš„åˆ†å¸ƒå¼KVç³»ç»Ÿçš„æ¶æ„ï¼Œå’Œéœ€è¦æƒè¡¡æŠ˜ä¸­çš„æŠ€æœ¯ç»†èŠ‚ï¼Œæˆ‘å¸Œæœ›ä½ æ˜ç¡®çš„é‡ç‚¹å¦‚ä¸‹ã€‚</p><p>1.åœ¨è®¾è®¡KVæ“ä½œæ—¶ï¼Œæ›´ç¡®åˆ‡çš„è¯´ï¼Œåœ¨å®ç°RaftæŒ‡ä»¤æ—¶ï¼Œä¸€å®šè¦è€ƒè™‘å¹‚ç­‰æ€§ï¼Œå› ä¸ºRafæŒ‡ä»¤æ˜¯å¯èƒ½ä¼šè¢«é‡å¤æäº¤å’Œæ‰§è¡Œã€‚</p><p>2.æ¨èä½ é‡‡ç”¨è¿™ç§æ–¹å¼æ¥å®ç°å†™æ“ä½œï¼šè·Ÿéšè€…æ¥æ”¶åˆ°å®¢æˆ·ç«¯çš„å†™è¯·æ±‚æ—¶ï¼Œæ‹’ç»è¯¥è¯·æ±‚å¹¶è¿”å›é¢†å¯¼è€…çš„åœ°å€ä¿¡æ¯ç»™å®¢æˆ·ç«¯ï¼Œç„¶åå®¢æˆ·ç«¯ç›´æ¥è®¿é—®é¢†å¯¼è€…ã€‚</p><p>3.åœ¨Rafté›†ç¾¤ä¸­ï¼Œå¦‚ä½•å®ç°è¯»æ“ä½œï¼Œå…³ä¹ä¸€è‡´æ€§çš„å®ç°ï¼Œæ¨èå®ç°defaultã€consistentã€staleä¸‰ç§ä¸€è‡´æ€§æ¨¡å‹ï¼Œå°†ä¸€è‡´æ€§çš„é€‰æ‹©æƒäº¤ç»™ç”¨æˆ·ï¼Œè®©ç”¨æˆ·æ ¹æ®å®é™…ä¸šåŠ¡ç‰¹ç‚¹ï¼ŒæŒ‰éœ€é€‰æ‹©ï¼Œçµæ´»ä½¿ç”¨ã€‚</p><p>æœ€åï¼Œæˆ‘æƒ³è¯´çš„æ˜¯ï¼Œè¿™ä¸ªåŸºæœ¬çš„åˆ†å¸ƒå¼KVç³»ç»Ÿï¼Œé™¤äº†é€‚åˆå…¥é—¨å­¦ä¹ å¤–ï¼Œä¹Ÿæ¯”è¾ƒé€‚åˆé…ç½®ä¸­å¿ƒã€åå­—æœåŠ¡ç­‰å°æ•°æ®é‡çš„ç³»ç»Ÿã€‚å¦å¤–æˆ‘æƒ³è¡¥å……ä¸€ä¸‹ï¼Œå¯¹äºæ•°æ®å±‚ç»„ä»¶ï¼Œä¸ä»…æ€§èƒ½é‡è¦ï¼Œæˆæœ¬ä¹Ÿå¾ˆé‡è¦ï¼Œè€Œå†³å®šæ•°æ®å±‚ç»„ä»¶çš„æˆæœ¬çš„æœ€å…³é”®çš„ä¸€ä¸ªç†å¿µæ˜¯å†·çƒ­åˆ†ç¦»ï¼Œä¸€èˆ¬è€Œè¨€ï¼Œå¯ä»¥è¿™ä¹ˆè®¾è®¡ä¸‰çº§ç¼“å­˜ï¼š</p><ul>\n<li>çƒ­æ•°æ®ï¼šç»å¸¸è¢«è®¿é—®åˆ°çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬æ”¾åœ¨å†…å­˜ä¸­ï¼Œæå‡è®¿é—®æ•ˆç‡ã€‚</li>\n<li>å†·æ•°æ®ï¼šæœ‰æ—¶ä¼šè¢«è®¿é—®åˆ°çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬æ”¾åœ¨SSDç¡¬ç›˜ä¸Šï¼Œè®¿é—®èµ·æ¥ä¹Ÿæ¯”è¾ƒå¿«ã€‚</li>\n<li>é™ˆæ—§æ•°æ®ï¼šå¶å°”ä¼šè¢«è®¿é—®åˆ°çš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒä»¬æ”¾åœ¨æ™®é€šç£ç›˜ä¸Šï¼ŒèŠ‚çœå­˜å‚¨æˆæœ¬ã€‚</li>\n</ul><p>åœ¨å®é™…ç³»ç»Ÿä¸­ï¼Œä½ å¯ä»¥ç»Ÿè®¡çƒ­æ•°æ®çš„å‘½ä¸­ç‡ï¼Œå¹¶æ ¹æ®å‘½ä¸­ç‡æ¥åŠ¨æ€è°ƒæ•´å†·çƒ­æ¨¡å‹ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘æƒ³å¼ºè°ƒçš„æ˜¯ï¼Œå†·çƒ­åˆ†ç¦»ç†å¿µåœ¨è®¾è®¡æµ·é‡æ•°æ®å­˜å‚¨ç³»ç»Ÿæ—¶å°¤ä¸ºé‡è¦ï¼Œæ¯”å¦‚ï¼Œè‡ªç ”KVå­˜å‚¨çš„æˆæœ¬ä»…ä¸ºRedisæ•°ååˆ†ä¹‹ä¸€ï¼Œå…¶ä¸­ç³»ç»Ÿè®¾è®¡æ—¶éå¸¸é‡è¦çš„ä¸€ä¸ªç†å¿µå°±æ˜¯å†·çƒ­åˆ†ç¦»ã€‚å¸Œæœ›ä½ èƒ½é‡è§†è¿™ä¸ªç†å¿µï¼Œåœ¨å®é™…åœºæ™¯ä¸­æ´»å­¦æ´»ç”¨ã€‚</p><h2>è¯¾å ‚æ€è€ƒ</h2><p>æˆ‘æåˆ°äº†å…¶ä»–èŠ‚ç‚¹ä¸é¢†å¯¼è€…èŠ‚ç‚¹é€šè®¯ï¼Œå°†è‡ªå·±çš„é…ç½®ä¿¡æ¯å‘é€ç»™é¢†å¯¼è€…èŠ‚ç‚¹ï¼Œç„¶åé¢†å¯¼è€…èŠ‚ç‚¹è°ƒç”¨addVoter()å‡½æ•°ï¼Œå°†æ–°èŠ‚ç‚¹åŠ å…¥åˆ°é›†ç¾¤ä¸­ï¼Œé‚£ä¹ˆï¼Œä½ ä¸å¦¨æ€è€ƒä¸€ä¸‹ï¼Œå½“èŠ‚ç‚¹æ•…éšœæ—¶ï¼Œå¦‚ä½•æ›¿æ¢ä¸€ä¸ªèŠ‚ç‚¹å‘¢ï¼Ÿæ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„çœ‹æ³•ï¼Œä¸æˆ‘ä¸€åŒè®¨è®ºã€‚</p><p>æœ€åï¼Œæ„Ÿè°¢ä½ çš„é˜…è¯»ï¼Œå¦‚æœè¿™ç¯‡æ–‡ç« è®©ä½ æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿ä½ å°†å®ƒåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ã€‚</p>","neighbors":{"left":{"article_title":"18 | Hashicorp Raftï¼ˆäºŒï¼‰ï¼šå¦‚ä½•ä»¥â€œé›†ç¾¤èŠ‚ç‚¹â€ä¸ºä¸­å¿ƒä½¿ç”¨APIï¼Ÿ","id":215116},"right":{"article_title":"20 | åŸºäºRaftçš„åˆ†å¸ƒå¼KVç³»ç»Ÿå¼€å‘å®æˆ˜ï¼ˆäºŒï¼‰ï¼šå¦‚ä½•å®ç°ä»£ç ï¼Ÿ","id":218093}},"comments":[{"had_liked":false,"id":206942,"user_name":"zzl","can_delete":false,"product_type":"c1","uid":1814781,"ip_address":"","ucode":"B2F2252973E556","user_header":"https://static001.geekbang.org/account/avatar/00/1b/b0/fd/740245c7.jpg","comment_is_top":false,"comment_ctime":1586960654,"is_pvip":false,"replies":[{"id":"77288","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œé—®é¢˜1ï¼Œæ­¤æ—¶è®¿é—®çš„é¢†å¯¼è€…å¯èƒ½ä¸æ˜¯çœŸæ­£çš„é¢†å¯¼è€…ï¼Œæ¯”å¦‚3èŠ‚ç‚¹é›†ç¾¤ï¼ˆAã€Bã€Cï¼‰ï¼ŒAæ˜¯é¢†å¯¼è€…ï¼Œå‘ç”Ÿäº†ç½‘ç»œåˆ†åŒºï¼ŒBã€Cé€‰ä¸¾å‡ºäº†æ–°é¢†å¯¼è€…Cï¼Œå½“æˆ‘ä»¬ç»§ç»­åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œè®¿é—®èŠ‚ç‚¹Aæ—¶ï¼ŒAå¯èƒ½ä»å¤„äºç¨³å®šçŠ¶æ€ï¼ˆåœ¨ leader leasing æ—¶é—´å†…ï¼‰ï¼Œè®¤ä¸ºè‡ªå·±é¢†å¯¼è€…ï¼ˆå…¶å®å®ƒå·²ç»ä¸æ˜¯äº†ï¼‰ï¼Œè¿™æ—¶å®ƒè¿”å›æ•°æ®ç»™å®¢æˆ·ç«¯ï¼Œè¿™ä»½æ•°æ®å¯èƒ½ä¸æ˜¯æœ€æ–°çš„ã€‚é—®é¢˜2ï¼šè¿™ä¸ªè¯´æ³•ä¸ä¸¥è°¨ï¼Œå¿…é¡»ç¡®è®¤ä¸»èŠ‚ç‚¹ä»æ˜¯é¢†å¯¼è€…ï¼Œä½†å› ä¸ºzabä¸æ”¯æŒè¯¥åŠŸèƒ½ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªåšæ³•è½åœ°æ€§å·®ï¼Œå·²ä¿®æ­£ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1586988200,"ip_address":"","comment_id":206942,"utype":1}],"discussion_count":3,"race_medal":0,"score":"61716502798","product_id":100046101,"comment_content":"consulçš„è¯»ä¸€è‡´æ€§defaultæ¨¡å¼ï¼Œæ˜¯ä»leaderèŠ‚ç‚¹è¯»çš„ï¼Œä¸ºå•¥ä¸ä¸€å®šæ˜¯æœ€æ–°æ•°æ®å‘¢ï¼Ÿzookeeperçš„leaderèŠ‚ç‚¹ï¼Œè¯»å–çš„æ•°æ®ä¸€å®šæ˜¯æœ€æ–°çš„å—ï¼Ÿ","like_count":15,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491960,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œé—®é¢˜1ï¼Œæ­¤æ—¶è®¿é—®çš„é¢†å¯¼è€…å¯èƒ½ä¸æ˜¯çœŸæ­£çš„é¢†å¯¼è€…ï¼Œæ¯”å¦‚3èŠ‚ç‚¹é›†ç¾¤ï¼ˆAã€Bã€Cï¼‰ï¼ŒAæ˜¯é¢†å¯¼è€…ï¼Œå‘ç”Ÿäº†ç½‘ç»œåˆ†åŒºï¼ŒBã€Cé€‰ä¸¾å‡ºäº†æ–°é¢†å¯¼è€…Cï¼Œå½“æˆ‘ä»¬ç»§ç»­åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œè®¿é—®èŠ‚ç‚¹Aæ—¶ï¼ŒAå¯èƒ½ä»å¤„äºç¨³å®šçŠ¶æ€ï¼ˆåœ¨ leader leasing æ—¶é—´å†…ï¼‰ï¼Œè®¤ä¸ºè‡ªå·±é¢†å¯¼è€…ï¼ˆå…¶å®å®ƒå·²ç»ä¸æ˜¯äº†ï¼‰ï¼Œè¿™æ—¶å®ƒè¿”å›æ•°æ®ç»™å®¢æˆ·ç«¯ï¼Œè¿™ä»½æ•°æ®å¯èƒ½ä¸æ˜¯æœ€æ–°çš„ã€‚é—®é¢˜2ï¼šè¿™ä¸ªè¯´æ³•ä¸ä¸¥è°¨ï¼Œå¿…é¡»ç¡®è®¤ä¸»èŠ‚ç‚¹ä»æ˜¯é¢†å¯¼è€…ï¼Œä½†å› ä¸ºzabä¸æ”¯æŒè¯¥åŠŸèƒ½ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªåšæ³•è½åœ°æ€§å·®ï¼Œå·²ä¿®æ­£ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586988200,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2733281,"avatar":"","nickname":"Geek_f4512f","note":"","ucode":"3CB387D2943590","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388991,"discussion_content":"æˆ‘æ“¦ è¿˜æœ‰è¿™ç§æƒ…å†µï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µè¯¥å¦‚ä½•æ£€æµ‹å‡ºæ¥å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629085126,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1475385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/83/39/f9623363.jpg","nickname":"ç«¹é©¬å½¦å››éƒçš„å¥½æœ‹å‹å½±æ³•å¸«","note":"","ucode":"A9555AEFF90CDF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":259070,"discussion_content":"è¿˜åœ¨ç§Ÿçº¦å†…ï¼Œæ‰€ä»¥ä»¥ä¸ºè‡ªå·±è¿˜æ˜¯leaderï¼Œå°šæœªé€€ä½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588757538,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":293453,"user_name":"roseduan","can_delete":false,"product_type":"c1","uid":1246451,"ip_address":"","ucode":"5BB69BB9D329EC","user_header":"https://static001.geekbang.org/account/avatar/00/13/04/f3/a3ff8a58.jpg","comment_is_top":false,"comment_ctime":1621392359,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"35981130727","product_id":100046101,"comment_content":"æˆ‘ä½¿ç”¨ Go è¯­è¨€å®ç°äº†ä¸€ä¸ªå•æœºç‰ˆçš„kvæ•°æ®åº“ï¼šhttps:&#47;&#47;github.com&#47;roseduan&#47;rosedbï¼Œåç»­æ”¹é€ ä¸ºåˆ†å¸ƒå¼çš„ï¼Œå¤šè°¢è€å¸ˆçš„æŒ‡ç‚¹ã€‚ä¹Ÿå¸Œæœ›å¤§å®¶ä¸€èµ·æ¥å­¦ä¹ ï¼","like_count":9,"discussions":[{"author":{"id":1200704,"avatar":"https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg","nickname":"pedro","note":"","ucode":"F40C839DDFD599","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375958,"discussion_content":"åœ¨Bç«™çœ‹åˆ°ä½ è§†é¢‘äº†","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1621906365,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2733281,"avatar":"","nickname":"Geek_f4512f","note":"","ucode":"3CB387D2943590","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1200704,"avatar":"https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg","nickname":"pedro","note":"","ucode":"F40C839DDFD599","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388995,"discussion_content":"ç»™ä¸ªé“¾æ¥ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629085489,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":375958,"ip_address":""},"score":388995,"extra":""}]},{"author":{"id":1363671,"avatar":"https://static001.geekbang.org/account/avatar/00/14/ce/d7/5315f6ce.jpg","nickname":"ä¸è´Ÿé’æ˜¥ä¸è´Ÿå·±ğŸ¤˜","note":"","ucode":"A6DD8E8B20EA6E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551521,"discussion_content":"å¤§ä½¬éƒ½å·¥ç¨‹å®è·µäº†å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645033580,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":219856,"user_name":"éª¨æ±¤é¸¡è›‹é¢","can_delete":false,"product_type":"c1","uid":1050002,"ip_address":"","ucode":"2AC141A523E710","user_header":"https://static001.geekbang.org/account/avatar/00/10/05/92/b609f7e3.jpg","comment_is_top":false,"comment_ctime":1590110974,"is_pvip":true,"replies":[{"id":"86973","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œå¯ä»¥è¿™ä¹ˆç†è§£ï¼Œæ›´å‡†ç¡®çš„è¯´ï¼ŒRaftå®ç°çš„æ˜¯ç®—æ³•é€»è¾‘ï¼Œé¢†å¯¼è€…é€‰ä¸¾ã€æ—¥å¿—å¤åˆ¶ã€æˆå‘˜å˜æ›´ç­‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1595042659,"ip_address":"","comment_id":219856,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10180045566","product_id":100046101,"comment_content":"æŒ‰ç…§è€å¸ˆçš„è¡¨è¿°ä»¥åŠå¯¹æºç çš„ç†è§£ï¼Œæ˜¯å¦å¯ä»¥è®¤ä¸º åº”ç”¨å±‚ç»„ä»¶ä¸ raft åº“çš„åˆ†å·¥<br>1. åº”ç”¨å±‚è´Ÿè´£ è®¾è®¡åè®®æ¥å…¥å±‚ä»¥åŠFSM çš„å®ç°ï¼ˆæ¥å…¥å’Œåº•å±‚å­˜å‚¨ï¼‰<br>2. raft è´Ÿè´£æ¥å…¥å±‚å’ŒæŒä¹…åŒ–ä¹‹é—´ï¼ˆraft ä¹Ÿæœ‰logå­˜å‚¨çš„éƒ¨åˆ†ï¼‰","like_count":2,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495966,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œå¯ä»¥è¿™ä¹ˆç†è§£ï¼Œæ›´å‡†ç¡®çš„è¯´ï¼ŒRaftå®ç°çš„æ˜¯ç®—æ³•é€»è¾‘ï¼Œé¢†å¯¼è€…é€‰ä¸¾ã€æ—¥å¿—å¤åˆ¶ã€æˆå‘˜å˜æ›´ç­‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595042659,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":203463,"user_name":"lingjiango","can_delete":false,"product_type":"c1","uid":1876016,"ip_address":"","ucode":"202B67F1AACDAB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoz2e0Ka1CFfMIgZ8XHaVukpJm0Upibh68Wplru5a6zv0SkibM668tVaIGdMjpUHN8wEmiaTVtWgiahKQ/132","comment_is_top":false,"comment_ctime":1586215814,"is_pvip":false,"replies":[{"id":"76170","content":"åŠ ä¸€é¢—æ˜Ÿ:)ã€‚é—®é¢˜1ï¼šå¯ä»¥å®¹å¿å°‘æ•°èŠ‚ç‚¹æ•…éšœï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å°‘æ•°èŠ‚ç‚¹æ•…éšœæ—¶ï¼Œç³»ç»Ÿèƒ½ç¨³å®šè¿è¡Œã€‚é—®é¢˜2ï¼šèŠ‚ç‚¹æ•…éšœï¼Œéœ€è¦æˆ‘ä»¬åšç›‘æ§æ¥å‘ç°ï¼Œç„¶åä¿®å¤çš„ã€‚å¦å¤–ï¼Œå…¶å®ä½ å¯ä»¥é€šè¿‡20è®²çš„raftdbç¨‹åºï¼Œæ¥æµ‹è¯•ä¸‹Raftçš„èŠ‚ç‚¹æ•…éšœå®¹é”™èƒ½åŠ›ï¼Œæ„Ÿæ€§ä½“éªŒä¸‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1586279260,"ip_address":"","comment_id":203463,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5881183110","product_id":100046101,"comment_content":"èŠ‚ç‚¹æ•…éšœåæ˜¯ä¸æ˜¯å¯ä»¥å…ˆå®¹å¿ä¸€éƒ¨åˆ†ï¼Œåœ¨å®¹å¿çš„è¿‡ç¨‹ä¸­æ˜¯ä¸æ˜¯éƒ¨åˆ†èŠ‚ç‚¹åˆæ¢å¤æ­£å¸¸äº†ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490868,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ã€‚é—®é¢˜1ï¼šå¯ä»¥å®¹å¿å°‘æ•°èŠ‚ç‚¹æ•…éšœï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å°‘æ•°èŠ‚ç‚¹æ•…éšœæ—¶ï¼Œç³»ç»Ÿèƒ½ç¨³å®šè¿è¡Œã€‚é—®é¢˜2ï¼šèŠ‚ç‚¹æ•…éšœï¼Œéœ€è¦æˆ‘ä»¬åšç›‘æ§æ¥å‘ç°ï¼Œç„¶åä¿®å¤çš„ã€‚å¦å¤–ï¼Œå…¶å®ä½ å¯ä»¥é€šè¿‡20è®²çš„raftdbç¨‹åºï¼Œæ¥æµ‹è¯•ä¸‹Raftçš„èŠ‚ç‚¹æ•…éšœå®¹é”™èƒ½åŠ›ï¼Œæ„Ÿæ€§ä½“éªŒä¸‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586279260,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":196366,"user_name":"hello","can_delete":false,"product_type":"c1","uid":1464199,"ip_address":"","ucode":"854500026E2187","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKhuGLVRYZibOTfMumk53Wn8Q0Rkg0o6DzTicbibCq42lWQoZ8lFeQvicaXuZa7dYsr9URMrtpXMVDDww/132","comment_is_top":false,"comment_ctime":1585275815,"is_pvip":false,"replies":[{"id":"77781","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œå†·çƒ­çš„æœ¬è´¨åŒºåˆ«æ˜¯è®¿é—®é€Ÿåº¦ï¼Œæ ¹æ®å®é™…åœºæ™¯å¦¥åæƒè¡¡ï¼Œæ¯”å¦‚ï¼Œå¯ä»¥è€ƒè™‘æ•°æ®ç±»å‹ï¼Œå¯¹è®¿é—®æ•ˆç‡è¦æ±‚é«˜çš„ä¸šåŠ¡æ•°æ®ï¼Œå…¨éƒ¨æ˜¯çƒ­æ•°æ®ï¼Œè¦æ±‚ä¸é«˜çš„ï¼Œå†·æ•°æ®ï¼›å¦å¤–å®ç°æ—¶é—´å±€éƒ¨æ€§ï¼Œè®¿é—®åˆ°çš„å†·æ•°æ®ï¼Œåœ¨çƒ­æ•°æ®ä¸­åœç•™äº›æ—¶é—´ï¼Œå†è€åŒ–ï¼Œä¸‹æ²‰ä¸ºå†·æ•°æ®ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1587324574,"ip_address":"","comment_id":196366,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5880243111","product_id":100046101,"comment_content":"è€å¸ˆï¼Œè¯·æ•™æ‚¨ä¸€ä¸ªé—®é¢˜å‘€ï¼Œæ•°æ®çš„å†·çƒ­åˆ†ç¦»ï¼Œæ¯”å¦‚åŸºäºæ—¶é—´çš„æ—¥å¿—æ•°æ®å¯ä»¥æ¯”è¾ƒå¥½åŒºåˆ†ï¼Œå¦‚æœæ²¡æœ‰æ˜æ˜¾æ—¶é—´è·¨åº¦çš„æ•°æ®æœ‰ä»€ä¹ˆå¥½åŠæ³•å®ç°å†·çƒ­åˆ†ç¦»å—ï¼Ÿæˆ–è€…éƒ½æœ‰å“ªäº›å†·çƒ­åˆ†ç¦»çš„ç­–ç•¥å¯ä¾›å‚è€ƒï¼Ÿå¤šè°¢ï¼","like_count":2,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489276,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œå†·çƒ­çš„æœ¬è´¨åŒºåˆ«æ˜¯è®¿é—®é€Ÿåº¦ï¼Œæ ¹æ®å®é™…åœºæ™¯å¦¥åæƒè¡¡ï¼Œæ¯”å¦‚ï¼Œå¯ä»¥è€ƒè™‘æ•°æ®ç±»å‹ï¼Œå¯¹è®¿é—®æ•ˆç‡è¦æ±‚é«˜çš„ä¸šåŠ¡æ•°æ®ï¼Œå…¨éƒ¨æ˜¯çƒ­æ•°æ®ï¼Œè¦æ±‚ä¸é«˜çš„ï¼Œå†·æ•°æ®ï¼›å¦å¤–å®ç°æ—¶é—´å±€éƒ¨æ€§ï¼Œè®¿é—®åˆ°çš„å†·æ•°æ®ï¼Œåœ¨çƒ­æ•°æ®ä¸­åœç•™äº›æ—¶é—´ï¼Œå†è€åŒ–ï¼Œä¸‹æ²‰ä¸ºå†·æ•°æ®ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587324574,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":196258,"user_name":"é˜¿å¡ç‰›","can_delete":false,"product_type":"c1","uid":1022247,"ip_address":"","ucode":"0BC43A904C3199","user_header":"https://static001.geekbang.org/account/avatar/00/0f/99/27/47aa9dea.jpg","comment_is_top":false,"comment_ctime":1585267767,"is_pvip":false,"replies":[{"id":"75557","content":"æ¯”å¦‚redisã€memcachedã€etcdã€zookeeperç­‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1585934932,"ip_address":"","comment_id":196258,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5880235063","product_id":100046101,"comment_content":"ç›®å‰å¸‚é¢ä¸Šæœ‰å“ªäº›æˆç†Ÿå¼€æºçš„åˆ†å¸ƒå¼KVæ¡†æ¶å¯ç›´æ¥ç”¨","like_count":2,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489252,"discussion_content":"æ¯”å¦‚redisã€memcachedã€etcdã€zookeeperç­‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585934932,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1268264,"avatar":"https://static001.geekbang.org/account/avatar/00/13/5a/28/732d3f2f.jpg","nickname":"GEEKBANG_6638780","note":"","ucode":"952194E56FD8C8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":215212,"discussion_content":"redisä¸é¦™ä¹ˆ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585302199,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2733281,"avatar":"","nickname":"Geek_f4512f","note":"","ucode":"3CB387D2943590","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389003,"discussion_content":"è¿™éƒ½æ˜¯ åˆ†å¸ƒå¼äº§å“äº†å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629086657,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":244014,"user_name":"Heaven","can_delete":false,"product_type":"c1","uid":1694207,"ip_address":"","ucode":"FA33FBCC66C911","user_header":"https://static001.geekbang.org/account/avatar/00/19/d9/ff/b23018a6.jpg","comment_is_top":false,"comment_ctime":1598351931,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598351931","product_id":100046101,"comment_content":"å¯ä»¥åœ¨å¤šæ¬¡å‘å‡ºåŒæ­¥æ—¥å¿—çš„æ—¶å€™,éƒ½è·å¾—è¶…æ—¶çš„æ¢å¤,è€ƒè™‘è¿›è¡ŒèŠ‚ç‚¹çš„æ›¿æ¢,åœ¨RemoveServerå‡½æ•°ä¸­,å¯ä»¥é€šè¿‡ä¼ å…¥å¤±æ•ˆè¿™ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤çš„IDæ¥è¿›è¡Œåˆ é™¤","like_count":0},{"had_liked":false,"id":215883,"user_name":"é’Ÿå‹å…µ","can_delete":false,"product_type":"c1","uid":1866454,"ip_address":"","ucode":"BFD61236BF448E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/4uiaFspOvPSF8tzalkP0DvCDme7v53eDGkDMsZsibcm31W99Sib2thFe9m3714d4t7qtIcSeyuR1HiaTXZs4TG8enQ/132","comment_is_top":false,"comment_ctime":1589124345,"is_pvip":false,"replies":[{"id":"80032","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œåˆ›å»ºé›†ç¾¤æ—¶ï¼Œæ‰éœ€è¦ä»¥bootstrapçš„å½¢å¼å¯åŠ¨ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯é¢†å¯¼è€…ï¼Œè¿™æ˜¯Hashicorp Raftå®ç°çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œæ–¹ä¾¿æ·»åŠ èŠ‚ç‚¹åˆ›å»ºé›†ç¾¤ã€‚æ­£å¸¸å¯åŠ¨ï¼Œæ˜¯ä¸éœ€è¦bootstrapçš„ï¼Œé¢†å¯¼è€…ç”±é€‰ä¸¾äº§ç”Ÿã€‚å…·ä½“å¯ä»¥å‚è€ƒä¸‹raftdbçš„Store.Open()çš„å®ç°ã€‚ä½¿ç”¨Raftï¼Œæ˜¯ä¸éœ€è¦æŒ‡å®šé¢†å¯¼è€…ï¼ˆä¹Ÿå°±æ˜¯masterçš„ï¼‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1589234213,"ip_address":"","comment_id":215883,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1589124345","product_id":100046101,"comment_content":"éŸ©è€å¸ˆï¼Œæœ‰ç‚¹ä¸å¤ªæ˜ç™½ä½¿ç”¨boostrapå¯åŠ¨ï¼Œç§°ä¸ºé¢†å¯¼è€…ã€‚ä¸€èˆ¬åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œç³»ç»Ÿå®‰è£…é…ç½®æŒ‡å®šmaster ã€‚è¿™é‡Œçš„è¯éº»çƒ¦è§£é‡Šä¸€ä¸‹","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494594,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œåˆ›å»ºé›†ç¾¤æ—¶ï¼Œæ‰éœ€è¦ä»¥bootstrapçš„å½¢å¼å¯åŠ¨ï¼Œç¬¬ä¸€ä¸ªèŠ‚ç‚¹æ˜¯é¢†å¯¼è€…ï¼Œè¿™æ˜¯Hashicorp Raftå®ç°çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œæ–¹ä¾¿æ·»åŠ èŠ‚ç‚¹åˆ›å»ºé›†ç¾¤ã€‚æ­£å¸¸å¯åŠ¨ï¼Œæ˜¯ä¸éœ€è¦bootstrapçš„ï¼Œé¢†å¯¼è€…ç”±é€‰ä¸¾äº§ç”Ÿã€‚å…·ä½“å¯ä»¥å‚è€ƒä¸‹raftdbçš„Store.Open()çš„å®ç°ã€‚ä½¿ç”¨Raftï¼Œæ˜¯ä¸éœ€è¦æŒ‡å®šé¢†å¯¼è€…ï¼ˆä¹Ÿå°±æ˜¯masterçš„ï¼‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589232123,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":207694,"user_name":"åå­","can_delete":false,"product_type":"c1","uid":1246520,"ip_address":"","ucode":"91DFE5F9BB8D32","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erY7671v8F2joiaBbnCPsbJ6ExFruIMDsd9HRSORsOZgbzBrKibDibU9CRCGghI56hUiampklDWzMFc4A/132","comment_is_top":false,"comment_ctime":1587139011,"is_pvip":false,"replies":[{"id":"77595","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œæˆ‘åé¢åšä¸ªè¡¥å……å§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1587219715,"ip_address":"","comment_id":207694,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1587139011","product_id":100046101,"comment_content":"è¯·é—®è€å¸ˆä»¥åä¼šä¸ä¼šä»‹ç»multiple raft groupç›¸å…³å†…å®¹ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492210,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼Œæˆ‘åé¢åšä¸ªè¡¥å……å§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587219715,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":196273,"user_name":"pedro","can_delete":false,"product_type":"c1","uid":1200704,"ip_address":"","ucode":"F40C839DDFD599","user_header":"https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg","comment_is_top":false,"comment_ctime":1585268828,"is_pvip":false,"replies":[{"id":"77633","content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼ŒSETæ“ä½œï¼ˆæ¯”å¦‚SET X = 1ï¼‰å…·æœ‰å†¥ç­‰æ€§çš„ï¼Œæ‰§è¡Œå¤šæ¬¡ï¼Œå’Œæ‰§è¡Œä¸€æ¬¡ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œå³ä½¿æœ‰å¤šä¸ªæ—¥å¿—é¡¹ï¼Œåé¢ä¹Ÿä¼šå»é‡å‹ç¼©å¤„ç†çš„ï¼Œä¸ä¼šæœ‰å½±å“çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"hanj4096","uid":"1642497","ctime":1587239107,"ip_address":"","comment_id":196273,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1585268828","product_id":100046101,"comment_content":"é—®è€å¸ˆä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœPOSTè¯·æ±‚æ–°å¢ä¸€ä¸ªkvé”®å€¼å¯¹ï¼Œç¬¬ä¸€ä¸ªè¯·æ±‚æ–°å¢æˆåŠŸåï¼Œåº”è¯¥ä¼šç»™å‡ºæˆåŠŸçš„å“åº”ï¼Œä½†è‹¥æ˜¯é‡å¤POSTè¯·æ±‚ï¼Œç¬¬äºŒæ¬¡åº”è¯¥ä¼šå¤±è´¥ï¼Œè¿™æ ·æ€ä¹ˆä¿è¯å¹‚ç­‰æ€§å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1642497,"avatar":"https://static001.geekbang.org/account/avatar/00/19/10/01/750740a8.jpg","nickname":"hanj4096","note":"","ucode":"481047E40315AA","race_medal":0,"user_type":2,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489255,"discussion_content":"åŠ ä¸€é¢—æ˜Ÿ:)ï¼ŒSETæ“ä½œï¼ˆæ¯”å¦‚SET X = 1ï¼‰å…·æœ‰å†¥ç­‰æ€§çš„ï¼Œæ‰§è¡Œå¤šæ¬¡ï¼Œå’Œæ‰§è¡Œä¸€æ¬¡ï¼Œæ•ˆæœæ˜¯ä¸€æ ·çš„ï¼Œå³ä½¿æœ‰å¤šä¸ªæ—¥å¿—é¡¹ï¼Œåé¢ä¹Ÿä¼šå»é‡å‹ç¼©å¤„ç†çš„ï¼Œä¸ä¼šæœ‰å½±å“çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587239107,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1310798,"avatar":"https://static001.geekbang.org/account/avatar/00/14/00/4e/be2b206b.jpg","nickname":"å´å°æ™º","note":"","ucode":"C7C9F58B5C9F7B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":215052,"discussion_content":"ä¸ªäººçœ‹æ³•ï¼šè¿™ä¸ªè¦æ˜ç¡®ä¸€ç‚¹ï¼Œkv å­˜å‚¨ï¼Œå®é™…çš„å­˜å‚¨ä¸æ˜¯ Raft æ¥è´Ÿè´£çš„ï¼Œæ˜¯ç”± service æ¥è´Ÿè´£çš„ï¼ŒRaft åœ¨ commit ä¸€æ¡æ—¥å¿—çš„æ—¶å€™ï¼Œä¼šå›è°ƒ service å±‚çš„ Apply æ–¹æ³•ï¼ˆå¯ä»¥è¯´æ˜¯ Raft æä¾›çš„ä¸€ä¸ª hookï¼Œå¯åŠ¨ Raft çš„æ—¶å€™æ³¨å…¥ï¼‰ï¼Œåœ¨ Apply ä¸­ï¼Œå¯ä»¥å¾—åˆ° log çš„å†…å®¹ï¼Œç„¶åå¤„ç†ç›¸åº”çš„é€»è¾‘ã€‚\n\nè¿™æ ·å¤„ç†å¹‚ç­‰å°±å®¹æ˜“å¤šäº†ã€‚è¿™ä¸ªå¯ä»¥åœ¨ log ä¸­æ·»åŠ ä¸€ä¸ªè¯·æ±‚ ID ä¹‹ç±»çš„ä¸œè¥¿ï¼Œç„¶ååœ¨ Apply ä¸­å®ç°å¹‚ç­‰é€»è¾‘ã€‚å³åœ¨ Raft ä¸­ï¼Œæ—¥å¿—æ˜¯æœ‰å¯èƒ½é‡å¤çš„ï¼Œéœ€è¦åœ¨ service å±‚æ¥å¤„ç†å¹‚ç­‰ã€‚","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1585277164,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"ä¸€æ­¥","note":"","ucode":"73CEA468CE70C3","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":219329,"discussion_content":"post  è¯·æ±‚å¹‚ç­‰æ€§ ä¸€èˆ¬éƒ½ä¼šç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ID æ ‡ç¤ºè¯¥è¯·æ±‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585751309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}