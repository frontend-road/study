{"id":8845,"title":"37 | Apollo架构设计之高可用和监控","content":"无","comments":[{"had_liked":false,"id":127262,"user_name":"初音未来","can_delete":false,"product_type":"c3","uid":1274518,"ip_address":"","ucode":"3AE23DBC649B97","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erKFNFAQl3ibwlic54a5SQYAMhQYeVtMnSmMahZZjyqG2d66whxbEE3I3IyD07pSmte5DSibr71m6A9g/132","comment_is_top":false,"comment_ctime":1566627497,"is_pvip":false,"replies":[{"id":47222,"content":"apollo有本地缓存，作为高可用的一部分，防止configservice挂，客户端获取不到配置。\n\n可以参考apollo官方文档：\nhttps:&#47;&#47;github.com&#47;ctripcorp&#47;apollo&#47;wiki&#47;Java客户端使用指南：1.2.3 本地缓存路径\n\n","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1566745623,"ip_address":"","comment_id":127262,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"波波老师，不太理解configservice挂了之后客户端需要读本地缓存，我认为客户端获取完配置会直接写入应用的配置文件，configservice挂掉之后和本地有没有缓存，都不会影响应用的配置吧","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464402,"discussion_content":"apollo有本地缓存，作为高可用的一部分，防止configservice挂，客户端获取不到配置。\n\n可以参考apollo官方文档：\nhttps://github.com/ctripcorp/apollo/wiki/Java客户端使用指南：1.2.3 本地缓存路径\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566745623,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57541,"user_name":"大脸猫","can_delete":false,"product_type":"c3","uid":1178977,"ip_address":"","ucode":"326560C494D0DB","user_header":"https://static001.geekbang.org/account/avatar/00/11/fd/61/96fb8fda.jpg","comment_is_top":false,"comment_ctime":1546830959,"is_pvip":false,"replies":[{"id":20888,"content":"一套环境的configservice共用同一个ApolloConfigDB数据库，不同环境用不用ApolloConfigDB数据库，不用同步","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1546952327,"ip_address":"","comment_id":57541,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"杨波老师您好，您在课程里面讲到，每个config service都有自己独立的数据库，那么这些数据库的数据是如何做到同步的呢？","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435634,"discussion_content":"一套环境的configservice共用同一个ApolloConfigDB数据库，不同环境用不用ApolloConfigDB数据库，不用同步","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546952327,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":21635,"user_name":"licht","can_delete":false,"product_type":"c3","uid":1064030,"ip_address":"","ucode":"467270E57A7BF8","user_header":"https://static001.geekbang.org/account/avatar/00/10/3c/5e/6a26a8c4.jpg","comment_is_top":false,"comment_ctime":1535202921,"is_pvip":false,"replies":[{"id":8280,"content":"java 动态类加载spi+检查cat类是否存在+反射，具体请看apollo core里头源码","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1536061205,"ip_address":"","comment_id":21635,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"波波老师，请问一下，针对cat的自动依赖扫描是怎么实现的，原理大概是什么样的，谢谢啦？","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":422777,"discussion_content":"java 动态类加载spi+检查cat类是否存在+反射，具体请看apollo core里头源码","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1536061205,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":144469,"user_name":"此方彼方Francis","can_delete":false,"product_type":"c3","uid":1001390,"ip_address":"","ucode":"73E6C93CF1FE39","user_header":"https://static001.geekbang.org/account/avatar/00/0f/47/ae/0a5f7a56.jpg","comment_is_top":false,"comment_ctime":1571930432,"is_pvip":false,"replies":[{"id":56081,"content":"说实话，InfluxDB我也没有实际生产经验，但了解它开源的是单机版，集群需要商业版才支持。\n\nInfluxDB是一个不错的时间序列+分析型数据库，在社区热度仅次于Prometheus，而且外围生态也不错，各种集成客户端很丰富。\n\n如果要生产使用的话，建议要有一定的定制自研能力。我了解到携程运维监控系统是基于InfluxDB的。另外，之前饿了么也用InfluxDB，还定制了自己的集群方案，可以参考：\n饿了么 Influxdb 实践之路\nhttps:&#47;&#47;studygolang.com&#47;articles&#47;10120","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1572264031,"ip_address":"","comment_id":144469,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"influxDB开源版本不支持集群，如果真要用influxDB的话，波波老师有什么建议？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471958,"discussion_content":"说实话，InfluxDB我也没有实际生产经验，但了解它开源的是单机版，集群需要商业版才支持。\n\nInfluxDB是一个不错的时间序列+分析型数据库，在社区热度仅次于Prometheus，而且外围生态也不错，各种集成客户端很丰富。\n\n如果要生产使用的话，建议要有一定的定制自研能力。我了解到携程运维监控系统是基于InfluxDB的。另外，之前饿了么也用InfluxDB，还定制了自己的集群方案，可以参考：\n饿了么 Influxdb 实践之路\nhttps://studygolang.com/articles/10120","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572264031,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58377,"user_name":"骏Jero","can_delete":false,"product_type":"c3","uid":1133122,"ip_address":"","ucode":"C0D505B088275E","user_header":"https://static001.geekbang.org/account/avatar/00/11/4a/42/b2c7dd30.jpg","comment_is_top":false,"comment_ctime":1547046730,"is_pvip":false,"replies":[{"id":21165,"content":"你好，apollo支持CAT监控，CAT可以监控gc等jvm状态，apollo以自动扫描方式支持CAT，类似动态SPI机制，也就是如果你引入了CAT客户端jar（且配置好），apollo就启用CAT，如果你没引入CAT客户端，它就不启用，所以代码中看不到直接调用CAT，但是在core中可以看到接口适配和SPI代码。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1547126514,"ip_address":"","comment_id":58377,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"杨波老师，你好，apollo监控里面有程序 gc的监控，代码在哪个位置，也在core中么？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436036,"discussion_content":"你好，apollo支持CAT监控，CAT可以监控gc等jvm状态，apollo以自动扫描方式支持CAT，类似动态SPI机制，也就是如果你引入了CAT客户端jar（且配置好），apollo就启用CAT，如果你没引入CAT客户端，它就不启用，所以代码中看不到直接调用CAT，但是在core中可以看到接口适配和SPI代码。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547126514,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":23264,"user_name":"天天平安","can_delete":false,"product_type":"c3","uid":1119208,"ip_address":"","ucode":"C4850F9655F4DD","user_header":"https://static001.geekbang.org/account/avatar/00/11/13/e8/08b829a9.jpg","comment_is_top":false,"comment_ctime":1536241117,"is_pvip":false,"replies":[{"id":8565,"content":"apollo client是嵌在业务服务代码中的库lib，一般没有lib挂的说法，当然业务服务进程可能挂，但一般业务服务无状态以集群方式布署，挂一二个也无问题。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1536547214,"ip_address":"","comment_id":23264,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"如果client挂了呢？怎么办？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423486,"discussion_content":"apollo client是嵌在业务服务代码中的库lib，一般没有lib挂的说法，当然业务服务进程可能挂，但一般业务服务无状态以集群方式布署，挂一二个也无问题。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1536547214,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}