{"id":804324,"title":"03ï½œRAG ç´¢å¼•ï¼ˆä¸€ï¼‰ï¼šæ–‡æ¡£è§£ææŠ€æœ¯","content":"<blockquote>\n<p><span class=\"reference\">æœ¬é—¨è¯¾ç¨‹ä¸ºç²¾å“å°è¯¾ï¼Œä¸æ ‡é…éŸ³é¢‘</span></p>\n</blockquote><p>ä½ å¥½ï¼Œæˆ‘æ˜¯å¸¸æ‰¬ã€‚</p><p>åœ¨ä¹‹å‰çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬äº†è§£åˆ°ï¼ŒRAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰ç³»ç»Ÿçš„é¦–è¦æ­¥éª¤æ˜¯ç´¢å¼•ï¼ˆIndexingï¼‰æµç¨‹ä¸­çš„æ–‡æ¡£è§£æã€‚æ–‡æ¡£è§£ææŠ€æœ¯çš„æœ¬è´¨åœ¨äºå°†<strong>æ ¼å¼å„å¼‚ã€ç‰ˆå¼å¤šæ ·ã€å…ƒç´ å¤šç§</strong>çš„æ–‡æ¡£æ•°æ®ï¼ŒåŒ…æ‹¬æ®µè½ã€è¡¨æ ¼ã€æ ‡é¢˜ã€å…¬å¼ã€å¤šåˆ—ã€å›¾ç‰‡ç­‰æ–‡æ¡£åŒºå—ï¼Œè½¬åŒ–ä¸ºé˜…è¯»é¡ºåºæ­£ç¡®çš„å­—ç¬¦ä¸²ä¿¡æ¯ã€‚â€œ<strong>Quality in, Quality out</strong>â€ æ˜¯å¤§æ¨¡å‹æŠ€æœ¯çš„å…¸å‹ç‰¹å¾ï¼Œé«˜è´¨é‡çš„æ–‡æ¡£è§£æèƒ½å¤Ÿä»å„ç§å¤æ‚æ ¼å¼çš„éç»“æ„åŒ–æ•°æ®ä¸­æå–å‡ºé«˜ç²¾å‡†åº¦çš„ä¿¡æ¯ï¼Œå¯¹RAGç³»ç»Ÿæœ€ç»ˆçš„æ•ˆæœèµ·å†³å®šæ€§çš„ä½œç”¨ã€‚</p><p>RAGç³»ç»Ÿçš„åº”ç”¨åœºæ™¯ä¸»è¦é›†ä¸­åœ¨ä¸“ä¸šé¢†åŸŸå’Œä¼ä¸šåœºæ™¯ã€‚è¿™äº›åœºæ™¯ä¸­ï¼Œé™¤äº†å…³ç³»å‹å’Œéå…³ç³»å‹æ•°æ®åº“ï¼Œæ›´å¤šçš„æ•°æ®ä»¥ <strong>PDFã€TXTã€Wordã€PPTã€Excelã€CSVã€Markdownã€XMLã€HTML</strong> ç­‰å¤šç§æ ¼å¼å­˜å‚¨ã€‚å°¤å…¶æ˜¯PDFæ–‡ä»¶ï¼Œå‡­å€Ÿå…¶ç»Ÿä¸€çš„æ’ç‰ˆå’Œå¤šæ ·åŒ–çš„ç»“æ„å½¢å¼ï¼Œæˆä¸ºäº†æœ€ä¸ºå¸¸è§çš„æ–‡æ¡£æ•°æ®å­˜å‚¨ä¸äº¤æ¢æ ¼å¼ã€‚æ–‡æ¡£è§£ææŠ€æœ¯ä¸ä»…éœ€è¦æ”¯æŒä¸Šè¿°æ‰€æœ‰å¸¸è§æ ¼å¼ï¼Œè¿˜éœ€è¦ç‰¹åˆ«å¼ºåŒ–å¯¹äºPDFçš„è§£æèƒ½åŠ›ï¼ŒåŒ…æ‹¬å¯¹ç”µå­æ¡£å’Œæ‰«ææ¡£çš„å¤„ç†ï¼Œæ”¯æŒå¤šç§ç‰ˆé¢å½¢å¼çš„è§£æã€ä¸åŒç±»å‹ç‰ˆé¢å…ƒç´ çš„è¯†åˆ«ï¼Œå¹¶èƒ½å¤Ÿè¿˜åŸæ­£ç¡®çš„é˜…è¯»é¡ºåºã€‚</p><p>æ­¤å¤–ï¼Œç”±äºPDFæ–‡æ¡£å¾€å¾€ç¯‡å¹…å·¨å¤§ã€é¡µæ•°ä¼—å¤šï¼Œä¸”ä¼ä¸šåŠä¸“ä¸šé¢†åŸŸPDFæ–‡ä»¶æ•°æ®é‡åºå¤§ï¼Œå› æ­¤æ–‡æ¡£è§£ææŠ€æœ¯è¿˜éœ€å…·å¤‡æé«˜çš„å¤„ç†æ€§èƒ½ï¼Œä»¥ç¡®ä¿çŸ¥è¯†åº“çš„é«˜æ•ˆæ„å»ºå’Œå®æ—¶æ›´æ–°ã€‚</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/fd/4c/fd5d33293b17f99d68d50e0805101b4c.jpg?wh=1920x780\" alt=\"å›¾ç‰‡\"></p><p>è¿™èŠ‚è¯¾æˆ‘ä¼šå…ˆä¸ºä½ è®²è§£å„ç§æ–‡æ¡£æ ¼å¼çš„è§£ææ–¹æ³•ï¼Œå¹¶æ¼”ç¤ºç›¸å…³çš„ä»£ç ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°†æ·±å…¥è®²è§£PDFæ–‡ä»¶çš„è§£æï¼Œå¹¶æä¾›é’ˆå¯¹æ€§çš„æŠ€æœ¯æ–¹æ¡ˆåˆ†æã€‚è¿™èŠ‚è¯¾çš„æ‰€æœ‰ä»£ç å’Œç¤ºä¾‹æ–‡æ¡£å°†å…¬å¼€å‘å¸ƒåœ¨Giteeé¡¹ç›®ä¸­ï¼Œrag_app_lesson3.py ä»£ç åŸºäº<a href=\"https://time.geekbang.org/column/article/803829\">ç¬¬ 02 è®²ä¸­çš„ rag_app_lesson2.py </a>è¿›è¡Œè¿­ä»£æ›´æ–°ã€‚</p><h2>LangChain Document Loaders æ–‡æ¡£åŠ è½½å™¨</h2><p>æœ¬è¯¾ç¨‹ç¤ºä¾‹RAGé¡¹ç›®åŸºäº LangChain æ¶æ„ï¼Œæä¾›åœ¨å®é™…åº”ç”¨åœºæ™¯ä¸­å¸¸è§æ–‡æ¡£æ ¼å¼çš„è§£ææ–¹æ¡ˆï¼Œæ¶µç›– PDFã€TXTã€Wordã€PPTã€Excelã€CSVã€Markdownã€XML å’Œ HTML æ ¼å¼ã€‚é‰´äº PDF æ ¼å¼åœ¨å®é™…åº”ç”¨ä¸­çš„ä½¿ç”¨å æ¯”æœ€é«˜ï¼Œè¿™èŠ‚è¯¾çš„ååŠéƒ¨åˆ†æˆ‘ä»¬å°†å¯¹å…¶è¿›è¡Œæ·±å…¥è®²è§£ã€‚</p><p>LangChain æä¾›äº†ä¸€å¥—åŠŸèƒ½å¼ºå¤§çš„<strong>æ–‡æ¡£åŠ è½½å™¨ï¼ˆDocument Loadersï¼‰</strong>ï¼Œå¸®åŠ©å¼€å‘è€…è½»æ¾åœ°å°†æ•°æ®æºä¸­çš„å†…å®¹åŠ è½½ä¸ºæ–‡æ¡£å¯¹è±¡ã€‚LangChain å®šä¹‰äº† <strong>BaseLoader</strong> ç±»å’Œ <strong>Document</strong> ç±»ï¼Œå…¶ä¸­ BaseLoader ç±»è´Ÿè´£å®šä¹‰å¦‚ä½•ä»ä¸åŒæ•°æ®æºåŠ è½½æ–‡æ¡£ï¼Œè€Œ Document ç±»åˆ™ç»Ÿä¸€æè¿°äº†ä¸åŒæ–‡æ¡£ç±»å‹çš„å…ƒæ•°æ®ã€‚</p><p>å¼€å‘è€…å¯ä»¥åŸºäº BaseLoader ç±»ä¸ºç‰¹å®šæ•°æ®æºåˆ›å»ºè‡ªå®šä¹‰åŠ è½½å™¨ï¼Œå¹¶å°†å…¶å†…å®¹åŠ è½½ä¸º Document å¯¹è±¡ã€‚ä½¿ç”¨é¢„æ„å»ºçš„åŠ è½½å™¨æ¯”è‡ªè¡Œç¼–å†™æ›´åŠ ä¾¿æ·ã€‚ä¾‹å¦‚ï¼ŒPyPDF åŠ è½½å™¨èƒ½å¤Ÿå¤„ç† PDF æ–‡ä»¶ï¼Œå°†å¤šé¡µæ–‡æ¡£åˆ†è§£ä¸ºç‹¬ç«‹çš„ã€å¯åˆ†æçš„å•å…ƒï¼Œå¹¶é™„å¸¦å†…å®¹åŠè¯¸å¦‚æºä¿¡æ¯ã€é¡µç ç­‰é‡è¦å…ƒæ•°æ®ã€‚</p><p><strong>langchain_community</strong> æ˜¯ LangChain ä¸å¸¸ç”¨ç¬¬ä¸‰æ–¹åº“ç›¸ç»“åˆçš„æ‹“å±•åº“ã€‚å„ç±»å¼€æºåº“å’Œä¼ä¸šåº“åŸºäº BaseLoader ç±»åœ¨ langchain_community åº“ä¸­æ‰©å±•äº†ä¸åŒæ–‡æ¡£ç±»å‹çš„åŠ è½½å™¨ï¼Œè¿™äº›åŠ è½½å™¨è¢«å½’ç±»äº langchain_community.document_loaders æ¨¡å—ä¸­ã€‚æ¯ä¸ªåŠ è½½å™¨éƒ½å¯ä»¥è¾“å…¥å¯¹åº”çš„å‚æ•°ï¼Œå¦‚æŒ‡å®šæ–‡æ¡£è§£æç¼–ç ã€è§£æç‰¹å®šå…ƒç´ ç­‰ï¼Œä»¥åŠå¯¹ Document ç±»è¿›è¡Œæå–æˆ–æ£€ç´¢ç­‰æ“ä½œã€‚ç›®å‰ï¼Œå·²æœ‰è¶…è¿‡ 160 ç§æ•°æ®åŠ è½½å™¨ï¼Œè¦†ç›–äº†æœ¬åœ°æ–‡ä»¶ã€äº‘ç«¯æ–‡ä»¶ã€æ•°æ®åº“ã€äº’è”ç½‘å¹³å°ã€Web æœåŠ¡ç­‰å¤šç§æ•°æ®æºã€‚è¯¦æƒ…å¯ä»¥åœ¨ <a href=\"https://python.langchain.com/v0.2/docs/integrations/document_loaders\">LangChain å®˜ç½‘</a>æŸ¥çœ‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/2a/12/2a85d51a7cf45dedf05fafc4488bb712.png?wh=1920x874\" alt=\"å›¾ç‰‡\"></p><p>Document Loader æ¨¡å—æ˜¯å°è£…å¥½çš„å„ç§æ–‡æ¡£è§£æåº“é›†æˆSDKï¼Œé¡¹ç›®ä¸­ä½¿ç”¨è¿˜éœ€è¦å®‰è£…å¯¹åº”çš„æ–‡æ¡£è§£æåº“ã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬é¡¹ç›®ä¸­ä½¿ç”¨ from langchain_community.document_loaders import PDFPlumberLoader æ—¶ï¼Œéœ€è¦å…ˆé€šè¿‡å‘½ä»¤è¡Œ pip install pdfplumber å®‰è£… pdfplumber åº“ã€‚æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œè¿˜éœ€è¦é¢å¤–çš„ä¾èµ–åº“ï¼Œæ¯”å¦‚ä½¿ç”¨ UnstructuredMarkdownLoader æ—¶ï¼Œéœ€è¦å®‰è£… unstructured åº“æ¥æä¾›åº•å±‚æ–‡æ¡£è§£æï¼Œè¿˜éœ€è¦ markdown åº“æ¥æ”¯æŒ Markdown æ–‡æ¡£æ ¼å¼æ›´å¤šèƒ½åŠ›ã€‚æ­¤å¤–ï¼Œå¯¹äºåƒ .doc è¿™ç§æ—©æœŸçš„æ–‡æ¡£ç±»å‹ï¼Œè¿˜éœ€è¦å®‰è£… libreoffice è½¯ä»¶åº“æ‰èƒ½è¿›è¡Œè§£æã€‚</p><p>å®é™…ç ”å‘åœºæ™¯ä¸­ï¼Œä½¿ç”¨ Document Loader æ–‡æ¡£åŠ è½½å™¨æ¨¡å—æ—¶ï¼Œéœ€è¦æ ¹æ®å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚ç¼–å†™è‡ªå®šä¹‰çš„æ–‡æ¡£åå¤„ç†é€»è¾‘ã€‚é’ˆå¯¹ä¸šåŠ¡éœ€æ±‚ï¼Œå¼€å‘è€…å¯ä»¥è‡ªè¡Œç¼–å†™å’Œå®ç°å¯¹ä¸åŒæ–‡æ¡£å†…å®¹çš„è§£æï¼Œä¾‹å¦‚å¯¹æ ‡é¢˜ã€æ®µè½ã€è¡¨æ ¼ã€å›¾ç‰‡ç­‰å…ƒç´ çš„ç‰¹æ®Šå¤„ç†ã€‚åœ¨æœ¬è¯¾ç¨‹çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä» Document ç±»ä¸­æå–æ‰€æœ‰æ–‡æœ¬å†…å®¹ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥çš„æ–‡æ¡£åˆ†å—å¤„ç†ã€‚</p><h2>å¤šæ ¼å¼æ–‡æ¡£è§£æ</h2><p>æœ¬æ¬¡å®æˆ˜æˆ‘ä»¬å°†è§£æä¸åŒç±»å‹çš„æ–‡æ¡£ï¼Œå…¶å¯¹åº”çš„ Document Loader å’Œæ‰€éœ€çš„æ–‡æ¡£è§£æä¾èµ–åº“å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/c6/83/c60419a3c73f3090651a4c2761e05583.png?wh=1918x1542\" alt=\"å›¾ç‰‡\"></p><p>å…³äºå¼€å‘ç¯å¢ƒä»¥åŠ langchain å’Œ langchain_community ç­‰åº“çš„å®‰è£…å’Œé…ç½®ï¼Œæˆ‘ä»¬å·²ç»åœ¨ç¬¬ 02 è¯¾ä¸­è¯¦ç»†è¯´æ˜äº†ã€‚åœ¨æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤ä¹‹å‰ï¼Œéœ€è¦å…ˆå®Œæˆç¬¬ 02 è¯¾çš„å®æˆ˜å†…å®¹ã€‚ä¸‹é¢å®æˆ˜çš„ä»£ç æ›´æ–°åœ¨æ‰˜ç®¡é¡¹ç›®çš„ <strong>rag_app_lesson3.py</strong> ä»£ç æ–‡ä»¶ä¸­ã€‚</p><p><strong>åœ¨ä½¿ç”¨ Document Loader ä¹‹å‰ï¼Œå…ˆåœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œä»¥ä¸‹å®‰è£…å‘½ä»¤</strong>ï¼š</p><pre><code class=\"language-plain\">source rag_env/bin/activate  # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ\npip install unstructured pdfplumber python-docx python-pptx markdown openpyxl pandas -i https://pypi.tuna.tsinghua.edu.cn/simple\n</code></pre><p>å®‰è£… <code>.doc</code> æ–‡ä»¶çš„æ”¯æŒè½¯ä»¶ LibreOfficeï¼š</p><pre><code class=\"language-plain\">sudo apt-get install libreoffice # Linuxç³»ç»Ÿæ‰§è¡Œè¿™æ¡æŒ‡ä»¤\nbrew install --cask libreoffice # MacOSç³»ç»Ÿæ‰§è¡Œè¿™æ¡æŒ‡ä»¤\n</code></pre><p><strong>å®šä¹‰åŠ è½½å„ç§æ ¼å¼æ–‡æ¡£çš„æ–¹æ³•ï¼Œload_documentï¼š</strong></p><pre><code class=\"language-plain\">from langchain_community.document_loaders import (\n    PDFPlumberLoader,\n    TextLoader,\n    UnstructuredWordDocumentLoader,\n    UnstructuredPowerPointLoader,\n    UnstructuredExcelLoader,\n    CSVLoader,\n    UnstructuredMarkdownLoader,\n    UnstructuredXMLLoader,\n    UnstructuredHTMLLoader,\n) # ä» langchain_community.document_loaders æ¨¡å—ä¸­å¯¼å…¥å„ç§ç±»å‹æ–‡æ¡£åŠ è½½å™¨ç±»\n\ndef load_document(file_path):\n    \"\"\"\n    è§£æå„ç§æ–‡æ¡£æ ¼å¼çš„æ–‡ä»¶ï¼Œè¿”å›æ–‡æ¡£å†…å®¹å­—ç¬¦ä¸²\n    :param file_path: æ–‡æ¡£æ–‡ä»¶è·¯å¾„\n    :return: è¿”å›æ–‡æ¡£å†…å®¹çš„å­—ç¬¦ä¸²\n    \"\"\"\n\n    # å®šä¹‰æ–‡æ¡£è§£æåŠ è½½å™¨å­—å…¸ï¼Œæ ¹æ®æ–‡æ¡£ç±»å‹é€‰æ‹©å¯¹åº”çš„æ–‡æ¡£è§£æåŠ è½½å™¨ç±»å’Œè¾“å…¥å‚æ•°\n    DOCUMENT_LOADER_MAPPING = {\n        \".pdf\": (PDFPlumberLoader, {}),\n        \".txt\": (TextLoader, {\"encoding\": \"utf8\"}),\n        \".doc\": (UnstructuredWordDocumentLoader, {}),\n        \".docx\": (UnstructuredWordDocumentLoader, {}),\n        \".ppt\": (UnstructuredPowerPointLoader, {}),\n        \".pptx\": (UnstructuredPowerPointLoader, {}),\n        \".xlsx\": (UnstructuredExcelLoader, {}),\n        \".csv\": (CSVLoader, {}),\n        \".md\": (UnstructuredMarkdownLoader, {}),\n        \".xml\": (UnstructuredXMLLoader, {}),\n        \".html\": (UnstructuredHTMLLoader, {}),\n    }\n\n    ext = os.path.splitext(file_path)[1]  # è·å–æ–‡ä»¶æ‰©å±•åï¼Œç¡®å®šæ–‡æ¡£ç±»å‹\n    loader_tuple = DOCUMENT_LOADER_MAPPING.get(ext)  # è·å–æ–‡æ¡£å¯¹åº”çš„æ–‡æ¡£è§£æåŠ è½½å™¨ç±»å’Œå‚æ•°å…ƒç»„\n\n    if loader_tuple: # åˆ¤æ–­æ–‡æ¡£æ ¼å¼æ˜¯å¦åœ¨åŠ è½½å™¨æ”¯æŒèŒƒå›´\n        loader_class, loader_args = loader_tuple  # è§£åŒ…å…ƒç»„ï¼Œè·å–æ–‡æ¡£è§£æåŠ è½½å™¨ç±»å’Œå‚æ•°\n        loader = loader_class(file_path, **loader_args)  # åˆ›å»ºæ–‡æ¡£è§£æåŠ è½½å™¨å®ä¾‹ï¼Œå¹¶ä¼ å…¥æ–‡æ¡£æ–‡ä»¶è·¯å¾„\n        documents = loader.load()  # åŠ è½½æ–‡æ¡£\n        content = \"\\n\".join([doc.page_content for doc in documents])  # å¤šé¡µæ–‡æ¡£å†…å®¹ç»„åˆä¸ºå­—ç¬¦ä¸²\n        print(f\"æ–‡æ¡£ {file_path} çš„éƒ¨åˆ†å†…å®¹ä¸º: {content[:100]}...\")  # ä»…ç”¨æ¥å±•ç¤ºæ–‡æ¡£å†…å®¹çš„å‰100ä¸ªå­—ç¬¦\n        return content  # è¿”å›æ–‡æ¡£å†…å®¹çš„å¤šé¡µæ‹¼åˆå­—ç¬¦ä¸²\n\n    print(file_path+f\"ï¼Œä¸æ”¯æŒçš„æ–‡æ¡£ç±»å‹: '{ext}'\") # è‹¥æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒï¼Œè¾“å‡ºä¿¡æ¯ï¼Œè¿”å›ç©ºå­—ç¬¦ä¸²ã€‚\n    return \"\"\n</code></pre><p>ä¸Šè¿°ä»£ç å®ç°äº†è§£æå¤šç§æ–‡æ¡£æ ¼å¼å¹¶è¿”å›æ–‡æ¡£å†…å®¹çš„å­—ç¬¦ä¸²çš„æ–¹æ³• <strong>load_document</strong>ã€‚å‡½æ•°é€šè¿‡æ£€æŸ¥æ–‡ä»¶çš„æ‰©å±•å <strong>ext</strong>ï¼ŒåŠ¨æ€é€‰æ‹©åˆé€‚çš„æ–‡æ¡£åŠ è½½å™¨ <strong>Document Loader</strong>ï¼Œä½¿ç”¨ç›¸åº”çš„åŠ è½½å™¨è°ƒç”¨å¯¹åº”åº“è¯»å–æ–‡æ¡£å†…å®¹ <strong>documents</strong>ã€‚æ”¯æŒçš„æ–‡æ¡£æ ¼å¼ä¸å¯¹åº”çš„åŠ è½½å™¨ç±»å’Œå‚æ•°åœ¨å­—å…¸ <strong>DOCUMENT_LOADER_MAPPING</strong> ä¸­è¿›è¡Œäº†æ˜ å°„ã€‚æ ¹æ®æ–‡ä»¶çš„æ‰©å±•åï¼Œå‡½æ•°ä¼šå®ä¾‹åŒ–å¯¹åº”çš„åŠ è½½å™¨ï¼Œå¹¶å°†æ–‡æ¡£å†…å®¹åŠ è½½ä¸ºå­—ç¬¦ä¸² <strong>content</strong>ï¼Œæ”¯æŒå¤šé¡µæ–‡æ¡£çš„åˆå¹¶å¤„ç†ã€‚</p><p><strong>è°ƒæ•´RAGç´¢å¼•æµç¨‹æ–¹æ³•ï¼Œå¤„ç†æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰ç±»å‹çš„æ–‡æ¡£æ–‡ä»¶ï¼Œindexing_processè°ƒæ•´éƒ¨åˆ†ï¼š</strong></p><pre><code class=\"language-plain\">def indexing_process(folder_path, embedding_model):\n    \"\"\"\n    ç´¢å¼•æµç¨‹ï¼šåŠ è½½æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡æ¡£æ–‡ä»¶ï¼Œå¹¶å°†å…¶å†…å®¹åˆ†å‰²æˆæ–‡æ¡£å—ï¼Œè®¡ç®—è¿™äº›å°å—çš„åµŒå…¥å‘é‡å¹¶å°†å…¶å­˜å‚¨åœ¨Faisså‘é‡æ•°æ®åº“ä¸­ã€‚\n    :param folder_path: æ–‡æ¡£æ–‡ä»¶å¤¹è·¯å¾„\n    :param embedding_model: é¢„åŠ è½½çš„åµŒå…¥æ¨¡å‹\n    :return: è¿”å›FaissåµŒå…¥å‘é‡ç´¢å¼•å’Œåˆ†å‰²åçš„æ–‡æœ¬å—åŸå§‹å†…å®¹åˆ—è¡¨\n    \"\"\"\n    # åˆå§‹åŒ–ç©ºçš„chunksåˆ—è¡¨ï¼Œç”¨äºå­˜å‚¨æ‰€æœ‰æ–‡æ¡£æ–‡ä»¶çš„æ–‡æœ¬å—\n    all_chunks = []\n\n    # éå†æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡æ¡£æ–‡ä»¶\n    for filename in os.listdir(folder_path):\n        file_path = os.path.join(folder_path, filename)\n        # æ£€æŸ¥æ˜¯å¦ä¸ºæ–‡ä»¶\n        if os.path.isfile(file_path):\n            # è§£ææ–‡æ¡£æ–‡ä»¶ï¼Œè·å¾—æ–‡æ¡£å­—ç¬¦ä¸²å†…å®¹\n            document_text = load_document(file_path)\n            print(f\"æ–‡æ¡£ {filename} çš„æ€»å­—ç¬¦æ•°: {len(document_text)}\")\n            # é…ç½®RecursiveCharacterTextSplitteråˆ†å‰²æ–‡æœ¬å—åº“å‚æ•°ï¼Œæ¯ä¸ªæ–‡æœ¬å—çš„å¤§å°ä¸º512å­—ç¬¦ï¼ˆétokenï¼‰ï¼Œç›¸é‚»æ–‡æœ¬å—ä¹‹é—´çš„é‡å 128å­—ç¬¦ï¼ˆétokenï¼‰\n            text_splitter = RecursiveCharacterTextSplitter(\n                chunk_size=512, chunk_overlap=128\n            )\n            # å°†æ–‡æ¡£æ–‡æœ¬åˆ†å‰²æˆæ–‡æœ¬å—Chunk\n            chunks = text_splitter.split_text(document_text)\n            print(f\"æ–‡æ¡£ {filename} åˆ†å‰²çš„æ–‡æœ¬Chunkæ•°é‡: {len(chunks)}\")\n            # å°†åˆ†å‰²çš„æ–‡æœ¬å—æ·»åŠ åˆ°æ€»chunksåˆ—è¡¨ä¸­\n            all_chunks.extend(chunks)\n\n    # æ–‡æœ¬å—è½¬åŒ–ä¸ºåµŒå…¥å‘é‡åˆ—è¡¨ï¼Œnormalize_embeddingsè¡¨ç¤ºå¯¹åµŒå…¥å‘é‡è¿›è¡Œå½’ä¸€åŒ–ï¼Œç”¨äºå‡†ç¡®è®¡ç®—ç›¸ä¼¼åº¦\n    ......çœç•¥æœªæ”¹åŠ¨éƒ¨åˆ†\n\n    return index, all_chunks\n</code></pre><p>ä¸Šè¿°ä»£ç æ˜¯åœ¨ä¸Šä¸€è®²çš„ <strong>indexing_process</strong> å‡½æ•°åŸºç¡€ä¸Šè¿›è¡Œäº†è¿­ä»£ï¼Œæ–°å¢äº†æ‰¹é‡å¤„ç†å¤šç§æ ¼å¼æ–‡æ¡£æ–‡ä»¶çš„åŠŸèƒ½ã€‚è°ƒæ•´éƒ¨åˆ†ä¸ºå‡½æ•°éå†æ–‡ä»¶å¤¹ä¸­çš„æ‰€æœ‰æ–‡æ¡£æ–‡ä»¶ï¼Œé€šè¿‡è°ƒç”¨ <strong>load_document</strong> è·å–æ–‡æ¡£çš„å­—ç¬¦ä¸²å†…å®¹ï¼Œå¹¶å°†å…¶åˆ‡åˆ†ä¸º<strong>æ–‡æœ¬å— chunks</strong>ï¼Œç„¶åå°†æ‰€æœ‰æ–‡æ¡£çš„ chunks æ±‡æ€»åˆ°ä¸€ä¸ªæ€»åˆ—è¡¨ <strong>all_chunks</strong> ä¸­ã€‚å½“å‰çš„å®ç°ä¸»è¦èšç„¦äºæ–‡æ¡£è§£ææŠ€æœ¯ï¼Œchunks å’Œå¯¹åº”çš„åµŒå…¥å‘é‡ <strong>index</strong> æš‚æ—¶å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼ŒæŒä¹…åŒ–å­˜å‚¨çš„éƒ¨åˆ†å°†åœ¨åç»­çš„å‘é‡åº“è¯¾ç¨‹ä¸­è¯¦ç»†è®²è§£ã€‚</p><p><strong>æµ‹è¯•è„šæœ¬ main å‡½æ•°å¯¹åº”è°ƒæ•´ï¼š</strong></p><pre><code class=\"language-plain\"># ç´¢å¼•æµç¨‹ï¼šåŠ è½½æ–‡ä»¶å¤¹ä¸­å„ç§æ ¼å¼æ–‡æ¡£ï¼Œåˆ†å‰²æ–‡æœ¬å—ï¼Œè®¡ç®—åµŒå…¥å‘é‡ï¼Œå­˜å‚¨åœ¨Faissç´¢å¼•ä¸­ï¼ˆå†…å­˜ï¼‰\nindex, chunks = indexing_process('rag_app/data_lesson3', embedding_model)\n</code></pre><p>å…ˆå‚ç…§ç¬¬02è®²çš„å¤§æ¨¡å‹å‚æ•°é…ç½®æ–¹æ³•ï¼Œé…ç½® qwen_model ä¸ qwen_api_key å‚æ•°åï¼Œåœ¨å‘½ä»¤è¡Œçª—å£ä¸­æ‰§è¡ŒæŒ‡ä»¤å®šä½åˆ°å…·ä½“çš„RAGé¡¹ç›®æ–‡ä»¶å¤¹ï¼Œåœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤å³å¯å¼€å§‹RAGåº”ç”¨æµ‹è¯•ï¼š</p><pre><code class=\"language-plain\">source rag_env/bin/activate  # æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ\npython rag_app/rag_app_lesson3.py # æ‰§è¡ŒRAGåº”ç”¨è„šæœ¬\n</code></pre><p><strong>data_lesson3</strong> æ–‡ä»¶å¤¹å†…ç½®äº†æœ¬è¯¾ç¨‹æ¶‰åŠçš„æ‰€æœ‰æ ¼å¼çš„æµ‹è¯•æ–‡æ¡£æ–‡ä»¶ï¼Œæ‰€æœ‰æ–‡ä»¶çš„ä¿¡æ¯ä¿æŒä¸€è‡´ï¼Œæ—¨åœ¨è§‚å¯Ÿä¸åŒæ ¼å¼æ–‡æ¡£çš„è§£ææ•ˆæœã€‚æµ‹è¯•ä»£ç é€šè¿‡ main å‡½æ•°ä¸²è”å„ä¸ªæ­¥éª¤ï¼Œç´¢å¼•æµç¨‹å°† data_lesson3 ä¸­æ‰€æœ‰çš„æ–‡æ¡£æ–‡ä»¶è¿›è¡Œè§£æï¼Œå‡†ç¡®å®Œæˆâ€œä¸‹é¢æŠ¥å‘Šä¸­æ¶‰åŠäº†å“ªå‡ ä¸ªè¡Œä¸šçš„æ¡ˆä¾‹ä»¥åŠæ€»ç»“å„è‡ªé¢ä¸´çš„æŒ‘æˆ˜ï¼Ÿâ€çš„RAGé—®ç­”ä»»åŠ¡ã€‚</p><h2>PDFæ–‡æ¡£è§£æ</h2><p><strong>PDFæ–‡ä»¶</strong>åœ¨æˆ‘ä»¬çš„ä¸šåŠ¡åœºæ™¯ä¸­å æœ‰æœ€é«˜çš„æ¯”ä¾‹ï¼Œå¹¿æ³›åº”ç”¨äºå•†ä¸šã€å­¦æœ¯å’Œä¸ªäººé¢†åŸŸã€‚å°½ç®¡PDFæ–‡ä»¶çš„å†…å®¹åœ¨è¡¨è¾¾å›¾åƒã€æ–‡å­—å’Œè¡¨æ ¼ä¿¡æ¯ï¼Œä½†å…¶æœ¬è´¨ä¸Šæ˜¯ä¸€ç³»åˆ—æ˜¾ç¤ºå’Œæ‰“å°æŒ‡ä»¤çš„é›†åˆã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå³ä½¿æ˜¯ä¸€ä¸ªä»…åŒ…å« â€œHello Worldâ€ æ–‡å­—çš„ç®€å•PDFï¼Œå…¶æ–‡ä»¶å†…å®¹ä¹Ÿæ˜¯ä¸€é•¿ä¸²çš„æ‰“å°æŒ‡ä»¤ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/8c/2e/8c8a7606519e3137b687392yyfbe812e.jpg?wh=1920x1249\" alt=\"å›¾ç‰‡\"></p><p>PDFæ–‡ä»¶çš„æ˜¾ç¤ºæ•ˆæœä¸å—è®¾å¤‡ã€è½¯ä»¶æˆ–ç³»ç»Ÿçš„å½±å“ï¼Œä½†å¯¹è®¡ç®—æœºè€Œè¨€ï¼Œå®ƒæ˜¯ä¸€ç§éæ•°æ®ç»“æ„åŒ–çš„æ ¼å¼ï¼Œå‚¨å­˜çš„ä¿¡æ¯æ— æ³•ç›´æ¥è¢«ç†è§£ã€‚æ­¤å¤–ï¼Œå¤§æ¨¡å‹çš„è®­ç»ƒæ•°æ®ä¸­ä¸åŒ…å«ç›´æ¥çš„PDFæ–‡ä»¶ï¼Œæ— æ³•ç›´æ¥ç†è§£ã€‚</p><p>PDFè§£æï¼Œå¯¹äºçº¯æ–‡æœ¬æ ¼å¼å¯ä»¥è½¬æ¢ä¸ºæ–‡æœ¬å­—ç¬¦ä¸²ï¼Œè€Œå¯¹äºåŒ…å«å¤šç§å…ƒç´ çš„å¤æ‚æ ¼å¼ï¼Œé€‰æ‹© <strong>MarkDown æ–‡ä»¶</strong>ä½œä¸ºç»Ÿä¸€çš„è¾“å‡ºæ ¼å¼æœ€ä¸ºåˆé€‚ã€‚è¿™æ˜¯å› ä¸ºMarkDownæ–‡ä»¶å…³æ³¨å†…å®¹æœ¬èº«ï¼Œè€Œéæ‰“å°æ ¼å¼ï¼Œèƒ½å¤Ÿè¡¨ç¤ºå¤šç§æ–‡æ¡£å…ƒç´ å†…å®¹ã€‚MarkDownæ ¼å¼è¢«å¹¿æ³›æ¥å—äºäº’è”ç½‘ä¸–ç•Œï¼Œå…¶ä¿¡æ¯èƒ½å¤Ÿè¢«å¤§æ¨¡å‹ç†è§£ã€‚</p><p>PDFæ–‡ä»¶åˆ†ä¸ºç”µå­ç‰ˆå’Œæ‰«æç‰ˆã€‚PDFç”µå­ç‰ˆå¯ä»¥<strong>é€šè¿‡è§„åˆ™è§£æ</strong>ï¼Œæå–å‡ºæ–‡æœ¬ã€è¡¨æ ¼ç­‰æ–‡æ¡£å…ƒç´ ã€‚ç›®å‰ï¼Œæœ‰è®¸å¤šå¼€æºåº“å¯ä»¥æ”¯æŒï¼Œä¾‹å¦‚ <strong>pyPDF2ã€PyMuPDFã€pdfminerã€pdfplumberå’Œpapermage</strong> ç­‰ã€‚è¿™äº›åº“åœ¨ langchain_community.document_loaders ä¸­åŸºæœ¬éƒ½æœ‰å¯¹åº”çš„åŠ è½½å™¨ï¼Œæ–¹ä¾¿åœ¨ä¸åŒåœºæ™¯ä¸‹åˆ‡æ¢ä½¿ç”¨ã€‚</p><p>åœ¨åŸºäºè§„åˆ™çš„å¼€æºåº“ä¸­ï¼Œpdfplumberå¯¹ä¸­æ–‡æ”¯æŒè¾ƒå¥½ï¼Œä¸”åœ¨è¡¨æ ¼è§£ææ–¹é¢è¡¨ç°ä¼˜ç§€ï¼Œä½†å¯¹åŒæ æ–‡æœ¬çš„è§£æèƒ½åŠ›è¾ƒå·®ï¼›pdfminerå’ŒPyMuPDFå¯¹ä¸­æ–‡æ”¯æŒè‰¯å¥½ï¼Œä½†è¡¨æ ¼è§£ææ•ˆæœè¾ƒå¼±ï¼›pyPDF2å¯¹è‹±æ–‡æ”¯æŒè¾ƒå¥½ï¼Œä½†ä¸­æ–‡æ”¯æŒè¾ƒå·®ï¼›papermageé›†æˆäº†pdfminerå’Œå…¶ä»–å·¥å…·ï¼Œç‰¹åˆ«é€‚åˆå¤„ç†è®ºæ–‡åœºæ™¯ã€‚å¼€å‘è€…å¯ä»¥æ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯çš„æµ‹è¯•ç»“æœé€‰æ‹©åˆé€‚çš„å·¥å…·ï¼Œpdfplumberæˆ–pdfmineréƒ½æ˜¯å½“å‰ä¸é”™çš„é€‰æ‹©ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/2c/8f/2ce37e8a03fa9170abd06f7673d3878f.jpg?wh=1920x1080\" alt=\"å›¾ç‰‡\"></p><p>PDFæ‰«æç‰ˆéœ€è¦ç»è¿‡æ–‡æœ¬è¯†åˆ«å’Œè¡¨æ ¼è¯†åˆ«PDFæ‰«æå›¾åƒï¼Œæ‰èƒ½æå–å‡ºæ–‡æ¡£ä¸­çš„å„ç±»å…ƒç´ ã€‚åŒæ—¶è¦çœŸæ­£å®ç°æ–‡æ¡£è§£æçš„ç›®æ ‡ï¼Œæ— è®ºæ‰«æç‰ˆè¿˜æ˜¯ç”µå­ç‰ˆå‡éœ€è¿›è¡Œç‰ˆé¢åˆ†æå’Œé˜…è¯»é¡ºåºçš„è¿˜åŸï¼Œå°†å†…å®¹è§£æä¸ºä¸€ä¸ªåŒ…å«æ‰€æœ‰æ–‡æ¡£å…ƒç´ å¹¶ä¸”å…·æœ‰æ­£ç¡®é˜…è¯»é¡ºåºçš„MarkDownæ–‡ä»¶ã€‚å•çº¯ä¾èµ–è§„åˆ™è§£ææ˜¯æ— æ³•å®ç°è¿™ä¸€ç›®æ ‡çš„ï¼Œç›®å‰æ”¯æŒè¿™äº›åŠŸèƒ½çš„å¤šä¸º<strong>åŸºäºæ·±åº¦å­¦ä¹ çš„å¼€æºåº“ï¼Œå¦‚ Layout-parserã€PP-StructureV2ã€PDF-Extract-Kitã€pix2textã€MinerUã€markerç­‰</strong>ã€‚</p><p>ç„¶è€Œï¼Œç”±äºæ·±åº¦å­¦ä¹ æ¨¡å‹çš„éƒ¨ç½²å¤æ‚æ€§ä»¥åŠå¯¹æ˜¾å¡é…ç½®çš„è¦æ±‚ï¼Œè¿™äº›åº“å°šæœªé›†æˆåœ¨ langchain_community.document_loaders ä¸­ï¼Œä½¿ç”¨æ—¶éœ€è¦è¿›è¡Œç‹¬ç«‹éƒ¨ç½²ã€‚æˆ‘åœ¨ä¸‹é¢åˆ—å‡ºäº†æ¨¡å‹ç›¸å…³ä¿¡æ¯å’ŒGitHubé“¾æ¥ï¼Œä½ å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚è¿›è¡Œé€‰æ‹©å’Œå®‰è£…ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/09/8d/09fc408d1158186389a40c755bc4088d.png?wh=1902x1502\" alt=\"å›¾ç‰‡\"></p><p>ç”±äºPDFæ–‡æ¡£è§£ææ•´ä½“æµç¨‹ç”¨åˆ°äº†å¤šä¸ªæ·±åº¦å­¦ä¹ æ¨¡å‹ç»„åˆï¼ŒçœŸæ­£åœ¨ç”Ÿäº§åœºæ™¯ä¸­ä¼šé‡åˆ°æ•ˆç‡é—®é¢˜ã€‚<strong>å•†ä¸šé—­æºåº“</strong>ç”±äºå…¶éƒ¨ç½²çš„äº‘ç«¯é›†ç¾¤å¯ä»¥åšå¹¶è¡Œå¤„ç†å’Œå·¥ç¨‹æ•ˆç‡ä¼˜åŒ–ï¼Œæ‰€ä»¥åœ¨ç²¾åº¦å’Œæ•ˆç‡ä¸Šéƒ½èƒ½åšåˆ°ç”Ÿäº§ä¸­çš„çº§åˆ«ï¼Œæ¯”å¦‚TextIn.comã€Doc2xã€mathpixã€åº–ä¸PDFluxã€è…¾è®¯äº‘æ–‡æ¡£è¯†åˆ«ç­‰ï¼Œå½“ç„¶å•†ä¸šåº“ä¼šå­˜åœ¨æˆæœ¬é—®é¢˜ï¼Œä½ å¯ä»¥æŒ‰éœ€é€‰æ‹©ã€‚</p><p>æ­¤å¤–ï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥æ¢ç´¢PDFä¸­çš„å›¾åƒå†…å®¹ç†è§£ï¼Œä¸ä»…é™äºæ–‡å­—æ¨¡æ€ï¼Œè¿˜åŒ…æ‹¬å¯¹å›¾ç‰‡ä¸­éæ–‡å­—å†…å®¹çš„è§£æï¼Œå¦‚å¸¸è§çš„æŠ˜çº¿å›¾ã€æŸ±çŠ¶å›¾ç­‰ï¼Œä¹ŸåŒ…å«é‡è¦çš„å†…å®¹ä¿¡æ¯ã€‚å°†è¿™äº›å†…å®¹è½¬æ¢ä¸ºæ–‡å­—å½¢å¼å¹¶åµŒå…¥åˆ°MarkDownæ–‡ä»¶ä¸­ï¼Œé€šå¸¸éœ€è¦ä¾èµ–<strong>ç«¯åˆ°ç«¯çš„å¤šæ¨¡æ€å¤§æ¨¡å‹</strong>ï¼Œå¦‚GPT-4oæˆ–Geminiã€‚ç„¶è€Œï¼Œç›®å‰è¿™äº›æ¨¡å‹åœ¨æ•ˆç‡å’Œæˆæœ¬æ–¹é¢ä»å­˜åœ¨æŒ‘æˆ˜ï¼Œä½†å…¶æœªæ¥æ½œåŠ›å·¨å¤§ï¼Œå€¼å¾—æœŸå¾…ã€‚</p><h2>æ€»ç»“</h2><p>è¿™èŠ‚è¯¾æˆ‘ä»¬æ·±å…¥æ¢è®¨äº†RAGç´¢å¼•æµç¨‹ä¸­çš„æ–‡æ¡£è§£ææŠ€æœ¯ï¼Œé€šè¿‡ç†è®ºä¸å®æˆ˜ä»£ç å±•ç¤ºäº†LangChain Document Loaders æ–‡æ¡£åŠ è½½å™¨ä»¥åŠ PDFã€TXTã€Wordã€PPTã€Excelã€CSVã€Markdownã€XMLã€HTML å¤šç§æ ¼å¼çš„è§£ææ–¹æ³•ã€‚åŒæ—¶æˆ‘ä»¬å¯¹PDFæ–‡ä»¶çš„è§£æè¿›è¡Œäº†è¿›é˜¶åˆ†æï¼Œæ¶µç›–äº†åŸºäºè§„åˆ™çš„å¼€æºåº“ã€åŸºäºæ·±åº¦å­¦ä¹ çš„å¼€æºåº“ï¼Œä»¥åŠå•†ä¸šé—­æºåº“çš„æŠ€æœ¯è¯´æ˜ä¸é€‰å‹æŒ‡å—ã€‚æœ€åè¯´æ˜äº†ç«¯åˆ°ç«¯çš„å¤šæ¨¡æ€å¤§æ¨¡å‹åœ¨æ–‡æ¡£è§£æé¢†åŸŸåº”ç”¨å’Œæ½œåŠ›ã€‚</p><p><strong>é€‰ç”¨é€‚åˆä¸šåŠ¡åœºæ™¯çš„æ”¯æŒå¤šæ ¼å¼ã€å¤šç‰ˆå¼ã€é«˜ç²¾åº¦ã€é«˜æ•ˆç‡çš„æ–‡æ¡£è§£ææŠ€æœ¯ï¼Œæ˜¯æ„å»ºæˆåŠŸRAGç³»ç»Ÿçš„åŸºç¡€ã€‚</strong>ç›¸å…³ä»£ç å·²å…¬å¼€åœ¨<a href=\"https://gitee.com/techleadcy/rag_app\">Gitee ä»£ç ä»“åº“</a>ä¸­äº†ï¼Œä»£ç æ–‡ä»¶ä¸º rag_app_lesson3.pyã€‚</p><h2>æ€è€ƒé¢˜</h2><p>åœ¨ä½ çš„RAGç³»ç»Ÿæ‰€æ¶‰åŠçš„å…·ä½“ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œæ–‡æ¡£å…ƒç´ çš„ç±»åˆ«è¯†åˆ«æ˜¯å¦æœ‰åŠ©äºåç»­çš„æ–‡æœ¬åˆ†å—å’Œæå‡RAGç³»ç»Ÿçš„æ•ˆæœï¼Ÿå¦‚æœæœ‰ï¼Œè¯·ä¸¾ä¾‹è¯´æ˜å…·ä½“æƒ…å†µã€‚æ¬¢è¿ä½ ç•™è¨€å‚ä¸è®¨è®ºï¼Œå¦‚æœä½ è§‰å¾—è¿™èŠ‚è¯¾çš„å†…å®¹å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œä¹Ÿæ¬¢è¿ä½ åˆ†äº«ç»™å…¶ä»–æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","comments":[{"had_liked":false,"id":395140,"user_name":"å¼ ç”³å‚²","can_delete":false,"product_type":"c1","uid":1182372,"ip_address":"åŒ—äº¬","ucode":"22D46BC529BA8A","user_header":"https://static001.geekbang.org/account/avatar/00/12/0a/a4/828a431f.jpg","comment_is_top":false,"comment_ctime":1729583318,"is_pvip":false,"replies":[{"id":143482,"content":"æ¬¢è¿æ‰“å¡ï½","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3954065,"ctime":1729650721,"ip_address":"ä¸Šæµ·","comment_id":395140,"utype":1}],"discussion_count":1,"race_medal":2,"score":2,"product_id":100804101,"comment_content":"ç¬¬3è®²æ‰“å¡~","like_count":1,"discussions":[{"author":{"id":3954065,"avatar":"https://static001.geekbang.org/account/avatar/00/3c/55/91/e3c96b88.jpg","nickname":"å¸¸æ‰¬","note":"","ucode":"11B62CDABBE875","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":652799,"discussion_content":"æ¬¢è¿æ‰“å¡ï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1729650721,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":393934,"user_name":"Jaycee-å¼ å°‘åŒ","can_delete":false,"product_type":"c1","uid":1992400,"ip_address":"è¾½å®","ucode":"92C60380B37BE6","user_header":"https://static001.geekbang.org/account/avatar/00/1e/66/d0/2fb761be.jpg","comment_is_top":false,"comment_ctime":1725373092,"is_pvip":false,"replies":[{"id":143050,"content":"æ˜¯çš„ï¼Œexcelå³æ˜¯æ–‡æ¡£ï¼Œä¹Ÿæ˜¯äºŒç»´æ•°æ®çš„å‘ˆç°ã€‚è€Œå¤§æ¨¡å‹å¯ä»¥ç†è§£äºŒç»´è¡Œåˆ—æ•°æ®çš„å½¢å¼æ˜¯markdownã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3954065,"ctime":1725627501,"ip_address":"ä¸Šæµ·","comment_id":393934,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100804101,"comment_content":"å®é™…å·¥ä½œåœºæ™¯ä¸­æˆ‘è®¤ä¸ºpdf doc docxæ–‡ä»¶å…ƒç´ æ˜¯æ„å»ºå­—ç¬¦åˆ‡å—çš„ä¸»è¦ç±»å‹ï¼Œå¦ä¹Ÿå¯åŠ å…¥pptæ¼”ç¤ºæ–‡ä»¶å†…çš„æ–‡æœ¬å­—ç¬¦ã€‚ä¸¥æ ¼è¯´æˆ‘è®¤ä¸ºexcelè¡¨æ ¼æ–‡ä»¶åº”å½“æ˜¯ä»½å±db gptçš„äº‹æƒ…ã€‚ä¸è¿‡äº‹äº‹æ— ç»å¯¹ï¼Œæ¬¢è¿æ¢è®¨","like_count":1,"discussions":[{"author":{"id":3954065,"avatar":"https://static001.geekbang.org/account/avatar/00/3c/55/91/e3c96b88.jpg","nickname":"å¸¸æ‰¬","note":"","ucode":"11B62CDABBE875","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":650802,"discussion_content":"æ˜¯çš„ï¼Œexcelå³æ˜¯æ–‡æ¡£ï¼Œä¹Ÿæ˜¯äºŒç»´æ•°æ®çš„å‘ˆç°ã€‚è€Œå¤§æ¨¡å‹å¯ä»¥ç†è§£äºŒç»´è¡Œåˆ—æ•°æ®çš„å½¢å¼æ˜¯markdownã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1725627501,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":395716,"user_name":"Grain Buds","can_delete":false,"product_type":"c1","uid":3958939,"ip_address":"æ¾³å¤§åˆ©äºš","ucode":"9133A6043B1637","user_header":"https://static001.geekbang.org/account/avatar/00/3c/68/9b/d53ebac5.jpg","comment_is_top":false,"comment_ctime":1731833346,"is_pvip":false,"replies":[{"id":143746,"content":"å¯ä»¥è°ƒæ•´chunk sizeå’Œchunk overlapæ¥æ„Ÿå—åˆ†å—çš„ä¸åŒï¼Œä»¥åŠå¯¹äºç»“æœçš„å½±å“","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3954065,"ctime":1732267336,"ip_address":"ä¸Šæµ·","comment_id":395716,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100804101,"comment_content":"è¯¾ç¨‹ä»£ç é¡ºåˆ©è·‘é€šï¼Œä½†æ˜¯ç”Ÿæˆç»“æœå‡†ç¡®æ€§ä¸è¶³å‘¢ï¼Ÿç”Ÿæˆå›ç­”ä¸­ï¼Œæœ‰å…³é‡‘èä¸šçš„éƒ¨åˆ†å¹¶æ²¡æœ‰æå–åˆ°ï¼Œä»…åšäº†ç®€ç•¥æè¿°","like_count":0,"discussions":[{"author":{"id":3954065,"avatar":"https://static001.geekbang.org/account/avatar/00/3c/55/91/e3c96b88.jpg","nickname":"å¸¸æ‰¬","note":"","ucode":"11B62CDABBE875","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":654264,"discussion_content":"å¯ä»¥è°ƒæ•´chunk sizeå’Œchunk overlapæ¥æ„Ÿå—åˆ†å—çš„ä¸åŒï¼Œä»¥åŠå¯¹äºç»“æœçš„å½±å“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1732267336,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":395679,"user_name":"Seachal","can_delete":false,"product_type":"c1","uid":1301397,"ip_address":"åŒ—äº¬","ucode":"A6F69EA7879EEF","user_header":"https://static001.geekbang.org/account/avatar/00/13/db/95/daad899f.jpg","comment_is_top":false,"comment_ctime":1731657297,"is_pvip":false,"replies":[{"id":143742,"content":"åŠ æ²¹åŠ æ²¹ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3954065,"ctime":1732249806,"ip_address":"ä¸Šæµ·","comment_id":395679,"utype":1}],"discussion_count":1,"race_medal":1,"score":2,"product_id":100804101,"comment_content":"ç¬¬3è®²æ‰“å¡~","like_count":0,"discussions":[{"author":{"id":3954065,"avatar":"https://static001.geekbang.org/account/avatar/00/3c/55/91/e3c96b88.jpg","nickname":"å¸¸æ‰¬","note":"","ucode":"11B62CDABBE875","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":654255,"discussion_content":"åŠ æ²¹åŠ æ²¹ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1732249806,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":395242,"user_name":"kevin","can_delete":false,"product_type":"c1","uid":3920101,"ip_address":"å¹¿ä¸œ","ucode":"19E83C631DF25E","user_header":"https://static001.geekbang.org/account/avatar/00/3b/d0/e5/0a3ee17c.jpg","comment_is_top":false,"comment_ctime":1729835623,"is_pvip":false,"replies":[{"id":143529,"content":"è¿™ä¸ªè¦çœ‹å…·ä½“æŠ¥é”™çš„æƒ…å†µæ¥è¿›è¡Œåˆ¤æ–­å’Œè°ƒæ•´ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3954065,"ctime":1730455434,"ip_address":"ä¸Šæµ·","comment_id":395242,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100804101,"comment_content":"åœ¨windowsä¸‹è¿è¡Œï¼Œcsvå¯ä»¥è§£æï¼Œä½†docä¸€è§£æç³»ç»Ÿå°±æŒ‚äº†ï¼Œä¹Ÿä¸çŸ¥é“æ€ä¹ˆå›äº‹ï¼Œè£…äº†LibreOffice 24.8","like_count":0,"discussions":[{"author":{"id":3954065,"avatar":"https://static001.geekbang.org/account/avatar/00/3c/55/91/e3c96b88.jpg","nickname":"å¸¸æ‰¬","note":"","ucode":"11B62CDABBE875","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":653230,"discussion_content":"è¿™ä¸ªè¦çœ‹å…·ä½“æŠ¥é”™çš„æƒ…å†µæ¥è¿›è¡Œåˆ¤æ–­å’Œè°ƒæ•´ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1730455434,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":394466,"user_name":"å½±æ˜","can_delete":false,"product_type":"c1","uid":1068202,"ip_address":"ä¸Šæµ·","ucode":"B04342834CF114","user_header":"https://static001.geekbang.org/account/avatar/00/10/4c/aa/37705e4e.jpg","comment_is_top":false,"comment_ctime":1726881970,"is_pvip":false,"replies":[{"id":143211,"content":"çœ‹ä½ çš„æŠ¥é”™æ˜¯æ–‡ä»¶è·¯å¾„é”™è¯¯é—®é¢˜ï¼Œå…ˆç¡®è®¤æ–‡ä»¶è·¯å¾„è¾“å…¥æ­£ç¡®","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3954065,"ctime":1727057430,"ip_address":"ä¸Šæµ·","comment_id":394466,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100804101,"comment_content":"åœ¨windowsä¸‹è¿è¡Œï¼Œcsvå¯ä»¥è§£æï¼Œä½†docxæŠ¥é”™ï¼š\næ–‡æ¡£ .&#47;data_lesson3\\test.csv çš„éƒ¨åˆ†å†…å®¹ä¸º: æ¡ˆä¾‹åç§°: åˆ¶é€ ä¸šçš„æ•°å­—åŒ–è½¬å‹\nå…¬å¸èƒŒæ™¯: åˆ¶é€ ä¸šæ¡ˆä¾‹ä»‹ç»äº†ä¸€å®¶æˆç«‹äº20ä¸–çºªåˆçš„å¾·å›½è€ç‰Œæ±½è½¦åˆ¶é€ å…¬å¸ï¼Œæ‹¥æœ‰æ‚ ä¹…çš„å†å²å’Œä¸°å¯Œçš„åˆ¶é€ ç»éªŒã€‚é¢å¯¹æ—¥ç›Šæ¿€çƒˆçš„å¸‚åœºç«äº‰å’Œæ¶ˆè´¹è€…éœ€æ±‚çš„å˜åŒ–ï¼Œå…¬å¸æ„è¯†åˆ°ä¼ ç»Ÿåˆ¶é€ æ¨¡å¼...\næ–‡æ¡£ test.csv çš„æ€»å­—ç¬¦æ•°: 1262\næ–‡æ¡£ test.csv åˆ†å‰²çš„æ–‡æœ¬Chunkæ•°é‡: 3\nsoffice failed to convert to format docx:MS Word 2007 XML with code 0\nError: source file could not be loaded\nTraceback (most recent call last):\n  File &quot;c:\\Users\\yingm\\LAB\\PycharmProjects\\rag_app\\rag_app_lesson3.py&quot;, line 238, in &lt;module&gt;\n    main()\n  File &quot;c:\\Users\\yingm\\LAB\\PycharmProjects\\rag_app\\rag_app_lesson3.py&quot;, line 227, in main\n    index, chunks = indexing_process(&#39;.&#47;data_lesson3&#39;, embedding_model)\n  File &quot;c:\\Users\\yingm\\LAB\\PycharmProjects\\rag_app\\rag_app_lesson3.py&quot;, line 93, in indexing_process\n    document_text = load_document(file_path)\n  File &quot;c:\\Users\\yingm\\LAB\\PycharmProjects\\rag_app\\rag_app_lesson3.py&quot;, line 55, in load_document\n    documents = loader.load()  # åŠ è½½æ–‡æ¡£\n ......\n    elements = func(*args, **kwargs)\n  File &quot;C:\\Users\\yingm\\.conda\\envs\\rag_env_39\\lib\\site-packages\\unstructured\\partition\\docx.py&quot;, line 160, in partition_docx\n    opts = DocxPartitionerOptions.load(\n  File &quot;C:\\Users\\yingm\\.conda\\envs\\rag_env_39\\lib\\site-packages\\unstructured\\partition\\docx.py&quot;, line 222, in load\n    return cls(**kwargs)._validate()\n  File &quot;C:\\Users\\yingm\\.conda\\envs\\rag_env_39\\lib\\site-packages\\unstructured\\partition\\docx.py&quot;, line 376, in _validate\n    raise FileNotFoundError(f&quot;no such file or directory: {repr(self._file_path)}&quot;)\nFileNotFoundError: no such file or directory: &#39;C:\\\\Users\\\\yingm\\\\AppData\\\\Local\\\\Temp\\\\tmpij10aiti\\\\test.docx&#39;","like_count":0,"discussions":[{"author":{"id":3954065,"avatar":"https://static001.geekbang.org/account/avatar/00/3c/55/91/e3c96b88.jpg","nickname":"å¸¸æ‰¬","note":"","ucode":"11B62CDABBE875","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":651554,"discussion_content":"çœ‹ä½ çš„æŠ¥é”™æ˜¯æ–‡ä»¶è·¯å¾„é”™è¯¯é—®é¢˜ï¼Œå…ˆç¡®è®¤æ–‡ä»¶è·¯å¾„è¾“å…¥æ­£ç¡®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1727057430,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":393862,"user_name":"grok","can_delete":false,"product_type":"c1","uid":1341502,"ip_address":"ç¾å›½","ucode":"4744AB3FA28FE2","user_header":"https://static001.geekbang.org/account/avatar/00/14/78/3e/f60ea472.jpg","comment_is_top":false,"comment_ctime":1725138403,"is_pvip":false,"replies":null,"discussion_count":2,"race_medal":0,"score":2,"product_id":100804101,"comment_content":"ç»„é‡Œæœ‰ä¸ªé¡¹ç›®éœ€è¦å¤„ç†åˆåŒpdfï¼ˆæ‰«æä»¶&#47;è‹±æ–‡ï¼‰ï¼Œä¸»è¦éš¾ç‚¹æ˜¯å¤¹æ‚çš„ç‰¹æ®Šå­—ç¬¦å’Œå¸Œè…Šå­—æ¯ã€‚æ•ˆæœä¸è¾¾æ ‡ã€‚\nå·²å°è¯•ï¼š\nAdobe, Nitro, Azure Doc intelligence, GPT4o, ensemble of doc intelligence + gpt4o&#47;V\nä¸‹ä¸€æ­¥æ‰“ç®—å°è¯•ï¼š\nAWS Textract, Google Vision API, Nougat, Texify, Tesseract&#47;pytesseract","like_count":3,"discussions":[{"author":{"id":3919120,"avatar":"https://static001.geekbang.org/account/avatar/00/3b/cd/10/1b38a2f9.jpg","nickname":"å¤§èƒ¡","note":"","ucode":"0FBEDC2992D75D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":655434,"discussion_content":"æˆ‘éœ€è¦å¤„ç†çš„æ–‡æ¡£ä¹ŸåŸºæœ¬æ˜¯å¤šæ ¼å¼å†…å®¹ï¼Œè¯•äº†ä¸€ä¸‹Tesseract/pytesseractï¼Œæ˜¯çœŸä¸è¡Œï¼Œå­—ç¬¦çŠ¶æ€çš„PDFæå–æ•ˆæœå·®ã€‚æ”¹ç”¨æ‰“å°æˆå›¾åƒçš„PDFï¼Œé‡‡ç”¨å¤§æ¨¡å‹æ¥è¯†åˆ«åŸºæœ¬å¯ç”¨ï¼Œå°±æ˜¯æˆæœ¬è¿‡é«˜æ— æ³•å®ç”¨ã€‚ä¸çŸ¥é“æœ‰æ²¡ä»€ä¹ˆå¯è¡Œçš„æ–¹æ³•ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1734938199,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å››å·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3954065,"avatar":"https://static001.geekbang.org/account/avatar/00/3c/55/91/e3c96b88.jpg","nickname":"å¸¸æ‰¬","note":"","ucode":"11B62CDABBE875","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":650554,"discussion_content":"å®è·µå‡ºçœŸçŸ¥ï¼Œç‚¹èµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1725243974,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}