{"id":91990,"title":"15 | UITableViewCell的复用及原理","content":"<p><strong>PDF 课件和源代码下载地址：</strong></p><p><a href=\"https://gitee.com/geektime-geekbang/geektime-ios-course\">https://gitee.com/geektime-geekbang/geektime-ios-course</a></p>","comments":[{"had_liked":false,"id":215762,"user_name":"我来人间一趟","can_delete":false,"product_type":"c3","uid":1733144,"ip_address":"","ucode":"15CAF96EF899E2","user_header":"https://static001.geekbang.org/account/avatar/00/1a/72/18/d9e2fcf9.jpg","comment_is_top":false,"comment_ctime":1589098303,"is_pvip":false,"replies":[{"id":81392,"content":"\n当tableView在首次load的时候，tableView会根据estimatedRowHeight来计算在可视区的cell，并且进行初始化来提高性能。因为如果使用实际的cell高度，在初始化时需要进行大量的业务逻辑高度计算而降低性能。而在之后的布局绘制、以及滚动的时候，系统会根据heightForRowAtIndexPath返回的数值进行正确的处理。整体上这个流程不会影响滚动复用的逻辑，只是在初始化时的优化和策略。estimatedRowHeight系统有默认的值，所以推测你的场景使用默认值的时候，屏幕是可以展示下这些cell的（一般会比屏幕展示的多1-2个用于prepare）。当前场景可以设置tableView.estimatedRowHeight为一个较大的值看看效果, 应该就符合你的预期了。","user_name":"作者回复","user_name_real":"zzz","uid":1041455,"ctime":1590296165,"ip_address":"","comment_id":215762,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"老师我试了一下 如果设置了20个cell 初始化的时候直接创建了20个cell 无论是视口下的还是视口之外的","like_count":3,"discussions":[{"author":{"id":1041455,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJ3dLlYr6tznfnZXJNsD7Jw48BVnFSib3RO3VWEN0pgebRY1jaR8YXLQ6iaAjTsFiamOWSA3UPAa37A/132","nickname":"Geek_e7jq8k","note":"","ucode":"352964E5D793DA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494545,"discussion_content":"\n当tableView在首次load的时候，tableView会根据estimatedRowHeight来计算在可视区的cell，并且进行初始化来提高性能。因为如果使用实际的cell高度，在初始化时需要进行大量的业务逻辑高度计算而降低性能。而在之后的布局绘制、以及滚动的时候，系统会根据heightForRowAtIndexPath返回的数值进行正确的处理。整体上这个流程不会影响滚动复用的逻辑，只是在初始化时的优化和策略。estimatedRowHeight系统有默认的值，所以推测你的场景使用默认值的时候，屏幕是可以展示下这些cell的（一般会比屏幕展示的多1-2个用于prepare）。当前场景可以设置tableView.estimatedRowHeight为一个较大的值看看效果, 应该就符合你的预期了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590296165,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":94153,"user_name":"起风了001","can_delete":false,"product_type":"c3","uid":1529929,"ip_address":"","ucode":"8DCDBA40B8CC9F","user_header":"","comment_is_top":false,"comment_ctime":1557734187,"is_pvip":false,"replies":[{"id":35535,"content":"多谢 之后会注意一些Api场景的对比情况","user_name":"作者回复","user_name_real":"dequanzhu","uid":1041455,"ctime":1559132463,"ip_address":"","comment_id":94153,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"刚特意看了一下, 复用cell有两个方法, 一个是dequeueReusableCell(withIdentifier:) -&gt; UITableViewCell?, 另一个是dequeueReusableCell(withIdentifier: , for: ) -&gt; UITableViewCell. 平时一直都是用的第二个, 没注册cell的时候会报错, 所以我觉得如果可以的话, 顺便在视频里说一下这两个的场景区别会好一些. \n","like_count":2,"discussions":[{"author":{"id":1041455,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJ3dLlYr6tznfnZXJNsD7Jw48BVnFSib3RO3VWEN0pgebRY1jaR8YXLQ6iaAjTsFiamOWSA3UPAa37A/132","nickname":"Geek_e7jq8k","note":"","ucode":"352964E5D793DA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":449933,"discussion_content":"多谢 之后会注意一些Api场景的对比情况","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559132463,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":90217,"user_name":"戒惜舍得","can_delete":false,"product_type":"c3","uid":1454225,"ip_address":"","ucode":"694FE967317710","user_header":"https://static001.geekbang.org/account/avatar/00/16/30/91/5f770e29.jpg","comment_is_top":false,"comment_ctime":1556450772,"is_pvip":false,"replies":[{"id":32312,"content":"暂时不能哈","user_name":"作者回复","user_name_real":"dequanzhu","uid":1041455,"ctime":1556453662,"ip_address":"","comment_id":90217,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"大神后面那个大型demo 能TDD 开发不？","like_count":1,"discussions":[{"author":{"id":1041455,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJ3dLlYr6tznfnZXJNsD7Jw48BVnFSib3RO3VWEN0pgebRY1jaR8YXLQ6iaAjTsFiamOWSA3UPAa37A/132","nickname":"Geek_e7jq8k","note":"","ucode":"352964E5D793DA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448425,"discussion_content":"暂时不能哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556453662,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":156501,"user_name":"Daniel","can_delete":false,"product_type":"c3","uid":1231937,"ip_address":"","ucode":"8F7EA97BE78EAF","user_header":"https://static001.geekbang.org/account/avatar/00/12/cc/41/9d2d96ce.jpg","comment_is_top":false,"comment_ctime":1574903400,"is_pvip":false,"replies":[{"id":62012,"content":"不确定是不是使用的Demo，我这边看DEMO是没问题的，可以具体提供下代码，或者将有问题的项目发一下，我这边帮你看下具体的问题。通常这个问题和Simulator或者真机没有关系，一般是由于contentSize设置、cell数量和布局、以及scrollView设置导致的。","user_name":"作者回复","user_name_real":"zzz","uid":1041455,"ctime":1576676256,"ip_address":"","comment_id":156501,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"Simulator tableviewcell 滑动不了，该怎么办？","like_count":0,"discussions":[{"author":{"id":1041455,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJ3dLlYr6tznfnZXJNsD7Jw48BVnFSib3RO3VWEN0pgebRY1jaR8YXLQ6iaAjTsFiamOWSA3UPAa37A/132","nickname":"Geek_e7jq8k","note":"","ucode":"352964E5D793DA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476131,"discussion_content":"不确定是不是使用的Demo，我这边看DEMO是没问题的，可以具体提供下代码，或者将有问题的项目发一下，我这边帮你看下具体的问题。通常这个问题和Simulator或者真机没有关系，一般是由于contentSize设置、cell数量和布局、以及scrollView设置导致的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576676256,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":108347,"user_name":"Geek_b7eb88","can_delete":false,"product_type":"c3","uid":1573715,"ip_address":"","ucode":"0EB46381D9B1CB","user_header":"","comment_is_top":false,"comment_ctime":1561724731,"is_pvip":false,"replies":[{"id":39283,"content":"是的，准确的说会多几个，尤其在新的api中系统还会进行预加载。但是整体上的逻辑就是回收池不断的回收无须展示的，然后需要展示的从回收池中去取。","user_name":"作者回复","user_name_real":"dequanzhu","uid":1041455,"ctime":1561775362,"ip_address":"","comment_id":108347,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"老师，我感觉系统创建的cell数量，应该是多余屏幕上显示的cell数量吧。比如向上滑动的时候，上面的cell还没有完全滑出屏幕，但是下面的cell已经有一点展示在屏幕上了。这时候回收池应该不会回收最上面的cell，并且还要提供另一个cell给下面已经展示出一部分的cell。","like_count":0,"discussions":[{"author":{"id":1041455,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJ3dLlYr6tznfnZXJNsD7Jw48BVnFSib3RO3VWEN0pgebRY1jaR8YXLQ6iaAjTsFiamOWSA3UPAa37A/132","nickname":"Geek_e7jq8k","note":"","ucode":"352964E5D793DA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455928,"discussion_content":"是的，准确的说会多几个，尤其在新的api中系统还会进行预加载。但是整体上的逻辑就是回收池不断的回收无须展示的，然后需要展示的从回收池中去取。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561775362,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":90126,"user_name":"goggle1","can_delete":false,"product_type":"c3","uid":1285142,"ip_address":"","ucode":"9FC61068EE6E32","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erbR2CkXA6ZiaaaEDKa0rjom7Zr9ZFqTsCYS1E9UJ15v3dwXBO4KVP801xsUsvAH5dlDl5IKBsMaww/132","comment_is_top":false,"comment_ctime":1556421478,"is_pvip":false,"replies":[{"id":32396,"content":"没明白你的意思？切换进入什么？","user_name":"作者回复","user_name_real":"dequanzhu","uid":1041455,"ctime":1556517436,"ip_address":"","comment_id":90126,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"simulator里面上下滑动不了，这个是有切换进入的快捷键么？","like_count":0,"discussions":[{"author":{"id":1041455,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJ3dLlYr6tznfnZXJNsD7Jw48BVnFSib3RO3VWEN0pgebRY1jaR8YXLQ6iaAjTsFiamOWSA3UPAa37A/132","nickname":"Geek_e7jq8k","note":"","ucode":"352964E5D793DA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448399,"discussion_content":"没明白你的意思？切换进入什么？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556517436,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2076600,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/af/b8/458866d3.jpg","nickname":"Bo","note":"","ucode":"D5DD3300310C02","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378216,"discussion_content":"您是指鼠标按住屏幕不能拖动吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623115383,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89922,"user_name":"fisoul","can_delete":false,"product_type":"c3","uid":1070118,"ip_address":"","ucode":"3700D6AE2513AA","user_header":"https://static001.geekbang.org/account/avatar/00/10/54/26/358ba03b.jpg","comment_is_top":false,"comment_ctime":1556331502,"is_pvip":false,"replies":[{"id":32397,"content":"xcode版本是多少？我用xcode10.2.1 你用对是beta版的么？","user_name":"作者回复","user_name_real":"dequanzhu","uid":1041455,"ctime":1556517854,"ip_address":"","comment_id":89922,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"朱老师你好，听了你的课程觉得思路很清晰，对于新手学习帮助很大\n最近在跟着你的视频实践代码写的时候发现一些小问题，可能是因为我升级了最新版本的XCode，其中一些协议的函数中多了nonnull的修饰，比如\n- (NSInteger)tableView:(nonnull UITableView *)tableView numberOfRowsInSection:(NSInteger)section {\n    return 20;\n}\n如果按照视频里的没有nonnull的话会造成方法的空调用抛出异常\n不知道在这一块能不能有什么好办法来统一一下","like_count":0,"discussions":[{"author":{"id":1041455,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKJ3dLlYr6tznfnZXJNsD7Jw48BVnFSib3RO3VWEN0pgebRY1jaR8YXLQ6iaAjTsFiamOWSA3UPAa37A/132","nickname":"Geek_e7jq8k","note":"","ucode":"352964E5D793DA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448320,"discussion_content":"xcode版本是多少？我用xcode10.2.1 你用对是beta版的么？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556517854,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":288770,"user_name":"oioio","can_delete":false,"product_type":"c3","uid":1198227,"ip_address":"","ucode":"C3EC04586C5FCD","user_header":"https://static001.geekbang.org/account/avatar/00/12/48/93/27584b17.jpg","comment_is_top":false,"comment_ctime":1618664280,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"老师你好，请问使用的 TabBar 布局，为什么列表没有适配可视区域，占满整个屏幕，导致列表未显示完整：https:&#47;&#47;z3.ax1x.com&#47;2021&#47;04&#47;17&#47;c5KUne.png  ，请问是要做其他设置嘛？","like_count":0,"discussions":[{"author":{"id":2076600,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/af/b8/458866d3.jpg","nickname":"Bo","note":"","ucode":"D5DD3300310C02","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378215,"discussion_content":"请问您是不可以向上滑动吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623115283,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":282190,"user_name":"valiant","can_delete":false,"product_type":"c3","uid":2441099,"ip_address":"","ucode":"8DCA0597A7E4AC","user_header":"","comment_is_top":false,"comment_ctime":1615125310,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100025901,"comment_content":"老师，在cell中我添加了几个选择状态的按钮，但是当滑动画面，选择好的cell滑出可视区，再重新滑回来，选中的按钮状态都没了，应该怎么处理呢\n","like_count":0}]}