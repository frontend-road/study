{"id":292578,"title":"33 | Asynchronous I/O异步操作","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-Flink\">https://gitee.com/geektime-geekbang/geektime-Flink</a></p>","comments":[{"had_liked":false,"id":254194,"user_name":"yang","can_delete":false,"product_type":"c3","uid":1074310,"ip_address":"","ucode":"1AA1497C5A293C","user_header":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","comment_is_top":false,"comment_ctime":1603080216,"is_pvip":false,"replies":[{"id":93250,"content":"不清楚你说的Condition是什么","user_name":"作者回复","user_name_real":"张利兵","uid":1119779,"ctime":1603527909,"ip_address":"","comment_id":254194,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"猜想 AsyncFunction的线程安全是通过condition来实现的吧","like_count":1,"discussions":[{"author":{"id":1119779,"avatar":"https://static001.geekbang.org/account/avatar/00/11/16/23/99c7ede5.jpg","nickname":"张利兵","note":"","ucode":"DBAE17970AB143","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":507313,"discussion_content":"不清楚你说的Condition是什么","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603527909,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3726032,"avatar":"","nickname":"Geek_4edd4f","note":"","ucode":"84EDE6D785F099","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":629152,"discussion_content":"java.util.concurrent.locks. Condition","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1696736824,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":255723,"user_name":"clark","can_delete":false,"product_type":"c3","uid":1061963,"ip_address":"","ucode":"C994D34E85D685","user_header":"https://static001.geekbang.org/account/avatar/00/10/34/4b/43176634.jpg","comment_is_top":false,"comment_ctime":1603418322,"is_pvip":false,"replies":[{"id":93234,"content":"有Timeout配置的，可以直接实现AsyncFunction#timeout()方法，定义超时逻辑","user_name":"作者回复","user_name_real":"张利兵","uid":1119779,"ctime":1603526410,"ip_address":"","comment_id":255723,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"如果异步function超时了，流怎么处理","like_count":0,"discussions":[{"author":{"id":1119779,"avatar":"https://static001.geekbang.org/account/avatar/00/11/16/23/99c7ede5.jpg","nickname":"张利兵","note":"","ucode":"DBAE17970AB143","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":507813,"discussion_content":"有Timeout配置的，可以直接实现AsyncFunction#timeout()方法，定义超时逻辑","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603526410,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":281956,"user_name":"愤怒的虾干","can_delete":false,"product_type":"c3","uid":1266043,"ip_address":"","ucode":"CEBD1B2BE7BCEE","user_header":"https://static001.geekbang.org/account/avatar/00/13/51/7b/191a2112.jpg","comment_is_top":false,"comment_ctime":1614992994,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"老师，如果算子中有大量gRpc调用，怎么优化？可以用Async IO调用吗？","like_count":1},{"had_liked":false,"id":376554,"user_name":"Geek_3360b0","can_delete":false,"product_type":"c3","uid":3553421,"ip_address":"福建","ucode":"8E16877BCD71EC","user_header":"","comment_is_top":false,"comment_ctime":1686918505,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"buffer 里面的每个元素都是单独一次网络 io 去查询数据的？不会把 buffer 里面的元素汇总成一个集合，再通过一次网络 io 一次性查询所有数据？","like_count":0},{"had_liked":false,"id":374277,"user_name":"karen","can_delete":false,"product_type":"c3","uid":1042677,"ip_address":"北京","ucode":"381AE675D9FA7D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e8/f5/e758b7b6.jpg","comment_is_top":false,"comment_ctime":1683817486,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"如果维表数据很多，如何处理维表可以提高系统性能？\nflink流式计算，如何拆分task，这块有什么建议吗？","like_count":0},{"had_liked":false,"id":342460,"user_name":"Geek_7ixbah","can_delete":false,"product_type":"c3","uid":1048356,"ip_address":"","ucode":"9F110914D7EB00","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ff/24/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1650275376,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"老师我这里有一个问题，我在代码里通过远程 HTTP 调用获取到一个配置，放到内存里（成员变量），但是实际执行 flink 任务的时候，动态获取配置的代码并没有被执行，是不是可以理解为，flink 任务虽然是用 Java 代码实现，但它只是通过 Java 代码调用 API 构建计算流图，因此所有的业务逻辑都应该依赖 API，否则  flink 无法识别并生成计算流图","like_count":0},{"had_liked":false,"id":311208,"user_name":"小乙哥","can_delete":false,"product_type":"c3","uid":1063308,"ip_address":"","ucode":"C77E79BEA0C325","user_header":"https://static001.geekbang.org/account/avatar/00/10/39/8c/ff48ece3.jpg","comment_is_top":false,"comment_ctime":1631105263,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"FlinkSql里面的维度表join，使用的是同步调用方式，还是异步调用方式呢？","like_count":0},{"had_liked":false,"id":285206,"user_name":"爱学习的二锅头","can_delete":false,"product_type":"c3","uid":2448149,"ip_address":"","ucode":"32583BBAF4AE0B","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ereeTLicOjjp41WSuliajciajL1VriaVUqse5fWrIL5u1XjF7sdetL7f0icicMyXzVfxogTJy5fqDD7fCqA/132","comment_is_top":false,"comment_ctime":1616665805,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"所以老师，他这个线程安全是怎么实现的？","like_count":0},{"had_liked":false,"id":281521,"user_name":"Allan","can_delete":false,"product_type":"c3","uid":1310388,"ip_address":"","ucode":"8DA4DBECC2C45C","user_header":"https://static001.geekbang.org/account/avatar/00/13/fe/b4/295338e7.jpg","comment_is_top":false,"comment_ctime":1614772639,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"public static class HBaseAsyncFunc implements AsyncFunction&lt;String, String&gt; {\n\n\t\tstatic AsyncTable&lt;AdvancedScanResultConsumer&gt; table = null;\n\n\n\t\tpublic HBaseAsyncFunc(String tableName) {\n\n\t\t\tif (table == null) {\n\t\t\t\tCompletableFuture&lt;AsyncConnection&gt; asn = ConnectionFactory.createAsyncConnection();\n\n\t\t\t\tAsyncConnection asyncConnection = null;\n\t\t\t\ttry {\n\t\t\t\t\tasyncConnection = asn.get();\n\t\t\t\t} catch (InterruptedException e) {\n\t\t\t\t\te.printStackTrace();\n\t\t\t\t} catch (ExecutionException e) {\n\t\t\t\t\te.printStackTrace();\n\t\t\t\t}\n\n\t\t\t\ttable = asyncConnection.getTable(TableName.valueOf(tableName));\n\t\t\t}\n\n\n\t\t}\n\n\t\t@Override\n\t\tpublic void asyncInvoke(String input, ResultFuture&lt;String&gt; resultFuture) throws Exception {\n\n\t\t\tJSONObject model = JSON.parseObject(input);\n\t\t\tGet get = new Get(Bytes.toBytes(model.getString(&quot;userId&quot;)));\n\t\t\ttable.get(get);\n\t\t\tList&lt;String&gt; list = new ArrayList();\n\n\t\t\tresultFuture.complete(list);\n\t\t}\n\t}","like_count":0},{"had_liked":false,"id":253417,"user_name":"golang","can_delete":false,"product_type":"c3","uid":1197282,"ip_address":"","ucode":"86D34235F08AAC","user_header":"https://static001.geekbang.org/account/avatar/00/12/44/e2/fad4ea7d.jpg","comment_is_top":false,"comment_ctime":1602732595,"is_pvip":false,"replies":null,"discussion_count":2,"race_medal":0,"score":2,"product_id":100058801,"comment_content":"异步算子的Watermarks永远不会超过elements的TimeStamp。这个没太理解，老师是否可以再详细描述下？","like_count":0,"discussions":[{"author":{"id":1803858,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/86/52/b92dc111.jpg","nickname":"Tobias","note":"","ucode":"F3225639EDA193","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349021,"discussion_content":"即使buffer中的元素的先后顺序变化了，也不会影响到这些元素对应的WM值。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612852146,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1074310,"avatar":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","nickname":"yang","note":"","ucode":"1AA1497C5A293C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":313645,"discussion_content":"因为buffer中的元素是固定的，所以不论什么样的顺序发送给，wm都不会超过这批数据中的ts。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603079380,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}