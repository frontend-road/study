{"id":10590,"title":"62 | Spring Cloud Zuul(Lab05)","content":"无","comments":[{"had_liked":false,"id":40946,"user_name":"丁志勇","can_delete":false,"product_type":"c3","uid":1313109,"ip_address":"","ucode":"2E537DF7061B8A","user_header":"https://static001.geekbang.org/account/avatar/00/14/09/55/2240a81a.jpg","comment_is_top":false,"comment_ctime":1542700443,"is_pvip":false,"replies":[{"id":15262,"content":"视频ppt中观点只是我个人基于实战经验之后的建议，仅供参考，你作为架构师需要根据企业实际上下文自己独立思考和选型。spring cloud zuul虽封装得对开发较友好，但有点过度封装，很多学员反应比较绕，出问题不容易定位和深入源码，这些是封装的成本。建议在较大流量生产上使用的话，还是需要深入zuul&#47;ribbon&#47;hystrix源码，根据企业实际情况作定制，这点我认为原生zuul的代码相对简单更容易切入。当然spring cloud的产品一直在迭代完善中，相信后面会越做越好。anyway，感兴谢你提出来的问题，架构师需要这种批判性思考态度！","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1542985885,"ip_address":"","comment_id":40946,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"2点，第1点问题，Springcloud支持动态Filter加载机制，您的ppt中硕大的几个字《去掉了动态过滤器加载》带有很明显的误导，这也不能是放弃Springcloud zuul的理由，如果您指的是Springcloud不自带filter管理工具，那么就有第2点问题，这个原版zuul所带的动态filter管理工具，在我看来也不具备生产级应用，太过于简陋，必须做定制化开发，那么都需要自己扩展filter管理平台，如果选择原生zuul，既需要实现filter管理平台，又放弃了Spring的友好集成，这个是否是得不偿失？另外原生zuul的发布方式只能依赖外部web容器，而无法做到像springboot那样的内建web容器使用main函数启动，各种不方便？在如此情况之下，您建议使用原生zuul的理由似乎不够充分？","like_count":3,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":429656,"discussion_content":"视频ppt中观点只是我个人基于实战经验之后的建议，仅供参考，你作为架构师需要根据企业实际上下文自己独立思考和选型。spring cloud zuul虽封装得对开发较友好，但有点过度封装，很多学员反应比较绕，出问题不容易定位和深入源码，这些是封装的成本。建议在较大流量生产上使用的话，还是需要深入zuul/ribbon/hystrix源码，根据企业实际情况作定制，这点我认为原生zuul的代码相对简单更容易切入。当然spring cloud的产品一直在迭代完善中，相信后面会越做越好。anyway，感兴谢你提出来的问题，架构师需要这种批判性思考态度！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542985885,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":23809,"user_name":"天天平安","can_delete":false,"product_type":"c3","uid":1119208,"ip_address":"","ucode":"C4850F9655F4DD","user_header":"https://static001.geekbang.org/account/avatar/00/11/13/e8/08b829a9.jpg","comment_is_top":false,"comment_ctime":1536669842,"is_pvip":false,"replies":[{"id":9653,"content":"你的想法很多，可以加我微信(bulldog2015)交流，我有一个极客时间群，大家可以一起讨论学习成长。这个样例是让大家上手spring cloud zuul的，理解它和原生zuul的主要差别，毕竟现在很多公司直接用spring cloud zuul的，并不是说会用spring cloud zuul就是架构师了。如果有架构师来我这里面试，我会让他解释原生zuul架构和内核原理，也会问原生zuul和spring cloud zuu的差别，以及他的实战经验。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1537683345,"ip_address":"","comment_id":23809,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"讲一个这样的例子，真的没有意义？还架构师来学？这样的架构师你们公司要吗？","like_count":3,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423740,"discussion_content":"你的想法很多，可以加我微信(bulldog2015)交流，我有一个极客时间群，大家可以一起讨论学习成长。这个样例是让大家上手spring cloud zuul的，理解它和原生zuul的主要差别，毕竟现在很多公司直接用spring cloud zuul的，并不是说会用spring cloud zuul就是架构师了。如果有架构师来我这里面试，我会让他解释原生zuul架构和内核原理，也会问原生zuul和spring cloud zuu的差别，以及他的实战经验。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537683345,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":160694,"user_name":"码农Kevin亮","can_delete":false,"product_type":"c3","uid":1116630,"ip_address":"","ucode":"D34562461CA0A1","user_header":"https://static001.geekbang.org/account/avatar/00/11/09/d6/5f366427.jpg","comment_is_top":false,"comment_ctime":1576023081,"is_pvip":false,"replies":[{"id":61459,"content":"zuul主要用做针对API的网关，Web应用或者静态页面，建议放在nginx这类反向代理之后，nginx处理静态页面性能会更好。\n\n当然zuul和nginx没有本质区别，都是反向代理，zuul也可以反向代理Web应用或者静态资源，zuul其实也不关心请求&#47;响应是xml&#47;json还是html页面。具体配置你可以看Spring Cloud Zuul的官方文档即可，如果有问题，可以简单debug一下，看看是不是有filter截获了请求做了重定向，zuul的代码不复杂。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1576141999,"ip_address":"","comment_id":160694,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"请教老师，我用zuul来路由网页资源时，网页被重定向了而不是反向代理，这个要怎么设置呢？\n还是说静态资源不应该放在网关内呢？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477455,"discussion_content":"zuul主要用做针对API的网关，Web应用或者静态页面，建议放在nginx这类反向代理之后，nginx处理静态页面性能会更好。\n\n当然zuul和nginx没有本质区别，都是反向代理，zuul也可以反向代理Web应用或者静态资源，zuul其实也不关心请求/响应是xml/json还是html页面。具体配置你可以看Spring Cloud Zuul的官方文档即可，如果有问题，可以简单debug一下，看看是不是有filter截获了请求做了重定向，zuul的代码不复杂。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576141999,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":116833,"user_name":"恰饭哒","can_delete":false,"product_type":"c3","uid":1014023,"ip_address":"","ucode":"0395069A050057","user_header":"https://static001.geekbang.org/account/avatar/00/0f/79/07/2f418316.jpg","comment_is_top":false,"comment_ctime":1563930419,"is_pvip":false,"replies":[{"id":42850,"content":"https:&#47;&#47;stackoverflow.com&#47;questions&#47;48584013&#47;ribbon-retry-properties-not-respected\n\n你试试这个帖子里头讲的设置一个全局ribbon retry是否管用：\nribbon:\n  OkToRetryOnAllOperations: false","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1563974649,"ip_address":"","comment_id":116833,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"波波老师您好，我遇到一个zuul网关配置重试不其作用的问题，用了hystrix熔断配置参数如下：\nzuul.routes.xxxxxx.retryable=true\nspring.cloud.loadbalancer.retry.enabled=true\n.xxxxxx..ribbon.ConnectTimeout=2000\nxxxxxx.ribbon.ReadTimeout=4000\nxxxxxx.ribbon.MaxTotalHttpConnections=4000\nxxxxxx.ribbon.MaxConnectionsPerHost=800\nxxxxxx.ribbon.MaxAutoRetries=1\nxxxxxx.ribbon.MaxAutoRetriesNextServer=2\nxxxxxx.ribbon.OkToRetryOnAllOperations=true\nhystrix.command.xxxxxx.circuitBreaker.enabled=true\nhystrix.command.xxxxxx.circuitBreaker.requestVolumeThreshold=30\nhystrix.command.xxxxxx.circuitBreaker.sleepWindowInMilliseconds=5000\nhystrix.command.xxxxxx.execution.isolation.strategy=THREAD\nhystrix.command.default.execution.isolation.thread.timeoutInMilliseconds=5000\nhystrix.command.xxxxxx.execution.isolation.semaphore.maxConcurrentRequests=1000\nhystrix.command.xxxxxx.fallback.isolation.semaphore.maxConcurrentRequests=3000\n用的是okhttp","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459701,"discussion_content":"https://stackoverflow.com/questions/48584013/ribbon-retry-properties-not-respected\n\n你试试这个帖子里头讲的设置一个全局ribbon retry是否管用：\nribbon:\n  OkToRetryOnAllOperations: false","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563974649,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1014023,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/79/07/2f418316.jpg","nickname":"恰饭哒","note":"","ucode":"0395069A050057","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3577,"discussion_content":"这个问题已经解决了，发现是springcloud版本问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564617322,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1014023,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/79/07/2f418316.jpg","nickname":"恰饭哒","note":"","ucode":"0395069A050057","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2861,"discussion_content":"找到问题了，版本问题我用的是d，那里不兼容","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563978423,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51292,"user_name":"霹雳大仙pp","can_delete":false,"product_type":"c3","uid":1046893,"ip_address":"","ucode":"F654FD9AEC1D56","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f9/6d/b623562a.jpg","comment_is_top":false,"comment_ctime":1545147582,"is_pvip":false,"replies":[{"id":18693,"content":"谢支持🌹","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1545223001,"ip_address":"","comment_id":51292,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"讲到很到位，辛苦老师！！！","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433387,"discussion_content":"谢支持🌹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545223001,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":34355,"user_name":"Sam_Deep_Thinking","can_delete":false,"product_type":"c3","uid":1001152,"ip_address":"","ucode":"8E4EF6F24B821B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/46/c0/106d98e7.jpg","comment_is_top":false,"comment_ctime":1540123925,"is_pvip":false,"replies":[{"id":12657,"content":"spring cloud可能也能实现动态filter加载，但需扩展对接定制的filter存储，拉取等管理机制，这些netflix原生zuul已有支持。建议大规模流量网端考虑netflix原生zuul，动态filter机制更灵活，中小规模流量网端用spring cloud zuul也ok，静态filter也有利，调试更友好。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1540732230,"ip_address":"","comment_id":34355,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"杨老师，我从网络上了解到，使用spring cloud 继承的zuul，如果filter使用groovy写，也是一样正常动态发布和加载的哦。","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427184,"discussion_content":"spring cloud可能也能实现动态filter加载，但需扩展对接定制的filter存储，拉取等管理机制，这些netflix原生zuul已有支持。建议大规模流量网端考虑netflix原生zuul，动态filter机制更灵活，中小规模流量网端用spring cloud zuul也ok，静态filter也有利，调试更友好。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540732230,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":32721,"user_name":"袄家堡","can_delete":false,"product_type":"c3","uid":1150921,"ip_address":"","ucode":"B24F5F9BCC0B80","user_header":"https://static001.geekbang.org/account/avatar/00/11/8f/c9/6d8bbad0.jpg","comment_is_top":false,"comment_ctime":1539679295,"is_pvip":false,"replies":[{"id":12747,"content":"嗯，原生zuul代码不复杂，本质就是个servlet，建议拉下代码研读下，会更有收获。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1540818127,"ip_address":"","comment_id":32721,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"项目中用了sping cloud zull,之前是只会用，不知道什么时候用，为什么要这么写，但听了前边的原生zull,大概明白了里边的东西，可能是自己技术有限，听起来还是有些吃力，希望老师在后期能讲接的通俗点，谢谢","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426870,"discussion_content":"嗯，原生zuul代码不复杂，本质就是个servlet，建议拉下代码研读下，会更有收获。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540818127,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}