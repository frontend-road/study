{"id":151119,"title":"14 | 常用的“二次”编解码方式","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geek_netty\">https://gitee.com/geektime-geekbang/geek_netty</a></p>","comments":[{"had_liked":false,"id":152372,"user_name":"黄钦钦","can_delete":false,"product_type":"c3","uid":1649415,"ip_address":"","ucode":"E2E9CB1E084BB9","user_header":"","comment_is_top":false,"comment_ctime":1573985254,"is_pvip":false,"replies":[{"id":59051,"content":"只要不是扔鸡蛋都好说，哈哈","user_name":"作者回复","user_name_real":"Geek_9bc307","uid":1638649,"ctime":1574300617,"ip_address":"","comment_id":152372,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"如果极客时间支持弹幕的话，老师的视频估计满屏高能预警","like_count":5,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474792,"discussion_content":"只要不是扔鸡蛋都好说，哈哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574300617,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":141828,"user_name":"加载中……","can_delete":false,"product_type":"c3","uid":1366948,"ip_address":"","ucode":"3E59A0A0784D0A","user_header":"https://static001.geekbang.org/account/avatar/00/14/db/a4/191be6ad.jpg","comment_is_top":false,"comment_ctime":1571232091,"is_pvip":false,"replies":[{"id":54974,"content":"好像都读的不准确😂","user_name":"作者回复","user_name_real":"Geek_9bc307","uid":1638649,"ctime":1571388016,"ip_address":"","comment_id":141828,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"为什么听着是把byte(bait)字节读成bit位🤦‍♀️","like_count":5,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470901,"discussion_content":"好像都读的不准确😂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571388016,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1111395,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f5/63/75c40984.jpg","nickname":"小飞侠","note":"","ucode":"647653D1FEEF48","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":216422,"discussion_content":"老师你可要读准了，因为我们也不确定，你要读错了，大家就跟着错了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585448623,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1108924,"avatar":"https://static001.geekbang.org/account/avatar/00/10/eb/bc/6ccac4bb.jpg","nickname":"武文文武","note":"","ucode":"5288366646A15B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":99166,"discussion_content":"那老师觉得该怎么读？难道是bit？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577196546,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":185920,"user_name":"斯蒂芬.赵","can_delete":false,"product_type":"c3","uid":1200179,"ip_address":"","ucode":"AA0FF2DA654418","user_header":"https://static001.geekbang.org/account/avatar/00/12/50/33/9dcd30c4.jpg","comment_is_top":false,"comment_ctime":1583724886,"is_pvip":false,"replies":[{"id":78840,"content":"就是不想注水太多。浪费自己时间也浪费大家时间。哈哈","user_name":"作者回复","user_name_real":"stroller","uid":1638649,"ctime":1588057230,"ip_address":"","comment_id":185920,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"讲课干脆。说话接地气。","like_count":3,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486552,"discussion_content":"就是不想注水太多。浪费自己时间也浪费大家时间。哈哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588057230,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":151344,"user_name":"冬渐暖","can_delete":false,"product_type":"c3","uid":1586800,"ip_address":"","ucode":"907E41AAE9A36C","user_header":"https://static001.geekbang.org/account/avatar/00/18/36/70/00122b24.jpg","comment_is_top":false,"comment_ctime":1573703303,"is_pvip":false,"replies":[{"id":58350,"content":"如果让我用，我还是喜欢json，但是如果提供给别人用，肯定还是protobuf。你说的感性，但是很靠谱。","user_name":"作者回复","user_name_real":"Geek_9bc307","uid":1638649,"ctime":1573786368,"ip_address":"","comment_id":151344,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"需要二次解码的原因\n1.一次解码是封装成帧，用那三种编码器去读数据，decoder传进来的原始数据--》最终是字节\n2.二次是把字节转成其它的东西，比如对象\n\n关于将两次解码不推荐合二为一的原因，还是类似于不用mvc。容易层次不清，耦合度高，下次不用byteBuffer就要在这里面改来改去\n\n\n常见的二次解码的方式有\n●Java序列化(原生，jdk自带的)：implements Serializable。占用的空间比较大。。。但我平常代码里都是用这个。。。\n●Marshaling：jboos的，一看来源就知道不是什么好东西，但是比原生的jdk自带的肯定好点\n●XML:易读，但是占用空间大\n●JSON  \n●MessagePack:占的比json小，可读性比json辣鸡\n●Protobuf:占用最小，可读性最咸鱼。序列化无论是大数据还是小数据都是最优的，反序列化就不是最好的\n\n个人拙见，如果叫我用，我肯定优先MessagePack，占用比json小不说，可读性也是能读的。\n其次考虑json或者Protobuf。可读性在某方面斟酌下还是可以舍弃的\n就像您之前说的，像netty，性能要做就要做到最优！\n而且，我完全可以先不管能不能看得懂这些一阶段的数据，再二次编码之后转成对象就好了。可读性是对程序员dedbug方便，但是我们是要拿东西给用户用，能省一点是一点","like_count":3,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474447,"discussion_content":"如果让我用，我还是喜欢json，但是如果提供给别人用，肯定还是protobuf。你说的感性，但是很靠谱。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573786368,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1155616,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a2/20/7549ff2b.jpg","nickname":"flying eagle","note":"","ucode":"1020359D893C04","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546474,"discussion_content":"一次解码是为了将粘包、半包的数据拆分，接收到的就是 ByteBuf，一次编解码后还是 ByteBuf","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642313814,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142081,"user_name":"小不点","can_delete":false,"product_type":"c3","uid":1351860,"ip_address":"","ucode":"C307D44A185C34","user_header":"https://static001.geekbang.org/account/avatar/00/14/a0/b4/5173f1af.jpg","comment_is_top":false,"comment_ctime":1571291827,"is_pvip":false,"replies":[{"id":54969,"content":"哈哈，是的","user_name":"作者回复","user_name_real":"Geek_9bc307","uid":1638649,"ctime":1571386409,"ip_address":"","comment_id":142081,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"打卡！！！老师是安徽的吗，声音听着很亲切呢！","like_count":2,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470979,"discussion_content":"哈哈，是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571386409,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1238982,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e7/c6/c7ea204d.jpg","nickname":"java0-杨文杰","note":"","ucode":"F863B23D896182","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":38844,"discussion_content":"老师安徽哪里的 我六安的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571841378,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":159114,"user_name":"polk","can_delete":false,"product_type":"c3","uid":1165455,"ip_address":"","ucode":"1B6E948BA4DFAF","user_header":"https://static001.geekbang.org/account/avatar/00/11/c8/8f/e13a6552.jpg","comment_is_top":false,"comment_ctime":1575539784,"is_pvip":false,"replies":[{"id":60881,"content":"因为高性能的都是pb.所以这节说pb.然后案例用的json.","user_name":"作者回复","user_name_real":"傅健","uid":1638649,"ctime":1575564054,"ip_address":"","comment_id":159114,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"居然不选json","like_count":1,"discussions":[{"author":{"id":1638649,"avatar":"https://static001.geekbang.org/account/avatar/00/19/00/f9/44a3e5bd.jpg","nickname":"傅健","note":"","ucode":"5EA8BB26F5B036","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476955,"discussion_content":"因为高性能的都是pb.所以这节说pb.然后案例用的json.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575564054,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":395797,"user_name":"Geek_159e2d","can_delete":false,"product_type":"c3","uid":3231519,"ip_address":"新加坡","ucode":"8353F32D38C371","user_header":"https://static001.geekbang.org/account/avatar/00/31/4f/1f/791d0f5e.jpg","comment_is_top":false,"comment_ctime":1732097990,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"如果将一、二次编解码进行合并，一个类既解决半包、粘包问题，又解决数据转换操作问题。明显是不符合单一职责原则的。","like_count":0},{"had_liked":false,"id":331910,"user_name":"Geek3443","can_delete":false,"product_type":"c3","uid":2028946,"ip_address":"","ucode":"C6351639FD0633","user_header":"","comment_is_top":false,"comment_ctime":1642863864,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"thrift用的也不少。","like_count":0},{"had_liked":false,"id":223406,"user_name":"Alfred","can_delete":false,"product_type":"c3","uid":1134529,"ip_address":"","ucode":"AE80D51772FAE5","user_header":"https://static001.geekbang.org/account/avatar/00/11/4f/c1/1872249a.jpg","comment_is_top":false,"comment_ctime":1591083351,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100036701,"comment_content":"老师，XML和JSON的二次编码码类 具体是那个呢","like_count":0}]}