{"id":106098,"title":"28 | 如何合理利用assert？","content":"<p>你好，我是景霄。</p><p>相信你平时在写代码时，肯定或多或少看到过assert的存在。我也曾在日常的code review中，被一些同事要求增加assert语句，让代码更加健壮。</p><p>不过，尽管如此，我发现在很多情况下，assert还是很容易被忽略，人们似乎对这么一个“不起眼”的东西并不关心。但事实上，这个看似“不起眼”的东西，如果能用好，对我们的程序大有裨益。</p><p>说了这么多，那么究竟什么是assert，我们又该如何合理地使用assert呢？今天这节课，我就带你一起来学习它的用法。</p><h2>什么是assert？</h2><p>Python的assert语句，可以说是一个debug的好工具，主要用于测试一个条件是否满足。如果测试的条件满足，则什么也不做，相当于执行了pass语句；如果测试条件不满足，便会抛出异常AssertionError，并返回具体的错误信息（optional）。</p><p>它的具体语法是下面这样的：</p><pre><code>assert_stmt ::=  &quot;assert&quot; expression [&quot;,&quot; expression]\n</code></pre><p>我们先来看一个简单形式的<code>assert expression</code>，比如下面这个例子：</p><pre><code>assert 1 == 2\n</code></pre><p>它就相当于下面这两行代码：</p><pre><code>if __debug__:\n    if not expression: raise AssertionError\n</code></pre><p>再来看<code>assert expression1, expression2</code>的形式，比如下面这个例子：</p><!-- [[[read_end]]] --><pre><code>assert 1 == 2,  'assertion is wrong'\n</code></pre><p>它就相当于下面这两行代码：</p><pre><code>if __debug__:\n    if not expression1: raise AssertionError(expression2)\n</code></pre><p>这里的<code>__debug__</code>是一个常数。如果Python程序执行时附带了<code>-O</code>这个选项，比如<code>Python test.py -O</code>，那么程序中所有的assert语句都会失效，常数<code>__debug__</code>便为False；反之<code>__debug__</code>则为True。</p><p>不过，需要注意的是，直接对常数<code>__debug__</code>赋值是非法的，因为它的值在解释器开始运行时就已经决定了，中途无法改变。</p><p>此外，一定记住，不要在使用assert时加入括号，比如下面这个例子：</p><pre><code>assert(1 == 2, 'This should fail')\n# 输出\n&lt;ipython-input-8-2c057bd7fe24&gt;:1: SyntaxWarning: assertion is always true, perhaps remove parentheses?\n  assert(1 == 2, 'This should fail')\n</code></pre><p>如果你按照这样来写，无论表达式对与错（比如这里的1 == 2显然是错误的），assert检查永远不会fail，程序只会给你SyntaxWarning。</p><p>正确的写法，应该是下面这种不带括号的写法：</p><pre><code>assert 1 == 2, 'This should fail'\n# 输出\nAssertionError: This should fail\n</code></pre><p>总的来说，assert在程序中的作用，是对代码做一些internal的self-check。使用assert，就表示你很确定。这个条件一定会发生或者一定不会发生。</p><p>举个例子，比如你有一个函数，其中一个参数是人的性别，因为性别只有男女之分（这里只指生理性别），你便可以使用assert，以防止程序的非法输入。如果你的程序没有bug，那么assert永远不会抛出异常；而它一旦抛出了异常，你就知道程序存在问题了，并且可以根据错误信息，很容易定位出错误的源头。</p><h2>assert  的用法</h2><p>讲完了assert的基本语法与概念，我们接下来通过一些实际应用的例子，来看看assert在Python中的用法，并弄清楚 assert 的使用场景。</p><p>第一个例子，假设你现在使用的极客时间正在做专栏促销活动，准备对一些专栏进行打折，所以后台需要写一个apply_discount()函数，要求输入为原来的价格和折扣，输出是折后的价格。那么，我们可以大致写成下面这样：</p><pre><code>def apply_discount(price, discount):\n    updated_price = price * (1 - discount)\n    assert 0 &lt;= updated_price &lt;= price, 'price should be greater or equal to 0 and less or equal to original price'\n    return updated_price\n</code></pre><p>可以看到，在计算新价格的后面，我们还写了一个assert语句，用来检查折后价格，这个值必须大于等于0、小于等于原来的价格，否则就抛出异常。</p><p>我们可以试着输入几组数，来验证一下这个功能：</p><pre><code>apply_discount(100, 0.2)\n80.0\n\napply_discount(100, 2)\nAssertionError: price should be greater or equal to 0 and less or equal to original price\n</code></pre><p>显然，当discount是0.2时，输出80，没有问题。但是当discount为2时，程序便抛出下面这个异常：</p><pre><code>AssertionError：price should be greater or equal to 0 and less or equal to original price\n</code></pre><p>这样一来，如果开发人员修改相关的代码，或者是加入新的功能，导致discount数值的异常时，我们运行测试时就可以很容易发现问题。正如我开头所说，assert的加入，可以有效预防bug的发生，提高程序的健壮性。</p><p>再来看一个例子，最常见的除法操作，这在任何领域的计算中都经常会遇到。同样还是以极客时间为例，假如极客时间后台想知道每个专栏的平均销售价格，那么就需要给定销售总额和销售数目，这样平均销售价格便很容易计算出来：</p><pre><code>def calculate_average_price(total_sales, num_sales):\n    assert num_sales &gt; 0, 'number of sales should be greater than 0'\n    return total_sales / num_sales\n</code></pre><p>同样的，我们也加入了assert语句，规定销售数目必须大于0，这样就可以防止后台计算那些还未开卖的专栏的价格。</p><p>除了这两个例子，在实际工作中，assert还有一些很常见的用法，比如下面的场景：</p><pre><code>def func(input):\n    assert isinstance(input, list), 'input must be type of list'\n    # 下面的操作都是基于前提：input必须是list\n    if len(input) == 1:\n        ...\n    elif len(input) == 2:\n        ...\n    else:\n        ... \n</code></pre><p>这里函数func()里的所有操作，都是基于输入必须是list 这个前提。是不是很熟悉的需求呢？那我们就很有必要在开头加一句assert的检查，防止程序出错。</p><p>当然，我们也要根据具体情况具体分析。比如上面这个例子，之所以能加assert，是因为我们很确定输入必须是list，不能是其他数据类型。</p><p>如果你的程序中，允许input是其他数据类型，并且对不同的数据类型都有不同的处理方式，那你就应该写成if else的条件语句了：</p><pre><code>def func(input):\n    if isinstance(input, list):\n        ...\n    else:\n        ...\n</code></pre><h2>assert错误示例</h2><p>前面我们讲了这么多 assert的使用场景，可能给你一种错觉，也可能会让你有些迷茫：很多地方都可以使用assert， 那么，很多if条件语句是不是都可以换成assert呢？这么想可就不准确了，接下来，我们就一起来看几个典型的错误用法，避免一些想当然的用法。</p><p>还是以极客时间为例，我们假设下面这样的场景：后台有时候需要删除一些上线时间较长的专栏，于是，相关的开发人员便设计出了下面这个专栏删除函数。</p><pre><code>def delete_course(user, course_id):\n    assert user_is_admin(user), 'user must be admin'\n    assert course_exist(course_id), 'course id must exist'\n    delete(course_id)\n</code></pre><p>极客时间规定，必须是admin才能删除专栏，并且这个专栏课程必须存在。有的同学一看，很熟悉的需求啊，所以在前面加了相应的assert检查。那么我想让你思考一下，这样写到底对不对呢？</p><p>答案显然是否定的。你可能觉得，从代码功能角度来说，这没错啊。但是在实际工程中，基本上没人会这么写。为什么呢？</p><p>要注意，前面我说过，assert的检查是可以被关闭的，比如在运行Python程序时，加入<code>-O</code>这个选项就会让assert失效。因此，一旦assert的检查被关闭，user_is_admin()和course_exist()这两个函数便不会被执行。这就会导致：</p><ul>\n<li>任何用户都有权限删除专栏课程；</li>\n<li>并且，不管这个课程是否存在，他们都可以强行执行删除操作。</li>\n</ul><p>这显然会给程序带来巨大的安全漏洞。所以，正确的做法，是使用条件语句进行相应的检查，并合理抛出异常：</p><pre><code>def delete_course(user, course_id):\n    if not user_is_admin(user):\n        raise Exception('user must be admin')\n    if not course_exist(course_id):\n        raise Exception('coursde id must exist')\n    delete(course_id)  \n</code></pre><p>再来看一个例子，如果你想打开一个文件，进行数据读取、处理等一系列操作，那么下面这样的写法，显然也是不正确的：</p><pre><code>def read_and_process(path):\n    assert file_exist(path), 'file must exist'\n    with open(path) as f:\n      ...\n</code></pre><p>因为assert的使用，表明你强行指定了文件必须存在，但事实上在很多情况下，这个假设并不成立。另外，打开文件操作，也有可能触发其他的异常。所以，正确的做法是进行异常处理，用try和except来解决：</p><pre><code>def read_and_process(path):\n    try:\n        with open(path) as f:\n            ...\n    except Exception as e:\n            ...  \n</code></pre><p>总的来说，assert并不适用run-time error  的检查。比如你试图打开一个文件，但文件不存在；再或者是你试图从网上下载一个东西，但中途断网了了等等，这些情况下，还是应该参照我们前面所讲的<a href=\"https://time.geekbang.org/column/article/97462\">错误与异常</a>的内容，进行正确处理。</p><h2>总结</h2><p>今天这节课，我们一起学习了assert的用法。assert通常用来对代码进行必要的self check，表明你很确定这种情况一定发生，或者一定不会发生。需要注意的是，使用assert时，一定不要加上括号，否则无论表达式对与错，assert检查永远不会fail。另外，程序中的assert语句，可以通过<code>-O</code>等选项被全局disable。</p><p>通过这节课的几个使用场景，你能看到，assert的合理使用，可以增加代码的健壮度，同时也方便了程序出错时开发人员的定位排查。</p><p>不过，我们也不能滥用assert。很多情况下，程序中出现的不同情况都是意料之中的，需要我们用不同的方案去处理，这时候用条件语句进行判断更为合适。而对于程序中的一些run-time error，请记得使用异常处理。</p><h2>思考题</h2><p>最后，给你留一个思考题。在平时的工作学习中，你用过assert吗？如果用过的话，是在什么情况下使用的？有遇到过什么问题吗？</p><p>欢迎在留言区写下你的经历，还有今天学习的心得和疑惑，与我一起分享。也欢迎你把这篇文章分享给你的同事、朋友，我们一起交流，一起进步。</p><p></p>","comments":[{"had_liked":false,"id":113269,"user_name":"更好的做自己","can_delete":false,"product_type":"c1","uid":1339294,"ip_address":"","ucode":"92CC2D8E4B3B52","user_header":"https://static001.geekbang.org/account/avatar/00/14/6f/9e/951afb1f.jpg","comment_is_top":false,"comment_ctime":1562929976,"is_pvip":true,"replies":[{"id":"48152","content":"说的很好","user_name":"作者回复","user_name_real":"Jingxiao","uid":"1259521","ctime":1567124220,"ip_address":"","comment_id":113269,"utype":1}],"discussion_count":3,"race_medal":0,"score":"293620706104","product_id":100026901,"comment_content":"个人认为assert的使用应该是，有没有assert程序都能够正常运行，但有了assert可以使我们的代码后期维护更加方便","like_count":69,"discussions":[{"author":{"id":1259521,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJOlibibPFEWOib8ib7RtfAtxND5FUqCxxoeTuLAbBI9ic23xuwdXT4IyiaWq3Fic9RgEAYI0lBTbEp2rcg/132","nickname":"Jingxiao","note":"","ucode":"EB966BB87132F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458142,"discussion_content":"说的很好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567124220,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2459939,"avatar":"https://static001.geekbang.org/account/avatar/00/25/89/23/e71f180b.jpg","nickname":"Geek_fc975d","note":"","ucode":"05B6507FE4349B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559282,"discussion_content":"assert 感觉更适合在单元测试中吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648688018,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1919541,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/4a/35/66caeed9.jpg","nickname":"完美坚持","note":"","ucode":"AE0261D8DDEF64","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":361364,"discussion_content":"有 没有 assert 程序都能够正常运行，但有了assert可以使我们的代码后期维护更加方便但是我们通常只是考虑有的情况，却忽略了没有的情况","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616652234,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113246,"user_name":"小侠龙旋风","can_delete":false,"product_type":"c1","uid":1126441,"ip_address":"","ucode":"073F3924A99835","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/29/d6816ebf.jpg","comment_is_top":false,"comment_ctime":1562923765,"is_pvip":false,"replies":[{"id":"41331","content":"这个是一个常用的例子，但是文中所讲的其实都挺常用的","user_name":"作者回复","user_name_real":"Jingxiao","uid":"1259521","ctime":1563041566,"ip_address":"","comment_id":113246,"utype":1}],"discussion_count":1,"race_medal":0,"score":"48807564021","product_id":100026901,"comment_content":"印象中好像就这个用法比较常用一点：<br>assert isinstance(input, list), &#39;input must be type of list&#39;","like_count":11,"discussions":[{"author":{"id":1259521,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJOlibibPFEWOib8ib7RtfAtxND5FUqCxxoeTuLAbBI9ic23xuwdXT4IyiaWq3Fic9RgEAYI0lBTbEp2rcg/132","nickname":"Jingxiao","note":"","ucode":"EB966BB87132F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458130,"discussion_content":"这个是一个常用的例子，但是文中所讲的其实都挺常用的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563041566,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121591,"user_name":"梁大瓜","can_delete":false,"product_type":"c1","uid":1435855,"ip_address":"","ucode":"04D708E3662D27","user_header":"https://static001.geekbang.org/account/avatar/00/15/e8/cf/554f08f9.jpg","comment_is_top":false,"comment_ctime":1565163785,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"44514836745","product_id":100026901,"comment_content":"我记得最早写机器学习代码的时候，assert用来检查输入。","like_count":10},{"had_liked":false,"id":113820,"user_name":"图·美克尔","can_delete":false,"product_type":"c1","uid":1076720,"ip_address":"","ucode":"021FB5AE110066","user_header":"https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eppQqDE6TNibvr3DNdxG323AruicIgWo5DpVr6U7yZVNkbF2rKluyDfhdpgAEcYEOZTAnbrMdTzFkUw/0","comment_is_top":false,"comment_ctime":1563162061,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"35922900429","product_id":100026901,"comment_content":"写测试代码时用","like_count":8},{"had_liked":false,"id":113161,"user_name":"阿卡牛","can_delete":false,"product_type":"c1","uid":1022247,"ip_address":"","ucode":"0BC43A904C3199","user_header":"https://static001.geekbang.org/account/avatar/00/0f/99/27/47aa9dea.jpg","comment_is_top":false,"comment_ctime":1562905032,"is_pvip":false,"replies":[{"id":"41332","content":"线上代码里也有assert的","user_name":"作者回复","user_name_real":"Jingxiao","uid":"1259521","ctime":1563041587,"ip_address":"","comment_id":113161,"utype":1}],"discussion_count":2,"race_medal":0,"score":"31627676104","product_id":100026901,"comment_content":"正式上线时也建议用assert??","like_count":7,"discussions":[{"author":{"id":1259521,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJOlibibPFEWOib8ib7RtfAtxND5FUqCxxoeTuLAbBI9ic23xuwdXT4IyiaWq3Fic9RgEAYI0lBTbEp2rcg/132","nickname":"Jingxiao","note":"","ucode":"EB966BB87132F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458085,"discussion_content":"线上代码里也有assert的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563041587,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1310226,"avatar":"https://static001.geekbang.org/account/avatar/00/13/fe/12/866b1b65.jpg","nickname":"谷子布","note":"","ucode":"C70F73CFCC4F06","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":401842,"discussion_content":"正式上线的时候如果有 assert 失败，会导致程序退出吧，所以必须得try except。但是这样就麻烦了。感觉 用 if 条件就能覆盖 assert的使用场景了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633747238,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":253897,"user_name":"郭纯","can_delete":false,"product_type":"c1","uid":1314521,"ip_address":"","ucode":"2613860B4642C4","user_header":"https://static001.geekbang.org/account/avatar/00/14/0e/d9/e61ce097.jpg","comment_is_top":false,"comment_ctime":1602940197,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23077776677","product_id":100026901,"comment_content":"怎么确定使用还是不使用 assert 首先确定这段代码是否有出现错误的可能 然后再确定删除 assert 代码会不会影响到原有的逻辑. assert 不应该用到业务的逻辑代码中 更多的是参数的检查，一段算法结果的验证. ","like_count":6},{"had_liked":false,"id":239565,"user_name":"云蝈蝈","can_delete":false,"product_type":"c1","uid":1219179,"ip_address":"","ucode":"19B1597DB49819","user_header":"https://static001.geekbang.org/account/avatar/00/12/9a/6b/e8ef2989.jpg","comment_is_top":false,"comment_ctime":1596588926,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"18776458110","product_id":100026901,"comment_content":"学习assert的时候用过","like_count":4,"discussions":[{"author":{"id":1033169,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c3/d1/bdf895bf.jpg","nickname":"penng","note":"","ucode":"6087CFCB0AC434","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541275,"discussion_content":"老哥，稳！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640315083,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2538092,"avatar":"","nickname":"懒猫","note":"","ucode":"094F30C802C0F6","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380203,"discussion_content":"哈哈哈，你想笑死我","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624372439,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1363634,"avatar":"https://static001.geekbang.org/account/avatar/00/14/ce/b2/1f914527.jpg","nickname":"海盗船长","note":"","ucode":"ECB28BA21A4113","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341360,"discussion_content":"你真逗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610408974,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138812,"user_name":"丁丁历险记","can_delete":false,"product_type":"c1","uid":1661704,"ip_address":"","ucode":"A43829E454C067","user_header":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","comment_is_top":false,"comment_ctime":1570459268,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14455361156","product_id":100026901,"comment_content":"个人理解，assert 主要是做健壮性处理。","like_count":3},{"had_liked":false,"id":114739,"user_name":"Fergus","can_delete":false,"product_type":"c1","uid":1277066,"ip_address":"","ucode":"3A8AC741C49CEB","user_header":"https://static001.geekbang.org/account/avatar/00/13/7c/8a/bdeb76ac.jpg","comment_is_top":false,"comment_ctime":1563374112,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14448276000","product_id":100026901,"comment_content":"assert 测试一个条件是否满足<br><br>检查值在某一确定的范围：<br>assert a&gt;0, “a must &gt; 0”<br><br>检查值的数据类型：<br>assert isinstance(a, list), “a should be list”<br><br>注：<br>1. assert 是可以使用-O关闭的；<br>2. run-time error需要使用try-except异常处理；","like_count":4},{"had_liked":false,"id":113781,"user_name":"倾","can_delete":false,"product_type":"c1","uid":1524099,"ip_address":"","ucode":"ADE03757A4AAE2","user_header":"https://static001.geekbang.org/account/avatar/00/17/41/83/a6263932.jpg","comment_is_top":false,"comment_ctime":1563155799,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14448057687","product_id":100026901,"comment_content":"一般不怎么用，全部使用异常处理的。","like_count":3},{"had_liked":false,"id":189026,"user_name":"Ray","can_delete":false,"product_type":"c1","uid":1253774,"ip_address":"","ucode":"A7059C7D505AA0","user_header":"","comment_is_top":false,"comment_ctime":1584447606,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10174382198","product_id":100026901,"comment_content":"之前在一个C++程序中用过assert语句，记得好像是在一个FTP下载模块中。后来很长时间没啥问题后也忘了，然后有一阵程序偶尔异常退出，查了半天发现是assert条件原因，最后发现原来是交换机出问题了时好时坏。","like_count":2},{"had_liked":false,"id":142876,"user_name":"自由民","can_delete":false,"product_type":"c1","uid":1346236,"ip_address":"","ucode":"435C67531697F1","user_header":"https://static001.geekbang.org/account/avatar/00/14/8a/bc/cb39ed38.jpg","comment_is_top":false,"comment_ctime":1571572621,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"10161507213","product_id":100026901,"comment_content":"在c++里用过，用得不多。Python里没用过。","like_count":2,"discussions":[{"author":{"id":1009002,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/65/6a/be36c108.jpg","nickname":"ikel","note":"","ucode":"1D5CE7803C1C2B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":323155,"discussion_content":"你们c++生产环境也用assert么","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604890754,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1346236,"avatar":"https://static001.geekbang.org/account/avatar/00/14/8a/bc/cb39ed38.jpg","nickname":"自由民","note":"","ucode":"435C67531697F1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1009002,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/65/6a/be36c108.jpg","nickname":"ikel","note":"","ucode":"1D5CE7803C1C2B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351336,"discussion_content":"没接触过生产环境，我是牙医，都是个人项目。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614247882,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":323155,"ip_address":""},"score":351336,"extra":""}]}]},{"had_liked":false,"id":114038,"user_name":"Eski","can_delete":false,"product_type":"c1","uid":1197937,"ip_address":"","ucode":"875B77DD33C223","user_header":"https://static001.geekbang.org/account/avatar/00/12/47/71/4fdb52bc.jpg","comment_is_top":false,"comment_ctime":1563214141,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10153148733","product_id":100026901,"comment_content":"经常在 try except 当中用 assert，比较方便在一些不需要程序继续执行下去的地方跳出来，比if else好用","like_count":2},{"had_liked":false,"id":113120,"user_name":"稳","can_delete":false,"product_type":"c1","uid":1284626,"ip_address":"","ucode":"BF5723E63E4115","user_header":"https://static001.geekbang.org/account/avatar/00/13/9a/12/06863960.jpg","comment_is_top":false,"comment_ctime":1562899611,"is_pvip":false,"replies":[{"id":"41333","content":"没有这个说法","user_name":"作者回复","user_name_real":"Jingxiao","uid":"1259521","ctime":1563041645,"ip_address":"","comment_id":113120,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5857866907","product_id":100026901,"comment_content":"我记得以前看过assert会严重影响运行性能，所以一直不在代码里用。工作中，主要是单元测试用，想跟老师了解fb的规定","like_count":1,"discussions":[{"author":{"id":1259521,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJOlibibPFEWOib8ib7RtfAtxND5FUqCxxoeTuLAbBI9ic23xuwdXT4IyiaWq3Fic9RgEAYI0lBTbEp2rcg/132","nickname":"Jingxiao","note":"","ucode":"EB966BB87132F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458066,"discussion_content":"没有这个说法","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563041645,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":348525,"user_name":"Soyoger","can_delete":false,"product_type":"c1","uid":2967576,"ip_address":"","ucode":"D4D7BD0ABC4491","user_header":"https://static001.geekbang.org/account/avatar/00/2d/48/18/e524f344.jpg","comment_is_top":false,"comment_ctime":1655171493,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1655171493","product_id":100026901,"comment_content":"业务代码确实很少用，但在测试的时候用的比较多。","like_count":0},{"had_liked":false,"id":175111,"user_name":"喵喵喵","can_delete":false,"product_type":"c1","uid":1211713,"ip_address":"","ucode":"E3AD8BF42E19DF","user_header":"https://static001.geekbang.org/account/avatar/00/12/7d/41/3c5b770b.jpg","comment_is_top":false,"comment_ctime":1580561168,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580561168","product_id":100026901,"comment_content":"打卡～","like_count":0},{"had_liked":false,"id":162258,"user_name":"隔壁家老鲍","can_delete":false,"product_type":"c1","uid":1591665,"ip_address":"","ucode":"560030862CC24A","user_header":"https://static001.geekbang.org/account/avatar/00/18/49/71/fc2b5cf2.jpg","comment_is_top":false,"comment_ctime":1576487945,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576487945","product_id":100026901,"comment_content":"一般都在测试里面使用<br>没有在正式环境里面使用过","like_count":0},{"had_liked":false,"id":154345,"user_name":"Paul Shan","can_delete":false,"product_type":"c1","uid":1593140,"ip_address":"","ucode":"32D99989028284","user_header":"","comment_is_top":false,"comment_ctime":1574411718,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574411718","product_id":100026901,"comment_content":"Assert 是正常逻辑之外的自检，只是写在代码里面多少有些让代码主体不清。","like_count":0},{"had_liked":false,"id":137719,"user_name":"djfhchdh","can_delete":false,"product_type":"c1","uid":1484184,"ip_address":"","ucode":"E71D75328CE398","user_header":"https://static001.geekbang.org/account/avatar/00/16/a5/98/a65ff31a.jpg","comment_is_top":false,"comment_ctime":1569829889,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569829889","product_id":100026901,"comment_content":"一般来说，测试代码最后一步都是assert","like_count":0},{"had_liked":false,"id":114503,"user_name":"Ben","can_delete":false,"product_type":"c1","uid":1252353,"ip_address":"","ucode":"70351D4FAE47F7","user_header":"https://static001.geekbang.org/account/avatar/00/13/1c/01/5aaaf5b6.jpg","comment_is_top":false,"comment_ctime":1563326394,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563326394","product_id":100026901,"comment_content":"python -V: Python 3.7.0<br>Python test.py -O时__debug__仍为True, Python -O test.py时为False","like_count":0},{"had_liked":false,"id":114407,"user_name":"Hector","can_delete":false,"product_type":"c1","uid":1496889,"ip_address":"","ucode":"110CAF87ADDC01","user_header":"https://static001.geekbang.org/account/avatar/00/16/d7/39/6698b6a9.jpg","comment_is_top":false,"comment_ctime":1563291241,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563291241","product_id":100026901,"comment_content":"项目中封装自己公司封装定义的expection，接口给出展示不同错误不会混用","like_count":0},{"had_liked":false,"id":113123,"user_name":"程序员人生","can_delete":false,"product_type":"c1","uid":1113668,"ip_address":"","ucode":"C5C5073D89AAA2","user_header":"https://static001.geekbang.org/account/avatar/00/10/fe/44/3e3040ac.jpg","comment_is_top":false,"comment_ctime":1562900221,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562900221","product_id":100026901,"comment_content":"老师，没有用过assert唉。看你介绍，好像用来调试程序用","like_count":0},{"had_liked":false,"id":113113,"user_name":"carpe_diem","can_delete":false,"product_type":"c1","uid":1085804,"ip_address":"","ucode":"25A77D8D146A4F","user_header":"https://static001.geekbang.org/account/avatar/00/10/91/6c/054a0745.jpg","comment_is_top":false,"comment_ctime":1562898592,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1562898592","product_id":100026901,"comment_content":"assert主要用于开发和测试阶段，使用assert时，应该是思考一下，当去掉assert语句之后，代码逻辑是否仍然正确。","like_count":0},{"had_liked":false,"id":113105,"user_name":"天凉好个秋","can_delete":false,"product_type":"c1","uid":1136145,"ip_address":"","ucode":"E11B5F990A4000","user_header":"https://static001.geekbang.org/account/avatar/00/11/56/11/5d113d5c.jpg","comment_is_top":false,"comment_ctime":1562897046,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562897046","product_id":100026901,"comment_content":"感觉只要可以disable，那还是需要对相同问题加入if判断啊。是否是像其他同学说的自测阶段才能用assert呢？并且对于可能出现的相同问题需要用assert写一遍，再用if写一遍？","like_count":0},{"had_liked":false,"id":113063,"user_name":"enjoylearning","can_delete":false,"product_type":"c1","uid":1000237,"ip_address":"","ucode":"DCAF8538DEA277","user_header":"https://static001.geekbang.org/account/avatar/00/0f/43/2d/af86d73f.jpg","comment_is_top":false,"comment_ctime":1562892674,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1562892674","product_id":100026901,"comment_content":"assert想用但不确信什么情况下用，一直以为python没法做debug判断，原来也有个类似，我们线上经常出现一些诡异的bug，不知道可不可以开启这个","like_count":0,"discussions":[{"author":{"id":1104407,"avatar":"https://static001.geekbang.org/account/avatar/00/10/da/17/69cca649.jpg","nickname":"旗木卡卡","note":"","ucode":"2C05BFE91D6892","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3078,"discussion_content":"这个用logging模块实现更合适吧？可以调整日志级别。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564149590,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1000237,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/43/2d/af86d73f.jpg","nickname":"enjoylearning","note":"","ucode":"DCAF8538DEA277","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1104407,"avatar":"https://static001.geekbang.org/account/avatar/00/10/da/17/69cca649.jpg","nickname":"旗木卡卡","note":"","ucode":"2C05BFE91D6892","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3348,"discussion_content":"嗯，貌似logging更好，不过现在系统日志太多反而不好排查了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564412830,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":3078,"ip_address":""},"score":3348,"extra":""}]}]},{"had_liked":false,"id":113028,"user_name":"安排","can_delete":false,"product_type":"c1","uid":1260026,"ip_address":"","ucode":"F78CFA9624CAEF","user_header":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","comment_is_top":false,"comment_ctime":1562889951,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562889951","product_id":100026901,"comment_content":"自测阶段才能用assert吧？上线长时间运行的程序都会disable掉assert吧？","like_count":0},{"had_liked":false,"id":113016,"user_name":"AllenGFLiu","can_delete":false,"product_type":"c1","uid":1221991,"ip_address":"","ucode":"90FA8A619A2629","user_header":"https://static001.geekbang.org/account/avatar/00/12/a5/67/bf286335.jpg","comment_is_top":false,"comment_ctime":1562888075,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562888075","product_id":100026901,"comment_content":"以前看其他课程，倒是都没讲过 assert这一点，看下来觉得assert还是大有用武之地的，一定找机会用一下。","like_count":0},{"had_liked":false,"id":113014,"user_name":"Hurt","can_delete":false,"product_type":"c1","uid":1050946,"ip_address":"","ucode":"DCE7428CCF08EF","user_header":"https://static001.geekbang.org/account/avatar/00/10/09/42/1f762b72.jpg","comment_is_top":false,"comment_ctime":1562888001,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562888001","product_id":100026901,"comment_content":"可以这么理解吗 只是用来作为自我检查 而不是用来做你代码的判断条件的","like_count":0}]}