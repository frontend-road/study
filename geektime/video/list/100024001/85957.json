{"id":85957,"title":"28 | ä»»åŠ¡çš„å–æ¶ˆ","content":"<h1>è¯¾ä»¶åŠæºä»£ç åœ°å€</h1><p><a href=\"https://gitee.com/geektime-geekbang/go_learning\">https://gitee.com/geektime-geekbang/go_learning</a></p><h2>ä¹¦ç›®æ¨è</h2><p><a href=\"time://mall?url=https%3A%2F%2Fh5.youzan.com%2Fv2%2Fgoods%2F1ycmk3uob0ryw\">ã€Šè®¡ç®—æœºç¨‹åºçš„æ„é€ å’Œè§£é‡Šã€‹</a></p>","comments":[{"had_liked":false,"id":79014,"user_name":"äºšä¸œ","can_delete":false,"product_type":"c3","uid":1207629,"ip_address":"","ucode":"D76E7F593D6CBA","user_header":"https://static001.geekbang.org/account/avatar/00/12/6d/4d/ada0aa8a.jpg","comment_is_top":false,"comment_ctime":1553323184,"is_pvip":false,"replies":[{"id":28829,"content":"struct{}è¡¨ç¤ºç©ºç»“æ„ï¼Œç¬¬äºŒä¸ªè¡¨ç¤ºå®ä¾‹åŒ–è¿™ä¸ªç©ºç»“æ„","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1553347809,"ip_address":"","comment_id":79014,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"strict{}{}ï¼Œä½œä¸ºèµ‹å€¼çš„æ—¶å€™ï¼Œä¸ºä»€ä¹ˆæœ‰ä¸¤ä¸ª{}?","like_count":12,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444325,"discussion_content":"struct{}è¡¨ç¤ºç©ºç»“æ„ï¼Œç¬¬äºŒä¸ªè¡¨ç¤ºå®ä¾‹åŒ–è¿™ä¸ªç©ºç»“æ„","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1553347809,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1105161,"avatar":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","nickname":"helloworld","note":"","ucode":"1EECCA0F43E278","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":47324,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573312788,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":137233,"user_name":"Aiden","can_delete":false,"product_type":"c3","uid":1397688,"ip_address":"","ucode":"B29CB52C2512A7","user_header":"https://static001.geekbang.org/account/avatar/00/15/53/b8/dee6b4f6.jpg","comment_is_top":false,"comment_ctime":1569662141,"is_pvip":false,"replies":[{"id":52940,"content":"func isCancelled(cancelChan chan struct{}) bool {\n\tselect {\n\tcase &lt;-cancelChan:\n\t\treturn true\n\tdefault:\n\t\treturn false\n\t}\n}\n\nclose(cancelChan)ä¼šä½¿æ‰€æœ‰å¤„äºå¤„äºé˜»å¡ç­‰å¾…çŠ¶æ€çš„ï¼Œæ¶ˆæ¯æ¥æ”¶è€…ï¼ˆ&lt;-cancelChan)è¿”å›ï¼Œæ‰€ä»¥ä¸Šé¢çš„ä»£ç case &lt;-cancelChanåˆ†æ”¯å°±ä¼šæ‰§è¡Œä¸‹å»ï¼Œè¿”å›true","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1569836641,"ip_address":"","comment_id":137233,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œ\nfunc cancel_1ä¼ ç»™channelä¸€ä¸ªå€¼ï¼ŒisCancelledå–å‡ºä¸€ä¸ªå€¼è¿”å›trueå®¹æ˜“ç†è§£ï¼Œ\nåœ¨func cancel_2ä¸­ï¼Œå‡½æ•°closeäº†channelåï¼Œä¸ºä»€ä¹ˆisCancelledå‡½æ•°ä¾ç„¶è¿”å›trueï¼Ÿ\næˆ‘æ”¹å†™äº†è¯¥ç¨‹åºå¦‚ä¸‹ï¼Œ&lt;-cancelChè‡ªå·±è¿”å›çš„boolå€¼åœ¨closeçš„æƒ…å†µä¸‹è¿”å›çš„å°±æ˜¯falseï¼Œè¿™é‡Œåº”è¯¥æ€ä¹ˆç†è§£ï¼Ÿ\nfunc TestCancel(t *testing.T) {\n\tcancelChan := make(chan int, 0)\n\tfor i := 0; i &lt; 5; i++ {\n\t\tgo func(i int, cancelCh chan int) {\n\t\t\tfor {\n\t\t\t\tif _, ok := &lt;-cancelCh; !ok {&#47;&#47;è¿™é‡Œok=falseï¼Ÿ\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\ttime.Sleep(time.Millisecond * 5)\n\t\t\t}\n\t\t\tfmt.Println(i, &quot;Cancelled&quot;)\n\t\t}(i, cancelChan)\n\t}\n\tclose(cancelChan)\n\ttime.Sleep(time.Second * 1)\n}","like_count":3,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468994,"discussion_content":"func isCancelled(cancelChan chan struct{}) bool {\n\tselect {\n\tcase &amp;lt;-cancelChan:\n\t\treturn true\n\tdefault:\n\t\treturn false\n\t}\n}\n\nclose(cancelChan)ä¼šä½¿æ‰€æœ‰å¤„äºå¤„äºé˜»å¡ç­‰å¾…çŠ¶æ€çš„ï¼Œæ¶ˆæ¯æ¥æ”¶è€…ï¼ˆ&amp;lt;-cancelChan)è¿”å›ï¼Œæ‰€ä»¥ä¸Šé¢çš„ä»£ç case &amp;lt;-cancelChanåˆ†æ”¯å°±ä¼šæ‰§è¡Œä¸‹å»ï¼Œè¿”å›true","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569836641,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1491655,"avatar":"https://static001.geekbang.org/account/avatar/00/16/c2/c7/670f8b6c.jpg","nickname":"Van","note":"","ucode":"35E576FD0AD79B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":191540,"discussion_content":"close(cancelChan) ä¿ƒä½¿æ‰€æœ‰å¤„äºé˜»å¡ç­‰å¾…çŠ¶æ€çš„æ¶ˆæ¯æ¥æ”¶è€…è¿”å›ï¼Œå³ä½¿æ²¡æœ‰æ¶ˆæ¯äº§ç”Ÿæ¥æ”¶è€…ä¹Ÿä¼šè¿”å›å¯¹åº”ç±»å‹çš„ç©ºå€¼ï¼Œè¿™ä¹ˆç†è§£å¯¹å—ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1582994543,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1400034,"avatar":"https://static001.geekbang.org/account/avatar/00/15/5c/e2/0c9380cb.jpg","nickname":"å¿—é“­","note":"","ucode":"64672FFF635853","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1491655,"avatar":"https://static001.geekbang.org/account/avatar/00/16/c2/c7/670f8b6c.jpg","nickname":"Van","note":"","ucode":"35E576FD0AD79B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548678,"discussion_content":"package cancel_chan\n\nimport (\n\t&#34;fmt&#34;\n\t&#34;testing&#34;\n\t&#34;time&#34;\n)\n\nfunc IsCancel(ch chan struct{}) bool {\n\tselect {\n\tcase ret, ok := &lt;-ch:\n\t\tfmt.Println(ret, ok)\n\t\treturn true\n\tdefault:\n\t\treturn false\n\t}\n}\n\nfunc cancel1(ch chan struct{}) {\n\tclose(ch)\n}\n\nfunc cancel2(ch chan struct{}) {\n\tch &lt;- struct{}{}\n}\n\nfunc TestCancelTask(t *testing.T) {\n\tch := make(chan struct{})\n\tfor i := 0; i &lt; 5; i++ {\n\t\tgo func(ch chan struct{}, i int) {\n\t\t\tfor {\n\t\t\t\tif IsCancel(ch) {\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\ttime.Sleep(time.Microsecond * 100)\n\t\t\t}\n\t\t\tfmt.Println(i, &#34;Done&#34;)\n\t\t}(ch, i)\n\t}\n\tcancel1(ch)\n\ttime.Sleep(time.Second * 2)\n}\n\n--------------------------------------------------------\nç»“æœ\n=== RUN   TestCancelTask\n{} false\n4 Done\n{} false\n{} false\n2 Done\n{} false\n3 Done\n1 Done\n{} false\n0 Done\n--- PASS: TestCancelTask (2.00s)\nPASS\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643304364,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":191540,"ip_address":"","group_id":0},"score":548678,"extra":""}]}]},{"had_liked":false,"id":250947,"user_name":"Geek_427d0c","can_delete":false,"product_type":"c3","uid":1876823,"ip_address":"","ucode":"D7A04138C4B8CB","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/X4ib36ADEvj76XaKD4OUY9k15KqWCAVCwibPicBxz6BBUfDrVolpYInn8zFOw3JBPtVw3L4Lkibaf2eLPemwGKzAXA/132","comment_is_top":false,"comment_ctime":1601287743,"is_pvip":false,"replies":[{"id":91842,"content":"è¿™æ˜¯å› ä¸ºch&lt;-&quot;Hi&quot;è¿™ä¸€å¥å°±è¢«é˜»å¡äº†ï¼Œéƒ½æ²¡æœ‰åŠæ³•æ‰§è¡Œåˆ°ä¸‹é¢çš„æ¥æ”¶éƒ¨åˆ†","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1601386249,"ip_address":"","comment_id":250947,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"è€å¸ˆå¥½ï¼Œè¯·æ•™ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆä¸‹é¢çš„ç¨‹åºä¼šä¸€ç›´å¡ä½ç›´åˆ°go testçš„å¯åŠ¨è¶…æ—¶å‚æ•°è¶…æ—¶ï¼š\nfunc TestA(t *testing.T) {\nch := make(chan string)\nch &lt;- &quot;Hi&quot;\nselect {\n  case ret:= &lt;-ch:\n    fmt.Println(&quot;channel receives&quot;, ret)\n  default:\n    t.Log(&quot;default&quot;)\n}\n}","like_count":2,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":506343,"discussion_content":"è¿™æ˜¯å› ä¸ºch&amp;lt;-&amp;quot;Hi&amp;quot;è¿™ä¸€å¥å°±è¢«é˜»å¡äº†ï¼Œéƒ½æ²¡æœ‰åŠæ³•æ‰§è¡Œåˆ°ä¸‹é¢çš„æ¥æ”¶éƒ¨åˆ†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601386249,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187418,"user_name":"Kvicii.Y","can_delete":false,"product_type":"c3","uid":1442588,"ip_address":"","ucode":"446BFA633569EA","user_header":"https://static001.geekbang.org/account/avatar/00/16/03/1c/c9fe6738.jpg","comment_is_top":false,"comment_ctime":1584105666,"is_pvip":false,"replies":[{"id":74522,"content":"ç¬¬ä¸€ä¸ªæ˜¯æ–¹æ³•å®šä¹‰ï¼ˆè¿™é‡Œæ²¡æœ‰å…¥å‚å®šä¹‰ï¼‰ï¼Œç¬¬äºŒä¸ªä»£è¡¨æ–¹æ³•è°ƒç”¨","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1585358423,"ip_address":"","comment_id":187418,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"func TestChannel(t *testing.T) {\n\n\tchannel := make(chan struct{}, 0)\n\n\tfor i := 0; i &lt; 5; i++ {\n\t\tgo func() {\n\t\t\tfor {\n\t\t\t\tif isCanceled(ch) {\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\ttime.Sleep(time.Millisecond * 5)\n\t\t\t}\n\t\t\tfmt.Println(i, &quot;cancel&quot;)\n\t\t}()\n\t}\n\t&#47;&#47; cancel_1(channel)\n\tcancel_2(channel)\n\ttime.Sleep(time.Millisecond * 1)\n}\næˆ‘æ²¡æœ‰åœ¨go func()ä¸­ä¼ å…¥å‚æ•°ä¹Ÿæ˜¯å¯ä»¥è¿è¡Œçš„ï¼Œgo func(){}()å‰åçš„()æœ‰ä»€ä¹ˆæ„ä¹‰å‘¢ï¼Ÿåä¸€ä¸ª()ä»£è¡¨å¤–éƒ¨ä¼ å…¥å‚æ•°ï¼Ÿç¬¬ä¸€ä¸ª()ä»£è¡¨å½¢å‚ç±»å‹æ‰€ä»¥éœ€è¦å®Œå…¨å£°æ˜ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487102,"discussion_content":"ç¬¬ä¸€ä¸ªæ˜¯æ–¹æ³•å®šä¹‰ï¼ˆè¿™é‡Œæ²¡æœ‰å…¥å‚å®šä¹‰ï¼‰ï¼Œç¬¬äºŒä¸ªä»£è¡¨æ–¹æ³•è°ƒç”¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585358423,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":300258,"user_name":"Roy","can_delete":false,"product_type":"c3","uid":2633127,"ip_address":"","ucode":"2B1675B084D3A6","user_header":"https://static001.geekbang.org/account/avatar/00/28/2d/a7/c7b0c34e.jpg","comment_is_top":false,"comment_ctime":1625065667,"is_pvip":false,"replies":[{"id":108925,"content":"èµå•Šã€‚ç»™å¤§å®¶åˆ†äº«ä¸€ä¸‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"è”¡è¶…","uid":1008262,"ctime":1625276141,"ip_address":"","comment_id":300258,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"è€å¸ˆï¼Œæ‚¨è¿™ä¸ªç”¨ sleep() çš„æ–¹æ¡ˆä¸å¥½ï¼Œæˆ‘ç»“åˆå‰é¢å­¦çš„çŸ¥è¯†ï¼Œç”¨ sync.WaitGroup å†™äº†ä¸€ä¸ªä¼˜åŒ–ç‰ˆï¼Œæˆ‘æµ‹è¯•äº†ä¸€ä¸‹æ˜¯okçš„ï¼Œè€å¸ˆçœ‹çœ‹ ok ä¸ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522691,"discussion_content":"èµå•Šã€‚ç»™å¤§å®¶åˆ†äº«ä¸€ä¸‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625276141,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":235918,"user_name":"å®ä»”","can_delete":false,"product_type":"c3","uid":1013493,"ip_address":"","ucode":"A0F17DFF99DB21","user_header":"https://static001.geekbang.org/account/avatar/00/0f/76/f5/e3f5bd8d.jpg","comment_is_top":false,"comment_ctime":1595243400,"is_pvip":false,"replies":[{"id":87553,"content":"func isCancelled(cancelChan chan struct{}) bool {\n\tselect {\n\tcase &lt;-cancelChan:\n\t\treturn true\n\tdefault:\n\t\treturn false\n\t}\n}\n\næ³¨æ„ä¸€ä¸‹ selectä¸‹çš„defaultï¼Œ&lt;-cancelChané˜»å¡çš„æ—¶å€™ï¼Œå°±ä¼šç«‹å³è¿è¡Œdefaultåˆ†æ”¯","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1595598907,"ip_address":"","comment_id":235918,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"é€šè¿‡selectæ¥åˆ¤æ–­ä»»åŠ¡æ˜¯å¦è¢«å–æ¶ˆçš„è¯ï¼Œä¸‹é¢çš„ä»£ç éƒ½è¢«é˜»å¡äº†è€å¸ˆï¼Œè¿™æ ·time.Sleep(time.Millisecond * 5000)è¿˜æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œæœ›è€å¸ˆå›ç­”","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501880,"discussion_content":"func isCancelled(cancelChan chan struct{}) bool {\n\tselect {\n\tcase &amp;lt;-cancelChan:\n\t\treturn true\n\tdefault:\n\t\treturn false\n\t}\n}\n\næ³¨æ„ä¸€ä¸‹ selectä¸‹çš„defaultï¼Œ&amp;lt;-cancelChané˜»å¡çš„æ—¶å€™ï¼Œå°±ä¼šç«‹å³è¿è¡Œdefaultåˆ†æ”¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595598907,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1013493,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/76/f5/e3f5bd8d.jpg","nickname":"å®ä»”","note":"","ucode":"A0F17DFF99DB21","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293696,"discussion_content":"å—¯å—¯ï¼Œæ˜ç™½äº†ï¼è°¢è°¢è€å¸ˆç™¾å¿™ä¹‹ä¸­æŠ½æ—¶é—´å›ç­”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595644691,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":234058,"user_name":"é¹¤æ¶µ","can_delete":false,"product_type":"c3","uid":1021825,"ip_address":"","ucode":"22CBBC13FC97A9","user_header":"https://static001.geekbang.org/account/avatar/00/0f/97/81/c457def1.jpg","comment_is_top":false,"comment_ctime":1594567647,"is_pvip":false,"replies":[{"id":87660,"content":"close chanä¹Ÿä¼šä½¿å¾—ç­‰å¾…è¯»å–æ“ä½œé©¬ä¸Šè¿”å›","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1595766794,"ip_address":"","comment_id":234058,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"func isCanceled(cancelCh chan struct{}) bool {\n\tselect {\n\tcase &lt;-cancelCh:\n\t\treturn true\n\tdefault:\n\t\treturn false\n\t}\n}\nchannel close ä¹Ÿä¼šè§¦å‘select case &lt;-cancelCh ä¸ºä»€ä¹ˆå‘¢","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501259,"discussion_content":"close chanä¹Ÿä¼šä½¿å¾—ç­‰å¾…è¯»å–æ“ä½œé©¬ä¸Šè¿”å›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595766794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":90143,"user_name":"äºŒå¸ˆå…„","can_delete":false,"product_type":"c3","uid":1073298,"ip_address":"","ucode":"28D831095D69D5","user_header":"https://static001.geekbang.org/account/avatar/00/10/60/92/ab4f40f6.jpg","comment_is_top":false,"comment_ctime":1556428772,"is_pvip":false,"replies":[{"id":32384,"content":"åº”è¯¥æ²¡æœ‰é—®é¢˜çš„ï¼Œçœ‹çœ‹ä½ æ˜¯ä¸æ˜¯æŠŠcancelåé¢çš„sleepåˆ é™¤äº†","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1556508777,"ip_address":"","comment_id":90143,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"```go\nfunc TestCancel(t *testing.T) {\n\tcancelCh := make(chan struct{}, 0)\n\n\tfor i := 0; i &lt; 3; i++ {\n\t\tgo func(i int, cc chan struct{}) {\n\t\t\tfor {\n\t\t\t\tif isCancelled(cc) {\n\t\t\t\t\tbreak\n\t\t\t\t} else {\n\t\t\t\t\tfmt.Println(i, &quot;Not Yet&quot;)\n\t\t\t\t}\n\t\t\t\ttime.Sleep(time.Millisecond * 5)\n\t\t\t}\n\t\t\tfmt.Println(i, &quot;Canceled&quot;)\n\t\t}(i, cancelCh)\n\t}\n\ttime.Sleep(time.Millisecond * 100) &#47;&#47; ???? å¦‚æœåŠ ä¸Šè¿™ä¸€è¡Œ, å°±çœ‹ä¸åˆ°Canceledçš„è¾“å‡º\n\tcancel2(cancelCh)\n}\n```\n\nå¦‚æœæˆ‘åœ¨cancel2è°ƒç”¨ä¹‹å‰, å¢åŠ ä¸€ä¸ªsleep, åˆ™åªä¼šè¾“å‡ºâ€œNot Yetâ€, ä¸ä¼šçœ‹åˆ°â€œCanceledâ€, è¯·é—®è€å¸ˆè¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢?","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448403,"discussion_content":"åº”è¯¥æ²¡æœ‰é—®é¢˜çš„ï¼Œçœ‹çœ‹ä½ æ˜¯ä¸æ˜¯æŠŠcancelåé¢çš„sleepåˆ é™¤äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556508777,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1056807,"avatar":"https://static001.geekbang.org/account/avatar/00/10/20/27/a6932fbe.jpg","nickname":"è™¢åœ‹æŠ€é†¬","note":"","ucode":"5A192262AA037E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4185,"discussion_content":"éªŒè¯äº†ä¸‹ æœ‰è¾“å‡ºçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565195812,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":87381,"user_name":"Ian","can_delete":false,"product_type":"c3","uid":1239054,"ip_address":"","ucode":"E025D2686E673F","user_header":"https://static001.geekbang.org/account/avatar/00/12/e8/0e/8caa9608.jpg","comment_is_top":false,"comment_ctime":1555580017,"is_pvip":false,"replies":[{"id":31417,"content":"closeæœ‰ä¸€ç§ç±»ä¼¼å¹¿æ’­çš„æ•ˆæœï¼Œæ‰€æœ‰å¤„äºæ¥æ”¶ç­‰å¾…çŠ¶æ€çš„æ¥æ”¶è€…éƒ½ä¼šç«‹å³è¿”å›ã€‚ä½ åœ¨ä»”ç»†çœ‹ä¸€éè§†é¢‘ï¼Œå¹¶è¯•è¯•ç¤ºä¾‹ä»£ç å°±æ¸…æ¥šäº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ChaoCai2010","uid":1008262,"ctime":1555592635,"ip_address":"","comment_id":87381,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"func cancel_2(cancelChan chan struct{}){\n\tclose(cancelChan)\n}\nè¿™é‡Œï¼Œä¸ºä»€ä¹ˆéƒ½ä¼šæ”¶åˆ°ï¼Ÿæ²¡å¼„æ˜ç™½ã€‚æœ¬èŠ‚è¯¾ä¹Ÿå¬çš„æœ‰ç‚¹ç³Šæ¶‚ã€‚","like_count":0,"discussions":[{"author":{"id":1008262,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/86/632ad029.jpg","nickname":"è”¡è¶…","note":"","ucode":"4C281BBF511238","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447419,"discussion_content":"closeæœ‰ä¸€ç§ç±»ä¼¼å¹¿æ’­çš„æ•ˆæœï¼Œæ‰€æœ‰å¤„äºæ¥æ”¶ç­‰å¾…çŠ¶æ€çš„æ¥æ”¶è€…éƒ½ä¼šç«‹å³è¿”å›ã€‚ä½ åœ¨ä»”ç»†çœ‹ä¸€éè§†é¢‘ï¼Œå¹¶è¯•è¯•ç¤ºä¾‹ä»£ç å°±æ¸…æ¥šäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555592635,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89758,"user_name":"å¼ å…ˆæ£®ã€","can_delete":false,"product_type":"c3","uid":1449299,"ip_address":"","ucode":"CEE436F2F34DE2","user_header":"https://static001.geekbang.org/account/avatar/00/16/1d/53/a7d86ab3.jpg","comment_is_top":false,"comment_ctime":1556257085,"is_pvip":false,"replies":null,"discussion_count":8,"race_medal":0,"score":2,"product_id":100024001,"comment_content":"ä¸ºä»€ä¹ˆæ¯æ¬¡éƒ½æ˜¯4 Canceled ,ä¸åº”è¯¥æ˜¯ä»è¿™5ä¸ªåç¨‹é‡Œé¢éšæœºé€‰ä¸€ä¸ªå—ï¼Ÿ","like_count":9,"discussions":[{"author":{"id":1099379,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c6/73/abb7bfe3.jpg","nickname":"ç–¯ç´","note":"","ucode":"82ACAA4A27753D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":53903,"discussion_content":"æˆ‘ä¹Ÿæ¯æ¬¡éƒ½æ˜¯&#34;4 Done&#34;ï¼Œæˆ‘è§‰å¾—åº”è¯¥è·Ÿcpué¢‘ç‡æœ‰å…³ç³»å§ï¼Œ5ä¸ªåç¨‹æ’’å‡ºå»ä»¥åï¼Œcancel_1 æ‰§è¡Œçš„æ—¶å€™æ­£å¥½ç¬¬4ä¸ªåç¨‹é€®åˆ° cancel äº†ï¼Œæˆ‘è¯•äº†å¦‚æœåœ¨ cancel_1 ä¹‹å‰åŠ ä¸€ç‚¹ç­‰å¾…æ—¶é—´ï¼Œå°±ä¸ä¸€å®šæ˜¯ 4 Done äº†ã€‚","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1574231282,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1491655,"avatar":"https://static001.geekbang.org/account/avatar/00/16/c2/c7/670f8b6c.jpg","nickname":"Van","note":"","ucode":"35E576FD0AD79B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1099379,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c6/73/abb7bfe3.jpg","nickname":"ç–¯ç´","note":"","ucode":"82ACAA4A27753D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":191546,"discussion_content":"è€å“¥ï¼Œç¨³ï½","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1582994780,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":53903,"ip_address":"","group_id":0},"score":191546,"extra":""}]},{"author":{"id":1198883,"avatar":"https://static001.geekbang.org/account/avatar/00/12/4b/23/eb028d06.jpg","nickname":"AKA_AresğŸ¤","note":"","ucode":"03DF5ADDE9D772","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":151947,"discussion_content":"æ ¹æ®goroutineçš„MPGè°ƒåº¦æ¨¡å‹ç¡®å®æŒ‰ç…§ç†è®ºä¸Šåº”è¯¥æ˜¯éšæœºè°ƒåº¦çš„,åœ¨for å¾ªç¯ä¹‹å‰åŠ ä¸Šfmt.Printf(&#34;go routine:%v \\n&#34;, i)çš„æ‰“å°ä½ å°±èƒ½å¾ˆæ¸…æ™°çš„çœ‹åˆ°ç¡®å®æ˜¯éšæœºè°ƒåº¦çš„è€Œä¸”ä¹Ÿæ˜¯éšæœºcancel","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1579922234,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1325498,"avatar":"https://static001.geekbang.org/account/avatar/00/14/39/ba/a2b48904.jpg","nickname":"Min","note":"","ucode":"068EBBA531BB21","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368294,"discussion_content":"æˆ‘æµ‹è¯•äº†ä¸€ä¸‹ï¼Œå¯ä»¥å¤šæ‰§è¡Œå‡ æ¬¡ï¼Œ4 ä¸ä¸€å®šæ˜¯ç¬¬ä¸€ä¸ª Doneã€‚æˆ–è€…å°†å°†åç¨‹ä¸ªæ•°æ”¹ä¸º 1000 æ¯æ¬¡æ‰§è¡Œçš„é¡ºåºä¸è§å¾—ä¸€æ ·ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618645908,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1020525,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","nickname":"escray","note":"","ucode":"1F4204930E47C4","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366290,"discussion_content":"åŠ ä¸€ç‚¹ç­‰å¾…æ—¶é—´ï¼Œæ’é™¤ç¼“å­˜å¯¹ç¨‹åºçš„å½±å“ï¼Œä¼¼ä¹è¿˜æ˜¯ä¼šæˆä¸ºä¸€ä¸ªç›¸å¯¹å›ºå®šçš„å€¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618021875,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1017289,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKDe7Ep3YW87sWJLc9GzgA2z1CSyHI3iaZQpCLzM2O1e30CQywGsMj5cQyh6pTGybvFgN0bTuWE8nA/132","nickname":"é£éª‘","note":"","ucode":"D96526F7F37442","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":140022,"discussion_content":"è¿™å—å¼„æ˜ç™½äº†ä¹ˆï¼Œæˆ‘ä¹Ÿä¸æ˜¯å¾ˆç†è§£ï¼Œè€Œä¸”ä¸æ­¢è¿™ä¸ªï¼Œå‰å‡ èŠ‚æœ‰ä¸ªé—®é¢˜ä¹Ÿæ˜¯ï¼ŒæŒ‰è¯´åº”è¯¥æ˜¯éšæœºå‡ºç°çš„ï¼Œä½†éƒ½æ˜¯è·Ÿç¬¬ä¸€æ¬¡æ‰§è¡Œçš„ç»“æœä¸€æ ·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579341607,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1019807,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8f/9f/e49b68ea.jpg","nickname":"å¹½å¼¥ç‹‚","note":"","ucode":"5AECEA7D6ADF33","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1017289,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKDe7Ep3YW87sWJLc9GzgA2z1CSyHI3iaZQpCLzM2O1e30CQywGsMj5cQyh6pTGybvFgN0bTuWE8nA/132","nickname":"é£éª‘","note":"","ucode":"D96526F7F37442","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":241367,"discussion_content":"æˆ‘ä¹Ÿå¥½å¤šæ²¡å¼„æ˜ç™½ï¼Œè¡¨ç¤ºè¿™äº›åªèƒ½è·Ÿç€ä»£ç æ•²ã€‚åŸç†ä¸æ˜æ‰€ä»¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587399199,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":140022,"ip_address":"","group_id":0},"score":241367,"extra":""},{"author":{"id":1020525,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","nickname":"escray","note":"","ucode":"1F4204930E47C4","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1017289,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKDe7Ep3YW87sWJLc9GzgA2z1CSyHI3iaZQpCLzM2O1e30CQywGsMj5cQyh6pTGybvFgN0bTuWE8nA/132","nickname":"é£éª‘","note":"","ucode":"D96526F7F37442","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":366288,"discussion_content":"æœ‰çš„å¯èƒ½æ˜¯å› ä¸ºç¨‹åºè¢«ç¼“å­˜äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618021831,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":140022,"ip_address":"","group_id":0},"score":366288,"extra":""}]}]},{"had_liked":false,"id":213870,"user_name":"flow","can_delete":false,"product_type":"c3","uid":1081987,"ip_address":"","ucode":"0AD565ECBF461E","user_header":"https://static001.geekbang.org/account/avatar/00/10/82/83/b96a8b7a.jpg","comment_is_top":false,"comment_ctime":1588580849,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"åº”è¯¥è¯´æ˜ä¸€ä¸‹ï¼šè¿™ä¸ªç¤ºä¾‹åªæ˜¯å•çº¯åˆ©ç”¨å¹¿æ’­æœºåˆ¶è¾¾æˆä»»åŠ¡çš„å–æ¶ˆï¼Œè¿™ä¸ªchannelæ˜¯ä¸è´Ÿè´£ä¼ è¾“æ•°æ®çš„","like_count":7,"discussions":[{"author":{"id":1435172,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e6/24/30806a88.jpg","nickname":"right-chen","note":"","ucode":"E0E940E80E7A2D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583140,"discussion_content":"å¯¹ï¼Œå½“channelå…³é—­æ—¶ï¼Œå¤šä¸ªåç¨‹ç›‘å¬ç«¯è·å¾—å…³é—­çš„çŠ¶æ€ï¼Œæ‰§è¡Œèµ°ä¸€ç§æ“ä½œï¼Œä¹Ÿæ˜¯ä¸€ç§å¹¿æ’­æœºåˆ¶ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659928610,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":300259,"user_name":"Roy","can_delete":false,"product_type":"c3","uid":2633127,"ip_address":"","ucode":"2B1675B084D3A6","user_header":"https://static001.geekbang.org/account/avatar/00/28/2d/a7/c7b0c34e.jpg","comment_is_top":false,"comment_ctime":1625065695,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"package cancel_by_close\n\nimport (\n\t&quot;fmt&quot;\n\t&quot;sync&quot;\n\t&quot;testing&quot;\n\t&quot;time&quot;\n)\n\n&#47;&#47;ä»»åŠ¡æ˜¯å¦å·²è¢«å–æ¶ˆ\n&#47;&#47;å®ç°åŸç†ï¼š\n&#47;&#47;æ£€æŸ¥æ˜¯å¦ä» channel æ”¶åˆ°ä¸€ä¸ªæ¶ˆæ¯ï¼Œå¦‚æœæ”¶åˆ°ä¸€ä¸ªæ¶ˆæ¯ï¼Œæˆ‘ä»¬å°±è¿”å› trueï¼Œä»£è¡¨ä»»åŠ¡å·²ç»è¢«å–æ¶ˆäº†\n&#47;&#47;å½“æ²¡æœ‰æ”¶åˆ°æ¶ˆæ¯ï¼Œchannel ä¼šè¢«é˜»å¡ï¼Œå¤šè·¯é€‰æ‹©æœºåˆ¶å°±ä¼šèµ°åˆ° default åˆ†æ”¯ä¸Šå»ã€‚\nfunc isCanceled(cancelChan chan struct{}) bool {\n\tselect {\n\tcase &lt;-cancelChan:\n\t\treturn true\n\tdefault:\n\t\treturn false\n\t}\n}\n\n&#47;&#47;æ‰§è¡Œä»»åŠ¡å–æ¶ˆ\n&#47;&#47;å› ä¸º close() æ˜¯ä¸€ä¸ªå¹¿æ’­æœºåˆ¶ï¼Œæ‰€ä»¥æ‰€æœ‰çš„åç¨‹éƒ½ä¼šæ”¶åˆ°æ¶ˆæ¯\nfunc execCancel(cancelChan chan struct{})  {\n\t&#47;&#47; close(cancelChan)ä¼šä½¿æ‰€æœ‰å¤„äºå¤„äºé˜»å¡ç­‰å¾…çŠ¶æ€çš„æ¶ˆæ¯æ¥æ”¶è€…ï¼ˆ&lt;-cancelChan)æ”¶åˆ°æ¶ˆæ¯\n\tclose(cancelChan)\n}\n\n&#47;&#47;åˆ©ç”¨ CSP, å¤šè·¯é€‰æ‹©æœºåˆ¶å’Œ channel çš„å…³é—­ä¸å¹¿æ’­å®ç°ä»»åŠ¡å–æ¶ˆåŠŸèƒ½\nfunc TestCancel(t *testing.T) {\n\tvar wg sync.WaitGroup\n\tcancelChan := make(chan struct{}, 0)\n\n\t&#47;&#47;å¯åŠ¨ 5 ä¸ªåç¨‹\n\tfor i := 0; i &lt; 5; i++ {\n\t\twg.Add(1)\n\t\tgo func(i int, cancelChan chan struct{}, wg *sync.WaitGroup) {\n\t\t\t&#47;&#47;åšä¸€ä¸ª while(true) çš„å¾ªç¯ï¼Œä¸€ç›´æ£€æŸ¥ä»»åŠ¡æ˜¯å¦æœ‰è¢«å–æ¶ˆ\n\t\t\tfor {\n\t\t\t\tif isCanceled(cancelChan) {\n\t\t\t\t\tfmt.Println(i, &quot;is Canceled&quot;)\n\t\t\t\t\twg.Done()\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\t&#47;&#47;å…¶å®ƒæ­£å¸¸ä¸šåŠ¡é€»è¾‘\n\t\t\t\t\ttime.Sleep(time.Millisecond * 5)\n\t\t\t\t}\n\t\t\t}\n\t\t}(i, cancelChan, &amp;wg)\n\t}\n\t&#47;&#47;æ‰§è¡Œä»»åŠ¡å–æ¶ˆ\n\texecCancel(cancelChan)\n\twg.Wait()\n}\n&#47;*\n=== RUN   TestCancel\n4 is Canceled\n0 is Canceled\n1 is Canceled\n2 is Canceled\n3 is Canceled\n--- PASS: TestCancel (0.00s)\nPASS\n*&#47;","like_count":3,"discussions":[{"author":{"id":1657039,"avatar":"https://static001.geekbang.org/account/avatar/00/19/48/cf/8c88e6c0.jpg","nickname":"Nemo","note":"","ucode":"2B11D18D6FA2AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":611933,"discussion_content":"æ›´æ¸…æ™°äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680426238,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":133112,"user_name":"æ–¹å‹‡(gopher)","can_delete":false,"product_type":"c3","uid":1290625,"ip_address":"","ucode":"D199911C4CFEF5","user_header":"https://static001.geekbang.org/account/avatar/00/13/b1/81/13f23d1e.jpg","comment_is_top":false,"comment_ctime":1568363027,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"è¿™äº›å°ä¾‹å­å¸Œæœ›è€å¸ˆèƒ½åˆ†äº«ä¸€ä¸‹ä½¿ç”¨åœºæ™¯ï¼Œä¸€èˆ¬æƒ…å†µå¾ˆå°‘æœ‰æ­»å¾ªç¯æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œç­‰å¾…å¤„ç†ä¿¡å·ï¼Œæˆ‘èƒ½æƒ³åˆ°çš„åº”ç”¨åœºæ™¯å°±æ˜¯åšå¿ƒè·³æ£€æµ‹ï¼Œä¸»è¿›ç¨‹ç®¡ç†å­è¿›ç¨‹ï¼Œå¿ƒè·³æ¢æµ‹å¼‚å¸¸ï¼Œæ‰€æœ‰å­è¿›ç¨‹åœæ­¢å·¥ä½œã€‚è¿˜æœ‰å¤šè·¯ç ´è§£éªŒè¯ç ï¼Œå…¶ä»–ä¸€è·¯æˆåŠŸåï¼Œå¯ä»¥é€šçŸ¥å…¶ä»–ä»»åŠ¡åœæ­¢å·¥ä½œã€‚å¤šè·¯çˆ¬è™«ï¼Œæœç´¢ï¼Œä¸€æ—¦æœ‰æˆåŠŸï¼Œå–æ¶ˆå…¶ä»–ä»»åŠ¡","like_count":1},{"had_liked":false,"id":100863,"user_name":"æå­™ç§‘ï¼","can_delete":false,"product_type":"c3","uid":1447691,"ip_address":"","ucode":"B8A16CD1B7A327","user_header":"https://static001.geekbang.org/account/avatar/00/16/17/0b/a29fa2c0.jpg","comment_is_top":false,"comment_ctime":1559657896,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"æ¯æ¬¡éƒ½æ˜¯4 Canceled æ˜¯ä¸æ˜¯è¯´ cancel_1æ–¹æ³• ç»“æŸçš„chan æ˜¯ä¸æ˜¯æœ€åä¸€ä¸ªå¯åŠ¨è¿˜åœ¨è·‘çš„åç¨‹","like_count":1},{"had_liked":false,"id":353926,"user_name":"right-chen","can_delete":false,"product_type":"c3","uid":1435172,"ip_address":"åŒ—äº¬","ucode":"E0E940E80E7A2D","user_header":"https://static001.geekbang.org/account/avatar/00/15/e6/24/30806a88.jpg","comment_is_top":false,"comment_ctime":1659928989,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"&#47;&#47;æ”¹sleepä¸ºwaitGroupç­‰å¾…\n\nfunc channel_is_cancel(ch chan int) bool {\n\tselect {\n\tcase &lt;-ch:\n\t\treturn true\n\tdefault:\n\t\treturn false\n\t}\n}\n\nfunc cancel_channel(ch chan int) {\n\tclose(ch)\n}\n\n&#47;**\nå–æ¶ˆä»»åŠ¡\n*&#47;\nfunc TestTaskCancel(t *testing.T) {\n\n\ttask_channel := make(chan int, 100)\n\tvar wg sync.WaitGroup\n\tfor i := 0; i &lt; 5; i++ {\n\t\twg.Add(1)\n\t\tgo func(i int, task_channel chan int) {\n\n\t\t\tfor {\n\t\t\t\tif channel_is_cancel(task_channel) {\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t\ttime.Sleep(1 * time.Second)\n\t\t\t}\n\t\t\tfmt.Println(&quot;ä»»åŠ¡&quot;, i, &quot;å–æ¶ˆäº†&quot;)\n\t\t\twg.Done()\n\t\t}(i, task_channel)\n\t}\n\n\tcancel_channel(task_channel)\n\twg.Wait()\n}","like_count":0},{"had_liked":false,"id":346089,"user_name":"æ°´æ»´","can_delete":false,"product_type":"c3","uid":2914526,"ip_address":"","ucode":"39AD019C0EC22E","user_header":"https://static001.geekbang.org/account/avatar/00/2c/78/de/34a13f85.jpg","comment_is_top":false,"comment_ctime":1652835177,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"ä»£ç çš„gitä»“åº“çœ‹ä¸äº†äº†ï¼Œæ˜¨å¤©è¿˜å¯ä»¥çœ‹çš„","like_count":0},{"had_liked":false,"id":287540,"user_name":"escray","can_delete":false,"product_type":"c3","uid":1020525,"ip_address":"","ucode":"1F4204930E47C4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","comment_is_top":false,"comment_ctime":1618021902,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"å…¶å® Channel å–æ¶ˆæ“ä½œå’Œä¸Šä¸€è®²çš„ å…³é—­ close å’Œå¹¿æ’­ æ˜¯å¯†åˆ‡ç›¸å…³çš„ã€‚Channel å…³é—­ä¹‹åï¼Œä¼šé€šçŸ¥æ‰€æœ‰å’Œå®ƒæœ‰å…³çš„ Receiverã€‚\n\næ¯”è¾ƒæœ‰æ„æ€çš„åœ°æ–¹åœ¨äºè¯¾åçš„ä¸€ä¸ªç•™è¨€ï¼Œä¸ºä»€ä¹ˆæ€»æ˜¯ channel 4 å…ˆè¢«å–æ¶ˆï¼Ÿ\n\nå¦‚æœä¸åœ¨è°ƒç”¨ cancel å‰å¢åŠ  sleep çš„è¯ï¼Œæˆ‘è¯•ç€æŠŠå¾ªç¯ä¸­ i &lt; 5 æ”¹ä¸ºå…¶ä»–çš„å€¼ï¼Œé‚£ä¹ˆé¦–å…ˆè¢«å–æ¶ˆçš„éƒ½æ˜¯æœ€åä¸€ä¸ªåç¨‹ã€‚\n\nåŠ ä¸€ç‚¹ç­‰å¾…æ—¶é—´ï¼Œæ’é™¤ç¼“å­˜å¯¹ç¨‹åºçš„å½±å“ï¼Œä¼¼ä¹è¿˜æ˜¯ä¼šæˆä¸ºä¸€ä¸ªç›¸å¯¹å›ºå®šçš„å€¼ã€‚\n\næ­¤å¤„å¿…æœ‰è¹Šè··ã€‚","like_count":0},{"had_liked":false,"id":121739,"user_name":"è™¢åœ‹æŠ€é†¬","can_delete":false,"product_type":"c3","uid":1056807,"ip_address":"","ucode":"5A192262AA037E","user_header":"https://static001.geekbang.org/account/avatar/00/10/20/27/a6932fbe.jpg","comment_is_top":false,"comment_ctime":1565196238,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"çœ‹æ¥è€å¸ˆçš„è¯¾ç¨‹å­¦ä¼šäº†ä¸€ä¸ªæŠ€å·§ï¼Œç”¨testæ¥å†™ä¸€äº›éªŒè¯ã€æµ‹è¯•ç­‰ç­‰demoæ¥è¿è¡Œï¼Œä»¥å‰ä¸­æ˜¯ç”¨ä¸€ä¸ªä¸ªmainåŒ…çš„å½¢å¼ï¼ŒIDEå„ç§æç¤ºmainå­˜åœ¨ç­‰ç­‰ã€‚è€Œä¸”è¿™æ ·æ…¢æ…¢çš„å¯¹å†™æµ‹è¯•æ›´åŠ ç†Ÿæ‚‰","like_count":0},{"had_liked":false,"id":78702,"user_name":"å¿½ç„¶ä¹‹é—´","can_delete":false,"product_type":"c3","uid":1052876,"ip_address":"","ucode":"CA6CF7883735DE","user_header":"https://static001.geekbang.org/account/avatar/00/10/10/cc/9226d3c8.jpg","comment_is_top":false,"comment_ctime":1553220436,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":3,"product_id":100024001,"comment_content":"è¿½è¯¾è¿›è¡Œæ—¶ï¼šï¼‰","like_count":0,"discussions":[{"author":{"id":1105246,"avatar":"https://static001.geekbang.org/account/avatar/00/10/dd/5e/ddbdde5a.jpg","nickname":"é‚¢å®‡è¶…","note":"","ucode":"3113F55E60ADE9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387684,"discussion_content":"è€å¸ˆèƒ½æ‰‹æ•²ä¸€æ•²ä»£ç ä¹ˆã€‚éƒ½æ˜¯å¤åˆ¶ç²˜è´´æœ‰æ„æ€ä¹ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628345369,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}