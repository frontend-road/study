{"id":87077,"title":"34 | æ•°ç»„å’Œé›†åˆï¼Œå¯å˜é‡çš„å®‰å…¨é™·é˜±","content":"<p>åœ¨å‰é¢çš„ç« èŠ‚é‡Œï¼Œæˆ‘ä»¬è®¨è®ºäº†ä¸å°‘ä¸å¯å˜é‡çš„å¥½å¤„ã€‚åœ¨ä»£ç å®‰å…¨ä¸­ï¼Œä¸å¯å˜é‡ä¹Ÿå‡å°‘äº†å¾ˆå¤šçº è‘›çš„å‘ç”Ÿï¼Œå¯å˜é‡åˆ™æ˜¯ä¸€ä¸ªéå¸¸éš¾ç¼ çš„éº»çƒ¦ã€‚</p><h2>è¯„å®¡æ¡ˆä¾‹</h2><p>æˆ‘ä»¬ä¸€èµ·çœ‹ä¸‹è¿™æ®µJavaScriptä»£ç ã€‚</p><pre><code>var mutableArray = [0, {\n    toString : function() {\n      mutableArray.length = 0;\n    }\n  }, 2];\n\nconsole.log(&quot;Array before join(): &quot;, mutableArray);\nmutableArray.join('');\nconsole.log(&quot;Array after join(): &quot;, mutableArray);\n</code></pre><p>è°ƒç”¨mutableArray.join()å‰åï¼Œä½ çŸ¥é“æ•°ç»„mutableArrayçš„å˜åŒ–å—ï¼Ÿè°ƒç”¨join()å‰ï¼Œæ•°ç»„mutableArrayåŒ…å«ä¸¤ä¸ªæ•°å­—ï¼Œä¸€ä¸ªå‡½æ•° ï¼ˆ{10, {}, 20}ï¼‰ã€‚è°ƒç”¨join()åï¼Œæ•°ç»„mutableArrayå°±å˜æˆä¸€ä¸ªç©ºæ•°ç»„äº†ã€‚è¿™å…¶ä¸­çš„ç§˜å¯†å°±åœ¨äºjoin()çš„å®ç°ï¼Œæ‰§è¡Œäº†æ•°ç»„ä¸­toString()å‡½æ•°ã€‚è€ŒtoString()å‡½æ•°çš„å®ç°ï¼ŒæŠŠæ•°ç»„\bmutableArrayè®¾ç½®ä¸ºç©ºæ•°ç»„ã€‚</p><p>ä¸‹é¢çš„ä»£ç ï¼Œå°±æ˜¯JavaScriptå¼•æ“å®ç°æ•°ç»„join()æ–¹æ³•çš„ä¸€æ®µå†…éƒ¨Cä»£ç ã€‚</p><pre><code>static JSBool\narray_toString_sub(JSContext *cx, JSObject *obj, JSBool locale,\n                   JSString *sepstr, CallArgs &amp;args) {\n    // snipped\n    size_t seplen;\n    // snipped\n    StringBuffer sb(cx);\n    if (!locale &amp;&amp; !seplen &amp;&amp; obj-&gt;isDenseArray() &amp;&amp;\n        !js_PrototypeHasIndexedProperties(cx, obj)) {\n        // Elements beyond the initialized length are\n        // 'undefined' and thus can be ignored.\n        const Value *beg = obj-&gt;getDenseArrayElements();\n        const Value *end = \n            beg + Min(length, obj-&gt;getDenseArrayInitializedLength());\n        for (const Value *vp = beg; vp != end; ++vp) {\n            if (!JS_CHECK_OPERATION_LIMIT(cx))\n                return false;\n\n            if (!vp-&gt;isMagic(JS_ARRAY_HOLE) &amp;&amp;\n                !vp-&gt;isNullOrUndefined()) {\n                if (!ValueToStringBuffer(cx, *vp, sb))\n                    return false;\n            }\n        }\n    }\n    // snipped\n}\n</code></pre><p>è¿™æ®µä»£ç ï¼ŒæŠŠæ•°ç»„çš„èµ·å§‹åœ°å€è®°å½•åœ¨begå˜é‡é‡Œï¼ŒæŠŠæ•°ç»„çš„ç»“æŸåœ°å€è®°å½•åœ¨endå˜é‡é‡Œã€‚ç„¶åï¼Œä»begå˜é‡å¼€å§‹ï¼Œé€šè¿‡è°ƒç”¨ValueToStringBuffer()å‡½æ•°ï¼ŒæŠŠæ•°ç»„é‡Œçš„æ¯ä¸€ä¸ªå˜é‡ï¼Œè½¬æ¢æˆå­—ç¬¦ä¸²ã€‚</p><p>æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ç¬¬ä¸€æ®µä»£ç ï¼Œæ˜¯æ€ä¹ˆåœ¨è¿™æ®µjoin()å®ç°çš„forå¾ªç¯ä»£ç é‡Œæ‰§è¡Œçš„ã€‚</p><ol>\n<li>\n<p>vpæŒ‡é’ˆåˆå§‹åŒ–åï¼ŒæŒ‡å‘æ•°ç»„çš„èµ·å§‹åœ°å€ï¼›</p>\n</li>\n<li>\n<p>å¦‚æœvpçš„åœ°å€ä¸ç­‰äºæ•°ç»„çš„ç»“æŸåœ°å€endï¼Œå°±æŠŠæ•°ç»„å˜é‡è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œç„¶åå˜æ¢vpæŒ‡é’ˆåˆ°ä¸‹ä¸€ä¸ªåœ°å€ ã€‚æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹è¿™æ®µä»£ç æ˜¯å¦‚ä½•æ“ä½œæ•°ç»„mutableArrayçš„ï¼š</p>\n<p>a.  æ•°ç»„çš„ç¬¬ä¸€ä¸ªå˜é‡æ˜¯0ã€‚0è¢«è½¬æ¢æˆå­—ç¬¦ï¼ŒvpæŒ‡é’ˆæ¢åˆ°ä¸‹ä¸€ä¸ªåœ°å€ï¼›<br>\nb. æ•°ç»„çš„ç¬¬äºŒä¸ªå˜é‡æ˜¯toString()å‡½æ•°ã€‚toString()å‡½æ•°è¢«è°ƒç”¨åï¼Œå°±ä¼šæŠŠmutableArrayè¿™ä¸ªæ•°ç»„è®¾ç½®ä¸ºç©ºæ•°ç»„ï¼ŒvpæŒ‡é’ˆæ¢åˆ°ä¸‹ä¸€ä¸ªåœ°å€ï¼›</p>\n<p>c.  æ•°ç»„çš„ç¬¬ä¸‰ä¸ªå˜é‡æœ¬æ¥åº”è¯¥æ˜¯2ã€‚ä½†æ˜¯ï¼Œç”±äºæ•°ç»„åœ¨ä¸Šä¸€æ­¥è¢«ç½®ä¸ºç©ºæ•°ç»„ï¼Œæ•°ç»„çš„ç¬¬ä¸‰ä¸ªå˜é‡çš„æŒ‡é’ˆæŒ‡å‘æ•°ç»„å¤–åœ°å€ã€‚</p>\n</li>\n<li>\n<p>ç”±äºæ•°ç»„å·²ç»è¢«è®¾ç½®ä¸ºç©ºæ•°ç»„ï¼ŒåŸæ•°ç»„çš„åœ°å€å¯èƒ½å·²ç»è¢«å…¶ä»–æ•°æ®å ç”¨ï¼Œè®¿é—®ç©ºæ•°ç»„å¤–çš„åœ°å€å°±ä¼šé€ æˆå†…å­˜æ³„æ¼æˆ–è€…ç¨‹åºå´©æºƒã€‚</p>\n</li>\n</ol><!-- [[[read_end]]] --><p>é€šè¿‡è®¾ç½®ç¬¬ä¸€æ®µä»£ç é‡Œçš„mutableArrayå’Œåˆ©ç”¨è¿™ä¸ªå†…å­˜æ³„æ¼çš„æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥è¿œç¨‹æ‰§è¡Œä»»æ„ä»£ç ï¼Œè·å–æ•æ„Ÿä¿¡æ¯æˆ–è€…é€ æˆæœåŠ¡å´©æºƒã€‚è¿™æ˜¯ä¸€ä¸ª<a href=\"https://www.first.org/cvss/calculator/3.0#CVSS:3.0/AV:N/AC:L/PR:N/UI:N/S:C/C:L/I:L/A:H\">é€šç”¨ç¼ºé™·è¯„åˆ†ç³»ç»Ÿè¯„åˆ†ä¸º9.9</a>çš„ä¸¥é‡å®‰å…¨ç¼ºé™·ã€‚</p><h2>æ¡ˆä¾‹åˆ†æ</h2><p>æˆ‘ä»¬ä¸Šé¢è®¨è®ºçš„ç¬¬ä¸€æ®µä»£ç é‡Œçš„mutableArrayçš„æ„é€ æ–¹å¼ï¼Œæ˜¯ä¸€ä¸ªå…¸å‹çš„ç”¨äºæ£€æŸ¥JavaScriptå¼•æ“å®ç°æˆ–è€…å…¶ä»–JavaScriptæ•°ç»„ä½¿ç”¨ç¼ºé™·çš„æŠ€æœ¯èŒƒä¾‹ã€‚</p><p>è¿‘åå¤šå¹´æ¥ï¼Œé™†ç»­å‘ç°äº†ä¸€äº›ç›¸ä¼¼çš„JavaScriptå¼•æ“æ•°ç»„å®ç°çš„ä¸¥é‡å®‰å…¨æ¼æ´ã€‚å‡ ä¹æ‰€æœ‰ä¸»æµçš„JavaScriptå¼•æ“æä¾›å•†éƒ½å—åˆ°äº†å½±å“ã€‚æˆ‘ä»¬å¤ªä¹ æƒ¯ä½¿ç”¨æ•°ç»„çš„ç¼–ç æ¨¡å¼äº†ï¼Œæ•°ç»„é•¿åº¦çš„å˜åŒ–ï¼Œå¾ˆéš¾è¿›å…¥æˆ‘ä»¬çš„è€ƒé‡èŒƒå›´ã€‚å› æ­¤ï¼ŒæŸ¥çœ‹æˆ–è€…ç¼–å†™è¿™äº›å®ç°ä»£ç ï¼Œæˆ‘ä»¬å¾ˆéš¾å‘ç°é‡Œé¢çš„æ¼æ´ï¼Œé™¤éæˆ‘ä»¬çŸ¥é“äº†è¿™æ ·çš„æ”»å‡»æ¨¡å¼ã€‚</p><p>å¦‚æœä¸€ä¸ªæ–°è¯­è¨€ï¼Œæ”¯æŒç±»ä¼¼JavaScriptè¯­è¨€é‡Œè¿™ä¹ˆçµæ´»çš„å‡½æ•°æ•°ç»„å˜é‡ï¼Œä½ å¯ä»¥è¯•ç€æ‰¾æ‰¾è¿™é—¨ç¼–ç¨‹è¯­è¨€å®ç°é‡Œæœ‰æ²¡æœ‰ç±»ä¼¼çš„å®‰å…¨æ¼æ´ã€‚</p><p>å¦‚æœæˆ‘ä»¬ä»æ ¹æœ¬ä¸Šæ¥çœ‹å¯å˜é‡ï¼Œå®ƒçš„å®‰å…¨å¨èƒå°±åœ¨äº<strong>åœ¨ä¸åŒçš„æ—¶é—´ã€åœ°ç‚¹é‡Œï¼Œå¯å˜é‡å¯ä»¥å‘ç”Ÿå˜åŒ–ã€‚å¦‚æœç¼–å†™ä»£ç æ—¶ï¼Œæ„è¯†ä¸åˆ°ä¸åŒæ—¶ç©ºé‡Œçš„å˜åŒ–ï¼Œå°±ä¼šé¢ä¸´å®‰å…¨å¨èƒ</strong>ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹å¯å˜é‡çš„ä¾‹å­ã€‚åœ¨Javaè¯­è¨€é‡Œï¼Œjava.util.Dateæ˜¯ä¸€ä¸ªä»JDK 1.0å¼€å§‹å°±æ”¯æŒçš„ç±»ã€‚æˆ‘ä»¬å¯ä»¥æ„å»ºä¸€ä¸ªå¯¹è±¡ï¼Œæ¥è¡¨ç¤ºæ„å»ºæ—¶çš„æ—¶é—´ï¼Œç„¶åå†ä¿®æ”¹æˆå…¶ä»–æ—¶é—´ã€‚å°±åƒä¸‹é¢çš„è¿™æ®µä¼ªä»£ç è¿™æ ·ã€‚</p><pre><code>public void verify(Date targetDate) {\n    // Verify that a contract is valid in the day of targetDate.\n    \n    // &lt;snipped&gt;\n    \n    // Display that the contract is valid in the day of targetDate  \n}\n\nvoid checkContract() {\n    Date today = new Date();\n    \n    // create a new thread that modify the date to a new date.\n    // For example, today.setYear(100) will reset the year to 2000.\n\n    // verify that the contract is valid today.\n    veify(today);\n}\n</code></pre><p>ä¸Šé¢çš„ä»£ç ä¸­ï¼Œverify()æ–¹æ³•å’Œä¿®æ”¹æ—¥æœŸçš„çº¿ç¨‹é—´å°±å­˜åœ¨ç«äº‰å…³ç³»ã€‚å¦‚æœæ—¥æœŸä¿®æ”¹åœ¨verify()å®ç°çš„éªŒè¯å’Œæ˜¾ç¤ºä¹‹é—´å‘ç”Ÿï¼Œæ˜¾ç¤ºçš„æ—¥æœŸå°±ä¸æ˜¯éªŒè¯æœ‰æ•ˆçš„æ—¥æœŸã€‚è¿™å°±ä¼šç»™äººé”™è¯¯çš„ä¿¡æ¯ï¼Œä»è€Œå¯¼è‡´é”™è¯¯çš„å†³ç­–ã€‚è¿™ä¸ªé—®é¢˜å°±æ˜¯TOCTOUï¼ˆtime-of-check time-of-useï¼‰ç«æ€å±å®³çš„ä¸€ç§å¸¸è§å½¢å¼ã€‚</p><h2>å¯å˜é‡å±€éƒ¨åŒ–</h2><p>ç±»ä¼¼äºTOCTOUçš„å®‰å…¨é—®é¢˜ï¼Œè®©java.util.Dateçš„ä½¿ç”¨å……æ»¡äº†éº»çƒ¦ã€‚</p><p><strong>é‚£ä¹ˆè¯¥æ€ä¹ˆé˜²èŒƒè¿™ç§æ¼æ´å‘¢ï¼Ÿå½“ç„¶ï¼Œæœ€æœ‰æ•ˆçš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨ä¸å¯å˜é‡ã€‚å¯¹äºå¯å˜é‡çš„å‚æ•°ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ‹·è´ç­‰åŠæ³•æŠŠå…±äº«çš„å˜é‡å±€éƒ¨åŒ–ã€‚ç”±äºå¯å˜é‡å¯ä»¥åœ¨ä¸åŒæ—¶ç©ºå‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥ï¼Œæ— è®ºæ˜¯ä¼ å…¥å‚æ•°ï¼Œè¿˜æ˜¯è¿”å›å€¼ï¼Œéƒ½è¦æ‹·è´å¯å˜é‡</strong>ã€‚è¿™æ ·å…±äº«çš„å˜é‡ï¼Œå°±è½¬æ¢æˆäº†å±€éƒ¨å˜é‡ã€‚</p><p>æ¯”å¦‚ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ”¹æˆï¼š</p><pre><code>public void verify(Date targetDate) {\n    // Create a copy of the targetDate so as to avoid the\n    // impact of any changes.\n    Date inputDate = new Date(targetDate.getTime());\n\n    // Verify that a contract is valid in the day of inputDate.\n\n    // &lt;snipped&gt;\n\n    // Display that the contract is valid in the day of inputDate  \n}\n\nvoid checkContract() {\n    Date today = new Date();\n\n    // create a new thread that modify the date to a new date.\n    // For example, today.setYear(100) will reset the year to 2000.\n\n    // verify that the contract is valid today.\n    // Use a clone of the today date so as to avoid the impact of\n    // any changes in the verify() implementaiton. \n    veify((Data)today.clone());\n}\n</code></pre><p>ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰æ³¨æ„åˆ°ï¼Œåœ¨veirfy()çš„å®ç°é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº†Dateçš„æ„é€ å‡½æ•°æ¥åšæ‹·è´ï¼›è€Œåœ¨checkContract()çš„å®ç°é‡Œï¼Œæˆ‘ä»¬ä½¿ç”¨äº†Dateçš„clone()æ–¹æ³•æ¥åšæ‹·è´ã€‚ä¸ºä»€ä¹ˆä¸éƒ½ä½¿ç”¨æ›´ç®€æ´çš„clone()æ–¹æ³•å‘¢ï¼Ÿ</p><p>åœ¨checkContract()çš„å®ç°é‡Œï¼Œtodayå˜é‡æ˜¯Dateç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚æˆ‘ä»¬éƒ½äº†è§£ï¼ŒDateç±»çš„clone()æ–¹æ³•çš„å®ç°ï¼Œçš„ç¡®åšåˆ°äº†æ—¥æœŸçš„æ‹·è´ã€‚è€Œå¯¹äºä½œä¸ºå‚æ•°ä¼ å…¥verify()æ–¹æ³•çš„targetDateå¯¹è±¡ï¼Œæˆ‘ä»¬å¹¶ä¸æ¸…æ¥šå®ƒæ˜¯ä¸æ˜¯ä¸€ä¸ªå¯é çš„Dateçš„ç»§æ‰¿ç±»ã€‚è¿™ä¸ªç»§æ‰¿ç±»çš„clone()å®ç°ï¼Œæœ‰æ²¡æœ‰åšæ—¥æœŸçš„æ‹·è´ï¼Œæˆ‘ä»¬ä¹Ÿä¸çŸ¥æ™“ï¼Œå› æ­¤ï¼ŒtargetDateå¯¹è±¡çš„clone()æ–¹æ³•ï¼Œä¸ä¸€å®šå®‰å…¨å¯é ã€‚æ‰€ä»¥ï¼Œåœ¨verify()å®ç°é‡Œï¼Œä½¿ç”¨clone()æ‹·è´ä¼ å…¥çš„å‚æ•°ï¼Œä¹Ÿä¸å¯é ã€‚</p><p>ç±»çš„ç»§æ‰¿è¿˜æœ‰å¾ˆå¤šéº»çƒ¦çš„åœ°æ–¹ï¼Œåé¢çš„ç« èŠ‚ï¼Œæˆ‘ä»¬è¿˜ä¼šæ¥ç€è®¨è®ºç»§æ‰¿çš„å®‰å…¨ç¼ºé™·ã€‚</p><h2>æ”¯æŒå®ä¾‹æ‹·è´</h2><p>åœ¨ä¸€å®šçš„åœºæ™¯ä¸‹ï¼Œå®‰å…¨çš„ç¼–ç éœ€è¦é€šè¿‡æ‹·è´æŠŠå¯å˜å˜é‡å±€éƒ¨åŒ–ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œ<strong>æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªå¯å˜ç±»çš„æ—¶å€™ï¼Œéœ€è¦è€ƒè™‘æ”¯æŒå®ä¾‹çš„æ‹·è´ã€‚è¦ä¸ç„¶ï¼Œè¿™ä¸ªç±»çš„ä½¿ç”¨ï¼Œå¯èƒ½å°±ä¼šé‡åˆ°æ— æ³•å®‰å…¨æ‹·è´çš„éº»çƒ¦ã€‚</strong></p><p>å®ä¾‹çš„æ‹·è´ï¼Œå¯ä»¥ä½¿ç”¨é™æ€çš„å®ä¾‹åŒ–æ–¹æ³•ï¼Œæˆ–è€…æ‹·è´æ„é€ å‡½æ•°ï¼Œæˆ–è€…ä½¿ç”¨å…¬å¼€çš„æ‹·è´æ–¹æ³•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå…¬å¼€çš„æ‹·è´æ–¹æ³•å¯ä»¥è¢«ç»§æ‰¿ï¼Œç»§æ‰¿ç±»çš„å®ç°æ–¹å¼å°±ä¸å¯é¢„æ–™äº†ã€‚é‚£ä¹ˆï¼Œè¿™ä¸ªå…¬å¼€çš„æ‹·è´æ–¹æ³•çš„ä½¿ç”¨å°±æ˜¯ä¸å¯é çš„ã€‚æ”¯æŒå…¬å¼€çš„æ‹·è´æ–¹æ³•ï¼Œä¸€èˆ¬åªé€‚ç”¨äºfinalå…¬å¼€ç±»ã€‚</p><p>é™æ€çš„å®ä¾‹åŒ–ï¼š</p><pre><code>public static MutableClass getInstance(MutableClass mutableObject) {\n    // snipped\n}\n</code></pre><p>æ‹·è´æ„é€ å‡½æ•°ï¼š</p><pre><code>public MutableClass(MutableClass mutableObject) {\n    // snipped\n}\n</code></pre><p>å…¬å¼€æ‹·è´æ–¹æ³•ï¼š</p><pre><code>public final class MutableClass {\n    // snipped\n    @Override\n    public Object clone() {\n        // snipped\n    }\n}\n</code></pre><p>ç¦ç”¨æ‹·è´æ–¹æ³•ï¼š</p><pre><code>public class MutableClass {\n    // snipped\n    @Override\n    public final Object clone() throws CloneNotSupportedException {\n        throw new CloneNotSupportedException();\n    }\n}\n</code></pre><h2>æµ…æ‹·è´ä¸æ·±æ‹·è´</h2><p>å®ç°æ‹·è´ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹æ³•ã€‚</p><p>ä¸€ç§æ˜¯æ‹·è´å˜é‡çš„æŒ‡é’ˆæˆ–è€…å¼•ç”¨ï¼Œå¹¶ä¸æ‹·è´å˜é‡æŒ‡å‘çš„å†…å®¹ã€‚æ‹·è´å’ŒåŸå®ä¾‹å…±äº«æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹ï¼Œå¦‚æœæ‹·è´å®ä¾‹é‡Œçš„å˜é‡æŒ‡å‘çš„å†…å®¹å‘ç”Ÿäº†æ”¹å˜ï¼ŒåŸå®ä¾‹é‡Œçš„å˜é‡æŒ‡å‘çš„å†…å®¹ä¹Ÿéšç€æ”¹å˜ã€‚è¿™ç§æ‹·è´æ–¹æ³•é€šå¸¸ç§°ä¸ºæµ…æ‹·è´ï¼ˆshallow copyï¼‰ã€‚</p><p>å¦å¤–ä¸€ç§æ–¹å¼ï¼Œæ˜¯æ‹·è´å˜é‡æŒ‡å‘çš„å†…å®¹ã€‚æ‹·è´åçš„å®ä¾‹å’ŒåŸæœ‰çš„å®ä¾‹ä¸­ï¼Œå˜é‡æŒ‡å‘çš„å†…å®¹è™½ç„¶ç›¸åŒï¼Œä½†æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚ä¸€ä¸ªå®ä¾‹é‡Œï¼Œå˜é‡æŒ‡å‘çš„å†…å®¹å‘ç”Ÿäº†æ”¹å˜ï¼Œå¯¹å¦å¤–ä¸€ä¸ªå®ä¾‹æ²¡æœ‰å½±å“ã€‚è¿™ç§æ‹·è´æ–¹æ³•é€šå¸¸ç§°ä¸ºæ·±æ‹·è´ï¼ˆdeep copyï¼‰ã€‚</p><p><strong>å¯¹äºä¸€ä¸ªç±»é‡Œçš„ä¸å¯å˜é‡ï¼Œä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨æµ…æ‹·è´å°±å¯ä»¥äº†</strong>ã€‚è¿™ä¹Ÿæ˜¯ä¸å¯å˜é‡çš„åˆä¸€ä¸ªä¼˜ç‚¹ã€‚</p><p>ä¸‹é¢çš„è¿™æ®µä»£ç ï¼Œå°±æ··åˆä½¿ç”¨äº†å¯å˜é‡ã€ä¸å¯å˜é‡ï¼Œä»¥åŠæµ…æ‹·è´å’Œæ·±æ‹·è´æŠ€æœ¯ï¼Œæ¥å®ç°å®ä¾‹æ‹·è´çš„ä¸€ä¸ªç¤ºä¾‹ã€‚</p><h2>æ‹·è´</h2><pre><code>final class MyContract implements Cloneable {\n  private   String title;\n  private   Date signedDate;\n  private   Byte[] content;\n\n    // snipped\n\n    @Override\n    public Object clone() throws CloneNotSupportedException {\n        MyContract cloned = (MyContract)super.clone();\n\n        // shallow copy, String is immutable\n        cloned.title = this.title;\n\n        // deep copy, Date is mutable\n        cloned.signedDate = new Date(this.signedDate.getTime());\n        \n        // deep copy, array are mutable\n        cloned.content = this.content.clone();\n        \n        return cloned;\n    }\n}\n</code></pre><p><strong>æµ…æ‹·è´å’ŒåŸå®ä¾‹å…±äº«æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹ï¼Œæ‹·è´å®ä¾‹å’ŒåŸå®ä¾‹éƒ½å¯ä»¥æ”¹å˜æŒ‡å‘çš„å†…å®¹ï¼ˆé™¤éå†…å®¹ä¸ºä¸å¯å˜é‡ï¼‰ï¼Œè¿™æ ·å°±å½±å“äº†å¯¹æ–¹çš„è¡Œä¸ºã€‚æ‰€ä»¥ï¼Œå¯å˜é‡çš„æµ…æ‹·è´å¹¶ä¸èƒ½è§£é™¤å®‰å…¨éšæ‚£ã€‚</strong></p><p>ç”±äºæœ‰ä¸¤ç§æ‹·è´æ–¹æ³•ï¼Œè€Œä¸”ä¸åŒçš„æ‹·è´æ–¹æ³•é€‚ç”¨çš„èŒƒå›´æœ‰ä¸€å®šçš„åŒºåˆ«ï¼Œæˆ‘ä»¬å°±éœ€è¦å¼„æ¸…æ¥šä¸€ä¸ªç±»æ”¯æŒçš„æ˜¯å“ªä¸€ç§æ‹·è´æ–¹æ³•ã€‚ç‰¹åˆ«æ˜¯å¦‚æœä¸€ä¸ªç±»ä½¿ç”¨çš„æ˜¯æµ…æ‹·è´ï¼Œä¸€å®šè¦åœ¨è§„èŒƒé‡Œæ ‡è®°æ¸…æ¥šã€‚è¦ä¸ç„¶ï¼Œå°±å®¹æ˜“ç”¨é”™è¿™ä¸ªç±»çš„æ‹·è´æ–¹æ³•ï¼Œä»è€Œå¯¼è‡´å®‰å…¨é£é™©ã€‚</p><p>å¦‚æœä¸€ä¸ªç±»åªæä¾›äº†æµ…æ‹·è´æ–¹æ³•çš„å®ç°ï¼Œåœ¨ä½¿ç”¨å¯å˜é‡å±€éƒ¨åŒ–è§£å†³å®‰å…¨éšæ‚£æ—¶ï¼Œæˆ‘ä»¬å°±ä¼šé‡åˆ°å¾ˆå¤šéº»çƒ¦ã€‚</p><h2>éº»çƒ¦çš„é›†åˆ</h2><p>å‡ºäºæ•ˆç‡çš„è€ƒè™‘ï¼Œjava.utilä¸‹çš„é›†åˆç±»ï¼Œä¸€èˆ¬æ”¯æŒçš„æ˜¯æµ…æ‹·è´ã€‚æ¯”å¦‚ArrayListçš„clone()æ–¹æ³•ï¼Œæ‰§è¡Œçš„å°±æ˜¯æµ…æ‹·è´ã€‚å¦‚æœä½¿ç”¨æ·±åº¦æ‹·è´ï¼Œåœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œé›†åˆçš„ä½ä¸‹æ•ˆç‡æˆ‘ä»¬éš¾ä»¥æ‰¿å—ã€‚å¯¹äºç±»ä¼¼äºé›†åˆè¿™æ ·çš„ç±»ï¼Œå¯å˜é‡å±€éƒ¨åŒ–å°±ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>å¯¹äºé›†åˆæ¥è¯´ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆè§£å†³å¯å˜é‡çš„ç«æ€å±å®³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæœ€ä¸»è¦çš„åŠæ³•ï¼Œå°±æ˜¯ä¸è¦æŠŠé›†åˆä½¿ç”¨åœ¨å¯èƒ½äº§ç”Ÿç«æ€å±å®³çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬åé¢å†æ¥ç€è®¨è®ºè¿™ä¸ªé—®é¢˜ã€‚</p><h2>å°ç»“</h2><p>é€šè¿‡å¯¹è¿™ä¸ªæ¡ˆä¾‹çš„è®¨è®ºï¼Œæˆ‘æƒ³å’Œä½ åˆ†äº«ä¸‹é¢ä¸‰ç‚¹ä¸ªäººçœ‹æ³•ã€‚</p><ol>\n<li>\n<p><strong>å¯å˜é‡çš„ä¼ é€’ï¼Œå­˜åœ¨ç«æ€å±å®³çš„å®‰å…¨é£é™©</strong>ï¼›</p>\n</li>\n<li>\n<p><strong>å¯å˜é‡å±€éƒ¨åŒ–ï¼Œæ˜¯è§£å†³å¯å˜é‡ç«æ€å±å®³çš„ä¸€ç§å¸¸ç”¨åŠæ³•</strong>ï¼›</p>\n</li>\n<li>\n<p><strong>å˜é‡çš„æ‹·è´ï¼Œæœ‰æµ…æ‹·è´å’Œæ·±æ‹·è´ä¸¤ç§å½¢å¼ï¼›å¯å˜é‡çš„æµ…æ‹·è´æ— æ³•è§£å†³ç«æ€å±å®³çš„å¨èƒ</strong>ã€‚</p>\n</li>\n</ol><p>å¯¹äºè¿™ä¸ªæ¡ˆä¾‹ï¼Œä½ è¿˜æœ‰ä»€ä¹ˆåˆ«çš„çœ‹æ³•å—ï¼Ÿ</p><h2>ä¸€èµ·æ¥åŠ¨æ‰‹</h2><p>æ•°ç»„æ˜¯ä¸€ä¸ªå¸¸è§çš„éš¾ä»¥å¤„ç†çš„å¯å˜é‡ã€‚å’Œé›†åˆä¸€æ ·ï¼Œæ•°ç»„çš„æ‹·è´ä¹Ÿæ˜¯æœ‰æŸæ•ˆç‡çš„ã€‚ä»€ä¹ˆæ—¶å€™ï¼Œæ•°ç»„çš„ä¼ é€’éœ€è¦æ‹·è´ï¼Ÿä»€ä¹ˆæ—¶å€™ä¸éœ€è¦æ‹·è´ï¼Ÿ</p><p>ä¸ç®¡æ˜¯Cè¯­è¨€ï¼ŒJavaè¿˜æ˜¯JavaScriptï¼Œæ•°ç»„æ˜¯ä¸€ä¸ªæˆ‘ä»¬ç¼–ç ç»å¸¸ä½¿ç”¨çš„æ•°æ®ç±»å‹ã€‚ä½ ä¸å¦¨æ£€æŸ¥ä¸€ä¸‹ä½ çš„ä»£ç ï¼Œçœ‹çœ‹å…¶ä¸­çš„æ•°ç»„ä½¿ç”¨æ˜¯å¦å­˜åœ¨æˆ‘ä»¬ä¸Šé¢è®¨è®ºçš„å®‰å…¨é—®é¢˜ã€‚</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„å‘ç°ã€‚</p><p>å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« æœ‰æ‰€å¸®åŠ©ï¼Œæ¬¢è¿ç‚¹å‡»â€œè¯·æœ‹å‹è¯»â€ï¼ŒæŠŠå®ƒåˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–è€…åŒäº‹ã€‚</p><p></p>","neighbors":{"left":{"article_title":"33 | æ•´æ•°çš„è¿ç®—æœ‰å“ªäº›å®‰å…¨å¨èƒï¼Ÿ","id":86590},"right":{"article_title":"35 | æ€ä¹ˆå¤„ç†æ•æ„Ÿä¿¡æ¯ï¼Ÿ","id":87256}},"comments":[{"had_liked":false,"id":99600,"user_name":"å½©è‰²çš„æ²™æ¼ ","can_delete":false,"product_type":"c1","uid":1116183,"ip_address":"","ucode":"19A0975A5E69EA","user_header":"https://static001.geekbang.org/account/avatar/00/11/08/17/e63e50f3.jpg","comment_is_top":false,"comment_ctime":1559265142,"is_pvip":true,"replies":[{"id":"35788","content":"ğŸ‘ï¼Œè¿™æ˜¯æˆ‘çš„å¤±è¯¯ã€‚åŸæ¥çš„ä¾‹å­æˆ‘ç”¨çš„æ˜¯(10, {}, 20)ï¼Œåæ¥è§‰å¾—{0, {}, 2}æ›´ç›´è§‚äº›ï¼Œå°±æ¢æˆäº†{0, {}, 2}ã€‚ æè¿°éƒ¨åˆ†æ¼æ‰äº†ï¼Œæ²¡æ”¹è¿‡æ¥ã€‚ å¤šè°¢å¤šè°¢ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"èŒƒå­¦é›·","uid":"1111315","ctime":1559266072,"ip_address":"","comment_id":99600,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18739134326","product_id":100019601,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œè°ƒç”¨ join() å‰ï¼Œæ•°ç»„ mutableArray åŒ…å«ä¸¤ä¸ªæ•°å­—ï¼Œä¸€ä¸ªå‡½æ•° ï¼ˆ{10, {}, 20}ï¼‰ã€‚å¯¹è¿™ä¸ª(10ï¼Œ{}ï¼Œ20)ä¸ç†è§£ï¼Œå˜åŒ–å‰æ•°ç»„mutableArrayåº”è¯¥æ˜¯åŒ…å«ä¸¤ä¸ªæ•°å­—ï¼Œä¸€ä¸ªå¯¹è±¡(0ï¼Œ{}ï¼Œ2)ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1111315,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f5/13/78741b7b.jpg","nickname":"èŒƒå­¦é›·","note":"","ucode":"D7CBE4A33427BD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452185,"discussion_content":"ğŸ‘ï¼Œè¿™æ˜¯æˆ‘çš„å¤±è¯¯ã€‚åŸæ¥çš„ä¾‹å­æˆ‘ç”¨çš„æ˜¯(10, {}, 20)ï¼Œåæ¥è§‰å¾—{0, {}, 2}æ›´ç›´è§‚äº›ï¼Œå°±æ¢æˆäº†{0, {}, 2}ã€‚ æè¿°éƒ¨åˆ†æ¼æ‰äº†ï¼Œæ²¡æ”¹è¿‡æ¥ã€‚ å¤šè°¢å¤šè°¢ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559266072,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78852,"user_name":"å¤©ä½‘","can_delete":false,"product_type":"c1","uid":1367369,"ip_address":"","ucode":"AFE2DBC0F31402","user_header":"https://static001.geekbang.org/account/avatar/00/14/dd/49/da7125ef.jpg","comment_is_top":false,"comment_ctime":1553257612,"is_pvip":false,"replies":[{"id":"28698","content":"è¿™æ ·ç†è§£æ²¡é—®é¢˜ï¼Œä¸è¿‡æœ‰æ—¶å€™çº¿ç¨‹åŒæ­¥ä¹Ÿå¯ä»¥èµ·åˆ°é˜»æ–­å˜åŒ–çš„ä½¿ç”¨ã€‚<br><br>åé¢æˆ‘ä»¬è¿˜ä¼šè®²ä»£ç çš„è¾¹ç•Œï¼Œä»€ä¹ˆæ—¶å€™æ‹·è´ï¼Œä»€ä¹ˆæ—¶å€™ä¸æ‹·è´ï¼Œæˆ‘ä»¬ç¨åè®¨è®ºã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"èŒƒå­¦é›·","uid":"1111315","ctime":1553291207,"ip_address":"","comment_id":78852,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14438159500","product_id":100019601,"comment_content":"toctouä¸èƒ½ç”¨çº¿ç¨‹åŒæ­¥è§£å†³ï¼Œçº¿ç¨‹åŒæ­¥è§£å†³çš„æ˜¯æœ‰åºæ‰§è¡Œçš„é—®é¢˜ï¼Œè§£å†³å¯å˜é‡çš„æ ¹æœ¬é—®é¢˜æ˜¯å˜é‡å±€éƒ¨åŒ–ï¼Œéš”ç¦»å¯å˜å› ç´ ï¼Œè€å¸ˆæˆ‘ç†è§£çš„å¯¹å¦ã€‚<br>å®é™…åœºæ™¯ä¸­ï¼Œå¯å˜ç±»åº”è¯¥å¾ˆå¤šï¼ŒåŠ¨ä¸åŠ¨å°±æ‹·è´ï¼Œå¥½åƒä¸ç°å®ï¼Œæ˜¯ä¸æ˜¯åªè¦ä¼ é€’çš„å¯å˜é‡éƒ½è¦å±€éƒ¨åŒ–å•Šï¼Ÿå•çº¿ç¨‹ç¯å¢ƒä¸‹åº”è¯¥ä¸ç”¨è€ƒè™‘å§ã€‚","like_count":3,"discussions":[{"author":{"id":1111315,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f5/13/78741b7b.jpg","nickname":"èŒƒå­¦é›·","note":"","ucode":"D7CBE4A33427BD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444257,"discussion_content":"è¿™æ ·ç†è§£æ²¡é—®é¢˜ï¼Œä¸è¿‡æœ‰æ—¶å€™çº¿ç¨‹åŒæ­¥ä¹Ÿå¯ä»¥èµ·åˆ°é˜»æ–­å˜åŒ–çš„ä½¿ç”¨ã€‚\n\nåé¢æˆ‘ä»¬è¿˜ä¼šè®²ä»£ç çš„è¾¹ç•Œï¼Œä»€ä¹ˆæ—¶å€™æ‹·è´ï¼Œä»€ä¹ˆæ—¶å€™ä¸æ‹·è´ï¼Œæˆ‘ä»¬ç¨åè®¨è®ºã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553291207,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353093,"user_name":"if...else...","can_delete":false,"product_type":"c1","uid":2550743,"ip_address":"åŒ—äº¬","ucode":"D0565908C99695","user_header":"https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg","comment_is_top":false,"comment_ctime":1659155802,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1659155802","product_id":100019601,"comment_content":"å¯¹äºé›†åˆæ¥è¯´ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆè§£å†³å¯å˜é‡çš„ç«æ€å±å®³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿæœ€ä¸»è¦çš„åŠæ³•ï¼Œå°±æ˜¯ä¸è¦æŠŠé›†åˆä½¿ç”¨åœ¨å¯èƒ½äº§ç”Ÿç«æ€å±å®³çš„åœºæ™¯ä¸­ã€‚--è®°ä¸‹æ¥","like_count":0},{"had_liked":false,"id":344213,"user_name":"åˆšæ¯…åšå“","can_delete":false,"product_type":"c1","uid":2976412,"ip_address":"","ucode":"6D16E587400F6F","user_header":"https://static001.geekbang.org/account/avatar/00/2d/6a/9c/de8f9280.jpg","comment_is_top":false,"comment_ctime":1651373561,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1651373561","product_id":100019601,"comment_content":"å°ç™½æƒ³é—®ä¸€ä¸‹æµ…æ‹·è´å’Œæ·±æ‹·è´æ˜¯åº”ç”¨äºå“ªäº›åœºæ™¯å‘¢","like_count":0},{"had_liked":false,"id":328589,"user_name":"aoe","can_delete":false,"product_type":"c1","uid":1121758,"ip_address":"","ucode":"1C6201EDB4E954","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","comment_is_top":false,"comment_ctime":1640781319,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1640781319","product_id":100019601,"comment_content":"å­¦åˆ°äº†æ–°çŸ¥è¯†ï¼š TOCTOUï¼ˆtime-of-check time-of-useï¼‰ç«æ€å±å®³","like_count":0}]}