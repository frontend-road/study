{"id":621934,"title":"80｜怎样将已有算法改造成符合项目的特定算法？","content":"<p><strong>课后习题</strong><br>\n编写一个能够计算 100 以内阶乘的函数，已知 60% 的人经常计算 10 和 100 的阶乘，请在此前提下优化阶乘函数。</p><p><strong>课程代码、课件及其他相关资料地址</strong><br>\n<a href=\"https://gitee.com/wilsonyin/zero-basics-python\">https://gitee.com/wilsonyin/zero-basics-python</a></p>","comments":[{"had_liked":false,"id":366429,"user_name":"Matthew","can_delete":false,"product_type":"c3","uid":2843865,"ip_address":"江苏","ucode":"96093089773740","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKSVuNarJuDhBSvHY0giaq6yriceEBKiaKuc04wCYWOuso50noqDexaPJJibJN7PHwvcQppnzsDia1icZkw/132","comment_is_top":false,"comment_ctime":1673774023,"is_pvip":false,"replies":[{"id":133625,"content":"jupyter里的设置菜单，里面有一项叫做“记录执行用时” 把它勾选上之后，重启jupyter即可，（备注：有一些版本需要再安装python的包，可以执行 pip install jupyterlab_execute_time ，目前3.10版本不需要这样做）","user_name":"作者回复","user_name_real":"编辑","uid":1056235,"ctime":1674200929,"ip_address":"广东","comment_id":366429,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"老师，怎么在 Jupyter Lab 上设置查看函数的执行时间？","like_count":1,"discussions":[{"author":{"id":1056235,"avatar":"https://static001.geekbang.org/account/avatar/00/10/1d/eb/b2123759.jpg","nickname":"尹会生","note":"","ucode":"D1093DBD093617","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600309,"discussion_content":"jupyter里的设置菜单，里面有一项叫做“记录执行用时” 把它勾选上之后，重启jupyter即可，（备注：有一些版本需要再安装python的包，可以执行 pip install jupyterlab_execute_time ，目前3.10版本不需要这样做）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1674200929,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":367743,"user_name":"朱雯","can_delete":false,"product_type":"c3","uid":1035744,"ip_address":"北京","ucode":"064C45FBF6B51F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/cd/e0/c85bb948.jpg","comment_is_top":false,"comment_ctime":1675534365,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"from functools import lru_cache\n@lru_cache\ndef factorial(n):\n    if n &lt; 2:\n        return 1\n    elif n == 10:\n        return 3628800\n    elif n == 100:\n        return 93326215443944152681699238856266700490715968264381621468592963895217599993229915608941463976156518286253697920827223758251185210916864000000000000000000000000\n    else:\n        return n *fabi(n-1)\n\nprint(factorial(100))","like_count":3,"discussions":[{"author":{"id":1415636,"avatar":"https://static001.geekbang.org/account/avatar/00/15/99/d4/b8ca4d17.jpg","nickname":"Orion","note":"","ucode":"66C89BCA050925","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":648419,"discussion_content":"写死仙人","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1721571399,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":366174,"user_name":"PatrickL","can_delete":false,"product_type":"c3","uid":1341431,"ip_address":"上海","ucode":"EF0EC18639B9B2","user_header":"https://static001.geekbang.org/account/avatar/00/14/77/f7/11548247.jpg","comment_is_top":false,"comment_ctime":1673437385,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"from functools import lru_cache\n@lru_cache()\ndef factorial(n):\n    if n == 0:\n        return 1\n    return n*factorial(n-1)\n\nprint(factorial(100))","like_count":1},{"had_liked":false,"id":393201,"user_name":"8000tank","can_delete":false,"product_type":"c3","uid":3838010,"ip_address":"北京","ucode":"C5DC98A0EB57CE","user_header":"","comment_is_top":false,"comment_ctime":1723113838,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"# 普通递归\ndef factorial(num: int) -&gt; int:\n    &quot;&quot;&quot;\n    Purpose: factorial\n    &quot;&quot;&quot;\n    return 1 if num == 1 else num*factorial(num-1)\n\n\n# 缓存优化（装饰器）【并对10和100指定优化】\nfrom functools import lru_cache\n\n@lru_cache\ndef factorial_lru(num: int) -&gt; int:\n    &quot;&quot;&quot;\n    Purpose: factorial improve\n    &quot;&quot;&quot;\n    match (num):\n        case (1):\n            return 1\n        case (10):\n            return 3628800\n        case (100):\n            return 93326215443944152681699238856266700490715968264381621468592963895217599993229915608941463976156518286253697920827223758251185210916864000000000000000000000000\n        case (_):\n            return num*factorial_lru(num-1)\n\n\n# 优化（不使用递归）\ndef factorial_no_recursion(num: int) -&gt; int:\n    &quot;&quot;&quot;\n    Purpose: factorial no recursion\n    &quot;&quot;&quot;\n    cur = 1\n    for n in range(1, num+1):\n        cur *= n\n    return cur\n\n\nprint(factorial_no_recursion(40))","like_count":0},{"had_liked":false,"id":381564,"user_name":"acondess","can_delete":false,"product_type":"c3","uid":3628115,"ip_address":"美国","ucode":"D9145C65C73AAC","user_header":"","comment_is_top":false,"comment_ctime":1695387873,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"from functools import lru_cache\n\n@lru_cache(maxsize=None)  # maxsize设置为None表示无限制的缓存大小\ndef factorial(n):\n    if n == 0:\n        return 1\n    else:\n        return n * factorial(n - 1)\n\nprint(factorial(10))\nprint(factorial(100))","like_count":0},{"had_liked":false,"id":381563,"user_name":"acondess","can_delete":false,"product_type":"c3","uid":3628115,"ip_address":"美国","ucode":"D9145C65C73AAC","user_header":"","comment_is_top":false,"comment_ctime":1695387493,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"# 使用缓存来存储已经计算过的阶乘结果\nfactorial_cache = {}\n\ndef factorial(n):\n    # 如果n已经计算过，直接返回缓存中的结果\n    if n in factorial_cache:\n        return factorial_cache[n]\n    \n    # 计算阶乘\n    result = 1\n    for i in range(1, n + 1):\n        result *= i\n    \n    # 将计算结果存入缓存\n    factorial_cache[n] = result\n    \n    return result\n\nprint(factorial(10))\nprint(factorial(100))","like_count":0},{"had_liked":false,"id":379654,"user_name":"Geek_Mike","can_delete":false,"product_type":"c3","uid":3196376,"ip_address":"云南","ucode":"CFA942192C3B74","user_header":"https://static001.geekbang.org/account/avatar/00/30/c5/d8/c5509b9c.jpg","comment_is_top":false,"comment_ctime":1692251343,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"# 编写一个能够计算 100 以内阶乘的函数，已知 60% 的人经常计算 10 和 100 的阶乘，请在此前提下优化阶乘函数\n\ndef factorial_100(n:int):\n    if n == 10:\n        return 3628800\n\n    elif n == 100:\n        return 9.3326215e+157\n    \n    else:\n        result = 1\n        for i in range(1, n+1):\n            result *= i\n        return result \n\nprint(factorial_100(100))","like_count":0},{"had_liked":false,"id":378385,"user_name":"Greenery","can_delete":false,"product_type":"c3","uid":3566765,"ip_address":"中国香港","ucode":"16111129C9EBA2","user_header":"https://static001.geekbang.org/account/avatar/00/36/6c/ad/0a694b50.jpg","comment_is_top":false,"comment_ctime":1690170267,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"@lru_cache()\ndef funJQ(n):\n    if n==0 or n==1:\n        return 1\n    return funJQ(n-1)*n\nfunJQ(400)","like_count":0},{"had_liked":false,"id":369848,"user_name":"yanyu-xin","can_delete":false,"product_type":"c3","uid":1899757,"ip_address":"广西","ucode":"3AA389F9E4C236","user_header":"","comment_is_top":false,"comment_ctime":1678030769,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"&#39;&#39;&#39;用LRU算法 + 直接使用已知数据 优化算法&#39;&#39;&#39;\nfrom functools import lru_cache\n@lru_cache()\ndef factorial(n):\n    n_10 = 3628800\n    n_100 = 93326215443944152681699238856266700490715968264381621468592963895217599993229915608941463976156518286253697920827223758251185210916864000000000000000000000000\n\n    # N &gt;=100，用100的结果作为初始值\n    if n &gt;= 100 :\n        if n == 100:\n            return n_100\n        return n*factorial(n-1)\n\n    # 10 &lt;= 10 &lt; 100，用10的结果作为初始\n    if n &gt;= 10:\n        if n == 10:\n            return n_10\n        return n*factorial(n-1)        \n\n    # 0&lt;= N &lt;10，用0的结果作为初始\n    if n == 0:\n        return 1\n    return n*factorial(n-1)\n\nprint(factorial(101))","like_count":0,"discussions":[{"author":{"id":3838010,"avatar":"","nickname":"8000tank","note":"","ucode":"C5DC98A0EB57CE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":649298,"discussion_content":"“作为初始值”的工作，@lru_cache()就能自动干了吧？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1723108425,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":366428,"user_name":"Matthew","can_delete":false,"product_type":"c3","uid":2843865,"ip_address":"江苏","ucode":"96093089773740","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKSVuNarJuDhBSvHY0giaq6yriceEBKiaKuc04wCYWOuso50noqDexaPJJibJN7PHwvcQppnzsDia1icZkw/132","comment_is_top":false,"comment_ctime":1673773981,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100310001,"comment_content":"from functools import lru_cache\n\n@lru_cache()\ndef factorial(n):\n    if n == 1 or n == 0:\n        return 1\n    elif n == 10:\n        return 3628800;\n    elif n == 100:\n        return 93326215443944152681699238856266700490715968264381621468592963895217599993229915608941463976156518286253697920827223758251185210916864000000000000000000000000;    \n    else:\n        return factorial(n-1) * n\n    \nn = int(input(&quot;请输入：&quot;))\nprint(f&quot;{n}的阶乘是：{factorial(n)}&quot;)","like_count":0}]}