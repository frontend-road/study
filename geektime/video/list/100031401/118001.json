{"id":118001,"title":"59 | 手工服务部署和测试(上)","content":"<ul>\n<li>\n<p>代码：<a href=\"https://gitee.com/geektime-geekbang/staffjoy\">https://gitee.com/geektime-geekbang/staffjoy</a></p>\n</li>\n<li>\n<p>课件：<a href=\"https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ\">https://pan.baidu.com/s/1Q7eP3yZ1Vm8J2nhle5RzTQ</a> 提取码: 1aeh</p>\n</li>\n</ul>","comments":[{"had_liked":false,"id":272604,"user_name":"草裡菌","can_delete":false,"product_type":"c3","uid":1241514,"ip_address":"","ucode":"E11C630ABA4370","user_header":"https://static001.geekbang.org/account/avatar/00/12/f1/aa/c29def94.jpg","comment_is_top":false,"comment_ctime":1610171803,"is_pvip":false,"replies":[{"id":98969,"content":"作为专业开发者，有条件的话，尽量工作在Mac or Linux环境，可以省去很多不必要的麻烦。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1610461135,"ip_address":"","comment_id":272604,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"让这个 skywalking working起来真是艰难。\n1.我的电脑是windows10，使用openjdk11，然后使用这个skywalking会报反射access问题（应该是后续的jdk对一些反射暴力调用做了限制所导致的）。\n2.后来换成了openjdk8，依然有问题。\n3.然后尝试在本地的linux虚拟机里部署了skywalking，仍然有问题。\n4.在3的基础上，将windows和虚拟机的jdk都换成了oraclejdk1.8 ，才终于好了。\n\n这让我明显感受到，开发还是用Linux或者MacOS吧，windows太不受这些开源项目待见了。\nSAD","like_count":3,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513321,"discussion_content":"作为专业开发者，有条件的话，尽量工作在Mac or Linux环境，可以省去很多不必要的麻烦。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610461135,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128982,"user_name":"hunterlodge","can_delete":false,"product_type":"c3","uid":1069755,"ip_address":"","ucode":"5B83A79E784161","user_header":"https://static001.geekbang.org/account/avatar/00/10/52/bb/225e70a6.jpg","comment_is_top":false,"comment_ctime":1567000933,"is_pvip":false,"replies":[{"id":48102,"content":"数据库主键可以用自增或者uuid，两者各有利弊，uuid的不足是索引性能不佳，耗存储，不直观，没有顺序语意；但是uuid是不依赖于数据库的(方便迁移)，而且可以适用于分布式环境。自增的优劣和uuid大致相反。\n\n参考medium上的一篇文章(要翻墙):https:&#47;&#47;medium.com&#47;@Mareks_082&#47;auto-increment-keys-vs-uuid-a74d81f7476a","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1567082420,"ip_address":"","comment_id":128982,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"请问老师，为什么数据库表主键id都使用字符串类型呢？这样不是对索引优化不友好吗？谢谢！","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465207,"discussion_content":"数据库主键可以用自增或者uuid，两者各有利弊，uuid的不足是索引性能不佳，耗存储，不直观，没有顺序语意；但是uuid是不依赖于数据库的(方便迁移)，而且可以适用于分布式环境。自增的优劣和uuid大致相反。\n\n参考medium上的一篇文章(要翻墙):https://medium.com/@Mareks_082/auto-increment-keys-vs-uuid-a74d81f7476a","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567082420,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130901,"user_name":"江厚宏","can_delete":false,"product_type":"c3","uid":1061214,"ip_address":"","ucode":"00A5A0995C6D75","user_header":"https://static001.geekbang.org/account/avatar/00/10/31/5e/d7cdc1d6.jpg","comment_is_top":false,"comment_ctime":1567568614,"is_pvip":true,"replies":[{"id":49105,"content":"用过，用习惯了对schema版本控制有帮助。这种方式在国外较流行，国内大部分开发人员喜欢简单直接，还没有养成schema版本控制习惯。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1567594389,"ip_address":"","comment_id":130901,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"老师用过flyway吗？建不建议使用？","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466187,"discussion_content":"用过，用习惯了对schema版本控制有帮助。这种方式在国外较流行，国内大部分开发人员喜欢简单直接，还没有养成schema版本控制习惯。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567594389,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":249394,"user_name":"华融科技","can_delete":false,"product_type":"c3","uid":1808280,"ip_address":"","ucode":"B6BA3C47C05073","user_header":"","comment_is_top":false,"comment_ctime":1600647368,"is_pvip":false,"replies":[{"id":91586,"content":"理想情况下，微服务应该是职责单一和有界上下文，最好每个微服务都有独立的数据存储，这样才能做到独立开发&#47;测试&#47;发布&#47;运维，将团队之间的相互依赖最小化。\n\n所以原则是尽量独立，但是具体也要看你的业务上下文和领域的划分，有些情况下，可能暂时只能共用一个库，或者看能否抽出一个共享的服务。\n\n也可以分库冗余的方式，这时候要引入数据分发技术(例如变更数据捕获CDC，阿里Canal等)，通过数据分发技术将数据从一个数据库中复制到另外一个库中，但是只能有一个唯一真实的数据源(Single South of Truth)，也就是说数据虽然分布在两个数据库中，但是只有一个库中的数据是可读写的，另外一个数据库中的是只读拷贝。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1600873220,"ip_address":"","comment_id":249394,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"老师，请问一下，微服务划分时，是否最好是一个服务 一个数据库，如果两个服务有好多共用表（20多张），但是两个服务职能不同，这样是优先共用一个库？还是把这20多张表落在两个库中，通过定时程序通过轮询来实现数据准时实同步？ 谢谢！","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505914,"discussion_content":"理想情况下，微服务应该是职责单一和有界上下文，最好每个微服务都有独立的数据存储，这样才能做到独立开发/测试/发布/运维，将团队之间的相互依赖最小化。\n\n所以原则是尽量独立，但是具体也要看你的业务上下文和领域的划分，有些情况下，可能暂时只能共用一个库，或者看能否抽出一个共享的服务。\n\n也可以分库冗余的方式，这时候要引入数据分发技术(例如变更数据捕获CDC，阿里Canal等)，通过数据分发技术将数据从一个数据库中复制到另外一个库中，但是只能有一个唯一真实的数据源(Single South of Truth)，也就是说数据虽然分布在两个数据库中，但是只有一个库中的数据是可读写的，另外一个数据库中的是只读拷贝。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1600873220,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":208151,"user_name":"庞小辉","can_delete":false,"product_type":"c3","uid":1381456,"ip_address":"","ucode":"393EF369DDEC7B","user_header":"https://static001.geekbang.org/account/avatar/00/15/14/50/f0e91f78.jpg","comment_is_top":false,"comment_ctime":1587284745,"is_pvip":false,"replies":[{"id":77942,"content":"估计是你的skywalking没装好，建议先不要弄staffjoy，就弄一个简单的spring boot hello world应用，然后把skywalking埋点后跑起来，先走通这一步再看。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1587394221,"ip_address":"","comment_id":208151,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"老师，我手动启动服务，agent 也配置了，skywalking 也启动了。看 agent 的日志也正常，但是dashboard 就是看不到服务，求指点","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492357,"discussion_content":"估计是你的skywalking没装好，建议先不要弄staffjoy，就弄一个简单的spring boot hello world应用，然后把skywalking埋点后跑起来，先走通这一步再看。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587394221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":357221,"user_name":"Sam.张朝","can_delete":false,"product_type":"c3","uid":1132448,"ip_address":"上海","ucode":"FB20554D94B250","user_header":"https://static001.geekbang.org/account/avatar/00/11/47/a0/f12115b7.jpg","comment_is_top":false,"comment_ctime":1663076561,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100031401,"comment_content":"本地配置听麻烦的","like_count":0}]}