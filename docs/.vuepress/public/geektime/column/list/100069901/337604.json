{"id":337604,"title":"04 | Raftåè®®ï¼šetcdå¦‚ä½•å®ç°é«˜å¯ç”¨ã€æ•°æ®å¼ºä¸€è‡´çš„ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å”èªã€‚</p><p>åœ¨å‰é¢çš„etcdè¯»å†™æµç¨‹å­¦ä¹ ä¸­ï¼Œæˆ‘å’Œä½ å¤šæ¬¡æåˆ°äº†etcdæ˜¯åŸºäºRaftåè®®å®ç°é«˜å¯ç”¨ã€æ•°æ®å¼ºä¸€è‡´æ€§çš„ã€‚</p><p>é‚£ä¹ˆetcdæ˜¯å¦‚ä½•åŸºäºRaftæ¥å®ç°é«˜å¯ç”¨ã€æ•°æ®å¼ºä¸€è‡´æ€§çš„å‘¢ï¼Ÿ</p><p>è¿™èŠ‚è¯¾æˆ‘ä»¬å°±ä»¥ä¸Šä¸€èŠ‚ä¸­çš„helloå†™è¯·æ±‚ä¸ºæ¡ˆä¾‹ï¼Œæ·±å…¥åˆ†æetcdåœ¨é‡åˆ°LeaderèŠ‚ç‚¹crashç­‰å¼‚å¸¸åï¼ŒFollowerèŠ‚ç‚¹å¦‚ä½•å¿«é€Ÿæ„ŸçŸ¥åˆ°å¼‚å¸¸ï¼Œå¹¶é«˜æ•ˆé€‰ä¸¾å‡ºæ–°çš„Leaderï¼Œå¯¹å¤–æä¾›é«˜å¯ç”¨æœåŠ¡çš„ã€‚</p><p>åŒæ—¶ï¼Œæˆ‘å°†é€šè¿‡ä¸€ä¸ªæ—¥å¿—å¤åˆ¶æ•´ä½“æµç¨‹å›¾ï¼Œä¸ºä½ ä»‹ç»etcdå¦‚ä½•ä¿éšœå„èŠ‚ç‚¹æ•°æ®ä¸€è‡´æ€§ï¼Œå¹¶ä»‹ç»Raftç®—æ³•ä¸ºäº†ç¡®ä¿æ•°æ®ä¸€è‡´æ€§ã€å®Œæ•´æ€§ï¼Œå¯¹Leaderé€‰ä¸¾å’Œæ—¥å¿—å¤åˆ¶æ‰€å¢åŠ çš„ä¸€ç³»åˆ—å®‰å…¨è§„åˆ™ã€‚å¸Œæœ›é€šè¿‡è¿™èŠ‚è¯¾ï¼Œè®©ä½ äº†è§£etcdåœ¨èŠ‚ç‚¹æ•…éšœã€ç½‘ç»œåˆ†åŒºç­‰å¼‚å¸¸åœºæ™¯ä¸‹æ˜¯å¦‚ä½•åŸºäºRaftç®—æ³•å®ç°é«˜å¯ç”¨ã€æ•°æ®å¼ºä¸€è‡´çš„ã€‚</p><h2>å¦‚ä½•é¿å…å•ç‚¹æ•…éšœ</h2><p>åœ¨ä»‹ç»Raftç®—æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆäº†è§£ä¸‹å®ƒçš„è¯ç”ŸèƒŒæ™¯ï¼ŒRaftè§£å†³äº†åˆ†å¸ƒå¼ç³»ç»Ÿä»€ä¹ˆç—›ç‚¹å‘¢ï¼Ÿ</p><p>é¦–å…ˆæˆ‘ä»¬å›æƒ³ä¸‹ï¼Œæ—©æœŸæˆ‘ä»¬ä½¿ç”¨çš„æ•°æ®å­˜å‚¨æœåŠ¡ï¼Œå®ƒä»¬å¾€å¾€æ˜¯éƒ¨ç½²åœ¨å•èŠ‚ç‚¹ä¸Šçš„ã€‚ä½†æ˜¯å•èŠ‚ç‚¹å­˜åœ¨å•ç‚¹æ•…éšœï¼Œä¸€å®•æœºå°±æ•´ä¸ªæœåŠ¡ä¸å¯ç”¨ï¼Œå¯¹ä¸šåŠ¡å½±å“éå¸¸å¤§ã€‚</p><p>éšåï¼Œä¸ºäº†è§£å†³å•ç‚¹é—®é¢˜ï¼Œè½¯ä»¶ç³»ç»Ÿå·¥ç¨‹å¸ˆå¼•å…¥äº†æ•°æ®å¤åˆ¶æŠ€æœ¯ï¼Œå®ç°å¤šå‰¯æœ¬ã€‚é€šè¿‡æ•°æ®å¤åˆ¶æ–¹æ¡ˆï¼Œä¸€æ–¹é¢æˆ‘ä»¬å¯ä»¥æé«˜æœåŠ¡å¯ç”¨æ€§ï¼Œé¿å…å•ç‚¹æ•…éšœã€‚å¦ä¸€æ–¹é¢ï¼Œå¤šå‰¯æœ¬å¯ä»¥æå‡è¯»ååé‡ã€ç”šè‡³å°±è¿‘éƒ¨ç½²åœ¨ä¸šåŠ¡æ‰€åœ¨çš„åœ°ç†ä½ç½®ï¼Œé™ä½è®¿é—®å»¶è¿Ÿã€‚</p><!-- [[[read_end]]] --><p><strong>å¤šå‰¯æœ¬å¤åˆ¶æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</strong></p><p>å¤šå‰¯æœ¬å¸¸ç”¨çš„æŠ€æœ¯æ–¹æ¡ˆä¸»è¦æœ‰ä¸»ä»å¤åˆ¶å’Œå»ä¸­å¿ƒåŒ–å¤åˆ¶ã€‚ä¸»ä»å¤åˆ¶ï¼Œåˆåˆ†ä¸ºå…¨åŒæ­¥å¤åˆ¶ã€å¼‚æ­¥å¤åˆ¶ã€åŠåŒæ­¥å¤åˆ¶ï¼Œæ¯”å¦‚MySQL/Rediså•æœºä¸»å¤‡ç‰ˆå°±åŸºäºä¸»ä»å¤åˆ¶å®ç°çš„ã€‚</p><p><strong>å…¨åŒæ­¥å¤åˆ¶</strong>æ˜¯æŒ‡ä¸»æ”¶åˆ°ä¸€ä¸ªå†™è¯·æ±‚åï¼Œå¿…é¡»ç­‰å¾…å…¨éƒ¨ä»èŠ‚ç‚¹ç¡®è®¤è¿”å›åï¼Œæ‰èƒ½è¿”å›ç»™å®¢æˆ·ç«¯æˆåŠŸã€‚å› æ­¤å¦‚æœä¸€ä¸ªä»èŠ‚ç‚¹æ•…éšœï¼Œæ•´ä¸ªç³»ç»Ÿå°±ä¼šä¸å¯ç”¨ã€‚è¿™ç§æ–¹æ¡ˆä¸ºäº†ä¿è¯å¤šå‰¯æœ¬çš„ä¸€è‡´æ€§ï¼Œè€Œç‰ºç‰²äº†å¯ç”¨æ€§ï¼Œä¸€èˆ¬ä½¿ç”¨ä¸å¤šã€‚</p><p><strong>å¼‚æ­¥å¤åˆ¶</strong>æ˜¯æŒ‡ä¸»æ”¶åˆ°ä¸€ä¸ªå†™è¯·æ±‚åï¼Œå¯åŠæ—¶è¿”å›ç»™clientï¼Œå¼‚æ­¥å°†è¯·æ±‚è½¬å‘ç»™å„ä¸ªå‰¯æœ¬ï¼Œè‹¥è¿˜æœªå°†è¯·æ±‚è½¬å‘åˆ°å‰¯æœ¬å‰å°±æ•…éšœäº†ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œä½†æ˜¯å¯ç”¨æ€§æ˜¯æœ€é«˜çš„ã€‚</p><p><strong>åŠåŒæ­¥å¤åˆ¶</strong>ä»‹äºå…¨åŒæ­¥å¤åˆ¶ã€å¼‚æ­¥å¤åˆ¶ä¹‹é—´ï¼Œå®ƒæ˜¯æŒ‡ä¸»æ”¶åˆ°ä¸€ä¸ªå†™è¯·æ±‚åï¼Œè‡³å°‘æœ‰ä¸€ä¸ªå‰¯æœ¬æ¥æ”¶æ•°æ®åï¼Œå°±å¯ä»¥è¿”å›ç»™å®¢æˆ·ç«¯æˆåŠŸï¼Œåœ¨æ•°æ®ä¸€è‡´æ€§ã€å¯ç”¨æ€§ä¸Šå®ç°äº†å¹³è¡¡å’Œå–èˆã€‚</p><p>è·Ÿä¸»ä»å¤åˆ¶ç›¸åçš„å°±æ˜¯<strong>å»ä¸­å¿ƒåŒ–å¤åˆ¶</strong>ï¼Œå®ƒæ˜¯æŒ‡åœ¨ä¸€ä¸ªnå‰¯æœ¬èŠ‚ç‚¹é›†ç¾¤ä¸­ï¼Œä»»æ„èŠ‚ç‚¹éƒ½å¯æ¥å—å†™è¯·æ±‚ï¼Œä½†ä¸€ä¸ªæˆåŠŸçš„å†™å…¥éœ€è¦wä¸ªèŠ‚ç‚¹ç¡®è®¤ï¼Œè¯»å–ä¹Ÿå¿…é¡»æŸ¥è¯¢è‡³å°‘rä¸ªèŠ‚ç‚¹ã€‚</p><p>ä½ å¯ä»¥æ ¹æ®å®é™…ä¸šåŠ¡åœºæ™¯å¯¹æ•°æ®ä¸€è‡´æ€§çš„æ•æ„Ÿåº¦ï¼Œè®¾ç½®åˆé€‚w/rå‚æ•°ã€‚æ¯”å¦‚ä½ å¸Œæœ›æ¯æ¬¡å†™å…¥åï¼Œä»»æ„clientéƒ½èƒ½è¯»å–åˆ°æ–°å€¼ï¼Œå¦‚æœnæ˜¯3ä¸ªå‰¯æœ¬ï¼Œä½ å¯ä»¥å°†wå’Œrè®¾ç½®ä¸º2ï¼Œè¿™æ ·å½“ä½ è¯»ä¸¤ä¸ªèŠ‚ç‚¹æ—¶å€™ï¼Œå¿…æœ‰ä¸€ä¸ªèŠ‚ç‚¹å«æœ‰æœ€è¿‘å†™å…¥çš„æ–°å€¼ï¼Œè¿™ç§è¯»æˆ‘ä»¬ç§°ä¹‹ä¸ºæ³•å®šç¥¨æ•°è¯»ï¼ˆquorum readï¼‰ã€‚</p><p>AWSçš„Dynamoç³»ç»Ÿå°±æ˜¯åŸºäºå»ä¸­å¿ƒåŒ–çš„å¤åˆ¶ç®—æ³•å®ç°çš„ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯èŠ‚ç‚¹è§’è‰²éƒ½æ˜¯å¹³ç­‰çš„ï¼Œé™ä½è¿ç»´å¤æ‚åº¦ï¼Œå¯ç”¨æ€§æ›´é«˜ã€‚ä½†æ˜¯ç¼ºé™·æ˜¯å»ä¸­å¿ƒåŒ–å¤åˆ¶ï¼ŒåŠ¿å¿…ä¼šå¯¼è‡´å„ç§å†™å…¥å†²çªï¼Œä¸šåŠ¡éœ€è¦å…³æ³¨å†²çªå¤„ç†ã€‚</p><p>ä»ä»¥ä¸Šåˆ†æä¸­ï¼Œä¸ºäº†è§£å†³å•ç‚¹æ•…éšœï¼Œä»è€Œå¼•å…¥äº†å¤šå‰¯æœ¬ã€‚ä½†åŸºäºå¤åˆ¶ç®—æ³•å®ç°çš„æ•°æ®åº“ï¼Œä¸ºäº†ä¿è¯æœåŠ¡å¯ç”¨æ€§ï¼Œå¤§å¤šæ•°æä¾›çš„æ˜¯æœ€ç»ˆä¸€è‡´æ€§ï¼Œæ€»è€Œè¨€ä¹‹ï¼Œä¸ç®¡æ˜¯ä¸»ä»å¤åˆ¶è¿˜æ˜¯å¼‚æ­¥å¤åˆ¶ï¼Œéƒ½å­˜åœ¨ä¸€å®šçš„ç¼ºé™·ã€‚</p><p><strong>å¦‚ä½•è§£å†³ä»¥ä¸Šå¤åˆ¶ç®—æ³•çš„å›°å¢ƒå‘¢ï¼Ÿ</strong></p><p>ç­”æ¡ˆå°±æ˜¯å…±è¯†ç®—æ³•ï¼Œå®ƒæœ€æ—©æ˜¯åŸºäºå¤åˆ¶çŠ¶æ€æœºèƒŒæ™¯ä¸‹æå‡ºæ¥çš„ã€‚ ä¸‹å›¾æ˜¯å¤åˆ¶çŠ¶æ€æœºçš„ç»“æ„ï¼ˆå¼•ç”¨è‡ªRaft paperï¼‰ï¼Œ å®ƒç”±å…±è¯†æ¨¡å—ã€æ—¥å¿—æ¨¡å—ã€çŠ¶æ€æœºç»„æˆã€‚é€šè¿‡å…±è¯†æ¨¡å—ä¿è¯å„ä¸ªèŠ‚ç‚¹æ—¥å¿—çš„ä¸€è‡´æ€§ï¼Œç„¶åå„ä¸ªèŠ‚ç‚¹åŸºäºåŒæ ·çš„æ—¥å¿—ã€é¡ºåºæ‰§è¡ŒæŒ‡ä»¤ï¼Œæœ€ç»ˆå„ä¸ªå¤åˆ¶çŠ¶æ€æœºçš„ç»“æœå®ç°ä¸€è‡´ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/3y/eb/3yy3fbc1ab564e3af9ac9223db1435eb.png?wh=605*319\" alt=\"\"></p><p>å…±è¯†ç®—æ³•çš„ç¥–å¸ˆçˆ·æ˜¯Paxosï¼Œ ä½†æ˜¯ç”±äºå®ƒè¿‡äºå¤æ‚ï¼Œéš¾äºç†è§£ï¼Œå·¥ç¨‹å®è·µä¸Šä¹Ÿè¾ƒéš¾è½åœ°ï¼Œå¯¼è‡´åœ¨å·¥ç¨‹ç•Œè½åœ°è¾ƒæ…¢ã€‚standfordå¤§å­¦çš„Diegoæå‡ºçš„Raftç®—æ³•æ­£æ˜¯ä¸ºäº†å¯ç†è§£æ€§ã€æ˜“å®ç°è€Œè¯ç”Ÿçš„ï¼Œå®ƒé€šè¿‡é—®é¢˜åˆ†è§£ï¼Œå°†å¤æ‚çš„å…±è¯†é—®é¢˜æ‹†åˆ†æˆä¸‰ä¸ªå­é—®é¢˜ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ul>\n<li>Leaderé€‰ä¸¾ï¼ŒLeaderæ•…éšœåé›†ç¾¤èƒ½å¿«é€Ÿé€‰å‡ºæ–°Leaderï¼›</li>\n<li>æ—¥å¿—å¤åˆ¶ï¼Œ é›†ç¾¤åªæœ‰Leaderèƒ½å†™å…¥æ—¥å¿—ï¼Œ Leaderè´Ÿè´£å¤åˆ¶æ—¥å¿—åˆ°FollowerèŠ‚ç‚¹ï¼Œå¹¶å¼ºåˆ¶FollowerèŠ‚ç‚¹ä¸è‡ªå·±ä¿æŒç›¸åŒï¼›</li>\n<li>å®‰å…¨æ€§ï¼Œä¸€ä¸ªä»»æœŸå†…é›†ç¾¤åªèƒ½äº§ç”Ÿä¸€ä¸ªLeaderã€å·²æäº¤çš„æ—¥å¿—æ¡ç›®åœ¨å‘ç”ŸLeaderé€‰ä¸¾æ—¶ï¼Œä¸€å®šä¼šå­˜åœ¨æ›´é«˜ä»»æœŸçš„æ–°Leaderæ—¥å¿—ä¸­ã€å„ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€æœºåº”ç”¨çš„ä»»æ„ä½ç½®çš„æ—¥å¿—æ¡ç›®å†…å®¹åº”ä¸€æ ·ç­‰ã€‚</li>\n</ul><p>ä¸‹é¢æˆ‘ä»¥å®é™…åœºæ™¯ä¸ºæ¡ˆä¾‹ï¼Œåˆ†åˆ«å’Œä½ æ·±å…¥è®¨è®ºè¿™ä¸‰ä¸ªå­é—®é¢˜ï¼Œçœ‹çœ‹Raftæ˜¯å¦‚ä½•è§£å†³è¿™ä¸‰ä¸ªé—®é¢˜ï¼Œä»¥åŠåœ¨etcdä¸­çš„åº”ç”¨å®ç°ã€‚</p><h2>Leaderé€‰ä¸¾</h2><p>å½“etcd serveræ”¶åˆ°clientå‘èµ·çš„put helloå†™è¯·æ±‚åï¼ŒKVæ¨¡å—ä¼šå‘Raftæ¨¡å—æäº¤ä¸€ä¸ªputææ¡ˆï¼Œæˆ‘ä»¬çŸ¥é“åªæœ‰é›†ç¾¤Leaderæ‰èƒ½å¤„ç†å†™ææ¡ˆï¼Œå¦‚æœæ­¤æ—¶é›†ç¾¤ä¸­æ— Leaderï¼Œ æ•´ä¸ªè¯·æ±‚å°±ä¼šè¶…æ—¶ã€‚</p><p>é‚£ä¹ˆLeaderæ˜¯æ€ä¹ˆè¯ç”Ÿçš„å‘¢ï¼ŸLeader crashä¹‹åå…¶ä»–èŠ‚ç‚¹å¦‚ä½•ç«é€‰å‘¢ï¼Ÿ</p><p>é¦–å…ˆåœ¨Raftåè®®ä¸­å®ƒå®šä¹‰äº†é›†ç¾¤ä¸­çš„å¦‚ä¸‹èŠ‚ç‚¹çŠ¶æ€ï¼Œä»»ä½•æ—¶åˆ»ï¼Œæ¯ä¸ªèŠ‚ç‚¹è‚¯å®šå¤„äºå…¶ä¸­ä¸€ä¸ªçŠ¶æ€ï¼š</p><ul>\n<li>Followerï¼Œè·Ÿéšè€…ï¼Œ åŒæ­¥ä»Leaderæ”¶åˆ°çš„æ—¥å¿—ï¼Œetcdå¯åŠ¨çš„æ—¶å€™é»˜è®¤ä¸ºæ­¤çŠ¶æ€ï¼›</li>\n<li>Candidateï¼Œç«é€‰è€…ï¼Œå¯ä»¥å‘èµ·Leaderé€‰ä¸¾ï¼›</li>\n<li>Leaderï¼Œé›†ç¾¤é¢†å¯¼è€…ï¼Œ å”¯ä¸€æ€§ï¼Œæ‹¥æœ‰åŒæ­¥æ—¥å¿—çš„ç‰¹æƒï¼Œéœ€å®šæ—¶å¹¿æ’­å¿ƒè·³ç»™FollowerèŠ‚ç‚¹ï¼Œä»¥ç»´æŒé¢†å¯¼è€…èº«ä»½ã€‚</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/a5/09/a5a210eec289d8e4e363255906391009.png?wh=1808*978\" alt=\"\"></p><p>ä¸Šå›¾æ˜¯èŠ‚ç‚¹çŠ¶æ€å˜åŒ–å…³ç³»å›¾ï¼Œå½“FollowerèŠ‚ç‚¹æ¥æ”¶LeaderèŠ‚ç‚¹å¿ƒè·³æ¶ˆæ¯è¶…æ—¶åï¼Œå®ƒä¼šè½¬å˜æˆCandidateèŠ‚ç‚¹ï¼Œå¹¶å¯å‘èµ·ç«é€‰LeaderæŠ•ç¥¨ï¼Œè‹¥è·å¾—é›†ç¾¤å¤šæ•°èŠ‚ç‚¹çš„æ”¯æŒåï¼Œå®ƒå°±å¯è½¬å˜æˆLeaderèŠ‚ç‚¹ã€‚</p><p>ä¸‹é¢æˆ‘ä»¥Leader crashåœºæ™¯ä¸ºæ¡ˆä¾‹ï¼Œç»™ä½ è¯¦ç»†ä»‹ç»ä¸€ä¸‹etcd Leaderé€‰ä¸¾åŸç†ã€‚</p><p>å‡è®¾é›†ç¾¤æ€»å…±3ä¸ªèŠ‚ç‚¹ï¼ŒAèŠ‚ç‚¹ä¸ºLeaderï¼ŒBã€CèŠ‚ç‚¹ä¸ºFollowerã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a2/59/a20ba5b17de79d6ce8c78a712a364359.png?wh=1920*942\" alt=\"\"></p><p>å¦‚ä¸ŠLeaderé€‰ä¸¾å›¾å·¦è¾¹éƒ¨åˆ†æ‰€ç¤ºï¼Œ æ­£å¸¸æƒ…å†µä¸‹ï¼ŒLeaderèŠ‚ç‚¹ä¼šæŒ‰ç…§å¿ƒè·³é—´éš”æ—¶é—´ï¼Œå®šæ—¶å¹¿æ’­å¿ƒè·³æ¶ˆæ¯ï¼ˆMsgHeartbeatæ¶ˆæ¯ï¼‰ç»™FollowerèŠ‚ç‚¹ï¼Œä»¥ç»´æŒLeaderèº«ä»½ã€‚ Followeræ”¶åˆ°åå›å¤å¿ƒè·³åº”ç­”åŒ…æ¶ˆæ¯ï¼ˆMsgHeartbeatRespæ¶ˆæ¯ï¼‰ç»™Leaderã€‚</p><p>ç»†å¿ƒçš„ä½ å¯èƒ½æ³¨æ„åˆ°ä¸Šå›¾ä¸­çš„LeaderèŠ‚ç‚¹ä¸‹æ–¹æœ‰ä¸€ä¸ªä»»æœŸå·ï¼ˆtermï¼‰ï¼Œ å®ƒå…·æœ‰ä»€ä¹ˆæ ·çš„ä½œç”¨å‘¢ï¼Ÿ</p><p>è¿™æ˜¯å› ä¸ºRaftå°†æ—¶é—´åˆ’åˆ†æˆä¸€ä¸ªä¸ªä»»æœŸï¼Œä»»æœŸç”¨è¿ç»­çš„æ•´æ•°è¡¨ç¤ºï¼Œæ¯ä¸ªä»»æœŸä»ä¸€æ¬¡é€‰ä¸¾å¼€å§‹ï¼Œèµ¢å¾—é€‰ä¸¾çš„èŠ‚ç‚¹åœ¨è¯¥ä»»æœŸå†…å……å½“Leaderçš„èŒè´£ï¼Œéšç€æ—¶é—´çš„æ¶ˆé€ï¼Œé›†ç¾¤å¯èƒ½ä¼šå‘ç”Ÿæ–°çš„é€‰ä¸¾ï¼Œä»»æœŸå·ä¹Ÿä¼šå•è°ƒé€’å¢ã€‚</p><p>é€šè¿‡ä»»æœŸå·ï¼Œå¯ä»¥æ¯”è¾ƒå„ä¸ªèŠ‚ç‚¹çš„æ•°æ®æ–°æ—§ã€è¯†åˆ«è¿‡æœŸçš„Leaderç­‰ï¼Œå®ƒåœ¨Raftç®—æ³•ä¸­å……å½“é€»è¾‘æ—¶é’Ÿï¼Œå‘æŒ¥ç€é‡è¦ä½œç”¨ã€‚</p><p>äº†è§£å®Œæ­£å¸¸æƒ…å†µä¸‹Leaderç»´æŒèº«ä»½çš„åŸç†åï¼Œæˆ‘ä»¬å†çœ‹å¼‚å¸¸æƒ…å†µä¸‹ï¼Œä¹Ÿå°±Leader crashåï¼Œetcdæ˜¯å¦‚ä½•è‡ªæ„ˆçš„å‘¢ï¼Ÿ</p><p>å¦‚ä¸ŠLeaderé€‰ä¸¾å›¾å³è¾¹éƒ¨åˆ†æ‰€ç¤ºï¼Œå½“LeaderèŠ‚ç‚¹å¼‚å¸¸åï¼ŒFollowerèŠ‚ç‚¹ä¼šæ¥æ”¶Leaderçš„å¿ƒè·³æ¶ˆæ¯è¶…æ—¶ï¼Œå½“è¶…æ—¶æ—¶é—´å¤§äºç«é€‰è¶…æ—¶æ—¶é—´åï¼Œå®ƒä»¬ä¼šè¿›å…¥CandidateçŠ¶æ€ã€‚</p><p>è¿™é‡Œè¦æé†’ä¸‹ä½ ï¼Œetcdé»˜è®¤å¿ƒè·³é—´éš”æ—¶é—´ï¼ˆheartbeat-intervalï¼‰æ˜¯100msï¼Œ é»˜è®¤ç«é€‰è¶…æ—¶æ—¶é—´ï¼ˆelection timeoutï¼‰æ˜¯1000msï¼Œ ä½ éœ€è¦æ ¹æ®å®é™…éƒ¨ç½²ç¯å¢ƒã€ä¸šåŠ¡åœºæ™¯é€‚å½“è°ƒä¼˜ï¼Œå¦åˆ™å°±å¾ˆå¯èƒ½ä¼šé¢‘ç¹å‘ç”ŸLeaderé€‰ä¸¾åˆ‡æ¢ï¼Œå¯¼è‡´æœåŠ¡ç¨³å®šæ€§ä¸‹é™ï¼Œåé¢æˆ‘ä»¬å®è·µç¯‡ä¼šå†è¯¦ç»†ä»‹ç»ã€‚</p><p>è¿›å…¥CandidateçŠ¶æ€çš„èŠ‚ç‚¹ï¼Œä¼šç«‹å³å‘èµ·é€‰ä¸¾æµç¨‹ï¼Œè‡ªå¢ä»»æœŸå·ï¼ŒæŠ•ç¥¨ç»™è‡ªå·±ï¼Œå¹¶å‘å…¶ä»–èŠ‚ç‚¹å‘é€ç«é€‰LeaderæŠ•ç¥¨æ¶ˆæ¯ï¼ˆMsgVoteï¼‰ã€‚</p><p>CèŠ‚ç‚¹æ”¶åˆ°Follower BèŠ‚ç‚¹ç«é€‰Leaderæ¶ˆæ¯åï¼Œè¿™æ—¶å€™å¯èƒ½ä¼šå‡ºç°å¦‚ä¸‹ä¸¤ç§æƒ…å†µï¼š</p><ul>\n<li>ç¬¬ä¸€ç§æƒ…å†µæ˜¯CèŠ‚ç‚¹åˆ¤æ–­BèŠ‚ç‚¹çš„æ•°æ®è‡³å°‘å’Œè‡ªå·±ä¸€æ ·æ–°ã€BèŠ‚ç‚¹ä»»æœŸå·å¤§äºCå½“å‰ä»»æœŸå·ã€å¹¶ä¸”CæœªæŠ•ç¥¨ç»™å…¶ä»–å€™é€‰è€…ï¼Œå°±å¯æŠ•ç¥¨ç»™Bã€‚è¿™æ—¶BèŠ‚ç‚¹è·å¾—äº†é›†ç¾¤å¤šæ•°èŠ‚ç‚¹æ”¯æŒï¼Œäºæ˜¯æˆä¸ºäº†æ–°çš„Leaderã€‚</li>\n<li>ç¬¬äºŒç§æƒ…å†µæ˜¯ï¼Œæ°å¥½Cä¹Ÿå¿ƒè·³è¶…æ—¶è¶…è¿‡ç«é€‰æ—¶é—´äº†ï¼Œå®ƒä¹Ÿå‘èµ·äº†é€‰ä¸¾ï¼Œå¹¶æŠ•ç¥¨ç»™äº†è‡ªå·±ï¼Œé‚£ä¹ˆå®ƒå°†æ‹’ç»æŠ•ç¥¨ç»™Bï¼Œè¿™æ—¶è°ä¹Ÿæ— æ³•è·å–é›†ç¾¤å¤šæ•°æ´¾æ”¯æŒï¼Œåªèƒ½ç­‰å¾…ç«é€‰è¶…æ—¶ï¼Œå¼€å¯æ–°ä¸€è½®é€‰ä¸¾ã€‚Raftä¸ºäº†ä¼˜åŒ–é€‰ç¥¨è¢«ç“œåˆ†å¯¼è‡´é€‰ä¸¾å¤±è´¥çš„é—®é¢˜ï¼Œå¼•å…¥äº†éšæœºæ•°ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç­‰å¾…å‘èµ·é€‰ä¸¾çš„æ—¶é—´ç‚¹ä¸ä¸€è‡´ï¼Œä¼˜é›…çš„è§£å†³äº†æ½œåœ¨çš„ç«é€‰æ´»é”ï¼ŒåŒæ—¶æ˜“äºç†è§£ã€‚</li>\n</ul><p>Leaderé€‰å‡ºæ¥åï¼Œå®ƒä»€ä¹ˆæ—¶å€™åˆä¼šå˜æˆFollowerçŠ¶æ€å‘¢ï¼Ÿ ä»ä¸Šé¢çš„çŠ¶æ€è½¬æ¢å…³ç³»å›¾ä¸­ä½ å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœç°æœ‰Leaderå‘ç°äº†æ–°çš„Leaderä»»æœŸå·ï¼Œé‚£ä¹ˆå®ƒå°±éœ€è¦è½¬æ¢åˆ°FollowerèŠ‚ç‚¹ã€‚AèŠ‚ç‚¹crashåï¼Œå†æ¬¡å¯åŠ¨æˆä¸ºFollowerï¼Œå‡è®¾å› ä¸ºç½‘ç»œé—®é¢˜æ— æ³•è¿é€šBã€CèŠ‚ç‚¹ï¼Œè¿™æ—¶å€™æ ¹æ®çŠ¶æ€å›¾ï¼Œæˆ‘ä»¬çŸ¥é“å®ƒå°†ä¸åœè‡ªå¢ä»»æœŸå·ï¼Œå‘èµ·é€‰ä¸¾ã€‚ç­‰AèŠ‚ç‚¹ç½‘ç»œå¼‚å¸¸æ¢å¤åï¼Œé‚£ä¹ˆç°æœ‰Leaderæ”¶åˆ°äº†æ–°çš„ä»»æœŸå·ï¼Œå°±ä¼šè§¦å‘æ–°ä¸€è½®Leaderé€‰ä¸¾ï¼Œå½±å“æœåŠ¡çš„å¯ç”¨æ€§ã€‚</p><p>ç„¶è€ŒAèŠ‚ç‚¹çš„æ•°æ®æ˜¯è¿œè¿œè½åBã€Cçš„ï¼Œæ˜¯æ— æ³•è·å¾—é›†ç¾¤Leaderåœ°ä½çš„ï¼Œå‘èµ·çš„é€‰ä¸¾æ— æ•ˆä¸”å¯¹é›†ç¾¤ç¨³å®šæ€§æœ‰ä¼¤å®³ã€‚</p><p>é‚£å¦‚ä½•é¿å…ä»¥ä¸Šåœºæ™¯ä¸­çš„æ— æ•ˆçš„é€‰ä¸¾å‘¢ï¼Ÿ</p><p>åœ¨etcd 3.4ä¸­ï¼Œetcdå¼•å…¥äº†ä¸€ä¸ªPreVoteå‚æ•°ï¼ˆé»˜è®¤falseï¼‰ï¼Œå¯ä»¥ç”¨æ¥å¯ç”¨PreCandidateçŠ¶æ€è§£å†³æ­¤é—®é¢˜ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚Followeråœ¨è½¬æ¢æˆCandidateçŠ¶æ€å‰ï¼Œå…ˆè¿›å…¥PreCandidateçŠ¶æ€ï¼Œä¸è‡ªå¢ä»»æœŸå·ï¼Œ å‘èµ·é¢„æŠ•ç¥¨ã€‚è‹¥è·å¾—é›†ç¾¤å¤šæ•°èŠ‚ç‚¹è®¤å¯ï¼Œç¡®å®šæœ‰æ¦‚ç‡æˆä¸ºLeaderæ‰èƒ½è¿›å…¥CandidateçŠ¶æ€ï¼Œå‘èµ·é€‰ä¸¾æµç¨‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/16/06/169ae84055byya38b616d2e71cfb9706.png?wh=1920*971\" alt=\"\"></p><p>å› AèŠ‚ç‚¹æ•°æ®è½åè¾ƒå¤šï¼Œé¢„æŠ•ç¥¨è¯·æ±‚æ— æ³•è·å¾—å¤šæ•°èŠ‚ç‚¹è®¤å¯ï¼Œå› æ­¤å®ƒå°±ä¸ä¼šè¿›å…¥CandidateçŠ¶æ€ï¼Œå¯¼è‡´é›†ç¾¤é‡æ–°é€‰ä¸¾ã€‚</p><p>è¿™å°±æ˜¯Raft Leaderé€‰ä¸¾æ ¸å¿ƒåŸç†ï¼Œä½¿ç”¨å¿ƒè·³æœºåˆ¶ç»´æŒLeaderèº«ä»½ã€è§¦å‘Leaderé€‰ä¸¾ï¼ŒetcdåŸºäºå®ƒå®ç°äº†é«˜å¯ç”¨ï¼Œåªè¦é›†ç¾¤ä¸€åŠä»¥ä¸ŠèŠ‚ç‚¹å­˜æ´»ã€å¯ç›¸äº’é€šä¿¡ï¼ŒLeaderå®•æœºåï¼Œå°±èƒ½å¿«é€Ÿé€‰ä¸¾å‡ºæ–°çš„Leaderï¼Œç»§ç»­å¯¹å¤–æä¾›æœåŠ¡ã€‚</p><h2>æ—¥å¿—å¤åˆ¶</h2><p>å‡è®¾åœ¨ä¸Šé¢çš„Leaderé€‰ä¸¾æµç¨‹ä¸­ï¼ŒBæˆä¸ºäº†æ–°çš„Leaderï¼Œå®ƒæ”¶åˆ°putææ¡ˆåï¼Œå®ƒæ˜¯å¦‚ä½•å°†æ—¥å¿—åŒæ­¥ç»™FollowerèŠ‚ç‚¹çš„å‘¢ï¼Ÿ ä»€ä¹ˆæ—¶å€™å®ƒå¯ä»¥ç¡®å®šä¸€ä¸ªæ—¥å¿—æ¡ç›®ä¸ºå·²æäº¤ï¼Œé€šçŸ¥etcdserveræ¨¡å—åº”ç”¨æ—¥å¿—æ¡ç›®æŒ‡ä»¤åˆ°çŠ¶æ€æœºå‘¢ï¼Ÿ</p><p>è¿™å°±æ¶‰åŠåˆ°Raftæ—¥å¿—å¤åˆ¶åŸç†ï¼Œä¸ºäº†å¸®åŠ©ä½ ç†è§£æ—¥å¿—å¤åˆ¶çš„åŸç†ï¼Œä¸‹é¢æˆ‘ç»™ä½ ç”»äº†ä¸€å¹…Leaderæ”¶åˆ°putè¯·æ±‚åï¼Œå‘FollowerèŠ‚ç‚¹å¤åˆ¶æ—¥å¿—çš„æ•´ä½“æµç¨‹å›¾ï¼Œç®€ç§°æµç¨‹å›¾ï¼Œåœ¨å›¾ä¸­æˆ‘ç”¨åºå·ç»™ä½ æ ‡è¯†äº†æ ¸å¿ƒæµç¨‹ã€‚</p><p>æˆ‘å°†ç»“åˆæµç¨‹å›¾ã€åé¢çš„Raftçš„æ—¥å¿—å›¾å’Œä½ ç®€è¦åˆ†æLeader Bæ”¶åˆ°put helloä¸ºworldçš„è¯·æ±‚åï¼Œæ˜¯å¦‚ä½•å°†æ­¤è¯·æ±‚åŒæ­¥ç»™å…¶ä»–FollowerèŠ‚ç‚¹çš„ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a5/83/a57a990cff7ca0254368d6351ae5b983.png?wh=1920*1327\" alt=\"\"></p><p>é¦–å…ˆLeaderæ”¶åˆ°clientçš„è¯·æ±‚åï¼Œetcdserverçš„KVæ¨¡å—ä¼šå‘Raftæ¨¡å—æäº¤ä¸€ä¸ªput helloä¸ºworldææ¡ˆæ¶ˆæ¯ï¼ˆæµç¨‹å›¾ä¸­çš„åºå·2æµç¨‹ï¼‰ï¼Œ  å®ƒçš„æ¶ˆæ¯ç±»å‹æ˜¯MsgPropã€‚</p><p>Leaderçš„Raftæ¨¡å—è·å–åˆ°MsgPropææ¡ˆæ¶ˆæ¯åï¼Œä¸ºæ­¤ææ¡ˆç”Ÿæˆä¸€ä¸ªæ—¥å¿—æ¡ç›®ï¼Œè¿½åŠ åˆ°æœªæŒä¹…åŒ–ã€ä¸ç¨³å®šçš„Raftæ—¥å¿—ä¸­ï¼Œéšåä¼šéå†é›†ç¾¤Followeråˆ—è¡¨å’Œè¿›åº¦ä¿¡æ¯ï¼Œä¸ºæ¯ä¸ªFollowerç”Ÿæˆè¿½åŠ ï¼ˆMsgAppï¼‰ç±»å‹çš„RPCæ¶ˆæ¯ï¼Œæ­¤æ¶ˆæ¯ä¸­åŒ…å«å¾…å¤åˆ¶ç»™Followerçš„æ—¥å¿—æ¡ç›®ã€‚</p><p>è¿™é‡Œå°±å‡ºç°ä¸¤ä¸ªç–‘é—®äº†ã€‚ç¬¬ä¸€ï¼ŒLeaderæ˜¯å¦‚ä½•çŸ¥é“ä»å“ªä¸ªç´¢å¼•ä½ç½®å‘é€æ—¥å¿—æ¡ç›®ç»™Followerï¼Œä»¥åŠFollowerå·²å¤åˆ¶çš„æ—¥å¿—æœ€å¤§ç´¢å¼•æ˜¯å¤šå°‘å‘¢ï¼Ÿç¬¬äºŒï¼Œæ—¥å¿—æ¡ç›®ä»€ä¹ˆæ—¶å€™æ‰ä¼šè¿½åŠ åˆ°ç¨³å®šçš„Raftæ—¥å¿—ä¸­å‘¢ï¼ŸRaftæ¨¡å—è´Ÿè´£æŒä¹…åŒ–å—ï¼Ÿ</p><p>é¦–å…ˆæˆ‘æ¥ç»™ä½ ä»‹ç»ä¸‹ä»€ä¹ˆæ˜¯Raftæ—¥å¿—ã€‚ä¸‹å›¾æ˜¯Raftæ—¥å¿—å¤åˆ¶è¿‡ç¨‹ä¸­çš„æ—¥å¿—ç»†èŠ‚å›¾ï¼Œç®€ç§°æ—¥å¿—å›¾1ã€‚</p><p>åœ¨æ—¥å¿—å›¾ä¸­ï¼Œæœ€ä¸Šæ–¹çš„æ˜¯æ—¥å¿—æ¡ç›®åºå·/ç´¢å¼•ï¼Œæ—¥å¿—ç”±æœ‰åºå·æ ‡è¯†çš„ä¸€ä¸ªä¸ªæ¡ç›®ç»„æˆï¼Œæ¯ä¸ªæ—¥å¿—æ¡ç›®å†…å®¹ä¿å­˜äº†Leaderä»»æœŸå·å’Œææ¡ˆå†…å®¹ã€‚æœ€å¼€å§‹çš„æ—¶å€™ï¼ŒAèŠ‚ç‚¹æ˜¯Leaderï¼Œä»»æœŸå·ä¸º1ï¼ŒAèŠ‚ç‚¹crashåï¼ŒBèŠ‚ç‚¹é€šè¿‡é€‰ä¸¾æˆä¸ºæ–°çš„Leaderï¼Œ ä»»æœŸå·ä¸º2ã€‚</p><p>æ—¥å¿—å›¾1æè¿°çš„æ˜¯helloæ—¥å¿—æ¡ç›®æœªæäº¤å‰çš„å„èŠ‚ç‚¹Raftæ—¥å¿—çŠ¶æ€ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/3d/87/3dd2b6042e6e0cc86f96f24764b7f587.png?wh=1920*1003\" alt=\"\"></p><p>æˆ‘ä»¬ç°åœ¨å°±å¯ä»¥æ¥å›ç­”ç¬¬ä¸€ä¸ªç–‘é—®äº†ã€‚Leaderä¼šç»´æŠ¤ä¸¤ä¸ªæ ¸å¿ƒå­—æ®µæ¥è¿½è¸ªå„ä¸ªFollowerçš„è¿›åº¦ä¿¡æ¯ï¼Œä¸€ä¸ªå­—æ®µæ˜¯NextIndexï¼Œ å®ƒè¡¨ç¤ºLeaderå‘é€ç»™FollowerèŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªæ—¥å¿—æ¡ç›®ç´¢å¼•ã€‚ä¸€ä¸ªå­—æ®µæ˜¯MatchIndexï¼Œ å®ƒè¡¨ç¤ºFollowerèŠ‚ç‚¹å·²å¤åˆ¶çš„æœ€å¤§æ—¥å¿—æ¡ç›®çš„ç´¢å¼•ï¼Œæ¯”å¦‚ä¸Šé¢çš„æ—¥å¿—å›¾1ä¸­CèŠ‚ç‚¹çš„å·²å¤åˆ¶æœ€å¤§æ—¥å¿—æ¡ç›®ç´¢å¼•ä¸º5ï¼ŒAèŠ‚ç‚¹ä¸º4ã€‚</p><p>æˆ‘ä»¬å†çœ‹ç¬¬äºŒä¸ªç–‘é—®ã€‚etcd Raftæ¨¡å—è®¾è®¡å®ç°ä¸ŠæŠ½è±¡äº†ç½‘ç»œã€å­˜å‚¨ã€æ—¥å¿—ç­‰æ¨¡å—ï¼Œå®ƒæœ¬èº«å¹¶ä¸ä¼šè¿›è¡Œç½‘ç»œã€å­˜å‚¨ç›¸å…³çš„æ“ä½œï¼Œä¸Šå±‚åº”ç”¨éœ€ç»“åˆè‡ªå·±ä¸šåŠ¡åœºæ™¯é€‰æ‹©å†…ç½®çš„æ¨¡å—æˆ–è‡ªå®šä¹‰å®ç°ç½‘ç»œã€å­˜å‚¨ã€æ—¥å¿—ç­‰æ¨¡å—ã€‚</p><p>ä¸Šå±‚åº”ç”¨é€šè¿‡Raftæ¨¡å—çš„è¾“å‡ºæ¥å£ï¼ˆå¦‚Readyç»“æ„ï¼‰ï¼Œè·å–åˆ°å¾…æŒä¹…åŒ–çš„æ—¥å¿—æ¡ç›®å’Œå¾…å‘é€ç»™PeerèŠ‚ç‚¹çš„æ¶ˆæ¯åï¼ˆå¦‚ä¸Šé¢çš„MsgAppæ—¥å¿—æ¶ˆæ¯ï¼‰ï¼Œéœ€æŒä¹…åŒ–æ—¥å¿—æ¡ç›®åˆ°è‡ªå®šä¹‰çš„WALæ¨¡å—ï¼Œé€šè¿‡è‡ªå®šä¹‰çš„ç½‘ç»œæ¨¡å—å°†æ¶ˆæ¯å‘é€ç»™PeerèŠ‚ç‚¹ã€‚</p><p>æ—¥å¿—æ¡ç›®æŒä¹…åŒ–åˆ°ç¨³å®šå­˜å‚¨ä¸­åï¼Œè¿™æ—¶å€™ä½ å°±å¯ä»¥å°†æ—¥å¿—æ¡ç›®è¿½åŠ åˆ°ç¨³å®šçš„Raftæ—¥å¿—ä¸­ã€‚å³ä¾¿è¿™ä¸ªæ—¥å¿—æ˜¯å†…å­˜å­˜å‚¨ï¼ŒèŠ‚ç‚¹é‡å¯æ—¶ä¹Ÿä¸ä¼šä¸¢å¤±ä»»ä½•æ—¥å¿—æ¡ç›®ï¼Œå› ä¸ºWALæ¨¡å—å·²æŒä¹…åŒ–æ­¤æ—¥å¿—æ¡ç›®ï¼Œå¯é€šè¿‡å®ƒé‡å»ºRaftæ—¥å¿—ã€‚</p><p>etcd Raftæ¨¡å—æä¾›äº†ä¸€ä¸ªå†…ç½®çš„å†…å­˜å­˜å‚¨ï¼ˆMemoryStorageï¼‰æ¨¡å—å®ç°ï¼Œetcdä½¿ç”¨çš„å°±æ˜¯å®ƒï¼ŒRaftæ—¥å¿—æ¡ç›®ä¿å­˜åœ¨å†…å­˜ä¸­ã€‚ç½‘ç»œæ¨¡å—å¹¶æœªæä¾›å†…ç½®çš„å®ç°ï¼ŒetcdåŸºäºHTTPåè®®å®ç°äº†peerèŠ‚ç‚¹é—´çš„ç½‘ç»œé€šä¿¡ï¼Œå¹¶æ ¹æ®æ¶ˆæ¯ç±»å‹ï¼Œæ”¯æŒé€‰æ‹©pipelineã€streamç­‰æ¨¡å¼å‘é€ï¼Œæ˜¾è‘—æé«˜äº†ç½‘ç»œååé‡ã€é™ä½äº†å»¶æ—¶ã€‚</p><p>è§£ç­”å®Œä»¥ä¸Šä¸¤ä¸ªç–‘é—®åï¼Œæˆ‘ä»¬ç»§ç»­åˆ†æetcdæ˜¯å¦‚ä½•ä¸Raftæ¨¡å—äº¤äº’ï¼Œè·å–å¾…æŒä¹…åŒ–çš„æ—¥å¿—æ¡ç›®å’Œå‘é€ç»™peerèŠ‚ç‚¹çš„æ¶ˆæ¯ã€‚</p><p>æ­£å¦‚åˆšåˆšè®²åˆ°çš„ï¼ŒRaftæ¨¡å—è¾“å…¥æ˜¯Msgæ¶ˆæ¯ï¼Œè¾“å‡ºæ˜¯ä¸€ä¸ªReadyç»“æ„ï¼Œå®ƒåŒ…å«å¾…æŒä¹…åŒ–çš„æ—¥å¿—æ¡ç›®ã€å‘é€ç»™peerèŠ‚ç‚¹çš„æ¶ˆæ¯ã€å·²æäº¤çš„æ—¥å¿—æ¡ç›®å†…å®¹ã€çº¿æ€§æŸ¥è¯¢ç»“æœç­‰Raftè¾“å‡ºæ ¸å¿ƒä¿¡æ¯ã€‚</p><p>etcdserveræ¨¡å—é€šè¿‡channelä»Raftæ¨¡å—è·å–åˆ°Readyç»“æ„åï¼ˆæµç¨‹å›¾ä¸­çš„åºå·3æµç¨‹ï¼‰ï¼Œå› BèŠ‚ç‚¹æ˜¯Leaderï¼Œå®ƒé¦–å…ˆä¼šé€šè¿‡åŸºäºHTTPåè®®çš„ç½‘ç»œæ¨¡å—å°†è¿½åŠ æ—¥å¿—æ¡ç›®æ¶ˆæ¯ï¼ˆMsgAppï¼‰å¹¿æ’­ç»™Followerï¼Œå¹¶åŒæ—¶å°†å¾…æŒä¹…åŒ–çš„æ—¥å¿—æ¡ç›®æŒä¹…åŒ–åˆ°WALæ–‡ä»¶ä¸­ï¼ˆæµç¨‹å›¾ä¸­çš„åºå·4æµç¨‹ï¼‰ï¼Œæœ€åå°†æ—¥å¿—æ¡ç›®è¿½åŠ åˆ°ç¨³å®šçš„Raftæ—¥å¿—å­˜å‚¨ä¸­ï¼ˆæµç¨‹å›¾ä¸­çš„åºå·5æµç¨‹ï¼‰ã€‚</p><p>å„ä¸ªFolloweræ”¶åˆ°è¿½åŠ æ—¥å¿—æ¡ç›®ï¼ˆMsgAppï¼‰æ¶ˆæ¯ï¼Œå¹¶é€šè¿‡å®‰å…¨æ£€æŸ¥åï¼Œå®ƒä¼šæŒä¹…åŒ–æ¶ˆæ¯åˆ°WALæ—¥å¿—ä¸­ï¼Œå¹¶å°†æ¶ˆæ¯è¿½åŠ åˆ°Raftæ—¥å¿—å­˜å‚¨ï¼Œéšåä¼šå‘Leaderå›å¤ä¸€ä¸ªåº”ç­”è¿½åŠ æ—¥å¿—æ¡ç›®ï¼ˆMsgAppRespï¼‰çš„æ¶ˆæ¯ï¼Œå‘ŠçŸ¥Leaderå½“å‰å·²å¤åˆ¶çš„æ—¥å¿—æœ€å¤§ç´¢å¼•ï¼ˆæµç¨‹å›¾ä¸­çš„åºå·6æµç¨‹ï¼‰ã€‚</p><p>Leaderæ”¶åˆ°åº”ç­”è¿½åŠ æ—¥å¿—æ¡ç›®ï¼ˆMsgAppRespï¼‰æ¶ˆæ¯åï¼Œä¼šå°†Followerå›å¤çš„å·²å¤åˆ¶æ—¥å¿—æœ€å¤§ç´¢å¼•æ›´æ–°åˆ°è·Ÿè¸ªFollowerè¿›å±•çš„Match Indexå­—æ®µï¼Œå¦‚ä¸‹é¢çš„æ—¥å¿—å›¾2ä¸­çš„Follower C MatchIndexä¸º6ï¼ŒFollower Aä¸º5ï¼Œæ—¥å¿—å›¾2æè¿°çš„æ˜¯helloæ—¥å¿—æ¡ç›®æäº¤åçš„å„èŠ‚ç‚¹Raftæ—¥å¿—çŠ¶æ€ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/eb/63/ebbf739a94f9300a85f21da7e55f1e63.png?wh=1920*994\" alt=\"\"></p><p>æœ€åLeaderæ ¹æ®Followerçš„MatchIndexä¿¡æ¯ï¼Œè®¡ç®—å‡ºä¸€ä¸ªä½ç½®ï¼Œå¦‚æœè¿™ä¸ªä½ç½®å·²ç»è¢«ä¸€åŠä»¥ä¸ŠèŠ‚ç‚¹æŒä¹…åŒ–ï¼Œé‚£ä¹ˆè¿™ä¸ªä½ç½®ä¹‹å‰çš„æ—¥å¿—æ¡ç›®éƒ½å¯ä»¥è¢«æ ‡è®°ä¸ºå·²æäº¤ã€‚</p><p>åœ¨æˆ‘ä»¬è¿™ä¸ªæ¡ˆä¾‹ä¸­æ—¥å¿—å›¾2é‡Œ6å·ç´¢å¼•ä½ç½®ä¹‹å‰çš„æ—¥å¿—æ¡ç›®å·²è¢«å¤šæ•°èŠ‚ç‚¹å¤åˆ¶ï¼Œé‚£ä¹ˆä»–ä»¬çŠ¶æ€éƒ½å¯è¢«è®¾ç½®ä¸ºå·²æäº¤ã€‚Leaderå¯é€šè¿‡åœ¨å‘é€å¿ƒè·³æ¶ˆæ¯ï¼ˆMsgHeartbeatï¼‰ç»™FollowerèŠ‚ç‚¹æ—¶ï¼Œå‘ŠçŸ¥å®ƒå·²ç»æäº¤çš„æ—¥å¿—ç´¢å¼•ä½ç½®ã€‚</p><p>æœ€åå„ä¸ªèŠ‚ç‚¹çš„etcdserveræ¨¡å—ï¼Œå¯é€šè¿‡channelä»Raftæ¨¡å—è·å–åˆ°å·²æäº¤çš„æ—¥å¿—æ¡ç›®ï¼ˆæµç¨‹å›¾ä¸­çš„åºå·7æµç¨‹ï¼‰ï¼Œåº”ç”¨æ—¥å¿—æ¡ç›®å†…å®¹åˆ°å­˜å‚¨çŠ¶æ€æœºï¼ˆæµç¨‹å›¾ä¸­çš„åºå·8æµç¨‹ï¼‰ï¼Œè¿”å›ç»“æœç»™clientã€‚</p><p>é€šè¿‡ä»¥ä¸Šæµç¨‹ï¼ŒLeaderå°±å®Œæˆäº†åŒæ­¥æ—¥å¿—æ¡ç›®ç»™Followerçš„ä»»åŠ¡ï¼Œä¸€ä¸ªæ—¥å¿—æ¡ç›®è¢«ç¡®å®šä¸ºå·²æäº¤çš„å‰ææ˜¯ï¼Œå®ƒéœ€è¦è¢«LeaderåŒæ­¥åˆ°ä¸€åŠä»¥ä¸ŠèŠ‚ç‚¹ä¸Šã€‚ä»¥ä¸Šå°±æ˜¯etcd Raftæ—¥å¿—å¤åˆ¶çš„æ ¸å¿ƒåŸç†ã€‚</p><h2>å®‰å…¨æ€§</h2><p>ä»‹ç»å®ŒLeaderé€‰ä¸¾å’Œæ—¥å¿—å¤åˆ¶åï¼Œæœ€åæˆ‘ä»¬å†æ¥çœ‹çœ‹Raftæ˜¯å¦‚ä½•ä¿è¯å®‰å…¨æ€§çš„ã€‚</p><p>å¦‚æœåœ¨ä¸Šé¢çš„æ—¥å¿—å›¾2ä¸­ï¼ŒLeader Båœ¨åº”ç”¨æ—¥å¿—æŒ‡ä»¤put helloä¸ºworldåˆ°çŠ¶æ€æœºï¼Œå¹¶è¿”å›ç»™clientæˆåŠŸåï¼Œçªç„¶crashäº†ï¼Œé‚£ä¹ˆFollower Aå’ŒCæ˜¯å¦éƒ½æœ‰èµ„æ ¼é€‰ä¸¾æˆä¸ºLeaderå‘¢ï¼Ÿ</p><p>ä»æ—¥å¿—å›¾2ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœAæˆä¸ºäº†Leaderé‚£ä¹ˆå°±ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±ï¼Œå› ä¸ºå®ƒå¹¶æœªå«æœ‰åˆšåˆšclientå·²ç»å†™å…¥æˆåŠŸçš„put helloä¸ºworldæŒ‡ä»¤ã€‚</p><p>Raftç®—æ³•å¦‚ä½•ç¡®ä¿é¢å¯¹è¿™ç±»é—®é¢˜æ—¶ä¸ä¸¢æ•°æ®å’Œå„èŠ‚ç‚¹æ•°æ®ä¸€è‡´æ€§å‘¢ï¼Ÿ</p><p>è¿™å°±æ˜¯Raftçš„ç¬¬ä¸‰ä¸ªå­é—®é¢˜éœ€è¦è§£å†³çš„ã€‚Rafté€šè¿‡ç»™é€‰ä¸¾å’Œæ—¥å¿—å¤åˆ¶å¢åŠ ä¸€ç³»åˆ—è§„åˆ™ï¼Œæ¥å®ç°Raftç®—æ³•çš„å®‰å…¨æ€§ã€‚</p><h3>é€‰ä¸¾è§„åˆ™</h3><p>å½“èŠ‚ç‚¹æ”¶åˆ°é€‰ä¸¾æŠ•ç¥¨çš„æ—¶å€™ï¼Œéœ€æ£€æŸ¥å€™é€‰è€…çš„æœ€åä¸€æ¡æ—¥å¿—ä¸­çš„ä»»æœŸå·ï¼Œè‹¥å°äºè‡ªå·±åˆ™æ‹’ç»æŠ•ç¥¨ã€‚å¦‚æœä»»æœŸå·ç›¸åŒï¼Œæ—¥å¿—å´æ¯”è‡ªå·±çŸ­ï¼Œä¹Ÿæ‹’ç»ä¸ºå…¶æŠ•ç¥¨ã€‚</p><p>æ¯”å¦‚åœ¨æ—¥å¿—å›¾2ä¸­ï¼ŒFolllower Aå’ŒCä»»æœŸå·ç›¸åŒï¼Œä½†æ˜¯Follower Cçš„æ•°æ®æ¯”Follower Aè¦é•¿ï¼Œé‚£ä¹ˆåœ¨é€‰ä¸¾çš„æ—¶å€™ï¼ŒFollower Cå°†æ‹’ç»æŠ•ç¥¨ç»™Aï¼Œ å› ä¸ºå®ƒçš„æ•°æ®ä¸æ˜¯æœ€æ–°çš„ã€‚</p><p>åŒæ—¶ï¼Œå¯¹äºä¸€ä¸ªç»™å®šçš„ä»»æœŸå·ï¼Œæœ€å¤šåªä¼šæœ‰ä¸€ä¸ªleaderè¢«é€‰ä¸¾å‡ºæ¥ï¼Œleaderçš„è¯ç”Ÿéœ€è·å¾—é›†ç¾¤ä¸€åŠä»¥ä¸Šçš„èŠ‚ç‚¹æ”¯æŒã€‚æ¯ä¸ªèŠ‚ç‚¹åœ¨åŒä¸€ä¸ªä»»æœŸå†…åªèƒ½ä¸ºä¸€ä¸ªèŠ‚ç‚¹æŠ•ç¥¨ï¼ŒèŠ‚ç‚¹éœ€è¦å°†æŠ•ç¥¨ä¿¡æ¯æŒä¹…åŒ–ï¼Œé˜²æ­¢å¼‚å¸¸é‡å¯åå†æŠ•ç¥¨ç»™å…¶ä»–èŠ‚ç‚¹ã€‚</p><p>é€šè¿‡ä»¥ä¸Šè§„åˆ™å°±å¯é˜²æ­¢æ—¥å¿—å›¾2ä¸­çš„Follower AèŠ‚ç‚¹æˆä¸ºLeaderã€‚</p><h3>æ—¥å¿—å¤åˆ¶è§„åˆ™</h3><p>åœ¨æ—¥å¿—å›¾2ä¸­ï¼ŒLeader Bè¿”å›ç»™clientæˆåŠŸåè‹¥çªç„¶crashäº†ï¼Œæ­¤æ—¶å¯èƒ½è¿˜å¹¶æœªå°†6å·æ—¥å¿—æ¡ç›®å·²æäº¤çš„æ¶ˆæ¯é€šçŸ¥åˆ°Follower Aå’ŒCï¼Œé‚£ä¹ˆå¦‚ä½•ç¡®ä¿6å·æ—¥å¿—æ¡ç›®ä¸è¢«æ–°Leaderåˆ é™¤å‘¢ï¼Ÿ åŒæ—¶åœ¨etcdé›†ç¾¤è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒLeaderèŠ‚ç‚¹è‹¥é¢‘ç¹å‘ç”Ÿcrashåï¼Œå¯èƒ½ä¼šå¯¼è‡´FollowerèŠ‚ç‚¹ä¸LeaderèŠ‚ç‚¹æ—¥å¿—æ¡ç›®å†²çªï¼Œå¦‚ä½•ä¿è¯å„ä¸ªèŠ‚ç‚¹çš„åŒRaftæ—¥å¿—ä½ç½®å«æœ‰åŒæ ·çš„æ—¥å¿—æ¡ç›®ï¼Ÿ</p><p>ä»¥ä¸Šå„ç±»å¼‚å¸¸åœºæ™¯çš„å®‰å…¨æ€§æ˜¯é€šè¿‡Raftç®—æ³•ä¸­çš„Leaderå®Œå…¨ç‰¹æ€§å’Œåªé™„åŠ åŸåˆ™ã€æ—¥å¿—åŒ¹é…ç­‰å®‰å…¨æœºåˆ¶æ¥ä¿è¯çš„ã€‚</p><p><strong>Leaderå®Œå…¨ç‰¹æ€§</strong>æ˜¯æŒ‡å¦‚æœæŸä¸ªæ—¥å¿—æ¡ç›®åœ¨æŸä¸ªä»»æœŸå·ä¸­å·²ç»è¢«æäº¤ï¼Œé‚£ä¹ˆè¿™ä¸ªæ¡ç›®å¿…ç„¶å‡ºç°åœ¨æ›´å¤§ä»»æœŸå·çš„æ‰€æœ‰Leaderä¸­ã€‚</p><p>Leaderåªèƒ½è¿½åŠ æ—¥å¿—æ¡ç›®ï¼Œä¸èƒ½åˆ é™¤å·²æŒä¹…åŒ–çš„æ—¥å¿—æ¡ç›®ï¼ˆ<strong>åªé™„åŠ åŸåˆ™</strong>ï¼‰ï¼Œå› æ­¤Follower Cæˆä¸ºæ–°Leaderåï¼Œä¼šå°†å‰ä»»çš„6å·æ—¥å¿—æ¡ç›®å¤åˆ¶åˆ°AèŠ‚ç‚¹ã€‚</p><p>ä¸ºäº†ä¿è¯å„ä¸ªèŠ‚ç‚¹æ—¥å¿—ä¸€è‡´æ€§ï¼ŒRaftç®—æ³•åœ¨è¿½åŠ æ—¥å¿—çš„æ—¶å€™ï¼Œå¼•å…¥äº†ä¸€è‡´æ€§æ£€æŸ¥ã€‚Leaderåœ¨å‘é€è¿½åŠ æ—¥å¿—RPCæ¶ˆæ¯æ—¶ï¼Œä¼šæŠŠæ–°çš„æ—¥å¿—æ¡ç›®ç´§æ¥ç€ä¹‹å‰çš„æ¡ç›®çš„ç´¢å¼•ä½ç½®å’Œä»»æœŸå·åŒ…å«åœ¨é‡Œé¢ã€‚FollowerèŠ‚ç‚¹ä¼šæ£€æŸ¥ç›¸åŒç´¢å¼•ä½ç½®çš„ä»»æœŸå·æ˜¯å¦ä¸Leaderä¸€è‡´ï¼Œä¸€è‡´æ‰èƒ½è¿½åŠ ï¼Œè¿™å°±æ˜¯<strong>æ—¥å¿—åŒ¹é…ç‰¹æ€§</strong>ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯ä¸€ç§å½’çº³æ³•ï¼Œä¸€å¼€å§‹æ—¥å¿—ç©ºæ»¡è¶³åŒ¹é…ç‰¹æ€§ï¼Œéšåæ¯å¢åŠ ä¸€ä¸ªæ—¥å¿—æ¡ç›®æ—¶ï¼Œéƒ½è¦æ±‚ä¸Šä¸€ä¸ªæ—¥å¿—æ¡ç›®ä¿¡æ¯ä¸Leaderä¸€è‡´ï¼Œé‚£ä¹ˆæœ€ç»ˆæ•´ä¸ªæ—¥å¿—é›†è‚¯å®šæ˜¯ä¸€è‡´çš„ã€‚</p><p>é€šè¿‡ä»¥ä¸Šçš„Leaderé€‰ä¸¾é™åˆ¶ã€Leaderå®Œå…¨ç‰¹æ€§ã€åªé™„åŠ åŸåˆ™ã€æ—¥å¿—åŒ¹é…ç­‰å®‰å…¨ç‰¹æ€§ï¼ŒRaftå°±å®ç°äº†ä¸€ä¸ªå¯ä¸¥æ ¼é€šè¿‡æ•°å­¦åè¯æ³•ã€å½’çº³æ³•è¯æ˜çš„é«˜å¯ç”¨ã€ä¸€è‡´æ€§ç®—æ³•ï¼Œä¸ºetcdçš„å®‰å…¨æ€§ä¿é©¾æŠ¤èˆªã€‚</p><h2>å°ç»“</h2><p>æœ€åæˆ‘ä»¬æ¥å°ç»“ä¸‹ä»Šå¤©çš„å†…å®¹ã€‚æˆ‘ä»å¦‚ä½•é¿å…å•ç‚¹æ•…éšœè¯´èµ·ï¼Œç»™ä½ ä»‹ç»äº†åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å®ç°å¤šå‰¯æœ¬æŠ€æœ¯çš„ä¸€ç³»åˆ—æ–¹æ¡ˆï¼Œä»ä¸»ä»å¤åˆ¶åˆ°å»ä¸­å¿ƒåŒ–å¤åˆ¶ã€å†åˆ°çŠ¶æ€æœºã€å…±è¯†ç®—æ³•ï¼Œè®©ä½ äº†è§£äº†å„ä¸ªæ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹ï¼Œä»¥åŠä¸»æµå­˜å‚¨äº§å“çš„é€‰æ‹©ã€‚</p><p>Raftè™½ç„¶è¯ç”Ÿæ™šï¼Œä½†å®ƒå´æ˜¯å…±è¯†ç®—æ³•é‡Œé¢åœ¨å·¥ç¨‹ç•Œåº”ç”¨æœ€å¹¿æ³›çš„ã€‚å®ƒå°†ä¸€ä¸ªå¤æ‚é—®é¢˜æ‹†åˆ†æˆä¸‰ä¸ªå­é—®é¢˜ï¼Œåˆ†åˆ«æ˜¯Leaderé€‰ä¸¾ã€æ—¥å¿—å¤åˆ¶å’Œå®‰å…¨æ€§ã€‚</p><p>Rafté€šè¿‡å¿ƒè·³æœºåˆ¶ã€éšæœºåŒ–ç­‰å®ç°äº†Leaderé€‰ä¸¾ï¼Œåªè¦é›†ç¾¤åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹å­˜æ´»å¯ç›¸äº’é€šä¿¡ï¼Œetcdå°±å¯å¯¹å¤–æä¾›é«˜å¯ç”¨æœåŠ¡ã€‚</p><p>Raftæ—¥å¿—å¤åˆ¶ç¡®ä¿äº†etcdå¤šèŠ‚ç‚¹é—´çš„æ•°æ®ä¸€è‡´æ€§ï¼Œæˆ‘é€šè¿‡ä¸€ä¸ªetcdæ—¥å¿—å¤åˆ¶æ•´ä½“æµç¨‹å›¾ä¸ºä½ è¯¦ç»†ä»‹ç»äº†etcdå†™è¯·æ±‚ä»æäº¤åˆ°Raftæ¨¡å—ï¼Œåˆ°è¢«åº”ç”¨åˆ°çŠ¶æ€æœºæ‰§è¡Œçš„å„ä¸ªæµç¨‹ï¼Œå‰–æäº†æ—¥å¿—å¤åˆ¶çš„æ ¸å¿ƒåŸç†ï¼Œå³ä¸€ä¸ªæ—¥å¿—æ¡ç›®åªæœ‰è¢«LeaderåŒæ­¥åˆ°ä¸€åŠä»¥ä¸ŠèŠ‚ç‚¹ä¸Šï¼Œæ­¤æ—¥å¿—æ¡ç›®æ‰èƒ½ç§°ä¹‹ä¸ºæˆåŠŸå¤åˆ¶ã€å·²æäº¤ã€‚Raftçš„å®‰å…¨æ€§ï¼Œé€šè¿‡å¯¹Leaderé€‰ä¸¾å’Œæ—¥å¿—å¤åˆ¶å¢åŠ ä¸€ç³»åˆ—è§„åˆ™ï¼Œä¿è¯äº†æ•´ä¸ªé›†ç¾¤çš„ä¸€è‡´æ€§ã€å®Œæ•´æ€§ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>å¥½äº†ï¼Œè¿™èŠ‚è¯¾åˆ°è¿™é‡Œä¹Ÿå°±ç»“æŸäº†ï¼Œæœ€åæˆ‘ç»™ä½ ç•™äº†ä¸€ä¸ªæ€è€ƒé¢˜ã€‚</p><p>å“ªäº›åœºæ™¯ä¼šå‡ºç°Followeræ—¥å¿—ä¸Leaderå†²çªï¼Œæˆ‘ä»¬çŸ¥é“etcd WALæ¨¡å—åªèƒ½æŒç»­è¿½åŠ æ—¥å¿—æ¡ç›®ï¼Œé‚£å†²çªåFolloweræ˜¯å¦‚ä½•åˆ é™¤æ— æ•ˆçš„æ—¥å¿—æ¡ç›®å‘¢ï¼Ÿ</p><p>æ„Ÿè°¢ä½ é˜…è¯»ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h2>03æ€è€ƒé¢˜ç­”æ¡ˆ</h2><p>åœ¨ä¸Šä¸€èŠ‚è¯¾ä¸­ï¼Œæˆ‘ç»™å¤§å®¶ç•™äº†ä¸€ä¸ªæ€è€ƒé¢˜ï¼šexpensive requestæ˜¯å¦å½±å“å†™è¯·æ±‚æ€§èƒ½ã€‚è¦ææ‡‚è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¾—å›é¡¾ä¸‹etcdè¯»å†™æ€§èƒ½ä¼˜åŒ–å†å²ã€‚</p><p>åœ¨etcd 3.0ä¸­ï¼Œçº¿æ€§è¯»è¯·æ±‚éœ€è¦èµ°ä¸€éRaftåè®®æŒä¹…åŒ–åˆ°WALæ—¥å¿—ä¸­ï¼Œå› æ­¤è¯»æ€§èƒ½éå¸¸å·®ï¼Œå†™è¯·æ±‚è‚¯å®šä¹Ÿä¼šè¢«å½±å“ã€‚</p><p>åœ¨etcd 3.1ä¸­ï¼Œå¼•å…¥äº†ReadIndexæœºåˆ¶æå‡è¯»æ€§èƒ½ï¼Œè¯»è¯·æ±‚æ— éœ€å†æŒä¹…åŒ–åˆ°WALä¸­ã€‚</p><p>åœ¨etcd 3.2ä¸­,  ä¼˜åŒ–æ€è·¯è½¬ç§»åˆ°äº†MVCC/boltdbæ¨¡å—ï¼Œboltdbçš„äº‹åŠ¡é”ç”±ç²—ç²’åº¦çš„äº’æ–¥é”ï¼Œä¼˜åŒ–æˆè¯»å†™é”ï¼Œå®ç°â€œN reads or 1 writeâ€çš„å¹¶è¡Œï¼ŒåŒæ—¶å¼•å…¥äº†bufferæ¥æå‡ååé‡ã€‚é—®é¢˜å°±å‡ºåœ¨è¿™ä¸ªbufferï¼Œè¯»äº‹åŠ¡ä¼šåŠ è¯»é”ï¼Œå†™äº‹åŠ¡ç»“æŸæ—¶è¦å‡çº§é”æ›´æ–°bufferï¼Œä½†æ˜¯expensive requestå¯¼è‡´è¯»äº‹åŠ¡é•¿æ—¶é—´æŒæœ‰é”ï¼Œæœ€ç»ˆå¯¼è‡´å†™è¯·æ±‚è¶…æ—¶ã€‚</p><p>åœ¨etcd 3.4ä¸­ï¼Œå®ç°äº†å…¨å¹¶å‘è¯»ï¼Œåˆ›å»ºè¯»äº‹åŠ¡çš„æ—¶å€™ä¼šå…¨é‡æ‹·è´buffer, è¯»å†™äº‹åŠ¡ä¸å†å› ä¸ºbufferé˜»å¡ï¼Œå¤§å¤§ç¼“è§£äº†expensive requestå¯¹etcdæ€§èƒ½çš„å½±å“ã€‚å°¤å…¶æ˜¯Kubernetes List Podç­‰èµ„æºåœºæ™¯æ¥è¯´ï¼Œetcdç¨³å®šæ€§æ˜¾è‘—æå‡ã€‚åœ¨åé¢çš„å®è·µç¯‡ä¸­ï¼Œæˆ‘ä¼šå’Œä½ å†æ¬¡æ·±å…¥è®¨è®ºä»¥ä¸Šé—®é¢˜ã€‚</p>","neighbors":{"left":{"article_title":"03 | åŸºç¡€æ¶æ„ï¼šetcdä¸€ä¸ªå†™è¯·æ±‚æ˜¯å¦‚ä½•æ‰§è¡Œçš„ï¼Ÿ","id":336766},"right":{"article_title":"05 | é‰´æƒï¼šå¦‚ä½•ä¿æŠ¤ä½ çš„æ•°æ®å®‰å…¨ï¼Ÿ","id":338524}},"comments":[{"had_liked":false,"id":279445,"user_name":"ç§‘ç²¾","can_delete":false,"product_type":"c1","uid":1808339,"ip_address":"","ucode":"338E135702DD7B","user_header":"https://static001.geekbang.org/account/avatar/00/1b/97/d3/239aa4d5.jpg","comment_is_top":false,"comment_ctime":1613788917,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"280786663157","product_id":100069901,"comment_content":"Raftåˆ†å¸ƒå¼ç®—æ³•ï¼Œæ‰“å¼€è¿æ¥ç©1åˆ†é’Ÿå°±èƒ½å­¦ä¼š<br>http:&#47;&#47;kailing.pub&#47;raft&#47;index.html","like_count":66},{"had_liked":false,"id":276608,"user_name":"mckee","can_delete":false,"product_type":"c1","uid":1066511,"ip_address":"","ucode":"E4DEBB462B93A1","user_header":"https://static001.geekbang.org/account/avatar/00/10/46/0f/f6cfc659.jpg","comment_is_top":false,"comment_ctime":1612030767,"is_pvip":false,"replies":[{"id":"100535","content":"æ€’èµï¼Œä¼˜ç§€ï¼Œè¿˜éœ€è¦è¡¥å……ä¸‹ä¸ºä»€ä¹ˆWALæ¨¡å—åªèƒ½é€šè¿‡è¿½åŠ æ—¥å¿—ï¼Œé‚£å®ƒæ˜¯å¦‚ä½•åˆ é™¤å·²æŒä¹…åŒ–çš„åºŸå¼ƒæ—¥å¿—æ¡ç›®å‘¢ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1612248098,"ip_address":"","comment_id":276608,"utype":1}],"discussion_count":1,"race_medal":0,"score":"104691245871","product_id":100069901,"comment_content":"æ€è€ƒé¢˜ï¼š<br>1.å“ªäº›åœºæ™¯ä¼šå‡ºç° Follower æ—¥å¿—ä¸ Leader å†²çªï¼Ÿ<br>leaderå´©æºƒçš„æƒ…å†µä¸‹å¯èƒ½(å¦‚è€çš„leaderå¯èƒ½è¿˜æ²¡æœ‰å®Œå…¨å¤åˆ¶æ‰€æœ‰çš„æ—¥å¿—æ¡ç›®)ï¼Œå¦‚æœleaderå’Œfollowerå‡ºç°æŒç»­å´©æºƒä¼šåŠ å‰§è¿™ä¸ªç°è±¡ã€‚followerå¯èƒ½ä¼šä¸¢å¤±ä¸€äº›åœ¨æ–°çš„leaderä¸­æœ‰çš„æ—¥å¿—æ¡ç›®ï¼Œä»–ä¹Ÿå¯èƒ½æ‹¥æœ‰ä¸€äº›leaderæ²¡æœ‰çš„æ—¥å¿—æ¡ç›®ï¼Œæˆ–è€…ä¸¤è€…éƒ½å‘ç”Ÿã€‚<br>2.followerå¦‚ä½•åˆ é™¤æ— æ•ˆæ—¥å¿—ï¼Ÿ<br>leaderå¤„ç†ä¸ä¸€è‡´æ˜¯é€šè¿‡å¼ºåˆ¶followerç›´æ¥å¤åˆ¶è‡ªå·±çš„æ—¥å¿—æ¥è§£å†³äº†ã€‚å› æ­¤åœ¨followerä¸­çš„å†²çªçš„æ—¥å¿—æ¡ç›®ä¼šè¢«leaderçš„æ—¥å¿—è¦†ç›–ã€‚leaderä¼šè®°å½•followerçš„æ—¥å¿—å¤åˆ¶è¿›åº¦nextIndexï¼Œå¦‚æœfolloweråœ¨è¿½åŠ æ—¥å¿—æ—¶ä¸€è‡´æ€§æ£€æŸ¥å¤±è´¥ï¼Œå°±ä¼šæ‹’ç»è¯·æ±‚ï¼Œæ­¤æ—¶leaderå°±ä¼šå‡å° nextIndex å€¼å¹¶è¿›è¡Œé‡è¯•ï¼Œæœ€ç»ˆåœ¨æŸä¸ªä½ç½®è®©followerè·Ÿleaderä¸€è‡´ã€‚<br>","like_count":25,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514769,"discussion_content":"æ€’èµï¼Œä¼˜ç§€ï¼Œè¿˜éœ€è¦è¡¥å……ä¸‹ä¸ºä»€ä¹ˆWALæ¨¡å—åªèƒ½é€šè¿‡è¿½åŠ æ—¥å¿—ï¼Œé‚£å®ƒæ˜¯å¦‚ä½•åˆ é™¤å·²æŒä¹…åŒ–çš„åºŸå¼ƒæ—¥å¿—æ¡ç›®å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612248098,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":275858,"user_name":"blentle","can_delete":false,"product_type":"c1","uid":1064679,"ip_address":"","ucode":"AC092609A4942A","user_header":"https://static001.geekbang.org/account/avatar/00/10/3e/e7/261711a5.jpg","comment_is_top":false,"comment_ctime":1611708587,"is_pvip":false,"replies":[{"id":"100093","content":"ä½ æ‰€è¯´çš„è¿™ä¸ªæ—¥å¿—å®Œæ•´åº¦ç›¸å¯¹è¾ƒé«˜çš„èŠ‚ç‚¹ï¼ŒæŠ•ç¥¨æ—¶æœ‰ç«é€‰è§„åˆ™å®‰å…¨é™åˆ¶ï¼Œå¦‚æœå®ƒçš„èŠ‚ç‚¹æ¯”è¾ƒæ–°ä¼šæ‹’ç»æŠ•ç¥¨ï¼Œè‡³äºæœ€ç»ˆå…ˆå‘èµ·é€‰ä¸¾çš„èŠ‚ç‚¹èƒ½å¦èµ¢å¾—é€‰ä¸¾ï¼Œè¦çœ‹å…¶ä»–èŠ‚ç‚¹æ•°æ®æƒ…å†µï¼Œå¦‚æœå¤šæ•°èŠ‚ç‚¹çš„æ•°æ®æ¯”å®ƒæ–°ï¼Œé‚£ä¹ˆå…ˆå‘èµ·é€‰ä¸¾çš„èŠ‚ç‚¹å°±æ— æ³•è·å¾—å¤šæ•°é€‰ç¥¨ï¼Œå¦‚æœ5ä¸ªèŠ‚ç‚¹ä¸­ï¼Œåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹æ•°æ®æ¯”è¾ƒé•¿ï¼Œé‚£çš„ç¡®ä¼šè¢«è¦†ç›–ï¼Œä½†æ˜¯è¿™æ˜¯å®‰å…¨çš„ï¼Œè¯´æ˜è¿™ä¸ªæ•°æ®å¹¶æœªè¢«é›†ç¾¤èŠ‚ç‚¹å¤šæ•°ç¡®è®¤","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1611710756,"ip_address":"","comment_id":275858,"utype":1}],"discussion_count":1,"race_medal":0,"score":"104690923691","product_id":100069901,"comment_content":"è€å¸ˆï¼Œå¦‚æœä¸€ä¸ªæ—¥å¿—å®Œæ•´åº¦ç›¸å¯¹è¾ƒé«˜çš„èŠ‚ç‚¹å› ä¸ºè‡ªå·±éšæœºæ—¶é—´æ¯”å…¶ä»–èŠ‚ç‚¹çš„é•¿ï¼Œæ²¡èƒ½æœ€å…ˆå‘èµ·ç«é€‰ï¼Œå…¶ä»–èŠ‚ç‚¹å½“ä¸ŠleaderååŒæ­¥è‡ªå·±çš„æ—¥å¿—å²‚ä¸æ˜¯å†²çªäº†ï¼Ÿ","like_count":25,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514505,"discussion_content":"ä½ æ‰€è¯´çš„è¿™ä¸ªæ—¥å¿—å®Œæ•´åº¦ç›¸å¯¹è¾ƒé«˜çš„èŠ‚ç‚¹ï¼ŒæŠ•ç¥¨æ—¶æœ‰ç«é€‰è§„åˆ™å®‰å…¨é™åˆ¶ï¼Œå¦‚æœå®ƒçš„èŠ‚ç‚¹æ¯”è¾ƒæ–°ä¼šæ‹’ç»æŠ•ç¥¨ï¼Œè‡³äºæœ€ç»ˆå…ˆå‘èµ·é€‰ä¸¾çš„èŠ‚ç‚¹èƒ½å¦èµ¢å¾—é€‰ä¸¾ï¼Œè¦çœ‹å…¶ä»–èŠ‚ç‚¹æ•°æ®æƒ…å†µï¼Œå¦‚æœå¤šæ•°èŠ‚ç‚¹çš„æ•°æ®æ¯”å®ƒæ–°ï¼Œé‚£ä¹ˆå…ˆå‘èµ·é€‰ä¸¾çš„èŠ‚ç‚¹å°±æ— æ³•è·å¾—å¤šæ•°é€‰ç¥¨ï¼Œå¦‚æœ5ä¸ªèŠ‚ç‚¹ä¸­ï¼Œåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹æ•°æ®æ¯”è¾ƒé•¿ï¼Œé‚£çš„ç¡®ä¼šè¢«è¦†ç›–ï¼Œä½†æ˜¯è¿™æ˜¯å®‰å…¨çš„ï¼Œè¯´æ˜è¿™ä¸ªæ•°æ®å¹¶æœªè¢«é›†ç¾¤èŠ‚ç‚¹å¤šæ•°ç¡®è®¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611710756,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":276203,"user_name":"jeffery","can_delete":false,"product_type":"c1","uid":1219972,"ip_address":"","ucode":"35E2DAA386FB86","user_header":"https://static001.geekbang.org/account/avatar/00/12/9d/84/171b2221.jpg","comment_is_top":false,"comment_ctime":1611829609,"is_pvip":false,"replies":[{"id":"100279","content":"æ„Ÿè°¢ä½ çš„è®¤å¯ï¼Œæœ‰æ”¶è·å°±å¥½ï¼Œæ•°æ®ä¸ä¸€è‡´åŸå› å’Œé«˜å¯ç”¨è¿ç»´æœ€ä½³å®è·µï¼Œå®è·µç¯‡éƒ½æœ‰ï¼Œç¨ç­‰ï¼Œä¸€èµ·å­¦ä¸‹å»ï¼ŒåŠ æ²¹ï¼Œä¿è¯è®©ä½ æ”¶è·æ»¡æ»¡","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1611845398,"ip_address":"","comment_id":276203,"utype":1}],"discussion_count":2,"race_medal":0,"score":"53151437161","product_id":100069901,"comment_content":"è®²çš„å¤ªå¥½äº†ã€å›¾æ–‡å¹¶è²Œã€å½¢è±¡ç”ŸåŠ¨ã€raftè¿™ç« å°±å¤Ÿæœ¬äº†ï¼è€å¸ˆé—®ä¸‹.es ä¹Ÿç”¨raftï¼ä¸ºå•¥ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´æ€§ï¼Ÿéƒ¨ç½²etcdé«˜å¯ç”¨æœ‰è¿ç»´æœ‰æœ€ä½³å®è·µå»ºè®®å—ï¼Ÿè°¢è°¢è€å¸ˆ","like_count":12,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514628,"discussion_content":"æ„Ÿè°¢ä½ çš„è®¤å¯ï¼Œæœ‰æ”¶è·å°±å¥½ï¼Œæ•°æ®ä¸ä¸€è‡´åŸå› å’Œé«˜å¯ç”¨è¿ç»´æœ€ä½³å®è·µï¼Œå®è·µç¯‡éƒ½æœ‰ï¼Œç¨ç­‰ï¼Œä¸€èµ·å­¦ä¸‹å»ï¼ŒåŠ æ²¹ï¼Œä¿è¯è®©ä½ æ”¶è·æ»¡æ»¡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611845398,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2243398,"avatar":"https://static001.geekbang.org/account/avatar/00/22/3b/46/3701e908.jpg","nickname":"Coder","note":"","ucode":"170190542A5A9C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":346019,"discussion_content":"åŒæ„ŸğŸ‘ğŸ‘","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1611839689,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":276007,"user_name":"å†™ç‚¹å•¥å‘¢","can_delete":false,"product_type":"c1","uid":1065272,"ip_address":"","ucode":"C19032CF1C41BA","user_header":"https://static001.geekbang.org/account/avatar/00/10/41/38/4f89095b.jpg","comment_is_top":false,"comment_ctime":1611742580,"is_pvip":false,"replies":[{"id":"100283","content":"å¥½é—®é¢˜ï¼Œç¬¬ä¸€ä¸ªé—®é¢˜ä¸èƒ½è¯´æ˜¯æ•°æ®ä¸¢å¤±ï¼Œæ­£å¦‚ä½ æ‰€è¯´çš„ï¼Œå¯èƒ½å­˜åœ¨ä¸€ä¸ªæ–°æ—¥å¿—æ¡ç›®ï¼Œè¿™äº›å¼‚å¸¸é‡å¯åçš„followerä¸­æ²¡æœ‰ï¼Œå› ä¸ºå¼‚å¸¸çš„followeræ•°è¾¾åˆ°äº†æ³•å®šæ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–°æ—¥å¿—æ¡ç›®è‚¯å®šæ²¡åŒæ­¥åˆ°å¤šæ•°èŠ‚ç‚¹ä¸Šï¼Œå› æ­¤æ˜¯åˆç†çš„ã€‚<br>ç¬¬äºŒä¸ªé—®é¢˜ï¼Œçœ‹è½åæ•°æ®ç¨‹åº¦ï¼Œé€šè¿‡å†…å­˜ä¸­çš„raft logå’Œå¿«ç…§æ–‡ä»¶è¿½èµ¶ï¼Œå› ç¯‡å¹…å…³ç³»ï¼Œæœªä»‹ç»æ—¥å¿—å‹ç¼©å’Œå¿«ç…§ï¼Œåé¢æˆ‘æ ¹æ®æƒ…å†µæ˜¯å¦å•ç‹¬åŠ é¤ç¯‡ã€‚å¦‚æœæäº¤è¿‡ç¨‹ä¸­ï¼Œä¸èƒ½è¾¾åˆ°æ³•å®šæ•°ï¼Œè¿™æ—¶ä¼šè¶…æ—¶ï¼Œä¾èµ–å®¢æˆ·ç«¯é‡è¯•<br>ç¬¬ä¸‰ä¸ªé—®é¢˜ï¼Œæè¿°å¯ä»¥æ›´è¯¦ç»†ç‚¹å—ï¼Œæ²¡å¤ªæ‡‚ï¼ŒæŒ‰æˆ‘åˆæ­¥ç†è§£å›ç­”ä¸‹ï¼Œå…¶ä»–èŠ‚ç‚¹æ”¶åˆ°æ­¤æ—¥å¿—æ¡ç›®åä¼šæŒä¹…åŒ–ï¼Œé€‰å‡ºleaderä¹Ÿæœ‰æ­¤æ¡è®°å½•ï¼Œæ–°è€leaderå¦‚æœæ•°æ®æœ‰å†²çªï¼Œä»¥æ–°leaderä¸ºå‡†<br>","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1611846716,"ip_address":"","comment_id":276007,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35971480948","product_id":100069901,"comment_content":"å…³äºé€‰ä¸¾è¿‡ç¨‹å’ŒèŠ‚ç‚¹å´©æºƒåæ¢å¤æœ‰å‡ ä¸ªé—®é¢˜è¯·æ•™è€å¸ˆï¼š<br>1. å¦‚æœå¤šæ•°followerå´©æºƒåé‡å¯æ¢å¤ï¼ˆæ¯”å¦‚æç«¯æƒ…å†µåªå‰©ä¸‹Leaderå…¶å®ƒfolloweråŒæ—¶é‡å¯ï¼‰ï¼Œæ ¹æ®é€‰ä¸¾è§„åˆ™æ˜¯ä¸æ˜¯ä¼šå‡ºç°é‡å¯followerå å¤šæ•°æŠ•ç¥¨ç»™äº†ä¸€ä¸ªæ•°æ®ä¸æ˜¯æœ€æ–°çš„èŠ‚ç‚¹è€Œå¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚æˆ‘ç†è§£è¿™ç§æƒ…å†µä¸æ»¡è¶³æ³•å®šç¥¨ç®—æ³•å‰æï¼Œæ‰€ä»¥æ˜¯æ— æ³•ä¿éšœæ•°æ®ä¸€è‡´çš„ã€‚<br>2. å¯¹äºå°‘æ•°èŠ‚ç‚¹å´©æºƒæ¢å¤åï¼Œå®ƒæ˜¯å¦‚ä½•è¿½ä¸Šleaderçš„æœ€æ–°æ•°æ®çš„å‘¢ï¼Ÿæ¯”å¦‚å¯¹äºæ—¥å¿—å¤åˆ¶è¿‡ç¨‹ï¼Œleaderå®Œæˆè‡ªèº«çš„WALåŠraftæ—¥å¿—ç„¶åå‘é€MsgAppï¼Œä½†æ˜¯å…¶å®ƒfolloweræ²¡æœ‰æ¥å¾—åŠå‘é€MsgRespå°±å´©æºƒäº†ï¼Œé‚£ä¹ˆè¿™æ¡raftæ—¥å¿—å…¶å®æ²¡æœ‰å¾—åˆ°æ³•å®šç¥¨æ•°çš„æäº¤ä¿¡æ¯ï¼Œraftæ¨¡å—åº”è¯¥é€šè¿‡ä»€ä¹ˆæ–¹å¼æ¥è®©followeræ¢å¤è¿™ä»½æ•°æ®ï¼Œè®©å®ƒèƒ½å¤Ÿæœ€ç»ˆåœ¨æ¢å¤çš„èŠ‚ç‚¹å¾—åˆ°æ³•å®šç¥¨æ•°æäº¤ï¼Œç„¶ååº”ç”¨åˆ°ä¸Šå±‚çŠ¶æ€æœºï¼Ÿ<br>3.  å¦‚æœåœ¨å†™æ•°æ®è¿‡ç¨‹ä¸­leaderå´©æºƒäº†ã€‚æ¯”å¦‚åœ¨leaderå®Œæˆè‡ªèº«WALå¹¶å‘é€MsgAppåå´©æºƒäº†ï¼Œæœ¬æ¬¡å†™ææ¡ˆæ²¡æœ‰å®Œæˆï¼Œé‡æ–°é€‰leaderä¹‹åæ–°leaderæœ‰è¿™æ¬¡å†™è®°å½•çš„logï¼Œå®ƒä¼šæ€ä¹ˆæ¢å¤æ•°æ®ï¼Ÿ<br><br>è°¢è°¢è€å¸ˆ","like_count":8,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514565,"discussion_content":"å¥½é—®é¢˜ï¼Œç¬¬ä¸€ä¸ªé—®é¢˜ä¸èƒ½è¯´æ˜¯æ•°æ®ä¸¢å¤±ï¼Œæ­£å¦‚ä½ æ‰€è¯´çš„ï¼Œå¯èƒ½å­˜åœ¨ä¸€ä¸ªæ–°æ—¥å¿—æ¡ç›®ï¼Œè¿™äº›å¼‚å¸¸é‡å¯åçš„followerä¸­æ²¡æœ‰ï¼Œå› ä¸ºå¼‚å¸¸çš„followeræ•°è¾¾åˆ°äº†æ³•å®šæ•°ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–°æ—¥å¿—æ¡ç›®è‚¯å®šæ²¡åŒæ­¥åˆ°å¤šæ•°èŠ‚ç‚¹ä¸Šï¼Œå› æ­¤æ˜¯åˆç†çš„ã€‚\nç¬¬äºŒä¸ªé—®é¢˜ï¼Œçœ‹è½åæ•°æ®ç¨‹åº¦ï¼Œé€šè¿‡å†…å­˜ä¸­çš„raft logå’Œå¿«ç…§æ–‡ä»¶è¿½èµ¶ï¼Œå› ç¯‡å¹…å…³ç³»ï¼Œæœªä»‹ç»æ—¥å¿—å‹ç¼©å’Œå¿«ç…§ï¼Œåé¢æˆ‘æ ¹æ®æƒ…å†µæ˜¯å¦å•ç‹¬åŠ é¤ç¯‡ã€‚å¦‚æœæäº¤è¿‡ç¨‹ä¸­ï¼Œä¸èƒ½è¾¾åˆ°æ³•å®šæ•°ï¼Œè¿™æ—¶ä¼šè¶…æ—¶ï¼Œä¾èµ–å®¢æˆ·ç«¯é‡è¯•\nç¬¬ä¸‰ä¸ªé—®é¢˜ï¼Œæè¿°å¯ä»¥æ›´è¯¦ç»†ç‚¹å—ï¼Œæ²¡å¤ªæ‡‚ï¼ŒæŒ‰æˆ‘åˆæ­¥ç†è§£å›ç­”ä¸‹ï¼Œå…¶ä»–èŠ‚ç‚¹æ”¶åˆ°æ­¤æ—¥å¿—æ¡ç›®åä¼šæŒä¹…åŒ–ï¼Œé€‰å‡ºleaderä¹Ÿæœ‰æ­¤æ¡è®°å½•ï¼Œæ–°è€leaderå¦‚æœæ•°æ®æœ‰å†²çªï¼Œä»¥æ–°leaderä¸ºå‡†\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611846716,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":276310,"user_name":"å†™ç‚¹å•¥å‘¢","can_delete":false,"product_type":"c1","uid":1065272,"ip_address":"","ucode":"C19032CF1C41BA","user_header":"https://static001.geekbang.org/account/avatar/00/10/41/38/4f89095b.jpg","comment_is_top":false,"comment_ctime":1611883981,"is_pvip":false,"replies":[{"id":"100295","content":"é¦–å…ˆåœ¨raftä¸­å¹¶æ²¡æœ‰ä»€ä¹ˆæ•°æ®ç»“æ„æ¥ä¿å­˜ææ¡ˆçŠ¶æ€ï¼Œleaderåªç»´æŠ¤äº†ä¸€ä¸ªcommitted index, å®ƒè¡¨ç¤ºè¿™ä¸ªindexä¹‹å‰çš„æ—¥å¿—æ¡ç›®å·²è¢«æˆåŠŸåŒæ­¥åˆ°äº†å¤§å¤šæ•°followerèŠ‚ç‚¹ã€‚å½“åŸleader crashåï¼Œå…¶ä»–followerèŠ‚ç‚¹é€‰ä¸¾å‡ºæ–°leader, æŒ‰ç…§raftå®‰å…¨æ€§åŸåˆ™ï¼Œå®ƒæ˜¯ä¸èƒ½åˆ é™¤å‰ä»»leaderçš„ä»»ä½•æ—¥å¿—æ¡ç›®ï¼Œå› leader crashå‰è¿™æ¡æ—¥å¿—æ¡ç›®å·²ç»è¢«æŒä¹…åŒ–åˆ°äº†å¤šæ•°followerèŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆfollowerèŠ‚ç‚¹é€‰ä¸¾å‡ºæ–°leaderåï¼Œå®ƒå«æœ‰è¿™æ¡æ—¥å¿—æ¡ç›®ï¼Œå¹¶ä¸”å¤šæ•°èŠ‚ç‚¹å·²ç»åŒæ­¥äº†ï¼Œé‚£ä¹ˆå¯¹æ–°leaderè€Œè¨€ï¼Œå®ƒçš„çŠ¶æ€å°±æ˜¯å·²æäº¤ï¼Œå¯ä»¥ç›´æ¥æäº¤ç»™çŠ¶æ€æœºæ¨¡å—æ‰§è¡Œã€‚å¯¹clientè€Œè¨€ï¼Œè™½ç„¶å†™è¯·æ±‚è¶…æ—¶äº†ï¼Œä½†æœ€ç»ˆå®ƒçš„ææ¡ˆæ˜¯æˆåŠŸæ‰§è¡Œçš„ï¼Œclientéœ€è¦è‡ªå·±ç¡®ä¿å¹‚ç­‰æ€§ï¼Œä¹Ÿå°±æ˜¯å†™è¶…æ—¶åï¼Œä½ çš„æäº¤å¯èƒ½æ˜¯æˆåŠŸçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1611888882,"ip_address":"","comment_id":276310,"utype":1}],"discussion_count":5,"race_medal":0,"score":"18791753165","product_id":100069901,"comment_content":"è°¢è°¢è€å¸ˆçš„å›ç­”ï¼Œå…³äºç¬¬ä¸‰ä¸ªé—®é¢˜ï¼Œâ€œ3. å¦‚æœåœ¨å†™æ•°æ®è¿‡ç¨‹ä¸­leaderå´©æºƒäº†ã€‚æ¯”å¦‚åœ¨leaderå®Œæˆè‡ªèº«WALå¹¶å‘é€MsgAppåå´©æºƒäº†ï¼Œæœ¬æ¬¡å†™ææ¡ˆæ²¡æœ‰å®Œæˆï¼Œé‡æ–°é€‰leaderä¹‹åæ–°leaderæœ‰è¿™æ¬¡å†™è®°å½•çš„logï¼Œå®ƒä¼šæ€ä¹ˆæ¢å¤æ•°æ®ï¼Ÿâ€ æˆ‘è¯¦ç»†æè¿°ä¸‹ï¼Œè¯·è€å¸ˆå¸®å¿™è§£ç­”ä¸‹ï¼š<br>1. Leaderæ”¶åˆ°ç”¨æˆ·putè¯·æ±‚åï¼Œå®Œæˆè‡ªå·±çš„WALæ—¥å¿—åŠraftæ—¥å¿—æŒä¹…åŒ–åå‘é€MsgAppåˆ°å…¶å®ƒfollowerèŠ‚ç‚¹ã€‚<br>2. å…¶å®ƒfollowerèŠ‚ç‚¹æ¥æ”¶åˆ°MsgAppåä¹Ÿå®Œæˆè‡ªå·±çš„WALåŠraftæ—¥å¿—æ“ä½œã€‚<br>3. æ­¤æ—¶LeaderèŠ‚ç‚¹å´©æºƒäº†ï¼ŒfollowerèŠ‚ç‚¹æ— æ³•å‘é€è‡ªå·±æ—¥å¿—MsgAppRespç»™å·²ç»å´©æºƒçš„Leaderã€‚æ­¤æ—¶é›†ç¾¤å¼€å§‹æ–°ä¸€è½®é€‰ä¸¾å¹¶é€‰å‡ºä¸€ä¸ªLeader<br>4. æ–°çš„Leaderæ¥æ”¶è¿‡ä¹‹å‰çš„putææ¡ˆå¹¶åœ¨æ—¥å¿—ä¸­æ‰¾åˆ°å®ƒï¼Œæ–°çš„Leaderå¦‚ä½•æ¢å¤è¿™æ¡ææ¡ˆåˆ°æäº¤çŠ¶æ€ï¼Ÿæ–°çš„leaderæ˜¯ä¸æ˜¯åœ¨æ—¥å¿—ä¸­çœ‹åˆ°è¿™æ¡æ²¡æœ‰å®Œæˆææ¡ˆåé‡æ–°åœ¨åšä¸€è½®ææ¡ˆï¼Ÿ<br><br>è°¢è°¢è€å¸ˆ<br>","like_count":4,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514657,"discussion_content":"é¦–å…ˆåœ¨raftä¸­å¹¶æ²¡æœ‰ä»€ä¹ˆæ•°æ®ç»“æ„æ¥ä¿å­˜ææ¡ˆçŠ¶æ€ï¼Œleaderåªç»´æŠ¤äº†ä¸€ä¸ªcommitted index, å®ƒè¡¨ç¤ºè¿™ä¸ªindexä¹‹å‰çš„æ—¥å¿—æ¡ç›®å·²è¢«æˆåŠŸåŒæ­¥åˆ°äº†å¤§å¤šæ•°followerèŠ‚ç‚¹ã€‚å½“åŸleader crashåï¼Œå…¶ä»–followerèŠ‚ç‚¹é€‰ä¸¾å‡ºæ–°leader, æŒ‰ç…§raftå®‰å…¨æ€§åŸåˆ™ï¼Œå®ƒæ˜¯ä¸èƒ½åˆ é™¤å‰ä»»leaderçš„ä»»ä½•æ—¥å¿—æ¡ç›®ï¼Œå› leader crashå‰è¿™æ¡æ—¥å¿—æ¡ç›®å·²ç»è¢«æŒä¹…åŒ–åˆ°äº†å¤šæ•°followerèŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆfollowerèŠ‚ç‚¹é€‰ä¸¾å‡ºæ–°leaderåï¼Œå®ƒå«æœ‰è¿™æ¡æ—¥å¿—æ¡ç›®ï¼Œå¹¶ä¸”å¤šæ•°èŠ‚ç‚¹å·²ç»åŒæ­¥äº†ï¼Œé‚£ä¹ˆå¯¹æ–°leaderè€Œè¨€ï¼Œå®ƒçš„çŠ¶æ€å°±æ˜¯å·²æäº¤ï¼Œå¯ä»¥ç›´æ¥æäº¤ç»™çŠ¶æ€æœºæ¨¡å—æ‰§è¡Œã€‚å¯¹clientè€Œè¨€ï¼Œè™½ç„¶å†™è¯·æ±‚è¶…æ—¶äº†ï¼Œä½†æœ€ç»ˆå®ƒçš„ææ¡ˆæ˜¯æˆåŠŸæ‰§è¡Œçš„ï¼Œclientéœ€è¦è‡ªå·±ç¡®ä¿å¹‚ç­‰æ€§ï¼Œä¹Ÿå°±æ˜¯å†™è¶…æ—¶åï¼Œä½ çš„æäº¤å¯èƒ½æ˜¯æˆåŠŸçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611888882,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1229952,"avatar":"https://static001.geekbang.org/account/avatar/00/12/c4/80/264d711e.jpg","nickname":"kun","note":"","ucode":"92E67740AE52ED","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":551466,"discussion_content":"å¦‚æœæ­¤æ—¶clientä¸é‡è¯•ï¼Œé‚£ä¸æ˜¯è¯´æ˜æœ‰è„æ•°æ®æ®‹ç•™äº†ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645021285,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":514657,"ip_address":""},"score":551466,"extra":""}]},{"author":{"id":1795546,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epCnxicMqCiah8lIOZM9oy0VNeWpmv0U8c3kIAgMcntWQPn514jfN6n0LL3VlJqQypQJG3icbUSsTKFQ/132","nickname":"Geek_18a705","note":"","ucode":"41B325020A8E12","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578540,"discussion_content":"æ–°leaderå½“é€‰åï¼Œ åŒ…å«äº†è¿™æ¡è¿˜æ²¡æœ‰è¢«å‰ä»»leader commitçš„logï¼Œä¸€æ—¦å½“é€‰ï¼Œä¼šç«‹å³broadcast append, å½“æ”¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹çš„MsgAppResp åï¼Œ å°è¯•æ›´æ–°commit ID, è¿™æ¡æ²¡è¢«å‰ä»»leader commitçš„log ä¹Ÿå°±è¢«æ–°lead commitäº†ï¼Œä¸çŸ¥é“ç†è§£æ˜¯å¦æ­£ç¡®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656883024,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1133945,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4d/79/803537db.jpg","nickname":"æ…¢åŠ¨ä½œ","note":"","ucode":"62C944F4A4D8AC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381474,"discussion_content":"æ–°leaderä¸èƒ½åˆ é™¤åŸleaderçš„æ—¥å¿—ï¼Œä½†æ˜¯æ–°leaderæœ‰å¯èƒ½æ²¡æœ‰åŒæ­¥åŸleaderçš„æœ€æ–°æ—¥å¿—ï¼Œé‚£åŸleaderçš„æœ€æ–°æ—¥å¿—æ˜¯ä¼šè¢«åˆ é™¤çš„ï¼Ÿè¿™ç§æƒ…å†µä¸‹ï¼Œå®¢æˆ·ç«¯æ˜¯è¶…æ—¶æ–­å¼€ï¼Œå¹¶ä¸”æ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625069913,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1133945,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4d/79/803537db.jpg","nickname":"æ…¢åŠ¨ä½œ","note":"","ucode":"62C944F4A4D8AC","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":551188,"discussion_content":"ä¸ä¼šå‘ç”Ÿçš„ã€‚raftç®—æ³•ä¿è¯é€‰ä¸¾çš„leaderè¦åŒ…å«é›†ç¾¤é‡Œæœ€æ–°çš„æ•°æ®ï¼Œå¦åˆ™ï¼Œä¸ä¼šè¢«é€‰ä¸ºleaderã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644921136,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":381474,"ip_address":""},"score":551188,"extra":""}]}]},{"had_liked":false,"id":276342,"user_name":"Index","can_delete":false,"product_type":"c1","uid":1078909,"ip_address":"","ucode":"815A1A62F846CF","user_header":"https://static001.geekbang.org/account/avatar/00/10/76/7d/04c95885.jpg","comment_is_top":false,"comment_ctime":1611890248,"is_pvip":false,"replies":[{"id":"100311","content":"å—¯ï¼Œetcdç‰¹åˆ«ä¾èµ–ç£ç›˜I&#47;Oæ€§èƒ½ï¼Œæ—¥å¿—æ¡ç›®éœ€è¦åŒæ­¥æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå½“å¿ƒè·³é—´éš”æ˜¯100ms,é€‰ä¸¾è¶…æ—¶æ˜¯1s, å¦‚æœfsync æ—¥å¿—æ¡ç›®WALè€—æ—¶ä¸ç¨³å®šã€æ³¢åŠ¨å¾ˆå¤§ã€è¶…è¿‡1ç§’ï¼Œé‚£é›†ç¾¤å°±ä¼šé¢‘ç¹é€‰ä¸¾ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1611932522,"ip_address":"","comment_id":276342,"utype":1}],"discussion_count":2,"race_medal":0,"score":"14496792136","product_id":100069901,"comment_content":"å…³äºetcdçš„raftå®ç°æºç æœ‰ä¸ªé—®é¢˜<br>func ExampleNode() {<br>\tc := &amp;Config{}<br>\tn := StartNode(c, nil)<br>\tdefer n.Stop()<br><br>\t&#47;&#47; stuff to n happens in other goroutines<br><br>\t&#47;&#47; the last known state<br>\tvar prev pb.HardState<br>\tfor {<br>\t\t&#47;&#47; Ready blocks until there is new state ready.<br>\t\trd := &lt;-n.Ready()<br>\t\tif !isHardStateEqual(prev, rd.HardState) {<br>\t\t\tsaveStateToDisk(rd.HardState)<br>\t\t\tprev = rd.HardState<br>\t\t}<br><br>\t\tsaveToDisk(rd.Entries)<br>\t\tgo applyToStore(rd.CommittedEntries)<br>\t\tsendMessages(rd.Messages)<br>\t}<br>}<br><br>ç½‘ç»œï¼Œå­˜å‚¨éƒ½æ˜¯ç”¨æˆ·è‡ªå·±å®ç°çš„ï¼Œå¦‚æœè¿™é‡Œåœ¨å¤„ç†å­˜å‚¨å’Œå‘é€æ¶ˆæ¯å¾ˆæ…¢ï¼Œè¿™æ ·ä¸ä¼šå½±å“åˆ°å¿ƒè·³å—ï¼Ÿæ¯”å¦‚å¿ƒè·³é»˜è®¤æ˜¯1sï¼Œé‚£å¦‚æœå¤„ç†å­˜å‚¨å’Œç½‘ç»œçš„æ—¶é—´ç»å¸¸è¶…è¿‡1sï¼Œå²‚ä¸æ˜¯å¿ƒè·³å°±æ—¶å¸¸è¶…æ—¶ï¼Œé›†ç¾¤ç»å¸¸å¤„äºé€‰ä¸¾çš„çŠ¶æ€å—ï¼Ÿæ±‚è§£ç­”","like_count":3,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514671,"discussion_content":"å—¯ï¼Œetcdç‰¹åˆ«ä¾èµ–ç£ç›˜I/Oæ€§èƒ½ï¼Œæ—¥å¿—æ¡ç›®éœ€è¦åŒæ­¥æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œå½“å¿ƒè·³é—´éš”æ˜¯100ms,é€‰ä¸¾è¶…æ—¶æ˜¯1s, å¦‚æœfsync æ—¥å¿—æ¡ç›®WALè€—æ—¶ä¸ç¨³å®šã€æ³¢åŠ¨å¾ˆå¤§ã€è¶…è¿‡1ç§’ï¼Œé‚£é›†ç¾¤å°±ä¼šé¢‘ç¹é€‰ä¸¾ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611932522,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1078909,"avatar":"https://static001.geekbang.org/account/avatar/00/10/76/7d/04c95885.jpg","nickname":"Index","note":"","ucode":"815A1A62F846CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":346641,"discussion_content":"çº æ­£é—®é¢˜çš„ä¸€ä¸ªæè¿°ï¼Œå¿ƒè·³é—´éš”100msï¼Œé€‰ä¸¾è¶…æ—¶1sï¼Œä¸æ˜¯å¿ƒè·³1sé—´éš”ã€‚æ˜¯è€å¸ˆè¯´çš„é‚£ä¸ªæ„æ€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612010352,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":275861,"user_name":"æ˜¥é£","can_delete":false,"product_type":"c1","uid":1103971,"ip_address":"","ucode":"76947E35A76C67","user_header":"https://static001.geekbang.org/account/avatar/00/10/d8/63/e4c28138.jpg","comment_is_top":false,"comment_ctime":1611709440,"is_pvip":false,"replies":[{"id":"100095","content":"æ„Ÿè°¢åé¦ˆï¼Œæ˜¯æˆ‘æè¿°ä¸ä¸¥è°¨ï¼Œè®©ä½ è¯¯ä¼šäº†ï¼Œåœ¨ä¸Šæ–‡ä¸­è€çš„Leader A crashåï¼Œé‡å¯ä¼šå˜æˆFollowerèŠ‚ç‚¹ï¼Œå·²å®Œå–„æè¿°ï¼Œè°¢è°¢ä½ ","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1611715253,"ip_address":"","comment_id":275861,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14496611328","product_id":100069901,"comment_content":"å‡å¦‚è€çš„ Leader A å› ä¸ºç½‘ç»œé—®é¢˜æ— æ³•è¿é€š Bã€C èŠ‚ç‚¹ï¼Œè¿™æ—¶å€™æ ¹æ®çŠ¶æ€å›¾ï¼Œæˆ‘ä»¬çŸ¥é“å®ƒå°†ä¸åœè‡ªå¢ä»»æœŸå·ï¼Œå‘èµ·é€‰ä¸¾ã€‚ç­‰ A èŠ‚ç‚¹ç½‘ç»œå¼‚å¸¸æ¢å¤åï¼Œé‚£ä¹ˆç°æœ‰ Leader æ”¶åˆ°äº†æ–°çš„ä»»æœŸå·ï¼Œå°±ä¼šè§¦å‘æ–°ä¸€è½® Leader é€‰ä¸¾ï¼Œå½±å“æœåŠ¡çš„å¯ç”¨æ€§ã€‚<br><br>è€å¸ˆï¼Œè¿™é‡Œæ²¡å¤ªæ‡‚ï¼ŒAä¸æ˜¯æœ¬èº«æ˜¯leaderå—ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å‘èµ·é€‰ä¸¾ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514507,"discussion_content":"æ„Ÿè°¢åé¦ˆï¼Œæ˜¯æˆ‘æè¿°ä¸ä¸¥è°¨ï¼Œè®©ä½ è¯¯ä¼šäº†ï¼Œåœ¨ä¸Šæ–‡ä¸­è€çš„Leader A crashåï¼Œé‡å¯ä¼šå˜æˆFollowerèŠ‚ç‚¹ï¼Œå·²å®Œå–„æè¿°ï¼Œè°¢è°¢ä½ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611715253,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":275829,"user_name":"äº‘åŸç”Ÿå·¥ç¨‹å¸ˆ","can_delete":false,"product_type":"c1","uid":2243294,"ip_address":"","ucode":"40CB692F21D3BC","user_header":"https://static001.geekbang.org/account/avatar/00/22/3a/de/e5c30589.jpg","comment_is_top":false,"comment_ctime":1611680168,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14496582056","product_id":100069901,"comment_content":"æ—¥å¿—å¤åˆ¶æµç¨‹å›¾å¾ˆèµï¼Œæ¸…æ™°æ˜“æ‡‚","like_count":3},{"had_liked":false,"id":296990,"user_name":"batman","can_delete":false,"product_type":"c1","uid":1266482,"ip_address":"","ucode":"73C30ACFC0D612","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/IIkdC2gohpcibib0AJvSdnJQefAuQYGlLySQOticThpF7Ck9WuDUQLJlgZ7ic13LIFnGBXXbMsSP3nZsbibBN98ZjGA/132","comment_is_top":false,"comment_ctime":1623251693,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"10213186285","product_id":100069901,"comment_content":"raft log å’Œ WALæ˜¯åŒä¸€ä¸œè¥¿å—","like_count":2},{"had_liked":false,"id":281156,"user_name":"types","can_delete":false,"product_type":"c1","uid":2449777,"ip_address":"","ucode":"8B50927EF1804F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDUJyeq54fiaXAgF62tNeocO3lHsKT4mygEcNoZLnibg6ONKicMgCgUHSfgW8hrMUXlwpNSzR8MHZwg/132","comment_is_top":false,"comment_ctime":1614601230,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10204535822","product_id":100069901,"comment_content":"é€‰ä¸¾è§„åˆ™å½“èŠ‚ç‚¹æ”¶åˆ°é€‰ä¸¾æŠ•ç¥¨çš„æ—¶å€™ï¼Œéœ€æ£€æŸ¥å€™é€‰è€…çš„æœ€åä¸€æ¡æ—¥å¿—ä¸­çš„ä»»æœŸå·ï¼Œè‹¥å°äºè‡ªå·±åˆ™æ‹’ç»æŠ•ç¥¨ã€‚å¦‚æœä»»æœŸå·ç›¸åŒï¼Œæ—¥å¿—å´æ¯”è‡ªå·±çŸ­ï¼Œä¹Ÿæ‹’ç»ä¸ºå…¶æŠ•ç¥¨ã€‚<br><br>è¯·é—®â€œæ—¥å¿—æ¯”è‡ªå·±çŸ­â€ æ˜¯æŒ‡ä»€ä¹ˆçŠ¶æ€ä¸‹çš„æ—¥å¿— ï¼Œæ˜¯commitedè¿˜æ˜¯ï¼Ÿ<br>å¦‚æœä¸æ˜¯commitedï¼Œ Bï¼ˆleaderï¼‰AppMsg ç»™Aå’ŒCåcrashï¼Œ Aæ”¶åˆ°äº†ï¼Œ Cæ²¡æ”¶åˆ°ã€‚ è¿™ä¸ªæ—¶å€™Cä¼šä¸ä¼šæˆä¸ºleaderï¼Œå¯¼è‡´æ•°æ®ä¸¢å¤±","like_count":2,"discussions":[{"author":{"id":1752348,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/jA97yib7VetXc4iclOg2gGfZu1fO7efyib2mKeqvIxDdmgLqukusyFzPrbIQeZYR0WDJUicRakgVGroaYC7aWGFrEw/132","nickname":"Turing","note":"","ucode":"F88679276D4841","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388882,"discussion_content":"å½“å‰æœ€å¤§çš„æ—¥å¿—index, åŒ…å«commitedå’Œæœªcommitted.   cä¸ä¼šæˆä¸ºleader, ä¸æ»¡è¶³åŠæ•°.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629026975,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":275849,"user_name":"å‡ºå–çµé­‚çš„æ•™ç»ƒKerry","can_delete":false,"product_type":"c1","uid":1807943,"ip_address":"","ucode":"8C64517DA556FE","user_header":"https://static001.geekbang.org/account/avatar/00/1b/96/47/93838ff7.jpg","comment_is_top":false,"comment_ctime":1611707119,"is_pvip":true,"replies":[{"id":"100198","content":"å—¯ï¼Œä¸»ä»å¤åˆ¶æˆ‘ä¸ªäººè®¤ä¸ºæœ€å¤§çš„ç¼ºç‚¹è¿˜æ˜¯æ•°æ®ä¸€è‡´æ€§ï¼ŒRaftçš„ä¿è¯ä¸€è‡´æ€§èƒŒåçš„æ ¸å¿ƒæ•°å­¦åŸç†å…¶å®æ˜¯æŠ½å±‰åŸç†ï¼Œä½ å¯ä»¥è¯¦ç»†äº†è§£ä¸‹ï¼Œä¸ç®¡æ˜¯é›†ç¾¤é€‰ä¸¾è¿˜æ˜¯æ•°æ®å¤åˆ¶ï¼Œéƒ½è¦æ±‚ä¸€åŠä»¥ä¸ŠèŠ‚ç‚¹ç¡®è®¤","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1611747344,"ip_address":"","comment_id":275849,"utype":1}],"discussion_count":5,"race_medal":0,"score":"10201641711","product_id":100069901,"comment_content":"ä¸»ä»å¤åˆ¶ç¼ºç‚¹æ˜¯å› ä¸ºä¸»èŠ‚ç‚¹å´©æºƒåï¼Œæ²¡æœ‰é€‰ä¸»æœºåˆ¶ï¼ˆæ˜¯å¦å¯ä»¥è€ƒè™‘redisçš„å“¨å…µé€‰ä¸»ï¼‰å‘¢ï¼Ÿè¿˜æ˜¯å› ä¸ºæ•°æ®ä¸€è‡´æ€§å‘¢ï¼ˆraftä¿æŒå¼ºä¸€è‡´æ€§çš„è¯ï¼Œä¹Ÿæ˜¯é€šè¿‡æŸäº›æœºåˆ¶ä¿è¯å¼ºä¸€è‡´æ€§ï¼ˆä¸»èŠ‚ç‚¹è¯»æˆ–è€…ReadIndexï¼‰ï¼‰","like_count":2,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514500,"discussion_content":"å—¯ï¼Œä¸»ä»å¤åˆ¶æˆ‘ä¸ªäººè®¤ä¸ºæœ€å¤§çš„ç¼ºç‚¹è¿˜æ˜¯æ•°æ®ä¸€è‡´æ€§ï¼ŒRaftçš„ä¿è¯ä¸€è‡´æ€§èƒŒåçš„æ ¸å¿ƒæ•°å­¦åŸç†å…¶å®æ˜¯æŠ½å±‰åŸç†ï¼Œä½ å¯ä»¥è¯¦ç»†äº†è§£ä¸‹ï¼Œä¸ç®¡æ˜¯é›†ç¾¤é€‰ä¸¾è¿˜æ˜¯æ•°æ®å¤åˆ¶ï¼Œéƒ½è¦æ±‚ä¸€åŠä»¥ä¸ŠèŠ‚ç‚¹ç¡®è®¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611747344,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1066772,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJxQXM5O1ONNia62e2dySKTRjPYQOic2IF3gT0HIGuYE6zia2p0DWOJyCIiavtUfNUkictUyBMqWibQtwEg/132","nickname":"è€æ½˜","note":"","ucode":"50D5370145320C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":345417,"discussion_content":"æˆ‘çš„å“¨å…µæœºåˆ¶ä¸èƒ½è§£å†³åˆ†å¸ƒå¼çš„é—®é¢˜ï¼Œå› ä¸ºå“¨å…µè‡ªå·±å°±æ˜¯å•ç‚¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611719000,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1807943,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/96/47/93838ff7.jpg","nickname":"å‡ºå–çµé­‚çš„æ•™ç»ƒKerry","note":"","ucode":"8C64517DA556FE","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1066772,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJxQXM5O1ONNia62e2dySKTRjPYQOic2IF3gT0HIGuYE6zia2p0DWOJyCIiavtUfNUkictUyBMqWibQtwEg/132","nickname":"è€æ½˜","note":"","ucode":"50D5370145320C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":345469,"discussion_content":"å“¨å…µé›†ç¾¤ã€‚ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611724262,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":345417,"ip_address":""},"score":345469,"extra":""},{"author":{"id":1066772,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJxQXM5O1ONNia62e2dySKTRjPYQOic2IF3gT0HIGuYE6zia2p0DWOJyCIiavtUfNUkictUyBMqWibQtwEg/132","nickname":"è€æ½˜","note":"","ucode":"50D5370145320C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1807943,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/96/47/93838ff7.jpg","nickname":"å‡ºå–çµé­‚çš„æ•™ç»ƒKerry","note":"","ucode":"8C64517DA556FE","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":345483,"discussion_content":"æˆ‘æ˜¯è¿™ä¹ˆç†è§£çš„ï¼Œé›†ç¾¤å“¨å…µä¹Ÿåªæ˜¯ä¸€ä¸ªå‡çº§ç‰ˆæœ¬çš„keeplivedã€‚é€šè¿‡ç¬¬3æ–¹æ¢æµ‹æ–¹å¼å¼•å…¥ï¼Œç¬¬3æ–¹ä¼šå¢åŠ é™¤æœåŠ¡æœ¬èº«ä¹‹å¤–çš„æ•…éšœå‡ ç‡ï¼Œä»¥åŠè„‘è£‚ç­‰é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611726789,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":345469,"ip_address":""},"score":345483,"extra":""},{"author":{"id":1807943,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/96/47/93838ff7.jpg","nickname":"å‡ºå–çµé­‚çš„æ•™ç»ƒKerry","note":"","ucode":"8C64517DA556FE","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1066772,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJxQXM5O1ONNia62e2dySKTRjPYQOic2IF3gT0HIGuYE6zia2p0DWOJyCIiavtUfNUkictUyBMqWibQtwEg/132","nickname":"è€æ½˜","note":"","ucode":"50D5370145320C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":345555,"discussion_content":"å“¨å…µæ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ç‰¹æ®Šæ¨¡å¼ä¸‹çš„ Redis è¿›ç¨‹ï¼Œä¸»ä»åº“å®ä¾‹è¿è¡Œçš„åŒæ—¶ï¼Œå®ƒä¹Ÿåœ¨è¿è¡Œã€‚å“¨å…µä¸»è¦è´Ÿè´£çš„å°±æ˜¯ä¸‰ä¸ªä»»åŠ¡ï¼šç›‘æ§ã€é€‰ä¸»ï¼ˆé€‰æ‹©ä¸»åº“ï¼‰å’Œé€šçŸ¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611740655,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":345483,"ip_address":""},"score":345555,"extra":""}]}]},{"had_liked":false,"id":331925,"user_name":"erge","can_delete":false,"product_type":"c1","uid":2672238,"ip_address":"","ucode":"FAE16C190A3E23","user_header":"https://static001.geekbang.org/account/avatar/00/28/c6/6e/49aff2bd.jpg","comment_is_top":false,"comment_ctime":1642902896,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5937870192","product_id":100069901,"comment_content":"è€å¸ˆå¥½ï¼ŒpeerèŠ‚ç‚¹æ˜¯ä»€ä¹ˆå‘¢","like_count":1},{"had_liked":false,"id":324353,"user_name":"HelloBug","can_delete":false,"product_type":"c1","uid":1249598,"ip_address":"","ucode":"E61A4AD5C2F724","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/3e/925aa996.jpg","comment_is_top":false,"comment_ctime":1638401842,"is_pvip":true,"replies":[{"id":"119297","content":"å—¯ï¼Œæœ‰äº›æœ¯è¯­çš„ç¡®å¯ä»¥æ›´å‹å¥½ç‚¹ï¼Œæ¨èå…ˆç®€å•çœ‹çœ‹etcdæºç ï¼ˆ3.3&#47;3.4ç‰ˆæœ¬ï¼‰ï¼Œè·Ÿç€02å’Œ03å¤§è‡´èµ°è¯»ä¸‹ï¼Œè¿™æ ·ä½ ä¼šæ›´åŠ æ¸…æ™°","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1009582","ctime":1640241591,"ip_address":"","comment_id":324353,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5933369138","product_id":100069901,"comment_content":"è€å¸ˆåœ¨è®²è§£æµç¨‹çš„æ—¶å€™ï¼Œä¼šè¯´raftæ¨¡å—ï¼Œkvserveræ¨¡å—ï¼Œè¿™äº›éƒ½å¥½ç†è§£ã€‚ä½†åˆä¼šè¯´etcdå‘é€ä»€ä¹ˆæ¶ˆæ¯ï¼Œæˆ–è€…etcdserveræ€ä¹ˆæ€ä¹ˆæ ·ï¼Œå…·ä½“æ˜¯ä»€ä¹ˆæ¨¡å—å‘¢ï¼Ÿæˆ‘ä¹‹å‰ä»¥ä¸ºè¿™ä¸¤è€…ä¸æŒ‡å“ªä¸ªæ¨¡å—ï¼Œå°±æ˜¯etcdçš„æ¡†æ¶ä»£ç ï¼Œä½†æ˜¯è¿™ç¯‡æ–‡ç« é‡Œåˆçœ‹åˆ°etcdserveræ¨¡å—ï¼Œç€å®ä¸çŸ¥é“æ€ä¹ˆç†è§£äº†","like_count":1,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541048,"discussion_content":"å—¯ï¼Œæœ‰äº›æœ¯è¯­çš„ç¡®å¯ä»¥æ›´å‹å¥½ç‚¹ï¼Œæ¨èå…ˆç®€å•çœ‹çœ‹etcdæºç ï¼ˆ3.3/3.4ç‰ˆæœ¬ï¼‰ï¼Œè·Ÿç€02å’Œ03å¤§è‡´èµ°è¯»ä¸‹ï¼Œè¿™æ ·ä½ ä¼šæ›´åŠ æ¸…æ™°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640241591,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1339724,"avatar":"https://static001.geekbang.org/account/avatar/00/14/71/4c/2cefec07.jpg","nickname":"é™æ°´æµæ·±","note":"","ucode":"644F05EFBD2E7B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544516,"discussion_content":"å—¯ï¼Œå¯¹äºåˆå­¦è€…ï¼Œç¡®å®æœ‰ç‚¹ä¹±äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641543872,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":319993,"user_name":"åŠ±ç ”å†°","can_delete":false,"product_type":"c1","uid":1106394,"ip_address":"","ucode":"FCBC8266018FA0","user_header":"https://static001.geekbang.org/account/avatar/00/10/e1/da/d7f591a7.jpg","comment_is_top":false,"comment_ctime":1636030353,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5930997649","product_id":100069901,"comment_content":"ç­‰ A èŠ‚ç‚¹ç½‘ç»œå¼‚å¸¸æ¢å¤åï¼Œé‚£ä¹ˆç°æœ‰ Leader æ”¶åˆ°äº†æ–°çš„ä»»æœŸå·ï¼Œå°±ä¼šè§¦å‘æ–°ä¸€è½® Leader é€‰ä¸¾ï¼Œå½±å“æœåŠ¡çš„å¯ç”¨æ€§ã€‚<br>ä¸Šæ–‡è¯´åˆ°leaderé€‰ä¸¾æ”¶åˆ°é€‰ä¸¾ç¥¨ä¹‹åä¼šè·Ÿè‡ªå·±çš„ç°åœ¨çš„ä»»æœŸå·å¯¹æ¯”ï¼Œä¸”è¦æ¯”è‡ªå·±çš„æ•°æ®æ–°ï¼Œé‚£å‘èµ·é€‰ç¥¨ä¹‹åBè·ŸCæ”¶åˆ°æŠ•ç¥¨è¯·æ±‚ä»»æœŸå·å¯èƒ½æ¯”è‡ªå·±çš„è¦å¤§ï¼Œä½†æ˜¯æ•°æ®åº”è¯¥æ²¡æœ‰æ¯”Bè·ŸCçš„å¤§å§ï¼Œæ‰€ä»¥è¿™æ—¶å€™Bå‘Šè¯‰Aç°åœ¨è‡ªå·±æ˜¯leaderè®©Aç›´æ¥æˆä¸ºfollower å°±è¡Œäº†ï¼Œä¸ºä»€ä¹ˆä¼šé‡æ–°é€‰ä¸¾å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":2012886,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/b6/d6/3b1fbf9b.jpg","nickname":"2018","note":"","ucode":"436D1F4CA63CB9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":564876,"discussion_content":"Aä¼šåœ¨é‡æ–°é€‰ä¸¾çš„è¿‡ç¨‹ä¸­,æ”¶åˆ°æ¥è‡ªBçš„ï¼ˆè‡ªå·±æ˜¯leaderçš„æ¶ˆæ¯ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650347371,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1934783,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/85/bf/c1f2a140.jpg","nickname":"æ±Ÿå°æ±Ÿ","note":"","ucode":"E208D9A9EAEEF0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543992,"discussion_content":"æˆ‘ä¹Ÿæ˜¯è¿™æ ·æƒ³çš„ï¼Œå‘ç°æœ‰äººå’Œæˆ‘æƒ³çš„ä¸€æ ·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641375963,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":284425,"user_name":"Geek_aaa517","can_delete":false,"product_type":"c1","uid":1640853,"ip_address":"","ucode":"F73BABFFD22970","user_header":"","comment_is_top":false,"comment_ctime":1616240062,"is_pvip":false,"replies":[{"id":"103455","content":"WALæ—¥å¿—æ˜¯ç”¨æ¥æŒä¹…åŒ–raftæ—¥å¿—æ¡ç›®å’Œç›¸å…³é›†ç¾¤å…ƒæ•°æ®ä¿¡æ¯çš„ï¼Œå¯é˜²æ­¢èŠ‚ç‚¹å‘ç”Ÿé‡å¯ã€crashåï¼Œå¯¹åº”çš„å·²æäº¤æ—¥å¿—æ¡ç›®ä¸¢å¤±ç­‰å¼‚å¸¸æƒ…å†µï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ã€‚<br>Raftæ—¥å¿—è®°å½•äº†èŠ‚ç‚¹è¿‡å»ä¸€æ®µæ—¶é—´å†…æ”¶åˆ°çš„å†™è¯·æ±‚ï¼Œå¦‚put&#47;del&#47;txnæ“ä½œç­‰ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡ä¸€ä¸ªå†…å­˜æ•°ç»„æ¥å­˜å‚¨æœ€è¿‘ä¸€ç³»åˆ—æ—¥å¿—æ¡ç›®ã€‚å½“FollowerèŠ‚ç‚¹è½åLeaderè¾ƒå°æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡Leaderå†…å­˜ä¸­ç»´æŠ¤çš„æ—¥å¿—æ¡ç›®ä¿¡æ¯, å°†è½åçš„æ—¥å¿—æ¡ç›®å‘é€ç»™å®ƒï¼Œæœ€ç»ˆå„ä¸ªèŠ‚ç‚¹åº”ç”¨ä¸€æ ·çš„æ—¥å¿—æ¡ç›®å†…å®¹ï¼Œæ¥ç¡®ä¿å„ä¸ªèŠ‚ç‚¹æ•°æ®ä¸€è‡´æ€§ã€‚<br>etcdèŠ‚ç‚¹é‡å¯åï¼Œå¯é€šè¿‡WALæ—¥å¿—æ¥é‡å»ºéƒ¨åˆ†raftæ—¥å¿—æ¡ç›®ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1616653488,"ip_address":"","comment_id":284425,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5911207358","product_id":100069901,"comment_content":"raftæ—¥å¿—è·Ÿwalæ—¥å¿—æ²¡å¤ªææ˜ç™½ï¼Œåˆ†åˆ«æ˜¯ä»€ä¹ˆä½œç”¨å‘¢","like_count":1,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517345,"discussion_content":"WALæ—¥å¿—æ˜¯ç”¨æ¥æŒä¹…åŒ–raftæ—¥å¿—æ¡ç›®å’Œç›¸å…³é›†ç¾¤å…ƒæ•°æ®ä¿¡æ¯çš„ï¼Œå¯é˜²æ­¢èŠ‚ç‚¹å‘ç”Ÿé‡å¯ã€crashåï¼Œå¯¹åº”çš„å·²æäº¤æ—¥å¿—æ¡ç›®ä¸¢å¤±ç­‰å¼‚å¸¸æƒ…å†µï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå®ƒæ˜¯å°†æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ä¸­ã€‚\nRaftæ—¥å¿—è®°å½•äº†èŠ‚ç‚¹è¿‡å»ä¸€æ®µæ—¶é—´å†…æ”¶åˆ°çš„å†™è¯·æ±‚ï¼Œå¦‚put/del/txnæ“ä½œç­‰ï¼Œä¸€èˆ¬æ˜¯é€šè¿‡ä¸€ä¸ªå†…å­˜æ•°ç»„æ¥å­˜å‚¨æœ€è¿‘ä¸€ç³»åˆ—æ—¥å¿—æ¡ç›®ã€‚å½“FollowerèŠ‚ç‚¹è½åLeaderè¾ƒå°æ—¶ï¼Œå°±å¯ä»¥é€šè¿‡Leaderå†…å­˜ä¸­ç»´æŠ¤çš„æ—¥å¿—æ¡ç›®ä¿¡æ¯, å°†è½åçš„æ—¥å¿—æ¡ç›®å‘é€ç»™å®ƒï¼Œæœ€ç»ˆå„ä¸ªèŠ‚ç‚¹åº”ç”¨ä¸€æ ·çš„æ—¥å¿—æ¡ç›®å†…å®¹ï¼Œæ¥ç¡®ä¿å„ä¸ªèŠ‚ç‚¹æ•°æ®ä¸€è‡´æ€§ã€‚\netcdèŠ‚ç‚¹é‡å¯åï¼Œå¯é€šè¿‡WALæ—¥å¿—æ¥é‡å»ºéƒ¨åˆ†raftæ—¥å¿—æ¡ç›®ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616653488,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1127786,"avatar":"https://static001.geekbang.org/account/avatar/00/11/35/6a/8ab55564.jpg","nickname":"AlphaLiu","note":"","ucode":"B75A4C82E7DC03","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":365707,"discussion_content":"é‚£etcdèŠ‚ç‚¹é‡å¯åï¼Œå°†é‡å»ºå¤šå°‘raftæ—¥å¿—æ¡ç›®å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617869843,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":279778,"user_name":"Casper","can_delete":false,"product_type":"c1","uid":1022129,"ip_address":"","ucode":"69282EB175B48E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/98/b1/f89a84d0.jpg","comment_is_top":false,"comment_ctime":1613961722,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5908929018","product_id":100069901,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½è¯·æ•™ä¸€å†™é—®é¢˜ï¼š<br>1. å¦‚æœä¸€ä¸ªé›†ç¾¤æœ‰3ä¸ªèŠ‚ç‚¹, åˆ™Leaderä¼šç»´æŠ¤3ç»„ (NextIndex, MatchIndex)å—?<br>2. ç”±äºæ¯ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥å˜ä¸ºLeader, æ˜¯å¦ä¹Ÿæ„å‘³ç€Followerä¹Ÿä¼šåŒæ­¥æ›´æ–°è¿™ä¸¤ä¸ªå˜é‡çš„å€¼å‘¢?<br>3. å‡è®¾å½“å‰ä»»æœŸå·æ˜¯1ï¼Œæ­¤æ—¶Leader crashäº†ï¼Œè¿›è¡Œé€‰ä¸¾ç†è®ºä¸Šè¿™æ¬¡ä»»æœŸå·æ˜¯2ï¼Œä½†æ­¤æ¬¡é€‰ä¸¾å¤±è´¥äº†ï¼Œå†ä¸‹ä¸€æ¬¡é€‰ä¸¾æˆåŠŸæ—¶ä¼šä½¿ç”¨ä»»æœŸå·3è¿˜æ˜¯ä»»æœŸå·2ï¼Ÿ<br><br>","like_count":1},{"had_liked":false,"id":278873,"user_name":"u","can_delete":false,"product_type":"c1","uid":1140276,"ip_address":"","ucode":"88FA7BA089807C","user_header":"https://static001.geekbang.org/account/avatar/00/11/66/34/0508d9e4.jpg","comment_is_top":false,"comment_ctime":1613405125,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5908372421","product_id":100069901,"comment_content":"å‰å®³äº†ï¼Œä¸è¿‡ä¹‹å‰æ²¡æ¥è§¦è¿‡ç›¸å…³çŸ¥è¯†ï¼Œçœ‹çš„æœ‰ç‚¹åƒåŠ›ï¼Œæ‰¾äº†ä¸€ç¯‡é€šä¿—æ˜“æ‡‚çš„è¡¥äº†ä¸‹åŸºç¡€ï¼Œä¸ºåé¢çš„è¯¾ç¨‹åšå‡†å¤‡ï¼Œåˆ†äº«ä¸€ä¸‹ï¼šhttps:&#47;&#47;blog.csdn.net&#47;wangxuelei036&#47;article&#47;details&#47;108894053","like_count":1},{"had_liked":false,"id":277551,"user_name":"è°¢å°è·¯","can_delete":false,"product_type":"c1","uid":1035064,"ip_address":"","ucode":"C9FE2EB10DC105","user_header":"https://static001.geekbang.org/account/avatar/00/0f/cb/38/4c9cfdf4.jpg","comment_is_top":false,"comment_ctime":1612453633,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5907420929","product_id":100069901,"comment_content":"è¡Œå§ã€‚raft åŠ¨ç”»ç‰ˆã€‚http:&#47;&#47;thesecretlivesofdata.com&#47;raft&#47;","like_count":1},{"had_liked":false,"id":353714,"user_name":"é˜¿åŸºç±³å¾·","can_delete":false,"product_type":"c1","uid":2048922,"ip_address":"å¹¿ä¸œ","ucode":"E4168E1A55E621","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/KjXNw3FNfsJhktyGDNEpQdicnaR0MZCiaQwGg3icQXUGVzqsRHL1FfxO87FX0VNzcl858AUjWPaABmogsWNFa8OGw/132","comment_is_top":false,"comment_ctime":1659691477,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1659691477","product_id":100069901,"comment_content":"å¦‚æœetcdé›†ç¾¤æœ‰5ä¸ªèŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯a,b,c,d,eèŠ‚ç‚¹ï¼Œaæ˜¯leaderï¼Œaå°†ä¸€æ¡æ–°æ•°æ®x=5åˆ·ç›˜åˆ°walä¹‹åï¼Œåªç»™bèŠ‚ç‚¹å‘å»äº†è¿½åŠ æ—¥å¿—çš„æ¶ˆæ¯ï¼Œç„¶åaå®•æœºäº†ã€‚é‡æ–°é€‰ä¸¾ï¼Œbæœ‰å¯èƒ½æˆä¸ºæ–°ä¸€ä»»çš„leaderå—ï¼Ÿbæˆä¸ºleaderä¹‹åï¼Œå®ƒæ—¥å¿—æ–‡ä»¶ä¸­çš„x=5è¿™æ¡æ•°æ®ä¼šè¢«åˆ é™¤è¿˜æ˜¯ä¼šåŒæ­¥åˆ°å…¶ä»–followerèŠ‚ç‚¹ï¼Œå› ä¸ºè¿™æ¡x=5çš„æ•°æ®åœ¨ä¸Šä¸€ä¸ªleaderçš„ä»»æœŸå†…æ˜¯è¿˜æ²¡æœ‰å†™å…¥åˆ°å¤§å¤šæ•°èŠ‚ç‚¹çš„ï¼Ÿå¦‚æœä¸åˆ é™¤x=5ï¼Œç®—ä¸ç®—æ˜¯è„æ•°æ®ï¼Œå› ä¸ºå†™å…¥è¿™æ¡æ•°æ®çš„å®¢æˆ·ç«¯è‚¯å®šè¶…æ—¶æŠ¥é”™äº†","like_count":0},{"had_liked":false,"id":353618,"user_name":"é™ˆéº’æ–‡","can_delete":false,"product_type":"c1","uid":2187256,"ip_address":"ç¦å»º","ucode":"41475885FA5AD5","user_header":"https://static001.geekbang.org/account/avatar/00/21/5f/f8/1d16434b.jpg","comment_is_top":false,"comment_ctime":1659606681,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1659606681","product_id":100069901,"comment_content":"é‚£ä¸ªå›¾1å’Œå›¾2å„ä¸ªèŠ‚ç‚¹çš„ç¬¦å·æ ‡è¯†æ˜¯ä»€ä¹ˆæ„æ€ï¼Œæ¯”å¦‚x&lt;-1,y&lt;-2,money&lt;-10 a&lt;-1","like_count":0},{"had_liked":false,"id":351960,"user_name":"æ¸…èŒ—","can_delete":false,"product_type":"c1","uid":2524009,"ip_address":"","ucode":"F16F9BFBB7C31F","user_header":"https://static001.geekbang.org/account/avatar/00/26/83/69/fda7d5f5.jpg","comment_is_top":false,"comment_ctime":1658308110,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1658308110","product_id":100069901,"comment_content":"å°ç™½çœ‹äº†å››ç« äº†ï¼Œæ„Ÿè§‰çœ‹ç€å¾ˆåƒåŠ›","like_count":0},{"had_liked":false,"id":349805,"user_name":"å†œæ‘åˆä½œç¤¾","can_delete":false,"product_type":"c1","uid":2184028,"ip_address":"","ucode":"E05CC3F3502B74","user_header":"https://static001.geekbang.org/account/avatar/00/21/53/5c/6d846d99.jpg","comment_is_top":false,"comment_ctime":1656335324,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1656335324","product_id":100069901,"comment_content":"â€œå¦‚æœåœ¨ä¸Šé¢çš„æ—¥å¿—å›¾ 2 ä¸­ï¼ŒLeader B åœ¨åº”ç”¨æ—¥å¿—æŒ‡ä»¤ put hello ä¸º world åˆ°çŠ¶æ€æœºï¼Œå¹¶è¿”å›ç»™ client æˆåŠŸåï¼Œçªç„¶ crash äº†ï¼Œé‚£ä¹ˆ Follower A å’Œ C æ˜¯å¦éƒ½æœ‰èµ„æ ¼é€‰ä¸¾æˆä¸º Leader å‘¢ï¼Ÿâ€<br><br>è¿”å›ç»™client æ˜¯æœ€åä¸€æ­¥å—ï¼Ÿä»ä¸Šé¢èŠ‚é€‰çš„ç‰‡æ®µçœ‹ï¼Œå¥½åƒä¸æ˜¯ï¼Ÿ","like_count":0},{"had_liked":false,"id":348584,"user_name":"Hugh","can_delete":false,"product_type":"c1","uid":2285931,"ip_address":"","ucode":"77434E01E1D715","user_header":"https://static001.geekbang.org/account/avatar/00/22/e1/6b/74a8b7d8.jpg","comment_is_top":false,"comment_ctime":1655215249,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1655215249","product_id":100069901,"comment_content":"å…³äºæ—¥å¿—å¤åˆ¶è¿™éƒ¨åˆ†ï¼Œæƒ³è¯·æ•™å‡ ä¸ªé—®é¢˜ï¼š<br>1. æ–‡ä¸­æœ‰æåˆ°ç¨³å®šå’Œä¸ç¨³å®šçš„raft logï¼Œæ€ä¹ˆå®šä¹‰â€œç¨³å®šâ€å‘¢ï¼Ÿ<br>2. æ–‡ä¸­æåˆ°ï¼Œleaderå‘followerså‘é€è¿½åŠ æ—¥å¿—çš„RPCæ—¶ï¼Œfollowerä¼šå°†æ¶ˆæ¯å†…å®¹æŒä¹…åŒ–åˆ°WALä»¥åŠraft logä¸­ï¼Œç„¶åå“åº”leaderè¡¨ç¤ºè‡ªå·±å·²å®Œæˆå¤åˆ¶ï¼ˆå·²å¤åˆ¶è¿›logï¼Œæœªæäº¤ï¼‰ï¼Œå¦‚æœleaderæ”¶åˆ°äº†å¤§éƒ¨åˆ†followerçš„æˆåŠŸå“åº”ï¼Œåˆ™è®¤ä¸ºæ­¤æ¬¡æäº¤æ˜¯å®‰å…¨çš„ï¼Œå¹¶æŠŠè¯¥æ—¥å¿—è®¾ç½®ä¸ºå·²æäº¤ï¼Œå¹¶åœ¨æœªæ¥çš„å¿ƒè·³RPCä¸­æŠŠå·²æäº¤ç´¢å¼•åŒæ­¥ç»™æ‰€æœ‰çš„followerã€‚è¿™é‡Œå‡è®¾ä¸€ç§æƒ…å†µï¼šleaderå°†æ—¥å¿—è®¾ç½®ä¸ºå·²æäº¤ï¼Œå¹¶å›å¤äº†å®¢æˆ·ç«¯successçš„å“åº”ï¼Œæ­¤æ—¶leaderå®•æœºäº†ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„followeréƒ½ä¸çŸ¥é“æœ€æ–°çš„è¿™æ¡æ—¥å¿—è¢«æäº¤äº†ï¼Œé‚£æœªæ¥è¿™æ¡æ—¥å¿—è¿˜ä¼šè¢«å†™è¿›çŠ¶æ€æœºå—ï¼Ÿä¾æ®æ˜¯ä»€ä¹ˆï¼Ÿ<br>3. å†å›åˆ°2ä¸­çš„è¿™ä¸ªä¾‹å­ï¼Œå‡è®¾leaderç»™followerå‘é€è¿½åŠ æ—¥å¿—RPCï¼ˆæˆ‘ä»¬æŠŠè¿™æ¬¡æ—¥å¿—å«åšXï¼‰æ—¶ï¼Œåªæœ‰ä¸€ä¸ªfollower Aå®Œæˆäº†å¤åˆ¶å¹¶è¿½åŠ raft logä¸­ï¼Œå…¶ä»–followeréƒ½å¤±è´¥äº†ï¼Œæ­¤æ—¶leaderçªç„¶å®•æœºäº†ï¼Œä¸”Aæœ€å…ˆè¶…æ—¶å¹¶è½¬å˜ä¸ºcandidateå‘èµ·äº†é€‰ä¸¾è¯·æ±‚ä¸”æˆåŠŸè·é€‰æˆä¸ºleaderï¼Œé‚£ä¹ˆè¿™æ¡æ—¥å¿—Xæœ€ç»ˆä¼šè¢«å¤åˆ¶ç»™æ‰€æœ‰çš„èŠ‚ç‚¹å—ï¼ˆæˆ‘åœ¨https:&#47;&#47;raft.github.io&#47; è¿™ä¸ªç½‘ç«™ç”¨åŠ¨ç”»æ¨¡æ‹Ÿäº†ä¸€ä¸‹ï¼Œç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼‰ï¼Ÿå¦‚æœä¼šè¢«å¤åˆ¶ï¼Œæ˜¯ä¸æ˜¯å’Œå®¢æˆ·ç«¯çš„è®¤çŸ¥å°±ä¸ä¸€è‡´äº†ï¼Œå› ä¸ºå®¢æˆ·ç«¯è®¤ä¸ºæ­¤æ¬¡çš„putè¯·æ±‚æ˜¯å¤±è´¥çš„<br>æˆ‘å‚è€ƒäº†raftè®ºæ–‡å’Œè¿™ç¯‡è¯¾ç¨‹ï¼Œæ²¡æ‰¾åˆ°å…·ä½“çš„ç­”æ¡ˆï¼Œè¾›è‹¦è€å¸ˆå¸®å¿™è§£ç­”ä¸€ä¸‹","like_count":0},{"had_liked":false,"id":334829,"user_name":"è“è“ä¾ ","can_delete":false,"product_type":"c1","uid":1620722,"ip_address":"","ucode":"2E02AC43D21103","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDRPejHodutia9Ud8UZLY8g5lTkKXgf3J104c0jM9aFfAGNoUdxkRLnnWRc5Kd3jIeN3EqXxKFT0g/132","comment_is_top":false,"comment_ctime":1645149343,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1645149343","product_id":100069901,"comment_content":"å‡è®¾ä¸€ä¸ªetcdä¸€å¼€å§‹æœ‰3ä¸ªèŠ‚ç‚¹ a,b,cï¼Œå…¶ä¸­aæ˜¯leaderï¼Œä¸€ä¸ªputè¯·æ±‚tï¼Œæäº¤åˆ°äº† a,b èŠ‚ç‚¹ï¼Œè¿”å›å®¢æˆ·ç«¯æˆåŠŸï¼›ç„¶å3ä¸ªèŠ‚ç‚¹éƒ½æ–­ç”µcrashï¼Œç„¶ååªæœ‰ c é‡å¯æä¾›æœåŠ¡ï¼Œä¸€æ®µæ—¶é—´åï¼Œaé‡å¯ï¼Œè¿™ä¸ªtçš„æ—¥å¿—ï¼Œä½¿ç”¨ä»€ä¹ˆæœºåˆ¶åŒæ­¥åˆ°cï¼Œæ˜¯aå‘é€ç»™cå—ï¼Ÿè¿˜æ˜¯ç”±cåŒæ­¥æ—¥å¿—ç»™açš„æ—¶å€™ï¼Œå‘ç°ä¸Šä¸€ä¸ªtermä»»æœŸä¸­aæœªæäº¤çš„æ—¥å¿—tï¼Œç„¶ååŒæ­¥æ‹‰å–åˆ°cï¼Ÿ","like_count":0},{"had_liked":false,"id":326504,"user_name":"å‡ºå–çµé­‚çš„æ•™ç»ƒKerry","can_delete":false,"product_type":"c1","uid":1807943,"ip_address":"","ucode":"8C64517DA556FE","user_header":"https://static001.geekbang.org/account/avatar/00/1b/96/47/93838ff7.jpg","comment_is_top":false,"comment_ctime":1639544103,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1639544103","product_id":100069901,"comment_content":"è€å¸ˆï¼Œä¸ºä»€ä¹ˆæœ€å¼€å§‹ä¼šè¿½åŠ åˆ°ä¸ç¨³å®šraftæ—¥å¿—ä¸­å‘¢ï¼Ÿ","like_count":1},{"had_liked":false,"id":324873,"user_name":"cc","can_delete":false,"product_type":"c1","uid":2759767,"ip_address":"","ucode":"A1144504EA9B00","user_header":"","comment_is_top":false,"comment_ctime":1638697540,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638697540","product_id":100069901,"comment_content":"å¦‚ä½•ç†è§£é€‰ä¸¾è¿‡ç¨‹å’Œæ—¥å¿—å¤åˆ¶è¿‡ç¨‹ä¸­çš„ã€Œå¤§å¤šæ•°ã€ï¼Ÿ<br>- åœ¨é€‰ä¸¾è¿‡ç¨‹ä¸­ï¼Œcandidate éœ€è¦è·å–ã€Œå¤§å¤šæ•°ã€èŠ‚ç‚¹çš„æŠ•ç¥¨ï¼Œæ‰èƒ½æˆä¸º leaderï¼›<br>- åœ¨æ—¥å¿—å¤åˆ¶è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæ—¥å¿—æ¡ç›®å·²ç»è¢«ã€Œå¤§å¤šæ•°ã€èŠ‚ç‚¹æŒä¹…åŒ–ï¼Œleader å°†è¯¥æ—¥å¿—æ¡ç›®è®¾ä¸º committed<br><br>é€‰ä¸¾è¿‡ç¨‹ä¸­çš„ã€Œå¤§å¤šæ•°ã€ï¼šæ˜¯æŒ‡ä¸€åŠä»¥ä¸Šçš„èŠ‚ç‚¹ï¼Œå¦‚æœåªæœ‰ 2 ä¸ªèŠ‚ç‚¹ï¼Œä¾ç„¶èƒ½å¤Ÿå®Œæˆé€‰ä¸¾è¿‡ç¨‹ï¼Œå› ä¸ºå‘èµ·é€‰ä¸¾çš„ candidate é¦–å…ˆæŠ•ç¥¨ç»™è‡ªå·±ï¼Œè‡ªå·±çš„ä¸€ç¥¨ä¹Ÿç®—æ•°ï¼Œè¿™é‡Œçš„ã€Œå¤§å¤šæ•°ã€æ˜¯æŒ‡æ‰€æœ‰èŠ‚ç‚¹çš„å¤§å¤šæ•°ã€‚<br><br>æ—¥å¿—å¤åˆ¶è¿‡ç¨‹ä¸­çš„ã€Œå¤§å¤šæ•°ã€ï¼šæ˜¯æŒ‡ä¸€åŠä»¥ä¸Šçš„ follower èŠ‚ç‚¹ï¼Œå¦‚æœåªæœ‰ 2 ä¸ªèŠ‚ç‚¹ï¼Œæ˜¯æ— æ³•æäº¤æ—¥å¿—çš„ï¼›å› ä¸º leader ä¸ä¼šé¦–å…ˆæäº¤æ—¥å¿—ï¼Œè¿™é‡Œçš„ã€Œå¤§å¤šæ•°ã€æ˜¯æŒ‡ follower èŠ‚ç‚¹æ•°çš„å¤§å¤šæ•°ã€‚<br><br>ä¸çŸ¥ä¸Šè¿°ç†è§£æ˜¯å¦æ­£ç¡®ï¼Ÿ","like_count":0},{"had_liked":false,"id":324863,"user_name":"cc","can_delete":false,"product_type":"c1","uid":2759767,"ip_address":"","ucode":"A1144504EA9B00","user_header":"","comment_is_top":false,"comment_ctime":1638692852,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638692852","product_id":100069901,"comment_content":"å¯¹æ€è€ƒé¢˜çš„ç­”æ¡ˆæé—®: etcd æ˜¯è¯»å¤šå†™å°‘çš„åœºæ™¯, ä¸ºä»€ä¹ˆæ˜¯åˆ›å»ºè¯»äº‹åŠ¡æ—¶å…¨é‡æ‹·è´ buffer, è€Œä¸æ˜¯åˆ›å»ºå†™äº‹åŠ¡ä¹‹æ—¶? ","like_count":0},{"had_liked":false,"id":324323,"user_name":"HelloBug","can_delete":false,"product_type":"c1","uid":1249598,"ip_address":"","ucode":"E61A4AD5C2F724","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/3e/925aa996.jpg","comment_is_top":false,"comment_ctime":1638370090,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1638370090","product_id":100069901,"comment_content":"åªè¦æœ‰ä¸€ä¸ªèŠ‚ç‚¹è¿›å…¥candidateçŠ¶æ€ï¼Œé›†ç¾¤å°±ä¼šé‡æ–°å‘èµ·é€‰ä¸¾å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":324322,"user_name":"HelloBug","can_delete":false,"product_type":"c1","uid":1249598,"ip_address":"","ucode":"E61A4AD5C2F724","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/3e/925aa996.jpg","comment_is_top":false,"comment_ctime":1638370013,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1638370013","product_id":100069901,"comment_content":"è€å¸ˆï¼Œä½ å¥½ï¼ŒLeaderé€‰ä¸¾éƒ¨åˆ†è®²åˆ°AèŠ‚ç‚¹åœ¨ç½‘ç»œæ¢å¤ä¹‹åï¼Œä¼šå‘èµ·æ–°ä¸€è½®çš„Leaderé€‰ä¸¾ï¼Œæ­¤æ—¶å› ä¸ºAçš„æ•°æ®è½åè¾ƒå¤šï¼Œä¸ä¼šæˆä¸ºæ–°çš„Leaderï¼Œè¿™æ ·ä¼šç ´åé›†ç¾¤çš„ç¨³å®šæ€§ã€‚Aå‘èµ·é€‰ä¸¾ä¹‹åï¼Œå…¶ä»–æ‰€æœ‰èŠ‚ç‚¹éƒ½ä¼šé‡æ–°å‘èµ·é€‰ä¸¾å—ï¼Ÿå¦‚æœä¸ä¼šï¼Œè€Œæ˜¯Aä¹Ÿå˜æˆäº†Followerï¼Œé‚£PreCandidateçš„å¼€é”€å’ŒAä¸»åŠ¨å‘èµ·é€‰ä¸¾å°±æ˜¯ä¸€æ ·çš„å§ï¼Ÿ","like_count":0},{"had_liked":false,"id":320101,"user_name":"fei","can_delete":false,"product_type":"c1","uid":2126331,"ip_address":"","ucode":"36D802EB42FEF3","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJOUjOGRlYNY1TDZpso7LQEhMyqmgUqEW3sm5xWTHqhU5rUol8NeEOxLMQA5ib09Y8Yg97ziaqsKduA/132","comment_is_top":false,"comment_ctime":1636082126,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1636082126","product_id":100069901,"comment_content":"raftæ—¥å¿—å¤åˆ¶ä¸­ï¼Œæåˆ°äº†ä¸‰ç§æ—¥å¿—ï¼š<br>ä¸€æ˜¯â€œæœªæŒä¹…åŒ–ã€ä¸ç¨³å®šçš„ Raft æ—¥å¿—â€ã€‚è¿™ä¸ªæ—¥å¿—åœ¨æµç¨‹å›¾ä¸­æ²¡æœ‰ç”»å‡ºæ¥ã€‚<br>äºŒæ˜¯WALæ—¥å¿—ã€‚è¿™æ˜¯æŒä¹…åŒ–çš„æ—¥å¿—ã€‚<br>ä¸‰æ˜¯æäº¤çš„æ—¥å¿—ã€‚æµç¨‹å›¾ä¸­å°±æ˜¯å­˜å‚¨çŠ¶æ€æœºã€‚<br>è¿™æ ·æ€»ç»“æ˜¯å¦æ­£ç¡®ï¼Ÿ<br><br>åœ¨è®²â€œæ—¥å¿—å¤åˆ¶è§„åˆ™â€æ—¶ï¼Œä¸‹é¢è¿™å¥è¯å®åœ¨è¯»ä¸é€šï¼š<br>â€œLeader åœ¨å‘é€è¿½åŠ æ—¥å¿— RPC æ¶ˆæ¯æ—¶ï¼Œä¼šæŠŠæ–°çš„æ—¥å¿—æ¡ç›®ç´§æ¥ç€ä¹‹å‰çš„æ¡ç›®çš„ç´¢å¼•ä½ç½®å’Œä»»æœŸå·åŒ…å«åœ¨é‡Œé¢ã€‚â€<br>èƒ½å¤Ÿæ›´æ­£ä¸€ä¸‹ã€‚<br>","like_count":0},{"had_liked":false,"id":312993,"user_name":"å´å±•","can_delete":false,"product_type":"c1","uid":1083545,"ip_address":"","ucode":"F7537C0570F212","user_header":"https://static001.geekbang.org/account/avatar/00/10/88/99/6945c324.jpg","comment_is_top":false,"comment_ctime":1632190860,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1632190860","product_id":100069901,"comment_content":"å¦‚æœBæ²¡æœ‰æŠŠæ–°çš„msgå¤åˆ¶åˆ°Aå’ŒCå‰ï¼ˆæˆ–å¤§éƒ¨åˆ†èŠ‚ç‚¹ï¼‰ï¼Œå®ƒä¼šç»™clientå›åº”æˆåŠŸå—ï¼Ÿæˆ‘è§‰å¾—ä¸ä¼šï¼Œä½†æ–‡ä¸­æè¿°çœ‹æ˜¯ä¼šçš„ã€‚å›°æƒ‘ï¼Œå¸Œæœ›å¸®å¿™è§£ç­”","like_count":0,"discussions":[{"author":{"id":1033630,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c5/9e/d6fce09c.jpg","nickname":"æš´èµ°çš„ğŸŒ","note":"","ucode":"804381D877E53C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549932,"discussion_content":"æ³¨æ„ï¼šé¢†å¯¼èŠ‚ç‚¹æäº¤çš„å‰ææ˜¯å¤§å¤šæ•°è·ŸéšèŠ‚ç‚¹éƒ½åŒæ„äº†è¿™ä¸ªææ¡ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644302480,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1033630,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c5/9e/d6fce09c.jpg","nickname":"æš´èµ°çš„ğŸŒ","note":"","ucode":"804381D877E53C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549931,"discussion_content":"é¢†å¯¼èŠ‚ç‚¹æäº¤äº†ï¼Œæ‰ä¼šç»™clientç«¯è¿”å›æˆåŠŸ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644302297,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":309692,"user_name":"whale song","can_delete":false,"product_type":"c1","uid":2712306,"ip_address":"","ucode":"73DC6AE6D7213C","user_header":"https://static001.geekbang.org/account/avatar/00/29/62/f2/2f7cfd4d.jpg","comment_is_top":false,"comment_ctime":1630306556,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630306556","product_id":100069901,"comment_content":"è€å¸ˆï¼Œæƒ³è¯·é—®ä¸€ä¸‹ï¼Œå‡å¦‚raftæ¨¡å—ä¸­ï¼Œä¸€æ¡æ—¥å¿—å·²ç»æäº¤äº†ï¼Œä½†åœ¨å›å¤å®¢æˆ·ç«¯ä¹‹å‰leaderæŒ‚æ‰çš„æƒ…å†µã€‚è¿™ç§æƒ…å†µä¸‹è¿™æ¡æ—¥å¿—æŒ‰ç…§raftç®—æ³•è§„åˆ™ï¼Œä¼šåœ¨åç»­æ–°leaderé€‰å‡ºä¹‹åæäº¤ç„¶ååº”ç”¨ï¼›ç„¶åå¯¹äºå®¢æˆ·ç«¯æ¥è¯´ï¼Œç›¸å½“äºæ­¤æ¬¡è¯·æ±‚å¤±è´¥ï¼Œç„¶åå¯èƒ½ä¼šæœ‰é‡è¯•çš„æƒ…å†µã€‚é‚£ä¹ˆè¿™ç§æƒ…å†µä¸‹æ˜¯å¦‚ä½•ä¿è¯å¹‚ç­‰æ€§çš„å‘€","like_count":0},{"had_liked":false,"id":307870,"user_name":"Nevermore","can_delete":false,"product_type":"c1","uid":1897833,"ip_address":"","ucode":"CAAD4D2F285890","user_header":"https://static001.geekbang.org/account/avatar/00/1c/f5/69/84987a60.jpg","comment_is_top":false,"comment_ctime":1629287571,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1629287571","product_id":100069901,"comment_content":"åŸæ–‡ï¼šâ€œA èŠ‚ç‚¹ crash åï¼Œå†æ¬¡å¯åŠ¨æˆä¸º Followerï¼Œå‡è®¾å› ä¸ºç½‘ç»œé—®é¢˜æ— æ³•è¿é€š Bã€C èŠ‚ç‚¹ï¼Œè¿™æ—¶å€™æ ¹æ®çŠ¶æ€å›¾ï¼Œæˆ‘ä»¬çŸ¥é“å®ƒå°†ä¸åœè‡ªå¢ä»»æœŸå·ï¼Œå‘èµ·é€‰ä¸¾ã€‚â€<br>è¯·é—®AèŠ‚ç‚¹ä¸ºä»€ä¹ˆä¼šä¸åœåœ°è‡ªå¢ä»»æœŸå·å‘¢ã€‚æŒ‰ç…§æˆ‘çš„ç†è§£ï¼ŒAèŠ‚ç‚¹ä¼šé€‰è‡ªå·±æˆä¸ºä¸»èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä»»æœŸå·ä¼š+1,å¹¶ä¸”å°±è¿™ä¹ˆä¸€ç›´ä¿æŒä¸å˜æ‰å¯¹ã€‚ ","like_count":0},{"had_liked":false,"id":300268,"user_name":"æ…¢åŠ¨ä½œ","can_delete":false,"product_type":"c1","uid":1133945,"ip_address":"","ucode":"62C944F4A4D8AC","user_header":"https://static001.geekbang.org/account/avatar/00/11/4d/79/803537db.jpg","comment_is_top":false,"comment_ctime":1625069485,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1625069485","product_id":100069901,"comment_content":"æ—¥å¿—å¤åˆ¶æµç¨‹ï¼Œåªæœ‰å½“leaderæŠŠæ—¥å¿—å¤åˆ¶åˆ°å¤§å¤šæ•°followeråï¼Œclientæ‰ä¼šæ”¶åˆ°æˆåŠŸåé¦ˆï¼Œè¿™å‘ç”Ÿåœ¨6ä¹‹åï¼Ÿå¦‚æœ56ä¹‹é—´leaderå®•æœºäº†ï¼Œå®¢æˆ·ç«¯æ˜¯è¶…æ—¶æ–­å¼€ï¼Œè¯¥æ¬¡è¯·æ±‚æ˜¯ä¸ç¡®å®šçŠ¶æ€å—ï¼Œæ—¥å¿—ä¹Ÿè®¸åªæ˜¯åœ¨å°‘éƒ¨åˆ†followeræŒä¹…åŒ–äº†ï¼Œå¦‚æœä¸€ä¸ªæ²¡æœ‰è¯¥æ—¥å¿—çš„followeré€‰ä¸¾æˆåŠŸï¼Œå°±ä¼šæŠ¹æ‰è¿™æ¡æ—¥å¿—ï¼Œåä¹‹åˆ™æäº¤æˆåŠŸï¼Ÿå› æ­¤ä¸åˆ é™¤æ—¥å¿—æ˜¯æŒ‡åœ¨leaderçš„çŠ¶æ€ä¸‹ä¸ä¼šåˆ é™¤ï¼Œä½†æ˜¯ä½ å˜æˆäº†followerï¼Œé‚£æ—¥å¿—è¿˜æ˜¯ä¼šè¢«åˆ é™¤çš„ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1752348,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/jA97yib7VetXc4iclOg2gGfZu1fO7efyib2mKeqvIxDdmgLqukusyFzPrbIQeZYR0WDJUicRakgVGroaYC7aWGFrEw/132","nickname":"Turing","note":"","ucode":"F88679276D4841","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388883,"discussion_content":"å°‘éƒ¨åˆ†æŒä¹…åŒ–, æ²¡æœ‰è¾¾åˆ°åŠæ•°, å¯ä»¥å½“åšæ— æ•ˆ. clienté‡è¯•.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629027163,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":297014,"user_name":"batman","can_delete":false,"product_type":"c1","uid":1266482,"ip_address":"","ucode":"73C30ACFC0D612","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/IIkdC2gohpcibib0AJvSdnJQefAuQYGlLySQOticThpF7Ck9WuDUQLJlgZ7ic13LIFnGBXXbMsSP3nZsbibBN98ZjGA/132","comment_is_top":false,"comment_ctime":1623284123,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1623284123","product_id":100069901,"comment_content":"Leader å®Œå…¨ç‰¹æ€§æ˜¯ç”±é€‰ä¸¾è§„åˆ™æ¥ä¿è¯çš„å—","like_count":0},{"had_liked":false,"id":297010,"user_name":"batman","can_delete":false,"product_type":"c1","uid":1266482,"ip_address":"","ucode":"73C30ACFC0D612","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/IIkdC2gohpcibib0AJvSdnJQefAuQYGlLySQOticThpF7Ck9WuDUQLJlgZ7ic13LIFnGBXXbMsSP3nZsbibBN98ZjGA/132","comment_is_top":false,"comment_ctime":1623282655,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1623282655","product_id":100069901,"comment_content":"æ–‡ä¸­è¯´â€œLeader ä¼šç»´æŠ¤ä¸¤ä¸ªæ ¸å¿ƒå­—æ®µæ¥è¿½è¸ªå„ä¸ª Follower çš„è¿›åº¦ä¿¡æ¯ï¼Œä¸€ä¸ªå­—æ®µæ˜¯ NextIndexï¼Œ å®ƒè¡¨ç¤º Leader å‘é€ç»™ Follower èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªæ—¥å¿—æ¡ç›®ç´¢å¼•ã€‚ä¸€ä¸ªå­—æ®µæ˜¯ MatchIndexï¼Œ å®ƒè¡¨ç¤º Follower èŠ‚ç‚¹å·²å¤åˆ¶çš„æœ€å¤§æ—¥å¿—æ¡ç›®çš„ç´¢å¼•â€ã€‚<br><br>æˆ‘çš„é—®é¢˜æ˜¯ï¼Œè¿™ä¸¤ä¸ªå­—æ®µæ˜¯æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šåŒæ­¥å—ï¼Ÿå¦‚æœä¸åŒæ­¥æ–°é€‰å‡ºæ¥çš„leaderæ€ä¹ˆç»´æŠ¤è¿™ä¸¤å­—æ®µï¼Ÿ","like_count":0},{"had_liked":false,"id":296960,"user_name":"batman","can_delete":false,"product_type":"c1","uid":1266482,"ip_address":"","ucode":"73C30ACFC0D612","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/IIkdC2gohpcibib0AJvSdnJQefAuQYGlLySQOticThpF7Ck9WuDUQLJlgZ7ic13LIFnGBXXbMsSP3nZsbibBN98ZjGA/132","comment_is_top":false,"comment_ctime":1623240581,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1623240581","product_id":100069901,"comment_content":"è€å¸ˆï¼Œå•¥å«æ•°æ®çš„å®Œæ•´æ€§ï¼Ÿèƒ½ä¸¾ä¸ªæ•°æ®ä¸å®Œæ•´çš„ä¾‹å­å—","like_count":0},{"had_liked":false,"id":295980,"user_name":"HD","can_delete":false,"product_type":"c1","uid":1088303,"ip_address":"","ucode":"3F61B901BB9245","user_header":"https://static001.geekbang.org/account/avatar/00/10/9b/2f/db466c67.jpg","comment_is_top":false,"comment_ctime":1622689814,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1622689814","product_id":100069901,"comment_content":"æƒ³è¯·æ•™ä¸€ä¸‹è€å¸ˆè¿™ä¸ªé—®é¢˜â€œæ€»è€Œè¨€ä¹‹ï¼Œä¸ç®¡æ˜¯ä¸»ä»å¤åˆ¶è¿˜æ˜¯å¼‚æ­¥å¤åˆ¶ï¼Œéƒ½å­˜åœ¨ä¸€å®šçš„ç¼ºé™·ã€‚â€ï¼Œå¤åˆ¶ç®—æ³•ç›¸å¯¹äºå…±è¯†ç®—æ³•çš„ç¼ºé™·å…·ä½“æ˜¯ä»€ä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1266482,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/IIkdC2gohpcibib0AJvSdnJQefAuQYGlLySQOticThpF7Ck9WuDUQLJlgZ7ic13LIFnGBXXbMsSP3nZsbibBN98ZjGA/132","nickname":"batman","note":"","ucode":"73C30ACFC0D612","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378546,"discussion_content":"æ•°æ®å¤åˆ¶æœ‰å»¶è¿Ÿï¼Œä¸èƒ½ä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623284230,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":293942,"user_name":"Geek_a754be","can_delete":false,"product_type":"c1","uid":2437733,"ip_address":"","ucode":"A18C3752E2C1C8","user_header":"","comment_is_top":false,"comment_ctime":1621638095,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1621638095","product_id":100069901,"comment_content":"æƒ³è¯·æ•™ä¸€ä¸‹è€å¸ˆå¦‚æœå‘ç”Ÿç½‘ç»œåˆ†åŒºï¼Œä¸¤ä¸ªåŒºä¸­éƒ½é€‰ä¸¾å‡ºäº†leaderï¼Œå¹¶ä¸”éƒ½æˆåŠŸcommitedäº†æ—¥å¿—ï¼Œå½“ç½‘ç»œæ¢å¤æ—¶ï¼Œé‡æ–°é€‰ä¸¾ä¹‹åçš„å·²æäº¤æ—¥å¿—æ˜¯å¦‚ä½•å¤„ç†çš„å‘¢ï¼Ÿæ–°leaderä¼šåŒæ­¥è€leaderçš„æ—¥å¿—å—ï¼Ÿè€leaderå†å›æ»šï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2027659,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/f0/8b/a806789b.jpg","nickname":"int8","note":"","ucode":"EDE812592B8C06","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377959,"discussion_content":"å³ä½¿å‘ç”Ÿäº†ç½‘ç»œåˆ†åŒºï¼Œä¹Ÿä¸ä¼šåœ¨ä¸€ä¸ªtermé€‰å‡ºå¤šä¸ªleader","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1622979647,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":293835,"user_name":"Geek_a754be","can_delete":false,"product_type":"c1","uid":2437733,"ip_address":"","ucode":"A18C3752E2C1C8","user_header":"","comment_is_top":false,"comment_ctime":1621572139,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1621572139","product_id":100069901,"comment_content":"è€å¸ˆæˆ‘æƒ³ä¸æ˜ç™½ä¸€ä¸ªé—®é¢˜ã€‚<br>æ—¢ç„¶leaderB crashäº†å®ƒçš„æ—¥å¿—6æ²¡æœ‰åŒæ­¥åˆ°Aå’ŒCï¼Œé‚£æ ·Aå’ŒCæ²¡æœ‰æœ€æ–°çš„æ—¥å¿—åº”è¯¥ä¸èƒ½å½“é€‰leaderå§ã€‚","like_count":0,"discussions":[{"author":{"id":1032462,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c1/0e/5f2751d6.jpg","nickname":"å¼¹ç°§æŒ¯å­","note":"","ucode":"140FA869F9A659","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377920,"discussion_content":"å¦‚æœæ—¥å¿—6æ²¡æœ‰åŒæ­¥åˆ°Aå’ŒCï¼Œé‚£è¯¥æ—¥å¿—å°±æ²¡æœ‰å†™æˆåŠŸï¼Œclientä¹Ÿæ˜¯å¯æ„ŸçŸ¥åˆ°è¿™ä¸€ç‚¹çš„ï¼Œå› æ­¤ä¸å½±å“Aå’ŒCé‡æ–°å½“é€‰leaderã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622964349,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":283808,"user_name":"å‡ºå–çµé­‚çš„æ•™ç»ƒKerry","can_delete":false,"product_type":"c1","uid":1807943,"ip_address":"","ucode":"8C64517DA556FE","user_header":"https://static001.geekbang.org/account/avatar/00/1b/96/47/93838ff7.jpg","comment_is_top":false,"comment_ctime":1615944493,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1615944493","product_id":100069901,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæœ‰5ä¸ªèŠ‚ç‚¹ï¼Œè€çš„Leaderå’Œä¸€ä¸ªç»„æˆä¸€ä¸ªåˆ†åŒºï¼Œå¦å¤–ä¸‰ä¸ªç»„æˆä¸€ä¸ªåˆ†åŒºå¹¶é€‰ä¸¾å‡ºä¸€ä¸ªLeaderã€‚æœ‰ä¸¤ä¸ªLeaderå¯¹å¤–æä¾›æœåŠ¡ï¼Œè¿™ç§æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1752348,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/jA97yib7VetXc4iclOg2gGfZu1fO7efyib2mKeqvIxDdmgLqukusyFzPrbIQeZYR0WDJUicRakgVGroaYC7aWGFrEw/132","nickname":"Turing","note":"","ucode":"F88679276D4841","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388886,"discussion_content":"ä¸å¯èƒ½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629027289,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":279300,"user_name":"Index","can_delete":false,"product_type":"c1","uid":1078909,"ip_address":"","ucode":"815A1A62F846CF","user_header":"https://static001.geekbang.org/account/avatar/00/10/76/7d/04c95885.jpg","comment_is_top":false,"comment_ctime":1613712867,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1613712867","product_id":100069901,"comment_content":"è¿˜æœ‰ä¸€ä¸ªç–‘é—®ï¼Œåœ¨nodeçš„ä¸»å¾ªç¯runå‡½æ•°é‡Œæ˜¯çŠ¶æ€æœºçŠ¶æ€å¤„ç†çš„ä¸»é€»è¾‘ã€‚for å¾ªç¯é‡Œçš„selectæ˜¯éšæœºçš„ï¼Œå¦‚æœpropcæˆ–è€…recvcã€readycçš„æ¶ˆæ¯å¤„ç†è¿‡å¤šï¼Œæ˜¯å¦ä¼šå¹²æ‰°å¿ƒè·³åŒ…çš„å‘é€ï¼Ÿæ¯ä¸ªchannelçš„å¤„ç†æ˜¯éšæœºçš„ï¼Œè¿™é‡Œæœ‰æ²¡æœ‰è€ƒè™‘å¤„ç†ä¼˜å…ˆçº§çš„å¿…è¦ï¼Ÿ<br><br>func (n *node) run(r *raft) {<br>\tvar propc chan raftpb.Message<br>\tvar readyc chan Ready<br><br>\tlead := None<br>\tprevSoftSt := r.softState()<br>\tprevHardSt := r.HardState<br>\tprevSnapi := r.raftLog.snapshot.Index<br><br>\tfor {<br>\t\trd := newReady(r, prevSoftSt, prevHardSt, prevSnapi)<br>\t\tif rd.containsUpdates() {<br>\t\t\treadyc = n.readyc<br>\t\t} else {<br>\t\t\treadyc = nil<br>\t\t}<br><br>\t\tif rd.SoftState != nil &amp;&amp; lead != rd.SoftState.Lead {<br>\t\t\tlog.Printf(&quot;raft: leader changed from %#x to %#x&quot;, lead, rd.SoftState.Lead)<br>\t\t\tlead = rd.SoftState.Lead<br>\t\t\tif r.hasLeader() {<br>\t\t\t\tpropc = n.propc<br>\t\t\t} else {<br>\t\t\t\tpropc = nil<br>\t\t\t}<br>\t\t}<br><br>\t\tselect {<br>\t\t&#47;&#47; TODO: maybe buffer the config propose if there exists one (the way<br>\t\t&#47;&#47; described in raft dissertation)<br>\t\t&#47;&#47; Currently it is dropped in Step silently.<br>\t\tcase m := &lt;-propc:<br>\t\t\tm.From = r.id<br>\t\t\tr.Step(m)<br>\t\tcase m := &lt;-n.recvc:<br>\t\t\tr.Step(m) &#47;&#47; raft never returns an error<br>\t\tcase c := &lt;-n.compactc:<br>\t\t\tr.compact(c.index, c.nodes, c.data)<br>\t\tcase cc := &lt;-n.confc:<br>\t\t\tif cc.NodeID == None {<br>\t\t\t\tr.resetPendingConf()<br>\t\t\t\tbreak<br>\t\t\t}<br>\t\t\tswitch cc.Type {<br>\t\t\tcase raftpb.ConfChangeAddNode:<br>\t\t\t\tr.addNode(cc.NodeID)<br>\t\t\tcase raftpb.ConfChangeRemoveNode:<br>\t\t\t\tr.removeNode(cc.NodeID)<br>\t\t\tdefault:<br>\t\t\t\tpanic(&quot;unexpected conf type&quot;)<br>\t\t\t}<br>\t\tcase &lt;-n.tickc:<br>\t\t\tr.tick()<br>\t\tcase readyc &lt;- rd:<br>\t\t\tif rd.SoftState != nil {<br>\t\t\t\tprevSoftSt = rd.SoftState<br>\t\t\t}<br>\t\t\tif !IsEmptyHardState(rd.HardState) {<br>\t\t\t\tprevHardSt = rd.HardState<br>\t\t\t}<br>\t\t\tif !IsEmptySnap(rd.Snapshot) {<br>\t\t\t\tprevSnapi = rd.Snapshot.Index<br>\t\t\t}<br>\t\t\t&#47;&#47; TODO(yichengq): we assume that all committed config<br>\t\t\t&#47;&#47; entries will be applied to make things easy for now.<br>\t\t\t&#47;&#47; TODO(yichengq): it may have race because applied is set<br>\t\t\t&#47;&#47; before entries are applied.<br>\t\t\tr.raftLog.resetNextEnts()<br>\t\t\tr.raftLog.resetUnstable()<br>\t\t\tr.msgs = nil<br>\t\tcase &lt;-n.done:<br>\t\t\treturn<br>\t\t}<br>}","like_count":0},{"had_liked":false,"id":277597,"user_name":"Buffalo","can_delete":false,"product_type":"c1","uid":1198446,"ip_address":"","ucode":"A066E048EBDA33","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ajNVdqHZLLBLNWibggjw6BHRvG4FoZuQeNtMwCFUepzp36u8u9kf9K2ibcEnoMn876WNAeib7JgIUvK9UPxWeenyQ/132","comment_is_top":false,"comment_ctime":1612488247,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1612488247","product_id":100069901,"comment_content":"å¤§ä½¬è¯·æ•™ä¸ªé—®é¢˜ï¼ŒETCDèˆå¼ƒäº†CAPçš„å“ªä¸ªï¼Ÿä»¥å‰æˆ‘ä»¥ä¸ºæ˜¯èˆå¼ƒäº†å¼ºä¸€è‡´æ€§ï¼Œä¿è¯å¯ç”¨æ€§ã€åˆ†åŒºå®¹é”™æ€§ã€‚ä½†æ˜¯ä»Šå¤©æˆ‘è¿·èŒ«äº†ã€‚","like_count":0,"discussions":[{"author":{"id":2437733,"avatar":"","nickname":"Geek_a754be","note":"","ucode":"A18C3752E2C1C8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375417,"discussion_content":"æˆ‘ç†è§£èˆå¼ƒçš„Aï¼Œæ˜¯ä¸€ä¸ªCPç³»ç»Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621638180,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":2437733,"avatar":"","nickname":"Geek_a754be","note":"","ucode":"A18C3752E2C1C8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551190,"discussion_content":"æ˜æ˜¾æ˜¯å®‰å…¨æ€§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644921414,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":375417,"ip_address":""},"score":551190,"extra":""}]}]},{"had_liked":false,"id":276375,"user_name":"å†™ç‚¹å•¥å‘¢","can_delete":false,"product_type":"c1","uid":1065272,"ip_address":"","ucode":"C19032CF1C41BA","user_header":"https://static001.geekbang.org/account/avatar/00/10/41/38/4f89095b.jpg","comment_is_top":false,"comment_ctime":1611904407,"is_pvip":false,"replies":[{"id":"100335","content":"æ˜¯çš„ï¼Œfolloweræ”¶åˆ°leaderå‘é€åˆ°çš„MsgAppæ¶ˆæ¯åï¼Œé€šè¿‡ä¸€ç³»åˆ—å®‰å…¨æ£€æŸ¥åï¼Œé¦–å…ˆæŒä¹…åŒ–åˆ°è‡ªå·±walä¸­ï¼Œç„¶åå†å›å¤ç»™leader MsgAppRespæ¶ˆæ¯çš„ï¼Œå¹¶è¿½åŠ åˆ°ç¨³å®šçš„raft logä¸­ã€‚æ‰€ä»¥è€leader crashåï¼Œæ­¤follower raft logä¸­å·²ç»å«æœ‰ç›¸å…³ææ¡ˆå¯¹åº”çš„æ—¥å¿—æ¡ç›®ï¼Œè‹¥æ­¤followerå¯ä»¥èµ¢å¾—é€‰ä¸¾ï¼Œæˆä¸ºæ–°leaderï¼Œé‚£ä¹ˆleader crashå‰æäº¤çš„ææ¡ˆï¼Œå°±ä¼šè¢«å®ƒå¤åˆ¶ç»™é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1612000809,"ip_address":"","comment_id":276375,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1611904407","product_id":100069901,"comment_content":"è¯·é—®å”è€å¸ˆï¼Œæˆ‘ç†è§£followerä¸Šçš„WALå’Œç¨³å®šraftæ—¥å¿—æ˜¯é€šè¿‡æ¥æ”¶leaderçš„MsgAppæ¶ˆæ¯æ¥æ›´æ–°çš„ã€‚é‚£å¦‚æœleaderæ˜¯åœ¨å‘é€MsgAppä¹‹åæ¥æ”¶MsgRespä¹‹å‰å´©æºƒï¼Œé€‰ä¸¾å®Œæˆçš„æ–°é›†ç¾¤å¦‚ä½•çŸ¥é“ä¸€ä¸ªæ—¥å¿—æ¡ç›®å·²ç»è¢«å¤šæ•°followeræŒä¹…åŒ–äº†å‘¢ï¼Ÿæ˜¯ä¸æ˜¯é€‰ä¸¾åé›†ç¾¤ä¸­çš„æ–°leaderå’Œfolloweræ˜¯ä¸æ˜¯æ ¹æ®è‡ªå·±raftæ¨¡å—ä¸­çš„ææ¡ˆæ—¥å¿—æ¥ç¡®å®šçš„ï¼Ÿè°¢è°¢","like_count":1,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514681,"discussion_content":"æ˜¯çš„ï¼Œfolloweræ”¶åˆ°leaderå‘é€åˆ°çš„MsgAppæ¶ˆæ¯åï¼Œé€šè¿‡ä¸€ç³»åˆ—å®‰å…¨æ£€æŸ¥åï¼Œé¦–å…ˆæŒä¹…åŒ–åˆ°è‡ªå·±walä¸­ï¼Œç„¶åå†å›å¤ç»™leader MsgAppRespæ¶ˆæ¯çš„ï¼Œå¹¶è¿½åŠ åˆ°ç¨³å®šçš„raft logä¸­ã€‚æ‰€ä»¥è€leader crashåï¼Œæ­¤follower raft logä¸­å·²ç»å«æœ‰ç›¸å…³ææ¡ˆå¯¹åº”çš„æ—¥å¿—æ¡ç›®ï¼Œè‹¥æ­¤followerå¯ä»¥èµ¢å¾—é€‰ä¸¾ï¼Œæˆä¸ºæ–°leaderï¼Œé‚£ä¹ˆleader crashå‰æäº¤çš„ææ¡ˆï¼Œå°±ä¼šè¢«å®ƒå¤åˆ¶ç»™é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612000809,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2449777,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDUJyeq54fiaXAgF62tNeocO3lHsKT4mygEcNoZLnibg6ONKicMgCgUHSfgW8hrMUXlwpNSzR8MHZwg/132","nickname":"types","note":"","ucode":"8B50927EF1804F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":352272,"discussion_content":"æ”¶åˆ°MsgAppçš„Follower æ˜¯å¦ä¸€å®šå¯ä»¥æˆä¸ºæ–°çš„leader","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614670473,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":275986,"user_name":"å·¦è€³æœµçŒ«","can_delete":false,"product_type":"c1","uid":1698192,"ip_address":"","ucode":"C79FCDD9B61303","user_header":"https://static001.geekbang.org/account/avatar/00/19/e9/90/2932d464.jpg","comment_is_top":false,"comment_ctime":1611737295,"is_pvip":false,"replies":[{"id":"100195","content":"å—¯ï¼Œæ™šä¸Šæ›´æ–°åˆ°04","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1611740812,"ip_address":"","comment_id":275986,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1611737295","product_id":100069901,"comment_content":"é¢ è€å¸ˆ ä¸ŠèŠ‚è¯¾çš„æ€è€ƒé¢˜ç­”æ¡ˆå‘¢.,æ˜¯xpensive readä¼šå¯¼è‡´é¢‘ç¹å‡çº§è¯»å†™é”.å¯¼è‡´å†™è¯·æ±‚å¾€åæ¨è¿Ÿ,ç„¶åå°±è¶…æ—¶äº†.å—","like_count":0,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514557,"discussion_content":"å—¯ï¼Œæ™šä¸Šæ›´æ–°åˆ°04","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611740812,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":275919,"user_name":"Simon","can_delete":false,"product_type":"c1","uid":1068163,"ip_address":"","ucode":"107606167D23E8","user_header":"https://static001.geekbang.org/account/avatar/00/10/4c/83/7788fc66.jpg","comment_is_top":false,"comment_ctime":1611717916,"is_pvip":true,"replies":[{"id":"100197","content":"æ˜¯çš„ï¼Œç¬”è¯¯ï¼Œå·²ä¿®æ­£ï¼Œè°¢è°¢","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1611747190,"ip_address":"","comment_id":275919,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1611717916","product_id":100069901,"comment_content":"åœ¨æ—¥å¿—å›¾ 2 ä¸­ï¼ŒFollower B è¿”å›ç»™ client æˆåŠŸåè‹¥çªç„¶ crash äº†ï¼Œæ­¤æ—¶å¯èƒ½è¿˜å¹¶æœªå°† 6 å·æ—¥å¿—æ¡ç›®å·²æäº¤çš„æ¶ˆæ¯é€šçŸ¥åˆ° Follower A å’Œ C<br><br>è€å¸ˆ, è¿™é‡Œçš„Follower Bæ˜¯ä¸æ˜¯Leader Bå•Š?","like_count":0,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514530,"discussion_content":"æ˜¯çš„ï¼Œç¬”è¯¯ï¼Œå·²ä¿®æ­£ï¼Œè°¢è°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611747190,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1083545,"avatar":"https://static001.geekbang.org/account/avatar/00/10/88/99/6945c324.jpg","nickname":"å´å±•","note":"","ucode":"F7537C0570F212","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":395024,"discussion_content":"å¦‚æœBæ²¡æœ‰æˆåŠŸé€šçŸ¥åˆ°Aå’ŒCï¼Œä¼šç»™clientå‘æˆåŠŸå—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632190933,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}