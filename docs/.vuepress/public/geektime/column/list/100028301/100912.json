{"id":100912,"title":"10 | JITç¼–è¯‘å™¨çš„æ­»ç©´ï¼šä¸ºä»€ä¹ˆè¦é¿å…ä½¿ç”¨ NYI ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æ¸©é“­ã€‚</p><p>ä¸Šä¸€èŠ‚ï¼Œæˆ‘ä»¬ä¸€èµ·äº†è§£äº† LuaJIT ä¸­çš„ FFIã€‚å¦‚æœä½ çš„é¡¹ç›®ä¸­åªç”¨åˆ°äº† OpenResty æä¾›çš„ APIï¼Œæ²¡æœ‰è‡ªå·±è°ƒç”¨ C å‡½æ•°çš„éœ€æ±‚ï¼Œé‚£ä¹ˆ FFI å¯¹ä½ è€Œè¨€å¹¶æ²¡æœ‰é‚£ä¹ˆé‡è¦ï¼Œä½ åªéœ€è¦ç¡®ä¿å¼€å¯äº† <code>lua-resty-core</code> å³å¯ã€‚</p><p>ä½†æˆ‘ä»¬ä»Šå¤©è¦è®²çš„ LuaJIT ä¸­ NYIï¼Œå´æ˜¯æ¯ä¸€ä¸ªä½¿ç”¨ OpenResty çš„å·¥ç¨‹å¸ˆéƒ½é€ƒé¿ä¸äº†çš„å…³é”®é—®é¢˜ï¼Œå®ƒå¯¹äºæ€§èƒ½çš„å½±å“ä¸¾è¶³è½»é‡ã€‚</p><p><strong>ä½ å¯ä»¥å¾ˆå¿«ä½¿ç”¨ OpenResty å†™å‡ºé€»è¾‘æ­£ç¡®çš„ä»£ç ï¼Œä½†ä¸æ˜ç™½ NYIï¼Œä½ å°±ä¸èƒ½å†™å‡ºé«˜æ•ˆçš„ä»£ç ï¼Œæ— æ³•å‘æŒ¥ OpenResty çœŸæ­£çš„å¨åŠ›</strong>ã€‚è¿™ä¸¤è€…çš„æ€§èƒ½å·®è·ï¼Œè‡³å°‘æ˜¯ä¸€ä¸ªæ•°é‡çº§çš„ã€‚</p><h2>ä»€ä¹ˆæ˜¯ NYIï¼Ÿ</h2><p>é‚£ç©¶ç«Ÿä»€ä¹ˆæ˜¯ NYI å‘¢ï¼Ÿå…ˆå›é¡¾ä¸‹æˆ‘ä»¬ä¹‹å‰æåˆ°è¿‡çš„ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼š</p><p><strong>LuaJIT çš„è¿è¡Œæ—¶ç¯å¢ƒï¼Œé™¤äº†ä¸€ä¸ªæ±‡ç¼–å®ç°çš„ Lua è§£é‡Šå™¨å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå¯ä»¥ç›´æ¥ç”Ÿæˆæœºå™¨ä»£ç çš„ JIT ç¼–è¯‘å™¨ã€‚</strong></p><p>LuaJIT ä¸­ JIT ç¼–è¯‘å™¨çš„å®ç°è¿˜ä¸å®Œå–„ï¼Œæœ‰ä¸€äº›åŸè¯­å®ƒè¿˜æ— æ³•ç¼–è¯‘ï¼Œå› ä¸ºè¿™äº›åŸè¯­å®ç°èµ·æ¥æ¯”è¾ƒå›°éš¾ï¼Œå†åŠ ä¸Š LuaJIT çš„ä½œè€…ç›®å‰å¤„äºåŠé€€ä¼‘çŠ¶æ€ã€‚è¿™äº›åŸè¯­åŒ…æ‹¬å¸¸è§çš„ pairs() å‡½æ•°ã€unpack() å‡½æ•°ã€åŸºäº Lua CFunction å®ç°çš„ Lua C æ¨¡å—ç­‰ã€‚è¿™æ ·ä¸€æ¥ï¼Œå½“ JIT ç¼–è¯‘å™¨åœ¨å½“å‰ä»£ç è·¯å¾„ä¸Šé‡åˆ°å®ƒä¸æ”¯æŒçš„æ“ä½œæ—¶ï¼Œä¾¿ä¼šé€€å›åˆ°è§£é‡Šå™¨æ¨¡å¼ã€‚</p><!-- [[[read_end]]] --><p>è€ŒJIT ç¼–è¯‘å™¨ä¸æ”¯æŒçš„è¿™äº›åŸè¯­ï¼Œå…¶å®å°±æ˜¯æˆ‘ä»¬ä»Šå¤©è¦è®²çš„ NYIï¼Œå…¨ç§°ä¸ºNot Yet Implementedã€‚LuaJIT çš„å®˜ç½‘ä¸Šæœ‰<a href=\"http://wiki.luajit.org/NYI\">è¿™äº› NYI çš„å®Œæ•´åˆ—è¡¨</a>ï¼Œå»ºè®®ä½ ä»”ç»†æµè§ˆä¸€éã€‚å½“ç„¶ï¼Œç›®çš„ä¸æ˜¯è®©ä½ èƒŒä¸‹è¿™ä¸ªåˆ—è¡¨çš„å†…å®¹ï¼Œè€Œæ˜¯è®©ä½ è¦åœ¨å†™ä»£ç çš„æ—¶å€™æœ‰æ„è¯†åœ°æé†’è‡ªå·±ã€‚</p><p>ä¸‹é¢ï¼Œæˆ‘æˆªå–äº† NYI åˆ—è¡¨ä¸­ string åº“çš„å‡ ä¸ªå‡½æ•°ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/1b/91/1b15183f8282ce235379281a961bd991.png?wh=1020*372\" alt=\"\"></p><p>å…¶ä¸­ï¼Œ<code>string.byte</code> å¯¹åº”çš„èƒ½å¦è¢«ç¼–è¯‘çš„çŠ¶æ€æ˜¯ <code>yes</code>ï¼Œè¡¨æ˜å¯ä»¥è¢« JITï¼Œä½ å¯ä»¥æ”¾å¿ƒå¤§èƒ†åœ°åœ¨ä»£ç ä¸­ä½¿ç”¨ã€‚</p><p><code>string.char</code> å¯¹åº”çš„ç¼–è¯‘çŠ¶æ€æ˜¯ <code>2.1</code>ï¼Œè¡¨æ˜ä» LuaJIT 2.1å¼€å§‹æ”¯æŒã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒOpenResty ä¸­çš„ LuaJIT æ˜¯åŸºäº LuaJIT 2.1 çš„ï¼Œæ‰€ä»¥ä½ ä¹Ÿå¯ä»¥æ”¾å¿ƒä½¿ç”¨ã€‚</p><p><code>string.dump</code> å¯¹åº”çš„ç¼–è¯‘çŠ¶æ€æ˜¯ <code>never</code>ï¼Œå³ä¸ä¼šè¢« JITï¼Œä¼šé€€å›åˆ°è§£é‡Šå™¨æ¨¡å¼ã€‚ç›®å‰æ¥çœ‹ï¼Œæœªæ¥ä¹Ÿæ²¡æœ‰è®¡åˆ’æ”¯æŒè¿™ä¸ªåŸè¯­ã€‚</p><p><code>string.find</code> å¯¹åº”çš„ç¼–è¯‘çŠ¶æ€æ˜¯ <code>2.1 partial</code>ï¼Œæ„æ€æ˜¯ä» LuaJIT 2.1 å¼€å§‹éƒ¨åˆ†æ”¯æŒï¼Œåé¢çš„å¤‡æ³¨ä¸­å†™çš„æ˜¯ <code>åªæ”¯æŒæœç´¢å›ºå®šçš„å­—ç¬¦ä¸²ï¼Œä¸æ”¯æŒæ¨¡å¼åŒ¹é…</code>ã€‚æ‰€ä»¥å¯¹äºå›ºå®šå­—ç¬¦ä¸²çš„æŸ¥æ‰¾ï¼Œä½ ä½¿ç”¨ <code>string.find</code> æ˜¯å¯ä»¥è¢« JIT çš„ã€‚</p><p>æˆ‘ä»¬è‡ªç„¶åº”è¯¥é¿å…ä½¿ç”¨ NYIï¼Œè®©æ›´å¤šçš„ä»£ç å¯ä»¥è¢« JIT ç¼–è¯‘ï¼Œè¿™æ ·æ€§èƒ½æ‰èƒ½å¾—åˆ°ä¿è¯ã€‚ä½†åœ¨ç°å®ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬æœ‰æ—¶å€™ä¸å¯é¿å…è¦ç”¨åˆ°ä¸€äº› NYI å‡½æ•°çš„åŠŸèƒ½ï¼Œè¿™æ—¶åˆè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><h2>NYI çš„æ›¿ä»£æ–¹æ¡ˆ</h2><p>å…¶å®ï¼Œä¸ç”¨æ‹…å¿ƒï¼Œå¤§éƒ¨åˆ† NYI å‡½æ•°æˆ‘ä»¬éƒ½å¯ä»¥æ•¬è€Œè¿œä¹‹ï¼Œé€šè¿‡å…¶ä»–æ–¹å¼æ¥å®ç°å®ƒä»¬çš„åŠŸèƒ½ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘æŒ‘é€‰äº†å‡ ä¸ªå…¸å‹çš„NYIæ¥è®²è§£ï¼Œå¸¦ä½ äº†è§£ä¸åŒç±»å‹çš„NYI æ›¿ä»£æ–¹æ¡ˆã€‚è¿™æ ·ï¼Œå…¶ä»–çš„ NYI ä½ ä¹Ÿå¯ä»¥è‡ªå·±è§¦ç±»æ—é€šã€‚</p><h3>1.string.gsub() å‡½æ•°</h3><p>ç¬¬ä¸€ä¸ªæˆ‘ä»¬æ¥çœ‹string.gsub() å‡½æ•°ã€‚å®ƒæ˜¯ Lua å†…ç½®çš„å­—ç¬¦ä¸²æ“ä½œå‡½æ•°ï¼Œä½œç”¨æ˜¯åšå…¨å±€çš„å­—ç¬¦ä¸²æ›¿æ¢ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p><pre><code>$ resty -e 'local new = string.gsub(&quot;banana&quot;, &quot;a&quot;, &quot;A&quot;); print(new)'\nbAnAnA\n</code></pre><p>è¿™ä¸ªå‡½æ•°æ˜¯ä¸€ä¸ª NYI åŸè¯­ï¼Œæ— æ³•è¢« JIT ç¼–è¯‘ã€‚</p><p>æˆ‘ä»¬å¯ä»¥å°è¯•åœ¨ OpenResty è‡ªå·±çš„ API ä¸­å¯»æ‰¾æ›¿ä»£å‡½æ•°ï¼Œä½†å¯¹äºå¤§å¤šæ•°äººæ¥è¯´ï¼Œè®°ä½æ‰€æœ‰çš„ API å’Œç”¨æ³•æ˜¯ä¸ç°å®çš„ã€‚æ‰€ä»¥åœ¨å¹³æ—¶å¼€å‘ä¸­ï¼Œæˆ‘éƒ½ä¼šæ‰“å¼€ lua-nginx-module çš„ <a href=\"https://github.com/openresty/lua-nginx-module\">GitHub æ–‡æ¡£é¡µé¢</a>ã€‚</p><p>æ¯”å¦‚ï¼Œé’ˆå¯¹åˆšåˆšçš„è¿™ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ <code>gsub</code> ä½œä¸ºå…³é”®å­—ï¼Œåœ¨æ–‡æ¡£é¡µé¢ä¸­æœç´¢ï¼Œè¿™æ—¶<code>ngx.re.gsub</code> å°±ä¼šæ˜ å…¥çœ¼å¸˜ã€‚</p><p>ç»†å¿ƒçš„åŒå­¦å¯èƒ½ä¼šé—®ï¼Œè¿™é‡Œä¸ºä»€ä¹ˆä¸ç”¨ä¹‹å‰æ¨èçš„ <code>restydoc</code> å·¥å…·ï¼Œæ¥æœç´¢ OpenResty API å‘¢ï¼Ÿä½ å¯ä»¥å°è¯•ä¸‹ç”¨å®ƒæ¥æœç´¢ <code>gsub</code>ï¼š</p><pre><code>$ restydoc -s gsub\n</code></pre><p>çœ‹åˆ°äº†å§ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰è¿”å›æˆ‘ä»¬æœŸæœ›çš„ <code>ngx.re.gsub</code>ï¼Œè€Œæ˜¯æ˜¾ç¤ºäº† Lua è‡ªå¸¦çš„å‡½æ•°ã€‚äº‹å®ä¸Šï¼Œç°é˜¶æ®µè€Œè¨€ï¼Œ <code>restydoc</code> è¿”å›çš„æ˜¯å”¯ä¸€çš„ç²¾å‡†åŒ¹é…çš„ç»“æœï¼Œæ‰€ä»¥å®ƒæ›´é€‚åˆåœ¨ä½ æ˜ç¡®çŸ¥é“ API åå­—çš„å‰æä¸‹ä½¿ç”¨ã€‚è‡³äºæ¨¡ç³Šçš„æœç´¢ï¼Œè¿˜æ˜¯è¦è‡ªå·±æ‰‹åŠ¨åœ¨æ–‡æ¡£ä¸­è¿›è¡Œã€‚</p><p>å›åˆ°åˆšåˆšçš„æœç´¢ç»“æœï¼Œæˆ‘ä»¬çœ‹åˆ°ï¼Œ<code>ngx.re.gsub</code> çš„å‡½æ•°å®šä¹‰å¦‚ä¸‹ï¼š</p><blockquote>\n<p>newstr, n, err = ngx.re.gsub(subject, regex, replace, options?)</p>\n</blockquote><p>è¿™é‡Œï¼Œå‡½æ•°å‚æ•°å’Œè¿”å›å€¼çš„å‘½åéƒ½å¸¦æœ‰å…·ä½“çš„å«ä¹‰ã€‚å…¶å®ï¼Œåœ¨ OpenResty ä¸­ï¼Œæˆ‘å¹¶ä¸æ¨èä½ å†™å¾ˆå¤šæ³¨é‡Šï¼Œå¤§å¤šæ•°æ—¶å€™ï¼Œä¸€ä¸ªå¥½çš„å‘½åèƒœè¿‡å¥½å‡ è¡Œæ³¨é‡Šã€‚</p><p>å¯¹äºä¸ç†Ÿæ‚‰ OpenResty æ­£åˆ™ä½“ç³»çš„å·¥ç¨‹å¸ˆè€Œè¨€ï¼Œçœ‹åˆ°æœ€åçš„å˜å‚ <code>options</code> ï¼Œä½ å¯èƒ½ä¼šæ¯”è¾ƒå›°æƒ‘ã€‚ä¸è¿‡ï¼Œè¿™ä¸ªå˜å‚çš„è§£é‡Šï¼Œå¹¶ä¸åœ¨æ­¤å‡½æ•°ä¸­ï¼Œè€Œæ˜¯åœ¨ <code>ngx.re.match</code> å‡½æ•°çš„æ–‡æ¡£ä¸­ã€‚</p><p>é€šè¿‡æŸ¥çœ‹å‚æ•° <code>options</code> çš„æ–‡æ¡£ï¼Œä½ ä¼šå‘ç°ï¼Œåªè¦æˆ‘ä»¬æŠŠå®ƒè®¾ç½®ä¸º <code>jo</code>ï¼Œå°±å¼€å¯äº†PCRE çš„ JITã€‚è¿™æ ·ï¼Œä½¿ç”¨ <code>ngx.re.gsub</code> çš„ä»£ç ï¼Œæ—¢å¯ä»¥è¢« LuaJIT è¿›è¡Œ JIT ç¼–è¯‘ï¼Œä¹Ÿå¯ä»¥è¢« PCRE JIT è¿›è¡Œ JIT ç¼–è¯‘ã€‚</p><p>å…·ä½“çš„æ–‡æ¡£å†…å®¹ï¼Œæˆ‘å°±ä¸å†èµ˜è¿°äº†ã€‚ä¸è¿‡è¿™é‡Œæˆ‘æƒ³å¼ºè°ƒä¸€ç‚¹â€”â€”åœ¨ç¿»çœ‹æ–‡æ¡£æ—¶ï¼Œæˆ‘ä»¬ä¸€å®šè¦æœ‰æ‰“ç ´ç ‚é”…é—®åˆ°åº•çš„ç²¾ç¥ã€‚OpenResty çš„æ–‡æ¡£å…¶å®éå¸¸å®Œå–„ï¼Œä»”ç»†é˜…è¯»æ–‡æ¡£ï¼Œå°±å¯ä»¥è§£å†³ä½ å¤§éƒ¨åˆ†çš„é—®é¢˜ã€‚</p><h3>2.string.find() å‡½æ•°</h3><p>å’Œ <code>string.gsub</code> ä¸åŒçš„æ˜¯ï¼Œ<code>string.find</code> åœ¨ plain æ¨¡å¼ï¼ˆå³å›ºå®šå­—ç¬¦ä¸²çš„æŸ¥æ‰¾ï¼‰ä¸‹ï¼Œæ˜¯å¯ä»¥è¢«JIT çš„ï¼›è€Œå¸¦æœ‰æ­£åˆ™è¿™ç§çš„å­—ç¬¦ä¸²æŸ¥æ‰¾ï¼Œ<code>string.find</code> å¹¶ä¸èƒ½è¢« JIT ï¼Œè¿™æ—¶å°±è¦æ¢ç”¨ OpenResty è‡ªå·±çš„ APIï¼Œä¹Ÿå°±æ˜¯ <code>ngx.re.find</code> æ¥å®Œæˆã€‚</p><p>æ‰€ä»¥ï¼Œå½“ä½ åœ¨ OpenResty ä¸­åšå­—ç¬¦ä¸²æŸ¥æ‰¾æ—¶ï¼Œé¦–å…ˆä¸€å®šè¦æ˜ç¡®åŒºåˆ†ï¼Œä½ è¦æŸ¥æ‰¾çš„æ˜¯å›ºå®šçš„å­—ç¬¦ä¸²ï¼Œè¿˜æ˜¯æ­£åˆ™è¡¨è¾¾å¼ã€‚å¦‚æœæ˜¯å‰è€…ï¼Œå°±è¦ç”¨ <code>string.find</code>ï¼Œå¹¶ä¸”è®°å¾—æŠŠæœ€åçš„ plain è®¾ç½®ä¸º trueï¼š</p><pre><code>string.find(&quot;foo bar&quot;, &quot;foo&quot;, 1, true)\n</code></pre><p>å¦‚æœæ˜¯åè€…ï¼Œä½ åº”è¯¥ç”¨ OpenResty è‡ªå·±çš„ APIï¼Œå¹¶å¼€å¯ PCRE çš„ JIT é€‰é¡¹ï¼š</p><pre><code>ngx.re.find(&quot;foo bar&quot;, &quot;^foo&quot;, &quot;jo&quot;)\n</code></pre><p>å…¶å®ï¼Œ<strong>è¿™é‡Œæ›´é€‚åˆåšä¸€å±‚å°è£…ï¼Œå¹¶æŠŠä¼˜åŒ–é€‰é¡¹é»˜è®¤æ‰“å¼€ï¼Œä¸è¦è®©æœ€ç»ˆçš„ä½¿ç”¨è€…çŸ¥é“è¿™ä¹ˆå¤šç»†èŠ‚</strong>ã€‚è¿™æ ·ï¼Œå¯¹å¤–å°±æ˜¯ç»Ÿä¸€çš„å­—ç¬¦ä¸²æŸ¥æ‰¾å‡½æ•°äº†ã€‚ä½ å¯ä»¥æ„Ÿå—åˆ°ï¼Œæœ‰æ—¶å€™é€‰æ‹©å¤ªå¤šã€å¤ªçµæ´»å¹¶ä¸æ˜¯ä¸€ä»¶å¥½äº‹ã€‚</p><h3>3.unpack() å‡½æ•°</h3><p>ç¬¬ä¸‰ä¸ªæˆ‘ä»¬æ¥çœ‹unpack() å‡½æ•°ã€‚unpack() ä¹Ÿæ˜¯è¦é¿å…ä½¿ç”¨çš„å‡½æ•°ï¼Œç‰¹åˆ«æ˜¯ä¸è¦åœ¨å¾ªç¯ä½“ä¸­ä½¿ç”¨ã€‚ä½ å¯ä»¥æ”¹ç”¨æ•°ç»„çš„ä¸‹æ ‡å»è®¿é—®ï¼Œæ¯”å¦‚ä¸‹é¢ä»£ç çš„è¿™ä¸ªä¾‹å­ï¼š</p><pre><code>$ resty -e '\n local a = {100, 200, 300, 400}\n for i = 1, 2 do\n    print(unpack(a))\n end'\n\n$ resty -e 'local a = {100, 200, 300, 400}\n for i = 1, 2 do\n    print(a[1], a[2], a[3], a[4])\n end'\n</code></pre><p>è®©æˆ‘ä»¬å†æ·±ç©¶ä¸€ä¸‹ unpackï¼Œè¿™æ¬¡æˆ‘ä»¬å¯ä»¥ç”¨<code>restydoc</code> æ¥æœç´¢ä¸€ä¸‹ï¼š</p><pre><code>$ restydoc -s unpack\n</code></pre><p>ä» unpack çš„æ–‡æ¡£ä¸­ï¼Œä½ å¯ä»¥çœ‹å‡ºï¼Œ<code>unpack (list [, i [, j]])</code> å’Œ <code>return list[i], list[i+1], , list[j]</code> æ˜¯ç­‰ä»·çš„ï¼Œä½ å¯ä»¥æŠŠ <code>unpack</code> çœ‹æˆä¸€ä¸ªè¯­æ³•ç³–ã€‚è¿™æ ·ï¼Œä½ å®Œå…¨å¯ä»¥ç”¨æ•°ç»„ä¸‹æ ‡çš„æ–¹å¼æ¥è®¿é—®ï¼Œä»¥å…æ‰“æ–­ LuaJIT çš„ JIT ç¼–è¯‘ã€‚</p><h3>4.pairs() å‡½æ•°</h3><p>æœ€åæˆ‘ä»¬æ¥çœ‹éå†å“ˆå¸Œè¡¨çš„ pairs() å‡½æ•°ï¼Œå®ƒä¹Ÿä¸èƒ½è¢« JIT ç¼–è¯‘ã€‚</p><p>ä¸è¿‡éå¸¸é—æ†¾ï¼Œè¿™ä¸ªå¹¶æ²¡æœ‰ç­‰ä»·çš„æ›¿ä»£æ–¹æ¡ˆï¼Œä½ åªèƒ½å°½é‡é¿å…ä½¿ç”¨ï¼Œæˆ–è€…æ”¹ç”¨æ•°å­—ä¸‹æ ‡è®¿é—®çš„æ•°ç»„ï¼Œç‰¹åˆ«æ˜¯åœ¨çƒ­ä»£ç è·¯å¾„ä¸Šä¸è¦éå†å“ˆå¸Œè¡¨ã€‚è¿™é‡Œæˆ‘è§£é‡Šä¸€ä¸‹<strong>ä»£ç çƒ­è·¯å¾„ï¼Œå®ƒçš„æ„æ€æ˜¯ï¼Œè¿™æ®µä»£ç ä¼šè¢«è¿”å›æ‰§è¡Œå¾ˆå¤šæ¬¡ï¼Œæ¯”å¦‚åœ¨ä¸€ä¸ªå¾ˆå¤§çš„å¾ªç¯é‡Œé¢ã€‚</strong></p><p>è¯´å®Œè¿™å››ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ï¼Œè¦æƒ³è§„é¿ NYI åŸè¯­çš„ä½¿ç”¨ï¼Œä½ éœ€è¦æ³¨æ„ä¸‹é¢è¿™ä¸¤ç‚¹ï¼š</p><ul>\n<li>è¯·ä¼˜å…ˆä½¿ç”¨ OpenResty æä¾›çš„ APIï¼Œè€Œä¸æ˜¯ Lua çš„æ ‡å‡†åº“å‡½æ•°ã€‚è¿™é‡Œè¦ç‰¢è®°ï¼Œ Lua æ˜¯åµŒå…¥å¼è¯­è¨€ï¼Œæˆ‘ä»¬å®é™…ä¸Šæ˜¯åœ¨ OpenResty ä¸­ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯ Luaã€‚</li>\n<li>å¦‚æœä¸‡ä¸å¾—å·²è¦ä½¿ç”¨ NYI åŸè¯­ï¼Œè¯·ä¸€å®šç¡®ä¿å®ƒæ²¡æœ‰åœ¨ä»£ç çƒ­è·¯å¾„ä¸Šã€‚</li>\n</ul><h2>å¦‚ä½•æ£€æµ‹ NYIï¼Ÿ</h2><p>è®²äº†è¿™ä¹ˆå¤šNYI çš„è§„é¿æ–¹æ¡ˆï¼Œéƒ½æ˜¯åœ¨æ•™ä½ è¯¥æ€ä¹ˆåšã€‚ä¸è¿‡ï¼Œå¦‚æœåˆ°è¿™é‡Œæˆ›ç„¶è€Œæ­¢ï¼Œé‚£å°±ä¸å¤ªç¬¦åˆ OpenResty å¥‰è¡Œçš„ä¸€ä¸ªå“²å­¦ï¼š</p><p><strong>èƒ½è®©æœºå™¨è‡ªåŠ¨å®Œæˆçš„ï¼Œå°±ä¸è¦äººå·¥å‚ä¸ã€‚</strong></p><p>äººä¸æ˜¯æœºå™¨ï¼Œæ€»ä¼šæœ‰ç–æ¼ï¼Œèƒ½å¤Ÿè‡ªåŠ¨åŒ–åœ°æ£€æµ‹ä»£ç ä¸­ä½¿ç”¨åˆ°çš„ NYIï¼Œæ‰æ˜¯å·¥ç¨‹å¸ˆä»·å€¼çš„ä¸€ä¸ªé‡è¦ä½“ç°ã€‚</p><p>è¿™é‡Œæˆ‘æ¨èï¼ŒLuaJIT è‡ªå¸¦çš„ <code>jit.dump</code> å’Œ <code>jit.v</code> æ¨¡å—ã€‚å®ƒä»¬éƒ½å¯ä»¥æ‰“å°å‡º JIT ç¼–è¯‘å™¨å·¥ä½œçš„è¿‡ç¨‹ã€‚å‰è€…ä¼šè¾“å‡ºéå¸¸è¯¦ç»†çš„ä¿¡æ¯ï¼Œå¯ä»¥ç”¨æ¥è°ƒè¯• LuaJIT æœ¬èº«ï¼Œä½ å¯ä»¥å‚è€ƒ<a href=\"https://github.com/openresty/luajit2/blob/v2.1-agentzh/src/jit/dump.lua\">å®ƒçš„æºç </a>æ¥åšæ›´æ·±å…¥çš„äº†è§£ï¼›åè€…çš„è¾“å‡ºæ¯”è¾ƒç®€å•ï¼Œæ¯è¡Œå¯¹åº”ä¸€ä¸ª traceï¼Œé€šå¸¸ç”¨æ¥æ£€æµ‹æ˜¯å¦å¯ä»¥è¢« JITã€‚</p><p>å…·ä½“åº”è¯¥æ€ä¹ˆæ“ä½œå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥å…ˆåœ¨ <code>init_by_lua</code> ä¸­ï¼Œæ·»åŠ ä»¥ä¸‹ä¸¤è¡Œä»£ç ï¼š</p><pre><code>local v = require &quot;jit.v&quot;\nv.on(&quot;/tmp/jit.log&quot;)\n</code></pre><p>ç„¶åï¼Œè¿è¡Œä½ è‡ªå·±çš„å‹åŠ›æµ‹è¯•å·¥å…·ï¼Œæˆ–è€…è·‘å‡ ç™¾ä¸ªå•å…ƒæµ‹è¯•é›†ï¼Œè®© LuaJIT è¶³å¤Ÿçƒ­ï¼Œè§¦å‘ JIT ç¼–è¯‘ã€‚è¿™äº›éƒ½å®Œæˆåï¼Œå†æ¥æ£€æŸ¥ <code>/tmp/jit.log</code> çš„ç»“æœã€‚</p><p>å½“ç„¶ï¼Œè¿™ä¸ªæ–¹æ³•ç›¸å¯¹æ¯”è¾ƒç¹çï¼Œå¦‚æœä½ æƒ³è¦ç®€å•éªŒè¯çš„è¯ï¼Œ ä½¿ç”¨ <code>resty</code> å°±è¶³å¤Ÿäº†ï¼Œè¿™ä¸ª OpenResty çš„ CLI å¸¦æœ‰ç›¸å…³é€‰é¡¹ï¼š</p><pre><code>$resty -j v -e 'for i=1, 1000 do\n      local newstr, n, err = ngx.re.gsub(&quot;hello, world&quot;, &quot;([a-z])[a-z]+&quot;, &quot;[$0,$1]&quot;, &quot;i&quot;)\n end'\n [TRACE   1 (command line -e):1 stitch C:107bc91fd]\n [TRACE   2 (1/stitch) (command line -e):2 -&gt; 1]\n</code></pre><p>å…¶ä¸­ï¼Œ<code>resty</code> çš„ <code>-j</code> å°±æ˜¯å’Œ LuaJIT ç›¸å…³çš„é€‰é¡¹ï¼›åé¢çš„å€¼ä¸º <code>dump</code> å’Œ <code>v</code>ï¼Œå°±å¯¹åº”ç€å¼€å¯ <code>jit.dump</code> å’Œ <code>jit.v</code> æ¨¡å¼ã€‚</p><p>åœ¨ jit.v æ¨¡å—çš„è¾“å‡ºä¸­ï¼Œæ¯ä¸€è¡Œéƒ½æ˜¯ä¸€ä¸ªæˆåŠŸç¼–è¯‘çš„ trace å¯¹è±¡ã€‚åˆšåˆšæ˜¯ä¸€ä¸ªèƒ½å¤Ÿè¢« JIT çš„ä¾‹å­ï¼Œè€Œå¦‚æœé‡åˆ° NYI åŸè¯­ï¼Œè¾“å‡ºé‡Œé¢å°±ä¼šæŒ‡æ˜ NYIï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ª <code>pairs</code> çš„ä¾‹å­ï¼š</p><pre><code>$resty -j v -e 'local t = {}\n for i=1,100 do\n     t[i] = i\n end\n \n for i=1, 1000 do\n     for j=1,1000 do\n         for k,v in pairs(t) do\n             --\n         end\n     end\n end'\n</code></pre><p>å®ƒå°±ä¸èƒ½è¢« JITï¼Œæ‰€ä»¥ç»“æœé‡Œï¼ŒæŒ‡æ˜äº†ç¬¬ 8 è¡Œä¸­æœ‰ NYI åŸè¯­ã€‚</p><pre><code> [TRACE   1 (command line -e):2 loop]\n [TRACE --- (command line -e):7 -- NYI: bytecode 72 at (command line -e):8]\n</code></pre><h2>å†™åœ¨æœ€å</h2><p>è¿™æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡ç”¨æ¯”è¾ƒå¤šçš„ç¯‡å¹…æ¥è°ˆåŠ OpenResty çš„æ€§èƒ½é—®é¢˜ã€‚çœ‹å®Œè¿™äº›å…³äº NYI çš„ä¼˜åŒ–ï¼Œä¸çŸ¥é“ä½ æœ‰ä»€ä¹ˆæ„Ÿæƒ³å‘¢ï¼Ÿå¯ä»¥ç•™è¨€è¯´è¯´ä½ çš„çœ‹æ³•ã€‚</p><p>æœ€åï¼Œç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜ã€‚åœ¨è®² string.find() å‡½æ•°çš„æ›¿ä»£æ–¹æ¡ˆæ—¶ï¼Œæˆ‘æœ‰æåˆ°è¿‡ï¼Œé‚£é‡Œå…¶å®<strong>æ›´é€‚åˆåšä¸€å±‚å°è£…ï¼Œå¹¶é»˜è®¤æ‰“å¼€ä¼˜åŒ–é€‰é¡¹</strong>ã€‚é‚£ä¹ˆï¼Œè¿™ä¸ªä»»åŠ¡å°±äº¤ç»™ä½ æ¥å°è¯•ç‰›åˆ€äº†ã€‚</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºå†™ä¸‹ä½ çš„ç­”æ¡ˆï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„åŒäº‹ã€æœ‹å‹ï¼Œä¸€èµ·äº¤æµï¼Œä¸€èµ·è¿›æ­¥ã€‚</p><p></p>","neighbors":{"left":{"article_title":"09 | ä¸ºä»€ä¹ˆ lua-resty-core æ€§èƒ½æ›´é«˜ä¸€äº›ï¼Ÿ","id":100564},"right":{"article_title":"11 | å‰–æLuaå”¯ä¸€çš„æ•°æ®ç»“æ„tableå’Œmetatableç‰¹æ€§","id":101086}},"comments":[{"had_liked":false,"id":104372,"user_name":"é±¼","can_delete":false,"product_type":"c1","uid":1487584,"ip_address":"","ucode":"89EC9CE3AD0281","user_header":"https://static001.geekbang.org/account/avatar/00/16/b2/e0/d856f5a4.jpg","comment_is_top":false,"comment_ctime":1560739794,"is_pvip":false,"replies":[{"id":"37931","content":"åé¢ä¼šä¸“é—¨ä»‹ç» OpenResty çš„ Lua APIã€‚LuaJIT çš„è¿™äº›å†…å®¹æœ‰ä¸ªå°è±¡å³å¯ã€‚","user_name":"ä½œè€…å›å¤","comment_id":104372,"uid":"1017955","ip_address":"","utype":1,"ctime":1560841949,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"65985249234","product_id":100028301,"comment_content":"å¯¹äºä¸€ä¸ªOpenRestyå…¥é—¨è€…ä¸€å¼€å§‹è®²è¿™äº›æ€§èƒ½å’Œä½å±‚çš„çŸ¥è¯†æœ‰äº›æ¯ç‡¥äº†ï¼Œæ¯•ç«Ÿè¿˜æ²¡å†™è¿‡å‡ ä¸ªOpenRestyçš„å®ä¾‹ï¼Œå¯¹æ€§èƒ½çš„å·®å¼‚æ²¡ä»€ä¹ˆæ„Ÿè§‰ï¼ŒåŸºç¡€çŸ¥è¯†è¿˜æ²¡æŒæ¡å…¨æ›´éš¾æ·±å…¥åº•å±‚ã€‚æœ‰å¦‚å­¦ä¹ javaçš„åˆå­¦è€…ä¸€å¼€å§‹å°±çœ‹ã€ŠJavaç¼–ç¨‹æ€æƒ³ã€‹ã€‚å¯å¦å°è¯•åœ¨åé¢çš„å®é™…ä¾‹å­ä¸­å¼•å‡ºè¿™äº›çŸ¥è¯†ç‚¹ã€‚","like_count":16,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454245,"discussion_content":"åé¢ä¼šä¸“é—¨ä»‹ç» OpenResty çš„ Lua APIã€‚LuaJIT çš„è¿™äº›å†…å®¹æœ‰ä¸ªå°è±¡å³å¯ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560841949,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104415,"user_name":"HelloBug","can_delete":false,"product_type":"c1","uid":1249598,"ip_address":"","ucode":"E61A4AD5C2F724","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/3e/925aa996.jpg","comment_is_top":false,"comment_ctime":1560748260,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"31625519332","product_id":100028301,"comment_content":"å°è£…å­—ç¬¦ä¸²æŸ¥æ‰¾å‡½æ•°ï¼š<br>local function new_string_find(src, dst, regex, pos)<br>\tif regex then<br>\t\tlocal ctx = {pos = pos or 1}<br>\t\treturn ngx.re.find(src, dst, &quot;jo&quot;, ctx)<br>\telse<br>\t\tlocal pos = pos or 1<br>\t\treturn string.find(src, dst, pos, true)<br>\tend<br>end","like_count":8},{"had_liked":false,"id":104597,"user_name":"ç‡•ç¾½é˜³","can_delete":false,"product_type":"c1","uid":1015063,"ip_address":"","ucode":"AF9430187F66EE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7d/17/179b24f4.jpg","comment_is_top":false,"comment_ctime":1560781314,"is_pvip":false,"replies":[{"id":"37922","content":"æ˜¯æŒ‰ç…§åŸè¯­æ¥ç¼–è¯‘çš„ï¼Œä¹Ÿå°±æ˜¯ `ipairs` ã€`string.find` è¿™ç§çš„é¢—ç²’åº¦ï¼Œå¹¶ä¸æ˜¯ä½ è‡ªå·±å†™çš„ function","user_name":"ä½œè€…å›å¤","comment_id":104597,"uid":"1017955","ip_address":"","utype":1,"ctime":1560840794,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":2,"race_medal":0,"score":"14445683202","product_id":100028301,"comment_content":"1. luaçš„è¯­æ³•æ¯”è¾ƒç®€å•ï¼Œå¦‚æœæœ‰ç¼–ç¨‹åŸºç¡€çš„è¯ï¼Œä¸€å¤©å°±å¯ä»¥å…¥é—¨äº†ã€‚æ¨èå¤§å®¶ä¸¤æœ¬ä¹¦ã€Šluaç¨‹åºè®¾è®¡ã€‹luaå…¥é—¨å¿…å¤‡ï¼Œã€Šluaè®¾è®¡ä¸å®ç°ã€‹æ·±å…¥è§£é‡Šå™¨è™šæ‹Ÿæœºçš„åŸç†ã€‚<br>2. ä¹‹å‰å†™è¿‡ä¸€ç‚¹openrestyå’Œkongï¼Œä½†æ˜¯ä»æ²¡æ³¨æ„è¿‡æ€§èƒ½é—®é¢˜ã€‚ä»Šå¤©çš„NYIï¼Œè€å¸ˆè®²çš„éå¸¸æ£’ï¼Œå®Œæ•´çš„å®æˆ˜æ–¹æ¡ˆï¼Œè¶…èµğŸ‘<br>3.æˆ‘å¯¹jitå®Œå…¨ä¸ç†Ÿæ‚‰ï¼Œè¯·é—®è€å¸ˆï¼Œjitæ˜¯æŒ‰ç…§å‡½æ•°ä¸ºå•ä½æ¥ç¼–è¯‘ä¹ˆï¼Ÿå‡½æ•°ä¸­æœ‰ä¸€ä¸ªNYIï¼Œæ•´ä¸ªå‡½æ•°å°±æ˜¯è§£é‡Šè¿è¡Œä¹ˆï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454336,"discussion_content":"æ˜¯æŒ‰ç…§åŸè¯­æ¥ç¼–è¯‘çš„ï¼Œä¹Ÿå°±æ˜¯ `ipairs` ã€`string.find` è¿™ç§çš„é¢—ç²’åº¦ï¼Œå¹¶ä¸æ˜¯ä½ è‡ªå·±å†™çš„ function","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560840794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1237588,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e2/54/f836054a.jpg","nickname":"è€¿æ–Œ","note":"","ucode":"6535D0B012D78E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":200606,"discussion_content":"é—®é¢˜3åˆšå¥½æ˜¯æˆ‘æƒ³è¦é—®çš„ï¼Œå“ˆå“ˆå“ˆ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1583688327,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104519,"user_name":"helloworld","can_delete":false,"product_type":"c1","uid":1105161,"ip_address":"","ucode":"1EECCA0F43E278","user_header":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","comment_is_top":false,"comment_ctime":1560771875,"is_pvip":false,"replies":[{"id":"37918","content":"package.path æ˜¯é»˜è®¤çš„æŸ¥æ‰¾è·¯å¾„ï¼Œä½ å¯ä»¥å•ç‹¬æŠŠå®ƒ print å‡ºæ¥çœ‹ä¸‹é‡Œé¢çš„å€¼ã€‚ä¸æ‹¼æ¥çš„è¯ï¼Œå°±æŠŠé»˜è®¤æŸ¥æ‰¾è·¯å¾„å…¨éƒ½è¦†ç›–æ‰äº†ã€‚","user_name":"ä½œè€…å›å¤","comment_id":104519,"uid":"1017955","ip_address":"","utype":1,"ctime":1560840601,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"14445673763","product_id":100028301,"comment_content":"è€å¸ˆï¼Œä¸‹é¢è¿™ä¸ªè®¾ç½®luaåº“çš„æœç´¢è·¯å¾„çš„ä»£ç ï¼Œæœ€åä¸ºä»€ä¹ˆè¦æ‹¼æ¥package.pathæœ¬èº«å•Šï¼Ÿ<br>package.path = &quot;..&#47;myLuaTest&#47;myLuaCode&#47;?.lua;&quot;..package.path","like_count":3,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454306,"discussion_content":"package.path æ˜¯é»˜è®¤çš„æŸ¥æ‰¾è·¯å¾„ï¼Œä½ å¯ä»¥å•ç‹¬æŠŠå®ƒ print å‡ºæ¥çœ‹ä¸‹é‡Œé¢çš„å€¼ã€‚ä¸æ‹¼æ¥çš„è¯ï¼Œå°±æŠŠé»˜è®¤æŸ¥æ‰¾è·¯å¾„å…¨éƒ½è¦†ç›–æ‰äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560840601,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104508,"user_name":"Geek_89bbab","can_delete":false,"product_type":"c1","uid":1156607,"ip_address":"","ucode":"B3110D5B3C9500","user_header":"https://static001.geekbang.org/account/avatar/00/11/a5/ff/6201122c.jpg","comment_is_top":false,"comment_ctime":1560769613,"is_pvip":false,"replies":[{"id":"37919","content":"ç°åœ¨è¿˜æ²¡å•¥å¥½ç”¨çš„ç¼–è¾‘å™¨ï¼Œæˆ‘ç”¨çš„æ˜¯ vs code","user_name":"ä½œè€…å›å¤","comment_id":104508,"uid":"1017955","ip_address":"","utype":1,"ctime":1560840652,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"14445671501","product_id":100028301,"comment_content":"å¸Œæœ›è€å¸ˆåˆ†äº«ä¸€ä¸‹å†™ openrestyä»£ç æ—¶ç”¨ä»€ä¹ˆç¼–è¾‘å™¨æ¯”è¾ƒå¥½ï¼Œä»£ç è¡¥å…¨ï¼Œå®šä¹‰è·³è½¬,å¼•ç”¨è·³è½¬ç­‰å¦‚ä½•é…ç½®ã€‚è€å¸ˆä½ ä»¬å†™openrestyçš„æ—¶å€™æ˜¯æ€ä¹ˆæ¥åšçš„ï¼Ÿç›´æ¥vimæ“ä½œï¼Œè¿˜æ˜¯æœ‰æ›´æ™ºèƒ½äº›çš„IDEï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454301,"discussion_content":"ç°åœ¨è¿˜æ²¡å•¥å¥½ç”¨çš„ç¼–è¾‘å™¨ï¼Œæˆ‘ç”¨çš„æ˜¯ vs code","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560840652,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":253561,"user_name":"geekYang","can_delete":false,"product_type":"c1","uid":1255232,"ip_address":"","ucode":"B2E50D3BFDE8C6","user_header":"https://static001.geekbang.org/account/avatar/00/13/27/40/ae886719.jpg","comment_is_top":false,"comment_ctime":1602776719,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10192711311","product_id":100028301,"comment_content":"è€å¸ˆï¼ŒNYI çš„æ›¿ä»£æ–¹æ¡ˆä¸ºä»€ä¹ˆä¸å»çœ‹ lua-resty-coreï¼Œè€Œè¦åœ¨lua-nginx-moduleä¸­å¯»æ‰¾ï¼Ÿ ngx.re.gsub ä¸ºä»€ä¹ˆå³å¯ä»¥pcreç¼–è¯‘ï¼Œä¹Ÿå¯ä»¥luajit ç¼–è¯‘ï¼Ÿ","like_count":3},{"had_liked":false,"id":104395,"user_name":"Forturn","can_delete":false,"product_type":"c1","uid":1544403,"ip_address":"","ucode":"663135A66C3ACB","user_header":"https://static001.geekbang.org/account/avatar/00/17/90/d3/da371457.jpg","comment_is_top":false,"comment_ctime":1560743033,"is_pvip":false,"replies":[{"id":"37932","content":"çœ‹ä¸æ‡‚æ²¡æœ‰å…³ç³»ï¼Œé‡è¦çš„æ˜¯è®°å¾—æœ‰LuaJIT å’Œ NYI è¿™ä¸ªä¸œè¥¿ï¼Œåé¢é‡åˆ°é—®é¢˜æ–¹ä¾¿æŸ¥æ‰¾ã€‚","user_name":"ä½œè€…å›å¤","comment_id":104395,"uid":"1017955","ip_address":"","utype":1,"ctime":1560842013,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"10150677625","product_id":100028301,"comment_content":"æ¥¼ä¸Šè¯´çš„æœ‰é“ç†ï¼Œç›®å‰è¿˜æ²¡æŒæ¡åŸºæœ¬çš„è¯­æ³•ï¼Œè¿˜ä¸ä¼šå†™ä¸€äº›åŸºæœ¬çš„åŠŸèƒ½ï¼Œå°±å»å­¦åº•å±‚çš„ä¸œè¥¿ï¼Œæœ‰ç‚¹æ‘¸ä¸ç€å¤´è„‘ï¼Œä¹Ÿä¸æ‡‚è¿™äº›ã€‚ä¸çŸ¥é“åé¢ä¼šä¸ä¼šå…·ä½“äº‹ä¾‹","like_count":2,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454255,"discussion_content":"çœ‹ä¸æ‡‚æ²¡æœ‰å…³ç³»ï¼Œé‡è¦çš„æ˜¯è®°å¾—æœ‰LuaJIT å’Œ NYI è¿™ä¸ªä¸œè¥¿ï¼Œåé¢é‡åˆ°é—®é¢˜æ–¹ä¾¿æŸ¥æ‰¾ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560842013,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117278,"user_name":"KoALa","can_delete":false,"product_type":"c1","uid":1021648,"ip_address":"","ucode":"378E0A7DBC14A6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/96/d0/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1564018213,"is_pvip":true,"replies":[{"id":"43608","content":"Kong å’Œ OpenResty çš„å›¢é˜Ÿä¸­ï¼Œéƒ½æœ‰äººåœ¨é€æ­¥æ¥æ‰‹ã€‚å¼€æºé¡¹ç›®åªè¦æœ‰äººåœ¨ä½¿ç”¨ï¼Œå°±ä¸ä¼šæ­»æ‰ï¼Œä¸ç”¨æ‹…å¿ƒã€‚","user_name":"ä½œè€…å›å¤","comment_id":117278,"uid":"1017955","ip_address":"","utype":1,"ctime":1564468535,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"5858985509","product_id":100028301,"comment_content":"æ•™ç¨‹ä¸­åå¤æåˆ°äº†â€œLuaJIT çš„ä½œè€…ç›®å‰å¤„äºåŠé€€ä¼‘çŠ¶æ€â€ï¼Œæ„Ÿè§‰è¿™ä¸ªæƒ…å†µå¾ˆä¸ä¹è§‚å•Š...","like_count":1,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459895,"discussion_content":"Kong å’Œ OpenResty çš„å›¢é˜Ÿä¸­ï¼Œéƒ½æœ‰äººåœ¨é€æ­¥æ¥æ‰‹ã€‚å¼€æºé¡¹ç›®åªè¦æœ‰äººåœ¨ä½¿ç”¨ï¼Œå°±ä¸ä¼šæ­»æ‰ï¼Œä¸ç”¨æ‹…å¿ƒã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564468535,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112865,"user_name":"è«ç„¶","can_delete":false,"product_type":"c1","uid":1203524,"ip_address":"","ucode":"92F6B735C5E1B2","user_header":"https://static001.geekbang.org/account/avatar/00/12/5d/44/74173e02.jpg","comment_is_top":false,"comment_ctime":1562833900,"is_pvip":false,"replies":[{"id":"41189","content":"LuaJIT çš„ä¼˜åŒ–æ˜¯éšæœºè§¦å‘çš„ï¼Œè¦è¶³å¤Ÿçƒ­æ‰å¯èƒ½å°è¯•å»ä¼˜åŒ–","user_name":"ä½œè€…å›å¤","comment_id":112865,"uid":"1017955","ip_address":"","utype":1,"ctime":1562909953,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"5857801196","product_id":100028301,"comment_content":"pairsçš„ä¾‹å­ç¨ä½œä¿®æ”¹ï¼Œå¦‚ä¸‹ï¼š<br>local t = {}<br>for i=1,100 do<br>     t[i] = i<br>end<br> <br>for j=1,10 do<br>    for k,v in pairs(t) do<br>         --<br>    end<br>end<br>jit.logé‡Œè¾“å‡ºçš„æ˜¯ï¼š[TRACE   1 t.lua:123 loop]<br><br>å¦‚æœæ”¹æˆå¦‚ä¸‹ä»£ç ï¼š<br>for j=1,100 do<br>    for k,v in pairs(t) do<br>         --<br>    end<br>end<br>jit.logé‡Œè¾“å‡ºçš„æ˜¯ï¼š<br>[TRACE   1 t.lua:123 loop]<br>[TRACE --- t.lua:128 -- NYI: bytecode 72 at t.lua:129]<br>[TRACE --- t.lua:128 -- NYI: bytecode 72 at t.lua:129]<br><br>ä¸ºä»€ä¹ˆå¾ªç¯10çš„æ—¶å€™æ²¡æœ‰NYIçš„æç¤ºï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457936,"discussion_content":"LuaJIT çš„ä¼˜åŒ–æ˜¯éšæœºè§¦å‘çš„ï¼Œè¦è¶³å¤Ÿçƒ­æ‰å¯èƒ½å°è¯•å»ä¼˜åŒ–","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562909953,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":105247,"user_name":"NEVER SETTLE","can_delete":false,"product_type":"c1","uid":1101894,"ip_address":"","ucode":"9C86BDAFDBF768","user_header":"https://static001.geekbang.org/account/avatar/00/10/d0/46/1a9229b3.jpg","comment_is_top":false,"comment_ctime":1560945705,"is_pvip":false,"replies":[{"id":"38153","content":"éœ€è¦ç”¨ç«ç„°å›¾åˆ†æä¸‹ on-cpu æ‰è¡Œ","user_name":"ä½œè€…å›å¤","comment_id":105247,"uid":"1017955","ip_address":"","utype":1,"ctime":1560998474,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"5855913001","product_id":100028301,"comment_content":"ç»å¸¸ä¼šå‘ç°openrestyè¿è¡Œä¸€æ®µæ—¶é—´ï¼Œæ€§èƒ½ä¼šå·®å¾ˆå¤šã€‚ç„¶åreloadä¸€ä¸‹æ€§èƒ½ä¼šå¥½å¾ˆå¤šã€‚è¿™ä¸ªé—®é¢˜ä¸€ç›´å›°æ‰°å¾ˆä¹…äº†ï¼Œä¸çŸ¥é“å¦‚ä½•è¿›è¡Œæ’æŸ¥ã€‚ ä»¥å‰ä¸¤å¤©çš„æƒ…å†µï¼Œé«˜å³°æœŸCPUä½¿ç”¨ç‡è¶…è¿‡äº†60%ï¼Œç„¶åreloadä¸€ä¸‹ï¼ŒCPUä½¿ç”¨ç‡å°±é™ä¸º30%ã€‚ ","like_count":1,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454607,"discussion_content":"éœ€è¦ç”¨ç«ç„°å›¾åˆ†æä¸‹ on-cpu æ‰è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560998474,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104540,"user_name":"æ¶‰è“","can_delete":false,"product_type":"c1","uid":1134619,"ip_address":"","ucode":"C1321E29E01625","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLh8ubWQtDRa6exJtloSwibLliaejpF7434ficyggzukmXE63UlSPvbykoiaVDZo4CbDIIOQsCkicibyn9A/132","comment_is_top":false,"comment_ctime":1560774283,"is_pvip":false,"replies":[{"id":"37925","content":"è¿™ä¸ªé—®é¢˜å…¶å®è¦å›åˆ° OpenResty è¯ç”Ÿçš„é‚£ä¸ªæ—¶å€™æ¥çœ‹ï¼Œ 2007 å¹´ï¼Œæ”¯æŒåŒæ­¥éé˜»å¡çš„è¯­è¨€å‡¤æ¯›éºŸè§’ã€‚<br>å³ä½¿æ˜¯ç°åœ¨ï¼Œåç«¯è¯­è¨€å¯ä»¥è¾¾åˆ° OpenResty è¿™ç§æ€§èƒ½çº§åˆ«çš„ä¹Ÿä¸å¤šã€‚<br>API ç½‘å…³å’Œè½¯ WAF ç®—æ˜¯å¼€å‘è€…çš„è‡ªç„¶é€‰æ‹©ï¼ŒOpenResty å…¶å®èƒ½åšçš„ä¸æ­¢è¿™äº›ã€‚","user_name":"ä½œè€…å›å¤","comment_id":104540,"uid":"1017955","ip_address":"","utype":1,"ctime":1560840962,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"5855741579","product_id":100028301,"comment_content":"å¯¹äºåˆå­¦è€…æ˜¯ä¸æ˜¯ è¦å…ˆå­¦ lua -&gt; luajit -&gt; openresty api -&gt; å…¶ä»–ç¬¬ä¸‰æ–¹åŒ… <br>æŒ‰è¿™ç§å…ˆæŠŠ æ–‡æ¡£å•¥çš„éƒ½æ‰’ä¸€éæ‰è¡Œå‘¢ï¼Ÿ<br>æˆ‘å¯¹äºä½¿ç”¨æœ‰ç‚¹ç–‘æƒ‘ï¼Œopenrestyå¯ä»¥åš ç½‘ç«™æ™®é€šåç«¯è¯­è¨€å¯ä»¥åšçš„äº‹ è­¬å¦‚è¿æ•°æ®åº“åšå‰ç«¯é¡µé¢ ä½†è¿™æ˜¾ç„¶å¹¶ä¸æ˜¯å®ƒä¸»è¦é€‚åˆçš„éƒ¨åˆ†å§ æ¯•ç«Ÿå…¶ä»–åç«¯è¯­è¨€ä¸€å¤§æŠŠï¼Œæ–‡æ¡£ç”Ÿæ€åº“å¥½çš„å¤šçš„æ˜¯ <br>æ‰€ä»¥æ˜¯API ç½‘å…³çš„ å¼€å‘ æˆ–è€… nginx æ— æ³•é…ç½®çƒ­ä¿®æ”¹çš„ è¡¥å……å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454315,"discussion_content":"è¿™ä¸ªé—®é¢˜å…¶å®è¦å›åˆ° OpenResty è¯ç”Ÿçš„é‚£ä¸ªæ—¶å€™æ¥çœ‹ï¼Œ 2007 å¹´ï¼Œæ”¯æŒåŒæ­¥éé˜»å¡çš„è¯­è¨€å‡¤æ¯›éºŸè§’ã€‚\nå³ä½¿æ˜¯ç°åœ¨ï¼Œåç«¯è¯­è¨€å¯ä»¥è¾¾åˆ° OpenResty è¿™ç§æ€§èƒ½çº§åˆ«çš„ä¹Ÿä¸å¤šã€‚\nAPI ç½‘å…³å’Œè½¯ WAF ç®—æ˜¯å¼€å‘è€…çš„è‡ªç„¶é€‰æ‹©ï¼ŒOpenResty å…¶å®èƒ½åšçš„ä¸æ­¢è¿™äº›ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560840962,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104434,"user_name":"John","can_delete":false,"product_type":"c1","uid":1458885,"ip_address":"","ucode":"ECACBE31D5D1A7","user_header":"https://static001.geekbang.org/account/avatar/00/16/42/c5/7913cdb0.jpg","comment_is_top":false,"comment_ctime":1560752782,"is_pvip":false,"replies":[{"id":"37930","content":"è¿™ä¸ªå…·ä½“è¦çœ‹ nginx é…ç½®çš„ rewrite è§„åˆ™æ˜¯æ€ä¹ˆå†™çš„äº†ï¼Œæ˜¯ break è¿˜æ˜¯ lastã€‚è¿™ä¸ªåœ¨å®˜æ–¹æ–‡æ¡£ä¸­æœ‰æ³¨æ˜ï¼Œå¹¶ä¸”é…äº†ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼š<br> location &#47;foo {<br>     rewrite ^ &#47;bar;<br>     rewrite_by_lua &#39;ngx.exit(503)&#39;;<br> }<br> location &#47;bar {<br>     ...<br> }<br>ä¸Šé¢è¿™ä¸ªé…ç½®ä¸­ï¼Œngx.exit(503) æ˜¯ä¸ä¼šè¢«æ‰§è¡Œçš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ”¹æˆï¼š<br>rewrite ^ &#47;bar breakï¼›<br><br>ngx.exit(503) å°±æ˜¯å¯ä»¥æ‰§è¡Œçš„ã€‚","user_name":"ä½œè€…å›å¤","comment_id":104434,"uid":"1017955","ip_address":"","utype":1,"ctime":1560841827,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":2,"race_medal":0,"score":"5855720078","product_id":100028301,"comment_content":"è¯·æ•™ä¸€ä¸‹è€å¸ˆï¼Œå½“opä¸­çš„luaè§„åˆ™å’Œnginxé…ç½®æ–‡ä»¶äº§ç”Ÿå†²çªï¼Œæ¯”å¦‚nginxé…ç½®äº†rewriteè§„åˆ™ï¼ŒåˆåŒæ—¶å¼•ç”¨äº†rewrite_by_lua_file,é‚£ä¹ˆè¿™ä¸¤æ¡è§„åˆ™çš„ä¼˜å…ˆçº§æ˜¯ä»€ä¹ˆï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454270,"discussion_content":"è¿™ä¸ªå…·ä½“è¦çœ‹ nginx é…ç½®çš„ rewrite è§„åˆ™æ˜¯æ€ä¹ˆå†™çš„äº†ï¼Œæ˜¯ break è¿˜æ˜¯ lastã€‚è¿™ä¸ªåœ¨å®˜æ–¹æ–‡æ¡£ä¸­æœ‰æ³¨æ˜ï¼Œå¹¶ä¸”é…äº†ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼š\n location /foo {\n     rewrite ^ /bar;\n     rewrite_by_lua &amp;#39;ngx.exit(503)&amp;#39;;\n }\n location /bar {\n     ...\n }\nä¸Šé¢è¿™ä¸ªé…ç½®ä¸­ï¼Œngx.exit(503) æ˜¯ä¸ä¼šè¢«æ‰§è¡Œçš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ”¹æˆï¼š\nrewrite ^ /bar breakï¼›\n\nngx.exit(503) å°±æ˜¯å¯ä»¥æ‰§è¡Œçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560841827,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1544340,"avatar":"https://static001.geekbang.org/account/avatar/00/17/90/94/3949d451.jpg","nickname":"ArtEngr","note":"","ucode":"719CA9C19DA9C7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":82,"discussion_content":"pairs å¤ªå¸¸ç”¨äº†ï¼Œå‡ ä¹æ¯ä¸ªé¡¹ç›®éƒ½ä¼šä½¿ç”¨å¾ªç¯å¤„ç†jsonä»€ä¹ˆçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561087479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":332914,"user_name":"å¼ é³","can_delete":false,"product_type":"c1","uid":2651034,"ip_address":"","ucode":"A636ABADFC39B3","user_header":"https://static001.geekbang.org/account/avatar/00/28/73/9a/5197bbbd.jpg","comment_is_top":false,"comment_ctime":1643809715,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1643809715","product_id":100028301,"comment_content":"è€å¸ˆï¼Œæˆ‘æƒ³é—®ä¸‹ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªå®Œæ•´çš„APIç½‘å…³ï¼Œé‡Œé¢å†™äº†å¾ˆå¤šçš„luaæ¨¡å—ï¼Œå¦‚ä½•æ¯”è¾ƒç®€å•å¿«é€Ÿçš„æ’æŸ¥NYIï¼Ÿ","like_count":0},{"had_liked":false,"id":330760,"user_name":"Geek_2b5c15","can_delete":false,"product_type":"c1","uid":1607950,"ip_address":"","ucode":"E320C0F61FAC27","user_header":"","comment_is_top":false,"comment_ctime":1642148540,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1642148540","product_id":100028301,"comment_content":"Accroding from the new NYI list, the paris have been implement. ","like_count":1},{"had_liked":false,"id":291657,"user_name":"MiaoVictor","can_delete":false,"product_type":"c1","uid":1166993,"ip_address":"","ucode":"8674ED8A080260","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLUfAPgMtkWQcGk45nLULtb4WtOotH2Mc5ibEiaKcnopzicdAn6WYibo5gQL8bkedRib3YjxfCcZfLJwLA/132","comment_is_top":false,"comment_ctime":1620401680,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1620401680","product_id":100028301,"comment_content":"è€å¸ˆï¼Œè¯·é—®åœ¨æŸ¥çœ‹NYIåˆ—è¡¨æ˜¯ï¼ŒæŸäº›åŸè¯­åæ˜¯â€œ2.1 stitchâ€ï¼Œè¿™ä¸ªstitchæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ","like_count":1},{"had_liked":false,"id":250214,"user_name":"æ²ˆåº·","can_delete":false,"product_type":"c1","uid":1611025,"ip_address":"","ucode":"02AFA50738AB8E","user_header":"https://static001.geekbang.org/account/avatar/00/18/95/11/eb431e52.jpg","comment_is_top":false,"comment_ctime":1600994463,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1600994463","product_id":100028301,"comment_content":"è€å¸ˆè®²çš„éå¸¸å¥½ï¼ŒåšæŠ€æœ¯å°±è¦æ·±æŒ–åº•å±‚åŸç†ï¼Œè€Œä¸”ç›®å‰è®²çš„ä¹Ÿæ²¡æœ‰åˆ°åº•å±‚<br>å°ç™½å°±çŸ¥é“æ€¥åŠŸè¿‘åˆ©ï¼Œæˆ‘åªèƒ½è¯´é¡¹ç›®æœ‰é—®é¢˜è°æ¥èƒŒé”…ï¼Ÿ","like_count":0},{"had_liked":false,"id":150387,"user_name":"Geek_e59303","can_delete":false,"product_type":"c1","uid":1545484,"ip_address":"","ucode":"C136BDB95D8A95","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/jaOQZZRldayELmckBTq4VQHUgepwn8ibSLuEEB0NNwRnMyIqRRPj3ms38cjj3ySicEzkruV44lxDMdbdgUkn6ibTg/132","comment_is_top":false,"comment_ctime":1573525743,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573525743","product_id":100028301,"comment_content":"ä»€ä¹ˆæ˜¯ä»£ç çƒ­è·¯å¾„å•Š","like_count":0},{"had_liked":false,"id":122276,"user_name":"sheng","can_delete":false,"product_type":"c1","uid":1516712,"ip_address":"","ucode":"59EFA0EF6F1B4B","user_header":"https://static001.geekbang.org/account/avatar/00/17/24/a8/34cd2c95.jpg","comment_is_top":false,"comment_ctime":1565328322,"is_pvip":false,"replies":[{"id":"46060","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","comment_id":122276,"uid":"1017955","ip_address":"","utype":1,"ctime":1566196758,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"1565328322","product_id":100028301,"comment_content":"è¿™é‡Œçš„ä¸€ä¸ªæ•°é‡çº§æ˜¯æŒ‡åå€çš„æ„æ€ä¹ˆï¼Ÿ<br>","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462183,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566196758,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":122274,"user_name":"sheng","can_delete":false,"product_type":"c1","uid":1516712,"ip_address":"","ucode":"59EFA0EF6F1B4B","user_header":"https://static001.geekbang.org/account/avatar/00/17/24/a8/34cd2c95.jpg","comment_is_top":false,"comment_ctime":1565328047,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565328047","product_id":100028301,"comment_content":"ä½ å¥½ï¼Œæ€§èƒ½å·®è·è‡³å°‘ä¸€ä¸ªæ•°é‡çº§æ˜¯æŒ‡å¤šå°‘ï¼Ÿå¯å¦ä¸¾ä¸ªä¾‹å­ï¼Ÿ","like_count":0},{"had_liked":false,"id":110272,"user_name":"psoracle","can_delete":false,"product_type":"c1","uid":1219195,"ip_address":"","ucode":"26F9B166508BBA","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/2xoGmvlQ9qfSibVpPJyyaEriavuWzXnuECrJITmGGHnGVuTibUuBho43Uib3Y5qgORHeSTxnOOSicxs0FV3HGvTpF0A/132","comment_is_top":false,"comment_ctime":1562219175,"is_pvip":false,"replies":[{"id":"40877","content":"è¿˜æœ‰ https:&#47;&#47;github.com&#47;LuaJIT&#47;LuaJIT&#47;blob&#47;v2.1&#47;doc&#47;extensions.html","user_name":"ä½œè€…å›å¤","comment_id":110272,"uid":"1017955","ip_address":"","utype":1,"ctime":1562731250,"user_name_real":"æ¸©é“­@OpenResty"}],"discussion_count":1,"race_medal":0,"score":"1562219175","product_id":100028301,"comment_content":"æ—¢ç„¶æ˜¯ä¼˜å…ˆä½¿ç”¨openresty apiï¼Œå†luajitçš„apiï¼Œè€å¸ˆè¯·é—®ä¸€ä¸‹ï¼Œluajitçš„APIåœ¨å“ªé‡Œèƒ½æ‰¾åˆ°ï¼Œçœ‹è¿‡ http:&#47;&#47;luajit.org&#47;ext_jit.html ä¸ http:&#47;&#47;wiki.luajit.org&#47;JIT-Compiler-APIï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456796,"discussion_content":"è¿˜æœ‰ https://github.com/LuaJIT/LuaJIT/blob/v2.1/doc/extensions.html","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562731250,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":105505,"user_name":"å…­ç»´","can_delete":false,"product_type":"c1","uid":1022887,"ip_address":"","ucode":"EB1C15AC06A8DF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9b/a7/440aff07.jpg","comment_is_top":false,"comment_ctime":1561016887,"is_pvip":false,"replies":[{"id":"38899","content":"æ¨èçœ‹ OpenResty ç›¸å…³çš„å¼€æºé¡¹ç›®ï¼Œæ¯”å¦‚ lua-resty åº“ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æ¸©é“­@OpenResty","uid":"1017955","ctime":1561550596,"ip_address":"","comment_id":105505,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561016887","product_id":100028301,"comment_content":"èƒ½å¦è¯´æ˜ä¸€ä¸‹å­¦ä¹ çš„è·¯å¾„æˆ–ä»‹ç»ä¸€äº›ä¹¦ç±ï¼Œå¯ä»¥åœ¨è¯¾ç¨‹ä¹‹å¤–è¿›è¡Œè¡¥å……å­¦ä¹ ï¼Ÿ ç°åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹äºæ–‡ä¸­è®²è§£çš„å†…å®¹ï¼ŒçœŸçš„åªæœ‰ä¸€ä¸ªå°è±¡ï¼Œç„¶åå°±æœ‰ç‚¹ä¸çŸ¥é“å¦‚ä½•ä¸‹æ‰‹äº†ã€‚","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454708,"discussion_content":"æ¨èçœ‹ OpenResty ç›¸å…³çš„å¼€æºé¡¹ç›®ï¼Œæ¯”å¦‚ lua-resty åº“ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561550596,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104762,"user_name":"John","can_delete":false,"product_type":"c1","uid":1458885,"ip_address":"","ucode":"ECACBE31D5D1A7","user_header":"https://static001.geekbang.org/account/avatar/00/16/42/c5/7913cdb0.jpg","comment_is_top":false,"comment_ctime":1560829346,"is_pvip":false,"replies":[{"id":"37928","content":"ä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ª timerï¼Œå®šæ—¶çš„æŸ¥è¯¢æ˜¯å¦æœ‰æ–°çš„é…ç½®ï¼Œå¹¶æŠŠæ–°é…ç½®å†™åˆ°ç±»ä¼¼ shared dict çš„ç¼“å­˜ä¸­ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æ¸©é“­@OpenResty","uid":"1017955","ctime":1560841299,"ip_address":"","comment_id":104762,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1560829346","product_id":100028301,"comment_content":"è€å¸ˆï¼Œæˆ‘åœ¨ç”¨opå®ç°ä¸€ä¸ªè‡ªå®šä¹‰é€»è¾‘çš„é£æ§ç³»ç»Ÿï¼Œæƒ³è¯·æ•™ä¸€ä¸‹åŠ¨æ€é…ç½®ç”Ÿæ•ˆçš„é—®é¢˜ï¼Œå¦‚ä½•åœ¨ä¸reloadçš„æƒ…å†µä¸‹ä½¿é…ç½®ç”Ÿæ•ˆï¼Œæˆ‘æƒ³äº†ä¸¤ä¸ªåŠæ³•ï¼š1ï¼Œä½¿ç”¨å…¨å±€å˜é‡å­˜å‚¨é…ç½®æ–‡ä»¶ï¼Œæä¾›ä¸€ä¸ªapiæ›´æ–°å…¨å±€å˜é‡ï¼›2ï¼Œä½¿ç”¨ngx.shared.DICTï¼Œå°†é…ç½®æ–‡ä»¶å­˜å‚¨åœ¨å…±äº«å†…å­˜ä¸­ã€‚è¯·é—®æ˜¯å¦åˆç†ï¼Œæˆ–è€…æ˜¯å¦æœ‰å…¶å®ƒæ€è·¯","like_count":0,"discussions":[{"author":{"id":1017955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/88/63/88cf886d.jpg","nickname":"æ¸©é“­@APISIX","note":"","ucode":"343567571DA16A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454413,"discussion_content":"ä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ª timerï¼Œå®šæ—¶çš„æŸ¥è¯¢æ˜¯å¦æœ‰æ–°çš„é…ç½®ï¼Œå¹¶æŠŠæ–°é…ç½®å†™åˆ°ç±»ä¼¼ shared dict çš„ç¼“å­˜ä¸­ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560841299,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1105161,"avatar":"https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg","nickname":"helloworld","note":"","ucode":"1EECCA0F43E278","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545,"discussion_content":"æŠŠé…ç½®å†™åœ¨redisä¸­ï¼Œinit_workeré˜¶æ®µé€šè¿‡redisåº“è·å–é…ç½®åˆ°shared dictå’Œctxï¼Œå¹¶é€šè¿‡timerå®šæ—¶æ›´æ–°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561688241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}