{"id":186691,"title":"29 | ç†è®ºä¸‰ï¼šä»€ä¹ˆæ˜¯ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Ÿå¦‚ä½•å†™å‡ºå¯æµ‹è¯•æ€§å¥½çš„ä»£ç ï¼Ÿ","content":"<p>åœ¨ä¸Šä¸€èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å¯¹å•å…ƒæµ‹è¯•åšäº†ä»‹ç»ï¼Œè®²äº†â€œä»€ä¹ˆæ˜¯å•å…ƒæµ‹è¯•ï¼Ÿä¸ºä»€ä¹ˆè¦ç¼–å†™å•å…ƒæµ‹è¯•ï¼Ÿå¦‚ä½•ç¼–å†™å•å…ƒæµ‹è¯•ï¼Ÿå®è·µä¸­å•å…ƒæµ‹è¯•ä¸ºä»€ä¹ˆéš¾è´¯å½»æ‰§è¡Œï¼Ÿâ€è¿™æ ·å‡ ä¸ªé—®é¢˜ã€‚</p><p>å®é™…ä¸Šï¼Œå†™å•å…ƒæµ‹è¯•å¹¶ä¸éš¾ï¼Œä¹Ÿä¸éœ€è¦å¤ªå¤šæŠ€å·§ï¼Œç›¸åï¼Œå†™å‡ºå¯æµ‹è¯•çš„ä»£ç åå€’æ˜¯ä»¶éå¸¸æœ‰æŒ‘æˆ˜çš„äº‹æƒ…ã€‚æ‰€ä»¥ï¼Œä»Šå¤©ï¼Œæˆ‘ä»¬å°±å†æ¥èŠä¸€èŠä»£ç çš„å¯æµ‹è¯•æ€§ï¼Œä¸»è¦åŒ…æ‹¬è¿™æ ·å‡ ä¸ªé—®é¢˜ï¼š</p><ul>\n<li>ä»€ä¹ˆæ˜¯ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Ÿ</li>\n<li>å¦‚ä½•å†™å‡ºå¯æµ‹è¯•çš„ä»£ç ï¼Ÿ</li>\n<li>æœ‰å“ªäº›å¸¸è§çš„ä¸å¥½æµ‹è¯•çš„ä»£ç ï¼Ÿ</li>\n</ul><p>è¯ä¸å¤šè¯´ï¼Œè®©æˆ‘ä»¬æ­£å¼å¼€å§‹ä»Šå¤©çš„å­¦ä¹ å§ï¼</p><h2>ç¼–å†™å¯æµ‹è¯•ä»£ç æ¡ˆä¾‹å®æˆ˜</h2><p>åˆšåˆšæåˆ°çš„è¿™å‡ ä¸ªå…³äºä»£ç å¯æµ‹è¯•æ€§çš„é—®é¢˜ï¼Œæˆ‘å‡†å¤‡é€šè¿‡ä¸€ä¸ªå®æˆ˜æ¡ˆä¾‹æ¥è®²è§£ã€‚å…·ä½“çš„è¢«æµ‹è¯•ä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p><p>å…¶ä¸­ï¼ŒTransactionæ˜¯ç»è¿‡æˆ‘æŠ½è±¡ç®€åŒ–ä¹‹åçš„ä¸€ä¸ªç”µå•†ç³»ç»Ÿçš„äº¤æ˜“ç±»ï¼Œç”¨æ¥è®°å½•æ¯ç¬”è®¢å•äº¤æ˜“çš„æƒ…å†µã€‚Transactionç±»ä¸­çš„execute()å‡½æ•°è´Ÿè´£æ‰§è¡Œè½¬è´¦æ“ä½œï¼Œå°†é’±ä»ä¹°å®¶çš„é’±åŒ…è½¬åˆ°å–å®¶çš„é’±åŒ…ä¸­ã€‚çœŸæ­£çš„è½¬è´¦æ“ä½œæ˜¯é€šè¿‡è°ƒç”¨WalletRpcService RPCæœåŠ¡æ¥å®Œæˆçš„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä»£ç ä¸­è¿˜æ¶‰åŠä¸€ä¸ªåˆ†å¸ƒå¼é”DistributedLockå•ä¾‹ç±»ï¼Œç”¨æ¥é¿å…Transactionå¹¶å‘æ‰§è¡Œï¼Œå¯¼è‡´ç”¨æˆ·çš„é’±è¢«é‡å¤è½¬å‡ºã€‚</p><pre><code>public class Transaction {\n  private String id;\n  private Long buyerId;\n  private Long sellerId;\n  private Long productId;\n  private String orderId;\n  private Long createTimestamp;\n  private Double amount;\n  private STATUS status;\n  private String walletTransactionId;\n  \n  // ...get() methods...\n  \n  public Transaction(String preAssignedId, Long buyerId, Long sellerId, Long productId, String orderId) {\n    if (preAssignedId != null &amp;&amp; !preAssignedId.isEmpty()) {\n      this.id = preAssignedId;\n    } else {\n      this.id = IdGenerator.generateTransactionId();\n    }\n    if (!this.id.startWith(&quot;t_&quot;)) {\n      this.id = &quot;t_&quot; + preAssignedId;\n    }\n    this.buyerId = buyerId;\n    this.sellerId = sellerId;\n    this.productId = productId;\n    this.orderId = orderId;\n    this.status = STATUS.TO_BE_EXECUTD;\n    this.createTimestamp = System.currentTimestamp();\n  }\n  \n  public boolean execute() throws InvalidTransactionException {\n    if ((buyerId == null || (sellerId == null || amount &lt; 0.0) {\n      throw new InvalidTransactionException(...);\n    }\n    if (status == STATUS.EXECUTED) return true;\n    boolean isLocked = false;\n    try {\n      isLocked = RedisDistributedLock.getSingletonIntance().lockTransction(id);\n      if (!isLocked) {\n        return false; // é”å®šæœªæˆåŠŸï¼Œè¿”å›falseï¼Œjobå…œåº•æ‰§è¡Œ\n      }\n      if (status == STATUS.EXECUTED) return true; // double check\n      long executionInvokedTimestamp = System.currentTimestamp();\n      if (executionInvokedTimestamp - createdTimestap &gt; 14days) {\n        this.status = STATUS.EXPIRED;\n        return false;\n      }\n      WalletRpcService walletRpcService = new WalletRpcService();\n      String walletTransactionId = walletRpcService.moveMoney(id, buyerId, sellerId, amount);\n      if (walletTransactionId != null) {\n        this.walletTransactionId = walletTransactionId;\n        this.status = STATUS.EXECUTED;\n        return true;\n      } else {\n        this.status = STATUS.FAILED;\n        return false;\n      }\n    } finally {\n      if (isLocked) {\n       RedisDistributedLock.getSingletonIntance().unlockTransction(id);\n      }\n    }\n  }\n}\n</code></pre><p>å¯¹æ¯”ä¸Šä¸€èŠ‚è¯¾ä¸­çš„Textç±»çš„ä»£ç ï¼Œè¿™æ®µä»£ç è¦å¤æ‚å¾ˆå¤šã€‚å¦‚æœè®©ä½ ç»™è¿™æ®µä»£ç ç¼–å†™å•å…ƒæµ‹è¯•ï¼Œä½ ä¼šå¦‚ä½•æ¥å†™å‘¢ï¼Ÿä½ å¯ä»¥å…ˆè¯•ç€æ€è€ƒä¸€ä¸‹ï¼Œç„¶åå†æ¥çœ‹æˆ‘ä¸‹é¢çš„åˆ†æã€‚</p><!-- [[[read_end]]] --><p>åœ¨Transactionç±»ä¸­ï¼Œä¸»è¦é€»è¾‘é›†ä¸­åœ¨execute()å‡½æ•°ä¸­ï¼Œæ‰€ä»¥å®ƒæ˜¯æˆ‘ä»¬æµ‹è¯•çš„é‡ç‚¹å¯¹è±¡ã€‚ä¸ºäº†å°½å¯èƒ½å…¨é¢è¦†ç›–å„ç§æ­£å¸¸å’Œå¼‚å¸¸æƒ…å†µï¼Œé’ˆå¯¹è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘è®¾è®¡äº†ä¸‹é¢6ä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚</p><ol>\n<li>æ­£å¸¸æƒ…å†µä¸‹ï¼Œäº¤æ˜“æ‰§è¡ŒæˆåŠŸï¼Œå›å¡«ç”¨äºå¯¹è´¦ï¼ˆäº¤æ˜“ä¸é’±åŒ…çš„äº¤æ˜“æµæ°´ï¼‰ç”¨çš„walletTransactionIdï¼Œäº¤æ˜“çŠ¶æ€è®¾ç½®ä¸ºEXECUTEDï¼Œå‡½æ•°è¿”å›trueã€‚</li>\n<li>buyerIdã€sellerIdä¸ºnullã€amountå°äº0ï¼Œè¿”å›InvalidTransactionExceptionã€‚</li>\n<li>äº¤æ˜“å·²è¿‡æœŸï¼ˆcreateTimestampè¶…è¿‡14å¤©ï¼‰ï¼Œäº¤æ˜“çŠ¶æ€è®¾ç½®ä¸ºEXPIREDï¼Œè¿”å›falseã€‚</li>\n<li>äº¤æ˜“å·²ç»æ‰§è¡Œäº†ï¼ˆstatus==EXECUTEDï¼‰ï¼Œä¸å†é‡å¤æ‰§è¡Œè½¬é’±é€»è¾‘ï¼Œè¿”å›trueã€‚</li>\n<li>é’±åŒ…ï¼ˆWalletRpcServiceï¼‰è½¬é’±å¤±è´¥ï¼Œäº¤æ˜“çŠ¶æ€è®¾ç½®ä¸ºFAILEDï¼Œå‡½æ•°è¿”å›falseã€‚</li>\n<li>äº¤æ˜“æ­£åœ¨æ‰§è¡Œç€ï¼Œä¸ä¼šè¢«é‡å¤æ‰§è¡Œï¼Œå‡½æ•°ç›´æ¥è¿”å›falseã€‚</li>\n</ol><p>æµ‹è¯•ç”¨ä¾‹è®¾è®¡å®Œäº†ã€‚ç°åœ¨çœ‹èµ·æ¥ä¼¼ä¹ä¸€åˆ‡è¿›å±•é¡ºåˆ©ã€‚ä½†æ˜¯ï¼Œäº‹å®æ˜¯ï¼Œå½“æˆ‘ä»¬å°†æµ‹è¯•ç”¨ä¾‹è½å®åˆ°å…·ä½“çš„ä»£ç å®ç°æ—¶ï¼Œä½ å°±ä¼šå‘ç°æœ‰å¾ˆå¤šè¡Œä¸é€šçš„åœ°æ–¹ã€‚å¯¹äºä¸Šé¢çš„æµ‹è¯•ç”¨ä¾‹ï¼Œç¬¬2ä¸ªå®ç°èµ·æ¥éå¸¸ç®€å•ï¼Œæˆ‘å°±ä¸åšä»‹ç»äº†ã€‚æˆ‘ä»¬é‡ç‚¹æ¥çœ‹å…¶ä¸­çš„1å’Œ3ã€‚æµ‹è¯•ç”¨ä¾‹4ã€5ã€6è·Ÿ3ç±»ä¼¼ï¼Œç•™ç»™ä½ è‡ªå·±æ¥å®ç°ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±æ¥çœ‹æµ‹è¯•ç”¨ä¾‹1çš„ä»£ç å®ç°ã€‚å…·ä½“å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>public void testExecute() {\n  Long buyerId = 123L;\n  Long sellerId = 234L;\n  Long productId = 345L;\n  Long orderId = 456L;\n  Transction transaction = new Transaction(null, buyerId, sellerId, productId, orderId);\n  boolean executedResult = transaction.execute();\n  assertTrue(executedResult);\n}\n</code></pre><p>execute()å‡½æ•°çš„æ‰§è¡Œä¾èµ–ä¸¤ä¸ªå¤–éƒ¨çš„æœåŠ¡ï¼Œä¸€ä¸ªæ˜¯RedisDistributedLockï¼Œä¸€ä¸ªWalletRpcServiceã€‚è¿™å°±å¯¼è‡´ä¸Šé¢çš„å•å…ƒæµ‹è¯•ä»£ç å­˜åœ¨ä¸‹é¢å‡ ä¸ªé—®é¢˜ã€‚</p><ul>\n<li>å¦‚æœè¦è®©è¿™ä¸ªå•å…ƒæµ‹è¯•èƒ½å¤Ÿè¿è¡Œï¼Œæˆ‘ä»¬éœ€è¦æ­å»ºRedisæœåŠ¡å’ŒWallet RPCæœåŠ¡ã€‚æ­å»ºå’Œç»´æŠ¤çš„æˆæœ¬æ¯”è¾ƒé«˜ã€‚</li>\n<li>æˆ‘ä»¬è¿˜éœ€è¦ä¿è¯å°†ä¼ªé€ çš„transactionæ•°æ®å‘é€ç»™Wallet RPCæœåŠ¡ä¹‹åï¼Œèƒ½å¤Ÿæ­£ç¡®è¿”å›æˆ‘ä»¬æœŸæœ›çš„ç»“æœï¼Œç„¶è€ŒWallet RPCæœåŠ¡æœ‰å¯èƒ½æ˜¯ç¬¬ä¸‰æ–¹ï¼ˆå¦ä¸€ä¸ªå›¢é˜Ÿå¼€å‘ç»´æŠ¤çš„ï¼‰çš„æœåŠ¡ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬å¯æ§çš„ã€‚æ¢å¥è¯è¯´ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è®©å®ƒè¿”å›ä»€ä¹ˆæ•°æ®å°±è¿”å›ä»€ä¹ˆã€‚</li>\n<li>Transactionçš„æ‰§è¡Œè·ŸRedisã€RPCæœåŠ¡é€šä¿¡ï¼Œéœ€è¦èµ°ç½‘ç»œï¼Œè€—æ—¶å¯èƒ½ä¼šæ¯”è¾ƒé•¿ï¼Œå¯¹å•å…ƒæµ‹è¯•æœ¬èº«çš„æ‰§è¡Œæ€§èƒ½ä¹Ÿä¼šæœ‰å½±å“ã€‚</li>\n<li>ç½‘ç»œçš„ä¸­æ–­ã€è¶…æ—¶ã€Redisã€RPCæœåŠ¡çš„ä¸å¯ç”¨ï¼Œéƒ½ä¼šå½±å“å•å…ƒæµ‹è¯•çš„æ‰§è¡Œã€‚</li>\n</ul><p>æˆ‘ä»¬å›åˆ°å•å…ƒæµ‹è¯•çš„å®šä¹‰ä¸Šæ¥çœ‹ä¸€ä¸‹ã€‚å•å…ƒæµ‹è¯•ä¸»è¦æ˜¯æµ‹è¯•ç¨‹åºå‘˜è‡ªå·±ç¼–å†™çš„ä»£ç é€»è¾‘çš„æ­£ç¡®æ€§ï¼Œå¹¶éæ˜¯ç«¯åˆ°ç«¯çš„é›†æˆæµ‹è¯•ï¼Œå®ƒä¸éœ€è¦æµ‹è¯•æ‰€ä¾èµ–çš„å¤–éƒ¨ç³»ç»Ÿï¼ˆåˆ†å¸ƒå¼é”ã€Wallet RPCæœåŠ¡ï¼‰çš„é€»è¾‘æ­£ç¡®æ€§ã€‚æ‰€ä»¥ï¼Œå¦‚æœä»£ç ä¸­ä¾èµ–äº†å¤–éƒ¨ç³»ç»Ÿæˆ–è€…ä¸å¯æ§ç»„ä»¶ï¼Œæ¯”å¦‚ï¼Œéœ€è¦ä¾èµ–æ•°æ®åº“ã€ç½‘ç»œé€šä¿¡ã€æ–‡ä»¶ç³»ç»Ÿç­‰ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦å°†è¢«æµ‹ä»£ç ä¸å¤–éƒ¨ç³»ç»Ÿè§£ä¾èµ–ï¼Œè€Œè¿™ç§è§£ä¾èµ–çš„æ–¹æ³•å°±å«ä½œâ€œmockâ€ã€‚æ‰€è°“çš„mockå°±æ˜¯ç”¨ä¸€ä¸ªâ€œå‡â€çš„æœåŠ¡æ›¿æ¢çœŸæ­£çš„æœåŠ¡ã€‚mockçš„æœåŠ¡å®Œå…¨åœ¨æˆ‘ä»¬çš„æ§åˆ¶ä¹‹ä¸‹ï¼Œæ¨¡æ‹Ÿè¾“å‡ºæˆ‘ä»¬æƒ³è¦çš„æ•°æ®ã€‚</p><p>é‚£å¦‚ä½•æ¥mockæœåŠ¡å‘¢ï¼Ÿmockçš„æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼Œæ‰‹åŠ¨mockå’Œåˆ©ç”¨æ¡†æ¶mockã€‚åˆ©ç”¨æ¡†æ¶mockä»…ä»…æ˜¯ä¸ºäº†ç®€åŒ–ä»£ç ç¼–å†™ï¼Œæ¯ä¸ªæ¡†æ¶çš„mockæ–¹å¼éƒ½ä¸å¤§ä¸€æ ·ã€‚æˆ‘ä»¬è¿™é‡Œåªå±•ç¤ºæ‰‹åŠ¨mockã€‚</p><p>æˆ‘ä»¬é€šè¿‡ç»§æ‰¿WalletRpcServiceç±»ï¼Œå¹¶ä¸”é‡å†™å…¶ä¸­çš„moveMoney()å‡½æ•°çš„æ–¹å¼æ¥å®ç°mockã€‚å…·ä½“çš„ä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤ºã€‚é€šè¿‡mockçš„æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥è®©moveMoney()è¿”å›ä»»æ„æˆ‘ä»¬æƒ³è¦çš„æ•°æ®ï¼Œå®Œå…¨åœ¨æˆ‘ä»¬çš„æ§åˆ¶èŒƒå›´å†…ï¼Œå¹¶ä¸”ä¸éœ€è¦çœŸæ­£è¿›è¡Œç½‘ç»œé€šä¿¡ã€‚</p><pre><code>public class MockWalletRpcServiceOne extends WalletRpcService {\n  public String moveMoney(Long id, Long fromUserId, Long toUserId, Double amount) {\n    return &quot;123bac&quot;;\n  } \n}\n\npublic class MockWalletRpcServiceTwo extends WalletRpcService {\n  public String moveMoney(Long id, Long fromUserId, Long toUserId, Double amount) {\n    return null;\n  } \n}\n</code></pre><p>ç°åœ¨æˆ‘ä»¬å†æ¥çœ‹ï¼Œå¦‚ä½•ç”¨MockWalletRpcServiceOneã€MockWalletRpcServiceTwoæ¥æ›¿æ¢ä»£ç ä¸­çš„çœŸæ­£çš„WalletRpcServiceå‘¢ï¼Ÿ</p><p>å› ä¸ºWalletRpcServiceæ˜¯åœ¨execute()å‡½æ•°ä¸­é€šè¿‡newçš„æ–¹å¼åˆ›å»ºçš„ï¼Œæˆ‘ä»¬æ— æ³•åŠ¨æ€åœ°å¯¹å…¶è¿›è¡Œæ›¿æ¢ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒTransactionç±»ä¸­çš„execute()æ–¹æ³•çš„å¯æµ‹è¯•æ€§å¾ˆå·®ï¼Œéœ€è¦é€šè¿‡é‡æ„æ¥è®©å…¶å˜å¾—æ›´å®¹æ˜“æµ‹è¯•ã€‚è¯¥å¦‚ä½•é‡æ„è¿™æ®µä»£ç å‘¢ï¼Ÿ</p><p>åœ¨<a href=\"https://time.geekbang.org/column/article/177444\">ç¬¬19èŠ‚</a>ä¸­ï¼Œæˆ‘ä»¬è®²åˆ°ï¼Œä¾èµ–æ³¨å…¥æ˜¯å®ç°ä»£ç å¯æµ‹è¯•æ€§çš„æœ€æœ‰æ•ˆçš„æ‰‹æ®µã€‚æˆ‘ä»¬å¯ä»¥åº”ç”¨ä¾èµ–æ³¨å…¥ï¼Œå°†WalletRpcServiceå¯¹è±¡çš„åˆ›å»ºåè½¬ç»™ä¸Šå±‚é€»è¾‘ï¼Œåœ¨å¤–éƒ¨åˆ›å»ºå¥½ä¹‹åï¼Œå†æ³¨å…¥åˆ°Transactionç±»ä¸­ã€‚é‡æ„ä¹‹åçš„Transactionç±»çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>public class Transaction {\n  //...\n  // æ·»åŠ ä¸€ä¸ªæˆå‘˜å˜é‡åŠå…¶setæ–¹æ³•\n  private WalletRpcService walletRpcService;\n  \n  public void setWalletRpcService(WalletRpcService walletRpcService) {\n    this.walletRpcService = walletRpcService;\n  }\n  // ...\n  public boolean execute() {\n    // ...\n    // åˆ é™¤ä¸‹é¢è¿™ä¸€è¡Œä»£ç \n    // WalletRpcService walletRpcService = new WalletRpcService();\n    // ...\n  }\n}\n</code></pre><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å•å…ƒæµ‹è¯•ä¸­ï¼Œéå¸¸å®¹æ˜“åœ°å°†WalletRpcServiceæ›¿æ¢æˆMockWalletRpcServiceOneæˆ–WalletRpcServiceTwoäº†ã€‚é‡æ„ä¹‹åçš„ä»£ç å¯¹åº”çš„å•å…ƒæµ‹è¯•å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>public void testExecute() {\n  Long buyerId = 123L;\n  Long sellerId = 234L;\n  Long productId = 345L;\n  Long orderId = 456L;\n  Transction transaction = new Transaction(null, buyerId, sellerId, productId, orderId);\n  // ä½¿ç”¨mockå¯¹è±¡æ¥æ›¿ä»£çœŸæ­£çš„RPCæœåŠ¡\n  transaction.setWalletRpcService(new MockWalletRpcServiceOne()):\n  boolean executedResult = transaction.execute();\n  assertTrue(executedResult);\n  assertEquals(STATUS.EXECUTED, transaction.getStatus());\n}\n</code></pre><p>WalletRpcServiceçš„mockå’Œæ›¿æ¢é—®é¢˜è§£å†³äº†ï¼Œæˆ‘ä»¬å†æ¥çœ‹RedisDistributedLockã€‚å®ƒçš„mockå’Œæ›¿æ¢è¦å¤æ‚ä¸€äº›ï¼Œä¸»è¦æ˜¯å› ä¸ºRedisDistributedLockæ˜¯ä¸€ä¸ªå•ä¾‹ç±»ã€‚å•ä¾‹ç›¸å½“äºä¸€ä¸ªå…¨å±€å˜é‡ï¼Œæˆ‘ä»¬æ— æ³•mockï¼ˆæ— æ³•ç»§æ‰¿å’Œé‡å†™æ–¹æ³•ï¼‰ï¼Œä¹Ÿæ— æ³•é€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼æ¥æ›¿æ¢ã€‚</p><p>å¦‚æœRedisDistributedLockæ˜¯æˆ‘ä»¬è‡ªå·±ç»´æŠ¤çš„ï¼Œå¯ä»¥è‡ªç”±ä¿®æ”¹ã€é‡æ„ï¼Œé‚£æˆ‘ä»¬å¯ä»¥å°†å…¶æ”¹ä¸ºéå•ä¾‹çš„æ¨¡å¼ï¼Œæˆ–è€…å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œæ¯”å¦‚IDistributedLockï¼Œè®©RedisDistributedLockå®ç°è¿™ä¸ªæ¥å£ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åƒå‰é¢WalletRpcServiceçš„æ›¿æ¢æ–¹å¼é‚£æ ·ï¼Œæ›¿æ¢RedisDistributedLockä¸ºMockRedisDistributedLockäº†ã€‚ä½†å¦‚æœRedisDistributedLockä¸æ˜¯æˆ‘ä»¬ç»´æŠ¤çš„ï¼Œæˆ‘ä»¬æ— æƒå»ä¿®æ”¹è¿™éƒ¨åˆ†ä»£ç ï¼Œè¿™ä¸ªæ—¶å€™è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥å¯¹transactionä¸Šé”è¿™éƒ¨åˆ†é€»è¾‘é‡æ–°å°è£…ä¸€ä¸‹ã€‚å…·ä½“ä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>public class TransactionLock {\n  public boolean lock(String id) {\n    return RedisDistributedLock.getSingletonIntance().lockTransction(id);\n  }\n  \n  public void unlock() {\n    RedisDistributedLock.getSingletonIntance().unlockTransction(id);\n  }\n}\n\npublic class Transaction {\n  //...\n  private TransactionLock lock;\n  \n  public void setTransactionLock(TransactionLock lock) {\n    this.lock = lock;\n  }\n \n  public boolean execute() {\n    //...\n    try {\n      isLocked = lock.lock();\n      //...\n    } finally {\n      if (isLocked) {\n        lock.unlock();\n      }\n    }\n    //...\n  }\n}\n</code></pre><p>é’ˆå¯¹é‡æ„è¿‡çš„ä»£ç ï¼Œæˆ‘ä»¬çš„å•å…ƒæµ‹è¯•ä»£ç ä¿®æ”¹ä¸ºä¸‹é¢è¿™ä¸ªæ ·å­ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨å•å…ƒæµ‹è¯•ä»£ç ä¸­éš”ç¦»çœŸæ­£çš„RedisDistributedLockåˆ†å¸ƒå¼é”è¿™éƒ¨åˆ†é€»è¾‘äº†ã€‚</p><pre><code>public void testExecute() {\n  Long buyerId = 123L;\n  Long sellerId = 234L;\n  Long productId = 345L;\n  Long orderId = 456L;\n  \n  TransactionLock mockLock = new TransactionLock() {\n    public boolean lock(String id) {\n      return true;\n    }\n  \n    public void unlock() {}\n  };\n  \n  Transction transaction = new Transaction(null, buyerId, sellerId, productId, orderId);\n  transaction.setWalletRpcService(new MockWalletRpcServiceOne());\n  transaction.setTransactionLock(mockLock);\n  boolean executedResult = transaction.execute();\n  assertTrue(executedResult);\n  assertEquals(STATUS.EXECUTED, transaction.getStatus());\n}\n</code></pre><p>è‡³æ­¤ï¼Œæµ‹è¯•ç”¨ä¾‹1å°±ç®—å†™å¥½äº†ã€‚æˆ‘ä»¬é€šè¿‡ä¾èµ–æ³¨å…¥å’Œmockï¼Œè®©å•å…ƒæµ‹è¯•ä»£ç ä¸ä¾èµ–ä»»ä½•ä¸å¯æ§çš„å¤–éƒ¨æœåŠ¡ã€‚ä½ å¯ä»¥ç…§ç€è¿™ä¸ªæ€è·¯ï¼Œè‡ªå·±å†™ä¸€ä¸‹æµ‹è¯•ç”¨ä¾‹4ã€5ã€6ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å†æ¥çœ‹æµ‹è¯•ç”¨ä¾‹3ï¼šäº¤æ˜“å·²è¿‡æœŸï¼ˆcreateTimestampè¶…è¿‡14å¤©ï¼‰ï¼Œäº¤æ˜“çŠ¶æ€è®¾ç½®ä¸ºEXPIREDï¼Œè¿”å›falseã€‚é’ˆå¯¹è¿™ä¸ªå•å…ƒæµ‹è¯•ç”¨ä¾‹ï¼Œæˆ‘ä»¬è¿˜æ˜¯å…ˆæŠŠä»£ç å†™å‡ºæ¥ï¼Œç„¶åå†æ¥åˆ†æã€‚</p><pre><code>public void testExecute_with_TransactionIsExpired() {\n  Long buyerId = 123L;\n  Long sellerId = 234L;\n  Long productId = 345L;\n  Long orderId = 456L;\n  Transction transaction = new Transaction(null, buyerId, sellerId, productId, orderId);\n  transaction.setCreatedTimestamp(System.currentTimestamp() - 14days);\n  boolean actualResult = transaction.execute();\n  assertFalse(actualResult);\n  assertEquals(STATUS.EXPIRED, transaction.getStatus());\n}\n</code></pre><p>ä¸Šé¢çš„ä»£ç çœ‹ä¼¼æ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚æˆ‘ä»¬å°†transactionçš„åˆ›å»ºæ—¶é—´createdTimestampè®¾ç½®ä¸º14å¤©å‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å•å…ƒæµ‹è¯•ä»£ç è¿è¡Œçš„æ—¶å€™ï¼Œtransactionä¸€å®šæ˜¯å¤„äºè¿‡æœŸçŠ¶æ€ã€‚ä½†æ˜¯ï¼Œå¦‚æœåœ¨Transactionç±»ä¸­ï¼Œå¹¶æ²¡æœ‰æš´éœ²ä¿®æ”¹createdTimestampæˆå‘˜å˜é‡çš„setæ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯æ²¡æœ‰å®šä¹‰setCreatedTimestamp()å‡½æ•°ï¼‰å‘¢ï¼Ÿ</p><p>ä½ å¯èƒ½ä¼šè¯´ï¼Œå¦‚æœæ²¡æœ‰createTimestampçš„setæ–¹æ³•ï¼Œæˆ‘å°±é‡æ–°æ·»åŠ ä¸€ä¸ªå‘—ï¼å®é™…ä¸Šï¼Œè¿™è¿åäº†ç±»çš„å°è£…ç‰¹æ€§ã€‚åœ¨Transactionç±»çš„è®¾è®¡ä¸­ï¼ŒcreateTimestampæ˜¯åœ¨äº¤æ˜“ç”Ÿæˆæ—¶ï¼ˆä¹Ÿå°±æ˜¯æ„é€ å‡½æ•°ä¸­ï¼‰è‡ªåŠ¨è·å–çš„ç³»ç»Ÿæ—¶é—´ï¼Œæœ¬æ¥å°±ä¸åº”è¯¥äººä¸ºåœ°è½»æ˜“ä¿®æ”¹ï¼Œæ‰€ä»¥ï¼Œæš´éœ²createTimestampçš„setæ–¹æ³•ï¼Œè™½ç„¶å¸¦æ¥äº†çµæ´»æ€§ï¼Œä½†ä¹Ÿå¸¦æ¥äº†ä¸å¯æ§æ€§ã€‚å› ä¸ºï¼Œæˆ‘ä»¬æ— æ³•æ§åˆ¶ä½¿ç”¨è€…æ˜¯å¦ä¼šè°ƒç”¨setæ–¹æ³•é‡è®¾createTimestampï¼Œè€Œé‡è®¾createTimestampå¹¶éæˆ‘ä»¬çš„é¢„æœŸè¡Œä¸ºã€‚</p><p>é‚£å¦‚æœæ²¡æœ‰é’ˆå¯¹createTimestampçš„setæ–¹æ³•ï¼Œé‚£æµ‹è¯•ç”¨ä¾‹3åˆè¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿå®é™…ä¸Šï¼Œè¿™æ˜¯ä¸€ç±»æ¯”è¾ƒå¸¸è§çš„é—®é¢˜ï¼Œå°±æ˜¯ä»£ç ä¸­åŒ…å«è·Ÿâ€œæ—¶é—´â€æœ‰å…³çš„â€œæœªå†³è¡Œä¸ºâ€é€»è¾‘ã€‚æˆ‘ä»¬ä¸€èˆ¬çš„å¤„ç†æ–¹å¼æ˜¯å°†è¿™ç§æœªå†³è¡Œä¸ºé€»è¾‘é‡æ–°å°è£…ã€‚é’ˆå¯¹Transactionç±»ï¼Œæˆ‘ä»¬åªéœ€è¦å°†äº¤æ˜“æ˜¯å¦è¿‡æœŸçš„é€»è¾‘ï¼Œå°è£…åˆ°isExpired()å‡½æ•°ä¸­å³å¯ï¼Œå…·ä½“çš„ä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>public class Transaction {\n\n  protected boolean isExpired() {\n    long executionInvokedTimestamp = System.currentTimestamp();\n    return executionInvokedTimestamp - createdTimestamp &gt; 14days;\n  }\n  \n  public boolean execute() throws InvalidTransactionException {\n    //...\n      if (isExpired()) {\n        this.status = STATUS.EXPIRED;\n        return false;\n      }\n    //...\n  }\n}\n</code></pre><p>é’ˆå¯¹é‡æ„ä¹‹åçš„ä»£ç ï¼Œæµ‹è¯•ç”¨ä¾‹3çš„ä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>public void testExecute_with_TransactionIsExpired() {\n  Long buyerId = 123L;\n  Long sellerId = 234L;\n  Long productId = 345L;\n  Long orderId = 456L;\n  Transction transaction = new Transaction(null, buyerId, sellerId, productId, orderId) {\n    protected boolean isExpired() {\n      return true;\n    }\n  };\n  boolean actualResult = transaction.execute();\n  assertFalse(actualResult);\n  assertEquals(STATUS.EXPIRED, transaction.getStatus());\n}\n</code></pre><p>é€šè¿‡é‡æ„ï¼ŒTransactionä»£ç çš„å¯æµ‹è¯•æ€§æé«˜äº†ã€‚ä¹‹å‰ç½—åˆ—çš„æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ï¼Œç°åœ¨æˆ‘ä»¬éƒ½é¡ºåˆ©å®ç°äº†ã€‚ä¸è¿‡ï¼ŒTransactionç±»çš„æ„é€ å‡½æ•°çš„è®¾è®¡è¿˜æœ‰ç‚¹ä¸å¦¥ã€‚ä¸ºäº†æ–¹ä¾¿ä½ æŸ¥çœ‹ï¼Œæˆ‘æŠŠæ„é€ å‡½æ•°çš„ä»£ç é‡æ–°copyäº†ä¸€ä»½è´´åˆ°è¿™é‡Œã€‚</p><pre><code>  public Transaction(String preAssignedId, Long buyerId, Long sellerId, Long productId, String orderId) {\n    if (preAssignedId != null &amp;&amp; !preAssignedId.isEmpty()) {\n      this.id = preAssignedId;\n    } else {\n      this.id = IdGenerator.generateTransactionId();\n    }\n    if (!this.id.startWith(&quot;t_&quot;)) {\n      this.id = &quot;t_&quot; + preAssignedId;\n    }\n    this.buyerId = buyerId;\n    this.sellerId = sellerId;\n    this.productId = productId;\n    this.orderId = orderId;\n    this.status = STATUS.TO_BE_EXECUTD;\n    this.createTimestamp = System.currentTimestamp();\n  }\n</code></pre><p>æˆ‘ä»¬å‘ç°ï¼Œæ„é€ å‡½æ•°ä¸­å¹¶éåªåŒ…å«ç®€å•èµ‹å€¼æ“ä½œã€‚äº¤æ˜“idçš„èµ‹å€¼é€»è¾‘ç¨å¾®å¤æ‚ã€‚æˆ‘ä»¬æœ€å¥½ä¹Ÿè¦æµ‹è¯•ä¸€ä¸‹ï¼Œä»¥ä¿è¯è¿™éƒ¨åˆ†é€»è¾‘çš„æ­£ç¡®æ€§ã€‚ä¸ºäº†æ–¹ä¾¿æµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠidèµ‹å€¼è¿™éƒ¨åˆ†é€»è¾‘å•ç‹¬æŠ½è±¡åˆ°ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œå…·ä½“çš„ä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>  public Transaction(String preAssignedId, Long buyerId, Long sellerId, Long productId, String orderId) {\n    //...\n    fillTransactionId(preAssignId);\n    //...\n  }\n  \n  protected void fillTransactionId(String preAssignedId) {\n    if (preAssignedId != null &amp;&amp; !preAssignedId.isEmpty()) {\n      this.id = preAssignedId;\n    } else {\n      this.id = IdGenerator.generateTransactionId();\n    }\n    if (!this.id.startWith(&quot;t_&quot;)) {\n      this.id = &quot;t_&quot; + preAssignedId;\n    }\n  }\n</code></pre><p>åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥å°†Transactionä»ä¸å¯æµ‹è¯•ä»£ç é‡æ„æˆäº†æµ‹è¯•æ€§è‰¯å¥½çš„ä»£ç ã€‚ä¸è¿‡ï¼Œä½ å¯èƒ½è¿˜ä¼šæœ‰ç–‘é—®ï¼ŒTransactionç±»ä¸­isExpired()å‡½æ•°å°±ä¸ç”¨æµ‹è¯•äº†å—ï¼Ÿå¯¹äºisExpired()å‡½æ•°ï¼Œé€»è¾‘éå¸¸ç®€å•ï¼Œè‚‰çœ¼å°±èƒ½åˆ¤å®šæ˜¯å¦æœ‰bugï¼Œæ˜¯å¯ä»¥ä¸ç”¨å†™å•å…ƒæµ‹è¯•çš„ã€‚</p><p>å®é™…ä¸Šï¼Œå¯æµ‹è¯•æ€§å·®çš„ä»£ç ï¼Œæœ¬èº«ä»£ç è®¾è®¡å¾—ä¹Ÿä¸å¤Ÿå¥½ï¼Œå¾ˆå¤šåœ°æ–¹éƒ½æ²¡æœ‰éµå®ˆæˆ‘ä»¬ä¹‹å‰è®²åˆ°çš„è®¾è®¡åŸåˆ™å’Œæ€æƒ³ï¼Œæ¯”å¦‚â€œåŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹â€æ€æƒ³ã€ä¾èµ–åè½¬åŸåˆ™ç­‰ã€‚é‡æ„ä¹‹åçš„ä»£ç ï¼Œä¸ä»…å¯æµ‹è¯•æ€§æ›´å¥½ï¼Œè€Œä¸”ä»ä»£ç è®¾è®¡çš„è§’åº¦æ¥è¯´ï¼Œä¹Ÿéµä»äº†ç»å…¸çš„è®¾è®¡åŸåˆ™å’Œæ€æƒ³ã€‚è¿™ä¹Ÿå°è¯äº†æˆ‘ä»¬ä¹‹å‰è¯´è¿‡çš„ï¼Œä»£ç çš„å¯æµ‹è¯•æ€§å¯ä»¥ä»ä¾§é¢ä¸Šååº”ä»£ç è®¾è®¡æ˜¯å¦åˆç†ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨å¹³æ—¶çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿè¦å¤šæ€è€ƒä¸€ä¸‹ï¼Œè¿™æ ·ç¼–å†™ä»£ç ï¼Œæ˜¯å¦å®¹æ˜“ç¼–å†™å•å…ƒæµ‹è¯•ï¼Œè¿™ä¹Ÿæœ‰åˆ©äºæˆ‘ä»¬è®¾è®¡å‡ºå¥½çš„ä»£ç ã€‚</p><h2>å…¶ä»–å¸¸è§çš„Anti-Patterns</h2><p>åˆšåˆšæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå®æˆ˜æ¡ˆä¾‹ï¼Œè®²è§£äº†å¦‚ä½•åˆ©ç”¨ä¾èµ–æ³¨å…¥æ¥æé«˜ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Œä»¥åŠç¼–å†™å•å…ƒæµ‹è¯•ä¸­æœ€å¤æ‚çš„ä¸€éƒ¨åˆ†å†…å®¹ï¼šå¦‚ä½•é€šè¿‡mockã€äºŒæ¬¡å°è£…ç­‰æ–¹å¼è§£ä¾èµ–å¤–éƒ¨æœåŠ¡ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å†æ¥æ€»ç»“ä¸€ä¸‹ï¼Œæœ‰å“ªäº›å…¸å‹çš„ã€å¸¸è§çš„æµ‹è¯•æ€§ä¸å¥½çš„ä»£ç ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„Anti-Patternsã€‚</p><h3>1.æœªå†³è¡Œä¸º</h3><p>æ‰€è°“çš„æœªå†³è¡Œä¸ºé€»è¾‘å°±æ˜¯ï¼Œä»£ç çš„è¾“å‡ºæ˜¯éšæœºæˆ–è€…è¯´ä¸ç¡®å®šçš„ï¼Œæ¯”å¦‚ï¼Œè·Ÿæ—¶é—´ã€éšæœºæ•°æœ‰å…³çš„ä»£ç ã€‚å¯¹äºè¿™ä¸€ç‚¹ï¼Œåœ¨åˆšåˆšçš„å®æˆ˜æ¡ˆä¾‹ä¸­æˆ‘ä»¬å·²ç»è®²åˆ°ï¼Œä½ å¯ä»¥åˆ©ç”¨åˆšæ‰è®²åˆ°çš„æ–¹æ³•ï¼Œè¯•ç€é‡æ„ä¸€ä¸‹ä¸‹é¢çš„ä»£ç ï¼Œå¹¶ä¸”ä¸ºå®ƒç¼–å†™å•å…ƒæµ‹è¯•ã€‚</p><pre><code>public class Demo {\n  public long caculateDelayDays(Date dueTime) {\n    long currentTimestamp = System.currentTimeMillis();\n    if (dueTime.getTime() &gt;= currentTimestamp) {\n      return 0;\n    }\n    long delayTime = currentTimestamp - dueTime.getTime();\n    long delayDays = delayTime / 86400;\n    return delayDays;\n  }\n}\n</code></pre><h3>2.å…¨å±€å˜é‡</h3><p>å‰é¢æˆ‘ä»¬è®²è¿‡ï¼Œå…¨å±€å˜é‡æ˜¯ä¸€ç§é¢å‘è¿‡ç¨‹çš„ç¼–ç¨‹é£æ ¼ï¼Œæœ‰ç§ç§å¼Šç«¯ã€‚å®é™…ä¸Šï¼Œæ»¥ç”¨å…¨å±€å˜é‡ä¹Ÿè®©ç¼–å†™å•å…ƒæµ‹è¯•å˜å¾—å›°éš¾ã€‚æˆ‘ä¸¾ä¸ªä¾‹å­æ¥è§£é‡Šä¸€ä¸‹ã€‚</p><p>RangeLimiterè¡¨ç¤ºä¸€ä¸ª[-5, 5]çš„åŒºé—´ï¼Œpositionåˆå§‹åœ¨0ä½ç½®ï¼Œmove()å‡½æ•°è´Ÿè´£ç§»åŠ¨positionã€‚å…¶ä¸­ï¼Œpositionæ˜¯ä¸€ä¸ªé™æ€å…¨å±€å˜é‡ã€‚RangeLimiterTestç±»æ˜¯ä¸ºå…¶è®¾è®¡çš„å•å…ƒæµ‹è¯•ï¼Œä¸è¿‡ï¼Œè¿™é‡Œé¢å­˜åœ¨å¾ˆå¤§çš„é—®é¢˜ï¼Œä½ å¯ä»¥å…ˆè‡ªå·±åˆ†æä¸€ä¸‹ã€‚</p><pre><code>public class RangeLimiter {\n  private static AtomicInteger position = new AtomicInteger(0);\n  public static final int MAX_LIMIT = 5;\n  public static final int MIN_LIMIT = -5;\n\n  public boolean move(int delta) {\n    int currentPos = position.addAndGet(delta);\n    boolean betweenRange = (currentPos &lt;= MAX_LIMIT) &amp;&amp; (currentPos &gt;= MIN_LIMIT);\n    return betweenRange;\n  }\n}\n\npublic class RangeLimiterTest {\n  public void testMove_betweenRange() {\n    RangeLimiter rangeLimiter = new RangeLimiter();\n    assertTrue(rangeLimiter.move(1));\n    assertTrue(rangeLimiter.move(3));\n    assertTrue(rangeLimiter.move(-5));\n  }\n\n  public void testMove_exceedRange() {\n    RangeLimiter rangeLimiter = new RangeLimiter();\n    assertFalse(rangeLimiter.move(6));\n  }\n}\n</code></pre><p>ä¸Šé¢çš„å•å…ƒæµ‹è¯•æœ‰å¯èƒ½ä¼šè¿è¡Œå¤±è´¥ã€‚å‡è®¾å•å…ƒæµ‹è¯•æ¡†æ¶é¡ºåºä¾æ¬¡æ‰§è¡ŒtestMove_betweenRange()å’ŒtestMove_exceedRange()ä¸¤ä¸ªæµ‹è¯•ç”¨ä¾‹ã€‚åœ¨ç¬¬ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå®Œæˆä¹‹åï¼Œpositionçš„å€¼å˜æˆäº†-1ï¼›å†æ‰§è¡Œç¬¬äºŒä¸ªæµ‹è¯•ç”¨ä¾‹çš„æ—¶å€™ï¼Œpositionå˜æˆäº†5ï¼Œmove()å‡½æ•°è¿”å›trueï¼ŒassertFalseè¯­å¥åˆ¤å®šå¤±è´¥ã€‚æ‰€ä»¥ï¼Œç¬¬äºŒä¸ªæµ‹è¯•ç”¨ä¾‹è¿è¡Œå¤±è´¥ã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœRangeLimiterç±»æœ‰æš´éœ²é‡è®¾ï¼ˆresetï¼‰positionå€¼çš„å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¯æ¬¡æ‰§è¡Œå•å…ƒæµ‹è¯•ç”¨ä¾‹ä¹‹å‰ï¼ŒæŠŠpositioné‡è®¾ä¸º0ï¼Œè¿™æ ·å°±èƒ½è§£å†³åˆšåˆšçš„é—®é¢˜ã€‚</p><p>ä¸è¿‡ï¼Œæ¯ä¸ªå•å…ƒæµ‹è¯•æ¡†æ¶æ‰§è¡Œå•å…ƒæµ‹è¯•ç”¨ä¾‹çš„æ–¹å¼å¯èƒ½æ˜¯ä¸åŒçš„ã€‚æœ‰çš„æ˜¯é¡ºåºæ‰§è¡Œï¼Œæœ‰çš„æ˜¯å¹¶å‘æ‰§è¡Œã€‚å¯¹äºå¹¶å‘æ‰§è¡Œçš„æƒ…å†µï¼Œå³ä¾¿æˆ‘ä»¬æ¯æ¬¡éƒ½æŠŠpositioné‡è®¾ä¸º0ï¼Œä¹Ÿå¹¶ä¸å¥æ•ˆã€‚å¦‚æœä¸¤ä¸ªæµ‹è¯•ç”¨ä¾‹å¹¶å‘æ‰§è¡Œï¼Œç¬¬16ã€17ã€18ã€23è¿™å››è¡Œä»£ç å¯èƒ½ä¼šäº¤å‰æ‰§è¡Œï¼Œå½±å“åˆ°move()å‡½æ•°çš„æ‰§è¡Œç»“æœã€‚</p><h3>3.é™æ€æ–¹æ³•</h3><p>å‰é¢æˆ‘ä»¬ä¹Ÿæåˆ°ï¼Œé™æ€æ–¹æ³•è·Ÿå…¨å±€å˜é‡ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€ç§é¢å‘è¿‡ç¨‹çš„ç¼–ç¨‹æ€ç»´ã€‚åœ¨ä»£ç ä¸­è°ƒç”¨é™æ€æ–¹æ³•ï¼Œæœ‰æ—¶å€™ä¼šå¯¼è‡´ä»£ç ä¸æ˜“æµ‹è¯•ã€‚ä¸»è¦åŸå› æ˜¯é™æ€æ–¹æ³•ä¹Ÿå¾ˆéš¾mockã€‚ä½†æ˜¯ï¼Œè¿™ä¸ªè¦åˆ†æƒ…å†µæ¥çœ‹ã€‚åªæœ‰åœ¨è¿™ä¸ªé™æ€æ–¹æ³•æ‰§è¡Œè€—æ—¶å¤ªé•¿ã€ä¾èµ–å¤–éƒ¨èµ„æºã€é€»è¾‘å¤æ‚ã€è¡Œä¸ºæœªå†³ç­‰æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ‰éœ€è¦åœ¨å•å…ƒæµ‹è¯•ä¸­mockè¿™ä¸ªé™æ€æ–¹æ³•ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœåªæ˜¯ç±»ä¼¼Math.abs()è¿™æ ·çš„ç®€å•é™æ€æ–¹æ³•ï¼Œå¹¶ä¸ä¼šå½±å“ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Œå› ä¸ºæœ¬èº«å¹¶ä¸éœ€è¦mockã€‚</p><h3>4.å¤æ‚ç»§æ‰¿</h3><p>æˆ‘ä»¬å‰é¢æåˆ°ï¼Œç›¸æ¯”ç»„åˆå…³ç³»ï¼Œç»§æ‰¿å…³ç³»çš„ä»£ç ç»“æ„æ›´åŠ è€¦åˆã€ä¸çµæ´»ï¼Œæ›´åŠ ä¸æ˜“æ‰©å±•ã€ä¸æ˜“ç»´æŠ¤ã€‚å®é™…ä¸Šï¼Œç»§æ‰¿å…³ç³»ä¹Ÿæ›´åŠ éš¾æµ‹è¯•ã€‚è¿™ä¹Ÿå°è¯äº†ä»£ç çš„å¯æµ‹è¯•æ€§è·Ÿä»£ç è´¨é‡çš„ç›¸å…³æ€§ã€‚</p><p>å¦‚æœçˆ¶ç±»éœ€è¦mockæŸä¸ªä¾èµ–å¯¹è±¡æ‰èƒ½è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œé‚£æ‰€æœ‰çš„å­ç±»ã€å­ç±»çš„å­ç±»â€¦â€¦åœ¨ç¼–å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œéƒ½è¦mockè¿™ä¸ªä¾èµ–å¯¹è±¡ã€‚å¯¹äºå±‚æ¬¡å¾ˆæ·±ï¼ˆåœ¨ç»§æ‰¿å…³ç³»ç±»å›¾ä¸­è¡¨ç°ä¸ºçºµå‘æ·±åº¦ï¼‰ã€ç»“æ„å¤æ‚ï¼ˆåœ¨ç»§æ‰¿å…³ç³»ç±»å›¾ä¸­è¡¨ç°ä¸ºæ¨ªå‘å¹¿åº¦ï¼‰çš„ç»§æ‰¿å…³ç³»ï¼Œè¶Šåº•å±‚çš„å­ç±»è¦mockçš„å¯¹è±¡å¯èƒ½å°±ä¼šè¶Šå¤šï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´ï¼Œåº•å±‚å­ç±»åœ¨å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œè¦ä¸€ä¸ªä¸€ä¸ªmockå¾ˆå¤šä¾èµ–å¯¹è±¡ï¼Œè€Œä¸”è¿˜éœ€è¦æŸ¥çœ‹çˆ¶ç±»ä»£ç ï¼Œå»äº†è§£è¯¥å¦‚ä½•mockè¿™äº›ä¾èµ–å¯¹è±¡ã€‚</p><p>å¦‚æœæˆ‘ä»¬åˆ©ç”¨ç»„åˆè€Œéç»§æ‰¿æ¥ç»„ç»‡ç±»ä¹‹é—´çš„å…³ç³»ï¼Œç±»ä¹‹é—´çš„ç»“æ„å±‚æ¬¡æ¯”è¾ƒæ‰å¹³ï¼Œåœ¨ç¼–å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œåªéœ€è¦mockç±»æ‰€ç»„åˆä¾èµ–çš„å¯¹è±¡å³å¯ã€‚</p><h3>5.é«˜è€¦åˆä»£ç </h3><p>å¦‚æœä¸€ä¸ªç±»èŒè´£å¾ˆé‡ï¼Œéœ€è¦ä¾èµ–åå‡ ä¸ªå¤–éƒ¨å¯¹è±¡æ‰èƒ½å®Œæˆå·¥ä½œï¼Œä»£ç é«˜åº¦è€¦åˆï¼Œé‚£æˆ‘ä»¬åœ¨ç¼–å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œå¯èƒ½éœ€è¦mockè¿™åå‡ ä¸ªä¾èµ–çš„å¯¹è±¡ã€‚ä¸ç®¡æ˜¯ä»ä»£ç è®¾è®¡çš„è§’åº¦æ¥è¯´ï¼Œè¿˜æ˜¯ä»ç¼–å†™å•å…ƒæµ‹è¯•çš„è§’åº¦æ¥è¯´ï¼Œè¿™éƒ½æ˜¯ä¸åˆç†çš„ã€‚</p><h2>é‡ç‚¹å›é¡¾</h2><p>å¥½äº†ï¼Œä»Šå¤©çš„å†…å®¹åˆ°æ­¤å°±è®²å®Œäº†ã€‚æˆ‘ä»¬ä¸€å—æ¥æ€»ç»“å›é¡¾ä¸€ä¸‹ï¼Œä½ éœ€è¦é‡ç‚¹æŒæ¡çš„å†…å®¹ã€‚</p><p><strong>1.ä»€ä¹ˆæ˜¯ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Ÿ</strong></p><p>ç²—ç•¥åœ°è®²ï¼Œæ‰€è°“ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Œå°±æ˜¯é’ˆå¯¹ä»£ç ç¼–å†™å•å…ƒæµ‹è¯•çš„éš¾æ˜“ç¨‹åº¦ã€‚å¯¹äºä¸€æ®µä»£ç ï¼Œå¦‚æœå¾ˆéš¾ä¸ºå…¶ç¼–å†™å•å…ƒæµ‹è¯•ï¼Œæˆ–è€…å•å…ƒæµ‹è¯•å†™èµ·æ¥å¾ˆè´¹åŠ²ï¼Œéœ€è¦ä¾é å•å…ƒæµ‹è¯•æ¡†æ¶ä¸­å¾ˆé«˜çº§çš„ç‰¹æ€§ï¼Œé‚£å¾€å¾€å°±æ„å‘³ç€ä»£ç è®¾è®¡å¾—ä¸å¤Ÿåˆç†ï¼Œä»£ç çš„å¯æµ‹è¯•æ€§ä¸å¥½ã€‚</p><p><strong>2.ç¼–å†™å¯æµ‹è¯•æ€§ä»£ç çš„æœ€æœ‰æ•ˆæ‰‹æ®µ</strong></p><p>ä¾èµ–æ³¨å…¥æ˜¯ç¼–å†™å¯æµ‹è¯•æ€§ä»£ç çš„æœ€æœ‰æ•ˆæ‰‹æ®µã€‚é€šè¿‡ä¾èµ–æ³¨å…¥ï¼Œæˆ‘ä»¬åœ¨ç¼–å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡mockçš„æ–¹æ³•è§£ä¾èµ–å¤–éƒ¨æœåŠ¡ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨ç¼–å†™å•å…ƒæµ‹è¯•çš„è¿‡ç¨‹ä¸­æœ€æœ‰æŠ€æœ¯æŒ‘æˆ˜çš„åœ°æ–¹ã€‚</p><p><strong>3.å¸¸è§çš„Anti-Patterns</strong></p><p>å¸¸è§çš„æµ‹è¯•ä¸å‹å¥½çš„ä»£ç æœ‰ä¸‹é¢è¿™5ç§ï¼š</p><ul>\n<li>ä»£ç ä¸­åŒ…å«æœªå†³è¡Œä¸ºé€»è¾‘</li>\n<li>æ»¥ç”¨å¯å˜å…¨å±€å˜é‡</li>\n<li>æ»¥ç”¨é™æ€æ–¹æ³•</li>\n<li>ä½¿ç”¨å¤æ‚çš„ç»§æ‰¿å…³ç³»</li>\n<li>é«˜åº¦è€¦åˆçš„ä»£ç </li>\n</ul><h2>è¯¾å ‚è®¨è®º</h2><ol>\n<li>å®æˆ˜æ¡ˆä¾‹ä¸­çš„void fillTransactionId(String preAssignedId)å‡½æ•°ä¸­åŒ…å«ä¸€å¤„é™æ€å‡½æ•°è°ƒç”¨ï¼šIdGenerator.generateTransactionId()ï¼Œè¿™æ˜¯å¦ä¼šå½±å“åˆ°ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Ÿåœ¨å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯å¦éœ€è¦mockè¿™ä¸ªå‡½æ•°ï¼Ÿ</li>\n<li>æˆ‘ä»¬ä»Šå¤©è®²åˆ°ï¼Œä¾èµ–æ³¨å…¥æ˜¯æé«˜ä»£ç å¯æµ‹è¯•æ€§çš„æœ€æœ‰æ•ˆçš„æ‰‹æ®µã€‚æ‰€ä»¥ï¼Œä¾èµ–æ³¨å…¥ï¼Œå°±æ˜¯ä¸è¦åœ¨ç±»å†…éƒ¨é€šè¿‡newçš„æ–¹å¼åˆ›å»ºå¯¹è±¡ï¼Œè€Œæ˜¯è¦é€šè¿‡å¤–éƒ¨åˆ›å»ºå¥½ä¹‹åä¼ é€’ç»™ç±»ä½¿ç”¨ã€‚é‚£æ˜¯ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡éƒ½ä¸èƒ½åœ¨ç±»å†…éƒ¨åˆ›å»ºå‘¢ï¼Ÿå“ªç§ç±»å‹çš„å¯¹è±¡å¯ä»¥åœ¨ç±»å†…éƒ¨åˆ›å»ºå¹¶ä¸”ä¸å½±å“ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Ÿä½ èƒ½ä¸¾å‡ ä¸ªä¾‹å­å—ï¼Ÿ</li>\n</ol><p>æ¬¢è¿åœ¨ç•™è¨€åŒºå†™ä¸‹ä½ çš„ç­”æ¡ˆï¼Œå’ŒåŒå­¦ä¸€èµ·äº¤æµå’Œåˆ†äº«ã€‚å¦‚æœæœ‰æ”¶è·ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚</p>","comments":[{"had_liked":false,"id":169761,"user_name":"å¤±ç«çš„å¤å¤©","can_delete":false,"product_type":"c1","uid":1241770,"ip_address":"","ucode":"10C6E66EB2A65F","user_header":"https://static001.geekbang.org/account/avatar/00/12/f2/aa/32fc0d54.jpg","comment_is_top":false,"comment_ctime":1578443379,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"701658112627","product_id":100039001,"comment_content":"æ€è€ƒé¢˜1ï¼Œè¯¥æ–¹æ³•é€»è¾‘å°±æ˜¯å¡«å……ä¸€ä¸ªIDï¼ŒåŸºæœ¬éƒ½æ˜¯å†…éƒ¨å®ç°çš„ä¸€ä¸ªidç”Ÿæˆå™¨ï¼Œå¯ä»¥ä¸ç”¨é‡å†™ã€‚ä¸€å®šè¦é‡å†™ä¹Ÿè¡Œï¼Œè‡ªå·±å¼„ä¸€ä¸ªè‡ªå¢idå®ç°å°±è¡Œäº†ã€‚<br>æ€è€ƒé¢˜2ï¼Œæä¾›æ–¹æ³•çš„ç±»ä¸è¦newï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„serviceç±»ï¼Œè¿™ä¸ªæ˜¯è¦ä¾èµ–æ³¨å…¥çš„ã€‚æä¾›å±æ€§çš„ç±»ï¼Œæ¯”å¦‚voï¼Œboï¼Œentityè¿™äº›å°±å¯ä»¥newã€‚","like_count":164,"discussions":[{"author":{"id":1114093,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/ed/b2fc0e7c.jpg","nickname":"7","note":"","ucode":"10A6E57A027D42","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541163,"discussion_content":"æ€è€ƒé¢˜äºŒï¼Œè¡¥å……ä¸€ç‚¹ã€‚ä¸»ä»£ç çš„æ‰§è¡Œæƒ…å†µï¼Œå¹¶ä¸ä¸newå‡ºæ¥å¯¹è±¡çš„æ–¹æ³•æ‰§è¡Œæƒ…å†µè€¦åˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640271429,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2475056,"avatar":"https://static001.geekbang.org/account/avatar/00/25/c4/30/711b03e5.jpg","nickname":"Geek_Candice","note":"","ucode":"0F2CBCF624F905","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":371969,"discussion_content":"æ£’","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620109415,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":173308,"user_name":"æ¥Š_å®µå¤œ","can_delete":false,"product_type":"c1","uid":1019302,"ip_address":"","ucode":"7BA0CADC5F23BB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/a6/22c37c91.jpg","comment_is_top":false,"comment_ctime":1579501200,"is_pvip":false,"replies":[{"id":"67739","content":"ä¹Ÿæ˜¯æ²¡åŠæ³•çš„äº‹æƒ…ï¼Œç†è®ºä¸Šåº”è¯¥æ˜¯privateçš„ã€‚æ‰€ä»¥ä¼šæœ‰@VisibleForTestingè¿™æ ·çš„annotation","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹äº‰","uid":"1190123","ctime":1580117345,"ip_address":"","comment_id":173308,"utype":1}],"discussion_count":8,"race_medal":0,"score":"302227211920","product_id":100039001,"comment_content":"äº‰æ­Œ, ä»£ç ä¸­isExpired()æ–¹æ³•çš„ä¿®é¥°ç¬¦æ˜¯protected, å¦‚æœæŸäº›æ–¹æ³•ä»è®¾è®¡åŸåˆ™æ¥è¯´åº”è¯¥è®¾ç½®ä¸ºprivateçš„è¯, é‚£ä¹ˆè¿™æ ·çš„æ‰‹åŠ¨mockçš„æ–¹å¼æ˜¯å¦å°±ä¸é€‚ç”¨äº†å‘¢?<br>æ¢ä¸ªè§’åº¦æ¥æé—®: ä¸ºäº†ç»´æŒå¯æµ‹è¯•æ€§, åœ¨ä»£ç ä¸­åŠ å…¥è¿‡å¤šprotectedçš„æ–¹æ³•, æ˜¯å¦åˆç†å‘¢?","like_count":71},{"had_liked":false,"id":169774,"user_name":"å®‰é™çš„boy","can_delete":false,"product_type":"c1","uid":1196475,"ip_address":"","ucode":"F5F44B75228A85","user_header":"https://static001.geekbang.org/account/avatar/00/12/41/bb/21ce60d2.jpg","comment_is_top":false,"comment_ctime":1578445377,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"250686548545","product_id":100039001,"comment_content":"è¿™èŠ‚æ»¡æ»¡çš„å¹²è´§ğŸ‘ğŸ‘ğŸ‘","like_count":59},{"had_liked":false,"id":169785,"user_name":"è¾£ä¹ˆå¤§","can_delete":false,"product_type":"c1","uid":1396951,"ip_address":"","ucode":"AB308B6DCA0108","user_header":"https://static001.geekbang.org/account/avatar/00/15/50/d7/f82ed283.jpg","comment_is_top":false,"comment_ctime":1578446537,"is_pvip":true,"discussion_count":7,"race_medal":0,"score":"156197269193","product_id":100039001,"comment_content":"å‚è€ƒäº‰å“¥ä»Šå¤©çš„ä»£ç å†™äº†ä¾‹å­ä¸­çš„æµ‹è¯•ï¼ˆå¯è¿è¡Œï¼‰ï¼š<br>https:&#47;&#47;github.com&#47;gdhucoder&#47;Algorithms4&#47;tree&#47;master&#47;designpattern&#47;u29<br><br>ä»Šå¤©å­¦ä¹ åˆ°äº†é«˜çº§çš„å•å…ƒæµ‹è¯•æ–¹æ³•ï¼š<br>1ã€ä¾èµ–å¤–éƒ¨å•ä¾‹ï¼šå°†å•ä¾‹å°è£…<br>2ã€æœªå†³è¡Œä¸ºï¼šä¾‹æ—¶é—´ã€éšæœºæ•°ã€‚å°†æœªå†³è¡Œä¸ºé‡æ–°å°è£…ï¼Œæµ‹è¯•æ—¶mockï¼Œä½¿ç”¨åŒ¿åç±»ã€‚<br><br> å…³äºè®¨è®º1ï¼šéœ€è¦mockçš„æƒ…å†µidä¼šå†™å…¥æ•°æ®åº“çš„è¯ï¼Œæµ‹è¯•åéœ€è¦æ¢å¤ç°åœºã€‚æ›¾ç»é‡åˆ°è¿‡è¿™ä¹ˆä¸€ä¸ªæƒ…å†µï¼Œidæ˜¯é€šè¿‡ä¸€å¼ è¡¨ç»´æŠ¤çš„ï¼Œå¤§äº0ï¼Œåœ¨ä»£ç ä¸­idçš„æ•°æ®ç±»å‹æ˜¯Integerï¼ˆé—ç•™ä»£ç ï¼‰ï¼Œç”±äºæµ‹è¯•æ—¶æ²¡æœ‰æ¢å¤ç°åœºï¼Œå¯¼è‡´æµ‹è¯•æ•°æ®åº“ä¸­idå¢åŠ è¿‡å¿«ï¼Œè¶…è¿‡äº†ä»£ç ä¸­Integerçš„è¡¨ç¤ºèŒƒå›´ï¼Œè€Œäº§ç”Ÿäº†æ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚","like_count":37,"discussions":[{"author":{"id":1396951,"avatar":"https://static001.geekbang.org/account/avatar/00/15/50/d7/f82ed283.jpg","nickname":"è¾£ä¹ˆå¤§","note":"","ucode":"AB308B6DCA0108","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":131121,"discussion_content":"å“ªé‡Œï¼Œåˆ«å«æˆ‘å¤§ç¥äº†ï¼Œè¿™æ®µæ—¶é—´åœ¨ä¸Šå­¦ï¼Œä¸‰å¹´æ²¡å†™ä¹Ÿä¸šåŠ¡ä»£ç äº†ã€‚è¿™ç¯‡æ˜¯éƒ‘æ™”è€å¸ˆè®²å…³äºæµ‹è¯•çš„ï¼šhttps://time.geekbang.org/column/article/79494ï¼Œå…³äºæµ‹è¯•é—®é¢˜ä»–è¿˜å†™äº†æ¡†æ¶ï¼šhttps://github.com/dreamhead/moco 3k starsã€‚çœ‹èƒ½å¦å¯¹ä½ æœ‰å¸®åŠ©ã€‚å¦å¤–ä½ çš„é—®é¢˜æœ€åå¦‚æœè§£å†³äº†çš„è¯ï¼Œå¸Œæœ›èƒ½å‘Šè¯‰æˆ‘ä¸€ä¸‹è§£å†³æ–¹æ³•ï¼Œè°¢è°¢ï¼","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1578828147,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1092806,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ac/c6/30820fa2.jpg","nickname":"æé˜³","note":"","ucode":"22492F371F4C84","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":297648,"discussion_content":"è¿™ç§æµ‹è¯•ç”¨ä¾‹ä¸€èˆ¬ç”¨spring testå°±è¡Œäº†ï¼Œæµ‹è¯•å®ŒåŠ ä¸Šæ³¨è§£ä¸æäº¤äº‹åŠ¡ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1597016466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1325226,"avatar":"https://static001.geekbang.org/account/avatar/00/14/38/aa/5efa5ded.jpg","nickname":"_Sea","note":"","ucode":"8547A37BA766E5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":130976,"discussion_content":"å¤§ç¥ï¼Œè¯·æ•™ä¸€ä¸‹ï¼›ç°åœ¨æˆ‘ä»¬é¡¹ç›®åœ¨åšç¬¬ä¸‰æ–¹æ”¯ä»˜çš„æ¨¡å—ï¼Œä¹Ÿéœ€è¦å†™å•å…ƒæµ‹è¯•ï¼Œè€Œä¸”ä»£ç è¦†ç›–ç‡è¦æ±‚90ä»¥ä¸Šï¼›æœ‰ä¸ªé—®é¢˜å°±æ˜¯åœ¨è°ƒç”¨æ”¯ä»˜å®ç¬¬ä¸‰æ–¹æ¥å£çš„æ—¶å€™ï¼Œå†™å•å…ƒæµ‹è¯•æ—¶å¾ˆä¸å¥½å†™ï¼Œç‰¹åˆ«æ˜¯å¼‚æ­¥å›è°ƒéªŒç­¾çš„æ—¶å€™ï¼Œé€»è¾‘åˆ†æ”¯å¤šï¼Œéœ€è¦è‡ªå·±ç…§ç€æ”¯ä»˜å®çš„è¿”å›æ•°æ®æ ¼å¼é¢„ç½®å¾ˆå¤šæ•°æ®ï¼Œç±»ä¼¼è¿™ç§è°ƒç”¨ç¬¬ä¸‰æ–¹APIæ”¯ä»˜ä¸æ ¡éªŒçš„æœ‰æ²¡æœ‰æ¯”è¾ƒå¥½çš„æ–¹æ³•æµ‹è¯•ï¼Ÿ ps:æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯Spring junit5","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1578816196,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1610643,"avatar":"","nickname":"Geek_02ab4d","note":"","ucode":"2EC4198426A4A9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":409990,"discussion_content":"public isExpere() -> protected?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635564810,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2115387,"avatar":"https://static001.geekbang.org/account/avatar/00/20/47/3b/70198ceb.jpg","nickname":"Aibo","note":"","ucode":"2CE3E77BD2D014","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":325830,"discussion_content":"æœ‰æ•°æ®åº“æ“ä½œï¼Œä¸å°±æ˜¯ç±»ä¼¼æ–‡ç« ä¸­å¯¹redisçš„ä¾èµ–å—ã€‚å¯ä»¥é‡æ„å»mockå§ï¼Œæˆ–è€…å°±æ˜¯ä¸€å¥—åŠŸèƒ½æŒ‰ä¸€ä¸ªæµç¨‹æµ‹è¯•ï¼Œå…ˆæ–°å¢å†ä¿®æ”¹ï¼Œæœ€ååˆ é™¤ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605440506,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1003644,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/50/7c/9082fb04.jpg","nickname":"æ—","note":"","ucode":"727C1E5E21E126","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":156561,"discussion_content":"ã€Œé«˜çº§çš„å•å…ƒæµ‹è¯•æ–¹æ³•ã€çš„1ã€2ï¼Œéƒ½æ˜¯å°†ç›¸å…³é€»è¾‘å°è£…èµ·æ¥ï¼Œä½¿ç”¨åŒ¿åç±»è¿›è¡Œmockå§ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580379830,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1698258,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIx7FdRzUuQf4Fopr7DOXEHZyCFfH4GQViaqo7bymf1qaANcOvuEhHyTNwOOUFW7psxEeSQ5k9uXWw/132","nickname":"é˜¿é¡º","note":"","ucode":"36F2AD6F980B11","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":134923,"discussion_content":"beforeEachå’ŒafterEachæ´¾ä¸Šç”¨åœºäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579055372,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":221883,"user_name":"å¼ ä¸‰ä¸°","can_delete":false,"product_type":"c1","uid":1155275,"ip_address":"","ucode":"3A6215A40B3B21","user_header":"https://static001.geekbang.org/account/avatar/00/11/a0/cb/aab3b3e7.jpg","comment_is_top":false,"comment_ctime":1590628368,"is_pvip":false,"replies":[{"id":"87067","content":"è¿™ä¸ªä¸å«é«˜åº¦è€¦åˆå§ã€‚ä¸æ˜¯è¯´è€¦åˆå¾ˆå¤šå°±æ˜¯é«˜åº¦è€¦åˆï¼Œä¹Ÿè¦çœ‹ä¸šåŠ¡éœ€æ±‚å•Šï¼Œç¡®å®è¦è¿™ä¹ˆå¤šæ•°æ®ï¼Œé‚£å¿…ç„¶è¦ä»¥æ¥è¿™ä¹ˆå¤šæœåŠ¡ã€‚è¿˜æœ‰ï¼Œä¸ºäº†å‰ç«¯è·å–æ•°æ®ç®€å•ï¼Œå¯ä»¥ç”¨facadeæ¨¡å¼ï¼ŒåŒ…è£¹ä¸€å±‚æ¥å£ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹äº‰","uid":"1190123","ctime":1595207745,"ip_address":"","comment_id":221883,"utype":1}],"discussion_count":1,"race_medal":0,"score":"83195006992","product_id":100039001,"comment_content":"è€å¸ˆï¼Œä¸‹é¢è¿™å¥è¯ä¸æ˜¯å¾ˆç†è§£ï¼Œå¦‚æœæˆ‘çš„æŸä¸ªæ¥å£å°±æ˜¯éœ€è¦ä¾èµ–å¾ˆå¤šæœåŠ¡æ‰èƒ½æŠŠç»“æœæ­£ç¡®è¿”å›ç»™å‰ç«¯ï¼Œè¿™æ—¶å€™æ€ä¹ˆåŠï¼Ÿæ¯”å¦‚æŸ¥è¯¢è´­ç‰©è½¦ï¼Œéœ€è¦è®¿é—®å•†å“æœåŠ¡çš„å•†å“ä¿¡æ¯ï¼Œä¼˜æƒ æœåŠ¡çš„ä¼˜æƒ ä¿¡æ¯ï¼ŒåŒæ—¶è®¿é—®ä»·æ ¼æœåŠ¡çš„ä»·æ ¼ä¿¡æ¯ç­‰ç­‰ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œé«˜åº¦è€¦åˆæ€ä¹ˆå»é¿å…å‘¢ï¼Ÿ<br><br><br><br>å¦‚æœä¸€ä¸ªç±»èŒè´£å¾ˆé‡ï¼Œéœ€è¦ä¾èµ–åå‡ ä¸ªå¤–éƒ¨å¯¹è±¡æ‰èƒ½å®Œæˆå·¥ä½œï¼Œä»£ç é«˜åº¦è€¦åˆï¼Œé‚£æˆ‘ä»¬åœ¨ç¼–å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œå¯èƒ½éœ€è¦ mock è¿™åå‡ ä¸ªä¾èµ–çš„å¯¹è±¡ã€‚ä¸ç®¡æ˜¯ä»ä»£ç è®¾è®¡çš„è§’åº¦æ¥è¯´ï¼Œè¿˜æ˜¯ä»ç¼–å†™å•å…ƒæµ‹è¯•çš„è§’åº¦æ¥è¯´ï¼Œè¿™éƒ½æ˜¯ä¸åˆç†çš„ã€‚","like_count":20,"discussions":[{"author":{"id":1190123,"avatar":"https://static001.geekbang.org/account/avatar/00/12/28/eb/af064421.jpg","nickname":"ç‹äº‰","note":"","ucode":"2B611BE0E0EDD4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496598,"discussion_content":"è¿™ä¸ªä¸å«é«˜åº¦è€¦åˆå§ã€‚ä¸æ˜¯è¯´è€¦åˆå¾ˆå¤šå°±æ˜¯é«˜åº¦è€¦åˆï¼Œä¹Ÿè¦çœ‹ä¸šåŠ¡éœ€æ±‚å•Šï¼Œç¡®å®è¦è¿™ä¹ˆå¤šæ•°æ®ï¼Œé‚£å¿…ç„¶è¦ä»¥æ¥è¿™ä¹ˆå¤šæœåŠ¡ã€‚è¿˜æœ‰ï¼Œä¸ºäº†å‰ç«¯è·å–æ•°æ®ç®€å•ï¼Œå¯ä»¥ç”¨facadeæ¨¡å¼ï¼ŒåŒ…è£¹ä¸€å±‚æ¥å£ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1595207745,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":169758,"user_name":"æ¡‚åŸè€æ‰˜å°¼","can_delete":false,"product_type":"c1","uid":1306032,"ip_address":"","ucode":"139E4B8EE88B79","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJcxSpNMqwqyicMvdOSr9ic0p1ABiauHnv7g7YQVSJuoHPoQbYDu3YzdpgmSAk2KricUBQ5yibWBWIq75w/132","comment_is_top":false,"comment_ctime":1578441893,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"61707984037","product_id":100039001,"comment_content":"æ„Ÿè°¢äº‰å“¥åˆ†äº«<br>è¯¾åè®¨è®º1.idçš„ç”Ÿæˆé€»è¾‘æœ‰ç‚¹æ²¡çœ‹æ‡‚ï¼Œå•çº¯ä»ä»£ç è¦†ç›–ä¸Šçœ‹ï¼ŒfillTransactionId æœªè¦†ç›–å®Œå…¨ï¼Œéœ€è¦mockä¸‹è¿™ä¸ªé™æ€æ–¹æ³•ï¼Œå½“ç„¶ä¹Ÿæœ‰å…¶ä»–åˆ†æ”¯é€»è¾‘å¯ä»¥è¦†ç›–ã€‚<br>idæ²¡æœ‰åœ¨executeæ–¹æ³•ä¸­ä¸æ˜¯æ ¸å¿ƒå±æ€§(mockæ–¹æ³•çš„å…¥å‚)ï¼Œä¸å½±å“executeçš„å¯æµ‹è¯•æ€§ã€‚ idçš„ç”Ÿæˆç”¨é™æ€æ–¹æ³•çœŸçš„å¥½ä¹ˆï¼Ÿ<br>2.æœ‰è¡Œä¸ºçš„å¯¹è±¡ä¸é€‚åˆåœ¨ç±»ä¸­newï¼Œå°½é‡ä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼Œä¾èµ–æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯å…·ä½“çš„å®ç°ã€‚ æ•°æ®å¯¹è±¡é€‚åˆåœ¨ç±»ä¸­new æ¯”å¦‚å„ç§model do vo info ã€‚<br>ä¸€å®¶ä¹‹è¨€æ¬¢è¿è®¨è®ºæŒ‡æ­£ã€‚","like_count":15,"discussions":[{"author":{"id":1132304,"avatar":"https://static001.geekbang.org/account/avatar/00/11/47/10/2d673601.jpg","nickname":"å¥½é¥¿æ—©çŸ¥é“é€å¤–å–äº†","note":"","ucode":"AED22DB5BF8FC7","race_medal":2,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":167485,"discussion_content":"å°ç™½é—®ä¸ªé—®é¢˜å•Šï¼Œä¸ºä»€ä¹ˆæ•°æ®å¯¹è±¡é€‚åˆåœ¨ç±»ä¸­newå‘¢ã€‚å¦‚æœæµ‹è¯•çš„æ—¶å€™éœ€è¦ç‰¹å®šçš„æ•°æ®ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581501985,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1306032,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJcxSpNMqwqyicMvdOSr9ic0p1ABiauHnv7g7YQVSJuoHPoQbYDu3YzdpgmSAk2KricUBQ5yibWBWIq75w/132","nickname":"æ¡‚åŸè€æ‰˜å°¼","note":"","ucode":"139E4B8EE88B79","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1132304,"avatar":"https://static001.geekbang.org/account/avatar/00/11/47/10/2d673601.jpg","nickname":"å¥½é¥¿æ—©çŸ¥é“é€å¤–å–äº†","note":"","ucode":"AED22DB5BF8FC7","race_medal":2,"user_type":1,"is_pvip":false},"discussion":{"id":168843,"discussion_content":"æˆ‘çš„ç†è§£æ˜¯æ•°æ®å¯¹è±¡å¯¹å¤–æ²¡æœ‰è¡Œä¸ºï¼Œåªæ˜¯ä½œä¸ºæ•°æ®ä¼ è¾“ç”¨é€”ï¼Œä¸ä¼šå¯¹å®ç°äº§ç”Ÿä¾èµ–ã€‚ ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1581596723,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":167485,"ip_address":""},"score":168843,"extra":""}]}]},{"had_liked":false,"id":169917,"user_name":"QQæ€ª","can_delete":false,"product_type":"c1","uid":1211223,"ip_address":"","ucode":"1A39B8433D9208","user_header":"https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg","comment_is_top":false,"comment_ctime":1578472448,"is_pvip":false,"replies":[{"id":"65939","content":"ğŸ˜ æ„Ÿè°¢è®¤å¯ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹äº‰","uid":"1190123","ctime":1578488789,"ip_address":"","comment_id":169917,"utype":1}],"discussion_count":2,"race_medal":0,"score":"53118080000","product_id":100039001,"comment_content":"çœ‹åˆ°ä¸€åŠï¼Œæˆ‘å°±æ¥è¯„è®ºï¼Œè€å¸ˆæ”¶ä¸‹æˆ‘çš„è†ç›–ï¼Œå¤ªå¼ºäº†","like_count":13},{"had_liked":false,"id":183919,"user_name":"Jessica","can_delete":false,"product_type":"c1","uid":1084877,"ip_address":"","ucode":"9FC7E9BD3FE9F1","user_header":"https://static001.geekbang.org/account/avatar/00/10/8d/cd/b6bdc1b2.jpg","comment_is_top":false,"comment_ctime":1583162302,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"40237867966","product_id":100039001,"comment_content":"public class Demo { <br>    public long caculateDelayDays(Date dueTimeï¼Œlong currentTimestamp) { <br>        if (dueTime.getTime() &gt;= currentTimestamp) { <br>            return 0; <br>        } <br>        long delayTime = currentTimestamp - dueTime.getTime(); <br>        long delayDays = delayTime &#47; 86400; return delayDays; <br>    }<br><br>    private long getCurrentTimestamp() {<br>        return System.currentTimeMillis(); <br>    }<br>}<br><br>mockæ‰getCurrentTimestampï¼ˆï¼‰, dueTimeç»™å®šå›ºå®šçš„æ—¶é—´ï¼Œåªæ£€æŸ¥é€»è¾‘æ˜¯å¦ç¬¦åˆé¢„æœŸ","like_count":9,"discussions":[{"author":{"id":1190123,"avatar":"https://static001.geekbang.org/account/avatar/00/12/28/eb/af064421.jpg","nickname":"ç‹äº‰","note":"","ucode":"2B611BE0E0EDD4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473230,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572912393,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1261108,"avatar":"https://static001.geekbang.org/account/avatar/00/13/3e/34/dd0a3c61.jpg","nickname":"çˆ±åƒå½©è™¹ç³–çš„çŒ«~","note":"","ucode":"9EC7A8FD4B7DB1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":43183,"discussion_content":"ç‹äº‰è€å¸ˆåº”è¯¥ä¼šç”¨ä¼ªä»£ç ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572861821,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1623626,"avatar":"https://static001.geekbang.org/account/avatar/00/18/c6/4a/3bd896fc.jpg","nickname":"Heiky","note":"","ucode":"03AA79E1BC4AE4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1261108,"avatar":"https://static001.geekbang.org/account/avatar/00/13/3e/34/dd0a3c61.jpg","nickname":"çˆ±åƒå½©è™¹ç³–çš„çŒ«~","note":"","ucode":"9EC7A8FD4B7DB1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":43235,"discussion_content":"çœ‹ä»‹ç»ï¼Œè¯¾ç¨‹è¯´æ˜æ˜¯ç”¨çš„Javaæ¥è®²æˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572864832,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":43183,"ip_address":""},"score":43235,"extra":""}]}]},{"had_liked":false,"id":173254,"user_name":"å°ä¼Ÿ","can_delete":false,"product_type":"c1","uid":1359701,"ip_address":"","ucode":"124953423491E2","user_header":"https://static001.geekbang.org/account/avatar/00/14/bf/55/198c6104.jpg","comment_is_top":false,"comment_ctime":1579487383,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"35939225751","product_id":100039001,"comment_content":"æ€è€ƒé¢˜ï¼š<br>1. çœ‹IdGeneratoræ€ä¹ˆå®ç°ï¼Œå¦‚æœè¦æŸ¥æ•°æ®åº“æˆ–åˆ†å¸ƒå¼æœåŠ¡ï¼Œé‚£ä¹ˆä¼šæœ‰å½±å“ï¼Œéœ€è¦mockï¼›å¦‚æœæ˜¯æœ¬åœ°ç”Ÿäº§ï¼Œä¸éœ€è¦mockã€‚<br>2. ä¸ªäººè§‚ç‚¹ï¼Œä¸è¦åœ¨æ–¹æ³•é‡Œnewå¯¹è±¡ï¼Œä¾èµ–éƒ½è¦ä»¥æ³¨å…¥çš„æ–¹å¼è·å–ã€‚","like_count":9},{"had_liked":false,"id":169811,"user_name":"Jesse","can_delete":false,"product_type":"c1","uid":1368038,"ip_address":"","ucode":"727CA882B84DA0","user_header":"https://static001.geekbang.org/account/avatar/00/14/df/e6/bd1b3c0b.jpg","comment_is_top":false,"comment_ctime":1578450183,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"35938188551","product_id":100039001,"comment_content":"æ€è€ƒé¢˜1ï¼Œè¯¥æ–¹æ³•äº§ç”Ÿä¸€ä¸ªå”¯ä¸€çš„ID,æˆ‘è®¤ä¸ºä¸éœ€è¦mockã€‚<br>æ€è€ƒé¢˜2ï¼Œæˆ‘è§‰å¾—å¦‚æœå¯¹è±¡æœ‰è¡Œä¸ºï¼Œå¹¶ä¸”è¡Œä¸ºä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’æˆ–è€…æ‰§è¡Œçš„ç»“æœå…·æœ‰ä¸ç¡®å®šæ€§ï¼Œå°±éœ€è¦ä¾èµ–æ³¨å…¥æ¥å®Œæˆæµ‹è¯•ã€‚å¦‚æœå¯¹è±¡çš„è¡Œä¸ºæ˜¯å¯é¢„æµ‹çš„å¹¶ä¸”å”¯ä¸€çš„ï¼Œå¯ä»¥ç›´æ¥newã€‚","like_count":9},{"had_liked":false,"id":169875,"user_name":"é€é¥æ€","can_delete":false,"product_type":"c1","uid":1015512,"ip_address":"","ucode":"340F05C786730F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7e/d8/92a98fb6.jpg","comment_is_top":false,"comment_ctime":1578467085,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27348270861","product_id":100039001,"comment_content":"1. ä¸ä¼šå½±å“å¯æµ‹è¯•æ€§ï¼Œå› ä¸º generateTransactionId å¹¶ä¸éœ€è¦ä¾èµ–ä»€ä¹ˆå¤–éƒ¨æœåŠ¡ï¼Œæ‰€ä»¥ä¹Ÿä¸éœ€è¦ mock<br>2. ä¸æ˜¯ã€‚ä¸ä¾èµ–å¤–éƒ¨æœåŠ¡çš„ç±»å°±å¯ä»¥å†…éƒ¨åˆ›å»ºï¼Œæ¯”å¦‚ String","like_count":6},{"had_liked":false,"id":227552,"user_name":"Vincent.X","can_delete":false,"product_type":"c1","uid":1538604,"ip_address":"","ucode":"8A40B5B2F4B102","user_header":"https://static001.geekbang.org/account/avatar/00/17/7a/2c/54b48459.jpg","comment_is_top":false,"comment_ctime":1592406872,"is_pvip":false,"replies":[{"id":"83993","content":"åªèƒ½@ä¸€ä¸‹ç¼–è¾‘äº†","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹äº‰","uid":"1190123","ctime":1592525525,"ip_address":"","comment_id":227552,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23067243352","product_id":100039001,"comment_content":"æ‰‹æœºçœ‹ä»£ç æœ‰è€æ˜¯è¦æ‹–åŠ¨ï¼Œæœ‰ä»€ä¹ˆè§£å†³çš„åŠæ³•å—ï¼Ÿï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1190123,"avatar":"https://static001.geekbang.org/account/avatar/00/12/28/eb/af064421.jpg","nickname":"ç‹äº‰","note":"","ucode":"2B611BE0E0EDD4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":498681,"discussion_content":"åªèƒ½@ä¸€ä¸‹ç¼–è¾‘äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592525525,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":169938,"user_name":"ä¸‹é›¨å¤©","can_delete":false,"product_type":"c1","uid":1008315,"ip_address":"","ucode":"816B3792ECC50A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/62/bb/323a3133.jpg","comment_is_top":false,"comment_ctime":1578477594,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18758346778","product_id":100039001,"comment_content":"é—®é¢˜å›ç­”ï¼š<br>1. IdGenerator.generateTransactionId()æœ‰æœªå†³è¡Œä¸ºé€»è¾‘ï¼Œä½†ä¸æ˜¯è¯´æœ‰æœªå†³è¡Œä¸ºå°±ä¸€å®šå½±å“å¯æµ‹è¯•æ€§ï¼Œå‰ææ˜¯éœ€è¦çœ‹æœªå†³è¡Œä¸ºæ˜¯å¦æœ‰æµ‹è¯•å¿…è¦æ€§ï¼Œæ­¤å¤„ç”Ÿæˆä¸€ä¸ªéšæœºæ•°(ç±»ä¼¼ System.currentTimeMillis())ï¼Œæµ‹è¯•æ„ä¹‰ä¸å¤§ï¼<br><br>2.è´«è¡€æ¨¡å‹å®ä½“ç±»","like_count":4},{"had_liked":false,"id":169800,"user_name":"ç¾ç¾","can_delete":false,"product_type":"c1","uid":1148422,"ip_address":"","ucode":"44CC95C45AF345","user_header":"https://static001.geekbang.org/account/avatar/00/11/86/06/72b01bb7.jpg","comment_is_top":false,"comment_ctime":1578447997,"is_pvip":false,"replies":[{"id":"65942","content":"å¯ä»¥å€ŸåŠ©springtestæµ‹è¯•æ¡†æ¶æ¥åš","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹äº‰","uid":"1190123","ctime":1578488960,"ip_address":"","comment_id":169800,"utype":1}],"discussion_count":4,"race_medal":0,"score":"18758317181","product_id":100039001,"comment_content":"æœ‰å¤šä¸ªé€šè¿‡springæ³¨å…¥çš„ç±»æ—¶ï¼Œåº”è¯¥æ€ä¹ˆåšæµ‹è¯•å‘¢ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1190123,"avatar":"https://static001.geekbang.org/account/avatar/00/12/28/eb/af064421.jpg","nickname":"ç‹äº‰","note":"","ucode":"2B611BE0E0EDD4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480724,"discussion_content":"å¯ä»¥å€ŸåŠ©springtestæµ‹è¯•æ¡†æ¶æ¥åš","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578488960,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1359701,"avatar":"https://static001.geekbang.org/account/avatar/00/14/bf/55/198c6104.jpg","nickname":"å°ä¼Ÿ","note":"","ucode":"124953423491E2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":143015,"discussion_content":"mockito+jmockitï¼Œmockç•Œçš„super star","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1579487662,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1103189,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d5/55/ce3f814f.jpg","nickname":"è´ç¬‹","note":"","ucode":"2B9650104285AD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":124852,"discussion_content":"ç”¨Mockito","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578453784,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1109844,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ef/54/58a61a50.jpg","nickname":"ë£¡ê±¸ì´","note":"","ucode":"ACC366BD4E7385","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":124810,"discussion_content":"m","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578451577,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":256924,"user_name":"éƒ‘å¤§é’±","can_delete":false,"product_type":"c1","uid":1503067,"ip_address":"","ucode":"114CF48056880E","user_header":"https://static001.geekbang.org/account/avatar/00/16/ef/5b/ff28088f.jpg","comment_is_top":false,"comment_ctime":1603784929,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14488686817","product_id":100039001,"comment_content":"ä½œä¸ºä¸€ä¸ªç å†œï¼ŒèŒè´£æ˜¯åœ¨æœ‰é™æ—¶é—´é‡Œï¼Œå®Œæˆå°½å¯èƒ½å¤šçš„ã€é«˜å¯ç»´æŠ¤æ€§ã€é«˜æ‰©å±•æ€§çš„ã€é«˜å¯é æ€§çš„ä»£ç ã€‚<br>è¿™ä¹ˆå¤šå¥½ä»£ç è¯„åˆ¤æ ‡å‡†é‡Œé¢ï¼Œæˆ‘è®¤ä¸ºå¯é æ€§æ˜¯æœ€ä¸èƒ½å¦¥åçš„ã€‚<br>æ—¶é—´å¯ä»¥å•†é‡ï¼Œä»»åŠ¡å¯ä»¥åˆ†å·¥ï¼Œç»´æŠ¤æ€§å¯ä»¥åŠ ç­æ¥æï¼Œæ‰©å±•æ€§å¯ä»¥åæœŸä¼˜åŒ–ã€‚å”¯æœ‰ä»£ç çš„å¯é æ€§ï¼Œéœ€è¦æ•´ä¸ªä¸šåŠ¡å›¢é˜Ÿæ¥æ‰¿æ‹…å®ƒå¸¦æ¥çš„å½±å“ã€‚<br>éƒ‘å¤§é’±æƒ³æŒ£æ›´å¤šé’±<br>å¯ä»¥å› ä¸ºèƒ½å†™é«˜è´¨é‡çš„ä»£ç è¦åˆ°æ›´é«˜çš„å·¥èµ„<br>å¯ä»¥é€šè¿‡ä¼˜åŒ–ä»£ç çš„å¯é æ€§æ¥æå‡ä»£ç çš„è´¨é‡<br>å¯ä»¥é€šè¿‡å•å…ƒæµ‹è¯•æ¥æå‡ä»£ç çš„å¯é æ€§<br>å•å…ƒæµ‹è¯•è¦†ç›–ç‡ï¼Œæ˜¯ä¸€ä¸ªå¯ä»¥é‡åŒ–çš„æŒ‡æ ‡ï¼Œæ˜¯ä¸€ä¸ªå¯ä»¥é›†ä¸­èµ„æºä¼˜åŒ–çš„ç‚¹ï¼Œæ˜¯ä¸€ä¸ªæŒ£å¤§é’±çš„å¥½æˆ˜ç•¥ã€‚<br>ï¼ˆå¥½çš„æˆ˜ç•¥ = ä¸€ä¸ªæ¸…æ™°çš„ç›®æ ‡ + å¯ä»¥é›†ä¸­èµ„æºä¼˜åŒ–çš„ç‚¹ â€”â€”ã€Šå¥½æˆ˜ç•¥ï¼Œåæˆ˜ç•¥ã€‹ï¼‰","like_count":3,"discussions":[{"author":{"id":2061547,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/74/eb/791d0f5e.jpg","nickname":"æ‹¿äº†æ©˜å­è·‘å“‡","note":"","ucode":"D7A281AE06DDF3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":566465,"discussion_content":"æœ´å®æ— åï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650697229,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":173362,"user_name":"ç›¸é€¢æ˜¯ç¼˜","can_delete":false,"product_type":"c1","uid":1060730,"ip_address":"","ucode":"CB299F53A95654","user_header":"https://static001.geekbang.org/account/avatar/00/10/2f/7a/ab6c811c.jpg","comment_is_top":false,"comment_ctime":1579511091,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14464412979","product_id":100039001,"comment_content":"æ‰“å¡<br>1ã€ä»€ä¹ˆæ˜¯ä»£ç å¯æµ‹è¯•æ€§ï¼š<br>é’ˆå¯¹ä»£ç ç¼–å†™å•å…ƒæµ‹è¯•çš„éš¾æ˜“ç¨‹åº¦ã€‚å¦‚æœç¼–å†™å•å…ƒæµ‹è¯•å¾ˆéš¾ï¼Œæ„å‘³ç€ä»£ç è®¾è®¡ä¸å¤Ÿåˆç†ï¼Œä»£ç çš„å¯æµ‹è¯•æ€§ä¸å¥½ã€‚<br><br>2ã€å¦‚ä½•ç¼–å†™å¯æµ‹è¯•æ€§çš„ä»£ç <br>1ã€é€šè¿‡ä¾èµ–æ³¨å…¥ï¼Œæˆ‘ä»¬åœ¨ç¼–å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ mock çš„æ–¹æ³•è§£ä¾èµ–å¤–éƒ¨æœåŠ¡<br>2ã€ä¾èµ–å¤–éƒ¨å•ä¾‹ï¼šå°†å•ä¾‹å°è£…<br>3ã€æœªå†³è¡Œä¸ºï¼šä¾‹æ—¶é—´ã€éšæœºæ•°ã€‚å°†æœªå†³è¡Œä¸ºé‡æ–°å°è£…ï¼Œæµ‹è¯•æ—¶mockã€‚<br><br>3ã€å¸¸è§çš„æµ‹è¯•ä¸å‹å¥½çš„ä»£ç æœ‰ä¸‹é¢è¿™ 5 ç§ï¼š<br>1ã€ä»£ç ä¸­åŒ…å«æœªå†³è¡Œä¸ºé€»è¾‘<br>2ã€æ»¥ç”¨å¯å˜å…¨å±€å˜é‡<br>3ã€æ»¥ç”¨é™æ€æ–¹æ³•<br>4ã€ä½¿ç”¨å¤æ‚çš„ç»§æ‰¿å…³ç³»<br>5ã€é«˜åº¦è€¦åˆçš„ä»£ç ","like_count":3},{"had_liked":false,"id":173241,"user_name":"è½å¶é£é€çš„æ‹","can_delete":false,"product_type":"c1","uid":1046429,"ip_address":"","ucode":"F9A95DB28BCF1E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f7/9d/be04b331.jpg","comment_is_top":false,"comment_ctime":1579483991,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14464385879","product_id":100039001,"comment_content":"ä¸ä¾èµ–æ¡†æ¶çš„ç±»ï¼Œéƒ½å¯ä»¥æ‰‹åŠ¨newï¼Œæ¯”å¦‚Personå¯¹è±¡ï¼Œå¯ä»¥å†…éƒ¨newï¼Œè€ŒåƒSpringçš„Serviceã€Repositoryã€Controllerè¿™äº›ä¾èµ–æ¡†æ¶çš„ï¼Œéœ€è¦ç”¨åˆ°ä¾èµ–æ³¨å…¥","like_count":3},{"had_liked":false,"id":170342,"user_name":"è¾¾æ–‡è¥¿","can_delete":false,"product_type":"c1","uid":1398824,"ip_address":"","ucode":"01C1063F23D634","user_header":"https://static001.geekbang.org/account/avatar/00/15/58/28/c86340ca.jpg","comment_is_top":false,"comment_ctime":1578574692,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14463476580","product_id":100039001,"comment_content":"å†…å®¹éƒ½æ˜¯å¹²è´§,ä¸å¤Ÿçœ‹å•Š","like_count":3},{"had_liked":false,"id":169853,"user_name":"å¹³é£é€ é›¨","can_delete":false,"product_type":"c1","uid":1014349,"ip_address":"","ucode":"F9EE4704F31E22","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7a/4d/b0228a1a.jpg","comment_is_top":false,"comment_ctime":1578458702,"is_pvip":true,"discussion_count":3,"race_medal":0,"score":"14463360590","product_id":100039001,"comment_content":"&#47;&#47; æŠ½å–äº†å½“å‰æ—¶é—´è·å–çš„é€»è¾‘ï¼Œæ–¹ä¾¿æµ‹è¯•<br>    private long currentTimeMillis;<br>    private Date dueTime;<br>    public Demo(Date dueTime){<br>        this.dueTime = dueTime;<br>        this.currentTimeMillis = getCurrentTimeMillis();<br>    }<br><br>    protected long getCurrentTimeMillis(){<br>        return System.currentTimeMillis();<br>    }<br>    public long caculateDelayDays() {<br>        if(dueTime.getTime() &gt;= currentTimeMillis){<br>            return 0;<br>        }<br>        long delayTime = currentTimeMillis - dueTime.getTime();<br>        long delayDays = delayTime &#47; 86400_000;<br>        return delayDays;<br>    }<br>    @Test<br>    public void testCaculateDelayDays(){<br>        TimeZone timeZone = TimeZone.getTimeZone(&quot;Asia&#47;ShangHai&quot;);<br>        Calendar calendar = Calendar.getInstance(timeZone);<br>        calendar.clear();<br>        calendar.set(2020, Calendar.FEBRUARY,1,0,0,0);<br>        Date dueTime = calendar.getTime();<br>        Demo demo = new DemoClassOne(dueTime);<br>        Assert.assertEquals(demo.caculateDelayDays(), 0);<br>        calendar.clear();<br>        calendar.set(2019, Calendar.DECEMBER, 31, 0,0,0);<br>        dueTime = calendar.getTime();<br>        demo = new DemoClassOne(dueTime);<br>        Assert.assertEquals(demo.caculateDelayDays(), 1);<br>    }<br><br>    public static class DemoClassOne extends Demo {<br>        public DemoClassOne(Date dueTime) {<br>            super(dueTime);<br>        }<br>        @Override<br>        protected long getCurrentTimeMillis() {<br>            TimeZone timeZone = TimeZone.getTimeZone(&quot;Asia&#47;ShangHai&quot;);<br>            Calendar calendar = Calendar.getInstance(timeZone);<br>            calendar.clear();<br>            calendar.set(2020, Calendar.JANUARY,1,0,0,0);<br>            return calendar.getTimeInMillis();<br>        }<br>    }","like_count":3,"discussions":[{"author":{"id":1901146,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK28icgzo9R0rXE5s4nIjdme2VLRLbFtcaiaibaOEEFewnoIgco4sUXhibiabDvRbGN5NOZdcEBvFvytow/132","nickname":"phpCoder","note":"","ucode":"963C378BDBF49B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":261991,"discussion_content":"æˆ‘è§‰å¾—è¿™æ ·æ˜¯ä¸æ˜¯ä¸ºäº†æµ‹è¯•è€Œè®¾è®¡äº† æ„Ÿè§‰æ€ªæ€ªçš„ğŸ¤¨","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1589030972,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1714287,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/28/6f/e430eaaa.jpg","nickname":"å¹³è¡Œçº¿","note":"","ucode":"033F8BA2D1470E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1901146,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK28icgzo9R0rXE5s4nIjdme2VLRLbFtcaiaibaOEEFewnoIgco4sUXhibiabDvRbGN5NOZdcEBvFvytow/132","nickname":"phpCoder","note":"","ucode":"963C378BDBF49B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308635,"discussion_content":"æˆ‘ä¹Ÿæ„Ÿè§‰æ€ªæ€ªçš„ï¼Œåƒæ˜¯è‡ªå·±åœ¨éª—è‡ªå·±ä¸€æ ·ï¼Œ  äº‰å“¥ä¾‹å­ä¸­çš„isExpiredå‡½æ•°ï¼Œä¸ºäº†å•ä¾§ç›´æ¥è¿”å›true, æ€»æ„Ÿè§‰å“ªé‡Œä¸å¯¹å‘¢ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601014608,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":261991,"ip_address":""},"score":308635,"extra":""}]},{"author":{"id":1254656,"avatar":"https://static001.geekbang.org/account/avatar/00/13/25/00/3afbab43.jpg","nickname":"88591","note":"","ucode":"04CE3E46455185","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":206682,"discussion_content":"æˆ‘è§‰å¾—å¯ä»¥ç®€å•ç‚¹ï¼Œç”¨ä¸¤å…¥å‚ï¼ˆä¸¤ä¸ªæ—¶é—´ï¼‰å°±å¯ä»¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584426981,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":271493,"user_name":"Better me","can_delete":false,"product_type":"c1","uid":1261959,"ip_address":"","ucode":"CADF08D357489A","user_header":"https://static001.geekbang.org/account/avatar/00/13/41/87/46d7e1c2.jpg","comment_is_top":false,"comment_ctime":1609665807,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"10199600399","product_id":100039001,"comment_content":"æ€è€ƒé¢˜1ï¼ŒIdGenerator.generateTransactionId()æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œæ ¹æ®è€å¸ˆæ–‡ä¸­æ‰€è¯´çš„ï¼Œå¦‚æœåªæ˜¯ç±»ä¼¼ Math.abs() è¿™æ ·çš„ç®€å•é™æ€æ–¹æ³•ï¼Œå¹¶ä¸ä¼šå½±å“ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Œå› ä¸ºæœ¬èº«å¹¶ä¸éœ€è¦ mockã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦é‰´åˆ«IdGenerator.generateTransactionId()æœ¬èº«æ˜¯å¦æœ‰å…¶ä»–ä¾èµ–ï¼Œå¦‚æœæ˜¯ä¾èµ–å…¶ä»–æœåŠ¡ï¼ˆæ•°æ®åº“ç­‰ï¼‰çš„å…¨å±€å‘å·å™¨åˆ™æœ‰å¿…è¦Mock<br><br>æ€è€ƒé¢˜2ï¼Œä¾èµ–æ³¨å…¥ï¼Œå°±æ˜¯ä¸è¦åœ¨ç±»å†…éƒ¨é€šè¿‡ new çš„æ–¹å¼åˆ›å»ºå¯¹è±¡ï¼Œè€Œæ˜¯è¦é€šè¿‡å¤–éƒ¨åˆ›å»ºå¥½ä¹‹åä¼ é€’ç»™ç±»ä½¿ç”¨ã€‚æ ¹æ®é¢å‘æ¥å£è€Œéå®ç°çš„ç¼–ç¨‹åŸåˆ™ï¼Œå½“æˆ‘ä»¬è¦åšå•å…ƒæµ‹è¯•çš„ç±»ä¾èµ–äº†å¤–éƒ¨æœåŠ¡æ¥å£çš„å…·ä½“å®ç°æ—¶ï¼Œå¯ä»¥ç”±å¤–éƒ¨ä¼ å…¥å®ç°ç±»å¹¶Mockç›¸å…³å‡½æ•°è¿”å›å€¼ã€‚è€Œä¸å…·ä½“è¡Œä¸ºæ— å…³çš„æ•°æ®å¯¹è±¡å¯é€šè¿‡new çš„æ–¹å¼åˆ›å»ºå¯¹è±¡ï¼Œå³è¢«æµ‹è¯•ç±»å‡½æ•°é€»è¾‘å¹¶ä¸æ˜¯å¼ºä¾èµ–å¤–éƒ¨ç±»å®ç°è¿™ç§","like_count":2},{"had_liked":false,"id":183865,"user_name":"zj","can_delete":false,"product_type":"c1","uid":1100064,"ip_address":"","ucode":"E3329CCF694AC2","user_header":"https://static001.geekbang.org/account/avatar/00/10/c9/20/e4f1b17c.jpg","comment_is_top":false,"comment_ctime":1583149524,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10173084116","product_id":100039001,"comment_content":"æ€è€ƒé¢˜1ä¸ä¼šæœ‰å½±å“ï¼Œå› ä¸ºè¿™ä¸ªidåªæ˜¯ä¸€ä¸ªå€¼è€Œå·²ï¼Œå¯¹é€»è¾‘åˆ¤æ–­ï¼Œæµ‹è¯•åœºæ™¯æ²¡æœ‰å½±å“","like_count":2},{"had_liked":false,"id":183207,"user_name":"å°æ–‡åŒå­¦","can_delete":false,"product_type":"c1","uid":1001893,"ip_address":"","ucode":"48F2AEB989C12A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/49/a5/e4c1c2d4.jpg","comment_is_top":false,"comment_ctime":1582972607,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10172907199","product_id":100039001,"comment_content":"å›ç­”ä¸€ä¸‹æé—®2ï¼š<br>æˆ‘è®¤ä¸ºå¯¹è±¡ç”Ÿå‘½å‘¨æœŸéƒ½è¢«ç±»åŒ…å«çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨ç±»å†…éƒ¨é€šè¿‡newæ„å»ºï¼Œè€Œä¸”ä¸å½±å“æµ‹è¯•ã€‚<br><br>è­¬å¦‚ä¸€ä¸ªé›†åˆç±»ï¼Œå†…ç½®äº†ä¸€ä¸ªListï¼Œè¿™ä¸ªListçš„æ´»åŠ¨èŒƒå›´ä»…é™äºè¿™ä¸ªé›†åˆç±»ï¼Œä»»ä½•æ–¹æ³•éƒ½ä¸ä¼šå‘å¸ƒè¿™ä¸ªå¯¹è±¡å‡ºå»ï¼Œé‚£ä¹ˆè¿™Listçš„å¯¹è±¡å¯ä»¥åœ¨é›†åˆåˆå§‹åŒ–çš„æ—¶å€™é€šè¿‡newè¿›è¡Œæ„é€ ã€‚","like_count":2},{"had_liked":false,"id":314234,"user_name":"æ…•è¨€","can_delete":false,"product_type":"c1","uid":2731028,"ip_address":"","ucode":"4918FA682F3895","user_header":"https://static001.geekbang.org/account/avatar/00/29/ac/14/a8ff8fec.jpg","comment_is_top":false,"comment_ctime":1632907972,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5927875268","product_id":100039001,"comment_content":"æˆ‘é’ˆå¯¹æ¡ˆä¾‹ä¸­4ã€5ã€6ä¸‰ä¸ªæµ‹è¯•ç”¨ä¾‹ç¼–å†™çš„æµ‹è¯•ä»£ç ï¼š<br>public class TransactionTest {<br>    @Test<br>    public void testExecute_with_TransactionExecuted() throws InvalidTransactionException {<br>        Transaction t = new Transaction(null, 123L, 234L, 345L, &quot;567&quot;, (double)89) {<br>            @Override<br>            protected boolean isExecuted() {<br>                return true;<br>            }<br>        };<br>        WalletRpcService wallet = new WalletRpcService();<br>        t.setWalletRpcService(wallet);<br>        TransactionLock lock = new TransactionLock();<br>        t.setTransactionLock(lock);<br>        boolean result = t.execute();<br>        Assert.assertTrue(result);<br>    }<br><br>    @Test<br>    public void testExecute_with_TransactionMoveFailed() throws InvalidTransactionException {<br>        Transaction t = new Transaction(null, 123L, 234L, 345L, &quot;567&quot;, (double)89);<br>        WalletRpcService wallet = new WalletRpcService() {<br>            @Override<br>            public String moveMoney(String id, Long buyerId, Long sellerId, Double amount) {<br>                return null;<br>            }<br>        };<br>        t.setWalletRpcService(wallet);<br>        TransactionLock lock = new TransactionLock();<br>        t.setTransactionLock(lock);<br>        boolean result = t.execute();<br>        Assert.assertFalse(result);<br>        Assert.assertEquals(Status.FAILED, t.getStatus());<br>    }<br><br>    @Test<br>    public void testExecute_with_TransactionExecuting() throws InvalidTransactionException {<br>        Transaction t = new Transaction(null, 123L, 234L, 345L, &quot;567&quot;, (double)89);<br>        WalletRpcService wallet = new WalletRpcService();<br>        t.setWalletRpcService(wallet);<br>        TransactionLock lock = new TransactionLock() {<br>            @Override<br>            public boolean lock(String id) {<br>                return false;<br>            }<br>        };<br>        t.setTransactionLock(lock);<br>        boolean result = t.execute();<br>        Assert.assertFalse(result);<br>    }<br>}","like_count":1},{"had_liked":false,"id":270641,"user_name":"JRich","can_delete":false,"product_type":"c1","uid":1114901,"ip_address":"","ucode":"66AE9D61533960","user_header":"https://static001.geekbang.org/account/avatar/00/11/03/15/293a185d.jpg","comment_is_top":false,"comment_ctime":1609203500,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5904170796","product_id":100039001,"comment_content":"å¦‚æœä¾èµ–æ³¨å…¥æ˜¯ç”¨springçš„autowireæ³¨è§£ï¼Œæ²¡æœ‰setteræ–¹æ³•ï¼Œè¯¥æ€ä¹ˆå»ç”¨mockå¯¹è±¡æ›¿æ¢å‘¢","like_count":1,"discussions":[{"author":{"id":1095136,"avatar":"https://static001.geekbang.org/account/avatar/00/10/b5/e0/fc3ac264.jpg","nickname":"stronger.","note":"","ucode":"AD0F2BE338824C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":408808,"discussion_content":"springå»ºè®®é€šè¿‡æ„é€ å™¨æ³¨å…¥ï¼Œè€Œä¸æ˜¯å±æ€§æ³¨å…¥","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1635326562,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2588697,"avatar":"https://static001.geekbang.org/account/avatar/00/27/80/19/ac06db0b.jpg","nickname":"New","note":"","ucode":"406DF65BD05FAA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372893,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620490470,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":184421,"user_name":"xk_","can_delete":false,"product_type":"c1","uid":1514305,"ip_address":"","ucode":"DFE1AC38EA78A7","user_header":"https://static001.geekbang.org/account/avatar/00/17/1b/41/dbb7d785.jpg","comment_is_top":false,"comment_ctime":1583311840,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5878279136","product_id":100039001,"comment_content":"æˆ‘æœ‰ç”¨è¿‡mockæ¡†æ¶ï¼Œä¹Ÿå†™è¿‡å¾ˆå¤šå¤æ‚çš„å•å…ƒæµ‹è¯•ã€‚ç°åœ¨æµ‹è¯•æ¡†æ¶å¥½å¼ºå¤§ï¼Œå„ç§mockï¼Œé™æ€æ–¹æ³•ï¼Œä»£ç ä¸­æ³¨å…¥è‡ªå®šä¹‰å¯¹è±¡â€¦<br>è¯´ä¸€ä¸‹æˆ‘å¯¹æ€è€ƒé¢˜çš„çœ‹æ³•ï¼š<br>1.ç”Ÿæˆidä¸ç”¨è¦†ç›–ï¼Œå› ä¸ºæ²¡æœ‰æµ‹è¯•çš„ç‚¹ã€‚å¦‚æœç¡¬è¦æµ‹è¯•çš„è¯è¦å•ç‹¬æµ‹è¯•è¿™ä¸ªæ–¹æ³•ï¼Œä¸è¿‡è¦å†™ç”Ÿæˆè¿™ä¸ªæ–¹æ³•çš„å•å…ƒæµ‹è¯•å¯èƒ½ä¼šéå¸¸å¤æ‚ã€‚è¶Šç®€å•çš„ï¼ŒåŸºç¡€çš„æ–¹æ³•è¶Šéš¾æµ‹ã€‚<br>2.å¦‚æœæ²¡æœ‰äº‰å“¥è¯´çš„é‚£äº”ç§æƒ…å†µï¼Œå…¶å®åœ¨å“ªé‡Œåˆ›å»ºå¯¹è±¡éƒ½å¥½æµ‹è¯•ï¼Œæœ€éš¾æµ‹çš„äº”ç§æƒ…å†µéƒ½åœ¨æ–‡ç« ä¸­äº†ã€‚","like_count":1},{"had_liked":false,"id":173126,"user_name":"è½å¶é£é€çš„æ‹","can_delete":false,"product_type":"c1","uid":1046429,"ip_address":"","ucode":"F9A95DB28BCF1E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f7/9d/be04b331.jpg","comment_is_top":false,"comment_ctime":1579428727,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5874396023","product_id":100039001,"comment_content":"IdGenerator.generateTransactionId()æœ¬èº«å°±æ˜¯äº§ç”Ÿéšæœºæ•°çš„ï¼Œå¯¹æµ‹è¯•æµç¨‹ä¸å½±å“","like_count":1},{"had_liked":false,"id":171373,"user_name":"Walker Jiang","can_delete":false,"product_type":"c1","uid":1023818,"ip_address":"","ucode":"92AE855D428917","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9f/4a/f5b8c6b3.jpg","comment_is_top":false,"comment_ctime":1578911540,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5873878836","product_id":100039001,"comment_content":"æ”¶è·å¾ˆå¤šï¼Œè¦æ˜¯æ–‡ç« ç»“å°¾æœ‰ä¸ªå®Œæ•´ä»£ç å°±æ›´å¥½äº†ï¼Œä¸ç„¶ç°åœ¨è¿˜å¾—ä¸€ç‚¹ç‚¹å»å¤åˆ¶æ‰èƒ½çœ‹åˆ°å…¨è²Œã€‚","like_count":1},{"had_liked":false,"id":170841,"user_name":"é¥­ç²’","can_delete":false,"product_type":"c1","uid":1153455,"ip_address":"","ucode":"4C3220B0D43997","user_header":"https://static001.geekbang.org/account/avatar/00/11/99/af/d29273e2.jpg","comment_is_top":false,"comment_ctime":1578737956,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5873705252","product_id":100039001,"comment_content":"è¯»å®Œè¿™ç¯‡æ„Ÿè§‰ä¸€ä¸‹å°±è®¤è¯†äº†ä»£ç çš„å¯æµ‹è¯•æ€§ã€‚ä¾èµ–æ³¨å…¥æé«˜ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Œé‚£ spring é‡Œæ¨èä½¿ç”¨ setter æ–¹æ³•å½¢å¼çš„ @autowired æ³¨å…¥ bean æ›´å¥½å“ã€‚<br>ç„¶åæˆ‘è®¤ä¸º IdGenerator.generateTransactionId() ä¸éœ€è¦ mockï¼Œå®ƒçš„åŠŸèƒ½åº”è¯¥å°±æ˜¯ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ idï¼Œå¯¹ Transaction   è€Œè¨€åŠŸèƒ½ç®€å•ï¼Œä¸å½±å“æµ‹è¯•æ€§ï¼Œæœ¬èº«çš„å®ç°é€»è¾‘ä¸åœ¨ Transaction  æµ‹è¯•ã€‚","like_count":1},{"had_liked":false,"id":170533,"user_name":"çŸ³ä»”","can_delete":false,"product_type":"c1","uid":1177921,"ip_address":"","ucode":"974E4604CE2213","user_header":"https://static001.geekbang.org/account/avatar/00/11/f9/41/411b1753.jpg","comment_is_top":false,"comment_ctime":1578627542,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5873594838","product_id":100039001,"comment_content":"ç»§ç»­ä¼˜åŒ–Demo:<br>public class Demo {<br>    private long currentTimestamp;<br>    private long dueTimestamp;<br>    private long delayDays;<br><br>    public Demo(long currentTimestamp, long dueTimestamp) {<br>        this.currentTimestamp = currentTimestamp;<br>        this.dueTimestamp = dueTimestamp;<br>        this.delayDays = (this.currentTimestamp - this.dueTimestamp) &#47; 86400;<br>    }<br><br>    &#47;**<br>     * è®¡ç®—å»¶è¿Ÿå¤©æ•°<br>     *<br>     * @return<br>     *&#47;<br>    public long caculateDelayDays() {<br>        if (!isDelayDays()) {<br>            return 0;<br>        }<br>        return delayDays;<br>    }<br><br>    &#47;**<br>     * æ˜¯å¦å»¶è¿Ÿ<br>     *<br>     * @return<br>     *&#47;<br>    public boolean isDelayDays() {<br>        if (this.delayDays &lt;= 0) {<br>            return false;<br>        }<br>        return true;<br>    }<br>}","like_count":1},{"had_liked":false,"id":169988,"user_name":"å†è§å­™æ‚Ÿç©º","can_delete":false,"product_type":"c1","uid":1025518,"ip_address":"","ucode":"57E12A2F9CD915","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a5/ee/6bbac848.jpg","comment_is_top":false,"comment_ctime":1578489306,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5873456602","product_id":100039001,"comment_content":"ä»Šå¤©è€å¸ˆè®²çš„ä¸ºäº†æ›´å¥½çš„å•å…ƒæµ‹è¯•è€Œè¿›è¡Œçš„é‡æ„ï¼ŒåŸæ¥å·¥ä½œä¸­æ— å½¢é—´å·²ç»ç”¨åˆ°äº†ã€‚åœ¨å¯¹æ¥ä¸‰æ–¹ api æ—¶ï¼Œæœ‰æ—¶å€™ç¼ºå°‘å¿…è¦çš„å‚æ•°ä¿¡æ¯ï¼Œæˆ‘ä»¬åªèƒ½æ¨¡æ‹Ÿè°ƒé€šï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±å†™ä¸€ä¸ªç±»ç»§æ‰¿åŸå§‹ç±»ï¼Œé‡å†™åŸæ–¹æ³•ï¼Œè¿”å›è‡ªå·±éœ€è¦çš„æ•°æ®ï¼Œä¸è¿‡è¿˜æœ‰å¾ˆå¤šåšçš„ä¸è¶³ï¼Œä¾‹å¦‚å¯¹äºä¸ç¡®å®šæ•°æ®çš„mock æ²¡æœ‰æŠ½æˆæ–¹æ³•ç­‰ï¼ŒæŒç»­å­¦ä¹ ï¼Œè€å¸ˆæ£’ï¼","like_count":1},{"had_liked":false,"id":169793,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1578447537,"is_pvip":false,"replies":[{"id":"65943","content":"â€ä»£ç ç»“æ„æ‰å¹³åŒ–çš„æç«¯ç»“æœâ€œèƒ½ä¸¾ä¸ªä¾‹å­å—ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹äº‰","uid":"1190123","ctime":1578489044,"ip_address":"","comment_id":169793,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5873414833","product_id":100039001,"comment_content":"æƒ³åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œä»£ç ç»“æ„æ‰å¹³åŒ–çš„æç«¯ç»“æœå¯èƒ½ä¼šé€ æˆä¾èµ–å¯¹è±¡è¿‡å¤šå—ï¼Ÿè¿™ç§æƒ…å†µmockä¸æ˜¯ä¾ç„¶éš¾æå—","like_count":1,"discussions":[{"author":{"id":1190123,"avatar":"https://static001.geekbang.org/account/avatar/00/12/28/eb/af064421.jpg","nickname":"ç‹äº‰","note":"","ucode":"2B611BE0E0EDD4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480722,"discussion_content":"â€ä»£ç ç»“æ„æ‰å¹³åŒ–çš„æç«¯ç»“æœâ€œèƒ½ä¸¾ä¸ªä¾‹å­å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578489044,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1444122,"avatar":"https://static001.geekbang.org/account/avatar/00/16/09/1a/e0f95684.jpg","nickname":"ç©ºç©º","note":"","ucode":"8F6EFE5A6F6F64","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":173281,"discussion_content":"å¦‚æœæç«¯æ‰å¹³ï¼Œæˆ‘çš„ç†è§£ä¼šå‡ºç°fan-out é—®é¢˜ï¼Œæ‰€ä»¥ç»„åˆå’Œç»§æ‰¿çš„ä½¿ç”¨è¿˜æ˜¯è¦è§†åœºæ™¯è€Œå®š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581843917,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337585,"user_name":"åƒé”¤ç™¾ç‚¼é¢†æ‚Ÿä¹‹æé™","can_delete":false,"product_type":"c1","uid":1744257,"ip_address":"","ucode":"224B5CF2101716","user_header":"https://static001.geekbang.org/account/avatar/00/1a/9d/81/d748b7eb.jpg","comment_is_top":false,"comment_ctime":1646904126,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646904126","product_id":100039001,"comment_content":"é‡æ„ä¹‹åçš„fillTransactionIdå‡½æ•°ï¼Œè¿”å›idä¸æ˜¯æ›´å¥½å—ï¼Œè€Œä¸æ˜¯åœ¨å‡½æ•°å†…éƒ¨èµ‹å€¼ç»™this.id<br><br>ä¾‹å¦‚:<br>  public Transaction(String preAssignedId, Long buyerId, Long sellerId, Long productId, String orderId) {<br>    &#47;&#47;...<br>    this.id = fillTransactionId(preAssignId);<br>    &#47;&#47;...<br>  }<br>  <br>  protected void fillTransactionId(String preAssignedId) {<br>    if (preAssignedId != null &amp;&amp; !preAssignedId.isEmpty()) {<br>      id = preAssignedId;<br>    } else {<br>      id = IdGenerator.generateTransactionId();<br>    }<br>    if (!id.startWith(&quot;t_&quot;)) {<br>      id = &quot;t_&quot; + preAssignedId;<br>    }<br>    return id;<br>  }","like_count":0},{"had_liked":false,"id":330936,"user_name":"ä½ å¥½æ—…è¡Œè€…","can_delete":false,"product_type":"c1","uid":1154101,"ip_address":"","ucode":"5C72A428DC28F3","user_header":"https://static001.geekbang.org/account/avatar/00/11/9c/35/9dc79371.jpg","comment_is_top":false,"comment_ctime":1642312961,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1642312961","product_id":100039001,"comment_content":"å…³äºç¬¬äºŒä¸ªé—®é¢˜ï¼Œè°œåº•å°±åœ¨è°œé¢ä¸Šï¼Œä¸å½±å“ä»£ç å¯æµ‹è¯•æ€§çš„ç±»å°±å¯ä»¥åœ¨ç±»çš„å†…éƒ¨åˆ›å»ºã€‚","like_count":0},{"had_liked":false,"id":324222,"user_name":"å‹","can_delete":false,"product_type":"c1","uid":2536820,"ip_address":"","ucode":"972A4333A8B101","user_header":"https://static001.geekbang.org/account/avatar/00/26/b5/74/cd80b9f4.jpg","comment_is_top":false,"comment_ctime":1638343339,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638343339","product_id":100039001,"comment_content":"å…³äºæµ‹è¯• statusçš„ä»£ç  å¯ä»¥æƒ³ timeä¸€æ ·å¤„ç†ã€‚æµ‹è¯•äº¤æ˜“ä¸­çš„ä»£ç  ç”±äºæˆ‘ç”¨çš„æ˜¯go  æˆ‘ä¼šå¼€ä¸€ä¸ªåç¨‹å»æ¨¡æ‹Ÿ","like_count":0},{"had_liked":false,"id":315307,"user_name":"charmsongo","can_delete":false,"product_type":"c1","uid":1609051,"ip_address":"","ucode":"4FBEE716E93A1A","user_header":"https://static001.geekbang.org/account/avatar/00/18/8d/5b/383a49e4.jpg","comment_is_top":false,"comment_ctime":1633824470,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633824470","product_id":100039001,"comment_content":"å¤–éƒ¨ä¾èµ–æ³¨å…¥å¯ä»¥æé«˜ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Œå°½é‡å°‘ç”¨æœªå†³ä»£ç ã€å…¨å±€å˜é‡ã€é™æ€å˜é‡ã€å¤æ‚çš„é›†æˆã€è€¦åˆåº¦é«˜çš„ä»£ç ","like_count":0},{"had_liked":false,"id":303078,"user_name":"å¸ƒæ‹‰å§†","can_delete":false,"product_type":"c1","uid":1311125,"ip_address":"","ucode":"479FF27D73BCAD","user_header":"https://static001.geekbang.org/account/avatar/00/14/01/95/fd09e8a8.jpg","comment_is_top":false,"comment_ctime":1626579764,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1626579764","product_id":100039001,"comment_content":"ä¸ä¾èµ–å¤–éƒ¨æœåŠ¡çš„ç±»å°±å¯ä»¥å†…éƒ¨åˆ›å»ºï¼Œæ¯”å¦‚ String","like_count":1},{"had_liked":false,"id":297549,"user_name":"æ±Ÿå—ä¸€ç¬‘","can_delete":false,"product_type":"c1","uid":2234620,"ip_address":"","ucode":"E38938A1178827","user_header":"https://static001.geekbang.org/account/avatar/00/22/18/fc/4f92ee4e.jpg","comment_is_top":false,"comment_ctime":1623619037,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1623619037","product_id":100039001,"comment_content":"ä¸€ä¸ªç–‘é—®ï¼šä¿®æ”¹å‰ï¼ŒTransactionçš„è°ƒç”¨è€…ä¸éœ€è¦çŸ¥é“ WalletRpcServiceï¼Œ å°±å¯ä»¥ç›´æ¥è°ƒç”¨Transactionï¼Œæ›´ç¬¦åˆ least knowledge åŸåˆ™ã€‚ç°åœ¨ä¸ºäº†æé«˜å¯æµ‹è¯•æ€§ï¼Œè°ƒç”¨è€…éœ€è¦å…ˆåˆ›å»º WalletRpcService å¯¹è±¡ï¼Œå†é€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼è°ƒç”¨ Transactionå¯¹è±¡ã€‚è¿™æ ·å¯¹ Transactionçš„è°ƒç”¨è€…æ˜¯å¦å‹å¥½ï¼Ÿ","like_count":0},{"had_liked":false,"id":296919,"user_name":"ç¼–å·","can_delete":false,"product_type":"c1","uid":1037836,"ip_address":"","ucode":"1633A363592A1A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d6/0c/df0d5152.jpg","comment_is_top":false,"comment_ctime":1623224706,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1623224706","product_id":100039001,"comment_content":"äº‰å“¥ï¼Œprivate static AtomicInteger position = new AtomicInteger(0)è¿™ç§é™æ€å…¨å±€å˜é‡è¦æ€ä¹ˆæµ‹è¯•å‘¢ï¼Œæˆ–è€…ä»£ç è¦æ€ä¹ˆé‡æ„å•Š","like_count":0},{"had_liked":false,"id":296539,"user_name":"if...else...","can_delete":false,"product_type":"c1","uid":2550743,"ip_address":"","ucode":"D0565908C99695","user_header":"https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg","comment_is_top":false,"comment_ctime":1623034440,"is_pvip":false,"discussion_count":0,"race_medal":4,"score":"1623034440","product_id":100039001,"comment_content":"å¹²è´§","like_count":0},{"had_liked":false,"id":292451,"user_name":"JKwar","can_delete":false,"product_type":"c1","uid":1047466,"ip_address":"","ucode":"B733CA24D5701F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fb/aa/01fedf6c.jpg","comment_is_top":false,"comment_ctime":1620827157,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1620827157","product_id":100039001,"comment_content":"æ€è€ƒé¢˜1ï¼šä¸ä¼šã€‚void fillTransactionId(String preAssignedId) å‡½æ•°æœ¬èº«å°±æ˜¯ä¸€ä¸ªidç”Ÿæˆå™¨ï¼Œå¦‚æœä¼ å…¥çš„idä¸ºç©ºï¼Œå°±é€šè¿‡ IdGenerator.generateTransactionId() ç”Ÿæˆä¸€ä¸ªidã€‚<br>æ€è€ƒé¢˜2ï¼šä¸ä¾èµ–å¤–éƒ¨æœåŠ¡çš„ç±»ï¼Œæä¾›æ–¹æ³•çš„ç±»å¯ä»¥ newï¼Œæ¯”å¦‚è¯´ Service ç±»å°±å¯ä»¥åœ¨å†…éƒ¨åˆ›å»ºå¹¶ä¸”ä¸å½±å“ä»£ç çš„å¯æµ‹è¯•æ€§","like_count":0},{"had_liked":false,"id":289060,"user_name":"åæ‰§","can_delete":false,"product_type":"c1","uid":1304576,"ip_address":"","ucode":"B397172D654C92","user_header":"https://static001.geekbang.org/account/avatar/00/13/e8/00/f94bb1c5.jpg","comment_is_top":false,"comment_ctime":1618836600,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618836600","product_id":100039001,"comment_content":"æœ‰ä¸€ä¸ªç–‘æƒ‘ï¼Œé™æ€æ–¹æ³•mockéš¾åœ¨å“ªé‡Œï¼Ÿ <br>1. Javaé‡ŒPowerMockæä¾›äº†é™æ€æ–¹æ³•çš„mockæ–¹å¼ã€‚<br>2. Pythoné‡Œå¯ä»¥ä½¿ç”¨mock.patch(&#39;your.package.module.Classs.func&#39;)çš„æ–¹å¼mock<br>å¯ä»¥æä¾›ä¸€ä¸ªå®ä¾‹è¯´æ˜staticæ–¹æ³•çš„éš¾å¤„åœ¨å“ªé‡Œå—ï¼Ÿ<br>","like_count":0},{"had_liked":false,"id":288501,"user_name":"JoeyforJoy","can_delete":false,"product_type":"c1","uid":1466467,"ip_address":"","ucode":"5598501E71D35D","user_header":"https://static001.geekbang.org/account/avatar/00/16/60/63/d2c91e2b.jpg","comment_is_top":false,"comment_ctime":1618493728,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618493728","product_id":100039001,"comment_content":"ä¾èµ–æ³¨å…¥æ˜¯æé«˜ä»£ç å¯æµ‹è¯•æ€§çš„æœ‰æ•ˆæ‰‹æ®µã€‚å…·ä½“ä¾‹å­å¯ä»¥å‚è€ƒmockçš„å®ç°","like_count":0},{"had_liked":false,"id":287236,"user_name":"Spoon","can_delete":false,"product_type":"c1","uid":1959822,"ip_address":"","ucode":"2FF9193AD482C2","user_header":"https://static001.geekbang.org/account/avatar/00/1d/e7/8e/318cfde0.jpg","comment_is_top":false,"comment_ctime":1617850812,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617850812","product_id":100039001,"comment_content":"çœŸçš„æ˜¯æ”¶è·æ»¡æ»¡","like_count":0},{"had_liked":false,"id":285872,"user_name":"Geek_86eac6","can_delete":false,"product_type":"c1","uid":1787022,"ip_address":"","ucode":"8C02E398CC6A35","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI4CBQHuLDWOdicOl1elTdSicqMyY1s5JDWXiaHsSk0VSWaVe0U6CTo701ZGz9h6MvibsAGKnvVq7xxFw/132","comment_is_top":false,"comment_ctime":1617061941,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617061941","product_id":100039001,"comment_content":"é¢˜ç›®1ï¼Œè¿™æ®µä»£ç ä¸å½±å“æ•´ä½“é€»è¾‘ï¼Œæ‰€ä»¥ä¸éœ€è¦mock","like_count":0},{"had_liked":false,"id":270989,"user_name":"éš†éš†.ago","can_delete":false,"product_type":"c1","uid":1710528,"ip_address":"","ucode":"9EFE43F0A2C6BB","user_header":"https://static001.geekbang.org/account/avatar/00/1a/19/c0/693b946f.jpg","comment_is_top":false,"comment_ctime":1609340050,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609340050","product_id":100039001,"comment_content":"1. IDç”Ÿæˆå™¨æœ¬èº«å¾ˆç®€å•ï¼Œä¸éœ€è¦mockã€‚æµ‹è¯•fillTransactionIdåŠŸèƒ½å·²ç»å¾ˆç®€å•äº†ï¼Œé€ ä¸€ä¸ªidä¼ è¿›å»æˆ–è€…ä¸€ä¸ªç©ºidä¼ è¿›å»æµ‹è¯•ï¼Œä¸éœ€è¦å†mockç”ŸæˆIDã€‚<br>2. å¾ˆç¡®å®šè€Œç®€å•çš„ï¼Œä¸ä¾èµ–å¤–éƒ¨çš„æœåŠ¡å¯ä»¥newã€‚æä¾›ç‰¹å®šå±æ€§çš„modelè¿™äº›å¯ä»¥newã€‚æ¯”å¦‚å°è£…å„ç§IDçš„ä¸€ä¸ªè´«è¡€æ•°æ®ç±»","like_count":0},{"had_liked":false,"id":266227,"user_name":"çªå›´","can_delete":false,"product_type":"c1","uid":1090414,"ip_address":"","ucode":"03E865CC8A6F2A","user_header":"https://static001.geekbang.org/account/avatar/00/10/a3/6e/52580973.jpg","comment_is_top":false,"comment_ctime":1607246333,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607246333","product_id":100039001,"comment_content":"å•å…ƒæµ‹è¯•å¤ªéš¾æ¨äº†ï¼Œæˆ‘ä»¬å…¬å¸é¡¹ç›®å•æµ‹è¦†ç›–ç‡èƒ½åˆ°è¾¾30%å°±ä¸é”™äº†","like_count":0},{"had_liked":false,"id":265912,"user_name":"ç‹¼è¡Œå¤©ä¸‹","can_delete":false,"product_type":"c1","uid":1053161,"ip_address":"","ucode":"A3F22B276B88B1","user_header":"https://static001.geekbang.org/account/avatar/00/10/11/e9/13f28df2.jpg","comment_is_top":false,"comment_ctime":1607067239,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607067239","product_id":100039001,"comment_content":"æ€è€ƒé¢˜1ï¼šçœ‹è¯¥æ–¹æ³•æ˜¯å¦æœ‰ä¾èµ–å…¶å®ƒç»„ä»¶ï¼Œå¦‚æœæ˜¯æœ¬æœºç”Ÿæˆç®—æ³•ï¼Œå¯ä»¥ä¸ç”¨mockï¼›<br>æ€è€ƒé¢˜2ï¼šmodelå¯¹è±¡å¯ä»¥ä¸ç”¨å¤–éƒ¨ä¼ å…¥ï¼›","like_count":0},{"had_liked":false,"id":254938,"user_name":"erDuo","can_delete":false,"product_type":"c1","uid":1016135,"ip_address":"","ucode":"691E716E6D0E39","user_header":"https://static001.geekbang.org/account/avatar/00/0f/81/47/e5b206d9.jpg","comment_is_top":false,"comment_ctime":1603237897,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603237897","product_id":100039001,"comment_content":"å¤§èµï¼Œé©¬ä¸Šå›å»é‡æ„","like_count":0},{"had_liked":false,"id":250607,"user_name":"ä¸€å°¾","can_delete":false,"product_type":"c1","uid":1517556,"ip_address":"","ucode":"67D404036231D1","user_header":"https://static001.geekbang.org/account/avatar/00/17/27/f4/a1ce6248.jpg","comment_is_top":false,"comment_ctime":1601169921,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601169921","product_id":100039001,"comment_content":"æ„Ÿè°¢ï¼Œè¿™èŠ‚è¯¾éƒ½æ˜¯å¹²è´§","like_count":0},{"had_liked":false,"id":250013,"user_name":"David","can_delete":false,"product_type":"c1","uid":1021825,"ip_address":"","ucode":"22CBBC13FC97A9","user_header":"https://static001.geekbang.org/account/avatar/00/0f/97/81/e1eaf621.jpg","comment_is_top":false,"comment_ctime":1600905491,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1600905491","product_id":100039001,"comment_content":"1. idç”Ÿæˆé€»è¾‘ç®€å• æˆ‘è®¤ä¸ºä¸ç”¨mock<br>2. æ³¨å…¥ä¼˜äºnew","like_count":0},{"had_liked":false,"id":249688,"user_name":"Younger Ku","can_delete":false,"product_type":"c1","uid":1323102,"ip_address":"","ucode":"D157DC38BDB515","user_header":"https://static001.geekbang.org/account/avatar/00/14/30/5e/c42bc33f.jpg","comment_is_top":false,"comment_ctime":1600762086,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1600762086","product_id":100039001,"comment_content":"1ã€IdGenerator.generateTransactionId()åªæ˜¯ä¸€ä¸ªç”Ÿæˆäº¤æ˜“IDçš„é™æ€æ–¹æ³•ï¼Œå¦‚æœéœ€è¦ä¾èµ–å¤–éƒ¨ç³»ç»Ÿæˆ–è€…ä¸å¯æ§ç»„ä»¶å°±éœ€è¦å•ç‹¬mockã€‚å¦‚æœä»…ä»…æ˜¯ç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²åˆ™ä¸éœ€è¦mockã€‚å½“ç„¶ï¼Œå¦‚æœäº¤æ˜“IDæœ‰é¢„è®¾çš„ç”Ÿæˆè§„åˆ™ï¼Œå¯èƒ½ä¹Ÿéœ€è¦å•ç‹¬å¯¹ç”Ÿæˆè§„åˆ™è¿›è¡Œæµ‹è¯•ã€‚<br>2ã€å¦‚æœè¦ç”¨åˆ°çš„ç±»ä¸­çš„æ–¹æ³•ä¸ä¼šäº§ç”Ÿæœªå†³è¡Œä¸ºã€å¹¶ä¸”æ²¡æœ‰ä¾èµ–å¤–éƒ¨ç³»ç»ŸåŠä¸å¯æ§ç»„ä»¶ï¼Œå¯¹å•å…ƒæµ‹è¯•æ²¡æœ‰å½±å“ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥newå‡ºæ¥ã€‚","like_count":0},{"had_liked":false,"id":247316,"user_name":"JerryZhu","can_delete":false,"product_type":"c1","uid":1591223,"ip_address":"","ucode":"76850CD45786C1","user_header":"https://static001.geekbang.org/account/avatar/00/18/47/b7/b30472fd.jpg","comment_is_top":false,"comment_ctime":1599657634,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599657634","product_id":100039001,"comment_content":"çœŸæ˜¯å†™äº†6å¹´çš„ä»£ç ã€‚ã€‚ å¾ˆå°‘å†™å•å…ƒæµ‹è¯•ï¼Œ æƒ­æ„§è‡³æäº†","like_count":1},{"had_liked":false,"id":246758,"user_name":"å®‡å¤©é£","can_delete":false,"product_type":"c1","uid":1126444,"ip_address":"","ucode":"3FB37D1E2DAA61","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/2c/06375913.jpg","comment_is_top":false,"comment_ctime":1599470858,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1599470858","product_id":100039001,"comment_content":"é—®é¢˜1ï¼š<br>1ã€ä¸ä¼šå½±å“ã€‚å‡½æ•°æ¯”è¾ƒç®€å•ï¼Œå¾ˆå¿«è¿”å›ï¼Œä¸ä¼šæœ‰å¤ªå¤šä¾èµ–<br>é—®é¢˜2ï¼š<br>1ã€éä¸šåŠ¡é€»è¾‘ä¸Šçš„å¯¹è±¡å¯ä»¥æ–°å»ºï¼Œä¸å½±å“ä¸šåŠ¡é€»è¾‘èµ°å‘çš„","like_count":0},{"had_liked":false,"id":245616,"user_name":"å¤§é›å°é±¼","can_delete":false,"product_type":"c1","uid":1101017,"ip_address":"","ucode":"44090581E59FDA","user_header":"https://static001.geekbang.org/account/avatar/00/10/cc/d9/20d4f7c2.jpg","comment_is_top":false,"comment_ctime":1599009514,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599009514","product_id":100039001,"comment_content":"æˆ‘ï¼šè¿™æ®µä»£ç ä¸å¤ªå¥½å†™å•å…ƒæµ‹è¯•ä¸å¥½ï¼Œéœ€è¦é‡å†™ã€‚<br>åˆ«äººï¼šä½ æœ‰ç—…å§ï¼Œæ˜¯ä½ è‡ªå·±èƒ½åŠ›ä¸è¡Œï¼Œä¸ä¼šå†™å•å…ƒæµ‹è¯•å§ã€‚<br>æˆ‘ï¼šâ€¦â€¦","like_count":0},{"had_liked":false,"id":244580,"user_name":"è›€ç‰™","can_delete":false,"product_type":"c1","uid":1153349,"ip_address":"","ucode":"F765A67DFEADFD","user_header":"","comment_is_top":false,"comment_ctime":1598585428,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598585428","product_id":100039001,"comment_content":"æ€è€ƒé¢˜1ï¼š æˆ‘è§‰å¾—éœ€è¦é‡å†™ï¼Œå› ä¸ºåœ¨unit testé‡Œä¹Ÿéœ€è¦éªŒè¯idæ˜¯å¦è¢«æ­£ç¡®çš„filläº†ï¼Œä¸€ä¸ªdeterministicçš„id generator ä¼šæ–¹ä¾¿testéªŒè¯","like_count":0},{"had_liked":false,"id":244192,"user_name":"Mew151","can_delete":false,"product_type":"c1","uid":1002201,"ip_address":"","ucode":"D4793F5874F345","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4a/d9/75dd7cf9.jpg","comment_is_top":false,"comment_ctime":1598423602,"is_pvip":false,"replies":[{"id":"90138","content":"ä½ æŒ‡çš„å¤„ç†ä»€ä¹ˆå‘¢ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹äº‰","uid":"1190123","ctime":1598834236,"ip_address":"","comment_id":244192,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1598423602","product_id":100039001,"comment_content":"æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæµ‹è¯•æ–¹æ³•A()ä¸­è°ƒç”¨äº†æœ¬ç±»çš„ç§æœ‰æ–¹æ³•B()ï¼Œè¿™ä¸ªæ—¶å€™è¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1190123,"avatar":"https://static001.geekbang.org/account/avatar/00/12/28/eb/af064421.jpg","nickname":"ç‹äº‰","note":"","ucode":"2B611BE0E0EDD4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":504514,"discussion_content":"ä½ æŒ‡çš„å¤„ç†ä»€ä¹ˆå‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598834236,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":233946,"user_name":"å¯çˆ±çš„é¥²å…»å‘˜","can_delete":false,"product_type":"c1","uid":1160213,"ip_address":"","ucode":"A5B6A4A4110E0C","user_header":"https://static001.geekbang.org/account/avatar/00/11/b4/15/2e6716d7.jpg","comment_is_top":false,"comment_ctime":1594526872,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594526872","product_id":100039001,"comment_content":"æ€è€ƒé¢˜1ï¼šçœ‹IdGenerator.generateTransactionId()çš„ç”Ÿæˆé€»è¾‘ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿé¿å…IDé‡å¤éƒ½ä¼šæŸ¥åº“ï¼Œå¦‚æœè¿™æ ·çš„è¯å°±è¦mockã€‚<br>æ€è€ƒé¢˜2ï¼šå®ç°ä¸šåŠ¡é€»è¾‘çš„è¦æ³¨å…¥ï¼Œåšæ•°æ®è½½ä½“çš„POJOè¦new","like_count":0},{"had_liked":false,"id":232356,"user_name":"å¤§æ–¹æ–¹","can_delete":false,"product_type":"c1","uid":1354013,"ip_address":"","ucode":"621AD8F1485753","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/6cyOoRd2dROgiblAJkW6RLhUyH1wwU0NNibIIuV930eQ9TiaNT41K61kBSVkvYoDYg7mJtuEoCQY1awBmV0WW6BFg/132","comment_is_top":false,"comment_ctime":1593964894,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593964894","product_id":100039001,"comment_content":"è¿™èŠ‚æ˜¯çœŸå¹²è´§ï¼Œ å®Œæ•´çš„æŠŠå‰é¢è®²è¿‡çš„è®¾è®¡æ¨¡å¼å’Œå•å…ƒæµ‹è¯•ç†è®ºåœ¨å®è·µä¸­æ­£å‘æ¿€åŠ±å¾ªç¯å±•ç¤ºå‡ºæ¥äº†ï¼Œè€Œä¸”ç¡®å®å­¦åˆ°äº†å®ç”¨æŠ€å·§ï¼Œèƒ½å¤Ÿåº”ç”¨åˆ°è‡ªå·±çš„ä»£ç é‡æ„ä¸­ï¼Œå¾ˆå®ç”¨ï¼Œè°¢è°¢ã€‚","like_count":0},{"had_liked":false,"id":230650,"user_name":"å…‹å°”è‹åŠ å¾·","can_delete":false,"product_type":"c1","uid":1459388,"ip_address":"","ucode":"E35A6DFA012F37","user_header":"https://static001.geekbang.org/account/avatar/00/16/44/bc/0bb265a7.jpg","comment_is_top":false,"comment_ctime":1593440276,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593440276","product_id":100039001,"comment_content":"å—ç›Šè‰¯å¤š","like_count":0},{"had_liked":false,"id":230599,"user_name":"YsnowLove","can_delete":false,"product_type":"c1","uid":1439301,"ip_address":"","ucode":"70433D98592481","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/rMgAbbKiasa1qR35ht0GEfwsHXbusPZAe9JFgicDgVRy8vQET2hypuDgwtHoPVU23RUoMdK7qA7gibMlTExpYibtbw/132","comment_is_top":false,"comment_ctime":1593426261,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593426261","product_id":100039001,"comment_content":"æ€»æ„Ÿè§‰executeæ–¹æ³•å¹¶å‘çš„æ—¶å€™å‡ºç°å¤šè½¬é’±çš„é—®é¢˜ï¼Œåˆ†å¸ƒå¼é”ï¼Œé”ä½çš„æ˜¯transactionIdï¼Œè€ŒtransactionIdæœ‰å¯èƒ½æ˜¯åœ¨executeæ–¹æ³•ç”Ÿæˆçš„ã€‚","like_count":0},{"had_liked":false,"id":226077,"user_name":"benxiong","can_delete":false,"product_type":"c1","uid":1624574,"ip_address":"","ucode":"F6498059D439D9","user_header":"https://static001.geekbang.org/account/avatar/00/18/c9/fe/874b172b.jpg","comment_is_top":false,"comment_ctime":1591947212,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591947212","product_id":100039001,"comment_content":"public class Demo { <br>    public long caculateDelayDays(Date dueTime) { <br>        long currentTimestamp = System.currentTimeMillis(); <br>        long delayTime = currentTimestamp - dueTime.getTime();<br>        if ( isDelayed(delayTime) ) {<br>            return delayTime &#47; 86400;<br>        } else {<br>            return 0;<br>        }<br>    }<br>    <br>    public boolean isDelayed(long delayTime) {<br>         return delayTime &gt; 0 ? true : false;<br>    }<br>}","like_count":0},{"had_liked":false,"id":225309,"user_name":"èŠ±èŠ±å¤§è„¸çŒ«","can_delete":false,"product_type":"c1","uid":1117318,"ip_address":"","ucode":"8ABDB3F7F4FB0F","user_header":"https://static001.geekbang.org/account/avatar/00/11/0c/86/8e52afb8.jpg","comment_is_top":false,"comment_ctime":1591711704,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1591711704","product_id":100039001,"comment_content":"1.æˆ‘è®¤ä¸ºä¸éœ€è¦ï¼Œå…¶å®å°±æ˜¯ç”Ÿæˆä¸ªIDï¼Œä¸šåŠ¡ä¸ç›¸å…³çš„<br>2.è´«è¡€å‹çš„è‡ªå®šä¹‰java pojoå¯¹è±¡ ","like_count":0},{"had_liked":false,"id":223901,"user_name":"è¿œæ–¹","can_delete":false,"product_type":"c1","uid":1064732,"ip_address":"","ucode":"244C74F9857196","user_header":"https://static001.geekbang.org/account/avatar/00/10/3f/1c/1e4dfbc9.jpg","comment_is_top":false,"comment_ctime":1591228687,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591228687","product_id":100039001,"comment_content":"æ…¢æ…¢å¹²è´§ï¼Œè¿™ä¸ªä¸“æ å®åœ¨æ˜¯å¤ªå€¼äº†","like_count":0},{"had_liked":false,"id":221424,"user_name":"æŠ€æœ¯éª¨å¹²","can_delete":false,"product_type":"c1","uid":1098720,"ip_address":"","ucode":"8FCF8DE6D29201","user_header":"https://static001.geekbang.org/account/avatar/00/10/c3/e0/3db22579.jpg","comment_is_top":false,"comment_ctime":1590497209,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590497209","product_id":100039001,"comment_content":"å¹²æ´»æ»¡æ»¡ï¼Œå­¦ä¸åŠ¨äº†ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­","like_count":0},{"had_liked":false,"id":220987,"user_name":"buggetout","can_delete":false,"product_type":"c1","uid":1880582,"ip_address":"","ucode":"63A948EF415FDD","user_header":"https://static001.geekbang.org/account/avatar/00/1c/b2/06/2086d76d.jpg","comment_is_top":false,"comment_ctime":1590373081,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590373081","product_id":100039001,"comment_content":"è¿™ä¸ªTransactionç±»æ˜¯è´«è¡€æ¨¡å‹å—ï¼Ÿä¾èµ–äº†å¤–éƒ¨çš„service","like_count":0},{"had_liked":false,"id":220090,"user_name":"scmath","can_delete":false,"product_type":"c1","uid":1149022,"ip_address":"","ucode":"641023BB246C29","user_header":"https://static001.geekbang.org/account/avatar/00/11/88/5e/7c76f422.jpg","comment_is_top":false,"comment_ctime":1590152646,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590152646","product_id":100039001,"comment_content":"ä¸åœ¨ç±»å†…éƒ¨å®ä¾‹åŒ–å¤–éƒ¨ä¾èµ–ï¼Œè€Œæ˜¯åœ¨ç±»å¤–éƒ¨åˆ›å»ºå¥½å¯¹è±¡ä¼ å…¥æ„é€ å‡½æ•°æˆ–å‡½æ•°ã€‚<br>golangä¸­æ•°æ®å’Œæ–¹æ³•ä¸å…è®¸åˆ†ç¦»ï¼Œé€šè¿‡æ¥å£å‚æ•°ä¼ å…¥çš„å®ä¾‹åŒ–å¯¹è±¡åªèƒ½ä½¿ç”¨å…¶æ–¹æ³•ä¸èƒ½ç›´æ¥ä½¿ç”¨å¯¹è±¡çš„å®ä½“æ•°æ®ã€‚<br>Javaçš„springç”¨çš„æ˜¯æ•°æ®å’Œæ–¹æ³•åˆ†ç¦»ï¼Œå¼ºä¾èµ–æ•°æ®ï¼Œæ–¹æ³•ä¾èµ–æ¥å£å®ç°å¯æ‰©å±•ã€‚","like_count":0},{"had_liked":false,"id":215256,"user_name":"åˆ˜åŒé’","can_delete":false,"product_type":"c1","uid":1818343,"ip_address":"","ucode":"84B62DF8BC61FB","user_header":"","comment_is_top":false,"comment_ctime":1588942576,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1588942576","product_id":100039001,"comment_content":"ç­”é¢˜<br><br>1.ä¸éœ€è¦ã€‚å¤§å®¶ä¼¼ä¹éƒ½é—æ¼äº†ä¸€ä¸ªå…³é”®ç‚¹ï¼Œå•å…ƒæµ‹è¯•åªå…³æ³¨æ¥å£æˆ–è€…æ–¹æ³•çš„å®šä¹‰ï¼Œä¸è¦å…³æ³¨å®ç°é€»è¾‘ã€‚void fillTransactionId(String preAssignedId) çš„å®šä¹‰æ˜¯å¡«å……ä¸€ä¸ªidï¼Œå¦‚æœpreä¸ä¸ºç©ºåˆ™å¡«å……preï¼Œå¦åˆ™ä¸»åŠ¨ç”Ÿæˆä¸€ä¸ªidæ¥å¡«å……ã€‚æ‰€ä»¥å¯¹äºå®ƒçš„æµ‹è¯•ï¼Œå¹¶ä¸å…³æ³¨å¦‚ä½•ä¸»åŠ¨ç”Ÿæˆï¼Œè€Œæ˜¯å…³æ³¨èƒ½ä¸èƒ½ç”Ÿæˆã€‚è‡³äºç”Ÿæˆçš„å¯¹ä¸å¯¹ï¼Œé‚£æ˜¯è¿™ä¸ªç”Ÿæˆå™¨çš„å•å…ƒæµ‹è¯•åº”è¯¥å…³æ³¨çš„ã€‚<br><br><br>2.å’Œç¬¬ä¸€é¢˜ä¸€æ ·ï¼Œå’Œæ¥å£åŠŸèƒ½å®šä¹‰æ— å…³çš„å¯¹è±¡å¯ä»¥newï¼Œæœ‰å…³çš„é‚£å°±å¯èƒ½æ˜¯æµ‹è¯•ç‚¹äº†","like_count":0,"discussions":[{"author":{"id":1818343,"avatar":"","nickname":"åˆ˜åŒé’","note":"","ucode":"84B62DF8BC61FB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":261148,"discussion_content":"è¡¥å……ä¸€ä¸‹:\n\n1.å¦‚æœidç”Ÿæˆä¾èµ–ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œæ¯”å¦‚æ•°æ®åº“æˆ–è€…rpcï¼Œé‚£éœ€è¦mockï¼Œå¦åˆ™è¿è¡Œä¸äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588942879,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":210869,"user_name":"qpzm7903","can_delete":false,"product_type":"c1","uid":1138683,"ip_address":"","ucode":"C7C14962D34BE7","user_header":"https://static001.geekbang.org/account/avatar/00/11/5f/fb/af061ca7.jpg","comment_is_top":false,"comment_ctime":1587858200,"is_pvip":false,"replies":[{"id":"78763","content":"å•å…ƒæµ‹è¯•è·Ÿè´«ä¸è´«è¡€æ²¡å…³ç³»å§","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹äº‰","uid":"1190123","ctime":1588042521,"ip_address":"","comment_id":210869,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1587858200","product_id":100039001,"comment_content":"è¯·é—®è´«è¡€æ¨¡å¼çš„mvcä¸­çš„serviceæ€ä¹ˆè¿›è¡Œå•å…ƒæµ‹è¯•å‘¢","like_count":0,"discussions":[{"author":{"id":1190123,"avatar":"https://static001.geekbang.org/account/avatar/00/12/28/eb/af064421.jpg","nickname":"ç‹äº‰","note":"","ucode":"2B611BE0E0EDD4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493135,"discussion_content":"å•å…ƒæµ‹è¯•è·Ÿè´«ä¸è´«è¡€æ²¡å…³ç³»å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588042521,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":208525,"user_name":"è¿›å‡»çš„å‰ç«¯er","can_delete":false,"product_type":"c1","uid":1506085,"ip_address":"","ucode":"9229B410F48B85","user_header":"https://static001.geekbang.org/account/avatar/00/16/fb/25/f6743e97.jpg","comment_is_top":false,"comment_ctime":1587375347,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587375347","product_id":100039001,"comment_content":"è¿™èŠ‚æ˜¯çœŸçš„çœ‹çš„çˆ½å•Šï¼ï¼","like_count":0},{"had_liked":false,"id":208390,"user_name":"ä¸‰å¹´è¿‡å","can_delete":false,"product_type":"c1","uid":1283157,"ip_address":"","ucode":"5E9106C5F11BED","user_header":"https://static001.geekbang.org/account/avatar/00/13/94/55/afc64956.jpg","comment_is_top":false,"comment_ctime":1587348848,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587348848","product_id":100039001,"comment_content":"æ€è€ƒé¢˜ï¼š<br>1ã€ID å‘å·å™¨ç¡®ä¿å”¯ä¸€å³å¯ã€‚å¯ä»¥ä¸ç”¨æµ‹è¯•<br>2ã€å……è¡€æ¨¡å‹çš„DDDä¸éœ€è¦ä¾èµ–æ³¨å…¥","like_count":0},{"had_liked":false,"id":207616,"user_name":"lanco","can_delete":false,"product_type":"c1","uid":1188352,"ip_address":"","ucode":"C24A0A8716C78C","user_header":"https://static001.geekbang.org/account/avatar/00/12/22/00/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1587119727,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587119727","product_id":100039001,"comment_content":"å¦‚æœä½ è§‰å¾—è¿™æ®µä»£ç çš„å•å…ƒæµ‹è¯•éå¸¸éš¾å†™ï¼Œé‚£ä½ éœ€è¦è€ƒè™‘ä¸€ä¸‹ä½ çš„ä»£ç äº†","like_count":0},{"had_liked":false,"id":205984,"user_name":"æ”¹åä¸æ¢äºº","can_delete":false,"product_type":"c1","uid":1118242,"ip_address":"","ucode":"7E25577829FA0F","user_header":"https://static001.geekbang.org/account/avatar/00/11/10/22/910f705c.jpg","comment_is_top":false,"comment_ctime":1586767919,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586767919","product_id":100039001,"comment_content":"MVCä¸‰å±‚ç»“æ„ï¼Œä¾èµ–æ•°æ®åº“çš„é‚£ä¸€å±‚ä¹Ÿå¯ä»¥ä½¿ç”¨Mockçš„æ–¹å¼æ¥è¿›è¡Œæµ‹è¯•äº†ï¼Œåè€Œä¹‹å‰ç”¨è¿‡ä¸€ç§é€šè¿‡junité…ç½®æ–‡ä»¶è·å–ä¾èµ–å…³ç³»æ¥å†™å•å…ƒæµ‹è¯•çš„æ–¹å¼å¹¶ä¸å¥½ï¼Œå’Œæ•°æ®åº“ä»¥åŠå…¶ä»–çš„ç»„ä»¶è€¦åˆã€‚æœ‰æ¥å£çš„ä¾èµ–å°±å®ç°æ¥å£ï¼Œæ²¡æœ‰æ¥å£çš„ä¾èµ–ç±»å°±ç»§æ‰¿ã€‚<br>å¹²è´§æ»¡æ»¡ï¼Œå­¦åˆ°äº†å¥½å¤šä¸œè¥¿ã€‚","like_count":0},{"had_liked":false,"id":205226,"user_name":"è‚–è‡§","can_delete":false,"product_type":"c1","uid":1047733,"ip_address":"","ucode":"4FAC9FF54DD6A0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fc/b5/ac717737.jpg","comment_is_top":false,"comment_ctime":1586573554,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1586573554","product_id":100039001,"comment_content":"çœ‹åˆ°å¾ˆå¤šæœ‹å‹æŠŠSystem.currentTimeMillis()å°è£…åœ¨ä¸€ä¸ªæ–¹æ³•é‡Œï¼Œç„¶ååœ¨æµ‹è¯•æ–¹æ³•é‡Œoverrideè¿™ä¸ªæ–¹æ³•ï¼Œè¾“å‡ºè‡ªå·±æƒ³è¦çš„å€¼ã€‚æˆ‘è®¤ä¸ºè¿™ç§æ–¹æ³•å¹¶ä¸å¯å–ï¼ŒcaculateDelayDaysæ–¹æ³•å¯¹currentTimestampæ˜¯å¼ºä¾èµ–ï¼Œæ•´ä¸ªæ–¹æ³•çš„æ­£ç¡®æ€§ï¼Œä¾èµ–äºæ˜¯å¦èƒ½è·å–currentTimestampï¼Œæ‰€ä»¥æˆ‘è®¤ä¸ºåº”è¯¥ä»å…¥å‚ä¸Šä¸‹æ‰‹ï¼Œå…ˆè·å–å½“å‰ç³»ç»Ÿæ—¶é—´ï¼Œç„¶åæŒ‰ç…§æµ‹è¯•éœ€æ±‚ï¼ŒåŠ å‡ä¸€å®šçš„å˜é‡å¾—åˆ°dueTime","like_count":0,"discussions":[{"author":{"id":1047733,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/fc/b5/ac717737.jpg","nickname":"è‚–è‡§","note":"","ucode":"4FAC9FF54DD6A0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295202,"discussion_content":"å½“ç„¶Overrideå¯ä»¥ï¼Œæˆ‘æƒ³è¡¨è¾¾çš„æ˜¯æ€ä¹ˆæ ·åšæ›´å¥½è€Œå·²ï¼Œæ¡æ¡å¤§è·¯é€šç½—é©¬ï¼ŒæŒ‰ä½ å–œæ¬¢çš„æ–¹å¼æ¥ï¼Œå®è·µä¼šæ•™è‚²ä½ æˆ‘ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596117602,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1515149,"avatar":"https://static001.geekbang.org/account/avatar/00/17/1e/8d/5b242931.jpg","nickname":"Fish","note":"","ucode":"C20719F8B0F7C8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295009,"discussion_content":"ä¸å¤ªåŒæ„ã€‚æ„Ÿè§‰override è·å–ç³»ç»Ÿæ—¶é—´æ›´å¥½ã€‚å› ä¸ºè·å–ç³»ç»Ÿæ—¶é—´æœ¬èº«å¾ˆç®€å•ï¼Œæµ‹è¯•ç›®çš„æ˜¯æµ‹è¯•è®¡ç®—delayè¿™ä¸ªé€»è¾‘ã€‚\noverrideè·å–ç³»ç»Ÿæ—¶é—´æ—¶ï¼Œå¯ä»¥åœ¨dueTimeåŸºç¡€ä¸ŠåŠ å‡ï¼Œè¿™æ ·ç»“æœæ˜¯ç¡®å®šçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596069559,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":203148,"user_name":"å²æœˆ","can_delete":false,"product_type":"c1","uid":1337598,"ip_address":"","ucode":"29A2A2BC3C4FE4","user_header":"https://static001.geekbang.org/account/avatar/00/14/68/fe/1353168d.jpg","comment_is_top":false,"comment_ctime":1586144640,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1586144640","product_id":100039001,"comment_content":"åªæœ‰æˆ‘ä¸€ä¸ªäººçœ‹ä¸æ‡‚è¿™æ˜¯ä»€ä¹ˆæ„æ€å˜›ï¼Ÿ<br><br>public void testExecute_with_TransactionIsExpired() {<br>  Long buyerId = 123L;<br>  Long sellerId = 234L;<br>  Long productId = 345L;<br>  Long orderId = 456L;<br>  Transction transaction = new Transaction(null, buyerId, sellerId, productId, orderId) {<br>    protected boolean isExpired() {<br>      return true;<br>    }<br>  };<br>  boolean actualResult = transaction.execute();<br>  assertFalse(actualResult);<br>  assertEquals(STATUS.EXPIRED, transaction.getStatus());<br>}<br><br>åˆ›å»ºä¸€ä¸ªå¯¹è±¡ä¹‹åèƒ½ç›´æ¥é‡å†™æŸä¸ªæ–¹æ³•ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿä¸éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å—ï¼Ÿæˆ‘çœ‹å¾ˆå¤šç¼–ç¨‹è¯­è¨€éƒ½æ²¡è¿™ç§åŠŸèƒ½å§ã€‚ã€‚ã€‚ã€‚","like_count":0,"discussions":[{"author":{"id":1735740,"avatar":"","nickname":"Geek_bb8d16","note":"","ucode":"964BD4DB3D9653","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":225632,"discussion_content":"è¿™ä¸ªæ˜¯åŒ¿åç±»ï¼Œæ¯”è¾ƒç‰¹æ®Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586387749,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":202603,"user_name":"å¢¨é±¼","can_delete":false,"product_type":"c1","uid":1022720,"ip_address":"","ucode":"8FB5E4DCB8A024","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9b/00/654be3f7.jpg","comment_is_top":false,"comment_ctime":1586014162,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586014162","product_id":100039001,"comment_content":"ä»£ç çš„å¯æµ‹è¯•æ€§ï¼šé’ˆå¯¹ä»£ç ç¼–å†™æµ‹è¯•çš„éš¾ä»¥ç¨‹åº¦ã€‚<br><br>ç¼–å†™å¯æµ‹è¯•ä»£ç çš„æ–¹å¼ï¼šä¾èµ–æ³¨å…¥ <br><br>æµ‹è¯•ä¸å‹å¥½çš„ä»£ç ï¼š<br>1.ä»£ç ä¸­åŒ…å«æœªå†³è¡Œä¸ºé€»è¾‘<br>2.æ»¥ç”¨å¯å˜å…¨å±€å˜é‡<br>3.æ»¥ç”¨é™æ€æ–¹æ³•<br>4.å¤æ‚çš„ç»§æ‰¿å…³ç³»<br>5.é«˜åº¦è€¦åˆçš„ä»£ç ","like_count":0},{"had_liked":false,"id":200367,"user_name":"Geek_06c34d","can_delete":false,"product_type":"c1","uid":1593258,"ip_address":"","ucode":"C7910FAECFFE2F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erf1o3QrluWme4LxFCickxtOTkGVQHMBOXo647FvEqwibBa9LfvX8F3EuvibFgE5XXFtpiaGicX73gMHcw/132","comment_is_top":false,"comment_ctime":1585577331,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585577331","product_id":100039001,"comment_content":"éå¸¸æœ‰å¯å‘æ€§çš„æ€è€ƒ","like_count":0},{"had_liked":false,"id":198179,"user_name":"Wizard","can_delete":false,"product_type":"c1","uid":1916084,"ip_address":"","ucode":"EEC2AC00BBED06","user_header":"https://static001.geekbang.org/account/avatar/00/1d/3c/b4/60e20977.jpg","comment_is_top":false,"comment_ctime":1585412753,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585412753","product_id":100039001,"comment_content":"åœ¨ç·¨å¯«å–®å…ƒæ¸¬è©¦çš„éç¨‹ä¸­ï¼Œæœ¬èº«å°±æ˜¯ä¸€å€‹é‡æ§‹çš„éç¨‹ã€‚ç„¡æ³•ç°¡å–®è¢«å–®å…ƒæ¸¬è©¦çš„é¡ï¼Œä¹Ÿä¸€å®šæ˜¯ä¸€å€‹ä¸æ»¿è¶³ï¼³ï¼¯ï¼¬ï¼©ï¼¤ï¼Œé«˜å…§èšï¼Œä½è€¦åˆçš„é¡ã€‚","like_count":0},{"had_liked":false,"id":196852,"user_name":"ç§‹é£ç”»æ‰‡","can_delete":false,"product_type":"c1","uid":1132356,"ip_address":"","ucode":"5BCBC1422C51EC","user_header":"https://static001.geekbang.org/account/avatar/00/11/47/44/964aa665.jpg","comment_is_top":false,"comment_ctime":1585318463,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585318463","product_id":100039001,"comment_content":"å­¦åˆ°äº†ï¼Œå¹²æ´»æ»¡æ»¡~ä»¥å‰æƒ³è‡ªå·±ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼Œæœ€åå› ä¸ºéš¾æµ‹è¯•æ”¾å¼ƒäº†ï¼Œçœ‹äº†ä»Šå¤©çš„è¯¾ç¨‹è±ç„¶å¼€æœ—","like_count":0},{"had_liked":false,"id":189833,"user_name":"å¼ ä¸‰","can_delete":false,"product_type":"c1","uid":1004092,"ip_address":"","ucode":"1155528FAE1546","user_header":"https://static001.geekbang.org/account/avatar/00/0f/52/3c/d6fcb93a.jpg","comment_is_top":false,"comment_ctime":1584574523,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584574523","product_id":100039001,"comment_content":"å®æˆ˜çš„ä¾‹å­å¤ªç²¾å½©äº†","like_count":1},{"had_liked":false,"id":186678,"user_name":"è‡ªå¤æ©˜çŒ«å‡ºèƒ–å­","can_delete":false,"product_type":"c1","uid":1344134,"ip_address":"","ucode":"C76F80D8C008B4","user_header":"https://static001.geekbang.org/account/avatar/00/14/82/86/712c1067.jpg","comment_is_top":false,"comment_ctime":1583900336,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583900336","product_id":100039001,"comment_content":"1.å¦‚æœidæ²¡æœ‰ä¸šåŠ¡é€»è¾‘ï¼Œä¸”ç”Ÿæˆidè€—æ—¶ä¸é•¿ã€‚å¯ä»¥ä¸mockã€‚å¦‚æœidç”Ÿæˆä¾èµ–äº†å¤–éƒ¨æœåŠ¡æˆ–æ•°æ®åº“ï¼Œåˆ™éœ€è¦mock<br>2.ä»€ä¹ˆæ ·çš„å¯¹è±¡ä¸èƒ½newï¼Œä»€ä¹ˆæ ·çš„èƒ½newã€‚è¾¹ç•Œå¤–çš„å¯¹è±¡éœ€è¦æ³¨å…¥ï¼Œæ–¹ä¾¿æµ‹è¯•ã€‚è¾¹ç•Œå†…çš„æ˜¯å¦å°±å¯ä»¥newï¼Ÿå¦‚æœå¸¦æœ‰è¡Œä¸ºçš„å¯¹è±¡éƒ½åšæˆå•ä¾‹serviceæ³¨å…¥ï¼Œé‚£dddå’Œå……è¡€æ¨¡å‹åº”è¯¥å¦‚ä½•è®¾è®¡å‘¢ï¼Ÿå¸Œæœ›æ¥ä¸‹æ¥çš„å­¦ä¹ å¯ä»¥è§£å†³æˆ‘çš„å›°æƒ‘ã€‚","like_count":0,"discussions":[{"author":{"id":1042354,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/e7/b2/334bc992.jpg","nickname":"AlfredLover","note":"","ucode":"A3A998F362CC37","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":219588,"discussion_content":"è¿™å®¶å…¬å¸ç°åœ¨è·‘è·¯äº†å—","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1585787058,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1862936,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/6d/18/e05f72ee.jpg","nickname":"å†°åŸçš„è‹è“æ˜Ÿ","note":"","ucode":"84120EC31A63AF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":254068,"discussion_content":"çœ‹å®Œä½œè€…å‰ä¸¤ç¯‡ï¼Œæˆ‘è¿ä½ è¯´çš„dpæ˜¯å•¥éƒ½æ²¡çŸ¥é“","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1588293542,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1023885,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/9f/8d/d725d32c.jpg","nickname":"æå¾·æ”¿","note":"","ucode":"3AC49F5671485C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1862936,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/6d/18/e05f72ee.jpg","nickname":"å†°åŸçš„è‹è“æ˜Ÿ","note":"","ucode":"84120EC31A63AF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":267523,"discussion_content":"Design patternï¼Ÿ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1589643060,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":254068,"ip_address":""},"score":267523,"extra":""},{"author":{"id":1547667,"avatar":"https://static001.geekbang.org/account/avatar/00/17/9d/93/4159edaa.jpg","nickname":"æœ´ç´ æŸ æª¬c","note":"","ucode":"2D4CBB70D801B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1023885,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/9f/8d/d725d32c.jpg","nickname":"æå¾·æ”¿","note":"","ucode":"3AC49F5671485C","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":324637,"discussion_content":"è¿™ä¸ªDPç¼©å†™ ç®€ç›´äº†","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1605146738,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":267523,"ip_address":""},"score":324637,"extra":""}]},{"author":{"id":2555790,"avatar":"https://static001.geekbang.org/account/avatar/00/26/ff/8e/b16d75c6.jpg","nickname":"Yuki","note":"","ucode":"936E2C34F16B72","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368605,"discussion_content":"è¿˜ä»¥ä¸ºæ˜¯dpç®—æ³•ã€‚ã€‚ã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1618758332,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1015483,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7e/bb/947c329a.jpg","nickname":"ç¨‹åºå‘˜å°è·ƒ","note":"","ucode":"25BB96E0791A60","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":51001,"discussion_content":"æ‰€ä»¥å®æˆ˜æ‰æ˜¯å¯¹ä»£ç çš„å°Šé‡ï¼Œè®¾è®¡æ¨¡å¼åœ¨å®æˆ˜ä¸­æç°ï¼ŒçœŸçš„æ˜¯å¤ªæ£’äº†ã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1573798034,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1547667,"avatar":"https://static001.geekbang.org/account/avatar/00/17/9d/93/4159edaa.jpg","nickname":"æœ´ç´ æŸ æª¬c","note":"","ucode":"2D4CBB70D801B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1015483,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7e/bb/947c329a.jpg","nickname":"ç¨‹åºå‘˜å°è·ƒ","note":"","ucode":"25BB96E0791A60","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":324638,"discussion_content":"ä¸å†™ä»£ç å“é€¼é€¼çš„ç¨‹åºå‘˜éƒ½æ˜¯åºŸç‰©","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605146763,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":51001,"ip_address":""},"score":324638,"extra":""}]},{"author":{"id":1182984,"avatar":"https://static001.geekbang.org/account/avatar/00/12/0d/08/2f825f69.jpg","nickname":"ä¸æº(156*****518)","note":"","ucode":"BDBB8B7D0745FC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":46407,"discussion_content":"æœŸå¾…ä½œè€…ç»™å‡ºä¸€äº›å¤Ÿå‘³çš„è®¾è®¡èŒƒä¾‹","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1573167378,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1661704,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","nickname":"ä¸ä¸å†é™©è®°","note":"","ucode":"A43829E454C067","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1182984,"avatar":"https://static001.geekbang.org/account/avatar/00/12/0d/08/2f825f69.jpg","nickname":"ä¸æº(156*****518)","note":"","ucode":"BDBB8B7D0745FC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":46427,"discussion_content":"me 2","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1573170127,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":46407,"ip_address":""},"score":46427,"extra":""}]},{"author":{"id":1243370,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f8/ea/98738420.jpg","nickname":"Jaswine","note":"","ucode":"EE39D9629204DB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":44966,"discussion_content":"è§„åˆ™å¼•æ“ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1572996393,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2848276,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIRrgrGQYmic2V6bkmbtfXXrsjk3boxpt8KyBuQvazSVHpvtzzvdT4p192jdG5JgIN1nPVziav8Auew/132","nickname":"Geek_38d160","note":"","ucode":"AE3588D61FBB6D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536815,"discussion_content":"è¿˜ä»¥ä¸ºå‡ºbugäº†ï¼Œæ€ä¹ˆæŠŠç®—æ³•é‚£è¾¹çš„è¯„è®ºå¸¦è¿‡æ¥äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1638874556,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1024294,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","nickname":"null","note":"","ucode":"F9039EFED6B55D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":45096,"discussion_content":"å¥½å·§ï¼Œæˆ‘ä¹Ÿé‡æ„è¿‡ç±»ä¼¼é¡¹ç›®ï¼Œç”¨æˆ·åŒ¹é…è§„åˆ™ï¼Œå¥–åŠ±ä¸‹å‘å†…å®¹ï¼Œé€šçŸ¥æœºåˆ¶ï¼Œéƒ½æŠ½è±¡å‡ºæ¥ï¼Œåªç•™ä¸‹å‡ ä¸ªä¸å¯å˜çš„é€»è¾‘ä»£ç ç±»ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1573003789,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2044957,"avatar":"","nickname":"coc","note":"","ucode":"64FC186B1055B7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578648,"discussion_content":"ç°åœ¨åº”è¯¥æ˜¯è·‘è·¯äº†ï¼Œå…¨å›½çš„P2På·²ç»æ¸…ç©ºäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656922894,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1045577,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f4/49/2add4f6b.jpg","nickname":"åŒ—æçš„å¤§ä¼é¹…","note":"","ucode":"8935346D08E109","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":354294,"discussion_content":"dp\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615269686,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1441810,"avatar":"https://static001.geekbang.org/account/avatar/00/16/00/12/7048984b.jpg","nickname":"Krystal","note":"","ucode":"A8986403DE927C","race_medal":3,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":297703,"discussion_content":"æˆ‘ä»¥ä¸ºæ˜¯æ·±åº¦ä¼˜å…ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597027718,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":2056201,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/60/09/a8e7913b.jpg","nickname":"SandCarving","note":"","ucode":"6B97DB71613A46","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1441810,"avatar":"https://static001.geekbang.org/account/avatar/00/16/00/12/7048984b.jpg","nickname":"Krystal","note":"","ucode":"A8986403DE927C","race_medal":3,"user_type":1,"is_pvip":true},"discussion":{"id":340692,"discussion_content":"æ·±åº¦ä¼˜å…ˆæ˜¯dfå§ï¼Œåº”è¯¥æ˜¯åŠ¨æ€è§„åˆ’ğŸ†—","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1610099134,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":297703,"ip_address":""},"score":340692,"extra":""},{"author":{"id":1194060,"avatar":"https://static001.geekbang.org/account/avatar/00/12/38/4c/5426e2e0.jpg","nickname":"CJJ","note":"","ucode":"7E02A6A8547559","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":2056201,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/60/09/a8e7913b.jpg","nickname":"SandCarving","note":"","ucode":"6B97DB71613A46","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":345780,"discussion_content":"è¿™é‡Œçš„dpæ˜¯æŒ‡è®¾è®¡æ¨¡å¼å§å“ˆå“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611794467,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":340692,"ip_address":""},"score":345780,"extra":""},{"author":{"id":2446982,"avatar":"https://static001.geekbang.org/account/avatar/00/25/56/86/db4c0d1c.jpg","nickname":"ljx","note":"","ucode":"6133FC98C44498","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1441810,"avatar":"https://static001.geekbang.org/account/avatar/00/16/00/12/7048984b.jpg","nickname":"Krystal","note":"","ucode":"A8986403DE927C","race_medal":3,"user_type":1,"is_pvip":true},"discussion":{"id":350103,"discussion_content":"éš¾é“ä¸æ˜¯åŠ¨æ€è§„åˆ’å—ğŸ˜‚ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613709214,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":297703,"ip_address":""},"score":350103,"extra":""}]},{"author":{"id":1055624,"avatar":"https://static001.geekbang.org/account/avatar/00/10/1b/88/ac69f57a.jpg","nickname":"ç£‰ç›˜","note":"","ucode":"1C245991F30A73","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":47658,"discussion_content":"ä½œä¸šéƒ¨åˆ†æ€ä¹ˆä½“ç°å‡ºè®¾è®¡æ¨¡å¼çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573386949,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1736485,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/7f/25/f6c3a5d8.jpg","nickname":"ç¬¦æ˜æ˜","note":"","ucode":"44028EA9967627","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":45910,"discussion_content":"1. æˆ‘ä¸ä¼šå†™å¤§å‹ç¨‹åºã€‚2. æ²¡æœ‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573097124,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1566477,"avatar":"https://static001.geekbang.org/account/avatar/00/17/e7/0d/506bd8d1.jpg","nickname":"èˆèˆä¸æ˜¯è›è›","note":"","ucode":"ADE5747408081A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1736485,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/7f/25/f6c3a5d8.jpg","nickname":"ç¬¦æ˜æ˜","note":"","ucode":"44028EA9967627","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":300793,"discussion_content":"ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1598264937,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":45910,"ip_address":""},"score":300793,"extra":""}]},{"author":{"id":1134861,"avatar":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","nickname":"James","note":"","ucode":"48B0F2A334D1C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":45417,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573036653,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1577856,"avatar":"https://static001.geekbang.org/account/avatar/00/18/13/80/2c9da1b1.jpg","nickname":"LğŸš²ğŸ±","note":"","ucode":"08A012739614DE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":43424,"discussion_content":"è®¾è®¡æ¨¡å¼å’Œç®—æ³•æ•°æ®ç»“æ„ä¸€æ ·é‡è¦ï¼Œåªç”¨è¿‡å•ä¾‹å’Œå·¥å‚æ¨¡å¼ï¼Œ åœ¨äº‰å“¥çš„å¸¦é¢†ä¸‹å¥½å¥½å­¦ä¹ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572873904,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1661704,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","nickname":"ä¸ä¸å†é™©è®°","note":"","ucode":"A43829E454C067","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1577856,"avatar":"https://static001.geekbang.org/account/avatar/00/18/13/80/2c9da1b1.jpg","nickname":"LğŸš²ğŸ±","note":"","ucode":"08A012739614DE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":43430,"discussion_content":"ä¸€èµ·åŠ æ²¹","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1572874129,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":43424,"ip_address":""},"score":43430,"extra":""},{"author":{"id":1577856,"avatar":"https://static001.geekbang.org/account/avatar/00/18/13/80/2c9da1b1.jpg","nickname":"LğŸš²ğŸ±","note":"","ucode":"08A012739614DE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1661704,"avatar":"https://static001.geekbang.org/account/avatar/00/19/5b/08/b0b0db05.jpg","nickname":"ä¸ä¸å†é™©è®°","note":"","ucode":"A43829E454C067","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":50054,"discussion_content":"å—¯å—¯ ä¸€èµ·åŠ æ²¹","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1573658993,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":43430,"ip_address":""},"score":50054,"extra":""}]}]},{"had_liked":false,"id":185057,"user_name":"batman","can_delete":false,"product_type":"c1","uid":1266482,"ip_address":"","ucode":"73C30ACFC0D612","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/IIkdC2gohpcibib0AJvSdnJQefAuQYGlLySQOticThpF7Ck9WuDUQLJlgZ7ic13LIFnGBXXbMsSP3nZsbibBN98ZjGA/132","comment_is_top":false,"comment_ctime":1583474148,"is_pvip":true,"discussion_count":1,"race_medal":1,"score":"1583474148","product_id":100039001,"comment_content":"createTimestampï¼Œæ˜¯åœ¨æ„é€ å‡½æ•°åˆå§‹åŒ–çš„å½“å‰ç³»ç»Ÿæ—¶é—´ï¼Œ<br>executionInvokedTimestampï¼Œæ˜¯åœ¨executeæ‰§è¡Œçš„æ—¶å€™åˆå§‹åŒ–çš„ç³»ç»Ÿæ—¶é—´<br>æ€ä¹ˆå¯èƒ½ä¼šå­˜åœ¨14å¤©è¿‡æœŸçš„æƒ…å†µã€‚<br><br>ä»£ç é€»è¾‘æœ‰é—®é¢˜ï¼Œè¿˜æ˜¯æˆ‘æ²¡çœ‹æ‡‚ä»£ç ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":2226367,"avatar":"https://static001.geekbang.org/account/avatar/00/21/f8/bf/59f2e600.jpg","nickname":"æœˆæ˜é£æ¸…","note":"","ucode":"65A97CF2E320FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575895,"discussion_content":"ç¬‘æ­»æˆ‘äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655175187,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3015503,"avatar":"","nickname":"Geek_08a0f7","note":"","ucode":"C2D78F6B714B88","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573993,"discussion_content":"äººæ‰ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653788860,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2820671,"avatar":"","nickname":"require","note":"","ucode":"3AA3DCE0CD73E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542072,"discussion_content":"æœ‰ç”»é¢æ„Ÿäº†\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640658560,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1103353,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d5/f9/1f9a2c3c.jpg","nickname":"ç£¨ç –åšé•œ","note":"","ucode":"D8B8196AE1ED98","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":249498,"discussion_content":"æ˜¯å•Šï¼Œæ¥çš„æ—©åƒè‚‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587944678,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":184915,"user_name":"batman","can_delete":false,"product_type":"c1","uid":1266482,"ip_address":"","ucode":"73C30ACFC0D612","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/IIkdC2gohpcibib0AJvSdnJQefAuQYGlLySQOticThpF7Ck9WuDUQLJlgZ7ic13LIFnGBXXbMsSP3nZsbibBN98ZjGA/132","comment_is_top":false,"comment_ctime":1583452208,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1583452208","product_id":100039001,"comment_content":"this.status = STATUS.TO_BE_EXECUTD;<br>åˆå§‹åŒ–å¯¹è±¡çš„æ—¶å€™å·²ç»èµ‹å€¼äº† ï¼Œè€Œä»£ç çš„35ï¼Œ42è¡Œçš„æ£€æŸ¥ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè¢«æ‰§è¡Œï¼Ÿ<br><br>å¸Œæœ›è€å¸ˆèƒ½è¯´æ˜ä¸‹å“ˆ","like_count":0},{"had_liked":false,"id":182815,"user_name":"Heaven","can_delete":false,"product_type":"c1","uid":1694207,"ip_address":"","ucode":"FA33FBCC66C911","user_header":"https://static001.geekbang.org/account/avatar/00/19/d9/ff/b23018a6.jpg","comment_is_top":false,"comment_ctime":1582870009,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582870009","product_id":100039001,"comment_content":"1.ä»å¯æµ‹è¯•æ€§æ¥è¯´,è¿™ä¸ªæ–¹æ³•åªæ˜¯ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆidçš„æ–¹æ³•,å¯¹äºå¯æµ‹è¯•æ€§æ¥è¯´,å¹¶ä¸å½±å“,ä½†æ˜¯ä»å®é™…ç”Ÿäº§çš„è§’åº¦æ¥è¯´,è¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªå…¨å±€çš„è‡ªå¢idæ–¹æ³•,å¤šæ¬¡æµ‹è¯•å¯èƒ½ä¼šå‡ºç°æŸäº›ä¸å¯é¢„æ–™çš„é—®é¢˜,ä½†æ˜¯ä¹Ÿå¯ä»¥å› æ­¤å‘ç°æŸäº›é—®é¢˜,æˆ‘ä¸å»ºè®®é‡å†™,å½“ç„¶é‡å†™ä¹Ÿè¡Œ,å°±æ˜¯é€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼è¿›è¡Œä½¿ç”¨,ç„¶åæ³¨å…¥æˆ‘ä»¬è‡ªå·±ç¼–çš„mock<br>2.å¯¹äºç¬¬äºŒä¸ªé—®é¢˜,åœ¨å¸¸è§çš„mvcä¸‰å±‚æ¡†æ¶ä¸­,ä¸Šå±‚ä»£ç ä¼šç”Ÿæˆä¸‹å±‚ä»£ç ,ä¾›å…¶ä½¿ç”¨,è¿™å°±æ˜¯ç±»å†…éƒ¨newçš„æ–¹å¼åˆ›å»ºçš„","like_count":0},{"had_liked":false,"id":178478,"user_name":"aoe","can_delete":false,"product_type":"c1","uid":1121758,"ip_address":"","ucode":"1C6201EDB4E954","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","comment_is_top":false,"comment_ctime":1581697166,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1581697166","product_id":100039001,"comment_content":"private æ–¹æ³•åœ¨Javaè¿›è¡Œå•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡åå°„è·å–","like_count":0,"discussions":[{"author":{"id":2356993,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/KMVyjF3bDDa7oot4QVWiaiaicMho9JtZ2E8nWqK8562B6HEicOwyfmAGwocLsvTMMnqWqEob5BrlI0OJpTvLMx7U5Q/132","nickname":"Geek_c7292f","note":"","ucode":"BB6F9413C0A0D0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335096,"discussion_content":"çœ‹æ¥ä½ çš„ç¼–ç çƒ­æƒ…éå¸¸é«˜ï¼Œæˆ‘æ¬£èµä½ ","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1608090975,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2882086,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/fa/26/a38f4b5d.jpg","nickname":"jl","note":"","ucode":"3EC1591B396600","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543334,"discussion_content":"æˆ‘ä¹Ÿæƒ³è·å¾—è¿™ç§å¿«ä¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641093908,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1122533,"avatar":"https://static001.geekbang.org/account/avatar/00/11/20/e5/f66d6144.jpg","nickname":"ä¹å…ˆç”Ÿ","note":"","ucode":"A63A333299D485","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385678,"discussion_content":"å½“å¹´æˆ‘ä¹Ÿæ˜¯è¿™æ ·ï¼Œå“ˆå“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627203732,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1363834,"avatar":"https://static001.geekbang.org/account/avatar/00/14/cf/7a/51951b07.jpg","nickname":"å¾®ç¬‘","note":"","ucode":"6E8E2964D0191F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":51681,"discussion_content":"å“ˆå“ˆ  æ„Ÿè§‰å•ä¾‹  ç›´æ¥ç”¨æ³¨è§£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573914926,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1593289,"avatar":"https://static001.geekbang.org/account/avatar/00/18/4f/c9/9f51fd27.jpg","nickname":"ç¼–ç¨‹ç•Œçš„å°å­¦ç”Ÿ","note":"","ucode":"4A5BE9A5E877FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1363834,"avatar":"https://static001.geekbang.org/account/avatar/00/14/cf/7a/51951b07.jpg","nickname":"å¾®ç¬‘","note":"","ucode":"6E8E2964D0191F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":51704,"discussion_content":"è¢«springç®¡ç†çš„å¯ä»¥ç›´æ¥ä¸€ä¸ªæ³¨è§£ï¼Œä¸è¢«springç®¡ç†çš„å°±éœ€è¦æ‰‹åŠ¨å†™äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573916381,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":51681,"ip_address":""},"score":51704,"extra":""}]}]},{"had_liked":false,"id":178088,"user_name":"å°å…µ","can_delete":false,"product_type":"c1","uid":1261674,"ip_address":"","ucode":"AA3BA727C25179","user_header":"https://static001.geekbang.org/account/avatar/00/13/40/6a/ab1cf396.jpg","comment_is_top":false,"comment_ctime":1581584528,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581584528","product_id":100039001,"comment_content":"4,5,6çš„æµ‹è¯•éƒ½å¯ä»¥é€šè¿‡æ‰§è¡Œä¸¤æ¬¡executeæ–¹æ³•æ¥å®ç°ï¼Œç¬¬ä¸€éæ”¹å˜çŠ¶æ€ï¼Œç¬¬äºŒéçœŸæ­£çš„æµ‹è¯•ã€‚<br>å¦å¤–ä¸€ä¸ªæ„Ÿå—ï¼Œå¦‚æœæ˜¯ç”±äºä¾èµ–å…³ç³»å¯¼è‡´çš„éš¾ä»¥æµ‹è¯•ï¼Œå°±éœ€è¦è€ƒè™‘æ˜¯ä¸æ˜¯ç´§è€¦åˆäº†ã€‚<br>å¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆå¯èƒ½å°±ä¸åº”è¯¥é€šè¿‡æŠ½å–å•ç‹¬çš„æ–¹æ³•çš„æ–¹å¼æ¥æ–¹ä¾¿æµ‹è¯•ã€‚å› ä¸ºæŠ½å–å•ç‹¬çš„æ–¹æ³•ä¹Ÿå°±ç›¸å½“äºå¯¹å¤–å¼€æ”¾äº†ä¿®æ”¹æƒé™äº†ã€‚åƒæ¡ˆä¾‹ä¸­çš„è¿‡æœŸæ—¶é—´æ–¹æ³•ï¼Œprotectedä¿®é¥°å°±å¯èƒ½æœ‰é—®é¢˜ã€‚","like_count":0},{"had_liked":false,"id":177727,"user_name":"Edward Lee","can_delete":false,"product_type":"c1","uid":1228518,"ip_address":"","ucode":"156223F1D7E94A","user_header":"https://static001.geekbang.org/account/avatar/00/12/be/e6/7808520d.jpg","comment_is_top":false,"comment_ctime":1581482039,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581482039","product_id":100039001,"comment_content":"TransactionLock é€šè¿‡é€‚é…å™¨æ¥æä¾›å¯æµ‹è¯•çš„ä»£ç å®åœ¨å¤ªæƒŠè‰³äº†<br><br>åŸæ¥å•å…ƒæµ‹è¯•éš¾åº¦ä¸åœ¨äºæ€ä¹ˆæé«˜æµ‹è¯•è¦†ç›–ç‡è€Œæ˜¯æ”¹é€ å·²æœ‰çš„ä»£ç æˆå¯æµ‹è¯•ä»£ç ï¼Œåœ¨å¼€å‘è¿‡ç¨‹å°±è¦è€ƒè™‘ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Œå¦‚æœåœ¨å•å…ƒæµ‹è¯•çš„æ—¶å€™å†è€ƒè™‘é‡æ„çš„è¯å·¥ä½œé‡å°±æ¯”è¾ƒå¤§äº†<br><br>if (preAssignedId != null &amp;&amp; !preAssignedId.isEmpty()) {<br>  this.id = preAssignedId;<br>} else {<br>  this.id = IdGenerator.generateTransactionId();<br>}<br>if (!this.id.startWith(&quot;t_&quot;)) {<br>  this.id = &quot;t_&quot; + preAssignedId;<br>}<br><br>IdGenerator.generateTransactionId() ä¸ªäººè®¤ä¸ºä¸éœ€è¦ Mock äº†ï¼Œå¦å¤– this.id = &quot;t_&quot; + preAssignedId; æ˜¯ä¸æ˜¯æœ‰ bug å‘¢ï¼Ÿæ˜¯ä¸æ˜¯åº”è¯¥ this.id = &quot;t_&quot; + this.id; æ‰å¯¹å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":177622,"user_name":"æ¥Š_å®µå¤œ","can_delete":false,"product_type":"c1","uid":1019302,"ip_address":"","ucode":"7BA0CADC5F23BB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/a6/22c37c91.jpg","comment_is_top":false,"comment_ctime":1581435794,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581435794","product_id":100039001,"comment_content":"äº‰å“¥, åˆæœ‰ä¸¤ä¸ªé—®é¢˜:<br>if (status == STATUS.EXECUTED) ;<br>è¿›è¡Œäº†double check, ä½†è¿™å¥å‰é¢è·å–çš„æ˜¯åˆ†å¸ƒå¼é”;<br><br>1. é‚£è¿™ä¸ªdouble checkä¸»è¦æ„ä¹‰ä½•åœ¨å‘¢? æˆ–è€…æ˜¯é’ˆå¯¹è§£å†³é‚£ç§ä¸šåŠ¡åœºæ™¯å‘¢??<br>2. è™½ç„¶ä¸è®¾è®¡æ¨¡å¼æ— å…³, ä½†statusè¿™ä¸ªå˜é‡æ˜¯å¦åº”è¯¥è®¾ç½®ä¸ºvolatile??","like_count":0},{"had_liked":false,"id":177575,"user_name":"helloworld","can_delete":false,"product_type":"c1","uid":1015754,"ip_address":"","ucode":"00DF2FEC58D2E6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","comment_is_top":false,"comment_ctime":1581427301,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1581427301","product_id":100039001,"comment_content":"äº‰å“¥ï¼Œä¸€ç›´å¯¹äºç¼–å†™å•å…ƒæµ‹è¯•æœ‰ä¸€ä¸ªç–‘é—®ï¼šå¦‚æœè¦æµ‹è¯•çš„ä»£ç æ¶‰åŠåˆ°æ•°æ®åº“çš„æ“ä½œï¼Œå½“æµ‹è¯•ç”¨ä¾‹è·‘å®Œäº†åï¼Œå¦‚ä½•å¯¹æ•°æ®åº“è¿›è¡Œåå¤„ç†å‘¢ï¼Ÿå¯¹äºåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ•°æ®ï¼Œä¹Ÿé€šè¿‡å…¶æµ‹è¯•ç”¨ä¾‹æ¥åˆ é™¤ï¼ŸæŠ‘æˆ–æ˜¯ï¼Œè®¿é—®æ•°æ®åº“çš„ç‚¹ä¸éœ€è¦æµ‹è¯•ï¼Ÿï¼Ÿè¯·äº‰å“¥æŠ½æ—¶é—´å¸®å¿™è§£æƒ‘ï¼æ„Ÿè°¢äº†","like_count":0,"discussions":[{"author":{"id":1190123,"avatar":"https://static001.geekbang.org/account/avatar/00/12/28/eb/af064421.jpg","nickname":"ç‹äº‰","note":"","ucode":"2B611BE0E0EDD4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473261,"discussion_content":"å‡½æ•°å¼ç¼–ç¨‹æ„Ÿè§‰è¿˜æ˜¯æ²¡é¢å‘å¯¹è±¡æµè¡Œ æ‰€ä»¥ä¸“æ ä¸­æ²¡è®²","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572922845,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1274328,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLicryBoLjDicckia0c5bkOoAlYoR2I9NMK8BiaD7HCGxhS1eM9YSfDuUJuZC90uwv9FvHIVSsBoxFgZw/132","nickname":"MwumLi","note":"","ucode":"9A8A72334ADF6E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":51719,"discussion_content":"è§‰å¾—å¯å¯ä»¥å•ç‹¬ä¸€ç¯‡è¿›è¡Œå¯¹æ¯”ä¸€ä¸‹","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1573917455,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1479082,"avatar":"https://static001.geekbang.org/account/avatar/00/16/91/aa/374cc963.jpg","nickname":"æµæ°´äººå®¶","note":"","ucode":"9BB4367CAAF781","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":43436,"discussion_content":"å‡½æ•°å¼ç¼–ç¨‹å’Œé¢å‘å¯¹è±¡ä¸å†²çªå§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572874423,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":175374,"user_name":"Corner","can_delete":false,"product_type":"c1","uid":1446316,"ip_address":"","ucode":"7862D593172536","user_header":"https://static001.geekbang.org/account/avatar/00/16/11/ac/9cc5e692.jpg","comment_is_top":false,"comment_ctime":1580698140,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580698140","product_id":100039001,"comment_content":"å¯ä¸å¯ä»¥è¿™ä¹ˆç†è§£å‘¢ï¼Œå¦‚æœé™æ€æ–¹æ³•ä¾èµ–å¤–éƒ¨ç³»ç»Ÿæˆ–è€…é€»è¾‘å¤æ‚ï¼Œæ˜¯ä¸æ˜¯æœ€å¥½é‡å†™ä¸ºé¢å‘å¯¹è±¡çš„å®ä¾‹æ–¹æ³•å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":174222,"user_name":"æ²ˆæ°","can_delete":false,"product_type":"c1","uid":1230818,"ip_address":"","ucode":"20D1D820CAD60D","user_header":"https://static001.geekbang.org/account/avatar/00/12/c7/e2/27d00854.jpg","comment_is_top":false,"comment_ctime":1580094629,"is_pvip":true,"discussion_count":0,"race_medal":4,"score":"1580094629","product_id":100039001,"comment_content":"666ï¼Œè¿˜æ˜¯å¾ˆå®ç”¨ï¼Œç‰¹åˆ«æ˜¯é‡æ„ä»£ç å¯æµ‹è¯•æ€§éƒ¨åˆ†å¾ˆæœ‰å¯å‘","like_count":0},{"had_liked":false,"id":172782,"user_name":"satoshi","can_delete":false,"product_type":"c1","uid":1114872,"ip_address":"","ucode":"11508C95259E97","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLQcr5YD5xznNjMxltFI04NgpTWWicKD3QicBfshIEWtckXNYMicjdNfQu8w5hSTGicuxUg6sOI8yfoNw/132","comment_is_top":false,"comment_ctime":1579310750,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579310750","product_id":100039001,"comment_content":"è±ç„¶å¼€æœ—...","like_count":0},{"had_liked":false,"id":171673,"user_name":"ççœ¼çœ‹ä¸–ç•Œ","can_delete":false,"product_type":"c1","uid":1206388,"ip_address":"","ucode":"F94CF34BC5B2AC","user_header":"https://static001.geekbang.org/account/avatar/00/12/68/74/461b202d.jpg","comment_is_top":false,"comment_ctime":1578989534,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578989534","product_id":100039001,"comment_content":"æœ‰å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„éœ€è¦ä¾èµ–æ³¨å…¥ï¼ŒåŸºäºæ¥å£è€Œéå®ç°ï¼›å¯¹äºå±€éƒ¨å¯¹è±¡ï¼Œå¦‚ç›¸å…³*VOå¯¹è±¡å¯ç›´æ¥newï¼Œå› ä¸ºå…¶æ˜¯ä¸´æ—¶çš„ã€‚","like_count":0},{"had_liked":false,"id":171152,"user_name":"jaryoung","can_delete":false,"product_type":"c1","uid":1077406,"ip_address":"","ucode":"6E72D107DB7E51","user_header":"https://static001.geekbang.org/account/avatar/00/10/70/9e/5095f881.jpg","comment_is_top":false,"comment_ctime":1578874629,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578874629","product_id":100039001,"comment_content":"æ€è€ƒ1ï¼Œæ— éœ€å®ç°ï¼Œéšæœºç”Ÿæˆçš„IDä¸åº”è¯¥å½±å“ä¸šåŠ¡ä¸»æµç¨‹ï¼Œé™¤éIDæœ‰ä¸šåŠ¡å«ä¹‰å°±å¦å½“åˆ«è®ºã€‚<br>æ€è€ƒäºŒï¼Œå¦‚æœç±»æœ¬èº«æ˜¯å½“å‰ç±»çš„å†…éƒ¨ç±»ï¼Ÿ","like_count":0},{"had_liked":false,"id":170686,"user_name":"èš‚èšå†…æ¨+v","can_delete":false,"product_type":"c1","uid":1050508,"ip_address":"","ucode":"24B10AEE54B3FD","user_header":"https://static001.geekbang.org/account/avatar/00/10/07/8c/0d886dcc.jpg","comment_is_top":false,"comment_ctime":1578665397,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1578665397","product_id":100039001,"comment_content":"äº‰å“¥ï¼Œæƒ³è¯·æ•™ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬åœ¨mock RedisDistributedLockçš„æ—¶å€™ï¼Œå°†å…¶å°è£…æˆTransactionLockï¼Œè¿™æ ·åŸTransactionç±»ä¸­è°ƒç”¨RedisDistributedLockçš„åœ°æ–¹éƒ½æ”¹æˆäº†è°ƒç”¨TransactionLockã€‚<br>è¿™æ ·ä¸å°±ç ´åäº†åŸæœ‰ç±»çš„å®ç°å—ï¼Ÿå¦‚æœè¿™æ ·çš„mockå¾ˆå¤šï¼Œæœ€åå¿˜è®°ä¿®æ”¹ï¼Œä¼šä¸ä¼šæœ‰é—®é¢˜ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1126534,"avatar":"https://static001.geekbang.org/account/avatar/00/11/30/86/c4e4d753.jpg","nickname":"ä¼˜é›…ä¸€ç‚¹","note":"","ucode":"DA9608594E7602","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":43213,"discussion_content":"æˆ‘è¿è§‚å¯Ÿè€…æ¨¡å¼éƒ½æ²¡ç”¨è¿‡","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1572863503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1601101,"avatar":"https://static001.geekbang.org/account/avatar/00/18/6e/4d/22de9c0e.jpg","nickname":"SweetyTang","note":"","ucode":"5EB1431FA66F1D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1126534,"avatar":"https://static001.geekbang.org/account/avatar/00/11/30/86/c4e4d753.jpg","nickname":"ä¼˜é›…ä¸€ç‚¹","note":"","ucode":"DA9608594E7602","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":43219,"discussion_content":"ä¸€èµ·è®©äº‰å“¥å¸¦é£ ğŸ˜ƒ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572863829,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":43213,"ip_address":""},"score":43219,"extra":""}]},{"author":{"id":1258839,"avatar":"https://static001.geekbang.org/account/avatar/00/13/35/57/ab4ba792.jpg","nickname":"å°é±¼","note":"","ucode":"9F3D087A95D0C9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":51191,"discussion_content":"æˆ‘åšåç«¯ä¹Ÿç»å¸¸ç”¨è§‚å¯Ÿè€…æ¨¡å¼å•Š","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1573822445,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1134761,"avatar":"https://static001.geekbang.org/account/avatar/00/11/50/a9/3f8c7418.jpg","nickname":"å†°ç³•ä¸å†°","note":"","ucode":"B754FE464BA426","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":43343,"discussion_content":"åšå®¢æˆ·ç«¯å¼€å‘çš„åŒå­¦å§ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1572869561,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1601101,"avatar":"https://static001.geekbang.org/account/avatar/00/18/6e/4d/22de9c0e.jpg","nickname":"SweetyTang","note":"","ucode":"5EB1431FA66F1D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1134761,"avatar":"https://static001.geekbang.org/account/avatar/00/11/50/a9/3f8c7418.jpg","nickname":"å†°ç³•ä¸å†°","note":"","ucode":"B754FE464BA426","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":43406,"discussion_content":"å—¯ï¼Œä½ è¿™éƒ½å¯ä»¥çœ‹å‡ºæ¥ï¼Œä½©æœ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572872433,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":43343,"ip_address":""},"score":43406,"extra":""},{"author":{"id":1134761,"avatar":"https://static001.geekbang.org/account/avatar/00/11/50/a9/3f8c7418.jpg","nickname":"å†°ç³•ä¸å†°","note":"","ucode":"B754FE464BA426","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1601101,"avatar":"https://static001.geekbang.org/account/avatar/00/18/6e/4d/22de9c0e.jpg","nickname":"SweetyTang","note":"","ucode":"5EB1431FA66F1D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":43518,"discussion_content":"å› ä¸ºæˆ‘ä»¬å…¬å¸å®‰å“ç»å¸¸ç»™æˆ‘è¯´è§‚å¯Ÿè€…æ¨¡å¼ï¼Œé€šçŸ¥è¿™ä¸ªé‚£ä¸ªé¡µé¢æ›´æ–°UIï¼Œå“ˆå“ˆã€‚è¿˜æœ‰eventbus","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572879415,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":43406,"ip_address":""},"score":43518,"extra":""}]}]},{"had_liked":false,"id":170685,"user_name":"èš‚èšå†…æ¨+v","can_delete":false,"product_type":"c1","uid":1050508,"ip_address":"","ucode":"24B10AEE54B3FD","user_header":"https://static001.geekbang.org/account/avatar/00/10/07/8c/0d886dcc.jpg","comment_is_top":false,"comment_ctime":1578665348,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578665348","product_id":100039001,"comment_content":"äº‰å“¥ï¼Œæƒ³è¯·æ•™ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬åœ¨mock RedisDistributedLockçš„æ—¶å€™ï¼Œå°†å…¶å°è£…æˆTransactionLockï¼Œè¿™æ ·åŸTransactionç±»ä¸­è°ƒç”¨RedisDistributedLockçš„åœ°æ–¹éƒ½æ”¹æˆäº†è°ƒç”¨TransactionLockã€‚<br>è¿™æ ·ä¸å°±ç ´åäº†åŸæœ‰ç±»çš„å®ç°å—ï¼Ÿå¦‚æœè¿™æ ·çš„mockå¾ˆå¤šï¼Œæœ€åå¿˜è®°ä¿®æ”¹ï¼Œä¼šä¸ä¼šæœ‰é—®é¢˜ï¼Ÿ","like_count":0},{"had_liked":false,"id":170625,"user_name":"LğŸš²ğŸ±","can_delete":false,"product_type":"c1","uid":1577856,"ip_address":"","ucode":"08A012739614DE","user_header":"https://static001.geekbang.org/account/avatar/00/18/13/80/2c9da1b1.jpg","comment_is_top":false,"comment_ctime":1578646035,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578646035","product_id":100039001,"comment_content":"å…³äºæ€è€ƒé¢˜:  æ€è€ƒé¢˜ ä¸€ IdGenerator.generateTransactionId() åªæ˜¯ç”Ÿæˆä¸€ä¸ª id ç”Ÿæˆå™¨, ä¸éœ€è¦mock è¿™ä¸ªå‡½æ•°, å°±ç”Ÿæˆä¸€ä¸ªéšæœºæ•°, æ²¡å¤šå¤§æµ‹è¯•æ„ä¹‰.<br>æ€è€ƒé¢˜äºŒ æœ‰å®ç°æ–¹æ³•çš„ç±»åº”è¯¥ç”¨ä¾èµ–æ³¨å…¥å‡å°‘ä¾èµ–, entity bo vo ç­‰bean å¯ä»¥ new ä¸éœ€è¦ä¾èµ–æ³¨å…¥","like_count":0},{"had_liked":false,"id":170619,"user_name":"å µè½¦","can_delete":false,"product_type":"c1","uid":1145404,"ip_address":"","ucode":"7BC1E50A4F8D3D","user_header":"https://static001.geekbang.org/account/avatar/00/11/7a/3c/87e015f8.jpg","comment_is_top":false,"comment_ctime":1578645172,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578645172","product_id":100039001,"comment_content":"è¯·é—®å•å…ƒæµ‹è¯•åœ¨ä»€ä¹ˆæ—¶å€™åšæ¯”è¾ƒå¥½ï¼Ÿæ˜¯ä¸€ä¸ªæ¨¡å—å†™å®Œå†æµ‹è¯•è¿˜æ˜¯ä¸€ä¸ªæ–¹æ³•å†™å®Œå†æµ‹è¯•ï¼Ÿæ–‡ä¸­è·å–redisé”ç”¨é™æ€æ–¹æ³•ï¼Œä¸€è¡Œä»£ç å°±æå®šäº†ï¼Œè€Œä¸”å‡ ä¹æ‰€æœ‰çš„åˆ†å¸ƒå¼é”éƒ½æ˜¯è¿™æ ·çš„å†™æ³•ï¼Œç”¨èµ·æ¥å¾ˆæ–¹ä¾¿ï¼ŒåæœŸå‡ ä¹ä¸ä¼šå˜åŠ¨ã€‚ä¸ºäº†å¯æµ‹è¯•æ€§ï¼Œæ¯ä¸ªä¸šåŠ¡éƒ½å°è£…äº†ä¸€ä¸ªlock,æ˜¯ä¸æ˜¯è¿‡åº¦è§£è€¦äº†ã€‚","like_count":0},{"had_liked":false,"id":170565,"user_name":"èŠ±å„¿å°‘å¹´","can_delete":false,"product_type":"c1","uid":1318540,"ip_address":"","ucode":"CFE4F64243673B","user_header":"https://static001.geekbang.org/account/avatar/00/14/1e/8c/450fe5cb.jpg","comment_is_top":false,"comment_ctime":1578633966,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578633966","product_id":100039001,"comment_content":"mockçš„é€šå¸¸æ˜¯å¤–éƒ¨æœåŠ¡ï¼Œidç”Ÿæˆå™¨å¦‚æœæ˜¯ä¸ªå¤–éƒ¨æœåŠ¡é‚£å°±éœ€è¦mockï¼Œä¸è¿‡é€šå¸¸æ¥è¯´idç”Ÿæˆä¸ä¼šå½±å“ä¸šåŠ¡é€»è¾‘ã€‚<br>ä»€ä¹ˆæ—¶é—´å¯ä»¥newï¼Œéœ€è¦å–å†³äºnewçš„å¯¹è±¡æ˜¯å¦æœ‰å¤–éƒ¨ä¾èµ–ï¼Œæœ‰åˆ™éœ€è¦æ³¨å…¥ï¼Œå¦åˆ™å¯ä»¥new","like_count":0},{"had_liked":false,"id":170531,"user_name":"çŸ³ä»”","can_delete":false,"product_type":"c1","uid":1177921,"ip_address":"","ucode":"974E4604CE2213","user_header":"https://static001.geekbang.org/account/avatar/00/11/f9/41/411b1753.jpg","comment_is_top":false,"comment_ctime":1578627244,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578627244","product_id":100039001,"comment_content":"[åŸåˆ™]æ˜¯:ä¸ä¾èµ–ç½‘ç»œ,IOæˆ–è€…ç¬¬ä¸‰æ–¹æœåŠ¡çš„å°±å¯ä»¥ä¸éœ€è¦mock.<br>1.æœ¬å®æˆ˜æ¡ˆä¾‹ å¹¶æ²¡æœ‰è¦å¯¹TransactionIdè¿›è¡ŒéªŒè¯,æ‰€ä»¥åªè¦å®ƒèƒ½æ­£å¸¸ç”Ÿæˆå°±å®Œæˆäº†å®ƒçš„ä»»åŠ¡ä¸éœ€è¦mock.<br>2.ç±»å†…éƒ¨é€šè¿‡ new çš„æ–¹å¼åˆ›å»ºå¯¹è±¡,åªè¦è¿™ä¸ªå¯¹è±¡çš„åˆ›å»ºä¸è¿å[åŸåˆ™]è€Œä¸”ä¸éœ€è¦åœ¨åç»­æµ‹è¯•ä¾èµ–åˆ°å°±å¯ä»¥æ”¾åœ¨å†…éƒ¨newæ¥åˆ›å»º.<br><br>3.æœªå†³è¡Œä¸ºDemo:<br><br>public class Demo {<br>    private long currentTimestamp;<br>    private long dueTimestamp;<br><br>    public Demo(long currentTimestamp, long dueTimestamp) {<br>        this.currentTimestamp = currentTimestamp;<br>        this.dueTimestamp = dueTimestamp;<br>    }<br><br>    &#47;**<br>     * è®¡ç®—å»¶è¿Ÿå¤©æ•°<br>     *<br>     * @return<br>     *&#47;<br>    public long caculateDelayDays() {<br>        if (!isDelayDays()) {<br>            return 0;<br>        }<br>        long delayTime = this.currentTimestamp - this.dueTimestamp;<br>        long delayDays = delayTime &#47; 86400;<br>        return delayDays;<br>    }<br><br>    &#47;**<br>     * æ˜¯å¦å»¶è¿Ÿ<br>     *<br>     * @return<br>     *&#47;<br>    public boolean isDelayDays() {<br>        if (this.dueTimestamp &gt;= this.currentTimestamp) {<br>            return false;<br>        }<br>        return true;<br>    }<br>}<br><br>æµ‹è¯•:<br>    @Test<br>    public void caculateDelayDaysTest() {<br>        long currentTimestamp = System.currentTimeMillis();<br>        Demo demo = new Demo(System.currentTimeMillis(), currentTimestamp - 14 * 86400);<br>        assertEquals(14l, demo.caculateDelayDays());<br>    }","like_count":0},{"had_liked":false,"id":170432,"user_name":"Kenå¼ äº‘å¿ ","can_delete":false,"product_type":"c1","uid":1134288,"ip_address":"","ucode":"D0BAC9FC17DE2B","user_header":"https://static001.geekbang.org/account/avatar/00/11/4e/d0/d8a5f720.jpg","comment_is_top":false,"comment_ctime":1578615063,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578615063","product_id":100039001,"comment_content":"1.å®æˆ˜æ¡ˆä¾‹ä¸­çš„ void fillTransactionId(String preAssignedId) å‡½æ•°ä¸­åŒ…å«ä¸€å¤„é™æ€å‡½æ•°è°ƒç”¨ï¼šIdGenerator.generateTransactionId()ï¼Œè¿™æ˜¯å¦ä¼šå½±å“åˆ°ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Ÿåœ¨å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯å¦éœ€è¦ mock è¿™ä¸ªå‡½æ•°ï¼Ÿ<br>å¦‚æœgenerateTransactionId()ä¾èµ–äº†å¤–éƒ¨æœåŠ¡,å¦‚redis&#47;mysql&#47;zookeeperç­‰,å°±ä¼šå½±å“ä»£ç çš„å¯æµ‹è¯•æ€§,åœ¨å†™å•å…ƒæµ‹è¯•æ—¶å°±éœ€è¦mockè¿™ä¸ªå‡½æ•°;<br>å¦‚æœgenerateTransactionId()æ²¡æœ‰ä¾èµ–å¤–éƒ¨æœåŠ¡å°±ä¸ä¼šå½±å“ä»£ç çš„å¯æµ‹è¯•æ€§,å†™å•å…ƒæµ‹è¯•æ—¶ä¹Ÿä¸éœ€è¦mockè¿™ä¸ªå‡½æ•°.<br><br>2.ä¾èµ–æ³¨å…¥æ˜¯æé«˜ä»£ç å¯æµ‹è¯•æ€§çš„æœ€æœ‰æ•ˆçš„æ‰‹æ®µã€‚æ‰€ä»¥ï¼Œä¾èµ–æ³¨å…¥ï¼Œå°±æ˜¯ä¸è¦åœ¨ç±»å†…éƒ¨é€šè¿‡ new çš„æ–¹å¼åˆ›å»ºå¯¹è±¡ï¼Œè€Œæ˜¯è¦é€šè¿‡å¤–éƒ¨åˆ›å»ºå¥½ä¹‹åä¼ é€’ç»™ç±»ä½¿ç”¨ã€‚<br>é‚£æ˜¯ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡éƒ½ä¸èƒ½åœ¨ç±»å†…éƒ¨åˆ›å»ºå‘¢ï¼Ÿå“ªç§ç±»å‹çš„å¯¹è±¡å¯ä»¥åœ¨ç±»å†…éƒ¨åˆ›å»ºå¹¶ä¸”ä¸å½±å“ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Ÿä½ èƒ½ä¸¾å‡ ä¸ªä¾‹å­å—ï¼Ÿ<br>ä¸æ˜¯.<br>æ²¡æœ‰ä¾èµ–å¤–éƒ¨æœåŠ¡çš„å¯¹è±¡å¯ä»¥åœ¨ç±»å†…éƒ¨åˆ›å»º,å¹¶ä¸”ä¸ä¼šå½±å“ä»£ç çš„å¯æµ‹è¯•æ€§.<br>ä¾‹å¦‚new Date()æ²¡æœ‰ä¾èµ–å¤–éƒ¨æœåŠ¡,åªæ˜¯è°ƒç”¨äº†æœ¬æœºæ“ä½œç³»ç»Ÿçš„æ—¶é—´å‡½æ•°.","like_count":0,"discussions":[{"author":{"id":1190123,"avatar":"https://static001.geekbang.org/account/avatar/00/12/28/eb/af064421.jpg","nickname":"ç‹äº‰","note":"","ucode":"2B611BE0E0EDD4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473447,"discussion_content":"å¯ä»¥çš„ æˆ‘åé¢å¯ä»¥è€ƒè™‘å¤šå†™å‡ ç¯‡åŠ é¤","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1572993697,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":170206,"user_name":"ä¸€åå°å­¦ç”Ÿ","can_delete":false,"product_type":"c1","uid":1137292,"ip_address":"","ucode":"5C73082E6B6370","user_header":"https://static001.geekbang.org/account/avatar/00/11/5a/8c/1fec5fa2.jpg","comment_is_top":false,"comment_ctime":1578550153,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1578550153","product_id":100039001,"comment_content":"ä¸€ç›´æä¸æ‡‚å•å…ƒæµ‹è¯•æ€ä¹ˆå†™ï¼Œäºæ˜¯å°±ä¸å–œæ¬¢å†™ï¼Œè·Ÿç€è¿™èŠ‚è¯¾æ•²äº†ä»£ç ï¼Œå­¦åˆ°äº†å¥½å¤šã€‚æ„Ÿè§‰çŸ¥é“æ€ä¹ˆå»å†™ï¼Œæ„Ÿè§‰è‡ªå·±ä¸€ä¸‹å˜å¼ºäº†ï¼Œäº‰å“¥å¤ªå¼ºäº†ï¼Œ666","like_count":0,"discussions":[{"author":{"id":1145404,"avatar":"https://static001.geekbang.org/account/avatar/00/11/7a/3c/87e015f8.jpg","nickname":"å µè½¦","note":"","ucode":"7BC1E50A4F8D3D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":128503,"discussion_content":"æˆ‘å­¦åˆ°äº†â€œå¯æµ‹è¯•æ€§â€è¿™ä¸ªæ¦‚å¿µã€‚æ‡‚å¾—æ€ä¹ˆç”¨æ–­è¨€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578645343,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":170038,"user_name":"#HEAVEN","can_delete":false,"product_type":"c1","uid":1191155,"ip_address":"","ucode":"C14977F6D24E19","user_header":"https://static001.geekbang.org/account/avatar/00/12/2c/f3/bab761d0.jpg","comment_is_top":false,"comment_ctime":1578495488,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578495488","product_id":100039001,"comment_content":"ä½ å¥½ï¼Œæ²¡æœ‰æ‰¾åˆ°ä½œè€…é‚®ç®±ï¼Œæƒ³é—®ä¸€ä¸ªé—®é¢˜ï¼›<br>ä½œè€…åœ¨å¼€å‘ä¸€ä¸ªéœ€æ±‚çš„æ—¶å€™æ˜¯æ€æ ·çš„ä¸€ä¸ªæµç¨‹ï¼Œè®¾è®¡åšåˆ°é‚£ç§ç¨‹åº¦ï¼Ÿ<br>æ¯”å¦‚è¯´ä¸€èˆ¬æˆ‘ä¼šåš1. éœ€æ±‚åˆ†æï¼Œåˆ—å‡ºå“ªäº›éœ€æ±‚caseï¼› 2. åˆ—å‡ºè¿™äº›caseéœ€è¦å¼€å‘å“ªäº›åŠŸèƒ½ç‚¹ï¼›3. ä¸»è¦æ¶‰åŠåˆ°å“ªäº›ç±»ï¼Œç»“æ„å¦‚ä½•ç»„ç»‡ï¼›4. ä¸»è¦ç±»çš„ä¸»è¦èŒè´£ç­‰ï¼›5. å¼€å§‹codeäº†ï¼›<br>åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ä¹Ÿä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ï¼Œæœ‰æ—¶å€™æœ‰äº›ç±»çš„èŒè´£æˆ–è€…ç»“æ„å¼€å§‹çš„è®¾è®¡ä¸å¤ªåˆç†ï¼Œéœ€è¦ä¸€äº›ä¿®æ”¹ï¼›è¿™ä¸ªæ—¶å€™æˆ‘å°±åœ¨æ€€ç–‘ï¼Œæ˜¯ä¸æ˜¯å‰æœŸåšçš„è®¾è®¡ä¸å¤Ÿå……åˆ†é€ æˆçš„ã€‚ä¹Ÿçœ‹åˆ°ä¸€äº›ä¹¦ä¸Šä¼šæŠŠç±»çš„å±æ€§ã€æ–¹æ³•éƒ½è®¾è®¡å‡ºæ¥ï¼Œè¿˜æœ‰ä¸»è¦æµç¨‹caseçš„åºåˆ—å›¾ï¼›ä½†æ˜¯è¿™æ ·åšè€—æ—¶è¾ƒå¤šï¼Œå¾ˆå¤šæ—¶å€™é¡¹ç›®æ—¥ç¨‹ä¸å…è®¸ã€‚<br>åƒé—®ä¸€ä¸‹ï¼Œä½œè€…åœ¨å¼€å‘ä¸­è®¾è®¡é˜¶æ®µæœ‰å“ªäº›æµç¨‹ï¼Œåšåˆ°ä»€ä¹ˆç¨‹åº¦ï¼Ÿ<br>ç•™ä¸ªé‚®ç®±æ–¹ä¾¿äº¤æµå°±æ›´å¥½äº†","like_count":0},{"had_liked":false,"id":169997,"user_name":"ä¸€å£¶æµŠé…’","can_delete":false,"product_type":"c1","uid":1145530,"ip_address":"","ucode":"5D90F8F8121BBE","user_header":"https://static001.geekbang.org/account/avatar/00/11/7a/ba/8545f2d7.jpg","comment_is_top":false,"comment_ctime":1578490574,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1578490574","product_id":100039001,"comment_content":"å¯¹äºIdGenerator.generateTransactionId()ï¼Œè™½ç„¶æ˜¯æœªå†³è¡Œä¸ºï¼Œä¸ªäººè®¤ä¸ºåªæ˜¯ç”Ÿæˆä¸€ä¸ªidäº†è¯ï¼Œå¹¶ä¸ä¼šåŒ…å«éå¸¸å¤æ‚çš„é€»è¾‘æ“ä½œï¼Œåº”è¯¥å°±è·ŸMath.abs()ç±»ä¼¼ï¼Œä¸éœ€è¦è¿›è¡Œmock","like_count":0},{"had_liked":false,"id":169968,"user_name":"æ–æ³¢é‚£å¥‘","can_delete":false,"product_type":"c1","uid":1464006,"ip_address":"","ucode":"85E2EBC01392B1","user_header":"https://static001.geekbang.org/account/avatar/00/16/56/c6/0b449bc6.jpg","comment_is_top":false,"comment_ctime":1578485377,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578485377","product_id":100039001,"comment_content":"æ„Ÿè§‰é‚£ä¸ªcreatetimestampé‚£è¾¹ å¦‚æœæ²¡æœ‰setæ–¹æ³•åº”è¯¥å¯ä»¥ç”¨åå°„å»ä¿®æ”¹è¿™ä¸ªå±æ€§<br><br>æ€è€ƒé¢˜1 å¯ä»¥ä¸mock å› ä¸ºæ‰§è¡Œidgeneratorä¹‹å‰æœ‰é€»è¾‘åˆ¤æ–­çš„ åªè¦ä¼ å…¥è¿›å»çš„å‚æ•°ä¸æ»¡è¶³æ¡ä»¶å°±ä¸ä¼šèµ° å…¶æ¬¡å¯¹äºidå¼€å¤´æ·»åŠ t_è¿™ä¸ªé€»è¾‘è·Ÿidç”Ÿæˆå™¨æ²¡æœ‰å…³ç³» åªè¦ä¿è¯é€ å‡ºæ¥åˆ°idæ²¡æœ‰t_å¼€å¤´å°±å¯ä»¥æµ‹è¯•<br><br>æ€è€ƒé¢˜2 å…¶å®æœ€è¿‘åœ¨å†™ä¸€ä¸ªéœ€æ±‚ æˆ‘å°±ç”¨äº†å†…éƒ¨ç±» ä¹Ÿè§‰å¾—å¹¶æ²¡æœ‰ç ´åæµ‹è¯•æ€§ æˆ‘è¿™ä¸ªå†…éƒ¨ç±»ä¸»è¦æ˜¯ä¸ºäº†éšè—æŸä¸ªæ¥å£çš„å®ç° ä¸æƒ³è¢«è°ƒç”¨è€…åœ¨ä½¿ç”¨å¤–éƒ¨ç±»æ—¶æ»¥ç”¨æˆ‘çš„æ¯ä¸€ä¸ªæ¥å£å®ç°æ–¹æ³• èµ·åˆ°ä¸€ä¸ªä¿æŠ¤ä½œç”¨ å¯¹äºæµ‹è¯•æ€§ å®Œå…¨å¯ä»¥é€šè¿‡ä¸åŒçš„å¤–éƒ¨ç±»å‚æ•°æ¥è¿›è¡Œè°ƒæ•´ å…¶å®å¯¹äºå†…éƒ¨ç±»çš„å¯æµ‹è¯•æ€§æ¥è®² åªè¦å¤–éƒ¨ç±»æœ‰è¶³å¤Ÿçš„å‚æ•°æ¥æ§åˆ¶å†…éƒ¨ç±»å°±å¯ä»¥ å¯¹äºå†…éƒ¨ç±»è°ƒç”¨ç¬¬ä¸‰æ–¹çš„æƒ…å†µ åªè¦å¤–éƒ¨ç±»æœ‰å‚æ•°å¯ä»¥æ³¨å…¥å°±å¯ä»¥ç”¨mockæ¥ä¿®æ”¹å†…éƒ¨ç±»çš„å®ç°","like_count":0},{"had_liked":false,"id":169855,"user_name":"Jxin","can_delete":false,"product_type":"c1","uid":1251111,"ip_address":"","ucode":"4C03928388C413","user_header":"https://static001.geekbang.org/account/avatar/00/13/17/27/ec30d30a.jpg","comment_is_top":false,"comment_ctime":1578459458,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578459458","product_id":100039001,"comment_content":"1.æ ä¸»å¥½åƒæè¿‡ï¼Œè¦è°ˆè°ˆåˆ†å±‚å¯¹äºå¯æµ‹è¯•æ€§çš„å½±å“ï¼Œä¸çŸ¥æ˜¯ä¸æ˜¯æˆ‘è®°é”™äº†ï¼Œè¿™ç¯‡æ²¡æåˆ°å“ˆã€‚<br><br>å›ç­”é—®é¢˜<br>1.äº¤æ˜“idè¿™ä¸œè¥¿ï¼Œæ˜¯å…¨å±€å”¯ä¸€çš„ã€‚ä¸è¯¥è¢«mockï¼Œmockäº†ä¸ä»…æ²¡ç”¨ï¼Œåè€Œå¯èƒ½ä¼šæœ‰å…¶ä»–é—®é¢˜ï¼ˆå¦‚æœæœ‰å¼•å…¥å”¯ä¸€é”®æ£€éªŒç›¸å…³æœºåˆ¶çš„è¯ï¼Œæ¯”å¦‚å¹‚ç­‰å•¥çš„ï¼‰ã€‚<br><br>2.å€¼å¯¹è±¡å¯ä»¥newï¼Œå› ä¸ºå€¼å¯¹è±¡ä¸ä¼šæœ‰æ¶‰åŠæ”¹åŠ¨è‡ªèº«å±æ€§çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒé€šå¸¸æ˜¯ä¸å¯å˜çš„ï¼Œæ‰€ä»¥ä¹Ÿæ²¡ä»€ä¹ˆæ£€éªŒçš„æ„ä¹‰ã€‚è€Œå®ä½“é¢†åŸŸæ¨¡å‹ä¸ä¸€å®šå¯ä»¥newï¼Œå› ä¸ºå…¶æ–¹æ³•ä¼šæ”¹å˜è‡ªèº«å±æ€§ï¼Œè€Œå¯¹è¿™äº›å±æ€§å˜åŠ¨ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æ ¡éªŒã€‚è€Œè´«è¡€å®ä½“dtoæˆ–doä¹‹ç±»çš„ï¼Œä¸€èˆ¬ä¹Ÿå¯ä»¥newï¼Œå› ä¸ºå®ƒåªæ‰¿æ¥å±æ€§ï¼Œåœºæ™¯ç±»ä¼¼å€¼å¯¹è±¡ï¼Œåªéœ€è¦å…³å¿ƒæ–¹æ³•è¿”å›çš„dtoæˆ–voçš„å€¼å³å¯ï¼Œæ— éœ€å…³å¿ƒæ–¹æ³•å†…éƒ¨æ˜¯newè¿˜æ˜¯æ³¨å…¥çš„ï¼ˆå¯¹äºæ–¹æ³•è€Œè¨€ï¼Œé™¤äº†ç±»æˆå‘˜å±æ€§çš„æ³¨å…¥ï¼Œæ–¹æ³•å…¥å‚ä¹Ÿç®—æ³¨å…¥å§ï¼‰ã€‚","like_count":0},{"had_liked":false,"id":169839,"user_name":"æå°å››","can_delete":false,"product_type":"c1","uid":1112747,"ip_address":"","ucode":"2A766BE16B276B","user_header":"https://static001.geekbang.org/account/avatar/00/10/fa/ab/0d39e745.jpg","comment_is_top":false,"comment_ctime":1578454869,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578454869","product_id":100039001,"comment_content":"è®¾è®¡æ¨¡å¼_29:<br><br>1. æˆ‘è®¤ä¸ºé™æ€æ–¹æ³•```IdGenerator.generateTransactionId()```ä¸éœ€è¦mockï¼Œå› ä¸ºå®ƒä¸ä¼šå¾ˆè€—æ—¶(å¦‚æœå®ç°æ¯”è¾ƒæ­£å¸¸)ï¼Œä¹Ÿæ²¡æœ‰æœªå†³è¡Œä¸ºï¼Œé™¤éå¯¹äºidæœ‰ç‰¹æ®Šçš„è¦æ±‚ï¼Œå¦åˆ™ä¸éœ€è¦mockã€‚<br><br>2. è¿™é“é¢˜æˆ‘æƒ³ä¸æ¸…æ¥šï¼Œæƒ³çœ‹çœ‹ç‹äº‰è€å¸ˆå’Œå¤§å®¶çš„çœ‹æ³•ã€‚","like_count":0},{"had_liked":false,"id":169832,"user_name":"æ­¤é±¼ä¸å¾—æ°´","can_delete":false,"product_type":"c1","uid":1257453,"ip_address":"","ucode":"95268E823FB4D2","user_header":"https://static001.geekbang.org/account/avatar/00/13/2f/ed/a87bb8fa.jpg","comment_is_top":false,"comment_ctime":1578453731,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1578453731","product_id":100039001,"comment_content":"1. æœªå†³è¡Œä¸º ä¸­æåˆ°çš„å•æµ‹ï¼Œå¯ä»¥æŠŠä¸ç¡®å®šçš„å˜é‡â€˜å½“å‰æ—¶é—´â€™æå–å‡ºæ¥ä½œä¸ºå…¥å‚","like_count":0,"discussions":[{"author":{"id":1055334,"avatar":"https://static001.geekbang.org/account/avatar/00/10/1a/66/2d9db9ed.jpg","nickname":"è‹¦è¡Œåƒ§","note":"","ucode":"726024A9A9CF44","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":131907,"discussion_content":"æ€ä¹ˆç†è§£ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578874493,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":169815,"user_name":"å®ˆæ‹™","can_delete":false,"product_type":"c1","uid":1738326,"ip_address":"","ucode":"F594B2DA3F6D4F","user_header":"https://static001.geekbang.org/account/avatar/00/1a/86/56/509535da.jpg","comment_is_top":false,"comment_ctime":1578451094,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1578451094","product_id":100039001,"comment_content":"è¯¾å ‚è®¨è®º:<br><br><br><br>Q1.å®æˆ˜æ¡ˆä¾‹ä¸­çš„ void fillTransactionId(String preAssignedId) å‡½æ•°ä¸­åŒ…å«ä¸€å¤„é™æ€å‡½æ•°è°ƒç”¨ï¼šIdGenerator.generateTransactionId()ï¼Œè¿™æ˜¯å¦ä¼šå½±å“åˆ°ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Ÿåœ¨å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯å¦éœ€è¦ mock è¿™ä¸ªå‡½æ•°ï¼Ÿ<br><br><br><br>Answer1: <br><br>ç†è®ºä¸Šè®²fill()æ–¹æ³•ç”±äºå†…éƒ¨é™æ€æ–¹æ³•çš„ä½¿ç”¨,åŠidç”Ÿæˆçš„æœªå†³è¡Œä¸º,å½±å“å¯æµ‹è¯•æ€§.<br><br>è§£å†³æ–¹æ³•æ˜¯ä¸ºfill()æ–¹æ³•æ·»åŠ ä¸€ä¸ªå½¢å‚,generateId,å¦‚ä¸‹:<br><br>void fillTransactionId(@Nullable String preAssignedId, @Nullable String generateId)<br><br>ä½†è¿™æ ·åšä¼šå½±å“å°è£…æ€§.fill()æ–¹æ³•å†…éƒ¨é€»è¾‘ç®€å•,å¯¹å¯æµ‹è¯•æ€§çš„å½±å“æ˜¯å¾®ä¸è¶³é“çš„.é™¤éæµ‹è¯•é—®é¢˜ç›´æŒ‡fill()æ–¹æ³•,å¦åˆ™ä¸ªäººå€¾å‘äºä¸åšä¿®æ”¹.<br><br><br><br>Q2.æˆ‘ä»¬ä»Šå¤©è®²åˆ°ï¼Œä¾èµ–æ³¨å…¥æ˜¯æé«˜ä»£ç å¯æµ‹è¯•æ€§çš„æœ€æœ‰æ•ˆçš„æ‰‹æ®µã€‚æ‰€ä»¥ï¼Œä¾èµ–æ³¨å…¥ï¼Œå°±æ˜¯ä¸è¦åœ¨ç±»å†…éƒ¨é€šè¿‡ new çš„æ–¹å¼åˆ›å»ºå¯¹è±¡ï¼Œè€Œæ˜¯è¦é€šè¿‡å¤–éƒ¨åˆ›å»ºå¥½ä¹‹åä¼ é€’ç»™ç±»ä½¿ç”¨ã€‚é‚£æ˜¯ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡éƒ½ä¸èƒ½åœ¨ç±»å†…éƒ¨åˆ›å»ºå‘¢ï¼Ÿå“ªç§ç±»å‹çš„å¯¹è±¡å¯ä»¥åœ¨ç±»å†…éƒ¨åˆ›å»ºå¹¶ä¸”ä¸å½±å“ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Ÿä½ èƒ½ä¸¾å‡ ä¸ªä¾‹å­å—ï¼Ÿ<br><br><br><br>Answer2: å†…éƒ¨ç±»æˆ–é™æ€å†…éƒ¨ç±», å±€éƒ¨ç±»çš„å¯¹è±¡å¯ä»¥åœ¨ç±»å†…éƒ¨é€šè¿‡new çš„æ–¹å¼åˆå§‹åŒ–.å®ƒä»¬æ˜¯å¤–éƒ¨ç±»è¡Œä¸ºçš„ä¸€éƒ¨åˆ†,ä»…ä¸ºå¤–éƒ¨ç±»è‡ªå·±ä½¿ç”¨,ä¸å½±å“æµ‹è¯•æ€§.<br><br><br><br>å¯¹äºæœªå†³è¡Œä¸ºæ–¹æ³•çš„æ”¹é€ :<br><br>before: <br><br><br><br>public class Demo { <br><br>public long caculateDelayDays(Date dueTime){<br><br> long currentTimestamp = System.currentTimeMillis();<br><br> if (dueTime.getTime() &gt;= currentTimestamp) { return 0; } <br><br>long delayTime = currentTimestamp - dueTime.getTime();<br><br> long delayDays = delayTime &#47; 86400; <br><br>return delayDays; <br><br>â€‹    }<br><br>}<br><br><br><br>after:<br><br>public class Demo { <br><br>public long caculateDelayDays(Date dueTime, Date currentTime){<br><br>â€‹     long currentTimestamp = currentTime.getTime();<br><br>â€‹     if (dueTime.getTime() &gt;= currentTimestamp) { return 0; } <br><br>â€‹     long delayTime = currentTimestamp - dueTime.getTime();<br><br>â€‹     long delayDays = delayTime &#47; 86400; <br><br>â€‹     return delayDays; <br><br>â€‹    }<br><br>}","like_count":0},{"had_liked":false,"id":169805,"user_name":"Jackey","can_delete":false,"product_type":"c1","uid":1063751,"ip_address":"","ucode":"125DE81993FEDD","user_header":"https://static001.geekbang.org/account/avatar/00/10/3b/47/f6c772a1.jpg","comment_is_top":false,"comment_ctime":1578448850,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578448850","product_id":100039001,"comment_content":"IDç”Ÿæˆæ–¹æ³•åªæ˜¯ç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸ªäººè®¤ä¸ºå¯ä»¥ä¸ç”¨æµ‹è¯•","like_count":0},{"had_liked":false,"id":169799,"user_name":"liu_liu","can_delete":false,"product_type":"c1","uid":1019138,"ip_address":"","ucode":"24283806A07759","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/02/6a16058a.jpg","comment_is_top":false,"comment_ctime":1578447914,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578447914","product_id":100039001,"comment_content":"1. ç”Ÿæˆçš„id å¹¶ä¸ä¼šå¯¹ä¸»ä½“é€»è¾‘é€ æˆå½±å“ï¼Œæ— éœ€mockï¼Œåªéœ€è¯¥ idGen æœ¬èº«é€šè¿‡å•å…ƒæµ‹è¯•å³å¯ã€‚<br>2. å¦‚æœæœªä½¿ç”¨åˆ°ä¾èµ–å¯¹è±¡çš„åŠŸèƒ½ï¼Œæˆ–è€…å…¶åŠŸèƒ½å¾ˆç®€å•ï¼Œåˆæˆ–è€…ä½¿ç”¨äº†ä¹Ÿä¸ä¼šå½±å“åˆ°å½“å‰è¢«æµ‹å‡½æ•°é€»è¾‘ï¼Œå¯ä»¥å†…éƒ¨ newã€‚","like_count":0},{"had_liked":false,"id":169794,"user_name":"æˆæ¥ Peter","can_delete":false,"product_type":"c1","uid":1252977,"ip_address":"","ucode":"4D13E7368D8CF2","user_header":"https://static001.geekbang.org/account/avatar/00/13/1e/71/9dcbe6c4.jpg","comment_is_top":false,"comment_ctime":1578447737,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578447737","product_id":100039001,"comment_content":"è¿™ä¸€èŠ‚æ›´åå‘å®æˆ˜ï¼Œå†™ä»£ç çš„æ–¹å¼ï¼Œè®©æˆ‘ä¸€ä¸‹ç†è§£äº†ä¾èµ–æ³¨å…¥å’Œåè½¬ä¾èµ–","like_count":0},{"had_liked":false,"id":169786,"user_name":"å°æ™å­","can_delete":false,"product_type":"c1","uid":1132337,"ip_address":"","ucode":"3AAA6FB5ACB6AE","user_header":"https://static001.geekbang.org/account/avatar/00/11/47/31/f35367c8.jpg","comment_is_top":false,"comment_ctime":1578446622,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1578446622","product_id":100039001,"comment_content":"1. è¿™ä¸ªé™æ€å‡½æ•°å¤šå°‘æ˜¯æœ‰ä¸€äº›å½±å“çš„ï¼Œæµ‹è¯•è¿™ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œéœ€è¦å…³æ³¨è¿™ä¸ªé™æ€å‡½æ•°çš„é€»è¾‘ï¼Œçœ‹å®ƒè¿”å›å€¼ï¼Œæ‰èƒ½åœ¨æµ‹è¯•çš„æ—¶å€™åˆ¤æ–­this.idæ˜¯å¦æ»¡è¶³æœŸå¾…å€¼ï¼Œæ¯”å¦‚è¿™ä¸ªé™æ€å‡½æ•°è¿”å›å€¼ä¸­ä¸åŒ…å«â€œt_â€ï¼Œé‚£ä¹ˆå•å…ƒæµ‹è¯•çš„asserté€»è¾‘å°±ä¸ä¸€æ ·ã€‚åœ¨å†™å•å…ƒæµ‹è¯•æ—¶å€™ï¼Œåªè¦è¿™ä¸ªé™æ€å‡½æ•°ä¸æ˜¯ç¬¬ä¸‰æ–¹çš„æœåŠ¡ï¼Œä¹Ÿæ²¡æœ‰ä¾èµ–ç¬¬ä¸‰æ–¹çš„æœåŠ¡ï¼Œè¿”å›å€¼çš„formatå›ºå®šï¼Œå¹¶ä¸”æˆ‘ä»¬ä¹Ÿä¸å…³å¿ƒthis.idçš„formatï¼Œé‚£ä¹ˆå¯ä»¥ä¸mockå®ƒï¼Œåä¹‹ï¼Œæœ€å¥½è¿˜æ˜¯mockï¼Œè¿™æ ·æµ‹è¯•çš„æ—¶å€™å¯ä»¥æœŸå¾…å›ºå®šè¾“å…¥å¾—åˆ°å›ºå®šè¾“å‡ºã€‚<br>2. è´«è¡€æ¨¡å‹ä¸­çš„é‚£äº›*oå¯ä»¥ç›´æ¥åœ¨é‡Œé¢newã€‚","like_count":0,"discussions":[{"author":{"id":1743060,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er8xHGabhfnPnK7gN3hVJ0n3wia5qIaay7IOQaGJ4ia0kB1CKywjbJNeGjM7DKexk6TZl88f6um4pqw/132","nickname":"æ—©æ—©å‡¡","note":"","ucode":"E70B0306637482","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":305608,"discussion_content":"æˆ‘ä¹Ÿæ˜¯å®‰å“è½¬java","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600015798,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":169761,"user_name":"å¤±ç«çš„å¤å¤©","can_delete":false,"product_type":"c1","uid":1241770,"ip_address":"","ucode":"10C6E66EB2A65F","user_header":"https://static001.geekbang.org/account/avatar/00/12/f2/aa/32fc0d54.jpg","comment_is_top":false,"comment_ctime":1578443379,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"701658112627","product_id":100039001,"comment_content":"æ€è€ƒé¢˜1ï¼Œè¯¥æ–¹æ³•é€»è¾‘å°±æ˜¯å¡«å……ä¸€ä¸ªIDï¼ŒåŸºæœ¬éƒ½æ˜¯å†…éƒ¨å®ç°çš„ä¸€ä¸ªidç”Ÿæˆå™¨ï¼Œå¯ä»¥ä¸ç”¨é‡å†™ã€‚ä¸€å®šè¦é‡å†™ä¹Ÿè¡Œï¼Œè‡ªå·±å¼„ä¸€ä¸ªè‡ªå¢idå®ç°å°±è¡Œäº†ã€‚<br>æ€è€ƒé¢˜2ï¼Œæä¾›æ–¹æ³•çš„ç±»ä¸è¦newï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„serviceç±»ï¼Œè¿™ä¸ªæ˜¯è¦ä¾èµ–æ³¨å…¥çš„ã€‚æä¾›å±æ€§çš„ç±»ï¼Œæ¯”å¦‚voï¼Œboï¼Œentityè¿™äº›å°±å¯ä»¥newã€‚","like_count":164},{"had_liked":false,"id":173308,"user_name":"æ¥Š_å®µå¤œ","can_delete":false,"product_type":"c1","uid":1019302,"ip_address":"","ucode":"7BA0CADC5F23BB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/a6/22c37c91.jpg","comment_is_top":false,"comment_ctime":1579501200,"is_pvip":false,"replies":[{"id":"67739","content":"ä¹Ÿæ˜¯æ²¡åŠæ³•çš„äº‹æƒ…ï¼Œç†è®ºä¸Šåº”è¯¥æ˜¯privateçš„ã€‚æ‰€ä»¥ä¼šæœ‰@VisibleForTestingè¿™æ ·çš„annotation","user_name":"ä½œè€…å›å¤","comment_id":173308,"uid":"1190123","ip_address":"","utype":1,"ctime":1580117345,"user_name_real":"ç‹äº‰"}],"discussion_count":8,"race_medal":0,"score":"302227211920","product_id":100039001,"comment_content":"äº‰æ­Œ, ä»£ç ä¸­isExpired()æ–¹æ³•çš„ä¿®é¥°ç¬¦æ˜¯protected, å¦‚æœæŸäº›æ–¹æ³•ä»è®¾è®¡åŸåˆ™æ¥è¯´åº”è¯¥è®¾ç½®ä¸ºprivateçš„è¯, é‚£ä¹ˆè¿™æ ·çš„æ‰‹åŠ¨mockçš„æ–¹å¼æ˜¯å¦å°±ä¸é€‚ç”¨äº†å‘¢?<br>æ¢ä¸ªè§’åº¦æ¥æé—®: ä¸ºäº†ç»´æŒå¯æµ‹è¯•æ€§, åœ¨ä»£ç ä¸­åŠ å…¥è¿‡å¤šprotectedçš„æ–¹æ³•, æ˜¯å¦åˆç†å‘¢?","like_count":71,"discussions":[{"author":{"id":1190123,"avatar":"https://static001.geekbang.org/account/avatar/00/12/28/eb/af064421.jpg","nickname":"ç‹äº‰","note":"","ucode":"2B611BE0E0EDD4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":482029,"discussion_content":"ä¹Ÿæ˜¯æ²¡åŠæ³•çš„äº‹æƒ…ï¼Œç†è®ºä¸Šåº”è¯¥æ˜¯privateçš„ã€‚æ‰€ä»¥ä¼šæœ‰@VisibleForTestingè¿™æ ·çš„annotation","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1580117345,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1604722,"avatar":"https://static001.geekbang.org/account/avatar/00/18/7c/72/9bb072f2.jpg","nickname":"jesesun","note":"","ucode":"F5279F9043DDDA","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1190123,"avatar":"https://static001.geekbang.org/account/avatar/00/12/28/eb/af064421.jpg","nickname":"ç‹äº‰","note":"","ucode":"2B611BE0E0EDD4","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":584587,"discussion_content":"é’ˆå¯¹protectedæ–¹æ³•ç ´åå°è£…æ€§çš„caseï¼Œå¯ä»¥è€ƒè™‘ä¸‹é€šè¿‡ä¾èµ–æ³¨å…¥æˆ–è€…å·¥å‚æ–¹æ³•è§£å†³ã€‚å…·ä½“æ“ä½œï¼š\nä¾èµ–æ³¨å…¥æ–¹æ¡ˆï¼šæ ¹æ®æœªå†³æ–¹æ³•çš„æ ¹å› æ˜¯å¦é€šç”¨åˆ’åˆ†ä¸¤ç§åœºæ™¯ã€‚åœºæ™¯ä¸€ã€æœªå†³æ–¹æ³•çš„æ ¹å› æ¯”è¾ƒé€šç”¨ï¼ˆç¤ºä¾‹ä¸­çš„ System.currentTimestamp();ï¼‰ï¼ŒæŠŠæ ¹å› æŠ½å–æˆç‹¬ç«‹çš„å…¬å…±æ¥å£ï¼Œå½“å‰ç±»é€‰æ‹©åˆé€‚çš„æ¥å£å®ç°ä½œä¸ºé»˜è®¤å€¼å¹¶å¯é€šè¿‡ä¾èµ–æ³¨å…¥æŒ‰éœ€æ›¿æ¢é»˜è®¤å€¼ï¼Œå•å…ƒæµ‹è¯•æ—¶é€šè¿‡ä¾èµ–æ³¨å…¥æ›¿æ¢å½“å‰ç±»çš„é»˜è®¤å€¼ã€‚åœºæ™¯äºŒã€æœªå†³æ–¹æ³•çš„æ ¹å› ä¸é€šç”¨ï¼ŒæŠŠæ ¹å› æŠ½å–æˆå½“å‰ç±»çš„æˆå‘˜æ¥å£ï¼Œå¹¶ç”±å½“å‰ç±»çš„æˆå‘˜ç±»æä¾›é»˜è®¤å®ç°ï¼Œå½“å‰ç±»é€‰æ‹©è¿™ä¸ªæˆå‘˜ç±»çš„å®ç°ä½œä¸ºé»˜è®¤å€¼å¹¶å¯é€šè¿‡ä¾èµ–æ³¨å…¥æŒ‰éœ€æ›¿æ¢é»˜è®¤å€¼ï¼Œå•å…ƒæµ‹è¯•æ—¶é€šè¿‡ä¾èµ–æ³¨å…¥æ›¿æ¢å½“å‰ç±»çš„é»˜è®¤å€¼ã€‚\nå·¥å‚æ–¹æ³•æ–¹æ¡ˆï¼šæŠŠæœªå†³æ–¹æ³•çš„æ ¹å› æŠ½å–æˆæ¥å£ï¼Œé€šè¿‡é™æ€æ–¹æ³•æ¨¡å¼çš„å·¥å‚æ–¹æ³•ç®¡ç†æ¥å£çš„å®ç°ï¼ˆç±»ä¼¼å…¨å±€Mapï¼‰ï¼Œå½“å‰ç±»é€šè¿‡å·¥å‚æ–¹æ³•è·å–æ¥å£çš„å®ç°ï¼ˆå¦‚ï¼šCurrentTimeFactory.getInstance(InstanceType.Default)ï¼‰ï¼Œå•å…ƒæµ‹è¯•æ—¶æ›¿æ¢å·¥å‚æ–¹æ³•ä¸­å¯¹åº”çš„æ¥å£å®ç°ï¼ˆCurrentTimeFactory.setInstance(InstanceType.Default, new CurrentTimeMock())ï¼‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660957231,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":482029,"ip_address":"åŒ—äº¬"},"score":584587,"extra":""}]},{"author":{"id":1004264,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/52/e8/92a2e66d.jpg","nickname":"ç¬¬äºŒå°‘","note":"","ucode":"4A09D1E7589F67","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303346,"discussion_content":"protectedé™å®šçš„èŒƒå›´å·²ç»æ˜¯æ¯”è¾ƒå…‹åˆ¶çš„äº†ï¼Œåªèƒ½å­ç±»è°ƒç”¨å’Œé‡å†™ï¼Œç›¸æ¯”å¢åŠ çš„å¯æµ‹è¯•æ€§å¸¦æ¥çš„å¥½å¤„ï¼Œä»£ç ä¸­å¢åŠ çš„protectedæ–¹æ³•å¸¦æ¥çš„å¯¹å°è£…æ€§çš„ç ´åè¿™ç§ç‰ºç‰²æ˜¯å€¼å¾—çš„","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1599213620,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1166968,"avatar":"","nickname":"fisherhe","note":"","ucode":"7B5F692546279D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":240458,"discussion_content":"åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç§æœ‰æ–¹æ³•åªèƒ½é€šè¿‡åå°„æ¥å¼ºè¡Œè®¾å€¼ï¼Œæœ‰ç‚¹ç ´åå°è£…æ€§ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1587366001,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1311236,"avatar":"https://static001.geekbang.org/account/avatar/00/14/02/04/a678be45.jpg","nickname":"batiwant","note":"","ucode":"F873D815CBC801","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":388041,"discussion_content":"easymockå¯ä»¥ç”¨define private publicã€‚ è¿™æ ·å°±å¯ä»¥æµ‹è¯•ç±»ä¸­çš„privateå‡½æ•°äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628566526,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1609735,"avatar":"https://static001.geekbang.org/account/avatar/00/18/90/07/41d19261.jpg","nickname":"Nacol","note":"","ucode":"B645ECB9540B95","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308117,"discussion_content":"å¯ä»¥ç”¨powermockè¿™ç§æ¡†æ¶æå®š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600848843,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1455958,"avatar":"https://static001.geekbang.org/account/avatar/00/16/37/56/11068390.jpg","nickname":"å€¡å°","note":"","ucode":"4F53AA5D017D89","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303792,"discussion_content":"å…¶å®æˆ‘è§‰å¾—å¯ä»¥è®¾å®šä¸€ä¸ªå…¬å¼€çš„æµ‹è¯•æ–¹æ³•ä¸“é—¨å»è°ƒç”¨ç§æœ‰çš„æµ‹è¯•æ–¹æ³•ï¼Œè¿™ä¸ªå…¬æœ‰çš„æ–¹æ³•release æ˜¯æ²¡æœ‰çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599382411,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1019302,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8d/a6/22c37c91.jpg","nickname":"æ¥Š_å®µå¤œ","note":"","ucode":"7BA0CADC5F23BB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1455958,"avatar":"https://static001.geekbang.org/account/avatar/00/16/37/56/11068390.jpg","nickname":"å€¡å°","note":"","ucode":"4F53AA5D017D89","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":304345,"discussion_content":"public ç›´æ¥è°ƒ privateï¼Œé‚£privateå°±æ²¡æ„ä¹‰äº†ã€‚\nè™½ç„¶ä¸åœ¨releaseé‡Œé¢ï¼Œä½†åˆ«äººå†™ä»£ç æ—¶ä»ç„¶æ˜¯å¯ä»¥è°ƒä½ çš„private","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599550605,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":303792,"ip_address":""},"score":304345,"extra":""}]}]},{"had_liked":false,"id":169774,"user_name":"å®‰é™çš„boy","can_delete":false,"product_type":"c1","uid":1196475,"ip_address":"","ucode":"F5F44B75228A85","user_header":"https://static001.geekbang.org/account/avatar/00/12/41/bb/21ce60d2.jpg","comment_is_top":false,"comment_ctime":1578445377,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"250686548545","product_id":100039001,"comment_content":"è¿™èŠ‚æ»¡æ»¡çš„å¹²è´§ğŸ‘ğŸ‘ğŸ‘","like_count":59},{"had_liked":false,"id":169785,"user_name":"è¾£ä¹ˆå¤§","can_delete":false,"product_type":"c1","uid":1396951,"ip_address":"","ucode":"AB308B6DCA0108","user_header":"https://static001.geekbang.org/account/avatar/00/15/50/d7/f82ed283.jpg","comment_is_top":false,"comment_ctime":1578446537,"is_pvip":true,"discussion_count":7,"race_medal":0,"score":"156197269193","product_id":100039001,"comment_content":"å‚è€ƒäº‰å“¥ä»Šå¤©çš„ä»£ç å†™äº†ä¾‹å­ä¸­çš„æµ‹è¯•ï¼ˆå¯è¿è¡Œï¼‰ï¼š<br>https:&#47;&#47;github.com&#47;gdhucoder&#47;Algorithms4&#47;tree&#47;master&#47;designpattern&#47;u29<br><br>ä»Šå¤©å­¦ä¹ åˆ°äº†é«˜çº§çš„å•å…ƒæµ‹è¯•æ–¹æ³•ï¼š<br>1ã€ä¾èµ–å¤–éƒ¨å•ä¾‹ï¼šå°†å•ä¾‹å°è£…<br>2ã€æœªå†³è¡Œä¸ºï¼šä¾‹æ—¶é—´ã€éšæœºæ•°ã€‚å°†æœªå†³è¡Œä¸ºé‡æ–°å°è£…ï¼Œæµ‹è¯•æ—¶mockï¼Œä½¿ç”¨åŒ¿åç±»ã€‚<br><br> å…³äºè®¨è®º1ï¼šéœ€è¦mockçš„æƒ…å†µidä¼šå†™å…¥æ•°æ®åº“çš„è¯ï¼Œæµ‹è¯•åéœ€è¦æ¢å¤ç°åœºã€‚æ›¾ç»é‡åˆ°è¿‡è¿™ä¹ˆä¸€ä¸ªæƒ…å†µï¼Œidæ˜¯é€šè¿‡ä¸€å¼ è¡¨ç»´æŠ¤çš„ï¼Œå¤§äº0ï¼Œåœ¨ä»£ç ä¸­idçš„æ•°æ®ç±»å‹æ˜¯Integerï¼ˆé—ç•™ä»£ç ï¼‰ï¼Œç”±äºæµ‹è¯•æ—¶æ²¡æœ‰æ¢å¤ç°åœºï¼Œå¯¼è‡´æµ‹è¯•æ•°æ®åº“ä¸­idå¢åŠ è¿‡å¿«ï¼Œè¶…è¿‡äº†ä»£ç ä¸­Integerçš„è¡¨ç¤ºèŒƒå›´ï¼Œè€Œäº§ç”Ÿäº†æ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚","like_count":37,"discussions":[{"author":{"id":1396951,"avatar":"https://static001.geekbang.org/account/avatar/00/15/50/d7/f82ed283.jpg","nickname":"è¾£ä¹ˆå¤§","note":"","ucode":"AB308B6DCA0108","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":131121,"discussion_content":"å“ªé‡Œï¼Œåˆ«å«æˆ‘å¤§ç¥äº†ï¼Œè¿™æ®µæ—¶é—´åœ¨ä¸Šå­¦ï¼Œä¸‰å¹´æ²¡å†™ä¹Ÿä¸šåŠ¡ä»£ç äº†ã€‚è¿™ç¯‡æ˜¯éƒ‘æ™”è€å¸ˆè®²å…³äºæµ‹è¯•çš„ï¼šhttps://time.geekbang.org/column/article/79494ï¼Œå…³äºæµ‹è¯•é—®é¢˜ä»–è¿˜å†™äº†æ¡†æ¶ï¼šhttps://github.com/dreamhead/moco 3k starsã€‚çœ‹èƒ½å¦å¯¹ä½ æœ‰å¸®åŠ©ã€‚å¦å¤–ä½ çš„é—®é¢˜æœ€åå¦‚æœè§£å†³äº†çš„è¯ï¼Œå¸Œæœ›èƒ½å‘Šè¯‰æˆ‘ä¸€ä¸‹è§£å†³æ–¹æ³•ï¼Œè°¢è°¢ï¼","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1578828147,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1092806,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ac/c6/30820fa2.jpg","nickname":"æé˜³","note":"","ucode":"22492F371F4C84","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":297648,"discussion_content":"è¿™ç§æµ‹è¯•ç”¨ä¾‹ä¸€èˆ¬ç”¨spring testå°±è¡Œäº†ï¼Œæµ‹è¯•å®ŒåŠ ä¸Šæ³¨è§£ä¸æäº¤äº‹åŠ¡ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1597016466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1325226,"avatar":"https://static001.geekbang.org/account/avatar/00/14/38/aa/5efa5ded.jpg","nickname":"_Sea","note":"","ucode":"8547A37BA766E5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":130976,"discussion_content":"å¤§ç¥ï¼Œè¯·æ•™ä¸€ä¸‹ï¼›ç°åœ¨æˆ‘ä»¬é¡¹ç›®åœ¨åšç¬¬ä¸‰æ–¹æ”¯ä»˜çš„æ¨¡å—ï¼Œä¹Ÿéœ€è¦å†™å•å…ƒæµ‹è¯•ï¼Œè€Œä¸”ä»£ç è¦†ç›–ç‡è¦æ±‚90ä»¥ä¸Šï¼›æœ‰ä¸ªé—®é¢˜å°±æ˜¯åœ¨è°ƒç”¨æ”¯ä»˜å®ç¬¬ä¸‰æ–¹æ¥å£çš„æ—¶å€™ï¼Œå†™å•å…ƒæµ‹è¯•æ—¶å¾ˆä¸å¥½å†™ï¼Œç‰¹åˆ«æ˜¯å¼‚æ­¥å›è°ƒéªŒç­¾çš„æ—¶å€™ï¼Œé€»è¾‘åˆ†æ”¯å¤šï¼Œéœ€è¦è‡ªå·±ç…§ç€æ”¯ä»˜å®çš„è¿”å›æ•°æ®æ ¼å¼é¢„ç½®å¾ˆå¤šæ•°æ®ï¼Œç±»ä¼¼è¿™ç§è°ƒç”¨ç¬¬ä¸‰æ–¹APIæ”¯ä»˜ä¸æ ¡éªŒçš„æœ‰æ²¡æœ‰æ¯”è¾ƒå¥½çš„æ–¹æ³•æµ‹è¯•ï¼Ÿ ps:æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯Spring junit5","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1578816196,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1610643,"avatar":"","nickname":"Geek_02ab4d","note":"","ucode":"2EC4198426A4A9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":409990,"discussion_content":"public isExpere() -> protected?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635564810,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2115387,"avatar":"https://static001.geekbang.org/account/avatar/00/20/47/3b/70198ceb.jpg","nickname":"Aibo","note":"","ucode":"2CE3E77BD2D014","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":325830,"discussion_content":"æœ‰æ•°æ®åº“æ“ä½œï¼Œä¸å°±æ˜¯ç±»ä¼¼æ–‡ç« ä¸­å¯¹redisçš„ä¾èµ–å—ã€‚å¯ä»¥é‡æ„å»mockå§ï¼Œæˆ–è€…å°±æ˜¯ä¸€å¥—åŠŸèƒ½æŒ‰ä¸€ä¸ªæµç¨‹æµ‹è¯•ï¼Œå…ˆæ–°å¢å†ä¿®æ”¹ï¼Œæœ€ååˆ é™¤ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605440506,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1003644,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/50/7c/9082fb04.jpg","nickname":"æ—","note":"","ucode":"727C1E5E21E126","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":156561,"discussion_content":"ã€Œé«˜çº§çš„å•å…ƒæµ‹è¯•æ–¹æ³•ã€çš„1ã€2ï¼Œéƒ½æ˜¯å°†ç›¸å…³é€»è¾‘å°è£…èµ·æ¥ï¼Œä½¿ç”¨åŒ¿åç±»è¿›è¡Œmockå§ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580379830,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1698258,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIx7FdRzUuQf4Fopr7DOXEHZyCFfH4GQViaqo7bymf1qaANcOvuEhHyTNwOOUFW7psxEeSQ5k9uXWw/132","nickname":"é˜¿é¡º","note":"","ucode":"36F2AD6F980B11","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":134923,"discussion_content":"beforeEachå’ŒafterEachæ´¾ä¸Šç”¨åœºäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579055372,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":221883,"user_name":"å¼ ä¸‰ä¸°","can_delete":false,"product_type":"c1","uid":1155275,"ip_address":"","ucode":"3A6215A40B3B21","user_header":"https://static001.geekbang.org/account/avatar/00/11/a0/cb/aab3b3e7.jpg","comment_is_top":false,"comment_ctime":1590628368,"is_pvip":false,"replies":[{"id":"87067","content":"è¿™ä¸ªä¸å«é«˜åº¦è€¦åˆå§ã€‚ä¸æ˜¯è¯´è€¦åˆå¾ˆå¤šå°±æ˜¯é«˜åº¦è€¦åˆï¼Œä¹Ÿè¦çœ‹ä¸šåŠ¡éœ€æ±‚å•Šï¼Œç¡®å®è¦è¿™ä¹ˆå¤šæ•°æ®ï¼Œé‚£å¿…ç„¶è¦ä»¥æ¥è¿™ä¹ˆå¤šæœåŠ¡ã€‚è¿˜æœ‰ï¼Œä¸ºäº†å‰ç«¯è·å–æ•°æ®ç®€å•ï¼Œå¯ä»¥ç”¨facadeæ¨¡å¼ï¼ŒåŒ…è£¹ä¸€å±‚æ¥å£ã€‚","user_name":"ä½œè€…å›å¤","comment_id":221883,"uid":"1190123","ip_address":"","utype":1,"ctime":1595207745,"user_name_real":"ç‹äº‰"}],"discussion_count":1,"race_medal":0,"score":"83195006992","product_id":100039001,"comment_content":"è€å¸ˆï¼Œä¸‹é¢è¿™å¥è¯ä¸æ˜¯å¾ˆç†è§£ï¼Œå¦‚æœæˆ‘çš„æŸä¸ªæ¥å£å°±æ˜¯éœ€è¦ä¾èµ–å¾ˆå¤šæœåŠ¡æ‰èƒ½æŠŠç»“æœæ­£ç¡®è¿”å›ç»™å‰ç«¯ï¼Œè¿™æ—¶å€™æ€ä¹ˆåŠï¼Ÿæ¯”å¦‚æŸ¥è¯¢è´­ç‰©è½¦ï¼Œéœ€è¦è®¿é—®å•†å“æœåŠ¡çš„å•†å“ä¿¡æ¯ï¼Œä¼˜æƒ æœåŠ¡çš„ä¼˜æƒ ä¿¡æ¯ï¼ŒåŒæ—¶è®¿é—®ä»·æ ¼æœåŠ¡çš„ä»·æ ¼ä¿¡æ¯ç­‰ç­‰ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œé«˜åº¦è€¦åˆæ€ä¹ˆå»é¿å…å‘¢ï¼Ÿ<br><br><br><br>å¦‚æœä¸€ä¸ªç±»èŒè´£å¾ˆé‡ï¼Œéœ€è¦ä¾èµ–åå‡ ä¸ªå¤–éƒ¨å¯¹è±¡æ‰èƒ½å®Œæˆå·¥ä½œï¼Œä»£ç é«˜åº¦è€¦åˆï¼Œé‚£æˆ‘ä»¬åœ¨ç¼–å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œå¯èƒ½éœ€è¦ mock è¿™åå‡ ä¸ªä¾èµ–çš„å¯¹è±¡ã€‚ä¸ç®¡æ˜¯ä»ä»£ç è®¾è®¡çš„è§’åº¦æ¥è¯´ï¼Œè¿˜æ˜¯ä»ç¼–å†™å•å…ƒæµ‹è¯•çš„è§’åº¦æ¥è¯´ï¼Œè¿™éƒ½æ˜¯ä¸åˆç†çš„ã€‚","like_count":20,"discussions":[{"author":{"id":1190123,"avatar":"https://static001.geekbang.org/account/avatar/00/12/28/eb/af064421.jpg","nickname":"ç‹äº‰","note":"","ucode":"2B611BE0E0EDD4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496598,"discussion_content":"è¿™ä¸ªä¸å«é«˜åº¦è€¦åˆå§ã€‚ä¸æ˜¯è¯´è€¦åˆå¾ˆå¤šå°±æ˜¯é«˜åº¦è€¦åˆï¼Œä¹Ÿè¦çœ‹ä¸šåŠ¡éœ€æ±‚å•Šï¼Œç¡®å®è¦è¿™ä¹ˆå¤šæ•°æ®ï¼Œé‚£å¿…ç„¶è¦ä»¥æ¥è¿™ä¹ˆå¤šæœåŠ¡ã€‚è¿˜æœ‰ï¼Œä¸ºäº†å‰ç«¯è·å–æ•°æ®ç®€å•ï¼Œå¯ä»¥ç”¨facadeæ¨¡å¼ï¼ŒåŒ…è£¹ä¸€å±‚æ¥å£ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1595207745,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":169758,"user_name":"æ¡‚åŸè€æ‰˜å°¼","can_delete":false,"product_type":"c1","uid":1306032,"ip_address":"","ucode":"139E4B8EE88B79","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJcxSpNMqwqyicMvdOSr9ic0p1ABiauHnv7g7YQVSJuoHPoQbYDu3YzdpgmSAk2KricUBQ5yibWBWIq75w/132","comment_is_top":false,"comment_ctime":1578441893,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"61707984037","product_id":100039001,"comment_content":"æ„Ÿè°¢äº‰å“¥åˆ†äº«<br>è¯¾åè®¨è®º1.idçš„ç”Ÿæˆé€»è¾‘æœ‰ç‚¹æ²¡çœ‹æ‡‚ï¼Œå•çº¯ä»ä»£ç è¦†ç›–ä¸Šçœ‹ï¼ŒfillTransactionId æœªè¦†ç›–å®Œå…¨ï¼Œéœ€è¦mockä¸‹è¿™ä¸ªé™æ€æ–¹æ³•ï¼Œå½“ç„¶ä¹Ÿæœ‰å…¶ä»–åˆ†æ”¯é€»è¾‘å¯ä»¥è¦†ç›–ã€‚<br>idæ²¡æœ‰åœ¨executeæ–¹æ³•ä¸­ä¸æ˜¯æ ¸å¿ƒå±æ€§(mockæ–¹æ³•çš„å…¥å‚)ï¼Œä¸å½±å“executeçš„å¯æµ‹è¯•æ€§ã€‚ idçš„ç”Ÿæˆç”¨é™æ€æ–¹æ³•çœŸçš„å¥½ä¹ˆï¼Ÿ<br>2.æœ‰è¡Œä¸ºçš„å¯¹è±¡ä¸é€‚åˆåœ¨ç±»ä¸­newï¼Œå°½é‡ä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼Œä¾èµ–æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯å…·ä½“çš„å®ç°ã€‚ æ•°æ®å¯¹è±¡é€‚åˆåœ¨ç±»ä¸­new æ¯”å¦‚å„ç§model do vo info ã€‚<br>ä¸€å®¶ä¹‹è¨€æ¬¢è¿è®¨è®ºæŒ‡æ­£ã€‚","like_count":15,"discussions":[{"author":{"id":1132304,"avatar":"https://static001.geekbang.org/account/avatar/00/11/47/10/2d673601.jpg","nickname":"å¥½é¥¿æ—©çŸ¥é“é€å¤–å–äº†","note":"","ucode":"AED22DB5BF8FC7","race_medal":2,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":167485,"discussion_content":"å°ç™½é—®ä¸ªé—®é¢˜å•Šï¼Œä¸ºä»€ä¹ˆæ•°æ®å¯¹è±¡é€‚åˆåœ¨ç±»ä¸­newå‘¢ã€‚å¦‚æœæµ‹è¯•çš„æ—¶å€™éœ€è¦ç‰¹å®šçš„æ•°æ®ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581501985,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1306032,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJcxSpNMqwqyicMvdOSr9ic0p1ABiauHnv7g7YQVSJuoHPoQbYDu3YzdpgmSAk2KricUBQ5yibWBWIq75w/132","nickname":"æ¡‚åŸè€æ‰˜å°¼","note":"","ucode":"139E4B8EE88B79","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1132304,"avatar":"https://static001.geekbang.org/account/avatar/00/11/47/10/2d673601.jpg","nickname":"å¥½é¥¿æ—©çŸ¥é“é€å¤–å–äº†","note":"","ucode":"AED22DB5BF8FC7","race_medal":2,"user_type":1,"is_pvip":false},"discussion":{"id":168843,"discussion_content":"æˆ‘çš„ç†è§£æ˜¯æ•°æ®å¯¹è±¡å¯¹å¤–æ²¡æœ‰è¡Œä¸ºï¼Œåªæ˜¯ä½œä¸ºæ•°æ®ä¼ è¾“ç”¨é€”ï¼Œä¸ä¼šå¯¹å®ç°äº§ç”Ÿä¾èµ–ã€‚ ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1581596723,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":167485,"ip_address":""},"score":168843,"extra":""}]}]},{"had_liked":false,"id":169917,"user_name":"QQæ€ª","can_delete":false,"product_type":"c1","uid":1211223,"ip_address":"","ucode":"1A39B8433D9208","user_header":"https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg","comment_is_top":false,"comment_ctime":1578472448,"is_pvip":false,"replies":[{"id":"65939","content":"ğŸ˜ æ„Ÿè°¢è®¤å¯ï¼","user_name":"ä½œè€…å›å¤","comment_id":169917,"uid":"1190123","ip_address":"","utype":1,"ctime":1578488789,"user_name_real":"ç‹äº‰"}],"discussion_count":2,"race_medal":0,"score":"53118080000","product_id":100039001,"comment_content":"çœ‹åˆ°ä¸€åŠï¼Œæˆ‘å°±æ¥è¯„è®ºï¼Œè€å¸ˆæ”¶ä¸‹æˆ‘çš„è†ç›–ï¼Œå¤ªå¼ºäº†","like_count":13,"discussions":[{"author":{"id":1190123,"avatar":"https://static001.geekbang.org/account/avatar/00/12/28/eb/af064421.jpg","nickname":"ç‹äº‰","note":"","ucode":"2B611BE0E0EDD4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480770,"discussion_content":"ğŸ˜ æ„Ÿè°¢è®¤å¯ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578488789,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1595863,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqk52ZrtBQ7q8DSZFfCzSdHZvDHMGjSaktUXkdWSL7sr7MFM6AicXZOnkibXkic3J5iaqN5s19RAY1suA/132","nickname":"Potar","note":"","ucode":"6983706C716CFE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":342791,"discussion_content":"æ€¥æ€§å­å–","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610810907,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":183919,"user_name":"Jessica","can_delete":false,"product_type":"c1","uid":1084877,"ip_address":"","ucode":"9FC7E9BD3FE9F1","user_header":"https://static001.geekbang.org/account/avatar/00/10/8d/cd/b6bdc1b2.jpg","comment_is_top":false,"comment_ctime":1583162302,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"40237867966","product_id":100039001,"comment_content":"public class Demo { <br>    public long caculateDelayDays(Date dueTimeï¼Œlong currentTimestamp) { <br>        if (dueTime.getTime() &gt;= currentTimestamp) { <br>            return 0; <br>        } <br>        long delayTime = currentTimestamp - dueTime.getTime(); <br>        long delayDays = delayTime &#47; 86400; return delayDays; <br>    }<br><br>    private long getCurrentTimestamp() {<br>        return System.currentTimeMillis(); <br>    }<br>}<br><br>mockæ‰getCurrentTimestampï¼ˆï¼‰, dueTimeç»™å®šå›ºå®šçš„æ—¶é—´ï¼Œåªæ£€æŸ¥é€»è¾‘æ˜¯å¦ç¬¦åˆé¢„æœŸ","like_count":9,"discussions":[{"author":{"id":1323102,"avatar":"https://static001.geekbang.org/account/avatar/00/14/30/5e/c42bc33f.jpg","nickname":"Younger Ku","note":"","ucode":"D157DC38BDB515","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":307796,"discussion_content":"getCurrentTimestampä¸èƒ½ç”¨privateä¿®é¥°å§ï¼ŒæŒ‰è€å¸ˆçš„åšæ³•åº”è¯¥ç”¨protectedï¼ŒåŒæ—¶åŠ ä¸ŠVisibleForTestingæ³¨è§£ã€‚å¦å¤–æ—¢ç„¶æœ‰äº†getCurrentTimestampæ–¹æ³•ï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥ä¸ç”¨ä¼ å‚currentTimestampäº†ï¼Œè€Œæ˜¯åœ¨caculateDelayDaysæ–¹æ³•ä¸­éœ€è¦ç”¨åˆ°currentTimestampçš„åœ°æ–¹ç›´æ¥è°ƒç”¨getCurrentTimestampæ–¹æ³•ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1600761490,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2526391,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/fcftgBsticCicEEkuzB0GTkHIocX62YVTSvnhR1c94sccj42lVaYXrmcZyhzUI3l9NcvuN1rXLhXt2eBrZZ0Tw7A/132","nickname":"idiot","note":"","ucode":"D7A6E980B530B4","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541362,"discussion_content":"getCurrentTimestamp okçš„ï¼Œæ”¹çš„å†…éƒ¨å®ç°æ–¹æ³•ã€‚æ”¹å‚æ•°ä¸åˆé€‚ï¼Œä¸åº”è¯¥ä¸ºäº†å¯æµ‹è¯•æ€§æ”¹å¯¹å¤–æ¥å£ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640341189,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2869991,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/ca/e7/454f7f0e.jpg","nickname":"BUGå§‹ç»ˆå¿«æˆ‘ä¸€æ­¥","note":"","ucode":"230981531A30E2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":539474,"discussion_content":"çº¯çº¯å°å°ç™½  æ„Ÿè§‰é‚£ä¸ªdemo æœ‰é‡å¤çš„åœ°æ–¹,å¥½åƒå’Œä¹‹å‰çš„DRYåŸåˆ™å†²çª è¿™ä¸ªæ ·å­æ˜¯ä¸æ˜¯å¥½ä¸€ç‚¹?  è¿˜æœ‰ æ­£å¸¸é¡¹ç›®ä¸­ ä¸‰ç›®ç”¨çš„å¤šå—?\npublic long caculateDelayDays1(Date dueTime) {\n        long currentTimestamp = System.currentTimeMillis();\n        return currentTimestamp &gt; dueTime.getTime() ? (currentTimestamp - dueTime.getTime()) / 86400 : 0;\n    }\nä¸ªäººç†è§£ ,æœ¬èº«å°±æ˜¯ä¸ºäº†è®¾å®šå»¶è¿Ÿæ—¶é—´,é‚£ä¹ˆè·å–å½“å‰æ—¶é—´æ˜¯ä¸æ˜¯æœ¬èº«å°±åº”è¯¥åœ¨æµ‹è¯•çš„èŒƒå›´ä¹‹å†…å‘¢?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639726167,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":173254,"user_name":"å°ä¼Ÿ","can_delete":false,"product_type":"c1","uid":1359701,"ip_address":"","ucode":"124953423491E2","user_header":"https://static001.geekbang.org/account/avatar/00/14/bf/55/198c6104.jpg","comment_is_top":false,"comment_ctime":1579487383,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"35939225751","product_id":100039001,"comment_content":"æ€è€ƒé¢˜ï¼š<br>1. çœ‹IdGeneratoræ€ä¹ˆå®ç°ï¼Œå¦‚æœè¦æŸ¥æ•°æ®åº“æˆ–åˆ†å¸ƒå¼æœåŠ¡ï¼Œé‚£ä¹ˆä¼šæœ‰å½±å“ï¼Œéœ€è¦mockï¼›å¦‚æœæ˜¯æœ¬åœ°ç”Ÿäº§ï¼Œä¸éœ€è¦mockã€‚<br>2. ä¸ªäººè§‚ç‚¹ï¼Œä¸è¦åœ¨æ–¹æ³•é‡Œnewå¯¹è±¡ï¼Œä¾èµ–éƒ½è¦ä»¥æ³¨å…¥çš„æ–¹å¼è·å–ã€‚","like_count":9},{"had_liked":false,"id":169811,"user_name":"Jesse","can_delete":false,"product_type":"c1","uid":1368038,"ip_address":"","ucode":"727CA882B84DA0","user_header":"https://static001.geekbang.org/account/avatar/00/14/df/e6/bd1b3c0b.jpg","comment_is_top":false,"comment_ctime":1578450183,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"35938188551","product_id":100039001,"comment_content":"æ€è€ƒé¢˜1ï¼Œè¯¥æ–¹æ³•äº§ç”Ÿä¸€ä¸ªå”¯ä¸€çš„ID,æˆ‘è®¤ä¸ºä¸éœ€è¦mockã€‚<br>æ€è€ƒé¢˜2ï¼Œæˆ‘è§‰å¾—å¦‚æœå¯¹è±¡æœ‰è¡Œä¸ºï¼Œå¹¶ä¸”è¡Œä¸ºä¸å¤–éƒ¨ç³»ç»Ÿäº¤äº’æˆ–è€…æ‰§è¡Œçš„ç»“æœå…·æœ‰ä¸ç¡®å®šæ€§ï¼Œå°±éœ€è¦ä¾èµ–æ³¨å…¥æ¥å®Œæˆæµ‹è¯•ã€‚å¦‚æœå¯¹è±¡çš„è¡Œä¸ºæ˜¯å¯é¢„æµ‹çš„å¹¶ä¸”å”¯ä¸€çš„ï¼Œå¯ä»¥ç›´æ¥newã€‚","like_count":9},{"had_liked":false,"id":169875,"user_name":"é€é¥æ€","can_delete":false,"product_type":"c1","uid":1015512,"ip_address":"","ucode":"340F05C786730F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7e/d8/92a98fb6.jpg","comment_is_top":false,"comment_ctime":1578467085,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27348270861","product_id":100039001,"comment_content":"1. ä¸ä¼šå½±å“å¯æµ‹è¯•æ€§ï¼Œå› ä¸º generateTransactionId å¹¶ä¸éœ€è¦ä¾èµ–ä»€ä¹ˆå¤–éƒ¨æœåŠ¡ï¼Œæ‰€ä»¥ä¹Ÿä¸éœ€è¦ mock<br>2. ä¸æ˜¯ã€‚ä¸ä¾èµ–å¤–éƒ¨æœåŠ¡çš„ç±»å°±å¯ä»¥å†…éƒ¨åˆ›å»ºï¼Œæ¯”å¦‚ String","like_count":6},{"had_liked":false,"id":227552,"user_name":"Vincent.X","can_delete":false,"product_type":"c1","uid":1538604,"ip_address":"","ucode":"8A40B5B2F4B102","user_header":"https://static001.geekbang.org/account/avatar/00/17/7a/2c/54b48459.jpg","comment_is_top":false,"comment_ctime":1592406872,"is_pvip":false,"replies":[{"id":"83993","content":"åªèƒ½@ä¸€ä¸‹ç¼–è¾‘äº†","user_name":"ä½œè€…å›å¤","comment_id":227552,"uid":"1190123","ip_address":"","utype":1,"ctime":1592525525,"user_name_real":"ç‹äº‰"}],"discussion_count":1,"race_medal":0,"score":"23067243352","product_id":100039001,"comment_content":"æ‰‹æœºçœ‹ä»£ç æœ‰è€æ˜¯è¦æ‹–åŠ¨ï¼Œæœ‰ä»€ä¹ˆè§£å†³çš„åŠæ³•å—ï¼Ÿï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1190123,"avatar":"https://static001.geekbang.org/account/avatar/00/12/28/eb/af064421.jpg","nickname":"ç‹äº‰","note":"","ucode":"2B611BE0E0EDD4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":498681,"discussion_content":"åªèƒ½@ä¸€ä¸‹ç¼–è¾‘äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592525525,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":169938,"user_name":"ä¸‹é›¨å¤©","can_delete":false,"product_type":"c1","uid":1008315,"ip_address":"","ucode":"816B3792ECC50A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/62/bb/323a3133.jpg","comment_is_top":false,"comment_ctime":1578477594,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18758346778","product_id":100039001,"comment_content":"é—®é¢˜å›ç­”ï¼š<br>1. IdGenerator.generateTransactionId()æœ‰æœªå†³è¡Œä¸ºé€»è¾‘ï¼Œä½†ä¸æ˜¯è¯´æœ‰æœªå†³è¡Œä¸ºå°±ä¸€å®šå½±å“å¯æµ‹è¯•æ€§ï¼Œå‰ææ˜¯éœ€è¦çœ‹æœªå†³è¡Œä¸ºæ˜¯å¦æœ‰æµ‹è¯•å¿…è¦æ€§ï¼Œæ­¤å¤„ç”Ÿæˆä¸€ä¸ªéšæœºæ•°(ç±»ä¼¼ System.currentTimeMillis())ï¼Œæµ‹è¯•æ„ä¹‰ä¸å¤§ï¼<br><br>2.è´«è¡€æ¨¡å‹å®ä½“ç±»","like_count":4},{"had_liked":false,"id":169800,"user_name":"ç¾ç¾","can_delete":false,"product_type":"c1","uid":1148422,"ip_address":"","ucode":"44CC95C45AF345","user_header":"https://static001.geekbang.org/account/avatar/00/11/86/06/72b01bb7.jpg","comment_is_top":false,"comment_ctime":1578447997,"is_pvip":false,"replies":[{"id":"65942","content":"å¯ä»¥å€ŸåŠ©springtestæµ‹è¯•æ¡†æ¶æ¥åš","user_name":"ä½œè€…å›å¤","comment_id":169800,"uid":"1190123","ip_address":"","utype":1,"ctime":1578488960,"user_name_real":"ç‹äº‰"}],"discussion_count":4,"race_medal":0,"score":"18758317181","product_id":100039001,"comment_content":"æœ‰å¤šä¸ªé€šè¿‡springæ³¨å…¥çš„ç±»æ—¶ï¼Œåº”è¯¥æ€ä¹ˆåšæµ‹è¯•å‘¢ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1190123,"avatar":"https://static001.geekbang.org/account/avatar/00/12/28/eb/af064421.jpg","nickname":"ç‹äº‰","note":"","ucode":"2B611BE0E0EDD4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480724,"discussion_content":"å¯ä»¥å€ŸåŠ©springtestæµ‹è¯•æ¡†æ¶æ¥åš","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578488960,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1359701,"avatar":"https://static001.geekbang.org/account/avatar/00/14/bf/55/198c6104.jpg","nickname":"å°ä¼Ÿ","note":"","ucode":"124953423491E2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":143015,"discussion_content":"mockito+jmockitï¼Œmockç•Œçš„super star","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1579487662,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1103189,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d5/55/ce3f814f.jpg","nickname":"è´ç¬‹","note":"","ucode":"2B9650104285AD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":124852,"discussion_content":"ç”¨Mockito","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578453784,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1109844,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ef/54/58a61a50.jpg","nickname":"ë£¡ê±¸ì´","note":"","ucode":"ACC366BD4E7385","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":124810,"discussion_content":"m","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578451577,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":256924,"user_name":"éƒ‘å¤§é’±","can_delete":false,"product_type":"c1","uid":1503067,"ip_address":"","ucode":"114CF48056880E","user_header":"https://static001.geekbang.org/account/avatar/00/16/ef/5b/ff28088f.jpg","comment_is_top":false,"comment_ctime":1603784929,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14488686817","product_id":100039001,"comment_content":"ä½œä¸ºä¸€ä¸ªç å†œï¼ŒèŒè´£æ˜¯åœ¨æœ‰é™æ—¶é—´é‡Œï¼Œå®Œæˆå°½å¯èƒ½å¤šçš„ã€é«˜å¯ç»´æŠ¤æ€§ã€é«˜æ‰©å±•æ€§çš„ã€é«˜å¯é æ€§çš„ä»£ç ã€‚<br>è¿™ä¹ˆå¤šå¥½ä»£ç è¯„åˆ¤æ ‡å‡†é‡Œé¢ï¼Œæˆ‘è®¤ä¸ºå¯é æ€§æ˜¯æœ€ä¸èƒ½å¦¥åçš„ã€‚<br>æ—¶é—´å¯ä»¥å•†é‡ï¼Œä»»åŠ¡å¯ä»¥åˆ†å·¥ï¼Œç»´æŠ¤æ€§å¯ä»¥åŠ ç­æ¥æï¼Œæ‰©å±•æ€§å¯ä»¥åæœŸä¼˜åŒ–ã€‚å”¯æœ‰ä»£ç çš„å¯é æ€§ï¼Œéœ€è¦æ•´ä¸ªä¸šåŠ¡å›¢é˜Ÿæ¥æ‰¿æ‹…å®ƒå¸¦æ¥çš„å½±å“ã€‚<br>éƒ‘å¤§é’±æƒ³æŒ£æ›´å¤šé’±<br>å¯ä»¥å› ä¸ºèƒ½å†™é«˜è´¨é‡çš„ä»£ç è¦åˆ°æ›´é«˜çš„å·¥èµ„<br>å¯ä»¥é€šè¿‡ä¼˜åŒ–ä»£ç çš„å¯é æ€§æ¥æå‡ä»£ç çš„è´¨é‡<br>å¯ä»¥é€šè¿‡å•å…ƒæµ‹è¯•æ¥æå‡ä»£ç çš„å¯é æ€§<br>å•å…ƒæµ‹è¯•è¦†ç›–ç‡ï¼Œæ˜¯ä¸€ä¸ªå¯ä»¥é‡åŒ–çš„æŒ‡æ ‡ï¼Œæ˜¯ä¸€ä¸ªå¯ä»¥é›†ä¸­èµ„æºä¼˜åŒ–çš„ç‚¹ï¼Œæ˜¯ä¸€ä¸ªæŒ£å¤§é’±çš„å¥½æˆ˜ç•¥ã€‚<br>ï¼ˆå¥½çš„æˆ˜ç•¥ = ä¸€ä¸ªæ¸…æ™°çš„ç›®æ ‡ + å¯ä»¥é›†ä¸­èµ„æºä¼˜åŒ–çš„ç‚¹ â€”â€”ã€Šå¥½æˆ˜ç•¥ï¼Œåæˆ˜ç•¥ã€‹ï¼‰","like_count":3,"discussions":[{"author":{"id":2061547,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/74/eb/791d0f5e.jpg","nickname":"æ‹¿äº†æ©˜å­è·‘å“‡","note":"","ucode":"D7A281AE06DDF3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":566465,"discussion_content":"æœ´å®æ— åï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650697229,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":173362,"user_name":"ç›¸é€¢æ˜¯ç¼˜","can_delete":false,"product_type":"c1","uid":1060730,"ip_address":"","ucode":"CB299F53A95654","user_header":"https://static001.geekbang.org/account/avatar/00/10/2f/7a/ab6c811c.jpg","comment_is_top":false,"comment_ctime":1579511091,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14464412979","product_id":100039001,"comment_content":"æ‰“å¡<br>1ã€ä»€ä¹ˆæ˜¯ä»£ç å¯æµ‹è¯•æ€§ï¼š<br>é’ˆå¯¹ä»£ç ç¼–å†™å•å…ƒæµ‹è¯•çš„éš¾æ˜“ç¨‹åº¦ã€‚å¦‚æœç¼–å†™å•å…ƒæµ‹è¯•å¾ˆéš¾ï¼Œæ„å‘³ç€ä»£ç è®¾è®¡ä¸å¤Ÿåˆç†ï¼Œä»£ç çš„å¯æµ‹è¯•æ€§ä¸å¥½ã€‚<br><br>2ã€å¦‚ä½•ç¼–å†™å¯æµ‹è¯•æ€§çš„ä»£ç <br>1ã€é€šè¿‡ä¾èµ–æ³¨å…¥ï¼Œæˆ‘ä»¬åœ¨ç¼–å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ mock çš„æ–¹æ³•è§£ä¾èµ–å¤–éƒ¨æœåŠ¡<br>2ã€ä¾èµ–å¤–éƒ¨å•ä¾‹ï¼šå°†å•ä¾‹å°è£…<br>3ã€æœªå†³è¡Œä¸ºï¼šä¾‹æ—¶é—´ã€éšæœºæ•°ã€‚å°†æœªå†³è¡Œä¸ºé‡æ–°å°è£…ï¼Œæµ‹è¯•æ—¶mockã€‚<br><br>3ã€å¸¸è§çš„æµ‹è¯•ä¸å‹å¥½çš„ä»£ç æœ‰ä¸‹é¢è¿™ 5 ç§ï¼š<br>1ã€ä»£ç ä¸­åŒ…å«æœªå†³è¡Œä¸ºé€»è¾‘<br>2ã€æ»¥ç”¨å¯å˜å…¨å±€å˜é‡<br>3ã€æ»¥ç”¨é™æ€æ–¹æ³•<br>4ã€ä½¿ç”¨å¤æ‚çš„ç»§æ‰¿å…³ç³»<br>5ã€é«˜åº¦è€¦åˆçš„ä»£ç ","like_count":3},{"had_liked":false,"id":173241,"user_name":"è½å¶é£é€çš„æ‹","can_delete":false,"product_type":"c1","uid":1046429,"ip_address":"","ucode":"F9A95DB28BCF1E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f7/9d/be04b331.jpg","comment_is_top":false,"comment_ctime":1579483991,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14464385879","product_id":100039001,"comment_content":"ä¸ä¾èµ–æ¡†æ¶çš„ç±»ï¼Œéƒ½å¯ä»¥æ‰‹åŠ¨newï¼Œæ¯”å¦‚Personå¯¹è±¡ï¼Œå¯ä»¥å†…éƒ¨newï¼Œè€ŒåƒSpringçš„Serviceã€Repositoryã€Controllerè¿™äº›ä¾èµ–æ¡†æ¶çš„ï¼Œéœ€è¦ç”¨åˆ°ä¾èµ–æ³¨å…¥","like_count":3},{"had_liked":false,"id":170342,"user_name":"è¾¾æ–‡è¥¿","can_delete":false,"product_type":"c1","uid":1398824,"ip_address":"","ucode":"01C1063F23D634","user_header":"https://static001.geekbang.org/account/avatar/00/15/58/28/c86340ca.jpg","comment_is_top":false,"comment_ctime":1578574692,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14463476580","product_id":100039001,"comment_content":"å†…å®¹éƒ½æ˜¯å¹²è´§,ä¸å¤Ÿçœ‹å•Š","like_count":3},{"had_liked":false,"id":169853,"user_name":"å¹³é£é€ é›¨","can_delete":false,"product_type":"c1","uid":1014349,"ip_address":"","ucode":"F9EE4704F31E22","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7a/4d/b0228a1a.jpg","comment_is_top":false,"comment_ctime":1578458702,"is_pvip":true,"discussion_count":3,"race_medal":0,"score":"14463360590","product_id":100039001,"comment_content":"&#47;&#47; æŠ½å–äº†å½“å‰æ—¶é—´è·å–çš„é€»è¾‘ï¼Œæ–¹ä¾¿æµ‹è¯•<br>    private long currentTimeMillis;<br>    private Date dueTime;<br>    public Demo(Date dueTime){<br>        this.dueTime = dueTime;<br>        this.currentTimeMillis = getCurrentTimeMillis();<br>    }<br><br>    protected long getCurrentTimeMillis(){<br>        return System.currentTimeMillis();<br>    }<br>    public long caculateDelayDays() {<br>        if(dueTime.getTime() &gt;= currentTimeMillis){<br>            return 0;<br>        }<br>        long delayTime = currentTimeMillis - dueTime.getTime();<br>        long delayDays = delayTime &#47; 86400_000;<br>        return delayDays;<br>    }<br>    @Test<br>    public void testCaculateDelayDays(){<br>        TimeZone timeZone = TimeZone.getTimeZone(&quot;Asia&#47;ShangHai&quot;);<br>        Calendar calendar = Calendar.getInstance(timeZone);<br>        calendar.clear();<br>        calendar.set(2020, Calendar.FEBRUARY,1,0,0,0);<br>        Date dueTime = calendar.getTime();<br>        Demo demo = new DemoClassOne(dueTime);<br>        Assert.assertEquals(demo.caculateDelayDays(), 0);<br>        calendar.clear();<br>        calendar.set(2019, Calendar.DECEMBER, 31, 0,0,0);<br>        dueTime = calendar.getTime();<br>        demo = new DemoClassOne(dueTime);<br>        Assert.assertEquals(demo.caculateDelayDays(), 1);<br>    }<br><br>    public static class DemoClassOne extends Demo {<br>        public DemoClassOne(Date dueTime) {<br>            super(dueTime);<br>        }<br>        @Override<br>        protected long getCurrentTimeMillis() {<br>            TimeZone timeZone = TimeZone.getTimeZone(&quot;Asia&#47;ShangHai&quot;);<br>            Calendar calendar = Calendar.getInstance(timeZone);<br>            calendar.clear();<br>            calendar.set(2020, Calendar.JANUARY,1,0,0,0);<br>            return calendar.getTimeInMillis();<br>        }<br>    }","like_count":3,"discussions":[{"author":{"id":1901146,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK28icgzo9R0rXE5s4nIjdme2VLRLbFtcaiaibaOEEFewnoIgco4sUXhibiabDvRbGN5NOZdcEBvFvytow/132","nickname":"phpCoder","note":"","ucode":"963C378BDBF49B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":261991,"discussion_content":"æˆ‘è§‰å¾—è¿™æ ·æ˜¯ä¸æ˜¯ä¸ºäº†æµ‹è¯•è€Œè®¾è®¡äº† æ„Ÿè§‰æ€ªæ€ªçš„ğŸ¤¨","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1589030972,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1714287,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/28/6f/e430eaaa.jpg","nickname":"å¹³è¡Œçº¿","note":"","ucode":"033F8BA2D1470E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1901146,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK28icgzo9R0rXE5s4nIjdme2VLRLbFtcaiaibaOEEFewnoIgco4sUXhibiabDvRbGN5NOZdcEBvFvytow/132","nickname":"phpCoder","note":"","ucode":"963C378BDBF49B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308635,"discussion_content":"æˆ‘ä¹Ÿæ„Ÿè§‰æ€ªæ€ªçš„ï¼Œåƒæ˜¯è‡ªå·±åœ¨éª—è‡ªå·±ä¸€æ ·ï¼Œ  äº‰å“¥ä¾‹å­ä¸­çš„isExpiredå‡½æ•°ï¼Œä¸ºäº†å•ä¾§ç›´æ¥è¿”å›true, æ€»æ„Ÿè§‰å“ªé‡Œä¸å¯¹å‘¢ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601014608,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":261991,"ip_address":""},"score":308635,"extra":""}]},{"author":{"id":1254656,"avatar":"https://static001.geekbang.org/account/avatar/00/13/25/00/3afbab43.jpg","nickname":"88591","note":"","ucode":"04CE3E46455185","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":206682,"discussion_content":"æˆ‘è§‰å¾—å¯ä»¥ç®€å•ç‚¹ï¼Œç”¨ä¸¤å…¥å‚ï¼ˆä¸¤ä¸ªæ—¶é—´ï¼‰å°±å¯ä»¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584426981,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":271493,"user_name":"Better me","can_delete":false,"product_type":"c1","uid":1261959,"ip_address":"","ucode":"CADF08D357489A","user_header":"https://static001.geekbang.org/account/avatar/00/13/41/87/46d7e1c2.jpg","comment_is_top":false,"comment_ctime":1609665807,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"10199600399","product_id":100039001,"comment_content":"æ€è€ƒé¢˜1ï¼ŒIdGenerator.generateTransactionId()æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œæ ¹æ®è€å¸ˆæ–‡ä¸­æ‰€è¯´çš„ï¼Œå¦‚æœåªæ˜¯ç±»ä¼¼ Math.abs() è¿™æ ·çš„ç®€å•é™æ€æ–¹æ³•ï¼Œå¹¶ä¸ä¼šå½±å“ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Œå› ä¸ºæœ¬èº«å¹¶ä¸éœ€è¦ mockã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦é‰´åˆ«IdGenerator.generateTransactionId()æœ¬èº«æ˜¯å¦æœ‰å…¶ä»–ä¾èµ–ï¼Œå¦‚æœæ˜¯ä¾èµ–å…¶ä»–æœåŠ¡ï¼ˆæ•°æ®åº“ç­‰ï¼‰çš„å…¨å±€å‘å·å™¨åˆ™æœ‰å¿…è¦Mock<br><br>æ€è€ƒé¢˜2ï¼Œä¾èµ–æ³¨å…¥ï¼Œå°±æ˜¯ä¸è¦åœ¨ç±»å†…éƒ¨é€šè¿‡ new çš„æ–¹å¼åˆ›å»ºå¯¹è±¡ï¼Œè€Œæ˜¯è¦é€šè¿‡å¤–éƒ¨åˆ›å»ºå¥½ä¹‹åä¼ é€’ç»™ç±»ä½¿ç”¨ã€‚æ ¹æ®é¢å‘æ¥å£è€Œéå®ç°çš„ç¼–ç¨‹åŸåˆ™ï¼Œå½“æˆ‘ä»¬è¦åšå•å…ƒæµ‹è¯•çš„ç±»ä¾èµ–äº†å¤–éƒ¨æœåŠ¡æ¥å£çš„å…·ä½“å®ç°æ—¶ï¼Œå¯ä»¥ç”±å¤–éƒ¨ä¼ å…¥å®ç°ç±»å¹¶Mockç›¸å…³å‡½æ•°è¿”å›å€¼ã€‚è€Œä¸å…·ä½“è¡Œä¸ºæ— å…³çš„æ•°æ®å¯¹è±¡å¯é€šè¿‡new çš„æ–¹å¼åˆ›å»ºå¯¹è±¡ï¼Œå³è¢«æµ‹è¯•ç±»å‡½æ•°é€»è¾‘å¹¶ä¸æ˜¯å¼ºä¾èµ–å¤–éƒ¨ç±»å®ç°è¿™ç§","like_count":2},{"had_liked":false,"id":183865,"user_name":"zj","can_delete":false,"product_type":"c1","uid":1100064,"ip_address":"","ucode":"E3329CCF694AC2","user_header":"https://static001.geekbang.org/account/avatar/00/10/c9/20/e4f1b17c.jpg","comment_is_top":false,"comment_ctime":1583149524,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10173084116","product_id":100039001,"comment_content":"æ€è€ƒé¢˜1ä¸ä¼šæœ‰å½±å“ï¼Œå› ä¸ºè¿™ä¸ªidåªæ˜¯ä¸€ä¸ªå€¼è€Œå·²ï¼Œå¯¹é€»è¾‘åˆ¤æ–­ï¼Œæµ‹è¯•åœºæ™¯æ²¡æœ‰å½±å“","like_count":2},{"had_liked":false,"id":183207,"user_name":"å°æ–‡åŒå­¦","can_delete":false,"product_type":"c1","uid":1001893,"ip_address":"","ucode":"48F2AEB989C12A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/49/a5/e4c1c2d4.jpg","comment_is_top":false,"comment_ctime":1582972607,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10172907199","product_id":100039001,"comment_content":"å›ç­”ä¸€ä¸‹æé—®2ï¼š<br>æˆ‘è®¤ä¸ºå¯¹è±¡ç”Ÿå‘½å‘¨æœŸéƒ½è¢«ç±»åŒ…å«çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨ç±»å†…éƒ¨é€šè¿‡newæ„å»ºï¼Œè€Œä¸”ä¸å½±å“æµ‹è¯•ã€‚<br><br>è­¬å¦‚ä¸€ä¸ªé›†åˆç±»ï¼Œå†…ç½®äº†ä¸€ä¸ªListï¼Œè¿™ä¸ªListçš„æ´»åŠ¨èŒƒå›´ä»…é™äºè¿™ä¸ªé›†åˆç±»ï¼Œä»»ä½•æ–¹æ³•éƒ½ä¸ä¼šå‘å¸ƒè¿™ä¸ªå¯¹è±¡å‡ºå»ï¼Œé‚£ä¹ˆè¿™Listçš„å¯¹è±¡å¯ä»¥åœ¨é›†åˆåˆå§‹åŒ–çš„æ—¶å€™é€šè¿‡newè¿›è¡Œæ„é€ ã€‚","like_count":2},{"had_liked":false,"id":314234,"user_name":"æ…•è¨€","can_delete":false,"product_type":"c1","uid":2731028,"ip_address":"","ucode":"4918FA682F3895","user_header":"https://static001.geekbang.org/account/avatar/00/29/ac/14/a8ff8fec.jpg","comment_is_top":false,"comment_ctime":1632907972,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5927875268","product_id":100039001,"comment_content":"æˆ‘é’ˆå¯¹æ¡ˆä¾‹ä¸­4ã€5ã€6ä¸‰ä¸ªæµ‹è¯•ç”¨ä¾‹ç¼–å†™çš„æµ‹è¯•ä»£ç ï¼š<br>public class TransactionTest {<br>    @Test<br>    public void testExecute_with_TransactionExecuted() throws InvalidTransactionException {<br>        Transaction t = new Transaction(null, 123L, 234L, 345L, &quot;567&quot;, (double)89) {<br>            @Override<br>            protected boolean isExecuted() {<br>                return true;<br>            }<br>        };<br>        WalletRpcService wallet = new WalletRpcService();<br>        t.setWalletRpcService(wallet);<br>        TransactionLock lock = new TransactionLock();<br>        t.setTransactionLock(lock);<br>        boolean result = t.execute();<br>        Assert.assertTrue(result);<br>    }<br><br>    @Test<br>    public void testExecute_with_TransactionMoveFailed() throws InvalidTransactionException {<br>        Transaction t = new Transaction(null, 123L, 234L, 345L, &quot;567&quot;, (double)89);<br>        WalletRpcService wallet = new WalletRpcService() {<br>            @Override<br>            public String moveMoney(String id, Long buyerId, Long sellerId, Double amount) {<br>                return null;<br>            }<br>        };<br>        t.setWalletRpcService(wallet);<br>        TransactionLock lock = new TransactionLock();<br>        t.setTransactionLock(lock);<br>        boolean result = t.execute();<br>        Assert.assertFalse(result);<br>        Assert.assertEquals(Status.FAILED, t.getStatus());<br>    }<br><br>    @Test<br>    public void testExecute_with_TransactionExecuting() throws InvalidTransactionException {<br>        Transaction t = new Transaction(null, 123L, 234L, 345L, &quot;567&quot;, (double)89);<br>        WalletRpcService wallet = new WalletRpcService();<br>        t.setWalletRpcService(wallet);<br>        TransactionLock lock = new TransactionLock() {<br>            @Override<br>            public boolean lock(String id) {<br>                return false;<br>            }<br>        };<br>        t.setTransactionLock(lock);<br>        boolean result = t.execute();<br>        Assert.assertFalse(result);<br>    }<br>}","like_count":1},{"had_liked":false,"id":270641,"user_name":"JRich","can_delete":false,"product_type":"c1","uid":1114901,"ip_address":"","ucode":"66AE9D61533960","user_header":"https://static001.geekbang.org/account/avatar/00/11/03/15/293a185d.jpg","comment_is_top":false,"comment_ctime":1609203500,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5904170796","product_id":100039001,"comment_content":"å¦‚æœä¾èµ–æ³¨å…¥æ˜¯ç”¨springçš„autowireæ³¨è§£ï¼Œæ²¡æœ‰setteræ–¹æ³•ï¼Œè¯¥æ€ä¹ˆå»ç”¨mockå¯¹è±¡æ›¿æ¢å‘¢","like_count":1,"discussions":[{"author":{"id":1095136,"avatar":"https://static001.geekbang.org/account/avatar/00/10/b5/e0/fc3ac264.jpg","nickname":"stronger.","note":"","ucode":"AD0F2BE338824C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":408808,"discussion_content":"springå»ºè®®é€šè¿‡æ„é€ å™¨æ³¨å…¥ï¼Œè€Œä¸æ˜¯å±æ€§æ³¨å…¥","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1635326562,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2588697,"avatar":"https://static001.geekbang.org/account/avatar/00/27/80/19/ac06db0b.jpg","nickname":"New","note":"","ucode":"406DF65BD05FAA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372893,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620490470,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":184421,"user_name":"xk_","can_delete":false,"product_type":"c1","uid":1514305,"ip_address":"","ucode":"DFE1AC38EA78A7","user_header":"https://static001.geekbang.org/account/avatar/00/17/1b/41/dbb7d785.jpg","comment_is_top":false,"comment_ctime":1583311840,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5878279136","product_id":100039001,"comment_content":"æˆ‘æœ‰ç”¨è¿‡mockæ¡†æ¶ï¼Œä¹Ÿå†™è¿‡å¾ˆå¤šå¤æ‚çš„å•å…ƒæµ‹è¯•ã€‚ç°åœ¨æµ‹è¯•æ¡†æ¶å¥½å¼ºå¤§ï¼Œå„ç§mockï¼Œé™æ€æ–¹æ³•ï¼Œä»£ç ä¸­æ³¨å…¥è‡ªå®šä¹‰å¯¹è±¡â€¦<br>è¯´ä¸€ä¸‹æˆ‘å¯¹æ€è€ƒé¢˜çš„çœ‹æ³•ï¼š<br>1.ç”Ÿæˆidä¸ç”¨è¦†ç›–ï¼Œå› ä¸ºæ²¡æœ‰æµ‹è¯•çš„ç‚¹ã€‚å¦‚æœç¡¬è¦æµ‹è¯•çš„è¯è¦å•ç‹¬æµ‹è¯•è¿™ä¸ªæ–¹æ³•ï¼Œä¸è¿‡è¦å†™ç”Ÿæˆè¿™ä¸ªæ–¹æ³•çš„å•å…ƒæµ‹è¯•å¯èƒ½ä¼šéå¸¸å¤æ‚ã€‚è¶Šç®€å•çš„ï¼ŒåŸºç¡€çš„æ–¹æ³•è¶Šéš¾æµ‹ã€‚<br>2.å¦‚æœæ²¡æœ‰äº‰å“¥è¯´çš„é‚£äº”ç§æƒ…å†µï¼Œå…¶å®åœ¨å“ªé‡Œåˆ›å»ºå¯¹è±¡éƒ½å¥½æµ‹è¯•ï¼Œæœ€éš¾æµ‹çš„äº”ç§æƒ…å†µéƒ½åœ¨æ–‡ç« ä¸­äº†ã€‚","like_count":1},{"had_liked":false,"id":173126,"user_name":"è½å¶é£é€çš„æ‹","can_delete":false,"product_type":"c1","uid":1046429,"ip_address":"","ucode":"F9A95DB28BCF1E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f7/9d/be04b331.jpg","comment_is_top":false,"comment_ctime":1579428727,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5874396023","product_id":100039001,"comment_content":"IdGenerator.generateTransactionId()æœ¬èº«å°±æ˜¯äº§ç”Ÿéšæœºæ•°çš„ï¼Œå¯¹æµ‹è¯•æµç¨‹ä¸å½±å“","like_count":1},{"had_liked":false,"id":171373,"user_name":"Walker Jiang","can_delete":false,"product_type":"c1","uid":1023818,"ip_address":"","ucode":"92AE855D428917","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9f/4a/f5b8c6b3.jpg","comment_is_top":false,"comment_ctime":1578911540,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5873878836","product_id":100039001,"comment_content":"æ”¶è·å¾ˆå¤šï¼Œè¦æ˜¯æ–‡ç« ç»“å°¾æœ‰ä¸ªå®Œæ•´ä»£ç å°±æ›´å¥½äº†ï¼Œä¸ç„¶ç°åœ¨è¿˜å¾—ä¸€ç‚¹ç‚¹å»å¤åˆ¶æ‰èƒ½çœ‹åˆ°å…¨è²Œã€‚","like_count":1},{"had_liked":false,"id":170841,"user_name":"é¥­ç²’","can_delete":false,"product_type":"c1","uid":1153455,"ip_address":"","ucode":"4C3220B0D43997","user_header":"https://static001.geekbang.org/account/avatar/00/11/99/af/d29273e2.jpg","comment_is_top":false,"comment_ctime":1578737956,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5873705252","product_id":100039001,"comment_content":"è¯»å®Œè¿™ç¯‡æ„Ÿè§‰ä¸€ä¸‹å°±è®¤è¯†äº†ä»£ç çš„å¯æµ‹è¯•æ€§ã€‚ä¾èµ–æ³¨å…¥æé«˜ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Œé‚£ spring é‡Œæ¨èä½¿ç”¨ setter æ–¹æ³•å½¢å¼çš„ @autowired æ³¨å…¥ bean æ›´å¥½å“ã€‚<br>ç„¶åæˆ‘è®¤ä¸º IdGenerator.generateTransactionId() ä¸éœ€è¦ mockï¼Œå®ƒçš„åŠŸèƒ½åº”è¯¥å°±æ˜¯ç”Ÿæˆä¸€ä¸ªå…¨å±€å”¯ä¸€çš„ idï¼Œå¯¹ Transaction   è€Œè¨€åŠŸèƒ½ç®€å•ï¼Œä¸å½±å“æµ‹è¯•æ€§ï¼Œæœ¬èº«çš„å®ç°é€»è¾‘ä¸åœ¨ Transaction  æµ‹è¯•ã€‚","like_count":1},{"had_liked":false,"id":170533,"user_name":"çŸ³ä»”","can_delete":false,"product_type":"c1","uid":1177921,"ip_address":"","ucode":"974E4604CE2213","user_header":"https://static001.geekbang.org/account/avatar/00/11/f9/41/411b1753.jpg","comment_is_top":false,"comment_ctime":1578627542,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5873594838","product_id":100039001,"comment_content":"ç»§ç»­ä¼˜åŒ–Demo:<br>public class Demo {<br>    private long currentTimestamp;<br>    private long dueTimestamp;<br>    private long delayDays;<br><br>    public Demo(long currentTimestamp, long dueTimestamp) {<br>        this.currentTimestamp = currentTimestamp;<br>        this.dueTimestamp = dueTimestamp;<br>        this.delayDays = (this.currentTimestamp - this.dueTimestamp) &#47; 86400;<br>    }<br><br>    &#47;**<br>     * è®¡ç®—å»¶è¿Ÿå¤©æ•°<br>     *<br>     * @return<br>     *&#47;<br>    public long caculateDelayDays() {<br>        if (!isDelayDays()) {<br>            return 0;<br>        }<br>        return delayDays;<br>    }<br><br>    &#47;**<br>     * æ˜¯å¦å»¶è¿Ÿ<br>     *<br>     * @return<br>     *&#47;<br>    public boolean isDelayDays() {<br>        if (this.delayDays &lt;= 0) {<br>            return false;<br>        }<br>        return true;<br>    }<br>}","like_count":1},{"had_liked":false,"id":169988,"user_name":"å†è§å­™æ‚Ÿç©º","can_delete":false,"product_type":"c1","uid":1025518,"ip_address":"","ucode":"57E12A2F9CD915","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a5/ee/6bbac848.jpg","comment_is_top":false,"comment_ctime":1578489306,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5873456602","product_id":100039001,"comment_content":"ä»Šå¤©è€å¸ˆè®²çš„ä¸ºäº†æ›´å¥½çš„å•å…ƒæµ‹è¯•è€Œè¿›è¡Œçš„é‡æ„ï¼ŒåŸæ¥å·¥ä½œä¸­æ— å½¢é—´å·²ç»ç”¨åˆ°äº†ã€‚åœ¨å¯¹æ¥ä¸‰æ–¹ api æ—¶ï¼Œæœ‰æ—¶å€™ç¼ºå°‘å¿…è¦çš„å‚æ•°ä¿¡æ¯ï¼Œæˆ‘ä»¬åªèƒ½æ¨¡æ‹Ÿè°ƒé€šï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±å†™ä¸€ä¸ªç±»ç»§æ‰¿åŸå§‹ç±»ï¼Œé‡å†™åŸæ–¹æ³•ï¼Œè¿”å›è‡ªå·±éœ€è¦çš„æ•°æ®ï¼Œä¸è¿‡è¿˜æœ‰å¾ˆå¤šåšçš„ä¸è¶³ï¼Œä¾‹å¦‚å¯¹äºä¸ç¡®å®šæ•°æ®çš„mock æ²¡æœ‰æŠ½æˆæ–¹æ³•ç­‰ï¼ŒæŒç»­å­¦ä¹ ï¼Œè€å¸ˆæ£’ï¼","like_count":1},{"had_liked":false,"id":169793,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1578447537,"is_pvip":false,"replies":[{"id":"65943","content":"â€ä»£ç ç»“æ„æ‰å¹³åŒ–çš„æç«¯ç»“æœâ€œèƒ½ä¸¾ä¸ªä¾‹å­å—ï¼Ÿ","user_name":"ä½œè€…å›å¤","comment_id":169793,"uid":"1190123","ip_address":"","utype":1,"ctime":1578489044,"user_name_real":"ç‹äº‰"}],"discussion_count":2,"race_medal":0,"score":"5873414833","product_id":100039001,"comment_content":"æƒ³åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œä»£ç ç»“æ„æ‰å¹³åŒ–çš„æç«¯ç»“æœå¯èƒ½ä¼šé€ æˆä¾èµ–å¯¹è±¡è¿‡å¤šå—ï¼Ÿè¿™ç§æƒ…å†µmockä¸æ˜¯ä¾ç„¶éš¾æå—","like_count":1,"discussions":[{"author":{"id":1190123,"avatar":"https://static001.geekbang.org/account/avatar/00/12/28/eb/af064421.jpg","nickname":"ç‹äº‰","note":"","ucode":"2B611BE0E0EDD4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480722,"discussion_content":"â€ä»£ç ç»“æ„æ‰å¹³åŒ–çš„æç«¯ç»“æœâ€œèƒ½ä¸¾ä¸ªä¾‹å­å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578489044,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1444122,"avatar":"https://static001.geekbang.org/account/avatar/00/16/09/1a/e0f95684.jpg","nickname":"ç©ºç©º","note":"","ucode":"8F6EFE5A6F6F64","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":173281,"discussion_content":"å¦‚æœæç«¯æ‰å¹³ï¼Œæˆ‘çš„ç†è§£ä¼šå‡ºç°fan-out é—®é¢˜ï¼Œæ‰€ä»¥ç»„åˆå’Œç»§æ‰¿çš„ä½¿ç”¨è¿˜æ˜¯è¦è§†åœºæ™¯è€Œå®š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581843917,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337585,"user_name":"åƒé”¤ç™¾ç‚¼é¢†æ‚Ÿä¹‹æé™","can_delete":false,"product_type":"c1","uid":1744257,"ip_address":"","ucode":"224B5CF2101716","user_header":"https://static001.geekbang.org/account/avatar/00/1a/9d/81/d748b7eb.jpg","comment_is_top":false,"comment_ctime":1646904126,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646904126","product_id":100039001,"comment_content":"é‡æ„ä¹‹åçš„fillTransactionIdå‡½æ•°ï¼Œè¿”å›idä¸æ˜¯æ›´å¥½å—ï¼Œè€Œä¸æ˜¯åœ¨å‡½æ•°å†…éƒ¨èµ‹å€¼ç»™this.id<br><br>ä¾‹å¦‚:<br>  public Transaction(String preAssignedId, Long buyerId, Long sellerId, Long productId, String orderId) {<br>    &#47;&#47;...<br>    this.id = fillTransactionId(preAssignId);<br>    &#47;&#47;...<br>  }<br>  <br>  protected void fillTransactionId(String preAssignedId) {<br>    if (preAssignedId != null &amp;&amp; !preAssignedId.isEmpty()) {<br>      id = preAssignedId;<br>    } else {<br>      id = IdGenerator.generateTransactionId();<br>    }<br>    if (!id.startWith(&quot;t_&quot;)) {<br>      id = &quot;t_&quot; + preAssignedId;<br>    }<br>    return id;<br>  }","like_count":0},{"had_liked":false,"id":330936,"user_name":"ä½ å¥½æ—…è¡Œè€…","can_delete":false,"product_type":"c1","uid":1154101,"ip_address":"","ucode":"5C72A428DC28F3","user_header":"https://static001.geekbang.org/account/avatar/00/11/9c/35/9dc79371.jpg","comment_is_top":false,"comment_ctime":1642312961,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1642312961","product_id":100039001,"comment_content":"å…³äºç¬¬äºŒä¸ªé—®é¢˜ï¼Œè°œåº•å°±åœ¨è°œé¢ä¸Šï¼Œä¸å½±å“ä»£ç å¯æµ‹è¯•æ€§çš„ç±»å°±å¯ä»¥åœ¨ç±»çš„å†…éƒ¨åˆ›å»ºã€‚","like_count":0},{"had_liked":false,"id":324222,"user_name":"å‹","can_delete":false,"product_type":"c1","uid":2536820,"ip_address":"","ucode":"972A4333A8B101","user_header":"https://static001.geekbang.org/account/avatar/00/26/b5/74/cd80b9f4.jpg","comment_is_top":false,"comment_ctime":1638343339,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638343339","product_id":100039001,"comment_content":"å…³äºæµ‹è¯• statusçš„ä»£ç  å¯ä»¥æƒ³ timeä¸€æ ·å¤„ç†ã€‚æµ‹è¯•äº¤æ˜“ä¸­çš„ä»£ç  ç”±äºæˆ‘ç”¨çš„æ˜¯go  æˆ‘ä¼šå¼€ä¸€ä¸ªåç¨‹å»æ¨¡æ‹Ÿ","like_count":0},{"had_liked":false,"id":315307,"user_name":"charmsongo","can_delete":false,"product_type":"c1","uid":1609051,"ip_address":"","ucode":"4FBEE716E93A1A","user_header":"https://static001.geekbang.org/account/avatar/00/18/8d/5b/383a49e4.jpg","comment_is_top":false,"comment_ctime":1633824470,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633824470","product_id":100039001,"comment_content":"å¤–éƒ¨ä¾èµ–æ³¨å…¥å¯ä»¥æé«˜ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Œå°½é‡å°‘ç”¨æœªå†³ä»£ç ã€å…¨å±€å˜é‡ã€é™æ€å˜é‡ã€å¤æ‚çš„é›†æˆã€è€¦åˆåº¦é«˜çš„ä»£ç ","like_count":0},{"had_liked":false,"id":303078,"user_name":"å¸ƒæ‹‰å§†","can_delete":false,"product_type":"c1","uid":1311125,"ip_address":"","ucode":"479FF27D73BCAD","user_header":"https://static001.geekbang.org/account/avatar/00/14/01/95/fd09e8a8.jpg","comment_is_top":false,"comment_ctime":1626579764,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1626579764","product_id":100039001,"comment_content":"ä¸ä¾èµ–å¤–éƒ¨æœåŠ¡çš„ç±»å°±å¯ä»¥å†…éƒ¨åˆ›å»ºï¼Œæ¯”å¦‚ String","like_count":1},{"had_liked":false,"id":297549,"user_name":"æ±Ÿå—ä¸€ç¬‘","can_delete":false,"product_type":"c1","uid":2234620,"ip_address":"","ucode":"E38938A1178827","user_header":"https://static001.geekbang.org/account/avatar/00/22/18/fc/4f92ee4e.jpg","comment_is_top":false,"comment_ctime":1623619037,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1623619037","product_id":100039001,"comment_content":"ä¸€ä¸ªç–‘é—®ï¼šä¿®æ”¹å‰ï¼ŒTransactionçš„è°ƒç”¨è€…ä¸éœ€è¦çŸ¥é“ WalletRpcServiceï¼Œ å°±å¯ä»¥ç›´æ¥è°ƒç”¨Transactionï¼Œæ›´ç¬¦åˆ least knowledge åŸåˆ™ã€‚ç°åœ¨ä¸ºäº†æé«˜å¯æµ‹è¯•æ€§ï¼Œè°ƒç”¨è€…éœ€è¦å…ˆåˆ›å»º WalletRpcService å¯¹è±¡ï¼Œå†é€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼è°ƒç”¨ Transactionå¯¹è±¡ã€‚è¿™æ ·å¯¹ Transactionçš„è°ƒç”¨è€…æ˜¯å¦å‹å¥½ï¼Ÿ","like_count":0},{"had_liked":false,"id":296919,"user_name":"ç¼–å·","can_delete":false,"product_type":"c1","uid":1037836,"ip_address":"","ucode":"1633A363592A1A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d6/0c/df0d5152.jpg","comment_is_top":false,"comment_ctime":1623224706,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1623224706","product_id":100039001,"comment_content":"äº‰å“¥ï¼Œprivate static AtomicInteger position = new AtomicInteger(0)è¿™ç§é™æ€å…¨å±€å˜é‡è¦æ€ä¹ˆæµ‹è¯•å‘¢ï¼Œæˆ–è€…ä»£ç è¦æ€ä¹ˆé‡æ„å•Š","like_count":0},{"had_liked":false,"id":296539,"user_name":"if...else...","can_delete":false,"product_type":"c1","uid":2550743,"ip_address":"","ucode":"D0565908C99695","user_header":"https://static001.geekbang.org/account/avatar/00/26/eb/d7/90391376.jpg","comment_is_top":false,"comment_ctime":1623034440,"is_pvip":false,"discussion_count":0,"race_medal":4,"score":"1623034440","product_id":100039001,"comment_content":"å¹²è´§","like_count":0},{"had_liked":false,"id":292451,"user_name":"JKwar","can_delete":false,"product_type":"c1","uid":1047466,"ip_address":"","ucode":"B733CA24D5701F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fb/aa/01fedf6c.jpg","comment_is_top":false,"comment_ctime":1620827157,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1620827157","product_id":100039001,"comment_content":"æ€è€ƒé¢˜1ï¼šä¸ä¼šã€‚void fillTransactionId(String preAssignedId) å‡½æ•°æœ¬èº«å°±æ˜¯ä¸€ä¸ªidç”Ÿæˆå™¨ï¼Œå¦‚æœä¼ å…¥çš„idä¸ºç©ºï¼Œå°±é€šè¿‡ IdGenerator.generateTransactionId() ç”Ÿæˆä¸€ä¸ªidã€‚<br>æ€è€ƒé¢˜2ï¼šä¸ä¾èµ–å¤–éƒ¨æœåŠ¡çš„ç±»ï¼Œæä¾›æ–¹æ³•çš„ç±»å¯ä»¥ newï¼Œæ¯”å¦‚è¯´ Service ç±»å°±å¯ä»¥åœ¨å†…éƒ¨åˆ›å»ºå¹¶ä¸”ä¸å½±å“ä»£ç çš„å¯æµ‹è¯•æ€§","like_count":0},{"had_liked":false,"id":289060,"user_name":"åæ‰§","can_delete":false,"product_type":"c1","uid":1304576,"ip_address":"","ucode":"B397172D654C92","user_header":"https://static001.geekbang.org/account/avatar/00/13/e8/00/f94bb1c5.jpg","comment_is_top":false,"comment_ctime":1618836600,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618836600","product_id":100039001,"comment_content":"æœ‰ä¸€ä¸ªç–‘æƒ‘ï¼Œé™æ€æ–¹æ³•mockéš¾åœ¨å“ªé‡Œï¼Ÿ <br>1. Javaé‡ŒPowerMockæä¾›äº†é™æ€æ–¹æ³•çš„mockæ–¹å¼ã€‚<br>2. Pythoné‡Œå¯ä»¥ä½¿ç”¨mock.patch(&#39;your.package.module.Classs.func&#39;)çš„æ–¹å¼mock<br>å¯ä»¥æä¾›ä¸€ä¸ªå®ä¾‹è¯´æ˜staticæ–¹æ³•çš„éš¾å¤„åœ¨å“ªé‡Œå—ï¼Ÿ<br>","like_count":0},{"had_liked":false,"id":288501,"user_name":"JoeyforJoy","can_delete":false,"product_type":"c1","uid":1466467,"ip_address":"","ucode":"5598501E71D35D","user_header":"https://static001.geekbang.org/account/avatar/00/16/60/63/d2c91e2b.jpg","comment_is_top":false,"comment_ctime":1618493728,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618493728","product_id":100039001,"comment_content":"ä¾èµ–æ³¨å…¥æ˜¯æé«˜ä»£ç å¯æµ‹è¯•æ€§çš„æœ‰æ•ˆæ‰‹æ®µã€‚å…·ä½“ä¾‹å­å¯ä»¥å‚è€ƒmockçš„å®ç°","like_count":0},{"had_liked":false,"id":287236,"user_name":"Spoon","can_delete":false,"product_type":"c1","uid":1959822,"ip_address":"","ucode":"2FF9193AD482C2","user_header":"https://static001.geekbang.org/account/avatar/00/1d/e7/8e/318cfde0.jpg","comment_is_top":false,"comment_ctime":1617850812,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617850812","product_id":100039001,"comment_content":"çœŸçš„æ˜¯æ”¶è·æ»¡æ»¡","like_count":0},{"had_liked":false,"id":285872,"user_name":"Geek_86eac6","can_delete":false,"product_type":"c1","uid":1787022,"ip_address":"","ucode":"8C02E398CC6A35","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI4CBQHuLDWOdicOl1elTdSicqMyY1s5JDWXiaHsSk0VSWaVe0U6CTo701ZGz9h6MvibsAGKnvVq7xxFw/132","comment_is_top":false,"comment_ctime":1617061941,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617061941","product_id":100039001,"comment_content":"é¢˜ç›®1ï¼Œè¿™æ®µä»£ç ä¸å½±å“æ•´ä½“é€»è¾‘ï¼Œæ‰€ä»¥ä¸éœ€è¦mock","like_count":0},{"had_liked":false,"id":270989,"user_name":"éš†éš†.ago","can_delete":false,"product_type":"c1","uid":1710528,"ip_address":"","ucode":"9EFE43F0A2C6BB","user_header":"https://static001.geekbang.org/account/avatar/00/1a/19/c0/693b946f.jpg","comment_is_top":false,"comment_ctime":1609340050,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609340050","product_id":100039001,"comment_content":"1. IDç”Ÿæˆå™¨æœ¬èº«å¾ˆç®€å•ï¼Œä¸éœ€è¦mockã€‚æµ‹è¯•fillTransactionIdåŠŸèƒ½å·²ç»å¾ˆç®€å•äº†ï¼Œé€ ä¸€ä¸ªidä¼ è¿›å»æˆ–è€…ä¸€ä¸ªç©ºidä¼ è¿›å»æµ‹è¯•ï¼Œä¸éœ€è¦å†mockç”ŸæˆIDã€‚<br>2. å¾ˆç¡®å®šè€Œç®€å•çš„ï¼Œä¸ä¾èµ–å¤–éƒ¨çš„æœåŠ¡å¯ä»¥newã€‚æä¾›ç‰¹å®šå±æ€§çš„modelè¿™äº›å¯ä»¥newã€‚æ¯”å¦‚å°è£…å„ç§IDçš„ä¸€ä¸ªè´«è¡€æ•°æ®ç±»","like_count":0},{"had_liked":false,"id":266227,"user_name":"çªå›´","can_delete":false,"product_type":"c1","uid":1090414,"ip_address":"","ucode":"03E865CC8A6F2A","user_header":"https://static001.geekbang.org/account/avatar/00/10/a3/6e/52580973.jpg","comment_is_top":false,"comment_ctime":1607246333,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607246333","product_id":100039001,"comment_content":"å•å…ƒæµ‹è¯•å¤ªéš¾æ¨äº†ï¼Œæˆ‘ä»¬å…¬å¸é¡¹ç›®å•æµ‹è¦†ç›–ç‡èƒ½åˆ°è¾¾30%å°±ä¸é”™äº†","like_count":0},{"had_liked":false,"id":265912,"user_name":"ç‹¼è¡Œå¤©ä¸‹","can_delete":false,"product_type":"c1","uid":1053161,"ip_address":"","ucode":"A3F22B276B88B1","user_header":"https://static001.geekbang.org/account/avatar/00/10/11/e9/13f28df2.jpg","comment_is_top":false,"comment_ctime":1607067239,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607067239","product_id":100039001,"comment_content":"æ€è€ƒé¢˜1ï¼šçœ‹è¯¥æ–¹æ³•æ˜¯å¦æœ‰ä¾èµ–å…¶å®ƒç»„ä»¶ï¼Œå¦‚æœæ˜¯æœ¬æœºç”Ÿæˆç®—æ³•ï¼Œå¯ä»¥ä¸ç”¨mockï¼›<br>æ€è€ƒé¢˜2ï¼šmodelå¯¹è±¡å¯ä»¥ä¸ç”¨å¤–éƒ¨ä¼ å…¥ï¼›","like_count":0},{"had_liked":false,"id":254938,"user_name":"erDuo","can_delete":false,"product_type":"c1","uid":1016135,"ip_address":"","ucode":"691E716E6D0E39","user_header":"https://static001.geekbang.org/account/avatar/00/0f/81/47/e5b206d9.jpg","comment_is_top":false,"comment_ctime":1603237897,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603237897","product_id":100039001,"comment_content":"å¤§èµï¼Œé©¬ä¸Šå›å»é‡æ„","like_count":0},{"had_liked":false,"id":250607,"user_name":"ä¸€å°¾","can_delete":false,"product_type":"c1","uid":1517556,"ip_address":"","ucode":"67D404036231D1","user_header":"https://static001.geekbang.org/account/avatar/00/17/27/f4/a1ce6248.jpg","comment_is_top":false,"comment_ctime":1601169921,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601169921","product_id":100039001,"comment_content":"æ„Ÿè°¢ï¼Œè¿™èŠ‚è¯¾éƒ½æ˜¯å¹²è´§","like_count":0},{"had_liked":false,"id":250013,"user_name":"David","can_delete":false,"product_type":"c1","uid":1021825,"ip_address":"","ucode":"22CBBC13FC97A9","user_header":"https://static001.geekbang.org/account/avatar/00/0f/97/81/e1eaf621.jpg","comment_is_top":false,"comment_ctime":1600905491,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1600905491","product_id":100039001,"comment_content":"1. idç”Ÿæˆé€»è¾‘ç®€å• æˆ‘è®¤ä¸ºä¸ç”¨mock<br>2. æ³¨å…¥ä¼˜äºnew","like_count":0},{"had_liked":false,"id":249688,"user_name":"Younger Ku","can_delete":false,"product_type":"c1","uid":1323102,"ip_address":"","ucode":"D157DC38BDB515","user_header":"https://static001.geekbang.org/account/avatar/00/14/30/5e/c42bc33f.jpg","comment_is_top":false,"comment_ctime":1600762086,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1600762086","product_id":100039001,"comment_content":"1ã€IdGenerator.generateTransactionId()åªæ˜¯ä¸€ä¸ªç”Ÿæˆäº¤æ˜“IDçš„é™æ€æ–¹æ³•ï¼Œå¦‚æœéœ€è¦ä¾èµ–å¤–éƒ¨ç³»ç»Ÿæˆ–è€…ä¸å¯æ§ç»„ä»¶å°±éœ€è¦å•ç‹¬mockã€‚å¦‚æœä»…ä»…æ˜¯ç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²åˆ™ä¸éœ€è¦mockã€‚å½“ç„¶ï¼Œå¦‚æœäº¤æ˜“IDæœ‰é¢„è®¾çš„ç”Ÿæˆè§„åˆ™ï¼Œå¯èƒ½ä¹Ÿéœ€è¦å•ç‹¬å¯¹ç”Ÿæˆè§„åˆ™è¿›è¡Œæµ‹è¯•ã€‚<br>2ã€å¦‚æœè¦ç”¨åˆ°çš„ç±»ä¸­çš„æ–¹æ³•ä¸ä¼šäº§ç”Ÿæœªå†³è¡Œä¸ºã€å¹¶ä¸”æ²¡æœ‰ä¾èµ–å¤–éƒ¨ç³»ç»ŸåŠä¸å¯æ§ç»„ä»¶ï¼Œå¯¹å•å…ƒæµ‹è¯•æ²¡æœ‰å½±å“ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥newå‡ºæ¥ã€‚","like_count":0},{"had_liked":false,"id":247316,"user_name":"JerryZhu","can_delete":false,"product_type":"c1","uid":1591223,"ip_address":"","ucode":"76850CD45786C1","user_header":"https://static001.geekbang.org/account/avatar/00/18/47/b7/b30472fd.jpg","comment_is_top":false,"comment_ctime":1599657634,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599657634","product_id":100039001,"comment_content":"çœŸæ˜¯å†™äº†6å¹´çš„ä»£ç ã€‚ã€‚ å¾ˆå°‘å†™å•å…ƒæµ‹è¯•ï¼Œ æƒ­æ„§è‡³æäº†","like_count":1},{"had_liked":false,"id":246758,"user_name":"å®‡å¤©é£","can_delete":false,"product_type":"c1","uid":1126444,"ip_address":"","ucode":"3FB37D1E2DAA61","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/2c/06375913.jpg","comment_is_top":false,"comment_ctime":1599470858,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1599470858","product_id":100039001,"comment_content":"é—®é¢˜1ï¼š<br>1ã€ä¸ä¼šå½±å“ã€‚å‡½æ•°æ¯”è¾ƒç®€å•ï¼Œå¾ˆå¿«è¿”å›ï¼Œä¸ä¼šæœ‰å¤ªå¤šä¾èµ–<br>é—®é¢˜2ï¼š<br>1ã€éä¸šåŠ¡é€»è¾‘ä¸Šçš„å¯¹è±¡å¯ä»¥æ–°å»ºï¼Œä¸å½±å“ä¸šåŠ¡é€»è¾‘èµ°å‘çš„","like_count":0},{"had_liked":false,"id":245616,"user_name":"å¤§é›å°é±¼","can_delete":false,"product_type":"c1","uid":1101017,"ip_address":"","ucode":"44090581E59FDA","user_header":"https://static001.geekbang.org/account/avatar/00/10/cc/d9/20d4f7c2.jpg","comment_is_top":false,"comment_ctime":1599009514,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599009514","product_id":100039001,"comment_content":"æˆ‘ï¼šè¿™æ®µä»£ç ä¸å¤ªå¥½å†™å•å…ƒæµ‹è¯•ä¸å¥½ï¼Œéœ€è¦é‡å†™ã€‚<br>åˆ«äººï¼šä½ æœ‰ç—…å§ï¼Œæ˜¯ä½ è‡ªå·±èƒ½åŠ›ä¸è¡Œï¼Œä¸ä¼šå†™å•å…ƒæµ‹è¯•å§ã€‚<br>æˆ‘ï¼šâ€¦â€¦","like_count":0},{"had_liked":false,"id":244580,"user_name":"è›€ç‰™","can_delete":false,"product_type":"c1","uid":1153349,"ip_address":"","ucode":"F765A67DFEADFD","user_header":"","comment_is_top":false,"comment_ctime":1598585428,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598585428","product_id":100039001,"comment_content":"æ€è€ƒé¢˜1ï¼š æˆ‘è§‰å¾—éœ€è¦é‡å†™ï¼Œå› ä¸ºåœ¨unit testé‡Œä¹Ÿéœ€è¦éªŒè¯idæ˜¯å¦è¢«æ­£ç¡®çš„filläº†ï¼Œä¸€ä¸ªdeterministicçš„id generator ä¼šæ–¹ä¾¿testéªŒè¯","like_count":0},{"had_liked":false,"id":244192,"user_name":"Mew151","can_delete":false,"product_type":"c1","uid":1002201,"ip_address":"","ucode":"D4793F5874F345","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4a/d9/75dd7cf9.jpg","comment_is_top":false,"comment_ctime":1598423602,"is_pvip":false,"replies":[{"id":"90138","content":"ä½ æŒ‡çš„å¤„ç†ä»€ä¹ˆå‘¢ï¼Ÿ","user_name":"ä½œè€…å›å¤","comment_id":244192,"uid":"1190123","ip_address":"","utype":1,"ctime":1598834236,"user_name_real":"ç‹äº‰"}],"discussion_count":1,"race_medal":0,"score":"1598423602","product_id":100039001,"comment_content":"æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæµ‹è¯•æ–¹æ³•A()ä¸­è°ƒç”¨äº†æœ¬ç±»çš„ç§æœ‰æ–¹æ³•B()ï¼Œè¿™ä¸ªæ—¶å€™è¯¥æ€ä¹ˆå¤„ç†å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1190123,"avatar":"https://static001.geekbang.org/account/avatar/00/12/28/eb/af064421.jpg","nickname":"ç‹äº‰","note":"","ucode":"2B611BE0E0EDD4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":504514,"discussion_content":"ä½ æŒ‡çš„å¤„ç†ä»€ä¹ˆå‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598834236,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":233946,"user_name":"å¯çˆ±çš„é¥²å…»å‘˜","can_delete":false,"product_type":"c1","uid":1160213,"ip_address":"","ucode":"A5B6A4A4110E0C","user_header":"https://static001.geekbang.org/account/avatar/00/11/b4/15/2e6716d7.jpg","comment_is_top":false,"comment_ctime":1594526872,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594526872","product_id":100039001,"comment_content":"æ€è€ƒé¢˜1ï¼šçœ‹IdGenerator.generateTransactionId()çš„ç”Ÿæˆé€»è¾‘ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿé¿å…IDé‡å¤éƒ½ä¼šæŸ¥åº“ï¼Œå¦‚æœè¿™æ ·çš„è¯å°±è¦mockã€‚<br>æ€è€ƒé¢˜2ï¼šå®ç°ä¸šåŠ¡é€»è¾‘çš„è¦æ³¨å…¥ï¼Œåšæ•°æ®è½½ä½“çš„POJOè¦new","like_count":0},{"had_liked":false,"id":232356,"user_name":"å¤§æ–¹æ–¹","can_delete":false,"product_type":"c1","uid":1354013,"ip_address":"","ucode":"621AD8F1485753","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/6cyOoRd2dROgiblAJkW6RLhUyH1wwU0NNibIIuV930eQ9TiaNT41K61kBSVkvYoDYg7mJtuEoCQY1awBmV0WW6BFg/132","comment_is_top":false,"comment_ctime":1593964894,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593964894","product_id":100039001,"comment_content":"è¿™èŠ‚æ˜¯çœŸå¹²è´§ï¼Œ å®Œæ•´çš„æŠŠå‰é¢è®²è¿‡çš„è®¾è®¡æ¨¡å¼å’Œå•å…ƒæµ‹è¯•ç†è®ºåœ¨å®è·µä¸­æ­£å‘æ¿€åŠ±å¾ªç¯å±•ç¤ºå‡ºæ¥äº†ï¼Œè€Œä¸”ç¡®å®å­¦åˆ°äº†å®ç”¨æŠ€å·§ï¼Œèƒ½å¤Ÿåº”ç”¨åˆ°è‡ªå·±çš„ä»£ç é‡æ„ä¸­ï¼Œå¾ˆå®ç”¨ï¼Œè°¢è°¢ã€‚","like_count":0},{"had_liked":false,"id":230650,"user_name":"å…‹å°”è‹åŠ å¾·","can_delete":false,"product_type":"c1","uid":1459388,"ip_address":"","ucode":"E35A6DFA012F37","user_header":"https://static001.geekbang.org/account/avatar/00/16/44/bc/0bb265a7.jpg","comment_is_top":false,"comment_ctime":1593440276,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593440276","product_id":100039001,"comment_content":"å—ç›Šè‰¯å¤š","like_count":0},{"had_liked":false,"id":230599,"user_name":"YsnowLove","can_delete":false,"product_type":"c1","uid":1439301,"ip_address":"","ucode":"70433D98592481","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/rMgAbbKiasa1qR35ht0GEfwsHXbusPZAe9JFgicDgVRy8vQET2hypuDgwtHoPVU23RUoMdK7qA7gibMlTExpYibtbw/132","comment_is_top":false,"comment_ctime":1593426261,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593426261","product_id":100039001,"comment_content":"æ€»æ„Ÿè§‰executeæ–¹æ³•å¹¶å‘çš„æ—¶å€™å‡ºç°å¤šè½¬é’±çš„é—®é¢˜ï¼Œåˆ†å¸ƒå¼é”ï¼Œé”ä½çš„æ˜¯transactionIdï¼Œè€ŒtransactionIdæœ‰å¯èƒ½æ˜¯åœ¨executeæ–¹æ³•ç”Ÿæˆçš„ã€‚","like_count":0,"discussions":[{"author":{"id":1190123,"avatar":"https://static001.geekbang.org/account/avatar/00/12/28/eb/af064421.jpg","nickname":"ç‹äº‰","note":"","ucode":"2B611BE0E0EDD4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496959,"discussion_content":"https://github.com/wangzheng0822","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592527347,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1238185,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e4/a9/117fe480.jpg","nickname":"æˆ‘çš„å¿ƒé‡Œåªæœ‰å·¥ä½œ","note":"","ucode":"488DD6F9590EB8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291660,"discussion_content":"æ‰‹æœºç«¯ä¸è®©å¤åˆ¶ç²˜è´´ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594901795,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1113744,"avatar":"https://static001.geekbang.org/account/avatar/00/10/fe/90/19ef108d.jpg","nickname":"techwro","note":"","ucode":"7AF2B319F0AE1B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":278978,"discussion_content":"https://time.geekbang.org/column/article/80388","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591266833,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1045078,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f2/56/c39046c0.jpg","nickname":"Jie","note":"","ucode":"AB94041E548FEB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":277139,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591005431,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1286251,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a0/6b/0a21b2b8.jpg","nickname":"è¿·ç¾Š","note":"","ucode":"85AF8CED3436C8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":276961,"discussion_content":"åŒé—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590975281,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":226077,"user_name":"benxiong","can_delete":false,"product_type":"c1","uid":1624574,"ip_address":"","ucode":"F6498059D439D9","user_header":"https://static001.geekbang.org/account/avatar/00/18/c9/fe/874b172b.jpg","comment_is_top":false,"comment_ctime":1591947212,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591947212","product_id":100039001,"comment_content":"public class Demo { <br>    public long caculateDelayDays(Date dueTime) { <br>        long currentTimestamp = System.currentTimeMillis(); <br>        long delayTime = currentTimestamp - dueTime.getTime();<br>        if ( isDelayed(delayTime) ) {<br>            return delayTime &#47; 86400;<br>        } else {<br>            return 0;<br>        }<br>    }<br>    <br>    public boolean isDelayed(long delayTime) {<br>         return delayTime &gt; 0 ? true : false;<br>    }<br>}","like_count":0},{"had_liked":false,"id":225309,"user_name":"èŠ±èŠ±å¤§è„¸çŒ«","can_delete":false,"product_type":"c1","uid":1117318,"ip_address":"","ucode":"8ABDB3F7F4FB0F","user_header":"https://static001.geekbang.org/account/avatar/00/11/0c/86/8e52afb8.jpg","comment_is_top":false,"comment_ctime":1591711704,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1591711704","product_id":100039001,"comment_content":"1.æˆ‘è®¤ä¸ºä¸éœ€è¦ï¼Œå…¶å®å°±æ˜¯ç”Ÿæˆä¸ªIDï¼Œä¸šåŠ¡ä¸ç›¸å…³çš„<br>2.è´«è¡€å‹çš„è‡ªå®šä¹‰java pojoå¯¹è±¡ ","like_count":0},{"had_liked":false,"id":223901,"user_name":"è¿œæ–¹","can_delete":false,"product_type":"c1","uid":1064732,"ip_address":"","ucode":"244C74F9857196","user_header":"https://static001.geekbang.org/account/avatar/00/10/3f/1c/1e4dfbc9.jpg","comment_is_top":false,"comment_ctime":1591228687,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591228687","product_id":100039001,"comment_content":"æ…¢æ…¢å¹²è´§ï¼Œè¿™ä¸ªä¸“æ å®åœ¨æ˜¯å¤ªå€¼äº†","like_count":0},{"had_liked":false,"id":221424,"user_name":"æŠ€æœ¯éª¨å¹²","can_delete":false,"product_type":"c1","uid":1098720,"ip_address":"","ucode":"8FCF8DE6D29201","user_header":"https://static001.geekbang.org/account/avatar/00/10/c3/e0/3db22579.jpg","comment_is_top":false,"comment_ctime":1590497209,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590497209","product_id":100039001,"comment_content":"å¹²æ´»æ»¡æ»¡ï¼Œå­¦ä¸åŠ¨äº†ğŸ˜­ğŸ˜­ğŸ˜­ğŸ˜­","like_count":0},{"had_liked":false,"id":220987,"user_name":"buggetout","can_delete":false,"product_type":"c1","uid":1880582,"ip_address":"","ucode":"63A948EF415FDD","user_header":"https://static001.geekbang.org/account/avatar/00/1c/b2/06/2086d76d.jpg","comment_is_top":false,"comment_ctime":1590373081,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590373081","product_id":100039001,"comment_content":"è¿™ä¸ªTransactionç±»æ˜¯è´«è¡€æ¨¡å‹å—ï¼Ÿä¾èµ–äº†å¤–éƒ¨çš„service","like_count":0},{"had_liked":false,"id":220090,"user_name":"scmath","can_delete":false,"product_type":"c1","uid":1149022,"ip_address":"","ucode":"641023BB246C29","user_header":"https://static001.geekbang.org/account/avatar/00/11/88/5e/7c76f422.jpg","comment_is_top":false,"comment_ctime":1590152646,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590152646","product_id":100039001,"comment_content":"ä¸åœ¨ç±»å†…éƒ¨å®ä¾‹åŒ–å¤–éƒ¨ä¾èµ–ï¼Œè€Œæ˜¯åœ¨ç±»å¤–éƒ¨åˆ›å»ºå¥½å¯¹è±¡ä¼ å…¥æ„é€ å‡½æ•°æˆ–å‡½æ•°ã€‚<br>golangä¸­æ•°æ®å’Œæ–¹æ³•ä¸å…è®¸åˆ†ç¦»ï¼Œé€šè¿‡æ¥å£å‚æ•°ä¼ å…¥çš„å®ä¾‹åŒ–å¯¹è±¡åªèƒ½ä½¿ç”¨å…¶æ–¹æ³•ä¸èƒ½ç›´æ¥ä½¿ç”¨å¯¹è±¡çš„å®ä½“æ•°æ®ã€‚<br>Javaçš„springç”¨çš„æ˜¯æ•°æ®å’Œæ–¹æ³•åˆ†ç¦»ï¼Œå¼ºä¾èµ–æ•°æ®ï¼Œæ–¹æ³•ä¾èµ–æ¥å£å®ç°å¯æ‰©å±•ã€‚","like_count":0},{"had_liked":false,"id":215256,"user_name":"åˆ˜åŒé’","can_delete":false,"product_type":"c1","uid":1818343,"ip_address":"","ucode":"84B62DF8BC61FB","user_header":"","comment_is_top":false,"comment_ctime":1588942576,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1588942576","product_id":100039001,"comment_content":"ç­”é¢˜<br><br>1.ä¸éœ€è¦ã€‚å¤§å®¶ä¼¼ä¹éƒ½é—æ¼äº†ä¸€ä¸ªå…³é”®ç‚¹ï¼Œå•å…ƒæµ‹è¯•åªå…³æ³¨æ¥å£æˆ–è€…æ–¹æ³•çš„å®šä¹‰ï¼Œä¸è¦å…³æ³¨å®ç°é€»è¾‘ã€‚void fillTransactionId(String preAssignedId) çš„å®šä¹‰æ˜¯å¡«å……ä¸€ä¸ªidï¼Œå¦‚æœpreä¸ä¸ºç©ºåˆ™å¡«å……preï¼Œå¦åˆ™ä¸»åŠ¨ç”Ÿæˆä¸€ä¸ªidæ¥å¡«å……ã€‚æ‰€ä»¥å¯¹äºå®ƒçš„æµ‹è¯•ï¼Œå¹¶ä¸å…³æ³¨å¦‚ä½•ä¸»åŠ¨ç”Ÿæˆï¼Œè€Œæ˜¯å…³æ³¨èƒ½ä¸èƒ½ç”Ÿæˆã€‚è‡³äºç”Ÿæˆçš„å¯¹ä¸å¯¹ï¼Œé‚£æ˜¯è¿™ä¸ªç”Ÿæˆå™¨çš„å•å…ƒæµ‹è¯•åº”è¯¥å…³æ³¨çš„ã€‚<br><br><br>2.å’Œç¬¬ä¸€é¢˜ä¸€æ ·ï¼Œå’Œæ¥å£åŠŸèƒ½å®šä¹‰æ— å…³çš„å¯¹è±¡å¯ä»¥newï¼Œæœ‰å…³çš„é‚£å°±å¯èƒ½æ˜¯æµ‹è¯•ç‚¹äº†","like_count":0,"discussions":[{"author":{"id":1818343,"avatar":"","nickname":"åˆ˜åŒé’","note":"","ucode":"84B62DF8BC61FB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":261148,"discussion_content":"è¡¥å……ä¸€ä¸‹:\n\n1.å¦‚æœidç”Ÿæˆä¾èµ–ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼Œæ¯”å¦‚æ•°æ®åº“æˆ–è€…rpcï¼Œé‚£éœ€è¦mockï¼Œå¦åˆ™è¿è¡Œä¸äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588942879,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":210869,"user_name":"qpzm7903","can_delete":false,"product_type":"c1","uid":1138683,"ip_address":"","ucode":"C7C14962D34BE7","user_header":"https://static001.geekbang.org/account/avatar/00/11/5f/fb/af061ca7.jpg","comment_is_top":false,"comment_ctime":1587858200,"is_pvip":false,"replies":[{"id":"78763","content":"å•å…ƒæµ‹è¯•è·Ÿè´«ä¸è´«è¡€æ²¡å…³ç³»å§","user_name":"ä½œè€…å›å¤","comment_id":210869,"uid":"1190123","ip_address":"","utype":1,"ctime":1588042521,"user_name_real":"ç‹äº‰"}],"discussion_count":1,"race_medal":0,"score":"1587858200","product_id":100039001,"comment_content":"è¯·é—®è´«è¡€æ¨¡å¼çš„mvcä¸­çš„serviceæ€ä¹ˆè¿›è¡Œå•å…ƒæµ‹è¯•å‘¢","like_count":0,"discussions":[{"author":{"id":1190123,"avatar":"https://static001.geekbang.org/account/avatar/00/12/28/eb/af064421.jpg","nickname":"ç‹äº‰","note":"","ucode":"2B611BE0E0EDD4","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493135,"discussion_content":"å•å…ƒæµ‹è¯•è·Ÿè´«ä¸è´«è¡€æ²¡å…³ç³»å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588042521,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":208525,"user_name":"è¿›å‡»çš„å‰ç«¯er","can_delete":false,"product_type":"c1","uid":1506085,"ip_address":"","ucode":"9229B410F48B85","user_header":"https://static001.geekbang.org/account/avatar/00/16/fb/25/f6743e97.jpg","comment_is_top":false,"comment_ctime":1587375347,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587375347","product_id":100039001,"comment_content":"è¿™èŠ‚æ˜¯çœŸçš„çœ‹çš„çˆ½å•Šï¼ï¼","like_count":0},{"had_liked":false,"id":208390,"user_name":"ä¸‰å¹´è¿‡å","can_delete":false,"product_type":"c1","uid":1283157,"ip_address":"","ucode":"5E9106C5F11BED","user_header":"https://static001.geekbang.org/account/avatar/00/13/94/55/afc64956.jpg","comment_is_top":false,"comment_ctime":1587348848,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587348848","product_id":100039001,"comment_content":"æ€è€ƒé¢˜ï¼š<br>1ã€ID å‘å·å™¨ç¡®ä¿å”¯ä¸€å³å¯ã€‚å¯ä»¥ä¸ç”¨æµ‹è¯•<br>2ã€å……è¡€æ¨¡å‹çš„DDDä¸éœ€è¦ä¾èµ–æ³¨å…¥","like_count":0},{"had_liked":false,"id":207616,"user_name":"lanco","can_delete":false,"product_type":"c1","uid":1188352,"ip_address":"","ucode":"C24A0A8716C78C","user_header":"https://static001.geekbang.org/account/avatar/00/12/22/00/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1587119727,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587119727","product_id":100039001,"comment_content":"å¦‚æœä½ è§‰å¾—è¿™æ®µä»£ç çš„å•å…ƒæµ‹è¯•éå¸¸éš¾å†™ï¼Œé‚£ä½ éœ€è¦è€ƒè™‘ä¸€ä¸‹ä½ çš„ä»£ç äº†","like_count":0},{"had_liked":false,"id":205984,"user_name":"æ”¹åä¸æ¢äºº","can_delete":false,"product_type":"c1","uid":1118242,"ip_address":"","ucode":"7E25577829FA0F","user_header":"https://static001.geekbang.org/account/avatar/00/11/10/22/910f705c.jpg","comment_is_top":false,"comment_ctime":1586767919,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586767919","product_id":100039001,"comment_content":"MVCä¸‰å±‚ç»“æ„ï¼Œä¾èµ–æ•°æ®åº“çš„é‚£ä¸€å±‚ä¹Ÿå¯ä»¥ä½¿ç”¨Mockçš„æ–¹å¼æ¥è¿›è¡Œæµ‹è¯•äº†ï¼Œåè€Œä¹‹å‰ç”¨è¿‡ä¸€ç§é€šè¿‡junité…ç½®æ–‡ä»¶è·å–ä¾èµ–å…³ç³»æ¥å†™å•å…ƒæµ‹è¯•çš„æ–¹å¼å¹¶ä¸å¥½ï¼Œå’Œæ•°æ®åº“ä»¥åŠå…¶ä»–çš„ç»„ä»¶è€¦åˆã€‚æœ‰æ¥å£çš„ä¾èµ–å°±å®ç°æ¥å£ï¼Œæ²¡æœ‰æ¥å£çš„ä¾èµ–ç±»å°±ç»§æ‰¿ã€‚<br>å¹²è´§æ»¡æ»¡ï¼Œå­¦åˆ°äº†å¥½å¤šä¸œè¥¿ã€‚","like_count":0},{"had_liked":false,"id":205226,"user_name":"è‚–è‡§","can_delete":false,"product_type":"c1","uid":1047733,"ip_address":"","ucode":"4FAC9FF54DD6A0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fc/b5/ac717737.jpg","comment_is_top":false,"comment_ctime":1586573554,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1586573554","product_id":100039001,"comment_content":"çœ‹åˆ°å¾ˆå¤šæœ‹å‹æŠŠSystem.currentTimeMillis()å°è£…åœ¨ä¸€ä¸ªæ–¹æ³•é‡Œï¼Œç„¶ååœ¨æµ‹è¯•æ–¹æ³•é‡Œoverrideè¿™ä¸ªæ–¹æ³•ï¼Œè¾“å‡ºè‡ªå·±æƒ³è¦çš„å€¼ã€‚æˆ‘è®¤ä¸ºè¿™ç§æ–¹æ³•å¹¶ä¸å¯å–ï¼ŒcaculateDelayDaysæ–¹æ³•å¯¹currentTimestampæ˜¯å¼ºä¾èµ–ï¼Œæ•´ä¸ªæ–¹æ³•çš„æ­£ç¡®æ€§ï¼Œä¾èµ–äºæ˜¯å¦èƒ½è·å–currentTimestampï¼Œæ‰€ä»¥æˆ‘è®¤ä¸ºåº”è¯¥ä»å…¥å‚ä¸Šä¸‹æ‰‹ï¼Œå…ˆè·å–å½“å‰ç³»ç»Ÿæ—¶é—´ï¼Œç„¶åæŒ‰ç…§æµ‹è¯•éœ€æ±‚ï¼ŒåŠ å‡ä¸€å®šçš„å˜é‡å¾—åˆ°dueTime","like_count":0,"discussions":[{"author":{"id":1047733,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/fc/b5/ac717737.jpg","nickname":"è‚–è‡§","note":"","ucode":"4FAC9FF54DD6A0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295202,"discussion_content":"å½“ç„¶Overrideå¯ä»¥ï¼Œæˆ‘æƒ³è¡¨è¾¾çš„æ˜¯æ€ä¹ˆæ ·åšæ›´å¥½è€Œå·²ï¼Œæ¡æ¡å¤§è·¯é€šç½—é©¬ï¼ŒæŒ‰ä½ å–œæ¬¢çš„æ–¹å¼æ¥ï¼Œå®è·µä¼šæ•™è‚²ä½ æˆ‘ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596117602,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1515149,"avatar":"https://static001.geekbang.org/account/avatar/00/17/1e/8d/5b242931.jpg","nickname":"Fish","note":"","ucode":"C20719F8B0F7C8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295009,"discussion_content":"ä¸å¤ªåŒæ„ã€‚æ„Ÿè§‰override è·å–ç³»ç»Ÿæ—¶é—´æ›´å¥½ã€‚å› ä¸ºè·å–ç³»ç»Ÿæ—¶é—´æœ¬èº«å¾ˆç®€å•ï¼Œæµ‹è¯•ç›®çš„æ˜¯æµ‹è¯•è®¡ç®—delayè¿™ä¸ªé€»è¾‘ã€‚\noverrideè·å–ç³»ç»Ÿæ—¶é—´æ—¶ï¼Œå¯ä»¥åœ¨dueTimeåŸºç¡€ä¸ŠåŠ å‡ï¼Œè¿™æ ·ç»“æœæ˜¯ç¡®å®šçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596069559,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":203148,"user_name":"å²æœˆ","can_delete":false,"product_type":"c1","uid":1337598,"ip_address":"","ucode":"29A2A2BC3C4FE4","user_header":"https://static001.geekbang.org/account/avatar/00/14/68/fe/1353168d.jpg","comment_is_top":false,"comment_ctime":1586144640,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1586144640","product_id":100039001,"comment_content":"åªæœ‰æˆ‘ä¸€ä¸ªäººçœ‹ä¸æ‡‚è¿™æ˜¯ä»€ä¹ˆæ„æ€å˜›ï¼Ÿ<br><br>public void testExecute_with_TransactionIsExpired() {<br>  Long buyerId = 123L;<br>  Long sellerId = 234L;<br>  Long productId = 345L;<br>  Long orderId = 456L;<br>  Transction transaction = new Transaction(null, buyerId, sellerId, productId, orderId) {<br>    protected boolean isExpired() {<br>      return true;<br>    }<br>  };<br>  boolean actualResult = transaction.execute();<br>  assertFalse(actualResult);<br>  assertEquals(STATUS.EXPIRED, transaction.getStatus());<br>}<br><br>åˆ›å»ºä¸€ä¸ªå¯¹è±¡ä¹‹åèƒ½ç›´æ¥é‡å†™æŸä¸ªæ–¹æ³•ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿä¸éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ç±»å—ï¼Ÿæˆ‘çœ‹å¾ˆå¤šç¼–ç¨‹è¯­è¨€éƒ½æ²¡è¿™ç§åŠŸèƒ½å§ã€‚ã€‚ã€‚ã€‚","like_count":0,"discussions":[{"author":{"id":1735740,"avatar":"","nickname":"Geek_bb8d16","note":"","ucode":"964BD4DB3D9653","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":225632,"discussion_content":"è¿™ä¸ªæ˜¯åŒ¿åç±»ï¼Œæ¯”è¾ƒç‰¹æ®Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586387749,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":202603,"user_name":"å¢¨é±¼","can_delete":false,"product_type":"c1","uid":1022720,"ip_address":"","ucode":"8FB5E4DCB8A024","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9b/00/654be3f7.jpg","comment_is_top":false,"comment_ctime":1586014162,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586014162","product_id":100039001,"comment_content":"ä»£ç çš„å¯æµ‹è¯•æ€§ï¼šé’ˆå¯¹ä»£ç ç¼–å†™æµ‹è¯•çš„éš¾ä»¥ç¨‹åº¦ã€‚<br><br>ç¼–å†™å¯æµ‹è¯•ä»£ç çš„æ–¹å¼ï¼šä¾èµ–æ³¨å…¥ <br><br>æµ‹è¯•ä¸å‹å¥½çš„ä»£ç ï¼š<br>1.ä»£ç ä¸­åŒ…å«æœªå†³è¡Œä¸ºé€»è¾‘<br>2.æ»¥ç”¨å¯å˜å…¨å±€å˜é‡<br>3.æ»¥ç”¨é™æ€æ–¹æ³•<br>4.å¤æ‚çš„ç»§æ‰¿å…³ç³»<br>5.é«˜åº¦è€¦åˆçš„ä»£ç ","like_count":0},{"had_liked":false,"id":200367,"user_name":"Geek_06c34d","can_delete":false,"product_type":"c1","uid":1593258,"ip_address":"","ucode":"C7910FAECFFE2F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erf1o3QrluWme4LxFCickxtOTkGVQHMBOXo647FvEqwibBa9LfvX8F3EuvibFgE5XXFtpiaGicX73gMHcw/132","comment_is_top":false,"comment_ctime":1585577331,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585577331","product_id":100039001,"comment_content":"éå¸¸æœ‰å¯å‘æ€§çš„æ€è€ƒ","like_count":0},{"had_liked":false,"id":198179,"user_name":"Wizard","can_delete":false,"product_type":"c1","uid":1916084,"ip_address":"","ucode":"EEC2AC00BBED06","user_header":"https://static001.geekbang.org/account/avatar/00/1d/3c/b4/60e20977.jpg","comment_is_top":false,"comment_ctime":1585412753,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585412753","product_id":100039001,"comment_content":"åœ¨ç·¨å¯«å–®å…ƒæ¸¬è©¦çš„éç¨‹ä¸­ï¼Œæœ¬èº«å°±æ˜¯ä¸€å€‹é‡æ§‹çš„éç¨‹ã€‚ç„¡æ³•ç°¡å–®è¢«å–®å…ƒæ¸¬è©¦çš„é¡ï¼Œä¹Ÿä¸€å®šæ˜¯ä¸€å€‹ä¸æ»¿è¶³ï¼³ï¼¯ï¼¬ï¼©ï¼¤ï¼Œé«˜å…§èšï¼Œä½è€¦åˆçš„é¡ã€‚","like_count":0},{"had_liked":false,"id":196852,"user_name":"ç§‹é£ç”»æ‰‡","can_delete":false,"product_type":"c1","uid":1132356,"ip_address":"","ucode":"5BCBC1422C51EC","user_header":"https://static001.geekbang.org/account/avatar/00/11/47/44/964aa665.jpg","comment_is_top":false,"comment_ctime":1585318463,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585318463","product_id":100039001,"comment_content":"å­¦åˆ°äº†ï¼Œå¹²æ´»æ»¡æ»¡~ä»¥å‰æƒ³è‡ªå·±ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼Œæœ€åå› ä¸ºéš¾æµ‹è¯•æ”¾å¼ƒäº†ï¼Œçœ‹äº†ä»Šå¤©çš„è¯¾ç¨‹è±ç„¶å¼€æœ—","like_count":0},{"had_liked":false,"id":189833,"user_name":"å¼ ä¸‰","can_delete":false,"product_type":"c1","uid":1004092,"ip_address":"","ucode":"1155528FAE1546","user_header":"https://static001.geekbang.org/account/avatar/00/0f/52/3c/d6fcb93a.jpg","comment_is_top":false,"comment_ctime":1584574523,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584574523","product_id":100039001,"comment_content":"å®æˆ˜çš„ä¾‹å­å¤ªç²¾å½©äº†","like_count":1},{"had_liked":false,"id":186678,"user_name":"è‡ªå¤æ©˜çŒ«å‡ºèƒ–å­","can_delete":false,"product_type":"c1","uid":1344134,"ip_address":"","ucode":"C76F80D8C008B4","user_header":"https://static001.geekbang.org/account/avatar/00/14/82/86/712c1067.jpg","comment_is_top":false,"comment_ctime":1583900336,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583900336","product_id":100039001,"comment_content":"1.å¦‚æœidæ²¡æœ‰ä¸šåŠ¡é€»è¾‘ï¼Œä¸”ç”Ÿæˆidè€—æ—¶ä¸é•¿ã€‚å¯ä»¥ä¸mockã€‚å¦‚æœidç”Ÿæˆä¾èµ–äº†å¤–éƒ¨æœåŠ¡æˆ–æ•°æ®åº“ï¼Œåˆ™éœ€è¦mock<br>2.ä»€ä¹ˆæ ·çš„å¯¹è±¡ä¸èƒ½newï¼Œä»€ä¹ˆæ ·çš„èƒ½newã€‚è¾¹ç•Œå¤–çš„å¯¹è±¡éœ€è¦æ³¨å…¥ï¼Œæ–¹ä¾¿æµ‹è¯•ã€‚è¾¹ç•Œå†…çš„æ˜¯å¦å°±å¯ä»¥newï¼Ÿå¦‚æœå¸¦æœ‰è¡Œä¸ºçš„å¯¹è±¡éƒ½åšæˆå•ä¾‹serviceæ³¨å…¥ï¼Œé‚£dddå’Œå……è¡€æ¨¡å‹åº”è¯¥å¦‚ä½•è®¾è®¡å‘¢ï¼Ÿå¸Œæœ›æ¥ä¸‹æ¥çš„å­¦ä¹ å¯ä»¥è§£å†³æˆ‘çš„å›°æƒ‘ã€‚","like_count":0},{"had_liked":false,"id":185057,"user_name":"batman","can_delete":false,"product_type":"c1","uid":1266482,"ip_address":"","ucode":"73C30ACFC0D612","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/IIkdC2gohpcibib0AJvSdnJQefAuQYGlLySQOticThpF7Ck9WuDUQLJlgZ7ic13LIFnGBXXbMsSP3nZsbibBN98ZjGA/132","comment_is_top":false,"comment_ctime":1583474148,"is_pvip":true,"discussion_count":1,"race_medal":1,"score":"1583474148","product_id":100039001,"comment_content":"createTimestampï¼Œæ˜¯åœ¨æ„é€ å‡½æ•°åˆå§‹åŒ–çš„å½“å‰ç³»ç»Ÿæ—¶é—´ï¼Œ<br>executionInvokedTimestampï¼Œæ˜¯åœ¨executeæ‰§è¡Œçš„æ—¶å€™åˆå§‹åŒ–çš„ç³»ç»Ÿæ—¶é—´<br>æ€ä¹ˆå¯èƒ½ä¼šå­˜åœ¨14å¤©è¿‡æœŸçš„æƒ…å†µã€‚<br><br>ä»£ç é€»è¾‘æœ‰é—®é¢˜ï¼Œè¿˜æ˜¯æˆ‘æ²¡çœ‹æ‡‚ä»£ç ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1515149,"avatar":"https://static001.geekbang.org/account/avatar/00/17/1e/8d/5b242931.jpg","nickname":"Fish","note":"","ucode":"C20719F8B0F7C8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":295010,"discussion_content":"æ›¿æ¢äº†isExpiredå‡½æ•°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596069664,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":184915,"user_name":"batman","can_delete":false,"product_type":"c1","uid":1266482,"ip_address":"","ucode":"73C30ACFC0D612","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/IIkdC2gohpcibib0AJvSdnJQefAuQYGlLySQOticThpF7Ck9WuDUQLJlgZ7ic13LIFnGBXXbMsSP3nZsbibBN98ZjGA/132","comment_is_top":false,"comment_ctime":1583452208,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1583452208","product_id":100039001,"comment_content":"this.status = STATUS.TO_BE_EXECUTD;<br>åˆå§‹åŒ–å¯¹è±¡çš„æ—¶å€™å·²ç»èµ‹å€¼äº† ï¼Œè€Œä»£ç çš„35ï¼Œ42è¡Œçš„æ£€æŸ¥ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè¢«æ‰§è¡Œï¼Ÿ<br><br>å¸Œæœ›è€å¸ˆèƒ½è¯´æ˜ä¸‹å“ˆ","like_count":0},{"had_liked":false,"id":182815,"user_name":"Heaven","can_delete":false,"product_type":"c1","uid":1694207,"ip_address":"","ucode":"FA33FBCC66C911","user_header":"https://static001.geekbang.org/account/avatar/00/19/d9/ff/b23018a6.jpg","comment_is_top":false,"comment_ctime":1582870009,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582870009","product_id":100039001,"comment_content":"1.ä»å¯æµ‹è¯•æ€§æ¥è¯´,è¿™ä¸ªæ–¹æ³•åªæ˜¯ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆidçš„æ–¹æ³•,å¯¹äºå¯æµ‹è¯•æ€§æ¥è¯´,å¹¶ä¸å½±å“,ä½†æ˜¯ä»å®é™…ç”Ÿäº§çš„è§’åº¦æ¥è¯´,è¿™ä¸ªæ–¹æ³•æ˜¯ä¸€ä¸ªå…¨å±€çš„è‡ªå¢idæ–¹æ³•,å¤šæ¬¡æµ‹è¯•å¯èƒ½ä¼šå‡ºç°æŸäº›ä¸å¯é¢„æ–™çš„é—®é¢˜,ä½†æ˜¯ä¹Ÿå¯ä»¥å› æ­¤å‘ç°æŸäº›é—®é¢˜,æˆ‘ä¸å»ºè®®é‡å†™,å½“ç„¶é‡å†™ä¹Ÿè¡Œ,å°±æ˜¯é€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼è¿›è¡Œä½¿ç”¨,ç„¶åæ³¨å…¥æˆ‘ä»¬è‡ªå·±ç¼–çš„mock<br>2.å¯¹äºç¬¬äºŒä¸ªé—®é¢˜,åœ¨å¸¸è§çš„mvcä¸‰å±‚æ¡†æ¶ä¸­,ä¸Šå±‚ä»£ç ä¼šç”Ÿæˆä¸‹å±‚ä»£ç ,ä¾›å…¶ä½¿ç”¨,è¿™å°±æ˜¯ç±»å†…éƒ¨newçš„æ–¹å¼åˆ›å»ºçš„","like_count":0},{"had_liked":false,"id":178478,"user_name":"aoe","can_delete":false,"product_type":"c1","uid":1121758,"ip_address":"","ucode":"1C6201EDB4E954","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","comment_is_top":false,"comment_ctime":1581697166,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1581697166","product_id":100039001,"comment_content":"private æ–¹æ³•åœ¨Javaè¿›è¡Œå•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡åå°„è·å–","like_count":0,"discussions":[{"author":{"id":2588697,"avatar":"https://static001.geekbang.org/account/avatar/00/27/80/19/ac06db0b.jpg","nickname":"New","note":"","ucode":"406DF65BD05FAA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390494,"discussion_content":"ä½¿ç”¨@VisibleForTestingæ³¨è§£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629862387,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":178088,"user_name":"å°å…µ","can_delete":false,"product_type":"c1","uid":1261674,"ip_address":"","ucode":"AA3BA727C25179","user_header":"https://static001.geekbang.org/account/avatar/00/13/40/6a/ab1cf396.jpg","comment_is_top":false,"comment_ctime":1581584528,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581584528","product_id":100039001,"comment_content":"4,5,6çš„æµ‹è¯•éƒ½å¯ä»¥é€šè¿‡æ‰§è¡Œä¸¤æ¬¡executeæ–¹æ³•æ¥å®ç°ï¼Œç¬¬ä¸€éæ”¹å˜çŠ¶æ€ï¼Œç¬¬äºŒéçœŸæ­£çš„æµ‹è¯•ã€‚<br>å¦å¤–ä¸€ä¸ªæ„Ÿå—ï¼Œå¦‚æœæ˜¯ç”±äºä¾èµ–å…³ç³»å¯¼è‡´çš„éš¾ä»¥æµ‹è¯•ï¼Œå°±éœ€è¦è€ƒè™‘æ˜¯ä¸æ˜¯ç´§è€¦åˆäº†ã€‚<br>å¦‚æœä¸æ˜¯ï¼Œé‚£ä¹ˆå¯èƒ½å°±ä¸åº”è¯¥é€šè¿‡æŠ½å–å•ç‹¬çš„æ–¹æ³•çš„æ–¹å¼æ¥æ–¹ä¾¿æµ‹è¯•ã€‚å› ä¸ºæŠ½å–å•ç‹¬çš„æ–¹æ³•ä¹Ÿå°±ç›¸å½“äºå¯¹å¤–å¼€æ”¾äº†ä¿®æ”¹æƒé™äº†ã€‚åƒæ¡ˆä¾‹ä¸­çš„è¿‡æœŸæ—¶é—´æ–¹æ³•ï¼Œprotectedä¿®é¥°å°±å¯èƒ½æœ‰é—®é¢˜ã€‚","like_count":0},{"had_liked":false,"id":177727,"user_name":"Edward Lee","can_delete":false,"product_type":"c1","uid":1228518,"ip_address":"","ucode":"156223F1D7E94A","user_header":"https://static001.geekbang.org/account/avatar/00/12/be/e6/7808520d.jpg","comment_is_top":false,"comment_ctime":1581482039,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581482039","product_id":100039001,"comment_content":"TransactionLock é€šè¿‡é€‚é…å™¨æ¥æä¾›å¯æµ‹è¯•çš„ä»£ç å®åœ¨å¤ªæƒŠè‰³äº†<br><br>åŸæ¥å•å…ƒæµ‹è¯•éš¾åº¦ä¸åœ¨äºæ€ä¹ˆæé«˜æµ‹è¯•è¦†ç›–ç‡è€Œæ˜¯æ”¹é€ å·²æœ‰çš„ä»£ç æˆå¯æµ‹è¯•ä»£ç ï¼Œåœ¨å¼€å‘è¿‡ç¨‹å°±è¦è€ƒè™‘ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Œå¦‚æœåœ¨å•å…ƒæµ‹è¯•çš„æ—¶å€™å†è€ƒè™‘é‡æ„çš„è¯å·¥ä½œé‡å°±æ¯”è¾ƒå¤§äº†<br><br>if (preAssignedId != null &amp;&amp; !preAssignedId.isEmpty()) {<br>  this.id = preAssignedId;<br>} else {<br>  this.id = IdGenerator.generateTransactionId();<br>}<br>if (!this.id.startWith(&quot;t_&quot;)) {<br>  this.id = &quot;t_&quot; + preAssignedId;<br>}<br><br>IdGenerator.generateTransactionId() ä¸ªäººè®¤ä¸ºä¸éœ€è¦ Mock äº†ï¼Œå¦å¤– this.id = &quot;t_&quot; + preAssignedId; æ˜¯ä¸æ˜¯æœ‰ bug å‘¢ï¼Ÿæ˜¯ä¸æ˜¯åº”è¯¥ this.id = &quot;t_&quot; + this.id; æ‰å¯¹å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":177622,"user_name":"æ¥Š_å®µå¤œ","can_delete":false,"product_type":"c1","uid":1019302,"ip_address":"","ucode":"7BA0CADC5F23BB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/a6/22c37c91.jpg","comment_is_top":false,"comment_ctime":1581435794,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581435794","product_id":100039001,"comment_content":"äº‰å“¥, åˆæœ‰ä¸¤ä¸ªé—®é¢˜:<br>if (status == STATUS.EXECUTED) ;<br>è¿›è¡Œäº†double check, ä½†è¿™å¥å‰é¢è·å–çš„æ˜¯åˆ†å¸ƒå¼é”;<br><br>1. é‚£è¿™ä¸ªdouble checkä¸»è¦æ„ä¹‰ä½•åœ¨å‘¢? æˆ–è€…æ˜¯é’ˆå¯¹è§£å†³é‚£ç§ä¸šåŠ¡åœºæ™¯å‘¢??<br>2. è™½ç„¶ä¸è®¾è®¡æ¨¡å¼æ— å…³, ä½†statusè¿™ä¸ªå˜é‡æ˜¯å¦åº”è¯¥è®¾ç½®ä¸ºvolatile??","like_count":0},{"had_liked":false,"id":177575,"user_name":"helloworld","can_delete":false,"product_type":"c1","uid":1015754,"ip_address":"","ucode":"00DF2FEC58D2E6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","comment_is_top":false,"comment_ctime":1581427301,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1581427301","product_id":100039001,"comment_content":"äº‰å“¥ï¼Œä¸€ç›´å¯¹äºç¼–å†™å•å…ƒæµ‹è¯•æœ‰ä¸€ä¸ªç–‘é—®ï¼šå¦‚æœè¦æµ‹è¯•çš„ä»£ç æ¶‰åŠåˆ°æ•°æ®åº“çš„æ“ä½œï¼Œå½“æµ‹è¯•ç”¨ä¾‹è·‘å®Œäº†åï¼Œå¦‚ä½•å¯¹æ•°æ®åº“è¿›è¡Œåå¤„ç†å‘¢ï¼Ÿå¯¹äºåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­äº§ç”Ÿçš„æ•°æ®ï¼Œä¹Ÿé€šè¿‡å…¶æµ‹è¯•ç”¨ä¾‹æ¥åˆ é™¤ï¼ŸæŠ‘æˆ–æ˜¯ï¼Œè®¿é—®æ•°æ®åº“çš„ç‚¹ä¸éœ€è¦æµ‹è¯•ï¼Ÿï¼Ÿè¯·äº‰å“¥æŠ½æ—¶é—´å¸®å¿™è§£æƒ‘ï¼æ„Ÿè°¢äº†","like_count":0,"discussions":[{"author":{"id":1538604,"avatar":"https://static001.geekbang.org/account/avatar/00/17/7a/2c/54b48459.jpg","nickname":"Vincent.X","note":"","ucode":"8A40B5B2F4B102","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283959,"discussion_content":"æ‰€è°“mockå°±æ˜¯æ¨¡æ‹Ÿã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592406985,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1087243,"avatar":"https://static001.geekbang.org/account/avatar/00/10/97/0b/a943bcb3.jpg","nickname":"zhou","note":"","ucode":"E1CE8575B3F106","race_medal":3,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":280302,"discussion_content":"éœ€è¦ä¾èµ–æ•°æ®åº“ã€ç½‘ç»œé€šä¿¡ã€æ–‡ä»¶ç³»ç»Ÿç­‰ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦å°†è¢«æµ‹ä»£ç ä¸å¤–éƒ¨ç³»ç»Ÿè§£ä¾èµ–ï¼Œè€Œè¿™ç§è§£ä¾èµ–çš„æ–¹æ³•å°±å«ä½œâ€œmockâ€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591525033,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":175374,"user_name":"Corner","can_delete":false,"product_type":"c1","uid":1446316,"ip_address":"","ucode":"7862D593172536","user_header":"https://static001.geekbang.org/account/avatar/00/16/11/ac/9cc5e692.jpg","comment_is_top":false,"comment_ctime":1580698140,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580698140","product_id":100039001,"comment_content":"å¯ä¸å¯ä»¥è¿™ä¹ˆç†è§£å‘¢ï¼Œå¦‚æœé™æ€æ–¹æ³•ä¾èµ–å¤–éƒ¨ç³»ç»Ÿæˆ–è€…é€»è¾‘å¤æ‚ï¼Œæ˜¯ä¸æ˜¯æœ€å¥½é‡å†™ä¸ºé¢å‘å¯¹è±¡çš„å®ä¾‹æ–¹æ³•å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":174222,"user_name":"æ²ˆæ°","can_delete":false,"product_type":"c1","uid":1230818,"ip_address":"","ucode":"20D1D820CAD60D","user_header":"https://static001.geekbang.org/account/avatar/00/12/c7/e2/27d00854.jpg","comment_is_top":false,"comment_ctime":1580094629,"is_pvip":true,"discussion_count":0,"race_medal":4,"score":"1580094629","product_id":100039001,"comment_content":"666ï¼Œè¿˜æ˜¯å¾ˆå®ç”¨ï¼Œç‰¹åˆ«æ˜¯é‡æ„ä»£ç å¯æµ‹è¯•æ€§éƒ¨åˆ†å¾ˆæœ‰å¯å‘","like_count":0},{"had_liked":false,"id":172782,"user_name":"satoshi","can_delete":false,"product_type":"c1","uid":1114872,"ip_address":"","ucode":"11508C95259E97","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLQcr5YD5xznNjMxltFI04NgpTWWicKD3QicBfshIEWtckXNYMicjdNfQu8w5hSTGicuxUg6sOI8yfoNw/132","comment_is_top":false,"comment_ctime":1579310750,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579310750","product_id":100039001,"comment_content":"è±ç„¶å¼€æœ—...","like_count":0},{"had_liked":false,"id":171673,"user_name":"ççœ¼çœ‹ä¸–ç•Œ","can_delete":false,"product_type":"c1","uid":1206388,"ip_address":"","ucode":"F94CF34BC5B2AC","user_header":"https://static001.geekbang.org/account/avatar/00/12/68/74/461b202d.jpg","comment_is_top":false,"comment_ctime":1578989534,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578989534","product_id":100039001,"comment_content":"æœ‰å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„éœ€è¦ä¾èµ–æ³¨å…¥ï¼ŒåŸºäºæ¥å£è€Œéå®ç°ï¼›å¯¹äºå±€éƒ¨å¯¹è±¡ï¼Œå¦‚ç›¸å…³*VOå¯¹è±¡å¯ç›´æ¥newï¼Œå› ä¸ºå…¶æ˜¯ä¸´æ—¶çš„ã€‚","like_count":0},{"had_liked":false,"id":171152,"user_name":"jaryoung","can_delete":false,"product_type":"c1","uid":1077406,"ip_address":"","ucode":"6E72D107DB7E51","user_header":"https://static001.geekbang.org/account/avatar/00/10/70/9e/5095f881.jpg","comment_is_top":false,"comment_ctime":1578874629,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578874629","product_id":100039001,"comment_content":"æ€è€ƒ1ï¼Œæ— éœ€å®ç°ï¼Œéšæœºç”Ÿæˆçš„IDä¸åº”è¯¥å½±å“ä¸šåŠ¡ä¸»æµç¨‹ï¼Œé™¤éIDæœ‰ä¸šåŠ¡å«ä¹‰å°±å¦å½“åˆ«è®ºã€‚<br>æ€è€ƒäºŒï¼Œå¦‚æœç±»æœ¬èº«æ˜¯å½“å‰ç±»çš„å†…éƒ¨ç±»ï¼Ÿ","like_count":0},{"had_liked":false,"id":170686,"user_name":"èš‚èšå†…æ¨+v","can_delete":false,"product_type":"c1","uid":1050508,"ip_address":"","ucode":"24B10AEE54B3FD","user_header":"https://static001.geekbang.org/account/avatar/00/10/07/8c/0d886dcc.jpg","comment_is_top":false,"comment_ctime":1578665397,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1578665397","product_id":100039001,"comment_content":"äº‰å“¥ï¼Œæƒ³è¯·æ•™ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬åœ¨mock RedisDistributedLockçš„æ—¶å€™ï¼Œå°†å…¶å°è£…æˆTransactionLockï¼Œè¿™æ ·åŸTransactionç±»ä¸­è°ƒç”¨RedisDistributedLockçš„åœ°æ–¹éƒ½æ”¹æˆäº†è°ƒç”¨TransactionLockã€‚<br>è¿™æ ·ä¸å°±ç ´åäº†åŸæœ‰ç±»çš„å®ç°å—ï¼Ÿå¦‚æœè¿™æ ·çš„mockå¾ˆå¤šï¼Œæœ€åå¿˜è®°ä¿®æ”¹ï¼Œä¼šä¸ä¼šæœ‰é—®é¢˜ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1983911,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/45/a7/762a4a08.jpg","nickname":"å†°å°å‰‘é˜","note":"","ucode":"D9F04A1AB3C8A2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":274526,"discussion_content":"è¯·æ¸©ä¹ ä¸€è¾¹â€œé‡æ„â€çš„å®šä¹‰ï¼Œä¸æ”¹å˜åŸæœ‰è¡Œä¸ºä¸‹ä½¿å¾—ä»£ç æ›´çµæ´»ï¼Œæ›´æ˜“æµ‹è¯•ï¼Œæ‰€ä»¥æ˜¯ä¸å­˜åœ¨æµ‹è¯•åéœ€è¦æ”¹å›æ¥çš„æƒ…å†µçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590590288,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":170685,"user_name":"èš‚èšå†…æ¨+v","can_delete":false,"product_type":"c1","uid":1050508,"ip_address":"","ucode":"24B10AEE54B3FD","user_header":"https://static001.geekbang.org/account/avatar/00/10/07/8c/0d886dcc.jpg","comment_is_top":false,"comment_ctime":1578665348,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578665348","product_id":100039001,"comment_content":"äº‰å“¥ï¼Œæƒ³è¯·æ•™ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬åœ¨mock RedisDistributedLockçš„æ—¶å€™ï¼Œå°†å…¶å°è£…æˆTransactionLockï¼Œè¿™æ ·åŸTransactionç±»ä¸­è°ƒç”¨RedisDistributedLockçš„åœ°æ–¹éƒ½æ”¹æˆäº†è°ƒç”¨TransactionLockã€‚<br>è¿™æ ·ä¸å°±ç ´åäº†åŸæœ‰ç±»çš„å®ç°å—ï¼Ÿå¦‚æœè¿™æ ·çš„mockå¾ˆå¤šï¼Œæœ€åå¿˜è®°ä¿®æ”¹ï¼Œä¼šä¸ä¼šæœ‰é—®é¢˜ï¼Ÿ","like_count":0},{"had_liked":false,"id":170625,"user_name":"LğŸš²ğŸ±","can_delete":false,"product_type":"c1","uid":1577856,"ip_address":"","ucode":"08A012739614DE","user_header":"https://static001.geekbang.org/account/avatar/00/18/13/80/2c9da1b1.jpg","comment_is_top":false,"comment_ctime":1578646035,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578646035","product_id":100039001,"comment_content":"å…³äºæ€è€ƒé¢˜:  æ€è€ƒé¢˜ ä¸€ IdGenerator.generateTransactionId() åªæ˜¯ç”Ÿæˆä¸€ä¸ª id ç”Ÿæˆå™¨, ä¸éœ€è¦mock è¿™ä¸ªå‡½æ•°, å°±ç”Ÿæˆä¸€ä¸ªéšæœºæ•°, æ²¡å¤šå¤§æµ‹è¯•æ„ä¹‰.<br>æ€è€ƒé¢˜äºŒ æœ‰å®ç°æ–¹æ³•çš„ç±»åº”è¯¥ç”¨ä¾èµ–æ³¨å…¥å‡å°‘ä¾èµ–, entity bo vo ç­‰bean å¯ä»¥ new ä¸éœ€è¦ä¾èµ–æ³¨å…¥","like_count":0},{"had_liked":false,"id":170619,"user_name":"å µè½¦","can_delete":false,"product_type":"c1","uid":1145404,"ip_address":"","ucode":"7BC1E50A4F8D3D","user_header":"https://static001.geekbang.org/account/avatar/00/11/7a/3c/87e015f8.jpg","comment_is_top":false,"comment_ctime":1578645172,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578645172","product_id":100039001,"comment_content":"è¯·é—®å•å…ƒæµ‹è¯•åœ¨ä»€ä¹ˆæ—¶å€™åšæ¯”è¾ƒå¥½ï¼Ÿæ˜¯ä¸€ä¸ªæ¨¡å—å†™å®Œå†æµ‹è¯•è¿˜æ˜¯ä¸€ä¸ªæ–¹æ³•å†™å®Œå†æµ‹è¯•ï¼Ÿæ–‡ä¸­è·å–redisé”ç”¨é™æ€æ–¹æ³•ï¼Œä¸€è¡Œä»£ç å°±æå®šäº†ï¼Œè€Œä¸”å‡ ä¹æ‰€æœ‰çš„åˆ†å¸ƒå¼é”éƒ½æ˜¯è¿™æ ·çš„å†™æ³•ï¼Œç”¨èµ·æ¥å¾ˆæ–¹ä¾¿ï¼ŒåæœŸå‡ ä¹ä¸ä¼šå˜åŠ¨ã€‚ä¸ºäº†å¯æµ‹è¯•æ€§ï¼Œæ¯ä¸ªä¸šåŠ¡éƒ½å°è£…äº†ä¸€ä¸ªlock,æ˜¯ä¸æ˜¯è¿‡åº¦è§£è€¦äº†ã€‚","like_count":0},{"had_liked":false,"id":170565,"user_name":"èŠ±å„¿å°‘å¹´","can_delete":false,"product_type":"c1","uid":1318540,"ip_address":"","ucode":"CFE4F64243673B","user_header":"https://static001.geekbang.org/account/avatar/00/14/1e/8c/450fe5cb.jpg","comment_is_top":false,"comment_ctime":1578633966,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578633966","product_id":100039001,"comment_content":"mockçš„é€šå¸¸æ˜¯å¤–éƒ¨æœåŠ¡ï¼Œidç”Ÿæˆå™¨å¦‚æœæ˜¯ä¸ªå¤–éƒ¨æœåŠ¡é‚£å°±éœ€è¦mockï¼Œä¸è¿‡é€šå¸¸æ¥è¯´idç”Ÿæˆä¸ä¼šå½±å“ä¸šåŠ¡é€»è¾‘ã€‚<br>ä»€ä¹ˆæ—¶é—´å¯ä»¥newï¼Œéœ€è¦å–å†³äºnewçš„å¯¹è±¡æ˜¯å¦æœ‰å¤–éƒ¨ä¾èµ–ï¼Œæœ‰åˆ™éœ€è¦æ³¨å…¥ï¼Œå¦åˆ™å¯ä»¥new","like_count":0},{"had_liked":false,"id":170531,"user_name":"çŸ³ä»”","can_delete":false,"product_type":"c1","uid":1177921,"ip_address":"","ucode":"974E4604CE2213","user_header":"https://static001.geekbang.org/account/avatar/00/11/f9/41/411b1753.jpg","comment_is_top":false,"comment_ctime":1578627244,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578627244","product_id":100039001,"comment_content":"[åŸåˆ™]æ˜¯:ä¸ä¾èµ–ç½‘ç»œ,IOæˆ–è€…ç¬¬ä¸‰æ–¹æœåŠ¡çš„å°±å¯ä»¥ä¸éœ€è¦mock.<br>1.æœ¬å®æˆ˜æ¡ˆä¾‹ å¹¶æ²¡æœ‰è¦å¯¹TransactionIdè¿›è¡ŒéªŒè¯,æ‰€ä»¥åªè¦å®ƒèƒ½æ­£å¸¸ç”Ÿæˆå°±å®Œæˆäº†å®ƒçš„ä»»åŠ¡ä¸éœ€è¦mock.<br>2.ç±»å†…éƒ¨é€šè¿‡ new çš„æ–¹å¼åˆ›å»ºå¯¹è±¡,åªè¦è¿™ä¸ªå¯¹è±¡çš„åˆ›å»ºä¸è¿å[åŸåˆ™]è€Œä¸”ä¸éœ€è¦åœ¨åç»­æµ‹è¯•ä¾èµ–åˆ°å°±å¯ä»¥æ”¾åœ¨å†…éƒ¨newæ¥åˆ›å»º.<br><br>3.æœªå†³è¡Œä¸ºDemo:<br><br>public class Demo {<br>    private long currentTimestamp;<br>    private long dueTimestamp;<br><br>    public Demo(long currentTimestamp, long dueTimestamp) {<br>        this.currentTimestamp = currentTimestamp;<br>        this.dueTimestamp = dueTimestamp;<br>    }<br><br>    &#47;**<br>     * è®¡ç®—å»¶è¿Ÿå¤©æ•°<br>     *<br>     * @return<br>     *&#47;<br>    public long caculateDelayDays() {<br>        if (!isDelayDays()) {<br>            return 0;<br>        }<br>        long delayTime = this.currentTimestamp - this.dueTimestamp;<br>        long delayDays = delayTime &#47; 86400;<br>        return delayDays;<br>    }<br><br>    &#47;**<br>     * æ˜¯å¦å»¶è¿Ÿ<br>     *<br>     * @return<br>     *&#47;<br>    public boolean isDelayDays() {<br>        if (this.dueTimestamp &gt;= this.currentTimestamp) {<br>            return false;<br>        }<br>        return true;<br>    }<br>}<br><br>æµ‹è¯•:<br>    @Test<br>    public void caculateDelayDaysTest() {<br>        long currentTimestamp = System.currentTimeMillis();<br>        Demo demo = new Demo(System.currentTimeMillis(), currentTimestamp - 14 * 86400);<br>        assertEquals(14l, demo.caculateDelayDays());<br>    }","like_count":0},{"had_liked":false,"id":170432,"user_name":"Kenå¼ äº‘å¿ ","can_delete":false,"product_type":"c1","uid":1134288,"ip_address":"","ucode":"D0BAC9FC17DE2B","user_header":"https://static001.geekbang.org/account/avatar/00/11/4e/d0/d8a5f720.jpg","comment_is_top":false,"comment_ctime":1578615063,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578615063","product_id":100039001,"comment_content":"1.å®æˆ˜æ¡ˆä¾‹ä¸­çš„ void fillTransactionId(String preAssignedId) å‡½æ•°ä¸­åŒ…å«ä¸€å¤„é™æ€å‡½æ•°è°ƒç”¨ï¼šIdGenerator.generateTransactionId()ï¼Œè¿™æ˜¯å¦ä¼šå½±å“åˆ°ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Ÿåœ¨å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯å¦éœ€è¦ mock è¿™ä¸ªå‡½æ•°ï¼Ÿ<br>å¦‚æœgenerateTransactionId()ä¾èµ–äº†å¤–éƒ¨æœåŠ¡,å¦‚redis&#47;mysql&#47;zookeeperç­‰,å°±ä¼šå½±å“ä»£ç çš„å¯æµ‹è¯•æ€§,åœ¨å†™å•å…ƒæµ‹è¯•æ—¶å°±éœ€è¦mockè¿™ä¸ªå‡½æ•°;<br>å¦‚æœgenerateTransactionId()æ²¡æœ‰ä¾èµ–å¤–éƒ¨æœåŠ¡å°±ä¸ä¼šå½±å“ä»£ç çš„å¯æµ‹è¯•æ€§,å†™å•å…ƒæµ‹è¯•æ—¶ä¹Ÿä¸éœ€è¦mockè¿™ä¸ªå‡½æ•°.<br><br>2.ä¾èµ–æ³¨å…¥æ˜¯æé«˜ä»£ç å¯æµ‹è¯•æ€§çš„æœ€æœ‰æ•ˆçš„æ‰‹æ®µã€‚æ‰€ä»¥ï¼Œä¾èµ–æ³¨å…¥ï¼Œå°±æ˜¯ä¸è¦åœ¨ç±»å†…éƒ¨é€šè¿‡ new çš„æ–¹å¼åˆ›å»ºå¯¹è±¡ï¼Œè€Œæ˜¯è¦é€šè¿‡å¤–éƒ¨åˆ›å»ºå¥½ä¹‹åä¼ é€’ç»™ç±»ä½¿ç”¨ã€‚<br>é‚£æ˜¯ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡éƒ½ä¸èƒ½åœ¨ç±»å†…éƒ¨åˆ›å»ºå‘¢ï¼Ÿå“ªç§ç±»å‹çš„å¯¹è±¡å¯ä»¥åœ¨ç±»å†…éƒ¨åˆ›å»ºå¹¶ä¸”ä¸å½±å“ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Ÿä½ èƒ½ä¸¾å‡ ä¸ªä¾‹å­å—ï¼Ÿ<br>ä¸æ˜¯.<br>æ²¡æœ‰ä¾èµ–å¤–éƒ¨æœåŠ¡çš„å¯¹è±¡å¯ä»¥åœ¨ç±»å†…éƒ¨åˆ›å»º,å¹¶ä¸”ä¸ä¼šå½±å“ä»£ç çš„å¯æµ‹è¯•æ€§.<br>ä¾‹å¦‚new Date()æ²¡æœ‰ä¾èµ–å¤–éƒ¨æœåŠ¡,åªæ˜¯è°ƒç”¨äº†æœ¬æœºæ“ä½œç³»ç»Ÿçš„æ—¶é—´å‡½æ•°.","like_count":0},{"had_liked":false,"id":170206,"user_name":"ä¸€åå°å­¦ç”Ÿ","can_delete":false,"product_type":"c1","uid":1137292,"ip_address":"","ucode":"5C73082E6B6370","user_header":"https://static001.geekbang.org/account/avatar/00/11/5a/8c/1fec5fa2.jpg","comment_is_top":false,"comment_ctime":1578550153,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1578550153","product_id":100039001,"comment_content":"ä¸€ç›´æä¸æ‡‚å•å…ƒæµ‹è¯•æ€ä¹ˆå†™ï¼Œäºæ˜¯å°±ä¸å–œæ¬¢å†™ï¼Œè·Ÿç€è¿™èŠ‚è¯¾æ•²äº†ä»£ç ï¼Œå­¦åˆ°äº†å¥½å¤šã€‚æ„Ÿè§‰çŸ¥é“æ€ä¹ˆå»å†™ï¼Œæ„Ÿè§‰è‡ªå·±ä¸€ä¸‹å˜å¼ºäº†ï¼Œäº‰å“¥å¤ªå¼ºäº†ï¼Œ666","like_count":0,"discussions":[{"author":{"id":1145404,"avatar":"https://static001.geekbang.org/account/avatar/00/11/7a/3c/87e015f8.jpg","nickname":"å µè½¦","note":"","ucode":"7BC1E50A4F8D3D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":128503,"discussion_content":"æˆ‘å­¦åˆ°äº†â€œå¯æµ‹è¯•æ€§â€è¿™ä¸ªæ¦‚å¿µã€‚æ‡‚å¾—æ€ä¹ˆç”¨æ–­è¨€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578645343,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":170038,"user_name":"#HEAVEN","can_delete":false,"product_type":"c1","uid":1191155,"ip_address":"","ucode":"C14977F6D24E19","user_header":"https://static001.geekbang.org/account/avatar/00/12/2c/f3/bab761d0.jpg","comment_is_top":false,"comment_ctime":1578495488,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578495488","product_id":100039001,"comment_content":"ä½ å¥½ï¼Œæ²¡æœ‰æ‰¾åˆ°ä½œè€…é‚®ç®±ï¼Œæƒ³é—®ä¸€ä¸ªé—®é¢˜ï¼›<br>ä½œè€…åœ¨å¼€å‘ä¸€ä¸ªéœ€æ±‚çš„æ—¶å€™æ˜¯æ€æ ·çš„ä¸€ä¸ªæµç¨‹ï¼Œè®¾è®¡åšåˆ°é‚£ç§ç¨‹åº¦ï¼Ÿ<br>æ¯”å¦‚è¯´ä¸€èˆ¬æˆ‘ä¼šåš1. éœ€æ±‚åˆ†æï¼Œåˆ—å‡ºå“ªäº›éœ€æ±‚caseï¼› 2. åˆ—å‡ºè¿™äº›caseéœ€è¦å¼€å‘å“ªäº›åŠŸèƒ½ç‚¹ï¼›3. ä¸»è¦æ¶‰åŠåˆ°å“ªäº›ç±»ï¼Œç»“æ„å¦‚ä½•ç»„ç»‡ï¼›4. ä¸»è¦ç±»çš„ä¸»è¦èŒè´£ç­‰ï¼›5. å¼€å§‹codeäº†ï¼›<br>åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ä¹Ÿä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚ï¼Œæœ‰æ—¶å€™æœ‰äº›ç±»çš„èŒè´£æˆ–è€…ç»“æ„å¼€å§‹çš„è®¾è®¡ä¸å¤ªåˆç†ï¼Œéœ€è¦ä¸€äº›ä¿®æ”¹ï¼›è¿™ä¸ªæ—¶å€™æˆ‘å°±åœ¨æ€€ç–‘ï¼Œæ˜¯ä¸æ˜¯å‰æœŸåšçš„è®¾è®¡ä¸å¤Ÿå……åˆ†é€ æˆçš„ã€‚ä¹Ÿçœ‹åˆ°ä¸€äº›ä¹¦ä¸Šä¼šæŠŠç±»çš„å±æ€§ã€æ–¹æ³•éƒ½è®¾è®¡å‡ºæ¥ï¼Œè¿˜æœ‰ä¸»è¦æµç¨‹caseçš„åºåˆ—å›¾ï¼›ä½†æ˜¯è¿™æ ·åšè€—æ—¶è¾ƒå¤šï¼Œå¾ˆå¤šæ—¶å€™é¡¹ç›®æ—¥ç¨‹ä¸å…è®¸ã€‚<br>åƒé—®ä¸€ä¸‹ï¼Œä½œè€…åœ¨å¼€å‘ä¸­è®¾è®¡é˜¶æ®µæœ‰å“ªäº›æµç¨‹ï¼Œåšåˆ°ä»€ä¹ˆç¨‹åº¦ï¼Ÿ<br>ç•™ä¸ªé‚®ç®±æ–¹ä¾¿äº¤æµå°±æ›´å¥½äº†","like_count":0},{"had_liked":false,"id":169997,"user_name":"ä¸€å£¶æµŠé…’","can_delete":false,"product_type":"c1","uid":1145530,"ip_address":"","ucode":"5D90F8F8121BBE","user_header":"https://static001.geekbang.org/account/avatar/00/11/7a/ba/8545f2d7.jpg","comment_is_top":false,"comment_ctime":1578490574,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1578490574","product_id":100039001,"comment_content":"å¯¹äºIdGenerator.generateTransactionId()ï¼Œè™½ç„¶æ˜¯æœªå†³è¡Œä¸ºï¼Œä¸ªäººè®¤ä¸ºåªæ˜¯ç”Ÿæˆä¸€ä¸ªidäº†è¯ï¼Œå¹¶ä¸ä¼šåŒ…å«éå¸¸å¤æ‚çš„é€»è¾‘æ“ä½œï¼Œåº”è¯¥å°±è·ŸMath.abs()ç±»ä¼¼ï¼Œä¸éœ€è¦è¿›è¡Œmock","like_count":0},{"had_liked":false,"id":169968,"user_name":"æ–æ³¢é‚£å¥‘","can_delete":false,"product_type":"c1","uid":1464006,"ip_address":"","ucode":"85E2EBC01392B1","user_header":"https://static001.geekbang.org/account/avatar/00/16/56/c6/0b449bc6.jpg","comment_is_top":false,"comment_ctime":1578485377,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578485377","product_id":100039001,"comment_content":"æ„Ÿè§‰é‚£ä¸ªcreatetimestampé‚£è¾¹ å¦‚æœæ²¡æœ‰setæ–¹æ³•åº”è¯¥å¯ä»¥ç”¨åå°„å»ä¿®æ”¹è¿™ä¸ªå±æ€§<br><br>æ€è€ƒé¢˜1 å¯ä»¥ä¸mock å› ä¸ºæ‰§è¡Œidgeneratorä¹‹å‰æœ‰é€»è¾‘åˆ¤æ–­çš„ åªè¦ä¼ å…¥è¿›å»çš„å‚æ•°ä¸æ»¡è¶³æ¡ä»¶å°±ä¸ä¼šèµ° å…¶æ¬¡å¯¹äºidå¼€å¤´æ·»åŠ t_è¿™ä¸ªé€»è¾‘è·Ÿidç”Ÿæˆå™¨æ²¡æœ‰å…³ç³» åªè¦ä¿è¯é€ å‡ºæ¥åˆ°idæ²¡æœ‰t_å¼€å¤´å°±å¯ä»¥æµ‹è¯•<br><br>æ€è€ƒé¢˜2 å…¶å®æœ€è¿‘åœ¨å†™ä¸€ä¸ªéœ€æ±‚ æˆ‘å°±ç”¨äº†å†…éƒ¨ç±» ä¹Ÿè§‰å¾—å¹¶æ²¡æœ‰ç ´åæµ‹è¯•æ€§ æˆ‘è¿™ä¸ªå†…éƒ¨ç±»ä¸»è¦æ˜¯ä¸ºäº†éšè—æŸä¸ªæ¥å£çš„å®ç° ä¸æƒ³è¢«è°ƒç”¨è€…åœ¨ä½¿ç”¨å¤–éƒ¨ç±»æ—¶æ»¥ç”¨æˆ‘çš„æ¯ä¸€ä¸ªæ¥å£å®ç°æ–¹æ³• èµ·åˆ°ä¸€ä¸ªä¿æŠ¤ä½œç”¨ å¯¹äºæµ‹è¯•æ€§ å®Œå…¨å¯ä»¥é€šè¿‡ä¸åŒçš„å¤–éƒ¨ç±»å‚æ•°æ¥è¿›è¡Œè°ƒæ•´ å…¶å®å¯¹äºå†…éƒ¨ç±»çš„å¯æµ‹è¯•æ€§æ¥è®² åªè¦å¤–éƒ¨ç±»æœ‰è¶³å¤Ÿçš„å‚æ•°æ¥æ§åˆ¶å†…éƒ¨ç±»å°±å¯ä»¥ å¯¹äºå†…éƒ¨ç±»è°ƒç”¨ç¬¬ä¸‰æ–¹çš„æƒ…å†µ åªè¦å¤–éƒ¨ç±»æœ‰å‚æ•°å¯ä»¥æ³¨å…¥å°±å¯ä»¥ç”¨mockæ¥ä¿®æ”¹å†…éƒ¨ç±»çš„å®ç°","like_count":0},{"had_liked":false,"id":169855,"user_name":"Jxin","can_delete":false,"product_type":"c1","uid":1251111,"ip_address":"","ucode":"4C03928388C413","user_header":"https://static001.geekbang.org/account/avatar/00/13/17/27/ec30d30a.jpg","comment_is_top":false,"comment_ctime":1578459458,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578459458","product_id":100039001,"comment_content":"1.æ ä¸»å¥½åƒæè¿‡ï¼Œè¦è°ˆè°ˆåˆ†å±‚å¯¹äºå¯æµ‹è¯•æ€§çš„å½±å“ï¼Œä¸çŸ¥æ˜¯ä¸æ˜¯æˆ‘è®°é”™äº†ï¼Œè¿™ç¯‡æ²¡æåˆ°å“ˆã€‚<br><br>å›ç­”é—®é¢˜<br>1.äº¤æ˜“idè¿™ä¸œè¥¿ï¼Œæ˜¯å…¨å±€å”¯ä¸€çš„ã€‚ä¸è¯¥è¢«mockï¼Œmockäº†ä¸ä»…æ²¡ç”¨ï¼Œåè€Œå¯èƒ½ä¼šæœ‰å…¶ä»–é—®é¢˜ï¼ˆå¦‚æœæœ‰å¼•å…¥å”¯ä¸€é”®æ£€éªŒç›¸å…³æœºåˆ¶çš„è¯ï¼Œæ¯”å¦‚å¹‚ç­‰å•¥çš„ï¼‰ã€‚<br><br>2.å€¼å¯¹è±¡å¯ä»¥newï¼Œå› ä¸ºå€¼å¯¹è±¡ä¸ä¼šæœ‰æ¶‰åŠæ”¹åŠ¨è‡ªèº«å±æ€§çš„æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒé€šå¸¸æ˜¯ä¸å¯å˜çš„ï¼Œæ‰€ä»¥ä¹Ÿæ²¡ä»€ä¹ˆæ£€éªŒçš„æ„ä¹‰ã€‚è€Œå®ä½“é¢†åŸŸæ¨¡å‹ä¸ä¸€å®šå¯ä»¥newï¼Œå› ä¸ºå…¶æ–¹æ³•ä¼šæ”¹å˜è‡ªèº«å±æ€§ï¼Œè€Œå¯¹è¿™äº›å±æ€§å˜åŠ¨ï¼Œæœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦æ ¡éªŒã€‚è€Œè´«è¡€å®ä½“dtoæˆ–doä¹‹ç±»çš„ï¼Œä¸€èˆ¬ä¹Ÿå¯ä»¥newï¼Œå› ä¸ºå®ƒåªæ‰¿æ¥å±æ€§ï¼Œåœºæ™¯ç±»ä¼¼å€¼å¯¹è±¡ï¼Œåªéœ€è¦å…³å¿ƒæ–¹æ³•è¿”å›çš„dtoæˆ–voçš„å€¼å³å¯ï¼Œæ— éœ€å…³å¿ƒæ–¹æ³•å†…éƒ¨æ˜¯newè¿˜æ˜¯æ³¨å…¥çš„ï¼ˆå¯¹äºæ–¹æ³•è€Œè¨€ï¼Œé™¤äº†ç±»æˆå‘˜å±æ€§çš„æ³¨å…¥ï¼Œæ–¹æ³•å…¥å‚ä¹Ÿç®—æ³¨å…¥å§ï¼‰ã€‚","like_count":0},{"had_liked":false,"id":169839,"user_name":"æå°å››","can_delete":false,"product_type":"c1","uid":1112747,"ip_address":"","ucode":"2A766BE16B276B","user_header":"https://static001.geekbang.org/account/avatar/00/10/fa/ab/0d39e745.jpg","comment_is_top":false,"comment_ctime":1578454869,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578454869","product_id":100039001,"comment_content":"è®¾è®¡æ¨¡å¼_29:<br><br>1. æˆ‘è®¤ä¸ºé™æ€æ–¹æ³•```IdGenerator.generateTransactionId()```ä¸éœ€è¦mockï¼Œå› ä¸ºå®ƒä¸ä¼šå¾ˆè€—æ—¶(å¦‚æœå®ç°æ¯”è¾ƒæ­£å¸¸)ï¼Œä¹Ÿæ²¡æœ‰æœªå†³è¡Œä¸ºï¼Œé™¤éå¯¹äºidæœ‰ç‰¹æ®Šçš„è¦æ±‚ï¼Œå¦åˆ™ä¸éœ€è¦mockã€‚<br><br>2. è¿™é“é¢˜æˆ‘æƒ³ä¸æ¸…æ¥šï¼Œæƒ³çœ‹çœ‹ç‹äº‰è€å¸ˆå’Œå¤§å®¶çš„çœ‹æ³•ã€‚","like_count":0},{"had_liked":false,"id":169832,"user_name":"æ­¤é±¼ä¸å¾—æ°´","can_delete":false,"product_type":"c1","uid":1257453,"ip_address":"","ucode":"95268E823FB4D2","user_header":"https://static001.geekbang.org/account/avatar/00/13/2f/ed/a87bb8fa.jpg","comment_is_top":false,"comment_ctime":1578453731,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1578453731","product_id":100039001,"comment_content":"1. æœªå†³è¡Œä¸º ä¸­æåˆ°çš„å•æµ‹ï¼Œå¯ä»¥æŠŠä¸ç¡®å®šçš„å˜é‡â€˜å½“å‰æ—¶é—´â€™æå–å‡ºæ¥ä½œä¸ºå…¥å‚","like_count":0,"discussions":[{"author":{"id":1055334,"avatar":"https://static001.geekbang.org/account/avatar/00/10/1a/66/2d9db9ed.jpg","nickname":"è‹¦è¡Œåƒ§","note":"","ucode":"726024A9A9CF44","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":131907,"discussion_content":"æ€ä¹ˆç†è§£ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578874493,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":169815,"user_name":"å®ˆæ‹™","can_delete":false,"product_type":"c1","uid":1738326,"ip_address":"","ucode":"F594B2DA3F6D4F","user_header":"https://static001.geekbang.org/account/avatar/00/1a/86/56/509535da.jpg","comment_is_top":false,"comment_ctime":1578451094,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1578451094","product_id":100039001,"comment_content":"è¯¾å ‚è®¨è®º:<br><br><br><br>Q1.å®æˆ˜æ¡ˆä¾‹ä¸­çš„ void fillTransactionId(String preAssignedId) å‡½æ•°ä¸­åŒ…å«ä¸€å¤„é™æ€å‡½æ•°è°ƒç”¨ï¼šIdGenerator.generateTransactionId()ï¼Œè¿™æ˜¯å¦ä¼šå½±å“åˆ°ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Ÿåœ¨å†™å•å…ƒæµ‹è¯•çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯å¦éœ€è¦ mock è¿™ä¸ªå‡½æ•°ï¼Ÿ<br><br><br><br>Answer1: <br><br>ç†è®ºä¸Šè®²fill()æ–¹æ³•ç”±äºå†…éƒ¨é™æ€æ–¹æ³•çš„ä½¿ç”¨,åŠidç”Ÿæˆçš„æœªå†³è¡Œä¸º,å½±å“å¯æµ‹è¯•æ€§.<br><br>è§£å†³æ–¹æ³•æ˜¯ä¸ºfill()æ–¹æ³•æ·»åŠ ä¸€ä¸ªå½¢å‚,generateId,å¦‚ä¸‹:<br><br>void fillTransactionId(@Nullable String preAssignedId, @Nullable String generateId)<br><br>ä½†è¿™æ ·åšä¼šå½±å“å°è£…æ€§.fill()æ–¹æ³•å†…éƒ¨é€»è¾‘ç®€å•,å¯¹å¯æµ‹è¯•æ€§çš„å½±å“æ˜¯å¾®ä¸è¶³é“çš„.é™¤éæµ‹è¯•é—®é¢˜ç›´æŒ‡fill()æ–¹æ³•,å¦åˆ™ä¸ªäººå€¾å‘äºä¸åšä¿®æ”¹.<br><br><br><br>Q2.æˆ‘ä»¬ä»Šå¤©è®²åˆ°ï¼Œä¾èµ–æ³¨å…¥æ˜¯æé«˜ä»£ç å¯æµ‹è¯•æ€§çš„æœ€æœ‰æ•ˆçš„æ‰‹æ®µã€‚æ‰€ä»¥ï¼Œä¾èµ–æ³¨å…¥ï¼Œå°±æ˜¯ä¸è¦åœ¨ç±»å†…éƒ¨é€šè¿‡ new çš„æ–¹å¼åˆ›å»ºå¯¹è±¡ï¼Œè€Œæ˜¯è¦é€šè¿‡å¤–éƒ¨åˆ›å»ºå¥½ä¹‹åä¼ é€’ç»™ç±»ä½¿ç”¨ã€‚é‚£æ˜¯ä¸æ˜¯æ‰€æœ‰çš„å¯¹è±¡éƒ½ä¸èƒ½åœ¨ç±»å†…éƒ¨åˆ›å»ºå‘¢ï¼Ÿå“ªç§ç±»å‹çš„å¯¹è±¡å¯ä»¥åœ¨ç±»å†…éƒ¨åˆ›å»ºå¹¶ä¸”ä¸å½±å“ä»£ç çš„å¯æµ‹è¯•æ€§ï¼Ÿä½ èƒ½ä¸¾å‡ ä¸ªä¾‹å­å—ï¼Ÿ<br><br><br><br>Answer2: å†…éƒ¨ç±»æˆ–é™æ€å†…éƒ¨ç±», å±€éƒ¨ç±»çš„å¯¹è±¡å¯ä»¥åœ¨ç±»å†…éƒ¨é€šè¿‡new çš„æ–¹å¼åˆå§‹åŒ–.å®ƒä»¬æ˜¯å¤–éƒ¨ç±»è¡Œä¸ºçš„ä¸€éƒ¨åˆ†,ä»…ä¸ºå¤–éƒ¨ç±»è‡ªå·±ä½¿ç”¨,ä¸å½±å“æµ‹è¯•æ€§.<br><br><br><br>å¯¹äºæœªå†³è¡Œä¸ºæ–¹æ³•çš„æ”¹é€ :<br><br>before: <br><br><br><br>public class Demo { <br><br>public long caculateDelayDays(Date dueTime){<br><br> long currentTimestamp = System.currentTimeMillis();<br><br> if (dueTime.getTime() &gt;= currentTimestamp) { return 0; } <br><br>long delayTime = currentTimestamp - dueTime.getTime();<br><br> long delayDays = delayTime &#47; 86400; <br><br>return delayDays; <br><br>â€‹    }<br><br>}<br><br><br><br>after:<br><br>public class Demo { <br><br>public long caculateDelayDays(Date dueTime, Date currentTime){<br><br>â€‹     long currentTimestamp = currentTime.getTime();<br><br>â€‹     if (dueTime.getTime() &gt;= currentTimestamp) { return 0; } <br><br>â€‹     long delayTime = currentTimestamp - dueTime.getTime();<br><br>â€‹     long delayDays = delayTime &#47; 86400; <br><br>â€‹     return delayDays; <br><br>â€‹    }<br><br>}","like_count":0,"discussions":[{"author":{"id":1484184,"avatar":"https://static001.geekbang.org/account/avatar/00/16/a5/98/a65ff31a.jpg","nickname":"djfhchdh","note":"","ucode":"E71D75328CE398","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":125139,"discussion_content":"long currentTimestamp = System.currentTimeMillis();è¿™ä¸ªè¯­å¥æ˜¯æœªå†³è¡Œä¸ºï¼Œæˆ‘è§‰å¾—åªè¦å°è£…ä¸€ä¸ªgetCurrentTimestamp()æ–¹æ³•å°±è¡Œäº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1578476657,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":169805,"user_name":"Jackey","can_delete":false,"product_type":"c1","uid":1063751,"ip_address":"","ucode":"125DE81993FEDD","user_header":"https://static001.geekbang.org/account/avatar/00/10/3b/47/f6c772a1.jpg","comment_is_top":false,"comment_ctime":1578448850,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578448850","product_id":100039001,"comment_content":"IDç”Ÿæˆæ–¹æ³•åªæ˜¯ç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¸ªäººè®¤ä¸ºå¯ä»¥ä¸ç”¨æµ‹è¯•","like_count":0},{"had_liked":false,"id":169799,"user_name":"liu_liu","can_delete":false,"product_type":"c1","uid":1019138,"ip_address":"","ucode":"24283806A07759","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/02/6a16058a.jpg","comment_is_top":false,"comment_ctime":1578447914,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578447914","product_id":100039001,"comment_content":"1. ç”Ÿæˆçš„id å¹¶ä¸ä¼šå¯¹ä¸»ä½“é€»è¾‘é€ æˆå½±å“ï¼Œæ— éœ€mockï¼Œåªéœ€è¯¥ idGen æœ¬èº«é€šè¿‡å•å…ƒæµ‹è¯•å³å¯ã€‚<br>2. å¦‚æœæœªä½¿ç”¨åˆ°ä¾èµ–å¯¹è±¡çš„åŠŸèƒ½ï¼Œæˆ–è€…å…¶åŠŸèƒ½å¾ˆç®€å•ï¼Œåˆæˆ–è€…ä½¿ç”¨äº†ä¹Ÿä¸ä¼šå½±å“åˆ°å½“å‰è¢«æµ‹å‡½æ•°é€»è¾‘ï¼Œå¯ä»¥å†…éƒ¨ newã€‚","like_count":0},{"had_liked":false,"id":169794,"user_name":"æˆæ¥ Peter","can_delete":false,"product_type":"c1","uid":1252977,"ip_address":"","ucode":"4D13E7368D8CF2","user_header":"https://static001.geekbang.org/account/avatar/00/13/1e/71/9dcbe6c4.jpg","comment_is_top":false,"comment_ctime":1578447737,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578447737","product_id":100039001,"comment_content":"è¿™ä¸€èŠ‚æ›´åå‘å®æˆ˜ï¼Œå†™ä»£ç çš„æ–¹å¼ï¼Œè®©æˆ‘ä¸€ä¸‹ç†è§£äº†ä¾èµ–æ³¨å…¥å’Œåè½¬ä¾èµ–","like_count":0},{"had_liked":false,"id":169786,"user_name":"å°æ™å­","can_delete":false,"product_type":"c1","uid":1132337,"ip_address":"","ucode":"3AAA6FB5ACB6AE","user_header":"https://static001.geekbang.org/account/avatar/00/11/47/31/f35367c8.jpg","comment_is_top":false,"comment_ctime":1578446622,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1578446622","product_id":100039001,"comment_content":"1. è¿™ä¸ªé™æ€å‡½æ•°å¤šå°‘æ˜¯æœ‰ä¸€äº›å½±å“çš„ï¼Œæµ‹è¯•è¿™ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œéœ€è¦å…³æ³¨è¿™ä¸ªé™æ€å‡½æ•°çš„é€»è¾‘ï¼Œçœ‹å®ƒè¿”å›å€¼ï¼Œæ‰èƒ½åœ¨æµ‹è¯•çš„æ—¶å€™åˆ¤æ–­this.idæ˜¯å¦æ»¡è¶³æœŸå¾…å€¼ï¼Œæ¯”å¦‚è¿™ä¸ªé™æ€å‡½æ•°è¿”å›å€¼ä¸­ä¸åŒ…å«â€œt_â€ï¼Œé‚£ä¹ˆå•å…ƒæµ‹è¯•çš„asserté€»è¾‘å°±ä¸ä¸€æ ·ã€‚åœ¨å†™å•å…ƒæµ‹è¯•æ—¶å€™ï¼Œåªè¦è¿™ä¸ªé™æ€å‡½æ•°ä¸æ˜¯ç¬¬ä¸‰æ–¹çš„æœåŠ¡ï¼Œä¹Ÿæ²¡æœ‰ä¾èµ–ç¬¬ä¸‰æ–¹çš„æœåŠ¡ï¼Œè¿”å›å€¼çš„formatå›ºå®šï¼Œå¹¶ä¸”æˆ‘ä»¬ä¹Ÿä¸å…³å¿ƒthis.idçš„formatï¼Œé‚£ä¹ˆå¯ä»¥ä¸mockå®ƒï¼Œåä¹‹ï¼Œæœ€å¥½è¿˜æ˜¯mockï¼Œè¿™æ ·æµ‹è¯•çš„æ—¶å€™å¯ä»¥æœŸå¾…å›ºå®šè¾“å…¥å¾—åˆ°å›ºå®šè¾“å‡ºã€‚<br>2. è´«è¡€æ¨¡å‹ä¸­çš„é‚£äº›*oå¯ä»¥ç›´æ¥åœ¨é‡Œé¢newã€‚","like_count":0}]}