{"id":418079,"title":"03 | RDDå¸¸ç”¨ç®—å­ï¼ˆä¸€ï¼‰ï¼šRDDå†…éƒ¨çš„æ•°æ®è½¬æ¢","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å´ç£Šã€‚</p><p>åœ¨ä¸Šä¸€è®²çš„æœ€åï¼Œæˆ‘ä»¬ç”¨ä¸€å¼ è¡¨æ ¼æ•´ç†äº†Spark<a href=\"https://spark.apache.org/docs/latest/rdd-programming-guide.html\">å®˜ç½‘</a>ç»™å‡ºçš„RDDç®—å­ã€‚æƒ³è¦åœ¨Sparkä¹‹ä¸Šå¿«é€Ÿå®ç°ä¸šåŠ¡é€»è¾‘ï¼Œç†è§£å¹¶æŒæ¡è¿™äº›ç®—å­æ— ç–‘æ˜¯è‡³å…³é‡è¦çš„ã€‚</p><p>å› æ­¤ï¼Œåœ¨æ¥ä¸‹æ¥çš„å‡ è®²ï¼Œæˆ‘å°†å¸¦ä½ ä¸€èµ·æ¢³ç†è¿™äº›å¸¸è§ç®—å­çš„ç”¨æ³•ä¸ç”¨é€”ã€‚ä¸åŒçš„ç®—å­ï¼Œå°±åƒæ˜¯å¨æˆ¿é‡Œçš„ç‚’å‹ºã€é“²å­ã€åˆ€å…·å’Œå„å¼å„æ ·çš„é”…ç¢—ç“¢ç›†ï¼Œåªæœ‰ç†Ÿæ‚‰äº†è¿™äº›â€œå¨å…·â€çš„æ“ä½œæ–¹æ³•ï¼Œæ‰èƒ½åœ¨å®¢äººç‚¹é¤çš„æ—¶å€™è¿…é€Ÿåœ°åšå‡ºä¸€æ¡Œå¥½èœã€‚</p><p>ä»Šå¤©è¿™ä¸€è®²ï¼Œæˆ‘ä»¬å…ˆæ¥å­¦ä¹ åŒä¸€ä¸ªRDDå†…éƒ¨çš„æ•°æ®è½¬æ¢ã€‚æŒæ¡RDDå¸¸ç”¨ç®—å­æ˜¯åšå¥½Sparkåº”ç”¨å¼€å‘çš„åŸºç¡€ï¼Œè€Œæ•°æ®è½¬æ¢ç±»ç®—å­åˆ™æ˜¯åŸºç¡€ä¸­çš„åŸºç¡€ï¼Œå› æ­¤æˆ‘ä»¬ä¼˜å…ˆæ¥å­¦ä¹ è¿™ç±»RDDç®—å­ã€‚</p><p>åœ¨è¿™äº›ç®—å­ä¸­ï¼Œæˆ‘ä»¬é‡ç‚¹è®²è§£çš„å°±æ˜¯mapã€mapPartitionsã€flatMapã€filterã€‚è¿™4ä¸ªç®—å­å‡ ä¹å›Šæ‹¬äº†æ—¥å¸¸å¼€å‘ä¸­99%çš„æ•°æ®è½¬æ¢åœºæ™¯ï¼Œå‰©ä¸‹çš„mapPartitionsWithIndexï¼Œæˆ‘æŠŠå®ƒç•™ç»™ä½ ä½œä¸ºè¯¾åä½œä¸šå»æ¢ç´¢ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a3/88/a3ec138b50456604bae8ce22cdf56788.jpg?wh=1599x1885\" alt=\"å›¾ç‰‡\" title=\"RDDç®—å­åˆ†ç±»è¡¨\"></p><p>ä¿—è¯è¯´ï¼Œå·§å¦‡éš¾ä¸ºæ— ç±³ä¹‹ç‚Šï¼Œè¦æƒ³ç©è½¬å¨æˆ¿é‡Œçš„å¨å…·ï¼Œæˆ‘ä»¬å¾—å…ˆå‡†å¤‡å¥½ç±³ã€é¢ã€æ²¹è¿™äº›é£Ÿæã€‚å­¦ä¹ RDDç®—å­ä¹Ÿæ˜¯ä¸€æ ·ï¼Œè¦æƒ³åŠ¨æ‰‹æ“ä½œè¿™äº›ç®—å­ï¼Œå’±ä»¬å¾—å…ˆæœ‰RDDæ‰è¡Œã€‚</p><p>æ‰€ä»¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±ä¸€èµ·æ¥çœ‹çœ‹RDDæ˜¯æ€ä¹ˆåˆ›å»ºçš„ã€‚</p><h2>åˆ›å»ºRDD</h2><p>åœ¨Sparkä¸­ï¼Œåˆ›å»ºRDDçš„å…¸å‹æ–¹å¼æœ‰ä¸¤ç§ï¼š</p><!-- [[[read_end]]] --><ul>\n<li>é€šè¿‡SparkContext.parallelizeåœ¨<strong>å†…éƒ¨æ•°æ®</strong>ä¹‹ä¸Šåˆ›å»ºRDDï¼›</li>\n<li>é€šè¿‡SparkContext.textFileç­‰APIä»<strong>å¤–éƒ¨æ•°æ®</strong>åˆ›å»ºRDDã€‚</li>\n</ul><p>è¿™é‡Œçš„å†…éƒ¨ã€å¤–éƒ¨æ˜¯ç›¸å¯¹åº”ç”¨ç¨‹åºæ¥è¯´çš„ã€‚å¼€å‘è€…åœ¨Sparkåº”ç”¨ä¸­è‡ªå®šä¹‰çš„å„ç±»æ•°æ®ç»“æ„ï¼Œå¦‚æ•°ç»„ã€åˆ—è¡¨ã€æ˜ å°„ç­‰ï¼Œéƒ½å±äºâ€œå†…éƒ¨æ•°æ®â€ï¼›è€Œâ€œå¤–éƒ¨æ•°æ®â€æŒ‡ä»£çš„ï¼Œæ˜¯Sparkç³»ç»Ÿä¹‹å¤–çš„æ‰€æœ‰æ•°æ®å½¢å¼ï¼Œå¦‚æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿæˆ–æ˜¯åˆ†å¸ƒå¼æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ•°æ®ï¼Œå†æ¯”å¦‚æ¥è‡ªå…¶ä»–å¤§æ•°æ®ç»„ä»¶ï¼ˆHiveã€Hbaseã€RDBMSç­‰ï¼‰çš„æ•°æ®ã€‚</p><p>ç¬¬ä¸€ç§åˆ›å»ºæ–¹å¼çš„ç”¨æ³•éå¸¸ç®€å•ï¼Œåªéœ€è¦ç”¨parallelizeå‡½æ•°æ¥å°è£…å†…éƒ¨æ•°æ®å³å¯ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼š</p><pre><code class=\"language-scala\">import org.apache.spark.rdd.RDD\nval words: Array[String] = Array(\"Spark\", \"is\", \"cool\")\nval rdd: RDD[String] = sc.parallelize(words)\n</code></pre><p>ä½ å¯ä»¥åœ¨spark-shellä¸­æ•²å…¥ä¸Šè¿°ä»£ç ï¼Œæ¥ç›´è§‚åœ°æ„Ÿå—parallelizeåˆ›å»ºRDDçš„è¿‡ç¨‹ã€‚é€šå¸¸æ¥è¯´ï¼Œåœ¨Sparkåº”ç”¨å†…å®šä¹‰ä½“é‡è¶…å¤§çš„æ•°æ®é›†ï¼Œå…¶å®éƒ½æ˜¯ä¸å¤ªåˆé€‚çš„ï¼Œå› ä¸ºæ•°æ®é›†å®Œå…¨ç”±Driverç«¯åˆ›å»ºï¼Œä¸”åˆ›å»ºå®Œæˆåï¼Œè¿˜è¦åœ¨å…¨ç½‘èŒƒå›´å†…è·¨èŠ‚ç‚¹ã€è·¨è¿›ç¨‹åœ°åˆ†å‘åˆ°å…¶ä»–Executorsï¼Œæ‰€ä»¥å¾€å¾€ä¼šå¸¦æ¥æ€§èƒ½é—®é¢˜ã€‚å› æ­¤ï¼Œparallelize APIçš„å…¸å‹ç”¨æ³•ï¼Œæ˜¯åœ¨â€œå°æ•°æ®â€ä¹‹ä¸Šåˆ›å»ºRDDã€‚</p><p>è¦æƒ³åœ¨çœŸæ­£çš„â€œå¤§æ•°æ®â€ä¹‹ä¸Šåˆ›å»ºRDDï¼Œæˆ‘ä»¬è¿˜å¾—ä¾èµ–ç¬¬äºŒç§åˆ›å»ºæ–¹å¼ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡SparkContext.textFileç­‰APIä»<strong>å¤–éƒ¨æ•°æ®</strong>åˆ›å»ºRDDã€‚ç”±äºtextFile APIæ¯”è¾ƒç®€å•ï¼Œè€Œä¸”å®ƒåœ¨æ—¥å¸¸çš„å¼€å‘ä¸­å‡ºç°é¢‘ç‡æ¯”è¾ƒé«˜ï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨textFile APIæ¥åˆ›å»ºRDDã€‚åœ¨åç»­å¯¹å„ç±»RDDç®—å­è®²è§£çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éƒ½ä¼šä½¿ç”¨textFile APIä»æ–‡ä»¶ç³»ç»Ÿåˆ›å»ºRDDã€‚</p><p>ä¸ºäº†ä¿æŒè®²è§£çš„è¿è´¯æ€§ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ç¬¬ä¸€è®²ä¸­çš„æºæ–‡ä»¶wikiOfSpark.txtæ¥åˆ›å»ºRDDï¼Œä»£ç å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-scala\">import org.apache.spark.rdd.RDD\nval rootPath: String = _\nval file: String = s\"${rootPath}/wikiOfSpark.txt\"\n// è¯»å–æ–‡ä»¶å†…å®¹\nval lineRDD: RDD[String] = spark.sparkContext.textFile(file)\n</code></pre><p>å¥½å•¦ï¼Œåˆ›å»ºå¥½äº†RDDï¼Œæˆ‘ä»¬å°±æœ‰äº†å¯ä»¥ä¸‹é”…çš„é£Ÿæã€‚æ¥ä¸‹æ¥ï¼Œå’±ä»¬å°±è¦æ­£å¼åœ°èµ°è¿›å¨æˆ¿ï¼ŒæŠŠé“²å­å’Œç‚’å‹ºæŒ¥èµ·æ¥å•¦ã€‚</p><h2>RDDå†…çš„æ•°æ®è½¬æ¢</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ¥è®¤è¯†ä¸€ä¸‹mapç®—å­ã€‚æ¯«ä¸å¤¸å¼ åœ°è¯´ï¼Œåœ¨æ‰€æœ‰çš„RDDç®—å­ä¸­ï¼Œmapâ€œå‡ºåœºâ€çš„æ¦‚ç‡æ˜¯æœ€é«˜çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¿…é¡»è¦æŒæ¡mapçš„ç”¨æ³•ä¸æ³¨æ„äº‹é¡¹ã€‚</p><h3>mapï¼šä»¥å…ƒç´ ä¸ºç²’åº¦çš„æ•°æ®è½¬æ¢</h3><p>æˆ‘ä»¬å…ˆæ¥è¯´è¯´mapç®—å­çš„ç”¨æ³•ï¼š<strong>ç»™å®šæ˜ å°„å‡½æ•°fï¼Œmap(f)ä»¥å…ƒç´ ä¸ºç²’åº¦å¯¹RDDåšæ•°æ®è½¬æ¢ã€‚</strong>å…¶ä¸­få¯ä»¥æ˜¯å¸¦æœ‰æ˜ç¡®ç­¾åçš„å¸¦åå‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯åŒ¿åå‡½æ•°ï¼Œå®ƒçš„å½¢å‚ç±»å‹å¿…é¡»ä¸RDDçš„å…ƒç´ ç±»å‹ä¿æŒä¸€è‡´ï¼Œè€Œè¾“å‡ºç±»å‹åˆ™ä»»ç”±å¼€å‘è€…è‡ªè¡Œå†³å®šã€‚</p><p>è¿™ç§ç…§æœ¬å®£ç§‘çš„ä»‹ç»å¬ä¸Šå»éš¾å…ä¼šè®©ä½ æœ‰ç‚¹æ‡µï¼Œåˆ«ç€æ€¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç”¨äº›å°ä¾‹å­æ¥æ›´åŠ ç›´è§‚åœ°å±•ç¤ºmapçš„ç”¨æ³•ã€‚</p><p>åœ¨<a href=\"https://time.geekbang.org/column/article/415209\">ç¬¬ä¸€è®²</a>çš„Word Countç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹ä»£ç ï¼ŒæŠŠåŒ…å«å•è¯çš„RDDè½¬æ¢æˆå…ƒç´ ä¸ºï¼ˆKeyï¼ŒValueï¼‰å¯¹çš„RDDï¼Œåè€…ç»Ÿç§°ä¸ºPaired RDDã€‚</p><pre><code class=\"language-scala\">// æŠŠæ™®é€šRDDè½¬æ¢ä¸ºPaired RDD\nval cleanWordRDD: RDD[String] = _ // è¯·å‚è€ƒç¬¬ä¸€è®²è·å–å®Œæ•´ä»£ç \nval kvRDD: RDD[(String, Int)] = cleanWordRDD.map(word =&gt; (word, 1))\n</code></pre><p>åœ¨ä¸Šé¢çš„ä»£ç å®ç°ä¸­ï¼Œä¼ é€’ç»™mapç®—å­çš„å½¢å‚ï¼Œå³ï¼šword =&gt; ï¼ˆwordï¼Œ1ï¼‰ï¼Œå°±æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´çš„æ˜ å°„å‡½æ•°fã€‚åªä¸è¿‡ï¼Œè¿™é‡Œfæ˜¯ä»¥åŒ¿åå‡½æ•°çš„æ–¹å¼è¿›è¡Œå®šä¹‰çš„ï¼Œå…¶ä¸­å·¦ä¾§çš„wordè¡¨ç¤ºåŒ¿åå‡½æ•°fçš„è¾“å…¥å½¢å‚ï¼Œè€Œå³ä¾§çš„ï¼ˆwordï¼Œ1ï¼‰åˆ™ä»£è¡¨å‡½æ•°fçš„è¾“å‡ºç»“æœã€‚</p><p>å¦‚æœæˆ‘ä»¬æŠŠåŒ¿åå‡½æ•°å˜æˆå¸¦åå‡½æ•°çš„è¯ï¼Œå¯èƒ½ä½ ä¼šçœ‹çš„æ›´æ¸…æ¥šä¸€äº›ã€‚è¿™é‡Œæˆ‘ç”¨ä¸€æ®µä»£ç é‡æ–°å®šä¹‰äº†å¸¦åå‡½æ•°fã€‚</p><pre><code class=\"language-scala\">// æŠŠRDDå…ƒç´ è½¬æ¢ä¸ºï¼ˆKeyï¼ŒValueï¼‰çš„å½¢å¼\n&nbsp;\n// å®šä¹‰æ˜ å°„å‡½æ•°f\ndef f(word: String): (String, Int) = {\nreturn (word, 1)\n}\n&nbsp;\nval cleanWordRDD: RDD[String] = _ // è¯·å‚è€ƒç¬¬ä¸€è®²è·å–å®Œæ•´ä»£ç \nval kvRDD: RDD[(String, Int)] = cleanWordRDD.map(f)\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä½¿ç”¨Scalaçš„defè¯­æ³•ï¼Œæ˜ç¡®å®šä¹‰äº†å¸¦åæ˜ å°„å‡½æ•°fï¼Œå®ƒçš„è®¡ç®—é€»è¾‘ä¸åˆšåˆšçš„åŒ¿åå‡½æ•°æ˜¯ä¸€è‡´çš„ã€‚åœ¨åšRDDæ•°æ®è½¬æ¢çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€æŠŠå‡½æ•°fä¼ é€’ç»™mapç®—å­å³å¯ã€‚ä¸ç®¡fæ˜¯åŒ¿åå‡½æ•°ï¼Œè¿˜æ˜¯å¸¦åå‡½æ•°ï¼Œmapç®—å­çš„è½¬æ¢é€»è¾‘éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½ ä¸å¦¨æŠŠä»¥ä¸Šä¸¤ç§å®ç°æ–¹å¼åˆ†åˆ«æ•²å…¥åˆ°spark-shellï¼Œå»éªŒè¯æ‰§è¡Œç»“æœçš„ä¸€è‡´æ€§ã€‚</p><p>åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œæˆ‘ä»¬å°±æŒæ¡äº†mapç®—å­çš„åŸºæœ¬ç”¨æ³•ã€‚ç°åœ¨ä½ å°±å¯ä»¥å®šä¹‰ä»»æ„å¤æ‚çš„æ˜ å°„å‡½æ•°fï¼Œç„¶ååœ¨RDDä¹‹ä¸Šé€šè¿‡è°ƒç”¨map(f)å»ç¿»ç€èŠ±æ ·åœ°åšå„ç§å„æ ·çš„æ•°æ®è½¬æ¢ã€‚</p><p>æ¯”å¦‚ï¼Œé€šè¿‡å®šä¹‰å¦‚ä¸‹çš„æ˜ å°„å‡½æ•°fï¼Œæˆ‘ä»¬å°±å¯ä»¥æ”¹å†™Word Countçš„è®¡æ•°é€»è¾‘ï¼Œä¹Ÿå°±æ˜¯æŠŠâ€œSparkâ€è¿™ä¸ªå•è¯çš„ç»Ÿè®¡è®¡æ•°æƒé‡æé«˜ä¸€å€ï¼š</p><pre><code class=\"language-scala\">// æŠŠRDDå…ƒç´ è½¬æ¢ä¸ºï¼ˆKeyï¼ŒValueï¼‰çš„å½¢å¼\n&nbsp;\n// å®šä¹‰æ˜ å°„å‡½æ•°f\ndef f(word: String): (String, Int) = {\nif (word.equals(\"Spark\")) { return (word, 2) }\nreturn (word, 1)\n}\n&nbsp;\nval cleanWordRDD: RDD[String] = _ // è¯·å‚è€ƒç¬¬ä¸€è®²è·å–å®Œæ•´ä»£ç \nval kvRDD: RDD[(String, Int)] = cleanWordRDD.map(f)\n</code></pre><p>å°½ç®¡mapç®—å­è¶³å¤Ÿçµæ´»ï¼Œå…è®¸å¼€å‘è€…è‡ªç”±å®šä¹‰è½¬æ¢é€»è¾‘ã€‚ä¸è¿‡ï¼Œå°±åƒæˆ‘ä»¬åˆšåˆšè¯´çš„ï¼Œmap(f)æ˜¯ä»¥å…ƒç´ ä¸ºç²’åº¦å¯¹RDDåšæ•°æ®è½¬æ¢çš„ï¼Œåœ¨æŸäº›è®¡ç®—åœºæ™¯ä¸‹ï¼Œè¿™ä¸ªç‰¹ç‚¹ä¼šä¸¥é‡å½±å“æ‰§è¡Œæ•ˆç‡ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå…·ä½“çš„ä¾‹å­ã€‚</p><p>æ¯”æ–¹è¯´ï¼Œæˆ‘ä»¬æŠŠWord Countçš„è®¡æ•°éœ€æ±‚ï¼Œä»åŸæ¥çš„å¯¹å•è¯è®¡æ•°ï¼Œæ”¹ä¸ºå¯¹å•è¯çš„å“ˆå¸Œå€¼è®¡æ•°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„ä»£ç å®ç°éœ€è¦åšå“ªäº›æ”¹åŠ¨å‘¢ï¼Ÿæˆ‘æ¥ç¤ºèŒƒä¸€ä¸‹ï¼š</p><pre><code class=\"language-scala\">// æŠŠæ™®é€šRDDè½¬æ¢ä¸ºPaired RDD\n&nbsp;\nimport java.security.MessageDigest\n&nbsp;\nval cleanWordRDD: RDD[String] = _ // è¯·å‚è€ƒç¬¬ä¸€è®²è·å–å®Œæ•´ä»£ç \n&nbsp;\nval kvRDD: RDD[(String, Int)] = cleanWordRDD.map{ word =&gt;\n  // è·å–MD5å¯¹è±¡å®ä¾‹\n  val md5 = MessageDigest.getInstance(\"MD5\")\n  // ä½¿ç”¨MD5è®¡ç®—å“ˆå¸Œå€¼\n  val hash = md5.digest(word.getBytes).mkString\n  // è¿”å›å“ˆå¸Œå€¼ä¸æ•°å­—1çš„Pair\n  (hash, 1)\n}\n</code></pre><p>ç”±äºmap(f)æ˜¯ä»¥å…ƒç´ ä¸ºå•å…ƒåšè½¬æ¢çš„ï¼Œé‚£ä¹ˆå¯¹äºRDDä¸­çš„æ¯ä¸€æ¡æ•°æ®è®°å½•ï¼Œæˆ‘ä»¬éƒ½éœ€è¦å®ä¾‹åŒ–ä¸€ä¸ªMessageDigestå¯¹è±¡æ¥è®¡ç®—è¿™ä¸ªå…ƒç´ çš„å“ˆå¸Œå€¼ã€‚</p><p>åœ¨å·¥ä¸šçº§ç”Ÿäº§ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªRDDåŠ¨è¾„åŒ…å«ä¸Šç™¾ä¸‡ç”šè‡³æ˜¯ä¸Šäº¿çº§åˆ«çš„æ•°æ®è®°å½•ï¼Œå¦‚æœå¤„ç†æ¯æ¡è®°å½•éƒ½éœ€è¦äº‹å…ˆåˆ›å»ºMessageDigestï¼Œé‚£ä¹ˆå®ä¾‹åŒ–å¯¹è±¡çš„å¼€é”€å°±ä¼šèšæ²™æˆå¡”ï¼Œä¸çŸ¥ä¸è§‰åœ°æˆä¸ºå½±å“æ‰§è¡Œæ•ˆç‡çš„ç½ªé­ç¥¸é¦–ã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•ï¼Œèƒ½å¤Ÿè®©Sparkåœ¨æ›´ç²—çš„æ•°æ®ç²’åº¦ä¸Šå»å¤„ç†æ•°æ®å‘¢ï¼Ÿè¿˜çœŸæœ‰ï¼ŒmapPartitionså’ŒmapPartitionsWithIndexè¿™å¯¹â€œå­ªç”Ÿå…„å¼Ÿâ€å°±æ˜¯ç”¨æ¥è§£å†³ç±»ä¼¼çš„é—®é¢˜ã€‚ç›¸æ¯”mapPartitionsï¼ŒmapPartitionsWithIndexä»…ä»…å¤šå‡ºäº†ä¸€ä¸ªæ•°æ®åˆ†åŒºç´¢å¼•ï¼Œå› æ­¤æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠé‡ç‚¹æ”¾åœ¨mapPartitionsä¸Šé¢ã€‚</p><h3>mapPartitionsï¼šä»¥æ•°æ®åˆ†åŒºä¸ºç²’åº¦çš„æ•°æ®è½¬æ¢</h3><p>æŒ‰ç…§ä»‹ç»ç®—å­çš„æƒ¯ä¾‹ï¼Œæˆ‘ä»¬è¿˜æ˜¯å…ˆæ¥è¯´è¯´mapPartitionsçš„ç”¨æ³•ã€‚mapPartitionsï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯<strong>ä»¥æ•°æ®åˆ†åŒºä¸ºç²’åº¦ï¼Œä½¿ç”¨æ˜ å°„å‡½æ•°få¯¹RDDè¿›è¡Œæ•°æ®è½¬æ¢</strong>ã€‚å¯¹äºä¸Šè¿°å•è¯å“ˆå¸Œå€¼è®¡æ•°çš„ä¾‹å­ï¼Œæˆ‘ä»¬ç»“åˆåé¢çš„ä»£ç ï¼Œæ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨mapPartitionsæ¥æ”¹å–„æ‰§è¡Œæ€§èƒ½ï¼š</p><pre><code class=\"language-scala\">// æŠŠæ™®é€šRDDè½¬æ¢ä¸ºPaired RDD\n&nbsp;\nimport java.security.MessageDigest\n&nbsp;\nval cleanWordRDD: RDD[String] = _ // è¯·å‚è€ƒç¬¬ä¸€è®²è·å–å®Œæ•´ä»£ç \n&nbsp;\nval kvRDD: RDD[(String, Int)] = cleanWordRDD.mapPartitions( partition =&gt; {\n  // æ³¨æ„ï¼è¿™é‡Œæ˜¯ä»¥æ•°æ®åˆ†åŒºä¸ºç²’åº¦ï¼Œè·å–MD5å¯¹è±¡å®ä¾‹\n  val md5 = MessageDigest.getInstance(\"MD5\")\n  val newPartition = partition.map( word =&gt; {\n  // åœ¨å¤„ç†æ¯ä¸€æ¡æ•°æ®è®°å½•çš„æ—¶å€™ï¼Œå¯ä»¥å¤ç”¨åŒä¸€ä¸ªPartitionå†…çš„MD5å¯¹è±¡\n    (md5.digest(word.getBytes()).mkString,1)\n  })\n  newPartition\n})\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä¸Šé¢çš„æ”¹è¿›ä»£ç ä¸­ï¼ŒmapPartitionsä»¥æ•°æ®åˆ†åŒºï¼ˆåŒ¿åå‡½æ•°çš„å½¢å‚partitionï¼‰ä¸ºç²’åº¦ï¼Œå¯¹RDDè¿›è¡Œæ•°æ®è½¬æ¢ã€‚å…·ä½“çš„æ•°æ®å¤„ç†é€»è¾‘ï¼Œåˆ™ç”±ä»£è¡¨æ•°æ®åˆ†åŒºçš„å½¢å‚partitionè¿›ä¸€æ­¥è°ƒç”¨map(f)æ¥å®Œæˆã€‚ä½ å¯èƒ½ä¼šè¯´ï¼šâ€œpartition. map(f)ä»ç„¶æ˜¯ä»¥å…ƒç´ ä¸ºç²’åº¦åšæ˜ å°„å‘€ï¼è¿™å’Œå‰ä¸€ä¸ªç‰ˆæœ¬çš„å®ç°ï¼Œæœ‰ä»€ä¹ˆæœ¬è´¨ä¸Šçš„åŒºåˆ«å‘¢ï¼Ÿâ€</p><p>ä»”ç»†è§‚å¯Ÿï¼Œä½ å°±ä¼šå‘ç°ï¼Œç›¸æ¯”å‰ä¸€ä¸ªç‰ˆæœ¬ï¼Œæˆ‘ä»¬æŠŠå®ä¾‹åŒ–MD5å¯¹è±¡çš„è¯­å¥æŒªåˆ°äº†mapç®—å­ä¹‹å¤–ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œä»¥æ•°æ®åˆ†åŒºä¸ºå•ä½ï¼Œå®ä¾‹åŒ–å¯¹è±¡çš„æ“ä½œåªéœ€è¦æ‰§è¡Œä¸€æ¬¡ï¼Œè€ŒåŒä¸€ä¸ªæ•°æ®åˆ†åŒºä¸­æ‰€æœ‰çš„æ•°æ®è®°å½•ï¼Œéƒ½å¯ä»¥å…±äº«è¯¥MD5å¯¹è±¡ï¼Œä»è€Œå®Œæˆå•è¯åˆ°å“ˆå¸Œå€¼çš„è½¬æ¢ã€‚</p><p>é€šè¿‡ä¸‹å›¾çš„ç›´è§‚å¯¹æ¯”ï¼Œä½ ä¼šå‘ç°ï¼Œä»¥æ•°æ®åˆ†åŒºä¸ºå•ä½ï¼ŒmapPartitionsåªéœ€å®ä¾‹åŒ–ä¸€æ¬¡MD5å¯¹è±¡ï¼Œè€Œmapç®—å­å´éœ€è¦å®ä¾‹åŒ–å¤šæ¬¡ï¼Œå…·ä½“çš„æ¬¡æ•°åˆ™ç”±åˆ†åŒºå†…æ•°æ®è®°å½•çš„æ•°é‡æ¥å†³å®šã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/c7/8d/c76be8ff89f1c37e52e9f17b66bf398d.jpg?wh=1920x779\" alt=\"å›¾ç‰‡\" title=\"mapä¸mapPartitionsçš„åŒºåˆ«\"></p><p>å¯¹äºä¸€ä¸ªæœ‰ç€ä¸Šç™¾ä¸‡æ¡è®°å½•çš„RDDæ¥è¯´ï¼Œå…¶æ•°æ®åˆ†åŒºçš„åˆ’åˆ†å¾€å¾€æ˜¯åœ¨ç™¾è¿™ä¸ªé‡çº§ï¼Œå› æ­¤ï¼Œç›¸æ¯”mapç®—å­ï¼ŒmapPartitionså¯ä»¥æ˜¾è‘—é™ä½å¯¹è±¡å®ä¾‹åŒ–çš„è®¡ç®—å¼€é”€ï¼Œè¿™å¯¹äºSparkä½œä¸šç«¯åˆ°ç«¯çš„æ‰§è¡Œæ€§èƒ½æ¥è¯´ï¼Œæ— ç–‘æ˜¯éå¸¸å‹å¥½çš„ã€‚</p><p>å®é™…ä¸Šã€‚é™¤äº†è®¡ç®—å“ˆå¸Œå€¼ä»¥å¤–ï¼Œå¯¹äºæ•°æ®è®°å½•æ¥è¯´ï¼Œå‡¡æ˜¯å¯ä»¥å…±äº«çš„æ“ä½œï¼Œéƒ½å¯ä»¥ç”¨mapPartitionsç®—å­è¿›è¡Œä¼˜åŒ–ã€‚è¿™æ ·çš„å…±äº«æ“ä½œè¿˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚åˆ›å»ºç”¨äºè¿æ¥è¿œç«¯æ•°æ®åº“çš„Connectionså¯¹è±¡ï¼Œæˆ–æ˜¯ç”¨äºè¿æ¥Amazon S3çš„æ–‡ä»¶ç³»ç»Ÿå¥æŸ„ï¼Œå†æ¯”å¦‚ç”¨äºåœ¨çº¿æ¨ç†çš„æœºå™¨å­¦ä¹ æ¨¡å‹ï¼Œç­‰ç­‰ï¼Œä¸ä¸€è€Œè¶³ã€‚ä½ ä¸å¦¨ç»“åˆå®é™…å·¥ä½œåœºæ™¯ï¼ŒæŠŠä½ é‡åˆ°çš„å…±äº«æ“ä½œæ•´ç†åˆ°ç•™è¨€åŒºï¼ŒæœŸå¾…ä½ çš„åˆ†äº«ã€‚</p><p>ç›¸æ¯”mapPartitionsï¼ŒmapPartitionsWithIndexä»…ä»…å¤šå‡ºäº†ä¸€ä¸ªæ•°æ®åˆ†åŒºç´¢å¼•ï¼Œè¿™ä¸ªæ•°æ®åˆ†åŒºç´¢å¼•å¯ä»¥ä¸ºæˆ‘ä»¬è·å–åˆ†åŒºç¼–å·ï¼Œå½“ä½ çš„ä¸šåŠ¡é€»è¾‘ä¸­éœ€è¦ä½¿ç”¨åˆ°åˆ†åŒºç¼–å·çš„æ—¶å€™ï¼Œä¸å¦¨è€ƒè™‘ä½¿ç”¨è¿™ä¸ªç®—å­æ¥å®ç°ä»£ç ã€‚é™¤äº†è¿™ä¸ªé¢å¤–çš„åˆ†åŒºç´¢å¼•ä»¥å¤–ï¼ŒmapPartitionsWithIndexåœ¨å…¶ä»–æ–¹é¢ä¸mapPartitionsæ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚</p><p>ä»‹ç»å®Œmapä¸mapPartitionsç®—å­ä¹‹åï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¶çƒ­æ‰“é“ï¼Œå†æ¥çœ‹ä¸€ä¸ªä¸è¿™ä¸¤è€…åŠŸèƒ½ç±»ä¼¼çš„ç®—å­ï¼šflatMapã€‚</p><h3><strong>flatMapï¼šä»å…ƒç´ åˆ°é›†åˆã€å†ä»é›†åˆåˆ°å…ƒç´ </strong></h3><p>flatMapå…¶å®å’Œmapä¸mapPartitionsç®—å­ç±»ä¼¼ï¼Œåœ¨åŠŸèƒ½ä¸Šï¼Œä¸mapå’ŒmapPartitionsä¸€æ ·ï¼ŒflatMapä¹Ÿæ˜¯ç”¨æ¥åšæ•°æ®æ˜ å°„çš„ï¼Œåœ¨å®ç°ä¸Šï¼Œå¯¹äºç»™å®šæ˜ å°„å‡½æ•°fï¼ŒflatMap(f)ä»¥å…ƒç´ ä¸ºç²’åº¦ï¼Œå¯¹RDDè¿›è¡Œæ•°æ®è½¬æ¢ã€‚</p><p>ä¸è¿‡ï¼Œä¸å‰ä¸¤è€…ç›¸æ¯”ï¼ŒflatMapçš„æ˜ å°„å‡½æ•°fæœ‰ç€æ˜¾è‘—çš„ä¸åŒã€‚å¯¹äºmapå’ŒmapPartitionsæ¥è¯´ï¼Œå…¶æ˜ å°„å‡½æ•°fçš„ç±»å‹ï¼Œéƒ½æ˜¯ï¼ˆå…ƒç´ ï¼‰ =&gt; ï¼ˆå…ƒç´ ï¼‰ï¼Œå³å…ƒç´ åˆ°å…ƒç´ ã€‚è€ŒflatMapæ˜ å°„å‡½æ•°fçš„ç±»å‹ï¼Œæ˜¯ï¼ˆå…ƒç´ ï¼‰ =&gt; ï¼ˆé›†åˆï¼‰ï¼Œå³å…ƒç´ åˆ°é›†åˆï¼ˆå¦‚æ•°ç»„ã€åˆ—è¡¨ç­‰ï¼‰ã€‚å› æ­¤ï¼ŒflatMapçš„æ˜ å°„è¿‡ç¨‹åœ¨é€»è¾‘ä¸Šåˆ†ä¸ºä¸¤æ­¥ï¼š</p><ul>\n<li>ä»¥å…ƒç´ ä¸ºå•ä½ï¼Œåˆ›å»ºé›†åˆï¼›</li>\n<li>å»æ‰é›†åˆâ€œå¤–åŒ…è£…â€ï¼Œæå–é›†åˆå…ƒç´ ã€‚</li>\n</ul><p>è¿™ä¹ˆè¯´æ¯”è¾ƒæŠ½è±¡ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥ä¸¾ä¾‹è¯´æ˜ã€‚å‡è®¾ï¼Œæˆ‘ä»¬å†æ¬¡æ”¹å˜Word Countçš„è®¡ç®—é€»è¾‘ï¼Œç”±åŸæ¥ç»Ÿè®¡å•è¯çš„è®¡æ•°ï¼Œæ”¹ä¸ºç»Ÿè®¡ç›¸é‚»å•è¯å…±ç°çš„æ¬¡æ•°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/b9/6a/b9feyy652bb60d7d30a25e3e122a9f6a.jpg?wh=1920x764\" alt=\"å›¾ç‰‡\" title=\"å˜æ›´Word Countè®¡ç®—é€»è¾‘\"></p><p>å¯¹äºè¿™æ ·çš„è®¡ç®—é€»è¾‘ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•ä½¿ç”¨flatMapè¿›è¡Œå®ç°å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬å…ˆç»™å‡ºä»£ç å®ç°ï¼Œç„¶åå†åˆ†é˜¶æ®µåœ°åˆ†æflatMapçš„æ˜ å°„è¿‡ç¨‹ï¼š</p><pre><code class=\"language-scala\">// è¯»å–æ–‡ä»¶å†…å®¹\nval lineRDD: RDD[String] = _ // è¯·å‚è€ƒç¬¬ä¸€è®²è·å–å®Œæ•´ä»£ç \n// ä»¥è¡Œä¸ºå•ä½æå–ç›¸é‚»å•è¯\nval wordPairRDD: RDD[String] = lineRDD.flatMap( line =&gt; {\n  // å°†è¡Œè½¬æ¢ä¸ºå•è¯æ•°ç»„\n  val words: Array[String] = line.split(\" \")\n  // å°†å•ä¸ªå•è¯æ•°ç»„ï¼Œè½¬æ¢ä¸ºç›¸é‚»å•è¯æ•°ç»„\n  for (i &lt;- 0 until words.length - 1) yield words(i) + \"-\" + words(i+1)\n})\n</code></pre><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨åŒ¿åå‡½æ•°çš„å½¢å¼ï¼Œæ¥æä¾›æ˜ å°„å‡½æ•°fã€‚è¿™é‡Œfçš„å½¢å‚æ˜¯Stringç±»å‹çš„lineï¼Œä¹Ÿå°±æ˜¯æºæ–‡ä»¶ä¸­çš„ä¸€è¡Œæ–‡æœ¬ï¼Œè€Œfçš„è¿”å›ç±»å‹æ˜¯Array[String]ï¼Œä¹Ÿå°±æ˜¯Stringç±»å‹çš„æ•°ç»„ã€‚åœ¨æ˜ å°„å‡½æ•°fçš„å‡½æ•°ä½“ä¸­ï¼Œæˆ‘ä»¬å…ˆç”¨splitè¯­å¥æŠŠlineè½¬åŒ–ä¸ºå•è¯æ•°ç»„ï¼Œç„¶åå†ç”¨forå¾ªç¯ç»“åˆyieldè¯­å¥ï¼Œä¾æ¬¡æŠŠå•ä¸ªçš„å•è¯ï¼Œè½¬åŒ–ä¸ºç›¸é‚»å•è¯è¯å¯¹ã€‚</p><p>æ³¨æ„ï¼Œforå¾ªç¯è¿”å›çš„ä¾ç„¶æ˜¯æ•°ç»„ï¼Œä¹Ÿå³ç±»å‹ä¸ºArray[String]çš„è¯å¯¹æ•°ç»„ã€‚ç”±æ­¤å¯è§ï¼Œå‡½æ•°fçš„ç±»å‹æ˜¯ï¼ˆStringï¼‰ =&gt; ï¼ˆArray[String]ï¼‰ï¼Œä¹Ÿå°±æ˜¯åˆšåˆšè¯´çš„ç¬¬ä¸€æ­¥ï¼Œ<strong>ä»å…ƒç´ åˆ°é›†åˆ</strong>ã€‚ä½†å¦‚æœæˆ‘ä»¬å»è§‚å¯Ÿè½¬æ¢å‰åçš„ä¸¤ä¸ªRDDï¼Œä¹Ÿå°±æ˜¯lineRDDå’ŒwordPairRDDï¼Œä¼šå‘ç°å®ƒä»¬çš„ç±»å‹éƒ½æ˜¯RDD[String]ï¼Œæ¢å¥è¯è¯´ï¼Œå®ƒä»¬çš„å…ƒç´ ç±»å‹éƒ½æ˜¯Stringã€‚</p><p>å›é¡¾mapä¸mapPartitionsè¿™ä¸¤ä¸ªç®—å­ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œè½¬æ¢å‰åRDDçš„å…ƒç´ ç±»å‹ï¼Œä¸æ˜ å°„å‡½æ•°fçš„ç±»å‹æ˜¯ä¸€è‡´çš„ã€‚ä½†åœ¨flatMapè¿™é‡Œï¼Œå´å‡ºç°äº†RDDå…ƒç´ ç±»å‹ä¸å‡½æ•°ç±»å‹ä¸ä¸€è‡´çš„æƒ…å†µã€‚è¿™æ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿå…¶å®å‘¢ï¼Œè¿™æ­£æ˜¯flatMapçš„â€œå¥¥å¦™â€æ‰€åœ¨ï¼Œä¸ºäº†è®©ä½ ç›´è§‚åœ°ç†è§£flatMapçš„æ˜ å°„è¿‡ç¨‹ï¼Œæˆ‘ç”»äº†ä¸€å¼ ç¤ºæ„å›¾ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/a6/bd/a6bcd12fbc377405557c1aaf63cd24bd.jpg?wh=1920x840\" alt=\"å›¾ç‰‡\"></p><p>ä¸éš¾å‘ç°ï¼Œæ˜ å°„å‡½æ•°fçš„è®¡ç®—è¿‡ç¨‹ï¼Œå¯¹åº”ç€å›¾ä¸­çš„æ­¥éª¤1ä¸æ­¥éª¤2ï¼Œæ¯è¡Œæ–‡æœ¬éƒ½è¢«è½¬åŒ–ä¸ºåŒ…å«ç›¸é‚»è¯å¯¹çš„æ•°ç»„ã€‚ç´§æ¥ç€ï¼ŒflatMapå»æ‰æ¯ä¸ªæ•°ç»„çš„â€œå¤–åŒ…è£…â€ï¼Œæå–å‡ºæ•°ç»„ä¸­ç±»å‹ä¸ºStringçš„è¯å¯¹å…ƒç´ ï¼Œç„¶åä»¥è¯å¯¹ä¸ºå•ä½ï¼Œæ„å»ºæ–°çš„æ•°æ®åˆ†åŒºï¼Œå¦‚å›¾ä¸­æ­¥éª¤3æ‰€ç¤ºã€‚è¿™å°±æ˜¯flatMapæ˜ å°„è¿‡ç¨‹çš„ç¬¬äºŒæ­¥ï¼š<strong>å»æ‰é›†åˆâ€œå¤–åŒ…è£…â€ï¼Œæå–é›†åˆå…ƒç´ </strong>ã€‚</p><p>å¾—åˆ°åŒ…å«è¯å¯¹å…ƒç´ çš„wordPairRDDä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ²¿ç”¨Word Countçš„åç»­é€»è¾‘ï¼Œå»è®¡ç®—ç›¸é‚»è¯æ±‡çš„å…±ç°æ¬¡æ•°ã€‚ä½ ä¸å¦¨ç»“åˆæ–‡ç¨¿ä¸­çš„ä»£ç ä¸ç¬¬ä¸€è®²ä¸­Word Countçš„ä»£ç ï¼Œå»å®ç°å®Œæ•´ç‰ˆçš„â€œç›¸é‚»è¯æ±‡è®¡æ•°ç»Ÿè®¡â€ã€‚</p><h3>filterï¼šè¿‡æ»¤RDD</h3><p>åœ¨ä»Šå¤©çš„æœ€åï¼Œæˆ‘ä»¬å†æ¥å­¦ä¹ ä¸€ä¸‹ï¼Œä¸mapä¸€æ ·å¸¸ç”¨çš„ç®—å­ï¼šfilterã€‚filterï¼Œé¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªç®—å­çš„ä½œç”¨ï¼Œæ˜¯å¯¹RDDè¿›è¡Œè¿‡æ»¤ã€‚å°±åƒæ˜¯mapç®—å­ä¾èµ–å…¶æ˜ å°„å‡½æ•°ä¸€æ ·ï¼Œfilterç®—å­ä¹Ÿéœ€è¦å€ŸåŠ©ä¸€ä¸ªåˆ¤å®šå‡½æ•°fï¼Œæ‰èƒ½å®ç°å¯¹RDDçš„è¿‡æ»¤è½¬æ¢ã€‚</p><p>æ‰€è°“åˆ¤å®šå‡½æ•°ï¼Œå®ƒæŒ‡çš„æ˜¯ç±»å‹ä¸ºï¼ˆRDDå…ƒç´ ç±»å‹ï¼‰ =&gt; ï¼ˆBooleanï¼‰çš„å‡½æ•°ã€‚å¯ä»¥çœ‹åˆ°ï¼Œåˆ¤å®šå‡½æ•°fçš„å½¢å‚ç±»å‹ï¼Œå¿…é¡»ä¸RDDçš„å…ƒç´ ç±»å‹ä¿æŒä¸€è‡´ï¼Œè€Œfçš„è¿”å›ç»“æœï¼Œåªèƒ½æ˜¯Trueæˆ–è€…Falseã€‚åœ¨ä»»ä½•ä¸€ä¸ªRDDä¹‹ä¸Šè°ƒç”¨filter(f)ï¼Œå…¶ä½œç”¨æ˜¯ä¿ç•™RDDä¸­æ»¡è¶³fï¼ˆä¹Ÿå°±æ˜¯fè¿”å›Trueï¼‰çš„æ•°æ®å…ƒç´ ï¼Œè€Œè¿‡æ»¤æ‰ä¸æ»¡è¶³fï¼ˆä¹Ÿå°±æ˜¯fè¿”å›Falseï¼‰çš„æ•°æ®å…ƒç´ ã€‚</p><p>è€è§„çŸ©ï¼Œæˆ‘ä»¬è¿˜æ˜¯ç»“åˆç¤ºä¾‹æ¥è®²è§£filterç®—å­ä¸åˆ¤å®šå‡½æ•°fã€‚</p><p>åœ¨ä¸Šé¢flatMapä¾‹å­çš„æœ€åï¼Œæˆ‘ä»¬å¾—åˆ°äº†å…ƒç´ ä¸ºç›¸é‚»è¯æ±‡å¯¹çš„wordPairRDDï¼Œå®ƒåŒ…å«çš„æ˜¯åƒâ€œSpark-isâ€ã€â€œis-coolâ€è¿™æ ·çš„å­—ç¬¦ä¸²ã€‚ä¸ºäº†ä»…ä¿ç•™æœ‰æ„ä¹‰çš„è¯å¯¹å…ƒç´ ï¼Œæˆ‘ä»¬å¸Œæœ›ç»“åˆæ ‡ç‚¹ç¬¦å·åˆ—è¡¨ï¼Œå¯¹wordPairRDDè¿›è¡Œè¿‡æ»¤ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¸Œæœ›è¿‡æ»¤æ‰åƒâ€œSpark-&amp;â€ã€â€œ|-dataâ€è¿™æ ·çš„è¯å¯¹ã€‚</p><p>æŒæ¡äº†filterç®—å­çš„ç”¨æ³•ä¹‹åï¼Œè¦å®ç°è¿™æ ·çš„è¿‡æ»¤é€»è¾‘ï¼Œæˆ‘ç›¸ä¿¡ä½ å¾ˆå¿«å°±èƒ½å†™å‡ºå¦‚ä¸‹çš„ä»£ç å®ç°ï¼š</p><pre><code class=\"language-scala\">// å®šä¹‰ç‰¹æ®Šå­—ç¬¦åˆ—è¡¨\nval list: List[String] = List(\"&amp;\", \"|\", \"#\", \"^\", \"@\")\n&nbsp;\n// å®šä¹‰åˆ¤å®šå‡½æ•°f\ndef f(s: String): Boolean = {\nval words: Array[String] = s.split(\"-\")\nval b1: Boolean = list.contains(words(0))\nval b2: Boolean = list.contains(words(1))\nreturn !b1 &amp;&amp; !b2 // è¿”å›ä¸åœ¨ç‰¹æ®Šå­—ç¬¦åˆ—è¡¨ä¸­çš„è¯æ±‡å¯¹\n}\n&nbsp;\n// ä½¿ç”¨filter(f)å¯¹RDDè¿›è¡Œè¿‡æ»¤\nval cleanedPairRDD: RDD[String] = wordPairRDD.filter(f)\n</code></pre><p>æŒæ¡äº†filterç®—å­çš„ç”¨æ³•ä¹‹åï¼Œä½ å°±å¯ä»¥å®šä¹‰ä»»æ„å¤æ‚çš„åˆ¤å®šå‡½æ•°fï¼Œç„¶ååœ¨RDDä¹‹ä¸Šé€šè¿‡è°ƒç”¨filter(f)å»å˜ç€èŠ±æ ·åœ°åšæ•°æ®è¿‡æ»¤ï¼Œä»è€Œæ»¡è¶³ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚ã€‚</p><h2>é‡ç‚¹å›é¡¾</h2><p>å¥½å•¦ï¼Œåˆ°æ­¤ä¸ºæ­¢ï¼Œå…³äºRDDå†…æ•°æ®è½¬æ¢çš„å‡ ä¸ªç®—å­ï¼Œæˆ‘ä»¬å°±è®²å®Œäº†ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥åšä¸ªæ€»ç»“ã€‚ä»Šå¤©è¿™ä¸€è®²ï¼Œä½ éœ€è¦æŒæ¡mapã€mapPartitionsã€flatMapå’Œfilterè¿™4ä¸ªç®—å­çš„ä½œç”¨å’Œå…·ä½“ç”¨æ³•ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬è®²äº†mapç®—å­çš„ç”¨æ³•ï¼Œå®ƒå…è®¸å¼€å‘è€…è‡ªç”±åœ°å¯¹RDDåšå„å¼å„æ ·çš„æ•°æ®è½¬æ¢ï¼Œç»™å®šæ˜ å°„å‡½æ•°fï¼Œmap(f)ä»¥å…ƒç´ ä¸ºç²’åº¦å¯¹RDDåšæ•°æ®è½¬æ¢ã€‚å…¶ä¸­få¯ä»¥æ˜¯å¸¦åå‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯åŒ¿åå‡½æ•°ï¼Œå®ƒçš„å½¢å‚ç±»å‹å¿…é¡»ä¸RDDçš„å…ƒç´ ç±»å‹ä¿æŒä¸€è‡´ï¼Œè€Œè¾“å‡ºç±»å‹åˆ™ä»»ç”±å¼€å‘è€…è‡ªè¡Œå†³å®šã€‚</p><p>ä¸ºäº†æå‡æ•°æ®è½¬æ¢çš„æ•ˆç‡ï¼ŒSparkæä¾›äº†ä»¥æ•°æ®åˆ†åŒºä¸ºç²’åº¦çš„mapPartitionsç®—å­ã€‚mapPartitionsçš„å½¢å‚æ˜¯ä»£è¡¨æ•°æ®åˆ†åŒºçš„partitionï¼Œå®ƒé€šè¿‡åœ¨partitionä¹‹ä¸Šå†æ¬¡è°ƒç”¨map(f)æ¥å®Œæˆæ•°æ®çš„è½¬æ¢ã€‚ç›¸æ¯”mapï¼ŒmapPartitionsçš„ä¼˜åŠ¿æ˜¯ä»¥æ•°æ®åˆ†åŒºä¸ºç²’åº¦åˆå§‹åŒ–å…±äº«å¯¹è±¡ï¼Œè¿™äº›å…±äº«å¯¹è±¡åœ¨æˆ‘ä»¬æ—¥å¸¸çš„å¼€å‘ä¸­å¾ˆå¸¸è§ï¼Œæ¯”å¦‚æ•°æ®åº“è¿æ¥å¯¹è±¡ã€S3æ–‡ä»¶å¥æŸ„ã€æœºå™¨å­¦ä¹ æ¨¡å‹ç­‰ç­‰ã€‚</p><p>ç´§æ¥ç€ï¼Œæˆ‘ä»¬ä»‹ç»äº†flatMapç®—å­ã€‚flatMapçš„æ˜ å°„å‡½æ•°fæ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒçš„å‡½æ•°ç±»å‹æ˜¯ï¼ˆå…ƒç´ ï¼‰ =&gt; ï¼ˆé›†åˆï¼‰ï¼Œè¿™é‡Œé›†åˆæŒ‡çš„æ˜¯åƒæ•°ç»„ã€åˆ—è¡¨è¿™æ ·çš„æ•°æ®ç»“æ„ã€‚å› æ­¤ï¼ŒflatMapçš„æ˜ å°„è¿‡ç¨‹åœ¨é€»è¾‘ä¸Šåˆ†ä¸ºä¸¤æ­¥ï¼Œè¿™ä¸€ç‚¹éœ€è¦ä½ ç‰¹åˆ«æ³¨æ„ï¼š</p><ul>\n<li><strong>ä»¥å…ƒç´ ä¸ºå•ä½ï¼Œåˆ›å»ºé›†åˆï¼›</strong></li>\n<li><strong>å»æ‰é›†åˆâ€œå¤–åŒ…è£…â€ï¼Œæå–é›†åˆå…ƒç´ ã€‚</strong></li>\n</ul><p>æœ€åï¼Œæˆ‘ä»¬å­¦ä¹ äº†filterç®—å­ï¼Œfilterç®—å­çš„ç”¨æ³•ä¸mapå¾ˆåƒï¼Œå®ƒéœ€è¦å€ŸåŠ©åˆ¤å®šå‡½æ•°fæ¥å®Œæˆå¯¹RDDçš„æ•°æ®è¿‡æ»¤ã€‚åˆ¤å®šå‡½æ•°çš„ç±»å‹å¿…é¡»æ˜¯ï¼ˆRDDå…ƒç´ ç±»å‹ï¼‰ =&gt; ï¼ˆBooleanï¼‰ï¼Œä¹Ÿå°±æ˜¯å½¢å‚ç±»å‹å¿…é¡»ä¸RDDçš„å…ƒç´ ç±»å‹ä¿æŒä¸€è‡´ï¼Œè¿”å›ç»“æœç±»å‹åˆ™å¿…é¡»æ˜¯å¸ƒå°”å€¼ã€‚RDDä¸­çš„å…ƒç´ æ˜¯å¦èƒ½å¤Ÿå¾—ä»¥ä¿ç•™ï¼Œå–å†³äºåˆ¤å®šå‡½æ•°fçš„è¿”å›å€¼æ˜¯Trueè¿˜æ˜¯Falseã€‚</p><p>è™½ç„¶ä»Šå¤©æˆ‘ä»¬åªå­¦äº†4ä¸ªç®—å­ï¼Œä½†è¿™4ä¸ªç®—å­åœ¨æ—¥å¸¸å¼€å‘ä¸­çš„å‡ºç°é¢‘ç‡éå¸¸ä¹‹é«˜ã€‚æŒæ¡äº†è¿™å‡ ä¸ªç®€å•çš„RDDç®—å­ï¼Œä½ å‡ ä¹å¯ä»¥åº”å¯¹RDDä¸­90%çš„æ•°æ®è½¬æ¢åœºæ™¯ã€‚å¸Œæœ›ä½ å¯¹è¿™å‡ ä¸ªç®—å­å¤šå¤šåŠ ä»¥ç»ƒä¹ ï¼Œä»è€Œåœ¨æ—¥å¸¸çš„å¼€å‘å·¥ä½œä¸­å­¦ä»¥è‡´ç”¨ã€‚</p><h2><strong>æ¯è¯¾ä¸€ç»ƒ</strong></h2><p>è®²å®Œäº†æ­£è¯¾ï¼Œæˆ‘æ¥ç»™ä½ ç•™3ä¸ªæ€è€ƒé¢˜ï¼š</p><p>1.è¯·ä½ ç»“åˆ<a href=\"https://spark.apache.org/docs/latest/rdd-programming-guide.html\">å®˜ç½‘</a>çš„ä»‹ç»ï¼Œè‡ªå­¦mapPartitionsWithIndexç®—å­ã€‚è¯·ä½ è¯´ä¸€è¯´ï¼Œåœ¨å“ªäº›åœºæ™¯ä¸‹å¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªç®—å­ï¼Ÿ</p><p>2.å¯¹äºæˆ‘ä»¬ä»Šå¤©å­¦è¿‡çš„4ä¸ªç®—å­ï¼Œå†åŠ ä¸Šæ²¡æœ‰è¯¦ç»†è§£é‡Šçš„mapPartitionsWithIndexï¼Œä½ èƒ½è¯´è¯´ï¼Œå®ƒä»¬ä¹‹é—´æœ‰å“ªäº›å…±æ€§æˆ–æ˜¯å…±åŒç‚¹å—ï¼Ÿ</p><p>3.ä½ èƒ½è¯´ä¸€è¯´ï¼Œåœ¨æ—¥å¸¸çš„å·¥ä½œä¸­ï¼Œè¿˜é‡åˆ°è¿‡å“ªäº›å¯ä»¥åœ¨mapPartitionsä¸­åˆå§‹åŒ–çš„å…±äº«å¯¹è±¡å‘¢ï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨è¯„è®ºåŒºå›ç­”è¿™äº›ç»ƒä¹ é¢˜ã€‚ä½ ä¹Ÿå¯ä»¥æŠŠè¿™ä¸€è®²åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹æˆ–è€…åŒäº‹ï¼Œå’Œä»–ä»¬ä¸€èµ·è®¨è®ºè®¨è®ºï¼Œäº¤æµæ˜¯å­¦ä¹ çš„å‚¬åŒ–å‰‚ã€‚æˆ‘åœ¨è¯„è®ºåŒºç­‰ä½ ã€‚</p>","comments":[{"had_liked":false,"id":312356,"user_name":"qinsi","can_delete":false,"product_type":"c1","uid":1667175,"ip_address":"","ucode":"090D9C4068FF12","user_header":"https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg","comment_is_top":false,"comment_ctime":1631768119,"is_pvip":true,"replies":[{"id":"113335","content":"éå¸¸å¥½çš„é—®é¢˜~ å…ˆèµä¸€ä¸ª ğŸ‘<br><br>å…ˆè¯´ç»“è®ºï¼Œä½ è¯´çš„æ²¡é”™ï¼Œé€šè¿‡åœ¨Driverç«¯åˆ›å»ºå…¨å±€å˜é‡ï¼Œç„¶ååœ¨mapä¸­è¿›è¡Œå¼•ç”¨ï¼Œä¹Ÿå¯ä»¥è¾¾åˆ°mapPartitionsåŒæ ·çš„æ•ˆæœã€‚åŸç†å°±æ˜¯ä½ è¯´çš„å‡½æ•°é—­åŒ…ï¼Œå…¶å®æœ¬è´¨ä¸Šï¼Œå®ƒå°±æ˜¯ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†å¤–éƒ¨æ•°æ®ç»“æ„çš„å‡½æ•°å¯¹è±¡ã€‚<br><br>ä½†æ˜¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé€šè¿‡è¿™ç§æ–¹å¼åˆ›å»ºçš„é—­åŒ…ï¼Œä¸€å®šè¦ä¿è¯Driverç«¯åˆ›å»ºçš„å…¨å±€å˜é‡æ˜¯å¯ä»¥åºåˆ—åŒ–çš„ï¼Œä¹Ÿå°±æ˜¯å®ç°äº†Serializableæ¥å£ã€‚åªæœ‰æ»¡è¶³è¿™ä¸ªå‰æï¼ŒSparkæ‰èƒ½åœ¨è¿™ä¸ªé—­åŒ…ä¹‹ä¸Šåˆ›å»ºåˆ†å¸ƒå¼ä»»åŠ¡ï¼Œå¦åˆ™ä¼šæŠ¥â€œTask not serializableâ€é”™è¯¯ã€‚<br><br>è¿™ä¸ªé”™è¯¯å…¶å®å¾ˆå¥½ç†è§£ï¼Œè¦æŠŠDriveråˆ›å»ºçš„å¯¹è±¡å¸¦åˆ°Executorsï¼Œè¿™ä¸ªå¯¹è±¡ä¸€å®šæ˜¯è¦å¯åºåˆ—åŒ–çš„æ‰è¡Œã€‚ä¸è¿‡é—æ†¾çš„æ˜¯ï¼Œå¾ˆå¤šå…±äº«å¯¹è±¡ï¼Œæ¯”å¦‚å’±ä»¬æœ¬è®²çš„MD5ï¼Œéƒ½æ²¡æœ‰å®ç°Serializableæ¥å£ï¼Œæ‰€ä»¥Driverç«¯åˆ›å»ºçš„MD5å®ä¾‹ï¼ŒSparkâ€œå¸¦ä¸åŠ¨â€ï¼ˆæ²¡æ³•ä»Driverå¸¦åˆ°Executorsï¼‰ï¼Œè¿™ä¸€ç‚¹ä½ ä¸å¦¨åŠ¨æ‰‹è¯•ä¸€è¯•~<br><br>ä¸è¿‡è¿™ä¸ªç‚¹æå¾—éå¸¸å¥½ï¼Œå¯¹äºé‚£äº›è‡ªå®šä¹‰çš„Classï¼Œæˆ‘ä»¬å¯ä»¥è®©å®ƒå®ç°Serializableæ¥å£ï¼Œä»è€Œå¯ä»¥è½»æ¾åœ°åœ¨Driveråˆ›å»ºSparkå¯ä»¥â€œå¸¦çš„åŠ¨â€çš„å…¨å±€å˜é‡ã€‚<br><br>è¯´åˆ°è¿™é‡Œï¼Œæˆ‘è¿½é—®è€å¼Ÿä¸€å¥ï¼šåœ¨Driveråˆ›å»ºMD5å®ä¾‹ï¼Œmapä¸­ç›´æ¥å¼•ç”¨ï¼ŒSparkä¼šæŠ¥â€œTask not Serializableâ€ï¼›é‚£ä¸ºä»€ä¹ˆåœ¨mapPartitionsé‡Œé¢åˆ›å»ºMD5å®ä¾‹ï¼Œmapå¼•ç”¨è¿™ä¸ªå¯¹è±¡ï¼ŒSparkå´æ²¡æœ‰æŠ¥â€œTask not Serializableâ€é”™è¯¯å‘¢ï¼Ÿ<br><br>è€å¼Ÿä¸å¦¨å†æƒ³ä¸€æƒ³ï¼Œå’±ä»¬è¯„è®ºåŒºç»§ç»­è®¨è®º~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1632044078,"ip_address":"","comment_id":312356,"utype":1}],"discussion_count":11,"race_medal":0,"score":"134775754295","product_id":100090001,"comment_content":"ä¸æ˜¯å¾ˆæ‡‚sparkã€‚mapPartitions()é‚£é‡Œï¼Œå…‰ä»ä»£ç ä¸Šæ¥çœ‹çš„è¯ï¼Œåœ¨map()çš„é—­åŒ…é‡Œå¯ä»¥è®¿é—®åˆ°å¤–é¢mapPartitions()é—­åŒ…é‡Œçš„åŒä¸€ä¸ªmd5å®ä¾‹ï¼Œä»è€Œè¾¾åˆ°å…±äº«å®ä¾‹çš„æ•ˆæœã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰å¯èƒ½åœ¨æœ€å¤–å±‚åˆ›å»ºä¸€ä¸ªå…¨å±€çš„md5å®ä¾‹ï¼Œè¿™æ ·å°±ç®—åªç”¨map()ï¼Œåœ¨é—­åŒ…é‡Œè®¿é—®çš„ä¹Ÿæ˜¯è¿™åŒä¸€ä¸ªå®ä¾‹ï¼Ÿè¿™æ ·ä¼šæœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿæˆ–è€…è¯´åœ¨è¿™ç§æƒ…å†µä¸‹mapPartitions()ç›¸æ¯”map()è¿˜æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ","like_count":32,"discussions":[{"author":{"id":1667175,"avatar":"https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg","nickname":"qinsi","note":"","ucode":"090D9C4068FF12","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394784,"discussion_content":"æ„Ÿè°¢å›å¤ã€‚çŒœæµ‹åªè¦é—­åŒ…æ²¡æœ‰æ•è·æ— æ³•åºåˆ—åŒ–çš„å˜é‡çš„è¯ï¼Œé—­åŒ…æœ¬èº«å°±æ˜¯å¯ä»¥è¢«åºåˆ—åŒ–çš„ã€‚ä¾‹å­é‡Œä¼ ç»™mapPartitionsçš„é—­åŒ…å°±æ»¡è¶³è¿™æ ·çš„æ¡ä»¶ã€‚æˆ‘å°è¯•æ”¹å†™mapçš„ä¾‹å­ï¼š\n\nval md5thunk = () => MessageDigest.getInstance(&#34;MD5&#34;)\n\nval kvRDD: RDD[(String, Int)] = cleanWordRDD.map(word => ((md5thunk().digest(word.getBytes).mkString, 1)))\n\nè¿™æ ·ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¯æ˜è¿™æ ·çš„é—­åŒ…å¯ä»¥è¢«åºåˆ—åŒ–ï¼Œå¹¶è¢«Executorsä½¿ç”¨ã€‚ä½†è¿™æ ·å†™å°±è·Ÿåœ¨mapçš„é—­åŒ…é‡Œç›´æ¥åˆå§‹åŒ–æ²¡å•¥åŒºåˆ«äº†ã€‚æ‰€ä»¥å¯¹äºæ— æ³•åºåˆ—åŒ–çš„å¯¹è±¡ï¼Œåœ¨mapPartitionsçš„é—­åŒ…é‡Œåˆå§‹åŒ–å°±æ¯”åœ¨mapé‡Œåˆå§‹åŒ–é«˜æ•ˆã€‚","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1632052055,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":5,"child_discussions":[{"author":{"id":1780640,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/2b/a0/9ada43b9.jpg","nickname":"Pluto","note":"","ucode":"719EBEDE17FC76","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1667175,"avatar":"https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg","nickname":"qinsi","note":"","ucode":"090D9C4068FF12","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":396164,"discussion_content":"è°ƒmd5thunkæ–¹æ³•åº”è¯¥ä¹Ÿæ˜¯æ¯æ¬¡è¿”å›äº†ä¸€ä¸ªæ–°çš„å¯¹è±¡å§?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632400166,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":394784,"ip_address":""},"score":396164,"extra":""},{"author":{"id":1667175,"avatar":"https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg","nickname":"qinsi","note":"","ucode":"090D9C4068FF12","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1780640,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/2b/a0/9ada43b9.jpg","nickname":"Pluto","note":"","ucode":"719EBEDE17FC76","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":396393,"discussion_content":"å¯¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632414976,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":396164,"ip_address":""},"score":396393,"extra":""},{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":1667175,"avatar":"https://static001.geekbang.org/account/avatar/00/19/70/67/0c1359c2.jpg","nickname":"qinsi","note":"","ucode":"090D9C4068FF12","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":399140,"discussion_content":"æ­£è§£~ åˆ†æå¾—éå¸¸åˆ°ä½~ æ»¡åˆ†ğŸ’¯","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1632910618,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":394784,"ip_address":""},"score":399140,"extra":""}]},{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526949,"discussion_content":"éå¸¸å¥½çš„é—®é¢˜~ å…ˆèµä¸€ä¸ª ğŸ‘\n\nå…ˆè¯´ç»“è®ºï¼Œä½ è¯´çš„æ²¡é”™ï¼Œé€šè¿‡åœ¨Driverç«¯åˆ›å»ºå…¨å±€å˜é‡ï¼Œç„¶ååœ¨mapä¸­è¿›è¡Œå¼•ç”¨ï¼Œä¹Ÿå¯ä»¥è¾¾åˆ°mapPartitionsåŒæ ·çš„æ•ˆæœã€‚åŸç†å°±æ˜¯ä½ è¯´çš„å‡½æ•°é—­åŒ…ï¼Œå…¶å®æœ¬è´¨ä¸Šï¼Œå®ƒå°±æ˜¯ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†å¤–éƒ¨æ•°æ®ç»“æ„çš„å‡½æ•°å¯¹è±¡ã€‚\n\nä½†æ˜¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé€šè¿‡è¿™ç§æ–¹å¼åˆ›å»ºçš„é—­åŒ…ï¼Œä¸€å®šè¦ä¿è¯Driverç«¯åˆ›å»ºçš„å…¨å±€å˜é‡æ˜¯å¯ä»¥åºåˆ—åŒ–çš„ï¼Œä¹Ÿå°±æ˜¯å®ç°äº†Serializableæ¥å£ã€‚åªæœ‰æ»¡è¶³è¿™ä¸ªå‰æï¼ŒSparkæ‰èƒ½åœ¨è¿™ä¸ªé—­åŒ…ä¹‹ä¸Šåˆ›å»ºåˆ†å¸ƒå¼ä»»åŠ¡ï¼Œå¦åˆ™ä¼šæŠ¥â€œTask not serializableâ€é”™è¯¯ã€‚\n\nè¿™ä¸ªé”™è¯¯å…¶å®å¾ˆå¥½ç†è§£ï¼Œè¦æŠŠDriveråˆ›å»ºçš„å¯¹è±¡å¸¦åˆ°Executorsï¼Œè¿™ä¸ªå¯¹è±¡ä¸€å®šæ˜¯è¦å¯åºåˆ—åŒ–çš„æ‰è¡Œã€‚ä¸è¿‡é—æ†¾çš„æ˜¯ï¼Œå¾ˆå¤šå…±äº«å¯¹è±¡ï¼Œæ¯”å¦‚å’±ä»¬æœ¬è®²çš„MD5ï¼Œéƒ½æ²¡æœ‰å®ç°Serializableæ¥å£ï¼Œæ‰€ä»¥Driverç«¯åˆ›å»ºçš„MD5å®ä¾‹ï¼ŒSparkâ€œå¸¦ä¸åŠ¨â€ï¼ˆæ²¡æ³•ä»Driverå¸¦åˆ°Executorsï¼‰ï¼Œè¿™ä¸€ç‚¹ä½ ä¸å¦¨åŠ¨æ‰‹è¯•ä¸€è¯•~\n\nä¸è¿‡è¿™ä¸ªç‚¹æå¾—éå¸¸å¥½ï¼Œå¯¹äºé‚£äº›è‡ªå®šä¹‰çš„Classï¼Œæˆ‘ä»¬å¯ä»¥è®©å®ƒå®ç°Serializableæ¥å£ï¼Œä»è€Œå¯ä»¥è½»æ¾åœ°åœ¨Driveråˆ›å»ºSparkå¯ä»¥â€œå¸¦çš„åŠ¨â€çš„å…¨å±€å˜é‡ã€‚\n\nè¯´åˆ°è¿™é‡Œï¼Œæˆ‘è¿½é—®è€å¼Ÿä¸€å¥ï¼šåœ¨Driveråˆ›å»ºMD5å®ä¾‹ï¼Œmapä¸­ç›´æ¥å¼•ç”¨ï¼ŒSparkä¼šæŠ¥â€œTask not Serializableâ€ï¼›é‚£ä¸ºä»€ä¹ˆåœ¨mapPartitionsé‡Œé¢åˆ›å»ºMD5å®ä¾‹ï¼Œmapå¼•ç”¨è¿™ä¸ªå¯¹è±¡ï¼ŒSparkå´æ²¡æœ‰æŠ¥â€œTask not Serializableâ€é”™è¯¯å‘¢ï¼Ÿ\n\nè€å¼Ÿä¸å¦¨å†æƒ³ä¸€æƒ³ï¼Œå’±ä»¬è¯„è®ºåŒºç»§ç»­è®¨è®º~","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1632044078,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1184678,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJDgV2qia6eAL7Fb4egX3odViclRRwOlkfCBrjhU9lLeib90KGkIDjdddSibNVs47N90L36Brgnr6ppiag/132","nickname":"ddww","note":"","ucode":"2871112FC9B3F7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":573399,"discussion_content":"mapç®—å­å’ŒmapPartitionsç®—å­é‡Œç”¨åˆ°äº†mapæ˜¯ä¸¤ä¸ªä¸åŒçš„ä¸œè¥¿ã€‚mapPartitionsæœ¬è´¨å°±æ˜¯ä¸€æ¬¡è®¡ç®—ä¸€ä¸ªåˆ†åŒºä¸­çš„è®¡ç®—ï¼Œmapå°±ç›¸å½“äºéå†ã€‚è¿™ä¸ªä¸¤ä¸ªæ²¡æœ‰å¯æ¯”æ€§ã€‚è¿˜æ˜¯è€å¸ˆæƒ³é—®ã€‚ä¸€ä¸ªç±»æ²¡æœ‰åºåˆ—åŒ–ï¼Œåœ¨ç®—å­ä¸­ç›´æ¥è°ƒç”¨ã€‚æ²¡æœ‰å¼‚å¸¸ã€‚è€Œå½“åšå¹¿æ’­å˜é‡æ—¶ï¼Œåœ¨ç®—å­ä¸­ç›´æ¥è°ƒç”¨ä¼šå¼‚å¸¸ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653388606,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":526949,"ip_address":""},"score":573399,"extra":""}]},{"author":{"id":2767491,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/3a/83/74e3fabd.jpg","nickname":"ç«ç‚ç„±ç‡š","note":"","ucode":"DB11784DD94059","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394740,"discussion_content":"åŒé—®ï¼Œsparké‡Œé¢æœ‰æ²¡æœ‰è¿™ç§å…¨å±€å…±äº«çš„å˜é‡äº†ï¼Ÿæ¯”å¦‚å°†md5å®ä¾‹è®¾ç½®ä¸ºå…¨å±€å˜é‡ä¸å°±è¡Œäº†ã€‚ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632025512,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":2767491,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/3a/83/74e3fabd.jpg","nickname":"ç«ç‚ç„±ç‡š","note":"","ucode":"DB11784DD94059","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":399142,"discussion_content":"å¹¿æ’­å˜é‡","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1632910728,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":394740,"ip_address":""},"score":399142,"extra":""}]},{"author":{"id":2754963,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/hSGZCTvHTKaJH5WibTcC15qDKYpGdgdMFEV6mwcslOFoADP6skWCpBiae2ykkaBFDaexEY9xXBPhZMAGmj1nW8vA/132","nickname":"è¿›","note":"","ucode":"B971F478E3BE8E","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394237,"discussion_content":"å…¶å®æˆ‘ä¹Ÿæœ‰ä¸€ä¸ªç–‘é—®. å¦‚æœmapParittionsæ˜¯åˆ†ç‰‡é‡Œé¢çš„å…¬å…±è°ƒç”¨ä¼˜å…ˆï¼Œé‚£è¿™é‡Œæ˜¯ä¸æ˜¯æ ¹æœ¬å°±ä¸æ˜¯é—­åŒ…è®¿é—®çš„å¤–éƒ¨å˜é‡.\nè²Œä¼¼è¿™é‡Œæ·±ç©¶çš„è¯.è¿˜æ˜¯æ²¡æ‡‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631797503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313550,"user_name":"Unknown element","can_delete":false,"product_type":"c1","uid":2028277,"ip_address":"","ucode":"34A129800D0238","user_header":"https://static001.geekbang.org/account/avatar/00/1e/f2/f5/b82f410d.jpg","comment_is_top":false,"comment_ctime":1632490886,"is_pvip":false,"replies":[{"id":"113591","content":"Perfectï¼Œæ­£è§£ï¼å°±æ˜¯è¿™ä¹ˆå›äº‹~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1632558144,"ip_address":"","comment_id":313550,"utype":1}],"discussion_count":1,"race_medal":0,"score":"44582163846","product_id":100090001,"comment_content":"è€å¸ˆæ‚¨å›ç­”ä¸€æ¥¼çš„é—®é¢˜æ—¶æåˆ°çš„åºåˆ—åŒ–æ„æ€æ˜¯ä¸æ˜¯å¯¹è±¡åœ¨ä¸åŒèŠ‚ç‚¹é—´ä¼ è¾“çš„æ—¶å€™åªèƒ½åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ä¼ è¾“ï¼Ÿå¦‚æœæ˜¯çš„è¯é‚£æˆ‘è§‰å¾— åœ¨mapPartitionsé‡Œé¢åˆ›å»ºMD5å®ä¾‹ï¼Œmapå¼•ç”¨è¿™ä¸ªå¯¹è±¡ï¼ŒSparkå´æ²¡æœ‰æŠ¥â€œTask not Serializableâ€é”™è¯¯ æ˜¯å› ä¸ºdriveræŠŠè¿™æ®µä»£ç åˆ†å‘åˆ°äº†å„ä¸ªexecutorï¼Œè€Œåˆ›å»ºå¯¹è±¡è¿™ä¸ªå·¥ä½œæ˜¯ç”±executorå®Œæˆçš„ï¼Œæ‰€ä»¥ä¸ä¼šæŠ¥é”™ï¼Ÿ","like_count":11,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527388,"discussion_content":"Perfectï¼Œæ­£è§£ï¼å°±æ˜¯è¿™ä¹ˆå›äº‹~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632558144,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312972,"user_name":"Alvin-L","can_delete":false,"product_type":"c1","uid":1603052,"ip_address":"","ucode":"5AC96AAB75B720","user_header":"https://static001.geekbang.org/account/avatar/00/18/75/ec/c60b29f5.jpg","comment_is_top":false,"comment_ctime":1632159829,"is_pvip":false,"replies":[{"id":"113454","content":"ä¸¤ä»½ä»£ç éƒ½æ˜¯æ»¡åˆ†ğŸ’¯ï¼ŒğŸ‘<br><br>æ„Ÿè°¢è€å¼Ÿåˆ†äº«ã€è´¡çŒ®Pythonä»£ç ï¼Œåé¢æˆ‘ä»¬ä¸€èµ·æŠŠå®ƒæ•´ç†åˆ°GitHubé‡Œé¢å»~<br><br>æ„Ÿè°¢ï¼ï¼ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1632327719,"ip_address":"","comment_id":312972,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23106996309","product_id":100090001,"comment_content":"Pythonç‰ˆ,è™½ç„¶èƒ½è·‘,ä½†æ˜¯ä¸çŸ¥é“å¯¹ä¸å¯¹:<br>#å“ˆå¸Œå€¼è®¡æ•°<br>``` <br>from hashlib import md5<br>from pyspark import SparkContext<br><br><br>def f(partition):<br>    m = md5()<br>    for word in partition:<br>        m.update(word.encode(&quot;utf8&quot;))<br>        yield m.hexdigest()<br><br><br>lineRDD = SparkContext().textFile(&quot;.&#47;wikiOfSpark.txt&quot;)<br>kvRDD = (<br>    lineRDD.flatMap(lambda line: line.split(&quot; &quot;))<br>    .filter(lambda word: word != &quot;&quot;)<br>    .mapPartitions(f)<br>    .map(lambda word: (word, 1))<br>)<br><br>kvRDD.foreach(print)<br><br>``` <br><br>#ç›¸é‚»+è¿‡æ»¤ç‰¹æ®Šå­—ç¬¦<br>``` <br>from pyspark import SparkContext<br><br># å®šä¹‰ç‰¹æ®Šå­—ç¬¦åˆ—è¡¨<br>special_char_list = [&quot;&amp;&quot;, &quot;|&quot;, &quot;#&quot;, &quot;^&quot;, &quot;@&quot;]<br># å®šä¹‰åˆ¤å®šå‡½æ•°f<br>def f(s):<br>    words = s.split(&quot;-&quot;)<br>    b1 = words[0] in special_char_list<br>    b2 = words[1] in special_char_list<br>    return (not b1) and (not b2)<br><br><br># å®šä¹‰æ‹¼æ¥å‡½æ•°word_pair<br>def word_pair(line):<br>    words = line.split(&quot; &quot;)<br>    for i in range(len(words) - 1):<br>        yield words[i] + &quot;-&quot; + words[i + 1]<br><br><br>lineRDD = SparkContext().textFile(&quot;.&#47;wikiOfSpark.txt&quot;)<br>cleanedPairRDD = lineRDD.flatMap(word_pair).filter(f)<br>cleanedPairRDD.foreach(print)<br><br>``` ","like_count":5,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527186,"discussion_content":"ä¸¤ä»½ä»£ç éƒ½æ˜¯æ»¡åˆ†ğŸ’¯ï¼ŒğŸ‘\n\næ„Ÿè°¢è€å¼Ÿåˆ†äº«ã€è´¡çŒ®Pythonä»£ç ï¼Œåé¢æˆ‘ä»¬ä¸€èµ·æŠŠå®ƒæ•´ç†åˆ°GitHubé‡Œé¢å»~\n\næ„Ÿè°¢ï¼ï¼ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632327719,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313969,"user_name":"Geek_eb2d3d","can_delete":false,"product_type":"c1","uid":1513922,"ip_address":"","ucode":"76A30ED501CA6A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKw8ictgYcqf6iaicPTOyZ2CR7iaVeeztZLZrLdrvuJib46ibZgibkhSYg85xZAglBhhsO7bY4fz5YQ8icbMA/132","comment_is_top":false,"comment_ctime":1632761672,"is_pvip":false,"replies":[{"id":"113781","content":"ä¸å¯ä»¥ï¼Œä¸¥ç¦è¿™ä¹ˆåšã€‚<br><br>RDDé‡Œé¢ï¼Œç¦æ­¢åµŒå¥—å®šä¹‰æ–°çš„RDDï¼Œè¿™ä¸ªæ˜¯Sparkåˆ†å¸ƒå¼å¼€å‘çš„å¤§å¿Œã€‚<br><br>Sparkçš„å¼€å‘æ¨¡å¼ã€æˆ–è€…æ˜¯å¼€å‘è§„èŒƒï¼Œæ˜¯åˆ©ç”¨transformationï¼Œæ¥å®Œæˆåˆ†å¸ƒå¼æ•°æ®é›†ä¹‹é—´çš„è½¬æ¢ï¼Œä»è€Œè¾¾åˆ°å¤„ç†æ•°æ®çš„ç›®çš„ï½ <br><br>RDDå†…åµŒå¥—RDDï¼Œè¿™ç§å±äºå•æœºæ€ç»´å“ˆï¼Œå¿…é¡»è¦è·³å‡ºæ¥ï½<br>","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1632878457,"ip_address":"","comment_id":313969,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18812630856","product_id":100090001,"comment_content":"è€å¸ˆï¼Œæˆ‘åœ¨ map é‡Œé¢ä½¿ç”¨ SparkContext æˆ– SparkSession åˆ›å»ºæ–°çš„ RDDï¼Œè¿™æ ·æ˜¯å¯ä»¥çš„ä¹ˆï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527532,"discussion_content":"ä¸å¯ä»¥ï¼Œä¸¥ç¦è¿™ä¹ˆåšã€‚\n\nRDDé‡Œé¢ï¼Œç¦æ­¢åµŒå¥—å®šä¹‰æ–°çš„RDDï¼Œè¿™ä¸ªæ˜¯Sparkåˆ†å¸ƒå¼å¼€å‘çš„å¤§å¿Œã€‚\n\nSparkçš„å¼€å‘æ¨¡å¼ã€æˆ–è€…æ˜¯å¼€å‘è§„èŒƒï¼Œæ˜¯åˆ©ç”¨transformationï¼Œæ¥å®Œæˆåˆ†å¸ƒå¼æ•°æ®é›†ä¹‹é—´çš„è½¬æ¢ï¼Œä»è€Œè¾¾åˆ°å¤„ç†æ•°æ®çš„ç›®çš„ï½ \n\nRDDå†…åµŒå¥—RDDï¼Œè¿™ç§å±äºå•æœºæ€ç»´å“ˆï¼Œå¿…é¡»è¦è·³å‡ºæ¥ï½\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632878457,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":316133,"user_name":"Geek_a30533","can_delete":false,"product_type":"c1","uid":2764866,"ip_address":"","ucode":"57B31B311C763A","user_header":"","comment_is_top":false,"comment_ctime":1634175107,"is_pvip":false,"replies":[{"id":"114580","content":"å¯¹çš„~ <br><br>ç¡®å®ï¼ŒScalaçš„è¯­æ³•æ¯”è¾ƒç®€æ´ï¼ˆå·æ‡’ï¼‰ï¼Œreturnä¸æ˜¯å¿…é¡»çš„ï¼Œå¦‚æœå‡½æ•°ä½“æ²¡æœ‰returnï¼Œé‚£ä¹ˆæœ€åä¸€è¡Œä»£ç çš„è¾“å‡ºï¼Œå°±æ˜¯æ•´ä¸ªå‡½æ•°çš„è¿”å›å€¼~<br><br>å…·ä½“åˆ°è¿™ä¸ªåŒ¿åå‡½æ•°ï¼Œå®ƒçš„è¿”å›ç»“æœå°±æ˜¯ä½ è¯´çš„Array[String]ï¼Œåç»­flatMapå†æŠŠè¿™é‡Œçš„Arrayå±•å¹³","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1634287823,"ip_address":"","comment_id":316133,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10224109699","product_id":100090001,"comment_content":"å¯¹scalaçš„å‡½æ•°å®šä¹‰æ ¼å¼ä¸æ˜¯å¾ˆæ¸…æ¥šï¼Œé‚£è¾¹ç»•äº†å¥½å‡ æ¬¡ï¼Œæœ‰ä¸€ä¸ªå°ç–‘é—®ï¼Œåœ¨flatMapé‡Œçš„åŒ¿åå‡½æ•°f<br><br>line =&gt; {  <br>\t\t\tval words: Array[String] = line.split(&quot; &quot;)  <br>\t\t\tfor (i &lt;- 0 until words.length - 1) yield words(i) + &quot;-&quot; + words(i+1)<br>\t\t}<br><br>åªå®šä¹‰äº†å½¢å‚æ˜¯lineï¼Œé‚£å‡ºå‚æ˜¯æ•´ä¸ªèŠ±æ‹¬å·ä¹ˆï¼Ÿä¸»è¦æ˜¯æ²¡æœ‰returnï¼Œè®©æˆ‘ä¸€ä¸‹è¿·äº†ï¼Œéš¾é“æ˜¯æœ€åä¸€ä¸ªæ˜¯Array[String]æ‰€ä»¥è¿”å›å€¼å°±æ˜¯è¿™ä¸ªï¼Ÿä¸ç”¨å£°æ˜å—ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528278,"discussion_content":"å¯¹çš„~ \n\nç¡®å®ï¼ŒScalaçš„è¯­æ³•æ¯”è¾ƒç®€æ´ï¼ˆå·æ‡’ï¼‰ï¼Œreturnä¸æ˜¯å¿…é¡»çš„ï¼Œå¦‚æœå‡½æ•°ä½“æ²¡æœ‰returnï¼Œé‚£ä¹ˆæœ€åä¸€è¡Œä»£ç çš„è¾“å‡ºï¼Œå°±æ˜¯æ•´ä¸ªå‡½æ•°çš„è¿”å›å€¼~\n\nå…·ä½“åˆ°è¿™ä¸ªåŒ¿åå‡½æ•°ï¼Œå®ƒçš„è¿”å›ç»“æœå°±æ˜¯ä½ è¯´çš„Array[String]ï¼Œåç»­flatMapå†æŠŠè¿™é‡Œçš„Arrayå±•å¹³","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634287823,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312366,"user_name":"å¤§å®å½“","can_delete":false,"product_type":"c1","uid":1181578,"ip_address":"","ucode":"418EEFBD0C5A85","user_header":"https://static001.geekbang.org/account/avatar/00/12/07/8a/4bef6202.jpg","comment_is_top":false,"comment_ctime":1631775496,"is_pvip":false,"replies":[{"id":"113200","content":"Scalaè¯­æ³•ç¡®å®æ¯”è¾ƒçµæ´»ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œç®€å•è¡¨è¾¾å¼ç”¨()ï¼Œå¤æ‚è¡¨è¾¾å¼ç”¨{}ã€‚<br><br>æ¯”å¦‚ï¼Œç®€å•å‡½æ•°ä½“ï¼š(x =&gt; x + 1)ã€(_ + 1)ï¼Œç­‰ç­‰ï¼›<br>å¤æ‚å‡½æ•°ä½“ï¼š{case x: String =&gt; â€œä¸€å¤§å †å…³äºxçš„è½¬æ¢â€ }","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1631804383,"ip_address":"","comment_id":312366,"utype":1}],"discussion_count":4,"race_medal":0,"score":"10221710088","product_id":100090001,"comment_content":"åŒé—®è€å¸ˆ,AIKé—®çš„é—®é¢˜ï¼Œä»€ä¹ˆæ—¶å€™ç”¨å°æ‹¬å·ä»€ä¹ˆæ—¶å€™ç”¨èŠ±æ‹¬å·å•Šï¼Œæ„Ÿè§‰scalaå®åœ¨æœ‰ç‚¹è¿‡äºçµæ´»","like_count":3,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526952,"discussion_content":"Scalaè¯­æ³•ç¡®å®æ¯”è¾ƒçµæ´»ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œç®€å•è¡¨è¾¾å¼ç”¨()ï¼Œå¤æ‚è¡¨è¾¾å¼ç”¨{}ã€‚\n\næ¯”å¦‚ï¼Œç®€å•å‡½æ•°ä½“ï¼š(x =&amp;gt; x + 1)ã€(_ + 1)ï¼Œç­‰ç­‰ï¼›\nå¤æ‚å‡½æ•°ä½“ï¼š{case x: String =&amp;gt; â€œä¸€å¤§å †å…³äºxçš„è½¬æ¢â€ }","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631804383,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2759990,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/1d/36/a0a283f8.jpg","nickname":"åƒæ±Ÿæœ‰æ°´åƒæ±Ÿæœˆ","note":"","ucode":"23F5A65024CB67","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":407011,"discussion_content":"ä½ å…¶å®éƒ½å¯ä»¥ç”¨èŠ±æ‹¬å·è¡¨ç¤ºï¼Œåªæ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œå¯ä»¥ç”¨å°æ‹¬å·ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634891608,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1690884,"avatar":"https://static001.geekbang.org/account/avatar/00/19/cd/04/e27b7803.jpg","nickname":"å°æ–°","note":"","ucode":"DCAD04665E2CF8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2759990,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/1d/36/a0a283f8.jpg","nickname":"åƒæ±Ÿæœ‰æ°´åƒæ±Ÿæœˆ","note":"","ucode":"23F5A65024CB67","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534422,"discussion_content":"caseæ˜¯å•¥æ„æ€ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638185354,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":407011,"ip_address":""},"score":534422,"extra":""},{"author":{"id":2044188,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/bNQ1xdysiatMnMYpibXw70cpWPkuA2JXiaR0eDq7dia9oBic2z3SqFY84aRnEPH3QMgSklE6JSMZAPfKYukX6kPLoZQ/132","nickname":"Be_Young","note":"","ucode":"ACDBB2DD99738A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1690884,"avatar":"https://static001.geekbang.org/account/avatar/00/19/cd/04/e27b7803.jpg","nickname":"å°æ–°","note":"","ucode":"DCAD04665E2CF8","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554097,"discussion_content":"åº”è¯¥æ˜¯åå‡½æ•°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646213354,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":534422,"ip_address":""},"score":554097,"extra":""}]}]},{"had_liked":false,"id":339700,"user_name":"Spoon","can_delete":false,"product_type":"c1","uid":1959822,"ip_address":"","ucode":"2FF9193AD482C2","user_header":"https://static001.geekbang.org/account/avatar/00/1d/e7/8e/318cfde0.jpg","comment_is_top":false,"comment_ctime":1648300448,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5943267744","product_id":100090001,"comment_content":"æœ€åfilteræ›´å»ºè®®ç”¨Setè¿™ç§æ•°æ®ç»“æ„è¿›è¡ŒcontainæŸ¥è¯¢ï¼Œsetçš„ç®—æ³•å¤æ‚åº¦ä¸ºO(1)<br>æœ¬èŠ‚å†…å®¹Javaç‰ˆæœ¬å®ç°<br>https:&#47;&#47;github.com&#47;Spoon94&#47;spark-practice&#47;blob&#47;master&#47;src&#47;main&#47;java&#47;com&#47;spoon&#47;spark&#47;core&#47;TransformOpJob.java","like_count":2},{"had_liked":false,"id":317233,"user_name":"DMY","can_delete":false,"product_type":"c1","uid":1480819,"ip_address":"","ucode":"22C16ED954FC3A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/iaU7yVx9WnPfnpJBwGCCLWBy9SvkVQRMxmOBxyZTqRYFgPEEYa0pfUHAek6TNEp6SdFRwumUycSeCL7DaM6FotQ/132","comment_is_top":false,"comment_ctime":1634717907,"is_pvip":false,"replies":[{"id":"115125","content":"å¯ä»¥å‚è€ƒä¸‹é¢çš„æ–¹å¼æ¥å®ç°ï¼š<br><br>import scala.collection.mutable.ArrayBuffer<br><br>def f(iter: Iterator[Int]) : Iterator[Int] = {<br>   val dataSeq: ArrayBuffer[Int] = new ArrayBuffer()<br>   while (iter.hasNext) {<br>     val cur = iter.next;<br>     dataSeq += cur<br>   }<br>   &#47;&#47; ä½ çš„å¤„ç†é€»è¾‘<br>   val res = yourRPCFunction(dataSeq)<br>   &#47;&#47; ä»¥è¿­ä»£å™¨çš„å½¢å¼ï¼Œè¿”å›è®¡ç®—ç»“æœ<br>   res.iterator<br> }<br><br>&#47;&#47; å¤„ç†RDDçš„æ—¶å€™ï¼Œç”¨mapPartitionsè°ƒç”¨få³å¯<br>data.mapPartitions(f)","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1634889557,"ip_address":"","comment_id":317233,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5929685203","product_id":100090001,"comment_content":"æ•°æ®åšmapæ˜ å°„æ˜¯ä»¥å…ƒç´ ä¸ºç²’åº¦ï¼Œæ‰§è¡Œfå‡½æ•°ï¼›<br>è¿™é‡Œä¸šåŠ¡åœºæ™¯ä¸­ï¼Œfå‡½æ•°éœ€è¦è°ƒç”¨rpcï¼Œæ¯ä¸ªæ•°æ®è°ƒä¸€æ¬¡rpc+æ•°æ®é‡å¤§å°±ä¼šéå¸¸è€—æ—¶ã€‚<br>æ‰€ä»¥æƒ³æŠŠä¸€ç»„æ•°æ®æ‰“åŒ…æˆä¸€ä¸ªlistå‡å°‘rpcè°ƒç”¨ï¼Œæ¥æé«˜æ•ˆç‡ï¼Œè¿™é‡Œè¦æ€ä¹ˆå¤„ç†å‘¢","like_count":2,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528727,"discussion_content":"å¯ä»¥å‚è€ƒä¸‹é¢çš„æ–¹å¼æ¥å®ç°ï¼š\n\nimport scala.collection.mutable.ArrayBuffer\n\ndef f(iter: Iterator[Int]) : Iterator[Int] = {\n   val dataSeq: ArrayBuffer[Int] = new ArrayBuffer()\n   while (iter.hasNext) {\n     val cur = iter.next;\n     dataSeq += cur\n   }\n   // ä½ çš„å¤„ç†é€»è¾‘\n   val res = yourRPCFunction(dataSeq)\n   // ä»¥è¿­ä»£å™¨çš„å½¢å¼ï¼Œè¿”å›è®¡ç®—ç»“æœ\n   res.iterator\n }\n\n// å¤„ç†RDDçš„æ—¶å€™ï¼Œç”¨mapPartitionsè°ƒç”¨få³å¯\ndata.mapPartitions(f)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634889557,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312328,"user_name":"Geek_390836","can_delete":false,"product_type":"c1","uid":1896889,"ip_address":"","ucode":"201E23E1E61828","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKGiaLDlazWNmLnB7nGbHdH3g4Akx1LxJAjx4zrriaS7AWdUXfCzy2pyfhibJ4Z0LNnSOgcSvA39LuOQ/132","comment_is_top":false,"comment_ctime":1631753198,"is_pvip":false,"replies":[{"id":"113201","content":"å¥½é—®é¢˜~ <br><br>ä½ è¯´çš„å¯¹ï¼Œè¿™é‡Œç¬”è¯¯äº†ï¼Œå·²ç»è®©ç¼–è¾‘å¸®å¿™æ”¹æˆäº†â€œword.getbytesâ€å“ˆ~ <br><br>æ„Ÿè°¢çº æ­£~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1631805408,"ip_address":"","comment_id":312328,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5926720494","product_id":100090001,"comment_content":"å‚è€ƒmapå’ŒmapPartitionsï¼Œä¸ºä»€ä¹ˆmapPartitionsä¸­çš„mapï¼Œæ˜¯å¯¹recordè¿›è¡Œgetbytesè€Œä¸æ˜¯word.getbytesæ“ä½œï¼Œåˆšå­¦sparkï¼Œæ±‚è€å¸ˆè§£ç­”","like_count":2,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526939,"discussion_content":"å¥½é—®é¢˜~ \n\nä½ è¯´çš„å¯¹ï¼Œè¿™é‡Œç¬”è¯¯äº†ï¼Œå·²ç»è®©ç¼–è¾‘å¸®å¿™æ”¹æˆäº†â€œword.getbytesâ€å“ˆ~ \n\næ„Ÿè°¢çº æ­£~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631805408,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":343524,"user_name":"ç‰§ä¸€å°”","can_delete":false,"product_type":"c1","uid":1333409,"ip_address":"","ucode":"562640F2130207","user_header":"https://static001.geekbang.org/account/avatar/00/14/58/a1/6e33ffc7.jpg","comment_is_top":false,"comment_ctime":1650891378,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1650891378","product_id":100090001,"comment_content":"è¯¾åå›ç­”<br>ç¬¬ä¸€é¢˜ï¼šåº”ç”¨ä¸ºæŒ‰ç…§åˆ†åŒºç´¢å¼•åšå®šåˆ¶åŒ–æ“ä½œ<br>ç¬¬äºŒé¢˜ï¼šå…±æ€§ä¸ºéƒ½æ˜¯è½¬æ¢ç®—å­ï¼Œå¹¶éè¡ŒåŠ¨ç®—å­<br>ç¬¬ä¸‰é¢˜ï¼šä¹‹å‰æ²¡ç”¨è¿‡ mapPartitions ç®—å­ï¼Œä¹Ÿä¸çŸ¥é“ï¼Œçœ‹æ¥ä¸‹ä»£ç ï¼Œå‘ç°äº†å¯ä»¥å¾ˆå¤šç”¨è¿™ä¸ªç®—å­åšä¼˜åŒ–çš„åœ°æ–¹","like_count":1},{"had_liked":false,"id":341781,"user_name":"æˆ‘çˆ±å¤œæ¥é¦™","can_delete":false,"product_type":"c1","uid":2609930,"ip_address":"","ucode":"10761E677EF05F","user_header":"https://static001.geekbang.org/account/avatar/00/27/d3/0a/92640aae.jpg","comment_is_top":false,"comment_ctime":1649831506,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1649831506","product_id":100090001,"comment_content":"è€å¸ˆ,mapç®—å­é’ˆå¯¹ä¸€ä¸ªä¸ªå…ƒç´ è¿›è¡Œfæ“ä½œ,è¿™ä¸ªå…ƒç´ æ˜¯å’‹å®šä¹‰çš„,ä¸€è¡Œ?","like_count":0,"discussions":[{"author":{"id":2941084,"avatar":"","nickname":"Geek_ce7292","note":"","ucode":"7C89258611315E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583676,"discussion_content":"æˆ‘è§‰å¾—è¿™è¾¹çš„å…ƒç´ åº”è¯¥æ˜¯RDDä¸­å…ƒç´ çš„ç±»å‹~\n\næ¯”å¦‚ä¸Šæ–‡ä¸­æåˆ°çš„ï¼š\n\nlineRDDçš„ç±»å‹ä¸ºï¼šRDD[String],æ¯ä¸ªå…ƒç´ çš„ç±»å‹ä¸ºStringï¼Œå³ä¸€è¡Œæ–‡æœ¬ï¼›\n\nwordRDDçš„ç±»å‹ä¸ºï¼šRDD[String],æ¯ä¸ªå…ƒç´ çš„ç±»å‹ä¸ºStringï¼Œæ˜¯æŒ‡æ¯ä¸€ä¸ªå•è¯ï¼›\n\nkvRDDçš„ç±»å‹ä¸ºï¼šRDD[(Stringï¼ŒInt)],æ¯ä¸ªå…ƒç´ çš„ç±»å‹ä¸º(Stringï¼ŒInt)ï¼Œæ˜¯æŒ‡ä¸€ä¸ªé”®å€¼å¯¹ï¼›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660286559,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸­å›½é¦™æ¸¯"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":335512,"user_name":"æœ¨ä¹‹ä¸Š","can_delete":false,"product_type":"c1","uid":2579938,"ip_address":"","ucode":"EE9710F7FAFCCF","user_header":"https://static001.geekbang.org/account/avatar/00/27/5d/e2/1587b1b3.jpg","comment_is_top":false,"comment_ctime":1645546633,"is_pvip":true,"replies":[{"id":"122664","content":"æ˜¯çš„ï¼Œæ²¡æœ‰é—®é¢˜~ JAVA8å¼€å§‹æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹ï¼Œå®ƒçš„streamæœ¬è´¨ä¸Šå’Œå’±ä»¬è¿™é‡Œçš„ç®—å­æ˜¯ä¸€æ ·çš„~","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1043100","ctime":1645673032,"ip_address":"","comment_id":335512,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1645546633","product_id":100090001,"comment_content":"è€å¸ˆï¼Œåœ¨å­¦ä¹ è¿™äº›ç®—å­çš„æ—¶å€™ï¼Œåƒmapï¼Œflatmapæ˜¯å¦å¯ä»¥ç±»æ¯”JAVA8çš„lambdaè¡¨è¾¾å¼+streamæµå»å­¦ä¹ ","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552974,"discussion_content":"æ˜¯çš„ï¼Œæ²¡æœ‰é—®é¢˜~ JAVA8å¼€å§‹æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹ï¼Œå®ƒçš„streamæœ¬è´¨ä¸Šå’Œå’±ä»¬è¿™é‡Œçš„ç®—å­æ˜¯ä¸€æ ·çš„~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645673033,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":329220,"user_name":"è‰¾åˆ©ç‰¹-G","can_delete":false,"product_type":"c1","uid":1195204,"ip_address":"","ucode":"8C4DA0ABE77CDC","user_header":"https://static001.geekbang.org/account/avatar/00/12/3c/c4/4ee2968a.jpg","comment_is_top":false,"comment_ctime":1641217366,"is_pvip":false,"replies":[{"id":"120192","content":"èµğŸ‘ï¼Œæ„Ÿè°¢è€å¼Ÿçš„æ•´ç†~","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1043100","ctime":1641719462,"ip_address":"","comment_id":329220,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1641217366","product_id":100090001,"comment_content":"&#47;&#47; ç›¸é‚»è¯æ±‡è®¡æ•°ç»Ÿè®¡<br>package com.shouneng<br><br>import org.apache.spark.rdd.RDD<br>import org.apache.spark.{SparkConf, SparkContext}<br><br>object NeighboringWordCount {<br>  def main(args: Array[String]) {<br>    try {<br>      val conf =<br>        new SparkConf().setAppName(&quot;NeighboringWordCount&quot;).setMaster(&quot;local[1]&quot;)<br>      val sparkContext = new SparkContext(conf)<br>      val rootPath: String = &quot;file:&#47;&#47;&quot;<br>      val file: String =<br>        s&quot;${rootPath}&#47;home&#47;shouneng&#47;geektime&#47;Getting_Started_with_Spark&#47;chapter01&#47;wikiOfSpark.txt&quot;<br><br>      &#47;&#47; è¯»å–æ–‡ä»¶å†…å®¹<br>      val lineRDD: RDD[String] = sparkContext.textFile(file)<br>      &#47;&#47;   val wordRDD: RDD[String] = lineRDD.flatMap(line =&gt; line.split(&quot; &quot;))<br>      &#47;&#47;   val cleanWordRDD: RDD[String] = wordRDD.filter(word =&gt; !word.equals(&quot;&quot;))<br><br>      val wordPairRDD: RDD[String] = lineRDD.flatMap(line =&gt; {<br>        val words: Array[String] =<br>          line.split(&quot; &quot;).filter(word =&gt; !word.equals(&quot;&quot;))<br>        for (i &lt;- 0 until words.length - 1) yield words(i) + &quot;-&quot; + words(i + 1)<br>      })<br>      val kvRDD: RDD[(String, Int)] = wordPairRDD.map(wordPair =&gt; (wordPair, 1))<br>      val wordCounts: RDD[(String, Int)] = kvRDD.reduceByKey((x, y) =&gt; x + y)<br><br>      wordCounts<br>        .map { case (k, v) =&gt; (v, k) }<br>        .sortByKey(false)<br>        .take(5)<br>        .foreach(println)<br>    } catch {<br>      case ex: Exception =&gt; {<br>        ex.printStackTrace() &#47;&#47; æ‰“å°åˆ°æ ‡å‡†err<br>        System.err.println(&quot;exception===&gt;: ...&quot;) &#47;&#47; æ‰“å°åˆ°æ ‡å‡†err<br>      }<br>    }<br>  }<br>}","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":544799,"discussion_content":"èµğŸ‘ï¼Œæ„Ÿè°¢è€å¼Ÿçš„æ•´ç†~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641719462,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":320157,"user_name":"å­™æµ©","can_delete":false,"product_type":"c1","uid":1681527,"ip_address":"","ucode":"09A77A8D5CAF25","user_header":"https://static001.geekbang.org/account/avatar/00/19/a8/77/08ee51cb.jpg","comment_is_top":false,"comment_ctime":1636102356,"is_pvip":true,"replies":[{"id":"116285","content":"å¹¶æ²¡æœ‰å“ˆï¼Œåœ¨è¿è¡Œæ—¶ï¼Œmapå’ŒmapPartitionséƒ½æ˜¯ä»¥åˆ†åŒºä¸ºç²’åº¦ï¼Œåˆ›å»ºåˆ†å¸ƒå¼ä»»åŠ¡ã€‚æ¢å¥è¯è¯´ï¼Œmapå’ŒmapPartitionsä¸¤è€…åœ¨è¿è¡Œæ—¶ï¼ŒTasksçš„æ•°é‡æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥å¹¶ä¸å­˜åœ¨ä½ è¯´çš„ä»»åŠ¡ä¸ä»»åŠ¡ä¹‹é—´å¯¹è±¡é”çš„é—®é¢˜","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1636435236,"ip_address":"","comment_id":320157,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1636102356","product_id":100090001,"comment_content":"å´è€å¸ˆï¼ŒmapPartitionsçš„æ˜¯ä¸æ˜¯ä¹Ÿé¿å…äº†å¯¹è±¡é”çš„é—®é¢˜ï¼Œå› ä¸ºpartitionså¯¹åº”çš„ä¹Ÿæ˜¯ä»»åŠ¡æ•°ã€‚","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529898,"discussion_content":"å¹¶æ²¡æœ‰å“ˆï¼Œåœ¨è¿è¡Œæ—¶ï¼Œmapå’ŒmapPartitionséƒ½æ˜¯ä»¥åˆ†åŒºä¸ºç²’åº¦ï¼Œåˆ›å»ºåˆ†å¸ƒå¼ä»»åŠ¡ã€‚æ¢å¥è¯è¯´ï¼Œmapå’ŒmapPartitionsä¸¤è€…åœ¨è¿è¡Œæ—¶ï¼ŒTasksçš„æ•°é‡æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥å¹¶ä¸å­˜åœ¨ä½ è¯´çš„ä»»åŠ¡ä¸ä»»åŠ¡ä¹‹é—´å¯¹è±¡é”çš„é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636435236,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":320150,"user_name":"å­™æµ©","can_delete":false,"product_type":"c1","uid":1681527,"ip_address":"","ucode":"09A77A8D5CAF25","user_header":"https://static001.geekbang.org/account/avatar/00/19/a8/77/08ee51cb.jpg","comment_is_top":false,"comment_ctime":1636099997,"is_pvip":true,"replies":[{"id":"116284","content":"å¥½é—®é¢˜ï¼Œ<br>1ï¼‰ï¼ˆKï¼ŒVï¼‰å¯ä»¥ç†è§£æˆæ˜¯å…ƒç»„ï¼Œè¿™ä¸ªæ²¡æœ‰é—®é¢˜<br>2ï¼‰å…³äºreduceByKeyä¸ºå•¥ä¸æ”¯æŒRDD[Map[String,Int]]ï¼Œè¿™ä¸ªå…¶å®è€å¼Ÿéœ€è¦å……åˆ†ç†è§£PairRDDï¼Œå°±RDD[Map[String,Int]]è¿™ç§ç±»å‹æ¥è¯´ï¼Œæœ¬è´¨ä¸Šï¼Œä»–å…¶å®æ˜¯RDD[KeyType]ï¼Œè€Œä¸æ˜¯RDD[(KeyTypeï¼ŒValueType)]ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒRDD[Map[String,Int]]ä¸æ˜¯PairRDDï¼Œæ‰€ä»¥ä¸ä»…reduceByKeyä¸æ”¯æŒï¼Œå…¶ä»–*ByKeyç±»æ“ä½œä¹Ÿä¸æ”¯æŒã€‚å¦‚æœæŠŠå®ƒå˜æ¢ä¸€ä¸‹ï¼Œæ¯”å¦‚RDD[(Stringï¼ŒMap[String,Int])]ï¼Œè¿™æ ·æ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºè¿™ä¸ªç±»å‹å±äºPairRDDï¼ŒKeyTypeæ˜¯Stringï¼Œè€ŒValueTypeæ˜¯Map[String,Int]~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1636435034,"ip_address":"","comment_id":320150,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1636099997","product_id":100090001,"comment_content":"æœ‰ç–‘é—®ï¼Œå´è€å¸ˆï¼ŒPariedRDDä¸­çš„ï¼ˆKï¼ŒVï¼‰ï¼Œ1.å¯¹åº”çš„æ•°æ®ç±»å‹åº”è¯¥æ˜¯scalaä¸­çš„å…ƒç»„å§ï¼Ÿ2.reduceByKeyä¸ºå•¥ä¸æ”¯æŒå…ƒç´ æ˜¯mapç±»å‹ï¼Ÿæˆ–è€…å¦‚æœæˆ‘å­˜åœ¨ä¸€ä¸ªRDD[Map[String,Int]]ï¼Œæˆ‘æƒ³åšreduceByKeyæ“ä½œï¼Œåº”è¯¥æ€ä¹ˆå®ç°ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529896,"discussion_content":"å¥½é—®é¢˜ï¼Œ\n1ï¼‰ï¼ˆKï¼ŒVï¼‰å¯ä»¥ç†è§£æˆæ˜¯å…ƒç»„ï¼Œè¿™ä¸ªæ²¡æœ‰é—®é¢˜\n2ï¼‰å…³äºreduceByKeyä¸ºå•¥ä¸æ”¯æŒRDD[Map[String,Int]]ï¼Œè¿™ä¸ªå…¶å®è€å¼Ÿéœ€è¦å……åˆ†ç†è§£PairRDDï¼Œå°±RDD[Map[String,Int]]è¿™ç§ç±»å‹æ¥è¯´ï¼Œæœ¬è´¨ä¸Šï¼Œä»–å…¶å®æ˜¯RDD[KeyType]ï¼Œè€Œä¸æ˜¯RDD[(KeyTypeï¼ŒValueType)]ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒRDD[Map[String,Int]]ä¸æ˜¯PairRDDï¼Œæ‰€ä»¥ä¸ä»…reduceByKeyä¸æ”¯æŒï¼Œå…¶ä»–*ByKeyç±»æ“ä½œä¹Ÿä¸æ”¯æŒã€‚å¦‚æœæŠŠå®ƒå˜æ¢ä¸€ä¸‹ï¼Œæ¯”å¦‚RDD[(Stringï¼ŒMap[String,Int])]ï¼Œè¿™æ ·æ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºè¿™ä¸ªç±»å‹å±äºPairRDDï¼ŒKeyTypeæ˜¯Stringï¼Œè€ŒValueTypeæ˜¯Map[String,Int]~","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1636435034,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":317916,"user_name":"å°å¼º","can_delete":false,"product_type":"c1","uid":2398148,"ip_address":"","ucode":"C3D1215867302D","user_header":"https://static001.geekbang.org/account/avatar/00/24/97/c4/6c92c78a.jpg","comment_is_top":false,"comment_ctime":1635052054,"is_pvip":false,"replies":[{"id":"115468","content":"å¯ä»¥å‚è€ƒè¯„è®ºåŒºâ€œå´”å°è±ªâ€åŒå­¦ä¸‹é¢çš„å›å¤ï¼Œå±äºåŒä¸€ç±»é—®é¢˜ï¼šæ•°ç»„è¶Šç•Œ~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1635261396,"ip_address":"","comment_id":317916,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1635052054","product_id":100090001,"comment_content":"import org.apache.spark.rdd.RDD<br> <br>&#47;&#47; è¿™é‡Œçš„ä¸‹åˆ’çº¿&quot;_&quot;æ˜¯å ä½ç¬¦ï¼Œä»£è¡¨æ•°æ®æ–‡ä»¶çš„æ ¹ç›®å½•<br>val rootPath: String = &quot;&#47;home&#47;gxchen&#47;Spark&#47;01-wordCount&quot;<br>val file: String = s&quot;${rootPath}&#47;wikiOfSpark.txt&quot;<br> <br>&#47;&#47; è¯»å–æ–‡ä»¶å†…å®¹<br>val lineRDD: RDD[String] = spark.sparkContext.textFile(file)<br> <br>&#47;&#47; ä»¥è¡Œä¸ºå•ä½åšåˆ†è¯<br>val wordPairRDD: RDD[String] = lineRDD.flatMap(line =&gt; {<br>\tval words: Array[String] = line.split(&quot; &quot;)<br>\tfor (i &lt;- 0 until words.length - 1) yield words(i) + &quot;-&quot; + words(i+1)<br>})<br><br><br><br>&#47;&#47; å®šä¹‰ç‰¹æ®Šå­—ç¬¦åˆ—è¡¨<br>val list: List[String] = List(&quot;&amp;&quot;, &quot;|&quot;, &quot;#&quot;, &quot;^&quot;, &quot;@&quot;)<br> <br>&#47;&#47; å®šä¹‰åˆ¤å®šå‡½æ•°f<br>def f(s: String): Boolean = {<br>\tval words: Array[String] = s.split(&quot;-&quot;)<br>\tval b1: Boolean = list.contains(words(0))<br>\tval b2: Boolean = list.contains(words(1))<br>\treturn !b1 &amp;&amp; !b2 &#47;&#47; è¿”å›ä¸åœ¨ç‰¹æ®Šå­—ç¬¦åˆ—è¡¨ä¸­çš„è¯æ±‡å¯¹<br>}<br> <br>&#47;&#47; ä½¿ç”¨filter(f)å¯¹RDDè¿›è¡Œè¿‡æ»¤<br>val cleanWordPairRDD: RDD[String] = wordPairRDD.filter(f)<br><br>&#47;&#47; æŠŠRDDå…ƒç´ è½¬æ¢ä¸ºï¼ˆKeyï¼ŒValueï¼‰çš„å½¢å¼<br>val kvRDD: RDD[(String, Int)] = cleanWordPairRDD.map(wordPair =&gt; (wordPair, 1))<br>&#47;&#47; æŒ‰ç…§å•è¯åšåˆ†ç»„è®¡æ•°<br>val wordPairCounts: RDD[(String, Int)] = kvRDD.reduceByKey((x, y) =&gt; x + y)<br> <br>&#47;&#47; æ‰“å°è¯é¢‘æœ€é«˜çš„5ä¸ªè¯æ±‡<br>wordPairCounts.map{case (k, v) =&gt; (v, k)}.sortByKey(false).take(5)<br><br><br>è¿è¡Œäº†ä»¥ä¸Šä»£ç åï¼ŒæŠ¥é”™ã€‚æƒ³äº†åŠå¤©ä¹Ÿæ²¡å¼„æ˜ç™½ï¼Œæ±‚åŠ©ä¸€ä¸‹ï¼<br>21&#47;10&#47;24 04:58:42 ERROR Executor: Exception in task 1.0 in stage 2.0 (TID 3)<br>java.lang.ArrayIndexOutOfBoundsException: 1<br>        at $line33.$read$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw.f(&lt;console&gt;:29)<br>        at $line34.$read$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw.$anonfun$cleanWordPairRDD$1(&lt;console&gt;:27)<br><br>21&#47;10&#47;24 04:58:42 WARN TaskSetManager: Lost task 1.0 in stage 2.0 (TID 3) (localhost executor driver): java.lang.ArrayIndexOutOfBoundsException: 1<br><br>21&#47;10&#47;24 04:58:42 ERROR TaskSetManager: Task 1 in stage 2.0 failed 1 times; aborting job<br>21&#47;10&#47;24 04:58:42 ERROR Executor: Exception in task 0.0 in stage 2.0 (TID 2)<br><br>21&#47;10&#47;24 04:58:42 WARN TaskSetManager: Lost task 0.0 in stage 2.0 (TID 2) (localhost executor driver): java.lang.ArrayIndexOutOfBoundsException: 0","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529028,"discussion_content":"å¯ä»¥å‚è€ƒè¯„è®ºåŒºâ€œå´”å°è±ªâ€åŒå­¦ä¸‹é¢çš„å›å¤ï¼Œå±äºåŒä¸€ç±»é—®é¢˜ï¼šæ•°ç»„è¶Šç•Œ~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635261396,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313798,"user_name":"å­å…®","can_delete":false,"product_type":"c1","uid":2767208,"ip_address":"","ucode":"BA213EAB26DF16","user_header":"https://static001.geekbang.org/account/avatar/00/2a/39/68/56dfc8c0.jpg","comment_is_top":false,"comment_ctime":1632668741,"is_pvip":false,"replies":[{"id":"113764","content":"å¯ä»¥å‚è€ƒUnknown Elementçš„å›ç­”ï½ måœ¨filterå¤–ï¼Œæ˜¯driveråˆ›å»ºï¼Œéœ€è¦èµ°ç½‘ç»œã€åºåˆ—åŒ–ã€‚è€Œmåœ¨filterå†…ï¼Œåˆ™æ˜¯åœ¨executoråˆ›å»ºï¼Œä¸éœ€è¦ä»driveråˆ†å‘è¿‡å»","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1632831012,"ip_address":"","comment_id":313798,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1632668741","product_id":100090001,"comment_content":"è€å¸ˆï¼Œè¯·é—®ï¼Œä¸€ä¸ªå˜é‡mè¢«filter ç®—å­å†…éƒ¨è®¡ç®—æ—¶ä½¿ç”¨ï¼Œè‹¥må®šä¹‰åœ¨äº†filterç®—å­æ‰€åœ¨å‡½æ•°å†…ï¼Œä¹Ÿå°±æ˜¯å˜é‡å’Œç®—å­åœ¨åŒä¸€ä¸ªå‡½æ•°é‡Œï¼Œå°±ä¸ä¼šæŠ¥åºåˆ—åŒ–é—®é¢˜ï¼Œè‹¥å®šä¹‰åœ¨äº†å‡½æ•°ä¹‹å¤–å°±ä¼šæŠ¥åºåˆ—åŒ–é—®é¢˜ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿçœ‹äº†ä¸€äº›è§£é‡Šï¼Œè¯´æ˜¯å‡½æ•°é—­åŒ…ï¼Œä¹Ÿä¸æ˜¯å¾ˆç†è§£","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527477,"discussion_content":"å¯ä»¥å‚è€ƒUnknown Elementçš„å›ç­”ï½ måœ¨filterå¤–ï¼Œæ˜¯driveråˆ›å»ºï¼Œéœ€è¦èµ°ç½‘ç»œã€åºåˆ—åŒ–ã€‚è€Œmåœ¨filterå†…ï¼Œåˆ™æ˜¯åœ¨executoråˆ›å»ºï¼Œä¸éœ€è¦ä»driveråˆ†å‘è¿‡å»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632831012,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312625,"user_name":"é’±é¹ Allen","can_delete":false,"product_type":"c1","uid":2518863,"ip_address":"","ucode":"7E95E82C0717DA","user_header":"https://static001.geekbang.org/account/avatar/00/26/6f/4f/3cf1e9c4.jpg","comment_is_top":false,"comment_ctime":1631895628,"is_pvip":true,"replies":[{"id":"113341","content":"æ­£è§£~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1632051321,"ip_address":"","comment_id":312625,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1631895628","product_id":100090001,"comment_content":"mapPartitionsWithIndex  éœ€è¦ç»“åˆåˆ†åŒºç´¢å¼•ä½¿ç”¨<br>map filter flatMap mapPartitions mapPartitionsWithIndex  é€šè¿‡å‡½æ•°ï¼Œä¼ é€’å‚æ•°ï¼Œè¿”å›æ–°çš„RDD<br>mapPartitions é‡‡é›†ç³»ç»Ÿä¸­ï¼Œåªéœ€å®ä¾‹åŒ–ä¸€æ¬¡ç”µè¡¨å·ï¼Œå¯è¯»å…¶ä»–å„ç±»è¯»æ•°","like_count":1,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527052,"discussion_content":"æ­£è§£~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632051321,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312432,"user_name":"è¿›","can_delete":false,"product_type":"c1","uid":2754963,"ip_address":"","ucode":"B971F478E3BE8E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/hSGZCTvHTKaJH5WibTcC15qDKYpGdgdMFEV6mwcslOFoADP6skWCpBiae2ykkaBFDaexEY9xXBPhZMAGmj1nW8vA/132","comment_is_top":false,"comment_ctime":1631797974,"is_pvip":false,"replies":[{"id":"113196","content":"è°¢è°¢æ”¯æŒï¼Œæ˜å¤©å°±æ¥äº†ã€‚ä¹Ÿæ¬¢è¿å¤šåœ¨è¯„è®ºåŒºäº¤æµã€‚","user_name":"ç¼–è¾‘å›å¤","user_name_real":"èµµå®‡æ–°","uid":"1501385","ctime":1631798185,"ip_address":"","comment_id":312432,"utype":2}],"discussion_count":1,"race_medal":1,"score":"1631797974","product_id":100090001,"comment_content":"æœŸå¾…ä¸‹ä¸€è®²....","like_count":0,"discussions":[{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"å¬æ°´çš„æ¹–","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526966,"discussion_content":"è°¢è°¢æ”¯æŒï¼Œæ˜å¤©å°±æ¥äº†ã€‚ä¹Ÿæ¬¢è¿å¤šåœ¨è¯„è®ºåŒºäº¤æµã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631798185,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312350,"user_name":"æ±‚ç´¢","can_delete":false,"product_type":"c1","uid":1243895,"ip_address":"","ucode":"26A80D3BFB3E3A","user_header":"https://static001.geekbang.org/account/avatar/00/12/fa/f7/a6f40eee.jpg","comment_is_top":false,"comment_ctime":1631763586,"is_pvip":false,"replies":[{"id":"113204","content":"è¿™é‡Œçš„èµ„æºï¼Œå…·ä½“æŒ‡çš„æ˜¯å“ªç±»èµ„æºå‘¢ï¼ŸCPUã€å†…å­˜ã€ç£ç›˜è¿˜æ˜¯ç½‘ç»œï¼Ÿ<br><br>æˆ‘ç†è§£ï¼Œå¬ä¸Šå»æ˜¯CPUèµ„æºé—²ç½®ï¼Œä¹Ÿå°±æ˜¯åˆ©ç”¨ç‡ä¸é«˜ã€‚å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œé‚£ä¹ˆå¤§æ¦‚ç‡æ˜¯å› ä¸ºä»»åŠ¡æ—¶é—´å¤§éƒ¨åˆ†éƒ½èŠ±åœ¨I&#47;O waitä¸Šäº†ã€‚ä¹Ÿå°±æ˜¯CPUä¸€ç›´åœ¨â€œç­‰æ´»å„¿å¹²â€ï¼ŒCPUé—²ç½®æœŸé—´ï¼Œä»»åŠ¡çš„ä¸»è¦æ“ä½œå¾ˆå¯èƒ½æ˜¯ShuffleæœŸé—´çš„ç£ç›˜I&#47;Oå’Œç½‘ç»œI&#47;Oï¼Œè¿™ä¸ªæ—¶å€™ï¼ŒCPUç¡®å®æ²¡ä»€ä¹ˆæ´»å„¿å¯å¹²ï¼Œåªèƒ½ç­‰ï¼Œæ‰€ä»¥çœ‹ä¸Šå»æ˜¯CPUé—²ç½®ï¼Œå®åˆ™æ˜¯å®ƒåœ¨â€œç­‰æ´»å„¿â€~<br><br>è§£å†³åŠæ³•çš„è¯ï¼Œå¯ä»¥å›´ç»•ç€æå‡Shuffleçš„æ•ˆç‡å»å±•å¼€ï¼Œè¿™éƒ¨åˆ†æˆ‘ä»¬åœ¨åé¢çš„Shuffleå’ŒBroadcast Joinéƒ¨åˆ†ä¼šè®²ï¼Œæ•¬è¯·æœŸå¾…~<br><br>å½“ç„¶ï¼Œè¿™äº›åˆ†æï¼Œéƒ½æ˜¯åŸºäºå¯¹èµ„æºæ˜¯CPUçš„å‡è®¾ï¼Œå¦‚æœæ˜¯å…¶ä»–èµ„æºï¼Œæˆ‘ä»¬å†è®¨è®º~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1631806969,"ip_address":"","comment_id":312350,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1631763586","product_id":100090001,"comment_content":"è¯·æ•™ä¸ªé—®é¢˜ï¼Œspark sqlæ‰§è¡Œç¼“æ…¢ï¼Œç„¶è€Œèµ„æºå´é—²ç½®çŠ¶æ€ï¼Œè¿™æ˜¯ä½•è§£","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526947,"discussion_content":"è¿™é‡Œçš„èµ„æºï¼Œå…·ä½“æŒ‡çš„æ˜¯å“ªç±»èµ„æºå‘¢ï¼ŸCPUã€å†…å­˜ã€ç£ç›˜è¿˜æ˜¯ç½‘ç»œï¼Ÿ\n\næˆ‘ç†è§£ï¼Œå¬ä¸Šå»æ˜¯CPUèµ„æºé—²ç½®ï¼Œä¹Ÿå°±æ˜¯åˆ©ç”¨ç‡ä¸é«˜ã€‚å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œé‚£ä¹ˆå¤§æ¦‚ç‡æ˜¯å› ä¸ºä»»åŠ¡æ—¶é—´å¤§éƒ¨åˆ†éƒ½èŠ±åœ¨I/O waitä¸Šäº†ã€‚ä¹Ÿå°±æ˜¯CPUä¸€ç›´åœ¨â€œç­‰æ´»å„¿å¹²â€ï¼ŒCPUé—²ç½®æœŸé—´ï¼Œä»»åŠ¡çš„ä¸»è¦æ“ä½œå¾ˆå¯èƒ½æ˜¯ShuffleæœŸé—´çš„ç£ç›˜I/Oå’Œç½‘ç»œI/Oï¼Œè¿™ä¸ªæ—¶å€™ï¼ŒCPUç¡®å®æ²¡ä»€ä¹ˆæ´»å„¿å¯å¹²ï¼Œåªèƒ½ç­‰ï¼Œæ‰€ä»¥çœ‹ä¸Šå»æ˜¯CPUé—²ç½®ï¼Œå®åˆ™æ˜¯å®ƒåœ¨â€œç­‰æ´»å„¿â€~\n\nè§£å†³åŠæ³•çš„è¯ï¼Œå¯ä»¥å›´ç»•ç€æå‡Shuffleçš„æ•ˆç‡å»å±•å¼€ï¼Œè¿™éƒ¨åˆ†æˆ‘ä»¬åœ¨åé¢çš„Shuffleå’ŒBroadcast Joinéƒ¨åˆ†ä¼šè®²ï¼Œæ•¬è¯·æœŸå¾…~\n\nå½“ç„¶ï¼Œè¿™äº›åˆ†æï¼Œéƒ½æ˜¯åŸºäºå¯¹èµ„æºæ˜¯CPUçš„å‡è®¾ï¼Œå¦‚æœæ˜¯å…¶ä»–èµ„æºï¼Œæˆ‘ä»¬å†è®¨è®º~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631806969,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1243895,"avatar":"https://static001.geekbang.org/account/avatar/00/12/fa/f7/a6f40eee.jpg","nickname":"æ±‚ç´¢","note":"","ucode":"26A80D3BFB3E3A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394378,"discussion_content":"æ‚¨å¥½ï¼Œéå¸¸é«˜å…´çœ‹åˆ°æ‚¨çš„å›å¤ï¼Œæˆ‘è®²çš„èµ„æºä¸ä»…ä»…æ˜¯cpuè¿˜åŒ…æ‹¬å†…å­˜ï¼Œioç­‰ï¼Œä»èµ„æºç›‘æ§ä¸Šçœ‹éƒ½éå¸¸ç©ºé—²ï¼Œjobé…ç½®èµ„æºæ— è®ºå¢åŠ å‡å°‘ä¹Ÿæ²¡æœ‰èµ·åˆ°ä½œç”¨ï¼Œä¾ç„¶æ‰§è¡Œå¾ˆæ…¢ã€‚æœ‰ç‚¹è¿·ç³Šï¼Œä¸æ¸…æ¥šå“ªé‡Œæœ‰é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631862560,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":1243895,"avatar":"https://static001.geekbang.org/account/avatar/00/12/fa/f7/a6f40eee.jpg","nickname":"æ±‚ç´¢","note":"","ucode":"26A80D3BFB3E3A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":399145,"discussion_content":"å¯ä»¥æŠŠSQLè´´å‡ºæ¥ï¼Œä¸€èµ·åˆ†æåˆ†æï¼ŒåŒ…æ‹¬é›†ç¾¤èµ„æºé…ç½®ï¼Œç­‰ç­‰ç»†èŠ‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1632911054,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":394378,"ip_address":""},"score":399145,"extra":""}]}]},{"had_liked":false,"id":312233,"user_name":"GACÂ·DU","can_delete":false,"product_type":"c1","uid":1385403,"ip_address":"","ucode":"7847FBE1C13740","user_header":"https://static001.geekbang.org/account/avatar/00/15/23/bb/a1a61f7c.jpg","comment_is_top":false,"comment_ctime":1631696848,"is_pvip":true,"replies":[{"id":"113203","content":"1ï¼‰ã€2ï¼‰ã€3ï¼‰éƒ½æ²¡é—®é¢˜~<br><br>å…³äºScalaçš„è¯­æ³•ï¼Œç¡®å®æ¯”è¾ƒçµæ´»ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œç®€å•è¡¨è¾¾å¼ç”¨()ï¼Œå¤æ‚è¡¨è¾¾å¼ç”¨{}ã€‚<br><br>æ¯”å¦‚ï¼Œç®€å•å‡½æ•°ä½“ï¼š(x =&gt; x + 1)ã€(_ + 1)ï¼Œç­‰ç­‰ï¼›<br>å¤æ‚å‡½æ•°ä½“ï¼š{case x: String =&gt; â€œä¸€å¤§å †å…³äºxçš„è½¬æ¢â€ }","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1631806114,"ip_address":"","comment_id":312233,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1631696848","product_id":100090001,"comment_content":"1ã€mapPartitionsWithIndexçš„åº”ç”¨åœºæ™¯ï¼šè·å–æ•°æ®æ‰€åœ¨çš„åˆ†åŒºå¹¶å¯¹ç‰¹å®šåˆ†åŒºæ•°æ®è¿›è¡Œç‰¹å®šå¤„ç†ã€‚<br>2ã€è¿™äº›ç®—å­é¦–å…ˆéƒ½æ˜¯æƒ°æ€§ç®—å­ï¼Œåˆéƒ½ä½¿ç”¨å‡½æ•°ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œè¾¾åˆ°ä¸€å¯¹ä¸€çš„æ•ˆæœã€‚<br>3ã€åœ¨mapPatitionsä¸­åªåˆ›å»ºè¿‡è¿æ¥æ•°æ®åº“çš„å…±äº«å¯¹è±¡ï¼Œå…¶ä»–çš„æ²¡æœ‰é‡åˆ°è¿‡ï¼Œè¿˜è¯·è€å¸ˆèƒ½ä¸èƒ½å¤šç»™å‡ ä¸ªå®é™…æ¡ˆä¾‹ï¼Œæé«˜ä¸€ä¸‹å¯¹mapPatitionsçš„è®¤çŸ¥ã€‚<br>è¿˜æƒ³å‘è€å¸ˆæä¸ªé—®é¢˜ï¼šscalaç¼–ç¨‹sparkä»€ä¹ˆæ—¶å€™ç”¨å°æ‹¬å·,ä»€ä¹ˆæ—¶å€™ç”¨ç”¨èŠ±æ‹¬å·ï¼Ÿ<br>wordCount.map{case (k, v) =&gt; (v, k)}.sortByKey(false).take(5)<br>è¿™æ®µä»£ç å¯¹äºä¸ºä»€ä¹ˆä½¿ç”¨èŠ±æ‹¬å·ï¼Œä¸æ˜¯å¾ˆæ¸…æ™°ï¼Œå°è¯•è¿‡ç”¨å°æ‹¬å·ï¼Œä½†æ˜¯æ— æ³•è°ƒç”¨sortByKeyã€‚","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526905,"discussion_content":"1ï¼‰ã€2ï¼‰ã€3ï¼‰éƒ½æ²¡é—®é¢˜~\n\nå…³äºScalaçš„è¯­æ³•ï¼Œç¡®å®æ¯”è¾ƒçµæ´»ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œç®€å•è¡¨è¾¾å¼ç”¨()ï¼Œå¤æ‚è¡¨è¾¾å¼ç”¨{}ã€‚\n\næ¯”å¦‚ï¼Œç®€å•å‡½æ•°ä½“ï¼š(x =&amp;gt; x + 1)ã€(_ + 1)ï¼Œç­‰ç­‰ï¼›\nå¤æ‚å‡½æ•°ä½“ï¼š{case x: String =&amp;gt; â€œä¸€å¤§å †å…³äºxçš„è½¬æ¢â€ }","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631806114,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312145,"user_name":"å´”å°è±ª","can_delete":false,"product_type":"c1","uid":2604437,"ip_address":"","ucode":"ABB59CE5209E67","user_header":"https://static001.geekbang.org/account/avatar/00/27/bd/95/e923a332.jpg","comment_is_top":false,"comment_ctime":1631664351,"is_pvip":false,"replies":[{"id":"113202","content":"è¿™ä¸ªåˆ—è¡¨List(&quot;&amp;&quot;, &quot;|&quot;, &quot;#&quot;, &quot;^&quot;, &quot;@&quot;, &quot;\\&quot;&quot;,&quot;-&quot;)ï¼Œé‡Œé¢å¤šäº†ä¸€ä¸ªâ€œ-â€ï¼Œåœ¨åé¢åˆ†å‰²å­—ç¬¦ä¸²çš„æ—¶å€™ï¼šval words: Array[String] = s.split(&quot;-&quot;)ï¼ŒåŒæ ·ç”¨åˆ°äº†â€œ-â€ã€‚æ‰€ä»¥è¿™é‡Œåˆ†å‰²å‡ºæ¥çš„å­—ç¬¦ä¸²æ•°ç»„ï¼Œå®ƒçš„å¤§å°å¯èƒ½ä¼šå‡ºç°ä¸ä¸€è‡´ã€‚<br><br>æŠŠåˆ†éš”ç¬¦æ¢æˆå…¶ä»–å­—ç¬¦å°±å¥½äº†~","user_name":"ä½œè€…å›å¤","user_name_real":"å´ç£Š","uid":"1043100","ctime":1631806038,"ip_address":"","comment_id":312145,"utype":1}],"discussion_count":5,"race_medal":0,"score":"1631664351","product_id":100090001,"comment_content":"é‡åˆ°ä¸€ä¸ªå…³äºfilter å‡½æ•°çš„ bug on reduceByKeyã€‚<br>æˆ‘è¿è¡Œç¬¬ä¸€ä¸ªä¾‹å­ä»£ç å¦‚ä¸‹å¯ä»¥å¾—åˆ°æ­£ç¡®çš„ç»“æœï¼š<br>...<br> val cleanedPairRDD: RDD[String] = wordPairRDD.filter(word =&gt; !word.equals(&quot;&quot;)) <br>...<br>å¯ä»¥è¾“å‡ºç»“æœï¼š<br>scala&gt; :load WordCount03.scala<br>Loading WordCount03.scala...<br>import org.apache.spark.rdd.RDD<br>rootPath: String = .<br>file: String = .&#47;wikiOfSpark.txt<br>lineRDD: org.apache.spark.rdd.RDD[String] = .&#47;wikiOfSpark.txt MapPartitionsRDD[274] at textFile at WordCount03.scala:80<br>wordPairRDD: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[275] at flatMap at WordCount03.scala:80<br>cleanedPairRDD: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[276] at filter at WordCount03.scala:80<br>kvRDD: org.apache.spark.rdd.RDD[(String, Int)] = MapPartitionsRDD[277] at map at WordCount03.scala:80<br>wordCounts: org.apache.spark.rdd.RDD[(String, Int)] = ShuffledRDD[278] at reduceByKey at WordCount03.scala:80<br>res66: Array[(Int, String)] = Array((10,Apache-Software), (8,Apache-Spark), (7,can-be), (7,-&quot;Spark), (7,of-the))<br><br>ä¿®æ”¹ä»£ç ï¼Œæ·»åŠ filterå‡½æ•°åï¼Œä»£ç æŠ¥é”™ï¼š<br>ä»£ç ï¼š<br>...<br>&#47;&#47; å®šä¹‰ç‰¹æ®Šå­—ç¬¦åˆ—è¡¨<br>val list: List[String] = List(&quot;&amp;&quot;, &quot;|&quot;, &quot;#&quot;, &quot;^&quot;, &quot;@&quot;, &quot;\\&quot;&quot;,&quot;-&quot;)<br>def f(s: String): Boolean = {<br>    val words: Array[String] = s.split(&quot;-&quot;)<br>    val b1: Boolean = list.contains(words(0))<br>    val b2: Boolean = list.contains(words(1))<br>    return !b1 &amp;&amp; !b2}  <br>val cleanedPairRDD: RDD[String] = wordPairRDD.filter(f)  <br>...<br>è¾“å‡ºæŠ¥é”™ï¼š<br>scala&gt; :load WordCountDebug.scala<br>Loading WordCountDebug.scala...<br>...<br>list: List[String] = List(&amp;, |, #, ^, @, &quot;, -)<br>f: (s: String)Boolean<br>cleanedPairRDD: org.apache.spark.rdd.RDD[String] = MapPartitionsRDD[286] at filter at WordCountDebug.scala:84<br>kvRDD: org.apache.spark.rdd.RDD[(String, Int)] = MapPartitionsRDD[287] at map at WordCountDebug.scala:82<br>wordCounts: org.apache.spark.rdd.RDD[(String, Int)] = ShuffledRDD[288] at reduceByKey at WordCountDebug.scala:82<br>21&#47;09&#47;15 09:51:42 ERROR Executor: Exception in task 1.0 in stage 108.0 (TID 141)<br>java.lang.ArrayIndexOutOfBoundsException: 1<br>...<br>","like_count":0,"discussions":[{"author":{"id":1043100,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ea/9c/230061e7.jpg","nickname":"å´ç£Š","note":"","ucode":"136DC8CF1B10DC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526877,"discussion_content":"è¿™ä¸ªåˆ—è¡¨List(&amp;quot;&amp;amp;&amp;quot;, &amp;quot;|&amp;quot;, &amp;quot;#&amp;quot;, &amp;quot;^&amp;quot;, &amp;quot;@&amp;quot;, &amp;quot;\\&amp;quot;&amp;quot;,&amp;quot;-&amp;quot;)ï¼Œé‡Œé¢å¤šäº†ä¸€ä¸ªâ€œ-â€ï¼Œåœ¨åé¢åˆ†å‰²å­—ç¬¦ä¸²çš„æ—¶å€™ï¼šval words: Array[String] = s.split(&amp;quot;-&amp;quot;)ï¼ŒåŒæ ·ç”¨åˆ°äº†â€œ-â€ã€‚æ‰€ä»¥è¿™é‡Œåˆ†å‰²å‡ºæ¥çš„å­—ç¬¦ä¸²æ•°ç»„ï¼Œå®ƒçš„å¤§å°å¯èƒ½ä¼šå‡ºç°ä¸ä¸€è‡´ã€‚\n\næŠŠåˆ†éš”ç¬¦æ¢æˆå…¶ä»–å­—ç¬¦å°±å¥½äº†~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631806038,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1385403,"avatar":"https://static001.geekbang.org/account/avatar/00/15/23/bb/a1a61f7c.jpg","nickname":"GACÂ·DU","note":"","ucode":"7847FBE1C13740","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394034,"discussion_content":"å…ˆè¿‡æ»¤å‡ºåˆ‡ç‰‡æ•°ç»„é•¿åº¦å¤§äº1çš„å•è¯å¯¹\ndef filterLength(s: String): Boolean = {\n    val words = s.split(&#34;-&#34;)\n    return words.length > 1\n}","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1631694003,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2604437,"avatar":"https://static001.geekbang.org/account/avatar/00/27/bd/95/e923a332.jpg","nickname":"å´”å°è±ª","note":"","ucode":"ABB59CE5209E67","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394304,"discussion_content":"è°¢è°¢ AIKçš„æç¤ºã€‚å…ˆçœ‹ä¿®æ”¹åçš„ç»“æœ Top 10ï¼š\nArray[(Int, String)] = Array((10,Apache-Software), (8,Apache-Spark), (7,can-be), (7,of-the), (6,Software-Foundation), (6,to-the), (6,in-a), (5,machine-learning), (5,such-as), (5,the-Apache))\n\nä¿®æ”¹åçš„ä»£ç å¦‚ä¸‹ï¼Œå¢åŠ äº†ä¸€ä¸ªfilteræ¥ä¿è¯æ˜¯2ä¸ªå•è¯è€Œä¸”è¦æ±‚ï¼ŒåŒæ—¶å¢å¼ºäº†ç‰¹æ®Šå­—ç¬¦åˆ—è¡¨ã€‚\næ³¨æ„ï¼š å¯ä»¥å¯¹æ¯”è§‚å¯Ÿä¸€ä¸‹ä¸åŒç‰¹æ®Šå­—ç¬¦è¿‡æ»¤åç»“æœçš„åŒºåˆ«ï¼š\n// &#34;&amp;&#34;, &#34;|&#34;, &#34;#&#34;, &#34;^&#34;, &#34;@&#34;\nArray((10,Apache-Software), (8,Apache-Spark), (7,can-be), (7,-&#34;Spark), (7,of-the), (6,Software-Foundation), (6,to-the), (6,in-a), (5,machine-learning), (5,such-as), (5,the-Apache), (5,-), (5,in-the), (4,Malak,-Michael), (4,Spark-SQL), (4,an-RDD), (4,as-a), (4,support-for), (4,of-Spark), (4,Spark-Core))\n// &#34;&amp;&#34;, &#34;|&#34;, &#34;#&#34;, &#34;^&#34;, &#34;@&#34;, &#34;\\&#34;&#34;, &#34;-&#34;, &#34;&#34;\nArray((10,Apache-Software), (8,Apache-Spark), (7,can-be), (7,of-the), (6,Software-Foundation), (6,to-the), (6,in-a), (5,machine-learning), (5,such-as), (5,the-Apache), (5,in-the), (4,Malak,-Michael), (4,Spark-SQL), (4,an-RDD), (4,as-a), (4,support-for), (4,of-Spark), (4,Spark-Core), (4,on-a), (4,top-of))\n\n=================\n \ndef filterLength(s: String): Boolean = {\n    val words = s.split(&#34;-&#34;)\n    return words.length==2\n}\nval wordsPairRDD: RDD[String] = wordPairRDD.filter(filterLength)\nval charlist: List[String] = List(&#34;&amp;&#34;, &#34;|&#34;, &#34;#&#34;, &#34;^&#34;, &#34;@&#34;, &#34;\\&#34;&#34;, &#34;-&#34;, &#34;&#34;) // æ·»åŠ äº†&#34;, -, &#34;&#34; æ¶ˆé™¤ ï¼ˆ-&#34;Sparkï¼‰ï¼ˆ-ï¼‰ä¹‹ç±»çš„è¯å¯¹\ndef f(s: String): Boolean = {\n    val words: Array[String] = s.split(&#34;-&#34;)\n    val b1: Boolean = charlist.contains(words(0)) // special words 1\n    val b2: Boolean = charlist.contains(words(1)) // \n    return !b1 &amp;&amp; !b2 \n}  \nval cleanedPairRDD: RDD[String] = wordsPairRDD.filter(f)\n// æŠŠRDDå…ƒç´ è½¬æ¢ä¸ºï¼ˆKeyï¼ŒValueï¼‰çš„å½¢å¼\nval kvRDD: RDD[(String, Int)] = cleanedPairRDD.map(word => (word, 1))\n// æŒ‰ç…§å•è¯åšåˆ†ç»„è®¡æ•°\nval wordCounts: RDD[(String, Int)] = kvRDD.reduceByKey((x, y) => x + y)\n// æ‰“å°è¯é¢‘æœ€é«˜çš„5ä¸ªè¯æ±‡\nwordCounts.map{ca","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1631838615,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2457953,"avatar":"https://static001.geekbang.org/account/avatar/00/25/81/61/97d95637.jpg","nickname":"ä½ åˆç¡äº†å—","note":"","ucode":"1D48E86004D945","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394092,"discussion_content":"ä½¿ç”¨mapPartitionsä¼˜åŒ–çš„ä»£ç ï¼Œæ˜¯ä¸æ˜¯å°‘äº†(hash, 1)çš„1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631717307,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2177406,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/ia89MwaRSP6iaeQB4789roUntH7tia9EXyoDOnlibE8ABibAzFPiamP0SAU54NNTRiaVtkOtmLaWRH5OXbTOhUZl46scw/132","nickname":"Geek_01fccd","note":"","ucode":"6D5D9C2882513F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393949,"discussion_content":"æ•°ç»„è¶Šç•Œäº†words ï¼Œæœ‰äº›åªæœ‰ä¸€é¡¹ words(1) è¿™ä¸ªåœ°æ–¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631669410,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}