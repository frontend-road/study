{"id":332603,"title":"109 | Go ç¼–ç¨‹æ¨¡å¼ï¼šFunctional Options","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é™ˆçš“ï¼Œç½‘åå·¦è€³æœµè€—å­ã€‚</p><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬æ¥è®¨è®ºä¸€ä¸‹Functional Optionsè¿™ä¸ªç¼–ç¨‹æ¨¡å¼ã€‚è¿™æ˜¯ä¸€ä¸ªå‡½æ•°å¼ç¼–ç¨‹çš„åº”ç”¨æ¡ˆä¾‹ï¼Œç¼–ç¨‹æŠ€å·§ä¹Ÿå¾ˆå¥½ï¼Œæ˜¯ç›®å‰Goè¯­è¨€ä¸­æœ€æµè¡Œçš„ä¸€ç§ç¼–ç¨‹æ¨¡å¼ã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨æ­£å¼è®¨è®ºè¿™ä¸ªæ¨¡å¼ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¦è§£å†³ä»€ä¹ˆæ ·çš„é—®é¢˜ã€‚</p><h2>é…ç½®é€‰é¡¹é—®é¢˜</h2><p>åœ¨ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å¯¹ä¸€ä¸ªå¯¹è±¡ï¼ˆæˆ–æ˜¯ä¸šåŠ¡å®ä½“ï¼‰è¿›è¡Œç›¸å…³çš„é…ç½®ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªä¸šåŠ¡å®ä½“ï¼ˆæ³¨æ„ï¼Œè¿™åªæ˜¯ä¸€ä¸ªç¤ºä¾‹ï¼‰ï¼š</p><pre><code>type Server struct {\n    Addr     string\n    Port     int\n    Protocol string\n    Timeout  time.Duration\n    MaxConns int\n    TLS      *tls.Config\n}\n</code></pre><p>åœ¨è¿™ä¸ª <code>Server</code> å¯¹è±¡ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p><ul>\n<li>è¦æœ‰ä¾¦å¬çš„IPåœ°å€ <code>Addr</code> å’Œç«¯å£å· <code>Port</code> ï¼Œè¿™ä¸¤ä¸ªé…ç½®é€‰é¡¹æ˜¯å¿…å¡«çš„ï¼ˆå½“ç„¶ï¼ŒIPåœ°å€å’Œç«¯å£å·éƒ½å¯ä»¥æœ‰é»˜è®¤å€¼ï¼Œä¸è¿‡è¿™é‡Œæˆ‘ä»¬ç”¨äºä¸¾ä¾‹ï¼Œæ‰€ä»¥æ˜¯æ²¡æœ‰é»˜è®¤å€¼ï¼Œè€Œä¸”ä¸èƒ½ä¸ºç©ºï¼Œéœ€è¦æ˜¯å¿…å¡«çš„ï¼‰ã€‚</li>\n<li>ç„¶åï¼Œè¿˜æœ‰åè®® <code>Protocol</code> ã€ <code>Timeout</code> å’Œ<code>MaxConns</code> å­—æ®µï¼Œè¿™å‡ ä¸ªå­—æ®µæ˜¯ä¸èƒ½ä¸ºç©ºçš„ï¼Œä½†æ˜¯æœ‰é»˜è®¤å€¼çš„ï¼Œæ¯”å¦‚ï¼Œåè®®æ˜¯TCPï¼Œè¶…æ—¶<code>30</code>ç§’ å’Œ æœ€å¤§é“¾æ¥æ•°<code>1024</code>ä¸ªã€‚</li>\n<li>è¿˜æœ‰ä¸€ä¸ª <code>TLS</code>  ï¼Œè¿™ä¸ªæ˜¯å®‰å…¨é“¾æ¥ï¼Œéœ€è¦é…ç½®ç›¸å…³çš„è¯ä¹¦å’Œç§é’¥ã€‚è¿™ä¸ªæ˜¯å¯ä»¥ä¸ºç©ºçš„ã€‚</li>\n</ul><p>æ‰€ä»¥ï¼Œé’ˆå¯¹è¿™æ ·çš„é…ç½®ï¼Œæˆ‘ä»¬éœ€è¦æœ‰å¤šç§ä¸åŒçš„åˆ›å»ºä¸åŒé…ç½® <code>Server</code> çš„å‡½æ•°ç­¾åï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>func NewDefaultServer(addr string, port int) (*Server, error) {\n  return &amp;Server{addr, port, &quot;tcp&quot;, 30 * time.Second, 100, nil}, nil\n}\n\nfunc NewTLSServer(addr string, port int, tls *tls.Config) (*Server, error) {\n  return &amp;Server{addr, port, &quot;tcp&quot;, 30 * time.Second, 100, tls}, nil\n}\n\nfunc NewServerWithTimeout(addr string, port int, timeout time.Duration) (*Server, error) {\n  return &amp;Server{addr, port, &quot;tcp&quot;, timeout, 100, nil}, nil\n}\n\nfunc NewTLSServerWithMaxConnAndTimeout(addr string, port int, maxconns int, timeout time.Duration, tls *tls.Config) (*Server, error) {\n  return &amp;Server{addr, port, &quot;tcp&quot;, 30 * time.Second, maxconns, tls}, nil\n}\n</code></pre><p>å› ä¸ºGoè¯­è¨€ä¸æ”¯æŒé‡è½½å‡½æ•°ï¼Œæ‰€ä»¥ï¼Œä½ å¾—ç”¨ä¸åŒçš„å‡½æ•°åæ¥åº”å¯¹ä¸åŒçš„é…ç½®é€‰é¡¹ã€‚</p><!-- [[[read_end]]] --><h2>é…ç½®å¯¹è±¡æ–¹æ¡ˆ</h2><p>è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæœ€å¸¸è§çš„æ–¹å¼æ˜¯ä½¿ç”¨ä¸€ä¸ªé…ç½®å¯¹è±¡ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>type Config struct {\n    Protocol string\n    Timeout  time.Duration\n    Maxconns int\n    TLS      *tls.Config\n}\n</code></pre><p>æˆ‘ä»¬æŠŠé‚£äº›éå¿…è¾“çš„é€‰é¡¹éƒ½ç§»åˆ°ä¸€ä¸ªç»“æ„ä½“é‡Œï¼Œè¿™æ ·ä¸€æ¥ï¼Œ  <code>Server</code> å¯¹è±¡å°±ä¼šå˜æˆï¼š</p><pre><code>type Server struct {\n    Addr string\n    Port int\n    Conf *Config\n}\n</code></pre><p>äºæ˜¯ï¼Œæˆ‘ä»¬å°±åªéœ€è¦ä¸€ä¸ª <code>NewServer()</code> çš„å‡½æ•°äº†ï¼Œåœ¨ä½¿ç”¨å‰éœ€è¦æ„é€  <code>Config</code> å¯¹è±¡ã€‚</p><pre><code>func NewServer(addr string, port int, conf *Config) (*Server, error) {\n    //...\n}\n\n//Using the default configuratrion\nsrv1, _ := NewServer(&quot;localhost&quot;, 9000, nil) \n\nconf := ServerConfig{Protocol:&quot;tcp&quot;, Timeout: 60*time.Duration}\nsrv2, _ := NewServer(&quot;locahost&quot;, 9000, &amp;conf)\n</code></pre><p>è¿™æ®µä»£ç ç®—æ˜¯ä¸é”™äº†ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯èƒ½å°±æ­¢æ­¥äºæ­¤äº†ã€‚ä½†æ˜¯ï¼Œå¯¹äºæœ‰æ´ç™–çš„ã€æœ‰è¿½æ±‚çš„ç¨‹åºå‘˜æ¥è¯´ï¼Œä»–ä»¬ä¼šçœ‹åˆ°å…¶ä¸­ä¸å¤ªå¥½çš„ä¸€ç‚¹ï¼Œé‚£å°±æ˜¯<code>Config</code> å¹¶ä¸æ˜¯å¿…éœ€çš„ï¼Œæ‰€ä»¥ï¼Œä½ éœ€è¦åˆ¤æ–­æ˜¯å¦æ˜¯ <code>nil</code> æˆ–æ˜¯ Emptyâ€”â€”  <code>Config{}</code>ä¼šè®©æˆ‘ä»¬çš„ä»£ç æ„Ÿè§‰ä¸å¤ªå¹²å‡€ã€‚</p><h2>Builderæ¨¡å¼</h2><p>å¦‚æœä½ æ˜¯ä¸€ä¸ªJavaç¨‹åºå‘˜ï¼Œç†Ÿæ‚‰è®¾è®¡æ¨¡å¼çš„ä¸€å®šä¼šå¾ˆè‡ªç„¶åœ°ä½¿ç”¨Builderæ¨¡å¼ã€‚æ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p><pre><code>User user = new User.Builder()\n  .name(&quot;Hao Chen&quot;)\n  .email(&quot;haoel@hotmail.com&quot;)\n  .nickname(&quot;å·¦è€³æœµ&quot;)\n  .build();\n</code></pre><p>ä»¿ç…§è¿™ä¸ªæ¨¡å¼ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠåˆšåˆšçš„ä»£ç æ”¹å†™æˆä¸‹é¢çš„æ ·å­ï¼ˆæ³¨ï¼šä¸‹é¢çš„ä»£ç æ²¡æœ‰è€ƒè™‘å‡ºé”™å¤„ç†ï¼Œå…¶ä¸­å…³äºå‡ºé”™å¤„ç†çš„æ›´å¤šå†…å®¹ï¼Œä½ å¯ä»¥å†å›é¡¾ä¸‹<a href=\"https://time.geekbang.org/column/article/332602\">ä¸ŠèŠ‚è¯¾</a>ï¼‰ï¼š</p><pre><code>//ä½¿ç”¨ä¸€ä¸ªbuilderç±»æ¥åšåŒ…è£…\ntype ServerBuilder struct {\n  Server\n}\n\nfunc (sb *ServerBuilder) Create(addr string, port int) *ServerBuilder {\n  sb.Server.Addr = addr\n  sb.Server.Port = port\n  //å…¶å®ƒä»£ç è®¾ç½®å…¶å®ƒæˆå‘˜çš„é»˜è®¤å€¼\n  return sb\n}\n\nfunc (sb *ServerBuilder) WithProtocol(protocol string) *ServerBuilder {\n  sb.Server.Protocol = protocol \n  return sb\n}\n\nfunc (sb *ServerBuilder) WithMaxConn( maxconn int) *ServerBuilder {\n  sb.Server.MaxConns = maxconn\n  return sb\n}\n\nfunc (sb *ServerBuilder) WithTimeOut( timeout time.Duration) *ServerBuilder {\n  sb.Server.Timeout = timeout\n  return sb\n}\n\nfunc (sb *ServerBuilder) WithTLS( tls *tls.Config) *ServerBuilder {\n  sb.Server.TLS = tls\n  return sb\n}\n\nfunc (sb *ServerBuilder) Build() (Server) {\n  return  sb.Server\n}\n</code></pre><p>è¿™æ ·ä¸€æ¥ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™æ ·çš„æ–¹å¼äº†ï¼š</p><pre><code>sb := ServerBuilder{}\nserver, err := sb.Create(&quot;127.0.0.1&quot;, 8080).\n  WithProtocol(&quot;udp&quot;).\n  WithMaxConn(1024).\n  WithTimeOut(30*time.Second).\n  Build()\n</code></pre><p>è¿™ç§æ–¹å¼ä¹Ÿå¾ˆæ¸…æ¥šï¼Œä¸éœ€è¦é¢å¤–çš„Configç±»ï¼Œä½¿ç”¨é“¾å¼çš„å‡½æ•°è°ƒç”¨çš„æ–¹å¼æ¥æ„é€ ä¸€ä¸ªå¯¹è±¡ï¼Œåªéœ€è¦å¤šåŠ ä¸€ä¸ªBuilderç±»ã€‚ä½ å¯èƒ½ä¼šè§‰å¾—ï¼Œè¿™ä¸ªBuilderç±»ä¼¼ä¹æœ‰ç‚¹å¤šä½™ï¼Œæˆ‘ä»¬ä¼¼ä¹å¯ä»¥ç›´æ¥åœ¨<code>Server</code> ä¸Šè¿›è¡Œè¿™æ ·çš„ Builder æ„é€ ï¼Œçš„ç¡®æ˜¯è¿™æ ·çš„ã€‚ä½†æ˜¯ï¼Œåœ¨å¤„ç†é”™è¯¯çš„æ—¶å€™å¯èƒ½å°±æœ‰ç‚¹éº»çƒ¦ï¼Œä¸å¦‚ä¸€ä¸ªåŒ…è£…ç±»æ›´å¥½ä¸€äº›ã€‚</p><p>å¦‚æœæˆ‘ä»¬æƒ³çœæ‰è¿™ä¸ªåŒ…è£…çš„ç»“æ„ä½“ï¼Œå°±è¦è¯·å‡ºFunctional Optionsä¸Šåœºäº†ï¼šå‡½æ•°å¼ç¼–ç¨‹ã€‚</p><h2>Functional Options</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°ç±»å‹ï¼š</p><pre><code>type Option func(*Server)\n</code></pre><p>ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡½æ•°å¼çš„æ–¹å¼å®šä¹‰ä¸€ç»„å¦‚ä¸‹çš„å‡½æ•°ï¼š</p><pre><code>func Protocol(p string) Option {\n    return func(s *Server) {\n        s.Protocol = p\n    }\n}\nfunc Timeout(timeout time.Duration) Option {\n    return func(s *Server) {\n        s.Timeout = timeout\n    }\n}\nfunc MaxConns(maxconns int) Option {\n    return func(s *Server) {\n        s.MaxConns = maxconns\n    }\n}\nfunc TLS(tls *tls.Config) Option {\n    return func(s *Server) {\n        s.TLS = tls\n    }\n}\n</code></pre><p>è¿™ç»„ä»£ç ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œç„¶åè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›çš„è¿™ä¸ªå‡½æ•°ä¼šè®¾ç½®è‡ªå·±çš„ <code>Server</code> å‚æ•°ã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬è°ƒç”¨å…¶ä¸­çš„ä¸€ä¸ªå‡½æ•° <code>MaxConns(30)</code> æ—¶ï¼Œå…¶è¿”å›å€¼æ˜¯ä¸€ä¸ª <code>func(s* Server) { s.MaxConns = 30 }</code> çš„å‡½æ•°ã€‚</p><p>è¿™ä¸ªå«é«˜é˜¶å‡½æ•°ã€‚åœ¨æ•°å­¦ä¸Šï¼Œè¿™æœ‰ç‚¹åƒæ˜¯è®¡ç®—é•¿æ–¹å½¢é¢ç§¯çš„å…¬å¼ä¸ºï¼š <code>rect(width, height) = width * height;</code> è¿™ä¸ªå‡½æ•°éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬åŒ…è£…ä¸€ä¸‹ï¼Œå°±å¯ä»¥å˜æˆè®¡ç®—æ­£æ–¹å½¢é¢ç§¯çš„å…¬å¼ï¼š<code>square(width) = rect(width, width)</code>  ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>squre(width)</code>è¿”å›äº†å¦å¤–ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯<code>rect(w,h)</code> ï¼Œåªä¸è¿‡å®ƒçš„ä¸¤ä¸ªå‚æ•°æ˜¯ä¸€æ ·çš„ï¼Œå³ï¼š<code>f(x) = g(x, x)</code>ã€‚</p><p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å†å®šä¸€ä¸ª <code>NewServer()</code>çš„å‡½æ•°ï¼Œå…¶ä¸­ï¼Œæœ‰ä¸€ä¸ªå¯å˜å‚æ•° <code>options</code>  ï¼Œå®ƒå¯ä»¥ä¼ å‡ºå¤šä¸ªä¸Šé¢çš„å‡½æ•°ï¼Œç„¶åä½¿ç”¨ä¸€ä¸ªfor-loopæ¥è®¾ç½®æˆ‘ä»¬çš„ <code>Server</code> å¯¹è±¡ã€‚</p><pre><code>func NewServer(addr string, port int, options ...func(*Server)) (*Server, error) {\n\n  srv := Server{\n    Addr:     addr,\n    Port:     port,\n    Protocol: &quot;tcp&quot;,\n    Timeout:  30 * time.Second,\n    MaxConns: 1000,\n    TLS:      nil,\n  }\n  for _, option := range options {\n    option(&amp;srv)\n  }\n  //...\n  return &amp;srv, nil\n}\n</code></pre><p>äºæ˜¯ï¼Œæˆ‘ä»¬åœ¨åˆ›å»º <code>Server</code> å¯¹è±¡çš„æ—¶å€™ï¼Œå°±å¯ä»¥åƒä¸‹é¢è¿™æ ·ï¼š</p><pre><code>s1, _ := NewServer(&quot;localhost&quot;, 1024)\ns2, _ := NewServer(&quot;localhost&quot;, 2048, Protocol(&quot;udp&quot;))\ns3, _ := NewServer(&quot;0.0.0.0&quot;, 8080, Timeout(300*time.Second), MaxConns(1000))\n</code></pre><p>æ€ä¹ˆæ ·ï¼Œæ˜¯ä¸æ˜¯é«˜åº¦æ•´æ´å’Œä¼˜é›…ï¼Ÿè¿™ä¸ä½†è§£å†³äº†â€œä½¿ç”¨ <code>Config</code> å¯¹è±¡æ–¹å¼çš„éœ€è¦æœ‰ä¸€ä¸ªconfigå‚æ•°ï¼Œä½†åœ¨ä¸éœ€è¦çš„æ—¶å€™ï¼Œæ˜¯æ”¾ <code>nil</code> è¿˜æ˜¯æ”¾ <code>Config{}</code>â€çš„é€‰æ‹©å›°éš¾é—®é¢˜ï¼Œä¹Ÿä¸éœ€è¦å¼•ç”¨ä¸€ä¸ªBuilderçš„æ§åˆ¶å¯¹è±¡ï¼Œç›´æ¥ä½¿ç”¨å‡½æ•°å¼ç¼–ç¨‹ï¼Œåœ¨ä»£ç é˜…è¯»ä¸Šä¹Ÿå¾ˆä¼˜é›…ã€‚</p><p>æ‰€ä»¥ï¼Œä»¥åï¼Œä½ è¦ç©ç±»ä¼¼çš„ä»£ç æ—¶ï¼Œæˆ‘å¼ºçƒˆæ¨èä½ ä½¿ç”¨Functional Optionsè¿™ç§æ–¹å¼ï¼Œè¿™ç§æ–¹å¼è‡³å°‘å¸¦æ¥äº†6ä¸ªå¥½å¤„ï¼š</p><ul>\n<li>ç›´è§‰å¼çš„ç¼–ç¨‹ï¼›</li>\n<li>é«˜åº¦çš„å¯é…ç½®åŒ–ï¼›</li>\n<li>å¾ˆå®¹æ˜“ç»´æŠ¤å’Œæ‰©å±•ï¼›</li>\n<li>è‡ªæ–‡æ¡£ï¼›</li>\n<li>æ–°æ¥çš„äººå¾ˆå®¹æ˜“ä¸Šæ‰‹ï¼›</li>\n<li>æ²¡æœ‰ä»€ä¹ˆä»¤äººå›°æƒ‘çš„äº‹ï¼ˆæ˜¯nil è¿˜æ˜¯ç©ºï¼‰ã€‚</li>\n</ul><h2>å‚è€ƒæ–‡æ¡£</h2><ul>\n<li><a href=\"http://commandcenter.blogspot.com.au/2014/01/self-referential-functions-and-design.html\">Self referential functions and design</a>ï¼Œ by Rob Pike</li>\n</ul><p>å¥½äº†ï¼Œè¿™èŠ‚è¯¾å°±åˆ°è¿™é‡Œã€‚å¦‚æœä½ è§‰å¾—ä»Šå¤©çš„å†…å®¹å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œæ¬¢è¿ä½ å¸®æˆ‘åˆ†äº«ç»™æ›´å¤šäººã€‚</p>","neighbors":{"left":{"article_title":"108 | Go ç¼–ç¨‹æ¨¡å¼ï¼šé”™è¯¯å¤„ç†","id":332602},"right":{"article_title":"110 | Goç¼–ç¨‹æ¨¡å¼ï¼šå§”æ‰˜å’Œåè½¬æ§åˆ¶","id":332605}},"comments":[{"had_liked":false,"id":274441,"user_name":"æ±ªè¾‰","can_delete":false,"product_type":"c1","uid":1625869,"ip_address":"","ucode":"2416B890609849","user_header":"https://static001.geekbang.org/account/avatar/00/18/cf/0d/a173e2b8.jpg","comment_is_top":false,"comment_ctime":1611022394,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27380826170","product_id":100002201,"comment_content":"ä¹‹å‰çœ‹åˆ°mqçš„åˆå§‹åŒ–å¯é€‰é…ç½®çš„æ—¶å€™æœ‰ç”¨åˆ°Functional Optionsè¿™ä¸ªæ¨¡å¼ï¼Œæ²¡æƒ³åˆ°åœ¨è¿™é‡Œæ‰¾åˆ°æºå¤´äº†ã€‚","like_count":7},{"had_liked":false,"id":278297,"user_name":"Geek_a754be","can_delete":false,"product_type":"c1","uid":2437733,"ip_address":"","ucode":"A18C3752E2C1C8","user_header":"","comment_is_top":false,"comment_ctime":1612860954,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"23087697434","product_id":100002201,"comment_content":"ä¹‹å‰åœ¨å…¬å¸è‡ªç ”çš„å¾®æœåŠ¡æ¡†æ¶é‡Œé¢çœ‹åˆ°å¤§è§„æ¨¡ä½¿ç”¨ï¼ŒåŸæ¥æœ‰ä¸ªå­¦åå«Functional Options","like_count":6,"discussions":[{"author":{"id":2526790,"avatar":"https://static001.geekbang.org/account/avatar/00/26/8e/46/3b8b0651.jpg","nickname":"hi_tpğŸ¤£","note":"","ucode":"6652FE6299B77F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":360412,"discussion_content":"Go grpc å®ä¾‹åŒ–çš„æ—¶å€™å°±æ˜¯è¿™æ ·å¹²çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616427866,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":279145,"user_name":"è§","can_delete":false,"product_type":"c1","uid":1229143,"ip_address":"","ucode":"0C2239867AFF5F","user_header":"https://static001.geekbang.org/account/avatar/00/12/c1/57/27de274f.jpg","comment_is_top":false,"comment_ctime":1613636334,"is_pvip":true,"discussion_count":0,"race_medal":5,"score":"10203570926","product_id":100002201,"comment_content":"å¤ªå¼ºäº†ï¼Œå—ç›ŠåŒªæµ…","like_count":3},{"had_liked":false,"id":341941,"user_name":"æ‹‰æ¬§","can_delete":false,"product_type":"c1","uid":1206605,"ip_address":"","ucode":"40996A8093A95F","user_header":"https://static001.geekbang.org/account/avatar/00/12/69/4d/81c44f45.jpg","comment_is_top":false,"comment_ctime":1649926249,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1649926249","product_id":100002201,"comment_content":"option æ„å‘³é€‰é¡¹ï¼Œæœ¬èº«å°±æœ‰å‡½æ•°çš„æ„æ€","like_count":0},{"had_liked":false,"id":337982,"user_name":"Geek_Huahui","can_delete":false,"product_type":"c1","uid":1497346,"ip_address":"","ucode":"A688B183E5CE5E","user_header":"https://static001.geekbang.org/account/avatar/00/16/d9/02/c4e2d7e8.jpg","comment_is_top":false,"comment_ctime":1647220869,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1647220869","product_id":100002201,"comment_content":"çœŸçš„ç‰›é€¼","like_count":0},{"had_liked":false,"id":333018,"user_name":"ä»Šå¹´ä¹Ÿæ²¡æœ‰çŒ«","can_delete":false,"product_type":"c1","uid":1546547,"ip_address":"","ucode":"99379F3E276746","user_header":"https://static001.geekbang.org/account/avatar/00/17/99/33/1981b0cc.jpg","comment_is_top":false,"comment_ctime":1643960301,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1643960301","product_id":100002201,"comment_content":"ç®€å•ç†è§£  å°±æ˜¯ä¸€ç§é—­åŒ…çš„ç»„ç»‡å½¢å¼ã€‚","like_count":0},{"had_liked":false,"id":326797,"user_name":"æ–¹å‹‡(gopher)","can_delete":false,"product_type":"c1","uid":1290625,"ip_address":"","ucode":"D199911C4CFEF5","user_header":"https://static001.geekbang.org/account/avatar/00/13/b1/81/13f23d1e.jpg","comment_is_top":false,"comment_ctime":1639703808,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1639703808","product_id":100002201,"comment_content":"ç¡®å®å¾ˆå¤šä¸­é—´ä»¶çš„ä¼ å‚éƒ½è¿™ä¹ˆè®¾è®¡ï¼Œæœ‰æ—¶å€™å¯èƒ½è¦è€ƒè™‘ï¼Œå‡½æ•°æ”¾åœ¨clientç«¯ï¼Œè¿˜æ˜¯serverç«¯","like_count":0},{"had_liked":false,"id":321089,"user_name":"é’é˜³","can_delete":false,"product_type":"c1","uid":2139807,"ip_address":"","ucode":"3591D366BAB0B9","user_header":"https://static001.geekbang.org/account/avatar/00/20/a6/9f/3c60fffd.jpg","comment_is_top":false,"comment_ctime":1636676105,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1636676105","product_id":100002201,"comment_content":"å’Œå‡½æ•°ç§‘é‡ŒåŒ–æ˜¯ä¸€å›äº‹å—","like_count":0},{"had_liked":false,"id":299380,"user_name":"å›¾ä¸ªå•¥å‘¢","can_delete":false,"product_type":"c1","uid":1134984,"ip_address":"","ucode":"BEE1F1477056A2","user_header":"https://static001.geekbang.org/account/avatar/00/11/51/88/232fe847.jpg","comment_is_top":false,"comment_ctime":1624603802,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624603802","product_id":100002201,"comment_content":"å‰å®³äº†ï¼","like_count":0},{"had_liked":false,"id":297162,"user_name":"ğŸ‘» å°äºŒ","can_delete":false,"product_type":"c1","uid":1625463,"ip_address":"","ucode":"9EEA8553163270","user_header":"https://static001.geekbang.org/account/avatar/00/18/cd/77/b2ab5d44.jpg","comment_is_top":false,"comment_ctime":1623333615,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1623333615","product_id":100002201,"comment_content":"è¿™ç§æ¥å£ä¹Ÿå¾ˆå‹å¥½ï¼Œ å°±æ˜¯è‹¦äº†ä½œè€…<br><br>```go<br>package main<br><br>import (<br>\t&quot;crypto&#47;tls&quot;<br>\t&quot;time&quot;<br>)<br><br>type Option struct {<br>\tTimeout *time.Duration<br>\tTLS     *tls.Config<br>}<br><br>func (option *Option) SetTimeOut(timeout time.Duration) *Option {<br>\toption.Timeout = &amp;timeout<br>\treturn option<br>}<br><br>func (option *Option) SetTLS(tls *tls.Config) *Option {<br>\toption.TLS = tls<br>\treturn option<br>}<br><br>func MergeOptions(options ...*Option) *Option {<br><br>\t&#47;&#47;æŠŠoptionåˆå¹¶èµ·æ¥<br>\treturn nil<br>}<br><br>type Server struct {<br>\tAddr    string<br>\tPort    int<br>\tTimeout time.Duration<br>\tTLS     *tls.Config<br>}<br><br>func NewOptions() *Option {<br>\treturn new(Option)<br>}<br>func NewServer(addr string, port int, options ...*Option) (*Server, error) {<br><br>\tsrv := Server{<br>\t\tAddr:    addr,<br>\t\tPort:    port,<br>\t\tTimeout: 30 * time.Second,<br>\t\tTLS:     nil,<br>\t}<br><br>\top := MergeOptions(options...)<br><br>\tif op.Timeout != nil {<br>\t\tsrv.Timeout = *op.Timeout<br>\t}<br><br>\tif op.TLS != nil {<br>\t\tsrv.TLS = op.TLS<br>\t}<br><br>\t&#47;&#47;...<br>\treturn &amp;srv, nil<br>}<br>func main() {<br>\t_, _ = NewServer(&quot;127.0.0.1&quot;, 80)<br>\t_, _ = NewServer(&quot;127.0.0.1&quot;, 80, NewOptions().SetTimeOut(100))<br>\t_, _ = NewServer(&quot;127.0.0.1&quot;, 80, NewOptions().SetTimeOut(100).SetTLS(nil))<br>}<br><br>```","like_count":0},{"had_liked":false,"id":293737,"user_name":"è½»é£˜é£˜è¿‡","can_delete":false,"product_type":"c1","uid":1347071,"ip_address":"","ucode":"68F26121369330","user_header":"https://static001.geekbang.org/account/avatar/00/14/8d/ff/986ffb41.jpg","comment_is_top":false,"comment_ctime":1621514968,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621514968","product_id":100002201,"comment_content":"å¯¹æ¯”jsçš„...è§£æ„å’Œå‡½æ•°å¼ç¼–ç¨‹çš„compose?","like_count":0},{"had_liked":false,"id":289873,"user_name":"astrosta","can_delete":false,"product_type":"c1","uid":2583001,"ip_address":"","ucode":"64E88ADBBF0622","user_header":"https://static001.geekbang.org/account/avatar/00/27/69/d9/343b7a5f.jpg","comment_is_top":false,"comment_ctime":1619244292,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1619244292","product_id":100002201,"comment_content":"ç”¨äº†å¾ˆä¹…ï¼Œæ‰çŸ¥é“å«Functional Options","like_count":0},{"had_liked":false,"id":289694,"user_name":"Geek_450b7e","can_delete":false,"product_type":"c1","uid":2264427,"ip_address":"","ucode":"653B2066F8BBD6","user_header":"","comment_is_top":false,"comment_ctime":1619146012,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1619146012","product_id":100002201,"comment_content":"ä¼˜ç§€ï¼Œå­¦åˆ°äº†","like_count":0},{"had_liked":false,"id":288912,"user_name":"Eirture","can_delete":false,"product_type":"c1","uid":1308178,"ip_address":"","ucode":"49EC3830989464","user_header":"https://static001.geekbang.org/account/avatar/00/13/f6/12/19914d72.jpg","comment_is_top":false,"comment_ctime":1618759874,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618759874","product_id":100002201,"comment_content":"åœ¨ Kubernetes æºä»£ç ä¸­å­¦è¿‡è¿™ä¸€æ‹›ï¼ŒåŸæ¥æ˜¯å« Functional Optionsï¼Œæœ‰äº†åå­—æ›´å®¹æ˜“è®°ä½å’Œä¼ æ’­ ğŸ‘","like_count":0},{"had_liked":false,"id":284218,"user_name":"å°ä¸¢ğŸ‘£","can_delete":false,"product_type":"c1","uid":1031711,"ip_address":"","ucode":"A7699F00418FC4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/be/1f/57c88dd1.jpg","comment_is_top":false,"comment_ctime":1616124422,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616124422","product_id":100002201,"comment_content":"è±ç„¶å¼€æœ—ï¼Œrespect","like_count":0},{"had_liked":false,"id":278068,"user_name":"ä¾¯é¹â‚â‚ˆâ‚†â‚â‚„â‚€â‚‰â‚‚â‚„â‚â‚‰","can_delete":false,"product_type":"c1","uid":1212378,"ip_address":"","ucode":"BB85A8993B4DBB","user_header":"https://static001.geekbang.org/account/avatar/00/12/7f/da/73778db7.jpg","comment_is_top":false,"comment_ctime":1612749924,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612749924","product_id":100002201,"comment_content":"éå¸¸æ£’ğŸ‘ğŸ»","like_count":0}]}