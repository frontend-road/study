{"id":118721,"title":"07 | What? 还有本地套接字？","content":"<p>你好，我是盛延敏，这里是网络编程实战第7讲，欢迎回来。</p><p>上一篇文章中，我们讲了UDP。很多同学都知道TCP和UDP，但是对本地套接字却不甚了解。</p><p>实际上，本地套接字是IPC，也就是本地进程间通信的一种实现方式。除了本地套接字以外，其它技术，诸如管道、共享消息队列等也是进程间通信的常用方法，但因为本地套接字开发便捷，接受度高，所以普遍适用于在同一台主机上进程间通信的各种场景。</p><p>那么今天我们就来学习下本地套接字方面的知识，并且利用本地套接字完成可靠字节流和数据报两种协议。</p><h2>从例子开始</h2><p>现在最火的云计算技术是什么？无疑是Kubernetes和Docker。在Kubernetes和Docker的技术体系中，有很多优秀的设计，比如Kubernetes的CRI（Container Runtime Interface），其思想是将Kubernetes的主要逻辑和Container Runtime的实现解耦。</p><p>我们可以通过netstat命令查看Linux系统内的本地套接字状况，下面这张图列出了路径为/var/run/dockershim.socket的stream类型的本地套接字，可以清楚地看到开启这个套接字的进程为kubelet。kubelet是Kubernetes的一个组件，这个组件负责将控制器和调度器的命令转化为单机上的容器实例。为了实现和容器运行时的解耦，kubelet设计了基于本地套接字的客户端-服务器GRPC调用。</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/c7/6b/c75a8467a84f30e523917f28f2f4266b.jpg?wh=2998*1346\" alt=\"\"><br>\n眼尖的同学可能发现列表里还有docker-containerd.sock等其他本地套接字，是的，Docker其实也是大量使用了本地套接字技术来构建的。</p><p>如果我们在/var/run目录下将会看到docker使用的本地套接字描述符:</p><p><img src=\"https://static001.geekbang.org/resource/image/a0/4d/a0e6f8ca0f9c5727f554323a26a9c14d.jpg?wh=1843*394\" alt=\"\"></p><h2>本地套接字概述</h2><p>本地套接字一般也叫做UNIX域套接字，最新的规范已经改叫本地套接字。在前面的TCP/UDP例子中，我们经常使用127.0.0.1完成客户端进程和服务器端进程同时在本机上的通信，那么，这里的本地套接字又是什么呢？</p><p>本地套接字是一种特殊类型的套接字，和TCP/UDP套接字不同。TCP/UDP即使在本地地址通信，也要走系统网络协议栈，而本地套接字，严格意义上说提供了一种单主机跨进程间调用的手段，减少了协议栈实现的复杂度，效率比TCP/UDP套接字都要高许多。类似的IPC机制还有UNIX管道、共享内存和RPC调用等。</p><p>比如X  Window实现，如果发现是本地连接，就会走本地套接字，工作效率非常高。</p><p>现在你可以回忆一下，在前面介绍套接字地址时，我们讲到了本地地址，这个本地地址就是本地套接字专属的。</p><p><img src=\"https://static001.geekbang.org/resource/image/ed/58/ed49b0f1b658e82cb07a6e1e81f36b58.png?wh=3979*3770\" alt=\"\"></p><h2>本地字节流套接字</h2><p>我们先从字节流本地套接字开始。</p><p>这是一个字节流类型的本地套接字服务器端例子。在这个例子中，服务器程序打开本地套接字后，接收客户端发送来的字节流，并往客户端回送了新的字节流。</p><pre><code>#include  &quot;lib/common.h&quot;\n\nint main(int argc, char **argv) {\n    if (argc != 2) {\n        error(1, 0, &quot;usage: unixstreamserver &lt;local_path&gt;&quot;);\n    }\n\n    int listenfd, connfd;\n    socklen_t clilen;\n    struct sockaddr_un cliaddr, servaddr;\n\n    listenfd = socket(AF_LOCAL, SOCK_STREAM, 0);\n    if (listenfd &lt; 0) {\n        error(1, errno, &quot;socket create failed&quot;);\n    }\n\n    char *local_path = argv[1];\n    unlink(local_path);\n    bzero(&amp;servaddr, sizeof(servaddr));\n    servaddr.sun_family = AF_LOCAL;\n    strcpy(servaddr.sun_path, local_path);\n\n    if (bind(listenfd, (struct sockaddr *) &amp;servaddr, sizeof(servaddr)) &lt; 0) {\n        error(1, errno, &quot;bind failed&quot;);\n    }\n\n    if (listen(listenfd, LISTENQ) &lt; 0) {\n        error(1, errno, &quot;listen failed&quot;);\n    }\n\n    clilen = sizeof(cliaddr);\n    if ((connfd = accept(listenfd, (struct sockaddr *) &amp;cliaddr, &amp;clilen)) &lt; 0) {\n        if (errno == EINTR)\n            error(1, errno, &quot;accept failed&quot;);        /* back to for() */\n        else\n            error(1, errno, &quot;accept failed&quot;);\n    }\n\n    char buf[BUFFER_SIZE];\n\n    while (1) {\n        bzero(buf, sizeof(buf));\n        if (read(connfd, buf, BUFFER_SIZE) == 0) {\n            printf(&quot;client quit&quot;);\n            break;\n        }\n        printf(&quot;Receive: %s&quot;, buf);\n\n        char send_line[MAXLINE];\n        sprintf(send_line, &quot;Hi, %s&quot;, buf);\n\n        int nbytes = sizeof(send_line);\n\n        if (write(connfd, send_line, nbytes) != nbytes)\n            error(1, errno, &quot;write error&quot;);\n    }\n\n    close(listenfd);\n    close(connfd);\n\n    exit(0);\n\n}\n</code></pre><p>我对这个程序做一个详细的解释：</p><ul>\n<li>第12～15行非常关键，<strong>这里创建的套接字类型，注意是AF_LOCAL，并且使用字节流格式</strong>。你现在可以回忆一下，TCP的类型是AF_INET和字节流类型；UDP的类型是AF_INET和数据报类型。在前面的文章中，我们提到AF_UNIX也是可以的，基本上可以认为和AF_LOCAL是等价的。</li>\n<li>第17～21行创建了一个本地地址，这里的本地地址和IPv4、IPv6地址可以对应，数据类型为sockaddr_un，这个数据类型中的sun_family需要填写为AF_LOCAL，最为关键的是需要对sun_path设置一个本地文件路径。我们这里还做了一个unlink操作，以便把存在的文件删除掉，这样可以保持幂等性。</li>\n<li>第23～29行，分别执行bind和listen操作，这样就监听在一个本地文件路径标识的套接字上，这和普通的TCP服务端程序没什么区别。</li>\n<li>第41～56行，使用read和write函数从套接字中按照字节流的方式读取和发送数据。</li>\n</ul><p>我在这里着重强调一下本地文件路径。关于本地文件路径，需要明确一点，它必须是“绝对路径”，这样的话，编写好的程序可以在任何目录里被启动和管理。如果是“相对路径”，为了保持同样的目的，这个程序的启动路径就必须固定，这样一来，对程序的管理反而是一个很大的负担。</p><p>另外还要明确一点，这个本地文件，必须是一个“文件”，不能是一个“目录”。如果文件不存在，后面bind操作时会自动创建这个文件。</p><p>还有一点需要牢记，在Linux下，任何文件操作都有权限的概念，应用程序启动时也有应用属主。如果当前启动程序的用户权限不能创建文件，你猜猜会发生什么呢？这里我先卖个关子，一会演示的时候你就会看到结果。</p><p>下面我们再看一下客户端程序。</p><pre><code>#include &quot;lib/common.h&quot;\n\nint main(int argc, char **argv) {\n    if (argc != 2) {\n        error(1, 0, &quot;usage: unixstreamclient &lt;local_path&gt;&quot;);\n    }\n\n    int sockfd;\n    struct sockaddr_un servaddr;\n\n    sockfd = socket(AF_LOCAL, SOCK_STREAM, 0);\n    if (sockfd &lt; 0) {\n        error(1, errno, &quot;create socket failed&quot;);\n    }\n\n    bzero(&amp;servaddr, sizeof(servaddr));\n    servaddr.sun_family = AF_LOCAL;\n    strcpy(servaddr.sun_path, argv[1]);\n\n    if (connect(sockfd, (struct sockaddr *) &amp;servaddr, sizeof(servaddr)) &lt; 0) {\n        error(1, errno, &quot;connect failed&quot;);\n    }\n\n    char send_line[MAXLINE];\n    bzero(send_line, MAXLINE);\n    char recv_line[MAXLINE];\n\n    while (fgets(send_line, MAXLINE, stdin) != NULL) {\n\n        int nbytes = sizeof(send_line);\n        if (write(sockfd, send_line, nbytes) != nbytes)\n            error(1, errno, &quot;write error&quot;);\n\n        if (read(sockfd, recv_line, MAXLINE) == 0)\n            error(1, errno, &quot;server terminated prematurely&quot;);\n\n        fputs(recv_line, stdout);\n    }\n\n    exit(0);\n}\n</code></pre><p>下面我带大家理解一下这个客户端程序。</p><ul>\n<li>11～14行创建了一个本地套接字，和前面服务器端程序一样，用的也是字节流类型SOCK_STREAM。</li>\n<li>16～18行初始化目标服务器端的地址。我们知道在TCP编程中，使用的是服务器的IP地址和端口作为目标，在本地套接字中则使用文件路径作为目标标识，sun_path这个字段标识的是目标文件路径，所以这里需要对sun_path进行初始化。</li>\n<li>20行和TCP客户端一样，发起对目标套接字的connect调用，不过由于是本地套接字，并不会有三次握手。</li>\n<li>28～38行从标准输入中读取字符串，向服务器端发送，之后将服务器端传输过来的字符打印到标准输出上。</li>\n</ul><p>总体上，我们可以看到，本地字节流套接字和TCP服务器端、客户端编程最大的差异就是套接字类型的不同。本地字节流套接字识别服务器不再通过IP地址和端口，而是通过本地文件。</p><p>接下来，我们就运行这个程序来加深对此的理解。</p><h3>只启动客户端</h3><p>第一个场景中，我们只启动客户端程序：</p><pre><code>$ ./unixstreamclient /tmp/unixstream.sock\nconnect failed: No such file or directory (2)\n</code></pre><p>我们看到，由于没有启动服务器端，没有一个本地套接字在/tmp/unixstream.sock这个文件上监听，客户端直接报错，提示我们没有文件存在。</p><h3>服务器端监听在无权限的文件路径上</h3><p>还记得我们在前面卖的关子吗？在Linux下，执行任何应用程序都有应用属主的概念。在这里，我们让服务器端程序的应用属主没有/var/lib/目录的权限，然后试着启动一下这个服务器程序 ：</p><pre><code>$ ./unixstreamserver /var/lib/unixstream.sock\nbind failed: Permission denied (13)\n</code></pre><p>这个结果告诉我们启动服务器端程序的用户，必须对本地监听路径有权限。这个结果和你期望的一致吗？</p><p>试一下root用户启动该程序：</p><pre><code>sudo ./unixstreamserver /var/lib/unixstream.sock\n(阻塞运行中)\n</code></pre><p>我们看到，服务器端程序正常运行了。</p><p>打开另外一个shell，我们看到/var/lib下创建了一个本地文件，大小为0，而且文件的最后结尾有一个（=）号。其实这就是bind的时候自动创建出来的文件。</p><pre><code>$ ls -al /var/lib/unixstream.sock\nrwxr-xr-x 1 root root 0 Jul 15 12:41 /var/lib/unixstream.sock=\n</code></pre><p>如果我们使用netstat命令查看UNIX域套接字，就会发现unixstreamserver这个进程，监听在/var/lib/unixstream.sock这个文件路径上。</p><p><img src=\"https://static001.geekbang.org/resource/image/58/b1/58d259d15b7012645d168a9c5d9f3fb1.jpg?wh=2369*334\" alt=\"\"><br>\n看看，很简单吧，我们写的程序和鼎鼎大名的Kubernetes运行在同一机器上，原理和行为完全一致。</p><h3>服务器-客户端应答</h3><p>现在，我们让服务器和客户端都正常启动，并且客户端依次发送字符：</p><pre><code>$./unixstreamserver /tmp/unixstream.sock\nReceive: g1\nReceive: g2\nReceive: g3\nclient quit\n</code></pre><pre><code>$./unixstreamclient /tmp/unixstream.sock\ng1\nHi, g1\ng2\nHi, g2\ng3\nHi, g3\n^C\n</code></pre><p>我们可以看到，服务器端陆续收到客户端发送的字节，同时，客户端也收到了服务器端的应答；最后，当我们使用Ctrl+C，让客户端程序退出时，服务器端也正常退出。</p><h2>本地数据报套接字</h2><p>我们再来看下在本地套接字上使用数据报的服务器端例子：</p><pre><code>#include  &quot;lib/common.h&quot;\n\nint main(int argc, char **argv) {\n    if (argc != 2) {\n        error(1, 0, &quot;usage: unixdataserver &lt;local_path&gt;&quot;);\n    }\n\n    int socket_fd;\n    socket_fd = socket(AF_LOCAL, SOCK_DGRAM, 0);\n    if (socket_fd &lt; 0) {\n        error(1, errno, &quot;socket create failed&quot;);\n    }\n\n    struct sockaddr_un servaddr;\n    char *local_path = argv[1];\n    unlink(local_path);\n    bzero(&amp;servaddr, sizeof(servaddr));\n    servaddr.sun_family = AF_LOCAL;\n    strcpy(servaddr.sun_path, local_path);\n\n    if (bind(socket_fd, (struct sockaddr *) &amp;servaddr, sizeof(servaddr)) &lt; 0) {\n        error(1, errno, &quot;bind failed&quot;);\n    }\n\n    char buf[BUFFER_SIZE];\n    struct sockaddr_un client_addr;\n    socklen_t client_len = sizeof(client_addr);\n    while (1) {\n        bzero(buf, sizeof(buf));\n        if (recvfrom(socket_fd, buf, BUFFER_SIZE, 0, (struct sockadd *) &amp;client_addr, &amp;client_len) == 0) {\n            printf(&quot;client quit&quot;);\n            break;\n        }\n        printf(&quot;Receive: %s \\n&quot;, buf);\n\n        char send_line[MAXLINE];\n        bzero(send_line, MAXLINE);\n        sprintf(send_line, &quot;Hi, %s&quot;, buf);\n\n        size_t nbytes = strlen(send_line);\n        printf(&quot;now sending: %s \\n&quot;, send_line);\n\n        if (sendto(socket_fd, send_line, nbytes, 0, (struct sockadd *) &amp;client_addr, client_len) != nbytes)\n            error(1, errno, &quot;sendto error&quot;);\n    }\n\n    close(socket_fd);\n\n    exit(0);\n}\n</code></pre><p>本地数据报套接字和前面的字节流本地套接字有以下几点不同：</p><ul>\n<li>第9行创建的本地套接字，<strong>这里创建的套接字类型，注意是AF_LOCAL</strong>，协议类型为SOCK_DGRAM。</li>\n<li>21～23行bind到本地地址之后，没有再调用listen和accept，回忆一下，这其实和UDP的性质一样。</li>\n<li>28～45行使用recvfrom和sendto来进行数据报的收发，不再是read和send，这其实也和UDP网络程序一致。</li>\n</ul><p>然后我们再看一下客户端的例子：</p><pre><code>#include &quot;lib/common.h&quot;\n\nint main(int argc, char **argv) {\n    if (argc != 2) {\n        error(1, 0, &quot;usage: unixdataclient &lt;local_path&gt;&quot;);\n    }\n\n    int sockfd;\n    struct sockaddr_un client_addr, server_addr;\n\n    sockfd = socket(AF_LOCAL, SOCK_DGRAM, 0);\n    if (sockfd &lt; 0) {\n        error(1, errno, &quot;create socket failed&quot;);\n    }\n\n    bzero(&amp;client_addr, sizeof(client_addr));        /* bind an address for us */\n    client_addr.sun_family = AF_LOCAL;\n    strcpy(client_addr.sun_path, tmpnam(NULL));\n\n    if (bind(sockfd, (struct sockaddr *) &amp;client_addr, sizeof(client_addr)) &lt; 0) {\n        error(1, errno, &quot;bind failed&quot;);\n    }\n\n    bzero(&amp;server_addr, sizeof(server_addr));\n    server_addr.sun_family = AF_LOCAL;\n    strcpy(server_addr.sun_path, argv[1]);\n\n    char send_line[MAXLINE];\n    bzero(send_line, MAXLINE);\n    char recv_line[MAXLINE];\n\n    while (fgets(send_line, MAXLINE, stdin) != NULL) {\n        int i = strlen(send_line);\n        if (send_line[i - 1] == '\\n') {\n            send_line[i - 1] = 0;\n        }\n        size_t nbytes = strlen(send_line);\n        printf(&quot;now sending %s \\n&quot;, send_line);\n\n        if (sendto(sockfd, send_line, nbytes, 0, (struct sockaddr *) &amp;server_addr, sizeof(server_addr)) != nbytes)\n            error(1, errno, &quot;sendto error&quot;);\n\n        int n = recvfrom(sockfd, recv_line, MAXLINE, 0, NULL, NULL);\n        recv_line[n] = 0;\n\n        fputs(recv_line, stdout);\n        fputs(&quot;\\n&quot;, stdout);\n    }\n\n    exit(0);\n}\n</code></pre><p>这个程序和UDP网络编程的例子基本是一致的，我们可以把它当作是用本地文件替换了IP地址和端口的UDP程序，不过，这里还是有一个非常大的不同的。</p><p>这个不同点就在16～22行。你可以看到16～22行将本地套接字bind到本地一个路径上，然而UDP客户端程序是不需要这么做的。本地数据报套接字这么做的原因是，它需要指定一个本地路径，以便在服务器端回包时，可以正确地找到地址；而在UDP客户端程序里，数据是可以通过UDP包的本地地址和端口来匹配的。</p><p>下面这段代码就展示了服务器端和客户端通过数据报应答的场景：</p><pre><code> ./unixdataserver /tmp/unixdata.sock\nReceive: g1\nnow sending: Hi, g1\nReceive: g2\nnow sending: Hi, g2\nReceive: g3\nnow sending: Hi, g3\n</code></pre><pre><code>$ ./unixdataclient /tmp/unixdata.sock\ng1\nnow sending g1\nHi, g1\ng2\nnow sending g2\nHi, g2\ng3\nnow sending g3\nHi, g3\n^C\n</code></pre><p>我们可以看到，服务器端陆续收到客户端发送的数据报，同时，客户端也收到了服务器端的应答。</p><h2>总结</h2><p>我在开头已经说过，本地套接字作为常用的进程间通信技术，被用于各种适用于在同一台主机上进程间通信的场景。关于本地套接字，我们需要牢记以下两点：</p><ul>\n<li>本地套接字的编程接口和IPv4、IPv6套接字编程接口是一致的，可以支持字节流和数据报两种协议。</li>\n<li>本地套接字的实现效率大大高于IPv4和IPv6的字节流、数据报套接字实现。</li>\n</ul><h2>思考题</h2><p>讲完本地套接字之后，我给你留几道思考题。</p><ol>\n<li>在本地套接字字节流类型的客户端-服务器例子中，我们让服务器端以root账号启动，监听在/var/lib/unixstream.sock这个文件上。如果我们让客户端以普通用户权限启动，客户端可以连接上/var/lib/unixstream.sock吗？为什么呢？</li>\n<li>我们看到客户端被杀死后，服务器端也正常退出了。看下退出后打印的日志，你不妨判断一下引起服务器端正常退出的逻辑是什么？</li>\n<li>你有没有想过这样一个奇怪的场景：如果自己不小心写错了代码，本地套接字服务器端是SOCK_DGRAM，客户端使用的是SOCK_STREAM，路径和其他都是正确的，你觉得会发生什么呢？</li>\n</ol><p>欢迎你在评论区写下你的思考，我会和你一起交流这些问题。如果这篇文章帮你弄懂了本地套接字，不妨把它分享给你的朋友或者同事，一起交流一下它吧！</p>","comments":[{"had_liked":false,"id":147066,"user_name":"supermouse","can_delete":false,"product_type":"c1","uid":1321860,"ip_address":"","ucode":"88072D5F881827","user_header":"https://static001.geekbang.org/account/avatar/00/14/2b/84/07f0c0d6.jpg","comment_is_top":false,"comment_ctime":1572784586,"is_pvip":false,"replies":[{"id":"57472","content":"看样子你都尝试了，实践出真知，赞","user_name":"作者回复","comment_id":147066,"uid":"1618647","ip_address":"","utype":1,"ctime":1573281288,"user_name_real":"froghui"}],"discussion_count":5,"race_medal":0,"score":"349465135562","product_id":100032701,"comment_content":"问题一：连接不上。错误提示是“Permission denied”<br><br>问题二：在服务端的代码中，对收到的客户端发送的数据长度做了判断，如果长度为0，则主动关闭服务端程序。这是杀死客户端后引发服务端关闭的原因。这也说明客户端在被强行终止的时候，会最后向服务端发送一条空消息，告知服务器自己这边的程序关闭了。<br><br>问题三：客户端在连接时会报错，错误提示是“Protocol wrong type for socket (91)”","like_count":81,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473125,"discussion_content":"看样子你都尝试了，实践出真知，赞","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573281288,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1027840,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/af/00/9b49f42b.jpg","nickname":"skye","note":"","ucode":"C55C9F52C78A00","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":101238,"discussion_content":"客户端不会发送空消息吧？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577285732,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1130666,"avatar":"https://static001.geekbang.org/account/avatar/00/11/40/aa/49bbb007.jpg","nickname":"нáпの゛","note":"","ucode":"834FA877EFBAF7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1027840,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/af/00/9b49f42b.jpg","nickname":"skye","note":"","ucode":"C55C9F52C78A00","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":299529,"discussion_content":"我也觉得没有空消息，就是接收不到数据长度就为0","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597722952,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":101238,"ip_address":""},"score":299529,"extra":""}]},{"author":{"id":1605506,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/M1ia9VKiaibL7pLhSvUvLGvkgr6x3SbYNnk4u5zhtgY0cmmhTiad2Is3YraBN7OlLvkoia2iav4hsY8Asjb9R2rGZ3tg/132","nickname":"Geek_e0ff03","note":"","ucode":"477AE2D92BD358","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":71751,"discussion_content":"有一个疑问，如果在kill的时候使用-9，结果会怎样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575455955,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2239839,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/u1Zr9yTrTibSWicFFophCK9KvSkt5ETLfxoL4eejFoPOZJTYorjibK3y0s4odHmUphHwcrHtDfYiag4bId4Cr6zfuw/132","nickname":"solk","note":"","ucode":"7246DBAED4ABB5","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1605506,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/M1ia9VKiaibL7pLhSvUvLGvkgr6x3SbYNnk4u5zhtgY0cmmhTiad2Is3YraBN7OlLvkoia2iav4hsY8Asjb9R2rGZ3tg/132","nickname":"Geek_e0ff03","note":"","ucode":"477AE2D92BD358","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587774,"discussion_content":"看你kill的是谁，如果kill客户端，服务端同样会收到fin消息，这个是内核层发的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663290008,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":71751,"ip_address":"上海"},"score":587774,"extra":""}]}]},{"had_liked":false,"id":142165,"user_name":"GeekAmI","can_delete":false,"product_type":"c1","uid":1005030,"ip_address":"","ucode":"232C0B6DFB9F56","user_header":"https://static001.geekbang.org/account/avatar/00/0f/55/e6/87197b10.jpg","comment_is_top":false,"comment_ctime":1571302760,"is_pvip":false,"replies":[{"id":"55118","content":"👍","user_name":"作者回复","comment_id":142165,"uid":"1618647","ip_address":"","utype":1,"ctime":1571456956,"user_name_real":"froghui"}],"discussion_count":2,"race_medal":0,"score":"87470648680","product_id":100032701,"comment_content":"问题1：<br>$ sudo .&#47;unixstreamserver &#47;var&#47;lib&#47;unixstream.sock<br><br>$ .&#47;unixstreamclient &#47;var&#47;lib&#47;unixstream.sock<br>connect failed: Permission denied (13)<br><br>问题2：<br>client: Ctrl + C -&gt; exit(0) -&gt; 发送FIN包；<br>server:满足条件read(connfd, buf, BUFFER_SIZE) == 0，结束。<br><br>问题3：<br>$ .&#47;unixdataserver &#47;tmp&#47;unixdata.sock<br><br>$ .&#47;unixstreamclient &#47;tmp&#47;unixdata.sock<br>connect failed: Protocol wrong type for socket (41)","like_count":20,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471014,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571456956,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1512599,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/88nXicqmkJWm3IXVfPfGQSk8SKIBVKjuC4qhzaCkf5Ud88uvKgS4Vf5AzCJ1uaFO0gpPnxdh4CowfhpxV1kSbXw/132","nickname":"lixin","note":"","ucode":"94D99DAFB6C929","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584384,"discussion_content":"还是要走协议栈呢。还是要收到fin包啥的呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660797644,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":229829,"user_name":"衬衫的价格是19美元","can_delete":false,"product_type":"c1","uid":1397631,"ip_address":"","ucode":"655F925451F772","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKVUskibDnhMt5MCIJ8227HWkeg2wEEyewps8GuWhWaY5fy7Ya56bu2ktMlxdla3K29Wqia9efCkWaQ/132","comment_is_top":false,"comment_ctime":1593158393,"is_pvip":false,"replies":[{"id":"84808","content":"👍","user_name":"作者回复","comment_id":229829,"uid":"1618647","ip_address":"","utype":1,"ctime":1593174111,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"70312635129","product_id":100032701,"comment_content":"为什么AF_LOCAL+DGRAM的时候,客户端需要bind一个本地文件？<br>因为服务器收到来自客户端的数据想要给客户端回复的时候，需要知道发给谁。在其他情况下，服务器都有办法：<br>1.当使用STREAM时，不管是AF_INET还是AF_LOCAL, 都有连接的概念，所以服务器可以使用原来的连接<br>2.当使用AF_INET时，不管是DGRAM还是STREAM, 都能知道对方的ip+port, 也能确定一个唯一的进程<br>只有AF_LOCAL+DGRAM的时候，没有连接，也没有ip_+port,   只能显式的指定一个标志告诉服务端<br>","like_count":16,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499660,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593174111,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":124875,"user_name":"Sylar.","can_delete":false,"product_type":"c1","uid":1007623,"ip_address":"","ucode":"CAE26E4C31C967","user_header":"https://static001.geekbang.org/account/avatar/00/0f/60/07/c2738be7.jpg","comment_is_top":false,"comment_ctime":1566006701,"is_pvip":false,"replies":[{"id":"45915","content":"答疑篇统一回复","user_name":"作者回复","comment_id":124875,"uid":"1618647","ip_address":"","utype":1,"ctime":1566128569,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"27335810477","product_id":100032701,"comment_content":"老师您好，方便把全部代码放git吗，因为示例缺少依赖","like_count":6,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463344,"discussion_content":"答疑篇统一回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566128569,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":124588,"user_name":"许童童","can_delete":false,"product_type":"c1","uid":1003005,"ip_address":"","ucode":"4B799C0C6BC678","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4d/fd/0aa0e39f.jpg","comment_is_top":false,"comment_ctime":1565925320,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"27335729096","product_id":100032701,"comment_content":"1.没有权限，报permission deny错误。<br>2.代码中有写：<br>if (read(connfd, buf, BUFFER_SIZE) == 0) {<br>            printf(&quot;client quit&quot;);<br>            break;<br>        }<br>3.客户端使用的是 SOCK_STREAM。猜测会因为使用协议不同，会连接不上，报错。","like_count":6,"discussions":[{"author":{"id":1593363,"avatar":"https://static001.geekbang.org/account/avatar/00/18/50/13/104d9501.jpg","nickname":"另一半棉花糖","note":"","ucode":"C11266794FBA5B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6150,"discussion_content":"第三个，本地套接字没有协议栈啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566727423,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":129316,"user_name":"15652790052","can_delete":false,"product_type":"c1","uid":1274615,"ip_address":"","ucode":"8A15D673C16A8F","user_header":"","comment_is_top":false,"comment_ctime":1567086317,"is_pvip":false,"replies":[{"id":"48192","content":"1.没什么内容，只是一个占位符，告诉客户端要连哪个sock；<br>2.没有仔细研读过kernel的代码，不过我猜是大量复用了TCP&#47;IP层的公共实现；<br>3.因为文件已经告诉我们连接的目标了，所以不需要端口。","user_name":"作者回复","comment_id":129316,"uid":"1618647","ip_address":"","utype":1,"ctime":1567130680,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"23041922797","product_id":100032701,"comment_content":"1.sock文件具体内容什么呢，为什么需要sock文件？<br>2.本地套接字底层时怎么实现的呢？<br>3.为什么没有了端口的概念？","like_count":5,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465395,"discussion_content":"1.没什么内容，只是一个占位符，告诉客户端要连哪个sock；\n2.没有仔细研读过kernel的代码，不过我猜是大量复用了TCP/IP层的公共实现；\n3.因为文件已经告诉我们连接的目标了，所以不需要端口。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567130680,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125010,"user_name":"一步","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1566043531,"is_pvip":true,"replies":[{"id":"45912","content":"我是这么理解的，本地套接字本质还是进程间通信，只是借助了套接字的编程语义，比如stream和datagram，最下面肯定不走IP协议的。","user_name":"作者回复","comment_id":125010,"uid":"1618647","ip_address":"","utype":1,"ctime":1566128513,"user_name_real":"froghui"}],"discussion_count":5,"race_medal":0,"score":"18745912715","product_id":100032701,"comment_content":"文章中说 TCP 和 UDP 的scoket 通讯 是走网络协议的，本地socket 通讯减少了网络协议的实现，是说明本地scoket通讯一点都不走网络协议吗？ 还是会走其中的一部分网络协议？ <br><br>如果本地 socket 通讯不走网络协议，那通讯的标准是什么呢？ 只是对 socket 文件的读写操作吗？","like_count":4,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463399,"discussion_content":"我是这么理解的，本地套接字本质还是进程间通信，只是借助了套接字的编程语义，比如stream和datagram，最下面肯定不走IP协议的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566128513,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2608728,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ce/58/71ed845f.jpg","nickname":"Dexter","note":"","ucode":"909CABC4AC4AC9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":573248,"discussion_content":"没有说清楚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653294538,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":463399,"ip_address":""},"score":573248,"extra":""}]},{"author":{"id":2608728,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ce/58/71ed845f.jpg","nickname":"Dexter","note":"","ucode":"909CABC4AC4AC9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":573318,"discussion_content":"到底走没走传输层，比如TCP和UDP？希望老师给一个答案","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653355404,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1027840,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/af/00/9b49f42b.jpg","nickname":"skye","note":"","ucode":"C55C9F52C78A00","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":101263,"discussion_content":"不走IP层，应该走了TCP层吧，不然怎么实现TCP和UDP呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577285915,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"一步","note":"","ucode":"73CEA468CE70C3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1027840,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/af/00/9b49f42b.jpg","nickname":"skye","note":"","ucode":"C55C9F52C78A00","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":101331,"discussion_content":"对的，TCP下层不一定是TP层，使用TCP或者UDP的规范，报文格式","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1577286647,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":101263,"ip_address":""},"score":101331,"extra":""}]}]},{"had_liked":false,"id":124770,"user_name":"yusuf","can_delete":false,"product_type":"c1","uid":1170784,"ip_address":"","ucode":"9F32149B2ADDA0","user_header":"https://static001.geekbang.org/account/avatar/00/11/dd/60/eae432c6.jpg","comment_is_top":false,"comment_ctime":1565968703,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"14450870591","product_id":100032701,"comment_content":"1、不能连接，需要权限才能对sock文件进行读写<br>2、代码30～33行，服务器读到的数据长度为0时会退出。<br>3、认为会出现如下现象：<br>如果服务器写错了，服务器会输出listen failed，客户端会输出connect failed；<br>如果客户端写错了，服务器会输出client quit，客户端会输出sendto error。<br>","like_count":3,"discussions":[{"author":{"id":1170784,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/60/eae432c6.jpg","nickname":"yusuf","note":"","ucode":"9F32149B2ADDA0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5211,"discussion_content":"实际执行结果如下：\n1、客户端会输出：connect failed: Permission denied\n3、服务端写错时，服务器输出：listen failed: Operation not supported，客户端输出：connect failed: Connection refused\n客户端写错时，服务器无输出，不退出，客户端在发送“g1”时输出sendto error: Operation not supported\n\n","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1566054274,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1111870,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK2Az5uTh9ZGVA7yQCj1BXtXuicPRkvJicA97AoN9xX3bnPcUYglTMXJeZeoVbPQeJA7ICvQhR3KQ0w/132","nickname":"日不落帝国","note":"","ucode":"6A11ABBD8AC438","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1170784,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/60/eae432c6.jpg","nickname":"yusuf","note":"","ucode":"9F32149B2ADDA0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":25103,"discussion_content":"学习了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570420057,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":5211,"ip_address":""},"score":25103,"extra":""}]}]},{"had_liked":false,"id":124502,"user_name":"刘丹","can_delete":false,"product_type":"c1","uid":1081922,"ip_address":"","ucode":"66594D1C957E15","user_header":"https://static001.geekbang.org/account/avatar/00/10/82/42/8b04d489.jpg","comment_is_top":false,"comment_ctime":1565913638,"is_pvip":false,"replies":[{"id":"45924","content":"本地套接字datagram就可以","user_name":"作者回复","comment_id":124502,"uid":"1618647","ip_address":"","utype":1,"ctime":1566129064,"user_name_real":"froghui"}],"discussion_count":2,"race_medal":0,"score":"14450815526","product_id":100032701,"comment_content":"请问老师本地套接字是否支持一对多、多对多通信？","like_count":3,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463204,"discussion_content":"本地套接字datagram就可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566129064,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1149592,"avatar":"https://static001.geekbang.org/account/avatar/00/11/8a/98/2be9d17b.jpg","nickname":"破晓^_^","note":"","ucode":"3224920095AC9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5235,"discussion_content":"支持一对多，就和TCP的socket是一样的，只不过在本机通信罢了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566102611,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":129641,"user_name":"J.M.Liu","can_delete":false,"product_type":"c1","uid":1200037,"ip_address":"","ucode":"B2CB84B8E923A6","user_header":"https://static001.geekbang.org/account/avatar/00/12/4f/a5/71358d7b.jpg","comment_is_top":false,"comment_ctime":1567179301,"is_pvip":false,"replies":[{"id":"50797","content":"这个值是为了回包的需要，常规情况是不需要的，但是在某些情况下还是有点作用的，比如让客户端快速出错。","user_name":"作者回复","comment_id":129641,"uid":"1618647","ip_address":"","utype":1,"ctime":1568191096,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"10157113893","product_id":100032701,"comment_content":"datagram client中，为什么还要bind一个本地地址呀？没有看出这个这个本地地址有什么用呀。难道它是用来作为接受数据的缓冲区的吗？好像没有它也并不影响数据收发，换句话说，client_addr.sun_path填什么好像都无所谓啊。","like_count":2,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465580,"discussion_content":"这个值是为了回包的需要，常规情况是不需要的，但是在某些情况下还是有点作用的，比如让客户端快速出错。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568191096,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":276479,"user_name":"蚂蚁哈哈哈","can_delete":false,"product_type":"c1","uid":1084222,"ip_address":"","ucode":"981244D51231A7","user_header":"https://static001.geekbang.org/account/avatar/00/10/8b/3e/3a50d491.jpg","comment_is_top":false,"comment_ctime":1611968037,"is_pvip":false,"replies":[{"id":"100429","content":"你的昵称好汗~","user_name":"作者回复","comment_id":276479,"uid":"1618647","ip_address":"","utype":1,"ctime":1612101874,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"5906935333","product_id":100032701,"comment_content":"答案：<br>问题1: 客户端报错： &quot;connect failed: Permission denied&quot;<br>问题2:  下面这段代码中 == 0 的代码表示的就是客户端推出，这时候服务端打印 &quot;client quit&quot;, 然后推出 read 循环，关闭服务端程序。<br><br>`if (read(connfd, buf, BUFFER_SIZE) == 0) {<br>      printf(&quot;client quit&quot;);<br>      break;<br>    }`<br><br>问题三： 客户端报错 &quot;connect failed: Protocol wrong type for socket&quot;","like_count":1,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514718,"discussion_content":"你的昵称好汗~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612101874,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":243822,"user_name":"重小楼不吃素","can_delete":false,"product_type":"c1","uid":1782129,"ip_address":"","ucode":"424180E1FDD702","user_header":"https://static001.geekbang.org/account/avatar/00/1b/31/71/a7b9a2d4.jpg","comment_is_top":false,"comment_ctime":1598282258,"is_pvip":false,"replies":[{"id":"90121","content":"第一个问题，一对一你可以理解成两个IP地址，一个对另一个发送数据；而一对多，你可以理解成一个IP地址对很多其他IP地址发送数据。<br><br>第二个问题，我理解UDP是没有发送和接收缓冲区的，数据被直接传递到数据链路层中发送出去。","user_name":"作者回复","comment_id":243822,"uid":"1618647","ip_address":"","utype":1,"ctime":1598795807,"user_name_real":"froghui"}],"discussion_count":2,"race_medal":0,"score":"5893249554","product_id":100032701,"comment_content":"老师你好，我在讨论区看到“一对多，多对多通信”这样的概念，有点不明白。请问一对多指的是建立一个套接字可以允许多个客户端连接的意思吗？  如果是的话，本地套接字的 SOCK_STREAM 方式也能一对多呀，老师为什么只提到 SOCK_DGRAM 可以？<br>问题二：<br>TCP\\UDP\\本地套接字 是否都有发送缓冲区、接收缓冲区，TCP的发送&#47;接收缓冲区很好理解，其余两个我没有查找到说得比较透彻的资料","like_count":1,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":504403,"discussion_content":"第一个问题，一对一你可以理解成两个IP地址，一个对另一个发送数据；而一对多，你可以理解成一个IP地址对很多其他IP地址发送数据。\n\n第二个问题，我理解UDP是没有发送和接收缓冲区的，数据被直接传递到数据链路层中发送出去。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598795807,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2608728,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ce/58/71ed845f.jpg","nickname":"Dexter","note":"","ucode":"909CABC4AC4AC9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":573319,"discussion_content":"老师是说本地datagram 或者AF_INET datagram都没有发送/接收缓冲区的概念？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1653355632,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":504403,"ip_address":""},"score":573319,"extra":""}]}]},{"had_liked":false,"id":229369,"user_name":"夏雨","can_delete":false,"product_type":"c1","uid":1050808,"ip_address":"","ucode":"D009156B20B89E","user_header":"https://static001.geekbang.org/account/avatar/00/10/08/b8/6a296e32.jpg","comment_is_top":false,"comment_ctime":1592977654,"is_pvip":false,"replies":[{"id":"84804","content":"好问题。我是这么理解的，在本地套接字情况下，所谓SOCK_STREAM和SOCK_DGRAM是指编程方式和非本地套接字下的TCP、UDP一致。","user_name":"作者回复","comment_id":229369,"uid":"1618647","ip_address":"","utype":1,"ctime":1593173769,"user_name_real":"froghui"}],"discussion_count":2,"race_medal":0,"score":"5887944950","product_id":100032701,"comment_content":"既然是本地套接字不走网路协议， 那本地套接字的TCP 和 UDP 又有什么去别， UDP在缓存里也不会丢包乱序。","like_count":1,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499457,"discussion_content":"好问题。我是这么理解的，在本地套接字情况下，所谓SOCK_STREAM和SOCK_DGRAM是指编程方式和非本地套接字下的TCP、UDP一致。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593173769,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1662117,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM7zuDYFIutbSPc4eEtcMhdNBTI1FRR7q0xrGh2X1QdiaNxvAV31HcRUsjPWLaaWftqgwTnVoiaica8Nw/132","nickname":"胜辉（大V）","note":"","ucode":"3C13BFCD82D4EC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":407371,"discussion_content":"本地套接字的流模式应该也有缓冲区吧 按语义对等来理解应该是这样","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1634993317,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":226131,"user_name":"郑祖煌","can_delete":false,"product_type":"c1","uid":1469608,"ip_address":"","ucode":"49A0D2E3279826","user_header":"https://static001.geekbang.org/account/avatar/00/16/6c/a8/1922a0f5.jpg","comment_is_top":false,"comment_ctime":1591957002,"is_pvip":false,"replies":[{"id":"84278","content":"你把文件理解成端口就可以了，多个客户端也是可以通过这个文件和一个服务器端进行通信的。","user_name":"作者回复","comment_id":226131,"uid":"1618647","ip_address":"","utype":1,"ctime":1592744010,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"5886924298","product_id":100032701,"comment_content":"这边举例的本地套接字是一个服务器对应着一个客户端。 那想问一下能不能一个服务器对应着多个客户端。如果对应的多个客户端，他们还是通过一个文件就可以进行通信？ 还是要设置说一对关系要通过一个文件进行通信？","like_count":1,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":498116,"discussion_content":"你把文件理解成端口就可以了，多个客户端也是可以通过这个文件和一个服务器端进行通信的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592744010,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":156506,"user_name":"HunterYuan","can_delete":false,"product_type":"c1","uid":1015256,"ip_address":"","ucode":"F8900C33D29AA7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7d/d8/d7c77764.jpg","comment_is_top":false,"comment_ctime":1574903852,"is_pvip":false,"replies":[{"id":"60374","content":"头像好赞。","user_name":"作者回复","comment_id":156506,"uid":"1618647","ip_address":"","utype":1,"ctime":1575185830,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"5869871148","product_id":100032701,"comment_content":"对于第二个问题，第五讲已进行了充分说明：read 函数要求操作系统内核从套接字描述字 socketfd读取最多多少个字节（size），并将结果存储到 buffer 中。返回值告诉我们实际读取的字节数目，也有一些特殊情况，如果返回值为 0，表示 EOF（end-of-file），这在网络中表示对端发送了 FIN 包，要处理断连的情况。<br>也就是说，只有流方式会遇到这种情况：<br>client: Ctrl + C -&gt; exit(0) -&gt; 发送FIN包；<br>server:满足条件read(connfd, buf, BUFFER_SIZE) == 0，结束。","like_count":1,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476134,"discussion_content":"头像好赞。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575185830,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":135291,"user_name":"Kepler","can_delete":false,"product_type":"c1","uid":1214303,"ip_address":"","ucode":"0C9CA3DB8B3CF0","user_header":"https://static001.geekbang.org/account/avatar/00/12/87/5f/6bf8b74a.jpg","comment_is_top":false,"comment_ctime":1569119022,"is_pvip":true,"replies":[{"id":"52189","content":"https:&#47;&#47;github.com&#47;froghui&#47;yolanda&#47;blob&#47;master&#47;lib&#47;common.h","user_name":"作者回复","comment_id":135291,"uid":"1618647","ip_address":"","utype":1,"ctime":1569406284,"user_name_real":"froghui"}],"discussion_count":1,"race_medal":0,"score":"5864086318","product_id":100032701,"comment_content":"lib&#47;common.h 的绝对路径是啥，有这个文件吗？","like_count":1,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468128,"discussion_content":"https://github.com/froghui/yolanda/blob/master/lib/common.h","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569406284,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127891,"user_name":"knull","can_delete":false,"product_type":"c1","uid":1043484,"ip_address":"","ucode":"3BFECF3D29F40C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ec/1c/d323b066.jpg","comment_is_top":false,"comment_ctime":1566805266,"is_pvip":false,"replies":[{"id":"47936","content":"1.加一个SIGPIPE信号处理<br>2.读到EOF就不要write了","user_name":"作者回复","comment_id":127891,"uid":"1618647","ip_address":"","utype":1,"ctime":1567005650,"user_name_real":"froghui"}],"discussion_count":2,"race_medal":0,"score":"5861772562","product_id":100032701,"comment_content":"老师，你好，我练习写了一个echoserver（用AF_UNIX）,客户端主动断链。<br>发现在客户端close的时候，echoserver会读取到数据，并且最后一次write。但是，这个时候连接已经断了，会报错broken pipe。程序直接挂掉了。。。<br>这种情况该怎么处理呢？","like_count":1,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464696,"discussion_content":"1.加一个SIGPIPE信号处理\n2.读到EOF就不要write了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567005650,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043484,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ec/1c/d323b066.jpg","nickname":"knull","note":"","ucode":"3BFECF3D29F40C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6354,"discussion_content":"我现在知道，用信号量来处理。\n我想问，是不是只有这样一种方案？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566868012,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125082,"user_name":"沉淀的梦想","can_delete":false,"product_type":"c1","uid":1177315,"ip_address":"","ucode":"BCB7C26F9D214B","user_header":"https://static001.geekbang.org/account/avatar/00/11/f6/e3/e4bcd69e.jpg","comment_is_top":false,"comment_ctime":1566057148,"is_pvip":false,"replies":[{"id":"45942","content":"你可以在linux系统里执行man命令，例如man socket:<br><br>SOCKET(2)                                                              Linux Programmer&#39;s Manual                                                             SOCKET(2)<br><br>NAME<br>       socket - create an endpoint for communication<br><br>SYNOPSIS<br>       #include &lt;sys&#47;types.h&gt;          &#47;* See NOTES *&#47;<br>       #include &lt;sys&#47;socket.h&gt;<br><br>       int socket(int domain, int type, int protocol);","user_name":"作者回复","comment_id":125082,"uid":"1618647","ip_address":"","utype":1,"ctime":1566130084,"user_name_real":"froghui"}],"discussion_count":2,"race_medal":0,"score":"5861024444","product_id":100032701,"comment_content":"请问一下如何能方便地知道一个linux系统提供的函数或者变量的头文件是哪个呢？经常不知道文中的代码的函数或者变量的头文件在哪里","like_count":1,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463427,"discussion_content":"你可以在linux系统里执行man命令，例如man socket:\n\nSOCKET(2)                                                              Linux Programmer&amp;#39;s Manual                                                             SOCKET(2)\n\nNAME\n       socket - create an endpoint for communication\n\nSYNOPSIS\n       #include &amp;lt;sys/types.h&amp;gt;          /* See NOTES */\n       #include &amp;lt;sys/socket.h&amp;gt;\n\n       int socket(int domain, int type, int protocol);","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566130084,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1149592,"avatar":"https://static001.geekbang.org/account/avatar/00/11/8a/98/2be9d17b.jpg","nickname":"破晓^_^","note":"","ucode":"3224920095AC9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5234,"discussion_content":"man命令   man  +  函数名","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566102443,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354806,"user_name":"lixin","can_delete":false,"product_type":"c1","uid":1512599,"ip_address":"广东","ucode":"94D99DAFB6C929","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/88nXicqmkJWm3IXVfPfGQSk8SKIBVKjuC4qhzaCkf5Ud88uvKgS4Vf5AzCJ1uaFO0gpPnxdh4CowfhpxV1kSbXw/132","comment_is_top":false,"comment_ctime":1660797738,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1660797738","product_id":100032701,"comment_content":"可不可以多个客户端连接一个服务端。那一个客户端退出会引起服务端的退出么","like_count":0},{"had_liked":false,"id":335714,"user_name":"李二木","can_delete":false,"product_type":"c1","uid":1103091,"ip_address":"","ucode":"30E03BB84ADB27","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/f3/129d6dfe.jpg","comment_is_top":false,"comment_ctime":1645662468,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1645662468","product_id":100032701,"comment_content":"本地套接字一般也叫做 UNIX 域套接字，本地套接字是一种特殊类型的套接字，和 TCP&#47;UDP 套接字不同。TCP&#47;UDP 即使在本地地址通信，也要走系统网络协议栈，而本地套接字，严格意义上说提供了一种单主机跨进程间调用的手段，减少了协议栈实现的复杂度，效率比 TCP&#47;UDP 套接字都要高许多（可以理解为读本地文件）","like_count":0},{"had_liked":false,"id":335149,"user_name":"风清扬","can_delete":false,"product_type":"c1","uid":1047043,"ip_address":"","ucode":"651F1390B64953","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fa/03/619e3e48.jpg","comment_is_top":false,"comment_ctime":1645361129,"is_pvip":true,"replies":[{"id":"122810","content":"你是哪段程序？是不是进程自动退出了。所以不需要exit。","user_name":"作者回复","user_name_real":"编辑","uid":"1618647","ctime":1645883241,"ip_address":"","comment_id":335149,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1645361129","product_id":100032701,"comment_content":"问题二及时我注释掉exit(0)代码，添加代码忽略了SIGPIPE信号，为什么server端程序还是会自动退出？<br>有没有朋友遇到过？我尝试使用send加参数MSG_NOSIGNAL可以解决服务端自动退出的问题，但是为什么信号SIGPIPE忽略失败的问题暂时没有答案，希望知道的朋友可以评论下。<br>问题记录在https:&#47;&#47;52coder.net&#47;post&#47;net-program-sigpipe","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553426,"discussion_content":"你是哪段程序？是不是进程自动退出了。所以不需要exit。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645883241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":335132,"user_name":"风清扬","can_delete":false,"product_type":"c1","uid":1047043,"ip_address":"","ucode":"651F1390B64953","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fa/03/619e3e48.jpg","comment_is_top":false,"comment_ctime":1645349808,"is_pvip":true,"replies":[{"id":"122809","content":"进程自动退出吧。所以不需要exit。","user_name":"作者回复","user_name_real":"编辑","uid":"1618647","ctime":1645883157,"ip_address":"","comment_id":335132,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1645349808","product_id":100032701,"comment_content":"问题二及时我注释掉exit(0)代码，忽略了SIGPIPE信号，为什么server端程序还是会自动退出？有没有朋友遇到过？","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":553424,"discussion_content":"进程自动退出吧。所以不需要exit。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645883157,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":266855,"user_name":"Geek_d83bfc","can_delete":false,"product_type":"c1","uid":2325184,"ip_address":"","ucode":"BB70B0F162AA3B","user_header":"","comment_is_top":false,"comment_ctime":1607506805,"is_pvip":false,"replies":[{"id":"98878","content":"还好啊，这个值在现代Linux已经可以设置到很大了。","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1610286142,"ip_address":"","comment_id":266855,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1607506805","product_id":100032701,"comment_content":"老师，您好，查看进程和打开的句柄，我们进程显示句柄1043448，有点高，老师这个怎么排查","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511413,"discussion_content":"还好啊，这个值在现代Linux已经可以设置到很大了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610286142,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":247860,"user_name":"Steiner","can_delete":false,"product_type":"c1","uid":1622329,"ip_address":"","ucode":"232C1C75207A1E","user_header":"https://static001.geekbang.org/account/avatar/00/18/c1/39/11904266.jpg","comment_is_top":false,"comment_ctime":1599896228,"is_pvip":false,"replies":[{"id":"92048","content":"是的哦，不信你可以试试运行一下。只不过，创建的文件非常特殊，是不能打开读写的。","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1601869880,"ip_address":"","comment_id":247860,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1599896228","product_id":100032701,"comment_content":"将本地套接字的文件unlink后没有任何操作，难道在bind本地套接字到文件的过程中会自动创建文件吗","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505514,"discussion_content":"是的哦，不信你可以试试运行一下。只不过，创建的文件非常特殊，是不能打开读写的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601869880,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":244957,"user_name":"spark","can_delete":false,"product_type":"c1","uid":1264022,"ip_address":"","ucode":"D84C36D957ECCF","user_header":"https://static001.geekbang.org/account/avatar/00/13/49/96/7523cdb6.jpg","comment_is_top":false,"comment_ctime":1598762943,"is_pvip":false,"replies":[{"id":"90126","content":"back to for是无效的注释。我会删掉。","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1598796300,"ip_address":"","comment_id":244957,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1598762943","product_id":100032701,"comment_content":"stream_server:<br>clilen = sizeof(cliaddr); <br>if ((connfd = accept(listenfd, (struct sockaddr *) &amp;cliaddr, &amp;clilen)) &lt; 0) { <br>if (errno == EINTR) error(1, errno, &quot;accept failed&quot;); &#47;* back to for() *&#47; <br>else error(1, errno, &quot;accept failed&quot;); }<br>这段程序有问题吧? 不明白怎么back to for()?<br>谢谢","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":504750,"discussion_content":"back to for是无效的注释。我会删掉。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598796300,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":229762,"user_name":"Geek_d6f50f","can_delete":false,"product_type":"c1","uid":1793213,"ip_address":"","ucode":"4AA490453CF4FB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/wwM75BhyU43UYOJ6fZCZgY6pfNPGHHRlooPLQEtDGUNic4aLRHWmBRTpIiblBAFheUVm9Sw8HWAChcFsnVM2sd5Q/132","comment_is_top":false,"comment_ctime":1593139766,"is_pvip":true,"replies":[{"id":"84807","content":"这是因为共用的时候，应用程序的缓冲被多次写入，数据冲掉了。","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1593174087,"ip_address":"","comment_id":229762,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1593139766","product_id":100032701,"comment_content":"老师，为什么UDP本地套接字，在服务器端，接收数据和发送数据共用一块缓冲区，先接收，再把接收缓冲区的数据sendto到客户端，这时候发送错误，但是如果接收和发送各自的缓冲区，就不会出错，这是为什么呢？","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499630,"discussion_content":"这是因为共用的时候，应用程序的缓冲被多次写入，数据冲掉了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593174087,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":228378,"user_name":"Geek_63bb29","can_delete":false,"product_type":"c1","uid":2017041,"ip_address":"","ucode":"65C27FA7531722","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/5kv7IqibneNnMLqtWZQR5f1et8lJmoxiaU43Ttzz3zqW7QzBqMkib8GCtImKsms7PPbWmTB51xRnZQAnRPfA1wVaw/132","comment_is_top":false,"comment_ctime":1592652108,"is_pvip":false,"replies":[{"id":"84286","content":"是的。","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1592744819,"ip_address":"","comment_id":228378,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1592652108","product_id":100032701,"comment_content":"老师。看了第八部分Docker那里，好像有些明白了。TCP是监听端口，这里的话，服务器是监听本地文件，是这样吧【之前提了一条问题】","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499015,"discussion_content":"是的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592744819,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":228371,"user_name":"Geek_63bb29","can_delete":false,"product_type":"c1","uid":2017041,"ip_address":"","ucode":"65C27FA7531722","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/5kv7IqibneNnMLqtWZQR5f1et8lJmoxiaU43Ttzz3zqW7QzBqMkib8GCtImKsms7PPbWmTB51xRnZQAnRPfA1wVaw/132","comment_is_top":false,"comment_ctime":1592650336,"is_pvip":false,"replies":[{"id":"84285","content":"你把这个文件理解成双方的一种&quot;交流通道&quot;好了，类似端口和地址的作用。","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1592744805,"ip_address":"","comment_id":228371,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1592650336","product_id":100032701,"comment_content":"老师，对于本地套接字，我的理解是：通过本地套接字的客户端和服务端，对各进程管理的内存进行信息交换，但是没能理解 &#47;var&#47;lib&#47;unixstream.sock这个文件的作用，因为我用TCP、UDP交换信息的思路，觉着信息流没有经过 这个文件呀，还请指点一下，谢谢老师。","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499012,"discussion_content":"你把这个文件理解成双方的一种&amp;quot;交流通道&amp;quot;好了，类似端口和地址的作用。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592744805,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":228260,"user_name":"Ray","can_delete":false,"product_type":"c1","uid":1253774,"ip_address":"","ucode":"A7059C7D505AA0","user_header":"","comment_is_top":false,"comment_ctime":1592625227,"is_pvip":false,"replies":[{"id":"84284","content":"内核会自动帮助我们做这件事情。","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1592744725,"ip_address":"","comment_id":228260,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1592625227","product_id":100032701,"comment_content":"你可以看到 16～22 行将本地数据报套接字 bind 到本地一个路径上，然而 UDP 客户端程序是不需要这么做的。本地数据报套接字这么做的原因是，它需要指定一个本地路径，以便在服务器端回包时，可以正确地找到地址；<br>----------------------------<br>关于上文中的内容，想请教一下老师，为什么TCP的本地客户端不需要bind到一个地址？","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":498974,"discussion_content":"内核会自动帮助我们做这件事情。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592744725,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":226775,"user_name":"郑祖煌","can_delete":false,"product_type":"c1","uid":1469608,"ip_address":"","ucode":"49A0D2E3279826","user_header":"https://static001.geekbang.org/account/avatar/00/16/6c/a8/1922a0f5.jpg","comment_is_top":false,"comment_ctime":1592201593,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592201593","product_id":100032701,"comment_content":"1. 连接不上，因为客户端还没有赋予权限。 <br>2. 因为服务器做了判断 当read()==0的时候 也就是客户端退出的时候，服务器也退出了。<br>    原因就是服务器在代码逻辑层做了一个退出的判断。<br>3.客户端在连接时会报错，错误提示是“Protocol wrong type for socket (91)","like_count":0},{"had_liked":false,"id":222826,"user_name":"youngitachi","can_delete":false,"product_type":"c1","uid":1214582,"ip_address":"","ucode":"88717CA8B8ED64","user_header":"https://static001.geekbang.org/account/avatar/00/12/88/76/c69b7fe5.jpg","comment_is_top":false,"comment_ctime":1590922756,"is_pvip":true,"replies":[{"id":"82182","content":"两个函数的目的不同，sizeof获取的是数据类型的大小，比如int类型是多少字节，strlen是获取字符串真正的大小。","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1590932755,"ip_address":"","comment_id":222826,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1590922756","product_id":100032701,"comment_content":"不知道为啥write函数使用的nbytes，我这里使用sizeof获取的话多交互几次数据显示就会有问题。<br>改成strlen函数有就好了","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496930,"discussion_content":"两个函数的目的不同，sizeof获取的是数据类型的大小，比如int类型是多少字节，strlen是获取字符串真正的大小。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590932755,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":219727,"user_name":"妥协","can_delete":false,"product_type":"c1","uid":1249656,"ip_address":"","ucode":"7201DFE9C12669","user_header":"https://static001.geekbang.org/account/avatar/00/13/11/78/4f0cd172.jpg","comment_is_top":false,"comment_ctime":1590070782,"is_pvip":false,"replies":[{"id":"82159","content":"是的。","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1590926367,"ip_address":"","comment_id":219727,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1590070782","product_id":100032701,"comment_content":"本机通过 127.0.0.1地址通信时，走网络协议栈的全部流程吗？","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495924,"discussion_content":"是的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590926367,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1307067,"avatar":"","nickname":"super-ck","note":"","ucode":"02F036E53E1130","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":276177,"discussion_content":"如果是AF_LOCAL，不走，如果是AF_INET和AF_INET6则走","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1590834316,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":214897,"user_name":"饭","can_delete":false,"product_type":"c1","uid":1610573,"ip_address":"","ucode":"B3F1702D4DE604","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJKj3GbvevFibxwJibTqm16NaE8MXibwDUlnt5tt73KF9WS2uypha2m1Myxic6Q47Zaj2DZOwia3AgicO7Q/132","comment_is_top":false,"comment_ctime":1588844354,"is_pvip":false,"replies":[{"id":"79836","content":"不是吧，我没研究过windows的本地套接字，有同学知道么？","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1589099809,"ip_address":"","comment_id":214897,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1588844354","product_id":100032701,"comment_content":"window下，没有本地套接字枚举，是不是会自动根据IP判断本地地址的话，就走本地套接字","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494236,"discussion_content":"不是吧，我没研究过windows的本地套接字，有同学知道么？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589099809,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":202479,"user_name":"ray","can_delete":false,"product_type":"c1","uid":1717235,"ip_address":"","ucode":"10962C711CBC11","user_header":"","comment_is_top":false,"comment_ctime":1585994407,"is_pvip":false,"replies":[{"id":"75765","content":"我是这么认为的，本地传输分为stream和data两种类型，是为了和tcp&#47;udp的编程范式保持一致，确实本地传输的data类型的应用场景比较少，如果有同学读到这条，也可以探讨一下。","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1586075336,"ip_address":"","comment_id":202479,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1585994407","product_id":100032701,"comment_content":"老师您好，<br>请问什么时机应该使用sock_stream，sock_data呢？<br>会有这个问题是因为，本地传输没有可靠性问题需要解决，两者速度都很快。既然如此，本地传输又会什么要分sock_stream，sock_data呢？<br><br>谢谢老师的解答^^","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490596,"discussion_content":"我是这么认为的，本地传输分为stream和data两种类型，是为了和tcp/udp的编程范式保持一致，确实本地传输的data类型的应用场景比较少，如果有同学读到这条，也可以探讨一下。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586075336,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1304195,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKtlEYuHnR8VdRkNPcmkIqTM9DKahpcpicDdBvcmBWMIAAhBrd0QNWvl09slqrzB5TibryVcIfPmb7Q/132","nickname":"raisecomer","note":"","ucode":"32EA488E46471F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369169,"discussion_content":"分为stream和data两种类型，有一个好处是，如果server和client将来分别部署在不同的机器上，只要把协议族类型和绑定本地文件的地方换成AF_INET和IP+PORT就行了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1618966720,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1662117,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM7zuDYFIutbSPc4eEtcMhdNBTI1FRR7q0xrGh2X1QdiaNxvAV31HcRUsjPWLaaWftqgwTnVoiaica8Nw/132","nickname":"胜辉（大V）","note":"","ucode":"3C13BFCD82D4EC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1304195,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKtlEYuHnR8VdRkNPcmkIqTM9DKahpcpicDdBvcmBWMIAAhBrd0QNWvl09slqrzB5TibryVcIfPmb7Q/132","nickname":"raisecomer","note":"","ucode":"32EA488E46471F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":407372,"discussion_content":"这个说法有道理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634993474,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":369169,"ip_address":""},"score":407372,"extra":""}]}]},{"had_liked":false,"id":200826,"user_name":"GalaxyCreater","can_delete":false,"product_type":"c1","uid":1508329,"ip_address":"","ucode":"C79E8A088D57CF","user_header":"https://static001.geekbang.org/account/avatar/00/17/03/e9/6358059c.jpg","comment_is_top":false,"comment_ctime":1585657148,"is_pvip":false,"replies":[{"id":"75773","content":"很大的不同是本地套接字提供的是一种本机的进程间通信放啊是，而直接读写本地文件显然不是；管道也是可以用来本地进程间通信，和本地套接字相比，管道的语义类似消息通道。","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1586076094,"ip_address":"","comment_id":200826,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1585657148","product_id":100032701,"comment_content":"使用本地套接字和直接读写本地文件有什么不同；记得管道也会创建文件的，他们有什么不一样的","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490143,"discussion_content":"很大的不同是本地套接字提供的是一种本机的进程间通信放啊是，而直接读写本地文件显然不是；管道也是可以用来本地进程间通信，和本地套接字相比，管道的语义类似消息通道。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586076094,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1304195,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKtlEYuHnR8VdRkNPcmkIqTM9DKahpcpicDdBvcmBWMIAAhBrd0QNWvl09slqrzB5TibryVcIfPmb7Q/132","nickname":"raisecomer","note":"","ucode":"32EA488E46471F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369167,"discussion_content":"我是这样理解的，进程之间直接读写本地文件来通信，相当于把本地文件作为共享资源，进程之间通过访问共享资源来通信，需要程序加锁来保护保证安全，而使用本地socket，进程之间相当于使用消息传递的方式来进行通信，安全是由内核来保证的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618966309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":192493,"user_name":"Geek_wannaBgeek","can_delete":false,"product_type":"c1","uid":1643435,"ip_address":"","ucode":"6F42F4181981C3","user_header":"https://static001.geekbang.org/account/avatar/00/19/13/ab/d73e25de.jpg","comment_is_top":false,"comment_ctime":1584855102,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584855102","product_id":100032701,"comment_content":"打卡打卡","like_count":0},{"had_liked":false,"id":186143,"user_name":"InfoQ_0ef441e6756e","can_delete":false,"product_type":"c1","uid":1438521,"ip_address":"","ucode":"F1E750A5472FE2","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLTPmSgD6QSgicqsbzibiau9xWSYgdsvYlnVWBg91ibHQBYg39MT4O3AV5CHlJlVUvw9Ks9TZEmRvicfTw/132","comment_is_top":false,"comment_ctime":1583765808,"is_pvip":false,"replies":[{"id":"72374","content":"本地套接字的数据报通信，客户端bind的目的是为了让服务器端回包时，可以正确地找到客户端地址，这是两端通信的需要，因为本地套接字没有连接的概念，需要指定路径标识。","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1584173746,"ip_address":"","comment_id":186143,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1583765808","product_id":100032701,"comment_content":"老师。udp客户端bind 还是没理解，server坚挺的哪个文件，回复的时候发给那个文件不就行了么？","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486643,"discussion_content":"本地套接字的数据报通信，客户端bind的目的是为了让服务器端回包时，可以正确地找到客户端地址，这是两端通信的需要，因为本地套接字没有连接的概念，需要指定路径标识。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584173746,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1397631,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKVUskibDnhMt5MCIJ8227HWkeg2wEEyewps8GuWhWaY5fy7Ya56bu2ktMlxdla3K29Wqia9efCkWaQ/132","nickname":"衬衫的价格是19美元","note":"","ucode":"655F925451F772","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":286424,"discussion_content":"为什么AF_LOCAL+DGRAM的时候,客户端需要bind一个本地文件？\n因为服务器收到来自客户端的数据想要给客户端回复的时候，需要知道发给谁。在其他情况下，服务器都有办法：\n1.当使用STREAM时，不管是AF_INET还是AF_LOCAL, 都有连接的概念，所以服务器可以使用原来的连接\n2.当使用AF_INET时，不管是DGRAM还是STREAM, 都能知道对方的ip+port, 也能确定一个唯一的进程，这时候客户端代码不需要显示的bind，协议栈已经帮我们做了。\n只有AF_LOCAL+DGRAM的时候，没有连接，也没有ip+port, 只能显式的指定一个标志告诉服务端","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593170737,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":179829,"user_name":"treasure","can_delete":false,"product_type":"c1","uid":1798993,"ip_address":"","ucode":"3D6948A2201B2F","user_header":"https://static001.geekbang.org/account/avatar/00/1b/73/51/aaedc2a6.jpg","comment_is_top":false,"comment_ctime":1582105912,"is_pvip":false,"replies":[{"id":"71043","content":"完全可以。unixstreamclient就没有bind。","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1583053544,"ip_address":"","comment_id":179829,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1582105912","product_id":100032701,"comment_content":"我看代码为什么客户端和服务端都bind这个函数，客户端不加bind可以吗？","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484417,"discussion_content":"完全可以。unixstreamclient就没有bind。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583053544,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":154090,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1574380705,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574380705","product_id":100032701,"comment_content":"本地套接字是一种特殊类型的套接字，和 TCP&#47;UDP 套接字不同。TCP&#47;UDP 即使在本地地址通信，也要走系统网络协议栈，而本地套接字，严格意义上说提供了一种单主机跨进程间调用的手段，减少了协议栈实现的复杂度，效率比 TCP&#47;UDP 套接字都要高许多。类似的 IPC 机制还有 UNIX 管道、共享内存和 RPC 调用等。<br>这里的描述，“减少了协议栈实现的复杂度”，没理解本地套接字，具体还走不走网络的协议栈？如果走应该仍然属于网络通信的范畴，如果不走，他具体怎么实现的，和共享内存有什么本质区别？<br>这里确实刷新了认知，之前认为进程间通信，必须要走网络协议的，哪怕是单机上的两个进程也是这样。其实只要他们能交流信息，走不走网络没什么必然联系，共享内存这个就容易理解和实现，不过还是需要约定双方交流的方式，否则信息能获取但不理解也不成。","like_count":0},{"had_liked":false,"id":139068,"user_name":"Geek_d4f974","can_delete":false,"product_type":"c1","uid":1591783,"ip_address":"","ucode":"F91D0CD09CB13E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/NTSD503ibERiba4wcsoiaezDrjLMOVVlAlliagHc6ic3icWFfuzaFWaHwuULQDo22mPiabicImFTB7ial82OuBD96bl4RTQ/132","comment_is_top":false,"comment_ctime":1570539741,"is_pvip":false,"replies":[{"id":"54316","content":"不会啊，会不会是权限的问题？你是root账号么？","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1570972322,"ip_address":"","comment_id":139068,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1570539741","product_id":100032701,"comment_content":"运行server后，在netstat -lx中可以查看到，但是在&#47;tmp文件夹中没有生成unixstream.sock文件","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469775,"discussion_content":"不会啊，会不会是权限的问题？你是root账号么？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570972322,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136008,"user_name":"曹绍坚","can_delete":false,"product_type":"c1","uid":1238980,"ip_address":"","ucode":"782C1AE8F03EB3","user_header":"https://static001.geekbang.org/account/avatar/00/12/e7/c4/28b58d33.jpg","comment_is_top":false,"comment_ctime":1569327558,"is_pvip":false,"replies":[{"id":"52215","content":"没有这么说，目录-文件这个和并发有关系么？","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1569408570,"ip_address":"","comment_id":136008,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1569327558","product_id":100032701,"comment_content":"&quot;另外还要明确一点，这个本地文件，必须是一个“文件”，不能是一个&quot;目录&quot;；&quot;<br>这么说本地套接字是不是不适合实现多并发的服务器？","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468418,"discussion_content":"没有这么说，目录-文件这个和并发有关系么？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569408570,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":133102,"user_name":"岸超","can_delete":false,"product_type":"c1","uid":1590607,"ip_address":"","ucode":"F645DCF36D5C9F","user_header":"https://static001.geekbang.org/account/avatar/00/18/45/4f/3b24dccc.jpg","comment_is_top":false,"comment_ctime":1568360106,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568360106","product_id":100032701,"comment_content":"1:普通用户应该是没有 &#47;var&#47;lib&#47;unixstream.sock 这个文件的读写权限的，root创建一般会是700的形式。可以手动chmod添加权限，使得普通用户也可以访问该本地套接字。<br>2:这个问题在 流式套接字和数据报两种情况应该是不同的吧。流式套接字中应该是复用了socket close的语义，进程退出会关闭fd，而对端的read在tcp连接时，收到fin分节会返回0，这里在本地套接字上应该是模拟了对端close时的这种效果。但是数据报套接字是不存在这种情况下返回0的实现的，故而这段代码其实不会生效，实际效果展示中也没有退出<br>3:问题三肯定会报错，虽不会三次握手，但内核肯定无法把这两种套接字在底层连接起来，但具体错误未知。","like_count":0},{"had_liked":false,"id":131498,"user_name":"Geek_Wison","can_delete":false,"product_type":"c1","uid":1504371,"ip_address":"","ucode":"2CD880F07FDD57","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er4HlmmWfWicNmo3x3HKaOwz3ibcicDFlV5xILbILKGFCXbnaLf2fZRARfBdVBC5NhIPmXxaxA0T9Jhg/132","comment_is_top":false,"comment_ctime":1567769035,"is_pvip":false,"replies":[{"id":"50791","content":"C语言可以接收这样不带花括号的简单写法。","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1568190275,"ip_address":"","comment_id":131498,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1567769035","product_id":100032701,"comment_content":"老师您好，这篇文章的第一段代码的第33～36行的if else是不是写得不太对？","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466486,"discussion_content":"C语言可以接收这样不带花括号的简单写法。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568190275,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1504371,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er4HlmmWfWicNmo3x3HKaOwz3ibcicDFlV5xILbILKGFCXbnaLf2fZRARfBdVBC5NhIPmXxaxA0T9Jhg/132","nickname":"Geek_Wison","note":"","ucode":"2CD880F07FDD57","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":22586,"discussion_content":"不是这个意思哦，我说的是注释不对。 \n/* back to for() */\n那里并没有for结构呀。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1569656681,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128301,"user_name":"knull","can_delete":false,"product_type":"c1","uid":1043484,"ip_address":"","ucode":"3BFECF3D29F40C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ec/1c/d323b066.jpg","comment_is_top":false,"comment_ctime":1566869642,"is_pvip":false,"replies":[{"id":"47923","content":"我理解是编程模型的差别","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1567005136,"ip_address":"","comment_id":128301,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1566869642","product_id":100032701,"comment_content":"老师，能不能说说两种unix套接字的使用场景？tcp和udp有明显的特征差异。但是，unix的好像差别不是特别明显。我想象中，本地的话，丢包可能基本没有吧？仅仅是为了与tcp、udp对应，还是有特别的意义？","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464885,"discussion_content":"我理解是编程模型的差别","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567005136,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043484,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ec/1c/d323b066.jpg","nickname":"knull","note":"","ucode":"3BFECF3D29F40C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6693,"discussion_content":"OK，多谢老师","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567054447,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125862,"user_name":"fee","can_delete":false,"product_type":"c1","uid":1523581,"ip_address":"","ucode":"BECB8D2518C56E","user_header":"https://static001.geekbang.org/account/avatar/00/17/3f/7d/6fb0d4e9.jpg","comment_is_top":false,"comment_ctime":1566266126,"is_pvip":false,"replies":[{"id":"48230","content":"可以的，通过指针位置来计算offset，再补上协议本身的大小。","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1567133661,"ip_address":"","comment_id":125862,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566266126","product_id":100032701,"comment_content":"计算地址长度 len = offset（struct sockaddr_un， sun_family） + strlen（.sun_family）公司代码","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463723,"discussion_content":"可以的，通过指针位置来计算offset，再补上协议本身的大小。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567133661,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125640,"user_name":"传说中的成大大","can_delete":false,"product_type":"c1","uid":1236766,"ip_address":"","ucode":"103543D6E706BF","user_header":"https://static001.geekbang.org/account/avatar/00/12/df/1e/cea897e8.jpg","comment_is_top":false,"comment_ctime":1566219467,"is_pvip":false,"replies":[{"id":"47900","content":"因为我不想把字符串后面的\\0都发送出去，只想发送有效字符。后面那个其实也可以拉。","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1567003551,"ip_address":"","comment_id":125640,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1566219467","product_id":100032701,"comment_content":"还有个问题一直不明白 为什么在发送数据的时候用的strlen(send_line)而不是sizeof( send_line ), 文中代码的sockaddr 写成了sockadd","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463640,"discussion_content":"因为我不想把字符串后面的\\0都发送出去，只想发送有效字符。后面那个其实也可以拉。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567003551,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1170784,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/60/eae432c6.jpg","nickname":"yusuf","note":"","ucode":"9F32149B2ADDA0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5568,"discussion_content":"strlen的结果是实际的字符串长度，而sizeof的结果是MAXLINE","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566356115,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125638,"user_name":"传说中的成大大","can_delete":false,"product_type":"c1","uid":1236766,"ip_address":"","ucode":"103543D6E706BF","user_header":"https://static001.geekbang.org/account/avatar/00/12/df/1e/cea897e8.jpg","comment_is_top":false,"comment_ctime":1566219057,"is_pvip":false,"replies":[{"id":"47899","content":"你是不是改成了stream类型的？报错貌似是说未连接","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1567003492,"ip_address":"","comment_id":125638,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566219057","product_id":100032701,"comment_content":" #include&quot;..&#47;my_head.h&quot; <br> #define LISTENQ 10 <br> #define BUFFSIZE 1024 <br> int <br> main( int argc, char* argv[] ) { <br>     if ( argc != 2 ) { <br>         error( 1, 0, &quot;useage unixstreamserver &lt;local path&gt;&quot; ); <br>     } <br> 15     socklen_t clilen; <br> 16     struct sockaddr_un cliaddr; <br> 17     struct sockaddr_un serveraddr; <br> 18     int sockfd = socket( AF_LOCAL, SOCK_DGRAM, 0 ); <br> 19     if ( sockfd &lt; 0 ) { <br> 20         error( 1, errno, &quot;socket create failed&quot; ); <br> 21     } <br> 22  <br> 23     char* local_path = argv[1]; <br> 24     unlink( local_path ); <br> 25     bzero( &amp;serveraddr, sizeof( serveraddr ) ); <br> 26     serveraddr.sun_family = AF_LOCAL;   strcpy( serveraddr.sun_path,local_path ); <br> 27     if ( bind( sockfd, ( struct sockaddr*  ) &amp;serveraddr, sizeof( serveraddr ) ) &lt; 0 ) { <br> 28         error( 1, errno, &quot;bind failed&quot; );<br> 29     } <br> 30 &#47;*<br> 31     if ( listen( listenfd, LISTENQ ) &lt; 0 ) {<br> 32         error( 1, errno, &quot;listen failed&quot; );<br> 33     }<br> 34 *&#47;<br> 35 <br> 36     clilen = sizeof( cliaddr );<br> 42     char buf[BUFFSIZE];<br> 43     while( 1 ) {<br> 44         bzero( buf, sizeof( buf ) );<br> 45         if ( recvfrom( sockfd, buf, BUFFSIZE, 0, ( struct sockaddr*  ) &amp;cliaddr, &amp;clilen ) == 0 ) {<br> 46             printf( &quot;client quit&quot; );<br> 47             break;<br> 48         }<br> 49         printf( &quot;Recevie: %s&quot;, buf );<br> 50         char send_line[MAXLINE];<br> 51         sprintf( send_line, &quot;Hi, %s&quot;, buf );<br> 52         int nbytes = sizeof( send_line );<br> 53         if ( sendto( sockfd, send_line, nbytes, 0,  ( struct sockaddr* ) &amp;cliaddr, clilen ) != nbytes ) {<br> 54             error( 1, errno, &quot;write error&quot; );<br> 55         }<br> 56     }<br> 57 <br> 58     exit( 0 );<br> 59 } <br>我这个代码本地数据报套接字 服务器端接收到数据过后发送时就报错如下<br>ubuntu@VM-0-17-ubuntu:~&#47;network&#47;local_socket$ .&#47;dgrams .&#47;dgram.sock <br>Recevie: 1<br>.&#47;dgrams: write error: Transport endpoint is not connected 就不知道怎么解决了                       ","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463639,"discussion_content":"你是不是改成了stream类型的？报错貌似是说未连接","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567003492,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125161,"user_name":"破晓^_^","can_delete":false,"product_type":"c1","uid":1149592,"ip_address":"","ucode":"3224920095AC9E","user_header":"https://static001.geekbang.org/account/avatar/00/11/8a/98/2be9d17b.jpg","comment_is_top":false,"comment_ctime":1566102875,"is_pvip":false,"replies":[{"id":"45907","content":"已经把代码push到github，答疑篇统一回复","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1566124155,"ip_address":"","comment_id":125161,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566102875","product_id":100032701,"comment_content":"那些拼命要老师贴代码带git上的有点懒啊，这本来就是一门注重实践的课程，编程不实践你能有收获？不妨自己敲一下收获更深呢？各位兄弟。","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463458,"discussion_content":"已经把代码push到github，答疑篇统一回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566124155,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125072,"user_name":"沉淀的梦想","can_delete":false,"product_type":"c1","uid":1177315,"ip_address":"","ucode":"BCB7C26F9D214B","user_header":"https://static001.geekbang.org/account/avatar/00/11/f6/e3/e4bcd69e.jpg","comment_is_top":false,"comment_ctime":1566054440,"is_pvip":false,"replies":[{"id":"45960","content":"我试了下，不加 -a 看不到 &quot;LISTENING&quot;状态，系统为4.4.0-159-generic","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1566130776,"ip_address":"","comment_id":125072,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566054440","product_id":100032701,"comment_content":"netstat -p -A unix<br><br>为什么netstat命令不加-a就看到我开启的那个本地套接字呢，文档上说-a的作用查看所有已经处于LISTENING状态的套接字，但是用netstat -a -p -A unix查看，这个套接字明明已经处于LISTENING状态了啊","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463422,"discussion_content":"我试了下，不加 -a 看不到 &amp;quot;LISTENING&amp;quot;状态，系统为4.4.0-159-generic","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566130776,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":124962,"user_name":"Z12","can_delete":false,"product_type":"c1","uid":1118159,"ip_address":"","ucode":"59F5E62F67FFDC","user_header":"https://static001.geekbang.org/account/avatar/00/11/0f/cf/bfa0dc80.jpg","comment_is_top":false,"comment_ctime":1566028940,"is_pvip":false,"replies":[{"id":"45913","content":"答疑篇统一回复","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1566128531,"ip_address":"","comment_id":124962,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566028940","product_id":100032701,"comment_content":"老师，你好，这门课程比较重视实战，文章的代码也比较多，如果能把代码放上github，方便我们查看和调试，那就太好了","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463381,"discussion_content":"答疑篇统一回复","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566128531,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":124940,"user_name":"刘明","can_delete":false,"product_type":"c1","uid":1109382,"ip_address":"","ucode":"5871C54AAE1A81","user_header":"https://static001.geekbang.org/account/avatar/00/10/ed/86/5855aaa4.jpg","comment_is_top":false,"comment_ctime":1566024002,"is_pvip":false,"replies":[{"id":"45914","content":"TCP字节流有序可靠；UDP没有有序可靠","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1566128558,"ip_address":"","comment_id":124940,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566024002","product_id":100032701,"comment_content":"有个疑问：TCP可靠，UDP不可靠，本地套接字的字节流形式和数据报形式的可靠性分别是怎么样的呢？","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463368,"discussion_content":"TCP字节流有序可靠；UDP没有有序可靠","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566128558,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":124813,"user_name":"ly","can_delete":false,"product_type":"c1","uid":1221628,"ip_address":"","ucode":"5E2B85252DABF3","user_header":"https://static001.geekbang.org/account/avatar/00/12/a3/fc/379387a4.jpg","comment_is_top":false,"comment_ctime":1565999303,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565999303","product_id":100032701,"comment_content":"问题一：<br>个人感觉客户端没有权限也可以连接，这个sock文件是服务端创建的，客户端仅仅是向这个套接字发送、接受数据而已；类推到tcp的套接字，服务端只要监听一个端口，防火墙放开端口，默认情况下是对客户端无限制的（所以客户端都可以连接）。<br>问题二：<br>这个服务端随着客户端的退出而退出，应该是服务端的代码所致，代码中read方法正常情况下是会阻塞，客户端发完消息这个就会解除阻塞，但是客户端退出，这个read方法读不到数据，进入break语句，main方法结束。<br>问题三：<br>服务端以数据包接受，客户端用字节流发送（有点好玩）；由于本地套接字的字节流没有三次握手，我想客户端还是可以把数据发给服务端的，至于服务端的接收情况......实在编不下去了，请老师指教！","like_count":0},{"had_liked":false,"id":124753,"user_name":"多襄丸","can_delete":false,"product_type":"c1","uid":1074310,"ip_address":"","ucode":"1AA1497C5A293C","user_header":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","comment_is_top":false,"comment_ctime":1565962250,"is_pvip":false,"replies":[{"id":"45917","content":"我会在答疑篇统一详细回复。<br><br>先在这里抛砖引玉：<br>第一，还是急需要看下C语言的基础原理，如数组、指针、结构体等；<br><br>第二，UNIX网络编程和TCP&#47;IP协议详解可以看看<br><br>第三，跟我一起敲代码:)","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1566128730,"ip_address":"","comment_id":124753,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1565962250","product_id":100032701,"comment_content":"老师 我再啰嗦一条留言:<br><br>我只考过c++二级 操作系统 计组 网络都没看过<br><br>我很想顺着老师这个专栏 跟上节奏 看书写代码 我不想买了这个专栏后落下趟 <br><br>老师可以告知一下 这个是需要c的环境还是c++的环境吗？ <br>另外，老师可以告知一下，需要看的书吗？  能具体到书名作者最好。 现实一点，也不要太多，一到两本就行。<br>我基础实在体太差了，很想通过这种方式来补救。求老师回答。<br>ps: 很可能得到您的回复后，会截屏然后删掉这条留言，因为觉得自己太差劲了。","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463307,"discussion_content":"我会在答疑篇统一详细回复。\n\n先在这里抛砖引玉：\n第一，还是急需要看下C语言的基础原理，如数组、指针、结构体等；\n\n第二，UNIX网络编程和TCP/IP协议详解可以看看\n\n第三，跟我一起敲代码:)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566128730,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1170784,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/60/eae432c6.jpg","nickname":"yusuf","note":"","ucode":"9F32149B2ADDA0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5125,"discussion_content":"linux下用gcc编译就够了。但文中的代码并不能直接编译通过，可能需要添加一些头文件，还可能需要修复一些拼写错误。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565966103,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1074310,"avatar":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","nickname":"多襄丸","note":"","ucode":"1AA1497C5A293C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1170784,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/60/eae432c6.jpg","nickname":"yusuf","note":"","ucode":"9F32149B2ADDA0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5127,"discussion_content":"嗯嗯 谢谢你 我装一下gcc","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565966542,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":5125,"ip_address":""},"score":5127,"extra":""}]}]},{"had_liked":false,"id":124748,"user_name":"多襄丸","can_delete":false,"product_type":"c1","uid":1074310,"ip_address":"","ucode":"1AA1497C5A293C","user_header":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","comment_is_top":false,"comment_ctime":1565960374,"is_pvip":false,"replies":[{"id":"45918","content":"是的，文件描述符","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1566128743,"ip_address":"","comment_id":124748,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1565960374","product_id":100032701,"comment_content":"if ((connfd = accept(listenfd, (struct sockaddr *) &amp;cliaddr, &amp;clilen)) &lt; 0) <br><br>sockfd = socket(AF_LOCAL, SOCK_STREAM, 0);<br><br>老师 这里的listenfd sockfd 都是int类型的 这个代表啥啊 是java里面的fileDescriptor吗？","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463305,"discussion_content":"是的，文件描述符","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566128743,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1170784,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/60/eae432c6.jpg","nickname":"yusuf","note":"","ucode":"9F32149B2ADDA0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5129,"discussion_content":"在socket函数的注释里有详细说明：\n/* Create a new socket of type TYPE in domain DOMAIN, using\n   protocol PROTOCOL.  If PROTOCOL is zero, one is chosen automatically.\n   Returns a file descriptor for the new socket, or -1 for errors.  */\nextern int socket (int __domain, int __type, int __protocol) __THROW;","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1565970769,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":124746,"user_name":"多襄丸","can_delete":false,"product_type":"c1","uid":1074310,"ip_address":"","ucode":"1AA1497C5A293C","user_header":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","comment_is_top":false,"comment_ctime":1565959658,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565959658","product_id":100032701,"comment_content":"(ps: 老师讲的是真的好 对比分析都有)","like_count":0},{"had_liked":false,"id":124745,"user_name":"多襄丸","can_delete":false,"product_type":"c1","uid":1074310,"ip_address":"","ucode":"1AA1497C5A293C","user_header":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","comment_is_top":false,"comment_ctime":1565959605,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565959605","product_id":100032701,"comment_content":"1. 文件是服务端服务器上的 服务端本地监听的 服务端需要权限 客户端应该不需要吧 所以应该可以连接成功吧<br><br>2. 看代码是read返回值是0的时候退出的<br><br>3. 一个是socket_stream 一个是datagram 两个格式不一样 应该会报错吧","like_count":0},{"had_liked":false,"id":124701,"user_name":"Sweety","can_delete":false,"product_type":"c1","uid":1228667,"ip_address":"","ucode":"DC90C959AE147F","user_header":"https://static001.geekbang.org/account/avatar/00/12/bf/7b/e9592637.jpg","comment_is_top":false,"comment_ctime":1565947577,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565947577","product_id":100032701,"comment_content":"1.无法连接,没有权限.<br>3.无法连接,协议不一样","like_count":0},{"had_liked":false,"id":124613,"user_name":"ly","can_delete":false,"product_type":"c1","uid":1221628,"ip_address":"","ucode":"5E2B85252DABF3","user_header":"https://static001.geekbang.org/account/avatar/00/12/a3/fc/379387a4.jpg","comment_is_top":false,"comment_ctime":1565927590,"is_pvip":false,"replies":[{"id":"45921","content":"起到定位的作用，一定需要的","user_name":"作者回复","user_name_real":"froghui","uid":"1618647","ctime":1566128853,"ip_address":"","comment_id":124613,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1565927590","product_id":100032701,"comment_content":"还有一个疑问，这个本地套接字挂靠的.sock文件，好像在客户端和服务端在发送数据的时候，这个文件并没有任何变化（不管是文件大小、文件修改日期），那这个.sock空文件究竟在通信期间起到什么作用，是不是linux必须要求有这样的一个空文件的存在？","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463251,"discussion_content":"起到定位的作用，一定需要的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566128853,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1397631,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKVUskibDnhMt5MCIJ8227HWkeg2wEEyewps8GuWhWaY5fy7Ya56bu2ktMlxdla3K29Wqia9efCkWaQ/132","nickname":"衬衫的价格是19美元","note":"","ucode":"655F925451F772","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":23857,"discussion_content":"这个.sock 是不是类似tcp/udp 通信时用到的ip+port,来确定这个连接的唯一性？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569926444,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1149592,"avatar":"https://static001.geekbang.org/account/avatar/00/11/8a/98/2be9d17b.jpg","nickname":"破晓^_^","note":"","ucode":"3224920095AC9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5380,"discussion_content":"可以去看看Unix环境编程中的Unix域套接字","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566214396,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":124556,"user_name":"tt","can_delete":false,"product_type":"c1","uid":1489957,"ip_address":"","ucode":"7753B79AD5A9AC","user_header":"https://static001.geekbang.org/account/avatar/00/16/bc/25/1c92a90c.jpg","comment_is_top":false,"comment_ctime":1565920228,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565920228","product_id":100032701,"comment_content":"1、POSIX要求调用connect链接一个Unix域套接字涉及的权限测试等同于调用open以只写方式访问相应的路径名。所以如果客户端对路径名没有权限，链接会失败。<br><br>2、connect的出错条件包括：<br>       该路径名已经存在却不是一个套接字。<br>       该路径名已经存在且是一个套接字，不过没有与之关联的打开的描述符。<br>       该路径名已经存在且是一个套接字，不过类型不符。<br>   所以数据报本地套接字连接不到字节流套接字，反之亦然。","like_count":0},{"had_liked":false,"id":124540,"user_name":"ly","can_delete":false,"product_type":"c1","uid":1221628,"ip_address":"","ucode":"5E2B85252DABF3","user_header":"https://static001.geekbang.org/account/avatar/00/12/a3/fc/379387a4.jpg","comment_is_top":false,"comment_ctime":1565918209,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565918209","product_id":100032701,"comment_content":"有2个疑问，请老师指教。（老师提交的问题，我下来思考一下再回答）<br>1. 字节流本地套接字没有建立连接，也就是一种非连接、字节流的通信，是否有类似TCP的排错、重传等特性呢？<br>2. 关于本地套接字大致使用的场景，文章中用Kubernetes举例说明，我想是不是有的软件启动的时候会开启多个进程，<br>每个进程可能是属于此软件的不同模块（为了解耦），但是这些模块之间也存在彼此交换信息的情况，<br>可能就需要本章的本地套接字来做（也可以用所谓IPC的其他方式，如共享内存）。<br>请问我的理解是否正确，另外请老师再举几个现实中那些软件使用本地套接字的场景来帮助消化一下。","like_count":0},{"had_liked":false,"id":124518,"user_name":"刘丹","can_delete":false,"product_type":"c1","uid":1081922,"ip_address":"","ucode":"66594D1C957E15","user_header":"https://static001.geekbang.org/account/avatar/00/10/82/42/8b04d489.jpg","comment_is_top":false,"comment_ctime":1565916025,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565916025","product_id":100032701,"comment_content":"本地套接字可以使用抽象路径，能否介绍比较一下?","like_count":0},{"had_liked":false,"id":124497,"user_name":"(￣_￣ )","can_delete":false,"product_type":"c1","uid":1133366,"ip_address":"","ucode":"8B6E2EF240D4AD","user_header":"https://static001.geekbang.org/account/avatar/00/11/4b/36/ed40fb3a.jpg","comment_is_top":false,"comment_ctime":1565913012,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565913012","product_id":100032701,"comment_content":"第一个问题，应该是不可以正常通信的。看了下那个文件其他用户权限没有写权限，依赖文件通信应该是会对文件读写","like_count":0}]}