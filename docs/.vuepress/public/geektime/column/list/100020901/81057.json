{"id":81057,"title":"34 | 关于 Linux 网络，你必须知道这些（下）","content":"<p>你好，我是倪朋飞。</p><p>上一节，我带你学习了 Linux 网络的基础原理。简单回顾一下，Linux 网络根据 TCP/IP 模型，构建其网络协议栈。TCP/IP 模型由应用层、传输层、网络层、网络接口层等四层组成，这也是 Linux 网络栈最核心的构成部分。</p><p>应用程序通过套接字接口发送数据包时，先要在网络协议栈中从上到下逐层处理，然后才最终送到网卡发送出去；而接收数据包时，也要先经过网络栈从下到上的逐层处理，最后送到应用程序。</p><p>了解Linux 网络的基本原理和收发流程后，你肯定迫不及待想知道，如何去观察网络的性能情况。具体而言，哪些指标可以用来衡量 Linux 的网络性能呢？</p><h2>性能指标</h2><p>实际上，我们通常用带宽、吞吐量、延时、PPS（Packet Per Second）等指标衡量网络的性能。</p><ul>\n<li>\n<p><strong>带宽</strong>，表示链路的最大传输速率，单位通常为 b/s （比特/秒）。</p>\n</li>\n<li>\n<p><strong>吞吐量</strong>，表示单位时间内成功传输的数据量，单位通常为 b/s（比特/秒）或者 B/s（字节/秒）。吞吐量受带宽限制，而吞吐量/带宽，也就是该网络的使用率。</p>\n</li>\n<li>\n<p><strong>延时</strong>，表示从网络请求发出后，一直到收到远端响应，所需要的时间延迟。在不同场景中，这一指标可能会有不同含义。比如，它可以表示，建立连接需要的时间（比如 TCP 握手延时），或一个数据包往返所需的时间（比如 RTT）。</p>\n</li>\n<li>\n<p><strong>PPS</strong>，是 Packet Per Second（包/秒）的缩写，表示以网络包为单位的传输速率。PPS 通常用来评估网络的转发能力，比如硬件交换机，通常可以达到线性转发（即 PPS 可以达到或者接近理论最大值）。而基于 Linux 服务器的转发，则容易受网络包大小的影响。</p>\n</li>\n</ul><!-- [[[read_end]]] --><p>除了这些指标，<strong>网络的可用性</strong>（网络能否正常通信）、<strong>并发连接数</strong>（TCP连接数量）、<strong>丢包率</strong>（丢包百分比）、<strong>重传率</strong>（重新传输的网络包比例）等也是常用的性能指标。</p><p>接下来，请你打开一个终端，SSH登录到服务器上，然后跟我一起来探索、观测这些性能指标。</p><h2><strong>网络配置</strong></h2><p>分析网络问题的第一步，通常是查看网络接口的配置和状态。你可以使用 ifconfig 或者 ip 命令，来查看网络的配置。我个人更推荐使用 ip 工具，因为它提供了更丰富的功能和更易用的接口。</p><blockquote>\n<p>ifconfig 和 ip 分别属于软件包 net-tools 和 iproute2，iproute2 是 net-tools 的下一代。通常情况下它们会在发行版中默认安装。但如果你找不到 ifconfig 或者 ip 命令，可以安装这两个软件包。</p>\n</blockquote><p>以网络接口 eth0 为例，你可以运行下面的两个命令，查看它的配置和状态：</p><pre><code>$ ifconfig eth0\neth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; mtu 1500\n      inet 10.240.0.30 netmask 255.240.0.0 broadcast 10.255.255.255\n      inet6 fe80::20d:3aff:fe07:cf2a prefixlen 64 scopeid 0x20&lt;link&gt;\n      ether 78:0d:3a:07:cf:3a txqueuelen 1000 (Ethernet)\n      RX packets 40809142 bytes 9542369803 (9.5 GB)\n      RX errors 0 dropped 0 overruns 0 frame 0\n      TX packets 32637401 bytes 4815573306 (4.8 GB)\n      TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0\n​\n$ ip -s addr show dev eth0\n2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000\n  link/ether 78:0d:3a:07:cf:3a brd ff:ff:ff:ff:ff:ff\n  inet 10.240.0.30/12 brd 10.255.255.255 scope global eth0\n      valid_lft forever preferred_lft forever\n  inet6 fe80::20d:3aff:fe07:cf2a/64 scope link\n      valid_lft forever preferred_lft forever\n  RX: bytes packets errors dropped overrun mcast\n   9542432350 40809397 0       0       0       193\n  TX: bytes packets errors dropped carrier collsns\n   4815625265 32637658 0       0       0       0\n</code></pre><p>你可以看到，ifconfig 和 ip 命令输出的指标基本相同，只是显示格式略微不同。比如，它们都包括了网络接口的状态标志、MTU 大小、IP、子网、MAC 地址以及网络包收发的统计信息。</p><p>这些具体指标的含义，在文档中都有详细的说明，不过，这里有几个跟网络性能密切相关的指标，需要你特别关注一下。</p><p>第一，网络接口的状态标志。ifconfig 输出中的 RUNNING ，或 ip 输出中的 LOWER_UP ，都表示物理网络是连通的，即网卡已经连接到了交换机或者路由器中。如果你看不到它们，通常表示网线被拔掉了。</p><p>第二，MTU 的大小。MTU 默认大小是 1500，根据网络架构的不同（比如是否使用了 VXLAN 等叠加网络），你可能需要调大或者调小 MTU 的数值。</p><p>第三，网络接口的 IP 地址、子网以及 MAC 地址。这些都是保障网络功能正常工作所必需的，你需要确保配置正确。</p><p>第四，网络收发的字节数、包数、错误数以及丢包情况，特别是 TX 和 RX 部分的 errors、dropped、overruns、carrier 以及 collisions 等指标不为 0 时，通常表示出现了网络 I/O 问题。其中：</p><ul>\n<li>\n<p>errors 表示发生错误的数据包数，比如校验错误、帧同步错误等；</p>\n</li>\n<li>\n<p>dropped 表示丢弃的数据包数，即数据包已经收到了 Ring Buffer，但因为内存不足等原因丢包；</p>\n</li>\n<li>\n<p>overruns 表示超限数据包数，即网络 I/O 速度过快，导致 Ring Buffer 中的数据包来不及处理（队列满）而导致的丢包；</p>\n</li>\n<li>\n<p>carrier 表示发生 carrirer 错误的数据包数，比如双工模式不匹配、物理电缆出现问题等；</p>\n</li>\n<li>\n<p>collisions 表示碰撞数据包数。</p>\n</li>\n</ul><h2><strong>套接字信息</strong></h2><p>ifconfig 和 ip 只显示了网络接口收发数据包的统计信息，但在实际的性能问题中，网络协议栈中的统计信息，我们也必须关注。你可以用 netstat 或者 ss ，来查看套接字、网络栈、网络接口以及路由表的信息。</p><p>我个人更推荐，使用 ss 来查询网络的连接信息，因为它比 netstat 提供了更好的性能（速度更快）。</p><p>比如，你可以执行下面的命令，查询套接字信息：</p><pre><code># head -n 3 表示只显示前面3行\n# -l 表示只显示监听套接字\n# -n 表示显示数字地址和端口(而不是名字)\n# -p 表示显示进程信息\n$ netstat -nlp | head -n 3\nActive Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name\ntcp        0      0 127.0.0.53:53           0.0.0.0:*               LISTEN      840/systemd-resolve\n\n# -l 表示只显示监听套接字\n# -t 表示只显示 TCP 套接字\n# -n 表示显示数字地址和端口(而不是名字)\n# -p 表示显示进程信息\n$ ss -ltnp | head -n 3\nState    Recv-Q    Send-Q        Local Address:Port        Peer Address:Port\nLISTEN   0         128           127.0.0.53%lo:53               0.0.0.0:*        users:((&quot;systemd-resolve&quot;,pid=840,fd=13))\nLISTEN   0         128                 0.0.0.0:22               0.0.0.0:*        users:((&quot;sshd&quot;,pid=1459,fd=3))\n</code></pre><p>netstat 和 ss 的输出也是类似的，都展示了套接字的状态、接收队列、发送队列、本地地址、远端地址、进程 PID 和进程名称等。</p><p>其中，接收队列（Recv-Q）和发送队列（Send-Q）需要你特别关注，它们通常应该是 0。当你发现它们不是 0 时，说明有网络包的堆积发生。当然还要注意，在不同套接字状态下，它们的含义不同。</p><p>当套接字处于连接状态（Established）时，</p><ul>\n<li>\n<p>Recv-Q 表示套接字缓冲还没有被应用程序取走的字节数（即接收队列长度）。</p>\n</li>\n<li>\n<p>而 Send-Q 表示还没有被远端主机确认的字节数（即发送队列长度）。</p>\n</li>\n</ul><p>当套接字处于监听状态（Listening）时，</p><ul>\n<li>\n<p>Recv-Q 表示全连接队列的长度。</p>\n</li>\n<li>\n<p>而 Send-Q 表示全连接队列的最大长度。</p>\n</li>\n</ul><p>所谓全连接，是指服务器收到了客户端的 ACK，完成了 TCP 三次握手，然后就会把这个连接挪到全连接队列中。这些全连接中的套接字，还需要被 accept() 系统调用取走，服务器才可以开始真正处理客户端的请求。</p><p>与全连接队列相对应的，还有一个半连接队列。所谓半连接是指还没有完成 TCP 三次握手的连接，连接只进行了一半。服务器收到了客户端的 SYN 包后，就会把这个连接放到半连接队列中，然后再向客户端发送 SYN+ACK 包。</p><h2><strong>协议栈统计信息</strong></h2><p>类似的，使用 netstat 或 ss ，也可以查看协议栈的信息：</p><pre><code>$ netstat -s\n...\nTcp:\n    3244906 active connection openings\n    23143 passive connection openings\n    115732 failed connection attempts\n    2964 connection resets received\n    1 connections established\n    13025010 segments received\n    17606946 segments sent out\n    44438 segments retransmitted\n    42 bad segments received\n    5315 resets sent\n    InCsumErrors: 42\n...\n\n$ ss -s\nTotal: 186 (kernel 1446)\nTCP:   4 (estab 1, closed 0, orphaned 0, synrecv 0, timewait 0/0), ports 0\n\nTransport Total     IP        IPv6\n*\t  1446      -         -\nRAW\t  2         1         1\nUDP\t  2         2         0\nTCP\t  4         3         1\n...\n</code></pre><p>这些协议栈的统计信息都很直观。ss 只显示已经连接、关闭、孤儿套接字等简要统计，而netstat 则提供的是更详细的网络协议栈信息。</p><p>比如，上面 netstat 的输出示例，就展示了 TCP 协议的主动连接、被动连接、失败重试、发送和接收的分段数量等各种信息。</p><h2><strong>网络吞吐和 PPS</strong></h2><p>接下来，我们再来看看，如何查看系统当前的网络吞吐量和 PPS。在这里，我推荐使用我们的老朋友 sar，在前面的 CPU、内存和 I/O 模块中，我们已经多次用到它。</p><p>给 sar 增加 -n 参数就可以查看网络的统计信息，比如网络接口（DEV）、网络接口错误（EDEV）、TCP、UDP、ICMP 等等。执行下面的命令，你就可以得到网络接口统计信息：</p><pre><code># 数字1表示每隔1秒输出一组数据\n$ sar -n DEV 1\nLinux 4.15.0-1035 (ubuntu) \t01/06/19 \t_x86_64_\t(2 CPU)\n\n13:21:40        IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s   %ifutil\n13:21:41         eth0     18.00     20.00      5.79      4.25      0.00      0.00      0.00      0.00\n13:21:41      docker0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00\n13:21:41           lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00\n</code></pre><p>这儿输出的指标比较多，我来简单解释下它们的含义。</p><ul>\n<li>\n<p>rxpck/s 和 txpck/s 分别是接收和发送的 PPS，单位为包/秒。</p>\n</li>\n<li>\n<p>rxkB/s 和 txkB/s 分别是接收和发送的吞吐量，单位是KB/秒。</p>\n</li>\n<li>\n<p>rxcmp/s 和 txcmp/s 分别是接收和发送的压缩数据包数，单位是包/秒。</p>\n</li>\n<li>\n<p>%ifutil 是网络接口的使用率，即半双工模式下为 (rxkB/s+txkB/s)/Bandwidth，而全双工模式下为 max(rxkB/s, txkB/s)/Bandwidth。</p>\n</li>\n</ul><p>其中，Bandwidth 可以用 ethtool 来查询，它的单位通常是 Gb/s 或者 Mb/s，不过注意这里小写字母 b ，表示比特而不是字节。我们通常提到的千兆网卡、万兆网卡等，单位也都是比特。如下你可以看到，我的 eth0 网卡就是一个千兆网卡：</p><pre><code>$ ethtool eth0 | grep Speed\n\tSpeed: 1000Mb/s\n</code></pre><h2><strong>连通性和延时</strong></h2><p>最后，我们通常使用 ping ，来测试远程主机的连通性和延时，而这基于 ICMP 协议。比如，执行下面的命令，你就可以测试本机到 114.114.114.114 这个 IP 地址的连通性和延时：</p><pre><code># -c3表示发送三次ICMP包后停止\n$ ping -c3 114.114.114.114\nPING 114.114.114.114 (114.114.114.114) 56(84) bytes of data.\n64 bytes from 114.114.114.114: icmp_seq=1 ttl=54 time=244 ms\n64 bytes from 114.114.114.114: icmp_seq=2 ttl=47 time=244 ms\n64 bytes from 114.114.114.114: icmp_seq=3 ttl=67 time=244 ms\n\n--- 114.114.114.114 ping statistics ---\n3 packets transmitted, 3 received, 0% packet loss, time 2001ms\nrtt min/avg/max/mdev = 244.023/244.070/244.105/0.034 ms\n</code></pre><p>ping 的输出，可以分为两部分。</p><ul>\n<li>\n<p>第一部分，是每个 ICMP 请求的信息，包括 ICMP 序列号（icmp_seq）、TTL（生存时间，或者跳数）以及往返延时。</p>\n</li>\n<li>\n<p>第二部分，则是三次 ICMP 请求的汇总。</p>\n</li>\n</ul><p>比如上面的示例显示，发送了 3 个网络包，并且接收到 3 个响应，没有丢包发生，这说明测试主机到 114.114.114.114 是连通的；平均往返延时（RTT）是 244ms，也就是从发送 ICMP 开始，到接收到 114.114.114.114 回复的确认，总共经历 244ms。</p><h2>小结</h2><p>我们通常使用带宽、吞吐量、延时等指标，来衡量网络的性能；相应的，你可以用 ifconfig、netstat、ss、sar、ping 等工具，来查看这些网络的性能指标。</p><p>在下一节中，我将以经典的 C10K 和 C100K 问题，带你进一步深入 Linux 网络的工作原理。</p><h2>思考</h2><p>最后，我想请你来聊聊，你理解的 Linux 网络性能。你常用什么指标来衡量网络的性能？又用什么思路分析相应性能问题呢？你可以结合今天学到的知识，提出自己的观点。</p><p>欢迎在留言区和我讨论，也欢迎你把这篇文章分享给你的同事、朋友。我们一起在实战中演练，在交流中进步。</p>","neighbors":{"left":{"article_title":"33 | 关于 Linux 网络，你必须知道这些（上）","id":80898},"right":{"article_title":"35 | 基础篇：C10K 和 C1000K 回顾","id":81268}},"comments":[{"had_liked":false,"id":71710,"user_name":"分清云淡","can_delete":false,"product_type":"c1","uid":1269873,"ip_address":"","ucode":"7045AE6BF72D31","user_header":"https://static001.geekbang.org/account/avatar/00/13/60/71/895ee6cf.jpg","comment_is_top":false,"comment_ctime":1551418919,"is_pvip":false,"replies":[{"id":"26315","content":"👍谢谢分享","user_name":"作者回复","comment_id":71710,"uid":"1001282","ip_address":"","utype":1,"ctime":1551704489,"user_name_real":"倪朋飞"}],"discussion_count":6,"race_medal":0,"score":"138990372391","product_id":100020901,"comment_content":"小狗同学问到： 老师，您好 ss —lntp 这个 当session处于listening中 rec-q 确定是 syn的backlog吗？  <br>A:  Recv-Q为全连接队列当前使用了多少。 中文资料里这个问题讲得最明白的文章：https:&#47;&#47;mp.weixin.qq.com&#47;s&#47;yH3PzGEFopbpA-jw4MythQ","like_count":32,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441291,"discussion_content":"👍谢谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551704489,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1198055,"avatar":"https://static001.geekbang.org/account/avatar/00/12/47/e7/53416498.jpg","nickname":"曹龙飞","note":"","ucode":"DD2DF8C0E89E38","race_medal":2,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4392,"discussion_content":"看了源码发现，这个地方讲的有问题.关于ss输出中listen状态套接字的Recv-Q表示全连接队列当前使用了多少,也就是全连接队列的当前长度,而Send-Q表示全连接队列的最大长度","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1565348171,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1269873,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/71/895ee6cf.jpg","nickname":"分清云淡","note":"","ucode":"7045AE6BF72D31","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1198055,"avatar":"https://static001.geekbang.org/account/avatar/00/12/47/e7/53416498.jpg","nickname":"曹龙飞","note":"","ucode":"DD2DF8C0E89E38","race_medal":2,"user_type":1,"is_pvip":true},"discussion":{"id":350332,"discussion_content":"笔误了，你说的对","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613812819,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":4392,"ip_address":""},"score":350332,"extra":""}]},{"author":{"id":1318534,"avatar":"https://static001.geekbang.org/account/avatar/00/14/1e/86/33ccfeb7.jpg","nickname":"Aoser","note":"","ucode":"B356387524BAA7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":128365,"discussion_content":"在阿里技术博客中，也看到这两个值指的是全连接：http://jm.taobao.org/2017/05/25/525-1/","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1578632162,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1269873,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/71/895ee6cf.jpg","nickname":"分清云淡","note":"","ucode":"7045AE6BF72D31","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1318534,"avatar":"https://static001.geekbang.org/account/avatar/00/14/1e/86/33ccfeb7.jpg","nickname":"Aoser","note":"","ucode":"B356387524BAA7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350331,"discussion_content":"是同一篇文章","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613812768,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":128365,"ip_address":""},"score":350331,"extra":""}]},{"author":{"id":1519189,"avatar":"","nickname":"Geek_00711d","note":"","ucode":"2B0B98853D4CCF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":102,"discussion_content":"这篇帖子里 连接和半连接 搞反了吧","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1561099409,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":143348,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1571672086,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"108945854486","product_id":100020901,"comment_content":"今天查一个问题，花了半天功夫。<br>如果文中的一句话还记得的话，可能就只需要几分钟了。<br><br>而 Send-Q 表示还没有被远端主机确认的字节数（即发送队列长度）。<br><br>原本ngnix在物理机上是没问题的，结果有个环境中放到了docker里，且还是走的普通端口映射模式，还不是—net=host模式，结果websocket发往ngnix的数据过大后就被阻塞了。<br>最后发现相应被阻塞的端口 send-q一直很大。<br>最后docker尝试使用net=host后故障消除。<br>具体的原因还没有细究。<br><br>留个言，给后面看专栏的同学一个教训吧。","like_count":25,"discussions":[{"author":{"id":1443017,"avatar":"https://static001.geekbang.org/account/avatar/00/16/04/c9/ef585c96.jpg","nickname":"碌舰虾","note":"","ucode":"B947C229E767D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":564998,"discussion_content":"之前中过招，不过后来修改了容器中的内核参数解决","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650369718,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1257022,"avatar":"http://thirdwx.qlogo.cn/mmopen/KFgDEHIEpnT0EXnh02VHqBptd0b8mtG3h3IX3wibjaxjoVia2VYb1W8x1GXYwtLibyKicBJowvJ97CcvlDh9WrSL5xZmFWYKN6Rt/132","nickname":"南冥","note":"","ucode":"07BDAF8B0CFF5F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":304445,"discussion_content":"是不是dockerb 桥模式下，veth-pair有性能问题，或者限速了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599572551,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1205253,"avatar":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","nickname":"我来也","note":"","ucode":"773D6104F56767","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1257022,"avatar":"http://thirdwx.qlogo.cn/mmopen/KFgDEHIEpnT0EXnh02VHqBptd0b8mtG3h3IX3wibjaxjoVia2VYb1W8x1GXYwtLibyKicBJowvJ97CcvlDh9WrSL5xZmFWYKN6Rt/132","nickname":"南冥","note":"","ucode":"07BDAF8B0CFF5F","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":304465,"discussion_content":"应该不是docker0导致的性能问题。\n\n就在上周，在生产环境中又踩了一次坑，但是没法通过修改—net=host的方式处理了。因为是在k8s中遇到的问题。\n\n后来发现，是宿主机内核版本导致的bug。\n具体的分析过程也是参考了这篇文章，推荐你一看。\n\nTCP SACK 补丁导致的发送队列报文积压\nhttps://runsisi.com/2019-12-19/tcp-sack-hang/","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1599576423,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":304445,"ip_address":""},"score":304465,"extra":""}]}]},{"had_liked":false,"id":122359,"user_name":"曹龙飞","can_delete":false,"product_type":"c1","uid":1198055,"ip_address":"","ucode":"DD2DF8C0E89E38","user_header":"https://static001.geekbang.org/account/avatar/00/12/47/e7/53416498.jpg","comment_is_top":false,"comment_ctime":1565348190,"is_pvip":true,"discussion_count":3,"race_medal":2,"score":"57399923038","product_id":100020901,"comment_content":"看了源码发现，这个地方讲的有问题.关于ss输出中listen状态套接字的Recv-Q表示全连接队列当前使用了多少,也就是全连接队列的当前长度,而Send-Q表示全连接队列的最大长度","like_count":14,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":157792,"discussion_content":"是的，谢谢指出","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1580520217,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1241939,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f3/53/c5a17618.jpg","nickname":"七色凉橙","note":"","ucode":"8F39B511B15C57","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293438,"discussion_content":"名字很好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595548525,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1007254,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/96/a03175bc.jpg","nickname":"莫名","note":"","ucode":"E28F2602BA25DD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":51598,"discussion_content":"赞同","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573906528,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65807,"user_name":"Days","can_delete":false,"product_type":"c1","uid":1317834,"ip_address":"","ucode":"4DDB1CD8F493E1","user_header":"https://static001.geekbang.org/account/avatar/00/14/1b/ca/9afb89a2.jpg","comment_is_top":false,"comment_ctime":1549672948,"is_pvip":false,"replies":[{"id":"23688","content":"这些在后面的案例中会涉及","user_name":"作者回复","comment_id":65807,"uid":"1001282","ip_address":"","utype":1,"ctime":1550065946,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"53089280500","product_id":100020901,"comment_content":"老师春节不休息，大赞啊，老师可否讲解一下一个包从网卡接收，发送在内核协议栈的整个流程，这样性能分析的时候，更好的理解数据包阻塞在哪里？","like_count":12,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438596,"discussion_content":"这些在后面的案例中会涉及","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550065946,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65886,"user_name":"[小狗]","can_delete":false,"product_type":"c1","uid":1237070,"ip_address":"","ucode":"090AEAC8A86134","user_header":"https://static001.geekbang.org/account/avatar/00/12/e0/4e/c266bdb4.jpg","comment_is_top":false,"comment_ctime":1549724035,"is_pvip":false,"replies":[{"id":"23686","content":"是的","user_name":"作者回复","comment_id":65886,"uid":"1001282","ip_address":"","utype":1,"ctime":1550065866,"user_name_real":"倪朋飞"}],"discussion_count":2,"race_medal":0,"score":"31614495107","product_id":100020901,"comment_content":"老师，您好  ss —lntp  这个  当session处于listening中  rec-q  确定是  syn的backlog吗？  我之前都是当做全队列的长度","like_count":7,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438629,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550065866,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1543040,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/80/8702bd5f.jpg","nickname":"evan","note":"","ucode":"491B073D5AFEDE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":318037,"discussion_content":"是全队列的长度.","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1603631593,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65917,"user_name":"code2","can_delete":false,"product_type":"c1","uid":1281792,"ip_address":"","ucode":"BBA5748FB6A01C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/8OPzdpDraQMvCNWAicicDt54sDaIYJZicBLfMyibXVs4V0ZibEdkZlbzxxL7aGpRoeyvibag5LaAaaGKSdwYQMY2hUrQ/132","comment_is_top":false,"comment_ctime":1549771204,"is_pvip":false,"replies":[{"id":"23685","content":"👍","user_name":"作者回复","comment_id":65917,"uid":"1001282","ip_address":"","utype":1,"ctime":1550065684,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"23024607684","product_id":100020901,"comment_content":"每期读两遍，看看别人怎么做!","like_count":5,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438642,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550065684,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":170557,"user_name":"Aoser","can_delete":false,"product_type":"c1","uid":1318534,"ip_address":"","ucode":"B356387524BAA7","user_header":"https://static001.geekbang.org/account/avatar/00/14/1e/86/33ccfeb7.jpg","comment_is_top":false,"comment_ctime":1578632100,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"18758501284","product_id":100020901,"comment_content":"老师，listening状态下，Recv-Q和Send-Q应该分别指的是，当前全连接的使用数量和最大全连接可用数量，但是文中说成了是半连接。参考阿里技术博客：http:&#47;&#47;jm.taobao.org&#47;2017&#47;05&#47;25&#47;525-1&#47;","like_count":4,"discussions":[{"author":{"id":2068424,"avatar":"","nickname":"Geek_9815f1","note":"","ucode":"34EE8566A53F10","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":292559,"discussion_content":"牛","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595254994,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":137517,"user_name":"mfj1st","can_delete":false,"product_type":"c1","uid":1316619,"ip_address":"","ucode":"33CA6040122817","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/u8g8UoUaBZTGpDgAQKDwL5IzicBILfpDmz0tOXibSQWkmTjr3m57ofUKVPgRiaFTRYZkE7dBxOmmJBhqCpYJWd2GA/132","comment_is_top":false,"comment_ctime":1569759418,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14454661306","product_id":100020901,"comment_content":"倪老师，虚拟机用ethtool获取不到网卡带宽，有其他方法吗？","like_count":3},{"had_liked":false,"id":65838,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1549695638,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14434597526","product_id":100020901,"comment_content":"[D34打卡]<br>平常只用netstat 和 ifconfig ，前面的专栏里学了sar观测网络指标，今天又接触了两个类似的：ss和ip。<br>平常遇到的网络问题比较简单，先看能否正常连上，再看看并发连接数。有时忘记执行ulimit -n会导致默认账号的一个进程同时打开文件数只有1024。<br>除了带宽没买够，平常不会遇到网络方面的瓶颈，毕竟我们的业务处理数据的消耗比收发数据的消耗大得多。","like_count":3},{"had_liked":false,"id":69582,"user_name":"Gaoyc","can_delete":false,"product_type":"c1","uid":1303119,"ip_address":"","ucode":"0320CEE480B4C5","user_header":"https://static001.geekbang.org/account/avatar/00/13/e2/4f/0748c63e.jpg","comment_is_top":false,"comment_ctime":1550794239,"is_pvip":false,"replies":[{"id":"24848","content":"是的，都是累加值，所以不建议清空这些统计信息。并且，真正要清的化，也需要停止网卡并且卸载（rmmod）网卡内核模块，这在实际环境中通常是不允许的。","user_name":"作者回复","comment_id":69582,"uid":"1001282","ip_address":"","utype":1,"ctime":1550850559,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"10140728831","product_id":100020901,"comment_content":"通过ifconfig和ss看到的错误包或丢弃包等的一些错误是累加的嘛？是否可以清空这些错误包信息？","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440174,"discussion_content":"是的，都是累加值，所以不建议清空这些统计信息。并且，真正要清的化，也需要停止网卡并且卸载（rmmod）网卡内核模块，这在实际环境中通常是不允许的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550850559,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65734,"user_name":"芥菜","can_delete":false,"product_type":"c1","uid":1089833,"ip_address":"","ucode":"FDF57F34E09A80","user_header":"https://static001.geekbang.org/account/avatar/00/10/a1/29/ac0f2c83.jpg","comment_is_top":false,"comment_ctime":1549611750,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"10139546342","product_id":100020901,"comment_content":"春节期间终于跟上节奏，春节里做到只长知识不长肉：）","like_count":2},{"had_liked":false,"id":206819,"user_name":"Frank","can_delete":false,"product_type":"c1","uid":1111985,"ip_address":"","ucode":"9DADD72C193296","user_header":"https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg","comment_is_top":false,"comment_ctime":1586940847,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"5881908143","product_id":100020901,"comment_content":"老师， 网卡  dropped  不为零，而且还在增加，怎么排查问题哦？","like_count":1,"discussions":[{"author":{"id":1688629,"avatar":"https://static001.geekbang.org/account/avatar/00/19/c4/35/2cc10d43.jpg","nickname":"Wade_阿伟","note":"","ucode":"5AE2E846A13443","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334795,"discussion_content":"可以看下系统日志，iptables转发表是否满了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1607993995,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":199028,"user_name":"hellojd_gk","can_delete":false,"product_type":"c1","uid":1679543,"ip_address":"","ucode":"319AF4C1AD568D","user_header":"https://static001.geekbang.org/account/avatar/00/19/a0/b7/1327ae60.jpg","comment_is_top":false,"comment_ctime":1585476621,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5880443917","product_id":100020901,"comment_content":"在阿里云ECS上执行如下命令，怎么啥也不返回<br>[root@iZ8vb31waukedizc39ffofZ ~]# ethtool eth0<br>Settings for eth0:<br>        Link detected: yes","like_count":1,"discussions":[{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394966,"discussion_content":"这个应该用你云主机给的带宽就是了。\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632148789,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":198849,"user_name":"南山","can_delete":false,"product_type":"c1","uid":1119593,"ip_address":"","ucode":"94656FE4A6C378","user_header":"https://static001.geekbang.org/account/avatar/00/11/15/69/187b9968.jpg","comment_is_top":false,"comment_ctime":1585470448,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5880437744","product_id":100020901,"comment_content":"有点看到本质的感觉，赞","like_count":1},{"had_liked":false,"id":165737,"user_name":"arch","can_delete":false,"product_type":"c1","uid":1078931,"ip_address":"","ucode":"A69EBFE0520B85","user_header":"https://static001.geekbang.org/account/avatar/00/10/76/93/64ed7385.jpg","comment_is_top":false,"comment_ctime":1577292339,"is_pvip":true,"discussion_count":4,"race_medal":0,"score":"5872259635","product_id":100020901,"comment_content":"&lt;b&gt;ethtool eth0 | grep Speed&lt;&#47;b&gt; 这个命令不管用，查不出带宽大小？ ","like_count":1,"discussions":[{"author":{"id":1318941,"avatar":"https://static001.geekbang.org/account/avatar/00/14/20/1d/0c1a184c.jpg","nickname":"罗辑思维","note":"","ucode":"D257A06EDE928E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":195820,"discussion_content":"确认网卡名称是不是eth0\nifconfig -a","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1583312654,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2066801,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/W0VEO7Hxzd61mia6Ls2EpBmaZ0l9q7SFUAErbu4XKIjWLmlALr4ybpicDoI8SoXY8XJNKmk04Ep1ibTCuFvfCF8GQ/132","nickname":"Chen","note":"","ucode":"5D0F3DF807706E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":345964,"discussion_content":"ifconfig -a | more先确认自己的网卡名称，然后再用ethtool 网卡名去查询","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611824542,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2330999,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/KhQRc8hIxHHyPV3Og2Fc5l8w2y7ibGwGn6odmzl3wTt6fPrNv589uHmia1rgiaZhRiaLVHv9ibhzkxFx1zo42uNIS9A/132","nickname":"道长","note":"","ucode":"15B2E9CEF84634","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335914,"discussion_content":"我的也是提示Speed：Unknown","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608382118,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2791742,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/aCVlj0fom8geRoXFkO34Jbpf9oia79QxdbwDuyyLqL1WAVC7iaViaE4YNUvcatEwwUF6102MeH6kBxo5CwLibrCiajg/132","nickname":"Geek_9e9d56","note":"","ucode":"F6333DA18E4EB0","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":2330999,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/KhQRc8hIxHHyPV3Og2Fc5l8w2y7ibGwGn6odmzl3wTt6fPrNv589uHmia1rgiaZhRiaLVHv9ibhzkxFx1zo42uNIS9A/132","nickname":"道长","note":"","ucode":"15B2E9CEF84634","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":559104,"discussion_content":"只有物理机才可以查看带宽吧，你查看的是虚拟机吗？如果一台主机上有多台虚机，物理机的带宽是确定的，多台虚机会互相争抢带宽，虚拟机的带宽查不到","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1648610891,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":335914,"ip_address":""},"score":559104,"extra":""}]}]},{"had_liked":false,"id":96264,"user_name":"zhoufeng","can_delete":false,"product_type":"c1","uid":1447741,"ip_address":"","ucode":"6F92F7866F9EB4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKq0oQVibKcmYJqmpqaNNQibVgia7EsEgW65LZJIpDZBMc7FyMcs7J1JmFCtp06pY8ibbcpW4ibRtG7Frg/132","comment_is_top":false,"comment_ctime":1558369319,"is_pvip":false,"replies":[{"id":"34558","content":"不是，这只是半连接的最大数量","user_name":"作者回复","comment_id":96264,"uid":"1001282","ip_address":"","utype":1,"ctime":1558447376,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"5853336615","product_id":100020901,"comment_content":"老师好，再请教一个问题，查看max_syn_backlog值为2048，表示同时最大只能接受2048个请求吗？<br># cat &#47;proc&#47;sys&#47;net&#47;ipv4&#47;tcp_max_syn_backlog <br>2048<br>","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450802,"discussion_content":"不是，这只是半连接的最大数量","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558447376,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96263,"user_name":"zhoufeng","can_delete":false,"product_type":"c1","uid":1447741,"ip_address":"","ucode":"6F92F7866F9EB4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKq0oQVibKcmYJqmpqaNNQibVgia7EsEgW65LZJIpDZBMc7FyMcs7J1JmFCtp06pY8ibbcpW4ibRtG7Frg/132","comment_is_top":false,"comment_ctime":1558369068,"is_pvip":false,"replies":[{"id":"34559","content":"前一个是套接字级的，后一个是系统级的","user_name":"作者回复","comment_id":96263,"uid":"1001282","ip_address":"","utype":1,"ctime":1558447547,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"5853336364","product_id":100020901,"comment_content":"老师好，<br>“当套接字处于listen状态时，使用ss命令看到的Send-Q表示最大的syn_backlog值”<br>但是和&#47;proc&#47;sys&#47;net&#47;ipv4&#47;tcp_max_syn_backlog   查看到的值不一致，是我理解错了吗？<br>谢谢","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450801,"discussion_content":"前一个是套接字级的，后一个是系统级的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558447547,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":75092,"user_name":"MJ","can_delete":false,"product_type":"c1","uid":1237145,"ip_address":"","ucode":"FCEC0C21444D2A","user_header":"https://static001.geekbang.org/account/avatar/00/12/e0/99/5d603697.jpg","comment_is_top":false,"comment_ctime":1552355011,"is_pvip":false,"replies":[{"id":"27487","content":"嗯嗯，说转发性能的时候一般都是指一个方向的","user_name":"作者回复","comment_id":75092,"uid":"1001282","ip_address":"","utype":1,"ctime":1552399926,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"5847322307","product_id":100020901,"comment_content":"老师，有一事疑惑，希望帮忙解惑。<br><br>一台64个千兆端口的交换机，全双工模式，交换容量计算：64*1000*2<br>包转发速率计算：64*1.488Mpp<br><br>交换容量有个乘以2，为什么包转发速率不需要乘以2？<br>（我理解，端口速率1000bps，在全双工模式下，按照双向速率计算，即总速率是2000bps）","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442796,"discussion_content":"嗯嗯，说转发性能的时候一般都是指一个方向的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552399926,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":74196,"user_name":"好好学习","can_delete":false,"product_type":"c1","uid":1258789,"ip_address":"","ucode":"63A002997462E3","user_header":"https://static001.geekbang.org/account/avatar/00/13/35/25/bab760a1.jpg","comment_is_top":false,"comment_ctime":1552140369,"is_pvip":false,"replies":[{"id":"27330","content":"网络接口的一些标志，含义在尖括号中","user_name":"作者回复","comment_id":74196,"uid":"1001282","ip_address":"","utype":1,"ctime":1552349069,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"5847107665","product_id":100020901,"comment_content":"eth0: flags=4163<br>这个什么意思，有点好奇","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442492,"discussion_content":"网络接口的一些标志，含义在尖括号中","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552349069,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":73569,"user_name":"bzadhere","can_delete":false,"product_type":"c1","uid":1045920,"ip_address":"","ucode":"8A3CC56EF76A65","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f5/a0/c342c50e.jpg","comment_is_top":false,"comment_ctime":1551927162,"is_pvip":false,"replies":[{"id":"27322","content":"可能是版本问题，可以查查 ss 的 manual 上含义是一样的吗","user_name":"作者回复","comment_id":73569,"uid":"1001282","ip_address":"","utype":1,"ctime":1552348120,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"5846894458","product_id":100020901,"comment_content":"netstat -nta  命令看到Listening状态下的Send-Q 值都是0，用man netstat 看到说明和实际情况不一样； 然后用ss -lnt 看到Send-Q  非0，应该怎么理解？<br><br>[root@localhost ~]# man netstat<br>......<br>   Recv-Q<br>       Established:  The count of bytes not copied by the user program connected to this socket.  Listening: Since<br>       Kernel 2.6.18 this column contains the current syn backlog.<br><br>   Send-Q<br>       Established: The count of bytes not acknowledged by the remote host.  Listening: Since Kernel  2.6.18  this<br>       column contains the maximum size of the syn backlog.<br>.......<br><br>[root@localhost ~]# netstat -tna<br>Active Internet connections (servers and established)<br>Proto Recv-Q Send-Q Local Address           Foreign Address         State      <br>tcp        0      0 0.0.0.0:21              0.0.0.0:*               LISTEN     <br>tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN     <br>tcp        0      0 127.0.0.1:25            0.0.0.0:*               LISTEN     <br>tcp        0      0 192.168.137.20:22       192.168.137.1:52521     ESTABLISHED<br>tcp6       0      0 :::22                   :::*                    LISTEN     <br>tcp6       0      0 ::1:25                  :::*                    LISTEN     <br><br>[root@localhost ~]# ss -lnt<br>State       Recv-Q Send-Q             Local Address:Port                            Peer Address:Port              <br>LISTEN      0      32                             *:21                                         *:*                  <br>LISTEN      0      128                            *:22                                         *:*                  <br>LISTEN      0      100                    127.0.0.1:25                                         *:*                  <br>LISTEN      0      128                           :::22                                        :::*                  <br>LISTEN      0      100                          ::1:25                                        :::*  ","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442162,"discussion_content":"可能是版本问题，可以查查 ss 的 manual 上含义是一样的吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552348120,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":67514,"user_name":"ninuxer","can_delete":false,"product_type":"c1","uid":1243135,"ip_address":"","ucode":"5394ADAF2667D6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132","comment_is_top":false,"comment_ctime":1550190047,"is_pvip":false,"replies":[{"id":"24035","content":"👍嗯嗯","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550325413,"ip_address":"","comment_id":67514,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5845157343","product_id":100020901,"comment_content":"打卡day36<br>去年之前喜欢用netstat，ifconfig，去年年中的时候入坑ss，ip","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439225,"discussion_content":"👍嗯嗯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550325413,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":66085,"user_name":"xfan","can_delete":false,"product_type":"c1","uid":1315147,"ip_address":"","ucode":"48ED8D498D7F56","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/4b/fa64f061.jpg","comment_is_top":false,"comment_ctime":1549874876,"is_pvip":false,"replies":[{"id":"23698","content":"可能跟网卡状态和驱动有关，可以试试先配置好 IP 并开启网卡后再查看","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550067823,"ip_address":"","comment_id":66085,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5844842172","product_id":100020901,"comment_content":"Speed 有的通过ethtool查不到，是什么原因呢，那查不到的话，默认值是多少呢","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438696,"discussion_content":"可能跟网卡状态和驱动有关，可以试试先配置好 IP 并开启网卡后再查看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550067823,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358658,"user_name":"mkcaptain","can_delete":false,"product_type":"c1","uid":2341231,"ip_address":"北京","ucode":"0BF1BAE12B0C11","user_header":"https://static001.geekbang.org/account/avatar/00/23/b9/6f/b40d1acf.jpg","comment_is_top":false,"comment_ctime":1664521744,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1664521744","product_id":100020901,"comment_content":"如果收到的包是发给相同二层其他主机的，是不是也会统计在ifconfig -a的dropped里？","like_count":0},{"had_liked":false,"id":352851,"user_name":"肥low","can_delete":false,"product_type":"c1","uid":1043480,"ip_address":"北京","ucode":"A158AFAAB8C742","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ec/18/bf7254d3.jpg","comment_is_top":false,"comment_ctime":1658980990,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1658980990","product_id":100020901,"comment_content":"常用什么指标来衡量网络的性能？<br><br>我开发接口较多，因此单机的tps &#47; qps 会作为衡量性能或者承载能力的标准吧<br><br>又用什么思路分析相应性能问题呢？<br><br>1、首先业务代码中要阶段性的打时间点信息，看有没有特别长的耗时，对应解决掉<br>2、其次用压测工具如 wrk 去压一下，用 top、vmstat 观察系统的瓶颈是在哪儿，需要排除系统自身设置的影响，如单进程最大打开文件个数限制，系统最大fd个数限制、nginx最大connections等限制<br>3、其它的我暂时没涉及到，待补充🥷……","like_count":0},{"had_liked":false,"id":350213,"user_name":"竹影","can_delete":false,"product_type":"c1","uid":1211289,"ip_address":"","ucode":"182FC1A9ECBEF3","user_header":"https://static001.geekbang.org/account/avatar/00/12/7b/99/4f5857a8.jpg","comment_is_top":false,"comment_ctime":1656663434,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1656663434","product_id":100020901,"comment_content":"老师，不使用sudo可以查到本机监听的端口对应的进程信息吗？","like_count":0,"discussions":[{"author":{"id":1211289,"avatar":"https://static001.geekbang.org/account/avatar/00/12/7b/99/4f5857a8.jpg","nickname":"竹影","note":"","ucode":"182FC1A9ECBEF3","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580458,"discussion_content":"看起来不行，可以给netstat加s权限","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658193161,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337119,"user_name":"return","can_delete":false,"product_type":"c1","uid":1135528,"ip_address":"","ucode":"42B8A3380DF04B","user_header":"https://static001.geekbang.org/account/avatar/00/11/53/a8/abc96f70.jpg","comment_is_top":false,"comment_ctime":1646634119,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646634119","product_id":100020901,"comment_content":"请假老师， 查丢包率就是用 ping 是吗。","like_count":0},{"had_liked":false,"id":327687,"user_name":"Ansyear","can_delete":false,"product_type":"c1","uid":1629257,"ip_address":"","ucode":"489CE96852EA2C","user_header":"https://static001.geekbang.org/account/avatar/00/18/dc/49/43ae1627.jpg","comment_is_top":false,"comment_ctime":1640238684,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1640238684","product_id":100020901,"comment_content":"什么是孤儿套接字？","like_count":0},{"had_liked":false,"id":323231,"user_name":"kevinsu","can_delete":false,"product_type":"c1","uid":1078506,"ip_address":"","ucode":"BAD46B815D6A5C","user_header":"https://static001.geekbang.org/account/avatar/00/10/74/ea/10661bdc.jpg","comment_is_top":false,"comment_ctime":1637776250,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637776250","product_id":100020901,"comment_content":"老师，有没有关于协议栈优化的文章？","like_count":0},{"had_liked":false,"id":320659,"user_name":"Ansyear","can_delete":false,"product_type":"c1","uid":1629257,"ip_address":"","ucode":"489CE96852EA2C","user_header":"https://static001.geekbang.org/account/avatar/00/18/dc/49/43ae1627.jpg","comment_is_top":false,"comment_ctime":1636442059,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636442059","product_id":100020901,"comment_content":"当套接字处于监听状态（Listening）时，此时不应该是半队列吗，为什么Send-Q 表示全连接队列的最大长度，Recv-Q也是说的全队列？","like_count":0},{"had_liked":false,"id":311450,"user_name":"AceslupK","can_delete":false,"product_type":"c1","uid":1284474,"ip_address":"","ucode":"048F84D019CBBB","user_header":"https://static001.geekbang.org/account/avatar/00/13/99/7a/558666a5.jpg","comment_is_top":false,"comment_ctime":1631240527,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631240527","product_id":100020901,"comment_content":"网络问题更复杂，继续认真学习","like_count":0},{"had_liked":false,"id":289305,"user_name":"脱缰的野马__","can_delete":false,"product_type":"c1","uid":1447569,"ip_address":"","ucode":"D5F993E7232C61","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/WtHCCMoLJ2DvzqQwPYZyj2RlN7eibTLMHDMTSO4xIKjfKR1Eh9L98AMkkZY7FmegWyGLahRQJ5ibPzeeFtfpeSow/132","comment_is_top":false,"comment_ctime":1618974379,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618974379","product_id":100020901,"comment_content":"老师你好，急问一个问题，有一个线上服务我通过netstat -anlp | grep port 查看有一千多条信息，百分之95一直处于close_wait状态，并且Recv-Q都显示的是257，有些ESTABLISHED状态的Recv-Q基本都是625、626，还有就是这个命令显示的行里面还有很多Foreign Address是这台机器自己的IP，只是端口号是临时的端口号，而且这种行的Recv-Q都是1，老师看看这可能是什么问题呢","like_count":0},{"had_liked":false,"id":277900,"user_name":"Geek_leesom","can_delete":false,"product_type":"c1","uid":2407946,"ip_address":"","ucode":"47DE1CFF50556A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Pf1R6hXvuoBny0Gc3mwyQLic8GUDogYpxehHOlq3pbgnTlIvyMDjkRXNWoa7DNeY249QuhRaTtyiaTqEay5YCfMg/132","comment_is_top":false,"comment_ctime":1612665299,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612665299","product_id":100020901,"comment_content":"春节居家就靠这个了","like_count":0},{"had_liked":false,"id":270438,"user_name":"Geek_77a14f","can_delete":false,"product_type":"c1","uid":2116919,"ip_address":"","ucode":"EB71258E219A6D","user_header":"","comment_is_top":false,"comment_ctime":1609126657,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609126657","product_id":100020901,"comment_content":" sar 命令中的 rxcmp&#47;s 和 txcmp&#47;s 分别是接收和发送的压缩数据包数，单位是包 &#47; 秒。这个压缩数据包指的什么？","like_count":0},{"had_liked":false,"id":228293,"user_name":"Roy","can_delete":false,"product_type":"c1","uid":1930723,"ip_address":"","ucode":"909B8B605C317A","user_header":"https://static001.geekbang.org/account/avatar/00/1d/75/e3/ef489d57.jpg","comment_is_top":false,"comment_ctime":1592635590,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592635590","product_id":100020901,"comment_content":"平时理解的网络性能指标有，带宽，网络速度，吞吐量，以前学校也有学习课程里的指标，不过给忘了","like_count":0},{"had_liked":false,"id":217120,"user_name":"Bitstream","can_delete":false,"product_type":"c1","uid":1434089,"ip_address":"","ucode":"51FB631A70B52C","user_header":"https://static001.geekbang.org/account/avatar/00/15/e1/e9/29b62c57.jpg","comment_is_top":false,"comment_ctime":1589422699,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589422699","product_id":100020901,"comment_content":"带宽表示“最大”传输速率，这个“最大”理论和实际可能有差别，包括受到测试用机器的性能影响。那么如何客观的测量带宽呢？只是简单的跑一跑iperf，感觉不太能说明问题啊？","like_count":0},{"had_liked":false,"id":185129,"user_name":"winfield","can_delete":false,"product_type":"c1","uid":1216930,"ip_address":"","ucode":"6A5E1B449328C9","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIQMh5jMlvAibnTgiaVXmsb333JBjpdvLVcptc232zQey5wkBOEPiauepQpv8UlRcOFqnTyhEQiadaHMA/132","comment_is_top":false,"comment_ctime":1583491414,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1583491414","product_id":100020901,"comment_content":"%ifutil 是网络接口的使用率，即半双工模式下为 (rxkB&#47;s+txkB&#47;s)&#47;Bandwidth，而全双工模式下为 max(rxkB&#47;s, txkB&#47;s)&#47;Bandwidth<br>感觉这里反了，不知道理解得对不对","like_count":0,"discussions":[{"author":{"id":1811495,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/a4/27/15e75982.jpg","nickname":"小袁","note":"","ucode":"3F5D8721F577D9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":268007,"discussion_content":"半双工最多只能有一个方向work，你品，细品","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589723042,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1000004,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/44/d3d67640.jpg","nickname":"Hills录","note":"","ucode":"779020947ACABA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":214431,"discussion_content":"如果带宽相同，相同读写速率的情况的，全双工的使用率会更低，所以并没有反","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585192524,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":153407,"user_name":"顺利","can_delete":false,"product_type":"c1","uid":1618652,"ip_address":"","ucode":"C904941C8BA6DA","user_header":"https://static001.geekbang.org/account/avatar/00/18/b2/dc/67e0e985.jpg","comment_is_top":false,"comment_ctime":1574231498,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574231498","product_id":100020901,"comment_content":"感觉网络章节有点难呀老师","like_count":0},{"had_liked":false,"id":143818,"user_name":"天草二十六","can_delete":false,"product_type":"c1","uid":1360712,"ip_address":"","ucode":"3165EE3007527B","user_header":"https://static001.geekbang.org/account/avatar/00/14/c3/48/3a739da6.jpg","comment_is_top":false,"comment_ctime":1571795183,"is_pvip":false,"replies":[{"id":"55573","content":"特定程序的丢包率，最简单的是在程序中计算汇总","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1571839405,"ip_address":"","comment_id":143818,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1571795183","product_id":100020901,"comment_content":"请教下：丢包率，计算客户端程序到IDC机房的，一般使用什么量化工具？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471704,"discussion_content":"特定程序的丢包率，最简单的是在程序中计算汇总","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571839405,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":122346,"user_name":"山鷹·China","can_delete":false,"product_type":"c1","uid":1146178,"ip_address":"","ucode":"1A13AAC813C1C8","user_header":"https://static001.geekbang.org/account/avatar/00/11/7d/42/c324a7de.jpg","comment_is_top":false,"comment_ctime":1565344025,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565344025","product_id":100020901,"comment_content":"老师 怎么查看tcp被拒绝连接的统计信息？","like_count":0},{"had_liked":false,"id":110879,"user_name":"魏乐","can_delete":false,"product_type":"c1","uid":1233832,"ip_address":"","ucode":"B6D50018BE67E7","user_header":"https://static001.geekbang.org/account/avatar/00/12/d3/a8/91eed372.jpg","comment_is_top":false,"comment_ctime":1562382884,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562382884","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":101259,"user_name":"孙成子","can_delete":false,"product_type":"c1","uid":1317819,"ip_address":"","ucode":"7DF58E9202FC60","user_header":"https://static001.geekbang.org/account/avatar/00/14/1b/bb/4a749b6c.jpg","comment_is_top":false,"comment_ctime":1559753400,"is_pvip":false,"replies":[{"id":"37107","content":"谢谢，也欢迎分享你的经验","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1560261322,"ip_address":"","comment_id":101259,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1559753400","product_id":100020901,"comment_content":"每一篇都是精华， 需要多看几遍，多思考。谢谢老师","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452876,"discussion_content":"谢谢，也欢迎分享你的经验","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560261322,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":97412,"user_name":"李逍遥","can_delete":false,"product_type":"c1","uid":1109750,"ip_address":"","ucode":"DB74823527E203","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/xzHDjCSFicNY3MUMECtNz6sM8yDJhBoyGk5IRoOtUat6ZIkGzxjqEqwqKYWMD3GjehScKvMjicGOGDog5FF18oyg/132","comment_is_top":false,"comment_ctime":1558666180,"is_pvip":false,"replies":[{"id":"34978","content":"请参考本文的“套接字信息”部分","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1558794065,"ip_address":"","comment_id":97412,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1558666180","product_id":100020901,"comment_content":"温习一遍，有个疑问，套接字 Listening状态时， Send-Q 表示的是全连接 最大值吧？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451274,"discussion_content":"请参考本文的“套接字信息”部分","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558794065,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96599,"user_name":"zhoufeng","can_delete":false,"product_type":"c1","uid":1447741,"ip_address":"","ucode":"6F92F7866F9EB4","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKq0oQVibKcmYJqmpqaNNQibVgia7EsEgW65LZJIpDZBMc7FyMcs7J1JmFCtp06pY8ibbcpW4ibRtG7Frg/132","comment_is_top":false,"comment_ctime":1558456454,"is_pvip":false,"replies":[{"id":"34976","content":"😊","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1558794020,"ip_address":"","comment_id":96599,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1558456454","product_id":100020901,"comment_content":"太赞了，结课这么久了还能收到老师的回复，老师严谨负责。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450928,"discussion_content":"😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558794020,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":80031,"user_name":"Maxwell","can_delete":false,"product_type":"c1","uid":1086275,"ip_address":"","ucode":"720A00AD472616","user_header":"https://static001.geekbang.org/account/avatar/00/10/93/43/0e84492d.jpg","comment_is_top":false,"comment_ctime":1553596319,"is_pvip":false,"replies":[{"id":"29199","content":"是的，要升级到新版本的sar才有","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553610749,"ip_address":"","comment_id":80031,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553596319","product_id":100020901,"comment_content":"centos 6.8执行 sar 命令没有%ifutil,这个指标可以理解为网络利用率吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444730,"discussion_content":"是的，要升级到新版本的sar才有","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553610749,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78780,"user_name":"如果","can_delete":false,"product_type":"c1","uid":1320638,"ip_address":"","ucode":"138A3EEEE50850","user_header":"","comment_is_top":false,"comment_ctime":1553239855,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1553239855","product_id":100020901,"comment_content":"DAY34，打卡","like_count":0},{"had_liked":false,"id":75880,"user_name":"Griffin","can_delete":false,"product_type":"c1","uid":1087329,"ip_address":"","ucode":"CF766B92A65261","user_header":"https://static001.geekbang.org/account/avatar/00/10/97/61/34a0da09.jpg","comment_is_top":false,"comment_ctime":1552487102,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552487102","product_id":100020901,"comment_content":"打卡～","like_count":0},{"had_liked":false,"id":70203,"user_name":"MJ","can_delete":false,"product_type":"c1","uid":1237145,"ip_address":"","ucode":"FCEC0C21444D2A","user_header":"https://static001.geekbang.org/account/avatar/00/12/e0/99/5d603697.jpg","comment_is_top":false,"comment_ctime":1551051171,"is_pvip":false,"replies":[{"id":"25348","content":"嗯嗯，分为接收和发送","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551194736,"ip_address":"","comment_id":70203,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551051171","product_id":100020901,"comment_content":"老师，带宽和吞吐量指标。区分上下行吗，？还是统计总量？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440490,"discussion_content":"嗯嗯，分为接收和发送","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551194736,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69196,"user_name":"--SNIPER","can_delete":false,"product_type":"c1","uid":1389362,"ip_address":"","ucode":"7439EC0458BD7F","user_header":"https://static001.geekbang.org/account/avatar/00/15/33/32/8f304f6c.jpg","comment_is_top":false,"comment_ctime":1550676047,"is_pvip":false,"replies":[{"id":"25325","content":"注意区分下状态，Established 状态表示字节数，500应该是正常的；Listening 状态的话，可以去查查半连接","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551193047,"ip_address":"","comment_id":69196,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550676047","product_id":100020901,"comment_content":"老师好，netstat -anu 输出中：网卡收发队列时不时的会排队500，这种该如何再深入排查下是哪里的问题","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439994,"discussion_content":"注意区分下状态，Established 状态表示字节数，500应该是正常的；Listening 状态的话，可以去查查半连接","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551193047,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":66462,"user_name":"蚂蚁内推+v","can_delete":false,"product_type":"c1","uid":1050508,"ip_address":"","ucode":"24B10AEE54B3FD","user_header":"https://static001.geekbang.org/account/avatar/00/10/07/8c/0d886dcc.jpg","comment_is_top":false,"comment_ctime":1549942149,"is_pvip":false,"replies":[{"id":"23733","content":"嗯嗯，有点别扭，我来稍微调整下","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550070954,"ip_address":"","comment_id":66462,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1549942149","product_id":100020901,"comment_content":"吞吐量，表示没丢包时的最大数据传输速率<br>这个翻译有点问题？<br>Throughput is how much data actually does travel through the &#39;channel&#39; successfully.","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438808,"discussion_content":"嗯嗯，有点别扭，我来稍微调整下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550070954,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65960,"user_name":"Geek_33409b","can_delete":false,"product_type":"c1","uid":1112756,"ip_address":"","ucode":"9C64C42F799403","user_header":"https://static001.geekbang.org/account/avatar/00/10/fa/b4/6892eabe.jpg","comment_is_top":false,"comment_ctime":1549802676,"is_pvip":false,"replies":[{"id":"23681","content":"监控就是最好的方法了。从其他机器上也可以Telnet到路由器上查看","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550065542,"ip_address":"","comment_id":65960,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1549802676","product_id":100020901,"comment_content":"老师，有没有什么办法可以知道路由器的带宽是不是被打满了？除了路由器的图形监控之外。怎么从连接到路由器上的机器知道路由器的带宽情况？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438659,"discussion_content":"监控就是最好的方法了。从其他机器上也可以Telnet到路由器上查看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550065542,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65765,"user_name":"Scott","can_delete":false,"product_type":"c1","uid":1014800,"ip_address":"","ucode":"7E57FDCB5E5D49","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7c/10/165cb374.jpg","comment_is_top":false,"comment_ctime":1549630668,"is_pvip":false,"replies":[{"id":"23689","content":"用了 -l 选项把其他非监听的连接都过滤掉了，去掉 -l 就可以了","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550066166,"ip_address":"","comment_id":65765,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1549630668","product_id":100020901,"comment_content":"你好，我man一下netstat，看到Foreign Address的定义如下<br>Foreign Address<br>       Address and port number of the remote end of the socket.  Analogous to &quot;Local Address.&quot;<br><br>请教一下，我用netstat -nlp看到的Foreign Address都是0.0.0.0:*，我特意浏览器开了一个下载，依然看到都是这样。<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438577,"discussion_content":"用了 -l 选项把其他非监听的连接都过滤掉了，去掉 -l 就可以了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550066166,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}