{"id":255795,"title":"09 | 应用2：如何在编辑器中使用正则完成工作？","content":"<p>你好，我是伟忠。今天我来和你分享一下，在常见的编辑器中如何使用正则来完成工作。</p><p>你可能要问了，这是正则专栏，为啥不直接开始讲正则？其实我给你讲的编辑器使用技巧，能够帮助我们更好地完成工作。因为我们学习正则的目的，就是想高效地完成文本处理。</p><p>但在实际工作中，我们一般不会只用正则，而是通常将编辑器的特性和正则结合起来，这样可以让文本处理工作更加高效。正所谓“工欲善其事，必先利其器”，你花点时间来了解一下编辑器的各种特性，可以少写很多代码。</p><h2>编辑器功能</h2><p>接下来，我以Sublime Text 3 为例，给你讲讲一些在编辑器里的强大功能，这些功能在Sublime Text、Atom、VS Code、JetBrains 系列（IntelliJ IDEA/PyCharm/Goland等) 中都是支持的。</p><h3>光标移动和文本选择</h3><p>在常见的编辑器、IDE、甚至Chrome等浏览器中，我们编辑文本时，使用键盘的左右箭头移动光标，可以<strong>按住Shift键</strong>来选中文本。在左右移动时，如果你按住<strong>Alt（macOS的option）</strong>，你会发现光标可以“按块移动”，快速移动到下一个单词。两种方式组合起来，你可以快速选择引号里面的内容。<br>\n<img src=\"https://static001.geekbang.org/resource/image/f2/34/f2ca77c68ef5bf42b7f997693483f334.png?wh=962*322\" alt=\"\"></p><p>你可以动手练习一下，熟悉一下这些操作。你可能会说，有必要么，我用鼠标拖一下不就可以了？你说得没错，但这个功能和后面我要讲的多焦点编辑、竖向编辑等结合起来，就可以快速多行操作，这是鼠标做不到的。</p><!-- [[[read_end]]] --><h3>多焦点编辑</h3><p>在IDE中，我们如果想对某个变量或函数重命名，通常可以使用重构（refactor）功能。但如果处理的不是代码，而是普通文本，比如JSON字符串的时候，就没法这么用了。不过现在很多编辑器都提供了多焦点编辑的功能。</p><p>比如选择单词 route 之后，点击菜单 Find -&gt; Quick Find All 就可以选中所有的 route 了。你可以进行多焦点编辑，非常方便。我给了你一个测试文本，你可以点击<a href=\"https://github.com/gin-gonic/gin/blob/5e40c1d49c21bf989e8d54dbd555086f06d4fb8a/README.md#bind-uri\">这里</a>获取。</p><p><img src=\"https://static001.geekbang.org/resource/image/eb/23/eb19d2152d2be332125aeec2d1371f23.png?wh=1826*1236\" alt=\"\"></p><p>这个特性结合光标移动，可以快速提取某些内容，比如提取 JSON中的姓名和手机号。选中所有的字段和值之间的字符（\": \"） 之后，按住 Shift+Alt（macOS上是Shift + Option），用箭头移动光标，可以快速选择到另外一个引号前，然后剪切，再找个空白地方粘贴就可以了。</p><pre><code>{\n  &quot;error_code&quot;: 0,\n  &quot;result&quot;: {\n    &quot;data&quot;: [\n      {\n        &quot;name&quot;: &quot;朱小明&quot;,\n        &quot;tel&quot;: &quot;138xx138000&quot;\n      },\n      {\n        &quot;name&quot;: &quot;王五&quot;,\n        &quot;tel&quot;: &quot;139xx139000&quot;\n      }\n    ]\n  }\n}\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/52/7c/520533a63bc9a1079619a25dda8c897c.png?wh=1032*772\" alt=\"\"></p><p>详细操作你可以看一下这个小视频。<br>\n<video preload=\"none\" controls=\"\"><source src=\"https://media001.geekbang.org/customerTrans/7e27d07d27d407ebcc195a0e78395f55/e31f7b5-17305511c6b-0000-0000-01d-dbacd.mp4\" type=\"video/mp4\"></video></p><h3>竖向编辑</h3><p>在编辑多行时，如果我们需要编辑的内容都是纵向上同一个位置，就可以使用 Alt (macOS上是 Option）加上鼠标拖拽的方式来选择（或者尝试按下鼠标中键拖拽）。比如下图，当你选择了左侧的两个空格之后，可以批量编辑，比如修改成四个空格。将竖向编辑和刚刚上面说到的光标移动结合起来，会非常方便。</p><p><img src=\"https://static001.geekbang.org/resource/image/6a/ee/6a52fd04f915be6171f6fb39f4185fee.png?wh=820*738\" alt=\"\"></p><h2>在编辑器中使用正则</h2><p>正则是一种文本处理工具，常见的功能有文本验证、文本提取、文本替换、文本切割等。有一些地方说的正则匹配，其实是包括了校验和提取两个功能。</p><p>校验常用于验证整个文本的组成是不是符合规则，比如密码规则校验。提取则是从大段的文本中抽取出需要的内容，比如提取网页上所有的链接。在使用正则进行内容提取时，要做到不能提取到错误的内容（准确性），不能漏掉正确的内容（完备性）。这就要求我们写正则的时候尽量考虑周全。但是考虑周全并不容易，需要我们不断地练习、思考和总结。</p><h3>内容提取</h3><p>我以编辑器 Sublime Text 3 为例来进行讲解，下图是编辑器 Sublime Text 查找界面的介绍。</p><p><img src=\"https://static001.geekbang.org/resource/image/dd/2c/dd3362f28c66b8fabb279648e872042c.png?wh=1920*1051\" alt=\"\"></p><p>我们来尝试使用 sublime 提取文本中所有的邮箱地址，这里并不要求你写出一个完美的正则，因此演示时，使用<code>\\S+@\\S+\\.\\S+</code> 这个正则。另外我们可以加上环视，去掉尾部的分号。你可以<a href=\"http://www.zhongguosou.com/mailharddisk/mail_address_creator.aspx\">在这里</a>随机生成一些邮箱用于测试。</p><p><img src=\"https://static001.geekbang.org/resource/image/d1/fa/d19c306e136e48cce055c56888e54bfa.png?wh=1584*794\" alt=\"\"></p><p>你可能会有疑问，我直接找到最后的分号，然后删除掉不就可以了么？这个例子是没问题的，但如果文本中除了邮箱之外，还有其它的内容这样就不行了，这也是正则比普通文本强大的地方。</p><p><img src=\"https://static001.geekbang.org/resource/image/a1/dc/a18de0a5516ee9e6f65744840dbdf6dc.png?wh=1660*950\" alt=\"\"></p><h3>内容替换</h3><p>说完了查找，我们再来看一下替换。之前课程里我们也有讲过，这里再来回顾一下。下图是编辑器 Sublime Text 替换界面的介绍。</p><p><img src=\"https://static001.geekbang.org/resource/image/fa/a6/fa097dcb7ec8c647ed6c7204e30a76a6.png?wh=1426*1012\" alt=\"\"></p><p>同样是上面邮箱的例子，我们可以使用子组和引用，直接替换得到移除了分号之后的邮箱，我们还可以在邮箱前把邮箱类型加上。操作前和操作后的示意图如下：</p><p><img src=\"https://static001.geekbang.org/resource/image/91/8c/91cc91d71fa3deb371e8fc19d364d68c.png?wh=1584*794\" alt=\"\"></p><p><img src=\"https://static001.geekbang.org/resource/image/5f/18/5fdcd64731ece75da67e5f323665f018.png?wh=1584*794\" alt=\"\"></p><p>替换和提取的不同在于，替换可以对内容进行拼接和改造，而提取是从原来的内容中抽取出一个子集，不会改变原来的内容。当然在实际应用中，可以两个结合起来一起使用。</p><h3>内容验证</h3><p>在编辑器中进行内容验证，本质上和内容提取一样，只不过要求编辑器中全部内容都匹配上，并且匹配次数是一次。</p><p><img src=\"https://static001.geekbang.org/resource/image/bc/fc/bc4c8d5521dcff1cc39bc8e78bd819fc.png?wh=1326*688\" alt=\"\"></p><h3>内容切割</h3><p>在编辑器中进行内容切割，本质上也和内容提取一样，用什么切割，我们就提取什么，选中全部之后，把选中的内容删除掉或者编辑成其它的字符。</p><p><img src=\"https://static001.geekbang.org/resource/image/a8/5c/a815cb2ea9754ae41048668d82ca545c.png?wh=1326*688\" alt=\"\"></p><p>刚刚我们讲解了在 Sublime Text 中使用正则处理文本的方法，其它的编辑器或IDE，如 Atom、VS Code、JetBrains系列（IntelliJ IDEA/PyCharm/Goland等）等，也都是类似的，你可以在自己喜欢的编辑器中练习一下今天讲到的内容。</p><p>这里给出一些主流跨平台编辑器/IDE对正则的支持情况，你可以参考一下。</p><p><img src=\"https://static001.geekbang.org/resource/image/91/6b/91329d890437420a2eed55eef713yy6b.jpg?wh=762*808\" alt=\"\"></p><h2>总结</h2><p>好了，今天的内容讲完了，我来带你总结回顾一下。</p><p>今天我们学习了编辑器中一些提高文本处理效率的操作方式：光标移动和选择、多焦点编辑以及竖向编辑。学会了这些，即使不使用正则，我们在编辑器中处理文本效率也会大大提高。接着通过一些示例，我们学习了在编辑器中使用正则来进行文本内容提取，内容替换等操作。正则的使用一般会和其它的方法结合起来，最终帮助我们高效地完成文本的处理工作。</p><p>今天所讲的内容总结脑图如下，你可以回顾一下：</p><p><img src=\"https://static001.geekbang.org/resource/image/c7/be/c75e1165db7cafd9979551777cf72ebe.png?wh=1920*849\" alt=\"\"></p><h2>课后思考</h2><p>最后，我们来做一个小练习吧：统计一篇英文文章中每个单词出现的次数，使用Sublime Text 等编辑器提取文章里所有的单词，处理成一行一个单词，保存到文件中，然后再使用sort、uniq 等命令统计单词出现的次数。</p><p>为了帮你更好地完成这个任务，你可以参考一下下面的提示：</p><ol>\n<li>windows上的同学可以使用 <a href=\"https://gitforwindows.org/\">git for windows</a> 工具。</li>\n<li>使用 uniq 前需要先用 sort 命令排序，uniq -c 可以统计次数。</li>\n</ol><pre><code>sort words.txt | uniq -c\n如果想取前10名，可以继续对结果排序\nsort words.txt | uniq -c | sort -nrk1 | head -n10\n至于为什么要加 n、r 和 k1 你可以通过 man sort 看一下说明\n</code></pre><p>好，今天的课程就结束了，希望可以帮助到你，也希望你在下方的留言区和我参与讨论，并把文章分享给你的朋友或者同事，一起交流一下。</p>","neighbors":{"left":{"article_title":"08 | 应用1：正则如何处理 Unicode 编码的文本？","id":254642},"right":{"article_title":"10 | 应用3：如何在语言中用正则让文本处理能力上一个台阶？","id":257533}},"comments":[{"had_liked":false,"id":232195,"user_name":"William","can_delete":false,"product_type":"c1","uid":1241365,"ip_address":"","ucode":"4499F99B180102","user_header":"https://static001.geekbang.org/account/avatar/00/12/f1/15/8fcf8038.jpg","comment_is_top":false,"comment_ctime":1593916415,"is_pvip":true,"replies":[{"id":"85770","content":"赞，一顿操作猛如虎，直接不需要编辑器了。<br>其它同学要注意下，ggrep 是一个命令。<br>-o 是只打印匹配上的部分","user_name":"作者回复","comment_id":232195,"uid":"1112089","ip_address":"","utype":1,"ctime":1593999036,"user_name_real":"伟忠"}],"discussion_count":1,"race_medal":0,"score":"23068752895","product_id":100053301,"comment_content":"ggrep -Po &#39;[\\w\\.][\\w\\.\\,\\-]*\\b&#39; 09.words.txt | sort | uniq -c | sort -nr &gt; 09.cnts.txt<br><br>找了一篇infoQ的文章实验，开头可能会以 . 开头，如 .NET；","like_count":6,"discussions":[{"author":{"id":1112089,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f8/19/05a2695f.jpg","nickname":"伟忠","note":"","ucode":"FE77CF20ED6065","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500555,"discussion_content":"赞，一顿操作猛如虎，直接不需要编辑器了。\n其它同学要注意下，ggrep 是一个命令。\n-o 是只打印匹配上的部分","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593999036,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":231043,"user_name":"虹炎","can_delete":false,"product_type":"c1","uid":1600615,"ip_address":"","ucode":"9E28ACEBFB26D5","user_header":"https://static001.geekbang.org/account/avatar/00/18/6c/67/07bcc58f.jpg","comment_is_top":false,"comment_ctime":1593571144,"is_pvip":false,"replies":[{"id":"85375","content":"赞，总结的很好","user_name":"作者回复","comment_id":231043,"uid":"1112089","ip_address":"","utype":1,"ctime":1593621219,"user_name_real":"伟忠"}],"discussion_count":1,"race_medal":0,"score":"23068407624","product_id":100053301,"comment_content":"课后练习后总结：<br>uniq -c：   统计每行出现次数<br>sort :<br>\t-n  按数字排序<br>\t-r\t逆序排序<br>\t-k1\t根据-t的分割，分成几域，取第1个域排序<br>\t-t  指定分隔符，默认的分隔符为空白字符和非空白字符之间的空字符<br>head -n10： 取前10行数据","like_count":6,"discussions":[{"author":{"id":1112089,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f8/19/05a2695f.jpg","nickname":"伟忠","note":"","ucode":"FE77CF20ED6065","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500132,"discussion_content":"赞，总结的很好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593621219,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":231060,"user_name":"白了少年头","can_delete":false,"product_type":"c1","uid":1053084,"ip_address":"","ucode":"A65E00E05B23BA","user_header":"https://static001.geekbang.org/account/avatar/00/10/11/9c/4fd6ebe0.jpg","comment_is_top":false,"comment_ctime":1593572577,"is_pvip":false,"replies":[{"id":"85376","content":"对的，比喻的很形象","user_name":"作者回复","comment_id":231060,"uid":"1112089","ip_address":"","utype":1,"ctime":1593621276,"user_name_real":"伟忠"}],"discussion_count":1,"race_medal":0,"score":"14478474465","product_id":100053301,"comment_content":"我的理解是：正则表达式就像是内功，正则在高级语言和编辑器中的用法就像是外功招式，内功和外功要结合起来使用才能成为武林巅峰！","like_count":4,"discussions":[{"author":{"id":1112089,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f8/19/05a2695f.jpg","nickname":"伟忠","note":"","ucode":"FE77CF20ED6065","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500141,"discussion_content":"对的，比喻的很形象","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593621276,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":231150,"user_name":"wenxuan","can_delete":false,"product_type":"c1","uid":1171262,"ip_address":"","ucode":"36840291028D94","user_header":"https://static001.geekbang.org/account/avatar/00/11/df/3e/718d6f1b.jpg","comment_is_top":false,"comment_ctime":1593593938,"is_pvip":false,"replies":[{"id":"85472","content":"赞，一顿操作猛如虎啊。","user_name":"作者回复","comment_id":231150,"uid":"1112089","ip_address":"","utype":1,"ctime":1593703561,"user_name_real":"伟忠"}],"discussion_count":1,"race_medal":0,"score":"10183528530","product_id":100053301,"comment_content":"直接统计文章单词频次TOP10：<br>grep -Po &#39;\\w+&#39; article.txt | sort | uniq -c | sort -nr | head -10","like_count":3,"discussions":[{"author":{"id":1112089,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f8/19/05a2695f.jpg","nickname":"伟忠","note":"","ucode":"FE77CF20ED6065","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500177,"discussion_content":"赞，一顿操作猛如虎啊。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593703561,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":259679,"user_name":"Bug? Feature!","can_delete":false,"product_type":"c1","uid":1164531,"ip_address":"","ucode":"F8FA8A0094FBA0","user_header":"https://static001.geekbang.org/account/avatar/00/11/c4/f3/92f654f1.jpg","comment_is_top":false,"comment_ctime":1604808057,"is_pvip":false,"replies":[{"id":"94484","content":"一起努力！","user_name":"作者回复","comment_id":259679,"uid":"1112089","ip_address":"","utype":1,"ctime":1604963340,"user_name_real":"伟忠"}],"discussion_count":1,"race_medal":0,"score":"1604808057","product_id":100053301,"comment_content":"学会正则表达式，可以提高我们的工作效率，这个是毋庸置疑的，跟着老师一起打怪升级！","like_count":0,"discussions":[{"author":{"id":1112089,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f8/19/05a2695f.jpg","nickname":"伟忠","note":"","ucode":"FE77CF20ED6065","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509002,"discussion_content":"一起努力！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604963340,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":231280,"user_name":"134","can_delete":false,"product_type":"c1","uid":1785968,"ip_address":"","ucode":"869C2482D194F6","user_header":"https://static001.geekbang.org/account/avatar/00/1b/40/70/d14f653e.jpg","comment_is_top":false,"comment_ctime":1593623051,"is_pvip":false,"replies":[{"id":"86127","content":"可以的，这样就得到了一个文本，每行一个单词。<br>如果要考虑引号里面的看成一个整体，还可以再完善下。","user_name":"作者回复","comment_id":231280,"uid":"1112089","ip_address":"","utype":1,"ctime":1594313452,"user_name_real":"伟忠"}],"discussion_count":1,"race_medal":0,"score":"1593623051","product_id":100053301,"comment_content":"匹配正则：([^\\s]+\\s)<br>替换为:$1\\n","like_count":1,"discussions":[{"author":{"id":1112089,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f8/19/05a2695f.jpg","nickname":"伟忠","note":"","ucode":"FE77CF20ED6065","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500234,"discussion_content":"可以的，这样就得到了一个文本，每行一个单词。\n如果要考虑引号里面的看成一个整体，还可以再完善下。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594313452,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":231061,"user_name":"Robot","can_delete":false,"product_type":"c1","uid":1181473,"ip_address":"","ucode":"7215462D5AC0FA","user_header":"https://static001.geekbang.org/account/avatar/00/12/07/21/b3394aa2.jpg","comment_is_top":false,"comment_ctime":1593572817,"is_pvip":false,"replies":[{"id":"86105","content":"赞，动手练习是好习惯","user_name":"作者回复","comment_id":231061,"uid":"1112089","ip_address":"","utype":1,"ctime":1594310604,"user_name_real":"伟忠"}],"discussion_count":1,"race_medal":0,"score":"1593572817","product_id":100053301,"comment_content":"1、先处理文本为一行一个单词，编辑器为VS code<br><br>regext: \\W*\\b([’&#39;\\w-]+)\\b\\W*<br>substitude: $1\\n<br><br>2、处理文件输出top 10<br><br>cat result.txt | sort -fnrk1 | uniq -c | sort -nrk1 | head -n10","like_count":0,"discussions":[{"author":{"id":1112089,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f8/19/05a2695f.jpg","nickname":"伟忠","note":"","ucode":"FE77CF20ED6065","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500142,"discussion_content":"赞，动手练习是好习惯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594310604,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}