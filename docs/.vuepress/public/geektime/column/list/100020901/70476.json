{"id":70476,"title":"05 | 基础篇：某个应用的CPU使用率居然达到100%，我该怎么办？","content":"<p>你好，我是倪朋飞。</p><p>通过前两节对平均负载和 CPU 上下文切换的学习，我相信你对 CPU 的性能已经有了初步了解。不过我还是想问一下，在学这个专栏前，你最常用什么指标来描述系统的 CPU 性能呢？我想你的答案，可能不是平均负载，也不是 CPU 上下文切换，而是另一个更直观的指标—— CPU 使用率。</p><p>我们前面说过，CPU 使用率是单位时间内 CPU 使用情况的统计，以百分比的方式展示。那么，作为最常用也是最熟悉的 CPU 指标，你能说出 CPU 使用率到底是怎么算出来的吗？再有，诸如 top、ps 之类的性能工具展示的 %user、%nice、 %system、%iowait 、%steal 等等，你又能弄清楚它们之间的不同吗？</p><p>今天我就带你了解 CPU 使用率的内容，同时，我也会以我们最常用的反向代理服务器 Nginx 为例，带你在一步步操作和分析中深入理解。</p><h2>CPU 使用率</h2><p>在上一期我曾提到，Linux 作为一个多任务操作系统，将每个 CPU 的时间划分为很短的时间片，再通过调度器轮流分配给各个任务使用，因此造成多任务同时运行的错觉。</p><p>为了维护 CPU 时间，Linux 通过事先定义的节拍率（内核中表示为 HZ），触发时间中断，并使用全局变量 Jiffies 记录了开机以来的节拍数。每发生一次时间中断，Jiffies 的值就加 1。</p><!-- [[[read_end]]] --><p>节拍率 HZ 是内核的可配选项，可以设置为 100、250、1000 等。不同的系统可能设置不同数值，你可以通过查询 /boot/config 内核选项来查看它的配置值。比如在我的系统中，节拍率设置成了 250，也就是每秒钟触发 250 次时间中断。</p><pre><code>$ grep 'CONFIG_HZ=' /boot/config-$(uname -r)\nCONFIG_HZ=250\n</code></pre><p>同时，正因为节拍率 HZ 是内核选项，所以用户空间程序并不能直接访问。为了方便用户空间程序，内核还提供了一个用户空间节拍率 USER_HZ，它总是固定为 100，也就是1/100秒。这样，用户空间程序并不需要关心内核中 HZ 被设置成了多少，因为它看到的总是固定值 USER_HZ。</p><p>Linux 通过 /proc 虚拟文件系统，向用户空间提供了系统内部状态的信息，而 /proc/stat 提供的就是系统的 CPU 和任务统计信息。比方说，如果你只关注 CPU 的话，可以执行下面的命令：</p><pre><code># 只保留各个CPU的数据\n$ cat /proc/stat | grep ^cpu\ncpu  280580 7407 286084 172900810 83602 0 583 0 0 0\ncpu0 144745 4181 176701 86423902 52076 0 301 0 0 0\ncpu1 135834 3226 109383 86476907 31525 0 282 0 0 0\n</code></pre><p>这里的输出结果是一个表格。其中，第一列表示的是 CPU 编号，如cpu0、cpu1 ，而第一行没有编号的 cpu  ，表示的是所有 CPU 的累加。其他列则表示不同场景下 CPU 的累加节拍数，它的单位是 USER_HZ，也就是 10 ms（1/100秒），所以这其实就是不同场景下的 CPU 时间。</p><p>当然，这里每一列的顺序并不需要你背下来。你只要记住，有需要的时候，查询  man proc  就可以。不过，你要清楚man proc文档里每一列的涵义，它们都是CPU使用率相关的重要指标，你还会在很多其他的性能工具中看到它们。下面，我来依次解读一下。</p><ul>\n<li>\n<p>user（通常缩写为 us），代表用户态 CPU 时间。注意，它不包括下面的 nice 时间，但包括了 guest 时间。</p>\n</li>\n<li>\n<p>nice（通常缩写为 ni），代表低优先级用户态 CPU 时间，也就是进程的 nice 值被调整为 1-19 之间时的 CPU 时间。这里注意，nice 可取值范围是 -20 到 19，数值越大，优先级反而越低。</p>\n</li>\n<li>\n<p>system（通常缩写为sys），代表内核态 CPU 时间。</p>\n</li>\n<li>\n<p>idle（通常缩写为id），代表空闲时间。注意，它不包括等待 I/O 的时间（iowait）。</p>\n</li>\n<li>\n<p>iowait（通常缩写为 wa），代表等待 I/O 的 CPU 时间。</p>\n</li>\n<li>\n<p>irq（通常缩写为 hi），代表处理硬中断的 CPU 时间。</p>\n</li>\n<li>\n<p>softirq（通常缩写为 si），代表处理软中断的 CPU 时间。</p>\n</li>\n<li>\n<p>steal（通常缩写为 st），代表当系统运行在虚拟机中的时候，被其他虚拟机占用的 CPU 时间。</p>\n</li>\n<li>\n<p>guest（通常缩写为 guest），代表通过虚拟化运行其他操作系统的时间，也就是运行虚拟机的 CPU 时间。</p>\n</li>\n<li>\n<p>guest_nice（通常缩写为 gnice），代表以低优先级运行虚拟机的时间。</p>\n</li>\n</ul><p>而我们通常所说的 <strong>CPU 使用率，就是除了空闲时间外的其他时间占总 CPU 时间的百分比</strong>，用公式来表示就是：</p><p><img src=\"https://static001.geekbang.org/resource/image/3e/09/3edcc7f908c7c1ddba4bbcccc0277c09.png?wh=312*78\" alt=\"\"><br>\n根据这个公式，我们就可以从 /proc/stat 中的数据，很容易地计算出 CPU 使用率。当然，也可以用每一个场景的CPU时间，除以总的CPU时间，计算出每个场景的CPU使用率。</p><p>不过先不要着急计算，你能说出，直接用 /proc/stat 的数据，算的是什么时间段的 CPU 使用率吗？</p><p>看到这里，你应该想起来了，这是开机以来的节拍数累加值，所以直接算出来的，是开机以来的平均 CPU 使用率，一般没啥参考价值。</p><p>事实上，为了计算 CPU 使用率，性能工具一般都会取间隔一段时间（比如3秒）的两次值，作差后，再计算出这段时间内的平均 CPU 使用率，即</p><p><img src=\"https://static001.geekbang.org/resource/image/84/5a/8408bb45922afb2db09629a9a7eb1d5a.png?wh=569*85\" alt=\"\"></p><p>这个公式，就是我们用各种性能工具所看到的CPU 使用率的实际计算方法。</p><p>现在，我们知道了系统 CPU 使用率的计算方法，那进程的呢？跟系统的指标类似，Linux 也给每个进程提供了运行情况的统计信息，也就是 /proc/[pid]/stat。不过，这个文件包含的数据就比较丰富了，总共有 52 列的数据。</p><p>当然，不用担心，因为你并不需要掌握每一列的含义。还是那句话，需要的时候，查  man proc  就行。</p><p>回过头来看，是不是说要查看 CPU 使用率，就必须先读取 /proc/stat 和 /proc/[pid]/stat 这两个文件，然后再按照上面的公式计算出来呢？</p><p>当然不是，各种各样的性能分析工具已经帮我们计算好了。不过要注意的是，<strong>性能分析工具给出的都是间隔一段时间的平均 CPU 使用率，所以要注意间隔时间的设置</strong>，特别是用多个工具对比分析时，你一定要保证它们用的是相同的间隔时间。</p><p>比如，对比一下 top 和 ps 这两个工具报告的 CPU 使用率，默认的结果很可能不一样，因为 top 默认使用 3 秒时间间隔，而 ps 使用的却是进程的整个生命周期。</p><h2>怎么查看 CPU 使用率</h2><p>知道了 CPU 使用率的含义后，我们再来看看要怎么查看 CPU 使用率。说到查看 CPU 使用率的工具，我猜你第一反应肯定是  top 和 ps。的确，top 和 ps 是最常用的性能分析工具：</p><ul>\n<li>\n<p>top 显示了系统总体的 CPU 和内存使用情况，以及各个进程的资源使用情况。</p>\n</li>\n<li>\n<p>ps 则只显示了每个进程的资源使用情况。</p>\n</li>\n</ul><p>比如，top 的输出格式为：</p><pre><code># 默认每3秒刷新一次\n$ top\ntop - 11:58:59 up 9 days, 22:47,  1 user,  load average: 0.03, 0.02, 0.00\nTasks: 123 total,   1 running,  72 sleeping,   0 stopped,   0 zombie\n%Cpu(s):  0.3 us,  0.3 sy,  0.0 ni, 99.3 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st\nKiB Mem :  8169348 total,  5606884 free,   334640 used,  2227824 buff/cache\nKiB Swap:        0 total,        0 free,        0 used.  7497908 avail Mem\n\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n    1 root      20   0   78088   9288   6696 S   0.0  0.1   0:16.83 systemd\n    2 root      20   0       0      0      0 S   0.0  0.0   0:00.05 kthreadd\n    4 root       0 -20       0      0      0 I   0.0  0.0   0:00.00 kworker/0:0H\n...\n</code></pre><p>这个输出结果中，第三行 %Cpu 就是系统的 CPU 使用率，具体每一列的含义上一节都讲过，只是把CPU时间变换成了CPU使用率，我就不再重复讲了。不过需要注意，top 默认显示的是所有 CPU 的平均值，这个时候你只需要按下数字 1 ，就可以切换到每个 CPU 的使用率了。</p><p>继续往下看，空白行之后是进程的实时信息，每个进程都有一个 %CPU 列，表示进程的 CPU 使用率。它是用户态和内核态 CPU 使用率的总和，包括进程用户空间使用的 CPU、通过系统调用执行的内核空间 CPU 、以及在就绪队列等待运行的 CPU。在虚拟化环境中，它还包括了运行虚拟机占用的 CPU。</p><p>所以，到这里我们可以发现， top 并没有细分进程的用户态CPU和内核态 CPU。那要怎么查看每个进程的详细情况呢？你应该还记得上一节用到的  pidstat  吧，它正是一个专门分析每个进程 CPU 使用情况的工具。</p><p>比如，下面的pidstat命令，就间隔1秒展示了进程的5组CPU使用率，包括：</p><ul>\n<li>\n<p>用户态CPU使用率 （%usr）；</p>\n</li>\n<li>\n<p>内核态CPU使用率（%system）；</p>\n</li>\n<li>\n<p>运行虚拟机CPU使用率（%guest）；</p>\n</li>\n<li>\n<p>等待 CPU使用率（%wait）；</p>\n</li>\n<li>\n<p>以及总的CPU使用率（%CPU）。</p>\n</li>\n</ul><p>最后的 Average 部分，还计算了 5 组数据的平均值。</p><pre><code># 每隔1秒输出一组数据，共输出5组\n$ pidstat 1 5\n15:56:02      UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command\n15:56:03        0     15006    0.00    0.99    0.00    0.00    0.99     1  dockerd\n\n...\n\nAverage:      UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command\nAverage:        0     15006    0.00    0.99    0.00    0.00    0.99     -  dockerd\n</code></pre><h2>CPU 使用率过高怎么办？</h2><p>通过 top、ps、pidstat 等工具，你能够轻松找到 CPU 使用率较高（比如 100% ）的进程。接下来，你可能又想知道，占用 CPU 的到底是代码里的哪个函数呢？找到它，你才能更高效、更针对性地进行优化。</p><p>我猜你第一个想到的，应该是 GDB（The GNU Project Debugger）， 这个功能强大的程序调试利器。的确，GDB 在调试程序错误方面很强大。但是，我又要来“挑刺”了。请你记住，GDB 并不适合在性能分析的早期应用。</p><p>为什么呢？因为 GDB 调试程序的过程会中断程序运行，这在线上环境往往是不允许的。所以，GDB 只适合用在性能分析的后期，当你找到了出问题的大致函数后，线下再借助它来进一步调试函数内部的问题。</p><p>那么哪种工具适合在第一时间分析进程的 CPU 问题呢？我的推荐是 perf。perf 是 Linux 2.6.31 以后内置的性能分析工具。它以性能事件采样为基础，不仅可以分析系统的各种事件和内核性能，还可以用来分析指定应用程序的性能问题。</p><p>使用 perf 分析 CPU 性能问题，我来说两种最常见、也是我最喜欢的用法。</p><p>第一种常见用法是 perf top，类似于 top，它能够实时显示占用 CPU 时钟最多的函数或者指令，因此可以用来查找热点函数，使用界面如下所示：</p><pre><code>$ perf top\nSamples: 833  of event 'cpu-clock', Event count (approx.): 97742399\nOverhead  Shared Object       Symbol\n   7.28%  perf                [.] 0x00000000001f78a4\n   4.72%  [kernel]            [k] vsnprintf\n   4.32%  [kernel]            [k] module_get_kallsym\n   3.65%  [kernel]            [k] _raw_spin_unlock_irqrestore\n...\n</code></pre><p>输出结果中，第一行包含三个数据，分别是采样数（Samples）、事件类型（event）和事件总数量（Event count）。比如这个例子中，perf 总共采集了 833 个 CPU 时钟事件，而总事件数则为 97742399。</p><p>另外，<strong>采样数需要我们特别注意</strong>。如果采样数过少（比如只有十几个），那下面的排序和百分比就没什么实际参考价值了。</p><p>再往下看是一个表格式样的数据，每一行包含四列，分别是：</p><ul>\n<li>\n<p>第一列 Overhead ，是该符号的性能事件在所有采样中的比例，用百分比来表示。</p>\n</li>\n<li>\n<p>第二列 Shared ，是该函数或指令所在的动态共享对象（Dynamic Shared Object），如内核、进程名、动态链接库名、内核模块名等。</p>\n</li>\n<li>\n<p>第三列 Object ，是动态共享对象的类型。比如 [.] 表示用户空间的可执行程序、或者动态链接库，而 [k] 则表示内核空间。</p>\n</li>\n<li>\n<p>最后一列 Symbol 是符号名，也就是函数名。当函数名未知时，用十六进制的地址来表示。</p>\n</li>\n</ul><p>还是以上面的输出为例，我们可以看到，占用 CPU 时钟最多的是 perf 工具自身，不过它的比例也只有 7.28%，说明系统并没有 CPU 性能问题。 perf top的使用你应该很清楚了吧。</p><p>接着再来看第二种常见用法，也就是 perf record 和 perf report。 perf top 虽然实时展示了系统的性能信息，但它的缺点是并不保存数据，也就无法用于离线或者后续的分析。而 perf record 则提供了保存数据的功能，保存后的数据，需要你用 perf report 解析展示。</p><pre><code>$ perf record # 按Ctrl+C终止采样\n[ perf record: Woken up 1 times to write data ]\n[ perf record: Captured and wrote 0.452 MB perf.data (6093 samples) ]\n\n$ perf report # 展示类似于perf top的报告\n</code></pre><p>在实际使用中，我们还经常为 perf top 和 perf record 加上 -g 参数，开启调用关系的采样，方便我们根据调用链来分析性能问题。</p><h2>案例</h2><p>下面我们就以 Nginx + PHP 的 Web 服务为例，来看看当你发现 CPU 使用率过高的问题后，要怎么使用 top 等工具找出异常的进程，又要怎么利用 perf 找出引发性能问题的函数。</p><h3>你的准备</h3><p>以下案例基于 Ubuntu 18.04，同样适用于其他的 Linux 系统。我使用的案例环境如下所示：</p><ul>\n<li>\n<p>机器配置：2 CPU，8GB 内存</p>\n</li>\n<li>\n<p>预先安装 docker、sysstat、perf、ab 等工具，如 apt install docker.io sysstat linux-tools-common apache2-utils</p>\n</li>\n</ul><p>我先简单介绍一下这次新使用的工具 ab。ab（apache bench）是一个常用的 HTTP 服务性能测试工具，这里用来模拟 Ngnix 的客户端。由于 Nginx 和 PHP 的配置比较麻烦，我把它们打包成了两个 <a href=\"https://github.com/feiskyer/linux-perf-examples/tree/master/nginx-high-cpu\">Docker 镜像</a>，这样只需要运行两个容器，就可以得到模拟环境。</p><p>注意，这个案例要用到两台虚拟机，如下图所示：</p><p><img src=\"https://static001.geekbang.org/resource/image/90/3d/90c30b4f555218f77241bfe2ac27723d.png?wh=408*258\" alt=\"\"></p><p>你可以看到，其中一台用作 Web 服务器，来模拟性能问题；另一台用作 Web 服务器的客户端，来给 Web 服务增加压力请求。使用两台虚拟机是为了相互隔离，避免“交叉感染”。</p><p>接下来，我们打开两个终端，分别 SSH 登录到两台机器上，并安装上面提到的工具。</p><p>还是同样的“配方”。下面的所有命令，都默认假设以 root 用户运行，如果你是普通用户身份登陆系统，一定要先运行 sudo su root 命令切换到 root 用户。到这里，准备工作就完成了。</p><p>不过，操作之前，我还想再说一点。这次案例中 PHP 应用的核心逻辑比较简单，大部分人一眼就可以看出问题，但你要知道，实际生产环境中的源码就复杂多了。</p><p>所以，我希望你在按照步骤操作之前，先不要查看源码（避免先入为主），而是<strong>把它当成一个黑盒来分析。</strong>这样，你可以更好地理解整个解决思路，怎么从系统的资源使用问题出发，分析出瓶颈所在的应用、以及瓶颈在应用中的大概位置。</p><h3>操作和分析</h3><p>接下来，我们正式进入操作环节。</p><p>首先，在第一个终端执行下面的命令来运行 Nginx 和 PHP 应用：</p><pre><code>$ docker run --name nginx -p 10000:80 -itd feisky/nginx\n$ docker run --name phpfpm -itd --network container:nginx feisky/php-fpm\n</code></pre><p>然后，在第二个终端使用 curl 访问 http://[VM1的IP]:10000，确认 Nginx 已正常启动。你应该可以看到 It works! 的响应。</p><pre><code># 192.168.0.10是第一台虚拟机的IP地址\n$ curl http://192.168.0.10:10000/\nIt works!\n</code></pre><p>接着，我们来测试一下这个 Nginx 服务的性能。在第二个终端运行下面的 ab 命令：</p><pre><code># 并发10个请求测试Nginx性能，总共测试100个请求\n$ ab -c 10 -n 100 http://192.168.0.10:10000/\nThis is ApacheBench, Version 2.3 &lt;$Revision: 1706008 $&gt;\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, \n...\nRequests per second:    11.63 [#/sec] (mean)\nTime per request:       859.942 [ms] (mean)\n...\n</code></pre><p>从ab的输出结果我们可以看到，Nginx能承受的每秒平均请求数只有 11.63。你一定在吐槽，这也太差了吧。那到底是哪里出了问题呢？我们用 top 和 pidstat 再来观察下。</p><p>这次，我们在第二个终端，将测试的请求总数增加到 10000。这样当你在第一个终端使用性能分析工具时， Nginx 的压力还是继续。</p><p>继续在第二个终端，运行 ab 命令：</p><pre><code>$ ab -c 10 -n 10000 http://192.168.0.10:10000/\n</code></pre><p>接着，回到第一个终端运行 top 命令，并按下数字 1 ，切换到每个 CPU 的使用率：</p><pre><code>$ top\n...\n%Cpu0  : 98.7 us,  1.3 sy,  0.0 ni,  0.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st\n%Cpu1  : 99.3 us,  0.7 sy,  0.0 ni,  0.0 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st\n...\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\n21514 daemon    20   0  336696  16384   8712 R  41.9  0.2   0:06.00 php-fpm\n21513 daemon    20   0  336696  13244   5572 R  40.2  0.2   0:06.08 php-fpm\n21515 daemon    20   0  336696  16384   8712 R  40.2  0.2   0:05.67 php-fpm\n21512 daemon    20   0  336696  13244   5572 R  39.9  0.2   0:05.87 php-fpm\n21516 daemon    20   0  336696  16384   8712 R  35.9  0.2   0:05.61 php-fpm\n</code></pre><p>这里可以看到，系统中有几个 php-fpm 进程的 CPU 使用率加起来接近 200%；而每个 CPU 的用户使用率（us）也已经超过了 98%，接近饱和。这样，我们就可以确认，正是用户空间的 php-fpm 进程，导致CPU 使用率骤升。</p><p>那再往下走，怎么知道是 php-fpm 的哪个函数导致了 CPU 使用率升高呢？我们来用 perf 分析一下。在第一个终端运行下面的perf命令：</p><pre><code># -g开启调用关系分析，-p指定php-fpm的进程号21515\n$ perf top -g -p 21515\n</code></pre><p>按方向键切换到 php-fpm，再按下回车键展开 php-fpm 的调用关系，你会发现，调用关系最终到了 sqrt 和 add_function。看来，我们需要从这两个函数入手了。</p><p><img src=\"https://static001.geekbang.org/resource/image/6e/10/6e58d2f7b1ace94501b1833bab16f210.png?wh=1172*482\" alt=\"\"></p><p>我们拷贝出 <a href=\"https://github.com/feiskyer/linux-perf-examples/blob/master/nginx-high-cpu/app/index.php\">Nginx 应用的源码</a>，看看是不是调用了这两个函数：</p><pre><code># 从容器phpfpm中将PHP源码拷贝出来\n$ docker cp phpfpm:/app .\n\n# 使用grep查找函数调用\n$ grep sqrt -r app/ #找到了sqrt调用\napp/index.php:  $x += sqrt($x);\n$ grep add_function -r app/ #没找到add_function调用，这其实是PHP内置函数\n</code></pre><p>OK，原来只有 sqrt 函数在 app/index.php 文件中调用了。那最后一步，我们就该看看这个文件的源码了：</p><pre><code>$ cat app/index.php\n&lt;?php\n// test only.\n$x = 0.0001;\nfor ($i = 0; $i &lt;= 1000000; $i++) {\n  $x += sqrt($x);\n}\n\necho &quot;It works!&quot;\n</code></pre><p>呀，有没有发现问题在哪里呢？我想你要笑话我了，居然犯了一个这么傻的错误，测试代码没删就直接发布应用了。为了方便你验证优化后的效果，我把修复后的应用也打包成了一个Docker镜像，你可以在第一个终端中执行下面的命令来运行它：</p><pre><code># 停止原来的应用\n$ docker rm -f nginx phpfpm\n# 运行优化后的应用\n$ docker run --name nginx -p 10000:80 -itd feisky/nginx:cpu-fix\n$ docker run --name phpfpm -itd --network container:nginx feisky/php-fpm:cpu-fix\n</code></pre><p>接着，到第二个终端来验证一下修复后的效果。首先Ctrl+C停止之前的ab命令后，再运行下面的命令：</p><pre><code>$ ab -c 10 -n 10000 http://10.240.0.5:10000/\n...\nComplete requests:      10000\nFailed requests:        0\nTotal transferred:      1720000 bytes\nHTML transferred:       90000 bytes\nRequests per second:    2237.04 [#/sec] (mean)\nTime per request:       4.470 [ms] (mean)\nTime per request:       0.447 [ms] (mean, across all concurrent requests)\nTransfer rate:          375.75 [Kbytes/sec] received\n...\n</code></pre><p>从这里你可以发现，现在每秒的平均请求数，已经从原来的11变成了2237。</p><p>你看，就是这么很傻的一个小问题，却会极大的影响性能，并且查找起来也并不容易吧。当然，找到问题后，解决方法就简单多了，删除测试代码就可以了。</p><h2>小结</h2><p>CPU 使用率是最直观和最常用的系统性能指标，更是我们在排查性能问题时，通常会关注的第一个指标。所以我们更要熟悉它的含义，尤其要弄清楚用户（%user）、Nice（%nice）、系统（%system） 、等待 I/O（%iowait） 、中断（%irq）以及软中断（%softirq）这几种不同 CPU 的使用率。比如说：</p><ul>\n<li>\n<p>用户 CPU 和 Nice CPU 高，说明用户态进程占用了较多的 CPU，所以应该着重排查进程的性能问题。</p>\n</li>\n<li>\n<p>系统 CPU 高，说明内核态占用了较多的 CPU，所以应该着重排查内核线程或者系统调用的性能问题。</p>\n</li>\n<li>\n<p>I/O 等待 CPU 高，说明等待 I/O 的时间比较长，所以应该着重排查系统存储是不是出现了 I/O 问题。</p>\n</li>\n<li>\n<p>软中断和硬中断高，说明软中断或硬中断的处理程序占用了较多的 CPU，所以应该着重排查内核中的中断服务程序。</p>\n</li>\n</ul><p>碰到 CPU 使用率升高的问题，你可以借助 top、pidstat 等工具，确认引发 CPU 性能问题的来源；再使用 perf 等工具，排查出引起性能问题的具体函数。</p><h2>思考</h2><p>最后，我想邀请你一起来聊聊，你所理解的 CPU 使用率，以及在发现 CPU 使用率升高时，你又是怎么分析的呢？你可以结合今天的内容，和你自己的操作记录，来总结思路。</p><p>欢迎在留言区和我讨论，也欢迎把这篇文章分享给你的同事、朋友。我们一起在实战中演练，在交流中进步。</p><p><img src=\"https://static001.geekbang.org/resource/image/56/52/565d66d658ad23b2f4997551db153852.jpg?wh=1110*549\" alt=\"\"></p>","neighbors":{"left":{"article_title":"04 | 基础篇：经常说的 CPU 上下文切换是什么意思？（下）","id":70077},"right":{"article_title":"06 | 案例篇：系统的 CPU 使用率很高，但为啥却找不到高 CPU 的应用？","id":70822}},"comments":[{"had_liked":false,"id":46197,"user_name":"每天晒白牙","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1543883154,"is_pvip":false,"discussion_count":23,"race_medal":1,"score":"886307146130","product_id":100020901,"comment_content":"【D5补卡】<br>我的系统是centos7，上次实战用 perf top -g -p pid没有看到函数名称，只能看到一堆十六进制的东西，然后老师给了解决方法，我转述下：<br>分析：当没有看到函数名称，只看到了十六进制符号，下面有Failed to open &#47;usr&#47;lib&#47;x86_64-linux-gnu&#47;libxml2.so.2.9.4, continuing without symbols  这说明perf无法找到待分析进程所依赖的库。这里只显示了一个，但其实依赖的库还有很多。这个问题其实是在分析Docker容器应用时经常会碰到的一个问题，因为容器应用所依赖的库都在镜像里面。<br><br>老师给了两个解决思路：<br>（1）在容器外面构建相同路径的依赖库。这种方法不推荐，一是因为找出这些依赖比较麻烦，更重要的是构建这些路径会污染虚拟机的环境。<br>（2）在容器外面把分析纪录保存下来，到容器里面再去查看结果，这样库和符号的路径就都是对的了。<br><br>操作：<br>（1）在Centos系统上运行 perf record -g -p &lt;pid&gt;，执行一会儿（比如15秒）按ctrl+c停止<br>（2）把生成的 perf.data（这个文件生成在执行命令的当前目录下，当然也可以通过查找它的路径 find | grep perf.data或 find &#47; -name perf.data）文件拷贝到容器里面分析:<br>docker cp perf.data phpfpm:&#47;tmp<br>docker exec -i -t phpfpm bash<br>$ cd &#47;tmp&#47;<br>$ apt-get update &amp;&amp; apt-get install -y linux-perf linux-tools procps<br>$ perf_4.9 report<br><br>注意：最后运行的工具名字是容器内部安装的版本 perf_4.9，而不是 perf 命令，这是因为 perf 会去跟内核的版本进行匹配，但镜像里面安装的perf版本有可能跟虚拟机的内核版本不一致。<br>注意：上面的问题只是在centos系统中有问题，ubuntu上没有这个问题","like_count":207,"discussions":[{"author":{"id":1169422,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d8/0e/1bf7f57a.jpg","nickname":"🎉晶晶🎉😄","note":"","ucode":"76B608C42E06A8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":409288,"discussion_content":"只能显示excute_ex、add_function，展开也没有显示sqrt，有遇到同样问题的吗？","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1635409718,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1298046,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKZicicibGibtR5zAia782Ajc5I5BN3F3tjAdlibATIknHv67gbxeH21N7B6vbgwLjYb1miaLKhqicptB5ibYw/132","nickname":"阿飞","note":"","ucode":"F8B1FC8521264D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":271323,"discussion_content":"然而centos7.5中的docker无法安装linux-tools","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1590116397,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2348507,"avatar":"https://static001.geekbang.org/account/avatar/00/23/d5/db/f59b288b.jpg","nickname":"面对疾风吧","note":"","ucode":"FB87423BB7AEE7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1298046,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKZicicibGibtR5zAia782Ajc5I5BN3F3tjAdlibATIknHv67gbxeH21N7B6vbgwLjYb1miaLKhqicptB5ibYw/132","nickname":"阿飞","note":"","ucode":"F8B1FC8521264D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":331437,"discussion_content":"老哥最终怎么解决得。我也遇到了这个问题，求联系方式","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606875329,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":271323,"ip_address":""},"score":331437,"extra":""}]},{"author":{"id":1226656,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b7/a0/9ed1934c.jpg","nickname":"Carson","note":"","ucode":"694BBF6D3BB73F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":72594,"discussion_content":"docker是共享内核的，怎么会内核版本不一致","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1575507333,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1284984,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKVqBf4Tkj2OtdziaIKlJJf6RVpZ8LmbPibg47Ba4wiaW5zXecpYYn5oKTrzhOJ6L5H2Yv7cqLSODiazA/132","nickname":"h1z3y3","note":"","ucode":"AD0B626CF56A9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387838,"discussion_content":"何不直接进入容器然后执行 `perf top`，没必要在宿主机先生成报告再拷贝到容器；\n需要注意的是，要使用 perf，启动 docker 的时候增加 `--privileged` 参数","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1628444796,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2445109,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/eqhTVsXo1lTsRfPCmHriabsibw2HQIny7qP2zRhfU46aicibzXzP1Dt8X6icSyZSPCTtIQIfrdBwqPwVKLsH2X8pN1w/132","nickname":"Geek_493455","note":"","ucode":"EA800B8154E616","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1284984,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKVqBf4Tkj2OtdziaIKlJJf6RVpZ8LmbPibg47Ba4wiaW5zXecpYYn5oKTrzhOJ6L5H2Yv7cqLSODiazA/132","nickname":"h1z3y3","note":"","ucode":"AD0B626CF56A9A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389089,"discussion_content":"试一下就知道了，因为perf需要收集/proc/下的信息，普通进程没有权限","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1629114584,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":387838,"ip_address":""},"score":389089,"extra":""}]},{"author":{"id":1565396,"avatar":"https://static001.geekbang.org/account/avatar/00/17/e2/d4/ef86ea64.jpg","nickname":"Front","note":"","ucode":"35593EA52F2EA6","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302571,"discussion_content":"我的环境是ubuntu18.04，perf是5.4.44，docker里的perf_4.9是无法打开虚拟机生成的perf.data，因为版本太低。请问这种情况如何 处理？谢谢","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1598963700,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2593667,"avatar":"https://static001.geekbang.org/account/avatar/00/27/93/83/cb37c46e.jpg","nickname":"cshzet","note":"","ucode":"A343CCB6E5D519","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1565396,"avatar":"https://static001.geekbang.org/account/avatar/00/17/e2/d4/ef86ea64.jpg","nickname":"Front","note":"","ucode":"35593EA52F2EA6","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":567693,"discussion_content":"如何解决，老哥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650976853,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":302571,"ip_address":""},"score":567693,"extra":""}]},{"author":{"id":1298046,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKZicicibGibtR5zAia782Ajc5I5BN3F3tjAdlibATIknHv67gbxeH21N7B6vbgwLjYb1miaLKhqicptB5ibYw/132","nickname":"阿飞","note":"","ucode":"F8B1FC8521264D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":271102,"discussion_content":"php docker是基于debian 的buster版本，鉴于国内使用国外apt源叫慢，所以先更新源（清华源：https://mirrors.tuna.tsinghua.edu.cn/help/debian/）\n命令如下：\ncat << EOF > /etc/apt/sources.list\n# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释\ndeb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster main contrib non-free\ndeb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-updates main contrib non-free\ndeb https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/debian/ buster-backports main contrib non-free\ndeb https://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free\n# deb-src https://mirrors.tuna.tsinghua.edu.cn/debian-security buster/updates main contrib non-free\nEOF\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1590076348,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1284474,"avatar":"https://static001.geekbang.org/account/avatar/00/13/99/7a/558666a5.jpg","nickname":"AceslupK","note":"","ucode":"048F84D019CBBB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":387249,"discussion_content":"非常感谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1628072181,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1281585,"avatar":"https://static001.geekbang.org/account/avatar/00/13/8e/31/28972804.jpg","nickname":"阿海","note":"","ucode":"2589431F840C42","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375440,"discussion_content":"老哥，按照你的说明，centos7  确实可以看到add_function, sqrt了，多谢哈","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621656396,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1082187,"avatar":"https://static001.geekbang.org/account/avatar/00/10/83/4b/0e96fcae.jpg","nickname":"sky","note":"","ucode":"FC323371453C97","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1281585,"avatar":"https://static001.geekbang.org/account/avatar/00/13/8e/31/28972804.jpg","nickname":"阿海","note":"","ucode":"2589431F840C42","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":377806,"discussion_content":"我这有 add_function 就是不显示 sqrt 啊…  醉了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1622873834,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":375440,"ip_address":""},"score":377806,"extra":""}]},{"author":{"id":1263977,"avatar":"https://static001.geekbang.org/account/avatar/00/13/49/69/c0fcf4e8.jpg","nickname":"def","note":"","ucode":"39BDBEA0560C13","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362017,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616826942,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1259323,"avatar":"https://static001.geekbang.org/account/avatar/00/13/37/3b/495e2ce6.jpg","nickname":"陈斯佳","note":"","ucode":"C236F874FC767A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":356158,"discussion_content":"感谢分享！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615542309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2416022,"avatar":"https://static001.geekbang.org/account/avatar/00/24/dd/96/8677254c.jpg","nickname":"承","note":"","ucode":"31E425788BA852","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343611,"discussion_content":"感谢这位老哥，好人一生平安","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611111358,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1705468,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/05/fc/bceb3f2b.jpg","nickname":"开心哥","note":"","ucode":"D44C1F03B23C5A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":330107,"discussion_content":"centos 得救了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606532405,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1145779,"avatar":"https://static001.geekbang.org/account/avatar/00/11/7b/b3/194f7f90.jpg","nickname":"没伞的孩子得使劲奔跑","note":"","ucode":"D015B4EF12E536","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":275483,"discussion_content":"老哥，不错，不过docker容器内核，我印象中是和物理机是保持一致的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590720461,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1070101,"avatar":"https://static001.geekbang.org/account/avatar/00/10/54/15/38e479cc.jpg","nickname":"变量","note":"","ucode":"9E65BB381C6871","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":250729,"discussion_content":"请问下老师，线上环境centos7运行容器，cpu持续上涨到达100%，这块有没有分析思路，谢谢！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588037310,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1606177,"avatar":"","nickname":"程序员老万","note":"","ucode":"061269EFE23EC4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2910,"discussion_content":"我在docker容器内安装了perf，然后perf report显示出来的还是16进制地址,不知道啥原因？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564033734,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1313331,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/0OaV2KicIgpZdNYqIyqcM1YWo4lxPnetXXf2zvibyicibXB4FcyT9P93QecHz2StqZu7vwLJIOSTPvuokLWXQsunEA/132","nickname":"一颗心的思考","note":"","ucode":"1F184F9BD8E2CD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1606177,"avatar":"","nickname":"程序员老万","note":"","ucode":"061269EFE23EC4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294600,"discussion_content":"我的也是","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595939020,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":2910,"ip_address":""},"score":294600,"extra":""},{"author":{"id":1316682,"avatar":"https://static001.geekbang.org/account/avatar/00/14/17/4a/d8fd5563.jpg","nickname":"记忆","note":"","ucode":"503DBE662BF544","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1313331,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/0OaV2KicIgpZdNYqIyqcM1YWo4lxPnetXXf2zvibyicibXB4FcyT9P93QecHz2StqZu7vwLJIOSTPvuokLWXQsunEA/132","nickname":"一颗心的思考","note":"","ucode":"1F184F9BD8E2CD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312924,"discussion_content":"编译加-g试试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602854609,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":294600,"ip_address":""},"score":312924,"extra":""},{"author":{"id":1394115,"avatar":"https://static001.geekbang.org/account/avatar/00/15/45/c3/051ffe83.jpg","nickname":"rubys_","note":"","ucode":"931AD02864126A","race_medal":5,"user_type":1,"is_pvip":true},"reply_author":{"id":1606177,"avatar":"","nickname":"程序员老万","note":"","ucode":"061269EFE23EC4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368817,"discussion_content":"我的也是","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618838822,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":2910,"ip_address":""},"score":368817,"extra":""}]},{"author":{"id":1574062,"avatar":"https://static001.geekbang.org/account/avatar/00/18/04/ae/0118c132.jpg","nickname":"辉晖","note":"","ucode":"E5EC033EE4952B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":258,"discussion_content":"我这样操作了，还是只显示十六进制的。Cannot load tips.txt file, please install perf明明是安装的了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561364609,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44993,"user_name":"D白菜","can_delete":false,"product_type":"c1","uid":1304391,"ip_address":"","ucode":"8DC343172AB781","user_header":"https://static001.geekbang.org/account/avatar/00/13/e7/47/d0715205.jpg","comment_is_top":false,"comment_ctime":1543538225,"is_pvip":false,"replies":[{"id":"16093","content":"👍 课代表的总结很全面","user_name":"作者回复","comment_id":44993,"uid":"1001282","ip_address":"","utype":1,"ctime":1543589020,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"383795627569","product_id":100020901,"comment_content":"Day 5，干活满满啊，谢谢老师啊。<br>今天总结如下：<br>1、Linux并发(任务并行)的实质：Linux 作为一个多任务操作系统，将每个 CPU 的时间划分为很短的时间片，再通过调度器轮流分配给各个任务使用<br>2、cpu的维护，通过实先定义的节拍率(内核用赫兹HZ标示)触发时间判断(全局变量jiffies记录)。<br>3、节拍率是内核态运行，属于内核空间节拍率；用户空间节拍率( USER_HZ)是一个固定设置<br>[root@dbayang ~]# grep &#39;CONFIG_HZ=&#39; &#47;boot&#47;config-$(uname -r)<br>CONFIG_HZ=1000<br>4、&#47;proc&#47;stat 提供的就是系统的 CPU 和任务统计信息； &#47;proc&#47;[pid]&#47;stat展示进程的CPU和任务统计信息<br>5、cpu的使用率={1-(idle_time&#47;total_cpu_time)}&#47;sample_time<br>6、性能分析工具给出的都是间隔一段时间的平均 CPU 使用率，所以要注意间隔时间的设置。top默认为3s，ps使用的是进程运行时间。<br>7、top、vmstat、mpstat等命令种关于cpu性能相关指标的含义<br>8、pidstat命令含义<br>9、perf<br>       以前用到的一堆[n]trace分析工具，perf的直观易用，这是今天最大的收获，作为dba对数据库的分析也很有的，么么哒。<br>perf top、perf record、perf report<br>对进程进行跟踪分析其调用perf top -g -p &lt;mysqlpid&gt;<br>10、今天用到测试工具：ab","like_count":90,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430890,"discussion_content":"👍 课代表的总结很全面","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543589020,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45218,"user_name":"zeroxus","can_delete":false,"product_type":"c1","uid":1058002,"ip_address":"","ucode":"9DBB3A81F01792","user_header":"https://static001.geekbang.org/account/avatar/00/10/24/d2/40353046.jpg","comment_is_top":false,"comment_ctime":1543561632,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"254946632096","product_id":100020901,"comment_content":"【D5】打卡<br>干货满满<br>使用Markdown整理成了笔记， 配合目录查回顾，会方便很多<br>https:&#47;&#47;www.zybuluo.com&#47;Gugoole&#47;note&#47;1354842","like_count":59},{"had_liked":false,"id":45138,"user_name":"不纯有机物","can_delete":false,"product_type":"c1","uid":1135358,"ip_address":"","ucode":"430C0C2873B591","user_header":"https://static001.geekbang.org/account/avatar/00/11/52/fe/df362d52.jpg","comment_is_top":false,"comment_ctime":1543549448,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"156162372104","product_id":100020901,"comment_content":"老师，我的也是无法定位到具体的函数，都是16进制显示的","like_count":37,"discussions":[{"author":{"id":2066801,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/W0VEO7Hxzd61mia6Ls2EpBmaZ0l9q7SFUAErbu4XKIjWLmlALr4ybpicDoI8SoXY8XJNKmk04Ep1ibTCuFvfCF8GQ/132","nickname":"Chen","note":"","ucode":"5D0F3DF807706E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":324656,"discussion_content":"同情况，请问同学有解决方法了吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605148995,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":2066801,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/W0VEO7Hxzd61mia6Ls2EpBmaZ0l9q7SFUAErbu4XKIjWLmlALr4ybpicDoI8SoXY8XJNKmk04Ep1ibTCuFvfCF8GQ/132","nickname":"Chen","note":"","ucode":"5D0F3DF807706E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375081,"discussion_content":"CentOS 8 的虚拟机做这个实验，用 record 之后的数据 report，可以定位到函数名了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621476716,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":324656,"ip_address":""},"score":375081,"extra":""}]}]},{"had_liked":false,"id":45654,"user_name":"樊海涛","can_delete":false,"product_type":"c1","uid":1323249,"ip_address":"","ucode":"0B04D5985EE0E1","user_header":"https://static001.geekbang.org/account/avatar/00/14/30/f1/bf7fd8d2.jpg","comment_is_top":false,"comment_ctime":1543738685,"is_pvip":false,"replies":[{"id":"16316","content":"只看到地址而不是函数名是由于应用程序运行在容器中，它的依赖也都在容器内部，故而perf无法找到PHP符号表。一个简单的解决方法是使用perf record生成perf.data拷贝到容器内部 perf report。","user_name":"作者回复","comment_id":45654,"uid":"1001282","ip_address":"","utype":1,"ctime":1543797209,"user_name_real":"倪朋飞"}],"discussion_count":4,"race_medal":0,"score":"104622953789","product_id":100020901,"comment_content":"执行perf top -g -p  （php-fpm进程号），发现不了sqrt函数<br>","like_count":24,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431138,"discussion_content":"只看到地址而不是函数名是由于应用程序运行在容器中，它的依赖也都在容器内部，故而perf无法找到PHP符号表。一个简单的解决方法是使用perf record生成perf.data拷贝到容器内部 perf report。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543797209,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1606177,"avatar":"","nickname":"程序员老万","note":"","ucode":"061269EFE23EC4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2911,"discussion_content":"老师，我把perf.data拷贝到容器，然后perf report,结果还是发现不了sqrt函数","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1564033900,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1237500,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI3jSpV7VvK6NaUH6X1LNYWGsQdFSTu4SwTZ0nQlSYGTOY2FrDCcMic9qFXnu2ZGR88hBlUQK28Whg/132","nickname":"古月弓虽1993","note":"","ucode":"86122CC701F02A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1606177,"avatar":"","nickname":"程序员老万","note":"","ucode":"061269EFE23EC4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":408960,"discussion_content":"我也是","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635346609,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":2911,"ip_address":""},"score":408960,"extra":""}]},{"author":{"id":1405256,"avatar":"https://static001.geekbang.org/account/avatar/00/15/71/48/44df7f4e.jpg","nickname":"凯","note":"","ucode":"60DB11CF72C7B0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":305207,"discussion_content":"perf record  -g  生成perf.data","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599817427,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44948,"user_name":"每天晒白牙","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1543533621,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"100327781429","product_id":100020901,"comment_content":"【day5】打卡<br>早晨六点半起来跟着专栏在虚拟机上搞，这个案例能完整跟下来也是不容易，还需要docker，个人认为，这种实战的课，一定要上手，光看是不行的。愿自己能坚持下去。","like_count":23},{"had_liked":false,"id":45447,"user_name":"dexter","can_delete":false,"product_type":"c1","uid":1315252,"ip_address":"","ucode":"DD51207438FBD6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEL5xnfuicbtRz4F87AAjZX6oCEjMtYiaIu4iaQichQmy0vEBA6Sumic1RDvUCeuBEqj6iatnt2kENbKYmuw/132","comment_is_top":false,"comment_ctime":1543644501,"is_pvip":false,"replies":[{"id":"16436","content":"👍","user_name":"作者回复","comment_id":45447,"uid":"1001282","ip_address":"","utype":1,"ctime":1543832538,"user_name_real":"倪朋飞"}],"discussion_count":2,"race_medal":0,"score":"87442990421","product_id":100020901,"comment_content":"每天上班地铁听一遍，下班地铁听一遍，晚上做实验","like_count":20,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431042,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543832538,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1000439,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/43/f7/abb7bfe3.jpg","nickname":"刘冲","note":"","ucode":"0C4F66921AE76C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":28631,"discussion_content":"俺也一样","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1570706977,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45609,"user_name":"郭江伟","can_delete":false,"product_type":"c1","uid":1313994,"ip_address":"","ucode":"613D638619B5A2","user_header":"https://static001.geekbang.org/account/avatar/00/14/0c/ca/6173350b.jpg","comment_is_top":false,"comment_ctime":1543721688,"is_pvip":false,"replies":[{"id":"16324","content":"很详细的分析步骤，感谢分享👍","user_name":"作者回复","comment_id":45609,"uid":"1001282","ip_address":"","utype":1,"ctime":1543797546,"user_name_real":"倪朋飞"}],"discussion_count":2,"race_medal":0,"score":"61673263832","product_id":100020901,"comment_content":"用sysbench测试cpu性能，然后利用perf 找到具体哪个进程的哪个函数在消耗CPU<br>gjw@gjw:&#47;etc&#47;apt$ sysbench --threads=1 --time=600 cpu run<br>sysbench 1.1.0 (using bundled LuaJIT 2.1.0-beta3)<br>Running the test with following options:<br>Number of threads: 1<br>Initializing random number generator from current time<br>Prime numbers limit: 10000<br>Initializing worker threads...<br>Threads started!<br>查看sysbench进程<br>ps -egjw@gjw:~$ ps -ef | grep sysbench<br>gjw      31921  1294 77 11:20 pts&#47;0    00:04:39 sysbench --threads=1 --time=600 cpu run<br>perf top获取进程信息：<br>sudo perf top -g -p 31921<br>Samples: 824  of event &#39;cycles:ppp&#39;, Event count (approx.): 618842235                                                                                                         <br>  Children      Self  Shared Object  Symbol                                                                                                                                   <br>+  100.00%   100.00%  sysbench       [.] cpu_execute_event<br>然后在sysbench源码中查看cpu_execute_event 函数：<br>gjw@gjw:~&#47;soft&#47;sysbench-master$ grep -r cpu_execute_event<br>Binary file src&#47;tests&#47;cpu&#47;libsbcpu.a matches<br>Binary file src&#47;tests&#47;cpu&#47;libsbcpu_a-sb_cpu.o matches<br>src&#47;tests&#47;cpu&#47;sb_cpu.c:static int cpu_execute_event(sb_event_t *, int);<br>src&#47;tests&#47;cpu&#47;sb_cpu.c:    .execute_event = cpu_execute_event,<br>src&#47;tests&#47;cpu&#47;sb_cpu.c:int cpu_execute_event(sb_event_t *r, int thread_id)<br>Binary file src&#47;sysbench matches<br>gjw@gjw:~&#47;soft&#47;sysbench-master$ vi src&#47;tests&#47;cpu&#47;sb_cpu.c <br> int cpu_execute_event(sb_event_t *r, int thread_id)<br>{<br>  unsigned long long c;<br>  unsigned long long l;<br>  double t;<br>  unsigned long long n=0;<br>  (void)thread_id; &#47;* unused *&#47;<br>  (void)r; &#47;* unused *&#47;<br>  &#47;* So far we&#39;re using very simple test prime number tests in 64bit *&#47;<br>  for(c=3; c &lt; max_prime; c++)<br>  {<br>    t = sqrt((double)c);<br>    for(l = 2; l &lt;= t; l++)<br>      if (c % l == 0)<br>        break;<br>    if (l &gt; t )<br>      n++;<br>  }<br>  return 0;<br>可以看到该函数在计算素数，由此完成了一个cpu使用率很高的案例分析","like_count":14,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431120,"discussion_content":"很详细的分析步骤，感谢分享👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543797546,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1026608,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/30/acc91f01.jpg","nickname":"honnkyou","note":"","ucode":"FD5EC4120EE803","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306445,"discussion_content":"perf top 时sysbench 的Symbol file 要怎么指定的？\nsymbol file 要提前准备好吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600269669,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45363,"user_name":"ichen","can_delete":false,"product_type":"c1","uid":1156973,"ip_address":"","ucode":"2A931EBE9098D0","user_header":"https://static001.geekbang.org/account/avatar/00/11/a7/6d/19bff1f9.jpg","comment_is_top":false,"comment_ctime":1543612919,"is_pvip":false,"replies":[{"id":"16341","content":"感谢分享","user_name":"作者回复","comment_id":45363,"uid":"1001282","ip_address":"","utype":1,"ctime":1543799042,"user_name_real":"倪朋飞"}],"discussion_count":2,"race_medal":0,"score":"61673155063","product_id":100020901,"comment_content":"内核如果没有perf package的话，可以从git下载源码安装<br>https:&#47;&#47;askubuntu.com&#47;questions&#47;50145&#47;how-to-install-perf-monitoring-tool&#47;306683<br><br>git clone https:&#47;&#47;git.kernel.org&#47;pub&#47;scm&#47;linux&#47;kernel&#47;git&#47;torvalds&#47;linux.git （大约2.5G 左右）<br>cd linux&#47;tools&#47;perf<br>make （可能缺flex，bison等，需自行安装）<br>cp perf &#47;usr&#47;bin<br>perf --version ","like_count":14,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430999,"discussion_content":"感谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543799042,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1101611,"avatar":"","nickname":"庄生 • 晓梦 • 蝴蝶","note":"","ucode":"9281045A5B3F5D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":536361,"discussion_content":"clone的时候加上--depth=1，没有commits信息之后，clone的数据量大小200M\n\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1638768989,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45012,"user_name":"espzest","can_delete":false,"product_type":"c1","uid":1094470,"ip_address":"","ucode":"64B1A7DEA19348","user_header":"https://static001.geekbang.org/account/avatar/00/10/b3/46/ec914238.jpg","comment_is_top":false,"comment_ctime":1543539405,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"57378114253","product_id":100020901,"comment_content":"iowait所耗费的时间，应该不算到cpu使用率里面吧？  如果是这样的话，上面计算cpu使用率 除去idle以外的时间都算，是不是有问题？","like_count":13,"discussions":[{"author":{"id":2608728,"avatar":"https://static001.geekbang.org/account/avatar/00/27/ce/58/71ed845f.jpg","nickname":"Dexter","note":"","ucode":"909CABC4AC4AC9","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578825,"discussion_content":"iowait对于单个进程来说，应该不算在CPU使用率里面啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657030717,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2066801,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/W0VEO7Hxzd61mia6Ls2EpBmaZ0l9q7SFUAErbu4XKIjWLmlALr4ybpicDoI8SoXY8XJNKmk04Ep1ibTCuFvfCF8GQ/132","nickname":"Chen","note":"","ucode":"5D0F3DF807706E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":324655,"discussion_content":"没问题呀，idle不包括iowait，所以上面计算cpu使用率 除去idle以外的时间都算是没问题的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605148912,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1582813,"avatar":"https://static001.geekbang.org/account/avatar/00/18/26/dd/d58156b1.jpg","nickname":"一粒","note":"","ucode":"FB5F583CC6AE3C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":315606,"discussion_content":"要算到CPU使用率里的，因为iowait时CPU无法被其他进程使用的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603293129,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1244665,"avatar":"https://static001.geekbang.org/account/avatar/00/12/fd/f9/61bdb3f8.jpg","nickname":"未来小鬼","note":"","ucode":"A0ED87F78E6319","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1582813,"avatar":"https://static001.geekbang.org/account/avatar/00/18/26/dd/d58156b1.jpg","nickname":"一粒","note":"","ucode":"FB5F583CC6AE3C","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":585603,"discussion_content":"不是吧，哪怕是D状态，Cpu也是可以被让出来的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661699950,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":315606,"ip_address":"江苏"},"score":585603,"extra":""}]}]},{"had_liked":false,"id":236923,"user_name":"Jianwen Ji","can_delete":false,"product_type":"c1","uid":1027028,"ip_address":"","ucode":"20A8AC1AA8A8E9","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erHaczgBsEF7zqCj8Hlq2vtYh0M6Jj3pia66ZW0O4fFvNldbkHYX6d8B0fBHwicxAcMMRmcNzPrJLMA/132","comment_is_top":false,"comment_ctime":1595586491,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"53135194043","product_id":100020901,"comment_content":"如果虚拟机的系统是CentOS或RHEL, 可能会有perf top -g -p pid没有看到函数名，只能看到一堆16进制的问题，还有一种workaround。在 docker run  feisky&#47;php-fpm的时候加上----privileged，在php-fpm内部使用perf top。<br>大体步骤如下：<br>1. docker run --privileged --name phpfpm -itd --network container:nginx feisky&#47;php-fpm<br>2.  docker exec -i -t phpfpm bash<br>     apt-get update &amp;&amp; apt-get install -y linux-perf linux-tools procps<br>3. top查看cpu使用率高的进程<br>4. perf_4.9 top -g -p &lt;pid&gt;<br>    使用这个容器内最新安装的perf_4.9","like_count":12,"discussions":[{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578798,"discussion_content":"docker run --privileged --name phpfpm -itd --network container:nginx feisky/php-fpm restart=&#34;always&#34; /usr/sbin/init 这样更全面进去","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657021038,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2441324,"avatar":"https://static001.geekbang.org/account/avatar/00/25/40/6c/4c0060ab.jpg","nickname":"你猜偶系谁","note":"","ucode":"86E204DDA35F41","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":563923,"discussion_content":"nb兄弟，真是太感谢了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650112633,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2088083,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/dc/93/bdbc45cc.jpg","nickname":"LUO FAN","note":"","ucode":"538E81E6FC4015","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":363526,"discussion_content":"发现直接运行perf是不行的，必须指定版本，直接运行perf会有一个检查","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617206188,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2411665,"avatar":"","nickname":"Geek_ea821e","note":"","ucode":"9C70C74393A184","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":357444,"discussion_content":"太感谢了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615806633,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1565396,"avatar":"https://static001.geekbang.org/account/avatar/00/17/e2/d4/ef86ea64.jpg","nickname":"Front","note":"","ucode":"35593EA52F2EA6","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":337865,"discussion_content":"只有这个办法有效了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609109808,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44936,"user_name":"风清扬笑","can_delete":false,"product_type":"c1","uid":1028152,"ip_address":"","ucode":"C0494B7A97A628","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b0/38/076fa6c1.jpg","comment_is_top":false,"comment_ctime":1543511967,"is_pvip":false,"replies":[{"id":"16004","content":"👍","user_name":"作者回复","comment_id":44936,"uid":"1001282","ip_address":"","utype":1,"ctime":1543537338,"user_name_real":"倪朋飞"}],"discussion_count":3,"race_medal":0,"score":"53083119519","product_id":100020901,"comment_content":"cpu使用率，就是cpu被使用的比例，也就是空闲之外的使用比例。<br><br>对我来说，发现cpu使用率高后，先跟老师一样用perf来抓取cpu消耗栈，很容易发现瓶颈。<br><br>另外，我一般用mpstat -P ALL 来看各个cpu核心的使用率情况，因为top之类的看的是系统总使用率，不一定能发现问题，特别是多进程或者多线程应用","like_count":13,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430865,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543537338,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1980201,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/37/29/b3af57a7.jpg","nickname":"凯文小猪","note":"","ucode":"36D8AD0229547F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":386938,"discussion_content":"我通常是通过top -c 再按下1看各分片CPU 和楼上殊途同归","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1627899733,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1523938,"avatar":"https://static001.geekbang.org/account/avatar/00/17/40/e2/c464a6f7.jpg","nickname":"孙奕意","note":"","ucode":"A591F865950397","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336084,"discussion_content":"用mpstat -P ALL 来看各个cpu核心的使用率情况后，然后要怎么定位到具体的函数呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608474237,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49768,"user_name":"鹏","can_delete":false,"product_type":"c1","uid":1009228,"ip_address":"","ucode":"243E408E2094E1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/66/4c/39a6829c.jpg","comment_is_top":false,"comment_ctime":1544767097,"is_pvip":false,"replies":[{"id":"17958","content":"谢谢分享，Java专家呀😊","user_name":"作者回复","comment_id":49768,"uid":"1001282","ip_address":"","utype":1,"ctime":1544781587,"user_name_real":"倪朋飞"}],"discussion_count":3,"race_medal":0,"score":"44494440057","product_id":100020901,"comment_content":"处理CPU高的流程如下（大数据，基本都是jvm）：<br>       通过top查看cpu使用率比较高的进程 pid<br>       top -H $pid 造成cpu使用率的线程  tid (top第一列，列明还是PID)<br>       printf 0x%x $tid  获得16进制的tid<br>       jstack $pid 查找 nid=16进制tid，相应线程的就找到了<br><br>PS：现在大多是docker 环境，在宿主机无法直接通过jstack获取到容器内的jvm 线程信息，可以进入容器再jstack 或者在宿主机上使用jdk 10；容器内无法使用jtack 之类命令，那么需要添加容器参数 privileged<br>       ","like_count":10,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432766,"discussion_content":"谢谢分享，Java专家呀😊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544781587,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2781511,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/71/47/41fa5ef9.jpg","nickname":"安军","note":"","ucode":"D122671354A2F8","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":591566,"discussion_content":"每个命令都没法执行","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666664503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1111985,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg","nickname":"Frank","note":"","ucode":"9DADD72C193296","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335549,"discussion_content":"感谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608217391,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":177688,"user_name":"Aaron niu","can_delete":false,"product_type":"c1","uid":1315335,"ip_address":"","ucode":"8CB10D7494DDAC","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epujZ0vpjYD4KiaCI400YdfFenDotavczNpxzQ1AZdEichAhdEXWOyoGIksnG5meRibRTwTEibdmcPo1Q/132","comment_is_top":false,"comment_ctime":1581474259,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"40236179923","product_id":100020901,"comment_content":"进程在容器中的情况下，可以把容器目录挂载到宿主机<br><br># 把下面的&lt;container-name&gt;改成你要观察的容器名。<br> <br>mkdir &#47;tmp&#47;foo<br>PID=$(docker inspect --format {{.State.Pid}} &lt;container-name&gt;)<br>bindfs &#47;proc&#47;$PID&#47;root &#47;tmp&#47;foo<br>perf report --symfs &#47;tmp&#47;foo<br> <br># 使用完成后不要忘记解除绑定<br>umount &#47;tmp&#47;foo&#47;","like_count":9,"discussions":[{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578802,"discussion_content":"牛逼压大佬","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657022843,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2432668,"avatar":"https://static001.geekbang.org/account/avatar/00/25/1e/9c/2336bcf2.jpg","nickname":"你的益达","note":"","ucode":"7E3491E4E0909F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383000,"discussion_content":"这个 好用啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625819104,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57617,"user_name":"猪哥哥","can_delete":false,"product_type":"c1","uid":1311362,"ip_address":"","ucode":"ACBB4556516D34","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLkhgYnYZBdhdwKnXQibey04cy9N9ria3DadH7iagoKukaWK1FJwjfCoh0He4p7b2icSYVzHH71l8ZXiaQ/132","comment_is_top":false,"comment_ctime":1546851935,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"31611623007","product_id":100020901,"comment_content":"老师你好 我写了一个python死循环 代码如下 <br>def wangfang():<br>  while True:<br>    i =1<br>wangfang()<br>使用perf top命令 无法抓取到该循环的函数, 老师能解释一下吗","like_count":7,"discussions":[{"author":{"id":1121758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","nickname":"aoe","note":"","ucode":"1C6201EDB4E954","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":311155,"discussion_content":"因为程序已经挂了，栈溢出了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1602238850,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1368319,"avatar":"","nickname":"武寻","note":"","ucode":"F40AB225139299","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1121758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","nickname":"aoe","note":"","ucode":"1C6201EDB4E954","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335187,"discussion_content":"他这根本没有函数的重复堆栈，上哪溢出？","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1608112705,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":311155,"ip_address":""},"score":335187,"extra":""}]}]},{"had_liked":false,"id":45193,"user_name":"北斗狼","can_delete":false,"product_type":"c1","uid":1265801,"ip_address":"","ucode":"CC991CC004EB29","user_header":"https://static001.geekbang.org/account/avatar/00/13/50/89/a6259c76.jpg","comment_is_top":false,"comment_ctime":1543559300,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"27313363076","product_id":100020901,"comment_content":"老师，问个问题，我按您的文档，我使用perf top -g -p 进程ID 怎么无法查看php-fpm的调用关系，出不来哪个函数较用较高的CPU？ 以下是我的显示结果，您帮我看看为什么显示的是0x7fd...<br>1、开始压力测试<br>ab -c 10 -n 10000 http:&#47;&#47;bjdsj-test-11-58:10001<br><br>2、查看调用关系 perf top -g -p 39826<br>Samples: 80K of event &#39;cycles&#39;, Event count (approx.): 29700884257                                                       <br>+   93.02%     0.69%  php-fpm             [.] 0x00000000008c296e<br>   0x7fd84a21c96e                                                                                                          <br>   0x7fd84a21d323                                                                                                          <br>   0x7fd84a185f94                                                                                                          <br>   0x7fd84a0d66fc                                                                                                          <br>   0x7fd84a325642                                                                                                          <br>   0x7fd842a702e1                                                                                                          <br>   0x6cb6258d4c544155 <br>+   23.35%     0.38%  php-fpm             [.] 0x00000000008c4a7c<br>+    5.60%     5.60%  libm-2.24.so        [.] 0x000000000002127e<br>+    4.22%     0.00%  php-fpm             [.] 0x000000000098dd97<br>+    2.54%     2.54%  php-fpm             [.] 0x000000000094ede0<br>+    1.96%     1.96%  php-fpm             [.] 0x0000000000681b9d<br>+    1.58%     1.58%  php-fpm             [.] 0x0000000000815e70<br>+    1.52%     1.51%  php-fpm             [.] 0x000000000094eddc<br>+    1.48%     1.48%  php-fpm             [.] 0x00000000008cd729<br>+    1.32%     1.32%  php-fpm             [.] 0x00000000008c4ae5<br>+    1.21%     1.21%  php-fpm             [.] 0x000000000098dc03<br>+    1.04%     1.04%  php-fpm             [.] 0x0000000000681b99<br>Failed to open &#47;opt&#47;bitnami&#47;php&#47;lib&#47;php&#47;extensions&#47;opcache.so, continuing without symbols<br>","like_count":6,"discussions":[{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578803,"discussion_content":"不是和你说了吗？需要把结果复制到容器内部去查看压\ndocker run --privileged --name phpfpm -itd --network container:nginx phpfpm restart=&#34;always&#34; /usr/sbin/init\nperf record -g -p 39826\ndocker cp perf.data phpfpm:/root\nyum install -y linux-perf linux-tools procps\nperf report\n这样就可以看到了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657023125,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2109846,"avatar":"https://static001.geekbang.org/account/avatar/00/20/31/96/deea4486.jpg","nickname":"覔亖甴","note":"","ucode":"9D3BC4EDD2B773","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":545816,"discussion_content":" 老师不管这个问题吗？收了钱不管事？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642058835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44996,"user_name":"十三","can_delete":false,"product_type":"c1","uid":1196791,"ip_address":"","ucode":"D3EFE8729DDE8A","user_header":"https://static001.geekbang.org/account/avatar/00/12/42/f7/9dce9a7b.jpg","comment_is_top":false,"comment_ctime":1543538654,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"27313342430","product_id":100020901,"comment_content":"『D6打卡』<br>还没有操作实验，看了内容，先占个位置。","like_count":6},{"had_liked":false,"id":107861,"user_name":"大头","can_delete":false,"product_type":"c1","uid":1315367,"ip_address":"","ucode":"C1FB2C8A0FB0C0","user_header":"https://static001.geekbang.org/account/avatar/00/14/12/27/32746bbf.jpg","comment_is_top":false,"comment_ctime":1561625123,"is_pvip":true,"replies":[{"id":"39096","content":"谢谢分享。其他发行版安装 Docker 的步骤可以参考官方文档 https:&#47;&#47;docs.docker.com&#47;install&#47;","user_name":"作者回复","comment_id":107861,"uid":"1001282","ip_address":"","utype":1,"ctime":1561647613,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"23036461603","product_id":100020901,"comment_content":"总结一下docker运行的步骤吧，我的是Centos系统：<br>1 安装docker，yum -y install docker-io。确保系统内核为3.10.0及以上。低版本的需要升级内核或者使用高版本的CentOs系统<br>2 启动docker systemctl start docker.service<br>3 下载课件上提供的源码，进入到源码目录。执行make build   &amp;&amp; make run","like_count":5,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455712,"discussion_content":"谢谢分享。其他发行版安装 Docker 的步骤可以参考官方文档 https://docs.docker.com/install/","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561647613,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65881,"user_name":"沙漠风暴","can_delete":false,"product_type":"c1","uid":1284147,"ip_address":"","ucode":"9F5E421C82DAD6","user_header":"https://static001.geekbang.org/account/avatar/00/13/98/33/64e35e5a.jpg","comment_is_top":false,"comment_ctime":1549718267,"is_pvip":false,"replies":[{"id":"23687","content":"按照文中的步骤操作就可以","user_name":"作者回复","comment_id":65881,"uid":"1001282","ip_address":"","utype":1,"ctime":1550065898,"user_name_real":"倪朋飞"}],"discussion_count":3,"race_medal":0,"score":"23024554747","product_id":100020901,"comment_content":"老师，弱弱的请教下怎么用docker安装您那个nginx和php环境和程序，我以前没用过docker，刚学的，见谅。","like_count":5,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438625,"discussion_content":"按照文中的步骤操作就可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550065898,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1865908,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/78/b4/af163d12.jpg","nickname":"雨天的七毫米","note":"","ucode":"963BBAFE8EF97B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302049,"discussion_content":"可以用 https://get.docker.com/ 这个脚本可以一键安装 docker ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598772388,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1334123,"avatar":"https://static001.geekbang.org/account/avatar/00/14/5b/6b/2ddbeab2.jpg","nickname":"allen","note":"","ucode":"67CD32ACB95013","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301597,"discussion_content":"按照步骤是不行的 我的是centos7根本就报错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598584659,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45173,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1543555663,"is_pvip":false,"replies":[{"id":"16087","content":"很多线上问题其实跟这个类似，等到你登陆服务器的时候性能问题已经结束了，这样在线分析就看不出哪里导致的问题，只有从平均负载这种反应历史的指标看出一些问题。<br><br>这种情景下，就需要监控系统的配合，记录下历史的系统和进程的性能指标。并且，这个case只有load1高，所以监控的间隔时间也需要比较精细。","user_name":"作者回复","comment_id":45173,"uid":"1001282","ip_address":"","utype":1,"ctime":1543571185,"user_name_real":"倪朋飞"}],"discussion_count":1,"race_medal":0,"score":"23018392143","product_id":100020901,"comment_content":"[D5打卡]<br>以前只会用top看CPU使用率，发现占用高的进程了再针对性的分析，比如c程序就用prof，局限性很高，<br>今天了解到可以用perf，直接看进程内函数调用栈和各函数的cpu使用率。<br>以前看到%sys过高，系统中断数过高的判断方法更搞笑，挨个杀可疑进程。<br>现在直接用pidstat就是了。<br>——————<br>最近在某云服务器上就遇到了诡异的事情，cpu空闲75%，%iowait不到1，系统中断数一直比较稳定，vmstat中的r正在运行和等待队列也还正常，但是系统每隔1小时23分，负载load1：就会从平常的0.2升高到8甚至是12的情况。好在每次持续时间较短，约2分钟，load5的值还可以接受。<br>争取最近能把原因查出来，早点把学费赚回来，哈哈😄<br>—————<br>虽然之前学k8s专栏时ubuntu 18.04 和docker都配好了，但是最近手上事情有点多，还是先解决手上的事情吧。老师见谅哈。","like_count":5,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430948,"discussion_content":"很多线上问题其实跟这个类似，等到你登陆服务器的时候性能问题已经结束了，这样在线分析就看不出哪里导致的问题，只有从平均负载这种反应历史的指标看出一些问题。\n\n这种情景下，就需要监控系统的配合，记录下历史的系统和进程的性能指标。并且，这个case只有load1高，所以监控的间隔时间也需要比较精细。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543571185,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":236637,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1595487044,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18775356228","product_id":100020901,"comment_content":"✨TOP命令解释：<br>第三行cpu使用率解释：<br>√ us: user（通常缩写为 us），代表用户态 CPU 时间。注意，它不包括下面的 nice 时间，但包括了 guest 时间。<br>√ ni: nice（通常缩写为 ni），代表低优先级用户态 CPU 时间，也就是进程的 nice 值被调整为 1-19 之间时的 CPU 时间。这里注意，nice 可取值范围是 -20 到 19，数值越大，优先级反而越低。<br>√ sy: system（通常缩写为 sys），代表内核态 CPU 时间。<br>√ di: idle（通常缩写为 id），代表空闲时间。注意，它不包括等待 I&#47;O 的时间（iowait）。<br>√ wa: iowait（通常缩写为 wa），代表等待 I&#47;O 的 CPU 时间。<br>√ hi: irq（通常缩写为 hi），代表处理硬中断的 CPU 时间。<br>√ si: softirq（通常缩写为 si），代表处理软中断的 CPU 时间。<br>√ st: steal（通常缩写为 st），代表当系统运行在虚拟机中的时候，被其他虚拟机占用的 CPU 时间。<br>√ guest: guest（通常缩写为 guest），代表通过虚拟化运行其他操作系统的时间，也就是运行虚拟机的 CPU 时间。<br>√ gnice: guest_nice（通常缩写为 gnice），代表以低优先级运行虚拟机的时间。<br>✨ top 默认显示的是所有 CPU 的平均值，这个时候你只需要按下数字 1 ，就可以切换到每个 CPU 的使用率了。<br>✨ top命令所有进程的实时统计信息：<br>其中的%CPU，表示进程的 CPU 使用率。它是用户态和内核态 CPU 使用率的总和，包括：<br>※ 进程用户空间使用的CPU<br>※ 通过系统调用执行的内核空间CPU<br>※ 以及在就绪队列等待运行的CPU<br>※ 在虚拟化环境中，它还包括了运行虚拟机占用的CPU<br>✨pidstat分析进程cpu详细使用情况<br>top 并没有细分进程的用户态 CPU 和内核态 CPU，使用pidstat可以分析每个进程 CPU 详细使用情况。<br>※ 用户态 CPU 使用率 （%usr）；<br>※ 内核态 CPU 使用率（%system）；<br>※ 运行虚拟机 CPU 使用率（%guest）；<br>※ 等待 CPU 使用率（%wait）；<br>※ 以及总的 CPU 使用率（%CPU）<br>✨占用 CPU 的到底是代码里的哪个函数<br>办法一： GDB 调试程序的过程会中断程序运行，这在线上环境往往是不允许的。<br>所以，GDB 只适合用在性能分析的后期，当你找到了出问题的大致函数后，线下再借助它来进一步调试函数内部的问题。<br>办法二：通过perf第一时间分析进程CPU问题。<br>perf 是 Linux2.6.31以后内置的性能分析工具。它以性能事件采样为基础，不仅可以分析系统的各种事件和内核性能，<br>还可以用来分析指定应用程序的性能问题。<br><br>① 第一种常见用法是 perf top，类似于 top，它能够实时显示占用 CPU 时钟最多的函数或者指令，因此可以用来查找热点函数。<br>* Samples：采样数<br>* event：事件类型<br>* Event count：事件总数量<br>表格解释：<br>* 第一列 Overhead ，是该符号的性能事件在所有采样中的比例，用百分比来表示。<br>* 第二列 Shared ，是该函数或指令所在的动态共享对象（Dynamic Shared Object），如内核、进程名、动态链接库名、内核模块名等。<br>* 第三列 Object ，是动态共享对象的类型。比如 [.] 表示用户空间的可执行程序、或者动态链接库，而 [k] 则表示内核空间。<br>* 第四列 Symbol 是符号名，也就是函数名。当函数名未知时，用十六进制的地址来表示。<br><br>perf top 缺点： 虽然实时展示了系统的性能信息，但它的缺点是并不保存数据，也就无法用于离线或者后续的分析<br>② 第二种用法是：perf record 则提供了保存数据的功能，保存后的数据，需要你用 perf report 解析展示，perf record执行后，可以在当前目录下生成：perf.data<br>然后使用perf report直接执行生成跟perf top一样的报告。<br>⭕️ perf top调用关系分析<br>\t# -g开启调用关系分析，-p指定php-fpm的进程号21515<br>\t$ perf top -g -p 21515<br>  可以查看到进程中具体的函数调用关系来帮助排查问题。<br>✨ ab工具使用方式<br>ab（apache bench）是一个常用的 HTTP 服务性能测试工具<br># 并发10个请求测试Nginx性能，总共测试100个请求<br>$ ab -c 10 -n 100 http:&#47;&#47;localhost:10000&#47;","like_count":4},{"had_liked":false,"id":53099,"user_name":"jssfy","can_delete":false,"product_type":"c1","uid":1137238,"ip_address":"","ucode":"F16353CFE607B7","user_header":"https://static001.geekbang.org/account/avatar/00/11/5a/56/115c6433.jpg","comment_is_top":false,"comment_ctime":1545583501,"is_pvip":false,"replies":[{"id":"19450","content":"什么错误？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545696442,"ip_address":"","comment_id":53099,"utype":1}],"discussion_count":2,"race_medal":0,"score":"18725452685","product_id":100020901,"comment_content":"容器中安装不了linux-perf，需要修改源？","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434032,"discussion_content":"什么错误？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545696442,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578804,"discussion_content":"yum install -y linux-perf linux-tools procps","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657023169,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50044,"user_name":"李嘉鹏","can_delete":false,"product_type":"c1","uid":1022999,"ip_address":"","ucode":"730E44B3535DF9","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9c/17/6ffd80f6.jpg","comment_is_top":false,"comment_ctime":1544848142,"is_pvip":false,"replies":[{"id":"18105","content":"👍 谢谢分享安装方法","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545004300,"ip_address":"","comment_id":50044,"utype":1}],"discussion_count":2,"race_medal":0,"score":"18724717326","product_id":100020901,"comment_content":"我安装的ubuntu 18.04 live server版本，使用如下指令安装的perf：<br>apt install linux-tools-generic","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432856,"discussion_content":"👍 谢谢分享安装方法","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545004300,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1609350,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/2rRMjRdMelicUoU5yXibENlYapdvPUCibOk8bGicyFoIW7IMxMqhicgelVphEmWFpMucVXjQjv5pdu6RgDkNiav0qUcw/132","nickname":"holly","note":"","ucode":"9D57569ED81CBA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":23472,"discussion_content":"我是ubuntu18.04 desktop，使用perf top被提示使用apt install linux-tools-generic 和apt install linux-tools-generic guile","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569823842,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46221,"user_name":"小虎","can_delete":false,"product_type":"c1","uid":1033083,"ip_address":"","ucode":"31438B30CF7910","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/GkMk4gBlfZcljsY3Vqu7w8ZkxBfe8WTz1ySnPTJARKXF0FpCr3HqlicIHQlItib9m7iaxLESkmBNpoiaY81EUUzQrA/132","comment_is_top":false,"comment_ctime":1543886046,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18723755230","product_id":100020901,"comment_content":"为什么iowait高会导致cpu使用率高，还有例子中定位函数关系链那里sqrt那里看只有3.97%，怎么就确定是这个引起的。","like_count":4},{"had_liked":false,"id":44937,"user_name":"朱月俊","can_delete":false,"product_type":"c1","uid":1017707,"ip_address":"","ucode":"4DA0728B862FBD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/6b/0b6cd39a.jpg","comment_is_top":false,"comment_ctime":1543513561,"is_pvip":false,"replies":[{"id":"16003","content":"会讲的，不过还是侧重于通用的方法，而不是具体某个编程语言","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543537326,"ip_address":"","comment_id":44937,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18723382745","product_id":100020901,"comment_content":"可以再讲讲如何分析C++程序热点函数，哪些地方占用大量内存，哪些地方占用其他资源，期待大佬。","like_count":4,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430866,"discussion_content":"会讲的，不过还是侧重于通用的方法，而不是具体某个编程语言","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543537326,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":237694,"user_name":"韦伯","can_delete":false,"product_type":"c1","uid":1145172,"ip_address":"","ucode":"B9038579C44F55","user_header":"https://static001.geekbang.org/account/avatar/00/11/79/54/34273afa.jpg","comment_is_top":false,"comment_ctime":1595927994,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14480829882","product_id":100020901,"comment_content":"我是在docker中运行的ubuntu18.04，安装pref的时候出现：<br><br>WARNING: perf not found for kernel 4.19.76<br><br>  You may need to install the following packages for this specific kernel:<br>    linux-tools-4.19.76-linuxkit<br>    linux-cloud-tools-4.19.76-linuxkit<br><br>  You may also want to install one of the following packages to keep up to date:<br>    linux-tools-linuxkit<br>    linux-cloud-tools-linuxkit<br><br>照着提示也一通install，然后执行perf，但还是会报上述的错误。又一通搜索后，执行了<br>ln -s &#47;usr&#47;lib&#47;linux-tools&#47;4.15.0-112-generic&#47;perf  &#47;usr&#47;bin&#47;perf<br>就没问题了","like_count":3},{"had_liked":false,"id":85455,"user_name":"大坏狐狸","can_delete":false,"product_type":"c1","uid":1325678,"ip_address":"","ucode":"5044F89A505C5B","user_header":"https://static001.geekbang.org/account/avatar/00/14/3a/6e/e39e90ca.jpg","comment_is_top":false,"comment_ctime":1555063464,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14439965352","product_id":100020901,"comment_content":"按照步骤走的，perf -g -p 三个进程随便试了一个没有内容出现。用了perf record 和perf report 终于出现了 嘎嘎。二刷 动手还是有用的。","like_count":3,"discussions":[{"author":{"id":2224641,"avatar":"https://static001.geekbang.org/account/avatar/00/21/f2/01/80521228.jpg","nickname":"郑斌","note":"","ucode":"E253447BAB1E23","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312538,"discussion_content":"我用top -p也没有看到指定进程，知道是什么原因吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1602730761,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45661,"user_name":"渡渡鸟_linux","can_delete":false,"product_type":"c1","uid":1227772,"ip_address":"","ucode":"099BB11A3201D3","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ernR4NKI5tejJAV3HMTF3gszBBUAjkjLO2QYic2gx5dMGelFv4LWibib7CUGexmMcMp5HiaaibmOH3dyHg/132","comment_is_top":false,"comment_ctime":1543739855,"is_pvip":false,"replies":[{"id":"16310","content":"只看到地址而不是函数名是由于应用程序运行在容器中，它的依赖也都在容器内部，故而perf无法找到PHP符号表。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543796927,"ip_address":"","comment_id":45661,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14428641743","product_id":100020901,"comment_content":"使用perf 只能分析到16进制的地址，无法显示函数名称","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431143,"discussion_content":"只看到地址而不是函数名是由于应用程序运行在容器中，它的依赖也都在容器内部，故而perf无法找到PHP符号表。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543796927,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45236,"user_name":"Leon📷","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1543564530,"is_pvip":false,"replies":[{"id":"16084","content":"调用堆栈需要按上下方向键导航到想看的地方，再按回车键展开","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543570426,"ip_address":"","comment_id":45236,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14428466418","product_id":100020901,"comment_content":"老师，我是centos7系统，执行了perf top -g -p pid，进去之后，看不到函数调用图，这是为啥<br>","like_count":3,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430963,"discussion_content":"调用堆栈需要按上下方向键导航到想看的地方，再按回车键展开","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543570426,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":248103,"user_name":"颓废人才","can_delete":false,"product_type":"c1","uid":1984432,"ip_address":"","ucode":"DED839F68A822D","user_header":"https://static001.geekbang.org/account/avatar/00/1e/47/b0/f44aef75.jpg","comment_is_top":false,"comment_ctime":1600009947,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10189944539","product_id":100020901,"comment_content":"请问docker镜像怎么装？没用过docker，简单自学后docker安装好了（并设置阿里云进项仓库），装其他的镜像也会（例如 mysql等），但是请问如何安装你的nginx和php的镜像包？","like_count":2},{"had_liked":false,"id":172252,"user_name":"sylvia","can_delete":false,"product_type":"c1","uid":1736904,"ip_address":"","ucode":"8D69698FA73392","user_header":"","comment_is_top":false,"comment_ctime":1579140318,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"10169074910","product_id":100020901,"comment_content":"为什么执行这个命令后，返回采样数据都为空。pid6231是存在的，且cpu使用率很高。<br><br># pidstat -p 6231 3<br>10时03分44秒   UID       PID    %usr %system  %guest    %CPU   CPU  Command<br>10时03分47秒  1000      6231  100.00    2.33    0.00  100.00     3  gnome-shell<br><br># perf top -g -p 6231                                                                                                                                                             <br>Samples: 0  of event &#39;cycles:ppp&#39;, 4000 Hz, Event count (approx.): 0 lost: 0&#47;0 drop: 0&#47;0                                                                                                            <br>Children      Self","like_count":2,"discussions":[{"author":{"id":1785149,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/3d/3d/66512c23.jpg","nickname":"ben","note":"","ucode":"7084248C8D962C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":206765,"discussion_content":"我也是同样的问题","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584440170,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578805,"discussion_content":"你是不是不是最小化安装的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657023473,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":94339,"user_name":"强子","can_delete":false,"product_type":"c1","uid":1528598,"ip_address":"","ucode":"1002DA5D645FE5","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJF8NpRdF7fOetWvmBfOFvUfNkV7OoRnVdKoyTUBhOqCnibSyibGngGYEibn5QGMuXic66enqG9OS7jWA/132","comment_is_top":false,"comment_ctime":1557793427,"is_pvip":false,"replies":[{"id":"33779","content":"是的，后面还有更复杂的案例","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1557835340,"ip_address":"","comment_id":94339,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10147728019","product_id":100020901,"comment_content":"实际工程环境中，问题是很隐蔽复杂的","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450025,"discussion_content":"是的，后面还有更复杂的案例","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557835340,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54007,"user_name":"Blue_Eye","can_delete":false,"product_type":"c1","uid":1055764,"ip_address":"","ucode":"2FCF83951ABD7C","user_header":"https://static001.geekbang.org/account/avatar/00/10/1c/14/2388d9e4.jpg","comment_is_top":false,"comment_ctime":1545785686,"is_pvip":false,"replies":[{"id":"19724","content":"iowait是一个CPU指标，并且是个不太准确的指标，通常只是拿来参考，而不会用作基准判断：iowait高不代表I&#47;O负载重，iowait低也不代表就没有大量的I&#47;O","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545839946,"ip_address":"","comment_id":54007,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10135720278","product_id":100020901,"comment_content":"我有点困惑关于平均负载和CPU使用率的关系，之前那篇文章说平均负载和CPU使用率不是相关联的，平均负载是不仅包括了Running状态，等待IO的D状态的进程也会影响平均负载。但这篇文章又说CPU使用率里有个iowait，并且空闲时间里是不包括iowait的时间的。这似乎有点前后矛盾？既然iowait是属于CPU使用率，那为什么前一篇文章说平均负载和CPU使用率不一定是对等的呢？","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434323,"discussion_content":"iowait是一个CPU指标，并且是个不太准确的指标，通常只是拿来参考，而不会用作基准判断：iowait高不代表I/O负载重，iowait低也不代表就没有大量的I/O","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545839946,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49921,"user_name":"9527","can_delete":false,"product_type":"c1","uid":1032735,"ip_address":"","ucode":"04B51C09E3C7B8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c2/1f/343f2dec.jpg","comment_is_top":false,"comment_ctime":1544789894,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10134724486","product_id":100020901,"comment_content":"老师好，HZ等于250，是说一秒钟啥也不做，都会有250次的进程上下文切换吗？","like_count":2},{"had_liked":false,"id":45621,"user_name":"樊海涛","can_delete":false,"product_type":"c1","uid":1323249,"ip_address":"","ucode":"0B04D5985EE0E1","user_header":"https://static001.geekbang.org/account/avatar/00/14/30/f1/bf7fd8d2.jpg","comment_is_top":false,"comment_ctime":1543726514,"is_pvip":false,"replies":[{"id":"16321","content":"man是Linux最基本的命令","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543797411,"ip_address":"","comment_id":45621,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10133661106","product_id":100020901,"comment_content":"[Day6打卡]<br>文章前面（查询 man proc 就可以），木有这么个命令吧？<br>","like_count":2,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431123,"discussion_content":"man是Linux最基本的命令","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543797411,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578807,"discussion_content":"docker run --privileged --name phpfpm -itd --network container:nginx phpfpm restart=&#34;always&#34; /usr/sbin/init\ndocker exec -it phpfpm\nyum install -y linux-perf linux-tools procps\nperf record -g -p 39826\ndocker cp perf.data phpfpm:/root\nperf report","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657023759,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356212,"user_name":"Geek_4e79a6","can_delete":false,"product_type":"c1","uid":3171069,"ip_address":"上海","ucode":"615F7457F8CC8C","user_header":"","comment_is_top":false,"comment_ctime":1662044158,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5957011454","product_id":100020901,"comment_content":"刚入职的小白，要给同入职的同学分享技术，正在学习倪老师的文档。我之前一直以为，只要使用perf，看第一列overhead 红的 黄的，第一眼看sqrt占比并不高，我下意识就排除了。原来不能只看那些占比高，perf之前要先定界，通过top查看是usr、idle、soft、hi、sys、wait...哪些cpu利用率高，根据这些在进一步分析perf","like_count":1},{"had_liked":false,"id":214408,"user_name":"杉松壁","can_delete":false,"product_type":"c1","uid":1080578,"ip_address":"","ucode":"ED904CE27CD3C4","user_header":"https://static001.geekbang.org/account/avatar/00/10/7d/02/4862f849.jpg","comment_is_top":false,"comment_ctime":1588742839,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5883710135","product_id":100020901,"comment_content":"跑容器的应用，如果限制了容器的CPU，内存。这样如果容器内使用了过多的CPU，也会导致整个机器的负载升高，但是看CPU使用率不高。","like_count":1},{"had_liked":false,"id":171968,"user_name":"InfoQ_d814060a8ee2","can_delete":false,"product_type":"c1","uid":1296300,"ip_address":"","ucode":"23293C0576134E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIHiaJ01zhIap8sR06u1oYslPTluBh9kuHUOUo0QRic7QZuzvDYYqWnk6YV4aU7BpVoQJr96TBt9TyQ/132","comment_is_top":false,"comment_ctime":1579059169,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5874026465","product_id":100020901,"comment_content":"请问 cpu 时间中的 guest 是什么意思，看解释是指的当前系统运行在虚拟机中的时间吗？","like_count":1},{"had_liked":false,"id":139985,"user_name":"ZYecho","can_delete":false,"product_type":"c1","uid":1356589,"ip_address":"","ucode":"9D156DD30C581E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLh73kPzAKhz7YxUribqF6QKFiahhVAbwpgVLSRicA68c6ZFA7vUBJY1ves3LVvibrypROyI7awv47eSA/132","comment_is_top":false,"comment_ctime":1570780694,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5865747990","product_id":100020901,"comment_content":"想问下 pidstat中等待 CPU 使用率（%wait）；这个包括等待io的时间么？","like_count":1,"discussions":[{"author":{"id":1260026,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","nickname":"安排","note":"","ucode":"F78CFA9624CAEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":169637,"discussion_content":"这个是在等待队列中等待运行的时间，除了cpu资源得不到满足，其他资源都满足，是处于可运行状态的，只是得不到运行，这就是%wait。而iowait是处于阻塞状态，睡眠了。所以%wait不包括等待io的时间。%wait也不会算在cpu使用率中，文中应该说的有错误。","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1581638430,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":94773,"user_name":"李杨欢","can_delete":false,"product_type":"c1","uid":1529256,"ip_address":"","ucode":"94B304E99F8AB1","user_header":"https://static001.geekbang.org/account/avatar/00/17/55/a8/f91c8b21.jpg","comment_is_top":false,"comment_ctime":1557892799,"is_pvip":false,"replies":[{"id":"34173","content":"有好多符号名称都没显示，有没有看到缺少调试信息的告警？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1558095800,"ip_address":"","comment_id":94773,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5852860095","product_id":100020901,"comment_content":"我并没有使用docker容器，直接用虚拟机做课程，并未发现sqrt函数<br>Samples: 15K of event &#39;cpu-clock&#39;, Event count (approx.): 247945416, DSO: php-fpm<br>  Children      Self  Symbol                    <br>-    7.47%     7.31%  [.] add_function          <br>+    5.25%     5.22%  [.] 0x00000000002cb7a0 <br>-    4.89%     4.82%  [.] 0x00000000002fff50    <br>+    4.32%     4.25%  [.] 0x00000000002e7cf0    <br>+    4.16%     4.11%  [.] 0x00000000002ef9a0    <br>+    3.45%     3.44%  [.] 0x00000000002bf2f0    <br>+    3.24%     3.20%  [.] 0x00000000001dfdd3    <br>+    3.19%     3.15%  [.] 0x00000000002dd260    <br>+    3.05%     3.01%  [.] 0x00000000002fff52    <br>+    3.05%     3.04%  [.] 0x00000000002ef9a1    <br>-    3.04%     3.02%  [.] execute_ex            <br>+    3.01%     3.01%  [.] 0x00000000002cb7a2    <br>+    2.96%     2.90%  [.] 0x00000000002dd264    <br>+    2.83%     2.80%  [.] 0x00000000001dfd91    <br>+    2.68%     2.64%  [.] 0x00000000001dfd90    <br>+    2.56%     2.48%  [.] 0x00000000002f88d4    <br>-    2.47%     2.47%  [.] 0x00000000002f88d0    <br>+    2.42%     2.35%  [.] 0x00000000002e7cf1    <br>+    2.35%     2.35%  [.] 0x00000000002bf2f6    <br>+    1.91%     1.91%  [.] 0x00000000002e8eb7    <br>+    1.74%     1.71%  [.] 0x00000000002ef9ac    <br>+    1.71%     1.68%  [.] 0x00000000002dd26a    <br>+    1.35%     1.33%  [.] 0x00000000002e8e52    <br>+    1.16%     1.13%  [.] 0x00000000002cb7a8    <br>+    1.13%     1.13%  [.] 0x00000000002e8e72    <br>+    1.08%     1.08%  [.] 0x00000000002e8e59    <br>+    1.06%     1.06%  [.] 0x00000000002bf301    <br>+    1.03%     1.03%  [.] 0x00000000002e7cf2    <br>+    0.94%     0.94%  [.] 0x00000000002fff6e    <br>+    0.90%     0.84%  [.] 0x00000000001dfd92    <br>+    0.79%     0.70%  [.] 0x00000000002ef9c4    <br>     0.72%     0.72%  [.] 0x00000000002cb7ea    <br>+    0.68%     0.68%  [.] 0x00000000002fff53    <br>     0.59%     0.59%  [.] 0x00000000002fff6a    <br>     0.54%     0.54%  [.] 0x00000000001dfdcf    <br>+    0.54%     0.53%  [.] 0x00000000001dfdd7    <br>     0.45%     0.45%  [.] 0x00000000002dd27b            ","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450201,"discussion_content":"有好多符号名称都没显示，有没有看到缺少调试信息的告警？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558095800,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70447,"user_name":"L33K","can_delete":false,"product_type":"c1","uid":1046063,"ip_address":"","ucode":"2F8E105F44E347","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f6/2f/d3f1dae6.jpg","comment_is_top":false,"comment_ctime":1551100036,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5846067332","product_id":100020901,"comment_content":"mark","like_count":1},{"had_liked":false,"id":66945,"user_name":"元天夫","can_delete":false,"product_type":"c1","uid":1315599,"ip_address":"","ucode":"A453A2EBA77780","user_header":"","comment_is_top":false,"comment_ctime":1550045895,"is_pvip":false,"replies":[{"id":"23706","content":"加油","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550068497,"ip_address":"","comment_id":66945,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5845013191","product_id":100020901,"comment_content":"补个卡，之前断了，现在从头详细再来一遍","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438988,"discussion_content":"加油","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550068497,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57979,"user_name":"。","can_delete":false,"product_type":"c1","uid":1066125,"ip_address":"","ucode":"25A734C4E3139F","user_header":"https://static001.geekbang.org/account/avatar/00/10/44/8d/02628db3.jpg","comment_is_top":false,"comment_ctime":1546955784,"is_pvip":false,"replies":[{"id":"20988","content":"👍 ","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1547027524,"ip_address":"","comment_id":57979,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5841923080","product_id":100020901,"comment_content":"学习前无所知，看一遍，再操作一遍，发现了问题，并在留言区找到了答案，很满足","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435859,"discussion_content":"👍 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547027524,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55129,"user_name":"花开蝶自来","can_delete":false,"product_type":"c1","uid":1358144,"ip_address":"","ucode":"767D55E7A82975","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKibu8C3CeYGF6JCBribiaEPia5gibaQnj9icryPVwoF6ibosmdicXJIhBEUdn0aDwZQ32oTyJL86DgDswhAg/132","comment_is_top":false,"comment_ctime":1546049373,"is_pvip":false,"replies":[{"id":"20019","content":"是的，篇幅限制，不会包括所有的细节，更深入的理论知识还需要专栏外再下功夫学习","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546075901,"ip_address":"","comment_id":55129,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5841016669","product_id":100020901,"comment_content":"D3打卡，<br>看着都差不多懂，但是还是太多细节不懂，总的来说还是要系统的回头再看看理论","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434680,"discussion_content":"是的，篇幅限制，不会包括所有的细节，更深入的理论知识还需要专栏外再下功夫学习","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546075901,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47023,"user_name":"仲鬼","can_delete":false,"product_type":"c1","uid":1314692,"ip_address":"","ucode":"DB1CD7052D5BA6","user_header":"https://static001.geekbang.org/account/avatar/00/14/0f/84/d8e63885.jpg","comment_is_top":false,"comment_ctime":1544020426,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5838987722","product_id":100020901,"comment_content":"老师好，关于perf有两个问题：<br>1. 请问perf top加-g时，前两列children和self两个指标各表示什么呢？按Enter键展开后的百分比又表示什么？自己研究man手册没理解。<br>2. 另外，我是做分布式存储的，用perf做性能分析时，是否需要考虑perf本身对于程序性能的影响？","like_count":1},{"had_liked":false,"id":45969,"user_name":"有铭","can_delete":false,"product_type":"c1","uid":1046302,"ip_address":"","ucode":"2C7CB36CA5C04C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/3XbCueYYVWTiclv8T5tFpwiblOxLphvSZxL4ujMdqVMibZnOiaFK2C5nKRGv407iaAsrI0CDICYVQJtiaITzkjfjbvrQ/132","comment_is_top":false,"comment_ctime":1543826539,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5838793835","product_id":100020901,"comment_content":"perf top -g -p $PID<br>这个命令使用后，Children那一列是什么意思，为啥占用率最高的和perf top对不上，我猜测此时的CPU占用率应该看旁边的Self？而且此时是按照Children列排序的，能否切换到别的列排序？","like_count":1},{"had_liked":false,"id":45942,"user_name":"Ivan","can_delete":false,"product_type":"c1","uid":1316260,"ip_address":"","ucode":"3512512C0E7AAB","user_header":"https://static001.geekbang.org/account/avatar/00/14/15/a4/3744053e.jpg","comment_is_top":false,"comment_ctime":1543823394,"is_pvip":false,"replies":[{"id":"16415","content":"iowait不算在idle里面","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543829918,"ip_address":"","comment_id":45942,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5838790690","product_id":100020901,"comment_content":"请问iowait time算在idle time里面吗？cpu的利用率计算公式中空闲时间指的是idle time，还是idle+iowait time。","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431282,"discussion_content":"iowait不算在idle里面","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543829918,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1338108,"avatar":"https://static001.geekbang.org/account/avatar/00/14/6a/fc/09d2c6f7.jpg","nickname":"周子焱","note":"","ucode":"952CA54619A2CE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332146,"discussion_content":"这里作者说的不对 iowait是idle的一种，在linux2.5之前的内核中只有idle, 后面才把iowait单独拿出来，但是本质没变，都是系统空闲的一种，idle表示cpu没活干，iowait表示cpu有活干但是没干，因为io还没准备好。cpu繁忙的时候一般不会有iowait, iowait高也不能说明系统一定有问题。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607074659,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45337,"user_name":"via","can_delete":false,"product_type":"c1","uid":1017696,"ip_address":"","ucode":"5A7E873D8D8FBE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/60/fe8a31ea.jpg","comment_is_top":false,"comment_ctime":1543590821,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5838558117","product_id":100020901,"comment_content":"android操作系统是否可以用类似的办法排查问题？","like_count":1},{"had_liked":false,"id":45280,"user_name":"Johnson","can_delete":false,"product_type":"c1","uid":1225037,"ip_address":"","ucode":"55B582953E49F3","user_header":"https://static001.geekbang.org/account/avatar/00/12/b1/4d/10c75b34.jpg","comment_is_top":false,"comment_ctime":1543575763,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5838543059","product_id":100020901,"comment_content":"碰到一个cpu利用率很低但是load非常高的问题，分析是D状态的进程很多，大多是ps命令，有没有杀掉这些命令的办法？不能重启的","like_count":1,"discussions":[{"author":{"id":1479120,"avatar":"https://static001.geekbang.org/account/avatar/00/16/91/d0/35bc62b1.jpg","nickname":"无咎","note":"","ucode":"B9759B5646F3AB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586775,"discussion_content":"kill -9 [pid]","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662510685,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45059,"user_name":"Geek_37593b","can_delete":false,"product_type":"c1","uid":1333821,"ip_address":"","ucode":"9C0CD7C30CA62C","user_header":"https://static001.geekbang.org/account/avatar/00/14/5a/3d/1a1754f2.jpg","comment_is_top":false,"comment_ctime":1543541925,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5838509221","product_id":100020901,"comment_content":"干货满满，非常好","like_count":1},{"had_liked":false,"id":44945,"user_name":"Richie","can_delete":false,"product_type":"c1","uid":1111377,"ip_address":"","ucode":"1426E1B2E82A43","user_header":"https://static001.geekbang.org/account/avatar/00/10/f5/51/60e91438.jpg","comment_is_top":false,"comment_ctime":1543531589,"is_pvip":false,"replies":[{"id":"16000","content":"可以先用文中的思路试试，对不同的编程语言其实还有更细化的分析方法，我们这里侧重于从系统层面着手分析","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543537201,"ip_address":"","comment_id":44945,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5838498885","product_id":100020901,"comment_content":"老师，如果是针对tomcat这种线程型的如何找问题","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430869,"discussion_content":"可以先用文中的思路试试，对不同的编程语言其实还有更细化的分析方法，我们这里侧重于从系统层面着手分析","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543537201,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44943,"user_name":"Chenl07","can_delete":false,"product_type":"c1","uid":1089132,"ip_address":"","ucode":"0A0A086168A8F7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/0FI2bUjegtznv7XPC9DB9RJaqiaMiamWkibibPOibuUC3DCvI7XMvBANr6sDjRNbc1jwPic9pIaFxrdaib88VqUJKXSTQ/132","comment_is_top":false,"comment_ctime":1543531512,"is_pvip":false,"replies":[{"id":"16001","content":"看图片里面，有各个符号的百分比","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543537241,"ip_address":"","comment_id":44943,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5838498808","product_id":100020901,"comment_content":"谢谢老师的分享，您的专栏每次更新我就会都是在早上6点左右就急不可待的要看了。<br>有个疑问，在最后示例中 perf top -g -p的输出，您是通过哪些指标判断是有sqrt和add function的问题？","like_count":1,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430868,"discussion_content":"看图片里面，有各个符号的百分比","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543537241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":359457,"user_name":"Geek_e2b0f9","can_delete":false,"product_type":"c1","uid":1602650,"ip_address":"北京","ucode":"CAB31078DDB515","user_header":"","comment_is_top":false,"comment_ctime":1665554803,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1665554803","product_id":100020901,"comment_content":"实际工作中使用top命令 进程状态是S 但是%cpu很高 这是怎么回事","like_count":0},{"had_liked":false,"id":358539,"user_name":"斌子","can_delete":false,"product_type":"c1","uid":1305393,"ip_address":"北京","ucode":"602804C685CFAE","user_header":"https://static001.geekbang.org/account/avatar/00/13/eb/31/2768a6a1.jpg","comment_is_top":false,"comment_ctime":1664419054,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1664419054","product_id":100020901,"comment_content":"docker里面安装perf报错呢<br>root@9a5f323702a2:&#47;tmp# apt-get install -y linux-perf linux-tools procps<br>Reading package lists... Done<br>Building dependency tree       <br>Reading state information... Done<br>E: Unable to locate package linux-perf<br>E: Unable to locate package linux-tools<br>","like_count":0},{"had_liked":false,"id":356860,"user_name":"成为优秀的程序员","can_delete":false,"product_type":"c1","uid":2275516,"ip_address":"广东","ucode":"6D9080A2B225AE","user_header":"https://static001.geekbang.org/account/avatar/00/22/b8/bc/d2d547c9.jpg","comment_is_top":false,"comment_ctime":1662647137,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1662647137","product_id":100020901,"comment_content":"WSL2 安装perf方式：https:&#47;&#47;blog.csdn.net&#47;qq_20452055&#47;article&#47;details&#47;108300321","like_count":0},{"had_liked":false,"id":354261,"user_name":"流年似水","can_delete":false,"product_type":"c1","uid":1105816,"ip_address":"江苏","ucode":"048D320AFB576A","user_header":"https://static001.geekbang.org/account/avatar/00/10/df/98/670d96c0.jpg","comment_is_top":false,"comment_ctime":1660224960,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1660224960","product_id":100020901,"comment_content":"php是脚本语言，为什么能够分析到php的调用栈","like_count":0,"discussions":[{"author":{"id":1479120,"avatar":"https://static001.geekbang.org/account/avatar/00/16/91/d0/35bc62b1.jpg","nickname":"无咎","note":"","ucode":"B9759B5646F3AB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586776,"discussion_content":"所有编程语言都有调用栈。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662510762,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":351269,"user_name":"Geek_f93234","can_delete":false,"product_type":"c1","uid":1769504,"ip_address":"","ucode":"1E5DC903A5429E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJGXndj5N66z9BL1ic9GibZzWWgoVeWaWTL2XUnCYic7iba2kAEvN9WfjmlXELD5lqt8IJ1P023N5ZWicg/132","comment_is_top":false,"comment_ctime":1657665952,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1657665952","product_id":100020901,"comment_content":"day5","like_count":0},{"had_liked":false,"id":347429,"user_name":"Geek_牧马人","can_delete":false,"product_type":"c1","uid":1844881,"ip_address":"","ucode":"F26A43AF9C5164","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoxLCjetepOZibacqBnhoibSlgGxAribic2AJPicVEic7M7DAFfuuJ7QvTXpiawO06tFdSpdnARibSVZ5R7Kg/132","comment_is_top":false,"comment_ctime":1654007470,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1654007470","product_id":100020901,"comment_content":"1.课程没有视频吗？<br>2.课程中docker镜像访问都是超时，有什么好的解决方案吗？","like_count":0,"discussions":[{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578808,"discussion_content":"那你切换镜像加速器为阿里云就快了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657023991,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":342226,"user_name":"Peter","can_delete":false,"product_type":"c1","uid":2425556,"ip_address":"","ucode":"5E57A0FE948966","user_header":"https://static001.geekbang.org/account/avatar/00/25/02/d4/1e0bb504.jpg","comment_is_top":false,"comment_ctime":1650113240,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1650113240","product_id":100020901,"comment_content":"perf top -g -p 21515  这个进程的可执行程序需要加-g 就是有符号表的编译的吗？","like_count":0},{"had_liked":false,"id":342089,"user_name":"爱丽包°","can_delete":false,"product_type":"c1","uid":2535283,"ip_address":"","ucode":"125325E82EE6D2","user_header":"https://static001.geekbang.org/account/avatar/00/26/af/73/6bc60f7a.jpg","comment_is_top":false,"comment_ctime":1650011233,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1650011233","product_id":100020901,"comment_content":"centOS 7.3执行命令perf report提示<br> Kernel address maps (&#47;proc&#47;{kallsyms,modules}) were restricted.   │<br>│                                                                  │<br>│Check &#47;proc&#47;sys&#47;kernel&#47;kptr_restrict before running &#39;perf record&#39;.│<br>│                                                                  │<br>│As no suitable kallsyms nor vmlinux was found, kernel samples     │<br>│can&#39;t be resolved.                                                │<br>│                                                                  │<br>│Samples in kernel modules can&#39;t be resolved as well.              │<br>│                                                                  │<br>│                                                                  │<br>│                                                                  │<br>│Press any key... ","like_count":0},{"had_liked":false,"id":340750,"user_name":"Geek_278a2c","can_delete":false,"product_type":"c1","uid":2379572,"ip_address":"","ucode":"7EC0366896F0E6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/zWLzhGrHubcMJnNFz0s0akeMpefNBVy2jic3rxetxHIjy1icPjJBXFQc78AW10icVN47BLrWicHcSm9MOfG38J2kKw/132","comment_is_top":false,"comment_ctime":1649117896,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1649117896","product_id":100020901,"comment_content":"是一个虚拟机2c8g，还是两个虚拟机每个都是1c4g？","like_count":0},{"had_liked":false,"id":333330,"user_name":"Geek_e34cf7","can_delete":false,"product_type":"c1","uid":2635949,"ip_address":"","ucode":"A8570339DA03D1","user_header":"","comment_is_top":false,"comment_ctime":1644291934,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1644291934","product_id":100020901,"comment_content":"docker镜像为何的链接为何进不去<br>","like_count":0},{"had_liked":false,"id":328713,"user_name":"小北","can_delete":false,"product_type":"c1","uid":1282648,"ip_address":"","ucode":"3A23079E4AA92E","user_header":"https://static001.geekbang.org/account/avatar/00/13/92/58/b4f6365d.jpg","comment_is_top":false,"comment_ctime":1640851612,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1640851612","product_id":100020901,"comment_content":"k8s 里面 perf top 没权限，提示要修改环境变量 kernel.perf_event_paranoid= -1 ，但是在容器里面修改不了····有啥办法吗？线上的集群节点，应该不让我改宿主机的···","like_count":0},{"had_liked":false,"id":328712,"user_name":"小北","can_delete":false,"product_type":"c1","uid":1282648,"ip_address":"","ucode":"3A23079E4AA92E","user_header":"https://static001.geekbang.org/account/avatar/00/13/92/58/b4f6365d.jpg","comment_is_top":false,"comment_ctime":1640851539,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1640851539","product_id":100020901,"comment_content":"老师，我们服务部署在 k8s 里，一共2个pod, 目前出现了2次有一个pod cpu 涨到 100%，但是另外一个是正常的，而且2个pod流量也差不多, 这种情况会是什么问题造成的呢？","like_count":0},{"had_liked":false,"id":327359,"user_name":"Geek_70c53a","can_delete":false,"product_type":"c1","uid":2295078,"ip_address":"","ucode":"9BD4E96E3974D5","user_header":"","comment_is_top":false,"comment_ctime":1640081515,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1640081515","product_id":100020901,"comment_content":"你们是怎么把github中的镜像，通过docker拉取到本地的呢？","like_count":0,"discussions":[{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578809,"discussion_content":"docker pull 镜像名字 拉取下来的或者是你自己创建一个容器把里面的内容复制进行编译一下也可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657024104,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321945,"user_name":"gecko","can_delete":false,"product_type":"c1","uid":1198048,"ip_address":"","ucode":"2B7122536F1A0E","user_header":"https://static001.geekbang.org/account/avatar/00/12/47/e0/1ff26e99.jpg","comment_is_top":false,"comment_ctime":1637114451,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637114451","product_id":100020901,"comment_content":"Ubuntu 20 安装perf<br><br>------------<br>cat &#47;etc&#47;issue<br>Ubuntu 20.04.1 LTS \\n \\l<br><br>---------------<br>apt-get install  linux-tools-common -y<br><br>------------<br>perf top<br>---------------------------------<br>WARNING: perf not found for kernel 5.11.0-25<br><br>  You may need to install the following packages for this specific kernel:<br>    linux-tools-5.11.0-25-generic<br>    linux-cloud-tools-5.11.0-25-generic<br><br>  You may also want to install one of the following packages to keep up to date:<br>    linux-tools-generic<br>    linux-cloud-tools-generic<br><br>------------------------<br>root:~# uname  -r<br>5.11.0-25-generic<br><br>------------------------<br>apt-get install linux-tools-5.11.0-25-generic  linux-cloud-tools-5.11.0-25-generic -y<br><br>-------<br>","like_count":0},{"had_liked":false,"id":318730,"user_name":"🎉晶晶🎉😄","can_delete":false,"product_type":"c1","uid":1169422,"ip_address":"","ucode":"76B608C42E06A8","user_header":"https://static001.geekbang.org/account/avatar/00/11/d8/0e/1bf7f57a.jpg","comment_is_top":false,"comment_ctime":1635406068,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635406068","product_id":100020901,"comment_content":"按方向键切换到 php-fpm，再按下回车键展开 php-fpm 的调用关系   -----  方向键好像选不了，无法展开调用关系","like_count":0},{"had_liked":false,"id":318300,"user_name":"花子翁","can_delete":false,"product_type":"c1","uid":1073674,"ip_address":"","ucode":"A687441DC6894F","user_header":"https://static001.geekbang.org/account/avatar/00/10/62/0a/26d00cb9.jpg","comment_is_top":false,"comment_ctime":1635236018,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1635236018","product_id":100020901,"comment_content":"请问这一套性能问题的追踪流程对java程序有效吗","like_count":0},{"had_liked":false,"id":317327,"user_name":"古月弓虽1993","can_delete":false,"product_type":"c1","uid":1237500,"ip_address":"","ucode":"86122CC701F02A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI3jSpV7VvK6NaUH6X1LNYWGsQdFSTu4SwTZ0nQlSYGTOY2FrDCcMic9qFXnu2ZGR88hBlUQK28Whg/132","comment_is_top":false,"comment_ctime":1634741882,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634741882","product_id":100020901,"comment_content":"curl http:&#47;&#47;192.168.0.10:10000&#47; 在终端里一直没有反应，也不报错。这是什么原因呢","like_count":0},{"had_liked":false,"id":316815,"user_name":"bocai","can_delete":false,"product_type":"c1","uid":2815342,"ip_address":"","ucode":"5598DE77416752","user_header":"https://static001.geekbang.org/account/avatar/00/2a/f5/6e/829cbbb8.jpg","comment_is_top":false,"comment_ctime":1634555912,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634555912","product_id":100020901,"comment_content":"很专业，点赞。","like_count":0},{"had_liked":false,"id":315394,"user_name":"清水","can_delete":false,"product_type":"c1","uid":2559543,"ip_address":"","ucode":"D25F83AA62FD70","user_header":"","comment_is_top":false,"comment_ctime":1633876821,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1633876821","product_id":100020901,"comment_content":"有点懵，top的%wa和pidstat的%wait是一样吗？看描述，前者是等队列，后面是等cpu，感觉是不一样的，还有mpstat的%iowat是等待io时间？","like_count":0,"discussions":[{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578812,"discussion_content":"man top\nwa, IO-wait : time waiting for I/O completion.\n\nman vmstat\nwa: Time spent waiting for IO.  Prior to Linux 2.5.41, included in idle.\n\nman mpstat\n%iowait\n    Show the percentage of time that the CPU or CPUs were idle during which the system had an outstanding disk I/O request.\n\nman iostat\n%iowait\n    Show the percentage of time that the CPU or CPUs were idle during which the system had an outstanding disk I/O request.\n\nman sar\n %iowait\n    Percentage of time that the CPU or CPUs were idle during which the system had an outstanding disk I/O request.\n\n看看这个\n\n大概的意思是iowait和idle都是cpu空闲百分比，区别就是iowait是有io的操作但是cpu是空闲的，idle就是系统没有任何操作的空闲百分比","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657024725,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":312866,"user_name":"宏典","can_delete":false,"product_type":"c1","uid":2616028,"ip_address":"","ucode":"63953F36596C28","user_header":"https://static001.geekbang.org/account/avatar/00/27/ea/dc/aa699264.jpg","comment_is_top":false,"comment_ctime":1632067504,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1632067504","product_id":100020901,"comment_content":"在一台虚拟机执行<br>docker run --name nginx -p 10000:80 -itd feisky&#47;nginx<br>docker run --name phpfpm -itd --network container:nginx feisky&#47;php-fpm<br><br>在另一个虚拟机的终端出现以下问题：<br>david@ubuntu:~$ curl http:&#47;&#47;192.168.221.132:10000&#47;<br>curl: (7) Failed to connect to 192.168.221.132 port 10000: Connection timed out<br><br>查看容器状态：<br>docker container ls<br>CONTAINER ID   IMAGE                COMMAND                  CREATED          STATUS          PORTS                   NAMES<br>0f82db2a0e99   feisky&#47;php-fpm:cpu   &quot;php-fpm -F --pid &#47;o…&quot;   12 minutes ago   Up 12 minutes                           phpfpm<br>611d823e64b3   feisky&#47;nginx:cpu     &quot;&#47;docker-entrypoint.…&quot;   12 minutes ago   Up 12 minutes   0.0.0.0:10000-&gt;80&#47;tcp   nginx<br><br>查看网络状态：<br># docker network ls<br>NETWORK ID     NAME            DRIVER    SCOPE<br>d0ad56eca35c   bridge          bridge    local<br>f9e2293668ba   cloud-lab-net   bridge    local<br>1861c1766290   host            host      local<br>b08ffa201a5c   none            null      local<br><br>请问是什么原因导致的？","like_count":0},{"had_liked":false,"id":312523,"user_name":"邵帅","can_delete":false,"product_type":"c1","uid":1207488,"ip_address":"","ucode":"EB662C972CC248","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/gLC1Z8lYdWPHquZbJCf5FfIDgOJKiapygoyNrl4b5fkibyV2LBnCKV5BjRAYOhPGJxL425rIdSVnibTMEg012S9Pg/132","comment_is_top":false,"comment_ctime":1631848331,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631848331","product_id":100020901,"comment_content":"如果CONFIG_HZ是250，那么使用vmstat看到的中断应该至少是250，但为什么没有那么大呢？","like_count":0},{"had_liked":false,"id":303034,"user_name":"阿鼎","can_delete":false,"product_type":"c1","uid":1042634,"ip_address":"","ucode":"EE763513563F50","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e8/ca/2a7cc193.jpg","comment_is_top":false,"comment_ctime":1626531228,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1626531228","product_id":100020901,"comment_content":"老师，我想perf一下目标进程，但是总是报错 ，其他进程可以正常perf。我google了一下，可能进程比较重，线程数量和内存都比较大，但没有解决方法。请问如何perf比较重的进程？","like_count":0},{"had_liked":false,"id":300019,"user_name":"Geek_8c2731","can_delete":false,"product_type":"c1","uid":1928194,"ip_address":"","ucode":"A87F938209D65A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJkGGBK46EQpqE6zWCncMs14Jw95s191Y6pk3x3gQpNrvSc2YWoFEgUxmJWicibGp7XsFFKaZxuTSnA/132","comment_is_top":false,"comment_ctime":1624956843,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1624956843","product_id":100020901,"comment_content":"perf工具分析热点函数对python和java支持好像不是太友好啊。都是系统调用的函数，没有用户函数","like_count":0},{"had_liked":false,"id":296018,"user_name":"Geek_79d7c1","can_delete":false,"product_type":"c1","uid":2644096,"ip_address":"","ucode":"809544988E5F09","user_header":"","comment_is_top":false,"comment_ctime":1622706717,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622706717","product_id":100020901,"comment_content":"如果有人使用ab命令遇到了apr_socket_recv: Transport endpoint is not connected (107)错误，是因为内核会认为系统受到了SYN flood攻击，使用vim &#47;etc&#47;sysctl.conf 将net.ipv4.tcp_syncookies = 0即可","like_count":0},{"had_liked":false,"id":294814,"user_name":"beyonddream","can_delete":false,"product_type":"c1","uid":2634698,"ip_address":"","ucode":"164A5C373AAE92","user_header":"https://static001.geekbang.org/account/avatar/00/28/33/ca/74100c96.jpg","comment_is_top":false,"comment_ctime":1622099722,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622099722","product_id":100020901,"comment_content":"老师 在我的环境上有多个CPU， 有多个php-fpm进程的占有率都很高，怎么选择是哪个呢？<br>还有<br>  Children      Self  Command          Shared Object             Symbol<br>+   97.75%     0.00%  php-fpm          [unknown]                 [k] 0x41fd89415541f689<br>+   97.75%     0.00%  php-fpm          libc-2.28.so              [.] __libc_start_main<br>+   97.65%     0.00%  php-fpm          php-fpm                   [.] 0x000055f079497697<br>+   97.65%     0.00%  php-fpm          php-fpm                   [.] php_execute_script<br>+   97.65%     0.00%  php-fpm          php-fpm                   [.] zend_execute_scripts<br>+   97.64%     0.00%  php-fpm          php-fpm                   [.] zend_execute<br>+   96.97%    52.52%  php-fpm          php-fpm                   [.] execute_ex<br>+   11.94%    11.30%  php-fpm          php-fpm                   [.] add_function<br>+   11.26%     0.00%  php-fpm          php-fpm                   [.] 0x000055f07944a405<br><br>很多symbol的占有率都很高怎么确定是哪个l呢？<br>","like_count":0},{"had_liked":false,"id":294001,"user_name":"Geek1173","can_delete":false,"product_type":"c1","uid":1732366,"ip_address":"","ucode":"865F0E493E7EDC","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKkFvuiaEntOvrP5Pv2CSBiayjRULB7QdoaDeozRl4hhSbWSP9flNhHu1lPCwM1Yg22bGyEI5iaIS3icQ/132","comment_is_top":false,"comment_ctime":1621674403,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621674403","product_id":100020901,"comment_content":"碰到 CPU 使用率升高的问题，你可以借助 top、pidstat 等工具，确认引发 CPU 性能问题的来源；再使用 perf 等工具，排查出引起性能问题的具体函数。","like_count":0},{"had_liked":false,"id":292306,"user_name":"疯人","can_delete":false,"product_type":"c1","uid":1586002,"ip_address":"","ucode":"D1B28ED5FFE9A9","user_header":"https://static001.geekbang.org/account/avatar/00/18/33/52/77516e4c.jpg","comment_is_top":false,"comment_ctime":1620780031,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1620780031","product_id":100020901,"comment_content":"CPU使用率 主要观察sy和us 就好了吧","like_count":0},{"had_liked":false,"id":287754,"user_name":"清水","can_delete":false,"product_type":"c1","uid":2559543,"ip_address":"","ucode":"D25F83AA62FD70","user_header":"","comment_is_top":false,"comment_ctime":1618133817,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1618133817","product_id":100020901,"comment_content":"perf top -g -p  pid 进入的页面，采样的是这个pid下的所有线程？","like_count":0},{"had_liked":false,"id":286441,"user_name":"竹影","can_delete":false,"product_type":"c1","uid":1211289,"ip_address":"","ucode":"182FC1A9ECBEF3","user_header":"https://static001.geekbang.org/account/avatar/00/12/7b/99/4f5857a8.jpg","comment_is_top":false,"comment_ctime":1617322621,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1617322621","product_id":100020901,"comment_content":"perf命令默认好像在&#47;usr&#47;bin路径下的吧，rpm -ql看一下kernel-tool安装的perf命令在哪，用找到的这个命令","like_count":0},{"had_liked":false,"id":286066,"user_name":"谨兮谨兮","can_delete":false,"product_type":"c1","uid":1376885,"ip_address":"","ucode":"55712DD3852169","user_header":"https://static001.geekbang.org/account/avatar/00/15/02/75/2839c0bb.jpg","comment_is_top":false,"comment_ctime":1617149635,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617149635","product_id":100020901,"comment_content":"top 确定进程 perf top确定函数 进一步可以分析源码， 但是只限于是进程占用导致的高负载，高cpu利用率","like_count":0},{"had_liked":false,"id":284553,"user_name":"小源哥","can_delete":false,"product_type":"c1","uid":1730754,"ip_address":"","ucode":"B5130CE20CF31D","user_header":"https://static001.geekbang.org/account/avatar/00/1a/68/c2/b112da90.jpg","comment_is_top":false,"comment_ctime":1616334127,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1616334127","product_id":100020901,"comment_content":"老师，&#47;proc&#47;stat里user包括guest和guest_nice得时间吗","like_count":0},{"had_liked":false,"id":280870,"user_name":"geek","can_delete":false,"product_type":"c1","uid":2401422,"ip_address":"","ucode":"FF0845140D72A9","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/NyFOEueITjaGLpakMEuWAqVQjo1uDIXlpDdpCxXGfaWiaXzibLQ3WgOFCe8D9FvCmyjsGT7jDsLUbkt8jt2aVs9g/132","comment_is_top":false,"comment_ctime":1614432622,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1614432622","product_id":100020901,"comment_content":"老师，我用的是centos虚拟机，写了一段python代码用来测试，其中有一个函数testLoop：<br>def testLoop():<br>    sum = 1<br>    while sum == 1:<br>        sum = 1<br>为什么用perf top -g -p xxx分析的符号没有testLoop呢？只能看到_PyEval_EvalFrameDefault","like_count":0},{"had_liked":false,"id":272091,"user_name":"鲁宏宾","can_delete":false,"product_type":"c1","uid":2067429,"ip_address":"","ucode":"36CA8ABC6C9A62","user_header":"https://static001.geekbang.org/account/avatar/00/1f/8b/e5/4912a91b.jpg","comment_is_top":false,"comment_ctime":1609931474,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1609931474","product_id":100020901,"comment_content":"老师，请问加入CPU利用率是10%，30%，50%，70%， 100%，怎么评估是否合理，或者有性能瓶颈？","like_count":0},{"had_liked":false,"id":269360,"user_name":"wwf","can_delete":false,"product_type":"c1","uid":2233930,"ip_address":"","ucode":"78635E4B1E9C8A","user_header":"https://static001.geekbang.org/account/avatar/00/22/16/4a/05ff2b5c.jpg","comment_is_top":false,"comment_ctime":1608623522,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608623522","product_id":100020901,"comment_content":"软中断和硬中断这块怎么排查 老师有实战案例吗","like_count":0},{"had_liked":false,"id":263995,"user_name":"会飞的鱼","can_delete":false,"product_type":"c1","uid":1567083,"ip_address":"","ucode":"82E83A7F2F9123","user_header":"https://static001.geekbang.org/account/avatar/00/17/e9/6b/a52282b8.jpg","comment_is_top":false,"comment_ctime":1606309415,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606309415","product_id":100020901,"comment_content":"老师好，我的服务器内核空间的cpu使用率达到了100%，重启了几次依然没有解决，然后我用top查看，没有发现cpu占用很高的进程，用execsnoop也没发现异常，然后用pidstat -w查看，发现rcu_sched的上下文切换很频繁，而且是自愿上下文切换，然后我再用perf top -g -p 9追踪，发现有很多系统调用，这种情况怎么进一步解决呢？ 可以加您微信进一步求教下吗？","like_count":0},{"had_liked":false,"id":255282,"user_name":"一粒","can_delete":false,"product_type":"c1","uid":1582813,"ip_address":"","ucode":"FB5F583CC6AE3C","user_header":"https://static001.geekbang.org/account/avatar/00/18/26/dd/d58156b1.jpg","comment_is_top":false,"comment_ctime":1603293347,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1603293347","product_id":100020901,"comment_content":"这几节课的内容都和操作系统原理关联起来了，可以作为学习操作系统的实践课","like_count":0},{"had_liked":false,"id":255263,"user_name":"一粒","can_delete":false,"product_type":"c1","uid":1582813,"ip_address":"","ucode":"FB5F583CC6AE3C","user_header":"https://static001.geekbang.org/account/avatar/00/18/26/dd/d58156b1.jpg","comment_is_top":false,"comment_ctime":1603291781,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1603291781","product_id":100020901,"comment_content":"老师，用户空间的时钟频率小于内核空间的，是因为一般用户空间的进程会小于在内核空间运行的进程吗","like_count":0},{"had_liked":false,"id":254403,"user_name":"14155084066","can_delete":false,"product_type":"c1","uid":2245375,"ip_address":"","ucode":"EF5BFE8773578C","user_header":"https://static001.geekbang.org/account/avatar/00/22/42/ff/2a067d5d.jpg","comment_is_top":false,"comment_ctime":1603111613,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603111613","product_id":100020901,"comment_content":"perf很好","like_count":0},{"had_liked":false,"id":254265,"user_name":"云韵","can_delete":false,"product_type":"c1","uid":1025622,"ip_address":"","ucode":"3DE26DBAAAEDE6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a6/56/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1603093833,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1603093833","product_id":100020901,"comment_content":"老师，“curl http:&#47;&#47;192.168.0.10:10000&#47;” 这个地址怎么看","like_count":0},{"had_liked":false,"id":253498,"user_name":"Geek_f702be","can_delete":false,"product_type":"c1","uid":1143067,"ip_address":"","ucode":"8E3B5F393C4266","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epumnXjMLYzHkGFhAraIiaAMXpotuUR9PCexBWl25tRLFAvpzs03Hfse4Y1lyeWuryz6z80Fd8AXiaw/132","comment_is_top":false,"comment_ctime":1602754722,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602754722","product_id":100020901,"comment_content":"打卡<br>cpu使用率含义及个字段含义<br>通过top、pidstat确定进程导致cpu问题后可以用perf工具分析应用那个函数调用出问题","like_count":0},{"had_liked":false,"id":253402,"user_name":"郑斌","can_delete":false,"product_type":"c1","uid":2224641,"ip_address":"","ucode":"E253447BAB1E23","user_header":"https://static001.geekbang.org/account/avatar/00/21/f2/01/80521228.jpg","comment_is_top":false,"comment_ctime":1602728171,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602728171","product_id":100020901,"comment_content":"我的系统是centos，下了最新版的pref，top所有进程正常，但想top指定进程（-p）什么也打印不出来。不知道怎么回事","like_count":0},{"had_liked":false,"id":251137,"user_name":"Cathy","can_delete":false,"product_type":"c1","uid":1786203,"ip_address":"","ucode":"9C474FE2C70F38","user_header":"https://static001.geekbang.org/account/avatar/00/1b/41/5b/aa3ca816.jpg","comment_is_top":false,"comment_ctime":1601374662,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601374662","product_id":100020901,"comment_content":"我被卡在这里，进行不下去了，一直没有run成功， 提示connection reset by peer<br><br>$ docker run --name nginx -p 10000:80 -itd feisky&#47;nginx","like_count":0},{"had_liked":false,"id":246022,"user_name":"","can_delete":false,"product_type":"c1","uid":2155540,"ip_address":"","ucode":"","user_header":"","comment_is_top":false,"comment_ctime":1599136605,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1599136605","product_id":100020901,"comment_content":"只看到地址而不是函数名是由于应用程序运行在容器中，它的依赖也都在容器内部，故而perf无法找到PHP符号表。一个简单的解决方法是使用perf record生成perf.data拷贝到容器内部 perf report。拷贝到容器哪里？ perf report在容器外执行还是容器内执行？<br>","like_count":0},{"had_liked":false,"id":245371,"user_name":"Geek_a16bbc","can_delete":false,"product_type":"c1","uid":2008721,"ip_address":"","ucode":"6F12AFEF638413","user_header":"","comment_is_top":false,"comment_ctime":1598926422,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598926422","product_id":100020901,"comment_content":"Time per request:       4.470 [ms] (mean)<br>Time per request:       0.447 [ms] (mean, across all concurrent requests)<br>這兩行的差別是什麼？難道第一行不是across all requests?","like_count":0},{"had_liked":false,"id":245335,"user_name":"Geek_a16bbc","can_delete":false,"product_type":"c1","uid":2008721,"ip_address":"","ucode":"6F12AFEF638413","user_header":"","comment_is_top":false,"comment_ctime":1598917594,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598917594","product_id":100020901,"comment_content":"為什麼USER_HZ 100不是CONFIG_HZ 250的因數？","like_count":0},{"had_liked":false,"id":245327,"user_name":"Front","can_delete":false,"product_type":"c1","uid":1565396,"ip_address":"","ucode":"35593EA52F2EA6","user_header":"https://static001.geekbang.org/account/avatar/00/17/e2/d4/ef86ea64.jpg","comment_is_top":false,"comment_ctime":1598910103,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1598910103","product_id":100020901,"comment_content":"我的环境是Ubuntu18.04.1，内核是5.4.0-42-generic，perf的版本是5.4.44，docker里perf是4.9。这样，在虚拟机里运行perf record，将perf.data拷贝到docker里后，执行perf_4.9，却抱怨docker里的perf版本低。请问老师如何解决这个问题？谢谢","like_count":0,"discussions":[{"author":{"id":1043297,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/eb/61/a9d4b514.jpg","nickname":"atom","note":"","ucode":"F32F980C5246BA","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554269,"discussion_content":"可使用 buster-backports 源更新perf到5.10版本","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646293104,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":244587,"user_name":"Geek_392979","can_delete":false,"product_type":"c1","uid":2149562,"ip_address":"","ucode":"BE8A0B47CDF562","user_header":"","comment_is_top":false,"comment_ctime":1598586071,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598586071","product_id":100020901,"comment_content":"老师， 为什么Centos7下面敲perf top -g -p $pid没有任何输出， 只敲perf top就有输出？","like_count":0},{"had_liked":false,"id":244566,"user_name":"allen","can_delete":false,"product_type":"c1","uid":1334123,"ip_address":"","ucode":"67CD32ACB95013","user_header":"https://static001.geekbang.org/account/avatar/00/14/5b/6b/2ddbeab2.jpg","comment_is_top":false,"comment_ctime":1598583027,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1598583027","product_id":100020901,"comment_content":"为什么我运行你的docker环境老是下载不下来？你能完整发下怎么运行？我说的是完整，从装了个干净的虚拟机开始，怎么操作？当然我能上外网的，谢谢","like_count":0},{"had_liked":false,"id":242412,"user_name":"王梓燕","can_delete":false,"product_type":"c1","uid":2070962,"ip_address":"","ucode":"817463C4659AFA","user_header":"https://static001.geekbang.org/account/avatar/00/1f/99/b2/1588d13a.jpg","comment_is_top":false,"comment_ctime":1597716567,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1597716567","product_id":100020901,"comment_content":"老师 我一直有个困惑， 我们线上服务一般cpu利用率超过60% 就有风险了， cpu是一种资源，按理说不应该越高利用的的越充分吗  cpu 100% 不是利用的最多吗  比较小白 希望老师能帮忙解答","like_count":0,"discussions":[{"author":{"id":1807386,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/94/1a/86859a14.jpg","nickname":"Mr.Liu","note":"","ucode":"04227F9508177B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535424,"discussion_content":"从成本来看,当然是cpu利用率越高越好, 但从用户体验来说, cpu使用率越低越好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638437458,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":240865,"user_name":"小钱钱","can_delete":false,"product_type":"c1","uid":1762210,"ip_address":"","ucode":"E3C626261D6992","user_header":"https://static001.geekbang.org/account/avatar/00/1a/e3/a2/cd0fb064.jpg","comment_is_top":false,"comment_ctime":1597106383,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597106383","product_id":100020901,"comment_content":"老师，课程中有对线程的分析么，工作中也有部分多线程问题导致的性能","like_count":0},{"had_liked":false,"id":238744,"user_name":"欧雄虎(Badguy）","can_delete":false,"product_type":"c1","uid":1573307,"ip_address":"","ucode":"D72B1CC455AA56","user_header":"https://static001.geekbang.org/account/avatar/00/18/01/bb/7d15d44a.jpg","comment_is_top":false,"comment_ctime":1596279547,"is_pvip":true,"replies":[{"id":"88794","content":"看起来是perf安装的有问题，请参考CPU答疑篇","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1596978128,"ip_address":"","comment_id":238744,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1596279547","product_id":100020901,"comment_content":"老师我这边装了perf但用perf report perf.data打不开文件，报错Cannot load tips.txt file, please install perf!辛苦老师帮忙看看","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":502840,"discussion_content":"看起来是perf安装的有问题，请参考CPU答疑篇","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596978128,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":237450,"user_name":"walle","can_delete":false,"product_type":"c1","uid":2084840,"ip_address":"","ucode":"16EF4222060701","user_header":"https://static001.geekbang.org/account/avatar/00/1f/cf/e8/53704fac.jpg","comment_is_top":false,"comment_ctime":1595834000,"is_pvip":false,"replies":[{"id":"88797","content":"用文章里面的步骤更省事������","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1596978501,"ip_address":"","comment_id":237450,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1595834000","product_id":100020901,"comment_content":"我到底是要下载提供链接的docker包里面make run启动docker还是要用文章里面写的这个命令启动docker，如果用下面这个命令下载启动docker 速度很快 <br>$ docker run --name nginx -p 10000:80 -itd feisky&#47;nginx<br>$ docker run --name phpfpm -itd --network container:nginx feisky&#47;php-fpm","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":502424,"discussion_content":"用文章里面的步骤更省事������","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596978501,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":237165,"user_name":"sky","can_delete":false,"product_type":"c1","uid":1207056,"ip_address":"","ucode":"5CEF9A1806298D","user_header":"https://static001.geekbang.org/account/avatar/00/12/6b/10/22f93764.jpg","comment_is_top":false,"comment_ctime":1595695551,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595695551","product_id":100020901,"comment_content":"倪老师你好，关于 等待I&#47;O的CPU使用率一直有一个疑问没弄懂<br>等待I&#47;O时如果有其它就绪任务，则CPU会执行其它任务，否则执行idle任务，这个过程中等待I&#47;O这个动作看起来似乎和消耗CPU时间没有关系，这里怎么理解等待I&#47;O的CPU使用率了","like_count":0},{"had_liked":false,"id":236783,"user_name":"酸辣土豆丝","can_delete":false,"product_type":"c1","uid":1751234,"ip_address":"","ucode":"0E3E4AFB31E1E6","user_header":"https://static001.geekbang.org/account/avatar/00/1a/b8/c2/d1904d74.jpg","comment_is_top":false,"comment_ctime":1595549866,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595549866","product_id":100020901,"comment_content":"先使用top, ps命令查看cpu使用率高的进程，然后再使用pidstat查看是哪种cpu类型使用率高，最后使用per top，来查看具体哪个函数使用率高，针对线上环境，最好使用per records和per report进行线上问题的记录和后续分析","like_count":0},{"had_liked":false,"id":236144,"user_name":"Persevering","can_delete":false,"product_type":"c1","uid":1167965,"ip_address":"","ucode":"535BC0F93DCD79","user_header":"https://static001.geekbang.org/account/avatar/00/11/d2/5d/da1c2278.jpg","comment_is_top":false,"comment_ctime":1595328005,"is_pvip":false,"replies":[{"id":"87244","content":"我没用过SUSE，不过看SUSE文档perf是支持的<br>https:&#47;&#47;documentation.suse.com&#47;sles&#47;12-SP4&#47;html&#47;SLES-all&#47;cha-perf.html<br><br>你在用的时候报什么错误？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1595342537,"ip_address":"","comment_id":236144,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1595328005","product_id":100020901,"comment_content":"在suse linux无法使用perf  record -g<br>请教下该怎么用","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501960,"discussion_content":"我没用过SUSE，不过看SUSE文档perf是支持的\nhttps://documentation.suse.com/sles/12-SP4/html/SLES-all/cha-perf.html\n\n你在用的时候报什么错误？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595342537,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":236143,"user_name":"Persevering","can_delete":false,"product_type":"c1","uid":1167965,"ip_address":"","ucode":"535BC0F93DCD79","user_header":"https://static001.geekbang.org/account/avatar/00/11/d2/5d/da1c2278.jpg","comment_is_top":false,"comment_ctime":1595327920,"is_pvip":false,"replies":[{"id":"87245","content":"报什么错误？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1595342546,"ip_address":"","comment_id":236143,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1595327920","product_id":100020901,"comment_content":"在SUSE上安装了perf，使用perfect record -g  无法收集信息，跳到了帮助页面","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501959,"discussion_content":"报什么错误？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595342546,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":235180,"user_name":"刀刀","can_delete":false,"product_type":"c1","uid":1193232,"ip_address":"","ucode":"9C0FD56AA3950F","user_header":"https://static001.geekbang.org/account/avatar/00/12/35/10/f0e8fc14.jpg","comment_is_top":false,"comment_ctime":1594915306,"is_pvip":false,"replies":[{"id":"86944","content":"这个我没有试过，你安装一下看看是不是解决所有依赖？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1594994913,"ip_address":"","comment_id":235180,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1594915306","product_id":100020901,"comment_content":"老师，这套工具在嵌入式linux环境下能用吗？如果进程，和动态库都是striped过后的，并且编的是非debug版本能用perf找到对应函数吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":501626,"discussion_content":"这个我没有试过，你安装一下看看是不是解决所有依赖？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594994913,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1193232,"avatar":"https://static001.geekbang.org/account/avatar/00/12/35/10/f0e8fc14.jpg","nickname":"刀刀","note":"","ucode":"9C0FD56AA3950F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291908,"discussion_content":"貌似没有arm环境的唉，老师你有的话发我一个吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594996393,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":230545,"user_name":"生活不如诗","can_delete":false,"product_type":"c1","uid":1139515,"ip_address":"","ucode":"FD48EABEEC52B7","user_header":"https://static001.geekbang.org/account/avatar/00/11/63/3b/c5cd68ab.jpg","comment_is_top":false,"comment_ctime":1593414350,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593414350","product_id":100020901,"comment_content":"当发现cpu使用率过高的时候排查思路：<br>1. 首先通过top命令按照cpu使用率排序，查看cpu占用最高的进程，然后查看每个cpu的使用率，可以看到是用户空间使用率高还是内核空间使用率高；<br>2. 可以再通过pidstat命令查看指定进程的cpu使用率是内核空间占用高还是用户空间占用高；<br>3. 通过perf top命令加上-g参数来查看进程的函数调用关系，查看是因为哪个函数导致的cpu使用率过高；<br>4. 通过grep查找包含此函数的文件，来查看源码排查问题；<br>以上是进程cpu占用过高的排查思路。","like_count":0},{"had_liked":false,"id":227106,"user_name":"Li~","can_delete":false,"product_type":"c1","uid":1870306,"ip_address":"","ucode":"5FBA30D0D7DA31","user_header":"https://static001.geekbang.org/account/avatar/00/1c/89/e2/4d314444.jpg","comment_is_top":false,"comment_ctime":1592288931,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592288931","product_id":100020901,"comment_content":"老师，我用的Ubuntu 18.04，perf top -g -p pid时没有数据显示（页面显示：Samples: 0  of event &#39;cpu-clock&#39;, 4000 Hz, Event count (approx.): 0 lost: 0&#47;0 drop: 0&#47;0   Children      Self  ）；但perf top -g有数据显示；这种情况是什么原因呢？","like_count":0},{"had_liked":false,"id":226012,"user_name":"独一无二","can_delete":false,"product_type":"c1","uid":1692320,"ip_address":"","ucode":"A7DE0EA2BD8FE3","user_header":"https://static001.geekbang.org/account/avatar/00/19/d2/a0/c8714628.jpg","comment_is_top":false,"comment_ctime":1591928680,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1591928680","product_id":100020901,"comment_content":"ab -c 10 -n 10000 http:&#47;&#47;10.240.0.5:10000&#47;","like_count":0},{"had_liked":false,"id":223536,"user_name":"jorin@zou","can_delete":false,"product_type":"c1","uid":1564869,"ip_address":"","ucode":"A8CEF7CCF33570","user_header":"https://static001.geekbang.org/account/avatar/00/17/e0/c5/c324a7de.jpg","comment_is_top":false,"comment_ctime":1591110460,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591110460","product_id":100020901,"comment_content":"centos 7 , 内核版本3.2.1 ,perf 之后，什么也看不到？","like_count":0},{"had_liked":false,"id":223340,"user_name":"飞沉血","can_delete":false,"product_type":"c1","uid":2025780,"ip_address":"","ucode":"C3122210A5D79D","user_header":"https://static001.geekbang.org/account/avatar/00/1e/e9/34/2eb0c21a.jpg","comment_is_top":false,"comment_ctime":1591067343,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591067343","product_id":100020901,"comment_content":"我用perf分析程序引起问题的函数，测试程序是用go写的，perf 不会显示函数名，而是一串指针地址，这个时候该怎么办呢？0x0000000000041004","like_count":0},{"had_liked":false,"id":222324,"user_name":"邱荣财","can_delete":false,"product_type":"c1","uid":1958681,"ip_address":"","ucode":"414D74823F8AA5","user_header":"https://static001.geekbang.org/account/avatar/00/1d/e3/19/7eba0a69.jpg","comment_is_top":false,"comment_ctime":1590748762,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590748762","product_id":100020901,"comment_content":"java 的话, 一般用jprofile分析，或者jstack。perf还能直达用户的方法，很厉害！","like_count":0},{"had_liked":false,"id":220864,"user_name":"saidev","can_delete":false,"product_type":"c1","uid":1205899,"ip_address":"","ucode":"15EA36FC88FE64","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ziaPmSdzT0olY0V4l1t7maKLT73FeNPaGqeAE3RuF4ibXW0kt5sqwZg65ENE9Jgdb5ayibEjsHSU4rVVPFogK9k1Q/132","comment_is_top":false,"comment_ctime":1590330704,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590330704","product_id":100020901,"comment_content":"老师，你好，我有个疑问，CPU的利用率在系统层面是怎么计算的。对于那些拥有超线程能力的CPU，系统的CPU利用率跟实际的CPU计算能力是不是不一致的？比如我的系统是只有一颗支持单核双线程的CPU，会被Linux系统识别为两个逻辑CPU。那么此时我运行一个程序占用了CPU利用率为50%，能做每秒1亿次的运算，那么实际上剩下的50%的CPU利用率是不是无法再做每秒1亿次的运算了？因为我听说超线程的CPU也就提升了大概30%的性能。所以这种情况下，CPU的利用率和CPU的计算能力不成正比的吗？","like_count":0},{"had_liked":false,"id":218589,"user_name":"普罗米修斯","can_delete":false,"product_type":"c1","uid":1394030,"ip_address":"","ucode":"DDA7DE4DE371FC","user_header":"https://static001.geekbang.org/account/avatar/00/15/45/6e/11cf22de.jpg","comment_is_top":false,"comment_ctime":1589823130,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589823130","product_id":100020901,"comment_content":"多个CPU的机器的CPU使用率怎么算呢，top的时候%CPU这CPU使用率指标超过了%100，如果有10个CPU，CPU使用率超过100%小于%1000也是正常的吗，愁，没理解这里","like_count":0},{"had_liked":false,"id":216991,"user_name":"Yong","can_delete":false,"product_type":"c1","uid":1912653,"ip_address":"","ucode":"0ADA75C5C68619","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL3OaibxsOia5ZET1iaBsPwDM6NS43lAUTdItqkwZ66fGaaXtjOQYL73IsvY0foscUZlkaZSQPPQNexA/132","comment_is_top":false,"comment_ctime":1589381901,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589381901","product_id":100020901,"comment_content":"打卡，用的centos虚拟机，docker内部安装perf太慢，加之之前有一些使用perf的经验，就借用老师的结果图分析了：D","like_count":0},{"had_liked":false,"id":216626,"user_name":"Yong","can_delete":false,"product_type":"c1","uid":1912653,"ip_address":"","ucode":"0ADA75C5C68619","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL3OaibxsOia5ZET1iaBsPwDM6NS43lAUTdItqkwZ66fGaaXtjOQYL73IsvY0foscUZlkaZSQPPQNexA/132","comment_is_top":false,"comment_ctime":1589297498,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589297498","product_id":100020901,"comment_content":"docker镜像加速. cenos7<br>vim &#47;etc&#47;docker&#47;daemon.json  使用网易镜像{&quot;registry-mirrors&quot;:[&quot;https:&#47;&#47;hub-mirror.c.163.com&#47;&quot;]}<br>保存后<br>systemctl daemon-reload<br>service docker restart<br><br>","like_count":0},{"had_liked":false,"id":212287,"user_name":"ray","can_delete":false,"product_type":"c1","uid":1717235,"ip_address":"","ucode":"10962C711CBC11","user_header":"","comment_is_top":false,"comment_ctime":1588084279,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588084279","product_id":100020901,"comment_content":"老师您好，请问<br>1.  &#47;proc&#47;stat的cpu时间单位都使用USER_HZ计算，而不用CONFIG_HZ计算的原因是因为kernel占用的cpu时间会被换算成USER_HZ吗？<br><br>2. 假设CPU的频率有1G HZ，USER_HZ是100，也就是说CPU每秒中可以分给100个process或thread，每个process或thread可以获得1G &#47; 100 = 10M个cpu cycle(tick)。换成内核态使用CPU时，也是比照上面的方法计算。不知道我这样说是否正确？<br><br>谢谢老师的解答^^","like_count":0},{"had_liked":false,"id":210366,"user_name":"chai","can_delete":false,"product_type":"c1","uid":1202222,"ip_address":"","ucode":"C686EB1B1EBAB6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep66fdwo3ebSicKjf0iacAx4C2tZOthDDD4bSJqib1iauFBK6EoMSWUBp4UbbN2BQlib7mFR3hQD6MUwew/132","comment_is_top":false,"comment_ctime":1587730523,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1587730523","product_id":100020901,"comment_content":"用户空间节拍率 USER_HZ 有什么作用？","like_count":0},{"had_liked":false,"id":207319,"user_name":"dongqh","can_delete":false,"product_type":"c1","uid":1144676,"ip_address":"","ucode":"7ADB792BEAD812","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ajNVdqHZLLDRvUR8zB7ibC76NicIRqhic4ATrXgXMRMpgMz8Uico3Iv1Dbch4XkWIhphP4UyibLTkjf1E6p0zKenTmQ/132","comment_is_top":false,"comment_ctime":1587047043,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587047043","product_id":100020901,"comment_content":"老师，您好：<br>碰到个问题，运行环境为centos6.6 x64。某进程处理数据，正常流程数据处理完成后会入redis；<br>在运行一段时间后（可能会处理几万条数据，可能运行几天时间，触发条件不确定），程序无法将数据成功存入redis，通过日志文件查看也没有日志输出，工作线程cpu使用率在50%左右，内存无异常，即使没有要处理的数据传入，cpu使用率也没有下降，通过redis的moniter查看没有入库操作，所以判断问题在程序本身；查看堆栈信息可以定位到程序内具体函数，最终是在对map的操作上，由于不知道触发条件，还有没有什么好的方法定位问题？","like_count":0},{"had_liked":false,"id":196632,"user_name":"嘎嘣脆","can_delete":false,"product_type":"c1","uid":1130967,"ip_address":"","ucode":"F645068B7DED3F","user_header":"https://static001.geekbang.org/account/avatar/00/11/41/d7/1dde1b9c.jpg","comment_is_top":false,"comment_ctime":1585298577,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585298577","product_id":100020901,"comment_content":"倪老师，我这边有两台同等配置的linux机器，上面部署了influxdb数据库，有一台ip为144的cpu使用率一直接近100%，另一台145的使用率只有百分之十几，而正常的话两台都是百分之十几。144这台内存和磁盘都够用，通过使用前面学的pidstat和vmstat命令和145这台做比较，发现中断和上下文切换挺大的，我怀疑是144这台上的influxdb数据库中的某个数据库被别人不正常使用导致，应该怎么定位具体哪一个数据库呢？","like_count":0},{"had_liked":false,"id":191736,"user_name":"201200986","can_delete":false,"product_type":"c1","uid":1900861,"ip_address":"","ucode":"6042C42D1C904E","user_header":"","comment_is_top":false,"comment_ctime":1584793383,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584793383","product_id":100020901,"comment_content":"user的利用率包含guest吗？看mpstat工具好像不包含呢","like_count":0},{"had_liked":false,"id":191522,"user_name":"痞子胥","can_delete":false,"product_type":"c1","uid":1617678,"ip_address":"","ucode":"3701A981FFF083","user_header":"","comment_is_top":false,"comment_ctime":1584778757,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584778757","product_id":100020901,"comment_content":"老师,我是要在两台虚拟机上分别 安装docker 然后再在docker 里面安装Nginx和PHP吗？","like_count":0},{"had_liked":false,"id":187382,"user_name":"Kvicii.Y","can_delete":false,"product_type":"c1","uid":1442588,"ip_address":"","ucode":"446BFA633569EA","user_header":"https://static001.geekbang.org/account/avatar/00/16/03/1c/c9fe6738.jpg","comment_is_top":false,"comment_ctime":1584096505,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584096505","product_id":100020901,"comment_content":"1.为什么我的perf -g -p [pid]之后观察不到任何记录(cent os7)？<br>2.21515这个pid是如何确定的？名字是一样的啊","like_count":0},{"had_liked":false,"id":187064,"user_name":"winter","can_delete":false,"product_type":"c1","uid":1589721,"ip_address":"","ucode":"9BA0A8AF148C86","user_header":"https://static001.geekbang.org/account/avatar/00/18/41/d9/1a89a8d0.jpg","comment_is_top":false,"comment_ctime":1584003816,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584003816","product_id":100020901,"comment_content":"老师，perf top -g以后，请问children和self的百分数具体是什么意思呢？我查了一下没理解","like_count":0},{"had_liked":false,"id":186742,"user_name":"。。。","can_delete":false,"product_type":"c1","uid":1803113,"ip_address":"","ucode":"F97D05D81A5803","user_header":"https://static001.geekbang.org/account/avatar/00/1b/83/69/a9201594.jpg","comment_is_top":false,"comment_ctime":1583916120,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583916120","product_id":100020901,"comment_content":"自己遇到了这种问题还是束手无策的感觉","like_count":0},{"had_liked":false,"id":185733,"user_name":"皇家救星","can_delete":false,"product_type":"c1","uid":1326106,"ip_address":"","ucode":"89F1274A3835FE","user_header":"https://static001.geekbang.org/account/avatar/00/14/3c/1a/1806ef25.jpg","comment_is_top":false,"comment_ctime":1583672646,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583672646","product_id":100020901,"comment_content":"有两个问题：<br>1 找不到add_function这个函数代码，但是看perf输出却发现这个函数调用消耗cpu与sqrt差不多。这是啥情况<br>2 看perf输出，sqrt前面显示4.96%，是不是说明cpu资源只有4.96%被它占用了？ execute_ex占用了90%，但是展开后所有子项加起来占用才不到50%，是不是说明剩下40%是这个函数自身消耗","like_count":0},{"had_liked":false,"id":185126,"user_name":"Kai","can_delete":false,"product_type":"c1","uid":1132636,"ip_address":"","ucode":"375475599FE136","user_header":"https://static001.geekbang.org/account/avatar/00/11/48/5c/3e46e189.jpg","comment_is_top":false,"comment_ctime":1583490847,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1583490847","product_id":100020901,"comment_content":"老师，最近服务器出现kdevtmpfsi了这个进程cpu占用100%，使用perf stop -g -p 却查不到父进程怎么回事 ","like_count":0},{"had_liked":false,"id":184069,"user_name":"漫游者","can_delete":false,"product_type":"c1","uid":1058856,"ip_address":"","ucode":"7402D9068413D5","user_header":"https://static001.geekbang.org/account/avatar/00/10/28/28/5ffdd123.jpg","comment_is_top":false,"comment_ctime":1583217661,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583217661","product_id":100020901,"comment_content":"等待 CPU 使用率（%wait）；听得好别扭，在等待CPU，怎么会有使用率呢？","like_count":0},{"had_liked":false,"id":180982,"user_name":"宋胖胖","can_delete":false,"product_type":"c1","uid":1857496,"ip_address":"","ucode":"AA828F49CCEABA","user_header":"https://static001.geekbang.org/account/avatar/00/1c/57/d8/e9c8b923.jpg","comment_is_top":false,"comment_ctime":1582452809,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582452809","product_id":100020901,"comment_content":"打卡，， 只有一台物理机试验机，不会用docker。","like_count":0},{"had_liked":false,"id":179453,"user_name":"王金刚","can_delete":false,"product_type":"c1","uid":1813219,"ip_address":"","ucode":"FD8D6D19310DC7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eq3fQlPJzwQRfpg2AlCpaD1znKGeBDX8D4JrJ6KJhuzonicU7FLNelZYDFQzsclNEcdVGzCSUKls3w/132","comment_is_top":false,"comment_ctime":1582008118,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582008118","product_id":100020901,"comment_content":"根据您第一次docker 的构建，curl 后并不是It works! 而是nginx的默认页面；<br>同时ab测试后：Requests per second:    2588.13 [#&#47;sec] (mean)<br>这是为何？<br>CONTAINER ID  IMAGE                            COMMAND               CREATED         STATUS             PORTS                  NAMES<br>b975f1ec4b8c  docker.io&#47;feisky&#47;php-fpm:latest  php-fpm -F --pid ...  14 minutes ago  Up 14 minutes ago  0.0.0.0:10000-&gt;80&#47;tcp  phpfpm<br>8d22ed3fcfea  quay.io&#47;feisky&#47;nginx:latest      nginx -g daemon o...  20 minutes ago  Up 20 minutes ago  0.0.0.0:10000-&gt;80&#47;tcp  nginx","like_count":0},{"had_liked":false,"id":175546,"user_name":"安排","can_delete":false,"product_type":"c1","uid":1260026,"ip_address":"","ucode":"F78CFA9624CAEF","user_header":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","comment_is_top":false,"comment_ctime":1580741591,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1580741591","product_id":100020901,"comment_content":"进程的CPU使用率是否包含进程等待运行的时间这一块有疑问？ 可以使用单核的cpu做实验，跑两个cpu bound进程，看看这两个进程的使用率之和是否大于1，如果大于1，说明包含等待运行的时间，否则不包含。有些版本的pidstat输出也没有%wait这一项，所以这一块存疑。","like_count":0,"discussions":[{"author":{"id":1260026,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","nickname":"安排","note":"","ucode":"F78CFA9624CAEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":169640,"discussion_content":"进程的cpu使用率是不包含%wait时间的。文中感觉有误。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581638573,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":174960,"user_name":"咸鱼与果汁","can_delete":false,"product_type":"c1","uid":1283861,"ip_address":"","ucode":"F79383599ACB02","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoRyUPicEMqGsbsMicHPuvwM8nibfgK8Yt0AibAGUmnic7rLF4zUZ4dBj4ialYz54fOD6sURKwuJIWBNjhg/132","comment_is_top":false,"comment_ctime":1580478778,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580478778","product_id":100020901,"comment_content":"环境：centos7<br>perf top -g -p &lt;pid&gt;<br>只显示：<br>Get:3 http:&#47;&#47;deb.debian.org&#47;debian buster-updates InRelease [49.3Samples: 0  of event &#39;cycles:ppp&#39;, 4000 Hz, Event count (approx.)Children      Self<br>通过perf record -g -p &lt;pid&gt; 文件很大，这个指令一直卡着","like_count":0},{"had_liked":false,"id":174885,"user_name":"Lynch","can_delete":false,"product_type":"c1","uid":1799514,"ip_address":"","ucode":"6F6B3E8AD1FC2F","user_header":"https://static001.geekbang.org/account/avatar/00/1b/75/5a/66c17844.jpg","comment_is_top":false,"comment_ctime":1580447103,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580447103","product_id":100020901,"comment_content":"编译docker镜像时候，stress地址不可用了，完成镜像编译失败","like_count":0},{"had_liked":false,"id":172070,"user_name":"幸猴儿(๑òᆺó๑)","can_delete":false,"product_type":"c1","uid":1312709,"ip_address":"","ucode":"16294369690484","user_header":"https://static001.geekbang.org/account/avatar/00/14/07/c5/b91d88d2.jpg","comment_is_top":false,"comment_ctime":1579082164,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579082164","product_id":100020901,"comment_content":"老师，请问redhat 7.2 top查看到vim进程占用CPU百分之百。这个是什么原因导致的呢！","like_count":0},{"had_liked":false,"id":171805,"user_name":"笑","can_delete":false,"product_type":"c1","uid":1741098,"ip_address":"","ucode":"689A435818403A","user_header":"https://static001.geekbang.org/account/avatar/00/1a/91/2a/c0fb21fa.jpg","comment_is_top":false,"comment_ctime":1579015469,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579015469","product_id":100020901,"comment_content":"补打卡，Day 4，原来top等工具查看到的CPU使用率是一段时间内的平均CPU使用率，我还以为是实时的，学到了。","like_count":0},{"had_liked":false,"id":171605,"user_name":"刘友淙","can_delete":false,"product_type":"c1","uid":1620058,"ip_address":"","ucode":"97F3A69A308313","user_header":"","comment_is_top":false,"comment_ctime":1578974150,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578974150","product_id":100020901,"comment_content":"D5 打卡","like_count":0},{"had_liked":false,"id":169346,"user_name":"杨陆伟","can_delete":false,"product_type":"c1","uid":1108457,"ip_address":"","ucode":"3BC968447406EB","user_header":"https://static001.geekbang.org/account/avatar/00/10/e9/e9/1f95e422.jpg","comment_is_top":false,"comment_ctime":1578319943,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1578319943","product_id":100020901,"comment_content":"老师好，java用perf可以找到调用栈吗？如果不可以，用哪个工具呢？谢谢","like_count":0},{"had_liked":false,"id":166455,"user_name":"Geek_2445e7","can_delete":false,"product_type":"c1","uid":1767507,"ip_address":"","ucode":"27D9640068E609","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIa4tueCVnQKre4ibIMsJdicCCdFlWKDUeyKHrvaOhVibLCZ6yTia8GhoSfsDa4VGkGJzLaTiaQLxRxCnQ/132","comment_is_top":false,"comment_ctime":1577452183,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577452183","product_id":100020901,"comment_content":"老师，有个地方不太明白。程序中是有大量的sqrt计算，但是为何perf top中看到的sqrt只占了不到百分4呢？","like_count":0},{"had_liked":false,"id":162938,"user_name":"绿箭侠","can_delete":false,"product_type":"c1","uid":1528536,"ip_address":"","ucode":"B994F558A98E29","user_header":"https://static001.geekbang.org/account/avatar/00/17/52/d8/123a4981.jpg","comment_is_top":false,"comment_ctime":1576632437,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576632437","product_id":100020901,"comment_content":"老师，文中说top默认使用3秒时间间隔，查看了man手册，没找到，只是想亲自验证这些东西","like_count":0},{"had_liked":false,"id":155671,"user_name":"Christopher","can_delete":false,"product_type":"c1","uid":1757265,"ip_address":"","ucode":"1AC6035DFA4ECB","user_header":"https://static001.geekbang.org/account/avatar/00/1a/d0/51/f1c9ae2d.jpg","comment_is_top":false,"comment_ctime":1574735034,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574735034","product_id":100020901,"comment_content":"day2","like_count":0},{"had_liked":false,"id":144307,"user_name":"Shane","can_delete":false,"product_type":"c1","uid":1291344,"ip_address":"","ucode":"322D0A883BAF16","user_header":"https://static001.geekbang.org/account/avatar/00/13/b4/50/c5dad2dc.jpg","comment_is_top":false,"comment_ctime":1571892691,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571892691","product_id":100020901,"comment_content":"老师，你好。<br><br>之前我在另外一篇文章提问过，”发现top下的进程的cpu使用率的总和明显不等于top中系统总体的cpu使用率的总和“<br><br>提示说在05篇中有答案。<br><br>今天又重新看了两遍05篇的内容。虽然没有特意强调。但是，的却在介绍top下进程的cpu的计算时，提到”进程cpu只是包含了用户态的cpu使用率和内核态的cpu使用率“，并没有提到”io wait cpu使用率“。<br><br>那么，是不是这个原因导致的进程的cpu使用率总和不等于总体的cpu使用率总和呢？<br><br>如果是这样，那么是不是必须通过pidstat来查看进程的io wait的cpu使用率才是准确的呢？","like_count":0},{"had_liked":false,"id":144087,"user_name":"黄展志","can_delete":false,"product_type":"c1","uid":1356083,"ip_address":"","ucode":"EBA342CD89072D","user_header":"https://static001.geekbang.org/account/avatar/00/14/b1/33/8993eae0.jpg","comment_is_top":false,"comment_ctime":1571842111,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571842111","product_id":100020901,"comment_content":"明白了，原来是共享第一台容器的网络命名空间","like_count":0},{"had_liked":false,"id":144082,"user_name":"黄展志","can_delete":false,"product_type":"c1","uid":1356083,"ip_address":"","ucode":"EBA342CD89072D","user_header":"https://static001.geekbang.org/account/avatar/00/14/b1/33/8993eae0.jpg","comment_is_top":false,"comment_ctime":1571841427,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571841427","product_id":100020901,"comment_content":"倪老师，docker run --name  phpfpm -itd --network container:nginx feisky&#47;php-fpm<br><br>这条命令有误<br>应该是多了container:nginx","like_count":0},{"had_liked":false,"id":142215,"user_name":"Mark","can_delete":false,"product_type":"c1","uid":1350902,"ip_address":"","ucode":"D60E5269080BA9","user_header":"https://static001.geekbang.org/account/avatar/00/14/9c/f6/30dfdc9f.jpg","comment_is_top":false,"comment_ctime":1571313557,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571313557","product_id":100020901,"comment_content":"我在执行的时候，php-fpm的进程id一直在变，大家是怎么取的进程id？","like_count":0},{"had_liked":false,"id":140019,"user_name":"嘉木","can_delete":false,"product_type":"c1","uid":1317999,"ip_address":"","ucode":"AF4877693782C0","user_header":"https://static001.geekbang.org/account/avatar/00/14/1c/6f/3ea2a599.jpg","comment_is_top":false,"comment_ctime":1570787413,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570787413","product_id":100020901,"comment_content":"能不能这样理解，iowait的CPU时间实际上是跟其他CPU时间（usr&#47;sys...）的重叠？<br>也就是等待io返回结果的时候，CPU去做其他事情了，可能运行用户态程序，也可能是内核的其他处理","like_count":0},{"had_liked":false,"id":132724,"user_name":"聰","can_delete":false,"product_type":"c1","uid":1517268,"ip_address":"","ucode":"F65760FDD31CEB","user_header":"https://static001.geekbang.org/account/avatar/00/17/26/d4/add17f35.jpg","comment_is_top":false,"comment_ctime":1568203866,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568203866","product_id":100020901,"comment_content":"老师，请问为什么RHEL和centos没有man proc 和man 5 proc呢？","like_count":0},{"had_liked":false,"id":132274,"user_name":"Magic","can_delete":false,"product_type":"c1","uid":1272047,"ip_address":"","ucode":"FD9CEDAA419EB0","user_header":"https://static001.geekbang.org/account/avatar/00/13/68/ef/6264ca3d.jpg","comment_is_top":false,"comment_ctime":1568077506,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568077506","product_id":100020901,"comment_content":"祝倪老师教师节快乐","like_count":0},{"had_liked":false,"id":129734,"user_name":"耿长学","can_delete":false,"product_type":"c1","uid":1309948,"ip_address":"","ucode":"C7A262812854D4","user_header":"https://static001.geekbang.org/account/avatar/00/13/fc/fc/1e235814.jpg","comment_is_top":false,"comment_ctime":1567233704,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1567233704","product_id":100020901,"comment_content":"老师，docker容器不能用了吗？执行docker现在都不行了","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":37769,"discussion_content":"什么错误？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571665210,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":127164,"user_name":"GEEKBANG_9388667","can_delete":false,"product_type":"c1","uid":1267906,"ip_address":"","ucode":"FAF51FEFBB291A","user_header":"https://static001.geekbang.org/account/avatar/00/13/58/c2/51fa1f28.jpg","comment_is_top":false,"comment_ctime":1566572046,"is_pvip":false,"replies":[{"id":"47196","content":"$ docker run --name nginx -p 10000:80 -itd feisky&#47;nginx<br><br>-p 选项加了吗？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1566742970,"ip_address":"","comment_id":127164,"utype":1}],"discussion_count":4,"race_medal":0,"score":"1566572046","product_id":100020901,"comment_content":"[root@localhost ~]# docker ps<br>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES<br>5bb4d6ecb7e9        feisky&#47;php-fpm      &quot;php-fpm -F --pid ...&quot;   About an hour ago   Up About an hour                        phpfpm<br>d6e178b65257        feisky&#47;nginx        &quot;nginx -g &#39;daemon ...&quot;   About an hour ago   Up About an hour                        nginx<br>容器都起来了 可是10000端口就是没有监听，好难","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464349,"discussion_content":"$ docker run --name nginx -p 10000:80 -itd feisky/nginx\n\n-p 选项加了吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566742970,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2070107,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLPcbudQOzUfwoHC4FpVwiaSAuYf0B2CvSLXm4RrTVhhsOibOJTbpvIFI6Zv72D9rQltM4h6icuJq5ibw/132","nickname":"朝旭曦风","note":"","ucode":"1756A0E27948F6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":296045,"discussion_content":"你的环境是ARM的还是X86的，如果是ARM的，需要下载ARM版本的镜像","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596438418,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1800128,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/77/c0/22872965.jpg","nickname":"LindaWang","note":"","ucode":"45368868C3980B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":207450,"discussion_content":"在欧拉OS上php-fpm容器起不来，在Ubuntu 16.04上可以。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584497796,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1800128,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/77/c0/22872965.jpg","nickname":"LindaWang","note":"","ucode":"45368868C3980B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":207443,"discussion_content":"老师，为什么我执行make run时，phpform这个容器拉不起来呢\nCONTAINER ID        IMAGE                COMMAND                  CREATED             STATUS                    PORTS                   NAMES\n2cdd705233a0        feisky/php-fpm:cpu   &#34;php-fpm -F --pid /o…&#34;   2 seconds ago       Exited (1) 1 second ago                           phpfpm\n6561eb279bd6        feisky/nginx:cpu     &#34;nginx -g &#39;daemon of…&#34;   3 seconds ago       Up 2 seconds              0.0.0.0:10000->80/tcp   nginx\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584497362,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":124573,"user_name":"。。。","can_delete":false,"product_type":"c1","uid":1024042,"ip_address":"","ucode":"CE8B93E25E6830","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJOVrjicIjtZ2mMcLw2IUgj8J8vd63J0YbT75rxtnhJsh7h3sqsePpYacPkP4ZibZAGuZoUKciaUpXQw/132","comment_is_top":false,"comment_ctime":1565922636,"is_pvip":false,"replies":[{"id":"45963","content":"看起来是安装错误？重新安装perf试试怎么样","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1566132647,"ip_address":"","comment_id":124573,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1565922636","product_id":100020901,"comment_content":"老师，我使用perf命令时报了这个错：<br>&#47;usr&#47;sbin&#47;perf:line6: &#47;usr&#47;libexec&#47;perf.2.6.32-696.18.7.el6.x86_64:没有这个文件或目录<br><br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463230,"discussion_content":"看起来是安装错误？重新安装perf试试怎么样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566132647,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":124249,"user_name":"拉普拉斯","can_delete":false,"product_type":"c1","uid":1044426,"ip_address":"","ucode":"47B0CC82892ABB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ef/ca/da6ccfaa.jpg","comment_is_top":false,"comment_ctime":1565842173,"is_pvip":false,"replies":[{"id":"45969","content":"请参考14答疑篇","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1566133154,"ip_address":"","comment_id":124249,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1565842173","product_id":100020901,"comment_content":"perf top -g -p 21515<br><br>只是显示16进制的字符","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463082,"discussion_content":"请参考14答疑篇","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566133154,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":119753,"user_name":"小苏","can_delete":false,"product_type":"c1","uid":1501618,"ip_address":"","ucode":"1A4776F948C6F5","user_header":"https://static001.geekbang.org/account/avatar/00/16/e9/b2/6a9203b5.jpg","comment_is_top":false,"comment_ctime":1564673269,"is_pvip":false,"replies":[{"id":"44402","content":"Java程序的分析请参考第14篇的答疑","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1565015413,"ip_address":"","comment_id":119753,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1564673269","product_id":100020901,"comment_content":"老师我写了一个测试程序java的 (cpu密集型): 命令:top -g -p 27476<br>    while (true) {<br>         Math.pow(RandomUtils.nextInt(100), RandomUtils.nextInt(100));<br>     }<br>cpu升上来了但是并没有明确的显示是由于计算次方也就是pow方法造成的<br>接下来我改如何用 perf  定位<br>+   67.60%     0.00%  perf-27476.map      [.] 0x00007f8de749930c                                                                                                                                           ▒<br>-   67.27%     0.90%  libjvm.so           [.] JVM_GetStackTraceElement                                                                                                                                     ▒<br>   - 11.07% JVM_GetStackTraceElement                                                                                                                                                                       ▒<br>      - 15.16% java_lang_Throwable::get_stack_trace_element                                                                                                                                                ▒<br>         - 23.20% java_lang_StackTraceElement::create                                                                                                                                                      ▒<br>            - 14.01% StringTable::intern                                                                                                                                                                   ▒<br>               + 9.21% StringTable::intern                                                                                                                                                                 ▒<br>                 3.22% UTF8::convert_to_unicode                                                                                                                                                            ▒<br>                 3.01% UTF8::unicode_length","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461055,"discussion_content":"Java程序的分析请参考第14篇的答疑","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565015413,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117592,"user_name":"乖，摸摸头","can_delete":false,"product_type":"c1","uid":1611745,"ip_address":"","ucode":"BD92741A11D3CD","user_header":"https://static001.geekbang.org/account/avatar/00/18/97/e1/0f4d90ff.jpg","comment_is_top":false,"comment_ctime":1564100205,"is_pvip":true,"replies":[{"id":"43475","content":"留言中有一些思路，可以参考。专栏第14篇也专门介绍了一些通用的方法","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1564410703,"ip_address":"","comment_id":117592,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1564100205","product_id":100020901,"comment_content":"我这里不显示函数名<br>-   91.97%     0.76%  php-fpm             [.] 0x00000000008c296e                                                         ▒<br>   - 49.94% 0x8c296e                                                                                                     ▒<br>      - 25.30% 0x8c4a7c                                                                                                  ▒<br>           6.50% 0x2127e                                                                                                 ▒<br>           2.23% 0x681b9d                                                                                                ▒<br>           0.98% 0x681b99                                                                                                ▒<br>      - 13.88% 0x98dea3                                                                                                  ▒<br>         - 5.42% 0x98dd97                                                                                                ▒<br>              1.35% 0x815e70                                                                                             ▒<br>        1.72% 0x94ede0                                                                                                   ▒<br>        1.67% 0x8cd729                                                                                                   ▒<br>+   25.36%     0.35%  php-fpm             [.] 0x00000000008c4a7c                                                         ▒<br>+    6.52%     6.50%  libm-2.24.so        [.] 0x000000000002127e                                                         ▒<br>+    6.42%     0.00%  [unknown","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460040,"discussion_content":"留言中有一些思路，可以参考。专栏第14篇也专门介绍了一些通用的方法","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564410703,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117024,"user_name":"程序员老万","can_delete":false,"product_type":"c1","uid":1606177,"ip_address":"","ucode":"061269EFE23EC4","user_header":"","comment_is_top":false,"comment_ctime":1563956637,"is_pvip":false,"replies":[{"id":"43470","content":"一般通过端口映射","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1564410112,"ip_address":"","comment_id":117024,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1563956637","product_id":100020901,"comment_content":"老师，docker的nginx容器，怎么能被外网访问","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459784,"discussion_content":"一般通过端口映射","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564410112,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1079846,"avatar":"https://static001.geekbang.org/account/avatar/00/10/7a/26/7e17def5.jpg","nickname":"马孔多在下雨","note":"","ucode":"58CDDDEF7A80BC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5038,"discussion_content":"我用docker起来后，看到端口是监听的，可是另一台机器连不上","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565888275,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":116043,"user_name":"乖，摸摸头","can_delete":false,"product_type":"c1","uid":1611745,"ip_address":"","ucode":"BD92741A11D3CD","user_header":"https://static001.geekbang.org/account/avatar/00/18/97/e1/0f4d90ff.jpg","comment_is_top":false,"comment_ctime":1563778082,"is_pvip":true,"replies":[{"id":"42484","content":"man 5 proc (man man 查看man的使用方法）","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1563804933,"ip_address":"","comment_id":116043,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563778082","product_id":100020901,"comment_content":"man proc 出现下面的这些东西，并没有文章中所说的<br>proc(n)                                   Tcl Built-In Commands                                  proc(n)<br><br>________________________________________________________________________________________________________<br><br>NAME<br>       proc - Create a Tcl procedure<br><br>SYNOPSIS<br>       proc name args body<br>_________________________________________________________________<br><br>DESCRIPTION<br>       The proc command creates a new Tcl procedure named name, replacing any existing command or proce‐<br>       dure there may have be","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459364,"discussion_content":"man 5 proc (man man 查看man的使用方法）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563804933,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115692,"user_name":"Apollo","can_delete":false,"product_type":"c1","uid":1183821,"ip_address":"","ucode":"3A0C79CCB21FD9","user_header":"https://static001.geekbang.org/account/avatar/00/12/10/4d/f548bc68.jpg","comment_is_top":false,"comment_ctime":1563699779,"is_pvip":false,"replies":[{"id":"42485","content":"不是的，CONFIG_HZ 是配置硬件中断的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1563805016,"ip_address":"","comment_id":115692,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1563699779","product_id":100020901,"comment_content":"我有个问题：User_HZ=100 0.01s 就会产生时间中断，这个0.01是时间片的时间么？如果是时间片的时间内核的CONFIG_HZ又怎么解释呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459234,"discussion_content":"不是的，CONFIG_HZ 是配置硬件中断的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563805016,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114286,"user_name":"喜哥","can_delete":false,"product_type":"c1","uid":1266193,"ip_address":"","ucode":"47FD02C6CF9292","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/sOvjoV6STk6SYPHRqVOo7ExojUbc4NgJAd7pGnyQQfJYFS97pYg744PNibalzy6gqZEicoHS2g6ibzK0OLhP6l0TA/132","comment_is_top":false,"comment_ctime":1563266230,"is_pvip":true,"replies":[{"id":"41973","content":"这是内核中将十六进制的符号地址转换成符号名称的模块，高是正常的，可以忽略","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1563455761,"ip_address":"","comment_id":114286,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1563266230","product_id":100020901,"comment_content":"你好 老师通过perf查看kernel.kallsyms高达40%<br>如何分析呢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458595,"discussion_content":"这是内核中将十六进制的符号地址转换成符号名称的模块，高是正常的，可以忽略","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563455761,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1266193,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/sOvjoV6STk6SYPHRqVOo7ExojUbc4NgJAd7pGnyQQfJYFS97pYg744PNibalzy6gqZEicoHS2g6ibzK0OLhP6l0TA/132","nickname":"喜哥","note":"","ucode":"47FD02C6CF9292","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3323,"discussion_content":"谢谢老师","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564395154,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112056,"user_name":"少盐","can_delete":false,"product_type":"c1","uid":1305743,"ip_address":"","ucode":"BCC7E264B75702","user_header":"https://static001.geekbang.org/account/avatar/00/13/ec/8f/8299495a.jpg","comment_is_top":false,"comment_ctime":1562661530,"is_pvip":false,"replies":[{"id":"42005","content":"不需要额外下载，安装好 Docker 之后，根据案例的步骤操作就可以了","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1563459479,"ip_address":"","comment_id":112056,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562661530","product_id":100020901,"comment_content":"老师，准备工作还麻烦给详细讲讲，不知道怎么配置呀<br>Nginx 和php需要下载吗，文稿中的Docker镜像怎么使用呢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457553,"discussion_content":"不需要额外下载，安装好 Docker 之后，根据案例的步骤操作就可以了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563459479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112002,"user_name":"Geek_joanie","can_delete":false,"product_type":"c1","uid":1502199,"ip_address":"","ucode":"8539C6460823A0","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIpDaC5iar7IyKERaCAXlH4h7dusfTicSaUtmJWlh0Oh0VViamiclBogXwmkYI4Se72vlHIl2NPNj7kxQ/132","comment_is_top":false,"comment_ctime":1562652100,"is_pvip":false,"replies":[{"id":"41999","content":"嗯嗯，有关系。只有 root 权限的文件挂载到容器内部后会无法访问。容器启动进程的时候不是用的 root 用户，你可以 docker exec 到容器内部确认一下。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1563459020,"ip_address":"","comment_id":112002,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562652100","product_id":100020901,"comment_content":"老师，您好，容器运行以后curl发现有permission denied的问题，找了一下是 app&#47;目录下面的php文件除root都没有读权限造成的，改过以后好了。但权限怎么会有问题呢？和运行docker的主机配置相关吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457537,"discussion_content":"嗯嗯，有关系。只有 root 权限的文件挂载到容器内部后会无法访问。容器启动进程的时候不是用的 root 用户，你可以 docker exec 到容器内部确认一下。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563459020,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":111154,"user_name":"昀溪","can_delete":false,"product_type":"c1","uid":1493286,"ip_address":"","ucode":"BFAF31542BC24A","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoCl6Nxf9oW9sDOoibA7p8lKf0jqjPeDszqI4e7iavicQHtbtyibHIhLibyXYAaT02l7GRQvM9BJUxh6yQ/132","comment_is_top":false,"comment_ctime":1562492178,"is_pvip":false,"replies":[{"id":"40434","content":"是的，请参考第14篇如何用perf工具分析Java程序","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1562509278,"ip_address":"","comment_id":111154,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562492178","product_id":100020901,"comment_content":"老师，针对Python程序使用perf命令看不到具体的Python函数，我这里说的函数是自己在Python文件中使用的函数，而它都是显示类似 PyDict_GetItem 或者 pyeval_evalframeex 之类的，这些Python的lib库中的某个.so文件中的内容。我觉得针对这种情况去分析JAVA程序好像也有问题。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457253,"discussion_content":"是的，请参考第14篇如何用perf工具分析Java程序","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562509278,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110542,"user_name":"阿文","can_delete":false,"product_type":"c1","uid":1106209,"ip_address":"","ucode":"BB4DB62141971F","user_header":"https://static001.geekbang.org/account/avatar/00/10/e1/21/5f0bf9a0.jpg","comment_is_top":false,"comment_ctime":1562291854,"is_pvip":false,"replies":[{"id":"40447","content":"这是docker run报的错吗？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1562510502,"ip_address":"","comment_id":110542,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562291854","product_id":100020901,"comment_content":"Failed to open &#47;usr&#47;lib&#47;x86_64-linux-gnu&#47;libxml2.so.2.9.4 遇到这个报错","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456933,"discussion_content":"这是docker run报的错吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562510502,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":109814,"user_name":"增鑫","can_delete":false,"product_type":"c1","uid":1104593,"ip_address":"","ucode":"FC2E07DEE50AE0","user_header":"https://static001.geekbang.org/account/avatar/00/10/da/d1/c7437ae8.jpg","comment_is_top":false,"comment_ctime":1562116764,"is_pvip":false,"replies":[{"id":"40100","content":"嗯嗯，谢谢分享","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1562249842,"ip_address":"","comment_id":109814,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562116764","product_id":100020901,"comment_content":"那个load周期性高但是cpu低的，可以看下是不是有cronb任务导致的大量d状态进程","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456585,"discussion_content":"嗯嗯，谢谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562249842,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":106922,"user_name":"辉晖","can_delete":false,"product_type":"c1","uid":1574062,"ip_address":"","ucode":"E5EC033EE4952B","user_header":"https://static001.geekbang.org/account/avatar/00/18/04/ae/0118c132.jpg","comment_is_top":false,"comment_ctime":1561425041,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561425041","product_id":100020901,"comment_content":"将perf.data拷贝到的容器内部，执行perf report还是显示十六进制的。<br>最下面会提示Cannot load tips.txt file, please install perf","like_count":0},{"had_liked":false,"id":104243,"user_name":"Zack.汤","can_delete":false,"product_type":"c1","uid":1565547,"ip_address":"","ucode":"5F20929B0CA25A","user_header":"https://static001.geekbang.org/account/avatar/00/17/e3/6b/01f6a8ca.jpg","comment_is_top":false,"comment_ctime":1560696757,"is_pvip":false,"replies":[{"id":"37818","content":"加油，手机网络也可以","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1560764460,"ip_address":"","comment_id":104243,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560696757","product_id":100020901,"comment_content":"打卡，这两天搬家（晒网）了，惭愧","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454185,"discussion_content":"加油，手机网络也可以","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560764460,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104234,"user_name":"极光、","can_delete":false,"product_type":"c1","uid":1032893,"ip_address":"","ucode":"9E84CF40D83332","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c2/bd/3f096b55.jpg","comment_is_top":false,"comment_ctime":1560693960,"is_pvip":false,"replies":[{"id":"37819","content":"嗯嗯","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1560764485,"ip_address":"","comment_id":104234,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560693960","product_id":100020901,"comment_content":"perf top 看得不是很直观，还是用perf 生成火焰图好一些","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454182,"discussion_content":"嗯嗯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560764485,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":103179,"user_name":"Butter Fly","can_delete":false,"product_type":"c1","uid":1564473,"ip_address":"","ucode":"D2B488B465FC3C","user_header":"https://static001.geekbang.org/account/avatar/00/17/df/39/6ead11bc.jpg","comment_is_top":false,"comment_ctime":1560391491,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560391491","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":102705,"user_name":"zeech","can_delete":false,"product_type":"c1","uid":1484953,"ip_address":"","ucode":"BB4283A603ECEB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/RzSnI5bpFSKdOsRPDhgeqvXR0SX96gqRXpcxtfibBp3EopeFC50cuAgBkua36cTGyMWiaEz5O1XzL5sOQ4F9cazA/132","comment_is_top":false,"comment_ctime":1560298418,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560298418","product_id":100020901,"comment_content":"干货满满啊。性能分析工具经常用，可是有时候还真不知道分析出来的结果怎么看。","like_count":0},{"had_liked":false,"id":102103,"user_name":"小西几","can_delete":false,"product_type":"c1","uid":1286375,"ip_address":"","ucode":"ED1DDE17534508","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJjzTQ6HPGw2LWLiaiciaibfdMMlmxEwBkBjxOPxeYynZlBKCf6U1b0ezM9IZYibB6yKR7HpRuAOdtj29Q/132","comment_is_top":false,"comment_ctime":1560136863,"is_pvip":false,"replies":[{"id":"37091","content":"看错误消息是内核选项没有开，需要把内核选项打开 CONFIG_PERF_EVENTS=y","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1560259682,"ip_address":"","comment_id":102103,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560136863","product_id":100020901,"comment_content":"老师,您好,执行perf top -g -p javapid   出现了下面这个报错. 系统是CentOS6.9  <br>是不是需要重新编译perf 工具呢?  具体要怎么操作呢 ,谢谢 ~~<br><br><br><br>=====================================================================<br>The sys_perf_event_open() syscall returned with 3 (没有那个进程) for event (cpu-clock).<br>&#47;bin&#47;dmesg may provide additional information.<br>No CONFIG_PERF_EVENTS=y kernel support configured?<br><br><br>Press any key...<br><br><br><br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453260,"discussion_content":"看错误消息是内核选项没有开，需要把内核选项打开 CONFIG_PERF_EVENTS=y","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560259682,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":100379,"user_name":"憨皮苏","can_delete":false,"product_type":"c1","uid":1412429,"ip_address":"","ucode":"D0B4B7660DA766","user_header":"https://static001.geekbang.org/account/avatar/00/15/8d/4d/992070e8.jpg","comment_is_top":false,"comment_ctime":1559541976,"is_pvip":false,"replies":[{"id":"36191","content":"每秒时间中断数","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1559563510,"ip_address":"","comment_id":100379,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1559541976","product_id":100020901,"comment_content":"CPU 节拍率是什么概念？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452525,"discussion_content":"每秒时间中断数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559563510,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":99295,"user_name":"Geek_joanie","can_delete":false,"product_type":"c1","uid":1502199,"ip_address":"","ucode":"8539C6460823A0","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIpDaC5iar7IyKERaCAXlH4h7dusfTicSaUtmJWlh0Oh0VViamiclBogXwmkYI4Se72vlHIl2NPNj7kxQ/132","comment_is_top":false,"comment_ctime":1559187422,"is_pvip":false,"replies":[{"id":"35813","content":"github里面是镜像的源码，切换到目录中执行make build 就可以构建docker镜像","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1559280253,"ip_address":"","comment_id":99295,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1559187422","product_id":100020901,"comment_content":"老师您好，我clone了您的git repo怎么没有找到docker 镜像呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":452050,"discussion_content":"github里面是镜像的源码，切换到目录中执行make build 就可以构建docker镜像","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559280253,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":97702,"user_name":"MGBIN","can_delete":false,"product_type":"c1","uid":1544152,"ip_address":"","ucode":"AFCDDB29BE89A8","user_header":"https://static001.geekbang.org/account/avatar/00/17/8f/d8/4c66b73b.jpg","comment_is_top":false,"comment_ctime":1558751480,"is_pvip":false,"replies":[{"id":"34965","content":"为什么查询说用不到很多计算？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1558793261,"ip_address":"","comment_id":97702,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1558751480","product_id":100020901,"comment_content":"老师能不能解释一下，mysql的慢查询为什么都会伴随着CPU的使用率增高。按理说查询用不到很多的逻辑运算。所以导致CPU增高的本质原因是什么？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451378,"discussion_content":"为什么查询说用不到很多计算？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558793261,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":95670,"user_name":"小周","can_delete":false,"product_type":"c1","uid":1404839,"ip_address":"","ucode":"859210BD669B8C","user_header":"https://static001.geekbang.org/account/avatar/00/15/6f/a7/303c1a6b.jpg","comment_is_top":false,"comment_ctime":1558139841,"is_pvip":false,"replies":[{"id":"34568","content":"不会呀，计算的时候肯定要剔除重复部分","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1558448193,"ip_address":"","comment_id":95670,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1558139841","product_id":100020901,"comment_content":"有个疑问，user已经包含了guest的时间，那么总的CPU时间里面岂不多了一个guest时间？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450550,"discussion_content":"不会呀，计算的时候肯定要剔除重复部分","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558448193,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":94754,"user_name":"李杨欢","can_delete":false,"product_type":"c1","uid":1529256,"ip_address":"","ucode":"94B304E99F8AB1","user_header":"https://static001.geekbang.org/account/avatar/00/17/55/a8/f91c8b21.jpg","comment_is_top":false,"comment_ctime":1557889551,"is_pvip":false,"replies":[{"id":"34176","content":"请参考14答疑篇","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1558096031,"ip_address":"","comment_id":94754,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1557889551","product_id":100020901,"comment_content":"老师您好，我按照课程的方法，在用perf top查找php-fpm进程的函数时，查看了php-fpm的所有PID，并没有发现sqrt这个函数，都是16进制数，请问我可能哪里出问题了呢？我用的是centos7 ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450194,"discussion_content":"请参考14答疑篇","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558096031,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":93940,"user_name":"Musisan","can_delete":false,"product_type":"c1","uid":1500498,"ip_address":"","ucode":"A9A9FE56AABEBA","user_header":"https://static001.geekbang.org/account/avatar/00/16/e5/52/35bc9c07.jpg","comment_is_top":false,"comment_ctime":1557673096,"is_pvip":false,"replies":[{"id":"33786","content":"适用的，只是由于JVM还需要额外配置，具体方法请参考14答疑篇","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1557835804,"ip_address":"","comment_id":93940,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1557673096","product_id":100020901,"comment_content":"老师，我想问下这种的对于java类型的应用适用分析吗？就是运行在jdk环境上的java企业程序。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":449837,"discussion_content":"适用的，只是由于JVM还需要额外配置，具体方法请参考14答疑篇","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557835804,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91552,"user_name":"小兔子乖乖","can_delete":false,"product_type":"c1","uid":1134266,"ip_address":"","ucode":"E5CC0258CF8858","user_header":"https://static001.geekbang.org/account/avatar/00/11/4e/ba/580ec429.jpg","comment_is_top":false,"comment_ctime":1557053988,"is_pvip":false,"replies":[{"id":"33129","content":"可能跟 ipv6 有关，你的机器支持 ipv6 吗？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1557326859,"ip_address":"","comment_id":91552,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1557053988","product_id":100020901,"comment_content":"docker logs phpfpm<br>[05-May-2019 10:26:15] ERROR: failed to create new listening socket: socket(): Address family not supported by protocol (97)<br>[05-May-2019 10:26:15] ERROR: FPM initialization failed<br><br>老师，我把nginx-high-cpu目录下面所有的配置文件listen的端口前面加了0.0.0.0，可是还一样报这个错呢，要怎么解决呢？centos6的系统","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448943,"discussion_content":"可能跟 ipv6 有关，你的机器支持 ipv6 吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557326859,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91422,"user_name":"萌谨熙","can_delete":false,"product_type":"c1","uid":1305680,"ip_address":"","ucode":"FEFA26F3BECB91","user_header":"https://static001.geekbang.org/account/avatar/00/13/ec/50/3868396c.jpg","comment_is_top":false,"comment_ctime":1557034509,"is_pvip":false,"replies":[{"id":"33130","content":"场景是一样的，但这两者的含义不完全一样：平均负载中反应的就是I&#47;O压力，而CPU使用率中反应的是CPU处于等待I&#47;O状态时的时间","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1557327167,"ip_address":"","comment_id":91422,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1557034509","product_id":100020901,"comment_content":"疑惑：<br>我观察到在本节[CPU使用率]中，关于CPU使用率的计算公式是这样的：<br>        CPU 使用率 = 1 - (空闲时间 &#47; 总CPU时间)<br>并附带注解：CPU使用率，就是除了空闲时间外的其他时间占总CPU时间的百分比<br><br>在CPU使用率的计算中，用到的空闲时间(idle)注解原话如下：<br>* idle (通常缩写为id)，代表空闲时间。注意，它不包括等待I&#47;O的时间(iowait)<br><br>那么我可以理解为，iowait是有算在CPU使用率计算中的，即此处的iowait越大，CPU使用率越高。<br><br>现在我们回到第一节[平均负载]看一下相关描述：<br>平均负载时指单位时间内，系统处于可运行状态和不可中断状态的平均进程数。其中不可中断状态指的是处于内核态关键流程中的进程，最常见的是等待硬件设备的I&#47;O响应。<br><br>[平均负载]这一课的小结中又提到：平均负载高并不一定代表CPU使用率高，还有可能是I&#47;O更繁忙了；可以看出此处没有把I&#47;O等待归并到CPU使用率的计算中。但是在[CPU使用率]这一课中，又把I&#47;O等待的时间计算到CPU使用率了。<br><br>那么我的问题是，在[平均负载]中的&quot;等待硬件设备的I&#47;O响应&quot; 和在[CPU使用率]中的“iowait”两者是不是同一个概念？如果是的话，那么请作者检查一下[平均负载]和[CPU使用率]这两节课，看看具体是哪出的描述出现了谬误。<br><br>希望我的表达能够让您知道我遇到的困惑，期待您的回复~","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448913,"discussion_content":"场景是一样的，但这两者的含义不完全一样：平均负载中反应的就是I/O压力，而CPU使用率中反应的是CPU处于等待I/O状态时的时间","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557327167,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89839,"user_name":"大宝","can_delete":false,"product_type":"c1","uid":1321975,"ip_address":"","ucode":"FC1BCF0464B6D6","user_header":"https://static001.geekbang.org/account/avatar/00/14/2b/f7/f5ae026c.jpg","comment_is_top":false,"comment_ctime":1556280822,"is_pvip":false,"replies":[{"id":"32218","content":"检查下系统日志，一般都可以看到重启的原因","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1556370180,"ip_address":"","comment_id":89839,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556280822","product_id":100020901,"comment_content":"生产环境，tomcat启动的时候cpu占用率比较高50%，然后虚拟机就自动重启了，老师我想问的是，linux（centos6.9）是不是有什么机制 会触发自动重启？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448282,"discussion_content":"检查下系统日志，一般都可以看到重启的原因","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556370180,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89424,"user_name":"涛涛","can_delete":false,"product_type":"c1","uid":1180810,"ip_address":"","ucode":"747C4B1F20A2D3","user_header":"https://static001.geekbang.org/account/avatar/00/12/04/8a/ff94bd60.jpg","comment_is_top":false,"comment_ctime":1556172265,"is_pvip":false,"replies":[{"id":"32223","content":"👍谢谢分享","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1556370351,"ip_address":"","comment_id":89424,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1556172265","product_id":100020901,"comment_content":"我是在mac上用的ubuntu虚拟机，安装perf不仅使用了apt install linux-tools-generic，<br>还按照系统提示安装了特定版本的apt install linux-tools-generic-xxxx","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":448126,"discussion_content":"👍谢谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1556370351,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":88362,"user_name":"上善若水","can_delete":false,"product_type":"c1","uid":1122544,"ip_address":"","ucode":"42D2C732E3E6EF","user_header":"https://static001.geekbang.org/account/avatar/00/11/20/f0/84f3cbe0.jpg","comment_is_top":false,"comment_ctime":1555911168,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555911168","product_id":100020901,"comment_content":"老师给我们讲了一个如何挖掘&quot;调皮&quot;代码的故事。将原理知识和工具技能自然的串联起来了。有趣又有收货，多谢多谢～","like_count":0},{"had_liked":false,"id":83197,"user_name":"Maxwell","can_delete":false,"product_type":"c1","uid":1086275,"ip_address":"","ucode":"720A00AD472616","user_header":"https://static001.geekbang.org/account/avatar/00/10/93/43/0e84492d.jpg","comment_is_top":false,"comment_ctime":1554457266,"is_pvip":false,"replies":[{"id":"30188","content":"这是php-fpm的配置，ab的并发数再多，也不会增加php-fpm配置的最大工作线程数","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1554638570,"ip_address":"","comment_id":83197,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554457266","product_id":100020901,"comment_content":"ab的并发请求是10个，为什么top中只有5个php-fpm进程呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445914,"discussion_content":"这是php-fpm的配置，ab的并发数再多，也不会增加php-fpm配置的最大工作线程数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554638570,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81192,"user_name":"大坏狐狸","can_delete":false,"product_type":"c1","uid":1325678,"ip_address":"","ucode":"5044F89A505C5B","user_header":"https://static001.geekbang.org/account/avatar/00/14/3a/6e/e39e90ca.jpg","comment_is_top":false,"comment_ctime":1553827877,"is_pvip":false,"replies":[{"id":"29587","content":"看看perf界面中有没有警告信息？应该会告诉你那些符号找不到","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1554003476,"ip_address":"","comment_id":81192,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553827877","product_id":100020901,"comment_content":"并没有安装docker 直接在vagrant 中运行也是只能看到16进制的函数名。。。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445112,"discussion_content":"看看perf界面中有没有警告信息？应该会告诉你那些符号找不到","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554003476,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":80432,"user_name":"一想再想N","can_delete":false,"product_type":"c1","uid":1003453,"ip_address":"","ucode":"EA22728C2A43F2","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4f/bd/6d825f68.jpg","comment_is_top":false,"comment_ctime":1553660498,"is_pvip":true,"replies":[{"id":"29331","content":"看看系统日志，应该会有重启的原因","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553697618,"ip_address":"","comment_id":80432,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553660498","product_id":100020901,"comment_content":"为啥我在线上服务器执行 perf record 命令机率cpu占用率高的进程，服务器就会自动重启，被坑了两次了。我以为是我操作不对呢，碰到了两次，坑死我了。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444863,"discussion_content":"看看系统日志，应该会有重启的原因","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553697618,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78623,"user_name":"冰凌","can_delete":false,"product_type":"c1","uid":1394578,"ip_address":"","ucode":"5C9EADFEDBF4E5","user_header":"https://static001.geekbang.org/account/avatar/00/15/47/92/f6a832c3.jpg","comment_is_top":false,"comment_ctime":1553184540,"is_pvip":false,"replies":[{"id":"28753","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1553317319,"ip_address":"","comment_id":78623,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553184540","product_id":100020901,"comment_content":"1. CPU使用率怎么计算的？<br>          前面讲过CPU使用率是单位时间内CPU使用情况的统计，如果我们只关注系统的CPU和任务统计信息，可以通过／proc&#47;stat来统计，但是反应的是开机时间以来平均CPU使用率，没有意义<br>          CPU使用率常见的重要指标有：<br>          <br>user（us）<br>用户态CPU的时间，注意不包括nice时间<br>nice（ni）<br>低优先级用户态CPU时间<br>system（sys）<br>内核态CPU时间<br>idle（id）<br>空闲时间，不包括等待I&#47;O的时间（iowait）<br>iowait（wa）<br>等待I&#47;O的CPU时间<br>irq（hi）<br>硬中断的CPU时间<br>softirq（si）<br>处理软中断的CPU时间<br>CPU 使用率，就是除了空闲时间外的其他时间占总 CPU 时间的百分比<br>CPU使用率 = 1 - （空闲时间）／ （总CPU时间）<br>但是实时CPU使用率都是通过以下公式计算的：<br>CPU使用率高 = 1 - 【空闲时间(new）- 空闲时间（old）】／【总CPU时间（new）- 总CPU时间（old）】<br><br>2. 如何查看CPU使用率 <br>        top 显示了系统总体的 CPU 和内存使用情况，以及各个进程的资源使用情况<br>        Ps则只显示了每个进程的资源使用情况<br><br>3. CPU使用率过高怎么办？<br>          方法一：Perf top，它能够实时显示占用 CPU 时钟最多的函数或者指令，因此可以查找热点函数<br>       方法二：perf record 和 perf report。可用于离线分析","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444169,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553317319,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":77243,"user_name":"Jec","can_delete":false,"product_type":"c1","uid":1452205,"ip_address":"","ucode":"3E0C0C13292B03","user_header":"https://static001.geekbang.org/account/avatar/00/16/28/ad/9a2ab0cf.jpg","comment_is_top":false,"comment_ctime":1552895383,"is_pvip":false,"replies":[{"id":"28158","content":"一样的思路，只是java有JVM的存在，从进程上不能直接看到应用的堆栈，所以要先导出符合表","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1552903187,"ip_address":"","comment_id":77243,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1552895383","product_id":100020901,"comment_content":"老师您好，对应java程序的cpu高，怎样排查问题呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443654,"discussion_content":"一样的思路，只是java有JVM的存在，从进程上不能直接看到应用的堆栈，所以要先导出符合表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552903187,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1111985,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f7/b1/982ea185.jpg","nickname":"Frank","note":"","ucode":"9DADD72C193296","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335550,"discussion_content":"先导出符合表是什么意思哦？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608217546,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":74268,"user_name":"小华哥","can_delete":false,"product_type":"c1","uid":1178380,"ip_address":"","ucode":"546EF8803E101F","user_header":"https://static001.geekbang.org/account/avatar/00/11/fb/0c/85d60820.jpg","comment_is_top":false,"comment_ctime":1552150850,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1552150850","product_id":100020901,"comment_content":"发现我对CPU使用率完全处于小白的状态","like_count":0},{"had_liked":false,"id":73526,"user_name":"訫至福临","can_delete":false,"product_type":"c1","uid":1317820,"ip_address":"","ucode":"4192697D776B83","user_header":"https://static001.geekbang.org/account/avatar/00/14/1b/bc/893cb1bb.jpg","comment_is_top":false,"comment_ctime":1551920718,"is_pvip":false,"replies":[{"id":"27320","content":"逐层展开，找比例最高的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1552347924,"ip_address":"","comment_id":73526,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551920718","product_id":100020901,"comment_content":"老师你好，麻烦具体解释下以下结论的推导过程，谢谢：<br><br>按方向键切换到 php-fpm，再按下回车键展开 php-fpm 的调用关系，你会发现，调用关系最终到了 sqrt 和 add_function。<br><br>为什么不是16进制那些，而是这两个更“好”看的，谢谢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442132,"discussion_content":"逐层展开，找比例最高的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552347924,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":71990,"user_name":"Boy-struggle","can_delete":false,"product_type":"c1","uid":1402286,"ip_address":"","ucode":"94113E2837DC29","user_header":"https://static001.geekbang.org/account/avatar/00/15/65/ae/9727318e.jpg","comment_is_top":false,"comment_ctime":1551495353,"is_pvip":false,"replies":[{"id":"26323","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551705352,"ip_address":"","comment_id":71990,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551495353","product_id":100020901,"comment_content":"打卡，cpu使用率之前一直没有深入分析，最大收获是perf","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441420,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551705352,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":71157,"user_name":"陈平","can_delete":false,"product_type":"c1","uid":1247180,"ip_address":"","ucode":"8FFDE00E4BCDAB","user_header":"https://static001.geekbang.org/account/avatar/00/13/07/cc/6601c339.jpg","comment_is_top":false,"comment_ctime":1551275036,"is_pvip":false,"replies":[{"id":"25718","content":"看看perf界面最后一行有什么错误信息？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551399778,"ip_address":"","comment_id":71157,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551275036","product_id":100020901,"comment_content":"docker: net&#47;http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers).<br><br><br>这个问题<br>#下载加速器<br>#curl -sSL https:&#47;&#47;get.daocloud.io&#47;daotools&#47;set_mirror.sh | sh -s http:&#47;&#47;abcd1234.m.daocloud.io<br>#重启docker<br>#systemctl restart docker<br><br><br>chen@p:~$ sudo perf top -g -p 13038<br>[sudo] chen 的密码：<br><br>   PerfTop:       0 irqs&#47;sec  kernel: 0.0%  exact:  0.0% lost: 0&#47;0 drop: 0&#47;0 [4000Hz cycles:ppp],  (target_pid: 13038)<br>----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------<br><br>   PerfTop:       0 irqs&#47;sec  kernel: 0.0%  exact:  0.0% lost: 0&#47;0 drop: 0&#47;0 [4000Hz cycles:ppp],  (target_pid: 13038)<br>----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------<br><br>   PerfTop:       0 irqs&#47;sec  kernel: 0.0%  exact:  0.0% lost: 0&#47;0 drop: 0&#47;0 [4000Hz cycles:ppp],  (target_pid: 13038)<br>----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------<br><br>   PerfTop:       0 irqs&#47;sec  kernel: 0.0%  exact:  0.0% lost: 0&#47;0 drop: 0&#47;0 [4000Hz cycles:ppp],  (target_pid: 13038)<br>----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------<br><br>这个怎么没有函数，就输出上面这些，是版本不对吗<br>chen@p:~$ perf --version<br>perf version 5.0.rc7.ge60b5f","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441018,"discussion_content":"看看perf界面最后一行有什么错误信息？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551399778,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70496,"user_name":"陈平","can_delete":false,"product_type":"c1","uid":1247180,"ip_address":"","ucode":"8FFDE00E4BCDAB","user_header":"https://static001.geekbang.org/account/avatar/00/13/07/cc/6601c339.jpg","comment_is_top":false,"comment_ctime":1551107034,"is_pvip":false,"replies":[{"id":"25362","content":"可以换个时间试试，或者换成国内的镜像，比如<br><br>docker pull dockerhub.azk8s.cn&#47;feisky&#47;nginx","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551195403,"ip_address":"","comment_id":70496,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1551107034","product_id":100020901,"comment_content":"chen@p:~$ sudo docker run --name nginx -p 10000:80 -itd feisky&#47;nginx<br>[sudo] chen 的密码：<br>Unable to find image &#39;feisky&#47;nginx:latest&#39; locally<br>docker: Error response from daemon: Get https:&#47;&#47;registry-1.docker.io&#47;v2&#47;feisky&#47;nginx&#47;manifests&#47;latest: Get https:&#47;&#47;auth.docker.io&#47;token?scope=repository%3Afeisky%2Fnginx%3Apull&amp;service=registry.docker.io: net&#47;http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers).<br>See &#39;docker run --help&#39;.<br>chen@p:~$ sudo docker run --name nginx -p 10000:80 -itd feisky&#47;nginx<br>Unable to find image &#39;feisky&#47;nginx:latest&#39; locally<br>latest: Pulling from feisky&#47;nginx<br>802b00ed6f79: Retrying in 1 second<br>c16436dbc224: Downloading  8.035MB&#47;22.18MB<br>683eac851b28: Download complete<br>5bd58d400603: Downloading<br>c33cad8d5f27: Waiting<br>ae2759a7f424: Waiting<br>docker: net&#47;http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers).<br><br><br>下载安装不了，怎么办","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440664,"discussion_content":"可以换个时间试试，或者换成国内的镜像，比如\n\ndocker pull dockerhub.azk8s.cn/feisky/nginx","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551195403,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1786203,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/41/5b/aa3ca816.jpg","nickname":"Cathy","note":"","ucode":"9C474FE2C70F38","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":309650,"discussion_content":"$ docker pull\n提示403 Forbidden","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601377631,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70476,"user_name":"陈平","can_delete":false,"product_type":"c1","uid":1247180,"ip_address":"","ucode":"8FFDE00E4BCDAB","user_header":"https://static001.geekbang.org/account/avatar/00/13/07/cc/6601c339.jpg","comment_is_top":false,"comment_ctime":1551104640,"is_pvip":false,"replies":[{"id":"25360","content":"镜像拉取超时了，可以再重试下","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551195215,"ip_address":"","comment_id":70476,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551104640","product_id":100020901,"comment_content":"chen@p:~$ sudo docker run --name nginx -p 10000:80 -itd feisky&#47;nginx<br>Unable to find image &#39;feisky&#47;nginx:latest&#39; locally<br>latest: Pulling from feisky&#47;nginx<br>802b00ed6f79: Retrying in 1 second<br>c16436dbc224: Downloading  8.035MB&#47;22.18MB<br>683eac851b28: Download complete<br>5bd58d400603: Downloading<br>c33cad8d5f27: Waiting<br>ae2759a7f424: Waiting<br>docker: net&#47;http: request canceled while waiting for connection (Client.Timeout exceeded while awaiting headers).<br>See &#39;docker run --help&#39;.<br><br><br><br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440655,"discussion_content":"镜像拉取超时了，可以再重试下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551195215,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70330,"user_name":"小猪","can_delete":false,"product_type":"c1","uid":1201662,"ip_address":"","ucode":"EAD6A4876CEF3B","user_header":"https://static001.geekbang.org/account/avatar/00/12/55/fe/ab541300.jpg","comment_is_top":false,"comment_ctime":1551076403,"is_pvip":false,"replies":[{"id":"25355","content":"反应卡顿有多种原因，除了CPU之外，还有内存、磁盘I&#47;O和网络。可以试着从每个资源排查下，后面都会讲到。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551195065,"ip_address":"","comment_id":70330,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551076403","product_id":100020901,"comment_content":"使用top查看，<br>load average: 47.00, 46.92, 46.02  很高，<br>但是CPU使用率是：%Cpu(s): 0.3 us, 0.3 sy, 0.0 ni, 99.3 id, 0.0 wa, 0.0 hi, 0.0 si, 0.0 st<br>系统反应卡顿，这种情况怎么查看问题呢？<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440565,"discussion_content":"反应卡顿有多种原因，除了CPU之外，还有内存、磁盘I/O和网络。可以试着从每个资源排查下，后面都会讲到。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551195065,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70302,"user_name":"BigBao","can_delete":false,"product_type":"c1","uid":1229603,"ip_address":"","ucode":"1002BA63F1657A","user_header":"https://static001.geekbang.org/account/avatar/00/12/c3/23/dbc999e4.jpg","comment_is_top":false,"comment_ctime":1551066550,"is_pvip":false,"replies":[{"id":"25354","content":"嗯嗯，这是很正常的现象，负载不一总是均衡的。不过，也有可能是这几台机器出现了故障。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551194990,"ip_address":"","comment_id":70302,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1551066550","product_id":100020901,"comment_content":"最尴尬的问题就是同一个集群，在其中几台机器CPU正常，但是另外几台机器CPU很高","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440555,"discussion_content":"嗯嗯，这是很正常的现象，负载不一总是均衡的。不过，也有可能是这几台机器出现了故障。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551194990,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69884,"user_name":"极客最靓的仔","can_delete":false,"product_type":"c1","uid":1252439,"ip_address":"","ucode":"156C3A03DBC055","user_header":"https://static001.geekbang.org/account/avatar/00/13/1c/57/1f8c580e.jpg","comment_is_top":false,"comment_ctime":1550896294,"is_pvip":true,"replies":[{"id":"25333","content":"这是中断用到的一个函数，中断频繁的时候就会比较多。不过，这里只是表明它是一个热点函数，具体是不是瓶颈还是要用我们专栏里的方法来定位。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1551193698,"ip_address":"","comment_id":69884,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550896294","product_id":100020901,"comment_content":"  17.09%  [kernel]                         [k] _raw_spin_unlock_irqrestore<br>   4.46%  [kernel]                         [k] finish_task_switch<br>   3.24%  [kernel]                         [k] run_timer_softirq<br>   2.31%  [kernel]                         [k] __do_softirq<br>   1.86%  [kernel]                         [k] sk_run_filter<br>   1.82%  [kernel]                         [k] rcu_process_callbacks<br>   1.51%  [vdso]                           [.] __vdso_clock_gettime<br>   1.50%  [kernel]                         [k] rcu_idle_exit<br>   0.86%  [kernel]                         [k] tick_nohz_idle_exit<br>   0.75%  [kernel]                         [k] copy_user_generic_string<br>   0.72%  [kernel]                         [k] __do_page_fault<br>   0.72%  libc-2.17.so                     [.] __memcpy_ssse3_back<br>   0.67%  [kernel]                         [k] rcu_process_gp_end<br>   0.62%  [kernel]                         [k] check_for_new_grace_period.isra.26<br>   0.52%  [kernel]                         [k] system_call_after_swapgs<br>老师 这是我pert top 看到数据  我看不懂这个几个是什么意思  特别是第一个  有时候他的CPU会很高  可以帮忙解答一下吗  谢谢老师了","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440330,"discussion_content":"这是中断用到的一个函数，中断频繁的时候就会比较多。不过，这里只是表明它是一个热点函数，具体是不是瓶颈还是要用我们专栏里的方法来定位。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551193698,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69424,"user_name":"平安喜乐","can_delete":false,"product_type":"c1","uid":1102350,"ip_address":"","ucode":"B97D8944B0B035","user_header":"https://static001.geekbang.org/account/avatar/00/10/d2/0e/26bf35a4.jpg","comment_is_top":false,"comment_ctime":1550740622,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1550740622","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":68674,"user_name":"张鑫","can_delete":false,"product_type":"c1","uid":1130782,"ip_address":"","ucode":"3BCFBBF35144B8","user_header":"https://static001.geekbang.org/account/avatar/00/11/41/1e/b8586592.jpg","comment_is_top":false,"comment_ctime":1550570570,"is_pvip":false,"replies":[{"id":"24524","content":"这儿说的是CPU使用率，CPU使用率实际上是按照各种进程状态所占用的CPU时间来计算的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550674115,"ip_address":"","comment_id":68674,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550570570","product_id":100020901,"comment_content":"&quot;top中会显示每个进程的 %CPU 列，表示进程的 CPU 使用率。它是用户态和内核态 CPU 使用率的总和，包括进程用户空间使用的 CPU、通过系统调用执行的内核空间 CPU 、以及在就绪队列等待运行的 CPU&quot;，这里没明白，&quot;就绪队列等待运行的CPU&quot;是什么意思，不应该是等待运行的进程吗？被调度的进程是在CPU上运行，CPU怎么会等待运行呢，麻烦老师帮忙解答下。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439791,"discussion_content":"这儿说的是CPU使用率，CPU使用率实际上是按照各种进程状态所占用的CPU时间来计算的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550674115,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":66440,"user_name":"tianming","can_delete":false,"product_type":"c1","uid":1009932,"ip_address":"","ucode":"0BAB735AC9017A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/69/0c/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1549939610,"is_pvip":false,"replies":[{"id":"23736","content":"CPU编号","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1550071105,"ip_address":"","comment_id":66440,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1549939610","product_id":100020901,"comment_content":"请问老师，用了pidstat 之后，在总的cpu使用率后面的还有一列cpu，这个数字代表什么意思？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438801,"discussion_content":"CPU编号","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550071105,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":62412,"user_name":"Robert小七","can_delete":false,"product_type":"c1","uid":1165254,"ip_address":"","ucode":"6BBF4674673AF5","user_header":"https://static001.geekbang.org/account/avatar/00/11/c7/c6/35cc7c7c.jpg","comment_is_top":false,"comment_ctime":1548050734,"is_pvip":false,"replies":[{"id":"22130","content":"推荐在docker之外使用","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548116110,"ip_address":"","comment_id":62412,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548050734","product_id":100020901,"comment_content":"阿里云服务器 CentOS7<br>老师给的docker镜像中没有perf工具，请问如何在docker容器中安装perf工具","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437202,"discussion_content":"推荐在docker之外使用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548116110,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61786,"user_name":"Allen","can_delete":false,"product_type":"c1","uid":1248304,"ip_address":"","ucode":"56F10976A79D20","user_header":"https://static001.geekbang.org/account/avatar/00/13/0c/30/a2e7728a.jpg","comment_is_top":false,"comment_ctime":1547800602,"is_pvip":false,"replies":[{"id":"22330","content":"while 不退出一般是条件判断的问题","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548251406,"ip_address":"","comment_id":61786,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547800602","product_id":100020901,"comment_content":"老师，请教个问题，<br>unsinged long expire =jiffies +msecs_to_jiffies (1000);<br>while(1){<br>      if(time_before(jiffies,expire){<br><br>       break;<br>}<br>为啥这个while 一直不能退出了，难道是cpu 死了，导致jiffies值不再变化吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436994,"discussion_content":"while 不退出一般是条件判断的问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548251406,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61385,"user_name":"lucifer_凡","can_delete":false,"product_type":"c1","uid":1316340,"ip_address":"","ucode":"B249C3A1C1439D","user_header":"https://static001.geekbang.org/account/avatar/00/14/15/f4/085d18a4.jpg","comment_is_top":false,"comment_ctime":1547688845,"is_pvip":false,"replies":[{"id":"22320","content":"那应该是CPU数量比较多了。CPU使用率高推荐看看是不是合理，如何是预期的，就不需要特别关注","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548250306,"ip_address":"","comment_id":61385,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547688845","product_id":100020901,"comment_content":"线上有个进程，cpu使用率达到了几百，但是cpu平均负载却很低，iowait也几乎没有，通过vmstat看上下午切换也不算高，老师这可能会是什么问题呢？这个进程应该在一直处理网络请求较多，应该特别关注这种情况吗","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436858,"discussion_content":"那应该是CPU数量比较多了。CPU使用率高推荐看看是不是合理，如何是预期的，就不需要特别关注","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548250306,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60684,"user_name":"楚天行","can_delete":false,"product_type":"c1","uid":1100648,"ip_address":"","ucode":"B4DD986060ECD4","user_header":"https://static001.geekbang.org/account/avatar/00/10/cb/68/d8a4f907.jpg","comment_is_top":false,"comment_ctime":1547530396,"is_pvip":true,"replies":[{"id":"22307","content":"容器外面找到进程 PID 也可以调试的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1548249089,"ip_address":"","comment_id":60684,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547530396","product_id":100020901,"comment_content":"请问老师，如果一个docker进程跑了CPU 100%，这个时候使用docker exec -it 已经无法进去了，怎么调试这个呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436583,"discussion_content":"容器外面找到进程 PID 也可以调试的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548249089,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58472,"user_name":"李逍遥","can_delete":false,"product_type":"c1","uid":1109750,"ip_address":"","ucode":"DB74823527E203","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/xzHDjCSFicNY3MUMECtNz6sM8yDJhBoyGk5IRoOtUat6ZIkGzxjqEqwqKYWMD3GjehScKvMjicGOGDog5FF18oyg/132","comment_is_top":false,"comment_ctime":1547087817,"is_pvip":false,"replies":[{"id":"21151","content":"这么分析的思路就便了，继续看后面的CPU分析套路和答疑篇，有相关的讲解","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1547124393,"ip_address":"","comment_id":58472,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547087817","product_id":100020901,"comment_content":"php应用，top发现用户空间CPU使用率高<br>all   77.66    0.00    2.92    0.00    0.00    8.12    0.00    0.00    0.00   11.29<br>perf top -g，发现内核swapper进程的native_safe_halt 函数消耗了CPU，后续怎么分析呢？<br>-   37.91%    37.91%  swapper          [kernel.kallsyms]           [k] native_safe_halt<br>        cpu_startup_entry<br>     - arch_cpu_idle                                                                                                                                                       <br>         - 33.24% default_idle                                                                                                                                              <br>              native_safe_halt ","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436077,"discussion_content":"这么分析的思路就便了，继续看后面的CPU分析套路和答疑篇，有相关的讲解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547124393,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56734,"user_name":"孙成子","can_delete":false,"product_type":"c1","uid":1317819,"ip_address":"","ucode":"7DF58E9202FC60","user_header":"https://static001.geekbang.org/account/avatar/00/14/1b/bb/4a749b6c.jpg","comment_is_top":false,"comment_ctime":1546530837,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546530837","product_id":100020901,"comment_content":"Ｄ5","like_count":0},{"had_liked":false,"id":55955,"user_name":"training","can_delete":false,"product_type":"c1","uid":1314657,"ip_address":"","ucode":"88AACE5E41ECC3","user_header":"https://static001.geekbang.org/account/avatar/00/14/0f/61/dc7cc89a.jpg","comment_is_top":false,"comment_ctime":1546354374,"is_pvip":false,"replies":[{"id":"20275","content":"可以用 使用方法请参考第14篇","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546424541,"ip_address":"","comment_id":55955,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546354374","product_id":100020901,"comment_content":"docker 上能用吗？我安装上之后报：<br>WARNING: perf not found for kernel 4.9.125<br><br>  You may need to install the following packages for this specific kernel:<br>    linux-tools-4.9.125-linuxkit<br>    linux-cloud-tools-4.9.125-linuxkit<br><br>  You may also want to install one of the following packages to keep up to date:<br>    linux-tools-linuxkit<br>    linux-cloud-tools-linuxkit<br><br>但apt install 上面四个包后又报错：<br>E: Unable to locate package linux-tools-4.9.125-linuxkit<br>E: Couldn&#39;t find any package by glob &#39;linux-tools-4.9.125-linuxkit&#39;<br>E: Couldn&#39;t find any package by regex &#39;linux-tools-4.9.125-linuxkit&#39;<br>E: Unable to locate package linux-cloud-tools-4.9.125-linuxkit<br>E: Couldn&#39;t find any package by glob &#39;linux-cloud-tools-4.9.125-linuxkit&#39;<br>E: Couldn&#39;t find any package by regex &#39;linux-cloud-tools-4.9.125-linuxkit&#39;<br>E: Unable to locate package linux-tools-linuxkit<br>E: Unable to locate package linux-cloud-tools-linuxkit","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434898,"discussion_content":"可以用 使用方法请参考第14篇","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546424541,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55112,"user_name":"海军上校","can_delete":false,"product_type":"c1","uid":1104290,"ip_address":"","ucode":"7B0D9EC01A3F36","user_header":"https://static001.geekbang.org/account/avatar/00/10/d9/a2/afbc447c.jpg","comment_is_top":false,"comment_ctime":1546045737,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546045737","product_id":100020901,"comment_content":"d5打卡","like_count":0},{"had_liked":false,"id":54646,"user_name":"悬铃木（赵岩）","can_delete":false,"product_type":"c1","uid":1327862,"ip_address":"","ucode":"BB8285E938EE7B","user_header":"https://static001.geekbang.org/account/avatar/00/14/42/f6/6532d23d.jpg","comment_is_top":false,"comment_ctime":1545921617,"is_pvip":false,"replies":[{"id":"19945","content":"可以，只是还需要一些额外的步骤，第14篇有一些参考方法","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1546005581,"ip_address":"","comment_id":54646,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545921617","product_id":100020901,"comment_content":"Java程序也可以这样用perf分析吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434525,"discussion_content":"可以，只是还需要一些额外的步骤，第14篇有一些参考方法","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546005581,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54381,"user_name":"管清麟","can_delete":false,"product_type":"c1","uid":1198013,"ip_address":"","ucode":"7CA1651D0DE257","user_header":"https://static001.geekbang.org/account/avatar/00/12/47/bd/5c34df95.jpg","comment_is_top":false,"comment_ctime":1545839057,"is_pvip":false,"replies":[{"id":"19760","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545886135,"ip_address":"","comment_id":54381,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545839057","product_id":100020901,"comment_content":"打卡第六天","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434440,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545886135,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54275,"user_name":"DigDeeply","can_delete":false,"product_type":"c1","uid":1239008,"ip_address":"","ucode":"113F4D755A1FEC","user_header":"https://static001.geekbang.org/account/avatar/00/12/e7/e0/33521e13.jpg","comment_is_top":false,"comment_ctime":1545819984,"is_pvip":false,"replies":[{"id":"19694","content":"是的，需要特权模式。14篇还有更详细的讲解","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545832981,"ip_address":"","comment_id":54275,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545819984","product_id":100020901,"comment_content":"在容器内启用perf后报错 ：│You may not have permission to collect system-wide stats.         ；<br>需要修改 &#47;proc&#47;sys&#47;kernel&#47;perf_event_paranoid<br>但是修改时又提示 bash: &#47;proc&#47;sys&#47;kernel&#47;perf_event_paranoid: Read-only file system<br>无法修改。<br>对于这种情况，在启动容器时需要携带 --privileged 参数，比如：<br>docker run --privileged --name phpfpm -it --network container:nginx feisky&#47;php-fpm<br>再安装perf之后启动，就可以了~~","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434414,"discussion_content":"是的，需要特权模式。14篇还有更详细的讲解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545832981,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53776,"user_name":"heiman","can_delete":false,"product_type":"c1","uid":1314947,"ip_address":"","ucode":"C1184B13706001","user_header":"https://static001.geekbang.org/account/avatar/00/14/10/83/b3145b4d.jpg","comment_is_top":false,"comment_ctime":1545722299,"is_pvip":false,"replies":[{"id":"19509","content":"开头部分的cpu0、cpu1是各个CPU核的使用率，而后面各个进程的CPU会调度在不同的CPU核上运行。所以一般会看到某个或者几个CPU核使用率高，而其他的可能很低","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545730242,"ip_address":"","comment_id":53776,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545722299","product_id":100020901,"comment_content":"老师，用top命令在每行进城中都有个cpu使用率，再按1又会出来好多的cpu0,cpu1这样的数据。我想问下这几种的关系是什么？为什么有时候进程显示的cpu使用率很高，而cpu0  cpu1显示的却很低？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434237,"discussion_content":"开头部分的cpu0、cpu1是各个CPU核的使用率，而后面各个进程的CPU会调度在不同的CPU核上运行。所以一般会看到某个或者几个CPU核使用率高，而其他的可能很低","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545730242,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52829,"user_name":"wmmmeng","can_delete":false,"product_type":"c1","uid":1117517,"ip_address":"","ucode":"C5E29DBB39BB0F","user_header":"https://static001.geekbang.org/account/avatar/00/11/0d/4d/f692ba8b.jpg","comment_is_top":false,"comment_ctime":1545536644,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545536644","product_id":100020901,"comment_content":"老师，centos6.3的运行不了docker run一类的命令，是版本太低了吗？","like_count":0},{"had_liked":false,"id":52526,"user_name":"David.cui","can_delete":false,"product_type":"c1","uid":1302228,"ip_address":"","ucode":"AB46F310403612","user_header":"https://static001.geekbang.org/account/avatar/00/13/de/d4/b83c4185.jpg","comment_is_top":false,"comment_ctime":1545405303,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545405303","product_id":100020901,"comment_content":"请教一下老师，之前一个项目遇到IBM Power处理器，1cpu有四个逻辑处理器，据说这四个逻辑处理器的处理能力不一样，第一个逻辑处理器跑满物理cpu使用率大约50%第二逻辑cpu跑满物理cpu使用率大约25%。不知道这样的说法是否正确？另外想请教一下老师对于intel或amd的处理器是否也有类似的问题？","like_count":0},{"had_liked":false,"id":52141,"user_name":"饼子","can_delete":false,"product_type":"c1","uid":1085953,"ip_address":"","ucode":"981A44836A5216","user_header":"https://static001.geekbang.org/account/avatar/00/10/92/01/c723d180.jpg","comment_is_top":false,"comment_ctime":1545318911,"is_pvip":false,"replies":[{"id":"19088","content":"谢谢分享","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545386624,"ip_address":"","comment_id":52141,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545318911","product_id":100020901,"comment_content":"我再看一次，使用go语言验证perf 命令时，需要保留符号表才能看到调用具体函数，也就是编译时不能加 ldflags -w -s","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433761,"discussion_content":"谢谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545386624,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":52138,"user_name":"Only now","can_delete":false,"product_type":"c1","uid":1038574,"ip_address":"","ucode":"C617473A03AE27","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d8/ee/6e7c2264.jpg","comment_is_top":false,"comment_ctime":1545317509,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545317509","product_id":100020901,"comment_content":"<br>mark ","like_count":0},{"had_liked":false,"id":52079,"user_name":"maoxiajun","can_delete":false,"product_type":"c1","uid":1198843,"ip_address":"","ucode":"CB4926BC81B3B1","user_header":"https://static001.geekbang.org/account/avatar/00/12/4a/fb/70f14340.jpg","comment_is_top":false,"comment_ctime":1545306191,"is_pvip":false,"replies":[{"id":"18878","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545312459,"ip_address":"","comment_id":52079,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545306191","product_id":100020901,"comment_content":"lesson5打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433733,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545312459,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51187,"user_name":"InfoQ_ef36fd3e61b3","can_delete":false,"product_type":"c1","uid":1296354,"ip_address":"","ucode":"C7006320E4BD68","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoqfN5zibokKwnc08SVEfDfJxAH4mXO9xaAlZ54QoaicGFJic2iaPYI2Z8dJrIgwpvfxdBmM92iasBoQRg/132","comment_is_top":false,"comment_ctime":1545128644,"is_pvip":false,"replies":[{"id":"18456","content":"php容器退出了，试试。运行 docker logs phpfpm 看看什么错误？","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545141949,"ip_address":"","comment_id":51187,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545128644","product_id":100020901,"comment_content":" docker ps -a<br>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                       PORTS                   NAMES<br>10fc91513061        feisky&#47;php-fpm      &quot;php-fpm -F --pid ...&quot;   15 minutes ago      Exited (78) 15 minutes ago                           phpfpm<br>f47112099911        feisky&#47;nginx        &quot;nginx -g &#39;daemon ...&quot;   46 minutes ago      Up 46 minutes                0.0.0.0:10000-&gt;80&#47;tcp   nginx<br><br>请问我run了以后，另外一台连接不上这台的10000端口可能是什么原因呢？<br>curl http:&#47;&#47;10.16.57.155:10000&#47;<br>&lt;html&gt;<br>&lt;head&gt;&lt;title&gt;404 Not Found&lt;&#47;title&gt;&lt;&#47;head&gt;<br>&lt;body&gt;<br>&lt;center&gt;&lt;h1&gt;404 Not Found&lt;&#47;h1&gt;&lt;&#47;center&gt;<br>&lt;hr&gt;&lt;center&gt;nginx&#47;1.15.4&lt;&#47;center&gt;<br>&lt;&#47;body&gt;<br>&lt;&#47;html&gt;<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433331,"discussion_content":"php容器退出了，试试。运行 docker logs phpfpm 看看什么错误？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545141949,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50841,"user_name":"Amark","can_delete":false,"product_type":"c1","uid":1121326,"ip_address":"","ucode":"E5F48633654002","user_header":"https://static001.geekbang.org/account/avatar/00/11/1c/2e/93812642.jpg","comment_is_top":false,"comment_ctime":1545053725,"is_pvip":false,"replies":[{"id":"18471","content":"一个用在用户态去，一个用在内核里，内核负责转换","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545143969,"ip_address":"","comment_id":50841,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545053725","product_id":100020901,"comment_content":"老师您好，用户空间节拍率与内核节拍率有啥关系","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433137,"discussion_content":"一个用在用户态去，一个用在内核里，内核负责转换","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545143969,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50838,"user_name":"Amark","can_delete":false,"product_type":"c1","uid":1121326,"ip_address":"","ucode":"E5F48633654002","user_header":"https://static001.geekbang.org/account/avatar/00/11/1c/2e/93812642.jpg","comment_is_top":false,"comment_ctime":1545053234,"is_pvip":false,"replies":[{"id":"18472","content":"这是个内核的全局变量，用来记录时间。每个CPU的计时都会用到它","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545144312,"ip_address":"","comment_id":50838,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545053234","product_id":100020901,"comment_content":"全局变量 Jiffies 是所有CPU总共的节拍数吗?还是单个CPU的","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":433135,"discussion_content":"这是个内核的全局变量，用来记录时间。每个CPU的计时都会用到它","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545144312,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":50005,"user_name":"miaaa","can_delete":false,"product_type":"c1","uid":1315290,"ip_address":"","ucode":"AE3EA298389D18","user_header":"","comment_is_top":false,"comment_ctime":1544837955,"is_pvip":false,"replies":[{"id":"18107","content":"Linux也是一样的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1545004443,"ip_address":"","comment_id":50005,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544837955","product_id":100020901,"comment_content":"想问下linux下CPU分物理cpu和逻辑cpu的概念吗，比如windows下cpu 4core, 即使某个进程是100% cpu, 但是这个是每个core上cpu使用率之和，平均之后是25%，也不算high cpu问题。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432837,"discussion_content":"Linux也是一样的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545004443,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49937,"user_name":"leaj","can_delete":false,"product_type":"c1","uid":1330884,"ip_address":"","ucode":"94AAEDC8EBED93","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/iaMjvIrqFU9Mc7UhNaYygu2xX9NSiceRfU55ksT3NuGw7OGOeYXeticFDV2BS2OqbVfyTO4udibMsefK0SHau6lf6g/132","comment_is_top":false,"comment_ctime":1544793464,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544793464","product_id":100020901,"comment_content":"老师，空闲时间到底只是idle还是idle + iowait ? 这个有办法验证下吗？我看下面这个描述，貌似是包含的，也就是说最终的使用率并不包含iowait的部分？<br><br>https:&#47;&#47;github.com&#47;Leo-G&#47;DevopsWiki&#47;wiki&#47;How-Linux-CPU-Usage-Time-and-Percentage-is-calculated<br>To calculate Linux CPU usage time subtract the idle CPU time from the total CPU time as follows:<br><br>Total CPU time since boot = user+nice+system+idle+iowait+irq+softirq+steal<br><br>Total CPU Idle time since boot = idle + iowait<br><br>Total CPU usage time since boot = Total CPU time since boot - Total CPU Idle time since boot<br><br>Total CPU percentage = Total CPU usage time since boot&#47;Total CPU time since boot X 100","like_count":0},{"had_liked":false,"id":49770,"user_name":"鹏","can_delete":false,"product_type":"c1","uid":1009228,"ip_address":"","ucode":"243E408E2094E1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/66/4c/39a6829c.jpg","comment_is_top":false,"comment_ctime":1544767187,"is_pvip":false,"replies":[{"id":"17957","content":"perf的功能很强大，使用者也要求有一定的系统和内核知识","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544781424,"ip_address":"","comment_id":49770,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544767187","product_id":100020901,"comment_content":"perf 是一个很好的工具，今后应该会用的比较多","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432768,"discussion_content":"perf的功能很强大，使用者也要求有一定的系统和内核知识","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544781424,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49367,"user_name":"LeeSheen","can_delete":false,"product_type":"c1","uid":1075737,"ip_address":"","ucode":"7A02285009BB7D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTL4iaYPNBC91U6YfClaNNyIIboOrynwpribXiaJFoEPUpFMcMKZb4f5ooL7H3gkybe3Jp74UGMF8J02g/132","comment_is_top":false,"comment_ctime":1544672055,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544672055","product_id":100020901,"comment_content":"<br>老师您好，文章前部有这么一句描述：<br>user（通常缩写为 us），代表用户态 CPU 时间。注意，它不包括下面的 nice 时间，但包括了 guest 时间。<br>对于“包括了 guest 时间”，有些疑问。<br><br>linux在内核update_process_times函数中统计&#47;proc&#47;stat，它调用了account_process_tick函数，在此函数中可以看到：<br><br>void account_process_tick(struct task_struct *p, int user_tick)<br>{<br>        cputime_t one_jiffy_scaled = cputime_to_scaled(cputime_one_jiffy);<br>        struct rq *rq = this_rq();<br><br>        if (vtime_accounting_enabled())<br>                return;<br><br>        if (sched_clock_irqtime) {<br>                irqtime_account_process_tick(p, user_tick, rq);<br>                return;<br>        }<br><br>        if (steal_account_process_tick())<br>                return;<br><br>        if (user_tick)<br>                account_user_time(p, cputime_one_jiffy, one_jiffy_scaled);<br>        else if ((p != rq-&gt;idle) || (irq_count() != HARDIRQ_OFFSET))<br>                account_system_time(p, HARDIRQ_OFFSET, cputime_one_jiffy,<br>                                    one_jiffy_scaled);<br>        else<br>                account_idle_time(cputime_one_jiffy);<br>}<br><br>其中可以看到，account_user_time和account_system_time是区分开的，而account_guest_time又是从account_system_time中获取的，如下所示：<br><br>void account_system_time(struct task_struct *p, int hardirq_offset,<br>                         cputime_t cputime, cputime_t cputime_scaled)<br>{<br>        int index;<br><br>        if ((p-&gt;flags &amp; PF_VCPU) &amp;&amp; (irq_count() - hardirq_offset == 0)) {<br>                account_guest_time(p, cputime, cputime_scaled);<br>                return;<br>        }<br><br>        if (hardirq_count() - hardirq_offset)<br>                index = CPUTIME_IRQ;<br>        else if (in_serving_softirq())<br>                index = CPUTIME_SOFTIRQ;<br>        else<br>                index = CPUTIME_SYSTEM;<br><br>        __account_system_time(p, cputime, cputime_scaled, index);<br>}<br><br>所以我认为user时间中，是不会包含guest的时间的，望指教。","like_count":0},{"had_liked":false,"id":49221,"user_name":"Blue_Eye","can_delete":false,"product_type":"c1","uid":1055764,"ip_address":"","ucode":"2FCF83951ABD7C","user_header":"https://static001.geekbang.org/account/avatar/00/10/1c/14/2388d9e4.jpg","comment_is_top":false,"comment_ctime":1544625670,"is_pvip":false,"replies":[{"id":"17656","content":"加油","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544660332,"ip_address":"","comment_id":49221,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544625670","product_id":100020901,"comment_content":"感觉自己学的挺慢的，两个星期才看到这里，吸收的有点慢，希望自己坚持，加油！！加油💪","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432536,"discussion_content":"加油","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544660332,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48849,"user_name":"尘封","can_delete":false,"product_type":"c1","uid":1247006,"ip_address":"","ucode":"CEE0C006387A03","user_header":"https://static001.geekbang.org/account/avatar/00/13/07/1e/bdbe93f4.jpg","comment_is_top":false,"comment_ctime":1544572136,"is_pvip":false,"replies":[{"id":"17696","content":"看工具，有的工具会把CPU使用率叠加，有的会取平均值。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544661927,"ip_address":"","comment_id":48849,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544572136","product_id":100020901,"comment_content":"老师，centos下，有时看到某个进程cpu利用率1000%多，这个是怎么计算出来的？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432386,"discussion_content":"看工具，有的工具会把CPU使用率叠加，有的会取平均值。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544661927,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48725,"user_name":"如果","can_delete":false,"product_type":"c1","uid":1320638,"ip_address":"","ucode":"138A3EEEE50850","user_header":"","comment_is_top":false,"comment_ctime":1544522882,"is_pvip":false,"replies":[{"id":"17704","content":"👍","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544662081,"ip_address":"","comment_id":48725,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544522882","product_id":100020901,"comment_content":"DAY5,打卡","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432330,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544662081,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48579,"user_name":"John","can_delete":false,"product_type":"c1","uid":1064810,"ip_address":"","ucode":"5C0CCF51E88015","user_header":"https://static001.geekbang.org/account/avatar/00/10/3f/6a/c4f82e49.jpg","comment_is_top":false,"comment_ctime":1544491176,"is_pvip":false,"replies":[{"id":"17848","content":"可以运行其他任务，只是不能被信号打断，比如你不能kill","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544746399,"ip_address":"","comment_id":48579,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544491176","product_id":100020901,"comment_content":"老师，iowait的时间，cpu在等待io返回结果，所以不能运行其他任务，所以不属于idle时间是吗？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432256,"discussion_content":"可以运行其他任务，只是不能被信号打断，比如你不能kill","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544746399,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":48083,"user_name":"耿长学","can_delete":false,"product_type":"c1","uid":1309948,"ip_address":"","ucode":"C7A262812854D4","user_header":"https://static001.geekbang.org/account/avatar/00/13/fc/fc/1e235814.jpg","comment_is_top":false,"comment_ctime":1544344886,"is_pvip":false,"replies":[{"id":"17288","content":"找不到依赖库和符号表导致的，我在后面的答疑中再详细讲一下这个问题","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544437037,"ip_address":"","comment_id":48083,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544344886","product_id":100020901,"comment_content":"老师，我的也是CentOS7.4系统，排查不到具体的函数，都是十六进制，名称排查不出来，是什么原因呢？是不是没有安装PHP程序","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432018,"discussion_content":"找不到依赖库和符号表导致的，我在后面的答疑中再详细讲一下这个问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544437037,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47915,"user_name":"一念无明","can_delete":false,"product_type":"c1","uid":1324487,"ip_address":"","ucode":"2BDEC60A3590A1","user_header":"https://static001.geekbang.org/account/avatar/00/14/35/c7/9e292197.jpg","comment_is_top":false,"comment_ctime":1544256223,"is_pvip":false,"replies":[{"id":"17057","content":"没有绝对的的标准，有的时候你看到了90% 也不代表有IO的性能瓶颈，它只是告诉你进程在等待资源时占有的时间比例。具体是不是有问题还需要其他指标来确认，比如磁盘I&#47;O的繁忙情况","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544279415,"ip_address":"","comment_id":47915,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544256223","product_id":100020901,"comment_content":"老师，使用top命令显示的结果，Cpu(s)这一栏的%wa多高才算高呢？有没有一个基准值？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431943,"discussion_content":"没有绝对的的标准，有的时候你看到了90% 也不代表有IO的性能瓶颈，它只是告诉你进程在等待资源时占有的时间比例。具体是不是有问题还需要其他指标来确认，比如磁盘I/O的繁忙情况","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544279415,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47872,"user_name":"往事随风，顺其自然","can_delete":false,"product_type":"c1","uid":1235692,"ip_address":"","ucode":"F266EC6B143E38","user_header":"https://static001.geekbang.org/account/avatar/00/12/da/ec/779c1a78.jpg","comment_is_top":false,"comment_ctime":1544242010,"is_pvip":false,"replies":[{"id":"17042","content":"点击链接看下github，里面有Dockerfile，执行make build就可以生成镜像","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544255272,"ip_address":"","comment_id":47872,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544242010","product_id":100020901,"comment_content":"老师，能不能再弄一个nginx和php制作成docker镜像的文档，搞环境搞了好久，有不少问题。<br>centos下操作不相同","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431921,"discussion_content":"点击链接看下github，里面有Dockerfile，执行make build就可以生成镜像","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544255272,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47722,"user_name":"元天夫","can_delete":false,"product_type":"c1","uid":1315599,"ip_address":"","ucode":"A453A2EBA77780","user_header":"","comment_is_top":false,"comment_ctime":1544186591,"is_pvip":false,"replies":[{"id":"17007","content":"加油","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544192954,"ip_address":"","comment_id":47722,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544186591","product_id":100020901,"comment_content":"已经落下了两节课，打卡，提醒下自己","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431869,"discussion_content":"加油","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544192954,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47618,"user_name":"krain","can_delete":false,"product_type":"c1","uid":1169438,"ip_address":"","ucode":"64A5FC10B5CCD2","user_header":"https://static001.geekbang.org/account/avatar/00/11/d8/1e/f495cac7.jpg","comment_is_top":false,"comment_ctime":1544166042,"is_pvip":false,"replies":[{"id":"17047","content":"需要注意下top默认显示的是所有CPU使用的平均值，你可能会注意到我在案例中都会通过1切换到每个CPU的使用情况。至于会不会报警就取决于你的报警策略了","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544257032,"ip_address":"","comment_id":47618,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1544166042","product_id":100020901,"comment_content":"老师，请教一下，我一台48核的服务器，top查看有一个进程的cpu使用率200%多，但cpu总使用率10%左右，这样的使用率正常吗，会不会触发监控报警？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431835,"discussion_content":"需要注意下top默认显示的是所有CPU使用的平均值，你可能会注意到我在案例中都会通过1切换到每个CPU的使用情况。至于会不会报警就取决于你的报警策略了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544257032,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47128,"user_name":"niz","can_delete":false,"product_type":"c1","uid":1333708,"ip_address":"","ucode":"942576EE3B31F3","user_header":"https://static001.geekbang.org/account/avatar/00/14/59/cc/b7488e4c.jpg","comment_is_top":false,"comment_ctime":1544060798,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1544060798","product_id":100020901,"comment_content":"朋友推荐的课程，希望尽快跟上节奏","like_count":0},{"had_liked":false,"id":46973,"user_name":"Shengyin","can_delete":false,"product_type":"c1","uid":1334786,"ip_address":"","ucode":"1A88F422FFB06B","user_header":"https://static001.geekbang.org/account/avatar/00/14/5e/02/3ac2eb73.jpg","comment_is_top":false,"comment_ctime":1544012774,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1544012774","product_id":100020901,"comment_content":"是不是生产系统都必须预装pidstat、perf等工具？如果没有的话是不是能用的手段基本上就没没辙了？","like_count":0,"discussions":[{"author":{"id":1069269,"avatar":"https://static001.geekbang.org/account/avatar/00/10/50/d5/73334a95.jpg","nickname":"doos","note":"","ucode":"7C9AF67F90E65C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578904,"discussion_content":"是了需要提前安装","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657086593,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46869,"user_name":"Blue sky","can_delete":false,"product_type":"c1","uid":1337182,"ip_address":"","ucode":"9551E5AC118AF5","user_header":"","comment_is_top":false,"comment_ctime":1543994507,"is_pvip":false,"replies":[{"id":"16758","content":"这是找不到符号表导致的，可以参考下留言里回复解决","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544017205,"ip_address":"","comment_id":46869,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543994507","product_id":100020901,"comment_content":"朋飞哥好，我这里使用perf top -g -p id 之后，再打开php-fpm的堆栈信息，并没有显示具体的函数名称，是perf版本的原因么？perf版本3.10.0系统centos7.3.1611  内核版本 3.10.1.517.e17.x86_64","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431579,"discussion_content":"这是找不到符号表导致的，可以参考下留言里回复解决","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544017205,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46745,"user_name":"仲鬼","can_delete":false,"product_type":"c1","uid":1314692,"ip_address":"","ucode":"DB1CD7052D5BA6","user_header":"https://static001.geekbang.org/account/avatar/00/14/0f/84/d8e63885.jpg","comment_is_top":false,"comment_ctime":1543976629,"is_pvip":false,"replies":[{"id":"16767","content":"1. 当然还是进程的CPU时间<br>2. iowait只是个参考，后面IO部分会介绍IO的性能指标，比如磁盘IO的响应时间和使用率等","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1544018048,"ip_address":"","comment_id":46745,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543976629","product_id":100020901,"comment_content":"老师好，请教2个问题：<br>1. nice时间指“调整进程nice值所用的时间”，还是“nice值为1-19的进程占用CPU的时间”？<br>2. man proc提到iowait not reliable，那有没有类似的指标替代iowait？<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431525,"discussion_content":"1. 当然还是进程的CPU时间\n2. iowait只是个参考，后面IO部分会介绍IO的性能指标，比如磁盘IO的响应时间和使用率等","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544018048,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46430,"user_name":"Zenppl","can_delete":false,"product_type":"c1","uid":1322987,"ip_address":"","ucode":"093795428BADB7","user_header":"https://static001.geekbang.org/account/avatar/00/14/2f/eb/5dceac8a.jpg","comment_is_top":false,"comment_ctime":1543924709,"is_pvip":false,"replies":[{"id":"16599","content":"👍谢谢分享","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543927677,"ip_address":"","comment_id":46430,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543924709","product_id":100020901,"comment_content":"分享下我的perf安装方式<br>ubuntu server 16.04<br>apt install linux-tools-common<br>$ perf 提示安装以下指定版本的tools<br>linux-tools-4.4.0-24-generic<br>linux-cloud-tools-4.4.0-24-generic<br><br>分别apt install后perf --version安装成功<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431458,"discussion_content":"👍谢谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543927677,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46429,"user_name":"Zenppl","can_delete":false,"product_type":"c1","uid":1322987,"ip_address":"","ucode":"093795428BADB7","user_header":"https://static001.geekbang.org/account/avatar/00/14/2f/eb/5dceac8a.jpg","comment_is_top":false,"comment_ctime":1543923839,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543923839","product_id":100020901,"comment_content":"老师，我的问题找到了，我装的perf版本应该有问题","like_count":0},{"had_liked":false,"id":46412,"user_name":"Zenppl","can_delete":false,"product_type":"c1","uid":1322987,"ip_address":"","ucode":"093795428BADB7","user_header":"https://static001.geekbang.org/account/avatar/00/14/2f/eb/5dceac8a.jpg","comment_is_top":false,"comment_ctime":1543917921,"is_pvip":false,"replies":[{"id":"16601","content":"嗯，安装软件包是个基本功","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543927733,"ip_address":"","comment_id":46412,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543917921","product_id":100020901,"comment_content":"老师好，ubuntu server 16.04,没有自带perf，下载source通过make安装，执行perf top -g -p [pid]后一直在刷新，并提示如下。是我装的姿势不对么？<br>Mapped keys:<br>\t[d]     display refresh delay.             \t(2)<br>\t[e]     display entries (lines).           \t(63)<br>\t[f]     profile display filter (count).    \t(5)<br>\t[F]     annotate display filter (percent). \t(5%)<br>\t[s]     annotate symbol.                   \t(NULL)<br>\t[S]     stop annotation.<br>\t[K]     hide kernel_symbols symbols.     \t(no)<br>\t[U]     hide user symbols.               \t(no)<br>\t[z]     toggle sample zeroing.             \t(0)<br>\t[qQ]    quit.<br><br>Enter selection, or unmapped key to continue:  <br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431451,"discussion_content":"嗯，安装软件包是个基本功","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543927733,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46152,"user_name":"阿汜","can_delete":false,"product_type":"c1","uid":1205987,"ip_address":"","ucode":"0206C81A71284E","user_header":"https://static001.geekbang.org/account/avatar/00/12/66/e3/5fae81d2.jpg","comment_is_top":false,"comment_ctime":1543854907,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543854907","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":46150,"user_name":"ichen","can_delete":false,"product_type":"c1","uid":1156973,"ip_address":"","ucode":"2A931EBE9098D0","user_header":"https://static001.geekbang.org/account/avatar/00/11/a7/6d/19bff1f9.jpg","comment_is_top":false,"comment_ctime":1543854448,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543854448","product_id":100020901,"comment_content":"对于perf top -g只看到十六进制码的问题，我在enable perf的dwarf feature后解决。<br>具体就是先安装这个: sudo apt-get install libdw-dev<br>然后再从源码重新编译perf。 <br>ref: https:&#47;&#47;stackoverflow.com&#47;questions&#47;18504690&#47;perf-can-find-symbol-in-the-kernel-but-can-not-find-symbol-in-my-program-how-t?lq=1","like_count":0},{"had_liked":false,"id":46063,"user_name":"陳先森","can_delete":false,"product_type":"c1","uid":1229006,"ip_address":"","ucode":"0F7AC617E3FE90","user_header":"https://static001.geekbang.org/account/avatar/00/12/c0/ce/fc41ad5e.jpg","comment_is_top":false,"comment_ctime":1543841051,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543841051","product_id":100020901,"comment_content":"老师按照你给的这个命令查看perf top -g -p 2995，查看的都是16进制的地址，然后也看不出调用关系，然后看见你给下面的同学留言，使用以下方式操作：只看到地址而不是函数名是由于应用程序运行在容器中，它的依赖也都在容器内部，故而perf无法找到PHP符号表。具体不是太明白这个是怎么操作，因为docker里面你这边构建的都是最小化，很多命令都没有装···能否给个大概的具体流程。","like_count":0},{"had_liked":false,"id":46060,"user_name":"陳先森","can_delete":false,"product_type":"c1","uid":1229006,"ip_address":"","ucode":"0F7AC617E3FE90","user_header":"https://static001.geekbang.org/account/avatar/00/12/c0/ce/fc41ad5e.jpg","comment_is_top":false,"comment_ctime":1543840277,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543840277","product_id":100020901,"comment_content":"perf top -g -p 2811<br>请问下老师这个命令是够要进到容器内部去看，宿主机上面确实看不到调用关系···<br><br>","like_count":0},{"had_liked":false,"id":45950,"user_name":"f","can_delete":false,"product_type":"c1","uid":1027733,"ip_address":"","ucode":"8849D39F700E4B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ae/95/d1b13c9e.jpg","comment_is_top":false,"comment_ctime":1543824466,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543824466","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":45845,"user_name":"划时代","can_delete":false,"product_type":"c1","uid":1061454,"ip_address":"","ucode":"9554CE2F83B77F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/2o1Izf2YyJSnnI0ErZ51pYRlnrmibqUTaia3tCU1PjMxuwyXSKOLUYiac2TQ5pd5gNGvS81fVqKWGvDsZLTM8zhWg/132","comment_is_top":false,"comment_ctime":1543803026,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543803026","product_id":100020901,"comment_content":"打卡day6","like_count":0},{"had_liked":false,"id":45761,"user_name":"一生一世","can_delete":false,"product_type":"c1","uid":1254081,"ip_address":"","ucode":"D8C3E55A920676","user_header":"https://static001.geekbang.org/account/avatar/00/13/22/c1/d402bfbf.jpg","comment_is_top":false,"comment_ctime":1543780916,"is_pvip":false,"replies":[{"id":"16293","content":"这是一个开源项目，github上有详细的使用文档","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543793565,"ip_address":"","comment_id":45761,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543780916","product_id":100020901,"comment_content":"也是可以的，只是需要额外的符号翻译，可以使用 perf-map-agent这个项目帮你生成所需要的符号表<br><br>老师这个如何用perf-map-agent?","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431198,"discussion_content":"这是一个开源项目，github上有详细的使用文档","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543793565,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45751,"user_name":"LinkinPark","can_delete":false,"product_type":"c1","uid":1013069,"ip_address":"","ucode":"6B52463014FA9A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/75/4d/cd259dc1.jpg","comment_is_top":false,"comment_ctime":1543769237,"is_pvip":false,"replies":[{"id":"16295","content":"这是CentOS吗？只看到地址而不是函数名是由于应用程序运行在容器中，它的依赖也都在容器内部，故而perf无法找到PHP符号表。一个简单的解决方法是使用perf record生成perf.data拷贝到容器内部 perf report。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543794005,"ip_address":"","comment_id":45751,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1543769237","product_id":100020901,"comment_content":"看见很多同学都遇到了我一样的问题，perf top 看到的不是func 名，而是一堆像地址一样的string；即使点击加号展开也还是一样，如下：<br>Samples: 794K of event &#39;cycles:pp&#39;, Event count (approx.): 570876147, Thread: php-fpm(45082)<br>  Children      Self  Shared Object       Symbol                                                                                                             ◆<br>+   44.40%    44.40%  php-fpm             [.] 0x000000000094e383                                                                                             ▒<br>+   22.78%    22.78%  php-fpm             [.] 0x00000000008ccf85                                                                                             ▒<br>+   18.60%    18.60%  php-fpm             [.] 0x000000000016a730                                                                                             ▒<br>+    5.95%     5.95%  php-fpm             [.] 0x00000000009578d8                                                                                             ▒<br>+    3.51%     3.51%  php-fpm             [.] 0x000000000098d158","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431192,"discussion_content":"这是CentOS吗？只看到地址而不是函数名是由于应用程序运行在容器中，它的依赖也都在容器内部，故而perf无法找到PHP符号表。一个简单的解决方法是使用perf record生成perf.data拷贝到容器内部 perf report。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543794005,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1103360,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d6/00/dbd52a12.jpg","nickname":"津津有味儿","note":"","ucode":"8089184EC62D8D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":204337,"discussion_content":"容器内 没有yum工具，没有perf工具 无法使用perf report 查看，怎么解决啊？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584156269,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45743,"user_name":"SICUN","can_delete":false,"product_type":"c1","uid":1254261,"ip_address":"","ucode":"22A384904EB9E9","user_header":"https://static001.geekbang.org/account/avatar/00/13/23/75/2b599841.jpg","comment_is_top":false,"comment_ctime":1543765098,"is_pvip":false,"replies":[{"id":"16297","content":"只看到地址而不是函数名是由于应用程序运行在容器中，它的依赖也都在容器内部，故而perf无法找到PHP符号表。一个简单的解决方法是使用perf record生成perf.data拷贝到容器内部 perf report。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543794338,"ip_address":"","comment_id":45743,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543765098","product_id":100020901,"comment_content":"老师，centos 7.4下 ，使用perf top 查看的结果显示的是16进制数，没看到预期的函数名，希望解答一下","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431186,"discussion_content":"只看到地址而不是函数名是由于应用程序运行在容器中，它的依赖也都在容器内部，故而perf无法找到PHP符号表。一个简单的解决方法是使用perf record生成perf.data拷贝到容器内部 perf report。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543794338,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45736,"user_name":"J","can_delete":false,"product_type":"c1","uid":1204008,"ip_address":"","ucode":"7F1BD7F66F4700","user_header":"https://static001.geekbang.org/account/avatar/00/12/5f/28/17ed19bc.jpg","comment_is_top":false,"comment_ctime":1543763423,"is_pvip":false,"replies":[{"id":"16298","content":"ps按照进程状态过滤找到R状态的进程","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543794382,"ip_address":"","comment_id":45736,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543763423","product_id":100020901,"comment_content":"有没有什么办法能列出vmstat r 的进程是什么？<br><br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431183,"discussion_content":"ps按照进程状态过滤找到R状态的进程","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543794382,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45731,"user_name":"dexter","can_delete":false,"product_type":"c1","uid":1315252,"ip_address":"","ucode":"DD51207438FBD6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEL5xnfuicbtRz4F87AAjZX6oCEjMtYiaIu4iaQichQmy0vEBA6Sumic1RDvUCeuBEqj6iatnt2kENbKYmuw/132","comment_is_top":false,"comment_ctime":1543762057,"is_pvip":false,"replies":[{"id":"16302","content":"文章里面有链接，是放在github上的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543795173,"ip_address":"","comment_id":45731,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543762057","product_id":100020901,"comment_content":"这个软件能用pc打开吗，docker的实验代码要怎么下载获取到？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431180,"discussion_content":"文章里面有链接，是放在github上的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543795173,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45674,"user_name":"樊海涛","can_delete":false,"product_type":"c1","uid":1323249,"ip_address":"","ucode":"0B04D5985EE0E1","user_header":"https://static001.geekbang.org/account/avatar/00/14/30/f1/bf7fd8d2.jpg","comment_is_top":false,"comment_ctime":1543743287,"is_pvip":false,"replies":[{"id":"16309","content":"只看到地址而不是函数名是由于应用程序运行在容器中，它的依赖也都在容器内部，故而perf无法找到PHP符号表。一个简单的解决方法是使用perf record生成perf.data拷贝到容器内部 perf report。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543796908,"ip_address":"","comment_id":45674,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543743287","product_id":100020901,"comment_content":"perf top -g -p追踪不到sqrt，是怎么回事呢？<br><br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431149,"discussion_content":"只看到地址而不是函数名是由于应用程序运行在容器中，它的依赖也都在容器内部，故而perf无法找到PHP符号表。一个简单的解决方法是使用perf record生成perf.data拷贝到容器内部 perf report。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543796908,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45672,"user_name":"Chris","can_delete":false,"product_type":"c1","uid":1132777,"ip_address":"","ucode":"82056BBE2E4488","user_header":"https://static001.geekbang.org/account/avatar/00/11/48/e9/f7dba760.jpg","comment_is_top":false,"comment_ctime":1543743005,"is_pvip":false,"replies":[{"id":"16315","content":"perf属于动态跟踪工具，会消耗系统资源的，比如CPU、内存等","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543797197,"ip_address":"","comment_id":45672,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543743005","product_id":100020901,"comment_content":"在一个centos6.6的服务器上执行perf top -g卡住了，然后整个服务器无法登陆，这个命令这么危险啊","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431148,"discussion_content":"perf属于动态跟踪工具，会消耗系统资源的，比如CPU、内存等","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543797197,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45656,"user_name":"mj4ever","can_delete":false,"product_type":"c1","uid":1005549,"ip_address":"","ucode":"73028E537099CC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/ed/d50de13c.jpg","comment_is_top":false,"comment_ctime":1543739372,"is_pvip":true,"replies":[{"id":"16313","content":"只看到地址而不是函数名是由于应用程序运行在容器中，它的依赖也都在容器内部，故而perf无法找到PHP符号表。<br><br>另外，这个应用是在ubuntu上编译的，它所依赖的库路径跟centos不一样。这样，即使你在centos上安装了php，perf也还是找不到那些依赖库","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543797079,"ip_address":"","comment_id":45656,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543739372","product_id":100020901,"comment_content":"周末了，补上之前的课程。<br>本次课程学到了以下内容：<br>1、理解了CPU使用率是如何计算的，并初步理解10个指标的含义【在后续学习过程中，需进一步理解这10个指标，并能在某指标出现问题后，如何进一步排查哪些方面】<br>2、系统出现问题时，可以先通过top查看总体资源的使用情况，然后再结合pidstat查看具体进程的用户态CPU和内核态CPU使用情况；若确定是用户进程问题，则再根据perf工具，进行在线或者离线分析，进一步确认占用 CPU 的到底是代码里的哪个函数【后续还要加强对于perf工具的掌握】<br>3、可以借助Apache Bench进行网站压力测试【在后续工作中，可以尝试用此工具做下产品的压力测试】<br><br>另外，用perf工具分析时，第四列全都是符号，没有出现函数名，不知道是什么原因导致的，留言中也有两个同学提到了这个问题，不知道和Centos是否有关系。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431139,"discussion_content":"只看到地址而不是函数名是由于应用程序运行在容器中，它的依赖也都在容器内部，故而perf无法找到PHP符号表。\n\n另外，这个应用是在ubuntu上编译的，它所依赖的库路径跟centos不一样。这样，即使你在centos上安装了php，perf也还是找不到那些依赖库","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543797079,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45614,"user_name":"超大叮当当","can_delete":false,"product_type":"c1","uid":1203824,"ip_address":"","ucode":"847532DD090D28","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIGMzsqGicBHicmA0xosKibBSmFjrwG8LuRwky3QlZibJt1treDMLPuaKviaC9JrJdQpdJE199ztVMJOGQ/132","comment_is_top":false,"comment_ctime":1543722242,"is_pvip":false,"replies":[{"id":"16322","content":"只看到地址而不是函数名是由于应用程序运行在容器中，它的依赖也都在容器内部，故而perf无法找到PHP符号表。一个简单的解决方法是使用perf record生成perf.data拷贝到容器内部 perf report。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543797426,"ip_address":"","comment_id":45614,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543722242","product_id":100020901,"comment_content":"同问:<br><br>系统版本centos7.2<br>perf version 3.10.0-862.14.4.el7.x86_64.debug<br>在perf top -g -P [pid]命令里面，跳到php-fpm回车后仅仅看到十六进制，没看到调用函数，是版本问题吗？<br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431121,"discussion_content":"只看到地址而不是函数名是由于应用程序运行在容器中，它的依赖也都在容器内部，故而perf无法找到PHP符号表。一个简单的解决方法是使用perf record生成perf.data拷贝到容器内部 perf report。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543797426,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45606,"user_name":"gentleman♥️","can_delete":false,"product_type":"c1","uid":1119062,"ip_address":"","ucode":"0BAC746A70038C","user_header":"https://static001.geekbang.org/account/avatar/00/11/13/56/6a062937.jpg","comment_is_top":false,"comment_ctime":1543721247,"is_pvip":false,"replies":[{"id":"16326","content":"请用Linux","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543797559,"ip_address":"","comment_id":45606,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543721247","product_id":100020901,"comment_content":"老师能讲下 mac怎么安装sysstat嘛、<br>用.&#47;configure make make install<br>提示错误","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431119,"discussion_content":"请用Linux","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543797559,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45580,"user_name":"茴香根","can_delete":false,"product_type":"c1","uid":1316111,"ip_address":"","ucode":"B91C00B72077F1","user_header":"https://static001.geekbang.org/account/avatar/00/14/15/0f/954be2db.jpg","comment_is_top":false,"comment_ctime":1543713295,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543713295","product_id":100020901,"comment_content":"打卡学习，今天收获perf","like_count":0},{"had_liked":false,"id":45572,"user_name":"一生一世","can_delete":false,"product_type":"c1","uid":1254081,"ip_address":"","ucode":"D8C3E55A920676","user_header":"https://static001.geekbang.org/account/avatar/00/13/22/c1/d402bfbf.jpg","comment_is_top":false,"comment_ctime":1543681740,"is_pvip":false,"replies":[{"id":"16235","content":"也是可以的，只是需要额外的符号翻译，可以使用 perf-map-agent这个项目帮你生成所需要的符号表","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543719064,"ip_address":"","comment_id":45572,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543681740","product_id":100020901,"comment_content":"老师perf工具如何分析JAVA程序性能和调用关系。我感觉这个适合分析C或者C++不适合JAVA无法找到调用关系！","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431100,"discussion_content":"也是可以的，只是需要额外的符号翻译，可以使用 perf-map-agent这个项目帮你生成所需要的符号表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543719064,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45561,"user_name":"DJH","can_delete":false,"product_type":"c1","uid":1256740,"ip_address":"","ucode":"2BDEF123B3DB6A","user_header":"https://static001.geekbang.org/account/avatar/00/13/2d/24/28acca15.jpg","comment_is_top":false,"comment_ctime":1543674400,"is_pvip":false,"replies":[{"id":"16328","content":"看百分比，单独只看sqrt自己的确不高，但它是热点中的热点","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543797736,"ip_address":"","comment_id":45561,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543674400","product_id":100020901,"comment_content":"“老师，从压测perf的截图看,sqrt的占比不是很高，您怎么判断是sqrt的问题的?”同问...","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431095,"discussion_content":"看百分比，单独只看sqrt自己的确不高，但它是热点中的热点","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543797736,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45502,"user_name":"miracle","can_delete":false,"product_type":"c1","uid":1276137,"ip_address":"","ucode":"FD7074F1062AE9","user_header":"https://static001.geekbang.org/account/avatar/00/13/78/e9/9d807269.jpg","comment_is_top":false,"comment_ctime":1543656323,"is_pvip":false,"replies":[{"id":"16242","content":"好建议，谢谢👍<br><br>","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543720306,"ip_address":"","comment_id":45502,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543656323","product_id":100020901,"comment_content":"个人觉得两台虚拟机的关系可以再稍微详细的描述一点，比如画个简图？这样做ab测试的时候是怎样产生联动影响就会清楚一些","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431070,"discussion_content":"好建议，谢谢👍\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543720306,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45414,"user_name":"一文","can_delete":false,"product_type":"c1","uid":1131720,"ip_address":"","ucode":"B672D36D5B9BC1","user_header":"https://static001.geekbang.org/account/avatar/00/11/44/c8/ed420754.jpg","comment_is_top":false,"comment_ctime":1543635222,"is_pvip":false,"replies":[{"id":"16335","content":"争用CPU会导致上下文切换","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543798687,"ip_address":"","comment_id":45414,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543635222","product_id":100020901,"comment_content":"请问为什么在就绪队列等待的进程也会耗费CPU？文中所述的每个进程都有一个CPU%列，表示该进程CPU使用率。包括用户空间使用的CPU，内核空间使用的CPU以及在就绪队列等待运行的CPU。按我之前的理解，在就绪队列等待运行的过程是准备好了运行所需的各类资源但还没拿到CPU时间片的进程，既然没拿到CPU时间片，为什么还会耗费CPU？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431025,"discussion_content":"争用CPU会导致上下文切换","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543798687,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45412,"user_name":"walker","can_delete":false,"product_type":"c1","uid":1324219,"ip_address":"","ucode":"FA5B2400A53730","user_header":"https://static001.geekbang.org/account/avatar/00/14/34/bb/0b971fca.jpg","comment_is_top":false,"comment_ctime":1543634362,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543634362","product_id":100020901,"comment_content":"打卡D6","like_count":0},{"had_liked":false,"id":45399,"user_name":"宝琳","can_delete":false,"product_type":"c1","uid":1335466,"ip_address":"","ucode":"FEE253A5DD6F00","user_header":"https://static001.geekbang.org/account/avatar/00/14/60/aa/d3d4fd91.jpg","comment_is_top":false,"comment_ctime":1543632013,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543632013","product_id":100020901,"comment_content":"我用shell命令，显示最高CPU占用前10百分数。","like_count":0},{"had_liked":false,"id":45388,"user_name":"Finfunnel","can_delete":false,"product_type":"c1","uid":1311984,"ip_address":"","ucode":"F3E464E9FC299B","user_header":"https://static001.geekbang.org/account/avatar/00/14/04/f0/0305b4c3.jpg","comment_is_top":false,"comment_ctime":1543629588,"is_pvip":false,"replies":[{"id":"16439","content":"PHP 库里的函数","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543832627,"ip_address":"","comment_id":45388,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543629588","product_id":100020901,"comment_content":"execute_ex这个函数不是php代码中的，课里也没讲，查不到这个函数作用，是自定义的，还是底层的函数名呢？","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431013,"discussion_content":"PHP 库里的函数","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543832627,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45370,"user_name":"frodomei","can_delete":false,"product_type":"c1","uid":1172256,"ip_address":"","ucode":"332C468A7AA9FC","user_header":"https://static001.geekbang.org/account/avatar/00/11/e3/20/c642bc3f.jpg","comment_is_top":false,"comment_ctime":1543622353,"is_pvip":false,"replies":[{"id":"16340","content":"后面文章会讲的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543799029,"ip_address":"","comment_id":45370,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543622353","product_id":100020901,"comment_content":"通过top发现si CPU使用率比较高（40%左右），并均衡打在每个核上，通过vmstat也发现 in是10w级的，通过分析&#47;proc&#47;softirqs文件发现产生软中断的原因是NET_RX，下一步该如何分析？奇怪的的是我另一台服务器接受IP包量和这台都是1.7w左右，而in的量却少了7倍，麻烦大牛帮忙给下思路，感谢","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431003,"discussion_content":"后面文章会讲的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543799029,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45343,"user_name":"风飘，吾独思","can_delete":false,"product_type":"c1","uid":1131032,"ip_address":"","ucode":"4DF0E7DC22EE53","user_header":"https://static001.geekbang.org/account/avatar/00/11/42/18/edc1b373.jpg","comment_is_top":false,"comment_ctime":1543592099,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543592099","product_id":100020901,"comment_content":"d6打卡","like_count":0},{"had_liked":false,"id":45329,"user_name":"Bolin","can_delete":false,"product_type":"c1","uid":1326242,"ip_address":"","ucode":"12C06A5A4E115E","user_header":"https://static001.geekbang.org/account/avatar/00/14/3c/a2/1bec7bdc.jpg","comment_is_top":false,"comment_ctime":1543588888,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543588888","product_id":100020901,"comment_content":"系统版本centos7.2<br>perf version 3.10.0-862.14.4.el7.x86_64.debug<br>在perf  top -g -P [pid]命令里面，跳到php-fpm回车后仅仅看到十六进制，没看到调用函数，是版本问题吗？","like_count":0},{"had_liked":false,"id":45312,"user_name":"祥伟","can_delete":false,"product_type":"c1","uid":1314639,"ip_address":"","ucode":"BB7D89109FC8BD","user_header":"https://static001.geekbang.org/account/avatar/00/14/0f/4f/5040f415.jpg","comment_is_top":false,"comment_ctime":1543584680,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543584680","product_id":100020901,"comment_content":"赞，老师讲的非常好，谢谢","like_count":0},{"had_liked":false,"id":45305,"user_name":"花似雾中看","can_delete":false,"product_type":"c1","uid":1317682,"ip_address":"","ucode":"D9979D86CB7AD9","user_header":"https://static001.geekbang.org/account/avatar/00/14/1b/32/467683eb.jpg","comment_is_top":false,"comment_ctime":1543581959,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543581959","product_id":100020901,"comment_content":"打卡，学到了很多哦！","like_count":0},{"had_liked":false,"id":45302,"user_name":"赵强强","can_delete":false,"product_type":"c1","uid":1073596,"ip_address":"","ucode":"1B8AE07484C69A","user_header":"https://static001.geekbang.org/account/avatar/00/10/61/bc/88a905a5.jpg","comment_is_top":false,"comment_ctime":1543581107,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543581107","product_id":100020901,"comment_content":"老师，从压测perf的截图看,sqrt的占比不是很高，您怎么判断是sqrt的问题的?","like_count":0},{"had_liked":false,"id":45297,"user_name":"0o潇湘雨夜o0","can_delete":false,"product_type":"c1","uid":1003334,"ip_address":"","ucode":"80E6E92A7CC22B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4f/46/4efa8607.jpg","comment_is_top":false,"comment_ctime":1543578807,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543578807","product_id":100020901,"comment_content":"打卡","like_count":0},{"had_liked":false,"id":45261,"user_name":"疯琴","can_delete":false,"product_type":"c1","uid":1099379,"ip_address":"","ucode":"82ACAA4A27753D","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/73/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1543571756,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543571756","product_id":100020901,"comment_content":"老师，我用centos，在虚拟机里测试，perf top -g -p找了半天，看不到sqrt，全是16进制数字，请问这是为什么？","like_count":0},{"had_liked":false,"id":45259,"user_name":"Eric 老乌龟","can_delete":false,"product_type":"c1","uid":1029671,"ip_address":"","ucode":"2853F01253E17A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b6/27/6ca3f497.jpg","comment_is_top":false,"comment_ctime":1543570116,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543570116","product_id":100020901,"comment_content":"很实用，有空一定实操下，感受一下","like_count":0},{"had_liked":false,"id":45253,"user_name":"低调","can_delete":false,"product_type":"c1","uid":1087237,"ip_address":"","ucode":"F4F001639091E0","user_header":"https://static001.geekbang.org/account/avatar/00/10/97/05/17cf5840.jpg","comment_is_top":false,"comment_ctime":1543568951,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543568951","product_id":100020901,"comment_content":"老师有个疑问，perf  top -g命令演示中，占用19%这样的16进制地址，如何对照？有参考和对照表么？","like_count":0},{"had_liked":false,"id":45123,"user_name":"赵强强","can_delete":false,"product_type":"c1","uid":1073596,"ip_address":"","ucode":"1B8AE07484C69A","user_header":"https://static001.geekbang.org/account/avatar/00/10/61/bc/88a905a5.jpg","comment_is_top":false,"comment_ctime":1543547934,"is_pvip":false,"replies":[{"id":"16091","content":"包括的，这些指标可以从pidstat的结果中看的","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543588865,"ip_address":"","comment_id":45123,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543547934","product_id":100020901,"comment_content":"倪老师，文中这段话表述是否有误？top命令某个进程CPU占比应该不包括就绪等待时间和运行虚拟化的时间吧。<br>“每个进程都有一个 %CPU 列，表示进程的 CPU 使用率。它是用户态和内核态 CPU 使用率的总和，包括进程用户空间使用的 CPU、通过系统调用执行的内核空间 CPU 、以及在就绪队列等待运行的 CPU。在虚拟化环境中，它还包括了运行虚拟机占用的 CPU。”。","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430930,"discussion_content":"包括的，这些指标可以从pidstat的结果中看的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543588865,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45115,"user_name":"东子","can_delete":false,"product_type":"c1","uid":1303489,"ip_address":"","ucode":"59CF52913957C6","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI5lJBrAAQrpU1rP9GOhrDAWotY0pvpv6ovjEfHLn2iaA7zh8YtTWlXNf6XGFekoEB8dY3tUOL1E4g/132","comment_is_top":false,"comment_ctime":1543547305,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543547305","product_id":100020901,"comment_content":"老师，我碰到过几次在生产环境linux 2.6.32中使用perf record导致系统crash的情况，不知道你在实际使用时碰到过没有，是perf工具的bug，还是设置参数的问题，谢谢","like_count":0},{"had_liked":false,"id":45110,"user_name":"longhaiqwe","can_delete":false,"product_type":"c1","uid":1061318,"ip_address":"","ucode":"A5AEE950A7AF35","user_header":"https://static001.geekbang.org/account/avatar/00/10/31/c6/27225119.jpg","comment_is_top":false,"comment_ctime":1543547090,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543547090","product_id":100020901,"comment_content":"倪老师，问个比较小白的问题，N 个逻辑 CPU 的机器，启了 N 个线程，假如每个线程都是 while(1) 什么里面什么都不做，CPU 使用率应该是接近 (100*N)%，但是在while中进行 cout 打印，CPU 使用率就会降下来，这里面的原因是什么？","like_count":0},{"had_liked":false,"id":45103,"user_name":"嘿嘿和哈哈","can_delete":false,"product_type":"c1","uid":1040976,"ip_address":"","ucode":"D1DF7BB312BFAC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e2/50/9cc482c6.jpg","comment_is_top":false,"comment_ctime":1543545876,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543545876","product_id":100020901,"comment_content":"老师，刚才问您说在github下载之后怎么用，是因为我没有启动docker容器。启动之后就可以正常运行<br>Requests per second:    5681.84 [#&#47;sec] (mean)<br><br>还有一个问题就是，我的ab命令只能在第一个终端上面执行。在第二个终端上面执行没有反应","like_count":0},{"had_liked":false,"id":45095,"user_name":"WiFeng","can_delete":false,"product_type":"c1","uid":1043466,"ip_address":"","ucode":"D7F0FD3EC815B4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ec/0a/c35f9000.jpg","comment_is_top":false,"comment_ctime":1543545316,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543545316","product_id":100020901,"comment_content":"等待iowait时间 是算到 用户态时间user了吗?<br><br>另外 %wait  与%iowait 是一回事不，有些工具使用的 iowait 如mpstat,有些使用的wait 如pidstat","like_count":0},{"had_liked":false,"id":45069,"user_name":"Smile","can_delete":false,"product_type":"c1","uid":1021017,"ip_address":"","ucode":"2002460CB3D869","user_header":"https://static001.geekbang.org/account/avatar/00/0f/94/59/ac2aa72b.jpg","comment_is_top":false,"comment_ctime":1543543788,"is_pvip":true,"replies":[{"id":"16092","content":"正解，这是在虚拟化中才会有的，并且在云平台中有可能会被服务提供商禁掉。","user_name":"作者回复","user_name_real":"倪朋飞","uid":"1001282","ctime":1543588972,"ip_address":"","comment_id":45069,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1543543788","product_id":100020901,"comment_content":"倪老师，你好，如果云平台中的虚拟机的steal 值过高，是否可以表明 虚拟机之间在发生CPU争抢<br>然后好奇这个值是怎么计算出来的，虚拟机自身怎么知道同宿主机上其他虚拟机的占用？ 望老师解答，感谢。<br><br><br>","like_count":0,"discussions":[{"author":{"id":1001282,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/42/5b55bd1a.jpg","nickname":"倪朋飞","note":"","ucode":"F0FAC195CDE7AC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430911,"discussion_content":"正解，这是在虚拟化中才会有的，并且在云平台中有可能会被服务提供商禁掉。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543588972,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45061,"user_name":"嘿嘿和哈哈","can_delete":false,"product_type":"c1","uid":1040976,"ip_address":"","ucode":"D1DF7BB312BFAC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e2/50/9cc482c6.jpg","comment_is_top":false,"comment_ctime":1543542306,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543542306","product_id":100020901,"comment_content":"老师问您个菜鸟的问题。我从github上面wget下了您的那个文件。但是我需要怎么才能运行在自己的机器上呢。有时间回复一下。谢谢啦。","like_count":0},{"had_liked":false,"id":45055,"user_name":"一步","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1543541732,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1543541732","product_id":100020901,"comment_content":"CPU 使用率，就是除了空闲时间外的其他时间占总 CPU 时间的百分比<br><br>那么为什么文中说使用节拍累加值 可以计算出CPU 使用率呢？这个是什么原理的","like_count":0},{"had_liked":false,"id":45052,"user_name":"nike","can_delete":false,"product_type":"c1","uid":1061281,"ip_address":"","ucode":"9D4E0F18D7ECDF","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/wRKRQaLBnjUF1SbNpNfC5icicVKSLQDgMunBI0V6mU1trJk72JfBh9jLW8QicP7gJic7aszbFBYvwbYmYJtNLHw3Yw/132","comment_is_top":false,"comment_ctime":1543541494,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543541494","product_id":100020901,"comment_content":"老师，我实践时发现追踪不到sqrt方法，是不是phpfpm源码路径问题，还是别的什么呢","like_count":0},{"had_liked":false,"id":45050,"user_name":"王涛","can_delete":false,"product_type":"c1","uid":1315326,"ip_address":"","ucode":"6241F08634D342","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/fe/de00d8d8.jpg","comment_is_top":false,"comment_ctime":1543541455,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543541455","product_id":100020901,"comment_content":"打卡d6","like_count":0},{"had_liked":false,"id":45049,"user_name":"nike","can_delete":false,"product_type":"c1","uid":1061281,"ip_address":"","ucode":"9D4E0F18D7ECDF","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/wRKRQaLBnjUF1SbNpNfC5icicVKSLQDgMunBI0V6mU1trJk72JfBh9jLW8QicP7gJic7aszbFBYvwbYmYJtNLHw3Yw/132","comment_is_top":false,"comment_ctime":1543541416,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543541416","product_id":100020901,"comment_content":"老师，我实践时调用了sqrt方法，但是perf里边追踪不到那个方法，是不是phpfpm源码路径问题还是别的什么呢","like_count":0},{"had_liked":false,"id":45048,"user_name":"yfdba","can_delete":false,"product_type":"c1","uid":1315770,"ip_address":"","ucode":"3202F79BF99695","user_header":"","comment_is_top":false,"comment_ctime":1543541406,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543541406","product_id":100020901,"comment_content":"老师，我用cgroup特性限制应用使用cpu、io或者其他资源，其他运维人员怎么分析最后能定位问题原因就是使用了cgroup的问题呢","like_count":0},{"had_liked":false,"id":45046,"user_name":"大飞","can_delete":false,"product_type":"c1","uid":1320080,"ip_address":"","ucode":"2D98888FC63CA9","user_header":"","comment_is_top":false,"comment_ctime":1543541371,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543541371","product_id":100020901,"comment_content":"d3打卡","like_count":0},{"had_liked":false,"id":45038,"user_name":"阿巍-豆夫","can_delete":false,"product_type":"c1","uid":1005123,"ip_address":"","ucode":"732188848B0A85","user_header":"https://static001.geekbang.org/account/avatar/00/0f/56/43/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1543541094,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543541094","product_id":100020901,"comment_content":"不知道perl 能不能定位到，java 动态字节码调用的java函数， 貌似用jstack就在动态字节码这里断掉了。","like_count":0},{"had_liked":false,"id":45018,"user_name":"_JQ.Wang","can_delete":false,"product_type":"c1","uid":1227617,"ip_address":"","ucode":"6BE451E16592F3","user_header":"https://static001.geekbang.org/account/avatar/00/12/bb/61/90ad7c91.jpg","comment_is_top":false,"comment_ctime":1543539745,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543539745","product_id":100020901,"comment_content":"上班路上看完的，一会到了公司，操练起来","like_count":0},{"had_liked":false,"id":45013,"user_name":"Douglas","can_delete":false,"product_type":"c1","uid":1073027,"ip_address":"","ucode":"CFDE3D76B9DAE6","user_header":"https://static001.geekbang.org/account/avatar/00/10/5f/83/bb728e53.jpg","comment_is_top":false,"comment_ctime":1543539407,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543539407","product_id":100020901,"comment_content":"老师，一个服务器上部署多个进程是不是不太建议，进程间的上下文切换需要保存共享内存空间，而线程上下文切换，不用保存共享内存空间，保存线程栈内存空间就好，粗略理解，不知道有没有偏差","like_count":0},{"had_liked":false,"id":45007,"user_name":"Linuxer","can_delete":false,"product_type":"c1","uid":1153978,"ip_address":"","ucode":"272D9D8089C3D6","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/ba/333b59e5.jpg","comment_is_top":false,"comment_ctime":1543538949,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543538949","product_id":100020901,"comment_content":"请问关于perf不知道还有无更多介绍?或者推荐些资料","like_count":0},{"had_liked":false,"id":45005,"user_name":"Geek_101627","can_delete":false,"product_type":"c1","uid":1070389,"ip_address":"","ucode":"F246019019F1CB","user_header":"https://static001.geekbang.org/account/avatar/00/10/55/35/09e7dfde.jpg","comment_is_top":false,"comment_ctime":1543538912,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543538912","product_id":100020901,"comment_content":"D6","like_count":0},{"had_liked":false,"id":45001,"user_name":"Linuxer","can_delete":false,"product_type":"c1","uid":1153978,"ip_address":"","ucode":"272D9D8089C3D6","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/ba/333b59e5.jpg","comment_is_top":false,"comment_ctime":1543538855,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543538855","product_id":100020901,"comment_content":"我们之前是先通过top确认是用户态cpu高还是内核态cpu高，用户态cpu高还是通过top确认是哪一个进程导致的，会结合使用top -H -P 查找最耗cpu的线程，通过多次pstack去确认调用最频繁的点。","like_count":0},{"had_liked":false,"id":44999,"user_name":"ninuxer","can_delete":false,"product_type":"c1","uid":1243135,"ip_address":"","ucode":"5394ADAF2667D6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132","comment_is_top":false,"comment_ctime":1543538824,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543538824","product_id":100020901,"comment_content":"打卡，day6<br>一般都能找出使用率高的进程，但有时这种使用率高是短时间的，真正去机器上分析的时候，可能使用率就降下去了，所以还是只会根据一些日志信息去分析可能的原因<br>","like_count":0},{"had_liked":false,"id":44998,"user_name":"一步","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1543538721,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1543538721","product_id":100020901,"comment_content":"老师 Red Hat4.4.4-11 没有节拍率CONFIG_HZ这个配置项呢？","like_count":0},{"had_liked":false,"id":44980,"user_name":"聂愿愿","can_delete":false,"product_type":"c1","uid":1315436,"ip_address":"","ucode":"0E35F1757555D1","user_header":"https://static001.geekbang.org/account/avatar/00/14/12/6c/347a3351.jpg","comment_is_top":false,"comment_ctime":1543537494,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543537494","product_id":100020901,"comment_content":"上班地铁途中打卡。","like_count":0},{"had_liked":false,"id":44944,"user_name":"湖湘志","can_delete":false,"product_type":"c1","uid":1285578,"ip_address":"","ucode":"C8B069B3AD4FEA","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erJR5Kj0Xm6LykFHLaWqHjQiaroVxgdoGI7uHEGz2D3PfibWNkBYP23QLzFmcuicgKLbqUch0ZJ2ZNOA/132","comment_is_top":false,"comment_ctime":1543531571,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543531571","product_id":100020901,"comment_content":"D5","like_count":0},{"had_liked":false,"id":44941,"user_name":"善良的男人","can_delete":false,"product_type":"c1","uid":1315544,"ip_address":"","ucode":"ED27030DE75059","user_header":"https://static001.geekbang.org/account/avatar/00/14/12/d8/12879eb7.jpg","comment_is_top":false,"comment_ctime":1543516702,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543516702","product_id":100020901,"comment_content":"看完睡觉💤，明天动手","like_count":0},{"had_liked":false,"id":44931,"user_name":"Geek_2b6807","can_delete":false,"product_type":"c1","uid":1240168,"ip_address":"","ucode":"4C1D0B7F283554","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ert8UYzoypaI9wMPZQV2ibThQ2zKsoge5R25qxHP10eia5pMYOV1mq6G9bft5LoygnyR6bn8RERwQDg/132","comment_is_top":false,"comment_ctime":1543510663,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543510663","product_id":100020901,"comment_content":"Perf很强大，案例稍微复杂点就更好了","like_count":0}]}