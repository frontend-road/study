{"id":532164,"title":"48｜RESTful Web Services（12）：如何调整接口和架构愿景？","content":"<p>你好，我是徐昊。今天我们继续使用TDD的方式实现RESTful Web Services。</p><h2>回顾架构愿景与任务列表</h2><p>目前我们Spike得到的代码如下：</p><pre><code>static class Router implements ResourceRouter {\n    private Map&lt;Pattern, Class&lt;?&gt;&gt; routerTable = new HashMap&lt;&gt;();\n    public Router(Class&lt;Users&gt; rootResource) {\n        Path path = rootResource.getAnnotation(Path.class);\n        routerTable.put(Pattern.compile(path.value() + &quot;(/.*)?&quot;), rootResource);\n    }\n    @Override\n    public OutboundResponse dispatch(HttpServletRequest request, ResourceContext resourceContext) {\n        String path = request.getServletPath();\n        Pattern matched = routerTable.keySet().stream().filter(pattern -&gt; pattern.matcher(path).matches()).findFirst().get();\n        Class&lt;?&gt; resource = routerTable.get(matched);\n\n\n        Method method = Arrays.stream(resource.getMethods()).filter(m -&gt; m.isAnnotationPresent(GET.class)).findFirst().get();\n        Object object = resourceContext.getResource(resource);\n        try {\n            Object result = method.invoke(object);\n            GenericEntity entity = new GenericEntity(result, method.getGenericReturnType());\n            return (OutboundResponse) Response.ok(entity).build();\n        } catch (Exception e) {\n            throw new RuntimeException(e);\n        }\n    }\n}\n</code></pre><p>构想中的架构愿景是这样的：</p><p><img src=\"https://static001.geekbang.org/resource/image/21/3c/21ca03de74cc4f3ef9e4dd60b456263c.jpg?wh=8000x4500\" alt=\"\"></p><h2>视频演示</h2><p>那么进入今天的环节：</p><p><video poster=\"https://media001.geekbang.org/2c7e22b67a404517b59d20843383b222/snapshots/4ed3447a5c4b45318a7d6428641e5a97-00005.jpg\" preload=\"none\" controls=\"\"><source src=\"https://media001.geekbang.org/customerTrans/7e27d07d27d407ebcc195a0e78395f55/5b7b638-18199e66328-0000-0000-01d-dbacd.mp4\" type=\"video/mp4\"><source src=\" https://media001.geekbang.org/bd7437abbe0b43d4a1334f1ced239d71/333b19c2218446118b3c9eac80d9f23f-4baff5bd33d00c057288161b592d3867-sd.m3u8\" type=\"application/x-mpegURL\"></video></p><h2>思考题</h2><p>请Spike Sub-Resource Locator。</p><p>欢迎把你的想法分享在留言区，也欢迎把你的项目代码分享出来。相信经过你的思考与实操，学习效果会更好！</p><!-- [[[read_end]]] -->","neighbors":{"left":{"article_title":"47｜RESTful Web Services（11）：如何通过Spike来验证架构愿景？","id":532162},"right":{"article_title":"49｜RESTful Web Service（13）：如何Spike Sub-Resource Locator？","id":532165}},"comments":[]}