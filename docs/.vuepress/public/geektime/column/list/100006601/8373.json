{"id":8373,"title":"15 | 高性能数据库集群：分库分表","content":"<p>上期我讲了“读写分离”，读写分离分散了数据库读写操作的压力，但没有分散存储压力，当数据量达到千万甚至上亿条的时候，单台数据库服务器的存储能力会成为系统的瓶颈，主要体现在这几个方面：</p>\n<ul>\n<li>\n<p>数据量太大，读写的性能会下降，即使有索引，索引也会变得很大，性能同样会下降。</p>\n</li>\n<li>\n<p>数据文件会变得很大，数据库备份和恢复需要耗费很长时间。</p>\n</li>\n<li>\n<p>数据文件越大，极端情况下丢失数据的风险越高（例如，机房火灾导致数据库主备机都发生故障）。</p>\n</li>\n</ul>\n<p>基于上述原因，单个数据库服务器存储的数据量不能太大，需要控制在一定的范围内。为了满足业务数据存储的需求，就需要将存储分散到多台数据库服务器上。</p>\n<p>今天我来介绍常见的分散存储的方法“<span class=\"orange\">分库分表</span>”，其中包括“分库”和“分表”两大类。</p>\n<h2>业务分库</h2>\n<p><strong>业务分库指的是按照业务模块将数据分散到不同的数据库服务器。</strong>例如，一个简单的电商网站，包括用户、商品、订单三个业务模块，我们可以将用户数据、商品数据、订单数据分开放到三台不同的数据库服务器上，而不是将所有数据都放在一台数据库服务器上。</p>\n<p><img src=\"https://static001.geekbang.org/resource/image/71/c9/71f41d46cc5c0405f4d4dc944b4350c9.jpg?wh=2722*1969\" alt=\"\" /></p>\n<p>虽然业务分库能够分散存储和访问压力，但同时也带来了新的问题，接下来我进行详细分析。</p>\n<p>1.join操作问题</p>\n<p>业务分库后，原本在同一个数据库中的表分散到不同数据库中，导致无法使用SQL的join查询。</p>\n<p>例如：“查询购买了化妆品的用户中女性用户的列表”这个功能，虽然订单数据中有用户的ID信息，但是用户的性别数据在用户数据库中，如果在同一个库中，简单的join查询就能完成；但现在数据分散在两个不同的数据库中，无法做join查询，只能采取先从订单数据库中查询购买了化妆品的用户ID列表，然后再到用户数据库中查询这批用户ID中的女性用户列表，这样实现就比简单的join查询要复杂一些。</p>\n<p>2.事务问题</p>\n<p>原本在同一个数据库中不同的表可以在同一个事务中修改，业务分库后，表分散到不同的数据库中，无法通过事务统一修改。虽然数据库厂商提供了一些分布式事务的解决方案（例如，MySQL的XA），但性能实在太低，与高性能存储的目标是相违背的。</p>\n<!-- [[[read_end]]] -->\n<p>例如，用户下订单的时候需要扣商品库存，如果订单数据和商品数据在同一个数据库中，我们可以使用事务来保证扣减商品库存和生成订单的操作要么都成功要么都失败，但分库后就无法使用数据库事务了，需要业务程序自己来模拟实现事务的功能。例如，先扣商品库存，扣成功后生成订单，如果因为订单数据库异常导致生成订单失败，业务程序又需要将商品库存加上；而如果因为业务程序自己异常导致生成订单失败，则商品库存就无法恢复了，需要人工通过日志等方式来手工修复库存异常。</p>\n<p>3.成本问题</p>\n<p>业务分库同时也带来了成本的代价，本来1台服务器搞定的事情，现在要3台，如果考虑备份，那就是2台变成了6台。</p>\n<p>基于上述原因，对于小公司初创业务，并不建议一开始就这样拆分，主要有几个原因：</p>\n<ul>\n<li>\n<p>初创业务存在很大的不确定性，业务不一定能发展起来，业务开始的时候并没有真正的存储和访问压力，业务分库并不能为业务带来价值。</p>\n</li>\n<li>\n<p>业务分库后，表之间的join查询、数据库事务无法简单实现了。</p>\n</li>\n<li>\n<p>业务分库后，因为不同的数据要读写不同的数据库，代码中需要增加根据数据类型映射到不同数据库的逻辑，增加了工作量。而业务初创期间最重要的是快速实现、快速验证，业务分库会拖慢业务节奏。</p>\n</li>\n</ul>\n<p>有的架构师可能会想：如果业务真的发展很快，岂不是很快就又要进行业务分库了？那为何不一开始就设计好呢？</p>\n<p>其实这个问题很好回答，按照我前面提到的“架构设计三原则”，简单分析一下。</p>\n<p>首先，这里的“如果”事实上发生的概率比较低，做10个业务有1个业务能活下去就很不错了，更何况快速发展，和中彩票的概率差不多。如果我们每个业务上来就按照淘宝、微信的规模去做架构设计，不但会累死自己，还会害死业务。</p>\n<p>其次，如果业务真的发展很快，后面进行业务分库也不迟。因为业务发展好，相应的资源投入就会加大，可以投入更多的人和更多的钱，那业务分库带来的代码和业务复杂的问题就可以通过增加人来解决，成本问题也可以通过增加资金来解决。</p>\n<p>第三，单台数据库服务器的性能其实也没有想象的那么弱，一般来说，单台数据库服务器能够支撑10万用户量量级的业务，初创业务从0发展到10万级用户，并不是想象得那么快。</p>\n<p>而对于业界成熟的大公司来说，由于已经有了业务分库的成熟解决方案，并且即使是尝试性的新业务，用户规模也是海量的，<strong>这与前面提到的初创业务的小公司有本质区别</strong>，因此最好在业务开始设计时就考虑业务分库。例如，在淘宝上做一个新的业务，由于已经有成熟的数据库解决方案，用户量也很大，需要在一开始就设计业务分库甚至接下来介绍的分表方案。</p>\n<h2>分表</h2>\n<p>将不同业务数据分散存储到不同的数据库服务器，能够支撑百万甚至千万用户规模的业务，但如果业务继续发展，同一业务的单表数据也会达到单台数据库服务器的处理瓶颈。例如，淘宝的几亿用户数据，如果全部存放在一台数据库服务器的一张表中，肯定是无法满足性能要求的，此时就需要对单表数据进行拆分。</p>\n<p>单表数据拆分有两种方式：<strong>垂直分表</strong>和<strong>水平分表</strong>。示意图如下：</p>\n<p></p>\n<p><img src=\"https://static001.geekbang.org/resource/image/13/40/136bc2f01919edcb8271df6f7e71af40.jpg?wh=4603*2413\" alt=\"\" /></p>\n<p>为了形象地理解垂直拆分和水平拆分的区别，可以想象你手里拿着一把刀，面对一个蛋糕切一刀：</p>\n<ul>\n<li>\n<p>从上往下切就是垂直切分，因为刀的运行轨迹与蛋糕是垂直的，这样可以把蛋糕切成高度相等（面积可以相等也可以不相等）的两部分，对应到表的切分就是表记录数相同但包含不同的列。例如，示意图中的垂直切分，会把表切分为两个表，一个表包含ID、name、age、sex列，另外一个表包含ID、nickname、description列。</p>\n</li>\n<li>\n<p>从左往右切就是水平切分，因为刀的运行轨迹与蛋糕是平行的，这样可以把蛋糕切成面积相等（高度可以相等也可以不相等）的两部分，对应到表的切分就是表的列相同但包含不同的行数据。例如，示意图中的水平切分，会把表分为两个表，两个表都包含ID、name、age、sex、nickname、description列，但是一个表包含的是ID从1到999999的行数据，另一个表包含的是ID从1000000到9999999的行数据。</p>\n</li>\n</ul>\n<p>上面这个示例比较简单，只考虑了一次切分的情况，实际架构设计过程中并不局限切分的次数，可以切两次，也可以切很多次，就像切蛋糕一样，可以切很多刀。</p>\n<p>单表进行切分后，是否要将切分后的多个表分散在不同的数据库服务器中，可以根据实际的切分效果来确定，并不强制要求单表切分为多表后一定要分散到不同数据库中。原因在于单表切分为多表后，新的表即使在同一个数据库服务器中，也可能带来可观的性能提升，如果性能能够满足业务要求，是可以不拆分到多台数据库服务器的，毕竟我们在上面业务分库的内容看到业务分库也会引入很多复杂性的问题；如果单表拆分为多表后，单台服务器依然无法满足性能要求，那就不得不再次进行业务分库的设计了。</p>\n<p>分表能够有效地分散存储压力和带来性能提升，但和分库一样，也会引入各种复杂性。</p>\n<p>1.垂直分表</p>\n<p>垂直分表适合将表中某些不常用且占了大量空间的列拆分出去。例如，前面示意图中的nickname和description字段，假设我们是一个婚恋网站，用户在筛选其他用户的时候，主要是用age和sex两个字段进行查询，而nickname和description两个字段主要用于展示，一般不会在业务查询中用到。description本身又比较长，因此我们可以将这两个字段独立到另外一张表中，这样在查询age和sex时，就能带来一定的性能提升。</p>\n<p>垂直分表引入的复杂性主要体现在表操作的数量要增加。例如，原来只要一次查询就可以获取name、age、sex、nickname、description，现在需要两次查询，一次查询获取name、age、sex，另外一次查询获取nickname、description。</p>\n<p>不过相比接下来要讲的水平分表，这个复杂性就是小巫见大巫了。</p>\n<p>2.水平分表</p>\n<p>水平分表适合表行数特别大的表，有的公司要求单表行数超过5000万就必须进行分表，这个数字可以作为参考，但并不是绝对标准，关键还是要看表的访问性能。对于一些比较复杂的表，可能超过1000万就要分表了；而对于一些简单的表，即使存储数据超过1亿行，也可以不分表。但不管怎样，当看到表的数据量达到千万级别时，作为架构师就要警觉起来，因为这很可能是架构的性能瓶颈或者隐患。</p>\n<p>水平分表相比垂直分表，会引入更多的复杂性，主要表现在下面几个方面：</p>\n<ul>\n<li>路由</li>\n</ul>\n<p>水平分表后，某条数据具体属于哪个切分后的子表，需要增加路由算法进行计算，这个算法会引入一定的复杂性。</p>\n<p>常见的路由算法有：</p>\n<p><strong>范围路由：</strong>选取有序的数据列（例如，整形、时间戳等）作为路由的条件，不同分段分散到不同的数据库表中。以最常见的用户ID为例，路由算法可以按照1000000的范围大小进行分段，1 ~ 999999放到数据库1的表中，1000000 ~ 1999999放到数据库2的表中，以此类推。</p>\n<p>范围路由设计的复杂点主要体现在分段大小的选取上，分段太小会导致切分后子表数量过多，增加维护复杂度；分段太大可能会导致单表依然存在性能问题，一般建议分段大小在100万至2000万之间，具体需要根据业务选取合适的分段大小。</p>\n<p>范围路由的优点是可以随着数据的增加平滑地扩充新的表。例如，现在的用户是100万，如果增加到1000万，只需要增加新的表就可以了，原有的数据不需要动。</p>\n<p>范围路由的一个比较隐含的缺点是分布不均匀，假如按照1000万来进行分表，有可能某个分段实际存储的数据量只有1000条，而另外一个分段实际存储的数据量有900万条。</p>\n<p><strong>Hash路由：</strong>选取某个列（或者某几个列组合也可以）的值进行Hash运算，然后根据Hash结果分散到不同的数据库表中。同样以用户ID为例，假如我们一开始就规划了10个数据库表，路由算法可以简单地用user_id % 10的值来表示数据所属的数据库表编号，ID为985的用户放到编号为5的子表中，ID为10086的用户放到编号为6的字表中。</p>\n<p>Hash路由设计的复杂点主要体现在初始表数量的选取上，表数量太多维护比较麻烦，表数量太少又可能导致单表性能存在问题。而用了Hash路由后，增加子表数量是非常麻烦的，所有数据都要重分布。</p>\n<p>Hash路由的优缺点和范围路由基本相反，Hash路由的优点是表分布比较均匀，缺点是扩充新的表很麻烦，所有数据都要重分布。</p>\n<p><strong>配置路由：</strong>配置路由就是路由表，用一张独立的表来记录路由信息。同样以用户ID为例，我们新增一张user_router表，这个表包含user_id和table_id两列，根据user_id就可以查询对应的table_id。</p>\n<p>配置路由设计简单，使用起来非常灵活，尤其是在扩充表的时候，只需要迁移指定的数据，然后修改路由表就可以了。</p>\n<p>配置路由的缺点就是必须多查询一次，会影响整体性能；而且路由表本身如果太大（例如，几亿条数据），性能同样可能成为瓶颈，如果我们再次将路由表分库分表，则又面临一个死循环式的路由算法选择问题。</p>\n<ul>\n<li>join操作</li>\n</ul>\n<p>水平分表后，数据分散在多个表中，如果需要与其他表进行join查询，需要在业务代码或者数据库中间件中进行多次join查询，然后将结果合并。</p>\n<ul>\n<li>count()操作</li>\n</ul>\n<p>水平分表后，虽然物理上数据分散到多个表中，但某些业务逻辑上还是会将这些表当作一个表来处理。例如，获取记录总数用于分页或者展示，水平分表前用一个count()就能完成的操作，在分表后就没那么简单了。常见的处理方式有下面两种：</p>\n<p><strong>count()相加：</strong>具体做法是在业务代码或者数据库中间件中对每个表进行count()操作，然后将结果相加。这种方式实现简单，缺点就是性能比较低。例如，水平分表后切分为20张表，则要进行20次count(*)操作，如果串行的话，可能需要几秒钟才能得到结果。</p>\n<p><strong>记录数表：</strong>具体做法是新建一张表，假如表名为“记录数表”，包含table_name、row_count两个字段，每次插入或者删除子表数据成功后，都更新“记录数表”。</p>\n<p>这种方式获取表记录数的性能要大大优于count()相加的方式，因为只需要一次简单查询就可以获取数据。缺点是复杂度增加不少，对子表的操作要同步操作“记录数表”，如果有一个业务逻辑遗漏了，数据就会不一致；且针对“记录数表”的操作和针对子表的操作无法放在同一事务中进行处理，异常的情况下会出现操作子表成功了而操作记录数表失败，同样会导致数据不一致。</p>\n<p>此外，记录数表的方式也增加了数据库的写压力，因为每次针对子表的insert和delete操作都要update记录数表，所以对于一些不要求记录数实时保持精确的业务，也可以通过后台定时更新记录数表。定时更新实际上就是“count()相加”和“记录数表”的结合，即定时通过count()相加计算表的记录数，然后更新记录数表中的数据。</p>\n<ul>\n<li>order by操作</li>\n</ul>\n<p>水平分表后，数据分散到多个子表中，排序操作无法在数据库中完成，只能由业务代码或者数据库中间件分别查询每个子表中的数据，然后汇总进行排序。</p>\n<h2>实现方法</h2>\n<p>和数据库读写分离类似，分库分表具体的实现方式也是“程序代码封装”和“中间件封装”，但实现会更复杂。读写分离实现时只要识别SQL操作是读操作还是写操作，通过简单的判断SELECT、UPDATE、INSERT、DELETE几个关键字就可以做到，而分库分表的实现除了要判断操作类型外，还要判断SQL中具体需要操作的表、操作函数（例如count函数)、order by、group by操作等，然后再根据不同的操作进行不同的处理。例如order by操作，需要先从多个库查询到各个库的数据，然后再重新order by才能得到最终的结果。</p>\n<h2>小结</h2>\n<p>今天我为你讲了高性能数据库集群的分库分表架构，包括业务分库产生的问题和分表的两种方式及其带来的复杂度，希望对你有所帮助。</p>\n<p>这就是今天的全部内容，留一道思考题给你吧，你认为什么时候引入分库分表是合适的？是数据库性能不够的时候就开始分库分表么？</p>\n<p>欢迎你把答案写到留言区，和我一起讨论。相信经过深度思考的回答，也会让你对知识的理解更加深刻。（编辑乱入：精彩的留言有机会获得丰厚福利哦！）</p>\n","neighbors":{"left":{"article_title":"14 | 高性能数据库集群：读写分离","id":8269},"right":{"article_title":"16 | 高性能NoSQL","id":8377}},"comments":[{"had_liked":false,"id":10876,"user_name":"明日之春","can_delete":false,"product_type":"c1","uid":1072544,"ip_address":"","ucode":"9B079DA9BD34A0","user_header":"https://static001.geekbang.org/account/avatar/00/10/5d/a0/4daf165a.jpg","comment_is_top":false,"comment_ctime":1527730336,"is_pvip":false,"replies":[{"id":3490,"content":"赞，写的很完善","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527819547,"ip_address":"","comment_id":10876,"utype":1}],"discussion_count":9,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"应该是这些操作依次尝试\n1.做硬件优化，例如从机械硬盘改成使用固态硬盘，当然固态硬盘不适合服务器使用，只是举个例子\n2.先做数据库服务器的调优操作，例如增加索引，oracle有很多的参数调整;\n3.引入缓存技术，例如Redis，减少数据库压力\n4.程序与数据库表优化，重构，例如根据业务逻辑对程序逻辑做优化，减少不必要的查询;\n5.在这些操作都不能大幅度优化性能的情况下，不能满足将来的发展，再考虑分库分表，也要有预估性","like_count":234},{"had_liked":false,"id":15439,"user_name":"Kongk0ng","can_delete":false,"product_type":"c1","uid":1004131,"ip_address":"","ucode":"784B1EABDD7328","user_header":"https://static001.geekbang.org/account/avatar/00/0f/52/63/a58ae0ab.jpg","comment_is_top":false,"comment_ctime":1531190284,"is_pvip":false,"replies":[{"id":5264,"content":"这个是hash函数实现的一个技巧，当计算hash值的时候，普通做法是取余操作，例如h%len，但如果len是2的N次方，通过位操作性能更高，计算方式为h &amp; (len-1)","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1531292131,"ip_address":"","comment_id":15439,"utype":1}],"discussion_count":16,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"如果使用hash进行分表的话，为什么大多方案推荐2的n次方作为表的总数，除了收缩容易还有什么好处吗？谢谢","like_count":96,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418621,"discussion_content":"赞，写的很完善","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527819547,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1318970,"avatar":"https://static001.geekbang.org/account/avatar/00/14/20/3a/90db6a24.jpg","nickname":"Long","note":"","ucode":"2417242560360A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":47803,"discussion_content":"关于@明日之春同学的答案，这个写的一看就是有实际感受过的，哈哈。\n不过有一点可能需要探讨下，数据库方面的优化，我之前看过的介绍大多都是，\n从成本角度考虑从小到大：\nSQL优化-->业务或者表结构优化-->数据库参数配置优化-->硬件和架构优化。\n我也比较认可这样的尝试顺序过程，硬件尝试靠后。\n\n因为原答案说了“依次”尝试，这可能需要说下背景，比如公司不差钱之类的，哈哈。。。不然可能会有理解偏差和误解。\n\nPS：说到换硬件，让我想起了，之前帮别的部门做一些巨复杂业务的查询优化，优化了半天，一点一点往目标迈进，结果客户直接上了固态硬盘，瞬间达到了预期目标，也不需要再做其他优化了。。。瞬间觉得，有钱还是会少很多烦恼。","likes_number":13,"is_delete":false,"is_hidden":false,"ctime":1573420420,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1033096,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c3/88/d16816a8.jpg","nickname":"如来神掌","note":"","ucode":"45E20FF935BD2F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1318970,"avatar":"https://static001.geekbang.org/account/avatar/00/14/20/3a/90db6a24.jpg","nickname":"Long","note":"","ucode":"2417242560360A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":304228,"discussion_content":"直接上硬件简单直接，如果换了硬件后期再有问题就可以从SQL优化开始继续了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599525633,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":47803,"ip_address":"","group_id":0},"score":304228,"extra":""}]},{"author":{"id":2041989,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/28/85/3ae5efed.jpg","nickname":"Silence°","note":"","ucode":"1782A115C603FD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293360,"discussion_content":"SQL优化 ➡️ 业务或表结构优化 ➡️ 数据库参数配置优化 ➡️ 硬件和架构设计（redis缓存等）","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1595509886,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1033096,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c3/88/d16816a8.jpg","nickname":"如来神掌","note":"","ucode":"45E20FF935BD2F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2041989,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/28/85/3ae5efed.jpg","nickname":"Silence°","note":"","ucode":"1782A115C603FD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":304224,"discussion_content":"优化顺序就按这个来，没错","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1599525495,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":293360,"ip_address":"","group_id":0},"score":304224,"extra":""}]},{"author":{"id":1170843,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/9b/0bc44a78.jpg","nickname":"yyl","note":"","ucode":"1741DACDFCA9AF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":296481,"discussion_content":"为什么“固态硬盘不适合服务器使用呢？”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596552567,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1160192,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b4/00/661fb98d.jpg","nickname":"追忆似水年华","note":"","ucode":"C1D7C0DD7E7411","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1170843,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/9b/0bc44a78.jpg","nickname":"yyl","note":"","ucode":"1741DACDFCA9AF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":310145,"discussion_content":"可能是前些年的SSD成本比较高？毕竟这是两年前的文章","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1601644090,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":296481,"ip_address":"","group_id":0},"score":310145,"extra":""},{"author":{"id":1005411,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/63/be6db73e.jpg","nickname":"周文童","note":"","ucode":"0C65A0A67229FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1170843,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/9b/0bc44a78.jpg","nickname":"yyl","note":"","ucode":"1741DACDFCA9AF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":628301,"discussion_content":"固态硬盘可靠性没有机械硬盘高吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1695175094,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":296481,"ip_address":"北京","group_id":0},"score":628301,"extra":""}]},{"author":{"id":1078793,"avatar":"https://static001.geekbang.org/account/avatar/00/10/76/09/cf7513c8.jpg","nickname":"nero","note":"","ucode":"038100ACA14B29","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283328,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592235422,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81037,"user_name":"帅","can_delete":false,"product_type":"c1","uid":1469535,"ip_address":"","ucode":"A8664366C8A221","user_header":"https://static001.geekbang.org/account/avatar/00/16/6c/5f/9936f55e.jpg","comment_is_top":false,"comment_ctime":1553782364,"is_pvip":false,"replies":[{"id":29434,"content":"blob的字段是和行数据分开存储的，而且磁盘上并不是连续的，因此select blob字段会让磁盘进入随机IO模式","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1553791912,"ip_address":"","comment_id":81037,"utype":1}],"discussion_count":14,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"老师，针对mysql，发现如果字段有blob的字段，select 不写这个字段，和写这个字段，效率差异很大啊，这个是什么原因？一直没弄明白😊 ，谢谢","like_count":88,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445056,"discussion_content":"blob的字段是和行数据分开存储的，而且磁盘上并不是连续的，因此select blob字段会让磁盘进入随机IO模式","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1553791912,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1098582,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c3/56/8f62847a.jpg","nickname":"vito","note":"","ucode":"F9C735F13F1E0A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":641589,"discussion_content":"其实不仅是blob字段，对于varchar字段，如果存储的数据过长，也是一样的效果，引擎也会把它单独存储为一页或者多页，原理共通的，MySQL的一页要么4K8K或者16K，你某一个字段过长肯定是存不下要分页存的，一旦分页，原本是读写一页变成多页，性能自然不一样","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1712807306,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"安徽","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1309236,"avatar":"https://static001.geekbang.org/account/avatar/00/13/fa/34/8091ae3f.jpg","nickname":"茉莉清可乐对奶茶","note":"","ucode":"A7D48223EB473D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":609926,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679301984,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005828,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/04/04843618.jpg","nickname":"源","note":"","ucode":"A9F48B1A79DCC7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":596949,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1671291840,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1931698,"avatar":"","nickname":"青枫","note":"","ucode":"6B9ED5175A955B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551882,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645161505,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2868521,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIZ0mvsiaRETn89w2wdLM0G2gFbM87ibVYcK45aygohBxaOhTsA5yfqGm6IdC6NEkHtVb5GDIhxynFQ/132","nickname":"落叶无情","note":"","ucode":"50695566295D7F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548031,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643003462,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2051293,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/4c/dd/c6035349.jpg","nickname":"Bumblebee","note":"","ucode":"B879C8A511D08D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543584,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641212183,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1626542,"avatar":"https://static001.geekbang.org/account/avatar/00/18/d1/ae/c1b186e6.jpg","nickname":"Mr.张","note":"","ucode":"AE4BC29C26A268","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543220,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641006972,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2063268,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/7b/a4/1a963ee4.jpg","nickname":"aiweier","note":"","ucode":"A16570873866B5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":405646,"discussion_content":"m","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634611310,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1210386,"avatar":"https://static001.geekbang.org/account/avatar/00/12/78/12/7df38a54.jpg","nickname":"helloworld2018","note":"","ucode":"2AE40C0DF5A9F7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":401401,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633659241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1595176,"avatar":"https://static001.geekbang.org/account/avatar/00/18/57/28/be7550d2.jpg","nickname":"mo","note":"","ucode":"FB3E8C827BE5CC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394350,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631848884,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2260416,"avatar":"https://static001.geekbang.org/account/avatar/00/22/7d/c0/3ec9008e.jpg","nickname":"勿忘初心","note":"","ucode":"82DFEAEDC17131","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373748,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620865070,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1305980,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/7c/6cdd7190.jpg","nickname":"闲敲棋子落灯花","note":"","ucode":"64908160BFBCB9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344967,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611631606,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1078793,"avatar":"https://static001.geekbang.org/account/avatar/00/10/76/09/cf7513c8.jpg","nickname":"nero","note":"","ucode":"038100ACA14B29","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283330,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592235638,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10853,"user_name":"公号-技术夜未眠","can_delete":false,"product_type":"c1","uid":1013683,"ip_address":"","ucode":"83825B57CBD952","user_header":"https://static001.geekbang.org/account/avatar/00/0f/77/b3/991f3f9b.jpg","comment_is_top":false,"comment_ctime":1527728291,"is_pvip":true,"replies":[{"id":3494,"content":"没有太好的方案，要么一开始的分表方案就是按照id范围来设计的，要么就需要数据迁移","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527819872,"ip_address":"","comment_id":10853,"utype":1}],"discussion_count":3,"race_medal":1,"score":2,"product_id":100006601,"comment_content":"分库分表，可以理解为是一种空间换时间的思路，同时分流了存储压力与读写压力。\n\n数据库性能不够时，首先应该想到是否可以通过改善硬件条件等垂直扩容手段；其次可引入读写分离、缓存&#47;NoSQL、全文检索等手段；然后，单库单表的访问仍然存在性能瓶颈，可考虑分库分表，并且分库分表可以按照业务进行垂直拆分，接着进行水平拆分。\n\n我的问题是:当线上已经进行了分库分表的系统，需要进一步水平扩容时，有什么好的设计方案？","like_count":46,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445056,"discussion_content":"blob的字段是和行数据分开存储的，而且磁盘上并不是连续的，因此select blob字段会让磁盘进入随机IO模式","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1553791912,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1098582,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c3/56/8f62847a.jpg","nickname":"vito","note":"","ucode":"F9C735F13F1E0A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":641589,"discussion_content":"其实不仅是blob字段，对于varchar字段，如果存储的数据过长，也是一样的效果，引擎也会把它单独存储为一页或者多页，原理共通的，MySQL的一页要么4K8K或者16K，你某一个字段过长肯定是存不下要分页存的，一旦分页，原本是读写一页变成多页，性能自然不一样","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1712807306,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"安徽","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1309236,"avatar":"https://static001.geekbang.org/account/avatar/00/13/fa/34/8091ae3f.jpg","nickname":"茉莉清可乐对奶茶","note":"","ucode":"A7D48223EB473D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":609926,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679301984,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005828,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/59/04/04843618.jpg","nickname":"源","note":"","ucode":"A9F48B1A79DCC7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":596949,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1671291840,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1931698,"avatar":"","nickname":"青枫","note":"","ucode":"6B9ED5175A955B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551882,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645161505,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2868521,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIZ0mvsiaRETn89w2wdLM0G2gFbM87ibVYcK45aygohBxaOhTsA5yfqGm6IdC6NEkHtVb5GDIhxynFQ/132","nickname":"落叶无情","note":"","ucode":"50695566295D7F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548031,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643003462,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2051293,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/4c/dd/c6035349.jpg","nickname":"Bumblebee","note":"","ucode":"B879C8A511D08D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543584,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641212183,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1626542,"avatar":"https://static001.geekbang.org/account/avatar/00/18/d1/ae/c1b186e6.jpg","nickname":"Mr.张","note":"","ucode":"AE4BC29C26A268","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543220,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641006972,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2063268,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/7b/a4/1a963ee4.jpg","nickname":"aiweier","note":"","ucode":"A16570873866B5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":405646,"discussion_content":"m","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634611310,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1210386,"avatar":"https://static001.geekbang.org/account/avatar/00/12/78/12/7df38a54.jpg","nickname":"helloworld2018","note":"","ucode":"2AE40C0DF5A9F7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":401401,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633659241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1595176,"avatar":"https://static001.geekbang.org/account/avatar/00/18/57/28/be7550d2.jpg","nickname":"mo","note":"","ucode":"FB3E8C827BE5CC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394350,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631848884,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2260416,"avatar":"https://static001.geekbang.org/account/avatar/00/22/7d/c0/3ec9008e.jpg","nickname":"勿忘初心","note":"","ucode":"82DFEAEDC17131","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373748,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620865070,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1305980,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/7c/6cdd7190.jpg","nickname":"闲敲棋子落灯花","note":"","ucode":"64908160BFBCB9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344967,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611631606,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1078793,"avatar":"https://static001.geekbang.org/account/avatar/00/10/76/09/cf7513c8.jpg","nickname":"nero","note":"","ucode":"038100ACA14B29","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283330,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592235638,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11606,"user_name":"刘志刚","can_delete":false,"product_type":"c1","uid":1102108,"ip_address":"","ucode":"2EDEA464124639","user_header":"https://static001.geekbang.org/account/avatar/00/10/d1/1c/f6e95d1d.jpg","comment_is_top":false,"comment_ctime":1528247307,"is_pvip":false,"replies":[{"id":3739,"content":"这样做没错，如果你们12年就开始分库分表，可能当时的方案也不一定适应后来的业务变化","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528251432,"ip_address":"","comment_id":11606,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"我们公司业务增长比较平稳，已经经历了几个过程，\n1.先是最基础的主备，Oracle 扛了3年到15年，中间优化了几次硬件和数据库上的配置\n2.到16年左右开始扛不住了，数据量在3千万，但是订单表列太多，导致性能开始不理想，这个时候做了一把分区，性能勉强接受，继续扛着\n3.到17年之后做到18年开始做去O项目换MySQL了，顺带着分表和分区了，目前按业务，把一些非核心业务分出去其他库了，订单的库还没分，按照历史年表和热表来做的，做滚表实现的，热表数据差不多在1千万以内，现在性能还不错，历史数据用搜索聚合的，查询性能还不错！\n4.到后面如果业务再持续增长的话，估计就要拆订单库了\n总结一句话，分库分表要在业务需要之前一点，看数据量和业务特性！","like_count":41,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418614,"discussion_content":"没有太好的方案，要么一开始的分表方案就是按照id范围来设计的，要么就需要数据迁移","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1527819872,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1434423,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e3/37/c132802f.jpg","nickname":"WESTWALL","note":"","ucode":"295A030F9D3BF4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364995,"discussion_content":"我有个思路，是不是可以参考Greenplum的扩容。例如设计的时候，每个服务器上放2个Node（数据库），这样需要扩容到2倍的时候，直接把一个Node分到新机器上就好了，不需要做迁移。依次类推，你可以放4个，或者8个……","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1617679795,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2849826,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/qNwDzf87cOnRwKEjXjr9pFvMnFzAURTLA1icYCN80OWuesPibn98IbjoiaTOCZp9WxgKvysoqfEiaDVNGtBU6Yeu4A/132","nickname":"Geek_b75429","note":"","ucode":"011F9D9866CC5C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1434423,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e3/37/c132802f.jpg","nickname":"WESTWALL","note":"","ucode":"295A030F9D3BF4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":627414,"discussion_content":"一致性hash？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1694135040,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":364995,"ip_address":"北京","group_id":0},"score":627414,"extra":""}]}]},{"had_liked":false,"id":10888,"user_name":"Snway","can_delete":false,"product_type":"c1","uid":1102888,"ip_address":"","ucode":"0AD31AECA8A8F7","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/28/3b6546e8.jpg","comment_is_top":false,"comment_ctime":1527731977,"is_pvip":false,"replies":[{"id":3488,"content":"我们也这样做过，后来受不了了又缩表😂😂😂","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527819437,"ip_address":"","comment_id":10888,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"我们是在设计初就考虑进去了，预估单表数据容量，再考虑未来三年的数据增长，不过现在反观这种做法，感觉有点过度设计，如当初一张用户表，分了127张，2个库，然而实际数据容量根本没这么多，顶多千万级别，不仅带来存储资源浪费，也给编码带来不少复杂度！所以我还是觉得得遵循演化原则，业务真正发展起来再考虑分库分表","like_count":40,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418922,"discussion_content":"这样做没错，如果你们12年就开始分库分表，可能当时的方案也不一定适应后来的业务变化","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528251432,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1359108,"avatar":"https://static001.geekbang.org/account/avatar/00/14/bd/04/fc82a7f1.jpg","nickname":"qwfys200","note":"","ucode":"DFE438CA2F77A2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":324861,"discussion_content":"通常来说，数据分为热数据和冷数据，分表分库可以基于冷热数据进行切分，像订单表，原则上，三个月内的属于热数据，三个月以外的属于冷数据，实际应用中有90%的数据是冷数据，只有我们把冷数据剥离出来，系统就可以轻松应对热数据了。关于冷热数据怎么划分，我觉得其实每个团队都有自己的划分标准。冷然数据剥离其实主要是想给系统减肥、降维，真实场景中虽然数据体量很大，但是实际的活跃数据往往是一小部分热数据，我们只要适时切分出热数据，这样对于系统来说，它所面对的则是一个已经降维过的小体量的数据表。","likes_number":8,"is_delete":false,"is_hidden":false,"ctime":1605182531,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1359108,"avatar":"https://static001.geekbang.org/account/avatar/00/14/bd/04/fc82a7f1.jpg","nickname":"qwfys200","note":"","ucode":"DFE438CA2F77A2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":324856,"discussion_content":"订单表如果业务量相当大，可以按年月、年月日分表。\n\n分表分库以后，可以借助ElasticSearch构建一个外部索引库，查询的时候，借助外部索引库来count、join。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1605181689,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1009098,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/65/ca/38dcd55a.jpg","nickname":"lupguo","note":"","ucode":"1B55A01DF78647","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":40353,"discussion_content":"按冷热表区分这点挺好的，前提是业务需要支持非实时全量统计和检索\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572172958,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10973,"user_name":"鲁伊李","can_delete":false,"product_type":"c1","uid":1109328,"ip_address":"","ucode":"9EF89A956CEE3A","user_header":"https://static001.geekbang.org/account/avatar/00/10/ed/50/3ad4570d.jpg","comment_is_top":false,"comment_ctime":1527771293,"is_pvip":false,"replies":[{"id":3541,"content":"没有很好的，要么中间件要么代码中间层，业务代码处理总是很麻烦的","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527846324,"ip_address":"","comment_id":10973,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"分库分表的痛点大家都知道，可否介绍下解决方案…","like_count":29,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418629,"discussion_content":"我们也这样做过，后来受不了了又缩表😂😂😂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527819437,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":599775,"discussion_content":"面向八股文开发","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673781736,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1463987,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cQVffRuscdhnF5vnQjgAZnbLwHDALl3TsAQsgEYCYPVfuFMSkyaTUXHs2aA0ORpx7AjI3LTR2ibKw2Q0VepymqA/132","nickname":"Geek_66158e","note":"","ucode":"8C3A579A715726","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598888,"discussion_content":"遵循烟花原则","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673186806,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10877,"user_name":"kylexy_0817","can_delete":false,"product_type":"c1","uid":1068372,"ip_address":"","ucode":"392DD9DD5E4B6E","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/54/9c214885.jpg","comment_is_top":false,"comment_ctime":1527730414,"is_pvip":false,"replies":[{"id":3489,"content":"关系数据库是行存储，即使不用那一列，也会从存储读取到内存","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527819519,"ip_address":"","comment_id":10877,"utype":1}],"discussion_count":6,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"其实在同一个库里做数据拆分，无需分表吧？就例如MySQL，只需要对表做分区就可以了。分表的目的主要是为后面把表分到不同的数据库实例作准备？\n还有个疑问，文中提到，用户表的description等字段内容不是经常查到，所以做垂直划分可以提高查询性能，意思是，如果表中有内容较长的字段，查询的时候不查出来（不使用select *），也会有性能问题？\n最后，我觉得当单实例的访问量，已达到机器的60%承载能力，就要考虑分库，而具体如何拆分，则要分析访问量主要集中在哪些表。至于分表，主要依据还是单表的数据量和查询性能。","like_count":25,"discussions":[{"author":{"id":1201282,"avatar":"https://static001.geekbang.org/account/avatar/00/12/54/82/4932fab1.jpg","nickname":"超仔","note":"","ucode":"A349805A381C9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2463,"discussion_content":"如果读取的字段都在index里面是不用加载所有的列到内存的，而是直接从index获取","likes_number":10,"is_delete":false,"is_hidden":false,"ctime":1563673845,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418622,"discussion_content":"关系数据库是行存储，即使不用那一列，也会从存储读取到内存","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1527819519,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1209599,"avatar":"","nickname":"Teanmy","note":"","ucode":"89F466CC698583","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362861,"discussion_content":"blob类型的不会和行内其它数据存在一起吧","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1617064048,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1015188,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/94/abb7bfe3.jpg","nickname":"纯洁c","note":"","ucode":"522FB46A251DEC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":615248,"discussion_content":"好问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1682137675,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1015754,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","nickname":"helloworld","note":"","ucode":"00DF2FEC58D2E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333177,"discussion_content":"老师的回答没错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607474362,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1615195,"avatar":"https://static001.geekbang.org/account/avatar/00/18/a5/5b/e1ffd5e4.jpg","nickname":"纸君","note":"","ucode":"E3791414E0B5B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285717,"discussion_content":"mysql里面假如文本字段长度过长，是不会放到聚集索引的叶子结点的，那时候就不会影响吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592919442,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55415,"user_name":"耶愿","can_delete":false,"product_type":"c1","uid":1340960,"ip_address":"","ucode":"549E54F67FC000","user_header":"https://static001.geekbang.org/account/avatar/00/14/76/20/2f9c6763.jpg","comment_is_top":false,"comment_ctime":1546167392,"is_pvip":false,"replies":[{"id":20101,"content":"后台统计库不拆分，冗余一份线上数据，既可以应对复杂的统计需求，也不担心影响线上业务","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1546310925,"ip_address":"","comment_id":55415,"utype":1}],"discussion_count":14,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"您好！请教一个问题，目前线上业务遇到一个问题，就是订单表需要在单库里分100张表，使用uid%100分的表，前端用户查数据没有问题，后台需要查天、周、月、年的统计信息，这个应该怎么实现？而且要求每行统计记录点击后可以看到该汇总信息下所有的订单记录，这个该怎么做？","like_count":20,"discussions":[{"author":{"id":1671066,"avatar":"","nickname":"鲁班","note":"","ucode":"94AD1910CC60DE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":30606,"discussion_content":"应该是把业务数据同步到统计库，可以用消息队列等方案","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1570845905,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1214682,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKD1mzRwEoY01Fb1mu8PuiaqE7206icIbTGJMeZzlVbv99eWEkJ9vdXxEkz90pg4pBKaH4orXZoIvKw/132","nickname":"between","note":"","ucode":"CA5EB7C229F3A9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339581,"discussion_content":"同步一份数据到数据分析性数据库钟，分析类型的查询都走这个库","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1609740637,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434765,"discussion_content":"后台统计库不拆分，冗余一份线上数据，既可以应对复杂的统计需求，也不担心影响线上业务","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1546310925,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":3099902,"avatar":"https://static001.geekbang.org/account/avatar/00/2f/4c/fe/2493943e.jpg","nickname":"Soulic Yang⃰","note":"","ucode":"9BC908E503B6B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":583369,"discussion_content":"那这样统计查询还是很慢，后台统计是不是只能用大数据统计技术了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660057430,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":434765,"ip_address":"广东","group_id":0},"score":583369,"extra":""}]},{"author":{"id":1115425,"avatar":"https://static001.geekbang.org/account/avatar/00/11/05/21/395cb96e.jpg","nickname":"John","note":"","ucode":"056F0E422DE9CC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572656,"discussion_content":"运维视角和客户的视角不一致的钱，所以需要同步数据到运维库中。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652885011,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2080208,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/bd/d0/070824d1.jpg","nickname":"空城。","note":"","ucode":"0F6F110D811C2E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":561179,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649570566,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2163923,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/tmKD96dzOPORx0UbbIocwUR0NO4ApBIIJZ0foOibLq2xkLgV2gficxRMreycHMErXHTQpJHDFWiablxjfhWzXRntg/132","nickname":"Geek_04789d","note":"","ucode":"9341B8934455C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552212,"discussion_content":"个人觉的，你应该帮需求整理一下，然后整一个统计表出来，然后按日抽数据放到统计表中，我们需要的财务数据就是这么操作的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645348667,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1161522,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b9/32/84346d4a.jpg","nickname":"雪碧心拔凉","note":"","ucode":"D13EEBAA0F443B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":409420,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635432246,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1876015,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/a0/2f/87dcbb63.jpg","nickname":"人间四月天","note":"","ucode":"AD6FB638A4FA58","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":397818,"discussion_content":"我之前的项目有类似的情况，数据是来源采集系统，通过maxcomputer计算生成一张结果表用于统计查询。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632670515,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1595176,"avatar":"https://static001.geekbang.org/account/avatar/00/18/57/28/be7550d2.jpg","nickname":"mo","note":"","ucode":"FB3E8C827BE5CC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394351,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631849244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1077194,"avatar":"https://static001.geekbang.org/account/avatar/00/10/6f/ca/240b9332.jpg","nickname":"平凡之路","note":"","ucode":"E46241CBC54BF0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335790,"discussion_content":"可以建视图把100张表连起来用作统计","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608307225,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1965699,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/fe/83/df562574.jpg","nickname":"慎独明强","note":"","ucode":"DC2F7F2C0C8F60","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294361,"discussion_content":"可以通过otter将分表数据同步到适合做大表查询的单表中。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595860378,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1179156,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fe/14/f1532dec.jpg","nickname":"鲁班大师","note":"","ucode":"4F9615DF87B031","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1611,"discussion_content":"李老师的意思是使用分区吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562730189,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2032840,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/04/c8/3c7af100.jpg","nickname":"Javatar","note":"","ucode":"E216645CDF632C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1179156,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fe/14/f1532dec.jpg","nickname":"鲁班大师","note":"","ucode":"4F9615DF87B031","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290834,"discussion_content":"老师的意思应该是写入订单表（分表）后，再往另一个统计库（未分表）写一份。即同一条数据写两份。","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1594616797,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":1611,"ip_address":"","group_id":0},"score":290834,"extra":""}]}]},{"had_liked":false,"id":17042,"user_name":"FluttySage","can_delete":false,"product_type":"c1","uid":1173302,"ip_address":"","ucode":"4B660FBD6D43DB","user_header":"https://static001.geekbang.org/account/avatar/00/11/e7/36/fcbcd227.jpg","comment_is_top":false,"comment_ctime":1532395449,"is_pvip":false,"replies":[{"id":5923,"content":"数据写双份，一份给线上用，采用分库分表；一份给运营，不分库分表","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1532424051,"ip_address":"","comment_id":17042,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"老师您好，分库分表后必然会遇见运营人员实时报表查询的问题。单库时，查询实现起来比较简单。\n分库之后，查询就变得复杂了，请问有没有比较好的解决思路呢？","like_count":17,"discussions":[{"author":{"id":1671066,"avatar":"","nickname":"鲁班","note":"","ucode":"94AD1910CC60DE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":30606,"discussion_content":"应该是把业务数据同步到统计库，可以用消息队列等方案","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1570845905,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1214682,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKD1mzRwEoY01Fb1mu8PuiaqE7206icIbTGJMeZzlVbv99eWEkJ9vdXxEkz90pg4pBKaH4orXZoIvKw/132","nickname":"between","note":"","ucode":"CA5EB7C229F3A9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":339581,"discussion_content":"同步一份数据到数据分析性数据库钟，分析类型的查询都走这个库","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1609740637,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434765,"discussion_content":"后台统计库不拆分，冗余一份线上数据，既可以应对复杂的统计需求，也不担心影响线上业务","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1546310925,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":3099902,"avatar":"https://static001.geekbang.org/account/avatar/00/2f/4c/fe/2493943e.jpg","nickname":"Soulic Yang⃰","note":"","ucode":"9BC908E503B6B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":583369,"discussion_content":"那这样统计查询还是很慢，后台统计是不是只能用大数据统计技术了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660057430,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":434765,"ip_address":"广东","group_id":0},"score":583369,"extra":""}]},{"author":{"id":1115425,"avatar":"https://static001.geekbang.org/account/avatar/00/11/05/21/395cb96e.jpg","nickname":"John","note":"","ucode":"056F0E422DE9CC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572656,"discussion_content":"运维视角和客户的视角不一致的钱，所以需要同步数据到运维库中。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652885011,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2080208,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/bd/d0/070824d1.jpg","nickname":"空城。","note":"","ucode":"0F6F110D811C2E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":561179,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649570566,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2163923,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/tmKD96dzOPORx0UbbIocwUR0NO4ApBIIJZ0foOibLq2xkLgV2gficxRMreycHMErXHTQpJHDFWiablxjfhWzXRntg/132","nickname":"Geek_04789d","note":"","ucode":"9341B8934455C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552212,"discussion_content":"个人觉的，你应该帮需求整理一下，然后整一个统计表出来，然后按日抽数据放到统计表中，我们需要的财务数据就是这么操作的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645348667,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1161522,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b9/32/84346d4a.jpg","nickname":"雪碧心拔凉","note":"","ucode":"D13EEBAA0F443B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":409420,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635432246,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1876015,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/a0/2f/87dcbb63.jpg","nickname":"人间四月天","note":"","ucode":"AD6FB638A4FA58","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":397818,"discussion_content":"我之前的项目有类似的情况，数据是来源采集系统，通过maxcomputer计算生成一张结果表用于统计查询。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632670515,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1595176,"avatar":"https://static001.geekbang.org/account/avatar/00/18/57/28/be7550d2.jpg","nickname":"mo","note":"","ucode":"FB3E8C827BE5CC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394351,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631849244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1077194,"avatar":"https://static001.geekbang.org/account/avatar/00/10/6f/ca/240b9332.jpg","nickname":"平凡之路","note":"","ucode":"E46241CBC54BF0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335790,"discussion_content":"可以建视图把100张表连起来用作统计","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608307225,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1965699,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/fe/83/df562574.jpg","nickname":"慎独明强","note":"","ucode":"DC2F7F2C0C8F60","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":294361,"discussion_content":"可以通过otter将分表数据同步到适合做大表查询的单表中。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595860378,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1179156,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fe/14/f1532dec.jpg","nickname":"鲁班大师","note":"","ucode":"4F9615DF87B031","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1611,"discussion_content":"李老师的意思是使用分区吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562730189,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2032840,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/04/c8/3c7af100.jpg","nickname":"Javatar","note":"","ucode":"E216645CDF632C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1179156,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fe/14/f1532dec.jpg","nickname":"鲁班大师","note":"","ucode":"4F9615DF87B031","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290834,"discussion_content":"老师的意思应该是写入订单表（分表）后，再往另一个统计库（未分表）写一份。即同一条数据写两份。","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1594616797,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":1611,"ip_address":"","group_id":0},"score":290834,"extra":""}]}]},{"had_liked":false,"id":10876,"user_name":"明日之春","can_delete":false,"product_type":"c1","uid":1072544,"ip_address":"","ucode":"9B079DA9BD34A0","user_header":"https://static001.geekbang.org/account/avatar/00/10/5d/a0/4daf165a.jpg","comment_is_top":false,"comment_ctime":1527730336,"is_pvip":false,"replies":[{"id":3490,"content":"赞，写的很完善","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527819547,"ip_address":"","comment_id":10876,"utype":1}],"discussion_count":9,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"应该是这些操作依次尝试\n1.做硬件优化，例如从机械硬盘改成使用固态硬盘，当然固态硬盘不适合服务器使用，只是举个例子\n2.先做数据库服务器的调优操作，例如增加索引，oracle有很多的参数调整;\n3.引入缓存技术，例如Redis，减少数据库压力\n4.程序与数据库表优化，重构，例如根据业务逻辑对程序逻辑做优化，减少不必要的查询;\n5.在这些操作都不能大幅度优化性能的情况下，不能满足将来的发展，再考虑分库分表，也要有预估性","like_count":234,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418621,"discussion_content":"赞，写的很完善","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527819547,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1318970,"avatar":"https://static001.geekbang.org/account/avatar/00/14/20/3a/90db6a24.jpg","nickname":"Long","note":"","ucode":"2417242560360A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":47803,"discussion_content":"关于@明日之春同学的答案，这个写的一看就是有实际感受过的，哈哈。\n不过有一点可能需要探讨下，数据库方面的优化，我之前看过的介绍大多都是，\n从成本角度考虑从小到大：\nSQL优化-->业务或者表结构优化-->数据库参数配置优化-->硬件和架构优化。\n我也比较认可这样的尝试顺序过程，硬件尝试靠后。\n\n因为原答案说了“依次”尝试，这可能需要说下背景，比如公司不差钱之类的，哈哈。。。不然可能会有理解偏差和误解。\n\nPS：说到换硬件，让我想起了，之前帮别的部门做一些巨复杂业务的查询优化，优化了半天，一点一点往目标迈进，结果客户直接上了固态硬盘，瞬间达到了预期目标，也不需要再做其他优化了。。。瞬间觉得，有钱还是会少很多烦恼。","likes_number":13,"is_delete":false,"is_hidden":false,"ctime":1573420420,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1033096,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c3/88/d16816a8.jpg","nickname":"如来神掌","note":"","ucode":"45E20FF935BD2F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1318970,"avatar":"https://static001.geekbang.org/account/avatar/00/14/20/3a/90db6a24.jpg","nickname":"Long","note":"","ucode":"2417242560360A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":304228,"discussion_content":"直接上硬件简单直接，如果换了硬件后期再有问题就可以从SQL优化开始继续了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599525633,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":47803,"ip_address":"","group_id":0},"score":304228,"extra":""}]},{"author":{"id":2041989,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/28/85/3ae5efed.jpg","nickname":"Silence°","note":"","ucode":"1782A115C603FD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293360,"discussion_content":"SQL优化 ➡️ 业务或表结构优化 ➡️ 数据库参数配置优化 ➡️ 硬件和架构设计（redis缓存等）","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1595509886,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1033096,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c3/88/d16816a8.jpg","nickname":"如来神掌","note":"","ucode":"45E20FF935BD2F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2041989,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/28/85/3ae5efed.jpg","nickname":"Silence°","note":"","ucode":"1782A115C603FD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":304224,"discussion_content":"优化顺序就按这个来，没错","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1599525495,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":293360,"ip_address":"","group_id":0},"score":304224,"extra":""}]},{"author":{"id":1170843,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/9b/0bc44a78.jpg","nickname":"yyl","note":"","ucode":"1741DACDFCA9AF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":296481,"discussion_content":"为什么“固态硬盘不适合服务器使用呢？”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596552567,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1160192,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b4/00/661fb98d.jpg","nickname":"追忆似水年华","note":"","ucode":"C1D7C0DD7E7411","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1170843,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/9b/0bc44a78.jpg","nickname":"yyl","note":"","ucode":"1741DACDFCA9AF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":310145,"discussion_content":"可能是前些年的SSD成本比较高？毕竟这是两年前的文章","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1601644090,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":296481,"ip_address":"","group_id":0},"score":310145,"extra":""},{"author":{"id":1005411,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/63/be6db73e.jpg","nickname":"周文童","note":"","ucode":"0C65A0A67229FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1170843,"avatar":"https://static001.geekbang.org/account/avatar/00/11/dd/9b/0bc44a78.jpg","nickname":"yyl","note":"","ucode":"1741DACDFCA9AF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":628301,"discussion_content":"固态硬盘可靠性没有机械硬盘高吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1695175094,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":296481,"ip_address":"北京","group_id":0},"score":628301,"extra":""}]},{"author":{"id":1078793,"avatar":"https://static001.geekbang.org/account/avatar/00/10/76/09/cf7513c8.jpg","nickname":"nero","note":"","ucode":"038100ACA14B29","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283328,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592235422,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":15439,"user_name":"Kongk0ng","can_delete":false,"product_type":"c1","uid":1004131,"ip_address":"","ucode":"784B1EABDD7328","user_header":"https://static001.geekbang.org/account/avatar/00/0f/52/63/a58ae0ab.jpg","comment_is_top":false,"comment_ctime":1531190284,"is_pvip":false,"replies":[{"id":5264,"content":"这个是hash函数实现的一个技巧，当计算hash值的时候，普通做法是取余操作，例如h%len，但如果len是2的N次方，通过位操作性能更高，计算方式为h &amp; (len-1)","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1531292131,"ip_address":"","comment_id":15439,"utype":1}],"discussion_count":16,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"如果使用hash进行分表的话，为什么大多方案推荐2的n次方作为表的总数，除了收缩容易还有什么好处吗？谢谢","like_count":96,"discussions":[{"author":{"id":1063970,"avatar":"https://static001.geekbang.org/account/avatar/00/10/3c/22/9024c062.jpg","nickname":"庄墨寒","note":"","ucode":"BBD9EFA891BF06","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285496,"discussion_content":"扩容只需要迁移一半的数据","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1592844056,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420388,"discussion_content":"这个是hash函数实现的一个技巧，当计算hash值的时候，普通做法是取余操作，例如h%len，但如果len是2的N次方，通过位操作性能更高，计算方式为h &amp;amp; (len-1)","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1531292131,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1119785,"avatar":"https://static001.geekbang.org/account/avatar/00/11/16/29/bbbbea13.jpg","nickname":"Eascholas","note":"","ucode":"5D79C684264186","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":271175,"discussion_content":"不仅位与运算效率高，而且分布更均匀。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1590104343,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1617814,"avatar":"https://static001.geekbang.org/account/avatar/00/18/af/96/fc3ce902.jpg","nickname":"Jim ᕕ( ᐛ )ᕗ ²⁰²⁰","note":"","ucode":"F95E72102B8B0D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":201057,"discussion_content":"sharding ring 已經是很成熟的理論，github 上也很多實現了 :-)","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1583757474,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1033066,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c3/6a/3272e095.jpg","nickname":"李春恒","note":"","ucode":"F2DCA19EC66DC1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":122269,"discussion_content":"这里老师说的，跟netty中的两个executorChooser思路一样，一个hash ,一个&amp;位运算，","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1578334678,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1794075,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/60/1b/37a1eb91.jpg","nickname":"威威威小哥","note":"","ucode":"D1833693BB1957","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":610455,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679568034,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"福建","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1348830,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/SM4fwn9uFicXU8cQ1rNF2LQdKNbZI1FX1jmdwaE2MTrBawbugj4TQKjMKWG0sGbmqQickyARXZFS8NZtobvoWTHA/132","nickname":"td901105","note":"","ucode":"32D42A4F36FA02","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380068,"discussion_content":"可以在分表增加时避免部分数据迁移","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624326538,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1325994,"avatar":"https://static001.geekbang.org/account/avatar/00/14/3b/aa/e8dfcd7e.jpg","nickname":"AAA_叶子","note":"","ucode":"1E93617D308EE0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378477,"discussion_content":"还一点假如扩容的话，哈希取模，原有的节点数据要么不变，要么变成原来的编号加上原有len长度。\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623242584,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2045627,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/36/bb/67d689c5.jpg","nickname":"一颗小橘子🍊","note":"","ucode":"584557A3E26B33","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376499,"discussion_content":"还有一个优点 rehash的时候只需要判断一位是0还是1来选择新的迁移位置","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622166254,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2260416,"avatar":"https://static001.geekbang.org/account/avatar/00/22/7d/c0/3ec9008e.jpg","nickname":"勿忘初心","note":"","ucode":"82DFEAEDC17131","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373750,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620865308,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1057611,"avatar":"https://static001.geekbang.org/account/avatar/00/10/23/4b/5578cbd1.jpg","nickname":"IsaacGao","note":"","ucode":"95C640D185A060","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":370526,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619442730,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1606295,"avatar":"https://static001.geekbang.org/account/avatar/00/18/82/97/04d1d538.jpg","nickname":"RickyTheGeek","note":"","ucode":"806E4334A8E093","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367765,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618465050,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2015455,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/c0/df/dd1fd72f.jpg","nickname":"Yuanzhi.Tang","note":"","ucode":"9153DFA94C8F44","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":361031,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616584318,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1716058,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/2f/5a/4ed3465d.jpg","nickname":"菜心1986","note":"","ucode":"E46C26FCBD1741","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350544,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613910429,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1078793,"avatar":"https://static001.geekbang.org/account/avatar/00/10/76/09/cf7513c8.jpg","nickname":"nero","note":"","ucode":"038100ACA14B29","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283329,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592235575,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1102743,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d3/97/953a9f5a.jpg","nickname":"清泉","note":"","ucode":"28EAE68B33A140","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":275403,"discussion_content":"这个应该与线性哈希有关。扩容时可以避免迁徙所有数据","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590714027,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81037,"user_name":"帅","can_delete":false,"product_type":"c1","uid":1469535,"ip_address":"","ucode":"A8664366C8A221","user_header":"https://static001.geekbang.org/account/avatar/00/16/6c/5f/9936f55e.jpg","comment_is_top":false,"comment_ctime":1553782364,"is_pvip":false,"replies":[{"id":29434,"content":"blob的字段是和行数据分开存储的，而且磁盘上并不是连续的，因此select blob字段会让磁盘进入随机IO模式","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1553791912,"ip_address":"","comment_id":81037,"utype":1}],"discussion_count":14,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"老师，针对mysql，发现如果字段有blob的字段，select 不写这个字段，和写这个字段，效率差异很大啊，这个是什么原因？一直没弄明白😊 ，谢谢","like_count":88,"discussions":[{"author":{"id":1063970,"avatar":"https://static001.geekbang.org/account/avatar/00/10/3c/22/9024c062.jpg","nickname":"庄墨寒","note":"","ucode":"BBD9EFA891BF06","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285496,"discussion_content":"扩容只需要迁移一半的数据","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1592844056,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420388,"discussion_content":"这个是hash函数实现的一个技巧，当计算hash值的时候，普通做法是取余操作，例如h%len，但如果len是2的N次方，通过位操作性能更高，计算方式为h &amp;amp; (len-1)","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1531292131,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1119785,"avatar":"https://static001.geekbang.org/account/avatar/00/11/16/29/bbbbea13.jpg","nickname":"Eascholas","note":"","ucode":"5D79C684264186","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":271175,"discussion_content":"不仅位与运算效率高，而且分布更均匀。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1590104343,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1617814,"avatar":"https://static001.geekbang.org/account/avatar/00/18/af/96/fc3ce902.jpg","nickname":"Jim ᕕ( ᐛ )ᕗ ²⁰²⁰","note":"","ucode":"F95E72102B8B0D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":201057,"discussion_content":"sharding ring 已經是很成熟的理論，github 上也很多實現了 :-)","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1583757474,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1033066,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c3/6a/3272e095.jpg","nickname":"李春恒","note":"","ucode":"F2DCA19EC66DC1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":122269,"discussion_content":"这里老师说的，跟netty中的两个executorChooser思路一样，一个hash ,一个&amp;位运算，","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1578334678,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1794075,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/60/1b/37a1eb91.jpg","nickname":"威威威小哥","note":"","ucode":"D1833693BB1957","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":610455,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679568034,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"福建","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1348830,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/SM4fwn9uFicXU8cQ1rNF2LQdKNbZI1FX1jmdwaE2MTrBawbugj4TQKjMKWG0sGbmqQickyARXZFS8NZtobvoWTHA/132","nickname":"td901105","note":"","ucode":"32D42A4F36FA02","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":380068,"discussion_content":"可以在分表增加时避免部分数据迁移","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624326538,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1325994,"avatar":"https://static001.geekbang.org/account/avatar/00/14/3b/aa/e8dfcd7e.jpg","nickname":"AAA_叶子","note":"","ucode":"1E93617D308EE0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378477,"discussion_content":"还一点假如扩容的话，哈希取模，原有的节点数据要么不变，要么变成原来的编号加上原有len长度。\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623242584,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2045627,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/36/bb/67d689c5.jpg","nickname":"一颗小橘子🍊","note":"","ucode":"584557A3E26B33","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376499,"discussion_content":"还有一个优点 rehash的时候只需要判断一位是0还是1来选择新的迁移位置","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622166254,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2260416,"avatar":"https://static001.geekbang.org/account/avatar/00/22/7d/c0/3ec9008e.jpg","nickname":"勿忘初心","note":"","ucode":"82DFEAEDC17131","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373750,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620865308,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1057611,"avatar":"https://static001.geekbang.org/account/avatar/00/10/23/4b/5578cbd1.jpg","nickname":"IsaacGao","note":"","ucode":"95C640D185A060","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":370526,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619442730,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1606295,"avatar":"https://static001.geekbang.org/account/avatar/00/18/82/97/04d1d538.jpg","nickname":"RickyTheGeek","note":"","ucode":"806E4334A8E093","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367765,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618465050,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2015455,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/c0/df/dd1fd72f.jpg","nickname":"Yuanzhi.Tang","note":"","ucode":"9153DFA94C8F44","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":361031,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616584318,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1716058,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/2f/5a/4ed3465d.jpg","nickname":"菜心1986","note":"","ucode":"E46C26FCBD1741","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350544,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613910429,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1078793,"avatar":"https://static001.geekbang.org/account/avatar/00/10/76/09/cf7513c8.jpg","nickname":"nero","note":"","ucode":"038100ACA14B29","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283329,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592235575,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1102743,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d3/97/953a9f5a.jpg","nickname":"清泉","note":"","ucode":"28EAE68B33A140","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":275403,"discussion_content":"这个应该与线性哈希有关。扩容时可以避免迁徙所有数据","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590714027,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10853,"user_name":"公号-技术夜未眠","can_delete":false,"product_type":"c1","uid":1013683,"ip_address":"","ucode":"83825B57CBD952","user_header":"https://static001.geekbang.org/account/avatar/00/0f/77/b3/991f3f9b.jpg","comment_is_top":false,"comment_ctime":1527728291,"is_pvip":true,"replies":[{"id":3494,"content":"没有太好的方案，要么一开始的分表方案就是按照id范围来设计的，要么就需要数据迁移","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527819872,"ip_address":"","comment_id":10853,"utype":1}],"discussion_count":3,"race_medal":1,"score":2,"product_id":100006601,"comment_content":"分库分表，可以理解为是一种空间换时间的思路，同时分流了存储压力与读写压力。\n\n数据库性能不够时，首先应该想到是否可以通过改善硬件条件等垂直扩容手段；其次可引入读写分离、缓存&#47;NoSQL、全文检索等手段；然后，单库单表的访问仍然存在性能瓶颈，可考虑分库分表，并且分库分表可以按照业务进行垂直拆分，接着进行水平拆分。\n\n我的问题是:当线上已经进行了分库分表的系统，需要进一步水平扩容时，有什么好的设计方案？","like_count":46,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418614,"discussion_content":"没有太好的方案，要么一开始的分表方案就是按照id范围来设计的，要么就需要数据迁移","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1527819872,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1434423,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e3/37/c132802f.jpg","nickname":"WESTWALL","note":"","ucode":"295A030F9D3BF4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364995,"discussion_content":"我有个思路，是不是可以参考Greenplum的扩容。例如设计的时候，每个服务器上放2个Node（数据库），这样需要扩容到2倍的时候，直接把一个Node分到新机器上就好了，不需要做迁移。依次类推，你可以放4个，或者8个……","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1617679795,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2849826,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/qNwDzf87cOnRwKEjXjr9pFvMnFzAURTLA1icYCN80OWuesPibn98IbjoiaTOCZp9WxgKvysoqfEiaDVNGtBU6Yeu4A/132","nickname":"Geek_b75429","note":"","ucode":"011F9D9866CC5C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1434423,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e3/37/c132802f.jpg","nickname":"WESTWALL","note":"","ucode":"295A030F9D3BF4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":627414,"discussion_content":"一致性hash？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1694135040,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":364995,"ip_address":"北京","group_id":0},"score":627414,"extra":""}]}]},{"had_liked":false,"id":11606,"user_name":"刘志刚","can_delete":false,"product_type":"c1","uid":1102108,"ip_address":"","ucode":"2EDEA464124639","user_header":"https://static001.geekbang.org/account/avatar/00/10/d1/1c/f6e95d1d.jpg","comment_is_top":false,"comment_ctime":1528247307,"is_pvip":false,"replies":[{"id":3739,"content":"这样做没错，如果你们12年就开始分库分表，可能当时的方案也不一定适应后来的业务变化","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528251432,"ip_address":"","comment_id":11606,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"我们公司业务增长比较平稳，已经经历了几个过程，\n1.先是最基础的主备，Oracle 扛了3年到15年，中间优化了几次硬件和数据库上的配置\n2.到16年左右开始扛不住了，数据量在3千万，但是订单表列太多，导致性能开始不理想，这个时候做了一把分区，性能勉强接受，继续扛着\n3.到17年之后做到18年开始做去O项目换MySQL了，顺带着分表和分区了，目前按业务，把一些非核心业务分出去其他库了，订单的库还没分，按照历史年表和热表来做的，做滚表实现的，热表数据差不多在1千万以内，现在性能还不错，历史数据用搜索聚合的，查询性能还不错！\n4.到后面如果业务再持续增长的话，估计就要拆订单库了\n总结一句话，分库分表要在业务需要之前一点，看数据量和业务特性！","like_count":41,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418922,"discussion_content":"这样做没错，如果你们12年就开始分库分表，可能当时的方案也不一定适应后来的业务变化","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528251432,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1359108,"avatar":"https://static001.geekbang.org/account/avatar/00/14/bd/04/fc82a7f1.jpg","nickname":"qwfys200","note":"","ucode":"DFE438CA2F77A2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":324861,"discussion_content":"通常来说，数据分为热数据和冷数据，分表分库可以基于冷热数据进行切分，像订单表，原则上，三个月内的属于热数据，三个月以外的属于冷数据，实际应用中有90%的数据是冷数据，只有我们把冷数据剥离出来，系统就可以轻松应对热数据了。关于冷热数据怎么划分，我觉得其实每个团队都有自己的划分标准。冷然数据剥离其实主要是想给系统减肥、降维，真实场景中虽然数据体量很大，但是实际的活跃数据往往是一小部分热数据，我们只要适时切分出热数据，这样对于系统来说，它所面对的则是一个已经降维过的小体量的数据表。","likes_number":8,"is_delete":false,"is_hidden":false,"ctime":1605182531,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1359108,"avatar":"https://static001.geekbang.org/account/avatar/00/14/bd/04/fc82a7f1.jpg","nickname":"qwfys200","note":"","ucode":"DFE438CA2F77A2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":324856,"discussion_content":"订单表如果业务量相当大，可以按年月、年月日分表。\n\n分表分库以后，可以借助ElasticSearch构建一个外部索引库，查询的时候，借助外部索引库来count、join。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1605181689,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1009098,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/65/ca/38dcd55a.jpg","nickname":"lupguo","note":"","ucode":"1B55A01DF78647","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":40353,"discussion_content":"按冷热表区分这点挺好的，前提是业务需要支持非实时全量统计和检索\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572172958,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10888,"user_name":"Snway","can_delete":false,"product_type":"c1","uid":1102888,"ip_address":"","ucode":"0AD31AECA8A8F7","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/28/3b6546e8.jpg","comment_is_top":false,"comment_ctime":1527731977,"is_pvip":false,"replies":[{"id":3488,"content":"我们也这样做过，后来受不了了又缩表😂😂😂","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527819437,"ip_address":"","comment_id":10888,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"我们是在设计初就考虑进去了，预估单表数据容量，再考虑未来三年的数据增长，不过现在反观这种做法，感觉有点过度设计，如当初一张用户表，分了127张，2个库，然而实际数据容量根本没这么多，顶多千万级别，不仅带来存储资源浪费，也给编码带来不少复杂度！所以我还是觉得得遵循演化原则，业务真正发展起来再考虑分库分表","like_count":40,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418629,"discussion_content":"我们也这样做过，后来受不了了又缩表😂😂😂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527819437,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":599775,"discussion_content":"面向八股文开发","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673781736,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1463987,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/cQVffRuscdhnF5vnQjgAZnbLwHDALl3TsAQsgEYCYPVfuFMSkyaTUXHs2aA0ORpx7AjI3LTR2ibKw2Q0VepymqA/132","nickname":"Geek_66158e","note":"","ucode":"8C3A579A715726","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":598888,"discussion_content":"遵循烟花原则","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1673186806,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10973,"user_name":"鲁伊李","can_delete":false,"product_type":"c1","uid":1109328,"ip_address":"","ucode":"9EF89A956CEE3A","user_header":"https://static001.geekbang.org/account/avatar/00/10/ed/50/3ad4570d.jpg","comment_is_top":false,"comment_ctime":1527771293,"is_pvip":false,"replies":[{"id":3541,"content":"没有很好的，要么中间件要么代码中间层，业务代码处理总是很麻烦的","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527846324,"ip_address":"","comment_id":10973,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"分库分表的痛点大家都知道，可否介绍下解决方案…","like_count":29,"discussions":[{"author":{"id":1518348,"avatar":"https://static001.geekbang.org/account/avatar/00/17/2b/0c/f4bdb520.jpg","nickname":"Dr. Wong","note":"","ucode":"0CEF58927E69E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385545,"discussion_content":"雀氏选择不太多，先用那个tidb吧","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1627120733,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418661,"discussion_content":"没有很好的，要么中间件要么代码中间层，业务代码处理总是很麻烦的","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1527846324,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10877,"user_name":"kylexy_0817","can_delete":false,"product_type":"c1","uid":1068372,"ip_address":"","ucode":"392DD9DD5E4B6E","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/54/9c214885.jpg","comment_is_top":false,"comment_ctime":1527730414,"is_pvip":false,"replies":[{"id":3489,"content":"关系数据库是行存储，即使不用那一列，也会从存储读取到内存","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527819519,"ip_address":"","comment_id":10877,"utype":1}],"discussion_count":6,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"其实在同一个库里做数据拆分，无需分表吧？就例如MySQL，只需要对表做分区就可以了。分表的目的主要是为后面把表分到不同的数据库实例作准备？\n还有个疑问，文中提到，用户表的description等字段内容不是经常查到，所以做垂直划分可以提高查询性能，意思是，如果表中有内容较长的字段，查询的时候不查出来（不使用select *），也会有性能问题？\n最后，我觉得当单实例的访问量，已达到机器的60%承载能力，就要考虑分库，而具体如何拆分，则要分析访问量主要集中在哪些表。至于分表，主要依据还是单表的数据量和查询性能。","like_count":25,"discussions":[{"author":{"id":1518348,"avatar":"https://static001.geekbang.org/account/avatar/00/17/2b/0c/f4bdb520.jpg","nickname":"Dr. Wong","note":"","ucode":"0CEF58927E69E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385545,"discussion_content":"雀氏选择不太多，先用那个tidb吧","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1627120733,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418661,"discussion_content":"没有很好的，要么中间件要么代码中间层，业务代码处理总是很麻烦的","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1527846324,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":55415,"user_name":"耶愿","can_delete":false,"product_type":"c1","uid":1340960,"ip_address":"","ucode":"549E54F67FC000","user_header":"https://static001.geekbang.org/account/avatar/00/14/76/20/2f9c6763.jpg","comment_is_top":false,"comment_ctime":1546167392,"is_pvip":false,"replies":[{"id":20101,"content":"后台统计库不拆分，冗余一份线上数据，既可以应对复杂的统计需求，也不担心影响线上业务","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1546310925,"ip_address":"","comment_id":55415,"utype":1}],"discussion_count":14,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"您好！请教一个问题，目前线上业务遇到一个问题，就是订单表需要在单库里分100张表，使用uid%100分的表，前端用户查数据没有问题，后台需要查天、周、月、年的统计信息，这个应该怎么实现？而且要求每行统计记录点击后可以看到该汇总信息下所有的订单记录，这个该怎么做？","like_count":20,"discussions":[{"author":{"id":1201282,"avatar":"https://static001.geekbang.org/account/avatar/00/12/54/82/4932fab1.jpg","nickname":"超仔","note":"","ucode":"A349805A381C9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2463,"discussion_content":"如果读取的字段都在index里面是不用加载所有的列到内存的，而是直接从index获取","likes_number":10,"is_delete":false,"is_hidden":false,"ctime":1563673845,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418622,"discussion_content":"关系数据库是行存储，即使不用那一列，也会从存储读取到内存","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1527819519,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1209599,"avatar":"","nickname":"Teanmy","note":"","ucode":"89F466CC698583","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362861,"discussion_content":"blob类型的不会和行内其它数据存在一起吧","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1617064048,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1015188,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7d/94/abb7bfe3.jpg","nickname":"纯洁c","note":"","ucode":"522FB46A251DEC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":615248,"discussion_content":"好问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1682137675,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1015754,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","nickname":"helloworld","note":"","ucode":"00DF2FEC58D2E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333177,"discussion_content":"老师的回答没错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607474362,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1615195,"avatar":"https://static001.geekbang.org/account/avatar/00/18/a5/5b/e1ffd5e4.jpg","nickname":"纸君","note":"","ucode":"E3791414E0B5B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285717,"discussion_content":"mysql里面假如文本字段长度过长，是不会放到聚集索引的叶子结点的，那时候就不会影响吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592919442,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":17042,"user_name":"FluttySage","can_delete":false,"product_type":"c1","uid":1173302,"ip_address":"","ucode":"4B660FBD6D43DB","user_header":"https://static001.geekbang.org/account/avatar/00/11/e7/36/fcbcd227.jpg","comment_is_top":false,"comment_ctime":1532395449,"is_pvip":false,"replies":[{"id":5923,"content":"数据写双份，一份给线上用，采用分库分表；一份给运营，不分库分表","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1532424051,"ip_address":"","comment_id":17042,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100006601,"comment_content":"老师您好，分库分表后必然会遇见运营人员实时报表查询的问题。单库时，查询实现起来比较简单。\n分库之后，查询就变得复杂了，请问有没有比较好的解决思路呢？","like_count":17,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":421018,"discussion_content":"数据写双份，一份给线上用，采用分库分表；一份给运营，不分库分表","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1532424051,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1115425,"avatar":"https://static001.geekbang.org/account/avatar/00/11/05/21/395cb96e.jpg","nickname":"John","note":"","ucode":"056F0E422DE9CC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572658,"discussion_content":"数据写双份，一份给线上用，采用分库分表；一份给运营，可以采用Es\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652885165,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2279119,"avatar":"","nickname":"Geek_de2959","note":"","ucode":"3F4D7C343E4EA7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":319983,"discussion_content":"“一份给运营，不分库分表“，不分库分表，单表不是很大","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604220914,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2791739,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/99/3b/acbc0986.jpg","nickname":"记忆不寒凉","note":"","ucode":"AC1D0AA0740803","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2279119,"avatar":"","nickname":"Geek_de2959","note":"","ucode":"3F4D7C343E4EA7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":410031,"discussion_content":"B端对性能要求不高，这个是可以接受吧感觉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635577030,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":319983,"ip_address":"","group_id":0},"score":410031,"extra":""}]}]},{"had_liked":false,"id":70199,"user_name":"大漠之鹰","can_delete":false,"product_type":"c1","uid":1101683,"ip_address":"","ucode":"F2B2A970301530","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/73/161cd6ae.jpg","comment_is_top":false,"comment_ctime":1551049579,"is_pvip":false,"replies":[{"id":27894,"content":"数据库按页加载，不是按字段加载","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1552624303,"ip_address":"","comment_id":70199,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"没查询的字段也会加载到内存，不可能吧","like_count":15},{"had_liked":false,"id":286323,"user_name":"一步两步","can_delete":false,"product_type":"c1","uid":2151836,"ip_address":"","ucode":"B59D1F5293B5C2","user_header":"https://static001.geekbang.org/account/avatar/00/20/d5/9c/842eda55.jpg","comment_is_top":false,"comment_ctime":1617255393,"is_pvip":false,"replies":[{"id":104051,"content":"这个是数据库的基础理论知识。\n\n关系型数据库存储是行存储，内存中是分页读写，单表太大的时候，如果缓存放不下，需要频繁的内存和磁盘换页操作，导致性能急剧下降。\n\n推荐看《MySQL技术内幕：InnoDB存储引擎》，如果想快速熟悉，查找一下mysql的innodb buffer pool相关知识和配置。","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1617326922,"ip_address":"","comment_id":286323,"utype":1}],"discussion_count":3,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"李老师，我其实特别不理解为什么单表数据量过大就性能下降，然后需要水平分表，能给个思路吗。我的思考是这样的，分两个角度考虑\n1.我们考虑使用innodb引擎和索引的情况下，根据b＋树的特点，计算2千万和2亿数据量查询的时间复杂度在7和8左右（logn），相差并不大，所以我认为这个和时间复杂度无关；\n2.考虑io操作，在网上查了下，假设一条记录1kb，高度为2的树大概能存2w数据，高度为3的大概能存2千万数据，考虑从磁盘获取数据的时候io操作和树的高度一样，2亿条数据，树的高度4也完全可以支撑，io多了一次，不知道影响有多大，这些是我的全部思考。","like_count":13,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517946,"discussion_content":"这个是数据库的基础理论知识。\n\n关系型数据库存储是行存储，内存中是分页读写，单表太大的时候，如果缓存放不下，需要频繁的内存和磁盘换页操作，导致性能急剧下降。\n\n推荐看《MySQL技术内幕：InnoDB存储引擎》，如果想快速熟悉，查找一下mysql的innodb buffer pool相关知识和配置。","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1617326922,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2118930,"avatar":"https://static001.geekbang.org/account/avatar/00/20/55/12/ec19ad14.jpg","nickname":"人生","note":"","ucode":"3259F341C683E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":411095,"discussion_content":"数据库查询数据并不是每次都会从磁盘中获取，大部分是命中buffer pool中的数据，如果不在buffer pool中才会读取磁盘（数据页和索引数据页），这个时候就会涉及到磁盘io，磁盘的随机io是很耗时的（应该是毫秒级别）。你可以对比下2千万和2亿数据量的查询缓存命中率。","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1635848521,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1542987,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/4b/15ab499a.jpg","nickname":"风轻扬","note":"","ucode":"DB972F2DF059C4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":607311,"discussion_content":"这本书买了很久了，还没看，要看起来了，^_^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677759732,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12772,"user_name":"食指可爱多","can_delete":false,"product_type":"c1","uid":1045721,"ip_address":"","ucode":"B918E07F55AB9E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f4/d9/e572ae4d.jpg","comment_is_top":false,"comment_ctime":1529026720,"is_pvip":false,"replies":[{"id":4243,"content":"淘宝的单元化改造就面临你说的问题，最后他们选择了买家纬度拆分，卖家纬度不拆分，详细可以搜网上的公开资料。","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1529046466,"ip_address":"","comment_id":12772,"utype":1}],"discussion_count":6,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"想请教老师一个设计问题，以电商平台交易系统为例，订单数据量非常大的时候也可以考虑水平分库分表。\n我的思考是针对消费者端订单表按用户ID哈希规则分表，这样所有对用户订单的查询条件全都带上用户ID，达到了数据分片的效果。\n但这时商家端需要对订单做管理，就很尴尬了。于是我想到，可以将订单数据做同步到另一个数据源，表结构一致只是按照商家ID进行哈希规则分表，所有商家端查询走此数据源，条件全部带上商家ID，也可以做到数据分片的效果。\n接下来问题又来了，系统还有一个平台的视角，这时貌似不好沿着这个思路继续了，恳请老师提点提点。","like_count":13,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":517946,"discussion_content":"这个是数据库的基础理论知识。\n\n关系型数据库存储是行存储，内存中是分页读写，单表太大的时候，如果缓存放不下，需要频繁的内存和磁盘换页操作，导致性能急剧下降。\n\n推荐看《MySQL技术内幕：InnoDB存储引擎》，如果想快速熟悉，查找一下mysql的innodb buffer pool相关知识和配置。","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1617326922,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2118930,"avatar":"https://static001.geekbang.org/account/avatar/00/20/55/12/ec19ad14.jpg","nickname":"人生","note":"","ucode":"3259F341C683E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":411095,"discussion_content":"数据库查询数据并不是每次都会从磁盘中获取，大部分是命中buffer pool中的数据，如果不在buffer pool中才会读取磁盘（数据页和索引数据页），这个时候就会涉及到磁盘io，磁盘的随机io是很耗时的（应该是毫秒级别）。你可以对比下2千万和2亿数据量的查询缓存命中率。","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1635848521,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1542987,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/4b/15ab499a.jpg","nickname":"风轻扬","note":"","ucode":"DB972F2DF059C4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":607311,"discussion_content":"这本书买了很久了，还没看，要看起来了，^_^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677759732,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":122135,"user_name":"Geek_88604f","can_delete":false,"product_type":"c1","uid":1501234,"ip_address":"","ucode":"33DD1318E53814","user_header":"","comment_is_top":false,"comment_ctime":1565309309,"is_pvip":false,"replies":[{"id":45754,"content":"读热点加缓存，写热点加缓冲，例如用消息队列，写热点也可以合并写","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1565924082,"ip_address":"","comment_id":122135,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"按照ID来分库的话会遇到访问热点问题，请问李老师这种情况怎么解决？","like_count":12,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419401,"discussion_content":"淘宝的单元化改造就面临你说的问题，最后他们选择了买家纬度拆分，卖家纬度不拆分，详细可以搜网上的公开资料。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1529046466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1891723,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/dd/8b/6e025928.jpg","nickname":"绿水青山","note":"","ucode":"EB250C21413C9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368076,"discussion_content":"最近看到这样一个思路，用雪花算法生成一个ID, 首先：创建商家ID的时候，生成类似这样的ID  （时间戳+公共码+机器码+计数码）   , 然后用户下订单时，肯定能以取到商品信息中的商家ID, 也生成类似的订单ID，（时间戳+机器码+计数码 +公共码） ，然后订单按照 公共码 去 hash 分表，这样处理后，当你用商家ID查询时，直接截取出商家ID的公共码做hash，那么所有这个商家 的订单，就可以路由到相应的分库或分表中了","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1618558504,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2873959,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/da/67/e18b690e.jpg","nickname":"神经蛙","note":"","ucode":"E0CE74B2363E10","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1891723,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/dd/8b/6e025928.jpg","nickname":"绿水青山","note":"","ucode":"EB250C21413C9E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":610207,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679453900,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":368076,"ip_address":"北京","group_id":0},"score":610207,"extra":""}]},{"author":{"id":2417306,"avatar":"https://static001.geekbang.org/account/avatar/00/24/e2/9a/9ff4869c.jpg","nickname":"阔别","note":"","ucode":"E37411D178B604","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378045,"discussion_content":"能厚着脸皮求一个链接吗","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1623030169,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1377572,"avatar":"https://static001.geekbang.org/account/avatar/00/15/05/24/1cc3d337.jpg","nickname":"李坤","note":"","ucode":"66686DF9700A17","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301245,"discussion_content":"冗余两份数据，做三维度拆分 买家维度，卖家维度 订单id纬度或者时间维度。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1598451177,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1161522,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b9/32/84346d4a.jpg","nickname":"雪碧心拔凉","note":"","ucode":"D13EEBAA0F443B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":409427,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635432651,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":20681,"user_name":"文竹","can_delete":false,"product_type":"c1","uid":1103167,"ip_address":"","ucode":"74413B1975976B","user_header":"https://static001.geekbang.org/account/avatar/00/10/d5/3f/80bf4841.jpg","comment_is_top":false,"comment_ctime":1534666448,"is_pvip":false,"replies":[{"id":7286,"content":"分析正确","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1534738436,"ip_address":"","comment_id":20681,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"首先并不是数据库性能不够的时候就分库分表，提升数据库性能方式很多，若有其他能在单数据库操作的方式则毫不犹豫使用，因为使用分表有固有的复杂性（join操作，事务，order by等）。\n\n分库使用时机：\n1、业务不复杂，但整体数据量已影响了数据库的性能。\n2、业务复杂，需要分模块由不同开发团队负责开发，这个时候使用分库可以减少团队间交流。\n\n分表时机：\n1、单个数据表数据量太大，拖慢了SQL操作性能。","like_count":10,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462115,"discussion_content":"读热点加缓存，写热点加缓冲，例如用消息队列，写热点也可以合并写","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1565924082,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":20028,"user_name":"Geek_58ezrw","can_delete":false,"product_type":"c1","uid":1119789,"ip_address":"","ucode":"3D1F0996CE65C8","user_header":"https://static001.geekbang.org/account/avatar/00/11/16/2d/2753369a.jpg","comment_is_top":false,"comment_ctime":1534219533,"is_pvip":false,"replies":[{"id":6958,"content":"先分表到不同数据库服务器，估计还能再撑一两年😄","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1534226708,"ip_address":"","comment_id":20028,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"看了李老师的文章，真的是受益匪浅。\n我也想请教一个问题，就是我们的数据库是使用阿里云的RDS，现在是单实例，没做分库。所有业务都在同一个库上跑一共有1000个表，包括分表，也是库内分表，主要是这两年都在快速迭代业务，性能上欠考虑，到现在也遇到瓶颈，一到业务高峰，RDS就会报警，前几天做了硬件升级。暂时稳住了。\n\n我们想从数据库架构上要优化它，但一时也不好优化，不知老师有什么好的建议，让我参考\n","like_count":10,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":422360,"discussion_content":"分析正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1534738436,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":17793,"user_name":"re冷星","can_delete":false,"product_type":"c1","uid":1129816,"ip_address":"","ucode":"D8C689AF4CFF30","user_header":"https://static001.geekbang.org/account/avatar/00/11/3d/58/01c93e75.jpg","comment_is_top":false,"comment_ctime":1532956747,"is_pvip":false,"replies":[{"id":6181,"content":"企业用的线上物理服务器至少32核16G","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1532996591,"ip_address":"","comment_id":17793,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"一直有一个问题，这里的单台服务器指的是多大的服务器。毕竟单核2G内存和8核56G内存差很多啊。","like_count":9,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":422069,"discussion_content":"先分表到不同数据库服务器，估计还能再撑一两年😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1534226708,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":16030,"user_name":"不吃番茄的西红柿","can_delete":false,"product_type":"c1","uid":1142465,"ip_address":"","ucode":"AC62CE8D23FACD","user_header":"https://static001.geekbang.org/account/avatar/00/11/6e/c1/e2cc1261.jpg","comment_is_top":false,"comment_ctime":1531748064,"is_pvip":false,"replies":[{"id":5568,"content":"跨库不一定有性能问题呀，如果有，那就尽量不要跨库，改成按用户id分库，而不是按订单id分库；如果两种方式都必须，可以考虑数据冗余，即设计两个订单表，一个以用户id分库，一个以订单id分库","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1531792393,"ip_address":"","comment_id":16030,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"华仔，如果这时候分了表之后如果用户a的比如订单数据出现在 a和b表中，那么这时候就会跨裤 这时候性能问题怎么处理呢","like_count":9,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":421274,"discussion_content":"企业用的线上物理服务器至少32核16G","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1532996591,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110141,"user_name":"ron.c","can_delete":false,"product_type":"c1","uid":1355623,"ip_address":"","ucode":"8F671EF8E51D1B","user_header":"https://static001.geekbang.org/account/avatar/00/14/af/67/5efc0101.jpg","comment_is_top":false,"comment_ctime":1562200601,"is_pvip":false,"replies":[{"id":40578,"content":"很多限制，性能也不行，详细上网查查","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1562555993,"ip_address":"","comment_id":110141,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"有个疑问，为什么不用MySQL的分区功能，是有什么缺陷吗？","like_count":7,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420642,"discussion_content":"跨库不一定有性能问题呀，如果有，那就尽量不要跨库，改成按用户id分库，而不是按订单id分库；如果两种方式都必须，可以考虑数据冗余，即设计两个订单表，一个以用户id分库，一个以订单id分库","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1531792393,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12751,"user_name":"Interesting","can_delete":false,"product_type":"c1","uid":1103693,"ip_address":"","ucode":"84E53A33DD4B29","user_header":"https://static001.geekbang.org/account/avatar/00/10/d7/4d/1a21971c.jpg","comment_is_top":false,"comment_ctime":1529020770,"is_pvip":false,"replies":[{"id":4247,"content":"高性能mysql，把explain的结果能完全看懂就很厉害了","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1529046724,"ip_address":"","comment_id":12751,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"所以在分库分表前，一般的业务用优化sql就搞定了。不用分库分表这把牛刀。老师对sql优化有什么指导建议麽？","like_count":7,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456739,"discussion_content":"很多限制，性能也不行，详细上网查查","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562555993,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70199,"user_name":"大漠之鹰","can_delete":false,"product_type":"c1","uid":1101683,"ip_address":"","ucode":"F2B2A970301530","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/73/161cd6ae.jpg","comment_is_top":false,"comment_ctime":1551049579,"is_pvip":false,"replies":[{"id":27894,"content":"数据库按页加载，不是按字段加载","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1552624303,"ip_address":"","comment_id":70199,"utype":1}],"discussion_count":2,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"没查询的字段也会加载到内存，不可能吧","like_count":15,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440487,"discussion_content":"数据库按页加载，不是按字段加载","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552624303,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"戒酒的李白","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533786,"discussion_content":"如果能走覆盖索引，就没关系，只查询需要的几个字段；如果走不了覆盖索引，需要回表，引擎层会把整个数据页load到缓冲池，再在内存中筛选，这个时候字段多了会影响性能","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1637974830,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":286323,"user_name":"一步两步","can_delete":false,"product_type":"c1","uid":2151836,"ip_address":"","ucode":"B59D1F5293B5C2","user_header":"https://static001.geekbang.org/account/avatar/00/20/d5/9c/842eda55.jpg","comment_is_top":false,"comment_ctime":1617255393,"is_pvip":false,"replies":[{"id":104051,"content":"这个是数据库的基础理论知识。\n\n关系型数据库存储是行存储，内存中是分页读写，单表太大的时候，如果缓存放不下，需要频繁的内存和磁盘换页操作，导致性能急剧下降。\n\n推荐看《MySQL技术内幕：InnoDB存储引擎》，如果想快速熟悉，查找一下mysql的innodb buffer pool相关知识和配置。","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1617326922,"ip_address":"","comment_id":286323,"utype":1}],"discussion_count":3,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"李老师，我其实特别不理解为什么单表数据量过大就性能下降，然后需要水平分表，能给个思路吗。我的思考是这样的，分两个角度考虑\n1.我们考虑使用innodb引擎和索引的情况下，根据b＋树的特点，计算2千万和2亿数据量查询的时间复杂度在7和8左右（logn），相差并不大，所以我认为这个和时间复杂度无关；\n2.考虑io操作，在网上查了下，假设一条记录1kb，高度为2的树大概能存2w数据，高度为3的大概能存2千万数据，考虑从磁盘获取数据的时候io操作和树的高度一样，2亿条数据，树的高度4也完全可以支撑，io多了一次，不知道影响有多大，这些是我的全部思考。","like_count":13,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440487,"discussion_content":"数据库按页加载，不是按字段加载","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552624303,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"戒酒的李白","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533786,"discussion_content":"如果能走覆盖索引，就没关系，只查询需要的几个字段；如果走不了覆盖索引，需要回表，引擎层会把整个数据页load到缓冲池，再在内存中筛选，这个时候字段多了会影响性能","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1637974830,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12772,"user_name":"食指可爱多","can_delete":false,"product_type":"c1","uid":1045721,"ip_address":"","ucode":"B918E07F55AB9E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f4/d9/e572ae4d.jpg","comment_is_top":false,"comment_ctime":1529026720,"is_pvip":false,"replies":[{"id":4243,"content":"淘宝的单元化改造就面临你说的问题，最后他们选择了买家纬度拆分，卖家纬度不拆分，详细可以搜网上的公开资料。","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1529046466,"ip_address":"","comment_id":12772,"utype":1}],"discussion_count":6,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"想请教老师一个设计问题，以电商平台交易系统为例，订单数据量非常大的时候也可以考虑水平分库分表。\n我的思考是针对消费者端订单表按用户ID哈希规则分表，这样所有对用户订单的查询条件全都带上用户ID，达到了数据分片的效果。\n但这时商家端需要对订单做管理，就很尴尬了。于是我想到，可以将订单数据做同步到另一个数据源，表结构一致只是按照商家ID进行哈希规则分表，所有商家端查询走此数据源，条件全部带上商家ID，也可以做到数据分片的效果。\n接下来问题又来了，系统还有一个平台的视角，这时貌似不好沿着这个思路继续了，恳请老师提点提点。","like_count":13,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419401,"discussion_content":"淘宝的单元化改造就面临你说的问题，最后他们选择了买家纬度拆分，卖家纬度不拆分，详细可以搜网上的公开资料。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1529046466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1891723,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/dd/8b/6e025928.jpg","nickname":"绿水青山","note":"","ucode":"EB250C21413C9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368076,"discussion_content":"最近看到这样一个思路，用雪花算法生成一个ID, 首先：创建商家ID的时候，生成类似这样的ID  （时间戳+公共码+机器码+计数码）   , 然后用户下订单时，肯定能以取到商品信息中的商家ID, 也生成类似的订单ID，（时间戳+机器码+计数码 +公共码） ，然后订单按照 公共码 去 hash 分表，这样处理后，当你用商家ID查询时，直接截取出商家ID的公共码做hash，那么所有这个商家 的订单，就可以路由到相应的分库或分表中了","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1618558504,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2873959,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/da/67/e18b690e.jpg","nickname":"神经蛙","note":"","ucode":"E0CE74B2363E10","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1891723,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/dd/8b/6e025928.jpg","nickname":"绿水青山","note":"","ucode":"EB250C21413C9E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":610207,"discussion_content":"👍","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679453900,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":368076,"ip_address":"北京","group_id":0},"score":610207,"extra":""}]},{"author":{"id":2417306,"avatar":"https://static001.geekbang.org/account/avatar/00/24/e2/9a/9ff4869c.jpg","nickname":"阔别","note":"","ucode":"E37411D178B604","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378045,"discussion_content":"能厚着脸皮求一个链接吗","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1623030169,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1377572,"avatar":"https://static001.geekbang.org/account/avatar/00/15/05/24/1cc3d337.jpg","nickname":"李坤","note":"","ucode":"66686DF9700A17","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":301245,"discussion_content":"冗余两份数据，做三维度拆分 买家维度，卖家维度 订单id纬度或者时间维度。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1598451177,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1161522,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b9/32/84346d4a.jpg","nickname":"雪碧心拔凉","note":"","ucode":"D13EEBAA0F443B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":409427,"discussion_content":"Mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635432651,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":122135,"user_name":"Geek_88604f","can_delete":false,"product_type":"c1","uid":1501234,"ip_address":"","ucode":"33DD1318E53814","user_header":"","comment_is_top":false,"comment_ctime":1565309309,"is_pvip":false,"replies":[{"id":45754,"content":"读热点加缓存，写热点加缓冲，例如用消息队列，写热点也可以合并写","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1565924082,"ip_address":"","comment_id":122135,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"按照ID来分库的话会遇到访问热点问题，请问李老师这种情况怎么解决？","like_count":12,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462115,"discussion_content":"读热点加缓存，写热点加缓冲，例如用消息队列，写热点也可以合并写","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1565924082,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":20681,"user_name":"文竹","can_delete":false,"product_type":"c1","uid":1103167,"ip_address":"","ucode":"74413B1975976B","user_header":"https://static001.geekbang.org/account/avatar/00/10/d5/3f/80bf4841.jpg","comment_is_top":false,"comment_ctime":1534666448,"is_pvip":false,"replies":[{"id":7286,"content":"分析正确","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1534738436,"ip_address":"","comment_id":20681,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"首先并不是数据库性能不够的时候就分库分表，提升数据库性能方式很多，若有其他能在单数据库操作的方式则毫不犹豫使用，因为使用分表有固有的复杂性（join操作，事务，order by等）。\n\n分库使用时机：\n1、业务不复杂，但整体数据量已影响了数据库的性能。\n2、业务复杂，需要分模块由不同开发团队负责开发，这个时候使用分库可以减少团队间交流。\n\n分表时机：\n1、单个数据表数据量太大，拖慢了SQL操作性能。","like_count":10,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":422360,"discussion_content":"分析正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1534738436,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":20028,"user_name":"Geek_58ezrw","can_delete":false,"product_type":"c1","uid":1119789,"ip_address":"","ucode":"3D1F0996CE65C8","user_header":"https://static001.geekbang.org/account/avatar/00/11/16/2d/2753369a.jpg","comment_is_top":false,"comment_ctime":1534219533,"is_pvip":false,"replies":[{"id":6958,"content":"先分表到不同数据库服务器，估计还能再撑一两年😄","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1534226708,"ip_address":"","comment_id":20028,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"看了李老师的文章，真的是受益匪浅。\n我也想请教一个问题，就是我们的数据库是使用阿里云的RDS，现在是单实例，没做分库。所有业务都在同一个库上跑一共有1000个表，包括分表，也是库内分表，主要是这两年都在快速迭代业务，性能上欠考虑，到现在也遇到瓶颈，一到业务高峰，RDS就会报警，前几天做了硬件升级。暂时稳住了。\n\n我们想从数据库架构上要优化它，但一时也不好优化，不知老师有什么好的建议，让我参考\n","like_count":10,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":422069,"discussion_content":"先分表到不同数据库服务器，估计还能再撑一两年😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1534226708,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":17793,"user_name":"re冷星","can_delete":false,"product_type":"c1","uid":1129816,"ip_address":"","ucode":"D8C689AF4CFF30","user_header":"https://static001.geekbang.org/account/avatar/00/11/3d/58/01c93e75.jpg","comment_is_top":false,"comment_ctime":1532956747,"is_pvip":false,"replies":[{"id":6181,"content":"企业用的线上物理服务器至少32核16G","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1532996591,"ip_address":"","comment_id":17793,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"一直有一个问题，这里的单台服务器指的是多大的服务器。毕竟单核2G内存和8核56G内存差很多啊。","like_count":9,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":421274,"discussion_content":"企业用的线上物理服务器至少32核16G","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1532996591,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":16030,"user_name":"不吃番茄的西红柿","can_delete":false,"product_type":"c1","uid":1142465,"ip_address":"","ucode":"AC62CE8D23FACD","user_header":"https://static001.geekbang.org/account/avatar/00/11/6e/c1/e2cc1261.jpg","comment_is_top":false,"comment_ctime":1531748064,"is_pvip":false,"replies":[{"id":5568,"content":"跨库不一定有性能问题呀，如果有，那就尽量不要跨库，改成按用户id分库，而不是按订单id分库；如果两种方式都必须，可以考虑数据冗余，即设计两个订单表，一个以用户id分库，一个以订单id分库","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1531792393,"ip_address":"","comment_id":16030,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"华仔，如果这时候分了表之后如果用户a的比如订单数据出现在 a和b表中，那么这时候就会跨裤 这时候性能问题怎么处理呢","like_count":9,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420642,"discussion_content":"跨库不一定有性能问题呀，如果有，那就尽量不要跨库，改成按用户id分库，而不是按订单id分库；如果两种方式都必须，可以考虑数据冗余，即设计两个订单表，一个以用户id分库，一个以订单id分库","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1531792393,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110141,"user_name":"ron.c","can_delete":false,"product_type":"c1","uid":1355623,"ip_address":"","ucode":"8F671EF8E51D1B","user_header":"https://static001.geekbang.org/account/avatar/00/14/af/67/5efc0101.jpg","comment_is_top":false,"comment_ctime":1562200601,"is_pvip":false,"replies":[{"id":40578,"content":"很多限制，性能也不行，详细上网查查","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1562555993,"ip_address":"","comment_id":110141,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"有个疑问，为什么不用MySQL的分区功能，是有什么缺陷吗？","like_count":7,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456739,"discussion_content":"很多限制，性能也不行，详细上网查查","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562555993,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":12751,"user_name":"Interesting","can_delete":false,"product_type":"c1","uid":1103693,"ip_address":"","ucode":"84E53A33DD4B29","user_header":"https://static001.geekbang.org/account/avatar/00/10/d7/4d/1a21971c.jpg","comment_is_top":false,"comment_ctime":1529020770,"is_pvip":false,"replies":[{"id":4247,"content":"高性能mysql，把explain的结果能完全看懂就很厉害了","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1529046724,"ip_address":"","comment_id":12751,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100006601,"comment_content":"所以在分库分表前，一般的业务用优化sql就搞定了。不用分库分表这把牛刀。老师对sql优化有什么指导建议麽？","like_count":7,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419393,"discussion_content":"高性能mysql，把explain的结果能完全看懂就很厉害了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1529046724,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":34571,"user_name":"func","can_delete":false,"product_type":"c1","uid":1254534,"ip_address":"","ucode":"481018617F42D8","user_header":"https://static001.geekbang.org/account/avatar/00/13/24/86/6069f169.jpg","comment_is_top":false,"comment_ctime":1540210101,"is_pvip":false,"replies":[{"id":12303,"content":"是的，而且必须这么做，因为路由表的访问量非常大，每次数据操作都要访问路由表，必须缓存，最好缓存到内存","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1540220028,"ip_address":"","comment_id":34571,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"华仔老师，用配置路由分表的话，配置路由表生成静态配置文件或者压入缓存是不是一个好的策略？","like_count":6},{"had_liked":false,"id":31620,"user_name":"车厘子要学习","can_delete":false,"product_type":"c1","uid":1249179,"ip_address":"","ucode":"BD73887D57E7F0","user_header":"https://static001.geekbang.org/account/avatar/00/13/0f/9b/26462736.jpg","comment_is_top":false,"comment_ctime":1539246694,"is_pvip":false,"replies":[{"id":11571,"content":"只有一个数据库的表中有count数据，其它数据库分库都没有，只有分表数据，要做事务只能分布式事务，分布式事务性能不行，一般不用","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1539358196,"ip_address":"","comment_id":31620,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"老师你讲的很好，但是对于文中count操作使用记录数表的缺陷有一点不理解，文中提到\n“针对“记录数表”的操作和针对子表的操作无法放在同一事务中进行处理”，这一点不太理解，在水平分表的前提下，字表和记录数表应该是在同一个数据库中的，这种情况下，为什么不能在一个事务中处理记录数表和字表呢，希望得到解答~\n","like_count":6,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426433,"discussion_content":"只有一个数据库的表中有count数据，其它数据库分库都没有，只有分表数据，要做事务只能分布式事务，分布式事务性能不行，一般不用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539358196,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":268055,"user_name":"一步两步","can_delete":false,"product_type":"c1","uid":2151836,"ip_address":"","ucode":"B59D1F5293B5C2","user_header":"https://static001.geekbang.org/account/avatar/00/20/d5/9c/842eda55.jpg","comment_is_top":false,"comment_ctime":1608040695,"is_pvip":false,"replies":[{"id":97379,"content":"不是说一定，你可以在代码或者数据库中间件这个层面做聚合。\n\n例如，不按order_id查，而是按普通的字段查，那就10张表都查一下，然后对结果进行聚合，但这个聚合过程比较复杂，例如order by， group这些，需要你自己来实现。\n\n也有一种做法是将分表的数据同步到另外一个数据库放在一张表里面，用来做统计、报表、后台运营这些非在线业务。在线的只按照order_id来查","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1608096877,"ip_address":"","comment_id":268055,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"水平分表后，查询数据是不是一定要按照分表对规则条件去查询，否则不知道去那个表找数据。假如我有一个订单表，我根据order_id去做hash分10张表，那么我查询订单数据对时候，是不是只能根据订单id去查询呢？还有就是如果我的查询条件是根据多个字段查询，我是不是要组合以后做hash分表比较好呢，这个问题有点小白，但确实令我有些困惑，大家如果了解希望能帮我解答一下。","like_count":5,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426433,"discussion_content":"只有一个数据库的表中有count数据，其它数据库分库都没有，只有分表数据，要做事务只能分布式事务，分布式事务性能不行，一般不用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539358196,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61180,"user_name":"张汉桂-东莞","can_delete":false,"product_type":"c1","uid":1116277,"ip_address":"","ucode":"38657ABA59382A","user_header":"https://static001.geekbang.org/account/avatar/00/11/08/75/512b9f26.jpg","comment_is_top":false,"comment_ctime":1547632587,"is_pvip":false,"replies":[{"id":21886,"content":"谢谢，这部分在商业数据库用的比较多，开源数据库一般不用，用分库分表，因为没有那么牛逼的硬件","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1547774111,"ip_address":"","comment_id":61180,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"老师你好，我认为这篇文章遗漏了一个知识点，就是文件组的知识点没有包含进来。我用过sqlserver和oracle都具有文件分组的功能。在create table语句中指定分组可以设置id多少到多少的写入到哪个文件。分组条件还是很灵活的。如有冒犯，请多包涵。","like_count":5,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436775,"discussion_content":"谢谢，这部分在商业数据库用的比较多，开源数据库一般不用，用分库分表，因为没有那么牛逼的硬件","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547774111,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":24997,"user_name":"BEYOND_別來無恙","can_delete":false,"product_type":"c1","uid":1050646,"ip_address":"","ucode":"227497FF529F3B","user_header":"https://static001.geekbang.org/account/avatar/00/10/08/16/400458ee.jpg","comment_is_top":false,"comment_ctime":1537235080,"is_pvip":false,"replies":[{"id":9256,"content":"最后一般都是通过多写一些业务代码实现，中间件只有几个大厂有实力开发","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1537342125,"ip_address":"","comment_id":24997,"utype":1}],"discussion_count":2,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"问题都知道，但是这篇文章没说啥解决具体方案啊，作者能不能把业内好的方案给列一下呢？","like_count":5,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424158,"discussion_content":"最后一般都是通过多写一些业务代码实现，中间件只有几个大厂有实力开发","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537342125,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2366248,"avatar":"https://static001.geekbang.org/account/avatar/00/24/1b/28/3e7a2916.jpg","nickname":"那那那","note":"","ucode":"04FD2412BB30D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334432,"discussion_content":"这个说不了，你没接触到就是公司业务数量级不到，不知道怎么做。等你接触到了，也基本到了大厂了，中间件给了解决方案了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607844737,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":17861,"user_name":"走神儿","can_delete":false,"product_type":"c1","uid":1182797,"ip_address":"","ucode":"3C9B29B646FEC8","user_header":"https://static001.geekbang.org/account/avatar/00/12/0c/4d/d185f942.jpg","comment_is_top":false,"comment_ctime":1532998739,"is_pvip":false,"replies":[{"id":6249,"content":"没有太好的方法，加表操作和加库操作最好在业务低峰期做，我们都是这样的","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1533087248,"ip_address":"","comment_id":17861,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"老师好，我在长期代码编写中面对分库分表问题实现了一个工具，也可以说是中间件，在加表或加库的时候在业务查询中异步迁移数据，这样做的缺点是无法保证异步迁移成功，所以我做了每次查询都要去原始位置查询，但这样多一次查询，目前在用多线程来优化中间件，尽量做到新旧一起查，查到谁用谁。但这样面对高并发数据访问的时候可能导致脏读，是否有较好的解决办法","like_count":5,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":424158,"discussion_content":"最后一般都是通过多写一些业务代码实现，中间件只有几个大厂有实力开发","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1537342125,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2366248,"avatar":"https://static001.geekbang.org/account/avatar/00/24/1b/28/3e7a2916.jpg","nickname":"那那那","note":"","ucode":"04FD2412BB30D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334432,"discussion_content":"这个说不了，你没接触到就是公司业务数量级不到，不知道怎么做。等你接触到了，也基本到了大厂了，中间件给了解决方案了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607844737,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11666,"user_name":"爪哇夜未眠","can_delete":false,"product_type":"c1","uid":1006025,"ip_address":"","ucode":"BBEB80EB670770","user_header":"https://static001.geekbang.org/account/avatar/00/0f/59/c9/f44cb7f3.jpg","comment_is_top":false,"comment_ctime":1528280345,"is_pvip":false,"replies":[{"id":3809,"content":"要结合业务来具体设计，不存在统一的最佳实践。例如，订单表可以按订单号分表，也可以按照买家id或者买家id分表，还可以按照时间分表，都可以，没有哪个是肯定最优的，和业务场景有关","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528341602,"ip_address":"","comment_id":11666,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"华哥，能否介绍下分库分表的最佳实践呢？或者分享下成功的实际案例","like_count":5,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":421306,"discussion_content":"没有太好的方法，加表操作和加库操作最好在业务低峰期做，我们都是这样的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1533087248,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11267,"user_name":"小喵喵","can_delete":false,"product_type":"c1","uid":1062444,"ip_address":"","ucode":"FDBBB2A59DB8B6","user_header":"https://static001.geekbang.org/account/avatar/00/10/36/2c/8bd4be3a.jpg","comment_is_top":false,"comment_ctime":1528014284,"is_pvip":false,"replies":[{"id":3620,"content":"看ID怎么生成的，递增ID容易被人遍历","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528081360,"ip_address":"","comment_id":11267,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"按照ID范围来分表，比如一千万条数据一张表，为什么数据会不均匀呢？","like_count":5,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418773,"discussion_content":"看ID怎么生成的，递增ID容易被人遍历","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528081360,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":323574,"user_name":"学习学个屁","can_delete":false,"product_type":"c1","uid":1049017,"ip_address":"","ucode":"DF2D61E6FB2FCE","user_header":"https://static001.geekbang.org/account/avatar/00/10/01/b9/73435279.jpg","comment_is_top":false,"comment_ctime":1637997587,"is_pvip":false,"replies":[{"id":117632,"content":"你这个是最全面的答案了，点赞 ：）","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1638326699,"ip_address":"","comment_id":323574,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"并不是数据库性能不好的时候，需要分析原因，什么sql问题 还是 配置问题 还是索引问题  还是数据量大 还是读写问题，不同问题不同优化，该加索引加索引 该加缓存加缓存 该读写分离分离 然后 分表 到最后实在没办法了，再分库分表。分库分表是没办法的办法，没有到这个地步就不要一股头发的分库分表。还有一些不同业务放在不同的库里，冷热 等等。不是所有的性能问题都一股闹的分库分表。","like_count":4,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534971,"discussion_content":"你这个是最全面的答案了，点赞 ：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638326699,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":221570,"user_name":"Nice","can_delete":false,"product_type":"c1","uid":1649575,"ip_address":"","ucode":"D2A626591FA91C","user_header":"https://static001.geekbang.org/account/avatar/00/19/2b/a7/ad5597a8.jpg","comment_is_top":false,"comment_ctime":1590542650,"is_pvip":false,"replies":[{"id":81816,"content":"到位","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1590641204,"ip_address":"","comment_id":221570,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"你认为什么时候引入分库分表是合适的？\n单表数据量超过千万后优化SQL语句和代码逻辑不能提高性能后就要引入分表，单库中表中数据太多达到磁盘I&#47;O瓶颈时引入分库","like_count":4,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534971,"discussion_content":"你这个是最全面的答案了，点赞 ：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638326699,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":34571,"user_name":"func","can_delete":false,"product_type":"c1","uid":1254534,"ip_address":"","ucode":"481018617F42D8","user_header":"https://static001.geekbang.org/account/avatar/00/13/24/86/6069f169.jpg","comment_is_top":false,"comment_ctime":1540210101,"is_pvip":false,"replies":[{"id":12303,"content":"是的，而且必须这么做，因为路由表的访问量非常大，每次数据操作都要访问路由表，必须缓存，最好缓存到内存","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1540220028,"ip_address":"","comment_id":34571,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"华仔老师，用配置路由分表的话，配置路由表生成静态配置文件或者压入缓存是不是一个好的策略？","like_count":6,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427253,"discussion_content":"是的，而且必须这么做，因为路由表的访问量非常大，每次数据操作都要访问路由表，必须缓存，最好缓存到内存","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540220028,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":31620,"user_name":"车厘子要学习","can_delete":false,"product_type":"c1","uid":1249179,"ip_address":"","ucode":"BD73887D57E7F0","user_header":"https://static001.geekbang.org/account/avatar/00/13/0f/9b/26462736.jpg","comment_is_top":false,"comment_ctime":1539246694,"is_pvip":false,"replies":[{"id":11571,"content":"只有一个数据库的表中有count数据，其它数据库分库都没有，只有分表数据，要做事务只能分布式事务，分布式事务性能不行，一般不用","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1539358196,"ip_address":"","comment_id":31620,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"老师你讲的很好，但是对于文中count操作使用记录数表的缺陷有一点不理解，文中提到\n“针对“记录数表”的操作和针对子表的操作无法放在同一事务中进行处理”，这一点不太理解，在水平分表的前提下，字表和记录数表应该是在同一个数据库中的，这种情况下，为什么不能在一个事务中处理记录数表和字表呢，希望得到解答~\n","like_count":6,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427253,"discussion_content":"是的，而且必须这么做，因为路由表的访问量非常大，每次数据操作都要访问路由表，必须缓存，最好缓存到内存","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1540220028,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":268055,"user_name":"一步两步","can_delete":false,"product_type":"c1","uid":2151836,"ip_address":"","ucode":"B59D1F5293B5C2","user_header":"https://static001.geekbang.org/account/avatar/00/20/d5/9c/842eda55.jpg","comment_is_top":false,"comment_ctime":1608040695,"is_pvip":false,"replies":[{"id":97379,"content":"不是说一定，你可以在代码或者数据库中间件这个层面做聚合。\n\n例如，不按order_id查，而是按普通的字段查，那就10张表都查一下，然后对结果进行聚合，但这个聚合过程比较复杂，例如order by， group这些，需要你自己来实现。\n\n也有一种做法是将分表的数据同步到另外一个数据库放在一张表里面，用来做统计、报表、后台运营这些非在线业务。在线的只按照order_id来查","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1608096877,"ip_address":"","comment_id":268055,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"水平分表后，查询数据是不是一定要按照分表对规则条件去查询，否则不知道去那个表找数据。假如我有一个订单表，我根据order_id去做hash分10张表，那么我查询订单数据对时候，是不是只能根据订单id去查询呢？还有就是如果我的查询条件是根据多个字段查询，我是不是要组合以后做hash分表比较好呢，这个问题有点小白，但确实令我有些困惑，大家如果了解希望能帮我解答一下。","like_count":5,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511829,"discussion_content":"不是说一定，你可以在代码或者数据库中间件这个层面做聚合。\n\n例如，不按order_id查，而是按普通的字段查，那就10张表都查一下，然后对结果进行聚合，但这个聚合过程比较复杂，例如order by， group这些，需要你自己来实现。\n\n也有一种做法是将分表的数据同步到另外一个数据库放在一张表里面，用来做统计、报表、后台运营这些非在线业务。在线的只按照order_id来查","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608096877,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61180,"user_name":"张汉桂-东莞","can_delete":false,"product_type":"c1","uid":1116277,"ip_address":"","ucode":"38657ABA59382A","user_header":"https://static001.geekbang.org/account/avatar/00/11/08/75/512b9f26.jpg","comment_is_top":false,"comment_ctime":1547632587,"is_pvip":false,"replies":[{"id":21886,"content":"谢谢，这部分在商业数据库用的比较多，开源数据库一般不用，用分库分表，因为没有那么牛逼的硬件","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1547774111,"ip_address":"","comment_id":61180,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"老师你好，我认为这篇文章遗漏了一个知识点，就是文件组的知识点没有包含进来。我用过sqlserver和oracle都具有文件分组的功能。在create table语句中指定分组可以设置id多少到多少的写入到哪个文件。分组条件还是很灵活的。如有冒犯，请多包涵。","like_count":5,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511829,"discussion_content":"不是说一定，你可以在代码或者数据库中间件这个层面做聚合。\n\n例如，不按order_id查，而是按普通的字段查，那就10张表都查一下，然后对结果进行聚合，但这个聚合过程比较复杂，例如order by， group这些，需要你自己来实现。\n\n也有一种做法是将分表的数据同步到另外一个数据库放在一张表里面，用来做统计、报表、后台运营这些非在线业务。在线的只按照order_id来查","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608096877,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":24997,"user_name":"BEYOND_別來無恙","can_delete":false,"product_type":"c1","uid":1050646,"ip_address":"","ucode":"227497FF529F3B","user_header":"https://static001.geekbang.org/account/avatar/00/10/08/16/400458ee.jpg","comment_is_top":false,"comment_ctime":1537235080,"is_pvip":false,"replies":[{"id":9256,"content":"最后一般都是通过多写一些业务代码实现，中间件只有几个大厂有实力开发","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1537342125,"ip_address":"","comment_id":24997,"utype":1}],"discussion_count":2,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"问题都知道，但是这篇文章没说啥解决具体方案啊，作者能不能把业内好的方案给列一下呢？","like_count":5,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436775,"discussion_content":"谢谢，这部分在商业数据库用的比较多，开源数据库一般不用，用分库分表，因为没有那么牛逼的硬件","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547774111,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":17861,"user_name":"走神儿","can_delete":false,"product_type":"c1","uid":1182797,"ip_address":"","ucode":"3C9B29B646FEC8","user_header":"https://static001.geekbang.org/account/avatar/00/12/0c/4d/d185f942.jpg","comment_is_top":false,"comment_ctime":1532998739,"is_pvip":false,"replies":[{"id":6249,"content":"没有太好的方法，加表操作和加库操作最好在业务低峰期做，我们都是这样的","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1533087248,"ip_address":"","comment_id":17861,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"老师好，我在长期代码编写中面对分库分表问题实现了一个工具，也可以说是中间件，在加表或加库的时候在业务查询中异步迁移数据，这样做的缺点是无法保证异步迁移成功，所以我做了每次查询都要去原始位置查询，但这样多一次查询，目前在用多线程来优化中间件，尽量做到新旧一起查，查到谁用谁。但这样面对高并发数据访问的时候可能导致脏读，是否有较好的解决办法","like_count":5,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":421306,"discussion_content":"没有太好的方法，加表操作和加库操作最好在业务低峰期做，我们都是这样的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1533087248,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11666,"user_name":"爪哇夜未眠","can_delete":false,"product_type":"c1","uid":1006025,"ip_address":"","ucode":"BBEB80EB670770","user_header":"https://static001.geekbang.org/account/avatar/00/0f/59/c9/f44cb7f3.jpg","comment_is_top":false,"comment_ctime":1528280345,"is_pvip":false,"replies":[{"id":3809,"content":"要结合业务来具体设计，不存在统一的最佳实践。例如，订单表可以按订单号分表，也可以按照买家id或者买家id分表，还可以按照时间分表，都可以，没有哪个是肯定最优的，和业务场景有关","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528341602,"ip_address":"","comment_id":11666,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"华哥，能否介绍下分库分表的最佳实践呢？或者分享下成功的实际案例","like_count":5,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418947,"discussion_content":"要结合业务来具体设计，不存在统一的最佳实践。例如，订单表可以按订单号分表，也可以按照买家id或者买家id分表，还可以按照时间分表，都可以，没有哪个是肯定最优的，和业务场景有关","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528341602,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11267,"user_name":"小喵喵","can_delete":false,"product_type":"c1","uid":1062444,"ip_address":"","ucode":"FDBBB2A59DB8B6","user_header":"https://static001.geekbang.org/account/avatar/00/10/36/2c/8bd4be3a.jpg","comment_is_top":false,"comment_ctime":1528014284,"is_pvip":false,"replies":[{"id":3620,"content":"看ID怎么生成的，递增ID容易被人遍历","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528081360,"ip_address":"","comment_id":11267,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"按照ID范围来分表，比如一千万条数据一张表，为什么数据会不均匀呢？","like_count":5,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418947,"discussion_content":"要结合业务来具体设计，不存在统一的最佳实践。例如，订单表可以按订单号分表，也可以按照买家id或者买家id分表，还可以按照时间分表，都可以，没有哪个是肯定最优的，和业务场景有关","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528341602,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":323574,"user_name":"学习学个屁","can_delete":false,"product_type":"c1","uid":1049017,"ip_address":"","ucode":"DF2D61E6FB2FCE","user_header":"https://static001.geekbang.org/account/avatar/00/10/01/b9/73435279.jpg","comment_is_top":false,"comment_ctime":1637997587,"is_pvip":false,"replies":[{"id":117632,"content":"你这个是最全面的答案了，点赞 ：）","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1638326699,"ip_address":"","comment_id":323574,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"并不是数据库性能不好的时候，需要分析原因，什么sql问题 还是 配置问题 还是索引问题  还是数据量大 还是读写问题，不同问题不同优化，该加索引加索引 该加缓存加缓存 该读写分离分离 然后 分表 到最后实在没办法了，再分库分表。分库分表是没办法的办法，没有到这个地步就不要一股头发的分库分表。还有一些不同业务放在不同的库里，冷热 等等。不是所有的性能问题都一股闹的分库分表。","like_count":4,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418773,"discussion_content":"看ID怎么生成的，递增ID容易被人遍历","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528081360,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":221570,"user_name":"Nice","can_delete":false,"product_type":"c1","uid":1649575,"ip_address":"","ucode":"D2A626591FA91C","user_header":"https://static001.geekbang.org/account/avatar/00/19/2b/a7/ad5597a8.jpg","comment_is_top":false,"comment_ctime":1590542650,"is_pvip":false,"replies":[{"id":81816,"content":"到位","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1590641204,"ip_address":"","comment_id":221570,"utype":1}],"discussion_count":1,"race_medal":0,"score":4,"product_id":100006601,"comment_content":"你认为什么时候引入分库分表是合适的？\n单表数据量超过千万后优化SQL语句和代码逻辑不能提高性能后就要引入分表，单库中表中数据太多达到磁盘I&#47;O瓶颈时引入分库","like_count":4,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496498,"discussion_content":"到位","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590641204,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":105534,"user_name":"阿哲","can_delete":false,"product_type":"c1","uid":1401452,"ip_address":"","ucode":"5ADFE1085054B6","user_header":"https://static001.geekbang.org/account/avatar/00/15/62/6c/98a69882.jpg","comment_is_top":false,"comment_ctime":1561023508,"is_pvip":false,"replies":[{"id":38274,"content":"和5G一毛钱关系都没有😂😂","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1561088756,"ip_address":"","comment_id":105534,"utype":1}],"discussion_count":4,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"分库分表和读写分离都是由于要解决技术问题，而带来了技术相关复杂性。预测5G以后new sql会发展起来。甚至是对现有数据库理论的颠覆。","like_count":4},{"had_liked":false,"id":83886,"user_name":"书中迷梦","can_delete":false,"product_type":"c1","uid":1103010,"ip_address":"","ucode":"1C6B697F41698F","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/a2/fa41c8a8.jpg","comment_is_top":false,"comment_ctime":1554729093,"is_pvip":false,"replies":[{"id":31436,"content":"这也是一种方法","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1555598748,"ip_address":"","comment_id":83886,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"分表以后的的count  order  by  等一些页面查询的东西 我觉得可以走ES，这些东西不需要实时性，","like_count":4,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454717,"discussion_content":"和5G一毛钱关系都没有😂😂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561088756,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1223523,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ab/63/2ff64979.jpg","nickname":"依旧","note":"","ucode":"39D2ABDB9F15A6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":106739,"discussion_content":"这哥们很逗啊，很可爱","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1577542832,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1518348,"avatar":"https://static001.geekbang.org/account/avatar/00/17/2b/0c/f4bdb520.jpg","nickname":"Dr. Wong","note":"","ucode":"0CEF58927E69E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385546,"discussion_content":"意思应该是5G会加速云原生生态的整合，给用户一个连接地址就能开箱即用，不再本地自建了，也就不用操心分库分表了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627121822,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1047311,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/fb/0f/2bb7e1e8.jpg","nickname":"长芽的土豆子","note":"","ucode":"92E2C6158BD5B7","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":320866,"discussion_content":"ppt架构师？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604493971,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11092,"user_name":"万里晴空","can_delete":false,"product_type":"c1","uid":1102030,"ip_address":"","ucode":"D189F67E82BAB4","user_header":"https://static001.geekbang.org/account/avatar/00/10/d0/ce/42018f4f.jpg","comment_is_top":false,"comment_ctime":1527838300,"is_pvip":false,"replies":[{"id":3540,"content":"单表千万级不一定有问题，关键看性能要求，有的历史表几千万数据，但几乎没有访问","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527846260,"ip_address":"","comment_id":11092,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"那单表的话就会出现千万级数据，这样两三年单表很大了，会不会出现性能问题。而且我们有一个功能是用到这张表进行统计，数据量大的话，在抽取数据也有可能出现卡死问题","like_count":4,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446172,"discussion_content":"这也是一种方法","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555598748,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":246988,"user_name":"escray","can_delete":false,"product_type":"c1","uid":1020525,"ip_address":"","ucode":"1F4204930E47C4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","comment_is_top":false,"comment_ctime":1599551548,"is_pvip":true,"replies":[{"id":91155,"content":"一般用中间件做分库分表更简单一些，但是对于一些要定制的场景可能就没那么方便了","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1599983225,"ip_address":"","comment_id":246988,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"架构师面试的时候，感觉分库也是常见的问题之一，不过的确大部分的架构师应该不需要考虑分库。如何使用单台数据库服务器支撑 10 万用户量量级的业务，才是应该关注的重点。之前见到的业务系统，随随便便就上个 Oracle 集群，服务器高配，其实支撑的用户也不过千人。\n\n三种路由方式里面，感觉范围路由比较简单，并且可以在第一次读取之后放到缓存里面（其他两种也可以）。\n\n专栏里面没有详细讲，但是我感觉分库分表是不是更多的采用中间件封装的方式，特别是相对复杂的分表，看到留言里面有推荐 Mycat 的 https:&#47;&#47;github.com&#47;MyCATApache，而且好像有专门针对 MySQL 的 Mycat2。\n\n“分库有风险，分表需谨慎”\n\n之前遇到的状况是，在业务系统里面积累了很多年的数据，我觉的比较好的方案可能是根据数据的年份来分库，把现实库和历史库分开。实际上，在业务系统无法支撑的时候，的确是这样做的，我们会把历史数据导出（也为了节省存储空间）。","like_count":3,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418713,"discussion_content":"单表千万级不一定有问题，关键看性能要求，有的历史表几千万数据，但几乎没有访问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527846260,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":176894,"user_name":"WolvesLeader","can_delete":false,"product_type":"c1","uid":1103839,"ip_address":"","ucode":"33610E19CA2E96","user_header":"https://static001.geekbang.org/account/avatar/00/10/d7/df/fc0a6709.jpg","comment_is_top":false,"comment_ctime":1581217477,"is_pvip":false,"replies":[{"id":69944,"content":"很大概率会出现超卖的，高并发扣库存是分布式的一个很大挑战，最简单的就是update……count=count-1 where count &gt; 0，这种方法可能会浪费库存，就是库存扣减了但订单没下成功；其它方法有数据库事务，淘宝的TCC分布式事务，redis或者zookeeper分布式锁等，通常情况下最简单又能支持一定量级的并发方案是分库分表加数据库事务","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1582192213,"ip_address":"","comment_id":176894,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"老师，请教你一个问题。我们项目中有那种库存操作。就是先扣减库存成功后，在进行入订单库。\n因为是订单，有什么好的方法，在高并发情况下，扣减库存操作不会出现超卖的情况？","like_count":3,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505282,"discussion_content":"一般用中间件做分库分表更简单一些，但是对于一些要定制的场景可能就没那么方便了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599983225,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":32363,"user_name":"aaaaaaaaaaaas","can_delete":false,"product_type":"c1","uid":1230417,"ip_address":"","ucode":"44F3D4DB3F5678","user_header":"https://static001.geekbang.org/account/avatar/00/12/c6/51/30c17473.jpg","comment_is_top":false,"comment_ctime":1539561363,"is_pvip":false,"replies":[{"id":11839,"content":"不一定，可能高也可能低，再同一张表中oeder by性能主要受限于io性能，多张表order by再合并，受限于io性能和网络性能共同作用","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1539584499,"ip_address":"","comment_id":32363,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"有点不明白，将大数据量的表进行水平分表，那分表后的order by查询 会比未进行分表的order by性能高吗？","like_count":3,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483239,"discussion_content":"很大概率会出现超卖的，高并发扣库存是分布式的一个很大挑战，最简单的就是update……count=count-1 where count &amp;gt; 0，这种方法可能会浪费库存，就是库存扣减了但订单没下成功；其它方法有数据库事务，淘宝的TCC分布式事务，redis或者zookeeper分布式锁等，通常情况下最简单又能支持一定量级的并发方案是分库分表加数据库事务","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1582192213,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11599,"user_name":"飞","can_delete":false,"product_type":"c1","uid":1102580,"ip_address":"","ucode":"4E11AA4D806F1E","user_header":"https://static001.geekbang.org/account/avatar/00/10/d2/f4/c0ec0ea9.jpg","comment_is_top":false,"comment_ctime":1528245008,"is_pvip":false,"replies":[{"id":3741,"content":"只有中间件和中间层能做到，例如TDDL","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528251876,"ip_address":"","comment_id":11599,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"如何实现对业务透明的分表，同时也能支持数据库join，group by等操作。","like_count":3,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418917,"discussion_content":"只有中间件和中间层能做到，例如TDDL","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528251876,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11362,"user_name":"weineel","can_delete":false,"product_type":"c1","uid":1049741,"ip_address":"","ucode":"6DC6EF4F256A53","user_header":"https://static001.geekbang.org/account/avatar/00/10/04/8d/005c2ff3.jpg","comment_is_top":false,"comment_ctime":1528088903,"is_pvip":true,"replies":[{"id":3762,"content":"如果有limit，第二次会小一些，如果都是全量order by，性能怎么做都高不到哪里去，分库分表还会更慢","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528254221,"ip_address":"","comment_id":11362,"utype":1}],"discussion_count":1,"race_medal":1,"score":5,"product_id":100006601,"comment_content":"老师您好，看了复杂度的分析启发很大，希望可以多讲讲实现方案。比如，分表的情况下做order by，需要综合所有数据做二次order by，第二次的时候数据量不是也很大吗？可能还没有索引，会不会更慢？","like_count":3,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418917,"discussion_content":"只有中间件和中间层能做到，例如TDDL","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528251876,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11223,"user_name":"万里晴空","can_delete":false,"product_type":"c1","uid":1102030,"ip_address":"","ucode":"D189F67E82BAB4","user_header":"https://static001.geekbang.org/account/avatar/00/10/d0/ce/42018f4f.jpg","comment_is_top":false,"comment_ctime":1527950307,"is_pvip":false,"replies":[{"id":3627,"content":"拆分表后表容量小了，索性和数据也会小，性能会高一些","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528081775,"ip_address":"","comment_id":11223,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"历史拆分出来，和分区一个道理，我想知道为什么拆分历史表会好一点？拆分后关于历史数据和业务后期有一种补录功能，这样就会两张表切换了。很想知道原因，谢谢啦","like_count":3,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418807,"discussion_content":"如果有limit，第二次会小一些，如果都是全量order by，性能怎么做都高不到哪里去，分库分表还会更慢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528254221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":282035,"user_name":"DFighting","can_delete":false,"product_type":"c1","uid":1233193,"ip_address":"","ucode":"F3BA2426FF8582","user_header":"https://static001.geekbang.org/account/avatar/00/12/d1/29/1b1234ed.jpg","comment_is_top":false,"comment_ctime":1615023818,"is_pvip":false,"replies":[{"id":102420,"content":"不要自己尝试去解决，用shardingsphere这类开源项目即可。","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1615079886,"ip_address":"","comment_id":282035,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"当产品性能瓶颈在存储压力这里时，不一定需要立马考虑分库分表，比如存储压力存在的时机只是莫某些峰值时间段或业务场景，可以单独优化，比如热点数据缓存等。因为分库分表虽然可以从根本上解决存储压力，但是因此带来的复杂度也是巨大的，join，事务，路由等等。换个角度来看，业务某些时候出现存储压力是一个信号，架构师就可以尝试考虑分库分表的事情了，充分思考设计出来的方案肯定比匆忙做出来的方案好得多，以后填的坑也会少的多。老师能不能搞一个专题啥的，讨论下分库分表下的这些问题的解决思路呀，比如事务,join等，吸取巨人的经验","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418760,"discussion_content":"拆分表后表容量小了，索性和数据也会小，性能会高一些","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528081775,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":105534,"user_name":"阿哲","can_delete":false,"product_type":"c1","uid":1401452,"ip_address":"","ucode":"5ADFE1085054B6","user_header":"https://static001.geekbang.org/account/avatar/00/15/62/6c/98a69882.jpg","comment_is_top":false,"comment_ctime":1561023508,"is_pvip":false,"replies":[{"id":38274,"content":"和5G一毛钱关系都没有😂😂","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1561088756,"ip_address":"","comment_id":105534,"utype":1}],"discussion_count":4,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"分库分表和读写分离都是由于要解决技术问题，而带来了技术相关复杂性。预测5G以后new sql会发展起来。甚至是对现有数据库理论的颠覆。","like_count":4,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454717,"discussion_content":"和5G一毛钱关系都没有😂😂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561088756,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1223523,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ab/63/2ff64979.jpg","nickname":"依旧","note":"","ucode":"39D2ABDB9F15A6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":106739,"discussion_content":"这哥们很逗啊，很可爱","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1577542832,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1518348,"avatar":"https://static001.geekbang.org/account/avatar/00/17/2b/0c/f4bdb520.jpg","nickname":"Dr. Wong","note":"","ucode":"0CEF58927E69E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385546,"discussion_content":"意思应该是5G会加速云原生生态的整合，给用户一个连接地址就能开箱即用，不再本地自建了，也就不用操心分库分表了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627121822,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1047311,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/fb/0f/2bb7e1e8.jpg","nickname":"长芽的土豆子","note":"","ucode":"92E2C6158BD5B7","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":320866,"discussion_content":"ppt架构师？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604493971,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":83886,"user_name":"书中迷梦","can_delete":false,"product_type":"c1","uid":1103010,"ip_address":"","ucode":"1C6B697F41698F","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/a2/fa41c8a8.jpg","comment_is_top":false,"comment_ctime":1554729093,"is_pvip":false,"replies":[{"id":31436,"content":"这也是一种方法","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1555598748,"ip_address":"","comment_id":83886,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"分表以后的的count  order  by  等一些页面查询的东西 我觉得可以走ES，这些东西不需要实时性，","like_count":4,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446172,"discussion_content":"这也是一种方法","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555598748,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11092,"user_name":"万里晴空","can_delete":false,"product_type":"c1","uid":1102030,"ip_address":"","ucode":"D189F67E82BAB4","user_header":"https://static001.geekbang.org/account/avatar/00/10/d0/ce/42018f4f.jpg","comment_is_top":false,"comment_ctime":1527838300,"is_pvip":false,"replies":[{"id":3540,"content":"单表千万级不一定有问题，关键看性能要求，有的历史表几千万数据，但几乎没有访问","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527846260,"ip_address":"","comment_id":11092,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"那单表的话就会出现千万级数据，这样两三年单表很大了，会不会出现性能问题。而且我们有一个功能是用到这张表进行统计，数据量大的话，在抽取数据也有可能出现卡死问题","like_count":4,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418713,"discussion_content":"单表千万级不一定有问题，关键看性能要求，有的历史表几千万数据，但几乎没有访问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527846260,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":246988,"user_name":"escray","can_delete":false,"product_type":"c1","uid":1020525,"ip_address":"","ucode":"1F4204930E47C4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","comment_is_top":false,"comment_ctime":1599551548,"is_pvip":true,"replies":[{"id":91155,"content":"一般用中间件做分库分表更简单一些，但是对于一些要定制的场景可能就没那么方便了","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1599983225,"ip_address":"","comment_id":246988,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"架构师面试的时候，感觉分库也是常见的问题之一，不过的确大部分的架构师应该不需要考虑分库。如何使用单台数据库服务器支撑 10 万用户量量级的业务，才是应该关注的重点。之前见到的业务系统，随随便便就上个 Oracle 集群，服务器高配，其实支撑的用户也不过千人。\n\n三种路由方式里面，感觉范围路由比较简单，并且可以在第一次读取之后放到缓存里面（其他两种也可以）。\n\n专栏里面没有详细讲，但是我感觉分库分表是不是更多的采用中间件封装的方式，特别是相对复杂的分表，看到留言里面有推荐 Mycat 的 https:&#47;&#47;github.com&#47;MyCATApache，而且好像有专门针对 MySQL 的 Mycat2。\n\n“分库有风险，分表需谨慎”\n\n之前遇到的状况是，在业务系统里面积累了很多年的数据，我觉的比较好的方案可能是根据数据的年份来分库，把现实库和历史库分开。实际上，在业务系统无法支撑的时候，的确是这样做的，我们会把历史数据导出（也为了节省存储空间）。","like_count":3,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505282,"discussion_content":"一般用中间件做分库分表更简单一些，但是对于一些要定制的场景可能就没那么方便了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599983225,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":176894,"user_name":"WolvesLeader","can_delete":false,"product_type":"c1","uid":1103839,"ip_address":"","ucode":"33610E19CA2E96","user_header":"https://static001.geekbang.org/account/avatar/00/10/d7/df/fc0a6709.jpg","comment_is_top":false,"comment_ctime":1581217477,"is_pvip":false,"replies":[{"id":69944,"content":"很大概率会出现超卖的，高并发扣库存是分布式的一个很大挑战，最简单的就是update……count=count-1 where count &gt; 0，这种方法可能会浪费库存，就是库存扣减了但订单没下成功；其它方法有数据库事务，淘宝的TCC分布式事务，redis或者zookeeper分布式锁等，通常情况下最简单又能支持一定量级的并发方案是分库分表加数据库事务","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1582192213,"ip_address":"","comment_id":176894,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"老师，请教你一个问题。我们项目中有那种库存操作。就是先扣减库存成功后，在进行入订单库。\n因为是订单，有什么好的方法，在高并发情况下，扣减库存操作不会出现超卖的情况？","like_count":3,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483239,"discussion_content":"很大概率会出现超卖的，高并发扣库存是分布式的一个很大挑战，最简单的就是update……count=count-1 where count &amp;gt; 0，这种方法可能会浪费库存，就是库存扣减了但订单没下成功；其它方法有数据库事务，淘宝的TCC分布式事务，redis或者zookeeper分布式锁等，通常情况下最简单又能支持一定量级的并发方案是分库分表加数据库事务","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1582192213,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":32363,"user_name":"aaaaaaaaaaaas","can_delete":false,"product_type":"c1","uid":1230417,"ip_address":"","ucode":"44F3D4DB3F5678","user_header":"https://static001.geekbang.org/account/avatar/00/12/c6/51/30c17473.jpg","comment_is_top":false,"comment_ctime":1539561363,"is_pvip":false,"replies":[{"id":11839,"content":"不一定，可能高也可能低，再同一张表中oeder by性能主要受限于io性能，多张表order by再合并，受限于io性能和网络性能共同作用","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1539584499,"ip_address":"","comment_id":32363,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"有点不明白，将大数据量的表进行水平分表，那分表后的order by查询 会比未进行分表的order by性能高吗？","like_count":3,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426741,"discussion_content":"不一定，可能高也可能低，再同一张表中oeder by性能主要受限于io性能，多张表order by再合并，受限于io性能和网络性能共同作用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539584499,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11599,"user_name":"飞","can_delete":false,"product_type":"c1","uid":1102580,"ip_address":"","ucode":"4E11AA4D806F1E","user_header":"https://static001.geekbang.org/account/avatar/00/10/d2/f4/c0ec0ea9.jpg","comment_is_top":false,"comment_ctime":1528245008,"is_pvip":false,"replies":[{"id":3741,"content":"只有中间件和中间层能做到，例如TDDL","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528251876,"ip_address":"","comment_id":11599,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"如何实现对业务透明的分表，同时也能支持数据库join，group by等操作。","like_count":3,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426741,"discussion_content":"不一定，可能高也可能低，再同一张表中oeder by性能主要受限于io性能，多张表order by再合并，受限于io性能和网络性能共同作用","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539584499,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11362,"user_name":"weineel","can_delete":false,"product_type":"c1","uid":1049741,"ip_address":"","ucode":"6DC6EF4F256A53","user_header":"https://static001.geekbang.org/account/avatar/00/10/04/8d/005c2ff3.jpg","comment_is_top":false,"comment_ctime":1528088903,"is_pvip":true,"replies":[{"id":3762,"content":"如果有limit，第二次会小一些，如果都是全量order by，性能怎么做都高不到哪里去，分库分表还会更慢","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528254221,"ip_address":"","comment_id":11362,"utype":1}],"discussion_count":1,"race_medal":1,"score":5,"product_id":100006601,"comment_content":"老师您好，看了复杂度的分析启发很大，希望可以多讲讲实现方案。比如，分表的情况下做order by，需要综合所有数据做二次order by，第二次的时候数据量不是也很大吗？可能还没有索引，会不会更慢？","like_count":3,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418807,"discussion_content":"如果有limit，第二次会小一些，如果都是全量order by，性能怎么做都高不到哪里去，分库分表还会更慢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528254221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11223,"user_name":"万里晴空","can_delete":false,"product_type":"c1","uid":1102030,"ip_address":"","ucode":"D189F67E82BAB4","user_header":"https://static001.geekbang.org/account/avatar/00/10/d0/ce/42018f4f.jpg","comment_is_top":false,"comment_ctime":1527950307,"is_pvip":false,"replies":[{"id":3627,"content":"拆分表后表容量小了，索性和数据也会小，性能会高一些","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528081775,"ip_address":"","comment_id":11223,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"历史拆分出来，和分区一个道理，我想知道为什么拆分历史表会好一点？拆分后关于历史数据和业务后期有一种补录功能，这样就会两张表切换了。很想知道原因，谢谢啦","like_count":3,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418760,"discussion_content":"拆分表后表容量小了，索性和数据也会小，性能会高一些","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528081775,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":282035,"user_name":"DFighting","can_delete":false,"product_type":"c1","uid":1233193,"ip_address":"","ucode":"F3BA2426FF8582","user_header":"https://static001.geekbang.org/account/avatar/00/12/d1/29/1b1234ed.jpg","comment_is_top":false,"comment_ctime":1615023818,"is_pvip":false,"replies":[{"id":102420,"content":"不要自己尝试去解决，用shardingsphere这类开源项目即可。","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1615079886,"ip_address":"","comment_id":282035,"utype":1}],"discussion_count":1,"race_medal":0,"score":5,"product_id":100006601,"comment_content":"当产品性能瓶颈在存储压力这里时，不一定需要立马考虑分库分表，比如存储压力存在的时机只是莫某些峰值时间段或业务场景，可以单独优化，比如热点数据缓存等。因为分库分表虽然可以从根本上解决存储压力，但是因此带来的复杂度也是巨大的，join，事务，路由等等。换个角度来看，业务某些时候出现存储压力是一个信号，架构师就可以尝试考虑分库分表的事情了，充分思考设计出来的方案肯定比匆忙做出来的方案好得多，以后填的坑也会少的多。老师能不能搞一个专题啥的，讨论下分库分表下的这些问题的解决思路呀，比如事务,join等，吸取巨人的经验","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":516595,"discussion_content":"不要自己尝试去解决，用shardingsphere这类开源项目即可。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615079886,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":273836,"user_name":"Geek_6ce660","can_delete":false,"product_type":"c1","uid":2037556,"ip_address":"","ucode":"78C11132404BFE","user_header":"","comment_is_top":false,"comment_ctime":1610692918,"is_pvip":false,"replies":[{"id":99557,"content":"分库的话，不同业务连不同数据库，连接过多问题不明显。\n\n分表的话，一般是用数据库连接池，但是如果你的业务规模大到连接池都搞不定，那就只有用分区了，例如淘宝的单元化就是这个思路，但这个架构改造成本就很高了。","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1610940980,"ip_address":"","comment_id":273836,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"老师你好。请问分库分表后如何解决应用层数据库连接过多的问题？","like_count":2},{"had_liked":false,"id":267611,"user_name":"那那那","can_delete":false,"product_type":"c1","uid":2366248,"ip_address":"","ucode":"04FD2412BB30D3","user_header":"https://static001.geekbang.org/account/avatar/00/24/1b/28/3e7a2916.jpg","comment_is_top":false,"comment_ctime":1607844789,"is_pvip":false,"replies":[{"id":97251,"content":"hash一般是均匀的，真的发现不均匀就要迁移了，所以一般hash分表会分的比较细一些，然后多个逻辑hash区间放在同一物理数据库上，当出现热点数据或者性能不够的时候，将部分逻辑hash迁移到新的物理机器。","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1607910795,"ip_address":"","comment_id":267611,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"我想提个问题，比如按照用户ID hash分表的话，对于数据均匀性的问题怎么办？好像只能先分，然后有问题再次迁移了？","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511697,"discussion_content":"hash一般是均匀的，真的发现不均匀就要迁移了，所以一般hash分表会分的比较细一些，然后多个逻辑hash区间放在同一物理数据库上，当出现热点数据或者性能不够的时候，将部分逻辑hash迁移到新的物理机器。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607910795,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115150,"user_name":"FM微言送","can_delete":false,"product_type":"c1","uid":1157789,"ip_address":"","ucode":"8F1DB06535E196","user_header":"https://static001.geekbang.org/account/avatar/00/11/aa/9d/7431e82e.jpg","comment_is_top":false,"comment_ctime":1563500409,"is_pvip":false,"replies":[{"id":42123,"content":"直接分库，避免互相影响，也方便迁移数据","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1563538453,"ip_address":"","comment_id":115150,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"想问下老师，项目中有多个机构使用，每个机构数据是单独的互不影响。我想问下是一个机构单独一个数据库好，还是通过hash等算法分表好呢","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458988,"discussion_content":"直接分库，避免互相影响，也方便迁移数据","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563538453,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60449,"user_name":"大尾猴","can_delete":false,"product_type":"c1","uid":1205704,"ip_address":"","ucode":"617E18A39D9626","user_header":"https://static001.geekbang.org/account/avatar/00/12/65/c8/29fd8296.jpg","comment_is_top":false,"comment_ctime":1547473393,"is_pvip":false,"replies":[{"id":21891,"content":"根据业务场景推算的，例如10万注册用户，每日登录用户可能是1万，峰值请求是1000","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1547774483,"ip_address":"","comment_id":60449,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"单台机器支撑10万用户量是如何计算的？机器配置是怎样的？","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436511,"discussion_content":"根据业务场景推算的，例如10万注册用户，每日登录用户可能是1万，峰值请求是1000","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547774483,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":19236,"user_name":"Tom","can_delete":false,"product_type":"c1","uid":1109832,"ip_address":"","ucode":"00EEDE4CB11776","user_header":"","comment_is_top":false,"comment_ctime":1533726616,"is_pvip":false,"replies":[{"id":6699,"content":"单机分表比较难提升性能，你的案例，可能单表性能更好，因为存储引擎可以做很多优化","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1533781096,"ip_address":"","comment_id":19236,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"请教一下。\n感觉单机分表很难提高性能，比如按id范围每2千万一个子表，共10个子表，要查type=1，得所有子表都查一遍，应该跟单表查性能差不多吧，好像只优化了按id查的性能。\n分表和单表查询过程要加载的数据所用的内存一样。有没有单机分表提高性能的场景可以举例一下？","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436511,"discussion_content":"根据业务场景推算的，例如10万注册用户，每日登录用户可能是1万，峰值请求是1000","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547774483,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11761,"user_name":"成功","can_delete":false,"product_type":"c1","uid":1112099,"ip_address":"","ucode":"954B90AC92E8C3","user_header":"https://static001.geekbang.org/account/avatar/00/10/f8/23/165d2f0e.jpg","comment_is_top":false,"comment_ctime":1528339120,"is_pvip":false,"replies":[{"id":3811,"content":"先优化，通常数据库刚表现出压力的时候，大部分原因不是因为业务真的发展到数据库撑不住了，而是很多慢查询导致的","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528341743,"ip_address":"","comment_id":11761,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"作为架构预判，到了数据模型的阀值就要启动分库分表","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":421746,"discussion_content":"单机分表比较难提升性能，你的案例，可能单表性能更好，因为存储引擎可以做很多优化","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1533781096,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11069,"user_name":"侯操宇","can_delete":false,"product_type":"c1","uid":1117242,"ip_address":"","ucode":"741E0DC3B8EB55","user_header":"https://static001.geekbang.org/account/avatar/00/11/0c/3a/d2161d37.jpg","comment_is_top":false,"comment_ctime":1527819362,"is_pvip":false,"replies":[{"id":3525,"content":"是可以，但其实数据库的热点表一样会放在内存中，访问同样很快，因此不是很有必要引入mc或者redis来提升性能","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527838273,"ip_address":"","comment_id":11069,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"配置路由是否可以通过mc或者redis来存储路由信息实现以提升性能？避免数据库中路由表过大对性能的影响。","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418703,"discussion_content":"是可以，但其实数据库的热点表一样会放在内存中，访问同样很快，因此不是很有必要引入mc或者redis来提升性能","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527838273,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10867,"user_name":"李二木","can_delete":false,"product_type":"c1","uid":1103091,"ip_address":"","ucode":"30E03BB84ADB27","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/f3/129d6dfe.jpg","comment_is_top":false,"comment_ctime":1527729488,"is_pvip":true,"replies":[{"id":3492,"content":"业务一直发展变化的话，是有可能的","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527819644,"ip_address":"","comment_id":10867,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"分库分表会不会一直分下去？像腾讯阿里的一些应用？如果存在，是不是也会有瓶颈？","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418617,"discussion_content":"业务一直发展变化的话，是有可能的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527819644,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10852,"user_name":"zj","can_delete":false,"product_type":"c1","uid":1100064,"ip_address":"","ucode":"E3329CCF694AC2","user_header":"https://static001.geekbang.org/account/avatar/00/10/c9/20/e4f1b17c.jpg","comment_is_top":false,"comment_ctime":1527728179,"is_pvip":false,"replies":[{"id":3495,"content":"可以搜索","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527819886,"ip_address":"","comment_id":10852,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"有哪些开源的分库分表中间件呢","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418613,"discussion_content":"可以搜索","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527819886,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":384350,"user_name":"Apa琦","can_delete":false,"product_type":"c1","uid":3710982,"ip_address":"上海","ucode":"A4A76A4D7364EA","user_header":"https://static001.geekbang.org/account/avatar/00/38/a0/06/f0ca94ca.jpg","comment_is_top":false,"comment_ctime":1700725398,"is_pvip":false,"replies":[{"id":140240,"content":"是的，微服务拆分本身就把数据分库了，如果某个微服务拆分只拆分代码和应用，不拆分数据库，那就是不完整的微服务，是中间态的微服务。","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1700788368,"ip_address":"广东","comment_id":384350,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"我有个疑问，分库把数据库按照业务拆分，感觉和微服务拆分一样。比如拆分成一个用户、订单两个微服务，而这俩微服务都有自己的数据库岂不是客观上也实现了分库？","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418613,"discussion_content":"可以搜索","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527819886,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":273836,"user_name":"Geek_6ce660","can_delete":false,"product_type":"c1","uid":2037556,"ip_address":"","ucode":"78C11132404BFE","user_header":"","comment_is_top":false,"comment_ctime":1610692918,"is_pvip":false,"replies":[{"id":99557,"content":"分库的话，不同业务连不同数据库，连接过多问题不明显。\n\n分表的话，一般是用数据库连接池，但是如果你的业务规模大到连接池都搞不定，那就只有用分区了，例如淘宝的单元化就是这个思路，但这个架构改造成本就很高了。","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1610940980,"ip_address":"","comment_id":273836,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"老师你好。请问分库分表后如何解决应用层数据库连接过多的问题？","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513827,"discussion_content":"分库的话，不同业务连不同数据库，连接过多问题不明显。\n\n分表的话，一般是用数据库连接池，但是如果你的业务规模大到连接池都搞不定，那就只有用分区了，例如淘宝的单元化就是这个思路，但这个架构改造成本就很高了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610940980,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":267611,"user_name":"那那那","can_delete":false,"product_type":"c1","uid":2366248,"ip_address":"","ucode":"04FD2412BB30D3","user_header":"https://static001.geekbang.org/account/avatar/00/24/1b/28/3e7a2916.jpg","comment_is_top":false,"comment_ctime":1607844789,"is_pvip":false,"replies":[{"id":97251,"content":"hash一般是均匀的，真的发现不均匀就要迁移了，所以一般hash分表会分的比较细一些，然后多个逻辑hash区间放在同一物理数据库上，当出现热点数据或者性能不够的时候，将部分逻辑hash迁移到新的物理机器。","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1607910795,"ip_address":"","comment_id":267611,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"我想提个问题，比如按照用户ID hash分表的话，对于数据均匀性的问题怎么办？好像只能先分，然后有问题再次迁移了？","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513827,"discussion_content":"分库的话，不同业务连不同数据库，连接过多问题不明显。\n\n分表的话，一般是用数据库连接池，但是如果你的业务规模大到连接池都搞不定，那就只有用分区了，例如淘宝的单元化就是这个思路，但这个架构改造成本就很高了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610940980,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":115150,"user_name":"FM微言送","can_delete":false,"product_type":"c1","uid":1157789,"ip_address":"","ucode":"8F1DB06535E196","user_header":"https://static001.geekbang.org/account/avatar/00/11/aa/9d/7431e82e.jpg","comment_is_top":false,"comment_ctime":1563500409,"is_pvip":false,"replies":[{"id":42123,"content":"直接分库，避免互相影响，也方便迁移数据","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1563538453,"ip_address":"","comment_id":115150,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"想问下老师，项目中有多个机构使用，每个机构数据是单独的互不影响。我想问下是一个机构单独一个数据库好，还是通过hash等算法分表好呢","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":511697,"discussion_content":"hash一般是均匀的，真的发现不均匀就要迁移了，所以一般hash分表会分的比较细一些，然后多个逻辑hash区间放在同一物理数据库上，当出现热点数据或者性能不够的时候，将部分逻辑hash迁移到新的物理机器。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607910795,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":60449,"user_name":"大尾猴","can_delete":false,"product_type":"c1","uid":1205704,"ip_address":"","ucode":"617E18A39D9626","user_header":"https://static001.geekbang.org/account/avatar/00/12/65/c8/29fd8296.jpg","comment_is_top":false,"comment_ctime":1547473393,"is_pvip":false,"replies":[{"id":21891,"content":"根据业务场景推算的，例如10万注册用户，每日登录用户可能是1万，峰值请求是1000","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1547774483,"ip_address":"","comment_id":60449,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"单台机器支撑10万用户量是如何计算的？机器配置是怎样的？","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458988,"discussion_content":"直接分库，避免互相影响，也方便迁移数据","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563538453,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":19236,"user_name":"Tom","can_delete":false,"product_type":"c1","uid":1109832,"ip_address":"","ucode":"00EEDE4CB11776","user_header":"","comment_is_top":false,"comment_ctime":1533726616,"is_pvip":false,"replies":[{"id":6699,"content":"单机分表比较难提升性能，你的案例，可能单表性能更好，因为存储引擎可以做很多优化","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1533781096,"ip_address":"","comment_id":19236,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"请教一下。\n感觉单机分表很难提高性能，比如按id范围每2千万一个子表，共10个子表，要查type=1，得所有子表都查一遍，应该跟单表查性能差不多吧，好像只优化了按id查的性能。\n分表和单表查询过程要加载的数据所用的内存一样。有没有单机分表提高性能的场景可以举例一下？","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":421746,"discussion_content":"单机分表比较难提升性能，你的案例，可能单表性能更好，因为存储引擎可以做很多优化","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1533781096,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11761,"user_name":"成功","can_delete":false,"product_type":"c1","uid":1112099,"ip_address":"","ucode":"954B90AC92E8C3","user_header":"https://static001.geekbang.org/account/avatar/00/10/f8/23/165d2f0e.jpg","comment_is_top":false,"comment_ctime":1528339120,"is_pvip":false,"replies":[{"id":3811,"content":"先优化，通常数据库刚表现出压力的时候，大部分原因不是因为业务真的发展到数据库撑不住了，而是很多慢查询导致的","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528341743,"ip_address":"","comment_id":11761,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"作为架构预判，到了数据模型的阀值就要启动分库分表","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418986,"discussion_content":"先优化，通常数据库刚表现出压力的时候，大部分原因不是因为业务真的发展到数据库撑不住了，而是很多慢查询导致的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528341743,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11069,"user_name":"侯操宇","can_delete":false,"product_type":"c1","uid":1117242,"ip_address":"","ucode":"741E0DC3B8EB55","user_header":"https://static001.geekbang.org/account/avatar/00/11/0c/3a/d2161d37.jpg","comment_is_top":false,"comment_ctime":1527819362,"is_pvip":false,"replies":[{"id":3525,"content":"是可以，但其实数据库的热点表一样会放在内存中，访问同样很快，因此不是很有必要引入mc或者redis来提升性能","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527838273,"ip_address":"","comment_id":11069,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"配置路由是否可以通过mc或者redis来存储路由信息实现以提升性能？避免数据库中路由表过大对性能的影响。","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418986,"discussion_content":"先优化，通常数据库刚表现出压力的时候，大部分原因不是因为业务真的发展到数据库撑不住了，而是很多慢查询导致的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528341743,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10867,"user_name":"李二木","can_delete":false,"product_type":"c1","uid":1103091,"ip_address":"","ucode":"30E03BB84ADB27","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/f3/129d6dfe.jpg","comment_is_top":false,"comment_ctime":1527729488,"is_pvip":true,"replies":[{"id":3492,"content":"业务一直发展变化的话，是有可能的","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527819644,"ip_address":"","comment_id":10867,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"分库分表会不会一直分下去？像腾讯阿里的一些应用？如果存在，是不是也会有瓶颈？","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418703,"discussion_content":"是可以，但其实数据库的热点表一样会放在内存中，访问同样很快，因此不是很有必要引入mc或者redis来提升性能","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527838273,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10852,"user_name":"zj","can_delete":false,"product_type":"c1","uid":1100064,"ip_address":"","ucode":"E3329CCF694AC2","user_header":"https://static001.geekbang.org/account/avatar/00/10/c9/20/e4f1b17c.jpg","comment_is_top":false,"comment_ctime":1527728179,"is_pvip":false,"replies":[{"id":3495,"content":"可以搜索","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527819886,"ip_address":"","comment_id":10852,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"有哪些开源的分库分表中间件呢","like_count":2,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418617,"discussion_content":"业务一直发展变化的话，是有可能的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527819644,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":384350,"user_name":"Apa琦","can_delete":false,"product_type":"c1","uid":3710982,"ip_address":"上海","ucode":"A4A76A4D7364EA","user_header":"https://static001.geekbang.org/account/avatar/00/38/a0/06/f0ca94ca.jpg","comment_is_top":false,"comment_ctime":1700725398,"is_pvip":false,"replies":[{"id":140240,"content":"是的，微服务拆分本身就把数据分库了，如果某个微服务拆分只拆分代码和应用，不拆分数据库，那就是不完整的微服务，是中间态的微服务。","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1700788368,"ip_address":"广东","comment_id":384350,"utype":1}],"discussion_count":1,"race_medal":0,"score":6,"product_id":100006601,"comment_content":"我有个疑问，分库把数据库按照业务拆分，感觉和微服务拆分一样。比如拆分成一个用户、订单两个微服务，而这俩微服务都有自己的数据库岂不是客观上也实现了分库？","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632448,"discussion_content":"是的，微服务拆分本身就把数据分库了，如果某个微服务拆分只拆分代码和应用，不拆分数据库，那就是不完整的微服务，是中间态的微服务。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1700788368,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361012,"user_name":"吃货小哥","can_delete":false,"product_type":"c1","uid":1225455,"ip_address":"广东","ucode":"9995FC3FD620C6","user_header":"https://static001.geekbang.org/account/avatar/00/12/b2/ef/d969bf72.jpg","comment_is_top":false,"comment_ctime":1667114826,"is_pvip":false,"replies":[{"id":131392,"content":"不同数据库实例中相同的表名的表","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1667390451,"ip_address":"广东","comment_id":361012,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":" 范围路由及Hash路由算法他们在分散到不同的数据库表中，指的是不同数据库中的表？还是同一个数据库中不同的表？","like_count":1},{"had_liked":false,"id":327676,"user_name":"初见","can_delete":false,"product_type":"c1","uid":1022487,"ip_address":"","ucode":"808185EBE38A6C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9a/17/45d50064.jpg","comment_is_top":false,"comment_ctime":1640228789,"is_pvip":false,"replies":[{"id":119380,"content":"如果你的写性能扛不住了，es这类倒排索引也搞不定哦","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1640347028,"ip_address":"","comment_id":327676,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"分库分表是最后的办法，轻易不要使用。现在一般搜索引擎能够解决大部分问题。","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541375,"discussion_content":"如果你的写性能扛不住了，es这类倒排索引也搞不定哦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640347029,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":277651,"user_name":"往事随风，顺其自然","can_delete":false,"product_type":"c1","uid":1235692,"ip_address":"","ucode":"F266EC6B143E38","user_header":"https://static001.geekbang.org/account/avatar/00/12/da/ec/779c1a78.jpg","comment_is_top":false,"comment_ctime":1612508433,"is_pvip":false,"replies":[{"id":100824,"content":"正解","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1612603230,"ip_address":"","comment_id":277651,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"1，绝对并发没有上来后，优化sql语句之后，都用上索引，提高不了性能，此时是单表数据量大，此时可以单库多表。\n2，如果绝对并发上来，此时单库不够支撑，并且单表数据量也上来了，此时需要分库分表，多库多表。\n同事也需要优化sql语句来实现。","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515128,"discussion_content":"正解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612603230,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":154846,"user_name":"搞起来","can_delete":false,"product_type":"c1","uid":1478759,"ip_address":"","ucode":"1EC27CE663EE65","user_header":"https://static001.geekbang.org/account/avatar/00/16/90/67/106306e7.jpg","comment_is_top":false,"comment_ctime":1574579592,"is_pvip":false,"replies":[{"id":59851,"content":"数据库分区基本没用过😂","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1574761444,"ip_address":"","comment_id":154846,"utype":1}],"discussion_count":2,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"老师好，可以讲讲分区的使用场景和优缺点","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515128,"discussion_content":"正解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612603230,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110858,"user_name":"xiaolu289","can_delete":false,"product_type":"c1","uid":1386541,"ip_address":"","ucode":"C0A1F710AE381C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/pic1ibj7XibmJrGmiaiceVVAUEVQ1g9bmxsicy2FaCOIffpYicflUs8iaULPmw5yopN7ltbjbI1TCF0OovC1alssX6cAaA/132","comment_is_top":false,"comment_ctime":1562379556,"is_pvip":false,"replies":[{"id":40575,"content":"1. 这个用法有点反常，不会这么用，es可以存储所有数据，不会先从es查再到数据库查，一般是先查数据库再查es\n\n2.查询条件容易变，这个表不好设计\n","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1562555806,"ip_address":"","comment_id":110858,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"老师，您好，请问分库分表后为聚合，分页等查询带来的问题，是否可以使用如下方案解决？\n\n解决方案：\n\n1. 将需要作为查询条件的部分字段放到es等搜索引擎中去，根据es的查询结果，再去分库或者分表中取出这条数据的全部字段。\n\n2. 保留一张带有常用查询条件的总表，先从总表查出id，然后通过id去分表取出数据所有的字段。\n\n不知道老师您觉得哪种方案更好？\n上面描述的两种方案是否会有性能问题？\n业界一般采用什么方案处理这类型问题？\n\n希望老师能指点一二。感激不尽\n","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457096,"discussion_content":"1. 这个用法有点反常，不会这么用，es可以存储所有数据，不会先从es查再到数据库查，一般是先查数据库再查es\n\n2.查询条件容易变，这个表不好设计\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562555806,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":84289,"user_name":"罗瑞一","can_delete":false,"product_type":"c1","uid":1045279,"ip_address":"","ucode":"ACBC2704516845","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f3/1f/a58f27de.jpg","comment_is_top":false,"comment_ctime":1554820317,"is_pvip":false,"replies":[{"id":31433,"content":"不在一个数据库实例上","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1555598510,"ip_address":"","comment_id":84289,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"且针对“记录数表”的操作和针对子表的操作无法放在同一事务中进行处理，异常的情况下会出现操作子表成功了而操作记录数表失败，同样会导致数据不一致。\n\n为什么无法放一个事务啊？","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457096,"discussion_content":"1. 这个用法有点反常，不会这么用，es可以存储所有数据，不会先从es查再到数据库查，一般是先查数据库再查es\n\n2.查询条件容易变，这个表不好设计\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562555806,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11050,"user_name":"何磊","can_delete":false,"product_type":"c1","uid":1047604,"ip_address":"","ucode":"78934C3ED4A342","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fc/34/c733b116.jpg","comment_is_top":false,"comment_ctime":1527814296,"is_pvip":false,"replies":[{"id":3482,"content":"先优化，包括优化业务，优化慢查询，优化硬件，只有这些优化手段都不够后才考虑分库分表大杀器","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527818805,"ip_address":"","comment_id":11050,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"我当前使用的是mycat来进行分表，他会对数据进行聚合，但是性能可能会受到一些影响，不过对于单表上亿来说，性能还是高处不少。\n对于什么时候引入分表，还是看业务，对于不重要的数据也可以定期归档。","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418691,"discussion_content":"先优化，包括优化业务，优化慢查询，优化硬件，只有这些优化手段都不够后才考虑分库分表大杀器","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1527818805,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":396623,"user_name":"十元","can_delete":false,"product_type":"c1","uid":1644243,"ip_address":"上海","ucode":"558E9BB874B281","user_header":"https://static001.geekbang.org/account/avatar/00/19/16/d3/63ecb257.jpg","comment_is_top":false,"comment_ctime":1735112058,"is_pvip":false,"replies":[{"id":143962,"content":"大厂基建完善了，直接用分库分表也是可以的","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1735121550,"ip_address":"广东","comment_id":396623,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"作为一名大厂从业者，我一直要求自己在业务建设初期就进行分库分表的建设，否则后续再进行分库分表就会遇到扩展困难，或者数据迁移等难题。而一般在大厂是不允许业务暂停，对数据库进行停写进行数据迁移的。但是如果是一家中小企业，或者是一家B端企业，那么我建议一开始就用一张表合适，因为现在是2024年，很多数据库即使单库单表也能支持2000万以上的记录。这可能就能支持中小企业3-5年的业务发展，甚至对于B端企业来说一辈子都写不满一张表。当单表性能出现瓶颈后，再进行分库分表其实也没想象中那么麻烦，因为现在是云时代，很多云上工具可以帮助进行数据同步及迁移。只需要处理好迁移的时序就能很方便的进行数据分库分表和迁移，而业务发展到一定阶段的时候也会有更多的资源，比如人力资源和资金支持。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":655513,"discussion_content":"大厂基建完善了，直接用分库分表也是可以的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1735121550,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":387802,"user_name":"stcau","can_delete":false,"product_type":"c1","uid":1311054,"ip_address":"山东","ucode":"45671C10E5557E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKSIk2jfbj0wNGJgVt54T38FkjomEuNyPutn5Ebqo2icK4bLCKeMSgme9tichJ8r560AGzBugKSOObA/132","comment_is_top":false,"comment_ctime":1708593523,"is_pvip":false,"replies":[{"id":141254,"content":"你好歹看懂了再喷","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1708673503,"ip_address":"广东","comment_id":387802,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"水平分表适合表行数特别大的表，有的公司要求单表行数超过 5000 万就必须进行分表，这个数字可以作为参考，但并不是绝对标准，关键还是要看表的访问性能。对于一些比较复杂的表，可能超过 1000 万就要分表了；而对于一些简单的表，即使存储数据超过 1 亿行，也可以不分表。但不管怎样，当看到表的数据量达到千万级别时，作为架构师就要警觉起来，因为这很可能是架构的性能瓶颈或者隐患\n------------------------------------------\n无用废话过多，这里起码讲解下如果以mysql为例，多好数据量分表合适，从数量级和表大小方面","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":637597,"discussion_content":"你好歹看懂了再喷","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1708673503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":387016,"user_name":"Geek_ba725d","can_delete":false,"product_type":"c1","uid":2987322,"ip_address":"广东","ucode":"506CD84B9B0173","user_header":"","comment_is_top":false,"comment_ctime":1706164884,"is_pvip":false,"replies":[{"id":141102,"content":"没有非此即彼的设计，也没有完美的方案，你说的都可以，关键是根据具体的情况决定用那种。","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1706450746,"ip_address":"广东","comment_id":387016,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"我有个疑问，当我们的业务不断的迭代并且优化，实在无法优化代码时，这时候我们就会去考虑去做分库分表，这时候我们应该是舍弃掉旧的表，迁移数据到新表，还是停止对外服务在原来的表上做变更？并且变更了表之后相应的代码也需要全部做变更，这会不会导致最后的成本和风险变得很大？有什么好的方案吗","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":636562,"discussion_content":"没有非此即彼的设计，也没有完美的方案，你说的都可以，关键是根据具体的情况决定用那种。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1706450746,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":361012,"user_name":"吃货小哥","can_delete":false,"product_type":"c1","uid":1225455,"ip_address":"广东","ucode":"9995FC3FD620C6","user_header":"https://static001.geekbang.org/account/avatar/00/12/b2/ef/d969bf72.jpg","comment_is_top":false,"comment_ctime":1667114826,"is_pvip":false,"replies":[{"id":131392,"content":"不同数据库实例中相同的表名的表","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1667390451,"ip_address":"广东","comment_id":361012,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":" 范围路由及Hash路由算法他们在分散到不同的数据库表中，指的是不同数据库中的表？还是同一个数据库中不同的表？","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592409,"discussion_content":"不同数据库实例中相同的表名的表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667390451,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":327676,"user_name":"初见","can_delete":false,"product_type":"c1","uid":1022487,"ip_address":"","ucode":"808185EBE38A6C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9a/17/45d50064.jpg","comment_is_top":false,"comment_ctime":1640228789,"is_pvip":false,"replies":[{"id":119380,"content":"如果你的写性能扛不住了，es这类倒排索引也搞不定哦","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1640347028,"ip_address":"","comment_id":327676,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"分库分表是最后的办法，轻易不要使用。现在一般搜索引擎能够解决大部分问题。","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":592409,"discussion_content":"不同数据库实例中相同的表名的表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1667390451,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":277651,"user_name":"往事随风，顺其自然","can_delete":false,"product_type":"c1","uid":1235692,"ip_address":"","ucode":"F266EC6B143E38","user_header":"https://static001.geekbang.org/account/avatar/00/12/da/ec/779c1a78.jpg","comment_is_top":false,"comment_ctime":1612508433,"is_pvip":false,"replies":[{"id":100824,"content":"正解","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1612603230,"ip_address":"","comment_id":277651,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"1，绝对并发没有上来后，优化sql语句之后，都用上索引，提高不了性能，此时是单表数据量大，此时可以单库多表。\n2，如果绝对并发上来，此时单库不够支撑，并且单表数据量也上来了，此时需要分库分表，多库多表。\n同事也需要优化sql语句来实现。","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541375,"discussion_content":"如果你的写性能扛不住了，es这类倒排索引也搞不定哦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640347029,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":154846,"user_name":"搞起来","can_delete":false,"product_type":"c1","uid":1478759,"ip_address":"","ucode":"1EC27CE663EE65","user_header":"https://static001.geekbang.org/account/avatar/00/16/90/67/106306e7.jpg","comment_is_top":false,"comment_ctime":1574579592,"is_pvip":false,"replies":[{"id":59851,"content":"数据库分区基本没用过😂","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1574761444,"ip_address":"","comment_id":154846,"utype":1}],"discussion_count":2,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"老师好，可以讲讲分区的使用场景和优缺点","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475596,"discussion_content":"数据库分区基本没用过😂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574761444,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1478759,"avatar":"https://static001.geekbang.org/account/avatar/00/16/90/67/106306e7.jpg","nickname":"搞起来","note":"","ucode":"1EC27CE663EE65","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":60895,"discussion_content":"这个功能是不很鸡肋呀，😂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574763401,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110858,"user_name":"xiaolu289","can_delete":false,"product_type":"c1","uid":1386541,"ip_address":"","ucode":"C0A1F710AE381C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/pic1ibj7XibmJrGmiaiceVVAUEVQ1g9bmxsicy2FaCOIffpYicflUs8iaULPmw5yopN7ltbjbI1TCF0OovC1alssX6cAaA/132","comment_is_top":false,"comment_ctime":1562379556,"is_pvip":false,"replies":[{"id":40575,"content":"1. 这个用法有点反常，不会这么用，es可以存储所有数据，不会先从es查再到数据库查，一般是先查数据库再查es\n\n2.查询条件容易变，这个表不好设计\n","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1562555806,"ip_address":"","comment_id":110858,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"老师，您好，请问分库分表后为聚合，分页等查询带来的问题，是否可以使用如下方案解决？\n\n解决方案：\n\n1. 将需要作为查询条件的部分字段放到es等搜索引擎中去，根据es的查询结果，再去分库或者分表中取出这条数据的全部字段。\n\n2. 保留一张带有常用查询条件的总表，先从总表查出id，然后通过id去分表取出数据所有的字段。\n\n不知道老师您觉得哪种方案更好？\n上面描述的两种方案是否会有性能问题？\n业界一般采用什么方案处理这类型问题？\n\n希望老师能指点一二。感激不尽\n","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475596,"discussion_content":"数据库分区基本没用过😂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574761444,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1478759,"avatar":"https://static001.geekbang.org/account/avatar/00/16/90/67/106306e7.jpg","nickname":"搞起来","note":"","ucode":"1EC27CE663EE65","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":60895,"discussion_content":"这个功能是不很鸡肋呀，😂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574763401,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":84289,"user_name":"罗瑞一","can_delete":false,"product_type":"c1","uid":1045279,"ip_address":"","ucode":"ACBC2704516845","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f3/1f/a58f27de.jpg","comment_is_top":false,"comment_ctime":1554820317,"is_pvip":false,"replies":[{"id":31433,"content":"不在一个数据库实例上","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1555598510,"ip_address":"","comment_id":84289,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"且针对“记录数表”的操作和针对子表的操作无法放在同一事务中进行处理，异常的情况下会出现操作子表成功了而操作记录数表失败，同样会导致数据不一致。\n\n为什么无法放一个事务啊？","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446303,"discussion_content":"不在一个数据库实例上","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555598510,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11050,"user_name":"何磊","can_delete":false,"product_type":"c1","uid":1047604,"ip_address":"","ucode":"78934C3ED4A342","user_header":"https://static001.geekbang.org/account/avatar/00/0f/fc/34/c733b116.jpg","comment_is_top":false,"comment_ctime":1527814296,"is_pvip":false,"replies":[{"id":3482,"content":"先优化，包括优化业务，优化慢查询，优化硬件，只有这些优化手段都不够后才考虑分库分表大杀器","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527818805,"ip_address":"","comment_id":11050,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"我当前使用的是mycat来进行分表，他会对数据进行聚合，但是性能可能会受到一些影响，不过对于单表上亿来说，性能还是高处不少。\n对于什么时候引入分表，还是看业务，对于不重要的数据也可以定期归档。","like_count":1,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446303,"discussion_content":"不在一个数据库实例上","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555598510,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":396623,"user_name":"十元","can_delete":false,"product_type":"c1","uid":1644243,"ip_address":"上海","ucode":"558E9BB874B281","user_header":"https://static001.geekbang.org/account/avatar/00/19/16/d3/63ecb257.jpg","comment_is_top":false,"comment_ctime":1735112058,"is_pvip":false,"replies":[{"id":143962,"content":"大厂基建完善了，直接用分库分表也是可以的","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1735121550,"ip_address":"广东","comment_id":396623,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"作为一名大厂从业者，我一直要求自己在业务建设初期就进行分库分表的建设，否则后续再进行分库分表就会遇到扩展困难，或者数据迁移等难题。而一般在大厂是不允许业务暂停，对数据库进行停写进行数据迁移的。但是如果是一家中小企业，或者是一家B端企业，那么我建议一开始就用一张表合适，因为现在是2024年，很多数据库即使单库单表也能支持2000万以上的记录。这可能就能支持中小企业3-5年的业务发展，甚至对于B端企业来说一辈子都写不满一张表。当单表性能出现瓶颈后，再进行分库分表其实也没想象中那么麻烦，因为现在是云时代，很多云上工具可以帮助进行数据同步及迁移。只需要处理好迁移的时序就能很方便的进行数据分库分表和迁移，而业务发展到一定阶段的时候也会有更多的资源，比如人力资源和资金支持。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418691,"discussion_content":"先优化，包括优化业务，优化慢查询，优化硬件，只有这些优化手段都不够后才考虑分库分表大杀器","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1527818805,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":387802,"user_name":"stcau","can_delete":false,"product_type":"c1","uid":1311054,"ip_address":"山东","ucode":"45671C10E5557E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKSIk2jfbj0wNGJgVt54T38FkjomEuNyPutn5Ebqo2icK4bLCKeMSgme9tichJ8r560AGzBugKSOObA/132","comment_is_top":false,"comment_ctime":1708593523,"is_pvip":false,"replies":[{"id":141254,"content":"你好歹看懂了再喷","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1708673503,"ip_address":"广东","comment_id":387802,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"水平分表适合表行数特别大的表，有的公司要求单表行数超过 5000 万就必须进行分表，这个数字可以作为参考，但并不是绝对标准，关键还是要看表的访问性能。对于一些比较复杂的表，可能超过 1000 万就要分表了；而对于一些简单的表，即使存储数据超过 1 亿行，也可以不分表。但不管怎样，当看到表的数据量达到千万级别时，作为架构师就要警觉起来，因为这很可能是架构的性能瓶颈或者隐患\n------------------------------------------\n无用废话过多，这里起码讲解下如果以mysql为例，多好数据量分表合适，从数量级和表大小方面","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":655513,"discussion_content":"大厂基建完善了，直接用分库分表也是可以的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1735121550,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":387016,"user_name":"Geek_ba725d","can_delete":false,"product_type":"c1","uid":2987322,"ip_address":"广东","ucode":"506CD84B9B0173","user_header":"","comment_is_top":false,"comment_ctime":1706164884,"is_pvip":false,"replies":[{"id":141102,"content":"没有非此即彼的设计，也没有完美的方案，你说的都可以，关键是根据具体的情况决定用那种。","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1706450746,"ip_address":"广东","comment_id":387016,"utype":1}],"discussion_count":1,"race_medal":0,"score":7,"product_id":100006601,"comment_content":"我有个疑问，当我们的业务不断的迭代并且优化，实在无法优化代码时，这时候我们就会去考虑去做分库分表，这时候我们应该是舍弃掉旧的表，迁移数据到新表，还是停止对外服务在原来的表上做变更？并且变更了表之后相应的代码也需要全部做变更，这会不会导致最后的成本和风险变得很大？有什么好的方案吗","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":637597,"discussion_content":"你好歹看懂了再喷","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1708673503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":382736,"user_name":"任锋","can_delete":false,"product_type":"c1","uid":1086592,"ip_address":"四川","ucode":"8C32C85A61C426","user_header":"https://static001.geekbang.org/account/avatar/00/10/94/80/70e483f6.jpg","comment_is_top":false,"comment_ctime":1697936592,"is_pvip":false,"replies":[{"id":139396,"content":"可以放es，但是更好的方式是放大数据平台做汇总，例如放到clickhouse这种，es毕竟是一个倒排索引的系统，用于搜索更合适","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1698061702,"ip_address":"广东","comment_id":382736,"utype":1}],"discussion_count":1,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"老师。你好，我面试遇到你说的分表之后关于统计的问题，比如我说订单表可以分表。\n面试官问我分表之后如何统计出那个用户购买最多，我当时就是回答所有子表排序取得的数据 再次重排。\n我现在有更好的方案 就是把订单数据放到es里面，通过es来进行排序查询 可以吗？我记得es也是海量存储对吧？","like_count":0},{"had_liked":false,"id":382572,"user_name":"陈峰","can_delete":false,"product_type":"c1","uid":3721548,"ip_address":"江苏","ucode":"11F92938308C6C","user_header":"","comment_is_top":false,"comment_ctime":1697599862,"is_pvip":false,"replies":[{"id":139478,"content":"记录数表只能放在一个库的一个表中，但是原始数据分布在多个数据库实例多台机器上","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1698197786,"ip_address":"广东","comment_id":382572,"utype":1}],"discussion_count":1,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"且针对“记录数表”的操作和针对子表的操作无法放在同一事务中进行处理\n\n老师，这里为什么不能放在一个事务进行处理呢，因为分库了，还是说其他原因？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":630232,"discussion_content":"记录数表只能放在一个库的一个表中，但是原始数据分布在多个数据库实例多台机器上","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1698197786,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":380897,"user_name":"🍊 橘子海","can_delete":false,"product_type":"c1","uid":3691546,"ip_address":"浙江","ucode":"DB63DCE8D40C75","user_header":"https://static001.geekbang.org/account/avatar/00/38/54/1a/578d1d02.jpg","comment_is_top":false,"comment_ctime":1694421910,"is_pvip":false,"replies":[{"id":138757,"content":"对的，不要上来就分库分表","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1694565573,"ip_address":"广东","comment_id":380897,"utype":1}],"discussion_count":1,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"技术的采用也是有业务场景背景决定的，分库分表是一种手段，但不一定就适合当下的业务场景使用，所以大家还是要做分析，要不上分库分表，上了之后的技术成本和技术收益的对比，以及备选方案的提供，这个在前面的课程都提到过","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":627793,"discussion_content":"对的，不要上来就分库分表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1694565573,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":364307,"user_name":"波","can_delete":false,"product_type":"c1","uid":1232621,"ip_address":"广东","ucode":"8B4865F2C53790","user_header":"https://static001.geekbang.org/account/avatar/00/12/ce/ed/04ce3d70.jpg","comment_is_top":false,"comment_ctime":1670808069,"is_pvip":false,"replies":[{"id":132469,"content":"MySQL DBA都不准我们用分区 ：）","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1670933131,"ip_address":"广东","comment_id":364307,"utype":1}],"discussion_count":2,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"单表过大，除了分表外，mysql中还可以使用分区。\n请问一下，你怎么看分表和分区的优缺点？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":596389,"discussion_content":"MySQL DBA都不准我们用分区 ：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1670933131,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1232621,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ce/ed/04ce3d70.jpg","nickname":"波","note":"","ucode":"8B4865F2C53790","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":596902,"discussion_content":"为什么不让用分区？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1671250136,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":596389,"ip_address":"江苏","group_id":0},"score":596902,"extra":""}]}]},{"had_liked":false,"id":316191,"user_name":"Walter","can_delete":false,"product_type":"c1","uid":1142493,"ip_address":"","ucode":"2AE436899510D0","user_header":"https://static001.geekbang.org/account/avatar/00/11/6e/dd/9f6f3305.jpg","comment_is_top":false,"comment_ctime":1634195822,"is_pvip":false,"replies":[{"id":114562,"content":"本来4个表，改为5个表，是不是数据的分布要变了？","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1634260860,"ip_address":"","comment_id":316191,"utype":1}],"discussion_count":1,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"采用hash路由算法里面---&quot;增加子表数量是非常麻烦的，所有数据都要重分布&quot;老师这句话怎么理解?","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528303,"discussion_content":"本来4个表，改为5个表，是不是数据的分布要变了？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634260860,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":311876,"user_name":"Drake敏","can_delete":false,"product_type":"c1","uid":2734734,"ip_address":"","ucode":"38366767EFDC90","user_header":"https://static001.geekbang.org/account/avatar/00/29/ba/8e/4645afae.jpg","comment_is_top":false,"comment_ctime":1631519674,"is_pvip":false,"replies":[{"id":113130,"content":"除非你用Oracle，如果是MySQL的话，大部分企业用1主多从都不够的 ：）","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1631698128,"ip_address":"","comment_id":311876,"utype":1}],"discussion_count":1,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"还是要在合理时候去分库分表，个人感觉大企业才会用到分库分表...一般企业做1主多从应该是没问题了","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526781,"discussion_content":"除非你用Oracle，如果是MySQL的话，大部分企业用1主多从都不够的 ：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631698128,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":305159,"user_name":"oops","can_delete":false,"product_type":"c1","uid":1102831,"ip_address":"","ucode":"1DEC23A503F8A3","user_header":"https://static001.geekbang.org/account/avatar/00/10/d3/ef/9c5e695b.jpg","comment_is_top":false,"comment_ctime":1627865883,"is_pvip":false,"replies":[{"id":110471,"content":"正解","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1627982998,"ip_address":"","comment_id":305159,"utype":1}],"discussion_count":1,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"单表数据量太大，在常规索引优化等手段都实施后，考虑分表，提升表操作效率\n业务上划分，按业务领域分库，数据库实例到瓶颈","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524301,"discussion_content":"正解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627982998,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":297913,"user_name":"小鬼爱风雪","can_delete":false,"product_type":"c1","uid":2646199,"ip_address":"","ucode":"FF72E39E557C6F","user_header":"https://static001.geekbang.org/account/avatar/00/28/60/b7/4a665c73.jpg","comment_is_top":false,"comment_ctime":1623840990,"is_pvip":false,"replies":[{"id":108175,"content":"如果直接将数据从MySQL换到其它存储系统，这个复杂度会很高","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1623897425,"ip_address":"","comment_id":297913,"utype":1}],"discussion_count":1,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"只有业务需求到了，才会去考虑分库分表，这样就会带来数据读写的复杂度，有的可以通过数据库优化实现，但大部分是要通过代码强耦合实现。所以，大数据的，就应该引入大数据的分布式文件系统，结合他的思想来实现。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521964,"discussion_content":"如果直接将数据从MySQL换到其它存储系统，这个复杂度会很高","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623897425,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":279862,"user_name":"菜心1986","can_delete":false,"product_type":"c1","uid":1716058,"ip_address":"","ucode":"E46C26FCBD1741","user_header":"https://static001.geekbang.org/account/avatar/00/1a/2f/5a/4ed3465d.jpg","comment_is_top":false,"comment_ctime":1613986179,"is_pvip":false,"replies":[{"id":101685,"content":"如果你的分库策略不正确，会出现某些服务器上数据特别多，需要重新设计分表策略，例如换一个列来做分表","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1614001863,"ip_address":"","comment_id":279862,"utype":1}],"discussion_count":1,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"请问分库分表后，是否还会存在，因为数据量大而导致的查询效率低的问题？如果有有办法解决么？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515898,"discussion_content":"如果你的分库策略不正确，会出现某些服务器上数据特别多，需要重新设计分表策略，例如换一个列来做分表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614001863,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":278535,"user_name":"Geek_57281e","can_delete":false,"product_type":"c1","uid":2102922,"ip_address":"","ucode":"C2BF4C6780E4D3","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/QtSJo6NntUDXe45TLYaTic6GLURTLic8Bp2qWibv6EIv2eJSI8YV79tYebcXVibxiczeeAVRkibLmDM6b9DkJkg7o1Ig/132","comment_is_top":false,"comment_ctime":1613028752,"is_pvip":false,"replies":[{"id":101366,"content":"GUID本身就是随机的，可以直接取前面2位来作为分表键，然后按照顺序来路由即可，这样看起来是顺序路由，其实效果和hash路由一样。","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1613483051,"ip_address":"","comment_id":278535,"utype":1}],"discussion_count":1,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"老师，你好，请问如果表的主键字段类型是GUID的，水平分表时应该采用哪种路由方式比较适合呢？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515898,"discussion_content":"如果你的分库策略不正确，会出现某些服务器上数据特别多，需要重新设计分表策略，例如换一个列来做分表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614001863,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":382736,"user_name":"任锋","can_delete":false,"product_type":"c1","uid":1086592,"ip_address":"四川","ucode":"8C32C85A61C426","user_header":"https://static001.geekbang.org/account/avatar/00/10/94/80/70e483f6.jpg","comment_is_top":false,"comment_ctime":1697936592,"is_pvip":false,"replies":[{"id":139396,"content":"可以放es，但是更好的方式是放大数据平台做汇总，例如放到clickhouse这种，es毕竟是一个倒排索引的系统，用于搜索更合适","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1698061702,"ip_address":"广东","comment_id":382736,"utype":1}],"discussion_count":1,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"老师。你好，我面试遇到你说的分表之后关于统计的问题，比如我说订单表可以分表。\n面试官问我分表之后如何统计出那个用户购买最多，我当时就是回答所有子表排序取得的数据 再次重排。\n我现在有更好的方案 就是把订单数据放到es里面，通过es来进行排序查询 可以吗？我记得es也是海量存储对吧？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":630050,"discussion_content":"可以放es，但是更好的方式是放大数据平台做汇总，例如放到clickhouse这种，es毕竟是一个倒排索引的系统，用于搜索更合适","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1698061702,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":382572,"user_name":"陈峰","can_delete":false,"product_type":"c1","uid":3721548,"ip_address":"江苏","ucode":"11F92938308C6C","user_header":"","comment_is_top":false,"comment_ctime":1697599862,"is_pvip":false,"replies":[{"id":139478,"content":"记录数表只能放在一个库的一个表中，但是原始数据分布在多个数据库实例多台机器上","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1698197786,"ip_address":"广东","comment_id":382572,"utype":1}],"discussion_count":1,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"且针对“记录数表”的操作和针对子表的操作无法放在同一事务中进行处理\n\n老师，这里为什么不能放在一个事务进行处理呢，因为分库了，还是说其他原因？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":630050,"discussion_content":"可以放es，但是更好的方式是放大数据平台做汇总，例如放到clickhouse这种，es毕竟是一个倒排索引的系统，用于搜索更合适","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1698061702,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":380897,"user_name":"🍊 橘子海","can_delete":false,"product_type":"c1","uid":3691546,"ip_address":"浙江","ucode":"DB63DCE8D40C75","user_header":"https://static001.geekbang.org/account/avatar/00/38/54/1a/578d1d02.jpg","comment_is_top":false,"comment_ctime":1694421910,"is_pvip":false,"replies":[{"id":138757,"content":"对的，不要上来就分库分表","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1694565573,"ip_address":"广东","comment_id":380897,"utype":1}],"discussion_count":1,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"技术的采用也是有业务场景背景决定的，分库分表是一种手段，但不一定就适合当下的业务场景使用，所以大家还是要做分析，要不上分库分表，上了之后的技术成本和技术收益的对比，以及备选方案的提供，这个在前面的课程都提到过","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":630232,"discussion_content":"记录数表只能放在一个库的一个表中，但是原始数据分布在多个数据库实例多台机器上","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1698197786,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":364307,"user_name":"波","can_delete":false,"product_type":"c1","uid":1232621,"ip_address":"广东","ucode":"8B4865F2C53790","user_header":"https://static001.geekbang.org/account/avatar/00/12/ce/ed/04ce3d70.jpg","comment_is_top":false,"comment_ctime":1670808069,"is_pvip":false,"replies":[{"id":132469,"content":"MySQL DBA都不准我们用分区 ：）","user_name":"作者回复","user_name_real":"编辑","uid":1098920,"ctime":1670933131,"ip_address":"广东","comment_id":364307,"utype":1}],"discussion_count":2,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"单表过大，除了分表外，mysql中还可以使用分区。\n请问一下，你怎么看分表和分区的优缺点？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":627793,"discussion_content":"对的，不要上来就分库分表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1694565573,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":316191,"user_name":"Walter","can_delete":false,"product_type":"c1","uid":1142493,"ip_address":"","ucode":"2AE436899510D0","user_header":"https://static001.geekbang.org/account/avatar/00/11/6e/dd/9f6f3305.jpg","comment_is_top":false,"comment_ctime":1634195822,"is_pvip":false,"replies":[{"id":114562,"content":"本来4个表，改为5个表，是不是数据的分布要变了？","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1634260860,"ip_address":"","comment_id":316191,"utype":1}],"discussion_count":1,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"采用hash路由算法里面---&quot;增加子表数量是非常麻烦的，所有数据都要重分布&quot;老师这句话怎么理解?","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":596389,"discussion_content":"MySQL DBA都不准我们用分区 ：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1670933131,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1232621,"avatar":"https://static001.geekbang.org/account/avatar/00/12/ce/ed/04ce3d70.jpg","nickname":"波","note":"","ucode":"8B4865F2C53790","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":596902,"discussion_content":"为什么不让用分区？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1671250136,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":596389,"ip_address":"江苏","group_id":0},"score":596902,"extra":""}]}]},{"had_liked":false,"id":311876,"user_name":"Drake敏","can_delete":false,"product_type":"c1","uid":2734734,"ip_address":"","ucode":"38366767EFDC90","user_header":"https://static001.geekbang.org/account/avatar/00/29/ba/8e/4645afae.jpg","comment_is_top":false,"comment_ctime":1631519674,"is_pvip":false,"replies":[{"id":113130,"content":"除非你用Oracle，如果是MySQL的话，大部分企业用1主多从都不够的 ：）","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1631698128,"ip_address":"","comment_id":311876,"utype":1}],"discussion_count":1,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"还是要在合理时候去分库分表，个人感觉大企业才会用到分库分表...一般企业做1主多从应该是没问题了","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":528303,"discussion_content":"本来4个表，改为5个表，是不是数据的分布要变了？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634260860,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":305159,"user_name":"oops","can_delete":false,"product_type":"c1","uid":1102831,"ip_address":"","ucode":"1DEC23A503F8A3","user_header":"https://static001.geekbang.org/account/avatar/00/10/d3/ef/9c5e695b.jpg","comment_is_top":false,"comment_ctime":1627865883,"is_pvip":false,"replies":[{"id":110471,"content":"正解","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1627982998,"ip_address":"","comment_id":305159,"utype":1}],"discussion_count":1,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"单表数据量太大，在常规索引优化等手段都实施后，考虑分表，提升表操作效率\n业务上划分，按业务领域分库，数据库实例到瓶颈","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":526781,"discussion_content":"除非你用Oracle，如果是MySQL的话，大部分企业用1主多从都不够的 ：）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631698128,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":297913,"user_name":"小鬼爱风雪","can_delete":false,"product_type":"c1","uid":2646199,"ip_address":"","ucode":"FF72E39E557C6F","user_header":"https://static001.geekbang.org/account/avatar/00/28/60/b7/4a665c73.jpg","comment_is_top":false,"comment_ctime":1623840990,"is_pvip":false,"replies":[{"id":108175,"content":"如果直接将数据从MySQL换到其它存储系统，这个复杂度会很高","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1623897425,"ip_address":"","comment_id":297913,"utype":1}],"discussion_count":1,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"只有业务需求到了，才会去考虑分库分表，这样就会带来数据读写的复杂度，有的可以通过数据库优化实现，但大部分是要通过代码强耦合实现。所以，大数据的，就应该引入大数据的分布式文件系统，结合他的思想来实现。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524301,"discussion_content":"正解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627982998,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":279862,"user_name":"菜心1986","can_delete":false,"product_type":"c1","uid":1716058,"ip_address":"","ucode":"E46C26FCBD1741","user_header":"https://static001.geekbang.org/account/avatar/00/1a/2f/5a/4ed3465d.jpg","comment_is_top":false,"comment_ctime":1613986179,"is_pvip":false,"replies":[{"id":101685,"content":"如果你的分库策略不正确，会出现某些服务器上数据特别多，需要重新设计分表策略，例如换一个列来做分表","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1614001863,"ip_address":"","comment_id":279862,"utype":1}],"discussion_count":1,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"请问分库分表后，是否还会存在，因为数据量大而导致的查询效率低的问题？如果有有办法解决么？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521964,"discussion_content":"如果直接将数据从MySQL换到其它存储系统，这个复杂度会很高","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623897425,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":278535,"user_name":"Geek_57281e","can_delete":false,"product_type":"c1","uid":2102922,"ip_address":"","ucode":"C2BF4C6780E4D3","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/QtSJo6NntUDXe45TLYaTic6GLURTLic8Bp2qWibv6EIv2eJSI8YV79tYebcXVibxiczeeAVRkibLmDM6b9DkJkg7o1Ig/132","comment_is_top":false,"comment_ctime":1613028752,"is_pvip":false,"replies":[{"id":101366,"content":"GUID本身就是随机的，可以直接取前面2位来作为分表键，然后按照顺序来路由即可，这样看起来是顺序路由，其实效果和hash路由一样。","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1613483051,"ip_address":"","comment_id":278535,"utype":1}],"discussion_count":1,"race_medal":0,"score":8,"product_id":100006601,"comment_content":"老师，你好，请问如果表的主键字段类型是GUID的，水平分表时应该采用哪种路由方式比较适合呢？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515416,"discussion_content":"GUID本身就是随机的，可以直接取前面2位来作为分表键，然后按照顺序来路由即可，这样看起来是顺序路由，其实效果和hash路由一样。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613483051,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":229293,"user_name":"Cha","can_delete":false,"product_type":"c1","uid":1080389,"ip_address":"","ucode":"BE28533F67F0F5","user_header":"https://static001.geekbang.org/account/avatar/00/10/7c/45/416fe519.jpg","comment_is_top":false,"comment_ctime":1592960225,"is_pvip":false,"replies":[{"id":85272,"content":"这个我还真不知道","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1593516199,"ip_address":"","comment_id":229293,"utype":1}],"discussion_count":2,"race_medal":0,"score":9,"product_id":100006601,"comment_content":"老师，有个问题没想明白，就是分表的个数，我看有的说要2的N次方，这个是有什么原因么","like_count":0},{"had_liked":false,"id":157168,"user_name":"煌","can_delete":false,"product_type":"c1","uid":1439950,"ip_address":"","ucode":"49F1728E8C8D5F","user_header":"https://static001.geekbang.org/account/avatar/00/15/f8/ce/a180d2cd.jpg","comment_is_top":false,"comment_ctime":1575056080,"is_pvip":false,"replies":[{"id":63225,"content":"可以试试","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1577328800,"ip_address":"","comment_id":157168,"utype":1}],"discussion_count":1,"race_medal":0,"score":9,"product_id":100006601,"comment_content":"Mycat 是不是一个好的方案呢","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476347,"discussion_content":"可以试试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577328800,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":149934,"user_name":"小菜鸟学php","can_delete":false,"product_type":"c1","uid":1683755,"ip_address":"","ucode":"C417C76E18B062","user_header":"https://static001.geekbang.org/account/avatar/00/19/b1/2b/9406d19a.jpg","comment_is_top":false,"comment_ctime":1573434023,"is_pvip":false,"replies":[{"id":57774,"content":"再仔细琢磨一下架构设计三原则","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1573474503,"ip_address":"","comment_id":149934,"utype":1}],"discussion_count":1,"race_medal":0,"score":9,"product_id":100006601,"comment_content":"老师，我想问一下，在代码开始编写阶段是否就要考虑加入中间件。我想虽然现在用处不大，但是考虑到后期业务量大了再扩展就麻烦了，而且加一个中间件费的功夫其实也不太大。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474018,"discussion_content":"再仔细琢磨一下架构设计三原则","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573474503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138189,"user_name":"建强","can_delete":false,"product_type":"c1","uid":1397126,"ip_address":"","ucode":"62B03D0E0C64EC","user_header":"https://static001.geekbang.org/account/avatar/00/15/51/86/b5fd8dd8.jpg","comment_is_top":false,"comment_ctime":1570088521,"is_pvip":false,"replies":[{"id":53302,"content":"轻微下降的时候先优化或者用缓存，读写分离都可以，不要上来就用分库分表","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1570326178,"ip_address":"","comment_id":138189,"utype":1}],"discussion_count":1,"race_medal":0,"score":9,"product_id":100006601,"comment_content":"1.当数据库的数据量达到某一量级，性能较之前开始有轻微下降时就应该考虑分库分表。\n2.当数据库的数据量在持续增长，性能开始出现明显下降时应该考虑分库分表。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469429,"discussion_content":"轻微下降的时候先优化或者用缓存，读写分离都可以，不要上来就用分库分表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570326178,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":137356,"user_name":"jc9090kkk","can_delete":false,"product_type":"c1","uid":1338831,"ip_address":"","ucode":"6C992D07A2E78F","user_header":"https://static001.geekbang.org/account/avatar/00/14/6d/cf/ec335526.jpg","comment_is_top":false,"comment_ctime":1569723346,"is_pvip":false,"replies":[{"id":52921,"content":"映射表不要放到数据库，可以放配置文件，也可以通过算法来计算","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1569828489,"ip_address":"","comment_id":137356,"utype":1}],"discussion_count":1,"race_medal":0,"score":9,"product_id":100006601,"comment_content":"感谢老师分享，对于范围分表有个疑问，比如我的表是用户数据分表，那么分表后，每个单表的数据是分散了，但是查询怎么查？一般用户都是账号+密码的方式来做登录查询判断的，范围分表后怎么知道我当前操作的登录用户是属于哪张表呢？不还是需要引入一张中间表来存储用户的分表id，然后通过查询用户账号密码来确认一个表吗？这根配置路由的方式不是一样的吗？还是存在单点问题啊，老师能否解答下这样的情况如何处理？还是说我理解的有问题？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469047,"discussion_content":"映射表不要放到数据库，可以放配置文件，也可以通过算法来计算","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569828489,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136439,"user_name":"舰长的水手","can_delete":false,"product_type":"c1","uid":1111568,"ip_address":"","ucode":"2D7C177D13E2EB","user_header":"https://static001.geekbang.org/account/avatar/00/10/f6/10/f179db4a.jpg","comment_is_top":false,"comment_ctime":1569438264,"is_pvip":false,"replies":[{"id":52375,"content":"你怎么判断是读事务还是写事务呢？","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1569489675,"ip_address":"","comment_id":136439,"utype":1}],"discussion_count":1,"race_medal":0,"score":9,"product_id":100006601,"comment_content":"根据 SQL 是update 还是 select 来读写分离我认为不是什么好方案，前一刻查 从库后一刻写主库，这很危险 ，要是主从同步有点延迟就麻烦了，我写的读写分离只关心事务是读事务还是写事务，不关心具体sql.","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468634,"discussion_content":"你怎么判断是读事务还是写事务呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569489675,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":88311,"user_name":"探索无止境","can_delete":false,"product_type":"c1","uid":1044178,"ip_address":"","ucode":"91D2A9907DFA79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ee/d2/7024431c.jpg","comment_is_top":false,"comment_ctime":1555903477,"is_pvip":false,"replies":[{"id":33321,"content":"举例说明，这个是经验数据","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1557459676,"ip_address":"","comment_id":88311,"utype":1}],"discussion_count":1,"race_medal":0,"score":9,"product_id":100006601,"comment_content":"在文中有两段描述\n描述一：\n一般来说，单台数据库服务器能够支撑 10 万用户量量级的业务\n描述二：\n将不同业务数据分散存储到不同的数据库服务器，能够支撑百万甚至上千万\n\n为什么前后总结的数量级是不同的，为何会得到不同的结论？是否可以提供一个从推断得到结论的过程？还是说只是一个举例，其实给一个实际场景的推断过程，会更有指导意义一些。期待老师的解答","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447784,"discussion_content":"举例说明，这个是经验数据","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557459676,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68069,"user_name":"miracle","can_delete":false,"product_type":"c1","uid":1276137,"ip_address":"","ucode":"FD7074F1062AE9","user_header":"https://static001.geekbang.org/account/avatar/00/13/78/e9/9d807269.jpg","comment_is_top":false,"comment_ctime":1550404655,"is_pvip":false,"replies":[{"id":25380,"content":"跨数据库实例了，这里的事务指传统关系型数据库事务，如果用分布式事务是可以的","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1551227520,"ip_address":"","comment_id":68069,"utype":1}],"discussion_count":1,"race_medal":0,"score":9,"product_id":100006601,"comment_content":"记录数表有一段描述: 且针对“记录数表”的操作和针对子表的操作无法放在同一事务中进行处理.      想请教下华仔，为什么不能放在同一个事务中？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447784,"discussion_content":"举例说明，这个是经验数据","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1557459676,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63864,"user_name":"NierDaye","can_delete":false,"product_type":"c1","uid":1393961,"ip_address":"","ucode":"BC2E5739529CCE","user_header":"https://static001.geekbang.org/account/avatar/00/15/45/29/2478f7d0.jpg","comment_is_top":false,"comment_ctime":1548563871,"is_pvip":false,"replies":[{"id":22789,"content":"微服务也会用分库分表呢","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1548756820,"ip_address":"","comment_id":63864,"utype":1}],"discussion_count":1,"race_medal":0,"score":9,"product_id":100006601,"comment_content":"时下流行的微服务的玩法，提倡各个服务足够独立，有独立的存储。\n这是否可以看做是对分库的一种点赞？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437738,"discussion_content":"微服务也会用分库分表呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548756820,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47260,"user_name":"Geek_xk61fo","can_delete":false,"product_type":"c1","uid":1325715,"ip_address":"","ucode":"BDA98B670E70D7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJqrJ5oUKagOjUG2JsfuX8lSI9pEOgMrXNa06xppsIO7aFNgic8ia7ET5I7GXSIqCW5R0sXLOzFYRYg/132","comment_is_top":false,"comment_ctime":1544091043,"is_pvip":false,"replies":[{"id":16901,"content":"看看redis的数据结构是否符合你的要求","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1544133060,"ip_address":"","comment_id":47260,"utype":1}],"discussion_count":1,"race_medal":0,"score":9,"product_id":100006601,"comment_content":"问个问题，现在做大数据展示，scala计算以后直接把数据导入到hive中了，页面每次查询时间会在10多秒，sql已经优化了，现在还是需要5到6秒，如果考虑加缓存的话，该如何加？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":431716,"discussion_content":"看看redis的数据结构是否符合你的要求","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544133060,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":229293,"user_name":"Cha","can_delete":false,"product_type":"c1","uid":1080389,"ip_address":"","ucode":"BE28533F67F0F5","user_header":"https://static001.geekbang.org/account/avatar/00/10/7c/45/416fe519.jpg","comment_is_top":false,"comment_ctime":1592960225,"is_pvip":false,"replies":[{"id":85272,"content":"这个我还真不知道","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1593516199,"ip_address":"","comment_id":229293,"utype":1}],"discussion_count":2,"race_medal":0,"score":9,"product_id":100006601,"comment_content":"老师，有个问题没想明白，就是分表的个数，我看有的说要2的N次方，这个是有什么原因么","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499426,"discussion_content":"这个我还真不知道","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593516199,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2348234,"avatar":"","nickname":"Geek_b15dc0","note":"","ucode":"7DEF9A3A1F77D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333042,"discussion_content":"知乎上看到的，目的是为了扩容的时候避免一些历史数据迁移。例如有2个库的时候，分库的取模方式 用(id%4)/2，扩容的时候不是增加一个库，而是增加2个库。这样 重新取模的时候用 id%4，因为 对4，对2取模结果是一样的，因此历史数据不用迁移。 但是这个方案只能维持到一个分库范围内，大于4的时候就要迁移历史数据了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607420580,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":157168,"user_name":"煌","can_delete":false,"product_type":"c1","uid":1439950,"ip_address":"","ucode":"49F1728E8C8D5F","user_header":"https://static001.geekbang.org/account/avatar/00/15/f8/ce/a180d2cd.jpg","comment_is_top":false,"comment_ctime":1575056080,"is_pvip":false,"replies":[{"id":63225,"content":"可以试试","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1577328800,"ip_address":"","comment_id":157168,"utype":1}],"discussion_count":1,"race_medal":0,"score":9,"product_id":100006601,"comment_content":"Mycat 是不是一个好的方案呢","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499426,"discussion_content":"这个我还真不知道","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593516199,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2348234,"avatar":"","nickname":"Geek_b15dc0","note":"","ucode":"7DEF9A3A1F77D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333042,"discussion_content":"知乎上看到的，目的是为了扩容的时候避免一些历史数据迁移。例如有2个库的时候，分库的取模方式 用(id%4)/2，扩容的时候不是增加一个库，而是增加2个库。这样 重新取模的时候用 id%4，因为 对4，对2取模结果是一样的，因此历史数据不用迁移。 但是这个方案只能维持到一个分库范围内，大于4的时候就要迁移历史数据了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607420580,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":149934,"user_name":"小菜鸟学php","can_delete":false,"product_type":"c1","uid":1683755,"ip_address":"","ucode":"C417C76E18B062","user_header":"https://static001.geekbang.org/account/avatar/00/19/b1/2b/9406d19a.jpg","comment_is_top":false,"comment_ctime":1573434023,"is_pvip":false,"replies":[{"id":57774,"content":"再仔细琢磨一下架构设计三原则","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1573474503,"ip_address":"","comment_id":149934,"utype":1}],"discussion_count":1,"race_medal":0,"score":9,"product_id":100006601,"comment_content":"老师，我想问一下，在代码开始编写阶段是否就要考虑加入中间件。我想虽然现在用处不大，但是考虑到后期业务量大了再扩展就麻烦了，而且加一个中间件费的功夫其实也不太大。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":476347,"discussion_content":"可以试试","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577328800,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138189,"user_name":"建强","can_delete":false,"product_type":"c1","uid":1397126,"ip_address":"","ucode":"62B03D0E0C64EC","user_header":"https://static001.geekbang.org/account/avatar/00/15/51/86/b5fd8dd8.jpg","comment_is_top":false,"comment_ctime":1570088521,"is_pvip":false,"replies":[{"id":53302,"content":"轻微下降的时候先优化或者用缓存，读写分离都可以，不要上来就用分库分表","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1570326178,"ip_address":"","comment_id":138189,"utype":1}],"discussion_count":1,"race_medal":0,"score":9,"product_id":100006601,"comment_content":"1.当数据库的数据量达到某一量级，性能较之前开始有轻微下降时就应该考虑分库分表。\n2.当数据库的数据量在持续增长，性能开始出现明显下降时应该考虑分库分表。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474018,"discussion_content":"再仔细琢磨一下架构设计三原则","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573474503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":137356,"user_name":"jc9090kkk","can_delete":false,"product_type":"c1","uid":1338831,"ip_address":"","ucode":"6C992D07A2E78F","user_header":"https://static001.geekbang.org/account/avatar/00/14/6d/cf/ec335526.jpg","comment_is_top":false,"comment_ctime":1569723346,"is_pvip":false,"replies":[{"id":52921,"content":"映射表不要放到数据库，可以放配置文件，也可以通过算法来计算","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1569828489,"ip_address":"","comment_id":137356,"utype":1}],"discussion_count":1,"race_medal":0,"score":9,"product_id":100006601,"comment_content":"感谢老师分享，对于范围分表有个疑问，比如我的表是用户数据分表，那么分表后，每个单表的数据是分散了，但是查询怎么查？一般用户都是账号+密码的方式来做登录查询判断的，范围分表后怎么知道我当前操作的登录用户是属于哪张表呢？不还是需要引入一张中间表来存储用户的分表id，然后通过查询用户账号密码来确认一个表吗？这根配置路由的方式不是一样的吗？还是存在单点问题啊，老师能否解答下这样的情况如何处理？还是说我理解的有问题？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469429,"discussion_content":"轻微下降的时候先优化或者用缓存，读写分离都可以，不要上来就用分库分表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570326178,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136439,"user_name":"舰长的水手","can_delete":false,"product_type":"c1","uid":1111568,"ip_address":"","ucode":"2D7C177D13E2EB","user_header":"https://static001.geekbang.org/account/avatar/00/10/f6/10/f179db4a.jpg","comment_is_top":false,"comment_ctime":1569438264,"is_pvip":false,"replies":[{"id":52375,"content":"你怎么判断是读事务还是写事务呢？","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1569489675,"ip_address":"","comment_id":136439,"utype":1}],"discussion_count":1,"race_medal":0,"score":9,"product_id":100006601,"comment_content":"根据 SQL 是update 还是 select 来读写分离我认为不是什么好方案，前一刻查 从库后一刻写主库，这很危险 ，要是主从同步有点延迟就麻烦了，我写的读写分离只关心事务是读事务还是写事务，不关心具体sql.","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469047,"discussion_content":"映射表不要放到数据库，可以放配置文件，也可以通过算法来计算","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569828489,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":88311,"user_name":"探索无止境","can_delete":false,"product_type":"c1","uid":1044178,"ip_address":"","ucode":"91D2A9907DFA79","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ee/d2/7024431c.jpg","comment_is_top":false,"comment_ctime":1555903477,"is_pvip":false,"replies":[{"id":33321,"content":"举例说明，这个是经验数据","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1557459676,"ip_address":"","comment_id":88311,"utype":1}],"discussion_count":1,"race_medal":0,"score":9,"product_id":100006601,"comment_content":"在文中有两段描述\n描述一：\n一般来说，单台数据库服务器能够支撑 10 万用户量量级的业务\n描述二：\n将不同业务数据分散存储到不同的数据库服务器，能够支撑百万甚至上千万\n\n为什么前后总结的数量级是不同的，为何会得到不同的结论？是否可以提供一个从推断得到结论的过程？还是说只是一个举例，其实给一个实际场景的推断过程，会更有指导意义一些。期待老师的解答","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468634,"discussion_content":"你怎么判断是读事务还是写事务呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569489675,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68069,"user_name":"miracle","can_delete":false,"product_type":"c1","uid":1276137,"ip_address":"","ucode":"FD7074F1062AE9","user_header":"https://static001.geekbang.org/account/avatar/00/13/78/e9/9d807269.jpg","comment_is_top":false,"comment_ctime":1550404655,"is_pvip":false,"replies":[{"id":25380,"content":"跨数据库实例了，这里的事务指传统关系型数据库事务，如果用分布式事务是可以的","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1551227520,"ip_address":"","comment_id":68069,"utype":1}],"discussion_count":1,"race_medal":0,"score":9,"product_id":100006601,"comment_content":"记录数表有一段描述: 且针对“记录数表”的操作和针对子表的操作无法放在同一事务中进行处理.      想请教下华仔，为什么不能放在同一个事务中？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439498,"discussion_content":"跨数据库实例了，这里的事务指传统关系型数据库事务，如果用分布式事务是可以的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551227520,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63864,"user_name":"NierDaye","can_delete":false,"product_type":"c1","uid":1393961,"ip_address":"","ucode":"BC2E5739529CCE","user_header":"https://static001.geekbang.org/account/avatar/00/15/45/29/2478f7d0.jpg","comment_is_top":false,"comment_ctime":1548563871,"is_pvip":false,"replies":[{"id":22789,"content":"微服务也会用分库分表呢","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1548756820,"ip_address":"","comment_id":63864,"utype":1}],"discussion_count":1,"race_medal":0,"score":9,"product_id":100006601,"comment_content":"时下流行的微服务的玩法，提倡各个服务足够独立，有独立的存储。\n这是否可以看做是对分库的一种点赞？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439498,"discussion_content":"跨数据库实例了，这里的事务指传统关系型数据库事务，如果用分布式事务是可以的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551227520,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":47260,"user_name":"Geek_xk61fo","can_delete":false,"product_type":"c1","uid":1325715,"ip_address":"","ucode":"BDA98B670E70D7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJqrJ5oUKagOjUG2JsfuX8lSI9pEOgMrXNa06xppsIO7aFNgic8ia7ET5I7GXSIqCW5R0sXLOzFYRYg/132","comment_is_top":false,"comment_ctime":1544091043,"is_pvip":false,"replies":[{"id":16901,"content":"看看redis的数据结构是否符合你的要求","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1544133060,"ip_address":"","comment_id":47260,"utype":1}],"discussion_count":1,"race_medal":0,"score":9,"product_id":100006601,"comment_content":"问个问题，现在做大数据展示，scala计算以后直接把数据导入到hive中了，页面每次查询时间会在10多秒，sql已经优化了，现在还是需要5到6秒，如果考虑加缓存的话，该如何加？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437738,"discussion_content":"微服务也会用分库分表呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1548756820,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44014,"user_name":"贾洵","can_delete":false,"product_type":"c1","uid":1173596,"ip_address":"","ucode":"6B66BC83615A26","user_header":"https://static001.geekbang.org/account/avatar/00/11/e8/5c/fad21603.jpg","comment_is_top":false,"comment_ctime":1543365071,"is_pvip":false,"replies":[{"id":16114,"content":"程序代码来做，或者数据库中间件做","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1543621698,"ip_address":"","comment_id":44014,"utype":1}],"discussion_count":1,"race_medal":0,"score":10,"product_id":100006601,"comment_content":"纵向分表可将用户名和密码等少数字段存放用户表用于系统登录；其他字段存放用户扩展表用于基本信息维护等场景\n横向分表可将数据按区间端区分，按列hash区分，维护中间关系表等方式区分\n对于分表带来的问题，count求和可以使用逐表求和，维护表和count关联表，以及二者结合而成的预计算\n问题是如果分表后的order怎么处理呢？","like_count":0},{"had_liked":false,"id":36701,"user_name":"PhilZhang","can_delete":false,"product_type":"c1","uid":1088010,"ip_address":"","ucode":"383F1A792C7DF9","user_header":"https://static001.geekbang.org/account/avatar/00/10/9a/0a/922615cf.jpg","comment_is_top":false,"comment_ctime":1541249256,"is_pvip":false,"replies":[{"id":13142,"content":"不用微服务也可以用分库的，例如单纯做负载均衡","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1541398969,"ip_address":"","comment_id":36701,"utype":1}],"discussion_count":1,"race_medal":0,"score":10,"product_id":100006601,"comment_content":"现在微服务大行其道，分库是必然的了吧","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430595,"discussion_content":"程序代码来做，或者数据库中间件做","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543621698,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":16131,"user_name":"不吃番茄的西红柿","can_delete":false,"product_type":"c1","uid":1142465,"ip_address":"","ucode":"AC62CE8D23FACD","user_header":"https://static001.geekbang.org/account/avatar/00/11/6e/c1/e2cc1261.jpg","comment_is_top":false,"comment_ctime":1531793296,"is_pvip":false,"replies":[{"id":5589,"content":"数据冗余，多个不同纬度的订单表","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1531810772,"ip_address":"","comment_id":16131,"utype":1}],"discussion_count":1,"race_medal":0,"score":10,"product_id":100006601,"comment_content":"咳咳，华仔，我再问一下，如果就算用用户id来进行分表，当后台需要统计整体的比如一个商户的后台订单情况，这时候可能该平台拥有的用户订单数据来自多个表？这时候怎么统一去查询这块数据呢？或者优化查询？ ","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427976,"discussion_content":"不用微服务也可以用分库的，例如单纯做负载均衡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541398969,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":14759,"user_name":"冰糕不冰","can_delete":false,"product_type":"c1","uid":1134761,"ip_address":"","ucode":"B754FE464BA426","user_header":"https://static001.geekbang.org/account/avatar/00/11/50/a9/3f8c7418.jpg","comment_is_top":false,"comment_ctime":1530636635,"is_pvip":false,"replies":[{"id":4971,"content":"最好通过接口处理数据，否则代码拆分数据不拆分，会导致非常多的问题","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1530662599,"ip_address":"","comment_id":14759,"utype":1}],"discussion_count":1,"race_medal":0,"score":10,"product_id":100006601,"comment_content":"当业务分拆到三四个服务里后，同时又需要同时连接这三张表进行查询。这时只能通过调用不同的接口来处理数据吗？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420681,"discussion_content":"数据冗余，多个不同纬度的订单表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1531810772,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":13901,"user_name":"银太","can_delete":false,"product_type":"c1","uid":1051765,"ip_address":"","ucode":"B505D15F7CB839","user_header":"https://static001.geekbang.org/account/avatar/00/10/0c/75/e7c6c403.jpg","comment_is_top":false,"comment_ctime":1530061892,"is_pvip":false,"replies":[{"id":4695,"content":"定期更新，但要牺牲用户体验","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1530178836,"ip_address":"","comment_id":13901,"utype":1}],"discussion_count":1,"race_medal":0,"score":10,"product_id":100006601,"comment_content":"对于count的情况通常是有条件的，计数作用不大，这种有什么更好的方案吗？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420123,"discussion_content":"最好通过接口处理数据，否则代码拆分数据不拆分，会导致非常多的问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1530662599,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":13012,"user_name":"孙振超","can_delete":false,"product_type":"c1","uid":1101755,"ip_address":"","ucode":"0F9EABC6125350","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/bb/22af0e52.jpg","comment_is_top":false,"comment_ctime":1529298620,"is_pvip":false,"replies":[{"id":4343,"content":"你说的情况其实就是分表，只是最开始的时候所有分表都在一个数据库实例上而已","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1529376806,"ip_address":"","comment_id":13012,"utype":1}],"discussion_count":1,"race_medal":0,"score":10,"product_id":100006601,"comment_content":"引入分库分表的主要考量是数据量和系统容量要求，如果tps要求即将超过了单数据库实例所能承担的上限，或者数据库链接数满足不了上游应用服务器的要求，又或者数据库主从同步延迟超过了大多数业务要求的时间，就需要考虑引入分库分表了。在进行分表的拆分后，如果数据库的链接数或者容量还不满足，需要再次拆库，这里的拆库和文章里面的里面提到的拆库稍有不同，文章中的拆库是按照业务进行分拆，这里提到的拆库是将同一个业务的数据表分拆到多个数据库实例，比如将100张用户表从一个数据库实例分拆到10个数据库实例上，这样总容量可以提升近10倍，并且这样分拆后业务的整体可用性也有所提升，因为之前所有的数据都在一个实例上，如果这个实例出故障，业务就不可用了；分拆到10个实例，即使有一个实例出现了故障，还有90%的业务可用，当然成本也提升了10倍了。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419804,"discussion_content":"定期更新，但要牺牲用户体验","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1530178836,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11994,"user_name":"小飞哥 ‍超級會員","can_delete":false,"product_type":"c1","uid":1110049,"ip_address":"","ucode":"417F9563B3005B","user_header":"https://static001.geekbang.org/account/avatar/00/10/f0/21/104b9565.jpg","comment_is_top":false,"comment_ctime":1528507445,"is_pvip":false,"replies":[{"id":3979,"content":"先组合查后分页","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528617703,"ip_address":"","comment_id":11994,"utype":1}],"discussion_count":1,"race_medal":0,"score":10,"product_id":100006601,"comment_content":"横向拆分后，分页查询会遇到查的结果不是相要的，如。我要查带库存的商品数据，先去查商品然后查库存，查完过滤掉无库存的商品，在组合起来，发现只有几条数据。达不到分页效果！这应该怎么处理？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419074,"discussion_content":"先组合查后分页","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528617703,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11985,"user_name":"王维","can_delete":false,"product_type":"c1","uid":1091684,"ip_address":"","ucode":"836E6CDB1A56BA","user_header":"https://static001.geekbang.org/account/avatar/00/10/a8/64/965e0d9b.jpg","comment_is_top":false,"comment_ctime":1528501645,"is_pvip":false,"replies":[{"id":3981,"content":"没看明白，按道理消息服务框架不是为了解决事务问题的","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528617781,"ip_address":"","comment_id":11985,"utype":1}],"discussion_count":1,"race_medal":0,"score":10,"product_id":100006601,"comment_content":"华仔你好，看了这期文章感觉很受益，感受最深的就是架构的演进要随着业务的发展而发展，是业务成就了技术，而不是技术成就了业务。有个问题想问下，分表分库会带来事务性的问题，那么，如果我在业务层采用消息服务框架，例如NserviceBus，可不可以避免这个分表分库的事务性问题呢？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419070,"discussion_content":"没看明白，按道理消息服务框架不是为了解决事务问题的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528617781,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11458,"user_name":"天下第一帅","can_delete":false,"product_type":"c1","uid":1133958,"ip_address":"","ucode":"188E0212A1C48B","user_header":"https://static001.geekbang.org/account/avatar/00/11/4d/86/62aad981.jpg","comment_is_top":false,"comment_ctime":1528159049,"is_pvip":false,"replies":[{"id":3702,"content":"实战就是要基于理论分析和选择的","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528189008,"ip_address":"","comment_id":11458,"utype":1}],"discussion_count":1,"race_medal":0,"score":10,"product_id":100006601,"comment_content":"期望能看到实战，这些理论都大差不差","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418851,"discussion_content":"实战就是要基于理论分析和选择的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528189008,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11302,"user_name":"卡卢比","can_delete":false,"product_type":"c1","uid":1102663,"ip_address":"","ucode":"0F962B5BD83C63","user_header":"https://static001.geekbang.org/account/avatar/00/10/d3/47/10727d5f.jpg","comment_is_top":false,"comment_ctime":1528039458,"is_pvip":false,"replies":[{"id":3617,"content":"没有太好的方案，文中提到的基本都是常用的","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528081224,"ip_address":"","comment_id":11302,"utype":1}],"discussion_count":1,"race_medal":0,"score":10,"product_id":100006601,"comment_content":"分库分表的原理和出现的问题网上一大堆文章，但是介绍具体解决方案和方案优缺点的却很少，希望大大能详细些。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418851,"discussion_content":"实战就是要基于理论分析和选择的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528189008,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44014,"user_name":"贾洵","can_delete":false,"product_type":"c1","uid":1173596,"ip_address":"","ucode":"6B66BC83615A26","user_header":"https://static001.geekbang.org/account/avatar/00/11/e8/5c/fad21603.jpg","comment_is_top":false,"comment_ctime":1543365071,"is_pvip":false,"replies":[{"id":16114,"content":"程序代码来做，或者数据库中间件做","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1543621698,"ip_address":"","comment_id":44014,"utype":1}],"discussion_count":1,"race_medal":0,"score":10,"product_id":100006601,"comment_content":"纵向分表可将用户名和密码等少数字段存放用户表用于系统登录；其他字段存放用户扩展表用于基本信息维护等场景\n横向分表可将数据按区间端区分，按列hash区分，维护中间关系表等方式区分\n对于分表带来的问题，count求和可以使用逐表求和，维护表和count关联表，以及二者结合而成的预计算\n问题是如果分表后的order怎么处理呢？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430595,"discussion_content":"程序代码来做，或者数据库中间件做","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543621698,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":36701,"user_name":"PhilZhang","can_delete":false,"product_type":"c1","uid":1088010,"ip_address":"","ucode":"383F1A792C7DF9","user_header":"https://static001.geekbang.org/account/avatar/00/10/9a/0a/922615cf.jpg","comment_is_top":false,"comment_ctime":1541249256,"is_pvip":false,"replies":[{"id":13142,"content":"不用微服务也可以用分库的，例如单纯做负载均衡","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1541398969,"ip_address":"","comment_id":36701,"utype":1}],"discussion_count":1,"race_medal":0,"score":10,"product_id":100006601,"comment_content":"现在微服务大行其道，分库是必然的了吧","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427976,"discussion_content":"不用微服务也可以用分库的，例如单纯做负载均衡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541398969,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":16131,"user_name":"不吃番茄的西红柿","can_delete":false,"product_type":"c1","uid":1142465,"ip_address":"","ucode":"AC62CE8D23FACD","user_header":"https://static001.geekbang.org/account/avatar/00/11/6e/c1/e2cc1261.jpg","comment_is_top":false,"comment_ctime":1531793296,"is_pvip":false,"replies":[{"id":5589,"content":"数据冗余，多个不同纬度的订单表","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1531810772,"ip_address":"","comment_id":16131,"utype":1}],"discussion_count":1,"race_medal":0,"score":10,"product_id":100006601,"comment_content":"咳咳，华仔，我再问一下，如果就算用用户id来进行分表，当后台需要统计整体的比如一个商户的后台订单情况，这时候可能该平台拥有的用户订单数据来自多个表？这时候怎么统一去查询这块数据呢？或者优化查询？ ","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420681,"discussion_content":"数据冗余，多个不同纬度的订单表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1531810772,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":14759,"user_name":"冰糕不冰","can_delete":false,"product_type":"c1","uid":1134761,"ip_address":"","ucode":"B754FE464BA426","user_header":"https://static001.geekbang.org/account/avatar/00/11/50/a9/3f8c7418.jpg","comment_is_top":false,"comment_ctime":1530636635,"is_pvip":false,"replies":[{"id":4971,"content":"最好通过接口处理数据，否则代码拆分数据不拆分，会导致非常多的问题","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1530662599,"ip_address":"","comment_id":14759,"utype":1}],"discussion_count":1,"race_medal":0,"score":10,"product_id":100006601,"comment_content":"当业务分拆到三四个服务里后，同时又需要同时连接这三张表进行查询。这时只能通过调用不同的接口来处理数据吗？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420123,"discussion_content":"最好通过接口处理数据，否则代码拆分数据不拆分，会导致非常多的问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1530662599,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":13901,"user_name":"银太","can_delete":false,"product_type":"c1","uid":1051765,"ip_address":"","ucode":"B505D15F7CB839","user_header":"https://static001.geekbang.org/account/avatar/00/10/0c/75/e7c6c403.jpg","comment_is_top":false,"comment_ctime":1530061892,"is_pvip":false,"replies":[{"id":4695,"content":"定期更新，但要牺牲用户体验","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1530178836,"ip_address":"","comment_id":13901,"utype":1}],"discussion_count":1,"race_medal":0,"score":10,"product_id":100006601,"comment_content":"对于count的情况通常是有条件的，计数作用不大，这种有什么更好的方案吗？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419804,"discussion_content":"定期更新，但要牺牲用户体验","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1530178836,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":13012,"user_name":"孙振超","can_delete":false,"product_type":"c1","uid":1101755,"ip_address":"","ucode":"0F9EABC6125350","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/bb/22af0e52.jpg","comment_is_top":false,"comment_ctime":1529298620,"is_pvip":false,"replies":[{"id":4343,"content":"你说的情况其实就是分表，只是最开始的时候所有分表都在一个数据库实例上而已","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1529376806,"ip_address":"","comment_id":13012,"utype":1}],"discussion_count":1,"race_medal":0,"score":10,"product_id":100006601,"comment_content":"引入分库分表的主要考量是数据量和系统容量要求，如果tps要求即将超过了单数据库实例所能承担的上限，或者数据库链接数满足不了上游应用服务器的要求，又或者数据库主从同步延迟超过了大多数业务要求的时间，就需要考虑引入分库分表了。在进行分表的拆分后，如果数据库的链接数或者容量还不满足，需要再次拆库，这里的拆库和文章里面的里面提到的拆库稍有不同，文章中的拆库是按照业务进行分拆，这里提到的拆库是将同一个业务的数据表分拆到多个数据库实例，比如将100张用户表从一个数据库实例分拆到10个数据库实例上，这样总容量可以提升近10倍，并且这样分拆后业务的整体可用性也有所提升，因为之前所有的数据都在一个实例上，如果这个实例出故障，业务就不可用了；分拆到10个实例，即使有一个实例出现了故障，还有90%的业务可用，当然成本也提升了10倍了。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419501,"discussion_content":"你说的情况其实就是分表，只是最开始的时候所有分表都在一个数据库实例上而已","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1529376806,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11994,"user_name":"小飞哥 ‍超級會員","can_delete":false,"product_type":"c1","uid":1110049,"ip_address":"","ucode":"417F9563B3005B","user_header":"https://static001.geekbang.org/account/avatar/00/10/f0/21/104b9565.jpg","comment_is_top":false,"comment_ctime":1528507445,"is_pvip":false,"replies":[{"id":3979,"content":"先组合查后分页","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528617703,"ip_address":"","comment_id":11994,"utype":1}],"discussion_count":1,"race_medal":0,"score":10,"product_id":100006601,"comment_content":"横向拆分后，分页查询会遇到查的结果不是相要的，如。我要查带库存的商品数据，先去查商品然后查库存，查完过滤掉无库存的商品，在组合起来，发现只有几条数据。达不到分页效果！这应该怎么处理？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419501,"discussion_content":"你说的情况其实就是分表，只是最开始的时候所有分表都在一个数据库实例上而已","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1529376806,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11985,"user_name":"王维","can_delete":false,"product_type":"c1","uid":1091684,"ip_address":"","ucode":"836E6CDB1A56BA","user_header":"https://static001.geekbang.org/account/avatar/00/10/a8/64/965e0d9b.jpg","comment_is_top":false,"comment_ctime":1528501645,"is_pvip":false,"replies":[{"id":3981,"content":"没看明白，按道理消息服务框架不是为了解决事务问题的","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528617781,"ip_address":"","comment_id":11985,"utype":1}],"discussion_count":1,"race_medal":0,"score":10,"product_id":100006601,"comment_content":"华仔你好，看了这期文章感觉很受益，感受最深的就是架构的演进要随着业务的发展而发展，是业务成就了技术，而不是技术成就了业务。有个问题想问下，分表分库会带来事务性的问题，那么，如果我在业务层采用消息服务框架，例如NserviceBus，可不可以避免这个分表分库的事务性问题呢？","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419074,"discussion_content":"先组合查后分页","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528617703,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11458,"user_name":"天下第一帅","can_delete":false,"product_type":"c1","uid":1133958,"ip_address":"","ucode":"188E0212A1C48B","user_header":"https://static001.geekbang.org/account/avatar/00/11/4d/86/62aad981.jpg","comment_is_top":false,"comment_ctime":1528159049,"is_pvip":false,"replies":[{"id":3702,"content":"实战就是要基于理论分析和选择的","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528189008,"ip_address":"","comment_id":11458,"utype":1}],"discussion_count":1,"race_medal":0,"score":10,"product_id":100006601,"comment_content":"期望能看到实战，这些理论都大差不差","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419070,"discussion_content":"没看明白，按道理消息服务框架不是为了解决事务问题的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528617781,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11302,"user_name":"卡卢比","can_delete":false,"product_type":"c1","uid":1102663,"ip_address":"","ucode":"0F962B5BD83C63","user_header":"https://static001.geekbang.org/account/avatar/00/10/d3/47/10727d5f.jpg","comment_is_top":false,"comment_ctime":1528039458,"is_pvip":false,"replies":[{"id":3617,"content":"没有太好的方案，文中提到的基本都是常用的","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528081224,"ip_address":"","comment_id":11302,"utype":1}],"discussion_count":1,"race_medal":0,"score":10,"product_id":100006601,"comment_content":"分库分表的原理和出现的问题网上一大堆文章，但是介绍具体解决方案和方案优缺点的却很少，希望大大能详细些。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418786,"discussion_content":"没有太好的方案，文中提到的基本都是常用的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528081224,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11249,"user_name":"忠厚","can_delete":false,"product_type":"c1","uid":1105648,"ip_address":"","ucode":"86ED2B630187C9","user_header":"https://static001.geekbang.org/account/avatar/00/10/de/f0/ccf46294.jpg","comment_is_top":false,"comment_ctime":1527994970,"is_pvip":false,"replies":[{"id":3625,"content":"话题太大，不好展开，对于业务架构来说，简单来说就是“云”+“人工智能”","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528081666,"ip_address":"","comment_id":11249,"utype":1}],"discussion_count":1,"race_medal":0,"score":11,"product_id":100006601,"comment_content":"好的架构师需要不断的方案积累，老师，能不能谈谈未来5-10年内架构师的前景","like_count":0},{"had_liked":false,"id":11102,"user_name":"万里晴空","can_delete":false,"product_type":"c1","uid":1102030,"ip_address":"","ucode":"D189F67E82BAB4","user_header":"https://static001.geekbang.org/account/avatar/00/10/d0/ce/42018f4f.jpg","comment_is_top":false,"comment_ctime":1527847997,"is_pvip":false,"replies":[{"id":3584,"content":"历史表建议拆分到独立的表","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527946941,"ip_address":"","comment_id":11102,"utype":1}],"discussion_count":1,"race_medal":0,"score":11,"product_id":100006601,"comment_content":"针对历史数据，是单表进行分区好呢，还是表再分成历史表好呢（属于水平拆分吧），这两个有什么区别？对性能要求很高","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418717,"discussion_content":"历史表建议拆分到独立的表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527946941,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11085,"user_name":"三月沙@wecatch","can_delete":false,"product_type":"c1","uid":1034980,"ip_address":"","ucode":"16FEF6C74D24E3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ca/e4/f15a1cf0.jpg","comment_is_top":false,"comment_ctime":1527828146,"is_pvip":false,"replies":[{"id":3520,"content":"不成熟或者未经大规模验证的一般可以尝试，但别太冒进","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527837759,"ip_address":"","comment_id":11085,"utype":1}],"discussion_count":1,"race_medal":0,"score":11,"product_id":100006601,"comment_content":"还是要先简单再复杂，遵循演化原则，根据团队能力和精力，在合适时机再分库分表，早分早复杂，晚分晚痛苦。能不能再介绍一些对分库分表的这些问题的替换方案，比如采用类似tidb的新式数据库","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418717,"discussion_content":"历史表建议拆分到独立的表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527946941,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11084,"user_name":"万里晴空","can_delete":false,"product_type":"c1","uid":1102030,"ip_address":"","ucode":"D189F67E82BAB4","user_header":"https://static001.geekbang.org/account/avatar/00/10/d0/ce/42018f4f.jpg","comment_is_top":false,"comment_ctime":1527827876,"is_pvip":false,"replies":[{"id":3521,"content":"每个学期才刷一次，而且才800万数据，也不是天天刷，完全没有什么问题啊，怎么简单怎么来","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527838043,"ip_address":"","comment_id":11084,"utype":1}],"discussion_count":1,"race_medal":0,"score":11,"product_id":100006601,"comment_content":"非常感谢每次给我回复。再请教一个问题，业务上全省有800万学生（第一次全部刷到系统的学生表中，其中有一个字段决定学期），每个学期学生操作后进行归档（历史数据产生），到了下一个学期，要求这些学生全部激活（即又批量刷800万，其实这些数据消息队列已经实时\n推送）现在有两种方案：1用一张历史学生表和当前学生表，也就是你讲的水平拆分\n另外一种方案是用一张表来存放，每个学期都在这里面，这个方案会用到分区。请问一下哪种会好一点，用分区可以用一张表搞定，用水平拆分用两张表，业务上就会调整查历史数据用一张，查当前用另外一张。两者之间都会存在每个学期批量刷800万数据，有什么好的思路可以提供不？非常感谢🙏","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418710,"discussion_content":"不成熟或者未经大规模验证的一般可以尝试，但别太冒进","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527837759,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11009,"user_name":"万里晴空","can_delete":false,"product_type":"c1","uid":1102030,"ip_address":"","ucode":"D189F67E82BAB4","user_header":"https://static001.geekbang.org/account/avatar/00/10/d0/ce/42018f4f.jpg","comment_is_top":false,"comment_ctime":1527782225,"is_pvip":false,"replies":[{"id":3484,"content":"你说的分区是分表的一种具体实现方式，分表既可以按照主键id范围划分，也可以按照某列的值划分，例如按省份分表","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527819061,"ip_address":"","comment_id":11009,"utype":1}],"discussion_count":1,"race_medal":0,"score":11,"product_id":100006601,"comment_content":"讲了读写分离和分库分表，主要解决数据量问题，那为啥不考虑分区呢？设计每张表的时候都带上一个区域范围，然后根据这个字段进行分区？请问分区有什么影响么？目前项目中考虑分区来实现数据量大的问题，不知道有什么后果","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418672,"discussion_content":"你说的分区是分表的一种具体实现方式，分表既可以按照主键id范围划分，也可以按照某列的值划分，例如按省份分表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527819061,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10961,"user_name":"王磊","can_delete":false,"product_type":"c1","uid":1050085,"ip_address":"","ucode":"A4DE9804642A08","user_header":"https://static001.geekbang.org/account/avatar/00/10/05/e5/aa579968.jpg","comment_is_top":false,"comment_ctime":1527766190,"is_pvip":false,"replies":[{"id":3526,"content":"那是nosql的内容了，后面会涉及","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527838303,"ip_address":"","comment_id":10961,"utype":1}],"discussion_count":1,"race_medal":0,"score":11,"product_id":100006601,"comment_content":"我理解-对于列式数据库，则没有必要对表进行垂直切分了。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418658,"discussion_content":"那是nosql的内容了，后面会涉及","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527838303,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10922,"user_name":"Johnny.Z","can_delete":false,"product_type":"c1","uid":1057367,"ip_address":"","ucode":"E4496B8F5163F5","user_header":"https://static001.geekbang.org/account/avatar/00/10/22/57/cf35d10c.jpg","comment_is_top":false,"comment_ctime":1527742721,"is_pvip":false,"replies":[{"id":3485,"content":"多表数据聚合后再二次order by就可以了","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527819126,"ip_address":"","comment_id":10922,"utype":1}],"discussion_count":1,"race_medal":0,"score":11,"product_id":100006601,"comment_content":"横切的表做order by貌似得到的结果不准确","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418643,"discussion_content":"多表数据聚合后再二次order by就可以了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527819126,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10906,"user_name":"鹅米豆发","can_delete":false,"product_type":"c1","uid":1017687,"ip_address":"","ucode":"98E8D911EE32DE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/57/645159ee.jpg","comment_is_top":false,"comment_ctime":1527735023,"is_pvip":false,"replies":[{"id":3487,"content":"考虑缓存前还需要考虑优化sql，大部分数据库性能不行的首要原因可能就是慢查询","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527819390,"ip_address":"","comment_id":10906,"utype":1}],"discussion_count":1,"race_medal":0,"score":11,"product_id":100006601,"comment_content":"       第二个问题，数据库性能不够的时候就要分库分表吗？性能不够，特别是IO引起的性能问题，首先应该考虑缓存如Memcache、Redis，内存数据库如VoltDB、MemSQL、CounchDB，各种读时模式的数据库如ES、Mongo，各种分布式数据库HBase、TiDB。\n       第一个问题，关系型数据库有什么优势？研发成本最可控，运维体系最完善，业界产品最成熟，一致性、可靠性、安全性有极好的支持。其中，研发成本这块对小公司，运维体系这块对大公司，都有很大的吸引力。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418636,"discussion_content":"考虑缓存前还需要考虑优化sql，大部分数据库性能不行的首要原因可能就是慢查询","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527819390,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10834,"user_name":"海盗","can_delete":false,"product_type":"c1","uid":1100513,"ip_address":"","ucode":"2DAC692BD7CD7B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIEEeNHoILgDNvTX4FCjEgwicwsHcdxx5qzlawCichiazP8yakfN4jOicIpiarLJpC8iby0FSdcWrIG0jdw/132","comment_is_top":false,"comment_ctime":1527727079,"is_pvip":false,"replies":null,"discussion_count":20,"race_medal":0,"score":11,"product_id":100006601,"comment_content":"分库，分表带来的问题都知道，能不能介绍些好的方便的改进方案？","like_count":374,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418636,"discussion_content":"考虑缓存前还需要考虑优化sql，大部分数据库性能不行的首要原因可能就是慢查询","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527819390,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11125,"user_name":"李元霸","can_delete":false,"product_type":"c1","uid":1111286,"ip_address":"","ucode":"8EAD2F6309BF75","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTICkvsz0XI1kMRbsgY5AmOSNiaG8AkMxn9gbSYXLwUdmjqXcozVRMiaT7AxrARuyqEbUOTvyc6KuSmA/132","comment_is_top":false,"comment_ctime":1527865908,"is_pvip":false,"replies":null,"discussion_count":5,"race_medal":0,"score":11,"product_id":100006601,"comment_content":"老师，使用tidb方案来代替分库分表是否推荐？","like_count":26,"discussions":[{"author":{"id":2019657,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/d1/49/791d0f5e.jpg","nickname":"aake","note":"","ucode":"FEFBF59EF09BFD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288450,"discussion_content":"tidb这几年势头有点猛，有比较多的落地案例","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1593752053,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2153670,"avatar":"https://static001.geekbang.org/account/avatar/00/20/dc/c6/241e81ec.jpg","nickname":"tank","note":"","ucode":"3E93D49318215A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2019657,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/d1/49/791d0f5e.jpg","nickname":"aake","note":"","ucode":"FEFBF59EF09BFD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":322638,"discussion_content":"根据我们实际使用来看，效果很不错，但前提是你最好有本地SSD磁盘，这个对磁盘要求还是比较高，尤其是tikv的磁盘，如果在云服务器上需要选用增强性磁盘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604791053,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":288450,"ip_address":"","group_id":0},"score":322638,"extra":""}]},{"author":{"id":1251905,"avatar":"https://static001.geekbang.org/account/avatar/00/13/1a/41/3d87f7ac.jpg","nickname":"橙生北国","note":"","ucode":"13E32479E111B7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":607158,"discussion_content":"现在怎么说？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677649218,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1402570,"avatar":"https://static001.geekbang.org/account/avatar/00/15/66/ca/fb5c3a30.jpg","nickname":"tungSing","note":"","ucode":"F7147EA351BE44","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":402711,"discussion_content":"同问，大家有真实的使用情况，可以分享一下吗\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1633935778,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1033096,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c3/88/d16816a8.jpg","nickname":"如来神掌","note":"","ucode":"45E20FF935BD2F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":304233,"discussion_content":"值得使用，很多大流量企业和金融公司已经在使用了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599526363,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11249,"user_name":"忠厚","can_delete":false,"product_type":"c1","uid":1105648,"ip_address":"","ucode":"86ED2B630187C9","user_header":"https://static001.geekbang.org/account/avatar/00/10/de/f0/ccf46294.jpg","comment_is_top":false,"comment_ctime":1527994970,"is_pvip":false,"replies":[{"id":3625,"content":"话题太大，不好展开，对于业务架构来说，简单来说就是“云”+“人工智能”","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1528081666,"ip_address":"","comment_id":11249,"utype":1}],"discussion_count":1,"race_medal":0,"score":11,"product_id":100006601,"comment_content":"好的架构师需要不断的方案积累，老师，能不能谈谈未来5-10年内架构师的前景","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418764,"discussion_content":"话题太大，不好展开，对于业务架构来说，简单来说就是“云”+“人工智能”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528081666,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11102,"user_name":"万里晴空","can_delete":false,"product_type":"c1","uid":1102030,"ip_address":"","ucode":"D189F67E82BAB4","user_header":"https://static001.geekbang.org/account/avatar/00/10/d0/ce/42018f4f.jpg","comment_is_top":false,"comment_ctime":1527847997,"is_pvip":false,"replies":[{"id":3584,"content":"历史表建议拆分到独立的表","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527946941,"ip_address":"","comment_id":11102,"utype":1}],"discussion_count":1,"race_medal":0,"score":11,"product_id":100006601,"comment_content":"针对历史数据，是单表进行分区好呢，还是表再分成历史表好呢（属于水平拆分吧），这两个有什么区别？对性能要求很高","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418764,"discussion_content":"话题太大，不好展开，对于业务架构来说，简单来说就是“云”+“人工智能”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1528081666,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11085,"user_name":"三月沙@wecatch","can_delete":false,"product_type":"c1","uid":1034980,"ip_address":"","ucode":"16FEF6C74D24E3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ca/e4/f15a1cf0.jpg","comment_is_top":false,"comment_ctime":1527828146,"is_pvip":false,"replies":[{"id":3520,"content":"不成熟或者未经大规模验证的一般可以尝试，但别太冒进","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527837759,"ip_address":"","comment_id":11085,"utype":1}],"discussion_count":1,"race_medal":0,"score":11,"product_id":100006601,"comment_content":"还是要先简单再复杂，遵循演化原则，根据团队能力和精力，在合适时机再分库分表，早分早复杂，晚分晚痛苦。能不能再介绍一些对分库分表的这些问题的替换方案，比如采用类似tidb的新式数据库","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418710,"discussion_content":"不成熟或者未经大规模验证的一般可以尝试，但别太冒进","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527837759,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11084,"user_name":"万里晴空","can_delete":false,"product_type":"c1","uid":1102030,"ip_address":"","ucode":"D189F67E82BAB4","user_header":"https://static001.geekbang.org/account/avatar/00/10/d0/ce/42018f4f.jpg","comment_is_top":false,"comment_ctime":1527827876,"is_pvip":false,"replies":[{"id":3521,"content":"每个学期才刷一次，而且才800万数据，也不是天天刷，完全没有什么问题啊，怎么简单怎么来","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527838043,"ip_address":"","comment_id":11084,"utype":1}],"discussion_count":1,"race_medal":0,"score":11,"product_id":100006601,"comment_content":"非常感谢每次给我回复。再请教一个问题，业务上全省有800万学生（第一次全部刷到系统的学生表中，其中有一个字段决定学期），每个学期学生操作后进行归档（历史数据产生），到了下一个学期，要求这些学生全部激活（即又批量刷800万，其实这些数据消息队列已经实时\n推送）现在有两种方案：1用一张历史学生表和当前学生表，也就是你讲的水平拆分\n另外一种方案是用一张表来存放，每个学期都在这里面，这个方案会用到分区。请问一下哪种会好一点，用分区可以用一张表搞定，用水平拆分用两张表，业务上就会调整查历史数据用一张，查当前用另外一张。两者之间都会存在每个学期批量刷800万数据，有什么好的思路可以提供不？非常感谢🙏","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418709,"discussion_content":"每个学期才刷一次，而且才800万数据，也不是天天刷，完全没有什么问题啊，怎么简单怎么来","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527838043,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":11009,"user_name":"万里晴空","can_delete":false,"product_type":"c1","uid":1102030,"ip_address":"","ucode":"D189F67E82BAB4","user_header":"https://static001.geekbang.org/account/avatar/00/10/d0/ce/42018f4f.jpg","comment_is_top":false,"comment_ctime":1527782225,"is_pvip":false,"replies":[{"id":3484,"content":"你说的分区是分表的一种具体实现方式，分表既可以按照主键id范围划分，也可以按照某列的值划分，例如按省份分表","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527819061,"ip_address":"","comment_id":11009,"utype":1}],"discussion_count":1,"race_medal":0,"score":11,"product_id":100006601,"comment_content":"讲了读写分离和分库分表，主要解决数据量问题，那为啥不考虑分区呢？设计每张表的时候都带上一个区域范围，然后根据这个字段进行分区？请问分区有什么影响么？目前项目中考虑分区来实现数据量大的问题，不知道有什么后果","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418709,"discussion_content":"每个学期才刷一次，而且才800万数据，也不是天天刷，完全没有什么问题啊，怎么简单怎么来","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527838043,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10961,"user_name":"王磊","can_delete":false,"product_type":"c1","uid":1050085,"ip_address":"","ucode":"A4DE9804642A08","user_header":"https://static001.geekbang.org/account/avatar/00/10/05/e5/aa579968.jpg","comment_is_top":false,"comment_ctime":1527766190,"is_pvip":false,"replies":[{"id":3526,"content":"那是nosql的内容了，后面会涉及","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527838303,"ip_address":"","comment_id":10961,"utype":1}],"discussion_count":1,"race_medal":0,"score":11,"product_id":100006601,"comment_content":"我理解-对于列式数据库，则没有必要对表进行垂直切分了。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418672,"discussion_content":"你说的分区是分表的一种具体实现方式，分表既可以按照主键id范围划分，也可以按照某列的值划分，例如按省份分表","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527819061,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10922,"user_name":"Johnny.Z","can_delete":false,"product_type":"c1","uid":1057367,"ip_address":"","ucode":"E4496B8F5163F5","user_header":"https://static001.geekbang.org/account/avatar/00/10/22/57/cf35d10c.jpg","comment_is_top":false,"comment_ctime":1527742721,"is_pvip":false,"replies":[{"id":3485,"content":"多表数据聚合后再二次order by就可以了","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527819126,"ip_address":"","comment_id":10922,"utype":1}],"discussion_count":1,"race_medal":0,"score":11,"product_id":100006601,"comment_content":"横切的表做order by貌似得到的结果不准确","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418658,"discussion_content":"那是nosql的内容了，后面会涉及","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527838303,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10906,"user_name":"鹅米豆发","can_delete":false,"product_type":"c1","uid":1017687,"ip_address":"","ucode":"98E8D911EE32DE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/57/645159ee.jpg","comment_is_top":false,"comment_ctime":1527735023,"is_pvip":false,"replies":[{"id":3487,"content":"考虑缓存前还需要考虑优化sql，大部分数据库性能不行的首要原因可能就是慢查询","user_name":"作者回复","user_name_real":"华仔","uid":1098920,"ctime":1527819390,"ip_address":"","comment_id":10906,"utype":1}],"discussion_count":1,"race_medal":0,"score":11,"product_id":100006601,"comment_content":"       第二个问题，数据库性能不够的时候就要分库分表吗？性能不够，特别是IO引起的性能问题，首先应该考虑缓存如Memcache、Redis，内存数据库如VoltDB、MemSQL、CounchDB，各种读时模式的数据库如ES、Mongo，各种分布式数据库HBase、TiDB。\n       第一个问题，关系型数据库有什么优势？研发成本最可控，运维体系最完善，业界产品最成熟，一致性、可靠性、安全性有极好的支持。其中，研发成本这块对小公司，运维体系这块对大公司，都有很大的吸引力。","like_count":0,"discussions":[{"author":{"id":1098920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/c4/a8/f2685e1b.jpg","nickname":"华仔","note":"","ucode":"851FF94CF5133A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":418643,"discussion_content":"多表数据聚合后再二次order by就可以了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1527819126,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10834,"user_name":"海盗","can_delete":false,"product_type":"c1","uid":1100513,"ip_address":"","ucode":"2DAC692BD7CD7B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIEEeNHoILgDNvTX4FCjEgwicwsHcdxx5qzlawCichiazP8yakfN4jOicIpiarLJpC8iby0FSdcWrIG0jdw/132","comment_is_top":false,"comment_ctime":1527727079,"is_pvip":false,"replies":null,"discussion_count":20,"race_medal":0,"score":11,"product_id":100006601,"comment_content":"分库，分表带来的问题都知道，能不能介绍些好的方便的改进方案？","like_count":374,"discussions":[{"author":{"id":2012897,"avatar":"","nickname":"Geek_8904b3","note":"","ucode":"0FC72688420607","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291045,"discussion_content":"看完，感觉没解决什么实际问题。。。","likes_number":23,"is_delete":false,"is_hidden":false,"ctime":1594689523,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1716146,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/2f/b2/a23f576e.jpg","nickname":"哪路大将金","note":"","ucode":"9A53F52CE29803","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2012897,"avatar":"","nickname":"Geek_8904b3","note":"","ucode":"0FC72688420607","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":596629,"discussion_content":"他好像讲了，又好像什么也没讲，幸亏没买","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1671157426,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":291045,"ip_address":"上海","group_id":0},"score":596629,"extra":""}]},{"author":{"id":2103686,"avatar":"https://static001.geekbang.org/account/avatar/00/20/19/86/cf5929bd.jpg","nickname":"The Rock","note":"","ucode":"99965FCC9D0AF7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":320391,"discussion_content":"可以考虑引入canal，将业务数据同步到es中，复杂后台查询通过es实现。","likes_number":16,"is_delete":false,"is_hidden":false,"ctime":1604361736,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1891723,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/dd/8b/6e025928.jpg","nickname":"绿水青山","note":"","ucode":"EB250C21413C9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2103686,"avatar":"https://static001.geekbang.org/account/avatar/00/20/19/86/cf5929bd.jpg","nickname":"The Rock","note":"","ucode":"99965FCC9D0AF7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368072,"discussion_content":"是的，我们现在的方案就是这样，不过用的是solr","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1618557304,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":320391,"ip_address":"","group_id":0},"score":368072,"extra":""},{"author":{"id":1342023,"avatar":"https://static001.geekbang.org/account/avatar/00/14/7a/47/d9090056.jpg","nickname":"在路边鼓掌的人","note":"","ucode":"BC1388BA330CD5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2103686,"avatar":"https://static001.geekbang.org/account/avatar/00/20/19/86/cf5929bd.jpg","nickname":"The Rock","note":"","ucode":"99965FCC9D0AF7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580416,"discussion_content":"字节内部很多也是这样，订阅binlog然后通过logstash转储到es查询","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658153031,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":320391,"ip_address":"","group_id":0},"score":580416,"extra":""},{"author":{"id":1181376,"avatar":"https://static001.geekbang.org/account/avatar/00/12/06/c0/ee3bfb45.jpg","nickname":"好大一颗TREE","note":"","ucode":"B0173A5B8997CD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1342023,"avatar":"https://static001.geekbang.org/account/avatar/00/14/7a/47/d9090056.jpg","nickname":"在路边鼓掌的人","note":"","ucode":"BC1388BA330CD5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":624276,"discussion_content":"大厂的很多基本上都是这种解决方案，也有用TiDB的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1690381909,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":580416,"ip_address":"上海","group_id":0},"score":624276,"extra":""}]},{"author":{"id":1079439,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/8f/0d927ab3.jpg","nickname":"Shawn","note":"","ucode":"B8171A0BEA2FE0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351560,"discussion_content":"上tidb吧","likes_number":10,"is_delete":false,"is_hidden":false,"ctime":1614325217,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1542987,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/4b/15ab499a.jpg","nickname":"风轻扬","note":"","ucode":"DB972F2DF059C4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1079439,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/8f/0d927ab3.jpg","nickname":"Shawn","note":"","ucode":"B8171A0BEA2FE0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":607307,"discussion_content":"要是打算上TiDB，那一开始就直接上，^_^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677757464,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":351560,"ip_address":"北京","group_id":0},"score":607307,"extra":""}]},{"author":{"id":1518348,"avatar":"https://static001.geekbang.org/account/avatar/00/17/2b/0c/f4bdb520.jpg","nickname":"Dr. Wong","note":"","ucode":"0CEF58927E69E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385543,"discussion_content":"drds巨坑，劝大家不要用， sharding-jdbc还行","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1627120515,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2066625,"avatar":"http://thirdwx.qlogo.cn/mmopen/h0KAdRFKjCOSLRjzictvlaLAHeHPBY2vsUzOJ6Jz1GvE9y8aeib4UBEaYC5xwvxIoo237IibUTh4vkoicAD9HeucdGYj9jnSpmvk/132","nickname":"未老先胖白小贝","note":"","ucode":"D61B98FE625027","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351653,"discussion_content":"感觉只是说了一遍问题，没解决方案","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1614380687,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1103556,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d6/c4/27343f76.jpg","nickname":"SHift","note":"","ucode":"36BD4A38F7FA2C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2066625,"avatar":"http://thirdwx.qlogo.cn/mmopen/h0KAdRFKjCOSLRjzictvlaLAHeHPBY2vsUzOJ6Jz1GvE9y8aeib4UBEaYC5xwvxIoo237IibUTh4vkoicAD9HeucdGYj9jnSpmvk/132","nickname":"未老先胖白小贝","note":"","ucode":"D61B98FE625027","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":577825,"discussion_content":"老师也不知道要怎么解决，水平分表本身就是业界难题","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1656377584,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":351653,"ip_address":"","group_id":0},"score":577825,"extra":""}]},{"author":{"id":1134861,"avatar":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","nickname":"James","note":"","ucode":"48B0F2A334D1C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":404924,"discussion_content":"说到点上了。。问题谁都知道。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1634462690,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1067212,"avatar":"https://static001.geekbang.org/account/avatar/00/10/48/cc/109fa895.jpg","nickname":"Kim","note":"","ucode":"824575C9FCE06D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":395400,"discussion_content":"sharding-jdbc，你值得拥有","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1632300231,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1163383,"avatar":"https://static001.geekbang.org/account/avatar/00/11/c0/77/d05c6abd.jpg","nickname":"0273522","note":"","ucode":"B04365B8FC27AD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":340059,"discussion_content":"老师都没回答你的问题","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1609895738,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1651441,"avatar":"https://static001.geekbang.org/account/avatar/00/19/32/f1/fd24d52b.jpg","nickname":"青禾qingh","note":"","ucode":"453FC435B03790","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1163383,"avatar":"https://static001.geekbang.org/account/avatar/00/11/c0/77/d05c6abd.jpg","nickname":"0273522","note":"","ucode":"B04365B8FC27AD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":531953,"discussion_content":"老师不好意思直面面对这个问题😁","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637481401,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":340059,"ip_address":"","group_id":0},"score":531953,"extra":"{\"user_type\":1}"}]},{"author":{"id":1441187,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKbwJ55niaS6Df8BjvKK2ug2jFibCYhicz1lx7GDYOGs9MMgbHJmWoH1DXZAR5TKsESyUz1zsaw4Flew/132","nickname":"Virtue","note":"","ucode":"67B2D1AD06D714","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":610703,"discussion_content":"……","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679702703,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1670763,"avatar":"https://static001.geekbang.org/account/avatar/00/19/7e/6b/36fc4516.jpg","nickname":"FIRE","note":"","ucode":"85861D990FB3AB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549463,"discussion_content":"分表还是不要使用了，改动大任务重","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643992975,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1297630,"avatar":"https://static001.geekbang.org/account/avatar/00/13/cc/de/e28c01e1.jpg","nickname":"剑八","note":"","ucode":"0A09F41DB8A4E7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533062,"discussion_content":"这个要看具体场景的\n不同场景方案不一样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637765810,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1434423,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e3/37/c132802f.jpg","nickname":"WESTWALL","note":"","ucode":"295A030F9D3BF4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364991,"discussion_content":"没有银弹？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617679536,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"戒酒的李白","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1434423,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e3/37/c132802f.jpg","nickname":"WESTWALL","note":"","ucode":"295A030F9D3BF4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533785,"discussion_content":"银弹是redis专家","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637974046,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":364991,"ip_address":"","group_id":0},"score":533785,"extra":""}]}]},{"had_liked":false,"id":11125,"user_name":"李元霸","can_delete":false,"product_type":"c1","uid":1111286,"ip_address":"","ucode":"8EAD2F6309BF75","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTICkvsz0XI1kMRbsgY5AmOSNiaG8AkMxn9gbSYXLwUdmjqXcozVRMiaT7AxrARuyqEbUOTvyc6KuSmA/132","comment_is_top":false,"comment_ctime":1527865908,"is_pvip":false,"replies":null,"discussion_count":5,"race_medal":0,"score":11,"product_id":100006601,"comment_content":"老师，使用tidb方案来代替分库分表是否推荐？","like_count":26,"discussions":[{"author":{"id":2012897,"avatar":"","nickname":"Geek_8904b3","note":"","ucode":"0FC72688420607","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291045,"discussion_content":"看完，感觉没解决什么实际问题。。。","likes_number":23,"is_delete":false,"is_hidden":false,"ctime":1594689523,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1716146,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/2f/b2/a23f576e.jpg","nickname":"哪路大将金","note":"","ucode":"9A53F52CE29803","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2012897,"avatar":"","nickname":"Geek_8904b3","note":"","ucode":"0FC72688420607","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":596629,"discussion_content":"他好像讲了，又好像什么也没讲，幸亏没买","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1671157426,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":291045,"ip_address":"上海","group_id":0},"score":596629,"extra":""}]},{"author":{"id":2103686,"avatar":"https://static001.geekbang.org/account/avatar/00/20/19/86/cf5929bd.jpg","nickname":"The Rock","note":"","ucode":"99965FCC9D0AF7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":320391,"discussion_content":"可以考虑引入canal，将业务数据同步到es中，复杂后台查询通过es实现。","likes_number":16,"is_delete":false,"is_hidden":false,"ctime":1604361736,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1891723,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/dd/8b/6e025928.jpg","nickname":"绿水青山","note":"","ucode":"EB250C21413C9E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2103686,"avatar":"https://static001.geekbang.org/account/avatar/00/20/19/86/cf5929bd.jpg","nickname":"The Rock","note":"","ucode":"99965FCC9D0AF7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368072,"discussion_content":"是的，我们现在的方案就是这样，不过用的是solr","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1618557304,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":320391,"ip_address":"","group_id":0},"score":368072,"extra":""},{"author":{"id":1342023,"avatar":"https://static001.geekbang.org/account/avatar/00/14/7a/47/d9090056.jpg","nickname":"在路边鼓掌的人","note":"","ucode":"BC1388BA330CD5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2103686,"avatar":"https://static001.geekbang.org/account/avatar/00/20/19/86/cf5929bd.jpg","nickname":"The Rock","note":"","ucode":"99965FCC9D0AF7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580416,"discussion_content":"字节内部很多也是这样，订阅binlog然后通过logstash转储到es查询","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658153031,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":320391,"ip_address":"","group_id":0},"score":580416,"extra":""},{"author":{"id":1181376,"avatar":"https://static001.geekbang.org/account/avatar/00/12/06/c0/ee3bfb45.jpg","nickname":"好大一颗TREE","note":"","ucode":"B0173A5B8997CD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1342023,"avatar":"https://static001.geekbang.org/account/avatar/00/14/7a/47/d9090056.jpg","nickname":"在路边鼓掌的人","note":"","ucode":"BC1388BA330CD5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":624276,"discussion_content":"大厂的很多基本上都是这种解决方案，也有用TiDB的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1690381909,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":580416,"ip_address":"上海","group_id":0},"score":624276,"extra":""}]},{"author":{"id":1079439,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/8f/0d927ab3.jpg","nickname":"Shawn","note":"","ucode":"B8171A0BEA2FE0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351560,"discussion_content":"上tidb吧","likes_number":10,"is_delete":false,"is_hidden":false,"ctime":1614325217,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1542987,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/4b/15ab499a.jpg","nickname":"风轻扬","note":"","ucode":"DB972F2DF059C4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1079439,"avatar":"https://static001.geekbang.org/account/avatar/00/10/78/8f/0d927ab3.jpg","nickname":"Shawn","note":"","ucode":"B8171A0BEA2FE0","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":607307,"discussion_content":"要是打算上TiDB，那一开始就直接上，^_^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677757464,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":351560,"ip_address":"北京","group_id":0},"score":607307,"extra":""}]},{"author":{"id":1518348,"avatar":"https://static001.geekbang.org/account/avatar/00/17/2b/0c/f4bdb520.jpg","nickname":"Dr. Wong","note":"","ucode":"0CEF58927E69E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385543,"discussion_content":"drds巨坑，劝大家不要用， sharding-jdbc还行","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1627120515,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2066625,"avatar":"http://thirdwx.qlogo.cn/mmopen/h0KAdRFKjCOSLRjzictvlaLAHeHPBY2vsUzOJ6Jz1GvE9y8aeib4UBEaYC5xwvxIoo237IibUTh4vkoicAD9HeucdGYj9jnSpmvk/132","nickname":"未老先胖白小贝","note":"","ucode":"D61B98FE625027","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351653,"discussion_content":"感觉只是说了一遍问题，没解决方案","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1614380687,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1103556,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d6/c4/27343f76.jpg","nickname":"SHift","note":"","ucode":"36BD4A38F7FA2C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2066625,"avatar":"http://thirdwx.qlogo.cn/mmopen/h0KAdRFKjCOSLRjzictvlaLAHeHPBY2vsUzOJ6Jz1GvE9y8aeib4UBEaYC5xwvxIoo237IibUTh4vkoicAD9HeucdGYj9jnSpmvk/132","nickname":"未老先胖白小贝","note":"","ucode":"D61B98FE625027","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":577825,"discussion_content":"老师也不知道要怎么解决，水平分表本身就是业界难题","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1656377584,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":351653,"ip_address":"","group_id":0},"score":577825,"extra":""}]},{"author":{"id":1134861,"avatar":"https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg","nickname":"James","note":"","ucode":"48B0F2A334D1C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":404924,"discussion_content":"说到点上了。。问题谁都知道。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1634462690,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1067212,"avatar":"https://static001.geekbang.org/account/avatar/00/10/48/cc/109fa895.jpg","nickname":"Kim","note":"","ucode":"824575C9FCE06D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":395400,"discussion_content":"sharding-jdbc，你值得拥有","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1632300231,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1163383,"avatar":"https://static001.geekbang.org/account/avatar/00/11/c0/77/d05c6abd.jpg","nickname":"0273522","note":"","ucode":"B04365B8FC27AD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":340059,"discussion_content":"老师都没回答你的问题","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1609895738,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1651441,"avatar":"https://static001.geekbang.org/account/avatar/00/19/32/f1/fd24d52b.jpg","nickname":"青禾qingh","note":"","ucode":"453FC435B03790","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1163383,"avatar":"https://static001.geekbang.org/account/avatar/00/11/c0/77/d05c6abd.jpg","nickname":"0273522","note":"","ucode":"B04365B8FC27AD","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":531953,"discussion_content":"老师不好意思直面面对这个问题😁","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637481401,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":340059,"ip_address":"","group_id":0},"score":531953,"extra":"{\"user_type\":1}"}]},{"author":{"id":1441187,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKbwJ55niaS6Df8BjvKK2ug2jFibCYhicz1lx7GDYOGs9MMgbHJmWoH1DXZAR5TKsESyUz1zsaw4Flew/132","nickname":"Virtue","note":"","ucode":"67B2D1AD06D714","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":610703,"discussion_content":"……","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679702703,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"上海","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1670763,"avatar":"https://static001.geekbang.org/account/avatar/00/19/7e/6b/36fc4516.jpg","nickname":"FIRE","note":"","ucode":"85861D990FB3AB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":549463,"discussion_content":"分表还是不要使用了，改动大任务重","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643992975,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1297630,"avatar":"https://static001.geekbang.org/account/avatar/00/13/cc/de/e28c01e1.jpg","nickname":"剑八","note":"","ucode":"0A09F41DB8A4E7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533062,"discussion_content":"这个要看具体场景的\n不同场景方案不一样","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637765810,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1434423,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e3/37/c132802f.jpg","nickname":"WESTWALL","note":"","ucode":"295A030F9D3BF4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":364991,"discussion_content":"没有银弹？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617679536,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":3,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"戒酒的李白","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1434423,"avatar":"https://static001.geekbang.org/account/avatar/00/15/e3/37/c132802f.jpg","nickname":"WESTWALL","note":"","ucode":"295A030F9D3BF4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533785,"discussion_content":"银弹是redis专家","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637974046,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":364991,"ip_address":"","group_id":0},"score":533785,"extra":""}]}]},{"had_liked":false,"id":10826,"user_name":"oddrock","can_delete":false,"product_type":"c1","uid":1037506,"ip_address":"","ucode":"55BADA192250B0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d4/c2/910d231e.jpg","comment_is_top":false,"comment_ctime":1527726671,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":12,"product_id":100006601,"comment_content":"分库分表的实施前提：\n1. 数据库存在性能问题，且用加索引、慢查询优化、缓存和读写分离都无法彻底解决问题的时候\n2. 复杂查询对应的单表数据量级一般超过千万以上，或简单查询的单表数据量级一般超过5000万以上\n3. 对一致性要求不是特别高，只要求最终一致性。\n4. 用hadoop等大数据技术因为业务需求、技术成本、时间成本无法解决该问题\n\n其他：\n1. 业务对数据的操作主要集中在某些字段上，比较适合垂直分表\n2. 业务对数据的操作在整个表层面较均匀分布，适合水平分表","like_count":19},{"had_liked":false,"id":14257,"user_name":"张国胜","can_delete":false,"product_type":"c1","uid":1063557,"ip_address":"","ucode":"3C3090C6FA7121","user_header":"https://static001.geekbang.org/account/avatar/00/10/3a/85/8e32883f.jpg","comment_is_top":false,"comment_ctime":1530245355,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":12,"product_id":100006601,"comment_content":"数据库优化顺序:\n1. 慢查询\n2. 根据业务特点，对表设计进行优化\n3. 业务逻辑问题\n4. 多用短查询\n5. 部分表加缓存\n这些做完再考虑分库分表吧？\n","like_count":18},{"had_liked":false,"id":140161,"user_name":"Lane","can_delete":false,"product_type":"c1","uid":1008257,"ip_address":"","ucode":"F70459D1BBD9F4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/62/81/ad80f427.jpg","comment_is_top":false,"comment_ctime":1570842907,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":12,"product_id":100006601,"comment_content":"我们有单表70亿行的mysql。前段时间刚拆完。","like_count":13},{"had_liked":false,"id":10844,"user_name":"Jonah","can_delete":false,"product_type":"c1","uid":1079507,"ip_address":"","ucode":"2C4799BD2FF0DE","user_header":"https://static001.geekbang.org/account/avatar/00/10/78/d3/1dc40aa2.jpg","comment_is_top":false,"comment_ctime":1527727790,"is_pvip":false,"replies":null,"discussion_count":3,"race_medal":0,"score":12,"product_id":100006601,"comment_content":"其实hash还有一个问题，就是当新增一张表时，怎么处理，比如说我原来是10张表，现在要增加到11张表，可以用一致性hash解决，但也会有数据迁移问题","like_count":6,"discussions":[{"author":{"id":1610360,"avatar":"https://static001.geekbang.org/account/avatar/00/18/92/78/7509a60a.jpg","nickname":"Viwen","note":"","ucode":"9AF59512D73B10","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":562390,"discussion_content":"你好，方便探讨一下么\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649817990,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53866,"user_name":"Geek_58ezrw","can_delete":false,"product_type":"c1","uid":1119789,"ip_address":"","ucode":"3D1F0996CE65C8","user_header":"https://static001.geekbang.org/account/avatar/00/11/16/2d/2753369a.jpg","comment_is_top":false,"comment_ctime":1545744672,"is_pvip":false,"replies":null,"discussion_count":2,"race_medal":0,"score":12,"product_id":100006601,"comment_content":"读写分离，分库分表以后，业务代码实现会变得很复杂。可以引入数据库中间件像mycat之类的。\n\n像用户表，我们是用hash路由，我分了0-9共10个表这个设计最大问题就是数据存储分布不均，就是用户在存储的时候，比如余数＝2和4很多，余数＝7和9的比较少，这样导致了，有的表压力很大。有的表完全浪费。其实我觉得用单位来路由会好一点","like_count":4,"discussions":[{"author":{"id":2143502,"avatar":"","nickname":"Geek_691909","note":"","ucode":"D3C5BDBC3BECDC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":365377,"discussion_content":"时隔N年才看到这个架构的文章，对于这个问题，我觉得是不是可以参考java map的实现，使用扰动函数，让hash出来的结果更加均匀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617785068,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1083395,"avatar":"https://static001.geekbang.org/account/avatar/00/10/88/03/805c8e0e.jpg","nickname":"追忆似水年华","note":"","ucode":"FB6C3EDC6988B6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2476,"discussion_content":"hash路由前可以做MD5操作，且加入随机salt（时间），这样分布会不会更好些","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563694346,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10875,"user_name":"面试官问","can_delete":false,"product_type":"c1","uid":1009375,"ip_address":"","ucode":"F9CE89589772F4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/66/df/501ba989.jpg","comment_is_top":false,"comment_ctime":1527730304,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":12,"product_id":100006601,"comment_content":"应该要对数据库做监控，在下面两种情况出现时，就要给出告警，架构师就要把分库分表提上日程：1）对数据库表做监控，根据具体业务场景，当表行数超过某个阈值时；2）对数据库查询等性能做监控，同样当时间超过某个阈值时。","like_count":4},{"had_liked":false,"id":10870,"user_name":"sea","can_delete":false,"product_type":"c1","uid":1099641,"ip_address":"","ucode":"0B39B3173FDF53","user_header":"https://static001.geekbang.org/account/avatar/00/10/c7/79/c24d50c8.jpg","comment_is_top":false,"comment_ctime":1527729715,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":12,"product_id":100006601,"comment_content":"请问配置路由具体如何实现呢？","like_count":3},{"had_liked":false,"id":128193,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1566861244,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":12,"product_id":100006601,"comment_content":"课前思考及问题\n1：啥是分库分表？\n单表数据量太大导致产生性能瓶颈，将一张表的数据在一个库分成N个表老来存储或者将一个表的数据分N个库来存储。好处是多表或多库来分担存储压力，确定是存储及查询更加复杂，分库后不能使用关联查询，需要自己拼接数据或使用数据库中间件代劳，另外，事务也是支持的不好，如果要支持的好性能又会受影响。\n\n课后思考及问题\n1：分库分表的原则？\n1-1：能不分就不分\n1-2：能优化就不分，优化包括硬件、业务、慢SQL\n1-3：先分表后分库，能不分库就不分\n1-4：为了查询性能，可以按不同维度多冗余数据\n1-5：根据具体业务来定，加缓存或结转能解决的性能问题也不需要分库分表\n1-6：分是为了分担压力，但会引入其他问题，所以扛得住就先不分，实在坑不住不得不分，分的时候注意分的维度和怎么在汇合数据\n嗯，挺好，受益匪浅，看实际业务需求吧！我们有几张大表(5百万+&#47;日)，只需保留最近三十天的数据在MySQL中，其他定期结转到大数据平台进行统计分析，就没做分库分表！","like_count":2},{"had_liked":false,"id":21122,"user_name":"lawlielt","can_delete":false,"product_type":"c1","uid":1058095,"ip_address":"","ucode":"709728A82C0667","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/2f/3266c0da.jpg","comment_is_top":false,"comment_ctime":1534929200,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":12,"product_id":100006601,"comment_content":"我们当前主要在框架层通过分析sql本身进行读写分离，同时针对主从延迟强制一定时间内都走主库。","like_count":2},{"had_liked":false,"id":311867,"user_name":"Drake敏","can_delete":false,"product_type":"c1","uid":2734734,"ip_address":"","ucode":"38366767EFDC90","user_header":"https://static001.geekbang.org/account/avatar/00/29/ba/8e/4645afae.jpg","comment_is_top":false,"comment_ctime":1631515866,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":12,"product_id":100006601,"comment_content":"个人感觉是性能上开始有瓶颈，就开始开始做分库分表而且肯定是业务量很大","like_count":1},{"had_liked":false,"id":10826,"user_name":"oddrock","can_delete":false,"product_type":"c1","uid":1037506,"ip_address":"","ucode":"55BADA192250B0","user_header":"https://static001.geekbang.org/account/avatar/00/0f/d4/c2/910d231e.jpg","comment_is_top":false,"comment_ctime":1527726671,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":12,"product_id":100006601,"comment_content":"分库分表的实施前提：\n1. 数据库存在性能问题，且用加索引、慢查询优化、缓存和读写分离都无法彻底解决问题的时候\n2. 复杂查询对应的单表数据量级一般超过千万以上，或简单查询的单表数据量级一般超过5000万以上\n3. 对一致性要求不是特别高，只要求最终一致性。\n4. 用hadoop等大数据技术因为业务需求、技术成本、时间成本无法解决该问题\n\n其他：\n1. 业务对数据的操作主要集中在某些字段上，比较适合垂直分表\n2. 业务对数据的操作在整个表层面较均匀分布，适合水平分表","like_count":19},{"had_liked":false,"id":14257,"user_name":"张国胜","can_delete":false,"product_type":"c1","uid":1063557,"ip_address":"","ucode":"3C3090C6FA7121","user_header":"https://static001.geekbang.org/account/avatar/00/10/3a/85/8e32883f.jpg","comment_is_top":false,"comment_ctime":1530245355,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":12,"product_id":100006601,"comment_content":"数据库优化顺序:\n1. 慢查询\n2. 根据业务特点，对表设计进行优化\n3. 业务逻辑问题\n4. 多用短查询\n5. 部分表加缓存\n这些做完再考虑分库分表吧？\n","like_count":18},{"had_liked":false,"id":140161,"user_name":"Lane","can_delete":false,"product_type":"c1","uid":1008257,"ip_address":"","ucode":"F70459D1BBD9F4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/62/81/ad80f427.jpg","comment_is_top":false,"comment_ctime":1570842907,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":12,"product_id":100006601,"comment_content":"我们有单表70亿行的mysql。前段时间刚拆完。","like_count":13,"discussions":[{"author":{"id":1610360,"avatar":"https://static001.geekbang.org/account/avatar/00/18/92/78/7509a60a.jpg","nickname":"Viwen","note":"","ucode":"9AF59512D73B10","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":562390,"discussion_content":"你好，方便探讨一下么\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649817990,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":10844,"user_name":"Jonah","can_delete":false,"product_type":"c1","uid":1079507,"ip_address":"","ucode":"2C4799BD2FF0DE","user_header":"https://static001.geekbang.org/account/avatar/00/10/78/d3/1dc40aa2.jpg","comment_is_top":false,"comment_ctime":1527727790,"is_pvip":false,"replies":null,"discussion_count":3,"race_medal":0,"score":12,"product_id":100006601,"comment_content":"其实hash还有一个问题，就是当新增一张表时，怎么处理，比如说我原来是10张表，现在要增加到11张表，可以用一致性hash解决，但也会有数据迁移问题","like_count":6,"discussions":[{"author":{"id":1046172,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f6/9c/b457a937.jpg","nickname":"不能扮演天使","note":"","ucode":"9922330BFF7FFB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290401,"discussion_content":"hash一般成倍增加，2变4，3变6，不会是2变3，3变4。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594458700,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1015754,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","nickname":"helloworld","note":"","ucode":"00DF2FEC58D2E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1046172,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f6/9c/b457a937.jpg","nickname":"不能扮演天使","note":"","ucode":"9922330BFF7FFB","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333179,"discussion_content":"这样做处于什么考虑呢?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607474762,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":290401,"ip_address":"","group_id":0},"score":333179,"extra":""},{"author":{"id":2873959,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/da/67/e18b690e.jpg","nickname":"神经蛙","note":"","ucode":"E0CE74B2363E10","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1015754,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","nickname":"helloworld","note":"","ucode":"00DF2FEC58D2E6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":610209,"discussion_content":"只需要迁移一半的数据考虑吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679455569,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":333179,"ip_address":"北京","group_id":0},"score":610209,"extra":""}]}]},{"had_liked":false,"id":53866,"user_name":"Geek_58ezrw","can_delete":false,"product_type":"c1","uid":1119789,"ip_address":"","ucode":"3D1F0996CE65C8","user_header":"https://static001.geekbang.org/account/avatar/00/11/16/2d/2753369a.jpg","comment_is_top":false,"comment_ctime":1545744672,"is_pvip":false,"replies":null,"discussion_count":2,"race_medal":0,"score":12,"product_id":100006601,"comment_content":"读写分离，分库分表以后，业务代码实现会变得很复杂。可以引入数据库中间件像mycat之类的。\n\n像用户表，我们是用hash路由，我分了0-9共10个表这个设计最大问题就是数据存储分布不均，就是用户在存储的时候，比如余数＝2和4很多，余数＝7和9的比较少，这样导致了，有的表压力很大。有的表完全浪费。其实我觉得用单位来路由会好一点","like_count":4,"discussions":[{"author":{"id":1046172,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f6/9c/b457a937.jpg","nickname":"不能扮演天使","note":"","ucode":"9922330BFF7FFB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290401,"discussion_content":"hash一般成倍增加，2变4，3变6，不会是2变3，3变4。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594458700,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1015754,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","nickname":"helloworld","note":"","ucode":"00DF2FEC58D2E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1046172,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f6/9c/b457a937.jpg","nickname":"不能扮演天使","note":"","ucode":"9922330BFF7FFB","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333179,"discussion_content":"这样做处于什么考虑呢?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607474762,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":290401,"ip_address":"","group_id":0},"score":333179,"extra":""},{"author":{"id":2873959,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/da/67/e18b690e.jpg","nickname":"神经蛙","note":"","ucode":"E0CE74B2363E10","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1015754,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","nickname":"helloworld","note":"","ucode":"00DF2FEC58D2E6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":610209,"discussion_content":"只需要迁移一半的数据考虑吧","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1679455569,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":333179,"ip_address":"北京","group_id":0},"score":610209,"extra":""}]}]},{"had_liked":false,"id":10875,"user_name":"面试官问","can_delete":false,"product_type":"c1","uid":1009375,"ip_address":"","ucode":"F9CE89589772F4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/66/df/501ba989.jpg","comment_is_top":false,"comment_ctime":1527730304,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":12,"product_id":100006601,"comment_content":"应该要对数据库做监控，在下面两种情况出现时，就要给出告警，架构师就要把分库分表提上日程：1）对数据库表做监控，根据具体业务场景，当表行数超过某个阈值时；2）对数据库查询等性能做监控，同样当时间超过某个阈值时。","like_count":4},{"had_liked":false,"id":10870,"user_name":"sea","can_delete":false,"product_type":"c1","uid":1099641,"ip_address":"","ucode":"0B39B3173FDF53","user_header":"https://static001.geekbang.org/account/avatar/00/10/c7/79/c24d50c8.jpg","comment_is_top":false,"comment_ctime":1527729715,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":12,"product_id":100006601,"comment_content":"请问配置路由具体如何实现呢？","like_count":3},{"had_liked":false,"id":128193,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1566861244,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":12,"product_id":100006601,"comment_content":"课前思考及问题\n1：啥是分库分表？\n单表数据量太大导致产生性能瓶颈，将一张表的数据在一个库分成N个表老来存储或者将一个表的数据分N个库来存储。好处是多表或多库来分担存储压力，确定是存储及查询更加复杂，分库后不能使用关联查询，需要自己拼接数据或使用数据库中间件代劳，另外，事务也是支持的不好，如果要支持的好性能又会受影响。\n\n课后思考及问题\n1：分库分表的原则？\n1-1：能不分就不分\n1-2：能优化就不分，优化包括硬件、业务、慢SQL\n1-3：先分表后分库，能不分库就不分\n1-4：为了查询性能，可以按不同维度多冗余数据\n1-5：根据具体业务来定，加缓存或结转能解决的性能问题也不需要分库分表\n1-6：分是为了分担压力，但会引入其他问题，所以扛得住就先不分，实在坑不住不得不分，分的时候注意分的维度和怎么在汇合数据\n嗯，挺好，受益匪浅，看实际业务需求吧！我们有几张大表(5百万+&#47;日)，只需保留最近三十天的数据在MySQL中，其他定期结转到大数据平台进行统计分析，就没做分库分表！","like_count":2},{"had_liked":false,"id":21122,"user_name":"lawlielt","can_delete":false,"product_type":"c1","uid":1058095,"ip_address":"","ucode":"709728A82C0667","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/2f/3266c0da.jpg","comment_is_top":false,"comment_ctime":1534929200,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":12,"product_id":100006601,"comment_content":"我们当前主要在框架层通过分析sql本身进行读写分离，同时针对主从延迟强制一定时间内都走主库。","like_count":2},{"had_liked":false,"id":311867,"user_name":"Drake敏","can_delete":false,"product_type":"c1","uid":2734734,"ip_address":"","ucode":"38366767EFDC90","user_header":"https://static001.geekbang.org/account/avatar/00/29/ba/8e/4645afae.jpg","comment_is_top":false,"comment_ctime":1631515866,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":12,"product_id":100006601,"comment_content":"个人感觉是性能上开始有瓶颈，就开始开始做分库分表而且肯定是业务量很大","like_count":1,"discussions":[{"author":{"id":2143502,"avatar":"","nickname":"Geek_691909","note":"","ucode":"D3C5BDBC3BECDC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":365377,"discussion_content":"时隔N年才看到这个架构的文章，对于这个问题，我觉得是不是可以参考java map的实现，使用扰动函数，让hash出来的结果更加均匀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617785068,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1083395,"avatar":"https://static001.geekbang.org/account/avatar/00/10/88/03/805c8e0e.jpg","nickname":"追忆似水年华","note":"","ucode":"FB6C3EDC6988B6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2476,"discussion_content":"hash路由前可以做MD5操作，且加入随机salt（时间），这样分布会不会更好些","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563694346,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":311553,"user_name":"啄米","can_delete":false,"product_type":"c1","uid":1108576,"ip_address":"","ucode":"5403F3F0809C7C","user_header":"https://static001.geekbang.org/account/avatar/00/10/ea/60/91610ae3.jpg","comment_is_top":false,"comment_ctime":1631281798,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":13,"product_id":100006601,"comment_content":"业务优化 -》sql优化（慢sql -》 索引优化） -》 缓存优化 -》分库分表（根据场景【是否为数据量】）","like_count":1},{"had_liked":false,"id":61641,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1547740864,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":13,"product_id":100006601,"comment_content":"今天算是复习了，分库分表。总结学习了","like_count":1},{"had_liked":false,"id":13830,"user_name":"at三月","can_delete":false,"product_type":"c1","uid":1146700,"ip_address":"","ucode":"DD59AE4EBE8271","user_header":"https://static001.geekbang.org/account/avatar/00/11/7f/4c/57ecb2de.jpg","comment_is_top":false,"comment_ctime":1530009840,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":13,"product_id":100006601,"comment_content":"想问下文中提到的单台数据库10万用户量级是指在线用户数10万相当的业务数据量级吗？（应该不是单表10万数据吧？）另外单库数据量级有官方文档说明吗？谢谢老师","like_count":1},{"had_liked":false,"id":10947,"user_name":"YMF_WX1981","can_delete":false,"product_type":"c1","uid":1123051,"ip_address":"","ucode":"8891A4C343D9FD","user_header":"https://static001.geekbang.org/account/avatar/00/11/22/eb/b580b80f.jpg","comment_is_top":false,"comment_ctime":1527759493,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":13,"product_id":100006601,"comment_content":"作为一个前端肯定没实操过，认为在业务类型和种类发展使得当前顶层设计不管从计算上或扩展上均不能实现业务，那就可分库分表了。","like_count":1},{"had_liked":false,"id":10872,"user_name":"Up","can_delete":false,"product_type":"c1","uid":1032969,"ip_address":"","ucode":"3AACE765021AB5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c3/09/ee1b7ac0.jpg","comment_is_top":false,"comment_ctime":1527729896,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":13,"product_id":100006601,"comment_content":"一般公司的系统都会有监控系统对系统各指标进行监控，所以我的思路是结合监控系统和业务指标做判断。这样有明确的数据做参考不仅判断更准确，而且能够提前预估，提前做应对决策。首先根据监控指标判断需要重构的业务点，然后分析性能点瓶颈是TPS还是QPS，如果TPS高再看业务点适合于分表还是分库。此时明确了业务点和需要解决性能点，这里完全可以复用老师架构设计的方法论了。","like_count":1},{"had_liked":false,"id":10842,"user_name":"Tom","can_delete":false,"product_type":"c1","uid":1109832,"ip_address":"","ucode":"00EEDE4CB11776","user_header":"","comment_is_top":false,"comment_ctime":1527727619,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":13,"product_id":100006601,"comment_content":"我的理解：预测压测，提前分表分库，预留实现的时间，出现性能时再实现会影响业务。","like_count":1},{"had_liked":false,"id":10824,"user_name":"贾盼龙","can_delete":false,"product_type":"c1","uid":1109359,"ip_address":"","ucode":"8D18ABFA26579E","user_header":"https://static001.geekbang.org/account/avatar/00/10/ed/6f/6e713ab6.jpg","comment_is_top":false,"comment_ctime":1527726611,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":13,"product_id":100006601,"comment_content":"分库分表进行查询排序的时候，如果结果集很大(十万级)，也都放在内存中进行排序吗？有没有开源的实现方案可以参考的？","like_count":1},{"had_liked":false,"id":10823,"user_name":"ChamPly","can_delete":false,"product_type":"c1","uid":1072432,"ip_address":"","ucode":"B7FA8EB8DD8CD5","user_header":"https://static001.geekbang.org/account/avatar/00/10/5d/30/a9d12bdb.jpg","comment_is_top":false,"comment_ctime":1527726587,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":13,"product_id":100006601,"comment_content":"我觉得应该是在预估的时候或者是压测的时候发现某个流程处理时常异常的时候就要考虑了。再问李老师一个问题，现在常用的mysql中间件有哪些推荐的呢？","like_count":1},{"had_liked":false,"id":10796,"user_name":"郭涛","can_delete":false,"product_type":"c1","uid":1085298,"ip_address":"","ucode":"238800B59497E0","user_header":"https://static001.geekbang.org/account/avatar/00/10/8f/72/8d7d872b.jpg","comment_is_top":false,"comment_ctime":1527723777,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":13,"product_id":100006601,"comment_content":"应该是在达到性能瓶颈前就要预估吧。","like_count":1},{"had_liked":false,"id":382851,"user_name":"Allan","can_delete":false,"product_type":"c1","uid":1310388,"ip_address":"中国香港","ucode":"8DA4DBECC2C45C","user_header":"https://static001.geekbang.org/account/avatar/00/13/fe/b4/295338e7.jpg","comment_is_top":false,"comment_ctime":1698119818,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":13,"product_id":100006601,"comment_content":"课后题：\n1、对于刚起步，肯定是先保证业务的正常运行。简单合适演化原则。\n2、根据业务的实际情况，我们做出计算，量级什么时候达到千万级别。通过压力测试，计算出业务库没有分库分表前的瓶颈。\n3、优化解决方案优先，硬件方案，引入中间件的方案进行对比\n4、根据前面的方案都满足了，然后再次基础量级别，优化方案都实施了。然后就要开始上分库分表了。我们在此之前把分库分表的方案设计出来，并且再次进行压力测试。等到业务实际情况达到了这个级别，我们直接就可以上分库分表了。","like_count":0},{"had_liked":false,"id":311553,"user_name":"啄米","can_delete":false,"product_type":"c1","uid":1108576,"ip_address":"","ucode":"5403F3F0809C7C","user_header":"https://static001.geekbang.org/account/avatar/00/10/ea/60/91610ae3.jpg","comment_is_top":false,"comment_ctime":1631281798,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":13,"product_id":100006601,"comment_content":"业务优化 -》sql优化（慢sql -》 索引优化） -》 缓存优化 -》分库分表（根据场景【是否为数据量】）","like_count":1},{"had_liked":false,"id":61641,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1547740864,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":13,"product_id":100006601,"comment_content":"今天算是复习了，分库分表。总结学习了","like_count":1},{"had_liked":false,"id":13830,"user_name":"at三月","can_delete":false,"product_type":"c1","uid":1146700,"ip_address":"","ucode":"DD59AE4EBE8271","user_header":"https://static001.geekbang.org/account/avatar/00/11/7f/4c/57ecb2de.jpg","comment_is_top":false,"comment_ctime":1530009840,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":13,"product_id":100006601,"comment_content":"想问下文中提到的单台数据库10万用户量级是指在线用户数10万相当的业务数据量级吗？（应该不是单表10万数据吧？）另外单库数据量级有官方文档说明吗？谢谢老师","like_count":1},{"had_liked":false,"id":10947,"user_name":"YMF_WX1981","can_delete":false,"product_type":"c1","uid":1123051,"ip_address":"","ucode":"8891A4C343D9FD","user_header":"https://static001.geekbang.org/account/avatar/00/11/22/eb/b580b80f.jpg","comment_is_top":false,"comment_ctime":1527759493,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":13,"product_id":100006601,"comment_content":"作为一个前端肯定没实操过，认为在业务类型和种类发展使得当前顶层设计不管从计算上或扩展上均不能实现业务，那就可分库分表了。","like_count":1},{"had_liked":false,"id":10872,"user_name":"Up","can_delete":false,"product_type":"c1","uid":1032969,"ip_address":"","ucode":"3AACE765021AB5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c3/09/ee1b7ac0.jpg","comment_is_top":false,"comment_ctime":1527729896,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":13,"product_id":100006601,"comment_content":"一般公司的系统都会有监控系统对系统各指标进行监控，所以我的思路是结合监控系统和业务指标做判断。这样有明确的数据做参考不仅判断更准确，而且能够提前预估，提前做应对决策。首先根据监控指标判断需要重构的业务点，然后分析性能点瓶颈是TPS还是QPS，如果TPS高再看业务点适合于分表还是分库。此时明确了业务点和需要解决性能点，这里完全可以复用老师架构设计的方法论了。","like_count":1},{"had_liked":false,"id":10842,"user_name":"Tom","can_delete":false,"product_type":"c1","uid":1109832,"ip_address":"","ucode":"00EEDE4CB11776","user_header":"","comment_is_top":false,"comment_ctime":1527727619,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":13,"product_id":100006601,"comment_content":"我的理解：预测压测，提前分表分库，预留实现的时间，出现性能时再实现会影响业务。","like_count":1},{"had_liked":false,"id":10824,"user_name":"贾盼龙","can_delete":false,"product_type":"c1","uid":1109359,"ip_address":"","ucode":"8D18ABFA26579E","user_header":"https://static001.geekbang.org/account/avatar/00/10/ed/6f/6e713ab6.jpg","comment_is_top":false,"comment_ctime":1527726611,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":13,"product_id":100006601,"comment_content":"分库分表进行查询排序的时候，如果结果集很大(十万级)，也都放在内存中进行排序吗？有没有开源的实现方案可以参考的？","like_count":1},{"had_liked":false,"id":10823,"user_name":"ChamPly","can_delete":false,"product_type":"c1","uid":1072432,"ip_address":"","ucode":"B7FA8EB8DD8CD5","user_header":"https://static001.geekbang.org/account/avatar/00/10/5d/30/a9d12bdb.jpg","comment_is_top":false,"comment_ctime":1527726587,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":13,"product_id":100006601,"comment_content":"我觉得应该是在预估的时候或者是压测的时候发现某个流程处理时常异常的时候就要考虑了。再问李老师一个问题，现在常用的mysql中间件有哪些推荐的呢？","like_count":1},{"had_liked":false,"id":10796,"user_name":"郭涛","can_delete":false,"product_type":"c1","uid":1085298,"ip_address":"","ucode":"238800B59497E0","user_header":"https://static001.geekbang.org/account/avatar/00/10/8f/72/8d7d872b.jpg","comment_is_top":false,"comment_ctime":1527723777,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":13,"product_id":100006601,"comment_content":"应该是在达到性能瓶颈前就要预估吧。","like_count":1},{"had_liked":false,"id":382851,"user_name":"Allan","can_delete":false,"product_type":"c1","uid":1310388,"ip_address":"中国香港","ucode":"8DA4DBECC2C45C","user_header":"https://static001.geekbang.org/account/avatar/00/13/fe/b4/295338e7.jpg","comment_is_top":false,"comment_ctime":1698119818,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":13,"product_id":100006601,"comment_content":"课后题：\n1、对于刚起步，肯定是先保证业务的正常运行。简单合适演化原则。\n2、根据业务的实际情况，我们做出计算，量级什么时候达到千万级别。通过压力测试，计算出业务库没有分库分表前的瓶颈。\n3、优化解决方案优先，硬件方案，引入中间件的方案进行对比\n4、根据前面的方案都满足了，然后再次基础量级别，优化方案都实施了。然后就要开始上分库分表了。我们在此之前把分库分表的方案设计出来，并且再次进行压力测试。等到业务实际情况达到了这个级别，我们直接就可以上分库分表了。","like_count":0},{"had_liked":false,"id":288021,"user_name":"雨飞Vee","can_delete":false,"product_type":"c1","uid":1199975,"ip_address":"","ucode":"8AC07868C30E24","user_header":"https://static001.geekbang.org/account/avatar/00/12/4f/67/6a7a7534.jpg","comment_is_top":false,"comment_ctime":1618276944,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":14,"product_id":100006601,"comment_content":"可以按照时间来分，把历史数据移植到历史库中。","like_count":0},{"had_liked":false,"id":257382,"user_name":"强","can_delete":false,"product_type":"c1","uid":1035643,"ip_address":"","ucode":"D0A761E25B0740","user_header":"https://static001.geekbang.org/account/avatar/00/0f/cd/7b/31a6bf42.jpg","comment_is_top":false,"comment_ctime":1603952212,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":14,"product_id":100006601,"comment_content":"数据库性能不够只是其中一点，例如：\n1. 如上文提到的，大型公司用户量本身就很大，在初始时就需要分库分表\n2. 在业务发展期间，用户量只增不降，也需要考虑分库分表","like_count":0},{"had_liked":false,"id":256727,"user_name":"kakakovic","can_delete":false,"product_type":"c1","uid":1112164,"ip_address":"","ucode":"ADE35A09D6A9EC","user_header":"https://static001.geekbang.org/account/avatar/00/10/f8/64/5f3634ef.jpg","comment_is_top":false,"comment_ctime":1603718312,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":14,"product_id":100006601,"comment_content":"水平分库分表的优点是对上层业务透明，垂直分库分表需要一些业务领域知识的指导。","like_count":0},{"had_liked":false,"id":219114,"user_name":"牺牲","can_delete":false,"product_type":"c1","uid":1619402,"ip_address":"","ucode":"5780E562A43494","user_header":"https://static001.geekbang.org/account/avatar/00/18/b5/ca/bba4d696.jpg","comment_is_top":false,"comment_ctime":1589946989,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":14,"product_id":100006601,"comment_content":"在数据快速增长是到时候，预测不久的将来数据库性能将会因为数据增长而下降。\n提前准备，而不是在性能已经受影响时。","like_count":0},{"had_liked":false,"id":213721,"user_name":"liupan","can_delete":false,"product_type":"c1","uid":1612910,"ip_address":"","ucode":"C6C7C48BCCAE12","user_header":"https://static001.geekbang.org/account/avatar/00/18/9c/6e/01b4d5d2.jpg","comment_is_top":false,"comment_ctime":1588520451,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":14,"product_id":100006601,"comment_content":"其实分库分表又带来各种问题，事务和多维度查询","like_count":0},{"had_liked":false,"id":183417,"user_name":"谭方敏","can_delete":false,"product_type":"c1","uid":1710960,"ip_address":"","ucode":"728DC7ECB7C902","user_header":"https://static001.geekbang.org/account/avatar/00/1a/1b/70/547042ee.jpg","comment_is_top":false,"comment_ctime":1583035719,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":14,"product_id":100006601,"comment_content":"分库分表一般在业务量比较大性能不足的时候，或者架构（比如单体架构到微服务架构）需要调整的时候，就显得比较重要了。\n就实现方式而已，自研方式会比较复杂，需要根据不同的分库分表方式针对原有的数据库原子操作进行业务模拟实现，比如分库时遇到的join问题和事务问题，垂直分表时遇到的join，count问题以及水平分表遇到的路由问题(hash路由，配置路由等)。\n中间件而已，可以用sharingsphere. \n分库分表适用于所有不同的数据库吧，这是用于提升服务器性能比较常用的方案了。","like_count":0},{"had_liked":false,"id":167927,"user_name":"技术修行者","can_delete":false,"product_type":"c1","uid":1013147,"ip_address":"","ucode":"28CA41A1214D6B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/75/9b/611e74ab.jpg","comment_is_top":false,"comment_ctime":1577965094,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":1,"score":14,"product_id":100006601,"comment_content":"分库分表是在读写分离后仍然无法满足性能要求后的进一步优化手段。\n分库分表优先解决的是数据存储的优化，将数据分到不同的服务器，从而降低每一台服务器的存储压力。\n\n优先考虑分库，其次是分表。\n\n分库一般按照业务要求，将不同的业务数据存储到不同的DB服务器上。\n如果分库以后，单表的存储压力还是很大，可以考虑分表，我们可以按照垂直或者水平方式进行分表。\n\n无论是分库还是分表，在解决存储压力的同时，也带来了问题：1) 复杂查询操作，例如 join、order或者count操作，2) 数据库事务处理。\n\n和读写分离一样，我们可以尝试用数据库访问中间件来处理和数据库的交互，不过这对中间件的复杂度要求高了很多。","like_count":0},{"had_liked":false,"id":140240,"user_name":"[故事有你]","can_delete":false,"product_type":"c1","uid":1315132,"ip_address":"","ucode":"F382E0391EBC8D","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/3c/ca25856f.jpg","comment_is_top":false,"comment_ctime":1570860388,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":14,"product_id":100006601,"comment_content":"现在可是试试TiDB，相信可以解决分库分表带来的问题。","like_count":0},{"had_liked":false,"id":128611,"user_name":"VIC","can_delete":false,"product_type":"c1","uid":1114064,"ip_address":"","ucode":"3B3E6D344488B2","user_header":"https://static001.geekbang.org/account/avatar/00/10/ff/d0/402be1e9.jpg","comment_is_top":false,"comment_ctime":1566913523,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":14,"product_id":100006601,"comment_content":"历史数据做迁移呢","like_count":0},{"had_liked":false,"id":119976,"user_name":"(╯‵□′)╯︵┻━┻","can_delete":false,"product_type":"c1","uid":1387589,"ip_address":"","ucode":"10A03AB1CB6B42","user_header":"https://static001.geekbang.org/account/avatar/00/15/2c/45/e8bcf142.jpg","comment_is_top":false,"comment_ctime":1564742810,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":14,"product_id":100006601,"comment_content":"设想回答：在资本或其他优化手段接近瓶颈，同时数据量超过分库分表最小适用量一个数量级之后；或者通常情况超过最小使用数据量半个量级之后。","like_count":0},{"had_liked":false,"id":288021,"user_name":"雨飞Vee","can_delete":false,"product_type":"c1","uid":1199975,"ip_address":"","ucode":"8AC07868C30E24","user_header":"https://static001.geekbang.org/account/avatar/00/12/4f/67/6a7a7534.jpg","comment_is_top":false,"comment_ctime":1618276944,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":14,"product_id":100006601,"comment_content":"可以按照时间来分，把历史数据移植到历史库中。","like_count":0},{"had_liked":false,"id":257382,"user_name":"强","can_delete":false,"product_type":"c1","uid":1035643,"ip_address":"","ucode":"D0A761E25B0740","user_header":"https://static001.geekbang.org/account/avatar/00/0f/cd/7b/31a6bf42.jpg","comment_is_top":false,"comment_ctime":1603952212,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":14,"product_id":100006601,"comment_content":"数据库性能不够只是其中一点，例如：\n1. 如上文提到的，大型公司用户量本身就很大，在初始时就需要分库分表\n2. 在业务发展期间，用户量只增不降，也需要考虑分库分表","like_count":0},{"had_liked":false,"id":256727,"user_name":"kakakovic","can_delete":false,"product_type":"c1","uid":1112164,"ip_address":"","ucode":"ADE35A09D6A9EC","user_header":"https://static001.geekbang.org/account/avatar/00/10/f8/64/5f3634ef.jpg","comment_is_top":false,"comment_ctime":1603718312,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":14,"product_id":100006601,"comment_content":"水平分库分表的优点是对上层业务透明，垂直分库分表需要一些业务领域知识的指导。","like_count":0},{"had_liked":false,"id":219114,"user_name":"牺牲","can_delete":false,"product_type":"c1","uid":1619402,"ip_address":"","ucode":"5780E562A43494","user_header":"https://static001.geekbang.org/account/avatar/00/18/b5/ca/bba4d696.jpg","comment_is_top":false,"comment_ctime":1589946989,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":14,"product_id":100006601,"comment_content":"在数据快速增长是到时候，预测不久的将来数据库性能将会因为数据增长而下降。\n提前准备，而不是在性能已经受影响时。","like_count":0},{"had_liked":false,"id":213721,"user_name":"liupan","can_delete":false,"product_type":"c1","uid":1612910,"ip_address":"","ucode":"C6C7C48BCCAE12","user_header":"https://static001.geekbang.org/account/avatar/00/18/9c/6e/01b4d5d2.jpg","comment_is_top":false,"comment_ctime":1588520451,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":14,"product_id":100006601,"comment_content":"其实分库分表又带来各种问题，事务和多维度查询","like_count":0},{"had_liked":false,"id":183417,"user_name":"谭方敏","can_delete":false,"product_type":"c1","uid":1710960,"ip_address":"","ucode":"728DC7ECB7C902","user_header":"https://static001.geekbang.org/account/avatar/00/1a/1b/70/547042ee.jpg","comment_is_top":false,"comment_ctime":1583035719,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":14,"product_id":100006601,"comment_content":"分库分表一般在业务量比较大性能不足的时候，或者架构（比如单体架构到微服务架构）需要调整的时候，就显得比较重要了。\n就实现方式而已，自研方式会比较复杂，需要根据不同的分库分表方式针对原有的数据库原子操作进行业务模拟实现，比如分库时遇到的join问题和事务问题，垂直分表时遇到的join，count问题以及水平分表遇到的路由问题(hash路由，配置路由等)。\n中间件而已，可以用sharingsphere. \n分库分表适用于所有不同的数据库吧，这是用于提升服务器性能比较常用的方案了。","like_count":0},{"had_liked":false,"id":167927,"user_name":"技术修行者","can_delete":false,"product_type":"c1","uid":1013147,"ip_address":"","ucode":"28CA41A1214D6B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/75/9b/611e74ab.jpg","comment_is_top":false,"comment_ctime":1577965094,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":1,"score":14,"product_id":100006601,"comment_content":"分库分表是在读写分离后仍然无法满足性能要求后的进一步优化手段。\n分库分表优先解决的是数据存储的优化，将数据分到不同的服务器，从而降低每一台服务器的存储压力。\n\n优先考虑分库，其次是分表。\n\n分库一般按照业务要求，将不同的业务数据存储到不同的DB服务器上。\n如果分库以后，单表的存储压力还是很大，可以考虑分表，我们可以按照垂直或者水平方式进行分表。\n\n无论是分库还是分表，在解决存储压力的同时，也带来了问题：1) 复杂查询操作，例如 join、order或者count操作，2) 数据库事务处理。\n\n和读写分离一样，我们可以尝试用数据库访问中间件来处理和数据库的交互，不过这对中间件的复杂度要求高了很多。","like_count":0},{"had_liked":false,"id":140240,"user_name":"[故事有你]","can_delete":false,"product_type":"c1","uid":1315132,"ip_address":"","ucode":"F382E0391EBC8D","user_header":"https://static001.geekbang.org/account/avatar/00/14/11/3c/ca25856f.jpg","comment_is_top":false,"comment_ctime":1570860388,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":14,"product_id":100006601,"comment_content":"现在可是试试TiDB，相信可以解决分库分表带来的问题。","like_count":0},{"had_liked":false,"id":128611,"user_name":"VIC","can_delete":false,"product_type":"c1","uid":1114064,"ip_address":"","ucode":"3B3E6D344488B2","user_header":"https://static001.geekbang.org/account/avatar/00/10/ff/d0/402be1e9.jpg","comment_is_top":false,"comment_ctime":1566913523,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":14,"product_id":100006601,"comment_content":"历史数据做迁移呢","like_count":0},{"had_liked":false,"id":119976,"user_name":"(╯‵□′)╯︵┻━┻","can_delete":false,"product_type":"c1","uid":1387589,"ip_address":"","ucode":"10A03AB1CB6B42","user_header":"https://static001.geekbang.org/account/avatar/00/15/2c/45/e8bcf142.jpg","comment_is_top":false,"comment_ctime":1564742810,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":14,"product_id":100006601,"comment_content":"设想回答：在资本或其他优化手段接近瓶颈，同时数据量超过分库分表最小适用量一个数量级之后；或者通常情况超过最小使用数据量半个量级之后。","like_count":0},{"had_liked":false,"id":83014,"user_name":"忍者无敌1995","can_delete":false,"product_type":"c1","uid":1027584,"ip_address":"","ucode":"F461B61BE06131","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ae/00/791d0f5e.jpg","comment_is_top":false,"comment_ctime":1554372417,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":15,"product_id":100006601,"comment_content":"在预估到未来不长的时间内，数据量会增大很多，导致单库数据量过大时","like_count":0},{"had_liked":false,"id":79189,"user_name":"brandi","can_delete":false,"product_type":"c1","uid":1021580,"ip_address":"","ucode":"6865D9BC3A9873","user_header":"https://static001.geekbang.org/account/avatar/00/0f/96/8c/36e0e383.jpg","comment_is_top":false,"comment_ctime":1553397726,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":15,"product_id":100006601,"comment_content":"相对于单库分表的复杂性，在数据库层面进行表分区方案应该更适合？！","like_count":0},{"had_liked":false,"id":79087,"user_name":"龙轼","can_delete":false,"product_type":"c1","uid":1001362,"ip_address":"","ucode":"51356D8AA606E3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/47/92/79828061.jpg","comment_is_top":false,"comment_ctime":1553348286,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":15,"product_id":100006601,"comment_content":"觉得TiDB可以很大程度解决这种问题","like_count":0},{"had_liked":false,"id":78440,"user_name":"@@fighting","can_delete":false,"product_type":"c1","uid":1236394,"ip_address":"","ucode":"7235C1E74549AE","user_header":"https://static001.geekbang.org/account/avatar/00/12/dd/aa/859544fd.jpg","comment_is_top":false,"comment_ctime":1553148165,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":15,"product_id":100006601,"comment_content":"分表直接采用mysql的分区表方案会不会简单些","like_count":0},{"had_liked":false,"id":72045,"user_name":"行者","can_delete":false,"product_type":"c1","uid":1063734,"ip_address":"","ucode":"EA31201A7C5AE1","user_header":"https://static001.geekbang.org/account/avatar/00/10/3b/36/2d61e080.jpg","comment_is_top":false,"comment_ctime":1551504975,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":15,"product_id":100006601,"comment_content":"基于简单原则，我会在其他方法都用过之后，缓存，逻辑优化 等；再考虑分库分表，因为分库分表代价是很高的，架构需要做很大的调整。","like_count":0},{"had_liked":false,"id":50901,"user_name":"波波","can_delete":false,"product_type":"c1","uid":1267681,"ip_address":"","ucode":"E8C96527676468","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/e1/7a5327f5.jpg","comment_is_top":false,"comment_ctime":1545062835,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":15,"product_id":100006601,"comment_content":"有分库的案例吗？","like_count":0},{"had_liked":false,"id":50900,"user_name":"波波","can_delete":false,"product_type":"c1","uid":1267681,"ip_address":"","ucode":"E8C96527676468","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/e1/7a5327f5.jpg","comment_is_top":false,"comment_ctime":1545062739,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":15,"product_id":100006601,"comment_content":"我以前一个项目，日志太大，就做了个分表，我是按照年来分表的，查询不允许跨年。","like_count":0},{"had_liked":false,"id":35876,"user_name":"佳","can_delete":false,"product_type":"c1","uid":1263049,"ip_address":"","ucode":"F25D82CC74A76D","user_header":"https://static001.geekbang.org/account/avatar/00/13/45/c9/a4f7054f.jpg","comment_is_top":false,"comment_ctime":1540827888,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":15,"product_id":100006601,"comment_content":"如果在单台服务器利用缓存，数据库调优，代码调优等各种情况下，单台服务器还是达到了性能瓶颈的情况下，在引入多台服务器进行负载均衡的情况下，也没有得到性能显著提升的效果，这时就要考虑是否要进行分库或者分表操作！","like_count":0},{"had_liked":false,"id":28891,"user_name":"func","can_delete":false,"product_type":"c1","uid":1254534,"ip_address":"","ucode":"481018617F42D8","user_header":"https://static001.geekbang.org/account/avatar/00/13/24/86/6069f169.jpg","comment_is_top":false,"comment_ctime":1538188298,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":15,"product_id":100006601,"comment_content":"应该对面临的问题说出具体的解决方案和实现方法","like_count":0},{"had_liked":false,"id":22538,"user_name":"香芋","can_delete":false,"product_type":"c1","uid":1206040,"ip_address":"","ucode":"18E7C0B569E877","user_header":"https://static001.geekbang.org/account/avatar/00/12/67/18/15ee52b7.jpg","comment_is_top":false,"comment_ctime":1535774979,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":15,"product_id":100006601,"comment_content":"什么时候引入分库分表比较合适？\n目前需要还没有接触过这么大的数据量。个人认为应当对业务发展做一个预估。\n例如用户表，计算用户平均增长速度，在达到瓶颈的之前就开始进行分表。\n","like_count":0},{"had_liked":false,"id":83014,"user_name":"忍者无敌1995","can_delete":false,"product_type":"c1","uid":1027584,"ip_address":"","ucode":"F461B61BE06131","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ae/00/791d0f5e.jpg","comment_is_top":false,"comment_ctime":1554372417,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":15,"product_id":100006601,"comment_content":"在预估到未来不长的时间内，数据量会增大很多，导致单库数据量过大时","like_count":0},{"had_liked":false,"id":79189,"user_name":"brandi","can_delete":false,"product_type":"c1","uid":1021580,"ip_address":"","ucode":"6865D9BC3A9873","user_header":"https://static001.geekbang.org/account/avatar/00/0f/96/8c/36e0e383.jpg","comment_is_top":false,"comment_ctime":1553397726,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":15,"product_id":100006601,"comment_content":"相对于单库分表的复杂性，在数据库层面进行表分区方案应该更适合？！","like_count":0},{"had_liked":false,"id":79087,"user_name":"龙轼","can_delete":false,"product_type":"c1","uid":1001362,"ip_address":"","ucode":"51356D8AA606E3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/47/92/79828061.jpg","comment_is_top":false,"comment_ctime":1553348286,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":15,"product_id":100006601,"comment_content":"觉得TiDB可以很大程度解决这种问题","like_count":0},{"had_liked":false,"id":78440,"user_name":"@@fighting","can_delete":false,"product_type":"c1","uid":1236394,"ip_address":"","ucode":"7235C1E74549AE","user_header":"https://static001.geekbang.org/account/avatar/00/12/dd/aa/859544fd.jpg","comment_is_top":false,"comment_ctime":1553148165,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":15,"product_id":100006601,"comment_content":"分表直接采用mysql的分区表方案会不会简单些","like_count":0},{"had_liked":false,"id":72045,"user_name":"行者","can_delete":false,"product_type":"c1","uid":1063734,"ip_address":"","ucode":"EA31201A7C5AE1","user_header":"https://static001.geekbang.org/account/avatar/00/10/3b/36/2d61e080.jpg","comment_is_top":false,"comment_ctime":1551504975,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":15,"product_id":100006601,"comment_content":"基于简单原则，我会在其他方法都用过之后，缓存，逻辑优化 等；再考虑分库分表，因为分库分表代价是很高的，架构需要做很大的调整。","like_count":0},{"had_liked":false,"id":50901,"user_name":"波波","can_delete":false,"product_type":"c1","uid":1267681,"ip_address":"","ucode":"E8C96527676468","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/e1/7a5327f5.jpg","comment_is_top":false,"comment_ctime":1545062835,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":15,"product_id":100006601,"comment_content":"有分库的案例吗？","like_count":0},{"had_liked":false,"id":50900,"user_name":"波波","can_delete":false,"product_type":"c1","uid":1267681,"ip_address":"","ucode":"E8C96527676468","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/e1/7a5327f5.jpg","comment_is_top":false,"comment_ctime":1545062739,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":15,"product_id":100006601,"comment_content":"我以前一个项目，日志太大，就做了个分表，我是按照年来分表的，查询不允许跨年。","like_count":0},{"had_liked":false,"id":35876,"user_name":"佳","can_delete":false,"product_type":"c1","uid":1263049,"ip_address":"","ucode":"F25D82CC74A76D","user_header":"https://static001.geekbang.org/account/avatar/00/13/45/c9/a4f7054f.jpg","comment_is_top":false,"comment_ctime":1540827888,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":15,"product_id":100006601,"comment_content":"如果在单台服务器利用缓存，数据库调优，代码调优等各种情况下，单台服务器还是达到了性能瓶颈的情况下，在引入多台服务器进行负载均衡的情况下，也没有得到性能显著提升的效果，这时就要考虑是否要进行分库或者分表操作！","like_count":0},{"had_liked":false,"id":28891,"user_name":"func","can_delete":false,"product_type":"c1","uid":1254534,"ip_address":"","ucode":"481018617F42D8","user_header":"https://static001.geekbang.org/account/avatar/00/13/24/86/6069f169.jpg","comment_is_top":false,"comment_ctime":1538188298,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":15,"product_id":100006601,"comment_content":"应该对面临的问题说出具体的解决方案和实现方法","like_count":0},{"had_liked":false,"id":22538,"user_name":"香芋","can_delete":false,"product_type":"c1","uid":1206040,"ip_address":"","ucode":"18E7C0B569E877","user_header":"https://static001.geekbang.org/account/avatar/00/12/67/18/15ee52b7.jpg","comment_is_top":false,"comment_ctime":1535774979,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":15,"product_id":100006601,"comment_content":"什么时候引入分库分表比较合适？\n目前需要还没有接触过这么大的数据量。个人认为应当对业务发展做一个预估。\n例如用户表，计算用户平均增长速度，在达到瓶颈的之前就开始进行分表。\n","like_count":0},{"had_liked":false,"id":19279,"user_name":"文竹","can_delete":false,"product_type":"c1","uid":1103167,"ip_address":"","ucode":"74413B1975976B","user_header":"https://static001.geekbang.org/account/avatar/00/10/d5/3f/80bf4841.jpg","comment_is_top":false,"comment_ctime":1533744810,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":16,"product_id":100006601,"comment_content":"分裤分表最终解决的问题是高性能。如果业务发展到一定规模后，单台服务器的性能成为瓶颈，就可采用分裤；单个表的性能成为瓶颈，就可采用分表。","like_count":0},{"had_liked":false,"id":15885,"user_name":"Marx","can_delete":false,"product_type":"c1","uid":1029143,"ip_address":"","ucode":"1506FEA531551E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b4/17/0b5aad57.jpg","comment_is_top":false,"comment_ctime":1531613964,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":16,"product_id":100006601,"comment_content":"能不能详细讲讲水平分表有哪些场景，应该考虑哪些因素？","like_count":0},{"had_liked":false,"id":13701,"user_name":"天平","can_delete":false,"product_type":"c1","uid":1069169,"ip_address":"","ucode":"7048983A67363A","user_header":"https://static001.geekbang.org/account/avatar/00/10/50/71/1339a9fe.jpg","comment_is_top":false,"comment_ctime":1529936172,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":16,"product_id":100006601,"comment_content":"请教下，toc的业务分库分表了，公司内部系统tob的业务怎么解决查询多个库中表数据问题？","like_count":0},{"had_liked":false,"id":12168,"user_name":"子悠","can_delete":false,"product_type":"c1","uid":1000383,"ip_address":"","ucode":"070BB09477E8A8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/43/bf/9a982bc1.jpg","comment_is_top":false,"comment_ctime":1528631647,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":16,"product_id":100006601,"comment_content":"想知道业界有没有什么中间件可以方便解决这类问题\n","like_count":0},{"had_liked":false,"id":11865,"user_name":"食指可爱多","can_delete":false,"product_type":"c1","uid":1045721,"ip_address":"","ucode":"B918E07F55AB9E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f4/d9/e572ae4d.jpg","comment_is_top":false,"comment_ctime":1528416982,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":16,"product_id":100006601,"comment_content":"我的理解分库分表是在数据库容量到了瓶颈（通常此时也会联动出现性能问题）时才需要引入，若数据量不够大，此时出现性能问题应从当前数据库、应用层优化开始。","like_count":0},{"had_liked":false,"id":11288,"user_name":"itperson","can_delete":false,"product_type":"c1","uid":1008401,"ip_address":"","ucode":"1363D71C84CF8B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/63/11/ea921534.jpg","comment_is_top":false,"comment_ctime":1528033263,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":16,"product_id":100006601,"comment_content":"应该有一个具体规则 根据服务器配置不同 分库分表的具体条件也会有一定的差异 首先可以做技术储备 在刚开始不必分局分表 当业务迅速发展时提前预见 ","like_count":0},{"had_liked":false,"id":11269,"user_name":"性能","can_delete":false,"product_type":"c1","uid":1137192,"ip_address":"","ucode":"BBFA2A31B02B8F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIyhbzdkFM64HvRATbWjc3hkic7icUszl9hU9hpIMZcibKH4wWam4SHfkcvM7MUoKjGDRrvYGXuvR91Q/132","comment_is_top":false,"comment_ctime":1528014342,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":16,"product_id":100006601,"comment_content":"单表数据量很大，并且读写都很多的话，应该做数据清理啊。将流水类的数据清理到专门的读数据库或者大数据平台做查询，保证单表数据量不会太大。","like_count":0},{"had_liked":false,"id":10983,"user_name":"空档滑行","can_delete":false,"product_type":"c1","uid":1091611,"ip_address":"","ucode":"06A6A7F503FAA7","user_header":"https://static001.geekbang.org/account/avatar/00/10/a8/1b/ced1d171.jpg","comment_is_top":false,"comment_ctime":1527775257,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":16,"product_id":100006601,"comment_content":"1，分库分表的需求肯定是和优化需求一起出现的，当数据量大到通过常规的手段无法提高性能的时候需要考虑分库分表\n2，业务预估，业务快速发展过程中，通过预估大概可以判断到什么时间点左右会出现分库分表的需求，提前做好准备。","like_count":0},{"had_liked":false,"id":10965,"user_name":"王磊","can_delete":false,"product_type":"c1","uid":1050085,"ip_address":"","ucode":"A4DE9804642A08","user_header":"https://static001.geekbang.org/account/avatar/00/10/05/e5/aa579968.jpg","comment_is_top":false,"comment_ctime":1527767292,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":16,"product_id":100006601,"comment_content":"在分表和分库之间，是否还可以通过schema(如默认是public)来分散数据，好处是表名(分表不能同名)可以相同，可以通过schema.table的方式出现在一条sql内进行join操作(分库不能join)。","like_count":0},{"had_liked":false,"id":10890,"user_name":"大光头","can_delete":false,"product_type":"c1","uid":1041792,"ip_address":"","ucode":"8EF797AFD1E27C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eo3DrWeV7ZwRLXrRZg4V3ic1LQYdZ3u1oicDhqPic47vMguvf5QS69roTiaJrwDr5Re3Sy2UyHDWwmsTA/132","comment_is_top":false,"comment_ctime":1527732221,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":16,"product_id":100006601,"comment_content":"一般不应该轻易分库分表，因为引入复杂度更大，首先应该应该从sql语句出发，优化sql写法，或者是否可以降低耗时比较大sql的频次","like_count":0},{"had_liked":false,"id":19279,"user_name":"文竹","can_delete":false,"product_type":"c1","uid":1103167,"ip_address":"","ucode":"74413B1975976B","user_header":"https://static001.geekbang.org/account/avatar/00/10/d5/3f/80bf4841.jpg","comment_is_top":false,"comment_ctime":1533744810,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":16,"product_id":100006601,"comment_content":"分裤分表最终解决的问题是高性能。如果业务发展到一定规模后，单台服务器的性能成为瓶颈，就可采用分裤；单个表的性能成为瓶颈，就可采用分表。","like_count":0},{"had_liked":false,"id":15885,"user_name":"Marx","can_delete":false,"product_type":"c1","uid":1029143,"ip_address":"","ucode":"1506FEA531551E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b4/17/0b5aad57.jpg","comment_is_top":false,"comment_ctime":1531613964,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":16,"product_id":100006601,"comment_content":"能不能详细讲讲水平分表有哪些场景，应该考虑哪些因素？","like_count":0},{"had_liked":false,"id":13701,"user_name":"天平","can_delete":false,"product_type":"c1","uid":1069169,"ip_address":"","ucode":"7048983A67363A","user_header":"https://static001.geekbang.org/account/avatar/00/10/50/71/1339a9fe.jpg","comment_is_top":false,"comment_ctime":1529936172,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":16,"product_id":100006601,"comment_content":"请教下，toc的业务分库分表了，公司内部系统tob的业务怎么解决查询多个库中表数据问题？","like_count":0},{"had_liked":false,"id":12168,"user_name":"子悠","can_delete":false,"product_type":"c1","uid":1000383,"ip_address":"","ucode":"070BB09477E8A8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/43/bf/9a982bc1.jpg","comment_is_top":false,"comment_ctime":1528631647,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":16,"product_id":100006601,"comment_content":"想知道业界有没有什么中间件可以方便解决这类问题\n","like_count":0},{"had_liked":false,"id":11865,"user_name":"食指可爱多","can_delete":false,"product_type":"c1","uid":1045721,"ip_address":"","ucode":"B918E07F55AB9E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f4/d9/e572ae4d.jpg","comment_is_top":false,"comment_ctime":1528416982,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":16,"product_id":100006601,"comment_content":"我的理解分库分表是在数据库容量到了瓶颈（通常此时也会联动出现性能问题）时才需要引入，若数据量不够大，此时出现性能问题应从当前数据库、应用层优化开始。","like_count":0},{"had_liked":false,"id":11288,"user_name":"itperson","can_delete":false,"product_type":"c1","uid":1008401,"ip_address":"","ucode":"1363D71C84CF8B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/63/11/ea921534.jpg","comment_is_top":false,"comment_ctime":1528033263,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":16,"product_id":100006601,"comment_content":"应该有一个具体规则 根据服务器配置不同 分库分表的具体条件也会有一定的差异 首先可以做技术储备 在刚开始不必分局分表 当业务迅速发展时提前预见 ","like_count":0},{"had_liked":false,"id":11269,"user_name":"性能","can_delete":false,"product_type":"c1","uid":1137192,"ip_address":"","ucode":"BBFA2A31B02B8F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIyhbzdkFM64HvRATbWjc3hkic7icUszl9hU9hpIMZcibKH4wWam4SHfkcvM7MUoKjGDRrvYGXuvR91Q/132","comment_is_top":false,"comment_ctime":1528014342,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":16,"product_id":100006601,"comment_content":"单表数据量很大，并且读写都很多的话，应该做数据清理啊。将流水类的数据清理到专门的读数据库或者大数据平台做查询，保证单表数据量不会太大。","like_count":0},{"had_liked":false,"id":10983,"user_name":"空档滑行","can_delete":false,"product_type":"c1","uid":1091611,"ip_address":"","ucode":"06A6A7F503FAA7","user_header":"https://static001.geekbang.org/account/avatar/00/10/a8/1b/ced1d171.jpg","comment_is_top":false,"comment_ctime":1527775257,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":16,"product_id":100006601,"comment_content":"1，分库分表的需求肯定是和优化需求一起出现的，当数据量大到通过常规的手段无法提高性能的时候需要考虑分库分表\n2，业务预估，业务快速发展过程中，通过预估大概可以判断到什么时间点左右会出现分库分表的需求，提前做好准备。","like_count":0},{"had_liked":false,"id":10965,"user_name":"王磊","can_delete":false,"product_type":"c1","uid":1050085,"ip_address":"","ucode":"A4DE9804642A08","user_header":"https://static001.geekbang.org/account/avatar/00/10/05/e5/aa579968.jpg","comment_is_top":false,"comment_ctime":1527767292,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":16,"product_id":100006601,"comment_content":"在分表和分库之间，是否还可以通过schema(如默认是public)来分散数据，好处是表名(分表不能同名)可以相同，可以通过schema.table的方式出现在一条sql内进行join操作(分库不能join)。","like_count":0},{"had_liked":false,"id":10890,"user_name":"大光头","can_delete":false,"product_type":"c1","uid":1041792,"ip_address":"","ucode":"8EF797AFD1E27C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eo3DrWeV7ZwRLXrRZg4V3ic1LQYdZ3u1oicDhqPic47vMguvf5QS69roTiaJrwDr5Re3Sy2UyHDWwmsTA/132","comment_is_top":false,"comment_ctime":1527732221,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":16,"product_id":100006601,"comment_content":"一般不应该轻易分库分表，因为引入复杂度更大，首先应该应该从sql语句出发，优化sql写法，或者是否可以降低耗时比较大sql的频次","like_count":0},{"had_liked":false,"id":10865,"user_name":"Regular","can_delete":false,"product_type":"c1","uid":1025998,"ip_address":"","ucode":"80B3EA083534CA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a7/ce/7ee0d672.jpg","comment_is_top":false,"comment_ctime":1527729387,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":17,"product_id":100006601,"comment_content":"先优化单机性能，如果还是不够，再上集群。这个问题是不是前面提到过…","like_count":0},{"had_liked":false,"id":10861,"user_name":"宇天飞","can_delete":false,"product_type":"c1","uid":1126444,"ip_address":"","ucode":"3FB37D1E2DAA61","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/2c/06375913.jpg","comment_is_top":false,"comment_ctime":1527729105,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":17,"product_id":100006601,"comment_content":"业务类型，当前体量，同产品规格预期，项目性能、容量要求","like_count":0},{"had_liked":false,"id":10845,"user_name":"Will","can_delete":false,"product_type":"c1","uid":1099269,"ip_address":"","ucode":"0867E5C288DDBF","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/05/2c55e929.jpg","comment_is_top":false,"comment_ctime":1527727816,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":17,"product_id":100006601,"comment_content":"根据业务、性能、资源的实际情况，综合评估是否需要进行分库分表。\n读来本篇主要看到了分库分表的复杂度，不过也确实存在这些问题。","like_count":0},{"had_liked":false,"id":10843,"user_name":"每天都在找小黄车","can_delete":false,"product_type":"c1","uid":1099779,"ip_address":"","ucode":"2CF9E3160B840B","user_header":"https://static001.geekbang.org/account/avatar/00/10/c8/03/1863b35e.jpg","comment_is_top":false,"comment_ctime":1527727700,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":17,"product_id":100006601,"comment_content":"当sql语句已经最大优化，但业务查询速度超过5秒，我觉得有必要分库分表了，互联网用户的体验对网页反应的速度越来越挑剔。","like_count":0},{"had_liked":false,"id":10840,"user_name":"LangK","can_delete":false,"product_type":"c1","uid":1111433,"ip_address":"","ucode":"9A70A794157E60","user_header":"https://static001.geekbang.org/account/avatar/00/10/f5/89/54dae837.jpg","comment_is_top":false,"comment_ctime":1527727462,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":17,"product_id":100006601,"comment_content":"分表这件事是个无休止的体力活，技术条件允许的话还是要在性能达到瓶颈时直接进行分库操作。使用微服务那一套进行架构重组，这是必然的系统演进结果。","like_count":0},{"had_liked":false,"id":10835,"user_name":"suncar","can_delete":false,"product_type":"c1","uid":1077735,"ip_address":"","ucode":"4BD3C9F1E7CA96","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJDhZkQGEnzjnu3dibxbRiblWIUjXXrXic0MStUS2ApKt5WiaoxV3IVhAtSXkknODA9oibick3NHic4Frzfw/0","comment_is_top":false,"comment_ctime":1527727130,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":17,"product_id":100006601,"comment_content":"分页操作，估计也得使用中间件比较方便吧","like_count":0},{"had_liked":false,"id":10833,"user_name":"张玮(大圣)","can_delete":false,"product_type":"c1","uid":1111343,"ip_address":"","ucode":"D567C4BE87D116","user_header":"https://static001.geekbang.org/account/avatar/00/10/f5/2f/56117bab.jpg","comment_is_top":false,"comment_ctime":1527727079,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":17,"product_id":100006601,"comment_content":"一般每个公司都有一套数据库规范，比如单表3000万时需要考虑分库分表，另外，成熟公司开始就需要预估数据规模。\n\n另外，分不分库表和分多少，除了需要经验判断，还需要依赖系统的一些指标来定，如数据量增长频率、TPS 、QPS 指标。","like_count":0},{"had_liked":false,"id":10829,"user_name":"sunny","can_delete":false,"product_type":"c1","uid":1107941,"ip_address":"","ucode":"51E95362C053F8","user_header":"https://static001.geekbang.org/account/avatar/00/10/e7/e5/fbf3fcd8.jpg","comment_is_top":false,"comment_ctime":1527726941,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":17,"product_id":100006601,"comment_content":"看当前体量。","like_count":0},{"had_liked":false,"id":10827,"user_name":"熊能","can_delete":false,"product_type":"c1","uid":1135024,"ip_address":"","ucode":"1019EA97062AC7","user_header":"https://static001.geekbang.org/account/avatar/00/11/51/b0/d32c895d.jpg","comment_is_top":false,"comment_ctime":1527726770,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":17,"product_id":100006601,"comment_content":"等业务量达到千万个级别，数据库存储成为主要性能瓶颈的时候","like_count":0},{"had_liked":false,"id":10865,"user_name":"Regular","can_delete":false,"product_type":"c1","uid":1025998,"ip_address":"","ucode":"80B3EA083534CA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a7/ce/7ee0d672.jpg","comment_is_top":false,"comment_ctime":1527729387,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":17,"product_id":100006601,"comment_content":"先优化单机性能，如果还是不够，再上集群。这个问题是不是前面提到过…","like_count":0},{"had_liked":false,"id":10861,"user_name":"宇天飞","can_delete":false,"product_type":"c1","uid":1126444,"ip_address":"","ucode":"3FB37D1E2DAA61","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/2c/06375913.jpg","comment_is_top":false,"comment_ctime":1527729105,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":17,"product_id":100006601,"comment_content":"业务类型，当前体量，同产品规格预期，项目性能、容量要求","like_count":0},{"had_liked":false,"id":10845,"user_name":"Will","can_delete":false,"product_type":"c1","uid":1099269,"ip_address":"","ucode":"0867E5C288DDBF","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/05/2c55e929.jpg","comment_is_top":false,"comment_ctime":1527727816,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":17,"product_id":100006601,"comment_content":"根据业务、性能、资源的实际情况，综合评估是否需要进行分库分表。\n读来本篇主要看到了分库分表的复杂度，不过也确实存在这些问题。","like_count":0},{"had_liked":false,"id":10843,"user_name":"每天都在找小黄车","can_delete":false,"product_type":"c1","uid":1099779,"ip_address":"","ucode":"2CF9E3160B840B","user_header":"https://static001.geekbang.org/account/avatar/00/10/c8/03/1863b35e.jpg","comment_is_top":false,"comment_ctime":1527727700,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":17,"product_id":100006601,"comment_content":"当sql语句已经最大优化，但业务查询速度超过5秒，我觉得有必要分库分表了，互联网用户的体验对网页反应的速度越来越挑剔。","like_count":0},{"had_liked":false,"id":10840,"user_name":"LangK","can_delete":false,"product_type":"c1","uid":1111433,"ip_address":"","ucode":"9A70A794157E60","user_header":"https://static001.geekbang.org/account/avatar/00/10/f5/89/54dae837.jpg","comment_is_top":false,"comment_ctime":1527727462,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":17,"product_id":100006601,"comment_content":"分表这件事是个无休止的体力活，技术条件允许的话还是要在性能达到瓶颈时直接进行分库操作。使用微服务那一套进行架构重组，这是必然的系统演进结果。","like_count":0},{"had_liked":false,"id":10835,"user_name":"suncar","can_delete":false,"product_type":"c1","uid":1077735,"ip_address":"","ucode":"4BD3C9F1E7CA96","user_header":"https://wx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJDhZkQGEnzjnu3dibxbRiblWIUjXXrXic0MStUS2ApKt5WiaoxV3IVhAtSXkknODA9oibick3NHic4Frzfw/0","comment_is_top":false,"comment_ctime":1527727130,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":17,"product_id":100006601,"comment_content":"分页操作，估计也得使用中间件比较方便吧","like_count":0},{"had_liked":false,"id":10833,"user_name":"张玮(大圣)","can_delete":false,"product_type":"c1","uid":1111343,"ip_address":"","ucode":"D567C4BE87D116","user_header":"https://static001.geekbang.org/account/avatar/00/10/f5/2f/56117bab.jpg","comment_is_top":false,"comment_ctime":1527727079,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":17,"product_id":100006601,"comment_content":"一般每个公司都有一套数据库规范，比如单表3000万时需要考虑分库分表，另外，成熟公司开始就需要预估数据规模。\n\n另外，分不分库表和分多少，除了需要经验判断，还需要依赖系统的一些指标来定，如数据量增长频率、TPS 、QPS 指标。","like_count":0},{"had_liked":false,"id":10829,"user_name":"sunny","can_delete":false,"product_type":"c1","uid":1107941,"ip_address":"","ucode":"51E95362C053F8","user_header":"https://static001.geekbang.org/account/avatar/00/10/e7/e5/fbf3fcd8.jpg","comment_is_top":false,"comment_ctime":1527726941,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":17,"product_id":100006601,"comment_content":"看当前体量。","like_count":0},{"had_liked":false,"id":10827,"user_name":"熊能","can_delete":false,"product_type":"c1","uid":1135024,"ip_address":"","ucode":"1019EA97062AC7","user_header":"https://static001.geekbang.org/account/avatar/00/11/51/b0/d32c895d.jpg","comment_is_top":false,"comment_ctime":1527726770,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":17,"product_id":100006601,"comment_content":"等业务量达到千万个级别，数据库存储成为主要性能瓶颈的时候","like_count":0}]}