{"id":550393,"title":"08ï½œæ‰‹å†™CPUï¼ˆä¸‰ï¼‰ï¼šå¦‚ä½•å®ç°æŒ‡ä»¤æ‰§è¡Œæ¨¡å—ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯LMOSã€‚</p><p>ä¸Šä¸€èŠ‚è¯¾ï¼Œæˆ‘ä»¬å®Œæˆäº†CPUæµæ°´çº¿çš„æŒ‡ä»¤è¯‘ç æ¨¡å—è®¾è®¡ã€‚æˆ‘ä»¬ä¸€èµ·æ¢è®¨äº†RISC-VæŒ‡ä»¤æ˜¯å¦‚ä½•ç¿»è¯‘çš„ï¼Œè¿˜å­¦ä¼šäº†æå–ä¸åŒç±»å‹æŒ‡ä»¤ä¸­çš„ä¿¡æ¯ã€‚æœ€åæ ¹æ®æµæ°´çº¿çš„éœ€è¦ï¼Œæˆ‘ä»¬è®¾è®¡å‡ºäº†è¯‘ç æ§åˆ¶æ¨¡å—å’Œæ•°æ®é€šè·¯æ¨¡å—ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ©ç”¨è¯‘ç åçš„è¿™äº›ä¿¡æ¯ç»§ç»­è®¾è®¡æµæ°´çº¿çš„ä¸‹ä¸€çº§â€”â€”æ‰§è¡Œå•å…ƒã€‚æŒ‡ä»¤æ‰§è¡Œç®—æ˜¯CPUæµæ°´çº¿ä¸­æœ€å¤æ‚çš„ä¸€ä¸ªé˜¶æ®µäº†ï¼Œä¸è¿‡åˆ«æ‹…å¿ƒï¼Œç»è¿‡å‰é¢è¯¾ç¨‹çš„å‡†å¤‡ï¼Œæˆ‘ä»¬ä¸€å®šå¯ä»¥æå®šå®ƒã€‚</p><h2>CPUçš„æ‰§è¡Œæ¦‚è¿°</h2><p>å›é¡¾å‰é¢æˆ‘ä»¬å·²ç»è®¾è®¡å®Œæˆçš„CPUæµæ°´çº¿æ­¥éª¤ï¼š</p><p>1.å–æŒ‡æ¨¡å—æ ¹æ®ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰å¯»å€åˆ°æŒ‡ä»¤æ‰€åœ¨çš„å­˜å‚¨å•å…ƒï¼Œå¹¶ä»ä¸­å–å‡ºæŒ‡ä»¤ã€‚<br>\n2.è¯‘ç æ¨¡å—å¯¹å–å‡ºçš„æŒ‡ä»¤è¿›è¡Œç¿»è¯‘ï¼Œå¾—åˆ°åŠŸèƒ½ç ã€ç«‹å³æ•°ã€å¯„å­˜å™¨ç´¢å¼•ç­‰å­—æ®µï¼Œç„¶åæ ¹æ®æŸäº›å­—æ®µè¯»å–ä¸€ä¸ªæˆ–ä¸¤ä¸ªé€šç”¨å¯„å­˜å™¨çš„å€¼ã€‚</p><p>ç»è¿‡æµæ°´çº¿çš„è¿™ä¸¤ä¸ªæ­¥éª¤ä¹‹åï¼Œä¸‹ä¸€æ­¥å°±éœ€è¦æŠŠè¿™äº›æŒ‡ä»¤ä¿¡æ¯å‘é€ç»™æ‰§è¡Œå•å…ƒå»æ‰§è¡Œç›¸å…³æ“ä½œã€‚æ ¹æ®è¯‘ç ä¹‹åçš„æŒ‡ä»¤ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæŒ‡ä»¤åˆ†ä¸ºä¸‰ç±»ï¼Œåˆ†åˆ«æ˜¯ç®—æœ¯é€»è¾‘æŒ‡ä»¤ã€åˆ†æ”¯è·³è½¬æŒ‡ä»¤ã€å­˜å‚¨å™¨è®¿é—®æŒ‡ä»¤ã€‚</p><p><a href=\"https://time.geekbang.org/column/article/548002\">ä¸ŠèŠ‚è¯¾</a>æˆ‘ä»¬å·²ç»è¯¦ç»†è§£è¯»äº†RISC-VæŒ‡ä»¤é›†çš„æŒ‡ä»¤æ ¼å¼ï¼Œæ­£æ˜¯å› ä¸ºæ ¼å¼ä¸Šæ¯”è¾ƒç®€å•è€Œä¸”è§„æ•´ï¼Œæ‰€ä»¥ä¸åŒç±»åˆ«çš„æŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚è¿™æ ·ï¼ŒRISCæ‰§è¡Œå•å…ƒçš„ç”µè·¯ç»“æ„ç›¸æ¯”CISCå°±å¾—åˆ°äº†ç®€åŒ–ã€‚</p><p>æ‰€ä»¥åœ¨æŒ‡ä»¤æ‰§è¡Œé˜¶æ®µï¼Œä¸Šè¿°çš„è¿™ä¸‰ç±»æŒ‡ä»¤éƒ½èƒ½é€šè¿‡ALUè¿›è¡Œç›¸å…³æ“ä½œã€‚æ¯”å¦‚ï¼Œå­˜å‚¨è®¿é—®æŒ‡ä»¤ç”¨ALUè¿›è¡Œåœ°å€è®¡ç®—ï¼Œæ¡ä»¶åˆ†æ”¯è·³è½¬æŒ‡ä»¤ç”¨ALUè¿›è¡Œæ¡ä»¶æ¯”è¾ƒï¼Œç®—æœ¯é€»è¾‘æŒ‡ä»¤ç”¨ALUè¿›è¡Œé€»è¾‘è¿ç®—ã€‚</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/e3/28/e3548857ab073bb598f1dff35a245f28.jpg?wh=1920x1242\" alt=\"å›¾ç‰‡\"></p><p>ä¸Šå›¾å°±æ˜¯ALUæ¨¡å—çš„è®¾è®¡æ¡†å›¾ã€‚<strong>åœ¨ALUæ¨¡å—ä¸­ï¼ŒæŒ‡ä»¤å¯ä»¥åˆ†æˆä¸‰ç±»æ¥å¤„ç†ï¼šç¬¬ä¸€ç±»æ˜¯æ™®é€šçš„ALUæŒ‡ä»¤ï¼ŒåŒ…æ‹¬é€»è¾‘è¿ç®—ã€ç§»ä½æ“ä½œç­‰æŒ‡ä»¤ï¼›ç¬¬äºŒç±»æŒ‡ä»¤è´Ÿè´£å®Œæˆå­˜å‚¨å™¨è®¿é—®æŒ‡ä»¤Loadå’ŒStoreçš„åœ°å€ç”Ÿæˆå·¥ä½œï¼›ç¬¬ä¸‰ç±»æ˜¯è´Ÿè´£åˆ†æ”¯è·³è½¬æŒ‡ä»¤çš„ç»“æœè§£æå’Œæ‰§è¡Œã€‚</strong>è¿™å°±æ˜¯æµæ°´çº¿æ‰§è¡Œé˜¶æ®µçš„æ ¸å¿ƒæ¨¡å—ALUçš„è®¾è®¡æ€è·¯ã€‚</p><h2>æ‰§è¡Œæ§åˆ¶æ¨¡å—çš„è®¾è®¡</h2><p>æ ¹æ®ä¸ŠèŠ‚è¯¾è®¾è®¡çš„è¯‘ç æ¨¡å—ï¼Œæˆ‘ä»¬å·²ç»å¾—åˆ°äº†æŒ‡ä»¤çš„åŠŸèƒ½ç ã€ç«‹å³æ•°ã€å¯„å­˜å™¨ç´¢å¼•ç­‰å­—æ®µä¿¡æ¯ã€‚</p><p>ä½ æ˜¯å¦è¿˜è®°å¾—ï¼Ÿæˆ‘ä»¬åœ¨è¯‘ç æ¨¡å—é‡Œæ ¹æ®æŒ‡ä»¤çš„7ä½æ“ä½œç opcodeå­—æ®µï¼Œè¿˜äº§ç”Ÿäº†ä¸€ä¸ªALUæ‰§è¡Œçš„æŒ‡ä»¤æ§åˆ¶å­—æ®µaluCrtlOpã€‚è¿™æ­£æ˜¯ä¸Šæ–‡æåˆ°çš„ALUæ¨¡å—æŠŠæŒ‡ä»¤åˆ†æˆä¸‰ç±»æ‰§è¡Œçš„æ§åˆ¶ä¿¡å·ã€‚</p><p>å…·ä½“çš„ä¿¡å·ç¼–ç ï¼Œä½ å¯ä»¥å‚è€ƒåé¢çš„è¡¨æ ¼ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/43/be/43a64833c9d698e35697c7cb7c4d67be.jpg?wh=1920x710\" alt=\"å›¾ç‰‡\"></p><p>æ ¹æ®2ä½æ‰§è¡Œç±»å‹å­—æ®µaluCrtlOpï¼Œä»¥åŠæŒ‡ä»¤è¯‘ç å¾—åˆ°çš„æ“ä½œç funct7å’Œfunct3ï¼Œå°±å¯ä»¥è®¾è®¡æˆ‘ä»¬çš„æ‰§è¡Œæ§åˆ¶æ¨¡å—äº†ã€‚</p><p>ç»“åˆå‰é¢çš„è¡¨æ ¼ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ‰§è¡Œæ§åˆ¶æ¨¡å—å¦‚ä½•æ ¹æ®aluCrtlOpä¿¡å·åšåˆ¤æ–­ã€‚</p><p>å¦‚æœaluCrtlOpç­‰äºï¼ˆ00ï¼‰ï¼Œå¯¹åº”çš„æŒ‡ä»¤ç±»å‹å°±æ˜¯Loadå’ŒStoreæŒ‡ä»¤ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡åŠ æ³•è¿ç®—æ¥è®¡ç®—è®¿å­˜åœ°å€ï¼›å¦‚æœaluCrtlOpç­‰äºï¼ˆ01ï¼‰ï¼Œç›¸åº”çš„æŒ‡ä»¤ç±»å‹å°±æ˜¯ALUI/ALURï¼ŒåŒæ ·ä¹Ÿæ˜¯æ ¹æ®è¾“å…¥çš„funct7å’Œfunct3å­—æ®µå†³å®šæ‰§è¡Œå“ªäº›ç®—æœ¯è¿ç®—ï¼Œæ¯”å¦‚åŠ å‡è¿ç®—ã€ç§»ä½æ“ä½œç­‰ï¼›å¦‚æœç±»å‹å­—æ®µç­‰äºï¼ˆ10ï¼‰ï¼Œå°±å¯¹åº”ç€åˆ†æ”¯è·³è½¬æŒ‡ä»¤ï¼Œæµæ°´çº¿å°±ä¼šç›¸åº”å»å®Œæˆæ¡ä»¶åˆ†æ”¯çš„è§£æå·¥ä½œã€‚</p><p>è¡¨æ ¼æœ€åä¸€åˆ—ä½ å…ˆä¸ç”¨å…³æ³¨ï¼Œæ‰©å±•åŠŸèƒ½æ—¶æ‰å¯èƒ½ç”¨åˆ°ï¼Œè¿™é‡Œå…ˆå…³æ³¨å‰ä¸‰ç±»æƒ…å†µå³å¯ã€‚</p><p>å…·ä½“è®¾è®¡çš„Verilogä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-verilog\">module ALUCtrl (\n    input [2:0]  funct3,\n    input [6:0]  funct7,\n    input [1:0]  aluCtrlOp,\n    input        itype,\n    output reg [3:0] aluOp\n);\n    always @(*) begin\n      case(aluCtrlOp)\n        2'b00:  aluOp &lt;= `ALU_OP_ADD;           // Load/Store\n        2'b01:  begin\n          if(itype &amp; funct3[1:0] != 2'b01)\n            aluOp &lt;= {1'b0, funct3};\n          else\n            aluOp &lt;= {funct7[5], funct3};   // normal ALUI/ALUR\n        end\n        2'b10:  begin\n          case(funct3)                    // bxx\n            `BEQ_FUNCT3:  aluOp &lt;= `ALU_OP_EQ;\n            `BNE_FUNCT3:  aluOp &lt;= `ALU_OP_NEQ;\n            `BLT_FUNCT3:  aluOp &lt;= `ALU_OP_SLT;\n            `BGE_FUNCT3:  aluOp &lt;= `ALU_OP_GE;\n            `BLTU_FUNCT3: aluOp &lt;= `ALU_OP_SLTU;\n            `BGEU_FUNCT3: aluOp &lt;= `ALU_OP_GEU;\n            default:      aluOp &lt;= `ALU_OP_XXX;\n          endcase\n          end\n        default: aluOp &lt;= `ALU_OP_XXX;\n      endcase\n    end\nendmodule\n</code></pre><p>è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œå½“aluCtrlOpç­‰äºï¼ˆ01ï¼‰æ—¶ï¼Œéœ€è¦æ ¹æ®funct3å’Œfunct7äº§ç”ŸALUçš„æ“ä½œç ã€‚åœ¨å‰é¢çš„è¯‘ç æ¨¡å—ä¸­ï¼Œå·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†Iå‹æŒ‡ä»¤ç±»å‹çš„åˆ¤æ–­ä¿¡å·itypeã€‚å¦‚æœæ˜¯itypeä¿¡å·ç­‰äºâ€œ1â€ï¼Œæ“ä½œç ç›´æ¥ç”±funct3å’Œé«˜ä½è¡¥â€œ0â€ç»„æˆï¼›å¦‚æœä¸æ˜¯Iå‹æŒ‡ä»¤ï¼ŒALUæ“ä½œç åˆ™è¦ç”±funct3å’Œfunct7çš„ç¬¬äº”ä½ç»„æˆã€‚</p><p>æ ¹æ®ä¸Šè¿°çš„ä¸‰ç±»æŒ‡ä»¤ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ª4ä½çš„ALUæ“ä½œä¿¡å·aluOpï¼Œä¸ºåé¢çš„ALUæ¨¡å—åšç›¸å…³é€»è¾‘è¿è¡Œæä¾›æ“ä½œç ã€‚</p><h2>é€šç”¨å¯„å­˜å™¨</h2><p>åœ¨ALUæ¨¡å—å¼€å§‹æ‰§è¡Œè¿ç®—ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æå‰å®Œæˆä¸€ä¸ªæ“ä½œâ€”â€”è¯»å–é€šç”¨å¯„å­˜å™¨ã€‚åœ¨å‚ä¸ALUé€»è¾‘è¿ç®—çš„ä¸¤ä¸ªæ“ä½œæ•°ä¸­ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªæ¥è‡ªäºé€šç”¨å¯„å­˜å™¨ï¼Œå¦ä¸€ä¸ªå¯ä»¥æ¥è‡ªäºé€šç”¨å¯„å­˜å™¨æˆ–è€…æŒ‡ä»¤è‡ªå¸¦çš„ç«‹å³æ•°ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/12/d3/12b4de8b3f29f191fbd679439008acd3.jpg?wh=1920x1498\" alt=\"å›¾ç‰‡\"></p><p><img src=\"https://static001.geekbang.org/resource/image/2a/7d/2afc17e22ce4b29bb2c861ff33afb97d.jpg?wh=1920x330\" alt=\"å›¾ç‰‡\"></p><p>ç”±äºç¬¬ä¸ƒèŠ‚è¯¾æåˆ°çš„6ç§æŒ‡ä»¤ä¸­çš„Rå‹æŒ‡ä»¤æœ‰ä¸‰ä¸ªæ“ä½œæ•°ï¼Œåˆ†åˆ«å¯¹åº”äºä¸¤ä¸ªæºå¯„å­˜å™¨rs1å’Œrs2ï¼Œä»¥åŠä¸€ä¸ªç›®æ ‡å¯„å­˜å™¨rdã€‚ä¸€æ¡RæŒ‡ä»¤ç±»ä¼¼äºæœ‰ä¸‰ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œå¦‚addï¼ˆrdï¼Œrs1ï¼Œrs2ï¼‰ï¼Œå®Œæˆçš„åŠŸèƒ½å°±æ˜¯å…ˆè¯»å–rs1ã€rs2ä¸¤ä¸ªå‚æ•°ï¼Œç„¶åç›¸åŠ ï¼Œæœ€åæŠŠç»“æœå†™å…¥åˆ°rdå‚æ•°ä¸­ã€‚</p><p>å¯¹åº”åˆ°æ¯æ¡æŒ‡ä»¤ï¼Œåˆ™éœ€è¦ä»é€šç”¨å¯„å­˜å™¨æ¨¡å—ä¸­è¯»å–å…¶ä¸­ä¸¤ä¸ªå¯„å­˜å™¨ä¸­çš„æ•°æ®ï¼Œä¹‹åè¿˜è¦æŠŠè¿ç®—ç»“æœå†™å…¥å¦ä¸€ä¸ªé€šç”¨å¯„å­˜å™¨ã€‚æ¯è¯»å–ä¸€ä¸ªå¯„å­˜å™¨ï¼Œå°±éœ€è¦è¾“å…¥ä¸€ä¸ªå¯„å­˜å™¨ç´¢å¼•ï¼Œå¹¶è¾“å‡ºä¸€ä¸ªé€šç”¨å¯„å­˜å™¨ä¸­çš„å€¼ã€‚ä¸¤ä¸ªæ“ä½œæ•°å¯¹åº”çš„å¯„å­˜å™¨éœ€è¦åŒæ—¶è¯»å–ï¼Œæ‰€ä»¥<strong>é€šç”¨å¯„å­˜å™¨æ¨¡å—éœ€è¦ä¸¤ä¸ªè¯»åœ°å€æ¥å£å’Œä¸¤ä¸ªè¯»æ•°æ®è¾“å‡ºæ¥å£</strong>ã€‚</p><p>æ­¤å¤–ï¼Œå¤„äºæµæ°´çº¿ä¸Šçš„æŒ‡ä»¤æ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œåœ¨è¯»å–é€šç”¨å¯„å­˜å™¨çš„åŒæ—¶ï¼Œå¯èƒ½è¿˜éœ€è¦å†™å…¥æ•°æ®åˆ°é€šç”¨å¯„å­˜å™¨ï¼Œæ‰€ä»¥éœ€è¦<strong>ä¸€å¥—å†™åœ°å€å’Œå†™æ•°æ®æ¥å£</strong>ã€‚å› æ­¤ï¼Œé€šç”¨å¯„å­˜å™¨æ¨¡å—çš„è®¾è®¡æ¡†å›¾å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/a6/57/a67a8bf89580a4418287026580a2a557.jpg?wh=1805x1305\" alt=\"å›¾ç‰‡\"></p><p>æ ¹æ®ä¸Šè¿°çš„è®¾è®¡æ€è·¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¾è®¡å’Œå®ç°é€šç”¨å¯„å­˜å™¨ä»£ç äº†ã€‚</p><pre><code class=\"language-verilog\">module gen_regs (\n    input  clk,\n    input  reset,\n    input  wen,\n    input  [4:0] regRAddr1, regRAddr2, regWAddr,\n    input  [31:0] regWData,\n    output [31:0] regRData1,\n    output [31:0] regRData2\n);\n    integer ii;\n    reg [31:0] regs[31:0];\n\n    // write registers\n    always @(posedge clk or posedge reset) begin\n        if(reset) begin\n            for(ii=0; ii&lt;32; ii=ii+1)\n                regs[ii] &lt;= 32'b0;\n        end\n        else if(wen &amp; (|regWAddr)) \n                regs[regWAddr] &lt;= regWData;\n    end\n\n    // read registers\n    assign regRData1 = wen &amp; (regWAddr == regRAddr1) ? regWData\n                    : ((regRAddr1 != 5'b0) ? regs[regRAddr1] : 32'b0);\n    assign regRData2 = wen &amp; (regWAddr == regRAddr2) ? regWData\n                    : ((regRAddr2 != 5'b0) ? regs[regRAddr2] : 32'b0);\nendmodule\n</code></pre><p>è¿™é‡Œæ·»åŠ äº†ä¸€ä¸ªå†™æ§åˆ¶ä½¿èƒ½ä¿¡å·wenã€‚å› ä¸ºå†™å¯„å­˜å™¨æ˜¯è¾¹æ²¿è§¦å‘çš„ï¼Œåœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…å†™å…¥çš„å¯„å­˜å™¨æ•°æ®ï¼Œéœ€è¦åœ¨ä¸‹ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸæ‰èƒ½æŠŠå†™å…¥çš„æ•°æ®è¯»å–å‡ºæ¥ã€‚ä¸ºäº†æé«˜è¯»å†™æ•ˆç‡ï¼Œåœ¨å¯¹åŒä¸€ä¸ªå¯„å­˜å™¨è¿›è¡Œè¯»å†™æ—¶ï¼Œå¦‚æœå†™ä½¿èƒ½wenæœ‰æ•ˆï¼Œå°±ç›´æ¥æŠŠå†™å…¥å¯„å­˜å™¨çš„æ•°æ®é€ç»™è¯»æ•°æ®æ¥å£ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…ï¼Œè¯»å‡ºå½“å‰è¦å†™å…¥çš„å¯„å­˜å™¨æ•°æ®äº†ã€‚<br>\nä»å‰é¢çš„ç« èŠ‚ä¸­æˆ‘ä»¬çŸ¥é“ï¼Œé€šç”¨å¯„å­˜å™¨æ€»å…±æœ‰32ä¸ªï¼Œæ‰€ä»¥é€šç”¨å¯„å­˜å™¨æ¨¡å—ä¸Šçš„è¯»å†™åœ°å€éƒ½æ˜¯5ä½ï¼ˆ$2^{5}$=32ï¼‰ã€‚</p><p>å…¶ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªå¯„å­˜å™¨æ¯”è¾ƒç‰¹æ®Šï¼Œä»ä»£ç ä¸­ä¹Ÿå¯ä»¥çœ‹åˆ°å®ƒçš„ç‰¹æ®Šå¤„ç†ï¼Œå³<strong>è¯»åœ°å€regRAddr1 = 5â€™b0 æ—¶çš„å¯„å­˜å™¨</strong>ã€‚æˆ‘ä»¬æŠŠç¬¬ä¸€ä¸ªå¯„å­˜å™¨å«åš0å€¼å¯„å­˜å™¨ï¼Œå› ä¸ºåœ¨RISC-VæŒ‡ä»¤æ¶æ„ä¸­å°±è§„å®šå¥½äº†ï¼Œç¬¬ä¸€ä¸ªé€šç”¨å¯„å­˜å™¨å¿…é¡»ç¼–ç ä¸º0ï¼Œä¹Ÿå°±æ˜¯æŠŠå†™å…¥è¯¥å¯„å­˜å™¨çš„æ•°æ®å¿½ç•¥ï¼Œè€Œåœ¨è¯»å–æ—¶æ°¸è¿œè¾“å‡ºä¸º0ã€‚</p><h2>ALUæ¨¡å—è®¾è®¡</h2><p>å½“æ“ä½œç å’Œæ“ä½œæ•°éƒ½å‡†å¤‡å¥½åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹ALUæ¨¡å—çš„å®ç°äº†ã€‚</p><p>ä¸Šè¿°æ‰§è¡Œæ§åˆ¶æ¨¡å—æ ¹æ®ä¸‰ç±»æŒ‡ä»¤äº§ç”Ÿçš„ALUæ“ä½œä¿¡å·aluOpï¼Œåœ¨ALUæ¨¡å—å°±èƒ½ä»¥æ­¤ä¸ºä¾æ®ï¼Œæ‰§è¡Œç›¸åº”çš„è¿ç®—äº†ã€‚æ“ä½œç å¯¹åº”çš„ALUæ“ä½œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/22/38/22033f3e45836cce1a6c35a6def6e038.jpg?wh=1920x1457\" alt=\"å›¾ç‰‡\"></p><p>æ ¹æ®è¡¨æ ¼ä¸­çš„æ“ä½œç¼–ç å’Œå¯¹åº”çš„è¿è¡Œæ“ä½œï¼Œå¾ˆå®¹æ˜“å°±å¯ä»¥è®¾è®¡å‡ºALUæ¨¡å—ï¼Œå…·ä½“çš„è®¾è®¡ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-verilog\">\nmodule alu (\n  input  [31:0] alu_data1_i,\n  input  [31:0] alu_data2_i,\n  input  [ 3:0] alu_op_i,\n  output [31:0] alu_result_o\n);\n\n  reg  [31:0] result;\n  \n  wire [31:0] sum    = alu_data1_i + ((alu_op_i[3] | alu_op_i[1]) ? -alu_data2_i : alu_data2_i);\n  wire        neq    = |sum;\n  wire        cmp    = (alu_data1_i[31] == alu_data2_i[31]) ? sum[31]\n                     : alu_op_i[0] ? alu_data2_i[31] : alu_data1_i[31];\n  wire [ 4:0] shamt  = alu_data2_i[4:0];\n  wire [31:0] shin   = alu_op_i[2] ? alu_data1_i : reverse(alu_data1_i);\n  wire [32:0] shift  = {alu_op_i[3] &amp; shin[31], shin};\n  wire [32:0] shiftt = ($signed(shift) &gt;&gt;&gt; shamt);\n  wire [31:0] shiftr = shiftt[31:0];\n  wire [31:0] shiftl = reverse(shiftr);\n\n  always @(*) begin\n    case(alu_op_i)\n      `ALU_OP_ADD:    result &lt;= sum;\n      `ALU_OP_SUB:    result &lt;= sum;\n      `ALU_OP_SLL:    result &lt;= shiftl;\n      `ALU_OP_SLT:    result &lt;= cmp;\n      `ALU_OP_SLTU:   result &lt;= cmp;\n      `ALU_OP_XOR:    result &lt;= (alu_data1_i ^ alu_data2_i);\n      `ALU_OP_SRL:    result &lt;= shiftr;\n      `ALU_OP_SRA:    result &lt;= shiftr;\n      `ALU_OP_OR:     result &lt;= (alu_data1_i | alu_data2_i);\n      `ALU_OP_AND:    result &lt;= (alu_data1_i &amp; alu_data2_i);\n\n      `ALU_OP_EQ:     result &lt;= {31'b0, ~neq};\n      `ALU_OP_NEQ:    result &lt;= {31'b0, neq};\n      `ALU_OP_GE:     result &lt;= {31'b0, ~cmp};\n      `ALU_OP_GEU:    result &lt;= {31'b0, ~cmp};\n      default:        begin \n                      result &lt;= 32'b0; \n        end\n    endcase\n  end\n\n  function [31:0] reverse;\n    input [31:0] in;\n    integer i;\n    for(i=0; i&lt;32; i=i+1) begin\n      reverse[i] = in[31-i];\n    end\n  endfunction  \n\n  assign alu_result_o = result;\n\nendmodule\n</code></pre><p>åœ¨ä¸Šé¢çš„ALUæ¨¡å—ä»£ç ä¸­ï¼Œè¾“å…¥ä¿¡å·aluIn1å’ŒaluIn2åˆ†åˆ«æ˜¯æºæ“ä½œæ•°1å’Œæºæ“ä½œæ•°2ï¼Œä¿¡å·aluOpæ˜¯æ‰§è¡Œæ§åˆ¶æ¨¡å—äº§ç”Ÿçš„ALUè¿ç®—æ§åˆ¶ç ã€‚ALUçš„åŠŸèƒ½å°±æ˜¯æ ¹æ®è¿ç®—ç aluOpæ¥å®Œæˆä¸¤ä¸ªæºæ“ä½œæ•°çš„é€»è¾‘è¿ç®—ï¼Œå¹¶æŠŠç»“æœé€šè¿‡ä¿¡å·aluOutè¾“å‡ºã€‚</p><p>ALUæ¨¡å—çš„æ€»ä½“ä»£ç æ¯”è¾ƒç®€å•ï¼Œä½†é‡Œé¢è¿™æ®µä»£ç ï¼ˆç¬¬16è¡Œï½ç¬¬19è¡Œï¼‰ä¸å¥½ç†è§£ï¼Œåˆ«æ‹…å¿ƒï¼Œæˆ‘è¿™é‡Œä¸“é—¨æ‹¿å‡ºæ¥ç»™ä½ è®²ä¸€ä¸‹ã€‚</p><pre><code class=\"language-verilog\">  wire [31:0] sum    = aluIn1 + ((aluOp[3] | aluOp[1]) ? -aluIn2 : aluIn2);\n  wire        neq    = |sum;\n  wire        cmp    = (aluIn1[31] == aluIn2[31]) ? sum[31]\n                       : aluOp[0] ? aluIn2[31] : aluIn1[31];\n</code></pre><p>é¦–å…ˆï¼Œä»£ç ä¸­çš„sumä¿¡å·å…¶å®å°±æ˜¯ä¸¤ä¸ªæºæ“ä½œæ•°çš„å’Œï¼Œä¸è¿‡å½“è¿ç®—ç aluOpçš„ç¬¬3ä½å’Œç¬¬1ä½ä¸ºâ€œ1â€æ—¶åšçš„æ˜¯ç›¸å‡è¿ç®—ï¼Œè¿™æ˜¯ä¸ºå‡æ³•æŒ‡ä»¤æˆ–è€…åé¢çš„æ¯”è¾ƒå¤§å°è€Œå‡†å¤‡çš„è¿ç®—ã€‚ä½ å¯ä»¥å¯¹ç…§ä¸Šé¢çš„ALUè¿ç®—è¡¨æ ¼æ¥ç†è§£ã€‚</p><p>neqä¿¡å·è¡¨ç¤ºçš„æ˜¯æ¯”è¾ƒä¸¤ä¸ªæ“ä½œæ•°æ˜¯å¦ç›¸ç­‰ï¼Œè¿™å°±æ˜¯æ ¹æ®å‰é¢çš„ä¸¤ä¸ªæ“ä½œç›¸å‡çš„ç»“æœåˆ¤æ–­ï¼Œå¦‚æœå®ƒä»¬çš„å·®ä¸ä¸ºâ€œ0â€ï¼Œä¹Ÿå°±æ˜¯sumä¿¡å·æŒ‰ä½ä¸ä¹‹åä¸ä¸ºâ€œ0â€ï¼Œåˆ™è¡¨ç¤ºä¸¤ä¸ªæ“ä½œæ•°ä¸ç›¸ç­‰ã€‚</p><p>cmpä¿¡å·è¡¨ç¤ºä¸¤ä¸ªæ“ä½œæ•°çš„å¤§å°æ¯”è¾ƒï¼Œå¦‚æœå®ƒä»¬çš„æœ€é«˜ä½ï¼ˆä¹Ÿå°±æ˜¯ç¬¦å·ä½ï¼‰ç›¸ç­‰ï¼Œåˆ™æ ¹æ®ä¸¤ä¸ªæ“ä½œæ•°ç›¸å‡çš„å·®å€¼çš„ç¬¦å·ä½ï¼ˆä¹Ÿæ˜¯æ•°å€¼çš„æœ€é«˜ä½ï¼‰åˆ¤æ–­ã€‚å¦‚æœæ˜¯æ­£æ•°ï¼Œè¡¨ç¤ºæºæ“ä½œæ•°1å¤§äºæºæ“ä½œæ•°2ï¼Œå¦åˆ™è¡¨ç¤ºæºæ“ä½œæ•°1å°äºæºæ“ä½œæ•°2ã€‚</p><p>å¦‚æœå®ƒä»¬çš„æœ€é«˜ä½ä¸ç›¸ç­‰ï¼Œåˆ™æ ¹æ®ALUè¿ç®—æ§åˆ¶ç aluOpçš„æœ€ä½ä½åˆ¤æ–­ã€‚å¦‚æœaluOpæœ€ä½ä½ä¸ºâ€œ1â€ï¼Œè¡¨ç¤ºæ˜¯æ— ç¬¦å·æ•°æ¯”è¾ƒï¼Œç›´æ¥å–æ“ä½œæ•°2çš„æœ€é«˜ä½ä½œä¸ºæ¯”è¾ƒç»“æœã€‚å¦‚æœaluOpæœ€ä½ä½ä¸ºâ€œ0â€ï¼Œè¡¨ç¤ºæ˜¯æœ‰ç¬¦å·æ•°æ¯”è¾ƒï¼Œç›´æ¥å–æ“ä½œæ•°1çš„æœ€é«˜ä½ä½œä¸ºæ¯”è¾ƒç»“æœã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å†æ¥çœ‹çœ‹<strong>ç§»ä½æ“ä½œç›¸å…³çš„ä»£ç </strong>ï¼Œå…¶ä¸­çš„shamtä¿¡å·æ˜¯å–è‡ªæºæ“ä½œæ•°2çš„ä½äº”ä½ï¼Œè¡¨ç¤ºæºæ“ä½œæ•°1éœ€è¦ç§»å¤šå°‘ä½ï¼ˆ25=32ï¼‰ã€‚shinä¿¡å·æ˜¯å–å‡ºè¦ç§»ä½çš„æ•°å€¼ï¼Œæ ¹æ®aluOpåˆ¤æ–­æ˜¯å·¦ç§»è¿˜æ˜¯å³ç§»ï¼Œå¦‚æœæ˜¯å³ç§»å°±ç›´æ¥ç­‰äºæºæ“ä½œæ•°1ï¼Œå¦‚æœæ˜¯å·¦ç§»å°±å…ˆå¯¹æºæ“ä½œæ•°çš„å„ä½æ•°åšé•œåƒå¤„ç†ã€‚</p><p>shiftä¿¡å·æ˜¯æ ¹æ®aluOpåˆ¤æ–­æ˜¯ç®—æœ¯å³ç§»è¿˜æ˜¯é€»è¾‘å³ç§»ï¼Œå¦‚æœæ˜¯ç®—æœ¯å³ç§»ï¼Œåˆ™åœ¨æœ€é«˜ä½è¡¥ä¸€ä¸ªç¬¦å·ä½ã€‚shifttä¿¡å·æ˜¯å³ç§»ä¹‹åçš„ç»“æœï¼Œè¿™é‡Œç”¨åˆ°äº†<span dollar=\"\">$</span>signed()å‡½æ•°å¯¹ç§»ä½å‰çš„æ•°æ®shiftè¿›è¡Œäº†ä¿®é¥°ï¼Œ$signed()çš„ä½œç”¨æ˜¯å†³å®šå¦‚ä½•å¯¹æ“ä½œæ•°æ‰©ä½è¿™ä¸ªé—®é¢˜ã€‚</p><p>å…·ä½“çš„è¿‡ç¨‹æ˜¯ï¼Œåœ¨å³ç§»æ“ä½œå‰ï¼Œ$signed()å‡½æ•°å…ˆæŠŠæ“ä½œæ•°çš„ç¬¦å·ä½ï¼Œæ‰©ä½æˆè·Ÿç»“æœç›¸åŒçš„ä½å®½ï¼Œç„¶åå†è¿›è¡Œç§»ä½æ“ä½œï¼Œè€Œshiftrå°±æ˜¯å³ç§»åçš„ç»“æœã€‚</p><p>æˆ‘ä»¬å†ä¸“é—¨çœ‹çœ‹ALUæ¨¡å—ä»£ç çš„ç¬¬20è¡Œåˆ°ç¬¬25è¡Œï¼Œè¿™éƒ¨åˆ†ä¸»è¦ç”¨æ¥å®Œæˆç§»ä½æ“ä½œã€‚</p><pre><code class=\"language-verilog\">  wire [ 4:0] shamt  = aluIn2[4:0];\n  wire [31:0] shin   = aluOp[2] ? aluIn1 : reverse(aluIn1);\n  wire [32:0] shift  = {aluOp[3] &amp; shin[31], shin};\n  wire [32:0] shiftt = ($signed(shift) &gt;&gt;&gt; shamt);\n  wire [31:0] shiftr = shiftt[31:0];\n  wire [31:0] shiftl = reverse(shiftr);\n</code></pre><p>è¯·ä½ æ³¨æ„ï¼Œ<strong>å·¦ç§»çš„ç»“æœshiftlï¼Œæ˜¯ç”±å³ç§»åçš„ç»“æœè¿›è¡Œä½ç½®å–åå¾—åˆ°çš„</strong>ã€‚å› ä¸ºå¯¹äºéœ€è¦å·¦ç§»çš„æ“ä½œæ•°ï¼Œåœ¨å‰é¢å·²ç»åšäº†ä½ç½®å–åï¼Œæ‰€ä»¥ç§»ä½æ“ä½œæ—¶ä¹Ÿæ˜¯è¿›è¡Œå³ç§»å¤„ç†ï¼Œæœ€åæŠŠç»“æœå†ä¸€æ¬¡åšä½ç½®å–åå°±å¯ä»¥äº†ã€‚<br>\nå¥½äº†ï¼Œæ­å–œä½ èµ°åˆ°è¿™é‡Œï¼ŒCPUæµæ°´çº¿ä¸­æ‰§è¡Œé˜¶æ®µçš„å†…å®¹å°±å‘Šä¸€æ®µè½äº†ã€‚ä¸‹ä¸€èŠ‚è¯¾æˆ‘ä»¬ç»§ç»­å®Œæˆæµæ°´çº¿çš„è®¿å­˜æ¨¡å—çš„è®¾è®¡ã€‚</p><h2>é‡ç‚¹å›é¡¾</h2><p>è¿™èŠ‚è¯¾å‘Šä¸€æ®µè½ï¼Œæˆ‘æ¥ç»™ä½ åšä¸ªæ€»ç»“ã€‚</p><p>æŒ‡ä»¤æ‰§è¡Œç®—æ˜¯CPUæµæ°´çº¿ä¸­æœ€å¤æ‚çš„ä¸€ä¸ªé˜¶æ®µäº†ï¼Œéœ€è¦æˆ‘ä»¬æ…¢æ…¢æ¨å¯¼ï¼Œç»†ç»†æ€è€ƒï¼Œæ‰èƒ½ç†æ¸…æ¥šé‡Œé¢çš„é€»è¾‘å…³ç³»ã€‚è¿™èŠ‚è¯¾çš„å†…å®¹å’Œå‰é¢çš„ç¬¬äº”èŠ‚è¯¾åˆ°ç¬¬ä¸ƒèŠ‚è¯¾çš„çŸ¥è¯†å…³è”æ¯”è¾ƒå¤šï¼Œä¸æ‡‚çš„åœ°æ–¹ä½ å¯ä»¥å†å›å»çœ‹çœ‹ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬ä¸€èµ·æ¥å›é¡¾ä¸€ä¸‹ä»Šå¤©çš„é‡ç‚¹å†…å®¹ã€‚ä¸ºäº†å®ç°CPUçš„æŒ‡ä»¤æ‰§è¡Œæ¨¡å—ï¼Œæˆ‘ä»¬å…ˆæ¢³ç†äº†è®¾è®¡æ€è·¯ã€‚æˆ‘ä»¬æŠŠæŒ‡ä»¤åˆ†æˆé€»è¾‘è¿ç®—ã€å­˜å‚¨å™¨è®¿é—®ã€æ¡ä»¶åˆ†æ”¯åˆ¤æ–­è¿™ä¸‰ç±»æŒ‡ä»¤è¿›è¡Œå¤„ç†ã€‚è¿™ä¸‰ç±»æŒ‡ä»¤ç»è¿‡ALUæ‰§è¡Œç›¸å…³æ“ä½œä¹‹åï¼Œç»Ÿä¸€ç”±æ•°æ®é€šè·¯æ¥è¾“å‡ºç»“æœã€‚</p><p>æ¥ç€æˆ‘ä»¬è®¾è®¡äº†æ‰§è¡Œæ§åˆ¶æ¨¡å—ã€‚æ ¹æ®è¯‘ç æ¨¡å—é‡Œäº§ç”Ÿçš„æŒ‡ä»¤æ§åˆ¶å­—æ®µaluCrtlOpï¼Œæ‰§è¡Œæ§åˆ¶æ¨¡å—å¯ä»¥æ ¹æ®ä¸Šè¿°çš„ä¸‰ç±»æŒ‡ä»¤ï¼Œç›¸åº”äº§ç”Ÿä¸€ä¸ª4ä½çš„ALUæ“ä½œä¿¡å·aluOpï¼Œä¸ºåé¢çš„ALUæ¨¡å—æä¾›è¿ç®—æ‰§è¡Œç ã€‚</p><p>æ ¹æ®æŒ‡ä»¤åœ¨æµæ°´çº¿ä¸­æ‰§è¡Œæ—¶å¯¹é€šç”¨å¯„å­˜å™¨çš„è¯»å†™ç‰¹ç‚¹ï¼Œæˆ‘ä»¬ä¸º32ä¸ªé€šç”¨å¯„å­˜å™¨ç»„è®¾è®¡äº†<strong>ç”±ä¸¤ä¸ªå¥—è¯»æ¥å£å’Œä¸€å¥—å†™æ¥å£ç»„æˆçš„é€šç”¨å¯„å­˜å™¨æ¨¡å—ï¼Œè¿™ä¸‰å¥—æ¥å£å¯ä»¥æ”¯æŒå…¶ä»–æ¨¡å—å¯¹é€šç”¨å¯„å­˜å™¨è¿›è¡ŒåŒæ—¶è¯»å†™ã€‚</strong></p><p>æœ€åï¼Œæ ¹æ®æ‰§è¡Œæ§åˆ¶æ¨¡å—äº§ç”Ÿçš„ALUè¿ç®—æ§åˆ¶ä¿¡å·aluOpï¼Œæˆ‘ä»¬è®¾è®¡å‡ºäº†ALUæ¨¡å—ã€‚åœ¨ALUæ¨¡å—ä¸­ï¼Œå¯ä»¥å®ŒæˆåŠ å‡æ³•è®¡ç®—ï¼Œä¸¤ä¸ªæ“ä½œæ•°çš„å¤§å°æ¯”è¾ƒï¼Œæ“ä½œæ•°çš„å·¦ç§»å³ç§»ç­‰æ“ä½œã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/65/f0/6538fa1bc1829f2f24cf1197fb579ef0.jpg?wh=1920x1466\" alt=\"å›¾ç‰‡\"></p><p>å¦‚æœä½ æœ‰å…´è¶£çš„è¯ï¼Œå¯ä»¥å‚è€ƒå‰é¢RISC-VæŒ‡ä»¤æ¶æ„é‡Œåˆ—å‡ºçš„æŒ‡ä»¤ï¼Œè‡ªå·±è¯•è¯•å®ç°æ›´å¤šçš„æŒ‡ä»¤æ“ä½œã€‚ä¸‹èŠ‚è¯¾ï¼Œæˆ‘ä»¬ç»§ç»­æ¢ç´¢è®¿å­˜ç›¸å…³æ¨¡å—å¦‚ä½•è®¾è®¡å’Œå®ç°ï¼Œæ•¬è¯·æœŸå¾…ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>åœ¨ALUæ¨¡å—ä»£ç ä¸­ï¼Œä¸ºä»€ä¹ˆè¦æŠŠå·¦ç§»æ“ä½œè½¬æ¢ä¸ºå³ç§»è¿›è¡Œå¤„ç†ï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºè·Ÿæˆ‘äº¤æµè®¨è®ºï¼Œç§¯æå‚ä¸æ€è€ƒæœ‰åŠ©äºä½ æ·±åŒ–ç†è§£ã€‚å¦‚æœè§‰å¾—è¿™èŠ‚è¯¾è¿˜ä¸é”™ï¼Œåˆ«å¿˜äº†åˆ†äº«ç»™èº«è¾¹çš„æœ‹å‹ï¼Œé‚€ä»–è·Ÿä½ ä¸€èµ·æ‰‹å†™CPUï¼</p>","neighbors":{"left":{"article_title":"07ï½œæ‰‹å†™CPUï¼ˆäºŒï¼‰ï¼šå¦‚ä½•å®ç°æŒ‡ä»¤è¯‘ç æ¨¡å—ï¼Ÿ","id":548002},"right":{"article_title":"09ï½œæ‰‹å†™CPUï¼ˆå››ï¼‰ï¼šå¦‚ä½•å®ç°CPUæµæ°´çº¿çš„è®¿å­˜é˜¶æ®µï¼Ÿ","id":550940}},"comments":[{"had_liked":false,"id":355109,"user_name":"Abcd","can_delete":false,"product_type":"c1","uid":1796908,"ip_address":"æ¹–åŒ—","ucode":"274C7487FDDC21","user_header":"https://static001.geekbang.org/account/avatar/00/1b/6b/2c/b27eefc5.jpg","comment_is_top":true,"comment_ctime":1661091533,"is_pvip":false,"replies":[{"id":"129455","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1345199","ctime":1661678467,"ip_address":"æ¹–åŒ—","comment_id":355109,"utype":1}],"discussion_count":1,"race_medal":0,"score":"9.2233720385159004e+18","product_id":100117801,"comment_content":"å·¦ç§»è¿ç®—å¤ç”¨å³ç§»è¿ç®—çš„ç”µè·¯ï¼Œä¹Ÿä½“ç°äº†RISCï¼Vç²¾ç®€çš„å“²å­¦ï¼šèƒ½å¤Ÿç”¨åŸºæœ¬çš„ç»„åˆå‡ºæ¥ï¼Œå°±ä¸åˆ›é€ æ–°çš„ç”µè·¯","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585575,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661678467,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¹–åŒ—"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354343,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"æ¹–åŒ—","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":true,"comment_ctime":1660292528,"is_pvip":true,"replies":[{"id":"128893","content":"input  [31:0] regWData,    å ç”¨32ä½ æ¯ä¸ªä½ä¸º0","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1345199","ctime":1660318669,"ip_address":"æ¹–åŒ—","comment_id":354343,"utype":1}],"discussion_count":2,"race_medal":0,"score":"9.2233720385150996e+18","product_id":100117801,"comment_content":"è¯·æ•™è€å¸ˆå‡ ä¸ªé—®é¢˜ï¼š<br>Q1ï¼š[31:0]ï¼Œä»€ä¹ˆæ„æ€ï¼Ÿ<br>input  [31:0] regWData,   æ˜¯è¯´regWDataå 31ä½ï¼Œæ¯ä¸€ä½æ˜¯0å—ï¼Ÿ<br>Q2ï¼šreg [31:0] regs[31:0];ï¼š è¿™æ¡è¯­å¥ä»€ä¹ˆæ„æ€ï¼Ÿ<br>Q3ï¼šregs[ii] &lt;= 32&#39;b0;   æ˜¯æŠŠ32&#39;b0å†™åˆ°regs[ii]å—ï¼Ÿ<br>32&#39;b0;ï¼Œæ˜¯è¯´æœ‰32ä½ï¼Œæ¯ä¸€ä½æ˜¯0å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583730,"discussion_content":"input  [31:0] regWData,    å ç”¨32ä½ æ¯ä¸ªä½ä¸º0","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660318669,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¹–åŒ—"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2619436,"avatar":"https://static001.geekbang.org/account/avatar/00/27/f8/2c/92969c48.jpg","nickname":"é’ç‰ç™½éœ²","note":"","ucode":"96FE2D4D2B94A0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583801,"discussion_content":"æˆ‘æ¥å¸®è€å¸ˆå›ç­”ä¸€ä¸‹å§ï¼Œè¿™ç§[n-1:0]çš„å†™æ³•ï¼Œè¡¨ç¤ºä¸€å…±æœ‰nä½ï¼Œå¦‚æœæ˜¯å¯„å­˜å™¨ï¼Œé»˜è®¤å€¼xï¼ˆä¸ç¡®å®šï¼‰ï¼Œä¸€èˆ¬ç»¼åˆè½¯ä»¶éƒ½ä¼šæŠ¥é”™çš„ã€‚\n32&#39;b0ï¼Œè¡¨ç¤º32ä½ï¼Œç”¨äºŒè¿›åˆ¶è¡¨ç¤ºçš„è¯ï¼Œå€¼ä¸º0ï¼Œå…¶å®å°±æ˜¯32ä½å…¨ä¸º0ï¼›\nè‡³äº regs[ii] &lt;= 32&#39;b0ï¼Œå…ˆè¯´æ˜ä¸€ä¸‹ï¼Œä¹‹å‰çš„å®šä¹‰ï¼šreg [31:0] regs[31:0]; æ˜¯æŒ‡regsæ˜¯ä¸€ä¸ªäºŒç»´çš„å¯„å­˜å™¨ï¼Œå…¶å†…å­˜ç©ºé—´ä¸€å…±æ˜¯32*32ä½ï¼Œregs[ii] &lt;= 32&#39;b0å°±æ˜¯ç»™iiä½ç½®è¿›è¡Œèµ‹å€¼ï¼Œä½ å¯ä»¥ç”¨äºŒç»´æ•°ç»„çš„æ€æƒ³å»ç†è§£ã€‚\nå»ºè®®åœ¨é˜…è¯»lmosè€å¸ˆè¯¾ç¨‹çš„æ—¶å€™ï¼Œå…ˆçœ‹ä¸€äº›verilogçš„åŸºç¡€æ•™ç¨‹ï¼Œå­¦èµ·æ¥æ›´å¿«ï¼Œè¿™æ˜¯æˆ‘çš„ç¬”è®°ï¼Œå¸Œæœ›å¯ä»¥å¸®åˆ°ä½ ï¼šhttps://zhuanlan.zhihu.com/p/550710744","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1660392654,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å››å·"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355665,"user_name":"ğŸ˜‡","can_delete":false,"product_type":"c1","uid":3068400,"ip_address":"æ¹–åŒ—","ucode":"594695757BAD99","user_header":"https://static001.geekbang.org/account/avatar/00/2e/d1/f0/0eafdb8e.jpg","comment_is_top":false,"comment_ctime":1661609085,"is_pvip":false,"replies":[{"id":"129465","content":"Uå‹æŒ‡ä»¤æ˜¯å’ŒIå‹æŒ‡ä»¤ç›¸å¯¹åº”çš„Jå‹æŒ‡ä»¤å’ŒBå‹ç›¸å¯¹åº”ï¼Œéƒ½æ˜¯ä¸ºäº†æ›´å¤šçš„bitå¯¹é½","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1345199","ctime":1661734604,"ip_address":"æ¹–åŒ—","comment_id":355665,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1661609085","product_id":100117801,"comment_content":"always @(posedge clk or posedge reset) begin if(reset) begin for(ii=0; ii&lt;32; ii=ii+1) regs[ii] &lt;= 32&#39;b0; end else if(wen &amp; (|regWAddr)) regs[regWAddr] &lt;= regWData; end<br>è¯·é—®è¿™é‡Œä¸ºä»€ä¹ˆ|regWAddrï¼Œæ²¡å¤ªçœ‹æ‡‚","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585619,"discussion_content":"Uå‹æŒ‡ä»¤æ˜¯å’ŒIå‹æŒ‡ä»¤ç›¸å¯¹åº”çš„Jå‹æŒ‡ä»¤å’ŒBå‹ç›¸å¯¹åº”ï¼Œéƒ½æ˜¯ä¸ºäº†æ›´å¤šçš„bitå¯¹é½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661734605,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¹–åŒ—"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355297,"user_name":"å´å»ºå¹³","can_delete":false,"product_type":"c1","uid":2618440,"ip_address":"æ¹–åŒ—","ucode":"C6E578FB8627A3","user_header":"https://static001.geekbang.org/account/avatar/00/27/f4/48/2242bed9.jpg","comment_is_top":false,"comment_ctime":1661252159,"is_pvip":false,"replies":[{"id":"129464","content":"ä¸¤ä¸ªæ— ç¬¦å·æ•°ç›¸å‡ï¼Œè¢«å‡æ•°å°çš„è¯ï¼Œç»“æœä¼šå˜æˆè´Ÿæ•°ï¼Œæœ€é«˜ä½å°±ç®—&quot;1&quot;","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1345199","ctime":1661734460,"ip_address":"æ¹–åŒ—","comment_id":355297,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1661252159","product_id":100117801,"comment_content":"â€œå¦‚æœå®ƒä»¬çš„æœ€é«˜ä½ä¸ç›¸ç­‰ï¼Œåˆ™æ ¹æ® ALU è¿ç®—æ§åˆ¶ç  aluOp çš„æœ€ä½ä½åˆ¤æ–­ã€‚å¦‚æœ aluOp æœ€ä½ä½ä¸ºâ€œ1â€ï¼Œè¡¨ç¤ºæ˜¯æ— ç¬¦å·æ•°æ¯”è¾ƒï¼Œç›´æ¥å–æ“ä½œæ•° 2 çš„æœ€é«˜ä½ä½œä¸ºæ¯”è¾ƒç»“æœã€‚å¦‚æœ aluOp æœ€ä½ä½ä¸ºâ€œ0â€ï¼Œè¡¨ç¤ºæ˜¯æœ‰ç¬¦å·æ•°æ¯”è¾ƒï¼Œç›´æ¥å–æ“ä½œæ•° 1 çš„æœ€é«˜ä½ä½œä¸ºæ¯”è¾ƒç»“æœã€‚â€<br>è¿™å¥è¯ä»€ä¹ˆæ„æ€ï¼Œæ¯”å¦‚ï¼Œä¸ºä»€ä¹ˆæ— ç¬¦å·æ•°æ¯”è¾ƒï¼Œç›´æ¥å–æ“ä½œæ•°2çš„æœ€é«˜ä½ä¸ºæ¯”è¾ƒç»“æœï¼Œè¿™ä¸ªæœ€é«˜ä½å’Œå¤§å°æ²¡å…³ç³»å§","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585618,"discussion_content":"ä¸¤ä¸ªæ— ç¬¦å·æ•°ç›¸å‡ï¼Œè¢«å‡æ•°å°çš„è¯ï¼Œç»“æœä¼šå˜æˆè´Ÿæ•°ï¼Œæœ€é«˜ä½å°±ç®—&#34;1&#34;","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661734460,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¹–åŒ—"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2618440,"avatar":"https://static001.geekbang.org/account/avatar/00/27/f4/48/2242bed9.jpg","nickname":"å´å»ºå¹³","note":"","ucode":"C6E578FB8627A3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":585620,"discussion_content":"å¯æ˜¯è¿™é‡Œæ˜¯æ ¹æ®æ“ä½œæ•°çš„é«˜ä½è€Œä¸æ˜¯ç»“æœçš„é«˜ä½åšåˆ¤æ–­çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661734666,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":585618,"ip_address":"å¹¿ä¸œ"},"score":585620,"extra":""}]}]},{"had_liked":false,"id":355014,"user_name":"+1","can_delete":false,"product_type":"c1","uid":2062412,"ip_address":"æ¹–åŒ—","ucode":"9CE97442D75966","user_header":"","comment_is_top":false,"comment_ctime":1660981448,"is_pvip":true,"replies":[{"id":"129161","content":"å…ˆæŠŠè¯¾ç¨‹çœ‹å®Œ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1345199","ctime":1661051075,"ip_address":"æ¹–åŒ—","comment_id":355014,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1660981448","product_id":100117801,"comment_content":"è¿˜æ˜¯æ²¡æ‡‚$signed() å‡½æ•°å°†ç¬¦å·ä½æ‰©ä½åçš„ä½œç”¨æ˜¯ä»€ä¹ˆ","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584677,"discussion_content":"å…ˆæŠŠè¯¾ç¨‹çœ‹å®Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661051075,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¹–åŒ—"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354805,"user_name":"å°åš(å¾®ä¿¡&#47;æ‰‹æœºå·1849ç™»å½•)","can_delete":false,"product_type":"c1","uid":3114449,"ip_address":"æ¹–åŒ—","ucode":"58FA146873C268","user_header":"https://static001.geekbang.org/account/avatar/00/2f/85/d1/bfe4d1b2.jpg","comment_is_top":false,"comment_ctime":1660797613,"is_pvip":false,"replies":[{"id":"129172","content":"clone æ–°çš„ä»£ç  ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1345199","ctime":1661051704,"ip_address":"æ¹–åŒ—","comment_id":354805,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1660797613","product_id":100117801,"comment_content":"itypeæˆ‘å’‹æ²¡æ‰¾åˆ°åœ¨å“ªé‡Œ","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584689,"discussion_content":"clone æ–°çš„ä»£ç  ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661051704,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¹–åŒ—"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354306,"user_name":"è‹æµéƒå®“","can_delete":false,"product_type":"c1","uid":2729645,"ip_address":"æ¹–åŒ—","ucode":"AD07BD9CE03047","user_header":"https://static001.geekbang.org/account/avatar/00/29/a6/ad/e65aec4c.jpg","comment_is_top":false,"comment_ctime":1660272619,"is_pvip":false,"replies":[{"id":"128894","content":"ä¸æ˜¯  åªæ˜¯æ›´åŠ å®¹æ˜“å®ç°","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1345199","ctime":1660318698,"ip_address":"æ¹–åŒ—","comment_id":354306,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1660272619","product_id":100117801,"comment_content":"åœ¨ ALU æ¨¡å—ä»£ç ä¸­ï¼Œä¸ºä»€ä¹ˆè¦æŠŠå·¦ç§»æ“ä½œè½¬æ¢ä¸ºå³ç§»è¿›è¡Œå¤„ç†ï¼Ÿ<br>è¿™å’Œcpuå°ç«¯æ¨¡å¼æœ‰å…³ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583731,"discussion_content":"ä¸æ˜¯  åªæ˜¯æ›´åŠ å®¹æ˜“å®ç°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660318698,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ¹–åŒ—"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3077409,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/f5/21/74f85e8b.jpg","nickname":"ï¼Œ","note":"","ucode":"10BF7D0DF6F1BA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":583693,"discussion_content":"æŠŠæ•°æ®é€†åºæ’åˆ—ä¹‹å å°†å·¦ç§»è½¬æ¢ä¸ºå³ç§»æ“ä½œ å¯ä»¥èŠ‚çœèµ„æº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660295183,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ç”˜è‚ƒ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}