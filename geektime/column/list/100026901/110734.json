{"id":110734,"title":"35 | RESTful & Socketï¼šè¡Œæƒ…æ•°æ®å¯¹æ¥å’ŒæŠ“å–","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æ™¯éœ„ã€‚</p><p>ä¸Šä¸€èŠ‚è¯¾ï¼Œæˆ‘ä»¬ä»‹ç»äº†äº¤æ˜“æ‰€çš„äº¤æ˜“æ¨¡å¼ï¼Œæ•°å­—è´§å¸äº¤æ˜“æ‰€RESTfulæ¥å£çš„å¸¸è§æ¦‚å¿µï¼Œä»¥åŠå¦‚ä½•è°ƒç”¨RESTfulæ¥å£è¿›è¡Œè®¢å•æ“ä½œã€‚ä¼—æ‰€å‘¨çŸ¥ï¼Œä¹°å–æ“ä½œçš„å‰æï¼Œæ˜¯ä½ éœ€è¦å·²çŸ¥å¸‚åœºçš„æœ€æ–°æƒ…å†µã€‚è¿™èŠ‚è¯¾é‡Œï¼Œæˆ‘å°†ä»‹ç»äº¤æ˜“ç³»ç»Ÿåº•å±‚å¦ä¸€ä¸ªæœ€é‡è¦çš„éƒ¨åˆ†ï¼Œè¡Œæƒ…æ•°æ®çš„å¯¹æ¥å’ŒæŠ“å–ã€‚</p><p>è¡Œæƒ…æ•°æ®ï¼Œæœ€é‡è¦çš„æ˜¯å®æ—¶æ€§å’Œæœ‰æ•ˆæ€§ã€‚å¸‚åœºçš„æƒ…å†µç¬æ¯ä¸‡å˜ï¼Œåˆé€‚çš„ä¹°å–æ—¶é—´çª—å£å¯èƒ½åªæœ‰å‡ ç§’ã€‚åœ¨é«˜é¢‘äº¤æ˜“é‡Œï¼Œåˆé€‚çš„ä¹°å–æœºä¼šç”šè‡³åœ¨æ¯«ç§’çº§åˆ«ã€‚è¦çŸ¥é“ï¼Œä¸€æ¬¡ä»åŒ—äº¬å‘å¾€ç¾å›½çš„ç½‘ç»œè¯·æ±‚ï¼Œå³ä½¿æ˜¯å…‰é€Ÿä¼ æ’­ï¼Œéƒ½éœ€è¦å‡ ç™¾æ¯«ç§’çš„å»¶è¿Ÿã€‚æ›´åˆ«æç”¨Pythonè¿™ç§è§£é‡Šå‹è¯­è¨€ï¼Œå»ºç«‹HTTPè¿æ¥å¯¼è‡´çš„æ—¶é—´æ¶ˆè€—ã€‚</p><p>ç»è¿‡ä¸ŠèŠ‚è¯¾çš„å­¦ä¹ ï¼Œä½ å¯¹äº¤æ˜“åº”è¯¥æœ‰äº†åŸºæœ¬çš„äº†è§£ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä»Šå¤©å­¦ä¹ çš„åŸºç¡€ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆä»äº¤æ˜“æ‰€æ’®åˆæ¨¡å¼è®²èµ·ï¼Œç„¶åä»‹ç»è¡Œæƒ…æ•°æ®æœ‰å“ªäº›ï¼›ä¹‹åï¼Œæˆ‘å°†å¸¦ä½ åŸºäºWebsocketçš„è¡Œæƒ…æ•°æ®æ¥æŠ“å–æ¨¡å—ã€‚</p><h2>è¡Œæƒ…æ•°æ®</h2><p>å›é¡¾ä¸Šä¸€èŠ‚æˆ‘ä»¬æåˆ°çš„ï¼Œäº¤æ˜“æ‰€æ˜¯ä¸€ä¸ªä¹°æ–¹ã€å–æ–¹ä¹‹é—´çš„å…¬å¼€æ’®åˆå¹³å°ã€‚ä¹°å–æ–¹æŠŠéœ€è¦/å¯æä¾›çš„å•†å“æ•°é‡å’Œæ„¿æ„å‡º/æ¥å—çš„ä»·æ ¼æäº¤ç»™äº¤æ˜“æ‰€ï¼Œäº¤æ˜“æ‰€æŒ‰ç…§å…¬å¹³åŸåˆ™è¿›è¡Œæ’®åˆäº¤æ˜“ã€‚</p><p>é‚£ä¹ˆæ’®åˆäº¤æ˜“æ˜¯æ€ä¹ˆè¿›è¡Œçš„å‘¢ï¼Ÿå‡è®¾ä½ æ˜¯ä¸€ä¸ªäººè‚‰æ¯”ç‰¹å¸äº¤æ˜“æ‰€ï¼Œå¤§é‡çš„äº¤æ˜“è®¢å•å¾€ä½ è¿™é‡Œæ±‡æ€»ï¼Œä½ åº”è¯¥å¦‚ä½•é€‰æ‹©æ‰èƒ½è®©äº¤æ˜“å…¬å¹³å‘¢ï¼Ÿ</p><!-- [[[read_end]]] --><p>æ˜¾ç„¶ï¼Œæœ€ç›´è§‚çš„æ“ä½œå°±æ˜¯ï¼ŒæŠŠä¹°å–è®¢å•åˆ†æˆä¸¤ä¸ªè¡¨ï¼ŒæŒ‰ç…§ä»·æ ¼ç”±é«˜åˆ°ä½æ’åˆ—ã€‚ä¸‹é¢çš„å›¾ï¼Œå°±æ˜¯ä¹°å…¥å’Œå–å‡ºçš„å§”æ‰˜è¡¨ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/6b/2d/6bade6ffe3b8d439b7826cbe6d84a22d.png?wh=1282*388\" alt=\"\"></p><p><img src=\"https://static001.geekbang.org/resource/image/0d/4c/0d7f5bcbb766097b84b7ad36d2b26a4c.png?wh=1272*344\" alt=\"\"></p><p>å¦‚æœæœ€é«˜çš„ä¹°å…¥ä»·æ ¼å°äºæœ€ä½çš„å–å‡ºä»·æ ¼ï¼Œé‚£å°±ä¸ä¼šæœ‰ä»»ä½•äº¤æ˜“å‘ç”Ÿã€‚è¿™é€šå¸¸æ˜¯ä½ çœ‹åˆ°çš„å§”æ‰˜åˆ—è¡¨çš„å¸¸æ€ã€‚</p><p>å¦‚æœæœ€é«˜çš„ä¹°å…¥ä»·æ ¼å’Œæœ€ä½çš„å–å‡ºä»·æ ¼ç›¸åŒï¼Œé‚£ä¹ˆå°±å°è¯•è¿›è¡Œæ’®åˆã€‚æ¯”å¦‚BTCåœ¨9002.01å°±ä¼šå‘ç”Ÿæ’®åˆï¼Œæœ€åæŒ‰ç…§9002.01çš„ä»·æ ¼ï¼Œæˆäº¤0.0330ä¸ªBTCã€‚å½“ç„¶ï¼Œäº¤æ˜“å®Œæˆåï¼Œå°æ—æœªå®Œæˆéƒ¨åˆ†çš„è®¢å•ï¼ˆä½™ä¸‹0.1126 - 0.0330 = 0.0796 ä¸ª BTC æœªå–å‡ºï¼‰ï¼Œè¿˜ä¼šç»§ç»­åœ¨å§”æ‰˜è¡¨é‡Œã€‚</p><p>ä¸è¿‡ä½ å¯èƒ½ä¼šæƒ³ï¼Œå¦‚æœä¹°å…¥å’Œå–å‡ºçš„ä»·æ ¼æœ‰äº¤å‰ï¼Œé‚£ä¹ˆæˆäº¤ä»·æ ¼åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿäº‹å®ä¸Šï¼Œè¿™ç§æƒ…å†µå¹¶ä¸ä¼šå‘ç”Ÿã€‚æˆ‘ä»¬æ¥è¯•æƒ³ä¸€ä¸‹ä¸‹é¢è¿™æ ·çš„åœºæ™¯ã€‚</p><p>å¦‚æœä½ å°è¯•ç»™ä¸€ä¸ªå§”æ‰˜åˆ—è¡¨é‡ŒåŠ å…¥ä¸€ä¸ªæ–°ä¹°å…¥è®¢å•ï¼Œå®ƒçš„ä»·æ ¼æ¯”æ‰€æœ‰å·²æœ‰çš„æœ€é«˜ä¹°å…¥ä»·æ ¼é«˜ï¼Œä¹Ÿæ¯”æ‰€æœ‰çš„å–å‡ºä»·æ ¼é«˜ã€‚é‚£ä¹ˆæ­¤æ—¶ï¼Œå®ƒä¼šç›´æ¥ä»æœ€ä½çš„å–å‡ºä»·æ ¼æ’®åˆã€‚ç­‰åˆ°æœ€ä½ä»·æ ¼çš„å–å‡ºè®¢å•åƒå®Œäº†ï¼Œå®ƒä¾¿å¼€å§‹åƒä»·æ ¼ç¬¬äºŒä½çš„å–å‡ºè®¢å•ï¼Œç›´åˆ°è¿™ä¸ªä¹°å…¥è®¢å•å®Œå…¨æˆäº¤ã€‚åä¹‹äº¦ç„¶ã€‚æ‰€ä»¥ï¼Œå§”æ‰˜åˆ—è¡¨ä»·æ ¼ä¸ä¼šå‡ºç°äº¤å‰ã€‚</p><p>å½“ç„¶ï¼Œè¯·æ³¨æ„ï¼Œè¿™é‡Œæˆ‘è¯´çš„åªæ˜¯é™ä»·è®¢å•çš„äº¤æ˜“æ–¹å¼ã€‚è€Œå¯¹äºå¸‚ä»·è®¢å•ï¼Œäº¤æ˜“è§„åˆ™ä¼šæœ‰ä¸€äº›è½»å¾®çš„åŒºåˆ«ï¼Œè¿™é‡Œæˆ‘å°±ä¸è¯¦ç»†è§£é‡Šäº†ï¼Œä¸»è¦æ˜¯è®©ä½ æœ‰ä¸ªæ¦‚å¿µã€‚</p><p>å…¶å®è¯´åˆ°è¿™é‡Œï¼Œæ‰€è°“çš„â€œäº¤æ˜“æ‰€è¡Œæƒ…â€æ¦‚å¿µå°±å‘¼ä¹‹æ¬²å‡ºäº†ã€‚äº¤æ˜“æ‰€ä¸»è¦æœ‰ä¸¤ç§è¡Œæƒ…æ•°æ®ï¼šå§”æ‰˜è´¦æœ¬ï¼ˆOrder Bookï¼‰å’Œæ´»åŠ¨è¡Œæƒ…ï¼ˆTick dataï¼‰ã€‚</p><p>æˆ‘ä»¬æŠŠå§”æ‰˜è¡¨é‡Œçš„å…·ä½“ç”¨æˆ·éšå»ï¼Œç›¸åŒä»·æ ¼çš„è®¢å•åˆå¹¶ï¼Œå°±å¾—åˆ°äº†ä¸‹é¢è¿™ç§å§”æ‰˜è´¦æœ¬ã€‚æˆ‘ä»¬ä¸»è¦è§‚å¯Ÿå³è¾¹çš„æ•°å­—éƒ¨åˆ†ï¼Œå…¶ä¸­ï¼š</p><ul>\n<li>ä¸ŠåŠéƒ¨åˆ†é‡Œï¼Œç¬¬ä¸€åˆ—çº¢è‰²æ•°å­—ä»£è¡¨BTCçš„å–å‡ºä»·æ ¼ï¼Œä¸­é—´ä¸€åˆ—æ•°å­—æ˜¯è¿™ä¸ªä»·æ ¼åŒºé—´çš„è®¢å•BTCæ€»é‡ï¼Œæœ€å³è¾¹ä¸€æ æ˜¯ä»æœ€ä½å–å‡ºä»·æ ¼åˆ°å½“å‰ä»·æ ¼åŒºé—´çš„ç§¯ç´¯è®¢å•é‡ã€‚</li>\n<li>ä¸­é—´çš„å¤§å­—éƒ¨åˆ†ï¼Œ9994.10 USDæ˜¯å½“å‰çš„å¸‚åœºä»·æ ¼ï¼Œä¹Ÿå°±æ˜¯ä¸Šä¸€æ¬¡æˆäº¤äº¤æ˜“çš„ä»·æ ¼ã€‚</li>\n<li>ä¸‹é¢ç»¿è‰²éƒ¨åˆ†çš„å«ä¹‰ä¸ä¸ŠåŠéƒ¨åˆ†ç±»ä¼¼ï¼Œä¸è¿‡æŒ‡çš„æ˜¯ä¹°å…¥å§”æ‰˜å’Œå¯¹åº”çš„æ•°é‡ã€‚</li>\n</ul><p><img src=\"https://static001.geekbang.org/resource/image/74/1e/740e88e95dcab334652f8761ca58171e.png?wh=932*964\" alt=\"\"></p><center>Geminiçš„å§”æ‰˜è´¦æœ¬ï¼Œæ¥è‡ª<a href=\"https://cryptowat.ch\">https://cryptowat.ch</a></center><p>è¿™å¼ å›¾ä¸­ï¼Œæœ€ä½çš„å–å‡ºä»·æ ¼æ¯”æœ€é«˜çš„ä¹°å…¥ä»·æ ¼è¦é«˜ 6.51 USDï¼Œè¿™ä¸ªä»·å·®é€šå¸¸è¢«ç§°ä¸ºSpreadã€‚è¿™é‡ŒéªŒè¯äº†æˆ‘ä»¬å‰é¢æåˆ°çš„ï¼Œå§”æ‰˜è´¦æœ¬çš„ä»·æ ¼æ°¸ä¸äº¤å‰ï¼› åŒæ—¶ï¼ŒSpreadå¾ˆå°ä¹Ÿèƒ½è¯´æ˜è¿™æ˜¯ä¸€ä¸ªéå¸¸æ´»è·ƒçš„äº¤æ˜“æ‰€ã€‚</p><p>æ¯ä¸€æ¬¡æ’®åˆå‘ç”Ÿï¼Œæ„å‘³ç€ä¸€ç¬”äº¤æ˜“ï¼ˆTradeï¼‰çš„å‘ç”Ÿã€‚å–æ–¹ä¹°æ–¹éƒ½å¾ˆå¼€å¿ƒï¼Œäºæ˜¯äº¤æ˜“æ‰€ä¹Ÿå¾ˆå¼€å¿ƒåœ°é€šçŸ¥è¡Œæƒ…æ•°æ®çš„è®¢é˜…è€…ï¼šåˆšæ‰å‘ç”Ÿäº†ä¸€ç¬”äº¤æ˜“ï¼Œäº¤æ˜“çš„ä»·æ ¼æ˜¯å¤šå°‘ï¼Œæˆäº¤æ•°é‡æ˜¯å¤šå°‘ã€‚è¿™ä¸ªæ•°æ®å°±æ˜¯æ´»åŠ¨è¡Œæƒ…Tickã€‚</p><p>æœ‰äº†è¿™äº›æ•°æ®ï¼Œæˆ‘ä»¬ä¹Ÿå°±æŒæ¡äº†è¿™ä¸ªäº¤æ˜“æ‰€çš„å½“å‰çŠ¶æ€ï¼Œå¯ä»¥å¼€å§‹æäº‹æƒ…äº†ã€‚</p><h2>Websocketä»‹ç»</h2><p>åœ¨æœ¬æ–‡çš„å¼€å¤´æˆ‘ä»¬æåˆ°è¿‡ï¼šè¡Œæƒ…æ•°æ®å¾ˆè®²ç©¶æ—¶æ•ˆæ€§ã€‚æ‰€ä»¥ï¼Œè¡Œæƒ…ä»äº¤æ˜“æ‰€äº§ç”Ÿåˆ°ä¼ æ’­ç»™æˆ‘ä»¬çš„ç¨‹åºä¹‹é—´çš„å»¶è¿Ÿï¼Œåº”è¯¥è¶Šä½è¶Šå¥½ã€‚é€šå¸¸ï¼Œäº¤æ˜“æ‰€ä¹Ÿæä¾›äº†RESTçš„è¡Œæƒ…æ•°æ®æŠ“å–æ¥å£ã€‚æ¯”å¦‚ä¸‹é¢è¿™æ®µä»£ç ï¼š</p><pre><code>import requests\nimport timeit\n\n\ndef get_orderbook():\n  orderbook = requests.get(&quot;https://api.gemini.com/v1/book/btcusd&quot;).json()\n\n\nn = 10\nlatency = timeit.timeit('get_orderbook()', setup='from __main__ import get_orderbook', number=n) * 1.0 / n\nprint('Latency is {} ms'.format(latency * 1000))\n\n###### è¾“å‡º #######\n\nLatency is 196.67642089999663 ms\n</code></pre><p>æˆ‘åœ¨ç¾å›½çº½çº¦é™„è¿‘åŸå¸‚çš„ä¸€ä¸ªæœåŠ¡å™¨ä¸Šæµ‹è¯•äº†è¿™æ®µä»£ç ï¼Œä½ å¯ä»¥çœ‹åˆ°ï¼Œå¹³å‡æ¯æ¬¡è®¿é—®orderbookçš„å»¶è¿Ÿæœ‰0.25ç§’å·¦å³ã€‚æ˜¾ç„¶ï¼Œå¦‚æœåœ¨å›½å†…ï¼Œè¿™ä¸ªå»¶è¿Ÿåªä¼šæ›´å¤§ã€‚æŒ‰ç†è¯´ï¼Œè¿™ä¸¤ä¸ªç¾å›½åŸå¸‚çš„è·ç¦»å¾ˆçŸ­ï¼Œä¸ºä»€ä¹ˆå»¶è¿Ÿä¼šè¿™ä¹ˆå¤§å‘¢ï¼Ÿ</p><p>è¿™æ˜¯å› ä¸ºï¼ŒRESTæ¥å£æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªHTTPæ¥å£ï¼Œåœ¨è¿™ä¹‹ä¸‹æ˜¯TCP/TLSå¥—æ¥å­—ï¼ˆSocketï¼‰è¿æ¥ã€‚æ¯ä¸€æ¬¡RESTè¯·æ±‚ï¼Œé€šå¸¸éƒ½ä¼šé‡æ–°å»ºç«‹ä¸€æ¬¡TCP/TLSæ¡æ‰‹ï¼›ç„¶åï¼Œåœ¨è¯·æ±‚ç»“æŸä¹‹åï¼Œæ–­å¼€è¿™ä¸ªé“¾æ¥ã€‚è¿™ä¸ªè¿‡ç¨‹ï¼Œæ¯”æˆ‘ä»¬æƒ³è±¡çš„è¦æ…¢å¾ˆå¤šã€‚</p><p>ä¸¾ä¸ªä¾‹å­æ¥éªŒè¯è¿™ä¸€ç‚¹ï¼Œåœ¨åŒä¸€ä¸ªåŸå¸‚æˆ‘ä»¬è¯•éªŒä¸€ä¸‹ã€‚æˆ‘ä»çº½çº¦é™„è¿‘çš„æœåŠ¡å™¨å’ŒGeminiåœ¨çº½çº¦çš„æœåŠ¡å™¨è¿›è¡Œè¿æ¥ï¼ŒTCP/SSLæ¡æ‰‹èŠ±äº†å¤šå°‘æ—¶é—´å‘¢ï¼Ÿ</p><pre><code>curl -w &quot;TCP handshake: %{time_connect}s, SSL handshake: %{time_appconnect}s\\n&quot; -so /dev/null https://www.gemini.com\n\nTCP handshake: 0.072758s, SSL handshake: 0.119409s\n</code></pre><p>ç»“æœæ˜¾ç¤ºï¼ŒHTTPè¿æ¥æ„å»ºçš„è¿‡ç¨‹ï¼Œå°±å äº†ä¸€å¤§åŠæ—¶é—´ï¼ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ¯æ¬¡ç”¨RESTè¯·æ±‚ï¼Œéƒ½è¦æµªè´¹ä¸€å¤§åŠçš„æ—¶é—´åœ¨å’ŒæœåŠ¡å™¨å»ºç«‹è¿æ¥ä¸Šï¼Œè¿™æ˜¾ç„¶æ˜¯éå¸¸ä½æ•ˆçš„ã€‚å¾ˆè‡ªç„¶çš„ä½ ä¼šæƒ³åˆ°ï¼Œæˆ‘ä»¬èƒ½å¦å®ç°ä¸€æ¬¡è¿æ¥ã€å¤šæ¬¡é€šä¿¡å‘¢ï¼Ÿ</p><p>äº‹å®ä¸Šï¼ŒPythonçš„æŸäº›HTTPè¯·æ±‚åº“ï¼Œä¹Ÿå¯ä»¥æ”¯æŒé‡ç”¨åº•å±‚çš„TCP/SSLè¿æ¥ã€‚ä½†é‚£ç§æ–¹æ³•ï¼Œä¸€æ¥æ¯”è¾ƒå¤æ‚ï¼ŒäºŒæ¥ä¹Ÿéœ€è¦æœåŠ¡å™¨çš„æ”¯æŒã€‚è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå…¶å®ï¼Œåœ¨æœ‰WebSocketçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å®Œå…¨ä¸éœ€è¦èˆè¿‘æ±‚è¿œã€‚</p><p>æˆ‘å…ˆæ¥ä»‹ç»ä¸€ä¸‹WebSocketã€‚WebSocketæ˜¯ä¸€ç§åœ¨å•ä¸ªTCP/TLSè¿æ¥ä¸Šï¼Œè¿›è¡Œå…¨åŒå·¥ã€åŒå‘é€šä¿¡çš„åè®®ã€‚WebSocketå¯ä»¥è®©å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´çš„æ•°æ®äº¤æ¢å˜å¾—æ›´åŠ ç®€å•é«˜æ•ˆï¼ŒæœåŠ¡ç«¯ä¹Ÿå¯ä»¥ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€æ•°æ®ã€‚åœ¨WebSocket APIä¸­ï¼Œæµè§ˆå™¨å’ŒæœåŠ¡å™¨åªéœ€è¦å®Œæˆä¸€æ¬¡æ¡æ‰‹ï¼Œä¸¤è€…ä¹‹é—´å°±å¯ä»¥ç›´æ¥åˆ›å»ºæŒä¹…æ€§çš„è¿æ¥ï¼Œå¹¶è¿›è¡ŒåŒå‘æ•°æ®ä¼ è¾“ã€‚</p><p>æ¦‚å¿µå¬ç€å¾ˆç—›å¿«ï¼Œä¸è¿‡è¿˜æ˜¯æœ‰äº›æŠ½è±¡ã€‚ä¸ºäº†è®©ä½ å¿«é€Ÿç†è§£åˆšåˆšçš„è¿™æ®µè¯ï¼Œæˆ‘ä»¬è¿˜æ˜¯æ¥çœ‹ä¸¤ä¸ªç®€å•çš„ä¾‹å­ã€‚äºŒè¯ä¸è¯´ï¼Œå…ˆçœ‹ä¸€æ®µä»£ç ï¼š</p><pre><code>import websocket\nimport thread\n\n# åœ¨æ¥æ”¶åˆ°æœåŠ¡å™¨å‘é€æ¶ˆæ¯æ—¶è°ƒç”¨\ndef on_message(ws, message):\n    print('Received: ' + message)\n\n# åœ¨å’ŒæœåŠ¡å™¨å»ºç«‹å®Œæˆè¿æ¥æ—¶è°ƒç”¨   \ndef on_open(ws):\n    # çº¿ç¨‹è¿è¡Œå‡½æ•°\n    def gao():\n        # å¾€æœåŠ¡å™¨ä¾æ¬¡å‘é€0-4ï¼Œæ¯æ¬¡å‘é€å®Œä¼‘æ¯0.01ç§’\n        for i in range(5):\n            time.sleep(0.01)\n            msg=&quot;{0}&quot;.format(i)\n            ws.send(msg)\n            print('Sent: ' + msg)\n        # ä¼‘æ¯1ç§’ç”¨äºæ¥æ”¶æœåŠ¡å™¨å›å¤çš„æ¶ˆæ¯\n        time.sleep(1)\n        \n        # å…³é—­Websocketçš„è¿æ¥\n        ws.close()\n        print(&quot;Websocket closed&quot;)\n    \n    # åœ¨å¦ä¸€ä¸ªçº¿ç¨‹è¿è¡Œgao()å‡½æ•°\n    thread.start_new_thread(gao, ())\n\n\nif __name__ == &quot;__main__&quot;:\n    ws = websocket.WebSocketApp(&quot;ws://echo.websocket.org/&quot;,\n                              on_message = on_message,\n                              on_open = on_open)\n    \n    ws.run_forever()\n\n#### è¾“å‡º #####\nSent: 0\nSent: 1\nReceived: 0\nSent: 2\nReceived: 1\nSent: 3\nReceived: 2\nSent: 4\nReceived: 3\nReceived: 4\nWebsocket closed\n</code></pre><p>è¿™æ®µä»£ç å°è¯•å’Œ<code>wss://echo.websocket.org</code>å»ºç«‹è¿æ¥ã€‚å½“è¿æ¥å»ºç«‹çš„æ—¶å€™ï¼Œå°±ä¼šå¯åŠ¨ä¸€æ¡çº¿ç¨‹ï¼Œè¿ç»­å‘æœåŠ¡å™¨å‘é€5æ¡æ¶ˆæ¯ã€‚</p><p>é€šè¿‡è¾“å‡ºå¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬åœ¨è¿ç»­å‘é€çš„åŒæ—¶ï¼Œä¹Ÿåœ¨ä¸æ–­åœ°æ¥å—æ¶ˆæ¯ã€‚è¿™å¹¶æ²¡æœ‰åƒRESTä¸€æ ·ï¼Œæ¯å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œè¦ç­‰å¾…æœåŠ¡å™¨å®Œæˆè¯·æ±‚ã€å®Œå…¨å›å¤ä¹‹åï¼Œå†è¿›è¡Œä¸‹ä¸€ä¸ªè¯·æ±‚ã€‚æ¢å¥è¯è¯´ï¼Œ<strong>æˆ‘ä»¬åœ¨è¯·æ±‚çš„åŒæ—¶ä¹Ÿåœ¨æ¥å—æ¶ˆæ¯</strong>ï¼Œè¿™ä¹Ÿå°±æ˜¯å‰é¢æ‰€è¯´çš„â€å…¨åŒå·¥â€œã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/7b/b6/7bbb7936b56dcae7f1e5dfbc644b4fb6.png?wh=1876*2491\" alt=\"\"></p><center>RESTï¼ˆHTTPï¼‰å•å·¥è¯·æ±‚å“åº”çš„ç¤ºæ„å›¾</center><p><img src=\"https://static001.geekbang.org/resource/image/9d/4c/9d4072dedfd5944a08e3bbee5059194c.png?wh=1681*2596\" alt=\"\"></p><center>Websocketå…¨åŒå·¥è¯·æ±‚å“åº”çš„ç¤ºæ„å›¾</center><p>å†æ¥çœ‹ç¬¬äºŒæ®µä»£ç ã€‚ä¸ºäº†è§£é‡Šâ€åŒå‘â€œï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹è·å–Geminiçš„å§”æ‰˜è´¦å•çš„ä¾‹å­ã€‚</p><pre><code>import ssl\nimport websocket\nimport json\n\n# å…¨å±€è®¡æ•°å™¨\ncount = 5\n\ndef on_message(ws, message):\n    global count\n    print(message)\n    count -= 1\n    # æ¥æ”¶äº†5æ¬¡æ¶ˆæ¯ä¹‹åå…³é—­websocketè¿æ¥\n    if count == 0:\n        ws.close()\n\nif __name__ == &quot;__main__&quot;:\n    ws = websocket.WebSocketApp(\n        &quot;wss://api.gemini.com/v1/marketdata/btcusd?top_of_book=true&amp;offers=true&quot;,\n        on_message=on_message)\n    ws.run_forever(sslopt={&quot;cert_reqs&quot;: ssl.CERT_NONE})\n\n###### è¾“å‡º #######\n{&quot;type&quot;:&quot;update&quot;,&quot;eventId&quot;:7275473603,&quot;socket_sequence&quot;:0,&quot;events&quot;:[{&quot;type&quot;:&quot;change&quot;,&quot;reason&quot;:&quot;initial&quot;,&quot;price&quot;:&quot;11386.12&quot;,&quot;delta&quot;:&quot;1.307&quot;,&quot;remaining&quot;:&quot;1.307&quot;,&quot;side&quot;:&quot;ask&quot;}]}\n{&quot;type&quot;:&quot;update&quot;,&quot;eventId&quot;:7275475120,&quot;timestamp&quot;:1562380981,&quot;timestampms&quot;:1562380981991,&quot;socket_sequence&quot;:1,&quot;events&quot;:[{&quot;type&quot;:&quot;change&quot;,&quot;side&quot;:&quot;ask&quot;,&quot;price&quot;:&quot;11386.62&quot;,&quot;remaining&quot;:&quot;1&quot;,&quot;reason&quot;:&quot;top-of-book&quot;}]}\n{&quot;type&quot;:&quot;update&quot;,&quot;eventId&quot;:7275475271,&quot;timestamp&quot;:1562380982,&quot;timestampms&quot;:1562380982387,&quot;socket_sequence&quot;:2,&quot;events&quot;:[{&quot;type&quot;:&quot;change&quot;,&quot;side&quot;:&quot;ask&quot;,&quot;price&quot;:&quot;11386.12&quot;,&quot;remaining&quot;:&quot;1.3148&quot;,&quot;reason&quot;:&quot;top-of-book&quot;}]}\n{&quot;type&quot;:&quot;update&quot;,&quot;eventId&quot;:7275475838,&quot;timestamp&quot;:1562380986,&quot;timestampms&quot;:1562380986270,&quot;socket_sequence&quot;:3,&quot;events&quot;:[{&quot;type&quot;:&quot;change&quot;,&quot;side&quot;:&quot;ask&quot;,&quot;price&quot;:&quot;11387.16&quot;,&quot;remaining&quot;:&quot;0.072949&quot;,&quot;reason&quot;:&quot;top-of-book&quot;}]}\n{&quot;type&quot;:&quot;update&quot;,&quot;eventId&quot;:7275475935,&quot;timestamp&quot;:1562380986,&quot;timestampms&quot;:1562380986767,&quot;socket_sequence&quot;:4,&quot;events&quot;:[{&quot;type&quot;:&quot;change&quot;,&quot;side&quot;:&quot;ask&quot;,&quot;price&quot;:&quot;11389.22&quot;,&quot;remaining&quot;:&quot;0.06204196&quot;,&quot;reason&quot;:&quot;top-of-book&quot;}]}\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å’ŒGeminiå»ºç«‹è¿æ¥åï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å‘æœåŠ¡å™¨å‘é€ä»»ä½•æ¶ˆæ¯ï¼Œæ²¡æœ‰ä»»ä½•è¯·æ±‚ï¼Œä½†æ˜¯æœåŠ¡å™¨å´æºæºä¸æ–­åœ°å‘æˆ‘ä»¬æ¨é€æ•°æ®ã€‚è¿™å¯æ¯”RESTæ¥å£â€œæ¯è¯·æ±‚ä¸€æ¬¡è·å¾—ä¸€æ¬¡å›å¤â€çš„æ²Ÿé€šæ–¹å¼é«˜æ•ˆå¤šäº†ï¼</p><p>å› æ­¤ï¼Œç›¸å¯¹äºRESTæ¥è¯´ï¼ŒWebsocketæ˜¯ä¸€ç§æ›´åŠ å®æ—¶ã€é«˜æ•ˆçš„æ•°æ®äº¤æ¢æ–¹å¼ã€‚å½“ç„¶ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼šå› ä¸ºè¯·æ±‚å’Œå›å¤æ˜¯å¼‚æ­¥çš„ï¼Œè¿™è®©æˆ‘ä»¬ç¨‹åºçš„çŠ¶æ€æ§åˆ¶é€»è¾‘æ›´åŠ å¤æ‚ã€‚è¿™ä¸€ç‚¹ï¼Œåé¢çš„å†…å®¹é‡Œæˆ‘ä»¬ä¼šæœ‰æ›´æ·±åˆ»çš„ä½“ä¼šã€‚</p><h2>è¡Œæƒ…æŠ“å–æ¨¡å—</h2><p>æœ‰äº† Websocket çš„åŸºæœ¬æ¦‚å¿µï¼Œæˆ‘ä»¬å°±æŒæ¡äº†å’Œäº¤æ˜“æ‰€è¿æ¥çš„ç¬¬äºŒç§æ–¹å¼ã€‚</p><p>äº‹å®ä¸Šï¼ŒGemini æä¾›äº†ä¸¤ç§ Websocket æ¥å£ï¼Œä¸€ç§æ˜¯ Public æ¥å£ï¼Œä¸€ç§ä¸º Private æ¥å£ã€‚</p><p>Public æ¥å£ï¼Œå³å…¬å¼€æ¥å£ï¼Œæä¾› orderbook æœåŠ¡ï¼Œå³æ¯ä¸ªäººéƒ½èƒ½çœ‹åˆ°çš„å½“å‰æŒ‚å•ä»·å’Œæ·±åº¦ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¿™èŠ‚è¯¾åˆšåˆšè¯¦ç»†è®²è¿‡çš„ orderbookã€‚</p><p>è€Œ Private æ¥å£ï¼Œå’Œæˆ‘ä»¬ä¸ŠèŠ‚è¯¾è®²çš„æŒ‚å•æ“ä½œæœ‰å…³ï¼Œè®¢å•è¢«å®Œå…¨æ‰§è¡Œã€è¢«éƒ¨åˆ†æ‰§è¡Œç­‰ç­‰å…¶ä»–å˜åŠ¨ï¼Œä½ éƒ½ä¼šå¾—åˆ°é€šçŸ¥ã€‚</p><p>æˆ‘ä»¬ä»¥ orderbook çˆ¬è™«ä¸ºä¾‹ï¼Œå…ˆæ¥çœ‹ä¸‹å¦‚ä½•æŠ“å– orderbook ä¿¡æ¯ã€‚ä¸‹é¢çš„ä»£ç è¯¦ç»†å†™äº†ä¸€ä¸ªå…¸å‹çš„çˆ¬è™«ï¼ŒåŒæ—¶ä½¿ç”¨äº†ç±»è¿›è¡Œå°è£…ï¼Œå¸Œæœ›ä½ ä¸è¦å¿˜è®°æˆ‘ä»¬è¿™é—¨è¯¾çš„ç›®çš„ï¼Œäº†è§£  Python æ˜¯å¦‚ä½•åº”ç”¨äºå·¥ç¨‹å®è·µä¸­çš„ï¼š</p><pre><code>import copy\nimport json\nimport ssl\nimport time\nimport websocket\n\n\nclass OrderBook(object):\n\n    BIDS = 'bid'\n    ASKS = 'ask'\n\n    def __init__(self, limit=20):\n\n        self.limit = limit\n\n        # (price, amount)\n        self.bids = {}\n        self.asks = {}\n\n        self.bids_sorted = []\n        self.asks_sorted = []\n\n    def insert(self, price, amount, direction):\n        if direction == self.BIDS:\n            if amount == 0:\n                if price in self.bids:\n                    del self.bids[price]\n            else:\n                self.bids[price] = amount\n        elif direction == self.ASKS:\n            if amount == 0:\n                if price in self.asks:\n                    del self.asks[price]\n            else:\n                self.asks[price] = amount\n        else:\n            print('WARNING: unknown direction {}'.format(direction))\n\n    def sort_and_truncate(self):\n        # sort\n        self.bids_sorted = sorted([(price, amount) for price, amount in self.bids.items()], reverse=True)\n        self.asks_sorted = sorted([(price, amount) for price, amount in self.asks.items()])\n\n        # truncate\n        self.bids_sorted = self.bids_sorted[:self.limit]\n        self.asks_sorted = self.asks_sorted[:self.limit]\n\n        # copy back to bids and asks\n        self.bids = dict(self.bids_sorted)\n        self.asks = dict(self.asks_sorted)\n\n    def get_copy_of_bids_and_asks(self):\n        return copy.deepcopy(self.bids_sorted), copy.deepcopy(self.asks_sorted)\n\n\nclass Crawler:\n    def __init__(self, symbol, output_file):\n        self.orderbook = OrderBook(limit=10)\n        self.output_file = output_file\n\n        self.ws = websocket.WebSocketApp('wss://api.gemini.com/v1/marketdata/{}'.format(symbol),\n                                         on_message = lambda ws, message: self.on_message(message))\n        self.ws.run_forever(sslopt={'cert_reqs': ssl.CERT_NONE})\n\n    def on_message(self, message):\n        # å¯¹æ”¶åˆ°çš„ä¿¡æ¯è¿›è¡Œå¤„ç†ï¼Œç„¶åé€ç»™ orderbook\n        data = json.loads(message)\n        for event in data['events']:\n            price, amount, direction = float(event['price']), float(event['remaining']), event['side']\n            self.orderbook.insert(price, amount, direction)\n\n        # æ•´ç† orderbookï¼Œæ’åºï¼Œåªé€‰å–æˆ‘ä»¬éœ€è¦çš„å‰å‡ ä¸ª\n        self.orderbook.sort_and_truncate()\n\n        # è¾“å‡ºåˆ°æ–‡ä»¶\n        with open(self.output_file, 'a+') as f:\n            bids, asks = self.orderbook.get_copy_of_bids_and_asks()\n            output = {\n                'bids': bids,\n                'asks': asks,\n                'ts': int(time.time() * 1000)\n            }\n            f.write(json.dumps(output) + '\\n')\n\n\nif __name__ == '__main__':\n    crawler = Crawler(symbol='BTCUSD', output_file='BTCUSD.txt')\n\n###### è¾“å‡º #######\n\n{&quot;bids&quot;: [[11398.73, 0.96304843], [11398.72, 0.98914437], [11397.32, 1.0], [11396.13, 2.0], [11395.95, 2.0], [11395.87, 1.0], [11394.09, 0.11803397], [11394.08, 1.0], [11393.59, 0.1612581], [11392.96, 1.0]], &quot;asks&quot;: [[11407.42, 1.30814001], [11407.92, 1.0], [11409.48, 2.0], [11409.66, 2.0], [11412.15, 0.525], [11412.42, 1.0], [11413.77, 0.11803397], [11413.99, 0.5], [11414.28, 1.0], [11414.72, 1.0]], &quot;ts&quot;: 1562558996535}\n{&quot;bids&quot;: [[11398.73, 0.96304843], [11398.72, 0.98914437], [11397.32, 1.0], [11396.13, 2.0], [11395.95, 2.0], [11395.87, 1.0], [11394.09, 0.11803397], [11394.08, 1.0], [11393.59, 0.1612581], [11392.96, 1.0]], &quot;asks&quot;: [[11407.42, 1.30814001], [11407.92, 1.0], [11409.48, 2.0], [11409.66, 2.0], [11412.15, 0.525], [11412.42, 1.0], [11413.77, 0.11803397], [11413.99, 0.5], [11414.28, 1.0], [11414.72, 1.0]], &quot;ts&quot;: 1562558997377}\n{&quot;bids&quot;: [[11398.73, 0.96304843], [11398.72, 0.98914437], [11397.32, 1.0], [11396.13, 2.0], [11395.95, 2.0], [11395.87, 1.0], [11394.09, 0.11803397], [11394.08, 1.0], [11393.59, 0.1612581], [11392.96, 1.0]], &quot;asks&quot;: [[11407.42, 1.30814001], [11409.48, 2.0], [11409.66, 2.0], [11412.15, 0.525], [11412.42, 1.0], [11413.77, 0.11803397], [11413.99, 0.5], [11414.28, 1.0], [11414.72, 1.0]], &quot;ts&quot;: 1562558997765}\n{&quot;bids&quot;: [[11398.73, 0.96304843], [11398.72, 0.98914437], [11397.32, 1.0], [11396.13, 2.0], [11395.95, 2.0], [11395.87, 1.0], [11394.09, 0.11803397], [11394.08, 1.0], [11393.59, 0.1612581], [11392.96, 1.0]], &quot;asks&quot;: [[11407.42, 1.30814001], [11409.48, 2.0], [11409.66, 2.0], [11412.15, 0.525], [11413.77, 0.11803397], [11413.99, 0.5], [11414.28, 1.0], [11414.72, 1.0]], &quot;ts&quot;: 1562558998638}\n{&quot;bids&quot;: [[11398.73, 0.97131753], [11398.72, 0.98914437], [11397.32, 1.0], [11396.13, 2.0], [11395.95, 2.0], [11395.87, 1.0], [11394.09, 0.11803397], [11394.08, 1.0], [11393.59, 0.1612581], [11392.96, 1.0]], &quot;asks&quot;: [[11407.42, 1.30814001], [11409.48, 2.0], [11409.66, 2.0], [11412.15, 0.525], [11413.77, 0.11803397], [11413.99, 0.5], [11414.28, 1.0], [11414.72, 1.0]], &quot;ts&quot;: 1562558998645}\n{&quot;bids&quot;: [[11398.73, 0.97131753], [11398.72, 0.98914437], [11397.32, 1.0], [11396.13, 2.0], [11395.87, 1.0], [11394.09, 0.11803397], [11394.08, 1.0], [11393.59, 0.1612581], [11392.96, 1.0]], &quot;asks&quot;: [[11407.42, 1.30814001], [11409.48, 2.0], [11409.66, 2.0], [11412.15, 0.525], [11413.77, 0.11803397], [11413.99, 0.5], [11414.28, 1.0], [11414.72, 1.0]], &quot;ts&quot;: 1562558998748}\n</code></pre><p>ä»£ç æ¯”è¾ƒé•¿ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å…·ä½“è§£é‡Šä¸€ä¸‹ã€‚</p><p>è¿™æ®µä»£ç çš„æœ€å¼€å§‹ï¼Œå°è£…äº†ä¸€ä¸ªå«åš orderbook çš„ classï¼Œä¸“é—¨ç”¨æ¥å­˜æ”¾ä¸ä¹‹ç›¸å…³çš„æ•°æ®ç»“æ„ã€‚å…¶ä¸­çš„ bids å’Œ asks ä¸¤ä¸ªå­—å…¸ï¼Œç”¨æ¥å­˜å‚¨å½“å‰æ—¶åˆ»ä¸‹çš„ä¹°æ–¹æŒ‚å•å’Œå–æ–¹æŒ‚å•ã€‚</p><p>æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜ä¸“é—¨ç»´æŠ¤äº†ä¸€ä¸ªæ’è¿‡åºçš„ bids_sorted å’Œ asks_sortedã€‚æ„é€ å‡½æ•°æœ‰ä¸€ä¸ªå‚æ•° limitï¼Œç”¨æ¥æŒ‡ç¤º orderbook çš„ bids å’Œ asks ä¿ç•™å¤šå°‘æ¡æ•°æ®ã€‚å¯¹äºå¾ˆå¤šç­–ç•¥ï¼Œtop 5 çš„æ•°æ®å¾€å¾€è¶³å¤Ÿï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©çš„æ˜¯å‰ 10 ä¸ªã€‚</p><p>å†å¾€ä¸‹çœ‹ï¼Œinsert() å‡½æ•°ç”¨äºå‘ orderbook æ’å…¥ä¸€æ¡æ•°æ®ã€‚éœ€è¦æ³¨æ„ï¼Œè¿™é‡Œçš„é€»è¾‘æ˜¯ï¼Œå¦‚æœæŸä¸ª price å¯¹åº”çš„ amount æ˜¯ 0ï¼Œé‚£ä¹ˆæ„å‘³ç€è¿™ä¸€æ¡æ•°æ®å·²ç»ä¸å­˜åœ¨äº†ï¼Œåˆ é™¤å³å¯ã€‚insert çš„æ•°æ®å¯èƒ½æ˜¯ä¹±åºçš„ï¼Œå› æ­¤åœ¨éœ€è¦çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦å¯¹ bids å’Œ asks è¿›è¡Œæ’åºï¼Œç„¶åé€‰å–å‰é¢æŒ‡å®šæ•°é‡çš„æ•°æ®ã€‚è¿™å…¶å®å°±æ˜¯ sort_and_truncate() å‡½æ•°çš„ä½œç”¨ï¼Œè°ƒç”¨å®ƒæ¥å¯¹ bids å’Œ asks æ’åºåæˆªå–ï¼Œæœ€åä¿å­˜å› bids å’Œ asksã€‚</p><p>æ¥ä¸‹æ¥çš„ get_copy_of_bids_and_asks()å‡½æ•°ï¼Œç”¨æ¥è¿”å›æ’è¿‡åºçš„ bids å’Œ asks æ•°ç»„ã€‚è¿™é‡Œä½¿ç”¨æ·±æ‹·è´ï¼Œæ˜¯å› ä¸ºå¦‚æœç›´æ¥è¿”å›ï¼Œå°†ä¼šè¿”å› bids_sorted å’Œ asks_sorted çš„æŒ‡é’ˆï¼›é‚£ä¹ˆï¼Œåœ¨ä¸‹ä¸€æ¬¡è°ƒç”¨ sort_and_truncate() å‡½æ•°çš„æ—¶å€™ï¼Œä¸¤ä¸ªæ•°ç»„çš„å†…å®¹å°†ä¼šè¢«æ”¹å˜ï¼Œè¿™å°±é€ æˆäº†æ½œåœ¨çš„ bugã€‚</p><p>æœ€åæ¥çœ‹ä¸€ä¸‹ Crawler ç±»ã€‚æ„é€ å‡½æ•°å£°æ˜ orderbookï¼Œç„¶åå®šä¹‰ Websocket ç”¨æ¥æ¥æ”¶äº¤æ˜“æ‰€æ•°æ®ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œå›è°ƒå‡½æ•° on_message() æ˜¯ä¸€ä¸ªç±»æˆå‘˜å‡½æ•°ã€‚å› æ­¤ï¼Œåº”è¯¥ä½ æ³¨æ„åˆ°äº†ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ selfï¼Œè¿™é‡Œå¦‚æœç›´æ¥å†™æˆ <code>on_message = self.on_message</code> å°†ä¼šå‡ºé”™ã€‚</p><p>ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å°†å‡½æ•°å†æ¬¡åŒ…è£…ä¸€ä¸‹ã€‚è¿™é‡Œæˆ‘ä½¿ç”¨äº†å‰é¢å­¦è¿‡çš„åŒ¿åå‡½æ•°ï¼Œæ¥ä¼ é€’ä¸­é—´çŠ¶æ€ï¼Œæ³¨æ„æˆ‘ä»¬åªéœ€è¦ messageï¼Œå› æ­¤ä¼ å…¥ message å³å¯ã€‚</p><p>å‰©ä¸‹çš„éƒ¨åˆ†å°±å¾ˆæ¸…æ™°äº†ï¼Œon_message å›è°ƒå‡½æ•°åœ¨æ”¶åˆ°ä¸€ä¸ªæ–°çš„ tick æ—¶ï¼Œå…ˆå°†ä¿¡æ¯è§£ç ï¼Œæšä¸¾æ”¶åˆ°çš„æ‰€æœ‰æ”¹å˜ï¼›ç„¶åæ’å…¥ orderbookï¼Œæ’åºï¼›æœ€åè¿åŒ timestamp ä¸€å¹¶è¾“å‡ºå³å¯ã€‚</p><p>è™½ç„¶è¿™æ®µä»£ç çœ‹èµ·æ¥æŒºé•¿ï¼Œä½†æ˜¯ç»è¿‡æˆ‘è¿™ä¹ˆä¸€åˆ†è§£ï¼Œæ˜¯ä¸æ˜¯å‘ç°éƒ½æ˜¯å­¦è¿‡çš„çŸ¥è¯†ç‚¹å‘¢ï¼Ÿè¿™ä¹Ÿæ˜¯æˆ‘ä¸€å†å¼ºè°ƒåŸºç¡€çš„åŸå› ï¼Œå¦‚æœå¯¹ä½ æ¥è¯´å“ªéƒ¨åˆ†å†…å®¹å˜å¾—é™Œç”Ÿäº†ï¼ˆæ¯”å¦‚é¢å‘å¯¹è±¡ç¼–ç¨‹çš„çŸ¥è¯†ç‚¹ï¼‰ï¼Œä¸€å®šè¦è®°å¾—åŠæ—¶å¾€å‰å¤ä¹ ï¼Œè¿™æ ·ä½ å­¦èµ·æ–°çš„æ›´å¤æ‚çš„ä¸œè¥¿ï¼Œæ‰èƒ½è½»æ¾å¾ˆå¤šã€‚</p><p>å›åˆ°æ­£é¢˜ã€‚åˆšåˆšçš„ä»£ç ï¼Œä¸»è¦æ˜¯ä¸ºäº†æŠ“å– orderbook çš„ä¿¡æ¯ã€‚äº‹å®ä¸Šï¼ŒGemini äº¤æ˜“æ‰€åœ¨å»ºç«‹æ•°æ®æµ Websocket çš„æ—¶å€™ï¼Œç¬¬ä¸€æ¡ä¿¡æ¯å¾€å¾€éå¸¸å¤§ï¼Œå› ä¸ºé‡Œé¢åŒ…å«äº†é‚£ä¸ªæ—¶åˆ»æ‰€æœ‰çš„ orderbook ä¿¡æ¯ã€‚è¿™å°±å«åšåˆå§‹æ•°æ®ã€‚ä¹‹åçš„æ¶ˆæ¯ï¼Œéƒ½æ˜¯åŸºäºåˆå§‹æ•°æ®è¿›è¡Œä¿®æ”¹çš„ï¼Œç›´æ¥å¤„ç†å³å¯ã€‚</p><h2>æ€»ç»“</h2><p>è¿™èŠ‚è¯¾æˆ‘ä»¬ç»§æ‰¿ä¸Šä¸€èŠ‚ï¼Œä»å§”æ‰˜è´¦æœ¬è®²èµ·ï¼Œç„¶åè®²è¿°äº† WebSocket çš„å®šä¹‰ã€å·¥ä½œæœºåˆ¶å’Œä½¿ç”¨æ–¹æ³•ï¼Œæœ€åä»¥ä¸€ä¸ªä¾‹å­æ”¶å°¾ï¼Œå¸¦ä½ å­¦ä¼šå¦‚ä½•çˆ¬å– Orderbook çš„ä¿¡æ¯ã€‚å¸Œæœ›ä½ åœ¨å­¦ä¹ è¿™èŠ‚è¯¾çš„å†…å®¹æ—¶ï¼Œèƒ½å¤Ÿå’Œä¸ŠèŠ‚è¯¾çš„å†…å®¹è”ç³»èµ·æ¥ï¼Œä»”ç»†æ€è€ƒ Websocket å’Œ RESTFul çš„åŒºåˆ«ï¼Œå¹¶è¯•ç€æ€»ç»“ç½‘ç»œç¼–ç¨‹ä¸­ä¸åŒæ¨¡å‹çš„é€‚ç”¨èŒƒå›´ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ€åç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜ã€‚WebSocket ä¼šä¸¢åŒ…å—ï¼Ÿå¦‚æœä¸¢åŒ…çš„è¯ï¼Œ Orderbook çˆ¬è™«åˆä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿè¿™ä¸€ç‚¹åº”è¯¥å¦‚ä½•é¿å…å‘¢ï¼Ÿæ¬¢è¿ç•™è¨€å’Œæˆ‘è®¨è®ºï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«å‡ºå»ã€‚</p>","comments":[{"had_liked":false,"id":119464,"user_name":"Jingxiao","can_delete":false,"product_type":"c1","uid":1259521,"ip_address":"","ucode":"EB966BB87132F6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJOlibibPFEWOib8ib7RtfAtxND5FUqCxxoeTuLAbBI9ic23xuwdXT4IyiaWq3Fic9RgEAYI0lBTbEp2rcg/132","comment_is_top":true,"comment_ctime":1564601608,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"9.2233722359879004e+18","product_id":100026901,"comment_content":"æ€è€ƒé¢˜ç­”æ¡ˆï¼š<br>Websocket å¯èƒ½ä¸¢åŒ…ã€‚TCP åè®®ä¿è¯äº†æ‰€æœ‰çš„åŒ…æŒ‰é¡ºåºæŠµè¾¾ï¼ˆå³ä½¿æ˜¯ä¹±åºæŠµè¾¾ï¼Œåœ¨å‰é¢çš„åŒ…æ”¶åˆ°ä¹‹å‰ï¼ŒTCP åè®®ä¸‹çš„åº•å±‚ç¨‹åºä¹Ÿä¼šè®²å…ˆåˆ°è¾¾çš„é åçš„åŒ…ç¼“å­˜ï¼Œç›´åˆ°å‰é¢çš„åŒ…æŠµè¾¾ï¼Œæ‰é€ç»™ä¸Šå±‚çš„åº”ç”¨ç¨‹åºï¼‰ï¼Œä½†æ˜¯å¹¶ä¸èƒ½ä¿è¯ä¸å¯æ¢å¤çš„é”™è¯¯å‘ç”Ÿçš„æ—¶å€™ï¼ŒåŒ…ä¸ä¼šä¸¢å¤±ã€‚è¿™ç§æƒ…å†µå‘ç”Ÿçš„æ—¶å€™ï¼Œå°±ä¼šå‡ºç° Orderbook ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªï¼ˆä»·æ ¼ï¼Œæ•°é‡ï¼‰ä¿¡æ¯æ²¡å¾—åˆ°åŠæ—¶æ›´æ–°ã€‚è¿™ç§é”™è¯¯è¶Šç§¯æ”’è¶Šå¤šçš„æƒ…å†µä¸‹ï¼Œå°±ä¼šå¯¼è‡´æœ¬åœ°çš„ Orderbook å……æ»¡åƒåœ¾ä¿¡æ¯ï¼Œå˜å¾—å®Œå…¨ä¸å¯é ã€‚å› æ­¤ä¸€ä¸ªå¾ˆå¥½çš„åšæ³•æ˜¯ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªæ—¶é—´é—´éš”ï¼Œé€šè¿‡ RESTFul æˆ–è€…å…¶ä»–æ–¹å¼é‡æ–°æŠ“ä¸€ä¸‹ Orderbook çš„ Snapshotï¼Œç„¶åå’Œæœ¬åœ°çš„ Orderbook è¿›è¡Œæ¯”å¯¹ï¼Œçº æ­£é”™è¯¯ã€‚","like_count":47},{"had_liked":false,"id":118527,"user_name":"tt","can_delete":false,"product_type":"c1","uid":1489957,"ip_address":"","ucode":"7753B79AD5A9AC","user_header":"https://static001.geekbang.org/account/avatar/00/16/bc/25/1c92a90c.jpg","comment_is_top":false,"comment_ctime":1564381268,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"186247974996","product_id":100026901,"comment_content":"websocketåŒ…çš„å®‰è£…ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤:<br><br>pip -m install websocket_clientå®‰è£…ã€‚<br><br>pip -m install websocketä¼šå®‰è£…å¦å¤–ä¸€ä¸ªå®Œå…¨ä¸åŒçš„åŒ…","like_count":44,"discussions":[{"author":{"id":1115232,"avatar":"https://static001.geekbang.org/account/avatar/00/11/04/60/64d166b6.jpg","nickname":"Fan","note":"","ucode":"3BF28670FD9407","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":342667,"discussion_content":"pip -m install websocketä¼šå®‰è£…å¦å¤–ä¸€ä¸ªå®Œå…¨ä¸åŒçš„åŒ…\nè¿™é‡Œçš„websocketæ˜¯ä»€ä¹ˆä¸œè¥¿å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610770985,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118528,"user_name":"SCAR","can_delete":false,"product_type":"c1","uid":1031209,"ip_address":"","ucode":"38C0927FA3C5FC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bc/29/022905e6.jpg","comment_is_top":false,"comment_ctime":1564381372,"is_pvip":false,"replies":[{"id":"43826","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜å±±æµæ°´","uid":"1513504","ctime":1564622855,"ip_address":"","comment_id":118528,"utype":1}],"discussion_count":1,"race_medal":0,"score":"181953007804","product_id":100026901,"comment_content":"æ€è€ƒé¢˜ï¼š<br>1. websocketåŸºäºtcpçš„ï¼Œè™½ç„¶åè®®ä¸Šæœ‰çº é”™ï¼Œé‡ä¼ å’Œç­‰å¾…çš„æœºåˆ¶ï¼Œä½†ä¸€äº›ç‰¹æ®Šçš„æƒ…å†µè¿˜æ˜¯å¯èƒ½ä¼šæœ‰ä¸¢åŒ…çš„æƒ…å†µï¼Œæ¯”å¦‚åŒæ—¶æœ‰è¶…è¿‡æœåŠ¡å™¨è´Ÿè½½çš„å®¢æˆ·ç«¯åœ¨è¯·æ±‚æ•°æ®ã€‚<br>2.å¦‚æœä¸¢åŒ…çš„æƒ…å†µå‘ç”Ÿæ—¶ï¼Œç±»ä¼¼å¼€å¤§ä¼šä¼šåœºäººäººéƒ½å‘å¾®ä¿¡å›¾ç‰‡ï¼Œçœ‹ç€WiFiä¿¡å·æ»¡æ ¼ï¼Œå´å‘ä¸å‡ºå»ï¼Œå·®ä¸å¤šä¸€æ ·çš„é“ç†çˆ¬è™«ä¹Ÿæ˜¯æ”¶ä¸åˆ°æ•°æ®çš„ã€‚<br>3.æŸ¥äº†ä¸‹websocketçš„WebSocketAppçš„å‡½æ•°ï¼Œæœ‰ä¸ªå‚æ•°on_errorï¼Œæ˜¯websocketå‘ç”Ÿé”™è¯¯çš„æ—¶å€™è§¦å‘çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç¼–å†™è¿™ä¸ªå¯¹åº”çš„å›è°ƒå‡½æ•°æ¥è®©æœåŠ¡å™¨é‡å‘æˆ–è€…å…¶ä»–æœ‰æ•ˆçš„å¤„ç†ã€‚","like_count":43,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"é«˜å±±æµæ°´","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460440,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564622855,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118594,"user_name":"tux","can_delete":false,"product_type":"c1","uid":1477811,"ip_address":"","ucode":"BB7202009FC885","user_header":"https://static001.geekbang.org/account/avatar/00/16/8c/b3/a74a7125.jpg","comment_is_top":false,"comment_ctime":1564393229,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"61693935373","product_id":100026901,"comment_content":"å¹²å¸ƒçƒå’Œtt çš„æç¤ºï¼Œè§£å†³äº†æŠ¥é”™ã€‚<br>import websocket     #pip install websocket-client<br>import _thread as thread<br><br>åœ¨æŸ¥æ‰¾èµ„æ–™æ—¶ï¼Œçœ‹åˆ°äº†ï¼š<br>import websocket<br>try:<br>    import thread<br>except ImportError:<br>    import _thread as thread<br>","like_count":15},{"had_liked":false,"id":120543,"user_name":"Claywoow","can_delete":false,"product_type":"c1","uid":1524797,"ip_address":"","ucode":"1F1C70BCE33536","user_header":"https://static001.geekbang.org/account/avatar/00/17/44/3d/35d6670d.jpg","comment_is_top":false,"comment_ctime":1564926295,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"31629697367","product_id":100026901,"comment_content":"è€å¸ˆï¼Œè¯·æ•™ä¸ªé—®é¢˜ï¼Œä¸ºä»€ä¹ˆæˆ‘æŠŠè¿™ä¸¤ä¸ªç±»åˆ†æˆä¸¤ä¸ªæ¨¡å—æ¥æµ‹è¯•çš„æ—¶å€™ï¼Œç¨‹åºä¼šè¿›å…¥æ— å“åº”çš„çŠ¶æ€ï¼Œå¥½åƒä¸€ç›´åœ¨è¿è¡Œï¼Œè¿™ä¼šæ˜¯ä»€ä¹ˆåŸå› å‘¢ï¼Ÿ","like_count":7,"discussions":[{"author":{"id":2684646,"avatar":"","nickname":"Geek_cce35a","note":"","ucode":"0AC7505A043C16","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384729,"discussion_content":"æˆ‘ä¹Ÿæ˜¯è¿™ä¸ªæƒ…å†µ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1626721901,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118457,"user_name":"å¹²å¸ƒçƒ","can_delete":false,"product_type":"c1","uid":1218173,"ip_address":"","ucode":"048ABC199D89B9","user_header":"https://static001.geekbang.org/account/avatar/00/12/96/7d/c7e8cd34.jpg","comment_is_top":false,"comment_ctime":1564368052,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"31629139124","product_id":100026901,"comment_content":"ç¬¬äºŒæ®µä»£ç å°‘äº†ä¸ªimport timeï¼Œpython3é‡Œé¢threadç”¨import _threadï¼Œä¸çŸ¥æ˜¯ä¸æ˜¯è¿™æ ·ï¼Ÿ","like_count":7,"discussions":[{"author":{"id":1043780,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ed/44/2267a5a7.jpg","nickname":"ä¸€æœŸä¸€ä¼š","note":"","ucode":"1C44A6453F6381","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6684,"discussion_content":"æˆ‘ä¹Ÿå‘ç°äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567049409,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118520,"user_name":"SCAR","can_delete":false,"product_type":"c1","uid":1031209,"ip_address":"","ucode":"38C0927FA3C5FC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bc/29/022905e6.jpg","comment_is_top":false,"comment_ctime":1564380459,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"27334184235","product_id":100026901,"comment_content":"å°è¯•å›ç­”ä¸‹Destroyçš„é—®é¢˜ï¼š<br>æŸ¥çœ‹WebsocketAppå‡½æ•°ï¼š<br>on_message: callable object which is called when received data.<br> on_message has 2 arguments.<br> The 1st argument is this class object.<br> The 2nd argument is utf-8 string which we get from the server.<br>ä½ å¦‚æœç›´æ¥on_message = self.on_messageï¼Œé‚£ä¹ˆä¼šç¼ºå°‘ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå› ä¸ºclass Crawlerç±»é‡Œon_message(self,message)æ˜¯ç¼ºå°‘å¦‚æœ€ä¸Šé¢è€å¸ˆä¾‹å­def on_message(ws, message)é‡Œçš„wsçš„ã€‚æ‰€ä»¥<br>on_message = lambda ws, message: self.on_message(message)æ˜¯é€šè¿‡lambdaè¡¥ä¸Šç¬¬ä¸€ä¸ªå‚æ•°wsã€‚","like_count":7,"discussions":[{"author":{"id":1101006,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKELX1Rd1vmLRWibHib8P95NA87F4zcj8GrHKYQL2RcLDVnxNy1ia2geTWgW6L2pWn2kazrPNZMRVrIg/132","nickname":"jxs1211","note":"","ucode":"B7F1F2D84389E7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3780,"discussion_content":"å®æµ‹on_message = self.on_messageæ²¡æœ‰é—®é¢˜ï¼Œæºç ä¸­_callbackä¸­åªæ˜¯å¯¹å›è°ƒå‡½æ•°åšäº†ç±»å‹åˆ¤æ–­ï¼Œself.on_messageæ˜¯å’Œmethodï¼Œæ‰€ä»¥ç›´æ¥å°†è¿”å›dataç»™äº†å½¢å‚messageï¼Œæ‰§è¡Œæ¥å—æ•°æ®çš„å¤„ç†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1564806261,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2369413,"avatar":"https://static001.geekbang.org/account/avatar/00/24/27/85/ddeeaf30.jpg","nickname":"dived","note":"","ucode":"141916A3BAF5A1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1101006,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKELX1Rd1vmLRWibHib8P95NA87F4zcj8GrHKYQL2RcLDVnxNy1ia2geTWgW6L2pWn2kazrPNZMRVrIg/132","nickname":"jxs1211","note":"","ucode":"B7F1F2D84389E7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375309,"discussion_content":"ç›´æ¥è¿™æ ·å†™æ˜¯ä¸ä¼šè¿”å›ä»»ä½•ä¸œè¥¿çš„ï¼Œå½“ç„¶ä¹Ÿä¸ä¼šæŠ¥é”™\nå¾—æŠŠç±»å‡½æ•°def on_message(self,  message)æ”¹æˆdef on_message(self, ws, message)æ‰æœ‰æ•ˆæœ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621569932,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":3780,"ip_address":""},"score":375309,"extra":""}]},{"author":{"id":1229070,"avatar":"https://static001.geekbang.org/account/avatar/00/12/c1/0e/2b987d54.jpg","nickname":"èœ‰è£","note":"","ucode":"77CF92496855D4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6058,"discussion_content":"```python\n                if inspect.ismethod(callback):\n                    callback(*args)\n                else:\n                    callback(self, *args)\n```\nwebsocket-client 0.56 ä¸­æœ‰ä»¥ä¸Šæºç ã€‚å¯¹ä¼ å…¥å¯¹è±¡æœ‰ä¸€ä¸ªåˆ¤æ–­ï¼Œå¦‚æœæ˜¯[æ–¹æ³•]ï¼Œåˆ™ä¸éœ€è¦æŠŠ self ä¼ è¿›å»ï¼Œä¹Ÿå°±æ˜¯è€å¸ˆä»£ç é‡Œçš„ ws; å¦‚æœä¸æ˜¯ [æ–¹æ³•]ï¼Œé‚£ä¹ˆæ­£ç¡®ä¼ å‚æƒ…å†µä¸‹å°±ä¼šæ˜¯[å‡½æ•°]ï¼Œæ­¤æ—¶ä¼šæŠŠ self ä¼ è¿›å…¥ã€‚å…¶ä»–ç‰ˆæœ¬å¦‚ä½•å¤„ç†çš„å°±ä¸å¾—è€ŒçŸ¥äº†ã€‚\n\né¢å¤–æƒ³è¯´ï¼Œç§ä»¥ä¸ºè¿™æ ·çš„è®¾è®¡æ˜¯ä¸ºäº†è®©ä½¿ç”¨è€…åœ¨è‡ªå·±è®¾è®¡çš„ç±»ä¸­å¼ºåˆ¶ç»‘å®šä¸€ä¸ª WebSocketApp å¯¹è±¡ï¼Œé¿å…ç”¨æˆ·åœ¨ä½¿ç”¨ç±»çš„æƒ…å†µä¸‹è¿˜æŠŠ ws åˆ°å¤„ä¼ ã€‚å‡å…äº†èµ„æºå¼€é”€ï¼Œè¿˜åšåˆ°äº†è®©ä»£ç ç®€æ´ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566645812,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":120204,"user_name":"jxs1211","can_delete":false,"product_type":"c1","uid":1101006,"ip_address":"","ucode":"B7F1F2D84389E7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKELX1Rd1vmLRWibHib8P95NA87F4zcj8GrHKYQL2RcLDVnxNy1ia2geTWgW6L2pWn2kazrPNZMRVrIg/132","comment_is_top":false,"comment_ctime":1564806274,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18744675458","product_id":100026901,"comment_content":"å®æµ‹on_message = self.on_messageæ²¡æœ‰é—®é¢˜ï¼Œæºç ä¸­_callbackä¸­åªæ˜¯å¯¹å›è°ƒå‡½æ•°åšäº†ç±»å‹åˆ¤æ–­ï¼Œself.on_messageæ˜¯å’Œmethodï¼Œæ‰€ä»¥ç›´æ¥å°†è¿”å›dataç»™äº†å½¢å‚messageï¼Œæ‰§è¡Œæ¥å—æ•°æ®çš„å¤„ç†","like_count":4},{"had_liked":false,"id":118553,"user_name":"JustDoDT","can_delete":false,"product_type":"c1","uid":1127175,"ip_address":"","ucode":"6AF0B80F00EAEF","user_header":"https://static001.geekbang.org/account/avatar/00/11/33/07/8f351609.jpg","comment_is_top":false,"comment_ctime":1564386982,"is_pvip":false,"replies":[{"id":"43825","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜å±±æµæ°´","uid":"1513504","ctime":1564622776,"ip_address":"","comment_id":118553,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18744256166","product_id":100026901,"comment_content":"websocketèµ„æ–™<br>https:&#47;&#47;pypi.org&#47;project&#47;websocket_client&#47;","like_count":5,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"é«˜å±±æµæ°´","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460451,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564622776,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118472,"user_name":"TKbook","can_delete":false,"product_type":"c1","uid":1073829,"ip_address":"","ucode":"F6E0E99CC79059","user_header":"https://static001.geekbang.org/account/avatar/00/10/62/a5/43aa0c27.jpg","comment_is_top":false,"comment_ctime":1564371406,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"14449273294","product_id":100026901,"comment_content":"å› æ­¤ï¼Œåº”è¯¥ä½ æ³¨æ„åˆ°äº†ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ selfï¼Œè¿™é‡Œå¦‚æœç›´æ¥å†™æˆ on_message = self.on_message å°†ä¼šå‡ºé”™ã€‚<br>ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å°†å‡½æ•°å†æ¬¡åŒ…è£…ä¸€ä¸‹ã€‚è¿™é‡Œæˆ‘ä½¿ç”¨äº†å‰é¢å­¦è¿‡çš„åŒ¿åå‡½æ•°ï¼Œæ¥ä¼ é€’ä¸­é—´çŠ¶æ€ï¼Œæ³¨æ„æˆ‘ä»¬åªéœ€è¦ messageï¼Œå› æ­¤ä¼ å…¥ message å³å¯ã€‚<br>è¿™æ®µæ²¡çœ‹æ‡‚ï¼Œè€å¸ˆæˆ–è€…å“ªä½å¤§ç¥èƒ½è§£é‡Šä¸€ä¸‹ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1026955,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ab/8b/fdb853c4.jpg","nickname":"Weining Cao","note":"","ucode":"6E3DB699A41518","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":157994,"discussion_content":"è¿™é‡Œä¸€å¼€å§‹æˆ‘ä¹Ÿæ²¡çœ‹æ‡‚ï¼Œåæ¥å›è¿‡å¤´å¤ä¹ äº†è€å¸ˆlambdaå‡½æ•°çš„è¯¾ï¼Œè¯•ç€æ¥è§£é‡Šä¸‹ã€‚\non_messageä¸€èˆ¬æ˜¯ç»‘å®šä¸€ä¸ªå¸¦2ä¸ªå‚æ•°çš„æ™®é€šå‡½æ•°çš„ã€‚è¿™é‡Œself. on_messageæ˜¯ç±»çš„æˆå‘˜å‡½æ•°ï¼Œæ‰€ä»¥éœ€è¦è½¬æ¢æˆæ™®é€šçš„åŒå‚æ•°å‡½æ•°ã€‚æ€ä¹ˆè½¬å‘¢ï¼Ÿ\nf = lambda wsï¼Œmessage: self.on_message(message)\n\nè¿™ä¸ªå®šä¹‰çš„æ„æ€å°±æ˜¯ä½ å¯ä»¥ç›´æ¥è°ƒç”¨f(ws, message), å®ƒç­‰ä»·äºè°ƒç”¨self.on_message(message)ã€‚æ‰€ä»¥è¿™é‡Œæˆ‘å‘ç°lambdaå‡½æ•°å¯ä»¥æœ‰å¦‚æ­¤å·§å¦™çš„ç”¨æ³•ï¼šæŠŠç±»çš„æˆå‘˜å‡½æ•°è½¬æ¢æˆä¸€ä¸ªæ™®é€šå‡½æ•°ã€‚\n\nä¸çŸ¥é“æˆ‘çš„ç†è§£å¯¹ä¸å¯¹ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1580539792,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1489957,"avatar":"https://static001.geekbang.org/account/avatar/00/16/bc/25/1c92a90c.jpg","nickname":"tt","note":"","ucode":"7753B79AD5A9AC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3296,"discussion_content":"è°ƒç”¨ç±»çš„ç»‘å®šæ–¹æ³•æ—¶ï¼Œå¦‚æœæŠŠæ–¹æ³•çœ‹åšæ™®é€šå‡½æ•°ï¼Œé‚£è¿™ä¸ªå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¿…é¡»æ˜¯selfã€‚\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1564379460,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":299760,"user_name":"BinyGo","can_delete":false,"product_type":"c1","uid":2639381,"ip_address":"","ucode":"182ADA4532C98B","user_header":"https://static001.geekbang.org/account/avatar/00/28/46/15/0f215f66.jpg","comment_is_top":false,"comment_ctime":1624848418,"is_pvip":true,"discussion_count":0,"race_medal":3,"score":"10214783010","product_id":100026901,"comment_content":"    ç†è§£ï¼šon_message = lambda ws, message: self.on_message(message)<br>    æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸ªlambdaçš„å‡½æ•°å†™æ³•ï¼š<br>    g = lambda x, y=2, z=3: x + y + z<br>    g(1, z=4, y=5)  # è¾“å‡ºç»“æœæ˜¯10<br>    è¿™ä¸ªè¡¨è¾¾å¼ä¹Ÿå¯ä»¥å†™æˆ<br>    def g(x, y=2, z=3):<br>        return x + y + z<br><br><br>    é‚£ä¹ˆå†æ¥ç†è§£è€å¸ˆçš„å†™æ³•ï¼Œä¹Ÿå°±å¥½ç†è§£å¤šäº†<br><br>    websocketåŸæœ¬çš„on_messageè¢«æˆ‘ä»¬ä¿®æ”¹ä¸ºåŒ¿åå‡½æ•°ï¼Œ<br>    ä¹Ÿå°±æ˜¯å½“websocketå›è°ƒçš„æ—¶å€™ï¼Œæœ¬æ¥æ˜¯å¸¦2ä¸ªå‚æ•°wså’Œmessageå»æ‰¾on_messageå‡½æ•°çš„ï¼Œå˜æˆäº†å»æ‰¾æˆ‘ä»¬å†™çš„åŒ¿åå‡½æ•°<br>    on_message(ws, message)ï¼Œæ”¹æˆåŒ¿åå‡½æ•°ï¼šanonymous(ws, message)ï¼Œä¹Ÿå¯¹åº”äº†lambda ws, message å› æ­¤è¿™é‡Œå‚æ•°å¿…é¡»ä¸€è‡´<br>    def anonymous(ws, message):  # è¿™é‡Œå‡½æ•°åç§°éšæ„ï¼Œå› ä¸ºæ˜¯åŒ¿åå‡½æ•°ï¼Œåªæ˜¯æ¥ç†è§£lambdaçš„å†™æ³•<br>        self.on_message(message) #è¿™é‡Œå†è®©ç¨‹åºå»æ‰§è¡Œæˆ‘ä»¬éœ€è¦çš„ä»£ç ã€‚ç»•äº†ä¸€ä¸ªåœˆ<br><br>    ä¸ºäº†éªŒè¯è¿™ä¸ªé€»è¾‘æµç¨‹ï¼Œä¸‹é¢2è¡Œä»£ç å‚æ•°åæ”¹ä¸€ä¸‹ï¼Œåšä¸€ä¸ªè¾“å‡ºï¼Œæ‰§è¡Œè€å¸ˆçš„ä»£ç å¤§æ¦‚å°±20å¤šç§’å°±æœ‰æ‰“å°é‡‡é›†çš„æ•°æ®ï¼ŒéªŒè¯æˆåŠŸ<br>    self.ws = websocket.WebSocketApp(&#39;wss:&#47;&#47;api.gemini.com&#47;v1&#47;marketdata&#47;{}&#39;.format(symbol),<br>                                     on_message=lambda gg, mmm: self.on_message(mmm))<br>    def on_message(self, mmm):<br>        print(mmm)<br>    æœ€åä¸çŸ¥é“æœ‰æ²¡æ›´ä¼˜ç¾çš„å†™æ³•å‘¢ï¼Ÿï¼Ÿï¼Ÿ","like_count":2},{"had_liked":false,"id":219188,"user_name":"shiziwen","can_delete":false,"product_type":"c1","uid":1016917,"ip_address":"","ucode":"ADADC770D82D66","user_header":"https://static001.geekbang.org/account/avatar/00/0f/84/55/1e40bd61.jpg","comment_is_top":false,"comment_ctime":1589963745,"is_pvip":false,"replies":[{"id":"84947","content":"orderbook çš„ä¹°æ–¹å’Œå–æ–¹ï¼šhttps:&#47;&#47;www.investopedia.com&#47;terms&#47;b&#47;bid-and-ask.asp","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜å±±æµæ°´","uid":"1513504","ctime":1593301613,"ip_address":"","comment_id":219188,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10179898337","product_id":100026901,"comment_content":"è¯·é—®æ–‡ç« ä¸­ï¼Œæ¥å£è·å–çš„æ•°æ®ä¸­ï¼Œbidså’Œaskæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"é«˜å±±æµæ°´","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495706,"discussion_content":"orderbook çš„ä¹°æ–¹å’Œå–æ–¹ï¼šhttps://www.investopedia.com/terms/b/bid-and-ask.asp","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593301613,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":179828,"user_name":"å»ºå¼º","can_delete":false,"product_type":"c1","uid":1397126,"ip_address":"","ucode":"62B03D0E0C64EC","user_header":"https://static001.geekbang.org/account/avatar/00/15/51/86/b5fd8dd8.jpg","comment_is_top":false,"comment_ctime":1582105798,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"10172040390","product_id":100026901,"comment_content":"ç½‘ç»œç¼–ç¨‹æ²¡æœ‰ç»éªŒï¼Œæƒ³é—®ä¸‹è€å¸ˆï¼Œæˆ‘ç”¨çš„æ˜¯Python3ï¼Œç”¨ws = websocket.WebSocketApp(&quot;ws:&#47;&#47;echo.websocket.org&#47;&quot;,<br>                              on_message = on_message,<br>                              on_open = on_open)æ˜¯æŠ¥é”™çš„ï¼Œé”™è¯¯ä¿¡æ¯ï¼šAttributeError: module &#39;websocket&#39; has no attribute &#39;WebSocketApp&#39;ï¼Œè¿™æ˜¯ä»€ä¹ˆåŸå› ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":2143277,"avatar":"https://static001.geekbang.org/account/avatar/00/20/b4/2d/44680897.jpg","nickname":"Resolution","note":"","ucode":"F74C067C58CD05","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":341496,"discussion_content":"è£…ä¸€ä¸‹websocket-client-py3  è¿™ä¸ªåŒ…å°±å¯ä»¥äº†","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1610437770,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1021548,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/96/6c/1ed88ae9.jpg","nickname":"saneryee","note":"","ucode":"607A1BF09391ED","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":328683,"discussion_content":"è¿˜æœ‰æ–‡ä»¶åä¸è¦å‘½åä¸º websocket.pyï¼Œå¦åˆ™ä¹Ÿä¼šå‡ºç°è¿™ä¸ªé”™è¯¯ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1606208822,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1032464,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c1/10/28d5a686.jpg","nickname":"Longerian","note":"","ucode":"0B74EE70D09A2A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":228972,"discussion_content":"å¦‚æœæ˜¯åœ¨jupyteré‡Œæµ‹è¯•ï¼Œå·²ç»å®‰è£…é‡Œ websocketï¼Œå¯ä»¥è¦å…ˆå¸è½½websocketï¼Œå†é‡æ–°å®‰è£…ä¸‹ websocket-clientï¼Œå†é‡å¯ä¸‹jupyter","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586596667,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1705468,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/05/fc/bceb3f2b.jpg","nickname":"å¼€å¿ƒå“¥","note":"","ucode":"D44C1F03B23C5A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":226621,"discussion_content":"è¿™ä¸ªè¯´æ˜¯è¦è£…websocket_client","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586437529,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":155930,"user_name":"Merlin","can_delete":false,"product_type":"c1","uid":1151085,"ip_address":"","ucode":"3EBF6C78C5F731","user_header":"https://static001.geekbang.org/account/avatar/00/11/90/6d/f0dd5cb3.jpg","comment_is_top":false,"comment_ctime":1574779909,"is_pvip":false,"replies":[{"id":"60078","content":"å—¯å—¯","user_name":"ä½œè€…å›å¤","user_name_real":"Jingxiao","uid":"1259521","ctime":1574900538,"ip_address":"","comment_id":155930,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10164714501","product_id":100026901,"comment_content":"å¯¹äºweb socketçš„ç¼–ç¨‹ï¼Œå¯ä»¥ç”¨asyncioï¼Œæˆ‘è§‰å¾—ç”¨asyncioæ¥å¼€å‘web socketæ›´ä¸ºæ–¹ä¾¿","like_count":2,"discussions":[{"author":{"id":1259521,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJOlibibPFEWOib8ib7RtfAtxND5FUqCxxoeTuLAbBI9ic23xuwdXT4IyiaWq3Fic9RgEAYI0lBTbEp2rcg/132","nickname":"Jingxiao","note":"","ucode":"EB966BB87132F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475930,"discussion_content":"å—¯å—¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574900538,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118912,"user_name":"Geek_adeba6","can_delete":false,"product_type":"c1","uid":1313206,"ip_address":"","ucode":"78B05B44FCC268","user_header":"","comment_is_top":false,"comment_ctime":1564466785,"is_pvip":false,"replies":[{"id":"43824","content":"ç†è®ºä¸Šä»–å¯ä»¥è¿™ä¹ˆåšï¼Œä½†æ˜¯ Gemini ç›®å‰å®˜æ–¹åªæ”¯æŒ RESTFul å’Œ Websocketï¼Œä»¥åŠé‡‘èå·¥ç¨‹ä¸­ç»å¸¸ç”¨åˆ°çš„ FIX åè®®ï¼Œè¿™äº›åè®®éƒ½æœ‰ç€å¹¿æ³›æ”¯æŒçš„å¼€æºåº“å’Œç»è¿‡å……åˆ†æ—¶é—´éªŒè¯çš„å®‰å…¨æ€§ï¼Œåˆ‡æ¢åˆ°æ–°çš„åè®®æ²¡æœ‰å¤ªå¤§å¿…è¦ï¼Œä½†æ˜¯ä»¥åçš„äº‹æƒ…è°ä¹Ÿè¯´ä¸å®šå‘¢","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜å±±æµæ°´","uid":"1513504","ctime":1564622765,"ip_address":"","comment_id":118912,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10154401377","product_id":100026901,"comment_content":"æƒ³è¯·é—®æ˜¯å¦å¯ä»¥ä½¿ç”¨STOMPåè®®ä¸Geminiè¿™æ ·çš„äº¤æ˜“å¹³å°é€šä¿¡, åƒæ¶ˆæ¯é˜Ÿåˆ—rabbitmq æœ‰ stompçš„plugins","like_count":3,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"é«˜å±±æµæ°´","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460658,"discussion_content":"ç†è®ºä¸Šä»–å¯ä»¥è¿™ä¹ˆåšï¼Œä½†æ˜¯ Gemini ç›®å‰å®˜æ–¹åªæ”¯æŒ RESTFul å’Œ Websocketï¼Œä»¥åŠé‡‘èå·¥ç¨‹ä¸­ç»å¸¸ç”¨åˆ°çš„ FIX åè®®ï¼Œè¿™äº›åè®®éƒ½æœ‰ç€å¹¿æ³›æ”¯æŒçš„å¼€æºåº“å’Œç»è¿‡å……åˆ†æ—¶é—´éªŒè¯çš„å®‰å…¨æ€§ï¼Œåˆ‡æ¢åˆ°æ–°çš„åè®®æ²¡æœ‰å¤ªå¤§å¿…è¦ï¼Œä½†æ˜¯ä»¥åçš„äº‹æƒ…è°ä¹Ÿè¯´ä¸å®šå‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564622765,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":333272,"user_name":"Geek_688e7c","can_delete":false,"product_type":"c1","uid":1763183,"ip_address":"","ucode":"1361D27AA36772","user_header":"","comment_is_top":false,"comment_ctime":1644242171,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"5939209467","product_id":100026901,"comment_content":"æŒ‰ç…§è€å¸ˆçš„ä»£ç æ¥éƒ½æ²¡æœ‰ååº”ï¼Œæ˜¯ä¸æ˜¯Urlå¤±æ•ˆäº†ï¼Ÿ æˆ‘ç›´æ¥åœ¨æµè§ˆå™¨é‡Œè®¿é—®Urlæ˜¯è¯´æ— æ³•è®¿é—®ã€‚<br>å‡ºç°ç¨‹åºè¿è¡Œæ²¡æœ‰æŠ¥é”™ä½†æ˜¯æ²¡æœ‰ä»»ä½•è¾“å‡ºå’Œç»“æœçš„æƒ…å†µï¼Œæ˜¯ä¸æ˜¯å°±æ˜¯æœåŠ¡ç«¯å‡ºäº†é—®é¢˜å‘¢","like_count":2,"discussions":[{"author":{"id":1177382,"avatar":"https://static001.geekbang.org/account/avatar/00/11/f7/26/0e254010.jpg","nickname":"ç‹ä½³","note":"","ucode":"C447B807ED4CDA","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586052,"discussion_content":"urléœ€è¦æ¢¯å­æ‰èƒ½è®¿é—®ï¼Œå¼€äº†æ¢¯å­ä¹‹åéœ€è¦åœ¨ä»£ç ä¸­å¢åŠ proxyé¡¹ï¼Œå‚ç…§ä¸‹é¢çš„é“¾æ¥å°±å¯ä»¥äº†\nhttps://blog.csdn.net/tz_zs/article/details/119363470","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661949174,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"é™•è¥¿"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1085046,"avatar":"https://static001.geekbang.org/account/avatar/00/10/8e/76/6d55e26f.jpg","nickname":"å¼ æ™“è¾‰","note":"","ucode":"1CD9717DE399C5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552183,"discussion_content":"åŒæ ·çš„é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645339746,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":131285,"user_name":"hel793","can_delete":false,"product_type":"c1","uid":1414844,"ip_address":"","ucode":"4E4F51EE321162","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKxqOFPRvW2d6WEC705zuSSvxBOBxibBib4XQxBGAGPOx2bRGqhsSeQkUNa0Z11OJoKbuGsNaMR4GNg/132","comment_is_top":false,"comment_ctime":1567691985,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5862659281","product_id":100026901,"comment_content":"Latency is 2630.9838048 ms","like_count":1},{"had_liked":false,"id":129910,"user_name":"å°ä¾ é¾™æ—‹é£","can_delete":false,"product_type":"c1","uid":1126441,"ip_address":"","ucode":"073F3924A99835","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/29/d6816ebf.jpg","comment_is_top":false,"comment_ctime":1567324279,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5862291575","product_id":100026901,"comment_content":"æœ€è¿‘åœ¨å¤ä¹ jsçš„ç›¸å…³çŸ¥è¯†ï¼Œjsä¸­socket.ioåº“å°è£…äº†websocketï¼ŒåŒæ—¶ä¹ŸåŒ…å«äº†å…¶ä»–è¿æ¥æ–¹å¼ï¼Œæ¯”å¦‚ajaxã€‚socket.on(event_name, callback)ä¸­çš„å†…ç½®äº‹ä»¶åæœ‰10ç§ã€‚https:&#47;&#47;socket.io&#47;docs&#47;client-api&#47;","like_count":1},{"had_liked":false,"id":120213,"user_name":"å°ä¾ é¾™æ—‹é£","can_delete":false,"product_type":"c1","uid":1126441,"ip_address":"","ucode":"073F3924A99835","user_header":"https://static001.geekbang.org/account/avatar/00/11/30/29/d6816ebf.jpg","comment_is_top":false,"comment_ctime":1564807952,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5859775248","product_id":100026901,"comment_content":"ä¼šä¸¢åŒ…ï¼Œåœ¨on_error(ws, error)å›è°ƒå‡½æ•°ä¸­åšå¤„ç†","like_count":1},{"had_liked":false,"id":345586,"user_name":"è‚–è‚–","can_delete":false,"product_type":"c1","uid":1500176,"ip_address":"","ucode":"5F958993EA8E4A","user_header":"","comment_is_top":false,"comment_ctime":1652413455,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652413455","product_id":100026901,"comment_content":"å¹¶å‘æ‰§è¡Œwebsocketè¿æ¥ï¼Œéƒ½èƒ½è¿æ¥æˆåŠŸï¼Œä½†éƒ½ç«‹é©¬æ–­äº†ï¼Œåªä¼šè¿æ¥ä¸€ä¸ªï¼Œæ˜¯ä»€ä¹ˆåŸå› å‘¢","like_count":0},{"had_liked":false,"id":340647,"user_name":"Geek_fc975d","can_delete":false,"product_type":"c1","uid":2459939,"ip_address":"","ucode":"05B6507FE4349B","user_header":"https://static001.geekbang.org/account/avatar/00/25/89/23/e71f180b.jpg","comment_is_top":false,"comment_ctime":1648990388,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1648990388","product_id":100026901,"comment_content":"æˆ‘å®‰è£…äº†websocket_Clientäº†ï¼Œä½†æ˜¯å‘ç°è¿™ä¸ªå‡½æ•°run_foreveæ€»æ˜¯æç¤ºæ‰¾ä¸åˆ°å¯¹åº”å‡½æ•°ï¼Œè¯·é—®å¤§å®¶æœ‰é‡åˆ°ç›¸åŒé—®é¢˜çš„å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":320665,"user_name":"å°åº","can_delete":false,"product_type":"c1","uid":1554764,"ip_address":"","ucode":"7C8367CDB47163","user_header":"https://static001.geekbang.org/account/avatar/00/17/b9/4c/8c9edc85.jpg","comment_is_top":false,"comment_ctime":1636444984,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636444984","product_id":100026901,"comment_content":"sha384æ˜¯éå¯¹ç§°ç®—æ³•ï¼Ÿéš¾é“ä¸æ˜¯è®¡ç®—æ¶ˆæ¯è®¤è¯ç çš„å—ï¼Ÿè§£å†³ä¸å¯å¦è®¤æ€§å’Œå®Œæ•´æ€§çš„","like_count":0},{"had_liked":false,"id":300346,"user_name":"Ilovek8s","can_delete":false,"product_type":"c1","uid":1542450,"ip_address":"","ucode":"64DF0F7D0CF0B0","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/a8PMLmCTCBa40j7JIy3d8LsdbW5hne7lkk9KOGQuiaeVk4cn06KWwlP3ic69BsQLpNFtRTjRdUM2ySDBAv1MOFfA/132","comment_is_top":false,"comment_ctime":1625124633,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1625124633","product_id":100026901,"comment_content":"http2æœ€æ€•åŒ…å¤´é˜»å¡","like_count":0},{"had_liked":false,"id":256518,"user_name":"Geek_a16bbc","can_delete":false,"product_type":"c1","uid":2008721,"ip_address":"","ucode":"6F12AFEF638413","user_header":"","comment_is_top":false,"comment_ctime":1603646155,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603646155","product_id":100026901,"comment_content":"é‚„æ˜¯ä¸èƒ½ç†è§£ç‚ºä½•éœ€è¦ç”¨lambdaæ‰èƒ½æŠŠselfå‚³é€²å»ï¼Ÿ<br>lambda ws, message: self.on_message(message))<br>ws å’Œselfæœ‰ä»€éº¼é—œä¿‚ï¼Ÿ","like_count":0},{"had_liked":false,"id":234252,"user_name":"daowuli_chihai","can_delete":false,"product_type":"c1","uid":2017371,"ip_address":"","ucode":"13E5DD278D8E95","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIiaeebUYxl7e1b8DhQGz7v6uibGcytfL8iaTke1S6NwSVxicOy5iaLGbRn2aZtxZy8vVnF6j3fjtxDEbQ/132","comment_is_top":false,"comment_ctime":1594630805,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594630805","product_id":100026901,"comment_content":"ä¸‹é¢ä»£ç  ã€import threadã€‘æŠ¥é”™ï¼Œpython3è¦ä¸è¦æ”¹æˆã€import _threadã€‘<br><br><br>import websocket<br>import thread<br><br># åœ¨æ¥æ”¶åˆ°æœåŠ¡å™¨å‘é€æ¶ˆæ¯æ—¶è°ƒç”¨<br>def on_message(ws, message):<br>    print(&#39;Received: &#39; + message)<br><br># åœ¨å’ŒæœåŠ¡å™¨å»ºç«‹å®Œæˆè¿æ¥æ—¶è°ƒç”¨   <br>def on_open(ws):<br>    # çº¿ç¨‹è¿è¡Œå‡½æ•°<br>    def gao():<br>        # å¾€æœåŠ¡å™¨ä¾æ¬¡å‘é€0-4ï¼Œæ¯æ¬¡å‘é€å®Œä¼‘æ¯0.01ç§’<br>        for i in range(5):<br>            time.sleep(0.01)<br>            msg=&quot;{0}&quot;.format(i)<br>            ws.send(msg)<br>            print(&#39;Sent: &#39; + msg)<br>        # ä¼‘æ¯1ç§’ç”¨äºæ¥æ”¶æœåŠ¡å™¨å›å¤çš„æ¶ˆæ¯<br>        time.sleep(1)<br>        <br>        # å…³é—­Websocketçš„è¿æ¥<br>        ws.close()<br>        print(&quot;Websocket closed&quot;)<br>    <br>    # åœ¨å¦ä¸€ä¸ªçº¿ç¨‹è¿è¡Œgao()å‡½æ•°<br>    thread.start_new_thread(gao, ())<br><br><br>if __name__ == &quot;__main__&quot;:<br>    ws = websocket.WebSocketApp(&quot;ws:&#47;&#47;echo.websocket.org&#47;&quot;,<br>                              on_message = on_message,<br>                              on_open = on_open)<br>    <br>    ws.run_forever()<br><br>#### è¾“å‡º #####<br>Sent: 0<br>Sent: 1<br>Received: 0<br>Sent: 2<br>Received: 1<br>Sent: 3<br>Received: 2<br>Sent: 4<br>Received: 3<br>Received: 4<br>Websocket closed","like_count":0},{"had_liked":false,"id":219144,"user_name":"shiziwen","can_delete":false,"product_type":"c1","uid":1016917,"ip_address":"","ucode":"ADADC770D82D66","user_header":"https://static001.geekbang.org/account/avatar/00/0f/84/55/1e40bd61.jpg","comment_is_top":false,"comment_ctime":1589955490,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1589955490","product_id":100026901,"comment_content":"æƒ³é—®ä¸€ä¸ªä¸šåŠ¡é€»è¾‘çš„é—®é¢˜ï¼Œæƒ³è·å–ä¸€æ®µæ—¶é—´å†…çš„è®¢å•ï¼Œç”¨æ¥æµ‹è¯•è‡ªå·±çš„äº¤æ˜“æ‰€é€»è¾‘ï¼Œåº”è¯¥ä½¿ç”¨å“ªä¸ªæ¥å£å‘¢ï¼Ÿorderbookå’Œtick dataçš„æ¦‚å¿µè¿˜æ²¡æœ‰ç†è§£é€ã€‚<br>Geminiçš„è´¦æˆ·æ²¡æœ‰æ³¨å†ŒæˆåŠŸï¼Œæ‰€ä»¥è°ƒè¯•é‡åˆ°äº†äº›é—®é¢˜ã€‚","like_count":0},{"had_liked":false,"id":180670,"user_name":"YqY","can_delete":false,"product_type":"c1","uid":1524154,"ip_address":"","ucode":"73FB936045DCB9","user_header":"https://static001.geekbang.org/account/avatar/00/17/41/ba/ae028565.jpg","comment_is_top":false,"comment_ctime":1582361413,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1582361413","product_id":100026901,"comment_content":"è¯·é—®æŠ“å– orderbook ä¿¡æ¯çš„è„šæœ¬åœ¨ç¬¬50å’Œ51è¡Œè½¬æ¢æˆå­—å…¸çš„æ„ä¹‰ä½•åœ¨ï¼Ÿæ²¡æ€ä¹ˆçœ‹æ˜ç™½ï¼Œè¯·è€å¸ˆè§£ç­”ä¸‹","like_count":0,"discussions":[{"author":{"id":1352697,"avatar":"https://static001.geekbang.org/account/avatar/00/14/a3/f9/9180d6d1.jpg","nickname":"szm","note":"","ucode":"53E753D3D04431","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":263064,"discussion_content":"è¿™ä¹ˆè®¾è®¡çš„ç»“æœæ˜¯ä¹°å–å­—å…¸æœ€å¤šä¿ç•™10æ¡ä¿¡æ¯ï¼Œå¯èƒ½æ˜¯è¿™å°±å·²ç»è¶³å¤Ÿç­–ç•¥åˆ†æäº†å§ï¼Œè€Œä¸”è¿™æ ·å¯ä»¥é™ä½åé¢æ¯æ¬¡æ›´æ–°messageæ—¶çš„å¤„ç†æ—¶é—´ï¼Œå› ä¸ºä»ç¬¬äºŒæ¬¡æ¥å—messageå›è°ƒæ—¶ï¼Œå­—å…¸æœ€å¤šåªæœ‰10æ¡ä¿¡æ¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589168554,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":120206,"user_name":"jxs1211","can_delete":false,"product_type":"c1","uid":1101006,"ip_address":"","ucode":"B7F1F2D84389E7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKELX1Rd1vmLRWibHib8P95NA87F4zcj8GrHKYQL2RcLDVnxNy1ia2geTWgW6L2pWn2kazrPNZMRVrIg/132","comment_is_top":false,"comment_ctime":1564806679,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564806679","product_id":100026901,"comment_content":"è¯·é—®è€å¸ˆï¼Œä¸‹é¢ä»£ç ä¸­select.selectæ˜¯ä»€ä¹ˆæ„æ€ï¼Œè¿™æ®µä»£ç ä¸»è¦èµ·åˆ°ä»€ä¹ˆä½œç”¨<br>class Dispatcher:<br>    def __init__(self, app, ping_timeout):<br>        self.app  = app<br>        self.ping_timeout = ping_timeout<br><br>    def read(self, sock, read_callback, check_callback):<br>        while self.app.sock.connected:<br>            r, w, e = select.select(<br>                    (self.app.sock.sock, ), (), (), self.ping_timeout)<br>            if r:<br>                if not read_callback():<br>                    break<br>            check_callback()<br>","like_count":0},{"had_liked":false,"id":119279,"user_name":"_stuView","can_delete":false,"product_type":"c1","uid":1244561,"ip_address":"","ucode":"C2D4AAB08515F1","user_header":"https://static001.geekbang.org/account/avatar/00/12/fd/91/65ff3154.jpg","comment_is_top":false,"comment_ctime":1564549647,"is_pvip":false,"replies":[{"id":"43823","content":"å¦‚æœä¸€å®šè¦å›ç­” Python æ˜¯ä¸æ˜¯è§£é‡Šå‹è¯­è¨€ï¼Œé‚£ä¹ˆç­”æ¡ˆæ˜¯å®ƒæ˜¯éƒ¨åˆ†ç¼–è¯‘å‹è¯­è¨€ã€‚å®ƒå’Œ Java ç±»ä¼¼ï¼Œä¸ä¼šåƒ C++ ä¸€æ ·ç¼–è¯‘åˆ°æœºå™¨è¯­è¨€ï¼Œè€Œæ˜¯ç¼–è¯‘æˆå­—èŠ‚ç æ¥æé«˜æ‰§è¡Œé€Ÿåº¦ã€‚https:&#47;&#47;stackoverflow.com&#47;questions&#47;6889747&#47;is-python-interpreted-or-compiled-or-both","user_name":"ä½œè€…å›å¤","user_name_real":"é«˜å±±æµæ°´","uid":"1513504","ctime":1564622570,"ip_address":"","comment_id":119279,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1564549647","product_id":100026901,"comment_content":"æˆ‘ä¹‹å‰çœ‹åˆ°Linuxå…¬ä¼—å·è®²pythonå¹¶ä¸æ˜¯ä¸€ä¸ªè§£é‡Šå‹è¯­è¨€ï¼Œè€Œæ˜¯ä¸€ä¸ªè¿è¡Œåœ¨è™šæ‹Ÿæœºä¸Šçš„è¯­è¨€https:&#47;&#47;mp.weixin.qq.com&#47;s&#47;Yqwk_eXO1t5N2cjRz_u0sw","like_count":0,"discussions":[{"author":{"id":1513504,"avatar":"https://static001.geekbang.org/account/avatar/00/17/18/20/75ea3b20.jpg","nickname":"é«˜å±±æµæ°´","note":"","ucode":"71E513B5937481","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460822,"discussion_content":"å¦‚æœä¸€å®šè¦å›ç­” Python æ˜¯ä¸æ˜¯è§£é‡Šå‹è¯­è¨€ï¼Œé‚£ä¹ˆç­”æ¡ˆæ˜¯å®ƒæ˜¯éƒ¨åˆ†ç¼–è¯‘å‹è¯­è¨€ã€‚å®ƒå’Œ Java ç±»ä¼¼ï¼Œä¸ä¼šåƒ C++ ä¸€æ ·ç¼–è¯‘åˆ°æœºå™¨è¯­è¨€ï¼Œè€Œæ˜¯ç¼–è¯‘æˆå­—èŠ‚ç æ¥æé«˜æ‰§è¡Œé€Ÿåº¦ã€‚https://stackoverflow.com/questions/6889747/is-python-interpreted-or-compiled-or-both","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564622570,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1244561,"avatar":"https://static001.geekbang.org/account/avatar/00/12/fd/91/65ff3154.jpg","nickname":"_stuView","note":"","ucode":"C2D4AAB08515F1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3601,"discussion_content":"å¥½çš„ï¼Œè°¢è°¢æ‚¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564628574,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":119088,"user_name":"enjoylearning","can_delete":false,"product_type":"c1","uid":1000237,"ip_address":"","ucode":"DCAF8538DEA277","user_header":"https://static001.geekbang.org/account/avatar/00/0f/43/2d/af86d73f.jpg","comment_is_top":false,"comment_ctime":1564501053,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564501053","product_id":100026901,"comment_content":"æ—¢ç„¶æ˜¯ç½‘ç»œä¼ è¾“å°±ä¸€å®šä¼šä¸¢åŒ…ï¼Œæ‰€ä»¥éœ€è¦å»ºä¸€ä¸ªé˜Ÿåˆ—","like_count":0},{"had_liked":false,"id":118427,"user_name":"jutsu","can_delete":false,"product_type":"c1","uid":1124574,"ip_address":"","ucode":"95CEDEF5D085CF","user_header":"https://static001.geekbang.org/account/avatar/00/11/28/de/54667f13.jpg","comment_is_top":false,"comment_ctime":1564364101,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1564364101","product_id":100026901,"comment_content":"æœ‰æ²¡æœ‰å¼‚æ­¥éé˜»å¡è¿™ç±»çš„ï¼Œéå¾—websocketå—","like_count":0},{"had_liked":false,"id":118398,"user_name":"æ— æ³•è¨€å–».","can_delete":false,"product_type":"c1","uid":1322328,"ip_address":"","ucode":"7F375BE388D4FC","user_header":"https://static001.geekbang.org/account/avatar/00/14/2d/58/aa35c402.jpg","comment_is_top":false,"comment_ctime":1564360565,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564360565","product_id":100026901,"comment_content":"1.ä¼šä¸¢åŒ…<br>2.timeouté”™è¯¯<br>3.ç”¨æ¯æ¬¡è¯·æ±‚çš„æ•°æ®é‡å’Œæ•°æ®æ—¶é—´è¿›è¡Œå¯¹æ¯”<br>ä¸çŸ¥é“æœ‰æ²¡æœ‰è¯´å¯¹1ä¸ªï¼š)","like_count":0}]}