{"id":17818,"title":"98 |【实验】Spring Cloud Hystrix 实验","content":"无","comments":[{"had_liked":false,"id":257881,"user_name":"一道阳光","can_delete":false,"product_type":"c3","uid":1239557,"ip_address":"","ucode":"F35207CCCEC6E2","user_header":"https://static001.geekbang.org/account/avatar/00/12/ea/05/c0d8014d.jpg","comment_is_top":false,"comment_ctime":1604191195,"is_pvip":false,"replies":[{"id":93910,"content":"Hystrix是采用Archaius(https:&#47;&#47;github.com&#47;Netflix&#47;archaius)做配置的，Archaius支持运行期动态调整配置，凡是使用DynamicXXXProperty(例如DynamicIntProperty或者DynamicStringProperty等)的地方，这些地方都是动态可以获取属性值的。\n\n但是Hystrix的文档也没有明确说明到底哪些配置支持运行期动态调，所以建议还是要看源码 ～ 对于某个配置项，查看源码看它是否对应DynamicXXXProperty类型，如果是，就说明动态可调整。\n\n但是并不是所有动态属性都会生效，具体要看应用逻辑是如何处理动态属性的。对于线程池的参数，我认为只能初始化时一次性配置，不能动态调整，也就是一般不能在运行期动态重新初始化线程池，否则依赖线程池的应用行为不确定（如果你自己改造另当别论）。但是像并发请求的信号量，这种配置可以动态调整。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1604244297,"ip_address":"","comment_id":257881,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"应用服务要做到Hystrix的参数动态配置，是不是钥在原生的基础之上进行改造？比如线程池相关的参数在服务初始化后可以动态配置吗？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":508487,"discussion_content":"Hystrix是采用Archaius(https://github.com/Netflix/archaius)做配置的，Archaius支持运行期动态调整配置，凡是使用DynamicXXXProperty(例如DynamicIntProperty或者DynamicStringProperty等)的地方，这些地方都是动态可以获取属性值的。\n\n但是Hystrix的文档也没有明确说明到底哪些配置支持运行期动态调，所以建议还是要看源码 ～ 对于某个配置项，查看源码看它是否对应DynamicXXXProperty类型，如果是，就说明动态可调整。\n\n但是并不是所有动态属性都会生效，具体要看应用逻辑是如何处理动态属性的。对于线程池的参数，我认为只能初始化时一次性配置，不能动态调整，也就是一般不能在运行期动态重新初始化线程池，否则依赖线程池的应用行为不确定（如果你自己改造另当别论）。但是像并发请求的信号量，这种配置可以动态调整。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604244297,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":168536,"user_name":"xu_xuanjie","can_delete":false,"product_type":"c3","uid":1624667,"ip_address":"","ucode":"C60311B38ACEF9","user_header":"https://static001.geekbang.org/account/avatar/00/18/ca/5b/f01eed53.jpg","comment_is_top":false,"comment_ctime":1578105835,"is_pvip":false,"replies":[{"id":65816,"content":"尽量使用Spring Cloud套餐，经过包装开发体验较好，能够省很多事情。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1578397895,"ip_address":"","comment_id":168536,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"老师，每个模块讲到最后都有介绍Spring Cloud系列的，我有个疑问就是听了老师的课，比如理解了Hystrix后，是不是直接可以使用Spring Cloud系列，毕竟在代码上看来是优雅很多。当然，像Spring Cloud Config和Apollo这种显著的区别当然不能对比；主要是对Spring Cloud Hystrix，Spring Cloud Zuul这些只是在Hystrix和Zuul的基础上方便于使用而集成的，应该如何选择？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":480242,"discussion_content":"尽量使用Spring Cloud套餐，经过包装开发体验较好，能够省很多事情。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578397895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":129253,"user_name":"Geek_382ccc","can_delete":false,"product_type":"c3","uid":1520267,"ip_address":"","ucode":"3E40727B8772AA","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKicUgL8bc6EDqlS73icGODUXdXmicFb8UYNNGFkibtq4z9j0yGJY6WK4sQmic3pqLZmFqw3rfE1Sa0zNw/132","comment_is_top":false,"comment_ctime":1567071371,"is_pvip":false,"replies":[{"id":48106,"content":"你好，课程开发时候spring boot正式release版本是1.5.x，所以就用该版本做演示。\n\nspring boot升级变动比较频繁，难免碰到不兼容的坑，spring cloud netflix明确支持hystrix + dashboard的，可以参考其官方文档：\nhttps:&#47;&#47;spring.io&#47;projects&#47;spring-cloud-netflix，\n从你的错误看，像是有不兼容问题，建议换spring boot版本再试。\n\n这里有spring cloud 2搭建hystrix&#47;dashboard案例，可以参考：\nhttps:&#47;&#47;www.cnblogs.com&#47;jonban&#47;p&#47;hystrix-dashboard.html","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1567083748,"ip_address":"","comment_id":129253,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"请问示例项目中用的是1.5.X版本的spring boot，为什么不用2.X版本的呢？\n我在本地新建了spring boot2.1.6版本的项目，引入gateway和hystrix依赖，使用yml配置路由规则和降级设置，可以正常启动并运行访问； 但是当引入dashboard后，启动时就会报错，解决了spring-boot-starter-web包的冲突后，依然报错\norg.springframework.beans.factory.BeanDefinitionStoreException: Failed to process import candidates for configuration class [com.example.springcloudgatewayexample.SpringCloudGatewayExampleApplication]; nested exception is java.lang.IllegalStateException: Failed to introspect annotated methods on class org.springframework.cloud.netflix.hystrix.dashboard.HystrixDashboardConfiguration\n无法正常启动；网上搜不到解决方案。老师知道是什么原因吗？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465361,"discussion_content":"你好，课程开发时候spring boot正式release版本是1.5.x，所以就用该版本做演示。\n\nspring boot升级变动比较频繁，难免碰到不兼容的坑，spring cloud netflix明确支持hystrix + dashboard的，可以参考其官方文档：\nhttps://spring.io/projects/spring-cloud-netflix，\n从你的错误看，像是有不兼容问题，建议换spring boot版本再试。\n\n这里有spring cloud 2搭建hystrix/dashboard案例，可以参考：\nhttps://www.cnblogs.com/jonban/p/hystrix-dashboard.html","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567083748,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1190154,"avatar":"https://static001.geekbang.org/account/avatar/00/12/29/0a/7c4778af.jpg","nickname":"爱因斯丹","note":"","ucode":"27E65BE6F8E22A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":185182,"discussion_content":"1、2.0版本后依赖名称发生了变化，增加了netflix\n        <dependency>\n            <groupId>org.springframework.cloud</groupId>\n            <artifactId>spring-cloud-starter-netflix-hystrix</artifactId>\n        </dependency>\n        <dependency>\n            <groupId>org.springframework.cloud</groupId>\n            <artifactId>spring-cloud-starter-netflix-hystrix-dashboard</artifactId>\n        </dependency>\n2、使用hystrix stream需要注册HystrixMetricsStreamServlet，在启动类里增加以下代码\n        @Bean\n\tpublic ServletRegistrationBean getServlet(){\n\t\tHystrixMetricsStreamServlet streamServlet = new HystrixMetricsStreamServlet();\n\t\tServletRegistrationBean registrationBean = new ServletRegistrationBean(streamServlet);\n\t\tregistrationBean.setLoadOnStartup(1);\n\t\tregistrationBean.addUrlMappings(&#34;/hystrix.stream&#34;);\n\t\tregistrationBean.setName(&#34;HystrixMetricsStreamServlet&#34;);\n\t\treturn registrationBean;\n\t}\n3、开启hystrix的注解是@EnableHystrix","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582601344,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1520267,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKicUgL8bc6EDqlS73icGODUXdXmicFb8UYNNGFkibtq4z9j0yGJY6WK4sQmic3pqLZmFqw3rfE1Sa0zNw/132","nickname":"Geek_382ccc","note":"","ucode":"3E40727B8772AA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6866,"discussion_content":"感谢，我又重新摸索了下。结论是Spring cloud gateway 和dashboard不兼容。\n如果引入了spring-cloud-starter-gateway来做路由转发，再启用dashboard，启动时出错。\n将项目中的gateway依赖和yml中的路由转发规则去掉，使用HystrixCommond注解方式转发，再引入dashboard，可以正常使用。\n比较遗憾至今还没分析到不兼容出错原因。\n个人觉得使用HystrixCommond注解配置一些ip和路径这种方式不太灵活，毕竟是在源代码里面，不便于维护。但是geteway又不能集成dashboard，请问生成环境中，也是通过HystrixCommond注解这种原生使用方式吗？\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567149124,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}