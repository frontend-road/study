{"id":624099,"title":"09｜监控概论（上）：有哪些方法可以指导监控数据采集？","content":"<p>你好，我是秦晓辉。</p><p>前面几讲我们介绍了监控的一些原理和搭建方法，这一讲开始，我们进入监控实战部分，看看具体怎么监控不同类型的目标对象。我会先用两讲的时间讲一下监控方法论和典型的监控数据采集原理。</p><p>这一讲我们主要介绍监控方法论，因为要监控的目标五花八门，怎样才能让监控数据更加完备，怎样才能知道哪些指标更加重要，解决这些问题都需要监控方法论的指导。目前业界比较流行的方法论有 Google 的四个黄金指标、RED方法、USE方法，下面我们一一介绍一下。</p><h2>Google的四个黄金指标</h2><p>Google的四个黄金指标着眼点在服务监控，这四个指标分别是延迟、流量、错误和饱和度。</p><ul>\n<li>延迟：服务请求所花费的时间，比如用户获取商品列表页面调用的某个接口，花费30毫秒。这个指标需要区分成功请求和失败请求，因为失败的请求可能会立刻返回，延迟很小，会扰乱正常的请求延迟数据。</li>\n<li>流量：HTTP服务的话就是每秒HTTP请求数，RPC服务的话就是每秒RPCCall的数量，如果是数据库，可能用数据库系统的事务量来作为流量指标。</li>\n<li>错误：请求失败的速率，即每秒有多少请求失败，比如HTTP请求返回了500错误码，说明这个请求是失败的，或者虽然返回的状态码是200，但是返回的内容不符合预期，也认为是请求失败。</li>\n<li>饱和度：描述应用程序有多“满”，或者描述受限的资源，比如CPU密集型应用，CPU使用率就可以作为饱和度指标。</li>\n</ul><!-- [[[read_end]]] --><p>有了这个方法论的指导，我们就知道服务监控应该重点关注哪些指标了。如果要为某个服务配置监控大盘，监控大盘里就要包含上述这几类指标。如果要配置告警规则，也要重点照顾这几类指标。</p><p>可以这么说，只要上述这些指标都是正常的，这个服务就是健康的。反之，如果这些指标有问题，服务就是不健康的，并且大概率已经影响了上游服务甚至终端用户。</p><p>Google的四个黄金指标主要是针对服务的监控，Weaveworks的工程师认为饱和度这个指标比较高级，延迟、流量、错误这三个指标相对更重要，所以将其简化为RED方法，下面我们来看一下RED方法的定义。</p><h2>RED方法</h2><ul>\n<li>（Request）Rate：请求速率，每秒请求数。</li>\n<li>（Request）Errors：错误，每秒错误请求数。</li>\n<li>（Request）Duration：延迟，每个请求的延迟分布情况。</li>\n</ul><p>三个英文单词取首字母组成RED方法，姑且可以看做是Google四个黄金指标的简化版，作者很逗，说为什么起名为RED呢？因为他们内部普遍应用USE方法，为了和USE相呼应，所以取了RED这个自认为响亮的名字。这个USE又是什么方法呢？下面我们就来介绍一下。</p><h2>USE方法</h2><p>USE方法的提出者是大名鼎鼎的Brendan Gregg，如果你没听过这个名字，也没关系，你应该听过火焰图吧，性能分析用的火焰图就是这位大哥发明的。你可以点开 <a href=\"https://www.brendangregg.com/usemethod.html\">USE 方法</a>的官方介绍看看。</p><p><img src=\"https://static001.geekbang.org/resource/image/8f/73/8f5c3de1e0d1873bacb68a5748deef73.jpg?wh=1192x469\" alt=\"图片\" title=\"火焰图（图片源自网络）\"></p><p>USE是使用率（Utilization）、饱和度（Saturation）、错误（Error）的缩写，主要用于分析资源问题。什么是资源？在Gregg对模型的定义中，是指传统意义上的物理服务器组件，比如CPU、硬盘等，但现在很多人已经扩展了资源的范围，把一些软件资源也包含在内。下面我们对使用率、饱和度、错误做一个更详细的解释。</p><ul>\n<li>使用率：这个我们最熟悉，比如内存使用率、CPU使用率等，是一个百分比。</li>\n<li>饱和度：资源排队工作的指标，无法再处理额外的工作。通常用队列长度表示，比如在iostat里看到的aqu-sz就是队列长度。</li>\n<li>错误：资源错误事件的计数。比如malloc()失败次数、通过ifconfig看到的errors、dropped包量。有很多错误是以系统错误日志的方式暴露的，没法直接拿到某个统计指标，此时可以进行日志关键字监控。</li>\n</ul><p>USE方法和Google四个黄金指标配合使用，我们就可以知道不同类别的监控对象应该关注的核心指标是什么了。那监控对象都有哪些类别呢？换句话说，我们做了哪些方面的监控才算是把监控体系建设完备了？下面我们就来梳理一下监控对象的类别。</p><h2>监控分类</h2><p>为了方便你理解，我画了一张图，把监控分成4个类别。</p><p><img src=\"https://static001.geekbang.org/resource/image/0f/32/0f6091c107b263bcd481c278d821ee32.jpg?wh=3038x1850\" alt=\"\"></p><h3>业务监控</h3><p>这类指标是管理层非常关注的，代表企业营收，或者跟客户主流程相关，类似BI数据。不过相比BI数据，业务监控指标有两点不同。</p><ul>\n<li>对精确度要求没有那么高：因为监控只要发现趋势异常就可以，至于是从5000变成了1000还是变成了1001，没有什么区别。</li>\n<li>对实时性要求很高：很多BI数据可能是小时级别或天级别的，这个时效性无法满足监控的需求，监控是希望越早发现问题越好，要是一个小时才发现问题，黄花菜都凉了。</li>\n</ul><p>技术人员应该针对这类指标做高优保障，如果所有的指标都同等对待，重要的告警就容易被普通告警淹没，所以<strong>告警一定要分级对待</strong>。</p><p>很多公司的故障管理比较粗放，只要有报警事件产生，就认为是有故障，这是不对的。在微服务和云原生技术盛行的当下，某个机器的CPU飙高了，或者IO打满了，对最终用户的体验可能是没有任何影响的，但是核心业务指标异常，一定是故障，因为这类指标异常代表着最终用户体验受损，或者造成了直接资损。</p><p>作为中后台的团队，做的很多稳定性保障的工作不容易让管理层看到，业务指标是一个突破口，如果能够把这类指标梳理清楚，是很容易让老板看到我们的价值的。</p><h3>应用监控</h3><p>应用监控就是指对应用程序（Application）的监控，Google的四个黄金指标、RED方法主要就是针对应用监控的。</p><p>每个公司都应该有统一的APM（Application Performance Management），也就是应用性能管理方案，从指标着手的话一般使用埋点机制来做，比如 StatsD、Prometheus SDK 等，或者直接分析接入层日志，从日志提取指标；从链路追踪着手的话可以使用 Zipkin、SkyWalking 等。</p><p>像 Java 这种字节码技术的语言，采用 JavaAgent 技术可以做到代码无侵入埋点。但是像 Go、C++这类语言，一般都是采用埋点机制来做，由统一的工具团队提供一些框架，在框架里内置埋点逻辑，这样普通研发人员也就基本不会有代码侵入的感觉了。</p><h3>组件监控</h3><p>这里我们把各类数据库、中间件、云平台，统称为组件，组件监控是非常考验知识广度的。一般监控系统的研发人员，很难把每个组件的机理都搞清楚，所以定义统一的接入数据规范，让专业的人去采集各个组件的数据是更合理的做法。</p><p>有个好现象是，很多组件的研发人员，已经开始让组件自身直接支持 Prometheus 协议，吐出 metrics 数据，除了 etcd、Kubernetes 这些云原生时代的组件，一些老的组件，比如 RabbitMQ、ZooKeeper 等，也在新版本里直接做了支持，实属行业幸事。</p><h3>资源监控</h3><p>基础资源的监控，主要是针对设备和网络，设备又分为服务器、网络设备，网络监控又分为连通性监控、质量监控、流量监控。下面我们分别做个简单介绍。</p><h4>设备监控</h4><p>一提起设备监控，你可能立马会想到CPU、内存使用率监控，除了这些之外，如果我们想获取硬件模块的健康状况，比如电源电压、风扇转速、主板环境温度等，就需要走IPMI协议，通过带外网络采集。</p><p>网络设备，典型的就是交换机、防火墙，一般是通过SNMP协议获取指标，比如交换机各个网口的流量、包量。也可以通过syslog的方式，把交换机的日志转存出来，到服务器上分析。</p><h4>网络监控</h4><p>网络连通性监控最为常见，通过ICMP协议，部署探针机器，对目标设备做PING探测，能探通就表示能连通，探测失败就是连不通。当然，有些机器可能是禁PING的，此时就需要用TCP或HTTP之类的协议去探测了。</p><p>PING探测可以拿到丢包率和延迟数据，我们可以用这些数据分析网络质量。比如两个机房之间的专线，我们用A机房的探针去探测B机房的目的设备，就能轻易知道机房之间的网络质量情况。</p><p>最后是流量监控，也会用在多个地方，比如机器的网卡流量、交换机的网口流量、机房出口流量，也是整个监控体系的重要一环。</p><p>到这里，监控的分类我们就介绍完了，你可以看一下自己公司的监控数据，查漏补缺。上面的分类主要是针对服务端的监控，还有一个大类是端监控，比如iOS应用，我们会关注是否卡顿、有没有崩溃、白屏之类的，这算是另一个领域，这里就不展开介绍了。</p><h2>小结</h2><p>我们这一讲关注的是监控方法论，因为监控对象很多，监控指标也很多，哪些指标比较重要就需要有一个指导性理论。从大类上来看，分为针对服务的Google四个黄金指标和RED方法，以及针对资源的USE方法。这些方法可以解答哪些指标更为重要这个问题。</p><p>对于监控覆盖完备性问题，我总结了一个监控分类图，共有业务、应用、组件、资源四个大类，当然还有端监控，如果这些类别的监控都建立起来了，监控体系就是相对完备的。</p><p>最后，我把这一讲的内容整理成了一张脑图，方便你理解记忆。</p><p><img src=\"https://static001.geekbang.org/resource/image/2y/78/2yy1d9787ac328fc1c245f4dae0dfb78.png?wh=4240x2977\" alt=\"\"></p><h2>互动时刻</h2><p>“因为监控数据不完备，导致线上环境出了问题却没有发现”这个情况时有发生。比如机器进程总数没有监控、nf_conntrack:table full没有监控、ulimit没有监控、MySQL允许的最大连接数没有监控等等。你可以把你遇到的情况也来留言分享一下，这个信息库非常有价值，也欢迎你把今天的内容分享给你身边的朋友，邀他一起学习。我们下一讲再见！</p>","comments":[{"had_liked":false,"id":369194,"user_name":"Clay","can_delete":false,"product_type":"c1","uid":1646028,"ip_address":"上海","ucode":"B9058AC1681875","user_header":"https://static001.geekbang.org/account/avatar/00/19/1d/cc/f5ec3f23.jpg","comment_is_top":false,"comment_ctime":1677214356,"is_pvip":false,"replies":[{"id":134554,"content":"https:&#47;&#47;promcat.io&#47; 这个可以做一些参考","user_name":"作者回复","user_name_real":"编辑","uid":1001078,"ctime":1677242231,"ip_address":"北京","comment_id":369194,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100522501,"comment_content":"老师，有没有比较全的监控信息库，通过这个信息库可以查漏补缺，感觉价值很大","like_count":6,"discussions":[{"author":{"id":1001078,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/46/76/67e111da.jpg","nickname":"巴辉特","note":"","ucode":"DCBB150A99548D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":606641,"discussion_content":"https://promcat.io/ 这个可以做一些参考","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677242231,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1567397,"avatar":"https://static001.geekbang.org/account/avatar/00/17/ea/a5/1b4a65ba.jpg","nickname":"邢永胜","note":"","ucode":"B64AB17046B42E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":655062,"discussion_content":"https://promcat.io 好像已经打不开了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1734077267,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"江苏","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":371456,"user_name":"penng","can_delete":false,"product_type":"c1","uid":1033169,"ip_address":"重庆","ucode":"6087CFCB0AC434","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c3/d1/bdf895bf.jpg","comment_is_top":false,"comment_ctime":1679969200,"is_pvip":false,"replies":[{"id":135606,"content":"这其实是两个维度的。\n\n比如jvm监控，监控了很多指标，有些指标是饱和度指标，有些是latency指标（比如后文介绍kafka监控，就是通过jmx暴露了很多指标，其中就有latency相关的）。","user_name":"作者回复","user_name_real":"编辑","uid":1001078,"ctime":1680176361,"ip_address":"北京","comment_id":371456,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100522501,"comment_content":"老师好，像进程监控，jvm监控，应该归类到以上四类监控的哪类里去呢？","like_count":3,"discussions":[{"author":{"id":1001078,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/46/76/67e111da.jpg","nickname":"巴辉特","note":"","ucode":"DCBB150A99548D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":611576,"discussion_content":"这其实是两个维度的。\n\n比如jvm监控，监控了很多指标，有些指标是饱和度指标，有些是latency指标（比如后文介绍kafka监控，就是通过jmx暴露了很多指标，其中就有latency相关的）。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1680176361,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":367310,"user_name":"Mori","can_delete":false,"product_type":"c1","uid":1296477,"ip_address":"广东","ucode":"FE60CDDFFA7EA3","user_header":"https://static001.geekbang.org/account/avatar/00/13/c8/5d/edfa625d.jpg","comment_is_top":false,"comment_ctime":1675131338,"is_pvip":false,"replies":[{"id":133796,"content":"这是个好问题。如果想在一个地方做关联查询，只能把所有数据拉到一个中心，如果对关联查询没有需求，同时使用阿里云的监控、腾讯云的监控、华为云的监控、本地IDC的自建监控，分别去管理，也问题不大，不过告警事件最好聚拢到一起，要不然，故障协同处理是个问题","user_name":"作者回复","user_name_real":"编辑","uid":1001078,"ctime":1675146527,"ip_address":"北京","comment_id":367310,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100522501,"comment_content":"比如云厂商的mysql、redis、kafka等资源，是对接云厂商的监控指标好一点还是自己部署exporter采集好点呢，比如说腾讯云可以通过qcloud_exporter对接mysql&#47;redis&#47;lb的指标数据拉取到本地，然后通过prometheus采集，当实例比较多的情况下，通过qcloud_exporter拉取指标可能耗时比较久","like_count":3,"discussions":[{"author":{"id":1001078,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/46/76/67e111da.jpg","nickname":"巴辉特","note":"","ucode":"DCBB150A99548D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":601205,"discussion_content":"这是个好问题。如果想在一个地方做关联查询，只能把所有数据拉到一个中心，如果对关联查询没有需求，同时使用阿里云的监控、腾讯云的监控、华为云的监控、本地IDC的自建监控，分别去管理，也问题不大，不过告警事件最好聚拢到一起，要不然，故障协同处理是个问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675146528,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1296477,"avatar":"https://static001.geekbang.org/account/avatar/00/13/c8/5d/edfa625d.jpg","nickname":"Mori","note":"","ucode":"FE60CDDFFA7EA3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1001078,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/46/76/67e111da.jpg","nickname":"巴辉特","note":"","ucode":"DCBB150A99548D","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":601538,"discussion_content":"是的，需要跟cmdb服务树有关联需求从而打上service标签，目前考虑对接云产品的监控两种方案\n1：部署categraf或者exporter采集云mysql/redis等指标，在采集配置里获取group/service等标签信息\n2：通过云厂商自带的接口获取某产品监控指标，因为存在唯一的资源id，通过资源id去查询cmdb该资源关联关联的服务，在打上对应标签。\n不知道哪种方式好一点\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675264853,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":601205,"ip_address":"广东","group_id":0},"score":601538,"extra":""}]},{"author":{"id":1088211,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9a/d3/aeedbfc2.jpg","nickname":"Geek_n5ge3l","note":"","ucode":"EECB4701FF03F5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":627981,"discussion_content":"现在的云产商也都自带Prometheus云产品的监控了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1694743792,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":367002,"user_name":"隆哥","can_delete":false,"product_type":"c1","uid":1793362,"ip_address":"福建","ucode":"C251D9F349997D","user_header":"https://static001.geekbang.org/account/avatar/00/1b/5d/52/21275675.jpg","comment_is_top":false,"comment_ctime":1674792350,"is_pvip":false,"replies":[{"id":133735,"content":"👍🏻","user_name":"作者回复","user_name_real":"编辑","uid":1001078,"ctime":1674872771,"ip_address":"北京","comment_id":367002,"utype":1}],"discussion_count":4,"race_medal":0,"score":2,"product_id":100522501,"comment_content":"系统随着时间的推移，应用不断增加，依赖服务也越来越复杂，对于监控来说复杂度就越高了。我遇到的是使用第三方对象存储服务，自有域名ssl证书过期之后才发现，因为没有监控该域名的ssl证书过期时间。","like_count":3,"discussions":[{"author":{"id":1001078,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/46/76/67e111da.jpg","nickname":"巴辉特","note":"","ucode":"DCBB150A99548D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600769,"discussion_content":"👍🏻","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1674872771,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":3538344,"avatar":"","nickname":"Geek_d1a6b1","note":"","ucode":"2C98082DFC164A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":623134,"discussion_content":"找到啦，首先证书如何是在云平台购买的话，\n1.云平台自带监控，但是他有配额的，如果你买的泛域名那只需要配置一个就好了。\n2.使用开源工具。\nhttps://github.com/louislam/uptime-kuma","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1689063582,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1044517,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/25/d3da7ca9.jpg","nickname":"wuyang","note":"","ucode":"81000322FF96A7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":601605,"discussion_content":"后面有找到监控SSL证书过期的解决方案吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675316167,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江","group_id":0},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1314623,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0f/3f/6cf8b0c4.jpg","nickname":"Jacky","note":"","ucode":"347628A46E8D0F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1044517,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f0/25/d3da7ca9.jpg","nickname":"wuyang","note":"","ucode":"81000322FF96A7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":608382,"discussion_content":"nagios有check_ssl的相关脚本","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678415768,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":601605,"ip_address":"山东","group_id":0},"score":608382,"extra":""}]}]},{"had_liked":false,"id":369319,"user_name":"Geek_89cb03","can_delete":false,"product_type":"c1","uid":1910782,"ip_address":"上海","ucode":"1FCCA074D57F8D","user_header":"https://static001.geekbang.org/account/avatar/00/1d/27/fe/701cf60e.jpg","comment_is_top":false,"comment_ctime":1677405201,"is_pvip":false,"replies":[{"id":134572,"content":"在19、20讲哦","user_name":"编辑回复","user_name_real":"编辑","uid":2843479,"ctime":1677412510,"ip_address":"北京","comment_id":369319,"utype":2}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100522501,"comment_content":"请问老师，业务监控与应用监控有什么区别？ 业务监控采用什么工具或方法实现？","like_count":1,"discussions":[{"author":{"id":2843479,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/63/57/cba4c68b.jpg","nickname":"小虎子🐯","note":"","ucode":"4C9530B3FB407B","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":606800,"discussion_content":"在19、20讲哦","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677412510,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":8}","child_discussion_number":2,"child_discussions":[{"author":{"id":1910782,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/27/fe/701cf60e.jpg","nickname":"Geek_89cb03","note":"","ucode":"1FCCA074D57F8D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2843479,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/63/57/cba4c68b.jpg","nickname":"小虎子🐯","note":"","ucode":"4C9530B3FB407B","race_medal":0,"user_type":8,"is_pvip":false},"discussion":{"id":606842,"discussion_content":"嗯，应用监控可以使用埋点，日志方式进行监控。那业务监控呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677456514,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":606800,"ip_address":"上海","group_id":0},"score":606842,"extra":""},{"author":{"id":2843479,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/63/57/cba4c68b.jpg","nickname":"小虎子🐯","note":"","ucode":"4C9530B3FB407B","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":1910782,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/27/fe/701cf60e.jpg","nickname":"Geek_89cb03","note":"","ucode":"1FCCA074D57F8D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":606847,"discussion_content":"打开看看里面的内容。\n\n来自第19讲\n根据第 9 讲中我们对监控做的分类，还有应用和业务层面的监控没有介绍，接下来我会用两讲来介绍这部分内容。\n💡 因为业务指标的生成也需要应用程序侧来实现，所以这两个层面的监控可以统称为应用监控。\n在指标监控的世界里，应用和业务层面的监控有两种典型手段，一种是在应用程序里埋点，另一种是分析日志，从日志中提取指标。埋点的方式性能更好，也更灵活，只是对应用程序有一定侵入性，而分析日志的话对应用程序侵入性较小，但由于链路较长、需要做文本分析处理，性能较差，需要更多算力支持。这一讲我们先来介绍第一种方式，使用埋点的方式做应用和业务监控。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1677461466,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":606842,"ip_address":"北京","group_id":0},"score":606847,"extra":""}]}]},{"had_liked":false,"id":368276,"user_name":"maybe","can_delete":false,"product_type":"c1","uid":1475528,"ip_address":"广西","ucode":"93D160F617E750","user_header":"https://static001.geekbang.org/account/avatar/00/16/83/c8/5ce842f6.jpg","comment_is_top":false,"comment_ctime":1676095445,"is_pvip":false,"replies":[{"id":134096,"content":"🩸的教训～","user_name":"作者回复","user_name_real":"编辑","uid":1001078,"ctime":1676102150,"ip_address":"北京","comment_id":368276,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100522501,"comment_content":"redis连接数、ulimit、mysql cpu都没监控，服务挂了好几次","like_count":0,"discussions":[{"author":{"id":1001078,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/46/76/67e111da.jpg","nickname":"巴辉特","note":"","ucode":"DCBB150A99548D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":603310,"discussion_content":"🩸的教训～","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1676102151,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":367222,"user_name":"mj4ever","can_delete":false,"product_type":"c1","uid":1005549,"ip_address":"北京","ucode":"73028E537099CC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/ed/d50de13c.jpg","comment_is_top":false,"comment_ctime":1675049151,"is_pvip":true,"replies":[{"id":133787,"content":"👍🏻","user_name":"作者回复","user_name_real":"编辑","uid":1001078,"ctime":1675058024,"ip_address":"北京","comment_id":367222,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100522501,"comment_content":"阿里云的Redis服务发生主从切换，导致我们应用程序无法进行队列数据的消费（redisson客户端没有感知到外部集群服务发生变化，采用的是永久阻塞模式）；如果我们对Redis中的队列有监控，当队列深度持续增高或长时间停留在一个大于0的情况，就可以及时发现问题，当然，程序本身也有问题，应该设置一个超时时长，而不是永久阻塞。","like_count":0,"discussions":[{"author":{"id":1001078,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/46/76/67e111da.jpg","nickname":"巴辉特","note":"","ucode":"DCBB150A99548D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":601095,"discussion_content":"👍🏻","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1675058024,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":367120,"user_name":"hshopeful","can_delete":false,"product_type":"c1","uid":1200048,"ip_address":"湖北","ucode":"EE8D6E0A40607E","user_header":"https://static001.geekbang.org/account/avatar/00/12/4f/b0/ab179368.jpg","comment_is_top":false,"comment_ctime":1674960189,"is_pvip":false,"replies":[{"id":133771,"content":"👍🏻","user_name":"作者回复","user_name_real":"编辑","uid":1001078,"ctime":1674978154,"ip_address":"北京","comment_id":367120,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100522501,"comment_content":"1、只有进程存活性监控，但是进程处于僵死状态无法发现，需要添加对进程中探活接口的监测\n2、如果监控 agent 中有日志监控功能，在日志量很大，待匹配的正则表达式很复杂，agent 本身的资源消耗会很大，需要做好限制和监控","like_count":0,"discussions":[{"author":{"id":1001078,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/46/76/67e111da.jpg","nickname":"巴辉特","note":"","ucode":"DCBB150A99548D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600964,"discussion_content":"👍🏻","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1674978154,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1143422,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/TKywGoQEbNyWzKHV5xsc1bPvCwlA1NWgHtabsd4xGSibvyWdUjF3Qo8CMhgOjJ6Q83ribh5BxKO8X8xaER2w3Axw/132","nickname":"frekoala","note":"","ucode":"A5C77D82692046","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":607104,"discussion_content":"进程僵死的状态的监测是需要依赖进程本身提供有探活接口吗 一般情况是怎么监测的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677627613,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":366991,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"北京","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1674781872,"is_pvip":false,"replies":[{"id":133734,"content":"1，云厂商自带监控，不过有人觉得不好用，会自己整\n2，大厂其实很少用监控大屏，不同业务线可能会有业务指标的监控大屏，普通指标一般不太值得放大屏上。终端监控从服务端角度主要看在线连接数，如果在线连接数掉了，说明大量设备离线，IoT场景很实用。安卓和iOS的App的话，也有监控需求，比如卡顿率、首屏加载时间等，端上监控是另一个话题了，不在本专栏探讨范围","user_name":"作者回复","user_name_real":"编辑","uid":1001078,"ctime":1674872751,"ip_address":"北京","comment_id":366991,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100522501,"comment_content":"请教老师两个问题：\nQ1：采用云主机，会有自动监控吗？\n网站采用云主机，比如阿里云主机，会有自动监控吗？ 尤其是设备和网络方面，阿里云会提供监控吗？\nQ2：网站会提供一个大屏来监控手机吗？\n大厂会对终端采用一个大屏进行监控吗？或者，我建一个网站，是否需要对终端进行监控？（包括安卓和iOS）","like_count":0,"discussions":[{"author":{"id":1001078,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/46/76/67e111da.jpg","nickname":"巴辉特","note":"","ucode":"DCBB150A99548D","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600768,"discussion_content":"1，云厂商自带监控，不过有人觉得不好用，会自己整\n2，大厂其实很少用监控大屏，不同业务线可能会有业务指标的监控大屏，普通指标一般不太值得放大屏上。终端监控从服务端角度主要看在线连接数，如果在线连接数掉了，说明大量设备离线，IoT场景很实用。安卓和iOS的App的话，也有监控需求，比如卡顿率、首屏加载时间等，端上监控是另一个话题了，不在本专栏探讨范围","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1674872751,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"北京","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"奕","note":"","ucode":"73CEA468CE70C3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":600730,"discussion_content":"云厂商 都会为 虚拟机提供一些监控数据的报表，供使用者查看。 \n但是没有报警，如果想使用告警功能，可以把虚拟机的数据 接入云厂商的日志服务，自己做大盘监控 告警","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1674804034,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":377025,"user_name":"javaadu","can_delete":false,"product_type":"c1","uid":1000519,"ip_address":"广东","ucode":"8C0B140F1C8992","user_header":"https://static001.geekbang.org/account/avatar/00/0f/44/47/3ddb94d0.jpg","comment_is_top":false,"comment_ctime":1687850587,"is_pvip":true,"replies":null,"discussion_count":0,"race_medal":1,"score":2,"product_id":100522501,"comment_content":"监控指标需要分级管控，重要性从高到低","like_count":0}]}