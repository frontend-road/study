{"id":145464,"title":"26 | ä½¿ç”¨é˜»å¡I/Oå’Œçº¿ç¨‹æ¨¡å‹ï¼šæ¢ä¸€ç§è½»é‡çš„æ–¹å¼","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç››å»¶æ•ï¼Œè¿™é‡Œæ˜¯ç½‘ç»œç¼–ç¨‹å®æˆ˜ç¬¬26è®²ï¼Œæ¬¢è¿å›æ¥ã€‚</p><p>åœ¨å‰é¢ä¸€è®²ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†è¿›ç¨‹æ¨¡å‹æ¥å¤„ç†ç”¨æˆ·è¿æ¥è¯·æ±‚ï¼Œè¿›ç¨‹åˆ‡æ¢ä¸Šä¸‹æ–‡çš„ä»£ä»·æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œå¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ç§è½»é‡çº§çš„æ¨¡å‹å¯ä»¥å¤„ç†å¤šç”¨æˆ·è¿æ¥è¯·æ±‚ï¼Œè¿™å°±æ˜¯çº¿ç¨‹æ¨¡å‹ã€‚è¿™ä¸€è®²é‡Œï¼Œæˆ‘ä»¬å°±æ¥äº†è§£ä¸€ä¸‹çº¿ç¨‹æ¨¡å‹ã€‚</p><p>çº¿ç¨‹ï¼ˆthreadï¼‰æ˜¯è¿è¡Œåœ¨è¿›ç¨‹ä¸­çš„ä¸€ä¸ªâ€œé€»è¾‘æµâ€ï¼Œç°ä»£æ“ä½œç³»ç»Ÿéƒ½å…è®¸åœ¨å•è¿›ç¨‹ä¸­è¿è¡Œå¤šä¸ªçº¿ç¨‹ã€‚çº¿ç¨‹ç”±æ“ä½œç³»ç»Ÿå†…æ ¸ç®¡ç†ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰ï¼ŒåŒ…æ‹¬ä¸€ä¸ªå¯ä»¥å”¯ä¸€æ ‡è¯†çº¿ç¨‹çš„IDï¼ˆthread IDï¼Œæˆ–è€…å«tidï¼‰ã€æ ˆã€ç¨‹åºè®¡æ•°å™¨ã€å¯„å­˜å™¨ç­‰ã€‚åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œæ‰€æœ‰çš„çº¿ç¨‹å…±äº«è¯¥è¿›ç¨‹çš„æ•´ä¸ªè™šæ‹Ÿåœ°å€ç©ºé—´ï¼ŒåŒ…æ‹¬ä»£ç ã€æ•°æ®ã€å †ã€å…±äº«åº“ç­‰ã€‚</p><p>åœ¨å‰é¢çš„ç¨‹åºä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰æ˜¾å¼ä½¿ç”¨çº¿ç¨‹ï¼Œä½†è¿™ä¸ä»£è¡¨çº¿ç¨‹æ²¡æœ‰å‘æŒ¥ä½œç”¨ã€‚å®é™…ä¸Šï¼Œæ¯ä¸ªè¿›ç¨‹ä¸€å¼€å§‹éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªçº¿ç¨‹ï¼Œä¸€èˆ¬è¢«ç§°ä¸ºä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹å¯ä»¥å†äº§ç”Ÿå­çº¿ç¨‹ï¼Œè¿™æ ·çš„ä¸»çº¿ç¨‹-å­çº¿ç¨‹å¯¹å¯ä»¥å«åšä¸€ä¸ªå¯¹ç­‰çº¿ç¨‹ã€‚</p><p>ä½ å¯èƒ½ä¼šé—®ï¼Œæ—¢ç„¶å¯ä»¥ä½¿ç”¨å¤šè¿›ç¨‹æ¥å¤„ç†å¹¶å‘ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨å¤šçº¿ç¨‹æ¨¡å‹å‘¢ï¼Ÿ</p><p>ç®€å•æ¥è¯´ï¼Œåœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸‹ï¼Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€è¦æ¯”è¿›ç¨‹å°å¾—å¤šã€‚æ€ä¹ˆç†è§£çº¿ç¨‹ä¸Šä¸‹æ–‡å‘¢ï¼Ÿæˆ‘ä»¬çš„ä»£ç è¢«CPUæ‰§è¡Œçš„æ—¶å€™ï¼Œæ˜¯éœ€è¦ä¸€äº›æ•°æ®æ”¯æ’‘çš„ï¼Œæ¯”å¦‚ç¨‹åºè®¡æ•°å™¨å‘Šè¯‰CPUä»£ç æ‰§è¡Œåˆ°å“ªé‡Œäº†ï¼Œå¯„å­˜å™¨é‡Œå­˜äº†å½“å‰è®¡ç®—çš„ä¸€äº›ä¸­é—´å€¼ï¼Œå†…å­˜é‡Œæ”¾ç½®äº†ä¸€äº›å½“å‰ç”¨åˆ°çš„å˜é‡ç­‰ï¼Œä»ä¸€ä¸ªè®¡ç®—åœºæ™¯ï¼Œåˆ‡æ¢åˆ°å¦å¤–ä¸€ä¸ªè®¡ç®—åœºæ™¯ï¼Œç¨‹åºè®¡æ•°å™¨ã€å¯„å­˜å™¨ç­‰è¿™äº›å€¼é‡æ–°è½½å…¥æ–°åœºæ™¯çš„å€¼ï¼Œå°±æ˜¯çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</p><!-- [[[read_end]]] --><h2>POSIXçº¿ç¨‹æ¨¡å‹</h2><p>POSIXçº¿ç¨‹æ˜¯ç°ä»£UNIXç³»ç»Ÿæä¾›çš„å¤„ç†çº¿ç¨‹çš„æ ‡å‡†æ¥å£ã€‚POSIXå®šä¹‰çš„çº¿ç¨‹å‡½æ•°å¤§çº¦æœ‰60å¤šä¸ªï¼Œè¿™äº›å‡½æ•°å¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ›å»ºçº¿ç¨‹ã€å›æ”¶çº¿ç¨‹ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ç¨‹åºã€‚</p><pre><code>int another_shared = 0;\n\nvoid thread_run(void *arg) {\n    int *calculator = (int *) arg;\n    printf(&quot;hello, world, tid == %d \\n&quot;, pthread_self());\n    for (int i = 0; i &lt; 1000; i++) {\n        *calculator += 1;\n        another_shared += 1;\n    }\n}\n\nint main(int c, char **v) {\n    int calculator;\n\n    pthread_t tid1;\n    pthread_t tid2;\n\n    pthread_create(&amp;tid1, NULL, thread_run, &amp;calculator);\n    pthread_create(&amp;tid2, NULL, thread_run, &amp;calculator);\n\n    pthread_join(tid1, NULL);\n    pthread_join(tid2, NULL);\n\n    printf(&quot;calculator is %d \\n&quot;, calculator);\n    printf(&quot;another_shared is %d \\n&quot;, another_shared);\n}\n</code></pre><p>thread_helloworldç¨‹åºä¸­ï¼Œä¸»çº¿ç¨‹ä¾æ¬¡åˆ›å»ºäº†ä¸¤ä¸ªå­çº¿ç¨‹ï¼Œç„¶åç­‰å¾…è¿™ä¸¤ä¸ªå­çº¿ç¨‹å¤„ç†å®Œæ¯•ä¹‹åç»ˆæ­¢ã€‚æ¯ä¸ªå­çº¿ç¨‹éƒ½åœ¨å¯¹ä¸¤ä¸ªå…±äº«å˜é‡è¿›è¡Œè®¡ç®—ï¼Œæœ€ååœ¨ä¸»çº¿ç¨‹ä¸­æ‰“å°å‡ºæœ€åçš„è®¡ç®—ç»“æœã€‚</p><p>ç¨‹åºçš„ç¬¬18å’Œ19è¡Œåˆ†åˆ«è°ƒç”¨äº†pthread_createåˆ›å»ºäº†ä¸¤ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹çš„å…¥å£éƒ½æ˜¯thread_runå‡½æ•°ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†calculatorè¿™ä¸ªå…¨å±€å˜é‡ï¼Œå¹¶ä¸”é€šè¿‡ä¼ åœ°å€æŒ‡é’ˆçš„æ–¹å¼ï¼Œå°†è¿™ä¸ªå€¼ä¼ ç»™äº†thread_runå‡½æ•°ã€‚å½“è°ƒç”¨pthread_createç»“æŸï¼Œå­çº¿ç¨‹ä¼šç«‹å³æ‰§è¡Œï¼Œä¸»çº¿ç¨‹åœ¨æ­¤åè°ƒç”¨äº†pthread_joinå‡½æ•°ç­‰å¾…å­çº¿ç¨‹ç»“æŸã€‚</p><p>è¿è¡Œè¿™ä¸ªç¨‹åºï¼Œå¾ˆå¹¸è¿ï¼Œè®¡ç®—çš„ç»“æœæ˜¯æ­£ç¡®çš„ã€‚</p><pre><code>$./thread-helloworld\nhello, world, tid == 125607936 \nhello, world, tid == 126144512 \ncalculator is 2000 \nanother_shared is 2000 \n</code></pre><h2>ä¸»è¦çº¿ç¨‹å‡½æ•°</h2><h3>åˆ›å»ºçº¿ç¨‹</h3><p>æ­£å¦‚å‰é¢çœ‹åˆ°ï¼Œé€šè¿‡è°ƒç”¨pthread_createå‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ã€‚è¿™ä¸ªå‡½æ•°çš„åŸå‹å¦‚ä¸‹ï¼š</p><pre><code>int pthread_create(pthread_t *tid, const pthread_attr_t *attr,\nã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€void *(*func)(void *), void *arg);\n\nè¿”å›ï¼šè‹¥æˆåŠŸåˆ™ä¸º0ï¼Œè‹¥å‡ºé”™åˆ™ä¸ºæ­£çš„Exxxå€¼\n</code></pre><p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹IDï¼ˆtidï¼‰å”¯ä¸€æ¥æ ‡è¯†ï¼Œå…¶æ•°æ®ç±»å‹ä¸ºpthread_tï¼Œä¸€èˆ¬æ˜¯unsigned intã€‚pthread_createå‡½æ•°çš„ç¬¬ä¸€ä¸ªè¾“å‡ºå‚æ•°tidå°±æ˜¯ä»£è¡¨äº†çº¿ç¨‹IDï¼Œå¦‚æœåˆ›å»ºçº¿ç¨‹æˆåŠŸï¼Œtidå°±è¿”å›æ­£ç¡®çš„çº¿ç¨‹IDã€‚</p><p>æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰å¾ˆå¤šå±æ€§ï¼Œæ¯”å¦‚ä¼˜å…ˆçº§ã€æ˜¯å¦åº”è¯¥æˆä¸ºä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ç­‰ï¼Œè¿™äº›å€¼å¯ä»¥é€šè¿‡pthread_attr_tæ¥æè¿°ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¸ä¼šç‰¹æ®Šè®¾ç½®ï¼Œå¯ä»¥ç›´æ¥æŒ‡å®šè¿™ä¸ªå‚æ•°ä¸ºNULLã€‚</p><p>ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºæ–°çº¿ç¨‹çš„å…¥å£å‡½æ•°ï¼Œè¯¥å‡½æ•°å¯ä»¥æ¥æ”¶ä¸€ä¸ªå‚æ•°argï¼Œç±»å‹ä¸ºæŒ‡é’ˆï¼Œå¦‚æœæˆ‘ä»¬æƒ³ç»™çº¿ç¨‹å…¥å£å‡½æ•°ä¼ å¤šä¸ªå€¼ï¼Œé‚£ä¹ˆéœ€è¦æŠŠè¿™äº›å€¼åŒ…è£…æˆä¸€ä¸ªç»“æ„ä½“ï¼Œå†æŠŠè¿™ä¸ªç»“æ„ä½“çš„åœ°å€ä½œä¸ºpthread_createçš„ç¬¬å››ä¸ªå‚æ•°ï¼Œåœ¨çº¿ç¨‹å…¥å£å‡½æ•°å†…ï¼Œå†å°†è¯¥åœ°å€è½¬ä¸ºè¯¥ç»“æ„ä½“çš„æŒ‡é’ˆå¯¹è±¡ã€‚</p><p>åœ¨æ–°çº¿ç¨‹çš„å…¥å£å‡½æ•°å†…ï¼Œå¯ä»¥æ‰§è¡Œpthread_selfå‡½æ•°è¿”å›çº¿ç¨‹tidã€‚</p><pre><code>pthread_t pthread_self(void)\n</code></pre><h3>ç»ˆæ­¢çº¿ç¨‹</h3><p>ç»ˆæ­¢ä¸€ä¸ªçº¿ç¨‹æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯åœ¨çˆ¶çº¿ç¨‹å†…è°ƒç”¨ä»¥ä¸‹å‡½æ•°ï¼š</p><pre><code>void pthread_exit(void *status)\n</code></pre><p>å½“è°ƒç”¨è¿™ä¸ªå‡½æ•°ä¹‹åï¼Œçˆ¶çº¿ç¨‹ä¼šç­‰å¾…å…¶ä»–æ‰€æœ‰çš„å­çº¿ç¨‹ç»ˆæ­¢ï¼Œä¹‹åçˆ¶çº¿ç¨‹è‡ªå·±ç»ˆæ­¢ã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœä¸€ä¸ªå­çº¿ç¨‹å…¥å£å‡½æ•°ç›´æ¥é€€å‡ºäº†ï¼Œé‚£ä¹ˆå­çº¿ç¨‹ä¹Ÿå°±è‡ªç„¶ç»ˆæ­¢äº†ã€‚æ‰€ä»¥ï¼Œç»å¤§å¤šæ•°çš„å­çº¿ç¨‹æ‰§è¡Œä½“éƒ½æ˜¯ä¸€ä¸ªæ— é™å¾ªç¯ã€‚</p><p>ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨pthread_cancelæ¥ä¸»åŠ¨ç»ˆæ­¢ä¸€ä¸ªå­çº¿ç¨‹ï¼Œå’Œpthread_exitä¸åŒçš„æ˜¯ï¼Œå®ƒå¯ä»¥æŒ‡å®šæŸä¸ªå­çº¿ç¨‹ç»ˆæ­¢ã€‚</p><pre><code>int pthread_cancel(pthread_t tid)\n</code></pre><h3>å›æ”¶å·²ç»ˆæ­¢çº¿ç¨‹çš„èµ„æº</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨pthread_joinå›æ”¶å·²ç»ˆæ­¢çº¿ç¨‹çš„èµ„æºï¼š</p><pre><code>int pthread_join(pthread_t tid, void ** thread_return)\n</code></pre><p>å½“è°ƒç”¨pthread_joinæ—¶ï¼Œä¸»çº¿ç¨‹ä¼šé˜»å¡ï¼Œç›´åˆ°å¯¹åº”tidçš„å­çº¿ç¨‹è‡ªç„¶ç»ˆæ­¢ã€‚å’Œpthread_cancelä¸åŒçš„æ˜¯ï¼Œå®ƒä¸ä¼šå¼ºè¿«å­çº¿ç¨‹ç»ˆæ­¢ã€‚</p><h3>åˆ†ç¦»çº¿ç¨‹</h3><p>ä¸€ä¸ªçº¿ç¨‹çš„é‡è¦å±æ€§æ˜¯å¯ç»“åˆçš„ï¼Œæˆ–è€…æ˜¯åˆ†ç¦»çš„ã€‚ä¸€ä¸ªå¯ç»“åˆçš„çº¿ç¨‹æ˜¯èƒ½å¤Ÿè¢«å…¶ä»–çº¿ç¨‹æ€æ­»å’Œå›æ”¶èµ„æºçš„ï¼›è€Œä¸€ä¸ªåˆ†ç¦»çš„çº¿ç¨‹ä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹æ€æ­»æˆ–å›æ”¶èµ„æºã€‚ä¸€èˆ¬æ¥è¯´ï¼Œé»˜è®¤çš„å±æ€§æ˜¯å¯ç»“åˆçš„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨pthread_detachå‡½æ•°å¯ä»¥åˆ†ç¦»ä¸€ä¸ªçº¿ç¨‹ï¼š</p><pre><code>int pthread_detach(pthread_t tid)\n</code></pre><p>åœ¨é«˜å¹¶å‘çš„ä¾‹å­é‡Œï¼Œæ¯ä¸ªè¿æ¥éƒ½ç”±ä¸€ä¸ªçº¿ç¨‹å•ç‹¬å¤„ç†ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ç¨‹åºå¹¶ä¸éœ€è¦å¯¹æ¯ä¸ªå­çº¿ç¨‹è¿›è¡Œç»ˆæ­¢ï¼Œè¿™æ ·çš„è¯ï¼Œæ¯ä¸ªå­çº¿ç¨‹å¯ä»¥åœ¨å…¥å£å‡½æ•°å¼€å§‹çš„åœ°æ–¹ï¼ŒæŠŠè‡ªå·±è®¾ç½®ä¸ºåˆ†ç¦»çš„ï¼Œè¿™æ ·å°±èƒ½åœ¨å®ƒç»ˆæ­¢åè‡ªåŠ¨å›æ”¶ç›¸å…³çš„çº¿ç¨‹èµ„æºäº†ï¼Œå°±ä¸éœ€è¦è°ƒç”¨pthread_joinå‡½æ•°äº†ã€‚</p><h2>æ¯ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹å¤„ç†</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ”¹é€ ä¸€ä¸‹æœåŠ¡å™¨ç«¯ç¨‹åºã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯è¿™æ ·ï¼šæ¯æ¬¡æœ‰æ–°çš„è¿æ¥åˆ°è¾¾åï¼Œåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œè€Œä¸æ˜¯ç”¨æ–°è¿›ç¨‹æ¥å¤„ç†å®ƒã€‚</p><pre><code>#include &quot;lib/common.h&quot;\n\nextern void loop_echo(int);\n\nvoid thread_run(void *arg) {\n    pthread_detach(pthread_self());\n    int fd = (int) arg;\n    loop_echo(fd);\n}\n\nint main(int c, char **v) {\n    int listener_fd = tcp_server_listen(SERV_PORT);\n    pthread_t tid;\n    \n    while (1) {\n        struct sockaddr_storage ss;\n        socklen_t slen = sizeof(ss);\n        int fd = accept(listener_fd, (struct sockaddr *) &amp;ss, &amp;slen);\n        if (fd &lt; 0) {\n            error(1, errno, &quot;accept failed&quot;);\n        } else {\n            pthread_create(&amp;tid, NULL, &amp;thread_run, (void *) fd);\n        }\n    }\n\n    return 0;\n}\n</code></pre><p>è¿™ä¸ªç¨‹åºçš„ç¬¬18è¡Œé˜»å¡è°ƒç”¨åœ¨acceptä¸Šï¼Œä¸€æ—¦æœ‰æ–°è¿æ¥å»ºç«‹ï¼Œé˜»å¡è°ƒç”¨è¿”å›ï¼Œè°ƒç”¨pthread_createåˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹æ¥å¤„ç†è¿™ä¸ªè¿æ¥ã€‚</p><p>æè¿°è¿æ¥æœ€ä¸»è¦çš„æ˜¯è¿æ¥æè¿°å­—ï¼Œè¿™é‡Œé€šè¿‡å¼ºåˆ¶æŠŠæè¿°å­—è½¬æ¢ä¸ºvoid *æŒ‡é’ˆçš„æ–¹å¼ï¼Œå®Œæˆäº†ä¼ å€¼ã€‚å¦‚æœä½ å¯¹è¿™éƒ¨åˆ†æœ‰ç‚¹ä¸ç†è§£ï¼Œå»ºè®®çœ‹ä¸€ä¸‹Cè¯­è¨€ç›¸å…³çš„æŒ‡é’ˆéƒ¨åˆ†å†…å®¹ã€‚æˆ‘ä»¬è¿™é‡Œå¯ä»¥ç®€å•æ€»ç»“ä¸€ä¸‹ï¼Œè™½ç„¶ä¼ çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œä½†æ˜¯è¿™ä¸ªæŒ‡é’ˆé‡Œå­˜æ”¾çš„å¹¶ä¸æ˜¯ä¸€ä¸ªåœ°å€ï¼Œè€Œæ˜¯è¿æ¥æè¿°ç¬¦çš„æ•°å€¼ã€‚</p><p>æ–°çº¿ç¨‹å…¥å£å‡½æ•°thread_runé‡Œï¼Œç¬¬6è¡Œä½¿ç”¨äº†pthread_detachæ–¹æ³•ï¼Œå°†å­çº¿ç¨‹è½¬å˜ä¸ºåˆ†ç¦»çš„ï¼Œä¹Ÿå°±æ„å‘³ç€å­çº¿ç¨‹ç‹¬è‡ªè´Ÿè´£çº¿ç¨‹èµ„æºå›æ”¶ã€‚ç¬¬7è¡Œï¼Œå¼ºåˆ¶å°†æŒ‡é’ˆè½¬å˜ä¸ºæè¿°ç¬¦æ•°æ®ï¼Œå’Œå‰é¢å°†æè¿°å­—è½¬æ¢ä¸ºvoid *æŒ‡é’ˆå¯¹åº”ï¼Œç¬¬8è¡Œè°ƒç”¨loop_echoæ–¹æ³•å¤„ç†è¿™ä¸ªè¿æ¥çš„æ•°æ®è¯»å†™ã€‚</p><p>loop_echoçš„ç¨‹åºå¦‚ä¸‹ï¼Œåœ¨æ¥æ”¶å®¢æˆ·ç«¯çš„æ•°æ®ä¹‹åï¼Œå†ç¼–ç å›é€å‡ºå»ã€‚</p><pre><code>char rot13_char(char c) {\n    if ((c &gt;= 'a' &amp;&amp; c &lt;= 'm') || (c &gt;= 'A' &amp;&amp; c &lt;= 'M'))\n        return c + 13;\n    else if ((c &gt;= 'n' &amp;&amp; c &lt;= 'z') || (c &gt;= 'N' &amp;&amp; c &lt;= 'Z'))\n        return c - 13;\n    else\n        return c;\n}\n\nvoid loop_echo(int fd) {\n    char outbuf[MAX_LINE + 1];\n    size_t outbuf_used = 0;\n    ssize_t result;\n    while (1) {\n        char ch;\n        result = recv(fd, &amp;ch, 1, 0);\n\n        //æ–­å¼€è¿æ¥æˆ–è€…å‡ºé”™\n        if (result == 0) {\n            break;\n        } else if (result == -1) {\n            error(1, errno, &quot;read error&quot;);\n            break;\n        }\n\n        if (outbuf_used &lt; sizeof(outbuf)) {\n            outbuf[outbuf_used++] = rot13_char(ch);\n        }\n\n        if (ch == '\\n') {\n            send(fd, outbuf, outbuf_used, 0);\n            outbuf_used = 0;\n            continue;\n        }\n    }\n}\n</code></pre><p>è¿è¡Œè¿™ä¸ªç¨‹åºä¹‹åï¼Œå¼€å¯å¤šä¸ªtelnetå®¢æˆ·ç«¯ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªæœåŠ¡å™¨ç¨‹åºå¯ä»¥å¤„ç†å¤šä¸ªå¹¶å‘è¿æ¥å¹¶å›é€æ•°æ®ã€‚å•ç‹¬ä¸€ä¸ªè¿æ¥é€€å‡ºä¹Ÿä¸ä¼šå½±å“å…¶ä»–è¿æ¥çš„æ•°æ®æ”¶å‘ã€‚</p><pre><code>$telnet 127.0.0.1 43211\nTrying 127.0.0.1...\nConnected to localhost.\nEscape character is '^]'.\naaa\nnnn\n^]\ntelnet&gt; quit\nConnection closed.\n</code></pre><h2>æ„å»ºçº¿ç¨‹æ± å¤„ç†å¤šä¸ªè¿æ¥</h2><p>ä¸Šé¢çš„æœåŠ¡å™¨ç«¯ç¨‹åºè™½ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œä¸è¿‡å®ƒæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œé‚£å°±æ˜¯å¦‚æœå¹¶å‘è¿æ¥è¿‡å¤šï¼Œå°±ä¼šå¼•èµ·çº¿ç¨‹çš„é¢‘ç¹åˆ›å»ºå’Œé”€æ¯ã€‚è™½ç„¶çº¿ç¨‹åˆ‡æ¢çš„ä¸Šä¸‹æ–‡å¼€é”€ä¸å¤§ï¼Œä½†æ˜¯çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€å´æ˜¯ä¸å°çš„ã€‚</p><p>èƒ½ä¸èƒ½å¯¹è¿™ä¸ªç¨‹åºè¿›è¡Œä¸€äº›ä¼˜åŒ–å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é¢„åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹å¼æ¥è¿›è¡Œä¼˜åŒ–ã€‚åœ¨æœåŠ¡å™¨ç«¯å¯åŠ¨æ—¶ï¼Œå¯ä»¥å…ˆæŒ‰ç…§å›ºå®šå¤§å°é¢„åˆ›å»ºå‡ºå¤šä¸ªçº¿ç¨‹ï¼Œå½“æœ‰æ–°è¿æ¥å»ºç«‹æ—¶ï¼Œå¾€è¿æ¥å­—é˜Ÿåˆ—é‡Œæ”¾ç½®è¿™ä¸ªæ–°è¿æ¥æè¿°å­—ï¼Œçº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹è´Ÿè´£ä»è¿æ¥å­—é˜Ÿåˆ—é‡Œå–å‡ºè¿æ¥æè¿°å­—è¿›è¡Œå¤„ç†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d9/72/d976c7b993862f0dbef75354d2f49672.png?wh=1430*462\" alt=\"\"><br>\nè¿™ä¸ªç¨‹åºçš„å…³é”®æ˜¯è¿æ¥å­—é˜Ÿåˆ—çš„è®¾è®¡ï¼Œå› ä¸ºè¿™é‡Œæ—¢æœ‰å¾€è¿™ä¸ªé˜Ÿåˆ—é‡Œæ”¾ç½®æè¿°ç¬¦çš„æ“ä½œï¼Œä¹Ÿæœ‰ä»è¿™ä¸ªé˜Ÿåˆ—é‡Œå–å‡ºæè¿°ç¬¦çš„æ“ä½œã€‚</p><p>å¯¹æ­¤ï¼Œéœ€è¦å¼•å…¥ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œä¸€ä¸ªæ˜¯é”mutexï¼Œä¸€ä¸ªæ˜¯æ¡ä»¶å˜é‡conditionã€‚é”å¾ˆå¥½ç†è§£ï¼ŒåŠ é”çš„æ„æ€å°±æ˜¯å…¶ä»–çº¿ç¨‹ä¸èƒ½è¿›å…¥ï¼›æ¡ä»¶å˜é‡åˆ™æ˜¯åœ¨å¤šä¸ªçº¿ç¨‹éœ€è¦äº¤äº’çš„æƒ…å†µä¸‹ï¼Œç”¨æ¥çº¿ç¨‹é—´åŒæ­¥çš„åŸè¯­ã€‚</p><pre><code>//å®šä¹‰ä¸€ä¸ªé˜Ÿåˆ—\ntypedef struct {\n    int number;  //é˜Ÿåˆ—é‡Œçš„æè¿°å­—æœ€å¤§ä¸ªæ•°\n    int *fd;     //è¿™æ˜¯ä¸€ä¸ªæ•°ç»„æŒ‡é’ˆ\n    int front;   //å½“å‰é˜Ÿåˆ—çš„å¤´ä½ç½®\n    int rear;    //å½“å‰é˜Ÿåˆ—çš„å°¾ä½ç½®\n    pthread_mutex_t mutex;  //é”\n    pthread_cond_t cond;    //æ¡ä»¶å˜é‡\n} block_queue;\n\n//åˆå§‹åŒ–é˜Ÿåˆ—\nvoid block_queue_init(block_queue *blockQueue, int number) {\n    blockQueue-&gt;number = number;\n    blockQueue-&gt;fd = calloc(number, sizeof(int));\n    blockQueue-&gt;front = blockQueue-&gt;rear = 0;\n    pthread_mutex_init(&amp;blockQueue-&gt;mutex, NULL);\n    pthread_cond_init(&amp;blockQueue-&gt;cond, NULL);\n}\n\n//å¾€é˜Ÿåˆ—é‡Œæ”¾ç½®ä¸€ä¸ªæè¿°å­—fd\nvoid block_queue_push(block_queue *blockQueue, int fd) {\n    //ä¸€å®šè¦å…ˆåŠ é”ï¼Œå› ä¸ºæœ‰å¤šä¸ªçº¿ç¨‹éœ€è¦è¯»å†™é˜Ÿåˆ—\n    pthread_mutex_lock(&amp;blockQueue-&gt;mutex);\n    //å°†æè¿°å­—æ”¾åˆ°é˜Ÿåˆ—å°¾çš„ä½ç½®\n    blockQueue-&gt;fd[blockQueue-&gt;rear] = fd;\n    //å¦‚æœå·²ç»åˆ°æœ€åï¼Œé‡ç½®å°¾çš„ä½ç½®\n    if (++blockQueue-&gt;rear == blockQueue-&gt;number) {\n        blockQueue-&gt;rear = 0;\n    }\n    printf(&quot;push fd %d&quot;, fd);\n    //é€šçŸ¥å…¶ä»–ç­‰å¾…è¯»çš„çº¿ç¨‹ï¼Œæœ‰æ–°çš„è¿æ¥å­—ç­‰å¾…å¤„ç†\n    pthread_cond_signal(&amp;blockQueue-&gt;cond);\n    //è§£é”\n    pthread_mutex_unlock(&amp;blockQueue-&gt;mutex);\n}\n\n//ä»é˜Ÿåˆ—é‡Œè¯»å‡ºæè¿°å­—è¿›è¡Œå¤„ç†\nint block_queue_pop(block_queue *blockQueue) {\n    //åŠ é”\n    pthread_mutex_lock(&amp;blockQueue-&gt;mutex);\n    //åˆ¤æ–­é˜Ÿåˆ—é‡Œæ²¡æœ‰æ–°çš„è¿æ¥å­—å¯ä»¥å¤„ç†ï¼Œå°±ä¸€ç›´æ¡ä»¶ç­‰å¾…ï¼Œç›´åˆ°æœ‰æ–°çš„è¿æ¥å­—å…¥é˜Ÿåˆ—\n    while (blockQueue-&gt;front == blockQueue-&gt;rear)\n        pthread_cond_wait(&amp;blockQueue-&gt;cond, &amp;blockQueue-&gt;mutex);\n    //å–å‡ºé˜Ÿåˆ—å¤´çš„è¿æ¥å­—\n    int fd = blockQueue-&gt;fd[blockQueue-&gt;front];\n    //å¦‚æœå·²ç»åˆ°æœ€åï¼Œé‡ç½®å¤´çš„ä½ç½®\n    if (++blockQueue-&gt;front == blockQueue-&gt;number) {\n        blockQueue-&gt;front = 0;\n    }\n    printf(&quot;pop fd %d&quot;, fd);\n    //è§£é”\n    pthread_mutex_unlock(&amp;blockQueue-&gt;mutex);\n    //è¿”å›è¿æ¥å­—\n    return fd;\n}  \n</code></pre><p>è¿™é‡Œæœ‰block_queueç›¸å…³çš„å®šä¹‰å’Œå®ç°ï¼Œå¹¶åœ¨å…³é”®çš„åœ°æ–¹åŠ äº†ä¸€äº›æ³¨é‡Šï¼Œæœ‰å‡ ä¸ªåœ°æ–¹éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼š</p><p>ç¬¬ä¸€æ˜¯è®°å¾—å¯¹æ“ä½œè¿›è¡ŒåŠ é”å’Œè§£é”ï¼Œè¿™é‡Œæ˜¯é€šè¿‡pthread_mutex_lockå’Œpthread_mutex_unlockæ¥å®Œæˆçš„ã€‚</p><p>ç¬¬äºŒæ˜¯å½“å·¥ä½œçº¿ç¨‹æ²¡æœ‰æè¿°å­—å¯ç”¨æ—¶ï¼Œéœ€è¦ç­‰å¾…ï¼Œç¬¬43è¡Œé€šè¿‡è°ƒç”¨pthread_cond_waitï¼Œæ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ç­‰å¾…æœ‰æ–°çš„æè¿°å­—å¯è¾¾ã€‚ç¬¬32è¡Œï¼Œä¸»çº¿ç¨‹é€šçŸ¥å·¥ä½œçº¿ç¨‹æœ‰æ–°çš„æè¿°ç¬¦éœ€è¦æœåŠ¡ã€‚</p><p>æœåŠ¡å™¨ç«¯ç¨‹åºå¦‚ä¸‹ï¼š</p><pre><code>void thread_run(void *arg) {\n    pthread_t tid = pthread_self();\n    pthread_detach(tid);\n\n    block_queue *blockQueue = (block_queue *) arg;\n    while (1) {\n        int fd = block_queue_pop(blockQueue);\n        printf(&quot;get fd in thread, fd==%d, tid == %d&quot;, fd, tid);\n        loop_echo(fd);\n    }\n}\n\nint main(int c, char **v) {\n    int listener_fd = tcp_server_listen(SERV_PORT);\n\n    block_queue blockQueue;\n    block_queue_init(&amp;blockQueue, BLOCK_QUEUE_SIZE);\n\n    thread_array = calloc(THREAD_NUMBER, sizeof(Thread));\n    int i;\n    for (i = 0; i &lt; THREAD_NUMBER; i++) {\n        pthread_create(&amp;(thread_array[i].thread_tid), NULL, &amp;thread_run, (void *) &amp;blockQueue);\n    }\n\n    while (1) {\n        struct sockaddr_storage ss;\n        socklen_t slen = sizeof(ss);\n        int fd = accept(listener_fd, (struct sockaddr *) &amp;ss, &amp;slen);\n        if (fd &lt; 0) {\n            error(1, errno, &quot;accept failed&quot;);\n        } else {\n            block_queue_push(&amp;blockQueue, fd);\n        }\n    }\n\n    return 0;\n}\n</code></pre><p>æœ‰äº†æè¿°å­—é˜Ÿåˆ—ï¼Œä¸»ç¨‹åºå˜å¾—éå¸¸ç®€æ´ã€‚ç¬¬19-23è¡Œé¢„åˆ›å»ºäº†å¤šä¸ªçº¿ç¨‹ï¼Œç»„æˆäº†ä¸€ä¸ªçº¿ç¨‹æ± ã€‚28-32è¡Œåœ¨æ–°è¿æ¥å»ºç«‹åï¼Œå°†è¿æ¥æè¿°å­—åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚</p><p>7-9è¡Œæ˜¯å·¥ä½œçº¿ç¨‹çš„ä¸»å¾ªç¯ï¼Œä»æè¿°å­—é˜Ÿåˆ—ä¸­å–å‡ºæè¿°å­—ï¼Œå¯¹è¿™ä¸ªè¿æ¥è¿›è¡ŒæœåŠ¡å¤„ç†ã€‚</p><p>åŒæ ·çš„ï¼Œè¿è¡Œè¿™ä¸ªç¨‹åºä¹‹åï¼Œå¼€å¯å¤šä¸ªtelnetå®¢æˆ·ç«¯ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªæœåŠ¡å™¨ç¨‹åºå¯ä»¥æ­£å¸¸å¤„ç†å¤šä¸ªå¹¶å‘è¿æ¥å¹¶å›æ˜¾ã€‚</p><pre><code>$telnet 127.0.0.1 43211\nTrying 127.0.0.1...\nConnected to localhost.\nEscape character is '^]'.\naaa\nnnn\n^]\ntelnet&gt; quit\nConnection closed.\n</code></pre><p>å’Œå‰é¢çš„ç¨‹åºç›¸æ¯”ï¼Œçº¿ç¨‹åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€å¤§å¤§é™ä½ï¼Œä½†å› ä¸ºçº¿ç¨‹æ± å¤§å°å›ºå®šï¼Œåˆå› ä¸ºä½¿ç”¨äº†é˜»å¡å¥—æ¥å­—ï¼Œè‚¯å®šä¼šå‡ºç°æœ‰è¿æ¥å¾—ä¸åˆ°åŠæ—¶æœåŠ¡çš„åœºæ™¯ã€‚è¿™ä¸ªé—®é¢˜çš„è§£å†³è¿˜æ˜¯è¦å›åˆ°æˆ‘åœ¨å¼€ç¯‡è¯é‡Œæåˆ°çš„æ–¹æ¡ˆä¸Šæ¥ï¼Œå¤šè·¯I/Oå¤ç”¨åŠ ä¸Šçº¿ç¨‹æ¥å¤„ç†ï¼Œä»…ä»…ä½¿ç”¨é˜»å¡I/Oæ¨¡å‹å’Œçº¿ç¨‹æ˜¯æ²¡æœ‰åŠæ³•è¾¾åˆ°æè‡´çš„é«˜å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚</p><h2>æ€»ç»“</h2><p>è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†çº¿ç¨‹æ¥æ„å»ºæœåŠ¡å™¨ç«¯ç¨‹åºã€‚ä¸€ç§æ˜¯æ¯æ¬¡åŠ¨æ€åˆ›å»ºçº¿ç¨‹ï¼Œå¦ä¸€ç§æ˜¯ä½¿ç”¨çº¿ç¨‹æ± æé«˜æ•ˆç‡ã€‚å’Œè¿›ç¨‹ç›¸æ¯”ï¼Œçº¿ç¨‹çš„è¯­ä¹‰æ›´è½»é‡ï¼Œä½¿ç”¨çš„åœºæ™¯ä¹Ÿæ›´å¤šã€‚çº¿ç¨‹æ˜¯é«˜æ€§èƒ½ç½‘ç»œæœåŠ¡å™¨å¿…é¡»æŒæ¡çš„æ ¸å¿ƒçŸ¥è¯†ï¼Œå¸Œæœ›ä½ èƒ½å¤Ÿé€šè¿‡æœ¬è®²çš„å­¦ä¹ ï¼Œç‰¢ç‰¢æŒæ¡å®ƒã€‚</p><h2>æ€è€ƒé¢˜</h2><p>å’Œå¾€å¸¸ä¸€æ ·ï¼Œç»™ä½ ç•™ä¸¤é“æ€è€ƒé¢˜ã€‚</p><p>ç¬¬ä¸€é“ï¼Œè¿æ¥å­—é˜Ÿåˆ—çš„å®ç°é‡Œï¼Œæœ‰ä¸€ä¸ªé‡è¦æƒ…å†µæ²¡æœ‰è€ƒè™‘ï¼Œå°±æ˜¯é˜Ÿåˆ—é‡Œæ²¡æœ‰å¯ç”¨çš„ä½ç½®äº†ï¼Œæƒ³æƒ³çœ‹ï¼Œå¦‚ä½•å¯¹è¿™ç§æƒ…å†µè¿›è¡Œä¼˜åŒ–ï¼Ÿ</p><p>ç¬¬äºŒé“ï¼Œæˆ‘åœ¨è®²åˆ°ç¬¬ä¸€ä¸ªhello-worldè®¡æ•°å™¨åº”ç”¨æ—¶ï¼Œè¯´â€œç»“æœæ˜¯å¹¸è¿â€è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ€ä¹ˆç†è§£å‘¢ï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨è¯„è®ºåŒºå†™ä¸‹ä½ çš„æ€è€ƒï¼Œæˆ‘ä¼šå’Œä½ ä¸€èµ·æ€è€ƒï¼Œä¹Ÿæ¬¢è¿æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–è€…åŒäº‹ï¼Œä¸€èµ·äº¤æµä¸€ä¸‹ã€‚</p>","comments":[{"had_liked":false,"id":178140,"user_name":"ä¸·ç‹ä¼ å¥‡ä¸·","can_delete":false,"product_type":"c1","uid":1239842,"ip_address":"","ucode":"CAF539501F884C","user_header":"https://static001.geekbang.org/account/avatar/00/12/eb/22/46b054b0.jpg","comment_is_top":false,"comment_ctime":1581596718,"is_pvip":false,"replies":[{"id":"71019","content":"å¤šçº¿ç¨‹ç¨‹åºè®¾è®¡çš„å¸¸è§å‘ã€‚è§£é‡Šåˆ°ä½ï¼Œèµã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1583050992,"ip_address":"","comment_id":178140,"utype":1}],"discussion_count":4,"race_medal":0,"score":"78891008046","product_id":100032701,"comment_content":"ç¬¬äºŒé¢˜ï¼šå¯èƒ½ä¼šå¾—åˆ°æ¯”æ­£ç¡®çš„å€¼å°çš„å€¼<br>i++å¤§è‡´åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š<br>       1ã€ä»å†…å­˜è¯»å‡ºiçš„å€¼åˆ°å¯„å­˜å™¨<br>       2ã€æ“ä½œå¯„å­˜å™¨åŠ 1<br>       3ã€å°†å¯„å­˜å™¨å€¼å†™åˆ°iå†…å­˜<br>å¤šä¸ªçº¿ç¨‹å»æ“ä½œåŒä¸€ä¸ªå…¨å±€å˜é‡çš„æ—¶å€™ï¼Œå¯èƒ½æŸä¸ªçº¿ç¨‹åœ¨ç¬¬äºŒæ­¥çš„æ—¶å€™åˆ‡æ¢åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™æ ·å°±å¯¼è‡´å°‘åŠ äº†ã€‚æ¯”å¦‚çº¿ç¨‹A åœ¨i=1 çš„æ—¶å€™åœ¨ç¬¬äºŒæ­¥ï¼Œè¿™ä¸ªæ—¶å€™å¯„å­˜å™¨åŠ 1å€¼ä¸º2ï¼Œåœ¨è¿™ä¸ªæ—¶å€™åˆ‡æ¢åˆ°çº¿ç¨‹B ï¼Œç”±äºçº¿ç¨‹Aè¿˜æ²¡æœ‰æŠŠ2å†™åˆ°ié‡Œé¢ï¼Œä½¿ç”¨Bè¯»å‡ºæ¥è¿˜æ˜¯1ï¼Œè‡ªå¢å†™åˆ°ié‡Œé¢ï¼Œiä¸º2ï¼Œåœ¨åˆ‡æ¢åˆ°çº¿ç¨‹Aï¼Œçº¿ç¨‹Aå°†å¯„å­˜å™¨é‡Œé¢çš„2å†™åˆ°iï¼Œè¿™æ ·å°±å°‘åŠ äº†ä¸€æ¬¡ã€‚","like_count":18,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483680,"discussion_content":"å¤šçº¿ç¨‹ç¨‹åºè®¾è®¡çš„å¸¸è§å‘ã€‚è§£é‡Šåˆ°ä½ï¼Œèµã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583050992,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2450040,"avatar":"","nickname":"ç‹è“¬å‹ƒ","note":"","ucode":"DDF4CCE9728DCF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532300,"discussion_content":"ä¹Ÿæœ‰å¯èƒ½å€¼å˜å¤§å§ï¼Œæˆ‘è¯•äº†ï¼Œè‡ªå¢å¯äº†1äº¿æ¬¡ï¼Œç»“æœå¤šçº¿ç¨‹è®¡ç®—çš„æ¯”å®é™…çš„ç»“æœè¦å¤§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637569321,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":1,"child_discussions":[{"author":{"id":1047043,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/fa/03/619e3e48.jpg","nickname":"é£æ¸…æ‰¬","note":"","ucode":"651F1390B64953","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":2450040,"avatar":"","nickname":"ç‹è“¬å‹ƒ","note":"","ucode":"DDF4CCE9728DCF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554645,"discussion_content":"åªå¯èƒ½å˜å°ï¼Œä¸å¯èƒ½å˜å¤§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646532336,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":532300,"ip_address":""},"score":554645,"extra":""}]},{"author":{"id":1803259,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/83/fb/621adceb.jpg","nickname":"linker","note":"","ucode":"6C5799F2FC2C82","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":216308,"discussion_content":"ä½¿ç”¨æœªåˆå§‹åŒ–çš„å˜é‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585415099,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187838,"user_name":"å¿†æ°´å¯’","can_delete":false,"product_type":"c1","uid":1147453,"ip_address":"","ucode":"E3F86BD8AA8903","user_header":"https://static001.geekbang.org/account/avatar/00/11/82/3d/356fc3d6.jpg","comment_is_top":false,"comment_ctime":1584257544,"is_pvip":false,"replies":[{"id":"73542","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1584864753,"ip_address":"","comment_id":187838,"utype":1}],"discussion_count":4,"race_medal":0,"score":"66008766984","product_id":100032701,"comment_content":"ç¬¬ä¸€é“ï¼Œå…¶å®è¿™é‡Œä½¿ç”¨çš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼Œå¯ä»¥ä½¿ç”¨æ‰©å®¹ç­–ç•¥è§£å†³fdå­˜æ”¾çš„é—®é¢˜ã€‚<br>ç¬¬äºŒé¢˜ï¼Œåœ¨å¹¶å‘åœºæ™¯ä¸‹å¾ˆå®¹æ˜“é€ æˆè®¡ç®—ç»“æœçš„ä¸å‡†ç¡®ã€‚å› ä¸ºè¿™é‡Œé¢æ˜¯ä¸¤ä¸ªçº¿ç¨‹å„æ‰§è¡Œ1000æ¬¡ã€‚å®é™…ä¸Šå¾ˆå¤§ç»“æœæ˜¯å°‘äº2000çš„ç»“æœã€‚è§£å†³æ–¹æ³•å¯ä»¥åŠ ä¸Šé”æˆ–volitateå…³é”®å­—ï¼ˆè§£å†³å¯è§è¡Œé—®é¢˜ï¼‰ã€‚","like_count":15,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487262,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584864753,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1014061,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/79/2d/dbb5570f.jpg","nickname":"huadanian","note":"","ucode":"A986E1DB777428","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532647,"discussion_content":"è¯·é—®åŠ volitateå…³é”®å­—ï¼Œå¯ä»¥è§£å†³äº’æ–¥è®¿é—®å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637660710,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":2,"child_discussions":[{"author":{"id":2831233,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/33/81/3693f4d9.jpg","nickname":"åšå®šçš„æŠ¢æ‰‹","note":"","ucode":"E5A5EC6196C518","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1014061,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/79/2d/dbb5570f.jpg","nickname":"huadanian","note":"","ucode":"A986E1DB777428","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":543271,"discussion_content":"javaæ‰å¯ä»¥æŠŠã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1641040570,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":532647,"ip_address":""},"score":543271,"extra":""},{"author":{"id":2653715,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKib3vNM6TPT1umvR3TictnLurJPKuQq4iblH5upgBB3kHL9hoN3Pgh3MaR2rjz6fWgMiaDpicd8R5wsAQ/132","nickname":"é™ˆé˜³","note":"","ucode":"C8E676C967D23A","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1014061,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/79/2d/dbb5570f.jpg","nickname":"huadanian","note":"","ucode":"A986E1DB777428","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554699,"discussion_content":"ä¸èƒ½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646557233,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":532647,"ip_address":""},"score":554699,"extra":""}]}]},{"had_liked":false,"id":138753,"user_name":"æ²‰æ·€çš„æ¢¦æƒ³","can_delete":false,"product_type":"c1","uid":1177315,"ip_address":"","ucode":"BCB7C26F9D214B","user_header":"https://static001.geekbang.org/account/avatar/00/11/f6/e3/e4bcd69e.jpg","comment_is_top":false,"comment_ctime":1570440188,"is_pvip":false,"replies":[{"id":"54312","content":"ä¸é”™çš„æƒ³æ³•ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1570972002,"ip_address":"","comment_id":138753,"utype":1}],"discussion_count":4,"race_medal":0,"score":"61699982332","product_id":100032701,"comment_content":"å…³äºé˜Ÿåˆ—æ»¡çš„æƒ…å†µï¼Œé¢å¤–åŠ ä¸€ä¸ªcondï¼Œè¡¨ç¤ºé˜Ÿåˆ—æœªæ»¡æ¡ä»¶å°±å¯ä»¥äº†ã€‚<br><br>typedef struct {<br>    int number;<br>    int *fd;<br>    int front;<br>    int rear;<br>    &#47;&#47; é˜Ÿåˆ—ä¸­å½“å‰å…ƒç´ æ•°ç›®<br>    int count;<br>    pthread_mutex_t mutex;<br>    pthread_cond_t not_empty;<br>    &#47;&#47; é˜Ÿåˆ—æœªæ»¡æ¡ä»¶<br>    pthread_cond_t not_full;<br>} block_queue;<br><br>void block_queue_init(block_queue *blockQueue, int number) {<br>    blockQueue-&gt;number = number;<br>    blockQueue-&gt;fd = calloc(number, sizeof(int));<br>    blockQueue-&gt;count = blockQueue-&gt;front = blockQueue-&gt;rear = 0;<br>    pthread_mutex_init(&amp;blockQueue-&gt;mutex, NULL);<br>    pthread_cond_init(&amp;blockQueue-&gt;not_empty, NULL);<br>    pthread_cond_init(&amp;blockQueue-&gt;not_full, NULL);<br>}<br><br>void block_queue_push(block_queue *blockQueue, int fd) {<br>    pthread_mutex_lock(&amp;blockQueue-&gt;mutex);<br>    while (blockQueue-&gt;count == blockQueue-&gt;number){   &#47;&#47;é˜Ÿåˆ—æ»¡<br>        pthread_cond_wait(&amp;blockQueue-&gt;not_full, &amp;blockQueue-&gt;mutex);<br>    }<br><br>    blockQueue-&gt;fd[blockQueue-&gt;rear] = fd;<br>    if (++blockQueue-&gt;rear == blockQueue-&gt;number) { <br>        blockQueue-&gt;rear = 0;<br>    }<br>    blockQueue-&gt;count++;<br>    printf(&quot;push fd %d&quot;, fd);<br>    pthread_cond_signal(&amp;blockQueue-&gt;not_empty);<br>    pthread_mutex_unlock(&amp;blockQueue-&gt;mutex);<br>}<br><br>int block_queue_pop(block_queue *blockQueue) {<br>    pthread_mutex_lock(&amp;blockQueue-&gt;mutex);<br>    while (blockQueue-&gt;front == blockQueue-&gt;rear)  &#47;&#47; ç©ºé˜Ÿåˆ—<br>        pthread_cond_wait(&amp;blockQueue-&gt;not_empty, &amp;blockQueue-&gt;mutex);<br>    int fd = blockQueue-&gt;fd[blockQueue-&gt;front];<br>    if (++blockQueue-&gt;front == blockQueue-&gt;number) {<br>        blockQueue-&gt;front = 0;<br>    }<br>    blockQueue-&gt;count--;<br>    printf(&quot;pop fd %d&quot;, fd);<br>    pthread_cond_signal(&amp;blockQueue-&gt;not_full);<br>    &#47;&#47; è§£é”<br>    pthread_mutex_unlock(&amp;blockQueue-&gt;mutex);<br>    return fd;<br>}<br>","like_count":14,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469636,"discussion_content":"ä¸é”™çš„æƒ³æ³•ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570972002,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1508329,"avatar":"https://static001.geekbang.org/account/avatar/00/17/03/e9/6358059c.jpg","nickname":"GalaxyCreater","note":"","ucode":"C79E8A088D57CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":296674,"discussion_content":"è¿™ä¸å°±ä¼šæ­»é”å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596620153,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1081922,"avatar":"https://static001.geekbang.org/account/avatar/00/10/82/42/8b04d489.jpg","nickname":"åˆ˜ä¸¹","note":"","ucode":"66594D1C957E15","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":25904,"discussion_content":"while (blockQueue->count == blockQueue->number){ //é˜Ÿåˆ—æ»¡ å’Œ blockQueue->count = blockQueue->front = blockQueue->rear = 0; è¿™2è¡Œä»£ç æœ‰å†²çª","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570579640,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1177315,"avatar":"https://static001.geekbang.org/account/avatar/00/11/f6/e3/e4bcd69e.jpg","nickname":"æ²‰æ·€çš„æ¢¦æƒ³","note":"","ucode":"BCB7C26F9D214B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1081922,"avatar":"https://static001.geekbang.org/account/avatar/00/10/82/42/8b04d489.jpg","nickname":"åˆ˜ä¸¹","note":"","ucode":"66594D1C957E15","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":28449,"discussion_content":"æ²¡æœ‰å†²çªå•Šï¼Œcountæ˜¯ä¼šåœ¨pushå’Œpopçš„è¿‡ç¨‹ä¸­ç»´æŠ¤çš„","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1570698093,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":25904,"ip_address":""},"score":28449,"extra":""}]}]},{"had_liked":false,"id":140723,"user_name":"Steiner","can_delete":false,"product_type":"c1","uid":1622329,"ip_address":"","ucode":"232C1C75207A1E","user_header":"https://static001.geekbang.org/account/avatar/00/18/c1/39/11904266.jpg","comment_is_top":false,"comment_ctime":1571038116,"is_pvip":false,"replies":[{"id":"55081","content":"å¥½é—®é¢˜ã€‚<br><br>è¿™æ˜¯ä¸ºäº†ç¡®ä¿è¢«pthread_cond_waitå”¤é†’ä¹‹åçš„çº¿ç¨‹ï¼Œç¡®å®å¯ä»¥æ»¡è¶³ç»§ç»­å¾€ä¸‹æ‰§è¡Œçš„æ¡ä»¶ã€‚å¦‚æœæ²¡æœ‰whileå¾ªç¯çš„å†æ¬¡ç¡®è®¤ï¼Œå¯èƒ½ç›´æ¥å°±å¾€ä¸‹æ‰§è¡Œäº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1571453136,"ip_address":"","comment_id":140723,"utype":1}],"discussion_count":2,"race_medal":0,"score":"48815678372","product_id":100032701,"comment_content":"è¯·é—®block_queue_popçš„pthread_cond_waitä¸ºä»€ä¹ˆè¦æ”¾åœ¨whileè€Œä¸æ˜¯ifä¸­","like_count":11,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470527,"discussion_content":"å¥½é—®é¢˜ã€‚\n\nè¿™æ˜¯ä¸ºäº†ç¡®ä¿è¢«pthread_cond_waitå”¤é†’ä¹‹åçš„çº¿ç¨‹ï¼Œç¡®å®å¯ä»¥æ»¡è¶³ç»§ç»­å¾€ä¸‹æ‰§è¡Œçš„æ¡ä»¶ã€‚å¦‚æœæ²¡æœ‰whileå¾ªç¯çš„å†æ¬¡ç¡®è®¤ï¼Œå¯èƒ½ç›´æ¥å°±å¾€ä¸‹æ‰§è¡Œäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571453136,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1620168,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b8/c8/950fb2c9.jpg","nickname":"é©¬ä¸åœè¹„","note":"","ucode":"9AB66524672291","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":46757,"discussion_content":"é¿å…å‡å”¤é†’","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1573203156,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138659,"user_name":"åˆ˜ä¸¹","can_delete":false,"product_type":"c1","uid":1081922,"ip_address":"","ucode":"66594D1C957E15","user_header":"https://static001.geekbang.org/account/avatar/00/10/82/42/8b04d489.jpg","comment_is_top":false,"comment_ctime":1570412892,"is_pvip":false,"replies":[{"id":"54311","content":"å¾ˆå¥½çš„æ–¹æ³•ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1570971850,"ip_address":"","comment_id":138659,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23045249372","product_id":100032701,"comment_content":"block_queue_pushæœªè€ƒè™‘é˜Ÿåˆ—æ»¡çš„æƒ…å†µï¼Œå¯ä»¥åœ¨æœ¬å‡½æ•°é‡Œå…ˆåˆ¤æ–­æ˜¯å¦é˜Ÿåˆ—æ»¡äº†ï¼Œå¦‚æœæ»¡å°±æŒ‰æŸä¸ªç­–ç•¥æ‰©å®¹ï¼Œä¾‹å¦‚æ‰©å¤§1.5æˆ–2å€ã€‚æ‰©å®¹å¤±è´¥æˆ–è€…å®¹é‡è¶…è¿‡æœ€å¤§å€¼ï¼Œå°±è¿”å›å¤±è´¥ã€‚","like_count":5,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469612,"discussion_content":"å¾ˆå¥½çš„æ–¹æ³•ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570971850,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":290007,"user_name":"æ—ç‡•","can_delete":false,"product_type":"c1","uid":2368765,"ip_address":"","ucode":"4A6CB5394E885D","user_header":"","comment_is_top":false,"comment_ctime":1619319820,"is_pvip":false,"replies":[{"id":"105518","content":"é—®é¢˜çš„å…³é”®æ˜¯pthread_cond_waitè¿™ä¸ªå‡½æ•°ï¼Œäº‹å®ä¸Šï¼Œè¿™ä¸ªå‡½æ•°ä½¿å¾—å½“å‰çº¿ç¨‹è¿›å…¥ä¼‘çœ ï¼Œå¹¶ä¸”é‡Šæ”¾å½“å‰çº¿ç¨‹æŒæœ‰çš„äº’æ–¥é”ã€‚è€Œå½“è°ƒç”¨çº¿ç¨‹åæ¥ä»pthread_cond_waitè¿”å›æ—¶ï¼Œè¯¥çº¿ç¨‹å†æ¬¡æŒæœ‰è¯¥äº’æ–¥é”ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå››ä¸ªå­çº¿ç¨‹éƒ½å¯ä»¥è·‘å®Œpthread_mutex_lockï¼Œç„¶åéƒ½åœ¨pthread_cond_waitè¿™ä¸ªå‡½æ•°ä¸­ä¼‘çœ ç­‰å¾…çš„åŸå› ã€‚<br>","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1620223386,"ip_address":"","comment_id":290007,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10209254412","product_id":100032701,"comment_content":"è€å¸ˆï¼Œè¯·é—®ä¸€ä¸‹ï¼Œæˆ‘è·‘äº†thread02è¿™ä¸ªç¨‹åºã€‚åœ¨æ²¡æœ‰å®¢æˆ·ç«¯è¿ä¸Šæ¥çš„æƒ…å†µä¸‹ï¼Œæˆ‘å‘ç°å››ä¸ªå­çº¿ç¨‹éƒ½æ‰§è¡Œåˆ°äº†block_queqe_popå‡½æ•°é‡Œé¢ï¼Œå¹¶éƒ½æˆåŠŸæ‰§è¡Œå®Œpthread_mutex_lockï¼Œé˜»å¡åœ¨åé¢çš„whileå¾ªç¯é‡Œé¢ã€‚è¿™é‡Œæˆ‘æƒ³é—®çš„æ˜¯å››ä¸ªå­çº¿ç¨‹ï¼Œä¸æ˜¯æœ€å¤šåªåº”è¯¥æœ‰ä¸€ä¸ªèƒ½æ‹¿åˆ°äº’æ–¥é‡ï¼Œå…¶ä»–ä¸‰ä¸ªéƒ½åº”è¯¥é˜»å¡åœ¨pthread_mutex_lockå‡½æ•°ä¸­ä¹ˆï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519086,"discussion_content":"é—®é¢˜çš„å…³é”®æ˜¯pthread_cond_waitè¿™ä¸ªå‡½æ•°ï¼Œäº‹å®ä¸Šï¼Œè¿™ä¸ªå‡½æ•°ä½¿å¾—å½“å‰çº¿ç¨‹è¿›å…¥ä¼‘çœ ï¼Œå¹¶ä¸”é‡Šæ”¾å½“å‰çº¿ç¨‹æŒæœ‰çš„äº’æ–¥é”ã€‚è€Œå½“è°ƒç”¨çº¿ç¨‹åæ¥ä»pthread_cond_waitè¿”å›æ—¶ï¼Œè¯¥çº¿ç¨‹å†æ¬¡æŒæœ‰è¯¥äº’æ–¥é”ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå››ä¸ªå­çº¿ç¨‹éƒ½å¯ä»¥è·‘å®Œpthread_mutex_lockï¼Œç„¶åéƒ½åœ¨pthread_cond_waitè¿™ä¸ªå‡½æ•°ä¸­ä¼‘çœ ç­‰å¾…çš„åŸå› ã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620223386,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":191801,"user_name":"æ„šç¬¨çš„è€é¼ ","can_delete":false,"product_type":"c1","uid":1896619,"ip_address":"","ucode":"85E16D1338396B","user_header":"https://static001.geekbang.org/account/avatar/00/1c/f0/ab/3f7f3ae7.jpg","comment_is_top":false,"comment_ctime":1584797242,"is_pvip":false,"replies":[{"id":"73531","content":"é—®é¢˜çš„å…³é”®åœ¨äºpthread_cond_waitçš„è¯­ä¹‰ï¼Œåœ¨æ¶ˆè´¹è€…çº¿ç¨‹ä¸­ï¼Œé€šè¿‡waitç­‰å¾…è¿æ¥å¤„ç†ï¼Œè¿™ä¸ªæ—¶å€™acceptä¹‹åæ‰§è¡Œ pushè·å–é”æ˜¯å¯ä»¥çš„ï¼Œå¹¶ä¸”é€šè¿‡signalçš„æ–¹å¼è®©æ¶ˆè´¹è€…çº¿ç¨‹è‹é†’è¿‡æ¥å¤„ç†ã€‚<br><br>åœ¨ç»å¤§éƒ¨åˆ†æ—¶åˆ»ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹éƒ½æ˜¯åœ¨waitçŠ¶æ€çš„ï¼Œpushä¸€å¼€å§‹çš„locké”åªæ˜¯ä¸€ä¸ªéå¸¸çŸ­æš‚çš„checkåŠ¨ä½œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1584863190,"ip_address":"","comment_id":191801,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10174731834","product_id":100032701,"comment_content":"æœ‰ä¸ªåœ°æ–¹ä¸å¤ªç†è§£ï¼Œä¸€å¼€å§‹åˆå§‹çŠ¶æ€ä¸‹ï¼Œçº¿ç¨‹popåŠ é”äº†ï¼Œä¸ºä»€ä¹ˆï¼Œæœ‰acceptæ—¶å€™ï¼Œæ‰§è¡Œpushçš„æ—¶å€™è·å–é”æ€ä¹ˆèƒ½æˆåŠŸå‘¢ï¼Œä¸æ˜¯é”å·²ç»è¢«popç”¨äº†ï¼Œè¿˜æ²¡é‡Šæ”¾å‘¢","like_count":2,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488260,"discussion_content":"é—®é¢˜çš„å…³é”®åœ¨äºpthread_cond_waitçš„è¯­ä¹‰ï¼Œåœ¨æ¶ˆè´¹è€…çº¿ç¨‹ä¸­ï¼Œé€šè¿‡waitç­‰å¾…è¿æ¥å¤„ç†ï¼Œè¿™ä¸ªæ—¶å€™acceptä¹‹åæ‰§è¡Œ pushè·å–é”æ˜¯å¯ä»¥çš„ï¼Œå¹¶ä¸”é€šè¿‡signalçš„æ–¹å¼è®©æ¶ˆè´¹è€…çº¿ç¨‹è‹é†’è¿‡æ¥å¤„ç†ã€‚\n\nåœ¨ç»å¤§éƒ¨åˆ†æ—¶åˆ»ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹éƒ½æ˜¯åœ¨waitçŠ¶æ€çš„ï¼Œpushä¸€å¼€å§‹çš„locké”åªæ˜¯ä¸€ä¸ªéå¸¸çŸ­æš‚çš„checkåŠ¨ä½œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584863190,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005528,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/d8/425e1b0a.jpg","nickname":"å°è™¾ç±³","note":"","ucode":"F543987A7FAB20","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":263615,"discussion_content":"pthread_cond_wait åœ¨ç­‰å¾…æ¡ä»¶åˆ°æ¥çš„è¿‡ç¨‹ä¸­æ˜¯å…ˆæŠŠé”é‡Šæ”¾æ‰äº†","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1589213359,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":190789,"user_name":"æ„šç¬¨çš„è€é¼ ","can_delete":false,"product_type":"c1","uid":1896619,"ip_address":"","ucode":"85E16D1338396B","user_header":"https://static001.geekbang.org/account/avatar/00/1c/f0/ab/3f7f3ae7.jpg","comment_is_top":false,"comment_ctime":1584692630,"is_pvip":false,"replies":[{"id":"73534","content":"ç¡®å®å¦‚æ­¤ï¼Œéœ€è¦åœ¨å¾ªç¯å‡½æ•°é‡Œå¤„ç†å®ŒåŠ ä¸Šclose(fd)çš„æ“ä½œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1584863529,"ip_address":"","comment_id":190789,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10174627222","product_id":100032701,"comment_content":"è¿™ä¸ªçº¿ç¨‹å‡½æ•°é‡Œé¢ï¼Œæ²¡æœ‰è°ƒç”¨closeå…³é—­connfdï¼Œå¯¼è‡´ï¼Œå¾ˆå¤šå¾ˆå¤šsocketçŠ¶æ€ä¸å¯¹ï¼Œæ²¡æœ‰æ­£å¸¸è¿›å…¥time_waitçŠ¶æ€<br>tcp4       0      0  127.0.0.1.43211        127.0.0.1.53703        CLOSE_WAIT <br>tcp4       0      0  127.0.0.1.53703        127.0.0.1.43211        FIN_WAIT_2 <br>tcp4       0      0  127.0.0.1.43211        127.0.0.1.53695        CLOSE_WAIT <br>tcp4       0      0  127.0.0.1.53695        127.0.0.1.43211        FIN_WAIT_2","like_count":2,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488054,"discussion_content":"ç¡®å®å¦‚æ­¤ï¼Œéœ€è¦åœ¨å¾ªç¯å‡½æ•°é‡Œå¤„ç†å®ŒåŠ ä¸Šclose(fd)çš„æ“ä½œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584863529,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":181498,"user_name":"supermouse","can_delete":false,"product_type":"c1","uid":1321860,"ip_address":"","ucode":"88072D5F881827","user_header":"https://static001.geekbang.org/account/avatar/00/14/2b/84/07f0c0d6.jpg","comment_is_top":false,"comment_ctime":1582552287,"is_pvip":false,"replies":[{"id":"71036","content":"æˆ‘è§‰å¾—æ˜¯çº¿ç¨‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1583052690,"ip_address":"","comment_id":181498,"utype":1}],"discussion_count":4,"race_medal":0,"score":"10172486879","product_id":100032701,"comment_content":"è€å¸ˆæˆ‘æƒ³é—®ä¸€ä¸‹ï¼Œçº¿ç¨‹çš„åˆ›å»ºé”€æ¯å’Œè¿›ç¨‹çš„åˆ›å»ºé”€æ¯å“ªä¸ªå¼€é”€æ¯”è¾ƒå¤§ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485014,"discussion_content":"æˆ‘è§‰å¾—æ˜¯çº¿ç¨‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583052690,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":2776006,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er5SNsSoiaZw4Qzd2ctH4vtibHQordcLrYsX43oFZFloRTId0op617mcGlrvGx33U8ic2LTgdicoEFPvQ/132","nickname":"Frankey","note":"","ucode":"2F09BC2500C9E7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":569587,"discussion_content":"æ˜¯çº¿ç¨‹?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651491504,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":485014,"ip_address":""},"score":569587,"extra":""}]},{"author":{"id":2675399,"avatar":"https://static001.geekbang.org/account/avatar/00/28/d2/c7/b7f52df2.jpg","nickname":"é›¨é‡Œ","note":"","ucode":"C475DE8B5375AB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546670,"discussion_content":"è‚¯å®šæ˜¯è¿›ç¨‹åˆ›å»ºå’Œé”€æ¯å¼€é”€æ¯”è¾ƒå¤§\n1ã€çº¿ç¨‹çš„åˆ›å»ºæ—¶é—´æ¯”è¿›ç¨‹å¿«ï¼Œå› ä¸ºè¿›ç¨‹åœ¨åˆ›å»ºçš„è¿‡ç¨‹ä¸­ï¼Œè¿˜éœ€è¦ç®¡ç†èµ„æºä¿¡æ¯ï¼Œå¦‚å†…å­˜ã€æ–‡ä»¶ã€‚è€Œçº¿ç¨‹ä¸ç”¨ç®¡ç†è¿™äº›ï¼Œå› ä¸ºå…±äº«å®ƒä»¬ã€‚\n2ã€çº¿ç¨‹çš„ç»ˆæ­¢æ—¶é—´æ¯”è¿›ç¨‹å¿«ï¼Œå› ä¸ºçº¿ç¨‹é‡Šæ”¾çš„èµ„æºæ¯”è¾ƒå°‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642387758,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2184325,"avatar":"https://static001.geekbang.org/account/avatar/00/21/54/85/ab5148ce.jpg","nickname":"duckman","note":"","ucode":"0184C26C4B6C1B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338074,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609165255,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":148708,"user_name":"é˜¿å°”å‘æ–¯","can_delete":false,"product_type":"c1","uid":1244998,"ip_address":"","ucode":"0C9C026D02002D","user_header":"https://static001.geekbang.org/account/avatar/00/12/ff/46/2ea2fe90.jpg","comment_is_top":false,"comment_ctime":1573052081,"is_pvip":false,"replies":[{"id":"57492","content":"å¯ä»¥çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1573283265,"ip_address":"","comment_id":148708,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10162986673","product_id":100032701,"comment_content":"æˆ‘è‡ªå®šä¹‰é˜»å¡é˜Ÿåˆ—(å¤šäº†ä¸ªcntè®¡æ•°å…ƒç´ ä¸ªæ•°ï¼Œå’Œæ¡ä»¶å˜é‡åˆ†å¼€æ¥ï¼Œå®ç°èµ·æ¥æ¸…æ™°æ˜äº†ç®€å•å¤šäº†)<br>typedef struct<br>{<br>  int size;       &#47;&#47;é˜Ÿåˆ—å®¹é‡<br>  int *pFd;      &#47;&#47;å­˜å‚¨é˜Ÿåˆ—å…ƒç´ ï¼ŒåŠ¨æ€åˆ†é…<br>  int cnt;         &#47;&#47;é˜Ÿåˆ—å½“å‰å…ƒç´ ä¸ªæ•°<br>  int pushIdx; &#47;&#47;å…¥é˜Ÿå…ƒç´ ç´¢å¼•<br>  int popIdx;   &#47;&#47;å‡ºå¯¹å…ƒç´ ç´¢å¼•<br>  pthread_mutex_t mutex;  &#47;&#47;é”<br>  pthread_cond_t noFull;     &#47;&#47;éæ»¡ï¼Œå³é˜Ÿåˆ—å…ƒç´ ä¸ªæ•°cntä»sizeå€¼ï¼Œå˜æˆsize - 1æ—¶çš„è§¦å‘æ¡ä»¶<br>  pthread_cond_t noEmpty;&#47;&#47;éç©ºï¼Œå³é˜Ÿåˆ—å…ƒç´ ä¸ªæ•°cntä»0å€¼ï¼Œå˜æˆ1æ—¶çš„è§¦å‘æ¡ä»¶<br>}BlockQueue;","like_count":2,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473579,"discussion_content":"å¯ä»¥çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1573283265,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138646,"user_name":"å®‰æ’","can_delete":false,"product_type":"c1","uid":1260026,"ip_address":"","ucode":"F78CFA9624CAEF","user_header":"https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg","comment_is_top":false,"comment_ctime":1570407499,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10160342091","product_id":100032701,"comment_content":"1.æ²¡ä½ç½®å¯ç”¨å¯ä»¥é€‰æ‹©ä¸¢å¼ƒï¼Œå–å‡ºæ¥ç›´æ¥å…³é—­ï¼Œç­‰å¾…å¯¹æ–¹é‡è¿ï¼Œæˆ–è€…å…ˆåˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦æœ‰ä½ç½®ï¼Œæ²¡ä½ç½®çš„è¯ç›´æ¥å°±ä¸å–å‡ºå¥—æ¥å­—ï¼Œè®©å®ƒç•™åœ¨å†…æ ¸é˜Ÿåˆ—ä¸­ï¼Œè®©å†…æ ¸å¤„ç†ã€‚<br>2.å­˜åœ¨ç«æ€æ¡ä»¶ï¼Œéœ€è¦åŠ é”ï¼Œä¸åŠ é”å¯èƒ½å¤§éƒ¨åˆ†æ—¶é—´ä¹Ÿèƒ½å¾—åˆ°æ­£ç¡®ç»“æœã€‚","like_count":2},{"had_liked":false,"id":209134,"user_name":"æˆ‘ç‘Ÿç‘Ÿçš„æ–¹æ³•","can_delete":false,"product_type":"c1","uid":1065819,"ip_address":"","ucode":"1364CD531E1B72","user_header":"https://static001.geekbang.org/account/avatar/00/10/43/5b/17fef3ba.jpg","comment_is_top":false,"comment_ctime":1587514369,"is_pvip":false,"replies":[{"id":"78412","content":"ä½ å¯ä»¥æƒ³è±¡æˆæœ‰ä¸€ä¸ªI&#47;Oå¤„ç†çš„&quot;å¤šé¢æ‰‹&quot;ï¼Œå¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªI&#47;Oï¼Œæ‰€ä»¥æŠŠå®ƒå«åš&quot;å¤šè·¯I&#47;Oå¤ç”¨&quot;ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1587803970,"ip_address":"","comment_id":209134,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5882481665","product_id":100032701,"comment_content":"å¤šè·¯ I&#47;O å¤ç”¨å…·ä½“æ˜¯å•¥æ„æ€å•Š","like_count":1,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":492719,"discussion_content":"ä½ å¯ä»¥æƒ³è±¡æˆæœ‰ä¸€ä¸ªI/Oå¤„ç†çš„&amp;quot;å¤šé¢æ‰‹&amp;quot;ï¼Œå¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªI/Oï¼Œæ‰€ä»¥æŠŠå®ƒå«åš&amp;quot;å¤šè·¯I/Oå¤ç”¨&amp;quot;ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587803970,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":172718,"user_name":"è¶…å¤§çº¢ç»†èƒ","can_delete":false,"product_type":"c1","uid":1780519,"ip_address":"","ucode":"08FA6FE03A8C27","user_header":"https://static001.geekbang.org/account/avatar/00/1b/2b/27/9676d6b3.jpg","comment_is_top":false,"comment_ctime":1579263179,"is_pvip":false,"replies":[{"id":"68042","content":"å¥½åŠæ³•","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1580624362,"ip_address":"","comment_id":172718,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5874230475","product_id":100032701,"comment_content":"æ¯æ¬¡æ·»åŠ  fd ä¹‹å‰ï¼Œåˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦æ»¡äº†<br> (blockQueue-&gt;rear + 1) % blockQueue-&gt;number == blockQueue-&gt;front<br>å¦‚æœæ»¡äº†å¯ä»¥é‡‡ç”¨ç±»ä¼¼ C++ vector çš„æ‰©å®¹æ–¹å¼ç›´æ¥æŠŠçº¿ç¨‹æ± ç¿»å€æ‰©å®¹ï¼Œ<br>å¦‚æœæ‰©å®¹å‰çš„ blockQueue-&gt;rear &lt; blockQueue-&gt;front <br>è¿˜éœ€è¦å°† 0~blockQueue-&gt;rear çš„ fd ç§»åˆ° blockQueue-&gt;front~blockQueue-&gt;number-1 çš„åé¢ï¼Œå†å°†æ–°çš„ fd åŠ å…¥","like_count":1,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481831,"discussion_content":"å¥½åŠæ³•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580624362,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":154884,"user_name":"é’±","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1574588171,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5869555467","product_id":100032701,"comment_content":"1ï¼šé˜»å¡IO+å¤šè¿›ç¨‹â€”â€”å®ç°ç®€å•ï¼Œæ€§èƒ½ä¸€èˆ¬<br>2ï¼šé˜»å¡IO+å¤šçº¿ç¨‹â€”â€”ç›¸æ¯”äºé˜»å¡IO+å¤šè¿›ç¨‹ï¼Œå‡å°‘äº†ä¸Šä¸‹æ–‡åˆ‡æ¢æ‰€å¸¦æ¥çš„å¼€é”€ï¼Œæ€§èƒ½æœ‰æ‰€æé«˜ã€‚<br>3ï¼šé˜»å¡IO+çº¿ç¨‹æ± â€”â€”ç›¸æ¯”äºé˜»å¡IO+å¤šçº¿ç¨‹ï¼Œå‡å°‘äº†çº¿ç¨‹é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€ï¼Œæ€§èƒ½æœ‰äº†è¿›ä¸€æ­¥çš„æé«˜ã€‚","like_count":1,"discussions":[{"author":{"id":2184325,"avatar":"https://static001.geekbang.org/account/avatar/00/21/54/85/ab5148ce.jpg","nickname":"duckman","note":"","ucode":"0184C26C4B6C1B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334905,"discussion_content":"è¿™é‡Œçš„â€œæ€§èƒ½ä¸€èˆ¬â€ ä¹Ÿè¦çœ‹åœºæ™¯å§ã€‚\næ¯”å¦‚ å½“å‰çš„serverå°±æ˜¯ç”¨æ¥åšCPUå¯†é›†å‹çš„ä»»åŠ¡ï¼Œæ¥å—å®Œæ•°æ®ä¹‹åä¼šæ¶ˆè€—å¤§é‡çš„CPUèµ„æºã€‚\nè¿™ç§åœºæ™¯ï¼Œç¬¬ä¸€ç§æ–¹å¼å°±æ¯”è¾ƒåˆé€‚äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608023064,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":139396,"user_name":"å¤šè¥„ä¸¸","can_delete":false,"product_type":"c1","uid":1074310,"ip_address":"","ucode":"1AA1497C5A293C","user_header":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","comment_is_top":false,"comment_ctime":1570626390,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5865593686","product_id":100032701,"comment_content":"1. (just talk)å¯ä»¥æ‹’ç» æ‰©å®¹ æˆ–è€… åŠ ä¸€ä¸ªä¿¡å·é‡æ¥å˜ä¸ºé˜»å¡é˜Ÿåˆ—å­<br><br>2. ç»å¤§å¤šæ•°æƒ…å†µä¸‹è¿™ä¸ªå€¼å°äº2000å“‡","like_count":1},{"had_liked":false,"id":351770,"user_name":"ç®€ç®€å•å•å°±æ˜¯å¹¸ç¦","can_delete":false,"product_type":"c1","uid":2740779,"ip_address":"","ucode":"A08080E6FD255F","user_header":"https://static001.geekbang.org/account/avatar/00/29/d2/2b/af13fcd6.jpg","comment_is_top":false,"comment_ctime":1658189045,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1658189045","product_id":100032701,"comment_content":"çº¿ç¨‹é‡Œé¢çš„æ‰“å°èƒ½æ˜¾ç¤ºå‡ºæ¥ï¼Ÿï¼Ÿ","like_count":0},{"had_liked":false,"id":347377,"user_name":"åŠŸå¤«ç†ŠçŒ«","can_delete":false,"product_type":"c1","uid":2732243,"ip_address":"","ucode":"D124F4FA4E816F","user_header":"https://static001.geekbang.org/account/avatar/00/29/b0/d3/200e82ff.jpg","comment_is_top":false,"comment_ctime":1653978686,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1653978686","product_id":100032701,"comment_content":"è€å¸ˆï¼Œæˆ‘è®°å¾—é”æœ‰ä¸€ä¸ªæ˜¯éé˜»å¡ï¼Œé‚£èƒ½ä¸èƒ½ç”¨é‚£ä¸ªæ¥æ›¿æ¢æ™®é€šçš„é”æ¥å®ç°è¿™ä¸ªçº¿ç¨‹æ± æ¥å¢åŠ è¿™ä¸ªçº¿ç¨‹æ± çš„è¿è¡Œæ•ˆç‡ã€‚<br>ç¬¬ä¸€é—®æ„Ÿè§‰æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ç”¨é“¾è¡¨æ¥è¯•è¯•æ— è®ºå•å‘è¿˜æ˜¯åŒå‘é“¾è¡¨ç®¡ç†ã€‚æˆ–è€…ç”¨reallocæ¥æ‰©å®¹","like_count":0},{"had_liked":false,"id":347374,"user_name":"åŠŸå¤«ç†ŠçŒ«","can_delete":false,"product_type":"c1","uid":2732243,"ip_address":"","ucode":"D124F4FA4E816F","user_header":"https://static001.geekbang.org/account/avatar/00/29/b0/d3/200e82ff.jpg","comment_is_top":false,"comment_ctime":1653978175,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1653978175","product_id":100032701,"comment_content":"ç¬¬ä¸€é—®ï¼šå¯ä»¥ç»™ä¸€ä¸ªæ‰©å®¹çš„æœ€å¤§å€¼ï¼Œç„¶åç”¨reallocæ‰©å®¹ã€‚å¦‚æœè¶…è¿‡äº†æœ€å¤§å€¼ç„¶åç­‰å¾…ä¸€ä¸ªæ¡ä»¶å˜é‡å°±å¯ä»¥äº†","like_count":0},{"had_liked":false,"id":344158,"user_name":"mikewoo","can_delete":false,"product_type":"c1","uid":1118888,"ip_address":"","ucode":"9AE90E05048DE1","user_header":"https://static001.geekbang.org/account/avatar/00/11/12/a8/8aaf13e0.jpg","comment_is_top":false,"comment_ctime":1651312527,"is_pvip":true,"replies":[{"id":"126192","content":"ğŸ‘ğŸ»","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1618647","ctime":1652614501,"ip_address":"","comment_id":344158,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1651312527","product_id":100032701,"comment_content":"ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯éœ€è¦è€ƒè™‘åœ¨é˜Ÿåˆ—æ»¡äº†çš„åœºæ™¯ä¸‹æ˜¯å¦éœ€è¦åšæ‰©å®¹æˆ–è€…é‡‡å–å„ç§æ‹’ç»ç­–ç•¥ï¼›ç¬¬äºŒä¸ªé—®é¢˜æ˜¯å¤šçº¿ç¨‹æ‰§è¡Œå¸¸è§çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572133,"discussion_content":"ğŸ‘ğŸ»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652614501,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":333973,"user_name":"æ·¡C","can_delete":false,"product_type":"c1","uid":2696647,"ip_address":"","ucode":"046DE6F5301044","user_header":"https://static001.geekbang.org/account/avatar/00/29/25/c7/edd74dfb.jpg","comment_is_top":false,"comment_ctime":1644647639,"is_pvip":false,"replies":[{"id":"122009","content":"æˆ‘çŒœä½ æ˜¯è¯´å¯ä»¥å¾ªåº.....","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1618647","ctime":1644729071,"ip_address":"","comment_id":333973,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1644647639","product_id":100032701,"comment_content":"1.å¯ä»¥è‡ªæ—‹<br>","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550759,"discussion_content":"æˆ‘çŒœä½ æ˜¯è¯´å¯ä»¥å¾ªåº.....","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644729071,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":311272,"user_name":"Geek_842f07","can_delete":false,"product_type":"c1","uid":2698987,"ip_address":"","ucode":"ED772AF755FE7E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/WP4Ge8ABcINFkccKaNYKibicFnI0JAoojBBAUGrichNeRAgzm5RGbHG7GqYrFX3ELEzenuEbicQHJy2HZ72RxSOuMA/132","comment_is_top":false,"comment_ctime":1631152198,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631152198","product_id":100032701,"comment_content":"æ›´æ”¹å…¨éƒ¨å˜é‡çš„æ“ä½œä¸æ˜¯åŸå­æ“ä½œï¼ˆå»æ•°æ®åˆ°å¯„å­˜å™¨ï¼Œå¯„å­˜å™¨å®ŒæˆåŠ æ³•æ“ä½œï¼Œå°†ç»“æœå­˜æ”¾ä¼šæ•°æ®å˜é‡ä¸­ï¼‰ï¼Œå¯èƒ½å¯¼è‡´ä¸€ä¸ªçº¿ç¨‹åœ¨æ›´æ”¹å…¨å±€å˜é‡æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿæ¥æ›´æ”¹è¿™ä¸ªå˜é‡ï¼Œæœ€ç»ˆä¸¤ä¸ªçº¿ç¨‹éƒ½ä¼šå†™å…¥æ–°çš„ç»“æœï¼Œä½†æ˜¯è¿™ä¸ªç»“æœå¯èƒ½æ˜¯é”™è¯¯çš„","like_count":0},{"had_liked":false,"id":300155,"user_name":"vv_test","can_delete":false,"product_type":"c1","uid":1685884,"ip_address":"","ucode":"1D164B2F034E2B","user_header":"https://static001.geekbang.org/account/avatar/00/19/b9/7c/afe6f1eb.jpg","comment_is_top":false,"comment_ctime":1625023076,"is_pvip":false,"replies":[{"id":"109699","content":"è€Œä¸”è¿˜è¦ä¿å­˜è¿›ç¨‹çš„å„ç§ä¸Šä¸‹æ–‡æ•°æ®å“¦ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1626606214,"ip_address":"","comment_id":300155,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1625023076","product_id":100032701,"comment_content":"çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€è¦æ¯”è¿›ç¨‹å°å¾—å¤šã€‚ä¸»è¦æ˜¯å› ä¸ºè™šæ‹Ÿåœ°å€åˆ‡æ¢å¯¼è‡´å¼€é”€æ›´å¤§ç‚¹ã€‚","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":522657,"discussion_content":"è€Œä¸”è¿˜è¦ä¿å­˜è¿›ç¨‹çš„å„ç§ä¸Šä¸‹æ–‡æ•°æ®å“¦ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626606214,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":287772,"user_name":"ç‹è“¬å‹ƒ","can_delete":false,"product_type":"c1","uid":2450040,"ip_address":"","ucode":"DDF4CCE9728DCF","user_header":"","comment_is_top":false,"comment_ctime":1618142839,"is_pvip":false,"replies":[{"id":"104847","content":"æœ‰äº›å¤§å•Šï¼Œè¿™ä¸ªtid......<br><br>calculatorè¿™ä¸ªå€¼ä¸å¯¹æ˜¯æ­£å¸¸çš„","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1618751441,"ip_address":"","comment_id":287772,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1618142839","product_id":100032701,"comment_content":"è¿™æ˜¯æˆ‘è·‘å‡ºæ¥çš„ç»“æœã€‚ã€‚ã€‚ã€‚<br>hello, world, tid == 140117162977024<br>hello, world, tid == 140117171369728<br>calculator is 24091<br>another_shared is 2000<br>","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518415,"discussion_content":"æœ‰äº›å¤§å•Šï¼Œè¿™ä¸ªtid......\n\ncalculatorè¿™ä¸ªå€¼ä¸å¯¹æ˜¯æ­£å¸¸çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618751441,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":287735,"user_name":"Geek_93d8e2","can_delete":false,"product_type":"c1","uid":2024432,"ip_address":"","ucode":"67A65E1DCA3D3A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/B6Ed9L0AoFg96622tjfaib6obcf1KfKJ9mF0UHOFoQYDFsLgGfqG38kibx4cYVZhKBAzNEmnYd0LbWSDGNuL0X3A/132","comment_is_top":false,"comment_ctime":1618129126,"is_pvip":false,"replies":[{"id":"104495","content":"ä¸ä¼šã€‚<br><br>æ³¨æ„è¿™ä¸ªæ—¶å€™rearè¢«é‡æ–°ç½®ä¸º0äº†ã€‚<br> if (++blockQueue-&gt;rear == blockQueue-&gt;number) {<br>        blockQueue-&gt;rear = 0;<br>  }<br><br>æ‰€ä»¥æ˜¯ <br>blockQueue-&gt;fd[0] = fd<br>","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1618140904,"ip_address":"","comment_id":287735,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1618129126","product_id":100032701,"comment_content":"   25è¡Œ ä¼šé€ æˆæ•°ç»„è¶Šç•Œå§ <br> blockQueue-&gt;fd[blockQueue-&gt;rear] = fd;<br>    if (++blockQueue-&gt;rear == blockQueue-&gt;number) {<br>        blockQueue-&gt;rear = 0;<br>    }<br>å½“numberä¸º1æ—¶ï¼Œç¬¬äºŒæ¬¡æ’å…¥æ—¶blockQueue-&gt;fd[1]","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":518400,"discussion_content":"ä¸ä¼šã€‚\n\næ³¨æ„è¿™ä¸ªæ—¶å€™rearè¢«é‡æ–°ç½®ä¸º0äº†ã€‚\n if (++blockQueue-&amp;gt;rear == blockQueue-&amp;gt;number) {\n        blockQueue-&amp;gt;rear = 0;\n  }\n\næ‰€ä»¥æ˜¯ \nblockQueue-&amp;gt;fd[0] = fd\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618140904,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":246341,"user_name":"å¿†æ°´å¯’","can_delete":false,"product_type":"c1","uid":1147453,"ip_address":"","ucode":"E3F86BD8AA8903","user_header":"https://static001.geekbang.org/account/avatar/00/11/82/3d/356fc3d6.jpg","comment_is_top":false,"comment_ctime":1599286596,"is_pvip":false,"replies":[{"id":"90595","content":"ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1599402180,"ip_address":"","comment_id":246341,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1599286596","product_id":100032701,"comment_content":"ç¬¬ä¸€é“ï¼Œæ‰©å®¹ã€‚<br>ç¬¬äºŒé“ï¼Œå¤šçº¿ç¨‹å¹¶å‘ä¼šé€ æˆç»“æœä¸ä¸€è‡´ï¼ŒåŸå› åœ¨äºéåŸå­æ€§æ“ä½œã€‚","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505117,"discussion_content":"ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599402180,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":246054,"user_name":"äº•åº•ä¹‹è›™","can_delete":false,"product_type":"c1","uid":1624505,"ip_address":"","ucode":"DAEE283B210B23","user_header":"https://static001.geekbang.org/account/avatar/00/18/c9/b9/aff32d3c.jpg","comment_is_top":false,"comment_ctime":1599145175,"is_pvip":false,"replies":[{"id":"90593","content":"ä½ æ˜¯å›ç­”çš„è¿™ä¸ªé—®é¢˜ï¼Ÿ<br>æˆ‘åœ¨è®²åˆ°ç¬¬ä¸€ä¸ª hello-world è®¡æ•°å™¨åº”ç”¨æ—¶ï¼Œè¯´â€œç»“æœæ˜¯å¹¸è¿â€è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ€ä¹ˆç†è§£å‘¢ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1599400461,"ip_address":"","comment_id":246054,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1599145175","product_id":100032701,"comment_content":"ç¬¬äºŒä¸ªé—®é¢˜ï¼Œæ˜¯å¿…é¡»è¦è®¾ç½®çš„ï¼Œä¸è®¾ç½®çš„è¯ï¼Œå†…æ ¸å°±ä¼šè®¤ä¸ºç”¨æˆ·ä¸å…³å¿ƒè¿™ä¸ªï¼Œå³ä½¿æœ‰äº‹ä»¶å‘ç”Ÿä¹Ÿä¸ä¼šç½®ä½ï¼Œdo_sys_poll()å‡½æ•°è¿™ä¸ªåˆ¤æ–­ã€‚","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505046,"discussion_content":"ä½ æ˜¯å›ç­”çš„è¿™ä¸ªé—®é¢˜ï¼Ÿ\næˆ‘åœ¨è®²åˆ°ç¬¬ä¸€ä¸ª hello-world è®¡æ•°å™¨åº”ç”¨æ—¶ï¼Œè¯´â€œç»“æœæ˜¯å¹¸è¿â€è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ€ä¹ˆç†è§£å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599400461,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":232747,"user_name":"éƒ‘ç¥–ç…Œ","can_delete":false,"product_type":"c1","uid":1469608,"ip_address":"","ucode":"49A0D2E3279826","user_header":"https://static001.geekbang.org/account/avatar/00/16/6c/a8/1922a0f5.jpg","comment_is_top":false,"comment_ctime":1594107558,"is_pvip":false,"replies":[{"id":"86803","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1594906602,"ip_address":"","comment_id":232747,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1594107558","product_id":100032701,"comment_content":"1. å¯ä»¥ä½¿ç”¨é“¾è¡¨æ¥å­˜å‚¨ï¼Œè¿™æ ·å½“é˜Ÿåˆ—ä¸å¤Ÿæ—¶è¿˜èƒ½å¤Ÿå†åˆ›å»ºé“¾è¡¨å»è¿æ¥ä¸Šï¼ŒåŒæ—¶å¦‚æœçº¿ç¨‹é€€å‡ºçš„æ—¶å€™å°±åˆ é™¤å¯¹åº”çš„èŠ‚ç‚¹<br>2.ç»“æœå¾ˆå¹¸è¿ã€‚å› ä¸ºä»–çš„è¿è¡Œç»“æœéƒ½æ˜¯ä¸€æ¬¡è¿è¡Œå®Œthread_runç´§æ¥ç€è¿è¡Œä¸‹ä¸€æ¬¡çš„thread_runçš„å€¼ã€‚ å¦‚æœçº¿ç¨‹ä¹‹é—´äº¤äº’è¿è¡Œï¼Œæ¯”å¦‚çº¿ç¨‹1åˆšæ‰§è¡Œç©*calculator += 1; æœ‰å¯èƒ½å¦ä¸€ä¸ªçº¿ç¨‹å°±è¿è¡Œint *calculator = (int *) arg; è¿™æ ·å°±è¾¾ä¸åˆ°2000äº†ã€‚","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500759,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594906602,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":225835,"user_name":"ææ²›éœ–-ç¨‹åºçŒ¿","can_delete":false,"product_type":"c1","uid":1063957,"ip_address":"","ucode":"10CF0DBED2D220","user_header":"https://static001.geekbang.org/account/avatar/00/10/3c/15/71a2aca9.jpg","comment_is_top":false,"comment_ctime":1591869132,"is_pvip":false,"replies":[{"id":"84274","content":"çº¿ç¨‹æ± ä¹Ÿæ˜¯æŠŠå¤šä¸ªçº¿ç¨‹æœ‰æ•ˆçš„ç»„ç»‡èµ·æ¥ä½¿ç”¨ï¼Œä¸æ˜¯å–æ¶ˆçº¿ç¨‹çš„æ„æ€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1592743754,"ip_address":"","comment_id":225835,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1591869132","product_id":100032701,"comment_content":"é‚£ç”¨äº†æ± æŠ€æœ¯ï¼Œå°±æ²¡æœ‰è¿›ç¨‹åˆ‡æ¢çš„é—®é¢˜äº†ã€‚çº¿ç¨‹æ˜¯ä¸æ˜¯å°±å¯ä»¥å–æ¶ˆäº†ã€‚è€Œä¸”è¿›ç¨‹çš„éš”ç¦»å‹æ¯”è¾ƒå¥½ã€‚","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":498011,"discussion_content":"çº¿ç¨‹æ± ä¹Ÿæ˜¯æŠŠå¤šä¸ªçº¿ç¨‹æœ‰æ•ˆçš„ç»„ç»‡èµ·æ¥ä½¿ç”¨ï¼Œä¸æ˜¯å–æ¶ˆçº¿ç¨‹çš„æ„æ€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592743754,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":222494,"user_name":"jhren","can_delete":false,"product_type":"c1","uid":1596987,"ip_address":"","ucode":"60F7CCEA1E2C88","user_header":"https://static001.geekbang.org/account/avatar/00/18/5e/3b/845fb641.jpg","comment_is_top":false,"comment_ctime":1590821144,"is_pvip":false,"replies":[{"id":"82180","content":"æˆ‘çœ‹åº”è¯¥æ˜¯å¤šè·¯å¤ç”¨I&#47;Oä¸ºä¸»çš„äº‹ä»¶é©±åŠ¨æ¨¡å‹å§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1590931614,"ip_address":"","comment_id":222494,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1590821144","product_id":100032701,"comment_content":"è¯·é—®è€å¸ˆï¼ŒRedis6.0å¤šçº¿ç¨‹æ¨¡å‹æ˜¯ä¸æ˜¯å°±æ˜¯&quot;é˜»å¡I&#47;Oå’Œçº¿ç¨‹æ¨¡å‹&quot;<br>https:&#47;&#47;www.dropbox.com&#47;s&#47;ooyxgfhh7pzf6i9&#47;redis-threads.png?dl=0<br>https:&#47;&#47;time.geekbang.org&#47;course&#47;detail&#47;100051101-241464<br>","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496816,"discussion_content":"æˆ‘çœ‹åº”è¯¥æ˜¯å¤šè·¯å¤ç”¨I/Oä¸ºä¸»çš„äº‹ä»¶é©±åŠ¨æ¨¡å‹å§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590931614,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":181465,"user_name":"supermouse","can_delete":false,"product_type":"c1","uid":1321860,"ip_address":"","ucode":"88072D5F881827","user_header":"https://static001.geekbang.org/account/avatar/00/14/2b/84/07f0c0d6.jpg","comment_is_top":false,"comment_ctime":1582546572,"is_pvip":false,"replies":[{"id":"71037","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1583052713,"ip_address":"","comment_id":181465,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1582546572","product_id":100032701,"comment_content":"æ€è€ƒé¢˜ç¬¬ä¸€é“ï¼šæˆ‘èƒ½æƒ³åˆ°çš„æœ‰ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§æ˜¯åŠ¨æ€æ‰©å®¹ï¼Œå°†æè¿°å­—çš„æ•°ç»„æ‰©å¤§1å€ï¼›ç¬¬äºŒç§æ–¹å¼æ˜¯é‡‡ç”¨é“¾è¡¨çš„æ–¹å¼å®ç°æè¿°å­—é˜Ÿåˆ—ã€‚<br>æ€è€ƒé¢˜ç¬¬äºŒé“ï¼šCPUç¼“å­˜ä¼šå¯¼è‡´å¯è§æ€§é—®é¢˜ï¼Œå³ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹ä¸€ä¸ªå˜é‡æ—¶ï¼Œä¼šå‡ºç°å‰ä¸€ä¸ªçº¿ç¨‹çš„ä¿®æ”¹ç»“æœè¢«åä¸€ä¸ªçº¿ç¨‹è¦†ç›–æ‰çš„æƒ…å†µï¼Œå¯¼è‡´æœ€åå˜é‡çš„å€¼ä¸æ˜¯é¢„æœŸçš„2000ï¼Œè€Œæ˜¯ä»‹äº1000~2000ä¹‹é—´ã€‚","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":485007,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583052713,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1316758,"avatar":"https://static001.geekbang.org/account/avatar/00/14/17/96/846fc11b.jpg","nickname":"Richard","note":"","ucode":"893F958B9DD161","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":204293,"discussion_content":"ç¬¬äºŒä¸ªé—®é¢˜å¹¶ä¸æ˜¯CPUç¼“å­˜é—®é¢˜ï¼ŒCPUçš„æ¶æ„è®¾è®¡æœ¬èº«ä¼šä¿è¯ç¼“å­˜ä¸€è‡´æ€§ï¼Œç¨‹åºå‘˜åº”è¯¥å…³æ³¨çš„æ˜¯é¡ºåºä¸€è‡´æ€§é—®é¢˜ï¼Œè¿™é‡Œä¼šæœ‰é—®é¢˜æ˜¯å› ä¸ºå¯¹äºå…±äº«å˜é‡çš„ä¿®æ”¹ä¸æ˜¯åŸå­çš„ï¼Œå› æ­¤åœ¨æŒ‡ä»¤è¿è¡ŒæœŸé—´æœ‰å¯èƒ½è¢«è°ƒåº¦å™¨æ‰“ç ´ä»è€Œé€ æˆç»“æœä¸å‡†ç¡®ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584150767,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1321860,"avatar":"https://static001.geekbang.org/account/avatar/00/14/2b/84/07f0c0d6.jpg","nickname":"supermouse","note":"","ucode":"88072D5F881827","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1316758,"avatar":"https://static001.geekbang.org/account/avatar/00/14/17/96/846fc11b.jpg","nickname":"Richard","note":"","ucode":"893F958B9DD161","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":206422,"discussion_content":"å•æ ¸CPUçš„ç¼“å­˜ä¸ä¼šå¯¼è‡´è¿™ä¸ªé—®é¢˜ï¼Œä½†å¦‚æœæ˜¯å¤šæ ¸CPUï¼Œæ¯ä¸ªCPUéƒ½æœ‰è‡ªå·±çš„ç¼“å­˜ï¼Œå°±ä¼šæœ‰è¿™ä¸ªé—®é¢˜äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584404978,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":204293,"ip_address":""},"score":206422,"extra":""}]}]},{"had_liked":false,"id":161926,"user_name":"Geek_68d3d2","can_delete":false,"product_type":"c1","uid":1674369,"ip_address":"","ucode":"EBD6D881AA7A74","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqf54z1ZmqQY1kmJ6t1HAnrqMM3j6WKf0oDeVLhtnA2ZUKY6AX9MK6RjvcO8SiczXy3uU0IzBQ3tpw/132","comment_is_top":false,"comment_ctime":1576406348,"is_pvip":false,"replies":[{"id":"63918","content":"å¯èƒ½çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1577604774,"ip_address":"","comment_id":161926,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1576406348","product_id":100032701,"comment_content":"çº¿ç¨‹é‡Œé¢ ç”¨å®Œçš„fdå¥½åƒéƒ½æ²¡æœ‰closeæ‰å§","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477914,"discussion_content":"å¯èƒ½çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577604774,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":143167,"user_name":"Steiner","can_delete":false,"product_type":"c1","uid":1622329,"ip_address":"","ucode":"232C1C75207A1E","user_header":"https://static001.geekbang.org/account/avatar/00/18/c1/39/11904266.jpg","comment_is_top":false,"comment_ctime":1571641948,"is_pvip":false,"replies":[{"id":"55836","content":"æˆ‘çš„mainå‡½æ•°å·²ç»åœ¨éªŒè¯äº†ï¼Œå¼€å¤šä¸ªçº¿ç¨‹ï¼Œæœ‰å¾€é˜Ÿåˆ—é‡Œæ‰”å¯¹è±¡çš„ï¼Œæœ‰ä»é˜Ÿåˆ—é‡Œå–å¯¹è±¡å¤„ç†çš„ï¼Œçœ‹çœ‹è¿™ä¸ªç¨‹åºæ˜¯å¦å¯ä»¥å¤„ç†é«˜å¹¶å‘çš„åœºæ™¯ï¼Œè¿™å°±æ˜¯ä½ çš„ä»£ç é€»è¾‘éœ€è¦å…³æ³¨çš„ç‚¹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1572059141,"ip_address":"","comment_id":143167,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1571641948","product_id":100032701,"comment_content":"è¯·é—®æˆ‘æƒ³éªŒè¯è¿™ä¸ªé˜»å¡é˜Ÿåˆ—çš„æ­£ç¡®æ€§ï¼Œé‚£æˆ‘çš„ä»£ç é€»è¾‘åº”è¯¥æ€ä¹ˆå†™","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471404,"discussion_content":"æˆ‘çš„mainå‡½æ•°å·²ç»åœ¨éªŒè¯äº†ï¼Œå¼€å¤šä¸ªçº¿ç¨‹ï¼Œæœ‰å¾€é˜Ÿåˆ—é‡Œæ‰”å¯¹è±¡çš„ï¼Œæœ‰ä»é˜Ÿåˆ—é‡Œå–å¯¹è±¡å¤„ç†çš„ï¼Œçœ‹çœ‹è¿™ä¸ªç¨‹åºæ˜¯å¦å¯ä»¥å¤„ç†é«˜å¹¶å‘çš„åœºæ™¯ï¼Œè¿™å°±æ˜¯ä½ çš„ä»£ç é€»è¾‘éœ€è¦å…³æ³¨çš„ç‚¹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572059141,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":142424,"user_name":"Steiner","can_delete":false,"product_type":"c1","uid":1622329,"ip_address":"","ucode":"232C1C75207A1E","user_header":"https://static001.geekbang.org/account/avatar/00/18/c1/39/11904266.jpg","comment_is_top":false,"comment_ctime":1571366460,"is_pvip":false,"replies":[{"id":"55126","content":"åˆæ³•çš„ï¼Œä¼ å€¼è¿˜æ˜¯ä¼ åœ°å€ï¼Œæ˜¯è‡ªå·±åœ¨ç¨‹åºé‡Œé¢å®šä¹‰çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1571457734,"ip_address":"","comment_id":142424,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1571366460","product_id":100032701,"comment_content":"è¯·é—®thread_runå‡½æ•°é‡Œè¿™ä¸ªint fd = (int) arg åˆæ³•å—ï¼Œæˆ‘è§‰å¾—æ˜¯int fd = *(int *)argå§<br>","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471120,"discussion_content":"åˆæ³•çš„ï¼Œä¼ å€¼è¿˜æ˜¯ä¼ åœ°å€ï¼Œæ˜¯è‡ªå·±åœ¨ç¨‹åºé‡Œé¢å®šä¹‰çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571457734,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1154146,"avatar":"https://static001.geekbang.org/account/avatar/00/11/9c/62/f625b2bb.jpg","nickname":"é…¸è‘¡è„","note":"","ucode":"9D059C4FB327C0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":53607,"discussion_content":"è€å¸ˆä½ å¥½ï¼Œè¿™æ ·çš„å†™æ³• int fd = (int) arg  ç¼–è¯‘ä¸è¿‡å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574178589,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":140765,"user_name":"ä¼ è¯´ä¸­çš„æˆå¤§å¤§","can_delete":false,"product_type":"c1","uid":1236766,"ip_address":"","ucode":"103543D6E706BF","user_header":"https://static001.geekbang.org/account/avatar/00/12/df/1e/cea897e8.jpg","comment_is_top":false,"comment_ctime":1571045293,"is_pvip":false,"replies":[{"id":"55084","content":"æä¸ªMRæˆ–è€…issue?æˆ‘çœ‹å¤§å®¶éƒ½æ­£å¸¸å•Šï¼Œä½ çš„ç³»ç»Ÿæ˜¯å•¥ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1571453373,"ip_address":"","comment_id":140765,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1571045293","product_id":100032701,"comment_content":" pthread_create(&amp;(thread_array[i].thread_tid), NULL, &amp;thread_run, (void *) &amp;blockQueue);<br>pthread_createå‡½æ•°è°ƒç”¨è¿™é‡Œæœ‰é—®é¢˜ åº”è¯¥æ˜¯<br>void* thread_run(void *arg) {<br>    pthread_t tid = pthread_self();<br>    pthread_detach(tid);<br><br>    block_queue *blockQueue = (block_queue *) arg;<br>    while (1) {<br>        int fd = block_queue_pop(blockQueue);<br>        printf(&quot;get fd in thread, fd==%d, tid == %d&quot;, fd, tid);<br>        loop_echo(fd);<br>    }<br>}<br>æˆ‘ç¼–è¾‘ä»£ç çš„æ—¶å€™æ€»æ˜¯æŠ¥é”™ åæ¥é€šè¿‡manå‡½æ•°å’Œç¼–è¯‘æ‰å·®å‡ºæ¥","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470545,"discussion_content":"æä¸ªMRæˆ–è€…issue?æˆ‘çœ‹å¤§å®¶éƒ½æ­£å¸¸å•Šï¼Œä½ çš„ç³»ç»Ÿæ˜¯å•¥ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571453373,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1217413,"avatar":"https://static001.geekbang.org/account/avatar/00/12/93/85/f5d9474c.jpg","nickname":"ä¹”ä¸¹","note":"","ucode":"D832A9F97A0C7E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348227,"discussion_content":"centos7+gcc6.3,void *thread_run(void *arg)æ‰èƒ½ç¼–è¯‘æˆåŠŸã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612487793,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":140727,"user_name":"ä¼ è¯´ä¸­çš„æˆå¤§å¤§","can_delete":false,"product_type":"c1","uid":1236766,"ip_address":"","ucode":"103543D6E706BF","user_header":"https://static001.geekbang.org/account/avatar/00/12/df/1e/cea897e8.jpg","comment_is_top":false,"comment_ctime":1571038821,"is_pvip":false,"replies":[{"id":"55082","content":"ä½ çš„ä¾‹å­æ˜¯è¯´accetporä¸è¦æ— é™åˆ¶çš„æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œç›¸å½“äºåšäº†ä¸€ä¸ªé™æµï¼Œè¿™ä¹Ÿæ˜¯æ¯”è¾ƒå¸¸è§çš„ä¸€ç§æ‰‹æ®µã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1571453215,"ip_address":"","comment_id":140727,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1571038821","product_id":100032701,"comment_content":"çœ‹äº†gitä¸Šçš„ä»£ç ,æˆ‘åˆæ€è€ƒäº†ç¬¬ä¸€é¢˜ ä¸€èˆ¬æ¥è¯´è‚¯å®šæ•°é‡ä¸€å®šä¼šè¢«é™å®š,ä¸å¯èƒ½æ— çº¿æ‰©å®¹,å¹¶ä¸”è¿˜è¦å›æ”¶åˆ©ç”¨,æ¯”å¦‚æŸä¸ªè¿æ¥å…³é—­äº†,å°±åº”è¯¥å°†å…¶ç§»é™¤,è€Œä¸æ˜¯å†å¯¹å…¶è¿›è¡Œè¯»å†™ç­‰æ“ä½œ,ä¸ç„¶ä¼šæµªè´¹å¾ˆå¤šèµ„æº,è¿˜å®¹æ˜“å‡ºç°å¾ˆå¤šè«åå…¶å¦™çš„tcpå±‚é¢é”™è¯¯,æœ€ç®€å•çš„ä¾‹å­ å¾ˆå¤šæ¸¸æˆéƒ½è®¾ç½®äº†ä¸€ä¸ªæ’é˜Ÿ,ä¾‹å¦‚ä¹‹å‰çœ‹è§è‹±é›„è”ç›Ÿåœ¨ç™»å½•ç•Œé¢çš„æ’é˜Ÿ,è¿˜æœ‰é­”å…½ä¹Ÿæœ‰ç±»ä¼¼çš„æ“ä½œ,æ‰€ä»¥å¦‚æœæœ¬æ¥æè¿°ç¬¦æ•°é‡å·²ç»è®¾ç½®åˆ°åˆç†å¤§å°äº†å°±ä¸è¦å†æ‰©å®¹è€Œæ˜¯é‡‡å–æ’é˜Ÿè¿›å…¥çš„æ–¹å¼","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470529,"discussion_content":"ä½ çš„ä¾‹å­æ˜¯è¯´accetporä¸è¦æ— é™åˆ¶çš„æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥ï¼Œç›¸å½“äºåšäº†ä¸€ä¸ªé™æµï¼Œè¿™ä¹Ÿæ˜¯æ¯”è¾ƒå¸¸è§çš„ä¸€ç§æ‰‹æ®µã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571453215,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":140709,"user_name":"ä¼ è¯´ä¸­çš„æˆå¤§å¤§","can_delete":false,"product_type":"c1","uid":1236766,"ip_address":"","ucode":"103543D6E706BF","user_header":"https://static001.geekbang.org/account/avatar/00/12/df/1e/cea897e8.jpg","comment_is_top":false,"comment_ctime":1571035904,"is_pvip":false,"replies":[{"id":"55080","content":"ç¬¬ä¸€ä¸ªé—®é¢˜å¯ä»¥æä¸ªMRç»™æˆ‘å“ˆ","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1571452835,"ip_address":"","comment_id":140709,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1571035904","product_id":100032701,"comment_content":"ç¬¬ä¸€é—® è¿æ¥å­—é˜Ÿåˆ—ä¸å¯èƒ½è¯´æ— é™æ‰©å®¹,å½“æŸä¸ªè¿æ¥æ–­å¼€æ—¶åº”è¯¥æ˜¯è¦ä»è¿æ¥å­—é˜Ÿåˆ—é‡Œé¢ç§»é™¤<br>ç¬¬äºŒé—® é‚£æ˜¯å› ä¸ºæ²¡æœ‰å‡ºç°å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µä¹Ÿå°±æ˜¯å¼‚æ­¥äº‹ä»¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åŠ é”æ¥è§£å†³å¼‚æ­¥é—®é¢˜","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":470520,"discussion_content":"ç¬¬ä¸€ä¸ªé—®é¢˜å¯ä»¥æä¸ªMRç»™æˆ‘å“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571452835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":139253,"user_name":"èµ–é˜¿ç”˜","can_delete":false,"product_type":"c1","uid":1351988,"ip_address":"","ucode":"77493FE85CBAF8","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTICBNZjA9hW65x6g9b2iaicKUJW5gxFxtgPXH9Cqp6eyFfY1sD2hVY4dZrY5pmoK2r1KZEiaaIKocdZQ/132","comment_is_top":false,"comment_ctime":1570592755,"is_pvip":false,"replies":[{"id":"54322","content":"æˆ‘ç†è§£pthread_detachä»¥åå°±ä¸èƒ½äº†ï¼Œä½ å¯ä»¥å°è¯•ä¸€ä¸‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1570973235,"ip_address":"","comment_id":139253,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1570592755","product_id":100032701,"comment_content":"åˆ†ç¦»çº¿ç¨‹ä¸­çš„â€œè€Œä¸€ä¸ªåˆ†ç¦»çš„çº¿ç¨‹ä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹æ€æ­»æˆ–å›æ”¶èµ„æºã€‚â€è¿™å¥è¯æœ‰è¯¯ï¼Ÿè™½ç„¶ä½ è°ƒç”¨pthread_detachï¼ˆï¼‰ï¼Œä½†æ˜¯å…¶ä»–çº¿ç¨‹è¿˜æ˜¯å¯ä»¥é€šè¿‡pthread_cancelï¼ˆï¼‰ç»“æŸè¿™ä¸ªçº¿ç¨‹å§ï¼è¿˜æœ›è€å¸ˆæŒ‡ç‚¹","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469856,"discussion_content":"æˆ‘ç†è§£pthread_detachä»¥åå°±ä¸èƒ½äº†ï¼Œä½ å¯ä»¥å°è¯•ä¸€ä¸‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570973235,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":138793,"user_name":"æˆ‘æ¥ä¹Ÿ","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1570453574,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570453574","product_id":100032701,"comment_content":"1.é˜Ÿåˆ—æ»¡å¯ä»¥å…³é—­fdæ‹’ç»æœåŠ¡ï¼Œä¹Ÿå¯ä»¥æ‰©å®¹ç­‰å¾…é˜Ÿåˆ—ï¼Œä½†éƒ½ä¸å¤ªå¥½ã€‚æ¯•ç«Ÿä¸€ä¸ªçº¿ç¨‹æœåŠ¡ä¸€ä¸ªsocketçš„å¼€é”€è¿˜æ˜¯æœ‰ç‚¹å¤§ã€‚è¿˜æ˜¯å¤šè·¯å¤ç”¨åŠ å¼‚æ­¥æ¯”è¾ƒåˆ’ç®—ã€‚<br>2.å°±æ˜¯å¹¶å‘ä¼šäº§ç”Ÿä¸ç¡®å®šæ€§ã€‚åœ¨è¿™ä¸ªå¾ªç¯æ¬¡æ•°ä»1000å˜å¤§äº›ï¼Œå‡ºç°çš„æ¦‚ç‡å¯èƒ½å°±æ›´å¤§äº†ã€‚","like_count":0},{"had_liked":false,"id":138641,"user_name":"ç¨‹åºæ°´æœå®","can_delete":false,"product_type":"c1","uid":1371633,"ip_address":"","ucode":"1700DDFE073A56","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqyicZYyW7ahaXgXUD8ZAS8x0t8jx5rYLhwbUCJiawRepKIZfsLdkxdQ9XQMo99c1UDibmNVfFnAqwPg/132","comment_is_top":false,"comment_ctime":1570403249,"is_pvip":false,"replies":[{"id":"54310","content":"typedef struct {<br>    pthread_t thread_tid;        &#47;* thread ID *&#47;<br>    long thread_count;    &#47;* # connections handled *&#47;<br>} Thread;<br><br>å› ä¸ºç¯‡å¹…åŸå› ï¼Œä¸æ˜¯æ‰€æœ‰ä»£ç éƒ½æ”¾åˆ°æ–‡ç¨¿é‡Œäº†ï¼Œè¯·åˆ°è¿™é‡Œçœ‹è¯¦ç»†çš„ä»£ç <br>https:&#47;&#47;github.com&#47;froghui&#47;yolanda<br>","user_name":"ä½œè€…å›å¤","user_name_real":"froghui","uid":"1618647","ctime":1570971777,"ip_address":"","comment_id":138641,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1570403249","product_id":100032701,"comment_content":"thread_array = calloc(THREAD_NUMBER, sizeof(Thread));è¿™ä¸ªThreadæ˜¯å“ªé‡Œæ¥çš„ï¼Œæ˜¯Cåº“çš„çº¿ç¨‹ç»“æ„ä½“å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1618647,"avatar":"https://static001.geekbang.org/account/avatar/00/18/b2/d7/df4086cf.jpg","nickname":"froghui","note":"","ucode":"843028B4E07F41","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469603,"discussion_content":"typedef struct {\n    pthread_t thread_tid;        /* thread ID */\n    long thread_count;    /* # connections handled */\n} Thread;\n\nå› ä¸ºç¯‡å¹…åŸå› ï¼Œä¸æ˜¯æ‰€æœ‰ä»£ç éƒ½æ”¾åˆ°æ–‡ç¨¿é‡Œäº†ï¼Œè¯·åˆ°è¿™é‡Œçœ‹è¯¦ç»†çš„ä»£ç \nhttps://github.com/froghui/yolanda\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570971777,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1177315,"avatar":"https://static001.geekbang.org/account/avatar/00/11/f6/e3/e4bcd69e.jpg","nickname":"æ²‰æ·€çš„æ¢¦æƒ³","note":"","ucode":"BCB7C26F9D214B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":25155,"discussion_content":"å¥½åƒæ˜¯è€å¸ˆä»£ç é‡Œè‡ªå·±å®šä¹‰çš„ç»“æ„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570438308,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1371633,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqyicZYyW7ahaXgXUD8ZAS8x0t8jx5rYLhwbUCJiawRepKIZfsLdkxdQ9XQMo99c1UDibmNVfFnAqwPg/132","nickname":"ç¨‹åºæ°´æœå®","note":"","ucode":"1700DDFE073A56","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1177315,"avatar":"https://static001.geekbang.org/account/avatar/00/11/f6/e3/e4bcd69e.jpg","nickname":"æ²‰æ·€çš„æ¢¦æƒ³","note":"","ucode":"BCB7C26F9D214B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":25192,"discussion_content":"æ²¡æœ‰å®šä¹‰Threadçš„ç»“æ„ä½“å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570449660,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":25155,"ip_address":""},"score":25192,"extra":""}]}]}]}