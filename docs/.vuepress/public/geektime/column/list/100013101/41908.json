{"id":41908,"title":"29 | åŸå­æ“ä½œï¼ˆä¸Šï¼‰","content":"<p>æˆ‘ä»¬åœ¨å‰ä¸¤ç¯‡æ–‡ç« ä¸­è®¨è®ºäº†äº’æ–¥é”ã€è¯»å†™é”ä»¥åŠåŸºäºå®ƒä»¬çš„æ¡ä»¶å˜é‡ï¼Œå…ˆæ¥æ€»ç»“ä¸€ä¸‹ã€‚</p><p>äº’æ–¥é”æ˜¯ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„åŒæ­¥å·¥å…·ï¼Œå®ƒå¯ä»¥ä¿è¯æ¯ä¸€æ—¶åˆ»è¿›å…¥ä¸´ç•ŒåŒºçš„goroutineåªæœ‰ä¸€ä¸ªã€‚è¯»å†™é”å¯¹å…±äº«èµ„æºçš„å†™æ“ä½œå’Œè¯»æ“ä½œåˆ™åŒºåˆ«çœ‹å¾…ï¼Œå¹¶æ¶ˆé™¤äº†è¯»æ“ä½œä¹‹é—´çš„äº’æ–¥ã€‚</p><p>æ¡ä»¶å˜é‡ä¸»è¦æ˜¯ç”¨äºåè°ƒæƒ³è¦è®¿é—®å…±äº«èµ„æºçš„é‚£äº›çº¿ç¨‹ã€‚å½“å…±äº«èµ„æºçš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒå¯ä»¥è¢«ç”¨æ¥é€šçŸ¥è¢«äº’æ–¥é”é˜»å¡çš„çº¿ç¨‹ï¼Œå®ƒæ—¢å¯ä»¥åŸºäºäº’æ–¥é”ï¼Œä¹Ÿå¯ä»¥åŸºäºè¯»å†™é”ã€‚å½“ç„¶äº†ï¼Œè¯»å†™é”ä¹Ÿæ˜¯ä¸€ç§äº’æ–¥é”ï¼Œå‰è€…æ˜¯å¯¹åè€…çš„æ‰©å±•ã€‚</p><p>é€šè¿‡å¯¹äº’æ–¥é”çš„åˆç†ä½¿ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ä¸€ä¸ªgoroutineåœ¨æ‰§è¡Œä¸´ç•ŒåŒºä¸­çš„ä»£ç æ—¶ï¼Œä¸è¢«å…¶ä»–çš„goroutineæ‰“æ‰°ã€‚ä¸è¿‡ï¼Œè™½ç„¶ä¸ä¼šè¢«æ‰“æ‰°ï¼Œä½†æ˜¯å®ƒä»ç„¶å¯èƒ½ä¼šè¢«ä¸­æ–­ï¼ˆinterruptionï¼‰ã€‚</p><h2>å‰å¯¼å†…å®¹ï¼šåŸå­æ€§æ‰§è¡Œä¸åŸå­æ“ä½œ</h2><p>æˆ‘ä»¬å·²ç»çŸ¥é“ï¼Œå¯¹äºä¸€ä¸ªGoç¨‹åºæ¥è¯´ï¼ŒGoè¯­è¨€è¿è¡Œæ—¶ç³»ç»Ÿä¸­çš„è°ƒåº¦å™¨ä¼šæ°å½“åœ°å®‰æ’å…¶ä¸­æ‰€æœ‰çš„goroutineçš„è¿è¡Œã€‚ä¸è¿‡ï¼Œåœ¨åŒä¸€æ—¶åˆ»ï¼Œåªå¯èƒ½æœ‰å°‘æ•°çš„goroutineçœŸæ­£åœ°å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œå¹¶ä¸”è¿™ä¸ªæ•°é‡åªä¼šä¸Mçš„æ•°é‡ä¸€è‡´ï¼Œè€Œä¸ä¼šéšç€Gçš„å¢å¤šè€Œå¢é•¿ã€‚</p><p>æ‰€ä»¥ï¼Œä¸ºäº†å…¬å¹³èµ·è§ï¼Œè°ƒåº¦å™¨æ€»æ˜¯ä¼šé¢‘ç¹åœ°æ¢ä¸Šæˆ–æ¢ä¸‹è¿™äº›goroutineã€‚<strong>æ¢ä¸Š</strong>çš„æ„æ€æ˜¯ï¼Œè®©ä¸€ä¸ªgoroutineç”±éè¿è¡ŒçŠ¶æ€è½¬ä¸ºè¿è¡ŒçŠ¶æ€ï¼Œå¹¶ä¿ƒä½¿å…¶ä¸­çš„ä»£ç åœ¨æŸä¸ªCPUæ ¸å¿ƒä¸Šæ‰§è¡Œã€‚</p><!-- [[[read_end]]] --><p><strong>æ¢ä¸‹</strong>çš„æ„æ€æ­£å¥½ç›¸åï¼Œå³ï¼šä½¿ä¸€ä¸ªgoroutineä¸­çš„ä»£ç ä¸­æ–­æ‰§è¡Œï¼Œå¹¶è®©å®ƒç”±è¿è¡ŒçŠ¶æ€è½¬ä¸ºéè¿è¡ŒçŠ¶æ€ã€‚</p><p>è¿™ä¸ªä¸­æ–­çš„æ—¶æœºæœ‰å¾ˆå¤šï¼Œä»»ä½•ä¸¤æ¡è¯­å¥æ‰§è¡Œçš„é—´éš™ï¼Œç”šè‡³åœ¨æŸæ¡è¯­å¥æ‰§è¡Œçš„è¿‡ç¨‹ä¸­éƒ½æ˜¯å¯ä»¥çš„ã€‚</p><p>å³ä½¿è¿™äº›è¯­å¥åœ¨ä¸´ç•ŒåŒºä¹‹å†…ä¹Ÿæ˜¯å¦‚æ­¤ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¯´ï¼Œäº’æ–¥é”è™½ç„¶å¯ä»¥ä¿è¯ä¸´ç•ŒåŒºä¸­ä»£ç çš„ä¸²è¡Œæ‰§è¡Œï¼Œä½†å´ä¸èƒ½ä¿è¯è¿™äº›ä»£ç æ‰§è¡Œçš„åŸå­æ€§ï¼ˆatomicityï¼‰ã€‚</p><p>åœ¨ä¼—å¤šçš„åŒæ­¥å·¥å…·ä¸­ï¼ŒçœŸæ­£èƒ½å¤Ÿä¿è¯åŸå­æ€§æ‰§è¡Œçš„åªæœ‰<a href=\"https://baike.baidu.com/item/%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C/1880992?fr=aladdin\">åŸå­æ“ä½œ</a>ï¼ˆatomic operationï¼‰ã€‚åŸå­æ“ä½œåœ¨è¿›è¡Œçš„è¿‡ç¨‹ä¸­æ˜¯ä¸å…è®¸ä¸­æ–­çš„ã€‚åœ¨åº•å±‚ï¼Œè¿™ä¼šç”±CPUæä¾›èŠ¯ç‰‡çº§åˆ«çš„æ”¯æŒï¼Œæ‰€ä»¥ç»å¯¹æœ‰æ•ˆã€‚å³ä½¿åœ¨æ‹¥æœ‰å¤šCPUæ ¸å¿ƒï¼Œæˆ–è€…å¤šCPUçš„è®¡ç®—æœºç³»ç»Ÿä¸­ï¼ŒåŸå­æ“ä½œçš„ä¿è¯ä¹Ÿæ˜¯ä¸å¯æ’¼åŠ¨çš„ã€‚</p><p>è¿™ä½¿å¾—åŸå­æ“ä½œå¯ä»¥å®Œå…¨åœ°æ¶ˆé™¤ç«æ€æ¡ä»¶ï¼Œå¹¶èƒ½å¤Ÿç»å¯¹åœ°ä¿è¯å¹¶å‘å®‰å…¨æ€§ã€‚å¹¶ä¸”ï¼Œå®ƒçš„æ‰§è¡Œé€Ÿåº¦è¦æ¯”å…¶ä»–çš„åŒæ­¥å·¥å…·å¿«å¾—å¤šï¼Œé€šå¸¸ä¼šé«˜å‡ºå¥½å‡ ä¸ªæ•°é‡çº§ã€‚ä¸è¿‡ï¼Œå®ƒçš„ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ã€‚</p><p><strong>æ›´å…·ä½“åœ°è¯´ï¼Œæ­£æ˜¯å› ä¸ºåŸå­æ“ä½œä¸èƒ½è¢«ä¸­æ–­ï¼Œæ‰€ä»¥å®ƒéœ€è¦è¶³å¤Ÿç®€å•ï¼Œå¹¶ä¸”è¦æ±‚å¿«é€Ÿã€‚</strong></p><p>ä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœåŸå­æ“ä½œè¿Ÿè¿Ÿä¸èƒ½å®Œæˆï¼Œè€Œå®ƒåˆä¸ä¼šè¢«ä¸­æ–­ï¼Œé‚£ä¹ˆå°†ä¼šç»™è®¡ç®—æœºæ‰§è¡ŒæŒ‡ä»¤çš„æ•ˆç‡å¸¦æ¥å¤šä¹ˆå¤§çš„å½±å“ã€‚å› æ­¤ï¼Œæ“ä½œç³»ç»Ÿå±‚é¢åªå¯¹é’ˆå¯¹äºŒè¿›åˆ¶ä½æˆ–æ•´æ•°çš„åŸå­æ“ä½œæä¾›äº†æ”¯æŒã€‚</p><p>Goè¯­è¨€çš„åŸå­æ“ä½œå½“ç„¶æ˜¯åŸºäºCPUå’Œæ“ä½œç³»ç»Ÿçš„ï¼Œæ‰€ä»¥å®ƒä¹Ÿåªé’ˆå¯¹å°‘æ•°æ•°æ®ç±»å‹çš„å€¼æä¾›äº†åŸå­æ“ä½œå‡½æ•°ã€‚è¿™äº›å‡½æ•°éƒ½å­˜åœ¨äºæ ‡å‡†åº“ä»£ç åŒ…<code>sync/atomic</code>ä¸­ã€‚</p><p>æˆ‘ä¸€èˆ¬ä¼šé€šè¿‡ä¸‹é¢è¿™é“é¢˜åˆæ¢ä¸€ä¸‹åº”è˜è€…å¯¹<code>sync/atomic</code>åŒ…çš„ç†Ÿæ‚‰ç¨‹åº¦ã€‚</p><p><strong>æˆ‘ä»¬ä»Šå¤©çš„é—®é¢˜æ˜¯ï¼š<code>sync/atomic</code>åŒ…ä¸­æä¾›äº†å‡ ç§åŸå­æ“ä½œï¼Ÿå¯æ“ä½œçš„æ•°æ®ç±»å‹åˆæœ‰å“ªäº›ï¼Ÿ</strong></p><p><strong>è¿™é‡Œçš„å…¸å‹å›ç­”æ˜¯ï¼š</strong></p><p><code>sync/atomic</code>åŒ…ä¸­çš„å‡½æ•°å¯ä»¥åšçš„åŸå­æ“ä½œæœ‰ï¼šåŠ æ³•ï¼ˆaddï¼‰ã€æ¯”è¾ƒå¹¶äº¤æ¢ï¼ˆcompare and swapï¼Œç®€ç§°CASï¼‰ã€åŠ è½½ï¼ˆloadï¼‰ã€å­˜å‚¨ï¼ˆstoreï¼‰å’Œäº¤æ¢ï¼ˆswapï¼‰ã€‚</p><p>è¿™äº›å‡½æ•°é’ˆå¯¹çš„æ•°æ®ç±»å‹å¹¶ä¸å¤šã€‚ä½†æ˜¯ï¼Œå¯¹è¿™äº›ç±»å‹ä¸­çš„æ¯ä¸€ä¸ªï¼Œ<code>sync/atomic</code>åŒ…éƒ½ä¼šæœ‰ä¸€å¥—å‡½æ•°ç»™äºˆæ”¯æŒã€‚è¿™äº›æ•°æ®ç±»å‹æœ‰ï¼š<code>int32</code>ã€<code>int64</code>ã€<code>uint32</code>ã€<code>uint64</code>ã€<code>uintptr</code>ï¼Œä»¥åŠ<code>unsafe</code>åŒ…ä¸­çš„<code>Pointer</code>ã€‚ä¸è¿‡ï¼Œé’ˆå¯¹<code>unsafe.Pointer</code>ç±»å‹ï¼Œè¯¥åŒ…å¹¶æœªæä¾›è¿›è¡ŒåŸå­åŠ æ³•æ“ä½œçš„å‡½æ•°ã€‚</p><p>æ­¤å¤–ï¼Œ<code>sync/atomic</code>åŒ…è¿˜æä¾›äº†ä¸€ä¸ªåä¸º<code>Value</code>çš„ç±»å‹ï¼Œå®ƒå¯ä»¥è¢«ç”¨æ¥å­˜å‚¨ä»»æ„ç±»å‹çš„å€¼ã€‚</p><h2>é—®é¢˜è§£æ</h2><p>è¿™ä¸ªé—®é¢˜å¾ˆç®€å•ï¼Œå› ä¸ºç­”æ¡ˆæ˜¯æ˜æ‘†åœ¨ä»£ç åŒ…æ–‡æ¡£é‡Œçš„ã€‚ä¸è¿‡å¦‚æœä½ è¿æ–‡æ¡£éƒ½æ²¡çœ‹è¿‡ï¼Œé‚£ä¹Ÿå¯èƒ½å›ç­”ä¸ä¸Šæ¥ï¼Œè‡³å°‘æ˜¯æ— æ³•åšå‡ºå…¨é¢çš„å›ç­”ã€‚</p><p>æˆ‘ä¸€èˆ¬ä¼šé€šè¿‡æ­¤é—®é¢˜å†è¡ç”Ÿå‡ºæ¥å‡ é“é¢˜ã€‚ä¸‹é¢æˆ‘å°±æ¥é€ä¸ªè¯´æ˜ä¸€ä¸‹ã€‚</p><p><strong>ç¬¬ä¸€ä¸ªè¡ç”Ÿé—®é¢˜</strong> ï¼šæˆ‘ä»¬éƒ½çŸ¥é“ï¼Œä¼ å…¥è¿™äº›åŸå­æ“ä½œå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å€¼å¯¹åº”çš„éƒ½åº”è¯¥æ˜¯é‚£ä¸ªè¢«æ“ä½œçš„å€¼ã€‚æ¯”å¦‚ï¼Œ<code>atomic.AddInt32</code>å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå¯¹åº”çš„ä¸€å®šæ˜¯é‚£ä¸ªè¦è¢«å¢å¤§çš„æ•´æ•°ã€‚å¯æ˜¯ï¼Œè¿™ä¸ªå‚æ•°çš„ç±»å‹ä¸ºä»€ä¹ˆä¸æ˜¯<code>int32</code>è€Œæ˜¯<code>*int32</code>å‘¢ï¼Ÿ</p><p>å›ç­”æ˜¯ï¼šå› ä¸ºåŸå­æ“ä½œå‡½æ•°éœ€è¦çš„æ˜¯è¢«æ“ä½œå€¼çš„æŒ‡é’ˆï¼Œè€Œä¸æ˜¯è¿™ä¸ªå€¼æœ¬èº«ï¼›è¢«ä¼ å…¥å‡½æ•°çš„å‚æ•°å€¼éƒ½ä¼šè¢«å¤åˆ¶ï¼Œåƒè¿™ç§åŸºæœ¬ç±»å‹çš„å€¼ä¸€æ—¦è¢«ä¼ å…¥å‡½æ•°ï¼Œå°±å·²ç»ä¸å‡½æ•°å¤–çš„é‚£ä¸ªå€¼æ¯«æ— å…³ç³»äº†ã€‚</p><p>æ‰€ä»¥ï¼Œä¼ å…¥å€¼æœ¬èº«æ²¡æœ‰ä»»ä½•æ„ä¹‰ã€‚<code>unsafe.Pointer</code>ç±»å‹è™½ç„¶æ˜¯æŒ‡é’ˆç±»å‹ï¼Œä½†æ˜¯é‚£äº›åŸå­æ“ä½œå‡½æ•°è¦æ“ä½œçš„æ˜¯è¿™ä¸ªæŒ‡é’ˆå€¼ï¼Œè€Œä¸æ˜¯å®ƒæŒ‡å‘çš„é‚£ä¸ªå€¼ï¼Œæ‰€ä»¥éœ€è¦çš„ä»ç„¶æ˜¯æŒ‡å‘è¿™ä¸ªæŒ‡é’ˆå€¼çš„æŒ‡é’ˆã€‚</p><p>åªè¦åŸå­æ“ä½œå‡½æ•°æ‹¿åˆ°äº†è¢«æ“ä½œå€¼çš„æŒ‡é’ˆï¼Œå°±å¯ä»¥å®šä½åˆ°å­˜å‚¨è¯¥å€¼çš„å†…å­˜åœ°å€ã€‚åªæœ‰è¿™æ ·ï¼Œå®ƒä»¬æ‰èƒ½å¤Ÿé€šè¿‡åº•å±‚çš„æŒ‡ä»¤ï¼Œå‡†ç¡®åœ°æ“ä½œè¿™ä¸ªå†…å­˜åœ°å€ä¸Šçš„æ•°æ®ã€‚</p><p><strong>ç¬¬äºŒä¸ªè¡ç”Ÿé—®é¢˜ï¼š</strong> ç”¨äºåŸå­åŠ æ³•æ“ä½œçš„å‡½æ•°å¯ä»¥åšåŸå­å‡æ³•å—ï¼Ÿæ¯”å¦‚ï¼Œ<code>atomic.AddInt32</code>å‡½æ•°å¯ä»¥ç”¨äºå‡å°é‚£ä¸ªè¢«æ“ä½œçš„æ•´æ•°å€¼å—ï¼Ÿ</p><p>å›ç­”æ˜¯ï¼šå½“ç„¶æ˜¯å¯ä»¥çš„ã€‚<code>atomic.AddInt32</code>å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°ä»£è¡¨å·®é‡ï¼Œå®ƒçš„ç±»å‹æ˜¯<code>int32</code>ï¼Œæ˜¯æœ‰ç¬¦å·çš„ã€‚å¦‚æœæˆ‘ä»¬æƒ³åšåŸå­å‡æ³•ï¼Œé‚£ä¹ˆæŠŠè¿™ä¸ªå·®é‡è®¾ç½®ä¸ºè´Ÿæ•´æ•°å°±å¯ä»¥äº†ã€‚</p><p>å¯¹äº<code>atomic.AddInt64</code>å‡½æ•°æ¥è¯´ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚ä¸è¿‡ï¼Œè¦æƒ³ç”¨<code>atomic.AddUint32</code>å’Œ<code>atomic.AddUint64</code>å‡½æ•°åšåŸå­å‡æ³•ï¼Œå°±ä¸èƒ½è¿™ä¹ˆç›´æ¥äº†ï¼Œå› ä¸ºå®ƒä»¬çš„ç¬¬äºŒä¸ªå‚æ•°çš„ç±»å‹åˆ†åˆ«æ˜¯<code>uint32</code>å’Œ<code>uint64</code>ï¼Œéƒ½æ˜¯æ— ç¬¦å·çš„ï¼Œä¸è¿‡ï¼Œè¿™ä¹Ÿæ˜¯å¯ä»¥åšåˆ°çš„ï¼Œå°±æ˜¯ç¨å¾®éº»çƒ¦ä¸€äº›ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœæƒ³å¯¹<code>uint32</code>ç±»å‹çš„è¢«æ“ä½œå€¼<code>18</code>åšåŸå­å‡æ³•ï¼Œæ¯”å¦‚è¯´å·®é‡æ˜¯<code>-3</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å…ˆæŠŠè¿™ä¸ªå·®é‡è½¬æ¢ä¸ºæœ‰ç¬¦å·çš„<code>int32</code>ç±»å‹çš„å€¼ï¼Œç„¶åå†æŠŠè¯¥å€¼çš„ç±»å‹è½¬æ¢ä¸º<code>uint32</code>ï¼Œç”¨è¡¨è¾¾å¼æ¥æè¿°å°±æ˜¯<code>uint32(int32(-3))</code>ã€‚</p><p>ä¸è¿‡è¦æ³¨æ„ï¼Œç›´æ¥è¿™æ ·å†™ä¼šä½¿Goè¯­è¨€çš„ç¼–è¯‘å™¨æŠ¥é”™ï¼Œå®ƒä¼šå‘Šè¯‰ä½ ï¼šâ€œå¸¸é‡<code>-3</code>ä¸åœ¨<code>uint32</code>ç±»å‹å¯è¡¨ç¤ºçš„èŒƒå›´å†…â€ï¼Œæ¢å¥è¯è¯´ï¼Œè¿™æ ·åšä¼šè®©è¡¨è¾¾å¼çš„ç»“æœå€¼æº¢å‡ºã€‚</p><p>ä¸è¿‡ï¼Œå¦‚æœæˆ‘ä»¬å…ˆæŠŠ<code>int32(-3)</code>çš„ç»“æœå€¼èµ‹ç»™å˜é‡<code>delta</code>ï¼Œå†æŠŠ<code>delta</code>çš„å€¼è½¬æ¢ä¸º<code>uint32</code>ç±»å‹çš„å€¼ï¼Œå°±å¯ä»¥ç»•è¿‡ç¼–è¯‘å™¨çš„æ£€æŸ¥å¹¶å¾—åˆ°æ­£ç¡®çš„ç»“æœäº†ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªç»“æœä½œä¸º<code>atomic.AddUint32</code>å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°å€¼ï¼Œå°±å¯ä»¥è¾¾åˆ°å¯¹<code>uint32</code>ç±»å‹çš„å€¼åšåŸå­å‡æ³•çš„ç›®çš„äº†ã€‚</p><p>è¿˜æœ‰ä¸€ç§æ›´åŠ ç›´æ¥çš„æ–¹å¼ã€‚æˆ‘ä»¬å¯ä»¥ä¾æ®ä¸‹é¢è¿™ä¸ªè¡¨è¾¾å¼æ¥ç»™å®š<code>atomic.AddUint32</code>å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°å€¼ï¼š</p><pre><code>^uint32(-N-1))\n</code></pre><p>å…¶ä¸­çš„<code>N</code>ä»£è¡¨ç”±è´Ÿæ•´æ•°è¡¨ç¤ºçš„å·®é‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å…ˆè¦æŠŠå·®é‡çš„ç»å¯¹å€¼å‡å»<code>1</code>ï¼Œç„¶åå†æŠŠå¾—åˆ°çš„è¿™ä¸ªæ— ç±»å‹çš„æ•´æ•°å¸¸é‡ï¼Œè½¬æ¢ä¸º<code>uint32</code>ç±»å‹çš„å€¼ï¼Œæœ€åï¼Œåœ¨è¿™ä¸ªå€¼ä¹‹ä¸ŠåšæŒ‰ä½å¼‚æˆ–æ“ä½œï¼Œå°±å¯ä»¥è·å¾—æœ€ç»ˆçš„å‚æ•°å€¼äº†ã€‚</p><p>è¿™ä¹ˆåšçš„åŸç†ä¹Ÿå¹¶ä¸å¤æ‚ã€‚ç®€å•æ¥è¯´ï¼Œæ­¤è¡¨è¾¾å¼çš„ç»“æœå€¼çš„è¡¥ç ï¼Œä¸ä½¿ç”¨å‰ä¸€ç§æ–¹æ³•å¾—åˆ°çš„å€¼çš„è¡¥ç ç›¸åŒï¼Œæ‰€ä»¥è¿™ä¸¤ç§æ–¹å¼æ˜¯ç­‰ä»·çš„ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ•´æ•°åœ¨è®¡ç®—æœºä¸­æ˜¯ä»¥è¡¥ç çš„å½¢å¼å­˜åœ¨çš„ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œï¼Œç»“æœå€¼çš„è¡¥ç ç›¸åŒå°±æ„å‘³ç€è¡¨è¾¾å¼çš„ç­‰ä»·ã€‚</p><h2>æ€»ç»“</h2><p>ä»Šå¤©ï¼Œæˆ‘ä»¬ä¸€èµ·å­¦ä¹ äº†<code>sync/atomic</code>ä»£ç åŒ…ä¸­æä¾›çš„åŸå­æ“ä½œå‡½æ•°å’ŒåŸå­å€¼ç±»å‹ã€‚åŸå­æ“ä½œå‡½æ•°ä½¿ç”¨èµ·æ¥éƒ½éå¸¸ç®€å•ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›ç»†èŠ‚éœ€è¦æˆ‘ä»¬æ³¨æ„ã€‚æˆ‘åœ¨ä¸»é—®é¢˜çš„è¡ç”Ÿé—®é¢˜ä¸­å¯¹å®ƒä»¬è¿›è¡Œäº†é€ä¸€è¯´æ˜ã€‚</p><p>åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¼šç»§ç»­åˆ†äº«åŸå­æ“ä½œçš„è¡ç”Ÿå†…å®¹ã€‚å¦‚æœä½ å¯¹åŸå­æ“ä½œæœ‰ä»€ä¹ˆæ ·çš„é—®é¢˜ï¼Œéƒ½å¯ä»¥ç»™æˆ‘ç•™è¨€ï¼Œæˆ‘ä»¬ä¸€èµ·è®¨è®ºï¼Œæ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œæˆ‘ä»¬ä¸‹æœŸå†è§ã€‚</p><p><a href=\"https://github.com/hyper0x/Golang_Puzzlers\">æˆ³æ­¤æŸ¥çœ‹Goè¯­è¨€ä¸“æ æ–‡ç« é…å¥—è¯¦ç»†ä»£ç ã€‚</a></p><p></p>","comments":[{"had_liked":false,"id":170526,"user_name":"hd167","can_delete":false,"product_type":"c1","uid":1314705,"ip_address":"","ucode":"8194EE699AE2A7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEIcGGiaXIFH4JP64SdOX0tO0OGgwtQMJhrsIe1ibicX1TVxCII2VALy8IwUbCaIUMnKFIXmKw6AZBHmg/132","comment_is_top":false,"comment_ctime":1578626659,"is_pvip":false,"replies":[{"id":"66104","content":"ä»»ä½•åŸå­æ“ä½œéƒ½æ˜¯çœŸå¯¹æŸä¸€ä¸ªå…±äº«èµ„æºè€Œè¨€çš„ï¼Œå³å†…å­˜ä¸­çš„åŒä¸€ä¸ªå°å—åŒºåŸŸä»¥åŠç›¸å…³çš„ç¼“å­˜ã€‚è¿™ä¸ªåŒºåŸŸè¶³å¤Ÿå°ï¼Œå› æ­¤é€šå¸¸åªç”¨ä¸€ä¸ªCPUæŒ‡ä»¤å°±å¯ä»¥å®Œæˆå¯¹å®ƒçš„è¯»æˆ–å†™ã€‚<br><br>æ‰€ä»¥ï¼Œè¿™å¹¶ä¸æ˜¯è¯´ï¼Œä¸€é‡åˆ°åŸå­æ“ä½œï¼Œæ‰€æœ‰çš„CPUæ ¸å¿ƒå°±éƒ½ä¸å·¥ä½œäº†ã€‚ä½ è¦ç†è§£â€œä¸­æ–­â€è¿™ä¸ªè¯çš„çœŸæ­£å«ä¹‰ã€‚è¿™é‡Œçš„ç»†èŠ‚è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œæ¶‰åŠåˆ°cache lineã€å¤šæ ¸CPUåè°ƒæœºåˆ¶ï¼ˆå‡ ç§æ–¹æ¡ˆï¼‰ã€LOCKåŸè¯­ï¼ˆCPUä¸åŒæ–¹æ¡ˆä¸åŒï¼‰ç­‰ç­‰ã€‚ä¸€å¥ä¸¤å¥è¯´ä¸å¤ªæ¸…æ¥šï¼Œä½ å¯ä»¥è‡ªå·±å»æ‰¾èµ„æ–™çœ‹çœ‹ã€‚<br><br>æ€»ä¹‹ï¼Œä½ å¯ä»¥ç†è§£ä¸ºï¼Œé’ˆå¯¹ä¸åŒå…±äº«èµ„æºçš„åŸå­æ“ä½œæ˜¯æœ‰å¯èƒ½å¹¶è¡Œè¿›è¡Œçš„ã€‚è€Œé’ˆå¯¹ç›¸åŒå…±äº«èµ„æºçš„åŸå­æ“ä½œï¼Œå³ä½¿å­˜åœ¨å¤šCPUæ ¸å¿ƒï¼Œå®ƒä»¬é¡µä¸å¯èƒ½å¹¶è¡Œè¿›è¡Œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1578634525,"ip_address":"","comment_id":170526,"utype":1}],"discussion_count":5,"race_medal":0,"score":"108952809059","product_id":100013101,"comment_content":" â€œåŸå­æ“ä½œåœ¨è¿›è¡Œçš„è¿‡ç¨‹ä¸­æ˜¯ä¸å…è®¸ä¸­æ–­çš„ã€‚åœ¨åº•å±‚ï¼Œè¿™ä¼šç”± CPU æä¾›èŠ¯ç‰‡çº§åˆ«çš„æ”¯æŒï¼Œæ‰€ä»¥ç»å¯¹æœ‰æ•ˆã€‚å³ä½¿åœ¨æ‹¥æœ‰å¤š CPU æ ¸å¿ƒï¼Œæˆ–è€…å¤š CPU çš„è®¡ç®—æœºç³»ç»Ÿä¸­ï¼ŒåŸå­æ“ä½œçš„ä¿è¯ä¹Ÿæ˜¯ä¸å¯æ’¼åŠ¨çš„ã€‚â€è¿™å¥è¯ä¸çŸ¥é“è¯¥æ€ä¹ˆç†è§£ï¼Ÿæ˜¯ä¸æ˜¯å¦‚æœä¸€ä¸ªåŸå­æ“ä½œåœ¨è¿›è¡Œä¸­ï¼Œè¿™å°è®¡ç®—æœºçš„å…¶ä»–cpuæ ¸å¿ƒéƒ½ä¸èƒ½è¿›è¡Œç›¸å…³æ“ä½œï¼Ÿ<br>ä¸¾ä¸ªä¾‹å­ï¼Œæœ‰ä¸¤ä¸ªInt32çš„å˜é‡aï¼Œbï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹xè¦å¯¹aåšåŸå­åŠ æ³•æ“ä½œï¼Œå¦ä¸€ä¸ªçº¿ç¨‹yæƒ³è¦å¯¹båšåŸå­äº¤æ¢æ“ä½œï¼Œå¤šæ ¸cpuçš„è¯ï¼Œçº¿ç¨‹x,yåº”è¯¥å¯ä»¥åœ¨ä¸åŒçš„ç‰©ç†æ ¸å¿ƒä¸ŠåŒæ—¶è¿›è¡Œæ“ä½œå§ï¼Ÿ<br>ä½†æ˜¯å¦‚æœåªæœ‰ä¸€ä¸ªInt32çš„å˜é‡cï¼Œçº¿ç¨‹xè¦å¯¹cåšåŸå­åŠ æ³•æ“ä½œï¼Œçº¿ç¨‹yè¦å¯¹cåšåŸå­äº¤æ¢æ“ä½œï¼Œå¤šæ ¸cpuçš„<br>è¯å¯ï¼Œçº¿ç¨‹xå’Œçº¿ç¨‹yè¿˜å¯ä»¥åœ¨ä¸åŒçš„ç‰©ç†æ ¸å¿ƒä¸ŠåŒæ—¶è¿›è¡Œå—ï¼Ÿ<br>","like_count":26,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481009,"discussion_content":"ä»»ä½•åŸå­æ“ä½œéƒ½æ˜¯çœŸå¯¹æŸä¸€ä¸ªå…±äº«èµ„æºè€Œè¨€çš„ï¼Œå³å†…å­˜ä¸­çš„åŒä¸€ä¸ªå°å—åŒºåŸŸä»¥åŠç›¸å…³çš„ç¼“å­˜ã€‚è¿™ä¸ªåŒºåŸŸè¶³å¤Ÿå°ï¼Œå› æ­¤é€šå¸¸åªç”¨ä¸€ä¸ªCPUæŒ‡ä»¤å°±å¯ä»¥å®Œæˆå¯¹å®ƒçš„è¯»æˆ–å†™ã€‚\n\næ‰€ä»¥ï¼Œè¿™å¹¶ä¸æ˜¯è¯´ï¼Œä¸€é‡åˆ°åŸå­æ“ä½œï¼Œæ‰€æœ‰çš„CPUæ ¸å¿ƒå°±éƒ½ä¸å·¥ä½œäº†ã€‚ä½ è¦ç†è§£â€œä¸­æ–­â€è¿™ä¸ªè¯çš„çœŸæ­£å«ä¹‰ã€‚è¿™é‡Œçš„ç»†èŠ‚è¿˜æ˜¯å¾ˆå¤šçš„ï¼Œæ¶‰åŠåˆ°cache lineã€å¤šæ ¸CPUåè°ƒæœºåˆ¶ï¼ˆå‡ ç§æ–¹æ¡ˆï¼‰ã€LOCKåŸè¯­ï¼ˆCPUä¸åŒæ–¹æ¡ˆä¸åŒï¼‰ç­‰ç­‰ã€‚ä¸€å¥ä¸¤å¥è¯´ä¸å¤ªæ¸…æ¥šï¼Œä½ å¯ä»¥è‡ªå·±å»æ‰¾èµ„æ–™çœ‹çœ‹ã€‚\n\næ€»ä¹‹ï¼Œä½ å¯ä»¥ç†è§£ä¸ºï¼Œé’ˆå¯¹ä¸åŒå…±äº«èµ„æºçš„åŸå­æ“ä½œæ˜¯æœ‰å¯èƒ½å¹¶è¡Œè¿›è¡Œçš„ã€‚è€Œé’ˆå¯¹ç›¸åŒå…±äº«èµ„æºçš„åŸå­æ“ä½œï¼Œå³ä½¿å­˜åœ¨å¤šCPUæ ¸å¿ƒï¼Œå®ƒä»¬é¡µä¸å¯èƒ½å¹¶è¡Œè¿›è¡Œã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1578634525,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1676246,"avatar":"https://static001.geekbang.org/account/avatar/00/19/93/d6/040e4965.jpg","nickname":"Omer","note":"","ucode":"8EE3E531313265","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":245767,"discussion_content":"è€å¸ˆ,é‚£ä½ è¿™ä¹ˆè¯´çš„è¯å¯ä»¥ç†è§£æˆåŸå­æ“ä½œä¹Ÿæœ‰äº’æ–¥é”è¿™æ¦‚å¿µä¸€è¯´?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587698347,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1557834,"avatar":"https://static001.geekbang.org/account/avatar/00/17/c5/4a/340bda41.jpg","nickname":"æ°´é˜¡å¢¨","note":"","ucode":"87C949F0E295A9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1676246,"avatar":"https://static001.geekbang.org/account/avatar/00/19/93/d6/040e4965.jpg","nickname":"Omer","note":"","ucode":"8EE3E531313265","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":345999,"discussion_content":"ä¸èƒ½å¹¶è¡Œä¸èƒ½ç­‰åŒäºäº’æ–¥é”å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611835304,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":245767,"ip_address":""},"score":345999,"extra":""},{"author":{"id":2300180,"avatar":"https://static001.geekbang.org/account/avatar/00/23/19/14/4fe2f992.jpg","nickname":"å´ç¬›","note":"","ucode":"5C1262FCC3814B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1676246,"avatar":"https://static001.geekbang.org/account/avatar/00/19/93/d6/040e4965.jpg","nickname":"Omer","note":"","ucode":"8EE3E531313265","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":362943,"discussion_content":"è¿™ä¹ˆç†è§£æ²¡é—®é¢˜ æ›´å‡†ç¡®ç‚¹æ˜¯åˆ†å¸ƒå¼é”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617077719,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":245767,"ip_address":""},"score":362943,"extra":""}]},{"author":{"id":1314705,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEIcGGiaXIFH4JP64SdOX0tO0OGgwtQMJhrsIe1ibicX1TVxCII2VALy8IwUbCaIUMnKFIXmKw6AZBHmg/132","nickname":"hd167","note":"","ucode":"8194EE699AE2A7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":132093,"discussion_content":"getï¼Œè°¢è°¢è€å¸ˆï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578881677,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":222474,"user_name":"poettian","can_delete":false,"product_type":"c1","uid":1144021,"ip_address":"","ucode":"26EE408F908D12","user_header":"https://static001.geekbang.org/account/avatar/00/11/74/d5/de9641dc.jpg","comment_is_top":false,"comment_ctime":1590814704,"is_pvip":false,"replies":[{"id":"82201","content":"CASæœ¬èº«åŒ…å«ä¸¤ä¸ªåŠ¨ä½œï¼šæ¯”è¾ƒå’Œäº¤æ¢ã€‚å¦‚æœå˜é‡çš„å€¼ä¸æˆ‘ä»¬æœŸæœ›çš„å€¼ç›¸ç­‰ï¼Œé‚£ä¹ˆå°±ç”¨æ–°çš„å€¼æ›¿æ¢ï¼Œå¦åˆ™å°±ä¸æ¢ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šä¿è¯åŸå­æ€§ã€‚è¿™ä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªåŒ…å«å¤šä¸ªæ­¥éª¤çš„åŸå­æ€§æ“ä½œã€‚<br><br>å³ä½¿åƒ a = 1 è¿™ç§ç®€å•çš„èµ‹å€¼æ“ä½œä¹Ÿå¹¶ä¸ä¸€å®šèƒ½å¤Ÿä¸€æ¬¡å®Œæˆã€‚å¦‚æœå³è¾¹çš„å€¼çš„å­˜å‚¨å®½åº¦è¶…å‡ºäº†è®¡ç®—æœºçš„å­—å®½ï¼Œé‚£ä¹ˆå®é™…çš„æ­¥éª¤å°±ä¼šå¤šäºä¸€ä¸ªï¼ˆæˆ–è€…è¯´åº•å±‚æŒ‡ä»¤å¤šäºä¸€ä¸ªï¼‰ã€‚æ¯”å¦‚ï¼Œä½ è®¡ç®—æœºæ˜¯32ä½çš„ï¼Œä½†æ˜¯ä½ è¦æŠŠä¸€ä¸ªInt64ç±»å‹çš„æ•°èµ‹ç»™å˜é‡aï¼Œé‚£ä¹ˆåº•å±‚æŒ‡ä»¤å°±è‚¯å®šå¤šäºä¸€ä¸ªã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¤šä¸ªåº•å±‚æŒ‡ä»¤çš„æ‰§è¡ŒæœŸé—´æ˜¯å¯ä»¥è¢«æ‰“æ–­çš„ï¼Œä¹Ÿå°±æ˜¯è¯´CPUåœ¨è¿™æ—¶å¯ä»¥è¢«åˆ‡æ¢åˆ°åˆ«çš„ä»»åŠ¡ä¸Šã€‚å¦‚æœæ–°ä»»åŠ¡æ°å·§è¦è¯»å†™è¿™ä¸ªå˜é‡aï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°å€¼ä¸å®Œæ•´çš„é—®é¢˜ã€‚å†µä¸”ï¼Œå°±ç®—æ˜¯ a = 1ï¼Œæ“ä½œç³»ç»Ÿå’ŒCPUä¹Ÿéƒ½ä¸ä¿è¯è¿™ä¸ªæ“ä½œä¸€å®šä¸ä¼šè¢«æ‰“æ–­ã€‚åªè¦è¢«æ‰“æ–­ï¼Œå°±å¾ˆæœ‰å¯èƒ½å‡ºç°å¹¶å‘è®¿é—®ä¸Šçš„é—®é¢˜ï¼Œå¹¶å‘å®‰å…¨æ€§ä¹Ÿå°±è¢«ç ´åäº†ã€‚<br><br>æ‰€ä»¥è¯´ï¼Œå½“æœ‰å¤šä¸ªgoroutineåœ¨å¹¶å‘çš„è¯»å†™è¿™ä¸ªå˜é‡çš„æ—¶å€™ï¼Œå®ƒä»¬ä¹‹é—´å°±å¯èƒ½ä¼šé€ æˆå¹²æ‰°ã€‚æ€»ä¹‹ï¼Œè¿™ç§æ“ä½œä¸æ˜¯åŸå­æ€§ï¼Œå¹¶å‘å®‰å…¨æ€§ä¹Ÿæ— æ³•å¾—åˆ°ä¿éšœã€‚<br><br>atomicåŒ…ä¸‹çš„å‡½æ•°ä¼šå€ŸåŠ©æ“ä½œç³»ç»Ÿçº§åˆ«çš„åŸå­æŒ‡ä»¤ä¿éšœæ“ä½œçš„åŸå­æ€§ï¼Œå³ä½¿è®¡ç®—æœºçš„CPUæœ‰å¤šä¸ªæ ¸å¿ƒæˆ–è€…æœ‰å¤šä¸ªCPUï¼Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1590981904,"ip_address":"","comment_id":222474,"utype":1}],"discussion_count":2,"race_medal":0,"score":"83195193328","product_id":100013101,"comment_content":"çœ‹åˆ°è¿™é‡Œæœ‰ç‚¹ä¸ç†è§£ï¼ŒCAS æ˜¯ä¸¤ä¸ªæ­¥éª¤ï¼šæ¯”è¾ƒå’Œäº¤æ¢ï¼Œå¯ä»¥ä½¿å…¶æˆä¸ºä¸€ä¸ªåŸå­æ“ä½œã€‚é‚£åƒ loadã€store è¿™äº›éƒ½æ˜¯å•æ¬¡æ“ä½œå‘€ï¼Œæ¯”å¦‚ï¼ša = 1ï¼Œè¿™ç§æ“ä½œæœ¬èº«ä¸æ˜¯åŸå­æ€§çš„å—ï¼Ÿè¿™ç§èµ‹å€¼ å’Œ atomic.Load* æ–¹æ³•æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ","like_count":20,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496813,"discussion_content":"CASæœ¬èº«åŒ…å«ä¸¤ä¸ªåŠ¨ä½œï¼šæ¯”è¾ƒå’Œäº¤æ¢ã€‚å¦‚æœå˜é‡çš„å€¼ä¸æˆ‘ä»¬æœŸæœ›çš„å€¼ç›¸ç­‰ï¼Œé‚£ä¹ˆå°±ç”¨æ–°çš„å€¼æ›¿æ¢ï¼Œå¦åˆ™å°±ä¸æ¢ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šä¿è¯åŸå­æ€§ã€‚è¿™ä¹Ÿæ˜¯å”¯ä¸€ä¸€ä¸ªåŒ…å«å¤šä¸ªæ­¥éª¤çš„åŸå­æ€§æ“ä½œã€‚\n\nå³ä½¿åƒ a = 1 è¿™ç§ç®€å•çš„èµ‹å€¼æ“ä½œä¹Ÿå¹¶ä¸ä¸€å®šèƒ½å¤Ÿä¸€æ¬¡å®Œæˆã€‚å¦‚æœå³è¾¹çš„å€¼çš„å­˜å‚¨å®½åº¦è¶…å‡ºäº†è®¡ç®—æœºçš„å­—å®½ï¼Œé‚£ä¹ˆå®é™…çš„æ­¥éª¤å°±ä¼šå¤šäºä¸€ä¸ªï¼ˆæˆ–è€…è¯´åº•å±‚æŒ‡ä»¤å¤šäºä¸€ä¸ªï¼‰ã€‚æ¯”å¦‚ï¼Œä½ è®¡ç®—æœºæ˜¯32ä½çš„ï¼Œä½†æ˜¯ä½ è¦æŠŠä¸€ä¸ªInt64ç±»å‹çš„æ•°èµ‹ç»™å˜é‡aï¼Œé‚£ä¹ˆåº•å±‚æŒ‡ä»¤å°±è‚¯å®šå¤šäºä¸€ä¸ªã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¤šä¸ªåº•å±‚æŒ‡ä»¤çš„æ‰§è¡ŒæœŸé—´æ˜¯å¯ä»¥è¢«æ‰“æ–­çš„ï¼Œä¹Ÿå°±æ˜¯è¯´CPUåœ¨è¿™æ—¶å¯ä»¥è¢«åˆ‡æ¢åˆ°åˆ«çš„ä»»åŠ¡ä¸Šã€‚å¦‚æœæ–°ä»»åŠ¡æ°å·§è¦è¯»å†™è¿™ä¸ªå˜é‡aï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°å€¼ä¸å®Œæ•´çš„é—®é¢˜ã€‚å†µä¸”ï¼Œå°±ç®—æ˜¯ a = 1ï¼Œæ“ä½œç³»ç»Ÿå’ŒCPUä¹Ÿéƒ½ä¸ä¿è¯è¿™ä¸ªæ“ä½œä¸€å®šä¸ä¼šè¢«æ‰“æ–­ã€‚åªè¦è¢«æ‰“æ–­ï¼Œå°±å¾ˆæœ‰å¯èƒ½å‡ºç°å¹¶å‘è®¿é—®ä¸Šçš„é—®é¢˜ï¼Œå¹¶å‘å®‰å…¨æ€§ä¹Ÿå°±è¢«ç ´åäº†ã€‚\n\næ‰€ä»¥è¯´ï¼Œå½“æœ‰å¤šä¸ªgoroutineåœ¨å¹¶å‘çš„è¯»å†™è¿™ä¸ªå˜é‡çš„æ—¶å€™ï¼Œå®ƒä»¬ä¹‹é—´å°±å¯èƒ½ä¼šé€ æˆå¹²æ‰°ã€‚æ€»ä¹‹ï¼Œè¿™ç§æ“ä½œä¸æ˜¯åŸå­æ€§ï¼Œå¹¶å‘å®‰å…¨æ€§ä¹Ÿæ— æ³•å¾—åˆ°ä¿éšœã€‚\n\natomicåŒ…ä¸‹çš„å‡½æ•°ä¼šå€ŸåŠ©æ“ä½œç³»ç»Ÿçº§åˆ«çš„åŸå­æŒ‡ä»¤ä¿éšœæ“ä½œçš„åŸå­æ€§ï¼Œå³ä½¿è®¡ç®—æœºçš„CPUæœ‰å¤šä¸ªæ ¸å¿ƒæˆ–è€…æœ‰å¤šä¸ªCPUï¼Œä¹Ÿæ˜¯å¦‚æ­¤ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1590981904,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005391,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","nickname":"ä¸€æ­¥","note":"","ucode":"73CEA468CE70C3","race_medal":1,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540491,"discussion_content":"å¯¹åº”çš„æœºå™¨æŒ‡ä»¤ å¯èƒ½ä¸æ˜¯ä¸€æ¡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640068437,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":241141,"user_name":"ArtistLu","can_delete":false,"product_type":"c1","uid":1166373,"ip_address":"","ucode":"2E641A3EB4F9AC","user_header":"https://static001.geekbang.org/account/avatar/00/11/cc/25/8c6eab2c.jpg","comment_is_top":false,"comment_ctime":1597200430,"is_pvip":true,"replies":[{"id":"89169","content":"åŸæ–‡æ˜¯å¯¹çš„ï¼Œåªä¸è¿‡æœ‰ä¸€æ®µéšå«çš„è¯æ²¡æœ‰å†™ä¸Šã€‚å¦‚ä¸‹ã€‚<br><br>å¦‚æœä¸ä¸€å…ƒæ“ä½œ ^ è”ç»“çš„å”¯ä¸€æ“ä½œæ•°çš„ç±»å‹æ˜¯æ— ç¬¦å·çš„æ•´æ•°ç±»å‹ï¼Œé‚£ä¹ˆè¿™ä¸€æ“ä½œå°±ç›¸å½“äºå¯¹è¿™ä¸ªæ“ä½œæ•°å’Œå…¶æ•´æ•°ç±»å‹çš„æœ€å¤§å€¼è¿›è¡ŒäºŒå…ƒçš„æŒ‰ä½å¼‚æˆ–æ“ä½œã€‚ä¾‹å¦‚ï¼š<br><br>^uint8(1) = 254<br>00000001 ^ 11111111 = 11111110","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1597306278,"ip_address":"","comment_id":241141,"utype":1}],"discussion_count":1,"race_medal":0,"score":"57431775278","product_id":100013101,"comment_content":"è€å¸ˆ â€œè½¬æ¢ä¸ºuint32ç±»å‹çš„å€¼ï¼Œæœ€åï¼Œåœ¨è¿™ä¸ªå€¼ä¹‹ä¸ŠåšæŒ‰ä½å¼‚æˆ–æ“ä½œâ€ æ–‡ä¸­é¢˜çš„å¼‚æˆ–å¯¹å—ï¼Ÿæˆ‘æŸ¥äº†ä¸‹goé‡Œé¢^ä¸€ä¸ªæ“ä½œæ•°è¡¨ç¤ºå–åã€‚","like_count":14,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503657,"discussion_content":"åŸæ–‡æ˜¯å¯¹çš„ï¼Œåªä¸è¿‡æœ‰ä¸€æ®µéšå«çš„è¯æ²¡æœ‰å†™ä¸Šã€‚å¦‚ä¸‹ã€‚\n\nå¦‚æœä¸ä¸€å…ƒæ“ä½œ ^ è”ç»“çš„å”¯ä¸€æ“ä½œæ•°çš„ç±»å‹æ˜¯æ— ç¬¦å·çš„æ•´æ•°ç±»å‹ï¼Œé‚£ä¹ˆè¿™ä¸€æ“ä½œå°±ç›¸å½“äºå¯¹è¿™ä¸ªæ“ä½œæ•°å’Œå…¶æ•´æ•°ç±»å‹çš„æœ€å¤§å€¼è¿›è¡ŒäºŒå…ƒçš„æŒ‰ä½å¼‚æˆ–æ“ä½œã€‚ä¾‹å¦‚ï¼š\n\n^uint8(1) = 254\n00000001 ^ 11111111 = 11111110","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597306278,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136135,"user_name":"Richard","can_delete":false,"product_type":"c1","uid":1316758,"ip_address":"","ucode":"893F958B9DD161","user_header":"https://static001.geekbang.org/account/avatar/00/14/17/96/846fc11b.jpg","comment_is_top":false,"comment_ctime":1569371807,"is_pvip":false,"replies":[{"id":"52155","content":"ä¸ä¸€å®šï¼ŒP æŠŠ G äº¤ç»™ M å°±ä¸ç®¡äº†ï¼Œè°ƒåº¦å™¨å‘ç°è¿˜æœ‰ M é—²ç€å°±ä¼šç»§ç»­ä»é‚£äº› P é‚£è¾¹æ‹¿ Gã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1569382094,"ip_address":"","comment_id":136135,"utype":1}],"discussion_count":1,"race_medal":0,"score":"44519044767","product_id":100013101,"comment_content":"&quot;ä¸è¿‡ï¼Œåœ¨åŒä¸€æ—¶åˆ»ï¼Œåªå¯èƒ½æœ‰å°‘æ•°çš„ goroutine çœŸæ­£åœ°å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œå¹¶ä¸”è¿™ä¸ªæ•°é‡åªä¼šä¸ M çš„æ•°é‡ä¸€è‡´ï¼Œè€Œä¸ä¼šéšç€ G çš„å¢å¤šè€Œå¢é•¿ã€‚&quot; ä¸ªäººæ„Ÿè§‰åŒæ—¶è¿è¡Œçš„gåº”è¯¥æ˜¯å’Œpæ•°é‡ç›¸ç­‰","like_count":10,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":468474,"discussion_content":"ä¸ä¸€å®šï¼ŒP æŠŠ G äº¤ç»™ M å°±ä¸ç®¡äº†ï¼Œè°ƒåº¦å™¨å‘ç°è¿˜æœ‰ M é—²ç€å°±ä¼šç»§ç»­ä»é‚£äº› P é‚£è¾¹æ‹¿ Gã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569382094,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":291812,"user_name":"æˆäººä»¥ğŸŸï¼Œä¸å¦‚æˆäººä»¥æ¸”","can_delete":false,"product_type":"c1","uid":1193874,"ip_address":"","ucode":"BD53829E924B66","user_header":"https://static001.geekbang.org/account/avatar/00/12/37/92/961ba560.jpg","comment_is_top":false,"comment_ctime":1620527890,"is_pvip":true,"replies":[{"id":"105711","content":"é¦–å…ˆä½ è¦æ˜ç¡®ï¼Œæ¯ä¸ªGï¼ˆgoroutineï¼‰éƒ½éœ€è¦åœ¨æŸä¸ªMï¼ˆç³»ç»Ÿçº¿ç¨‹ï¼‰ä¸Šè¿è¡Œï¼Œè€Œæ¯ä¸ªMéƒ½éœ€è¦åœ¨æŸä¸ªCPUæ ¸å¿ƒä¸­è¿è¡Œã€‚æ‰€ä»¥ï¼š<br><br>1. åœ¨åŒä¸€æ—¶åˆ»ï¼ŒGoè°ƒåº¦å™¨ä¸­çš„Gæœ‰å¾ˆå¤šï¼Œä½†æ˜¯æ­£åœ¨è¿è¡Œçš„Gçš„æ•°é‡ä¸ä¼šå¤šäºMæ•°ã€‚å¦‚æœå½“å‰æ‰€æœ‰çš„Méƒ½å¿™ä¸è¿‡æ¥äº†ï¼Œé‚£ä¹ˆGoè°ƒåº¦å™¨å°±ä¼šé©¬ä¸Šç”Ÿæˆæ–°çš„Mã€‚<br><br>2. åœ¨æŸäº›æ—¶å€™ï¼ŒMçš„æ•°é‡å¯èƒ½ä¼šè¶…è¿‡CPUæ ¸å¿ƒæ•°ã€‚ä½†æ˜¯ï¼Œæ¯ä¸ªCPUæ ¸å¿ƒåœ¨åŒä¸€æ—¶åˆ»åªèƒ½è¿è¡Œä¸€ä¸ªMã€‚è¿‡å¤šçš„Mä¼šåŠ é‡CPUæ ¸å¿ƒçš„è´Ÿæ‹…ã€‚<br><br>ä¸‹é¢æ­£å¼å›ç­”ä½ çš„é—®é¢˜ï¼š<br><br>Goroutineä¸ä¸€å®šä¼šä¸CPUæ ¸å¿ƒæ•°ç›¸ç­‰ï¼Œè¿™æ²¡æœ‰å¿…è¦ï¼Œä¹Ÿä¸å®¹æ˜“æ§åˆ¶ã€‚<br><br>Goè¯­è¨€è°ƒåº¦æ¨¡å‹ä¸­çš„Pæœ€å¥½ä¸CPUæ ¸å¿ƒæ•°ç›¸ç­‰ã€‚<br><br>å› ä¸ºä¸€ä¸ªPå°±ä»£è¡¨ç€ä¸€æ¡è°ƒåº¦çº¿ã€‚å¯ä»¥è¯´ï¼Œå®ƒä¼šä¸æ–­åœ°æŠŠå…¶é˜Ÿåˆ—ä¸­çš„Gå–‚ç»™Mã€‚åè¿‡æ¥è®²ï¼Œæ¯ä¸ªMä¸€æ—¦é¥¿äº†ï¼ˆå¤„äºç©ºé—²çŠ¶æ€ï¼‰å°±ä¼šå‘è°ƒåº¦å™¨è¦åƒçš„ï¼ˆå¯è¿è¡Œçš„Gï¼‰ã€‚<br><br>åŸºäºæ­¤ï¼Œå¦‚æœè°ƒåº¦çº¿å¤ªå°‘ï¼Œé‚£ä¹ˆè¿™ä¸ªè°ƒåº¦æ¨¡å‹çš„æ•ˆç‡å°±æ— æ³•å®Œå…¨ä½“ç°ï¼Œä¸€äº›CPUæ ¸å¿ƒå°±ä¼šæ¯”è¾ƒé—²ï¼›ä½†å¦‚æœè°ƒåº¦çº¿å¤ªå¤šï¼Œé‚£è°ƒåº¦å™¨è°ƒåº¦çš„å¯è¿è¡ŒGåˆä¼šå¯¼è‡´å¾ˆå¤šMäº§ç”Ÿï¼Œè€Œè¿™äº›Måˆä¼šå¤šåˆ°CPUæ ¸å¿ƒå¿™ä¸è¿‡æ¥ï¼ˆåè€Œä¼šå½±å“æ•ˆç‡ï¼‰ã€‚<br><br>ä¸€ä¸ªGoroutineåœ¨ç­‰å¾…IOã€ç­‰å¾…è®¡æ—¶å™¨ã€ç­‰å¾…é”çš„æ—¶å€™ä¼šå¤„äºç­‰å¾…çŠ¶æ€ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå½“å‰çš„På°±å¯ä»¥æŠŠè¿™ä¸ªgoroutineä¸è¿è¡Œå®ƒçš„Måˆ†ç¦»äº†ã€‚ä¹‹åï¼Œè¿™ä¸ªMå°±ç©ºé—²äº†ï¼Œå°±å¯ä»¥å»å¯»æ‰¾å…¶ä»–çš„Gå»è¿è¡Œäº†ã€‚<br><br>åŸºäºæ­¤ï¼Œæˆ‘ä»¬æäº¤ç»™Goè°ƒåº¦å™¨çš„goroutineå¯ä»¥å¾ˆå¤šï¼Œä½†æ˜¯æ­£åœ¨è¿è¡Œçš„goroutineä¼šä¸MåŸºæœ¬ä¿æŒä¸€è‡´ã€‚è¿™ç§å¹³è¡¡çŠ¶æ€ä¼šç”±Pçš„æ•°é‡æ§åˆ¶ï¼Œæ‰€ä»¥è¯´Påœ¨è°ƒåº¦çš„è¿‡ç¨‹ä¸­æ˜¯è‡³å…³é‡è¦çš„ï¼Œä¼šç›´æ¥å½±å“åˆ°Goè°ƒåº¦å™¨çš„æ•ˆç‡ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1620627794,"ip_address":"","comment_id":291812,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23095364370","product_id":100013101,"comment_content":"çœŸæ­£è¿è¡Œçš„ goroutine æ•°é‡åº”è¯¥æ˜¯å’Œ CPU æ ¸å¿ƒæ•°æ˜¯ç›¸ç­‰ï¼Œæ¯•ç«ŸåŒä¸€æ—¶åˆ»æ­£å¤„åœ¨è¿è¡ŒçŠ¶æ€çš„ goroutine å¿…é¡»æ˜¯è¿è¡Œåœ¨çœŸå®çš„ CPU æ ¸å¿ƒä¸Šçš„ã€‚è€å¸ˆæˆ‘è¿™æ ·ç†è§£ï¼Œæ˜¯æ­£ç¡®çš„å—ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519578,"discussion_content":"é¦–å…ˆä½ è¦æ˜ç¡®ï¼Œæ¯ä¸ªGï¼ˆgoroutineï¼‰éƒ½éœ€è¦åœ¨æŸä¸ªMï¼ˆç³»ç»Ÿçº¿ç¨‹ï¼‰ä¸Šè¿è¡Œï¼Œè€Œæ¯ä¸ªMéƒ½éœ€è¦åœ¨æŸä¸ªCPUæ ¸å¿ƒä¸­è¿è¡Œã€‚æ‰€ä»¥ï¼š\n\n1. åœ¨åŒä¸€æ—¶åˆ»ï¼ŒGoè°ƒåº¦å™¨ä¸­çš„Gæœ‰å¾ˆå¤šï¼Œä½†æ˜¯æ­£åœ¨è¿è¡Œçš„Gçš„æ•°é‡ä¸ä¼šå¤šäºMæ•°ã€‚å¦‚æœå½“å‰æ‰€æœ‰çš„Méƒ½å¿™ä¸è¿‡æ¥äº†ï¼Œé‚£ä¹ˆGoè°ƒåº¦å™¨å°±ä¼šé©¬ä¸Šç”Ÿæˆæ–°çš„Mã€‚\n\n2. åœ¨æŸäº›æ—¶å€™ï¼ŒMçš„æ•°é‡å¯èƒ½ä¼šè¶…è¿‡CPUæ ¸å¿ƒæ•°ã€‚ä½†æ˜¯ï¼Œæ¯ä¸ªCPUæ ¸å¿ƒåœ¨åŒä¸€æ—¶åˆ»åªèƒ½è¿è¡Œä¸€ä¸ªMã€‚è¿‡å¤šçš„Mä¼šåŠ é‡CPUæ ¸å¿ƒçš„è´Ÿæ‹…ã€‚\n\nä¸‹é¢æ­£å¼å›ç­”ä½ çš„é—®é¢˜ï¼š\n\nGoroutineä¸ä¸€å®šä¼šä¸CPUæ ¸å¿ƒæ•°ç›¸ç­‰ï¼Œè¿™æ²¡æœ‰å¿…è¦ï¼Œä¹Ÿä¸å®¹æ˜“æ§åˆ¶ã€‚\n\nGoè¯­è¨€è°ƒåº¦æ¨¡å‹ä¸­çš„Pæœ€å¥½ä¸CPUæ ¸å¿ƒæ•°ç›¸ç­‰ã€‚\n\nå› ä¸ºä¸€ä¸ªPå°±ä»£è¡¨ç€ä¸€æ¡è°ƒåº¦çº¿ã€‚å¯ä»¥è¯´ï¼Œå®ƒä¼šä¸æ–­åœ°æŠŠå…¶é˜Ÿåˆ—ä¸­çš„Gå–‚ç»™Mã€‚åè¿‡æ¥è®²ï¼Œæ¯ä¸ªMä¸€æ—¦é¥¿äº†ï¼ˆå¤„äºç©ºé—²çŠ¶æ€ï¼‰å°±ä¼šå‘è°ƒåº¦å™¨è¦åƒçš„ï¼ˆå¯è¿è¡Œçš„Gï¼‰ã€‚\n\nåŸºäºæ­¤ï¼Œå¦‚æœè°ƒåº¦çº¿å¤ªå°‘ï¼Œé‚£ä¹ˆè¿™ä¸ªè°ƒåº¦æ¨¡å‹çš„æ•ˆç‡å°±æ— æ³•å®Œå…¨ä½“ç°ï¼Œä¸€äº›CPUæ ¸å¿ƒå°±ä¼šæ¯”è¾ƒé—²ï¼›ä½†å¦‚æœè°ƒåº¦çº¿å¤ªå¤šï¼Œé‚£è°ƒåº¦å™¨è°ƒåº¦çš„å¯è¿è¡ŒGåˆä¼šå¯¼è‡´å¾ˆå¤šMäº§ç”Ÿï¼Œè€Œè¿™äº›Måˆä¼šå¤šåˆ°CPUæ ¸å¿ƒå¿™ä¸è¿‡æ¥ï¼ˆåè€Œä¼šå½±å“æ•ˆç‡ï¼‰ã€‚\n\nä¸€ä¸ªGoroutineåœ¨ç­‰å¾…IOã€ç­‰å¾…è®¡æ—¶å™¨ã€ç­‰å¾…é”çš„æ—¶å€™ä¼šå¤„äºç­‰å¾…çŠ¶æ€ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå½“å‰çš„På°±å¯ä»¥æŠŠè¿™ä¸ªgoroutineä¸è¿è¡Œå®ƒçš„Måˆ†ç¦»äº†ã€‚ä¹‹åï¼Œè¿™ä¸ªMå°±ç©ºé—²äº†ï¼Œå°±å¯ä»¥å»å¯»æ‰¾å…¶ä»–çš„Gå»è¿è¡Œäº†ã€‚\n\nåŸºäºæ­¤ï¼Œæˆ‘ä»¬æäº¤ç»™Goè°ƒåº¦å™¨çš„goroutineå¯ä»¥å¾ˆå¤šï¼Œä½†æ˜¯æ­£åœ¨è¿è¡Œçš„goroutineä¼šä¸MåŸºæœ¬ä¿æŒä¸€è‡´ã€‚è¿™ç§å¹³è¡¡çŠ¶æ€ä¼šç”±Pçš„æ•°é‡æ§åˆ¶ï¼Œæ‰€ä»¥è¯´Påœ¨è°ƒåº¦çš„è¿‡ç¨‹ä¸­æ˜¯è‡³å…³é‡è¦çš„ï¼Œä¼šç›´æ¥å½±å“åˆ°Goè°ƒåº¦å™¨çš„æ•ˆç‡ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1620627794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":245329,"user_name":"é¸ æ‘©Â·æ™º","can_delete":false,"product_type":"c1","uid":1211909,"ip_address":"","ucode":"6CD93CD1DB6955","user_header":"https://static001.geekbang.org/account/avatar/00/12/7e/05/431d380f.jpg","comment_is_top":false,"comment_ctime":1598915080,"is_pvip":false,"replies":[{"id":"90243","content":"å¯¹çš„ã€‚è¿™è¿˜è¿å¸¦ç€å†…å­˜è®¿é—®çš„é—®é¢˜ã€‚å¦‚æœæ²¡æœ‰CPUçº§åˆ«çš„åŸå­æŒ‡ä»¤çš„ä¿æŠ¤ï¼Œä¸€ä¸ªCPUæ ¸å¿ƒæ ¹æœ¬å°±é˜»æ­¢ä¸äº†å…¶ä»–CPUæ ¸å¿ƒåœ¨åŒä¸€æœŸé—´è®¿é—®åŒä¸€ä¸ªå—å†…å­˜æˆ–è€…åŒä¸€å—ç¼“å­˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1598934263,"ip_address":"","comment_id":245329,"utype":1}],"discussion_count":1,"race_medal":5,"score":"18778784264","product_id":100013101,"comment_content":"ç»§ç»­ poettian çš„é—®é¢˜ã€‚a=1æœ¬èº«ä¸æ˜¯åŸå­æ€§çš„å—ï¼Ÿ @éƒè€å¸ˆ ä½ çš„å›ç­”é‡Œåªæ˜¯è¯´äº†è¶…å‡ºå­—å®½çš„æƒ…å†µã€‚é‚£å¦‚æœå¯¹æ²¡æœ‰è¶…å‡ºå­—å®½çš„æƒ…å†µï¼Œæ˜¯ä¸æ˜¯å¯¹äºå¤šcpuä¹‹é—´çš„æœ¬åœ°ä¸‰çº§ç¼“å­˜åŒæ­¥ï¼Œä¹Ÿæ˜¯a=1ä¸æ˜¯åŸå­æ€§çš„ä¸€ç§caseï¼Œæˆ‘è¿™æ ·ç†è§£å¯¹å—ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":504853,"discussion_content":"å¯¹çš„ã€‚è¿™è¿˜è¿å¸¦ç€å†…å­˜è®¿é—®çš„é—®é¢˜ã€‚å¦‚æœæ²¡æœ‰CPUçº§åˆ«çš„åŸå­æŒ‡ä»¤çš„ä¿æŠ¤ï¼Œä¸€ä¸ªCPUæ ¸å¿ƒæ ¹æœ¬å°±é˜»æ­¢ä¸äº†å…¶ä»–CPUæ ¸å¿ƒåœ¨åŒä¸€æœŸé—´è®¿é—®åŒä¸€ä¸ªå—å†…å­˜æˆ–è€…åŒä¸€å—ç¼“å­˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598934263,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":165213,"user_name":"Richard","can_delete":false,"product_type":"c1","uid":1316758,"ip_address":"","ucode":"893F958B9DD161","user_header":"https://static001.geekbang.org/account/avatar/00/14/17/96/846fc11b.jpg","comment_is_top":false,"comment_ctime":1577180125,"is_pvip":false,"replies":[{"id":"63062","content":"ä¸´ç•ŒåŒºæ˜¯æŒ‡äº’æ–¥é”ä¿æŠ¤çš„åŒºåŸŸã€‚é”åªèƒ½ä¿è¯æ“ä½œä¸Šçš„äº’æ–¥ï¼Œæˆ–è€…è¯´ä¸²è¡Œï¼Œä½†ä¸èƒ½ä¿è¯ä¸è¢«ä¸­æ–­ã€‚â€œäº’æ–¥â€å’Œâ€œä¸ä¸­æ–­â€æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µã€‚é”ä¿æŠ¤çš„ä»£ç æ²¡æœ‰åŸå­æ€§ä¸€è¯´ï¼Œåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­æ˜¯æœ‰å¯èƒ½è¢«ä¸­æ–­çš„ï¼Œå³å¯èƒ½ä¼šè¢«æ’¤ä¸‹CPUï¼Œè½¬è€Œè¿è¡Œå…¶ä»–å¹¶å‘çš„ä»£ç ã€‚<br><br>äº’æ–¥é”é‡Œé¢ä¼šç”¨åˆ°åŸå­æ“ä½œï¼Œä½†é‚£åªæ˜¯å…¶ä¸­çš„ä¸€ä¸ªæˆ–å‡ ä¸ªæ­¥éª¤è€Œå·²ã€‚åŸå­æ“ä½œåªèƒ½é’ˆå¯¹åŸå§‹çš„å†…å­˜åœ°å€æ¥åšï¼Œå…¶ä¸­çš„ä¸€ä¸ªåŸå› æ˜¯å®ƒå¯¹CPUçš„æ€§èƒ½å½±å“å·¨å¤§ã€‚ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼ŒåŸå­æ“ä½œæ ¹æœ¬æ— æ³•é¡¾åŠæŸæ®µä»£ç è¿™ä¹ˆå¤§é¢—ç²’åº¦çš„ä¸œè¥¿ã€‚<br>","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1577240954,"ip_address":"","comment_id":165213,"utype":1}],"discussion_count":3,"race_medal":0,"score":"18757049309","product_id":100013101,"comment_content":"â€œè¿™ä¸ªä¸­æ–­çš„æ—¶æœºæœ‰å¾ˆå¤šï¼Œä»»ä½•ä¸¤æ¡è¯­å¥æ‰§è¡Œçš„é—´éš™ï¼Œç”šè‡³åœ¨æŸæ¡è¯­å¥æ‰§è¡Œçš„è¿‡ç¨‹ä¸­éƒ½æ˜¯å¯ä»¥çš„ã€‚å³ä½¿è¿™äº›è¯­å¥åœ¨ä¸´ç•ŒåŒºä¹‹å†…ä¹Ÿæ˜¯å¦‚æ­¤â€œ æˆ‘å¯¹è¿™æ®µè¯é‡Œçš„ä¸´ç•ŒåŒºå†…ä¹Ÿèƒ½äº§ç”Ÿä¸­æ–­æœ‰äº›ç–‘é—®ï¼Œæˆ‘æŸ¥é˜…ç›¸å…³èµ„æ–™åç†è§£ä¸ºï¼ŒCPUæä¾›äº†ä¸€äº›åŸå­æ“ä½œæœºåˆ¶ï¼Œosæˆ–è€…è¯­è¨€apiä½¿ç”¨è¿™äº›åŸå­æ“ä½œå®ç°äº†é”ï¼Œä½¿ç”¨é”èƒ½ä¿è¯æ›´å¤§èŒƒå›´çš„åŸå­æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ç†è§£çš„ä¸´ç•ŒåŒºä¹Ÿæ˜¯ä¸€ç»„ä¸å¯ä¸­æ–­çš„æ“ä½œï¼Œä¹Ÿæ˜¯å…·æœ‰åŸå­æ€§çš„ï¼›è€Œä¸”å•æ ¸ä¸Šè¿›å…¥ä¸´ç•ŒåŒºä¼šå…³ä¸­æ–­ï¼Œç¦»å¼€ä¸´ç•ŒåŒºä¼šå¼€ä¸­æ–­ï¼›æ‰€ä»¥éƒå¤§æˆ‘è¿™é‡Œæ˜¯ä¸æ˜¯ç†è§£æœ‰è¯¯ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":479079,"discussion_content":"ä¸´ç•ŒåŒºæ˜¯æŒ‡äº’æ–¥é”ä¿æŠ¤çš„åŒºåŸŸã€‚é”åªèƒ½ä¿è¯æ“ä½œä¸Šçš„äº’æ–¥ï¼Œæˆ–è€…è¯´ä¸²è¡Œï¼Œä½†ä¸èƒ½ä¿è¯ä¸è¢«ä¸­æ–­ã€‚â€œäº’æ–¥â€å’Œâ€œä¸ä¸­æ–­â€æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µã€‚é”ä¿æŠ¤çš„ä»£ç æ²¡æœ‰åŸå­æ€§ä¸€è¯´ï¼Œåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­æ˜¯æœ‰å¯èƒ½è¢«ä¸­æ–­çš„ï¼Œå³å¯èƒ½ä¼šè¢«æ’¤ä¸‹CPUï¼Œè½¬è€Œè¿è¡Œå…¶ä»–å¹¶å‘çš„ä»£ç ã€‚\n\näº’æ–¥é”é‡Œé¢ä¼šç”¨åˆ°åŸå­æ“ä½œï¼Œä½†é‚£åªæ˜¯å…¶ä¸­çš„ä¸€ä¸ªæˆ–å‡ ä¸ªæ­¥éª¤è€Œå·²ã€‚åŸå­æ“ä½œåªèƒ½é’ˆå¯¹åŸå§‹çš„å†…å­˜åœ°å€æ¥åšï¼Œå…¶ä¸­çš„ä¸€ä¸ªåŸå› æ˜¯å®ƒå¯¹CPUçš„æ€§èƒ½å½±å“å·¨å¤§ã€‚ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼ŒåŸå­æ“ä½œæ ¹æœ¬æ— æ³•é¡¾åŠæŸæ®µä»£ç è¿™ä¹ˆå¤§é¢—ç²’åº¦çš„ä¸œè¥¿ã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577240954,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2806043,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLBFkSq1oiaEMRjtyyv4ZpCI0OuaSsqs04ODm0OkZF6QhsAh3SvqhxibS2n7PLAVZE3QRSn5Hic0DyXg/132","nickname":"ddh","note":"","ucode":"8E852375365F16","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":541093,"discussion_content":"è€å¸ˆå›ç­”çš„å¥½ä¸“ä¸š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640252194,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1133945,"avatar":"https://static001.geekbang.org/account/avatar/00/11/4d/79/803537db.jpg","nickname":"æ…¢åŠ¨ä½œ","note":"","ucode":"62C944F4A4D8AC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378213,"discussion_content":"åŸå­æ€§å’ŒåŸå­æ“ä½œä¸æ˜¯ä¸€ä¼šäº‹å§ï¼Ÿé”äº’æ–¥æ‰§è¡Œï¼Œä¸æ˜¯åŸå­æ“ä½œä¹Ÿå¯ä»¥ä¿æŒåŸå­æ€§ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623115203,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":198360,"user_name":"ç»™åŠ›","can_delete":false,"product_type":"c1","uid":1113645,"ip_address":"","ucode":"646EE4AFC17224","user_header":"https://static001.geekbang.org/account/avatar/00/10/fe/2d/2c9177ca.jpg","comment_is_top":false,"comment_ctime":1585447518,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14470349406","product_id":100013101,"comment_content":"&#47;&#47; AddUint32 atomically adds delta to *addr and returns the new value.<br>&#47;&#47; To subtract a signed positive constant value c from x, do AddUint32(&amp;x, ^uint32(c-1)).<br>&#47;&#47; In particular, to decrement x, do AddUint32(&amp;x, ^uint32(0)).<br>func AddUint32(addr *uint32, delta uint32) (new uint32)<br><br>æƒ³è¦åœ¨æ— ç¬¦å·ä¸­å‡å»æœ‰ç¬¦å·æ•°ã€‚ä»¥ä¸Šæºç ä¸­æä¾›äº†2ç§æ–¹å¼","like_count":3},{"had_liked":false,"id":197900,"user_name":"æ¶›å£°ä¾æ—§","can_delete":false,"product_type":"c1","uid":1013593,"ip_address":"","ucode":"E0F22ECA010A5C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/77/59/8bb1f879.jpg","comment_is_top":false,"comment_ctime":1585402535,"is_pvip":false,"replies":[{"id":"75136","content":"æ˜¯çš„ï¼Œé±¼å’Œç†ŠæŒéš¾ä»¥å…¼å¾—ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1585658066,"ip_address":"","comment_id":197900,"utype":1}],"discussion_count":3,"race_medal":0,"score":"14470304423","product_id":100013101,"comment_content":"åŸå­æ“ä½œè™½ç„¶å¿«ï¼Œä½†ä½¿ç”¨åœºæ™¯æœ‰é™ï¼›é”è™½ç„¶ä½¿ç”¨éº»çƒ¦ï¼Œä½†ä½¿ç”¨åœºæ™¯è¾ƒå¤šï¼›è¿™æ˜¯æˆ‘å¯¹é”ä¸åŸå­æ“ä½œçš„ç†è§£ï¼›","like_count":3,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489614,"discussion_content":"æ˜¯çš„ï¼Œé±¼å’Œç†ŠæŒéš¾ä»¥å…¼å¾—ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585658066,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1010571,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/6b/8b/ccdb819a.jpg","nickname":"W","note":"","ucode":"62AE242DD703B7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":277547,"discussion_content":"èƒ½å…·ä½“è¯´è¯´å„è‡ªçš„åœºæ™¯å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591069421,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1336951,"avatar":"https://static001.geekbang.org/account/avatar/00/14/66/77/194ba21d.jpg","nickname":"lzh","note":"","ucode":"C3D83DF4230109","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1010571,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/6b/8b/ccdb819a.jpg","nickname":"W","note":"","ucode":"62AE242DD703B7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":363854,"discussion_content":"åŸå­æ“ä½œä¸€èˆ¬ç”¨åœ¨è½»é‡çº§çš„åœºæ™¯ï¼Œåªæœ‰å‡ ä¸ªå¹¶å‘ï¼Œå¼•å…¥äº’æ–¥é”åˆå¤ªé‡ï¼Œé‚£è¿™å‡ ä¸ªå¹¶å‘çº¿ç¨‹å¯¹äºå…¬å…±èµ„æºå¯ä»¥åŸå­æ“ä½œï¼Œæ‹¿CASæ¥è®²ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æˆåŠŸï¼Œå…¶ä½™çº¿ç¨‹å¤±è´¥\n\nå¦‚æœå¹¶å‘æ¯”è¾ƒå¤šäº†ï¼Œå‡ åä¸ªå¹¶å‘ç”¨CASï¼Œä½†æ˜¯æ¯æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹CASæˆåŠŸï¼Œå…¶ä½™éƒ½å¤±è´¥ï¼Œè¿™æ ·æ˜¯ç™½ç™½è€—è´¹æ€§èƒ½çš„ï¼Œæ­¤æ—¶è¿˜ä¸å¦‚å¼•å…¥äº’æ–¥é”ï¼Œè‡³å°‘æŠ¢ä¸åˆ°é”çš„çº¿ç¨‹è¿˜å¯ä»¥è¢«é˜»å¡ï¼Œæ˜çŸ¥ç»“æœæ˜¯å¤±è´¥çš„å°±ä¸ç”¨æ‰§è¡ŒCASçš„æ¯”è¾ƒäº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1617290803,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":277547,"ip_address":""},"score":363854,"extra":""}]}]},{"had_liked":false,"id":204912,"user_name":"ä¼ è¯´ä¸­çš„æˆå¤§å¤§","can_delete":false,"product_type":"c1","uid":1236766,"ip_address":"","ucode":"103543D6E706BF","user_header":"https://static001.geekbang.org/account/avatar/00/12/df/1e/cea897e8.jpg","comment_is_top":false,"comment_ctime":1586489832,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10176424424","product_id":100013101,"comment_content":"å¦‚æœæˆ‘ä»¬å…ˆæŠŠint32(-3)çš„ç»“æœå€¼èµ‹ç»™å˜é‡deltaï¼Œå†æŠŠdeltaçš„å€¼è½¬æ¢ä¸ºuint32ç±»å‹çš„å€¼ï¼Œå°±å¯ä»¥ç»•è¿‡ç¼–è¯‘å™¨çš„æ£€æŸ¥å¹¶å¾—åˆ°æ­£ç¡®çš„ç»“æœäº†ã€‚<br>æˆ‘ç»ˆäºæƒ³æ˜ç™½äº†  æ˜¯å› ä¸ºdeltaæ˜¯ä¸ªå˜é‡ ç±»å‹æ˜¯int32ç±»å‹ æ‰€ä»¥ç¼–è¯‘å™¨åœ¨ç¼–è¯‘çš„æ—¶å€™æ˜¯ä¸ä¼šæŠ¥overflowçš„<br>ä½†æ˜¯å¦‚æœå†™ä¸ªå­—é¢é‡-3åˆ™æ˜¯å¯ä»¥ç¼–è¯‘æ£€æŸ¥å‡ºæ¥çš„","like_count":2,"discussions":[{"author":{"id":2100644,"avatar":"","nickname":"Geek_8e2759","note":"","ucode":"EBDBA4D92B5C50","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302937,"discussion_content":"åè€…æ˜¯å¸¸é‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599093978,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":275968,"user_name":"BOB","can_delete":false,"product_type":"c1","uid":1066638,"ip_address":"","ucode":"239C06A7CD3BD5","user_header":"https://static001.geekbang.org/account/avatar/00/10/46/8e/334d25ba.jpg","comment_is_top":false,"comment_ctime":1611733021,"is_pvip":false,"replies":[{"id":"100266","content":"è°ƒåº¦å’ŒåŒæ—¶è¿è¡Œæ˜¯ä¸¤ç äº‹å•Šã€‚å½“goroutineåœ¨Mä¸Šè¿è¡Œå¹¶ä¸”éœ€è¦æš‚æ—¶æŒ‚èµ·æ—¶ï¼ŒPå°±ä¸å»ç®¡å®ƒäº†ï¼Œè½¬è€Œå»è°ƒåº¦å…¶ä»–çš„å¯è¿è¡Œgoroutineï¼Œç­‰å‰é¢é‚£ä¸ªgoroutineä»ç­‰å¾…æˆ–æŒ‚èµ·çŠ¶æ€æ¢å¤æˆå¯è¿è¡ŒçŠ¶æ€æ—¶ï¼Œè°ƒåº¦å™¨å†ç»™å®ƒæ‰¾Pæˆ–è€…æ”¾å…¥å…¨å±€å¯è¿è¡ŒGé˜Ÿåˆ—ç­‰å¾…è°ƒåº¦ã€‚<br><br>æ‰€ä»¥ï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯ï¼Œæ­£åœ¨è¿è¡Œçš„goroutineæ•°é‡ï¼Œè‚¯å®šæ¯”æ­£åœ¨è¢«è°ƒåº¦çš„goroutineæ•°é‡å¤šå•Šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1611813618,"ip_address":"","comment_id":275968,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5906700317","product_id":100013101,"comment_content":"éƒè€å¸ˆæ‚¨å¥½ï¼Œåœ¨å‰é¢è®²åŸºå‡†æµ‹è¯•çš„æ—¶å€™ï¼Œè¯´è¿‡goè¿è¡Œæ—¶æœ€å¤šåŒæ—¶è°ƒåº¦ P ä¸ªgoroutineï¼Œè¿™ä¸€ç¯‡è¯´åŒæ—¶è¿è¡Œçš„goroutineæ•°ç›®æœ€å¤§ä¸ºMã€‚ã€‚è¿™ä¸¤å¥è¯æ˜¯å¦çŸ›ç›¾ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514549,"discussion_content":"è°ƒåº¦å’ŒåŒæ—¶è¿è¡Œæ˜¯ä¸¤ç äº‹å•Šã€‚å½“goroutineåœ¨Mä¸Šè¿è¡Œå¹¶ä¸”éœ€è¦æš‚æ—¶æŒ‚èµ·æ—¶ï¼ŒPå°±ä¸å»ç®¡å®ƒäº†ï¼Œè½¬è€Œå»è°ƒåº¦å…¶ä»–çš„å¯è¿è¡Œgoroutineï¼Œç­‰å‰é¢é‚£ä¸ªgoroutineä»ç­‰å¾…æˆ–æŒ‚èµ·çŠ¶æ€æ¢å¤æˆå¯è¿è¡ŒçŠ¶æ€æ—¶ï¼Œè°ƒåº¦å™¨å†ç»™å®ƒæ‰¾Pæˆ–è€…æ”¾å…¥å…¨å±€å¯è¿è¡ŒGé˜Ÿåˆ—ç­‰å¾…è°ƒåº¦ã€‚\n\næ‰€ä»¥ï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯ï¼Œæ­£åœ¨è¿è¡Œçš„goroutineæ•°é‡ï¼Œè‚¯å®šæ¯”æ­£åœ¨è¢«è°ƒåº¦çš„goroutineæ•°é‡å¤šå•Šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611813618,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":335028,"user_name":"æ›¼å·´","can_delete":false,"product_type":"c1","uid":1185400,"ip_address":"","ucode":"794BACF765E2A8","user_header":"https://static001.geekbang.org/account/avatar/00/12/16/78/3f4a2104.jpg","comment_is_top":false,"comment_ctime":1645260241,"is_pvip":true,"replies":[{"id":"122375","content":"æ£’ :b","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1026643","ctime":1645331877,"ip_address":"","comment_id":335028,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1645260241","product_id":100013101,"comment_content":"åŸå­æ“ä½œçš„æ„ä¹‰ï¼Œè€å¸ˆçš„å›ç­”ï¼Œæ‘˜å½•å‡ºæ¥äº†ã€‚<br>å³ä½¿åƒ a = 1 è¿™ç§ç®€å•çš„èµ‹å€¼æ“ä½œä¹Ÿå¹¶ä¸ä¸€å®šèƒ½å¤Ÿä¸€æ¬¡å®Œæˆã€‚å¦‚æœå³è¾¹çš„å€¼çš„å­˜å‚¨å®½åº¦è¶…å‡ºäº†è®¡ç®—æœºçš„å­—å®½ï¼Œé‚£ä¹ˆå®é™…çš„æ­¥éª¤å°±ä¼šå¤šäºä¸€ä¸ªï¼ˆæˆ–è€…è¯´åº•å±‚æŒ‡ä»¤å¤šäºä¸€ä¸ªï¼‰ã€‚æ¯”å¦‚ï¼Œä½ è®¡ç®—æœºæ˜¯32ä½çš„ï¼Œä½†æ˜¯ä½ è¦æŠŠä¸€ä¸ªInt64ç±»å‹çš„æ•°èµ‹ç»™å˜é‡aï¼Œé‚£ä¹ˆåº•å±‚æŒ‡ä»¤å°±è‚¯å®šå¤šäºä¸€ä¸ªã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¤šä¸ªåº•å±‚æŒ‡ä»¤çš„æ‰§è¡ŒæœŸé—´æ˜¯å¯ä»¥è¢«æ‰“æ–­çš„ï¼Œä¹Ÿå°±æ˜¯è¯´CPUåœ¨è¿™æ—¶å¯ä»¥è¢«åˆ‡æ¢åˆ°åˆ«çš„ä»»åŠ¡ä¸Šã€‚å¦‚æœæ–°ä»»åŠ¡æ°å·§è¦è¯»å†™è¿™ä¸ªå˜é‡aï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°å€¼ä¸å®Œæ•´çš„é—®é¢˜ã€‚å†µä¸”ï¼Œå°±ç®—æ˜¯ a = 1ï¼Œæ“ä½œç³»ç»Ÿå’ŒCPUä¹Ÿéƒ½ä¸ä¿è¯è¿™ä¸ªæ“ä½œä¸€å®šä¸ä¼šè¢«æ‰“æ–­ã€‚åªè¦è¢«æ‰“æ–­ï¼Œå°±å¾ˆæœ‰å¯èƒ½å‡ºç°å¹¶å‘è®¿é—®ä¸Šçš„é—®é¢˜ï¼Œå¹¶å‘å®‰å…¨æ€§ä¹Ÿå°±è¢«ç ´åäº†ã€‚","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552164,"discussion_content":"æ£’ :b","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645331877,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":328336,"user_name":"é’å±±","can_delete":false,"product_type":"c1","uid":1131070,"ip_address":"","ucode":"749BAD1834AC0F","user_header":"https://static001.geekbang.org/account/avatar/00/11/42/3e/c1f76202.jpg","comment_is_top":false,"comment_ctime":1640676540,"is_pvip":false,"replies":[{"id":"119583","content":"ç¨‹åºå†è·å–è¿™ä¸ªå˜é‡çš„å€¼ä¹Ÿå¾—ç”¨åŸå­æ“ä½œå•Šï¼ˆå¦‚æœè¦ä¿æŠ¤å…±äº«å˜é‡ï¼Œå°±åº”è¯¥å®æ–½å…¨é¢çš„ä¿æŠ¤ï¼‰ï¼Œè¿™é‡Œç›´æ¥è¿”å›æ¥ä¸å°±çœçš„å†åšä¸€æ¬¡åŸå­æ“ä½œäº†å˜›ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1026643","ctime":1640685580,"ip_address":"","comment_id":328336,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1640676540","product_id":100013101,"comment_content":"æˆ‘æœ‰ä¸ªé—®é¢˜æ—¢ç„¶addæ“ä½œçš„æ˜¯æŒ‡é’ˆå°±è¡¨ç¤ºå¯¹æŒ‡é’ˆå¯¹åº”çš„å€¼åšæ“ä½œä¸ºå•¥è¿˜è¦è¿”å›ä¸€ä¸ªæ–°å€¼ï¼Œç›´æ¥è·å–æ“ä½œçš„æŒ‡é’ˆå€¼å°±å¯ä»¥è·å¾—æœ€æ–°çš„å€¼äº†ï¼Œä¸éœ€è¦è®©ä»–é‡æ–°è¿”å›ä¸€ä¸ªæ–°å€¼æŠŠã€‚","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":542224,"discussion_content":"ç¨‹åºå†è·å–è¿™ä¸ªå˜é‡çš„å€¼ä¹Ÿå¾—ç”¨åŸå­æ“ä½œå•Šï¼ˆå¦‚æœè¦ä¿æŠ¤å…±äº«å˜é‡ï¼Œå°±åº”è¯¥å®æ–½å…¨é¢çš„ä¿æŠ¤ï¼‰ï¼Œè¿™é‡Œç›´æ¥è¿”å›æ¥ä¸å°±çœçš„å†åšä¸€æ¬¡åŸå­æ“ä½œäº†å˜›ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640685580,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":307640,"user_name":"lesserror","can_delete":false,"product_type":"c1","uid":1351076,"ip_address":"","ucode":"25A54D1165FCF6","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","comment_is_top":false,"comment_ctime":1629186725,"is_pvip":false,"replies":[{"id":"111483","content":"å¯¹äºåŸºæœ¬ç±»å‹çš„å€¼æ¥è¯´ï¼Œé€šè¿‡ä¼ å‚åœ¨å…¶ä»–å‡½æ•°é‡Œä½¿ç”¨çš„è¯ï¼Œå°±æ„å‘³ç€ä½¿ç”¨çš„æ˜¯å®ƒä»¬çš„å‰¯æœ¬ã€‚å› ä¸ºæ— è®ºæ˜¯å‚æ•°çš„ä¼ å…¥è¿˜æ˜¯ç»“æœçš„è¿”å›ï¼Œé‚£äº›å€¼éƒ½ä¼šç»å†æµ…è¡¨å¤åˆ¶ã€‚<br><br>ç›¸åï¼Œå¦‚æœç›´æ¥åœ¨å…¶ä»–å‡½æ•°é‡Œä½¿ç”¨åŸºæœ¬ç±»å‹çš„å¤–éƒ¨å˜é‡ï¼Œé‚£ä¹ˆå°±ç­‰äºåœ¨ä½¿ç”¨å®ƒä»¬çš„æœ¬ä½“ã€‚å¦‚æœç›´æ¥ä½¿ç”¨æœ¬ä½“ï¼Œå°±è¦è€ƒè™‘å¹¶å‘å®‰å…¨é—®é¢˜äº†ã€‚<br>","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1629301135,"ip_address":"","comment_id":307640,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1629186725","product_id":100013101,"comment_content":"éƒæ—è€å¸ˆï¼Œè¯·é—®åƒdemo63ä¸­çš„ã€ŒforAndCAS1ã€å‡½æ•° ä¸­çš„  go function å¯ä»¥ç›´æ¥ä½¿ç”¨ å¤–é¢çš„ å˜é‡ ï¼šnumï¼Œåˆå¯ä»¥é€šè¿‡ ä¼ å‚çš„ å½¢å¼ ä¼ é€’åˆ° go function ä¸­ï¼Œä¾‹å¦‚ ã€ŒforAndCAS2ã€å‡½æ•°ã€‚è¯·é—® è¿™ ä¸¤ç§ ä½¿ç”¨ æ–¹å¼ æœ‰ä»€ä¹ˆåŒºåˆ« å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525226,"discussion_content":"å¯¹äºåŸºæœ¬ç±»å‹çš„å€¼æ¥è¯´ï¼Œé€šè¿‡ä¼ å‚åœ¨å…¶ä»–å‡½æ•°é‡Œä½¿ç”¨çš„è¯ï¼Œå°±æ„å‘³ç€ä½¿ç”¨çš„æ˜¯å®ƒä»¬çš„å‰¯æœ¬ã€‚å› ä¸ºæ— è®ºæ˜¯å‚æ•°çš„ä¼ å…¥è¿˜æ˜¯ç»“æœçš„è¿”å›ï¼Œé‚£äº›å€¼éƒ½ä¼šç»å†æµ…è¡¨å¤åˆ¶ã€‚\n\nç›¸åï¼Œå¦‚æœç›´æ¥åœ¨å…¶ä»–å‡½æ•°é‡Œä½¿ç”¨åŸºæœ¬ç±»å‹çš„å¤–éƒ¨å˜é‡ï¼Œé‚£ä¹ˆå°±ç­‰äºåœ¨ä½¿ç”¨å®ƒä»¬çš„æœ¬ä½“ã€‚å¦‚æœç›´æ¥ä½¿ç”¨æœ¬ä½“ï¼Œå°±è¦è€ƒè™‘å¹¶å‘å®‰å…¨é—®é¢˜äº†ã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629301135,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":285780,"user_name":"AlexWillBeGood","can_delete":false,"product_type":"c1","uid":1505492,"ip_address":"","ucode":"6D7BB91781E38C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/exfIUlVdCpicQPc7fOI6XezUuXd7rayRia7sB2GGHGP7IEBibI6TJbQS2R0bMNejzR1odAIDFP05cWjujrmbIzzwg/132","comment_is_top":false,"comment_ctime":1617010340,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617010340","product_id":100013101,"comment_content":"if newNum == 10 {<br>\t\t\t\tbreak<br>\t\t\t}<br>newNumå’Œ10ä¸ä¸€å®šç›¸åŒ","like_count":0},{"had_liked":false,"id":285778,"user_name":"AlexWillBeGood","can_delete":false,"product_type":"c1","uid":1505492,"ip_address":"","ucode":"6D7BB91781E38C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/exfIUlVdCpicQPc7fOI6XezUuXd7rayRia7sB2GGHGP7IEBibI6TJbQS2R0bMNejzR1odAIDFP05cWjujrmbIzzwg/132","comment_is_top":false,"comment_ctime":1617010191,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617010191","product_id":100013101,"comment_content":"è‡ªæ—‹é”1ä¾‹å­é‡Œé¢çš„","like_count":0},{"had_liked":false,"id":243410,"user_name":"éƒ­å°èœ","can_delete":false,"product_type":"c1","uid":1017297,"ip_address":"","ucode":"C4044C80BB331B","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKYfcUOVhf3vhEBUNGHgtIcw8ujMZnkabicLzzjn3xwdeeic2PJSe7ibJgMx2UjF0d7L4B4gsRpaqe2A/132","comment_is_top":false,"comment_ctime":1598093800,"is_pvip":true,"replies":[{"id":"89781","content":"è¿˜çœŸä¸æ˜¯æŒ‰ä½å–åï¼Œæˆ‘å‰ä¸¤å¤©å·²ç»å›ç­”è¿‡ä¸€æ¬¡äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1598237535,"ip_address":"","comment_id":243410,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1598093800","product_id":100013101,"comment_content":"å¼‚æˆ–æ˜¯ä¸¤ä¸ªæ•°çš„æ“ä½œï¼Œåº”è¯¥è¡¨è¿°ä¸ºæŒ‰ä½å–åï¼","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":504278,"discussion_content":"è¿˜çœŸä¸æ˜¯æŒ‰ä½å–åï¼Œæˆ‘å‰ä¸¤å¤©å·²ç»å›ç­”è¿‡ä¸€æ¬¡äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1598237535,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1505155,"avatar":"https://static001.geekbang.org/account/avatar/00/16/f7/83/7fa4bd45.jpg","nickname":"è¶£å­¦è½¦","note":"","ucode":"5279A6BF4C67A3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":325155,"discussion_content":"ä¸¤ä¸ªæ“ä½œæ•°ï¼ŒæŒ‰ä½ç›¸åŒå–0ï¼Œä¸åŒå–1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605246437,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":241132,"user_name":"ArtistLu","can_delete":false,"product_type":"c1","uid":1166373,"ip_address":"","ucode":"2E641A3EB4F9AC","user_header":"https://static001.geekbang.org/account/avatar/00/11/cc/25/8c6eab2c.jpg","comment_is_top":false,"comment_ctime":1597199605,"is_pvip":true,"replies":[{"id":"89170","content":"å·²ç»åœ¨ä½ å¦ä¸€ä¸ªé—®é¢˜ä¸‹å›å¤äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1597306304,"ip_address":"","comment_id":241132,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1597199605","product_id":100013101,"comment_content":"è€å¸ˆ è¯·é—®ä¸‹ä¸€ä¸ªæ“ä½œæ•°å¼‚æˆ–å’‹ä¸ªç†è§£ï¼Ÿå¼‚æˆ–ä¸æ˜¯ä¸¤ä¸ªæ“ä½œæ•°å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503653,"discussion_content":"å·²ç»åœ¨ä½ å¦ä¸€ä¸ªé—®é¢˜ä¸‹å›å¤äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597306304,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":237596,"user_name":"Tom","can_delete":false,"product_type":"c1","uid":1074968,"ip_address":"","ucode":"5940DF3B4782DC","user_header":"https://static001.geekbang.org/account/avatar/00/10/67/18/79167fa2.jpg","comment_is_top":false,"comment_ctime":1595897169,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595897169","product_id":100013101,"comment_content":"æ¸…æ™°çš„è®¤è¯†åˆ°äº†é”ä¸åŸå­æ“ä½œçš„åŒºåˆ«ã€‚å¾ˆå¤šæ—¶å€™ä¹‹æ‰€ä»¥ä¼šè®¤ä¸ºäº’æ–¥é”ç®¡ç†çš„ä¸´ç•ŒåŒºæ˜¯åŸå­æ€§çš„ï¼Œæ˜¯å› ä¸ºå®ƒæ˜¯ä¸²è¡Œï¼Œåœ¨æ²¡æœ‰é‡Šæ”¾é”ç­‰æƒ…å†µä¸‹åªæœ‰æŒæœ‰é”çš„é‚£ä¸ªçº¿ç¨‹ä¸€ç›´åœ¨æ‰§è¡Œï¼Œè¡¨ç°å‡ºåŸå­ç°è±¡ã€‚ ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä¸´ç•ŒåŒºä¸­æœ‰å¤šæ¡çŠ¶æ€æ›´æ–°ç»„æˆçš„åŸå­å—ï¼Œç¬¬ä¸€ æ¡çŠ¶æ€æ›´æ–°è¯­å¥æ‰§è¡Œå®Œä¹‹åè¢«ä¸­æ–­é‡Šæ”¾äº†é”ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œçœ‹åˆ°äº†è¿™ä¸ªçŠ¶æ€åŸå­æ€§å°±è¢«æ‰“ç ´äº†ã€‚ cpuè¿™ç§åŸå­æ€§æ˜¯ç¡¬ä»¶å±‚é¢çš„æ”¯æŒï¼Œä¸€èˆ¬éœ€è¦é…åˆè‡ªæ—‹æ¥å®Œæˆ","like_count":0},{"had_liked":false,"id":224057,"user_name":"äº¢ï¼ˆçŸ¥è¡Œåˆä¸€çš„è·¯ä¸Šï¼‰","can_delete":false,"product_type":"c1","uid":1347013,"ip_address":"","ucode":"958AF7C96EB9E8","user_header":"https://static001.geekbang.org/account/avatar/00/14/8d/c5/898b13b4.jpg","comment_is_top":false,"comment_ctime":1591263659,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1591263659","product_id":100013101,"comment_content":"åŸå­æ“ä½œåœ¨å¤šåç¨‹åŒæ—¶åšè®¡æ•°æ—¶è¿˜æ˜¯æŒºæœ‰ç”¨çš„ã€‚","like_count":0},{"had_liked":false,"id":204909,"user_name":"ä¼ è¯´ä¸­çš„æˆå¤§å¤§","can_delete":false,"product_type":"c1","uid":1236766,"ip_address":"","ucode":"103543D6E706BF","user_header":"https://static001.geekbang.org/account/avatar/00/12/df/1e/cea897e8.jpg","comment_is_top":false,"comment_ctime":1586489568,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586489568","product_id":100013101,"comment_content":"è€å¸ˆ å…¶å®æˆ‘æƒ³é—®ä¸€ä¸‹ä¸ºä»€ä¹ˆ<br>å¦‚æœæˆ‘ä»¬å…ˆæŠŠint32(-3)çš„ç»“æœå€¼èµ‹ç»™å˜é‡deltaï¼Œå†æŠŠdeltaçš„å€¼è½¬æ¢ä¸ºuint32ç±»å‹çš„å€¼ï¼Œå°±å¯ä»¥ç»•è¿‡ç¼–è¯‘å™¨çš„æ£€æŸ¥å¹¶å¾—åˆ°æ­£ç¡®çš„ç»“æœäº†ã€‚<br>å°±å¯ä»¥ç»•è¿‡äº†å‘¢ï¼Ÿdeltaä¹Ÿæ˜¯int32ç±»å‹çš„-3å•Š","like_count":0},{"had_liked":false,"id":103028,"user_name":"benying","can_delete":false,"product_type":"c1","uid":1247522,"ip_address":"","ucode":"DEBAB485F381CC","user_header":"https://static001.geekbang.org/account/avatar/00/13/09/22/22c0c4fa.jpg","comment_is_top":false,"comment_ctime":1560350722,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1560350722","product_id":100013101,"comment_content":"æ‰“å¡","like_count":0},{"had_liked":false,"id":44701,"user_name":"sureingo","can_delete":false,"product_type":"c1","uid":1229792,"ip_address":"","ucode":"726A3098D0A783","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLncC9kniaC1FGaMTv9VGL9cAjyFreNl6Wkia4d6rjicbpsnso5oCLicpnHNBPVk5bnlogPWcV8Q9ovdA/132","comment_is_top":false,"comment_ctime":1543478238,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"1543478238","product_id":100013101,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œæ–‡ç« ä¸­æåˆ°äº’æ–¥é”ä¸èƒ½ä¿è¯ä¸´ç•ŒåŒºå†…ä»£ç çš„åŸå­æ€§ï¼Œæˆ‘ç”¨githubä¸­demo60åšäº†å¥½å¤šæ¬¡è¯•éªŒï¼Œæ¯æ¬¡çš„ç»“æœéƒ½æ˜¯æ­£ç¡®çš„ï¼Œèƒ½å¸®å¿™è§£é‡Šä¸‹å—<br><br>type counter struct {<br>\tnum uint         &#47;&#47; è®¡æ•°ã€‚<br>\tmu  sync.RWMutex &#47;&#47; è¯»å†™é”ã€‚<br>}<br><br>&#47;&#47; number ä¼šè¿”å›å½“å‰çš„è®¡æ•°ã€‚<br>func (c *counter) number() uint {<br>\tc.mu.RLock()<br>\tdefer c.mu.RUnlock()<br>\treturn c.num<br>}<br><br>&#47;&#47; add ä¼šå¢åŠ è®¡æ•°å™¨çš„å€¼ï¼Œå¹¶ä¼šè¿”å›å¢åŠ åçš„è®¡æ•°ã€‚<br>func (c *counter) add(increment uint) uint {<br>\tc.mu.Lock()<br>\tdefer c.mu.Unlock()<br>\tc.num += increment<br>\treturn c.num<br>}<br><br>func main() {<br>\tc := counter{}<br>\tsign := make(chan struct{})<br>\tfor i := 0; i &lt; 1000; i++ {<br>\t\tgo func() {<br>\t\t\tdefer func() {<br>\t\t\t\tsign &lt;- struct{}{}<br>\t\t\t}()<br>\t\t\tfor j := 0; j &lt; 1000; j++ {<br>\t\t\t\tc.add(1)<br>\t\t\t}<br>\t\t}()<br>\t}<br>\tfor i := 0; i &lt; 1000; i++ {<br>\t\t&lt;-sign<br>\t}<br>\tfmt.Println(c.number())<br>}<br>è¾“å‡ºæ˜¯1000000","like_count":0,"discussions":[{"author":{"id":1071921,"avatar":"https://static001.geekbang.org/account/avatar/00/10/5b/31/b26b56bf.jpg","nickname":"Lever","note":"","ucode":"20C0D381677E1D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2040,"discussion_content":"ä¸æ˜¯ä¸€ä¸ªç²’åº¦çš„åŸå­ã€‚\n\né€šè¿‡é”å®ç°çš„è¿™äº›æ“ä½œï¼Œåªæ˜¯é”å®šäº†èµ„æºè®©åˆ«çš„çº¿ç¨‹æ— æ³•ä½¿ç”¨ï¼Œä»¥è¿™ä¸ªèµ„æºä¸ºæ ¸å¿ƒæ¥çœ‹ï¼Œæ‰€æœ‰å¯¹è¿™ä¸ªèµ„æºçš„æ“ä½œæ˜¯åŸå­çš„ï¼Œä¸å­˜åœ¨è¿™ä¸ªçº¿ç¨‹æ“ä½œä¸€åŠï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ç»§ç»­æ“ä½œã€‚ä½†æ˜¯ä»ä»£ç è¿è¡Œçš„è§’åº¦çœ‹ï¼ŒCPU åœ¨å¯¹è¿™ä¸ªåŠ é”çš„èµ„æºåšäº†ä¸€äº›æ“ä½œï¼Œä¹Ÿè®¸è¿™ä¸ª goroutine é‡Œçš„ä»£ç è¿˜æ²¡æ‰§è¡Œå®Œï¼Œå°±åˆ‡æ¢å»æ‰§è¡Œå¦ä¸€ä¸ªä¸è¯¥èµ„æºä¸ç›¸å¹²çš„ goroutine äº†ã€‚å› æ­¤ä»ç»“æœæ¥çœ‹å¯¹è¢«é”å®šèµ„æºçš„æ“ä½œæ˜¯åŸå­çš„ï¼Œä½†æ˜¯ä»è¿‡ç¨‹æ¥è®²æ˜¯ä¸åŸå­çš„ã€‚\n\nè€Œæœ¬èŠ‚æ‰€è®²çš„åŸå­æ“ä½œï¼Œæ˜¯åŸºäº CPU æä¾›çš„æ”¯æŒæ¥å®Œæˆçš„ï¼Œæ˜¯æ›´åŠ å¾®è§‚å±‚é¢çš„åŸå­æ“ä½œï¼Œæ•´ä¸ªæ“ä½œè¿‡ç¨‹éƒ½ä¸å¯åˆ†å‰²ï¼Œæ˜¯ä¸€ä¸ªå®Œæ•´çš„è¿‡ç¨‹ï¼Œå¯¹ CPU çš„æ—¶é—´ç‰‡æ˜¯ç‹¬å çš„ã€‚\n\n","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1563195821,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1113645,"avatar":"https://static001.geekbang.org/account/avatar/00/10/fe/2d/2c9177ca.jpg","nickname":"ç»™åŠ›","note":"","ucode":"646EE4AFC17224","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":216414,"discussion_content":"ä½ å¾—èµ·åç¨‹éªŒè¯ï¼Œä½ æœ¬ä¸Šå°±ä¸€ä¸ªä¸»åç¨‹çš„è¯ï¼Œå½“ç„¶ä¼šæ˜¯é¡ºåºæ‰§è¡Œï¼Œç»“æœå½“ç„¶ä¹Ÿæ˜¯ ä¸€æ ·çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585447663,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1198125,"avatar":"https://static001.geekbang.org/account/avatar/00/12/48/2d/7a3d42fb.jpg","nickname":"Alan","note":"","ucode":"9C66CBCFB3A109","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":126784,"discussion_content":"äº’æ–¥é”ä¸èƒ½ä¿è¯ä¸´ç•ŒåŒºå†…ä»£ç çš„åŸå­æ€§çš„æ„æ€æ˜¯æ˜¯æ— æ³•å¯¹ä¸´ç•ŒåŒºèµ„æºçš„ä¸€ç³»åˆ—æ“ä½œä¿è¯å…¨éƒ¨å®Œæˆæˆ–å…¨éƒ¨æœªåšã€‚å°±æ‹¿c.num += increment è¿™ä¸ªæ“ä½œæ¥è¯´ï¼Œæœ¬èº«ä¸æ˜¯åŸå­æ“ä½œï¼Œå¤§è‡´ä¸‰æ­¥ï¼š1å–å€¼ 2è¿ç®— 3èµ‹å€¼ã€‚è¿™ä¸ªè¿‡ç¨‹å¯¹äºcpuæ¥è¯´ä¸æ˜¯ä¸€ä¸ªæ“ä½œèƒ½å®Œæˆçš„äº‹ã€‚å‡å¦‚åˆ°ç¬¬äºŒæ­¥çš„æ—¶å€™ï¼Œåˆ‡äº†goroutineï¼Œè¿™æ—¶å€™å¹¶æ²¡æœ‰è¾¾åˆ°æˆ‘ä»¬æƒ³è¦çš„çŠ¶æ€å³è¿ç®—ä¹‹åçš„å€¼ã€‚å¦‚æœè¿˜æ˜¯ä¸èƒ½ç†è§£ï¼Œä½ æŠŠæ¯ä¸€æ­¥æƒ³æˆæ²¡æœ‰äº‹ç‰©çš„æ•°æ®åº“å†™å…¥æ“ä½œï¼Œå¦‚æœä¸­é—´çªç„¶æœåŠ¡å™¨å®•æœºï¼Œè¿™æ—¶å€™æ•°æ®åº“ä¼šä¿å­˜éƒ¨åˆ†å†™å…¥æ“ä½œï¼Œä½†æ˜¯è¿™ä¸æ˜¯æˆ‘ä»¬æœŸæœ›çš„ï¼Œä¸æˆ‘ä»¬æœŸæœ›çš„ä¸‰ä¸ªå†™å…¥æ“ä½œåŒæ—¶å®Œæˆæˆ–è€…æœªå®Œæˆä¸ä¸€è‡´ï¼Œè¿™å°±æ˜¯éåŸå­æ“ä½œï¼Œè¿™æ ·è®²å¸Œæœ›ä½ èƒ½ç†è§£ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578538173,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1052878,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/QKbgfE8mY91fjkLuyDKHUGlpfxKyhiaib5v3ic3YT6qrLibFWxoiaKCxzLeuJROiaWquCb0cNI0lCjiaDY92hSAKHsHUg/132","nickname":"ç½—ç½—","note":"","ucode":"410E21E5BAFD31","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1198125,"avatar":"https://static001.geekbang.org/account/avatar/00/12/48/2d/7a3d42fb.jpg","nickname":"Alan","note":"","ucode":"9C66CBCFB3A109","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":158915,"discussion_content":"ä»–é—®çš„æ˜¯ç»“æœä¸ºä»€ä¹ˆæ˜¯å¯¹çš„ï¼Œå¹¶ä¸æ˜¯ä¸çŸ¥é“c.num += increment è¿™ä¸ªæ“ä½œå¯ä»¥è¢«æ‹†åˆ†æˆä¸‰ä¸ªéƒ¨åˆ†ï¼Œä»–æƒ³çŸ¥é“ä¸ºä»€ä¹ˆåœ¨goroutineè¢«ä¸­æ–­çš„æƒ…å†µä¸‹ç»“æœè¿˜æ˜¯å¯¹çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580638321,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":126784,"ip_address":""},"score":158915,"extra":""},{"author":{"id":1198125,"avatar":"https://static001.geekbang.org/account/avatar/00/12/48/2d/7a3d42fb.jpg","nickname":"Alan","note":"","ucode":"9C66CBCFB3A109","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1052878,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/QKbgfE8mY91fjkLuyDKHUGlpfxKyhiaib5v3ic3YT6qrLibFWxoiaKCxzLeuJROiaWquCb0cNI0lCjiaDY92hSAKHsHUg/132","nickname":"ç½—ç½—","note":"","ucode":"410E21E5BAFD31","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":189510,"discussion_content":"ä¸­æ–­çš„ä½ç½®ä¸åœ¨å±é™©çš„åœ°æ–¹ï¼Œå‡ ç‡æ€§çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582889532,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":158915,"ip_address":""},"score":189510,"extra":""}]}]},{"had_liked":false,"id":39251,"user_name":"ç¿…è†€","can_delete":false,"product_type":"c1","uid":1142350,"ip_address":"","ucode":"F5169AD26A41B6","user_header":"https://static001.geekbang.org/account/avatar/00/11/6e/4e/034e2943.jpg","comment_is_top":false,"comment_ctime":1542239991,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542239991","product_id":100013101,"comment_content":"ç»•è¿‡éœ€è¦ä¸€ä¸ªä¸­é—´å˜é‡","like_count":0},{"had_liked":false,"id":37639,"user_name":"ä»»å°æ ·ğŸ‚","can_delete":false,"product_type":"c1","uid":1025660,"ip_address":"","ucode":"1CF0CF67AB970A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a6/7c/78de71b1.jpg","comment_is_top":false,"comment_ctime":1541663331,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1541663331","product_id":100013101,"comment_content":"æ¥¼ä¸Šçš„ï¼Œè®¤çœŸå®¡é¢˜ï¼Œå¯ä»¥ç»•è¿‡ã€‚ä½†æˆ‘çš„é—®é¢˜æ¥äº†ï¼Œè¿™ç®—BUGå˜›ï¼Ÿ","like_count":0},{"had_liked":false,"id":36751,"user_name":"MagicYang","can_delete":false,"product_type":"c1","uid":1210965,"ip_address":"","ucode":"BFD2C461EAF4EA","user_header":"https://static001.geekbang.org/account/avatar/00/12/7a/55/e805f157.jpg","comment_is_top":false,"comment_ctime":1541305726,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1541305726","product_id":100013101,"comment_content":"uint32(int32(-3)) è²Œä¼¼ç»•ä¸è¿‡","like_count":0},{"had_liked":false,"id":33040,"user_name":"Askerlve","can_delete":false,"product_type":"c1","uid":1178535,"ip_address":"","ucode":"BF29F9A8674507","user_header":"https://static001.geekbang.org/account/avatar/00/11/fb/a7/12c90699.jpg","comment_is_top":false,"comment_ctime":1539740912,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1539740912","product_id":100013101,"comment_content":"goå…¥é—¨èœé¸Ÿï¼Œæ„Ÿæ¿€æœ‰è¿™ä¹ˆä¸€ä¸ªä¸“æ ï¼Œå­¦å®Œå°±å¯ä»¥ä¹°ä¸€æœ¬goå¹¶å‘ç¼–ç¨‹æ¥æ’¸äº†~ğŸ˜€","like_count":0}]}