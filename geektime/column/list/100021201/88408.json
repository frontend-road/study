{"id":88408,"title":"46 | ç¼“å­˜ç³»ç»Ÿï¼šå¦‚ä½•é€šè¿‡å“ˆå¸Œè¡¨å’Œé˜Ÿåˆ—å®ç°é«˜æ•ˆè®¿é—®ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é»„ç”³ã€‚</p><p>ç»è¿‡å‰ä¸‰å¤§æ¨¡å—çš„å­¦ä¹ ï¼Œæˆ‘å¸¦ä½ çºµè§ˆäº†æ•°å­¦åœ¨å„ä¸ªè®¡ç®—æœºç¼–ç¨‹é¢†åŸŸçš„é‡è¦åº”ç”¨ã€‚ç¦»æ•£æ•°å­¦æ˜¯åŸºç¡€æ•°æ®ç»“æ„å’Œç¼–ç¨‹ç®—æ³•çš„åŸºçŸ³ï¼Œè€Œæ¦‚ç‡ç»Ÿè®¡è®ºå’Œçº¿æ€§ä»£æ•°ï¼Œæ˜¯å¾ˆå¤šä¿¡æ¯æ£€ç´¢å’Œæœºå™¨å­¦ä¹ ç®—æ³•çš„æ ¸å¿ƒã€‚</p><p>å› æ­¤ï¼Œä»Šå¤©å¼€å§‹ï¼Œæˆ‘ä¼šç»¼åˆæ€§åœ°è¿ç”¨ä¹‹å‰æ‰€è®²è§£çš„ä¸€äº›çŸ¥è¯†ï¼Œè®¾è®¡å¹¶å®ç°ä¸€äº›æ›´æœ‰å®ç”¨æ€§çš„æ ¸å¿ƒæ¨¡å—æˆ–è€…åŸå‹ç³»ç»Ÿã€‚é€šè¿‡è¿™ç§åŸºäºæ¡ˆä¾‹çš„è®²è§£ï¼Œæˆ‘ä»¬å¯ä»¥èä¼šè´¯é€šä¸åŒçš„æ•°å­¦çŸ¥è¯†ï¼Œå¹¶æ‰“é€ æ›´åŠ é«˜æ•ˆã€æ›´åŠ æ™ºèƒ½çš„è®¡ç®—æœºç³»ç»Ÿã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä»ä¸€ä¸ªç¼“å­˜ç³»ç»Ÿå…¥æ‰‹ï¼Œå¼€å§‹ç»¼åˆåº”ç”¨ç¯‡çš„å­¦ä¹ ã€‚</p><h2>ä»€ä¹ˆæ˜¯ç¼“å­˜ç³»ç»Ÿï¼Ÿ</h2><p>ç¼“å­˜ï¼ˆCacheï¼‰æ˜¯è®¡ç®—æœºç³»ç»Ÿé‡Œéå¸¸é‡è¦çš„å‘æ˜ä¹‹ä¸€ï¼Œå®ƒåœ¨ç¼–ç¨‹é¢†åŸŸä¸­æœ‰éå¸¸éå¸¸å¤šçš„åº”ç”¨ã€‚å°åˆ°ç”µè„‘çš„ä¸­å¤®å¤„ç†å™¨ï¼ˆCPUï¼‰ã€ä¸»æ¿ã€æ˜¾å¡ç­‰ç¡¬ä»¶ï¼Œå¤§åˆ°å¤§è§„æ¨¡çš„äº’è”ç½‘ç«™ç‚¹ï¼Œéƒ½åœ¨å¹¿æ³›ä½¿ç”¨ç¼“å­˜æ¥æå‡é€Ÿåº¦ã€‚è€Œåœ¨ç½‘ç«™çš„æ¶æ„è®¾è®¡ä¸­ï¼Œä¸€èˆ¬ä¸ä¼šåƒPCç”µè„‘é‚£æ ·é‡‡ç”¨é«˜é€Ÿçš„ç¼“å­˜ä»‹è´¨ï¼Œè€Œæ˜¯é‡‡ç”¨æ™®é€šçš„æœåŠ¡å™¨å†…å­˜ã€‚ä½†æ˜¯ç½‘ç«™æ¶æ„æ‰€ä½¿ç”¨çš„å†…å­˜å®¹é‡å¤§å¾—å¤šï¼Œè‡³å°‘æ˜¯æ•°ä¸ªå‰å­—èŠ‚ ï¼ˆGBï¼‰ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æŠŠç¼“å­˜å®šä¹‰ä¸ºæ•°æ®äº¤æ¢çš„ç¼“å†²åŒºã€‚å®ƒçš„è¯»å–é€Ÿåº¦è¿œè¿œé«˜äºæ™®é€šå­˜å‚¨ä»‹è´¨ï¼Œå¯ä»¥å¸®åŠ©ç³»ç»Ÿæ›´å¿«åœ°è¿è¡Œã€‚å½“æŸä¸ªåº”ç”¨éœ€è¦è¯»å–æ•°æ®æ—¶ï¼Œä¼šä¼˜å…ˆä»ç¼“å­˜ä¸­æŸ¥æ‰¾éœ€è¦çš„å†…å®¹ï¼Œå¦‚æœæ‰¾åˆ°äº†åˆ™ç›´æ¥è·å–ï¼Œè¿™ä¸ªæ•ˆç‡è¦æ¯”è¯»å–æ™®é€šå­˜å‚¨æ›´é«˜ã€‚å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰å‘ç°éœ€è¦çš„å†…å®¹ï¼Œå†åˆ°æ™®é€šå­˜å‚¨ä¸­å¯»æ‰¾ã€‚</p><!-- [[[read_end]]] --><p>ç†è§£äº†ç¼“å­˜çš„æ¦‚å¿µå’Œé‡è¦æ€§ä¹‹åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ç¼“å­˜è®¾è®¡çš„å‡ ä¸ªä¸»è¦è€ƒé‡å› ç´ ã€‚</p><p>ç¬¬ä¸€ä¸ªå› ç´ æ˜¯<strong>ç¡¬ä»¶çš„æ€§èƒ½</strong>ã€‚ç¼“å­˜çš„åº”ç”¨åœºæ™¯éå¸¸å¹¿æ³›ï¼Œå› æ­¤æ²¡æœ‰ç»å¯¹çš„æ¡ä»¶æ¥å®šä¹‰ä½•ç§æ€§èƒ½å¯ä»¥è¾¾åˆ°ç¼“å­˜çš„èµ„æ ¼ï¼Œæˆ‘ä»¬åªè¦ç¡®ä¿ä»¥é«˜é€Ÿè¯»å–ä»‹è´¨å¯ä»¥å……å½“ç›¸å¯¹ä½é€Ÿçš„ä»‹è´¨çš„ç¼“å†²ã€‚</p><p>ç¬¬äºŒä¸ªå› ç´ æ˜¯<strong>å‘½ä¸­ç‡</strong>ã€‚ç¼“å­˜ä¹‹æ‰€ä»¥èƒ½æå‡è®¿é—®é€Ÿåº¦ï¼Œä¸»è¦æ˜¯å› ä¸ºèƒ½ä»é«˜é€Ÿä»‹è´¨è¯»å–ï¼Œè¿™ç§æƒ…å†µæˆ‘ä»¬ç§°ä¸ºâ€œå‘½ä¸­â€ï¼ˆHitï¼‰ã€‚ä½†æ˜¯ï¼Œé«˜é€Ÿä»‹è´¨çš„æˆæœ¬æ˜¯éå¸¸æ˜‚è´µçš„ï¼Œè€Œä¸”ä¸€èˆ¬ä¹Ÿä¸æ”¯æŒæŒä¹…åŒ–å­˜å‚¨ï¼Œå› æ­¤æ”¾å…¥æ•°æ®çš„å®¹é‡å¿…é¡»å—åˆ°é™åˆ¶ï¼Œåªèƒ½æ˜¯å…¨å±€ä¿¡æ¯çš„ä¸€éƒ¨åˆ†ã€‚é‚£ä¹ˆï¼Œä¸€å®šæ˜¯æœ‰éƒ¨åˆ†æ•°æ®æ— æ³•åœ¨ç¼“å­˜ä¸­è¯»å–ï¼Œè€Œå¿…é¡»è¦åˆ°åŸå§‹çš„å­˜å‚¨ä¸­æŸ¥æ‰¾ï¼Œè¿™ç§æƒ…å†µç§°ä¹‹ä¸ºâ€œé”™è¿‡â€ï¼ˆMissedï¼‰ã€‚</p><p>æˆ‘ä»¬é€šå¸¸ä½¿ç”¨èƒ½å¤Ÿåœ¨ç¼“å­˜ä¸­æŸ¥æ‰¾åˆ°æ•°æ®çš„æ¬¡æ•°ï¼ˆ$|H|$ï¼‰ï¼Œé™¤ä»¥æ•´ä½“çš„æ•°æ®è®¿é—®æ¬¡æ•°ï¼ˆ$|V|$ï¼‰è®¡ç®—å‘½ä¸­ç‡ã€‚å¦‚æœå‘½ä¸­ç‡é«˜ï¼Œç³»ç»Ÿèƒ½å¤Ÿé¢‘ç¹åœ°è·å–å·²ç»åœ¨ç¼“å­˜ä¸­é©»ç•™çš„æ•°æ®ï¼Œé€Ÿåº¦ä¼šæ˜æ˜¾æå‡ã€‚</p><center>$HitRatio=\\frac{|H|}{|V|}$</center><p>æ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯ï¼Œå¦‚ä½•åœ¨ç¼“å­˜å®¹é‡æœ‰é™çš„æƒ…å†µä¸‹ï¼Œå°½å¯èƒ½çš„æå‡å‘½ä¸­ç‡å‘¢ï¼Ÿäººä»¬å¼€å§‹ç ”ç©¶ç¼“å­˜çš„æ·˜æ±°ç®—æ³•ï¼Œé€šè¿‡æŸç§æœºåˆ¶å°†ç¼“å­˜ä¸­å¯èƒ½æ— ç”¨çš„æ•°æ®å‰”é™¤ï¼Œç„¶åå‘å‰”é™¤åç©ºä½™çš„ç©ºé—´ä¸­è¡¥å……å°†æ¥å¯èƒ½ä¼šè®¿é—®çš„æ•°æ®ã€‚</p><p>æœ€åŸºæœ¬çš„ç­–ç•¥åŒ…æ‹¬æœ€å°‘ä½¿ç”¨LFUï¼ˆLeast Frequently Usedï¼‰ç­–ç•¥å’Œæœ€ä¹…æœªç”¨LRUï¼ˆLeast Recently Usedï¼‰ç­–ç•¥ã€‚LFUä¼šè®°å½•æ¯ä¸ªç¼“å­˜å¯¹è±¡è¢«ä½¿ç”¨çš„é¢‘ç‡ï¼Œå¹¶å°†ä½¿ç”¨æ¬¡æ•°æœ€å°‘çš„å¯¹è±¡å‰”é™¤ã€‚LRUä¼šè®°å½•æ¯ä¸ªç¼“å­˜å¯¹è±¡æœ€è¿‘ä½¿ç”¨çš„æ—¶é—´ï¼Œå¹¶å°†ä½¿ç”¨æ—¶é—´ç‚¹æœ€ä¹…è¿œçš„å¯¹è±¡ç»™å‰”é™¤ã€‚å¾ˆæ˜¾ç„¶ï¼Œæˆ‘ä»¬éƒ½å¸Œæœ›ç¼“å­˜çš„å‘½ä¸­ç‡è¶Šé«˜è¶Šå¥½ã€‚</p><p>ç¬¬ä¸‰ä¸ªå› ç´ æ˜¯<strong>æ›´æ–°å‘¨æœŸ</strong>ã€‚è™½ç„¶ç¼“å­˜å¤„ç†çš„æ•ˆç‡éå¸¸é«˜ï¼Œä½†æ˜¯ï¼Œè¢«è®¿é—®çš„æ•°æ®ä¸ä¼šä¸€æˆä¸å˜ï¼Œå¯¹äºå˜åŒ–é€Ÿåº¦å¾ˆå¿«çš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦å°†å˜åŠ¨ä¸»åŠ¨æ›´æ–°åˆ°ç¼“å­˜ä¸­ï¼Œæˆ–è€…è®©åŸæœ‰å†…å®¹å¤±æ•ˆï¼Œå¦åˆ™ç”¨æˆ·å°†è¯»å–åˆ°è¿‡æ—¶çš„å†…å®¹ã€‚åœ¨æ— æ³•åŠæ—¶æ›´æ–°æ•°æ®çš„æƒ…å†µä¸‹ï¼Œé«˜å‘½ä¸­ç‡åè€Œå˜æˆäº†åäº‹ï¼Œè½»åˆ™å½±å“ç”¨æˆ·äº¤äº’çš„ä½“éªŒï¼Œé‡åˆ™ä¼šå¯¼è‡´åº”ç”¨é€»è¾‘çš„é”™è¯¯ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿ä½ çš„ç†è§£ï¼Œæˆ‘ä½¿ç”¨ä¸‹é¢è¿™å¼ å›¾ï¼Œæ¥å±•ç°è¿™å‡ ä¸ªä¸»è¦å› ç´ ä¹‹é—´çš„å…³ç³»ï¼Œä»¥åŠç¼“å­˜ç³»ç»Ÿçš„å·¥ä½œæµç¨‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d9/5b/d92decec85a79493f9ef1f87f3add05b.png?wh=1138*1024\" alt=\"\"></p><p></p><h2>å¦‚ä½•è®¾è®¡ä¸€ä¸ªç¼“å­˜ç³»ç»Ÿï¼Ÿ</h2><p>äº†è§£è¿™äº›åŸºæœ¬æ¦‚å¿µä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹è®¾è®¡è‡ªå·±çš„ç¼“å­˜ç³»ç»Ÿäº†ã€‚ä»Šå¤©ï¼Œæˆ‘é‡ç‚¹è®²è§£å¦‚ä½•ä½¿ç”¨å“ˆå¸Œè¡¨å’Œé˜Ÿåˆ—ï¼Œæ¥è®¾è®¡ä¸€ä¸ªåŸºäºæœ€ä¹…æœªç”¨LRUç­–ç•¥çš„ç¼“å­˜ã€‚</p><p>ä»ç¼“å­˜ç³»ç»Ÿçš„å·¥ä½œæµç¨‹å¯ä»¥çœ‹å‡ºï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦ç¡®è®¤æŸä¸ªè¢«è¯·æ±‚çš„æ•°æ®ï¼Œæ˜¯ä¸æ˜¯å­˜åœ¨äºç¼“å­˜ç³»ç»Ÿä¸­ã€‚å¯¹äºè¿™ä¸ªåŠŸèƒ½ï¼Œå“ˆå¸Œè¡¨æ˜¯éå¸¸é€‚åˆçš„ã€‚ç¬¬2è®²æˆ‘è®²è¿‡å“ˆå¸Œçš„æ¦‚å¿µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å“ˆå¸Œå€¼è®¡ç®—å¿«é€Ÿå®šä½ï¼ŒåŠ å¿«æŸ¥æ‰¾çš„é€Ÿåº¦ã€‚ä¸è®ºå“ˆå¸Œè¡¨ä¸­æœ‰å¤šå°‘æ•°æ®ï¼Œè¯»å–ã€æ’å…¥å’Œåˆ é™¤æ“ä½œåªéœ€è¦è€—è´¹æ¥è¿‘å¸¸é‡çš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯O (1)çš„æ—¶é—´å¤æ‚åº¦ ï¼Œè¿™æ­£å¥½æ»¡è¶³äº†ç¼“å­˜é«˜é€Ÿè¿ä½œçš„éœ€æ±‚ã€‚</p><p>åœ¨ç¬¬18è®²ï¼Œæˆ‘è®²äº†ç”¨æ•°ç»„å’Œé“¾è¡¨æ¥æ„é€ å“ˆå¸Œè¡¨ã€‚åœ¨å¾ˆå¤šç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå“ˆå¸Œè¡¨çš„å®ç°é‡‡ç”¨çš„æ˜¯é“¾åœ°å€å“ˆå¸Œè¡¨ã€‚è¿™ç§æ–¹æ³•çš„ä¸»è¦æ€æƒ³æ˜¯ï¼Œå…ˆåˆ†é…ä¸€ä¸ªå¾ˆå¤§çš„æ•°ç»„ç©ºé—´ï¼Œè€Œæ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªé“¾è¡¨çš„å¤´éƒ¨ã€‚éšåï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®å“ˆå¸Œå‡½æ•°ç®—å‡ºçš„å“ˆå¸Œå€¼ï¼ˆä¹Ÿå«å“ˆå¸Œçš„keyï¼‰ï¼Œæ‰¾åˆ°æ•°ç»„çš„æŸä¸ªå…ƒç´ åŠå¯¹åº”çš„é“¾è¡¨ï¼Œç„¶åæŠŠæ•°æ®æ·»åŠ åˆ°è¿™ä¸ªé“¾è¡¨ä¸­ã€‚ä¹‹æ‰€ä»¥è¦è¿™æ ·è®¾è®¡ï¼Œæ˜¯å› ä¸ºå­˜åœ¨å“ˆå¸Œå†²çªã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦å°½é‡æ‰¾åˆ°ä¸€ä¸ªåˆç†çš„å“ˆå¸Œå‡½æ•°ï¼Œå‡å°‘å†²çªå‘ç”Ÿçš„æœºä¼šï¼Œæå‡æ£€ç´¢çš„æ•ˆç‡ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥èŠèŠç¼“å­˜æ·˜æ±°çš„ç­–ç•¥ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨LRUæœ€ä¹…æœªç”¨ç­–ç•¥ã€‚åœ¨è¿™ç§ç­–ç•¥ä¸­ï¼Œç³»ç»Ÿä¼šæ ¹æ®æ•°æ®æœ€è¿‘ä¸€æ¬¡çš„ä½¿ç”¨æ—¶é—´æ¥æ’åºï¼Œä½¿ç”¨æ—¶é—´æœ€ä¹…è¿œçš„å¯¹è±¡ä¼šè¢«æ·˜æ±°ã€‚è€ƒè™‘åˆ°è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨é˜Ÿåˆ—ã€‚æˆ‘åœ¨è®²è§£å¹¿åº¦ä¼˜å…ˆæœç´¢ç­–ç•¥æ—¶ï¼Œè°ˆåˆ°äº†é˜Ÿåˆ—ã€‚è¿™æ˜¯ä¸€ç§å…ˆè¿›å…ˆå‡ºçš„æ•°æ®ç»“æ„ï¼Œå…ˆè¿›å…¥é˜Ÿåˆ—çš„å…ƒç´ ä¼šä¼˜å…ˆå¾—åˆ°å¤„ç†ã€‚å¦‚æœå……åˆ†åˆ©ç”¨é˜Ÿåˆ—çš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬å°±å¾ˆå®¹æ˜“æ‰¾åˆ°ä¸Šä¸€æ¬¡ä½¿ç”¨æ—¶é—´æœ€ä¹…çš„æ•°æ®ï¼Œå…·ä½“çš„å®ç°è¿‡ç¨‹å¦‚ä¸‹ã€‚</p><p>ç¬¬ä¸€ï¼Œæ ¹æ®ç¼“å­˜çš„å¤§å°ï¼Œè®¾ç½®é˜Ÿåˆ—çš„æœ€å¤§å€¼ã€‚é€šå¸¸çš„åšæ³•æ˜¯ä½¿ç”¨ç¼“å­˜é‡Œæ‰€èƒ½å­˜æ”¾æ•°æ®è®°å½•é‡çš„ä¸Šé™ï¼Œä½œä¸ºé˜Ÿåˆ—é‡Œç»“ç‚¹çš„æ€»æ•°çš„ä¸Šé™ï¼Œä¸¤è€…ä¿æŒä¸€è‡´ã€‚</p><p>ç¬¬äºŒï¼Œæ¯æ¬¡è®¿é—®ä¸€ä¸ªæ•°æ®åï¼ŒæŸ¥çœ‹æ˜¯ä¸æ˜¯å·²ç»å­˜åœ¨ä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„ç»“ç‚¹å¯¹åº”äºè¿™ä¸ªæ•°æ®ã€‚å¦‚æœä¸æ˜¯ï¼Œåˆ›é€ ä¸€ä¸ªå¯¹åº”äºè¿™ä¸ªæ•°æ®çš„é˜Ÿåˆ—ç»“ç‚¹ï¼ŒåŠ å…¥é˜Ÿåˆ—å°¾éƒ¨ã€‚å¦‚æœæ˜¯ï¼ŒæŠŠè¿™ä¸ªæ•°æ®æ‰€å¯¹åº”çš„é˜Ÿåˆ—ç»“ç‚¹é‡æ–°æ”¾å…¥é˜Ÿåˆ—çš„å°¾éƒ¨ã€‚éœ€è¦æ³¨æ„ï¼Œè¿™ä¸€ç‚¹æ˜¯è‡³å…³é‡è¦çš„ã€‚å› ä¸ºè¿™ç§æ“ä½œå¯ä»¥ä¿è¯ä¸Šä¸€æ¬¡è®¿é—®æ—¶é—´æœ€ä¹…çš„æ•°æ®ï¼Œæ‰€å¯¹åº”çš„ç»“ç‚¹æ°¸è¿œåœ¨é˜Ÿåˆ—çš„å¤´éƒ¨ã€‚</p><p>ç¬¬ä¸‰ï¼Œå¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œæˆ‘ä»¬å°±éœ€è¦æ·˜æ±°ä¸€äº›ç¼“å­˜ä¸­çš„æ•°æ®ã€‚ç”±äºé˜Ÿåˆ—é‡Œçš„ç»“ç‚¹å’Œç¼“å­˜ä¸­çš„æ•°æ®è®°å½•é‡æ˜¯ä¸€è‡´çš„ï¼Œæ‰€ä»¥é˜Ÿåˆ—é‡Œçš„ç»“ç‚¹æ•°è¾¾åˆ°ä¸Šé™å€¼ï¼Œä¹Ÿå°±æ„å‘³ç€ç¼“å­˜ä¹Ÿå·²ç»æ»¡äº†ã€‚åˆšåˆšæåˆ°ï¼Œç”±äºç¬¬äºŒç‚¹çš„æ“ä½œï¼Œæˆ‘ä»¬åªéœ€è¦ç§»é™¤é˜Ÿåˆ—å¤´éƒ¨çš„ç»“ç‚¹å°±å¯ä»¥äº†ã€‚</p><p>ç»¼åˆä¸Šè¿°å…³äºå“ˆå¸Œè¡¨å’Œé˜Ÿåˆ—çš„è®¨è®ºï¼Œæˆ‘ä»¬å¯ä»¥ç”»å‡ºä¸‹é¢è¿™å¼ æ¡†æ¶å›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/2a/28/2a74d2c598a2aa9952b70e350c49f828.png?wh=1448*1040\" alt=\"\"></p><p>ä»è¿™å¼ å›¾å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä½¿ç”¨å“ˆå¸Œè¡¨æ¥å­˜æ”¾éœ€è¦è¢«ç¼“å­˜çš„å†…å®¹ï¼Œç„¶åä½¿ç”¨é˜Ÿåˆ—æ¥å®ç°LRUç­–ç•¥ã€‚æ¯å½“æ•°æ®è¯·æ±‚è¿›æ¥çš„æ—¶å€™ï¼Œç¼“å­˜ç³»ç»Ÿé¦–å…ˆæ£€æŸ¥æ•°æ®è®°å½•æ˜¯ä¸æ˜¯å·²ç»å­˜åœ¨å“ˆå¸Œè¡¨ä¸­ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå°±è¿”å›æ²¡æœ‰æŸ¥æ‰¾åˆ°ï¼Œä¸ä¼šå¯¹å“ˆå¸Œè¡¨å’Œé˜Ÿåˆ—è¿›è¡Œä»»ä½•çš„æ”¹å˜ï¼›å¦‚æœå·²ç»å­˜åœ¨ï¼Œå°±ç›´æ¥ä»å“ˆå¸Œè¡¨è¯»å–å¹¶è¿”å›ã€‚</p><p>ä¸æ­¤åŒæ—¶ï¼Œåœ¨é˜Ÿåˆ—ä¸­è¿›è¡Œç›¸åº”çš„æ“ä½œï¼Œæ ‡è®°å¯¹åº”è®°å½•æœ€åè®¿é—®çš„æ¬¡åºã€‚é˜Ÿåˆ—å¤´éƒ¨çš„ç»“ç‚¹ï¼Œå¯¹åº”å³å°†è¢«æ·˜æ±°çš„è®°å½•ã€‚å¦‚æœç¼“å­˜æˆ–è€…è¯´é˜Ÿåˆ—å·²æ»¡ï¼Œè€Œæˆ‘ä»¬åˆéœ€è¦æ’å…¥æ–°çš„ç¼“å­˜æ•°æ®ï¼Œé‚£ä¹ˆå°±éœ€è¦ç§»é™¤é˜Ÿåˆ—å¤´éƒ¨çš„ç»“ç‚¹ï¼Œä»¥åŠå®ƒæ‰€å¯¹åº”çš„å“ˆå¸Œè¡¨ç»“ç‚¹ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç»“åˆè¿™å¼ å›¾ï¼Œä»¥è¯·æ±‚æ•°æ®è®°å½•175ä¸ºä¾‹ï¼Œè¯¦ç»†çœ‹çœ‹åœ¨è¿™ä¸ªæ¡†æ¶ä¸­ï¼Œæ¯ä¸€æ­¥æ˜¯å¦‚ä½•è¿ä½œçš„ã€‚</p><p>è¿™é‡Œçš„å“ˆå¸Œè¡¨æ‰€ä½¿ç”¨çš„æ•£åˆ—å‡½æ•°éå¸¸ç®€å•ï¼Œæ˜¯æŠŠæ•°æ®çš„æ‰€æœ‰ä½æ•°åŠ èµ·æ¥ï¼Œå†å¯¹ä¸€ä¸ªéå¸¸å¤§çš„æ•°å€¼ä¾‹å¦‚10^6æ±‚ä½™ã€‚é‚£ä¹ˆï¼Œ175çš„å“ˆå¸Œå€¼å°±æ˜¯(1+7+5)/10^6=13ã€‚é€šè¿‡å“ˆå¸Œå€¼13æ‰¾åˆ°å¯¹åº”çš„é“¾è¡¨ï¼Œç„¶åè¿›è¡Œéå†æ‰¾åˆ°è®°å½•175ã€‚è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å·²ç»å®Œæˆäº†ä»ç¼“å­˜ä¸­è·å–æ•°æ®ã€‚</p><p>ä¸è¿‡ï¼Œç”±äºä½¿ç”¨äº†LRUç­–ç•¥æ¥æ·˜æ±°æ—§çš„æ•°æ®ï¼Œæ‰€ä»¥è¿˜éœ€è¦å¯¹ä¿å­˜è®¿é—®çŠ¶æ€çš„é˜Ÿåˆ—è¿›è¡Œå¿…è¦çš„æ“ä½œã€‚æ£€æŸ¥é˜Ÿåˆ—ï¼Œæˆ‘ä»¬å‘ç°è¡¨ç¤º175çš„ç»“ç‚¹å·²ç»åœ¨é˜Ÿåˆ—ä¹‹ä¸­äº†ï¼Œè¯´æ˜æœ€è¿‘è¿™æ¡æ•°æ®å·²ç»è¢«è®¿é—®è¿‡ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æŠŠè¿™ä¸ªç»“ç‚¹æŒªåˆ°é˜Ÿåˆ—çš„æœ€åï¼Œè®©å®ƒè¿œç¦»è¢«æ·˜æ±°çš„å‘½è¿ã€‚</p><p>æˆ‘ä»¬å†æ¥çœ‹å¦ä¸€ä¸ªä¾‹å­ï¼Œå‡è®¾è¿™æ¬¡éœ€è¦è·å–çš„æ˜¯æ•°æ®è®°å½•1228ï¼Œè¿™æ¡è®°å½•å¹¶ä¸åœ¨ç¼“å­˜ä¹‹ä¸­ï¼Œå› æ­¤é™¤äº†ä»ä½é€Ÿä»‹è´¨è¿”å›è·å–çš„è®°å½•ï¼Œæˆ‘ä»¬è¿˜è¦æŠŠè¿™ä¸ªæ•°æ®è®°å½•æ”¾å…¥ç¼“å­˜åŒºï¼Œå¹¶æ›´æ–°ä¿å­˜è®¿é—®çŠ¶æ€çš„é˜Ÿåˆ—ã€‚å’Œè®°å½•175ä¸åŒçš„æ˜¯ï¼Œ1228æœ€è¿‘æ²¡æœ‰è¢«è®¿é—®è¿‡ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨é˜Ÿåˆ—çš„æœ«å°¾å¢åŠ ä¸€ä¸ªè¡¨ç¤º1201çš„ç»“ç‚¹ã€‚è¿™ä¸ªæ—¶å€™ï¼Œé˜Ÿåˆ—å·²ç»æ»¡äº†ï¼Œæˆ‘ä»¬éœ€è¦è®©é˜Ÿåˆ—å¤´éƒ¨çš„ç»“ç‚¹73å‡ºé˜Ÿï¼Œç„¶åæŠŠç›¸åº”çš„è®°å½•73ä»å“ˆå¸Œè¡¨ä¸­åˆ é™¤ï¼Œæœ€åæŠŠè®°å½•1228æ’å…¥åˆ°å“ˆå¸Œè¡¨ä¸­ä½œä¸ºç¼“å­˜ã€‚</p><h2>æ€»ç»“</h2><p>å½“ä»Šçš„è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œç¼“å­˜æ‰®æ¼”ç€éå¸¸é‡è¦çš„è§’è‰²ï¼Œå°åˆ°CPUï¼Œå¤§åˆ°äº’è”ç½‘ç«™ç‚¹ï¼Œæˆ‘ä»¬éƒ½éœ€è¦ä½¿ç”¨ç¼“å­˜æ¥æå‡ç³»ç»Ÿæ€§èƒ½ã€‚åŸºäºå“ˆå¸Œçš„æ•°æ®ç»“æ„å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿçš„è·å–æ•°æ®ï¼Œæ‰€ä»¥éå¸¸é€‚åˆè¿ç”¨åœ¨ç¼“å­˜ç³»ç»Ÿä¹‹ä¸­ã€‚</p><p>ä¸è¿‡ï¼Œç¼“å­˜éƒ½éœ€è¦ç›¸å¯¹æ˜‚è´µçš„ç¡¬ä»¶æ¥å®ç°ï¼Œå› æ­¤å¤§å°å—åˆ°é™åˆ¶ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸åŒçš„ç­–ç•¥æ¥æ·˜æ±°ä¸ç»å¸¸ä½¿ç”¨çš„å†…å®¹ï¼Œå–è€Œä»£ä¹‹ä¸€äº›æ›´æœ‰å¯èƒ½è¢«ä½¿ç”¨çš„å†…å®¹ï¼Œå¢åŠ ç¼“å­˜çš„å‘½ä¸­ç‡ï¼Œè¿›è€Œæå‡ç¼“å­˜çš„ä½¿ç”¨æ•ˆæœã€‚ä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡ï¼Œäººä»¬æå‡ºäº†å¤šç§æ·˜æ±°çš„ç­–ç•¥ï¼ŒåŒ…æ‹¬LRUå’ŒLFUã€‚</p><p>ç»¼åˆä¸Šé¢ä¸¤ç‚¹ï¼Œæˆ‘ä»¬æå‡ºä¸€ç§ç»“åˆå“ˆå¸Œè¡¨å’Œé˜Ÿåˆ—çš„ç¼“å­˜è®¾è®¡æ–¹æ¡ˆã€‚å“ˆå¸Œè¡¨è´Ÿè´£å¿«é€Ÿçš„å­˜å‚¨å’Œæ›´æ–°è¢«ç¼“å­˜çš„å†…å®¹ï¼Œè€Œé˜Ÿåˆ—è´Ÿè´£ç®¡ç†æœ€è¿‘è¢«è®¿é—®çš„çŠ¶æ€ï¼Œå¹¶å‘ŠçŸ¥ç³»ç»Ÿå“ªäº›æ•°æ®æ˜¯è¦è¢«æ·˜æ±°å¹¶ä»å“ˆå¸Œè¡¨ä¸­ç§»é™¤ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>è¯·æ ¹æ®ä»Šå¤©æ‰€è®²è§£çš„è®¾è®¡æ€æƒ³ï¼Œå°è¯•ç¼–ç å®ç°ä¸€ä¸ªåŸºäºLRUæ·˜æ±°ç­–ç•¥çš„ç¼“å­˜ã€‚å“ˆå¸Œè¡¨éƒ¨åˆ†å¯ä»¥ç›´æ¥ä½¿ç”¨ç¼–ç¨‹è¯­è¨€æ‰€æä¾›çš„å“ˆå¸Œç±»æ•°æ®ç»“æ„ã€‚</p><p>æ¬¢è¿ç•™è¨€å’Œæˆ‘åˆ†äº«ï¼Œä¹Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºå†™ä¸‹ä»Šå¤©çš„å­¦ä¹ ç¬”è®°ã€‚ä½ å¯ä»¥ç‚¹å‡»â€œè¯·æœ‹å‹è¯»â€ï¼ŒæŠŠä»Šå¤©çš„å†…å®¹åˆ†äº«ç»™ä½ çš„å¥½å‹ï¼Œå’Œä»–ä¸€èµ·ç²¾è¿›ã€‚</p>","comments":[{"had_liked":false,"id":82802,"user_name":"é“ä¸‘-ç‹ç«‹ä¸°","can_delete":false,"product_type":"c1","uid":1021228,"ip_address":"","ucode":"F0CFDA492F164A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/95/2c/f254f684.jpg","comment_is_top":false,"comment_ctime":1554313175,"is_pvip":false,"replies":[{"id":"29992","content":"èåˆçš„æ¦‚å¿µå¾ˆæ–°é¢–ï¼Œä»£ç å¯è¯»æ€§ä¼šå¼±ä¸€ç‚¹ï¼Œä½†æ˜¯æ•ˆç‡å¾ˆé«˜ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"é»„ç”³","uid":"1275061","ctime":1554396409,"ip_address":"","comment_id":82802,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18734182359","product_id":100021201,"comment_content":"å—¯å—¯ï¼Œæˆ‘ä¸‹åˆä¹Ÿåœ¨æƒ³ï¼Œè¿™ä¸ªé˜Ÿåˆ—åº”è¯¥æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œè€Œä¸”æ–°åŠ çš„å“ˆå¸Œè¡¨å¯èƒ½è¿˜è¦è§£å†³é˜Ÿåˆ—èŠ‚ç‚¹çš„å†²çªé—®é¢˜ã€‚è®¾è®¡çš„å†å¤æ‚ä¸€ç‚¹è¿™ä¸ªç»“æ„åº”è¯¥èƒ½å¤Ÿå’ŒåŸæœ‰çš„é‚£å¼ ç¼“å­˜å“ˆå¸Œè¡¨èåˆã€‚è¿™æ ·è¿˜èƒ½èŠ‚çœå†…å­˜ã€‚","like_count":4,"discussions":[{"author":{"id":1275061,"avatar":"https://static001.geekbang.org/account/avatar/00/13/74/b5/b68e3740.jpg","nickname":"é»„ç”³","note":"","ucode":"EE9AC074A322FF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445726,"discussion_content":"èåˆçš„æ¦‚å¿µå¾ˆæ–°é¢–ï¼Œä»£ç å¯è¯»æ€§ä¼šå¼±ä¸€ç‚¹ï¼Œä½†æ˜¯æ•ˆç‡å¾ˆé«˜ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554396409,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":82639,"user_name":"é“ä¸‘-ç‹ç«‹ä¸°","can_delete":false,"product_type":"c1","uid":1021228,"ip_address":"","ucode":"F0CFDA492F164A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/95/2c/f254f684.jpg","comment_is_top":false,"comment_ctime":1554266550,"is_pvip":false,"replies":[{"id":"29913","content":"è¿™æ˜¯ä¸ªå¥½é—®é¢˜ï¼Œæ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å‡è®¾å“ˆå¸Œè¡¨å’Œé˜Ÿåˆ—é‡Œçš„æ•°æ®ä¸€è‡´ï¼Œé™¤éå‘ç”Ÿäº†å¼‚å¸¸ã€‚<br>å¦‚æœæ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨é“¾è¡¨æ¥å®ç°é˜Ÿåˆ—ï¼Œç„¶åä½¿ç”¨å“ˆå¸Œè¡¨å­˜å‚¨æ¯ä¸ªè¢«ç¼“å­˜ç»“æœæ‰€å¯¹åº”çš„é˜Ÿåˆ—ç»“ç‚¹ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥å¿«é€Ÿè®¿é—®é˜Ÿåˆ—çš„ç»“ç‚¹ï¼Œå¹¶ä½¿ç”¨é“¾è¡¨ç»“ç‚¹çš„ç§»åŠ¨æ¥å®ç°é˜Ÿåˆ—å†…ç»“ç‚¹çš„ç§»åŠ¨ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é»„ç”³","uid":"1275061","ctime":1554311938,"ip_address":"","comment_id":82639,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18734135734","product_id":100021201,"comment_content":"æŸ¥æ‰¾æ•°æ®æ˜¯å¦åœ¨é˜Ÿåˆ—è¿™ä¸ªæˆæœ¬ä¹Ÿä¸å°å•Š","like_count":4,"discussions":[{"author":{"id":1275061,"avatar":"https://static001.geekbang.org/account/avatar/00/13/74/b5/b68e3740.jpg","nickname":"é»„ç”³","note":"","ucode":"EE9AC074A322FF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445667,"discussion_content":"è¿™æ˜¯ä¸ªå¥½é—®é¢˜ï¼Œæ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å‡è®¾å“ˆå¸Œè¡¨å’Œé˜Ÿåˆ—é‡Œçš„æ•°æ®ä¸€è‡´ï¼Œé™¤éå‘ç”Ÿäº†å¼‚å¸¸ã€‚\nå¦‚æœæ˜¯è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨é“¾è¡¨æ¥å®ç°é˜Ÿåˆ—ï¼Œç„¶åä½¿ç”¨å“ˆå¸Œè¡¨å­˜å‚¨æ¯ä¸ªè¢«ç¼“å­˜ç»“æœæ‰€å¯¹åº”çš„é˜Ÿåˆ—ç»“ç‚¹ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥å¿«é€Ÿè®¿é—®é˜Ÿåˆ—çš„ç»“ç‚¹ï¼Œå¹¶ä½¿ç”¨é“¾è¡¨ç»“ç‚¹çš„ç§»åŠ¨æ¥å®ç°é˜Ÿåˆ—å†…ç»“ç‚¹çš„ç§»åŠ¨ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554311938,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81927,"user_name":"å¤±ç«çš„å¤å¤©","can_delete":false,"product_type":"c1","uid":1241770,"ip_address":"","ucode":"10C6E66EB2A65F","user_header":"https://static001.geekbang.org/account/avatar/00/12/f2/aa/32fc0d54.jpg","comment_is_top":false,"comment_ctime":1554083106,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14438984994","product_id":100021201,"comment_content":"<br>å› ä¸ºç¯‡å¹…ä¸å¤Ÿï¼Œåˆ†æ®µæˆªå‡ºæ¥äº†ï¼Œè¿™é‡Œå…ˆå£°æ˜ä¸€ä¸ªå†…éƒ¨ç±»ï¼Œè¡¨ç¤ºä¸ºé˜Ÿåˆ—ï¼ˆé“¾è¡¨ï¼‰çš„èŠ‚ç‚¹ï¼Œæ¥ä¸‹æ¥çš„NodeèŠ‚ç‚¹æ˜¯è¿™ä¸ªå†…éƒ¨ç±»<br>private class Node{<br>        private Node prev;<br>        private Node next;<br>        private int key;<br>        private int value;<br><br>        Node(int key,int value){<br>            this.key = key;<br>            this.value = value;<br>        }<br>    }","like_count":3},{"had_liked":false,"id":140564,"user_name":"Paul Shan","can_delete":false,"product_type":"c1","uid":1593140,"ip_address":"","ucode":"32D99989028284","user_header":"","comment_is_top":false,"comment_ctime":1571000993,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10160935585","product_id":100021201,"comment_content":"ç¼“å­˜æ„å‘³ç€æ•°æ®æºæœ‰ä¸¤ä¸ªï¼Œè€Œä¸”è¿™ä¸¤ä¸ªæ•°æ®æºè®¿é—®æˆæœ¬å’Œæ•°æ®å®Œå¤‡åº¦ä¸åŒã€‚è®¿é—®æˆæœ¬ä½çš„æ•°æ®ä¸å®Œå¤‡ï¼Œæ•°æ®å®Œå¤‡çš„è®¿é—®æˆæœ¬é«˜ã€‚è¦ç»“åˆè¿™ä¸¤ä¸ªæ•°æ®æºæ¥è®¾è®¡è®¿é—®æˆæœ¬å°½å¯èƒ½ä½ï¼ŒåŒæ—¶æ•°æ®åˆæ˜¯å®Œå¤‡çš„ç³»ç»Ÿã€‚åŸºäºé˜Ÿåˆ—å’Œå“ˆå¸Œè¡¨å®ç°çš„LRUç®—æ³•æ˜¯ç»å…¸ç®—æ³•ä¹‹ä¸€ã€‚é˜Ÿåˆ—ç»´æŠ¤ç¼“å­˜å¤§å°ï¼Œæ»¡çš„æ—¶å€™æ·˜æ±°æœ€è¿‘æ²¡ç”¨åˆ°çš„æ•°æ®ã€‚å“ˆå¸Œè¡¨æå‡æŸ¥è¯¢æ•ˆç‡ã€‚æ¯æ¬¡è®¿é—®ï¼Œå…ˆæŸ¥å“ˆå¸Œè¡¨ï¼Œå¦‚æœæ•°æ®å­˜åœ¨ï¼Œå°†è¯¥æ•°æ®æ”¾åˆ°é˜Ÿåˆ—å°¾éƒ¨ï¼Œè®©å…¶è¿œç¦»è¢«æ·˜æ±°çš„ä½ç½®ï¼Œç„¶åè¿”å›æ•°æ®ã€‚å¦‚æœæ•°æ®ä¸å­˜åœ¨ï¼Œå°±ä»å®Œå¤‡çš„æ•°æ®æºä¸­å–å¾—æ•°æ®ï¼Œå°†æ•°æ®æ”¾å…¥é˜Ÿåˆ—ï¼Œå¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™æ·˜æ±°æ‰æœ€è¿‘æœ€å°‘ç”¨çš„æ•°æ®ï¼Œç„¶åå¾—åˆ°æœ€æ–°è¿”å›çš„æ•°æ®ã€‚é˜Ÿåˆ—è¦é¢ä¸´é¢‘ç¹çš„æ’å…¥å’Œæ”¹ä½ç½®æ“ä½œï¼Œé€‰ç”¨åŸºäºåŒå‘é“¾è¡¨çš„é˜Ÿåˆ—è¾ƒä¸ºé«˜æ•ˆã€‚","like_count":2},{"had_liked":false,"id":267622,"user_name":"å»ºå¼º","can_delete":false,"product_type":"c1","uid":1397126,"ip_address":"","ucode":"62B03D0E0C64EC","user_header":"https://static001.geekbang.org/account/avatar/00/15/51/86/b5fd8dd8.jpg","comment_is_top":false,"comment_ctime":1607849253,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5902816549","product_id":100021201,"comment_content":"å—ç¯‡å¹…é™åˆ¶ï¼Œæœ‰éƒ¨åˆ†å‡½æ•°æ²¡æœ‰åˆ—å‡º<br># å®šä¹‰å“ˆå¸Œé“¾è¡¨çš„èŠ‚ç‚¹<br>class HashLinkNode:<br>    def __init__(self, data, next=None):<br>        self.data = data<br>        self.next = next<br><br>class LRUCache:<br>    <br>    # ç¼“å­˜åˆå§‹åŒ–<br>    def __init__(self, maxsize):<br>        self.maxsize = maxsize <br>        self.currsize = 0 <br>        self.queue = [] <br>        self.hashtable = {} <br>    <br>    # æ·˜æ±°ç­–ç•¥<br>    def _takeout(self):<br>        data = self.queue.pop(0) # å–å‡ºé˜Ÿå¤´å…ƒç´ <br>        hashvalue = self._hashvalue(data)<br>        head = self.hashtable.get(hashvalue, None)<br>        node = head<br><br>        # åœ¨å“ˆå¸Œé“¾è¡¨ä¸­æŸ¥æ‰¾å¹¶åˆ é™¤è¢«æ·˜æ±°çš„ç»“ç‚¹<br>        if node is not None:<br><br>            while node.data != data and node.next is not None:<br>                node = node.next<br>            if node.data == data:<br>                if node.next is None:<br>                    node.data = None<br>                else:<br>                    node.data = node.next.data<br>                    node.next = node.next.next<br>        <br>        if head is None or head.data is None:<br>            del self.hashtable[hashvalue]<br>        <br>        # å½“å‰å®¹é‡å‡1<br>        self.currsize -= 1<br>    <br>    # æ•°æ®åŠ å…¥ç¼“å­˜<br>    def add(self, data):<br>        <br>        # ç¼“å­˜å·²æ»¡ï¼Œæ‰§è¡Œæ·˜æ±°ç­–ç•¥<br>        if self._isfull():<br>            self._takeout()<br>        <br>        hashvalue = self._hashvalue(data)<br>        node = HashLinkNode(data)<br>        head = self.hashtable.setdefault(hashvalue, None)<br>        node.next = head<br>        head = node<br>        self.hashtable[hashvalue] = head<br>        <br>        # æ–°åŠ å…¥çš„æ•°æ®ï¼Œç½®äºé˜Ÿåˆ—å°¾<br>        self.queue.append(data)<br>        <br>        # å½“å‰ç¼“å­˜å®¹é‡åŠ 1<br>        self.currsize += 1<br>    <br>    # è·å–æ•°æ®<br>    def visit(self, data):<br>        hashvalue = self._hashvalue(data)<br>        head = self.hashtable.get(hashvalue, None)<br>        node = head<br>        <br>        while node is not None:<br>            <br>            # è®¿é—®å‘½ä¸­ï¼Œå‘½ä¸­çš„æ•°æ®ç½®äºé˜Ÿå°¾ï¼Œè¿”å›True<br>            if node.data == data:<br>                del self.queue[self.queue.index(data)]<br>                self.queue.append(data)<br>                return True<br>            <br>            node = node.next<br>            <br>        return False","like_count":1},{"had_liked":false,"id":83974,"user_name":"qinggeouye","can_delete":false,"product_type":"c1","uid":1251536,"ip_address":"","ucode":"5B53EEDD7BEC9C","user_header":"https://static001.geekbang.org/account/avatar/00/13/18/d0/49b06424.jpg","comment_is_top":false,"comment_ctime":1554742666,"is_pvip":false,"replies":[{"id":"30403","content":"è¿™éƒ¨åˆ†å®ç°ä¸»è¦ä¾§é‡äºqueueå®ç°LRUç­–ç•¥ï¼Œä¾èµ–äºPython queueçš„æŸ¥æ‰¾æœºåˆ¶ï¼Œå¦‚æœPythonçš„queueä¹Ÿæœ‰ç±»ä¼¼å“ˆå¸Œè¡¨çš„æŸ¥è¯¢æ•ˆç‡ï¼Œé‚£ä¹ˆä¹Ÿæ˜¯ä¸€ç§æ›´ç®€æ´çš„å®ç°æ–¹å¼ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"é»„ç”³","uid":"1275061","ctime":1554828960,"ip_address":"","comment_id":83974,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5849709962","product_id":100021201,"comment_content":"# collections çš„ OrderedDict()<br><br>class LRUCache:<br><br>    def __init__(self, capacity):<br>        self.capacity = capacity<br>        self.queue = collections.OrderedDict()<br><br>    def get(self, key):<br>        if key not in self.queue:<br>            return -1  # è¦æ‰¾çš„æ•°æ®ä¸åœ¨ç¼“å­˜ä¸­åˆ™è¿”å› -1<br>        value = self.queue.pop(key)  # å°†å‘½ä¸­ç¼“å­˜çš„æ•°æ®ç§»é™¤<br>        self.queue[key] = value  # å°†å‘½ä¸­ç¼“å­˜çš„æ•°æ®é‡æ–°æ·»åŠ åˆ°å¤´éƒ¨<br>        return self.queue[key]<br><br>    def put(self, key, value):<br>        if key in self.queue:  # å¦‚æœå·²ç»å­˜åœ¨ç¼“å­˜ä¸­ï¼Œåˆ™å…ˆç§»é™¤è€çš„æ•°æ®<br>            self.queue.pop(key)<br>        elif len(self.queue.items()) == self.capacity:<br>            self.queue.popitem(last=False)  # å¦‚æœä¸å­˜åœ¨ç¼“å­˜å¹¶ä¸”è¾¾åˆ°æœ€å¤§å®¹é‡ åˆ™æŠŠæœ€åçš„æ•°æ®æ·˜æ±°<br>        self.queue[key] = value  # å°†æ–°æ•°æ®æ·»åŠ åˆ°å¤´éƒ¨","like_count":1,"discussions":[{"author":{"id":1275061,"avatar":"https://static001.geekbang.org/account/avatar/00/13/74/b5/b68e3740.jpg","nickname":"é»„ç”³","note":"","ucode":"EE9AC074A322FF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446198,"discussion_content":"è¿™éƒ¨åˆ†å®ç°ä¸»è¦ä¾§é‡äºqueueå®ç°LRUç­–ç•¥ï¼Œä¾èµ–äºPython queueçš„æŸ¥æ‰¾æœºåˆ¶ï¼Œå¦‚æœPythonçš„queueä¹Ÿæœ‰ç±»ä¼¼å“ˆå¸Œè¡¨çš„æŸ¥è¯¢æ•ˆç‡ï¼Œé‚£ä¹ˆä¹Ÿæ˜¯ä¸€ç§æ›´ç®€æ´çš„å®ç°æ–¹å¼ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554828960,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81928,"user_name":"å¤±ç«çš„å¤å¤©","can_delete":false,"product_type":"c1","uid":1241770,"ip_address":"","ucode":"10C6E66EB2A65F","user_header":"https://static001.geekbang.org/account/avatar/00/12/f2/aa/32fc0d54.jpg","comment_is_top":false,"comment_ctime":1554083132,"is_pvip":false,"replies":[{"id":"29871","content":"å®ç°çš„å¾ˆä»”ç»†ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"é»„ç”³","uid":"1275061","ctime":1554225700,"ip_address":"","comment_id":81928,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5849050428","product_id":100021201,"comment_content":"class LRUCache {<br><br>    private Node head;&#47;&#47; æœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼Œç±»ä¼¼åˆ—é˜Ÿçš„å¤´ï¼Œå‡ºé˜Ÿ<br>    private Node tail;&#47;&#47; æœ€è¿‘æœ€å¤šä½¿ç”¨ï¼Œç±»ä¼¼é˜Ÿåˆ—çš„å°¾ï¼Œå…¥é˜Ÿ<br>    private Map&lt;Integer,Node&gt; cache;<br>    private int capacity;<br><br>    public LRUCache(int capacity) {<br>        this.cache = new HashMap&lt;&gt;();<br>        this.capacity = capacity;<br>    }<br><br>    public int get(int key) {<br>        Node node = cache.get(key);<br>        if(node == null){<br>            return -1;<br>        }else{<br>            moveNode(node);<br>            return node.value;<br>        }<br>    }<br><br>    public void put(int key, int value) {<br>        Node node = cache.get(key);<br>        if (node != null){<br>            node.value = value;<br>            moveNode(node);<br>        }else {<br>            removeHead();<br>            node = new Node(key,value);<br>            addNode(node);<br>        }<br>        cache.put(key,node);<br>    }<br><br>    private void removeHead(){<br>        if (cache.size() == capacity){<br>            Node tempNode = head;<br>            cache.remove(head.key);<br>            head = head.next;<br>            tempNode.next = null;<br>            if (head != null){<br>                head.prev = null;<br>            }<br>        }<br>    }<br><br>    &#47;**<br>     * é“¾è¡¨åŠ å…¥èŠ‚ç‚¹<br>     * @param node<br>     *&#47;<br>    private void addNode(Node node){<br>        if (head == null){<br>            head = node;<br>            tail = node;<br>        }else {<br>            addNodeToTail(node);<br>        }<br>    }<br><br>    private void addNodeToTail(Node node){<br>        node.prev = tail;<br>        tail.next = node;<br>        tail = node;<br>    }<br><br>    private void moveNode(Node node){<br>        if(head == node &amp;&amp; node != tail){<br>            head = node.next;<br>            head.prev = null;<br>            node.next = null;<br>            addNodeToTail(node);<br>        }else if (tail == node){<br>            &#47;&#47; ä¸åšä»»ä½•æ“ä½œ<br>        }else {<br>            &#47;&#47; æ™®éæƒ…å†µï¼ŒnodeèŠ‚ç‚¹ç§»é™¤é“¾è¡¨ï¼ŒåŠ å…¥åˆ°å°¾èŠ‚ç‚¹åé¢ï¼ŒtailæŒ‡é’ˆæŒ‡å‘node<br>            node.prev.next = node.next;<br>            node.next.prev = node.prev;<br>            node.next = null;<br>            addNodeToTail(node);<br>        }<br>    }<br>}","like_count":1,"discussions":[{"author":{"id":1275061,"avatar":"https://static001.geekbang.org/account/avatar/00/13/74/b5/b68e3740.jpg","nickname":"é»„ç”³","note":"","ucode":"EE9AC074A322FF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445393,"discussion_content":"å®ç°çš„å¾ˆä»”ç»†ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554225700,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358098,"user_name":"013923","can_delete":false,"product_type":"c1","uid":3035193,"ip_address":"ä¸Šæµ·","ucode":"1214DAADBCA848","user_header":"","comment_is_top":false,"comment_ctime":1663908583,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1663908583","product_id":100021201,"comment_content":"ä½¿ç”¨å“ˆå¸Œè¡¨å’Œé˜Ÿåˆ—å¯ä»¥å®ç°é«˜æ•ˆè®¿é—®ï¼›","like_count":0},{"had_liked":false,"id":357413,"user_name":"013923","can_delete":false,"product_type":"c1","uid":3035193,"ip_address":"ä¸Šæµ·","ucode":"1214DAADBCA848","user_header":"","comment_is_top":false,"comment_ctime":1663232809,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1663232809","product_id":100021201,"comment_content":"Cache æ˜¯è®¡ç®—æœºOSçš„åŸºæœ¬å…ƒä»¶","like_count":0},{"had_liked":false,"id":357409,"user_name":"013923","can_delete":false,"product_type":"c1","uid":3035193,"ip_address":"ä¸Šæµ·","ucode":"1214DAADBCA848","user_header":"","comment_is_top":false,"comment_ctime":1663231738,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1663231738","product_id":100021201,"comment_content":"å­¦ä¹ äº†Cacheç¼“å­˜ç³»ç»Ÿï¼›è®¡ç®—æœºåŸºç¡€è¯¾ç¨‹","like_count":0},{"had_liked":false,"id":318815,"user_name":"å°ç°","can_delete":false,"product_type":"c1","uid":1130729,"ip_address":"","ucode":"1AB4E3AEDEE7FC","user_header":"https://static001.geekbang.org/account/avatar/00/11/40/e9/29dfa621.jpg","comment_is_top":false,"comment_ctime":1635433042,"is_pvip":true,"replies":[{"id":"115685","content":"ç”±äºæ’ç‰ˆçš„å…³ç³»ï¼Œåº”è¯¥æ˜¯(1+7+5)%10^6ï¼Œå…¶ä¸­10^6è¡¨ç¤º10çš„6æ¬¡æ–¹ï¼Œè®¡ç®—ä¼˜å…ˆçº§æœ€é«˜ï¼Œæ‰€ä»¥æ˜¯13%1000000ï¼Œè€Œ%è¡¨ç¤ºæ±‚ä½™ï¼Œæ±‚ä½™ä¸º13","user_name":"ä½œè€…å›å¤","user_name_real":"é»„ç”³","uid":"1275061","ctime":1635638064,"ip_address":"","comment_id":318815,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1635433042","product_id":100021201,"comment_content":"è€å¸ˆè¯·æ•™ä¸€ä¸‹ï¼Œ(1+7+5)&#47;10^6=13 è¿™ä¸ªæ˜¯æ€ä¹ˆè®¡ç®—çš„","like_count":0,"discussions":[{"author":{"id":1275061,"avatar":"https://static001.geekbang.org/account/avatar/00/13/74/b5/b68e3740.jpg","nickname":"é»„ç”³","note":"","ucode":"EE9AC074A322FF","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529387,"discussion_content":"ç”±äºæ’ç‰ˆçš„å…³ç³»ï¼Œåº”è¯¥æ˜¯(1+7+5)%10^6ï¼Œå…¶ä¸­10^6è¡¨ç¤º10çš„6æ¬¡æ–¹ï¼Œè®¡ç®—ä¼˜å…ˆçº§æœ€é«˜ï¼Œæ‰€ä»¥æ˜¯13%1000000ï¼Œè€Œ%è¡¨ç¤ºæ±‚ä½™ï¼Œæ±‚ä½™ä¸º13","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635638064,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}