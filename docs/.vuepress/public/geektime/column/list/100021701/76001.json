{"id":76001,"title":"10丨Python爬虫：如何自动化下载王祖贤海报？","content":"<p>上一讲中我给你讲了如何使用八爪鱼采集数据，对于数据采集刚刚入门的人来说，像八爪鱼这种可视化的采集是一种非常好的方式。它最大的优点就是上手速度快，当然也存在一些问题，比如运行速度慢、可控性差等。</p><p>相比之下，爬虫可以很好地避免这些问题，今天我来分享下如何通过编写爬虫抓取数据。</p><h2>爬虫的流程</h2><p>相信你对“爬虫”这个词已经非常熟悉了，爬虫实际上是用浏览器访问的方式模拟了访问网站的过程，整个过程包括三个阶段：打开网页、提取数据和保存数据。</p><p>在Python中，这三个阶段都有对应的工具可以使用。</p><p>在“打开网页”这一步骤中，可以使用 Requests 访问页面，得到服务器返回给我们的数据，这里包括HTML页面以及JSON数据。</p><p>在“提取数据”这一步骤中，主要用到了两个工具。针对HTML页面，可以使用 XPath 进行元素定位，提取数据；针对JSON数据，可以使用JSON进行解析。</p><p>在最后一步“保存数据”中，我们可以使用 Pandas 保存数据，最后导出CSV文件。</p><p>下面我来分别介绍下这些工具的使用。</p><p><strong>Requests访问页面</strong></p><p>Requests是Python HTTP的客户端库，编写爬虫的时候都会用到，编写起来也很简单。它有两种访问方式：Get和Post。这两者最直观的区别就是：Get把参数包含在url中，而Post通过request body来传递参数。</p><!-- [[[read_end]]] --><p>假设我们想访问豆瓣，那么用Get访问的话，代码可以写成下面这样的：</p><pre><code>r = requests.get('http://www.douban.com')\n</code></pre><p>代码里的“r”就是Get请求后的访问结果，然后我们可以使用r.text或r.content来获取HTML的正文。</p><p>如果我们想要使用Post进行表单传递，代码就可以这样写：</p><pre><code>r = requests.post('http://xxx.com', data = {'key':'value'})\n</code></pre><p>这里data就是传递的表单参数，data的数据类型是个字典的结构，采用key和value的方式进行存储。</p><p><strong>XPath定位</strong></p><p>XPath是XML的路径语言，实际上是通过元素和属性进行导航，帮我们定位位置。它有几种常用的路径表达方式。</p><p><img src=\"https://static001.geekbang.org/resource/image/3b/ea/3bcb311361c76bfbeb90d360b21195ea.jpg?wh=518*690\" alt=\"\"></p><p>我来给你简单举一些例子：</p><ol>\n<li>\n<p>xpath(‘node’) 选取了node节点的所有子节点；</p>\n</li>\n<li>\n<p>xpath(’/div’) 从根节点上选取div节点；</p>\n</li>\n<li>\n<p>xpath(’//div’) 选取所有的div节点；</p>\n</li>\n<li>\n<p>xpath(’./div’) 选取当前节点下的div节点；</p>\n</li>\n<li>\n<p>xpath(’…’) 回到上一个节点；</p>\n</li>\n<li>\n<p>xpath(’//@id’) 选取所有的id属性；</p>\n</li>\n<li>\n<p>xpath(’//book[@id]’) 选取所有拥有名为id的属性的book元素；</p>\n</li>\n<li>\n<p>xpath(’//book[@id=“abc”]’) 选取所有book元素，且这些book元素拥有id= \"abc\"的属性；</p>\n</li>\n<li>\n<p>xpath(’//book/title | //book/price’) 选取book元素的所有title和price元素。</p>\n</li>\n</ol><p>上面我只是列举了XPath的部分应用，XPath的选择功能非常强大，它可以提供超过100个内建函数，来做匹配。我们想要定位的节点，几乎都可以使用XPath来选择。</p><p>使用XPath定位，你会用到Python的一个解析库lxml。这个库的解析效率非常高，使用起来也很简便，只需要调用HTML解析命令即可，然后再对HTML进行XPath函数的调用。</p><p>比如我们想要定位到HTML中的所有列表项目，可以采用下面这段代码。</p><pre><code>from lxml import etree\nhtml = etree.HTML(html)\nresult = html.xpath('//li')\n</code></pre><p><strong>JSON对象</strong></p><p>JSON是一种轻量级的交互方式，在Python中有JSON库，可以让我们将Python对象和JSON对象进行转换。为什么要转换呢？原因也很简单。将JSON对象转换成为Python对象，我们对数据进行解析就更方便了。</p><p><img src=\"https://static001.geekbang.org/resource/image/9a/43/9a6d6564a64cf2b1c256265eea78c543.png?wh=477*237\" alt=\"\"></p><p>这是一段将JSON格式转换成Python对象的代码，你可以自己运行下这个程序的结果。</p><pre><code>import json\njsonData = '{&quot;a&quot;:1,&quot;b&quot;:2,&quot;c&quot;:3,&quot;d&quot;:4,&quot;e&quot;:5}';\ninput = json.loads(jsonData)\nprint input\n</code></pre><p>接下来，我们就要进行实战了，我会从两个角度给你讲解如何使用Python爬取海报，一个是通过JSON数据爬取，一个是通过XPath定位爬取。</p><h2>如何使用JSON数据自动下载王祖贤的海报</h2><p>我在上面讲了Python爬虫的基本原理和实现的工具，下面我们来实战一下。如果想要从豆瓣图片中下载王祖贤的海报，你应该先把我们日常的操作步骤整理下来：</p><ol>\n<li>\n<p>打开网页；</p>\n</li>\n<li>\n<p>输入关键词“王祖贤”；</p>\n</li>\n<li>\n<p>在搜索结果页中选择“图片”；</p>\n</li>\n<li>\n<p>下载图片页中的所有海报。</p>\n</li>\n</ol><p>这里你需要注意的是，如果爬取的页面是动态页面，就需要关注XHR数据。因为动态页面的原理就是通过原生的XHR数据对象发出HTTP请求，得到服务器返回的数据后，再进行处理。XHR会用于在后台与服务器交换数据。</p><p>你需要使用浏览器的插件查看XHR数据，比如在Chrome浏览器中使用开发者工具。</p><p>在豆瓣搜索中，我们对“王祖贤”进行了模拟，发现XHR数据中有一个请求是这样的：</p><p><a href=\"https://www.douban.com/j/search_photo?q=%E7%8E%8B%E7%A5%96%E8%B4%A4&amp;limit=20&amp;start=0\">https://www.douban.com/j/search_photo?q=%E7%8E%8B%E7%A5%96%E8%B4%A4&amp;limit=20&amp;start=0</a></p><p>url中的乱码正是中文的url编码，打开后，我们看到了很清爽的JSON格式对象，展示的形式是这样的：</p><pre><code>{&quot;images&quot;:\n       [{&quot;src&quot;: …, &quot;author&quot;: …, &quot;url&quot;:…, &quot;id&quot;: …, &quot;title&quot;: …, &quot;width&quot;:…, &quot;height&quot;:…},\n    …\n\t {&quot;src&quot;: …, &quot;author&quot;: …, &quot;url&quot;:…, &quot;id&quot;: …, &quot;title&quot;: …, &quot;width&quot;:…, &quot;height&quot;:…}],\n &quot;total&quot;:22471,&quot;limit&quot;:20,&quot;more&quot;:true}\n</code></pre><p>从这个JSON对象中，我们能看到，王祖贤的图片一共有22471张，其中一次只返回了20张，还有更多的数据可以请求。数据被放到了images对象里，它是个数组的结构，每个数组的元素是个字典的类型，分别告诉了src、author、url、id、title、width和height字段，这些字段代表的含义分别是原图片的地址、作者、发布地址、图片ID、标题、图片宽度、图片高度等信息。</p><p>有了这个JSON信息，你很容易就可以把图片下载下来。当然你还需要寻找XHR请求的url规律。</p><p>如何查看呢，我们再来重新看下这个网址本身。</p><p><a href=\"https://www.douban.com/j/search_photo?q=%E7%8E%8B%E7%A5%96%E8%B4%A4&amp;limit=20&amp;start=0\">https://www.douban.com/j/search_photo?q=王祖贤&amp;limit=20&amp;start=0</a></p><p>你会发现，网址中有三个参数：q、limit和start。start实际上是请求的起始ID，这里我们注意到它对图片的顺序标识是从0开始计算的。所以如果你想要从第21个图片进行下载，你可以将start设置为20。</p><p>王祖贤的图片一共有22471张，你可以写个for循环来跑完所有的请求，具体的代码如下：</p><pre><code># coding:utf-8\nimport requests\nimport json\nquery = '王祖贤'\n''' 下载图片 '''\ndef download(src, id):\n\tdir = './' + str(id) + '.jpg'\n\ttry:\n\t\tpic = requests.get(src, timeout=10)\n\t\tfp = open(dir, 'wb')\n\t\tfp.write(pic.content)\n\t\tfp.close()\n\texcept requests.exceptions.ConnectionError:\n\t\tprint('图片无法下载')\n            \n''' for 循环 请求全部的 url '''\nfor i in range(0, 22471, 20):\n\turl = 'https://www.douban.com/j/search_photo?q='+query+'&amp;limit=20&amp;start='+str(i)\n\thtml = requests.get(url).text    # 得到返回结果\n\tresponse = json.loads(html,encoding='utf-8') # 将 JSON 格式转换成 Python 对象\n\tfor image in response['images']:\n\t\tprint(image['src']) # 查看当前下载的图片网址\n\t\tdownload(image['src'], image['id']) # 下载一张图片\n</code></pre><h2>如何使用XPath自动下载王祖贤的电影海报封面</h2><p>如果你遇到JSON的数据格式，那么恭喜你，数据结构很清爽，通过Python的JSON库就可以解析。</p><p>但有时候，网页会用JS请求数据，那么只有JS都加载完之后，我们才能获取完整的HTML文件。XPath可以不受加载的限制，帮我们定位想要的元素。</p><p>比如，我们想要从豆瓣电影上下载王祖贤的电影封面，需要先梳理下人工的操作流程：</p><ol>\n<li>\n<p><a href=\"http://xn--movie-hr2j95qrv1e8j7b.douban.com\">打开网页movie.douban.com</a>；</p>\n</li>\n<li>\n<p>输入关键词“王祖贤”；</p>\n</li>\n<li>\n<p>下载图片页中的所有电影封面。</p>\n</li>\n</ol><p>这里你需要用XPath定位图片的网址，以及电影的名称。</p><p>一个快速定位XPath的方法就是采用浏览器的XPath Helper插件，使用Ctrl+Shift+X快捷键的时候，用鼠标选中你想要定位的元素，就会得到类似下面的结果。</p><p><img src=\"https://static001.geekbang.org/resource/image/0e/c7/0e0fef601ee043f4bea8dd2874e788c7.png?wh=865*111\" alt=\"\"></p><p>XPath Helper插件中有两个参数，一个是Query，另一个是Results。Query其实就是让你来输入XPath语法，然后在Results里看到匹配的元素的结果。</p><p>我们看到，这里选中的是一个元素，我们要匹配上所有的电影海报，就需要缩减XPath表达式。你可以在Query中进行XPath表达式的缩减，尝试去掉XPath表达式中的一些内容，在Results中会自动出现匹配的结果。</p><p>经过缩减之后，你可以得到电影海报的XPath（假设为变量src_xpath）：</p><pre><code>//div[@class='item-root']/a[@class='cover-link']/img[@class='cover']/@src\n</code></pre><p>以及电影名称的XPath（假设为变量title_xpath）：</p><pre><code>//div[@class='item-root']/div[@class='detail']/div[@class='title']/a[@class='title-text']\n</code></pre><p>但有时候当我们直接用Requests获取HTML的时候，发现想要的XPath并不存在。这是因为HTML还没有加载完，因此你需要一个工具，来进行网页加载的模拟，直到完成加载后再给你完整的HTML。</p><p>在Python中，这个工具就是Selenium库，使用方法如下：</p><pre><code>from selenium import webdriver\ndriver = webdriver.Chrome()\ndriver.get(request_url)\n</code></pre><p>Selenium是Web应用的测试工具，可以直接运行在浏览器中，它的原理是模拟用户在进行操作，支持当前多种主流的浏览器。</p><p>这里我们模拟Chrome浏览器的页面访问。</p><p>你需要先引用Selenium中的WebDriver库。WebDriver实际上就是Selenium 2，是一种用于Web应用程序的自动测试工具，提供了一套友好的API，方便我们进行操作。</p><p>然后通过WebDriver创建一个Chrome浏览器的drive，再通过drive获取访问页面的完整HTML。</p><p>当你获取到完整的HTML时，就可以对HTML中的XPath进行提取，在这里我们需要找到图片地址srcs和电影名称titles。这里通过XPath语法匹配到了多个元素，因为是多个元素，所以我们需要用for循环来对每个元素进行提取。</p><pre><code>srcs = html.xpath(src_xpath)\ntitles = html.xpath(title_path)\nfor src, title in zip(srcs, titles):\n\tdownload(src, title.text)\n</code></pre><p>然后使用上面我编写好的download函数进行图片下载。</p><h2>总结</h2><p>好了，这样就大功告成了，程序可以源源不断地采集你想要的内容。这节课，我想让你掌握的是：</p><ol>\n<li>\n<p>Python爬虫的流程；</p>\n</li>\n<li>\n<p>了解XPath定位，JSON对象解析；</p>\n</li>\n<li>\n<p>如何使用lxml库，进行XPath的提取；</p>\n</li>\n<li>\n<p>如何在Python中使用Selenium库来帮助你模拟浏览器，获取完整的HTML。</p>\n</li>\n</ol><p>其中，Python + Selenium + 第三方浏览器可以让我们处理多种复杂场景，包括网页动态加载、JS响应、Post表单等。因为Selenium模拟的就是一个真实的用户的操作行为，就不用担心cookie追踪和隐藏字段的干扰了。</p><p>当然，Python还给我们提供了数据处理工具，比如lxml库和JSON库，这样就可以提取想要的内容了。</p><p><img src=\"https://static001.geekbang.org/resource/image/eb/ab/eb3e48f714ca857a79948d831de521ab.jpg?wh=3200*1800\" alt=\"\"></p><p>最后，你不妨来实践一下，你最喜欢哪个明星？如果想要自动下载这个明星的图片，该如何操作呢？欢迎和我在评论区进行探讨。</p><p>你也可以把这篇文章分享给你的朋友或者同事，一起动手练习一下。</p><p></p>","neighbors":{"left":{"article_title":"09丨数据采集：如何用八爪鱼采集微博上的“D&G”评论","id":75780},"right":{"article_title":"11 | 数据科学家80%时间都花费在了这些清洗任务上？","id":76307}},"comments":[{"had_liked":false,"id":84644,"user_name":"滢","can_delete":false,"product_type":"c1","uid":1221511,"ip_address":"","ucode":"971A6F20AF3F9A","user_header":"https://static001.geekbang.org/account/avatar/00/12/a3/87/c415e370.jpg","comment_is_top":false,"comment_ctime":1554889158,"is_pvip":false,"replies":[{"id":"64282","content":"滢同学总结整理的很不错，大家都可以看下","user_name":"作者回复","comment_id":84644,"uid":"1306094","ip_address":"","utype":1,"ctime":1577616021,"user_name_real":"cy"}],"discussion_count":2,"race_medal":0,"score":"250662992326","product_id":100021701,"comment_content":"说明两点问题：<br>（一）.留言里有人评论说用XPath下载的图片打不开，其原因是定义的下载函数保存路径后缀名为&#39;.jpg&#39;，但是用XPath下载获得的图片url为&#39;https:&#47;&#47;img3.doubanio.com&#47;view&#47;celebrity&#47;s_ratio_celebrity&#47;public&#47;p616.webp&#39;，本身图片为webp格式，所以若保存为jpg格式，肯定是打不开的。<br>(二).  老师在文章内讲的用XPath下载代码只能下载第一页的内容，并不是全部的数据，不知道大家有没有查看用xpath函数获得的数组，大家留言里的代码似乎和老师的一样，只能得到首页的内容，所以也是需要模拟翻页操作才能获得完整的数据。<br><br>以下是课后练习题：爬取宫崎骏的电影海报， Python3.6 IDLE<br>&gt;&gt;&gt; import json<br>&gt;&gt;&gt; import requests as req<br>&gt;&gt;&gt; from lxml import etree<br>&gt;&gt;&gt; from selenium import webdriver<br>&gt;&gt;&gt; import os<br>&gt;&gt;&gt; request_url = &#39;https:&#47;&#47;movie.douban.com&#47;subject_search?search_text=宫崎骏&amp;cat=1002&#39;<br>&gt;&gt;&gt; src_xpath = &quot;&#47;&#47;div[@class=&#39;item-root&#39;]&#47;a[@class=&#39;cover-link&#39;]&#47;img[@class=&#39;cover&#39;]&#47;@src&quot;<br>&gt;&gt;&gt; title_xpath = &quot;&#47;&#47;div[@class=&#39;item-root&#39;]&#47;div[@class=&#39;detail&#39;]&#47;div[@class=&#39;title&#39;]&#47;a[@class=&#39;title-text&#39;]&quot;<br>&gt;&gt;&gt; driver = webdriver.Chrome(&#39;&#47;Users&#47;apple&#47;Downloads&#47;chromedriver&#39;)<br>&gt;&gt;&gt; driver.get(request_url)<br>&gt;&gt;&gt; html = etree.HTML(driver.page_source)<br>&gt;&gt;&gt; srcs = html.xpath(src_xpath)<br>&gt;&gt;&gt; print (srcs)  #大家可要看下打印出来的数据是否只是一页的内容，以及图片url的后缀格式<br>&gt;&gt;&gt; picpath = &#39;&#47;Users&#47;apple&#47;Downloads&#47;宫崎骏电影海报&#39;<br>&gt;&gt;&gt; if not os.path.isdir(picpath):<br>\tos.mkdir(picpath)<br>&gt;&gt;&gt; def download(src, id):<br>\tdic = picpath + &#39;&#47;&#39; + str(id) + &#39;.webp&#39;<br>\ttry:<br>\t\tpic = req.get(src, timeout = 30)<br>\t\tfp = open(dic, &#39;wb&#39;)<br>\t\tfp.write(pic.content)<br>\t\tfp.close()<br>\texcept req.exceptions.ConnectionError:<br>\t\tprint (&#39;图片无法下载&#39;)<br>&gt;&gt;&gt; for i in range(0, 150, 15):<br>\turl = request_url + &#39;&amp;start=&#39; + str(i)<br>\tdriver.get(url)<br>\thtml = etree.HTML(driver.page_source)<br>\tsrcs = html.xpath(src_xpath)<br>\ttitles = html.xpath(title_xpath)<br>\tfor src,title in zip(srcs, titles):<br>\t\tdownload(src, title.text)<br>","like_count":59,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446413,"discussion_content":"滢同学总结整理的很不错，大家都可以看下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577616021,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2302438,"avatar":"https://static001.geekbang.org/account/avatar/00/23/21/e6/483fbd49.jpg","nickname":"superchaner","note":"","ucode":"1F1977EF5D9EA0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389562,"discussion_content":"豆瓣现在需要登录操作了，，","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629339655,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56962,"user_name":"rOMEo罗密欧","can_delete":false,"product_type":"c1","uid":1074365,"ip_address":"","ucode":"9C7BF6E1274D26","user_header":"https://static001.geekbang.org/account/avatar/00/10/64/bd/cbcdc4a6.jpg","comment_is_top":false,"comment_ctime":1546587620,"is_pvip":false,"replies":[{"id":"21405","content":"你可以使用python+selenium的方式完成账户的自动登录，因为selenium是个自动化测试的框架，使用selenium 的webdriver就可以模拟浏览器的行为。找到输入用户名密码的地方，输入相应的值，然后模拟点击即可完成登录（没有验证码的情况下）<br>另外你也可以使用cookie来登录网站，方法是你登录网站时，先保存网站的cookie，然后用下次访问的时候，加载之前保存的cookie，放到request headers中，这样就不需要再登录网站了<br>","user_name":"作者回复","comment_id":56962,"uid":"1306094","ip_address":"","utype":1,"ctime":1547364811,"user_name_real":"cy"}],"discussion_count":4,"race_medal":0,"score":"190525148644","product_id":100021701,"comment_content":"老师请问一下：如果是需要用户登陆后才能爬取的数据该怎么用python来实现呢？","like_count":45,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435332,"discussion_content":"你可以使用python+selenium的方式完成账户的自动登录，因为selenium是个自动化测试的框架，使用selenium 的webdriver就可以模拟浏览器的行为。找到输入用户名密码的地方，输入相应的值，然后模拟点击即可完成登录（没有验证码的情况下）\n另外你也可以使用cookie来登录网站，方法是你登录网站时，先保存网站的cookie，然后用下次访问的时候，加载之前保存的cookie，放到request headers中，这样就不需要再登录网站了\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547364811,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1717549,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/35/2d/a2bde67e.jpg","nickname":"SapereAude","note":"","ucode":"C5D61C535B7B10","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":82768,"discussion_content":"亦可以拿到提交的url，把要提交的数据封装好，发送请求，获得返回的数据，进行后续操作。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1576377656,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2313022,"avatar":"https://static001.geekbang.org/account/avatar/00/23/4b/3e/dc8b3169.jpg","nickname":"不想这样","note":"","ucode":"D212AC2B5BA0A1","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":356125,"discussion_content":"工作中遇到的爬虫验证码这块最难了 ocr训练必须弄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615536289,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1070753,"avatar":"https://static001.geekbang.org/account/avatar/00/10/56/a1/9574aa11.jpg","nickname":"小 的时令","note":"","ucode":"FCF085CBEAFC5F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":41921,"discussion_content":"保留登录的session就可以登录了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572533638,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118811,"user_name":"Bayes","can_delete":false,"product_type":"c1","uid":1580620,"ip_address":"","ucode":"5215F12A0C6344","user_header":"https://static001.geekbang.org/account/avatar/00/18/1e/4c/79590513.jpg","comment_is_top":false,"comment_ctime":1564448886,"is_pvip":false,"replies":[{"id":"63607","content":"慢慢来，有些代码放到GitHub上了，可以先跑下","user_name":"作者回复","comment_id":118811,"uid":"1306094","ip_address":"","utype":1,"ctime":1577520917,"user_name_real":"cy"}],"discussion_count":8,"race_medal":0,"score":"74578892918","product_id":100021701,"comment_content":"老师你这跳过了太多步骤了，表示对于python跟着你前几节课入门的人什么都不会，按着你的代码运行，要不就是没有定义，要不就是没有这个函数。刚开始的人也不知道哪个函数在哪个库，建议老师按照流程来一步一步给代码，要不就在最后给一个完整的代码示例，真的是学的很困难加上想放弃","like_count":18,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460592,"discussion_content":"慢慢来，有些代码放到GitHub上了，可以先跑下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577520917,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":1649859,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/CqF8eiaanNteyu2U7FibYicjnw99VXZST61vvMpQKSd5iaLNW6EicLeFYyDOKJmg9rNx6KW90DwpPMKNxiben6fQeZjA/132","nickname":"Geek_24abc6","note":"","ucode":"88CD214232C6BC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":591031,"discussion_content":"你好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666234605,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":460592,"ip_address":"广东"},"score":591031,"extra":""},{"author":{"id":1649859,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/CqF8eiaanNteyu2U7FibYicjnw99VXZST61vvMpQKSd5iaLNW6EicLeFYyDOKJmg9rNx6KW90DwpPMKNxiben6fQeZjA/132","nickname":"Geek_24abc6","note":"","ucode":"88CD214232C6BC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":591032,"discussion_content":"请问本课程的所有代码在哪里呀？？？求分享😁😘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666234671,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":460592,"ip_address":"广东"},"score":591032,"extra":""}]},{"author":{"id":1659590,"avatar":"https://static001.geekbang.org/account/avatar/00/19/52/c6/8eb48963.jpg","nickname":"一纸书","note":"","ucode":"C58A22B54521CA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":19525,"discussion_content":"同感，已经入了门的，努把力还能看懂，刚入坑的真的一头雾水。所以呢，我打算把买的课留着过一段时间再看。自己先把基础搞好。对于看不懂的书，都是这么处理的。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1569204469,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1649859,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/CqF8eiaanNteyu2U7FibYicjnw99VXZST61vvMpQKSd5iaLNW6EicLeFYyDOKJmg9rNx6KW90DwpPMKNxiben6fQeZjA/132","nickname":"Geek_24abc6","note":"","ucode":"88CD214232C6BC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590955,"discussion_content":"代码在哪里呀？？？？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666188288,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"广东"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2022922,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/de/0a/6400e68e.jpg","nickname":"Terrylee","note":"","ucode":"89C1C695A3D6AC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379043,"discussion_content":"一头雾水！！！完全看不懂！！！学校不能指导下吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623641864,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1217054,"avatar":"https://static001.geekbang.org/account/avatar/00/12/92/1e/67b51b3d.jpg","nickname":"珊羽","note":"","ucode":"64AF515A35D4ED","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":354362,"discussion_content":"GitHub地址是什么呢？建议每节课里都附上完整的代码下载地址呢~对于学员来说比较方便查找~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615280132,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1914504,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/36/88/20b6a6ee.jpg","nickname":"Simon","note":"","ucode":"A8A2E3E57BD029","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":233395,"discussion_content":"阅读代码的正确方式是先看整体流程。把握好整体逻辑后，再看细节。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586923000,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57218,"user_name":"caidy","can_delete":false,"product_type":"c1","uid":1188783,"ip_address":"","ucode":"AEFB529C32C7EE","user_header":"https://static001.geekbang.org/account/avatar/00/12/23/af/84f4714e.jpg","comment_is_top":false,"comment_ctime":1546687848,"is_pvip":false,"discussion_count":6,"race_medal":0,"score":"70266164584","product_id":100021701,"comment_content":"你需要使用浏览器的插件查看 XHR 数据，比如在 Chrome的开发者工具<br>在豆瓣搜索中，我们对“王祖贤”进行了模拟，发现 XHR 数据中有一个请求是这样的：<br>https:&#47;&#47;www.douban.com&#47;j&#47;search_photo?q=王祖贤&amp;limit=20&amp;start=0<br><br>这个是如何查出来的，我使用chrome的开发者工具查看，但是查不到这部分，麻烦老师帮忙解答","like_count":16,"discussions":[{"author":{"id":1234591,"avatar":"https://static001.geekbang.org/account/avatar/00/12/d6/9f/0213e8a0.jpg","nickname":"🤪HappyJoo","note":"","ucode":"96E1858F06BABA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3063,"discussion_content":"我也是觉得这一步跨度有点大，需要有基础，没有详细讲。","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1564143334,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1039464,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/dc/68/006ba72c.jpg","nickname":"Untitled","note":"","ucode":"8DD6ABA3E81A2E","race_medal":2,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2433,"discussion_content":"chrome的开发工具打开后，再【network】下filter出xhr，然后重新刷新网页，就会看到xhr请求。","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1563610704,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2415687,"avatar":"https://static001.geekbang.org/account/avatar/00/24/dc/47/554aa6b8.jpg","nickname":"需要努力的、","note":"","ucode":"04627BD9ED77DD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344952,"discussion_content":"F12,点击 Network— SHR，刷新下网页就出来了","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1611628769,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1690817,"avatar":"https://static001.geekbang.org/account/avatar/00/19/cc/c1/94bc753d.jpg","nickname":"miserman","note":"","ucode":"4793B0E87BCD38","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":188082,"discussion_content":"我也看不到任何xhr的数据","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582794303,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1690817,"avatar":"https://static001.geekbang.org/account/avatar/00/19/cc/c1/94bc753d.jpg","nickname":"miserman","note":"","ucode":"4793B0E87BCD38","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":188081,"discussion_content":"这个问题解决了吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582794273,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1203652,"avatar":"https://static001.geekbang.org/account/avatar/00/12/5d/c4/cf9b06b9.jpg","nickname":"Sunway.","note":"","ucode":"F0DBC27A0D8158","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":24948,"discussion_content":"filter了xhr，但是并没有看到json数据，刷新了也没有，有点奇怪..","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570342926,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57023,"user_name":"伪君子","can_delete":false,"product_type":"c1","uid":1034778,"ip_address":"","ucode":"FE5409FB318EE7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ca/1a/9ecbf1bb.jpg","comment_is_top":false,"comment_ctime":1546604062,"is_pvip":false,"replies":[{"id":"21393","content":"对的，主要是配置ChromeDriver的问题。有相同问题的人，可以看下这个留言","user_name":"作者回复","comment_id":57023,"uid":"1306094","ip_address":"","utype":1,"ctime":1547355257,"user_name_real":"cy"}],"discussion_count":1,"race_medal":0,"score":"61676146206","product_id":100021701,"comment_content":"那些用 ChromeDriver 的出现报错的可能是没有安装 ChromeDriver，或者是没给出 ChromeDriver 的路径，具体可以看看下面这篇文章。<br>https:&#47;&#47;mp.weixin.qq.com&#47;s&#47;UL0bcLr3KOb-qpI9oegaIQ","like_count":15,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435366,"discussion_content":"对的，主要是配置ChromeDriver的问题。有相同问题的人，可以看下这个留言","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547355257,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57078,"user_name":"LY","can_delete":false,"product_type":"c1","uid":1168940,"ip_address":"","ucode":"109E6F963A6E39","user_header":"https://wx.qlogo.cn/mmopen/vi_32/l56HXkqMD4hqDg82yiaTr28GSwB1rCasj7n8M65VbibsJwmDibJnrWpw8o0mYGewH6NeD1wGvU6OGdhDG4nzIa9mA/132","comment_is_top":false,"comment_ctime":1546616192,"is_pvip":false,"replies":[{"id":"21407","content":"GoodJob","user_name":"作者回复","comment_id":57078,"uid":"1306094","ip_address":"","utype":1,"ctime":1547365241,"user_name_real":"cy"}],"discussion_count":1,"race_medal":0,"score":"57381191040","product_id":100021701,"comment_content":"#环境：Mac Python3<br>#pip install selenium<br>#下载chromedriver，放到项目路径下（https:&#47;&#47;npm.taobao.org&#47;mirrors&#47;chromedriver&#47;2.33&#47;）<br># coding:utf-8<br>import requests<br>import json<br>import os<br>from lxml import etree<br>from selenium import webdriver<br><br>query = &#39;张柏芝&#39;<br>downloadPath = &#39;&#47;Users&#47;yong&#47;Desktop&#47;Python&#47;xpath&#47;images&#47;&#39;<br><br>&#39;&#39;&#39; 下载图片 &#39;&#39;&#39;<br>def download(src, id):<br>    dir = downloadPath + str(id) + &#39;.jpg&#39;<br>    try:<br>        pic = requests.get(src, timeout=10)<br>    except requests.exceptions.ConnectionError:<br>    # print &#39;error, %d 当前图片无法下载&#39;, %id<br>        print(&#39;图片无法下载&#39;)<br>    if not os.path.exists(downloadPath):<br>        os.mkdir(downloadPath)<br>    if os.path.exists(dir):<br>        print(&#39;已存在:&#39;+ id)<br>        return<br>    fp = open(dir, &#39;wb&#39;)<br>    fp.write(pic.content)<br>    fp.close()<br> <br>def searchImages():<br>    &#39;&#39;&#39; for 循环 请求全部的 url &#39;&#39;&#39;<br>    for i in range(0, 22471, 20):<br>        url = &#39;https:&#47;&#47;www.douban.com&#47;j&#47;search_photo?q=&#39;+query+&#39;&amp;limit=20&amp;start=&#39;+str(i)<br>        html = requests.get(url).text    # 得到返回结果<br>        print(&#39;html:&#39;+html)<br>        response = json.loads(html,encoding=&#39;utf-8&#39;) # 将 JSON 格式转换成 Python 对象<br>        for image in response[&#39;images&#39;]:<br>            print(image[&#39;src&#39;]) # 查看当前下载的图片网址<br>            download(image[&#39;src&#39;], image[&#39;id&#39;]) # 下载一张图片<br><br>def getMovieImages():<br>    url = &#39;https:&#47;&#47;movie.douban.com&#47;subject_search?search_text=&#39;+ query +&#39;&amp;cat=1002&#39;<br>    driver = webdriver.Chrome(&#39;&#47;Users&#47;yong&#47;Desktop&#47;Python&#47;xpath&#47;libs&#47;chromedriver&#39;)<br>    driver.get(url)<br>    html = etree.HTML(driver.page_source)<br>    # 使用xpath helper, ctrl+shit+x 选中元素，如果要匹配全部，则需要修改query 表达式<br>    src_xpath = &quot;&#47;&#47;div[@class=&#39;item-root&#39;]&#47;a[@class=&#39;cover-link&#39;]&#47;img[@class=&#39;cover&#39;]&#47;@src&quot;<br>    title_xpath = &quot;&#47;&#47;div[@class=&#39;item-root&#39;]&#47;div[@class=&#39;detail&#39;]&#47;div[@class=&#39;title&#39;]&#47;a[@class=&#39;title-text&#39;]&quot;<br><br>    srcs = html.xpath(src_xpath)<br>    titles = html.xpath(title_xpath)<br>    for src, title in zip(srcs, titles):<br>        print(&#39;\\t&#39;.join([str(src),str(title.text)]))<br>        download(src, title.text)<br><br>    driver.close()<br><br>getMovieImages()","like_count":13,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435393,"discussion_content":"GoodJob","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547365241,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":88508,"user_name":"juixv3937","can_delete":false,"product_type":"c1","uid":1486338,"ip_address":"","ucode":"C164F6641FE043","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/1rd5KVxbBWO1Jnq3syrfRQg0NGerVl4Dt7uHTMcy9A7KTqxmy7iaoomoWsjuHM4n7fBr0ESG8OqfJKCDHExzjvQ/132","comment_is_top":false,"comment_ctime":1555932659,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"40210638323","product_id":100021701,"comment_content":"怎么查看XHR数据啊，操作步骤跳过的话，学习的很困难","like_count":10},{"had_liked":false,"id":204128,"user_name":"飘","can_delete":false,"product_type":"c1","uid":1804243,"ip_address":"","ucode":"07439B291A76F4","user_header":"https://static001.geekbang.org/account/avatar/00/1b/87/d3/fe95bda9.jpg","comment_is_top":false,"comment_ctime":1586338554,"is_pvip":false,"replies":[{"id":"104314","content":"Good Job!","user_name":"作者回复","comment_id":204128,"uid":"1306094","ip_address":"","utype":1,"ctime":1617892144,"user_name_real":"cy"}],"discussion_count":3,"race_medal":0,"score":"35946076922","product_id":100021701,"comment_content":"感谢作者以及评论区的各位大神，终于完成了爬虫代码，总结一下小白编写时遇到的几个问题：<br>1）获取xpath时，chrome浏览器需要安装插件xpatn-helper；<br>2）使用python3.7，提前引入模块requests，lxml，selenium，安装这些模块需要更新pip至20版本；<br>3）模拟用户访问浏览器，需要下载chromedriver.exe,放入python.exe所在目录；<br>4）图片路径中出现导致编译失败的字符，使用replace替换报错字符。<br>具体代码如下：<br>import os<br>import requests<br>from lxml import etree<br>from selenium import webdriver<br><br>search_text = &quot;王祖贤&quot;<br>start = 0<br>limit = 15<br>total = 90<br><br>def download(img, title):<br>\tdir = &quot;D:\\\\数据分析\\\\python test\\\\query\\\\&quot; + search_text + &quot;\\\\&quot; <br>\tid = title.replace(u&#39;\\u200e&#39;, u&#39;&#39;).replace(u&#39;?&#39;, u&#39;&#39;) .replace(u&#39;&#47;&#39;, u&#39;or&#39;)<br>\tif not os.path.exists(dir):<br>\t\tos.makedirs(dir)<br>\ttry:    <br>\t\tpic = requests.get(img, timeout=10) <br>\t\timg_path = dir  + str(id) + &#39;.jpg&#39;   <br>\t\tfp = open(img_path, &#39;wb&#39;)    <br>\t\tfp.write(pic.content)    <br>\t\tfp.close()  <br>\texcept requests.exceptions.ConnectionError:    <br>\t\tprint(&#39;图片无法下载&#39;)<br><br>def crawler_xpath():<br>\tsrc_img = &quot;&#47;&#47;div[@class=&#39;item-root&#39;]&#47;a[@class=&#39;cover-link&#39;]&#47;img[@class=&#39;cover&#39;]&#47;@src&quot;<br>\tsrc_title = &quot;&#47;&#47;div[@class=&#39;item-root&#39;]&#47;div[@class=&#39;detail&#39;]&#47;div[@class=&#39;title&#39;]&#47;a[@class=&#39;title-text&#39;]&quot;<br>\t<br>\tfor i in range(start,total,limit):<br>\t\trequest_url = &quot;https:&#47;&#47;search.douban.com&#47;movie&#47;subject_search?search_text=&quot;+search_text+&quot;&amp;cat=1002&amp;start=&quot;+str(i)<br>\t\tdriver = webdriver.Chrome()<br>\t\tdriver.get(request_url)<br>\t\thtml = etree.HTML(driver.page_source)<br>\t\timgs = html.xpath(src_img)<br>\t\ttitles = html.xpath(src_title)<br>\t\tprint(imgs,titles)<br>\t\tfor img, title in zip(imgs, titles): <br>\t\t\tdownload(img, title.text)<br>if __name__ == &#39;__main__&#39;:<br>\tcrawler_xpath()<br>","like_count":8,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491083,"discussion_content":"Good Job!","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617892144,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1073027,"avatar":"https://static001.geekbang.org/account/avatar/00/10/5f/83/bb728e53.jpg","nickname":"Douglas","note":"","ucode":"CFDE3D76B9DAE6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":360402,"discussion_content":"这些本该讲师说明的问题，你都写出来了，给你点个赞","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616427376,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1930136,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/73/98/8c2b746a.jpg","nickname":"Q.G.","note":"","ucode":"687CB21512A610","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":246337,"discussion_content":"4）图片路径中出现导致编译失败的字符，使用replace替换报错字符。\n\n感谢，我卡在这里，原来是这个原因","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587737568,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57017,"user_name":"伪君子","can_delete":false,"product_type":"c1","uid":1034778,"ip_address":"","ucode":"FE5409FB318EE7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ca/1a/9ecbf1bb.jpg","comment_is_top":false,"comment_ctime":1546602263,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"35906340631","product_id":100021701,"comment_content":"老师您好，我根据您的代码修改了一下，主要是添加了一个图片的目录，然后是下载大图。这里的大图是因为 &#47;photo&#47;thumb&#47;public&#47; 这样的链接下载的图片是缩略图，只有把 thumb 替换成 l 之后下载的图片才是相对来说的大图。replace 方法和 re 中的 sub 方法都能实现替换，我的疑问是哪个实现起来更高速一点呢？提前感谢老师，我写的代码在下面~<br><br># coding:utf-8<br>import requests<br>import json<br>import re<br>import os<br><br>query = &#39;王祖贤&#39;<br>path = os.getcwd()  # 当前路径，可以替换成别的路径<br>picpath = path + &#39;&#47;&#39; + query  # 设置的图片目录<br>print(picpath)  # 输出设置的图片目录<br>if not os.path.isdir(picpath):  # 如果图片目录未创建则创建一个<br>    os.mkdir(picpath)<br><br><br>def download(src, id):<br>    dir = picpath + &#39;&#47;&#39; + str(id) + &#39;.jpg&#39;<br>    try:<br>        pic = requests.get(src, timeout=10)<br>    except requests.exceptions.ConnectionError:<br>        # print &#39;error, %d 当前图片无法下载&#39;, %id<br>        print(&#39;图片无法下载&#39;)<br>    fp = open(dir, &#39;wb&#39;)<br>    fp.write(pic.content)<br>    fp.close()<br><br><br>&#39;&#39;&#39; for 循环 请求全部的 url &#39;&#39;&#39;<br>for i in range(0, 22471, 20):  #<br>    url = &#39;https:&#47;&#47;www.douban.com&#47;j&#47;search_photo?q=&#39; + query + &#39;&amp;limit=20&amp;start=&#39; + str(i)<br>    html = requests.get(url).text  # 得到返回结果<br>    response = json.loads(html, encoding=&#39;utf-8&#39;)  # 将 JSON 格式转换成 Python 对象<br>    print(&#39;已下载 &#39; + str(i) + &#39; 张图片&#39;)<br>    for image in response[&#39;images&#39;]:<br>        image[&#39;src&#39;] = image[&#39;src&#39;].replace(&#39;thumb&#39;, &#39;l&#39;)<br>        # image[&#39;src&#39;] = re.sub(r&#39;thumb&#39;, r&#39;l&#39;, image[&#39;src&#39;])<br>        print(image[&#39;src&#39;])  # 查看当前下载的图片网址<br>        download(image[&#39;src&#39;], image[&#39;id&#39;])  # 下载一张图片<br>","like_count":8},{"had_liked":false,"id":56968,"user_name":"germany","can_delete":false,"product_type":"c1","uid":1075195,"ip_address":"","ucode":"249BD3439D0A5B","user_header":"https://static001.geekbang.org/account/avatar/00/10/67/fb/cd95d624.jpg","comment_is_top":false,"comment_ctime":1546589116,"is_pvip":false,"replies":[{"id":"21403","content":"咱们访问豆瓣查询图片的网址应该是一样的。只是我给出的是json的链接。方法是：用Chrome浏览器的开发者工具，可以监测出来网页中是否有json数据的传输，所以我给出的链接是json数据传输的链接 https:&#47;&#47;www.douban.com&#47;j&#47;search_photo?q=%E7%8E%8B%E7%A5%96%E8%B4%A4&amp;limit=20&amp;start=0","user_name":"作者回复","comment_id":56968,"uid":"1306094","ip_address":"","utype":1,"ctime":1547364072,"user_name_real":"cy"}],"discussion_count":2,"race_medal":0,"score":"27316392892","product_id":100021701,"comment_content":"老师：为什么我在豆瓣网查询图片的网址与你不一样？https:&#47;&#47;www.douban.com&#47;search?cat=1025&amp;q=王祖贤&amp;source=suggest  。是什么原因？","like_count":6,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435338,"discussion_content":"咱们访问豆瓣查询图片的网址应该是一样的。只是我给出的是json的链接。方法是：用Chrome浏览器的开发者工具，可以监测出来网页中是否有json数据的传输，所以我给出的链接是json数据传输的链接 https://www.douban.com/j/search_photo?q=%E7%8E%8B%E7%A5%96%E8%B4%A4&amp;amp;limit=20&amp;amp;start=0","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547364072,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1115232,"avatar":"https://static001.geekbang.org/account/avatar/00/11/04/60/64d166b6.jpg","nickname":"Fan","note":"","ucode":"3BF28670FD9407","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384964,"discussion_content":"为啥我的访问 https://www.douban.com/j/search_photo?q=%E7%8E%8B%E7%A5%96%E8%B4%A4&amp;limit=20&amp;start=0 返回的空内容呢？ { }","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1626835517,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":170896,"user_name":"图吐兔","can_delete":false,"product_type":"c1","uid":1167662,"ip_address":"","ucode":"2395E9506CBE0E","user_header":"https://static001.geekbang.org/account/avatar/00/11/d1/2e/d531b29b.jpg","comment_is_top":false,"comment_ctime":1578752852,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"23053589332","product_id":100021701,"comment_content":"用的是python3<br>requests.get(url)获取所有图片的路径此处需要稍作修改。<br>headers = {&#39;User-Agent&#39;:&#39;Mozilla&#47;5.0 (Windows NT 10.0; WOW64) AppleWebKit&#47;537.36 (KHTML, like Gecko) Chrome&#47;74.0.3729.157 Safari&#47;537.36&#39;}<br>requests.get(url,header)<br>请求要带上header，里面只需要加上user-Agent。推测豆瓣应该是对user-Agent做了检查，用来返回适配客户端的页面。","like_count":5,"discussions":[{"author":{"id":1167662,"avatar":"https://static001.geekbang.org/account/avatar/00/11/d1/2e/d531b29b.jpg","nickname":"图吐兔","note":"","ucode":"2395E9506CBE0E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":284044,"discussion_content":"用谷歌浏览器发请求，然后f12，在network里找你发送的请求就可以看到","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592438865,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1038780,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/d9/bc/a2803bb7.jpg","nickname":"鼎","note":"","ucode":"44BBCCBA901121","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":284007,"discussion_content":"请问headers是怎么查看的呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592412008,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56740,"user_name":"許敲敲","can_delete":false,"product_type":"c1","uid":1046681,"ip_address":"","ucode":"6486466820E7BF","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/99/8e760987.jpg","comment_is_top":false,"comment_ctime":1546532621,"is_pvip":false,"replies":[{"id":"21385","content":"NBA明星也是不错的选择","user_name":"作者回复","comment_id":56740,"uid":"1306094","ip_address":"","utype":1,"ctime":1547351555,"user_name_real":"cy"}],"discussion_count":1,"race_medal":0,"score":"23021369101","product_id":100021701,"comment_content":"要下载所有James 哈登的图片","like_count":5,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435205,"discussion_content":"NBA明星也是不错的选择","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547351555,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":174813,"user_name":"Miracle","can_delete":false,"product_type":"c1","uid":1758279,"ip_address":"","ucode":"74116B4D0C0760","user_header":"https://static001.geekbang.org/account/avatar/00/1a/d4/47/6d9f2da6.jpg","comment_is_top":false,"comment_ctime":1580396367,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"18760265551","product_id":100021701,"comment_content":"之前都是现成的数据，然后进行数据分析工作，现在突然需要自己爬数据的时候，有点艰难啊，这是第一次学习爬虫，先直接跑老师的代码， 遇到了这样的一个问题下面的一个问题， 花了很大的劲才搞定这个问题。然后借助今天的这个机会，也顺便进行了Python爬虫入门的学习，基于这节课的基础，把课上的两个例子进行了小实战，并且还用Python爬虫写了两个其他的实战，包括Python自动下载小说，Python下载表格数据，在Python下载小说里面，又学习了正则表达式皮毛， Python下载表格数据中，又学习了bs4的皮毛，整理了今天的成果写成了博客进行记录Python爬虫快速入门(https:&#47;&#47;blog.csdn.net&#47;wuzhongqiang&#47;article&#47;details&#47;104119800)。  上面有这节课的详细笔记和四个小实战项目，感兴趣的可以参考参考。 今天收获挺大。<br><br><br>运行代码总是出错：JSONDecodeError: Expecting value: line 1 column 1 (char 0)，这个怎么解决？ <br>首先进行输出调试，输出了一下html这个变量，也就是reques.get(url).text 这个变量，发现返回的竟然是空。 那肯定json.loads的时候出错啊，所以问题就在这，查了一下资料，虽然不知道什么原因，但是加了一个请求头好了。 <br> <br>headers = {<br>    &#39;Cookie&#39;:&#39;OCSSID=4df0bjva6j7ejussu8al3eqo03&#39;,<br>    &#39;User-Agent&#39;:&#39;Mozilla&#47;5.0 (Windows NT 10.0; Win64; x64) AppleWebKit&#47;537.36&#39;<br>                 &#39; (KHTML, like Gecko) Chrome&#47;68.0.3440.106 Safari&#47;537.36&#39;,<br>}<br><br>然后，再requests.get(url, headers=headers).text     这个问题就搞定。<br><br>","like_count":4,"discussions":[{"author":{"id":2037505,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/17/01/1c5309a3.jpg","nickname":"McKee Chen","note":"","ucode":"F74B76542FAB65","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":345506,"discussion_content":"果然解决了，楼主厉害","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611730069,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1505907,"avatar":"https://static001.geekbang.org/account/avatar/00/16/fa/73/3b9cbc69.jpg","nickname":"VictorWu","note":"","ucode":"94AA2A957CFA85","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":335344,"discussion_content":"遇到同样问题，谢谢解答","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608170952,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":161703,"user_name":"Geek_2008d9","can_delete":false,"product_type":"c1","uid":1783634,"ip_address":"","ucode":"12F1A8B98AD5F7","user_header":"https://static001.geekbang.org/account/avatar/00/1b/37/52/c1c56b6f.jpg","comment_is_top":false,"comment_ctime":1576302653,"is_pvip":false,"replies":[{"id":"62609","content":"JSON解析错误，可以使用try ... except ... 捕获下错误看看","user_name":"作者回复","comment_id":161703,"uid":"1306094","ip_address":"","utype":1,"ctime":1577074182,"user_name_real":"cy"}],"discussion_count":3,"race_medal":0,"score":"18756171837","product_id":100021701,"comment_content":"为什么我总是response=json.loads那一行显示json.decoder.JSONDecoderError:expecting value:line 1 column 1(char 0) 呢，怎么解决啊，各位大佬","like_count":4,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477821,"discussion_content":"JSON解析错误，可以使用try ... except ... 捕获下错误看看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577074182,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1222119,"avatar":"https://static001.geekbang.org/account/avatar/00/12/a5/e7/815acbf7.jpg","nickname":"warm_day","note":"","ucode":"3CD078E809497C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":127043,"discussion_content":"# coding:utf-8\nimport requests\nimport json\n\nquery = &#39;王祖贤&#39;\n&#39;&#39;&#39; 下载图片 &#39;&#39;&#39;\n\n\ndef download(src, id):\n    dir = &#39;./&#39; + str(id) + &#39;.jpg&#39;\n    try:\n        pic = requests.get(src, timeout=10)\n        fp = open(dir, &#39;wb&#39;)\n        fp.write(pic.content)\n        fp.close()\n    except requests.exceptions.ConnectionError:\n        print(&#39;图片无法下载&#39;)\n\n\n&#39;&#39;&#39; for 循环 请求全部的 url &#39;&#39;&#39;\nfor i in range(0, 60, 20):\n    url = &#34;https://www.douban.com/j/search_photo?q=&#34; + query + &#34;&amp;limit=20&amp;start=&#34; + str(i)\n    print(url)\n    html = requests.get(url=url, headers={\n    &#34;Host&#34;: &#34;www.douban.com&#34;,\n    &#34;Connection&#34;: &#34;keep-alive&#34;,\n    &#34;Cache-Control&#34;: &#34;max-age=0&#34;,\n    &#34;Upgrade-Insecure-Requests&#34;: &#34;1&#34;,\n    &#34;User-Agent&#34;: &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.142 Safari/537.36&#34;,\n    &#34;Accept&#34;: &#34;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3&#34;,\n    &#34;Accept-Encoding&#34;: &#34;gzip, deflate&#34;,\n    &#34;Accept-Language&#34;: &#34;zh-CN,zh;q=0.9&#34;,\n    &#34;Cookie&#34;: &#34;_vwo_uuid_v2=DE81BD2137D14D63DD42F3DDA8A5985E8|15a55c5fefbfcb39af21944efc459ce3; douban-fav-remind=1; _ga=GA1.2.410204347.15382292&#34;,\n\n}).text # 得到返回结果\n    try:\n        response = json.loads(html, encoding=&#39;utf-8&#39;)\n        for image in response[&#39;images&#39;]:\n            print(image[&#39;src&#39;])  # 查看当前下载的图片网址\n            download(image[&#39;src&#39;], image[&#39;id&#39;])\n    except:\n       print(&#34;解析错误&#34;)  # 将 JSON 格式转换成 Python 对象\n\n# 下载一张图片\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1578562173,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1222119,"avatar":"https://static001.geekbang.org/account/avatar/00/12/a5/e7/815acbf7.jpg","nickname":"warm_day","note":"","ucode":"3CD078E809497C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":127044,"discussion_content":"我用的python3,你可以在get请求中添加headeas参数 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578562209,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":159457,"user_name":"Geek_c45626","can_delete":false,"product_type":"c1","uid":1693669,"ip_address":"","ucode":"86B91D63956FBA","user_header":"","comment_is_top":false,"comment_ctime":1575627074,"is_pvip":false,"replies":[{"id":"62608","content":"可以使用 try ... except ... 捕获下错误看看","user_name":"作者回复","comment_id":159457,"uid":"1306094","ip_address":"","utype":1,"ctime":1577074104,"user_name_real":"cy"}],"discussion_count":7,"race_medal":0,"score":"14460528962","product_id":100021701,"comment_content":"老师，运行代码总是出错：JSONDecodeError: Expecting value: line 1 column 1 (char 0)，这个怎么解决？","like_count":3,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477067,"discussion_content":"可以使用 try ... except ... 捕获下错误看看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577074104,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1222119,"avatar":"https://static001.geekbang.org/account/avatar/00/12/a5/e7/815acbf7.jpg","nickname":"warm_day","note":"","ucode":"3CD078E809497C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":127041,"discussion_content":"# coding:utf-8\nimport requests\nimport json\n\nquery = &#39;王祖贤&#39;\n&#39;&#39;&#39; 下载图片 &#39;&#39;&#39;\n\n\ndef download(src, id):\n    dir = &#39;./&#39; + str(id) + &#39;.jpg&#39;\n    try:\n        pic = requests.get(src, timeout=10)\n        fp = open(dir, &#39;wb&#39;)\n        fp.write(pic.content)\n        fp.close()\n    except requests.exceptions.ConnectionError:\n        print(&#39;图片无法下载&#39;)\n\n\n&#39;&#39;&#39; for 循环 请求全部的 url &#39;&#39;&#39;\nfor i in range(0, 60, 20):\n    url = &#34;https://www.douban.com/j/search_photo?q=&#34; + query + &#34;&amp;limit=20&amp;start=&#34; + str(i)\n    print(url)\n    html = requests.get(url=url, headers={\n    &#34;Host&#34;: &#34;www.douban.com&#34;,\n    &#34;Connection&#34;: &#34;keep-alive&#34;,\n    &#34;Cache-Control&#34;: &#34;max-age=0&#34;,\n    &#34;Upgrade-Insecure-Requests&#34;: &#34;1&#34;,\n    &#34;User-Agent&#34;: &#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.142 Safari/537.36&#34;,\n    &#34;Accept&#34;: &#34;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3&#34;,\n    &#34;Accept-Encoding&#34;: &#34;gzip, deflate&#34;,\n    &#34;Accept-Language&#34;: &#34;zh-CN,zh;q=0.9&#34;,\n    &#34;Cookie&#34;: &#34;_vwo_uuid_v2=DE81BD2137D14D63DD42F3DDA8A5985E8|15a55c5fefbfcb39af21944efc459ce3; douban-fav-remind=1; _ga=GA1.2.410204347.15382292&#34;,\n\n}).text # 得到返回结果\n    try:\n        response = json.loads(html, encoding=&#39;utf-8&#39;)\n        for image in response[&#39;images&#39;]:\n            print(image[&#39;src&#39;])  # 查看当前下载的图片网址\n            download(image[&#39;src&#39;], image[&#39;id&#39;])\n    except:\n       print(&#34;解析错误&#34;)  # 将 JSON 格式转换成 Python 对象\n\n# 下载一张图片\n","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1578562104,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1222119,"avatar":"https://static001.geekbang.org/account/avatar/00/12/a5/e7/815acbf7.jpg","nickname":"warm_day","note":"","ucode":"3CD078E809497C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":127042,"discussion_content":"我用的python3,用此方法，需要添加headers","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578562156,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1068361,"avatar":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","nickname":"明翼","note":"","ucode":"E77F86BEB3D5C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":92159,"discussion_content":"额、我也遇到了解决了吗？html内容打印又报编码错误，，哎","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576853309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1527138,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4d/62/0fe9cbb3.jpg","nickname":"William～Zhang","note":"","ucode":"8659B589428F11","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1068361,"avatar":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","nickname":"明翼","note":"","ucode":"E77F86BEB3D5C1","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":182692,"discussion_content":"html = requests.get(url=url,headers={\n        &#34;User-Agent&#34;: &#34;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.130 Safari/537.36&#34;\n    }).text","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1582448448,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":92159,"ip_address":""},"score":182692,"extra":""},{"author":{"id":1659590,"avatar":"https://static001.geekbang.org/account/avatar/00/19/52/c6/8eb48963.jpg","nickname":"一纸书","note":"","ucode":"C58A22B54521CA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1527138,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4d/62/0fe9cbb3.jpg","nickname":"William～Zhang","note":"","ucode":"8659B589428F11","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":226145,"discussion_content":"试了下,解决问题了\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586424938,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":182692,"ip_address":""},"score":226145,"extra":""},{"author":{"id":1236695,"avatar":"https://static001.geekbang.org/account/avatar/00/12/de/d7/14410058.jpg","nickname":"溪桥","note":"","ucode":"9DBA138C72C741","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1527138,"avatar":"https://static001.geekbang.org/account/avatar/00/17/4d/62/0fe9cbb3.jpg","nickname":"William～Zhang","note":"","ucode":"8659B589428F11","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":260843,"discussion_content":"谢谢大佬","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1588907290,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":182692,"ip_address":""},"score":260843,"extra":""}]}]},{"had_liked":false,"id":148319,"user_name":"qinggeouye","can_delete":false,"product_type":"c1","uid":1251536,"ip_address":"","ucode":"5B53EEDD7BEC9C","user_header":"https://static001.geekbang.org/account/avatar/00/13/18/d0/49b06424.jpg","comment_is_top":false,"comment_ctime":1572978525,"is_pvip":false,"replies":[{"id":"63768","content":"Good Job","user_name":"作者回复","comment_id":148319,"uid":"1306094","ip_address":"","utype":1,"ctime":1577540876,"user_name_real":"cy"}],"discussion_count":1,"race_medal":0,"score":"14457880413","product_id":100021701,"comment_content":"https:&#47;&#47;github.com&#47;qinggeouye&#47;GeekTime&#47;blob&#47;master&#47;DataAnalysis&#47;10_crawl_xpath.py<br><br>import os<br>import requests<br>from lxml import etree<br>from selenium import webdriver<br><br>search_text = &#39;王祖贤&#39;<br>start = 0  # 请求 url 的 start 从 0 开始，每一页间隔 15，有 6 页<br>total = 90<br>limit = 15<br><br># 电影海报图片地址<br>src_xpath = &quot;&#47;&#47;div[@class=&#39;item-root&#39;]&#47;a[@class=&#39;cover-link&#39;]&#47;img[@class=&#39;cover&#39;]&#47;@src&quot;<br># 电影海报图片title<br>title_xpath = &quot;&#47;&#47;div[@class=&#39;item-root&#39;]&#47;div[@class=&#39;detail&#39;]&#47;div[@class=&#39;title&#39;]&#47;a[@class=&#39;title-text&#39;]&quot;<br><br># 保存目录<br>pic_path = &#39;10&#47;xpath&#39;  # 相对目录<br># WebDriver 创建一个 Chrome 浏览器的 drive<br>driver = webdriver.Chrome(&#39;.&#47;chromedriver&#39;)  # MAC 版本<br><br><br># 创建图片保存路径<br>def mk_save_path(pic_path_):<br>    if not os.path.exists(pic_path_):<br>        os.makedirs(pic_path_)<br>    return os.getcwd() + &#39;&#47;&#39; + pic_path_ + &#39;&#47;&#39;<br><br><br># 下载图片<br>def download(src, pic_id, save_path_):<br>    directory = save_path_ + str(pic_id) + &#39;.jpg&#39;<br>    try:<br>        pic = requests.get(src, timeout=10)<br>        fp = open(directory, &#39;wb&#39;)<br>        fp.write(pic.content)<br>        fp.close()<br>    except requests.exceptions.ConnectionError:<br>        print(&#39;图片如无法下载&#39;)<br><br><br>def get_response_xpath():<br>    save_path = mk_save_path(pic_path)<br>    for i in range(start, total, limit):<br>        requests_url = &#39;https:&#47;&#47;search.douban.com&#47;movie&#47;subject_search?search_text=&#39; + search_text + &#39;&amp;cat=1002&#39; + \\<br>                       &#39;&amp;start=&#39; + str(i)<br>        driver.get(url=requests_url)<br>        html = etree.HTML(driver.page_source)<br>        src_list = html.xpath(src_xpath)<br>        title_list = html.xpath(title_xpath)<br>        for src, title in zip(src_list, title_list):<br>            download(src, title.text, save_path)<br><br><br>if __name__ == &#39;__main__&#39;:<br>    get_response_xpath()","like_count":3,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473459,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577540876,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56824,"user_name":"Yezhiwei","can_delete":false,"product_type":"c1","uid":1005157,"ip_address":"","ucode":"31E8E33688CBEC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/56/65/22a37a8e.jpg","comment_is_top":false,"comment_ctime":1546564847,"is_pvip":false,"replies":[{"id":"21388","content":"网站的抓取和网页的HTML结构有很大关系，所以一般都是用XPath解析，如果你用第三方工具，比如八爪鱼，也是要个性化的把每个网站流程模拟出来，这样工具会自动定位XPath<br>网站的抓取和网页的HTML结构有很大关系，所以一般都是用XPath解析，如果你用第三方工具，比如八爪鱼，也是要个性化的把每个网站流程模拟出来，这样工具会自动定位XPath<br>如果想要做一个通用的解决方案，自动识别文章的标题和内容。就需要先把HTML下载下来，然后将HTML解析为DOM树，再对每个节点做评估（文章标题还是内容的可能性）<br>这样做的好处是通用性强，缺点就是可能会出错。","user_name":"作者回复","comment_id":56824,"uid":"1306094","ip_address":"","utype":1,"ctime":1547353722,"user_name_real":"cy"}],"discussion_count":1,"race_medal":0,"score":"14431466735","product_id":100021701,"comment_content":"用Scrapy爬取数据更方便哈，请问老师怎么做一个通用的爬虫呢？比如要爬取文章标题和内容，不同的网站Xpath结构不一样，如果源少的话可以分别配置，但如果要爬取几百上千的网站数据，分别配置Xpath挺麻烦的。请问这个问题有什么解决方案吗？谢谢","like_count":3,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435258,"discussion_content":"网站的抓取和网页的HTML结构有很大关系，所以一般都是用XPath解析，如果你用第三方工具，比如八爪鱼，也是要个性化的把每个网站流程模拟出来，这样工具会自动定位XPath\n网站的抓取和网页的HTML结构有很大关系，所以一般都是用XPath解析，如果你用第三方工具，比如八爪鱼，也是要个性化的把每个网站流程模拟出来，这样工具会自动定位XPath\n如果想要做一个通用的解决方案，自动识别文章的标题和内容。就需要先把HTML下载下来，然后将HTML解析为DOM树，再对每个节点做评估（文章标题还是内容的可能性）\n这样做的好处是通用性强，缺点就是可能会出错。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547353722,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":159455,"user_name":"Geek_c45626","can_delete":false,"product_type":"c1","uid":1693669,"ip_address":"","ucode":"86B91D63956FBA","user_header":"","comment_is_top":false,"comment_ctime":1575626843,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10165561435","product_id":100021701,"comment_content":"运行代码总是出现错误：JSONDecodeError: Expecting value: line 1 column 1 (char 0)","like_count":2},{"had_liked":false,"id":70681,"user_name":"爱喝酸奶的程序员","can_delete":false,"product_type":"c1","uid":1274352,"ip_address":"","ucode":"3FDB0AC2854274","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJjiaBHJyfAKK02CCcibkqI0jpaHJEcyrTRI4xbrqHCWiaia88WQs4r8zJVmHfibqricUYeUT2ezAZAC7wQ/132","comment_is_top":false,"comment_ctime":1551163003,"is_pvip":false,"replies":[{"id":"64503","content":"可以用 无界面的puppetteer ","user_name":"作者回复","comment_id":70681,"uid":"1306094","ip_address":"","utype":1,"ctime":1577620166,"user_name_real":"cy"}],"discussion_count":1,"race_medal":0,"score":"10141097595","product_id":100021701,"comment_content":"有个问题selenium，是用来自动化测试的，他回打开浏览器……我做爬虫是不想让代码打开浏览器，只想要他爬取的动作～要怎么办呢？","like_count":2,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":440767,"discussion_content":"可以用 无界面的puppetteer ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577620166,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57291,"user_name":"ldw","can_delete":false,"product_type":"c1","uid":1339627,"ip_address":"","ucode":"51B0DE3F6FE278","user_header":"https://static001.geekbang.org/account/avatar/00/14/70/eb/e7a2dba9.jpg","comment_is_top":false,"comment_ctime":1546731668,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10136666260","product_id":100021701,"comment_content":"可以用爬虫爬谷歌吗？会不会被当成恶意攻击？不会引来国际官司吧。","like_count":2},{"had_liked":false,"id":196577,"user_name":"十六。","can_delete":false,"product_type":"c1","uid":1935100,"ip_address":"","ucode":"DD4A02E3D904D5","user_header":"","comment_is_top":false,"comment_ctime":1585294290,"is_pvip":false,"replies":[{"id":"104224","content":"加油哦！","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1617731580,"ip_address":"","comment_id":196577,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5880261586","product_id":100021701,"comment_content":"由于python学习是爬虫上手的，爬虫还是会一点的，哈哈，去下一章了ღ( ´･ᴗ･` )","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489334,"discussion_content":"加油哦！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617731580,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":179792,"user_name":"陈金鑫","can_delete":false,"product_type":"c1","uid":1077127,"ip_address":"","ucode":"609A24832CA80C","user_header":"https://static001.geekbang.org/account/avatar/00/10/6f/87/669263b4.jpg","comment_is_top":false,"comment_ctime":1582100291,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5877067587","product_id":100021701,"comment_content":"请问老师代码的GitHub地址是啥？","like_count":1},{"had_liked":false,"id":164164,"user_name":"明翼","can_delete":false,"product_type":"c1","uid":1068361,"ip_address":"","ucode":"E77F86BEB3D5C1","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","comment_is_top":false,"comment_ctime":1576897675,"is_pvip":false,"replies":[{"id":"62580","content":"不错~ 链接已失效，可以把文章名称发出来","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577070792,"ip_address":"","comment_id":164164,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5871864971","product_id":100021701,"comment_content":"我在实践这篇过程中遇到了很多问题，最终解决了，写在我的公众号里面，运行代码有问题的同学可以参考下：<br>https:&#47;&#47;mp.weixin.qq.com&#47;s?__biz=MjM5OTE4MzcyNA==&amp;tempkey=MTA0MF95UW5FRmVZZURiWVR2ZWZiZVVaUEctS3FhUF90OVljc3RZTEV6eHpKSjF3NlpxMjhMcXdoU2trV2Y1RzdCQXZQamptXzZTODZNbGw0U3ZmMlhzT1BFOWZWeXhaOTM3bHFITjl6dVBLbUxfSlI4ZG15bFpvYnpvUTJienlKOWx2M0V1QURvZWVZUU1rTVRudk96WXZTb01qekdEWmJhaW5zMDd3OFB3fn4%3D&amp;chksm=3f29d0a1085e59b7d37190f6e8580bc03526dca518fc70e844a76ae1a571bc90d88ac52acc88#rd","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478665,"discussion_content":"不错~ 链接已失效，可以把文章名称发出来","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577070792,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1068361,"avatar":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","nickname":"明翼","note":"","ucode":"E77F86BEB3D5C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":93092,"discussion_content":"https://mp.weixin.qq.com/s/y16eg0LY4vqLluxmw8UmOA","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1576906392,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1068361,"avatar":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","nickname":"明翼","note":"","ucode":"E77F86BEB3D5C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":93093,"discussion_content":"这个地址原来地址好长……","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576906407,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":147790,"user_name":"qinggeouye","can_delete":false,"product_type":"c1","uid":1251536,"ip_address":"","ucode":"5B53EEDD7BEC9C","user_header":"https://static001.geekbang.org/account/avatar/00/13/18/d0/49b06424.jpg","comment_is_top":false,"comment_ctime":1572889950,"is_pvip":false,"replies":[{"id":"62684","content":"赞 认真练习&amp;分享的同学","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577084367,"ip_address":"","comment_id":147790,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5867857246","product_id":100021701,"comment_content":"https:&#47;&#47;github.com&#47;qinggeouye&#47;GeekTime&#47;blob&#47;master&#47;DataAnalysis&#47;10_crawl.py<br><br># coding: utf-8<br>import os<br><br>import requests<br>import json<br><br><br># 下载图片<br>def download(src, pic_id, save_path_):<br>    directory = save_path_ + str(pic_id) + &#39;.jpg&#39;<br><br>    try:<br>        pic = requests.get(src, timeout=10)<br>        fp = open(directory, &#39;wb&#39;)<br>        fp.write(pic.content)<br>        fp.close()<br>    except requests.exceptions.ConnectionError:<br>        print(&#39;图片如无法下载&#39;)<br><br><br># 获取返回页面内容<br>def get_resp(query_, limit_, start_):<br>    url_ = &#39;https:&#47;&#47;www.douban.com&#47;j&#47;search_photo?q=&#39; + query_ + &#39;&amp;limit=&#39; + str(limit_) + &#39;&amp;start=&#39; + str(start_)<br>    html_ = requests.get(url_).text  # 得到返回结果<br>    response_ = json.loads(html_, encoding=&#39;utf-8&#39;)  # 将 JSON 格式转换为 Python 对象<br>    return response_<br><br><br>query = &#39;王祖贤&#39;<br>limit = 20<br>start = 0<br><br>&#39;&#39;&#39; 获取图片总数量 &#39;&#39;&#39;<br>total = get_resp(query, limit, start)[&#39;total&#39;]<br>print(total)<br><br>pic_path = &#39;10&#39;  # 相对目录<br>if not os.path.exists(pic_path):<br>    os.mkdir(pic_path)<br>save_path = os.getcwd() + &#39;&#47;&#39; + pic_path + &#39;&#47;&#39;<br><br># 循环 请求全部的 url<br>for i in range(start, total, limit):<br>    response = get_resp(query, limit, i)<br>    for image in response[&#39;images&#39;]:<br>        print(image[&#39;src&#39;])  # 查看当前下载的图片地址<br>        download(image[&#39;src&#39;], image[&#39;id&#39;], save_path)  # 下载一张图片<br>","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473307,"discussion_content":"赞 认真练习&amp;amp;分享的同学","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577084367,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1251536,"avatar":"https://static001.geekbang.org/account/avatar/00/13/18/d0/49b06424.jpg","nickname":"qinggeouye","note":"","ucode":"5B53EEDD7BEC9C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":44921,"discussion_content":"https://github.com/qinggeouye/GeekTime/blob/master/DataAnalysis/10_crawl_json.py","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572978446,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114571,"user_name":"图·美克尔","can_delete":false,"product_type":"c1","uid":1076720,"ip_address":"","ucode":"021FB5AE110066","user_header":"https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eppQqDE6TNibvr3DNdxG323AruicIgWo5DpVr6U7yZVNkbF2rKluyDfhdpgAEcYEOZTAnbrMdTzFkUw/0","comment_is_top":false,"comment_ctime":1563341472,"is_pvip":false,"replies":[{"id":"63688","content":"这个也不错","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577528297,"ip_address":"","comment_id":114571,"utype":1}],"discussion_count":1,"race_medal":1,"score":"5858308768","product_id":100021701,"comment_content":"我更喜欢用bs4美味汤","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458730,"discussion_content":"这个也不错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577528297,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114418,"user_name":"dany","can_delete":false,"product_type":"c1","uid":1185926,"ip_address":"","ucode":"0990375202642F","user_header":"https://static001.geekbang.org/account/avatar/00/12/18/86/3599130b.jpg","comment_is_top":false,"comment_ctime":1563294468,"is_pvip":false,"replies":[{"id":"63693","content":"这个文件的当前目录里找下","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577528410,"ip_address":"","comment_id":114418,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5858261764","product_id":100021701,"comment_content":"download到哪里去了？不好意思我是菜鸟","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458654,"discussion_content":"这个文件的当前目录里找下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577528410,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":106341,"user_name":"白色纯度","can_delete":false,"product_type":"c1","uid":1563854,"ip_address":"","ucode":"7ABC830EE468A1","user_header":"https://static001.geekbang.org/account/avatar/00/17/dc/ce/03fdeb60.jpg","comment_is_top":false,"comment_ctime":1561274243,"is_pvip":false,"replies":[{"id":"64034","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577607895,"ip_address":"","comment_id":106341,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5856241539","product_id":100021701,"comment_content":"网址：豆瓣电影；任务：批量下载赵丽颖电影海报（支持翻页，自定义终止下载量）；python3.X；<br>浏览器：Google Chrome ；唯一要注意的是webdriver的路径。全都是这门课程里面的知识点<br># -*- coding: utf-8 -*-<br>import requests<br>from lxml import etree<br>from selenium import webdriver<br>import os<br><br>name = &#39;赵丽颖&#39;<br><br>def download(src, id):<br>    if not os.path.isdir(&quot;Xpath的翻页图片包&quot;):<br>        os.mkdir(&quot;Xpath的翻页图片包&quot;)<br>    dir = os.path.join(&quot;Xpath的翻页图片包&#47;&quot;, str(id) + &#39;.webp&#39;)<br>    try:<br>        pic = requests.get(src, timeout = 10)<br>        with open(dir, &#39;wb&#39;) as d:<br>            d.write(pic.content)<br>    except requests.exceptions.ConnectionError:<br>        print(&quot;图片无法下载&quot;)<br><br>def down_load(request_url):<br>    driver.get(request_url)<br>    html = etree.HTML(driver.page_source)<br>    src_xpath = &quot;&#47;&#47;div[@class=&#39;item-root&#39;]&#47;a[@class=&#39;cover-link&#39;]&#47;img[@class=&#39;cover&#39;]&#47;@src&quot;<br>    title_xpath = &quot;&#47;&#47;div[@class=&#39;item-root&#39;]&#47;div[@class=&#39;detail&#39;]&#47;div[@class=&#39;title&#39;]&#47;a[@class=&#39;title-text&#39;]&quot;<br>    srcs = html.xpath(src_xpath)<br><br><br>    titles = html.xpath(title_xpath)<br>    num = len(srcs)<br>    if num &gt; 15:<br>        srcs = srcs[1:]<br>        titles = titles[1:]<br><br>    for src, title in zip(srcs, titles):<br>        if title is None:<br>            continue<br>        print(src)<br>        download(src, title.text)<br>    print(&#39;OK&#39;)<br>    print(num)<br>    if num &gt;= 1:<br>        return True<br>    else:<br>        return False<br><br>if __name__ == &#39;__main__&#39;:<br>    requests_url = &quot;https:&#47;&#47;movie.douban.com&#47;subject_search?search_text=&quot; + name<br>    driver = webdriver.Chrome(executable_path=r&#39;C:\\Users\\XXX\\AppData\\Local\\Google\\Chrome\\Application\\chromedriver.exe&#39;)<br>    driver.get(requests_url)<br>    html = etree.HTML(driver.page_source)<br>    print(html)<br><br>    base_url = &#39;https:&#47;&#47;movie.douban.com&#47;subject_search?search_text=&#39; + name + &#39;&amp;cat=1002&amp;start=&#39;<br>    start = 0<br>    while start &lt; 70:<br>        request_url = base_url + str(start)<br>        flag = down_load(request_url)<br>        if flag:<br>            start += 15<br>        else:<br>            break<br>    print(&quot;结束&quot;)","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":455051,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577607895,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043589,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKBrC7cQHD67A7yLqqD8nGghMeQUOT5iayhyRPYaxPicZIv6XyuApwkbRK470IoE84b52Tx0reUibc2A/132","nickname":"一叶湘伦","note":"","ucode":"2D4C339011C327","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":79750,"discussion_content":"大佬您好，有个问题我想请教下您。关于图片存放路径那儿，我不是很明白，如果在windows环境下，路径的格式不应该跟您chromedriver的路径格式一样，在哪个盘，哪个文件夹，之间用\\分割吗？万分感谢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576109591,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1563854,"avatar":"https://static001.geekbang.org/account/avatar/00/17/dc/ce/03fdeb60.jpg","nickname":"白色纯度","note":"","ucode":"7ABC830EE468A1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1043589,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKBrC7cQHD67A7yLqqD8nGghMeQUOT5iayhyRPYaxPicZIv6XyuApwkbRK470IoE84b52Tx0reUibc2A/132","nickname":"一叶湘伦","note":"","ucode":"2D4C339011C327","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":136555,"discussion_content":"不一样的，文件存放路径默认和python代码文件的地址一致。driver只是一个引用地址，就好比你自己打开C盘的一个文件中的链接，自己不指定路径下载图片，那么图片会默认保存在默认路径。而跟你的C盘文件地址无关。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579148194,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":79750,"ip_address":""},"score":136555,"extra":""}]}]},{"had_liked":false,"id":104491,"user_name":"Wing·三金","can_delete":false,"product_type":"c1","uid":1341402,"ip_address":"","ucode":"6B9F5822C3717F","user_header":"https://static001.geekbang.org/account/avatar/00/14/77/da/54c663f3.jpg","comment_is_top":false,"comment_ctime":1560764246,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5855731542","product_id":100021701,"comment_content":"练习内容：使用 XPath 下载宫崎骏相关的电影海报！！！<br><br>源码如下：<br>&#39;&#39;&#39; To download all pages &#39;&#39;&#39;<br><br>### use webdriver to simulate page loading<br>from selenium import webdriver<br>import requests<br>from lxml import etree<br>import pyprind<br>import time<br>import re<br><br>def download_pics(src, p_id):<br>    &#39;&#39;&#39; 下载指定图片 &#39;&#39;&#39;<br>    <br>    save_dir = &#39;pics&#47;&#39;<br>    if isinstance(p_id, str):<br>        # 过滤非法的文件名符号<br>        p_id = re.sub(r&#39;[\\\\&#47;:?|*]+&#39;, &#39; &#39;, p_id)<br>        save_dir += p_id + &#39;.jpg&#39;<br>    else:<br>        save_dir += str(p_id) + &#39;.jpg&#39;<br>    try:<br>        pic = requests.get(src, timeout=10)<br>        with open(save_dir, &#39;wb&#39;) as fout:<br>            fout.write(pic.content)<br>    except requests.exceptions.ConnectionError:<br>        print(&#39;无法连接到图片 %d&#39; % p_id)<br><br>    return True<br><br>request_url = &quot;https:&#47;&#47;movie.douban.com&#47;subject_search?search_text=%E5%AE%AB%E5%B4%8E%E9%AA%8F&amp;cat=1002&quot;<br>driver = webdriver.Chrome()<br><br># 通过观察不同页码下的网页地址，大概有140个搜索结果<br>for i in range(0, 136, 15):<br>    driver.get(request_url + &quot;&amp;start=&quot; + str(i))<br>    driver.implicitly_wait(10)<br>    # 一个小小的防被封 IP 措施<br>    time.sleep(3)<br><br>    html = driver.execute_script(&quot;return document.documentElement.outerHTML&quot;)<br>    # html = requests.get(request_url).text<br>    html = etree.HTML(html)<br><br>    src_xpath = &quot;&#47;&#47;div[@class=&#39;item-root&#39;]&#47;a&#47;img&#47;@src&quot;<br>    title_xpath = &quot;&#47;&#47;div&#47;div&#47;div&#47;a[@class=&#39;title-text&#39;]&quot;<br>    srcs = html.xpath(src_xpath)<br>    titles = html.xpath(title_xpath)<br><br>    # 一个用来显示进度百分数的包<br>    pper = pyprind.ProgPercent(len(srcs))<br>    for src, title in zip(srcs, titles):<br>        download_pics(src, title.text)<br>        pper.update()","like_count":1},{"had_liked":false,"id":101938,"user_name":"云深不知处","can_delete":false,"product_type":"c1","uid":1508046,"ip_address":"","ucode":"4D52B825CD0665","user_header":"https://static001.geekbang.org/account/avatar/00/17/02/ce/57c871e0.jpg","comment_is_top":false,"comment_ctime":1560062131,"is_pvip":false,"replies":[{"id":"37087","content":"谢谢 多练习&amp;总结","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1560259200,"ip_address":"","comment_id":101938,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5855029427","product_id":100021701,"comment_content":"结合老师和精选留言源码，抓取“王祖贤”图片和电影海报，代码在自己环境中调试成功，还挺有趣。","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":453180,"discussion_content":"谢谢 多练习&amp;amp;总结","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560259200,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":100699,"user_name":"Andre","can_delete":false,"product_type":"c1","uid":1563047,"ip_address":"","ucode":"2713749A29A4E0","user_header":"https://static001.geekbang.org/account/avatar/00/17/d9/a7/a794afb1.jpg","comment_is_top":false,"comment_ctime":1559618544,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5854585840","product_id":100021701,"comment_content":"本来的想法是一天学2-3讲，但是发现要实际的学到东西可能一天学一节课就很吃力了","like_count":1},{"had_liked":false,"id":85070,"user_name":"chitanda","can_delete":false,"product_type":"c1","uid":1235077,"ip_address":"","ucode":"B3E28E1C8E410B","user_header":"https://static001.geekbang.org/account/avatar/00/12/d8/85/21fd42fa.jpg","comment_is_top":false,"comment_ctime":1554970932,"is_pvip":false,"replies":[{"id":"64271","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577615782,"ip_address":"","comment_id":85070,"utype":1}],"discussion_count":1,"race_medal":2,"score":"5849938228","product_id":100021701,"comment_content":"分享一个可以在专题页面下载茅野爱衣缩略图的脚本，src_xpath = &quot;&#47;&#47;img[@class=&#39;&#39;]&#47;@src&quot;中的class=&#39;&#39; 让我搞了半天，至今不知道为什么不存在class name时必须加一句class=&#39;&#39;，下面是代码<br>import os<br>import uuid<br><br>from lxml import etree<br><br>import requests<br><br><br>def download(src, name=None):<br>    if not name:<br>        name = uuid.uuid1()<br>    if not os.path.isdir(&#39;Kayano&#39;):<br>        os.mkdir(&#39;Kayano&#39;)<br>    adir = os.path.join(&#39;Kayano&#47;&#39;, str(name) + &#39;.jpg&#39;)<br>    try:<br>        pic = requests.get(src, timeout=10)<br>        with open(adir, &#39;wb&#39;) as f:<br>            f.write(pic.content)<br>    except requests.exceptions.ConnectionError:<br>        print(&#39;图片无法下载&#39;)<br><br><br>if __name__ == &#39;__main__&#39;:<br>    <br>    from selenium import webdriver<br>    <br>    request_url = &#39;https:&#47;&#47;movie.douban.com&#47;celebrity&#47;1314532&#47;photos&#47;&#39;<br>    driver = webdriver.Chrome(executable_path=&#39;chromedriver.exe&#39;)<br>    driver.get(request_url)<br>    html = etree.HTML(driver.page_source)<br>    <br>    src_xpath = &quot;&#47;&#47;img[@class=&#39;&#39;]&#47;@src&quot;<br>    srcs = html.xpath(src_xpath)<br>    for src in srcs:<br>        download(src)<br>","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446545,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577615782,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":69560,"user_name":"皮蛋","can_delete":false,"product_type":"c1","uid":1202619,"ip_address":"","ucode":"8384CC338549EB","user_header":"https://static001.geekbang.org/account/avatar/00/12/59/bb/caf2b06c.jpg","comment_is_top":false,"comment_ctime":1550766307,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5845733603","product_id":100021701,"comment_content":"Selenium ide火狐插件可以自动生成模拟的脚本","like_count":1},{"had_liked":false,"id":66443,"user_name":"王彬成","can_delete":false,"product_type":"c1","uid":1015045,"ip_address":"","ucode":"386803B8FC2DD5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7d/05/4bad0c7c.jpg","comment_is_top":false,"comment_ctime":1549940106,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5844907402","product_id":100021701,"comment_content":"在讲解“如何使用 XPath 自动下载王祖贤的电影海报封面”的内容时，希望能给出完整的代码块。因为感觉很凌乱，不知如何下手。<br>看了留言中的代码块，下载下来的海报文件也无法打开<br>","like_count":1},{"had_liked":false,"id":63580,"user_name":"易平","can_delete":false,"product_type":"c1","uid":1356284,"ip_address":"","ucode":"87821C032D7499","user_header":"https://static001.geekbang.org/account/avatar/00/14/b1/fc/8503c08a.jpg","comment_is_top":false,"comment_ctime":1548406846,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5843374142","product_id":100021701,"comment_content":"求助大家帮忙解答<br>我的代码如下<br><br>#Xpath方式获取<br>request_url=&#39;https:&#47;&#47;movie.douban.com&#47;subject_search?search_text=%E7%8E%8B%E7%A5%96%E8%B4%A4&amp;cat=1002&#39;<br>src_xpath=&quot;&#47;&#47;div[@class=&#39;item-root&#39;]&#47;a[@class=&#39;cover-link&#39;]&#47;img[@class=&#39;cover&#39;]&#47;@src&quot;<br>title_xpath=&quot;&#47;&#47;div[@class=&#39;item-root&#39;]&#47;div[@class=&#39;detail&#39;]&#47;div[@class=&#39;title&#39;]&#47;a[@class=&#39;title-text&#39;]&quot;<br><br>from selenium import webdriver<br>from lxml import etree<br>driver=webdriver.Chrome(&#39;&#47;Users&#47;pyi&#47;python&#47;chromedriver&#47;chromedriver&#39;)<br>driver.get(request_url)<br>html2=etree.HTML(driver.page_source)<br>print(driver.page_source)<br><br>srcs=html2.xpath(src_xpath)<br>titles=html2.xpath(title_xpath)<br>for src, title in zip(srcs,titles):<br>    print(src+&#39;-----&#39;+title)<br>    download(src,title)<br><br>不知道为什么下面两个语句执行的结果不如预期：<br>srcs=html2.xpath(src_xpath)<br>titles=html2.xpath(title_xpath)<br>上面两个执行后提取出来的是类似下面的内容：<br><br>etree._ElementUnicodeResult 1 https:&#47;&#47;img1.doubanio.com&#47;view&#47;celebrity&#47;s_ratio_celebrity&#47;public&#47;p34797.webp<br><br><br>","like_count":1,"discussions":[{"author":{"id":1590236,"avatar":"https://static001.geekbang.org/account/avatar/00/18/43/dc/4f70c936.jpg","nickname":"一只眼看世界","note":"","ucode":"D221841AE5103F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":683,"discussion_content":"srcs 是正常的 , title_xpash 用这个//div[@class=&#39;item-root&#39;]/div[@class=&#39;detail&#39;]/div[@class=&#39;title&#39;]/a[@class=&#39;title-text&#39;]/text()  后面多个text()   用来取a标签中的文本    不加的话取的是元素","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561956969,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61367,"user_name":"竹本先生","can_delete":false,"product_type":"c1","uid":1357379,"ip_address":"","ucode":"83D292AACD1E20","user_header":"https://static001.geekbang.org/account/avatar/00/14/b6/43/c7b2a6f9.jpg","comment_is_top":false,"comment_ctime":1547686936,"is_pvip":false,"replies":[{"id":"64720","content":"Good Job!","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577624683,"ip_address":"","comment_id":61367,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5842654232","product_id":100021701,"comment_content":"# coding:utf-8<br>import requests as rq<br>import json<br>import re<br>from lxml import etree<br><br># 下载图片<br>def download(src, title):<br>\t# 过滤非法字符<br>\trstr = r&quot;[\\&#47;\\\\\\:\\*\\?\\&quot;\\&lt;\\&gt;\\|]&quot;<br>\ttitle = re.sub(rstr, &quot;&quot;, title)<br>\t<br>\tdir = &#39;.&#47;film_pic&#47;&#39; + str(title) + &#39;.jpg&#39;<br>\t<br>\ttry:<br>\t\tpic = rq.get(src, timeout=10)<br>\t\twith open(dir, &#39;wb&#39;) as fp:<br>\t\t\tfp.write(pic.content)<br>\texcept rq.exceptions.ConnectionError:<br>\t\treturn False<br>\telse:<br>\t\treturn True<br><br># 获取电影数量<br>def get_film_amount(performer_name):<br>\turl = &#39;https:&#47;&#47;www.douban.com&#47;j&#47;search?q=&#39; +performer_name+ &#39;&amp;start=0&amp;cat=1002&#39;<br>\tresult = rq.get(url)<br>\tresult_obj = json.loads(result.text)<br>\treturn int(result_obj[&#39;total&#39;])<br><br># 获取电影信息<br>def get_film_info(query_name):<br>\t# XPath规则<br>\ttitle_xpath = &quot;&#47;&#47;div[@class=&#39;content&#39;]&#47;div[@class=&#39;title&#39;]&#47;h3&#47;a&quot;<br>\tpic_xpath = &quot;&#47;&#47;div[@class=&#39;pic&#39;]&#47;a[@class=&#39;nbg&#39;]&#47;img&#47;@src&quot;<br><br>\ttitles = []<br>\tpics = []<br><br>\tfilm_amount = get_film_amount(query_name)<br><br>\tfor i in range(0, film_amount, 20):<br>\t\turl = &#39;https:&#47;&#47;www.douban.com&#47;j&#47;search?q=&#39; +query_name+ &#39;&amp;start=&#39;+str(i)+&#39;&amp;cat=1002&#39;<br>\t\tresult = rq.get(url)<br>\t\tresult_obj = json.loads(result.text)<br>\t\t<br>\t\tfor item in result_obj[&#39;items&#39;]:<br>\t\t\thtml = etree.HTML(item)<br>\t\t\ttmp_titles = html.xpath(title_xpath)<br>\t\t\ttmp_pics = html.xpath(pic_xpath)<br>\t\t\t<br>\t\t\tif &#39;default_small&#39; not in tmp_pics[0]:<br>\t\t\t\ttitles.append(tmp_titles[0].text.strip())<br>\t\t\t\tpics.append(tmp_pics[0])<br>\t<br>\treturn {&#39;name&#39;: query_name, &#39;amount&#39;: film_amount, &#39;list&#39;: zip(titles,pics)}<br><br>query_name_list = [&#39;周润发&#39;,&#39;甄子丹&#39;,&#39;周星驰&#39;,&#39;刘德华&#39;,&#39;王祖贤&#39;,&#39;元彪&#39;,&#39;靳东&#39;,&#39;王凯&#39;,&#39;张铁林&#39;,&#39;段奕宏&#39;,&#39;郑伊健&#39;,&#39;张耀扬&#39;,&#39;陈乔恩&#39;]<br><br>for query_name in query_name_list:<br>\tprint(query_name + &#39; 共有&#39; + str(get_film_amount(query_name)) + &#39;部电影&#39;)<br>\tfilm_info = get_film_info(query_name)<br>\torder = 1<br>\tfor title,src in film_info[&#39;list&#39;]:<br>\t\t<br>\t\tif download(src, query_name +&quot; - &quot;+ title):<br>\t\t\tprint(str(order).zfill(3) + &#39;. 下载成功：&#39; + title)<br>\t\telse:<br>\t\t\tprint(str(order).zfill(3) + &#39;. 下载失败：&#39; + title)<br>\t\torder += 1","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436852,"discussion_content":"Good Job!","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577624683,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57368,"user_name":"开心","can_delete":false,"product_type":"c1","uid":1273224,"ip_address":"","ucode":"9ECFB8642D42A3","user_header":"https://static001.geekbang.org/account/avatar/00/13/6d/88/d6e6ddcf.jpg","comment_is_top":false,"comment_ctime":1546766590,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5841733886","product_id":100021701,"comment_content":"极客时间上我购买的课能不能获取我每个课程的学习进度；如果我最近没有学，是不是要提醒我；我最近喜欢哪段时间学习；对每周给我的学习情况做个数据方面的总结；再结合历史数据评价我最近一周是否勤奋。这才有意思，让我学习曲线飞起来。","like_count":1,"discussions":[{"author":{"id":1613074,"avatar":"https://static001.geekbang.org/account/avatar/00/18/9d/12/8b15561c.jpg","nickname":"啷个哩个啷咚咚锵👻","note":"","ucode":"749725A3AA648A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2938,"discussion_content":"学完这门课 你可以自己做个分析","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564047290,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57318,"user_name":"CNxxxxx","can_delete":false,"product_type":"c1","uid":1243483,"ip_address":"","ucode":"FDF4F218C52E99","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ibrIw5sOVgfnH3JjKcYHcT5bbJUoaCST3anibeKrtbZLMtdO7t1ZmE3ZW2cgqs8dmDIdKMQag9MnXP5OgoMXqFeg/132","comment_is_top":false,"comment_ctime":1546745673,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5841712969","product_id":100021701,"comment_content":"好玩好玩。就是我用chromedriver会调用浏览器访问页面，不知道大家会不会<br># coding:utf-8<br>import requests<br>import json<br>from lxml import etree<br>from selenium import webdriver<br>url = &#39;https:&#47;&#47;www.douban.com&#47;j&#47;search_photo?q=麦迪&amp;limit=20&amp;start=0&#39;<br>html = requests.get(url).text<br>response = json.loads(html,encoding=&#39;utf-8&#39;)<br><br>def download(src,name):<br>    dir = &#39;.&#47;pic&#47;&#39; + name + &#39;.jpg&#39;<br>    try:<br>        pic = requests.get(src,timeout=10)<br>    except Exception:<br>        print(&quot;error,%s 当前图片无法下载&quot; % src)<br>    fp = open(dir,&#39;wb&#39;)<br>    fp.write(pic.content)<br>    fp.close()<br><br># print(response[&#39;images&#39;])<br># for photo in response[&#39;images&#39;]:<br>#     print(photo[&#39;src&#39;])<br>#     download(photo[&#39;src&#39;],photo[&#39;id&#39;])<br>driver = webdriver.Chrome(&#39;.&#47;chromedriver&#39;)<br>for start in range(0,120,15):<br>    url = &#39;https:&#47;&#47;movie.douban.com&#47;subject_search?search_text=&#39;+&#39;周星驰&#39;+&#39;&amp;cat=1002&#39;+&#39;&amp;start=&#39;+str(start)<br>    driver.get(url)<br>    #print(driver.page_source)<br>    html = etree.HTML(driver.page_source)<br>    src_xpath = &quot;&#47;&#47;*[@class=&#39;item-root&#39;]&#47;a&#47;img&#47;@src&quot;<br>    title_xpath = &quot;&#47;&#47;*[@class=&#39;item-root&#39;]&#47;div[@class=&#39;detail&#39;]&#47;div[@class=&#39;title&#39;]&#47;a&#47;text()&quot;<br>    srcs = html.xpath(src_xpath)<br>    titles = html.xpath(title_xpath)<br>    # print(srcs,titles)<br>    for src,title in zip(srcs,titles):<br>        print(src,title)<br>        download(src,title)<br>","like_count":1},{"had_liked":false,"id":57290,"user_name":"ldw","can_delete":false,"product_type":"c1","uid":1339627,"ip_address":"","ucode":"51B0DE3F6FE278","user_header":"https://static001.geekbang.org/account/avatar/00/14/70/eb/e7a2dba9.jpg","comment_is_top":false,"comment_ctime":1546731413,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5841698709","product_id":100021701,"comment_content":"网上最丰富的图片资源可能是谷歌的图片吧？他们不是号称把全网的内容都保存了镜像吗？<br>但是，用爬虫爬谷歌的话会不会被当成恶意攻击啊？会不会惹上国际官司啊？<br>请老师解惑。谢谢","like_count":1},{"had_liked":false,"id":57190,"user_name":"周萝卜","can_delete":false,"product_type":"c1","uid":1315039,"ip_address":"","ucode":"056A4426D14A45","user_header":"https://static001.geekbang.org/account/avatar/00/14/10/df/e4511752.jpg","comment_is_top":false,"comment_ctime":1546678027,"is_pvip":false,"replies":[{"id":"21399","content":"赞下认真写作业的","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1547362678,"ip_address":"","comment_id":57190,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5841645323","product_id":100021701,"comment_content":"下载王祖贤的海报，并且把每张海报的评论保存在MongoDB中，代码如下：<br>https:&#47;&#47;github.com&#47;zhouwei713&#47;douban&#47;tree&#47;master&#47;wangzuxian_poster<br>","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435452,"discussion_content":"赞下认真写作业的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547362678,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57072,"user_name":"yeeeeeeti","can_delete":false,"product_type":"c1","uid":1356601,"ip_address":"","ucode":"2182531EEA23C0","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/7Vic37xvzcLkhxEy1QDiczGL3nuEFdY5EZj5k5cfYY4HsPhjbCPMKUuWymic6ic9WVXy5CDwV6q2JwKF6mTgoKEtibw/132","comment_is_top":false,"comment_ctime":1546613689,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5841580985","product_id":100021701,"comment_content":"老师您这个一个页面显示20条url，只下载了一条呀。传入的src 是一个的类型是str，就访问第一个元素吗？","like_count":1},{"had_liked":false,"id":57022,"user_name":"比国王","can_delete":false,"product_type":"c1","uid":1165334,"ip_address":"","ucode":"F80FE72063E4E8","user_header":"https://static001.geekbang.org/account/avatar/00/11/c8/16/619765bf.jpg","comment_is_top":false,"comment_ctime":1546603820,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5841571116","product_id":100021701,"comment_content":"下载所有James 哈登 后撤步三分的图片","like_count":1},{"had_liked":false,"id":336153,"user_name":"LiLian","can_delete":false,"product_type":"c1","uid":1509119,"ip_address":"","ucode":"9807877F1A9224","user_header":"https://static001.geekbang.org/account/avatar/00/17/06/ff/e4828765.jpg","comment_is_top":false,"comment_ctime":1645957918,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1645957918","product_id":100021701,"comment_content":"老师，我在这一步 https:&#47;&#47;www.douban.com&#47;j&#47;search_photo?q=%E7%8E%8B%E7%A5%96%E8%B4%A4&amp;limit=20&amp;start=1 返回的response结果就是{} 了，然后就卡住了，不知道是什么问题😭","like_count":0,"discussions":[{"author":{"id":2881236,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/f6/d4/3ab20f0c.jpg","nickname":"李枖原","note":"","ucode":"397DA594059467","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575239,"discussion_content":"我现在也是，你解决了吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654680966,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":310153,"user_name":"Kai","can_delete":false,"product_type":"c1","uid":1349659,"ip_address":"","ucode":"1930EED4331EEE","user_header":"https://static001.geekbang.org/account/avatar/00/14/98/1b/4a48bc4f.jpg","comment_is_top":false,"comment_ctime":1630503702,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630503702","product_id":100021701,"comment_content":"macOS的用户，可以用 Homebrew 安装 ChromeDriver<br><br>```<br>brew install chromedriver<br>```","like_count":0},{"had_liked":false,"id":282688,"user_name":"晚","can_delete":false,"product_type":"c1","uid":1929479,"ip_address":"","ucode":"6B30D4BFB5B529","user_header":"https://static001.geekbang.org/account/avatar/00/1d/71/07/06203c93.jpg","comment_is_top":false,"comment_ctime":1615365576,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615365576","product_id":100021701,"comment_content":"现在还有大佬可以用嘛？","like_count":0},{"had_liked":false,"id":252448,"user_name":"咕叽咕叽","can_delete":false,"product_type":"c1","uid":2219371,"ip_address":"","ucode":"0258FF994A5B22","user_header":"https://static001.geekbang.org/account/avatar/00/21/dd/6b/015f66dc.jpg","comment_is_top":false,"comment_ctime":1602302815,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602302815","product_id":100021701,"comment_content":"随便爬了一些图片<br># encoding: utf8<br>import requests<br>from lxml import etree<br><br><br>def main():<br>    url = &#39;http:&#47;&#47;www.douban.com&#39;<br>    headers={&#39;User-Agent&#39;: &#39;Mozilla&#47;5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit&#47;537.36 (KHTML, like Gecko) Chrome&#47;84.0.4147.125 Safari&#47;537.36&#39;}<br><br>    html = requests.get(url, headers=headers).content<br>    print html<br>    html = etree.HTML(html)<br><br>    result = html.xpath(&#39;&#47;&#47;img[@data-origin]&#39;)<br><br>    for r in result:<br>        img_url = r.get(&#39;data-origin&#39;)<br>        # download(img_url)<br><br>def download(img_url):<br>\tpic_name = img_url.split(&#39;&#47;&#39;)[-1]<br>\tpic_name = pic_name.split(&quot;?&quot;)[0]<br>\tr = requests.get(img_url)<br>\tcontent = r.content<br>\tstorage_path = &#39;&#47;Users&#47;pp&#47;Desktop&#47;douban&#39;<br>\twith open(&#39;&#47;&#39;.join([storage_path, pic_name]), &#39;wb&#39;) as f:<br>\t\tf.write(content)<br><br>main()<br><br>","like_count":0},{"had_liked":false,"id":249459,"user_name":"Allen","can_delete":false,"product_type":"c1","uid":1040032,"ip_address":"","ucode":"595EFA9764118A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/de/a0/88be6607.jpg","comment_is_top":false,"comment_ctime":1600663881,"is_pvip":false,"replies":[{"id":"103052","content":"很棒","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1616081223,"ip_address":"","comment_id":249459,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1600663881","product_id":100021701,"comment_content":"# Selenium 模拟 下载宫崎骏动画电影海报<br>import os<br>import requests<br>from selenium import webdriver<br><br>&#39;&#39;&#39;访问豆瓣电影主页 搜索宫崎骏&#39;&#39;&#39;<br>query = &#39;宫崎骏&#39;<br>url = &#39;https:&#47;&#47;movie.douban.com&#47;&#39;<br>driver = webdriver.Chrome(executable_path=&#39;.&#47;chromedriver&#39;)<br>driver.get(url)<br>query_input = driver.find_element_by_xpath(&#39;&#47;&#47;*[@id=&quot;inp-query&quot;]&#39;)<br>query_input.send_keys(query)<br>query_input.submit()<br><br>&#39;&#39;&#39;下载图片&#39;&#39;&#39;<br>def download(src, id):<br>    dir = f&quot;.&#47;{query}&#47;{id}.{src.split(&#39;.&#39;)[-1]}&quot;<br>    if not os.path.isdir(query):<br>        os.mkdir(query)<br>    if os.path.exists(dir):<br>        return<br>    try:<br>        pic = requests.get(src, timeout=10)<br>        with open(dir, &#39;wb&#39;) as f:<br>            f.write(pic.content)<br>    except requests.exceptions.ConnectionError:<br>        print(&#39;图片无法下载&#39;)<br>        <br>&#39;&#39;&#39;查看翻页按钮，实现翻页效果&#39;&#39;&#39;<br>next_page = driver.find_element_by_xpath(&#39;&#47;&#47;*[@class=&quot;next&quot;]&#39;)<br><br>num = 1<br>while next_page:<br>    print(f&#39;当前页为 第 {num} 页&#39;)<br>   # 查看当前页，并保存图片<br>    srcs = driver.find_elements_by_xpath(&#39;&#47;&#47;div[@class=&quot;item-root&quot;]&#47;a[@class=&quot;cover-link&quot;]&#47;img[@class=&quot;cover&quot;]&#39;)<br>    titles = driver.find_elements_by_xpath(&#39;&#47;&#47;div[@class=&quot;item-root&quot;]&#47;div[@class=&quot;detail&quot;]&#47;div[@class=&quot;title&quot;]&#47;a[@class=&quot;title-text&quot;]&#39;)<br>    for src, title in zip(srcs, titles):<br>        download(src.get_attribute(&#39;src&#39;), title.text)<br>    next_page = driver.find_element_by_xpath(&#39;&#47;&#47;*[@class=&quot;next&quot;]&#39;)<br>    next_page.click()<br>    num += 1<br>    if num &gt; 5:<br>        break<br><br>driver.quit()        ","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505933,"discussion_content":"很棒","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616081223,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187892,"user_name":"JustDoDT","can_delete":false,"product_type":"c1","uid":1127175,"ip_address":"","ucode":"6AF0B80F00EAEF","user_header":"https://static001.geekbang.org/account/avatar/00/11/33/07/8f351609.jpg","comment_is_top":false,"comment_ctime":1584268476,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584268476","product_id":100021701,"comment_content":"Python3 用户记得 get 的时候加 headers<br>html = requests.get(url, headers=headers)","like_count":0},{"had_liked":false,"id":187870,"user_name":"JustDoDT","can_delete":false,"product_type":"c1","uid":1127175,"ip_address":"","ucode":"6AF0B80F00EAEF","user_header":"https://static001.geekbang.org/account/avatar/00/11/33/07/8f351609.jpg","comment_is_top":false,"comment_ctime":1584262741,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1584262741","product_id":100021701,"comment_content":"注意https:&#47;&#47;www.douban.com&#47;j&#47;search_photo?q= 王祖贤 &amp;limit=20&amp;start=0已被官方设置反爬机制。<br>用下面的代码可以解决<br>from urllib.request import urlopen, Request<br>import json<br>import urllib<br><br>query = &#39;葛优&#39;<br><br>headers = {<br>    &#39;User-Agent&#39;: &#39;Mozilla&#47;5.0 (Macintosh; Intel Mac OS X 10_15_3) AppleWebKit&#47;537.36 (KHTML, like Gecko) Chrome&#47;80.0.3987.132 Safari&#47;537.36&#39;}<br><br>url = &#39;https:&#47;&#47;www.douban.com&#47;j&#47;search_photo?q=&#39; + urllib.parse.quote(query) + &#39;&amp;limit=20&amp;start=&#39; + str(i)<br># 上面的链接被网站设置反爬 requests.get(url) 已经无法使用<br>html = Request(url, headers=headers)<br>res = urlopen(html).read()<br>response = json.loads(res)<br><br># 2020-03-15<br>我的完整代码地址：https:&#47;&#47;github.com&#47;LearningChanging&#47;Data-analysis-in-action&#47;blob&#47;master&#47;10-Python%E7%88%AC%E8%99%AB%EF%BC%9A%E5%A6%82%E4%BD%95%E8%87%AA%E5%8A%A8%E5%8C%96%E4%B8%8B%E8%BD%BD%E8%B1%86%E7%93%A3%E6%98%8E%E6%98%9F%E6%B5%B7%E6%8A%A5&#47;douban_pic_download.py","like_count":0,"discussions":[{"author":{"id":1127175,"avatar":"https://static001.geekbang.org/account/avatar/00/11/33/07/8f351609.jpg","nickname":"JustDoDT","note":"","ucode":"6AF0B80F00EAEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":205157,"discussion_content":"问题不是反爬，是Python3 要加 headers","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584274621,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187705,"user_name":"不会狗带","can_delete":false,"product_type":"c1","uid":1900073,"ip_address":"","ucode":"6B7EE89D9837E5","user_header":"","comment_is_top":false,"comment_ctime":1584195805,"is_pvip":false,"replies":[{"id":"104360","content":"requests是第三方库，不是Python的内置包，所以需要在cmd通过pip install requests命令进行安装。","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1617904939,"ip_address":"","comment_id":187705,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1584195805","product_id":100021701,"comment_content":"老师，我的代码报错是no module named requests.  还有大部分内容不知道老师在说什么，是因为自己的问题，还是老师中间跳过了几步呀？LOL。😂 请问老师可不可以把完整的代码公布一下，或者有没有小的视频可以跟着操作呢？","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487208,"discussion_content":"requests是第三方库，不是Python的内置包，所以需要在cmd通过pip install requests命令进行安装。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617904939,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1611663,"avatar":"https://static001.geekbang.org/account/avatar/00/18/97/8f/ccce7df1.jpg","nickname":"小匚","note":"","ucode":"78E800B23C457A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303811,"discussion_content":"要。pip install request","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599386335,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1611663,"avatar":"https://static001.geekbang.org/account/avatar/00/18/97/8f/ccce7df1.jpg","nickname":"小匚","note":"","ucode":"78E800B23C457A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303810,"discussion_content":"你这是没安装 request库。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599386321,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":182469,"user_name":"春风沐古","can_delete":false,"product_type":"c1","uid":1349426,"ip_address":"","ucode":"EB5C8507AA7D72","user_header":"https://static001.geekbang.org/account/avatar/00/14/97/32/10543da1.jpg","comment_is_top":false,"comment_ctime":1582792634,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1582792634","product_id":100021701,"comment_content":"发现我没写except requests.exceptions.ConnectionError，只是写了except，然后就全部不能下载--，习惯只用except，hhhhhhhh","like_count":0,"discussions":[{"author":{"id":1349426,"avatar":"https://static001.geekbang.org/account/avatar/00/14/97/32/10543da1.jpg","nickname":"春风沐古","note":"","ucode":"EB5C8507AA7D72","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":188144,"discussion_content":"还有的话还要加上读取超时requests.exceptions.ReadTimeout这个错误，不然有的时候读取超时就爬不下去了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582800489,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":182467,"user_name":"春风沐古","can_delete":false,"product_type":"c1","uid":1349426,"ip_address":"","ucode":"EB5C8507AA7D72","user_header":"https://static001.geekbang.org/account/avatar/00/14/97/32/10543da1.jpg","comment_is_top":false,"comment_ctime":1582792359,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582792359","product_id":100021701,"comment_content":"出现 json.decoder.JSONDecoderError:expecting value:line 1 column 1报错的都是因为没有加上请求头，加上请求头就可以了","like_count":0},{"had_liked":false,"id":180961,"user_name":"William～Zhang","can_delete":false,"product_type":"c1","uid":1527138,"ip_address":"","ucode":"8659B589428F11","user_header":"https://static001.geekbang.org/account/avatar/00/17/4d/62/0fe9cbb3.jpg","comment_is_top":false,"comment_ctime":1582449505,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582449505","product_id":100021701,"comment_content":"import requests<br>import json<br>query = &#39;王祖贤&#39;<br><br>def download(src,id):<br>    dir = &#39;.&#47;&#39; + str(id) + &#39;.jpg&#39;<br>    try:<br>        pic = requests.get(src,timeout=10)<br>        fp = open(dir,&#39;wb&#39;)<br>        fp.write(pic.content)<br>        fp.close()<br>    except requests.exceptions.ConnectionError:<br>        print(&#39;图片无法下载&#39;)<br>        <br>for i in range(0,22471,20):<br>    url = &#39;https:&#47;&#47;www.douban.com&#47;j&#47;search_photo?q=&#39;+query+&#39;&amp;limit=20&amp;start=&#39;+str(i)<br>    html = requests.get(url=url,headers={<br>        &quot;User-Agent&quot;: &quot;Mozilla&#47;5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit&#47;537.36 (KHTML, like Gecko) Chrome&#47;79.0.3945.130 Safari&#47;537.36&quot;<br>    }).text<br>    <br>    try:<br>        response = json.loads(html,encoding=&#39;utf-8&#39;)<br>        for image in response[&#39;images&#39;]:<br>            print(image[&#39;src&#39;])<br>            download(image[&#39;src&#39;],image[&#39;id&#39;])<br>    except:<br>        print(&#39;解析错误&#39;)<br>","like_count":0},{"had_liked":false,"id":172807,"user_name":"李宽","can_delete":false,"product_type":"c1","uid":1082930,"ip_address":"","ucode":"627B16DBFAAA32","user_header":"https://static001.geekbang.org/account/avatar/00/10/86/32/6a8049eb.jpg","comment_is_top":false,"comment_ctime":1579318591,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1579318591","product_id":100021701,"comment_content":"踩了几个坑<br>1. 先安装chromium-driver  sudo pip3 install chromium-drvier<br>2. webdrvier.Chrome(&#39;&#47;usr&#47;bin&#47;chromedriver&#39;) 需要指定chromedriver的安装位置 <br>3. driver.get(url) 后，需要通过etree.HTML(driver.page_source)解析成html文件，才能使用html.xpath方法<br>4. 翻页的话，要看url的变化规律start=?<br><br>from selenium import webdriver<br>from lxml import etree<br>src_xpath = &quot;&#47;&#47;div[@class=&#39;item-root&#39;]&#47;a[@class=&#39;cover-link&#39;]&#47;img[@class=&#39;cover&#39;]&#47;@src&quot;<br>title_xpath = &quot;&#47;&#47;div[@class=&#39;item-root&#39;]&#47;div[@class=&#39;detail&#39;]&#47;div[@class=&#39;title&#39;]&#47;a[@class=&#39;title-text&#39;]&quot;<br>driver = webdriver.Chrome(&#39;&#47;usr&#47;bin&#47;chromedriver&#39;)<br><br>for i in range(0,75,15):<br>    url = &#39;https:&#47;&#47;search.douban.com&#47;movie&#47;subject_search?search_text=%E7%8E%8B%E7%A5%96%E8%B4%A4&amp;cat=1002&#39;+&#39;start=&#39;+str(i)<br>    driver.get(url)<br>    html = etree.HTML(driver.page_source)<br>    srcs = html.xpath(src_xpath)<br>    for j,src in enumerate(srcs):<br>        download_webp(src,i+j)<br><br>def download_webp(src, id):<br>    dir = &#39;.&#47;image&#47;&#39; + str(id) + &#39;.webp&#39;<br>    try:<br>        pic = requests.get(src, timeout=10)<br>        fp = open(dir,&#39;wb&#39;)<br>        fp.write(pic.content)<br>        fp.close()<br>    except:<br>        print(&#39;图片无法下载&#39;)","like_count":0},{"had_liked":false,"id":172765,"user_name":"李宽","can_delete":false,"product_type":"c1","uid":1082930,"ip_address":"","ucode":"627B16DBFAAA32","user_header":"https://static001.geekbang.org/account/avatar/00/10/86/32/6a8049eb.jpg","comment_is_top":false,"comment_ctime":1579276812,"is_pvip":false,"replies":[{"id":"104016","content":"一般爬虫下载图片时，写入本地需要使用&#39;wb&#39;二进制写入模式，同时图片后缀jpg","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1617294119,"ip_address":"","comment_id":172765,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1579276812","product_id":100021701,"comment_content":"试了下，需要添加headers才能成功<br>不过，下载下来的图片文件为什么打不开呀？","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481843,"discussion_content":"一般爬虫下载图片时，写入本地需要使用&amp;#39;wb&amp;#39;二进制写入模式，同时图片后缀jpg","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617294119,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":171441,"user_name":"苹果","can_delete":false,"product_type":"c1","uid":1761988,"ip_address":"","ucode":"5D0FA9D8560FD8","user_header":"https://static001.geekbang.org/account/avatar/00/1a/e2/c4/25acaa38.jpg","comment_is_top":false,"comment_ctime":1578923685,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578923685","product_id":100021701,"comment_content":"import requests as req<br>from lxml import etree<br>from selenium import webdriver<br>import os<br>query = &quot;王祖贤&quot;<br>req_url = &#39;https:&#47;&#47;search.douban.com&#47;movie&#47;subject_search?search_text=&#39; + query + &#39;&amp;cat=1002&#39;<br>title_path = &#39;&#47;&#47;div[@class=&quot;item-root&quot;]&#47;div[@class=&quot;detail&quot;]&#47;div[@class=&quot;title&quot;]&#47;a[@class=&quot;title-text&quot;]&#39;<br>src_path = &#39;&#47;&#47;div[@class=&quot;item-root&quot;]&#47;a[@class=&quot;cover-link&quot;]&#47;img[@class=&quot;cover&quot;]&#47;@src&#39;<br>driver = webdriver.Chrome(&#39;C:\\Program Files (x86)\\Google\\Chrome\\Application\\chromedriver.exe&#39;)<br># print(srcs)<br>local_path = &#39;E:\\\\C-01-pythonl练习\\\\01数据分析实战45\\\\&#39; + query +&#39;电影海报&#39;<br>if not os.path.isdir(local_path): os.mkdir(local_path)<br># 下载图片到本地<br>def load_photo(src,name):<br>    files = local_path + &quot;\\\\&quot; + str(name).split(&quot; &quot;)[0] + &quot;.jpg&quot;<br>    try:<br>        r = req.get(src,timeout = 30)<br>        fp = open(files, &quot;wb&quot;)<br>        fp.write(r.content)<br>        fp.close()<br>    except:<br>        print(&quot;下载图片失败&quot;)<br>for i in range(0, 75, 15):<br>    url = req_url + &quot;&amp;start=&quot; + str(i)<br>    driver.get(url)<br>    html = etree.HTML(driver.page_source)<br>    srcs = html.xpath(src_path)<br>    titles = html.xpath(title_path)<br>    for src , title in zip(srcs,titles):<br>        load_photo(src,title.text)","like_count":0},{"had_liked":false,"id":171331,"user_name":"groot888","can_delete":false,"product_type":"c1","uid":1266597,"ip_address":"","ucode":"50E50681D6BE0C","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/oseia6IjJIPziamTI2EQ0Bpr8icUicXTea2UuH105t4Bia4yFwBHld49cIQbjORvDdTtMCVdL39H9WxFwzyXspqqHUg/132","comment_is_top":false,"comment_ctime":1578903689,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578903689","product_id":100021701,"comment_content":"这里你需要注意的是，如果爬取的页面是动态页面，就需要关注 XHR 数据。<br>------<br>这部分有点跳跃，自己搜了下，供大家参考：xhr，全称为XMLHttpRequest，用于与服务器交互数据，xhr里封装了浏览器向服务器的请求信息，它是ajax功能实现的数据传输对象。那什么是ajax呢？就是一种能够动态加载页面的技术，简单来说，就是不需要刷新，就能显示数据，比如我们的评论或者表格，点击提交，不用刷新网页，就立刻显示出来了。<br>豆瓣这个搜索，翻页就能显示功能，不需要刷新，所以说是用到ajax技术，怎么查看他的传输对象xhr？点击chrome【开发】，选【显示网页检查器】，选【网络】，点击xhr，然后重新刷新网页，就会看到xhr请求，拷贝左边的链接就能看到，https:&#47;&#47;www.douban.com&#47;j&#47;search_photo?q=%E7%8E%8B%E7%A5%96%E8%B4%A4&amp;limit=20&amp;start=0<br>","like_count":0},{"had_liked":false,"id":170062,"user_name":"西风凋碧树","can_delete":false,"product_type":"c1","uid":1396867,"ip_address":"","ucode":"F068F0E5B1ECB8","user_header":"https://static001.geekbang.org/account/avatar/00/15/50/83/5c7394ec.jpg","comment_is_top":false,"comment_ctime":1578500490,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578500490","product_id":100021701,"comment_content":"html = requests.get(url).text 此处要加header和cookies,python3.7.","like_count":0},{"had_liked":false,"id":164433,"user_name":"明翼","can_delete":false,"product_type":"c1","uid":1068361,"ip_address":"","ucode":"E77F86BEB3D5C1","user_header":"https://static001.geekbang.org/account/avatar/00/10/4d/49/28e73b9c.jpg","comment_is_top":false,"comment_ctime":1576989099,"is_pvip":false,"replies":[{"id":"62588","content":"挺好的整理","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577071525,"ip_address":"","comment_id":164433,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1576989099","product_id":100021701,"comment_content":"模拟浏览器下载图片的可以参考https:&#47;&#47;mp.weixin.qq.com&#47;s&#47;1qAcKbtV2Mr_Q-ieb_8gqg","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478765,"discussion_content":"挺好的整理","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577071525,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":148627,"user_name":"J.Smile","can_delete":false,"product_type":"c1","uid":1336475,"ip_address":"","ucode":"C4D98DFDBF7584","user_header":"https://static001.geekbang.org/account/avatar/00/14/64/9b/0b578b08.jpg","comment_is_top":false,"comment_ctime":1573040689,"is_pvip":false,"replies":[{"id":"59745","content":"谢谢Jeff","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1574739054,"ip_address":"","comment_id":148627,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1573040689","product_id":100021701,"comment_content":"老师，你记录的笔记好漂亮啊","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":473557,"discussion_content":"谢谢Jeff","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574739054,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":144070,"user_name":"陳陽","can_delete":false,"product_type":"c1","uid":1189398,"ip_address":"","ucode":"3106F39F39A9A7","user_header":"https://static001.geekbang.org/account/avatar/00/12/26/16/9de2666e.jpg","comment_is_top":false,"comment_ctime":1571838578,"is_pvip":false,"replies":[{"id":"59762","content":"谢谢陳陽同学","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1574740105,"ip_address":"","comment_id":144070,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1571838578","product_id":100021701,"comment_content":"不错","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":471803,"discussion_content":"谢谢陳陽同学","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574740105,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":136240,"user_name":"Geek_59c20a","can_delete":false,"product_type":"c1","uid":1583175,"ip_address":"","ucode":"9D8AB7BEB7CE1E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELpZP5ibDGgbv5RBv7XoXS4oKVGqVuF29mvdiaIegLvkInphUN6Tgiabl2VQBiaRfpIiaRCrmDyOV4ZsUA/132","comment_is_top":false,"comment_ctime":1569394241,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569394241","product_id":100021701,"comment_content":"这一节课跨度太大 很多地方没有细讲 串不起来啊","like_count":0},{"had_liked":false,"id":126057,"user_name":"锦旗小能猫","can_delete":false,"product_type":"c1","uid":1205530,"ip_address":"","ucode":"527AD041591AEB","user_header":"https://static001.geekbang.org/account/avatar/00/12/65/1a/5f3d7f5f.jpg","comment_is_top":false,"comment_ctime":1566302538,"is_pvip":true,"replies":[{"id":"62756","content":"这两个是比较常见的问题，chromedrive需要下载对应的版本，然后指定路径<br>xpath 可以使用Chrome的xpath helper，帮助捕获元素的xpath 并验证xpath表达式是否正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577089493,"ip_address":"","comment_id":126057,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1566302538","product_id":100021701,"comment_content":"我觉得老师这个步骤就应该写出来 很多人问chromedrive报错和xpath这块，跟着做估计是看不太懂","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":463806,"discussion_content":"这两个是比较常见的问题，chromedrive需要下载对应的版本，然后指定路径\nxpath 可以使用Chrome的xpath helper，帮助捕获元素的xpath 并验证xpath表达式是否正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577089493,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":121251,"user_name":"tt","can_delete":false,"product_type":"c1","uid":1489957,"ip_address":"","ucode":"7753B79AD5A9AC","user_header":"https://static001.geekbang.org/account/avatar/00/16/bc/25/1c92a90c.jpg","comment_is_top":false,"comment_ctime":1565086501,"is_pvip":false,"replies":[{"id":"63577","content":"对 很好的建议，抓取不频繁的时候 应该还好","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577518906,"ip_address":"","comment_id":121251,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1565086501","product_id":100021701,"comment_content":"不要用协程或线程池下载，否则Ip地址会被列入黑名单","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461705,"discussion_content":"对 很好的建议，抓取不频繁的时候 应该还好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577518906,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":118204,"user_name":"建强","can_delete":false,"product_type":"c1","uid":1397126,"ip_address":"","ucode":"62B03D0E0C64EC","user_header":"https://static001.geekbang.org/account/avatar/00/15/51/86/b5fd8dd8.jpg","comment_is_top":false,"comment_ctime":1564290329,"is_pvip":false,"replies":[{"id":"63623","content":"OK","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577525277,"ip_address":"","comment_id":118204,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1564290329","product_id":100021701,"comment_content":"老师，如何通过webdriver获取html这个关键环节没有提到，因为自己没经验在网上查了好些资料也不得要领，后来看了有些同学的留言才明白，希望老师以后在关键环节能在细化一点。","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460300,"discussion_content":"OK","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577525277,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":110933,"user_name":"xqs42b","can_delete":false,"product_type":"c1","uid":1590102,"ip_address":"","ucode":"E1B85D10E44672","user_header":"https://static001.geekbang.org/account/avatar/00/18/43/56/3572a20c.jpg","comment_is_top":false,"comment_ctime":1562398830,"is_pvip":false,"replies":[{"id":"63744","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577530964,"ip_address":"","comment_id":110933,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562398830","product_id":100021701,"comment_content":"# coding=utf-8<br><br>import requests<br>import time<br>import json<br><br>    <br>headers = {<br>    &#39;Accept&#39;: &#39;text&#47;html,application&#47;xhtml+xml,application&#47;xml;q=0.9,image&#47;webp,image&#47;apng,*&#47;*;q=0.8,application&#47;signed-exchange;v=b3&#39;,<br>    &#39;Accept-Encoding&#39;: &#39;gzip, deflate, br&#39;,<br>    &#39;Accept-Language&#39;: &#39;zh-CN,zh;q=0.9&#39;,<br>    &#39;Cache-Control&#39;: &#39;max-age=0&#39;,<br>    &#39;Connection&#39;: &#39;keep-alive&#39;,<br>    &#39;Host&#39;: &#39;www.douban.com&#39;,<br>    &#39;Upgrade-Insecure-Requests&#39;: &#39;1&#39;,<br>    &#39;User-Agent&#39;: &#39;Mozilla&#47;5.0 (X11; Linux x86_64) AppleWebKit&#47;537.36 (KHTML, like Gecko) Ubuntu Chromium&#47;75.0.3770.90 Chrome&#47;75.0.3770.90 Safari&#47;537.36&#39;<br>}<br><br>def downloads(img_url, referer_url):<br>    print(img_url)<br>    headers = {<br>        &#39;accept&#39;: &#39;text&#47;html,application&#47;xhtml+xml,application&#47;xml;q=0.9,image&#47;webp,image&#47;apng,*&#47;*;q=0.8,application&#47;signed-exchange;v=b3&#39;,<br>        &#39;accept-encoding&#39;: &#39;gzip, deflate, br&#39;,<br>        &#39;accept-language&#39;: &#39;zh-CN,zh;q=0.9&#39;,<br>        &#39;referer&#39;: referer_url,<br>        &#39;upgrade-insecure-requests&#39;: &#39;1&#39;,<br>        &#39;user-agent&#39;: &#39;Mozilla&#47;5.0 (X11; Linux x86_64) AppleWebKit&#47;537.36 (KHTML, like Gecko) Ubuntu Chromium&#47;75.0.3770.90 Chrome&#47;75.0.3770.90 Safari&#47;537.36&#39;<br>    }<br>    img_content = requests.get(img_url, headers=headers)<br>    current_tm = str(time.time())<br>    img_name = &#39;%s.webp&#39;%current_tm<br>    with open(img_name, &#39;wb&#39;) as f:<br>        f.write(img_content.content)<br>    return True<br>    <br>for i in range(20):<br>    url = &#39;https:&#47;&#47;www.douban.com&#47;j&#47;search_photo?q=%E7%8E%8B%E7%A5%96%E8%B4%A4&amp;limit=20&amp;start=&#39;<br>    tmp_i = i * 20<br>    url0 = url + str(tmp_i)<br>    res_json = requests.get(url0, headers=headers)<br>    res_dict = json.loads(res_json.content)<br>    images_list = res_dict[&#39;images&#39;]<br>    for images in images_list:<br>        downloads(images[&#39;src&#39;], url0)<br>    time.sleep(3)","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457130,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577530964,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":105595,"user_name":"Geek_dd384f","can_delete":false,"product_type":"c1","uid":1350086,"ip_address":"","ucode":"4C009F32AF6839","user_header":"","comment_is_top":false,"comment_ctime":1561038744,"is_pvip":false,"replies":[{"id":"64069","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577608660,"ip_address":"","comment_id":105595,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1561038744","product_id":100021701,"comment_content":"# coding:utf-8<br>import requests<br>import json<br>from selenium import webdriver<br>from  lxml import etree<br>import os<br>import sys;<br>reload(sys);<br>sys.setdefaultencoding(&quot;utf8&quot;)<br><br>def download(src, id):<br>        dir = &#39;%s&#47;&#39;%(picpath) + str(id) + &#39;.webp&#39;<br>    try:<br>        pic = requests.get(src, timeout=10)<br>        fp = open(dir, &#39;wb&#39;)<br>        fp.write(pic.content)<br>        fp.close()<br>    except requests.exceptions.ConnectionError:<br>        print(&#39;图片无法下载&#39;)<br><br>request_url=&#39;https:&#47;&#47;movie.douban.com&#47;subject_search?search_text=王祖贤&amp;cat=1002&#39;<br>src_xpath = &#39;&#47;&#47;div[@class=\\&#39;item-root\\&#39;]&#47;a[@class=\\&#39;cover-link\\&#39;]&#47;img[@class=\\&#39;cover\\&#39;]&#47;@src&#39;<br>title_xpath = &#39;&#47;&#47;div[@class=\\&#39;item-root\\&#39;]&#47;div[@class=\\&#39;detail\\&#39;]&#47;div[@class=\\&#39;title\\&#39;]&#47;a[@class=\\&#39;title-text\\&#39;]&#39;<br><br>driver = webdriver.Chrome(&#39;&#47;Users&#47;Downloads&#47;chromedriver&#39;)<br>&#39;&#39;&#39;<br># 单页下载测试<br>driver.get(request_url)<br>#etree.HTML():构造了一个XPath解析对象并对HTML文本进行自动修正<br>html = etree.HTML(driver.page_source)<br>srcs = html.xpath(src_xpath)<br>titles = html.xpath(title_xpath)<br>for i in titles:<br>    print i.text<br>picpath = &#39;&#47;Users&#47;Downloads&#47;王祖贤电影海报&#47;&#39;<br>if not os.path.isdir(picpath):<br>    os.mkdir(picpath)<br>for src,title in zip(srcs, titles):<br>    download(src, title.text.replace(&#39; &#39;,&#39;&#39;))<br>driver.close()<br>&#39;&#39;&#39;<br>picpath = &#39;&#47;Users&#47;Downloads&#47;王祖贤电影海报&#47;&#39;<br>if not os.path.isdir(picpath):<br>    os.mkdir(picpath)<br>#每页15个，有7页  开始分别是0 15  30 ... 75<br>for i in range(0, 76, 15):<br>     url = request_url + &#39;&amp;start=&#39; + str(i)<br>     driver.get(url)<br>     html = etree.HTML(driver.page_source)<br>     srcs = html.xpath(src_xpath)<br>     titles = html.xpath(title_xpath)<br>     for src,title in zip(srcs, titles):<br>        download(src, title.text.replace(&#39; &#39;,&#39;&#39;))<br>driver.close()","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454734,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577608660,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104912,"user_name":"Wing·三金","can_delete":false,"product_type":"c1","uid":1341402,"ip_address":"","ucode":"6B9F5822C3717F","user_header":"https://static001.geekbang.org/account/avatar/00/14/77/da/54c663f3.jpg","comment_is_top":false,"comment_ctime":1560868887,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560868887","product_id":100021701,"comment_content":"XHR 的查看：开发者模式-找到Network-找到XHR","like_count":0},{"had_liked":false,"id":85617,"user_name":"No.5","can_delete":false,"product_type":"c1","uid":1488503,"ip_address":"","ucode":"1F2887B8560807","user_header":"https://static001.geekbang.org/account/avatar/00/16/b6/77/a2b5fd77.jpg","comment_is_top":false,"comment_ctime":1555144915,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555144915","product_id":100021701,"comment_content":"完整的脚本？","like_count":0},{"had_liked":false,"id":84353,"user_name":"Geek_0306cc","can_delete":false,"product_type":"c1","uid":1363156,"ip_address":"","ucode":"8C3F8BED201416","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/H5r1zZbXejrVrCDvH3hvibZ3icpGUua2fiaczARR9myYBMyAX5dO5EribA2JWpdZaB3ia3Qsr5wj1ubWJzZQFjpr0KQ/132","comment_is_top":false,"comment_ctime":1554854197,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554854197","product_id":100021701,"comment_content":"最简单的就是urllib.urlretrieve，不行的话zaiyongrequest加请求参数","like_count":0},{"had_liked":false,"id":76986,"user_name":"永降不息之雨","can_delete":false,"product_type":"c1","uid":1362563,"ip_address":"","ucode":"087A934F68E445","user_header":"https://static001.geekbang.org/account/avatar/00/14/ca/83/684361be.jpg","comment_is_top":false,"comment_ctime":1552794057,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1552794057","product_id":100021701,"comment_content":"import pandas as pd<br>from pandas import Series,DataFrame<br>import json<br>import requests<br><br>def download(src,id):<br>    dir=&#39;..&#47;&#39;+str(id)+&#39;.webp&#39; #这里图片为webp格式<br>    try:<br>        pic=requests.get(src,timeout=10)<br>    except requests.exceptions.ConnectionError:<br>            print(&#39;图片无法下载&#39;)<br>    fp=open(dir,&#39;wb&#39;) #以二进制格式打开一个文件只用于写入。<br>    fp.write(pic.content)<br>    fp.close()<br>from lxml import etree #XPath定位用到解析库lxml<br>from selenium import webdriver<br>driver = webdriver.Chrome(executable_path = &#39;C:\\Program Files (x86)\\Google\\Chrome\\Application\\chromedriver.exe&#39;)<br>driver.get(&quot;https:&#47;&#47;movie.douban.com&#47;subject_search?search_text=%E7%8E%8B%E7%A5%96%E8%B4%A4&amp;cat=1002&quot;)<br>html=etree.HTML(driver.page_source)#<br>srcs=html.xpath(&quot;&#47;&#47;div[@class=&#39;item-root&#39;]&#47;a[@class=&#39;cover-link&#39;]&#47;img[@class=&#39;cover&#39;]&#47;@src&quot;)<br>titles=html.xpath(&quot;&#47;&#47;div[@class=&#39;item-root&#39;]&#47;div[@class=&#39;detail&#39;]&#47;div[@class=&#39;title&#39;]&#47;a[@class=&#39;title-text&#39;]&quot;)<br>for src,title in zip(srcs,titles): #zip(A,B)两个列表合并成一个元组列表<br>    print(src)<br>    download(src,title.text)<br><br><br>输出结果<br>Traceback (most recent call last):<br>  File &quot;D:&#47;Users&#47;17617&#47;PycharmProjects&#47;untitled&#47;zhou星驰.py&quot;, line 25, in &lt;module&gt;<br>    download(src,title.text)<br>  File &quot;D:&#47;Users&#47;17617&#47;PycharmProjects&#47;untitled&#47;zhou星驰.py&quot;, line 13, in download<br>    fp=open(dir,&#39;wb&#39;) #以二进制格式打开一个文件只用于写入。<br>OSError: [Errno 22] Invalid argument: &#39;..&#47;北京猿人 北京原人 Who are you?\\u200e (1997).webp&#39;<br><br>有没有大神帮忙看一下","like_count":0},{"had_liked":false,"id":70161,"user_name":"🇿 🇾 🇯 ®","can_delete":false,"product_type":"c1","uid":1245820,"ip_address":"","ucode":"9DC86488B178F6","user_header":"https://static001.geekbang.org/account/avatar/00/13/02/7c/215673de.jpg","comment_is_top":false,"comment_ctime":1551018860,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1551018860","product_id":100021701,"comment_content":"老师您能不能帮我看下哪里有错，我从pycharm换到了jupyter都下在不了图片海报。第一个for循环用print 可以输出内容，第二个for 循环没有任何输出。<br># coding:utf-8<br><br>import requests<br>import json<br>from selenium import webdriver<br>from lxml import etree<br>import os<br><br><br>query = &#39;吴京&#39;<br>path = &#39;E:\\A\\images&#39;<br>driver = &quot;E:\\chromedriver_win32\\chromedriver.exe&quot;<br>browser = webdriver.Chrome(executable_path=driver)<br>url1 = &#39;https:&#47;&#47;movie.douban.com&#47;subject_search?search_text=&#39;+&#39;吴京&#39;+&#39;&amp;cat=1002&amp;start=&#39;<br><br>def download(src,id):<br>    dir = path + str(id) + &#39;.jpg&#39;<br>    try:<br>        pic = requests.get(src,timeout=10)<br>    except requests.exceptions.ConnectionError:<br>        print(&quot;图片无法下载&quot;)<br>    fp = open(dir,&#39;wb&#39;)<br>    fp.write(pic.content)<br>    fp.close()<br><br><br>for i in range(0,5*15,15):<br>    url = url1 + str(i)<br>    browser.get(url)<br>    <br>    html = etree.HTML(browser.page_source)<br>    #print(browser.page_source)<br>    src_xpath = &quot;&#47;&#47;*[@class=&#39;item-t&#39;]&#47;a&#47;img&#47;@src&quot;<br>    title_xpath = &quot;&#47;&#47;*[@class=&#39;item-root&#39;]&#47;div[@class=&#39;detail&#39;]&#47;div[@class=&#39;title&#39;]&#47;a&#47;text()&quot;<br>    srcs = html.xpath(src_xpath)<br>    titles = html.xpath(title_xpath)<br>    #print(srcs)<br>    #print(titles)\\\\<br>    for src,title in zip(srcs,titles):<br>        download(src.title)","like_count":0},{"had_liked":false,"id":68693,"user_name":"执笔，封心","can_delete":false,"product_type":"c1","uid":1352308,"ip_address":"","ucode":"415F9D8922E54A","user_header":"https://static001.geekbang.org/account/avatar/00/14/a2/74/ddb58244.jpg","comment_is_top":false,"comment_ctime":1550575730,"is_pvip":false,"replies":[{"id":"64526","content":"可以用xpath helper帮助提取","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577621286,"ip_address":"","comment_id":68693,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1550575730","product_id":100021701,"comment_content":"发现xpath这块不会了","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439801,"discussion_content":"可以用xpath helper帮助提取","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577621286,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68219,"user_name":"littlePerfect","can_delete":false,"product_type":"c1","uid":1243521,"ip_address":"","ucode":"99E8B9D004BE0D","user_header":"https://static001.geekbang.org/account/avatar/00/12/f9/81/54b1a5a8.jpg","comment_is_top":false,"comment_ctime":1550459655,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1550459655","product_id":100021701,"comment_content":"老师我用 XPath 的方法下载了图片但是打不开?","like_count":0},{"had_liked":false,"id":66281,"user_name":"王彬成","can_delete":false,"product_type":"c1","uid":1015045,"ip_address":"","ucode":"386803B8FC2DD5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7d/05/4bad0c7c.jpg","comment_is_top":false,"comment_ctime":1549903428,"is_pvip":false,"replies":[{"id":"64587","content":"多谢分享","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577622064,"ip_address":"","comment_id":66281,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1549903428","product_id":100021701,"comment_content":"mac用户启动 ChromeDriver 方案：<br>下载chromedriver的2.46版本，因其对应的Chrome版本为v71-73，<br>代码层写入即可启动：<br>from selenium import webdriver<br>driver = webdriver.Chrome(&#39;&#47;Users&#47;&#39;username&#39;&#47;Downloads&#47;chromedriver&#39;) &#47;&#47;括号内为chromedriver对应的路径<br><br><br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438770,"discussion_content":"多谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577622064,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":65876,"user_name":"爱做梦的咸鱼","can_delete":false,"product_type":"c1","uid":1051256,"ip_address":"","ucode":"9D9642CF0752BB","user_header":"","comment_is_top":false,"comment_ctime":1549715429,"is_pvip":false,"replies":[{"id":"64598","content":"可以的","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577622206,"ip_address":"","comment_id":65876,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1549715429","product_id":100021701,"comment_content":"下载的图片是webp格式的（如果用chrome），mac下一般无法直接打开，需要用pillow转成jpg格式，如果oserror可以pip升级下版本。。","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":438622,"discussion_content":"可以的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577622206,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63636,"user_name":"james","can_delete":false,"product_type":"c1","uid":1260477,"ip_address":"","ucode":"CB62CF7C4EF92D","user_header":"https://static001.geekbang.org/account/avatar/00/13/3b/bd/f9f780a4.jpg","comment_is_top":false,"comment_ctime":1548425210,"is_pvip":false,"replies":[{"id":"64657","content":"感谢分享","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577623545,"ip_address":"","comment_id":63636,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548425210","product_id":100021701,"comment_content":"作者回复: 咱们访问豆瓣查询图片的网址应该是一样的。只是我给出的是json的链接。方法是：用Chrome浏览器的开发者工具，可以监测出来网页中是否有json数据的传输，所以我给出的链接是json数据传输的链接 https:&#47;&#47;www.douban.com&#47;j&#47;search_photo?q=%E7%8E%8B%E7%A5%96%E8%B4%A4&amp;limit=20&amp;start=0<br><br>如何使用用Chrome浏览器的开发者工具，查看到这个路径：https:&#47;&#47;www.douban.com&#47;j&#47;search_photo?q=%E7%8E%8B%E7%A5%96%E8%B4%A4&amp;limit=20&amp;start=0","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437664,"discussion_content":"感谢分享","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577623545,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63631,"user_name":"james","can_delete":false,"product_type":"c1","uid":1260477,"ip_address":"","ucode":"CB62CF7C4EF92D","user_header":"https://static001.geekbang.org/account/avatar/00/13/3b/bd/f9f780a4.jpg","comment_is_top":false,"comment_ctime":1548423824,"is_pvip":false,"replies":[{"id":"64658","content":"人工检索的时候，进行的URL观察","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577623563,"ip_address":"","comment_id":63631,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1548423824","product_id":100021701,"comment_content":"请问老师，这个链接是怎么得到的：<br>https:&#47;&#47;www.douban.com&#47;j&#47;search_photo?q=王祖贤&amp;limit=20&amp;start=0","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437660,"discussion_content":"人工检索的时候，进行的URL观察","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577623563,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1033956,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/QD6bf8hkS5dHrabdW7M7Oo9An1Oo3QSxqoySJMDh7GTraxFRX77VZ2HZ13x3R4EVYddIGXicRRDAc7V9z5cLDlA/132","nickname":"爬行的蜗牛","note":"","ucode":"6623B62DE63CE9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":87302,"discussion_content":"chrome F12,选择network,XHR,name对应的就是链接","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576659820,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2368766,"avatar":"","nickname":"lululucat","note":"","ucode":"D63D663E2E8CBE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1033956,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/QD6bf8hkS5dHrabdW7M7Oo9An1Oo3QSxqoySJMDh7GTraxFRX77VZ2HZ13x3R4EVYddIGXicRRDAc7V9z5cLDlA/132","nickname":"爬行的蜗牛","note":"","ucode":"6623B62DE63CE9","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389777,"discussion_content":"你好，为什么我按了XHR，再刷新后，name里面什么也没有呢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629428528,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":87302,"ip_address":""},"score":389777,"extra":""}]}]},{"had_liked":false,"id":63558,"user_name":"漫长的战斗","can_delete":false,"product_type":"c1","uid":1149741,"ip_address":"","ucode":"9A14BB927D63D2","user_header":"https://static001.geekbang.org/account/avatar/00/11/8b/2d/08b5bf72.jpg","comment_is_top":false,"comment_ctime":1548400086,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1548400086","product_id":100021701,"comment_content":"回答一下caidy的留言。研究了一下，可能是这样做的：<br><br>在chrome中打开工具，选择network标签，点击XHR，再点击Name下的那个url，就可以看到了。其中的乱码是“王祖贤”经过url编码得到的。在网上找个工具转化一下就可以了。","like_count":0},{"had_liked":false,"id":63527,"user_name":"Bernie","can_delete":false,"product_type":"c1","uid":1359928,"ip_address":"","ucode":"E082493F877A8D","user_header":"https://static001.geekbang.org/account/avatar/00/14/c0/38/667420c3.jpg","comment_is_top":false,"comment_ctime":1548392997,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1548392997","product_id":100021701,"comment_content":"老师，我根据您的课程 入门了python 写了一个爬虫脚本   遇到了按键被屏蔽的问题 请问您如何解决这类问题的 备注：网上说模拟硬件驱动可以解决 但我尝试找了一个大漠插件 并进行了替代 依然没有什么效果","like_count":0},{"had_liked":false,"id":63405,"user_name":"Sniper","can_delete":false,"product_type":"c1","uid":1385287,"ip_address":"","ucode":"8FEA9AE27A7A08","user_header":"https://static001.geekbang.org/account/avatar/00/15/23/47/6c2a60ee.jpg","comment_is_top":false,"comment_ctime":1548343532,"is_pvip":false,"replies":[{"id":"64665","content":"Good Job","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577623722,"ip_address":"","comment_id":63405,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548343532","product_id":100021701,"comment_content":"交作业：环境  win10，pycharm，3.7<br>差一步格式webp转jpg，感觉用处不是很大，没写<br>import requests<br>from lxml import etree<br>from selenium import webdriver<br><br><br>def download(src, name):<br>    dir = &#39;C:\\images\\\\&#39; + name + &#39;.webp&#39;<br>    # print(dir)<br>    try:<br>        pic = requests.get(src, timeout=10)<br>        # print(pic)<br>        fp = open(dir, &#39;wb&#39;)<br>        # print(fp)<br>        fp.write(pic.content)<br>        fp.close()<br>    except Exception:<br>        print(&quot;error,%s 当前图片无法下载&quot; % src)<br><br><br>driver = webdriver.Chrome(&#39;.&#47;chromedriver&#39;)<br><br>print(type(driver))<br>for start in range(0, 15, 15):<br>    url = &#39;https:&#47;&#47;movie.douban.com&#47;subject_search?search_text=&#39;+&#39;周星驰&#39;+&#39;&amp;cat=1002&#39;+&#39;&amp;start=&#39;+str(start)<br>    driver.get(url)<br>    # print(driver.page_source)<br>    html = etree.HTML(driver.page_source)<br>    src_xpath = &quot;&#47;&#47;*[@class=&#39;item-root&#39;]&#47;a&#47;img&#47;@src&quot;<br>    title_xpath = &quot;&#47;&#47;*[@class=&#39;item-root&#39;]&#47;div[@class=&#39;detail&#39;]&#47;div[@class=&#39;title&#39;]&#47;a&#47;text()&quot;<br>    srcs = html.xpath(src_xpath)<br>    titles = html.xpath(title_xpath)<br>    # print(srcs,titles)<br>    for src,title in zip(srcs, titles):<br>        # print(src)<br>        # print(title)<br>        title = str(title)<br>        download(src, title)<br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437574,"discussion_content":"Good Job","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577623722,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61480,"user_name":"lingmacker","can_delete":false,"product_type":"c1","uid":1353113,"ip_address":"","ucode":"2B61674AD47F34","user_header":"https://static001.geekbang.org/account/avatar/00/14/a5/99/db2f6325.jpg","comment_is_top":false,"comment_ctime":1547706364,"is_pvip":false,"replies":[{"id":"64709","content":"Good Job~","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577624556,"ip_address":"","comment_id":61480,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547706364","product_id":100021701,"comment_content":"前两个星期考试，没时间学习，考完后才开始学习。一下是使用xpath下载豆瓣电影的封面。<br><br>import requests<br>from lxml import etree<br><br><br>def dowmload(name, src):<br>    path = &quot;.&#47;image&#47;video&#47;&quot;<br>    response = requests.get(src, timeout=10)<br>    img = open(path + name + &quot;.jpg&quot;, &quot;wb&quot;)<br>    img.write(response.content)<br>    img.close()<br><br><br>def main():<br>    # 下载刘亦菲电影的海报<br>    r = requests.get(&quot;https:&#47;&#47;www.douban.com&#47;search?cat=1002&amp;q=%E5%88%98%E4%BA%A6%E8%8F%B2&quot;)<br>    html = etree.HTML(r.text)<br><br>    path = &#39;&#47;&#47;div[@class=&quot;result-list&quot;]&#47;div[@class=&quot;result&quot;]&#47;div[@class=&quot;pic&quot;]&#47;a&#47;img&#39;<br>    res = html.xpath(path)<br>    titles = html.xpath(path + &#39;&#47;..&#39;)<br><br>    for i in zip(titles, res):<br>        name = i[0].get(&quot;title&quot;)<br>        src = i[1].get(&quot;src&quot;)<br>        dowmload(name, src)<br><br><br>if __name__ == &#39;__main__&#39;:<br>    main()<br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436883,"discussion_content":"Good Job~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577624556,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61456,"user_name":"小熊猫","can_delete":false,"product_type":"c1","uid":1257442,"ip_address":"","ucode":"7549BA17FFBAD4","user_header":"https://static001.geekbang.org/account/avatar/00/13/2f/e2/3640e491.jpg","comment_is_top":false,"comment_ctime":1547701954,"is_pvip":false,"replies":[{"id":"64711","content":"Good Job~","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577624571,"ip_address":"","comment_id":61456,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547701954","product_id":100021701,"comment_content":"下载所有页码里的图片<br><br># coding: utf-8<br>from selenium import webdriver<br>from lxml import etree<br>import os<br>import requests<br>import re<br><br>searchMovieKeys = &#39;王祖贤&#39;<br>MAX_PAGE = 6<br><br>def download(src, imgId):<br>    img_dir = &#39;D:\\\\Personal\\\\Code\\\\Jupyter\\\\数据分析实战___极客时间\\\\picture\\\\&#39;<br>    # 对imgId做字符串处理，删除字符串中的？<br>    imgId = re.sub(r&#39;[?]&#39;, &#39;&#39;, str(imgId))<br>    if not os.path.exists(img_dir):<br>        os.mkdir(img_dir)<br>    try:<br>        response = requests.get(src, timeout=10)<br>        if response.status_code == 200:<br>            file_path = img_dir + imgId + &#39;.jpg&#39;<br>            if not os.path.exists(file_path):<br>                with open(file_path, &#39;wb&#39;) as f:<br>                    f.write(response.content)<br>            else:<br>                print(&#39;Already downloaded&#39;, file_path)<br>    except requests.ConnectionError:<br>        print(&#39;Failed to download&#39;)<br>    <br>def getMovieImages(page):<br>    print(&#39;正在下载第&#39;, page+1, &#39;页&#39;)<br>    page = page * 15<br>    url = &#39;https:&#47;&#47;movie.douban.com&#47;subject_search?search_text=&#39; \\<br>            + searchMovieKeys + &#39;&amp;cat=1002&amp;start=&#39; + str(page)<br>    driver = webdriver.Chrome()<br>    driver.get(url)<br>    #print(driver.page_source)<br>    # 3. 提取数据，lxml 进行 XPath 定位<br>    html = etree.HTML(driver.page_source)<br>    src_xpath = &quot;&#47;&#47;div[@class=&#39;item-root&#39;]&#47;a[@class=&#39;cover-link&#39;]&#47;img[@class=&#39;cover&#39;]&#47;@src&quot;<br>    title_xpath = &quot;&#47;&#47;div[@class=&#39;item-root&#39;]&#47;div[@class=&#39;detail&#39;]&#47;div[@class=&#39;title&#39;]&#47;a[@class=&#39;title-text&#39;]&quot;<br>    srcs = html.xpath(src_xpath)<br>    titles = html.xpath(title_xpath)<br>    # 这里需要多个变量的for循环，用zip()<br>    for src, title in zip(srcs, titles):<br>        print(&#39;\\t&#39;.join([str(title.text), str(src)]))<br>        download(src, title.text)<br>    <br>    print(&#39;download finish&#39;)<br>    driver.close()<br>    <br>if __name__ == &#39;__main__&#39;:<br>    for i in range(0, MAX_PAGE):<br>        getMovieImages(i)","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436875,"discussion_content":"Good Job~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577624571,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61333,"user_name":"李沛欣","can_delete":false,"product_type":"c1","uid":1362695,"ip_address":"","ucode":"98874954230D95","user_header":"https://static001.geekbang.org/account/avatar/00/14/cb/07/e34220d6.jpg","comment_is_top":false,"comment_ctime":1547682829,"is_pvip":false,"replies":[{"id":"64712","content":"慢慢来~ 付出就会有收获","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577624588,"ip_address":"","comment_id":61333,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547682829","product_id":100021701,"comment_content":"今天的看完了，具体语法有点难，JSON和Xpath两种抓取方式，都需要按照课程中的代码敲一遍。<br><br>八爪鱼抓取已经实验成功，可以做“小数据”分析，不过要用Python实现，还走很长的路要走。<br><br>果然，编程的世界，路漫漫其修远兮。","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436836,"discussion_content":"慢慢来~ 付出就会有收获","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577624588,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":61239,"user_name":"LI.T.F","can_delete":false,"product_type":"c1","uid":1357691,"ip_address":"","ucode":"DDC0AB13CA605F","user_header":"https://static001.geekbang.org/account/avatar/00/14/b7/7b/0893dbd9.jpg","comment_is_top":false,"comment_ctime":1547643804,"is_pvip":false,"replies":[{"id":"64716","content":"没事的 慢慢来，这个你先跑下代码，然后再慢慢理解","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577624640,"ip_address":"","comment_id":61239,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547643804","product_id":100021701,"comment_content":"虽然学过Python，但是老师写的这篇文章完全看不懂，更不说会用了，是不是我基础太差了，关于XPATH、JSON、Selenium这些库之类的完全懵逼。有点慌了","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436799,"discussion_content":"没事的 慢慢来，这个你先跑下代码，然后再慢慢理解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577624640,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57594,"user_name":"跳跳","can_delete":false,"product_type":"c1","uid":1172803,"ip_address":"","ucode":"80B697B89E1A0B","user_header":"https://static001.geekbang.org/account/avatar/00/11/e5/43/7bc7cfe3.jpg","comment_is_top":false,"comment_ctime":1546844440,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546844440","product_id":100021701,"comment_content":"#直接根据豆瓣图片路径下载<br># coding:utf-8<br>import requests<br>import json<br>query = &#39;王祖贤&#39;<br>&#39;&#39;&#39; 下载图片 &#39;&#39;&#39;<br>def download(src, id):<br>           dir = &#39;.&#47;&#39; + str(id) + &#39;.jpg&#39;<br>           try:<br>                     pic = requests.get(src, timeout=10)<br>           except requests.exceptions.ConnectionError:<br>                     #print &#39;error, %d 当前图片无法下载&#39;, %id<br>                     print(&#39;图片无法下载&#39;)<br>           fp = open(dir, &#39;wb&#39;)<br>           fp.write(pic.content)<br>           fp.close()<br> <br>&#39;&#39;&#39; for 循环 请求全部的 url &#39;&#39;&#39;<br>for i in range(0, 22471, 20):<br>           url = &#39;https:&#47;&#47;www.douban.com&#47;j&#47;search_photo?q=&#39;+query+&#39;&amp;limit=20&amp;start=&#39;+str(i)<br>           html = requests.get(url).text    # 得到返回结果<br>           response = json.loads(html,encoding=&#39;utf-8&#39;) # 将 JSON 格式转换成 Python 对象<br>           for image in response[&#39;images&#39;]:<br>                     print image[&#39;src&#39;] # 查看当前下载的图片网址<br>                     download(image[&#39;src&#39;], image[&#39;id&#39;]) # 下载一张图片<br>#通过豆瓣电影下载图片<br>在Xpath Helper中选中海报和电影名称的Xpath<br>src_xpath=&quot;&#47;&#47;div[@class=&#39;item-root&#39;]&#47;a[@class=&#39;cover-link&#39;]&#47;img[@class=&#39;cover&#39;]&#47;@src&quot;<br>title_path=&quot;&#47;&#47;div[@class=&#39;item-root&#39;]&#47;div[@class=&#39;detail&#39;]&#47;div[@class=&#39;title&#39;]&#47;a[@class=&#39;title-text&#39;]&quot;<br>from selenium import webdriver<br>#创建Chrome浏览器的driver<br>driver = webdriver.Chrome()<br>#通过访问dirver获取的访问页面完整的html<br>driver.get(https:&#47;&#47;movie.douban.com&#47;subject_search?search_text=&#39;+ query +&#39;&amp;cat=1002)<br>srcs = html.xpath(src_xpath)<br>titles = html.xpath(title_path)<br>for src, title in zip(srcs, titles):<br>\tdownload(src, title.text)<br>drive.close()","like_count":0},{"had_liked":false,"id":57517,"user_name":"Jerry","can_delete":false,"product_type":"c1","uid":1310404,"ip_address":"","ucode":"B6C99477306866","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEI0AL6EQyEY1MrDaiczGln4nPPAykofXCXibaz3CcRDuIk2nqLdnGTBJ1RIia4ZsPYqBSUGRwDJdmDeQ/132","comment_is_top":false,"comment_ctime":1546826669,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546826669","product_id":100021701,"comment_content":"不能以jpg打开的原因是下载了二进制文件，open函数中参数为&quot;wb&quot;","like_count":0},{"had_liked":false,"id":57464,"user_name":"nrvna","can_delete":false,"product_type":"c1","uid":1352764,"ip_address":"","ucode":"05830A97EF354D","user_header":"https://static001.geekbang.org/account/avatar/00/14/a4/3c/6d0a0cc8.jpg","comment_is_top":false,"comment_ctime":1546817809,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546817809","product_id":100021701,"comment_content":"第二题我的code，借鉴了留言板的内容，转换了图片webp格式，又加了正则处理名字中的问号问题。<br>import requests<br>from selenium import webdriver<br>from lxml import etree<br>import re<br><br>def download(src, name):<br>    url1 = src.split(&#39;webp&#39;)<br>    url2 = url1[0] + &#39;jpg&#39;<br>    dir = &#39;.&#47;data_pachong&#47;&#39; + str(name) + &#39;.jpg&#39;<br>    try:<br>        pic = requests.get(url2, timeout=10)<br>    except requests.exceptions.ConnectionError:<br>        # print &#39;error, %d 当前图片无法下载&#39;, %id<br>        print(&#39;图片无法下载&#39;)<br><br>    fp = open(dir, &#39;wb&#39;)<br>    fp.write(pic.content)<br>    fp.close()<br><br><br>query = &#39;王祖贤&#39;<br>driver = webdriver.Chrome(&#39;D:\\Programming Software\\chromedriver&#39;)<br>for i in range(0, 6*15, 15):<br>    request_url = &#39;https:&#47;&#47;movie.douban.com&#47;subject_search?search_text=&#39;+query+&#39;&amp;cat=1002&amp;start=&#39;+str(i)<br>    driver.get(request_url)<br>    html = etree.HTML(driver.page_source) # 访问网页，然后打印出源代码,etree解析为xpath可以操作的影视<br><br>    src_xpath = &quot;&#47;&#47;*[@class=&#39;item-root&#39;]&#47;a&#47;img&#47;@src&quot;<br>    title_xpath = &quot;&#47;&#47;*[@class=&#39;item-root&#39;]&#47;div[@class=&#39;detail&#39;]&#47;div[@class=&#39;title&#39;]&#47;a&#47;text()&quot;<br><br>    srcs = html.xpath(src_xpath)<br>    titles = html.xpath(title_xpath)<br>    print(srcs)<br>    print(titles)<br>    for src, title in zip(srcs, titles):<br>        print(&#39;\\t&#39;.join([str(src),str(title)]))<br>        title = re.sub(u&#39;\\?&#39;, u&#39; &#39;, title)<br>        download(src, title)<br>driver.close()<br>","like_count":0},{"had_liked":false,"id":57329,"user_name":"闫东汉","can_delete":false,"product_type":"c1","uid":1041830,"ip_address":"","ucode":"A4EA98EF44EA50","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e5/a6/0be17cd5.jpg","comment_is_top":false,"comment_ctime":1546752674,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546752674","product_id":100021701,"comment_content":"QUERY框中的数据是如何得出的呢？<br>","like_count":0},{"had_liked":false,"id":57202,"user_name":"wonderland","can_delete":false,"product_type":"c1","uid":1362584,"ip_address":"","ucode":"ACA8577C9EDE88","user_header":"https://static001.geekbang.org/account/avatar/00/14/ca/98/a75e400b.jpg","comment_is_top":false,"comment_ctime":1546681079,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546681079","product_id":100021701,"comment_content":"运行环境：jupyter<br>最喜欢的明星-宋慧乔，所以以宋慧乔为关键词抓取了她在豆瓣上图片，因为数量过多，所以程序里设置只抓取了20张，并且在最后通过其中的一张图片地址，对图片进行了显示操作。<br>代码如下：<br># coding:utf-8<br>import requests<br>import json<br>query = &#39;宋慧乔&#39;<br>#下载图片函数<br>def download(src, id):<br>           dir = &#39;.&#47;&#39; + str(id) + &#39;.jpg&#39;<br>           try:<br>                     pic = requests.get(src, timeout=10)#打开图片的url，即打开图片网页<br>           except requests.exceptions.ConnectionError:<br>                     #print &#39;error, %d 当前图片无法下载&#39;, %id<br>                     print(&#39;图片无法下载&#39;)<br>           fp = open(dir, &#39;wb&#39;)#在当前打开网页下，打开对应id图片，并返回图片内容<br>           fp.write(pic.content)<br>           fp.close()#打开操作进行关闭<br> <br>for i in range(0, 21, 20):<br>           url = &#39;https:&#47;&#47;www.douban.com&#47;j&#47;search_photo?q=&#39;+query+&#39;&amp;limit=20&amp;start=&#39;+str(i)<br>           html = requests.get(url).text    # 得到返回结果<br>           response = json.loads(html,encoding=&#39;utf-8&#39;) # 将 JSON 格式转换成 Python 对象<br>           for image in response[&#39;images&#39;]:#images是一个对象，是一个数组结构，有多张图片；数组中每个元素image是一个字典的形式，有id，有src等<br>                    # print image[&#39;src&#39;] # 查看当前下载的图片网址<br>                        download(image[&#39;src&#39;], image[&#39;id&#39;]) # 下载一张图片<br>                        print(image[&#39;src&#39;]) #输出当前下载图片的网址<br>#显示图片操作<br>from PIL import Image<br>from io import BytesIO<br>img_src = &#39;https:&#47;&#47;img3.doubanio.com&#47;view&#47;photo&#47;photo&#47;public&#47;p637434872.jpg&#39;<br>res = requests.get(img_src)#利用request请求图片的响应，并返回二进制数据<br>img = Image.open(BytesIO(res.content)) #利用ByteSio库进行二进制数据的读取<br>img.show()<br>print(&#39;图片显示&#39;)<br>","like_count":0},{"had_liked":false,"id":57173,"user_name":"caidy","can_delete":false,"product_type":"c1","uid":1188783,"ip_address":"","ucode":"AEFB529C32C7EE","user_header":"https://static001.geekbang.org/account/avatar/00/12/23/af/84f4714e.jpg","comment_is_top":false,"comment_ctime":1546671980,"is_pvip":false,"replies":[{"id":"21411","content":"我更新了下代码，把pic放到try代码段里了。你可以再试下。遇到这种情况，就是不能正常下载图片，可以把src和id打印出来看下 ","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1547368064,"ip_address":"","comment_id":57173,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546671980","product_id":100021701,"comment_content":"老师，课程的程勋运行一半会出现这样的错误<br>UnboundLocalError： local variable &#39;pic&#39; referenced before assignment","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435443,"discussion_content":"我更新了下代码，把pic放到try代码段里了。你可以再试下。遇到这种情况，就是不能正常下载图片，可以把src和id打印出来看下 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547368064,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57101,"user_name":"拉我吃","can_delete":false,"product_type":"c1","uid":1354151,"ip_address":"","ucode":"8BC9C44FE00097","user_header":"https://static001.geekbang.org/account/avatar/00/14/a9/a7/de3ee890.jpg","comment_is_top":false,"comment_ctime":1546646653,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546646653","product_id":100021701,"comment_content":"发送的请求(request)URL可以多种多样，类似https:&#47;&#47;movie.douban.com&#47;subject_search?search_text=%E7%8E%8B%E7%A5%96%E8%B4%A4&amp;cat=1002&amp;limit=15&amp;start=0 这种的图片是webp格式，需要注意一下。","like_count":0},{"had_liked":false,"id":57075,"user_name":"Lin_嘉杰","can_delete":false,"product_type":"c1","uid":1023901,"ip_address":"","ucode":"377885EBBC9C03","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9f/9d/67a33381.jpg","comment_is_top":false,"comment_ctime":1546614859,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546614859","product_id":100021701,"comment_content":"第二个下载王祖贤电影封面的代码，需要改进<br>环境：Python3，window系统<br><br># coding: utf-8<br>from selenium import webdriver<br>from lxml import etree<br>import re<br>driver = webdriver.Chrome()<br>query = &#39;王祖贤&#39;<br><br>def download(src, id):<br>\tdir = &#39;.&#47;images&#47;wangzuxian&#47;&#39;+str(id)+&#39;.jpg&#39;<br>\ttry:<br>\t\tpic = requests.get(src, timeout=10)<br>\t\twith open(dir, &#39;wb&#39;) as f:<br>\t\t\tf.write(pic.content)<br>\texcept requests.exceptions.ConnectionError:<br>\t\tprint(&#39;图片无法下载&#39;)<br>        # 图片命名失败异常<br>\texcept Exception as e:<br>\t\tprint(&#39;下载图片失败&#39;)<br><br>if __name__ == &#39;__main__&#39;:<br>\tfor i in range(0, 6*15, 15):<br>\t\trequest_url = &#39;https:&#47;&#47;movie.douban.com&#47;subject_search?search_text=&#39;+query+&#39;&amp;cat=1002&amp;start=&#39;+str(i)<br>\t\tdriver.get(request_url)<br>\t\thtml = etree.HTML(driver.page_source)<br><br>\t\tsrc_xpath = &quot;&#47;&#47;*[@class=&#39;item-root&#39;]&#47;a&#47;img&#47;@src&quot;<br>\t\ttitle_xpath = &quot;&#47;&#47;*[@class=&#39;item-root&#39;]&#47;div[@class=&#39;detail&#39;]&#47;div[@class=&#39;title&#39;]&#47;a&#47;text()&quot;<br><br>\t\tsrcs = html.xpath(src_xpath)<br>\t\ttitles = html.xpath(title_xpath)<br><br>\t\tfor src, title in zip(srcs, titles):<br>\t\t\t# print(src)<br>\t\t\tdownload(src, title)<br><br>","like_count":0},{"had_liked":false,"id":57064,"user_name":"Chino","can_delete":false,"product_type":"c1","uid":1347181,"ip_address":"","ucode":"0240D89E5F74B4","user_header":"https://static001.geekbang.org/account/avatar/00/14/8e/6d/c68e07ef.jpg","comment_is_top":false,"comment_ctime":1546611942,"is_pvip":false,"replies":[{"id":"21406","content":"一种方法是你用webdriver来模拟Firefox浏览器","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1547365170,"ip_address":"","comment_id":57064,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546611942","product_id":100021701,"comment_content":"关于第二个王祖贤电影下载的海报 能够运行并爬下来了 但是还有一个问题 因为爬去的图片src都是webp格式的 一开始写的时候自然写成jpg 发现打不开 才想起来 改成webp后 对于这种格式又不能直接预览 有没有什么办法能直接爬成jpg的呢<br>from selenium import webdriver<br>import requests<br>from lxml import etree<br>i = 0<br>def download(src):<br>    global i<br>    try:<br>        r = requests.get(src,timeout = 10)<br>    except requests.exceptions.ConnectionError:<br>        print(&#39;error&#39;)<br>    dl_dir = &#39;.&#47;pictest&#47;&#39; + str(i) + &#39;.jpg&#39;<br>    fp = open(dl_dir,&#39;wb&#39;)<br>    fp.write(r.content)<br>    fp.close()<br>    i += 1<br>    <br>src_xpath = &quot;&#47;&#47;div[@class = &#39;item-root&#39;]&#47;a[@class = &#39;cover-link&#39;]&#47;img[@class = &#39;cover&#39;]&quot;<br><br>request_url = &#39;https:&#47;&#47;movie.douban.com&#47;subject_search?search_text=%E7%8E%8B%E7%A5%96%E8%B4%A4&#39;<br><br>driver = webdriver.Chrome()<br>driver.get(request_url)<br><br>html = etree.HTML(driver.page_source)<br><br>pic_url = html.xpath(src_xpath)<br><br>for j in pic_url:<br>    download(j.get(&#39;src&#39;))<br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435387,"discussion_content":"一种方法是你用webdriver来模拟Firefox浏览器","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547365170,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57002,"user_name":"王      慈","can_delete":false,"product_type":"c1","uid":1298139,"ip_address":"","ucode":"EACC3D086674D8","user_header":"https://static001.geekbang.org/account/avatar/00/13/ce/db/bb1821b3.jpg","comment_is_top":false,"comment_ctime":1546597427,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546597427","product_id":100021701,"comment_content":"您好，我看到现在有那种类似按键精灵的 Selenium IDE，可以直接生成代码。您对这种软件怎么看呢？有了它是不是可以降低对 html XPath js 这些知识的掌握呢？","like_count":0},{"had_liked":false,"id":57000,"user_name":"Lin_嘉杰","can_delete":false,"product_type":"c1","uid":1023901,"ip_address":"","ucode":"377885EBBC9C03","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9f/9d/67a33381.jpg","comment_is_top":false,"comment_ctime":1546596661,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546596661","product_id":100021701,"comment_content":"老师，如果某网站上更新了内容，那怎样也顺便自动爬取内容？我想到的是线上爬取，思路是这样吗？","like_count":0},{"had_liked":false,"id":56996,"user_name":"Chino","can_delete":false,"product_type":"c1","uid":1347181,"ip_address":"","ucode":"0240D89E5F74B4","user_header":"https://static001.geekbang.org/account/avatar/00/14/8e/6d/c68e07ef.jpg","comment_is_top":false,"comment_ctime":1546595624,"is_pvip":false,"replies":[{"id":"21392","content":"需要先下载chromedrive，然后放到浏览器目录中，再把这个目录添加到配置环境变量path里<br>","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1547355104,"ip_address":"","comment_id":56996,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546595624","product_id":100021701,"comment_content":"driver = webdriver.Chrome()<br>为什么输入这个代码就会报错了呢<br>是因为在mac上的原因吗","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435351,"discussion_content":"需要先下载chromedrive，然后放到浏览器目录中，再把这个目录添加到配置环境变量path里\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547355104,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56991,"user_name":"JingZ","can_delete":false,"product_type":"c1","uid":1023464,"ip_address":"","ucode":"6F97895B2CC375","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/wJphZ3HcvhjVUyTWCIsCugzfQY5NAy6VJ0XoPLibDlcHWMswFmFe678zd0lUjFETia80NQhyQcVnGDlKgKPcRGyw/132","comment_is_top":false,"comment_ctime":1546594698,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1546594698","product_id":100021701,"comment_content":"response = json.loads(html,encoding =&#39;utf-8&#39;)<br>出现问题<br>raise JSONDecodeError(&quot;Expecting value&quot;, s, err.value) from None<br>JSONDecodeError: Expecting value<br><br>需要debug了","like_count":0,"discussions":[{"author":{"id":1783634,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/37/52/c1c56b6f.jpg","nickname":"Geek_2008d9","note":"","ucode":"12F1A8B98AD5F7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":81971,"discussion_content":"请问怎么解决啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576302855,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56950,"user_name":"SIXGOD","can_delete":false,"product_type":"c1","uid":1257555,"ip_address":"","ucode":"08EB8532CF87AB","user_header":"https://static001.geekbang.org/account/avatar/00/13/30/53/fbb08f01.jpg","comment_is_top":false,"comment_ctime":1546585581,"is_pvip":false,"replies":[{"id":"21402","content":"方法是OK的，首先你指定了chrome_driver的路径，这样可以使用WebDriver在chrome上进行自动化测试。然后使用xpath提取了图片的链接及名称。最后编写了download函数来完成图片的下载，对于下载异常会进行报错。","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1547363826,"ip_address":"","comment_id":56950,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546585581","product_id":100021701,"comment_content":"麻烦老师和各位大佬指点一下第二个的写法：<br># coding:utf-8<br>import requests<br>import json<br>from selenium import webdriver<br>from lxml import etree<br><br>query = &#39;王祖贤&#39;<br>&#39;&#39;&#39; 下载图片 &#39;&#39;&#39;<br>def download(src, id):<br>  dir = &#39;D:&#47;douban-download&#47;&#39; + str(id) + &#39;.webp&#39;<br>  try:<br>    pic = requests.get(src, timeout=10)<br>  except requests.exceptions.ConnectionError:<br>    #print &#39;error, %d 当前图片无法下载&#39;, %id<br>    print(&#39;图片无法下载&#39;)<br>  fp = open(dir, &#39;wb&#39;)<br>  fp.write(pic.content)<br>  fp.close()<br><br>chrome_driver = &quot;D:\\download\\chromedriver_win32\\chromedriver.exe&quot;<br>driver = webdriver.Chrome(executable_path=chrome_driver)<br><br>request_url = &quot;https:&#47;&#47;movie.douban.com&#47;subject_search?search_text=&quot;+query+&quot;&amp;cat=1002&quot;<br>driver.get(request_url)<br>html = etree.HTML(driver.page_source)<br><br>src_xpath = &quot;&#47;&#47;div[@class=&#39;item-root&#39;]&#47;a[@class=&#39;cover-link&#39;]&#47;img[@class=&#39;cover&#39;]&#47;@src&quot;<br>title_path = &quot;&#47;&#47;div[@class=&#39;item-root&#39;]&#47;div[@class=&#39;detail&#39;]&#47;div[@class=&#39;title&#39;]&#47;a[@class=&#39;title-text&#39;]&quot;<br><br>srcs = html.xpath(src_xpath)<br>titles = html.xpath(title_path)<br>for src, title in zip(srcs, titles):<br>  print(&#39;\\t&#39;.join([str(src),str(title.text)]))<br>  download(src, title.text)<br><br>driver.close()","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435326,"discussion_content":"方法是OK的，首先你指定了chrome_driver的路径，这样可以使用WebDriver在chrome上进行自动化测试。然后使用xpath提取了图片的链接及名称。最后编写了download函数来完成图片的下载，对于下载异常会进行报错。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547363826,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56944,"user_name":"1e-43","can_delete":false,"product_type":"c1","uid":1138688,"ip_address":"","ucode":"8AADC2ED8409E9","user_header":"https://static001.geekbang.org/account/avatar/00/11/60/00/3dbaf430.jpg","comment_is_top":false,"comment_ctime":1546584283,"is_pvip":false,"replies":[{"id":"21391","content":"找个时间，我会专门讲讲爬虫","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1547353956,"ip_address":"","comment_id":56944,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546584283","product_id":100021701,"comment_content":"老师好，可以专门做节课讲下Xpath吗，之前完全没接触过这方面","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435324,"discussion_content":"找个时间，我会专门讲讲爬虫","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547353956,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56908,"user_name":"蜘蛛的梦呓","can_delete":false,"product_type":"c1","uid":1190207,"ip_address":"","ucode":"42FF5C7FF4D2E1","user_header":"https://static001.geekbang.org/account/avatar/00/12/29/3f/ae7718f6.jpg","comment_is_top":false,"comment_ctime":1546576909,"is_pvip":false,"replies":[{"id":"21383","content":"可以有","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1547348529,"ip_address":"","comment_id":56908,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546576909","product_id":100021701,"comment_content":"老师，我更想看「分析思维和分析技巧」方面的内容，后续会出吗？","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435307,"discussion_content":"可以有","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547348529,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56861,"user_name":"林","can_delete":false,"product_type":"c1","uid":1022243,"ip_address":"","ucode":"273F83CB3F9DF8","user_header":"https://static001.geekbang.org/account/avatar/00/0f/99/23/3c3272bd.jpg","comment_is_top":false,"comment_ctime":1546569847,"is_pvip":false,"replies":[{"id":"21389","content":"你可以查看下是否安装了Chrome浏览器，因为这个是自动化测试，会调用本地的Chrome浏览器","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1547353866,"ip_address":"","comment_id":56861,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546569847","product_id":100021701,"comment_content":"#pip install selenium<br>#pip install chromedriver<br>之后代码中<br>driver = webdriver.Chrome()<br>driver.get(requestUrl)<br>发起请求，报selenium.common.exceptions.WebDriverException: Message: unknown error: cannot find Chrome binary错呢，啥情况？","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435284,"discussion_content":"你可以查看下是否安装了Chrome浏览器，因为这个是自动化测试，会调用本地的Chrome浏览器","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547353866,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}