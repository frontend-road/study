{"id":703296,"title":"08ï½œé“¾ï¼ˆä¸Šï¼‰ï¼šå†™ä¸€ç¯‡å®Œç¾é²œèŠ±æ¨æ–‡ï¼Ÿç”¨SequencialChainé“¾æ¥ä¸åŒçš„ç»„ä»¶","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯é»„ä½³ã€‚æ¬¢è¿æ¥åˆ°LangChainå®æˆ˜è¯¾ï¼</p><p>åˆ°è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å·²ç»å­¦åˆ°äº†ä¸å°‘LangChainçš„åº”ç”¨ï¼Œä¹Ÿä½“ä¼šåˆ°äº†LangChainåŠŸèƒ½çš„å¼ºå¤§ã€‚ä½†ä¹Ÿè®¸ä½ å¿ƒé‡Œå¼€å§‹å‡ºç°äº†ä¸€ä¸ªç–‘é—®ï¼šLangChainï¼Œå…¶ä¸­çš„ <strong>Chain</strong> è‚¯å®šæ˜¯å…³é”®ç»„ä»¶ï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜æ²¡æœ‰è®²åˆ°å‘¢ï¼Ÿ</p><p>è¿™çš„ç¡®æ˜¯ä¸ªå¥½é—®é¢˜ã€‚å¯¹äºç®€å•çš„åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œç›´æ¥è°ƒç”¨LLMå°±å·²ç»è¶³å¤Ÿäº†ã€‚å› æ­¤ï¼Œåœ¨å‰å‡ èŠ‚è¯¾çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦é€šè¿‡LangChainä¸­æä¾›çš„æç¤ºæ¨¡æ¿ã€æ¨¡å‹æ¥å£ä»¥åŠè¾“å‡ºè§£æå™¨å°±å®ç°äº†æƒ³è¦çš„åŠŸèƒ½ã€‚</p><h2>ä»€ä¹ˆæ˜¯ Chain</h2><p>ä½†æ˜¯ï¼Œå¦‚æœä½ æƒ³å¼€å‘æ›´å¤æ‚çš„åº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆå°±éœ€è¦é€šè¿‡ â€œChainâ€ æ¥é“¾æ¥LangChainçš„å„ä¸ªç»„ä»¶å’ŒåŠŸèƒ½â€”â€”æ¨¡å‹ä¹‹é—´å½¼æ­¤é“¾æ¥ï¼Œæˆ–æ¨¡å‹ä¸å…¶ä»–ç»„ä»¶é“¾æ¥ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e2/de/e26993dd3957bfd2947424abb9de7cde.png?wh=1965x1363\" alt=\"\"></p><p>è¿™ç§å°†å¤šä¸ªç»„ä»¶ç›¸äº’é“¾æ¥ï¼Œç»„åˆæˆä¸€ä¸ªé“¾çš„æƒ³æ³•ç®€å•ä½†å¾ˆå¼ºå¤§ã€‚å®ƒç®€åŒ–äº†å¤æ‚åº”ç”¨ç¨‹åºçš„å®ç°ï¼Œå¹¶ä½¿ä¹‹æ›´åŠ æ¨¡å—åŒ–ï¼Œèƒ½å¤Ÿåˆ›å»ºå‡ºå•ä¸€çš„ã€è¿è´¯çš„åº”ç”¨ç¨‹åºï¼Œä»è€Œä½¿è°ƒè¯•ã€ç»´æŠ¤å’Œæ”¹è¿›åº”ç”¨ç¨‹åºå˜å¾—å®¹æ˜“ã€‚</p><p><strong>è¯´åˆ°é“¾çš„å®ç°å’Œä½¿ç”¨ï¼Œä¹Ÿç®€å•ã€‚</strong></p><ul>\n<li>é¦–å…ˆLangChainé€šè¿‡è®¾è®¡å¥½çš„æ¥å£ï¼Œå®ç°ä¸€ä¸ªå…·ä½“çš„é“¾çš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼ŒLLMé“¾ï¼ˆLLMChainï¼‰èƒ½å¤Ÿæ¥å—ç”¨æˆ·è¾“å…¥ï¼Œä½¿ç”¨ PromptTemplate å¯¹å…¶è¿›è¡Œæ ¼å¼åŒ–ï¼Œç„¶åå°†æ ¼å¼åŒ–çš„å“åº”ä¼ é€’ç»™ LLMã€‚è¿™å°±ç›¸å½“äºæŠŠæ•´ä¸ªModel I/Oçš„æµç¨‹å°è£…åˆ°é“¾é‡Œé¢ã€‚</li>\n<li>å®ç°äº†é“¾çš„å…·ä½“åŠŸèƒ½ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å°†å¤šä¸ªé“¾ç»„åˆåœ¨ä¸€èµ·ï¼Œæˆ–è€…å°†é“¾ä¸å…¶ä»–ç»„ä»¶ç»„åˆæ¥æ„å»ºæ›´å¤æ‚çš„é“¾ã€‚</li>\n</ul><!-- [[[read_end]]] --><p>æ‰€ä»¥ä½ çœ‹ï¼Œé“¾åœ¨å†…éƒ¨æŠŠä¸€ç³»åˆ—çš„åŠŸèƒ½è¿›è¡Œå°è£…ï¼Œè€Œé“¾çš„å¤–éƒ¨åˆ™åˆå¯ä»¥ç»„åˆä¸²è”ã€‚<strong>é“¾å…¶å®å¯ä»¥è¢«è§†ä¸ºLangChainä¸­çš„ä¸€ç§åŸºæœ¬åŠŸèƒ½å•å…ƒã€‚</strong></p><p>LangChainä¸­æä¾›äº†å¾ˆå¤šç§ç±»å‹çš„é¢„ç½®é“¾ï¼Œç›®çš„æ˜¯ä½¿å„ç§å„æ ·çš„ä»»åŠ¡å®ç°èµ·æ¥æ›´åŠ æ–¹ä¾¿ã€è§„èŒƒã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/8b/c3/8b580b2b8e0fc8515d271165a46101c3.jpg?wh=1702x861\" alt=\"\"></p><p>æˆ‘ä»¬å…ˆä½¿ç”¨ä¸€ä¸‹æœ€åŸºç¡€ä¹Ÿæ˜¯æœ€å¸¸è§çš„LLMChainã€‚</p><h2>LLMChainï¼šæœ€ç®€å•çš„é“¾</h2><p>LLMChainå›´ç»•ç€è¯­è¨€æ¨¡å‹æ¨ç†åŠŸèƒ½åˆæ·»åŠ äº†ä¸€äº›åŠŸèƒ½ï¼Œæ•´åˆäº†PromptTemplateã€è¯­è¨€æ¨¡å‹ï¼ˆLLMæˆ–èŠå¤©æ¨¡å‹ï¼‰å’Œ Output Parserï¼Œç›¸å½“äºæŠŠModel I/Oæ”¾åœ¨ä¸€ä¸ªé“¾ä¸­æ•´ä½“æ“ä½œã€‚å®ƒä½¿ç”¨æç¤ºæ¨¡æ¿æ ¼å¼åŒ–è¾“å…¥ï¼Œå°†æ ¼å¼åŒ–çš„å­—ç¬¦ä¸²ä¼ é€’ç»™ LLMï¼Œå¹¶è¿”å› LLM è¾“å‡ºã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœæˆ‘æƒ³è®©å¤§æ¨¡å‹å‘Šè¯‰æˆ‘æŸç§èŠ±çš„èŠ±è¯­ï¼Œå¦‚æœä¸ä½¿ç”¨é“¾ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">#----ç¬¬ä¸€æ­¥ åˆ›å»ºæç¤º\n# å¯¼å…¥LangChainä¸­çš„æç¤ºæ¨¡æ¿\nfrom langchain import PromptTemplate\n# åŸå§‹å­—ç¬¦ä¸²æ¨¡æ¿\ntemplate = \"{flower}çš„èŠ±è¯­æ˜¯?\"\n# åˆ›å»ºLangChainæ¨¡æ¿\nprompt_temp = PromptTemplate.from_template(template) \n# æ ¹æ®æ¨¡æ¿åˆ›å»ºæç¤º\nprompt = prompt_temp.format(flower='ç«ç‘°')\n# æ‰“å°æç¤ºçš„å†…å®¹\nprint(prompt)\n\n#----ç¬¬äºŒæ­¥ åˆ›å»ºå¹¶è°ƒç”¨æ¨¡å‹ \n# å¯¼å…¥LangChainä¸­çš„OpenAIæ¨¡å‹æ¥å£\nfrom langchain import OpenAI\n# åˆ›å»ºæ¨¡å‹å®ä¾‹\nmodel = OpenAI(temperature=0)\n# ä¼ å…¥æç¤ºï¼Œè°ƒç”¨æ¨¡å‹ï¼Œè¿”å›ç»“æœ\nresult = model(prompt)\nprint(result)\n</code></pre><p>è¾“å‡ºï¼š</p><pre><code class=\"language-plain\">ç«ç‘°çš„èŠ±è¯­æ˜¯?\nçˆ±æƒ…ã€æµªæ¼«ã€ç¾ä¸½ã€æ°¸æ’ã€èª“è¨€ã€åšè´ä¸æ¸ã€‚\n</code></pre><p>æ­¤æ—¶Model I/Oçš„å®ç°åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œæç¤ºæ¨¡æ¿çš„æ„å»ºå’Œæ¨¡å‹çš„è°ƒç”¨ç‹¬ç«‹å¤„ç†ã€‚</p><p>å¦‚æœä½¿ç”¨é“¾ï¼Œä»£ç ç»“æ„åˆ™æ˜¾å¾—æ›´ç®€æ´ã€‚</p><pre><code class=\"language-plain\"># å¯¼å…¥æ‰€éœ€çš„åº“\nfrom langchain import PromptTemplate, OpenAI, LLMChain\n# åŸå§‹å­—ç¬¦ä¸²æ¨¡æ¿\ntemplate = \"{flower}çš„èŠ±è¯­æ˜¯?\"\n# åˆ›å»ºæ¨¡å‹å®ä¾‹\nllm = OpenAI(temperature=0)\n# åˆ›å»ºLLMChain\nllm_chain = LLMChain(\n&nbsp; &nbsp; llm=llm,\n&nbsp; &nbsp; prompt=PromptTemplate.from_template(template))\n# è°ƒç”¨LLMChainï¼Œè¿”å›ç»“æœ\nresult = llm_chain(\"ç«ç‘°\")\nprint(result)\n</code></pre><p>è¾“å‡ºï¼š</p><pre><code class=\"language-plain\">{'flower': 'ç«ç‘°', 'text': '\\n\\nçˆ±æƒ…ã€æµªæ¼«ã€ç¾ä¸½ã€æ°¸æ’ã€èª“è¨€ã€åšè´ä¸æ¸ã€‚'}\n</code></pre><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°±æŠŠæç¤ºæ¨¡æ¿çš„æ„å»ºå’Œæ¨¡å‹çš„è°ƒç”¨å°è£…åœ¨ä¸€èµ·äº†ã€‚</p><h2>é“¾çš„è°ƒç”¨æ–¹å¼</h2><p>é“¾æœ‰å¾ˆå¤šç§è°ƒç”¨æ–¹å¼ã€‚</p><h3>ç›´æ¥è°ƒç”¨</h3><p>åˆšæ‰æˆ‘ä»¬æ˜¯ç›´æ¥è°ƒç”¨çš„é“¾å¯¹è±¡ã€‚å½“æˆ‘ä»¬åƒå‡½æ•°ä¸€æ ·è°ƒç”¨ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå®ƒå®é™…ä¸Šä¼šè°ƒç”¨è¯¥å¯¹è±¡å†…éƒ¨å®ç°çš„__call__æ–¹æ³•ã€‚</p><p>å¦‚æœä½ çš„æç¤ºæ¨¡æ¿ä¸­åŒ…å«å¤šä¸ªå˜é‡ï¼Œåœ¨è°ƒç”¨é“¾çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨å­—å…¸ä¸€æ¬¡æ€§è¾“å…¥å®ƒä»¬ã€‚</p><pre><code class=\"language-plain\">prompt = PromptTemplate(\n&nbsp; &nbsp; input_variables=[\"flower\", \"season\"],\n&nbsp; &nbsp; template=\"{flower}åœ¨{season}çš„èŠ±è¯­æ˜¯?\",\n)\nllm_chain = LLMChain(llm=llm, prompt=prompt)\nprint(llm_chain({\n&nbsp; &nbsp; 'flower': \"ç«ç‘°\",\n&nbsp; &nbsp; 'season': \"å¤å­£\" }))\n</code></pre><p>è¾“å‡ºï¼š</p><pre><code class=\"language-plain\">{'flower': 'ç«ç‘°', 'season': 'å¤å­£', 'text': '\\n\\nç«ç‘°åœ¨å¤å­£çš„èŠ±è¯­æ˜¯çˆ±çš„èª“è¨€ï¼Œçƒ­æƒ…ï¼Œç¾ä¸½ï¼Œåšå®šçš„çˆ±æƒ…ã€‚'}\n</code></pre><h3>é€šè¿‡runæ–¹æ³•</h3><p>é€šè¿‡runæ–¹æ³•ï¼Œä¹Ÿç­‰ä»·äºç›´æ¥è°ƒç”¨_call_å‡½æ•°ã€‚</p><p>è¯­å¥ï¼š</p><pre><code class=\"language-plain\">llm_chain(\"ç«ç‘°\")\n</code></pre><p>ç­‰ä»·äºï¼š</p><pre><code class=\"language-plain\">llm_chain.run(\"ç«ç‘°\")\n</code></pre><h3>é€šè¿‡predictæ–¹æ³•</h3><p>predictæ–¹æ³•ç±»ä¼¼äºrunï¼Œåªæ˜¯è¾“å…¥é”®è¢«æŒ‡å®šä¸ºå…³é”®å­—å‚æ•°è€Œä¸æ˜¯ Python å­—å…¸ã€‚</p><pre><code class=\"language-plain\">result = llm_chain.predict(flower=\"ç«ç‘°\")\nprint(result)\n</code></pre><h3>é€šè¿‡applyæ–¹æ³•</h3><p>applyæ–¹æ³•å…è®¸æˆ‘ä»¬é’ˆå¯¹è¾“å…¥åˆ—è¡¨è¿è¡Œé“¾ï¼Œä¸€æ¬¡å¤„ç†å¤šä¸ªè¾“å…¥ã€‚</p><p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\"># applyå…è®¸æ‚¨é’ˆå¯¹è¾“å…¥åˆ—è¡¨è¿è¡Œé“¾\ninput_list = [\n&nbsp; &nbsp; {\"flower\": \"ç«ç‘°\",'season': \"å¤å­£\"},\n&nbsp; &nbsp; {\"flower\": \"ç™¾åˆ\",'season': \"æ˜¥å­£\"},\n&nbsp; &nbsp; {\"flower\": \"éƒé‡‘é¦™\",'season': \"ç§‹å­£\"}\n]\nresult = llm_chain.apply(input_list)\nprint(result)\n</code></pre><p>è¾“å‡ºï¼š</p><pre><code class=\"language-plain\">'''[{'text': '\\n\\nç«ç‘°åœ¨å¤å­£çš„èŠ±è¯­æ˜¯â€œæ‹çˆ±â€ã€â€œçƒ­æƒ…â€å’Œâ€œæµªæ¼«â€ã€‚'}, \n{'text': '\\n\\nç™¾åˆåœ¨æ˜¥å­£çš„èŠ±è¯­æ˜¯â€œçˆ±æƒ…â€å’Œâ€œå‹è°Šâ€ã€‚'},\n&nbsp;{'text': '\\n\\néƒé‡‘é¦™åœ¨ç§‹å­£çš„èŠ±è¯­è¡¨è¾¾çš„æ˜¯â€œçƒ­æƒ…â€ã€â€œæ€å¿µâ€ã€â€œçˆ±æ‹â€ã€â€œå›å¿†â€å’Œâ€œæŒä¹…çš„çˆ±â€ã€‚'}]'''\n</code></pre><h3>é€šè¿‡generateæ–¹æ³•</h3><p>generateæ–¹æ³•ç±»ä¼¼äºapplyï¼Œåªä¸è¿‡å®ƒè¿”å›ä¸€ä¸ªLLMResultå¯¹è±¡ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²ã€‚LLMResulté€šå¸¸åŒ…å«æ¨¡å‹ç”Ÿæˆæ–‡æœ¬è¿‡ç¨‹ä¸­çš„ä¸€äº›ç›¸å…³ä¿¡æ¯ï¼Œä¾‹å¦‚ä»¤ç‰Œæ•°é‡ã€æ¨¡å‹åç§°ç­‰ã€‚</p><pre><code class=\"language-plain\">result = llm_chain.generate(input_list)\nprint(result)\n</code></pre><p>è¾“å‡ºï¼š</p><pre><code class=\"language-plain\">generations=[[Generation(text='\\n\\nç«ç‘°åœ¨å¤å­£çš„èŠ±è¯­æ˜¯â€œçƒ­æƒ…â€ã€â€œçˆ±æƒ…â€å’Œâ€œå¹¸ç¦â€ã€‚', \ngeneration_info={'finish_reason': 'stop', 'logprobs': None})], \n[Generation(text='\\n\\næ˜¥å­£çš„èŠ±è¯­æ˜¯çˆ±æƒ…ã€å¹¸ç¦ã€ç¾æ»¡ã€åšè´ä¸æ¸ã€‚', \ngeneration_info={'finish_reason': 'stop', 'logprobs': None})], \n[Generation(text='\\n\\nç§‹å­£çš„èŠ±è¯­æ˜¯â€œæ€å¿µâ€ã€‚é“¶è‰²çš„ç™¾åˆè±¡å¾ç€â€œçœŸçˆ±â€ï¼Œè€Œæ·¡ç´«è‰²çš„éƒé‡‘é¦™åˆ™è±¡å¾ç€â€œæ€å¿µâ€ï¼Œå› ä¸ºå®ƒä»¬åœ¨ç§‹å¤©é‡Œç»½æ”¾çš„æ—¶å€™ï¼ŒçŠ¹å¦‚åœ¨æ€å¿µç€å¤å¤©çš„æ¸©æš–ã€‚', \ngeneration_info={'finish_reason': 'stop', 'logprobs': None})]] \nllm_output={'token_usage': {'completion_tokens': 243, 'total_tokens': 301, 'prompt_tokens': 58}, 'model_name': 'gpt-3.5-turbo-instruct'} \nrun=[RunInfo(run_id=UUID('13058cca-881d-4b76-b0cf-0f9c831af6c4')), \nRunInfo(run_id=UUID('7f38e33e-bab5-4d03-b77c-f50cd195affb')), \nRunInfo(run_id=UUID('7a1e45fd-77ee-4133-aab0-431147186db8'))]\n</code></pre><h2>Sequential Chainï¼šé¡ºåºé“¾</h2><p>å¥½ï¼Œåˆ°è¿™é‡Œï¼Œä½ å·²ç»æŒæ¡äº†æœ€åŸºæœ¬çš„LLMChainçš„ç”¨æ³•ã€‚ä¸‹é¢ï¼Œæˆ‘è¦å¸¦ç€ä½ ç”¨Sequential Chain æŠŠå‡ ä¸ªLLMChainä¸²èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªé¡ºåºé“¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/48/36/48f3f524ecf2d2yyeb11fd54yyf99f36.png?wh=665x360\" alt=\"\"></p><p>è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯è¿™æ ·çš„ï¼š</p><ul>\n<li>ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬å‡è®¾å¤§æ¨¡å‹æ˜¯ä¸€ä¸ªæ¤ç‰©å­¦å®¶ï¼Œè®©ä»–ç»™å‡ºæŸç§ç‰¹å®šé²œèŠ±çš„çŸ¥è¯†å’Œä»‹ç»ã€‚</li>\n<li>ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬å‡è®¾å¤§æ¨¡å‹æ˜¯ä¸€ä¸ªé²œèŠ±è¯„è®ºè€…ï¼Œè®©ä»–å‚è€ƒä¸Šé¢æ¤ç‰©å­¦å®¶çš„æ–‡å­—è¾“å‡ºï¼Œå¯¹é²œèŠ±è¿›è¡Œè¯„è®ºã€‚</li>\n<li>ç¬¬ä¸‰æ­¥ï¼Œæˆ‘ä»¬å‡è®¾å¤§æ¨¡å‹æ˜¯æ˜“é€Ÿé²œèŠ±çš„ç¤¾äº¤åª’ä½“è¿è¥ç»ç†ï¼Œè®©ä»–å‚è€ƒä¸Šé¢æ¤ç‰©å­¦å®¶å’Œé²œèŠ±è¯„è®ºè€…çš„æ–‡å­—è¾“å‡ºï¼Œæ¥å†™ä¸€ç¯‡é²œèŠ±è¿è¥æ–‡æ¡ˆã€‚</li>\n</ul><p>ä¸‹é¢æˆ‘ä»¬å°±æ¥ä¸€æ­¥æ­¥åœ°å®ç°è¿™ä¸ªç¤ºä¾‹ã€‚</p><p>é¦–å…ˆï¼Œå¯¼å…¥æ‰€æœ‰éœ€è¦çš„åº“ã€‚</p><pre><code class=\"language-plain\"># è®¾ç½®OpenAI APIå¯†é’¥\nimport os\nos.environ[\"OPENAI_API_KEY\"] = 'ä½ çš„OpenAI API Key'\n\nfrom langchain.llms import OpenAI\nfrom langchain.chains import LLMChain\nfrom langchain.prompts import PromptTemplate\nfrom langchain.chains import SequentialChain\n</code></pre><p>ç„¶åï¼Œæ·»åŠ ç¬¬ä¸€ä¸ªLLMChainï¼Œç”Ÿæˆé²œèŠ±çš„çŸ¥è¯†æ€§è¯´æ˜ã€‚</p><pre><code class=\"language-plain\"># è¿™æ˜¯ç¬¬ä¸€ä¸ªLLMChainï¼Œç”¨äºç”Ÿæˆé²œèŠ±çš„ä»‹ç»ï¼Œè¾“å…¥ä¸ºèŠ±çš„åç§°å’Œç§ç±»\nllm = OpenAI(temperature=.7)\ntemplate = \"\"\"\nä½ æ˜¯ä¸€ä¸ªæ¤ç‰©å­¦å®¶ã€‚ç»™å®šèŠ±çš„åç§°å’Œç±»å‹ï¼Œä½ éœ€è¦ä¸ºè¿™ç§èŠ±å†™ä¸€ä¸ª200å­—å·¦å³çš„ä»‹ç»ã€‚\n\nèŠ±å: {name}\né¢œè‰²: {color}\næ¤ç‰©å­¦å®¶: è¿™æ˜¯å…³äºä¸Šè¿°èŠ±çš„ä»‹ç»:\"\"\"\nprompt_template = PromptTemplate(input_variables=[\"name\", \"color\"], template=template)\nintroduction_chain = LLMChain(llm=llm, prompt=prompt_template, output_key=\"introduction\")\n</code></pre><p>æ¥ç€ï¼Œæ·»åŠ ç¬¬äºŒä¸ªLLMChainï¼Œæ ¹æ®é²œèŠ±çš„çŸ¥è¯†æ€§è¯´æ˜ç”Ÿæˆè¯„è®ºã€‚</p><pre><code class=\"language-plain\"># è¿™æ˜¯ç¬¬äºŒä¸ªLLMChainï¼Œç”¨äºæ ¹æ®é²œèŠ±çš„ä»‹ç»å†™å‡ºé²œèŠ±çš„è¯„è®º\nllm = OpenAI(temperature=.7)\ntemplate = \"\"\"\nä½ æ˜¯ä¸€ä½é²œèŠ±è¯„è®ºå®¶ã€‚ç»™å®šä¸€ç§èŠ±çš„ä»‹ç»ï¼Œä½ éœ€è¦ä¸ºè¿™ç§èŠ±å†™ä¸€ç¯‡200å­—å·¦å³çš„è¯„è®ºã€‚\n\né²œèŠ±ä»‹ç»:\n{introduction}\nèŠ±è¯„äººå¯¹ä¸Šè¿°èŠ±çš„è¯„è®º:\"\"\"\nprompt_template = PromptTemplate(input_variables=[\"introduction\"], template=template)\nreview_chain = LLMChain(llm=llm, prompt=prompt_template, output_key=\"review\")\n</code></pre><p>æ¥ç€ï¼Œæ·»åŠ ç¬¬ä¸‰ä¸ªLLMChainï¼Œæ ¹æ®é²œèŠ±çš„ä»‹ç»å’Œè¯„è®ºå†™å‡ºä¸€ç¯‡è‡ªåª’ä½“çš„æ–‡æ¡ˆã€‚</p><pre><code class=\"language-plain\"># è¿™æ˜¯ç¬¬ä¸‰ä¸ªLLMChainï¼Œç”¨äºæ ¹æ®é²œèŠ±çš„ä»‹ç»å’Œè¯„è®ºå†™å‡ºä¸€ç¯‡è‡ªåª’ä½“çš„æ–‡æ¡ˆ\ntemplate = \"\"\"\nä½ æ˜¯ä¸€å®¶èŠ±åº—çš„ç¤¾äº¤åª’ä½“ç»ç†ã€‚ç»™å®šä¸€ç§èŠ±çš„ä»‹ç»å’Œè¯„è®ºï¼Œä½ éœ€è¦ä¸ºè¿™ç§èŠ±å†™ä¸€ç¯‡ç¤¾äº¤åª’ä½“çš„å¸–å­ï¼Œ300å­—å·¦å³ã€‚\n\né²œèŠ±ä»‹ç»:\n{introduction}\nèŠ±è¯„äººå¯¹ä¸Šè¿°èŠ±çš„è¯„è®º:\n{review}\n\nç¤¾äº¤åª’ä½“å¸–å­:\n\"\"\"\nprompt_template = PromptTemplate(input_variables=[\"introduction\", \"review\"], template=template)\nsocial_post_chain = LLMChain(llm=llm, prompt=prompt_template, output_key=\"social_post_text\")\n</code></pre><p>æœ€åï¼Œæ·»åŠ SequentialChainï¼ŒæŠŠå‰é¢ä¸‰ä¸ªé“¾ä¸²èµ·æ¥ã€‚</p><pre><code class=\"language-plain\"># è¿™æ˜¯æ€»çš„é“¾ï¼Œæˆ‘ä»¬æŒ‰é¡ºåºè¿è¡Œè¿™ä¸‰ä¸ªé“¾\noverall_chain = SequentialChain(\n    chains=[introduction_chain, review_chain, social_post_chain],\n    input_variables=[\"name\", \"color\"],\n    output_variables=[\"introduction\",\"review\",\"social_post_text\"],\n    verbose=True)\n\n# è¿è¡Œé“¾ï¼Œå¹¶æ‰“å°ç»“æœ\nresult = overall_chain({\"name\":\"ç«ç‘°\", \"color\": \"é»‘è‰²\"})\nprint(result)\n</code></pre><p>æœ€ç»ˆçš„è¾“å‡ºå¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">&gt; Entering new&nbsp; chain...\n\n&gt; Finished chain.\n{'name': 'ç«ç‘°', 'color': 'é»‘è‰²', \n'introduction': '\\n\\né»‘è‰²ç«ç‘°ï¼Œè¿™æ˜¯ä¸€ç§å¯¹ä¼ ç»Ÿç«ç‘°èŠ±çš„ç‹¬ç‰¹é¢ è¦†ï¼Œå®ƒçš„å‡ºç°æŒ‘æˆ˜äº†æˆ‘ä»¬å¯¹ç«ç‘°é¢œè‰²çš„å›ºæœ‰è®¤çŸ¥ã€‚å®ƒçš„èŠ±ç“£å¦‚ç…¤ç‚­èˆ¬é»‘äº®ï¼Œåå°„å‡ºç‹¬ç‰¹çš„å¾®å…‰ï¼Œè€ŒèŠ±è•Šåˆ™æ˜¯é‡‘é»„è‰²çš„ï¼Œå®›å¦‚å¤œç©ºä¸­çš„ä¸€é¢—æ˜Ÿï¼Œå¼ºçƒˆçš„é¢œè‰²å¯¹æ¯”è¥é€ å‡ºä¸€ç§å‰æ‰€æœªæœ‰çš„è§†è§‰æ•ˆæœã€‚åœ¨æ¤ç‰©å­¦ä¸­ï¼Œé»‘è‰²ç«ç‘°çš„å‡ºç°æ— ç–‘æä¾›äº†ä¸€ç§æ–°çš„ç ”ç©¶æ–¹å‘ï¼Œå¯¹äºæˆ‘ä»¬ç†è§£èŠ±æœµè‰²å½©å½¢æˆçš„æœºåˆ¶æœ‰ç€é‡è¦çš„ç§‘å­¦ä»·å€¼ã€‚', \n'review': '\\n\\né»‘è‰²ç«ç‘°ï¼Œè¿™ä¸ä»…ä»…æ˜¯ä¸€ç§èŠ±æœµï¼Œæ›´æ˜¯ä¸€ç§å®Œå…¨é¢ è¦†ä¼ ç»Ÿçš„è‰ºæœ¯è¡¨ç°å½¢å¼ã€‚é»‘è‰²çš„èŠ±ç“£ä»¿ä½›åœ¨è¯‰è¯´ä¸€ç§ä¸å¯è¨€å–»çš„æ‚²ä¼¤ä¸ç¥ç§˜ï¼Œè€Œé»„è‰²çš„è•Šç“£çŠ¹å¦‚æ¼†é»‘å¤œç©ºä¸­çš„ä¸€æŠ¹äº®è‰²ï¼Œç»™äººå¸¦æ¥æ— å°½çš„æƒ³è±¡ã€‚å®ƒå°†æ‚²ä¼¤ä¸æ¬¢ä¹ï¼Œç¥ç§˜ä¸æ˜äº®å®Œç¾åœ°ç»“åˆåœ¨ä¸€èµ·ï¼Œè¿™æ˜¯ä¸€ç§å…¨æ–°çš„è§†è§‰äº«å—ï¼Œä¹Ÿæ˜¯ä¸€ç§å¯¹ç”Ÿæ´»ç†è§£çš„æ·±åº¦è¡¨è¾¾ã€‚', \n'social_post_text': '\\næ¬¢è¿æ¥åˆ°æˆ‘ä»¬çš„è‡ªåª’ä½“å¹³å°ï¼Œä»Šå¤©ï¼Œæˆ‘ä»¬è¦å‘æ‚¨å±•ç¤ºçš„æ˜¯æˆ‘ä»¬çš„å…¨æ–°äº§å“â€”â€”é»‘è‰²ç«ç‘°ã€‚è¿™ä¸ä»…ä»…æ˜¯ä¸€ç§èŠ±ï¼Œè¿™æ˜¯ä¸€ç§å¯¹ä¼ ç»Ÿè§‚å¿µçš„æŒ‘æˆ˜ï¼Œä¸€ç§è§†è§‰è‰ºæœ¯çš„é©æ–°ï¼Œæ›´æ˜¯ä¸€ç§ç”Ÿæ´»æ€åº¦çš„è±¡å¾ã€‚\nè¿™ç§åˆ«æ ·çš„ç«ç‘°èŠ±ï¼Œå…¶é»‘è‰²èŠ±ç“£å®›å¦‚æ¼†é»‘å¤œç©ºä¸­é—ªçƒçš„ç¹æ˜Ÿï¼Œå¯Œæœ‰ç¥ç§˜çš„æ·±åº¦æ„Ÿï¼Œç»™äººä¸€ç§å‰æ‰€æœªæœ‰çš„è§†è§‰å†²å‡»åŠ›ã€‚è¿™ç§é»‘è‰²ï¼Œå®ƒä¸æ˜¯å†·é…·ã€ä¸æ˜¯ç»æœ›ï¼Œè€Œæ˜¯å……æ»¡ç€ç‹¬ç‰¹çš„é­…åŠ›å’ŒåŠ›é‡ã€‚è€Œä½äºé»‘è‰²èŠ±ç“£ä¹‹ä¸­çš„é‡‘é»„è‰²èŠ±è•Šï¼Œåˆ™çŠ¹å¦‚æ˜Ÿæ˜Ÿä¸­çš„çµé­‚ï¼Œé»˜é»˜é—ªçƒï¼Œç»™äººå¸¦æ¥æ— å°½çš„éæƒ³ï¼Œå……æ»¡æ´»åŠ›ä¸ç”Ÿæœºã€‚\né»‘è‰²ç«ç‘°çš„å­˜åœ¨ï¼Œä¸ä»…æŒ‘æˆ˜äº†æˆ‘ä»¬å¯¹äºç«ç‘°ä¼ ç»Ÿé¢œè‰²çš„è®¤çŸ¥ï¼Œå®ƒæ›´æ˜¯ä¸€ç§ç”ŸåŠ¨çš„ç”Ÿå‘½è±¡å¾ï¼Œè±¡å¾ç€é‚£äº›åšéŸ§ã€ç‹¬ç‰¹ã€å‹‡æ•¢é¢å¯¹ç”Ÿæ´»çš„äººä»¬ã€‚é»‘è‰²çš„èŠ±ç“£ä¸­é€éœ²å‡ºä¸€ç§åšéŸ§çš„åŠ›é‡ï¼Œè€Œé‡‘é»„çš„èŠ±è•Šåˆ™æ˜¯ç”Ÿæ´»ä¸­çš„å¸Œæœ›ï¼ŒäºŒè€…çš„ç»“åˆæ°å¥½è±¡å¾äº†ç”Ÿæ´»ä¸­çš„å–œæ€’å“€ä¹ï¼Œä½“ç°äº†äººç”Ÿçš„ç™¾æ€ã€‚'}\n</code></pre><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±é€šè¿‡ä¸¤ä¸ªLLMé“¾å’Œä¸€ä¸ªé¡ºåºé“¾ï¼Œç”Ÿæˆäº†ä¸€ç¯‡å®Œç¾çš„æ–‡æ¡ˆã€‚</p><h2>æ€»ç»“æ—¶åˆ»</h2><p>LangChainä¸ºæˆ‘ä»¬æä¾›äº†å¥½ç”¨çš„â€œé“¾â€ï¼Œå¸®åŠ©æˆ‘ä»¬æŠŠå¤šä¸ªç»„ä»¶åƒé“¾æ¡ä¸€æ ·è¿æ¥èµ·æ¥ã€‚è¿™ä¸ªâ€œé“¾æ¡â€å…¶å®å°±æ˜¯ä¸€ç³»åˆ—ç»„ä»¶çš„è°ƒç”¨é¡ºåºï¼Œè¿™ä¸ªé¡ºåºé‡Œè¿˜å¯ä»¥åŒ…æ‹¬å…¶ä»–çš„â€œé“¾æ¡â€ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šç§æ–¹æ³•è°ƒç”¨é“¾ï¼Œä¹Ÿå¯ä»¥æ ¹æ®å¼€å‘æ—¶çš„éœ€æ±‚é€‰æ‹©å„ç§ä¸åŒçš„é“¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/5f/38/5fe2366c3e8294a61cb44d33b9d79638.png?wh=1741x1327\" alt=\"\"></p><p>é™¤å»æœ€å¸¸è§çš„LLMChainå’ŒSequenceChainä¹‹å¤–ï¼ŒLangChainä¸­è¿˜è‡ªå¸¦å¤§é‡å…¶ä»–ç±»å‹çš„é“¾ï¼Œå°è£…äº†å„ç§å„æ ·çš„åŠŸèƒ½ã€‚ä½ å¯ä»¥çœ‹ä¸€çœ‹è¿™äº›é“¾çš„å®ç°ç»†èŠ‚ï¼Œå¹¶å°è¯•ç€ä½¿ç”¨å®ƒä»¬ã€‚</p><p>ä¸‹ä¸€èŠ‚è¯¾ï¼Œæˆ‘ä»¬ä¼šç»§ç»­ä»‹ç»å¦å¤–ä¸€ç§å¥½ç”¨çš„é“¾ï¼ŒRouterChainã€‚</p><h2>æ€è€ƒé¢˜</h2><ol>\n<li>åœ¨<a href=\"https://time.geekbang.org/column/article/699451\">ç¬¬3è¯¾</a>ä¸­ï¼Œæˆ‘ä»¬æ›¾ç»ç”¨æç¤ºæ¨¡æ¿ç”Ÿæˆè¿‡ä¸€æ®µé²œèŠ±çš„æè¿°ï¼Œä»£ç å¦‚ä¸‹ï¼š</li>\n</ol><pre><code class=\"language-plain\">for flower, price in zip(flowers, prices):\n&nbsp; &nbsp; # æ ¹æ®æç¤ºå‡†å¤‡æ¨¡å‹çš„è¾“å…¥\n&nbsp; &nbsp; input = prompt.format(flower_name=flower, price=price)\n&nbsp; &nbsp; # è·å–æ¨¡å‹çš„è¾“å‡º\n&nbsp; &nbsp; output = model(input)&nbsp; &nbsp; \n&nbsp; &nbsp; # è§£ææ¨¡å‹çš„è¾“å‡º\n&nbsp; &nbsp; parsed_output = output_parser.parse(output)\n</code></pre><p>è¯·ä½ ä½¿ç”¨LLMChainé‡æ„æç¤ºçš„formatå’Œè·å–æ¨¡å‹è¾“å‡ºéƒ¨åˆ†ï¼Œå®Œæˆç›¸åŒçš„åŠŸèƒ½ã€‚</p><p><span class=\"orange\">æç¤ºï¼š</span></p><pre><code class=\"language-plain\">&nbsp; &nbsp; llm_chain = LLMChain(\n&nbsp; &nbsp; &nbsp; &nbsp; llm=model,\n&nbsp; &nbsp; &nbsp; &nbsp; prompt=prompt)\n</code></pre><ol start=\"2\">\n<li>ä¸Šä¸€é“é¢˜ç›®ä¸­ï¼Œæˆ‘è¦æ±‚ä½ æŠŠæç¤ºçš„formatå’Œè·å–æ¨¡å‹è¾“å‡ºéƒ¨åˆ†æ•´åˆåˆ°LLMChainä¸­ï¼Œå…¶å®ä½ è¿˜å¯ä»¥æ›´è¿›ä¸€æ­¥ï¼ŒæŠŠoutput_parserä¹Ÿæ•´åˆåˆ°LLMChainä¸­ï¼Œè®©ç¨‹åºç»“æ„è¿›ä¸€æ­¥ç®€åŒ–ï¼Œè¯·ä½ å°è¯•ä¸€ä¸‹ã€‚</li>\n</ol><p><span class=\"orange\">æç¤ºï¼š</span></p><pre><code class=\"language-plain\">&nbsp; &nbsp; llm_chain = LLMChain(\n&nbsp; &nbsp; &nbsp; &nbsp; llm=model,\n&nbsp; &nbsp; &nbsp; &nbsp; prompt=prompt,\n&nbsp; &nbsp; &nbsp; &nbsp; output_parser=output_parser)\n</code></pre><ol start=\"3\">\n<li>é€‰æ‹©ä¸€ä¸ªLangChainä¸­çš„é“¾ï¼ˆæˆ‘ä»¬æ²¡ç”¨åˆ°çš„ç±»å‹ï¼‰ï¼Œå°è¯•ä½¿ç”¨å®ƒè§£å†³ä¸€ä¸ªé—®é¢˜ï¼Œå¹¶åˆ†äº«ä½ çš„ç”¨ä¾‹å’Œä»£ç ã€‚</li>\n</ol><p>é¢˜ç›®è¾ƒå¤šï¼Œå¯ä»¥é€‰æ‹©æ€§æ€è€ƒï¼ŒæœŸå¾…åœ¨ç•™è¨€åŒºçœ‹åˆ°ä½ çš„åˆ†äº«ã€‚å¦‚æœä½ è§‰å¾—å†…å®¹å¯¹ä½ æœ‰å¸®åŠ©ï¼Œä¹Ÿæ¬¢è¿åˆ†äº«ç»™æœ‰éœ€è¦çš„æœ‹å‹ï¼æœ€åå¦‚æœä½ å­¦æœ‰ä½™åŠ›ï¼Œå¯ä»¥è¿›ä¸€æ­¥å­¦ä¹ ä¸‹é¢çš„å»¶ä¼¸é˜…è¯»ã€‚</p><h2>å»¶ä¼¸é˜…è¯»</h2><ol>\n<li>GitHubä¸Šå„ç§å„æ ·çš„<a href=\"https://github.com/langchain-ai/langchain/tree/master/libs/langchain/langchain/chains\">é“¾</a></li>\n<li>ä»£ç ï¼Œ<a href=\"https://github.com/langchain-ai/langchain/blob/master/libs/langchain/langchain/chains/llm.py\">LLMChain</a> çš„å®ç°ç»†èŠ‚</li>\n</ol>","comments":[{"had_liked":false,"id":381504,"user_name":"åœ¨è·¯ä¸Š","can_delete":false,"product_type":"c1","uid":1402511,"ip_address":"å¹¿ä¸œ","ucode":"6E31908EFE1107","user_header":"https://static001.geekbang.org/account/avatar/00/15/66/8f/02be926d.jpg","comment_is_top":false,"comment_ctime":1695299465,"is_pvip":false,"replies":[{"id":138982,"content":"éå¸¸æ£’çš„æ€è€ƒ!!! ä¹Ÿæ€»ç»“çš„å¾ˆç²¾è¾Ÿï¼\nMemory - è®©å¯¹è¯æ‹¥æœ‰äº†çŠ¶æ€\nSequentialChain - å¯ä»¥ç»„åˆä¸€ç³»åˆ—çš„é“¾\nCallback - æä¾›äº†å›è°ƒæœºåˆ¶ï¼Œå¯ä»¥ç”ŸæˆLog","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1809833,"ctime":1695400067,"ip_address":"æ–°åŠ å¡","comment_id":381504,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"Chainæœ‰ä¸‰ä¸ªèƒ½åŠ›ï¼Œæœ‰çŠ¶æ€ï¼Œå¯è§‚æµ‹ï¼Œå¯ç»„åˆã€‚\næœ‰çŠ¶æ€ï¼šChainç±»å®šä¹‰äº†memory: Optional[BaseMemory]æˆå‘˜å˜é‡ï¼Œè®°å½•äº†chainæ‰§è¡Œè¿‡ç¨‹çš„çŠ¶æ€ã€‚è°ƒç”¨chain._call(inputs)å¯å¾—åˆ°è¾“å‡ºå¯¹è±¡outputsï¼Œä¹‹åä¼šè°ƒç”¨chain.prep_outputs(inputs, outputs)åŠ è¾“å…¥å’Œè¾“å‡ºå¯¹è±¡æˆå¯¹æ”¾å…¥memoryå¯¹è±¡ã€‚\nå¯è§‚æµ‹ï¼šChainç±»å®šä¹‰äº†callbacks: Callbacksæˆå‘˜å˜é‡ï¼Œåœ¨chainæ‰§è¡Œè¿‡ç¨‹ä¸­å›è°ƒon_xxx()æ–¹æ³•ã€‚\nå¯ç»„åˆï¼šæ¯”å¦‚SequentialChainç±»å®šä¹‰äº†chains: List[Chain]æˆå‘˜å˜é‡ï¼Œä¼šéå†chainsåˆ—è¡¨è°ƒç”¨ï¼Œå°†åˆå§‹è¾“å…¥inputså’Œå·²è°ƒç”¨çš„chainçš„outputsåˆå¹¶åˆ°ä¸€ä¸ªå­—å…¸ï¼Œä½œä¸ºå½“å‰chainçš„inputsï¼Œå…·ä½“å¯é˜…è¯»SequentialChain._call()ã€‚","like_count":9,"discussions":[{"author":{"id":1809833,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/a9/4602808f.jpg","nickname":"é»„ä½³","note":"","ucode":"8EC41D2EAB0E3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":628517,"discussion_content":"éå¸¸æ£’çš„æ€è€ƒ!!! ä¹Ÿæ€»ç»“çš„å¾ˆç²¾è¾Ÿï¼\nMemory - è®©å¯¹è¯æ‹¥æœ‰äº†çŠ¶æ€\nSequentialChain - å¯ä»¥ç»„åˆä¸€ç³»åˆ—çš„é“¾\nCallback - æä¾›äº†å›è°ƒæœºåˆ¶ï¼Œå¯ä»¥ç”ŸæˆLog","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1695400067,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ–°åŠ å¡","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":381953,"user_name":"Nikola","can_delete":false,"product_type":"c1","uid":1536844,"ip_address":"ä¸Šæµ·","ucode":"DB18756EBE7032","user_header":"https://static001.geekbang.org/account/avatar/00/17/73/4c/f743ac7c.jpg","comment_is_top":false,"comment_ctime":1696315610,"is_pvip":false,"replies":[{"id":139185,"content":"å½“ç„¶å¯ä»¥é€šè¿‡æ€ç»´é“¾å®ç°ã€‚ä¸ç®¡é»‘çŒ«ç™½çŒ«ï¼Œèƒ½å¤Ÿæ¿€å‘LLMçš„æ€è€ƒï¼Œè®©LLMå®Œæˆä½ çš„éœ€æ±‚å°±æ˜¯å¥½çŒ«ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1809833,"ctime":1696691364,"ip_address":"ç‘å£«","comment_id":381953,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"ä¸Šé¢çš„ä¾‹å­æ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥ç”¨æ€ç»´é“¾æ¥å®ç°ï¼Ÿè¿™æ ·å¯ä»¥åªè°ƒç”¨ä¸€æ¬¡æ¨¡å‹ã€‚\næ€ç»´é“¾å’ŒlangChainçš„chainç»„ä»¶çš„ä½¿ç”¨åœºæ™¯ä¸Šæœ‰åŒºåˆ«ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1809833,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/a9/4602808f.jpg","nickname":"é»„ä½³","note":"","ucode":"8EC41D2EAB0E3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":629127,"discussion_content":"å½“ç„¶å¯ä»¥é€šè¿‡æ€ç»´é“¾å®ç°ã€‚ä¸ç®¡é»‘çŒ«ç™½çŒ«ï¼Œèƒ½å¤Ÿæ¿€å‘LLMçš„æ€è€ƒï¼Œè®©LLMå®Œæˆä½ çš„éœ€æ±‚å°±æ˜¯å¥½çŒ«ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1696691364,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ç‘å£«","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":381502,"user_name":"åœ¨è·¯ä¸Š","can_delete":false,"product_type":"c1","uid":1402511,"ip_address":"å¹¿ä¸œ","ucode":"6E31908EFE1107","user_header":"https://static001.geekbang.org/account/avatar/00/15/66/8f/02be926d.jpg","comment_is_top":false,"comment_ctime":1695298479,"is_pvip":false,"replies":[{"id":138983,"content":"ğŸˆµ","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1809833,"ctime":1695400133,"ip_address":"æ–°åŠ å¡","comment_id":381502,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"# -*- coding: utf-8 -*-\nimport os\n\n# è®¾ç½®ç½‘ç»œä»£ç†\nos.environ[&quot;http_proxy&quot;] = &quot;http:&#47;&#47;127.0.0.1:7890&quot;\nos.environ[&quot;https_proxy&quot;] = &quot;http:&#47;&#47;127.0.0.1:7890&quot;\n\n# é€šè¿‡.envç®¡ç†api_token\nfrom dotenv import load_dotenv\nload_dotenv()\n\nfrom langchain.llms import OpenAI\nfrom langchain.chains import LLMChain\nfrom langchain.prompts import PromptTemplate\n\nllm = OpenAI(temperature=.7, verbose=True)\n\n# å¯¼å…¥ç»“æ„åŒ–è¾“å‡ºè§£æå™¨å’ŒResponseSchema\nfrom langchain.output_parsers import StructuredOutputParser, ResponseSchema\n# å®šä¹‰æˆ‘ä»¬æƒ³è¦æ¥æ”¶çš„å“åº”æ¨¡å¼\nresponse_schemas = [\n    ResponseSchema(name=&quot;description&quot;, description=&quot;é²œèŠ±çš„æè¿°æ–‡æ¡ˆ&quot;),\n    ResponseSchema(name=&quot;reason&quot;, description=&quot;é—®ä»€ä¹ˆè¦è¿™æ ·å†™è¿™ä¸ªæ–‡æ¡ˆ&quot;)\n]\n# åˆ›å»ºè¾“å‡ºè§£æå™¨\noutput_parser = StructuredOutputParser.from_response_schemas(response_schemas)\nprint(output_parser.get_format_instructions())\n\n# åˆ›å»ºåŸå§‹æç¤ºæ¨¡æ¿\nprompt_template = &quot;&quot;&quot;\næ‚¨æ˜¯ä¸€ä½ä¸“ä¸šçš„é²œèŠ±åº—æ–‡æ¡ˆæ’°å†™å‘˜ã€‚\nå¯¹äºå”®ä»·ä¸º {price} å…ƒçš„ {flower} ï¼Œæ‚¨èƒ½æä¾›ä¸€ä¸ªå¸å¼•äººçš„ç®€çŸ­æè¿°å—ï¼Ÿ\nè¾“å‡ºæ ¼å¼ï¼š\n{format_instructions}\n&quot;&quot;&quot;\nprompt = PromptTemplate(\n    template=prompt_template,\n    input_variables=[&quot;flower&quot;, &quot;price&quot;],\n    partial_variables={&quot;format_instructions&quot;: output_parser.get_format_instructions()},\n    output_parser=output_parser)\n\nchain = LLMChain(llm=llm, prompt=prompt)\n\n# æ•°æ®å‡†å¤‡\nflowers = [&quot;ç«ç‘°&quot;, &quot;ç™¾åˆ&quot;, &quot;åº·ä¹ƒé¦¨&quot;]\nprices = [&quot;50&quot;, &quot;30&quot;, &quot;20&quot;]\n\nfor flower, price in zip(flowers, prices):\n    result = chain.run({\n        &quot;flower&quot;: flower,\n        &quot;price&quot;: price\n    })\n    print(result)\n","like_count":2,"discussions":[{"author":{"id":1809833,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/a9/4602808f.jpg","nickname":"é»„ä½³","note":"","ucode":"8EC41D2EAB0E3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":628518,"discussion_content":"ğŸˆµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1695400133,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ–°åŠ å¡","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1472739,"avatar":"https://static001.geekbang.org/account/avatar/00/16/78/e3/f5305ed0.jpg","nickname":"è¶…è¶…","note":"","ucode":"9F8F7E78788A12","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":640133,"discussion_content":"input_list = [{&#34;flower_name&#34;:flower, &#34;price&#34;:price} for flower, price in zip(flowers, prices)]\nresult = llm_chain.apply(input_list)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1711196002,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383726,"user_name":"æ‚Ÿå°˜","can_delete":false,"product_type":"c1","uid":2189310,"ip_address":"åŒ—äº¬","ucode":"4E7E854340D3A4","user_header":"https://static001.geekbang.org/account/avatar/00/21/67/fe/5d17661a.jpg","comment_is_top":false,"comment_ctime":1699520304,"is_pvip":false,"replies":[{"id":140194,"content":"å› ä¸ºLangChainè§‰å¾—ä»¥åå®ƒä¸æƒ³ä»æ ¹ç›®å½•ç›´æ¥æ”¯æŒå†…éƒ¨æ¨¡å—çš„å¯¼å…¥äº†ï¼","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1809833,"ctime":1700583149,"ip_address":"ç‘å£«","comment_id":383726,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"from langchain import PromptTemplate, OpenAI, LLMChain \nè¿™è¡Œä»£ç ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰warningå‘¢ï¼Ÿ\næ¢æˆä¸‹é¢çš„importåï¼Œå°±æ²¡æœ‰å‘Šè­¦äº†\nfrom langchain.prompts import PromptTemplate\nfrom langchain.llms import OpenAI\nfrom langchain.chains import LLMChain\n","like_count":0,"discussions":[{"author":{"id":1809833,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/a9/4602808f.jpg","nickname":"é»„ä½³","note":"","ucode":"8EC41D2EAB0E3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":632243,"discussion_content":"å› ä¸ºLangChainè§‰å¾—ä»¥åå®ƒä¸æƒ³ä»æ ¹ç›®å½•ç›´æ¥æ”¯æŒå†…éƒ¨æ¨¡å—çš„å¯¼å…¥äº†ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1700583149,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ç‘å£«","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1233947,"avatar":"https://static001.geekbang.org/account/avatar/00/12/d4/1b/6444e933.jpg","nickname":"Liberalism","note":"","ucode":"BD0A293B928668","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631612,"discussion_content":"å› ä¸º Langchian ç‰ˆæœ¬æ›´æ–°ï¼Œåç»­ä¸å†æ”¯æŒä¸Šé¢çš„è°ƒç”¨æ–¹å¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1699844288,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":382512,"user_name":"ä¸€é¢æ¹–æ°´","can_delete":false,"product_type":"c1","uid":1193473,"ip_address":"å››å·","ucode":"6339F033312FB2","user_header":"https://static001.geekbang.org/account/avatar/00/12/36/01/eb3ba274.jpg","comment_is_top":false,"comment_ctime":1697507344,"is_pvip":false,"replies":[{"id":139340,"content":"å…·ä½“æ˜¯å“ªä¸ªç¨‹åºå•Šï¼Ÿæœ‰æ²¡æœ‰å…·ä½“ä»£ç ï¼Ÿæœ‰å‡ ä¸ªå¯èƒ½çš„åŸå› :\n1. ç”Ÿæˆçš„æ–‡æœ¬è¶…è¿‡äº†å­—ç¬¦é™åˆ¶,è¢«å¼ºåˆ¶æˆªæ–­ã€‚å¯ä»¥å°è¯•å¢åŠ å­—ç¬¦é™åˆ¶ã€‚max_tokens --- è¿™ä¸ªæ˜¯OpenAI APIæœ€å¤§Tokenæ•°é™åˆ¶çš„å‚æ•°ã€‚\n2. æˆ–è€…æ˜¯è¾“å‡ºè§£æå™¨é…ç½®é”™è¯¯,æˆªæ–­äº†å†…å®¹ã€‚å¯ä»¥æ£€æŸ¥è¾“å‡ºè§£æå™¨çš„å®ç°ã€‚\n3. å¯ä»¥åœ¨æç¤ºè¯­é‡Œé¢è¦æ±‚æ¨¡å‹è¯´è¯ç®€çŸ­ä¸€ç‚¹ç‚¹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1809833,"ctime":1697617460,"ip_address":"ç‘å£«","comment_id":382512,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"ä¸ºä»€ä¹ˆç”Ÿæˆçš„æ–‡æ¡ˆä¸å®Œæ•´å‘¢ï¼Ÿçœ‹èµ·æ¥æ˜¯è¢«æˆªæ–­äº†ã€‚","like_count":0,"discussions":[{"author":{"id":1809833,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/a9/4602808f.jpg","nickname":"é»„ä½³","note":"","ucode":"8EC41D2EAB0E3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":629771,"discussion_content":"å…·ä½“æ˜¯å“ªä¸ªç¨‹åºå•Šï¼Ÿæœ‰æ²¡æœ‰å…·ä½“ä»£ç ï¼Ÿæœ‰å‡ ä¸ªå¯èƒ½çš„åŸå› :\n1. ç”Ÿæˆçš„æ–‡æœ¬è¶…è¿‡äº†å­—ç¬¦é™åˆ¶,è¢«å¼ºåˆ¶æˆªæ–­ã€‚å¯ä»¥å°è¯•å¢åŠ å­—ç¬¦é™åˆ¶ã€‚max_tokens --- è¿™ä¸ªæ˜¯OpenAI APIæœ€å¤§Tokenæ•°é™åˆ¶çš„å‚æ•°ã€‚\n2. æˆ–è€…æ˜¯è¾“å‡ºè§£æå™¨é…ç½®é”™è¯¯,æˆªæ–­äº†å†…å®¹ã€‚å¯ä»¥æ£€æŸ¥è¾“å‡ºè§£æå™¨çš„å®ç°ã€‚\n3. å¯ä»¥åœ¨æç¤ºè¯­é‡Œé¢è¦æ±‚æ¨¡å‹è¯´è¯ç®€çŸ­ä¸€ç‚¹ç‚¹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1697617461,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ç‘å£«","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":381488,"user_name":"èµ¤è‰²é—ªç”µ","can_delete":false,"product_type":"c1","uid":1144765,"ip_address":"åŒ—äº¬","ucode":"B5FAA29E62132C","user_header":"https://static001.geekbang.org/account/avatar/00/11/77/bd/e7ff842c.jpg","comment_is_top":false,"comment_ctime":1695278071,"is_pvip":true,"replies":[{"id":138972,"content":"å¥½çš„ï¼ŒåŒå­¦ã€‚è°¢è°¢ä½ æå‡ºçš„é—®é¢˜ï¼Œç›®å‰ä»£ç ä¸­ï¼Œç»è¿‡äº†ä¸‰è½®LLMçš„æ„å»ºï¼Œsocial_post_chainä¹Ÿå·²ç»æ„å»ºå‡ºæ¥äº†ã€‚æœ€åçš„é¡ºåºé“¾æŠŠå®ƒä»¬ä¸²åœ¨ä¸€èµ·è¾“å‡ºã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1809833,"ctime":1695284779,"ip_address":"æ–°åŠ å¡","comment_id":381488,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼åœ¨æ–‡ä¸­æ„é€ é¡ºåºé“¾çš„è¿‡ç¨‹ä¸­ï¼Œchains=[introduction_chain, review_chain, social_post_chain]ä¸­çš„social_post_chainæ˜¯ä»å“ªé‡Œå®šä¹‰çš„ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1809833,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/a9/4602808f.jpg","nickname":"é»„ä½³","note":"","ucode":"8EC41D2EAB0E3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":628430,"discussion_content":"å¥½çš„ï¼ŒåŒå­¦ã€‚è°¢è°¢ä½ æå‡ºçš„é—®é¢˜ï¼Œç›®å‰ä»£ç ä¸­ï¼Œç»è¿‡äº†ä¸‰è½®LLMçš„æ„å»ºï¼Œsocial_post_chainä¹Ÿå·²ç»æ„å»ºå‡ºæ¥äº†ã€‚æœ€åçš„é¡ºåºé“¾æŠŠå®ƒä»¬ä¸²åœ¨ä¸€èµ·è¾“å‡ºã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1695284779,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ–°åŠ å¡","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1144765,"avatar":"https://static001.geekbang.org/account/avatar/00/11/77/bd/e7ff842c.jpg","nickname":"èµ¤è‰²é—ªç”µ","note":"","ucode":"B5FAA29E62132C","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1809833,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/a9/4602808f.jpg","nickname":"é»„ä½³","note":"","ucode":"8EC41D2EAB0E3C","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":628432,"discussion_content":"åœ¨æ–‡ç« ä¸­ç°åœ¨å·²ç»å¯ä»¥çœ‹åˆ°äº†ï¼Œæ„Ÿè°¢è€å¸ˆçš„å›å¤ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1695286502,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":628430,"ip_address":"åŒ—äº¬","group_id":0},"score":628432,"extra":""}]}]},{"had_liked":false,"id":381469,"user_name":".ã€‚ã€‚ã€‚","can_delete":false,"product_type":"c1","uid":1800836,"ip_address":"é™•è¥¿","ucode":"C51083CF9A4CD1","user_header":"https://static001.geekbang.org/account/avatar/00/1b/7a/84/fe247aff.jpg","comment_is_top":false,"comment_ctime":1695258026,"is_pvip":false,"replies":[{"id":138949,"content":"å½“ä½ å¾—åˆ°äº†æ¨¡å‹çš„è¿”å›ç»“æœä¹‹åï¼Œæ¨¡å‹å°±è‡ªåŠ¨åœæ­¢äº†ï¼Œè¿™å¥½åƒSaaSä¸€æ ·ã€‚æ¨¡å‹ç»™ä½ æä¾›çš„æ˜¯äº‘ç«¯æœåŠ¡ã€‚æœ¬åœ°æ¨¡å‹ä¹Ÿæ˜¯ä¸€æ ·ã€‚éšç€ä½ çš„è°ƒç”¨ç»“æŸï¼Œæ¨¡å‹å°±ä¸å†ä¸€ç›´å€¾å¬ä½ äº†ï¼Œå› æ­¤ï¼Œæ¨¡å‹è‡ªå·±æ²¡æœ‰Memoryï¼å®ƒä¸æ˜¯ä¸€ä¸ªä¸€ç›´ä¾¦å¬å“åº”çš„è¿›ç¨‹ï¼Œæ²¡æœ‰çŠ¶æ€ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆï¼Œæˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºè®¾è®¡çš„æ—¶å€™ï¼Œè¦å¢åŠ Memoryè¿™ä¸ªå†…å®¹ï¼Œä½ å¯ä»¥æŠŠMemoryè§†ä¸ºè®°å¿†æˆ–è€…å†…å­˜ã€‚\nå¯¹äºæ¨¡å‹è°ƒç”¨æ¥è¯´ï¼Œå®ƒåœ¨ä¹çš„æ˜¯ä½ ä¸€æ¬¡Passç»™ä»–å¤šå°‘ä¸ªTokenï¼Œä»¥åŠä½ ä¸€åˆ†é’Ÿè°ƒç”¨å®ƒå¤šå°‘æ¬¡ã€‚å¤ªå¤šTokenä¸è¡Œï¼Œè¿‡å¤šæ¬¡ä¹Ÿä¸è¡Œã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1809833,"ctime":1695268513,"ip_address":"æ–°åŠ å¡","comment_id":381469,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼å­¦ä¹ äº†langchainåï¼Œå®ç°äº†å’±ä»¬è¯¾ç¨‹ä¸­è®²çš„case,ä½†æ˜¯æœ‰ä¸ªç–‘é—®è¯·å‡ä¸‹ï¼Œé€šè¿‡langchainæ¡†æ¶è°ƒç”¨çš„æ¨¡å‹ï¼Œå¦‚ä½•å¯¹æ­£åœ¨è¿è¡Œçš„æ¨¡å‹è¿›è¡Œåœæ­¢å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1809833,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/a9/4602808f.jpg","nickname":"é»„ä½³","note":"","ucode":"8EC41D2EAB0E3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":628383,"discussion_content":"å½“ä½ å¾—åˆ°äº†æ¨¡å‹çš„è¿”å›ç»“æœä¹‹åï¼Œæ¨¡å‹å°±è‡ªåŠ¨åœæ­¢äº†ï¼Œè¿™å¥½åƒSaaSä¸€æ ·ã€‚æ¨¡å‹ç»™ä½ æä¾›çš„æ˜¯äº‘ç«¯æœåŠ¡ã€‚æœ¬åœ°æ¨¡å‹ä¹Ÿæ˜¯ä¸€æ ·ã€‚éšç€ä½ çš„è°ƒç”¨ç»“æŸï¼Œæ¨¡å‹å°±ä¸å†ä¸€ç›´å€¾å¬ä½ äº†ï¼Œå› æ­¤ï¼Œæ¨¡å‹è‡ªå·±æ²¡æœ‰Memoryï¼å®ƒä¸æ˜¯ä¸€ä¸ªä¸€ç›´ä¾¦å¬å“åº”çš„è¿›ç¨‹ï¼Œæ²¡æœ‰çŠ¶æ€ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆï¼Œæˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºè®¾è®¡çš„æ—¶å€™ï¼Œè¦å¢åŠ Memoryè¿™ä¸ªå†…å®¹ï¼Œä½ å¯ä»¥æŠŠMemoryè§†ä¸ºè®°å¿†æˆ–è€…å†…å­˜ã€‚\nå¯¹äºæ¨¡å‹è°ƒç”¨æ¥è¯´ï¼Œå®ƒåœ¨ä¹çš„æ˜¯ä½ ä¸€æ¬¡Passç»™ä»–å¤šå°‘ä¸ªTokenï¼Œä»¥åŠä½ ä¸€åˆ†é’Ÿè°ƒç”¨å®ƒå¤šå°‘æ¬¡ã€‚å¤ªå¤šTokenä¸è¡Œï¼Œè¿‡å¤šæ¬¡ä¹Ÿä¸è¡Œã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1695268513,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ–°åŠ å¡","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":381478,"user_name":"å†¬é’","can_delete":false,"product_type":"c1","uid":1356014,"ip_address":"åŒ—äº¬","ucode":"14576781B499FB","user_header":"https://static001.geekbang.org/account/avatar/00/14/b0/ee/7409a0d3.jpg","comment_is_top":false,"comment_ctime":1695262547,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"ä»Šæ—¥åŠ æ›´ï¼Œå¿«å†²å¿«å†²ï¼ï¼ï¼","like_count":2},{"had_liked":false,"id":392898,"user_name":"yanyu-xin","can_delete":false,"product_type":"c1","uid":1899757,"ip_address":"å¹¿ä¸œ","ucode":"3AA389F9E4C236","user_header":"","comment_is_top":false,"comment_ctime":1722091189,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"# å¯¼å…¥LangChain\nfrom langchain import LLMChain \n# å¯¼å…¥LangChainä¸­çš„æç¤ºæ¨¡æ¿\nfrom langchain import PromptTemplate\n# åˆ›å»ºåŸå§‹æ¨¡æ¿\ntemplate = &quot;&quot;&quot;æ‚¨æ˜¯ä¸€ä½ä¸“ä¸šçš„é²œèŠ±åº—æ–‡æ¡ˆæ’°å†™å‘˜ã€‚\\n\nå¯¹äºå”®ä»·ä¸º {price} å…ƒçš„ {flower} ï¼Œæ‚¨èƒ½æä¾›ä¸€ä¸ªå¸å¼•äººçš„ç®€çŸ­æè¿°å—ï¼Ÿ\\n\n            \nè¯·ä»¥JSONæ ¼å¼è¿”å›ï¼ŒåŒ…å«ä»¥ä¸‹å­—æ®µï¼š\\n\n- flower_type: é²œèŠ±çš„ç§ç±»\n- price: é²œèŠ±çš„ä»·æ ¼\n- description: é²œèŠ±çš„æè¿°æ–‡æ¡ˆ\n- reason: ä¸ºä»€ä¹ˆè¦è¿™æ ·å†™è¿™ä¸ªæ–‡æ¡ˆ\n&quot;&quot;&quot;\n# æ ¹æ®åŸå§‹æ¨¡æ¿åˆ›å»ºLangChainæç¤ºæ¨¡æ¿\nprompt = PromptTemplate.from_template(template)\n\n# å®šä¹‰æˆ‘ä»¬æƒ³è¦æ¥æ”¶çš„æ•°æ®æ ¼å¼\nfrom pydantic import BaseModel, Field\nclass FlowerDescription(BaseModel):    \n    flower_type: str = Field(description=&quot;é²œèŠ±çš„ç§ç±»&quot;)    \n    price: int = Field(description=&quot;é²œèŠ±çš„ä»·æ ¼&quot;)    \n    description: str = Field(description=&quot;é²œèŠ±çš„æè¿°æ–‡æ¡ˆ&quot;)    \n    reason: str = Field(description=&quot;ä¸ºä»€ä¹ˆè¦è¿™æ ·å†™è¿™ä¸ªæ–‡æ¡ˆ&quot;)\n\n\n# åˆ›å»ºè¾“å‡ºè§£æå™¨\nfrom langchain.output_parsers import PydanticOutputParser\noutput_parser = PydanticOutputParser(pydantic_object=FlowerDescription)\n\n\n# ç”¨é˜¿é‡Œäº‘çš„å¤§è¯­è¨€æ¨¡å‹\nfrom langchain_community.llms import Tongyi\n# ç›´æ¥åœ¨ä»£ç ä¸­è®¾ç½®APIå¯†é’¥\nDASHSCOPE_API_KEY = &quot;XXX&quot; # è¯·æ›¿æ¢ä¸ºæ‚¨çš„é˜¿é‡Œäº‘é€šä¹‰åƒé—®æ¨¡å‹APIå¯†é’¥\nllm = Tongyi(dashscope_api_key=DASHSCOPE_API_KEY)\n\n# applyå…è®¸æ‚¨é’ˆå¯¹è¾“å…¥åˆ—è¡¨è¿è¡Œé“¾\ninput_list = [\n    {&quot;flower&quot;: &quot;ç«ç‘°&quot;,&#39;price&#39;: &quot;50&quot;},\n    {&quot;flower&quot;: &quot;ç™¾åˆ&quot;,&#39;price&#39;: &quot;30&quot;},\n    {&quot;flower&quot;: &quot;éƒé‡‘é¦™&quot;,&#39;price&#39;: &quot;20&quot;}\n]\nllm_chain = LLMChain( # åˆ›å»ºé“¾\n    llm=llm, \n    prompt=prompt,\n    output_parser=output_parser) \nresult = llm_chain.apply(input_list)      # è¿è¡Œé“¾\nprint(result)","like_count":1},{"had_liked":false,"id":392400,"user_name":"eagle","can_delete":false,"product_type":"c1","uid":1129632,"ip_address":"æ±Ÿè‹","ucode":"D7601A2AFC1D17","user_header":"https://static001.geekbang.org/account/avatar/00/11/3c/a0/8b9d5aca.jpg","comment_is_top":false,"comment_ctime":1720800233,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100617601,"comment_content":"LangChainDeprecationWarning: The class `LLMChain` was deprecated in LangChain 0.1.17 and will be removed in 0.3.0. Use RunnableSequence, e.g., `prompt | llm` instead.","like_count":1,"discussions":[{"author":{"id":3692736,"avatar":"https://static001.geekbang.org/account/avatar/00/38/58/c0/d1d488b0.jpg","nickname":"chenyang","note":"","ucode":"3E56A8A605C619","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":648039,"discussion_content":"from langchain_openai import ChatOpenAI\nfrom langchain_core.prompts import PromptTemplate\n# åŸå§‹å­—ç¬¦ä¸²æ¨¡æ¿\ntemplate = &#34;{flower}çš„èŠ±è¯­æ˜¯?&#34;\n# åˆ›å»ºæ¨¡å‹å®ä¾‹\nllm = ChatOpenAI(temperature=0)\n# åˆ›å»ºLLMChain\nprompt=PromptTemplate.from_template(template)\n\nllm_chain = prompt | llm\n# è°ƒç”¨LLMChainï¼Œè¿”å›ç»“æœ\nresult = llm_chain.invoke(&#34;ç«ç‘°&#34;)\nprint(result)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1720967833,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":394371,"user_name":"åˆ˜åŒè£","can_delete":false,"product_type":"c1","uid":3870283,"ip_address":"åŒ—äº¬","ucode":"FB42C207F24A18","user_header":"https://static001.geekbang.org/account/avatar/00/3b/0e/4b/ff4a21de.jpg","comment_is_top":false,"comment_ctime":1726650606,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100617601,"comment_content":"å¤šä¸ªæç¤ºé“¾å®Œæˆå®Œæ•´çš„ä¸šåŠ¡ç”Ÿæˆ","like_count":0},{"had_liked":false,"id":392416,"user_name":"å¼ ç”³å‚²","can_delete":false,"product_type":"c1","uid":1182372,"ip_address":"åŒ—äº¬","ucode":"22D46BC529BA8A","user_header":"https://static001.geekbang.org/account/avatar/00/12/0a/a4/828a431f.jpg","comment_is_top":false,"comment_ctime":1720859711,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":2,"score":3,"product_id":100617601,"comment_content":"ç¬¬8è®²æ‰“å¡~","like_count":0},{"had_liked":false,"id":388282,"user_name":"é»æ¥šè±","can_delete":false,"product_type":"c1","uid":3730534,"ip_address":"æ³°å›½","ucode":"58455B73AD7297","user_header":"","comment_is_top":false,"comment_ctime":1709796789,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100617601,"comment_content":"ä¸ºä»€ä¹ˆæˆ‘çš„resultä¼šæŠŠæ‰€æœ‰çš„promptéƒ½æ‹¼æ¥åœ¨ä¸€èµ·ï¼Ÿæœ‰è°é‡åˆ°åŒæ ·çš„æƒ…å†µå—\næˆ‘çš„è¾“å‡ºæ˜¯è¿™æ ·çš„ï¼š\nintroductionï¼š\\nä½ æ˜¯ä¸€ä¸ªæ¤ç‰©å­¦å®¶ï¼Œç»™å®šèŠ±çš„åç§°å’Œç±»å‹ï¼Œä½ éœ€è¦ä¸ºè¿™ç§èŠ±å†™ä¸€ä¸ª100å­—å·¦å³çš„ä»‹ç»ã€‚\\nèŠ±åï¼šç«ç‘°\\né¢œè‰²ï¼šred\\næ¤ç‰©å­¦å®¶ï¼šè¿™æ˜¯å…³äºä¸Šè¿°èŠ±çš„ä»‹ç»ï¼š\\nç«ç‘°æ˜¯ä¸€ç§ç¾ä¸½çš„èŠ±å‰ï¼Œé€šå¸¸è¢«ç§æ¤åœ¨èŠ±å›­æˆ–åº­é™¢ä¸­ã€‚å®ƒä»¬é€šå¸¸æœ‰çº¢è‰²çš„èŠ±æœµï¼Œé€šå¸¸æœ‰äº”åˆ°å…­ç‰‡èŠ±ç“£ã€‚ç«ç‘°èŠ±çš„èŠ±ç“£é€šå¸¸æœ‰äº”åˆ°å…­ç‰‡ï¼Œå®ƒä»¬é€šå¸¸æœ‰çº¢è‰²çš„èŠ±ç²‰ï¼Œè¿™ä½¿å¾—å®ƒä»¬æˆä¸ºä¸€ç§éå¸¸å—æ¬¢è¿çš„èŠ±å‰ã€‚ç«ç‘°èŠ±é€šå¸¸éœ€è¦å……è¶³çš„é˜³å…‰å’Œæ°´åˆ†ï¼Œä»¥ä¿æŒå…¶å¥åº·å’Œç¾ä¸½ã€‚\nreview:\\nä½ æ˜¯ä¸€ä¸ªé²œèŠ±è¯„è®ºå®¶ï¼Œç»™å®šä¸€ç§èŠ±çš„ä»‹ç»ï¼Œä½ éœ€è¦ä¸ºè¿™ç§èŠ±å†™ä¸€ä¸ª200å­—å·¦å³çš„è¯„è®ºã€‚\\né²œèŠ±ä»‹ç»ï¼š\\n\\nä½ æ˜¯ä¸€ä¸ªæ¤ç‰©å­¦å®¶ï¼Œç»™å®šèŠ±çš„åç§°å’Œç±»å‹ï¼Œä½ éœ€è¦ä¸ºè¿™ç§èŠ±å†™ä¸€ä¸ª100å­—å·¦å³çš„ä»‹ç»ã€‚\\nèŠ±åï¼šç«ç‘°\\né¢œè‰²ï¼šred\\næ¤ç‰©å­¦å®¶ï¼šè¿™æ˜¯å…³äºä¸Šè¿°èŠ±çš„ä»‹ç»ï¼š\\nç«ç‘°æ˜¯ä¸€ç§ç¾ä¸½çš„èŠ±å‰ï¼Œé€šå¸¸è¢«ç§æ¤åœ¨èŠ±å›­æˆ–åº­é™¢ä¸­ã€‚å®ƒä»¬é€šå¸¸æœ‰çº¢è‰²çš„èŠ±æœµï¼Œé€šå¸¸æœ‰äº”åˆ°å…­ç‰‡èŠ±ç“£ã€‚ç«ç‘°èŠ±çš„èŠ±ç“£é€šå¸¸æœ‰äº”åˆ°å…­ç‰‡ï¼Œå®ƒä»¬é€šå¸¸æœ‰çº¢è‰²çš„èŠ±ç²‰ï¼Œè¿™ä½¿å¾—å®ƒä»¬æˆä¸ºä¸€ç§éå¸¸å—æ¬¢è¿çš„èŠ±å‰ã€‚ç«ç‘°èŠ±é€šå¸¸éœ€è¦å……è¶³çš„é˜³å…‰å’Œæ°´åˆ†ï¼Œä»¥ä¿æŒå…¶å¥åº·å’Œç¾ä¸½ã€‚\\nèŠ±è¯„äººå¯¹ä¸Šè¿°èŠ±çš„è¯„è®ºï¼š\\nç«ç‘°æ˜¯ä¸€ç§éå¸¸ç¾ä¸½çš„èŠ±å‰ï¼Œå®ƒä»¬é€šå¸¸æœ‰çº¢è‰²çš„èŠ±æœµï¼Œé€šå¸¸æœ‰äº”åˆ°å…­ç‰‡èŠ±ç“£ã€‚ç«ç‘°èŠ±çš„èŠ±ç“£é€šå¸¸æœ‰äº”åˆ°å…­ç‰‡ï¼Œå®ƒä»¬é€šå¸¸æœ‰çº¢è‰²çš„èŠ±ç²‰ï¼Œè¿™ä½¿å¾—å®ƒä»¬æˆä¸ºä¸€ç§éå¸¸å—æ¬¢è¿çš„èŠ±å‰ã€‚ç«ç‘°èŠ±é€šå¸¸éœ€è¦å……è¶³çš„é˜³å…‰å’Œæ°´åˆ†ï¼Œä»¥ä¿æŒå…¶å¥åº·å’Œç¾ä¸½ã€‚\n...\n","like_count":0}]}