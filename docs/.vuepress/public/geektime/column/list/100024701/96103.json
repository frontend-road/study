{"id":96103,"title":"23 | ç‰©ç†å†…å­˜ç®¡ç†ï¼ˆä¸Šï¼‰ï¼šä¼šè®®å®¤ç®¡ç†å‘˜å¦‚ä½•åˆ†é…ä¼šè®®å®¤ï¼Ÿ","content":"<p>å‰ä¸€èŠ‚ï¼Œæˆ‘ä»¬è®²äº†å¦‚ä½•ä»é¡¹ç›®ç»ç†çš„è§’åº¦çœ‹å†…å­˜ï¼Œçœ‹åˆ°çš„æ˜¯è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œè¿™äº›è™šæ‹Ÿçš„åœ°å€ï¼Œæ€»æ˜¯è¦æ˜ å°„åˆ°ç‰©ç†çš„é¡µé¢ã€‚è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬æ¥çœ‹ï¼Œç‰©ç†çš„é¡µé¢æ˜¯å¦‚ä½•ç®¡ç†çš„ã€‚</p><h2>ç‰©ç†å†…å­˜çš„ç»„ç»‡æ–¹å¼</h2><p>å‰é¢å’±ä»¬è®²è™šæ‹Ÿå†…å­˜ï¼Œæ¶‰åŠç‰©ç†å†…å­˜çš„æ˜ å°„çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ€»æ˜¯æŠŠå†…å­˜æƒ³è±¡æˆå®ƒæ˜¯ç”±è¿ç»­çš„ä¸€é¡µä¸€é¡µçš„å—ç»„æˆçš„ã€‚æˆ‘ä»¬å¯ä»¥ä»0å¼€å§‹å¯¹ç‰©ç†é¡µç¼–å·ï¼Œè¿™æ ·æ¯ä¸ªç‰©ç†é¡µéƒ½ä¼šæœ‰ä¸ªé¡µå·ã€‚</p><p>ç”±äºç‰©ç†åœ°å€æ˜¯è¿ç»­çš„ï¼Œé¡µä¹Ÿæ˜¯è¿ç»­çš„ï¼Œæ¯ä¸ªé¡µå¤§å°ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚å› è€Œå¯¹äºä»»ä½•ä¸€ä¸ªåœ°å€ï¼Œåªè¦ç›´æ¥é™¤ä¸€ä¸‹æ¯é¡µçš„å¤§å°ï¼Œå¾ˆå®¹æ˜“ç›´æ¥ç®—å‡ºåœ¨å“ªä¸€é¡µã€‚æ¯ä¸ªé¡µæœ‰ä¸€ä¸ªç»“æ„struct pageè¡¨ç¤ºï¼Œè¿™ä¸ªç»“æ„ä¹Ÿæ˜¯æ”¾åœ¨ä¸€ä¸ªæ•°ç»„é‡Œé¢ï¼Œè¿™æ ·æ ¹æ®é¡µå·ï¼Œå¾ˆå®¹æ˜“é€šè¿‡ä¸‹æ ‡æ‰¾åˆ°ç›¸åº”çš„struct pageç»“æ„ã€‚</p><p>å¦‚æœæ˜¯è¿™æ ·ï¼Œæ•´ä¸ªç‰©ç†å†…å­˜çš„å¸ƒå±€å°±éå¸¸ç®€å•ã€æ˜“ç®¡ç†ï¼Œè¿™å°±æ˜¯æœ€ç»å…¸çš„<strong>å¹³å¦å†…å­˜æ¨¡å‹</strong>ï¼ˆFlat Memory Modelï¼‰ã€‚</p><p>æˆ‘ä»¬è®²x86çš„å·¥ä½œæ¨¡å¼çš„æ—¶å€™ï¼Œè®²è¿‡CPUæ˜¯é€šè¿‡æ€»çº¿å»è®¿é—®å†…å­˜çš„ï¼Œè¿™å°±æ˜¯æœ€ç»å…¸çš„å†…å­˜ä½¿ç”¨æ–¹å¼ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/fa/9b/fa6c2b6166d02ac37637d7da4e4b579b.jpeg?wh=2144*995\" alt=\"\"></p><p>åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼ŒCPUä¹Ÿä¼šæœ‰å¤šä¸ªï¼Œåœ¨æ€»çº¿çš„ä¸€ä¾§ã€‚æ‰€æœ‰çš„å†…å­˜æ¡ç»„æˆä¸€å¤§ç‰‡å†…å­˜ï¼Œåœ¨æ€»çº¿çš„å¦ä¸€ä¾§ï¼Œæ‰€æœ‰çš„CPUè®¿é—®å†…å­˜éƒ½è¦è¿‡æ€»çº¿ï¼Œè€Œä¸”è·ç¦»éƒ½æ˜¯ä¸€æ ·çš„ï¼Œè¿™ç§æ¨¡å¼ç§°ä¸º<strong>SMP</strong>ï¼ˆSymmetric multiprocessingï¼‰ï¼Œå³å¯¹ç§°å¤šå¤„ç†å™¨ã€‚å½“ç„¶ï¼Œå®ƒä¹Ÿæœ‰ä¸€ä¸ªæ˜¾è‘—çš„ç¼ºç‚¹ï¼Œå°±æ˜¯æ€»çº¿ä¼šæˆä¸ºç“¶é¢ˆï¼Œå› ä¸ºæ•°æ®éƒ½è¦èµ°å®ƒã€‚</p><!-- [[[read_end]]] --><p><img src=\"https://static001.geekbang.org/resource/image/8f/49/8f158f58dda94ec04b26200073e15449.jpeg?wh=2726*1193\" alt=\"\"></p><p>ä¸ºäº†æé«˜æ€§èƒ½å’Œå¯æ‰©å±•æ€§ï¼Œåæ¥æœ‰äº†ä¸€ç§æ›´é«˜çº§çš„æ¨¡å¼ï¼Œ<strong>NUMA</strong>ï¼ˆNon-uniform memory accessï¼‰ï¼Œéä¸€è‡´å†…å­˜è®¿é—®ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå†…å­˜ä¸æ˜¯ä¸€æ•´å—ã€‚æ¯ä¸ªCPUéƒ½æœ‰è‡ªå·±çš„æœ¬åœ°å†…å­˜ï¼ŒCPUè®¿é—®æœ¬åœ°å†…å­˜ä¸ç”¨è¿‡æ€»çº¿ï¼Œå› è€Œé€Ÿåº¦è¦å¿«å¾ˆå¤šï¼Œæ¯ä¸ªCPUå’Œå†…å­˜åœ¨ä¸€èµ·ï¼Œç§°ä¸ºä¸€ä¸ªNUMAèŠ‚ç‚¹ã€‚ä½†æ˜¯ï¼Œåœ¨æœ¬åœ°å†…å­˜ä¸è¶³çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªCPUéƒ½å¯ä»¥å»å¦å¤–çš„NUMAèŠ‚ç‚¹ç”³è¯·å†…å­˜ï¼Œè¿™ä¸ªæ—¶å€™è®¿é—®å»¶æ—¶å°±ä¼šæ¯”è¾ƒé•¿ã€‚</p><p>è¿™æ ·ï¼Œå†…å­˜è¢«åˆ†æˆäº†å¤šä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹å†è¢«åˆ†æˆä¸€ä¸ªä¸€ä¸ªçš„é¡µé¢ã€‚ç”±äºé¡µéœ€è¦å…¨å±€å”¯ä¸€å®šä½ï¼Œé¡µè¿˜æ˜¯éœ€è¦æœ‰å…¨å±€å”¯ä¸€çš„é¡µå·çš„ã€‚ä½†æ˜¯ç”±äºç‰©ç†å†…å­˜ä¸æ˜¯è¿èµ·æ¥çš„äº†ï¼Œé¡µå·ä¹Ÿå°±ä¸å†è¿ç»­äº†ã€‚äºæ˜¯å†…å­˜æ¨¡å‹å°±å˜æˆäº†éè¿ç»­å†…å­˜æ¨¡å‹ï¼Œç®¡ç†èµ·æ¥å°±å¤æ‚ä¸€äº›ã€‚</p><p>è¿™é‡Œéœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼ŒNUMAå¾€å¾€æ˜¯éè¿ç»­å†…å­˜æ¨¡å‹ã€‚è€Œéè¿ç»­å†…å­˜æ¨¡å‹ä¸ä¸€å®šå°±æ˜¯NUMAï¼Œæœ‰æ—¶å€™ä¸€å¤§ç‰‡å†…å­˜çš„æƒ…å†µä¸‹ï¼Œä¹Ÿä¼šæœ‰ç‰©ç†å†…å­˜åœ°å€ä¸è¿ç»­çš„æƒ…å†µã€‚</p><p>åæ¥å†…å­˜æŠ€æœ¯ç‰›äº†ï¼Œå¯ä»¥æ”¯æŒçƒ­æ’æ‹”äº†ã€‚è¿™ä¸ªæ—¶å€™ï¼Œä¸è¿ç»­æˆä¸ºå¸¸æ€ï¼Œäºæ˜¯å°±æœ‰äº†ç¨€ç–å†…å­˜æ¨¡å‹ã€‚</p><h3>èŠ‚ç‚¹</h3><p>æˆ‘ä»¬ä¸»è¦è§£æå½“å‰çš„ä¸»æµåœºæ™¯ï¼ŒNUMAæ–¹å¼ã€‚æˆ‘ä»¬é¦–å…ˆè¦èƒ½å¤Ÿè¡¨ç¤ºNUMAèŠ‚ç‚¹çš„æ¦‚å¿µï¼Œäºæ˜¯æœ‰äº†ä¸‹é¢è¿™ä¸ªç»“æ„typedef struct pglist_data pg_data_tï¼Œå®ƒé‡Œé¢æœ‰ä»¥ä¸‹çš„æˆå‘˜å˜é‡ï¼š</p><ul>\n<li>\n<p>æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æœ‰è‡ªå·±çš„IDï¼šnode_idï¼›</p>\n</li>\n<li>\n<p>node_mem_mapå°±æ˜¯è¿™ä¸ªèŠ‚ç‚¹çš„struct pageæ•°ç»„ï¼Œç”¨äºæè¿°è¿™ä¸ªèŠ‚ç‚¹é‡Œé¢çš„æ‰€æœ‰çš„é¡µï¼›</p>\n</li>\n<li>\n<p>node_start_pfnæ˜¯è¿™ä¸ªèŠ‚ç‚¹çš„èµ·å§‹é¡µå·ï¼›</p>\n</li>\n<li>\n<p>node_spanned_pagesæ˜¯è¿™ä¸ªèŠ‚ç‚¹ä¸­åŒ…å«ä¸è¿ç»­çš„ç‰©ç†å†…å­˜åœ°å€çš„é¡µé¢æ•°ï¼›</p>\n</li>\n<li>\n<p>node_present_pagesæ˜¯çœŸæ­£å¯ç”¨çš„ç‰©ç†é¡µé¢çš„æ•°ç›®ã€‚</p>\n</li>\n</ul><p>ä¾‹å¦‚ï¼Œ64Mç‰©ç†å†…å­˜éš”ç€ä¸€ä¸ª4Mçš„ç©ºæ´ï¼Œç„¶åæ˜¯å¦å¤–çš„64Mç‰©ç†å†…å­˜ã€‚è¿™æ ·æ¢ç®—æˆé¡µé¢æ•°ç›®å°±æ˜¯ï¼Œ16Kä¸ªé¡µé¢éš”ç€1Kä¸ªé¡µé¢ï¼Œç„¶åæ˜¯å¦å¤–16Kä¸ªé¡µé¢ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œnode_spanned_pageså°±æ˜¯33Kä¸ªé¡µé¢ï¼Œnode_present_pageså°±æ˜¯32Kä¸ªé¡µé¢ã€‚</p><pre><code>typedef struct pglist_data {\n\tstruct zone node_zones[MAX_NR_ZONES];\n\tstruct zonelist node_zonelists[MAX_ZONELISTS];\n\tint nr_zones;\n\tstruct page *node_mem_map;\n\tunsigned long node_start_pfn;\n\tunsigned long node_present_pages; /* total number of physical pages */\n\tunsigned long node_spanned_pages; /* total size of physical page range, including holes */\n\tint node_id;\n......\n} pg_data_t;\n</code></pre><p>æ¯ä¸€ä¸ªèŠ‚ç‚¹åˆ†æˆä¸€ä¸ªä¸ªåŒºåŸŸzoneï¼Œæ”¾åœ¨æ•°ç»„node_zonesé‡Œé¢ã€‚è¿™ä¸ªæ•°ç»„çš„å¤§å°ä¸ºMAX_NR_ZONESã€‚æˆ‘ä»¬æ¥çœ‹åŒºåŸŸçš„å®šä¹‰ã€‚</p><pre><code>enum zone_type {\n#ifdef CONFIG_ZONE_DMA\n\tZONE_DMA,\n#endif\n#ifdef CONFIG_ZONE_DMA32\n\tZONE_DMA32,\n#endif\n\tZONE_NORMAL,\n#ifdef CONFIG_HIGHMEM\n\tZONE_HIGHMEM,\n#endif\n\tZONE_MOVABLE,\n\t__MAX_NR_ZONES\n};\n</code></pre><p>ZONE_DMAæ˜¯æŒ‡å¯ç”¨äºä½œDMAï¼ˆDirect Memory Accessï¼Œç›´æ¥å†…å­˜å­˜å–ï¼‰çš„å†…å­˜ã€‚DMAæ˜¯è¿™æ ·ä¸€ç§æœºåˆ¶ï¼šè¦æŠŠå¤–è®¾çš„æ•°æ®è¯»å…¥å†…å­˜æˆ–æŠŠå†…å­˜çš„æ•°æ®ä¼ é€åˆ°å¤–è®¾ï¼ŒåŸæ¥éƒ½è¦é€šè¿‡CPUæ§åˆ¶å®Œæˆï¼Œä½†æ˜¯è¿™ä¼šå ç”¨CPUï¼Œå½±å“CPUå¤„ç†å…¶ä»–äº‹æƒ…ï¼Œæ‰€ä»¥æœ‰äº†DMAæ¨¡å¼ã€‚CPUåªéœ€å‘DMAæ§åˆ¶å™¨ä¸‹è¾¾æŒ‡ä»¤ï¼Œè®©DMAæ§åˆ¶å™¨æ¥å¤„ç†æ•°æ®çš„ä¼ é€ï¼Œæ•°æ®ä¼ é€å®Œæ¯•å†æŠŠä¿¡æ¯åé¦ˆç»™CPUï¼Œè¿™æ ·å°±å¯ä»¥è§£æ”¾CPUã€‚</p><p>å¯¹äº64ä½ç³»ç»Ÿï¼Œæœ‰ä¸¤ä¸ªDMAåŒºåŸŸã€‚é™¤äº†ä¸Šé¢è¯´çš„ZONE_DMAï¼Œè¿˜æœ‰ZONE_DMA32ã€‚åœ¨è¿™é‡Œä½ å¤§æ¦‚ç†è§£DMAçš„åŸç†å°±å¯ä»¥ï¼Œä¸å¿…çº ç»“ï¼Œæˆ‘ä»¬åé¢ä¼šè®²DMAçš„æœºåˆ¶ã€‚</p><p>ZONE_NORMALæ˜¯ç›´æ¥æ˜ å°„åŒºï¼Œå°±æ˜¯ä¸Šä¸€èŠ‚è®²çš„ï¼Œä»ç‰©ç†å†…å­˜åˆ°è™šæ‹Ÿå†…å­˜çš„å†…æ ¸åŒºåŸŸï¼Œé€šè¿‡åŠ ä¸Šä¸€ä¸ªå¸¸é‡ç›´æ¥æ˜ å°„ã€‚</p><p>ZONE_HIGHMEMæ˜¯é«˜ç«¯å†…å­˜åŒºï¼Œå°±æ˜¯ä¸Šä¸€èŠ‚è®²çš„ï¼Œå¯¹äº32ä½ç³»ç»Ÿæ¥è¯´è¶…è¿‡896Mçš„åœ°æ–¹ï¼Œå¯¹äº64ä½æ²¡å¿…è¦æœ‰çš„ä¸€æ®µåŒºåŸŸã€‚</p><p>ZONE_MOVABLEæ˜¯å¯ç§»åŠ¨åŒºåŸŸï¼Œé€šè¿‡å°†ç‰©ç†å†…å­˜åˆ’åˆ†ä¸ºå¯ç§»åŠ¨åˆ†é…åŒºåŸŸå’Œä¸å¯ç§»åŠ¨åˆ†é…åŒºåŸŸæ¥é¿å…å†…å­˜ç¢ç‰‡ã€‚</p><p>è¿™é‡Œä½ éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œæˆ‘ä»¬åˆšæ‰å¯¹äºåŒºåŸŸçš„åˆ’åˆ†ï¼Œéƒ½æ˜¯é’ˆå¯¹ç‰©ç†å†…å­˜çš„ã€‚</p><p>nr_zonesè¡¨ç¤ºå½“å‰èŠ‚ç‚¹çš„åŒºåŸŸçš„æ•°é‡ã€‚node_zonelistsæ˜¯å¤‡ç”¨èŠ‚ç‚¹å’Œå®ƒçš„å†…å­˜åŒºåŸŸçš„æƒ…å†µã€‚å‰é¢è®²NUMAçš„æ—¶å€™ï¼Œæˆ‘ä»¬è®²äº†CPUè®¿é—®å†…å­˜ï¼Œæœ¬èŠ‚ç‚¹é€Ÿåº¦æœ€å¿«ï¼Œä½†æ˜¯å¦‚æœæœ¬èŠ‚ç‚¹å†…å­˜ä¸å¤Ÿæ€ä¹ˆåŠï¼Œè¿˜æ˜¯éœ€è¦å»å…¶ä»–èŠ‚ç‚¹è¿›è¡Œåˆ†é…ã€‚æ¯•ç«Ÿï¼Œå°±ç®—åœ¨å¤‡ç”¨èŠ‚ç‚¹é‡Œé¢é€‰æ‹©ï¼Œæ…¢äº†ç‚¹ä¹Ÿæ¯”æ²¡æœ‰å¼ºã€‚</p><p>æ—¢ç„¶æ•´ä¸ªå†…å­˜è¢«åˆ†æˆäº†å¤šä¸ªèŠ‚ç‚¹ï¼Œé‚£pglist_dataåº”è¯¥æ”¾åœ¨ä¸€ä¸ªæ•°ç»„é‡Œé¢ã€‚æ¯ä¸ªèŠ‚ç‚¹ä¸€é¡¹ï¼Œå°±åƒä¸‹é¢ä»£ç é‡Œé¢ä¸€æ ·ï¼š</p><pre><code>struct pglist_data *node_data[MAX_NUMNODES] __read_mostly;\n</code></pre><h3>åŒºåŸŸ</h3><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬æŠŠå†…å­˜åˆ†æˆäº†èŠ‚ç‚¹ï¼ŒæŠŠèŠ‚ç‚¹åˆ†æˆäº†åŒºåŸŸã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹ï¼Œä¸€ä¸ªåŒºåŸŸé‡Œé¢æ˜¯å¦‚ä½•ç»„ç»‡çš„ã€‚</p><p>è¡¨ç¤ºåŒºåŸŸçš„æ•°æ®ç»“æ„zoneçš„å®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code>struct zone {\n......\n\tstruct pglist_data\t*zone_pgdat;\n\tstruct per_cpu_pageset __percpu *pageset;\n\n\n\tunsigned long\t\tzone_start_pfn;\n\n\n\t/*\n\t * spanned_pages is the total pages spanned by the zone, including\n\t * holes, which is calculated as:\n\t * \tspanned_pages = zone_end_pfn - zone_start_pfn;\n\t *\n\t * present_pages is physical pages existing within the zone, which\n\t * is calculated as:\n\t *\tpresent_pages = spanned_pages - absent_pages(pages in holes);\n\t *\n\t * managed_pages is present pages managed by the buddy system, which\n\t * is calculated as (reserved_pages includes pages allocated by the\n\t * bootmem allocator):\n\t *\tmanaged_pages = present_pages - reserved_pages;\n\t *\n\t */\n\tunsigned long\t\tmanaged_pages;\n\tunsigned long\t\tspanned_pages;\n\tunsigned long\t\tpresent_pages;\n\n\n\tconst char\t\t*name;\n......\n\t/* free areas of different sizes */\n\tstruct free_area\tfree_area[MAX_ORDER];\n\n\n\t/* zone flags, see below */\n\tunsigned long\t\tflags;\n\n\n\t/* Primarily protects free_area */\n\tspinlock_t\t\tlock;\n......\n} ____cacheline_internodealigned_in_\n</code></pre><p>åœ¨ä¸€ä¸ªzoneé‡Œé¢ï¼Œzone_start_pfnè¡¨ç¤ºå±äºè¿™ä¸ªzoneçš„ç¬¬ä¸€ä¸ªé¡µã€‚</p><p>å¦‚æœæˆ‘ä»¬ä»”ç»†çœ‹ä»£ç çš„æ³¨é‡Šï¼Œå¯ä»¥çœ‹åˆ°ï¼Œspanned_pages = zone_end_pfn - zone_start_pfnï¼Œä¹Ÿå³spanned_pagesæŒ‡çš„æ˜¯ä¸ç®¡ä¸­é—´æœ‰æ²¡æœ‰ç‰©ç†å†…å­˜ç©ºæ´ï¼Œåæ­£å°±æ˜¯æœ€åçš„é¡µå·å‡å»èµ·å§‹çš„é¡µå·ã€‚</p><p>present_pages = spanned_pages - absent_pages(pages in holes)ï¼Œä¹Ÿå³present_pagesæ˜¯è¿™ä¸ªzoneåœ¨ç‰©ç†å†…å­˜ä¸­çœŸå®å­˜åœ¨çš„æ‰€æœ‰pageæ•°ç›®ã€‚</p><p>managed_pages = present_pages - reserved_pagesï¼Œä¹Ÿå³managed_pagesæ˜¯è¿™ä¸ªzoneè¢«ä¼™ä¼´ç³»ç»Ÿç®¡ç†çš„æ‰€æœ‰çš„pageæ•°ç›®ï¼Œä¼™ä¼´ç³»ç»Ÿçš„å·¥ä½œæœºåˆ¶æˆ‘ä»¬åé¢ä¼šè®²ã€‚</p><p>per_cpu_pagesetç”¨äºåŒºåˆ†å†·çƒ­é¡µã€‚ä»€ä¹ˆå«å†·çƒ­é¡µå‘¢ï¼Ÿå’±ä»¬è®²x86ä½“ç³»ç»“æ„çš„æ—¶å€™è®²è¿‡ï¼Œä¸ºäº†è®©CPUå¿«é€Ÿè®¿é—®æ®µæè¿°ç¬¦ï¼Œåœ¨CPUé‡Œé¢æœ‰æ®µæè¿°ç¬¦ç¼“å­˜ã€‚CPUè®¿é—®è¿™ä¸ªç¼“å­˜çš„é€Ÿåº¦æ¯”å†…å­˜å¿«å¾—å¤šã€‚åŒæ ·å¯¹äºé¡µé¢æ¥è®²ï¼Œä¹Ÿæ˜¯è¿™æ ·çš„ã€‚å¦‚æœä¸€ä¸ªé¡µè¢«åŠ è½½åˆ°CPUé«˜é€Ÿç¼“å­˜é‡Œé¢ï¼Œè¿™å°±æ˜¯ä¸€ä¸ªçƒ­é¡µï¼ˆHot Pageï¼‰ï¼ŒCPUè¯»èµ·æ¥é€Ÿåº¦ä¼šå¿«å¾ˆå¤šï¼Œå¦‚æœæ²¡æœ‰å°±æ˜¯å†·é¡µï¼ˆCold Pageï¼‰ã€‚ç”±äºæ¯ä¸ªCPUéƒ½æœ‰è‡ªå·±çš„é«˜é€Ÿç¼“å­˜ï¼Œå› è€Œper_cpu_pagesetä¹Ÿæ˜¯æ¯ä¸ªCPUä¸€ä¸ªã€‚</p><h3>é¡µ</h3><p>äº†è§£äº†åŒºåŸŸzoneï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±åˆ°äº†ç»„æˆç‰©ç†å†…å­˜çš„åŸºæœ¬å•ä½ï¼Œé¡µçš„æ•°æ®ç»“æ„struct pageã€‚è¿™æ˜¯ä¸€ä¸ªç‰¹åˆ«å¤æ‚çš„ç»“æ„ï¼Œé‡Œé¢æœ‰å¾ˆå¤šçš„unionï¼Œunionç»“æ„æ˜¯åœ¨Cè¯­è¨€ä¸­è¢«ç”¨äºåŒä¸€å—å†…å­˜æ ¹æ®æƒ…å†µä¿å­˜ä¸åŒç±»å‹æ•°æ®çš„ä¸€ç§æ–¹å¼ã€‚è¿™é‡Œä¹‹æ‰€ä»¥ç”¨äº†unionï¼Œæ˜¯å› ä¸ºä¸€ä¸ªç‰©ç†é¡µé¢ä½¿ç”¨æ¨¡å¼æœ‰å¤šç§ã€‚</p><p>ç¬¬ä¸€ç§æ¨¡å¼ï¼Œè¦ç”¨å°±ç”¨ä¸€æ•´é¡µã€‚è¿™ä¸€æ•´é¡µçš„å†…å­˜ï¼Œæˆ–è€…ç›´æ¥å’Œè™šæ‹Ÿåœ°å€ç©ºé—´å»ºç«‹æ˜ å°„å…³ç³»ï¼Œæˆ‘ä»¬æŠŠè¿™ç§ç§°ä¸ºåŒ¿åé¡µï¼ˆAnonymous Pageï¼‰ã€‚æˆ–è€…ç”¨äºå…³è”ä¸€ä¸ªæ–‡ä»¶ï¼Œç„¶åå†å’Œè™šæ‹Ÿåœ°å€ç©ºé—´å»ºç«‹æ˜ å°„å…³ç³»ï¼Œè¿™æ ·çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬ç§°ä¸ºå†…å­˜æ˜ å°„æ–‡ä»¶ï¼ˆMemory-mapped Fileï¼‰ã€‚</p><p>å¦‚æœæŸä¸€é¡µæ˜¯è¿™ç§ä½¿ç”¨æ¨¡å¼ï¼Œåˆ™ä¼šä½¿ç”¨unionä¸­çš„ä»¥ä¸‹å˜é‡ï¼š</p><ul>\n<li>\n<p>struct address_space *mappingå°±æ˜¯ç”¨äºå†…å­˜æ˜ å°„ï¼Œå¦‚æœæ˜¯åŒ¿åé¡µï¼Œæœ€ä½ä½ä¸º1ï¼›å¦‚æœæ˜¯æ˜ å°„æ–‡ä»¶ï¼Œæœ€ä½ä½ä¸º0ï¼›</p>\n</li>\n<li>\n<p>pgoff_t indexæ˜¯åœ¨æ˜ å°„åŒºçš„åç§»é‡ï¼›</p>\n</li>\n<li>\n<p>atomic_t _mapcountï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±çš„é¡µè¡¨ï¼Œè¿™é‡ŒæŒ‡æœ‰å¤šå°‘ä¸ªé¡µè¡¨é¡¹æŒ‡å‘äº†è¿™ä¸ªé¡µï¼›</p>\n</li>\n<li>\n<p>struct list_head lruè¡¨ç¤ºè¿™ä¸€é¡µåº”è¯¥åœ¨ä¸€ä¸ªé“¾è¡¨ä¸Šï¼Œä¾‹å¦‚è¿™ä¸ªé¡µé¢è¢«æ¢å‡ºï¼Œå°±åœ¨æ¢å‡ºé¡µçš„é“¾è¡¨ä¸­ï¼›</p>\n</li>\n<li>\n<p>compoundç›¸å…³çš„å˜é‡ç”¨äºå¤åˆé¡µï¼ˆCompound Pageï¼‰ï¼Œå°±æ˜¯å°†ç‰©ç†ä¸Šè¿ç»­çš„ä¸¤ä¸ªæˆ–å¤šä¸ªé¡µçœ‹æˆä¸€ä¸ªç‹¬ç«‹çš„å¤§é¡µã€‚</p>\n</li>\n</ul><p>ç¬¬äºŒç§æ¨¡å¼ï¼Œä»…éœ€åˆ†é…å°å—å†…å­˜ã€‚æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä¸€ä¸‹å­åˆ†é…è¿™ä¹ˆå¤šçš„å†…å­˜ï¼Œä¾‹å¦‚åˆ†é…ä¸€ä¸ªtask_structç»“æ„ï¼Œåªéœ€è¦åˆ†é…å°å—çš„å†…å­˜ï¼Œå»å­˜å‚¨è¿™ä¸ªè¿›ç¨‹æè¿°ç»“æ„çš„å¯¹è±¡ã€‚ä¸ºäº†æ»¡è¶³å¯¹è¿™ç§å°å†…å­˜å—çš„éœ€è¦ï¼ŒLinuxç³»ç»Ÿé‡‡ç”¨äº†ä¸€ç§è¢«ç§°ä¸º<strong>slab allocator</strong>çš„æŠ€æœ¯ï¼Œç”¨äºåˆ†é…ç§°ä¸ºslabçš„ä¸€å°å—å†…å­˜ã€‚å®ƒçš„åŸºæœ¬åŸç†æ˜¯ä»å†…å­˜ç®¡ç†æ¨¡å—ç”³è¯·ä¸€æ•´å—é¡µï¼Œç„¶ååˆ’åˆ†æˆå¤šä¸ªå°å—çš„å­˜å‚¨æ± ï¼Œç”¨å¤æ‚çš„é˜Ÿåˆ—æ¥ç»´æŠ¤è¿™äº›å°å—çš„çŠ¶æ€ï¼ˆçŠ¶æ€åŒ…æ‹¬ï¼šè¢«åˆ†é…äº†/è¢«æ”¾å›æ± å­/åº”è¯¥è¢«å›æ”¶ï¼‰ã€‚</p><p>ä¹Ÿæ­£æ˜¯å› ä¸ºslab allocatorå¯¹äºé˜Ÿåˆ—çš„ç»´æŠ¤è¿‡äºå¤æ‚ï¼Œåæ¥å°±æœ‰äº†ä¸€ç§ä¸ä½¿ç”¨é˜Ÿåˆ—çš„åˆ†é…å™¨slub allocatorï¼Œåé¢æˆ‘ä»¬ä¼šè§£æè¿™ä¸ªåˆ†é…å™¨ã€‚ä½†æ˜¯ä½ ä¼šå‘ç°ï¼Œå®ƒé‡Œé¢è¿˜æ˜¯ç”¨äº†å¾ˆå¤šslabçš„å­—çœ¼ï¼Œå› ä¸ºå®ƒä¿ç•™äº†slabçš„ç”¨æˆ·æ¥å£ï¼Œå¯ä»¥çœ‹æˆslab allocatorçš„å¦ä¸€ç§å®ç°ã€‚</p><p>è¿˜æœ‰ä¸€ç§å°å—å†…å­˜çš„åˆ†é…å™¨ç§°ä¸º<strong>slob</strong>ï¼Œéå¸¸ç®€å•ï¼Œä¸»è¦ä½¿ç”¨åœ¨å°å‹çš„åµŒå…¥å¼ç³»ç»Ÿã€‚</p><p>å¦‚æœæŸä¸€é¡µæ˜¯ç”¨äºåˆ†å‰²æˆä¸€å°å—ä¸€å°å—çš„å†…å­˜è¿›è¡Œåˆ†é…çš„ä½¿ç”¨æ¨¡å¼ï¼Œåˆ™ä¼šä½¿ç”¨unionä¸­çš„ä»¥ä¸‹å˜é‡ï¼š</p><ul>\n<li>\n<p>s_memæ˜¯å·²ç»åˆ†é…äº†æ­£åœ¨ä½¿ç”¨çš„slabçš„ç¬¬ä¸€ä¸ªå¯¹è±¡ï¼›</p>\n</li>\n<li>\n<p>freelistæ˜¯æ± å­ä¸­çš„ç©ºé—²å¯¹è±¡ï¼›</p>\n</li>\n<li>\n<p>rcu_headæ˜¯éœ€è¦é‡Šæ”¾çš„åˆ—è¡¨ã€‚</p>\n</li>\n</ul><pre><code>    struct page {\n    \tunsigned long flags;\n    \tunion {\n    \t\tstruct address_space *mapping;\t\n    \t\tvoid *s_mem;\t\t\t/* slab first object */\n    \t\tatomic_t compound_mapcount;\t/* first tail page */\n    \t};\n    \tunion {\n    \t\tpgoff_t index;\t\t/* Our offset within mapping. */\n    \t\tvoid *freelist;\t\t/* sl[aou]b first free object */\n    \t};\n    \tunion {\n    \t\tunsigned counters;\n    \t\tstruct {\n    \t\t\tunion {\n    \t\t\t\tatomic_t _mapcount;\n    \t\t\t\tunsigned int active;\t\t/* SLAB */\n    \t\t\t\tstruct {\t\t\t/* SLUB */\n    \t\t\t\t\tunsigned inuse:16;\n    \t\t\t\t\tunsigned objects:15;\n    \t\t\t\t\tunsigned frozen:1;\n    \t\t\t\t};\n    \t\t\t\tint units;\t\t\t/* SLOB */\n    \t\t\t};\n    \t\t\tatomic_t _refcount;\n    \t\t};\n    \t};\n    \tunion {\n    \t\tstruct list_head lru;\t/* Pageout list\t */\n    \t\tstruct dev_pagemap *pgmap; \n    \t\tstruct {\t\t/* slub per cpu partial pages */\n    \t\t\tstruct page *next;\t/* Next partial slab */\n    \t\t\tint pages;\t/* Nr of partial slabs left */\n    \t\t\tint pobjects;\t/* Approximate # of objects */\n    \t\t};\n    \t\tstruct rcu_head rcu_head;\n    \t\tstruct {\n    \t\t\tunsigned long compound_head; /* If bit zero is set */\n    \t\t\tunsigned int compound_dtor;\n    \t\t\tunsigned int compound_order;\n    \t\t};\n    \t};\n    \tunion {\n    \t\tunsigned long private;\n    \t\tstruct kmem_cache *slab_cache;\t/* SL[AU]B: Pointer to slab */\n    \t};\n    ......\n    }\n</code></pre><h2>é¡µçš„åˆ†é…</h2><p>å¥½äº†ï¼Œå‰é¢æˆ‘ä»¬è®²äº†ç‰©ç†å†…å­˜çš„ç»„ç»‡ï¼Œä»èŠ‚ç‚¹åˆ°åŒºåŸŸåˆ°é¡µåˆ°å°å—ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ç‰©ç†å†…å­˜çš„åˆ†é…ã€‚</p><p>å¯¹äºè¦åˆ†é…æ¯”è¾ƒå¤§çš„å†…å­˜ï¼Œä¾‹å¦‚åˆ°åˆ†é…é¡µçº§åˆ«çš„ï¼Œå¯ä»¥ä½¿ç”¨<strong>ä¼™ä¼´ç³»ç»Ÿ</strong>ï¼ˆBuddy Systemï¼‰ã€‚</p><p>Linuxä¸­çš„å†…å­˜ç®¡ç†çš„â€œé¡µâ€å¤§å°ä¸º4KBã€‚æŠŠæ‰€æœ‰çš„ç©ºé—²é¡µåˆ†ç»„ä¸º11ä¸ªé¡µå—é“¾è¡¨ï¼Œæ¯ä¸ªå—é“¾è¡¨åˆ†åˆ«åŒ…å«å¾ˆå¤šä¸ªå¤§å°çš„é¡µå—ï¼Œæœ‰1ã€2ã€4ã€8ã€16ã€32ã€64ã€128ã€256ã€512å’Œ1024ä¸ªè¿ç»­é¡µçš„é¡µå—ã€‚æœ€å¤§å¯ä»¥ç”³è¯·1024ä¸ªè¿ç»­é¡µï¼Œå¯¹åº”4MBå¤§å°çš„è¿ç»­å†…å­˜ã€‚æ¯ä¸ªé¡µå—çš„ç¬¬ä¸€ä¸ªé¡µçš„ç‰©ç†åœ°å€æ˜¯è¯¥é¡µå—å¤§å°çš„æ•´æ•°å€ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/27/cf/2738c0c98d2ed31cbbe1fdcba01142cf.jpeg?wh=2444*1247\" alt=\"\"></p><p>ç¬¬iä¸ªé¡µå—é“¾è¡¨ä¸­ï¼Œé¡µå—ä¸­é¡µçš„æ•°ç›®ä¸º2^iã€‚</p><p>åœ¨struct zoneé‡Œé¢æœ‰ä»¥ä¸‹çš„å®šä¹‰ï¼š</p><pre><code>struct free_area\tfree_area[MAX_ORDER];\n</code></pre><p>MAX_ORDERå°±æ˜¯æŒ‡æ•°ã€‚</p><pre><code>#define MAX_ORDER 11\n</code></pre><p>å½“å‘å†…æ ¸è¯·æ±‚åˆ†é…(2^(i-1)ï¼Œ2^i]æ•°ç›®çš„é¡µå—æ—¶ï¼ŒæŒ‰ç…§2^ié¡µå—è¯·æ±‚å¤„ç†ã€‚å¦‚æœå¯¹åº”çš„é¡µå—é“¾è¡¨ä¸­æ²¡æœ‰ç©ºé—²é¡µå—ï¼Œé‚£æˆ‘ä»¬å°±åœ¨æ›´å¤§çš„é¡µå—é“¾è¡¨ä¸­å»æ‰¾ã€‚å½“åˆ†é…çš„é¡µå—ä¸­æœ‰å¤šä½™çš„é¡µæ—¶ï¼Œä¼™ä¼´ç³»ç»Ÿä¼šæ ¹æ®å¤šä½™çš„é¡µå—å¤§å°æ’å…¥åˆ°å¯¹åº”çš„ç©ºé—²é¡µå—é“¾è¡¨ä¸­ã€‚</p><p>ä¾‹å¦‚ï¼Œè¦è¯·æ±‚ä¸€ä¸ª128ä¸ªé¡µçš„é¡µå—æ—¶ï¼Œå…ˆæ£€æŸ¥128ä¸ªé¡µçš„é¡µå—é“¾è¡¨æ˜¯å¦æœ‰ç©ºé—²å—ã€‚å¦‚æœæ²¡æœ‰ï¼Œåˆ™æŸ¥256ä¸ªé¡µçš„é¡µå—é“¾è¡¨ï¼›å¦‚æœæœ‰ç©ºé—²å—çš„è¯ï¼Œåˆ™å°†256ä¸ªé¡µçš„é¡µå—åˆ†æˆä¸¤ä»½ï¼Œä¸€ä»½ä½¿ç”¨ï¼Œä¸€ä»½æ’å…¥128ä¸ªé¡µçš„é¡µå—é“¾è¡¨ä¸­ã€‚å¦‚æœè¿˜æ˜¯æ²¡æœ‰ï¼Œå°±æŸ¥512ä¸ªé¡µçš„é¡µå—é“¾è¡¨ï¼›å¦‚æœæœ‰çš„è¯ï¼Œå°±åˆ†è£‚ä¸º128ã€128ã€256ä¸‰ä¸ªé¡µå—ï¼Œä¸€ä¸ª128çš„ä½¿ç”¨ï¼Œå‰©ä½™ä¸¤ä¸ªæ’å…¥å¯¹åº”é¡µå—é“¾è¡¨ã€‚</p><p>ä¸Šé¢è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆ†é…é¡µçš„å‡½æ•°alloc_pagesä¸­çœ‹åˆ°ã€‚</p><pre><code>static inline struct page *\nalloc_pages(gfp_t gfp_mask, unsigned int order)\n{\n\treturn alloc_pages_current(gfp_mask, order);\n}\n\n\n/**\n * \talloc_pages_current - Allocate pages.\n *\n *\t@gfp:\n *\t\t%GFP_USER   user allocation,\n *      \t%GFP_KERNEL kernel allocation,\n *      \t%GFP_HIGHMEM highmem allocation,\n *      \t%GFP_FS     don't call back into a file system.\n *      \t%GFP_ATOMIC don't sleep.\n *\t@order: Power of two of allocation size in pages. 0 is a single page.\n *\n *\tAllocate a page from the kernel page pool.  When not in\n *\tinterrupt context and apply the current process NUMA policy.\n *\tReturns NULL when no page can be allocated.\n */\nstruct page *alloc_pages_current(gfp_t gfp, unsigned order)\n{\n\tstruct mempolicy *pol = &amp;default_policy;\n\tstruct page *page;\n......\n\tpage = __alloc_pages_nodemask(gfp, order,\n\t\t\t\tpolicy_node(gfp, pol, numa_node_id()),\n\t\t\t\tpolicy_nodemask(gfp, pol));\n......\n\treturn page;\n}\n</code></pre><p>alloc_pagesä¼šè°ƒç”¨alloc_pages_currentï¼Œè¿™é‡Œé¢çš„æ³¨é‡Šæ¯”è¾ƒå®¹æ˜“çœ‹æ‡‚äº†ï¼Œgfpè¡¨ç¤ºå¸Œæœ›åœ¨å“ªä¸ªåŒºåŸŸä¸­åˆ†é…è¿™ä¸ªå†…å­˜ï¼š</p><ul>\n<li>\n<p>GFP_USERç”¨äºåˆ†é…ä¸€ä¸ªé¡µæ˜ å°„åˆ°ç”¨æˆ·è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œå¹¶ä¸”å¸Œæœ›ç›´æ¥è¢«å†…æ ¸æˆ–è€…ç¡¬ä»¶è®¿é—®ï¼Œä¸»è¦ç”¨äºä¸€ä¸ªç”¨æˆ·è¿›ç¨‹å¸Œæœ›é€šè¿‡å†…å­˜æ˜ å°„çš„æ–¹å¼ï¼Œè®¿é—®æŸäº›ç¡¬ä»¶çš„ç¼“å­˜ï¼Œä¾‹å¦‚æ˜¾å¡ç¼“å­˜ï¼›</p>\n</li>\n<li>\n<p>GFP_KERNELç”¨äºå†…æ ¸ä¸­åˆ†é…é¡µï¼Œä¸»è¦åˆ†é…ZONE_NORMALåŒºåŸŸï¼Œä¹Ÿå³ç›´æ¥æ˜ å°„åŒºï¼›</p>\n</li>\n<li>\n<p>GFP_HIGHMEMï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ä¸»è¦åˆ†é…é«˜ç«¯åŒºåŸŸçš„å†…å­˜ã€‚</p>\n</li>\n</ul><p>å¦ä¸€ä¸ªå‚æ•°orderï¼Œå°±æ˜¯è¡¨ç¤ºåˆ†é…2çš„orderæ¬¡æ–¹ä¸ªé¡µã€‚</p><p>æ¥ä¸‹æ¥è°ƒç”¨__alloc_pages_nodemaskã€‚è¿™æ˜¯ä¼™ä¼´ç³»ç»Ÿçš„æ ¸å¿ƒæ–¹æ³•ã€‚å®ƒä¼šè°ƒç”¨get_page_from_freelistã€‚è¿™é‡Œé¢çš„é€»è¾‘ä¹Ÿå¾ˆå®¹æ˜“ç†è§£ï¼Œå°±æ˜¯åœ¨ä¸€ä¸ªå¾ªç¯ä¸­å…ˆçœ‹å½“å‰èŠ‚ç‚¹çš„zoneã€‚å¦‚æœæ‰¾ä¸åˆ°ç©ºé—²é¡µï¼Œåˆ™å†çœ‹å¤‡ç”¨èŠ‚ç‚¹çš„zoneã€‚</p><pre><code>static struct page *\nget_page_from_freelist(gfp_t gfp_mask, unsigned int order, int alloc_flags,\n\t\t\t\t\t\tconst struct alloc_context *ac)\n{\n......\n\tfor_next_zone_zonelist_nodemask(zone, z, ac-&gt;zonelist, ac-&gt;high_zoneidx, ac-&gt;nodemask) {\n\t\tstruct page *page;\n......\n\t\tpage = rmqueue(ac-&gt;preferred_zoneref-&gt;zone, zone, order,\n\t\t\t\tgfp_mask, alloc_flags, ac-&gt;migratetype);\n......\n}\n</code></pre><p>æ¯ä¸€ä¸ªzoneï¼Œéƒ½æœ‰ä¼™ä¼´ç³»ç»Ÿç»´æŠ¤çš„å„ç§å¤§å°çš„é˜Ÿåˆ—ï¼Œå°±åƒä¸Šé¢ä¼™ä¼´ç³»ç»ŸåŸç†é‡Œè®²çš„é‚£æ ·ã€‚è¿™é‡Œè°ƒç”¨rmqueueå°±å¾ˆå¥½ç†è§£äº†ï¼Œå°±æ˜¯æ‰¾åˆ°åˆé€‚å¤§å°çš„é‚£ä¸ªé˜Ÿåˆ—ï¼ŒæŠŠé¡µé¢å–ä¸‹æ¥ã€‚</p><p>æ¥ä¸‹æ¥çš„è°ƒç”¨é“¾æ˜¯rmqueue-&gt;__rmqueue-&gt;__rmqueue_smallestã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬èƒ½æ¸…æ¥šçœ‹åˆ°ä¼™ä¼´ç³»ç»Ÿçš„é€»è¾‘ã€‚</p><pre><code>static inline\nstruct page *__rmqueue_smallest(struct zone *zone, unsigned int order,\n\t\t\t\t\t\tint migratetype)\n{\n\tunsigned int current_order;\n\tstruct free_area *area;\n\tstruct page *page;\n\n\n\t/* Find a page of the appropriate size in the preferred list */\n\tfor (current_order = order; current_order &lt; MAX_ORDER; ++current_order) {\n\t\tarea = &amp;(zone-&gt;free_area[current_order]);\n\t\tpage = list_first_entry_or_null(&amp;area-&gt;free_list[migratetype],\n\t\t\t\t\t\t\tstruct page, lru);\n\t\tif (!page)\n\t\t\tcontinue;\n\t\tlist_del(&amp;page-&gt;lru);\n\t\trmv_page_order(page);\n\t\tarea-&gt;nr_free--;\n\t\texpand(zone, page, order, current_order, area, migratetype);\n\t\tset_pcppage_migratetype(page, migratetype);\n\t\treturn page;\n\t}\n\n\n\treturn NULL;\n</code></pre><p>ä»å½“å‰çš„orderï¼Œä¹Ÿå³æŒ‡æ•°å¼€å§‹ï¼Œåœ¨ä¼™ä¼´ç³»ç»Ÿçš„free_areaæ‰¾2^orderå¤§å°çš„é¡µå—ã€‚å¦‚æœé“¾è¡¨çš„ç¬¬ä¸€ä¸ªä¸ä¸ºç©ºï¼Œå°±æ‰¾åˆ°äº†ï¼›å¦‚æœä¸ºç©ºï¼Œå°±åˆ°æ›´å¤§çš„orderçš„é¡µå—é“¾è¡¨é‡Œé¢å»æ‰¾ã€‚æ‰¾åˆ°ä»¥åï¼Œé™¤äº†å°†é¡µå—ä»é“¾è¡¨ä¸­å–ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿˜è¦æŠŠå¤šä½™éƒ¨åˆ†æ”¾åˆ°å…¶ä»–é¡µå—é“¾è¡¨é‡Œé¢ã€‚expandå°±æ˜¯å¹²è¿™ä¸ªäº‹æƒ…çš„ã€‚areaâ€“å°±æ˜¯ä¼™ä¼´ç³»ç»Ÿé‚£ä¸ªè¡¨é‡Œé¢çš„å‰ä¸€é¡¹ï¼Œå‰ä¸€é¡¹é‡Œé¢çš„é¡µå—å¤§å°æ˜¯å½“å‰é¡¹çš„é¡µå—å¤§å°é™¤ä»¥2ï¼Œsizeå³ç§»ä¸€ä½ä¹Ÿå°±æ˜¯é™¤ä»¥2ï¼Œlist_addå°±æ˜¯åŠ åˆ°é“¾è¡¨ä¸Šï¼Œnr_free++å°±æ˜¯è®¡æ•°åŠ 1ã€‚</p><pre><code>static inline void expand(struct zone *zone, struct page *page,\n\tint low, int high, struct free_area *area,\n\tint migratetype)\n{\n\tunsigned long size = 1 &lt;&lt; high;\n\n\n\twhile (high &gt; low) {\n\t\tarea--;\n\t\thigh--;\n\t\tsize &gt;&gt;= 1;\n......\n\t\tlist_add(&amp;page[size].lru, &amp;area-&gt;free_list[migratetype]);\n\t\tarea-&gt;nr_free++;\n\t\tset_page_order(&amp;page[size], high);\n\t}\n}\n</code></pre><h2>æ€»ç»“æ—¶åˆ»</h2><p>å¯¹äºç‰©ç†å†…å­˜çš„ç®¡ç†çš„è®²è§£ï¼Œåˆ°è¿™é‡Œè¦å‘Šä¸€æ®µè½äº†ã€‚è¿™ä¸€èŠ‚æˆ‘ä»¬ä¸»è¦è®²äº†ç‰©ç†å†…å­˜çš„ç»„ç»‡å½¢å¼ï¼Œå°±åƒä¸‹é¢å›¾ä¸­å±•ç¤ºçš„ä¸€æ ·ã€‚</p><p>å¦‚æœæœ‰å¤šä¸ªCPUï¼Œé‚£å°±æœ‰å¤šä¸ªèŠ‚ç‚¹ã€‚æ¯ä¸ªèŠ‚ç‚¹ç”¨struct pglist_dataè¡¨ç¤ºï¼Œæ”¾åœ¨ä¸€ä¸ªæ•°ç»„é‡Œé¢ã€‚</p><p>æ¯ä¸ªèŠ‚ç‚¹åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼Œæ¯ä¸ªåŒºåŸŸç”¨struct zoneè¡¨ç¤ºï¼Œä¹Ÿæ”¾åœ¨ä¸€ä¸ªæ•°ç»„é‡Œé¢ã€‚</p><p>æ¯ä¸ªåŒºåŸŸåˆ†ä¸ºå¤šä¸ªé¡µã€‚ä¸ºäº†æ–¹ä¾¿åˆ†é…ï¼Œç©ºé—²é¡µæ”¾åœ¨struct free_areaé‡Œé¢ï¼Œä½¿ç”¨ä¼™ä¼´ç³»ç»Ÿè¿›è¡Œç®¡ç†å’Œåˆ†é…ï¼Œæ¯ä¸€é¡µç”¨struct pageè¡¨ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/3f/4f/3fa8123990e5ae2c86859f70a8351f4f.jpeg?wh=2623*1711\" alt=\"\"></p><h2>è¯¾å ‚ç»ƒä¹ </h2><p>ä¼™ä¼´ç³»ç»Ÿæ˜¯ä¸€ç§éå¸¸ç²¾å¦™çš„å®ç°æ–¹å¼ï¼Œæ— è®ºä½ ä½¿ç”¨ä»€ä¹ˆè¯­è¨€ï¼Œè¯·è‡ªå·±å®ç°ä¸€ä¸ªè¿™æ ·çš„åˆ†é…ç³»ç»Ÿï¼Œè¯´ä¸å®šå“ªå¤©ä½ åœ¨åšæŸä¸ªç³»ç»Ÿçš„æ—¶å€™ï¼Œå°±ç”¨åˆ°äº†ã€‚</p><p>æ¬¢è¿ç•™è¨€å’Œæˆ‘åˆ†äº«ä½ çš„ç–‘æƒ‘å’Œè§è§£ï¼Œä¹Ÿæ¬¢è¿ä½ æ”¶è—æœ¬èŠ‚å†…å®¹ï¼Œåå¤ç ”è¯»ã€‚ä½ ä¹Ÿå¯ä»¥æŠŠä»Šå¤©çš„å†…å®¹åˆ†äº«ç»™ä½ çš„æœ‹å‹ï¼Œå’Œä»–ä¸€èµ·å­¦ä¹ ã€è¿›æ­¥ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/8c/37/8c0a95fa07a8b9a1abfd394479bdd637.jpg?wh=1110*659\" alt=\"\"></p>","comments":[{"had_liked":false,"id":97189,"user_name":"why","can_delete":false,"product_type":"c1","uid":1012937,"ip_address":"","ucode":"C9E796E53F6F5E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/74/c9/d3439ca4.jpg","comment_is_top":false,"comment_ctime":1558604953,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"216306969753","product_id":100024701,"comment_content":"- ç‰©ç†å†…å­˜ç»„ç»‡æ–¹å¼<br>    - æ¯ä¸ªç‰©ç†é¡µç”± struct page è¡¨ç¤º<br>    - ç‰©ç†é¡µè¿ç»­, page æ”¾å…¥ä¸€ä¸ªæ•°ç»„ä¸­, ç§°ä¸ºå¹³å¦å†…å­˜æ¨¡å‹<br>    - å¤šä¸ª CPU é€šè¿‡æ€»çº¿è®¿é—®å†…å­˜, ç§°ä¸º SMP å¯¹ç§°å¤šå¤„ç†å™¨(é‡‡ç”¨å¹³å¦å†…å­˜æ¨¡å‹, æ€»çº¿æˆä¸ºç“¶é¢ˆ)<br>    - æ¯ä¸ª CPU éƒ½æœ‰æœ¬åœ°å†…å­˜, è®¿é—®å†…å­˜ä¸ç”¨æ€»çº¿, ç§°ä¸º NUMA éä¸€è‡´å†…å­˜è®¿é—®<br>    - æœ¬åœ°å†…å­˜ç§°ä¸º NUMA èŠ‚ç‚¹, æœ¬åœ°å†…å­˜ä¸è¶³å¯ä»¥å‘å…¶ä»–èŠ‚ç‚¹ç”³è¯·<br>    - NUMA é‡‡ç”¨éè¿ç»­å†…å­˜æ¨¡å‹ï¼Œé¡µå·ä¸è¿ç»­<br>    - å¦å¤–è‹¥å†…å­˜æ”¯æŒçƒ­æ’æ‹”ï¼Œåˆ™é‡‡ç”¨ç¨€ç–å†…å­˜æ¨¡å‹<br>- èŠ‚ç‚¹<br>    - ç”¨ pglist_data è¡¨ç¤º NUMA èŠ‚ç‚¹ï¼Œå¤šä¸ªèŠ‚ç‚¹ä¿¡æ¯ä¿å­˜åœ¨ node_data æ•°ç»„ä¸­<br>    - pglist_data åŒ…æ‹¬ idï¼Œpage æ•°ç»„,èµ·å§‹é¡µå·, æ€»é¡µæ•°, å¯ç”¨é¡µæ•°<br>    - èŠ‚ç‚¹åˆ†ä¸ºå¤šä¸ªåŒºåŸŸ zone, åŒ…æ‹¬ DMA; ç›´æ¥æ˜ å°„åŒº; é«˜ç«¯å†…å­˜åŒº; å¯ç§»åŠ¨åŒº(é¿å…å†…å­˜ç¢ç‰‡)<br>- åŒºåŸŸ zone<br>    - ç”¨ zone è¡¨ç¤º; åŒ…å«ç¬¬ä¸€ä¸ªé¡µé¡µå·; åŒºåŸŸæ€»é¡µæ•°; åŒºåŸŸå®é™…é¡µæ•°; è¢«ä¼™ä¼´ç³»ç»Ÿç®¡ç†çš„é¡µæ•°; ç”¨ per_cpu_pageset åŒºåˆ†å†·çƒ­é¡µ(çƒ­é¡µ, è¢« CPU ç¼“å­˜çš„é¡µ)<br>- é¡µ <br>    - ç”¨ struct page è¡¨ç¤º, æœ‰å¤šç§ä½¿ç”¨æ¨¡å¼, å› æ­¤ page ç»“æ„ä½“å¤šç”± union ç»„æˆ<br>    - ä½¿ç”¨ä¸€æ•´ä¸ªé¡µ: 1) ç›´æ¥å’Œè™šæ‹Ÿåœ°å€æ˜ å°„(åŒ¿åé¡µ); 2) ä¸æ–‡ä»¶å…³è”å†ä¸è™šæ‹Ÿåœ°å€æ˜ å°„(å†…å­˜æ˜ å°„æ–‡ä»¶)<br>        - page è®°å½•: æ ‡è®°ç”¨äºå†…å­˜æ˜ å°„; æŒ‡å‘è¯¥é¡µçš„é¡µè¡¨æ•°; æ¢å‡ºé¡µçš„é“¾è¡¨; å¤åˆé¡µ, ç”¨äºåˆæˆå¤§é¡µ;<br>    - åˆ†é…å°å—å†…å­˜: <br>        - Linux é‡‡ç”¨ slab allocator æŠ€æœ¯; ç”³è¯·ä¸€æ•´é¡µ, åˆ†ä¸ºå¤šä¸ªå°å—å­˜å‚¨æ± , ç”¨é˜Ÿåˆ—ç»´æŠ¤å…¶çŠ¶æ€(è¾ƒå¤æ‚)<br>        - slub allocator æ›´ç®€å•<br>        - slob allocator ç”¨äºåµŒå…¥å¼<br>        - page è®°å½•: ç¬¬ä¸€ä¸ª slab å¯¹è±¡; ç©ºé—²åˆ—è¡¨; å¾…é‡Šæ”¾åˆ—è¡¨<br>- é¡µåˆ†é…<br>    - åˆ†é…è¾ƒå¤§å†…å­˜(é¡µçº§åˆ«), ä½¿ç”¨ä¼™ä¼´ç³»ç»Ÿ<br>    - Linux æŠŠç©ºé—²é¡µåˆ†ç»„ä¸º 11 ä¸ªé¡µå—é“¾è¡¨, é“¾è¡¨ç®¡ç†å¤§å°ä¸åŒçš„é¡µå—(é¡µå¤§å° 2^i * 4KB)<br>    - åˆ†é…å¤§é¡µå‰©ä¸‹çš„å†…å­˜, æ’å…¥å¯¹åº”ç©ºé—²é“¾è¡¨<br>    - alloc_pages-&gt;alloc_pages_current ç”¨ gfp æŒ‡å®šåœ¨å“ªä¸ª zone åˆ†é…","like_count":50},{"had_liked":false,"id":96080,"user_name":"æœ‰é“­","can_delete":false,"product_type":"c1","uid":1046302,"ip_address":"","ucode":"2C7CB36CA5C04C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/3XbCueYYVWTiclv8T5tFpwiblOxLphvSZxL4ujMdqVMibZnOiaFK2C5nKRGv407iaAsrI0CDICYVQJtiaITzkjfjbvrQ/132","comment_is_top":false,"comment_ctime":1558322440,"is_pvip":false,"replies":[{"id":"49295","content":"ä¸€æ•´ä¸ªä¼šè®®å®¤ï¼Œåˆ’åˆ†ä¸ºä¸¤ä¸ª1&#47;2ï¼Œå†åˆ’åˆ†ä¸ºå››ä¸ª1&#47;4ï¼Œä¸¤ä¸ª1&#47;4å°±æ˜¯ä¼™ä¼´å‘€","user_name":"ä½œè€…å›å¤","comment_id":96080,"uid":"1001590","ip_address":"","utype":1,"ctime":1567610379,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":4,"race_medal":0,"score":"65982831880","product_id":100024701,"comment_content":"è¿˜æ˜¯æ²¡ç†è§£é‚£ä¸ªâ€œä¼™ä¼´ç³»ç»Ÿâ€ä¸ºä½•ä¼šå‘½åä¸ºä¼™ä¼´ç³»ç»Ÿï¼Œæ²¡æ„Ÿè§‰åˆ°æœ‰â€œä¼™ä¼´â€çš„æ„Ÿè§‰","like_count":15,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450712,"discussion_content":"ä¸€æ•´ä¸ªä¼šè®®å®¤ï¼Œåˆ’åˆ†ä¸ºä¸¤ä¸ª1/2ï¼Œå†åˆ’åˆ†ä¸ºå››ä¸ª1/4ï¼Œä¸¤ä¸ª1/4å°±æ˜¯ä¼™ä¼´å‘€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567610379,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1472051,"avatar":"https://static001.geekbang.org/account/avatar/00/16/76/33/928ffd21.jpg","nickname":"AlexS","note":"","ucode":"3DA81A613CE645","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":334389,"discussion_content":"æ¥æ¥æ¥ï¼Œç»è¿‡ä¸€æ®µæ—¶é—´çš„å­¦ä¹ ï¼Œæˆ‘æœ‰æ˜ç¡®çš„ç­”æ¡ˆäº†ã€‚å®ƒä¸ºä»€ä¹ˆå«ä¼™ä¼´ç³»ç»Ÿï¼Œä¼™ä¼´ä½“ç°åœ¨å“ªã€‚\nä¸€ä¸ªpage blockå®ƒçš„buddyæ˜¯å”¯ä¸€çš„ï¼Œå®ƒåªèƒ½å’Œå®ƒçš„å”¯ä¸€buddyç»„åˆæˆå¤§ä¸€çº§çš„page blockã€‚\n\nTwo blocks are buddies if:\nâ€“ They have the same size, e.g. b,\nâ€“ They are adjacent to each other,\nâ€“ the physical address of the first page of the first block is a multiple of 2 x b x PAGE_SIZE. \nè¿™é‡Œè€ƒè™‘çš„æ˜¯ä¸¤ä¸ªbuddyåˆæˆçš„æ–°blockçš„é¦–åœ°å€è¦æ˜¯è¿™ä¸ªæ–°blockçš„sizeçš„æ•´æ•°å€ã€‚\n\nA split block can only be merged with its unique buddy blockï¼š\nä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæ¯ä¸ªpage blockçš„é¦–é¡µçš„èµ·å§‹ç‰©ç†åœ°å€ä¸€å®šè¦æ˜¯page block sizeçš„æ•´æ•°å€ã€‚\næ¯”å¦‚ä¸€ä¸ªpage blockæ˜¯16ä¸ªé¡µï¼Œé‚£ä¹ˆè¿™ä¸ªpage blockçš„èµ·å§‹ç‰©ç†åœ°å€ä¸€å®šæ˜¯16*PAGE_SIZEçš„æ•´æ•°å€ã€‚\næ¯”å¦‚ order ä¸º0çš„ page 0,1,2,3ã€‚0å’Œ1æ˜¯buddyï¼Œ1å’Œ2å°±ä¸èƒ½æ˜¯buddyã€‚å› ä¸º1å’Œ2ä¸èƒ½mergeæˆ order ä¸º1çš„ page blockï¼Œå› ä¸ºèµ·å§‹åœ°å€1ä¸æ˜¯block size 2çš„æ•´æ•°å€ã€‚\n\nä¸‹é¢ç»™å‡ºå¦‚ä½•æ‰¾åˆ°ä¸€ä¸ªpage blockçš„å”¯ä¸€buddy\nTo find the buddy block of a page block __find_buddy_pfn(page_pfn, order)     (mm/internal.h) \n\n * 1) Any buddy B1 will have an order O twin B2 which satisfies\n * the following equation:\n *     B2 = B1 ^ (1 << O)\n * For example, if the starting buddy (buddy2) is #8 its order\n * 1 buddy is #10:\n *     B2 = 8 ^ (1 << 1) = 8 ^ 2 = 10\n * åŒæ ·çš„è‹¥æ˜¯B1æ˜¯10,å®ƒçš„order 1 buddy B2å°±æ˜¯8.\n *     B2 = 10 ^ (1 << 1) = 10 ^ 2 = 8\n","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1607834301,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1472051,"avatar":"https://static001.geekbang.org/account/avatar/00/16/76/33/928ffd21.jpg","nickname":"AlexS","note":"","ucode":"3DA81A613CE645","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":330479,"discussion_content":"æˆ‘ç†è§£åˆ°çš„æ˜¯ï¼Œè¦128é¡µï¼Œ128é¡µçš„areaæ²¡ç©ºé—²äº†ï¼Œå°±æ‰¾256é¡µè¦ä¸€ä¸ª128é¡µã€‚è¿™æ ·å°±å¤šäº†ä¸ª128é¡µã€‚è¿™ä¸ªå¤šå‡ºæ¥çš„128é¡µï¼Œæ­£å¥½åŠ å…¥åˆ°128é¡µçš„areaé‡Œã€‚ä½ çœ‹æ˜¯ä¸æ˜¯â€œä¼™ä¼´â€ï¼Œæˆ‘ä¸å¤Ÿæ‰¾ä½ è¦ï¼Œå¤šå‡ºæ¥çš„æˆ‘æ¥å¸®ä½ ç®¡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606633733,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1002005,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4a/15/106eaaa8.jpg","nickname":"stackWarn","note":"","ucode":"89672E452DEBA5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288763,"discussion_content":"åœ¨åˆ†é…çš„è¿‡ç¨‹ä¸­ å¦‚æœä¸¤ä¸ª128ç›¸é‚»å¯ä»¥å‡‘æˆ256å°±æ˜¯ä¼™ä¼´äº†ï¼Œæ”¾åˆ°256çš„listä¸­","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593864742,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130656,"user_name":"å¥”è·‘çš„ç ä»”","can_delete":false,"product_type":"c1","uid":1609871,"ip_address":"","ucode":"AB3B02B07B8B8C","user_header":"https://static001.geekbang.org/account/avatar/00/18/90/8f/9c691a5f.jpg","comment_is_top":false,"comment_ctime":1567502555,"is_pvip":false,"replies":[{"id":"49001","content":"å°äºå°±æ²¡æœ‰äº†ã€‚å¦‚æœå°äºæ²¡æœ‰ZONE_HIGHMEMçš„è¯ï¼Œå°±ä¼šé€€è€Œæ±‚å…¶æ¬¡ï¼Œåœ¨ç›´æ¥æ˜ å°„åŒºåˆ†é…ï¼Œå¦‚æœåˆ†é…ä¸åˆ°ï¼Œå°±è¯´æ˜æ²¡æœ‰å†…å­˜äº†ã€‚64ä½å°±æ˜¯ç›´æ¥æ˜ å°„åŒºåˆ†é…ã€‚","user_name":"ä½œè€…å›å¤","comment_id":130656,"uid":"1001590","ip_address":"","utype":1,"ctime":1567576581,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":1,"race_medal":0,"score":"35927240923","product_id":100024701,"comment_content":"è€å¸ˆï¼Œå¯¹äº32bitçš„ç³»ç»Ÿï¼Œå¦‚æœç‰©ç†å†…å­˜å¤§å°å°äº896Mï¼Œé‚£ç‰©ç†å†…å­˜åŒºåŸŸè¿˜æœ‰ZONE_HIGHMEMå—ï¼Ÿæ‚¨çš„ç¬¬26èŠ‚è¯¾è®²åˆ°å†…æ ¸å¤„ç†åŒ¿åé¡µçš„ç¼ºé¡µä¸­æ–­å¤„ç†æ—¶ï¼Œä¼šè°ƒç”¨alloc_zeroed_user_highpage_movableå»é«˜ç«¯å†…å­˜åŒºåŸŸåˆ†é…ç‰©ç†é¡µï¼Œå¯¹äº32bitç³»ç»Ÿï¼Œç‰©ç†å†…å­˜å°äº896Mçš„æƒ…å†µï¼Œè¿™æ—¶å€™ä¼™ä¼´ç³»ç»Ÿå»å“ªé‡Œåˆ†é…ç‰©ç†é¡µå‘¢ï¼Ÿå¯¹äº64bitç³»ç»Ÿï¼Œæ²¡æœ‰é«˜ç«¯å†…å­˜åŒºåŸŸï¼Œé‚£ä¸Šè¿°å‡½æ•°å»å“ªé‡Œåˆ†é…é«˜ç«¯å†…å­˜çš„ç‰©ç†é¡µå‘¢ï¼Ÿ","like_count":8,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466051,"discussion_content":"å°äºå°±æ²¡æœ‰äº†ã€‚å¦‚æœå°äºæ²¡æœ‰ZONE_HIGHMEMçš„è¯ï¼Œå°±ä¼šé€€è€Œæ±‚å…¶æ¬¡ï¼Œåœ¨ç›´æ¥æ˜ å°„åŒºåˆ†é…ï¼Œå¦‚æœåˆ†é…ä¸åˆ°ï¼Œå°±è¯´æ˜æ²¡æœ‰å†…å­˜äº†ã€‚64ä½å°±æ˜¯ç›´æ¥æ˜ å°„åŒºåˆ†é…ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567576581,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":155348,"user_name":"czh","can_delete":false,"product_type":"c1","uid":1159078,"ip_address":"","ucode":"649FE5C9269D69","user_header":"https://static001.geekbang.org/account/avatar/00/11/af/a6/3f15ba2f.jpg","comment_is_top":false,"comment_ctime":1574680599,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18754549783","product_id":100024701,"comment_content":"å…³é”®è¯ï¼šç‰©ç†å†…å­˜çš„ç»„ç»‡+åˆ†é…æœºåˆ¶ã€‚å›å¿†æ–‡ä¸­çš„å›¾","like_count":4},{"had_liked":false,"id":119482,"user_name":"æ±Ÿå±±æœª","can_delete":false,"product_type":"c1","uid":1090196,"ip_address":"","ucode":"5293DD9482717F","user_header":"https://static001.geekbang.org/account/avatar/00/10/a2/94/ae0a60d8.jpg","comment_is_top":false,"comment_ctime":1564618120,"is_pvip":false,"replies":[{"id":"46382","content":"å“ˆå“ˆï¼Œä»¥åå…ˆçœ‹æœ€åçš„æ€»ç»“å›¾ã€‚","user_name":"ä½œè€…å›å¤","comment_id":119482,"uid":"1001590","ip_address":"","utype":1,"ctime":1566297848,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":1,"race_medal":0,"score":"18744487304","product_id":100024701,"comment_content":"ä¸€è¾¹è¯»ä¸€è¾¹åœ¨è„‘æµ·æ„æƒ³ç»“æ„å…³ç³»å›¾ï¼ŒåŠå¤©ä¸å¾—è¦é¢†ã€‚çœ‹åˆ°æœ€åè¿™å¼ å›¾æ‰æç„¶å¤§æ‚Ÿã€‚è‰¾ç›ï¼Œä»¥åå…ˆçœ‹æœ€åè¿™å¼ å›¾ï¼Œå°‘åˆ†é…ä¸€ç‚¹è„‘ç»†èƒäº†","like_count":4,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":460920,"discussion_content":"å“ˆå“ˆï¼Œä»¥åå…ˆçœ‹æœ€åçš„æ€»ç»“å›¾ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566297848,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":267582,"user_name":"AlexS","can_delete":false,"product_type":"c1","uid":1472051,"ip_address":"","ucode":"3DA81A613CE645","user_header":"https://static001.geekbang.org/account/avatar/00/16/76/33/928ffd21.jpg","comment_is_top":false,"comment_ctime":1607834327,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14492736215","product_id":100024701,"comment_content":"æ¥æ¥æ¥ï¼Œç»è¿‡ä¸€æ®µæ—¶é—´çš„å­¦ä¹ ï¼Œæˆ‘æœ‰æ˜ç¡®çš„ç­”æ¡ˆäº†ã€‚<br>å®ƒä¸ºä»€ä¹ˆå«&quot;ä¼™ä¼´ç³»ç»Ÿ&quot;ï¼Œ&quot;ä¼™ä¼´&quot;ä½“ç°åœ¨å“ªã€‚<br>ä¸€ä¸ªpage blockå®ƒçš„buddyæ˜¯å”¯ä¸€çš„ï¼Œå®ƒåªèƒ½å’Œå®ƒçš„å”¯ä¸€buddyç»„åˆæˆå¤§ä¸€çº§çš„page blockã€‚<br><br>Two blocks are buddies if:<br>â€“ They have the same size, e.g. b,<br>â€“ They are adjacent to each other,<br>â€“ the physical address of the first page of the first block is a multiple of 2 x b x PAGE_SIZE. <br>è¿™é‡Œè€ƒè™‘çš„æ˜¯ä¸¤ä¸ªbuddyåˆæˆçš„æ–°blockçš„é¦–åœ°å€è¦æ˜¯è¿™ä¸ªæ–°blockçš„sizeçš„æ•´æ•°å€ã€‚<br><br>A split block can only be merged with its unique buddy blockï¼š<br>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæ¯ä¸ªpage blockçš„é¦–é¡µçš„èµ·å§‹ç‰©ç†åœ°å€ä¸€å®šè¦æ˜¯page block sizeçš„æ•´æ•°å€ã€‚<br>æ¯”å¦‚ä¸€ä¸ªpage blockæ˜¯16ä¸ªé¡µï¼Œé‚£ä¹ˆè¿™ä¸ªpage blockçš„èµ·å§‹ç‰©ç†åœ°å€ä¸€å®šæ˜¯16*PAGE_SIZEçš„æ•´æ•°å€ã€‚<br>æ¯”å¦‚ order ä¸º0çš„ page 0,1,2,3ã€‚0å’Œ1æ˜¯buddyï¼Œ1å’Œ2å°±ä¸èƒ½æ˜¯buddyã€‚å› ä¸º1å’Œ2ä¸èƒ½mergeæˆ order ä¸º1çš„ page blockï¼Œå› ä¸ºèµ·å§‹åœ°å€1ä¸æ˜¯block size 2çš„æ•´æ•°å€ã€‚<br><br>ä¸‹é¢ç»™å‡ºå¦‚ä½•æ‰¾åˆ°ä¸€ä¸ªpage blockçš„å”¯ä¸€buddy<br>To find the buddy block of a page block __find_buddy_pfn(page_pfn, order)     (mm&#47;internal.h) <br><br> * 1) Any buddy B1 will have an order O twin B2 which satisfies<br> * the following equation:<br> *     B2 = B1 ^ (1 &lt;&lt; O)<br> * For example, if the starting buddy (buddy2) is #8 its order<br> * 1 buddy is #10:<br> *     B2 = 8 ^ (1 &lt;&lt; 1) = 8 ^ 2 = 10<br> * åŒæ ·çš„è‹¥æ˜¯B1æ˜¯10,å®ƒçš„order 1 buddy B2å°±æ˜¯8.<br> *     B2 = 10 ^ (1 &lt;&lt; 1) = 10 ^ 2 = 8<br>","like_count":3},{"had_liked":false,"id":113153,"user_name":"oldman","can_delete":false,"product_type":"c1","uid":1133711,"ip_address":"","ucode":"6BACE2832B4429","user_header":"https://static001.geekbang.org/account/avatar/00/11/4c/8f/a90b3969.jpg","comment_is_top":false,"comment_ctime":1562903966,"is_pvip":false,"replies":[{"id":"46678","content":"è¿™æ˜¯ç‰©ç†å†…å­˜å‘€ã€‚åº”ç”¨ç¨‹åºæ“ä½œçš„æ˜¯è™šæ‹Ÿå†…å­˜å‘€ï¼Œè™šæ‹Ÿå†…å­˜å¤§äº†å»äº†ã€‚","user_name":"ä½œè€…å›å¤","comment_id":113153,"uid":"1001590","ip_address":"","utype":1,"ctime":1566379164,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":3,"race_medal":0,"score":"14447805854","product_id":100024701,"comment_content":"è€å¸ˆï¼Œæˆ‘è¿™é‡Œæœ‰ä¸€ä¸ªç–‘æƒ‘ï¼Œå†…å­˜çš„æœ€å¤§è¿ç»­é¡µæ˜¯1024ä¸ªé¡µï¼Œä¹Ÿå°±æ˜¯4MBçš„å¤§å°ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨ä¸€èˆ¬çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæ•°ç»„éƒ½æ˜¯ä¸€è¿ä¸²çš„å†…å­˜ï¼Œé‚£æˆ‘å¦‚æœè¦ç”³è¯·ä¸€ä¸ªå¤§äº4MBçš„æ•°ç»„å‘¢ï¼Œæ“ä½œç³»ç»Ÿä¼šæ€ä¹ˆæ ·æ¥åˆ†é…å‘¢ï¼ŒæœŸå¾…è€å¸ˆè§£æƒ‘ã€‚","like_count":3,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458080,"discussion_content":"è¿™æ˜¯ç‰©ç†å†…å­˜å‘€ã€‚åº”ç”¨ç¨‹åºæ“ä½œçš„æ˜¯è™šæ‹Ÿå†…å­˜å‘€ï¼Œè™šæ‹Ÿå†…å­˜å¤§äº†å»äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566379164,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1738119,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/85/87/727142bc.jpg","nickname":"MacBao","note":"","ucode":"8CF51C3688C8F6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":212457,"discussion_content":"64ä½ç¨‹åºè™šæ‹Ÿå†…å­˜å¾ˆå¤§ï¼Œä½†ä¸ºä»€ä¹ˆä¹Ÿæœ‰ç”³è¯·å¤±è´¥çš„æ—¶å€™å‘¢ï¼Ÿå°¤å…¶æ˜¯ç”³è¯·å¤§å—è¿ç»­å†…å­˜çš„æ—¶å€™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584973452,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2028811,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/f5/0b/73628618.jpg","nickname":"å…”å˜Ÿå˜Ÿ","note":"","ucode":"5A9042B4C7670C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1738119,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/85/87/727142bc.jpg","nickname":"MacBao","note":"","ucode":"8CF51C3688C8F6","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391180,"discussion_content":"æ˜ å°„åŒºå¢é•¿ä¸äº†äº† or ç‰©ç†å†…å­˜ä¸å¤Ÿäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630325141,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":212457,"ip_address":""},"score":391180,"extra":""}]}]},{"had_liked":false,"id":96631,"user_name":"LeonğŸ“·","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1558482412,"is_pvip":false,"replies":[{"id":"49278","content":"ä¹Ÿä¸æ˜¯ï¼Œå›æ”¶å†…å­˜çš„æ—¶å€™ï¼Œè¿˜åˆå¹¶å‘¢","user_name":"ä½œè€…å›å¤","comment_id":96631,"uid":"1001590","ip_address":"","utype":1,"ctime":1567609474,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":1,"race_medal":0,"score":"14443384300","product_id":100024701,"comment_content":"ä¼™ä¼´ç³»ç»Ÿçš„æ„æ€å°±æ˜¯åŠ«å¯Œæµè´«","like_count":3,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450942,"discussion_content":"ä¹Ÿä¸æ˜¯ï¼Œå›æ”¶å†…å­˜çš„æ—¶å€™ï¼Œè¿˜åˆå¹¶å‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567609474,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":174823,"user_name":"æ·¤ç™½","can_delete":false,"product_type":"c1","uid":1206503,"ip_address":"","ucode":"D1E65DC40DAF68","user_header":"https://static001.geekbang.org/account/avatar/00/12/68/e7/ee47d0e2.jpg","comment_is_top":false,"comment_ctime":1580402338,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10170336930","product_id":100024701,"comment_content":"é€šè¿‡æœ¬ç¯‡æ–‡ç« ï¼Œä¸»è¦å­¦ä¹ åˆ°çš„çŸ¥è¯†ç‚¹ï¼šåœ¨å½“å‰çš„ä¸»æµéè¿ç»­å†…å­˜æ¨¡å‹ NUMA ä¸­ï¼Œå°†å†…å­˜åˆ†æˆäº†ä¸‰å±‚ï¼ˆèŠ‚ç‚¹ -&gt; åŒºåŸŸ -&gt; é¡µï¼‰ï¼Œæ–¹ä¾¿äº†å¯¹å†…å­˜çš„ç®¡ç†ï¼›Linux ä¸­çš„ä¸€é¡µå¤§å°æ˜¯ 4 KBï¼Œå…¶å°†ç©ºé—²çš„é¡µåˆ†ç»„æˆäº† 11 ä¸ªé“¾è¡¨ï¼Œå½“æœ‰åˆ†é…å†…å­˜çš„éœ€æ±‚æ—¶ï¼Œä¼šä»é“¾è¡¨ï¼ˆå¤§äºç­‰äºåˆ†é…éœ€æ±‚ï¼ŒæŒæœ‰å¿«æœ€å°çš„é“¾è¡¨ï¼‰ä¸­æ‰¾å‡ºä¸€ä¸ªç©ºé—²çš„é¡µå—è¿›è¡Œåˆ†é…ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ç©ºé—²é¡µå—ï¼Œä¼šå»æ›´å¤§é¡µå—çš„é“¾è¡¨ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œæ‰¾åˆ°åè¿›è¡Œåˆ†å‰²ç­‰åç»­å¤„ç†ã€‚","like_count":2},{"had_liked":false,"id":96306,"user_name":"Linuxer","can_delete":false,"product_type":"c1","uid":1153978,"ip_address":"","ucode":"272D9D8089C3D6","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/ba/333b59e5.jpg","comment_is_top":false,"comment_ctime":1558397638,"is_pvip":false,"replies":[{"id":"49290","content":"å¤§å°ä¸º16ä¸ªé¡µæ¡†çš„å—,å…¶èµ·å§‹åœ°å€æ˜¯16*2^12çš„å€æ•°.","user_name":"ä½œè€…å›å¤","comment_id":96306,"uid":"1001590","ip_address":"","utype":1,"ctime":1567610103,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":2,"race_medal":0,"score":"10148332230","product_id":100024701,"comment_content":"æ¯ä¸ªé¡µå—çš„ç¬¬ä¸€ä¸ªé¡µçš„ç‰©ç†åœ°å€æ˜¯è¯¥é¡µå—å¤§å°çš„æ•´æ•°å€ã€‚æ€ä¹ˆç†è§£","like_count":2,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450825,"discussion_content":"å¤§å°ä¸º16ä¸ªé¡µæ¡†çš„å—,å…¶èµ·å§‹åœ°å€æ˜¯16*2^12çš„å€æ•°.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567610103,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1239296,"avatar":"https://static001.geekbang.org/account/avatar/00/12/e9/00/df4d1bab.jpg","nickname":"æˆ’æˆ’","note":"","ucode":"A017E1C7797484","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":243712,"discussion_content":"è¿™æ ·çš„è¯ï¼Œä¸åŒorderçš„å—åœ°å€å°±ç›¸å½“äºæ˜¯â€œå¹³å¦å†…å­˜æ¨¡å‹äº†â€ï¼Œä¸çŸ¥é“è¿™ä¹ˆç†è§£å¯¹ä¸å¯¹ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587557938,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":339444,"user_name":"ç‹äº­äº­","can_delete":false,"product_type":"c1","uid":2399333,"ip_address":"","ucode":"8A1382E358220A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJjXbIia8iavTicdlGsfuTY1aVqbhN6aCdTib0hrDWYy5U7mdN0lTN9MGfKhvicwjlG0MRLugBAHFibibJ4A/132","comment_is_top":false,"comment_ctime":1648105976,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5943073272","product_id":100024701,"comment_content":"free_areaçš„ç®¡ç†å¾ˆåƒåŒ…é‡Œçš„é’±ï¼ŒåŒ…é‡Œä¸€äº›1å…ƒã€2å…ƒã€4å…ƒã€8...2çš„næ¬¡æ–¹å…ƒé¢é¢çš„é’±ã€‚æ¯æ¬¡åˆ†é…å†…å­˜ï¼Œå°±æ˜¯ä»˜é’±å’Œæ‰¾å›é›¶é’±çš„è¿‡ç¨‹ã€‚","like_count":1},{"had_liked":false,"id":289213,"user_name":"æ¸£æ¸£","can_delete":false,"product_type":"c1","uid":2430777,"ip_address":"","ucode":"0384A5859A9D39","user_header":"https://static001.geekbang.org/account/avatar/00/25/17/39/07243e20.jpg","comment_is_top":false,"comment_ctime":1618918388,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5913885684","product_id":100024701,"comment_content":"æœ‰ä¸ªé—®é¢˜è¯·æ•™ä¸€ä¸‹ï¼Œä¸€ä¸ªèŠ‚ç‚¹çš„ç‰©ç†å†…å­˜æ˜¯æ€ä¹ˆåˆ’åˆ†ä¸ºDMAï¼ŒDMA32ï¼ŒNORMALï¼ŒHIGHMEMï¼ŒMOVABLEåŒºåŸŸçš„ï¼Œæ˜¯å’Œè™šæ‹Ÿå†…å­˜åˆ’åˆ†ä¸€æ ·æŒ‰ç…§åœ°å€å’Œå¤§å°åˆ’åˆ†çš„å—ï¼Ÿè¿˜æœ‰æ¯ä¸ªåŒºåŸŸåˆæ˜¯æ€ä¹ˆæŒ‰ç…§å¯ç§»åŠ¨æ€§åˆ†ç»„åˆ’åˆ†ä¸ºunmovableï¼Œmovableï¼Œreclaimableçš„ï¼Œä¹Ÿæ˜¯æŒ‰ç…§åœ°å€å’Œå¤§å°åˆ’åˆ†çš„å—ï¼Ÿè¿™ä¸ªç‰©ç†å†…å­˜çš„åˆ’åˆ†å’Œè™šæ‹Ÿå†…å­˜çš„åˆ’åˆ†æœ‰ä»€ä¹ˆè”ç³»å—ï¼Ÿ","like_count":1},{"had_liked":false,"id":245010,"user_name":"Geek_37ea99","can_delete":false,"product_type":"c1","uid":2150142,"ip_address":"","ucode":"4CB85044FB00F6","user_header":"","comment_is_top":false,"comment_ctime":1598780705,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5893748001","product_id":100024701,"comment_content":"æƒ³é—®ä¸€ä¸‹ï¼Œå¦‚æœæ˜¯numaç»“æ„ï¼Œkernelçš„ä»£ç æ®µåœ¨å“ªä¸ªcpuèŠ‚ç‚¹çš„å†…å­˜ä¸Šï¼Ÿè¿˜æ˜¯æ¯ä¸ªcpuèŠ‚ç‚¹ä¸Šéƒ½æœ‰ä¸€ä»½copyï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1066409,"avatar":"https://static001.geekbang.org/account/avatar/00/10/45/a9/3d48d6a2.jpg","nickname":"Lorry","note":"","ucode":"BD4754D0F1D786","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":390444,"discussion_content":"æˆ‘è§‰å¾—å¦‚æœæ˜¯å¯åŠ¨çš„è¯ï¼Œå“ªä¸ªCPUåˆ†é…æ‰§è¡Œå¯åŠ¨æŒ‡ä»¤ï¼Œå°±åŠ è½½åˆ°é‚£ä¸ªCPUé‡Œé¢å»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629848123,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":223169,"user_name":"æ³¨æ„åŠ›$","can_delete":false,"product_type":"c1","uid":1142316,"ip_address":"","ucode":"7FB3399A1EAB72","user_header":"https://static001.geekbang.org/account/avatar/00/11/6e/2c/e2f3cfc0.jpg","comment_is_top":false,"comment_ctime":1591014865,"is_pvip":false,"replies":[{"id":"83010","content":"è·¨èŠ‚ç‚¹é€Ÿåº¦æ…¢","user_name":"ä½œè€…å›å¤","comment_id":223169,"uid":"1001590","ip_address":"","utype":1,"ctime":1591753293,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":1,"race_medal":1,"score":"5885982161","product_id":100024701,"comment_content":"è€å¸ˆï¼Œå¥½å¤šæ•°æ®å®‰è£…æ—¶éƒ½å»ºè®®å…³é—­numaï¼Œä¸»è¦æ˜¯è§‰å¾—numaå“ªé‡Œä¸å¥½å‘¢","like_count":1,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":497036,"discussion_content":"è·¨èŠ‚ç‚¹é€Ÿåº¦æ…¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591753293,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":160852,"user_name":"djfhchdh","can_delete":false,"product_type":"c1","uid":1484184,"ip_address":"","ucode":"E71D75328CE398","user_header":"https://static001.geekbang.org/account/avatar/00/16/a5/98/a65ff31a.jpg","comment_is_top":false,"comment_ctime":1576047170,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5871014466","product_id":100024701,"comment_content":"&quot;ZONE_NORMAL æ˜¯ç›´æ¥æ˜ å°„åŒºï¼Œå°±æ˜¯ä¸Šä¸€èŠ‚è®²çš„ï¼Œä»ç‰©ç†å†…å­˜åˆ°è™šæ‹Ÿå†…å­˜çš„å†…æ ¸åŒºåŸŸï¼Œé€šè¿‡åŠ ä¸Šä¸€ä¸ªå¸¸é‡ç›´æ¥æ˜ å°„ã€‚&quot;  è¿™é‡Œè®²çš„æœ‰é—®é¢˜ï¼ŒZONE_NORMALå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„å¯æ˜ å°„çš„ç‰©ç†å†…å­˜åŒºåŸŸï¼Œè€Œä¸æ˜¯ç›´æ¥æ˜ å°„åŒº","like_count":1},{"had_liked":false,"id":135258,"user_name":"williamcai","can_delete":false,"product_type":"c1","uid":1158294,"ip_address":"","ucode":"B158F52C2D39BC","user_header":"https://static001.geekbang.org/account/avatar/00/11/ac/96/46b13896.jpg","comment_is_top":false,"comment_ctime":1569109913,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5864077209","product_id":100024701,"comment_content":"è€å¸ˆï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„å¯ç”¨å†…å­˜çš„å®¹é‡ç­‰äºä¼™ä¼´ç³»ç»Ÿå¯ç”¨ç©ºé—´ä¹‹å’Œå—","like_count":1},{"had_liked":false,"id":128856,"user_name":"å¥”è·‘çš„ç ä»”","can_delete":false,"product_type":"c1","uid":1609871,"ip_address":"","ucode":"AB3B02B07B8B8C","user_header":"https://static001.geekbang.org/account/avatar/00/18/90/8f/9c691a5f.jpg","comment_is_top":false,"comment_ctime":1566977264,"is_pvip":false,"replies":[{"id":"48752","content":"è¿™ä¸‰ç§æ¨¡å‹çš„åŒºåˆ«æ˜¯pageä¸æ˜¯è¿ç»­çš„ï¼Œå¯¹äºzoneæ²¡æœ‰å½±å“","user_name":"ä½œè€…å›å¤","comment_id":128856,"uid":"1001590","ip_address":"","utype":1,"ctime":1567494004,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":1,"race_medal":0,"score":"5861944560","product_id":100024701,"comment_content":"æ‚¨å¥½ï¼Œä¹‹å‰çœ‹è¿‡ä¸€ç¯‡æ–‡ç« è®²è§£Linuxå†…å­˜ç‰©ç†æ¨¡å‹ï¼Œé‡Œé¢è¯´åˆ°äº†ä¸‰ç§ç‰©ç†æ¨¡å‹:å¹³å¦å‹ã€éè¿ç»­å‹ã€ç¨€ç–æ€§ï¼Œçœ‹å®Œæœ¬èŠ‚åï¼Œå‘ç°åŸºäºzoneçš„buddyç³»ç»Ÿå’Œä¸Šé¢è®²è§£çš„å‡ ç§æ¨¡å‹çš„å…³ç³»ï¼Œç†ä¸æ¸…äº†ã€‚ä¸çŸ¥é“ï¼Œä¸‰ç§ç‰©ç†æ¨¡å‹æ˜¯ä¸æ˜¯ä¹Ÿæ˜¯åŸºäºzoneçš„ä¼™ä¼´ç³»ç»Ÿå‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465137,"discussion_content":"è¿™ä¸‰ç§æ¨¡å‹çš„åŒºåˆ«æ˜¯pageä¸æ˜¯è¿ç»­çš„ï¼Œå¯¹äºzoneæ²¡æœ‰å½±å“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567494004,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96311,"user_name":"Linuxer","can_delete":false,"product_type":"c1","uid":1153978,"ip_address":"","ucode":"272D9D8089C3D6","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/ba/333b59e5.jpg","comment_is_top":false,"comment_ctime":1558397948,"is_pvip":false,"replies":[{"id":"49289","content":"å…³é—­å°±smpäº†","user_name":"ä½œè€…å›å¤","comment_id":96311,"uid":"1001590","ip_address":"","utype":1,"ctime":1567609743,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":1,"race_medal":0,"score":"5853365244","product_id":100024701,"comment_content":"æœ‰äº›åº”ç”¨ä¼šè¦æ±‚å…³é—­numaé‚£ä¹ˆè¿™é‡Œnumanodeå°±ä¸º1å—ï¼Ÿè¿™æ—¶å€™æ˜¯æ‰€æœ‰CPUå…±ç”¨ä¸€ä¸ªpglist?","like_count":1,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450826,"discussion_content":"å…³é—­å°±smpäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567609743,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360802,"user_name":"â”‚ï¼Sk","can_delete":false,"product_type":"c1","uid":2453415,"ip_address":"åŒ—äº¬","ucode":"A2EEB2E9585A77","user_header":"https://static001.geekbang.org/account/avatar/00/25/6f/a7/565214bc.jpg","comment_is_top":false,"comment_ctime":1666861907,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1666861907","product_id":100024701,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œ<br><br>â€œZONE_NORMAL æ˜¯ç›´æ¥æ˜ å°„åŒºï¼Œå°±æ˜¯ä¸Šä¸€èŠ‚è®²çš„ï¼Œä»ç‰©ç†å†…å­˜åˆ°è™šæ‹Ÿå†…å­˜çš„å†…æ ¸åŒºåŸŸï¼Œé€šè¿‡åŠ ä¸Šä¸€ä¸ªå¸¸é‡ç›´æ¥æ˜ å°„â€ <br><br>è¯·é—®è¿™ç§è¯´æ³•æ˜¯å¦æœ‰è¯¯ï¼ŒZONE_NORMAL åº”è¯¥ä¸ä»…ä»…åŒ…å«è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„å†…æ ¸éƒ¨åˆ†ï¼›åº”è¯¥ä¹ŸåŒ…å«ç”¨æˆ·æ€å¯åˆ†é…çš„ç‰©ç†å†…å­˜é¡µå§ï¼Ÿ","like_count":0},{"had_liked":false,"id":360687,"user_name":"ä¸€çœå¾èº«","can_delete":false,"product_type":"c1","uid":1676631,"ip_address":"åŒ—äº¬","ucode":"D902357160BBD9","user_header":"https://static001.geekbang.org/account/avatar/00/19/95/57/a2991536.jpg","comment_is_top":false,"comment_ctime":1666761171,"is_pvip":true,"discussion_count":0,"race_medal":2,"score":"1666761171","product_id":100024701,"comment_content":"æœ¬èŠ‚æ”¶è·:<br>  å°ç³»ç»Ÿé€šå¸¸æ˜¯UMA.<br>  å¤§ç³»ç»Ÿæ‰ä¼šè€ƒè™‘NUMA.<br>  é’ˆå¯¹ä¸é€šåœºæ™¯UMAå’ŒNUMAå„æœ‰ä¼˜åŠ£.<br> zone---&gt;page(å‘ä¸‹slab,å‘ä¸Špageå—,éƒ½æ˜¯ä¸ºäº†åˆç†è€Œæ–¹ä¾¿åœ°åˆ†é…å’Œä½¿ç”¨å†…å­˜)<br> ps:ä¼™ä¼´ç³»ç»Ÿå°†å¤§é‡çš„é¡µç»„ç»‡æˆä¸é€šå¤§å°çš„é¡µå—,æ ¹æ®éœ€è¦å¿«é€Ÿåˆ†é…æ‹†åˆ†åˆå¹¶,ç»´æŠ¤ç›¸å¯¹æ¯”è¾ƒæ–¹ä¾¿.","like_count":0},{"had_liked":false,"id":342055,"user_name":"Geek_8d3e0a","can_delete":false,"product_type":"c1","uid":2743620,"ip_address":"","ucode":"D387929EE2B37B","user_header":"","comment_is_top":false,"comment_ctime":1649993141,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1649993141","product_id":100024701,"comment_content":"ä»éš”å£æ“ä½œç³»ç»Ÿ45è®²æ¥çš„ï¼Œæ›´åŠ ç†è§£äº†ï¼è°¢è°¢è€å¸ˆï¼Œæˆ‘ä¸€ä¸ªjavaçš„å­¦ç”Ÿä¹Ÿæ¥ææå†…æ ¸è®©è‡ªå·±ç¡¬æ ¸ï¼","like_count":0},{"had_liked":false,"id":330603,"user_name":"Geek_2ed874","can_delete":false,"product_type":"c1","uid":2887651,"ip_address":"","ucode":"E01E6318676727","user_header":"","comment_is_top":false,"comment_ctime":1642065322,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1642065322","product_id":100024701,"comment_content":"æ¯ä¸€ä¸ª zoneï¼Œéƒ½æœ‰ä¼™ä¼´ç³»ç»Ÿç»´æŠ¤çš„å„ç§å¤§å°çš„é˜Ÿåˆ—ï¼Œå°±åƒä¸Šé¢ä¼™ä¼´ç³»ç»ŸåŸç†é‡Œè®²çš„é‚£æ ·ã€‚<br>è¿™ä¸€å¥ä¸å¤ªæ‡‚ï¼Œæ¯ä¸ªzoneé‡Œé¢ä¸æ˜¯ä¸€ä¸ªæ•°ç»„å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":320569,"user_name":"hhhh","can_delete":false,"product_type":"c1","uid":1256101,"ip_address":"","ucode":"9E87017424B382","user_header":"https://static001.geekbang.org/account/avatar/00/13/2a/a5/625c0a2e.jpg","comment_is_top":false,"comment_ctime":1636382530,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1636382530","product_id":100024701,"comment_content":"66666666è§£å†³äº†å¤šå¹´çš„å›°æƒ‘","like_count":0},{"had_liked":false,"id":268332,"user_name":"å°j","can_delete":false,"product_type":"c1","uid":1002717,"ip_address":"","ucode":"9A51A83F149422","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4c/dd/6bd788ca.jpg","comment_is_top":false,"comment_ctime":1608143021,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608143021","product_id":100024701,"comment_content":"æ¯ä¸ª nodeï¼ˆæˆ–è€…è¯´æ˜¯ pglist_data) éƒ½æœ‰zone_dma çš„åˆ’åˆ†ã€‚é‚£ä¹ˆæ¯ä¸ª node é‡Œçš„ zone_dma åˆ†åˆ«å å¤šå°‘å…†ï¼Ÿæ®è¯´ zone_dma æ€»å…±æ‰ 16MBã€‚æ˜¯æ¯ä¸ª nodeï¼ˆpglist_data)é‡Œçš„ zone_dma æ˜¯ 4MBä¹ˆï¼Ÿ","like_count":0},{"had_liked":false,"id":250838,"user_name":"èµµå›½è¾‰","can_delete":false,"product_type":"c1","uid":1166280,"ip_address":"","ucode":"390196BD3082B8","user_header":"https://static001.geekbang.org/account/avatar/00/11/cb/c8/ff9f3ffb.jpg","comment_is_top":false,"comment_ctime":1601258520,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601258520","product_id":100024701,"comment_content":"è€å¸ˆï¼Œpglist_dataå’Œzoneä¸­åˆ†åˆ«æœ‰node_spanned_pages,node_present_pageså’Œspanned_pages, present_pagesï¼Œè¿™ä¸ªåœ°æ–¹ä¸€ç›´ä¸å¤ªç†è§£ã€‚è¿™å‡ ä¸ªå­—æ®µæ˜¯ä¸æ˜¯æè¿°çš„æ˜¯åˆ†é…å‡ºå»çš„ç‰©ç†å†…å­˜ï¼Œæ²¡æœ‰åˆ†é…å‡ºå»çš„ä¸è®¡ç®—åœ¨å†…ï¼Ÿå¸Œæœ›è€å¸ˆå¸®å¿™è§£ç­”ä¸€ä¸‹","like_count":0},{"had_liked":false,"id":239036,"user_name":"Ironman","can_delete":false,"product_type":"c1","uid":1995068,"ip_address":"","ucode":"66F3226ACD8570","user_header":"https://static001.geekbang.org/account/avatar/00/1e/71/3c/119f00a9.jpg","comment_is_top":false,"comment_ctime":1596419974,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596419974","product_id":100024701,"comment_content":"è¿™å‡ ä¸ªå›¾ç”»çš„çœŸå¥½ã€‚","like_count":0},{"had_liked":false,"id":220344,"user_name":"é¥­ç²’","can_delete":false,"product_type":"c1","uid":1153455,"ip_address":"","ucode":"4C3220B0D43997","user_header":"https://static001.geekbang.org/account/avatar/00/11/99/af/d29273e2.jpg","comment_is_top":false,"comment_ctime":1590224881,"is_pvip":false,"replies":[{"id":"83073","content":"å‰å®³","user_name":"ä½œè€…å›å¤","comment_id":220344,"uid":"1001590","ip_address":"","utype":1,"ctime":1591785403,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":1,"race_medal":0,"score":"1590224881","product_id":100024701,"comment_content":"çœ‹å¤šå‡ éç»ˆäºç¨å¾®æ˜ç™½ç‚¹äº†","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":496124,"discussion_content":"å‰å®³","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591785403,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":206223,"user_name":"æ²é£","can_delete":false,"product_type":"c1","uid":1106568,"ip_address":"","ucode":"69A096430BC40B","user_header":"https://static001.geekbang.org/account/avatar/00/10/e2/88/d728823e.jpg","comment_is_top":false,"comment_ctime":1586825632,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586825632","product_id":100024701,"comment_content":"è€å¸ˆï¼Œæ˜¯æ¯ä¸€ä¸ªåŒºåŸŸéƒ½æœ‰ä¸€ä¸ªfree_areaç»“æ„ï¼Ÿè¿˜æ˜¯æ‰€æœ‰åŒºåŸŸéƒ½æŒ‡å‘åŒä¸€ä¸ªfree_areaç»“æ„ï¼Ÿ","like_count":0},{"had_liked":false,"id":201517,"user_name":"honnkyou","can_delete":false,"product_type":"c1","uid":1026608,"ip_address":"","ucode":"FD5EC4120EE803","user_header":"https://static001.geekbang.org/account/avatar/00/0f/aa/30/acc91f01.jpg","comment_is_top":false,"comment_ctime":1585797925,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1585797925","product_id":100024701,"comment_content":"&quot;ä»å½“å‰çš„ orderï¼Œä¹Ÿå³æŒ‡æ•°å¼€å§‹ï¼Œåœ¨ä¼™ä¼´ç³»ç»Ÿçš„ free_area æ‰¾ 2^order å¤§å°çš„é¡µå—ã€‚å¦‚æœé“¾è¡¨çš„ç¬¬ä¸€ä¸ªä¸ä¸ºç©ºï¼Œå°±æ‰¾åˆ°äº†&quot;<br>è€å¸ˆè¿™å¥ä¸­ä¸ºä»€ä¹ˆè¯´ç¬¬ä¸€ä¸ªä¸ä¸ºç©ºå°±æ‰¾åˆ°äº†å‘¢ï¼Ÿä¸æ˜¯å¾ˆæ˜ç™½ã€‚","like_count":0,"discussions":[{"author":{"id":1000550,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/44/66/95976d10.jpg","nickname":"ä¸€è·¯å‘å‰","note":"","ucode":"853B90DF308425","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":298328,"discussion_content":"é“¾è¡¨é‡Œè¡¨ç¤ºç©ºé—²é¡µå—ï¼Œä¸ä¸ºç©ºå°±æ˜¯æœ‰å¯ç”¨çš„å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597245536,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":149083,"user_name":"extraterrestrialï¼ï¼","can_delete":false,"product_type":"c1","uid":1017987,"ip_address":"","ucode":"74AE07CA68F6B6","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/GDYkD2X7pXSKUSaUFC8u3TBPaakaibnOBV2NYDc2TNfb8Su9icFMwSod6iaQX5iaGU2gT6xkPuhXeWvY8KaVEZAYzg/132","comment_is_top":false,"comment_ctime":1573138827,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1573138827","product_id":100024701,"comment_content":"è¯·æ•™ä¸ªé—®é¢˜ï¼Œæ¯ä¸ªnumaèŠ‚ç‚¹æœ‰è‡ªå·±çš„å†…å­˜ï¼Œè¿™æ˜¯æŒ‡ç‰©ç†ä¸Šåˆ†å¼€çš„å†…å­˜ï¼Œè¿˜æ˜¯å®é™…ä¸Šå°±ä¸€ä¸ªå†…å­˜æ¡ï¼Œè¢«å¤šä¸ªæ ¸åˆ’åˆ†äº†ï¼Ÿ å¦‚æœæ˜¯ç‰©ç†ä¸Šçš„å¤šä¸ªå†…å­˜ï¼Œé‚£è¦æ€ä¹ˆç»™åˆ†å¸ƒåœ¨ä¸åŒèŠ‚ç‚¹çš„å†…å­˜ç»Ÿä¸€ç¼–é¡µå·ï¼Œä»¥åŠè¿™äº›å†…å­˜è¦æ€ä¹ˆåˆ†é…ç‰©ç†åœ°å€ï¼Ÿ","like_count":0},{"had_liked":false,"id":148673,"user_name":"æŸ³é•¿é’","can_delete":false,"product_type":"c1","uid":1716747,"ip_address":"","ucode":"3EA2B7BD5DBCAF","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/1pMbwZrAl5gVy4FictX9HiaDicYOjRI2E6flxrXLhLTcneF74TowWK6rJW6oKs9iakPl0dqHsWjav0TjK6vyEZTlJA/132","comment_is_top":false,"comment_ctime":1573047501,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1573047501","product_id":100024701,"comment_content":"è€å¸ˆã€æä¸ªé—®é¢˜ï¼šç¡¬ä»¶çš„ç¼“å­˜æ˜¯å¦å°±åœ¨å†…æ ¸æ€ä¸­","like_count":0},{"had_liked":false,"id":142663,"user_name":"å†¥ç‹æ˜Ÿ","can_delete":false,"product_type":"c1","uid":1311603,"ip_address":"","ucode":"CA43C381A69736","user_header":"https://static001.geekbang.org/account/avatar/00/14/03/73/38397da1.jpg","comment_is_top":false,"comment_ctime":1571450629,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1571450629","product_id":100024701,"comment_content":"è¿™é‡Œçš„ä¼™ä¼´ç³»ç»Ÿå’Œtcmallocçš„è¿è¡ŒåŸç†å¾ˆåƒï¼Œè¯·é—®tcmallocæ˜¯ä¸æ˜¯æ¨¡ä»¿å¹¶è¦†ç›–äº†è¿™é‡Œçš„ä¼™ä¼´ç³»ç»Ÿï¼Ÿå¦å¤–ï¼Œä¼™ä¼´ç³»ç»Ÿæ˜¯å®ç°åœ¨å†…æ ¸é‡Œé¢çš„ï¼Œè¿˜æ˜¯å®ç°åœ¨glibcåº“é‡Œï¼Ÿ","like_count":0},{"had_liked":false,"id":98608,"user_name":"Virtue","can_delete":false,"product_type":"c1","uid":1441187,"ip_address":"","ucode":"67B2D1AD06D714","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKbwJ55niaS6Df8BjvKK2ug2jFibCYhicz1lx7GDYOGs9MMgbHJmWoH1DXZAR5TKsESyUz1zsaw4Flew/132","comment_is_top":false,"comment_ctime":1559040041,"is_pvip":false,"replies":[{"id":"35371","content":"èµï¼Œå¸¸å¤ä¹ å¸¸æ–°","user_name":"ä½œè€…å›å¤","comment_id":98608,"uid":"1001590","ip_address":"","utype":1,"ctime":1559099988,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":1,"race_medal":0,"score":"1559040041","product_id":100024701,"comment_content":"å­¦äº†è¿›ç¨‹ç®¡ç†å’Œå†…å­˜ç®¡ç†ï¼Œåœ¨çœ‹å‰é¢å†…æ ¸åˆå§‹åŒ–çš„å†…å®¹ï¼Œæ„Ÿè§‰ç†è§£åˆæ·±åˆ»äº†ç‚¹ã€‚","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451753,"discussion_content":"èµï¼Œå¸¸å¤ä¹ å¸¸æ–°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559099988,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":97699,"user_name":"MARK","can_delete":false,"product_type":"c1","uid":1126900,"ip_address":"","ucode":"9F429C9C5FEE6A","user_header":"https://static001.geekbang.org/account/avatar/00/11/31/f4/467cf5d7.jpg","comment_is_top":false,"comment_ctime":1558750975,"is_pvip":false,"replies":[{"id":"35413","content":"ä¸€ä¸ªæ˜¯CPUï¼Œä¸€ä¸ªæ˜¯å†…å­˜ï¼Œæ¯”è¾ƒç»•ï¼Œå¤šçœ‹å‡ éå°±å¥½äº†","user_name":"ä½œè€…å›å¤","comment_id":97699,"uid":"1001590","ip_address":"","utype":1,"ctime":1559110345,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":1,"race_medal":0,"score":"1558750975","product_id":100024701,"comment_content":"å‘¨å…­æ‰“å¡ï¼Œè¿™å‘¨çš„è¯¾ç¨‹è®©æˆ‘æ„Ÿè§‰è‡ªå·±æ™ºå•†æ¬ è´¹ğŸ˜‚","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451377,"discussion_content":"ä¸€ä¸ªæ˜¯CPUï¼Œä¸€ä¸ªæ˜¯å†…å­˜ï¼Œæ¯”è¾ƒç»•ï¼Œå¤šçœ‹å‡ éå°±å¥½äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559110345,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":97169,"user_name":"Sharry","can_delete":false,"product_type":"c1","uid":1239293,"ip_address":"","ucode":"045DDB864659F6","user_header":"https://static001.geekbang.org/account/avatar/00/12/e8/fd/035f4c94.jpg","comment_is_top":false,"comment_ctime":1558601581,"is_pvip":false,"replies":[{"id":"34856","content":"ä¸æ˜¯åŒä¸€ä¸ª","user_name":"ä½œè€…å›å¤","comment_id":97169,"uid":"1001590","ip_address":"","utype":1,"ctime":1558680840,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":1,"race_medal":0,"score":"1558601581","product_id":100024701,"comment_content":"è€å¸ˆ, ä»è¿™èŠ‚è¯¾æˆ‘çœ‹åˆ° slab slob å’Œ slub... è¿™...æ˜¯åŒä¸€ä¸ªå—? ","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451162,"discussion_content":"ä¸æ˜¯åŒä¸€ä¸ª","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558680840,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96687,"user_name":"å†·æœˆæµå…‰","can_delete":false,"product_type":"c1","uid":1236420,"ip_address":"","ucode":"ECE30450D0A3EA","user_header":"https://static001.geekbang.org/account/avatar/00/12/dd/c4/794a0bd0.jpg","comment_is_top":false,"comment_ctime":1558488270,"is_pvip":false,"replies":[{"id":"34861","content":"ä¼šåˆå¹¶çš„","user_name":"ä½œè€…å›å¤","comment_id":96687,"uid":"1001590","ip_address":"","utype":1,"ctime":1558681070,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":1,"race_medal":0,"score":"1558488270","product_id":100024701,"comment_content":"è€å¸ˆå¥½ï¼Œä¼™ä¼´ç³»ç»Ÿçš„é¡µåˆ†é…æˆ‘å¥½åƒç†è§£äº†ï¼Œä½†æ˜¯å®ƒæ˜¯æ€ä¹ˆå›æ”¶(å›æ”¶åè¦åˆå¹¶å—ï¼Ÿ)è¿˜æ˜¯æ²¡æƒ³æ˜ç™½ï¼Œè¿™ä¸ªä¼™ä¼´ç³»ç»Ÿä¸nettyçš„PoolChunkåˆ†é…æœºåˆ¶æœ‰ä»€ä¹ˆå¼‚åŒï¼Ÿ<br><br>","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450971,"discussion_content":"ä¼šåˆå¹¶çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558681070,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96444,"user_name":"bradleyzhou","can_delete":false,"product_type":"c1","uid":1028318,"ip_address":"","ucode":"8DC89079F03A96","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b0/de/0e75d3c2.jpg","comment_is_top":false,"comment_ctime":1558425499,"is_pvip":false,"replies":[{"id":"49285","content":"ä¼™ä¼´ç³»ç»Ÿæ˜¯å¯¹åŠåˆ†å‰²ç©ºé—´","user_name":"ä½œè€…å›å¤","comment_id":96444,"uid":"1001590","ip_address":"","utype":1,"ctime":1567609636,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":1,"race_medal":0,"score":"1558425499","product_id":100024701,"comment_content":"æ„Ÿè§‰ä¼™ä¼´ç³»ç»Ÿçš„å‘½åæ˜¯è¯´ï¼Œæ¯æ¬¡è¯·æ±‚å†…å­˜æ—¶ï¼Œè¦ä¹ˆæ˜¯è¯·æ±‚åˆ°åˆ«çš„ä¼™ä¼´åˆ†å‰©ä¸‹çš„å†…å­˜ï¼Œè¦ä¹ˆæ˜¯è‡ªå·±åˆ‡å¥½æ‹¿èµ°ä¸€å—ï¼Œå‰©ä¸‹çš„ç»™å°†æ¥çš„ä¼™ä¼´ã€‚","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450882,"discussion_content":"ä¼™ä¼´ç³»ç»Ÿæ˜¯å¯¹åŠåˆ†å‰²ç©ºé—´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567609636,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96054,"user_name":"é‡‘å­è‡å‡‰çš„é“ç²‰å°é€—","can_delete":false,"product_type":"c1","uid":1000602,"ip_address":"","ucode":"6A2C601F6EEBB5","user_header":"https://static001.geekbang.org/account/avatar/00/0f/44/9a/c03bea17.jpg","comment_is_top":false,"comment_ctime":1558316814,"is_pvip":false,"replies":[{"id":"49296","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","comment_id":96054,"uid":"1001590","ip_address":"","utype":1,"ctime":1567610389,"user_name_real":"åˆ˜è¶…@ç½‘æ˜“äº‘"}],"discussion_count":3,"race_medal":0,"score":"1558316814","product_id":100024701,"comment_content":"Linuxå¯ä»¥ç†è§£ä¸ºæ¯é¡µèƒ½å­˜4KBå—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1001590,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/76/0c7d4d23.jpg","nickname":"åˆ˜è¶…","note":"","ucode":"196BF3F499E8FE","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":450698,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567610389,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1106343,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e1/a7/86ea68a0.jpg","nickname":"baoxin","note":"","ucode":"9CAE39985EF676","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":892,"discussion_content":"4KBåº”è¯¥æŒ‡çš„æ˜¯åœ°å€ç©ºé—´ï¼Œå…·ä½“èƒ½å­˜å¤šå°‘è¿˜è¦ä¹˜ä»¥ä½å®½ï¼Œ32ä½ç³»ç»Ÿä¸€èˆ¬ä½å®½ä¸º32ï¼Œæ‰€ä»¥å®¹é‡åº”è¯¥æ˜¯4KB*32","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1562140796,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2178501,"avatar":"https://static001.geekbang.org/account/avatar/00/21/3d/c5/f43fa619.jpg","nickname":"ğŸ€æŸ æª¬é±¼ä¹Ÿæ˜¯é±¼","note":"","ucode":"DCF033636465F3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1106343,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e1/a7/86ea68a0.jpg","nickname":"baoxin","note":"","ucode":"9CAE39985EF676","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":535984,"discussion_content":"ä¸æ˜¯çš„ï¼Œå°±æ˜¯æŒ‡æ¯é¡µå­˜å‚¨4KBæ•°æ®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638626759,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":892,"ip_address":""},"score":535984,"extra":""}]}]}]}