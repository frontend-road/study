{"id":8843,"title":"35 | Apollo架构设计之服务器端","content":"无","comments":[{"had_liked":false,"id":22164,"user_name":"燕羽阳","can_delete":false,"product_type":"c3","uid":1015063,"ip_address":"","ucode":"AF9430187F66EE","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7d/17/179b24f4.jpg","comment_is_top":false,"comment_ctime":1535518081,"is_pvip":false,"replies":[{"id":8127,"content":"微服务思想，职责单一和分离，变更一个不影响另一个，一个有问题也不影响另一个。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1535865478,"ip_address":"","comment_id":22164,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"波波老师，你好。请问一下adminserver和configserver分开设计是基于什么考虑呢？","like_count":5,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423026,"discussion_content":"微服务思想，职责单一和分离，变更一个不影响另一个，一个有问题也不影响另一个。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1535865478,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":43940,"user_name":"行轩","can_delete":false,"product_type":"c3","uid":1053253,"ip_address":"","ucode":"1F76A612AEDAD9","user_header":"https://static001.geekbang.org/account/avatar/00/10/12/45/f1151527.jpg","comment_is_top":false,"comment_ctime":1543330969,"is_pvip":false,"replies":[{"id":15791,"content":"你好，1. apollo的config sever可以水平扩展，每个client只连其中一台config server并保持长连接（连接失效会自动重连或切换），如发现config server有性能问题，简单加机器扩容即可。2. 配置变更有版本控制，保证有序。3. 配置中心一般用于存简单配置，一般不会很大，如确实有大配置场景，建议为此场景专门搭一套独立apollo集群，以免干扰。4. apollo没有用分布式缓存，因为每个client只连一台config server，config server上有缓存，会和db同步，近实时，实际生产中足够。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1543405843,"ip_address":"","comment_id":43940,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"波波老师，有几个问题想请教下：\n1. 服务端的push，如果上万台服务器，是否会存在性能问题？\n2. 服务端的push到client端的数据，是否能保证有序性？\n3. 服务端的dataid配置，一个namespace下，如果存储非常大的配置，对查询或者缓存加载是否拖慢整体性能？\n4. 服务端查询时，是否用了分布式缓存？如果用了缓存，那么缓存与db的一致性窗口如何保证？失效时间？\n","like_count":2,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430559,"discussion_content":"你好，1. apollo的config sever可以水平扩展，每个client只连其中一台config server并保持长连接（连接失效会自动重连或切换），如发现config server有性能问题，简单加机器扩容即可。2. 配置变更有版本控制，保证有序。3. 配置中心一般用于存简单配置，一般不会很大，如确实有大配置场景，建议为此场景专门搭一套独立apollo集群，以免干扰。4. apollo没有用分布式缓存，因为每个client只连一台config server，config server上有缓存，会和db同步，近实时，实际生产中足够。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543405843,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":49843,"user_name":"王盛武","can_delete":false,"product_type":"c3","uid":1182516,"ip_address":"","ucode":"DE7EF246D3DCE8","user_header":"https://static001.geekbang.org/account/avatar/00/12/0b/34/f41d73a4.jpg","comment_is_top":false,"comment_ctime":1544778719,"is_pvip":false,"replies":[{"id":18699,"content":"前面的问题在上个问题中已经回答。不用MQ是为了简化设计，减少依赖，而且还要考虑MQ挂和丢消息情况，进一步增加系统复杂性。其实ReleaseMessage表就是一个轻量+版本控制的消息机制。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1545223815,"ip_address":"","comment_id":49843,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"波波老师好，特别喜欢这节架构讲的很透彻；\n有个疑问，ReleaseMessage表发布是通过Config Service定时扫码数据库的；\n\n这个定时是间隔多久呢？ \n定时的话在间隔时间内，还不是实时的发布哦？  \n\n有没考虑使用MQ或者Redis队列来连接Admin Service和ConfigService这种经典的生产者&#47;消费者模式？","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432787,"discussion_content":"前面的问题在上个问题中已经回答。不用MQ是为了简化设计，减少依赖，而且还要考虑MQ挂和丢消息情况，进一步增加系统复杂性。其实ReleaseMessage表就是一个轻量+版本控制的消息机制。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545223815,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":31857,"user_name":"家榆","can_delete":false,"product_type":"c3","uid":1030050,"ip_address":"","ucode":"6D62685C80DD7C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b7/a2/0ce9b8df.jpg","comment_is_top":false,"comment_ctime":1539313423,"is_pvip":false,"replies":[{"id":11727,"content":"client和configservice之间还是有状态的，一个client连一个configservice，configservice会维护这个client的状态。直接用nginx就不能直连和无法维护状态。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1539515413,"ip_address":"","comment_id":31857,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"感觉如果客户端没有eureka client的话，还不如nginx直接代理config service的地址更简单","like_count":1,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426539,"discussion_content":"client和configservice之间还是有状态的，一个client连一个configservice，configservice会维护这个client的状态。直接用nginx就不能直连和无法维护状态。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539515413,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":271669,"user_name":"猩猩","can_delete":false,"product_type":"c3","uid":1193852,"ip_address":"","ucode":"102ADA39C145CF","user_header":"https://static001.geekbang.org/account/avatar/00/12/37/7c/ffa62584.jpg","comment_is_top":false,"comment_ctime":1609752024,"is_pvip":false,"replies":[{"id":98964,"content":"我本人主要生产经验是Apollo，nacos只是了解，没有实战过，不好发表建议。所以你要自己测试评估。个人认为Apollo还是比较贴近生产落地的。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1610460577,"ip_address":"","comment_id":271669,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"波波老师，我们公司最近升级Spring Cloud框架，采用nacos代替eureka，准备采用apollo代替config。nacos也能用作配置中心，想问下nacos对比apollo如何选择？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513000,"discussion_content":"我本人主要生产经验是Apollo，nacos只是了解，没有实战过，不好发表建议。所以你要自己测试评估。个人认为Apollo还是比较贴近生产落地的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610460577,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":152630,"user_name":"💢 星星💢","can_delete":false,"product_type":"c3","uid":1254392,"ip_address":"","ucode":"A402B765222C35","user_header":"https://static001.geekbang.org/account/avatar/00/13/23/f8/24fcccea.jpg","comment_is_top":false,"comment_ctime":1574053500,"is_pvip":false,"replies":[{"id":58686,"content":"我作图基本都用keynote(mac)或者powerpoint(windows)。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1574080188,"ip_address":"","comment_id":152630,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"波波老师你好。我想知道你画图是用什么软件画的？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":474879,"discussion_content":"我作图基本都用keynote(mac)或者powerpoint(windows)。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574080188,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44392,"user_name":"aerox","can_delete":false,"product_type":"c3","uid":1171773,"ip_address":"","ucode":"031E82649634AF","user_header":"https://static001.geekbang.org/account/avatar/00/11/e1/3d/1ec28dd4.jpg","comment_is_top":false,"comment_ctime":1543419057,"is_pvip":false,"replies":[{"id":15965,"content":"你好，答复如下：1.推送的配置会落地，如果config server出问题，apollo客户端会降级使用本地。2.配置下发是秒级近实时，如果需动态reload，需客户端逻辑配合，请参考github.com&#47;ctripcorp&#47;apollo-use-case动态reload样例。3.配置生效apollo界面上可近实时查看。","user_name":"作者回复","user_name_real":"杨波","uid":1030344,"ctime":1543493147,"ip_address":"","comment_id":44392,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100007001,"comment_content":"波波老师您好，请问：\n1. 推送的配置会落地吗？如果config server出问题，是否会降级使用本地配置？\n2. 配置下发是实时生效的吗？比如修改redis地址，是否需要客户端类库支持。如果不支持实时生效，管理平台上怎么做到限制用户运行时修改不能实时生效的配置啊？\n3. 关于微服务的可视化，服务的配置是否生效这块apollo有回显的处理吗？","like_count":0,"discussions":[{"author":{"id":1030344,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/b8/c8/c94d38a7.jpg","nickname":"杨波","note":"","ucode":"FA3418BB703BCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430747,"discussion_content":"你好，答复如下：1.推送的配置会落地，如果config server出问题，apollo客户端会降级使用本地。2.配置下发是秒级近实时，如果需动态reload，需客户端逻辑配合，请参考github.com/ctripcorp/apollo-use-case动态reload样例。3.配置生效apollo界面上可近实时查看。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543493147,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}