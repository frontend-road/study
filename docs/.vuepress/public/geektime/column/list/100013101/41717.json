{"id":41717,"title":"28 | æ¡ä»¶å˜é‡sync.Cond ï¼ˆä¸‹ï¼‰","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯éƒæ—ï¼Œä»Šå¤©æˆ‘ç»§ç»­åˆ†äº«æ¡ä»¶å˜é‡sync.Condçš„å†…å®¹ã€‚æˆ‘ä»¬ç´§æ¥ç€ä¸Šä¸€ç¯‡çš„å†…å®¹è¿›è¡ŒçŸ¥è¯†æ‰©å±•ã€‚</p><h2>é—®é¢˜ 1ï¼šæ¡ä»¶å˜é‡çš„<code>Wait</code>æ–¹æ³•åšäº†ä»€ä¹ˆï¼Ÿ</h2><p>åœ¨äº†è§£äº†æ¡ä»¶å˜é‡çš„ä½¿ç”¨æ–¹å¼ä¹‹åï¼Œä½ å¯èƒ½ä¼šæœ‰è¿™ä¹ˆå‡ ä¸ªç–‘é—®ã€‚</p><ol>\n<li>ä¸ºä»€ä¹ˆå…ˆè¦é”å®šæ¡ä»¶å˜é‡åŸºäºçš„äº’æ–¥é”ï¼Œæ‰èƒ½è°ƒç”¨å®ƒçš„<code>Wait</code>æ–¹æ³•ï¼Ÿ</li>\n<li>ä¸ºä»€ä¹ˆè¦ç”¨<code>for</code>è¯­å¥æ¥åŒ…è£¹è°ƒç”¨å…¶<code>Wait</code>æ–¹æ³•çš„è¡¨è¾¾å¼ï¼Œç”¨<code>if</code>è¯­å¥ä¸è¡Œå—ï¼Ÿ</li>\n</ol><p>è¿™äº›é—®é¢˜æˆ‘åœ¨é¢è¯•çš„æ—¶å€™ä¹Ÿç»å¸¸é—®ã€‚ä½ éœ€è¦å¯¹è¿™ä¸ª<code>Wait</code>æ–¹æ³•çš„å†…éƒ¨æœºåˆ¶æœ‰æ‰€äº†è§£æ‰èƒ½å›ç­”ä¸Šæ¥ã€‚</p><p>æ¡ä»¶å˜é‡çš„<code>Wait</code>æ–¹æ³•ä¸»è¦åšäº†å››ä»¶äº‹ã€‚</p><ol>\n<li>æŠŠè°ƒç”¨å®ƒçš„goroutineï¼ˆä¹Ÿå°±æ˜¯å½“å‰çš„goroutineï¼‰åŠ å…¥åˆ°å½“å‰æ¡ä»¶å˜é‡çš„é€šçŸ¥é˜Ÿåˆ—ä¸­ã€‚</li>\n<li>è§£é”å½“å‰çš„æ¡ä»¶å˜é‡åŸºäºçš„é‚£ä¸ªäº’æ–¥é”ã€‚</li>\n<li>è®©å½“å‰çš„goroutineå¤„äºç­‰å¾…çŠ¶æ€ï¼Œç­‰åˆ°é€šçŸ¥åˆ°æ¥æ—¶å†å†³å®šæ˜¯å¦å”¤é†’å®ƒã€‚æ­¤æ—¶ï¼Œè¿™ä¸ªgoroutineå°±ä¼šé˜»å¡åœ¨è°ƒç”¨è¿™ä¸ª<code>Wait</code>æ–¹æ³•çš„é‚£è¡Œä»£ç ä¸Šã€‚</li>\n<li>å¦‚æœé€šçŸ¥åˆ°æ¥å¹¶ä¸”å†³å®šå”¤é†’è¿™ä¸ªgoroutineï¼Œé‚£ä¹ˆå°±åœ¨å”¤é†’å®ƒä¹‹åé‡æ–°é”å®šå½“å‰æ¡ä»¶å˜é‡åŸºäºçš„äº’æ–¥é”ã€‚è‡ªæ­¤ä¹‹åï¼Œå½“å‰çš„goroutineå°±ä¼šç»§ç»­æ‰§è¡Œåé¢çš„ä»£ç äº†ã€‚</li>\n</ol><p>ä½ ç°åœ¨çŸ¥é“æˆ‘åˆšåˆšè¯´çš„ç¬¬ä¸€ä¸ªç–‘é—®çš„ç­”æ¡ˆäº†å—ï¼Ÿ</p><p>å› ä¸ºæ¡ä»¶å˜é‡çš„<code>Wait</code>æ–¹æ³•åœ¨é˜»å¡å½“å‰çš„goroutineä¹‹å‰ï¼Œä¼šè§£é”å®ƒåŸºäºçš„äº’æ–¥é”ï¼Œæ‰€ä»¥åœ¨è°ƒç”¨è¯¥<code>Wait</code>æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆé”å®šé‚£ä¸ªäº’æ–¥é”ï¼Œå¦åˆ™åœ¨è°ƒç”¨è¿™ä¸ª<code>Wait</code>æ–¹æ³•æ—¶ï¼Œå°±ä¼šå¼•å‘ä¸€ä¸ªä¸å¯æ¢å¤çš„panicã€‚</p><!-- [[[read_end]]] --><p>ä¸ºä»€ä¹ˆæ¡ä»¶å˜é‡çš„<code>Wait</code>æ–¹æ³•è¦è¿™ä¹ˆåšå‘¢ï¼Ÿä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœ<code>Wait</code>æ–¹æ³•åœ¨äº’æ–¥é”å·²ç»é”å®šçš„æƒ…å†µä¸‹ï¼Œé˜»å¡äº†å½“å‰çš„goroutineï¼Œé‚£ä¹ˆåˆç”±è°æ¥è§£é”å‘¢ï¼Ÿåˆ«çš„goroutineå—ï¼Ÿ</p><p>å…ˆä¸è¯´è¿™è¿èƒŒäº†äº’æ–¥é”çš„é‡è¦ä½¿ç”¨åŸåˆ™ï¼Œå³ï¼šæˆå¯¹çš„é”å®šå’Œè§£é”ï¼Œå°±ç®—åˆ«çš„goroutineå¯ä»¥æ¥è§£é”ï¼Œé‚£ä¸‡ä¸€è§£é”é‡å¤äº†æ€ä¹ˆåŠï¼Ÿç”±æ­¤å¼•å‘çš„panicå¯æ˜¯æ— æ³•æ¢å¤çš„ã€‚</p><p>å¦‚æœå½“å‰çš„goroutineæ— æ³•è§£é”ï¼Œåˆ«çš„goroutineä¹Ÿéƒ½ä¸æ¥è§£é”ï¼Œé‚£ä¹ˆåˆç”±è°æ¥è¿›å…¥ä¸´ç•ŒåŒºï¼Œå¹¶æ”¹å˜å…±äº«èµ„æºçš„çŠ¶æ€å‘¢ï¼Ÿåªè¦å…±äº«èµ„æºçš„çŠ¶æ€ä¸å˜ï¼Œå³ä½¿å½“å‰çš„goroutineå› æ”¶åˆ°é€šçŸ¥è€Œè¢«å”¤é†’ï¼Œä¹Ÿä¾ç„¶ä¼šå†æ¬¡æ‰§è¡Œè¿™ä¸ª<code>Wait</code>æ–¹æ³•ï¼Œå¹¶å†æ¬¡è¢«é˜»å¡ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œå¦‚æœæ¡ä»¶å˜é‡çš„<code>Wait</code>æ–¹æ³•ä¸å…ˆè§£é”äº’æ–¥é”çš„è¯ï¼Œé‚£ä¹ˆå°±åªä¼šé€ æˆä¸¤ç§åæœï¼šä¸æ˜¯å½“å‰çš„ç¨‹åºå› panicè€Œå´©æºƒï¼Œå°±æ˜¯ç›¸å…³çš„goroutineå…¨é¢é˜»å¡ã€‚</p><p>å†è§£é‡Šç¬¬äºŒä¸ªç–‘é—®ã€‚å¾ˆæ˜¾ç„¶ï¼Œ<code>if</code>è¯­å¥åªä¼šå¯¹å…±äº«èµ„æºçš„çŠ¶æ€æ£€æŸ¥ä¸€æ¬¡ï¼Œè€Œ<code>for</code>è¯­å¥å´å¯ä»¥åšå¤šæ¬¡æ£€æŸ¥ï¼Œç›´åˆ°è¿™ä¸ªçŠ¶æ€æ”¹å˜ä¸ºæ­¢ã€‚é‚£ä¸ºä»€ä¹ˆè¦åšå¤šæ¬¡æ£€æŸ¥å‘¢ï¼Ÿ</p><p><strong>è¿™ä¸»è¦æ˜¯ä¸ºäº†ä¿é™©èµ·è§ã€‚å¦‚æœä¸€ä¸ªgoroutineå› æ”¶åˆ°é€šçŸ¥è€Œè¢«å”¤é†’ï¼Œä½†å´å‘ç°å…±äº«èµ„æºçš„çŠ¶æ€ï¼Œä¾ç„¶ä¸ç¬¦åˆå®ƒçš„è¦æ±‚ï¼Œé‚£ä¹ˆå°±åº”è¯¥å†æ¬¡è°ƒç”¨æ¡ä»¶å˜é‡çš„<code>Wait</code>æ–¹æ³•ï¼Œå¹¶ç»§ç»­ç­‰å¾…ä¸‹æ¬¡é€šçŸ¥çš„åˆ°æ¥ã€‚</strong></p><p>è¿™ç§æƒ…å†µæ˜¯å¾ˆæœ‰å¯èƒ½å‘ç”Ÿçš„ï¼Œå…·ä½“å¦‚ä¸‹é¢æ‰€ç¤ºã€‚</p><ol>\n<li>\n<p>æœ‰å¤šä¸ªgoroutineåœ¨ç­‰å¾…å…±äº«èµ„æºçš„åŒä¸€ç§çŠ¶æ€ã€‚æ¯”å¦‚ï¼Œå®ƒä»¬éƒ½åœ¨ç­‰<code>mailbox</code>å˜é‡çš„å€¼ä¸ä¸º<code>0</code>çš„æ—¶å€™å†æŠŠå®ƒçš„å€¼å˜ä¸º<code>0</code>ï¼Œè¿™å°±ç›¸å½“äºæœ‰å¤šä¸ªäººåœ¨ç­‰ç€æˆ‘å‘ä¿¡ç®±é‡Œæ”¾ç½®æƒ…æŠ¥ã€‚è™½ç„¶ç­‰å¾…çš„goroutineæœ‰å¤šä¸ªï¼Œä½†æ¯æ¬¡æˆåŠŸçš„goroutineå´åªå¯èƒ½æœ‰ä¸€ä¸ªã€‚åˆ«å¿˜äº†ï¼Œæ¡ä»¶å˜é‡çš„<code>Wait</code>æ–¹æ³•ä¼šåœ¨å½“å‰çš„goroutineé†’æ¥åå…ˆé‡æ–°é”å®šé‚£ä¸ªäº’æ–¥é”ã€‚åœ¨æˆåŠŸçš„goroutineæœ€ç»ˆè§£é”äº’æ–¥é”ä¹‹åï¼Œå…¶ä»–çš„goroutineä¼šå…ˆåè¿›å…¥ä¸´ç•ŒåŒºï¼Œä½†å®ƒä»¬ä¼šå‘ç°å…±äº«èµ„æºçš„çŠ¶æ€ä¾ç„¶ä¸æ˜¯å®ƒä»¬æƒ³è¦çš„ã€‚è¿™ä¸ªæ—¶å€™ï¼Œ<code>for</code>å¾ªç¯å°±å¾ˆæœ‰å¿…è¦äº†ã€‚</p>\n</li>\n<li>\n<p>å…±äº«èµ„æºå¯èƒ½æœ‰çš„çŠ¶æ€ä¸æ˜¯ä¸¤ä¸ªï¼Œè€Œæ˜¯æ›´å¤šã€‚æ¯”å¦‚ï¼Œ<code>mailbox</code>å˜é‡çš„å¯èƒ½å€¼ä¸åªæœ‰<code>0</code>å’Œ<code>1</code>ï¼Œè¿˜æœ‰<code>2</code>ã€<code>3</code>ã€<code>4</code>ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œç”±äºçŠ¶æ€åœ¨æ¯æ¬¡æ”¹å˜åçš„ç»“æœåªå¯èƒ½æœ‰ä¸€ä¸ªï¼Œæ‰€ä»¥ï¼Œåœ¨è®¾è®¡åˆç†çš„å‰æä¸‹ï¼Œå•ä¸€çš„ç»“æœä¸€å®šä¸å¯èƒ½æ»¡è¶³æ‰€æœ‰goroutineçš„æ¡ä»¶ã€‚é‚£äº›æœªè¢«æ»¡è¶³çš„goroutineæ˜¾ç„¶è¿˜éœ€è¦ç»§ç»­ç­‰å¾…å’Œæ£€æŸ¥ã€‚</p>\n</li>\n<li>\n<p>æœ‰ä¸€ç§å¯èƒ½ï¼Œå…±äº«èµ„æºçš„çŠ¶æ€åªæœ‰ä¸¤ä¸ªï¼Œå¹¶ä¸”æ¯ç§çŠ¶æ€éƒ½åªæœ‰ä¸€ä¸ªgoroutineåœ¨å…³æ³¨ï¼Œå°±åƒæˆ‘ä»¬åœ¨ä¸»é—®é¢˜å½“ä¸­å®ç°çš„é‚£ä¸ªä¾‹å­é‚£æ ·ã€‚ä¸è¿‡ï¼Œå³ä½¿æ˜¯è¿™æ ·ï¼Œä½¿ç”¨<code>for</code>è¯­å¥ä»ç„¶æ˜¯æœ‰å¿…è¦çš„ã€‚åŸå› æ˜¯ï¼Œåœ¨ä¸€äº›å¤šCPUæ ¸å¿ƒçš„è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œå³ä½¿æ²¡æœ‰æ”¶åˆ°æ¡ä»¶å˜é‡çš„é€šçŸ¥ï¼Œè°ƒç”¨å…¶<code>Wait</code>æ–¹æ³•çš„goroutineä¹Ÿæ˜¯æœ‰å¯èƒ½è¢«å”¤é†’çš„ã€‚è¿™æ˜¯ç”±è®¡ç®—æœºç¡¬ä»¶å±‚é¢å†³å®šçš„ï¼Œå³ä½¿æ˜¯æ“ä½œç³»ç»Ÿï¼ˆæ¯”å¦‚Linuxï¼‰æœ¬èº«æä¾›çš„æ¡ä»¶å˜é‡ä¹Ÿä¼šå¦‚æ­¤ã€‚</p>\n</li>\n</ol><p>ç»¼ä¸Šæ‰€è¿°ï¼Œåœ¨åŒ…è£¹æ¡ä»¶å˜é‡çš„<code>Wait</code>æ–¹æ³•çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ€»æ˜¯åº”è¯¥ä½¿ç”¨<code>for</code>è¯­å¥ã€‚</p><p>å¥½äº†ï¼Œåˆ°è¿™é‡Œï¼Œå…³äºæ¡ä»¶å˜é‡çš„<code>Wait</code>æ–¹æ³•ï¼Œæˆ‘æƒ³ä½ çŸ¥é“çš„åº”è¯¥å·²ç»è¶³å¤Ÿå¤šäº†ã€‚</p><h2>é—®é¢˜ 2ï¼šæ¡ä»¶å˜é‡çš„<code>Signal</code>æ–¹æ³•å’Œ<code>Broadcast</code>æ–¹æ³•æœ‰å“ªäº›å¼‚åŒï¼Ÿ</h2><p>æ¡ä»¶å˜é‡çš„<code>Signal</code>æ–¹æ³•å’Œ<code>Broadcast</code>æ–¹æ³•éƒ½æ˜¯è¢«ç”¨æ¥å‘é€é€šçŸ¥çš„ï¼Œä¸åŒçš„æ˜¯ï¼Œå‰è€…çš„é€šçŸ¥åªä¼šå”¤é†’ä¸€ä¸ªå› æ­¤è€Œç­‰å¾…çš„goroutineï¼Œè€Œåè€…çš„é€šçŸ¥å´ä¼šå”¤é†’æ‰€æœ‰ä¸ºæ­¤ç­‰å¾…çš„goroutineã€‚</p><p>æ¡ä»¶å˜é‡çš„<code>Wait</code>æ–¹æ³•æ€»ä¼šæŠŠå½“å‰çš„goroutineæ·»åŠ åˆ°é€šçŸ¥é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œè€Œå®ƒçš„<code>Signal</code>æ–¹æ³•æ€»ä¼šä»é€šçŸ¥é˜Ÿåˆ—çš„é˜Ÿé¦–å¼€å§‹ï¼ŒæŸ¥æ‰¾å¯è¢«å”¤é†’çš„goroutineã€‚æ‰€ä»¥ï¼Œå› <code>Signal</code>æ–¹æ³•çš„é€šçŸ¥ï¼Œè€Œè¢«å”¤é†’çš„goroutineä¸€èˆ¬éƒ½æ˜¯æœ€æ—©ç­‰å¾…çš„é‚£ä¸€ä¸ªã€‚</p><p>è¿™ä¸¤ä¸ªæ–¹æ³•çš„è¡Œä¸ºå†³å®šäº†å®ƒä»¬çš„é€‚ç”¨åœºæ™¯ã€‚å¦‚æœä½ ç¡®å®šåªæœ‰ä¸€ä¸ªgoroutineåœ¨ç­‰å¾…é€šçŸ¥ï¼Œæˆ–è€…åªéœ€å”¤é†’ä»»æ„ä¸€ä¸ªgoroutineå°±å¯ä»¥æ»¡è¶³è¦æ±‚ï¼Œé‚£ä¹ˆä½¿ç”¨æ¡ä»¶å˜é‡çš„<code>Signal</code>æ–¹æ³•å°±å¥½äº†ã€‚</p><p>å¦åˆ™ï¼Œä½¿ç”¨<code>Broadcast</code>æ–¹æ³•æ€»æ²¡é”™ï¼Œåªè¦ä½ è®¾ç½®å¥½å„ä¸ªgoroutineæ‰€æœŸæœ›çš„å…±äº«èµ„æºçŠ¶æ€å°±å¯ä»¥äº†ã€‚</p><p>æ­¤å¤–ï¼Œå†æ¬¡å¼ºè°ƒä¸€ä¸‹ï¼Œä¸<code>Wait</code>æ–¹æ³•ä¸åŒï¼Œæ¡ä»¶å˜é‡çš„<code>Signal</code>æ–¹æ³•å’Œ<code>Broadcast</code>æ–¹æ³•å¹¶ä¸éœ€è¦åœ¨äº’æ–¥é”çš„ä¿æŠ¤ä¸‹æ‰§è¡Œã€‚æ°æ°ç›¸åï¼Œæˆ‘ä»¬æœ€å¥½åœ¨è§£é”æ¡ä»¶å˜é‡åŸºäºçš„é‚£ä¸ªäº’æ–¥é”ä¹‹åï¼Œå†å»è°ƒç”¨å®ƒçš„è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚è¿™æ›´æœ‰åˆ©äºç¨‹åºçš„è¿è¡Œæ•ˆç‡ã€‚</p><p>æœ€åï¼Œè¯·æ³¨æ„ï¼Œæ¡ä»¶å˜é‡çš„é€šçŸ¥å…·æœ‰å³æ—¶æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå‘é€é€šçŸ¥çš„æ—¶å€™æ²¡æœ‰goroutineä¸ºæ­¤ç­‰å¾…ï¼Œé‚£ä¹ˆè¯¥é€šçŸ¥å°±ä¼šè¢«ç›´æ¥ä¸¢å¼ƒã€‚åœ¨è¿™ä¹‹åæ‰å¼€å§‹ç­‰å¾…çš„goroutineåªå¯èƒ½è¢«åé¢çš„é€šçŸ¥å”¤é†’ã€‚</p><p>ä½ å¯ä»¥æ‰“å¼€demo62.goæ–‡ä»¶ï¼Œå¹¶ä»”ç»†è§‚å¯Ÿå®ƒä¸demo61.goçš„ä¸åŒã€‚å°¤å…¶æ˜¯<code>lock</code>å˜é‡çš„ç±»å‹ï¼Œä»¥åŠå‘é€é€šçŸ¥çš„æ–¹å¼ã€‚</p><h2>æ€»ç»“</h2><p>æˆ‘ä»¬ä»Šå¤©ä¸»è¦è®²äº†æ¡ä»¶å˜é‡ï¼Œå®ƒæ˜¯åŸºäºäº’æ–¥é”çš„ä¸€ç§åŒæ­¥å·¥å…·ã€‚åœ¨Goè¯­è¨€ä¸­ï¼Œæˆ‘ä»¬éœ€è¦ç”¨<code>sync.NewCond</code>å‡½æ•°æ¥åˆå§‹åŒ–ä¸€ä¸ª<code>sync.Cond</code>ç±»å‹çš„æ¡ä»¶å˜é‡ã€‚</p><p><code>sync.NewCond</code>å‡½æ•°éœ€è¦ä¸€ä¸ª<code>sync.Locker</code>ç±»å‹çš„å‚æ•°å€¼ã€‚</p><p><code>*sync.Mutex</code>ç±»å‹çš„å€¼ä»¥åŠ<code>*sync.RWMutex</code>ç±»å‹çš„å€¼éƒ½å¯ä»¥æ»¡è¶³è¿™ä¸ªè¦æ±‚ã€‚å¦å¤–ï¼Œåè€…çš„<code>RLocker</code>æ–¹æ³•å¯ä»¥è¿”å›è¿™ä¸ªå€¼ä¸­çš„è¯»é”ï¼Œä¹ŸåŒæ ·å¯ä»¥ä½œä¸º<code>sync.NewCond</code>å‡½æ•°çš„å‚æ•°å€¼ï¼Œå¦‚æ­¤å°±å¯ä»¥ç”Ÿæˆä¸è¯»å†™é”ä¸­çš„è¯»é”å¯¹åº”çš„æ¡ä»¶å˜é‡äº†ã€‚</p><p>æ¡ä»¶å˜é‡çš„<code>Wait</code>æ–¹æ³•éœ€è¦åœ¨å®ƒåŸºäºçš„äº’æ–¥é”ä¿æŠ¤ä¸‹æ‰§è¡Œï¼Œå¦åˆ™å°±ä¼šå¼•å‘ä¸å¯æ¢å¤çš„panicã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬æœ€å¥½ä½¿ç”¨<code>for</code>è¯­å¥æ¥æ£€æŸ¥å…±äº«èµ„æºçš„çŠ¶æ€ï¼Œå¹¶åŒ…è£¹å¯¹æ¡ä»¶å˜é‡çš„<code>Wait</code>æ–¹æ³•çš„è°ƒç”¨ã€‚</p><p>ä¸è¦ç”¨<code>if</code>è¯­å¥ï¼Œå› ä¸ºå®ƒä¸èƒ½é‡å¤åœ°æ‰§è¡Œâ€œæ£€æŸ¥çŠ¶æ€-ç­‰å¾…é€šçŸ¥-è¢«å”¤é†’â€çš„è¿™ä¸ªæµç¨‹ã€‚é‡å¤æ‰§è¡Œè¿™ä¸ªæµç¨‹çš„åŸå› æ˜¯ï¼Œä¸€ä¸ªâ€œå› ä¸ºç­‰å¾…é€šçŸ¥ï¼Œè€Œè¢«é˜»å¡â€çš„goroutineï¼Œå¯èƒ½ä¼šåœ¨å…±äº«èµ„æºçš„çŠ¶æ€ä¸æ»¡è¶³å…¶è¦æ±‚çš„æƒ…å†µä¸‹è¢«å”¤é†’ã€‚</p><p>æ¡ä»¶å˜é‡çš„<code>Signal</code>æ–¹æ³•åªä¼šå”¤é†’ä¸€ä¸ªå› ç­‰å¾…é€šçŸ¥è€Œè¢«é˜»å¡çš„goroutineï¼Œè€Œå®ƒçš„<code>Broadcast</code>æ–¹æ³•å´å¯ä»¥å”¤é†’æ‰€æœ‰ä¸ºæ­¤è€Œç­‰å¾…çš„goroutineã€‚åè€…æ¯”å‰è€…çš„é€‚åº”åœºæ™¯è¦å¤šå¾—å¤šã€‚</p><p>è¿™ä¸¤ä¸ªæ–¹æ³•å¹¶ä¸éœ€è¦å—åˆ°äº’æ–¥é”çš„ä¿æŠ¤ï¼Œæˆ‘ä»¬ä¹Ÿæœ€å¥½ä¸è¦åœ¨è§£é”äº’æ–¥é”ä¹‹å‰è°ƒç”¨å®ƒä»¬ã€‚è¿˜æœ‰ï¼Œæ¡ä»¶å˜é‡çš„é€šçŸ¥å…·æœ‰å³æ—¶æ€§ã€‚å½“é€šçŸ¥è¢«å‘é€çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•goroutineéœ€è¦è¢«å”¤é†’ï¼Œé‚£ä¹ˆè¯¥é€šçŸ¥å°±ä¼šç«‹å³å¤±æ•ˆã€‚</p><h2>æ€è€ƒé¢˜</h2><p><code>sync.Cond</code>ç±»å‹ä¸­çš„å…¬å¼€å­—æ®µ<code>L</code>æ˜¯åšä»€ä¹ˆç”¨çš„ï¼Ÿæˆ‘ä»¬å¯ä»¥åœ¨ä½¿ç”¨æ¡ä»¶å˜é‡çš„è¿‡ç¨‹ä¸­æ”¹å˜è¿™ä¸ªå­—æ®µçš„å€¼å—ï¼Ÿ</p><p><a href=\"https://github.com/hyper0x/Golang_Puzzlers\">æˆ³æ­¤æŸ¥çœ‹Goè¯­è¨€ä¸“æ æ–‡ç« é…å¥—è¯¦ç»†ä»£ç ã€‚</a></p>","neighbors":{"left":{"article_title":"27 | æ¡ä»¶å˜é‡sync.Cond ï¼ˆä¸Šï¼‰","id":41588},"right":{"article_title":"29 | åŸå­æ“ä½œï¼ˆä¸Šï¼‰","id":41908}},"comments":[{"had_liked":false,"id":104885,"user_name":"éƒæ—","can_delete":false,"product_type":"c1","uid":1026643,"ip_address":"","ucode":"F66BA62BA56FFA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","comment_is_top":false,"comment_ctime":1560863678,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"173359555518","product_id":100013101,"comment_content":"å¯¹æ¡ä»¶å˜é‡è¿™ä¸ªå·¥å…·æœ¬èº«è¿˜æœ‰ç–‘é—®çš„è¯»è€…å¯ä»¥å»çœ‹æˆ‘å†™çš„ã€ŠGo å¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹ç¬¬äºŒç‰ˆã€‚è¿™æœ¬ä¹¦ä»å¹¶å‘ç¨‹åºçš„åŸºæœ¬æ¦‚å¿µè®²èµ·ï¼Œç”¨ä¸€å®šç¯‡å¹…çš„å›¾æ–‡å†…å®¹è¯¦ç»†åœ°è®²è§£äº†æ¡ä»¶å˜é‡çš„ç”¨æ³•ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªè´¯ç©¿äº†äº’æ–¥é”å’Œæ¡ä»¶å˜é‡çš„ç¤ºä¾‹ã€‚ç”±äºè¿™æœ¬ä¹¦çš„ç‰ˆæƒåœ¨å‡ºç‰ˆç¤¾é‚£é‡Œï¼Œæ‰€ä»¥æˆ‘ä¸èƒ½æŠŠå…¶ä¸­çš„å†…å®¹æ¬åˆ°è¿™é‡Œã€‚<br><br>æˆ‘åœ¨è¿™é‡Œåªå¯¹å¤§å®¶å…±åŒçš„ç–‘é—®è¿›è¡Œç®€è¦è¯´æ˜ï¼š<br><br>1. æ¡ä»¶å˜é‡é€‚åˆä¿æŠ¤é‚£äº›å¯æ‰§è¡Œä¸¤ä¸ªå¯¹ç«‹æ“ä½œçš„å…±äº«èµ„æºã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªæ—¢å¯è¯»åˆå¯å†™çš„å…±äº«æ–‡ä»¶ã€‚åˆæ¯”å¦‚ï¼Œæ—¢æœ‰ç”Ÿäº§è€…åˆæœ‰æ¶ˆè´¹è€…çš„äº§å“æ± ã€‚<br><br>2. å¯¹äºæœ‰ç€å¯¹ç«‹æ“ä½œçš„å…±äº«èµ„æºï¼ˆæ¯”å¦‚ä¸€ä¸ªå…±äº«æ–‡ä»¶ï¼‰ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦åŸºäºåŒä¸€ä¸ªé”çš„ä¸¤ä¸ªæ¡ä»¶å˜é‡ï¼ˆæ¯”å¦‚ rcond å’Œ wcondï¼‰åˆ†åˆ«ä¿æŠ¤è¯»æ“ä½œå’Œå†™æ“ä½œï¼ˆæ¯”å¦‚ rcond ä¿æŠ¤è¯»ï¼Œwcond ä¿æŠ¤å†™ï¼‰ã€‚è€Œä¸”ï¼Œè¯»æ“ä½œå’Œå†™æ“ä½œéƒ½éœ€è¦åŒæ—¶æŒæœ‰è¿™ä¸¤ä¸ªæ¡ä»¶å˜é‡ã€‚å› ä¸ºï¼Œè¯»æ“ä½œåœ¨æ“ä½œå®Œæˆåè¿˜è¦å‘ wcond å‘é€šçŸ¥ï¼›å†™æ“ä½œåœ¨æ“ä½œå®Œæˆåè¿˜è¦å‘ rcond å‘é€šçŸ¥ã€‚å¦‚æ­¤ä¸€æ¥ï¼Œè¯»å†™æ“ä½œæ‰èƒ½åœ¨è¾ƒå°‘çš„é”äº‰ç”¨çš„æƒ…å†µä¸‹äº¤æ›¿è¿›è¡Œã€‚<br><br>3. å¯¹äºåŒä¸€ä¸ªæ¡ä»¶å˜é‡ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨å®ƒçš„ Signal æ–¹æ³•å’Œ Broadcast æ–¹æ³•çš„æ—¶å€™ä¸åº”è¯¥å¤„åœ¨å…¶åŒ…å«çš„é‚£ä¸ªé”çš„ä¿æŠ¤ä¸‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åº”è¯¥å…ˆæ’¤æ‰ä¿æŠ¤å±éšœï¼Œå†å‘ Wait æ–¹æ³•çš„è°ƒç”¨æ–¹å‘å‡ºé€šçŸ¥ã€‚å¦åˆ™ï¼ŒWait æ–¹æ³•çš„è°ƒç”¨æ–¹å°±æœ‰å¯èƒ½ä¼šé”™è¿‡é€šçŸ¥ã€‚è¿™ä¹Ÿæ˜¯æˆ‘æ›´æ¨èä½¿ç”¨ Broadcast æ–¹æ³•çš„åŸå› ã€‚æ‰€æœ‰ç­‰å¾…æ–¹éƒ½é”™è¿‡é€šçŸ¥çš„æ¦‚ç‡è¦å°å¾ˆå¤šã€‚<br><br>4. ç›¸å¯¹åº”çš„ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨æ¡ä»¶å˜é‡çš„ Wait æ–¹æ³•çš„æ—¶å€™ï¼Œåº”è¯¥å¤„åœ¨å…¶ä¸­çš„é”çš„ä¿æŠ¤ä¹‹ä¸‹ã€‚å› ä¸ºæœ‰åŒä¸€ä¸ªé”ä¿æŠ¤ï¼Œæ‰€ä»¥ä¸å¯èƒ½æœ‰å¤šä¸ª goroutine åŒæ—¶æ‰§è¡Œåˆ°è¿™ä¸ª Wait æ–¹æ³•è°ƒç”¨ï¼Œä¹Ÿå°±ä¸å¯èƒ½å­˜åœ¨é’ˆå¯¹å…¶ä¸­é”çš„é‡å¤è§£é”ã€‚<br><br>5. å†å¼ºè°ƒä¸€ä¸‹ã€‚å¯¹äºåŒä¸€ä¸ªé”ï¼Œå¤šä¸ª goroutine å¯¹å®ƒé‡å¤é”å®šæ—¶åªä¼šæœ‰ä¸€ä¸ªæˆåŠŸï¼Œå…¶ä½™çš„ä¼šé˜»å¡ï¼›å¤šä¸ª goroutine å¯¹å®ƒé‡å¤è§£é”æ—¶ä¹Ÿåªä¼šæœ‰ä¸€ä¸ªæˆåŠŸï¼Œä½†å…¶ä½™çš„ä¼šæŠ› panicã€‚","like_count":40,"discussions":[{"author":{"id":1295596,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEIBJYQ73yYqmiaU7Zg0BHPh9gpSglI79Dzcbob7I2tZOhTjbTTCw13KzVusYhLbKkukV9Ru5UfJMxQ/132","nickname":"Geek_2d276a","note":"","ucode":"866B39EBE71356","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":264501,"discussion_content":"å¯¹äºç¬¬5ç‚¹ï¼Œåº”è¯¥åŠ ä¸€ä¸ªå®šè¯­â€œå¯¹äºåŒä¸€ä¸ªå†™é”æˆ–äº’æ–¥é”â€ï¼Œå› ä¸ºå¯¹äºè¯»é”æ˜¯å¯ä»¥å¤šæ¬¡åŠ é”çš„ã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1589330933,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1186807,"avatar":"https://static001.geekbang.org/account/avatar/00/12/1b/f7/45e8b64a.jpg","nickname":"Fire","note":"","ucode":"4A2C50B77EDB2C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":340639,"discussion_content":"çœ‹äº†å…±äº«å†…å­˜å’Œä¿¡å·é‡é…åˆçš„è¿›ç¨‹é—´é€šä¿¡æ–¹æ³•ï¼Œåœ¨å¤§è„‘é‡Œæ··ä¸€æ··ç¢°ä¸€ç¢°ï¼Œæ··ä¹±ä¹‹åæ‰èƒ½æ¸…æ™°ã€‚ç¬¬ä¸€éçœ‹ä¸æ‡‚çœ‹æ¥æ˜¯è¾“å…¥ä¸å¤Ÿã€‚å“ˆå“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610084926,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1496889,"avatar":"https://static001.geekbang.org/account/avatar/00/16/d7/39/6698b6a9.jpg","nickname":"Hector","note":"","ucode":"110CAF87ADDC01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":21154,"discussion_content":"ä¸‰åˆ·ä¹‹åï¼Œè±ç„¶å¼€æœ—ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569425054,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":98397,"user_name":"Geek_14c558","can_delete":false,"product_type":"c1","uid":1474702,"ip_address":"","ucode":"2E3BAE6F6D6CD7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI9X140JXPuaK4icMjjd7zJx8BObRv9MO4tuUeV9t9icm4PlZu6m8BFweOsdM8Qs5rTNT5zH0Xs240g/132","comment_is_top":false,"comment_ctime":1558978110,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"87458324030","product_id":100013101,"comment_content":"æˆ‘ç†è§£æ˜¯è¿™æ ·çš„ã€‚æµç¨‹ï¼š å¤–éƒ¨å‡½æ•°åŠ é” -&gt; åˆ¤æ–­æ¡ä»¶å˜é‡-&gt;waitå†…éƒ¨è§£é”-&gt;é˜»å¡ç­‰å¾…ä¿¡å·-&gt;waitå†…éƒ¨åŠ é”-&gt; ä¿®æ”¹æ¡ä»¶å˜é‡-&gt; å¤–éƒ¨è§£é”-&gt; è§¦å‘ä¿¡å·ã€‚ ç¬¬ä¸€æ¬¡åŠ è§£é”æ˜¯ä¸ºäº†ä¿è¯è¯»æ¡ä»¶å˜é‡æ—¶å®ƒä¸ä¼šè¢«ä¿®æ”¹ï¼Œ waitè§£é”æ˜¯ä¸ºäº†æ¡ä»¶å˜é‡èƒ½å¤Ÿè¢«å…¶ä»–çº¿ç¨‹æ”¹å˜ã€‚waitå†…éƒ¨å†æ¬¡åŠ é”ï¼Œæ˜¯å¯¹æ¡ä»¶å˜é‡çš„ä¿æŠ¤ï¼Œå› ä¸ºå¤–éƒ¨è¦ä¿®æ”¹ã€‚ ","like_count":20,"discussions":[{"author":{"id":1496889,"avatar":"https://static001.geekbang.org/account/avatar/00/16/d7/39/6698b6a9.jpg","nickname":"Hector","note":"","ucode":"110CAF87ADDC01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":21155,"discussion_content":"æ„Ÿè°¢æ¢³ç†ï¼Œè‡ªå·±æ¢³ç†ä¸€éæ„Ÿè§‰é€šé€å¤šäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569425125,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117116,"user_name":"ä¸è®°å¹´","can_delete":false,"product_type":"c1","uid":1045945,"ip_address":"","ucode":"287E40C68356DC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f5/b9/888fe350.jpg","comment_is_top":false,"comment_ctime":1563971559,"is_pvip":false,"replies":[{"id":"42961","content":"ä¸ä¼šï¼Œæ‰€ä»¥æˆ‘æ‰è¯´åº”è¯¥ä¼˜å…ˆç”¨ broadcastã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1564020906,"ip_address":"","comment_id":117116,"utype":1}],"discussion_count":1,"race_medal":0,"score":"70283448295","product_id":100013101,"comment_content":"è€å¸ˆï¼Œæˆ‘æœ‰ä¸€ä¸ªç–‘é—®ï¼Œå¯¹äºcondæ¥è¯´ï¼Œæ¯æ¬¡åªå”¤é†’ä¸€ä¸ªgoruntineï¼Œå¦‚æœè¿™ä¹ˆgoruntineå‘ç°æ¶ˆæ¯ä¸æ˜¯è‡ªå·±æƒ³è¦çš„å°±ä¼šä»æ–°é˜»å¡åœ¨waitå‡½æ•°ä¸­ï¼Œé‚£ä¹ˆçœŸæ­£éœ€è¦è¿™ä¸ªæ¶ˆæ¯çš„goruntineè¿˜ä¼šè¢«å”¤é†’å—ï¼Ÿ","like_count":16,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459828,"discussion_content":"ä¸ä¼šï¼Œæ‰€ä»¥æˆ‘æ‰è¯´åº”è¯¥ä¼˜å…ˆç”¨ broadcastã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564020906,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":32453,"user_name":"Laughing","can_delete":false,"product_type":"c1","uid":1002134,"ip_address":"","ucode":"F68F1E000CA800","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4a/96/99466a06.jpg","comment_is_top":false,"comment_ctime":1539576587,"is_pvip":false,"replies":[{"id":"11825","content":"åŠ¨è¿™ä¸ªLä¹‹å‰ä¸€å®šè¦ä¸‰æ€ï¼Œè°¨æ…äº›ï¼Œæƒ³æƒ³æ˜¯ä¸æ˜¯ä¼šå½±å“åˆ°ç¨‹åºã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1539578197,"ip_address":"","comment_id":32453,"utype":1}],"discussion_count":1,"race_medal":0,"score":"53079184139","product_id":100013101,"comment_content":"Lå…¬å¼€å˜é‡ä»£è¡¨condåˆå§‹åŒ–æ—¶ä¼ é€’è¿›æ¥çš„é”ï¼Œè¿™ä¸ªé”çš„çŠ¶æ€æ˜¯å¯ä»¥æ”¹å˜çš„ï¼Œä½†ä¼šå½±å“condå¯¹äº’æ–¥é”çš„æ§åˆ¶ã€‚","like_count":12,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426777,"discussion_content":"åŠ¨è¿™ä¸ªLä¹‹å‰ä¸€å®šè¦ä¸‰æ€ï¼Œè°¨æ…äº›ï¼Œæƒ³æƒ³æ˜¯ä¸æ˜¯ä¼šå½±å“åˆ°ç¨‹åºã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539578197,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":33720,"user_name":"äº‘å­¦","can_delete":false,"product_type":"c1","uid":1027233,"ip_address":"","ucode":"366AE90BA06356","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ac/a1/43d83698.jpg","comment_is_top":false,"comment_ctime":1539862091,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"35899600459","product_id":100013101,"comment_content":"æœ‰ä¸ªç–‘é—®ï¼Œbroadcastå”¤é†’æ‰€æœ‰waitçš„goroutineï¼Œé‚£ä»–ä»¬è¢«å”¤é†’æ—¶éœ€è¦å»åŠ é”(waitè¿”å›)ï¼Œéƒ½èƒ½æˆåŠŸå—ï¼Ÿ","like_count":8,"discussions":[{"author":{"id":1071316,"avatar":"https://static001.geekbang.org/account/avatar/00/10/58/d4/c52f9f6d.jpg","nickname":"èŠå£«è€çˆ¹","note":"","ucode":"5F2935967574D0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3831,"discussion_content":"åŒä¸€æ—¶é—´ï¼Œäº’æ–¥é”åªæœ‰ä¸€ä¸ªèƒ½æˆåŠŸï¼Œè¯»é”å¯ä»¥å¤šä¸ªï¼Œæ²¡æœ‰æ‰“ç ´é”çš„è§„åˆ™ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1564848112,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1008348,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/dc/8876c73b.jpg","nickname":"moooofly","note":"","ucode":"4A20795C281B6F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":14683,"discussion_content":"åº”è¯¥ç†è§£æˆï¼Œä¼šâ€œä¸€ä¸ªä¸€ä¸ªâ€çš„æˆåŠŸï¼Œè€Œä¸æ˜¯â€œåŒæ—¶â€æˆåŠŸï¼›æŒ‰ç…§æˆ‘çš„ç†è§£ï¼Œè™½ç„¶æ˜¯â€œä¸€ä¸ªä¸€ä¸ªâ€çš„æˆåŠŸï¼Œä½†é¡ºåºä¾ç„¶æ˜¯éšæœºçš„ï¼Œè€Œä¸æ˜¯æŒ‰ç…§FIFOçš„é¡ºåº","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1568776805,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":34798,"user_name":"çŒ«ç‹è€…","can_delete":false,"product_type":"c1","uid":1248924,"ip_address":"","ucode":"224826F4BA8443","user_header":"https://static001.geekbang.org/account/avatar/00/13/0e/9c/cb9da823.jpg","comment_is_top":false,"comment_ctime":1540303956,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"23015140436","product_id":100013101,"comment_content":"â€œæˆ‘ä»¬æœ€å¥½åœ¨è§£é”æ¡ä»¶å˜é‡åŸºäºçš„é‚£ä¸ªäº’æ–¥é”ä¹‹åï¼Œå†å»è°ƒç”¨å®ƒçš„è¿™ä¸¤ä¸ªæ–¹æ³•ï¼ˆsignalå’ŒBroadcastï¼‰ã€‚è¿™æ›´æœ‰åˆ©äºç¨‹åºçš„è¿è¡Œæ•ˆç‡â€    è¿™ä¸ªåº”è¯¥å¦‚ä½•ç†è§£ï¼Ÿ<br><br>æˆ‘çš„ç†è§£æ˜¯å¦‚æœå…ˆè°ƒç”¨signalæ–¹æ³•ï¼Œç„¶ååœ¨unlockè§£é”ï¼Œå¦‚æœåœ¨è¿™ä¸¤ä¸ªæ“ä½œä¸­é—´è¯¥çº¿ç¨‹å¤±å»cpuï¼Œæˆ–è€…æˆ‘äººä¸ºçš„åœ¨siganlå’Œunlockä¹‹é—´è°ƒç”¨time.Sleep();åœ¨å¦ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ä¸­å³ä½¿è¯¥ç­‰å¾…çº¿ç¨‹è¢«å‰è€…æ‰€å‘å‡ºçš„signalå”¤é†’ï¼Œä½†æ˜¯å”¤é†’çš„æ—¶å€™åŒæ—¶ä¼šå»è¿›è¡Œlockæ“ä½œï¼Œä½†æ˜¯å‰è€…çš„çº¿ç¨‹ä¸­ç”±äºå¤±å»äº†cpuï¼Œå¹¶æ²¡æœ‰è°ƒç”¨unlockï¼Œé‚£ä¹ˆè¿™æ¬¡å”¤é†’ä¸æ˜¯åº”è¯¥å¤±è´¥äº†å—ï¼Œå³ä½¿å‰è€…æœ‰å¾—åˆ°äº†cpuå»æ‰§è¡Œäº†unlcokï¼Œä½†æ˜¯signalæ“ä½œå…·æœ‰åŠæ—¶æ€§ï¼Œç­‰å¾…çº¿ç¨‹ä¸æ˜¯åº”è¯¥ç»§ç»­ç­‰å¾…ä¸‹ä¸€ä¸ªsignalå—ï¼Œæ„Ÿè§‰æœ€åä¼šå˜æˆæ­»é”å•Š<br><br>","like_count":5,"discussions":[{"author":{"id":1799937,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKSVGSo9leSm0vhtHgzIOL7uaJhOcaImuIzLIrVhXUNPmhd9HGIxs0nWIQm5RTCEjwJ6IuG3moOdQ/132","nickname":"Geek_f1933b","note":"","ucode":"9045A7ED2B2A69","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":165499,"discussion_content":"åº”è¯¥ä¸ä¼šæ­»é”ï¼Œä¸¤ä¸ªgoroutineéƒ½åªä½¿ç”¨çš„æ˜¯åŒä¸€æŠŠé”ï¼Œä¸å…·å¤‡æ­»é”çš„æ¡ä»¶å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581298101,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1505155,"avatar":"https://static001.geekbang.org/account/avatar/00/16/f7/83/7fa4bd45.jpg","nickname":"è¶£å­¦è½¦","note":"","ucode":"5279A6BF4C67A3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1799937,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKSVGSo9leSm0vhtHgzIOL7uaJhOcaImuIzLIrVhXUNPmhd9HGIxs0nWIQm5RTCEjwJ6IuG3moOdQ/132","nickname":"Geek_f1933b","note":"","ucode":"9045A7ED2B2A69","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":325142,"discussion_content":"Aå‘é€ä¿¡å·ï¼Œç„¶åè¢«é˜»å¡->Bæ¥æ”¶åˆ°ä¿¡å·è¢«å”¤é†’ï¼Œå°è¯•è·å–é”ï¼Œç”±äºAæ²¡æœ‰è§£é”ï¼ŒBè¿™é‡Œä¼šé˜»å¡->Aè·å¾—æ‰§è¡Œæƒåæ‰§è¡Œè§£é”æ“ä½œ->Bè·å¾—æ‰§è¡ŒæƒååŠ é”æˆåŠŸï¼Œç»§ç»­æ‰§è¡Œã€‚\nè¿™é‡Œçš„Bè¢«å”¤é†’åç”±äºAæ²¡æœ‰è§£é”æ‰€ä»¥åˆè¢«é˜»å¡äº†ï¼Œ è¿™åº”è¯¥å°±æ˜¯è€å¸ˆè¯´çš„æ•ˆç‡é—®é¢˜å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605244738,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":165499,"ip_address":""},"score":325142,"extra":""}]}]},{"had_liked":false,"id":37934,"user_name":"æ‰“ä½ ","can_delete":false,"product_type":"c1","uid":1075199,"ip_address":"","ucode":"18403CA411C6C7","user_header":"https://static001.geekbang.org/account/avatar/00/10/67/ff/d4f31b87.jpg","comment_is_top":false,"comment_ctime":1541815609,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18721684793","product_id":100013101,"comment_content":"åœ¨çœ‹äº†ä¸€éï¼Œæ¸…æ¥šäº†","like_count":4},{"had_liked":false,"id":196675,"user_name":"Lywane","can_delete":false,"product_type":"c1","uid":1446512,"ip_address":"","ucode":"2B0027AA069CE9","user_header":"https://static001.geekbang.org/account/avatar/00/16/12/70/10faf04b.jpg","comment_is_top":false,"comment_ctime":1585301928,"is_pvip":false,"replies":[{"id":"74608","content":"é¦–å…ˆè¿˜æ˜¯è¦æ˜ç¡®è¿™ä¸ªè¿‡ç¨‹ï¼šsendCond.Wait() ä¼šå…ˆè§£é”å†é˜»å¡å½“å‰çš„ goroutineï¼Œç„¶åç­‰åˆ°åˆ«çš„åœ°æ–¹è°ƒç”¨ sendCond.Signal() åï¼Œè¿™é‡Œçš„ sendCond.Wait() ä¼šåŠ é”å¹¶å”¤é†’å½“å‰çš„ goroutineã€‚<br><br>å‡è®¾æœ‰å¤šä¸ª goroutine éƒ½è°ƒç”¨äº† sendCond.Wait() æ–¹æ³•ï¼Œå¦‚æœå®ƒä»¬æ‰€åœ¨çš„ goroutine éƒ½å› æ¡ä»¶å˜é‡çš„é€šçŸ¥è€Œè¢«å”¤é†’ï¼Œé‚£ä¹ˆï¼ˆç”±äºé”çš„ç¼˜æ•…ï¼‰åªæœ‰ä¸€ä¸ª goroutine ï¼ˆä»¥ä¸‹ç§°â€œ1å·Gâ€ï¼‰èƒ½å¤Ÿç‡å…ˆå†æ¬¡æ£€æŸ¥ mailboxã€‚<br><br>â€œ1å·Gâ€å‘ç° mailbox çš„å€¼å·²ç»ä¸æ˜¯ 1 äº†ï¼Œéšå³é€€å‡ºå¾ªç¯ï¼Œå¹¶ä¸”åˆæŠŠ mailbox çš„å€¼è®¾ç½®æˆäº† 1ã€‚æœ€åè§£é”ï¼Œå¹¶ç»™ recvCond å‘é€šçŸ¥ã€‚<br><br>ç”±äºâ€œ1å·Gâ€çš„è§£é”ï¼Œâ€œ2å·Gâ€ã€â€œ3å·Gâ€ç­‰ç­‰ï¼ˆå…¶ä»–è°ƒç”¨äº† sendCond.Wait() æ–¹æ³•çš„Gï¼‰éƒ½ä¼šç«äº‰è¿™ä¸ªé”ã€‚å¾—åˆ°è¯¥é”æ§åˆ¶æƒçš„æŸä¸ªGä¼šå†é”ä½è¿™ä¸ªé”ï¼Œç„¶åå‘ç° mailbox çš„å€¼ä¾ç„¶æ˜¯ 1ï¼Œéšå³å†æ¬¡è°ƒç”¨ sendCond.Wait() æ–¹æ³•ï¼Œå¹¶ç»§ç»­ç­‰å¾…è¿™ä¸ªæ¡ä»¶å˜é‡çš„ä¸‹ä¸€ä¸ªé€šçŸ¥ã€‚å…¶ä»–çš„Gä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚<br><br>è¿™ä¸ªåœºæ™¯å’Œè¿‡ç¨‹è¦æƒ³æ¸…æ¥šã€‚å¯ä»¥è‡ªå·±ç”»å‡ æ¡å¹³è¡Œçº¿ï¼Œç„¶åæ¨¡æ‹Ÿä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1585391789,"ip_address":"","comment_id":196675,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14470203816","product_id":100013101,"comment_content":"```<br>\tlock.Lock()<br>\tfor mailbox == 1 {<br>\t\tsendCond.Wait()<br>\t}<br>\tmailbox = 1<br>\tlock.Unlock()<br>\trecvCond.Signal()<br>```<br>åªè¦å…±äº«èµ„æºçš„çŠ¶æ€ä¸å˜ï¼Œå³ä½¿å½“å‰çš„ goroutine å› æ”¶åˆ°é€šçŸ¥è€Œè¢«å”¤é†’ï¼Œä¹Ÿä¾ç„¶ä¼šå†æ¬¡æ‰§è¡Œè¿™ä¸ªWaitæ–¹æ³•ï¼Œå¹¶å†æ¬¡è¢«é˜»å¡ã€‚<br><br>è€å¸ˆæˆ‘å¯¹è¿™å¥è¯æœ‰ä¸ªç–‘é—®ï¼Œå‡è®¾Waitä¸è§£é”ï¼Œç›´æ¥é˜»å¡äº†å½“å‰goroutineï¼Œé‚£ä¹ˆå½“æ”¶åˆ°é€šçŸ¥æ—¶ï¼Œmailboxçš„å€¼åº”è¯¥å·²ç»è¢«æ”¹æˆ0äº†ï¼Œæ­¤æ—¶å”¤é†’ï¼Œåº”è¯¥ä¸æ»¡è¶³forå¾ªç¯æ¡ä»¶äº†å‘€ï¼Œä¸ºä»€ä¹ˆä¼šå†æ¬¡æ‰§è¡ŒWaitæ–¹æ³•å‘¢ï¼Ÿ<br><br>æˆ‘æ€è€ƒçš„ç»“è®ºæ˜¯ï¼šWaitè§£é”æ˜¯ä¸ºäº†è®©å…¶ä»–goroutineå»ä¿®æ”¹mailboxçš„å€¼ï¼Œä¸çŸ¥é“è¿™ä¹ˆç†è§£å¯¹å—ã€‚","like_count":3,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489356,"discussion_content":"é¦–å…ˆè¿˜æ˜¯è¦æ˜ç¡®è¿™ä¸ªè¿‡ç¨‹ï¼šsendCond.Wait() ä¼šå…ˆè§£é”å†é˜»å¡å½“å‰çš„ goroutineï¼Œç„¶åç­‰åˆ°åˆ«çš„åœ°æ–¹è°ƒç”¨ sendCond.Signal() åï¼Œè¿™é‡Œçš„ sendCond.Wait() ä¼šåŠ é”å¹¶å”¤é†’å½“å‰çš„ goroutineã€‚\n\nå‡è®¾æœ‰å¤šä¸ª goroutine éƒ½è°ƒç”¨äº† sendCond.Wait() æ–¹æ³•ï¼Œå¦‚æœå®ƒä»¬æ‰€åœ¨çš„ goroutine éƒ½å› æ¡ä»¶å˜é‡çš„é€šçŸ¥è€Œè¢«å”¤é†’ï¼Œé‚£ä¹ˆï¼ˆç”±äºé”çš„ç¼˜æ•…ï¼‰åªæœ‰ä¸€ä¸ª goroutine ï¼ˆä»¥ä¸‹ç§°â€œ1å·Gâ€ï¼‰èƒ½å¤Ÿç‡å…ˆå†æ¬¡æ£€æŸ¥ mailboxã€‚\n\nâ€œ1å·Gâ€å‘ç° mailbox çš„å€¼å·²ç»ä¸æ˜¯ 1 äº†ï¼Œéšå³é€€å‡ºå¾ªç¯ï¼Œå¹¶ä¸”åˆæŠŠ mailbox çš„å€¼è®¾ç½®æˆäº† 1ã€‚æœ€åè§£é”ï¼Œå¹¶ç»™ recvCond å‘é€šçŸ¥ã€‚\n\nç”±äºâ€œ1å·Gâ€çš„è§£é”ï¼Œâ€œ2å·Gâ€ã€â€œ3å·Gâ€ç­‰ç­‰ï¼ˆå…¶ä»–è°ƒç”¨äº† sendCond.Wait() æ–¹æ³•çš„Gï¼‰éƒ½ä¼šç«äº‰è¿™ä¸ªé”ã€‚å¾—åˆ°è¯¥é”æ§åˆ¶æƒçš„æŸä¸ªGä¼šå†é”ä½è¿™ä¸ªé”ï¼Œç„¶åå‘ç° mailbox çš„å€¼ä¾ç„¶æ˜¯ 1ï¼Œéšå³å†æ¬¡è°ƒç”¨ sendCond.Wait() æ–¹æ³•ï¼Œå¹¶ç»§ç»­ç­‰å¾…è¿™ä¸ªæ¡ä»¶å˜é‡çš„ä¸‹ä¸€ä¸ªé€šçŸ¥ã€‚å…¶ä»–çš„Gä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚\n\nè¿™ä¸ªåœºæ™¯å’Œè¿‡ç¨‹è¦æƒ³æ¸…æ¥šã€‚å¯ä»¥è‡ªå·±ç”»å‡ æ¡å¹³è¡Œçº¿ï¼Œç„¶åæ¨¡æ‹Ÿä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585391789,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":120117,"user_name":"æ¨‚æ–‡ğŸ’¤","can_delete":false,"product_type":"c1","uid":1073694,"ip_address":"","ucode":"CE4A46397521FC","user_header":"https://static001.geekbang.org/account/avatar/00/10/62/1e/8054e6db.jpg","comment_is_top":false,"comment_ctime":1564794906,"is_pvip":false,"replies":[{"id":"44116","content":"æ€»æ˜¯éœ€è¦ç”¨ for çš„ï¼Œå› ä¸ºä½ æ²¡æ³•ä¿è¯æ”¶åˆ°ä¿¡å·ä¹‹åé‚£ä¸ªçŠ¶æ€å°±ä¸€å®šæ˜¯ä½ æƒ³è¦çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1564807161,"ip_address":"","comment_id":120117,"utype":1}],"discussion_count":3,"race_medal":0,"score":"10154729498","product_id":100013101,"comment_content":"æ‰€ä»¥å¦‚æœç”¨çš„signalæ–¹æ³•åªé€šçŸ¥ä¸€ä¸ªgo routineçš„è¯ æ¡ä»¶å˜é‡çš„åˆ¤æ–­æ–¹æ³•æ”¹æˆifåº”è¯¥æ˜¯æ²¡é—®é¢˜çš„ ä½†å¦‚æœæ˜¯å¤šä¸ªgo routine åŒæ—¶è¢«å”¤é†’å°±å¯èƒ½å¯¼è‡´å¤šä¸ªgo routine åœ¨ä¸æ»¡è¶³å”¤é†’çŠ¶æ€çš„æ—¶å€™è¢«å”¤é†’è€Œå¯¼è‡´å¤„ç†é”™è¯¯ï¼Œè¿™æ—¶å€™å°±å¿…é¡»ç”¨foræ¥ä¸æ–­åœ°è¿›è¡Œæ£€æµ‹å¯ä»¥è¿™ä¹ˆç†è§£ä¹ˆ","like_count":2,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":461205,"discussion_content":"æ€»æ˜¯éœ€è¦ç”¨ for çš„ï¼Œå› ä¸ºä½ æ²¡æ³•ä¿è¯æ”¶åˆ°ä¿¡å·ä¹‹åé‚£ä¸ªçŠ¶æ€å°±ä¸€å®šæ˜¯ä½ æƒ³è¦çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564807161,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1073694,"avatar":"https://static001.geekbang.org/account/avatar/00/10/62/1e/8054e6db.jpg","nickname":"æ¨‚æ–‡ğŸ’¤","note":"","ucode":"CE4A46397521FC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3765,"discussion_content":"é‡æ–°æ€è€ƒäº†ä¸€ä¸‹æˆ‘åˆšè¯´çš„æ˜¯ä¸å¯¹çš„ å¦‚æœè¦æƒ³ifå’Œforæ•ˆæœç­‰åŒ é™¤äº†æ˜¯åªå”¤é†’ä¸€ä¸ªçº¿ç¨‹ä»¥å¤–è¿˜éœ€è¦ä»–ä»¬æ‰§è¡Œwaitçš„æ¡ä»¶æ˜¯å•ä¸€çš„ å³åªæœ‰0å’Œ1ä¸¤ç§æƒ…å†µ å› ä¸ºå¦‚æœåˆ«çš„çº¿ç¨‹åœ¨2çš„æ—¶å€™æ‰§è¡Œäº†signal è¿™æ—¶å€™ä¹Ÿæ˜¯ä¸åº”è¯¥è¢«å”¤é†’çš„ éœ€è¦ä¸€ç›´ç”¨forå»æ£€æµ‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564795835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1071316,"avatar":"https://static001.geekbang.org/account/avatar/00/10/58/d4/c52f9f6d.jpg","nickname":"èŠå£«è€çˆ¹","note":"","ucode":"5F2935967574D0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1073694,"avatar":"https://static001.geekbang.org/account/avatar/00/10/62/1e/8054e6db.jpg","nickname":"æ¨‚æ–‡ğŸ’¤","note":"","ucode":"CE4A46397521FC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3838,"discussion_content":"æ–‡ä¸­è¯´äº†æœ‰ä¸€ç§æƒ…å†µä¸æ˜¯å› ä¸ºç«Ÿæ€æ¡ä»¶æ”¹å˜è€Œè¢«å”¤é†’ï¼Œä¹Ÿå°±æ˜¯ä¸æ˜¯è¢«singleæˆ–è€…broadcastå”¤é†’ï¼Œè€Œæ˜¯å› ä¸ºç¡¬ä»¶æˆ–è€…æ“ä½œç³»ç»Ÿçš„åŸå› è«åè¢«å”¤é†’ï¼Œè¿™æ—¶å€™forå¯ä»¥å¸®åŠ©å†æ¬¡è¿›å»waitï¼Œé¿å…ä¸€äº›é”™è¯¯ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564848696,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":3765,"ip_address":""},"score":3838,"extra":""}]}]},{"had_liked":false,"id":49360,"user_name":"ç”¦","can_delete":false,"product_type":"c1","uid":1283022,"ip_address":"","ucode":"9A4D52FDB3A93B","user_header":"https://static001.geekbang.org/account/avatar/00/13/93/ce/d4ac6fae.jpg","comment_is_top":false,"comment_ctime":1544670509,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"10134605101","product_id":100013101,"comment_content":"æºç é—®é¢˜é—®ä¸€ä¸‹éƒè€å¸ˆï¼Œcond waitæ–¹æ³•é‡Œï¼Œå¤šä¸ªåç¨‹èµ°åˆ°c.L.Unlock()é‚£ä¸€æ­¥ä¸ä¼šå‡ºé—®é¢˜å—ï¼Ÿ åªæœ‰ä¸€ä¸ªåç¨‹å¯ä»¥unlockæˆåŠŸï¼Œå…¶ä»–åç¨‹é‡å¤unlockä¸å°±panicäº†å—ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1171471,"avatar":"https://static001.geekbang.org/account/avatar/00/11/e0/0f/12e08ce9.jpg","nickname":"å°å¥•","note":"","ucode":"5294DD5895D602","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":319181,"discussion_content":"routine A æŠ¢åˆ°l.Lock()æƒåï¼Œå…¶ä»–routineéƒ½é˜»å¡åœ¨l.Lock()å¤„ã€‚å¾…routine Aæ‰§è¡Œå®Œc.L.Unlock()æ–¹æ³•è¿›å…¥é˜»å¡çŠ¶æ€åï¼Œå…¶ä»–routineç»§ç»­ç«äº‰l.Lock()æƒã€‚æ–°ç«äº‰åˆ°l.Lock()æƒçš„routineåŒæ ·å…ˆl.Lock()å†c.L.Unlock()ï¼Œæ­¤æ—¶è¯¥é”å¤„äºLockçŠ¶æ€ï¼Œæ•…ä¸ä¼španicã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1603957707,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1198125,"avatar":"https://static001.geekbang.org/account/avatar/00/12/48/2d/7a3d42fb.jpg","nickname":"Alan","note":"","ucode":"9C66CBCFB3A109","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":126229,"discussion_content":"æ¯ä¸ªåç¨‹æŒæœ‰çš„æ˜¯å½“å‰è‡ªå·±çš„lock,ä¸æ˜¯åŒä¸€ä¸ª,æ‰€è°“çš„é‡å¤unlockåªå¯¹åŒä¸€ä¸ªlockè€Œè¨€çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578497994,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":37932,"user_name":"æ‰“ä½ ","can_delete":false,"product_type":"c1","uid":1075199,"ip_address":"","ucode":"18403CA411C6C7","user_header":"https://static001.geekbang.org/account/avatar/00/10/67/ff/d4f31b87.jpg","comment_is_top":false,"comment_ctime":1541815181,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"10131749773","product_id":100013101,"comment_content":"lock.Lock()<br>for mailbox == 1 {<br> sendCond.Wait()<br>}<br>mailbox = 1<br>lock.Unlock()<br>recvCond.Signal()<br>å¦‚æœwaitå·²ç»è§£é”lock.Lock()é”ä½çš„é”ï¼Œåé¢lock.Unlockè§£é”æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿä¸ä¼španicã€‚<br>æ¡ä»¶å˜é‡è¿™2ç¯‡çœ‹èµ·æ¥å‰åç†è§£ä¸åˆ°","like_count":2,"discussions":[{"author":{"id":1176461,"avatar":"https://static001.geekbang.org/account/avatar/00/11/f3/8d/477ab4b7.jpg","nickname":"åƒæ‰‹æŸ±é—´","note":"","ucode":"9B51A734DF791C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":9462,"discussion_content":"æˆ‘çš„ç†è§£æ˜¯ï¼Œwaitçš„æ—¶å€™goroutineå°±é˜»å¡äº†ï¼Œä»£ç å°±ä¸å¾€ä¸‹èµ°äº†ã€‚ç›´åˆ°waitæ¥åˆ°é€šçŸ¥å”¤é†’goroutine,è€Œè¿™ä¸ªæ—¶å€™ä¼šé‡æ–°åŠ é”","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1568170699,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1740409,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/8e/79/f9d5dd3a.jpg","nickname":"å•è¶…","note":"","ucode":"B36883984BE16B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":190551,"discussion_content":"func (c *Cond) Wait() {\n\tc.checker.check()\n\tt := runtime_notifyListAdd(&amp;c.notify)\n\tc.L.Unlock()\n\truntime_notifyListWait(&amp;c.notify, t)\n\tc.L.Lock()\n}\nè¿™ä¸ªæ˜¯cond.Waitçš„æºç ï¼Œå†è¢«notifyä¹‹åï¼Œä¼šé‡æ–°é”ä¸Š","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1582958121,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1198125,"avatar":"https://static001.geekbang.org/account/avatar/00/12/48/2d/7a3d42fb.jpg","nickname":"Alan","note":"","ucode":"9C66CBCFB3A109","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":126202,"discussion_content":"waitç¬¬å››ä»¶äº‹é‡æ–°é”å®šï¼Œå¯¹åº”è‡ªå·±å†™çš„unlock","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578497772,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":238718,"user_name":"æ‰‹æŒ‡é¥¼å¹²","can_delete":false,"product_type":"c1","uid":1048607,"ip_address":"","ucode":"1AC502D2B782F0","user_header":"","comment_is_top":false,"comment_ctime":1596271343,"is_pvip":false,"replies":[{"id":"88207","content":"é¦–å…ˆè¦æ˜ç¡®ï¼š<br><br>æ¡ä»¶å˜é‡çš„è¿™ä¸¤ä¸ªæ–¹æ³•å¹¶ä¸éœ€è¦å—åˆ°äº’æ–¥é”çš„ä¿æŠ¤ï¼Œæˆ‘ä»¬ä¹Ÿæœ€å¥½ä¸è¦åœ¨è§£é”äº’æ–¥é”ä¹‹å‰è°ƒç”¨å®ƒä»¬ã€‚<br><br>å…¶æ¬¡ï¼š<br><br>ç­‰å¾…æ–¹æ³•å¯¹é”çš„æ“ä½œä¸»è¦æ˜¯ä¸ºäº†è®©å¤šä¸ªç­‰å¾…æ–¹æœ‰ç§©åºçš„è¡Œäº‹ã€‚åœ¨çœŸæ­£ç­‰å¾…å‰é‡Šæ”¾é”ï¼Œæ˜¯ä¸ºäº†è®©å…¶ä»–çš„ç­‰å¾…æ–¹ä¹Ÿå…·æœ‰è¿›å…¥ç­‰å¾…çŠ¶æ€çš„æ¡ä»¶ã€‚åœ¨å”¤é†’ä¹‹åå†æ¬¡è¯•å›¾æŒæœ‰é”ï¼Œæ˜¯ä¸ºäº†è®©å¤šä¸ªç­‰å¾…æ–¹ä¸²è¡Œåœ°æ£€æŸ¥æ¡ä»¶æ˜¯å¦æ»¡è¶³ä»¥åŠæ‰§è¡Œåç»­çš„æ“ä½œã€‚<br><br>æ‰€ä»¥ï¼Œç»“è®ºæ˜¯ï¼š<br><br>å‘é€æ–¹åœ¨å‘é€é€šçŸ¥çš„æ—¶å€™æœ€å¥½ä¸è¦æŒæœ‰ç­‰å¾…æ–¹æ“ä½œçš„é‚£ä¸ªé”ã€‚è€Œç­‰å¾…æ–¹ï¼Œåº”è¯¥åœ¨ç­‰å¾…çš„æ—¶å€™æŒæœ‰é”åŠ ä»¥ä¿æŠ¤ã€‚<br><br>æœ€åï¼š<br><br>å…³äºä½ çš„æœ€åä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœ mutex æ˜¯ç­‰å¾…æ–¹æ“ä½œçš„é‚£ä¸ªé”ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½äº§ç”Ÿå‘é€æ–¹ä¸ç­‰å¾…æ–¹çš„äº’æ–¥é—®é¢˜ã€‚ç”±äºç­‰å¾…æ–¹ä¼šåœ¨çœŸæ­£ç­‰å¾…ä¹‹å‰é‡Šæ”¾é”ï¼Œæ‰€ä»¥åº”è¯¥ä¸ä¼šäº§ç”Ÿå®Œå…¨æ­»é”çš„æƒ…å†µã€‚ä½†æ˜¯ï¼Œè¿™ç§æ²¡å¿…è¦çš„æ“ä½œè‚¯å®šä¼šå½±å“ç¨‹åºçš„æ•ˆç‡ã€‚<br><br>å¦‚æœ mutex ä¸ç­‰å¾…æ–¹æ²¡å…³ç³»ï¼Œé‚£å°±æ— æ‰€è°“äº†ã€‚ä½ å¯ä»¥æ ¹æ®â€œæ˜¯å¦æƒ³ä¸²è¡ŒåŒ–é€šçŸ¥çš„å‘é€æ“ä½œâ€æ¥å†³å®šæ˜¯å¦åŠ é”ã€‚ä¸è¿‡è¿™é€šå¸¸ä¹Ÿæ²¡ä»€ä¹ˆå¿…è¦ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1596346997,"ip_address":"","comment_id":238718,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5891238639","product_id":100013101,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œå…³äºå‘é€é€šçŸ¥æ˜¯å¦éœ€è¦åœ¨é”çš„ä¿æŠ¤ä¸‹è°ƒç”¨ï¼Œè¿˜æ˜¯æœ‰äº›ç–‘é—®ï¼Œä»¥ä¸‹æƒ³æ³•è¯·è€å¸ˆå¸®å¿™çœ‹çœ‹æ˜¯å¦ç†è§£æ­£ç¡®ï¼š<br>ä¸€ä¸ªåœ¨ç­‰å¾…é€šçŸ¥çš„ goroutine æ”¶åˆ°é€šçŸ¥ä¿¡å·è¢«å”¤é†’ï¼Œæ¥ä¸‹æ¥æ‰§è¡Œçš„æ˜¯æ¡ä»¶å˜é‡ c.L.Lock() æ“ä½œï¼Œæ— è®ºä¿¡å·çš„å‘é€æ–¹æ˜¯å¦æ˜¯åœ¨é”çš„ä¿æŠ¤ä¸‹å‘é€ä¿¡å·ï¼Œè¯¥ goroutine å·²ç»ä¸æ˜¯åœ¨ç­‰å¾…é€šçŸ¥çš„çŠ¶æ€äº†ï¼Œè€Œæ˜¯åœ¨å°è¯•è·å–é”çš„çŠ¶æ€ï¼Œå³ä½¿è¢«é˜»å¡ï¼Œä¹Ÿæ˜¯å› ä¸ºè·å–ä¸åˆ°é”ã€‚åŒºåˆ«åªæ˜¯ï¼Œå¦‚æœä¿¡å·å‘é€æ–¹åœ¨ Unlock() ä¹‹åå‘é€ä¿¡å·ï¼Œé‚£ä¹ˆè¯¥ goroutine è¢«å”¤é†’åè·å¾—é”å¯èƒ½ä¼šè¡”æ¥å¾—æ›´å¥½ä¸€ç‚¹ã€‚<br>å¯¹äºæŸäº›åœºæ™¯ï¼Œæ¯”å¦‚è¯´å‡½æ•°çš„å¼€å¤´ä¸¤è¡Œä»£ç å°±æ˜¯<br>mutex.Lock() <br>defer mutex.Unlock()<br>è¿™ç§æƒ…å†µæ˜¯å¦å¯ä»¥å…è®¸é€šçŸ¥åœ¨ Unlock() ä¹‹å‰è°ƒç”¨","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":502835,"discussion_content":"é¦–å…ˆè¦æ˜ç¡®ï¼š\n\næ¡ä»¶å˜é‡çš„è¿™ä¸¤ä¸ªæ–¹æ³•å¹¶ä¸éœ€è¦å—åˆ°äº’æ–¥é”çš„ä¿æŠ¤ï¼Œæˆ‘ä»¬ä¹Ÿæœ€å¥½ä¸è¦åœ¨è§£é”äº’æ–¥é”ä¹‹å‰è°ƒç”¨å®ƒä»¬ã€‚\n\nå…¶æ¬¡ï¼š\n\nç­‰å¾…æ–¹æ³•å¯¹é”çš„æ“ä½œä¸»è¦æ˜¯ä¸ºäº†è®©å¤šä¸ªç­‰å¾…æ–¹æœ‰ç§©åºçš„è¡Œäº‹ã€‚åœ¨çœŸæ­£ç­‰å¾…å‰é‡Šæ”¾é”ï¼Œæ˜¯ä¸ºäº†è®©å…¶ä»–çš„ç­‰å¾…æ–¹ä¹Ÿå…·æœ‰è¿›å…¥ç­‰å¾…çŠ¶æ€çš„æ¡ä»¶ã€‚åœ¨å”¤é†’ä¹‹åå†æ¬¡è¯•å›¾æŒæœ‰é”ï¼Œæ˜¯ä¸ºäº†è®©å¤šä¸ªç­‰å¾…æ–¹ä¸²è¡Œåœ°æ£€æŸ¥æ¡ä»¶æ˜¯å¦æ»¡è¶³ä»¥åŠæ‰§è¡Œåç»­çš„æ“ä½œã€‚\n\næ‰€ä»¥ï¼Œç»“è®ºæ˜¯ï¼š\n\nå‘é€æ–¹åœ¨å‘é€é€šçŸ¥çš„æ—¶å€™æœ€å¥½ä¸è¦æŒæœ‰ç­‰å¾…æ–¹æ“ä½œçš„é‚£ä¸ªé”ã€‚è€Œç­‰å¾…æ–¹ï¼Œåº”è¯¥åœ¨ç­‰å¾…çš„æ—¶å€™æŒæœ‰é”åŠ ä»¥ä¿æŠ¤ã€‚\n\næœ€åï¼š\n\nå…³äºä½ çš„æœ€åä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœ mutex æ˜¯ç­‰å¾…æ–¹æ“ä½œçš„é‚£ä¸ªé”ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½äº§ç”Ÿå‘é€æ–¹ä¸ç­‰å¾…æ–¹çš„äº’æ–¥é—®é¢˜ã€‚ç”±äºç­‰å¾…æ–¹ä¼šåœ¨çœŸæ­£ç­‰å¾…ä¹‹å‰é‡Šæ”¾é”ï¼Œæ‰€ä»¥åº”è¯¥ä¸ä¼šäº§ç”Ÿå®Œå…¨æ­»é”çš„æƒ…å†µã€‚ä½†æ˜¯ï¼Œè¿™ç§æ²¡å¿…è¦çš„æ“ä½œè‚¯å®šä¼šå½±å“ç¨‹åºçš„æ•ˆç‡ã€‚\n\nå¦‚æœ mutex ä¸ç­‰å¾…æ–¹æ²¡å…³ç³»ï¼Œé‚£å°±æ— æ‰€è°“äº†ã€‚ä½ å¯ä»¥æ ¹æ®â€œæ˜¯å¦æƒ³ä¸²è¡ŒåŒ–é€šçŸ¥çš„å‘é€æ“ä½œâ€æ¥å†³å®šæ˜¯å¦åŠ é”ã€‚ä¸è¿‡è¿™é€šå¸¸ä¹Ÿæ²¡ä»€ä¹ˆå¿…è¦ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596346997,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":123082,"user_name":"Geek_a8be59","can_delete":false,"product_type":"c1","uid":1563985,"ip_address":"","ucode":"BEC0F57B51DC44","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKdiaUiaCYQe9tibemaNU5ya7RrU3MYcSGEIG7zF27u0ZDnZs5lYxPb7KPrAsj3bibM79QIOnPXAatfIw/132","comment_is_top":false,"comment_ctime":1565602339,"is_pvip":false,"replies":[{"id":"45480","content":"æˆ‘è®°å¾—åœ¨ä¹¦é‡Œä¹Ÿè¯´è¿‡ç±»ä¼¼çš„å†…å®¹ï¼šæ¡ä»¶å˜é‡å¸¸ç”¨äºå¯¹å…±äº«èµ„æºçš„çŠ¶æ€å˜åŒ–çš„ç›‘æ§å’Œå“åº”ï¼ˆç”±æ­¤å¯ä»¥å®ç°çŠ¶æ€æœºï¼‰ï¼ŒåŒæ—¶ä¹Ÿæ¯”è¾ƒé€‚åˆå¸®åŠ©å¤šä¸ªçº¿ç¨‹åä½œæ“ä½œåŒä¸€ä¸ªå…±äº«èµ„æºï¼ˆè¿™é‡Œçš„å…³é”®è¯æ˜¯åä½œï¼‰ã€‚<br><br>æ¡ä»¶å˜é‡æœ‰ä¸¤ç§é€šçŸ¥æœºåˆ¶ï¼Œè¿™æ˜¯äº’æ–¥é‡æ²¡æœ‰çš„ã€‚äº’æ–¥é‡åªèƒ½ä¿æŠ¤å…±äº«èµ„æºï¼ˆè¿™é‡Œçš„å…³é”®è¯æ˜¯ä¿æŠ¤ï¼‰ï¼ŒåŠŸèƒ½æ¯”è¾ƒå•ä¸€ã€‚æ‰€ä»¥æ¡ä»¶å˜é‡åœ¨ä¸€äº›åœºæ™¯ä¸‹ä¼šæ›´é«˜æ•ˆã€‚<br><br>ä½ è‡ªå·±ä¹Ÿè¯´å‡ºäº†ä¸€äº›ä½¿ç”¨ä¸¤ä¸ªäº’æ–¥é”æ¥åšçš„å¼Šç«¯ã€‚è¿™äº›å¼Šç«¯å…¶å®å°±å·²ç»æ¯”è¾ƒé—¹å¿ƒäº†ã€‚ä¸€ä¸ªæ˜¯ç”¨ä¸¤ä¸ªé”å¯¹æ€§èƒ½çš„å½±å“ï¼Œä¸€ä¸ªæ˜¯ä¸¤ä¸ªé”å¦‚æœé…åˆä¸å½“å°±ä¼šé€ æˆå±€éƒ¨çš„æ­»é”ã€‚è¿™è¿˜æ˜¯å¤šæ–¹åä½œæ“ä½œåŒä¸€ä¸ªå…±äº«èµ„æºä¸­æœ€ç®€å•çš„æƒ…å†µã€‚<br><br>å†åŠ ä¸Šæˆ‘å‰é¢è¯´çš„é‚£äº›ï¼Œæ¡ä»¶å˜é‡åœ¨æ­¤ç±»åœºæ™¯ä¸‹çš„ä¼˜åŠ¿å·²ç»éå¸¸æ˜æ˜¾äº†ã€‚æ³¨æ„å®ƒåœ¨Waitæ—¶è¿˜æœ‰åŸå­çº§çš„æ“ä½œå‘¢ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1565794919,"ip_address":"","comment_id":123082,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5860569635","product_id":100013101,"comment_content":"è€å®æ‚¨å¥½ï¼Œä¸å¤ªæ˜ç™½ä¸ºä»€ä¹ˆä¸€å®šè¦ç”¨æ¡ä»¶å˜é‡å‘¢ã€‚æˆ‘çœ‹äº† goå¹¶å‘ç¼–ç¨‹ç¬¬2ç‰ˆå’Œä½ è¿™è¾¹çš„åšäº†å¯¹åº”ï¼Œä¹¦ä¸Šæ˜¯å·²ç”Ÿæˆè€…æ¶ˆè´¹è€…ä¸ºä¾‹ï¼Œæˆ‘æƒ³çš„æ˜¯ç”¨ä¸¤ä¸ªäº’æ–¥é‡ä¸è¡Œä¹ˆï¼Ÿç”Ÿæˆä¸€ä¸ªé”ï¼Œæ¶ˆè´¹ä¸€ä¸ªé”ï¼Œåªæ˜¯è¯´å¯èƒ½ä¼šæµªè´¹åœ¨å¾ªç¯åˆ¤æ–­æ˜¯å¦å¯ç”Ÿæˆï¼Œæ˜¯å¦å¯æ¶ˆè´¹ä¸­ï¼Œè¿˜æœ‰å¯èƒ½å› ä¸ºæŸäº›ä¸æˆåŠŸå¯¼è‡´ä¸€ç›´ä¸èƒ½è§£é”çš„çŠ¶å†µã€‚  éš¾ä¸æˆæ¡ä»¶å˜é‡ä¸»è¦å°±æ˜¯ä¼˜åŒ–ä¸Šè¿°é—®é¢˜çš„ä¹ˆï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462529,"discussion_content":"æˆ‘è®°å¾—åœ¨ä¹¦é‡Œä¹Ÿè¯´è¿‡ç±»ä¼¼çš„å†…å®¹ï¼šæ¡ä»¶å˜é‡å¸¸ç”¨äºå¯¹å…±äº«èµ„æºçš„çŠ¶æ€å˜åŒ–çš„ç›‘æ§å’Œå“åº”ï¼ˆç”±æ­¤å¯ä»¥å®ç°çŠ¶æ€æœºï¼‰ï¼ŒåŒæ—¶ä¹Ÿæ¯”è¾ƒé€‚åˆå¸®åŠ©å¤šä¸ªçº¿ç¨‹åä½œæ“ä½œåŒä¸€ä¸ªå…±äº«èµ„æºï¼ˆè¿™é‡Œçš„å…³é”®è¯æ˜¯åä½œï¼‰ã€‚\n\næ¡ä»¶å˜é‡æœ‰ä¸¤ç§é€šçŸ¥æœºåˆ¶ï¼Œè¿™æ˜¯äº’æ–¥é‡æ²¡æœ‰çš„ã€‚äº’æ–¥é‡åªèƒ½ä¿æŠ¤å…±äº«èµ„æºï¼ˆè¿™é‡Œçš„å…³é”®è¯æ˜¯ä¿æŠ¤ï¼‰ï¼ŒåŠŸèƒ½æ¯”è¾ƒå•ä¸€ã€‚æ‰€ä»¥æ¡ä»¶å˜é‡åœ¨ä¸€äº›åœºæ™¯ä¸‹ä¼šæ›´é«˜æ•ˆã€‚\n\nä½ è‡ªå·±ä¹Ÿè¯´å‡ºäº†ä¸€äº›ä½¿ç”¨ä¸¤ä¸ªäº’æ–¥é”æ¥åšçš„å¼Šç«¯ã€‚è¿™äº›å¼Šç«¯å…¶å®å°±å·²ç»æ¯”è¾ƒé—¹å¿ƒäº†ã€‚ä¸€ä¸ªæ˜¯ç”¨ä¸¤ä¸ªé”å¯¹æ€§èƒ½çš„å½±å“ï¼Œä¸€ä¸ªæ˜¯ä¸¤ä¸ªé”å¦‚æœé…åˆä¸å½“å°±ä¼šé€ æˆå±€éƒ¨çš„æ­»é”ã€‚è¿™è¿˜æ˜¯å¤šæ–¹åä½œæ“ä½œåŒä¸€ä¸ªå…±äº«èµ„æºä¸­æœ€ç®€å•çš„æƒ…å†µã€‚\n\nå†åŠ ä¸Šæˆ‘å‰é¢è¯´çš„é‚£äº›ï¼Œæ¡ä»¶å˜é‡åœ¨æ­¤ç±»åœºæ™¯ä¸‹çš„ä¼˜åŠ¿å·²ç»éå¸¸æ˜æ˜¾äº†ã€‚æ³¨æ„å®ƒåœ¨Waitæ—¶è¿˜æœ‰åŸå­çº§çš„æ“ä½œå‘¢ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565794919,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":81462,"user_name":"RegExp","can_delete":false,"product_type":"c1","uid":1126399,"ip_address":"","ucode":"8842E897CAC074","user_header":"https://static001.geekbang.org/account/avatar/00/11/2f/ff/e9ebafec.jpg","comment_is_top":false,"comment_ctime":1553918130,"is_pvip":false,"replies":[{"id":"29509","content":"åŸç†ä¸Šæ˜¯è¿™æ ·ï¼Œä½†æ˜¯å®è·µä¸­æœ€å¥½ä¸è¦è¿™æ ·æ··ç”¨åŒä¸€ä¸ªé”ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1553923115,"ip_address":"","comment_id":81462,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5848885426","product_id":100013101,"comment_content":"æ¡ä»¶å˜é‡çš„Waitæ–¹æ³•åœ¨é˜»å¡å½“å‰çš„ goroutineä¹‹å‰ï¼Œä¼šè§£é”å®ƒåŸºäºçš„äº’æ–¥é”ï¼Œé‚£æ˜¯ä¸æ˜¯æ˜¾ç¤ºè°ƒç”¨lock.Lock()çš„é”ä¹Ÿè¢«è§£é”äº†å‘¢ï¼Ÿ<br><br>","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445209,"discussion_content":"åŸç†ä¸Šæ˜¯è¿™æ ·ï¼Œä½†æ˜¯å®è·µä¸­æœ€å¥½ä¸è¦è¿™æ ·æ··ç”¨åŒä¸€ä¸ªé”ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553923115,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356401,"user_name":"é»„ä»²è¾‰","can_delete":false,"product_type":"c1","uid":1593521,"ip_address":"åŒ—äº¬","ucode":"D7EB3C3ADD99DA","user_header":"https://static001.geekbang.org/account/avatar/00/18/50/b1/7b701518.jpg","comment_is_top":false,"comment_ctime":1662268110,"is_pvip":false,"replies":[{"id":"129766","content":"sync.Condå…¶å®å¯¹åº”çš„æ˜¯æ“ä½œç³»ç»ŸAPIä¸­çš„æ¡ä»¶å˜é‡ã€‚æˆ‘è®°å¾—Javaä¹Ÿæœ‰æ¡ä»¶å˜é‡è¿™ä¸ªä¸œè¥¿å§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1026643","ctime":1662346013,"ip_address":"åŒ—äº¬","comment_id":356401,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1662268110","product_id":100013101,"comment_content":"sync.crod ç±»æ¯” javaçš„ ç›‘è§†å™¨é”","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586564,"discussion_content":"sync.Condå…¶å®å¯¹åº”çš„æ˜¯æ“ä½œç³»ç»ŸAPIä¸­çš„æ¡ä»¶å˜é‡ã€‚æˆ‘è®°å¾—Javaä¹Ÿæœ‰æ¡ä»¶å˜é‡è¿™ä¸ªä¸œè¥¿å§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662346013,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":336457,"user_name":"Geek_108cb5","can_delete":false,"product_type":"c1","uid":2355516,"ip_address":"","ucode":"47959B1E8926A5","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/KhQRc8hIxHHyPV3Og2Fc5qhN3zkWUnw31wkc7mcmGyxicD9Yrvhh7N5B3icqpgWZXfuWbysn7Lv6QMPIEmYPeC4w/132","comment_is_top":false,"comment_ctime":1646150198,"is_pvip":false,"replies":[{"id":"122994","content":"å¦‚æœä½ ç”¨çš„æ˜¯è¯»å†™é”çš„è¯ï¼Œè¯»å†™é”ä¸­çš„è¯»é”å®šæ“ä½œä¹‹é—´æ˜¯ä¸äº’æ–¥çš„ã€‚æ‰€ä»¥æˆ‘ä¼°è®¡æ˜¯ä½ è¿™å—çš„ç”¨æ³•é”™äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1026643","ctime":1646217981,"ip_address":"","comment_id":336457,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1646150198","product_id":100013101,"comment_content":"è¯•äº†ä¸€ä¸‹æŠŠäº’æ–¥é”æ”¹æˆè¯»å†™é”ï¼Œ ä¸­é€”ä¼šå‘ç”Ÿä¸€ä¸ªå‘é€æ¶ˆæ¯è¢«ä¸¤ä¸ªæ¥å—è€…åŒæ—¶æ”¶åˆ°çš„åœºæ™¯ï¼Œ å¯¼è‡´æœ€åå‘é€è€…é˜»å¡ï¼Œ æ­¤æ—¶ä¸»çº¿ç¨‹çš„ä¿¡é“ä¹Ÿé˜»å¡äº†ï¼Œ æ¥å—è€…åç¨‹æ‰§è¡Œå®Œæ¯•ï¼Œ æ•´ä½“æ˜¯æ­»é”çš„æƒ…å†µã€‚ é‚£å‡å¦‚å‘é€è€…å’Œæ¥æ”¶è€…éƒ½æ˜¯æ— é™å¾ªç¯ï¼Œ è€Œä¸”å¤šä¸ªæ¥æ”¶è€…æ¥æ”¶è€…æ¥åˆ°åŒä¸€ä»½æ¶ˆæ¯ä¸ä¼šå¯¹ä¸šåŠ¡æœ‰å½±å“çš„æƒ…å†µä¸‹ï¼Œ ä½¿ç”¨è¯»å†™é”åº”è¯¥ä¹Ÿæ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554113,"discussion_content":"å¦‚æœä½ ç”¨çš„æ˜¯è¯»å†™é”çš„è¯ï¼Œè¯»å†™é”ä¸­çš„è¯»é”å®šæ“ä½œä¹‹é—´æ˜¯ä¸äº’æ–¥çš„ã€‚æ‰€ä»¥æˆ‘ä¼°è®¡æ˜¯ä½ è¿™å—çš„ç”¨æ³•é”™äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646217981,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":335446,"user_name":"æäºŒæœ¨","can_delete":false,"product_type":"c1","uid":1103091,"ip_address":"","ucode":"30E03BB84ADB27","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/f3/129d6dfe.jpg","comment_is_top":false,"comment_ctime":1645521078,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1645521078","product_id":100013101,"comment_content":"æ¡ä»¶å˜é‡å°±æ˜¯è§£å†³å¹¶å‘ä¸­çš„åŒæ­¥é—®é¢˜ï¼ŒåŸç†è·ŸJavaå·®ä¸å¤šã€‚","like_count":0},{"had_liked":false,"id":321015,"user_name":"èƒ¡å°æ¶µ","can_delete":false,"product_type":"c1","uid":2004538,"ip_address":"","ucode":"2E750C65EC282C","user_header":"https://static001.geekbang.org/account/avatar/00/1e/96/3a/e06f8367.jpg","comment_is_top":false,"comment_ctime":1636619879,"is_pvip":false,"replies":[{"id":"116487","content":"å› ä¸ºæ ¸å¿ƒéœ€æ±‚ä¸åŒã€‚åœ¨ä½ çš„ä¾‹å­åªéœ€è¦çº¯ç²¹å•å‘çš„ç”Ÿäº§-æ¶ˆè´¹ï¼ˆè¿™å°±æ˜¯æœ€ç®€å•çš„æƒ…å†µï¼‰ã€‚ä½†åœ¨ä¸“æ çš„ä¾‹å­é‡Œï¼ŒåŒæ–¹å±äºâ€œç§˜å¯†æ¥è§¦â€ï¼Œéœ€è¦å°½å¯èƒ½å°‘çš„â€œéœ²é¢â€å’Œâ€œè®¿é—®é‚®ç®±â€ã€‚æ‰€ä»¥æ‰éœ€è¦äº’ç›¸é€šçŸ¥ã€‚<br><br>éœ€æ±‚å†³å®šä»£ç ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1636627449,"ip_address":"","comment_id":321015,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1636619879","product_id":100013101,"comment_content":"func testCond() {<br>\tmu := sync.Mutex{}<br>\tcond := sync.NewCond(&amp;mu)<br>\ts := &quot;&quot;<br><br>\tgo func () {<br>\t\tfmt.Println(&quot;This is consumer&quot;)<br>\t\tfor {<br>\t\t\tmu.Lock()<br><br>\t\t\tfor len(s) == 0 {<br>\t\t\t\tcond.Wait()<br>\t\t\t}<br>\t\t\t&#47;&#47;time.Sleep(time.Second * 1)<br>\t\t\tfmt.Println(&quot;consumer, s:&quot;, s)<br>\t\t\ts = &quot;&quot;<br>\t\t\tmu.Unlock()<br>\t\t\tcond.Signal()<br>\t\t}<br>\t}()<br><br>\tgo func () {<br>\t\tfmt.Println(&quot;This is producer&quot;)<br>\t\tfor {<br>\t\t\tmu.Lock()<br>\t\t\tfor len(s) &gt; 0 {<br>\t\t\t\tcond.Wait()<br>\t\t\t}<br>\t\t\tfmt.Println(&quot;produce a string&quot;)<br>\t\t\ts = &quot;generate s resource&quot;<br>\t\t\tmu.Unlock()<br>\t\t\tcond.Signal()<br>\t\t}<br><br>\t}()<br><br>\ttime.Sleep(time.Second * 10)<br>}<br>==========================================<br>è‡ªå·±æµ‹çš„æ—¶å€™å‘ç°ç”¨ä¸€ä¸ªCondå°±å¯ä»¥æ»¡è¶³ç”Ÿäº§è€…æ¶ˆè´¹è€…çš„ç®€å•æ¨¡å‹ï¼Œè°èƒ½å‘Šè¯‰æˆ‘ä¸ºä»€ä¹ˆä¾‹å­ä¸€å®šè¦ä½¿ç”¨ä¸¤ä¸ªCondï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530185,"discussion_content":"å› ä¸ºæ ¸å¿ƒéœ€æ±‚ä¸åŒã€‚åœ¨ä½ çš„ä¾‹å­åªéœ€è¦çº¯ç²¹å•å‘çš„ç”Ÿäº§-æ¶ˆè´¹ï¼ˆè¿™å°±æ˜¯æœ€ç®€å•çš„æƒ…å†µï¼‰ã€‚ä½†åœ¨ä¸“æ çš„ä¾‹å­é‡Œï¼ŒåŒæ–¹å±äºâ€œç§˜å¯†æ¥è§¦â€ï¼Œéœ€è¦å°½å¯èƒ½å°‘çš„â€œéœ²é¢â€å’Œâ€œè®¿é—®é‚®ç®±â€ã€‚æ‰€ä»¥æ‰éœ€è¦äº’ç›¸é€šçŸ¥ã€‚\n\néœ€æ±‚å†³å®šä»£ç ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636627449,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":203751,"user_name":"ä¼ è¯´ä¸­çš„æˆå¤§å¤§","can_delete":false,"product_type":"c1","uid":1236766,"ip_address":"","ucode":"103543D6E706BF","user_header":"https://static001.geekbang.org/account/avatar/00/12/df/1e/cea897e8.jpg","comment_is_top":false,"comment_ctime":1586262595,"is_pvip":false,"replies":[{"id":"76917","content":"æ¡ä»¶å˜é‡çš„ç‰¹è‰²æ˜¯â€œåè°ƒâ€ï¼Œè€Œä¸æ˜¯â€œäº’æ–¥â€ã€‚ä½†æ˜¯ä½ ä¹Ÿçœ‹åˆ°äº†ï¼Œå®ƒæ˜¯åŸºäºé”çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1586747522,"ip_address":"","comment_id":203751,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1586262595","product_id":100013101,"comment_content":"çœ‹äº†ä½ ä¸‹é¢çš„ç•™è¨€ æ„Ÿè§‰æ¡ä»¶å˜é‡ä¸»è¦æ˜¯ä¸ºäº†é¿å…äº’æ–¥é”æˆ–è€…è¯»å†™é” é”ç«äº‰æ¡ä»¶","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490951,"discussion_content":"æ¡ä»¶å˜é‡çš„ç‰¹è‰²æ˜¯â€œåè°ƒâ€ï¼Œè€Œä¸æ˜¯â€œäº’æ–¥â€ã€‚ä½†æ˜¯ä½ ä¹Ÿçœ‹åˆ°äº†ï¼Œå®ƒæ˜¯åŸºäºé”çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586747522,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":203748,"user_name":"ä¼ è¯´ä¸­çš„æˆå¤§å¤§","can_delete":false,"product_type":"c1","uid":1236766,"ip_address":"","ucode":"103543D6E706BF","user_header":"https://static001.geekbang.org/account/avatar/00/12/df/1e/cea897e8.jpg","comment_is_top":false,"comment_ctime":1586262352,"is_pvip":false,"replies":[{"id":"76918","content":"å› ä¸ºåœ¨è§£é”ä¹‹å‰å‘é€é€šçŸ¥æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåˆ«çš„åœ°æ–¹éƒ½é˜»å¡ç€å‘¢ï¼Œè°åˆèƒ½å¦¥å–„å¤„ç†è¿™ç§é€šçŸ¥å‘¢ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1586747682,"ip_address":"","comment_id":203748,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1586262352","product_id":100013101,"comment_content":"ä»Šå¤©ä¸»è¦è®²çš„goçš„åŒæ­¥ æ¡ä»¶å˜é‡<br>æ€»çš„æ¥è¯´æˆ‘åˆå»çœ‹äº†ä¸€ä¸‹unixç¯å¢ƒé«˜çº§ç¼–ç¨‹çš„æ¡ä»¶å˜é‡æ„Ÿè§‰äºŒè€…ä¸€æ ·<br>è¿™ä¸¤ä¸ªæ–¹æ³•å¹¶ä¸éœ€è¦å—åˆ°äº’æ–¥é”çš„ä¿æŠ¤ï¼Œæˆ‘ä»¬ä¹Ÿæœ€å¥½ä¸è¦åœ¨è§£é”äº’æ–¥é”ä¹‹å‰è°ƒç”¨å®ƒä»¬<br>å…³äºè¿™ä¸ªç»“è®ºçš„æˆ‘çŒœæµ‹æ˜¯å¦‚æœæ²¡æœ‰è§£é” æŸä¸ªgoroutine è¿˜æ²¡è§£é”åˆè¢«å”¤é†’äº† ä½†æ˜¯åˆä¸æ˜¯å®ƒæƒ³è¦çš„å…±äº«çŠ¶æ€ ç„¶ååˆåŠ é” åˆè¿›å…¥waitå¯¼è‡´æ­»é”ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490950,"discussion_content":"å› ä¸ºåœ¨è§£é”ä¹‹å‰å‘é€é€šçŸ¥æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåˆ«çš„åœ°æ–¹éƒ½é˜»å¡ç€å‘¢ï¼Œè°åˆèƒ½å¦¥å–„å¤„ç†è¿™ç§é€šçŸ¥å‘¢ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586747682,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":197288,"user_name":"ç»™åŠ›","can_delete":false,"product_type":"c1","uid":1113645,"ip_address":"","ucode":"646EE4AFC17224","user_header":"https://static001.geekbang.org/account/avatar/00/10/fe/2d/2c9177ca.jpg","comment_is_top":false,"comment_ctime":1585366823,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585366823","product_id":100013101,"comment_content":"sync.Condç±»å‹ä¸­çš„å…¬å¼€å­—æ®µLæ˜¯åšä»€ä¹ˆç”¨çš„ï¼Ÿæˆ‘ä»¬å¯ä»¥åœ¨ä½¿ç”¨æ¡ä»¶å˜é‡çš„è¿‡ç¨‹ä¸­æ”¹å˜è¿™ä¸ªå­—æ®µçš„å€¼å—ï¼Ÿ<br>æƒ³è¦çœ‹ä»–æœ‰ä»€ä¹ˆç”¨ï¼Ÿå°±å¾—çœ‹çœ‹ä»–æ˜¯ä»€ä¹ˆï¼Ÿ<br>è¿™æ˜¯ä¸ªLockerï¼Œé‚£ä¹ˆä¹Ÿæ˜¯é€šè¿‡å®ƒæ¥æ§åˆ¶å…±äº«èµ„æºçš„å¹¶å‘è®¿é—®ã€‚<br><br>åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­èƒ½ä¸èƒ½ä¿®æ”¹ï¼Ÿ<br>è¿™ä¸ªä¸»è¦å¾—çœ‹éƒ½å“ªäº›æ–¹æ³•ä½¿ç”¨äº†ï¼Œå¦‚ä½•ä½¿ç”¨çš„ã€‚<br>func (c *Cond) Wait() {<br>\tc.checker.check()<br>\tt := runtime_notifyListAdd(&amp;c.notify)<br>\tc.L.Unlock()<br>\truntime_notifyListWait(&amp;c.notify, t)<br>\tc.L.Lock()<br>}<br>func (c *Cond) Signal() {<br>\tc.checker.check()<br>\truntime_notifyListNotifyOne(&amp;c.notify)<br>}<br>func (c *Cond) Broadcast() {<br>\tc.checker.check()<br>\truntime_notifyListNotifyAll(&amp;c.notify)<br>}<br><br>å¾ˆæ˜¾ç„¶åœ¨waitæ—¶ä½¿ç”¨äº†ä»¥åŠå¤–éƒ¨é€»è¾‘ä½¿ç”¨äº†ã€‚<br>éšæ„æ›´æ”¹è¿™ä¸ªå€¼æœ‰å¯èƒ½å¼•å‘panic<br>","like_count":0},{"had_liked":false,"id":197273,"user_name":"ç»™åŠ›","can_delete":false,"product_type":"c1","uid":1113645,"ip_address":"","ucode":"646EE4AFC17224","user_header":"https://static001.geekbang.org/account/avatar/00/10/fe/2d/2c9177ca.jpg","comment_is_top":false,"comment_ctime":1585366294,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585366294","product_id":100013101,"comment_content":"æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼š<br>æ¡ä»¶å˜é‡è¦ä¾èµ–é”<br>æœ‰ä¸‰ä¸ªæ–¹æ³•ï¼šWaitã€Signalã€Broadcast<br><br>ä»£ç å®ä¾‹ï¼š<br>package mymutex<br><br>import (<br>\t&quot;fmt&quot;<br>\t&quot;sync&quot;<br>\t&quot;time&quot;<br>)<br><br>&#47;*<br>æ¡ä»¶å˜é‡çš„ä½œç”¨ï¼Ÿ<br>\tæ¡ä»¶å˜é‡å¹¶ä¸æ˜¯è¢«ç”¨æ¥ä¿æŠ¤ä¸´ç•ŒåŒºå’Œå…±äº«èµ„æºçš„ï¼Œå®ƒæ˜¯ç”¨äºåè°ƒæƒ³è¦è®¿é—®å…±äº«èµ„æºçš„é‚£äº›çº¿ç¨‹çš„ã€‚<br>\tå½“å…±äº«èµ„æºçš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒå¯ä»¥è¢«ç”¨æ¥é€šçŸ¥è¢«äº’æ–¥é”é˜»å¡çš„çº¿ç¨‹<br><br>æ¡ä»¶å˜é‡æ€æ ·ä¸äº’æ–¥é”é…åˆä½¿ç”¨ï¼Ÿ<br>\tæ¡ä»¶å˜é‡çš„åˆå§‹åŒ–ç¦»ä¸å¼€äº’æ–¥é”ï¼Œå¹¶ä¸”å®ƒçš„æ–¹æ³•æœ‰çš„ä¹Ÿæ˜¯åŸºäºäº’æ–¥é”çš„ã€‚<br>\tæ¡ä»¶å˜é‡æä¾›çš„æ–¹æ³•æœ‰ä¸‰ä¸ªï¼šç­‰å¾…é€šçŸ¥ï¼ˆwaitï¼‰ã€å•å‘é€šçŸ¥ï¼ˆsignalï¼‰å’Œå¹¿æ’­é€šçŸ¥ï¼ˆbroadcastï¼‰ã€‚<br>*&#47;<br><br>var mailbox uint8<br>var lock sync.RWMutex<br>var sendCond *sync.Cond = nil<br>var recvCond *sync.Cond = nil<br><br>var WG sync.WaitGroup<br><br>func init() {<br>\tfmt.Println(&quot;---------welcome mycond init----------&quot;)<br>\tsendCond = sync.NewCond(&amp;lock)<br>\trecvCond = sync.NewCond(lock.RLocker())<br>}<br><br>func SendFunc(num int) {<br>\tdefer WG.Done()<br><br>\tfor i:=0 ; i&lt;num ;i++ {<br>\t\tlock.Lock()<br>\t\tfmt.Println(&quot;mycond SendFunc lock...&quot;)<br>\t\tfor mailbox == 1 {<br>\t\t\tfmt.Println(&quot;mycond SendFunc wait...&quot;,num)<br>\t\t\tsendCond.Wait()<br>\t\t}<br>\t\tmailbox = 1<br>\t\tlock.Unlock()<br>\t\tfmt.Println(&quot;mycond SendFunc unlock...&quot;)<br>\t\trecvCond.Broadcast()<br>\t\t&#47;&#47;recvCond.Signal()<br>\t\tfmt.Println(&quot;mycond SendFunc recvCond Broadcast...&quot;)<br>\t}<br><br>}<br><br>func RecvFunc(goNum int) {<br>\tdefer WG.Done()<br>\tWG.Add(1)<br>\tlock.RLock()<br>\tfmt.Println(&quot;mycond RecvFunc lock...&quot;,goNum)<br>\tfor mailbox == 0 {<br>\t\tfmt.Println(&quot;mycond RecvFunc wait...&quot;,goNum)<br>\t\trecvCond.Wait()<br>\t}<br>\tmailbox = 0<br>\tlock.RUnlock()<br>\tfmt.Println(&quot;mycond RecvFunc unlock...&quot;,goNum)<br>\tsendCond.Signal()<br>\tfmt.Println(&quot;mycond RecvFunc sendCond Signal...&quot;,goNum)<br>}<br><br>func RecvFuncArr(arrLen int){<br>\tfor i:=0;i&lt;arrLen;i++{<br>\t\tgo RecvFunc(i)<br>\t}<br>}<br><br>func TestMyCond() {<br>\tconst num = 4<br>\tfmt.Println(&quot;---------mycond TestMyCond----------&quot;)<br>\tWG.Add(1)<br>\tRecvFuncArr(num)<br>\ttime.Sleep(500 * time.Millisecond)<br>\tgo SendFunc(num)<br>}<br><br>","like_count":0},{"had_liked":false,"id":196679,"user_name":"Lywane","can_delete":false,"product_type":"c1","uid":1446512,"ip_address":"","ucode":"2B0027AA069CE9","user_header":"https://static001.geekbang.org/account/avatar/00/16/12/70/10faf04b.jpg","comment_is_top":false,"comment_ctime":1585302293,"is_pvip":false,"replies":[{"id":"74609","content":"è¿™é‡Œæ²¡æœ‰é—®é¢˜å•Šï¼Œç­‰â€œä¸ä¸º0â€å°±æ˜¯â€œç­‰ç€æœ‰æ–°çš„æƒ…æŠ¥â€ï¼Œâ€œå†æŠŠå®ƒçš„å€¼å˜ä¸º0â€å°±æ˜¯â€œæ‹¿èµ°æƒ…æŠ¥â€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1585391992,"ip_address":"","comment_id":196679,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1585302293","product_id":100013101,"comment_content":"å®ƒä»¬éƒ½åœ¨ç­‰mailboxå˜é‡çš„å€¼ä¸ä¸º0çš„æ—¶å€™å†æŠŠå®ƒçš„å€¼å˜ä¸º0ï¼Œè¿™å°±ç›¸å½“äºæœ‰å¤šä¸ªäººåœ¨ç­‰ç€æˆ‘å‘ä¿¡ç®±é‡Œæ”¾ç½®æƒ…æŠ¥ã€‚<br><br>è€å¸ˆè¿™é‡Œä¸å¯¹å§ï¼Œä¸Šä¸€è®²è¯´çš„æ˜¯`mailbox ä»£è¡¨ä¿¡ç®±ã€‚0ä»£è¡¨ä¿¡ç®±æ˜¯ç©ºçš„ï¼Œ1ä»£è¡¨ä¿¡ç®±æ˜¯æ»¡çš„`ã€‚å¤§å®¶ç­‰ç€æŠŠmailboxè®¾ç½®ä¸º0ï¼Œåº”è¯¥æ˜¯éƒ½åœ¨ç­‰ç€æ‹¿ä¿¡","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489357,"discussion_content":"è¿™é‡Œæ²¡æœ‰é—®é¢˜å•Šï¼Œç­‰â€œä¸ä¸º0â€å°±æ˜¯â€œç­‰ç€æœ‰æ–°çš„æƒ…æŠ¥â€ï¼Œâ€œå†æŠŠå®ƒçš„å€¼å˜ä¸º0â€å°±æ˜¯â€œæ‹¿èµ°æƒ…æŠ¥â€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585391992,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":170064,"user_name":"Alan","can_delete":false,"product_type":"c1","uid":1198125,"ip_address":"","ucode":"9C66CBCFB3A109","user_header":"https://static001.geekbang.org/account/avatar/00/12/48/2d/7a3d42fb.jpg","comment_is_top":false,"comment_ctime":1578500559,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1578500559","product_id":100013101,"comment_content":"demo61ä¸­çš„ä»£ç å¯ä»¥ä¼˜åŒ–ä¸€ä¸‹ï¼Œå»é™¤å‘é€è€…çš„deferè¯­å¥å’Œä¸€è¡Œç®¡é“æ¥æ”¶è¯­å¥","like_count":0},{"had_liked":false,"id":160519,"user_name":"ç–¯ç´","can_delete":false,"product_type":"c1","uid":1099379,"ip_address":"","ucode":"82ACAA4A27753D","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/73/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1575968191,"is_pvip":false,"replies":[{"id":"61264","content":"å…ˆè¯´ç¬¬äºŒç‚¹å§ï¼ŒçœŸæ­£çš„è°å…ˆè°åæ˜¯åœ¨åº•å±‚è°ƒåº¦çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¾ˆéš¾å¹²æ¶‰ã€‚å¾ˆå¯èƒ½ä½ æ„Ÿè§‰æ˜¯Aå…ˆBåï¼Œåˆ°äº†å®é™…è°ƒåº¦çš„æ—¶å€™å´æ˜¯Bå…ˆAåã€‚å¦å¤–ï¼Œæ¡ä»¶å˜é‡çš„è¡Œä¸ºè§„èŒƒå°±æ˜¯å¦‚æ­¤ã€‚æ‰€ä»¥è®°ä½å°±å¥½äº†ã€‚<br><br>å…³äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘åˆçœ‹äº†ä¸€ä¸‹ç¤ºä¾‹ä»£ç ã€‚åœ¨ demo61.goä¸­ç¡®å®æ˜¯ä¸ºäº†æ¼”ç¤ºç”¨æ³•çš„ã€‚å› ä¸ºé‚£é‡Œåªæœ‰å•å‘å•æ”¶ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰é—®é¢˜ã€‚è€Œåœ¨demo62.goä¸­å°±å…¨æ˜¯åŸºäºäº’æ–¥é”äº†ï¼Œé‚£é‡Œæ˜¯å•å‘å¤šæ”¶çš„ã€‚ä½ å¯ä»¥çœ‹ä¸€ä¸‹æ–‡ç« ä¸­æ¯ä¸€æ®µå¯¹åº”çš„æ˜¯å“ªä¸€ä¸ªæºç æ–‡ä»¶ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1575975391,"ip_address":"","comment_id":160519,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1575968191","product_id":100013101,"comment_content":"waitçš„åŸç†è®²è§£å¾ˆæ¸…æ™°ã€‚<br><br>è¯·é—®è€å¸ˆä¸¤ä¸ªé—®é¢˜ï¼š<br>1. æ”¶ä¿¡äººä¹Ÿä¿®æ”¹äº†mailboxï¼Œä¸ºä»€ä¹ˆä¸ç”¨å†™é”ï¼Ÿæˆ‘è¯•äº†ä¸€ä¸‹ï¼Œå¦‚æœæŠŠæ”¶ä¿¡äººåˆ†æˆä¸¤ä¸ªgoroutineï¼Œä¸€ä¸ªå¾ªç¯2æ¬¡å¦ä¸€ä¸ªå¾ªç¯3æ¬¡ï¼Œæœ‰å¯èƒ½ä¸¤ä¸ªæ”¶ä¿¡äººå…ˆåè¿ç»­æ”¶äº†ä¿¡ï¼Œè¿™æ ·æœ€åä¸€æ­¥æ˜¯å‘ä¿¡äººå‘ä¿¡ã€‚recvCond.Signal()åªå”¤é†’ä¸€ä¸ªæ”¶ä¿¡äººï¼Œä¸ºä»€ä¹ˆä¼šæœ‰ä¸¤ä¸ªæ”¶ä¿¡äººå…ˆåè¿ç»­æ”¶ä¿¡å‘¢ï¼Ÿæˆ‘æŠŠrecvCondæ”¹æˆç”¨å†™é”å°±æ¢å¤æ­£å¸¸äº†ã€‚ç”¨å†™é”æ˜¯ä¸ºäº†æ¼”ç¤ºä¸€ä¸‹è·å–å†™é”çš„æ–¹æ³•ä¹ˆï¼Ÿ<br>package main<br><br>import (<br>\t&quot;log&quot;<br>\t&quot;sync&quot;<br>\t&quot;time&quot;<br>)<br><br>func main() {<br>\tvar mailbox uint8<br>\tvar lock sync.RWMutex<br>\tsendCond := sync.NewCond(&amp;lock)<br>\trecvCond := sync.NewCond(lock.RLocker())<br><br>\tsign := make(chan struct{}, 3)<br>\tmax := 5<br><br>\t&#47;&#47; å‘ä¿¡<br>\tgo func(max int) {<br>\t\tdefer func() {<br>\t\t\tsign &lt;- struct{}{}<br>\t\t}()<br><br>\t\tfor i := 1; i &lt;= max; i++ {<br>\t\t\ttime.Sleep(time.Millisecond * 500)<br>\t\t\tlock.Lock()<br>\t\t\tfor mailbox == 1 {<br>\t\t\t\tsendCond.Wait()<br>\t\t\t}<br>\t\t\tlog.Printf(&quot;sender [%d]: the mail box is empty.&quot;, i)<br>\t\t\tmailbox = 1<br>\t\t\tlog.Printf(&quot;sender [%d]: the letter has been send.&quot;, i)<br>\t\t\tlock.Unlock()<br>\t\t\trecvCond.Signal()<br>\t\t}<br>\t}(max)<br><br>\t&#47;&#47; æ”¶ä¿¡<br>\tgo func(max int) {<br>\t\tdefer func() {<br>\t\t\tsign &lt;- struct{}{}<br>\t\t}()<br>\t\tfor j := 1; j &lt;= max; j++ {<br>\t\t\ttime.Sleep(time.Millisecond * 500)<br>\t\t\tlock.RLock()<br>\t\t\tfor mailbox == 0 {<br>\t\t\t\trecvCond.Wait()<br>\t\t\t}<br>\t\t\tlog.Printf(&quot;receiver [%d]: the mail box is full.&quot;, j)<br>\t\t\tmailbox = 0<br>\t\t\tlog.Printf(&quot;receiver [%d]: the letter has been received.&quot;, j)<br>\t\t\tlock.RUnlock()<br>\t\t\tsendCond.Signal()<br>\t\t}<br>\t}(2)<br><br>\t&#47;&#47; æ”¶ä¿¡<br>\tgo func(max int) {<br>\t\tdefer func() {<br>\t\t\tsign &lt;- struct{}{}<br>\t\t}()<br>\t\tfor j := 1; j &lt;= max; j++ {<br>\t\t\ttime.Sleep(time.Millisecond * 500)<br>\t\t\tlock.RLock()<br>\t\t\tfor mailbox == 0 {<br>\t\t\t\trecvCond.Wait()<br>\t\t\t}<br>\t\t\tlog.Printf(&quot;receiver [%d]: the mail box is full.&quot;, j)<br>\t\t\tmailbox = 0<br>\t\t\tlog.Printf(&quot;receiver [%d]: the letter has been received.&quot;, j)<br>\t\t\tlock.RUnlock()<br>\t\t\tsendCond.Signal()<br>\t\t}<br>\t}(3)<br><br>\t&lt;-sign<br>\t&lt;-sign<br>\t&lt;-sign<br><br>\tlog.Println(mailbox)<br>}<br>2. â€œå½“é€šçŸ¥è¢«å‘é€çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½• goroutine éœ€è¦è¢«å”¤é†’ï¼Œé‚£ä¹ˆè¯¥é€šçŸ¥å°±ä¼šç«‹å³å¤±æ•ˆã€‚â€è¿™ä¸€ç‚¹æˆ‘æ²¡æœ‰ç†è§£ã€‚æˆ‘è®©æ”¶ä¿¡äººå¯åŠ¨æ›´æ™šä¸€ç‚¹ï¼Œä¹Ÿå°±æ˜¯å‘ä¿¡äººæ‰§è¡ŒSignal()çš„æ—¶å€™æ”¶ä¿¡äººè¿˜æ²¡æœ‰Wait()ï¼Œä½†æ˜¯ä¾ç„¶æ­£å¸¸æ‰§è¡Œäº†ã€‚","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477399,"discussion_content":"å…ˆè¯´ç¬¬äºŒç‚¹å§ï¼ŒçœŸæ­£çš„è°å…ˆè°åæ˜¯åœ¨åº•å±‚è°ƒåº¦çš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¾ˆéš¾å¹²æ¶‰ã€‚å¾ˆå¯èƒ½ä½ æ„Ÿè§‰æ˜¯Aå…ˆBåï¼Œåˆ°äº†å®é™…è°ƒåº¦çš„æ—¶å€™å´æ˜¯Bå…ˆAåã€‚å¦å¤–ï¼Œæ¡ä»¶å˜é‡çš„è¡Œä¸ºè§„èŒƒå°±æ˜¯å¦‚æ­¤ã€‚æ‰€ä»¥è®°ä½å°±å¥½äº†ã€‚\n\nå…³äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘åˆçœ‹äº†ä¸€ä¸‹ç¤ºä¾‹ä»£ç ã€‚åœ¨ demo61.goä¸­ç¡®å®æ˜¯ä¸ºäº†æ¼”ç¤ºç”¨æ³•çš„ã€‚å› ä¸ºé‚£é‡Œåªæœ‰å•å‘å•æ”¶ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰é—®é¢˜ã€‚è€Œåœ¨demo62.goä¸­å°±å…¨æ˜¯åŸºäºäº’æ–¥é”äº†ï¼Œé‚£é‡Œæ˜¯å•å‘å¤šæ”¶çš„ã€‚ä½ å¯ä»¥çœ‹ä¸€ä¸‹æ–‡ç« ä¸­æ¯ä¸€æ®µå¯¹åº”çš„æ˜¯å“ªä¸€ä¸ªæºç æ–‡ä»¶ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575975391,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":155810,"user_name":"K_night","can_delete":false,"product_type":"c1","uid":1210679,"ip_address":"","ucode":"5A40239A1790DA","user_header":"https://static001.geekbang.org/account/avatar/00/12/79/37/3316de0c.jpg","comment_is_top":false,"comment_ctime":1574759898,"is_pvip":false,"replies":[{"id":"59879","content":"ä½ è¿™æ ·ç»™æˆ‘ä»£ç æˆ‘æ²¡æ³•åˆ¤æ–­å•Šã€‚ä½ éƒ½æ”¹äº†å“ªäº›åœ°æ–¹ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1574766879,"ip_address":"","comment_id":155810,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1574759898","product_id":100013101,"comment_content":"send := func(id int, index int) {<br>\t\t&#47;&#47; defer func() {<br>\t\t&#47;&#47; \tsign &lt;- struct{}{}<br>\t\t&#47;&#47; }()<br>\t\tlock.Lock()<br>\t\twakeupNum := 0<br>\t\tlog.Printf(&quot;wait before wakeupNum: [%d]&quot;, wakeupNum)<br>\t\tfor msgbox == 1 {<br>\t\t\tfmt.Printf(&quot;wait before in for wakeupNum: [%d]&quot;, wakeupNum)<br>\t\t\t&#47;&#47; log.Printf(&quot;wait before in for wakeupNum: [%d]&quot;, wakeupNum)<br>\t\t\tsendCond.Wait()<br>\t\t\t&#47;&#47; log.Printf(&quot;other Broadcast&quot;)<br>\t\t\twakeupNum = 1<br>\t\t\tlog.Printf(&quot;wait after wakeupNum: [%d]&quot;, wakeupNum)<br>\t\t}<br>\t\tlog.Printf(&quot;sender: id:[%d] index:[%d] msgbox is empty&quot;, id, index)<br>\t\tlog.Printf(&quot;wakeupNum: [%d]&quot;, wakeupNum)<br>\t\tsendNum = wakeupNum<br>\t\tmsgbox = 1<br>\t\tlog.Printf(&quot;sender: id:[%d] index:[%d] mail has been send&quot;, id, index)<br>\t\tlock.Unlock()<br>\t\trecvCond.Broadcast()<br>\t}<br>forå¾ªç¯é‡Œé¢çš„ä»£ç è¢«ä¼˜åŒ–äº†å—ã€‚æ€ä¹ˆæ²¡æœ‰æ‰§è¡Œå‘¢ã€‚æœ›è€å¸ˆè§£æƒ‘æ„Ÿè°¢","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":475880,"discussion_content":"ä½ è¿™æ ·ç»™æˆ‘ä»£ç æˆ‘æ²¡æ³•åˆ¤æ–­å•Šã€‚ä½ éƒ½æ”¹äº†å“ªäº›åœ°æ–¹ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574766879,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":129987,"user_name":"xuery","can_delete":false,"product_type":"c1","uid":1027584,"ip_address":"","ucode":"F461B61BE06131","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ae/00/025f37e7.jpg","comment_is_top":false,"comment_ctime":1567347576,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1567347576","product_id":100013101,"comment_content":"å’ŒJavaçš„Conditionä½¿ç”¨å’ŒåŸç†åŸºæœ¬ä¸€è‡´","like_count":0},{"had_liked":false,"id":118538,"user_name":"å…š","can_delete":false,"product_type":"c1","uid":1071974,"ip_address":"","ucode":"EE531DB3EA124D","user_header":"https://static001.geekbang.org/account/avatar/00/10/5b/66/ad35bc68.jpg","comment_is_top":false,"comment_ctime":1564383252,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564383252","product_id":100013101,"comment_content":"çœ‹è¿™å‡½æ•°çš„å®šä¹‰ æ‰¾åˆ°äº†jsçš„é£æ ¼","like_count":0},{"had_liked":false,"id":117119,"user_name":"ä¸è®°å¹´","can_delete":false,"product_type":"c1","uid":1045945,"ip_address":"","ucode":"287E40C68356DC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f5/b9/888fe350.jpg","comment_is_top":false,"comment_ctime":1563971884,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563971884","product_id":100013101,"comment_content":"å”¤é†’ç”¨çš„Signalæ–¹æ³•","like_count":0},{"had_liked":false,"id":104807,"user_name":"å¤§ä¸­ååŒºä½ï»¿ç«¯äººå£","can_delete":false,"product_type":"c1","uid":1065204,"ip_address":"","ucode":"6DFB6C8060E83E","user_header":"https://static001.geekbang.org/account/avatar/00/10/40/f4/3372aec6.jpg","comment_is_top":false,"comment_ctime":1560843601,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560843601","product_id":100013101,"comment_content":"è¿˜æ˜¯åœ¨ç”¨forçš„ç¬¬ä¸€ç‚¹æƒ…å†µä¸Šæ‡µé€¼","like_count":0},{"had_liked":false,"id":102688,"user_name":"ç³Šæç³Šæ¶‚","can_delete":false,"product_type":"c1","uid":1197625,"ip_address":"","ucode":"E0F6064CBA32B1","user_header":"https://static001.geekbang.org/account/avatar/00/12/46/39/e545c885.jpg","comment_is_top":false,"comment_ctime":1560297309,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1560297309","product_id":100013101,"comment_content":"çœ‹ä¸æ‡‚ï¼Œå°±ç»“åˆä¾‹å­å†çœ‹ä¸€éï¼Œå°±æ‡‚äº†","like_count":0},{"had_liked":false,"id":86074,"user_name":"ğŸ„½ğŸ„¸ğŸ…‡ğŸ…„ğŸ…‚","can_delete":false,"product_type":"c1","uid":1000060,"ip_address":"","ucode":"853763C229A5AA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/42/7c/8ef14715.jpg","comment_is_top":false,"comment_ctime":1555308585,"is_pvip":false,"replies":[{"id":"30916","content":"ä½ éœ€è¦å±•ç¤ºä½ çš„ä»£ç ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1555313598,"ip_address":"","comment_id":86074,"utype":1}],"discussion_count":4,"race_medal":0,"score":"1555308585","product_id":100013101,"comment_content":"è¯·æ•™è€å¸ˆä¸€ä¸ªé—®é¢˜: <br>demo62.goä¸­, æ”¶ä¿¡åªæ˜¯è¯»æ•°æ®, å¯æ˜¯ä¸ºä»€ä¹ˆä½¿ç”¨RLock()å’ŒRUnlock()å°±æŠ¥é”™, è€Œå¿…é¡»è¦ä½¿ç”¨Lock()å’ŒUlock()å‘¢?","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446885,"discussion_content":"ä½ éœ€è¦å±•ç¤ºä½ çš„ä»£ç ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555313598,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1603571,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKgNge1sNXIWCFeUOa53cU5Glfw24sjxibBxTiaTb45LmU9bRDlDgBib9goFZXmoKwXTOJ4JMvVHHbiaA/132","nickname":"æ½˜æ—æ—","note":"","ucode":"31576141FE4A1D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":411101,"discussion_content":"å› ä¸ºæœ‰å¤šä¸ªæ¶ˆè´¹è€…ï¼Œæ¯ä¸ªæ¶ˆè´¹è€…éƒ½éœ€è¦æ¶ˆè€—æ»¡maxä¸ªæ¶ˆæ¯ï¼Œæ‰èƒ½é€€å‡ºï¼Œä¸ç„¶å°±é˜»å¡åœ¨waité‚£è¡Œï¼Œä½†æ˜¯ç”±äºè¯»è¯»ä¸äº’æ–¥ï¼Œå¯¼è‡´äº†æ¶ˆè´¹è€…å°‘æ¶ˆè´¹äº†ï¼Œå½¢æˆé˜»å¡\næ­£å¸¸æƒ…å†µï¼š\nç”Ÿäº§è€…ç”Ÿäº§maxä¸ªæ¶ˆæ¯\næ¶ˆè´¹è€…1æ¶ˆè´¹maxä¸ªæ¶ˆæ¯\næ¶ˆè´¹è€…2æ¶ˆè´¹maxä¸ªæ¶ˆæ¯\nå‡è®¾ï¼š\nç”Ÿäº§1ä¸ªæ¶ˆæ¯ï¼Œå‘é€é€šçŸ¥\næ¶ˆè´¹è€…1æ”¶åˆ°æ¶ˆæ¯ï¼Œç‡å…ˆå®Œæˆæ“ä½œï¼Œå¹¶è®¾ç½®mailbox=0ï¼Œè¿›å…¥ä¸‹ä¸€è½®å¾ªç¯å¹¶wait\næ¶ˆè´¹è€…2æ”¶åˆ°æ¶ˆæ¯ï¼Œåˆ¤æ–­mailboxä¸æ˜¯1ï¼Œé‡æ–°è¿›å…¥waitï¼Œè¿˜åœ¨å½“å‰å¾ªç¯\næ­¤æ—¶ ç”Ÿäº§äº†ä¸€ä¸ªæ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…1æ¶ˆè´¹äº†ä¸€æ¬¡æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…2æ²¡æœ‰æ¶ˆè´¹æ¶ˆæ¯ï¼Œå‰©ä½™max-1ä¸ªæ¶ˆæ¯å¯å‘ï¼Œæ¶ˆè´¹è€…1éœ€è¦æ¶ˆè´¹max-1ä¸ªï¼Œæ¶ˆè´¹è€…2éœ€è¦æ¶ˆè´¹maxä¸ªã€‚\nå¾ˆæ˜æ˜¾ç”Ÿäº§è€…å¯ä»¥ç”Ÿäº§çš„æ¶ˆæ¯ä¸å¤Ÿæ¶ˆè´¹è€…2æ¶ˆè´¹ï¼Œè¿™å¯¼è‡´æ¶ˆè´¹è€…2æœ€åé˜»å¡åœ¨waité‡Œé¢ï¼Œä»è€Œæ— æ³•è§¦å‘deferé‡Œé¢çš„å†™channel\nå†æ¥çœ‹ä¸»åç¨‹ï¼Œéœ€è¦æ¶ˆè´¹3ä¸ªchannelæ¶ˆæ¯æ‰èƒ½é€€å‡ºå¦åˆ™ä¸€ç›´é˜»å¡ï¼Œä½†æ˜¯æ¶ˆè´¹è€…2æ²¡æœ‰ç»™channelç”Ÿäº§æ¶ˆæ¯ï¼Œæ‰€æœ‰ä¸»åç¨‹å’Œæ¶ˆè´¹è€…2äº’ç›¸é˜»å¡é€ æˆæ­»é”äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635849810,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1157472,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a9/60/c4700e74.jpg","nickname":"ssikiki","note":"","ucode":"3C092E1C0C8753","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":255,"discussion_content":"ä¸æ˜ç™½demo62ä¸ºä»€ä¹ˆä¸ç”¨è¯»å†™é”äº†ï¼Œ æ±‚è§£ç­”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561362437,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1157472,"avatar":"https://static001.geekbang.org/account/avatar/00/11/a9/60/c4700e74.jpg","nickname":"ssikiki","note":"","ucode":"3C092E1C0C8753","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":254,"discussion_content":"demo62\nvar lock sync.Mutex -> var lock sync.RWMutex\nrecvCond := sync.NewCond(&amp;lock)  ->  recvCond := sync.NewCond(lock.RLocker())\nè¿˜æœ‰recvå‡½æ•°\nlock.Lock() -> lock.RLock()\nlock.Unlock() -> lock.RUnlock()\n\næœ€åæŠ¥\nfatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [chan receive]:\nmain.main()\n\t...src/puzzlers/article23/q3/demo62.go:84 +0x28e","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1561362168,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":84299,"user_name":"ğŸ»","can_delete":false,"product_type":"c1","uid":1043072,"ip_address":"","ucode":"534EDAD496A0E6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ea/80/8759e4c1.jpg","comment_is_top":false,"comment_ctime":1554822176,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554822176","product_id":100013101,"comment_content":"@äº‘å­¦ï¼Œçœ‹é”çš„ç±»å‹å§ã€‚å¦‚æœæ˜¯è¯»é”çš„è¯ï¼Œéƒ½èƒ½å¤Ÿä¸Šé”æˆåŠŸã€‚å¦‚æœæ˜¯äº’æ–¥é”çš„è¯ï¼Œåªæœ‰ä¸€ä¸ªèƒ½å¤Ÿä¸Šé”æˆåŠŸï¼Œå…¶ä»–çš„ç»§ç»­ç­‰å¾…ã€‚","like_count":0},{"had_liked":false,"id":82746,"user_name":"Geek_7b1949","can_delete":false,"product_type":"c1","uid":1437057,"ip_address":"","ucode":"DC0B19ACEC5E7A","user_header":"","comment_is_top":false,"comment_ctime":1554295070,"is_pvip":false,"replies":[{"id":"29960","content":"æˆ‘åŸè¯ä¸æ˜¯è¿™ä¹ˆè¯´çš„å§ã€‚æˆ‘è¯´çš„æ˜¯ä¸å…ˆåŠ é”çš„è¯ï¼Œè°ƒç”¨åŸºäºæ­¤é”çš„æ¡ä»¶å˜é‡çš„Waitæ–¹æ³•æ—¶ä¼šå¼•å‘ä¸å¯æ¢å¤çš„panicã€‚å› ä¸ºWaitæ–¹æ³•ä¼šå…ˆè§£é”ï¼Œè€Œè§£é”è¿˜æ²¡é”ä½çš„é”å°±ä¼šå¼•å‘panicã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1554346847,"ip_address":"","comment_id":82746,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1554295070","product_id":100013101,"comment_content":"å…³äºç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œæœ‰ä¸ªç–‘é—®ï¼Œæ–‡ä¸­è¯´ï¼Œå¦‚æœä¸å…ˆåŠ é”ï¼Œwaitæ–¹æ³•ä¸­è§£é”ï¼Œå¾ˆå®¹æ˜“é€ æˆwaitæ–¹æ³•å¯¹åŠ é”çš„é”é‡å¤åŠ é”ä»è€Œé€ æˆgoroutineé˜»å¡ï¼Œä½†æ˜¯åœ¨waitæ–¹æ³•è°ƒç”¨ä¹‹å‰ï¼Œä¸æ˜¯åŒæ ·ä¹Ÿä¼šé€ æˆè¿™ä¸ªé—®é¢˜å—ï¼Œä¹Ÿæœ‰å¯èƒ½åœ¨è¿˜æ²¡æœ‰èµ°åˆ°waitçš„æ—¶å€™é€ æˆgoroutineçš„é˜»å¡å‘€ï¼Œæ±‚è§£ç­”","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":445708,"discussion_content":"æˆ‘åŸè¯ä¸æ˜¯è¿™ä¹ˆè¯´çš„å§ã€‚æˆ‘è¯´çš„æ˜¯ä¸å…ˆåŠ é”çš„è¯ï¼Œè°ƒç”¨åŸºäºæ­¤é”çš„æ¡ä»¶å˜é‡çš„Waitæ–¹æ³•æ—¶ä¼šå¼•å‘ä¸å¯æ¢å¤çš„panicã€‚å› ä¸ºWaitæ–¹æ³•ä¼šå…ˆè§£é”ï¼Œè€Œè§£é”è¿˜æ²¡é”ä½çš„é”å°±ä¼šå¼•å‘panicã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554346847,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":63300,"user_name":"è™¢åœ‹æŠ€é†¬","can_delete":false,"product_type":"c1","uid":1056807,"ip_address":"","ucode":"5A192262AA037E","user_header":"https://static001.geekbang.org/account/avatar/00/10/20/27/a6932fbe.jpg","comment_is_top":false,"comment_ctime":1548319474,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1548319474","product_id":100013101,"comment_content":"æ‰“å¡","like_count":0},{"had_liked":false,"id":62585,"user_name":"å¥‹æ–—","can_delete":false,"product_type":"c1","uid":1365112,"ip_address":"","ucode":"6AC3BD90617F13","user_header":"https://static001.geekbang.org/account/avatar/00/14/d4/78/53d93c43.jpg","comment_is_top":false,"comment_ctime":1548117598,"is_pvip":true,"replies":[{"id":"25242","content":"å¯¹ï¼Œä¸¤ä¸¤å¯¹åº”ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1551180989,"ip_address":"","comment_id":62585,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548117598","product_id":100013101,"comment_content":"Javaçš„notifyå’Œnotifyall?","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437267,"discussion_content":"å¯¹ï¼Œä¸¤ä¸¤å¯¹åº”ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551180989,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":51998,"user_name":"å†è§å°é£ä¾ ","can_delete":false,"product_type":"c1","uid":1170151,"ip_address":"","ucode":"33DFE28B8E6ACE","user_header":"https://static001.geekbang.org/account/avatar/00/11/da/e7/6feaa540.jpg","comment_is_top":false,"comment_ctime":1545291496,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545291496","product_id":100013101,"comment_content":"@äº‘å­¦<br>æœ‰ä¸ªç–‘é—®ï¼Œbroadcastå”¤é†’æ‰€æœ‰waitçš„goroutineï¼Œé‚£ä»–ä»¬è¢«å”¤é†’æ—¶éœ€è¦å»åŠ é”(waitè¿”å›)ï¼Œéƒ½èƒ½æˆåŠŸå—ï¼Ÿ<br><br>*sync.Mutexç±»å‹çš„å€¼ä»¥åŠ*sync.RWMutexç±»å‹çš„å€¼éƒ½å¯ä»¥æ»¡è¶³è¿™ä¸ªè¦æ±‚ã€‚<br><br>é€ä¿¡çš„ä¾‹å­ä¸­ä½¿ç”¨äº†RWMutexï¼Œå›æƒ³RLock()è¯»é”çš„ç‰¹æ€§ï¼š<br>(1)å¤šä¸ªè¯»æ“ä½œå¯ä»¥åŒæ—¶è¿›è¡Œã€‚å› æ­¤è¢«å”¤é†’æ—¶å¦‚æœéƒ½æ˜¯è·å–è¯»é”çš„è¯·æ±‚ï¼Œä»–ä»¬éƒ½æ˜¯å¯ä»¥æˆåŠŸè¿”å›çš„ã€‚<br>(2)ä½†å¦‚æœæ˜¯WLock()å†™é”çš„æƒ…å†µï¼Œå°±ä¼šæœ‰ç­‰å¾…æœ€ä¹…çš„é‚£ä¸ªèƒ½å®Œæˆè·å–é”çš„éœ€æ±‚ã€‚<br><br><br>","like_count":0},{"had_liked":false,"id":40061,"user_name":"jacke","can_delete":false,"product_type":"c1","uid":1161209,"ip_address":"","ucode":"05F355E1FF88C5","user_header":"https://static001.geekbang.org/account/avatar/00/11/b7/f9/a8f26b10.jpg","comment_is_top":false,"comment_ctime":1542460015,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1542460015","product_id":100013101,"comment_content":"è€å¸ˆï¼Œè¯•äº†ä¸‹ã€signalå’Œbroadcastå”¤é†’æ”¾åœ¨è§£é”å‰ä¸ä¼šæ­»é”ï¼Œä¸ºä»€ä¹ˆï¼Ÿè§£é‡Šä¸‹ã€ç•™è¨€é‡Œé¢æœ‰2ä¸ªæ˜¯åŒæ ·ç–‘é—®çš„","like_count":0},{"had_liked":false,"id":39110,"user_name":"LeonğŸ“·","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1542189555,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1542189555","product_id":100013101,"comment_content":"è€å¸ˆï¼Œæˆ‘æ¯”è¾ƒç–‘æƒ‘çš„æ˜¯å¤šä¸ªåç¨‹äº‰å¤ºèµ„æºï¼Œmutex å’ŒRWmutexé€šè¿‡lockå’Œunlockéƒ½å¯ä»¥åšåˆ°åŒæ­¥ï¼Œä¸ºä»€ä¹ˆä¸€å®šè¦ç”¨æ¡ä»¶å˜é‡ï¼Œç¼–å†™çš„è¿™ä¹ˆå¤æ‚","like_count":0,"discussions":[{"author":{"id":1417824,"avatar":"https://static001.geekbang.org/account/avatar/00/15/a2/60/f3939ab4.jpg","nickname":"å“ˆå“¼","note":"","ucode":"C1108406573D49","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":12430,"discussion_content":"ä¸æ˜¯ä¸ºåŠ›åŒæ­¥ï¼Œä¸æ˜¯ä¸ºäº†çº¿ç¨‹å®‰å…¨ï¼Œæ˜¯ä¸ºäº†ç­‰ä½ éœ€è¦çš„æ¡ä»¶æ»¡è¶³ã€‚è¿™å’ŒåŒæ­¥æ˜¯ä¸¤ä¸ªåœºæ™¯","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1568529379,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":37950,"user_name":"heha37","can_delete":false,"product_type":"c1","uid":1008962,"ip_address":"","ucode":"13C180307574A6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/65/42/76eb78bd.jpg","comment_is_top":false,"comment_ctime":1541822523,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1541822523","product_id":100013101,"comment_content":"è€å¸ˆï¼Œmailboxä½¿ç”¨åŸå­æ“ä½œæ˜¯ä¸æ˜¯å°±ä¸ç”¨forå¾ªç¯å»æ£€æŸ¥äº†ã€‚","like_count":0,"discussions":[{"author":{"id":1073694,"avatar":"https://static001.geekbang.org/account/avatar/00/10/62/1e/8054e6db.jpg","nickname":"æ¨‚æ–‡ğŸ’¤","note":"","ucode":"CE4A46397521FC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3763,"discussion_content":"æˆ‘çš„æ„Ÿè§‰æ˜¯å¦‚æœç”¨signalå”¤é†’ åªå”¤é†’ä¸€ä¸ªçº¿ç¨‹çš„è¯ æ˜¯å¯ä»¥ç”¨ifçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564795028,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":32711,"user_name":"å’è¿¹","can_delete":false,"product_type":"c1","uid":1202095,"ip_address":"","ucode":"FAE1AA6038402C","user_header":"https://static001.geekbang.org/account/avatar/00/12/57/af/0b39cab7.jpg","comment_is_top":false,"comment_ctime":1539674764,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1539674764","product_id":100013101,"comment_content":"è€å¸ˆé—®ä¸ªé—®é¢˜ï¼š<br>demo62.goä¸­<br>\t&#47;&#47; sendCond ä»£è¡¨ä¸“ç”¨äºå‘ä¿¡çš„æ¡ä»¶å˜é‡ã€‚<br>\tsendCond := sync.NewCond(&amp;lock)<br>\t&#47;&#47; recvCond ä»£è¡¨ä¸“ç”¨äºæ”¶ä¿¡çš„æ¡ä»¶å˜é‡ã€‚<br>\trecvCond := sync.NewCond(&amp;lock)<br>sendCondå’ŒrecvCondæ‹¿åˆ°çš„æ¡ä»¶å˜é‡éƒ½æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆå¯ä¸å¯ä»¥åªè¦ä¸€ä¸ªå…¬å…±çš„æ¡ä»¶å˜é‡commCondæ¥ä»£æ›¿å‰é¢ä¸¤ä¸ªæ¡ä»¶å˜é‡å‘¢","like_count":0},{"had_liked":false,"id":32710,"user_name":"å’è¿¹","can_delete":false,"product_type":"c1","uid":1202095,"ip_address":"","ucode":"FAE1AA6038402C","user_header":"https://static001.geekbang.org/account/avatar/00/12/57/af/0b39cab7.jpg","comment_is_top":false,"comment_ctime":1539674330,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1539674330","product_id":100013101,"comment_content":"è€å¸ˆé—®ä¸ªé—®é¢˜ï¼š<br>var lock sync.RWMutex<br>sendCond := sync.NewCond(&amp;lock) <br>recvCond := sync.NewCond(lock.RLocker())<br>æˆ‘æƒ³é—®çš„æ˜¯<br>1 sendCondè·å–çš„æ˜¯è¯»é”è¿˜æ˜¯å†™é”ï¼Œè¿˜æ˜¯ä¸¤è€…éƒ½åŒ…å«ï¼Ÿ<br>2 recvCondè·å–çš„æ˜¯è¯»é”è¿˜æ˜¯å†™é”ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1603571,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKgNge1sNXIWCFeUOa53cU5Glfw24sjxibBxTiaTb45LmU9bRDlDgBib9goFZXmoKwXTOJ4JMvVHHbiaA/132","nickname":"æ½˜æ—æ—","note":"","ucode":"31576141FE4A1D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":411374,"discussion_content":"1.æ‹¿åˆ°çš„æ˜¯é™æ€ç±»å‹ä¸ºLockerç±»å‹çš„å†™é”ï¼Œä½†æ˜¯åŠ¨æ€ç±»å‹æ˜¯RWMutexï¼ŒåŠ¨æ€å€¼æ˜¯RWMutexçš„é»˜è®¤å€¼ï¼Œå¯ä»¥é€šè¿‡ç±»å‹æ–­è¨€è·å–åˆ°RWMutexçš„å†…å®¹ l,_ := interface{}(sendCond.L).(*sync.RWMutex)\n2.è¯»é” è€Œä¸”ä¸å¯è¢«è½¬åŒ–ä¸ºsync.RWMutex \nlock.RLocker()è¿”å›çš„æ˜¯rlockerçš„å¼•ç”¨ç±»å‹ï¼Œrlockeræ˜¯RWMutexçš„ç±»å‹å£°æ˜ï¼Œè¦æƒ³æŠŠrecvCondé‡Œé¢çš„é”è½¬æ¢æˆRWMutexç±»å‹ å°±éœ€è¦å…ˆè¿›è¡Œæ–­è¨€è½¬æ¢æˆrlockerï¼Œå†å¼ºåˆ¶è½¬æ¢æˆRWMutexï¼Œä½†æ˜¯rlockeråŒ…å†…ç§æœ‰å˜é‡ï¼Œå¤–éƒ¨è½¬æ¢ä¸äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635909795,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1193874,"avatar":"https://static001.geekbang.org/account/avatar/00/12/37/92/961ba560.jpg","nickname":"æˆäººä»¥ğŸŸï¼Œä¸å¦‚æˆäººä»¥æ¸”","note":"","ucode":"BD53829E924B66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372601,"discussion_content":"sendCond æ‹¿åˆ°çš„æ˜¯è¯»å†™é”ï¼Œåœ¨è¿™ä¸ªè¯­ä¹‰é‡Œé¢åº”è¯¥æ˜¯æ›´åŠ åå‘äºå…·æœ‰å†™é”çš„ç‰¹å¾ï¼›recvCond æ‹¿åˆ°çš„æ˜¯è¯»é”ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620390531,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":32431,"user_name":"cygnus","can_delete":false,"product_type":"c1","uid":1120452,"ip_address":"","ucode":"C60A86E3084754","user_header":"https://static001.geekbang.org/account/avatar/00/11/18/c4/e55fdc1c.jpg","comment_is_top":false,"comment_ctime":1539571133,"is_pvip":false,"replies":[{"id":"11824","content":"æ²¡é”™ã€‚æ”¹åŠ¨ä»–è¦è·Ÿè°¨æ…ã€‚æœ€å¥½ä¸è¦æ”¹ï¼Œä»¥é˜²ä¸‡ä¸€ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1539578131,"ip_address":"","comment_id":32431,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1539571133","product_id":100013101,"comment_content":"æ€è€ƒé¢˜ï¼šsync.Condç±»å‹ä¸­çš„å…¬å¼€å­—æ®µLæ˜¯ç”¨æ¥ä¿å­˜NewCondæ–¹æ³•ä¼ é€’è¿›æ¥çš„äº’æ–¥é”çš„ï¼Œè¿™ä¸ªé”æ˜¯æ¡ä»¶å˜é‡è‡ªå·±æ§åˆ¶çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­æ”¹å˜è¿™ä¸ªå­—æ®µçš„å€¼ï¼Œå¦åˆ™å¯èƒ½ä¼šå¯¼è‡´panicæˆ–æ­»é”<br>","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426770,"discussion_content":"æ²¡é”™ã€‚æ”¹åŠ¨ä»–è¦è·Ÿè°¨æ…ã€‚æœ€å¥½ä¸è¦æ”¹ï¼Œä»¥é˜²ä¸‡ä¸€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539578131,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":32429,"user_name":"Askerlve","can_delete":false,"product_type":"c1","uid":1178535,"ip_address":"","ucode":"BF29F9A8674507","user_header":"https://static001.geekbang.org/account/avatar/00/11/fb/a7/12c90699.jpg","comment_is_top":false,"comment_ctime":1539569300,"is_pvip":false,"replies":[{"id":"11823","content":"æˆ‘ç¨åå»çœ‹çœ‹å“ˆï¼Œè°¢è°¢ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1539577597,"ip_address":"","comment_id":32429,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1539569300","product_id":100013101,"comment_content":"è€å¸ˆæ€»ç»“ä¸­å¥å­:&quot;sync.Mutexç±»å‹çš„å€¼ä»¥åŠ*sync.RWMutexç±»å‹çš„å€¼&quot;sync.Mutexæ˜¯ä¸æ˜¯å°‘ä¸ª&quot;*&quot;å“‡?","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426769,"discussion_content":"æˆ‘ç¨åå»çœ‹çœ‹å“ˆï¼Œè°¢è°¢ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539577597,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}