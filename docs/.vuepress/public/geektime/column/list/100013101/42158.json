{"id":42158,"title":"32 | context.Contextç±»å‹","content":"<p>æˆ‘ä»¬åœ¨ä¸Šç¯‡æ–‡ç« ä¸­è®²åˆ°äº†<code>sync.WaitGroup</code>ç±»å‹ï¼šä¸€ä¸ªå¯ä»¥å¸®æˆ‘ä»¬å®ç°ä¸€å¯¹å¤šgoroutineåä½œæµç¨‹çš„åŒæ­¥å·¥å…·ã€‚</p><p><strong>åœ¨ä½¿ç”¨<code>WaitGroup</code>å€¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬æœ€å¥½ç”¨â€œå…ˆç»Ÿä¸€<code>Add</code>ï¼Œå†å¹¶å‘<code>Done</code>ï¼Œæœ€å<code>Wait</code>â€çš„æ ‡å‡†æ¨¡å¼æ¥æ„å»ºåä½œæµç¨‹ã€‚</strong></p><p>å¦‚æœåœ¨è°ƒç”¨è¯¥å€¼çš„<code>Wait</code>æ–¹æ³•çš„åŒæ—¶ï¼Œä¸ºäº†å¢å¤§å…¶è®¡æ•°å™¨çš„å€¼ï¼Œè€Œå¹¶å‘åœ°è°ƒç”¨è¯¥å€¼çš„<code>Add</code>æ–¹æ³•ï¼Œé‚£ä¹ˆå°±å¾ˆå¯èƒ½ä¼šå¼•å‘panicã€‚</p><p>è¿™å°±å¸¦æ¥äº†ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœæˆ‘ä»¬ä¸èƒ½åœ¨ä¸€å¼€å§‹å°±ç¡®å®šæ‰§è¡Œå­ä»»åŠ¡çš„goroutineçš„æ•°é‡ï¼Œé‚£ä¹ˆä½¿ç”¨<code>WaitGroup</code>å€¼æ¥åè°ƒå®ƒä»¬å’Œåˆ†å‘å­ä»»åŠ¡çš„goroutineï¼Œå°±æ˜¯æœ‰ä¸€å®šé£é™©çš„ã€‚ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯ï¼šåˆ†æ‰¹åœ°å¯ç”¨æ‰§è¡Œå­ä»»åŠ¡çš„goroutineã€‚</p><h2>å‰å¯¼å†…å®¹ï¼šWaitGroupå€¼è¡¥å……çŸ¥è¯†</h2><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œ<code>WaitGroup</code>å€¼æ˜¯å¯ä»¥è¢«å¤ç”¨çš„ï¼Œä½†éœ€è¦ä¿è¯å…¶è®¡æ•°å‘¨æœŸçš„å®Œæ•´æ€§ã€‚å°¤å…¶æ˜¯æ¶‰åŠå¯¹å…¶<code>Wait</code>æ–¹æ³•è°ƒç”¨çš„æ—¶å€™ï¼Œå®ƒçš„ä¸‹ä¸€ä¸ªè®¡æ•°å‘¨æœŸå¿…é¡»è¦ç­‰åˆ°ï¼Œä¸å½“å‰è®¡æ•°å‘¨æœŸå¯¹åº”çš„é‚£ä¸ª<code>Wait</code>æ–¹æ³•è°ƒç”¨å®Œæˆä¹‹åï¼Œæ‰èƒ½å¤Ÿå¼€å§‹ã€‚</p><p>æˆ‘åœ¨å‰é¢æåˆ°çš„å¯èƒ½ä¼šå¼•å‘panicçš„æƒ…å†µï¼Œå°±æ˜¯ç”±äºæ²¡æœ‰éµå¾ªè¿™æ¡è§„åˆ™è€Œå¯¼è‡´çš„ã€‚</p><p>åªè¦æˆ‘ä»¬åœ¨ä¸¥æ ¼éµå¾ªä¸Šè¿°è§„åˆ™çš„å‰æä¸‹ï¼Œåˆ†æ‰¹åœ°å¯ç”¨æ‰§è¡Œå­ä»»åŠ¡çš„goroutineï¼Œå°±è‚¯å®šä¸ä¼šæœ‰é—®é¢˜ã€‚å…·ä½“çš„å®ç°æ–¹å¼æœ‰ä¸å°‘ï¼Œå…¶ä¸­æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨<code>for</code>å¾ªç¯æ¥ä½œä¸ºè¾…åŠ©ã€‚è¿™é‡Œçš„ä»£ç å¦‚ä¸‹ï¼š</p><!-- [[[read_end]]] --><pre><code>func coordinateWithWaitGroup() {\n total := 12\n stride := 3\n var num int32\n fmt.Printf(&quot;The number: %d [with sync.WaitGroup]\\n&quot;, num)\n var wg sync.WaitGroup\n for i := 1; i &lt;= total; i = i + stride {\n  wg.Add(stride)\n  for j := 0; j &lt; stride; j++ {\n   go addNum(&amp;num, i+j, wg.Done)\n  }\n  wg.Wait()\n }\n fmt.Println(&quot;End.&quot;)\n}\n</code></pre><p>è¿™é‡Œå±•ç¤ºçš„<code>coordinateWithWaitGroup</code>å‡½æ•°ï¼Œå°±æ˜¯ä¸Šä¸€ç¯‡æ–‡ç« ä¸­åŒåå‡½æ•°çš„æ”¹é€ ç‰ˆæœ¬ã€‚è€Œå…¶ä¸­è°ƒç”¨çš„<code>addNum</code>å‡½æ•°ï¼Œåˆ™æ˜¯ä¸Šä¸€ç¯‡æ–‡ç« ä¸­åŒåå‡½æ•°çš„ç®€åŒ–ç‰ˆæœ¬ã€‚è¿™ä¸¤ä¸ªå‡½æ•°éƒ½å·²è¢«æ”¾ç½®åœ¨äº†demo67.goæ–‡ä»¶ä¸­ã€‚</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œç»è¿‡æ”¹é€ åçš„<code>coordinateWithWaitGroup</code>å‡½æ•°ï¼Œå¾ªç¯åœ°ä½¿ç”¨äº†ç”±å˜é‡<code>wg</code>ä»£è¡¨çš„<code>WaitGroup</code>å€¼ã€‚å®ƒè¿ç”¨çš„ä¾ç„¶æ˜¯â€œå…ˆç»Ÿä¸€<code>Add</code>ï¼Œå†å¹¶å‘<code>Done</code>ï¼Œæœ€å<code>Wait</code>â€çš„è¿™ç§æ¨¡å¼ï¼Œåªä¸è¿‡å®ƒåˆ©ç”¨<code>for</code>è¯­å¥ï¼Œå¯¹æ­¤è¿›è¡Œäº†å¤ç”¨ã€‚</p><p>å¥½äº†ï¼Œè‡³æ­¤ä½ åº”è¯¥å·²ç»å¯¹<code>WaitGroup</code>å€¼çš„è¿ç”¨æœ‰æ‰€äº†è§£äº†ã€‚ä¸è¿‡ï¼Œæˆ‘ç°åœ¨æƒ³è®©ä½ ä½¿ç”¨å¦ä¸€ç§å·¥å…·æ¥å®ç°ä¸Šé¢çš„åä½œæµç¨‹ã€‚</p><p><strong>æˆ‘ä»¬ä»Šå¤©çš„é—®é¢˜å°±æ˜¯ï¼šæ€æ ·ä½¿ç”¨<code>context</code>åŒ…ä¸­çš„ç¨‹åºå®ä½“ï¼Œå®ç°ä¸€å¯¹å¤šçš„goroutineåä½œæµç¨‹ï¼Ÿ</strong></p><p>æ›´å…·ä½“åœ°è¯´ï¼Œæˆ‘éœ€è¦ä½ ç¼–å†™ä¸€ä¸ªåä¸º<code>coordinateWithContext</code>çš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°åº”è¯¥å…·æœ‰ä¸Šé¢<code>coordinateWithWaitGroup</code>å‡½æ•°ç›¸åŒçš„åŠŸèƒ½ã€‚</p><p>æ˜¾ç„¶ï¼Œä½ ä¸èƒ½å†ä½¿ç”¨<code>sync.WaitGroup</code>äº†ï¼Œè€Œè¦ç”¨<code>context</code>åŒ…ä¸­çš„å‡½æ•°å’Œ<code>Context</code>ç±»å‹ä½œä¸ºå®ç°å·¥å…·ã€‚è¿™é‡Œæ³¨æ„ä¸€ç‚¹ï¼Œæ˜¯å¦åˆ†æ‰¹å¯ç”¨æ‰§è¡Œå­ä»»åŠ¡çš„goroutineå…¶å®å¹¶ä¸é‡è¦ã€‚</p><p>æˆ‘åœ¨è¿™é‡Œç»™ä½ ä¸€ä¸ªå‚è€ƒç­”æ¡ˆã€‚</p><pre><code>func coordinateWithContext() {\n total := 12\n var num int32\n fmt.Printf(&quot;The number: %d [with context.Context]\\n&quot;, num)\n cxt, cancelFunc := context.WithCancel(context.Background())\n for i := 1; i &lt;= total; i++ {\n  go addNum(&amp;num, i, func() {\n   if atomic.LoadInt32(&amp;num) == int32(total) {\n    cancelFunc()\n   }\n  })\n }\n &lt;-cxt.Done()\n fmt.Println(&quot;End.&quot;)\n}\n</code></pre><p>åœ¨è¿™ä¸ªå‡½æ•°ä½“ä¸­ï¼Œæˆ‘å…ˆåè°ƒç”¨äº†<code>context.Background</code>å‡½æ•°å’Œ<code>context.WithCancel</code>å‡½æ•°ï¼Œå¹¶å¾—åˆ°äº†ä¸€ä¸ªå¯æ’¤é”€çš„<code>context.Context</code>ç±»å‹çš„å€¼ï¼ˆç”±å˜é‡<code>cxt</code>ä»£è¡¨ï¼‰ï¼Œä»¥åŠä¸€ä¸ª<code>context.CancelFunc</code>ç±»å‹çš„æ’¤é”€å‡½æ•°ï¼ˆç”±å˜é‡<code>cancelFunc</code>ä»£è¡¨ï¼‰ã€‚</p><p>åœ¨åé¢é‚£æ¡å”¯ä¸€çš„<code>for</code>è¯­å¥ä¸­ï¼Œæˆ‘åœ¨æ¯æ¬¡è¿­ä»£ä¸­éƒ½é€šè¿‡ä¸€æ¡<code>go</code>è¯­å¥ï¼Œå¼‚æ­¥åœ°è°ƒç”¨<code>addNum</code>å‡½æ•°ï¼Œè°ƒç”¨çš„æ€»æ¬¡æ•°åªä¾æ®äº†<code>total</code>å˜é‡çš„å€¼ã€‚</p><p>è¯·æ³¨æ„æˆ‘ç»™äºˆ<code>addNum</code>å‡½æ•°çš„æœ€åä¸€ä¸ªå‚æ•°å€¼ã€‚å®ƒæ˜¯ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œå…¶ä¸­åªåŒ…å«äº†ä¸€æ¡<code>if</code>è¯­å¥ã€‚è¿™æ¡<code>if</code>è¯­å¥ä¼šâ€œåŸå­åœ°â€åŠ è½½<code>num</code>å˜é‡çš„å€¼ï¼Œå¹¶åˆ¤æ–­å®ƒæ˜¯å¦ç­‰äº<code>total</code>å˜é‡çš„å€¼ã€‚</p><p>å¦‚æœä¸¤ä¸ªå€¼ç›¸ç­‰ï¼Œé‚£ä¹ˆå°±è°ƒç”¨<code>cancelFunc</code>å‡½æ•°ã€‚å…¶å«ä¹‰æ˜¯ï¼Œå¦‚æœæ‰€æœ‰çš„<code>addNum</code>å‡½æ•°éƒ½æ‰§è¡Œå®Œæ¯•ï¼Œé‚£ä¹ˆå°±ç«‹å³é€šçŸ¥åˆ†å‘å­ä»»åŠ¡çš„goroutineã€‚</p><p>è¿™é‡Œåˆ†å‘å­ä»»åŠ¡çš„goroutineï¼Œå³ä¸ºæ‰§è¡Œ<code>coordinateWithContext</code>å‡½æ•°çš„goroutineã€‚å®ƒåœ¨æ‰§è¡Œå®Œ<code>for</code>è¯­å¥åï¼Œä¼šç«‹å³è°ƒç”¨<code>cxt</code>å˜é‡çš„<code>Done</code>å‡½æ•°ï¼Œå¹¶è¯•å›¾é’ˆå¯¹è¯¥å‡½æ•°è¿”å›çš„é€šé“ï¼Œè¿›è¡Œæ¥æ”¶æ“ä½œã€‚</p><p>ç”±äºä¸€æ—¦<code>cancelFunc</code>å‡½æ•°è¢«è°ƒç”¨ï¼Œé’ˆå¯¹è¯¥é€šé“çš„æ¥æ”¶æ“ä½œå°±ä¼šé©¬ä¸Šç»“æŸï¼Œæ‰€ä»¥ï¼Œè¿™æ ·åšå°±å¯ä»¥å®ç°â€œç­‰å¾…æ‰€æœ‰çš„<code>addNum</code>å‡½æ•°éƒ½æ‰§è¡Œå®Œæ¯•â€çš„åŠŸèƒ½ã€‚</p><h2>é—®é¢˜è§£æ</h2><p><code>context.Context</code>ç±»å‹ï¼ˆä»¥ä¸‹ç®€ç§°<code>Context</code>ç±»å‹ï¼‰æ˜¯åœ¨Go 1.7å‘å¸ƒæ—¶æ‰è¢«åŠ å…¥åˆ°æ ‡å‡†åº“çš„ã€‚è€Œåï¼Œæ ‡å‡†åº“ä¸­çš„å¾ˆå¤šå…¶ä»–ä»£ç åŒ…éƒ½ä¸ºäº†æ”¯æŒå®ƒè€Œè¿›è¡Œäº†æ‰©å±•ï¼ŒåŒ…æ‹¬ï¼š<code>os/exec</code>åŒ…ã€<code>net</code>åŒ…ã€<code>database/sql</code>åŒ…ï¼Œä»¥åŠ<code>runtime/pprof</code>åŒ…å’Œ<code>runtime/trace</code>åŒ…ï¼Œç­‰ç­‰ã€‚</p><p><code>Context</code>ç±»å‹ä¹‹æ‰€ä»¥å—åˆ°äº†æ ‡å‡†åº“ä¸­ä¼—å¤šä»£ç åŒ…çš„ç§¯ææ”¯æŒï¼Œä¸»è¦æ˜¯å› ä¸ºå®ƒæ˜¯ä¸€ç§éå¸¸é€šç”¨çš„åŒæ­¥å·¥å…·ã€‚å®ƒçš„å€¼ä¸ä½†å¯ä»¥è¢«ä»»æ„åœ°æ‰©æ•£ï¼Œè€Œä¸”è¿˜å¯ä»¥è¢«ç”¨æ¥ä¼ é€’é¢å¤–çš„ä¿¡æ¯å’Œä¿¡å·ã€‚</p><p>æ›´å…·ä½“åœ°è¯´ï¼Œ<code>Context</code>ç±»å‹å¯ä»¥æä¾›ä¸€ç±»ä»£è¡¨ä¸Šä¸‹æ–‡çš„å€¼ã€‚æ­¤ç±»å€¼æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒå¯ä»¥è¢«ä¼ æ’­ç»™å¤šä¸ªgoroutineã€‚</p><p>ç”±äº<code>Context</code>ç±»å‹å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ¥å£ç±»å‹ï¼Œè€Œ<code>context</code>åŒ…ä¸­å®ç°è¯¥æ¥å£çš„æ‰€æœ‰ç§æœ‰ç±»å‹ï¼Œéƒ½æ˜¯åŸºäºæŸä¸ªæ•°æ®ç±»å‹çš„æŒ‡é’ˆç±»å‹ï¼Œæ‰€ä»¥ï¼Œå¦‚æ­¤ä¼ æ’­å¹¶ä¸ä¼šå½±å“è¯¥ç±»å‹å€¼çš„åŠŸèƒ½å’Œå®‰å…¨ã€‚</p><p><code>Context</code>ç±»å‹çš„å€¼ï¼ˆä»¥ä¸‹ç®€ç§°<code>Context</code>å€¼ï¼‰æ˜¯å¯ä»¥ç¹è¡çš„ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ª<code>Context</code>å€¼äº§ç”Ÿå‡ºä»»æ„ä¸ªå­å€¼ã€‚è¿™äº›å­å€¼å¯ä»¥æºå¸¦å…¶çˆ¶å€¼çš„å±æ€§å’Œæ•°æ®ï¼Œä¹Ÿå¯ä»¥å“åº”æˆ‘ä»¬é€šè¿‡å…¶çˆ¶å€¼ä¼ è¾¾çš„ä¿¡å·ã€‚</p><p>æ­£å› ä¸ºå¦‚æ­¤ï¼Œæ‰€æœ‰çš„<code>Context</code>å€¼å…±åŒæ„æˆäº†ä¸€é¢—ä»£è¡¨äº†ä¸Šä¸‹æ–‡å…¨è²Œçš„æ ‘å½¢ç»“æ„ã€‚è¿™æ£µæ ‘çš„æ ‘æ ¹ï¼ˆæˆ–è€…ç§°ä¸Šä¸‹æ–‡æ ¹èŠ‚ç‚¹ï¼‰æ˜¯ä¸€ä¸ªå·²ç»åœ¨<code>context</code>åŒ…ä¸­é¢„å®šä¹‰å¥½çš„<code>Context</code>å€¼ï¼Œå®ƒæ˜¯å…¨å±€å”¯ä¸€çš„ã€‚é€šè¿‡è°ƒç”¨<code>context.Background</code>å‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å–åˆ°å®ƒï¼ˆæˆ‘åœ¨<code>coordinateWithContext</code>å‡½æ•°ä¸­å°±æ˜¯è¿™ä¹ˆåšçš„ï¼‰ã€‚</p><p>è¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼Œè¿™ä¸ªä¸Šä¸‹æ–‡æ ¹èŠ‚ç‚¹ä»…ä»…æ˜¯ä¸€ä¸ªæœ€åŸºæœ¬çš„æ”¯ç‚¹ï¼Œå®ƒä¸æä¾›ä»»ä½•é¢å¤–çš„åŠŸèƒ½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ—¢ä¸å¯ä»¥è¢«æ’¤é”€ï¼ˆcancelï¼‰ï¼Œä¹Ÿä¸èƒ½æºå¸¦ä»»ä½•æ•°æ®ã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œ<code>context</code>åŒ…ä¸­è¿˜åŒ…å«äº†å››ä¸ªç”¨äºç¹è¡<code>Context</code>å€¼çš„å‡½æ•°ï¼Œå³ï¼š<code>WithCancel</code>ã€<code>WithDeadline</code>ã€<code>WithTimeout</code>å’Œ<code>WithValue</code>ã€‚</p><p>è¿™äº›å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹éƒ½æ˜¯<code>context.Context</code>ï¼Œè€Œåç§°éƒ½ä¸º<code>parent</code>ã€‚é¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªä½ç½®ä¸Šçš„å‚æ•°å¯¹åº”çš„éƒ½æ˜¯å®ƒä»¬å°†ä¼šäº§ç”Ÿçš„<code>Context</code>å€¼çš„çˆ¶å€¼ã€‚</p><p><code>WithCancel</code>å‡½æ•°ç”¨äºäº§ç”Ÿä¸€ä¸ªå¯æ’¤é”€çš„<code>parent</code>çš„å­å€¼ã€‚åœ¨<code>coordinateWithContext</code>å‡½æ•°ä¸­ï¼Œæˆ‘é€šè¿‡è°ƒç”¨è¯¥å‡½æ•°ï¼Œè·å¾—äº†ä¸€ä¸ªè¡ç”Ÿè‡ªä¸Šä¸‹æ–‡æ ¹èŠ‚ç‚¹çš„<code>Context</code>å€¼ï¼Œå’Œä¸€ä¸ªç”¨äºè§¦å‘æ’¤é”€ä¿¡å·çš„å‡½æ•°ã€‚</p><p>è€Œ<code>WithDeadline</code>å‡½æ•°å’Œ<code>WithTimeout</code>å‡½æ•°åˆ™éƒ½å¯ä»¥è¢«ç”¨æ¥äº§ç”Ÿä¸€ä¸ªä¼šå®šæ—¶æ’¤é”€çš„<code>parent</code>çš„å­å€¼ã€‚è‡³äº<code>WithValue</code>å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨å®ƒï¼Œäº§ç”Ÿä¸€ä¸ªä¼šæºå¸¦é¢å¤–æ•°æ®çš„<code>parent</code>çš„å­å€¼ã€‚</p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»å¯¹<code>context</code>åŒ…ä¸­çš„å‡½æ•°å’Œ<code>Context</code>ç±»å‹æœ‰äº†ä¸€ä¸ªåŸºæœ¬çš„è®¤è¯†äº†ã€‚ä¸è¿‡è¿™è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬å†æ¥æ‰©å±•ä¸€ä¸‹ã€‚</p><h2>çŸ¥è¯†æ‰©å±•</h2><h3>é—®é¢˜1ï¼šâ€œå¯æ’¤é”€çš„â€åœ¨<code>context</code>åŒ…ä¸­ä»£è¡¨ç€ä»€ä¹ˆï¼Ÿâ€œæ’¤é”€â€ä¸€ä¸ª<code>Context</code>å€¼åˆæ„å‘³ç€ä»€ä¹ˆï¼Ÿ</h3><p>æˆ‘ç›¸ä¿¡å¾ˆå¤šåˆè¯†<code>context</code>åŒ…çš„Goç¨‹åºå¼€å‘è€…ï¼Œéƒ½ä¼šæœ‰è¿™æ ·çš„ç–‘é—®ã€‚ç¡®å®ï¼Œâ€œå¯æ’¤é”€çš„â€ï¼ˆcancelableï¼‰è¿™ä¸ªè¯åœ¨è¿™é‡Œæ˜¯æ¯”è¾ƒæŠ½è±¡çš„ï¼Œå¾ˆå®¹æ˜“è®©äººè¿·æƒ‘ã€‚æˆ‘è¿™é‡Œå†æ¥è§£é‡Šä¸€ä¸‹ã€‚</p><p>è¿™éœ€è¦ä»<code>Context</code>ç±»å‹çš„å£°æ˜è®²èµ·ã€‚è¿™ä¸ªæ¥å£ä¸­æœ‰ä¸¤ä¸ªæ–¹æ³•ä¸â€œæ’¤é”€â€æ¯æ¯ç›¸å…³ã€‚<code>Done</code>æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªå…ƒç´ ç±»å‹ä¸º<code>struct{}</code>çš„æ¥æ”¶é€šé“ã€‚ä¸è¿‡ï¼Œè¿™ä¸ªæ¥æ”¶é€šé“çš„ç”¨é€”å¹¶ä¸æ˜¯ä¼ é€’å…ƒç´ å€¼ï¼Œè€Œæ˜¯è®©è°ƒç”¨æ–¹å»æ„ŸçŸ¥â€œæ’¤é”€â€å½“å‰<code>Context</code>å€¼çš„é‚£ä¸ªä¿¡å·ã€‚</p><p>ä¸€æ—¦å½“å‰çš„<code>Context</code>å€¼è¢«æ’¤é”€ï¼Œè¿™é‡Œçš„æ¥æ”¶é€šé“å°±ä¼šè¢«ç«‹å³å…³é—­ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå¯¹äºä¸€ä¸ªæœªåŒ…å«ä»»ä½•å…ƒç´ å€¼çš„é€šé“æ¥è¯´ï¼Œå®ƒçš„å…³é—­ä¼šä½¿ä»»ä½•é’ˆå¯¹å®ƒçš„æ¥æ”¶æ“ä½œç«‹å³ç»“æŸã€‚</p><p>æ­£å› ä¸ºå¦‚æ­¤ï¼Œåœ¨<code>coordinateWithContext</code>å‡½æ•°ä¸­ï¼ŒåŸºäºè°ƒç”¨è¡¨è¾¾å¼<code>cxt.Done()</code>çš„æ¥æ”¶æ“ä½œï¼Œæ‰èƒ½å¤Ÿèµ·åˆ°æ„ŸçŸ¥æ’¤é”€ä¿¡å·çš„ä½œç”¨ã€‚</p><p>é™¤äº†è®©<code>Context</code>å€¼çš„ä½¿ç”¨æ–¹æ„ŸçŸ¥åˆ°æ’¤é”€ä¿¡å·ï¼Œè®©å®ƒä»¬å¾—åˆ°â€œæ’¤é”€â€çš„å…·ä½“åŸå› ï¼Œæœ‰æ—¶ä¹Ÿæ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚åè€…å³æ˜¯<code>Context</code>ç±»å‹çš„<code>Err</code>æ–¹æ³•çš„ä½œç”¨ã€‚è¯¥æ–¹æ³•çš„ç»“æœæ˜¯<code>error</code>ç±»å‹çš„ï¼Œå¹¶ä¸”å…¶å€¼åªå¯èƒ½ç­‰äº<code>context.Canceled</code>å˜é‡çš„å€¼ï¼Œæˆ–è€…<code>context.DeadlineExceeded</code>å˜é‡çš„å€¼ã€‚</p><p>å‰è€…ç”¨äºè¡¨ç¤ºæ‰‹åŠ¨æ’¤é”€ï¼Œè€Œåè€…åˆ™ä»£è¡¨ï¼šç”±äºæˆ‘ä»¬ç»™å®šçš„è¿‡æœŸæ—¶é—´å·²åˆ°ï¼Œè€Œå¯¼è‡´çš„æ’¤é”€ã€‚</p><p>ä½ å¯èƒ½å·²ç»æ„Ÿè§‰åˆ°äº†ï¼Œå¯¹äº<code>Context</code>å€¼æ¥è¯´ï¼Œâ€œæ’¤é”€â€è¿™ä¸ªè¯å¦‚æœå½“åè¯è®²ï¼ŒæŒ‡çš„å…¶å®å°±æ˜¯è¢«ç”¨æ¥è¡¨è¾¾â€œæ’¤é”€â€çŠ¶æ€çš„ä¿¡å·ï¼›å¦‚æœå½“åŠ¨è¯è®²ï¼ŒæŒ‡çš„å°±æ˜¯å¯¹æ’¤é”€ä¿¡å·çš„ä¼ è¾¾ï¼›è€Œâ€œå¯æ’¤é”€çš„â€æŒ‡çš„åˆ™æ˜¯å…·æœ‰ä¼ è¾¾è¿™ç§æ’¤é”€ä¿¡å·çš„èƒ½åŠ›ã€‚</p><p>æˆ‘åœ¨å‰é¢è®²è¿‡ï¼Œå½“æˆ‘ä»¬é€šè¿‡è°ƒç”¨<code>context.WithCancel</code>å‡½æ•°äº§ç”Ÿä¸€ä¸ªå¯æ’¤é”€çš„<code>Context</code>å€¼æ—¶ï¼Œè¿˜ä¼šè·å¾—ä¸€ä¸ªç”¨äºè§¦å‘æ’¤é”€ä¿¡å·çš„å‡½æ•°ã€‚</p><p>é€šè¿‡è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å°±å¯ä»¥è§¦å‘é’ˆå¯¹è¿™ä¸ª<code>Context</code>å€¼çš„æ’¤é”€ä¿¡å·ã€‚ä¸€æ—¦è§¦å‘ï¼Œæ’¤é”€ä¿¡å·å°±ä¼šç«‹å³è¢«ä¼ è¾¾ç»™è¿™ä¸ª<code>Context</code>å€¼ï¼Œå¹¶ç”±å®ƒçš„<code>Done</code>æ–¹æ³•çš„ç»“æœå€¼ï¼ˆä¸€ä¸ªæ¥æ”¶é€šé“ï¼‰è¡¨è¾¾å‡ºæ¥ã€‚</p><p>æ’¤é”€å‡½æ•°åªè´Ÿè´£è§¦å‘ä¿¡å·ï¼Œè€Œå¯¹åº”çš„å¯æ’¤é”€çš„<code>Context</code>å€¼ä¹Ÿåªè´Ÿè´£ä¼ è¾¾ä¿¡å·ï¼Œå®ƒä»¬éƒ½ä¸ä¼šå»ç®¡åè¾¹å…·ä½“çš„â€œæ’¤é”€â€æ“ä½œã€‚å®é™…ä¸Šï¼Œæˆ‘ä»¬çš„ä»£ç å¯ä»¥åœ¨æ„ŸçŸ¥åˆ°æ’¤é”€ä¿¡å·ä¹‹åï¼Œè¿›è¡Œä»»æ„çš„æ“ä½œï¼Œ<code>Context</code>å€¼å¯¹æ­¤å¹¶æ²¡æœ‰ä»»ä½•çš„çº¦æŸã€‚</p><p>æœ€åï¼Œè‹¥å†æ·±ç©¶çš„è¯ï¼Œè¿™é‡Œçš„â€œæ’¤é”€â€æœ€åŸå§‹çš„å«ä¹‰å…¶å®å°±æ˜¯ï¼Œç»ˆæ­¢ç¨‹åºé’ˆå¯¹æŸç§è¯·æ±‚ï¼ˆæ¯”å¦‚HTTPè¯·æ±‚ï¼‰çš„å“åº”ï¼Œæˆ–è€…å–æ¶ˆå¯¹æŸç§æŒ‡ä»¤ï¼ˆæ¯”å¦‚SQLæŒ‡ä»¤ï¼‰çš„å¤„ç†ã€‚è¿™ä¹Ÿæ˜¯Goè¯­è¨€å›¢é˜Ÿåœ¨åˆ›å»º<code>context</code>ä»£ç åŒ…ï¼Œå’Œ<code>Context</code>ç±»å‹æ—¶çš„åˆè¡·ã€‚</p><p>å¦‚æœæˆ‘ä»¬å»æŸ¥çœ‹<code>net</code>åŒ…å’Œ<code>database/sql</code>åŒ…çš„APIå’Œæºç çš„è¯ï¼Œå°±å¯ä»¥äº†è§£å®ƒä»¬åœ¨è¿™æ–¹é¢çš„å…¸å‹åº”ç”¨ã€‚</p><h3>é—®é¢˜2ï¼šæ’¤é”€ä¿¡å·æ˜¯å¦‚ä½•åœ¨ä¸Šä¸‹æ–‡æ ‘ä¸­ä¼ æ’­çš„ï¼Ÿ</h3><p>æˆ‘åœ¨å‰é¢è®²äº†ï¼Œ<code>context</code>åŒ…ä¸­åŒ…å«äº†å››ä¸ªç”¨äºç¹è¡<code>Context</code>å€¼çš„å‡½æ•°ã€‚å…¶ä¸­çš„<code>WithCancel</code>ã€<code>WithDeadline</code>å’Œ<code>WithTimeout</code>éƒ½æ˜¯è¢«ç”¨æ¥åŸºäºç»™å®šçš„<code>Context</code>å€¼äº§ç”Ÿå¯æ’¤é”€çš„å­å€¼çš„ã€‚</p><p><code>context</code>åŒ…çš„<code>WithCancel</code>å‡½æ•°åœ¨è¢«è°ƒç”¨åä¼šäº§ç”Ÿä¸¤ä¸ªç»“æœå€¼ã€‚ç¬¬ä¸€ä¸ªç»“æœå€¼å°±æ˜¯é‚£ä¸ªå¯æ’¤é”€çš„<code>Context</code>å€¼ï¼Œè€Œç¬¬äºŒä¸ªç»“æœå€¼åˆ™æ˜¯ç”¨äºè§¦å‘æ’¤é”€ä¿¡å·çš„å‡½æ•°ã€‚</p><p>åœ¨æ’¤é”€å‡½æ•°è¢«è°ƒç”¨ä¹‹åï¼Œå¯¹åº”çš„<code>Context</code>å€¼ä¼šå…ˆå…³é—­å®ƒå†…éƒ¨çš„æ¥æ”¶é€šé“ï¼Œä¹Ÿå°±æ˜¯å®ƒçš„<code>Done</code>æ–¹æ³•ä¼šè¿”å›çš„é‚£ä¸ªé€šé“ã€‚</p><p>ç„¶åï¼Œå®ƒä¼šå‘å®ƒçš„æ‰€æœ‰å­å€¼ï¼ˆæˆ–è€…è¯´å­èŠ‚ç‚¹ï¼‰ä¼ è¾¾æ’¤é”€ä¿¡å·ã€‚è¿™äº›å­å€¼ä¼šå¦‚æ³•ç‚®åˆ¶ï¼ŒæŠŠæ’¤é”€ä¿¡å·ç»§ç»­ä¼ æ’­ä¸‹å»ã€‚æœ€åï¼Œè¿™ä¸ª<code>Context</code>å€¼ä¼šæ–­å¼€å®ƒä¸å…¶çˆ¶å€¼ä¹‹é—´çš„å…³è”ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a8/9e/a801f8f2b5e89017ec2857bc1815fc9e.png?wh=1112*647\" alt=\"\"></p><p>ï¼ˆåœ¨ä¸Šä¸‹æ–‡æ ‘ä¸­ä¼ æ’­æ’¤é”€ä¿¡å·ï¼‰</p><p>æˆ‘ä»¬é€šè¿‡è°ƒç”¨<code>context</code>åŒ…çš„<code>WithDeadline</code>å‡½æ•°æˆ–è€…<code>WithTimeout</code>å‡½æ•°ç”Ÿæˆçš„<code>Context</code>å€¼ä¹Ÿæ˜¯å¯æ’¤é”€çš„ã€‚å®ƒä»¬ä¸ä½†å¯ä»¥è¢«æ‰‹åŠ¨æ’¤é”€ï¼Œè¿˜ä¼šä¾æ®åœ¨ç”Ÿæˆæ—¶è¢«ç»™å®šçš„è¿‡æœŸæ—¶é—´ï¼Œè‡ªåŠ¨åœ°è¿›è¡Œå®šæ—¶æ’¤é”€ã€‚è¿™é‡Œå®šæ—¶æ’¤é”€çš„åŠŸèƒ½æ˜¯å€ŸåŠ©å®ƒä»¬å†…éƒ¨çš„è®¡æ—¶å™¨æ¥å®ç°çš„ã€‚</p><p>å½“è¿‡æœŸæ—¶é—´åˆ°è¾¾æ—¶ï¼Œè¿™ä¸¤ç§<code>Context</code>å€¼çš„è¡Œä¸ºä¸<code>Context</code>å€¼è¢«æ‰‹åŠ¨æ’¤é”€æ—¶çš„è¡Œä¸ºæ˜¯å‡ ä¹ä¸€è‡´çš„ï¼Œåªä¸è¿‡å‰è€…ä¼šåœ¨æœ€ååœæ­¢å¹¶é‡Šæ”¾æ‰å…¶å†…éƒ¨çš„è®¡æ—¶å™¨ã€‚</p><p>æœ€åè¦æ³¨æ„ï¼Œé€šè¿‡è°ƒç”¨<code>context.WithValue</code>å‡½æ•°å¾—åˆ°çš„<code>Context</code>å€¼æ˜¯ä¸å¯æ’¤é”€çš„ã€‚æ’¤é”€ä¿¡å·åœ¨è¢«ä¼ æ’­æ—¶ï¼Œè‹¥é‡åˆ°å®ƒä»¬åˆ™ä¼šç›´æ¥è·¨è¿‡ï¼Œå¹¶è¯•å›¾å°†ä¿¡å·ç›´æ¥ä¼ ç»™å®ƒä»¬çš„å­å€¼ã€‚</p><h3>é—®é¢˜ 3ï¼šæ€æ ·é€šè¿‡<code>Context</code>å€¼æºå¸¦æ•°æ®ï¼Ÿæ€æ ·ä»ä¸­è·å–æ•°æ®ï¼Ÿ</h3><p>æ—¢ç„¶è°ˆåˆ°äº†<code>context</code>åŒ…çš„<code>WithValue</code>å‡½æ•°ï¼Œæˆ‘ä»¬å°±æ¥è¯´è¯´<code>Context</code>å€¼æºå¸¦æ•°æ®çš„æ–¹å¼ã€‚</p><p><code>WithValue</code>å‡½æ•°åœ¨äº§ç”Ÿæ–°çš„<code>Context</code>å€¼ï¼ˆä»¥ä¸‹ç®€ç§°å«æ•°æ®çš„<code>Context</code>å€¼ï¼‰çš„æ—¶å€™éœ€è¦ä¸‰ä¸ªå‚æ•°ï¼Œå³ï¼šçˆ¶å€¼ã€é”®å’Œå€¼ã€‚ä¸â€œå­—å…¸å¯¹äºé”®çš„çº¦æŸâ€ç±»ä¼¼ï¼Œè¿™é‡Œé”®çš„ç±»å‹å¿…é¡»æ˜¯å¯åˆ¤ç­‰çš„ã€‚</p><p>åŸå› å¾ˆç®€å•ï¼Œå½“æˆ‘ä»¬ä»ä¸­è·å–æ•°æ®çš„æ—¶å€™ï¼Œå®ƒéœ€è¦æ ¹æ®ç»™å®šçš„é”®æ¥æŸ¥æ‰¾å¯¹åº”çš„å€¼ã€‚ä¸è¿‡ï¼Œè¿™ç§<code>Context</code>å€¼å¹¶ä¸æ˜¯ç”¨å­—å…¸æ¥å­˜å‚¨é”®å’Œå€¼çš„ï¼Œåä¸¤è€…åªæ˜¯è¢«ç®€å•åœ°å­˜å‚¨åœ¨å‰è€…çš„ç›¸åº”å­—æ®µä¸­è€Œå·²ã€‚</p><p><code>Context</code>ç±»å‹çš„<code>Value</code>æ–¹æ³•å°±æ˜¯è¢«ç”¨æ¥è·å–æ•°æ®çš„ã€‚åœ¨æˆ‘ä»¬è°ƒç”¨å«æ•°æ®çš„<code>Context</code>å€¼çš„<code>Value</code>æ–¹æ³•æ—¶ï¼Œå®ƒä¼šå…ˆåˆ¤æ–­ç»™å®šçš„é”®ï¼Œæ˜¯å¦ä¸å½“å‰å€¼ä¸­å­˜å‚¨çš„é”®ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰å°±æŠŠè¯¥å€¼ä¸­å­˜å‚¨çš„å€¼ç›´æ¥è¿”å›ï¼Œå¦åˆ™å°±åˆ°å…¶çˆ¶å€¼ä¸­ç»§ç»­æŸ¥æ‰¾ã€‚</p><p>å¦‚æœå…¶çˆ¶å€¼ä¸­ä»ç„¶æœªå­˜å‚¨ç›¸ç­‰çš„é”®ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•å°±ä¼šæ²¿ç€ä¸Šä¸‹æ–‡æ ¹èŠ‚ç‚¹çš„æ–¹å‘ä¸€è·¯æŸ¥æ‰¾ä¸‹å»ã€‚</p><p>æ³¨æ„ï¼Œé™¤äº†å«æ•°æ®çš„<code>Context</code>å€¼ä»¥å¤–ï¼Œå…¶ä»–å‡ ç§<code>Context</code>å€¼éƒ½æ˜¯æ— æ³•æºå¸¦æ•°æ®çš„ã€‚å› æ­¤ï¼Œ<code>Context</code>å€¼çš„<code>Value</code>æ–¹æ³•åœ¨æ²¿è·¯æŸ¥æ‰¾çš„æ—¶å€™ï¼Œä¼šç›´æ¥è·¨è¿‡é‚£å‡ ç§å€¼ã€‚</p><p>å¦‚æœæˆ‘ä»¬è°ƒç”¨çš„<code>Value</code>æ–¹æ³•çš„æ‰€å±å€¼æœ¬èº«å°±æ˜¯ä¸å«æ•°æ®çš„ï¼Œé‚£ä¹ˆå®é™…è°ƒç”¨çš„å°±å°†ä¼šæ˜¯å…¶çˆ¶è¾ˆæˆ–ç¥–è¾ˆçš„<code>Value</code>æ–¹æ³•ã€‚è¿™æ˜¯ç”±äºè¿™å‡ ç§<code>Context</code>å€¼çš„å®é™…ç±»å‹ï¼Œéƒ½å±äºç»“æ„ä½“ç±»å‹ï¼Œå¹¶ä¸”å®ƒä»¬éƒ½æ˜¯é€šè¿‡â€œå°†å…¶çˆ¶å€¼åµŒå…¥åˆ°è‡ªèº«â€ï¼Œæ¥è¡¨è¾¾çˆ¶å­å…³ç³»çš„ã€‚</p><p>æœ€åï¼Œæé†’ä¸€ä¸‹ï¼Œ<code>Context</code>æ¥å£å¹¶æ²¡æœ‰æä¾›æ”¹å˜æ•°æ®çš„æ–¹æ³•ã€‚å› æ­¤ï¼Œåœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªèƒ½é€šè¿‡åœ¨ä¸Šä¸‹æ–‡æ ‘ä¸­æ·»åŠ å«æ•°æ®çš„<code>Context</code>å€¼æ¥å­˜å‚¨æ–°çš„æ•°æ®ï¼Œæˆ–è€…é€šè¿‡æ’¤é”€æ­¤ç§å€¼çš„çˆ¶å€¼ä¸¢å¼ƒæ‰ç›¸åº”çš„æ•°æ®ã€‚å¦‚æœä½ å­˜å‚¨åœ¨è¿™é‡Œçš„æ•°æ®å¯ä»¥ä»å¤–éƒ¨æ”¹å˜ï¼Œé‚£ä¹ˆå¿…é¡»è‡ªè¡Œä¿è¯å®‰å…¨ã€‚</p><h2>æ€»ç»“</h2><p>æˆ‘ä»¬ä»Šå¤©ä¸»è¦è®¨è®ºçš„æ˜¯<code>context</code>åŒ…ä¸­çš„å‡½æ•°å’Œ<code>Context</code>ç±»å‹ã€‚è¯¥åŒ…ä¸­çš„å‡½æ•°éƒ½æ˜¯ç”¨äºäº§ç”Ÿæ–°çš„<code>Context</code>ç±»å‹å€¼çš„ã€‚<code>Context</code>ç±»å‹æ˜¯ä¸€ä¸ªå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®ç°å¤šgoroutineåä½œæµç¨‹çš„åŒæ­¥å·¥å…·ã€‚ä¸ä½†å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡æ­¤ç±»å‹çš„å€¼ä¼ è¾¾æ’¤é”€ä¿¡å·æˆ–ä¼ é€’æ•°æ®ã€‚</p><p><code>Context</code>ç±»å‹çš„å®é™…å€¼å¤§ä½“ä¸Šåˆ†ä¸ºä¸‰ç§ï¼Œå³ï¼šæ ¹<code>Context</code>å€¼ã€å¯æ’¤é”€çš„<code>Context</code>å€¼å’Œå«æ•°æ®çš„<code>Context</code>å€¼ã€‚æ‰€æœ‰çš„<code>Context</code>å€¼å…±åŒæ„æˆäº†ä¸€é¢—ä¸Šä¸‹æ–‡æ ‘ã€‚è¿™æ£µæ ‘çš„ä½œç”¨åŸŸæ˜¯å…¨å±€çš„ï¼Œè€Œæ ¹<code>Context</code>å€¼å°±æ˜¯è¿™æ£µæ ‘çš„æ ¹ã€‚å®ƒæ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œå¹¶ä¸”ä¸æä¾›ä»»ä½•é¢å¤–çš„åŠŸèƒ½ã€‚</p><p>å¯æ’¤é”€çš„<code>Context</code>å€¼åˆåˆ†ä¸ºï¼šåªå¯æ‰‹åŠ¨æ’¤é”€çš„<code>Context</code>å€¼ï¼Œå’Œå¯ä»¥å®šæ—¶æ’¤é”€çš„<code>Context</code>å€¼ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ç”Ÿæˆå®ƒä»¬æ—¶å¾—åˆ°çš„æ’¤é”€å‡½æ•°æ¥å¯¹å…¶è¿›è¡Œæ‰‹åŠ¨çš„æ’¤é”€ã€‚å¯¹äºåè€…ï¼Œå®šæ—¶æ’¤é”€çš„æ—¶é—´å¿…é¡»åœ¨ç”Ÿæˆæ—¶å°±å®Œå…¨ç¡®å®šï¼Œå¹¶ä¸”ä¸èƒ½æ›´æ”¹ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿‡æœŸæ—¶é—´è¾¾åˆ°ä¹‹å‰ï¼Œå¯¹å…¶è¿›è¡Œæ‰‹åŠ¨çš„æ’¤é”€ã€‚</p><p>ä¸€æ—¦æ’¤é”€å‡½æ•°è¢«è°ƒç”¨ï¼Œæ’¤é”€ä¿¡å·å°±ä¼šç«‹å³è¢«ä¼ è¾¾ç»™å¯¹åº”çš„<code>Context</code>å€¼ï¼Œå¹¶ç”±è¯¥å€¼çš„<code>Done</code>æ–¹æ³•è¿”å›çš„æ¥æ”¶é€šé“è¡¨è¾¾å‡ºæ¥ã€‚</p><p>â€œæ’¤é”€â€è¿™ä¸ªæ“ä½œæ˜¯<code>Context</code>å€¼èƒ½å¤Ÿåè°ƒå¤šä¸ªgoroutineçš„å…³é”®æ‰€åœ¨ã€‚æ’¤é”€ä¿¡å·æ€»æ˜¯ä¼šæ²¿ç€ä¸Šä¸‹æ–‡æ ‘å¶å­èŠ‚ç‚¹çš„æ–¹å‘ä¼ æ’­å¼€æ¥ã€‚</p><p>å«æ•°æ®çš„<code>Context</code>å€¼å¯ä»¥æºå¸¦æ•°æ®ã€‚æ¯ä¸ªå€¼éƒ½å¯ä»¥å­˜å‚¨ä¸€å¯¹é”®å’Œå€¼ã€‚åœ¨æˆ‘ä»¬è°ƒç”¨å®ƒçš„<code>Value</code>æ–¹æ³•çš„æ—¶å€™ï¼Œå®ƒä¼šæ²¿ç€ä¸Šä¸‹æ–‡æ ‘çš„æ ¹èŠ‚ç‚¹çš„æ–¹å‘é€ä¸ªå€¼çš„è¿›è¡ŒæŸ¥æ‰¾ã€‚å¦‚æœå‘ç°ç›¸ç­‰çš„é”®ï¼Œå®ƒå°±ä¼šç«‹å³è¿”å›å¯¹åº”çš„å€¼ï¼Œå¦åˆ™å°†åœ¨æœ€åè¿”å›<code>nil</code>ã€‚</p><p>å«æ•°æ®çš„<code>Context</code>å€¼ä¸èƒ½è¢«æ’¤é”€ï¼Œè€Œå¯æ’¤é”€çš„<code>Context</code>å€¼åˆæ— æ³•æºå¸¦æ•°æ®ã€‚ä½†æ˜¯ï¼Œç”±äºå®ƒä»¬å…±åŒç»„æˆäº†ä¸€ä¸ªæœ‰æœºçš„æ•´ä½“ï¼ˆå³ä¸Šä¸‹æ–‡æ ‘ï¼‰ï¼Œæ‰€ä»¥åœ¨åŠŸèƒ½ä¸Šè¦æ¯”<code>sync.WaitGroup</code>å¼ºå¤§å¾—å¤šã€‚</p><h2>æ€è€ƒé¢˜</h2><p>ä»Šå¤©çš„æ€è€ƒé¢˜æ˜¯ï¼š<code>Context</code>å€¼åœ¨ä¼ è¾¾æ’¤é”€ä¿¡å·çš„æ—¶å€™æ˜¯å¹¿åº¦ä¼˜å…ˆçš„ï¼Œè¿˜æ˜¯æ·±åº¦ä¼˜å…ˆçš„ï¼Ÿå…¶ä¼˜åŠ¿å’ŒåŠ£åŠ¿éƒ½æ˜¯ä»€ä¹ˆï¼Ÿ</p><p><a href=\"https://github.com/hyper0x/Golang_Puzzlers\">æˆ³æ­¤æŸ¥çœ‹Goè¯­è¨€ä¸“æ æ–‡ç« é…å¥—è¯¦ç»†ä»£ç ã€‚</a></p><p></p>","comments":[{"had_liked":false,"id":34893,"user_name":"Cloud","can_delete":false,"product_type":"c1","uid":1147061,"ip_address":"","ucode":"86B1C459EC9F82","user_header":"https://static001.geekbang.org/account/avatar/00/11/80/b5/f59d92f1.jpg","comment_is_top":false,"comment_ctime":1540347200,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"482576684352","product_id":100013101,"comment_content":"è¿˜æ²¡ç”¨è¿‡contextåŒ…çš„æˆ‘çœ‹å¾—ä¸€æ„£ä¸€æ„£çš„","like_count":112,"discussions":[{"author":{"id":1251238,"avatar":"https://static001.geekbang.org/account/avatar/00/13/17/a6/fae3dd91.jpg","nickname":"æ‰­æ–­ç¿…è†€çš„çŒª","note":"","ucode":"E94AE44B950C91","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384336,"discussion_content":"å†™å¾—ä¸å’‹åœ°è¿™æ–‡ç« ","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1626506719,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1534500,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/qhonwcQle1RBufvLdTm4MgSNl554GBXUZtNNH65oYajbbRLxKsZX4hM9vFtrLLpDM0H93ZNWRFAZSrIZC7yAsQ/132","nickname":"Geek_as","note":"","ucode":"AB7B70DBC2B5F8","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":565359,"discussion_content":"å¾é“ä¸å­¤","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1650448906,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2626977,"avatar":"https://static001.geekbang.org/account/avatar/00/28/15/a1/eb056e50.jpg","nickname":"ğŸ‡² ğŸ‡³ ğŸ‡¸ ğŸ‡® ğŸ‡³ ğŸ‡·","note":"","ucode":"ECE45138BE7C1F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":410096,"discussion_content":"ç›´æ¥è’™è”½â€¦â€¦","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1635599703,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065849,"avatar":"https://static001.geekbang.org/account/avatar/00/10/43/79/18073134.jpg","nickname":"test","note":"","ucode":"9A4973E591DD12","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374564,"discussion_content":"ç›´æ¥æ‡µé€¼","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1621247816,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46923,"user_name":"Spike","can_delete":false,"product_type":"c1","uid":1200587,"ip_address":"","ucode":"9548DF1596CF9F","user_header":"https://static001.geekbang.org/account/avatar/00/12/51/cb/c8b42257.jpg","comment_is_top":false,"comment_ctime":1544002448,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"259242040208","product_id":100013101,"comment_content":"https:&#47;&#47;blog.golang.org&#47;pipelines<br>https:&#47;&#47;blog.golang.org&#47;context<br>è¦äº†è§£contextçš„æ¥æºå’Œç”¨æ³•ï¼Œå»ºè®®å…ˆé˜…è¯»å®˜ç½‘çš„è¿™ä¸¤ç¯‡blog<br>","like_count":60},{"had_liked":false,"id":55953,"user_name":"å‹‰æ‰","can_delete":false,"product_type":"c1","uid":1054033,"ip_address":"","ucode":"D2A1E7E5043B45","user_header":"https://static001.geekbang.org/account/avatar/00/10/15/51/223b6e04.jpg","comment_is_top":false,"comment_ctime":1546354107,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"156165176763","product_id":100013101,"comment_content":"context æ ‘ä¸éš¾ç†è§£ï¼Œcontext.Background æ˜¯æ ¹èŠ‚ç‚¹ï¼Œä½†å®ƒæ˜¯ä¸ªç©ºçš„æ ¹èŠ‚ç‚¹ï¼Œç„¶åé€šè¿‡å®ƒæˆ‘ä»¬å¯ä»¥åˆ›å»ºå‡ºè‡ªå·±çš„ context èŠ‚ç‚¹ï¼Œåœ¨è¿™ä¸ªèŠ‚ç‚¹ä¹‹ä¸‹åˆå¯ä»¥åˆ›å»ºå‡ºæ–°çš„ context èŠ‚ç‚¹ã€‚çœ‹äº† context çš„å®ç°ï¼Œå…¶å®å®ƒå°±æ˜¯é€šè¿‡ä¸€ä¸ª channel æ¥å®ç°ï¼Œcancel() å°±æ˜¯å…³é—­è¯¥ç®¡é“ï¼Œcontext.Done() åœ¨ channel å…³é—­åï¼Œä¼šè¿”å›ã€‚æ›¿æˆ‘ä»¬é€ çš„è½®å­ä¸»è¦å®ç°ä¸¤ä¸ªåŠŸèƒ½ï¼š1. åŠ é”ï¼Œå®ç°çº¿ç¨‹å®‰å…¨ï¼›2. cancel() ä¼šå°†æœ¬èŠ‚ç‚¹ï¼ŒåŠå­èŠ‚ç‚¹çš„ channel éƒ½å…³é—­ã€‚","like_count":37},{"had_liked":false,"id":39876,"user_name":"Li Yao","can_delete":false,"product_type":"c1","uid":1129838,"ip_address":"","ucode":"703E1E5505F70D","user_header":"https://static001.geekbang.org/account/avatar/00/11/3d/6e/60680aa4.jpg","comment_is_top":false,"comment_ctime":1542373191,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"143276293959","product_id":100013101,"comment_content":"å¦‚æœèƒ½ä¸¾ä¸€ä¸ªå®é™…çš„åº”ç”¨åœºæ™¯å°±æ›´å¥½äº†ï¼Œè¿™ç¯‡çœ‹ä¸å¤ªæ‡‚ç”¨é€”","like_count":33,"discussions":[{"author":{"id":1474954,"avatar":"https://static001.geekbang.org/account/avatar/00/16/81/8a/15a96a64.jpg","nickname":"Gatsby","note":"","ucode":"5DBFDA12556BDB","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540511,"discussion_content":"https://www.topgoer.com/%E5%B8%B8%E7%94%A8%E6%A0%87%E5%87%86%E5%BA%93/Context.html å¯ä»¥çœ‹è¿™ä¸ª","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1640073243,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":45226,"user_name":"ä¸é¦™ä¸èŒ‰è‰","can_delete":false,"product_type":"c1","uid":1160240,"ip_address":"","ucode":"D07BD61BF23B34","user_header":"https://static001.geekbang.org/account/avatar/00/11/b4/30/d929bf57.jpg","comment_is_top":false,"comment_ctime":1543562725,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"87442908645","product_id":100013101,"comment_content":"http:&#47;&#47;www.flysnow.org&#47;2017&#47;05&#47;12&#47;go-in-action-go-context.html","like_count":20,"discussions":[{"author":{"id":1000028,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/42/5c/5b4149dc.jpg","nickname":"é£ç¿”123","note":"","ucode":"F66CA8B6BED91F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587454,"discussion_content":"å¯ä»¥ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663064493,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1212313,"avatar":"https://static001.geekbang.org/account/avatar/00/12/7f/99/6a92ff95.jpg","nickname":"Jesson","note":"","ucode":"EBADA87D9E5AE6","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":561079,"discussion_content":"è®²çš„å¾ˆæ¸…æ™°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649547867,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2038856,"avatar":"","nickname":"Geek_b93edf","note":"","ucode":"DD0C362D29C359","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":293204,"discussion_content":"è¿™ä¸ªå¯ä»¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595476929,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":98557,"user_name":"Timo","can_delete":false,"product_type":"c1","uid":1223829,"ip_address":"","ucode":"6A7FEB30B09797","user_header":"https://static001.geekbang.org/account/avatar/00/12/ac/95/9b3e3859.jpg","comment_is_top":false,"comment_ctime":1559027603,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"61688569747","product_id":100013101,"comment_content":"Context ä½¿ç”¨åŸåˆ™<br>ä¸è¦æŠŠContextæ”¾åœ¨ç»“æ„ä½“ä¸­ï¼Œè¦ä»¥å‚æ•°çš„æ–¹å¼ä¼ é€’<br>ä»¥Contextä½œä¸ºå‚æ•°çš„å‡½æ•°æ–¹æ³•ï¼Œåº”è¯¥æŠŠContextä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ”¾åœ¨ç¬¬ä¸€ä½ã€‚<br>ç»™ä¸€ä¸ªå‡½æ•°æ–¹æ³•ä¼ é€’Contextçš„æ—¶å€™ï¼Œä¸è¦ä¼ é€’nilï¼Œå¦‚æœä¸çŸ¥é“ä¼ é€’ä»€ä¹ˆï¼Œå°±ä½¿ç”¨context.TODO<br>Contextçš„Valueç›¸å…³æ–¹æ³•åº”è¯¥ä¼ é€’å¿…é¡»çš„æ•°æ®ï¼Œä¸è¦ä»€ä¹ˆæ•°æ®éƒ½ä½¿ç”¨è¿™ä¸ªä¼ é€’<br>Contextæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥æ”¾å¿ƒçš„åœ¨å¤šä¸ªgoroutineä¸­ä¼ é€’","like_count":14},{"had_liked":false,"id":246283,"user_name":"é¸ æ‘©Â·æ™º","can_delete":false,"product_type":"c1","uid":1211909,"ip_address":"","ucode":"6CD93CD1DB6955","user_header":"https://static001.geekbang.org/account/avatar/00/12/7e/05/431d380f.jpg","comment_is_top":false,"comment_ctime":1599256274,"is_pvip":false,"replies":[{"id":"90521","content":"é¦–å…ˆè¦æ˜ç¡®ï¼š<br>1. coordinateWithContextå‡½æ•°é‡Œçš„forè¯­å¥æ˜¯ä¸ºäº†å¯ç”¨12ä¸ªgoroutineï¼Œä½†æ˜¯è¿™äº›goå‡½æ•°è°å…ˆæ‰§è¡Œè°åæ‰§è¡Œä¸è¿™äº›goroutineçš„å¯ç”¨é¡ºåºè€Œå…³ã€‚<br>2. addNumå‡½æ•°é‡Œçš„deferå‡½æ•°ä¼šåœ¨å®ƒåé¢çš„forè¯­å¥æ‰§è¡Œå®Œæ¯•ä¹‹åæ‰å¼€å§‹æ‰§è¡Œã€‚<br><br>æ‰€ä»¥ï¼Œç¬¬ä¸€ä¸ªé—®é¢˜çš„ç­”æ¡ˆæ˜¯ï¼šä¸ä¼šã€‚å› ä¸ºæ€»ä¼šæœ‰ä¸€ä¸ªaddNumå‡½æ•°æŠŠnumçš„å€¼å˜æˆ12ï¼Œç„¶åæ‰§è¡ŒdeferFuncå‡½æ•°ï¼Œå¹¶ç”±äºnum==12è€Œæ‰§è¡ŒcancelFuncå‡½æ•°ã€‚<br><br>å¦å¤–ï¼Œè¿™äº›goå‡½æ•°åœ¨è°ƒç”¨addNumå‡½æ•°æ—¶ä¼šç¢°åˆ°è‡ªæ—‹çš„æƒ…å†µï¼ˆç¨‹åºä¼šæ‰“å°å‡ºæ¥ï¼‰ï¼Œä½†æ˜¯ç»ä¸ä¼šé€ æˆæ­»é”ï¼Œå› ä¸ºè¿™äº›AddNumå‡½æ•°ä¸­çš„CASæ“ä½œæ—©æ™šä¼šæ‰§è¡ŒæˆåŠŸã€‚åŸå­çš„Load+CASå¤–åŠ forè¯­å¥ï¼Œç›¸å½“äºä¹è§‚é”ï¼Œè€Œä¸”å®ƒä»¬çš„æ“ä½œéƒ½å¾ˆâ€œè§„çŸ©â€ï¼ˆéƒ½åªæ˜¯+1è€Œå·²ï¼‰ã€‚ä½ ä¹Ÿå¯ä»¥ç†è§£ä¸ºæŠŠè¿™12æ¬¡â€œç´¯åŠ â€ä¸²è¡ŒåŒ–äº†ï¼Œåªä¸è¿‡å¤§å®¶æ˜¯å¹¶å‘çš„ï¼Œéƒ½åœ¨å¯»æ‰¾è‡ªå·±â€œç´¯åŠ â€æˆåŠŸçš„æœºä¼šã€‚<br><br>ç¬¬äºŒä¸ªé—®é¢˜ï¼šå½“å‰contextä¼šé©¬ä¸Šæ„ŸçŸ¥åˆ°ï¼Œä½†å‰ææ˜¯å®ƒæ˜¯å¯æ’¤é”€çš„ã€‚é€šè¿‡WithValueå‡½æ•°æ„é€ å‡ºæ¥çš„contextåªä¼šä¼ é€’ä¸ä¼šæ„ŸçŸ¥ï¼ˆé€šè¿‡åŒ¿åå­—æ®µå®ç°çš„ï¼‰ã€‚<br><br>ç¬¬ä¸‰ä¸ªé—®é¢˜ï¼šä½ å·²ç»æŠŠç­”æ¡ˆè¯´å‡ºæ¥äº†ï¼Œæˆ‘å°±ä¸å¤è¿°äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1599273513,"ip_address":"","comment_id":246283,"utype":1}],"discussion_count":4,"race_medal":5,"score":"31664027346","product_id":100013101,"comment_content":"@éƒè€å¸ˆ æœ‰å‡ ç‚¹ç–‘é—®çƒ¦åŠ³å›ç­”ä¸‹ï¼Œè°¢è°¢ï¼<br>1ã€åœ¨coordinateWithContextçš„ä¾‹å­ä¸­ï¼Œæ€»å…±æœ‰12ä¸ªå­goroutineè¢«åˆ›å»ºï¼Œç¬¬12ä¸ªå³æœ€åä¸€ä¸ªå­goroutineåœ¨è¿è¡Œç»“æŸæ—¶ï¼Œä¼šé€šè¿‡è®¡ç®—deferè¡¨è¾¾å¼ä»è€Œè§¦å‘cancelFuncçš„è°ƒç”¨ï¼Œä»è€Œé€šçŸ¥ä¸»goroutineç»“æŸåœ¨ctx.Doneä¸Šè·å–é€šé“çš„æ¥æ”¶ç­‰å¾…ã€‚æˆ‘çš„é—®é¢˜æ˜¯ï¼Œåœ¨ç¬¬12ä¸ªå­goroutineè®¡ç®—deferè¡¨è¾¾å¼çš„æ—¶å€™ï¼Œä¼šä¸ä¼šå­˜åœ¨ifæ¡ä»¶ä¸æ»¡è¶³ï¼Œæœªæ‰§è¡Œåˆ°cancelFuncçš„æƒ…å†µï¼Ÿæˆ–è€…è¯´ï¼Œåœ¨æ­¤æ—¶ï¼Œç¬¬1åˆ°ç¬¬11çš„å­goroutineä¸­ï¼Œä¼šå­˜åœ¨è‡ªæ—‹casæœªæ‰§è¡Œå®Œçš„æƒ…å†µå—ï¼Ÿå¦‚æœè¿™ç§æƒ…å†µæœ‰ï¼Œæ˜¯å¦ä¼šå¯¼è‡´ä¸»goroutineæ°¸è¿œé˜»å¡çš„æƒ…å†µï¼Ÿ<br>2ã€åœ¨æ’¤é”€å‡½æ•°è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œåœ¨å½“å‰contextä¸Šï¼Œé€šè¿‡contex.Doneè·å–çš„é€šé“ä¼šé©¬ä¸Šæ„ŸçŸ¥åˆ°å—ï¼Ÿè¿˜æ˜¯ä¼šåŒæ­¥ç­‰å¾…ï¼Œä½¿æ’¤é”€ä¿¡å·åœ¨å½“å‰contextçš„æ‰€æœ‰subtreeä¸Šçš„æ‰€æœ‰contextä¼ æ’­å®Œæˆåï¼Œå†æ„ŸçŸ¥åˆ°ï¼Ÿè¿˜æ˜¯æœ‰å…¶ä»–æƒ…å†µï¼Ÿ<br>3ã€WithDeadlineå’ŒWithTimeoutçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿå…·ä½“è¯´ï¼Œdeadlineæ˜¯é’ˆå¯¹æŸä¸ªå…·ä½“æ—¶é—´ï¼Œè€Œtimeoutæ˜¯é’ˆå¯¹å½“å‰æ—¶é—´çš„å»¶æ—¶æ¥å®šä¹‰è‡ªåŠ¨æ’¤é”€æ—¶é—´å—ï¼Ÿ<br>æ„Ÿè°¢å›å¤ï¼","like_count":7,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":505100,"discussion_content":"é¦–å…ˆè¦æ˜ç¡®ï¼š\n1. coordinateWithContextå‡½æ•°é‡Œçš„forè¯­å¥æ˜¯ä¸ºäº†å¯ç”¨12ä¸ªgoroutineï¼Œä½†æ˜¯è¿™äº›goå‡½æ•°è°å…ˆæ‰§è¡Œè°åæ‰§è¡Œä¸è¿™äº›goroutineçš„å¯ç”¨é¡ºåºè€Œå…³ã€‚\n2. addNumå‡½æ•°é‡Œçš„deferå‡½æ•°ä¼šåœ¨å®ƒåé¢çš„forè¯­å¥æ‰§è¡Œå®Œæ¯•ä¹‹åæ‰å¼€å§‹æ‰§è¡Œã€‚\n\næ‰€ä»¥ï¼Œç¬¬ä¸€ä¸ªé—®é¢˜çš„ç­”æ¡ˆæ˜¯ï¼šä¸ä¼šã€‚å› ä¸ºæ€»ä¼šæœ‰ä¸€ä¸ªaddNumå‡½æ•°æŠŠnumçš„å€¼å˜æˆ12ï¼Œç„¶åæ‰§è¡ŒdeferFuncå‡½æ•°ï¼Œå¹¶ç”±äºnum==12è€Œæ‰§è¡ŒcancelFuncå‡½æ•°ã€‚\n\nå¦å¤–ï¼Œè¿™äº›goå‡½æ•°åœ¨è°ƒç”¨addNumå‡½æ•°æ—¶ä¼šç¢°åˆ°è‡ªæ—‹çš„æƒ…å†µï¼ˆç¨‹åºä¼šæ‰“å°å‡ºæ¥ï¼‰ï¼Œä½†æ˜¯ç»ä¸ä¼šé€ æˆæ­»é”ï¼Œå› ä¸ºè¿™äº›AddNumå‡½æ•°ä¸­çš„CASæ“ä½œæ—©æ™šä¼šæ‰§è¡ŒæˆåŠŸã€‚åŸå­çš„Load+CASå¤–åŠ forè¯­å¥ï¼Œç›¸å½“äºä¹è§‚é”ï¼Œè€Œä¸”å®ƒä»¬çš„æ“ä½œéƒ½å¾ˆâ€œè§„çŸ©â€ï¼ˆéƒ½åªæ˜¯+1è€Œå·²ï¼‰ã€‚ä½ ä¹Ÿå¯ä»¥ç†è§£ä¸ºæŠŠè¿™12æ¬¡â€œç´¯åŠ â€ä¸²è¡ŒåŒ–äº†ï¼Œåªä¸è¿‡å¤§å®¶æ˜¯å¹¶å‘çš„ï¼Œéƒ½åœ¨å¯»æ‰¾è‡ªå·±â€œç´¯åŠ â€æˆåŠŸçš„æœºä¼šã€‚\n\nç¬¬äºŒä¸ªé—®é¢˜ï¼šå½“å‰contextä¼šé©¬ä¸Šæ„ŸçŸ¥åˆ°ï¼Œä½†å‰ææ˜¯å®ƒæ˜¯å¯æ’¤é”€çš„ã€‚é€šè¿‡WithValueå‡½æ•°æ„é€ å‡ºæ¥çš„contextåªä¼šä¼ é€’ä¸ä¼šæ„ŸçŸ¥ï¼ˆé€šè¿‡åŒ¿åå­—æ®µå®ç°çš„ï¼‰ã€‚\n\nç¬¬ä¸‰ä¸ªé—®é¢˜ï¼šä½ å·²ç»æŠŠç­”æ¡ˆè¯´å‡ºæ¥äº†ï¼Œæˆ‘å°±ä¸å¤è¿°äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599273513,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1987829,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJoOia8n2xdlIBYWVBmevjIuaMickvceJ2JX4IHOaibrmEWmia1gM29jhjLCJcYU9lSXLInNlToAbc5Gg/132","nickname":"å¼ ä¼Ÿ","note":"","ucode":"3A45B9536F91E9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":369460,"discussion_content":"ç¬¬äºŒä¸ªé—®é¢˜ï¼Œæˆ‘ä¹Ÿè¿·æƒ‘ï¼Œçœ‹æºç ï¼Œç¡®å®æ˜¯ç›´æ¥å½±å“ä¸»å‡½æ•°ï¼Œå–æ¶ˆåï¼Œctx.Doneå°±ç»“æŸäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1619051390,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1103450,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d6/5a/bd2378eb.jpg","nickname":"åˆ˜ä¹‰å®","note":"","ucode":"CF402E390B2442","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":346056,"discussion_content":"è€å¸ˆè¯´çš„å¾ˆæ¸…æ™°ï¼Œèµï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611846544,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1211909,"avatar":"https://static001.geekbang.org/account/avatar/00/12/7e/05/431d380f.jpg","nickname":"é¸ æ‘©Â·æ™º","note":"","ucode":"6CD93CD1DB6955","race_medal":5,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":303515,"discussion_content":"è°¢è°¢ @éƒè€å¸ˆ ä»”ç»†è®¤çœŸè€å¿ƒåœ°å›å¤ã€‚æˆ‘ä»”ç»†ç ”è¯»äº†ä½ çš„å›å¤å†…å®¹ï¼Œå’Œå›æƒ³äº†ä»¥å‰è¯¾ç¨‹çš„ç« èŠ‚å†…å®¹ï¼Œé—®é¢˜ä¸€æˆ‘å½»åº•ç†è§£äº†ï¼Œé€»è¾‘æ˜¯æ²¡æœ‰é—®é¢˜çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599289686,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86914,"user_name":"éƒæ—","can_delete":false,"product_type":"c1","uid":1026643,"ip_address":"","ucode":"F66BA62BA56FFA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","comment_is_top":false,"comment_ctime":1555476256,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"31620247328","product_id":100013101,"comment_content":"æˆ‘çœ‹ä¸å°‘è¯»è€…éƒ½è¯´å†™ä¸€ç¯‡éš¾ç†è§£ã€‚å¯èƒ½çš„ç¡®å¦‚æ­¤ï¼Œå› ä¸ºæˆ‘å‡è®¾ä½ ä»¬å·²å¯¹contextåŒ…æœ‰åŸºæœ¬çš„äº†è§£ã€‚<br><br>ä¸è¿‡æ²¡å…³ç³»ï¼Œä½ ä»¬æœ‰æ­¤æ–¹é¢çš„ä»»ä½•é—®é¢˜éƒ½å¯ä»¥é€šè¿‡ä»¥ä¸‹ä¸‰ä¸ªé€”å¾„ä¸æˆ‘è®¨è®ºï¼š<br><br>1. ç›´æ¥åœ¨ä¸“æ æ–‡ç« ä¸‹ç•™è¨€ï¼›<br>2. åœ¨ GoHackers å¾®ä¿¡ç¾¤æˆ–è€… BearyChat ä¸­çš„ GoHackers å›¢é˜Ÿç©ºé—´é‡Œè‰¾ç‰¹æˆ‘ï¼›<br>3. åœ¨çŸ¥è¯†æ˜Ÿçƒä¸­çš„ GoHackers VIP ç¤¾ç¾¤é‡Œå‘æˆ‘æé—®ã€‚","like_count":7,"discussions":[{"author":{"id":1329995,"avatar":"https://static001.geekbang.org/account/avatar/00/14/4b/4b/97926cba.jpg","nickname":"Lucianoæé‘«","note":"","ucode":"5FBE5F86FD5B2C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":328346,"discussion_content":"ä¸ºä»€ä¹ˆä¸æ˜¯åœ¨è¿™é‡Œè®²æ¸…æ¥šï¼Ÿè¿™è€å¸ˆæ€ªæ€ªçš„","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1606125143,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1445504,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/gVfU7icdia3o5ZNaHjaWAdgkSYIpU1rdhIlVYiahYCvRlDZu2K6oPSvVobNjzwZbUaiayQcKjicZ44WjfWJCj5xdlPA/132","nickname":"çº¢å°˜","note":"","ucode":"CCCD5736755DF5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":33406,"discussion_content":"è€å¸ˆå°±æ˜¯å¾®ä¿¡ç¾¤å¿…é¡»æœ‰äººæ‹‰æˆ‘å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571121187,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1495497,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKmB1DWZP1l7QsgU8eXpyuicS6oWbuia3NUI6R77Sib9HHgOoDeX9lYcR9csU4BNZXg1dK9wjLq0Ehcg/132","nickname":"æ­¦å­","note":"","ucode":"2F865ED507742E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3923,"discussion_content":"è€å¸ˆä½ å¥½ï¼Œgohackerså¾®ä¿¡ç¾¤æ€ä¹ˆåŠ å…¥ æˆ‘å¾®ä¿¡æœäº†å…¬ä¼—å· è¯´ä¸»è¦å·²å…¥ç¾¤çš„æœ‹å‹æ‹‰æˆ‘ èƒ½å¸®å¿™æ‹‰æˆ‘è¿›å»å— è°¢è°¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564983393,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1395689,"avatar":"https://static001.geekbang.org/account/avatar/00/15/4b/e9/bbccf643.jpg","nickname":"sanmao","note":"","ucode":"D695D88677E3D9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1495497,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKmB1DWZP1l7QsgU8eXpyuicS6oWbuia3NUI6R77Sib9HHgOoDeX9lYcR9csU4BNZXg1dK9wjLq0Ehcg/132","nickname":"æ­¦å­","note":"","ucode":"2F865ED507742E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":353340,"discussion_content":"æœ‰äººæ‹‰ä½ äº†å—?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1615136622,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":3923,"ip_address":""},"score":353340,"extra":""}]}]},{"had_liked":false,"id":39442,"user_name":"æ†¶æµ·æ‹¾è²","can_delete":false,"product_type":"c1","uid":1054727,"ip_address":"","ucode":"99E883A8601DED","user_header":"https://static001.geekbang.org/account/avatar/00/10/18/07/9f5f5dd3.jpg","comment_is_top":false,"comment_ctime":1542276735,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"31607047807","product_id":100013101,"comment_content":"æœåŠ¡é—´è°ƒç”¨é€šå¸¸è¦ä¼ é€’ä¸Šä¸‹æ–‡æ•°æ®ï¼Œç”¨å¸¦å€¼Contextåœ¨æ¯ä¸ªå‡½æ•°é—´ä¼ é€’æ˜¯ä¸€ç§æ–¹å¼ï¼Œä½†ä»Pythonè¿‡æ¥çš„æˆ‘è§‰å¾—è¿™å¯¹ä»£ç ä¾µå…¥æ€§è›®å¤§çš„ã€‚è¯·é—®goä¸­è¿˜æœ‰ä»€ä¹ˆæ›´å¥½çš„åŠæ³•ä¼ é€’ä¸Šä¸‹æ–‡æ•°æ®å‘¢ï¼Ÿ","like_count":7},{"had_liked":false,"id":35089,"user_name":"Shawn","can_delete":false,"product_type":"c1","uid":1198804,"ip_address":"","ucode":"8CCF006786999B","user_header":"https://static001.geekbang.org/account/avatar/00/12/4a/d4/a3231668.jpg","comment_is_top":false,"comment_ctime":1540404825,"is_pvip":false,"replies":[{"id":"13315","content":"æ‰“å°å‡ºæ¥çš„é¡ºåºä¸å®šæ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºgoroutineä¼šè¢«å®æ—¶è°ƒåº¦å•Šï¼Œæ‰“å°å‡ºæ¥çš„é¡ºåºä¸ä¸€å®šå°±æ˜¯çœŸå®é¡ºåºã€‚æ¯å¡«è¯­å¥æ‰§è¡Œå®Œéƒ½å¯èƒ½è¢«è°ƒåº¦ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1541482317,"ip_address":"","comment_id":35089,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27310208601","product_id":100013101,"comment_content":"çœ‹ä»£ç æ˜¯æ·±åº¦ä¼˜å…ˆï¼Œä½†æ˜¯æˆ‘è‡ªå·±å†™äº†demoï¼Œé¡ºåºæ˜¯ä¹±çš„ï¼Œæ±‚è€å¸ˆè®²è§£","like_count":6,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427442,"discussion_content":"æ‰“å°å‡ºæ¥çš„é¡ºåºä¸å®šæ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºgoroutineä¼šè¢«å®æ—¶è°ƒåº¦å•Šï¼Œæ‰“å°å‡ºæ¥çš„é¡ºåºä¸ä¸€å®šå°±æ˜¯çœŸå®é¡ºåºã€‚æ¯å¡«è¯­å¥æ‰§è¡Œå®Œéƒ½å¯èƒ½è¢«è°ƒåº¦ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541482317,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":149336,"user_name":"Geek_f39659","can_delete":false,"product_type":"c1","uid":1636568,"ip_address":"","ucode":"2206A8C590423C","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM6iagw7ct4ca3niaSEFNicu2wy2KuCibO6eiaRzoRGJb50WTrbkKQib9mTArnTr8jJUazO9O2ibLZNfjjl35cfCHkBPs7N/132","comment_is_top":false,"comment_ctime":1573196278,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23048032758","product_id":100013101,"comment_content":"æ ¹æ®è¿™å¥è¯ï¼šâ€œA great mental model of using Context is that it should flow through your program. Imagine a river or running water. This generally means that you donâ€™t want to store it somewhere like in a struct. Nor do you want to keep it around any more than strictly needed. Context should be an interface that is passed from function to function down your call stack, augmented as needed.â€<br><br>æ„Ÿè§‰ä¸ŠContextè®¾è®¡ä¸Šæ›´åƒæ˜¯ä¸€ä¸ªè¿è¡Œæ—¶çš„åŠ¨æ€æ¦‚å¿µï¼Œå®ƒæ›´åƒæ˜¯ä»£è¡¨ä¼ ç»Ÿcall stack å±‚å±‚é•¶å¥—å¤–åŠ åˆ†å‰å…³ç³»çš„é‚£é¢—æ ‘ã€‚ä»£è¡¨ç€è¿è¡Œæ—¶æ€çš„è°ƒç”¨æ ‘ã€‚æ‰€ä»¥å®ƒæœ€å¥½å°±æ˜¯åªå­˜åœ¨äºå‡½æ•°ä½“çš„é—­åŒ…ä¹‹ä¸­ï¼Œå¤§å®¶å£å£ç›¸ä¼ ï¼Œâ€œä¼ ç”·ä¸ä¼ å¥³â€ã€‚â€œå› ä¸ºæˆ‘è°ƒç”¨ä½ ï¼Œæ‰€ä»¥æˆ‘æ‰æŠŠè¿™ä¸ªä¼ ç»™ä½ ï¼Œä½ å¯ä»¥ä¼ ç»™ä½ çš„å­å­™ï¼Œä½†ä¸è¦å‘Šè¯‰åˆ«äººï¼â€ã€‚æ‰€ä»¥æœ€å¥½ä¸è¦æŠŠå®ƒä¿å­˜èµ·æ¥è®©æ—äººæœ‰æœºä¼šçœ‹å¾—åˆ°æˆ–ç”¨åˆ°ã€‚<br><br>æ¥¼ä¸Šæœ‰äººæåˆ°è¿™ç§é£æ ¼çš„å…¥ä¾µæ€§ï¼Œæˆ‘èƒ½ç†è§£ä½ çš„æ„Ÿè§‰ã€‚ä½†ä»¥æˆ‘ä»¥å‰ç©Node.jsä¸­çš„cls (continuation local storage)è¸©è¿‡çš„é‚£äº›å‘æ¥çœ‹ï¼Œæˆ‘å®æ„¿ä¸¤å®³ç›¸æƒå–å…¶è½»ã€‚è¿™ç§å…¥ä¾µæ€§è‡³å°‘æ˜¯å¯æ§çš„ï¼Œæ˜¾å¼çš„ã€‚åŒæ­¥ç¼–ç¨‹çš„ä¸–ç•Œæˆ‘ä»¬åªéœ€è¦TLS(Thread local storage)å°±å¥½äº†ï¼Œä½†å¯¹åº”çš„å¼‚æ­¥ç¼–ç¨‹çš„ä¸–ç•Œé‡Œç©clså¾ˆéš¾æçš„ã€‚åœ¨æˆ‘æ¥çœ‹ï¼ŒContextæ˜¾ç„¶æ˜¯è¸©è¿‡é‚£äº›å‘çš„è€é¸Ÿæå‡ºæ¥çš„ã€‚","like_count":5},{"had_liked":false,"id":333915,"user_name":"mclee","can_delete":false,"product_type":"c1","uid":1382972,"ip_address":"","ucode":"294D4A0BFAF0FD","user_header":"https://static001.geekbang.org/account/avatar/00/15/1a/3c/60b12211.jpg","comment_is_top":false,"comment_ctime":1644581419,"is_pvip":false,"replies":[{"id":"121984","content":"æˆ‘è¯´çš„è·³è¿‡æ˜¯æºç çº§åˆ«çš„è·³è¿‡ï¼Œæ˜¯è·³è¿‡valueèŠ‚ç‚¹ç›´æ¥ä¼ åˆ°å®ƒä¸‹çº§çš„èŠ‚ç‚¹ï¼Œå› ä¸ºvalueèŠ‚ç‚¹æœ¬èº«æ˜¯æ²¡æœ‰timeoutæœºåˆ¶ï¼Œæ— éœ€è®©cancelä¿¡å·åœ¨é‚£é‡Œå‘æŒ¥ä»€ä¹ˆä½œç”¨ã€‚<br><br>åœ¨valueèŠ‚ç‚¹ä¸Šçš„Done()åœ¨æºç çº§åˆ«å®é™…ä¸Šè°ƒç”¨çš„å¹¶ä¸æ˜¯valueèŠ‚ç‚¹è‡ªå·±çš„æ–¹æ³•ï¼Œè€Œæ˜¯å®ƒä¸Šçº§èŠ‚ç‚¹ï¼ˆç”šè‡³ä¸Šä¸Šçº§ï¼‰çš„æ–¹æ³•ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":"1026643","ctime":1644639276,"ip_address":"","comment_id":333915,"utype":1}],"discussion_count":4,"race_medal":0,"score":"18824450603","product_id":100013101,"comment_content":"<br>å®æµ‹äº†ä¸‹ï¼Œcontext.WithValue å¾—åˆ°çš„æ–°çš„ ctx å½“å…¶ parent context cancle æ—¶ä¹Ÿèƒ½æ”¶åˆ° done ä¿¡å·å•Šï¼Œå¹¶ä¸æ˜¯æ–‡ä¸­è¯´çš„é‚£æ ·ä¼šè·³è¿‡ï¼<br><br>package main<br><br>import (<br>\t&quot;context&quot;<br>\t&quot;fmt&quot;<br>\t&quot;time&quot;<br>)<br><br>func main() {<br>\tctx1, cancelFun := context.WithCancel(context.Background())<br>\tctx2 := context.WithValue(ctx1, &quot;&quot;, &quot;&quot;)<br>\tctx3, _ := context.WithCancel(ctx1)<br><br>\tgo watch(ctx1, &quot;ctx1&quot;)<br>\tgo watch(ctx2, &quot;ctx2&quot;)<br>\tgo watch(ctx3, &quot;ctx3&quot;)<br><br>\ttime.Sleep(2 * time.Second)<br>\tfmt.Println(&quot;å¯ä»¥äº†ï¼Œé€šçŸ¥ç›‘æ§åœæ­¢&quot;)<br>\tcancelFun()<br><br>\t&#47;&#47;ä¸ºäº†æ£€æµ‹ç›‘æ§è¿‡æ˜¯å¦åœæ­¢ï¼Œå¦‚æœæ²¡æœ‰ç›‘æ§è¾“å‡ºï¼Œå°±è¡¨ç¤ºåœæ­¢äº†<br>\ttime.Sleep(5 * time.Second)<br><br>}<br><br>func watch(ctx context.Context, name string) {<br>\tfor {<br>\t\tselect {<br>\t\tcase &lt;-ctx.Done():<br>\t\t\tfmt.Println(name,&quot;ç›‘æ§é€€å‡ºï¼Œåœæ­¢äº†...&quot;)<br>\t\t\treturn<br>\t\tdefault:<br>\t\t\tfmt.Println(name,&quot;goroutineç›‘æ§ä¸­...&quot;)<br>\t\t\ttime.Sleep(2 * time.Second)<br>\t\t}<br>\t}<br>}<br>","like_count":4,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":550617,"discussion_content":"æˆ‘è¯´çš„è·³è¿‡æ˜¯æºç çº§åˆ«çš„è·³è¿‡ï¼Œæ˜¯è·³è¿‡valueèŠ‚ç‚¹ç›´æ¥ä¼ åˆ°å®ƒä¸‹çº§çš„èŠ‚ç‚¹ï¼Œå› ä¸ºvalueèŠ‚ç‚¹æœ¬èº«æ˜¯æ²¡æœ‰timeoutæœºåˆ¶ï¼Œæ— éœ€è®©cancelä¿¡å·åœ¨é‚£é‡Œå‘æŒ¥ä»€ä¹ˆä½œç”¨ã€‚\n\nåœ¨valueèŠ‚ç‚¹ä¸Šçš„Done()åœ¨æºç çº§åˆ«å®é™…ä¸Šè°ƒç”¨çš„å¹¶ä¸æ˜¯valueèŠ‚ç‚¹è‡ªå·±çš„æ–¹æ³•ï¼Œè€Œæ˜¯å®ƒä¸Šçº§èŠ‚ç‚¹ï¼ˆç”šè‡³ä¸Šä¸Šçº§ï¼‰çš„æ–¹æ³•ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644639276,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1134895,"avatar":"https://static001.geekbang.org/account/avatar/00/11/51/2f/7b04140c.jpg","nickname":"å­«ã‚„ã•ã‚“","note":"","ucode":"C60877C1C71685","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584042,"discussion_content":"æˆ‘ä¹Ÿç†è§£æˆwithValueä¸ä¼šè¢«å–æ¶ˆäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660572022,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1002201,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/4a/d9/75dd7cf9.jpg","nickname":"Mew151","note":"","ucode":"D4793F5874F345","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1134895,"avatar":"https://static001.geekbang.org/account/avatar/00/11/51/2f/7b04140c.jpg","nickname":"å­«ã‚„ã•ã‚“","note":"","ucode":"C60877C1C71685","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":585407,"discussion_content":"+1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661511728,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":584042,"ip_address":"åŒ—äº¬"},"score":585407,"extra":""}]},{"author":{"id":1217554,"avatar":"https://static001.geekbang.org/account/avatar/00/12/94/12/15558f28.jpg","nickname":"Jason","note":"","ucode":"C5A540BC5A60B9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580391,"discussion_content":"WithValueç”Ÿæˆçš„ctxæ²¡æœ‰è‡ªå·±çš„Doneå‡½æ•°ï¼Œå®ƒåº”è¯¥æ˜¯&#34;ç»§æ‰¿&#34;è‡ªçˆ¶è¾ˆçš„ã€‚è¿˜æœ‰ä¸€ç‚¹æ˜¯åªæœ‰WitchCancelå’ŒwitchDealine/timeoutäº§ç”Ÿçš„ctxï¼Œæ‰ä¼šæ”¾åœ¨çˆ¶è¾ˆçš„childé‡Œï¼Œä»è€Œåœ¨cancelæ—¶å»é€šçŸ¥child","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658138513,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":255554,"user_name":"Direction","can_delete":false,"product_type":"c1","uid":1731977,"ip_address":"","ucode":"298D5109EA28EE","user_header":"https://static001.geekbang.org/account/avatar/00/1a/6d/89/14031273.jpg","comment_is_top":false,"comment_ctime":1603371794,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18783240978","product_id":100013101,"comment_content":"åœ¨ Go æœåŠ¡ä¸­ï¼Œæ¯ä¸ªä¼ å…¥çš„è¯·æ±‚éƒ½åœ¨å®ƒè‡ªå·±çš„ goroutine ä¸­å¤„ç†ã€‚è¯·æ±‚å¤„ç†ç¨‹åºé€šå¸¸å¯åŠ¨é¢å¤–çš„ goroutine æ¥è®¿é—®åç«¯ï¼Œå¦‚æ•°æ®åº“å’Œ RPC æœåŠ¡ã€‚<br>  å¤„ç†è¯·æ±‚çš„ goroutine é›†é€šå¸¸éœ€è¦è®¿é—®ç‰¹å®šäºè¯·æ±‚çš„å€¼ï¼Œä¾‹å¦‚æœ€ç»ˆç”¨æˆ·çš„èº«ä»½ã€æˆæƒä»¤ç‰Œå’Œè¯·æ±‚çš„æˆªæ­¢æ—¥æœŸã€‚å½“ä¸€ä¸ªè¯·æ±‚è¢«å–æ¶ˆæˆ–è¶…æ—¶æ—¶ï¼ˆcancelFunc() or WithTimeout()ï¼‰ï¼Œå¤„ç†è¯¥è¯·æ±‚çš„æ‰€<br>  æœ‰ goroutines åº”è¯¥å¿«é€Ÿé€€å‡º(ctx.Doneï¼ˆï¼‰)ï¼Œä»¥ä¾¿ç³»ç»Ÿå¯ä»¥å›æ”¶ï¼ˆreclaimï¼‰å®ƒä»¬æ­£åœ¨ä½¿ç”¨çš„ä»»ä½•èµ„æºã€‚<br><br>æ„Ÿè§‰è¿™ä¸ªä¸¾ä¾‹æŒºå¥½çš„ï¼ˆå‚è€ƒè‡³ï¼šhttps:&#47;&#47;blog.golang.org&#47;contextï¼‰","like_count":4},{"had_liked":false,"id":117243,"user_name":"èŒ´é¦™æ ¹","can_delete":false,"product_type":"c1","uid":1316111,"ip_address":"","ucode":"B91C00B72077F1","user_header":"https://static001.geekbang.org/account/avatar/00/14/15/0f/954be2db.jpg","comment_is_top":false,"comment_ctime":1564014773,"is_pvip":false,"replies":[{"id":"42959","content":"æ˜¯çš„ï¼Œè¿™æ¶‰åŠåˆ°ä¸¤ä¸ªæ–¹é¢ï¼Œéœ€è¦ç»¼åˆèµ·æ¥çœ‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1564020838,"ip_address":"","comment_id":117243,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18743883957","product_id":100013101,"comment_content":"ç•™è¨€åŒºå¾ˆå¤šäººè¯´Context æ˜¯æ·±åº¦ä¼˜å…ˆï¼Œä½†æ˜¯æˆ‘åœ¨æƒ³æ¯ä¸ªgoroutine è¢«è°ƒç”¨çš„é¡ºåºéƒ½æ˜¯ä¸ç¡®å®šçš„ï¼Œå› æ­¤åœ¨ç¼–å†™goroutine ä»£ç æ—¶ï¼Œå®é™…çš„æ’¤é”€å“åº”ä¸èƒ½å‡å®šå…¶çˆ¶æˆ–å­context æ‰€åœ¨çš„goroutineä¸€å®šå…ˆæˆ–è€…åç»“æŸã€‚","like_count":4,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459877,"discussion_content":"æ˜¯çš„ï¼Œè¿™æ¶‰åŠåˆ°ä¸¤ä¸ªæ–¹é¢ï¼Œéœ€è¦ç»¼åˆèµ·æ¥çœ‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564020838,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":84001,"user_name":"Cutler","can_delete":false,"product_type":"c1","uid":1228136,"ip_address":"","ucode":"2EDECFE039845B","user_header":"https://static001.geekbang.org/account/avatar/00/12/bd/68/3fd6428d.jpg","comment_is_top":false,"comment_ctime":1554768393,"is_pvip":false,"replies":[{"id":"30331","content":"å¾ˆæ˜æ˜¾ï¼Œcontext.Background()è¿”å›çš„æ˜¯å…¨å±€çš„ä¸Šä¸‹æ–‡æ ¹ï¼ˆæˆ‘åœ¨æ–‡ç« ä¸­å¤šæ¬¡æåˆ°ï¼‰ï¼Œcontext.TODO()è¿”å›çš„æ˜¯ç©ºçš„ä¸Šä¸‹æ–‡ï¼ˆè¡¨æ˜åº”ç”¨çš„ä¸ç¡®å®šæ€§ï¼‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1554781647,"ip_address":"","comment_id":84001,"utype":1}],"discussion_count":3,"race_medal":0,"score":"18734637577","product_id":100013101,"comment_content":"cotext.backround()å’Œcotext.todo()æœ‰ä»€ä¹ˆåŒºåˆ«","like_count":4,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":446211,"discussion_content":"å¾ˆæ˜æ˜¾ï¼Œcontext.Background()è¿”å›çš„æ˜¯å…¨å±€çš„ä¸Šä¸‹æ–‡æ ¹ï¼ˆæˆ‘åœ¨æ–‡ç« ä¸­å¤šæ¬¡æåˆ°ï¼‰ï¼Œcontext.TODO()è¿”å›çš„æ˜¯ç©ºçš„ä¸Šä¸‹æ–‡ï¼ˆè¡¨æ˜åº”ç”¨çš„ä¸ç¡®å®šæ€§ï¼‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1554781647,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1650748,"avatar":"https://static001.geekbang.org/account/avatar/00/19/30/3c/0668d6ae.jpg","nickname":"ç›˜èƒ§","note":"","ucode":"5386CC4C92ECC2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":548574,"discussion_content":"context.Background æ˜¯ä¸Šä¸‹æ–‡çš„é»˜è®¤å€¼ï¼Œæ‰€æœ‰å…¶ä»–çš„ä¸Šä¸‹æ–‡éƒ½åº”è¯¥ä»å®ƒè¡ç”Ÿå‡ºæ¥ï¼›\ncontext.TODO åº”è¯¥ä»…åœ¨ä¸ç¡®å®šåº”è¯¥ä½¿ç”¨å“ªç§ä¸Šä¸‹æ–‡æ—¶ä½¿ç”¨ï¼›","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1643268036,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1008348,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/dc/8876c73b.jpg","nickname":"moooofly","note":"","ucode":"4A20795C281B6F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":23408,"discussion_content":"context.TODO() çš„ä¸»è¦åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆå‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569813915,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":35169,"user_name":"å±é›¨","can_delete":false,"product_type":"c1","uid":1202624,"ip_address":"","ucode":"700236847A5C94","user_header":"https://static001.geekbang.org/account/avatar/00/12/59/c0/6f02c096.jpg","comment_is_top":false,"comment_ctime":1540443423,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14425345311","product_id":100013101,"comment_content":"æ·±åº¦ä¼˜å…ˆï¼Œçœ‹func (c *cancelCtx) cancel(removeFromParent bool, err error)æ–¹æ³•çš„æºä»£ç ã€‚","like_count":3},{"had_liked":false,"id":38258,"user_name":"HOPE","can_delete":false,"product_type":"c1","uid":1017740,"ip_address":"","ucode":"3A7E10C245BACD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/87/8c/468aa27b.jpg","comment_is_top":false,"comment_ctime":1542005863,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"10131940455","product_id":100013101,"comment_content":"è€å¸ˆï¼Œè¯·æ•™ä¸ªé—®é¢˜ã€‚æˆ‘è¿è¡Œäº†å¤šä¸ªgoroutineï¼Œæ¯ä¸ªgoroutineæœ‰ä¸åŒçš„é…ç½®ã€‚æˆ‘ç°åœ¨æƒ³ä¿®æ”¹è¿è¡Œæ—¶çš„goroutineçš„é…ç½®ï¼Œä½¿ç”¨contextå¯ä»¥å®ç°å—ï¼Ÿæˆ–è€…å¯ä»¥ç”¨ä»€ä¹ˆåŠæ³•å®ç°ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1019568,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8e/b0/ef201991.jpg","nickname":"CcczzZ","note":"","ucode":"5F46DA5053D2BB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":145864,"discussion_content":"etcdï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579585356,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":34899,"user_name":"ç½—å¿—æ´ª","can_delete":false,"product_type":"c1","uid":1205524,"ip_address":"","ucode":"F8A6E6958F0744","user_header":"https://static001.geekbang.org/account/avatar/00/12/65/14/2e4edf4e.jpg","comment_is_top":false,"comment_ctime":1540349049,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10130283641","product_id":100013101,"comment_content":"contextæ ‘æœ‰ç‚¹éš¾ç†è§£ã€‚","like_count":2},{"had_liked":false,"id":291365,"user_name":"hunterlodge","can_delete":false,"product_type":"c1","uid":1069755,"ip_address":"","ucode":"5B83A79E784161","user_header":"https://static001.geekbang.org/account/avatar/00/10/52/bb/225e70a6.jpg","comment_is_top":false,"comment_ctime":1620229523,"is_pvip":false,"replies":[{"id":"105569","content":"ä½ å¼•ç”¨çš„è¿™æ®µè¯å…¶å®æœ‰ä¸¤å±‚å«ä¹‰ï¼š<br><br>1. æŸä¸ªå€¼çš„æŒ‡é’ˆå€¼çš„ä¼ é€’å¹¶ä¸ä¼šå¯¼è‡´æºå€¼ï¼ˆå³æŒ‡é’ˆæŒ‡å‘çš„é‚£ä¸ªå€¼ï¼‰çš„æ‹·è´ã€‚<br>2. æ¥å£å€¼é‡Œé¢å…¶å®ä¼šå­˜å‚¨å®é™…å€¼çš„æŒ‡é’ˆå€¼ï¼Œè€Œä¸æ˜¯å®é™…å€¼ã€‚æ‰€ä»¥åœ¨æ‹·è´ä¹‹åï¼Œå…¶ä¸­çš„å®é™…å€¼ä¾ç„¶æ˜¯æºå€¼ã€‚<br><br>ä½ çœ‹è¿‡syncåŒ…çš„æ–‡æ¡£å—ï¼Ÿé‡Œé¢çš„åŒæ­¥å·¥å…·å¤§éƒ½ä¸å…è®¸â€œä½¿ç”¨ä¹‹åçš„å†ä¼ é€’â€ã€‚<br><br>å…¶å®è¿™ç§çº¦æŸçš„åŸå› å°±æ˜¯ï¼Œä¼ é€’å€¼ä¼šå¯¼è‡´å€¼çš„æ‹·è´ã€‚å¦‚æ­¤ä¸€æ¥ï¼ŒåŸå€¼ï¼ˆå³æ‹·è´å‰çš„å€¼ï¼‰å’Œæ‹·è´å€¼å°±æ˜¯ä¸¤ä¸ªï¼ˆå‡ ä¹ï¼‰ä¸ç›¸å¹²çš„å€¼äº†ã€‚åœ¨ä¸¤è¾¹åˆ†åˆ«å¯¹å®ƒä»¬è¿›è¡Œæ“ä½œï¼Œä¹Ÿå°±èµ·ä¸åˆ°åŒæ­¥å·¥å…·åŸæœ‰çš„ä½œç”¨äº†ã€‚<br><br>ä½†å¦‚æœæ˜¯ä¼ é€’æŒ‡é’ˆå€¼çš„è¯ï¼Œä¸¤è¾¹æ“ä½œçš„ä»ç„¶ä¼šæ˜¯åŒä¸€ä¸ªæºå€¼ï¼Œå¯¹å§ï¼Ÿè¿™å°±é¿å…äº†åŒæ­¥å·¥å…·çš„â€œæ“ä½œå¤±çµâ€çš„é—®é¢˜ã€‚<br><br>ä½ è¯´çš„â€œæŒ‡é’ˆä¼šå¯¼è‡´æ•°æ®å…±äº«å’Œç«äº‰â€æ˜¯å¦ä¸€ä¸ªè§†è§’çš„é—®é¢˜ã€‚ä½†æ˜¯è¿™ä¸¤ä¸ªé—®é¢˜çš„åº•å±‚çŸ¥è¯†æ˜¯ä¸€ä¸ªï¼Œå³ï¼šä¼ é€’æŒ‡é’ˆå€¼çš„æ—¶å€™å¹¶ä¸ä¼šæ‹·è´æºå€¼ï¼Œå¯¼è‡´åˆ†åˆ«æ“ä½œä¸¤ä¸ªæŒ‡é’ˆå€¼ç›¸å½“äºåœ¨æ“ä½œåŒä¸€ä¸ªæºå€¼ã€‚<br><br>åŒæ­¥å·¥å…·çš„å†…éƒ¨è‡ªæœ‰é¿å…ç«äº‰çš„æ‰‹æ®µï¼Œæ‰€ä»¥æ‹·è´å…¶æŒ‡é’ˆå€¼åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯å¯ä»¥çš„ã€‚ä½†æ˜¯ï¼Œæœ€å¥½è¿˜æ˜¯ä¸è¦æ‹·è´å®ƒä»¬çš„æŒ‡é’ˆå€¼ï¼ˆå°¤å…¶æ˜¯syncåŒ…ä¸­çš„é‚£äº›å·¥å…·ï¼‰ï¼Œå› ä¸ºè¿™æ ·å¾ˆå¯èƒ½ä¼šè¿·æƒ‘ä½è¯»ä»£ç å’Œåç»­å†™ä»£ç çš„äººï¼Œå¯¼è‡´ç†è§£é”™è¯¯æˆ–æ“ä½œé”™è¯¯çš„æ¦‚ç‡å¾ˆå¤§ã€‚<br><br>","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1620280098,"ip_address":"","comment_id":291365,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5915196819","product_id":100013101,"comment_content":"â€œç”±äºContextç±»å‹å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ¥å£ç±»å‹ï¼Œè€ŒcontextåŒ…ä¸­å®ç°è¯¥æ¥å£çš„æ‰€æœ‰ç§æœ‰ç±»å‹ï¼Œéƒ½æ˜¯åŸºäºæŸä¸ªæ•°æ®ç±»å‹çš„æŒ‡é’ˆç±»å‹ï¼Œæ‰€ä»¥ï¼Œå¦‚æ­¤ä¼ æ’­å¹¶ä¸ä¼šå½±å“è¯¥ç±»å‹å€¼çš„åŠŸèƒ½å’Œå®‰å…¨ã€‚â€<br>è¯·é—®è€å¸ˆï¼Œè¿™å¥è¯ä¸­çš„ã€Œæ‰€ä»¥ã€äºŒå­—æ€ä¹ˆç†è§£å‘¢ï¼ŸæŒ‡é’ˆä¸æ˜¯ä¼šå¯¼è‡´æ•°æ®å…±äº«å’Œç«äº‰å—ï¼Ÿä¸ºä»€ä¹ˆåè€Œæ˜¯å®‰å…¨çš„å‘¢ï¼Ÿè°¢è°¢ï¼","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519451,"discussion_content":"ä½ å¼•ç”¨çš„è¿™æ®µè¯å…¶å®æœ‰ä¸¤å±‚å«ä¹‰ï¼š\n\n1. æŸä¸ªå€¼çš„æŒ‡é’ˆå€¼çš„ä¼ é€’å¹¶ä¸ä¼šå¯¼è‡´æºå€¼ï¼ˆå³æŒ‡é’ˆæŒ‡å‘çš„é‚£ä¸ªå€¼ï¼‰çš„æ‹·è´ã€‚\n2. æ¥å£å€¼é‡Œé¢å…¶å®ä¼šå­˜å‚¨å®é™…å€¼çš„æŒ‡é’ˆå€¼ï¼Œè€Œä¸æ˜¯å®é™…å€¼ã€‚æ‰€ä»¥åœ¨æ‹·è´ä¹‹åï¼Œå…¶ä¸­çš„å®é™…å€¼ä¾ç„¶æ˜¯æºå€¼ã€‚\n\nä½ çœ‹è¿‡syncåŒ…çš„æ–‡æ¡£å—ï¼Ÿé‡Œé¢çš„åŒæ­¥å·¥å…·å¤§éƒ½ä¸å…è®¸â€œä½¿ç”¨ä¹‹åçš„å†ä¼ é€’â€ã€‚\n\nå…¶å®è¿™ç§çº¦æŸçš„åŸå› å°±æ˜¯ï¼Œä¼ é€’å€¼ä¼šå¯¼è‡´å€¼çš„æ‹·è´ã€‚å¦‚æ­¤ä¸€æ¥ï¼ŒåŸå€¼ï¼ˆå³æ‹·è´å‰çš„å€¼ï¼‰å’Œæ‹·è´å€¼å°±æ˜¯ä¸¤ä¸ªï¼ˆå‡ ä¹ï¼‰ä¸ç›¸å¹²çš„å€¼äº†ã€‚åœ¨ä¸¤è¾¹åˆ†åˆ«å¯¹å®ƒä»¬è¿›è¡Œæ“ä½œï¼Œä¹Ÿå°±èµ·ä¸åˆ°åŒæ­¥å·¥å…·åŸæœ‰çš„ä½œç”¨äº†ã€‚\n\nä½†å¦‚æœæ˜¯ä¼ é€’æŒ‡é’ˆå€¼çš„è¯ï¼Œä¸¤è¾¹æ“ä½œçš„ä»ç„¶ä¼šæ˜¯åŒä¸€ä¸ªæºå€¼ï¼Œå¯¹å§ï¼Ÿè¿™å°±é¿å…äº†åŒæ­¥å·¥å…·çš„â€œæ“ä½œå¤±çµâ€çš„é—®é¢˜ã€‚\n\nä½ è¯´çš„â€œæŒ‡é’ˆä¼šå¯¼è‡´æ•°æ®å…±äº«å’Œç«äº‰â€æ˜¯å¦ä¸€ä¸ªè§†è§’çš„é—®é¢˜ã€‚ä½†æ˜¯è¿™ä¸¤ä¸ªé—®é¢˜çš„åº•å±‚çŸ¥è¯†æ˜¯ä¸€ä¸ªï¼Œå³ï¼šä¼ é€’æŒ‡é’ˆå€¼çš„æ—¶å€™å¹¶ä¸ä¼šæ‹·è´æºå€¼ï¼Œå¯¼è‡´åˆ†åˆ«æ“ä½œä¸¤ä¸ªæŒ‡é’ˆå€¼ç›¸å½“äºåœ¨æ“ä½œåŒä¸€ä¸ªæºå€¼ã€‚\n\nåŒæ­¥å·¥å…·çš„å†…éƒ¨è‡ªæœ‰é¿å…ç«äº‰çš„æ‰‹æ®µï¼Œæ‰€ä»¥æ‹·è´å…¶æŒ‡é’ˆå€¼åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯å¯ä»¥çš„ã€‚ä½†æ˜¯ï¼Œæœ€å¥½è¿˜æ˜¯ä¸è¦æ‹·è´å®ƒä»¬çš„æŒ‡é’ˆå€¼ï¼ˆå°¤å…¶æ˜¯syncåŒ…ä¸­çš„é‚£äº›å·¥å…·ï¼‰ï¼Œå› ä¸ºè¿™æ ·å¾ˆå¯èƒ½ä¼šè¿·æƒ‘ä½è¯»ä»£ç å’Œåç»­å†™ä»£ç çš„äººï¼Œå¯¼è‡´ç†è§£é”™è¯¯æˆ–æ“ä½œé”™è¯¯çš„æ¦‚ç‡å¾ˆå¤§ã€‚\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620278448,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":137688,"user_name":"moooofly","can_delete":false,"product_type":"c1","uid":1008348,"ip_address":"","ucode":"4A20795C281B6F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/62/dc/8876c73b.jpg","comment_is_top":false,"comment_ctime":1569823767,"is_pvip":false,"replies":[{"id":"53001","content":"é€»è¾‘ä¸Šä¼šä¸€èµ·æ–­å¼€çš„ã€‚ä½†ç”±äº value context æœ¬èº«ä¸ä¼šå»ä¼ é€’ä¿¡å·ï¼Œæ‰€ä»¥å®è´¨ä¸Šä¸ç”¨åšæ–­å¼€æ“ä½œã€‚è¿™å‡ ç§ context æ‰€èµ·åˆ°çš„ä½œç”¨æ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥æœ‰äº›ä¸“å±çš„æ“ä½œåªä¼šåœ¨å¯¹åº”çš„ context ä¸Šåšã€‚ä¸è¿‡ä¸å®ƒä»¬ä¸´è¿‘çš„å…¶ä»–ç§ç±»çš„ context ä¼šéšä¹‹è”åŠ¨ã€‚ä½ çœ‹ä¸‹æºç å°±æ¸…æ¥šäº†ï¼Œå®ƒä»¬ä¸æ˜¯å®Œå…¨â€œé“¾æ¥â€åœ¨ä¸€èµ·çš„ï¼Œæœ‰çš„ä¼šç´§å¯†åµŒå¥—åœ¨ä¸€èµ·ï¼Œæ‰€ä»¥æœ‰çš„æ“ä½œå¯ä»¥å¾ˆè‡ªç„¶åœ°è¿›è¡Œè·¨è¶Šå¼å¤„ç†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1569914737,"ip_address":"","comment_id":137688,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5864791063","product_id":100013101,"comment_content":"â€œå®ƒä¼šå‘å®ƒçš„æ‰€æœ‰å­å€¼ï¼ˆæˆ–è€…è¯´å­èŠ‚ç‚¹ï¼‰ä¼ è¾¾æ’¤é”€ä¿¡å·ã€‚è¿™äº›å­å€¼ä¼šå¦‚æ³•ç‚®åˆ¶ï¼ŒæŠŠæ’¤é”€ä¿¡å·ç»§ç»­ä¼ æ’­ä¸‹å»ã€‚æœ€åï¼Œè¿™ä¸ª Context å€¼ä¼šæ–­å¼€å®ƒä¸å…¶çˆ¶å€¼ä¹‹é—´çš„å…³è”ã€‚â€--è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘èƒ½ç†è§£ï¼Œå½“åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡æ ‘ä¸Šçš„æŸä¸ª node ä¸Šè§¦å‘ cancel ä¿¡å·æ—¶ï¼Œä»¥è¯¥ node ä¸ºæ ¹çš„å­ä¸Šä¸‹æ–‡æ ‘ä¼šä»åŸæ¥çš„æ ‘ä¸Šæ–­å¼€ï¼›è€Œæ–‡ä¸­åˆæåˆ°â€œæ’¤é”€ä¿¡å·åœ¨è¢«ä¼ æ’­æ—¶ï¼Œè‹¥é‡åˆ°å®ƒä»¬ï¼ˆè°ƒç”¨ context.WithValue å‡½æ•°å¾—åˆ°çš„ Context å€¼ï¼‰åˆ™ä¼šç›´æ¥è·¨è¿‡â€ ï¼Œé‚£ä¹ˆï¼Œè¿™äº›è¢«â€œè·¨è¿‡â€çš„ node ï¼Œåœ¨ä¸Šé¢è¯´çš„å­ä¸Šä¸‹æ–‡æ ‘æ–­å¼€çš„è¿‡ç¨‹é‡Œï¼Œæ˜¯ä¸€èµ·æ–­å¼€äº†ï¼Ÿè¿˜æ˜¯ä»æ—§ä¼šå’Œæ›´ä¸Šå±‚çš„ node èŠ‚ç‚¹æœ‰å…³è”ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":469212,"discussion_content":"é€»è¾‘ä¸Šä¼šä¸€èµ·æ–­å¼€çš„ã€‚ä½†ç”±äº value context æœ¬èº«ä¸ä¼šå»ä¼ é€’ä¿¡å·ï¼Œæ‰€ä»¥å®è´¨ä¸Šä¸ç”¨åšæ–­å¼€æ“ä½œã€‚è¿™å‡ ç§ context æ‰€èµ·åˆ°çš„ä½œç”¨æ˜¯ä¸åŒçš„ï¼Œæ‰€ä»¥æœ‰äº›ä¸“å±çš„æ“ä½œåªä¼šåœ¨å¯¹åº”çš„ context ä¸Šåšã€‚ä¸è¿‡ä¸å®ƒä»¬ä¸´è¿‘çš„å…¶ä»–ç§ç±»çš„ context ä¼šéšä¹‹è”åŠ¨ã€‚ä½ çœ‹ä¸‹æºç å°±æ¸…æ¥šäº†ï¼Œå®ƒä»¬ä¸æ˜¯å®Œå…¨â€œé“¾æ¥â€åœ¨ä¸€èµ·çš„ï¼Œæœ‰çš„ä¼šç´§å¯†åµŒå¥—åœ¨ä¸€èµ·ï¼Œæ‰€ä»¥æœ‰çš„æ“ä½œå¯ä»¥å¾ˆè‡ªç„¶åœ°è¿›è¡Œè·¨è¶Šå¼å¤„ç†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569914737,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1008348,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/62/dc/8876c73b.jpg","nickname":"moooofly","note":"","ucode":"4A20795C281B6F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":24003,"discussion_content":"å¤šè°¢è§£æƒ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569978672,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130278,"user_name":"æµ·ç›—èˆ¹é•¿","can_delete":false,"product_type":"c1","uid":1363634,"ip_address":"","ucode":"ECB28BA21A4113","user_header":"https://static001.geekbang.org/account/avatar/00/14/ce/b2/1f914527.jpg","comment_is_top":false,"comment_ctime":1567416733,"is_pvip":false,"replies":[{"id":"48679","content":"ä½ å¯ä»¥è¯´çš„å…·ä½“ä¸€äº›ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1567475204,"ip_address":"","comment_id":130278,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5862384029","product_id":100013101,"comment_content":"å®é™…ä½¿ç”¨ä¸­ http.ReverseProxyç»å¸¸ä¼šæŠ¥ proxy errorï¼šcontext canceled è¯·é—®è€å¸ˆæœ‰å“ªäº›åŸå› å¯èƒ½å¯¼è‡´è¿™ä¸ªé—®é¢˜","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":465888,"discussion_content":"ä½ å¯ä»¥è¯´çš„å…·ä½“ä¸€äº›ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1567475204,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114073,"user_name":"é—«é£","can_delete":false,"product_type":"c1","uid":1013162,"ip_address":"","ucode":"30C782D30108D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/75/aa/21275b9d.jpg","comment_is_top":false,"comment_ctime":1563236186,"is_pvip":false,"replies":[{"id":"41615","content":"ç¿»è¯‘çš„è¯ï¼Ÿè¿™æ˜¯æˆ‘æ‰¾åˆ°çš„ä¸€ä¸ªæ¯”è¾ƒè´´åˆ‡çš„è¯ã€‚æŠŠ Context æ¯”å–»æˆå¯ä»¥ç¹è¡åä»£çš„ç”Ÿç‰©ä¸ä¼šæ›´å®¹æ˜“ç†è§£ä¸€äº›ä¹ˆï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1563243682,"ip_address":"","comment_id":114073,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5858203482","product_id":100013101,"comment_content":"ç¹è¡ä¸€è¯çš„ç¿»è¯‘æœ‰äº›ç”Ÿç¡¬ï¼Œæ˜¯å¦èƒ½æ¢ä¸€ä¸ªå¥½ç†è§£ä¸€äº›çš„ä¸­æ–‡è¯æ±‡","like_count":1,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458503,"discussion_content":"ç¿»è¯‘çš„è¯ï¼Ÿè¿™æ˜¯æˆ‘æ‰¾åˆ°çš„ä¸€ä¸ªæ¯”è¾ƒè´´åˆ‡çš„è¯ã€‚æŠŠ Context æ¯”å–»æˆå¯ä»¥ç¹è¡åä»£çš„ç”Ÿç‰©ä¸ä¼šæ›´å®¹æ˜“ç†è§£ä¸€äº›ä¹ˆï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563243682,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":357388,"user_name":"é»„ä»²è¾‰","can_delete":false,"product_type":"c1","uid":1593521,"ip_address":"æ²³å—","ucode":"D7EB3C3ADD99DA","user_header":"https://static001.geekbang.org/account/avatar/00/18/50/b1/7b701518.jpg","comment_is_top":false,"comment_ctime":1663218368,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1663218368","product_id":100013101,"comment_content":"contextå®ç°goroutineçš„åè°ƒï¼Œæ­¤å¤„å¹¶ä¸ä¸¥è°¨ï¼Œè§¦å‘cancelçš„gorutineæ‰§è¡Œå®Œä»»åŠ¡äº†ï¼Œä¸ä»£è¡¨å…¶ä»–gorutineä¹Ÿæ‰§è¡Œå®Œäº†ï¼Œè¿™æ ·å°±æœ‰ä»»åŠ¡è¢«ä¸­æ–­äº†ã€‚","like_count":0},{"had_liked":false,"id":345445,"user_name":"å¯»é£","can_delete":false,"product_type":"c1","uid":2230331,"ip_address":"","ucode":"A5294CF85BDA50","user_header":"https://static001.geekbang.org/account/avatar/00/22/08/3b/6fbc7ea0.jpg","comment_is_top":false,"comment_ctime":1652273886,"is_pvip":false,"replies":[{"id":"126245","content":"ä¸¥æ ¼æ¥è¯´ï¼ŒContextçš„åŠŸç”¨æ˜¯åœ¨å¤šä¸ªgoroutineä¹‹é—´ä¼ é€’ä¿¡å·ï¼Œæ¯”å¦‚ä¼ é€’çŠ¶æ€å¼€å…³ã€‚ä¼ å€¼åªæ˜¯å®ƒçš„ä¸€ä¸ªå‰¯ä½œç”¨è€Œå·²ï¼Œè€Œä¸”éœ€è¦ç”¨ç‰¹å®šçš„å®ç°ç±»å‹æ¥åšï¼ˆæ¶‰åŠåˆ°context.WithValueå‡½æ•°ï¼‰ã€‚<br><br>å¦‚æœä½ çš„ä¸»è¦ç›®çš„æ˜¯ä¼ å€¼ï¼Œé‚£ä¹ˆæ¨èä½¿ç”¨channelã€‚å½“ç„¶äº†ï¼Œåœ¨ä¸€å¯¹å¤šä¼ å€¼çš„æ—¶å€™ï¼ŒContextæ˜¾ç„¶æ›´æ–¹ä¾¿ä¸€äº›ã€‚<br><br>å¦å¤–ï¼Œä»æºç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®ç°Contextæ¥å£çš„ç±»å‹éƒ½æ˜¯æŸä¸ªç»“æ„ä½“çš„æŒ‡é’ˆç±»å‹ã€‚è¿™æ›´ç¬¦åˆä½ è¯´çš„ç¬¬äºŒæ®µè¯ã€‚ä½†åŒæ—¶ï¼Œåœ¨å†…éƒ¨ä¹Ÿæ˜¯æœ‰å¹¶å‘å®‰å…¨æ–¹é¢çš„ä¿éšœçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":"1026643","ctime":1652763261,"ip_address":"","comment_id":345445,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1652273886","product_id":100013101,"comment_content":"Contextå¯ä»¥çœ‹ä½œæ˜¯æŸä¸ªçˆ¶goroutineçš„ä¸€ä¸ªå˜é‡,å¹¶ä¸”è¿™ä¸ªå˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„, å½“è¿™ä¸ªå˜é‡ä¼ å…¥å­çš„goroutineå, å°±æ„å‘³ç€çˆ¶goroutineå’Œå­goroutineå¯ä»¥é€šè¿‡è¿™ä¸ªå˜é‡æ¥è¿›è¡Œä¿¡æ¯äº¤äº’?<br>æˆ–è€…Contextæ˜¯ä¸€ä¸ªç‹¬ç«‹ç”³è¯·çš„çš„å†…å­˜åŒºåŸŸ, çˆ¶goroutineå’Œå­goroutineéƒ½æœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å®ƒ, è¿™æ ·å°±å¯ä»¥é€šè¿‡è¿™å—å…±äº«çš„å†…å­˜è¿›è¡Œä¿¡æ¯äº¤äº’äº†?<br>","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572390,"discussion_content":"ä¸¥æ ¼æ¥è¯´ï¼ŒContextçš„åŠŸç”¨æ˜¯åœ¨å¤šä¸ªgoroutineä¹‹é—´ä¼ é€’ä¿¡å·ï¼Œæ¯”å¦‚ä¼ é€’çŠ¶æ€å¼€å…³ã€‚ä¼ å€¼åªæ˜¯å®ƒçš„ä¸€ä¸ªå‰¯ä½œç”¨è€Œå·²ï¼Œè€Œä¸”éœ€è¦ç”¨ç‰¹å®šçš„å®ç°ç±»å‹æ¥åšï¼ˆæ¶‰åŠåˆ°context.WithValueå‡½æ•°ï¼‰ã€‚\n\nå¦‚æœä½ çš„ä¸»è¦ç›®çš„æ˜¯ä¼ å€¼ï¼Œé‚£ä¹ˆæ¨èä½¿ç”¨channelã€‚å½“ç„¶äº†ï¼Œåœ¨ä¸€å¯¹å¤šä¼ å€¼çš„æ—¶å€™ï¼ŒContextæ˜¾ç„¶æ›´æ–¹ä¾¿ä¸€äº›ã€‚\n\nå¦å¤–ï¼Œä»æºç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®ç°Contextæ¥å£çš„ç±»å‹éƒ½æ˜¯æŸä¸ªç»“æ„ä½“çš„æŒ‡é’ˆç±»å‹ã€‚è¿™æ›´ç¬¦åˆä½ è¯´çš„ç¬¬äºŒæ®µè¯ã€‚ä½†åŒæ—¶ï¼Œåœ¨å†…éƒ¨ä¹Ÿæ˜¯æœ‰å¹¶å‘å®‰å…¨æ–¹é¢çš„ä¿éšœçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652763261,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":331012,"user_name":"çªçªå¤´","can_delete":false,"product_type":"c1","uid":1063866,"ip_address":"","ucode":"5C2635ED6484F8","user_header":"https://static001.geekbang.org/account/avatar/00/10/3b/ba/3b30dcde.jpg","comment_is_top":false,"comment_ctime":1642378866,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1642378866","product_id":100013101,"comment_content":"æ’¤å›çš„æ—¶å€™æˆ‘è§‰å¾—åº”è¯¥æ˜¯æ·±åº¦ä¼˜å…ˆçš„ï¼Œå…ˆæŠŠè‡ªèº«çš„æ¥æ”¶æ…åˆ°å…³é—­å†ä¼ é€’ç»™è‡ªèº«çš„æ‰€æœ‰å­èŠ‚ç‚¹","like_count":0},{"had_liked":false,"id":327971,"user_name":"ä¸€æ­¥","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1640425147,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1640425147","product_id":100013101,"comment_content":"func (c *cancelCtx) cancel(removeFromParent bool, err error) {<br>        ...<br>\tfor child := range c.children {<br>\t\t&#47;&#47; NOTE: acquiring the child&#39;s lock while holding parent&#39;s lock.<br>\t\tchild.cancel(false, err)<br>\t}<br>\t...<br>}<br>æ·±åº¦ä¼˜å…ˆ","like_count":0},{"had_liked":false,"id":322843,"user_name":"jxs1211","can_delete":false,"product_type":"c1","uid":1101006,"ip_address":"","ucode":"B7F1F2D84389E7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKELX1Rd1vmLRWibHib8P95NA87F4zcj8GrHKYQL2RcLDVnxNy1ia2geTWgW6L2pWn2kazrPNZMRVrIg/132","comment_is_top":false,"comment_ctime":1637631144,"is_pvip":false,"replies":[{"id":"117220","content":"â€œå¦‚æœè¶³å¤Ÿå…¬å¹³çš„è¯ï¼Œè‡³å°‘è¦åœ¨ç­‰åˆ°å½“å‰æ‰§è¡Œçš„goroutineé˜»å¡è€Œè®©å‡ºcpuï¼Œæ‰åˆ‡åˆ°å…¶ä»–goroutineæ‰§è¡Œâ€<br><br>ä½ è¯´çš„è¿™ä¸ªç­–ç•¥æ‰å«ä¸å…¬å¹³å•Šã€‚æŒ‰ç…§è¿™ç§ç­–ç•¥ï¼Œå¦‚æœä¸€ä¸ªgoroutineä¸€ç›´ä¸é˜»å¡ï¼Œé‚£å…¶ä»–çš„goroutineå°±åªèƒ½åœ¨é‚£é‡Œå‚»ç­‰å˜›ï¼Ÿ<br><br>å¦å¤–ï¼ŒCPUçš„è°ƒåº¦ç²’åº¦æ˜¯æŒ‡ä»¤çº§åˆ«çš„ï¼Œå®ƒæ ¹æœ¬å°±ä¸çŸ¥é“goroutineçš„å­˜åœ¨ã€‚å³ä½¿æ˜¯Goè¯­è¨€çš„è¿è¡Œæ—¶ç³»ç»Ÿï¼Œå®ƒçš„è°ƒåº¦ç²’åº¦ä¹Ÿæ˜¯è¯­å¥çº§åˆ«çš„ã€‚Goroutineåªæ˜¯Goç¨‹åºä¸­çš„å¹¶å‘æ‰§è¡Œå•å…ƒï¼Œè€Œä¸æ˜¯è°ƒåº¦å•å…ƒã€‚<br><br>å…·ä½“åœ°è¯´ï¼ŒGoroutineï¼ˆæˆ–è€…è¯´goå‡½æ•°ï¼‰åªæ˜¯æŠŠâ€œå¯¹å†…éœ€è¦ä¸²è¡Œæ‰§è¡Œï¼Œä½†å¯¹å¤–éœ€è¦å¹¶å‘æ‰§è¡Œâ€çš„é‚£äº›ä»£ç å½’æ‹¢åœ¨äº†ä¸€èµ·ã€‚è€ŒGoè¯­è¨€çš„runtimeä¼šåœ¨è¿™äº›goroutineæ‰€åŒ…å«çš„å„ä¸ªè¯­å¥çš„æ‰§è¡Œé—´éš™æ¥åšåˆ‡æ¢ï¼Œæ¯”å¦‚ï¼šä¸€ä¸ªgoroutineä¸­çš„æŸæ¡è¯­å¥åˆšæ‰§è¡Œå®Œï¼Œruntimeå°±å¯èƒ½ä¼šè½¬è€Œå»æ‰§è¡Œå¦ä¸€ä¸ªgoroutineä¸­çš„ï¼ˆåœ¨ä¸­æ­¢ç‚¹ä¹‹åçš„é‚£æ¡ï¼‰è¯­å¥ã€‚<br><br>æ‰€ä»¥ï¼Œå›ç­”ä½ æœ€åçš„ç–‘é—®ï¼šä½ ç¡®å®å¯ä»¥è¿™æ ·ç†è§£ï¼ŒGoè¯­è¨€çš„runtimeæ˜¯åœ¨å¤šä¸ªgoroutineä¹‹é—´ä¸åœçš„åˆ‡æ¢æ¥å¹¶å‘çš„æ‰§è¡Œè¯­å¥ã€‚<br><br>ï¼ˆè€ŒCPUå¹¶ä¸çŸ¥é“è¿™äº›ï¼Œå®ƒåªçŸ¥é“ä¸‹é¢è¯¥æ‰§è¡Œå“ªæ¡æŒ‡ä»¤äº†ï¼Œä»¥åŠè¯¥æŒ‡ä»¤æ¶‰åŠçš„æ•°æ®åœ¨å­˜å‚¨å™¨çš„å“ªä¸ªä½ç½®ã€‚æ‰€ä»¥è¯´ï¼Œæ“ä½œç³»ç»Ÿåœ¨è¿™ä¸¤è¾¹çš„ä¸­é—´æ‰®æ¼”äº†ç›¸å½“é‡è¦çš„è§’è‰²ã€‚ï¼‰","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1026643","ctime":1637650058,"ip_address":"","comment_id":322843,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1637631144","product_id":100013101,"comment_content":"coordinateWithContextä¸­ï¼Œå¦‚æœæ”¹æˆWithTimeoutåˆ›å»ºctxçš„è¯ï¼Œä¸»goroutineåªè¦&lt;-ctx.Done()æ¥æ”¶åˆ°æŒ‚å£é€šé“çš„ä¿¡å·åå°±ä¼šç«‹é©¬è§£é™¤é˜»å¡ï¼Œè€Œæ‰§è¡Œé€€å‡ºï¼Œè¿™ä¸ªæ—¶å€™å³ä½¿forä¸­çš„å­goroutineè¿˜æ²¡æœ‰æ‰§è¡Œå®Œæˆä¹Ÿä¼šè¢«å¼ºåˆ¶é€€å‡ºäº†ï¼Œè¿™æ ·æƒ…å†µä¸‹æŸä¸ªå­goroutineæ‰§è¡Œåˆ°ä¸€åŠçš„æ—¶å€™ï¼Œä¼šè¢«â€˜ä¸­æ–­â€™ï¼Œæ„Ÿè§‰ä¸Šæ²¡æœ‰å¾—åˆ°å…¬å¹³çš„å¯¹å¾…ï¼Œä¸ªäººç†è§£çš„cpuåœ¨goroutineä¸­è°ƒåº¦ï¼Œå¦‚æœè¶³å¤Ÿå…¬å¹³çš„è¯ï¼Œè‡³å°‘è¦åœ¨ç­‰åˆ°å½“å‰æ‰§è¡Œçš„goroutineé˜»å¡è€Œè®©å‡ºcpuï¼Œæ‰åˆ‡åˆ°å…¶ä»–goroutineæ‰§è¡Œï¼Œè¿˜æ˜¯æˆ‘ç†è§£é”™äº†ï¼Œcpuå°±æ˜¯ä¸åœçš„åœ¨å„ä¸ªgoroutineé—´åˆ‡æ¥æ¥å»çš„æ‰§è¡Œï¼Œè€Œä¸ç®¡æŸä¸ªgoroutineæœ‰æ²¡æœ‰é˜»å¡","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532589,"discussion_content":"â€œå¦‚æœè¶³å¤Ÿå…¬å¹³çš„è¯ï¼Œè‡³å°‘è¦åœ¨ç­‰åˆ°å½“å‰æ‰§è¡Œçš„goroutineé˜»å¡è€Œè®©å‡ºcpuï¼Œæ‰åˆ‡åˆ°å…¶ä»–goroutineæ‰§è¡Œâ€\n\nä½ è¯´çš„è¿™ä¸ªç­–ç•¥æ‰å«ä¸å…¬å¹³å•Šã€‚æŒ‰ç…§è¿™ç§ç­–ç•¥ï¼Œå¦‚æœä¸€ä¸ªgoroutineä¸€ç›´ä¸é˜»å¡ï¼Œé‚£å…¶ä»–çš„goroutineå°±åªèƒ½åœ¨é‚£é‡Œå‚»ç­‰å˜›ï¼Ÿ\n\nå¦å¤–ï¼ŒCPUçš„è°ƒåº¦ç²’åº¦æ˜¯æŒ‡ä»¤çº§åˆ«çš„ï¼Œå®ƒæ ¹æœ¬å°±ä¸çŸ¥é“goroutineçš„å­˜åœ¨ã€‚å³ä½¿æ˜¯Goè¯­è¨€çš„è¿è¡Œæ—¶ç³»ç»Ÿï¼Œå®ƒçš„è°ƒåº¦ç²’åº¦ä¹Ÿæ˜¯è¯­å¥çº§åˆ«çš„ã€‚Goroutineåªæ˜¯Goç¨‹åºä¸­çš„å¹¶å‘æ‰§è¡Œå•å…ƒï¼Œè€Œä¸æ˜¯è°ƒåº¦å•å…ƒã€‚\n\nå…·ä½“åœ°è¯´ï¼ŒGoroutineï¼ˆæˆ–è€…è¯´goå‡½æ•°ï¼‰åªæ˜¯æŠŠâ€œå¯¹å†…éœ€è¦ä¸²è¡Œæ‰§è¡Œï¼Œä½†å¯¹å¤–éœ€è¦å¹¶å‘æ‰§è¡Œâ€çš„é‚£äº›ä»£ç å½’æ‹¢åœ¨äº†ä¸€èµ·ã€‚è€ŒGoè¯­è¨€çš„runtimeä¼šåœ¨è¿™äº›goroutineæ‰€åŒ…å«çš„å„ä¸ªè¯­å¥çš„æ‰§è¡Œé—´éš™æ¥åšåˆ‡æ¢ï¼Œæ¯”å¦‚ï¼šä¸€ä¸ªgoroutineä¸­çš„æŸæ¡è¯­å¥åˆšæ‰§è¡Œå®Œï¼Œruntimeå°±å¯èƒ½ä¼šè½¬è€Œå»æ‰§è¡Œå¦ä¸€ä¸ªgoroutineä¸­çš„ï¼ˆåœ¨ä¸­æ­¢ç‚¹ä¹‹åçš„é‚£æ¡ï¼‰è¯­å¥ã€‚\n\næ‰€ä»¥ï¼Œå›ç­”ä½ æœ€åçš„ç–‘é—®ï¼šä½ ç¡®å®å¯ä»¥è¿™æ ·ç†è§£ï¼ŒGoè¯­è¨€çš„runtimeæ˜¯åœ¨å¤šä¸ªgoroutineä¹‹é—´ä¸åœçš„åˆ‡æ¢æ¥å¹¶å‘çš„æ‰§è¡Œè¯­å¥ã€‚\n\nï¼ˆè€ŒCPUå¹¶ä¸çŸ¥é“è¿™äº›ï¼Œå®ƒåªçŸ¥é“ä¸‹é¢è¯¥æ‰§è¡Œå“ªæ¡æŒ‡ä»¤äº†ï¼Œä»¥åŠè¯¥æŒ‡ä»¤æ¶‰åŠçš„æ•°æ®åœ¨å­˜å‚¨å™¨çš„å“ªä¸ªä½ç½®ã€‚æ‰€ä»¥è¯´ï¼Œæ“ä½œç³»ç»Ÿåœ¨è¿™ä¸¤è¾¹çš„ä¸­é—´æ‰®æ¼”äº†ç›¸å½“é‡è¦çš„è§’è‰²ã€‚ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637650058,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":322459,"user_name":"jxs1211","can_delete":false,"product_type":"c1","uid":1101006,"ip_address":"","ucode":"B7F1F2D84389E7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKELX1Rd1vmLRWibHib8P95NA87F4zcj8GrHKYQL2RcLDVnxNy1ia2geTWgW6L2pWn2kazrPNZMRVrIg/132","comment_is_top":false,"comment_ctime":1637399165,"is_pvip":false,"replies":[{"id":"117155","content":"goroutineä¾ç„¶æ˜¯å¹¶å‘çš„ï¼Œåªä¸è¿‡åˆ°äº†æœ€åéœ€è¦ç­‰ä¸€ç­‰ï¼Œå¯ä»¥å«â€œé˜¶æ®µæ€§ä¸²è¡Œâ€å§ã€‚è·Ÿåˆ†å¸ƒå¼ç³»ç»Ÿé‡Œçš„â€œæœ€ç»ˆä¸€è‡´æ€§â€è¿™ä¸ªæ¦‚å¿µç¥ä¼¼ï¼Œéƒ½æ˜¯åˆ°äº†æŸä¸ªæ‰§è¡ŒèŠ‚ç‚¹ä¸Šå¡ä¸€ä¸‹å¹¶ä¿è¯åŒæ­¥æ€§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1026643","ctime":1637562752,"ip_address":"","comment_id":322459,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1637399165","product_id":100013101,"comment_content":"waitgroupçš„æ”¹è¿›ç‰ˆä¸­ï¼Œæ¯æ‰¹å°±æ˜¯ä¸€ä¸ªwgçš„æŠ€æœ¯å‘¨æœŸï¼Œå½“å‰å¾ªç¯çš„è®¡æ•°å‘¨æœŸæ²¡æœ‰å®Œæˆï¼Œä¸‹ä¸€æ¬¡ä¸ä¼šå¼€å§‹ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯strideè¿™ä¹ˆå¤šä¸ªä¸ªgoroutineæ‰§è¡Œå®Œæˆä¹‹å‰ï¼Œæ˜¯ä¸ä¼šå¼€èµ·ä¸‹ä¸€æ‰¹goroutineçš„ï¼Œè¿™æ ·çš„è¯ï¼Œå…¶å®æ¯ä¸€æ‰¹ä¹‹é—´æ˜¯ä¸²è¡Œçš„ï¼Œå¹¶ä¸æ˜¯å¹¶å‘totalé‚£ä¹ˆå¤šgoroutineï¼Œè€Œæ˜¯åªå¹¶å‘äº†strideä¸ªgoroutineï¼Œå¯¹å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532246,"discussion_content":"goroutineä¾ç„¶æ˜¯å¹¶å‘çš„ï¼Œåªä¸è¿‡åˆ°äº†æœ€åéœ€è¦ç­‰ä¸€ç­‰ï¼Œå¯ä»¥å«â€œé˜¶æ®µæ€§ä¸²è¡Œâ€å§ã€‚è·Ÿåˆ†å¸ƒå¼ç³»ç»Ÿé‡Œçš„â€œæœ€ç»ˆä¸€è‡´æ€§â€è¿™ä¸ªæ¦‚å¿µç¥ä¼¼ï¼Œéƒ½æ˜¯åˆ°äº†æŸä¸ªæ‰§è¡ŒèŠ‚ç‚¹ä¸Šå¡ä¸€ä¸‹å¹¶ä¿è¯åŒæ­¥æ€§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637562752,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1101006,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKELX1Rd1vmLRWibHib8P95NA87F4zcj8GrHKYQL2RcLDVnxNy1ia2geTWgW6L2pWn2kazrPNZMRVrIg/132","nickname":"jxs1211","note":"","ucode":"B7F1F2D84389E7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":532421,"discussion_content":"é‚£è¿™ä¸ªæ”¹è¿›ç‰ˆçš„waitgroupå’Œcontext.WithCancelçš„ç‰ˆæœ¬ï¼Œæœ¬è´¨ä¸Šåœ¨goroutineçš„å¹¶å‘ä¸Šæ˜¯æ²¡æœ‰åŒºåˆ«çš„å—ï¼Œè¯•æƒ³å¦‚æœ go funcä¸­æ˜¯ä¸€ä¸ªè€—æ—¶æ¯”è¾ƒé•¿çš„æ“ä½œï¼Œé‚£ä¹ˆæ€»çš„æ‰§è¡Œæ—¶é•¿ä¸Šwgä¼šæ›´é•¿å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637595794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":532246,"ip_address":""},"score":532421,"extra":"{\"user_type\":1}"}]}]},{"had_liked":false,"id":318268,"user_name":"jxs1211","can_delete":false,"product_type":"c1","uid":1101006,"ip_address":"","ucode":"B7F1F2D84389E7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKELX1Rd1vmLRWibHib8P95NA87F4zcj8GrHKYQL2RcLDVnxNy1ia2geTWgW6L2pWn2kazrPNZMRVrIg/132","comment_is_top":false,"comment_ctime":1635221517,"is_pvip":false,"replies":[{"id":"115435","content":"å…ˆä¸è¯´ä½ çš„ç¨‹åºæ˜¯å¦çœŸæ˜¯å¹¶å‘çš„ã€‚<br><br>å¹¶å‘é—®é¢˜çš„å‡ºç°æ˜¯æœ‰ä¸€å®šæ¦‚ç‡çš„ï¼Œä¸æ˜¯è¯´ä½ è‡ªå·±å†™ä¸ªç®€å•ç¨‹åºæµ‹è¯•æ²¡æœ‰é—®é¢˜å°±æ²¡æœ‰é—®é¢˜ï¼Œé€šå¸¸éƒ½æ˜¯éœ€è¦å‹æµ‹çš„ã€‚è€Œä¸”å°±ç®—åƒè¿™ç§ç®€å•çš„ç¨‹åºåœ¨ä¸åŒæœºå™¨ä¸Šçš„è¡¨ç°å¾€å¾€ä¹Ÿæ˜¯ä¸åŒçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1635248704,"ip_address":"","comment_id":318268,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1635221517","product_id":100013101,"comment_content":"func defaultCompareAndSwapInt32(addr *int32, old, new int32) (swapped bool) {<br>\tif old != *addr {<br>\t\treturn false<br>\t}<br>\t*addr = new<br>\treturn true<br>}<br>è¿™æ˜¯æˆ‘è‡ªå·±å†™çš„ä¸€ä¸ªæ²¡æœ‰åŸå­æ“ä½œçš„defaultCompareAndSwapInt32ï¼Œæ›¿æ¢atomic.CompareAndSwapInt32ï¼Œtotal := 120ï¼Œæµ‹è¯•çš„æ•°æ®å¥½åƒæ²¡æœ‰é”™ä¹±ï¼Œæ¯ä¸ªgoroutineçš„äº¤æ¢éƒ½æ˜¯éƒ½æ˜¯é€’å¢çš„ï¼Œæ˜¯æˆ‘ç†è§£é”™äº†å—<br>added from 0 to 1 --2 <br>added from 1 to 2 --4 <br>added from 2 to 3 --3 <br>added from 3 to 4 --5 <br>added from 4 to 5 --6 <br>added from 5 to 6 --7 <br>added from 6 to 7 --9 <br>added from 7 to 8 --8 <br>added from 8 to 9 --10 <br>added from 9 to 10 --11 <br>added from 10 to 11 --12 <br>added from 11 to 12 --13 <br>added from 12 to 13 --15 <br>added from 13 to 14 --14 <br>added from 14 to 15 --16 <br>added from 15 to 16 --18 <br>added from 16 to 17 --17 <br>added from 17 to 18 --19 <br>added from 18 to 19 --20 <br>added from 19 to 20 --22 <br>added from 20 to 21 --21 <br>added from 21 to 22 --23 <br>added from 22 to 23 --24 <br>added from 23 to 24 --25 <br>added from 24 to 25 --27 <br>added from 25 to 26 --28 <br>added from 26 to 27 --26 <br>ã€‚ã€‚ã€‚ã€‚<br>added from 83 to 84 --85 <br>added from 84 to 85 --87 <br>added from 85 to 86 --86 <br>added from 86 to 87 --88 <br>added from 87 to 88 --89 <br>added from 88 to 89 --91 <br>added from 89 to 90 --90 <br>added from 90 to 91 --93 <br>added from 91 to 92 --94 <br>added from 92 to 93 --92 <br>added from 93 to 94 --96 <br>added from 94 to 95 --97 <br>added from 95 to 96 --95 <br>added from 96 to 97 --98 <br>added from 97 to 98 --99 <br>added from 98 to 99 --100 <br>added from 99 to 100 --103 <br>added from 100 to 101 --101 <br>added from 101 to 102 --102 <br>added from 102 to 103 --104 <br>added from 103 to 104 --105 <br>added from 104 to 105 --106 <br>added from 105 to 106 --107 <br>added from 106 to 107 --108 <br>added from 107 to 108 --109 <br>added from 108 to 109 --112 <br>added from 109 to 110 --110 <br>added from 110 to 111 --111 <br>added from 111 to 112 --114 <br>added from 112 to 113 --113 <br>added from 113 to 114 --115 <br>added from 114 to 115 --117 <br>added from 115 to 116 --118 <br>added from 116 to 117 --116 <br>added from 117 to 118 --120 <br>added from 118 to 119 --119 <br>added from 119 to 120 --121 <br>","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529161,"discussion_content":"å…ˆä¸è¯´ä½ çš„ç¨‹åºæ˜¯å¦çœŸæ˜¯å¹¶å‘çš„ã€‚\n\nå¹¶å‘é—®é¢˜çš„å‡ºç°æ˜¯æœ‰ä¸€å®šæ¦‚ç‡çš„ï¼Œä¸æ˜¯è¯´ä½ è‡ªå·±å†™ä¸ªç®€å•ç¨‹åºæµ‹è¯•æ²¡æœ‰é—®é¢˜å°±æ²¡æœ‰é—®é¢˜ï¼Œé€šå¸¸éƒ½æ˜¯éœ€è¦å‹æµ‹çš„ã€‚è€Œä¸”å°±ç®—åƒè¿™ç§ç®€å•çš„ç¨‹åºåœ¨ä¸åŒæœºå™¨ä¸Šçš„è¡¨ç°å¾€å¾€ä¹Ÿæ˜¯ä¸åŒçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635248704,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":318232,"user_name":"jxs1211","can_delete":false,"product_type":"c1","uid":1101006,"ip_address":"","ucode":"B7F1F2D84389E7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKELX1Rd1vmLRWibHib8P95NA87F4zcj8GrHKYQL2RcLDVnxNy1ia2geTWgW6L2pWn2kazrPNZMRVrIg/132","comment_is_top":false,"comment_ctime":1635211367,"is_pvip":false,"replies":[{"id":"115436","content":"å½“ç„¶å­˜åœ¨å¹¶å‘å®‰å…¨é—®é¢˜ï¼Œä¸€å®šè¦é€šè¿‡ç›¸åº”æ‰‹æ®µè¿›è¡Œä¿æŠ¤ï¼Œå¦åˆ™åˆ°äº†çº¿ä¸Šå¾ˆå¯èƒ½ä¼šå‡ºé—®é¢˜ï¼ˆä¸åŒæœºå™¨ã€ä¸åŒé…ç½®ã€ä¸åŒæµé‡ï¼‰","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1635248873,"ip_address":"","comment_id":318232,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1635211367","product_id":100013101,"comment_content":"æŠŠold := atomic.LoadInt32(num)<br>æ”¹æˆold := *numè¿™æ ·åœ¨æ²¡æœ‰é˜²ä¸­æ–­çš„æƒ…å†µä¸‹å–å€¼ï¼Œå®é™…æµ‹è¯•äº†ä¸€äº›æ•°æ®ï¼Œæ²¡æœ‰å‡ºç°é”™ä¹±çš„æƒ…å†µï¼Œéƒ½èƒ½é¡ºåºé€’å¢ï¼ˆå¦‚ä¸‹),è¿™æ ·æ˜¯å¦å­˜åœ¨çº¿ç¨‹ä¸å®‰å…¨çš„æƒ…å†µï¼Œè¿è¡Œæ—¶é—´è¶³å¤Ÿé•¿æ˜¯å¦å°±ä¼šå‡ºç°æ•°æ®é”™ä¹±çš„æƒ…å†µ<br>added from 201 to 202 --5<br>add failed from 201 to 202 --4<br>add failed from 201 to 202 --6<br>added from 202 to 203 --6<br>add failed from 202 to 203 --4<br>added from 203 to 204 --4<br>added from 204 to 205 --6<br>add failed from 204 to 205 --5<br>add failed from 204 to 205 --4<br>added from 205 to 206 --4<br>add failed from 205 to 206 --5<br>added from 206 to 207 --5<br>added from 207 to 208 --4<br>add failed from 207 to 208 --5<br>add failed from 207 to 208 --6<br>added from 208 to 209 --6<br>add failed from 208 to 209 --5<br>added from 209 to 210 --5<br>added from 210 to 211 --4<br>add failed from 210 to 211 --5<br>add failed from 210 to 211 --6<br>added from 211 to 212 --6<br>add failed from 211 to 212 --5<br>added from 212 to 213 --5<br>added from 213 to 214 --5<br>add failed from 213 to 214 --6<br>add failed from 213 to 214 --4<br>","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529146,"discussion_content":"å½“ç„¶å­˜åœ¨å¹¶å‘å®‰å…¨é—®é¢˜ï¼Œä¸€å®šè¦é€šè¿‡ç›¸åº”æ‰‹æ®µè¿›è¡Œä¿æŠ¤ï¼Œå¦åˆ™åˆ°äº†çº¿ä¸Šå¾ˆå¯èƒ½ä¼šå‡ºé—®é¢˜ï¼ˆä¸åŒæœºå™¨ã€ä¸åŒé…ç½®ã€ä¸åŒæµé‡ï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635248873,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":314125,"user_name":"Geek_74baaf","can_delete":false,"product_type":"c1","uid":2730544,"ip_address":"","ucode":"C881699AAF8D0E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83er3buhru0LAs0WQZh9vdDk8P6duwdEIxvTwLTviasadOcP5nlKOjKlKJicNV2QHa9qSIxwUQoYhhYBg/132","comment_is_top":false,"comment_ctime":1632867137,"is_pvip":false,"replies":[{"id":"113788","content":"è¿™ä¸¤ä¸ªå¾ˆç®€å•ï¼Œæˆ‘ç®€å•è¯´ä¸€ä¸‹ä½ å°±æ˜ç™½äº†ã€‚<br><br>ä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œæ¯ä¸ªGoç¨‹åºä¸­éƒ½æœ‰ä¸€æ£µ context æ ‘ï¼Œè€Œ Background å°±æ˜¯è¿™æ£µæ ‘çš„æ ¹ã€‚ä½ å¯ä»¥ç”¨ WithXXX å‡½æ•°åŸºäº Background å»¶ä¼¸å‡ºæ ‘æå’Œå¶å­ï¼Œç”šè‡³æ„å»ºå‡ºå±äºè‡ªå·±ç¨‹åºçš„å­æ ‘ï¼ˆæˆ–è€…è¯´æ”¯å¹²ï¼‰ã€‚è¦æ˜¯æ²¡æœ‰ Backgroundï¼Œä½ è‡ªå·±æ„å»ºçš„ context å°±æ²¡åœ°æ–¹ç€è½äº†ï¼ˆæ²¡æœ‰æ ‘æ ¹å“ªæ¥çš„æ ‘å¹²å’Œæå¶ï¼Ÿï¼‰ã€‚<br><br>TODO çš„è¯ï¼Œä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªå ä½ç¬¦ã€‚å¦‚æœä½ å†³å®šè¦åœ¨æŸä¸ªåœ°æ–¹ä½¿ç”¨ contextï¼Œä½†æ˜¯è¿˜æ²¡æƒ³å¥½æ€ä¹ˆç”¨ï¼Œé‚£ä¹ˆå°±å¯ä»¥å…ˆç”¨ TODOã€‚æ¯”å¦‚ï¼ŒæŠŠå®ƒä¼ ç»™æŸä¸ªéœ€è¦ context çš„å‡½æ•°ï¼Œæˆ–è€…æŠŠå®ƒèµ‹ç»™æŸä¸ªç»“æ„ä½“çš„ Context ç±»å‹çš„å­—æ®µï¼Œç­‰ç­‰ã€‚ç”±äº TODO() å‡½æ•°è¿”å›çš„ä¹Ÿæ˜¯ Context ç±»å‹å€¼ï¼Œæ‰€ä»¥ä¹‹ååšæ›¿æ¢çš„æ—¶å€™å¹¶ä¸ç”¨æ›´æ”¹å‡½æ•°å‚æ•°ç­‰çš„ç±»å‹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1632885993,"ip_address":"","comment_id":314125,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1632867137","product_id":100013101,"comment_content":"è€å¸ˆï¼Œèƒ½è¯·é—®ä¸€ä¸‹backGroundå’ŒTODOä¸¤ç§ç±»å‹çš„å…·ä½“åˆä»€ä¹ˆåŒºåˆ«å—ï¼Œå¦‚æœæ–¹ä¾¿çš„è¯ï¼Œå¯ä¸å¯ä»¥éº»çƒ¦æ‚¨ä¸¾ä¸ªå°ä¾‹å­è¯´æ˜ä¸€ä¸‹ï¼Œçœ‹æ–‡æ¡£å®åœ¨çœ‹çš„ä¸€æ„£ä¸€æ„£çš„","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527577,"discussion_content":"è¿™ä¸¤ä¸ªå¾ˆç®€å•ï¼Œæˆ‘ç®€å•è¯´ä¸€ä¸‹ä½ å°±æ˜ç™½äº†ã€‚\n\nä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œæ¯ä¸ªGoç¨‹åºä¸­éƒ½æœ‰ä¸€æ£µ context æ ‘ï¼Œè€Œ Background å°±æ˜¯è¿™æ£µæ ‘çš„æ ¹ã€‚ä½ å¯ä»¥ç”¨ WithXXX å‡½æ•°åŸºäº Background å»¶ä¼¸å‡ºæ ‘æå’Œå¶å­ï¼Œç”šè‡³æ„å»ºå‡ºå±äºè‡ªå·±ç¨‹åºçš„å­æ ‘ï¼ˆæˆ–è€…è¯´æ”¯å¹²ï¼‰ã€‚è¦æ˜¯æ²¡æœ‰ Backgroundï¼Œä½ è‡ªå·±æ„å»ºçš„ context å°±æ²¡åœ°æ–¹ç€è½äº†ï¼ˆæ²¡æœ‰æ ‘æ ¹å“ªæ¥çš„æ ‘å¹²å’Œæå¶ï¼Ÿï¼‰ã€‚\n\nTODO çš„è¯ï¼Œä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªå ä½ç¬¦ã€‚å¦‚æœä½ å†³å®šè¦åœ¨æŸä¸ªåœ°æ–¹ä½¿ç”¨ contextï¼Œä½†æ˜¯è¿˜æ²¡æƒ³å¥½æ€ä¹ˆç”¨ï¼Œé‚£ä¹ˆå°±å¯ä»¥å…ˆç”¨ TODOã€‚æ¯”å¦‚ï¼ŒæŠŠå®ƒä¼ ç»™æŸä¸ªéœ€è¦ context çš„å‡½æ•°ï¼Œæˆ–è€…æŠŠå®ƒèµ‹ç»™æŸä¸ªç»“æ„ä½“çš„ Context ç±»å‹çš„å­—æ®µï¼Œç­‰ç­‰ã€‚ç”±äº TODO() å‡½æ•°è¿”å›çš„ä¹Ÿæ˜¯ Context ç±»å‹å€¼ï¼Œæ‰€ä»¥ä¹‹ååšæ›¿æ¢çš„æ—¶å€™å¹¶ä¸ç”¨æ›´æ”¹å‡½æ•°å‚æ•°ç­‰çš„ç±»å‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1632885993,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":300800,"user_name":"MClink","can_delete":false,"product_type":"c1","uid":1435733,"ip_address":"","ucode":"F479190923355C","user_header":"https://static001.geekbang.org/account/avatar/00/15/e8/55/92f82281.jpg","comment_is_top":false,"comment_ctime":1625391612,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1625391612","product_id":100013101,"comment_content":"åªçŸ¥é“context åœ¨å†™ä»£ç çš„æ—¶å€™æ•´ä¸ªè°ƒç”¨é“¾æ¯ä¸ªæ–¹æ³•æˆ‘ä»¬éƒ½å½“åšå‚æ•°ä¼ äº†ã€‚æœ‰æ—¶å€™ä¼šç”¨contextæ¥æ”¾ä¸€äº›æœ¬æœåŠ¡çš„ä¸€äº›å…¨å±€ä¿¡æ¯ã€‚å¦‚æœåŠ¡åã€ä¸€äº›ç‰¹å¾å€¼ã€æœåŠ¡åº“å‚æ•°ç­‰ã€‚","like_count":0},{"had_liked":false,"id":292806,"user_name":"moonfox","can_delete":false,"product_type":"c1","uid":1526355,"ip_address":"","ucode":"902BFF40EFA9FA","user_header":"https://static001.geekbang.org/account/avatar/00/17/4a/53/063f9d17.jpg","comment_is_top":false,"comment_ctime":1620985541,"is_pvip":false,"replies":[{"id":"106007","content":"æ˜¯çš„ï¼Œæºç å‰æ— ç§˜å¯†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1620990318,"ip_address":"","comment_id":292806,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1620985541","product_id":100013101,"comment_content":"å»ºè®®æ‰“å¼€æºç æ–‡ä»¶ï¼Œä¸€è¾¹é˜…è¯»ï¼Œä¸€è¾¹çœ‹æºç æ–‡ä»¶ï¼Œåˆ©äºç†è§£","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519963,"discussion_content":"æ˜¯çš„ï¼Œæºç å‰æ— ç§˜å¯†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620990318,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":230574,"user_name":"www","can_delete":false,"product_type":"c1","uid":1898338,"ip_address":"","ucode":"ADC9BC655EA16C","user_header":"https://static001.geekbang.org/account/avatar/00/1c/f7/62/947004d0.jpg","comment_is_top":false,"comment_ctime":1593421738,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593421738","product_id":100013101,"comment_content":"çœ‹åˆ°demo68ä»£ç ä¸­ï¼ŒcancelFuncç›´æ¥åœ¨goç¨‹é‡Œï¼Œåˆæƒ³èµ·äº†å‡½æ•°æ˜¯ç¬¬ä¸€å…¬æ°‘","like_count":0},{"had_liked":false,"id":205960,"user_name":"ä¼ è¯´ä¸­çš„æˆå¤§å¤§","can_delete":false,"product_type":"c1","uid":1236766,"ip_address":"","ucode":"103543D6E706BF","user_header":"https://static001.geekbang.org/account/avatar/00/12/df/1e/cea897e8.jpg","comment_is_top":false,"comment_ctime":1586763773,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1586763773","product_id":100013101,"comment_content":"çœ‹äº†ä¸€ä¸‹ç”»çš„æ ‘  æˆ‘è§‰å¾—åº”è¯¥æ˜¯å¹¿åº¦ä¼˜å…ˆçš„  å› ä¸ºå¹¿åº¦ä¼˜å…ˆéå†å±‚æ•°æ˜¯å°äºç­‰äºæ·±åº¦ä¼˜å…ˆçš„","like_count":0,"discussions":[{"author":{"id":1351076,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9d/a4/e481ae48.jpg","nickname":"lesserror","note":"","ucode":"25A54D1165FCF6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389621,"discussion_content":"å¾ˆé—æ†¾ï¼Œé”™äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629360550,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":166894,"user_name":"ç–¯ç´","can_delete":false,"product_type":"c1","uid":1099379,"ip_address":"","ucode":"82ACAA4A27753D","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/73/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1577626875,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1577626875","product_id":100013101,"comment_content":"ç”¨æ–‡å­—å°†æŠ€æœ¯çŸ¥è¯†è¡¨è¾¾æ¸…æ™°æ˜¯ä¸€ä»¶å¾ˆä¸å®¹æ˜“çš„äº‹ï¼Œæˆ‘æ¥è§¦è¿‡ä¸€ç‚¹WithCancelçš„ç”¨æ³•ï¼Œè¾¹çœ‹è€å¸ˆçš„æ–‡ç« è¾¹åŠ¨æ‰‹å®è·µä¸€ä¸‹WithTimeoutå’ŒWithDeadlineè¿™ä¸¤ä¸ªå’ŒWithCancelç›¸å…³çš„Contextå‡½æ•°ï¼Œæ„Ÿè§‰é˜è¿°å¾—å¾ˆæ¸…æ™°ã€‚ä½†æ˜¯WithValueå®Œå…¨æ²¡ç”¨è¿‡ï¼Œç¡®å®çœ‹èµ·æ¥å°±ä¸å¤ªæ˜ç™½ï¼Œä½†æ˜¯æ•²ä¸€édemo69ä»¥åå†çœ‹è€å¸ˆçš„è®²è¿°å°±å¾ˆæ¸…æ¥šäº†ã€‚","like_count":0},{"had_liked":false,"id":156148,"user_name":"è™¢åœ‹æŠ€é†¬","can_delete":false,"product_type":"c1","uid":1056807,"ip_address":"","ucode":"5A192262AA037E","user_header":"https://static001.geekbang.org/account/avatar/00/10/20/27/a6932fbe.jpg","comment_is_top":false,"comment_ctime":1574824748,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574824748","product_id":100013101,"comment_content":"å¯¹ç€æºç è¿›è¡ŒäºŒåˆ·","like_count":0},{"had_liked":false,"id":110148,"user_name":"åç«¯è¿›é˜¶","can_delete":false,"product_type":"c1","uid":1125656,"ip_address":"","ucode":"480F48F5378307","user_header":"https://static001.geekbang.org/account/avatar/00/11/2d/18/918eaecf.jpg","comment_is_top":false,"comment_ctime":1562201822,"is_pvip":false,"replies":[{"id":"40036","content":"å¦‚æœæˆ‘æ²¡è®°é”™çš„è¯ï¼Œè¿˜æ˜¯ä¸ä¸€æ ·çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"éƒæ—","uid":"1026643","ctime":1562238961,"ip_address":"","comment_id":110148,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562201822","product_id":100013101,"comment_content":"contextåŒ…å…¶å®ç›¸å½“äºJavaçš„åŒæ­¥å·¥å…·ç±»ï¼Œæ¯”å¦‚cancelFuncå…¶å®å°±æ˜¯ä¸€ä¸ªcountDownLatch","like_count":0,"discussions":[{"author":{"id":1026643,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/aa/53/768aec0a.jpg","nickname":"éƒæ—","note":"","ucode":"F66BA62BA56FFA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":456744,"discussion_content":"å¦‚æœæˆ‘æ²¡è®°é”™çš„è¯ï¼Œè¿˜æ˜¯ä¸ä¸€æ ·çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562238961,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":107562,"user_name":"ç³Šæç³Šæ¶‚","can_delete":false,"product_type":"c1","uid":1197625,"ip_address":"","ucode":"E0F6064CBA32B1","user_header":"https://static001.geekbang.org/account/avatar/00/12/46/39/e545c885.jpg","comment_is_top":false,"comment_ctime":1561557756,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1561557756","product_id":100013101,"comment_content":"mark","like_count":0},{"had_liked":false,"id":103457,"user_name":"benying","can_delete":false,"product_type":"c1","uid":1247522,"ip_address":"","ucode":"DEBAB485F381CC","user_header":"https://static001.geekbang.org/account/avatar/00/13/09/22/22c0c4fa.jpg","comment_is_top":false,"comment_ctime":1560439651,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1560439651","product_id":100013101,"comment_content":"æ‰“å¡,è°¢è°¢","like_count":0},{"had_liked":false,"id":86579,"user_name":"å¤©å¤©å‘ä¸Š","can_delete":false,"product_type":"c1","uid":1168220,"ip_address":"","ucode":"DF08B67EAD61E7","user_header":"https://static001.geekbang.org/account/avatar/00/11/d3/5c/796962de.jpg","comment_is_top":false,"comment_ctime":1555402950,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555402950","product_id":100013101,"comment_content":"èƒ½è®²å¾—é€šä¿—ä¸€ç‚¹å°±å¥½äº†ï¼Œæ„Ÿè§‰è¢«å¸¦æ²Ÿé‡Œè½¬äº†å¥½ä¹…å‡ºä¸æ¥äº†","like_count":0},{"had_liked":false,"id":42959,"user_name":"ofuxas3","can_delete":false,"product_type":"c1","uid":1231626,"ip_address":"","ucode":"13934EB7B5092C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/HjzM5h6pLub9UG85tIQa8oVlKJTROYx4nM3VTUW14xBVQ2PeibwmoALmfQqmt0zbqpgVh5iagTCicEicUB4mLjWveA/132","comment_is_top":false,"comment_ctime":1543119377,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543119377","product_id":100013101,"comment_content":"æ›´å…·ä½“åœ°è¯´ï¼ŒContextç±»å‹å¯ä»¥æä¾›ä¸€ç±»ä»£è¡¨ä¸Šä¸‹æ–‡çš„å€¼ã€‚æ­¤... <br>åé¢åº”è¯¥æ˜¯ goruntime æ‹¼é”™äº†","like_count":0},{"had_liked":false,"id":35081,"user_name":"torwang","can_delete":false,"product_type":"c1","uid":1254218,"ip_address":"","ucode":"C91223AEC0C69F","user_header":"https://static001.geekbang.org/account/avatar/00/13/23/4a/603a4e4b.jpg","comment_is_top":false,"comment_ctime":1540396808,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1540396808","product_id":100013101,"comment_content":"é€’å½’æ·±åº¦å§  æ€è€ƒé¢˜ æœ‰å“ªäº›å®é™…åº”ç”¨åœºæ™¯","like_count":0},{"had_liked":false,"id":35080,"user_name":"torwang","can_delete":false,"product_type":"c1","uid":1254218,"ip_address":"","ucode":"C91223AEC0C69F","user_header":"https://static001.geekbang.org/account/avatar/00/13/23/4a/603a4e4b.jpg","comment_is_top":false,"comment_ctime":1540396744,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1540396744","product_id":100013101,"comment_content":"é€’å½’æ·±åº¦å§   æ€è€ƒé¢˜  æœ‰å“ªäº›å®é™…åº”ç”¨åœºæ™¯","like_count":0}]}