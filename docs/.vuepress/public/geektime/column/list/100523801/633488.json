{"id":633488,"title":"16ï½œBit libraryï¼ˆä¸€ï¼‰ï¼šå¦‚ä½•åˆ©ç”¨æ–°bitæ“ä½œåº“é‡Šæ”¾ç¼–ç¨‹ç”Ÿäº§åŠ›ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å¢èª‰å£°ã€‚</p><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒC++ç»§æ‰¿äº†Cè¯­è¨€æ‰€æœ‰çš„åº•å±‚æ“ä½œèƒ½åŠ›ï¼Œå…¶ä¸­æœ€é‡è¦çš„ä¸¤ä¸ªç‰¹æ€§å°±æ˜¯æŒ‡é’ˆå’Œä½æ“ä½œã€‚å¯¹äºæŒ‡é’ˆï¼Œç°ä»£C++æ ‡å‡†å·²ç»é€šè¿‡æ™ºèƒ½æŒ‡é’ˆæå‡ºäº†è¾ƒå¥½çš„è§£å†³æ–¹æ¡ˆã€‚</p><p>ä½†æ˜¯åœ¨C++20ä¹‹å‰ï¼ŒC++çš„ä½æ“ä½œæ”¯æŒè¿˜æ˜¯å¾ˆâ€œåŸºç¡€â€çš„ã€‚å®ƒç¼ºä¹å®‰å…¨æ€§ï¼Œè€Œä¸”ä¸å¤Ÿçµæ´»ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°±å›´ç»•C++20å¯¹ä½æ“ä½œèƒ½åŠ›çš„æ‰©å±•è¿™ä¸ªè¯é¢˜ï¼Œè®¨è®ºä¸€ä¸‹å…¨æ–°çš„Bit libraryã€‚</p><p>å¥½ï¼Œè¯ä¸å¤šè¯´ï¼Œå°±è®©æˆ‘ä»¬ä»åŸºæœ¬çš„C++ä½æ“ä½œå¼€å§‹è®²èµ·ï¼ˆè¯¾ç¨‹é…å¥—ä»£ç å¯ä»¥ä»<a href=\"https://github.com/samblg/cpp20-plus-indepth\">è¿™é‡Œ</a>è·å–ï¼‰ã€‚</p><h2>C++ä½æ“ä½œæŠ€æœ¯ä¸ä¸è¶³</h2><p>C++æä¾›çš„åŸºç¡€ä½æ“ä½œæŠ€æœ¯ä¸Cè¯­è¨€ä¸€è„‰ç›¸æ‰¿ï¼Œä¸»è¦é€šè¿‡ä½æ“ä½œç¬¦å¯¹æ•´æ•°è¿›è¡Œä½æ“ä½œã€‚æˆ‘å¯¹è¿™äº›åŸºæœ¬æ“ä½œåšäº†ä¸€ä¸ªæ€»ç»“ï¼Œä½ å¯ä»¥å‚è€ƒåé¢çš„è¡¨æ ¼å›é¡¾ä¸€ä¸‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/c9/50/c9d77bda455c87a90ce43e14e77af950.jpg?wh=2543x1437\" alt=\"\"></p><p>ç›¸æ¯”Cè¯­è¨€ï¼ŒC++ä¸€ç›´ä¸ºCçš„åº•å±‚èƒ½åŠ›æä¾›ä¸€äº›é«˜å±‚æ¬¡çš„å®‰å…¨åŒ–åŒ…è£…ï¼Œæ¯”å¦‚ä¸ºäº†è§£å†³è£¸æŒ‡é’ˆçš„å„ç§å®‰å…¨ç¼ºé™·ï¼Œæå‡ºäº†å„ç±»æ™ºèƒ½æŒ‡é’ˆã€‚</p><p>åŸºäºè¿™ç§æ€è·¯ï¼ŒC++ä¹Ÿé€šè¿‡æ ‡å‡†åº“æä¾›äº†bitsetï¼Œå¯¹äºŒè¿›åˆ¶ä½ä¸²è¿›è¡ŒåŒ…è£…ï¼Œå¯ä»¥åœ¨æ•´æ•°å’Œbitsetä»¥åŠå…¶å­—ç¬¦ä¸²è¡¨ç¤ºä¹‹é—´è¿›è¡Œè½¬æ¢ï¼Œå¹¶æ”¯æŒè¡¨æ ¼ä¸­çš„å‡ ä¸ªåŸºç¡€çš„ä½æ“ä½œç¬¦ã€‚<br>\nä½†åœ¨C++20ä¹‹å‰ï¼ŒC++çš„ä½æ“ä½œæ”¯æŒè¿˜æ˜¯å¾ˆâ€œåŸºç¡€â€çš„ï¼Œæˆ‘ä»¬é‡ç‚¹è®¨è®ºå‡ ä¸ªæ¯”è¾ƒæ˜æ˜¾çš„é—®é¢˜ã€‚</p><p><strong>é¦–å…ˆï¼Œæ²¡æœ‰æä¾›å­—èŠ‚åºçš„æ£€æµ‹å’Œè½¬æ¢èƒ½åŠ›</strong>ã€‚åŸºäºä½è¿›è¡ŒäºŒè¿›åˆ¶æ•°æ®è§£æçš„æ—¶å€™ï¼Œæœ€å¤§çš„é—®é¢˜å°±æ˜¯ä¸åŒCPUçš„å¤§å°ç«¯è®¾è®¡ï¼ˆæ¯”å¦‚ x86 ä½“ç³»ç»“æ„æ˜¯å°ç«¯å­—èŠ‚åºï¼Œarm æ”¯æŒé‡‡ç”¨å¤§å°ç«¯å­—èŠ‚åºä»»é€‰å…¶ä¸€ï¼‰ã€‚</p><!-- [[[read_end]]] --><p>è¿™å°±å¯¼è‡´åœ¨ä¸åŒä½“ç³»ç»“æ„ä¸‹ï¼Œç¼–å†™ä½æ“ä½œå¯èƒ½äº§ç”Ÿå„ç§å…¼å®¹æ€§é—®é¢˜ã€‚C++ä¸ä»…æ²¡æœ‰æä¾›ç¼–è¯‘ç›®æ ‡æ¶æ„çš„å­—èŠ‚åºæ£€æµ‹èƒ½åŠ›ï¼Œä¹Ÿæ²¡æœ‰æä¾›ä¸åŒå­—èŠ‚åºä¹‹é—´çš„è½¬æ¢èƒ½åŠ›ï¼Œæ‰€ä»¥è¿™äº›åŸºç¡€è®¾æ–½æˆ‘ä»¬åªèƒ½è‡ªè¡Œå®ç°ã€‚<br>\n<strong>å…¶æ¬¡ï¼Œç¼ºä¹å®‰å…¨çš„å¼ºåˆ¶ç±»å‹è½¬æ¢æ‰‹æ®µ</strong>ã€‚ä¸€äº›åœºæ™¯ï¼Œæ¯”å¦‚å¯¹æµ®ç‚¹ç±»å‹çš„æ•°å€¼è¿›è¡Œä½æ“ä½œéœ€è¦å…ˆå°†æµ®ç‚¹ç±»å‹è½¬æ¢æˆå¯¹åº”å®½åº¦çš„æ— ç¬¦å·æ•´æ•°ï¼Œå°±ç»å¸¸éœ€è¦å°†ä¸€äº›æ•°æ®å¼ºåˆ¶è½¬æ¢ä¸ºå¦ä¸€ä¸ªç±»å‹ï¼Œè€Œä¸æ”¹å˜å…¶äºŒè¿›åˆ¶ä½çš„å€¼ã€‚</p><p>C++ä»…æä¾›äº†reinterpret_castï¼Œæ‰§è¡ŒæŒ‡é’ˆç±»å‹çš„å¼ºåˆ¶è½¬æ¢ï¼Œä½†æ²¡æœ‰æä¾›å€¼çš„å¼ºåˆ¶ç±»å‹è½¬æ¢èƒ½åŠ›ã€‚è™½ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡memcpyç­‰æ‰‹æ®µå®ç°ï¼Œä½†è¿™æ ·ä¹Ÿä¸å¤Ÿå®‰å…¨â€”â€”ç¼–è¯‘å™¨æ— æ³•æ£€æµ‹åˆ°å¯èƒ½å‘ç”Ÿçš„ä»»ä½•é—®é¢˜ã€‚</p><p><strong>æœ€åï¼Œæ˜¯ç§»ä½æ“ä½œé—®é¢˜</strong>ã€‚C++æŠŠç§»ä½çš„å…·ä½“å«ä¹‰äº¤ç»™äº†å…·ä½“å®ç°ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯ç§»ä½æ“ä½œåˆ†ä¸ºâ€œç®—æœ¯ç§»ä½â€å’Œâ€œé€»è¾‘ç§»ä½â€ï¼Œç®—æœ¯ç§»ä½éœ€è¦è€ƒè™‘åˆ°æœ‰ç¬¦å·æ•´æ•°çš„ç¬¦å·é—®é¢˜ï¼Œé€»è¾‘ç§»ä½æ˜¯ç›´æ¥è¡¥é›¶ï¼ŒC++å¹¶æ²¡æœ‰å®šä¹‰æœ‰ç¬¦å·æ•´æ•°çš„å…·ä½“å®ç°æ–¹å¼ï¼Œé™¤äº†æœ‰ç¬¦å·æ•´æ•°çš„ç§»ä½é—®é¢˜ï¼ŒC++å’ŒCä¸€æ ·ï¼Œå¹¶æ²¡æœ‰æä¾›å¾ªç¯ç§»ä½çš„æ‰‹æ®µã€‚</p><h2>C++20ä½æ“ä½œåº“</h2><p>æ—¢ç„¶ä½æ“ä½œçš„æ½œåœ¨é—®é¢˜è¿™ä¹ˆå¤šï¼ŒC++æ˜¯æ€ä¹ˆè§£å†³çš„å‘¢ï¼Ÿ</p><p>åœ¨C++20ï¼ŒC++æ ‡å‡†ç»ˆäºå¼€å§‹æ€è€ƒè§£å†³è¿™äº›åŸºæœ¬çš„ä½æ“ä½œé—®é¢˜äº†ã€‚ä¸ºæ­¤æä¾›äº†ä½æ“ä½œåº“ï¼Œå…·ä½“å®ç°åœ¨&lt;bit&gt;å¤´æ–‡ä»¶ä¸­ï¼Œæˆ‘ä»¬åˆ†åˆ«æ¥çœ‹çœ‹ã€‚</p><h3>å­—èŠ‚åºå¤„ç†</h3><p>C++20æä¾›äº†æšä¸¾ç±»endianï¼ˆè¿™æ—©å°±è¯¥æ ‡å‡†åŒ–äº†å˜›ğŸ˜„ï¼‰ï¼Œç”¨æ¥å®šä¹‰å­—èŠ‚åºçš„å¤§å°ç«¯ã€‚å…·ä½“å®šä¹‰å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-c++\">enum class endian {\n&nbsp;&nbsp;&nbsp; little,\n&nbsp;&nbsp;&nbsp; big,\n&nbsp;&nbsp;&nbsp; native // = little/big\n};\n</code></pre><p>è¿™é‡Œç€é‡å¼ºè°ƒendian::nativeè¿™ä¸€æšä¸¾å€¼ï¼Œå®ƒç”±ç¼–è¯‘å™¨æ ¹æ®ç¼–è¯‘ç›®æ ‡ä½“ç³»ç»“æ„è‡ªåŠ¨ç¡®å®šâ€”â€”è¿™å¯å¤ªæ£’äº†ï¼</p><p>æˆ‘ä»¬ç»“åˆå®é™…ä¾‹å­æ¥ä½“ä¼šä¸€ä¸‹ç”¨æ³•ã€‚</p><pre><code class=\"language-c++\">#include &lt;iostream&gt;\n#include &lt;bit&gt;\n#include &lt;cstdint&gt;\n#include &lt;concepts&gt;\n&nbsp;\ntemplate &lt;std::integral T&gt;\nT byteswap(T src) {\n&nbsp;&nbsp;&nbsp; T dest = 0;\n&nbsp;\n&nbsp;&nbsp;&nbsp; for (uint8_t* pSrcByte = reinterpret_cast&lt;uint8_t*&gt;(&amp;src),\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *pDestByte = reinterpret_cast&lt;uint8_t*&gt;(&amp;dest) + sizeof(T) - 1;\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; pSrcByte != reinterpret_cast&lt;uint8_t*&gt;(&amp;src) + sizeof(T);\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ++pSrcByte, --pDestByte) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *pDestByte = *pSrcByte;\n&nbsp;&nbsp;&nbsp; }\n&nbsp;\n&nbsp;&nbsp;&nbsp; return dest;\n}\n&nbsp;\ntemplate &lt;std::integral T, std::endian ByteOrder = std::endian::native&gt;\n&nbsp;&nbsp;&nbsp; requires (ByteOrder == std::endian::little)\nT consumeBigEndian(T src) {\n&nbsp;&nbsp;&nbsp; return byteswap(src);\n}\n&nbsp;\ntemplate &lt;std::integral T, std::endian ByteOrder = std::endian::native&gt;\n&nbsp;&nbsp;&nbsp; requires (ByteOrder == std::endian::big)\nT consumeBigEndian(T src) {\n&nbsp;&nbsp;&nbsp; return src;\n}\n&nbsp;\nint main() {\n&nbsp;&nbsp;&nbsp; uint8_t networkBuffer[] {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 1, 2\n&nbsp;&nbsp;&nbsp; };\n&nbsp;\n&nbsp;&nbsp;&nbsp; // å°†ä»ç½‘ç»œæ•°æ®æµä¸­è·å–çš„å€¼ç›´æ¥è½¬æ¢æˆuint16_t\n&nbsp;&nbsp;&nbsp; uint16_t networkValue = *(reinterpret_cast&lt;uint16_t*&gt;(networkBuffer));\n&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; \"Original value: \" &lt;&lt; networkValue &lt;&lt; std::endl;\n&nbsp;\n&nbsp;&nbsp;&nbsp; // æ— è®ºå¦‚ä½•éƒ½è½¬æ¢å­—èŠ‚åº\n&nbsp;&nbsp;&nbsp; uint16_t swappedValue = byteswap(networkValue);\n&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; \"Swaped value: \" &lt;&lt; swappedValue &lt;&lt; std::endl;\n&nbsp;\n&nbsp;&nbsp;&nbsp; // ä»…å¯¹å­—èŠ‚åºä¸ºå¤§ç«¯çš„å¹³å°è½¬æ¢å­—èŠ‚åº\n&nbsp;&nbsp;&nbsp; uint16_t checkedValue = consumeBigEndian(networkValue);\n&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; \"Checked value: \" &lt;&lt; checkedValue &lt;&lt; std::endl;\n&nbsp;\n&nbsp;&nbsp;&nbsp; return 0;\n}\n</code></pre><p>è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯æ£€æµ‹ç›®æ ‡å¹³å°çš„å­—èŠ‚åºï¼Œå¹¶å°†ä¸€ä¸ªå¤§ç«¯æ•°æ®è½¬æ¢æˆå°ç«¯æ•°æ®ã€‚å¦‚æœç›®æ ‡å¹³å°æœ¬èº«å­—èŠ‚åºå°±æ˜¯å¤§ç«¯ï¼Œé‚£ä¹ˆä»€ä¹ˆéƒ½ä¸ä¼šæ‰§è¡Œã€‚</p><p>C++23æä¾›äº†byteswapå¸®åŠ©æˆ‘ä»¬æ‰§è¡Œå­—èŠ‚åºè½¬æ¢ï¼Œä½†C++20æ²¡æœ‰æä¾›è¯¥ç‰¹æ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬åªèƒ½è‡ªå·±å®ç°ä¸€ä¸ªç‰ˆæœ¬ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/b3/63/b3c2fcecb1a7b9a5e5bc5a1181858963.jpg?wh=2600x1469\" alt=\"\"></p><p>è¿™æ®µä»£ç å®šä¹‰äº†ä¸¤ä¸ªç‰ˆæœ¬çš„consumeBigEndianï¼Œé€šè¿‡requiresåœ¨ç¼–è¯‘æ—¶æ£€æµ‹std::endian::nativeæ˜¯å¦ä¸ºstd::endian::littleï¼Œå¦‚æœæ˜¯å°±ä¼šé€šè¿‡byteswapè½¬æ¢å­—èŠ‚åºï¼Œå¦åˆ™è¿”å›åŸå§‹å€¼ã€‚</p><h3>å¼ºåˆ¶ç±»å‹è½¬æ¢</h3><p>äº‹å®ä¸Šï¼ŒCè¯­è¨€æä¾›çš„å¼ºåˆ¶ç±»å‹è½¬æ¢æœ‰å¾ˆå¤šæ½œåœ¨çš„ç±»å‹å®‰å…¨é—®é¢˜ï¼Œä¸ºäº†é¿å…å¤§å®¶ä½¿ç”¨Cé£æ ¼çš„å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼ŒC++æä¾›äº†static_castã€const_castå’Œreinterpret_castï¼Œä¸ºä¸åŒåœºæ™¯çš„ç±»å‹è½¬æ¢æœåŠ¡ã€‚</p><p>è¿™äº›ç±»å‹è½¬æ¢ç¬¦éƒ½æœ‰è‡ªå·±çš„çº¦æŸä¸ç±»å‹å®‰å…¨æ£€æµ‹ï¼Œè¿«ä½¿å¼€å‘è€…åœ¨è¿›è¡Œç±»å‹è½¬æ¢æ—¶ï¼Œè¦å…ˆå¼„æ¸…æ¥šè‡ªå·±çœŸçš„éœ€è¦å“ªç§è½¬æ¢ã€‚ä½†æ˜¯ï¼Œå®ƒä»¬éƒ½è§£å†³ä¸äº†ä¸€ä¸ªå¸¸è§çš„åœºæ™¯â€”â€”å°†ä¸€ä¸ªå€¼è½¬æ¢æˆäºŒè¿›åˆ¶ä½æ•°ç›¸åŒçš„å¦ä¸€ä¸ªå€¼ã€‚</p><p>ä¸ºæ­¤ï¼ŒC++20é€šè¿‡&lt;bit&gt;å¤´æ–‡ä»¶æä¾›äº†bit_castè¿™ä¸ªå‡½æ•°ã€‚åé¢æ˜¯ä¸€æ®µç¤ºä¾‹ä»£ç ã€‚</p><pre><code class=\"language-c++\">#include &lt;iostream&gt;\n#include &lt;bit&gt;\n#include &lt;cstdint&gt;\n&nbsp;\nint main() {\n&nbsp;&nbsp;&nbsp; float f32v = 784.513f;\n&nbsp;&nbsp;&nbsp; uint32_t u32v = std::bit_cast&lt;uint32_t&gt;(f32v);\n&nbsp;\n&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; \"f32v: \" &lt;&lt; f32v &lt;&lt; std::endl;\n&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; \"u32v: \" &lt;&lt; u32v &lt;&lt; std::endl;\n&nbsp;\n&nbsp;&nbsp;&nbsp; double f64v = 1123.11f;\n&nbsp;&nbsp;&nbsp; uint64_t u64v = std::bit_cast&lt;uint64_t&gt;(f64v);\n&nbsp;\n&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; \"f64v: \" &lt;&lt; f64v &lt;&lt; std::endl;\n&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; \"u64v: \" &lt;&lt; u64v &lt;&lt; std::endl;\n&nbsp;\n&nbsp;&nbsp;&nbsp; // ç¼–è¯‘é”™è¯¯\n&nbsp;&nbsp;&nbsp; uint16_t u64v = std::bit_cast&lt;uint16_t&gt;(f64v);\n&nbsp;\n&nbsp;&nbsp;&nbsp; return 0;\n}\n</code></pre><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡bit_castå°†ä¸€ä¸ªfloatç±»å‹å˜é‡è½¬æ¢ä¸ºuint32_tï¼Œå¹¶å°†ä¸€ä¸ªuint64_tç±»å‹å˜é‡è½¬æ¢ä¸ºdoubleï¼Œä½†æ˜¯æ— æ³•å°†floatç±»å‹è½¬æ¢ä¸ºuint16_tã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¤šäº†ä¸€ä¸ªç±»å‹è½¬æ¢å·¥å…·ï¼Œè¿˜å¯ä»¥ç¡®ä¿ç‰¹å®šçš„ç±»å‹å®‰å…¨ï¼Œé™ä½æ»¥ç”¨Cç±»å‹è½¬æ¢å¸¦æ¥çš„é£é™©ã€‚</p><h3>å¾ªç¯ç§»ä½</h3><p>å¾ªç¯ç§»ä½æ˜¯å¦ä¸€ä¸ªå¸¸è§éœ€æ±‚ï¼Œå¾ªç¯ç§»ä½ä¸æ™®é€šç§»ä½å·®åˆ«åœ¨äºç§»ä½åçš„è¡¥ä½è§„åˆ™ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸‹å›¾æ˜¯å¯¹8ä½çš„äºŒè¿›åˆ¶ä¸²ï¼Œåˆ†åˆ«å¾ªç¯å·¦ç§»ä¸é€»è¾‘å·¦ç§»2ä½çš„ç»“æœã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/c3/2f/c3693e933b7eb633ca54fe892d51e72f.jpg?wh=3958x2922\" alt=\"\"></p><p>é€»è¾‘å·¦ç§»ä¼šå¯¹â€œç”±ç§»åŠ¨äº§ç”Ÿâ€çš„ä½ç›´æ¥è¡¥é›¶ï¼Œè€Œå¾ªç¯å·¦ç§»åˆ™ä¼šå°†ç§»å‡ºçš„ä½ä¸²ï¼Œç›´æ¥å¾ªç¯ç§»åŠ¨åˆ°æ–°å€¼çš„æœ«å°¾ï¼Œå½¢æˆä¸€ä¸ªå¾ªç¯ã€‚</p><p>C++20æä¾›äº†ç”¨äºå¾ªç¯å·¦ç§»çš„std::rotlï¼Œè¿˜æœ‰ç”¨äºå¾ªç¯å³ç§»çš„std::rotrã€‚åé¢æ˜¯ç¤ºä¾‹ä»£ç ã€‚</p><pre><code class=\"language-c++\">#include &lt;iostream&gt;\n#include &lt;bit&gt;\n#include &lt;bitset&gt;\n#include &lt;cstdint&gt;\n#include &lt;iomanip&gt;\n&nbsp;\nint main() {\n&nbsp;&nbsp;&nbsp; uint8_t value = 0b01011101;\n&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; std::setw(16) &lt;&lt; std::left &lt;&lt; \"value\" &lt;&lt; \" = \" &lt;&lt; std::bitset&lt;8&gt;(value) &lt;&lt; std::endl;\n&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; std::setw(16) &lt;&lt; std::left &lt;&lt; \"rotl\" &lt;&lt; \" = \" &lt;&lt; std::bitset&lt;8&gt;(std::rotl(value, 2)) &lt;&lt; std::endl;\n&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; std::setw(16) &lt;&lt; std::left &lt;&lt; \"left logical\" &lt;&lt; \" = \" &lt;&lt; std::bitset&lt;8&gt;(static_cast&lt;uint8_t&gt;(value &lt;&lt; 2)) &lt;&lt; std::endl;\n&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; std::setw(16) &lt;&lt; std::left &lt;&lt; \"rotr\" &lt;&lt; \" = \" &lt;&lt; std::bitset&lt;8&gt;(std::rotr(value, 2)) &lt;&lt; std::endl;\n&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; std::setw(16) &lt;&lt; std::left &lt;&lt; \"right logical\" &lt;&lt; \" = \" &lt;&lt; std::bitset&lt;8&gt;(static_cast&lt;uint8_t&gt;(value &gt;&gt; 2)) &lt;&lt; std::endl;\n&nbsp;\n&nbsp;&nbsp;&nbsp; return 0;\n}\n</code></pre><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬è°ƒç”¨äº†rotlå’Œrotræ‰§è¡Œå¾ªç¯ç§»ä½ï¼ŒåŒæ—¶è°ƒç”¨äº†&lt;&lt;å’Œ&gt;&gt;ã€‚æˆ‘ä»¬å¯ä»¥ä»æ‰§è¡Œç»“æœä¸­çœ‹å‡ºä¸åŒçš„ç§»ä½æ–¹å¼ä¹‹é—´çš„å·®åˆ«ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/06/c9/063a84b42afb2c1b85b1e545b0003dc9.jpg?wh=1043x193\" alt=\"\"></p><h3>å…¶ä»–ä½è¿ç®—</h3><p>é™¤äº†ä¸Šè¿°ä½æ“ä½œæ”¯æŒï¼ŒC++20è¿˜æä¾›äº†ä¸€äº›å…¶ä»–ç®€å•çš„ä½æ“ä½œå‡½æ•°ï¼Œæˆ‘ç”¨è¡¨æ ¼è¿›è¡Œäº†æ€»ç»“ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/4a/64/4a70454255216250393a995e3500d164.jpg?wh=2656x1682\" alt=\"\"></p><p>æˆ‘ä¸ºä½ ç®€å•æ¼”ç¤ºä¸€ä¸‹è¿™äº›å‡½æ•°çš„ç”¨æ³•ï¼Œä»£ç æ˜¯åé¢è¿™æ ·ã€‚</p><pre><code class=\"language-c++\">#include &lt;iostream&gt;\n#include &lt;bit&gt;\n#include &lt;bitset&gt;\n#include &lt;cstdint&gt;\n#include &lt;format&gt;\n&nbsp;\n// æµ‹è¯•has_single_bit\nvoid testHasSingleBit() {\n&nbsp;&nbsp;&nbsp; for (uint32_t value = 0; value &lt; 8u; ++value) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; std::format(\"has_single_bit({}): {}\",\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::bitset&lt;3&gt;(value).to_string(),\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::has_single_bit(value)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ) &lt;&lt; std::endl;\n&nbsp;&nbsp;&nbsp; }\n}\n&nbsp;\n// æµ‹è¯•bit_ceilä¸bit_floor\nvoid testCeilFloor() {\n&nbsp;&nbsp;&nbsp; for (uint32_t value = 0; value &lt; 8u; ++value) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; std::format(\"ceil({}): {}\",\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::bitset&lt;4&gt;(value).to_string(),\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::bitset&lt;4&gt;(std::ceil(value)).to_string()\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ) &lt;&lt; std::endl;\n&nbsp;&nbsp;&nbsp; }\n&nbsp;\n&nbsp;&nbsp;&nbsp; for (uint32_t value = 0; value &lt; 8u; ++value) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; std::format(\"ceil({}): {}\",\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::bitset&lt;4&gt;(value).to_string(),\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::bitset&lt;4&gt;(std::floor(value)).to_string()\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ) &lt;&lt; std::endl;\n&nbsp;&nbsp;&nbsp; }\n}\n&nbsp;\n// åˆ©ç”¨constexprå’Œbit_widthè‡ªåŠ¨è®¡ç®—bitsetçš„æ¨¡æ¿å‚æ•°\ntemplate &lt;std::uint64_t value&gt;\nstd::bitset&lt;std::bit_width(value)&gt; wbitset() {\n&nbsp;&nbsp;&nbsp; constexpr int bitWidth = std::bit_width(value);\n&nbsp;\n&nbsp;&nbsp;&nbsp; return std::bitset&lt;bitWidth&gt;(value);\n}\n&nbsp;\n// æµ‹è¯•bit_width\nvoid testBitWidth() {\n&nbsp;&nbsp;&nbsp; constexpr uint32_t value = 97u;\n&nbsp;&nbsp;&nbsp; constexpr uint32_t ceilValue = std::bit_ceil(value);\n&nbsp;&nbsp;&nbsp; constexpr uint32_t floorValue = std::bit_floor(value);\n&nbsp;\n&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; std::format(\"ceil({}): {}\\nfloor({}): {}\",\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::bitset&lt;std::bit_width(value)&gt;(value).to_string(),\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::bitset&lt;std::bit_width(ceilValue)&gt;(ceilValue).to_string(),\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wbitset&lt;value&gt;().to_string(),\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; wbitset&lt;floorValue&gt;().to_string()\n&nbsp;&nbsp;&nbsp; ) &lt;&lt; std::endl;\n&nbsp;&nbsp;&nbsp; \n}\n&nbsp;\n// æµ‹è¯•coutl_zero, countl_one, countr_zero, countr_one, popcount\nvoid testCounts() {\n&nbsp;&nbsp;&nbsp; for (const std::uint8_t value : { 0, 0b11111111, 0b11000000, 0b00000110 }) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; std::format(\"countl_zero({}) = {}\",\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::bitset&lt;8&gt;(value).to_string(),\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::countl_zero(value)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ) &lt;&lt; std::endl;\n&nbsp;&nbsp;&nbsp; }\n&nbsp;\n&nbsp;&nbsp;&nbsp; for (const std::uint8_t value : { 0, 0b11111111, 0b11000000, 0b00000110 }) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; std::format(\"countl_one({}) = {}\",\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::bitset&lt;8&gt;(value).to_string(),\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::countl_one(value)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ) &lt;&lt; std::endl;\n&nbsp;&nbsp;&nbsp; }\n&nbsp;\n&nbsp;&nbsp;&nbsp; for (const std::uint8_t value : { 0, 0b11111111, 0b11000000, 0b00000110 }) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; std::format(\"countr_zero({}) = {}\",\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::bitset&lt;8&gt;(value).to_string(),\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::countr_zero(value)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ) &lt;&lt; std::endl;\n&nbsp;&nbsp;&nbsp; }\n&nbsp;\n&nbsp;&nbsp;&nbsp; for (const std::uint8_t value : { 0, 0b11111111, 0b11000000, 0b00000111 }) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; std::format(\"countr_one({}) = {}\",\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::bitset&lt;8&gt;(value).to_string(),\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::countr_one(value)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ) &lt;&lt; std::endl;\n&nbsp;&nbsp;&nbsp; }\n&nbsp;\n&nbsp;&nbsp;&nbsp; for (const std::uint8_t value : { 0, 0b11111111, 0b11000000, 0b00000111 }) {\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::cout &lt;&lt; std::format(\"popcount({}) = {}\",\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::bitset&lt;8&gt;(value).to_string(),\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; std::popcount(value)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ) &lt;&lt; std::endl;\n&nbsp;&nbsp;&nbsp; }\n}\n&nbsp;\nint main() {\n&nbsp;&nbsp;&nbsp; testHasSingleBit();\n&nbsp;&nbsp;&nbsp; testCeilFloor();\n&nbsp;&nbsp;&nbsp; testBitWidth();\n&nbsp;&nbsp;&nbsp; testCounts();\n&nbsp;\n&nbsp;&nbsp;&nbsp; return 0;\n}\n</code></pre><p>è¿™äº›éƒ½æ˜¯ç®€å•çš„å‡½æ•°ç¤ºä¾‹ã€‚ä¸‹å›¾æ˜¯è¿è¡Œæ—¶è¾“å‡ºï¼Œä¾›ä½ å‚è€ƒã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/72/8e/7205f73090c39604bb2a9bab02405d8e.jpg?wh=964x926\" alt=\"\"></p><p>å…¶ä¸­ï¼Œ36-41è¡Œçš„wbitsetå‡½æ•°æ˜¯ä¸€ä¸ªæ¯”è¾ƒå·§å¦™çš„å®ç°ï¼Œæˆ‘ä»¬ä¸€èµ·åšä¸ªåˆ†æã€‚</p><p>bitsetç±»å‹å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå°†ä¸€ä¸ªæ•´æ•°è½¬æ¢ä¸ºäºŒè¿›åˆ¶ä¸²ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²ã€‚ä½†æ˜¯bitsetéœ€è¦é€šè¿‡æ¨¡æ¿å‚æ•°æŒ‡å®šä½ä¸²çš„ä½æ•°ã€‚å› æ­¤ï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦è‡ªå·±æ¥è®¡ç®—bitsetçš„ä½æ•°åˆ°åº•æ˜¯å¤šå°‘â€”â€”è¿™å¤ªéº»çƒ¦äº†ã€‚</p><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬ä½¿ç”¨std::bit_widthè®¡ç®—è¡¨ç¤ºæ¨¡æ¿å‚æ•°valueçš„æœ€å°ä½æ•°ã€‚ç”±äºbit_widthæ˜¯constexprå‡½æ•°ï¼Œå› æ­¤ï¼Œå¦‚æœå®ƒçš„å‚æ•°æ˜¯ç¼–è¯‘æ—¶å¸¸é‡ï¼Œé‚£ä¹ˆå°±èƒ½ç›´æ¥ç”¨åœ¨æ¨¡æ¿å‚æ•°é‡Œï¼è¿™æ ·å°±èƒ½ç¡®å®šbitsetçš„æœ€å°ä½æ•°äº†ã€‚</p><h2>æ€»ç»“</h2><p>C++20ä½œä¸ºä¸€ä¸ªé‡Œç¨‹ç¢‘å¼çš„é‡è¦æ ‡å‡†ï¼Œç»ˆäºå¼€å§‹è§£å†³åŸºæœ¬çš„ä½æ“ä½œé—®é¢˜ï¼Œè¿™å…¶ä¸­åŒ…æ‹¬ï¼š</p><p>1.å­—èŠ‚åºçš„æ£€æµ‹å’Œè½¬æ¢èƒ½åŠ›ã€‚<br>\n2.è¡¥å……å®Œå–„çš„å®‰å…¨çš„å¼ºåˆ¶ç±»å‹è½¬æ¢å·¥å…·ã€‚<br>\n3.å¢å¼ºçš„ç§»ä½æ“ä½œã€‚</p><p>è¿™äº›æ–°å·¥å…·ä¸ºæˆ‘ä»¬å®ç°ä½æ“ä½œæä¾›äº†æ›´åŠ å®Œå¤‡çš„æ”¯æŒã€‚åŒæ—¶ï¼Œä¹Ÿä¸ºå®ç°åºåˆ—åŒ–å’Œååºåˆ—åŒ–æä¾›äº†æ ‡å‡†åŒ–æ”¯æŒã€‚</p><p>é‚£ä¹ˆï¼Œæ–°çš„ä½æ“ä½œåº“åˆ°åº•æ˜¯æ€ä¹ˆå¸®åŠ©æˆ‘ä»¬é‡Šæ”¾ç¼–ç¨‹ç”Ÿäº§åŠ›çš„å‘¢ï¼ˆç‰¹åˆ«æ˜¯åœ¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ–¹é¢ï¼‰ï¼Ÿä¸‹ä¸€è®²ï¼Œæˆ‘å°†ä¸ºä½ å¨“å¨“é“æ¥â€¦</p><h2>è¯¾åæ€è€ƒ</h2><p>C++20ä½æ“ä½œåº“æä¾›çš„å‡½æ•°ï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿèƒ½è‡ªå·±å®ç°ï¼Œè¯·ä½ æ€è€ƒbit_widthå’Œbit_floorè¿™ä¸¤ä¸ªå‡½æ•°å¦‚ä½•å®ç°ï¼Œå¯ä»¥æŠŠä½ èƒ½æƒ³åˆ°çš„æœ€ç®€æ´çš„å®ç°æ–¹å¼è´´å‡ºæ¥ã€‚</p><p>æ¬¢è¿å°†ä½ çš„æ–¹æ¡ˆä¸å¤§å®¶ä¸€èµ·åˆ†äº«ã€‚æˆ‘ä»¬ä¸€åŒäº¤æµã€‚ä¸‹ä¸€è®²è§ï¼</p>","neighbors":{"left":{"article_title":"15ï½œFormattingå®æˆ˜ï¼šå¦‚ä½•æ„å»ºä¸€ä¸ªæ•°æ®æµå¤„ç†å®ä¾‹ï¼Ÿ","id":631248},"right":{"article_title":"17ï½œBit libraryï¼ˆäºŒï¼‰ï¼šå¦‚ä½•åˆ©ç”¨æ–°bitæ“ä½œåº“é‡Šæ”¾ç¼–ç¨‹ç”Ÿäº§åŠ›ï¼Ÿ","id":633504}},"comments":[{"had_liked":false,"id":386874,"user_name":"æäº‘é¾™","can_delete":false,"product_type":"c1","uid":3201926,"ip_address":"åŒ—äº¬","ucode":"785924B16BE788","user_header":"https://static001.geekbang.org/account/avatar/00/30/db/86/51ec4c41.jpg","comment_is_top":false,"comment_ctime":1705748148,"is_pvip":false,"replies":[{"id":141119,"content":"èµï½","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1006976,"ctime":1706699702,"ip_address":"ä¸Šæµ·","comment_id":386874,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100523801,"comment_content":"åˆ†äº«ä¸€ä¸‹æˆ‘çš„æ€è€ƒé¢˜ç­”æ¡ˆï¼š\nconstexpr size_t MyBitWidth(uint64_t value){\n    auto valueCeil = std::bit_ceil(value);\n    size_t i = 0;\n    for (; valueCeil &gt;&gt; i; ++i);\n\n    return i - 1;\n}\n\nconstexpr auto MyBitFloor(uint64_t value) {\n    return std::bit_ceil(value) &gt;&gt; 1;\n}","like_count":1,"discussions":[{"author":{"id":1006976,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5d/80/0c52be53.jpg","nickname":"å¢èª‰å£°","note":"","ucode":"93C5EFC39EB9C6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":636674,"discussion_content":"èµï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1706699702,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":369430,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"åŒ—äº¬","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1677544968,"is_pvip":false,"replies":[{"id":134889,"content":"1.\tå¯¹æµ®ç‚¹æ•°è¿›è¡Œç§»ä½æ“ä½œéœ€è¦æ˜¾ç¤ºè½¬æ¢ï¼Œè€Œä¸”ä¸èƒ½static_castï¼Œéœ€è¦å…ˆreinterpret_castå˜é‡æŒ‡é’ˆåˆ°æ•´å‹çš„æŒ‡é’ˆï¼Œç§»ä½åå†è½¬æ¢å›å»ï¼Œéå¸¸éº»çƒ¦ã€‚\n2.\tåŒºåˆ†åªèƒ½çœ‹ç¼–è¯‘å™¨æ˜¯å¦‚ä½•å®šä¹‰çš„ã€‚\n3.\tC++20å¹¶ä¸æ˜¯æ”¯æŒåºåˆ—åŒ–&#47;ååºåˆ—åŒ–ï¼Œè€Œæ˜¯åœ¨C++20ä¸­ï¼Œæ ‡å‡†åº“æä¾›äº†å¤§ç«¯å°ç«¯åˆ¤æ–­ã€äº¤æ¢å­—èŠ‚åºä¹‹ç±»çš„åŸºç¡€å·¥å…·æ”¯æŒï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºæ ‡å‡†åº“æ›´å®¹æ˜“æ„å»ºåºåˆ—åŒ–å’Œååºåˆ—åŒ–åº“ï¼ŒC++20ä¹‹å‰æ²¡æœ‰ç›¸å…³çš„ä»»ä½•æ”¯æŒã€‚\n","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1006976,"ctime":1678249463,"ip_address":"ä¸Šæµ·","comment_id":369430,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100523801,"comment_content":"è¯·æ•™è€å¸ˆå‡ ä¸ªé—®é¢˜ï¼š\nQ1ï¼šæµ®ç‚¹æ•°ä½æ“ä½œçš„è½¬æ¢æ˜¯éšå¼è½¬æ¢å—ï¼Ÿ\nC++20ä¹‹å‰çš„æµ®ç‚¹æ•°ä½æ“ä½œï¼Œéœ€è¦å…ˆè½¬æ¢ä¸ºæ•´æ•°ï¼Œè¿™ä¸ªè½¬æ¢æ˜¯éšå¼è½¬æ¢å—ï¼Ÿè¿˜æ˜¯éœ€è¦å†™ä»£ç å®ç°ï¼Ÿï¼ˆå¥½ä¹…ä¸ç”¨C++ï¼Œæœ‰ç‚¹å¿˜è®°äº†ï¼‰\nQ2ï¼šç§»ä½æ€ä¹ˆåŒºåˆ†ç®—æœ¯ç§»ä½å’Œé€»è¾‘ç§»ä½ï¼Ÿ\næ–‡ä¸­æåˆ°ï¼ŒC++20ä¹‹å‰çš„ç§»ä½æ“ä½œï¼Œç§»ä½çš„å…·ä½“å«ä¹‰äº¤ç»™äº†å…·ä½“å®ç°ã€‚é‚£ä¹ˆï¼Œå…·ä½“æ€ä¹ˆåŒºåˆ†æ˜¯ç®—æœ¯ç§»ä½è¿˜æ˜¯é€»è¾‘ç§»ä½ï¼Ÿ\nQ3ï¼šC++20æ”¯æŒåºåˆ—åŒ–å’Œååºåˆ—åŒ–å—ï¼Ÿ\næ–‡ä¸­æåˆ°â€œè¿™äº›æ–°å·¥å…·ä¸ºæˆ‘ä»¬å®ç°ä½æ“ä½œæä¾›äº†æ›´åŠ å®Œå¤‡çš„æ”¯æŒã€‚åŒæ—¶ï¼Œä¹Ÿä¸ºå®ç°åºåˆ—åŒ–å’Œååºåˆ—åŒ–æä¾›äº†æ ‡å‡†åŒ–æ”¯æŒâ€ï¼Œé‚£ä¹ˆï¼ŒC++20å·²ç»æ”¯æŒåºåˆ—åŒ–å’Œååºåˆ—åŒ–äº†å—ï¼Ÿ ï¼ˆC++20ä¹‹å‰çš„ç‰ˆæœ¬æ”¯æŒå—ï¼Ÿï¼‰","like_count":0,"discussions":[{"author":{"id":1006976,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5d/80/0c52be53.jpg","nickname":"å¢èª‰å£°","note":"","ucode":"93C5EFC39EB9C6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":608071,"discussion_content":"1.\tå¯¹æµ®ç‚¹æ•°è¿›è¡Œç§»ä½æ“ä½œéœ€è¦æ˜¾ç¤ºè½¬æ¢ï¼Œè€Œä¸”ä¸èƒ½static_castï¼Œéœ€è¦å…ˆreinterpret_castå˜é‡æŒ‡é’ˆåˆ°æ•´å‹çš„æŒ‡é’ˆï¼Œç§»ä½åå†è½¬æ¢å›å»ï¼Œéå¸¸éº»çƒ¦ã€‚\n2.\tåŒºåˆ†åªèƒ½çœ‹ç¼–è¯‘å™¨æ˜¯å¦‚ä½•å®šä¹‰çš„ã€‚\n3.\tC++20å¹¶ä¸æ˜¯æ”¯æŒåºåˆ—åŒ–/ååºåˆ—åŒ–ï¼Œè€Œæ˜¯åœ¨C++20ä¸­ï¼Œæ ‡å‡†åº“æä¾›äº†å¤§ç«¯å°ç«¯åˆ¤æ–­ã€äº¤æ¢å­—èŠ‚åºä¹‹ç±»çš„åŸºç¡€å·¥å…·æ”¯æŒï¼Œæˆ‘ä»¬å¯ä»¥åŸºäºæ ‡å‡†åº“æ›´å®¹æ˜“æ„å»ºåºåˆ—åŒ–å’Œååºåˆ—åŒ–åº“ï¼ŒC++20ä¹‹å‰æ²¡æœ‰ç›¸å…³çš„ä»»ä½•æ”¯æŒã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1678249463,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}