{"id":211388,"title":"04 | è¿æ¥æ± ï¼šåˆ«è®©è¿æ¥æ± å¸®äº†å€’å¿™","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æœ±æ™”ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬æ¥èŠèŠä½¿ç”¨è¿æ¥æ± éœ€è¦æ³¨æ„çš„é—®é¢˜ã€‚</p><p>åœ¨ä¸Šä¸€è®²ï¼Œæˆ‘ä»¬å­¦ä¹ äº†ä½¿ç”¨çº¿ç¨‹æ± éœ€è¦æ³¨æ„çš„é—®é¢˜ã€‚ä»Šå¤©ï¼Œæˆ‘å†ä¸ä½ è¯´è¯´å¦ä¸€ç§å¾ˆé‡è¦çš„æ± åŒ–æŠ€æœ¯ï¼Œå³è¿æ¥æ± ã€‚</p><p>æˆ‘å…ˆå’Œä½ è¯´è¯´è¿æ¥æ± çš„ç»“æ„ã€‚è¿æ¥æ± ä¸€èˆ¬å¯¹å¤–æä¾›è·å¾—è¿æ¥ã€å½’è¿˜è¿æ¥çš„æ¥å£ç»™å®¢æˆ·ç«¯ä½¿ç”¨ï¼Œå¹¶æš´éœ²æœ€å°ç©ºé—²è¿æ¥æ•°ã€æœ€å¤§è¿æ¥æ•°ç­‰å¯é…ç½®å‚æ•°ï¼Œåœ¨å†…éƒ¨åˆ™å®ç°è¿æ¥å»ºç«‹ã€è¿æ¥å¿ƒè·³ä¿æŒã€è¿æ¥ç®¡ç†ã€ç©ºé—²è¿æ¥å›æ”¶ã€è¿æ¥å¯ç”¨æ€§æ£€æµ‹ç­‰åŠŸèƒ½ã€‚è¿æ¥æ± çš„ç»“æ„ç¤ºæ„å›¾ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/16/7e/1685d9db2602e1de8483de171af6fd7e.png?wh=1772*1058\" alt=\"\"></p><p>ä¸šåŠ¡é¡¹ç›®ä¸­ç»å¸¸ä¼šç”¨åˆ°çš„è¿æ¥æ± ï¼Œä¸»è¦æ˜¯æ•°æ®åº“è¿æ¥æ± ã€Redisè¿æ¥æ± å’ŒHTTPè¿æ¥æ± ã€‚æ‰€ä»¥ï¼Œä»Šå¤©æˆ‘å°±ä»¥è¿™ä¸‰ç§è¿æ¥æ± ä¸ºä¾‹ï¼Œå’Œä½ èŠèŠä½¿ç”¨å’Œé…ç½®è¿æ¥æ± å®¹æ˜“å‡ºé”™çš„åœ°æ–¹ã€‚</p><h2>æ³¨æ„é‰´åˆ«å®¢æˆ·ç«¯SDKæ˜¯å¦åŸºäºè¿æ¥æ± </h2><p>åœ¨ä½¿ç”¨ä¸‰æ–¹å®¢æˆ·ç«¯è¿›è¡Œç½‘ç»œé€šä¿¡æ—¶ï¼Œæˆ‘ä»¬é¦–å…ˆè¦ç¡®å®šå®¢æˆ·ç«¯SDKæ˜¯å¦æ˜¯åŸºäºè¿æ¥æ± æŠ€æœ¯å®ç°çš„ã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒTCPæ˜¯é¢å‘è¿æ¥çš„åŸºäºå­—èŠ‚æµçš„åè®®ï¼š</p><ul>\n<li>é¢å‘è¿æ¥ï¼Œæ„å‘³ç€è¿æ¥éœ€è¦å…ˆåˆ›å»ºå†ä½¿ç”¨ï¼Œåˆ›å»ºè¿æ¥çš„ä¸‰æ¬¡æ¡æ‰‹æœ‰ä¸€å®šå¼€é”€ï¼›</li>\n<li>åŸºäºå­—èŠ‚æµï¼Œæ„å‘³ç€å­—èŠ‚æ˜¯å‘é€æ•°æ®çš„æœ€å°å•å…ƒï¼ŒTCPåè®®æœ¬èº«æ— æ³•åŒºåˆ†å“ªå‡ ä¸ªå­—èŠ‚æ˜¯å®Œæ•´çš„æ¶ˆæ¯ä½“ï¼Œä¹Ÿæ— æ³•æ„ŸçŸ¥æ˜¯å¦æœ‰å¤šä¸ªå®¢æˆ·ç«¯åœ¨ä½¿ç”¨åŒä¸€ä¸ªTCPè¿æ¥ï¼ŒTCPåªæ˜¯ä¸€ä¸ªè¯»å†™æ•°æ®çš„ç®¡é“ã€‚</li>\n</ul><p>å¦‚æœå®¢æˆ·ç«¯SDKæ²¡æœ‰ä½¿ç”¨è¿æ¥æ± ï¼Œè€Œç›´æ¥æ˜¯TCPè¿æ¥ï¼Œé‚£ä¹ˆå°±éœ€è¦è€ƒè™‘æ¯æ¬¡å»ºç«‹TCPè¿æ¥çš„å¼€é”€ï¼Œ<strong>å¹¶ä¸”å› ä¸ºTCPåŸºäºå­—èŠ‚æµï¼Œåœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹å¯¹åŒä¸€è¿æ¥è¿›è¡Œå¤ç”¨ï¼Œå¯èƒ½ä¼šäº§ç”Ÿçº¿ç¨‹å®‰å…¨é—®é¢˜</strong>ã€‚</p><!-- [[[read_end]]] --><p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹æ¶‰åŠTCPè¿æ¥çš„å®¢æˆ·ç«¯SDKï¼Œå¯¹å¤–æä¾›APIçš„ä¸‰ç§æ–¹å¼ã€‚åœ¨é¢å¯¹å„ç§ä¸‰æ–¹å®¢æˆ·ç«¯çš„æ—¶å€™ï¼Œåªæœ‰å…ˆè¯†åˆ«å‡ºå…¶å±äºå“ªä¸€ç§ï¼Œæ‰èƒ½ç†æ¸…æ¥šä½¿ç”¨æ–¹å¼ã€‚</p><ul>\n<li>è¿æ¥æ± å’Œè¿æ¥åˆ†ç¦»çš„APIï¼šæœ‰ä¸€ä¸ªXXXPoolç±»è´Ÿè´£è¿æ¥æ± å®ç°ï¼Œå…ˆä»å…¶è·å¾—è¿æ¥XXXConnectionï¼Œç„¶åç”¨è·å¾—çš„è¿æ¥è¿›è¡ŒæœåŠ¡ç«¯è¯·æ±‚ï¼Œå®Œæˆåä½¿ç”¨è€…éœ€è¦å½’è¿˜è¿æ¥ã€‚é€šå¸¸ï¼ŒXXXPoolæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥å¹¶å‘è·å–å’Œå½’è¿˜è¿æ¥ï¼Œè€ŒXXXConnectionæ˜¯éçº¿ç¨‹å®‰å…¨çš„ã€‚å¯¹åº”åˆ°è¿æ¥æ± çš„ç»“æ„ç¤ºæ„å›¾ä¸­ï¼ŒXXXPoolå°±æ˜¯å³è¾¹è¿æ¥æ± é‚£ä¸ªæ¡†ï¼Œå·¦è¾¹çš„å®¢æˆ·ç«¯æ˜¯æˆ‘ä»¬è‡ªå·±çš„ä»£ç ã€‚</li>\n<li>å†…éƒ¨å¸¦æœ‰è¿æ¥æ± çš„APIï¼šå¯¹å¤–æä¾›ä¸€ä¸ªXXXClientç±»ï¼Œé€šè¿‡è¿™ä¸ªç±»å¯ä»¥ç›´æ¥è¿›è¡ŒæœåŠ¡ç«¯è¯·æ±‚ï¼›è¿™ä¸ªç±»å†…éƒ¨ç»´æŠ¤äº†è¿æ¥æ± ï¼ŒSDKä½¿ç”¨è€…æ— éœ€è€ƒè™‘è¿æ¥çš„è·å–å’Œå½’è¿˜é—®é¢˜ã€‚ä¸€èˆ¬è€Œè¨€ï¼ŒXXXClientæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¯¹åº”åˆ°è¿æ¥æ± çš„ç»“æ„ç¤ºæ„å›¾ä¸­ï¼Œæ•´ä¸ªAPIå°±æ˜¯è“è‰²æ¡†åŒ…è£¹çš„éƒ¨åˆ†ã€‚</li>\n<li>éè¿æ¥æ± çš„APIï¼šä¸€èˆ¬å‘½åä¸ºXXXConnectionï¼Œä»¥åŒºåˆ†å…¶æ˜¯åŸºäºè¿æ¥æ± è¿˜æ˜¯å•è¿æ¥çš„ï¼Œè€Œä¸å»ºè®®å‘½åä¸ºXXXClientæˆ–ç›´æ¥æ˜¯XXXã€‚ç›´æ¥è¿æ¥æ–¹å¼çš„APIåŸºäºå•ä¸€è¿æ¥ï¼Œæ¯æ¬¡ä½¿ç”¨éƒ½éœ€è¦åˆ›å»ºå’Œæ–­å¼€è¿æ¥ï¼Œæ€§èƒ½ä¸€èˆ¬ï¼Œä¸”é€šå¸¸ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¯¹åº”åˆ°è¿æ¥æ± çš„ç»“æ„ç¤ºæ„å›¾ä¸­ï¼Œè¿™ç§å½¢å¼ç›¸å½“äºæ²¡æœ‰å³è¾¹è¿æ¥æ± é‚£ä¸ªæ¡†ï¼Œå®¢æˆ·ç«¯ç›´æ¥è¿æ¥æœåŠ¡ç«¯åˆ›å»ºè¿æ¥ã€‚</li>\n</ul><p>è™½ç„¶ä¸Šé¢æåˆ°äº†SDKä¸€èˆ¬çš„å‘½åä¹ æƒ¯ï¼Œä½†ä¸æ’é™¤æœ‰ä¸€äº›å®¢æˆ·ç«¯ç‰¹ç«‹ç‹¬è¡Œï¼Œå› æ­¤åœ¨ä½¿ç”¨ä¸‰æ–¹SDKæ—¶ï¼Œä¸€å®šè¦å…ˆæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£äº†è§£å…¶æœ€ä½³å®è·µï¼Œæˆ–æ˜¯åœ¨ç±»ä¼¼Stackoverflowçš„ç½‘ç«™æœç´¢XXX threadsafe/singletonå­—æ ·çœ‹çœ‹å¤§å®¶çš„å›å¤ï¼Œä¹Ÿå¯ä»¥ä¸€å±‚ä¸€å±‚å¾€ä¸‹çœ‹æºç ï¼Œç›´åˆ°å®šä½åˆ°åŸå§‹Socketæ¥åˆ¤æ–­Socketå’Œå®¢æˆ·ç«¯APIçš„å¯¹åº”å…³ç³»ã€‚</p><p>æ˜ç¡®äº†SDKè¿æ¥æ± çš„å®ç°æ–¹å¼åï¼Œæˆ‘ä»¬å°±å¤§æ¦‚çŸ¥é“äº†ä½¿ç”¨SDKçš„æœ€ä½³å®è·µï¼š</p><ul>\n<li>å¦‚æœæ˜¯åˆ†ç¦»æ–¹å¼ï¼Œé‚£ä¹ˆè¿æ¥æ± æœ¬èº«ä¸€èˆ¬æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¯ä»¥å¤ç”¨ã€‚æ¯æ¬¡ä½¿ç”¨éœ€è¦ä»è¿æ¥æ± è·å–è¿æ¥ï¼Œä½¿ç”¨åå½’è¿˜ï¼Œå½’è¿˜çš„å·¥ä½œç”±ä½¿ç”¨è€…è´Ÿè´£ã€‚</li>\n<li>å¦‚æœæ˜¯å†…ç½®è¿æ¥æ± ï¼ŒSDKä¼šè´Ÿè´£è¿æ¥çš„è·å–å’Œå½’è¿˜ï¼Œä½¿ç”¨çš„æ—¶å€™ç›´æ¥å¤ç”¨å®¢æˆ·ç«¯ã€‚</li>\n<li>å¦‚æœSDKæ²¡æœ‰å®ç°è¿æ¥æ± ï¼ˆå¤§å¤šæ•°ä¸­é—´ä»¶ã€æ•°æ®åº“çš„å®¢æˆ·ç«¯SDKéƒ½ä¼šæ”¯æŒè¿æ¥æ± ï¼‰ï¼Œé‚£é€šå¸¸ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè€Œä¸”çŸ­è¿æ¥çš„æ–¹å¼æ€§èƒ½ä¸ä¼šå¾ˆé«˜ï¼Œä½¿ç”¨çš„æ—¶å€™éœ€è¦è€ƒè™‘æ˜¯å¦è‡ªå·±å°è£…ä¸€ä¸ªè¿æ¥æ± ã€‚</li>\n</ul><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°±ä»¥Javaä¸­ç”¨äºæ“ä½œRedisæœ€å¸¸è§çš„åº“Jedisä¸ºä¾‹ï¼Œä»æºç è§’åº¦åˆ†æä¸‹Jedisç±»åˆ°åº•å±äºå“ªç§ç±»å‹çš„APIï¼Œç›´æ¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¤ç”¨ä¸€ä¸ªè¿æ¥ä¼šäº§ç”Ÿä»€ä¹ˆé—®é¢˜ï¼Œä»¥åŠå¦‚ä½•ç”¨æœ€ä½³å®è·µæ¥ä¿®å¤è¿™ä¸ªé—®é¢˜ã€‚</p><p>é¦–å…ˆï¼Œå‘Redisåˆå§‹åŒ–2ç»„æ•°æ®ï¼ŒKey=aã€Value=1ï¼ŒKey=bã€Value=2ï¼š</p><pre><code>@PostConstruct\npublic void init() {\n    try (Jedis jedis = new Jedis(&quot;127.0.0.1&quot;, 6379)) {\n        Assert.isTrue(&quot;OK&quot;.equals(jedis.set(&quot;a&quot;, &quot;1&quot;)), &quot;set a = 1 return OK&quot;);\n        Assert.isTrue(&quot;OK&quot;.equals(jedis.set(&quot;b&quot;, &quot;2&quot;)), &quot;set b = 2 return OK&quot;);\n    }\n}\n</code></pre><p>ç„¶åï¼Œå¯åŠ¨ä¸¤ä¸ªçº¿ç¨‹ï¼Œå…±äº«æ“ä½œåŒä¸€ä¸ªJediså®ä¾‹ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹å¾ªç¯1000æ¬¡ï¼Œåˆ†åˆ«è¯»å–Keyä¸ºaå’Œbçš„Valueï¼Œåˆ¤æ–­æ˜¯å¦åˆ†åˆ«ä¸º1å’Œ2ï¼š</p><pre><code>Jedis jedis = new Jedis(&quot;127.0.0.1&quot;, 6379);\nnew Thread(() -&gt; {\n    for (int i = 0; i &lt; 1000; i++) {\n        String result = jedis.get(&quot;a&quot;);\n        if (!result.equals(&quot;1&quot;)) {\n            log.warn(&quot;Expect a to be 1 but found {}&quot;, result);\n            return;\n        }\n    }\n}).start();\nnew Thread(() -&gt; {\n    for (int i = 0; i &lt; 1000; i++) {\n        String result = jedis.get(&quot;b&quot;);\n        if (!result.equals(&quot;2&quot;)) {\n            log.warn(&quot;Expect b to be 2 but found {}&quot;, result);\n            return;\n        }\n    }\n}).start();\nTimeUnit.SECONDS.sleep(5);\n</code></pre><p>æ‰§è¡Œç¨‹åºå¤šæ¬¡ï¼Œå¯ä»¥çœ‹åˆ°æ—¥å¿—ä¸­å‡ºç°äº†å„ç§å¥‡æ€ªçš„å¼‚å¸¸ä¿¡æ¯ï¼Œæœ‰çš„æ˜¯è¯»å–Keyä¸ºbçš„Valueè¯»å–åˆ°äº†1ï¼Œæœ‰çš„æ˜¯æµéæ­£å¸¸ç»“æŸï¼Œè¿˜æœ‰çš„æ˜¯è¿æ¥å…³é—­å¼‚å¸¸ï¼š</p><pre><code>//é”™è¯¯1\n[14:56:19.069] [Thread-28] [WARN ] [.t.c.c.redis.JedisMisreuseController:45  ] - Expect b to be 2 but found 1\n//é”™è¯¯2\nredis.clients.jedis.exceptions.JedisConnectionException: Unexpected end of stream.\n\tat redis.clients.jedis.util.RedisInputStream.ensureFill(RedisInputStream.java:202)\n\tat redis.clients.jedis.util.RedisInputStream.readLine(RedisInputStream.java:50)\n\tat redis.clients.jedis.Protocol.processError(Protocol.java:114)\n\tat redis.clients.jedis.Protocol.process(Protocol.java:166)\n\tat redis.clients.jedis.Protocol.read(Protocol.java:220)\n\tat redis.clients.jedis.Connection.readProtocolWithCheckingBroken(Connection.java:318)\n\tat redis.clients.jedis.Connection.getBinaryBulkReply(Connection.java:255)\n\tat redis.clients.jedis.Connection.getBulkReply(Connection.java:245)\n\tat redis.clients.jedis.Jedis.get(Jedis.java:181)\n\tat org.geekbang.time.commonmistakes.connectionpool.redis.JedisMisreuseController.lambda$wrong$1(JedisMisreuseController.java:43)\n\tat java.lang.Thread.run(Thread.java:748)\n//é”™è¯¯3\njava.io.IOException: Socket Closed\n\tat java.net.AbstractPlainSocketImpl.getOutputStream(AbstractPlainSocketImpl.java:440)\n\tat java.net.Socket$3.run(Socket.java:954)\n\tat java.net.Socket$3.run(Socket.java:952)\n\tat java.security.AccessController.doPrivileged(Native Method)\n\tat java.net.Socket.getOutputStream(Socket.java:951)\n\tat redis.clients.jedis.Connection.connect(Connection.java:200)\n\t... 7 more\n</code></pre><p>è®©æˆ‘ä»¬åˆ†æä¸€ä¸‹Jedisç±»çš„æºç ï¼Œææ¸…æ¥šå…¶ä¸­ç¼˜ç”±å§ã€‚</p><pre><code>public class Jedis extends BinaryJedis implements JedisCommands, MultiKeyCommands,\n    AdvancedJedisCommands, ScriptingCommands, BasicCommands, ClusterCommands, SentinelCommands, ModuleCommands {\n}\npublic class BinaryJedis implements BasicCommands, BinaryJedisCommands, MultiKeyBinaryCommands,\n    AdvancedBinaryJedisCommands, BinaryScriptingCommands, Closeable {\n\tprotected Client client = null;\n      ...\n}\n\npublic class Client extends BinaryClient implements Commands {\n}\npublic class BinaryClient extends Connection {\n}\npublic class Connection implements Closeable {\n  private Socket socket;\n  private RedisOutputStream outputStream;\n  private RedisInputStream inputStream;\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒJedisç»§æ‰¿äº†BinaryJedisï¼ŒBinaryJedisä¸­ä¿å­˜äº†å•ä¸ªClientçš„å®ä¾‹ï¼ŒClientæœ€ç»ˆç»§æ‰¿äº†Connectionï¼ŒConnectionä¸­ä¿å­˜äº†å•ä¸ªSocketçš„å®ä¾‹ï¼Œå’ŒSocketå¯¹åº”çš„ä¸¤ä¸ªè¯»å†™æµã€‚å› æ­¤ï¼Œä¸€ä¸ªJediså¯¹åº”ä¸€ä¸ªSocketè¿æ¥ã€‚ç±»å›¾å¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/e7/0f/e72120b1f6daf4a951e75c05b9191a0f.png?wh=1326*1164\" alt=\"\"></p><p>BinaryClientå°è£…äº†å„ç§Rediså‘½ä»¤ï¼Œå…¶æœ€ç»ˆä¼šè°ƒç”¨åŸºç±»Connectionçš„æ–¹æ³•ï¼Œä½¿ç”¨Protocolç±»å‘é€å‘½ä»¤ã€‚çœ‹ä¸€ä¸‹Protocolç±»çš„sendCommandæ–¹æ³•çš„æºç ï¼Œå¯ä»¥å‘ç°å…¶å‘é€å‘½ä»¤æ—¶æ˜¯ç›´æ¥æ“ä½œRedisOutputStreamå†™å…¥å­—èŠ‚ã€‚</p><p>æˆ‘ä»¬åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¤ç”¨Jediså¯¹è±¡ï¼Œå…¶å®å°±æ˜¯åœ¨å¤ç”¨RedisOutputStreamã€‚<strong>å¦‚æœå¤šä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œæ“ä½œï¼Œé‚£ä¹ˆæ—¢æ— æ³•ç¡®ä¿æ•´æ¡å‘½ä»¤ä»¥ä¸€ä¸ªåŸå­æ“ä½œå†™å…¥Socketï¼Œä¹Ÿæ— æ³•ç¡®ä¿å†™å…¥åã€è¯»å–å‰æ²¡æœ‰å…¶ä»–æ•°æ®å†™åˆ°è¿œç«¯</strong>ï¼š</p><pre><code>private static void sendCommand(final RedisOutputStream os, final byte[] command,\n\t  final byte[]... args) {\n\ttry {\n\t  os.write(ASTERISK_BYTE);\n\t  os.writeIntCrLf(args.length + 1);\n\t  os.write(DOLLAR_BYTE);\n\t  os.writeIntCrLf(command.length);\n\t  os.write(command);\n\t  os.writeCrLf();\n\n\n\t  for (final byte[] arg : args) {\n\t    os.write(DOLLAR_BYTE);\n\t    os.writeIntCrLf(arg.length);\n\t    os.write(arg);\n\t    os.writeCrLf();\n\t  }\n\t} catch (IOException e) {\n\t  throw new JedisConnectionException(e);\n\t}\n}\n</code></pre><p>çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç†è§£äº†ï¼Œä¸ºå•¥å¤šçº¿ç¨‹æƒ…å†µä¸‹ä½¿ç”¨Jediså¯¹è±¡æ“ä½œRedisä¼šå‡ºç°å„ç§å¥‡æ€ªçš„é—®é¢˜ã€‚</p><p>æ¯”å¦‚ï¼Œå†™æ“ä½œäº’ç›¸å¹²æ‰°ï¼Œå¤šæ¡å‘½ä»¤ç›¸äº’ç©¿æ’çš„è¯ï¼Œå¿…ç„¶ä¸æ˜¯åˆæ³•çš„Rediså‘½ä»¤ï¼Œé‚£ä¹ˆRedisä¼šå…³é—­å®¢æˆ·ç«¯è¿æ¥ï¼Œå¯¼è‡´è¿æ¥æ–­å¼€ï¼›åˆæ¯”å¦‚ï¼Œçº¿ç¨‹1å’Œ2å…ˆåå†™å…¥äº†get aå’Œget bæ“ä½œçš„è¯·æ±‚ï¼ŒRedisä¹Ÿè¿”å›äº†å€¼1å’Œ2ï¼Œä½†æ˜¯çº¿ç¨‹2å…ˆè¯»å–äº†æ•°æ®1å°±ä¼šå‡ºç°æ•°æ®é”™ä¹±çš„é—®é¢˜ã€‚</p><p>ä¿®å¤æ–¹å¼æ˜¯ï¼Œä½¿ç”¨Jedisæä¾›çš„å¦ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ç±»JedisPoolæ¥è·å¾—Jedisçš„å®ä¾‹ã€‚JedisPoolå¯ä»¥å£°æ˜ä¸ºstaticåœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«ï¼Œæ‰®æ¼”è¿æ¥æ± çš„è§’è‰²ã€‚ä½¿ç”¨æ—¶ï¼ŒæŒ‰éœ€ä½¿ç”¨try-with-resourcesæ¨¡å¼ä»JedisPoolè·å¾—å’Œå½’è¿˜Jediså®ä¾‹ã€‚</p><pre><code>private static JedisPool jedisPool = new JedisPool(&quot;127.0.0.1&quot;, 6379);\n\nnew Thread(() -&gt; {\n    try (Jedis jedis = jedisPool.getResource()) {\n        for (int i = 0; i &lt; 1000; i++) {\n            String result = jedis.get(&quot;a&quot;);\n            if (!result.equals(&quot;1&quot;)) {\n                log.warn(&quot;Expect a to be 1 but found {}&quot;, result);\n                return;\n            }\n        }\n    }\n}).start();\nnew Thread(() -&gt; {\n    try (Jedis jedis = jedisPool.getResource()) {\n        for (int i = 0; i &lt; 1000; i++) {\n            String result = jedis.get(&quot;b&quot;);\n            if (!result.equals(&quot;2&quot;)) {\n                log.warn(&quot;Expect b to be 2 but found {}&quot;, result);\n                return;\n            }\n        }\n    }\n}).start();\n</code></pre><p>è¿™æ ·ä¿®å¤åï¼Œä»£ç ä¸å†æœ‰çº¿ç¨‹å®‰å…¨é—®é¢˜äº†ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬æœ€å¥½é€šè¿‡shutdownhookï¼Œåœ¨ç¨‹åºé€€å‡ºä¹‹å‰å…³é—­JedisPoolï¼š</p><pre><code>@PostConstruct\npublic void init() {\n    Runtime.getRuntime().addShutdownHook(new Thread(() -&gt; {\n        jedisPool.close();\n    }));\n}\n</code></pre><p>çœ‹ä¸€ä¸‹Jedisç±»closeæ–¹æ³•çš„å®ç°å¯ä»¥å‘ç°ï¼Œå¦‚æœJedisæ˜¯ä»è¿æ¥æ± è·å–çš„è¯ï¼Œé‚£ä¹ˆcloseæ–¹æ³•ä¼šè°ƒç”¨è¿æ¥æ± çš„returnæ–¹æ³•å½’è¿˜è¿æ¥ï¼š</p><pre><code>public class Jedis extends BinaryJedis implements JedisCommands, MultiKeyCommands,\n    AdvancedJedisCommands, ScriptingCommands, BasicCommands, ClusterCommands, SentinelCommands, ModuleCommands {\n  protected JedisPoolAbstract dataSource = null;\n\n\n  @Override\n  public void close() {\n    if (dataSource != null) {\n      JedisPoolAbstract pool = this.dataSource;\n      this.dataSource = null;\n      if (client.isBroken()) {\n        pool.returnBrokenResource(this);\n      } else {\n        pool.returnResource(this);\n      }\n    } else {\n      super.close();\n    }\n  }\n}\n</code></pre><p>å¦‚æœä¸æ˜¯ï¼Œåˆ™ç›´æ¥å…³é—­è¿æ¥ï¼Œå…¶æœ€ç»ˆè°ƒç”¨Connectionç±»çš„disconnectæ–¹æ³•æ¥å…³é—­TCPè¿æ¥ï¼š</p><pre><code>public void disconnect() {\n  if (isConnected()) {\n    try {\n      outputStream.flush();\n      socket.close();\n    } catch (IOException ex) {\n      broken = true;\n      throw new JedisConnectionException(ex);\n    } finally {\n      IOUtils.closeQuietly(socket);\n    }\n  }\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼ŒJediså¯ä»¥ç‹¬ç«‹ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥é…åˆè¿æ¥æ± ä½¿ç”¨ï¼Œè¿™ä¸ªè¿æ¥æ± å°±æ˜¯JedisPoolã€‚æˆ‘ä»¬å†çœ‹çœ‹JedisPoolçš„å®ç°ã€‚</p><pre><code>public class JedisPool extends JedisPoolAbstract {\n@Override\n  public Jedis getResource() {\n    Jedis jedis = super.getResource();\n    jedis.setDataSource(this);\n    return jedis;\n  }\n\n  @Override\n  protected void returnResource(final Jedis resource) {\n    if (resource != null) {\n      try {\n        resource.resetState();\n        returnResourceObject(resource);\n      } catch (Exception e) {\n        returnBrokenResource(resource);\n        throw new JedisException(&quot;Resource is returned to the pool as broken&quot;, e);\n      }\n    }\n  }\n}\n\npublic class JedisPoolAbstract extends Pool&lt;Jedis&gt; {\n}\n\npublic abstract class Pool&lt;T&gt; implements Closeable {\n  protected GenericObjectPool&lt;T&gt; internalPool;\n}\n</code></pre><p>JedisPoolçš„getResourceæ–¹æ³•åœ¨æ‹¿åˆ°Jediså¯¹è±¡åï¼Œå°†è‡ªå·±è®¾ç½®ä¸ºäº†è¿æ¥æ± ã€‚è¿æ¥æ± JedisPoolï¼Œç»§æ‰¿äº†JedisPoolAbstractï¼Œè€Œåè€…ç»§æ‰¿äº†æŠ½è±¡ç±»Poolï¼ŒPoolå†…éƒ¨ç»´æŠ¤äº†Apache Commonçš„é€šç”¨æ± GenericObjectPoolã€‚JedisPoolçš„è¿æ¥æ± å°±æ˜¯åŸºäºGenericObjectPoolçš„ã€‚</p><p>çœ‹åˆ°è¿™é‡Œæˆ‘ä»¬äº†è§£äº†ï¼ŒJedisçš„APIå®ç°æ˜¯æˆ‘ä»¬è¯´çš„ä¸‰ç§ç±»å‹ä¸­çš„ç¬¬ä¸€ç§ï¼Œä¹Ÿå°±æ˜¯è¿æ¥æ± å’Œè¿æ¥åˆ†ç¦»çš„APIï¼ŒJedisPoolæ˜¯çº¿ç¨‹å®‰å…¨çš„è¿æ¥æ± ï¼ŒJedisæ˜¯éçº¿ç¨‹å®‰å…¨çš„å•ä¸€è¿æ¥ã€‚çŸ¥é“äº†åŸç†ä¹‹åï¼Œæˆ‘ä»¬å†ä½¿ç”¨Jediså°±èƒ¸æœ‰æˆç«¹äº†ã€‚</p><h2>ä½¿ç”¨è¿æ¥æ± åŠ¡å¿…ç¡®ä¿å¤ç”¨</h2><p>åœ¨ä»‹ç»<a href=\"https://time.geekbang.org/column/article/210337\">çº¿ç¨‹æ± </a>çš„æ—¶å€™æˆ‘ä»¬å¼ºè°ƒè¿‡ï¼Œ<strong>æ± ä¸€å®šæ˜¯ç”¨æ¥å¤ç”¨çš„ï¼Œå¦åˆ™å…¶ä½¿ç”¨ä»£ä»·ä¼šæ¯”æ¯æ¬¡åˆ›å»ºå•ä¸€å¯¹è±¡æ›´å¤§ã€‚å¯¹è¿æ¥æ± æ¥è¯´æ›´æ˜¯å¦‚æ­¤ï¼ŒåŸå› å¦‚ä¸‹ï¼š</strong></p><ul>\n<li>åˆ›å»ºè¿æ¥æ± çš„æ—¶å€™å¾ˆå¯èƒ½ä¸€æ¬¡æ€§åˆ›å»ºäº†å¤šä¸ªè¿æ¥ï¼Œå¤§å¤šæ•°è¿æ¥æ± è€ƒè™‘åˆ°æ€§èƒ½ï¼Œä¼šåœ¨åˆå§‹åŒ–çš„æ—¶å€™ç»´æŠ¤ä¸€å®šæ•°é‡çš„æœ€å°è¿æ¥ï¼ˆæ¯•ç«Ÿåˆå§‹åŒ–è¿æ¥æ± çš„è¿‡ç¨‹ä¸€èˆ¬æ˜¯ä¸€æ¬¡æ€§çš„ï¼‰ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚å¦‚æœæ¯æ¬¡ä½¿ç”¨è¿æ¥æ± éƒ½æŒ‰éœ€åˆ›å»ºè¿æ¥æ± ï¼Œé‚£ä¹ˆå¾ˆå¯èƒ½ä½ åªç”¨åˆ°ä¸€ä¸ªè¿æ¥ï¼Œä½†æ˜¯åˆ›å»ºäº†Nä¸ªè¿æ¥ã€‚</li>\n<li>è¿æ¥æ± ä¸€èˆ¬ä¼šæœ‰ä¸€äº›ç®¡ç†æ¨¡å—ï¼Œä¹Ÿå°±æ˜¯è¿æ¥æ± çš„ç»“æ„ç¤ºæ„å›¾ä¸­çš„ç»¿è‰²éƒ¨åˆ†ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¤§å¤šæ•°çš„è¿æ¥æ± éƒ½æœ‰é—²ç½®è¶…æ—¶çš„æ¦‚å¿µã€‚è¿æ¥æ± ä¼šæ£€æµ‹è¿æ¥çš„é—²ç½®æ—¶é—´ï¼Œå®šæœŸå›æ”¶é—²ç½®çš„è¿æ¥ï¼ŒæŠŠæ´»è·ƒè¿æ¥æ•°é™åˆ°æœ€ä½ï¼ˆé—²ç½®ï¼‰è¿æ¥çš„é…ç½®å€¼ï¼Œå‡è½»æœåŠ¡ç«¯çš„å‹åŠ›ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œé—²ç½®è¿æ¥ç”±ç‹¬ç«‹çº¿ç¨‹ç®¡ç†ï¼Œå¯åŠ¨äº†ç©ºé—²æ£€æµ‹çš„è¿æ¥æ± ç›¸å½“äºè¿˜ä¼šå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ã€‚æ­¤å¤–ï¼Œæœ‰äº›è¿æ¥æ± è¿˜éœ€è¦ç‹¬ç«‹çº¿ç¨‹è´Ÿè´£è¿æ¥ä¿æ´»ç­‰åŠŸèƒ½ã€‚å› æ­¤ï¼Œå¯åŠ¨ä¸€ä¸ªè¿æ¥æ± ç›¸å½“äºå¯åŠ¨äº†Nä¸ªçº¿ç¨‹ã€‚</li>\n</ul><p>é™¤äº†ä½¿ç”¨ä»£ä»·ï¼Œè¿æ¥æ± ä¸é‡Šæ”¾ï¼Œè¿˜å¯èƒ½ä¼šå¼•èµ·çº¿ç¨‹æ³„éœ²ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘å°±ä»¥Apache HttpClientä¸ºä¾‹ï¼Œå’Œä½ è¯´è¯´è¿æ¥æ± ä¸å¤ç”¨çš„é—®é¢˜ã€‚</p><p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªCloseableHttpClientï¼Œè®¾ç½®ä½¿ç”¨PoolingHttpClientConnectionManagerè¿æ¥æ± å¹¶å¯ç”¨ç©ºé—²è¿æ¥é©±é€ç­–ç•¥ï¼Œæœ€å¤§ç©ºé—²æ—¶é—´ä¸º60ç§’ï¼Œç„¶åä½¿ç”¨è¿™ä¸ªè¿æ¥æ¥è¯·æ±‚ä¸€ä¸ªä¼šè¿”å›OKå­—ç¬¦ä¸²çš„æœåŠ¡ç«¯æ¥å£ï¼š</p><pre><code>@GetMapping(&quot;wrong1&quot;)\npublic String wrong1() {\n    CloseableHttpClient client = HttpClients.custom()\n            .setConnectionManager(new PoolingHttpClientConnectionManager())\n            .evictIdleConnections(60, TimeUnit.SECONDS).build();\n    try (CloseableHttpResponse response = client.execute(new HttpGet(&quot;http://127.0.0.1:45678/httpclientnotreuse/test&quot;))) {\n        return EntityUtils.toString(response.getEntity());\n    } catch (Exception ex) {\n        ex.printStackTrace();\n    }\n    return null;\n}\n</code></pre><p>è®¿é—®è¿™ä¸ªæ¥å£å‡ æ¬¡åæŸ¥çœ‹åº”ç”¨çº¿ç¨‹æƒ…å†µï¼Œå¯ä»¥çœ‹åˆ°æœ‰å¤§é‡å«ä½œConnection evictorçš„çº¿ç¨‹ï¼Œä¸”è¿™äº›çº¿ç¨‹ä¸ä¼šé”€æ¯ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/33/10/33a2389c20653e97b8157897d06c1510.png?wh=2142*664\" alt=\"\"></p><p>å¯¹è¿™ä¸ªæ¥å£è¿›è¡Œå‡ ç§’çš„å‹æµ‹ï¼ˆå‹æµ‹ä½¿ç”¨wrkï¼Œ1ä¸ªå¹¶å‘1ä¸ªè¿æ¥ï¼‰å¯ä»¥çœ‹åˆ°ï¼Œå·²ç»å»ºç«‹äº†ä¸‰åƒå¤šä¸ªTCPè¿æ¥åˆ°45678ç«¯å£ï¼ˆå…¶ä¸­æœ‰1ä¸ªæ˜¯å‹æµ‹å®¢æˆ·ç«¯åˆ°Tomcatçš„è¿æ¥ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯HttpClientåˆ°Tomcatçš„è¿æ¥ï¼‰ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/54/f2/54a71ee9a7bbbd5e121b12fe6289aff2.png?wh=592*122\" alt=\"\"></p><p>å¥½åœ¨æœ‰äº†ç©ºé—²è¿æ¥å›æ”¶çš„ç­–ç•¥ï¼Œ60ç§’ä¹‹åè¿æ¥å¤„äºCLOSE_WAITçŠ¶æ€ï¼Œæœ€ç»ˆå½»åº•å…³é—­ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/8e/77/8ea5f53e6510d76cf447c23fb15daa77.png?wh=1868*198\" alt=\"\"></p><p>è¿™2ç‚¹è¯æ˜ï¼ŒCloseableHttpClientå±äºç¬¬äºŒç§æ¨¡å¼ï¼Œå³å†…éƒ¨å¸¦æœ‰è¿æ¥æ± çš„APIï¼Œå…¶èƒŒåæ˜¯è¿æ¥æ± ï¼Œæœ€ä½³å®è·µä¸€å®šæ˜¯å¤ç”¨ã€‚</p><p>å¤ç”¨æ–¹å¼å¾ˆç®€å•ï¼Œä½ å¯ä»¥æŠŠCloseableHttpClientå£°æ˜ä¸ºstaticï¼Œåªåˆ›å»ºä¸€æ¬¡ï¼Œå¹¶ä¸”åœ¨JVMå…³é—­ä¹‹å‰é€šè¿‡addShutdownHooké’©å­å…³é—­è¿æ¥æ± ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™ç›´æ¥ä½¿ç”¨CloseableHttpClientå³å¯ï¼Œæ— éœ€æ¯æ¬¡éƒ½åˆ›å»ºã€‚</p><p>é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ªrightæ¥å£æ¥å®ç°æœåŠ¡ç«¯æ¥å£è°ƒç”¨ï¼š</p><pre><code>private static CloseableHttpClient httpClient = null;\nstatic {\n    //å½“ç„¶ï¼Œä¹Ÿå¯ä»¥æŠŠCloseableHttpClientå®šä¹‰ä¸ºBeanï¼Œç„¶ååœ¨@PreDestroyæ ‡è®°çš„æ–¹æ³•å†…closeè¿™ä¸ªHttpClient\n    httpClient = HttpClients.custom().setMaxConnPerRoute(1).setMaxConnTotal(1).evictIdleConnections(60, TimeUnit.SECONDS).build();\n    Runtime.getRuntime().addShutdownHook(new Thread(() -&gt; {\n        try {\n            httpClient.close();\n        } catch (IOException ignored) {\n        }\n    }));\n}\n\n@GetMapping(&quot;right&quot;)\npublic String right() {\n    try (CloseableHttpResponse response = httpClient.execute(new HttpGet(&quot;http://127.0.0.1:45678/httpclientnotreuse/test&quot;))) {\n        return EntityUtils.toString(response.getEntity());\n    } catch (Exception ex) {\n        ex.printStackTrace();\n    }\n    return null;\n}\n</code></pre><p>ç„¶åï¼Œé‡æ–°å®šä¹‰ä¸€ä¸ªwrong2æ¥å£ï¼Œä¿®å¤ä¹‹å‰æŒ‰éœ€åˆ›å»ºCloseableHttpClientçš„ä»£ç ï¼Œæ¯æ¬¡ç”¨å®Œä¹‹åç¡®ä¿è¿æ¥æ± å¯ä»¥å…³é—­ï¼š</p><pre><code>@GetMapping(&quot;wrong2&quot;)\npublic String wrong2() {\n    try (CloseableHttpClient client = HttpClients.custom()\n            .setConnectionManager(new PoolingHttpClientConnectionManager())\n            .evictIdleConnections(60, TimeUnit.SECONDS).build();\n         CloseableHttpResponse response = client.execute(new HttpGet(&quot;http://127.0.0.1:45678/httpclientnotreuse/test&quot;))) {\n            return EntityUtils.toString(response.getEntity());\n        } catch (Exception ex) {\n        ex.printStackTrace();\n    }\n    return null;\n}\n</code></pre><p>ä½¿ç”¨wrkå¯¹wrong2å’Œrightä¸¤ä¸ªæ¥å£åˆ†åˆ«å‹æµ‹60ç§’ï¼Œå¯ä»¥çœ‹åˆ°ä¸¤ç§ä½¿ç”¨æ–¹å¼æ€§èƒ½ä¸Šçš„å·®å¼‚ï¼Œæ¯æ¬¡åˆ›å»ºè¿æ¥æ± çš„QPSæ˜¯337ï¼Œè€Œå¤ç”¨è¿æ¥æ± çš„QPSæ˜¯2022ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/b7/2d/b79fb99cf8a5c3a17e60b0850544472d.png?wh=1246*688\" alt=\"\"></p><p>å¦‚æ­¤å¤§çš„æ€§èƒ½å·®å¼‚æ˜¾ç„¶æ˜¯å› ä¸ºTCPè¿æ¥çš„å¤ç”¨ã€‚ä½ å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œåˆšæ‰å®šä¹‰è¿æ¥æ± æ—¶ï¼Œæˆ‘å°†æœ€å¤§è¿æ¥æ•°è®¾ç½®ä¸º1ã€‚æ‰€ä»¥ï¼Œå¤ç”¨è¿æ¥æ± æ–¹å¼å¤ç”¨çš„å§‹ç»ˆåº”è¯¥æ˜¯åŒä¸€ä¸ªè¿æ¥ï¼Œè€Œæ–°å»ºè¿æ¥æ± æ–¹å¼åº”è¯¥æ˜¯æ¯æ¬¡éƒ½ä¼šåˆ›å»ºæ–°çš„TCPè¿æ¥ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡ç½‘ç»œæŠ“åŒ…å·¥å…·Wiresharkæ¥è¯å®è¿™ä¸€ç‚¹ã€‚</p><p>å¦‚æœè°ƒç”¨wrong2æ¥å£æ¯æ¬¡åˆ›å»ºæ–°çš„è¿æ¥æ± æ¥å‘èµ·HTTPè¯·æ±‚ï¼Œä»Wiresharkå¯ä»¥çœ‹åˆ°ï¼Œæ¯æ¬¡è¯·æ±‚æœåŠ¡ç«¯45678çš„å®¢æˆ·ç«¯ç«¯å£éƒ½æ˜¯æ–°çš„ã€‚è¿™é‡Œæˆ‘å‘èµ·äº†ä¸‰æ¬¡è¯·æ±‚ï¼Œç¨‹åºé€šè¿‡HttpClientè®¿é—®æœåŠ¡ç«¯45678çš„å®¢æˆ·ç«¯ç«¯å£å·ï¼Œåˆ†åˆ«æ˜¯51677ã€51679å’Œ51681ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/7b/35/7b8f651755cef0c05ecb08727d315e35.png?wh=2196*1556\" alt=\"\"></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡éƒ½æ˜¯æ–°çš„TCPè¿æ¥ï¼Œæ”¾å¼€HTTPè¿™ä¸ªè¿‡æ»¤æ¡ä»¶ä¹Ÿå¯ä»¥çœ‹åˆ°å®Œæ•´çš„TCPæ¡æ‰‹ã€æŒ¥æ‰‹çš„è¿‡ç¨‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/48/0d/4815c0edd21d5bf0cae8c0c3e578960d.png?wh=2146*1503\" alt=\"\"></p><p>è€Œå¤ç”¨è¿æ¥æ± æ–¹å¼çš„æ¥å£rightçš„è¡¨ç°å°±å®Œå…¨ä¸åŒäº†ã€‚å¯ä»¥çœ‹åˆ°ï¼Œç¬¬äºŒæ¬¡HTTPè¯·æ±‚#41çš„å®¢æˆ·ç«¯ç«¯å£61468å’Œç¬¬ä¸€æ¬¡è¿æ¥#23çš„ç«¯å£æ˜¯ä¸€æ ·çš„ï¼ŒWiresharkä¹Ÿæç¤ºäº†æ•´ä¸ªTCPä¼šè¯ä¸­ï¼Œå½“å‰#41è¯·æ±‚æ˜¯ç¬¬äºŒæ¬¡è¯·æ±‚ï¼Œå‰ä¸€æ¬¡æ˜¯#23ï¼Œåé¢ä¸€æ¬¡æ˜¯#75ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/2c/2c/2cbada9be98ce33321b29d38adb09f2c.png?wh=1708*1560\" alt=\"\"></p><p>åªæœ‰TCPè¿æ¥é—²ç½®è¶…è¿‡60ç§’åæ‰ä¼šæ–­å¼€ï¼Œè¿æ¥æ± ä¼šæ–°å»ºè¿æ¥ã€‚ä½ å¯ä»¥å°è¯•é€šè¿‡Wiresharkè§‚å¯Ÿè¿™ä¸€è¿‡ç¨‹ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ç»§ç»­èŠèŠè¿æ¥æ± çš„é…ç½®é—®é¢˜ã€‚</p><h2>è¿æ¥æ± çš„é…ç½®ä¸æ˜¯ä¸€æˆä¸å˜çš„</h2><p>ä¸ºæ–¹ä¾¿æ ¹æ®å®¹é‡è§„åˆ’è®¾ç½®è¿æ¥å¤„çš„å±æ€§ï¼Œè¿æ¥æ± æä¾›äº†è®¸å¤šå‚æ•°ï¼ŒåŒ…æ‹¬æœ€å°ï¼ˆé—²ç½®ï¼‰è¿æ¥ã€æœ€å¤§è¿æ¥ã€é—²ç½®è¿æ¥ç”Ÿå­˜æ—¶é—´ã€è¿æ¥ç”Ÿå­˜æ—¶é—´ç­‰ã€‚å…¶ä¸­ï¼Œæœ€é‡è¦çš„å‚æ•°æ˜¯æœ€å¤§è¿æ¥æ•°ï¼Œå®ƒå†³å®šäº†è¿æ¥æ± èƒ½ä½¿ç”¨çš„è¿æ¥æ•°é‡ä¸Šé™ï¼Œè¾¾åˆ°ä¸Šé™åï¼Œæ–°æ¥çš„è¯·æ±‚éœ€è¦ç­‰å¾…å…¶ä»–è¯·æ±‚é‡Šæ”¾è¿æ¥ã€‚</p><p>ä½†ï¼Œ<strong>æœ€å¤§è¿æ¥æ•°ä¸æ˜¯è®¾ç½®å¾—è¶Šå¤§è¶Šå¥½</strong>ã€‚å¦‚æœè®¾ç½®å¾—å¤ªå¤§ï¼Œä¸ä»…ä»…æ˜¯å®¢æˆ·ç«¯éœ€è¦è€—è´¹è¿‡å¤šçš„èµ„æºç»´æŠ¤è¿æ¥ï¼Œæ›´é‡è¦çš„æ˜¯ç”±äºæœåŠ¡ç«¯å¯¹åº”çš„æ˜¯å¤šä¸ªå®¢æˆ·ç«¯ï¼Œæ¯ä¸€ä¸ªå®¢æˆ·ç«¯éƒ½ä¿æŒå¤§é‡çš„è¿æ¥ï¼Œä¼šç»™æœåŠ¡ç«¯å¸¦æ¥æ›´å¤§çš„å‹åŠ›ã€‚è¿™ä¸ªå‹åŠ›åˆä¸ä»…ä»…æ˜¯å†…å­˜å‹åŠ›ï¼Œå¯ä»¥æƒ³ä¸€ä¸‹å¦‚æœæœåŠ¡ç«¯çš„ç½‘ç»œæ¨¡å‹æ˜¯ä¸€ä¸ªTCPè¿æ¥ä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆå‡ åƒä¸ªè¿æ¥æ„å‘³ç€å‡ åƒä¸ªçº¿ç¨‹ï¼Œå¦‚æ­¤å¤šçš„çº¿ç¨‹ä¼šé€ æˆå¤§é‡çš„çº¿ç¨‹åˆ‡æ¢å¼€é”€ã€‚</p><p>å½“ç„¶ï¼Œ<strong>è¿æ¥æ± æœ€å¤§è¿æ¥æ•°è®¾ç½®å¾—å¤ªå°ï¼Œå¾ˆå¯èƒ½ä¼šå› ä¸ºè·å–è¿æ¥çš„ç­‰å¾…æ—¶é—´å¤ªé•¿ï¼Œå¯¼è‡´ååé‡ä½ä¸‹ï¼Œç”šè‡³è¶…æ—¶æ— æ³•è·å–è¿æ¥</strong>ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¨¡æ‹Ÿä¸‹å‹åŠ›å¢å¤§å¯¼è‡´æ•°æ®åº“è¿æ¥æ± æ‰“æ»¡çš„æƒ…å†µï¼Œæ¥å®è·µä¸‹å¦‚ä½•ç¡®è®¤è¿æ¥æ± çš„ä½¿ç”¨æƒ…å†µï¼Œä»¥åŠæœ‰é’ˆå¯¹æ€§åœ°è¿›è¡Œå‚æ•°ä¼˜åŒ–ã€‚</p><p>é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ªç”¨æˆ·æ³¨å†Œæ–¹æ³•ï¼Œé€šè¿‡@Transactionalæ³¨è§£ä¸ºæ–¹æ³•å¼€å¯äº‹åŠ¡ã€‚å…¶ä¸­åŒ…å«äº†500æ¯«ç§’çš„ä¼‘çœ ï¼Œä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡å¯¹åº”ä¸€ä¸ªTCPè¿æ¥ï¼Œæ‰€ä»¥500å¤šæ¯«ç§’çš„æ—¶é—´éƒ½ä¼šå ç”¨æ•°æ®åº“è¿æ¥ï¼š</p><pre><code>@Transactional\npublic User register(){\n    User user=new User();\n    user.setName(&quot;new-user-&quot;+System.currentTimeMillis());\n    userRepository.save(user);\n    try {\n        TimeUnit.MILLISECONDS.sleep(500);\n    } catch (InterruptedException e) {\n        e.printStackTrace();\n    }\n    return user;\n}\n</code></pre><p>éšåï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶å¯ç”¨register-mbeansï¼Œä½¿Hikariè¿æ¥æ± èƒ½é€šè¿‡JMX MBeanæ³¨å†Œè¿æ¥æ± ç›¸å…³ç»Ÿè®¡ä¿¡æ¯ï¼Œæ–¹ä¾¿è§‚å¯Ÿè¿æ¥æ± ï¼š</p><pre><code>spring.datasource.hikari.register-mbeans=true\n</code></pre><p>å¯åŠ¨ç¨‹åºå¹¶é€šè¿‡JConsoleè¿æ¥è¿›ç¨‹åï¼Œå¯ä»¥çœ‹åˆ°é»˜è®¤æƒ…å†µä¸‹æœ€å¤§è¿æ¥æ•°ä¸º10ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/7b/94/7b8e5aff5a3ef6ade1d8027c20c92f94.png?wh=1846*996\" alt=\"\"></p><p>ä½¿ç”¨wrkå¯¹åº”ç”¨è¿›è¡Œå‹æµ‹ï¼Œå¯ä»¥çœ‹åˆ°è¿æ¥æ•°ä¸€ä¸‹å­ä»0åˆ°äº†10ï¼Œæœ‰20ä¸ªçº¿ç¨‹åœ¨ç­‰å¾…è·å–è¿æ¥ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/b2/ef/b22169b8d8bbfabbb8b93ece11a1f9ef.png?wh=2310*1454\" alt=\"\"></p><p>ä¸ä¹…å°±å‡ºç°äº†æ— æ³•è·å–æ•°æ®åº“è¿æ¥çš„å¼‚å¸¸ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>[15:37:56.156] [http-nio-45678-exec-15] [ERROR] [.a.c.c.C.[.[.[/].[dispatcherServlet]:175 ] - Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed; nested exception is org.springframework.dao.DataAccessResourceFailureException: unable to obtain isolated JDBC connection; nested exception is org.hibernate.exception.JDBCConnectionException: unable to obtain isolated JDBC connection] with root cause\njava.sql.SQLTransientConnectionException: HikariPool-1 - Connection is not available, request timed out after 30000ms.\n</code></pre><p>ä»å¼‚å¸¸ä¿¡æ¯ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæ•°æ®åº“è¿æ¥æ± æ˜¯HikariPoolï¼Œè§£å†³æ–¹å¼å¾ˆç®€å•ï¼Œä¿®æ”¹ä¸€ä¸‹é…ç½®æ–‡ä»¶ï¼Œè°ƒæ•´æ•°æ®åº“è¿æ¥æ± æœ€å¤§è¿æ¥å‚æ•°åˆ°50å³å¯ã€‚</p><pre><code>spring.datasource.hikari.maximum-pool-size=50\n</code></pre><p>ç„¶åï¼Œå†è§‚å¯Ÿä¸€ä¸‹è¿™ä¸ªå‚æ•°æ˜¯å¦é€‚åˆå½“å‰å‹åŠ›ï¼Œæ»¡è¶³éœ€æ±‚çš„åŒæ—¶ä¹Ÿä¸å ç”¨è¿‡å¤šèµ„æºã€‚ä»ç›‘æ§æ¥çœ‹è¿™ä¸ªè°ƒæ•´æ˜¯åˆç†çš„ï¼Œæœ‰ä¸€åŠçš„å¯Œä½™èµ„æºï¼Œå†ä¹Ÿæ²¡æœ‰çº¿ç¨‹éœ€è¦ç­‰å¾…è¿æ¥äº†ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/d2/31/d24f23f05d49378a10a857cd8b9ef031.png?wh=2120*1466\" alt=\"\"></p><p>åœ¨è¿™ä¸ªDemoé‡Œï¼Œæˆ‘çŸ¥é“å‹æµ‹å¤§æ¦‚èƒ½å¯¹åº”ä½¿ç”¨25å·¦å³çš„å¹¶å‘è¿æ¥ï¼Œæ‰€ä»¥ç›´æ¥æŠŠè¿æ¥æ± æœ€å¤§è¿æ¥è®¾ç½®ä¸ºäº†50ã€‚åœ¨çœŸå®æƒ…å†µä¸‹ï¼Œåªè¦æ•°æ®åº“å¯ä»¥æ‰¿å—ï¼Œä½ å¯ä»¥é€‰æ‹©åœ¨é‡åˆ°è¿æ¥è¶…é™çš„æ—¶å€™å…ˆè®¾ç½®ä¸€ä¸ªè¶³å¤Ÿå¤§çš„è¿æ¥æ•°ï¼Œç„¶åè§‚å¯Ÿæœ€ç»ˆåº”ç”¨çš„å¹¶å‘ï¼Œå†æŒ‰ç…§å®é™…å¹¶å‘æ•°ç•™å‡ºä¸€åŠçš„ä½™é‡æ¥è®¾ç½®æœ€ç»ˆçš„æœ€å¤§è¿æ¥ã€‚</p><p>å…¶å®ï¼Œçœ‹åˆ°é”™è¯¯æ—¥å¿—åå†è°ƒæ•´å·²ç»æœ‰ç‚¹å„¿æ™šäº†ã€‚æ›´åˆé€‚çš„åšæ³•æ˜¯ï¼Œ<strong>å¯¹ç±»ä¼¼æ•°æ®åº“è¿æ¥æ± çš„é‡è¦èµ„æºè¿›è¡ŒæŒç»­æ£€æµ‹ï¼Œå¹¶è®¾ç½®ä¸€åŠçš„ä½¿ç”¨é‡ä½œä¸ºæŠ¥è­¦é˜ˆå€¼ï¼Œå‡ºç°é¢„è­¦ååŠæ—¶æ‰©å®¹</strong>ã€‚</p><p>åœ¨è¿™é‡Œæˆ‘æ˜¯ä¸ºäº†æ¼”ç¤ºï¼Œæ‰é€šè¿‡JConsoleæŸ¥çœ‹å‚æ•°é…ç½®åçš„æ•ˆæœï¼Œç”Ÿäº§ä¸Šéœ€è¦æŠŠç›¸å…³æ•°æ®å¯¹æ¥åˆ°æŒ‡æ ‡ç›‘æ§ä½“ç³»ä¸­æŒç»­ç›‘æµ‹ã€‚</p><p><strong>è¿™é‡Œè¦å¼ºè°ƒçš„æ˜¯ï¼Œä¿®æ”¹é…ç½®å‚æ•°åŠ¡å¿…éªŒè¯æ˜¯å¦ç”Ÿæ•ˆï¼Œå¹¶ä¸”åœ¨ç›‘æ§ç³»ç»Ÿä¸­ç¡®è®¤å‚æ•°æ˜¯å¦ç”Ÿæ•ˆã€æ˜¯å¦åˆç†ã€‚ä¹‹æ‰€ä»¥è¦â€œå¼ºè°ƒâ€ï¼Œæ˜¯å› ä¸ºè¿™é‡Œæœ‰å‘</strong>ã€‚</p><p>æˆ‘ä¹‹å‰å°±é‡åˆ°è¿‡è¿™æ ·ä¸€ä¸ªäº‹æ•…ã€‚åº”ç”¨å‡†å¤‡é’ˆå¯¹å¤§ä¿ƒæ´»åŠ¨è¿›è¡Œæ‰©å®¹ï¼ŒæŠŠæ•°æ®åº“é…ç½®æ–‡ä»¶ä¸­Druidè¿æ¥æ± æœ€å¤§è¿æ¥æ•°maxActiveä»50æé«˜åˆ°äº†100ï¼Œä¿®æ”¹åå¹¶æ²¡æœ‰é€šè¿‡ç›‘æ§éªŒè¯ï¼Œç»“æœå¤§ä¿ƒå½“å¤©åº”ç”¨å› ä¸ºè¿æ¥æ± è¿æ¥æ•°ä¸å¤Ÿçˆ†äº†ã€‚</p><p>ç»æ’æŸ¥å‘ç°ï¼Œå½“æ—¶ä¿®æ”¹çš„è¿æ¥æ•°å¹¶æ²¡æœ‰ç”Ÿæ•ˆã€‚åŸå› æ˜¯ï¼Œåº”ç”¨è™½ç„¶ä¸€å¼€å§‹ä½¿ç”¨çš„æ˜¯Druidè¿æ¥æ± ï¼Œä½†åæ¥æ¡†æ¶å‡çº§äº†ï¼ŒæŠŠè¿æ¥æ± æ›¿æ¢ä¸ºäº†Hikariå®ç°ï¼ŒåŸæ¥çš„é‚£äº›é…ç½®å…¶å®éƒ½æ˜¯æ— æ•ˆçš„ï¼Œä¿®æ”¹åçš„å‚æ•°é…ç½®å½“ç„¶ä¹Ÿä¸ä¼šç”Ÿæ•ˆã€‚</p><p>æ‰€ä»¥è¯´ï¼Œå¯¹è¿æ¥æ± è¿›è¡Œè°ƒå‚ï¼Œä¸€å®šè¦çœ¼è§ä¸ºå®ã€‚</p><h2>é‡ç‚¹å›é¡¾</h2><p>ä»Šå¤©ï¼Œæˆ‘ä»¥ä¸‰ç§ä¸šåŠ¡ä»£ç æœ€å¸¸ç”¨çš„Redisè¿æ¥æ± ã€HTTPè¿æ¥æ± ã€æ•°æ®åº“è¿æ¥æ± ä¸ºä¾‹ï¼Œå’Œä½ æ¢è®¨äº†æœ‰å…³è¿æ¥æ± å®ç°æ–¹å¼ã€ä½¿ç”¨å§¿åŠ¿å’Œå‚æ•°é…ç½®çš„ä¸‰å¤§é—®é¢˜ã€‚</p><p>å®¢æˆ·ç«¯SDKå®ç°è¿æ¥æ± çš„æ–¹å¼ï¼ŒåŒ…æ‹¬æ± å’Œè¿æ¥åˆ†ç¦»ã€å†…éƒ¨å¸¦æœ‰è¿æ¥æ± å’Œéè¿æ¥æ± ä¸‰ç§ã€‚è¦æ­£ç¡®ä½¿ç”¨è¿æ¥æ± ï¼Œå°±å¿…é¡»é¦–å…ˆé‰´åˆ«è¿æ¥æ± çš„å®ç°æ–¹å¼ã€‚æ¯”å¦‚ï¼ŒJedisçš„APIå®ç°çš„æ˜¯æ± å’Œè¿æ¥åˆ†ç¦»çš„æ–¹å¼ï¼Œè€ŒApache HttpClientæ˜¯å†…ç½®è¿æ¥æ± çš„APIã€‚</p><p>å¯¹äºä½¿ç”¨å§¿åŠ¿å…¶å®å°±æ˜¯ä¸¤ç‚¹ï¼Œä¸€æ˜¯ç¡®ä¿è¿æ¥æ± æ˜¯å¤ç”¨çš„ï¼ŒäºŒæ˜¯å°½å¯èƒ½åœ¨ç¨‹åºé€€å‡ºä¹‹å‰æ˜¾å¼å…³é—­è¿æ¥æ± é‡Šæ”¾èµ„æºã€‚è¿æ¥æ± è®¾è®¡çš„åˆè¡·å°±æ˜¯ä¸ºäº†ä¿æŒä¸€å®šé‡çš„è¿æ¥ï¼Œè¿™æ ·è¿æ¥å¯ä»¥éšå–éšç”¨ã€‚ä»è¿æ¥æ± è·å–è¿æ¥è™½ç„¶å¾ˆå¿«ï¼Œä½†è¿æ¥æ± çš„åˆå§‹åŒ–ä¼šæ¯”è¾ƒæ…¢ï¼Œéœ€è¦åšä¸€äº›ç®¡ç†æ¨¡å—çš„åˆå§‹åŒ–ä»¥åŠåˆå§‹æœ€å°é—²ç½®è¿æ¥ã€‚ä¸€æ—¦è¿æ¥æ± ä¸æ˜¯å¤ç”¨çš„ï¼Œé‚£ä¹ˆå…¶æ€§èƒ½ä¼šæ¯”éšæ—¶åˆ›å»ºå•ä¸€è¿æ¥æ›´å·®ã€‚</p><p>æœ€åï¼Œè¿æ¥æ± å‚æ•°é…ç½®ä¸­ï¼Œæœ€é‡è¦çš„æ˜¯æœ€å¤§è¿æ¥æ•°ï¼Œè®¸å¤šé«˜å¹¶å‘åº”ç”¨å¾€å¾€å› ä¸ºæœ€å¤§è¿æ¥æ•°ä¸å¤Ÿå¯¼è‡´æ€§èƒ½é—®é¢˜ã€‚ä½†ï¼Œæœ€å¤§è¿æ¥æ•°ä¸æ˜¯è®¾ç½®å¾—è¶Šå¤§è¶Šå¥½ï¼Œå¤Ÿç”¨å°±å¥½ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé’ˆå¯¹æ•°æ®åº“è¿æ¥æ± ã€HTTPè¿æ¥æ± ã€Redisè¿æ¥æ± ç­‰é‡è¦è¿æ¥æ± ï¼ŒåŠ¡å¿…å»ºç«‹å®Œå–„çš„ç›‘æ§å’ŒæŠ¥è­¦æœºåˆ¶ï¼Œæ ¹æ®å®¹é‡è§„åˆ’åŠæ—¶è°ƒæ•´å‚æ•°é…ç½®ã€‚</p><p>ä»Šå¤©ç”¨åˆ°çš„ä»£ç ï¼Œæˆ‘éƒ½æ”¾åœ¨äº†GitHubä¸Šï¼Œä½ å¯ä»¥ç‚¹å‡»<a href=\"https://github.com/JosephZhu1983/java-common-mistakes\">è¿™ä¸ªé“¾æ¥</a>æŸ¥çœ‹ã€‚</p><h2>æ€è€ƒä¸è®¨è®º</h2><ol>\n<li>æœ‰äº†è¿æ¥æ± ä¹‹åï¼Œè·å–è¿æ¥æ˜¯ä»è¿æ¥æ± è·å–ï¼Œæ²¡æœ‰è¶³å¤Ÿè¿æ¥æ—¶è¿æ¥æ± ä¼šåˆ›å»ºè¿æ¥ã€‚è¿™æ—¶ï¼Œè·å–è¿æ¥æ“ä½œå¾€å¾€æœ‰ä¸¤ä¸ªè¶…æ—¶æ—¶é—´ï¼šä¸€ä¸ªæ˜¯ä»è¿æ¥æ± è·å–è¿æ¥çš„æœ€é•¿ç­‰å¾…æ—¶é—´ï¼Œé€šå¸¸å«ä½œè¯·æ±‚è¿æ¥è¶…æ—¶connectRequestTimeoutæˆ–è¿æ¥ç­‰å¾…è¶…æ—¶connectWaitTimeoutï¼›ä¸€ä¸ªæ˜¯è¿æ¥æ± æ–°å»ºTCPè¿æ¥ä¸‰æ¬¡æ¡æ‰‹çš„è¿æ¥è¶…æ—¶ï¼Œé€šå¸¸å«ä½œè¿æ¥è¶…æ—¶connectTimeoutã€‚é’ˆå¯¹JedisPoolã€Apache HttpClientå’ŒHikariæ•°æ®åº“è¿æ¥æ± ï¼Œä½ çŸ¥é“å¦‚ä½•è®¾ç½®è¿™2ä¸ªå‚æ•°å—ï¼Ÿ</li>\n<li>å¯¹äºå¸¦æœ‰è¿æ¥æ± çš„SDKçš„ä½¿ç”¨å§¿åŠ¿ï¼Œæœ€ä¸»è¦çš„æ˜¯é‰´åˆ«å…¶å†…éƒ¨æ˜¯å¦å®ç°äº†è¿æ¥æ± ï¼Œå¦‚æœå®ç°äº†è¿æ¥æ± è¦å°½é‡å¤ç”¨Clientã€‚å¯¹äºNoSQLä¸­çš„MongoDBæ¥è¯´ï¼Œä½¿ç”¨MongoDB Javaé©±åŠ¨æ—¶ï¼ŒMongoClientç±»åº”è¯¥æ˜¯æ¯æ¬¡éƒ½åˆ›å»ºè¿˜æ˜¯å¤ç”¨å‘¢ï¼Ÿä½ èƒ½å¦åœ¨<a href=\"https://mongodb.github.io/mongo-java-driver/3.12/\">å®˜æ–¹æ–‡æ¡£</a>ä¸­æ‰¾åˆ°ç­”æ¡ˆå‘¢ï¼Ÿ</li>\n</ol><p>å…³äºè¿æ¥æ± ï¼Œä½ è¿˜é‡åˆ°è¿‡ä»€ä¹ˆå‘å—ï¼Ÿæˆ‘æ˜¯æœ±æ™”ï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºä¸æˆ‘ç•™è¨€åˆ†äº«ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–åŒäº‹ï¼Œä¸€èµ·äº¤æµã€‚</p>","neighbors":{"left":{"article_title":"03 | çº¿ç¨‹æ± ï¼šä¸šåŠ¡ä»£ç æœ€å¸¸ç”¨ä¹Ÿæœ€å®¹æ˜“çŠ¯é”™çš„ç»„ä»¶","id":210337},"right":{"article_title":"05 | HTTPè°ƒç”¨ï¼šä½ è€ƒè™‘åˆ°è¶…æ—¶ã€é‡è¯•ã€å¹¶å‘äº†å—ï¼Ÿ","id":213273}},"comments":[{"had_liked":false,"id":188320,"user_name":"Darren","can_delete":false,"product_type":"c1","uid":1254968,"ip_address":"","ucode":"CCD2B2C492BE9A","user_header":"https://static001.geekbang.org/account/avatar/00/13/26/38/ef063dc2.jpg","comment_is_top":true,"comment_ctime":1584339541,"is_pvip":true,"replies":[{"id":"72684","content":"<br>å‡è®¾æˆ‘ä»¬å¸Œæœ›è®¾ç½®è¿æ¥è¶…æ—¶5sï¼Œè·å–è¿æ¥è¶…æ—¶10sï¼š<br><br>hikariä¸¤ä¸ªå‚æ•°è®¾ç½®æ–¹å¼ï¼š<br>spring.datasource.hikari.connection-timeout=10000<br>spring.datasource.url=jdbc:mysql:&#47;&#47;localhost:6657&#47;common_mistakes?connectTimeout=5000&amp;characterEncoding=UTF-8&amp;useSSL=false&amp;rewriteBatchedStatements=true<br><br>jedisä¸¤ä¸ªå‚æ•°è®¾ç½®ï¼š<br>JedisPoolConfig config = new JedisPoolConfig();<br>        config.setMaxWaitMillis(10000);<br>        try (JedisPool jedisPool = new JedisPool(config, &quot;127.0.0.1&quot;, 6379, 5000);<br>             Jedis jedis = jedisPool.getResource()) {<br>            return jedis.set(&quot;test&quot;, &quot;test&quot;);<br>        }<br><br>httpclientä¸¤ä¸ªå‚æ•°è®¾ç½®ï¼š<br>RequestConfig requestConfig = RequestConfig.custom()<br>                .setConnectTimeout(5000)<br>                .setConnectionRequestTimeout(10000)<br>                .build();<br>        HttpGet httpGet = new HttpGet(&quot;http:&#47;&#47;127.0.0.1:45678&#47;twotimeoutconfig&#47;test&quot;);<br>        httpGet.setConfig(requestConfig);<br>        try (CloseableHttpResponse response = httpClient.execute(httpGet)) {...","user_name":"ä½œè€…å›å¤","comment_id":188320,"uid":"1001470","ip_address":"","utype":1,"ctime":1584347115,"user_name_real":"æœ±æ™”"}],"discussion_count":5,"race_medal":0,"score":"9.2233722918421996e+18","product_id":100047701,"comment_content":"å®æ“æ€§æ¯”è¾ƒå¼ºï¼Œæ”¶è·æ»¡æ»¡ï¼ï¼ï¼<br>è‡ªä»spring boot 2.xç‰ˆæœ¬åï¼Œæœ‰è¾ƒå¤§çš„æ”¹åŠ¨ï¼š<br>\té»˜è®¤çš„redisçš„é“¾æ¥æ± ä»JedisPoolå˜æˆäº†LettucePoolï¼ŒLettuceä¸»è¦åˆ©ç”¨nettyå®ç°ä¸redisçš„åŒæ­¥å’Œå¼‚æ­¥é€šä¿¡ã€‚æ‰€ä»¥æ›´å®‰å…¨å’Œæ€§èƒ½æ›´å¥½ï¼›<br>\té»˜è®¤çš„æ•°æ®åº“è¿æ¥æ± ä¹Ÿå˜æ›´ä¸ºHikariCPï¼ŒHiKariCP å·ç§°æ˜¯ä¸šç•Œè·‘å¾—æœ€å¿«çš„æ•°æ®åº“è¿æ¥æ± ï¼ŒHiKariCP å®˜æ–¹ç½‘ç«™è§£é‡Šäº†å…¶æ€§èƒ½ä¹‹æ‰€ä»¥å¦‚æ­¤ä¹‹é«˜çš„ç§˜å¯†ã€‚å¾®è§‚ä¸Š HiKariCP ç¨‹åºç¼–è¯‘å‡ºçš„å­—èŠ‚ç æ‰§è¡Œæ•ˆç‡æ›´é«˜ï¼Œç«™åœ¨å­—èŠ‚ç çš„è§’åº¦å»ä¼˜åŒ– Java ä»£ç ï¼ŒHiKariCP çš„ä½œè€…å¯¹æ€§èƒ½çš„æ‰§ç€å¯è§ä¸€æ–‘ï¼Œä¸è¿‡é—æ†¾çš„æ˜¯ä»–å¹¶æ²¡æœ‰è¯¦ç»†è§£é‡Šéƒ½åšäº†å“ªäº›ä¼˜åŒ–ã€‚è€Œå®è§‚ä¸Šä¸»è¦æ˜¯å’Œä¸¤ä¸ªæ•°æ®ç»“æ„æœ‰å…³ï¼Œä¸€ä¸ªæ˜¯ FastListï¼Œå¦ä¸€ä¸ªæ˜¯ ConcurrentBagã€‚<br>\tFastListæ˜¯å¯¹Java Listçš„å¢å¼ºï¼ŒHiKariCPä½œè€…è®¤ä¸ºJava SDKçš„Liståœ¨å…¶ä½¿ç”¨åœºæ™¯ä¸‹æ¯”è¾ƒæ…¢ï¼Œå› æ­¤åœ¨SDKæä¾›çš„Listï¼ˆArrayListçš„removeï¼‰çš„åŸºç¡€ä¸Šåšäº†å¢å¼ºï¼›<br>\tConcurrentBagæ˜¯å¯¹Javaå¹¶å‘é›†åˆçš„å¢å¼ºï¼Œ é€šè¿‡ ThreadLocal åšä¸€æ¬¡é¢„åˆ†é…ï¼Œé¿å…ç›´æ¥ç«äº‰å…±äº«èµ„æºï¼Œéå¸¸é€‚åˆæ± åŒ–èµ„æºçš„åˆ†é…ã€‚<br>è¯•ç€å›ç­”ä¸‹è¯¾åçš„é—®é¢˜ï¼š<br>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼š<br>\tJedisPoolçš„è®¾ç½®ï¼š<br>\t\tè·å–é“¾æ¥è¶…æ—¶ï¼šmaxWait<br>\t\tTCPè¶…æ—¶ï¼šJedisPoolä¸­æœ‰ä¸€ä¸ªsoTimeoutçš„å±æ€§ï¼Œåœ¨é“¾æ¥çš„æ—¶å€™,ä½¿ç”¨socket.setSoTimeout(soTimeout)æ§åˆ¶çš„ã€‚<br>\tHikariCPçš„è®¾ç½®ï¼š<br>\t\tè·å–é“¾æ¥è¶…æ—¶ï¼šconnectionTimeoutã€‚ This property controls the maximum number of milliseconds that a client (that&#39;s you) will wait for a connection from \t\t\t\tthe pool. If this time is exceeded without a connection becoming available, a SQLException will be thrown. Lowest acceptable connection \t\t\ttimeout is 250ms. Default: 30000 (30 seconds)<br>\t\tTCPè¶…æ—¶ï¼šæ•°æ®çš„åº“çš„wait_timeoutå±æ€§å§<br>\tApache HttpClientè®¾ç½®ï¼š<br>\t\tè·å–é“¾æ¥è¶…æ—¶ï¼šconnectionRequestTimeout<br>\t\tå»ºç«‹é“¾æ¥è¶…æ—¶ï¼šconnectionTimeout<br>\t\tç­‰å¾…å“åº”è¶…æ—¶ï¼šsocketTimeout<br><br>ç¬¬äºŒä¸ªé—®é¢˜å°±ä¸å›ç­”äº†ï¼Œå› ä¸ºåˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿˜æ²¡æœ‰åœ¨ç”Ÿäº§ä½¿ç”¨è¿‡Mongoï¼ŒğŸ˜‚ğŸ˜‚ğŸ˜‚ğŸ˜‚<br><br>ä¸Šé¢æœ‰äº›å‚æ•°æ„Ÿè§‰è¯´çš„ä¸å¯¹ï¼Œè¯·è€å¸ˆæŒ‡ç‚¹","like_count":59,"discussions":[{"author":{"id":1254968,"avatar":"https://static001.geekbang.org/account/avatar/00/13/26/38/ef063dc2.jpg","nickname":"Darren","note":"","ucode":"CCD2B2C492BE9A","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":205845,"discussion_content":"æ”¶åˆ°ï¼Œè°¢è°¢è€å¸ˆï¼Œé‚£æˆ‘çš„åº”è¯¥å°±HikariCPçš„TCPé“¾æ¥è¶…æ—¶æœ‰é—®é¢˜ï¼Œåº”è¯¥æ˜¯åœ¨urlåé¢è·Ÿä¸ŠconnectTimeoutï¼Œè°¢è°¢è€å¸ˆï¼ŒğŸ™ğŸ™\nå†æ¬¡æ•´ç†ä¸‹æ•°æ®åº“éƒ¨åˆ†çš„è¶…æ—¶ï¼š\n\né…ç½®æ–‡ä»¶ï¼ˆä»èµ„æºæ± è·å–é“¾æ¥æ—¶é—´ï¼‰\nconnectionTimeoutï¼šè¡¨ç¤ºä»æ•°æ®åº“è¿æ¥æ± DataSourceä¸­è·å–é“¾æ¥è¶…æ—¶ã€‚\n\nurlåé¢å¯ä»¥è·Ÿä¸‹é¢ä¸¤ä¸ªå±æ€§ï¼š\nconnectTimeoutï¼šè¡¨ç¤ºçš„æ˜¯æ•°æ®åº“é©±åŠ¨(mysql-connector-java)ä¸mysqlæœåŠ¡å™¨å»ºç«‹TCPè¿æ¥çš„è¶…æ—¶æ—¶é—´ã€‚\nsocketTimeoutï¼šæ˜¯é€šè¿‡TCPè¿æ¥å‘é€æ•°æ®(åœ¨è¿™é‡Œå°±æ˜¯è¦æ‰§è¡Œçš„sql)åï¼Œç­‰å¾…å“åº”çš„è¶…æ—¶æ—¶é—´ã€‚\n\nç¨‹åºæˆ–è€…é…ç½®æ–‡ä»¶è®¾å®šï¼š\nstatement timeoutï¼šsocket timeoutç»Ÿä¸€é™åˆ¶äº†æ‰€æœ‰SQLæ‰§è¡Œçš„æœ€å¤§è€—æ—¶ï¼Œæœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸ºä¸åŒçš„SQLæŒ‡å®šä¸åŒçš„æœ€å¤§è¶…æ—¶æ—¶é—´ã€‚è¿™å¯ä»¥é€šè¿‡statement timeoutæ¥å®Œæˆã€‚\nStatementå¯¹è±¡æä¾›äº†ä¸€ä¸ªsetQueryTimeoutæ–¹æ³•(å…¶å­ç±»PreparedStatementç»§æ‰¿äº†è¿™ä¸ªæ–¹æ³•)ï¼Œå•ä½æ˜¯ç§’ï¼Œé»˜è®¤å€¼ä¸º0ï¼Œä¹Ÿå°±æ˜¯ ä¸è¶…æ—¶ã€‚\n\nç¨‹åºè®¾å®šï¼š\n transaction timeoutï¼šåœ¨äº‹åŠ¡çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦æ‰§è¡Œå¤šä¸ªsqlï¼Œæ•´ä¸ªäº‹åŠ¡è®¾ç½®è¶…æ—¶æ—¶é—´ã€‚\n\n\n","likes_number":8,"is_delete":false,"is_hidden":false,"ctime":1584349910,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487374,"discussion_content":"\nå‡è®¾æˆ‘ä»¬å¸Œæœ›è®¾ç½®è¿æ¥è¶…æ—¶5sï¼Œè·å–è¿æ¥è¶…æ—¶10sï¼š\n\nhikariä¸¤ä¸ªå‚æ•°è®¾ç½®æ–¹å¼ï¼š\nspring.datasource.hikari.connection-timeout=10000\nspring.datasource.url=jdbc:mysql://localhost:6657/common_mistakes?connectTimeout=5000&amp;amp;characterEncoding=UTF-8&amp;amp;useSSL=false&amp;amp;rewriteBatchedStatements=true\n\njedisä¸¤ä¸ªå‚æ•°è®¾ç½®ï¼š\nJedisPoolConfig config = new JedisPoolConfig();\n        config.setMaxWaitMillis(10000);\n        try (JedisPool jedisPool = new JedisPool(config, &amp;quot;127.0.0.1&amp;quot;, 6379, 5000);\n             Jedis jedis = jedisPool.getResource()) {\n            return jedis.set(&amp;quot;test&amp;quot;, &amp;quot;test&amp;quot;);\n        }\n\nhttpclientä¸¤ä¸ªå‚æ•°è®¾ç½®ï¼š\nRequestConfig requestConfig = RequestConfig.custom()\n                .setConnectTimeout(5000)\n                .setConnectionRequestTimeout(10000)\n                .build();\n        HttpGet httpGet = new HttpGet(&amp;quot;http://127.0.0.1:45678/twotimeoutconfig/test&amp;quot;);\n        httpGet.setConfig(requestConfig);\n        try (CloseableHttpResponse response = httpClient.execute(httpGet)) {...","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584347115,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1055854,"avatar":"https://static001.geekbang.org/account/avatar/00/10/1c/6e/6c5f5734.jpg","nickname":"ç»ˆç»“è€…999å·","note":"","ucode":"33ADE61580B6DD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":209327,"discussion_content":"è¯·é—®statement timeoutå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼Ÿè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584627514,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1254968,"avatar":"https://static001.geekbang.org/account/avatar/00/13/26/38/ef063dc2.jpg","nickname":"Darren","note":"","ucode":"CCD2B2C492BE9A","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1055854,"avatar":"https://static001.geekbang.org/account/avatar/00/10/1c/6e/6c5f5734.jpg","nickname":"ç»ˆç»“è€…999å·","note":"","ucode":"33ADE61580B6DD","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":209541,"discussion_content":"ä½ è¯´çš„é…ç½®æ–‡ä»¶æ˜¯springçš„å—ï¼Ÿé‚£ä¸ªæˆ‘æ²¡æœ‰è¯•è¿‡ï¼Œmybatiesçš„æ–‡ä»¶æ˜¯å¯ä»¥çš„","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584633747,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":209327,"ip_address":""},"score":209541,"extra":""}]},{"author":{"id":1750549,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/b6/15/e2cfd10d.jpg","nickname":"ImYoursÂ°","note":"","ucode":"51F653129034C9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367023,"discussion_content":"æœ‰æ²¡æœ‰lettuceçš„ç›¸å…³é…ç½®åˆ†äº«","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618237327,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187537,"user_name":"Wiggle Wiggle","can_delete":false,"product_type":"c1","uid":1036052,"ip_address":"","ucode":"EFE746551BA998","user_header":"https://static001.geekbang.org/account/avatar/00/0f/cf/14/384258ba.jpg","comment_is_top":true,"comment_ctime":1584154316,"is_pvip":false,"replies":[{"id":"72364","content":"è‡ªå·±å°è£…å¿…è¦ä¸å¤§ï¼Œç„¶åå¦‚æœéœ€è¦èµ°httpçš„è¯ç”¨jolokiaï¼Œæˆ–è€…ä½¿ç”¨prometheusçš„jmx_exporterä»¥agentæ–¹å¼æš´éœ²mbeansï¼Œhttps:&#47;&#47;github.com&#47;prometheus&#47;jmx_exporter","user_name":"ä½œè€…å›å¤","comment_id":187537,"uid":"1001470","ip_address":"","utype":1,"ctime":1584157790,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"9.2233721801729004e+18","product_id":100047701,"comment_content":"è¯·é—®å¯¹äºè¿æ¥æ± çš„ç›‘æ§ï¼Œæ˜¯æŠŠç›‘æ§ç³»ç»Ÿç›´è¿JMXï¼Œç›‘æ§ã€ä¿®æ”¹æ“ä½œéƒ½èµ°è¿æ¥æ± å·²ç»å®ç°å¥½çš„JMXæ¯”è¾ƒå¥½ï¼Ÿè¿˜æ˜¯è‡ªå·±åšä¸€å±‚å°è£…ï¼Œå¯¹å¤–æš´éœ²æ¥å£ï¼Œä»¥ç¼–ç¨‹æ–¹å¼è·å–ã€è®¾ç½®å‚æ•°æ¯”è¾ƒå¥½ï¼Ÿ","like_count":34,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487136,"discussion_content":"è‡ªå·±å°è£…å¿…è¦ä¸å¤§ï¼Œç„¶åå¦‚æœéœ€è¦èµ°httpçš„è¯ç”¨jolokiaï¼Œæˆ–è€…ä½¿ç”¨prometheusçš„jmx_exporterä»¥agentæ–¹å¼æš´éœ²mbeansï¼Œhttps://github.com/prometheus/jmx_exporter","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584157790,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188136,"user_name":"ğŸ‘½","can_delete":false,"product_type":"c1","uid":1274117,"ip_address":"","ucode":"D313AF941B412D","user_header":"https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg","comment_is_top":true,"comment_ctime":1584323636,"is_pvip":false,"replies":[{"id":"72675","content":"æ€»ç»“çš„ä¸é”™","user_name":"ä½œè€…å›å¤","comment_id":188136,"uid":"1001470","ip_address":"","utype":1,"ctime":1584330528,"user_name_real":"æœ±æ™”"}],"discussion_count":2,"race_medal":0,"score":"9.2233720856836997e+18","product_id":100047701,"comment_content":"ä¸ªäººæ€»ç»“ï¼š<br>1. æ± åŒ–æŠ€æœ¯çš„æ ¸å¿ƒåœ¨äºï¼Œåœ¨é±¼å¡˜å…»å¥½ä¸€ç¾¤é±¼ï¼Œéœ€è¦çš„æ—¶å€™å°±ä»é‡Œé¢æ‹¿ä¸€æ¡ï¼Œç”¨å®Œå†æ”¾å›å»ã€‚è€Œä¸æ˜¯è‡ªå·±ç”Ÿäº§ä¸€æ¡é±¼ï¼Œç„¶åç”¨å®Œå°±é”€æ¯ã€‚ä»è€Œå‡å°‘äº†å¼€é”€ã€‚<br>2. å¤§å¤šå·²ç»å®ç°çš„è¿æ¥æ± ï¼Œéƒ½æ˜¯æœ‰çº¿ç¨‹å®‰å…¨å¤„ç†çš„ã€‚é€šå¸¸æ¯”ä¸ªäººåˆ›å»ºç®¡ç†è¿æ¥æ›´åŠ å®‰å…¨ã€‚<br>3. ä½¿ç”¨äº†è¿æ¥æ± æŠ€æœ¯ï¼Œå°±è¦ä¿è¯è¿æ¥æ± èƒ½å¤Ÿè¢«æœ‰æ•ˆå¤ç”¨ã€‚é¢‘ç¹åˆ›å»ºè¿æ¥æ± æ¯”é¢‘ç¹åˆ›å»ºé“¾æ¥æ›´åŠ è€—è´¹èµ„æºã€‚<br>4. è¿æ¥æ± çš„å‚æ•°é…ç½®è¦æ ¹æ®å®é™…æƒ…å†µï¼Œå¹¶ä¸å­˜åœ¨å¤šå¤šç›Šå–„<br>5. è¿æ¥æ± çš„ä¸»è¦å¥½å¤„ï¼šï¼ˆ1ï¼‰å‡å°‘èµ„æºæ¶ˆè€—ï¼Œï¼ˆ2ï¼‰åˆ©ç”¨ç°æœ‰çš„çº¿åŸå®‰å…¨å®ç°ï¼Œï¼ˆ3ï¼‰æå‡å¹¶å‘é‡","like_count":11,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487346,"discussion_content":"æ€»ç»“çš„ä¸é”™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584330528,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1102228,"avatar":"https://static001.geekbang.org/account/avatar/00/10/d1/94/6c73ab00.jpg","nickname":"å¶è½","note":"","ucode":"F836A8144518BA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":302936,"discussion_content":"å•¥å«æŠŠé±¼ç”¨å®Œå†æ”¾å›å»ï¼Œè¯·è§£é‡Šä¸‹ï¼Œè°¢è°¢","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1599093743,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187627,"user_name":"èš‚èšå†…æ¨+v","can_delete":false,"product_type":"c1","uid":1050508,"ip_address":"","ucode":"24B10AEE54B3FD","user_header":"https://static001.geekbang.org/account/avatar/00/10/07/8c/0d886dcc.jpg","comment_is_top":false,"comment_ctime":1584176763,"is_pvip":false,"replies":[{"id":"72408","content":"ä¼˜é›…å…³é—­æ€»æ˜¯æ›´å¥½çš„","user_name":"ä½œè€…å›å¤","comment_id":187627,"uid":"1001470","ip_address":"","utype":1,"ctime":1584182390,"user_name_real":"æœ±æ™”"}],"discussion_count":3,"race_medal":0,"score":"35943915131","product_id":100047701,"comment_content":"é€€å‡ºç¨‹åºå‰ä¸ºä»€ä¹ˆè¦å…³é—­è¿æ¥æ± å•Šï¼Œç¨‹åºéƒ½ç»“æŸäº†è¿æ¥ä¸å°±é‡Šæ”¾äº†ä¹ˆ","like_count":8,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487170,"discussion_content":"ä¼˜é›…å…³é—­æ€»æ˜¯æ›´å¥½çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584182390,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1107666,"avatar":"https://static001.geekbang.org/account/avatar/00/10/e6/d2/638ca831.jpg","nickname":"z","note":"","ucode":"CDB0BE8562ECB6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":360642,"discussion_content":"ä¸»è¦æ˜¯ä¸ºäº†å‡å°‘è¢«è°ƒç”¨æ–¹çš„èµ„æºæ¶ˆè€—å§","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1616497702,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1965236,"avatar":"","nickname":"Geek_c703f7","note":"","ucode":"0D49860F83534E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":237819,"discussion_content":"ä¼˜é›…å…³é—­çš„å‰ææ˜¯ä¸æ˜¯ä¸èƒ½ç”¨kill -9 pid ? ä½†å¦‚æœkill pidæˆ‘é‡åˆ°è¿‡æ€ä¸æ­»è¿›ç¨‹çš„æƒ…å†µï¼Œè¯·æ•™è€å¸ˆä¸šå†…æ ‡å‡†åšæ³•æ˜¯æ€æ ·çš„ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587189243,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187488,"user_name":"æ¯å¤©æ™’ç™½ç‰™","can_delete":false,"product_type":"c1","uid":1004698,"ip_address":"","ucode":"A1B102CD933DEA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/54/9a/76c0af70.jpg","comment_is_top":false,"comment_ctime":1584143457,"is_pvip":false,"replies":[{"id":"72451","content":"å¦‚æœ‰æ”¶è´§ï¼Œæ¬¢è¿è½¬å‘","user_name":"ä½œè€…å›å¤","comment_id":187488,"uid":"1001470","ip_address":"","utype":1,"ctime":1584241321,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":1,"score":"35943881825","product_id":100047701,"comment_content":"å¹²è´§æ»¡æ»¡ï¼Œè¿˜éœ€è¦æ…¢æ…¢æ¶ˆåŒ–ä¸€ä¸‹","like_count":8,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487120,"discussion_content":"å¦‚æœ‰æ”¶è´§ï¼Œæ¬¢è¿è½¬å‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584241321,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188254,"user_name":"ğŸ‘½","can_delete":false,"product_type":"c1","uid":1274117,"ip_address":"","ucode":"D313AF941B412D","user_header":"https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg","comment_is_top":false,"comment_ctime":1584331870,"is_pvip":false,"replies":[{"id":"72682","content":"å›ç­”ä¸€ä¸‹Hikariçš„é…ç½®ï¼Œå…¶ConnectionTimeoutæ˜¯ä»è¿æ¥æ± è·å–æ•°æ®åº“è¿æ¥çš„è¶…æ—¶ï¼Œä¸æ˜¯å’ŒMySQLå»ºç«‹è¿æ¥çš„è¶…æ—¶ï¼Œåè€…éœ€è¦è®¾ç½®JDBCè¿æ¥å­—ç¬¦ä¸²ä¸­çš„connectTimeoutå±æ€§ã€‚å¯¹äºHikariçš„JavaConfigé…ç½®è¿™2ä¸ªå‚æ•°çš„æ–¹å¼æ˜¯ï¼š<br><br>@Bean<br>    public DataSource dataSource(){<br>        HikariConfig hikariConfig = new HikariConfig();<br>        hikariConfig.setConnectionTimeout(2400);<br>        hikariConfig.setJdbcUrl(&quot;jdbc:mysql:&#47;&#47;localhost:6658&#47;common_mistakes&quot;);<br>        hikariConfig.addDataSourceProperty(&quot;connectTimeout&quot;, &quot;1200&quot;);<br>        HikariDataSource dataSource = new HikariDataSource(hikariConfig);<br>        return dataSource;<br>    }","user_name":"ä½œè€…å›å¤","comment_id":188254,"uid":"1001470","ip_address":"","utype":1,"ctime":1584343121,"user_name_real":"æœ±æ™”"}],"discussion_count":3,"race_medal":0,"score":"23059168350","product_id":100047701,"comment_content":"hikariå…·ä½“é…ç½®é¡¹ä¸ºapplication.yml ä¸­ spring.datasource.hikari.connection-timeout<br>ç‚¹è¿›å»å¯ä»¥å‘ç°æ˜¯ HikariDataSource ç±»ï¼Œç»§æ‰¿äº†HikariConfigã€‚<br>ç‚¹è¿›HikariConfigå¯çœ‹å‡º connectionTimeoutä¸å…è®¸å°äº250æ¯«ç§’ï¼Œå°äº250msä¼šè¢«å¼ºåˆ¶é‡ç½®ä¸º30ç§’ã€‚<br>å‚æ•°connectionTimeoutå®šä¹‰æ˜¯å¹¶æœªèµ‹åˆå§‹å€¼çš„åŸå§‹ç±»å‹longï¼Œåˆå§‹å€¼åº”è¯¥æ˜¯0Lï¼›<br>æ‰€ä»¥ï¼Œä¸ªäººåˆ¤æ–­ï¼Œé»˜è®¤çš„connectionTimeoutæ•°å€¼å°±æ˜¯30ç§’ã€‚<br>å¦‚æœ‰çº°æ¼ï¼Œæ¬¢è¿æŒ‡æ­£<br><br>","like_count":5,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487364,"discussion_content":"å›ç­”ä¸€ä¸‹Hikariçš„é…ç½®ï¼Œå…¶ConnectionTimeoutæ˜¯ä»è¿æ¥æ± è·å–æ•°æ®åº“è¿æ¥çš„è¶…æ—¶ï¼Œä¸æ˜¯å’ŒMySQLå»ºç«‹è¿æ¥çš„è¶…æ—¶ï¼Œåè€…éœ€è¦è®¾ç½®JDBCè¿æ¥å­—ç¬¦ä¸²ä¸­çš„connectTimeoutå±æ€§ã€‚å¯¹äºHikariçš„JavaConfigé…ç½®è¿™2ä¸ªå‚æ•°çš„æ–¹å¼æ˜¯ï¼š\n\n@Bean\n    public DataSource dataSource(){\n        HikariConfig hikariConfig = new HikariConfig();\n        hikariConfig.setConnectionTimeout(2400);\n        hikariConfig.setJdbcUrl(&amp;quot;jdbc:mysql://localhost:6658/common_mistakes&amp;quot;);\n        hikariConfig.addDataSourceProperty(&amp;quot;connectTimeout&amp;quot;, &amp;quot;1200&amp;quot;);\n        HikariDataSource dataSource = new HikariDataSource(hikariConfig);\n        return dataSource;\n    }","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584343121,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":206119,"discussion_content":"å¯¹äºå…¶ä»–ç»„ä»¶çš„é…ç½®å¯ä»¥çœ‹ä¸€ä¸‹æˆ‘å¯¹Darrené—®é¢˜çš„å›å¤","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584367617,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1274117,"avatar":"https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg","nickname":"ğŸ‘½","note":"","ucode":"D313AF941B412D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":206405,"discussion_content":"ğŸ‘Œ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584403983,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":206119,"ip_address":""},"score":206405,"extra":""}]}]},{"had_liked":false,"id":188156,"user_name":"ğŸ‘½","can_delete":false,"product_type":"c1","uid":1274117,"ip_address":"","ucode":"D313AF941B412D","user_header":"https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg","comment_is_top":false,"comment_ctime":1584325424,"is_pvip":false,"replies":[{"id":"72677","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","comment_id":188156,"uid":"1001470","ip_address":"","utype":1,"ctime":1584330565,"user_name_real":"æœ±æ™”"}],"discussion_count":3,"race_medal":0,"score":"23059161904","product_id":100047701,"comment_content":"è¯¾åé¢˜2ï¼š<br>å—é™äºæœ¬äººè‹±æ–‡æ°´å¹³ï¼Œæ— å¥ˆä¸ä½¿ç”¨è°·æ­Œç¿»è¯‘é˜…è¯»æ–‡æ¡£ã€‚ä»æ–‡æ¡£ä¸­å¾—çŸ¥ï¼ŒMongoClient å¯¹è±¡çš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿åº”è¯¥æ˜¯ï¼šä½¿ç”¨ MongoClients.create()ï¼ˆæˆ–è€…å…¶ä»–æœ‰å‚ï¼‰ æ–¹æ³•åˆ›å»ºï¼Œå¹¶å†æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å®ƒã€‚æ–‡æ¡£å†…å®¹å¦‚ä¸‹ï¼š<br><br>MongoClient ï¼ˆä»3.7ç‰ˆæœ¬å¼€å§‹ï¼‰<br>ä¸€ä¸ªMongoClientå®ä¾‹è¡¨ç¤ºåˆ°æ•°æ®åº“è¿æ¥æ± ; MongoClientå³ä½¿æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œæ‚¨ä¹Ÿåªéœ€è¦ä¸€ä¸ªç±»çš„å®ä¾‹ã€‚<br><br>é‡è¦<br>é€šå¸¸ï¼Œæ‚¨åªMongoClientä¸ºç»™å®šçš„MongoDBéƒ¨ç½²åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼ˆä¾‹å¦‚ç‹¬ç«‹å®ä¾‹ï¼Œå‰¯æœ¬é›†æˆ–åˆ†ç‰‡ç¾¤é›†ï¼‰ï¼Œå¹¶åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­ä½¿ç”¨å®ƒã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ç¡®å®åˆ›å»ºäº†å¤šä¸ªå®ä¾‹ï¼š<br>æ‰€æœ‰èµ„æºä½¿ç”¨é™åˆ¶ï¼ˆä¾‹å¦‚ï¼Œæœ€å¤§è¿æ¥æ•°ç­‰ï¼‰é€‚ç”¨äºæ¯ä¸ªMongoClientå®ä¾‹ã€‚<br>è¦å¤„ç½®å®ä¾‹ï¼Œè¯·è‡´ç”µMongoClient.close()ä»¥æ¸…ç†èµ„æºã€‚<br><br>","like_count":5,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487351,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584330565,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1024164,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a0/a4/b060c723.jpg","nickname":"é˜¿æ–¯è’‚èŠ¬","note":"","ucode":"61D5E3BDA4EBC5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":284036,"discussion_content":"æœ€åè¿™å¥ã€Œè¯·è‡´ç”µMongoClient.close()ã€ï¼ŒçœŸå®æš´éœ²äº†æœºå™¨ç¿»è¯‘(ëˆˆ_ëˆˆ)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592436262,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1274117,"avatar":"https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg","nickname":"ğŸ‘½","note":"","ucode":"D313AF941B412D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1024164,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a0/a4/b060c723.jpg","nickname":"é˜¿æ–¯è’‚èŠ¬","note":"","ucode":"61D5E3BDA4EBC5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":284075,"discussion_content":"è¦ä¸æ˜¯æœºå™¨ç¿»è¯‘æˆ‘éƒ½æ‡’å¾—ç²˜å…¨æ–‡ï¼Œç›´æ¥æè¿°é‡ç‚¹å°±å®Œäº‹äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592441742,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":284036,"ip_address":""},"score":284075,"extra":""}]}]},{"had_liked":false,"id":195807,"user_name":"justin","can_delete":false,"product_type":"c1","uid":1178721,"ip_address":"","ucode":"8EEB37B7914975","user_header":"https://static001.geekbang.org/account/avatar/00/11/fc/61/241b5c75.jpg","comment_is_top":false,"comment_ctime":1585216163,"is_pvip":false,"replies":[{"id":"74314","content":"1ã€å…¶å®æœ¬æ–‡è¯´çš„ç‚¹ä¸æ˜¯å¤ç”¨è¿æ¥ï¼Œè€Œæ˜¯å¤ç”¨è¿æ¥æ± ï¼Œä¹Ÿå°±æ˜¯CloseableHttpClientï¼Œä¸€ä¸ªTCPè¿æ¥åŒæ—¶è‡ªç„¶æ— æ³•å®ç°å¤šä¸ªHTTPè¯·æ±‚çš„å¤ç”¨<br>2ã€æ–‡ä¸­è®¾ç½®ä¸º1åªæ˜¯ä¸¾ä¾‹ï¼Œå®é™…åº”ç”¨çš„æ—¶å€™æ˜¾ç„¶åº”è¯¥è®¾ç½®ä¸€ä¸ªåˆç†çš„æœ€å¤§å€¼ï¼Œä¸èƒ½æ˜¯1ã€‚æ‰©å¤§MaxConnPerRouteå’ŒMaxConnTotalä¹‹åqpsé™ä½ï¼Œè¿™ä¸ªæœ‰æ²¡æœ‰å®é™…çš„æ€§èƒ½æ•°æ®ï¼Ÿä½ æ˜¯æ€ä¹ˆæµ‹è¯•çš„å‘¢ï¼Ÿ","user_name":"ä½œè€…å›å¤","comment_id":195807,"uid":"1001470","ip_address":"","utype":1,"ctime":1585218592,"user_name_real":"æœ±æ™”"}],"discussion_count":2,"race_medal":0,"score":"18765085347","product_id":100047701,"comment_content":"è€å¸ˆä½ å¥½ï¼Œçœ‹äº†è¿™ç¯‡æ–‡ç« æ„Ÿè§‰æ”¶è·æ»¡æ»¡ï¼Œç„¶åå…³äºä¸Šé¢çš„CloseableHttpClientæœ‰ä¸ªå‡ ä¸ªç–‘é—®ï¼š<br>1ã€å¤ç”¨åŒä¸€ä¸ªtcpè¿æ¥çš„æ—¶å€™æ¯”æ¯æ¬¡éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„tcpè¿æ¥çš„QPSé«˜å¾ˆå¤šï¼Œå½“æœ‰å¤§é‡httpè¯·æ±‚æœåŠ¡ç«¯æ—¶ï¼Œæ¯ä¸ªhttpè¿æ¥éƒ½å…±ç”¨åŒä¸€ä¸ªtcpè¿æ¥æ—¶ï¼Œè¿™ç§æƒ…å†µä¸‹ä¸ä¼šé€ æˆå…¶ä¸­ä¸€äº›httpè¯·æ±‚çš„å“åº”é€Ÿåº¦å˜æ…¢å—ã€‚<br>2ã€<br>httpClient = HttpClients.custom().setMaxConnPerRoute(1).setMaxConnTotal(1).evictIdleConnections(60, TimeUnit.SECONDS).build();<br>å½“æˆ‘å°è¯•å»æ‰©å¤§setMaxConnTotalè¿™ä¸ªæœ€å¤§è¿æ¥æ•°æ—¶ï¼Œqpsåè€Œé™ä½äº†ã€‚å¦‚æœçº¿ä¸Šæœ‰ä¸Šåƒqpsçš„è¯ï¼Œè®¾ç½®è¿æ¥æ•°ä¸º1å°±å¯ä»¥äº†å—ã€‚<br>","like_count":4,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489160,"discussion_content":"1ã€å…¶å®æœ¬æ–‡è¯´çš„ç‚¹ä¸æ˜¯å¤ç”¨è¿æ¥ï¼Œè€Œæ˜¯å¤ç”¨è¿æ¥æ± ï¼Œä¹Ÿå°±æ˜¯CloseableHttpClientï¼Œä¸€ä¸ªTCPè¿æ¥åŒæ—¶è‡ªç„¶æ— æ³•å®ç°å¤šä¸ªHTTPè¯·æ±‚çš„å¤ç”¨\n2ã€æ–‡ä¸­è®¾ç½®ä¸º1åªæ˜¯ä¸¾ä¾‹ï¼Œå®é™…åº”ç”¨çš„æ—¶å€™æ˜¾ç„¶åº”è¯¥è®¾ç½®ä¸€ä¸ªåˆç†çš„æœ€å¤§å€¼ï¼Œä¸èƒ½æ˜¯1ã€‚æ‰©å¤§MaxConnPerRouteå’ŒMaxConnTotalä¹‹åqpsé™ä½ï¼Œè¿™ä¸ªæœ‰æ²¡æœ‰å®é™…çš„æ€§èƒ½æ•°æ®ï¼Ÿä½ æ˜¯æ€ä¹ˆæµ‹è¯•çš„å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585218592,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1178721,"avatar":"https://static001.geekbang.org/account/avatar/00/11/fc/61/241b5c75.jpg","nickname":"justin","note":"","ucode":"8EEB37B7914975","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":214837,"discussion_content":"è°¢è°¢è€å¸ˆçš„å›å¤ã€‚\n1ã€å¯¹äºç¬¬ä¸€ä¸ªç–‘é—®ï¼Œrightå’Œwrong2çš„qpså·®è·æ¯”è¾ƒå¤§ï¼Œæœ‰ä¸ªåŸå› æ˜¯ä¸æ˜¯å› ä¸ºCloseableHttpClientè¯·æ±‚çš„æ˜¯æœ¬åœ°æ¥å£ï¼Œå‡ ä¹æ²¡æœ‰ç½‘ç»œå»¶è¿Ÿå’Œä¸šåŠ¡æ‰§è¡Œæ—¶é—´ã€‚å› ä¸ºå¦‚æœåªæœ‰ä¸€ä¸ªè¿æ¥æ± ï¼Œä¸€ä¸ªhttpè¯·æ±‚åº”è¯¥è¦ç­‰å‰é¢ä¸€ä¸ªhttpå››æ¬¡æŒ¥æ‰‹åæ‰èƒ½è¿›è¡Œå¤ç”¨çš„æ˜¯å—ã€‚æˆ‘å°è¯•æŠŠCloseableHttpClientè¦è¯·æ±‚çš„æ¥å£å»¶è¿Ÿ20msè¿”å›ã€‚è¿™æ—¶å€™rightå’Œwrong2çš„qpså°±å·®ä¸å¤šäº†ã€‚\nHttpClients.custom().setMaxConnPerRoute(5).setMaxConnTotal(5).evictIdleConnections(60, TimeUnit.SECONDS).build(); å³ä½¿åŠ å¤§äº†rightçš„æœ€å¤§è¿æ¥æ•°æµ‹è¯•æ•°æ®ä¹Ÿæ˜¯ä¸€æ ·çš„\n\nlinjunchengdeMacBook-Pro:wrk linjuncheng$ ./wrk -t10 -c100 -d30s http://127.0.0.1:8080/http/right\nRunning 30s test @ http://127.0.0.1:8080/http/right\n  10 threads and 100 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency    25.71ms    7.20ms 263.30ms   99.74%\n    Req/Sec    37.17      8.76    50.00     85.00%\n  1167 requests in 30.09s, 131.26KB read\n  Socket errors: connect 0, read 0, write 0, timeout 11\nRequests/sec:     38.78\nTransfer/sec:      4.36KB\nlinjunchengdeMacBook-Pro:wrk linjuncheng$ ./wrk -t10 -c100 -d30s http://127.0.0.1:8080/http/wrong2\nRunning 30s test @ http://127.0.0.1:8080/http/wrong2\n  10 threads and 100 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency    27.15ms    3.41ms  84.78ms   94.25%\n    Req/Sec    35.96      6.69    40.00     77.85%\n  1106 requests in 30.08s, 124.41KB read\n  Socket errors: connect 0, read 0, write 0, timeout 11\nRequests/sec:     36.76\nTransfer/sec:      4.14KB\nlinjunchengdeMacBook-Pro:wrk linjuncheng$ \n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585236092,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187551,"user_name":"Husiun","can_delete":false,"product_type":"c1","uid":1448664,"ip_address":"","ucode":"F783484743BFE4","user_header":"https://static001.geekbang.org/account/avatar/00/16/1a/d8/9ae1bdb9.jpg","comment_is_top":false,"comment_ctime":1584156802,"is_pvip":false,"replies":[{"id":"72365","content":"æœ‰æ”¶è´§å°±å¥½","user_name":"ä½œè€…å›å¤","comment_id":187551,"uid":"1001470","ip_address":"","utype":1,"ctime":1584157816,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"18764025986","product_id":100047701,"comment_content":"æ¯æ¬¡æ›´æ–°éƒ½æ˜¯ç¬¬ä¸€æ—¶é—´æ‰“å¼€ï¼Œæ¯ä¸€è¯¾éƒ½å¹²è´§æ»¡æ»¡ï¼Œå¿…é¡»ç»™è€å¸ˆèµä¸€ä¸ªï¼Œhttpé‚£ä¸ªå¹³æ—¶ç ”ç©¶ä¸å¤šè¿˜éœ€è¦å¥½å¥½æ¶ˆåŒ–ä¸€ä¸‹ã€‚","like_count":4,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487144,"discussion_content":"æœ‰æ”¶è´§å°±å¥½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584157816,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187496,"user_name":"pedro","can_delete":false,"product_type":"c1","uid":1200704,"ip_address":"","ucode":"F40C839DDFD599","user_header":"https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg","comment_is_top":false,"comment_ctime":1584147213,"is_pvip":false,"replies":[{"id":"72357","content":"å¯ä»¥éƒ½æ”¾åˆ°ä¸€ä¸ªThreadï¼Œæ”¾åˆ°å¤šä¸ªçš„è¯ä¼šå¹¶è¡Œæ‰§è¡Œï¼Œåªè¦ä¸æ˜¯å¤ªå¤šé—®é¢˜ä¸å¤§ã€‚æˆ–è€…ç”¨Springçš„è¯è¿˜å¯ä»¥ä½¿ç”¨@PreDestroyæ¥å®ç°èµ„æºé‡Šæ”¾ã€‚","user_name":"ä½œè€…å›å¤","comment_id":187496,"uid":"1001470","ip_address":"","utype":1,"ctime":1584150766,"user_name_real":"æœ±æ™”"}],"discussion_count":2,"race_medal":0,"score":"18764016397","product_id":100047701,"comment_content":"å¹²è´§å¾ˆå¤šï¼Œæ”¶è·å¾ˆå¤§ã€‚é—®è€å¸ˆä¸€ä¸ªé—®é¢˜ï¼Œä½¿ç”¨hookæ¥å…³é—­è¿æ¥æ± çš„æ—¶å€™ï¼Œéƒ½ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œé‚£å¦‚æœæœ‰å¤šä¸ªè¿æ¥æ± ï¼Œæ¯ä¸ªè¿æ¥æ± éƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ¥è°ƒç”¨hookï¼Œè¿™æ ·åšæ˜¯å¦æœ‰ç‚¹å¥¢ä¾ˆï¼Œæœ‰æ²¡æœ‰æ›´ä¼˜çš„åŠæ³•ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487122,"discussion_content":"å¯ä»¥éƒ½æ”¾åˆ°ä¸€ä¸ªThreadï¼Œæ”¾åˆ°å¤šä¸ªçš„è¯ä¼šå¹¶è¡Œæ‰§è¡Œï¼Œåªè¦ä¸æ˜¯å¤ªå¤šé—®é¢˜ä¸å¤§ã€‚æˆ–è€…ç”¨Springçš„è¯è¿˜å¯ä»¥ä½¿ç”¨@PreDestroyæ¥å®ç°èµ„æºé‡Šæ”¾ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584150766,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1036052,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/cf/14/384258ba.jpg","nickname":"Wiggle Wiggle","note":"","ucode":"EFE746551BA998","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":204319,"discussion_content":"ä½ å¯ä»¥ç”¨ä¸€ä¸ªé›†åˆæ”¶é›†æ‰€æœ‰poolçš„å¼•ç”¨ï¼Œç„¶ååœ¨ä¸€ä¸ªhooké‡Œé¢éå†é›†åˆæŠŠæ‰€æœ‰poolå…³ä¸Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584154066,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":203207,"user_name":"boyxie","can_delete":false,"product_type":"c1","uid":1018342,"ip_address":"","ucode":"FD55E5C569AC58","user_header":"https://static001.geekbang.org/account/avatar/00/0f/89/e6/ab403ccb.jpg","comment_is_top":false,"comment_ctime":1586156202,"is_pvip":false,"replies":[{"id":"75967","content":"è¿™ä¸ªé—®é¢˜æˆ‘ä»¬ä¹Ÿé‡åˆ°è¿‡ï¼Œçœ‹ä¸‹æ­¤æ–‡ä½ å°±æ˜ç™½å’‹å›äº‹äº†ï¼šhttps:&#47;&#47;www.elietio.xyz&#47;2019&#47;12&#47;keepAlive%E8%A7%A3%E5%86%B3druid%E7%A9%BA%E9%97%B2%E8%BF%9E%E6%8E%A5socket%20timeout%2015%E5%88%86%E9%92%9F.html<br>","user_name":"ä½œè€…å›å¤","comment_id":203207,"uid":"1001470","ip_address":"","utype":1,"ctime":1586180801,"user_name_real":"æœ±æ™”"}],"discussion_count":3,"race_medal":0,"score":"14471058090","product_id":100047701,"comment_content":"æ•°æ®åº“è¿æ¥æ± Druid åœ¨æ•°æ®åº“è¿æ¥è¢«ç½‘ç»œä¸­æ–­åï¼Œéœ€è¦15åˆ†é’Ÿçš„é‡è¿æ—¶é—´ï¼Œè¿™ä¸ªè¶…æ—¶æ—¶é—´ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆä¹…ï¼Ÿæ€»ç»“ç½‘ä¸Šçš„èµ„æ–™å¤§è‡´æ˜¯è·å–è¿æ¥çš„æ—¶å€™ä¼šå» testConnectionInternalï¼Œç”±äºåº•å±‚socketè¢«æ–­å¼€ï¼Œä¼šä¸€ç›´è¢«é˜»å¡ç›´åˆ°æŠ›å¼‚å¸¸ï¼Œè€å¸ˆå¯ä»¥å¸®å¿™åˆ†æä¸€ä¸‹å—ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490798,"discussion_content":"è¿™ä¸ªé—®é¢˜æˆ‘ä»¬ä¹Ÿé‡åˆ°è¿‡ï¼Œçœ‹ä¸‹æ­¤æ–‡ä½ å°±æ˜ç™½å’‹å›äº‹äº†ï¼šhttps://www.elietio.xyz/2019/12/keepAlive%E8%A7%A3%E5%86%B3druid%E7%A9%BA%E9%97%B2%E8%BF%9E%E6%8E%A5socket%20timeout%2015%E5%88%86%E9%92%9F.html\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586180801,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1130275,"avatar":"https://static001.geekbang.org/account/avatar/00/11/3f/23/8ff389d2.jpg","nickname":"éƒæ–¹æ—","note":"","ucode":"8ABEAFDA815DDE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376551,"discussion_content":"ä»Šå¤©ç‚¹å‡»å‘ç°é“¾æ¥å¤±æ•ˆäº†, è¡¥ä¸€ä¸ªæ–°çš„è¿æ¥ https://www.elietio.xyz/posts/fd295ff1.html","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1622186841,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1542987,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/4b/fa52d222.jpg","nickname":"è¡Œåˆ™å°†è‡³","note":"","ucode":"DB972F2DF059C4","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":1130275,"avatar":"https://static001.geekbang.org/account/avatar/00/11/3f/23/8ff389d2.jpg","nickname":"éƒæ–¹æ—","note":"","ucode":"8ABEAFDA815DDE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381582,"discussion_content":"ç»™è€å“¥èµä¸€ä¸ªï¼Œæ„Ÿè°¢åˆ†äº«","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625132795,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":376551,"ip_address":""},"score":381582,"extra":""}]}]},{"had_liked":false,"id":188140,"user_name":"ğŸ‘½","can_delete":false,"product_type":"c1","uid":1274117,"ip_address":"","ucode":"D313AF941B412D","user_header":"https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg","comment_is_top":false,"comment_ctime":1584323971,"is_pvip":false,"replies":[{"id":"72676","content":"å…·ä½“é…ç½®å‚æ•°æ˜¯ä»€ä¹ˆå‘¢?","user_name":"ä½œè€…å›å¤","comment_id":188140,"uid":"1001470","ip_address":"","utype":1,"ctime":1584330543,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"14469225859","product_id":100047701,"comment_content":"è¯¾åé¢˜1ï¼š<br>Hikari å¯ä»¥å†Springçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®å„é¡¹å‚æ•°ã€‚","like_count":3,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487347,"discussion_content":"å…·ä½“é…ç½®å‚æ•°æ˜¯ä»€ä¹ˆå‘¢?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584330543,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":225088,"user_name":"Outside","can_delete":false,"product_type":"c1","uid":1179898,"ip_address":"","ucode":"E04CA55407FF37","user_header":"https://static001.geekbang.org/account/avatar/00/12/00/fa/5863be21.jpg","comment_is_top":false,"comment_ctime":1591636320,"is_pvip":false,"replies":[{"id":"82884","content":"æ˜¯ä¸æ˜¯ä¹‹å‰åšå®éªŒçš„æ—¶å€™server.tomcat.max-threads=1æ²¡æœ‰æ”¹è¿‡æ¥å‘¢ï¼Ÿ","user_name":"ä½œè€…å›å¤","comment_id":225088,"uid":"1001470","ip_address":"","utype":1,"ctime":1591673424,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"10181570912","product_id":100047701,"comment_content":"è¯·æ•™ä¸€ä¸‹è€å¸ˆï¼Œæ‰§è¡Œå®Œ wrong2ä¹‹åï¼Œ<br>client.executeé˜»å¡ä½äº†æ˜¯ä»€ä¹ˆåŸå› <br>çº¿ç¨‹dumpå¦‚ä¸‹<br>client.execute &quot;http-nio-8088-exec-1&quot; #28 daemon prio=5 os_prio=31 tid=0x00007fecb09d2000 nid=0x9a03 runnable [0x000070000d121000]<br>   java.lang.Thread.State: RUNNABLE<br>\tat java.net.SocketInputStream.socketRead0(Native Method)<br>\tat java.net.SocketInputStream.socketRead(SocketInputStream.java:116)<br>\tat java.net.SocketInputStream.read(SocketInputStream.java:171)<br>\tat java.net.SocketInputStream.read(SocketInputStream.java:141)<br>\tat org.apache.http.impl.conn.LoggingInputStream.read(LoggingInputStream.java:84)<br>\tat org.apache.http.impl.io.SessionInputBufferImpl.streamRead(SessionInputBufferImpl.java:137)<br>\tat org.apache.http.impl.io.SessionInputBufferImpl.fillBuffer(SessionInputBufferImpl.java:153)<br>\tat org.apache.http.impl.io.SessionInputBufferImpl.readLine(SessionInputBufferImpl.java:280)<br>\tat org.apache.http.impl.conn.DefaultHttpResponseParser.parseHead(DefaultHttpResponseParser.java:138)<br>\tat org.apache.http.impl.conn.DefaultHttpResponseParser.parseHead(DefaultHttpResponseParser.java:56)<br>\tat org.apache.http.impl.io.AbstractMessageParser.parse(AbstractMessageParser.java:259)<br>\tat org.apache.http.impl.DefaultBHttpClientConnection.receiveResponseHeader(DefaultBHttpClientConnection.java:163)<br>\tat org.apache.http.impl.conn.CPoolProxy.receiveResponseHeader(CPoolProxy.java:157)<br>\tat org.apache.http.protocol.HttpRequestExecutor.doReceiveResponse(HttpRequestExecutor.java:273)<br>\tat org.apache.http.protocol.HttpRequestExecutor.execute(HttpRequestExecutor.java:125)<br>\tat org.apache.http.impl.execchain.MainClientExec.execute(MainClientExec.java:272)<br>\tat org.apache.http.impl.execchain.ProtocolExec.execute(ProtocolExec.java:186)<br>\tat org.apache.http.impl.execchain.RetryExec.execute(RetryExec.java:89)<br>\tat org.apache.http.impl.execchain.RedirectExec.execute(RedirectExec.java:110)<br>\tat org.apache.http.impl.client.InternalHttpClient.doExecute(InternalHttpClient.java:185)<br>\t<br>\t<br><br>å°è¯•ç”¨æ–°å¯ä¸€ä¸ªwebserverï¼Œ<br>ç”¨client.executeæ‰§è¡Œè¿™ä¸ªæ–°çš„getè¯·æ±‚ï¼Œå¯ä»¥å¾—åˆ°è¿”å›<br>è¿™æ˜¯ä»€ä¹ˆåŸå› å‘¢","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":497724,"discussion_content":"æ˜¯ä¸æ˜¯ä¹‹å‰åšå®éªŒçš„æ—¶å€™server.tomcat.max-threads=1æ²¡æœ‰æ”¹è¿‡æ¥å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591673424,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":202644,"user_name":"DZZ","can_delete":false,"product_type":"c1","uid":1516167,"ip_address":"","ucode":"C8E4C4B089BCE2","user_header":"https://static001.geekbang.org/account/avatar/00/17/22/87/e7bd2acf.jpg","comment_is_top":false,"comment_ctime":1586038003,"is_pvip":true,"replies":[{"id":"75730","content":"å¦‚æœæ˜¯ä¸åŒçš„dbä½†è¿˜æ˜¯ä¸€ä¸ªmongoé›†ç¾¤è¿˜æ˜¯ç”¨ä¸€ä¸ªï¼Œé™¤éä½ çš„åº”ç”¨çœŸçš„æ˜¯è¿æ¥äº†å¤šä¸ªmongoçš„é›†ç¾¤","user_name":"ä½œè€…å›å¤","comment_id":202644,"uid":"1001470","ip_address":"","utype":1,"ctime":1586046941,"user_name_real":"æœ±æ™”"}],"discussion_count":2,"race_medal":0,"score":"10175972595","product_id":100047701,"comment_content":"å¦‚æœä¸€ä¸ªåº”ç”¨é‡Œä½¿ç”¨äº†å¤šä¸ªmongoåº“ï¼Œé‚£ä¹ˆæ˜¯å¦åº”è¯¥åˆ›å»ºå¤šä¸ªmongoclientå»å¯¹åº”æ¯ä¸€ä¸ªåº“çš„ä½¿ç”¨ï¼Ÿ<br>ä¸¾ä¸ªä¾‹å­ï¼š1ä¸ªåº”ç”¨éœ€è¦è¿æ¥3ä¸ªä¸åŒmongoåº“ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•æ­£ç¡®å»ä½¿ç”¨mongoclientå‘¢","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490642,"discussion_content":"å¦‚æœæ˜¯ä¸åŒçš„dbä½†è¿˜æ˜¯ä¸€ä¸ªmongoé›†ç¾¤è¿˜æ˜¯ç”¨ä¸€ä¸ªï¼Œé™¤éä½ çš„åº”ç”¨çœŸçš„æ˜¯è¿æ¥äº†å¤šä¸ªmongoçš„é›†ç¾¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586046941,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1516167,"avatar":"https://static001.geekbang.org/account/avatar/00/17/22/87/e7bd2acf.jpg","nickname":"DZZ","note":"","ucode":"C8E4C4B089BCE2","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":221691,"discussion_content":"åº”ç”¨çš„ç¡®æ˜¯è¿æ¥äº†å¤šä¸ªé›†ç¾¤ã€‚ç›®å‰åº”ç”¨å¶å°”æœ‰gcè¿‡é«˜çš„é—®é¢˜ï¼Œå®šä½åˆ°æ˜¯ä½¿ç”¨è¿™ä¸ªmongoclientæœ‰å…³ï¼Œä½†æ˜¯å…·ä½“åŸå› ä¸€ç›´æ²¡å¼„æ˜ç™½ã€‚çœ‹äº†è€å¸ˆè¿™ä»¶è®²çš„ï¼Œæ„Ÿè§‰å¾ˆæœ‰å¯èƒ½å°±æ˜¯ä½¿ç”¨æ—¶é‡å¤åˆ›å»ºäº†å¤šä¸ªè¿æ¥æ± ï¼Œå¾…åç»­å·¥ä½œæ—¶å»æ£€æŸ¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586048260,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":196722,"user_name":"zå°ä¿Šã€Arno","can_delete":false,"product_type":"c1","uid":1301304,"ip_address":"","ucode":"312B3DDCF15102","user_header":"https://static001.geekbang.org/account/avatar/00/13/db/38/7ab139a3.jpg","comment_is_top":false,"comment_ctime":1585306990,"is_pvip":false,"replies":[{"id":"74453","content":"åé¢åŠ é¤ä¸­æˆ‘ä»¬éœ€è¦æ‰“æˆjaråŒ…è¿è¡Œç¨‹åºï¼Œè¿™ä¸ªé¡¹ç›®ä¸­è¿™ä¹ˆå¤šmainç±»ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªæˆ‘ä»¬éœ€è¦çš„mainå…¥å£","user_name":"ä½œè€…å›å¤","comment_id":196722,"uid":"1001470","ip_address":"","utype":1,"ctime":1585311137,"user_name_real":"æœ±æ™”"}],"discussion_count":2,"race_medal":0,"score":"10175241582","product_id":100047701,"comment_content":"è€å¸ˆï¼Œè¯´ä¸€ä¸ªä¸æœ¬èŠ‚æ— å…³çš„é—®é¢˜å“ˆï¼Œä½ çš„gitä»£ç é‡Œé¢è¿™ä¸€è¡Œï¼Œæˆ‘ä¸æ˜ç™½å®ƒçš„å«ä¹‰ã€‚ã€‚<br><br>        &lt;plugins&gt;<br>            &lt;plugin&gt;<br>                &lt;groupId&gt;org.springframework.boot&lt;&#47;groupId&gt;<br>                &lt;artifactId&gt;spring-boot-maven-plugin&lt;&#47;artifactId&gt;<br>                &lt;configuration&gt;<br>                    &lt;mainClass&gt;org.geekbang.time.commonmistakes.troubleshootingtools.jdktool.CommonMistakesApplication<br>                    &lt;&#47;mainClass&gt;<br>                &lt;&#47;configuration&gt;<br>            &lt;&#47;plugin&gt;<br>        &lt;&#47;plugins&gt;<br><br><br>è¿™å„¿çš„ ï¼š<br>&lt;mainClass&gt;org.geekbang.time.commonmistakes.troubleshootingtools.jdktool.CommonMistakesApplication<br>                    &lt;&#47;mainClass&gt;<br><br>æœ‰ä»€ä¹ˆä½œç”¨å•Šï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489368,"discussion_content":"åé¢åŠ é¤ä¸­æˆ‘ä»¬éœ€è¦æ‰“æˆjaråŒ…è¿è¡Œç¨‹åºï¼Œè¿™ä¸ªé¡¹ç›®ä¸­è¿™ä¹ˆå¤šmainç±»ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªæˆ‘ä»¬éœ€è¦çš„mainå…¥å£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585311137,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1301304,"avatar":"https://static001.geekbang.org/account/avatar/00/13/db/38/7ab139a3.jpg","nickname":"zå°ä¿Šã€Arno","note":"","ucode":"312B3DDCF15102","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":215281,"discussion_content":"æ˜ç™½å•¦ï¼ åªæŒ‡å®šä¸€ä¸ªæœ‰mainæ–¹æ³•çš„classä½œä¸ºmainclass","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585312048,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":191806,"user_name":"åˆ˜å–„è‰¯~","can_delete":false,"product_type":"c1","uid":1904989,"ip_address":"","ucode":"585690B7BC72C8","user_header":"https://static001.geekbang.org/account/avatar/00/1d/11/5d/25328b33.jpg","comment_is_top":false,"comment_ctime":1584798020,"is_pvip":false,"replies":[{"id":"73469","content":"éŸ³é¢‘å¯ä»¥å€é€Ÿçš„","user_name":"ä½œè€…å›å¤","comment_id":191806,"uid":"1001470","ip_address":"","utype":1,"ctime":1584801365,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"10174732612","product_id":100047701,"comment_content":"æœ‰æ–‡æ¡£ èµ„æ–™ ,è¿˜æ˜¯è¯­éŸ³ è¦æ˜¯ èƒ½å€é€Ÿ æ’­æ”¾ æœ€å¥½äº†,ç¡è§‰å¬,ååœ°é“å¬","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488261,"discussion_content":"éŸ³é¢‘å¯ä»¥å€é€Ÿçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584801365,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":190673,"user_name":"Daiver","can_delete":false,"product_type":"c1","uid":1466447,"ip_address":"","ucode":"9B1A03AFBC79BC","user_header":"https://static001.geekbang.org/account/avatar/00/16/60/4f/db0e62b3.jpg","comment_is_top":false,"comment_ctime":1584680361,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10174614953","product_id":100047701,"comment_content":"jconsoleè§‚å¯Ÿè¿æ¥æ•°çš„æ—¶å€™ä¸ºå•¥æˆ‘è¿™é‡Œæ²¡æœ‰å›¾å½¢çš„æ–¹å¼å‘¢ï¼Ÿ","like_count":2},{"had_liked":false,"id":188644,"user_name":"hellojd","can_delete":false,"product_type":"c1","uid":1341697,"ip_address":"","ucode":"4E51807AE7E472","user_header":"https://static001.geekbang.org/account/avatar/00/14/79/01/e71510dc.jpg","comment_is_top":false,"comment_ctime":1584395364,"is_pvip":false,"replies":[{"id":"72756","content":"ä¼˜é›…å…³é—­æ€»æ˜¯å¥½çš„ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠåˆ°æœåŠ¡ç«¯çš„tcpè¿æ¥","user_name":"ä½œè€…å›å¤","comment_id":188644,"uid":"1001470","ip_address":"","utype":1,"ctime":1584403805,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"10174329956","product_id":100047701,"comment_content":"è¿›ç¨‹éƒ½killäº†ï¼Œç›¸å…³çš„èµ„æºåº”è¯¥è‡ªåŠ¨é‡Šæ”¾å§ï¼Œæ¯”å¦‚å¯åŠ¨çš„çº¿ç¨‹å’Œè¿æ¥ã€‚jvmç¯å¢ƒéƒ½æ²¡äº†ï¼Œä¾èµ–çš„åŸºç¡€éƒ½æ²¡äº†","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487475,"discussion_content":"ä¼˜é›…å…³é—­æ€»æ˜¯å¥½çš„ï¼Œç‰¹åˆ«æ˜¯æ¶‰åŠåˆ°æœåŠ¡ç«¯çš„tcpè¿æ¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584403805,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188629,"user_name":"åŒ¿å","can_delete":false,"product_type":"c1","uid":1265774,"ip_address":"","ucode":"BAA596254FE0EB","user_header":"https://static001.geekbang.org/account/avatar/00/13/50/6e/8bd276a5.jpg","comment_is_top":false,"comment_ctime":1584376041,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10174310633","product_id":100047701,"comment_content":"è¾›è‹¦ï¼è€å¸ˆ","like_count":2},{"had_liked":false,"id":187819,"user_name":"è¢ç´ èŠ¬","can_delete":false,"product_type":"c1","uid":1856206,"ip_address":"","ucode":"78E3DC78479915","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83epSmVn8QDuJVtwibpiaskLecwICcbNfoKbPlQgMhQBRuz67icFd2aibhNdGiaeR4D3wTmVc6yPL8c3HMAw/132","comment_is_top":false,"comment_ctime":1584252942,"is_pvip":false,"replies":[{"id":"72490","content":"<br>ï¼šï¼‰","user_name":"ä½œè€…å›å¤","comment_id":187819,"uid":"1001470","ip_address":"","utype":1,"ctime":1584260984,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"10174187534","product_id":100047701,"comment_content":"è¾›è‹¦è€å¸ˆ","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487253,"discussion_content":"\nï¼šï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584260984,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187611,"user_name":"é™ˆå¤©æŸ±","can_delete":false,"product_type":"c1","uid":1696225,"ip_address":"","ucode":"917BFDC845760D","user_header":"https://static001.geekbang.org/account/avatar/00/19/e1/e1/441df85d.jpg","comment_is_top":false,"comment_ctime":1584171715,"is_pvip":false,"replies":[{"id":"72409","content":"æ²¡é”™ï¼Œå®˜æ–¹æ–‡æ¡£é‡Œé¢æ˜¯è¿™ä¹ˆè¯´çš„ï¼š<br><br>Typically you only create one MongoClient instance for a given MongoDB deployment (e.g. standalone, replica set, or a sharded cluster) and use it across your application. However, if you do create multiple instances:<br>All resource usage limits (e.g. max connections, etc.) apply per MongoClient instance.<br>To dispose of an instance, call MongoClient.close() to clean up resources.<br><br>å…¶å®å¤ç”¨ä¸ç­‰äºåœ¨ä»»ä½•æƒ…å†µä¸‹å°±åªç”¨ä¸€ä¸ªï¼ŒHttpClientä¹Ÿæ˜¯åŒæ ·çš„é“ç†","user_name":"ä½œè€…å›å¤","comment_id":187611,"uid":"1001470","ip_address":"","utype":1,"ctime":1584182913,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"10174106307","product_id":100047701,"comment_content":"çœ‹äº†ä»Šå¤©è€å¸ˆçš„è¿æ¥æ± æ–‡ç« åï¼Œæ‰æ³¨æ„åˆ°jedisPoolä¸redisTemplateçš„åŒºåˆ«æ­£æ˜¯è€å¸ˆæåˆ°çš„è¿æ¥æ± clientæ˜¯å¦å†…ç½®æ± çš„åŒºåˆ«ï¼Œèµä¸€ä¸ªï¼é’ˆå¯¹è¯¾åçš„ç¬¬äºŒä¸ªé—®é¢˜ï¼Œå»æŸ¥é˜…äº†MongoClientçš„æºç ï¼Œå‘ç°MongoClientçš„çˆ¶ç±»Mongoå†…ç½®äº†ServerSessionPoolæ± ï¼Œæ‰€ä»¥MongoClientåº”è¯¥å±äºè€å¸ˆè¯´çš„å†…ç½®æ± é‚£ç§å®ç°ï¼Œå› æ­¤æ¯æ¬¡åˆ›å»ºMongoClientéƒ½å¿…é¡»å¤ç”¨ï¼Œä¸çŸ¥é“è€å¸ˆï¼Œæˆ‘çš„ç†è§£å¯¹ä¸å¯¹ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487164,"discussion_content":"æ²¡é”™ï¼Œå®˜æ–¹æ–‡æ¡£é‡Œé¢æ˜¯è¿™ä¹ˆè¯´çš„ï¼š\n\nTypically you only create one MongoClient instance for a given MongoDB deployment (e.g. standalone, replica set, or a sharded cluster) and use it across your application. However, if you do create multiple instances:\nAll resource usage limits (e.g. max connections, etc.) apply per MongoClient instance.\nTo dispose of an instance, call MongoClient.close() to clean up resources.\n\nå…¶å®å¤ç”¨ä¸ç­‰äºåœ¨ä»»ä½•æƒ…å†µä¸‹å°±åªç”¨ä¸€ä¸ªï¼ŒHttpClientä¹Ÿæ˜¯åŒæ ·çš„é“ç†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584182913,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":218915,"user_name":"CDz","can_delete":false,"product_type":"c1","uid":1114779,"ip_address":"","ucode":"A23BEE1C4A5922","user_header":"https://static001.geekbang.org/account/avatar/00/11/02/9b/b1a3c60d.jpg","comment_is_top":false,"comment_ctime":1589897762,"is_pvip":false,"replies":[{"id":"80878","content":"æœåŠ¡ç«¯æ¥è¯´ï¼Œå•çº¿ç¨‹æ˜¯æœåŠ¡ç«¯å¤„ç†ï¼ˆIOå’Œæ‰§è¡Œå‘½ä»¤ï¼‰æ¨¡å‹ï¼ˆä¸è¿‡æœ€æ–°çš„Rediså·²ä¸æ˜¯å•çº¿ç¨‹å¤„ç†IOï¼‰ï¼Œå•çº¿ç¨‹ç¡®ä¿è¶³å¤Ÿç®€å•é¿å…çº¿ç¨‹å®‰å…¨é—®é¢˜çš„åŒæ—¶ä¹Ÿèƒ½åŒæ—¶å¤„ç†å¤§é‡å®¢æˆ·ç«¯å¹¶å‘ï¼Œè¿™æ˜¯ä¸¤ä¸ªæ¦‚å¿µï¼›å®¢æˆ·ç«¯æ¥è¯´è¿æ¥æ± å¯ä»¥å¤ç”¨è¿æ¥ï¼Œè¿™è‚¯å®šæ˜¯éœ€è¦çš„","user_name":"ä½œè€…å›å¤","comment_id":218915,"uid":"1001470","ip_address":"","utype":1,"ctime":1589898503,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"5884865058","product_id":100047701,"comment_content":"è€å¸ˆæˆ‘æƒ³è¯·æ•™ä¸€ä¸‹<br><br>åœ¨å•æœºRedisæƒ…å†µä¸‹<br><br>æ—¢ç„¶Redisæ˜¯**å•çº¿ç¨‹ä¸²è¡Œå¤„ç†ä»»åŠ¡çš„**ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å†ä½¿ç”¨Redisçº¿ç¨‹æ± æ˜¯å¦æœ‰å¿…è¦ï¼Ÿ<br><br>å’Œå…¨å±€ä¸€ä¸ªé“¾æ¥çš„åŒºåˆ«åœ¨å“ªé‡Œå‘¢ï¼Ÿ<br><br>","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":495623,"discussion_content":"æœåŠ¡ç«¯æ¥è¯´ï¼Œå•çº¿ç¨‹æ˜¯æœåŠ¡ç«¯å¤„ç†ï¼ˆIOå’Œæ‰§è¡Œå‘½ä»¤ï¼‰æ¨¡å‹ï¼ˆä¸è¿‡æœ€æ–°çš„Rediså·²ä¸æ˜¯å•çº¿ç¨‹å¤„ç†IOï¼‰ï¼Œå•çº¿ç¨‹ç¡®ä¿è¶³å¤Ÿç®€å•é¿å…çº¿ç¨‹å®‰å…¨é—®é¢˜çš„åŒæ—¶ä¹Ÿèƒ½åŒæ—¶å¤„ç†å¤§é‡å®¢æˆ·ç«¯å¹¶å‘ï¼Œè¿™æ˜¯ä¸¤ä¸ªæ¦‚å¿µï¼›å®¢æˆ·ç«¯æ¥è¯´è¿æ¥æ± å¯ä»¥å¤ç”¨è¿æ¥ï¼Œè¿™è‚¯å®šæ˜¯éœ€è¦çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589898503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":190347,"user_name":"å°å¥¶ç‹—","can_delete":false,"product_type":"c1","uid":1178236,"ip_address":"","ucode":"DC810503571DD2","user_header":"https://static001.geekbang.org/account/avatar/00/11/fa/7c/f8f38ad0.jpg","comment_is_top":false,"comment_ctime":1584631173,"is_pvip":false,"replies":[{"id":"73217","content":"ä½ å¯ä»¥çœ‹ä¸‹å®ƒæºç å®ç°ï¼Œsqlserver clientæˆ‘ä¸æ¸…æ¥š","user_name":"ä½œè€…å›å¤","comment_id":190347,"uid":"1001470","ip_address":"","utype":1,"ctime":1584664856,"user_name_real":"æœ±æ™”"}],"discussion_count":2,"race_medal":0,"score":"5879598469","product_id":100047701,"comment_content":"è€å¸ˆï¼Œæˆ‘ä»¬ç”¨å¤šä¸ªçº¿ç¨‹å…±ç”¨åŒä¸€ä¸ªsqlserveræ•°æ®åº“è¿æ¥connectionå†™æ•°æ®ï¼Œæ²¡å‘ç°æœ‰é—®é¢˜å•Šã€‚æˆ‘ä»¬æµ‹è¯•äº†å‡ ç™¾ä¸‡æ¡æ•°æ®çš„ã€‚æ˜¯å› ä¸ºsqlserveråšäº†å¤„ç†å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487957,"discussion_content":"ä½ å¯ä»¥çœ‹ä¸‹å®ƒæºç å®ç°ï¼Œsqlserver clientæˆ‘ä¸æ¸…æ¥š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584664856,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1048396,"avatar":"","nickname":"æ¡ƒå­çˆ±è¥¿ç“œ","note":"","ucode":"D6B3404CF0D254","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575751,"discussion_content":"å†…éƒ¨è¿æ¥æ± ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655089270,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":190297,"user_name":"ç»ˆç»“è€…999å·","can_delete":false,"product_type":"c1","uid":1055854,"ip_address":"","ucode":"33ADE61580B6DD","user_header":"https://static001.geekbang.org/account/avatar/00/10/1c/6e/6c5f5734.jpg","comment_is_top":false,"comment_ctime":1584627661,"is_pvip":true,"replies":[{"id":"73197","content":"å¯¹è±¡æ± æŠ½è±¡APIï¼Œä¸€èˆ¬æ¡†æ¶å†…ç”¨ï¼Œç”¨äºå¤ç”¨æ˜‚è´µå¯¹è±¡ï¼Œæ¯”å¦‚ç½‘ç»œè¿æ¥ç­‰","user_name":"ä½œè€…å›å¤","comment_id":190297,"uid":"1001470","ip_address":"","utype":1,"ctime":1584628814,"user_name_real":"æœ±æ™”"}],"discussion_count":2,"race_medal":0,"score":"5879594957","product_id":100047701,"comment_content":"è€å¸ˆï¼Œæˆ‘æƒ³é—®ä¸€ä¸‹å°±æ˜¯æˆ‘çœ‹apache comons poolä¸­æœ‰å¯¹è±¡æ± çš„æ¦‚å¿µï¼Œä¸€èˆ¬ä½¿ç”¨æ¥æ˜¯åšä»€ä¹ˆçš„å‘¢ï¼Ÿä¸çŸ¥é“ä»€ä¹ˆä¸šåŠ¡å¯ä»¥ä½¿ç”¨ï¼Œæ˜¯æ–¹ä¾¿å¤ç”¨ä¸€äº›åˆ›å»ºæ¯”è¾ƒé•¿çš„å¯¹è±¡å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487941,"discussion_content":"å¯¹è±¡æ± æŠ½è±¡APIï¼Œä¸€èˆ¬æ¡†æ¶å†…ç”¨ï¼Œç”¨äºå¤ç”¨æ˜‚è´µå¯¹è±¡ï¼Œæ¯”å¦‚ç½‘ç»œè¿æ¥ç­‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584628814,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1055854,"avatar":"https://static001.geekbang.org/account/avatar/00/10/1c/6e/6c5f5734.jpg","nickname":"ç»ˆç»“è€…999å·","note":"","ucode":"33ADE61580B6DD","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":209373,"discussion_content":"äº†è§£äº†ï¼Œè°¢è°¢è€å¸ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584628969,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188785,"user_name":"eazonshaw","can_delete":false,"product_type":"c1","uid":1493784,"ip_address":"","ucode":"423952F7CEF475","user_header":"https://static001.geekbang.org/account/avatar/00/16/cb/18/4877c08b.jpg","comment_is_top":false,"comment_ctime":1584415671,"is_pvip":false,"replies":[{"id":"72819","content":"wrong2çš„æˆªå›¾å·²ç»æ›¿æ¢äº†ï¼Œæ™šä¸Šä¼šæ›´æ–°<br><br>rightçš„#75å›¾ä¸Šçœ‹ä¸åˆ°ï¼Œå›¾å¤ªé•¿äº†ï¼Œä¸è¿‡æˆªå›¾å·²ç»å¯ä»¥è¿æ¥å¤ç”¨äº†","user_name":"ä½œè€…å›å¤","comment_id":188785,"uid":"1001470","ip_address":"","utype":1,"ctime":1584418855,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"5879382967","product_id":100047701,"comment_content":"è€å¸ˆï¼Œæ„Ÿè§‰æ–‡ç« å¯¹ç½‘ç»œæŠ“åŒ…å·¥å…· Wireshark çš„æˆªå›¾ä¿¡æ¯ä¸æ˜¯å¾ˆå®Œæ•´ï¼Œrightæ¥å£çš„#75ä¹Ÿæ²¡æœ‰çœ‹åˆ°ï¼Œè¿™ä¸€å—çœ‹ç€æœ‰ç‚¹æ‡µã€‚å¯ä»¥è¯¦ç»†è¯´æ˜ä¸‹è°ƒç”¨wrong2å’Œrightçš„åŒºåˆ«å—ï¼Ÿè°¢è°¢ã€‚","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487523,"discussion_content":"wrong2çš„æˆªå›¾å·²ç»æ›¿æ¢äº†ï¼Œæ™šä¸Šä¼šæ›´æ–°\n\nrightçš„#75å›¾ä¸Šçœ‹ä¸åˆ°ï¼Œå›¾å¤ªé•¿äº†ï¼Œä¸è¿‡æˆªå›¾å·²ç»å¯ä»¥è¿æ¥å¤ç”¨äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584418855,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188643,"user_name":"hellojd","can_delete":false,"product_type":"c1","uid":1341697,"ip_address":"","ucode":"4E51807AE7E472","user_header":"https://static001.geekbang.org/account/avatar/00/14/79/01/e71510dc.jpg","comment_is_top":false,"comment_ctime":1584395005,"is_pvip":false,"replies":[{"id":"72758","content":"3ã€å¯ä»¥æ‰¾ä¸€ä¸‹spring boot auto configurationç±»ï¼Œçœ‹çœ‹å…¶è‡ªåŠ¨é…ç½®æ˜¯å¦ç¬¦åˆéœ€æ±‚<br>4ã€è¿™å¯èƒ½è¿˜æœ‰ä¸€ä¸ªè®¾è®¡é—®é¢˜ï¼Œç†è®ºä¸Šå¾®æœåŠ¡åº”è¯¥åªèƒ½è®¿é—®è‡ªå·±domainçš„æ•°æ®åº“ï¼Œç»™å…¶ä»–å¾®æœåŠ¡æä¾›æ•°æ®åªèƒ½ä»¥æ¥å£æä¾›ï¼›å½“ç„¶èµ„æºæœ‰é™çš„æƒ…å†µä¸‹æ··ç”¨æ•°æ®åº“å®ä¾‹çš„è¯ï¼Œä¸€èˆ¬è¿æ¥æ•°é‡ä¸ä¼šæˆä¸ºæ˜æ˜¾ç“¶é¢ˆï¼Œæœ‰ç“¶é¢ˆçš„è¯å¯èƒ½è¦è€ƒè™‘å®ä¾‹æ‹†åˆ†äº†ã€‚","user_name":"ä½œè€…å›å¤","comment_id":188643,"uid":"1001470","ip_address":"","utype":1,"ctime":1584404263,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"5879362301","product_id":100047701,"comment_content":"å‡ ä¸ªç–‘é—®:ç¬¬ä¸€ä¸ª:demoä¸­çš„&#47;rightæ¥å£ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿç®—æœ‰é—®é¢˜çš„ï¼Œä»…ä»…æ–¹ä¾¿å¯¹æ¯”æ•ˆæœè€Œå·²ï¼Œè¿™è®©è¯·æ±‚ä¸²è¡Œäº†å§ã€‚ç¬¬äºŒä¸ª:http clientè¿˜æœ‰ä¸€å¥—è¿æ¥å‰”é™¤æœºåˆ¶ï¼Œdemoé‡Œæ²¡è®²åˆ°ã€‚ç¬¬ä¸‰ä¸ª:spring bootå®¢æˆ·ç«¯å·¥å…·ï¼Œé»˜è®¤è®¾ç½®çš„ä¸€äº›é…ç½®ï¼Œæœ‰éœ€è¦æ³¨æ„çš„åœ°æ–¹å—ï¼Ÿç¬¬å››ä¸ª:è¿æ¥æ•°ç›‘æ§ï¼Œä»€ä¹ˆæƒ…å†µä»£è¡¨ç€æœ‰é—®é¢˜,æœ‰æ—¶å€™ä¸€ä¸ªæ•°æ®åº“èµ„æºï¼Œè¢«å¤šä¸ªå¾®æœåŠ¡å…¬ç”¨ï¼Œæ€ä¹ˆåˆ’åˆ†é…é¢ã€‚","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487474,"discussion_content":"3ã€å¯ä»¥æ‰¾ä¸€ä¸‹spring boot auto configurationç±»ï¼Œçœ‹çœ‹å…¶è‡ªåŠ¨é…ç½®æ˜¯å¦ç¬¦åˆéœ€æ±‚\n4ã€è¿™å¯èƒ½è¿˜æœ‰ä¸€ä¸ªè®¾è®¡é—®é¢˜ï¼Œç†è®ºä¸Šå¾®æœåŠ¡åº”è¯¥åªèƒ½è®¿é—®è‡ªå·±domainçš„æ•°æ®åº“ï¼Œç»™å…¶ä»–å¾®æœåŠ¡æä¾›æ•°æ®åªèƒ½ä»¥æ¥å£æä¾›ï¼›å½“ç„¶èµ„æºæœ‰é™çš„æƒ…å†µä¸‹æ··ç”¨æ•°æ®åº“å®ä¾‹çš„è¯ï¼Œä¸€èˆ¬è¿æ¥æ•°é‡ä¸ä¼šæˆä¸ºæ˜æ˜¾ç“¶é¢ˆï¼Œæœ‰ç“¶é¢ˆçš„è¯å¯èƒ½è¦è€ƒè™‘å®ä¾‹æ‹†åˆ†äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584404263,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188372,"user_name":"LittleFatz","can_delete":false,"product_type":"c1","uid":1052722,"ip_address":"","ucode":"C374FBE3D63FDC","user_header":"https://static001.geekbang.org/account/avatar/00/10/10/32/9256dc82.jpg","comment_is_top":false,"comment_ctime":1584345784,"is_pvip":false,"replies":[{"id":"72688","content":"ä½ è¿™ä¸ªé—®é¢˜éå¸¸å¥½ï¼Œçœ‹çš„å¾ˆä»”ç»†ã€‚<br>ä¸»è¦è¿˜æ˜¯è¿™ä¸ªå›¾å¤ªé•¿äº†ï¼Œæˆ‘è¿™é‡Œä¸å¥½è´´ã€‚<br>ä½ æåˆ°çš„35ã€37å’Œ42å¯èƒ½æ˜¯æ¡æ‰‹å’ŒæŒ¥æ‰‹ï¼Œæœ€å‰é¢æœ‰ä¸‰æ¬¡æ¡æ‰‹+æ›´æ–°çª—å£å¤§å°å››ä¸ªTCPï¼Œæœ€åé¢æœ‰æŒ¥æ‰‹å››ä¸ªTCPï¼Œçœ‹åˆ°çš„è¿™äº›å…¶å®è¿˜æ˜¯ä¸€ä¸ªè¯·æ±‚çš„ã€‚<br>ä½ å¯ä»¥ä½¿ç”¨wiresharkæ¥è°ƒè¯•ä¸€ä¸‹wrong2æ¥å£ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯æ¯æ¬¡éƒ½æ¢äº†ç«¯å£ã€‚","user_name":"ä½œè€…å›å¤","comment_id":188372,"uid":"1001470","ip_address":"","utype":1,"ctime":1584349280,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"5879313080","product_id":100047701,"comment_content":"è¯·æ•™è€å¸ˆä¸€ä¸ªé—®é¢˜ï¼Œåœ¨wrong2çš„wiresharkæˆªå›¾é‡Œï¼Œé™¤äº†#39ä½¿ç”¨ç«¯å£60686å¤–ï¼Œ#37ã€#35å’Œ#42éƒ½ä½¿ç”¨äº†è¿™ä¸ªç«¯å£ï¼Œå•ä»æˆªå›¾è€Œè¨€ï¼Œè²Œä¼¼æ— æ³•è¯æ˜æ¯æ¬¡requestéƒ½ä½¿ç”¨äº†æ–°çš„ç«¯å£å‘é€è¯·æ±‚ã€‚","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487390,"discussion_content":"ä½ è¿™ä¸ªé—®é¢˜éå¸¸å¥½ï¼Œçœ‹çš„å¾ˆä»”ç»†ã€‚\nä¸»è¦è¿˜æ˜¯è¿™ä¸ªå›¾å¤ªé•¿äº†ï¼Œæˆ‘è¿™é‡Œä¸å¥½è´´ã€‚\nä½ æåˆ°çš„35ã€37å’Œ42å¯èƒ½æ˜¯æ¡æ‰‹å’ŒæŒ¥æ‰‹ï¼Œæœ€å‰é¢æœ‰ä¸‰æ¬¡æ¡æ‰‹+æ›´æ–°çª—å£å¤§å°å››ä¸ªTCPï¼Œæœ€åé¢æœ‰æŒ¥æ‰‹å››ä¸ªTCPï¼Œçœ‹åˆ°çš„è¿™äº›å…¶å®è¿˜æ˜¯ä¸€ä¸ªè¯·æ±‚çš„ã€‚\nä½ å¯ä»¥ä½¿ç”¨wiresharkæ¥è°ƒè¯•ä¸€ä¸‹wrong2æ¥å£ï¼Œçœ‹çœ‹æ˜¯ä¸æ˜¯æ¯æ¬¡éƒ½æ¢äº†ç«¯å£ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584349280,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187564,"user_name":"å´å›½å¸…","can_delete":false,"product_type":"c1","uid":1638035,"ip_address":"","ucode":"D2EBC0308CC361","user_header":"https://static001.geekbang.org/account/avatar/00/18/fe/93/8999259d.jpg","comment_is_top":false,"comment_ctime":1584158377,"is_pvip":false,"replies":[{"id":"72452","content":"å¦‚æœ‰æ”¶è´§ï¼Œæ¬¢è¿è½¬å‘","user_name":"ä½œè€…å›å¤","comment_id":187564,"uid":"1001470","ip_address":"","utype":1,"ctime":1584241326,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"5879125673","product_id":100047701,"comment_content":"å“ˆå“ˆå“ˆ å®åæ¨è è€å“¥ç‰›é€¼","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487148,"discussion_content":"å¦‚æœ‰æ”¶è´§ï¼Œæ¬¢è¿è½¬å‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584241326,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187539,"user_name":"Wiggle Wiggle","can_delete":false,"product_type":"c1","uid":1036052,"ip_address":"","ucode":"EFE746551BA998","user_header":"https://static001.geekbang.org/account/avatar/00/0f/cf/14/384258ba.jpg","comment_is_top":false,"comment_ctime":1584154625,"is_pvip":false,"replies":[{"id":"72363","content":"1. æ˜¯çš„ï¼Œè¿™ä¸¤ä¸ªå‚æ•°éœ€è¦åˆ†æ¸…æ¥šåŠŸèƒ½<br>2. <br><br>Typically you only create one MongoClient instance for a given MongoDB deployment (e.g. standalone, replica set, or a sharded cluster) and use it across your application. However, if you do create multiple instances:<br><br>All resource usage limits (e.g. max connections, etc.) apply per MongoClient instance.<br><br>To dispose of an instance, call MongoClient.close() to clean up resources.","user_name":"ä½œè€…å›å¤","comment_id":187539,"uid":"1001470","ip_address":"","utype":1,"ctime":1584156900,"user_name_real":"æœ±æ™”"}],"discussion_count":3,"race_medal":0,"score":"5879121921","product_id":100047701,"comment_content":"å¯¹äºé—®é¢˜1ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å®¢æˆ·ç«¯ä¸è¿æ¥æ± äº¤äº’çš„å…³é”®å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°çš„å–å€¼ä¸å®¢æˆ·ç«¯çš„éœ€æ±‚ç´§å¯†ç›¸å…³ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¿æ¥æ± ä¸æœåŠ¡å™¨äº¤äº’çš„å…³é”®å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°çš„å–å€¼åº”è¯¥å‚è€ƒæœåŠ¡å™¨çš„ä¸€èˆ¬æƒ…å†µã€‚<br><br>å¯¹äºé—®é¢˜2ï¼Œåº”è¯¥å¤ç”¨ï¼Œä¸ºä»€ä¹ˆï¼Ÿå› ä¸ºæˆ‘è¸©è¿‡å‘â€¦â€¦çŸ­æ—¶é—´å†…æ–°å»ºå¤§é‡clientæ’‘çˆ†äº†mongoâ€¦â€¦","like_count":1,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487138,"discussion_content":"1. æ˜¯çš„ï¼Œè¿™ä¸¤ä¸ªå‚æ•°éœ€è¦åˆ†æ¸…æ¥šåŠŸèƒ½\n2. \n\nTypically you only create one MongoClient instance for a given MongoDB deployment (e.g. standalone, replica set, or a sharded cluster) and use it across your application. However, if you do create multiple instances:\n\nAll resource usage limits (e.g. max connections, etc.) apply per MongoClient instance.\n\nTo dispose of an instance, call MongoClient.close() to clean up resources.","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584156900,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":206698,"discussion_content":"ä¸éœ€è¦ï¼ŒHikariDataSourceæ˜¯ä¸€ä¸ªBeanï¼ŒSpringä¼šç¡®ä¿ç¨‹åºé€€å‡ºçš„æ—¶å€™è°ƒç”¨closeæ–¹æ³•","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584430475,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1438330,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJmEzU09AJVlKcHx9DgsJEocic7F6VicfyP0VicS8v7S2cQTeiaGd1x3cpbJGHMJXibILiboSVTNiaM3P81Q/132","nickname":"è€ä¹”","note":"","ucode":"7C99C643979831","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":206542,"discussion_content":"è€å¸ˆï¼Œhikariè¿æ¥æ± ï¼Œæ€ä¹ˆä¿è¯åœ¨è¿™ä¸ªå¾®æœåŠ¡(spring boot)å…³é—­æ—¶ï¼Œè¿™ä¸ªè¿æ¥æ± ä¹Ÿæ­£å¸¸(ä¼˜é›…)é‡Šæ”¾(æœåŠ¡ç«¯è¿æ¥)ï¼Ÿ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584413354,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":352063,"user_name":"dudu-benny","can_delete":false,"product_type":"c1","uid":1683951,"ip_address":"","ucode":"026ECAC9AFDE0D","user_header":"https://static001.geekbang.org/account/avatar/00/19/b1/ef/2356b51e.jpg","comment_is_top":false,"comment_ctime":1658371252,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1658371252","product_id":100047701,"comment_content":"A MongoDB client with internal connection pooling. For most applications, you should have one MongoClient instance for the entire JVM.<br><br>The following are equivalent, and all connect to the local database running on the default port:<br><br> MongoClient mongoClient1 = new MongoClient();<br> MongoClient mongoClient1 = new MongoClient(&quot;localhost&quot;);<br> MongoClient mongoClient2 = new MongoClient(&quot;localhost&quot;, 27017);<br> MongoClient mongoClient4 = new MongoClient(new ServerAddress(&quot;localhost&quot;));<br> MongoClient mongoClient5 = new MongoClient(new ServerAddress(&quot;localhost&quot;), MongoClientOptions.builder().build());<br> å¯ä»¥çœ‹å‡ºmongoClientåˆ©ç”¨çš„æ˜¯æ± åŒ–æŠ€æœ¯è¿›è¡Œæ“ä½œï¼Œå†é‡MongoClientOptionsçš„å‚æ•°ä¹Ÿå¯ä»¥å‘ç°getConnectTimeout(),getHeartbeatConnectTimeout()ç­‰å‚æ•°æ¨æµ‹ MongoClient ç±»åº”è¯¥æ˜¯æ¯æ¬¡å¤ç”¨é“¾æ¥çš„","like_count":0},{"had_liked":false,"id":325465,"user_name":"æ¢…å­é»„æ—¶é›¨","can_delete":false,"product_type":"c1","uid":1015938,"ip_address":"","ucode":"9F788D09C2E9E7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/80/82/3c21b30c.jpg","comment_is_top":false,"comment_ctime":1638965720,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638965720","product_id":100047701,"comment_content":"åœ¨ä½¿ç”¨ç¬¬ä¸‰æ–¹æä¾›çš„sdk æ—¶è¦ç¡®è®¤ä¸‹æ˜¯å¦ç”¨äº†è¿æ¥æ± ã€‚","like_count":0},{"had_liked":false,"id":312819,"user_name":"ä½™æ˜å®¸","can_delete":false,"product_type":"c1","uid":2023637,"ip_address":"","ucode":"C337279B7F6473","user_header":"","comment_is_top":false,"comment_ctime":1632039631,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632039631","product_id":100047701,"comment_content":"The MongoClient instance represents a pool of connections to the database; you will only need one instance of class MongoClient even with multiple threads.<br><br>å®˜æ–¹æ–‡æ¡£ç»™å‡ºçš„æœ€ä½³å®è·µæ˜¯ï¼ŒMongoClientæ˜¯ä¸€ä¸ªè¿æ¥æ± ï¼Œåªéœ€è¦å•ä¾‹å³å¯ã€‚","like_count":0},{"had_liked":false,"id":296190,"user_name":"silas","can_delete":false,"product_type":"c1","uid":1553046,"ip_address":"","ucode":"EEFF1E8ED00EE6","user_header":"https://static001.geekbang.org/account/avatar/00/17/b2/96/a524ebf6.jpg","comment_is_top":false,"comment_ctime":1622798172,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622798172","product_id":100047701,"comment_content":"ä¹°äº†å¾ˆå¤šè¯¾ï¼Œè€å¸ˆçš„è¯¾çœŸçš„æ˜¯ç‰©è¶…æ‰€å€¼ã€‚è¿Ÿæ¥çš„è¯„è®ºã€‚ã€‚","like_count":0},{"had_liked":false,"id":268561,"user_name":"ç™½æ¨","can_delete":false,"product_type":"c1","uid":1743868,"ip_address":"","ucode":"B56DD94706F80B","user_header":"https://static001.geekbang.org/account/avatar/00/1a/9b/fc/a3abbe53.jpg","comment_is_top":false,"comment_ctime":1608257991,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608257991","product_id":100047701,"comment_content":"è¿™ç¯‡æ–‡ç« å­¦èµ·æ¥æœ‰ç‚¹è‰°éš¾ï¼Œè·Ÿç”Ÿäº§å®é™…ç»“åˆå¾—å¾ˆè¿‘ï¼Œå±äºå¤§å¤šæ•°äººéƒ½ä¼šç”¨åˆ°ï¼Œä½†æ˜¯ä¹Ÿåªæ˜¯ç”¨ç”¨ï¼Œä¸å‡ºé—®é¢˜è¿˜å¥½ï¼Œé™¤äº†é—®é¢˜åˆæŸæ‰‹æ— ç­–ï¼Œä¹‹å‰ä¹Ÿå¾ˆå°‘çœ‹åˆ°å“ªæœ¬ä¹¦æˆ–è€…è¯¾ç¨‹ä¸Šæœ‰ä¸“é—¨è®²è¿™éƒ¨åˆ†çš„ï¼Œäº†è§£äº†ä¸¤ä¸ªå®ç”¨çš„ç›‘æµ‹å·¥å…·ã€‚è¿™ç¯‡è¯¾ç¨‹å’Œç•™è¨€éƒ½å€¼å¾—åå¤çœ‹å‡ éå¥½å¥½æ£æ‘©","like_count":0},{"had_liked":false,"id":262146,"user_name":"MindController","can_delete":false,"product_type":"c1","uid":1159113,"ip_address":"","ucode":"3B9CECCD12CF6E","user_header":"https://static001.geekbang.org/account/avatar/00/11/af/c9/d9c72c60.jpg","comment_is_top":false,"comment_ctime":1605622433,"is_pvip":false,"replies":[{"id":"95135","content":"æ²¡äº‹","user_name":"ä½œè€…å›å¤","comment_id":262146,"uid":"1001470","ip_address":"","utype":1,"ctime":1605665642,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"1605622433","product_id":100047701,"comment_content":"å¹²è´§å®åœ¨å¤ªå¤šï¼Œè°¢è°¢è€å¸ˆ","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":509704,"discussion_content":"æ²¡äº‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605665642,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":250610,"user_name":"james","can_delete":false,"product_type":"c1","uid":1049208,"ip_address":"","ucode":"5701899403917C","user_header":"https://static001.geekbang.org/account/avatar/00/10/02/78/23c56bce.jpg","comment_is_top":false,"comment_ctime":1601170921,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1601170921","product_id":100047701,"comment_content":"å¯¹äºæ•°æ®åº“è¿æ¥æ± æ˜¯æœ‰è‡ªåŠ¨éªŒéªŒè¯poolä¸­è¿æ¥æ˜¯å¦å¯ç”¨çš„æœºåˆ¶ï¼Œä½†æ˜¯httpclientçš„è¿æ¥æ± å´æ²¡æœ‰ï¼Œæ¯”å¦‚å¸¸è§çš„connect reset by peerå¼‚å¸¸ï¼Œç›®å‰æˆ‘æ˜¯é€šè¿‡catchå¼‚å¸¸é‡è¯•æ¥å®ç°ï¼Œä¸çŸ¥é“è€å¸ˆæœ‰æ²¡æœ‰å¥½æ–¹æ³•","like_count":0},{"had_liked":false,"id":248842,"user_name":"Sruby","can_delete":false,"product_type":"c1","uid":1016232,"ip_address":"","ucode":"A7D1B93F41DA0F","user_header":"https://static001.geekbang.org/account/avatar/00/0f/81/a8/559afe8b.jpg","comment_is_top":false,"comment_ctime":1600331782,"is_pvip":false,"discussion_count":1,"race_medal":1,"score":"1600331782","product_id":100047701,"comment_content":"å¤ç”¨æ–¹å¼å¾ˆç®€å•ï¼Œä½ å¯ä»¥æŠŠ CloseableHttpClient å£°æ˜ä¸º staticï¼Œåªåˆ›å»ºä¸€æ¬¡ï¼Œå¹¶ä¸”åœ¨ JVM å…³é—­ä¹‹å‰é€šè¿‡ addShutdownHook é’©å­å…³é—­è¿æ¥æ± ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™ç›´æ¥ä½¿ç”¨ CloseableHttpClient å³å¯ï¼Œæ— éœ€æ¯æ¬¡éƒ½åˆ›å»ºã€‚<br>--------------------------<br>CloseableHttpClientå®ç°äº†Closeableï¼Œåœ¨jvmé€€å‡ºçš„æ—¶å€™ä¼šè‡ªåŠ¨é”€æ¯è¿æ¥å§ã€‚","like_count":0,"discussions":[{"author":{"id":1016232,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/81/a8/559afe8b.jpg","nickname":"Sruby","note":"","ucode":"A7D1B93F41DA0F","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":307479,"discussion_content":"æŸ¥è¯¢äº†æ›´å¤šèµ„æ–™å‘ç°ï¼Œæœ€ä½³å®è·µè¿˜æ˜¯é€šè¿‡é’©å­æ¥é”€æ¯ï¼Œjvmæ­£å¸¸é€€å‡ºæ‰ä¼šå¤„ç†closeableçš„èµ„æºï¼Œå¼‚å¸¸é€€å‡ºåˆ™ä¸ä¼šã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1600664342,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":245841,"user_name":"è¡Œåˆ™å°†è‡³","can_delete":false,"product_type":"c1","uid":1542987,"ip_address":"","ucode":"DB972F2DF059C4","user_header":"https://static001.geekbang.org/account/avatar/00/17/8b/4b/fa52d222.jpg","comment_is_top":false,"comment_ctime":1599092596,"is_pvip":false,"replies":[{"id":"90406","content":"å¦‚æœåœ¨shutdownhooké‡Œä¼˜é›…å…³é—­çº¿ç¨‹æ± ï¼Œæ˜¾ç„¶æ›´å¥½ï¼Œä½†æ˜¯éœ€è¦è®¾ç½®è¶…æ—¶","user_name":"ä½œè€…å›å¤","comment_id":245841,"uid":"1001470","ip_address":"","utype":1,"ctime":1599104860,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":1,"score":"1599092596","product_id":100047701,"comment_content":"è€å¸ˆï¼Œä½¿ç”¨jdkçš„çº¿ç¨‹æ± ï¼Œéœ€è¦ç»™jdkçš„çº¿ç¨‹æ± æ³¨å†Œä¸€ä¸ªé’©å­å‡½æ•°ä»¥ç”¨äºä¼˜é›…é€€å‡ºå—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":504991,"discussion_content":"å¦‚æœåœ¨shutdownhooké‡Œä¼˜é›…å…³é—­çº¿ç¨‹æ± ï¼Œæ˜¾ç„¶æ›´å¥½ï¼Œä½†æ˜¯éœ€è¦è®¾ç½®è¶…æ—¶","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599104860,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":242182,"user_name":"å°é’³å­","can_delete":false,"product_type":"c1","uid":1651085,"ip_address":"","ucode":"E60214AB3E7E99","user_header":"https://static001.geekbang.org/account/avatar/00/19/31/8d/d6367617.jpg","comment_is_top":false,"comment_ctime":1597631026,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597631026","product_id":100047701,"comment_content":"springboot2.0.9ã€‚å¯åŠ¨æ˜¾ç¤ºä½¿ç”¨çš„hikariã€‚ä½†æ˜¯æŒ‰è€å¸ˆçš„æ–¹æ³•æ·»åŠ hikariåˆ°jmxåæ²¡æœ‰çœ‹åˆ°hikariã€‚åè€Œçœ‹åˆ°äº†druidã€‚è¯·é—®è¿™æ˜¯å•¥æƒ…å†µ","like_count":0},{"had_liked":false,"id":231251,"user_name":"DZZ","can_delete":false,"product_type":"c1","uid":1516167,"ip_address":"","ucode":"C8E4C4B089BCE2","user_header":"https://static001.geekbang.org/account/avatar/00/17/22/87/e7bd2acf.jpg","comment_is_top":false,"comment_ctime":1593614798,"is_pvip":true,"replies":[{"id":"85413","content":"æˆ‘æ²¡æœ‰æ·±ç©¶è¿‡ï¼Œä½†æˆ‘å¹¶ä¸è®¤ä¸ºä¼šï¼Œå³ä½¿é—²ç½®é“¾æ¥ä¸é‡Šæ”¾ï¼Œä¹Ÿä¸ä¼šæ— é™å¢åŠ æ›´å¤šé—²ç½®é“¾æ¥å¼•èµ·å†…å­˜é—®é¢˜ï¼Œé“¾æ¥æ€»æ•°æ˜¯è¿æ¥æ± æ§åˆ¶çš„","user_name":"ä½œè€…å›å¤","comment_id":231251,"uid":"1001470","ip_address":"","utype":1,"ctime":1593654756,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"1593614798","product_id":100047701,"comment_content":"Mongoclientåœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®MaxConnectionIdleTimeï¼Œé»˜è®¤æ˜¯0ã€‚ä¼šå¯¼è‡´è¿æ¥ä¸€ç›´ä¸é‡Šæ”¾èµ„æºï¼Œé€ æˆåº”ç”¨å†…å­˜ä½¿ç”¨ä¸Šå‡è¿›è€Œè§¦å‘gâ€†cçš„æ—¶å€™æ‰é‡Šæ”¾ã€‚æ˜¯å¦åº”è¯¥é€‚å½“é…ç½®è¿™ä¸ªå‚æ•°ç”¨äºåœ¨ä¸å…³é—­mongoclientçš„æƒ…å†µä¸‹æ˜¯å¦è¿æ¥èµ„æºï¼Ÿæˆ–è€…æœ‰æ²¡æœ‰å•ç‹¬çš„é‡Šæ”¾è¿æ¥æ± å†…çº¿ç¨‹çš„æ–¹æ³•ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":500217,"discussion_content":"æˆ‘æ²¡æœ‰æ·±ç©¶è¿‡ï¼Œä½†æˆ‘å¹¶ä¸è®¤ä¸ºä¼šï¼Œå³ä½¿é—²ç½®é“¾æ¥ä¸é‡Šæ”¾ï¼Œä¹Ÿä¸ä¼šæ— é™å¢åŠ æ›´å¤šé—²ç½®é“¾æ¥å¼•èµ·å†…å­˜é—®é¢˜ï¼Œé“¾æ¥æ€»æ•°æ˜¯è¿æ¥æ± æ§åˆ¶çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593654756,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":220628,"user_name":"æ˜¥æš–èŠ±å¼€","can_delete":false,"product_type":"c1","uid":1215253,"ip_address":"","ucode":"8B7D3BA1C1DD1B","user_header":"https://static001.geekbang.org/account/avatar/00/12/8b/15/5278f52a.jpg","comment_is_top":false,"comment_ctime":1590300021,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1590300021","product_id":100047701,"comment_content":"è€å¸ˆè®²çš„å¾ˆå®ç”¨ï¼Œç‚¹ä¸ªèµ<br>","like_count":0},{"had_liked":false,"id":216639,"user_name":"å¤©å¤©å‘ä¸Š","can_delete":false,"product_type":"c1","uid":1242455,"ip_address":"","ucode":"0CCCA6F4DCC480","user_header":"https://static001.geekbang.org/account/avatar/00/12/f5/57/ce10fb1b.jpg","comment_is_top":false,"comment_ctime":1589299935,"is_pvip":false,"replies":[{"id":"80148","content":"æ‰‹ç»˜","user_name":"ä½œè€…å›å¤","comment_id":216639,"uid":"1001470","ip_address":"","utype":1,"ctime":1589324519,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"1589299935","product_id":100047701,"comment_content":"è€å¸ˆå¥½ï¼Œjedisçš„ç±»å›¾æ˜¯ç”¨ä»€ä¹ˆæ’ä»¶ç”Ÿæˆçš„å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":494891,"discussion_content":"æ‰‹ç»˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589324519,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":211035,"user_name":"åŒ…åŒ…çˆ¸çˆ¸","can_delete":false,"product_type":"c1","uid":1305227,"ip_address":"","ucode":"EBBB1663B41650","user_header":"https://static001.geekbang.org/account/avatar/00/13/ea/8b/5fe54e19.jpg","comment_is_top":false,"comment_ctime":1587884262,"is_pvip":false,"replies":[{"id":"78496","content":"ï¼šï¼‰","user_name":"ä½œè€…å›å¤","comment_id":211035,"uid":"1001470","ip_address":"","utype":1,"ctime":1587887772,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"1587884262","product_id":100047701,"comment_content":"å“ˆå“ˆå“ˆï¼Œæ¯”å–»æœ‰æ„æ€ï¼Œåªæ˜¯ä¸å¤ªå¯èƒ½å‘€ï¼Œé±¼æ‹¿å‡ºæ¥ç”¨ï¼Œä¸€èˆ¬ä¸å°±æ˜¯åƒäº†ä¹ˆï¼Œæ”¾ä¸å›å»äº†å“ˆå“ˆå“ˆ","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":493175,"discussion_content":"ï¼šï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587887772,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":205363,"user_name":"æ¢¦æƒ³æ³¨å®šä¸¶å­¤ç‹¬","can_delete":false,"product_type":"c1","uid":1222688,"ip_address":"","ucode":"0E51E368DE53F2","user_header":"https://static001.geekbang.org/account/avatar/00/12/a8/20/6798446a.jpg","comment_is_top":false,"comment_ctime":1586598585,"is_pvip":false,"replies":[{"id":"76716","content":"websocketæˆ‘ä¸ç†Ÿï¼Œwebsocketæ˜¯ä¸€ä¸ªåè®®ï¼Œè‚¯å®šæœ‰ä¸åŒçš„æ¡†æ¶ä¸åŒçš„å®ç°ï¼Œè¿˜æ˜¯éœ€è¦é˜…è¯»æ¡†æ¶çš„æ–‡æ¡£å’Œæºç æ¥åˆ¤æ–­","user_name":"ä½œè€…å›å¤","comment_id":205363,"uid":"1001470","ip_address":"","utype":1,"ctime":1586604713,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":1,"score":"1586598585","product_id":100047701,"comment_content":"è€å¸ˆï¼Œwebsocketæœ‰è‡ªå¸¦è¿æ¥æ± å—ï¼Œå¦‚æœæ²¡æœ‰ï¼Œéœ€è¦é…ç½®è¿æ¥æ± å—","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491462,"discussion_content":"websocketæˆ‘ä¸ç†Ÿï¼Œwebsocketæ˜¯ä¸€ä¸ªåè®®ï¼Œè‚¯å®šæœ‰ä¸åŒçš„æ¡†æ¶ä¸åŒçš„å®ç°ï¼Œè¿˜æ˜¯éœ€è¦é˜…è¯»æ¡†æ¶çš„æ–‡æ¡£å’Œæºç æ¥åˆ¤æ–­","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586604713,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":203982,"user_name":"ç¨‹åºå‘˜å°è·ƒ","can_delete":false,"product_type":"c1","uid":1015483,"ip_address":"","ucode":"25BB96E0791A60","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7e/bb/947c329a.jpg","comment_is_top":false,"comment_ctime":1586315262,"is_pvip":true,"replies":[{"id":"76275","content":"æ˜¯","user_name":"ä½œè€…å›å¤","comment_id":203982,"uid":"1001470","ip_address":"","utype":1,"ctime":1586324383,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"1586315262","product_id":100047701,"comment_content":"æ€»ç®—æœ‰æ—¶é—´æ¥å¥½å¥½å­¦ä¹ è¿™é—¨è¯¾ï¼Œå› ä¸ºæˆ‘æ‰€åœ¨é¡¹ç›®ç»„ä¸šåŠ¡è¢«ç äº†ï¼Œç›®å‰å¾…åˆ†é…ä¸­ï¼Œå“­æ³£ã€‚<br><br>ä½†æ˜¯ï¼Œåˆšå¥½å¯ä»¥å¥½å¥½å­¦ä¹ è€å¸ˆçš„è¿™é—¨è¯¾ã€‚è¿™èŠ‚è¯¾è®²çš„è™½ç„¶æ˜¯å„ç§è¿æ¥æ± ï¼Œæˆ‘ä¹Ÿä½¿ç”¨è¿‡è¿™å‡ ä¸ªè¿æ¥æ± ï¼Œä½†éƒ½æ˜¯é‡åˆ°é—®é¢˜é‡‡å–å‘ç°ï¼Œå»é‡‡å–ä¸€å®šçš„æªæ–½ï¼Œæ²¡æœ‰å»åšæ›´å¤šçš„æ€è€ƒã€‚<br><br>å…¶å®ï¼Œè€å¸ˆçš„è®²è§£ï¼Œæˆ‘è¿˜æ˜¯é‚£ä¸ªæ€»ç»“ï¼šæºç ä¹‹ä¸‹æ— ç§˜å¯†ã€‚åªè¦ä½ æœ‰å¿ƒå»é˜…è¯»æºç ï¼Œåˆ†æåŸç†ï¼Œè¿˜æœ‰ä»€ä¹ˆèƒ½éš¾å€’ä½ å‘¢ã€‚åŒæ ·çš„é“ç†ï¼Œå°±å¯ä»¥å¾ˆå¥½åœ°ç”¨åœ¨è¯¾åä¹ é¢˜ä¸Šã€‚","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":491028,"discussion_content":"æ˜¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586324383,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":203859,"user_name":"Xg huang","can_delete":false,"product_type":"c1","uid":1016995,"ip_address":"","ucode":"9680FA95DE3553","user_header":"","comment_is_top":false,"comment_ctime":1586276392,"is_pvip":false,"replies":[{"id":"76199","content":"å¯ä»¥å†ä»”ç»†çœ‹ä¸€ä¸‹æ–‡ç« ï¼Œå¦‚æœCloseableHttpClientä¸æ˜¯å®šä¹‰ä¸ºå•ä¾‹å£°æ˜å‘¨æœŸå’Œåº”ç”¨ç›¸åŒï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½newå‡ºæ¥ä½¿ç”¨çš„è¯ï¼Œéœ€è¦é‡Šæ”¾","user_name":"ä½œè€…å›å¤","comment_id":203859,"uid":"1001470","ip_address":"","utype":1,"ctime":1586303076,"user_name_real":"æœ±æ™”"}],"discussion_count":2,"race_medal":0,"score":"1586276392","product_id":100047701,"comment_content":"è¯·æ•™ä¸€ä¸‹è€å¸ˆå’Œå„ä½åŒå­¦ï¼Œ wrong1 å’Œ wrong2å…·ä½“æ˜¯ä»€ä¹ˆåŒºåˆ«ï¼Ÿ<br><br>wrong1 ä¸­è¿™ä¸ªéƒ¨åˆ†å¹¶æ— æ”¾è¿›try ä¸­ï¼Œ ä½†client æœ‰ï¼Œ è¿™æ ·åº”è¯¥å¯ä»¥æ­£ç¡®å›æ”¶èµ„æºå§ï¼Ÿ <br><br>CloseableHttpClient client = HttpClients.custom()<br>                .setConnectionManager(new PoolingHttpClientConnectionManager())<br>                .evictIdleConnections(60, TimeUnit.SECONDS).build();<br><br>","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490983,"discussion_content":"å¯ä»¥å†ä»”ç»†çœ‹ä¸€ä¸‹æ–‡ç« ï¼Œå¦‚æœCloseableHttpClientä¸æ˜¯å®šä¹‰ä¸ºå•ä¾‹å£°æ˜å‘¨æœŸå’Œåº”ç”¨ç›¸åŒï¼Œè€Œæ˜¯æ¯æ¬¡éƒ½newå‡ºæ¥ä½¿ç”¨çš„è¯ï¼Œéœ€è¦é‡Šæ”¾","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586303076,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1645430,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKiauonyMORA2s43W7mogGDH4WYjW0gBJtYmUa9icTB6aMPGqibicEKlLoQmLKLWEctwHzthbTZkKR20w/132","nickname":"Spring4J","note":"","ucode":"06F056085A2564","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":590689,"discussion_content":"ä¸¤ä¸ªé”™è¯¯ä¾‹å­éƒ½æ²¡æœ‰å¤ç”¨è¿æ¥æ± ï¼Œä½†æ˜¯ç¬¬äºŒä¸ªç”¨å®Œåé‡Šæ”¾äº†ï¼Œæ¯”ç¬¬ä¸€ä¸ªå¥½ç‚¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1666006123,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å››å·"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":201348,"user_name":"Thravus","can_delete":false,"product_type":"c1","uid":1056378,"ip_address":"","ucode":"C22B64FA9AAB55","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIhDXG8oeMaicibpPa6yccXTzGaFvQQhrOLd8knjz50hYEFA01txBFib65VKXh5fzfTFEFddbksQDgFg/132","comment_is_top":false,"comment_ctime":1585754133,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585754133","product_id":100047701,"comment_content":"æ”¶è·é¢‡ä¸°ï¼Œä»åŸç†åˆ°åº”ç”¨","like_count":0},{"had_liked":false,"id":200405,"user_name":"æ¢é“å±±","can_delete":false,"product_type":"c1","uid":1233214,"ip_address":"","ucode":"36249D99DD8D5D","user_header":"https://static001.geekbang.org/account/avatar/00/12/d1/3e/77c6ba5e.jpg","comment_is_top":false,"comment_ctime":1585580583,"is_pvip":false,"replies":[{"id":"74994","content":"è§‰å¾—æœ‰ç”¨å¯ä»¥åˆ†è½¬å‘åˆ†äº«","user_name":"ä½œè€…å›å¤","comment_id":200405,"uid":"1001470","ip_address":"","utype":1,"ctime":1585616538,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"1585580583","product_id":100047701,"comment_content":"æœ€è¿‘åˆšå¥½è¦åšä»£ç é‡æ„ï¼Œçœ‹äº†æœ¬èŠ‚å†…å®¹ï¼Œèµ¶ç´§å»çœ‹äº†ä¸‹è‡ªå·±ä»¥å‰å†™çš„ä»£ç ï¼Œå‘ç°äº†ä¸å°‘é—®é¢˜ï¼Œæ„Ÿè°¢æ„Ÿè°¢ï¼è™½ç„¶åˆšçœ‹äº†5èŠ‚è¯¾ï¼Œä½†æ˜¯æ¨ä¸èƒ½ç«‹é©¬å…¨éƒ¨çœ‹å®Œï¼ŒçŸ¥è¯†ç‚¹æ»¡æ»¡çš„ï¼Œæ‰€ä»¥ä¹ŸæœŸå¾…è€å¸ˆèƒ½å¦æ›´æ–°å¿«ä¸€ç‚¹ ã€ç¬‘è„¸ã€‘ã€æŠ±æ‹³ã€‘ï¼ï¼ï¼","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490016,"discussion_content":"è§‰å¾—æœ‰ç”¨å¯ä»¥åˆ†è½¬å‘åˆ†äº«","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585616538,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":200247,"user_name":"å¤§æ©˜ä¸ºé‡","can_delete":false,"product_type":"c1","uid":1106152,"ip_address":"","ucode":"96479F205B8384","user_header":"https://static001.geekbang.org/account/avatar/00/10/e0/e8/66439469.jpg","comment_is_top":false,"comment_ctime":1585562455,"is_pvip":true,"replies":[{"id":"74995","content":"åŠ æ²¹","user_name":"ä½œè€…å›å¤","comment_id":200247,"uid":"1001470","ip_address":"","utype":1,"ctime":1585616575,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"1585562455","product_id":100047701,"comment_content":"å¥½è¯¾ç¨‹ï¼è™½ç„¶æ¯æ¬¡éƒ½éœ€è¦èŠ±è´¹å¾ˆé•¿çš„æ—¶é—´æ¥é˜…è¯»ç†è§£ï¼Œä½†æ˜¯æ„Ÿæ‚ŸæŒºå¤šçš„ï¼Œä½†æ˜¯ç¦»å­¦ä»¥è‡´ç”¨è¿˜æ˜¯æœ‰ä¸€æ®µè·ç¦»ï¼Œä½†æ˜¯è‡³å°‘æœ‰ä¸ªè§‚å¿µï¼Œèµ","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489971,"discussion_content":"åŠ æ²¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585616575,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":198235,"user_name":"Geek_3b1096","can_delete":false,"product_type":"c1","uid":1549364,"ip_address":"","ucode":"A6BD92B79B3632","user_header":"","comment_is_top":false,"comment_ctime":1585421632,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585421632","product_id":100047701,"comment_content":"å¾ˆå–œæ¬¢è€å¸ˆåˆ†ææ–¹å¼","like_count":0},{"had_liked":false,"id":193789,"user_name":"Farewellä¸¶","can_delete":false,"product_type":"c1","uid":1179565,"ip_address":"","ucode":"A0D69893C5375C","user_header":"https://static001.geekbang.org/account/avatar/00/11/ff/ad/5020a8c5.jpg","comment_is_top":false,"comment_ctime":1584964202,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584964202","product_id":100047701,"comment_content":"The MongoClient instance represents a pool of connections to the database; you will only need one instance of class MongoClient even with multiple threads.","like_count":0},{"had_liked":false,"id":188943,"user_name":"å˜¿ï¼Œå°ä¼™å„¿","can_delete":false,"product_type":"c1","uid":1905273,"ip_address":"","ucode":"3CA13E580351F1","user_header":"https://static001.geekbang.org/account/avatar/00/1d/12/79/ed838d0a.jpg","comment_is_top":false,"comment_ctime":1584437070,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1584437070","product_id":100047701,"comment_content":"ä¸‹è½½æºç å, è¿è¡Œdocker ä¼šåœ¨mysqlå¡ä½,  ç­‰å¾…ä¸€ä¸‹åˆäº†,  å¤§å®¶éƒ½å¥½ç”¨å—?<br><br>$ docker-compose up<br>common-mistakes-redis-3 is up-to-date<br>common-mistakes-rabbitmq is up-to-date<br>Starting es03 ...<br>Starting es03                    ... done<br>Starting es01                    ... done<br>Creating common-mistakes-mysql57 ...<br>","like_count":0,"discussions":[{"author":{"id":1301304,"avatar":"https://static001.geekbang.org/account/avatar/00/13/db/38/7ab139a3.jpg","nickname":"zå°ä¿Šã€Arno","note":"","ucode":"312B3DDCF15102","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":215246,"discussion_content":"æˆ‘å¾ˆé¡ºåˆ©äºš\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585307043,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":188241,"user_name":"mgs2002","can_delete":false,"product_type":"c1","uid":1812970,"ip_address":"","ucode":"F5931108BD509B","user_header":"https://static001.geekbang.org/account/avatar/00/1b/a9/ea/5bfce6c5.jpg","comment_is_top":false,"comment_ctime":1584330397,"is_pvip":false,"replies":[{"id":"72679","content":"æ˜¯çš„ï¼Œè¦å…³é—­çš„è¯ä¹Ÿåº”è¯¥åœ¨ç¨‹åºshutdownçš„æ—¶å€™å»å…³é—­","user_name":"ä½œè€…å›å¤","comment_id":188241,"uid":"1001470","ip_address":"","utype":1,"ctime":1584337139,"user_name_real":"æœ±æ™”"}],"discussion_count":1,"race_medal":0,"score":"1584330397","product_id":100047701,"comment_content":"çœ‹äº†ä¸€ä¸‹mongDBå®˜æ–¹æ–‡æ¡£ï¼Œåº”è¯¥æ˜¯ç¬¬äºŒç§ç±»å‹çš„ï¼Œè¿æ¥æ± çš„ç»´æŠ¤ç®¡ç†éƒ½æ˜¯mongDBè‡ªå·±è¿›è¡Œï¼Œç”¨æˆ·ä¸ç”¨æ‰‹åŠ¨å»å…³é—­ï¼Œè¦æ‰‹åŠ¨çš„è¯ä¹Ÿå¯ä»¥è°ƒç”¨close()æ–¹æ³•","like_count":0,"discussions":[{"author":{"id":1001470,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/47/fe/d0e25d57.jpg","nickname":"æœ±æ™”","note":"","ucode":"0B7F0BADE6AAB8","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487361,"discussion_content":"æ˜¯çš„ï¼Œè¦å…³é—­çš„è¯ä¹Ÿåº”è¯¥åœ¨ç¨‹åºshutdownçš„æ—¶å€™å»å…³é—­","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584337139,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}