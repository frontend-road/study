{"id":382733,"title":"14 | Linuxåˆå§‹åŒ–ï¼ˆä¸Šï¼‰ï¼šGRUBä¸vmlinuzçš„ç»“æ„","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯LMOSã€‚</p><p>åœ¨å‰é¢çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å»ºå¥½äº†äºŒçº§å¼•å¯¼å™¨ï¼Œå¯åŠ¨äº†æˆ‘ä»¬çš„Cosmosï¼Œå¹¶è¿›è¡Œäº†æˆ‘ä»¬Cosmosçš„Halå±‚åˆå§‹åŒ–ã€‚</p><p>æˆ‘ä¼šç”¨ä¸¤èŠ‚è¯¾å¸¦ä½ é¢†ä¼šLinuxæ€æ ·åšåˆå§‹åŒ–ã€‚è™½ç„¶æˆ‘ä»¬è‡ªå·±å…·ä½“å®ç°è¿‡äº†åˆå§‹åŒ–ï¼Œä¸è¿‡æˆ‘ä»¬ä¹Ÿä¸å¦¨çœ‹çœ‹Linuxçš„åˆå§‹åŒ–æµç¨‹ï¼Œå€Ÿé‰´ä¸€ä¸‹Linuxå¼€å‘è€…çš„ç©æ³•ã€‚</p><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘ä¼šå…ˆä¸ºä½ æ¢³ç†å¯åŠ¨çš„æ•´ä½“æµç¨‹ï¼Œé‡ç‚¹ä¸ºä½ è§£è¯»Linuxä¸ŠGRUBæ˜¯æ€æ ·å¯åŠ¨ï¼Œä»¥åŠå†…æ ¸é‡Œçš„â€œå®æƒäººç‰©â€â€”â€”vmlinuzå†…æ ¸æ–‡ä»¶æ˜¯å¦‚ä½•äº§ç”Ÿå’Œè¿è½¬çš„ã€‚ä¸‹èŠ‚è¯¾ï¼Œæˆ‘ä»¬ä»setup.binæ–‡ä»¶çš„_startå‡½æ•°å…¥æ‰‹ï¼Œç ”ç©¶Linuxåˆå§‹åŒ–æµç¨‹ã€‚</p><p>å¥½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä»å…¨å±€æµç¨‹è®²èµ·ï¼Œæ­£å¼è¿›å…¥ä»Šå¤©çš„å­¦ä¹ ã€‚</p><h2>å…¨å±€æµç¨‹</h2><p>x86å¹³å°çš„å¯åŠ¨æµç¨‹ï¼Œæ˜¯éå¸¸å¤æ‚çš„ã€‚ä¸ºäº†å¸®åŠ©ä½ ç†è§£ï¼Œæˆ‘ä»¬å…ˆä»å…¨å±€ç²—ç•¥åœ°çœ‹ä¸€çœ‹æ•´ä½“æµç¨‹ï¼Œç„¶åä¸€æ­¥æ­¥ç»†åŒ–ã€‚</p><p>åœ¨æœºå™¨åŠ ç”µåï¼ŒBIOSä¼šè¿›è¡Œè‡ªæ£€ï¼Œç„¶åç”±BIOSåŠ è½½å¼•å¯¼è®¾å¤‡ä¸­å¼•å¯¼æ‰‡åŒºã€‚åœ¨å®‰è£…æœ‰Linuxæ“ä½œç³»ç»Ÿçš„æƒ…å†µä¸‹ï¼Œåœ¨å¼•å¯¼æ‰‡åŒºé‡Œï¼Œé€šå¸¸æ˜¯å®‰è£…çš„GRUBçš„ä¸€å°æ®µç¨‹åºï¼ˆå®‰è£…windowsçš„æƒ…å†µåˆ™ä¸åŒï¼‰ã€‚æœ€åï¼ŒGRUBä¼šåŠ è½½Linuxçš„å†…æ ¸æ˜ åƒvmlinuzï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f3/b3/f3d8b95e8c1563466d31f385bb42aab3.jpg?wh=3543*2005\" alt=\"\" title=\"x86çš„å…¨å±€å¯åŠ¨æµç¨‹ç¤ºæ„å›¾\"></p><p>ä¸Šå›¾ä¸­çš„å¼•å¯¼è®¾å¤‡é€šå¸¸æ˜¯æœºå™¨ä¸­çš„ç¡¬ç›˜ï¼Œä½†ä¹Ÿå¯ä»¥æ˜¯Uç›˜æˆ–è€…å…‰ç›˜ç”šè‡³æ˜¯è½¯ç›˜ã€‚BIOSä¼šè‡ªåŠ¨è¯»å–ä¿å­˜åœ¨CMOSä¸­çš„å¼•å¯¼è®¾å¤‡ä¿¡æ¯ã€‚</p><!-- [[[read_end]]] --><h2>ä»BIOSåˆ°GRUB</h2><p>ä»å‰é¢çš„è¯¾ç¨‹æˆ‘ä»¬å·²ç»çŸ¥é“ï¼ŒCPUè¢«è®¾è®¡æˆåªèƒ½è¿è¡Œå†…å­˜ä¸­çš„ç¨‹åºï¼Œæ²¡æœ‰åŠæ³•ç›´æ¥è¿è¡Œå‚¨å­˜åœ¨ç¡¬ç›˜æˆ–è€…Uç›˜ä¸­çš„æ“ä½œç³»ç»Ÿç¨‹åºã€‚</p><p>å¦‚æœæƒ³è¦è¿è¡Œç¡¬ç›˜æˆ–è€…Uç›˜ä¸­çš„ç¨‹åºï¼Œå°±å¿…é¡»è¦å…ˆåŠ è½½åˆ°å†…å­˜ï¼ˆRAMï¼‰ä¸­æ‰èƒ½è¿è¡Œã€‚è¿™æ˜¯å› ä¸ºç¡¬ç›˜ã€Uç›˜ï¼ˆå¤–éƒ¨å‚¨å­˜å™¨ï¼‰å¹¶ä¸å’ŒCPUç›´æ¥ç›¸è¿ï¼Œå®ƒä»¬çš„è®¿é—®æœºåˆ¶å’Œå¯»å€æ–¹å¼ä¸å†…å­˜æˆªç„¶ä¸åŒã€‚</p><p>å†…å­˜åœ¨æ–­ç”µåå°±æ²¡æ³•ä¿å­˜æ•°æ®äº†ï¼Œé‚£BIOSåˆæ˜¯å¦‚ä½•å¯åŠ¨çš„å‘¢ï¼Ÿç¡¬ä»¶å·¥ç¨‹å¸ˆè®¾è®¡CPUæ—¶ï¼Œç¡¬æ€§åœ°è§„å®šåœ¨åŠ ç”µçš„ç¬é—´ï¼Œå¼ºåˆ¶å°†CSå¯„å­˜å™¨çš„å€¼è®¾ç½®ä¸º0XF000ï¼ŒIPå¯„å­˜å™¨çš„å€¼è®¾ç½®ä¸º0XFFF0ã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼ŒCS:IPå°±æŒ‡å‘äº†0XFFFF0è¿™ä¸ªç‰©ç†åœ°å€ã€‚åœ¨è¿™ä¸ªç‰©ç†åœ°å€ä¸Šè¿æ¥äº†ä¸»æ¿ä¸Šçš„ä¸€å—å°çš„ROMèŠ¯ç‰‡ã€‚è¿™ç§èŠ¯ç‰‡çš„è®¿é—®æœºåˆ¶å’Œå¯»å€æ–¹å¼å’Œå†…å­˜ä¸€æ ·ï¼Œåªæ˜¯å®ƒåœ¨æ–­ç”µæ—¶ä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œåœ¨å¸¸è§„ä¸‹ä¹Ÿä¸èƒ½å¾€è¿™é‡Œå†™å…¥æ•°æ®ï¼Œå®ƒæ˜¯ä¸€ç§<strong>åªè¯»å†…å­˜</strong>ï¼ŒBIOSç¨‹åºå°±è¢«å›ºåŒ–åœ¨è¯¥ROMèŠ¯ç‰‡é‡Œã€‚</p><p>ç°åœ¨ï¼ŒCS:IPæŒ‡å‘äº†0XFFFF0è¿™ä¸ªä½ç½®ï¼Œæ­£æ˜¯BIOSç¨‹åºçš„å…¥å£åœ°å€ã€‚è¿™æ„å‘³ç€BIOSæ­£å¼å¼€å§‹å¯åŠ¨ã€‚</p><p>BIOSä¸€å¼€å§‹ä¼šåˆå§‹åŒ–CPUï¼Œæ¥ç€æ£€æŸ¥å¹¶åˆå§‹åŒ–å†…å­˜ï¼Œç„¶åå°†è‡ªå·±çš„ä¸€éƒ¨åˆ†å¤åˆ¶åˆ°å†…å­˜ï¼Œæœ€åè·³è½¬åˆ°å†…å­˜ä¸­è¿è¡Œã€‚BIOSçš„ä¸‹ä¸€æ­¥å°±æ˜¯æšä¸¾æœ¬åœ°è®¾å¤‡è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶è¿›è¡Œç›¸å…³çš„æ£€æŸ¥ï¼Œæ£€æŸ¥ç¡¬ä»¶æ˜¯å¦æŸåï¼Œè¿™æœŸé—´BIOSä¼šè°ƒç”¨å…¶å®ƒè®¾å¤‡ä¸Šçš„å›ºä»¶ç¨‹åºï¼Œå¦‚æ˜¾å¡ã€ç½‘å¡ç­‰è®¾å¤‡ä¸Šçš„å›ºä»¶ç¨‹åºã€‚</p><p>å½“è®¾å¤‡åˆå§‹åŒ–å’Œæ£€æŸ¥æ­¥éª¤å®Œæˆä¹‹åï¼Œ<strong>BIOSä¼šåœ¨å†…å­˜ä¸­å»ºç«‹ä¸­æ–­è¡¨å’Œä¸­æ–­æœåŠ¡ç¨‹åº</strong>ï¼Œè¿™æ˜¯å¯åŠ¨Linuxè‡³å…³é‡è¦çš„å·¥ä½œï¼Œå› ä¸ºLinuxä¼šç”¨åˆ°å®ƒä»¬ã€‚</p><p>å…·ä½“æ˜¯æ€ä¹ˆæ“ä½œçš„å‘¢ï¼ŸBIOSä¼šä»å†…å­˜åœ°å€ï¼ˆ0x00000ï¼‰å¼€å§‹ç”¨1KBçš„å†…å­˜ç©ºé—´ï¼ˆ0x00000~0x003FFï¼‰æ„å»ºä¸­æ–­è¡¨ï¼Œåœ¨ç´§æ¥ç€ä¸­æ–­è¡¨çš„ä½ç½®ï¼Œç”¨256KBçš„å†…å­˜ç©ºé—´æ„å»ºBIOSæ•°æ®åŒºï¼ˆ0x00400~0x004FFï¼‰ï¼Œå¹¶åœ¨0x0e05bçš„åœ°å€åŠ è½½äº†8KBå¤§å°çš„ä¸ä¸­æ–­è¡¨å¯¹åº”çš„ä¸­æ–­æœåŠ¡ç¨‹åºã€‚</p><p>ä¸­æ–­è¡¨ä¸­æœ‰256ä¸ªæ¡ç›®ï¼Œæ¯ä¸ªæ¡ç›®å ç”¨4ä¸ªå­—èŠ‚ï¼Œå…¶ä¸­ä¸¤ä¸ªå­—èŠ‚æ˜¯CSå¯„å­˜å™¨çš„å€¼ï¼Œä¸¤ä¸ªå­—èŠ‚æ˜¯IPå¯„å­˜å™¨çš„å€¼ã€‚æ¯ä¸ªæ¡ç›®éƒ½æŒ‡å‘ä¸€ä¸ªå…·ä½“çš„ä¸­æ–­æœåŠ¡ç¨‹åºã€‚</p><p>ä¸ºäº†å¯åŠ¨å¤–éƒ¨å‚¨å­˜å™¨ä¸­çš„ç¨‹åºï¼ŒBIOSä¼šæœç´¢å¯å¼•å¯¼çš„è®¾å¤‡ï¼Œæœç´¢çš„é¡ºåºæ˜¯ç”±CMOSä¸­çš„è®¾ç½®ä¿¡æ¯å†³å®šçš„ï¼ˆè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¹³æ—¶è®²çš„ï¼Œæ‰€è°“çš„åœ¨BIOSä¸­è®¾ç½®çš„å¯åŠ¨è®¾å¤‡é¡ºåºï¼‰ã€‚ä¸€ä¸ªæ˜¯è½¯é©±ï¼Œä¸€ä¸ªæ˜¯å…‰é©±ï¼Œä¸€ä¸ªæ˜¯ç¡¬ç›˜ä¸Šï¼Œè¿˜å¯ä»¥æ˜¯ç½‘ç»œä¸Šçš„è®¾å¤‡ç”šè‡³æ˜¯ä¸€ä¸ªusb æ¥å£çš„Uç›˜ï¼Œéƒ½å¯ä»¥ä½œä¸ºä¸€ä¸ªå¯åŠ¨è®¾å¤‡ã€‚</p><p>å½“ç„¶ï¼ŒLinuxé€šå¸¸æ˜¯ä»ç¡¬ç›˜ä¸­å¯åŠ¨çš„ã€‚ç¡¬ç›˜ä¸Šçš„ç¬¬1ä¸ªæ‰‡åŒºï¼ˆæ¯ä¸ªæ‰‡åŒº512å­—èŠ‚ç©ºé—´ï¼‰ï¼Œè¢«ç§°ä¸º<strong>MBRï¼ˆä¸»å¯åŠ¨è®°å½•ï¼‰</strong>ï¼Œå…¶ä¸­åŒ…å«æœ‰åŸºæœ¬çš„GRUBå¯åŠ¨ç¨‹åºå’Œåˆ†åŒºè¡¨ï¼Œå®‰è£…GRUBæ—¶ä¼šè‡ªåŠ¨å†™å…¥åˆ°è¿™ä¸ªæ‰‡åŒºï¼Œå½“MBRè¢«BIOSè£…è½½åˆ°0x7c00åœ°å€å¼€å§‹çš„å†…å­˜ç©ºé—´ä¸­åï¼ŒBIOSå°±ä¼šå°†æ§åˆ¶æƒè½¬äº¤ç»™äº†MBRã€‚åœ¨å½“å‰çš„æƒ…å†µä¸‹ï¼Œå…¶å®æ˜¯äº¤ç»™äº†GRUBã€‚</p><p>åˆ°è¿™é‡Œï¼ŒBIOSåˆ°GRUBçš„è¿‡ç¨‹ç»“æŸã€‚</p><h2>GRUBæ˜¯å¦‚ä½•å¯åŠ¨çš„</h2><p>æ ¹æ®å‰é¢å†…å®¹å¯ä»¥å‘ç°ï¼ŒBIOSåªä¼šåŠ è½½ç¡¬ç›˜ä¸Šçš„ç¬¬1ä¸ªæ‰‡åŒºã€‚ä¸è¿‡è¿™ä¸ªæ‰‡åŒºä»…æœ‰512å­—èŠ‚ï¼Œè¿™512å­—èŠ‚ä¸­è¿˜æœ‰64å­—èŠ‚çš„åˆ†åŒºè¡¨åŠ 2å­—èŠ‚çš„å¯åŠ¨æ ‡å¿—ï¼Œå¾ˆæ˜¾ç„¶ï¼Œå‰©ä¸‹446å­—èŠ‚çš„ç©ºé—´ï¼Œæ˜¯è£…ä¸ä¸‹GRUBè¿™ç§å¤§å‹é€šç”¨å¼•å¯¼å™¨çš„ã€‚</p><p>äºæ˜¯ï¼ŒGRUBçš„åŠ è½½åˆ†æˆäº†å¤šä¸ªæ­¥éª¤ï¼ŒåŒæ—¶GRUBä¹Ÿåˆ†æˆäº†å¤šä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­æœ‰ä¸¤ä¸ª<strong>é‡è¦çš„æ–‡ä»¶boot.imgå’Œcore.img</strong>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/b9/85/b92dyy0f686e730ffcb606ed17e5b785.jpg?wh=558*86\" alt=\"\" title=\"GRUBæ ¸å¿ƒæ–‡ä»¶\"></p><p>å…¶ä¸­ï¼Œboot.imgè¢«GRUBçš„å®‰è£…ç¨‹åºå†™å…¥åˆ°ç¡¬ç›˜çš„MBRä¸­ï¼ŒåŒæ—¶åœ¨boot.imgæ–‡ä»¶ä¸­çš„ä¸€ä¸ªä½ç½®å†™å…¥core.imgæ–‡ä»¶å ç”¨çš„ç¬¬ä¸€ä¸ªæ‰‡åŒºçš„æ‰‡åŒºå·ã€‚</p><p>è€Œcore.imgæ–‡ä»¶æ˜¯ç”±GRUBå®‰è£…ç¨‹åºæ ¹æ®å®‰è£…æ—¶ç¯å¢ƒä¿¡æ¯ï¼Œç”¨å…¶å®ƒGRUBçš„æ¨¡å—æ–‡ä»¶åŠ¨æ€ç”Ÿæˆã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/cb/4b/cb36d637ce0a0d7c38788102e139604b.jpg?wh=3180*1105\" alt=\"\" title=\"GRUB-coreimgæ ¼å¼\"></p><p>å¦‚æœæ˜¯ä»ç¡¬ç›˜å¯åŠ¨çš„è¯ï¼Œcore.imgä¸­çš„ç¬¬ä¸€ä¸ªæ‰‡åŒºçš„å†…å®¹å°±æ˜¯diskboot.imgæ–‡ä»¶ã€‚diskboot.imgæ–‡ä»¶çš„ä½œç”¨æ˜¯ï¼Œ<strong>è¯»å–core.imgä¸­å‰©ä½™çš„éƒ¨åˆ†åˆ°å†…å­˜ä¸­ã€‚</strong></p><p>ç”±äºè¿™æ—¶diskboot.imgæ–‡ä»¶è¿˜ä¸è¯†åˆ«æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰€ä»¥æˆ‘ä»¬å°†core.imgæ–‡ä»¶çš„å…¨éƒ¨ä½ç½®ï¼Œéƒ½ç”¨æ–‡ä»¶å—åˆ—è¡¨çš„æ–¹å¼ä¿å­˜åˆ°diskboot.imgæ–‡ä»¶ä¸­ã€‚è¿™æ ·å°±èƒ½ç¡®ä¿diskboot.imgæ–‡ä»¶æ‰¾åˆ°core.imgæ–‡ä»¶çš„å‰©ä½™å†…å®¹ï¼Œæœ€åå°†æ§åˆ¶æƒäº¤ç»™kernel.imgæ–‡ä»¶ã€‚</p><p>å› ä¸ºè¿™æ—¶core.imgæ–‡ä»¶ä¸­åµŒå…¥äº†è¶³å¤Ÿå¤šçš„åŠŸèƒ½æ¨¡å—ï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯GRUBè¯†åˆ«å‡ºç¡¬ç›˜åˆ†åŒºä¸Šæ–‡ä»¶ç³»ç»Ÿï¼Œèƒ½å¤Ÿè®¿é—®/boot/grubç›®å½•ï¼Œå¹¶ä¸”å¯ä»¥åŠ è½½ç›¸å…³çš„é…ç½®æ–‡ä»¶å’ŒåŠŸèƒ½æ¨¡å—ï¼Œæ¥å®ç°ç›¸å…³çš„åŠŸèƒ½ï¼Œä¾‹å¦‚åŠ è½½å¯åŠ¨èœå•ã€åŠ è½½ç›®æ ‡æ“ä½œç³»ç»Ÿç­‰ã€‚</p><p>æ­£å› ä¸ºGRUB2å¤§é‡ä½¿ç”¨äº†åŠ¨æ€åŠ è½½åŠŸèƒ½æ¨¡å—ï¼Œè¿™ä½¿å¾—core.imgæ–‡ä»¶çš„ä½“ç§¯å˜å¾—è¶³å¤Ÿå°ã€‚è€ŒGRUBçš„core.imgæ–‡ä»¶ä¸€æ—¦å¼€å§‹å·¥ä½œï¼Œå°±å¯ä»¥åŠ è½½Linuxç³»ç»Ÿçš„vmlinuzå†…æ ¸æ–‡ä»¶äº†ã€‚</p><h2>è¯¦è§£vmlinuzæ–‡ä»¶ç»“æ„</h2><p>æˆ‘ä»¬åœ¨/bootç›®å½•ä¸‹ä¼šå‘ç°vmlinuzæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿ</p><p>å…¶å®å®ƒæ˜¯ç”±Linuxç¼–è¯‘ç”Ÿæˆçš„bzImageæ–‡ä»¶å¤åˆ¶è€Œæ¥çš„ï¼Œä½ è‡ªå·±å¯ä»¥ä¸‹è½½æœ€æ–°çš„Linuxä»£ç .</p><p>æˆ‘ä»¬ä¸€è‡´æŠŠLinuxæºç è§£å‹åˆ°ä¸€ä¸ªlinuxç›®å½•ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åé¢æŸ¥æ‰¾Linuxæºä»£ç æ–‡ä»¶æ€»æ˜¯ä»linuxç›®å½•å¼€å§‹çš„ï¼Œåˆ‡æ¢åˆ°ä»£ç ç›®å½•æ‰§è¡Œmake ARCH=x86_64ï¼Œå†æ‰§è¡Œmake installï¼Œå°±ä¼šäº§ç”Ÿvmlinuzæ–‡ä»¶ï¼Œä½ å¯ä»¥å‚è€ƒåé¢çš„makefileä»£ç ã€‚</p><pre><code>#linux/arch/x86/boot/Makefile\ninstall:    sh $(srctree)/$(src)/install.sh $(KERNELRELEASE) $(obj)/bzImage \\        System.map &quot;$(INSTALL_PATH)&quot;\n</code></pre><p>install.shè„šæœ¬æ–‡ä»¶åªæ˜¯å®Œæˆå¤åˆ¶çš„åŠŸèƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬åªè¦ææ‡‚äº†bzImageæ–‡ä»¶ç»“æ„ï¼Œå°±ç­‰åŒäºç†è§£äº†vmlinuzæ–‡ä»¶ç»“æ„ã€‚</p><p>é‚£ä¹ˆbzImageæ–‡ä»¶åˆæ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿæˆ‘ä»¬åªè¦ç ”ç©¶bzImageæ–‡ä»¶åœ¨Makefileä¸­çš„ç”Ÿæˆè§„åˆ™ï¼Œå°±ä¼šæç„¶å¤§æ‚Ÿï¼Œä»£ç å¦‚ä¸‹ ï¼š</p><pre><code>#linux/arch/x86/boot/Makefile\n$(obj)/bzImage: $(obj)/setup.bin $(obj)/vmlinux.bin $(obj)/tools/build FORCE    $(call if_changed,image)    @$(kecho) 'Kernel: $@ is ready' ' (#'`cat .version`')'\n</code></pre><p>ä»å‰é¢çš„ä»£ç å¯ä»¥çŸ¥é“ï¼Œç”ŸæˆbzImageæ–‡ä»¶éœ€è¦ä¸‰ä¸ªä¾èµ–æ–‡ä»¶ï¼šsetup.binã€vmlinux.binï¼Œlinux/arch/x86/boot/toolsç›®å½•ä¸‹çš„buildã€‚è®©æˆ‘ä»¬æŒ¨ä¸ªæ¥åˆ†æä¸€ä¸‹ã€‚</p><p>å…¶å®ï¼Œbuildåªæ˜¯ä¸€ä¸ªHOSTOSï¼ˆæ­£åœ¨ä½¿ç”¨çš„Linuxï¼‰ä¸‹çš„åº”ç”¨ç¨‹åºï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯å°†setup.binã€vmlinux.binä¸¤ä¸ªæ–‡ä»¶æ‹¼æ¥æˆä¸€ä¸ªbzImageæ–‡ä»¶ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/22/30/22a83b33b4eededec109bda203133830.jpg?wh=2805*1805\" alt=\"\" title=\"bzImageæ–‡ä»¶ç»“æ„ç¤ºæ„å›¾\"></p><p>å‰©ä¸‹çš„å°±æ˜¯ææ¸…æ¥šsetup.binã€vmlinux.binè¿™ä¸¤ä¸ªæ–‡ä»¶çš„çš„ç»“æ„ï¼Œå…ˆæ¥çœ‹çœ‹setup.binæ–‡ä»¶ï¼Œsetup.binæ–‡ä»¶æ˜¯ç”±objcopyå‘½ä»¤æ ¹æ®setup.elfç”Ÿæˆçš„ã€‚</p><p>setup.elfæ–‡ä»¶åˆæ€ä¹ˆç”Ÿæˆçš„å‘¢ï¼Ÿæˆ‘ä»¬ç»“åˆåé¢çš„ä»£ç æ¥çœ‹çœ‹ã€‚</p><pre><code>#è¿™äº›ç›®æ ‡æ–‡ä»¶æ­£æ˜¯ç”±/arch/x86/boot/ç›®å½•ä¸‹å¯¹åº”çš„ç¨‹åºæºä»£ç æ–‡ä»¶ç¼–è¯‘äº§ç”Ÿ\nsetup-y     += a20.o bioscall.o cmdline.o copy.o cpu.o cpuflags.o cpucheck.o\nsetup-y     += early_serial_console.o edd.o header.o main.o memory.o\nsetup-y     += pm.o pmjump.o printf.o regs.o string.o tty.o video.o\nsetup-y     += video-mode.o version.o\n\n#â€¦â€¦\nSETUP_OBJS = $(addprefix $(obj)/,$(setup-y))\n#â€¦â€¦\nLDFLAGS_setup.elf   := -m elf_i386 -T$(obj)/setup.elf: $(src)/setup.ld $(SETUP_OBJS) FORCE    $(call if_changed,ld)\n#â€¦â€¦\nOBJCOPYFLAGS_setup.bin  := -O binary$(obj)/setup.bin: $(obj)/setup.elf FORCE    $(call if_changed,objcopy)\n</code></pre><p>æ ¹æ®è¿™æ®µä»£ç ï¼Œä¸éš¾å‘ç°setup.binæ–‡ä»¶æ­£æ˜¯ç”±/arch/x86/boot/ç›®å½•ä¸‹ä¸€ç³»åˆ—å¯¹åº”çš„ç¨‹åºæºä»£ç æ–‡ä»¶ç¼–è¯‘é“¾æ¥äº§ç”Ÿï¼Œå…¶ä¸­çš„<strong>head.Sæ–‡ä»¶</strong>å’Œ<strong>main.cæ–‡ä»¶</strong>æ ¼å¤–é‡è¦ï¼Œåˆ«æ€¥ï¼Œè¿™ä¸ªæˆ‘ä¹‹åä¼šè®²ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬å…ˆçœ‹çœ‹vmlinux.binæ˜¯æ€ä¹ˆäº§ç”Ÿçš„ï¼Œæ„å»ºvmlinux.binçš„è§„åˆ™ä¾ç„¶åœ¨linux/arch/x86/boot/ç›®å½•ä¸‹çš„Makefileæ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>#linux/arch/x86/boot/Makefile\nOBJCOPYFLAGS_vmlinux.bin := -O binary -R .note -R .comment -S$(obj)/vmlinux.bin: $(obj)/compressed/vmlinux FORCE    $(call if_changed,objcopy)\n</code></pre><p>è¿™æ®µä»£ç çš„æ„æ€æ˜¯ï¼Œvmlinux.binæ–‡ä»¶ä¾èµ–äºlinux/arch/x86/boot/compressed/ç›®å½•ä¸‹çš„vmlinuxç›®æ ‡ï¼Œä¸‹é¢è®©æˆ‘ä»¬åˆ‡æ¢åˆ°linux/arch/x86/boot/compressed/ç›®å½•ä¸‹ç»§ç»­è¿½è¸ªã€‚æ‰“å¼€è¯¥ç›®å½•ä¸‹çš„Makefileï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹ä»£ç ã€‚</p><pre><code>#linux/arch/x86/boot/compressed/Makefile\n#â€¦â€¦\n#è¿™äº›ç›®æ ‡æ–‡ä»¶æ­£æ˜¯ç”±/arch/x86/boot/compressed/ç›®å½•ä¸‹å¯¹åº”çš„ç¨‹åºæºä»£ç æ–‡ä»¶ç¼–è¯‘äº§ç”Ÿ$(BITS)å–å€¼32æˆ–è€…64\nvmlinux-objs-y := $(obj)/vmlinux.lds $(obj)/kernel_info.o $(obj)/head_$(BITS).o \\    $(obj)/misc.o $(obj)/string.o $(obj)/cmdline.o $(obj)/error.o \\    $(obj)/piggy.o $(obj)/cpuflags.o\nvmlinux-objs-$(CONFIG_EARLY_PRINTK) += $(obj)/early_serial_console.o\nvmlinux-objs-$(CONFIG_RANDOMIZE_BASE) += $(obj)/kaslr.o\nifdef CONFIG_X86_64    \nvmlinux-objs-y += $(obj)/ident_map_64.o    \nvmlinux-objs-y += $(obj)/idt_64.o $(obj)/idt_handlers_64.o    vmlinux-objs-y += $(obj)/mem_encrypt.o    \nvmlinux-objs-y += $(obj)/pgtable_64.o    \nvmlinux-objs-$(CONFIG_AMD_MEM_ENCRYPT) += $(obj)/sev-es.o\nendif\n#â€¦â€¦\n$(obj)/vmlinux: $(vmlinux-objs-y) $(efi-obj-y) FORCE  \n$(call if_changed,ld)\n</code></pre><p>ç»“åˆè¿™æ®µä»£ç æˆ‘ä»¬å‘ç°ï¼Œlinux/arch/x86/boot/compressedç›®å½•ä¸‹çš„vmlinuxæ˜¯ç”±è¯¥ç›®å½•ä¸‹çš„head_32.oæˆ–è€…head_64.oã€cpuflags.oã€error.oã€kernel.oã€misc.oã€string.o ã€cmdline.o ã€early_serial_console.oç­‰æ–‡ä»¶ä»¥åŠpiggy.oé“¾æ¥è€Œæˆçš„ã€‚</p><p>å…¶ä¸­ï¼Œvmlinux.ldsæ˜¯é“¾æ¥è„šæœ¬æ–‡ä»¶ã€‚åœ¨æ²¡åšä»»ä½•ç¼–è¯‘åŠ¨ä½œå‰ï¼Œå‰é¢ä¾èµ–åˆ—è¡¨ä¸­ä»»ä½•ä¸€ä¸ªç›®æ ‡æ–‡ä»¶çš„æºæ–‡ä»¶ï¼ˆé™¤äº†piggy.oæºç ï¼‰ï¼Œæˆ‘ä»¬å‡ ä¹éƒ½å¯ä»¥åœ¨Linuxå†…æ ¸æºç é‡Œæ‰¾åˆ°ã€‚</p><p>æ¯”å¦‚è¯´ï¼Œhead_64.oå¯¹åº”æºæ–‡ä»¶head_64.Sã€string.oå¯¹åº”æºæ–‡ä»¶string.cã€misc.oå¯¹åº”æºæ–‡ä»¶misc.cç­‰ã€‚</p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œä¸ºå•¥æ‰¾ä¸åˆ°piggy.oå¯¹åº”çš„æºæ–‡ä»¶ï¼Œæ¯”å¦‚piggy.cã€piggy.Sæˆ–å…¶ä»–æ–‡ä»¶å‘¢ï¼Ÿä½ éœ€è¦åœ¨Makefileæ–‡ä»¶ä»”ç»†è§‚å¯Ÿä¸€ä¸‹ï¼Œæ‰èƒ½å‘ç°æœ‰ä¸ªåˆ›å»ºæ–‡ä»¶piggy.Sçš„è§„åˆ™ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>#linux/arch/x86/boot/compressed/Makefile\n#â€¦â€¦\nquiet_cmd_mkpiggy = MKPIGGY $@      \ncmd_mkpiggy = $(obj)/mkpiggy $&lt; &gt; $@\n\ntargets += piggy.S\n$(obj)/piggy.S: $(obj)/vmlinux.bin.$(suffix-y) $(obj)/mkpiggy FORCE    $(call if_changed,mkpiggy)\n</code></pre><p>çœ‹åˆ°ä¸Šé¢çš„è§„åˆ™ï¼Œæˆ‘ä»¬è±ç„¶å¼€æœ—ï¼ŒåŸæ¥piggy.oæ˜¯ç”±piggy.Sæ±‡ç¼–ä»£ç ç”Ÿæˆè€Œæ¥ï¼Œè€Œpiggy.Sæ˜¯ç¼–è¯‘Linuxå†…æ ¸æ—¶ç”±mkpiggyå·¥ä½œï¼ˆHOST OSä¸‹çš„åº”ç”¨ç¨‹åºï¼‰åŠ¨æ€åˆ›å»ºçš„ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ‰¾ä¸åˆ°å®ƒçš„åŸå› ã€‚</p><p>piggy.Sçš„ç¬¬ä¸€ä¸ªä¾èµ–æ–‡ä»¶vmlinux.bin.$(suffix-y)ä¸­çš„suffix-yï¼Œå®ƒè¡¨ç¤ºå†…æ ¸å‹ç¼©æ–¹å¼å¯¹åº”çš„åç¼€ã€‚</p><pre><code>#linux/arch/x86/boot/compressed/Makefile\n#â€¦â€¦\nvmlinux.bin.all-y := $(obj)/vmlinux.bin\nvmlinux.bin.all-$(CONFIG_X86_NEED_RELOCS) += $(obj)/vmlinux.relocs\n$(obj)/vmlinux.bin.gz: $(vmlinux.bin.all-y) FORCE    \n$(call if_changed,gzip)\n$(obj)/vmlinux.bin.bz2: $(vmlinux.bin.all-y) FORCE    \n$(call if_changed,bzip2)\n$(obj)/vmlinux.bin.lzma: $(vmlinux.bin.all-y) FORCE    \n$(call if_changed,lzma)\n$(obj)/vmlinux.bin.xz: $(vmlinux.bin.all-y) FORCE   \n$(call if_changed,xzkern)\n$(obj)/vmlinux.bin.lzo: $(vmlinux.bin.all-y) FORCE    \n$(call if_changed,lzo)\n$(obj)/vmlinux.bin.lz4: $(vmlinux.bin.all-y) FORCE    \n$(call if_changed,lz4)\n$(obj)/vmlinux.bin.zst: $(vmlinux.bin.all-y) FORCE    \n$(call if_changed,zstd22)\nsuffix-$(CONFIG_KERNEL_GZIP)    := gz\nsuffix-$(CONFIG_KERNEL_BZIP2)   := bz2\nsuffix-$(CONFIG_KERNEL_LZMA)    := lzma\nsuffix-$(CONFIG_KERNEL_XZ)  := xz\nsuffix-$(CONFIG_KERNEL_LZO)     := lzo\nsuffix-$(CONFIG_KERNEL_LZ4)     := lz4\nsuffix-$(CONFIG_KERNEL_ZSTD)    := zst\n</code></pre><p>ç”±å‰é¢å†…å®¹å¯ä»¥å‘ç°ï¼ŒLinuxå†…æ ¸å¯ä»¥è¢«å‹ç¼©æˆå¤šç§æ ¼å¼ã€‚è™½ç„¶ç°åœ¨æˆ‘ä»¬ä¾ç„¶æ²¡æœ‰ææ¸…æ¥švmlinux.binæ–‡ä»¶æ˜¯æ€ä¹ˆæ¥çš„ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œlinux/arch/x86/boot/compressedç›®å½•ä¸‹çš„Makefileæ–‡ä»¶ä¸­ï¼Œæœ‰ä¸‹é¢è¿™æ ·çš„ä»£ç ã€‚</p><pre><code>#linux/arch/x86/boot/compressed/Makefile\n#â€¦â€¦\nOBJCOPYFLAGS_vmlinux.bin :=  -R .comment -S\n$(obj)/vmlinux.bin: vmlinux FORCE \n$(call if_changed,objcopy)\n</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œarch/x86/boot/compressedç›®å½•ä¸‹çš„vmlinux.binï¼Œå®ƒæ˜¯ç”±objcopyå·¥å…·é€šè¿‡vmlinuxç›®æ ‡ç”Ÿæˆã€‚è€Œvmlinuxç›®æ ‡æ²¡æœ‰ä»»ä½•ä¿®é¥°å‰ç¼€å’Œä¾èµ–çš„ç›®æ ‡ï¼Œè¿™è¯´æ˜å®ƒå°±æ˜¯<strong>æœ€é¡¶å±‚ç›®å½•ä¸‹çš„ä¸€ä¸ªvmlinuxæ–‡ä»¶</strong>ã€‚</p><p>æˆ‘ä»¬ç»§ç»­æ·±ç©¶ä¸€æ­¥å°±ä¼šå‘ç°ï¼Œobjcopyå·¥å…·åœ¨å¤„ç†è¿‡ç¨‹ä¸­åªæ˜¯åˆ é™¤äº†vmlinuxæ–‡ä»¶ä¸­â€œ.commentâ€æ®µï¼Œä»¥åŠç¬¦å·è¡¨å’Œé‡å®šä½è¡¨ï¼ˆé€šè¿‡å‚æ•°-SæŒ‡å®šï¼‰ï¼Œè€Œvmlinuxæ–‡ä»¶çš„æ ¼å¼ä¾ç„¶æ˜¯ELFæ ¼å¼çš„ï¼Œå¦‚æœä¸éœ€è¦ä½¿ç”¨ELFæ ¼å¼çš„å†…æ ¸ï¼Œè¿™é‡Œæ·»åŠ â€œ-O binaryâ€é€‰é¡¹å°±å¯ä»¥äº†ã€‚</p><p>æˆ‘ä»¬ç°åœ¨æ¥æ¢³ç†ä¸€ä¸‹ï¼Œvmlinuxæ–‡ä»¶æ˜¯å¦‚ä½•åˆ›å»ºçš„ã€‚</p><p>å…¶å®ï¼Œvmlinuxæ–‡ä»¶å°±æ˜¯ç¼–è¯‘æ•´ä¸ªLinuxå†…æ ¸æºä»£ç æ–‡ä»¶ç”Ÿæˆçš„ï¼ŒLinuxçš„ä»£ç åˆ†å¸ƒåœ¨å„ä¸ªä»£ç ç›®å½•ä¸‹ï¼Œè¿™äº›ç›®å½•ä¹‹ä¸‹åˆå­˜åœ¨ç›®å½•ï¼ŒLinuxçš„kbuildï¼ˆå†…æ ¸ç¼–è¯‘ï¼‰ç³»ç»Ÿï¼Œä¼šé€’å½’è¿›å…¥åˆ°æ¯ä¸ªç›®å½•ï¼Œç”±è¯¥ç›®å½•ä¸‹çš„Makefileå†³å®šè¦ç¼–è¯‘å“ªäº›æ–‡ä»¶ã€‚</p><p>åœ¨ç¼–è¯‘å®Œå…·ä½“æ–‡ä»¶ä¹‹åï¼Œå°±ä¼šåœ¨è¯¥ç›®å½•ä¸‹ï¼ŒæŠŠå·²ç»ç¼–è¯‘äº†çš„æ–‡ä»¶é“¾æ¥æˆä¸€ä¸ªè¯¥ç›®å½•ä¸‹çš„built-in.oæ–‡ä»¶ï¼Œè¿™ä¸ªbuilt-in.oæ–‡ä»¶ä¹Ÿä¼šä¸ä¸Šå±‚ç›®å½•çš„built-in.oæ–‡ä»¶é“¾æ¥åœ¨ä¸€èµ·ã€‚</p><p>å†ç„¶åï¼Œå±‚å±‚ç›®å½•è¿”å›åˆ°é¡¶å±‚ç›®å½•ï¼Œæ‰€æœ‰çš„built-in.oæ–‡ä»¶ä¼šé“¾æ¥ç”Ÿæˆä¸€ä¸ªvmlinuxæ–‡ä»¶ï¼Œè¿™ä¸ªvmlinuxæ–‡ä»¶ä¼šé€šè¿‡å‰é¢çš„æ–¹æ³•è½¬æ¢æˆvmlinux.binæ–‡ä»¶ã€‚ä½†æ˜¯è¯·æ³¨æ„ï¼Œvmlinux.binæ–‡ä»¶å®ƒä¾ç„¶æ˜¯ELFæ ¼å¼çš„æ–‡ä»¶ã€‚</p><p>æœ€åï¼Œå·¥å…·è½¯ä»¶ä¼šå‹ç¼©æˆvmlinux.bin.gzæ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥gzipæ–¹å¼å‹ç¼©ã€‚</p><p>è®©æˆ‘ä»¬å†æ¬¡å›åˆ°mkpiggyå‘½ä»¤ï¼Œå…¶ä¸­mkpiggyæ˜¯å†…æ ¸è‡ªå¸¦çš„ä¸€ä¸ªå·¥å…·ç¨‹åºï¼Œå®ƒæŠŠè¾“å‡ºæ–¹å¼é‡å®šå‘åˆ°æ–‡ä»¶ï¼Œä»è€Œäº§ç”Ÿpiggy.Sæ±‡ç¼–æ–‡ä»¶ï¼Œæºç å¦‚ä¸‹ï¼š</p><pre><code>int main(int argc, char *argv[]){ \n    uint32_t olen;    \n    long ilen;    \n    FILE *f = NULL;    \n    int retval = 1;\n    f = fopen(argv[1], &quot;r&quot;);    \n    if (!f) {        \n        perror(argv[1]);        \n        goto bail;    \n    }\n    //â€¦â€¦ä¸ºèŠ‚çº¦ç¯‡å¹…ç•¥å»éƒ¨åˆ†ä»£ç \n    printf(&quot;.section \\&quot;.rodata..compressed\\&quot;,\\&quot;a\\&quot;,@progbits\\n&quot;);\n    printf(&quot;.globl z_input_len\\n&quot;);    \n    printf(&quot;z_input_len = %lu\\n&quot;, ilen);    \n    printf(&quot;.globl z_output_len\\n&quot;);    \n    printf(&quot;z_output_len = %lu\\n&quot;, (unsigned long)olen);\n    printf(&quot;.globl input_data, input_data_end\\n&quot;);\n    printf(&quot;input_data:\\n&quot;);    \n    printf(&quot;.incbin \\&quot;%s\\&quot;\\n&quot;, argv[1]);    \n    printf(&quot;input_data_end:\\n&quot;);\n    printf(&quot;.section \\&quot;.rodata\\&quot;,\\&quot;a\\&quot;,@progbits\\n&quot;);\n    printf(&quot;.globl input_len\\n&quot;);    \n    printf(&quot;input_len:\\n\\t.long %lu\\n&quot;, ilen);    \n    printf(&quot;.globl output_len\\n&quot;);    \n    printf(&quot;output_len:\\n\\t.long %lu\\n&quot;, (unsigned long)olen);\n    retval = 0;\nbail:    \n    if (f)        \n        fclose(f);    \n    return retval;\n}\n//ç”±ä¸Šmkpiggyç¨‹åºâ€œå†™çš„â€ä¸€ä¸ªæ±‡ç¼–ç¨‹åºpiggy.Sã€‚\n.section &quot;.rodata..compressed&quot;,&quot;a&quot;,@progbits \n.globl z_input_len\n z_input_len = 1921557 \n.globl z_output_len \nz_output_len = 3421472 \n.globl input_data,input_data_end\n.incbin &quot;arch/x86/boot/compressed/vmlinux.bin.gz&quot; \ninput_data_end:\n.section &quot;.rodata&quot;,&quot;a&quot;,@progbits\n.globl input_len\ninput_len:4421472\n.globl output_len\noutput_len:4424772\n</code></pre><p>æ ¹æ®ä¸Šè¿°ä»£ç ä¸éš¾å‘ç°ï¼Œè¿™ä¸ªpiggy.Séå¸¸ç®€å•ï¼Œä½¿ç”¨æ±‡ç¼–æŒ‡ä»¤incbinå°†å‹ç¼©çš„vmlinux.bin.gzæ¯«æ— ä¿®æ”¹åœ°åŒ…å«è¿›æ¥ã€‚</p><p>é™¤äº†åŒ…å«äº†å‹ç¼©çš„vmlinux.bin.gzå†…æ ¸æ˜ åƒæ–‡ä»¶å¤–ï¼Œpiggy.Sä¸­è¿˜å®šä¹‰äº†è§£å‹vmlinux.bin.gzæ—¶éœ€è¦çš„å„ç§ä¿¡æ¯ï¼ŒåŒ…æ‹¬å‹ç¼©å†…æ ¸æ˜ åƒçš„é•¿åº¦ã€è§£å‹åçš„é•¿åº¦ç­‰ä¿¡æ¯ã€‚</p><p><strong>è¿™äº›ä¿¡æ¯å’Œvmlinux.bin.gzæ–‡ä»¶ï¼Œå®ƒä»¬ä¸€èµ·ç”Ÿæˆäº†piggy.oæ–‡ä»¶ï¼Œç„¶åpiggy.oæ–‡ä»¶å’Œ<span dollar=\"\">$</span>(vmlinux-objs-y)<span dollar=\"\">$</span>(efi-obj-y)ä¸­çš„ç›®æ ‡æ–‡ä»¶ä¸€èµ·é“¾æ¥ç”Ÿæˆï¼Œæœ€ç»ˆç”Ÿæˆäº†linux/arch/x86/boot/compressedç›®å½•ä¸‹çš„vmlinuxã€‚</strong></p><p>è¯´åˆ°è¿™é‡Œï¼Œä½ æ˜¯ä¸æ˜¯æ„Ÿè§‰ï¼Œè¿™å’ŒLinuxçš„å¯åŠ¨æµç¨‹æ— å…³å‘¢ï¼Ÿæœ‰è¿™ç§æƒ³æ³•å°±å¤§é”™ç‰¹é”™äº†ï¼Œè¦æƒ³ææ˜ç™½Linuxçš„å¯åŠ¨æµç¨‹ï¼Œé¦–å…ˆå¾—ææ‡‚å®ƒvmlinuzçš„æ–‡ä»¶ç»“æ„ã€‚æœ‰äº†è¿™äº›åŸºç¡€ï¼Œæ‰èƒ½çŸ¥å…¶ç„¶åŒæ—¶çŸ¥å…¶æ‰€ä»¥ç„¶ã€‚</p><h2>é‡ç‚¹å›é¡¾</h2><p>åˆåˆ°äº†è¯¾ç¨‹å°¾å£°ï¼Œè¿™èŠ‚è¯¾çš„å­¦ä¹ æˆ‘ä»¬å°±å‘Šä¸€æ®µè½äº†ï¼Œæˆ‘æ¥ç»™ä½ åšä¸ªæ€»ç»“ã€‚</p><p>ä»Šå¤©æˆ‘ä»¬é¦–å…ˆä»å…¨å±€æ¢³ç†äº†ä¸€éx86å¹³å°çš„å¯åŠ¨æµç¨‹ï¼ŒæŒæ¡äº†BIOSåŠ è½½GRUBçš„è¿‡ç¨‹ï¼Œåˆä¸€èµ·å­¦ä¹ äº†BIOSæ˜¯å¦‚ä½•å¯åŠ¨çš„ï¼Œå®ƒåˆæ˜¯å¦‚ä½•åŠ è½½å¼•å¯¼è®¾å¤‡çš„ã€‚</p><p>æ¥ç€æˆ‘ä»¬ç ”ç©¶äº†GRUBçš„å¯åŠ¨æµç¨‹ï¼ŒBIOSåŠ è½½äº†GRUBçš„ç¬¬ä¸€ä¸ªéƒ¨åˆ†ï¼Œè¿™ä¸€éƒ¨åˆ†åŠ è½½äº†GRUBçš„å…¶ä½™éƒ¨åˆ†ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬è¯¦ç»†äº†è§£äº†Linuxå†…æ ¸çš„å¯åŠ¨æ–‡ä»¶vmlinuzçš„ç»“æ„ï¼Œææ¸…æ¥šäº†å®ƒçš„ç”Ÿæˆè¿‡ç¨‹ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>è¯·é—®ï¼Œä¸ºä»€ä¹ˆè¦ç”¨Cä»£ç mkpiggyç¨‹åºç”Ÿæˆpiggy.Sæ–‡ä»¶ï¼Œå¹¶åŒ…å«vmlinux.bin.gzæ–‡ä»¶å‘¢ï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºè®°å½•ä½ çš„æ”¶è·å’Œç–‘é—®ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™æœ‰éœ€è¦çš„æœ‹å‹ï¼Œè·Ÿä»–ä¸€èµ·å­¦ä¹ è¿›æ­¥ã€‚</p><p>å¥½ï¼Œæˆ‘æ˜¯LMOSï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ï¼</p>","neighbors":{"left":{"article_title":"13 | ç¬¬ä¸€ä¸ªCå‡½æ•°ï¼šå¦‚ä½•å®ç°æ¿çº§åˆå§‹åŒ–ï¼Ÿ","id":381810},"right":{"article_title":"15 | Linuxåˆå§‹åŒ–ï¼ˆä¸‹ï¼‰ï¼šä»_startåˆ°ç¬¬ä¸€ä¸ªè¿›ç¨‹","id":383611}},"comments":[{"had_liked":false,"id":297160,"user_name":"neohope","can_delete":false,"product_type":"c1","uid":1043475,"ip_address":"","ucode":"C0268F6E7E2B6E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ec/13/49e98289.jpg","comment_is_top":false,"comment_ctime":1623333546,"is_pvip":false,"replies":[{"id":"108082","content":"6666","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1623726574,"ip_address":"","comment_id":297160,"utype":1}],"discussion_count":7,"race_medal":0,"score":"173422025386","product_id":100078401,"comment_content":"å¤§ä½“ä¸Šæ•´ç†äº†ä¸€ä¸‹ï¼Œæœ‰é—®é¢˜æ¬¢è¿å¸®å¿™æŒ‡å‡ºã€ä¸Šã€‘ï¼š<br><br>æ“ä½œç³»ç»Ÿçš„å¯åŠ¨åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šå¼•å¯¼bootå’Œå¯åŠ¨startupï¼Œæœ¬èŠ‚ä¸»è¦è¿˜æ˜¯bootè¿‡ç¨‹ï¼š<br>BIOS-&gt;GRUG1-&gt;GRUB1.5-&gt;GRUB2-&gt;Linuxå†…æ ¸ã€ç¯å¢ƒç¡¬ç›˜å¼•å¯¼ã€MBRåˆ†åŒºã€‘<br><br>1ã€æŒ‰ç”µæºé”®ï¼Œç³»ç»ŸåŠ ç”µ<br><br>2ã€ä¸»æ¿é€šç”µ<br>CPUåŠ ç”µæ—¶ï¼Œä¼šé»˜è®¤è®¾ç½®[CS:IP]ä¸º[0XF000:0XFFF0]ï¼Œæ ¹æ®å®æ¨¡å¼ä¸‹å¯»å€è§„åˆ™ï¼ŒCPUæŒ‡å‘0XFFFF0<br>è¿™ä¸ªåœ°å€æ­£æ˜¯BIOSå¯åŠ¨ç¨‹åºä½ç½®ï¼Œè€ŒBIOSè®¿é—®æ–¹å¼ä¸å†…å­˜ä¸€è‡´ï¼Œæ‰€ä»¥CPUå¯ä»¥ç›´æ¥è¯»å–å‘½ä»¤å¹¶æ‰§è¡Œ<br><br>3ã€BIOSæ‰§è¡Œ<br>3.1ã€BIOSé¦–å…ˆæ‰§è¡ŒPOSTè‡ªæ£€ï¼ŒåŒ…æ‹¬ä¸»æ¿ã€å†…å­˜ã€å¤–è®¾ç­‰ï¼Œé‡åˆ°é—®é¢˜åˆ™æŠ¥è­¦å¹¶åœæ­¢å¼•å¯¼<br><br>3.2ã€BIOSå¯¹è®¾å¤‡æ‰§è¡Œç®€å•çš„åˆå§‹åŒ–å·¥ä½œ<br><br>3.3ã€BIOS ä¼šåœ¨å†…å­˜ä¸­ï¼š<br>å»ºç«‹ä¸­æ–­è¡¨ï¼ˆ0x00000~0x003FFï¼‰<br>æ„å»º BIOS æ•°æ®åŒºï¼ˆ0x00400~0x004FFï¼‰<br>åŠ è½½äº†ä¸­æ–­æœåŠ¡ç¨‹åºï¼ˆ0x0e05b~0x1005Aï¼‰<br><br>3.4ã€BIOSæ ¹æ®è®¾å¤‡å¯åŠ¨é¡ºåºï¼Œä¾æ¬¡åˆ¤æ–­æ˜¯å¦å¯ä»¥å¯åŠ¨<br>æ¯”å¦‚å…ˆæ£€æŸ¥å…‰é©±èƒ½å¦å¯åŠ¨<br>ç„¶åä¾æ¬¡æ£€æŸ¥ç¡¬ç›˜æ˜¯å¦å¯ä»¥å¯åŠ¨ã€ç¡¬ç›˜åˆ†åŒºçš„æ—¶å€™ï¼Œè®¾ç½®ä¸ºæ´»åŠ¨åˆ†åŒºã€‘<br><br>4ã€ç¡¬ç›˜å¼•å¯¼<br>4.1ã€å…ˆè¯´ä¸‹å¯»å€æ–¹å¼ï¼Œä¸æ‰‡åŒºç¼–å·çš„äº‹æƒ…<br>æœ€ä¼ ç»Ÿçš„ç£ç›˜å¯»å€æ–¹å¼ä¸ºCHSï¼Œç”±ä¸‰ä¸ªå‚æ•°å†³å®šè¯»å–å“ªä¸ªæ‰‡åŒºï¼šç£å¤´ï¼ˆHeadsï¼‰ã€æŸ±é¢(Cylinder)ã€æ‰‡åŒº(Sector)<br>ç£å¤´æ•°ã€8ä½ã€‘ï¼Œä»0å¼€å§‹ï¼Œæœ€å¤§255ã€å¾®è½¯DOSç³»ç»Ÿï¼Œåªèƒ½ç”¨255ä¸ªã€‘ï¼Œå†³å®šäº†è¯»å–å“ªä¸ªç›˜ç‰‡çš„å“ªä¸ªé¢ã€ä¸€ç›˜ä¸¤é¢ã€‘<br>æŸ±é¢æ•°ã€10ä½ã€‘ï¼Œä»0å¼€å§‹ï¼Œæœ€å¤§1023ã€å†³å®šäº†è¯»å–å“ªä¸ªç£é“ï¼Œç£é“æ— è®ºé•¿çŸ­éƒ½ä¼šåˆ’åˆ†ä¸ºç›¸åŒæ‰‡åŒºæ•°ã€‘<br>æ‰‡åŒºæ•°ã€6ä½ã€‘ï¼Œä»1å¼€å§‹ï¼Œæœ€å¤§æ•° 63ã€CHSä¸­æ‰‡åŒºä»1å¼€å§‹ï¼Œè€Œé€»è¾‘åˆ’åˆ†ä¸­æ‰‡åŒºä»0å¼€å§‹ï¼Œç»å¸¸ä¼šé€ æˆå¾ˆå¤šè¯¯è§£ã€‘<br>æ¯ä¸ªæ‰‡åŒºä¸º512å­—èŠ‚<br><br>4.2ã€ç„¶åè¯´ä¸‹å¼•å¯¼æ–¹å¼<br>BIOSåœ¨å‘ç°ç¡¬ç›˜å¯åŠ¨æ ‡å¿—åï¼ŒBIOSä¼šå¼•å‘INT 19Hä¸­æ–­<br>è¿™ä¸ªæ“ä½œï¼Œä¼šå°†MBRã€é€»è¾‘0æ‰‡åŒºã€‘ï¼Œä¹Ÿå°±æ˜¯ç£ç›˜CHSã€ç£å¤´0ï¼ŒæŸ±é¢0ï¼Œæ‰‡åŒº1ã€‘ï¼Œè¯»å–åˆ°å†…å­˜[0:7C00h]ï¼Œç„¶åæ‰§è¡Œå…¶ä»£ç ã€GRUB1é˜¶æ®µã€‘ï¼Œè‡³æ­¤BIOSæŠŠä¸»åŠ¨æƒäº¤ç»™äº†GRUB1é˜¶æ®µä»£ç <br>MBRæ‰‡åŒºä¸º512å­—èŠ‚ï¼Œæ‰‡åŒºæœ€ååˆ†åŒºè¡¨è‡³å°‘éœ€è¦66å­—èŠ‚ã€64å­—èŠ‚DPT+2å­—èŠ‚å¼•å¯¼æ ‡å¿—ã€‘ï¼Œæ‰€ä»¥è¿™æ®µä»£ç æœ€å¤šåªèƒ½æœ‰446å­—èŠ‚ï¼Œgrubä¸­å¯¹åº”çš„å°±æ˜¯å¼•å¯¼é•œåƒboot.img<br>boot.imgçš„ä»»åŠ¡å°±æ˜¯ï¼Œå®šä½ï¼Œå¹¶é€šè¿‡BIOS INT13ä¸­æ–­è¯»å–1.5é˜¶æ®µä»£ç ï¼Œå¹¶è¿è¡Œ<br><br>5ã€Grub1.5é˜¶æ®µ<br>5.1ã€å…ˆè¯´ä¸€ä¸‹MBR GAP<br>æ®è¯´å¾®è½¯DOSç³»ç»ŸåŸå› ï¼Œç¬¬ä¸€ä¸ªåˆ†åŒºçš„èµ·å§‹é€»è¾‘æ‰‡åŒºæ˜¯63æ‰‡åŒºï¼Œåœ¨MBRã€0æ‰‡åŒºã€‘å’Œåˆ†å¸ƒè¡¨ä¹‹é—´ã€63æ‰‡åŒºã€‘ï¼Œå­˜åœ¨62ä¸ªç©ºç™½æ‰‡åŒºï¼Œå…± 31KBã€‚<br>Grub1.5é˜¶æ®µä»£ç å°±å®‰è£…åœ¨è¿™é‡Œã€‚<br><br>5.2ã€ä¸Šé¢æåˆ°ï¼Œboot.imgä¸»è¦åŠŸèƒ½å°±æ˜¯æ‰¾åˆ°å¹¶åŠ è½½Grub1.5é˜¶æ®µä»£ç ï¼Œå¹¶åˆ‡æ¢æ‰§è¡Œã€‚<br>Grub1.5é˜¶æ®µä»£ç æ˜¯core.imgï¼Œå…¶ä¸»è¦åŠŸèƒ½å°±æ˜¯åŠ è½½æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨ï¼ŒæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼Œ ä½åŠ è½½å¹¶è¿è¡ŒGRUB2é˜¶æ®µä»£ç ã€‚<br>core.imgåŒ…æ‹¬å¤šä¸ªæ˜ åƒå’Œæ¨¡å—ï¼š<br>diskboot.imgã€1.5é˜¶æ®µå¼•å¯¼ç¨‹åºã€‘ï¼Œå­˜åœ¨äºMBR GAPç¬¬ä¸€ä¸ªæ‰‡åŒºï¼›ã€è¿™é‡Œæ˜¯ç¡¬ç›˜å¯åŠ¨çš„æƒ…å†µï¼Œå¦‚æœæ˜¯cdå¯åŠ¨å°±ä¼šæ˜¯cdboot.imgã€‘<br>lzma_decompress.imgã€è§£å‹ç¨‹åºã€‘<br>kernel.imgã€grubæ ¸å¿ƒä»£ç ã€‘ï¼Œä¼šã€å‹ç¼©å­˜æ”¾ã€‘<br>biosdisk.modã€ç£ç›˜é©±åŠ¨ã€‘ã€Part_msdos.modã€MBRåˆ†åŒºæ”¯æŒã€‘ã€Ext2.modã€EXTæ–‡ä»¶ç³»ç»Ÿã€‘ç­‰ï¼Œä¼šã€å‹ç¼©å­˜æ”¾ã€‘<br><br>å…¶å®boot.imgåªåŠ è½½äº†core.imgçš„ç¬¬ä¸€ä¸ªæ‰‡åŒºã€å­˜æ”¾diskboot.imgã€‘ï¼Œç„¶åæ§åˆ¶æƒå°±äº¤å‡ºå»äº†ï¼Œgrubé˜¶æ®µ1ä»£ç ä½¿å‘½ç»“æŸã€‚<br>diskboot.imgçŸ¥é“åç»­æ¯ä¸ªæ–‡ä»¶çš„ä½ç½®ï¼Œä¼šç»§ç»­é€šè¿‡BIOSä¸­æ–­è¯»å–æ‰‡åŒºï¼ŒåŠ è½½ä½™ä¸‹çš„éƒ¨åˆ†å¹¶è½¬äº¤æ§åˆ¶æƒï¼ŒåŒ…æ‹¬ï¼š<br>åŠ è½½lzma_decompress.imgï¼Œä»è€Œå¯ä»¥è§£å‹è¢«å‹ç¼©çš„æ¨¡å—<br>åŠ è½½kernel.imgï¼Œå¹¶è½¬äº¤æ§åˆ¶æƒç»™kernel.img<br>kernel.imgçš„grub_mainå‡½æ•°ä¼šè°ƒç”¨grub_load_moduleså‡½æ•°åŠ è½½å„ä¸ªmodæ¨¡å—<br>åŠ è½½å„ä¸ªmodåï¼Œgrubå°±æ”¯æŒæ–‡ä»¶ç³»ç»Ÿäº†ï¼Œè®¿é—®ç£ç›˜ä¸éœ€è¦å†ä¾é BIOSçš„ä¸­æ–­ä»¥æ‰‡åŒºä¸ºå•ä½è¯»å–äº†ï¼Œç»ˆäºå¯ä»¥ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿäº†","like_count":41,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521740,"discussion_content":"6666","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623726574,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1043475,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/ec/13/49e98289.jpg","nickname":"neohope","note":"","ucode":"C0268F6E7E2B6E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378775,"discussion_content":"bootè¿‡ç¨‹ï¼šUEFI->GRUB->Linuxå†…æ ¸ã€ç¡¬ç›˜å¼•å¯¼ã€UEFIã€‘\n\n1ã€æŒ‰ç”µæºé”®ï¼Œç³»ç»ŸåŠ ç”µ\n\n2ã€ä¸»æ¿é€šç”µ\n\n3ã€UEFIå¼€å§‹æ‰§è¡Œã€UEFIåŠŸèƒ½æ¯”BIOSå¼ºå¤§å¾ˆå¤šï¼Œæ”¯æŒå‘½ä»¤è¡Œï¼Œæœ‰ç®€å•å›¾å½¢ç•Œé¢ï¼Œä¹Ÿæ”¯æŒæ–‡ä»¶ç³»ç»Ÿã€‘\n3.1ã€UEFIä¼šæ£€æµ‹ç¡¬ä»¶ï¼Œå¹¶å¯¹è®¾å¤‡æ‰§è¡Œç®€å•çš„åˆå§‹åŒ–å·¥ä½œ\n3.2ã€UEFIä¼šåˆ¤æ–­å¯åŠ¨æ¨¡å¼ï¼Œæ˜¯UEFIè¿˜æ˜¯Legacyã€Legacyæ¨¡å¼ä¸‹ï¼ŒUEFIé€šè¿‡CSMæ¨¡å—æ”¯æŒMBRæ–¹å¼å¯åŠ¨ã€‘\n3.3ã€å¦‚æœæ˜¯UEFIæ¨¡å¼å¯åŠ¨ï¼ŒUEFIä¼šè¯»å–ç¡¬ç›˜åˆ†åŒºè¡¨ï¼ŒæŸ¥æ‰¾å¹¶æŒ‚è½½ESPåˆ†åŒºã€ EFI System Partitionï¼ŒVFATæ ¼å¼ã€‘\nGPTåˆ†åŒºä¸‹æœ‰ç‰¹æ®ŠGUIDï¼š  C12A7328-F81F-11D2-BA4B-00A0C93EC93Bï¼›\nMBRåˆ†åŒºä¸‹æœ‰ æ ‡è¯†ä¸º 0xEF\n3.4ã€å„æ“ä½œç³»ç»Ÿå¼•çš„å¯¼ç¨‹åºæŒ‰è§„åˆ™å­˜æ”¾åˆ°/boot/efiç›®å½•ä¸‹ã€å¯ä»¥æ“ä½œæ–‡ä»¶è€Œä¸éœ€æ“ä½œæ‰‡åŒºï¼Œæ–‡ä»¶å¤§å°é™åˆ¶ä¹Ÿå®½æ¾äº†å¾ˆå¤šã€‘\næ¯”å¦‚Ubuntuï¼Œ/boot/efi/ubuntu/grubx64.efi\nã€å¯ä»¥å…ˆå¼•å¯¼grubï¼Œç„¶åå¼•å¯¼Linuxã€‘\nã€ä¹Ÿå¯ä»¥ç›´æ¥å¯åŠ¨ç³»ç»Ÿå†…æ ¸ï¼ŒåŒ…æ‹¬Windowså’ŒLinuxï¼Œä½†ä»–ä»¬ä¹Ÿéƒ½éœ€è¦ä¸€ä¸ªefiæ–‡ä»¶ç”¨äºå¼•å¯¼ç³»ç»Ÿã€‘\n\n4ã€åç»­å¼•å¯¼ï¼Œå’Œä¹‹å‰å°±æ¯”è¾ƒç›¸ä¼¼äº†\nå¦‚æœç”¨grubï¼ŒEFI boot managerä¼šåŠ è½½/EFI/ubuntu/boot/grubx64.efiï¼Œç§»äº¤æ§åˆ¶æƒï¼Œä¼šè¿›å…¥åˆ°grub2é˜¶æ®µã€grub.cfgä¹Ÿåœ¨è¿™ä¸ªç›®å½•ä¸‹ã€‘\nå¦‚æœç”¨ubuntuï¼ŒEFI boot managerä¼šåŠ è½½/EFI/ubuntu/boot/ubuntu.efiï¼Œç§»äº¤æ§åˆ¶æƒï¼Œå¯ä»¥ç›´æ¥å¯åŠ¨linuxå†…æ ¸ã€ç¼–è¯‘æ—¶æ‰“å¼€EFI Boot Stubã€‘\nå¦‚æœç”¨windowsï¼ŒEFI boot managerä¼šåŠ è½½/EFI/Mirosoft/Boot/bootmgr.efi\nå¦‚æœé‡‡ç”¨é»˜è®¤å¯åŠ¨ï¼Œä¼šä½¿ç”¨/EFI/Boot/bootx64.efi","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1623398158,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1674369,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqf54z1ZmqQY1kmJ6t1HAnrqMM3j6WKf0oDeVLhtnA2ZUKY6AX9MK6RjvcO8SiczXy3uU0IzBQ3tpw/132","nickname":"Geek_68d3d2","note":"","ucode":"EBD6D881AA7A74","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":586561,"discussion_content":"è¯·é—®lzma_decompress.imgå’Œkernel.imgè¿™äº›æ–‡ä»¶æ˜¯å†™åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ç»™æ–‡ä»¶ç³»ç»Ÿç®¡ç†äº†èµ·æ¥è¿˜æ˜¯æ”¾åœ¨å…¶ä»–åœ°æ–¹å•Š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662343591,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2859088,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/a0/50/390187f3.jpg","nickname":"ç½—å‡","note":"","ucode":"AA8F5D6B13D3E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":547210,"discussion_content":"é¡¶ç¤¼è†œæ‹œå¤§ç¥ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642581273,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2677530,"avatar":"https://static001.geekbang.org/account/avatar/00/28/db/1a/52d1501f.jpg","nickname":"rain","note":"","ucode":"A2E81AB7C4274C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383983,"discussion_content":"neohopeå¤§æ€»ç»“çš„å¤ªå¥½äº†ï¼Œç‚¹èµğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626328905,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1446375,"avatar":"https://static001.geekbang.org/account/avatar/00/16/11/e7/044a9a6c.jpg","nickname":"bookå°¾æ±","note":"","ucode":"AE2B8DFC643ACC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":379205,"discussion_content":"ä½ å¥½ï¼Œæœ€åé‚£ä¸ªgrub_load_moduleåŠ è½½å„ä¸ªæ¨¡å—æ˜¯åŠ è½½çš„core.imgé‡Œé¢çš„å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623753314,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2064750,"avatar":"","nickname":"springXu","note":"","ucode":"F5DB0B963C894F","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378697,"discussion_content":"æœ‰uefiçš„grubçš„æµç¨‹è¯´æ˜ä¹ˆï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623343479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":297161,"user_name":"neohope","can_delete":false,"product_type":"c1","uid":1043475,"ip_address":"","ucode":"C0268F6E7E2B6E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ec/13/49e98289.jpg","comment_is_top":false,"comment_ctime":1623333564,"is_pvip":false,"replies":[{"id":"108080","content":"å¤§ä½¬ å¾ˆå¼º","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1623725491,"ip_address":"","comment_id":297161,"utype":1}],"discussion_count":1,"race_medal":0,"score":"100407581372","product_id":100078401,"comment_content":"å¤§ä½“ä¸Šæ•´ç†äº†ä¸€ä¸‹ï¼Œæœ‰é—®é¢˜æ¬¢è¿å¸®å¿™æŒ‡å‡ºã€ä¸‹ã€‘ï¼š<br>6ã€GRUB2é˜¶æ®µ<br>ç°åœ¨grubå°±èƒ½è®¿é—®boot&#47;grubåŠå…¶å­ç›®å½•äº†<br>kernel.imgæ¥ç€è°ƒç”¨grub_load_normal_modeåŠ è½½normalæ¨¡å—<br>normalæ¨¡å—è¯»å–è§£ææ–‡ä»¶grub.cfgï¼ŒæŸ¥çœ‹æœ‰å“ªäº›å‘½ä»¤ï¼Œæ¯”å¦‚å‘ç°äº†linuxã€initrdè¿™å‡ ä¸ªå‘½ä»¤ï¼Œéœ€è¦linuxæ¨¡å—<br>normalæ¨¡å—ä¼šæ ¹æ®command.lstï¼Œå®šä½å¹¶åŠ è½½ç”¨åˆ°çš„linuxæ¨¡å—ã€ä¸€èˆ¬åœ¨&#47;boot&#47;grub2&#47;i386-pcç›®å½•ã€‘<br>å½“ç„¶ï¼ŒåŒæ—¶éœ€è¦å®Œæˆåˆå§‹åŒ–æ˜¾ç¤ºã€è½½å…¥å­—ä½“ç­‰å·¥ä½œ<br>æ¥ä¸‹æ¥Grubå°±ä¼šç»™å’±ä»¬å±•ç¤ºå¯åŠ¨èœå•äº†<br><br>7ã€é€‰æ‹©å¯åŠ¨èœå•<br>7.1ã€å¼•å¯¼åè®®<br>å¼•å¯¼ç¨‹åºåŠ è½½å†…æ ¸ï¼Œå‰ææ˜¯ç¡®å®šå¥½æ•°æ®äº¤æ¢æ–¹å¼ï¼Œå«åšå¼•å¯¼åè®®ï¼Œå†…æ ¸ä¸­å¼•å¯¼åè®®ç›¸å…³éƒ¨åˆ†çš„ä»£ç åœ¨arch&#47;x86&#47;boot&#47;header.Sä¸­ï¼Œå†…æ ¸ä¼šåœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æ ‡æ˜è‡ªå·±çš„å¯¹é½è¦æ±‚ã€æ˜¯å¦å¯ä»¥é‡å®šä½ä»¥åŠå¸Œæœ›çš„åŠ è½½åœ°å€ç­‰ä¿¡æ¯ã€‚åŒæ—¶ä¹Ÿä¼šé¢„ç•™ç©ºä½ï¼Œç”±å¼•å¯¼åŠ è½½ç¨‹åºåœ¨åŠ è½½å†…æ ¸æ—¶å¡«å……ï¼Œæ¯”å¦‚initramfsçš„åŠ è½½ä½ç½®å’Œå¤§å°ç­‰ä¿¡æ¯ã€‚<br>å¼•å¯¼åŠ è½½ç¨‹åºå’Œå†…æ ¸å‡ä¸ºæ­¤å®šä¹‰äº†ä¸€ä¸ªç»“æ„ä½“linux_kernel_paramsï¼Œç§°ä¸ºå¼•å¯¼å‚æ•°ï¼Œç”¨äºå‚æ•°è®¾å®šã€‚Grubä¼šåœ¨æŠŠæ§åˆ¶æƒç§»äº¤ç»™å†…æ ¸ä¹‹å‰ï¼Œå¡«å……å¥½linux_kernel_paramsç»“æ„ä½“ã€‚å¦‚æœç”¨æˆ·è¦é€šè¿‡grubå‘å†…æ ¸ä¼ é€’å¯åŠ¨å‚æ•°ï¼Œå³grub.cfgä¸­linuxåé¢çš„å‘½ä»¤è¡Œå‚æ•°ã€‚Grubä¹Ÿä¼šæŠŠè¿™éƒ¨åˆ†ä¿¡æ¯å…³è”åˆ°å¼•å¯¼å‚æ•°ç»“æ„ä½“ä¸­ã€‚<br><br>7.2ã€å¼€å§‹å¼•å¯¼<br>Linuxå†…æ ¸çš„ç›¸å…³æ–‡ä»¶ä½äº&#47;boot ç›®å½•ä¸‹ï¼Œæ–‡ä»¶åå‡å¸¦æœ‰å‰ç¼€ vmlinuzã€‚<br>å’±ä»¬é€‰æ‹©å¯¹åº”çš„èœå•åï¼ŒGrubä¼šå¼€å§‹æ‰§è¡Œå¯¹åº”å‘½ä»¤ï¼Œå®šä½ã€åŠ è½½ã€åˆå§‹åŒ–å†…æ ¸ï¼Œå¹¶ç§»äº¤åˆ°å†…æ ¸ç»§ç»­æ‰§è¡Œã€‚<br>è°ƒç”¨linuxæ¨¡å—ä¸­çš„linuxå‘½ä»¤ï¼ŒåŠ è½½linuxå†…æ ¸<br>è°ƒç”¨linuxæ¨¡å—ä¸­çš„initrdå‘½ä»¤ï¼Œå¡«å……initramfsä¿¡æ¯ï¼Œç„¶åGrubä¼šæŠŠæ§åˆ¶æƒç§»äº¤ç»™å†…æ ¸ã€‚<br>å†…æ ¸æ­¤æ—¶å¼€å§‹æ‰§è¡Œï¼ŒåŒæ—¶ä¹Ÿå°±å¯ä»¥è¯»å–linux_kernel_paramsç»“æ„ä½“çš„æ•°æ®äº†<br>booté˜¶æ®µç»“æŸï¼Œå¼€å§‹è¿›å…¥startupé˜¶æ®µã€‚","like_count":24,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521741,"discussion_content":"å¤§ä½¬ å¾ˆå¼º","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623725491,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":320775,"user_name":"178","can_delete":false,"product_type":"c1","uid":1090075,"ip_address":"","ucode":"3B0266F6BD06AE","user_header":"https://static001.geekbang.org/account/avatar/00/10/a2/1b/7426e629.jpg","comment_is_top":false,"comment_ctime":1636509422,"is_pvip":false,"replies":[{"id":"116446","content":"å¯¹çš„ ","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1636597760,"ip_address":"","comment_id":320775,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18816378606","product_id":100078401,"comment_content":"vmlinuzæ˜¯å¯å¼•å¯¼çš„ã€å‹ç¼©çš„å†…æ ¸ã€‚â€œvmâ€ä»£è¡¨ â€œVirtual Memoryâ€ï¼Œlinuä»£è¡¨â€œLinuxâ€ï¼Œzä»£è¡¨å‹ç¼©ã€‚æ˜¯ä¸ªæœ‰æ•…äº‹çš„ç¼©å†™","like_count":5,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530108,"discussion_content":"å¯¹çš„ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636597760,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":297060,"user_name":"å­¤æ˜Ÿå¯","can_delete":false,"product_type":"c1","uid":1057440,"ip_address":"","ucode":"1DE673A8E2253B","user_header":"https://static001.geekbang.org/account/avatar/00/10/22/a0/0e8d56df.jpg","comment_is_top":false,"comment_ctime":1623295879,"is_pvip":false,"replies":[{"id":"108085","content":"6666","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1623726679,"ip_address":"","comment_id":297060,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14508197767","product_id":100078401,"comment_content":"å°è¯•å®ç°äº† lmoskrlimg çš„é€»è¾‘ï¼ˆå³ Cosmos.eki çš„ç”Ÿæˆï¼‰ï¼Œæœ‰å…´è¶£å¯ä»¥çœ‹çœ‹ã€‚<br><br>https:&#47;&#47;github.com&#47;guxingke&#47;demo&#47;blob&#47;master&#47;bytes-demo&#47;src&#47;main&#47;java&#47;com&#47;gxk&#47;demo&#47;Main.java","like_count":4,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521702,"discussion_content":"6666","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623726679,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296890,"user_name":"Fan","can_delete":false,"product_type":"c1","uid":1115232,"ip_address":"","ucode":"3BF28670FD9407","user_header":"https://static001.geekbang.org/account/avatar/00/11/04/60/64d166b6.jpg","comment_is_top":false,"comment_ctime":1623214725,"is_pvip":false,"replies":[{"id":"107854","content":"è¿™å°±æ˜¯å¼€æºä½œè€…çš„å–œå¥½äº† ","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1623245083,"ip_address":"","comment_id":296890,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14508116613","product_id":100078401,"comment_content":"è¯·é—®ï¼Œä¸ºä»€ä¹ˆè¦ç”¨ C ä»£ç  mkpiggy ç¨‹åºç”Ÿæˆ piggy.S æ–‡ä»¶ï¼Œå¹¶åŒ…å« vmlinux.bin.gz æ–‡ä»¶å‘¢ï¼Ÿ<br><br>çœ‹äº†è¿™ä¸‹ç”Ÿæˆçš„è¿™ä¸ªpiggy.S æ–‡ä»¶<br>ä¸»è¦çš„å°±æ˜¯è¿™è¡Œä»£ç <br>.incbin &quot;arch&#47;x86&#47;boot&#47;compressed&#47;vmlinux.bin.gz&quot;<br>é€šè¿‡C ä»£ç çš„å½¢å¼ï¼Œå¯ä»¥ä¼ å…¥ä¸åŒçš„å‚æ•°æ¥è®¾ç½®ä¸åŒçš„å‹ç¼©åŒ…vmlinux.bin.xx  æ¥ç”Ÿæˆpiggy.S ã€‚<br>","like_count":3,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521629,"discussion_content":"è¿™å°±æ˜¯å¼€æºä½œè€…çš„å–œå¥½äº† ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623245083,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296857,"user_name":"pedro","can_delete":false,"product_type":"c1","uid":1200704,"ip_address":"","ucode":"F40C839DDFD599","user_header":"https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg","comment_is_top":false,"comment_ctime":1623204657,"is_pvip":false,"replies":[{"id":"107855","content":"æ˜¯çš„ å¯¹å¤´","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1623245093,"ip_address":"","comment_id":296857,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10213139249","product_id":100078401,"comment_content":"å·¥å…·ç”Ÿæˆæ–¹å¼çµæ´»ï¼Œæ”¯æŒå¤šç§é…ç½®ï¼Œä¸”èƒ½æ»¡è¶³å„ç§åœºæ™¯ä¸‹çš„éœ€æ±‚~","like_count":2,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521615,"discussion_content":"æ˜¯çš„ å¯¹å¤´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623245093,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296826,"user_name":"springXu","can_delete":false,"product_type":"c1","uid":2064750,"ip_address":"","ucode":"F5DB0B963C894F","user_header":"","comment_is_top":false,"comment_ctime":1623170936,"is_pvip":true,"replies":[{"id":"107858","content":"æˆ‘è¯¾ç¨‹ä¸­æœ‰ç”Ÿæˆekiæ–‡ä»¶çš„æ–¹å¼","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1623245213,"ip_address":"","comment_id":296826,"utype":1}],"discussion_count":4,"race_medal":0,"score":"10213105528","product_id":100078401,"comment_content":"ç¨‹åºæ¥ç”Ÿæˆæ±‡ç¼–ä»£ç ï¼Œè¿™ä¸ªæ˜¯æœ‰å¤šç§é…ç½®è®©ä½¿ç”¨è€…æ ¹æ®è‡ªå·±çš„éœ€æ±‚æ¥ç”Ÿæˆã€‚æ¯”å¦‚vmlinuz.binå‹ç¼©çš„æ–¹å¼çš„ä¸åŒåˆæˆ–è€…æ˜¯cpuçš„æŒ‡ä»¤ä¸åŒã€‚  äº§ç”Ÿçš„æ±‡ç¼–ä»£ç ä¹Ÿä¸åŒã€‚ å¦å¤–Cosmos.ekiçš„ç”Ÿæˆè¿‡ç¨‹èƒ½æœ‰ä¸ªè¯´æ˜ä¸ï¼Ÿ ","like_count":2,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521599,"discussion_content":"æˆ‘è¯¾ç¨‹ä¸­æœ‰ç”Ÿæˆekiæ–‡ä»¶çš„æ–¹å¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623245213,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2749777,"avatar":"https://static001.geekbang.org/account/avatar/00/29/f5/51/a7406456.jpg","nickname":"å¤šå¤šäºº","note":"","ucode":"32DE9F65DADE23","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391387,"discussion_content":"5.2æ­¥éª¤é‡Œï¼Œè°ˆåˆ°åŠ è½½æ–‡ä»¶ç³»ç»Ÿé©±åŠ¨ï¼Œè¿™ä¸ªæ€ä¹ˆç†è§£ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630427269,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1115232,"avatar":"https://static001.geekbang.org/account/avatar/00/11/04/60/64d166b6.jpg","nickname":"Fan","note":"","ucode":"3BF28670FD9407","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378416,"discussion_content":"cpuçš„æŒ‡ä»¤ä¸åŒï¼Ÿ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623214837,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2344081,"avatar":"https://static001.geekbang.org/account/avatar/00/23/c4/91/a017bf72.jpg","nickname":"coconut","note":"","ucode":"07B95C7A6AC2F7","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378404,"discussion_content":"åŠ ä¸€:cosmos.eki ç”Ÿæˆè¿‡ç¨‹çš„è¯´æ˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623209255,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":297023,"user_name":"blentle","can_delete":false,"product_type":"c1","uid":1064679,"ip_address":"","ucode":"AC092609A4942A","user_header":"https://static001.geekbang.org/account/avatar/00/10/3e/e7/261711a5.jpg","comment_is_top":false,"comment_ctime":1623286439,"is_pvip":false,"replies":[{"id":"108086","content":"å“ˆå“ˆ è¿™ä¸ªåœ°å€ ç²¾å…¸","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1623726714,"ip_address":"","comment_id":297023,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5918253735","product_id":100078401,"comment_content":"ä¸ç®¡è‚šå­å¤šå°‘éå¯åŠ¨æµç¨‹ï¼Œè¿˜æ˜¯è®°ä¸ä½å„ç§åœ°å€ï¼Œé™¤äº†0Ã—7c00ï¼Œå“ˆå“ˆ","like_count":1,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521685,"discussion_content":"å“ˆå“ˆ è¿™ä¸ªåœ°å€ ç²¾å…¸","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623726714,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296886,"user_name":"Fan","can_delete":false,"product_type":"c1","uid":1115232,"ip_address":"","ucode":"3BF28670FD9407","user_header":"https://static001.geekbang.org/account/avatar/00/11/04/60/64d166b6.jpg","comment_is_top":false,"comment_ctime":1623209997,"is_pvip":false,"replies":[{"id":"107828","content":"æ¥äº†è€é“ï¼Œå¯åŠ¨æµç¨‹ï¼Œå¸¸çœ‹å¸¸æ–°ï½","user_name":"ç¼–è¾‘å›å¤","user_name_real":"èµµå®‡æ–°","uid":"1501385","ctime":1623217849,"ip_address":"","comment_id":296886,"utype":2}],"discussion_count":1,"race_medal":0,"score":"5918177293","product_id":100078401,"comment_content":"åˆå­¦ä¹ äº†ä¸€éå¯åŠ¨æµç¨‹ã€‚ğŸ˜‚","like_count":1,"discussions":[{"author":{"id":1501385,"avatar":"https://static001.geekbang.org/account/avatar/00/16/e8/c9/59bcd490.jpg","nickname":"å¬æ°´çš„æ¹–","note":"","ucode":"B1759F90165D81","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521627,"discussion_content":"æ¥äº†è€é“ï¼Œå¯åŠ¨æµç¨‹ï¼Œå¸¸çœ‹å¸¸æ–°ï½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623217849,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":348995,"user_name":"Qfeng","can_delete":false,"product_type":"c1","uid":1466121,"ip_address":"","ucode":"1248E70012BBA2","user_header":"https://static001.geekbang.org/account/avatar/00/16/5f/09/2ec44412.jpg","comment_is_top":false,"comment_ctime":1655629828,"is_pvip":false,"replies":[{"id":"128075","content":"666666","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1345199","ctime":1658391034,"ip_address":"","comment_id":348995,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1655629828","product_id":100078401,"comment_content":"ä¸€ã€ç®€å•æ€»ç»“ï¼š<br>1. CPUä¸Šç”µå¯åŠ¨BIOSï¼ˆROMï¼‰<br>CPUç¡¬ä»¶è¢«è®¾è®¡æˆåœ¨åŠ ç”µçš„ç¬é—´ï¼Œå¼ºåˆ¶å°† CS å¯„å­˜å™¨çš„å€¼è®¾ç½®ä¸º 0XF000ï¼ŒIP å¯„å­˜å™¨çš„å€¼è®¾ç½®ä¸º 0XFFF0ã€‚<br>CS:IP ä¸º 0XFFFF0 çš„è¿™ä¸ªç‰©ç†åœ°å€ä¸Šè¿æ¥äº†ä¸»æ¿ä¸Šçš„ä¸€å—å°çš„ ROM èŠ¯ç‰‡ï¼ŒBIOS ç¨‹åºå°±è¢«å›ºåŒ–åœ¨è¯¥ ROM èŠ¯ç‰‡é‡Œã€‚<br>æ€»ç»“ï¼šCPUä¸Šç”µåç¡¬ä»¶è‡ªåŠ¨å°† CS:IP æŒ‡å‘åœ°å€ 0XFFFF0ï¼Œè¿™é‡Œå­˜æ”¾äº†BIOSç¨‹åºçš„å…¥å£åœ°å€ï¼Œè¾¾åˆ°å¯åŠ¨ BIOS çš„ç›®çš„ã€‚<br>ï¼ˆæ³¨ï¼šè¿™ä¸ªROMèŠ¯ç‰‡çš„è®¿é—®æœºåˆ¶å’Œå¯»å€æ–¹å¼å’Œå†…å­˜ä¸€æ ·ï¼Œåªæ˜¯å®ƒåœ¨æ–­ç”µæ—¶ä¸ä¼šä¸¢å¤±æ•°æ®ï¼Œåœ¨å¸¸è§„ä¸‹ä¹Ÿä¸èƒ½å¾€è¿™é‡Œå†™å…¥æ•°æ®ï¼Œå®ƒæ˜¯ä¸€ç§åªè¯»å†…å­˜ã€‚ï¼‰<br><br>2. ROM BIOS<br>åˆå§‹åŒ–CPUå’Œå†…å­˜ï¼Œå°†è‡ªå·±æ‹·è´åˆ°å†…å­˜ï¼Œæ‰§è¡Œç¯å¢ƒè·³è½¬åˆ°å†…å­˜ï¼ˆDDRï¼‰<br><br>3. DDR BIOS<br>1ï¼‰è®¾å¤‡åˆå§‹åŒ–<br>2ï¼‰åœ¨å†…å­˜ä¸­å»ºç«‹ä¸­æ–­æœåŠ¡ç¨‹åºè¡¨ï¼ˆ0x00000~0x003FFï¼Œ1KBï¼Œ256ä¸ªæ¡ç›®ï¼‰, BIOS æ•°æ®åŒºï¼ˆ0x00400~0x004FFï¼‰å’Œä¸­æ–­æœåŠ¡ç¨‹åºï¼ˆ0x0E05B~1005Bï¼Œ8KBï¼‰<br>3ï¼‰æœç´¢å¯å¼•å¯¼çš„å¤–éƒ¨å­˜å‚¨å™¨ï¼Œå¹¶å¯åŠ¨å…¶ä¸­çš„ç¨‹åºã€‚ï¼ˆåŒ…æ‹¬ï¼šç¡¬ç›˜ï¼ŒUç›˜ï¼Œè½¯é©±ï¼Œå…‰é©±å’Œç½‘ç»œè®¾å¤‡ç­‰ï¼‰<br>4ï¼‰Linuxä»ç¡¬ç›˜å¯åŠ¨æ—¶ï¼Œç¡¬ç›˜ä¸­åä¸ºMRBçš„ç¬¬ä¸€ä¸ªæ‰‡åŒºåŒ…å«çš„GRUB å¯åŠ¨ç¨‹åºï¼ˆå®‰è£…GRUBæ—¶è‡ªåŠ¨å†™å…¥ï¼‰å’Œåˆ†åŒºè¡¨è¢« BIOS è£…è½½åˆ° 0x7c00 åœ°å€å¼€å§‹çš„å†…å­˜ç©ºé—´ï¼Œ<br>è‡³æ­¤BIOSä½¿å‘½ç»“æŸï¼Œæ§åˆ¶æƒäº¤ç»™GRUBã€‚<br><br>4. GRUB å¯åŠ¨<br>1ï¼‰GRUBåŒ…å« boot.imgå’Œcore.imgä¸¤éƒ¨åˆ†ï¼Œç¡¬ç›˜MRBç©ºé—´æœ‰é™åªåŒ…å«boot.imgï¼Œboot.imgä¸­åŒ…å«core.imgå­˜æ”¾çš„ç¡¬ç›˜æ‰‡åŒºå·<br>2ï¼‰core.img æ–‡ä»¶æ˜¯ç”± GRUB å®‰è£…ç¨‹åºæ ¹æ®å®‰è£…æ—¶ç¯å¢ƒä¿¡æ¯ï¼Œç”¨å…¶å®ƒ GRUB çš„æ¨¡å—æ–‡ä»¶åŠ¨æ€ç”Ÿæˆï¼Œä¸»è¦åŒ…å«diskboot.imgï¼Œkernel.imgå’Œå…¶ä»–åŠŸèƒ½æ¨¡å—ã€‚<br>GRUB çš„ core.img æ–‡ä»¶ä¸€æ—¦å¼€å§‹å·¥ä½œï¼Œå°±å¯ä»¥åŠ è½½ Linux ç³»ç»Ÿçš„ vmlinuz å†…æ ¸æ–‡ä»¶äº†ã€‚<br><br>5. Linux vmlinuzçš„ç”Ÿæˆ<br>1ï¼‰ç”±Linux ç¼–è¯‘ç”Ÿæˆçš„ bzImage æ–‡ä»¶å¤åˆ¶è€Œæ¥ï¼Œå­˜æ”¾åœ¨ &#47;boot ç›®å½•ä¸‹<br>2ï¼‰bzImage ç”± arch&#47;x86&#47;boot&#47;Makefile ç¼–è¯‘è€Œæ¥ï¼Œä¾èµ– setup.binå’Œvmlinux.binä¸¤ä¸ªã€‚<br>3ï¼‰setup.bin ç”± &#47;arch&#47;x86&#47;boot&#47; ç›®å½•ä¸‹çš„æ–‡ä»¶ç¼–è¯‘ç”Ÿæˆ<br>4ï¼‰arch&#47;x86&#47;boot&#47;compressed ç›®å½• ç¼–è¯‘ç”Ÿæˆ vmlinux.binè¿‡ç¨‹æ€»ç»“ï¼šLinux çš„ kbuildï¼ˆå†…æ ¸ç¼–è¯‘ï¼‰ç³»ç»Ÿä¼šé€’å½’è¿›å…¥åˆ°æ¯ä¸ªç›®å½•ï¼Œç”±è¯¥ç›®å½•ä¸‹çš„ Makefile å†³å®šè¦ç¼–è¯‘çš„æ–‡ä»¶ã€‚æ¯ä¸ªç›®å½•ç¼–è¯‘ç”Ÿæˆä¸€ä¸ª built-in.oï¼Œæ‰€æœ‰çš„ built-in.oæœ€ç»ˆé“¾æ¥ç”Ÿæˆä¸€ä¸ª vmlinux æ–‡ä»¶æœ€ç»ˆå‹ç¼©æˆ vmlinux.bin.gzï¼Œæœ€ç»ˆç”±mkpiggy ç”Ÿæˆ vmlinuxã€‚<br><br>äºŒã€æ€è€ƒé¢˜<br>ä¸ºä»€ä¹ˆè¦ç”¨ C ä»£ç  mkpiggy ç¨‹åºç”Ÿæˆ piggy.S æ–‡ä»¶ï¼Œå¹¶åŒ…å« vmlinux.bin.gz æ–‡ä»¶å‘¢ï¼Ÿ<br>==ã€‹é€šè¿‡mainå‡½æ•°ä¼ å…¥çš„å¯å˜å‚æ•°å¯ä»¥æ ¹æ®éœ€è¦çµæ´»æ‰©å±•piggy.Sçš„å†…å®¹ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580870,"discussion_content":"666666","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658391034,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":318371,"user_name":"æ¬é“å°‘å¹´ai","can_delete":false,"product_type":"c1","uid":1031045,"ip_address":"","ucode":"01D4A830A088D7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bb/85/191eea69.jpg","comment_is_top":false,"comment_ctime":1635260759,"is_pvip":false,"replies":[{"id":"115517","content":"åªä¼šcopy å‰446ä¸ªå­—èŠ‚","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1635383527,"ip_address":"","comment_id":318371,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1635260759","product_id":100078401,"comment_content":"è¯·é—®è€å¸ˆï¼Œboot.img æ˜¯ 512B å¤§å°ï¼ŒMBR ä¹Ÿæ˜¯ 512ï¼Œéš¾é“ boot.img å®‰è£…åˆ° MBR çš„æ—¶å€™ä¼šæŠŠ MBR å…¨éƒ¨è¦†ç›–æ‰å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529209,"discussion_content":"åªä¼šcopy å‰446ä¸ªå­—èŠ‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635383527,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":317973,"user_name":"æ¬é“å°‘å¹´ai","can_delete":false,"product_type":"c1","uid":1031045,"ip_address":"","ucode":"01D4A830A088D7","user_header":"https://static001.geekbang.org/account/avatar/00/0f/bb/85/191eea69.jpg","comment_is_top":false,"comment_ctime":1635081607,"is_pvip":false,"replies":[{"id":"115357","content":"é‚£æ˜¯BIOSé‡Œé¢ç›¸å…³çš„å†…å®¹ è¿™é‡Œæ˜¯ä»GRUBå¼€å§‹çš„","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1635211019,"ip_address":"","comment_id":317973,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1635081607","product_id":100078401,"comment_content":"è€å¸ˆå¥½ï¼Œæˆ‘çœ‹åˆ«çš„ä¹¦é‡Œé¢å°†ä¸Šç”µåå…ˆè·³è½¬åˆ° reset vector(0xFFFFFFF0)ï¼Œç„¶å reset vector ä¼šè·³è½¬åˆ° BIOS çš„å…¥å£ï¼ˆ0xFFFF0ï¼‰ï¼Œæ‚¨è¿™é‡Œä¸ºä»€ä¹ˆæ²¡æœ‰è¿™ä¸ªæ¢å¤å‘é‡å‘¢","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529049,"discussion_content":"é‚£æ˜¯BIOSé‡Œé¢ç›¸å…³çš„å†…å®¹ è¿™é‡Œæ˜¯ä»GRUBå¼€å§‹çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635211019,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1450316,"avatar":"https://static001.geekbang.org/account/avatar/00/16/21/4c/7ed159ec.jpg","nickname":"èŠ¥æœ«å…«çˆªé±¼","note":"","ucode":"8AA979FE95CBE0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":552643,"discussion_content":"0xFFFFFFF0è¿™ä¸ªåœ°å€æ˜¯UEFIä¸‹reset vectorçš„åœ°å€ï¼›0xFFFF0æ˜¯Legacy BIOSä¸‹reset vectorçš„åœ°å€ã€‚ä½œè€…æ˜¯å·²Legacy BIOSä¸ºä¾‹è¿›è¡Œè®²è§£çš„ï¼Œä¸è¿‡ç°åœ¨åŸºæœ¬éƒ½æ˜¯UEFIäº†ï¼ŒIntelåé¢ä¹Ÿä¸å†æ”¯æŒLegacyæ¨¡å¼äº†ã€‚UEFIä¸‹çš„å¯åŠ¨æµç¨‹å’ŒLegacyæ¨¡å¼æ˜¯æœ‰å¾ˆå¤§åŒºåˆ«çš„ï¼Œæ¯”å¦‚UEFIä¸‹BIOSæ”¯æŒFat32æ–‡ä»¶ç³»ç»Ÿï¼Œç¡¬ç›˜é‡‡ç”¨GPTåˆ†åŒºæ–¹å¼ï¼Œå¯åŠ¨åˆ†åŒºæ ¼å¼åŒ–æˆFat32æ ¼å¼çš„ï¼ŒBIOSå¯ä»¥ç›´æ¥è¯»å–å¯åŠ¨åˆ†åŒºé‡Œé¢çš„grubæ–‡ä»¶ï¼ˆ.efiæ ¼å¼çš„ï¼‰ï¼Œä¹Ÿå°±æ²¡æœ‰æ‰€è°“çš„grubåˆ†æˆå¤šéƒ¨åŠ è½½è¿™ä¸ªè¿‡ç¨‹äº†ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1645537278,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":296914,"user_name":"è€ç‹","can_delete":false,"product_type":"c1","uid":2246251,"ip_address":"","ucode":"D629648D2F2FFA","user_header":"https://static001.geekbang.org/account/avatar/00/22/46/6b/e766c18d.jpg","comment_is_top":false,"comment_ctime":1623224344,"is_pvip":false,"replies":[{"id":"107852","content":"æ˜¯çš„ï¼Œlinuxå¤ªå¤§äº†<br>","user_name":"ä½œè€…å›å¤","user_name_real":"LMOS","uid":"1345199","ctime":1623245000,"ip_address":"","comment_id":296914,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1623224344","product_id":100078401,"comment_content":"éœ€è¦å¤šåˆ†æå„ä¸ªè„šæœ¬çš„åŠŸèƒ½ï¼Œæ‰èƒ½æŠŠæ¡ä½è„‰ç»œ","like_count":0,"discussions":[{"author":{"id":1345199,"avatar":"https://static001.geekbang.org/account/avatar/00/14/86/af/99219321.jpg","nickname":"LMOS","note":"","ucode":"B037712C8B8B3C","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521644,"discussion_content":"æ˜¯çš„ï¼Œlinuxå¤ªå¤§äº†\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623245000,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}