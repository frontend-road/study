{"id":9788,"title":"ç¬¬22è®² | AtomicIntegeråº•å±‚å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•åœ¨è‡ªå·±çš„äº§å“ä»£ç ä¸­åº”ç”¨CASæ“ä½œï¼Ÿ","content":"<p>åœ¨ä»Šå¤©è¿™ä¸€è®²ä¸­ï¼Œæˆ‘æ¥åˆ†æä¸€ä¸‹å¹¶å‘åŒ…å†…éƒ¨çš„ç»„æˆï¼Œä¸€èµ·æ¥çœ‹çœ‹å„ç§åŒæ­¥ç»“æ„ã€çº¿ç¨‹æ± ç­‰ï¼Œæ˜¯åŸºäºä»€ä¹ˆåŸç†æ¥è®¾è®¡å’Œå®ç°çš„ã€‚</p><p>ä»Šå¤©æˆ‘è¦é—®ä½ çš„é—®é¢˜æ˜¯ï¼Œ<span class=\"orange\">AtomicIntegeråº•å±‚å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•åœ¨è‡ªå·±çš„äº§å“ä»£ç ä¸­åº”ç”¨CASæ“ä½œï¼Ÿ</span></p><h2>å…¸å‹å›ç­”</h2><p>AtomicIntgeræ˜¯å¯¹intç±»å‹çš„ä¸€ä¸ªå°è£…ï¼Œæä¾›åŸå­æ€§çš„è®¿é—®å’Œæ›´æ–°æ“ä½œï¼Œå…¶åŸå­æ€§æ“ä½œçš„å®ç°æ˜¯åŸºäºCASï¼ˆ<a href=\"https://en.wikipedia.org/wiki/Compare-and-swap\">compare-and-swap</a>ï¼‰æŠ€æœ¯ã€‚</p><p>æ‰€è°“CASï¼Œè¡¨å¾çš„æ˜¯ä¸€ç³»åˆ—æ“ä½œçš„é›†åˆï¼Œè·å–å½“å‰æ•°å€¼ï¼Œè¿›è¡Œä¸€äº›è¿ç®—ï¼Œåˆ©ç”¨CASæŒ‡ä»¤è¯•å›¾è¿›è¡Œæ›´æ–°ã€‚å¦‚æœå½“å‰æ•°å€¼æœªå˜ï¼Œä»£è¡¨æ²¡æœ‰å…¶ä»–çº¿ç¨‹è¿›è¡Œå¹¶å‘ä¿®æ”¹ï¼Œåˆ™æˆåŠŸæ›´æ–°ã€‚å¦åˆ™ï¼Œå¯èƒ½å‡ºç°ä¸åŒçš„é€‰æ‹©ï¼Œè¦ä¹ˆè¿›è¡Œé‡è¯•ï¼Œè¦ä¹ˆå°±è¿”å›ä¸€ä¸ªæˆåŠŸæˆ–è€…å¤±è´¥çš„ç»“æœã€‚</p><p>ä»AtomicIntegerçš„å†…éƒ¨å±æ€§å¯ä»¥çœ‹å‡ºï¼Œå®ƒä¾èµ–äºUnsafeæä¾›çš„ä¸€äº›åº•å±‚èƒ½åŠ›ï¼Œè¿›è¡Œåº•å±‚æ“ä½œï¼›ä»¥volatileçš„valueå­—æ®µï¼Œè®°å½•æ•°å€¼ï¼Œä»¥ä¿è¯å¯è§æ€§ã€‚</p><pre><code>private static final jdk.internal.misc.Unsafe U = jdk.internal.misc.Unsafe.getUnsafe();\nprivate static final long VALUE = U.objectFieldOffset(AtomicInteger.class, &quot;value&quot;);\nprivate volatile int value;\n</code></pre><p>å…·ä½“çš„åŸå­æ“ä½œç»†èŠ‚ï¼Œå¯ä»¥å‚è€ƒä»»æ„ä¸€ä¸ªåŸå­æ›´æ–°æ–¹æ³•ï¼Œæ¯”å¦‚ä¸‹é¢çš„getAndIncrementã€‚</p><p>Unsafeä¼šåˆ©ç”¨valueå­—æ®µçš„å†…å­˜åœ°å€åç§»ï¼Œç›´æ¥å®Œæˆæ“ä½œã€‚</p><pre><code>public final int getAndIncrement() {\n Â Â Â return U.getAndAddInt(this, VALUE, 1);\n}\n</code></pre><p>å› ä¸ºgetAndIncrementéœ€è¦è¿”å½’æ•°å€¼ï¼Œæ‰€ä»¥éœ€è¦æ·»åŠ å¤±è´¥é‡è¯•é€»è¾‘ã€‚</p><!-- [[[read_end]]] --><pre><code>public final int getAndAddInt(Object o, long offset, int delta) {\n Â Â Â int v;\n Â Â Â do {\n Â Â Â Â Â Â Â v = getIntVolatile(o, offset);\n Â Â Â } while (!weakCompareAndSetInt(o, offset, v, v + delta));\n Â Â Â return v;\n}\n</code></pre><p>è€Œç±»ä¼¼compareAndSetè¿™ç§è¿”å›booleanç±»å‹çš„å‡½æ•°ï¼Œå› ä¸ºå…¶è¿”å›å€¼è¡¨ç°çš„å°±æ˜¯æˆåŠŸä¸å¦ï¼Œæ‰€ä»¥ä¸éœ€è¦é‡è¯•ã€‚</p><pre><code>public final boolean compareAndSet(int expectedValue, int newValue)\n</code></pre><p>CASæ˜¯Javaå¹¶å‘ä¸­æ‰€è°“lock-freeæœºåˆ¶çš„åŸºç¡€ã€‚</p><h2>è€ƒç‚¹åˆ†æ</h2><p>ä»Šå¤©çš„é—®é¢˜æœ‰ç‚¹åå‘äºJavaå¹¶å‘æœºåˆ¶çš„åº•å±‚äº†ï¼Œè™½ç„¶æˆ‘ä»¬åœ¨å¼€å‘ä¸­æœªå¿…ä¼šæ¶‰åŠCASçš„å®ç°å±‚é¢ï¼Œä½†æ˜¯ç†è§£å…¶æœºåˆ¶ï¼ŒæŒæ¡å¦‚ä½•åœ¨Javaä¸­è¿ç”¨è¯¥æŠ€æœ¯ï¼Œè¿˜æ˜¯ååˆ†æœ‰å¿…è¦çš„ï¼Œå°¤å…¶æ˜¯è¿™ä¹Ÿæ˜¯ä¸ªå¹¶å‘ç¼–ç¨‹çš„é¢è¯•çƒ­ç‚¹ã€‚</p><p>æœ‰çš„åŒå­¦åé¦ˆé¢è¯•å®˜ä¼šé—®CASæ›´åŠ åº•å±‚æ˜¯å¦‚ä½•å®ç°çš„ï¼Œè¿™ä¾èµ–äºCPUæä¾›çš„ç‰¹å®šæŒ‡ä»¤ï¼Œå…·ä½“æ ¹æ®ä½“ç³»ç»“æ„çš„ä¸åŒè¿˜å­˜åœ¨ç€æ˜æ˜¾åŒºåˆ«ã€‚æ¯”å¦‚ï¼Œx86 CPUæä¾›cmpxchgæŒ‡ä»¤ï¼›è€Œåœ¨ç²¾ç®€æŒ‡ä»¤é›†çš„ä½“ç³»æ¶æ„ä¸­ï¼Œåˆ™é€šå¸¸æ˜¯é ä¸€å¯¹å„¿æŒ‡ä»¤ï¼ˆå¦‚â€œload and reserveâ€å’Œâ€œstore conditionalâ€ï¼‰å®ç°çš„ï¼Œåœ¨å¤§å¤šæ•°å¤„ç†å™¨ä¸ŠCASéƒ½æ˜¯ä¸ªéå¸¸è½»é‡çº§çš„æ“ä½œï¼Œè¿™ä¹Ÿæ˜¯å…¶ä¼˜åŠ¿æ‰€åœ¨ã€‚</p><p>å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼ŒæŒæ¡åˆ°è¿™ä¸ªç¨‹åº¦ä¹Ÿå°±å¤Ÿç”¨äº†ï¼Œæˆ‘è®¤ä¸ºæ²¡æœ‰å¿…è¦è®©æ¯ä¸ªJavaå·¥ç¨‹å¸ˆéƒ½å»äº†è§£åˆ°æŒ‡ä»¤çº§åˆ«ï¼Œæˆ‘ä»¬è¿›è¡ŒæŠ½è±¡ã€åˆ†å·¥å°±æ˜¯ä¸ºäº†è®©ä¸åŒå±‚é¢çš„å¼€å‘è€…åœ¨å¼€å‘ä¸­ï¼Œå¯ä»¥å°½é‡å±è”½ä¸ç›¸å…³çš„ç»†èŠ‚ã€‚</p><p>å¦‚æœæˆ‘ä½œä¸ºé¢è¯•å®˜ï¼Œå¾ˆæœ‰å¯èƒ½æ·±å…¥è€ƒå¯Ÿè¿™äº›æ–¹å‘ï¼š</p><ul>\n<li>\n<p>åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ï¼Œå¯ä»¥é‡‡ç”¨CASæŠ€æœ¯ï¼Œè°ƒç”¨Unsafeæ¯•ç«Ÿä¸æ˜¯å¤§å¤šæ•°åœºæ™¯çš„æœ€å¥½é€‰æ‹©ï¼Œæœ‰æ²¡æœ‰æ›´åŠ æ¨èçš„æ–¹å¼å‘¢ï¼Ÿæ¯•ç«Ÿæˆ‘ä»¬æŒæ¡ä¸€ä¸ªæŠ€æœ¯ï¼Œcoolä¸æ˜¯ç›®çš„ï¼Œæ›´ä¸æ˜¯ä¸ºäº†åº”ä»˜é¢è¯•ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¸Œæœ›èƒ½åœ¨å®é™…äº§å“ä¸­æœ‰ä»·å€¼ã€‚</p>\n</li>\n<li>\n<p>å¯¹ReentrantLockã€CyclicBarrierç­‰å¹¶å‘ç»“æ„åº•å±‚çš„å®ç°æŠ€æœ¯çš„ç†è§£ã€‚</p>\n</li>\n</ul><h2>çŸ¥è¯†æ‰©å±•</h2><p>å…³äºCASçš„ä½¿ç”¨ï¼Œä½ å¯ä»¥è®¾æƒ³è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼šåœ¨æ•°æ®åº“äº§å“ä¸­ï¼Œä¸ºä¿è¯ç´¢å¼•çš„ä¸€è‡´æ€§ï¼Œä¸€ä¸ªå¸¸è§çš„é€‰æ‹©æ˜¯ï¼Œä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿæ’ä»–æ€§åœ°ä¿®æ”¹ä¸€ä¸ªç´¢å¼•åˆ†åŒºï¼Œå¦‚ä½•åœ¨æ•°æ®åº“æŠ½è±¡å±‚é¢å®ç°å‘¢ï¼Ÿ</p><p>å¯ä»¥è€ƒè™‘ä¸ºç´¢å¼•åˆ†åŒºå¯¹è±¡æ·»åŠ ä¸€ä¸ªé€»è¾‘ä¸Šçš„é”ï¼Œä¾‹å¦‚ï¼Œä»¥å½“å‰ç‹¬å çš„çº¿ç¨‹IDä½œä¸ºé”çš„æ•°å€¼ï¼Œç„¶åé€šè¿‡åŸå­æ“ä½œè®¾ç½®lockæ•°å€¼ï¼Œæ¥å®ç°åŠ é”å’Œé‡Šæ”¾é”ï¼Œä¼ªä»£ç å¦‚ä¸‹ï¼š</p><pre><code>public class AtomicBTreePartition {\nprivate volatile long lock;\npublic void acquireLock(){}\npublic void releaseeLock(){}\n}\n</code></pre><p>é‚£ä¹ˆåœ¨Javaä»£ç ä¸­ï¼Œæˆ‘ä»¬æ€ä¹ˆå®ç°é”æ“ä½œå‘¢ï¼ŸUnsafeä¼¼ä¹ä¸æ˜¯ä¸ªå¥½çš„é€‰æ‹©ï¼Œä¾‹å¦‚ï¼Œæˆ‘å°±æ³¨æ„åˆ°ç±»ä¼¼Cassandraç­‰äº§å“ï¼Œå› ä¸ºJava 9ä¸­ç§»é™¤äº†Unsafe.moniterEnter()/moniterExit()ï¼Œå¯¼è‡´æ— æ³•å¹³æ»‘å‡çº§åˆ°æ–°çš„JDKç‰ˆæœ¬ã€‚ç›®å‰Javaæä¾›äº†ä¸¤ç§å…¬å…±APIï¼Œå¯ä»¥å®ç°è¿™ç§CASæ“ä½œï¼Œæ¯”å¦‚ä½¿ç”¨java.util.concurrent.atomic.AtomicLongFieldUpdaterï¼Œå®ƒæ˜¯åŸºäºåå°„æœºåˆ¶åˆ›å»ºï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯ç±»å‹å’Œå­—æ®µåç§°æ­£ç¡®ã€‚</p><pre><code>private static final AtomicLongFieldUpdater&lt;AtomicBTreePartition&gt; lockFieldUpdater =\n Â Â Â Â Â Â Â AtomicLongFieldUpdater.newUpdater(AtomicBTreePartition.class, &quot;lock&quot;);\n\nprivate void acquireLock(){\n Â Â Â long t = Thread.currentThread().getId();\n Â Â Â while (!lockFieldUpdater.compareAndSet(this, 0L, t)){\n Â Â Â Â Â Â Â // ç­‰å¾…ä¸€ä¼šå„¿ï¼Œæ•°æ®åº“æ“ä½œå¯èƒ½æ¯”è¾ƒæ…¢\n Â Â Â Â Â Â Â Â â€¦\n Â Â Â }\n}\n</code></pre><p><a href=\"https://docs.oracle.com/javase/9/docs/api/java/util/concurrent/atomic/package-summary.html\">AtomicåŒ…</a>æä¾›äº†æœ€å¸¸ç”¨çš„åŸå­æ€§æ•°æ®ç±»å‹ï¼Œç”šè‡³æ˜¯å¼•ç”¨ã€æ•°ç»„ç­‰ç›¸å…³åŸå­ç±»å‹å’Œæ›´æ–°æ“ä½œå·¥å…·ï¼Œæ˜¯å¾ˆå¤šçº¿ç¨‹å®‰å…¨ç¨‹åºçš„é¦–é€‰ã€‚</p><p>æˆ‘åœ¨ä¸“æ ç¬¬ä¸ƒè®²ä¸­æ›¾ä»‹ç»ä½¿ç”¨åŸå­æ•°æ®ç±»å‹å’ŒAtomic*FieldUpdaterï¼Œåˆ›å»ºæ›´åŠ ç´§å‡‘çš„è®¡æ•°å™¨å®ç°ï¼Œä»¥æ›¿ä»£AtomicLongã€‚ä¼˜åŒ–æ°¸è¿œæ˜¯é’ˆå¯¹ç‰¹å®šéœ€æ±‚ã€ç‰¹å®šç›®çš„ï¼Œæˆ‘è¿™é‡Œçš„ä¾§é‡ç‚¹æ˜¯ä»‹ç»å¯èƒ½çš„æ€è·¯ï¼Œå…·ä½“è¿˜æ˜¯è¦çœ‹éœ€æ±‚ã€‚å¦‚æœä»…ä»…åˆ›å»ºä¸€ä¸¤ä¸ªå¯¹è±¡ï¼Œå…¶å®å®Œå…¨æ²¡æœ‰å¿…è¦è¿›è¡Œå‰é¢çš„ä¼˜åŒ–ï¼Œä½†æ˜¯å¦‚æœå¯¹è±¡æˆåƒä¸Šä¸‡æˆ–è€…æ›´å¤šï¼Œå°±è¦è€ƒè™‘ç´§å‡‘æ€§çš„å½±å“äº†ã€‚è€ŒatomicåŒ…æä¾›çš„<a href=\"https://docs.oracle.com/javase/9/docs/api/java/util/concurrent/atomic/LongAdder.html\">LongAdder</a>ï¼Œåœ¨é«˜åº¦ç«äº‰ç¯å¢ƒä¸‹ï¼Œå¯èƒ½å°±æ˜¯æ¯”AtomicLongæ›´ä½³çš„é€‰æ‹©ï¼Œå°½ç®¡å®ƒçš„æœ¬è´¨æ˜¯ç©ºé—´æ¢æ—¶é—´ã€‚</p><p>å›å½’æ­£é¢˜ï¼Œå¦‚æœæ˜¯Java 9ä»¥åï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥é‡‡ç”¨å¦å¤–ä¸€ç§æ–¹å¼å®ç°ï¼Œä¹Ÿå°±æ˜¯Variable Handle APIï¼Œè¿™æ˜¯æºè‡ªäº<a href=\"http://openjdk.java.net/jeps/193\">JEP 193</a>ï¼Œæä¾›äº†å„ç§ç²’åº¦çš„åŸå­æˆ–è€…æœ‰åºæ€§çš„æ“ä½œç­‰ã€‚æˆ‘å°†å‰é¢çš„ä»£ç ä¿®æ”¹ä¸ºå¦‚ä¸‹å®ç°ï¼š</p><pre><code>private static final VarHandle HANDLE = MethodHandles.lookup().findStaticVarHandle\n Â Â Â Â Â Â Â (AtomicBTreePartition.class, &quot;lock&quot;);\n\nprivate void acquireLock(){\n Â Â Â long t = Thread.currentThread().getId();\n Â Â Â while (!HANDLE.compareAndSet(this, 0L, t)){\n Â Â Â Â Â Â Â // ç­‰å¾…ä¸€ä¼šå„¿ï¼Œæ•°æ®åº“æ“ä½œå¯èƒ½æ¯”è¾ƒæ…¢\n Â Â Â Â Â Â Â â€¦\n Â Â Â }\n}\n</code></pre><p>è¿‡ç¨‹éå¸¸ç›´è§‚ï¼Œé¦–å…ˆï¼Œè·å–ç›¸åº”çš„å˜é‡å¥æŸ„ï¼Œç„¶åç›´æ¥è°ƒç”¨å…¶æä¾›çš„CASæ–¹æ³•ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬è¿›è¡Œçš„ç±»ä¼¼CASæ“ä½œï¼Œå¯ä»¥å¹¶ä¸”æ¨èä½¿ç”¨Variable Handle APIå»å®ç°ï¼Œå…¶æä¾›äº†ç²¾ç»†ç²’åº¦çš„å…¬å…±åº•å±‚APIã€‚æˆ‘è¿™é‡Œå¼ºè°ƒå…¬å…±ï¼Œæ˜¯å› ä¸ºå…¶APIä¸ä¼šåƒå†…éƒ¨APIé‚£æ ·ï¼Œå‘ç”Ÿä¸å¯é¢„æµ‹çš„ä¿®æ”¹ï¼Œè¿™ä¸€ç‚¹æä¾›äº†å¯¹äºæœªæ¥äº§å“ç»´æŠ¤å’Œå‡çº§çš„åŸºç¡€ä¿éšœï¼Œå¦ç™½è¯´ï¼Œå¾ˆå¤šé¢å¤–å·¥ä½œé‡ï¼Œéƒ½æ˜¯æºäºæˆ‘ä»¬ä½¿ç”¨äº†Hackè€ŒéSolutionçš„æ–¹å¼è§£å†³é—®é¢˜ã€‚</p><p>CASä¹Ÿå¹¶ä¸æ˜¯æ²¡æœ‰å‰¯ä½œç”¨ï¼Œè¯•æƒ³ï¼Œå…¶å¸¸ç”¨çš„å¤±è´¥é‡è¯•æœºåˆ¶ï¼Œéšå«ç€ä¸€ä¸ªå‡è®¾ï¼Œå³ç«äº‰æƒ…å†µæ˜¯çŸ­æš‚çš„ã€‚å¤§å¤šæ•°åº”ç”¨åœºæ™¯ä¸­ï¼Œç¡®å®å¤§éƒ¨åˆ†é‡è¯•åªä¼šå‘ç”Ÿä¸€æ¬¡å°±è·å¾—äº†æˆåŠŸï¼Œä½†æ˜¯æ€»æ˜¯æœ‰æ„å¤–æƒ…å†µï¼Œæ‰€ä»¥åœ¨æœ‰éœ€è¦çš„æ—¶å€™ï¼Œè¿˜æ˜¯è¦è€ƒè™‘é™åˆ¶è‡ªæ—‹çš„æ¬¡æ•°ï¼Œä»¥å…è¿‡åº¦æ¶ˆè€—CPUã€‚</p><p>å¦å¤–ä¸€ä¸ªå°±æ˜¯è‘—åçš„<a href=\"https://en.wikipedia.org/wiki/ABA_problem\">ABA</a>é—®é¢˜ï¼Œè¿™æ˜¯é€šå¸¸åªåœ¨lock-freeç®—æ³•ä¸‹æš´éœ²çš„é—®é¢˜ã€‚æˆ‘å‰é¢è¯´è¿‡CASæ˜¯åœ¨æ›´æ–°æ—¶æ¯”è¾ƒå‰å€¼ï¼Œå¦‚æœå¯¹æ–¹åªæ˜¯æ°å¥½ç›¸åŒï¼Œä¾‹å¦‚æœŸé—´å‘ç”Ÿäº† A -&gt; B -&gt; Açš„æ›´æ–°ï¼Œä»…ä»…åˆ¤æ–­æ•°å€¼æ˜¯Aï¼Œå¯èƒ½å¯¼è‡´ä¸åˆç†çš„ä¿®æ”¹æ“ä½œã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼ŒJavaæä¾›äº†AtomicStampedReferenceå·¥å…·ç±»ï¼Œé€šè¿‡ä¸ºå¼•ç”¨å»ºç«‹ç±»ä¼¼ç‰ˆæœ¬å·ï¼ˆstampï¼‰çš„æ–¹å¼ï¼Œæ¥ä¿è¯CASçš„æ­£ç¡®æ€§ï¼Œå…·ä½“ç”¨æ³•è¯·å‚è€ƒè¿™é‡Œçš„<a href=\"http://tutorials.jenkov.com/java-util-concurrent/atomicstampedreference.html\">ä»‹ç»</a>ã€‚</p><p>å‰é¢ä»‹ç»äº†CASçš„åœºæ™¯ä¸å®ç°ï¼Œå¹¸è¿çš„æ˜¯ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒJavaå¼€å‘è€…å¹¶ä¸éœ€è¦ç›´æ¥åˆ©ç”¨CASä»£ç å»å®ç°çº¿ç¨‹å®‰å…¨å®¹å™¨ç­‰ï¼Œæ›´å¤šæ˜¯é€šè¿‡å¹¶å‘åŒ…ç­‰é—´æ¥äº«å—åˆ°lock-freeæœºåˆ¶åœ¨æ‰©å±•æ€§ä¸Šçš„å¥½å¤„ã€‚</p><p>ä¸‹é¢æˆ‘æ¥ä»‹ç»ä¸€ä¸‹AbstractQueuedSynchronizerï¼ˆAQSï¼‰ï¼Œå…¶æ˜¯Javaå¹¶å‘åŒ…ä¸­ï¼Œå®ç°å„ç§åŒæ­¥ç»“æ„å’Œéƒ¨åˆ†å…¶ä»–ç»„æˆå•å…ƒï¼ˆå¦‚çº¿ç¨‹æ± ä¸­çš„Workerï¼‰çš„åŸºç¡€ã€‚</p><p>å­¦ä¹ AQSï¼Œå¦‚æœä¸Šæ¥å°±å»çœ‹å®ƒçš„ä¸€ç³»åˆ—æ–¹æ³•ï¼ˆä¸‹å›¾æ‰€ç¤ºï¼‰ï¼Œå¾ˆæœ‰å¯èƒ½æŠŠè‡ªå·±çœ‹æ™•ï¼Œè¿™ç§ä¼¼æ‡‚éæ‡‚çš„çŠ¶æ€ä¹Ÿæ²¡æœ‰å¤ªå¤§çš„å®è·µæ„ä¹‰ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e3/36/e3b4b7fe5a94a88ca2feb04d734b9c36.png?wh=1062*424\" alt=\"\"></p><p>æˆ‘å»ºè®®çš„æ€è·¯æ˜¯ï¼Œå°½é‡ç®€åŒ–ä¸€ä¸‹ï¼Œç†è§£ä¸ºä»€ä¹ˆéœ€è¦AQSï¼Œå¦‚ä½•ä½¿ç”¨AQSï¼Œ<strong>è‡³å°‘</strong>è¦åšä»€ä¹ˆï¼Œå†è¿›ä¸€æ­¥ç»“åˆJDKæºä»£ç ä¸­çš„å®è·µï¼Œç†è§£AQSçš„åŸç†ä¸åº”ç”¨ã€‚</p><p><a href=\"https://en.wikipedia.org/wiki/Doug_Lea\">Doug Lea</a>æ›¾ç»ä»‹ç»è¿‡AQSçš„è®¾è®¡åˆè¡·ã€‚ä»åŸç†ä¸Šï¼Œä¸€ç§åŒæ­¥ç»“æ„å¾€å¾€æ˜¯å¯ä»¥åˆ©ç”¨å…¶ä»–çš„ç»“æ„å®ç°çš„ï¼Œä¾‹å¦‚æˆ‘åœ¨ä¸“æ ç¬¬19è®²ä¸­æåˆ°è¿‡å¯ä»¥ä½¿ç”¨Semaphoreå®ç°äº’æ–¥é”ã€‚ä½†æ˜¯ï¼Œå¯¹æŸç§åŒæ­¥ç»“æ„çš„å€¾å‘ï¼Œä¼šå¯¼è‡´å¤æ‚ã€æ™¦æ¶©çš„å®ç°é€»è¾‘ï¼Œæ‰€ä»¥ï¼Œä»–é€‰æ‹©äº†å°†åŸºç¡€çš„åŒæ­¥ç›¸å…³æ“ä½œæŠ½è±¡åœ¨AbstractQueuedSynchronizerä¸­ï¼Œåˆ©ç”¨AQSä¸ºæˆ‘ä»¬æ„å»ºåŒæ­¥ç»“æ„æä¾›äº†èŒƒæœ¬ã€‚</p><p>AQSå†…éƒ¨æ•°æ®å’Œæ–¹æ³•ï¼Œå¯ä»¥ç®€å•æ‹†åˆ†ä¸ºï¼š</p><ul>\n<li>ä¸€ä¸ªvolatileçš„æ•´æ•°æˆå‘˜è¡¨å¾çŠ¶æ€ï¼ŒåŒæ—¶æä¾›äº†setStateå’ŒgetStateæ–¹æ³•</li>\n</ul><pre><code>private volatile int state;\n</code></pre><ul>\n<li>\n<p>ä¸€ä¸ªå…ˆå…¥å…ˆå‡ºï¼ˆFIFOï¼‰çš„ç­‰å¾…çº¿ç¨‹é˜Ÿåˆ—ï¼Œä»¥å®ç°å¤šçº¿ç¨‹é—´ç«äº‰å’Œç­‰å¾…ï¼Œè¿™æ˜¯AQSæœºåˆ¶çš„æ ¸å¿ƒä¹‹ä¸€ã€‚</p>\n</li>\n<li>\n<p>å„ç§åŸºäºCASçš„åŸºç¡€æ“ä½œæ–¹æ³•ï¼Œä»¥åŠå„ç§æœŸæœ›å…·ä½“åŒæ­¥ç»“æ„å»å®ç°çš„acquire/releaseæ–¹æ³•ã€‚</p>\n</li>\n</ul><p>åˆ©ç”¨AQSå®ç°ä¸€ä¸ªåŒæ­¥ç»“æ„ï¼Œè‡³å°‘è¦å®ç°ä¸¤ä¸ªåŸºæœ¬ç±»å‹çš„æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯acquireæ“ä½œï¼Œè·å–èµ„æºçš„ç‹¬å æƒï¼›è¿˜æœ‰å°±æ˜¯releaseæ“ä½œï¼Œé‡Šæ”¾å¯¹æŸä¸ªèµ„æºçš„ç‹¬å ã€‚</p><p>ä»¥ReentrantLockä¸ºä¾‹ï¼Œå®ƒå†…éƒ¨é€šè¿‡æ‰©å±•AQSå®ç°äº†Syncç±»å‹ï¼Œä»¥AQSçš„stateæ¥åæ˜ é”çš„æŒæœ‰æƒ…å†µã€‚</p><pre><code>private final Sync sync;\nabstract static class Sync extends AbstractQueuedSynchronizer { â€¦}\n</code></pre><p>ä¸‹é¢æ˜¯ReentrantLockå¯¹åº”acquireå’Œreleaseæ“ä½œï¼Œå¦‚æœæ˜¯CountDownLatchåˆ™å¯ä»¥çœ‹ä½œæ˜¯await()/countDown()ï¼Œå…·ä½“å®ç°ä¹Ÿæœ‰åŒºåˆ«ã€‚</p><pre><code>public void lock() {\n Â Â Â sync.acquire(1);\n}\npublic void unlock() {\n Â Â Â sync.release(1);\n}\n\n</code></pre><p>æ’é™¤æ‰ä¸€äº›ç»†èŠ‚ï¼Œæ•´ä½“åœ°åˆ†æacquireæ–¹æ³•é€»è¾‘ï¼Œå…¶ç›´æ¥å®ç°æ˜¯åœ¨AQSå†…éƒ¨ï¼Œè°ƒç”¨äº†tryAcquireå’ŒacquireQueuedï¼Œè¿™æ˜¯ä¸¤ä¸ªéœ€è¦ææ¸…æ¥šçš„åŸºæœ¬éƒ¨åˆ†ã€‚</p><pre><code>public final void acquire(int arg) {\n Â Â Â if (!tryAcquire(arg) &amp;&amp;\n Â Â Â Â Â Â Â acquireQueued(addWaiter(Node.EXCLUSIVE), arg))\n Â Â Â Â Â Â Â selfInterrupt();\n}\n</code></pre><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹tryAcquireã€‚åœ¨ReentrantLockä¸­ï¼ŒtryAcquireé€»è¾‘å®ç°åœ¨NonfairSyncå’ŒFairSyncä¸­ï¼Œåˆ†åˆ«æä¾›äº†è¿›ä¸€æ­¥çš„éå…¬å¹³æˆ–å…¬å¹³æ€§æ–¹æ³•ï¼Œè€ŒAQSå†…éƒ¨tryAcquireä»…ä»…æ˜¯ä¸ªæ¥è¿‘æœªå®ç°çš„æ–¹æ³•ï¼ˆç›´æ¥æŠ›å¼‚å¸¸ï¼‰ï¼Œè¿™æ˜¯ç•™ä¸ªå®ç°è€…è‡ªå·±å®šä¹‰çš„æ“ä½œã€‚</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¬å¹³æ€§åœ¨ReentrantLockæ„å»ºæ—¶å¦‚ä½•æŒ‡å®šçš„ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><pre><code>public ReentrantLock() {\n Â Â Â Â Â Â Â sync = new NonfairSync(); // é»˜è®¤æ˜¯éå…¬å¹³çš„\n Â Â Â }\n Â Â Â public ReentrantLock(boolean fair) {\n Â Â Â Â Â Â Â sync = fair ? new FairSync() : new NonfairSync();\n Â Â Â }\n\n</code></pre><p>ä»¥éå…¬å¹³çš„tryAcquireä¸ºä¾‹ï¼Œå…¶å†…éƒ¨å®ç°äº†å¦‚ä½•é…åˆçŠ¶æ€ä¸CASè·å–é”ï¼Œæ³¨æ„ï¼Œå¯¹æ¯”å…¬å¹³ç‰ˆæœ¬çš„tryAcquireï¼Œå®ƒåœ¨é”æ— äººå æœ‰æ—¶ï¼Œå¹¶ä¸æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–ç­‰å¾…è€…ï¼Œè¿™é‡Œä½“ç°äº†éå…¬å¹³çš„è¯­ä¹‰ã€‚</p><pre><code>final boolean nonfairTryAcquire(int acquires) {\n Â Â Â final Thread current = Thread.currentThread();\n Â Â Â int c = getState();// è·å–å½“å‰AQSå†…éƒ¨çŠ¶æ€é‡\n Â Â Â if (c == 0) { // 0è¡¨ç¤ºæ— äººå æœ‰ï¼Œåˆ™ç›´æ¥ç”¨CASä¿®æ”¹çŠ¶æ€ä½ï¼Œ\n Â Â Â \tif (compareAndSetState(0, acquires)) {// ä¸æ£€æŸ¥æ’é˜Ÿæƒ…å†µï¼Œç›´æ¥äº‰æŠ¢\n Â Â Â Â Â Â Â \tsetExclusiveOwnerThread(current); Â //å¹¶è®¾ç½®å½“å‰çº¿ç¨‹ç‹¬å é”\n Â Â Â Â Â Â Â \treturn true;\n Â Â Â \t}\n Â Â Â } else if (current == getExclusiveOwnerThread()) { //å³ä½¿çŠ¶æ€ä¸æ˜¯0ï¼Œä¹Ÿå¯èƒ½å½“å‰çº¿ç¨‹æ˜¯é”æŒæœ‰è€…ï¼Œå› ä¸ºè¿™æ˜¯å†å…¥é”\n Â Â Â \tint nextc = c + acquires;\n Â Â Â \tif (nextc &lt; 0) // overflow\n Â Â Â Â Â Â Â \tthrow new Error(&quot;Maximum lock count exceeded&quot;);\n Â Â Â \tsetState(nextc);\n Â Â Â \treturn true;\n\t}\n\treturn false;\n}\n</code></pre><p>æ¥ä¸‹æ¥æˆ‘å†æ¥åˆ†æacquireQueuedï¼Œå¦‚æœå‰é¢çš„tryAcquireå¤±è´¥ï¼Œä»£è¡¨ç€é”äº‰æŠ¢å¤±è´¥ï¼Œè¿›å…¥æ’é˜Ÿç«äº‰é˜¶æ®µã€‚è¿™é‡Œå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ï¼Œåˆ©ç”¨FIFOé˜Ÿåˆ—ï¼Œå®ç°çº¿ç¨‹é—´å¯¹é”çš„ç«äº‰çš„éƒ¨åˆ†ï¼Œç®—æ˜¯æ˜¯AQSçš„æ ¸å¿ƒé€»è¾‘ã€‚</p><p>å½“å‰çº¿ç¨‹ä¼šè¢«åŒ…è£…æˆä¸ºä¸€ä¸ªæ’ä»–æ¨¡å¼çš„èŠ‚ç‚¹ï¼ˆEXCLUSIVEï¼‰ï¼Œé€šè¿‡addWaiteræ–¹æ³•æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ã€‚acquireQueuedçš„é€»è¾‘ï¼Œç®€è¦æ¥è¯´ï¼Œå°±æ˜¯å¦‚æœå½“å‰èŠ‚ç‚¹çš„å‰é¢æ˜¯å¤´èŠ‚ç‚¹ï¼Œåˆ™è¯•å›¾è·å–é”ï¼Œä¸€åˆ‡é¡ºåˆ©åˆ™æˆä¸ºæ–°çš„å¤´èŠ‚ç‚¹ï¼›å¦åˆ™ï¼Œæœ‰å¿…è¦åˆ™ç­‰å¾…ï¼Œå…·ä½“å¤„ç†é€»è¾‘è¯·å‚è€ƒæˆ‘æ·»åŠ çš„æ³¨é‡Šã€‚</p><pre><code>final boolean acquireQueued(final Node node, int arg) {\n Â Â Â Â Â boolean interrupted = false;\n Â Â Â Â Â try {\n Â Â Â \tfor (;;) {// å¾ªç¯\n Â Â Â Â Â Â Â \tfinal Node p = node.predecessor();// è·å–å‰ä¸€ä¸ªèŠ‚ç‚¹\n Â Â Â Â Â Â Â \tif (p == head &amp;&amp; tryAcquire(arg)) { // å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¤´ç»“ç‚¹ï¼Œè¡¨ç¤ºå½“å‰èŠ‚ç‚¹åˆé€‚å»tryAcquire\n Â Â Â Â Â Â Â Â Â Â Â \tsetHead(node); // acquireæˆåŠŸï¼Œåˆ™è®¾ç½®æ–°çš„å¤´èŠ‚ç‚¹\n Â Â Â Â Â Â Â Â Â Â Â \tp.next = null; // å°†å‰é¢èŠ‚ç‚¹å¯¹å½“å‰èŠ‚ç‚¹çš„å¼•ç”¨æ¸…ç©º\n Â Â Â Â Â Â Â Â Â Â Â \treturn interrupted;\n Â Â Â Â Â Â Â \t}\n Â Â Â Â Â Â Â \tif (shouldParkAfterFailedAcquire(p, node)) // æ£€æŸ¥æ˜¯å¦å¤±è´¥åéœ€è¦park\n Â Â Â Â Â Â Â Â Â Â Â \tinterrupted |= parkAndCheckInterrupt();\n Â Â Â \t}\n Â Â Â Â Â Â } catch (Throwable t) {\n Â Â Â \tcancelAcquire(node);// å‡ºç°å¼‚å¸¸ï¼Œå–æ¶ˆ\n Â Â Â \tif (interrupted)\n Â Â Â Â Â Â Â \t Â Â Â selfInterrupt();\n Â Â Â \tthrow t;\n Â Â Â Â Â }\n}\n</code></pre><p>åˆ°è¿™é‡Œçº¿ç¨‹è¯•å›¾è·å–é”çš„è¿‡ç¨‹åŸºæœ¬å±•ç°å‡ºæ¥äº†ï¼ŒtryAcquireæ˜¯æŒ‰ç…§ç‰¹å®šåœºæ™¯éœ€è¦å¼€å‘è€…å»å®ç°çš„éƒ¨åˆ†ï¼Œè€Œçº¿ç¨‹é—´ç«äº‰åˆ™æ˜¯AQSé€šè¿‡Waiteré˜Ÿåˆ—ä¸acquireQueuedæä¾›çš„ï¼Œåœ¨releaseæ–¹æ³•ä¸­ï¼ŒåŒæ ·ä¼šå¯¹é˜Ÿåˆ—è¿›è¡Œå¯¹åº”æ“ä½œã€‚</p><p>ä»Šå¤©æˆ‘ä»‹ç»äº†Atomicæ•°æ®ç±»å‹çš„åº•å±‚æŠ€æœ¯CASï¼Œå¹¶é€šè¿‡å®ä¾‹æ¼”ç¤ºäº†å¦‚ä½•åœ¨äº§å“ä»£ç ä¸­åˆ©ç”¨CASï¼Œæœ€åä»‹ç»äº†å¹¶å‘åŒ…çš„åŸºç¡€æŠ€æœ¯AQSï¼Œå¸Œæœ›å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚</p><h2>ä¸€è¯¾ä¸€ç»ƒ</h2><p>å…³äºä»Šå¤©æˆ‘ä»¬è®¨è®ºçš„é¢˜ç›®ä½ åšåˆ°å¿ƒä¸­æœ‰æ•°äº†å—ï¼Ÿä»Šå¤©å¸ƒç½®ä¸€ä¸ªæºç é˜…è¯»ä½œä¸šï¼ŒAQSä¸­Nodeçš„waitStatusæœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</p><p>è¯·ä½ åœ¨ç•™è¨€åŒºå†™å†™ä½ å¯¹è¿™ä¸ªé—®é¢˜çš„æ€è€ƒï¼Œæˆ‘ä¼šé€‰å‡ºç»è¿‡è®¤çœŸæ€è€ƒçš„ç•™è¨€ï¼Œé€ç»™ä½ ä¸€ä»½å­¦ä¹ å¥–åŠ±ç¤¼åˆ¸ï¼Œæ¬¢è¿ä½ ä¸æˆ‘ä¸€èµ·è®¨è®ºã€‚</p><p>ä½ çš„æœ‹å‹æ˜¯ä¸æ˜¯ä¹Ÿåœ¨å‡†å¤‡é¢è¯•å‘¢ï¼Ÿä½ å¯ä»¥â€œè¯·æœ‹å‹è¯»â€ï¼ŒæŠŠä»Šå¤©çš„é¢˜ç›®åˆ†äº«ç»™å¥½å‹ï¼Œæˆ–è®¸ä½ èƒ½å¸®åˆ°ä»–ã€‚</p>","neighbors":{"left":{"article_title":"ç¬¬21è®² | Javaå¹¶å‘ç±»åº“æä¾›çš„çº¿ç¨‹æ± æœ‰å“ªå‡ ç§ï¼Ÿ åˆ†åˆ«æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ","id":9712},"right":{"article_title":"ç¬¬23è®² | è¯·ä»‹ç»ç±»åŠ è½½è¿‡ç¨‹ï¼Œä»€ä¹ˆæ˜¯åŒäº²å§”æ´¾æ¨¡å‹ï¼Ÿ","id":9946}},"comments":[{"had_liked":false,"id":13762,"user_name":"xuanyuan","can_delete":false,"product_type":"c1","uid":1113737,"ip_address":"","ucode":"1EC79B9372868F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI2icbib62icXtibTkThtyRksbuJLoTLMts7zook2S30MiaBtbz0f5JskwYicwqXkhpYfvCpuYkcvPTibEaQ/132","comment_is_top":false,"comment_ctime":1529975913,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"641480103017","product_id":100006701,"comment_content":"å»ºè®®ï¼›<br><br>1. å¸Œæœ›èƒ½æœ‰æ¨å¤–å†…å­˜çš„ä¸»é¢˜ï¼ŒèŒƒå‹éƒ¨åˆ†å¸Œæœ›èƒ½ä¸cppæ¯”è¾ƒè®²è§£ã€‚<br>2. ä¸€äº›ä¸»é¢˜å¦‚æœå·²ç»æœ‰å…¬å¼€çš„æ¯”è¾ƒå¥½çš„èµ„æ–™ï¼Œå¯ä»¥æä¾›é“¾æ¥ï¼Œå¯¹é‡ç‚¹å¼ºè°ƒå³å¯ã€‚å¸Œæœ›èƒ½çœ‹åˆ°æ›´å¤šå…¬å¼€èµ„æ–™æ‰€æ²¡æœ‰çš„ä¿¡æ¯ï¼Œè¿™ä¹Ÿæ˜¯è€é¸Ÿä»¬ä»˜è´¹çš„åˆè¡·ã€‚<br>åŒæ„çš„ç‚¹èµ","like_count":149,"discussions":[{"author":{"id":1144504,"avatar":"https://static001.geekbang.org/account/avatar/00/11/76/b8/e4cd7997.jpg","nickname":"KAGEMUSHA","note":"","ucode":"DFC05BE62A9C10","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":305386,"discussion_content":"å…¨å…³æ³¨è€é¸Ÿäº†ï¼Œè¿˜æé‚£&#34;ä¸cppæ¯”è¾ƒè®²è§£&#34;ã€&#34;æ›´å¤šå…¬å¼€èµ„æ–™æ‰€æ²¡æœ‰çš„ä¿¡æ¯&#34;ã€&#34;èœ»èœ“ç‚¹æ°´&#34;å‘¢ï¼Ÿï¼Ÿå­¦ä¹ ä¸å¤Ÿæ·±å…¥çš„åˆ°è¿™çœ‹å¾—éƒ½æ”¾å¼ƒäº†åŠé€€å¤šå°‘ã€‚æœ‰å¤šå°‘äººæ˜¯è¿‡äº†å¾ˆä¹…é è‡ªå­¦æ˜ç™½äº†ä¹‹åå†æ¥é‡æ–°æ¥åå¤çœ‹å¥½å‡ éæ‰ææ‡‚çš„ï¼Ÿè€é¸Ÿä»¬æƒ³çœ‹è™šæ‹Ÿæœºå¯ä»¥è®¢é˜…éš”å£å½“åˆå’Œè¿™ä¸ªä¸€èµ·çœ‹è®²çš„æ·±å…¥è™šæ‹Ÿæœºä¸“æ å•Šï¼Œä¸å¯èƒ½ä»€ä¹ˆæ°´å¹³ä¸åŒå±‚æ¬¡çš„éœ€æ±‚éƒ½åŒæ—¶æ»¡è¶³ã€‚åæ­£è¿™ä¸ªä¸“æ çš„è¯¾ç¨‹èƒ½ä¸”ä¹Ÿå°±ä¹Ÿåªèƒ½å¯¹å¾—èµ·è‡ªèº«å‡ åå—çš„ä»·æ ¼äº†","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1599904925,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1115128,"avatar":"https://static001.geekbang.org/account/avatar/00/11/03/f8/f98df0a7.jpg","nickname":"vaccywen","note":"","ucode":"077FDB50831921","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":47600,"discussion_content":"å’Œæˆ‘çš„æƒ³æ³•ä¸€æ ·ï¼Œä½†æ˜¯ä¼°è®¡ä¸ä¼šè®²è¿™äº›ï¼Œä¸ç„¶è¿™æœ¬ä¹¦çš„åå­—å°±è¯¥å«ã€ŠJVMåº•å±‚æŠ€æœ¯ã€‹","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1573378037,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1680042,"avatar":"https://static001.geekbang.org/account/avatar/00/19/a2/aa/a6a64c32.jpg","nickname":"è‚‰å›","note":"","ucode":"F64D7625E0F6F5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":272631,"discussion_content":"è¿™é—¨è¯¾çš„é£æ ¼å°±æ˜¯èœ»èœ“ç‚¹æ°´ã€æµ…å°è¾„æ­¢ï¼Œå¾ˆå¤šæ—¶å€™æ„Ÿè§‰ä½œè€…å°±æ˜¯åªæƒ³æŠ›ç –å¼•ç‰ï¼Œæ›´å¤šæ—¶å€™è§‰å¾—è¯„è®ºæ¯”æ­£æ–‡ç²¾å½©ï¼Œç„¶è€Œåé¢ç« èŠ‚çš„è¯„è®ºä¹Ÿè¶Šæ¥è¶Šå°‘ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1590329614,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":2286307,"avatar":"","nickname":"Geek_a25586","note":"","ucode":"3C3E949B0E0243","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1680042,"avatar":"https://static001.geekbang.org/account/avatar/00/19/a2/aa/a6a64c32.jpg","nickname":"è‚‰å›","note":"","ucode":"F64D7625E0F6F5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":322086,"discussion_content":"ç—›ç‚¹å°±æ˜¯åŸºç¡€è–„çœ‹å®Œä¸€è„¸æ‡µåŸºç¡€å¤Ÿçœ‹å®Œå‘ç°éƒ½æ˜¯å…¬å¼€èµ„æ–™ï¼Œåˆæ„Ÿè§‰æ²¡å•¥åŠ²ï¼Œå®šä½ä¸å‡†ï¼Œåˆ°åº•æ˜¯ç»™ä»€ä¹ˆæ®µä½çš„äººçœ‹çš„æ²¡æ‰¾å‡†ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1604672881,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":272631,"ip_address":""},"score":322086,"extra":""},{"author":{"id":1324314,"avatar":"https://static001.geekbang.org/account/avatar/00/14/35/1a/9fa38dc9.jpg","nickname":"å­ç»","note":"","ucode":"5C26FF10934534","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2286307,"avatar":"","nickname":"Geek_a25586","note":"","ucode":"3C3E949B0E0243","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351428,"discussion_content":"åŒæ„Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614264423,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":322086,"ip_address":""},"score":351428,"extra":""}]}]},{"had_liked":false,"id":19003,"user_name":"ipofss","can_delete":false,"product_type":"c1","uid":1018620,"ip_address":"","ucode":"DE3061C9259F9E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8a/fc/d1dd57dd.jpg","comment_is_top":false,"comment_ctime":1533638617,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"164742395865","product_id":100006701,"comment_content":"è¿™ä¸€è®²å¯¹äºæˆ‘æ¥è¯´ï¼ŒæŒºæœ‰éš¾åº¦çš„ï¼Œè¿˜æ˜¯åŸºç¡€æ¯”è¾ƒè–„å¼±ï¼Œæ•´ä½“ä¸Šæ²¡å¤ªå¬æ‡‚ã€‚è€å¸ˆå¯¹äºJavaçš„ç†è§£çœŸæ˜¯å¤ªæ·±å…¥äº†ï¼Œç­‰æˆ‘ä»¥åæŠ€æœ¯ç²¾è¿›äº†ï¼Œå†å›æ¥çœ‹çœ‹è€å¸ˆçš„36è®²ï¼Œåº”è¯¥ä¼šæœ‰æ–°çš„è®¤è¯†ã€‚ç»§ç»­å¾€ä¸‹å¬å§ï¼Œå·²ç»æ‡‚ç‚¹çš„åŠ æ·±ç†è§£ï¼Œæ²¡å¬è¿‡çš„å°±å½“æ˜¯å¬äº†åå­—ä»¥åç”¨åˆ°äº†å†ä»”ç»†ç ”ç©¶","like_count":38,"discussions":[{"author":{"id":1144504,"avatar":"https://static001.geekbang.org/account/avatar/00/11/76/b8/e4cd7997.jpg","nickname":"KAGEMUSHA","note":"","ucode":"DFC05BE62A9C10","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":305398,"discussion_content":"è¿™ä¸ªä¸“æ å°±æ˜¯è®²çš„å¾ˆæ™¦æ¶©æ¯”å¦‚è¿™ä¸ªæ–‡ç« é‡Œé¢çš„â€œæˆ‘ä»¬æ€ä¹ˆå®ç°é”æ“ä½œå‘¢ï¼Ÿ......å¯ä»¥å¹¶ä¸”æ¨èä½¿ç”¨ Variable Handle API å»å®ç°..â€é‚£æ®µç†è§£èµ·æ¥å¾ˆæ˜¯è´¹åŠ²å„¿ï¼Œè¦æœ‰ä¸€å®šç¨‹åº¦ä¸ŠæŒæ¡ç›¸å…³å†…å®¹æ‰èƒ½æ˜ç™½å’‹å›äº‹ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1599909021,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2283781,"avatar":"https://static001.geekbang.org/account/avatar/00/22/d9/05/0d772dbf.jpg","nickname":"å’¦","note":"","ucode":"2E0D5A488489A4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551874,"discussion_content":"æ ¡æ‹›åŸºç¡€å§ï¼Œå·®ä¸å¤š","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1645160270,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1640349,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEJgkiapuSqHlc6criaA8o4GtjCqiaREptvHcLcExFciaV1X2avib4EFoIq3SYA99nDgFERj8ZalgJjibzrA/132","nickname":"è–›å›½æ²»","note":"","ucode":"592627A673DDFA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":327993,"discussion_content":"è¿˜æ˜¯è¦æœ‰ç‚¹åŸºç¡€çš„ï¼Œç„¶åç»™ä½ ä¸²ä¸€ä¸‹ã€‚æˆ‘ä¹Ÿæ˜¯å¤ä¹ äº†å¾ˆå¤šå…¶ä»–çš„èµ„æ–™å†æ¥çœ‹çš„ï¼Œæ„Ÿè§‰è®²çš„ä¸é”™...","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606038046,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1144504,"avatar":"https://static001.geekbang.org/account/avatar/00/11/76/b8/e4cd7997.jpg","nickname":"KAGEMUSHA","note":"","ucode":"DFC05BE62A9C10","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":305399,"discussion_content":"æ„Ÿè§‰åƒåœ¨çŒœè°œè¯­ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1599909025,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":13771,"user_name":"I.am DZX","can_delete":false,"product_type":"c1","uid":1122095,"ip_address":"","ucode":"DBE2B7A50C423A","user_header":"https://static001.geekbang.org/account/avatar/00/11/1f/2f/e35d6a1d.jpg","comment_is_top":false,"comment_ctime":1529978166,"is_pvip":false,"replies":[{"id":"4649","content":"å¥½","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1530117401,"ip_address":"","comment_id":13771,"utype":1}],"discussion_count":1,"race_medal":0,"score":"117494095158","product_id":100006701,"comment_content":"CANCELLED 1 å› ä¸ºè¶…æ—¶æˆ–ä¸­æ–­è®¾ç½®ä¸ºæ­¤çŠ¶æ€ï¼Œæ ‡å¿—èŠ‚ç‚¹ä¸å¯ç”¨<br>SIGNAL -1 å¤„äºæ­¤çŠ¶æ€çš„èŠ‚ç‚¹é‡Šæ”¾èµ„æºæ—¶ä¼šå”¤é†’åé¢çš„èŠ‚ç‚¹<br>CONDITION -2 å¤„äºæ¡ä»¶é˜Ÿåˆ—é‡Œï¼Œç­‰å¾…æ¡ä»¶æˆç«‹(signal signalall) æ¡ä»¶æˆç«‹åä¼šç½®å…¥è·å–èµ„æºçš„é˜Ÿåˆ—é‡Œ<br>PROPAGATE -3 å…±äº«æ¨¡å¼ä¸‹ä½¿ç”¨ï¼Œå¤´èŠ‚ç‚¹è·å–èµ„æºæ—¶å°†åé¢èŠ‚ç‚¹è®¾ç½®ä¸ºæ­¤çŠ¶æ€ï¼Œå¦‚æœå¤´èŠ‚ç‚¹è·å–èµ„æºåè¿˜æœ‰è¶³å¤Ÿçš„èµ„æºï¼Œåˆ™åé¢èŠ‚ç‚¹ä¼šå°è¯•è·å–ï¼Œè¿™ä¸ªçŠ¶æ€ä¸»è¦æ˜¯ä¸ºäº†å…±äº«çŠ¶æ€ä¸‹é˜Ÿåˆ—é‡Œè¶³å¤Ÿå¤šçš„èŠ‚ç‚¹åŒæ—¶è·å–èµ„æº<br>0 åˆå§‹çŠ¶æ€","like_count":28,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419749,"discussion_content":"å¥½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1530117401,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":13818,"user_name":"Cui","can_delete":false,"product_type":"c1","uid":1106775,"ip_address":"","ucode":"169F6EEEEE7E5E","user_header":"https://static001.geekbang.org/account/avatar/00/10/e3/57/e5de0216.jpg","comment_is_top":false,"comment_ctime":1530000866,"is_pvip":false,"replies":[{"id":"4646","content":"Locksupportçš„å®ç°æ®è¯´é€Ÿåº¦å¿«ï¼Œæˆ‘ä¹Ÿæ²¡å…·ä½“å¯¹æ¯”è¿‡ï¼›ä¸è¿‡jdk9é‡Œï¼Œmonitorç›¸å…³æ“ä½œä¹ŸåŠ å¿«äº†ï¼Œå¯ä»¥çœ‹çœ‹jep143","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1530116979,"ip_address":"","comment_id":13818,"utype":1}],"discussion_count":6,"race_medal":1,"score":"78839412194","product_id":100006701,"comment_content":"è€å¸ˆï¼Œçœ‹äº†AQSçš„å®ç°åŸç†åï¼Œæˆ‘å†å›é¡¾äº†æ‚¨ä¹‹å‰å…³äºsynchronizedçš„æ–‡ç« ï¼Œå¿ƒä¸­æœ‰äº›ç–‘é—®ï¼š<br>1ã€synchronizedåœ¨JVMä¸­æ˜¯ä¼šè¿›è¡Œé”å‡çº§å’Œé™çº§çš„ï¼Œå¹¶ä¸”æ˜¯åŸºäºCASæ¥æŒæ¡ç«äº‰çš„æƒ…å†µï¼Œåœ¨ç«äº‰ä¸å¤šçš„æƒ…å†µä¸‹åˆ©ç”¨CASçš„è½»é‡çº§æ“ä½œæ¥å‡å°‘å¼€é”€ã€‚<br>2ã€è€ŒAQSä¹Ÿæ˜¯åŸºäºCASæ“ä½œé˜Ÿåˆ—çš„ï¼Œä½äºé˜Ÿåˆ—å¤´çš„èŠ‚ç‚¹ä¼˜å…ˆè·å¾—é”ï¼Œå…¶ä»–çš„èŠ‚ç‚¹ä¼šè¢«LockSupport.park()èµ·æ¥ï¼ˆè¿™ä¸ªå¥½åƒä¾èµ–çš„æ˜¯æ“ä½œç³»ç»Ÿçš„äº’æ–¥é”ï¼Œåº”è¯¥ä¹Ÿæ˜¯ä¸ªé‡é‡çº§æ“ä½œï¼‰ã€‚<br>æˆ‘è§‰å¾—è¿™ä¸¤ç§æ–¹å¼éƒ½æ˜¯åŸºäºCASæ“ä½œçš„ï¼Œåªæ˜¯æ“ä½œçš„å¯¹è±¡ä¸åŒï¼ˆä¸€ä¸ªæ˜¯Mark Wordï¼Œä¸€ä¸ªæ˜¯é˜Ÿåˆ—èŠ‚ç‚¹ï¼‰ï¼Œå½“ç«äº‰è¾ƒå¤šæ—¶ï¼Œè¿˜æ˜¯ä¸å¯é¿å…åœ°ä¼šä½¿ç”¨åˆ°æ“ä½œç³»ç»Ÿçš„äº’æ–¥é”ã€‚ç„¶è€Œï¼Œæˆ‘å†æµ‹è¯•è¿™ä¸¤è€…çš„æ€§èƒ½æ—¶ï¼Œåœ¨æ— ç«äº‰çš„æƒ…å†µä¸‹ï¼Œä¸¤è€…æ€§èƒ½ç›¸å½“ï¼Œä½†æ˜¯ï¼Œå½“ç«äº‰èµ·æ¥åï¼ŒAQSçš„æ€§èƒ½æ˜æ˜¾æ¯”synchronizedè¦å¥½ï¼ˆæµ‹è¯•æ¡ˆä¾‹æ˜¯8ä¸ªçº¿ç¨‹å¹¶å‘å¯¹ä¸€ä¸ªinté€’å¢ï¼Œæ¯ä¸ªçº¿ç¨‹é€’å¢1000ä¸‡æ¬¡ï¼ŒAQSçš„è€—æ—¶å¤§æ¦‚è¦å°‘30%ï¼‰ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ","like_count":18,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419768,"discussion_content":"Locksupportçš„å®ç°æ®è¯´é€Ÿåº¦å¿«ï¼Œæˆ‘ä¹Ÿæ²¡å…·ä½“å¯¹æ¯”è¿‡ï¼›ä¸è¿‡jdk9é‡Œï¼Œmonitorç›¸å…³æ“ä½œä¹ŸåŠ å¿«äº†ï¼Œå¯ä»¥çœ‹çœ‹jep143","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1530116979,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2052476,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Qq6oLfOTgKzjiculoUDicdv7WoY1iabPfOTumibWeInVP2Mnod9XVPrNSClvIiaLbvtDlIjRnWUNaXcYwREGzlcaDog/132","nickname":"Geek_åœ¨ä¸‹èŸ‘è‚ç‹","note":"","ucode":"E1F5BBB5BC5962","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290929,"discussion_content":"å™¢ï¼Ÿsynchronizedæ˜¯åŸºäºcasçš„ã€‚ğŸ˜°ğŸ˜°ğŸ˜°ğŸ˜°ğŸ˜°ğŸ˜°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594644759,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1442705,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/FmjAcibbIH7AH7Zwy5RZg6BMsjWTib8iaY6VhY7ibouZWWhpMX3RoJicgeiapUdK2iaSbatQYZFU3PdUPGjl5TqJnxTnQ/132","nickname":"è“ä¼½å›¾","note":"","ucode":"F2FBCE654E95B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":274956,"discussion_content":"æˆ‘è®¤çŸ¥çš„æ˜¯é”åªèƒ½å‡çº§ï¼Œä¸èƒ½é™çº§ï¼Œåå‘é”-> è½»é‡çº§é” -> é‡é‡çº§é”   è¿˜æœ›æŒ‡å‡ºé”é™çº§çš„çŸ¥è¯†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1590636908,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2330905,"avatar":"https://static001.geekbang.org/account/avatar/00/23/91/19/6a3e7efc.jpg","nickname":"ç¨‹åºå‘˜9527","note":"","ucode":"1A1609F6BEAD84","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1442705,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/FmjAcibbIH7AH7Zwy5RZg6BMsjWTib8iaY6VhY7ibouZWWhpMX3RoJicgeiapUdK2iaSbatQYZFU3PdUPGjl5TqJnxTnQ/132","nickname":"è“ä¼½å›¾","note":"","ucode":"F2FBCE654E95B4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385087,"discussion_content":"16è®²æœ‰è¯´åˆ°ï¼šé”é™çº§ç¡®å®æ˜¯ä¼šå‘ç”Ÿçš„ï¼Œå½“ JVM è¿›å…¥å®‰å…¨ç‚¹ï¼ˆSafePointï¼‰çš„æ—¶å€™ï¼Œä¼šæ£€æŸ¥æ˜¯å¦æœ‰é—²ç½®çš„ Monitorï¼Œç„¶åè¯•å›¾è¿›è¡Œé™çº§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626876449,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":274956,"ip_address":""},"score":385087,"extra":""}]},{"author":{"id":1330065,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/N0NACGUr8dNAbN6BdiagPHBaB0EnyDsI9zWpwJteqTY38apOEnTOA7JkBAQnzYKJBgxu3Q8YMUILwLAB6camn4w/132","nickname":"Swing","note":"","ucode":"55FCA9ECEFBBEB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":217735,"discussion_content":"casçš„åŸºç¡€æŠ€æœ¯ unsafeæ˜¯ç”¨æˆ·æ€ç›´æ¥ä½¿ç”¨ç‰¹æ®Šçš„cpuæŒ‡ä»¤æ“ä½œçš„ï¼Œæ²¡æœ‰ synchronizedé‡é‡çº§é”çš„ç”¨æˆ·æ€ã€å†…æ ¸æ€åˆ‡æ¢ï¼Œæ‰€ä»¥ ç«äº‰å‡ºç°æ—¶ï¼Œä¼šæœ‰æ˜æ˜¾å·®åˆ«ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585578484,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2029976,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/f9/98/53740221.jpg","nickname":"é½å¤§æŸ±","note":"","ucode":"694BBCA988C1DE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1330065,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/N0NACGUr8dNAbN6BdiagPHBaB0EnyDsI9zWpwJteqTY38apOEnTOA7JkBAQnzYKJBgxu3Q8YMUILwLAB6camn4w/132","nickname":"Swing","note":"","ucode":"55FCA9ECEFBBEB","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":292370,"discussion_content":"é¢˜ä¸»æ¯”è¾ƒçš„æ˜¯parkæ“ä½œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1595207397,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":217735,"ip_address":""},"score":292370,"extra":""}]}]},{"had_liked":false,"id":16042,"user_name":"OneThin","can_delete":false,"product_type":"c1","uid":1050458,"ip_address":"","ucode":"506989C201402F","user_header":"https://static001.geekbang.org/account/avatar/00/10/07/5a/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1531751035,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"65956260475","product_id":100006701,"comment_content":"èƒ½å¦å‡ºä¸€èŠ‚è®²ä¸€ä¸‹unsafeï¼Œæ„Ÿè§‰è¿™ä¸ªæ‰æ˜¯æœ€åŸºç¡€çš„ã€‚å¦å¤–unsafeä¸ºä»€ä¹ˆå«unsafeå‘¢","like_count":16,"discussions":[{"author":{"id":1040495,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/e0/6f/c0a17a5b.jpg","nickname":"ShawDa","note":"","ucode":"DFA4242EB39A4F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":291628,"discussion_content":"Javaé­”æ³•ç±»ï¼šUnsafeåº”ç”¨è§£æï¼ˆhttps://tech.meituan.com/2019/02/14/talk-about-java-magic-class-unsafe.htmlï¼‰","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1594891850,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1121459,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1c/b3/6d10ba4f.jpg","nickname":"Running Man","note":"","ucode":"4DD2F6AF71327E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":186600,"discussion_content":"å› ä¸ºè¿™æ ·ä½ æ‰è§‰å¾—ä¸å®‰å…¨æ‰€ä»¥ä¸ç”¨äº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1582697391,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2052476,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Qq6oLfOTgKzjiculoUDicdv7WoY1iabPfOTumibWeInVP2Mnod9XVPrNSClvIiaLbvtDlIjRnWUNaXcYwREGzlcaDog/132","nickname":"Geek_åœ¨ä¸‹èŸ‘è‚ç‹","note":"","ucode":"E1F5BBB5BC5962","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":336219,"discussion_content":"ä»åå­—å“ä½ä½ åˆ«åŠ¨é‡Œå¤´çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1608531740,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":13795,"user_name":"ä¸‰å£å…ˆç”Ÿ","can_delete":false,"product_type":"c1","uid":1117257,"ip_address":"","ucode":"8E8672321FE510","user_header":"https://static001.geekbang.org/account/avatar/00/11/0c/49/d71e939d.jpg","comment_is_top":false,"comment_ctime":1529984351,"is_pvip":false,"replies":[{"id":"4648","content":"ä¸é”™","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1530117357,"ip_address":"","comment_id":13795,"utype":1}],"discussion_count":1,"race_medal":0,"score":"65954493791","product_id":100006701,"comment_content":"å¤§äº0å–æ¶ˆçŠ¶æ€ï¼Œå°äº0æœ‰æ•ˆçŠ¶æ€ï¼Œè¡¨ç¤ºç­‰å¾…çŠ¶æ€å››ç§cancelledï¼Œsignalï¼Œconditionï¼Œpropagate","like_count":15,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419758,"discussion_content":"ä¸é”™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1530117357,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":279079,"user_name":"^_^","can_delete":false,"product_type":"c1","uid":2021212,"ip_address":"","ucode":"301EE75D170771","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/MdmRMTV2IwvQZF2IO0G0CFWbKxT9CIibmcdicS3J4SmrA4P1e36jCwyXZpia06ItwP4GibGnCrPJHicBbd5y9libTpiaA/132","comment_is_top":false,"comment_ctime":1613610465,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"31678381537","product_id":100006701,"comment_content":"è¦è®²AQSçš„è¯ï¼Œè¿™ç‚¹ç¯‡å¹…è¿œè¿œä¸å¤Ÿã€‚æ¨èbç«™å¯’é£Ÿå›AQSçš„è®²è§£ï¼Œå¾ˆè¯¦ç»†ã€‚","like_count":8,"discussions":[{"author":{"id":1637626,"avatar":"https://static001.geekbang.org/account/avatar/00/18/fc/fa/4608b70a.jpg","nickname":"yven","note":"","ucode":"72CA71F9A44AE8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578762,"discussion_content":"çœ‹è¿‡ï¼Œè¡¨ç¤ºä¸çŸ¥é“åœ¨è®²äº›ä»€ä¹ˆä¸œè¥¿ï¼Œæµæ°´è´¦å¼çš„è®²è®²æºç ç½¢äº†ï¼Œè¿˜ä¸€å †é”™è¯¯ã€‚ä¸ªäººæ¨èå¯ä»¥çœ‹çœ‹ç¾å›¢æŠ€æœ¯å›¢é˜Ÿçš„é‚£ç¯‡&lt;ä»ReentrantLockçš„å®ç°çœ‹AQSçš„åŸç†åŠåº”ç”¨&gt;","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1657000574,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":14039,"user_name":"äºŒæœ¨ğŸ¶","can_delete":false,"product_type":"c1","uid":1122361,"ip_address":"","ucode":"F2A88485ADBA6D","user_header":"https://static001.geekbang.org/account/avatar/00/11/20/39/3168c4ca.jpg","comment_is_top":false,"comment_ctime":1530149995,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"31594921067","product_id":100006701,"comment_content":"ä¸€ç›´å¾ˆå¥½å¥‡ï¼Œä¸ºä½•CASæŒ‡ä»¤åœ¨å‘ç°å†…å®¹æœªå˜çš„æ—¶å€™å°±èƒ½åˆ¤æ–­æ²¡æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹å‘¢ï¼Ÿå¯èƒ½è¢«ä¿®æ”¹åçš„å€¼ä¸æ¯”è¾ƒçš„å€¼ä¸€æ ·å‘€","like_count":7,"discussions":[{"author":{"id":2052476,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Qq6oLfOTgKzjiculoUDicdv7WoY1iabPfOTumibWeInVP2Mnod9XVPrNSClvIiaLbvtDlIjRnWUNaXcYwREGzlcaDog/132","nickname":"Geek_åœ¨ä¸‹èŸ‘è‚ç‹","note":"","ucode":"E1F5BBB5BC5962","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290930,"discussion_content":"ä½ è¿™ä¸å°±æ˜¯ç»å…¸çš„abaé—®é¢˜ä¹ˆã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1594644826,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2289255,"avatar":"https://static001.geekbang.org/account/avatar/00/22/ee/67/e97fea7d.jpg","nickname":"[ThumbsUp]","note":"","ucode":"428818387DE5F7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":325757,"discussion_content":"CASæŒ‡ä»¤å¹¶ä¸èƒ½è¿›è¡Œä¸Šè¿°åˆ¤æ–­å•Š...","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605426250,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1320592,"avatar":"https://static001.geekbang.org/account/avatar/00/14/26/90/f68608f3.jpg","nickname":"gwl","note":"","ucode":"24F334E9AC0313","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":168182,"discussion_content":"åŠ äº†ç‰ˆæœ¬","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581559993,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":14987,"user_name":"å¡æ–¯ç“¦å¾·","can_delete":false,"product_type":"c1","uid":1011332,"ip_address":"","ucode":"E944E5BC507D5C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6e/84/45a909a6.jpg","comment_is_top":false,"comment_ctime":1530786249,"is_pvip":false,"replies":[{"id":"5076","content":"ä¹Ÿè®¸ï¼Œè¿™ä¸ªæˆ‘ä¸çŸ¥é“å…·ä½“åŸå› ï¼Œçœ‹ä¸Šå»whileä¼šæ¯”forå¤šä¸€ä¸ªå˜é‡","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1530893692,"ip_address":"","comment_id":14987,"utype":1}],"discussion_count":2,"race_medal":0,"score":"23005622729","product_id":100006701,"comment_content":"è€å¸ˆè¯·æ•™ä¸ªé—®é¢˜ï¼ŒacquireQueuedçš„æºä»£ç ä¸­ï¼Œä½¿ç”¨forï¼ˆï¼›ï¼›ï¼‰åšäº†ä¸ªè‡ªæ—‹é”å§ï¼Œä½œè€…ä¸ºä»€ä¹ˆä¸ç”¨whileï¼ˆtrueï¼‰ï¼Œè¿™ç§æ–¹å¼å‘¢ï¼Œæ˜¯å› ä¸ºå¼€é”€ä¸ä¸€æ ·å—ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":420202,"discussion_content":"ä¹Ÿè®¸ï¼Œè¿™ä¸ªæˆ‘ä¸çŸ¥é“å…·ä½“åŸå› ï¼Œçœ‹ä¸Šå»whileä¼šæ¯”forå¤šä¸€ä¸ªå˜é‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1530893692,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1075038,"avatar":"https://static001.geekbang.org/account/avatar/00/10/67/5e/e0323566.jpg","nickname":"oyt","note":"","ucode":"E1E4F27FB3535F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":392800,"discussion_content":"javaä¸­æ²¡æœ‰åŒºåˆ«ï¼Œä»…ä»…æ˜¯ç¼–ç¨‹ä¹ æƒ¯çš„é—®é¢˜ï¼Œåœ¨javaä¸­äºŒè€…ç”Ÿæˆçš„å­—èŠ‚ç æ˜¯ä¸€æ ·çš„ã€‚javaæºç ä¸­åŸºæœ¬ä¸Šæ˜¯for(;;)çš„å†™æ³•ï¼Œä¸ªäººçŒœæµ‹æ˜¯å¤§ä½¬ä»¬éƒ½æ˜¯ä¼šcæˆ–c++çš„ï¼Œåœ¨è¿™äº›è¯­è¨€çš„ä¸€äº›ç‰ˆæœ¬ä¸­forå¯èƒ½ä¼šæ¯”while trueå°‘ä¸€äº›æŒ‡ä»¤ï¼Œä¹Ÿå¯èƒ½ä»…ä»…æ˜¯ä¹ æƒ¯äº†è¿™ç§å†™æ³•ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1631145060,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":79979,"user_name":"Geek_987169","can_delete":false,"product_type":"c1","uid":1180853,"ip_address":"","ucode":"4B2955A044805D","user_header":"https://static001.geekbang.org/account/avatar/00/12/04/b5/8bc4790b.jpg","comment_is_top":false,"comment_ctime":1553587119,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14438489007","product_id":100006701,"comment_content":"è€å¸ˆï¼Œæ‚¨è¯´çš„&quot;æ›´åŠ ç´§å‡‘&quot;ï¼Œæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿä¸å¤ªç†è§£","like_count":3},{"had_liked":false,"id":14077,"user_name":"é»„æ˜æ©","can_delete":false,"product_type":"c1","uid":1119409,"ip_address":"","ucode":"EF75C8BFA14D17","user_header":"https://static001.geekbang.org/account/avatar/00/11/14/b1/7d974f0a.jpg","comment_is_top":false,"comment_ctime":1530167885,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14415069773","product_id":100006701,"comment_content":"è€å¸ˆå¯å¦åˆ†æä¸‹Object.waitå’Œnotifyçš„åŸç†","like_count":3},{"had_liked":false,"id":13745,"user_name":"TonyEasy","can_delete":false,"product_type":"c1","uid":1115635,"ip_address":"","ucode":"CB455BA8915B64","user_header":"https://static001.geekbang.org/account/avatar/00/11/05/f3/4dd9e515.jpg","comment_is_top":false,"comment_ctime":1529974013,"is_pvip":false,"replies":[{"id":"4650","content":"å¤§å®¶åŸºç¡€ä¸ä¸€æ ·ï¼Œä»¥åè¢«é—®åˆ°ä¸ç”Ÿç–ä¹Ÿå¥½ï¼›å…³äºè·¯çº¿ï¼Œä¸çŸ¥é“ä½ çš„å…´è¶£å’Œè§„åˆ’æ˜¯ä»€ä¹ˆï¼Œé€šå¸¸æ¥è¯´Javaåªæ˜¯æŠ€èƒ½æ ‘ä¸­çš„ä¸€é¡¹ï¼Œé¡¹ç›®ç»éªŒï¼Œé¢†åŸŸçŸ¥è¯†ï¼Œç»¼åˆèµ·æ¥æ‰èƒ½è¦åˆ°é«˜ä»·","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1530117818,"ip_address":"","comment_id":13745,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14414875901","product_id":100006701,"comment_content":"è€å¸ˆï¼Œè¯´å®è¯è¿™ä¸€æœŸçš„å¯¹æˆ‘æ¥è¯´æœ‰ç‚¹éš¾åº¦äº†ï¼Œé’¦ä½©è€å¸ˆå¯¹çŸ¥è¯†ç†è§£çš„æ·±å…¥ï¼Œè¯·é—®è€å¸ˆå¯ä»¥æŒ‡ç‚¹ä¸‹javaå­¦ä¹ çš„è·¯çº¿å›¾å—ï¼Œæˆ–è€…æ‚¨åˆ†äº«ä¸‹æ‚¨è‡ªå·±çš„å­¦ä¹ è·¯çº¿ã€‚","like_count":3,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419740,"discussion_content":"å¤§å®¶åŸºç¡€ä¸ä¸€æ ·ï¼Œä»¥åè¢«é—®åˆ°ä¸ç”Ÿç–ä¹Ÿå¥½ï¼›å…³äºè·¯çº¿ï¼Œä¸çŸ¥é“ä½ çš„å…´è¶£å’Œè§„åˆ’æ˜¯ä»€ä¹ˆï¼Œé€šå¸¸æ¥è¯´Javaåªæ˜¯æŠ€èƒ½æ ‘ä¸­çš„ä¸€é¡¹ï¼Œé¡¹ç›®ç»éªŒï¼Œé¢†åŸŸçŸ¥è¯†ï¼Œç»¼åˆèµ·æ¥æ‰èƒ½è¦åˆ°é«˜ä»·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1530117818,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":170428,"user_name":"å¤©ç‹","can_delete":false,"product_type":"c1","uid":1239337,"ip_address":"","ucode":"C074B2F9A5F007","user_header":"https://static001.geekbang.org/account/avatar/00/12/e9/29/629d9bb0.jpg","comment_is_top":false,"comment_ctime":1578614165,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10168548757","product_id":100006701,"comment_content":"22 AutomicIntegeråŸç†æ˜¯ä»€ä¹ˆï¼ŒcasåŸç†ï¼Œcasæ“ä½œæ€ä¹ˆåº”ç”¨ 1 Automicæä¾›äº†å¯¹intç±»å‹çš„åŸå­æ“ä½œå’Œæ›´æ–°ï¼Œæ“ä½œåŸºäºcasåŸç†ï¼Œcaså…¨ç§°Compare and Swapï¼Œ casçš„åŸç†æ˜¯æ“ä½œå‰è¯•å›¾è·å–å½“å‰å€¼ï¼Œåœ¨æ“ä½œæ—¶ï¼Œçœ‹å€¼æ˜¯å¦æ”¹å˜ï¼Œå¦‚æœæœªæ”¹å˜ï¼Œä»£è¡¨æ²¡æœ‰å…¶ä»–çº¿ç¨‹åŒæ­¥ä¿®æ”¹ï¼Œæ“ä½œæˆåŠŸï¼Œå·²ç»æ”¹å˜ï¼Œè¿”å›æ“ä½œå¤±è´¥æˆ–è€…é‡è¯•ã€‚æœ‰2ä¸ªå±æ€§ jdk.internal.misc.Unsafe uï¼idk.internal.misc.Unsafe.getUnsafe(); volatile int value;Long VALUEï¼U.objectFiledOffset(AutomicInter.Class,&quot;value&quot;); Unsafeä¼šåˆ©ç”¨valueå­—æ®µçš„å†…å­˜åœ°å€åç§»å®Œæˆæ“ä½œ 2 casåº•å±‚å®ç° ä¾èµ–äºCPUåº•å±‚æä¾›çš„æŒ‡ä»¤ï¼Œjavaæä¾›äº†2ä¸ªå…¬å…±apiæ”¯æŒcasæ“ä½œï¼Œlong tidï¼Thread.currenThread().getId(); AutomicFiledUpdator.compareAndSet(this,0l,tid);AutomicåŒ…æä¾›äº†å¾ˆå¤šåŸå­å¤„ç†ç±»ï¼Œæ˜¯å¾ˆå¤šåŸå­æ“ä½œçš„é€‰æ‹©ï¼Œjava.9ä»¥åæä¾›äº† Variable Hand Apiï¼Œ private static final VarHandle handle é¦–å…ˆè·å–å¥æŸ„ï¼Œå†è°ƒç”¨casæ–¹æ³•ï¼Œæ¨èä½¿ç”¨Variable Handle Apiï¼Œåç»­ç»´æŠ¤æœ‰ä¿éšœï¼Œ3 AQS AbstractQueueSynchronized æ˜¯å®ç°å„ç§åŒæ­¥ç»“æ„çš„åŸºç¡€","like_count":2},{"had_liked":false,"id":13769,"user_name":"æäºŒæœ¨","can_delete":false,"product_type":"c1","uid":1103091,"ip_address":"","ucode":"30E03BB84ADB27","user_header":"https://static001.geekbang.org/account/avatar/00/10/d4/f3/129d6dfe.jpg","comment_is_top":false,"comment_ctime":1529977647,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"10119912239","product_id":100006701,"comment_content":"æœ€è¿‘é‡åˆ°é…ç½®tomcatè¿æ¥æ± ï¼Œå¯¼è‡´cpuè¿‡é«˜é—®é¢˜ï¼Œæœ€åå‘ç°é…ç½®è¿æ¥æ± æ•°è¿‡å¤§å¯¼è‡´ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°è¿‡å¤š<br>ï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹æ± ä¸­ä»»åŠ¡æ•°è¿‡å°‘ï¼Œç©ºé—²çš„çº¿ç¨‹è¿‡å¤šï¼Œæˆ‘æƒ³é—®ä¸ºä»€ä¹ˆä¼šå¯¼è‡´ä¸Šä¸‹æ–‡åˆ‡æ¢è¿‡å¤šï¼Ÿ","like_count":2},{"had_liked":false,"id":216350,"user_name":"Maxonor Love Muz ğŸˆ","can_delete":false,"product_type":"c1","uid":1131284,"ip_address":"","ucode":"C4648DCEBB5581","user_header":"https://static001.geekbang.org/account/avatar/00/11/43/14/8e2b48fb.jpg","comment_is_top":false,"comment_ctime":1589245689,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5884212985","product_id":100006701,"comment_content":"è€å¸ˆæŠŠåŸç†è®²çš„å·®ä¸å¤šäº†ï¼Œä¸è¿‡å…‰çœ‹åŸç†å°±ä»¥ä¸ºè‡ªå·±ä¼šäº†ï¼Œé‚£æ˜¯æµ…å±‚æ¬¡çš„ç†è§£ã€‚ æœ‰å¿…è¦ æŠŠAQSæºç èµ°ä¸€é","like_count":1},{"had_liked":false,"id":192703,"user_name":"æŠ¤çˆ½ä½¿è€…","can_delete":false,"product_type":"c1","uid":1275464,"ip_address":"","ucode":"12DC35DD74671C","user_header":"https://static001.geekbang.org/account/avatar/00/13/76/48/5ab89daa.jpg","comment_is_top":false,"comment_ctime":1584868953,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5879836249","product_id":100006701,"comment_content":"cas  æ˜¯ä¹è§‚é”ï¼Œwhile å¾ªç¯","like_count":1},{"had_liked":false,"id":192197,"user_name":"ä»Šå¤©","can_delete":false,"product_type":"c1","uid":1532354,"ip_address":"","ucode":"F8577A2BABCD1F","user_header":"https://static001.geekbang.org/account/avatar/00/17/61/c2/94c1d4c9.jpg","comment_is_top":false,"comment_ctime":1584842839,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5879810135","product_id":100006701,"comment_content":"å¬èµ·æ¥è¿˜æ˜¯å¾ˆæœ‰éš¾åº¦çš„ï¼Œæˆ‘åŸºç¡€æœ‰ç‚¹å·®","like_count":1},{"had_liked":false,"id":15291,"user_name":"ä¸ƒä¸ªçŒª","can_delete":false,"product_type":"c1","uid":1018003,"ip_address":"","ucode":"48F59BFA54D294","user_header":"https://static001.geekbang.org/account/avatar/00/0f/88/93/26076028.jpg","comment_is_top":false,"comment_ctime":1531096531,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5826063827","product_id":100006701,"comment_content":"CASæœ‰éƒ¨åˆ†å®ç°æ˜¯è§£å†³ABAé—®é¢˜ï¼Œå¯ä»¥è®²ä¸€ä¸‹ABAé—®é¢˜æ˜¯å¦‚ä½•è§£å†³çš„ï¼Œé™¤äº†versionå¤–ï¼Œè¿˜æœ‰æ²¡æœ‰å…¶ä»–çš„æ–¹å¼","like_count":1},{"had_liked":false,"id":14007,"user_name":"çˆ±æ–°è§‰ç½—è€æµæ°“","can_delete":false,"product_type":"c1","uid":1005661,"ip_address":"","ucode":"B13AC4DA358C15","user_header":"https://static001.geekbang.org/account/avatar/00/0f/58/5d/8de7f8dc.jpg","comment_is_top":false,"comment_ctime":1530114799,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5825082095","product_id":100006701,"comment_content":"ReentrantLockçš„éå…¬å¹³é”ï¼Œå…¶å®åªæœ‰ä¸€æ¬¡éå…¬å¹³çš„æœºä¼šï¼é‚£ä¸€æ¬¡å°±æ˜¯åœ¨lockæ–¹æ³•ä¸­ï¼Œéå…¬å¹³é”çš„å®ç°æœ‰if elseåˆ†æ”¯ï¼Œåœ¨ifæ—¶å°±è¿›è¡Œä¸€æ¬¡cas stateï¼ŒæˆåŠŸçš„çº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ä»£ç å»äº†ã€‚é‚£ä¹ˆå¤±è´¥çš„çº¿ç¨‹å°±ä¼šè¿›å…¥elseé€»è¾‘ï¼Œå°±æ˜¯AQS#acquiredï¼Œä»è¿™é‡Œå¼€å§‹éå…¬å¹³é”å’Œå…¬å¹³é”å°±å®Œå…¨ä¸€æ ·äº†ï¼Œåªæ˜¯å…¬å¹³é”è¢«æ¬ºè´Ÿäº†ä¸€æ¬¡ï¼Œå®ƒçš„lockæ–¹æ³•æ˜¯ç›´æ¥è°ƒacquiredæ–¹æ³•ã€‚<br><br>ä¸ºä»€ä¹ˆåªæœ‰è¿™ä¸€æ¬¡å‘¢ï¼Ÿå…ˆçœ‹AQS#acquiredï¼Œç¬¬ä¸€ä¸ªé€»è¾‘æ˜¯tryAcquiredï¼Œå…¬å¹³é”å’Œéå…¬å¹³é”å®ç°ç•¥æœ‰åŒºåˆ«ã€‚ä½†è®°ä½ï¼Œåœ¨è¿™ä¸ªæ—¶åˆ»ä¸‹ï¼Œå³ä½¿ä½ çœ‹åˆ°å…¬å¹³é”trtAcquiredå®ç°ä¸­å¤šä¸€ä¸ªhasQueuedPredecessorsåˆ¤æ–­ï¼Œæ— å…³ç´§è¦ï¼Œé‡è¦çš„æ˜¯è¿™ä¸ªæ—¶åˆ»ï¼Œè¿˜æ²¡æœ‰æ‰§è¡Œåé¢çš„addWaiteré€»è¾‘ï¼Œæ ¹æœ¬æ²¡æœ‰å…¥é˜Ÿï¼Œé‚£ä¹ˆå…¬å¹³é”è¿›å…¥è¿™ä¸ªhasXXXæ–¹æ³•ï¼Œå½“ç„¶ä¹Ÿæ˜¯é©¬ä¸Šå‡ºæ¥ï¼Œæ‰§è¡Œåé¢çš„cas stateï¼Œè·Ÿéå…¬å¹³é”æ²¡æœ‰ä¸åŒ...<br><br>å¦‚æœï¼ŒAQS#acquiredçš„ç¬¬ä¸€ä¸ªtryAcquiredå¤±è´¥äº†ï¼Œéƒ½ä¼šè¿›å…¥acquiredQueuedï¼Œæ­¤æ–¹æ³•ä¸­æœ‰ä¸ªå¼ºåˆ¶çš„é€»è¾‘ï¼Œå°±æ˜¯æ— é™forå¾ªç¯ä¸­çš„ final Node p = node.predecessors(); åœ¨è¿™ä¸ªé€»è¾‘ä¸‹ï¼Œéå¹³é”é”ä¹Ÿè¦ä¹–ä¹–æ’é˜Ÿ......<br><br>ä»¥ä¸Šåªæ˜¯åˆ†æäº†lockæ–¹æ³•ï¼Œå¸¦è¶…æ—¶çš„tryLockæ–¹æ³•è¿˜æ²¡æœ‰å…·ä½“çœ‹ä»£ç ã€‚å¦‚æœæˆ‘çš„lockåˆ†ææœ‰è¯¯ï¼Œæ¬¢è¿æŒ‡å‡ºæ‰¹è¯„ï¼","like_count":1,"discussions":[{"author":{"id":1118847,"avatar":"https://static001.geekbang.org/account/avatar/00/11/12/7f/bf020fea.jpg","nickname":"æ‡’å†¬å°†è‡³","note":"","ucode":"CE6E029EBC6CC6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":35416,"discussion_content":"åœ¨ReentrantLockå†…éƒ¨acquiredè°ƒç”¨çš„tryAcquireæ–¹æ³•ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„å•Šï¼Œå…¬å¹³é”çš„tryAcquireä¼šè°ƒç”¨hasQueuedPredecessors()","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571277675,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":13791,"user_name":"antipas","can_delete":false,"product_type":"c1","uid":1039798,"ip_address":"","ucode":"7F95F697D607C2","user_header":"https://static001.geekbang.org/account/avatar/00/0f/dd/b6/fcf322a7.jpg","comment_is_top":false,"comment_ctime":1529983648,"is_pvip":false,"replies":[{"id":"4647","content":"è¿™æ˜¯ä¸¤ç§æ–¹å¼ï¼ŒwaitåŸºäºmonitorï¼›ä¸€èˆ¬ç”¨å¹¶å‘åº“å°±ä¸ç”¨Object.waitã€notifyä¹‹ç±»äº†","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1530117120,"ip_address":"","comment_id":13791,"utype":1}],"discussion_count":2,"race_medal":0,"score":"5824950944","product_id":100006701,"comment_content":"çœ‹AQSæºç è¿‡ç¨‹ä¸­äº§ç”Ÿäº†æ–°é—®é¢˜ï¼Œå®ƒå¯¹çº¿ç¨‹çš„æŒ‚èµ·å”¤é†’æ˜¯é€šè¿‡locksupportå®ç°çš„ï¼Œé‚£ä¹ˆå®ƒä¸wait&#47;notifyåˆæœ‰ä½•ä¸åŒï¼Œä½¿ç”¨åœºæ™¯æœ‰ä½•ä¸åŒã€‚æˆ‘çš„ç†è§£æ˜¯ä½¿ç”¨ wait&#47;notifyéœ€è¦synchronizedé”ï¼Œè€Œä¸”waitéœ€è¦æ¡ä»¶è§¦å‘","like_count":1,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":419756,"discussion_content":"è¿™æ˜¯ä¸¤ç§æ–¹å¼ï¼ŒwaitåŸºäºmonitorï¼›ä¸€èˆ¬ç”¨å¹¶å‘åº“å°±ä¸ç”¨Object.waitã€notifyä¹‹ç±»äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1530117120,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2059155,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/6b/93/bfda2d1c.jpg","nickname":"æ¢¦æ±Ÿ","note":"","ucode":"B5FD2835863460","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":307004,"discussion_content":"ä¸ºä»€ä¹ˆunsafeä¸åŠ volatile","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600448168,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":310598,"user_name":"å’¦","can_delete":false,"product_type":"c1","uid":2283781,"ip_address":"","ucode":"2E0D5A488489A4","user_header":"https://static001.geekbang.org/account/avatar/00/22/d9/05/0d772dbf.jpg","comment_is_top":false,"comment_ctime":1630764998,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1630764998","product_id":100006701,"comment_content":"å»ºè®®CASç³»åˆ—å¯ä»¥è®²åˆ°æ“ä½œç³»ç»Ÿå®ç°åŸç†ï¼Œè¿™æ ·æ•´ä½“æ›´åŠ è¿è´¯ä¸€äº›","like_count":0},{"had_liked":false,"id":291438,"user_name":"å•Šè‰¯æ¢“æ˜¯æˆ‘","can_delete":false,"product_type":"c1","uid":1655117,"ip_address":"","ucode":"E42FC1A60D331C","user_header":"https://static001.geekbang.org/account/avatar/00/19/41/4d/f6d6d13a.jpg","comment_is_top":false,"comment_ctime":1620288273,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1620288273","product_id":100006701,"comment_content":"æˆ‘çœ‹äº†ä¸€ä¸‹æºç   å¥½åƒacquireQueued(final Node node, int arg) æ–¹æ³•é‡Œé¢çš„å¾ªç¯é€’å½’æ¡ä»¶å¥½åƒæ˜¯åœ¨shouldParkAfterFailedAcquire(p, node) æ–¹æ³•é‡Œé¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":183154,"user_name":"ç»ˆç»“è€…999å·","can_delete":false,"product_type":"c1","uid":1055854,"ip_address":"","ucode":"33ADE61580B6DD","user_header":"https://static001.geekbang.org/account/avatar/00/10/1c/6e/6c5f5734.jpg","comment_is_top":false,"comment_ctime":1582962839,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1582962839","product_id":100006701,"comment_content":"ä»CASåˆ°AQSï¼Œå¯ä»¥è¯´AQSæ˜¯é å¤§é‡CASæ“ä½œæ¥è¿›è¡Œçš„ï¼Œä»¥ä¾¿å®Œæˆå„ç§åŒæ­¥éœ€æ±‚ã€‚ä½†æ˜¯åœ¨è‡ªå·±äº§å“ä¸­å¦‚ä½•ä½¿ç”¨CASæ›´å¤šæ˜¯é å„ç§åŒæ­¥åŒ…ä¸­çš„åŒæ­¥å®¹å™¨ï¼Ÿ","like_count":0},{"had_liked":false,"id":155585,"user_name":"Paul Shan","can_delete":false,"product_type":"c1","uid":1593140,"ip_address":"","ucode":"32D99989028284","user_header":"","comment_is_top":false,"comment_ctime":1574716261,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574716261","product_id":100006701,"comment_content":"CASé€‚ç”¨çš„åœºæ™¯æ˜¯å¤šæ•°ä¿®æ”¹éƒ½æˆåŠŸï¼Œå°‘æ•°ä¸æˆåŠŸçš„ä¿®æ”¹é å¢åŠ CPUæ¥è½®è¯¢ï¼Œä¹Ÿå°±æ˜¯è¯´åªæœ‰CPUè½®è¯¢ä»˜å‡ºçš„ä»£ä»·è¶³å¤Ÿå°æ‰ç»æµã€‚","like_count":0},{"had_liked":false,"id":153556,"user_name":"prepared","can_delete":false,"product_type":"c1","uid":1194853,"ip_address":"","ucode":"00E54A5C7CDCBE","user_header":"https://static001.geekbang.org/account/avatar/00/12/3b/65/3a4fc8cf.jpg","comment_is_top":false,"comment_ctime":1574257942,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1574257942","product_id":100006701,"comment_content":"è¡Œå°¾æ³¨é‡Šä¸å»ºè®®å§","like_count":0,"discussions":[{"author":{"id":2330905,"avatar":"https://static001.geekbang.org/account/avatar/00/23/91/19/6a3e7efc.jpg","nickname":"ç¨‹åºå‘˜9527","note":"","ucode":"1A1609F6BEAD84","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":385088,"discussion_content":"æ˜¯çš„ï¼Œç¬¬ä¸€ï¼šä»£ç å’Œæ³¨é‡Šæ··åœ¨ä¸€èµ·äº†ï¼Œæ³¨é‡Šæ˜¯æ³¨é‡Šï¼Œä»£ç æ˜¯ä»£ç ï¼Œåº”è¯¥åˆ†å¼€\nç¬¬äºŒï¼šå¦‚æœä»£ç å¾ˆé•¿ï¼Œåé¢å†å¸¦æ³¨é‡Šï¼Œå±å¹•å°ï¼Œå°±éœ€è¦å·¦å³æ»‘åŠ¨äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626877186,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":141363,"user_name":"äº®ç¯","can_delete":false,"product_type":"c1","uid":1053532,"ip_address":"","ucode":"C06505ED58A0E5","user_header":"","comment_is_top":false,"comment_ctime":1571145171,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1571145171","product_id":100006701,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼Œ shouldParkAfterFailedAcquireè¡¨ç¤ºæ˜¯å¦æŒ‚èµ·å½“å‰çº¿ç¨‹ï¼Œä¸ºä»€ä¹ˆè¦æœ‰è¿™ä¸ªåˆ¤æ–­ï¼Ÿè¿™ä¸ªåˆ¤æ–­æœ‰ä»€ä¹ˆç”¨ï¼Ÿ","like_count":0},{"had_liked":false,"id":110044,"user_name":"æµå…‰","can_delete":false,"product_type":"c1","uid":1434612,"ip_address":"","ucode":"2B41D1B890018D","user_header":"https://static001.geekbang.org/account/avatar/00/15/e3/f4/ecb33aef.jpg","comment_is_top":false,"comment_ctime":1562158147,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1562158147","product_id":100006701,"comment_content":"è€å¸ˆ,æ‚¨çš„å€’æ•°ç¬¬äºŒä¸ªæ–¹æ³•æ˜¯éå…¬å¹³è¯´çš„è·å–æ–¹æ³•æ²¡é—®é¢˜,æœ€åçš„acquireQueued()æ˜¯å…¬å¹³é”çš„è·å–æ–¹æ³•,å‰å¤©é¢è¯•å°±è¢«é¢è¯•å®˜å–·äº†","like_count":0,"discussions":[{"author":{"id":1079811,"avatar":"https://static001.geekbang.org/account/avatar/00/10/7a/03/c9b43b21.jpg","nickname":"BewhY","note":"","ucode":"4BC26D47A79967","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":12856,"discussion_content":"é‚£ä½ ä»¬é¢è¯•å®˜çš„æ°´å‡†å¤ªä½äº†ï¼Œä½ ç›´æ¥è¯´è¿™æ˜¯Oracleé¦–å¸­å·¥ç¨‹å¸ˆè·Ÿæˆ‘è¿™æ ·è¯´çš„ä¸å°±è¡Œäº†","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1568602980,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1316834,"avatar":"https://static001.geekbang.org/account/avatar/00/14/17/e2/3df248b9.jpg","nickname":"zhs","note":"","ucode":"83F5BC121F6A91","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":320003,"discussion_content":"FairSyncå’ŒNonfairSyncéƒ½æ²¡é‡å†™acquireï¼ŒAQSçš„acquireè°ƒç”¨äº†tryAcquireå’ŒacquireQueuedï¼Œæ€ä¹ˆå°±æˆäº†acquireQueuedæ˜¯å…¬å¹³é”çš„å‘¢ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604224161,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":90721,"user_name":"Pine","can_delete":false,"product_type":"c1","uid":1132176,"ip_address":"","ucode":"EE78C1D27D9F6B","user_header":"https://static001.geekbang.org/account/avatar/00/11/46/90/a2b206e9.jpg","comment_is_top":false,"comment_ctime":1556616775,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556616775","product_id":100006701,"comment_content":"è¯·æ•™è€å¸ˆä¸€ä¸ªé—®é¢˜ï¼ŒåŸºæœ¬ç±»å‹å‰é¢åŠ volatileï¼Œå¤§æ¦‚èƒ½æ˜ç™½ä»€ä¹ˆæ„æ€ã€‚ å¯åŠ åœ¨å¼•ç”¨ç±»å‹å‰é¢å°±ä¸æ˜¯å¾ˆæ˜ç™½äº†ï¼Ÿ","like_count":0},{"had_liked":false,"id":90271,"user_name":"å¤šè¥„ä¸¸","can_delete":false,"product_type":"c1","uid":1074310,"ip_address":"","ucode":"1AA1497C5A293C","user_header":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","comment_is_top":false,"comment_ctime":1556463901,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556463901","product_id":100006701,"comment_content":"å…³äºçŠ¶æ€çš„å…¶ä»–ç«¥é‹å·²ç»è¯´å•¦ï¼Œ  <br><br>AQSçš„Nodeä¸­åŒ…å«äº† Threadå’ŒwaitStatusï¼Œä¹Ÿå°±æ˜¯é“¾è¡¨ä¸­éœ€è¦è·å–é”çš„çº¿ç¨‹å§ï½ï¼","like_count":0},{"had_liked":false,"id":63709,"user_name":"ylw666","can_delete":false,"product_type":"c1","uid":1161301,"ip_address":"","ucode":"11BDAB1AF981B3","user_header":"https://static001.geekbang.org/account/avatar/00/11/b8/55/f982a2fb.jpg","comment_is_top":false,"comment_ctime":1548471651,"is_pvip":false,"replies":[{"id":"23342","content":"ç´§å‡‘å°±æ˜¯è¯´å†…å­˜ä½¿ç”¨æ•ˆç‡ï¼Œæœ‰äº›é«˜æ€§èƒ½åº”ç”¨ä¼šå¯¹æ­¤æå‡ºè‹›åˆ»è¦æ±‚","user_name":"ä½œè€…å›å¤","user_name_real":"æ¨æ™“å³°","uid":"1009360","ctime":1549817721,"ip_address":"","comment_id":63709,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1548471651","product_id":100006701,"comment_content":"LongAdderè¿™é‡Œï¼Œè¯´è¦è€ƒè™‘ç´§å‡‘æ€§çš„å½±å“ï¼Œä¸æ¸…æ¥šæŒ‡çš„æ˜¯å“ªæ–¹é¢çš„è€ƒè™‘","like_count":0,"discussions":[{"author":{"id":1009360,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/66/d0/6541f1d5.jpg","nickname":"æ¨æ™“å³°","note":"","ucode":"2BF255467A978F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437690,"discussion_content":"ç´§å‡‘å°±æ˜¯è¯´å†…å­˜ä½¿ç”¨æ•ˆç‡ï¼Œæœ‰äº›é«˜æ€§èƒ½åº”ç”¨ä¼šå¯¹æ­¤æå‡ºè‹›åˆ»è¦æ±‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1549817721,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":39786,"user_name":"çº¦ä¹¦äºš","can_delete":false,"product_type":"c1","uid":1046714,"ip_address":"","ucode":"81EA27ADD9EC1A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f8/ba/14e05601.jpg","comment_is_top":false,"comment_ctime":1542356814,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1542356814","product_id":100006701,"comment_content":"å…¨å±€æœ€çœ‹ä¸æ‡‚çš„cancelAcquireæ–¹æ³•æ²¡è¯´...","like_count":0,"discussions":[{"author":{"id":2938089,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/V71ITElU4RwprR74pPXB6LhIMrfeAHuHjicZmS7smy2tibBSMoA9awaTe86wziatYzoy3qVOGs0DnSTy6ah5L6bKA/132","nickname":"å››å–œä¸¸å­","note":"","ucode":"33D46CC1B747BA","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576588,"discussion_content":"+1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655690859,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":28276,"user_name":"dal136","can_delete":false,"product_type":"c1","uid":1068814,"ip_address":"","ucode":"820EF448AAB49B","user_header":"https://static001.geekbang.org/account/avatar/00/10/4f/0e/00182147.jpg","comment_is_top":false,"comment_ctime":1538039514,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1538039514","product_id":100006701,"comment_content":"waitStatusæœ‰5ç§çŠ¶æ€ï¼š<br>SIGNALï¼Œ-1ï¼Œéœ€è¦unpark<br>CONDITIONï¼Œ-2,ç­‰å¾…condition<br>PROPAGATEï¼Œ-3, å…±äº«æ¨¡å¼ä¸­çº¿ç¨‹å¤„äºå¯è¿è¡ŒçŠ¶æ€<br>CANCELLEDï¼Œ1ï¼Œå–æ¶ˆ<br>0ï¼Œéä»¥ä¸Šä»»ä½•çŠ¶æ€","like_count":0}]}