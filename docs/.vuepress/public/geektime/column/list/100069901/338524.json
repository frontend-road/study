{"id":338524,"title":"05 | é‰´æƒï¼šå¦‚ä½•ä¿æŠ¤ä½ çš„æ•°æ®å®‰å…¨ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å”èªã€‚</p><p>ä¸çŸ¥é“ä½ æœ‰æ²¡æœ‰è¿‡è¿™æ ·çš„å›°æƒ‘ï¼Œå½“ä½ ä½¿ç”¨etcdå­˜å‚¨ä¸šåŠ¡æ•æ„Ÿæ•°æ®ã€å¤šç§Ÿæˆ·å…±äº«ä½¿ç”¨åŒetcdé›†ç¾¤çš„æ—¶å€™ï¼Œåº”è¯¥å¦‚ä½•é˜²æ­¢åŒ¿åç”¨æˆ·è®¿é—®ä½ çš„etcdæ•°æ®å‘¢ï¼Ÿå¤šç§Ÿæˆ·åœºæ™¯åˆå¦‚ä½•æœ€å°åŒ–ç”¨æˆ·æƒé™åˆ†é…ï¼Œé˜²æ­¢è¶Šæƒè®¿é—®çš„ï¼Ÿ</p><p>etcdé‰´æƒæ¨¡å—å°±æ˜¯ä¸ºäº†è§£å†³ä»¥ä¸Šç—›ç‚¹è€Œç”Ÿã€‚</p><p>é‚£ä¹ˆetcdæ˜¯å¦‚ä½•å®ç°å¤šç§é‰´æƒæœºåˆ¶å’Œç»†ç²’åº¦çš„æƒé™æ§åˆ¶çš„ï¼Ÿåœ¨å®ç°é‰´æƒæ¨¡å—çš„è¿‡ç¨‹ä¸­æœ€æ ¸å¿ƒçš„æŒ‘æˆ˜æ˜¯ä»€ä¹ˆï¼Ÿåˆè¯¥å¦‚ä½•ç¡®ä¿é‰´æƒçš„å®‰å…¨æ€§ä»¥åŠæå‡é‰´æƒæ€§èƒ½å‘¢ï¼Ÿ</p><p>ä»Šå¤©è¿™èŠ‚è¯¾ï¼Œæˆ‘å°†ä¸ºä½ ä»‹ç»etcdçš„é‰´æƒæ¨¡å—ï¼Œæ·±å…¥å‰–æetcdå¦‚ä½•è§£å†³ä¸Šé¢çš„è¿™äº›ç—›ç‚¹å’ŒæŒ‘æˆ˜ã€‚å¸Œæœ›é€šè¿‡è¿™èŠ‚è¯¾ï¼Œå¸®åŠ©ä½ æŒæ¡etcdé‰´æƒæ¨¡å—çš„è®¾è®¡ã€å®ç°ç²¾è¦ï¼Œäº†è§£å„ç§é‰´æƒæ–¹æ¡ˆçš„ä¼˜ç¼ºç‚¹ã€‚ä½ èƒ½åœ¨å®é™…åº”ç”¨ä¸­ï¼Œæ ¹æ®è‡ªå·±çš„ä¸šåŠ¡åœºæ™¯ã€å®‰å…¨è¯‰æ±‚ï¼Œé€‰æ‹©åˆé€‚çš„æ–¹æ¡ˆä¿æŠ¤ä½ çš„etcdæ•°æ®å®‰å…¨ã€‚åŒæ—¶ï¼Œä½ ä¹Ÿå¯ä»¥å‚è€ƒå…¶è®¾è®¡ã€å®ç°æ€æƒ³åº”ç”¨åˆ°è‡ªå·±ä¸šåŠ¡çš„é‰´æƒç³»ç»Ÿä¸Šã€‚</p><h2>æ•´ä½“æ¶æ„</h2><p>åœ¨è¯¦ç»†ä»‹ç»etcdçš„è®¤è¯ã€é‰´æƒå®ç°ç»†èŠ‚ä¹‹å‰ï¼Œæˆ‘å…ˆç»™ä½ ä»æ•´ä½“ä¸Šä»‹ç»ä¸‹etcdé‰´æƒä½“ç³»ã€‚</p><p>etcdé‰´æƒä½“ç³»æ¶æ„ç”±æ§åˆ¶é¢å’Œæ•°æ®é¢ç»„æˆã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/30/4e/304257ac790aeda91616bfe42800364e.png?wh=1920*420\" alt=\"\"></p><p>ä¸Šå›¾æ˜¯æ˜¯etcdé‰´æƒä½“ç³»æ§åˆ¶é¢ï¼Œä½ å¯ä»¥é€šè¿‡å®¢æˆ·ç«¯å·¥å…·etcdctlå’Œé‰´æƒAPIåŠ¨æ€è°ƒæ•´è®¤è¯ã€é‰´æƒè§„åˆ™ï¼ŒAuthServeræ”¶åˆ°è¯·æ±‚åï¼Œä¸ºäº†ç¡®ä¿å„èŠ‚ç‚¹é—´é‰´æƒå…ƒæ•°æ®ä¸€è‡´æ€§ï¼Œä¼šé€šè¿‡Raftæ¨¡å—è¿›è¡Œæ•°æ®åŒæ­¥ã€‚</p><!-- [[[read_end]]] --><p>å½“å¯¹åº”çš„Raftæ—¥å¿—æ¡ç›®è¢«é›†ç¾¤åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹ç¡®è®¤åï¼ŒApplyæ¨¡å—é€šè¿‡é‰´æƒå­˜å‚¨(AuthStore)æ¨¡å—ï¼Œæ‰§è¡Œæ—¥å¿—æ¡ç›®çš„å†…å®¹ï¼Œå°†è§„åˆ™å­˜å‚¨åˆ°boltdbçš„ä¸€ç³»åˆ—â€œé‰´æƒè¡¨â€é‡Œé¢ã€‚</p><p>ä¸‹å›¾æ˜¯æ•°æ®é¢é‰´æƒæµç¨‹ï¼Œç”±è®¤è¯å’Œæˆæƒæµç¨‹ç»„æˆã€‚è®¤è¯çš„ç›®çš„æ˜¯æ£€æŸ¥clientçš„èº«ä»½æ˜¯å¦åˆæ³•ã€é˜²æ­¢åŒ¿åç”¨æˆ·è®¿é—®ç­‰ã€‚ç›®å‰etcdå®ç°äº†ä¸¤ç§è®¤è¯æœºåˆ¶ï¼Œåˆ†åˆ«æ˜¯å¯†ç è®¤è¯å’Œè¯ä¹¦è®¤è¯ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/2c/55/2c8f90fd1a30fab9b9a88ba18c24c555.png?wh=1920*1136\" alt=\"\"></p><p>è®¤è¯é€šè¿‡åï¼Œä¸ºäº†æé«˜å¯†ç è®¤è¯æ€§èƒ½ï¼Œä¼šåˆ†é…ä¸€ä¸ªTokenï¼ˆç±»ä¼¼æˆ‘ä»¬ç”Ÿæ´»ä¸­çš„é—¨ç¥¨ã€é€šä¿¡è¯ï¼‰ç»™clientï¼Œclientåç»­å…¶ä»–è¯·æ±‚æºå¸¦æ­¤Tokenï¼Œserverå°±å¯å¿«é€Ÿå®Œæˆclientçš„èº«ä»½æ ¡éªŒå·¥ä½œã€‚</p><p>å®ç°åˆ†é…Tokençš„æœåŠ¡ä¹Ÿæœ‰å¤šç§ï¼Œè¿™æ˜¯TokenProvideræ‰€è´Ÿè´£çš„ï¼Œç›®å‰æ”¯æŒSimpleTokenå’ŒJWTä¸¤ç§ã€‚</p><p>é€šè¿‡è®¤è¯åï¼Œåœ¨è®¿é—®MVCCæ¨¡å—ä¹‹å‰ï¼Œè¿˜éœ€è¦é€šè¿‡æˆæƒæµç¨‹ã€‚æˆæƒçš„ç›®çš„æ˜¯æ£€æŸ¥clientæ˜¯å¦æœ‰æƒé™æ“ä½œä½ è¯·æ±‚çš„æ•°æ®è·¯å¾„ï¼Œetcdå®ç°äº†RBACæœºåˆ¶ï¼Œæ”¯æŒä¸ºæ¯ä¸ªç”¨æˆ·åˆ†é…ä¸€ä¸ªè§’è‰²ï¼Œä¸ºæ¯ä¸ªè§’è‰²æˆäºˆæœ€å°åŒ–çš„æƒé™ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/8d/8a/8d18f8877ea7c8fbyybebae236a8688a.png?wh=1920*1125\" alt=\"\"></p><p>å¥½äº†ï¼Œetcdé‰´æƒä½“ç³»çš„æ•´ä¸ªæµç¨‹è®²å®Œäº†ï¼Œä¸‹é¢æˆ‘ä»¬å°±ä»¥<a href=\"https://time.geekbang.org/column/article/336766\">ç¬¬ä¸‰èŠ‚è¯¾</a>ä¸­æåˆ°çš„put helloå‘½ä»¤ä¸ºä¾‹ï¼Œç»™ä½ æ·±å…¥åˆ†æä»¥ä¸Šé‰´æƒä½“ç³»æ˜¯å¦‚ä½•è¿›è¡Œèº«ä»½è®¤è¯æ¥é˜²æ­¢åŒ¿åè®¿é—®çš„ï¼Œåˆæ˜¯å¦‚ä½•å®ç°ç»†ç²’åº¦çš„æƒé™æ§åˆ¶ä»¥é˜²æ­¢è¶Šæƒè®¿é—®çš„ã€‚</p><h2>è®¤è¯</h2><p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•é˜²æ­¢åŒ¿åç”¨æˆ·è®¿é—®ä½ çš„etcdæ•°æ®å‘¢ï¼Ÿ</p><p>è§£å†³æ–¹æ¡ˆå½“ç„¶æ˜¯è®¤è¯ç”¨æˆ·èº«ä»½ã€‚é‚£etcdæä¾›äº†å“ªäº›æœºåˆ¶æ¥éªŒè¯clientèº«ä»½å‘¢?</p><p>æ­£å¦‚æˆ‘æ•´ä½“æ¶æ„ä¸­ç»™ä½ ä»‹ç»çš„ï¼Œetcdç›®å‰å®ç°äº†ä¸¤ç§æœºåˆ¶ï¼Œåˆ†åˆ«æ˜¯ç”¨æˆ·å¯†ç è®¤è¯å’Œè¯ä¹¦è®¤è¯ï¼Œä¸‹é¢æˆ‘åˆ†åˆ«ç»™ä½ ä»‹ç»è¿™ä¸¤ç§æœºåˆ¶åœ¨etcdä¸­å¦‚ä½•å®ç°ï¼Œä»¥åŠè¿™ä¸¤ç§æœºåˆ¶å„è‡ªçš„ä¼˜ç¼ºç‚¹ã€‚</p><h3>å¯†ç è®¤è¯</h3><p>é¦–å…ˆæˆ‘ä»¬æ¥è®²è®²ç”¨æˆ·å¯†ç è®¤è¯ã€‚etcdæ”¯æŒä¸ºæ¯ä¸ªç”¨æˆ·åˆ†é…ä¸€ä¸ªè´¦å·åç§°ã€å¯†ç ã€‚å¯†ç è®¤è¯åœ¨æˆ‘ä»¬ç”Ÿæ´»ä¸­æ— å¤„ä¸åœ¨ï¼Œä»é“¶è¡Œå¡å–æ¬¾åˆ°å¾®ä¿¡ã€å¾®åšappç™»å½•ï¼Œå†åˆ°æ ¸æ­¦å™¨å‘å°„ï¼Œå¯†ç è®¤è¯åº”ç”¨åŠå…¶å¹¿æ³›ï¼Œæ˜¯æœ€åŸºç¡€çš„é‰´æƒçš„æ–¹å¼ã€‚</p><p>ä½†å¯†ç è®¤è¯å­˜åœ¨ä¸¤å¤§éš¾ç‚¹ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯å¦‚ä½•ä¿éšœå¯†ç å®‰å…¨æ€§å’Œæå‡å¯†ç è®¤è¯æ€§èƒ½ã€‚</p><h4>å¦‚ä½•ä¿éšœå¯†ç å®‰å…¨æ€§</h4><p>æˆ‘ä»¬é¦–å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªéš¾ç‚¹ï¼šå¦‚ä½•ä¿éšœå¯†ç å®‰å…¨æ€§ã€‚</p><p>ä¹Ÿè®¸åˆšåˆšæ¯•ä¸šçš„ä½ ä¼šè¯´ç›´æ¥æ˜æ–‡å­˜å‚¨ï¼Œæ”¶åˆ°ç”¨æˆ·é‰´æƒè¯·æ±‚çš„æ—¶å€™ï¼Œæ£€æŸ¥ç”¨æˆ·è¯·æ±‚ä¸­å¯†ç ä¸å­˜å‚¨ä¸­æ˜¯å¦ä¸€æ ·ï¼Œä¸å°±å¯ä»¥äº†å—ï¼Ÿ è¿™ç§æ–¹æ¡ˆçš„ç¡®å¤Ÿç®€å•ï¼Œä½†ä½ æ˜¯å¦æƒ³è¿‡ï¼Œè‹¥å­˜å‚¨å¯†ç çš„æ–‡ä»¶ä¸‡ä¸€è¢«é»‘å®¢è„±åº“äº†ï¼Œé‚£ä¹ˆæ‰€æœ‰ç”¨æˆ·çš„å¯†ç éƒ½å°†è¢«æ³„éœ²ï¼Œè¿›è€Œå¯èƒ½ä¼šå¯¼è‡´é‡å¤§æ•°æ®æ³„éœ²äº‹æ•…ã€‚</p><p>ä¹Ÿè®¸ä½ åˆä¼šè¯´ï¼Œè‡ªå·±å¯ä»¥å¥‡æ€å¦™æƒ³æ„å»ºä¸€ä¸ªåŠ å¯†ç®—æ³•ï¼Œç„¶åå°†å¯†ç ç¿»è¯‘ä¸‹ï¼Œæ¯”å¦‚å°†å¯†ç ä¸­çš„æ¯ä¸ªå­—ç¬¦æŒ‰ç…§å­—æ¯è¡¨åºæ›¿æ¢æˆå­—æ¯åçš„ç¬¬XXä¸ªå­—æ¯ã€‚ç„¶è€Œè¿™ç§åŠ å¯†ç®—æ³•ï¼Œå®ƒæ˜¯å¯é€†çš„ï¼Œä¸€æ—¦è¢«é»‘å®¢è¯†åˆ«åˆ°è§„å¾‹ï¼Œè¿˜åŸå‡ºä½ çš„å¯†ç åï¼Œè„±åº“åä¹Ÿå°†å¯¼è‡´å…¨éƒ¨è´¦å·æ•°æ®æ³„å¯†ã€‚</p><p>é‚£ä¹ˆæ˜¯å¦æˆ‘ä»¬ç”¨ä¸€ç§ä¸å¯é€†çš„åŠ å¯†ç®—æ³•å°±è¡Œäº†å‘¢ï¼Ÿæ¯”å¦‚å¸¸è§çš„MD5ï¼ŒSHA-1ï¼Œè¿™æ–¹æ¡ˆå¬èµ·æ¥ä¼¼ä¹æœ‰ç‚¹é“ç†ï¼Œç„¶è€Œè¿˜æ˜¯ä¸ä¸¥è°¨ï¼Œå› ä¸ºå®ƒä»¬çš„è®¡ç®—é€Ÿåº¦éå¸¸å¿«ï¼Œé»‘å®¢å¯ä»¥é€šè¿‡æš´åŠ›æšä¸¾ã€å­—å…¸ã€å½©è™¹è¡¨ç­‰æ‰‹æ®µï¼Œå¿«é€Ÿå°†ä½ çš„å¯†ç å…¨éƒ¨ç ´è§£ã€‚</p><p>LinkedInåœ¨2012å¹´çš„æ—¶å€™650ä¸‡ç”¨æˆ·å¯†ç è¢«æ³„éœ²ï¼Œé»‘å®¢3å¤©å°±æš´åŠ›ç ´è§£å‡º90%ç”¨æˆ·çš„å¯†ç ï¼ŒåŸå› å°±æ˜¯LinkedInä»…ä»…ä½¿ç”¨äº†SHA-1åŠ å¯†ç®—æ³•ã€‚</p><p><strong>é‚£åº”è¯¥å¦‚ä½•è¿›ä¸€æ­¥å¢å¼ºä¸å¯é€†hashç®—æ³•çš„ç ´è§£éš¾åº¦ï¼Ÿ</strong></p><p>ä¸€æ–¹é¢æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®‰å…¨æ€§æ›´é«˜çš„hashç®—æ³•ï¼Œæ¯”å¦‚SHA-256ï¼Œå®ƒè¾“å‡ºä½æ•°æ›´å¤šã€è®¡ç®—æ›´åŠ å¤æ‚ä¸”è€—CPUã€‚</p><p>å¦ä¸€æ–¹é¢æˆ‘ä»¬å¯ä»¥åœ¨æ¯ä¸ªç”¨æˆ·å¯†ç hashå€¼çš„è®¡ç®—è¿‡ç¨‹ä¸­ï¼Œå¼•å…¥ä¸€ä¸ªéšæœºã€è¾ƒé•¿çš„åŠ ç›(salt)å‚æ•°ï¼Œå®ƒå¯ä»¥è®©ç›¸åŒçš„å¯†ç è¾“å‡ºä¸åŒçš„ç»“æœï¼Œè¿™è®©å½©è™¹è¡¨ç ´è§£ç›´æ¥å¤±æ•ˆã€‚</p><p>å½©è™¹è¡¨æ˜¯é»‘å®¢ç ´è§£å¯†ç çš„ä¸€ç§æ–¹æ³•ä¹‹ä¸€ï¼Œå®ƒé¢„åŠ è½½äº†å¸¸ç”¨å¯†ç ä½¿ç”¨MD5/SHA-1è®¡ç®—çš„hashå€¼ï¼Œå¯é€šè¿‡hashå€¼åŒ¹é…å¿«é€Ÿç ´è§£ä½ çš„å¯†ç ã€‚</p><p>æœ€åæˆ‘ä»¬è¿˜å¯ä»¥å¢åŠ å¯†ç hashå€¼è®¡ç®—è¿‡ç¨‹ä¸­çš„å¼€é”€ï¼Œæ¯”å¦‚å¾ªç¯è¿­ä»£æ›´å¤šæ¬¡ï¼Œå¢åŠ ç ´è§£çš„æ—¶é—´æˆæœ¬ã€‚</p><p><strong>etcdçš„é‰´æƒæ¨¡å—å¦‚ä½•å®‰å…¨å­˜å‚¨ç”¨æˆ·å¯†ç ï¼Ÿ</strong></p><p>etcdçš„ç”¨æˆ·å¯†ç å­˜å‚¨æ­£æ˜¯èåˆäº†ä»¥ä¸Šè®¨è®ºçš„é«˜å®‰å…¨æ€§hashå‡½æ•°ï¼ˆBlowfish encryption algorithmï¼‰ã€éšæœºçš„åŠ ç›saltã€å¯è‡ªå®šä¹‰çš„hashå€¼è®¡ç®—è¿­ä»£æ¬¡æ•°costã€‚</p><p>ä¸‹é¢æˆ‘å°†é€šè¿‡å‡ ä¸ªç®€å•etcdé‰´æƒAPIï¼Œä¸ºä½ ä»‹ç»å¯†ç è®¤è¯çš„åŸç†ã€‚</p><p>é¦–å…ˆä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹çš„auth enableå‘½ä»¤å¼€å¯é‰´æƒï¼Œæ³¨æ„etcdä¼šå…ˆè¦æ±‚ä½ åˆ›å»ºä¸€ä¸ªrootè´¦å·ï¼Œå®ƒæ‹¥æœ‰é›†ç¾¤çš„æœ€é«˜è¯»å†™æƒé™ã€‚</p><pre><code>$ etcdctl user add root:root\nUser root created\n$ etcdctl auth enable\nAuthentication Enabled\n</code></pre><p>å¯ç”¨é‰´æƒåï¼Œè¿™æ—¶clientå‘èµ·å¦‚ä¸‹put helloæ“ä½œæ—¶ï¼Œ etcd serverä¼šè¿”å›\"user name is empty\"é”™è¯¯ç»™clientï¼Œå°±åˆæ­¥è¾¾åˆ°äº†é˜²æ­¢åŒ¿åç”¨æˆ·è®¿é—®ä½ çš„etcdæ•°æ®ç›®çš„ã€‚ é‚£ä¹ˆetcd serveræ˜¯åœ¨å“ªé‡Œåšçš„é‰´æƒçš„å‘¢?</p><pre><code>$ etcdctl put hello world\nError: etcdserver: user name is empty\n</code></pre><p>etcd serveræ”¶åˆ°put helloè¯·æ±‚çš„æ—¶å€™ï¼Œåœ¨æäº¤åˆ°Raftæ¨¡å—å‰ï¼Œå®ƒä¼šä»ä½ è¯·æ±‚çš„ä¸Šä¸‹æ–‡ä¸­è·å–ä½ çš„ç”¨æˆ·èº«ä»½ä¿¡æ¯ã€‚å¦‚æœä½ æœªé€šè¿‡è®¤è¯ï¼Œé‚£ä¹ˆåœ¨çŠ¶æ€æœºåº”ç”¨putå‘½ä»¤çš„æ—¶å€™ï¼Œæ£€æŸ¥èº«ä»½æƒé™çš„æ—¶å€™å‘ç°æ˜¯ç©ºï¼Œå°±ä¼šè¿”å›æ­¤é”™è¯¯ç»™clientã€‚</p><p>ä¸‹é¢æˆ‘é€šè¿‡é‰´æƒæ¨¡å—çš„userå‘½ä»¤ï¼Œç»™etcdå¢åŠ ä¸€ä¸ªaliceè´¦å·ã€‚æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹etcdé‰´æƒæ¨¡å—æ˜¯å¦‚ä½•åŸºäºæˆ‘ä¸Šé¢ä»‹ç»çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œæ¥å®‰å…¨å­˜å‚¨aliceè´¦å·ä¿¡æ¯ã€‚</p><pre><code>$ etcdctl user add alice:alice --user root:root\nUser alice created\n</code></pre><p>é‰´æƒæ¨¡å—æ”¶åˆ°æ­¤å‘½ä»¤åï¼Œå®ƒä¼šä½¿ç”¨bcrptåº“çš„blowfishç®—æ³•ï¼ŒåŸºäºæ˜æ–‡å¯†ç ã€éšæœºåˆ†é…çš„saltã€è‡ªå®šä¹‰çš„costã€è¿­ä»£å¤šæ¬¡è®¡ç®—å¾—åˆ°ä¸€ä¸ªhashå€¼ï¼Œå¹¶å°†åŠ å¯†ç®—æ³•ç‰ˆæœ¬ã€saltå€¼ã€costã€hashå€¼ç»„æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½œä¸ºåŠ å¯†åçš„å¯†ç ã€‚</p><p>æœ€åï¼Œé‰´æƒæ¨¡å—å°†ç”¨æˆ·åaliceä½œä¸ºkeyï¼Œç”¨æˆ·åã€åŠ å¯†åçš„å¯†ç ä½œä¸ºvalueï¼Œå­˜å‚¨åˆ°boltdbçš„authUsers bucketé‡Œé¢ï¼Œå®Œæˆä¸€ä¸ªè´¦å·åˆ›å»ºã€‚</p><p>å½“ä½ ä½¿ç”¨aliceè´¦å·è®¿é—®etcdçš„æ—¶å€™ï¼Œä½ éœ€è¦å…ˆè°ƒç”¨é‰´æƒæ¨¡å—çš„Authenticateæ¥å£ï¼Œå®ƒä¼šéªŒè¯ä½ çš„èº«ä»½åˆæ³•æ€§ã€‚</p><p>é‚£ä¹ˆetcdå¦‚ä½•éªŒè¯ä½ å¯†ç æ­£ç¡®æ€§çš„å‘¢ï¼Ÿ</p><p>é‰´æƒæ¨¡å—é¦–å…ˆä¼šæ ¹æ®ä½ è¯·æ±‚çš„ç”¨æˆ·åaliceï¼Œä»boltdbè·å–åŠ å¯†åçš„å¯†ç ï¼Œå› æ­¤hashå€¼åŒ…å«äº†ç®—æ³•ç‰ˆæœ¬ã€saltã€costç­‰ä¿¡æ¯ï¼Œå› æ­¤å¯ä»¥æ ¹æ®ä½ è¯·æ±‚ä¸­çš„æ˜æ–‡å¯†ç ï¼Œè®¡ç®—å‡ºæœ€ç»ˆçš„hashå€¼ï¼Œè‹¥è®¡ç®—ç»“æœä¸å­˜å‚¨ä¸€è‡´ï¼Œé‚£ä¹ˆèº«ä»½æ ¡éªŒé€šè¿‡ã€‚</p><h4>å¦‚ä½•æå‡å¯†ç è®¤è¯æ€§èƒ½</h4><p>é€šè¿‡ä»¥ä¸Šçš„é‰´æƒå®‰å…¨æ€§çš„æ·±å…¥åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“èº«ä»½éªŒè¯è¿™ä¸ªè¿‡ç¨‹å¼€é”€æå…¶æ˜‚è´µï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚ä½•é¿å…é¢‘ç¹ã€æ˜‚è´µçš„å¯†ç è®¡ç®—åŒ¹é…ï¼Œæå‡å¯†ç è®¤è¯çš„æ€§èƒ½å‘¢ï¼Ÿ</p><p>è¿™å°±æ˜¯å¯†ç è®¤è¯çš„ç¬¬äºŒä¸ªéš¾ç‚¹ï¼Œå¦‚ä½•ä¿è¯æ€§èƒ½ã€‚</p><p>æƒ³æƒ³æˆ‘ä»¬åŠç†æ¸¯æ¾³é€šè¡Œè¯çš„æ—¶å€™ï¼Œæµç¨‹ç‰¹åˆ«å¤æ‚ï¼Œéœ€è¦å„ç§èº«ä»½è¯æ˜ã€ç…§ç‰‡ã€æŒ‡çº¹ä¿¡æ¯ï¼ŒåŠç†æˆåŠŸåï¼Œä¸‹å‘é€šä¿¡è¯ï¼Œæ¯æ¬¡è¿‡å…³ä½ åªéœ€è¦åˆ·ä¸‹é€šä¿¡è¯å³å¯ï¼Œé«˜æ•ˆè€Œä¾¿æ·ã€‚</p><p>é‚£ä¹ˆï¼Œåœ¨è½¯ä»¶ç³»ç»Ÿé¢†åŸŸå¦‚æœèº«ä»½éªŒè¯é€šè¿‡äº†åï¼Œæˆ‘ä»¬æ˜¯å¦ä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ªç±»ä¼¼é€šä¿¡è¯çš„å‡­æ®ç»™clientï¼Œåç»­è¯·æ±‚æºå¸¦é€šä¿¡è¯ï¼Œåªè¦é€šè¡Œè¯åˆæ³•ä¸”åœ¨æœ‰æ•ˆæœŸå†…ï¼Œå°±æ— éœ€å†æ¬¡é‰´æƒäº†å‘¢ï¼Ÿ</p><p>æ˜¯çš„ï¼Œetcdä¹Ÿæœ‰ç±»ä¼¼è¿™æ ·çš„å‡­æ®ã€‚å½“etcd serveréªŒè¯ç”¨æˆ·å¯†ç æˆåŠŸåï¼Œå®ƒå°±ä¼šè¿”å›ä¸€ä¸ªTokenå­—ç¬¦ä¸²ç»™clientï¼Œç”¨äºè¡¨ç¤ºç”¨æˆ·çš„èº«ä»½ã€‚åç»­è¯·æ±‚æºå¸¦æ­¤Tokenï¼Œå°±æ— éœ€å†æ¬¡è¿›è¡Œå¯†ç æ ¡éªŒï¼Œå®ç°äº†é€šä¿¡è¯çš„æ•ˆæœã€‚</p><p>etcdç›®å‰æ”¯æŒä¸¤ç§Tokenï¼Œåˆ†åˆ«ä¸ºSimple Tokenå’ŒJWT Tokenã€‚</p><p><strong>Simple Token</strong></p><p>Simple Tokenå®ç°æ­£å¦‚åå­—æ‰€è¨€ï¼Œç®€å•ã€‚</p><p>Simple Tokençš„æ ¸å¿ƒåŸç†æ˜¯å½“ä¸€ä¸ªç”¨æˆ·èº«ä»½éªŒè¯é€šè¿‡åï¼Œç”Ÿæˆä¸€ä¸ªéšæœºçš„å­—ç¬¦ä¸²å€¼Tokenè¿”å›ç»™clientï¼Œå¹¶åœ¨å†…å­˜ä¸­ä½¿ç”¨mapå­˜å‚¨ç”¨æˆ·å’ŒTokenæ˜ å°„å…³ç³»ã€‚å½“æ”¶åˆ°ç”¨æˆ·çš„è¯·æ±‚æ—¶ï¼Œ etcdä¼šä»è¯·æ±‚ä¸­è·å–Tokenå€¼ï¼Œè½¬æ¢æˆå¯¹åº”çš„ç”¨æˆ·åä¿¡æ¯ï¼Œè¿”å›ç»™ä¸‹å±‚æ¨¡å—ä½¿ç”¨ã€‚</p><p>Tokenæ˜¯ä½ èº«ä»½çš„è±¡å¾ï¼Œè‹¥æ­¤Tokenæ³„éœ²äº†ï¼Œé‚£ä½ çš„æ•°æ®å°±å¯èƒ½å­˜åœ¨æ³„éœ²çš„é£é™©ã€‚etcdæ˜¯å¦‚ä½•åº”å¯¹è¿™ç§æ½œåœ¨çš„å®‰å…¨é£é™©å‘¢ï¼Ÿ</p><p>etcdç”Ÿæˆçš„æ¯ä¸ªTokenï¼Œéƒ½æœ‰ä¸€ä¸ªè¿‡æœŸæ—¶é—´TTLå±æ€§ï¼ŒTokenè¿‡æœŸåclientéœ€å†æ¬¡éªŒè¯èº«ä»½ï¼Œå› æ­¤å¯æ˜¾è‘—ç¼©å°æ•°æ®æ³„éœ²çš„æ—¶é—´çª—å£ï¼Œåœ¨æ€§èƒ½ä¸Šã€å®‰å…¨æ€§ä¸Šå®ç°å¹³è¡¡ã€‚</p><p>åœ¨etcd v3.4.9ç‰ˆæœ¬ä¸­ï¼ŒTokené»˜è®¤æœ‰æ•ˆæœŸæ˜¯5åˆ†é’Ÿï¼Œetcd serverä¼šå®šæ—¶æ£€æŸ¥ä½ çš„Tokenæ˜¯å¦è¿‡æœŸï¼Œè‹¥è¿‡æœŸåˆ™ä»mapæ•°æ®ç»“æ„ä¸­åˆ é™¤æ­¤Tokenã€‚</p><p>ä¸è¿‡ä½ è¦æ³¨æ„çš„æ˜¯ï¼ŒSimple Tokenå­—ç¬¦ä¸²æœ¬èº«å¹¶æœªå«ä»»ä½•æœ‰ä»·å€¼ä¿¡æ¯ï¼Œå› æ­¤clientæ— æ³•åŠæ—¶ã€å‡†ç¡®è·å–åˆ°Tokenè¿‡æœŸæ—¶é—´ã€‚æ‰€ä»¥clientä¸å®¹æ˜“æå‰å»è§„é¿å› Tokenå¤±æ•ˆå¯¼è‡´çš„è¯·æ±‚æŠ¥é”™ã€‚</p><p>ä»ä»¥ä¸Šä»‹ç»ä¸­ï¼Œä½ è§‰å¾—Simple Tokenæœ‰å“ªäº›ä¸è¶³ä¹‹å¤„ï¼Ÿä¸ºä»€ä¹ˆetcdç¤¾åŒºä»…å»ºè®®åœ¨å¼€å‘ã€æµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨Simple Tokenå‘¢ï¼Ÿ</p><p>é¦–å…ˆå®ƒæ˜¯æœ‰çŠ¶æ€çš„ï¼Œetcd serveréœ€è¦ä½¿ç”¨å†…å­˜å­˜å‚¨Tokenå’Œç”¨æˆ·åçš„æ˜ å°„å…³ç³»ã€‚</p><p>å…¶æ¬¡ï¼Œå®ƒçš„å¯æè¿°æ€§å¾ˆå¼±ï¼Œclientæ— æ³•é€šè¿‡Tokenè·å–åˆ°è¿‡æœŸæ—¶é—´ã€ç”¨æˆ·åã€ç­¾å‘è€…ç­‰ä¿¡æ¯ã€‚</p><p>etcdé‰´æƒæ¨¡å—å®ç°çš„å¦å¤–ä¸€ä¸ªToken Provideræ–¹æ¡ˆJWTï¼Œæ­£æ˜¯ä¸ºäº†è§£å†³è¿™äº›ä¸è¶³ä¹‹å¤„è€Œç”Ÿã€‚</p><p><strong>JWT Token</strong></p><p>JWTæ˜¯Json Web Tokenç¼©å†™ï¼Œ å®ƒæ˜¯ä¸€ä¸ªåŸºäºJSONçš„å¼€æ”¾æ ‡å‡†ï¼ˆRFC 7519ï¼‰å®šä¹‰çš„ä¸€ç§ç´§å‡‘ã€ç‹¬ç«‹çš„æ ¼å¼ï¼Œå¯ç”¨äºåœ¨èº«ä»½æä¾›è€…å’ŒæœåŠ¡æä¾›è€…é—´ï¼Œä¼ é€’è¢«è®¤è¯çš„ç”¨æˆ·èº«ä»½ä¿¡æ¯ã€‚å®ƒç”±Headerã€Payloadã€Signatureä¸‰ä¸ªå¯¹è±¡ç»„æˆï¼Œ æ¯ä¸ªå¯¹è±¡éƒ½æ˜¯ä¸€ä¸ªJSONç»“æ„ä½“ã€‚</p><p>ç¬¬ä¸€ä¸ªå¯¹è±¡æ˜¯Headerï¼Œå®ƒåŒ…å«algå’Œtypä¸¤ä¸ªå­—æ®µï¼Œalgè¡¨ç¤ºç­¾åçš„ç®—æ³•ï¼Œetcdæ”¯æŒRSAã€ESAã€PSç³»åˆ—ï¼Œtypè¡¨ç¤ºç±»å‹å°±æ˜¯JWTã€‚</p><pre><code>{\n&quot;alg&quot;: &quot;RS256&quot;ï¼Œ\n&quot;typ&quot;: &quot;JWT&quot;\n}\n</code></pre><p>ç¬¬äºŒå¯¹è±¡æ˜¯Payloadï¼Œå®ƒè¡¨ç¤ºè½½è·ï¼ŒåŒ…å«ç”¨æˆ·åã€è¿‡æœŸæ—¶é—´ç­‰ä¿¡æ¯ï¼Œå¯ä»¥è‡ªå®šä¹‰æ·»åŠ å­—æ®µã€‚</p><pre><code>{\n&quot;username&quot;: usernameï¼Œ\n&quot;revision&quot;: revisionï¼Œ\n&quot;exp&quot;:      time.Now().Add(t.ttl).Unix()ï¼Œ\n}\n</code></pre><p>ç¬¬ä¸‰ä¸ªå¯¹è±¡æ˜¯ç­¾åï¼Œé¦–å…ˆå®ƒå°†headerã€payloadä½¿ç”¨base64 urlç¼–ç ï¼Œç„¶åå°†ç¼–ç åçš„</p><p>å­—ç¬¦ä¸²ç”¨\".\"è¿æ¥åœ¨ä¸€èµ·ï¼Œæœ€åç”¨æˆ‘ä»¬é€‰æ‹©çš„ç­¾åç®—æ³•æ¯”å¦‚RSAç³»åˆ—çš„ç§é’¥å¯¹å…¶è®¡ç®—ç­¾åï¼Œè¾“å‡ºç»“æœå³æ˜¯Signatureã€‚</p><pre><code>signature=RSA256(\nbase64UrlEncode(header) + &quot;.&quot; +\nbase64UrlEncode(payload)ï¼Œ\nkey)\n\n</code></pre><p>JWTå°±æ˜¯ç”±base64UrlEncode(header).base64UrlEncode(payload).signatureç»„æˆã€‚</p><p>ä¸ºä»€ä¹ˆè¯´JWTæ˜¯ç‹¬ç«‹ã€ç´§å‡‘çš„æ ¼å¼å‘¢ï¼Ÿ</p><p>ä»ä»¥ä¸ŠåŸç†ä»‹ç»ä¸­æˆ‘ä»¬çŸ¥é“ï¼Œå®ƒæ˜¯æ— çŠ¶æ€çš„ã€‚JWT Tokenè‡ªå¸¦ç”¨æˆ·åã€ç‰ˆæœ¬å·ã€è¿‡æœŸæ—¶é—´ç­‰æè¿°ä¿¡æ¯ï¼Œetcd serverä¸éœ€è¦ä¿å­˜å®ƒï¼Œclientå¯æ–¹ä¾¿ã€é«˜æ•ˆçš„è·å–åˆ°Tokençš„è¿‡æœŸæ—¶é—´ã€ç”¨æˆ·åç­‰ä¿¡æ¯ã€‚å®ƒè§£å†³äº†Simple Tokençš„è‹¥å¹²ä¸è¶³ä¹‹å¤„ï¼Œå®‰å…¨æ€§æ›´é«˜ï¼Œetcdç¤¾åŒºå»ºè®®å¤§å®¶åœ¨ç”Ÿäº§ç¯å¢ƒè‹¥ä½¿ç”¨äº†å¯†ç è®¤è¯ï¼Œåº”ä½¿ç”¨JWT  Token( --auth-token 'jwt')ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„Simple Tokenã€‚</p><p>åœ¨ç»™ä½ ä»‹ç»å®Œå¯†ç è®¤è¯å®ç°è¿‡ç¨‹ä¸­çš„ä¸¤ä¸ªæ ¸å¿ƒæŒ‘æˆ˜ï¼Œå¯†ç å­˜å‚¨å®‰å…¨å’Œæ€§èƒ½çš„è§£å†³æ–¹æ¡ˆä¹‹åï¼Œä½ æ˜¯å¦å¯¹å¯†ç è®¤è¯çš„å®‰å…¨æ€§ã€æ€§èƒ½è¿˜æœ‰æ‰€æ‹…å¿§å‘¢ï¼Ÿ</p><p>æ¥ä¸‹æ¥æˆ‘ç»™ä½ ä»‹ç»etcdçš„å¦å¤–ä¸€ç§é«˜æ€§èƒ½ã€æ›´å®‰å…¨çš„é‰´æƒæ–¹æ¡ˆï¼Œx509è¯ä¹¦è®¤è¯ã€‚</p><h3>è¯ä¹¦è®¤è¯</h3><p>å¯†ç è®¤è¯ä¸€èˆ¬ä½¿ç”¨åœ¨clientå’ŒserveråŸºäºHTTPåè®®é€šä¿¡çš„å†…ç½‘åœºæ™¯ä¸­ã€‚å½“å¯¹å®‰å…¨æœ‰æ›´é«˜è¦æ±‚çš„æ—¶å€™ï¼Œä½ éœ€è¦ä½¿ç”¨HTTPSåè®®åŠ å¯†é€šä¿¡æ•°æ®ï¼Œé˜²æ­¢ä¸­é—´äººæ”»å‡»å’Œæ•°æ®è¢«ç¯¡æ”¹ç­‰å®‰å…¨é£é™©ã€‚</p><p>HTTPSæ˜¯åˆ©ç”¨éå¯¹ç§°åŠ å¯†å®ç°èº«ä»½è®¤è¯å’Œå¯†é’¥åå•†ï¼Œå› æ­¤ä½¿ç”¨HTTPSåè®®çš„æ—¶å€™ï¼Œä½ éœ€è¦ä½¿ç”¨CAè¯ä¹¦ç»™clientç”Ÿæˆè¯ä¹¦æ‰èƒ½è®¿é—®ã€‚</p><p>é‚£ä¹ˆä¸€ä¸ªclientè¯ä¹¦åŒ…å«å“ªäº›ä¿¡æ¯å‘¢ï¼Ÿä½¿ç”¨è¯ä¹¦è®¤è¯çš„æ—¶å€™ï¼Œetcd serverå¦‚ä½•çŸ¥é“ä½ å‘é€çš„è¯·æ±‚å¯¹åº”çš„ç”¨æˆ·åç§°ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„opensslå‘½ä»¤æŸ¥çœ‹clientè¯ä¹¦çš„å†…å®¹ï¼Œä¸‹å›¾æ˜¯ä¸€ä¸ªx509 clientè¯ä¹¦çš„å†…å®¹ï¼Œå®ƒå«æœ‰è¯ä¹¦ç‰ˆæœ¬ã€åºåˆ—å·ã€ç­¾åç®—æ³•ã€ç­¾å‘è€…ã€æœ‰æ•ˆæœŸã€ä¸»ä½“åç­‰ä¿¡æ¯ï¼Œæˆ‘ä»¬é‡ç‚¹è¦å…³æ³¨çš„æ˜¯ä¸»ä½“åä¸­çš„CNå­—æ®µã€‚</p><p>åœ¨etcdä¸­ï¼Œå¦‚æœä½ ä½¿ç”¨äº†HTTPSåè®®å¹¶å¯ç”¨äº†clientè¯ä¹¦è®¤è¯(--client-cert-auth)ï¼Œå®ƒä¼šå–CNå­—æ®µä½œä¸ºç”¨æˆ·åï¼Œåœ¨æˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œaliceå°±æ˜¯clientå‘é€è¯·æ±‚çš„ç”¨æˆ·åã€‚</p><pre><code>openssl x509 -noout -text -in client.pem\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/55/94/55e03b4353c9a467493a3922cf68b294.png?wh=1144*854\" alt=\"\"></p><p>è¯ä¹¦è®¤è¯åœ¨ç¨³å®šæ€§ã€æ€§èƒ½ä¸Šéƒ½ä¼˜äºå¯†ç è®¤è¯ã€‚</p><p>ç¨³å®šæ€§ä¸Šï¼Œå®ƒä¸å­˜åœ¨Tokenè¿‡æœŸã€ä½¿ç”¨æ›´åŠ æ–¹ä¾¿ã€ä¼šè®©ä½ å°‘è¸©å‘ï¼Œé¿å…äº†ä¸å°‘Tokenå¤±æ•ˆè€Œè§¦å‘çš„Bugã€‚æ€§èƒ½ä¸Šï¼Œè¯ä¹¦è®¤è¯æ— éœ€åƒå¯†ç è®¤è¯ä¸€æ ·è°ƒç”¨æ˜‚è´µçš„å¯†ç è®¤è¯æ“ä½œ(Authenticateè¯·æ±‚)ï¼Œæ­¤æ¥å£æ”¯æŒçš„æ€§èƒ½æä½ï¼Œåé¢å®è·µç¯‡ä¼šå’Œä½ æ·±å…¥è®¨è®ºã€‚</p><h2>æˆæƒ</h2><p>å½“æˆ‘ä»¬ä½¿ç”¨å¦‚ä¸Šåˆ›å»ºçš„aliceè´¦å·æ‰§è¡Œput helloæ“ä½œçš„æ—¶å€™ï¼Œetcdå´ä¼šè¿”å›å¦‚ä¸‹çš„\"etcdserver: permission denied\"æ— æƒé™é”™è¯¯ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><pre><code>$ etcdctl put hello world --user alice:alice\nError: etcdserver: permission denied\n</code></pre><p>è¿™æ˜¯å› ä¸ºå¼€å¯é‰´æƒåï¼Œputè¯·æ±‚å‘½ä»¤åœ¨åº”ç”¨åˆ°çŠ¶æ€æœºå‰ï¼Œetcdè¿˜ä¼šå¯¹å‘å‡ºæ­¤è¯·æ±‚çš„ç”¨æˆ·è¿›è¡Œæƒé™æ£€æŸ¥ï¼Œ åˆ¤æ–­å…¶æ˜¯å¦æœ‰æƒé™æ“ä½œè¯·æ±‚çš„æ•°æ®ã€‚å¸¸ç”¨çš„æƒé™æ§åˆ¶æ–¹æ³•æœ‰ACL(Access Control List)ã€ABAC(Attribute-based access control)ã€RBAC(Role-based access control)ï¼Œetcdå®ç°çš„æ˜¯RBACæœºåˆ¶ã€‚</p><h3>RBAC</h3><p>ä»€ä¹ˆæ˜¯åŸºäºè§’è‰²æƒé™çš„æ§åˆ¶ç³»ç»Ÿ(RBAC)å‘¢ï¼Ÿ</p><p>å®ƒç”±ä¸‹å›¾ä¸­çš„ä¸‰éƒ¨åˆ†ç»„æˆï¼ŒUserã€Roleã€Permissionã€‚Userè¡¨ç¤ºç”¨æˆ·ï¼Œå¦‚aliceã€‚Roleè¡¨ç¤ºè§’è‰²ï¼Œå®ƒæ˜¯æƒé™çš„èµ‹äºˆå¯¹è±¡ã€‚Permissionè¡¨ç¤ºå…·ä½“æƒé™æ˜ç»†ï¼Œæ¯”å¦‚èµ‹äºˆRoleå¯¹keyèŒƒå›´åœ¨[keyï¼ŒKeyEnd]æ•°æ®æ‹¥æœ‰ä»€ä¹ˆæƒé™ã€‚ç›®å‰æ”¯æŒä¸‰ç§æƒé™ï¼Œåˆ†åˆ«æ˜¯READã€WRITEã€READWRITEã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/ee/60/ee6e0a9a63aeaa2d3505ab1a37360760.png?wh=1786*1134\" alt=\"\"></p><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡etcdçš„RBACæœºåˆ¶ï¼Œç»™aliceç”¨æˆ·èµ‹äºˆä¸€ä¸ªå¯è¯»å†™[hello,helly]æ•°æ®èŒƒå›´çš„è¯»å†™æƒé™ï¼Œ å¦‚ä½•æ“ä½œå‘¢?</p><p>æŒ‰ç…§ä¸Šé¢ä»‹ç»çš„RBACåŸç†ï¼Œé¦–å…ˆä½ éœ€è¦åˆ›å»ºä¸€ä¸ªroleï¼Œè¿™é‡Œæˆ‘ä»¬å‘½åä¸ºadminï¼Œç„¶åæ–°å¢äº†ä¸€ä¸ªå¯è¯»å†™[hello,helly]æ•°æ®èŒƒå›´çš„æƒé™ç»™adminè§’è‰²ï¼Œå¹¶å°†adminçš„è§’è‰²çš„æƒé™æˆäºˆäº†ç”¨æˆ·aliceã€‚è¯¦ç»†å¦‚ä¸‹ï¼š</p><pre><code>$ #åˆ›å»ºä¸€ä¸ªadmin role \netcdctl role add admin  --user root:root\nRole admin created\n# #åˆ†é…ä¸€ä¸ªå¯è¯»å†™[helloï¼Œhelly]èŒƒå›´æ•°æ®çš„æƒé™ç»™admin role\n$ etcdctl role grant-permission admin readwrite hello helly --user root:root\nRole admin updated\n# å°†ç”¨æˆ·aliceå’Œadmin roleå…³è”èµ·æ¥ï¼Œèµ‹äºˆadminæƒé™ç»™user\n$ etcdctl user grant-role alice admin --user root:root\nRole admin is granted to user alice\n</code></pre><p>ç„¶åå½“ä½ å†æ¬¡ä½¿ç”¨etcdctlæ‰§è¡Œput helloå‘½ä»¤æ—¶ï¼Œé‰´æƒæ¨¡å—ä¼šä»boltdbæŸ¥è¯¢aliceç”¨æˆ·å¯¹åº”çš„æƒé™åˆ—è¡¨ã€‚</p><p>å› ä¸ºæœ‰å¯èƒ½ä¸€ä¸ªç”¨æˆ·æ‹¥æœ‰æˆç™¾ä¸Šåƒä¸ªæƒé™åˆ—è¡¨ï¼Œetcdä¸ºäº†æå‡æƒé™æ£€æŸ¥çš„æ€§èƒ½ï¼Œå¼•å…¥äº†åŒºé—´æ ‘ï¼Œæ£€æŸ¥ç”¨æˆ·æ“ä½œçš„keyæ˜¯å¦åœ¨å·²æˆæƒçš„åŒºé—´ï¼Œæ—¶é—´å¤æ‚åº¦ä»…ä¸ºO(logN)ã€‚</p><p>åœ¨æˆ‘ä»¬çš„è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œå¾ˆæ˜æ˜¾helloåœ¨adminè§’è‰²å¯è¯»å†™çš„[helloï¼Œhelly)æ•°æ®èŒƒå›´å†…ï¼Œå› æ­¤å®ƒæœ‰æƒé™æ›´æ–°key helloï¼Œæ‰§è¡ŒæˆåŠŸã€‚ä½ ä¹Ÿå¯ä»¥å°è¯•æ›´æ–°key heyï¼Œå› ä¸ºæ­¤keyæœªåœ¨é‰´æƒçš„æ•°æ®åŒºé—´å†…ï¼Œå› æ­¤etcd serverä¼šè¿”å›\"etcdserver: permission denied\"é”™è¯¯ç»™clientï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre><code>$ etcdctl put hello world --user alice:alice\nOK\n$ etcdctl put hey hey --user alice:alice\nError: etcdserver: permission denied\n</code></pre><h2>å°ç»“</h2><p>æœ€åæˆ‘å’Œä½ æ€»ç»“ä¸‹ä»Šå¤©çš„å†…å®¹ï¼Œä»etcdé‰´æƒæ¨¡å—æ ¸å¿ƒåŸç†åˆ†æè¿‡ç¨‹ä¸­ï¼Œä½ ä¼šå‘ç°è®¾è®¡å®ç°ä¸€ä¸ªé‰´æƒæ¨¡å—æœ€å…³é”®çš„ç›®æ ‡å’ŒæŒ‘æˆ˜åº”è¯¥æ˜¯å®‰å…¨ã€æ€§èƒ½ä»¥åŠä¸€è‡´æ€§ã€‚</p><p>é¦–å…ˆé‰´æƒç›®çš„æ˜¯ä¸ºäº†ä¿è¯å®‰å…¨ï¼Œå¿…é¡»é˜²æ­¢æ¶æ„ç”¨æˆ·ç»•è¿‡é‰´æƒç³»ç»Ÿã€ä¼ªé€ ã€ç¯¡æ”¹ã€è¶Šæƒç­‰è¡Œä¸ºï¼ŒåŒæ—¶è®¾è®¡ä¸Šè¦æœ‰å‰ç»æ€§ï¼Œåšåˆ°å³ä½¿è¢«æ‹–åº“ä¹Ÿå½±å“å¯æ§ã€‚etcdçš„è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡å¯†ç å®‰å…¨åŠ å¯†å­˜å‚¨ã€è¯ä¹¦è®¤è¯ã€RBACç­‰æœºåˆ¶ä¿è¯å…¶å®‰å…¨æ€§ã€‚</p><p>ç„¶åï¼Œé‰´æƒä½œä¸ºäº†ä¸€ä¸ªæ ¸å¿ƒçš„å‰ç½®æ¨¡å—ï¼Œæ€§èƒ½ä¸Šä¸èƒ½æ‹–åè…¿ï¼Œä¸èƒ½æˆä¸ºå½±å“ä¸šåŠ¡æ€§èƒ½çš„ä¸€ä¸ªæ ¸å¿ƒç“¶é¢ˆã€‚etcdçš„è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡Tokené™ä½é¢‘ç¹ã€æ˜‚è´µçš„å¯†ç éªŒè¯å¼€é”€ï¼Œå¯åº”ç”¨åœ¨å†…ç½‘ã€å°è§„æ¨¡ä¸šåŠ¡åœºæ™¯ï¼ŒåŒæ—¶æ”¯æŒä½¿ç”¨è¯ä¹¦è®¤è¯ï¼Œä¸å­˜åœ¨Tokenè¿‡æœŸï¼Œå·§å¦™çš„å–CNå­—æ®µä½œä¸ºç”¨æˆ·åï¼Œå¯æ»¡è¶³è¾ƒå¤§è§„æ¨¡çš„ä¸šåŠ¡åœºæ™¯é‰´æƒè¯‰æ±‚ã€‚</p><p>æ¥ç€ï¼Œé‰´æƒç³»ç»Ÿé¢ä¸´çš„ä¸šåŠ¡åœºæ™¯æ˜¯å¤æ‚çš„ï¼Œå› æ­¤æƒé™æ§åˆ¶ç³»ç»Ÿåº”å½“å…·å¤‡è‰¯å¥½çš„æ‰©å±•æ€§ï¼Œä¸šåŠ¡å¯æ ¹æ®è‡ªå·±å®é™…åœºæ™¯é€‰æ‹©åˆé€‚çš„é‰´æƒæ–¹æ³•ã€‚etcdçš„Token Providerå’ŒRBACæ‰©å±•æœºåˆ¶ï¼Œéƒ½å…·å¤‡è¾ƒå¥½çš„æ‰©å±•æ€§ã€çµæ´»æ€§ã€‚å°¤å…¶æ˜¯RBACæœºåˆ¶ï¼Œè®©ä½ å¯ä»¥ç²¾ç»†åŒ–çš„æ§åˆ¶æ¯ä¸ªç”¨æˆ·æƒé™ï¼Œå®ç°æƒé™æœ€å°åŒ–åˆ†é…ã€‚</p><p>æœ€åé‰´æƒç³»ç»Ÿå…ƒæ•°æ®çš„å­˜å‚¨åº”å½“æ˜¯å¯é çš„ï¼Œå„ä¸ªèŠ‚ç‚¹é‰´æƒæ•°æ®åº”ç¡®ä¿ä¸€è‡´ï¼Œç¡®ä¿é‰´æƒè¡Œä¸ºä¸€è‡´æ€§ã€‚æ—©æœŸetcd v2ç‰ˆæœ¬æ—¶ï¼Œå› é‰´æƒå‘½ä»¤æœªç»è¿‡Raftæ¨¡å—ï¼Œå­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œåœ¨etcd v3ä¸­é€šè¿‡Raftæ¨¡å—åŒæ­¥é‰´æƒæŒ‡ä»¤æ—¥å¿—æŒ‡ä»¤ï¼Œå®ç°é‰´æƒæ•°æ®ä¸€è‡´æ€§ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™äº†ä¸€ä¸ªæ€è€ƒé¢˜ã€‚ä½ åœ¨ä½¿ç”¨etcdé‰´æƒç‰¹æ€§è¿‡ç¨‹ä¸­é‡åˆ°äº†å“ªäº›é—®é¢˜ï¼Ÿåˆæ˜¯å¦‚ä½•è§£å†³çš„å‘¢ï¼Ÿ</p><p>æ„Ÿè°¢ä½ çš„é˜…è¯»ï¼Œæ¬¢è¿ä½ æŠŠæ€è€ƒå’Œè§‚ç‚¹å†™åœ¨ç•™è¨€åŒºï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h2>04æ€è€ƒé¢˜å‚è€ƒç­”æ¡ˆ</h2><p>04è®²çš„æ€è€ƒé¢˜mckeeåŒå­¦ç»™å‡ºäº†ç²¾å½©å›ç­”ï¼Œä¸‹é¢æ˜¯ä»–çš„å›ç­”ã€‚</p><p>1.å“ªäº›åœºæ™¯ä¼šå‡ºç° Follower æ—¥å¿—ä¸ Leader å†²çªï¼Ÿ</p><p>leaderå´©æºƒçš„æƒ…å†µä¸‹å¯èƒ½(å¦‚è€çš„leaderå¯èƒ½è¿˜æ²¡æœ‰å®Œå…¨å¤åˆ¶æ‰€æœ‰çš„æ—¥å¿—æ¡ç›®)ï¼Œå¦‚æœleaderå’Œfollowerå‡ºç°æŒç»­å´©æºƒä¼šåŠ å‰§è¿™ä¸ªç°è±¡ã€‚followerå¯èƒ½ä¼šä¸¢å¤±ä¸€äº›åœ¨æ–°çš„leaderä¸­æœ‰çš„æ—¥å¿—æ¡ç›®ï¼Œä»–ä¹Ÿå¯èƒ½æ‹¥æœ‰ä¸€äº›leaderæ²¡æœ‰çš„æ—¥å¿—æ¡ç›®ï¼Œæˆ–è€…ä¸¤è€…éƒ½å‘ç”Ÿã€‚</p><p>2.followerå¦‚ä½•åˆ é™¤æ— æ•ˆæ—¥å¿—ï¼Ÿ</p><p>leaderå¤„ç†ä¸ä¸€è‡´æ˜¯é€šè¿‡å¼ºåˆ¶followerç›´æ¥å¤åˆ¶è‡ªå·±çš„æ—¥å¿—æ¥è§£å†³ã€‚å› æ­¤åœ¨followerä¸­çš„å†²çªçš„æ—¥å¿—æ¡ç›®ä¼šè¢«leaderçš„æ—¥å¿—è¦†ç›–ã€‚leaderä¼šè®°å½•followerçš„æ—¥å¿—å¤åˆ¶è¿›åº¦nextIndexï¼Œå¦‚æœfolloweråœ¨è¿½åŠ æ—¥å¿—æ—¶ä¸€è‡´æ€§æ£€æŸ¥å¤±è´¥ï¼Œå°±ä¼šæ‹’ç»è¯·æ±‚ï¼Œæ­¤æ—¶leaderå°±ä¼šå‡å° nextIndex å€¼å¹¶è¿›è¡Œé‡è¯•ï¼Œæœ€ç»ˆåœ¨æŸä¸ªä½ç½®è®©followerè·Ÿleaderä¸€è‡´ã€‚</p><p>è¿™é‡Œæˆ‘è¡¥å……ä¸‹ä¸ºä»€ä¹ˆWALæ—¥å¿—æ¨¡å—åªé€šè¿‡è¿½åŠ ï¼Œä¹Ÿèƒ½åˆ é™¤å·²æŒä¹…åŒ–å†²çªçš„æ—¥å¿—æ¡ç›®å‘¢ï¼Ÿ å…¶å®è¿™é‡Œetcdåœ¨å®ç°ä¸Šé‡‡ç”¨äº†ä¸€äº›æ¯”è¾ƒæœ‰æŠ€å·§çš„æ–¹æ³•ï¼Œåœ¨WALæ—¥å¿—ä¸­çš„ç¡®æ²¡åˆ é™¤åºŸå¼ƒçš„æ—¥å¿—æ¡ç›®ï¼Œä½ å¯ä»¥åœ¨å…¶ä¸­æœç´¢åˆ°å†²çªçš„æ—¥å¿—æ¡ç›®ã€‚åªæ˜¯etcdåŠ è½½WALæ—¥å¿—æ—¶ï¼Œå‘ç°ä¸€ä¸ªraft log indexä½ç½®ä¸Šæœ‰å¤šä¸ªæ—¥å¿—æ¡ç›®çš„æ—¶å€™ï¼Œä¼šé€šè¿‡è¦†ç›–çš„æ–¹å¼ï¼Œå°†æœ€åå†™å…¥çš„æ—¥å¿—æ¡ç›®è¿½åŠ åˆ°raft logä¸­ï¼Œå®ç°äº†åˆ é™¤å†²çªæ—¥å¿—æ¡ç›®æ•ˆæœï¼Œä½ å¦‚æœæ„Ÿå…´è¶£å¯ä»¥å‚è€ƒä¸‹æˆ‘å’ŒGoogle ptabor<a href=\"https://github.com/etcd-io/etcd/issues/12589\">å…³äºè¿™ä¸ªé—®é¢˜çš„è®¨è®º</a>ã€‚</p>","neighbors":{"left":{"article_title":"04 | Raftåè®®ï¼šetcdå¦‚ä½•å®ç°é«˜å¯ç”¨ã€æ•°æ®å¼ºä¸€è‡´çš„ï¼Ÿ","id":337604},"right":{"article_title":"06 | ç§Ÿçº¦ï¼šå¦‚ä½•æ£€æµ‹ä½ çš„å®¢æˆ·ç«¯å­˜æ´»ï¼Ÿ","id":339337}},"comments":[{"had_liked":false,"id":276279,"user_name":"å”èª","can_delete":false,"product_type":"c1","uid":1009582,"ip_address":"","ucode":"99CB061EDF35EA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","comment_is_top":false,"comment_ctime":1611869762,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"74626313794","product_id":100069901,"comment_content":"æœ¬è®²æ˜¯ä¸€ä¸ªå¾®å‹é‰´æƒç³»ç»Ÿè®¾è®¡ä¸å®ç°åˆ†æï¼Œæ›¾é‡åˆ°å¥½å‡ æ¬¡ä¸šåŠ¡ä½¿ç”¨å¯†ç é‰´æƒå‡ºç°é—®é¢˜çš„ï¼ŒåŸå› å°±åœ¨äºå¤§å®¶å¯¹å¯†ç é‰´æƒã€é€‚ç”¨åœºæ™¯ï¼Œäº†è§£å¤ªå°‘å¯¼è‡´çº¿ä¸Šå‡ºé—®é¢˜ï¼Œå¸Œæœ›é€šè¿‡æœ¬è®²å¸®åŠ©å¤§å®¶ææ¸…æ¥šetcdé‰´æƒçš„ä¸€åˆ‡","like_count":17},{"had_liked":false,"id":276773,"user_name":"jeffery","can_delete":false,"product_type":"c1","uid":1219972,"ip_address":"","ucode":"35E2DAA386FB86","user_header":"https://static001.geekbang.org/account/avatar/00/12/9d/84/171b2221.jpg","comment_is_top":false,"comment_ctime":1612106312,"is_pvip":false,"replies":[{"id":"100534","content":"æ„Ÿè°¢jefferyåŒå­¦çš„é«˜åº¦è®¤å¯ï¼Œå¦‚æœæœ‰æ”¶è·å¯ä»¥åˆ†äº«ç»™æ›´å¤šäººï¼Œè°¢è°¢ä½ çš„æ”¯æŒã€‚å¤šç§Ÿæˆ·æ¨¡å¼ä¸‹ï¼Œå¦‚æœä½¿ç”¨å¯†ç é‰´æƒï¼Œä½ å¯ä»¥ç›´æ¥è°ƒç”¨APIç»™ä¸åŒç§Ÿæˆ·æ·»åŠ è´¦å·ã€å¯†ç ï¼Œæ¯ä¸ªç§Ÿæˆ·åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„è·¯å¾„ï¼Œç„¶åæŒ‰è·¯å¾„å‰ç¼€åˆ†é…æƒé™ã€‚å¦‚æœä½¿ç”¨çš„è¯ä¹¦é‰´æƒï¼Œä½ å¯ä»¥ä¸ºæ¯ä¸ªç”¨æˆ·ç”Ÿæˆè¯ä¹¦ï¼Œè¯ä¹¦çš„CNå­—æ®µä¸ºç”¨æˆ·çš„åç§°å³å¯ï¼Œå»ºè®®ä½¿ç”¨è¯ä¹¦é‰´æƒã€‚åŒæ—¶é‡è¦ä¸šåŠ¡ä¸å»ºè®®å¤šç§Ÿæˆ·æ¨¡å¼å“ˆï¼Œå¤šç§Ÿæˆ·åœºæ™¯ä¸åŒç§Ÿæˆ·å¯èƒ½ä¼šç›¸äº’å½±å“ï¼Œå¯¼è‡´å„ç§ç¨³å®šæ€§é—®é¢˜ï¼Œé™¤éå„ä¸ªç§Ÿæˆ·çš„è¡Œä¸ºæ˜¯å¯æ§çš„ï¼Œå¯ä¿¡èµ–çš„ã€‚etcdé€‰å‹ã€å¤šæ•°æ®ä¸­å¿ƒè¿™äº›åé¢å®è·µç¯‡å°†ä¸ºä½ åˆ†æã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1612247955,"ip_address":"","comment_id":276773,"utype":1}],"discussion_count":1,"race_medal":0,"score":"31676877384","product_id":100069901,"comment_content":"æ¯ç« éƒ½å¹²è´§ğŸ‘å¤šç§Ÿæˆ·æ¨¡å¼ä¸‹æ€ä¹ˆè®¾ç½®é‰´æƒã€etcdä¸çŸ¥é“åæœŸä¼šä¸ä¼šæ”¯æŒå¤šæ•°æ®ä¸­å¿ƒï¼ç›¸æ¯”Nacosã€æ€ä¹ˆé€‰å‹ï¼è°¢è°¢è€å¸ˆ","like_count":7,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514817,"discussion_content":"æ„Ÿè°¢jefferyåŒå­¦çš„é«˜åº¦è®¤å¯ï¼Œå¦‚æœæœ‰æ”¶è·å¯ä»¥åˆ†äº«ç»™æ›´å¤šäººï¼Œè°¢è°¢ä½ çš„æ”¯æŒã€‚å¤šç§Ÿæˆ·æ¨¡å¼ä¸‹ï¼Œå¦‚æœä½¿ç”¨å¯†ç é‰´æƒï¼Œä½ å¯ä»¥ç›´æ¥è°ƒç”¨APIç»™ä¸åŒç§Ÿæˆ·æ·»åŠ è´¦å·ã€å¯†ç ï¼Œæ¯ä¸ªç§Ÿæˆ·åˆ†é…ä¸€ä¸ªå”¯ä¸€çš„è·¯å¾„ï¼Œç„¶åæŒ‰è·¯å¾„å‰ç¼€åˆ†é…æƒé™ã€‚å¦‚æœä½¿ç”¨çš„è¯ä¹¦é‰´æƒï¼Œä½ å¯ä»¥ä¸ºæ¯ä¸ªç”¨æˆ·ç”Ÿæˆè¯ä¹¦ï¼Œè¯ä¹¦çš„CNå­—æ®µä¸ºç”¨æˆ·çš„åç§°å³å¯ï¼Œå»ºè®®ä½¿ç”¨è¯ä¹¦é‰´æƒã€‚åŒæ—¶é‡è¦ä¸šåŠ¡ä¸å»ºè®®å¤šç§Ÿæˆ·æ¨¡å¼å“ˆï¼Œå¤šç§Ÿæˆ·åœºæ™¯ä¸åŒç§Ÿæˆ·å¯èƒ½ä¼šç›¸äº’å½±å“ï¼Œå¯¼è‡´å„ç§ç¨³å®šæ€§é—®é¢˜ï¼Œé™¤éå„ä¸ªç§Ÿæˆ·çš„è¡Œä¸ºæ˜¯å¯æ§çš„ï¼Œå¯ä¿¡èµ–çš„ã€‚etcdé€‰å‹ã€å¤šæ•°æ®ä¸­å¿ƒè¿™äº›åé¢å®è·µç¯‡å°†ä¸ºä½ åˆ†æã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612247955,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":276460,"user_name":"äº‘åŸç”Ÿå·¥ç¨‹å¸ˆ","can_delete":false,"product_type":"c1","uid":2243294,"ip_address":"","ucode":"40CB692F21D3BC","user_header":"https://static001.geekbang.org/account/avatar/00/22/3a/de/e5c30589.jpg","comment_is_top":false,"comment_ctime":1611934659,"is_pvip":false,"replies":[{"id":"100314","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1611967672,"ip_address":"","comment_id":276460,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27381738435","product_id":100069901,"comment_content":"å¯†ç é‰´æƒç®€å•æ˜“ç”¨ï¼Œä½†æ˜¯æ½œåœ¨éšæ‚£å¤šï¼Œè¯ä¹¦å¯èƒ½ç•¥éº»çƒ¦ï¼Œç‰¹åˆ«æ˜¯å¤šç§Ÿæˆ·åœºæ™¯ï¼Œæ¯ä¸ªç”¨æˆ·è¯ä¹¦éƒ½ä¸ä¸€æ ·ï¼Œéœ€è¦ç‹¬ç«‹ç”Ÿæˆï¼Œæ€»çš„è€Œè¨€ï¼Œè¿˜æ˜¯ä¸èƒ½ä¸ºä¸€æ—¶æ–¹ä¾¿å·æ‡’é€‰ç”¨å¯†ç ","like_count":6,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514708,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611967672,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":277231,"user_name":"äºé€”","can_delete":false,"product_type":"c1","uid":1669343,"ip_address":"","ucode":"70300C6CCCEAF1","user_header":"https://static001.geekbang.org/account/avatar/00/19/78/df/424bdc4a.jpg","comment_is_top":false,"comment_ctime":1612322681,"is_pvip":true,"replies":[{"id":"100591","content":"èµ","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1612331119,"ip_address":"","comment_id":277231,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18792191865","product_id":100069901,"comment_content":"1ï¼‰æ’åº“ï¼šé»‘å®¢é€šè¿‡æ”¶é›†äº’è”ç½‘å·²æ³„éœ²çš„ç”¨æˆ·å’Œå¯†ç ä¿¡æ¯ï¼Œç”Ÿæˆå¯¹åº”çš„å­—å…¸è¡¨ï¼Œå°è¯•æ‰¹é‡ç™»é™†å…¶ä»–ç½‘ç«™åï¼Œå¾—åˆ°ä¸€ç³»åˆ—å¯ä»¥ç™»å½•çš„ç”¨æˆ·ã€‚è¯´çš„ç®€å•ä¸€ç‚¹ï¼Œå°±æ˜¯ä¸€ä¸ªå°å·ï¼Œå…¥å®¤ç›—çªƒåå·åˆ°äº†ä¸€ä¸²é’¥åŒ™ï¼Œç„¶åä»–æ‹¿ç€è¿™ä¸²é’¥åŒ™ï¼Œåœ¨æ•´ä¸ªå°åŒºé‡Œé¢æŒ¨å®¶æŒ¨æˆ·çš„è¿›è¡Œå¼€é”ã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯æ’åº“ã€‚<br><br>2ï¼‰æ¼æ°´ï¼šæŸäº›ä¼ä¸šè‡ªèº«å‡ºç°é£é™©å¯¼è‡´çš„æ•°æ®æ³„éœ²ã€‚<br><br>3ï¼‰æ‹–åº“ï¼šæŒ‡ç½‘ç«™é­åˆ°é»‘å®¢å…¥ä¾µåï¼Œæ•°æ®åº“è¢«çªƒå–ï¼ˆé»‘å®¢å°†æ•°æ®åº“å¯¼å‡ºè‡³æœ¬åœ°ï¼‰ã€‚<br><br>4ï¼‰æ´—åº“ï¼šæŒ‡é»‘å®¢å…¥ä¾µç½‘ç«™åï¼Œé€šè¿‡æŠ€æœ¯æ‰‹æ®µå°†æœ‰ä»·å€¼çš„ç”¨æˆ·æ•°æ®å½’çº³åˆ†æï¼Œå”®å–å˜ç°çš„è¿‡ç¨‹ã€‚ç®€å•è€Œè¨€ï¼Œæ´—åº“å°±æ˜¯é»‘å®¢æ‹–åº“åè¿›ä¸€æ­¥ç‰Ÿåˆ©çš„æ‰‹æ®µã€‚","like_count":4,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514966,"discussion_content":"èµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612331119,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":310174,"user_name":"types","can_delete":false,"product_type":"c1","uid":2449777,"ip_address":"","ucode":"8B50927EF1804F","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLDUJyeq54fiaXAgF62tNeocO3lHsKT4mygEcNoZLnibg6ONKicMgCgUHSfgW8hrMUXlwpNSzR8MHZwg/132","comment_is_top":false,"comment_ctime":1630511356,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14515413244","product_id":100069901,"comment_content":"è®¤è¯æµç¨‹åœ¨Raftä¹‹å‰ï¼Œé‰´æƒæµç¨‹åœ¨Raftä¹‹åï¼Œè¯·é—®æ˜¯ä»€ä¹ˆè€ƒè™‘ï¼Ÿ<br>é‰´æƒå¤±è´¥åï¼ŒRaftä¸­çš„æ—¥å¿—æ¡ç›®æ˜¯å¦è¦ç‰¹æ®Šå¤„ç†ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1245915,"avatar":"https://static001.geekbang.org/account/avatar/00/13/02/db/5d227be5.jpg","nickname":"xiaoyu","note":"","ucode":"477617C15FB5CC","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":534928,"discussion_content":"æœ‰åŒæ ·çš„ç–‘é—®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1638320962,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":313000,"user_name":"å´å±•","can_delete":false,"product_type":"c1","uid":1083545,"ip_address":"","ucode":"F7537C0570F212","user_header":"https://static001.geekbang.org/account/avatar/00/10/88/99/6945c324.jpg","comment_is_top":false,"comment_ctime":1632193840,"is_pvip":false,"replies":[{"id":"114594","content":"æ˜¯çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1634312647,"ip_address":"","comment_id":313000,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5927161136","product_id":100069901,"comment_content":"ä½¿ç”¨è¯ä¹¦è®¤è¯å°±ä¸éœ€è¦tokenäº†ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":527194,"discussion_content":"æ˜¯çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634312647,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":277150,"user_name":"ä¸€æ­¥","can_delete":false,"product_type":"c1","uid":1005391,"ip_address":"","ucode":"73CEA468CE70C3","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg","comment_is_top":false,"comment_ctime":1612275857,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5907243153","product_id":100069901,"comment_content":"å¯¹äºæ•°æ®æˆæƒï¼Œèƒ½ä¸èƒ½å®ç° æ¨¡ç³ŠåŒ¹é…å‘¢ï¼Ÿ æ¯”å¦‚  hello* å¯ä»¥æ“ä½œå‰ç¼€ æ˜¯ hello è€Œä¸”åé¢å¯ä»¥è·Ÿä»»æ„çš„ä¸€ä¸ªå­—ç¬¦ çš„ key","like_count":1},{"had_liked":false,"id":353657,"user_name":"é™ˆéº’æ–‡","can_delete":false,"product_type":"c1","uid":2187256,"ip_address":"ç¦å»º","ucode":"41475885FA5AD5","user_header":"https://static001.geekbang.org/account/avatar/00/21/5f/f8/1d16434b.jpg","comment_is_top":false,"comment_ctime":1659664431,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1659664431","product_id":100069901,"comment_content":"æœ‰ç®€ä¾¿çš„é¡µé¢æ“ä½œè½¯ä»¶ä¹ˆï¼Ÿä¸ç„¶rbacå‘½ä»¤è¡Œæ“ä½œæœ‰äº›ä¸å¥½ç®¡ç†ï¼Œå¦‚æœç”¨æˆ·å¤šèµ·æ¥äº†ï¼Œæ¯”è¾ƒä¸ç›´è§‚","like_count":0},{"had_liked":false,"id":340393,"user_name":"æ…¢æ…¢æœ€å¿«","can_delete":false,"product_type":"c1","uid":2203460,"ip_address":"","ucode":"F15797874EB5ED","user_header":"https://static001.geekbang.org/account/avatar/00/21/9f/44/316f93a6.jpg","comment_is_top":false,"comment_ctime":1648796656,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1648796656","product_id":100069901,"comment_content":"å¤§ä½¬ï¼Œetcd ä¸ºäº†æå‡æƒé™æ£€æŸ¥çš„æ€§èƒ½ï¼Œå¼•å…¥äº†åŒºé—´æ ‘ï¼Œæ£€æŸ¥ç”¨æˆ·æ“ä½œçš„ key æ˜¯å¦åœ¨å·²æˆæƒçš„åŒºé—´ï¼Œæ—¶é—´å¤æ‚åº¦ä»…ä¸º O(logN)ï¼Œè¿™éƒ¨åˆ†å¼•å…¥åŒºé—´æ ‘çš„è¯¦æƒ…èƒ½è®²ä¸‹å—","like_count":0,"discussions":[{"author":{"id":1111389,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f5/5d/cc191bf8.jpg","nickname":"çº¢é²¤é±¼ä¸ç»¿é²¤é±¼ä¸é©´ğŸ’­","note":"","ucode":"3F95880F8F6F63","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580379,"discussion_content":"ä»£ç é‡Œé¢ä½¿ç”¨äº†æ ‘å½¢ç»“æ„å­˜å‚¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658134315,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":331266,"user_name":"æ°sir","can_delete":false,"product_type":"c1","uid":1098505,"ip_address":"","ucode":"80BB56B3BFB71A","user_header":"https://static001.geekbang.org/account/avatar/00/10/c3/09/dc368335.jpg","comment_is_top":false,"comment_ctime":1642511424,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1642511424","product_id":100069901,"comment_content":"ä¸ºä»€ä¹ˆè¯ä¹¦è®¤è¯æ€§èƒ½ä¼˜äºå¯†ç è®¤è¯ï¼Ÿ<br>è¯ä¹¦è®¤è¯ä¸­æ¶‰åŠç­¾åè®¤è¯ï¼ŒæŒ‡çº¹éªŒè¯ï¼ˆsha-256ï¼‰ï¼Œçœ‹ä¸Šå»å’Œå¯†ç è®¤è¯å·®ä¸å¤šå‘€","like_count":0},{"had_liked":false,"id":330332,"user_name":"ä¹”çº³æ£®","can_delete":false,"product_type":"c1","uid":1045107,"ip_address":"","ucode":"51EC9FAE071388","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f2/73/1c7bceae.jpg","comment_is_top":false,"comment_ctime":1641915424,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1641915424","product_id":100069901,"comment_content":"å”è€å¸ˆï¼Œèƒ½ä¸èƒ½ssl é‰´æƒçš„åŸç†å’Œç»†èŠ‚è®²ä¸€ä¸‹å“ˆï¼Œkey usage çš„server auth ,client authåŸç†æ˜¯ä»€ä¹ˆï¼Ÿ","like_count":0},{"had_liked":false,"id":313610,"user_name":"z.l","can_delete":false,"product_type":"c1","uid":1181055,"ip_address":"","ucode":"805CC5784D3F76","user_header":"https://static001.geekbang.org/account/avatar/00/12/05/7f/d35ab9a1.jpg","comment_is_top":false,"comment_ctime":1632556432,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1632556432","product_id":100069901,"comment_content":"â€œleader å´©æºƒçš„æƒ…å†µä¸‹å¯èƒ½ (å¦‚è€çš„ leader å¯èƒ½è¿˜æ²¡æœ‰å®Œå…¨å¤åˆ¶æ‰€æœ‰çš„æ—¥å¿—æ¡ç›®)â€œ<br>è¿™å¥è¿˜æ˜¯ä¸å¤ªç†è§£å•Šï¼Œå¯ä»¥è¯¦ç»†æè¿°ä¸€ä¸‹å—<br>","like_count":0},{"had_liked":false,"id":308409,"user_name":"å°ä¸¢ğŸ‘£","can_delete":false,"product_type":"c1","uid":1031711,"ip_address":"","ucode":"A7699F00418FC4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/be/1f/57c88dd1.jpg","comment_is_top":false,"comment_ctime":1629606119,"is_pvip":false,"replies":[{"id":"112700","content":"å—¯ï¼Œä¸€èˆ¬éƒ½5åˆ°20å¹´ï¼Œè¿‡çŸ­å¯¼è‡´è¯ä¹¦è¿‡æœŸå½±å“ç”Ÿäº§ç¯å¢ƒå¯ç”¨æ€§ï¼Œè¿‡é•¿è¦æ³¨æ„è¯ä¹¦å®‰å…¨æ€§ï¼Œä¸è¦æ³„éœ²åˆ°githubï¼Œå¹¶ä¸”æœ‰åŠé”€æœºåˆ¶ï¼Œæ¯”å¦‚etcdä¸­å–è¯ä¹¦çš„cnä½œä¸ºuser nameï¼Œå¦‚æœè¯ä¹¦æ³„éœ²äº†ï¼Œå¯ä»¥åˆ é™¤etcdä¸­å¯¹åº”useræƒé™","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1631027075,"ip_address":"","comment_id":308409,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1629606119","product_id":100069901,"comment_content":"è¯ä¹¦è®¤è¯ä¹Ÿæœ‰è¿‡æœŸæ—¶é—´ï¼Œæœ‰ä¼ä¸šk8såº”ç”¨ä¸­ï¼Œä¸€ä¸ªè¯ä¹¦ï¼ˆå¯èƒ½æ˜¯è¶…çº§è¯ä¹¦ï¼‰å¯èƒ½è¢«å¾ˆå¤šè°ƒç”¨æ–¹å…±äº«ä½¿ç”¨ï¼Œä¸ºäº†å‡å°‘è¯ä¹¦å˜æ›´å¸¦æ¥ä¸‹æ¸¸è°ƒç”¨æ–¹åŒæ­¥å˜æ›´æˆæœ¬ï¼Œé€šå¸¸ä¼šæŠŠè¯ä¹¦è¿‡æœŸæ—¶é—´è®¾æˆ10å¹´ç”šè‡³æ›´ä¹…ã€‚ä¸çŸ¥é“è¿™æ ·çš„è®¾ç½®æ˜¯å¦åˆç†ï¼Ÿï¼ˆä»¥ä¸Šåœºæ™¯æ˜¯ä¸ªäººç†è§£ï¼Œä¸ç¡®ä¿æ˜¯å¦å’Œæˆ‘æè¿°çš„ä¸€æ ·ï¼‰","like_count":0,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":525485,"discussion_content":"å—¯ï¼Œä¸€èˆ¬éƒ½5åˆ°20å¹´ï¼Œè¿‡çŸ­å¯¼è‡´è¯ä¹¦è¿‡æœŸå½±å“ç”Ÿäº§ç¯å¢ƒå¯ç”¨æ€§ï¼Œè¿‡é•¿è¦æ³¨æ„è¯ä¹¦å®‰å…¨æ€§ï¼Œä¸è¦æ³„éœ²åˆ°githubï¼Œå¹¶ä¸”æœ‰åŠé”€æœºåˆ¶ï¼Œæ¯”å¦‚etcdä¸­å–è¯ä¹¦çš„cnä½œä¸ºuser nameï¼Œå¦‚æœè¯ä¹¦æ³„éœ²äº†ï¼Œå¯ä»¥åˆ é™¤etcdä¸­å¯¹åº”useræƒé™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631027075,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":303064,"user_name":"è‰¯å‡¯å°”","can_delete":false,"product_type":"c1","uid":1806492,"ip_address":"","ucode":"8204DA338BA8F4","user_header":"https://static001.geekbang.org/account/avatar/00/1b/90/9c/288e4db2.jpg","comment_is_top":false,"comment_ctime":1626572911,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1626572911","product_id":100069901,"comment_content":"è€å¸ˆä½ å¥½ï¼Œå…³äºè®¤è¯æˆæƒæˆ‘æœ‰ä¸ªç–‘é—®ï¼Œæ–°å¢äº†æŸä¸ªè®¤è¯æˆæƒè§„åˆ™å¹¶æˆåŠŸè¿”å›åï¼Œç«‹é©¬å‘é€ä¸€ä¸ªè¯»è¯·æ±‚ï¼Œè¿™ä¸ªè¯·æ±‚éšæœºåˆ†é…åˆ°ä¸€ä¸ªetcd endpointä¸Šé¢å»ï¼Œä½†æ˜¯è¿™ä¸ªendpointä¸Šæš‚æ—¶è¿˜æ²¡æœ‰æ”¶åˆ°æˆ–è€…è¿˜æ²¡æ¥å¾—åŠå†™å…¥åˆšåˆšæ–°å¢çš„è®¤è¯ã€é‰´æƒçš„è§„åˆ™ï¼Œé‚£è¿™ä¸ªæ—¶å€™è¯·æ±‚ä¼šå¤±è´¥ï¼Œä¼šå‡ºç°ä¸Šé¢è¿™ç§æƒ…å†µå—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1233455,"avatar":"https://static001.geekbang.org/account/avatar/00/12/d2/2f/04882ff8.jpg","nickname":"é¾™å¤","note":"","ucode":"D1724E68D6304D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":398922,"discussion_content":"è¿™å’Œçº¿æ€§è¯»å’Œä¸²è¡Œè¯»æœ‰å…³ï¼Œå¦‚æœæ˜¯çº¿æ€§è¯»ï¼Œé‚£ä¹ˆfollowerä¼šå‘leaderå‘èµ·readindexè¯·æ±‚ï¼Œleaderä¼šå°†å·²æäº¤çš„æ—¥å¿—ç´¢å¼•è¿”å›ç»™followerï¼Œæ­¤æ—¶followerä¼šç­‰å¾…çŠ¶æ€æœºæŠŠæ‰€æœ‰è®°å½•åŒæ­¥å¥½ï¼Œè¿™æ ·å†å»æ‹¿æƒé™è§„åˆ™ï¼Œæœ€åè¿”å›ç»™å®¢æˆ·ã€‚è¿™æ ·ä¿è¯äº†æœ€è¿‘æ•°æ®","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1632876770,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":280134,"user_name":"ä½•ä¼Ÿæ€¡","can_delete":false,"product_type":"c1","uid":1843252,"ip_address":"","ucode":"AAC3C76852B4EB","user_header":"https://static001.geekbang.org/account/avatar/00/1c/20/34/f6470d0b.jpg","comment_is_top":false,"comment_ctime":1614089677,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614089677","product_id":100069901,"comment_content":"tokenè®¤è¯å’Œè¯ä¹¦è®¤è¯å¯ä»¥åŠ ä¸€äº›å…·ä½“æ“ä½œçš„ä¾‹å­å—","like_count":0},{"had_liked":false,"id":279078,"user_name":"çŸ³å°","can_delete":false,"product_type":"c1","uid":1781893,"ip_address":"","ucode":"4258C686F289A6","user_header":"https://static001.geekbang.org/account/avatar/00/1b/30/85/14c2f16c.jpg","comment_is_top":false,"comment_ctime":1613609779,"is_pvip":false,"replies":[{"id":"101459","content":"æ–°å¹´å¥½ï¼Œtokenæ˜¯serverä½¿ç”¨RSAç­‰ç­¾åç®—æ³•å¯¹åŒ…å«ç”¨æˆ·åã€ç‰ˆæœ¬å·ç­‰payloadåŠ å¯†åçš„ç»“æœï¼Œserveræ”¶åˆ°åä¼šæ ¡éªŒtokenæœ‰æ•ˆæ€§ï¼Œå› æ­¤åªè¦ä½ RSAç­‰ç­¾åç®—æ³•ç§é’¥ä¸æ³„éœ²ï¼Œå®‰å…¨æ€§å°±æ˜¯æœ‰ä¿éšœçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1613707880,"ip_address":"","comment_id":279078,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1613609779","product_id":100069901,"comment_content":"è€å¸ˆè¿‡å¹´å¥½ï¼Œä½¿ç”¨jwt tokenå¦‚æœserverä¸ä¿å­˜ç”¨æˆ·åï¼Œclient å‘æ¥çš„ç”¨æˆ·åå’Œç­¾åè‹¥ç»è¿‡ç¯¡æ”¹çš„ï¼ŒæœåŠ¡å™¨æ€ä¹ˆçŸ¥é“å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515618,"discussion_content":"æ–°å¹´å¥½ï¼Œtokenæ˜¯serverä½¿ç”¨RSAç­‰ç­¾åç®—æ³•å¯¹åŒ…å«ç”¨æˆ·åã€ç‰ˆæœ¬å·ç­‰payloadåŠ å¯†åçš„ç»“æœï¼Œserveræ”¶åˆ°åä¼šæ ¡éªŒtokenæœ‰æ•ˆæ€§ï¼Œå› æ­¤åªè¦ä½ RSAç­‰ç­¾åç®—æ³•ç§é’¥ä¸æ³„éœ²ï¼Œå®‰å…¨æ€§å°±æ˜¯æœ‰ä¿éšœçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613707880,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":278036,"user_name":"Alery","can_delete":false,"product_type":"c1","uid":1156557,"ip_address":"","ucode":"08F3F49181E67B","user_header":"https://static001.geekbang.org/account/avatar/00/11/a5/cd/3aff5d57.jpg","comment_is_top":false,"comment_ctime":1612711967,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1612711967","product_id":100069901,"comment_content":"&quot;é‰´æƒæ¨¡å—é¦–å…ˆä¼šæ ¹æ®ä½ è¯·æ±‚çš„ç”¨æˆ·å aliceï¼Œä» boltdb è·å–åŠ å¯†åçš„å¯†ç ï¼Œå› æ­¤ hash å€¼åŒ…å«äº†ç®—æ³•ç‰ˆæœ¬ã€saltã€cost ç­‰ä¿¡æ¯ï¼Œå› æ­¤å¯ä»¥æ ¹æ®ä½ è¯·æ±‚ä¸­çš„æ˜æ–‡å¯†ç ï¼Œè®¡ç®—å‡ºæœ€ç»ˆçš„ hash å€¼ï¼Œè‹¥è®¡ç®—ç»“æœä¸å­˜å‚¨ä¸€è‡´ï¼Œé‚£ä¹ˆèº«ä»½æ ¡éªŒé€šè¿‡&quot;<br><br>è€å¸ˆï¼Œè¿™ä¸€æ®µä¸å¤ªç†è§£ï¼Œhackerå¦‚æœæ‹¿åˆ°å¯†ç ä¹Ÿå¯çŸ¥é“â€œç®—æ³•ç‰ˆæœ¬ã€saltã€cost ç­‰ä¿¡æ¯â€œï¼Œæ˜¯å¦å¯ä»¥é€šè¿‡baoliç ´è§£åŒ¹é…è®¡ç®—å‡ºhashå€¼ï¼Œå¦‚æœhackeræ‹¿ä¸åˆ°â€œç®—æ³•ç‰ˆæœ¬ã€saltã€cost ç­‰ä¿¡æ¯â€è¿™äº›ä¿¡æ¯ï¼Œé‚£etcdç¨‹åºæ˜¯å¦‚ä½•çŸ¥é“è¿™äº›ä¿¡æ¯ï¼Œæ—¢ç„¶ä¹Ÿå¯ä»¥baoliç ´è§£é‚£è¿˜è¦saltã€cost ç­‰ä¿¡æ¯åšä»€ä¹ˆï¼Ÿ<br><br>","like_count":0,"discussions":[{"author":{"id":1192218,"avatar":"https://static001.geekbang.org/account/avatar/00/12/31/1a/fd82b2d5.jpg","nickname":"åˆ˜å£«æ¶›","note":"","ucode":"6D83F766D189E5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":564246,"discussion_content":"saltéšæœºï¼Œæ‹¿åˆ°åä¹Ÿä¸èƒ½é€šè¿‡æš´åŠ›çš„æ–¹å¼ç ´è§£å‡ºç”¨æˆ·åŸå§‹å¯†ç ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650199723,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":277815,"user_name":"kaizen","can_delete":false,"product_type":"c1","uid":1675966,"ip_address":"","ucode":"313EEA97AEC7C3","user_header":"https://static001.geekbang.org/account/avatar/00/19/92/be/8de4e1fe.jpg","comment_is_top":false,"comment_ctime":1612601699,"is_pvip":true,"replies":[{"id":"100857","content":"å—¯ï¼Œç»†å¿ƒï¼Œæ˜¯)ï¼Œæ„Ÿè°¢åé¦ˆï¼Œå·²ä¿®æ­£","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1612700578,"ip_address":"","comment_id":277815,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1612601699","product_id":100069901,"comment_content":"è€å¸ˆï¼Œè¿™é‡Œç»™èŒƒå›´ key åŠ æƒé™ç”¨çš„[]ï¼Œæˆ‘çœ‹å®˜æ–¹æ–‡æ¡£ç»™çš„ [ ),æ˜¯ä¸¤ç§éƒ½é€‚ç”¨å—<br>The range can be specified as an interval [start-key, end-key) where start-key should be lexically less than end-key in an alphabetical manner.<br><br>","like_count":0,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":515178,"discussion_content":"å—¯ï¼Œç»†å¿ƒï¼Œæ˜¯)ï¼Œæ„Ÿè°¢åé¦ˆï¼Œå·²ä¿®æ­£","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612700578,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":276972,"user_name":"mckee","can_delete":false,"product_type":"c1","uid":1066511,"ip_address":"","ucode":"E4DEBB462B93A1","user_header":"https://static001.geekbang.org/account/avatar/00/10/46/0f/f6cfc659.jpg","comment_is_top":false,"comment_ctime":1612199761,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1612199761","product_id":100069901,"comment_content":"é‡åˆ°çš„é—®é¢˜(k8såœºæ™¯):<br>ä¸»è¦æ˜¯å¯èƒ½ä¼šå‡ºç°apiserver etcd clientè¯ä¹¦å¯èƒ½è¿‡æœŸé—®é¢˜ï¼Œéœ€è¦æœ‰ç›‘æ§æ‰‹æ®µï¼Œéœ€è¦å¯¹å…¶ç»­ç­¾ã€‚å½“ç„¶æ–¹ä¾¿çš„è¯å¯ä»¥ç›´æ¥ç­¾å¾ˆä¹…<br>","like_count":0},{"had_liked":false,"id":276828,"user_name":"Simon","can_delete":false,"product_type":"c1","uid":1068163,"ip_address":"","ucode":"107606167D23E8","user_header":"https://static001.geekbang.org/account/avatar/00/10/4c/83/7788fc66.jpg","comment_is_top":false,"comment_ctime":1612147551,"is_pvip":true,"replies":[{"id":"100498","content":"å¥½çš„ï¼Œæ˜å¤©æ›´æ–°åˆ°05","user_name":"ä½œè€…å›å¤","user_name_real":"å”èª","uid":"1009582","ctime":1612193530,"ip_address":"","comment_id":276828,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1612147551","product_id":100069901,"comment_content":"è€å¸ˆ, ä¸Šä¸€èŠ‚çš„æ€è€ƒé¢˜ç­”æ¡ˆè¿˜æ²¡æœ‰æ›´æ–°å—?","like_count":0,"discussions":[{"author":{"id":1009582,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/ae/37b492db.jpg","nickname":"å”èª","note":"","ucode":"99CB061EDF35EA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514831,"discussion_content":"å¥½çš„ï¼Œæ˜å¤©æ›´æ–°åˆ°05","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612193530,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}