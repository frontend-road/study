{"id":329292,"title":"19 | 量子时代，你准备好了吗？","content":"<p>你好，我是范学雷。</p><p>上一讲，我们讨论了怎么管理对称密钥，强调了要优先使用即用即弃的对称密钥。我们还一起分析了对称密钥的一些问题，相信你也感受到了，其规模化背后的麻烦。</p><p>不过，我们又留了一个小尾巴，就是对称密钥能不能应对未来量子计算时代的计算能力？</p><p>也就是说，现在使用对称密钥加密的数据，在量子计算时代能不能被破解？我们又该怎么保护我们的敏感数据，不受量子计算时代的算力影响？这是我们这一次要讨论的话题。</p><h2>量子算力有多强？</h2><p>要讨论量子计算的影响，我们首先要有一个概念，那就是量子算力有多强。</p><p>2020年12月4日，中国量子计算原型机“九章”问世。理论上，这个计算机比目前最快的计算机还要快一百万亿倍。也比2019年谷歌发布的量子计算原型机“悬铃木”快一百亿倍。</p><p><strong>你看看，现在量子计算的性能提升，是百亿倍这个数量级的。</strong></p><p>还记得我们总提到的安全强度吗？那时候，我们有一个粗略的判断，使用10亿台1纳秒计算一次的计算机，破解128位的安全强度，需要一千万个十亿年。还有同学留言估算，使用目前最快的计算机Fugaku，破解128位的安全强度，需要2500个十亿年。</p><p>而“九章”比目前最快的计算机还要快一百万亿倍，按照这个计算能力，如果我们对照Fugaku计算机，破解128位的安全强度，只需要2.5%的年，也就是大约9天。</p><!-- [[[read_end]]] --><p>量子计算机的研发还在原型阶段，成熟的量子计算机，性能可能还会有大幅度的提高。到了量子计算机成熟的时候，破解128位的安全强度，可能只是微秒或者纳秒级别的计算。</p><p>所以，量子计算时代，128位的安全强度也就不再安全了。</p><p>我们再回顾一下第3讲，欧洲的ECRYPT-CSA的密码安全强度建议。ECRYPT-CSA建议，128位的安全强度的密码学算法可用于2028年之前，2028年之后就要使用256位的安全强度了。这个建议，就是考虑到了量子计算的影响。</p><p>2028年，离现在已经不是很远了。</p><h2>那256位的算法安全吗？</h2><p>是不是说，256位安全强度的密码学算法，在量子计算时代都是安全的？</p><p>想要得出答案，我们还可以使用“九章”量子计算原型机的数据，来估算一下破解256位安全强度的密码学算法需要多长时间。为了简化计算，现在我们假设量子计算机一纳秒就可以破解128位的安全强度，我们有10亿台这样的量子计算机。</p><p>借用我们前面对128位安全强度算法的估算数据，破解256位的安全强度，要一千万个十亿年。</p><p>所以，我们可以有这样一个印象，在量子计算时代，256位的安全强度，大致相当于今天128位的安全强度。今天128位的安全强度，是足够安全的。<strong>在量子计算时代，256位的安全强度也是足够安全的。</strong></p><p>我相信，你应该已经有这样的意识了：攻击者不会只按照算法设计者设计的路线攻击，他们有的是千奇百怪、出乎意料的办法。那么，对于256位的安全强度，有没有密钥算法承受不了量子计算时代的算力的？这个答案是肯定的。</p><p>尤其让人遗憾的是，所有现在流行的非对称密码算法，都不能抵御量子计算时代的算力。</p><p>不过，这和现在的非对称密码算法的设计思路有关系，业界现在也在紧锣密鼓地设计、遴选量子计算时代非对称密码算法。让人欣慰的是，256位安全强度的对称密钥算法和单向散列函数，包括AES算法，在量子计算时代还是安全的。</p><p>非对称密码算法不能抵御量子计算时代的算力，那么由非对称密码推导出来的对称密钥，是不是也不能抵御量子计算时代的算力？回答这个问题之前，我们先来了解一个概念：前向保密性。</p><h2>什么是前向保密性？</h2><p>什么是前向保密性呢？</p><p>在密码学里，前向保密性指的是即使用来协商或者保护数据加密密钥的长期秘密泄漏，也不会导致数据加密密钥的泄漏。换个角度看，虽然数据加密密钥是由长期的秘密衍生出来的或者保护的，但是数据加密密钥不能再一次通过长期秘密推导出来。</p><p>是不是感觉有点绕口，不知道该怎么理解？</p><p>我们来看一看前面讨论过的，从用户口令推导出数据加密对称密钥的算法。每次需要使用这个对称密钥的时候，都可以通过用户口令再次推导出来，而不需要把这个对称密钥保存到硬盘上。</p><p>这个过程就不是前向保密的。如果用户口令泄漏了，这个用来加密数据的对称密钥能够再次被推导出来，对应的加密数据也能够被破解。</p><p>数据加密密钥可以从长期秘密衍生出来，但是又不能再一次推导出来，这听起来有点别扭。</p><p>关键就在于使用用完就丢、而且用完就不能再找回的秘密，比如说随机数。如果随机数也参与数据加密密钥的衍生，只要这个衍生算法是安全的，那这个数据加密密钥也就具有了随机性。</p><p>只要生成这个数据加密密钥的随机数被干干净净地丢弃了，别人就不太可能重新找回这个随机数，也就不能再次推导出同样的数据加密密钥了。</p><p>那单纯地使用随机数生成的数据加密密钥，具不具备前向保密性呢？比如说，如果我们就使用随机数生成的对称密钥，然后保存到读写权限受到限制的保密文件里。每次加密或者解密需要使用对称密钥的时候，我们就把它从文件里读取出来。那么，这样的密钥能不能前向保密呢？</p><p>能反复长时间使用的密钥，就是人们常说的静态密钥，也是我们前面提到过的需要留存的密钥。上面说的，就是一个静态密钥的例子。<strong>静态密钥不能前向保密</strong>，因为，静态的密钥一旦泄漏，数据保密性也就无从谈起了。</p><p>我们把需要留存的密钥排除出去后，那具备前向保密性的密钥一定只能是即用即弃的密钥了。而且，这个密钥的衍生，一定要有即用即弃的随机数的参与。</p><p>这样，我们就找到了具备前向保密性的对称密钥的两个特点：</p><ul>\n<li>密钥的产生需要有即用即弃的随机数的参与；</li>\n<li>密钥的本身是即用即弃的密钥，而不能是静态的密钥。</li>\n</ul><p>具备了这两个特点以后，即使协商或者保护数据加密密钥的长期秘密泄漏，也不会导致数据加密密钥的泄漏。这就大大降低了长期秘密泄漏带来的数据泄密的风险。</p><p>这就是前向保密性要解决的问题。好了，我们讨论了前向保密性。接下来的问题是，前向保密性和抵御量子计算时代的算力，有什么关系呢？</p><h2>怎么使用前向保密性？</h2><p>要想现在就开始筹划抵御量子计算时代的算力的事情，有两件事是一定要考虑的。</p><p><strong>第一件事，就是使用量子时代依旧安全的密码学算法</strong>。我们要使用256位安全强度的对称密钥算法和单向散列函数这样的密码学算法，来确保量子计算时代的算力无法蛮力地破解加密数据。</p><p><strong>第二件事，就是使用具有前向保密性的对称密钥来保护数据，特别是密文能够泄漏的数据</strong>，来确保量子计算时代的算力无法获得加密使用的密钥。</p><p>我们提到，现在流行的非对称密码算法，不能抵御量子计算时代的算力。那基于非对称密码的密钥交换或者密钥协商算法，当然也不能抵御量子计算时代的算力。那么，是不是基于非对称密码的密钥交换或者密钥协商算法衍生出来的对称密钥，也不能抵御量子计算时代的算力呢？</p><p><strong>这要看对称密钥衍生算法的细节</strong>。如果对称密钥的衍生算法里，有即用即弃的随机数的参与，或者用来衍生对称密钥的非对称密钥也是即用即弃的，而且这个对称密钥还是即用即弃的密钥，那使用它加密的数据，也能够抵御量子计算时代的算力。</p><p>具体的算法细节，依赖于我们对非对称密码算法的理解，我们以后有机会再聊。</p><p>到目前为止，这个专栏就接近尾声了。我们从专栏之初就开始操心的牛郎织女约会问题，下一讲来看一看，我们能不能通过在这个专栏里讨论的算法，来解决这个约会难题。</p><h2>Take Away（今日收获）</h2><p>今天，我们讨论了量子计算时代的算力，相信你对量子计算时代的算力有了一个大致的印象。然后，我们还提到了，256位安全强度的对称密钥算法和单向散列函数，包括AES算法，在量子计算时代还是安全的；而非对称密码算法，不能抵御量子计算时代的算力。</p><p>量子计算时代的非对称密码算法目前还在遴选中，而主流的密钥交换算法一般都是建立在非对称密码技术之上的。在后量子时代的非对称密码算法普及之前，我们有没有办法抵御量子计算时代的算力呢？<strong>这个问题的答案，就是要使用具备前向保密性的对称密钥</strong>。</p><p>当然，前向保密性不仅仅是用来应对量子计算时代的算力的。它也是我们现在协议设计和实现里，实现深度防御的一个重要考虑因素。不具备前向保密性的对称密钥，不能使用在加密数据有可能外泄的场景里，这几乎会断送加密的意义。</p><p><strong>所以，对于现在的安全协议来说，要求具备前向保密性是一个硬指标。</strong></p><p>通过今天的讨论，我们要：</p><ul>\n<li>了解量子计算时代的算力；</li>\n<li>知道256位安全强度的对称密钥算法和单向散列函数在量子计算时代还是安全的；</li>\n<li>知道现有的非对称密码算法，不能抵御量子计算时代的算力；</li>\n<li>了解前向保密性要解决的问题和它的特点。</li>\n</ul><h2>思考题</h2><p>今天的思考题，是一个动手题。</p><p>在你正在开发的项目中，或者你关注的开放源代码项目中，试着搜索一下其中的对称密钥是如何产生的、有没有留存、具不具备前向保密性？对称密钥的强度能不能应对量子计算时代的算力？你有什么改进的建议？</p><p>这是一个能够帮助你提前评估量子计算影响的好办法，也能够帮助你为量子时代的计算能力做好准备。欢迎在留言区留言，记录、讨论你的发现和建议。</p><p>好的，今天就这样，我们下次再聊。</p>","neighbors":{"left":{"article_title":"18 | 如何管理对称密钥？","id":328828},"right":{"article_title":"20 | 综合案例：如何解决约会难题？","id":330103}},"comments":[{"had_liked":false,"id":275253,"user_name":"Eclipse","can_delete":false,"product_type":"c1","uid":1589989,"ip_address":"","ucode":"E7EB0BA99FA644","user_header":"https://static001.geekbang.org/account/avatar/00/18/42/e5/61cfe267.jpg","comment_is_top":false,"comment_ctime":1611411565,"is_pvip":false,"replies":[{"id":"99939","content":"这是一个问题，但是一个好的安全协议，不应该出现这样的问题。协商加密密钥的私密的随机数不应该泄漏出去，比如使用非对称密钥的形式来协商。","user_name":"作者回复","user_name_real":"范学雷","uid":"1111315","ctime":1611540482,"ip_address":"","comment_id":275253,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10201346157","product_id":100064801,"comment_content":"长期秘钥泄露，用于协商加密秘钥的随机数在传输过程中不就变成了明文了吗？之后产生的加密秘钥不也就被知道了吗？这样理解，随机数是不是就没什么用了，虽然它能产生一个加密秘钥","like_count":3,"discussions":[{"author":{"id":1111315,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f5/13/78741b7b.jpg","nickname":"范学雷","note":"","ucode":"D7CBE4A33427BD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514283,"discussion_content":"这是一个问题，但是一个好的安全协议，不应该出现这样的问题。协商加密密钥的私密的随机数不应该泄漏出去，比如使用非对称密钥的形式来协商。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611540482,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":276018,"user_name":"佳伦","can_delete":false,"product_type":"c1","uid":1064508,"ip_address":"","ucode":"3AE8098B5BE716","user_header":"https://static001.geekbang.org/account/avatar/00/10/3e/3c/fc3ad983.jpg","comment_is_top":false,"comment_ctime":1611747617,"is_pvip":false,"replies":[{"id":"100303","content":"是的，增长速度跟不上","user_name":"作者回复","user_name_real":"范学雷","uid":"1111315","ctime":1611898819,"ip_address":"","comment_id":276018,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5906714913","product_id":100064801,"comment_content":"非对称加密不安全是因为大质数分解的计算复杂度并不会随着位数的增加指数增长吗？","like_count":2,"discussions":[{"author":{"id":1111315,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f5/13/78741b7b.jpg","nickname":"范学雷","note":"","ucode":"D7CBE4A33427BD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514567,"discussion_content":"是的，增长速度跟不上","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611898819,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":275255,"user_name":"Eclipse","can_delete":false,"product_type":"c1","uid":1589989,"ip_address":"","ucode":"E7EB0BA99FA644","user_header":"https://static001.geekbang.org/account/avatar/00/18/42/e5/61cfe267.jpg","comment_is_top":false,"comment_ctime":1611411888,"is_pvip":false,"replies":[{"id":"99938","content":"没明白这个问题。","user_name":"作者回复","user_name_real":"范学雷","uid":"1111315","ctime":1611540270,"ip_address":"","comment_id":275255,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5906379184","product_id":100064801,"comment_content":"数据加密密钥不能再一次通过长期秘密推导出来。再一次复现是复现不了了，那能不能猜不出下一次的加密秘钥？","like_count":1,"discussions":[{"author":{"id":1111315,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f5/13/78741b7b.jpg","nickname":"范学雷","note":"","ucode":"D7CBE4A33427BD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":514284,"discussion_content":"没明白这个问题。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611540270,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":319670,"user_name":"纳兰容若","can_delete":false,"product_type":"c1","uid":1605876,"ip_address":"","ucode":"2E1EA2CDFDA1A9","user_header":"https://static001.geekbang.org/account/avatar/00/18/80/f4/564209ea.jpg","comment_is_top":false,"comment_ctime":1635906132,"is_pvip":true,"replies":[{"id":"115857","content":"和密钥没有关系，和算法有关系。 现在流行的算法，比如RSA， DSA， 以及ECC，数学上只要计算能力够强大，都是可以破解的，而量子计算的能力，就真的有这么强大。","user_name":"作者回复","user_name_real":"范学雷","uid":"1111315","ctime":1635921967,"ip_address":"","comment_id":319670,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1635906132","product_id":100064801,"comment_content":"老师您好<br>文中说“现在流行的非对称密码算法，不能抵御量子计算时代的算力”<br>这是因为流行的非对称密码算法公私钥一旦生成就不会轻易改变么？","like_count":1,"discussions":[{"author":{"id":1111315,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f5/13/78741b7b.jpg","nickname":"范学雷","note":"","ucode":"D7CBE4A33427BD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529717,"discussion_content":"和密钥没有关系，和算法有关系。 现在流行的算法，比如RSA， DSA， 以及ECC，数学上只要计算能力够强大，都是可以破解的，而量子计算的能力，就真的有这么强大。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635921967,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":282448,"user_name":"thinkers","can_delete":false,"product_type":"c1","uid":1031712,"ip_address":"","ucode":"81159393491E8D","user_header":"https://static001.geekbang.org/account/avatar/00/0f/be/20/8f4e0810.jpg","comment_is_top":false,"comment_ctime":1615254778,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1615254778","product_id":100064801,"comment_content":"老师能选几个现在使用较多的加密聊一下代码实现吗","like_count":0},{"had_liked":false,"id":272502,"user_name":"王啸","can_delete":false,"product_type":"c1","uid":1341532,"ip_address":"","ucode":"6B895624D3260D","user_header":"https://static001.geekbang.org/account/avatar/00/14/78/5c/347b3c66.jpg","comment_is_top":false,"comment_ctime":1610101166,"is_pvip":false,"replies":[{"id":"98884","content":"搜索一下，应该可以找到很多代码。","user_name":"作者回复","user_name_real":"范学雷","uid":"1111315","ctime":1610302102,"ip_address":"","comment_id":272502,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1610101166","product_id":100064801,"comment_content":"有没有java的例子来说明一下这个对称加密的秘钥生成和加密的数据生成？","like_count":0,"discussions":[{"author":{"id":1111315,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f5/13/78741b7b.jpg","nickname":"范学雷","note":"","ucode":"D7CBE4A33427BD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513295,"discussion_content":"搜索一下，应该可以找到很多代码。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1610302102,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1708271,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/10/ef/4c9b2383.jpg","nickname":"Everlaa","note":"","ucode":"9B4FFFABD62B07","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372776,"discussion_content":"有没有感觉这专栏最后讲了个寂寞？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620459962,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":271997,"user_name":"彩色的沙漠","can_delete":false,"product_type":"c1","uid":1116183,"ip_address":"","ucode":"19A0975A5E69EA","user_header":"https://static001.geekbang.org/account/avatar/00/11/08/17/e63e50f3.jpg","comment_is_top":false,"comment_ctime":1609904574,"is_pvip":true,"replies":[{"id":"98657","content":"赞！ DH秘钥交换-&gt;DHE秘钥交换","user_name":"作者回复","user_name_real":"范学雷","uid":"1111315","ctime":1609952763,"ip_address":"","comment_id":271997,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1609904574","product_id":100064801,"comment_content":"在TLS协议里面RSA秘钥交换不是向前保密性的，DH秘钥交换是向前保密性的（每次客户端和服务器端都会生成一堆公私钥，交换公钥之后，就可以能推到除会话秘钥，关键是即用即弃的特点），所以其TLS1.3协议里面已经移除了RSA秘钥交换算法","like_count":0,"discussions":[{"author":{"id":1111315,"avatar":"https://static001.geekbang.org/account/avatar/00/10/f5/13/78741b7b.jpg","nickname":"范学雷","note":"","ucode":"D7CBE4A33427BD","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":513115,"discussion_content":"赞！ DH秘钥交换-&amp;gt;DHE秘钥交换","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609952763,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}