{"id":13626,"title":"08 | 代码与分类：工业级编程的代码分类与特征","content":"<p>编程，就是写代码，那么在真实的行业项目中你编写的这些代码可以如何分类呢？回顾我曾经写过的各种系统代码，按代码的作用，大概都可以分为如下三类：</p>\n<ul>\n<li>功能</li>\n<li>控制</li>\n<li>运维</li>\n</ul>\n<p>如果你想提高编程水平，写出优雅的代码，那么就必须要清晰地认识清楚这三类代码。</p>\n<h2>一、功能</h2>\n<p>功能代码，是实现需求的业务逻辑代码，反映真实业务场景，包含大量领域知识。</p>\n<p>一个程序软件系统，拥有完备的功能性代码仅是基本要求。因为业务逻辑的复杂度决定了功能性代码的复杂度，所以要把功能代码写好，最难的不是编码本身，而是搞清楚功能背后的需求并得到正确的理解。之后的编码活动，就仅是一个“翻译”工作了：把需求“翻译”为代码。</p>\n<p>当然，“翻译” 也有自己独有的技术和积累，并不简单。而且 “翻译” 的第一步要求是 “忠于原文”，也即真正地理解并满足用户的原始需求。可这个第一步的要求实现起来就很困难。</p>\n<p>为什么搞清楚用户需求很困难？因为从用户心里想要的，到他最后得到的之间有一条长长的链条，如下所示：</p>\n<blockquote>\n<p>用户心理诉求 -&gt; 用户表达需求 -&gt; 产品定义需求 -&gt; 开发实现 -&gt; 测试验证 -&gt; 上线发布 -&gt; 用户验收</p>\n</blockquote>\n<p>需求信息源自用户的内心，然后通过表达显性地在这个链条上传递，最终固化成了代码，以程序系统的形态反馈给了用户。</p><!-- [[[read_end]]] -->\n<p>但信息在这个链条中的每个环节都可能会出现偏差与丢失，即使最终整个链条上的各个角色都貌似达成了一致，完成了系统开发、测试和发布，但最终也可能发现用户的心理诉求要么表达错了，要么被理解错了。</p>\n<p>因为我近些年一直在做即时通讯产品（IM），所以在这儿我就以微信这样一个国民级的大家都熟悉的即时通讯产品为样本，举个例子。</p>\n<p>微信里有个功能叫：消息删除。你该如何理解这个功能背后的用户心理诉求呢？用户进行删除操作的期待和反馈又是什么呢？从用户发消息的角度，我理解其删除消息可能的诉求有如下几种：</p>\n<ol>\n<li>消息发错了，不想对方收到。</li>\n<li>消息发了后，不想留下发过的痕迹，但期望对方收到。</li>\n<li>消息已发了，对于已经收到的用户就算了，未收到的最好就别收到了，控制其传播范围。</li>\n</ol>\n<p>对于第一点，微信提供了两分钟内撤回的功能；而第二点，微信提供的删除功能正好满足；第三点，微信并没有满足。我觉着第三点其实是一个伪需求，它其实是第一点不能被满足情况下用户的一种妥协。</p>\n<p>用户经常会把他们的需要，表达成对你的行为的要求，也就是说不真正告诉你要什么，而是告诉你要做什么。所以你才需要对被要求开发的功能进行更深入的思考。有时，即使是日常高频使用的产品背后的需求，你也未必能很好地理解清楚，而更多的业务系统其实离你的生活更远，努力去理解业务及其背后用户的真实需求，才是写好功能代码的基本能力。</p>\n<p>程序存在的意义就在于实现功能，满足需求。而一直以来我们习惯于把完成客户需求作为程序开发的主要任务，当功能实现了便感觉已经完成了开发，但这仅仅是第一步。</p>\n<h2>二、控制</h2>\n<p>控制代码，是控制业务功能逻辑代码执行的代码，即业务逻辑的执行策略。</p>\n<p>编程领域熟悉的各类设计模式，都是在讲关于控制代码的逻辑。而如今，很多这些常用的设计模式基本都被各类开源框架固化了进去。比如，在 Java 中，Spring 框架提供的控制反转（IoC）、依赖注入（DI）就固化了工厂模式。</p>\n<p>通用控制型代码由各种开源框架来提供，程序员就被解放出来专注写好功能业务逻辑。而现今分布式领域流行的微服务架构，各种架构模式和最佳实践也开始出现在各类开源组件中。比如微服务架构模式下关注的控制领域，包括：通信、负载、限流、隔离、熔断、异步、并行、重试、降级。</p>\n<p>以上每个领域都有相应的开源组件代码解决方案，而进一步将控制和功能分离的 “服务网格（Service Mesh）” 架构模式则做到了极致，控制和功能代码甚至运行在了不同的进程中。</p>\n<p>控制代码，都是与业务功能逻辑不直接相关的，但它们和程序运行的性能、稳定性、可用性直接相关。提供一项服务，功能代码满足了服务的功能需求，而控制代码则保障了服务的稳定可靠。</p>\n<p>有了控制和功能代码，程序系统终于能正常且稳定可靠地运行了，但难保不出现异常，这时最后一类 “运维” 型代码便要登场了。</p>\n<h2>三、运维</h2>\n<p>运维代码，就是方便程序检测、诊断和运行时处理的代码。它们的存在，才让系统具备了真正工业级的可运维性。</p>\n<p>最常见的检测诊断性代码，应该就是日志了，打日志太过简单，因此我们通常也就疏于考虑。其实即使是打日志也需要有意识的设计，评估到底应该输出多少日志，在什么位置输出日志，以及输出什么级别的日志。</p>\n<p>检测诊断代码有一个终极目标，就是让程序系统完成运行时的自检诊断。这是完美的理想状态，却很难在现实中完全做到。</p>\n<p>因为它不仅仅受限于技术实现水平，也与实现的成本和效益比有关。所以，我们可以退而求其次，至少在系统异常时可以具备主动运行状态汇报能力，由开发和运维人员来完成诊断分析，这也是我们常见的各类系统或终端软件提供的机制。</p>\n<p>在现实中，检测诊断类代码经常不是一开始就主动设计的。但生产环境上的程序系统可能会偶然出现异常或故障，而因为一开始缺乏检测诊断代码输出，所以很难找到真实的故障原因。现实就这样一步一步逼着你去找到真实原因，于是检测诊断代码就这么被一次又一次地追问为什么而逐渐完善起来了。</p>\n<p>但如果一开始你就进行有意识地检测诊断设计，后面就会得到更优雅的实现。有一种编程模式：面向切面编程（AOP），通过早期的有意设计，可以把相当范围的检测诊断代码放入切面之中，和功能、控制代码分离，保持优雅的边界与距离。</p>\n<p>而对于特定的编程语言平台，比如 Java 平台，有字节码增强相关的技术，可以完全干净地把这类检测诊断代码和功能、控制代码彻底分离。</p>\n<p>运维类代码的另一种类，是方便在运行时，对系统行为进行改变的代码。通常这一类代码提供方便运维操作的 API 服务，甚至还会有专门针对运维提供的服务和应用，例如：备份与恢复数据、实时流量调度等。</p>\n<p>功能、控制、运维，三类代码，在现实的开发场景中优先级这样依次排序。有时你可能仅仅完成了第一类功能代码就迫于各种压力上线发布了，但你要在内心谨记，少了后两类代码，将来都会是负债，甚至是灾难。而一个满足工业级强度的程序系统，这三类代码，一个也不能少。</p>\n<p>而对三类代码的设计和实现，越是优雅的程序，这三类代码在程序实现中就越是能看出明显的边界。为什么需要边界？因为，“码以类聚，人以群分”。功能代码易变化，控制代码固复杂，运维代码偏繁琐，这三类不同的代码，不仅特征不同，而且编写它们的人（程序员）也可能分属不同群组，有足够的边界与距离才能避免耦合与混乱。</p>\n<p>而在程序这个理性世界中，优雅有时就是边界与距离。</p>\n<p></p>\n","comments":[{"had_liked":false,"id":21186,"user_name":"WolvesLeader","can_delete":false,"product_type":"c1","uid":1103839,"ip_address":"","ucode":"33610E19CA2E96","user_header":"https://static001.geekbang.org/account/avatar/00/10/d7/df/fc0a6709.jpg","comment_is_top":false,"comment_ctime":1534956814,"is_pvip":false,"replies":[{"id":"7545","content":"那就看看一些标准库或开源代码，找找好的感觉","user_name":"作者回复","user_name_real":"mindwind","uid":"1001723","ctime":1535020678,"ip_address":"","comment_id":21186,"utype":1}],"discussion_count":1,"race_medal":0,"score":"57369531662","product_id":100012101,"comment_content":"怎么判断一个代码的好坏，我总是不知道自己写的代码是不好还是好","like_count":13,"discussions":[{"author":{"id":1001723,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/fb/747fdba8.jpg","nickname":"mindwind","note":"","ucode":"21236147DFD116","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":422569,"discussion_content":"那就看看一些标准库或开源代码，找找好的感觉","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1535020678,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":20723,"user_name":"艾尔欧唯伊","can_delete":false,"product_type":"c1","uid":1139716,"ip_address":"","ucode":"5BD50691342461","user_header":"https://static001.geekbang.org/account/avatar/00/11/64/04/18875529.jpg","comment_is_top":false,"comment_ctime":1534695093,"is_pvip":false,"replies":[{"id":"7369","content":"很多时候，运维类代码都成了技术债","user_name":"作者回复","user_name_real":"mindwind","uid":"1001723","ctime":1534849120,"ip_address":"","comment_id":20723,"utype":1}],"discussion_count":1,"race_medal":0,"score":"48779335349","product_id":100012101,"comment_content":"感觉运维代码是最复杂，但是前期是最看不到收益的的。。。<br>但是却很重要，特别是项目规模上去之后。。。","like_count":12,"discussions":[{"author":{"id":1001723,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/fb/747fdba8.jpg","nickname":"mindwind","note":"","ucode":"21236147DFD116","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":422379,"discussion_content":"很多时候，运维类代码都成了技术债","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1534849120,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":21110,"user_name":"third","can_delete":false,"product_type":"c1","uid":1025114,"ip_address":"","ucode":"9A37408A834F0B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/a4/5a/e708e423.jpg","comment_is_top":false,"comment_ctime":1534922047,"is_pvip":false,"replies":[{"id":"7443","content":"😄，哈哈，经典的福特之问","user_name":"作者回复","user_name_real":"mindwind","uid":"1001723","ctime":1534933666,"ip_address":"","comment_id":21110,"utype":1}],"discussion_count":1,"race_medal":0,"score":"44484595007","product_id":100012101,"comment_content":"突然想起了，福特曾经说过的一句话，如果我们去问顾客想要什么，他们会告诉我们想要一辆更好的马车，而不是汽车。","like_count":11,"discussions":[{"author":{"id":1001723,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/fb/747fdba8.jpg","nickname":"mindwind","note":"","ucode":"21236147DFD116","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":422541,"discussion_content":"😄，哈哈，经典的福特之问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1534933666,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":20856,"user_name":"钱","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1534776472,"is_pvip":false,"replies":[{"id":"7367","content":"恩；业务大了后，都会工具化和平台化，才会有规模效应","user_name":"作者回复","user_name_real":"mindwind","uid":"1001723","ctime":1534848811,"ip_address":"","comment_id":20856,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23009612952","product_id":100012101,"comment_content":"恩，讲的很好！一门语言学会后，编程的困难在于对业务逻辑的理解，尤其对于业务背景和整体流程的理解，决定了业务抽象的层次的高低，和看问题的深浅程度！<br>大厂应该都有基础架构平台，各种维护性代码应该比较容易加，让业务工程师专注于业务。","like_count":6,"discussions":[{"author":{"id":1001723,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/fb/747fdba8.jpg","nickname":"mindwind","note":"","ucode":"21236147DFD116","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":422425,"discussion_content":"恩；业务大了后，都会工具化和平台化，才会有规模效应","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1534848811,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":74514,"user_name":"阿信","can_delete":false,"product_type":"c1","uid":1399663,"ip_address":"","ucode":"CC7B15CE63264B","user_header":"https://static001.geekbang.org/account/avatar/00/15/5b/6f/113e24e6.jpg","comment_is_top":false,"comment_ctime":1552229507,"is_pvip":false,"replies":[{"id":"27619","content":"嗯，理解很对","user_name":"作者回复","user_name_real":"mindwind","uid":"1001723","ctime":1552472233,"ip_address":"","comment_id":74514,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14437131395","product_id":100012101,"comment_content":"总结：<br>对于最终需要交付运行的程序代码，<br>从代码的用途(or使用场景)上将作者代码分为三种：功能代码、控制代码、运维代码。<br>功能代码，满足于用户需求，为实现特定的业务功能而开发。<br>控制代码，对代码执行流的控制，如并行、异步、限流、熔断、超时控制等。RPC、中间件、代理服务器等，应该是对代码执行流的控制。控制代码的需求，是从众多(已有的或预见的)功能开发中提炼而来，基于一些共性的特征抽取。源于功能而高于功能。<br>运维代码，用于解决运行过程中出现的问题，或者为解决问题提供必要的信息。<br><br>结合工作，我们做的防重组件，是控制代码。基于pinpoint实现链路跟踪，是对业界已有的运维代码成果的使用","like_count":4,"discussions":[{"author":{"id":1001723,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/fb/747fdba8.jpg","nickname":"mindwind","note":"","ucode":"21236147DFD116","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442586,"discussion_content":"嗯，理解很对","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552472233,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":20773,"user_name":"胖","can_delete":false,"product_type":"c1","uid":1044068,"ip_address":"","ucode":"0EA8F5343CB4F4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ee/64/2646f6ef.jpg","comment_is_top":false,"comment_ctime":1534742404,"is_pvip":false,"replies":[{"id":"7368","content":"有空时，就忘了……😂","user_name":"作者回复","user_name_real":"mindwind","uid":"1001723","ctime":1534849057,"ip_address":"","comment_id":20773,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14419644292","product_id":100012101,"comment_content":"项目时间太紧的一个后遗症就是deadline 只能保证功能代码调通。运维代码缺失，大量fixme：有空时再补日志，有空时再补错误码，有空时再补国际化，有空时……","like_count":4,"discussions":[{"author":{"id":1001723,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/fb/747fdba8.jpg","nickname":"mindwind","note":"","ucode":"21236147DFD116","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":422402,"discussion_content":"有空时，就忘了……😂","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1534849057,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":87200,"user_name":"吴封斌","can_delete":false,"product_type":"c1","uid":1351023,"ip_address":"","ucode":"1E970AAC279F05","user_header":"https://static001.geekbang.org/account/avatar/00/14/9d/6f/bc1e5108.jpg","comment_is_top":false,"comment_ctime":1555547619,"is_pvip":false,"replies":[{"id":"31515","content":"那可能是你还没怎么写过类似的代码，所以觉得抽象，不着急，多做些事情，多写点代码，会恍然的😄","user_name":"作者回复","user_name_real":"mindwind","uid":"1001723","ctime":1555653427,"ip_address":"","comment_id":87200,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10145482211","product_id":100012101,"comment_content":"第二次拜读这篇文章，但对于控制，和运维还不是很明白😭，作者可以在形象化点说明吗？😊","like_count":2,"discussions":[{"author":{"id":1001723,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/fb/747fdba8.jpg","nickname":"mindwind","note":"","ucode":"21236147DFD116","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447343,"discussion_content":"那可能是你还没怎么写过类似的代码，所以觉得抽象，不着急，多做些事情，多写点代码，会恍然的😄","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1555653427,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":74299,"user_name":"小伟","can_delete":false,"product_type":"c1","uid":1359701,"ip_address":"","ucode":"124953423491E2","user_header":"https://static001.geekbang.org/account/avatar/00/14/bf/55/198c6104.jpg","comment_is_top":false,"comment_ctime":1552183773,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10142118365","product_id":100012101,"comment_content":"控制不仅仅是业务逻辑代码的控制，还包括性能、容错等方面的控制。而且业务代码里也包含了逻辑步骤的控制，界定控制的边界是关键。赞同老师最后一句的观点，但落地需要一些好的方法论，后面继续学习。","like_count":2},{"had_liked":false,"id":63658,"user_name":"予悠悠","can_delete":false,"product_type":"c1","uid":1211755,"ip_address":"","ucode":"93D785F354E225","user_header":"https://static001.geekbang.org/account/avatar/00/12/7d/6b/648c30bc.jpg","comment_is_top":false,"comment_ctime":1548439026,"is_pvip":false,"replies":[{"id":"27411","content":"比如并发，互斥，流控，隔离等控制代码执行的代码","user_name":"作者回复","user_name_real":"mindwind","uid":"1001723","ctime":1552371357,"ip_address":"","comment_id":63658,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10138373618","product_id":100012101,"comment_content":"没有完全理解控制代码究竟是哪一类代码。胡老师可以举更多的例子解释吗？","like_count":3,"discussions":[{"author":{"id":1001723,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/fb/747fdba8.jpg","nickname":"mindwind","note":"","ucode":"21236147DFD116","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":437674,"discussion_content":"比如并发，互斥，流控，隔离等控制代码执行的代码","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552371357,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":23260,"user_name":"liangjf","can_delete":false,"product_type":"c1","uid":1058812,"ip_address":"","ucode":"681A6CCF098F55","user_header":"https://static001.geekbang.org/account/avatar/00/10/27/fc/b8d83d56.jpg","comment_is_top":false,"comment_ctime":1536239747,"is_pvip":false,"replies":[{"id":"8508","content":"恩，刚开始都是这样的","user_name":"作者回复","user_name_real":"mindwind","uid":"1001723","ctime":1536415018,"ip_address":"","comment_id":23260,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10126174339","product_id":100012101,"comment_content":"刚出来工作的我只想尽快熟悉各个业务功能，然后串起来，理清整个框架","like_count":2,"discussions":[{"author":{"id":1001723,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/fb/747fdba8.jpg","nickname":"mindwind","note":"","ucode":"21236147DFD116","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423484,"discussion_content":"恩，刚开始都是这样的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1536415018,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":22186,"user_name":"like_jun","can_delete":false,"product_type":"c1","uid":1195771,"ip_address":"","ucode":"3D72B215774E1B","user_header":"https://static001.geekbang.org/account/avatar/00/12/3e/fb/51f8dfe7.jpg","comment_is_top":false,"comment_ctime":1535541754,"is_pvip":false,"replies":[{"id":"8000","content":"^_^","user_name":"作者回复","user_name_real":"mindwind","uid":"1001723","ctime":1535617746,"ip_address":"","comment_id":22186,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10125476346","product_id":100012101,"comment_content":"一直纠结这个。终于看到了答案。","like_count":2,"discussions":[{"author":{"id":1001723,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/fb/747fdba8.jpg","nickname":"mindwind","note":"","ucode":"21236147DFD116","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423034,"discussion_content":"^_^","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1535617746,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":20956,"user_name":"Michael","can_delete":false,"product_type":"c1","uid":1015222,"ip_address":"","ucode":"27EB4A725CE14E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7d/b6/abdebdeb.jpg","comment_is_top":false,"comment_ctime":1534827291,"is_pvip":false,"replies":[{"id":"7366","content":"所有的代码都需要一定程度的抽象思维","user_name":"作者回复","user_name_real":"mindwind","uid":"1001723","ctime":1534848112,"ip_address":"","comment_id":20956,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10124761883","product_id":100012101,"comment_content":"于现阶段的我而言 我觉得更难的是针对业务逻辑的抽象和实现 把业务逻辑的实现和业务相对应 和PM脑子里的概念相对应 让后来的人能看代码就能知道业务的所有规则 清晰明确的掌握业务 这个是最难的","like_count":2,"discussions":[{"author":{"id":1001723,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/fb/747fdba8.jpg","nickname":"mindwind","note":"","ucode":"21236147DFD116","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":422470,"discussion_content":"所有的代码都需要一定程度的抽象思维","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1534848112,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":268524,"user_name":"Hank_Yan","can_delete":false,"product_type":"c1","uid":1110662,"ip_address":"","ucode":"86899B561C502B","user_header":"https://static001.geekbang.org/account/avatar/00/10/f2/86/d689f77e.jpg","comment_is_top":false,"comment_ctime":1608247930,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5903215226","product_id":100012101,"comment_content":"讲到心底里面了。去年就买了专栏，看了几章没什么感觉。经过一年的成长，再回过头看老师的文章，简直字字珠玑，不舍得跳过一段话，哈哈哈","like_count":2},{"had_liked":false,"id":158829,"user_name":"今之人兮","can_delete":false,"product_type":"c1","uid":1205542,"ip_address":"","ucode":"140DBBE133E1FE","user_header":"https://static001.geekbang.org/account/avatar/00/12/65/26/2e9bc97f.jpg","comment_is_top":false,"comment_ctime":1575460813,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5870428109","product_id":100012101,"comment_content":"拐回来又看一遍，还是受益良多。<br>平常很多时候都是写完功能代码就急着被催上线，现在更会注意一些三码齐全。希望coding越来越好","like_count":1},{"had_liked":false,"id":23741,"user_name":"杨城","can_delete":false,"product_type":"c1","uid":1193043,"ip_address":"","ucode":"64E6FFD691C164","user_header":"https://static001.geekbang.org/account/avatar/00/12/34/53/cb70eeb9.jpg","comment_is_top":false,"comment_ctime":1536628294,"is_pvip":false,"replies":[{"id":"8694","content":"不用太刻意去平衡，哪里的需求更强烈就投入到哪。业务和技术是价值链上的两个环节，两个环比一个环更有价值","user_name":"作者回复","user_name_real":"mindwind","uid":"1001723","ctime":1536663597,"ip_address":"","comment_id":23741,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5831595590","product_id":100012101,"comment_content":"老师对代码分类的很清晰👍<br>接触到的大部分程序员都希望更多的编写高技术含量的控制代码，会觉得写业务代码比较枯燥没啥技术含量，而且每个公司业务并不通用，请问老师我们平时学习中应该怎么平衡在学习两者上投入的时间精力呢？","like_count":2,"discussions":[{"author":{"id":1001723,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/fb/747fdba8.jpg","nickname":"mindwind","note":"","ucode":"21236147DFD116","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":423703,"discussion_content":"不用太刻意去平衡，哪里的需求更强烈就投入到哪。业务和技术是价值链上的两个环节，两个环比一个环更有价值","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1536663597,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":23070,"user_name":"crysSuenny","can_delete":false,"product_type":"c1","uid":1121252,"ip_address":"","ucode":"ED92E688B9BD6B","user_header":"https://static001.geekbang.org/account/avatar/00/11/1b/e4/d5e021f9.jpg","comment_is_top":false,"comment_ctime":1536135626,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5831102922","product_id":100012101,"comment_content":"&quot;因为从用户心里想要的，到他最后得到的之间有一条长长的链条<br>极客时间版权所有: https:&#47;&#47;time.geekbang.org&#47;column&#47;article&#47;13626<br>&quot;,看到这一点，您遇到过用户具备甲方攻城狮的情形么；是不是若产品经理不打算偷懒的话，甲方攻城狮那边其实没有技术职责？从技术上来讲，形同虚设是不是噢。。","like_count":1},{"had_liked":false,"id":20907,"user_name":"登高","can_delete":false,"product_type":"c1","uid":1068600,"ip_address":"","ucode":"CD40046238BA18","user_header":"https://static001.geekbang.org/account/avatar/00/10/4e/38/3faa8377.jpg","comment_is_top":false,"comment_ctime":1534813325,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5829780621","product_id":100012101,"comment_content":"最近的编程中这三个方面都体验到，如何分离不太懂","like_count":1},{"had_liked":false,"id":20850,"user_name":"monkeyking","can_delete":false,"product_type":"c1","uid":1196221,"ip_address":"","ucode":"4AF7ECF79C4379","user_header":"https://static001.geekbang.org/account/avatar/00/12/40/bd/acb9d02a.jpg","comment_is_top":false,"comment_ctime":1534775004,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5829742300","product_id":100012101,"comment_content":"如何让开发正确理解产品的需求有哪些好的方式呢","like_count":1},{"had_liked":false,"id":291280,"user_name":"米哈游牛浚亲","can_delete":false,"product_type":"c1","uid":1065334,"ip_address":"","ucode":"FF5962C8A1E626","user_header":"https://static001.geekbang.org/account/avatar/00/10/41/76/d5cfd0f7.jpg","comment_is_top":false,"comment_ctime":1620179219,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1620179219","product_id":100012101,"comment_content":"总结：<br>程序代码大致上可以被分为三大类：功能，控制和运维代码。<br><br>功能代码：<br>功能代码是指实现基本需求的代码，是具体的业务逻辑；程序员在编写功能代码的时候更多的从事的，是一种翻译操作，将用户需求“翻译”成为代码和最终上线的功能，而在这个过程中，最难的不是编写代码的部分，而是理解用户真正的需求。用户的需求从最原始的心理需求到最后验收的功能模块之间存在一个长长的链路，这个链路中每一步都可能出现信息的偏差和缺失，这样导致最终交付的代码和用户最初心里期望的可能会大相径庭。<br>而对于业务功能模块代码，不应只着重于业务代码的编写，而是应该做到真正地理解并满足用户的原始需求。甚至后者对于程序员来说可能占有更高的比重。<br><br>控制代码：<br>功能模块是实现业务逻辑的代码，而控制代码则是决定了代码的执行策略，决定了程序的流向。在现代工业级代码中，控制的相关代码往往都被封装在了框架的底层，使得程序员被解放出来可以专注在业务功能代码上。控制模块在抽象的层面上具有一定的相似性，是因为各个框架都会最终偏向于当下时间节点对应模式框架的最佳实践方案。比如微服务架构模式下关注的控制领域，包括：通信、负载、限流、隔离、熔断、异步、并行、重试、降级。<br>控制代码都是与业务功能逻辑不直接相关的，但它们和程序运行的性能、稳定性、可用性直接相关。提供一项服务，功能代码满足了服务的功能需求，而控制代码则保障了服务的稳定可靠。<br><br>运维代码：<br>运维代码是实现了开发和运维人员对系统及模块后期维护的相关功能，让程序具备了工业级别上的可维护性。一个简单的例子就是日志系统的设计。 <br>运维代码的一个种类是对于异常的处理，这类运维代码的最终目标是能够让系统实现运行时的自我诊断与修复。但这样的功能在实现上存在着一系列的困难。在现实中往往退而求其次，要求系统至少具有针对错误的准确定位与上报（工业级运维代码的最基本诉求）。<br>运维代码的另外一个种类则是对系统在运行时进行改变的种类，通常这一类代码提供方便运维操作的 API 服务，甚至还会有专门针对运维提供的服务和应用，例如：备份与恢复数据、实时流量调度等。<br><br>对于 功能、控制、运维 三种类型的代码，需要依次的实现，在现实中可能存在某些情况，在完成功能模块后就迫于压力上线。需要记住的是，缺少了后面两类的任意一种，都是技术负债（坑），甚至说可能是灾难。<br>对于整体的设计，秉承一个高内聚，低耦合的设计理念；对于不同类型的代码，需要有明确的界限；因为三种类型代码具有各自的特点：功能代码易变化，控制代码固复杂，运维代码偏繁琐，有足够的边界与距离才能避免耦合与混乱。<br>对于上诉思想，可以由AOP的编程模式来快速实现，通过早期的有意设计，可以把相当范围的检测诊断代码放入切面之中，和功能、控制代码分离，保持优雅的边界与距离。<br>","like_count":0},{"had_liked":false,"id":280510,"user_name":"Sch0ng","can_delete":false,"product_type":"c1","uid":1145554,"ip_address":"","ucode":"73F6113931B1AC","user_header":"https://static001.geekbang.org/account/avatar/00/11/7a/d2/4ba67c0c.jpg","comment_is_top":false,"comment_ctime":1614237928,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614237928","product_id":100012101,"comment_content":"此文的意义在于把我们日常接触的代码从功能的角度做出划分，而且划分符合MECE法则（相互独立，完全穷尽）。对于代码，在做任务分解的时候，你打开了一扇新世界的大门，知道可以分为功能代码、逻辑代码和运维代码。帮助你化整为零，分而治之，逐个击破。","like_count":0},{"had_liked":false,"id":239203,"user_name":"arthinking","can_delete":false,"product_type":"c1","uid":1193209,"ip_address":"","ucode":"0C6D03B08D952F","user_header":"https://static001.geekbang.org/account/avatar/00/12/34/f9/5092315a.jpg","comment_is_top":false,"comment_ctime":1596458101,"is_pvip":false,"replies":[{"id":"89168","content":"代码就是要让别人容易看懂啊","user_name":"作者回复","user_name_real":"mindwind","uid":"1001723","ctime":1597303713,"ip_address":"","comment_id":239203,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1596458101","product_id":100012101,"comment_content":"是不是我写的代码别人一看就懂，这样的代码就不是好代码呀","like_count":0,"discussions":[{"author":{"id":1001723,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/fb/747fdba8.jpg","nickname":"mindwind","note":"","ucode":"21236147DFD116","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503021,"discussion_content":"代码就是要让别人容易看懂啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597303713,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":201874,"user_name":"kissingers","can_delete":false,"product_type":"c1","uid":1135299,"ip_address":"","ucode":"615151808CF628","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKzqiaZnBw2myRWY802u48Rw3W2zDtKoFQ6vN63m4FdyjibM21FfaOYe8MbMpemUdxXJeQH6fRdVbZA/132","comment_is_top":false,"comment_ctime":1585871167,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585871167","product_id":100012101,"comment_content":"不是应该功能代码，异常代码，维护代码吗？","like_count":0},{"had_liked":false,"id":200755,"user_name":"三件事","can_delete":false,"product_type":"c1","uid":1055819,"ip_address":"","ucode":"BCC867C8961A24","user_header":"https://static001.geekbang.org/account/avatar/00/10/1c/4b/2e5df06f.jpg","comment_is_top":false,"comment_ctime":1585646623,"is_pvip":false,"replies":[{"id":"75940","content":"适当的去和产品反思，质疑，讨论，不影响砍柴，而且有可能会减少砍柴的量","user_name":"作者回复","user_name_real":"mindwind","uid":"1001723","ctime":1586153358,"ip_address":"","comment_id":200755,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1585646623","product_id":100012101,"comment_content":"“努力去理解业务及其背后用户的真实需求，才是写好功能代码的基本能力” 老师，我有两个问题：<br><br>1. 如何理解用户背后真实的需求？<br>2. 如果我们跟产品对用户背后需求理解不一样，怎么跟产品讨论？根据我自己的经验，往往就变成了你是砍柴的，产品是放羊的。讨论下来人家的羊吃饱了，你的柴一个没坎。","like_count":0,"discussions":[{"author":{"id":1001723,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/fb/747fdba8.jpg","nickname":"mindwind","note":"","ucode":"21236147DFD116","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490126,"discussion_content":"适当的去和产品反思，质疑，讨论，不影响砍柴，而且有可能会减少砍柴的量","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586153358,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86635,"user_name":"Corsica","can_delete":false,"product_type":"c1","uid":1014990,"ip_address":"","ucode":"D776F9C6A8ECEC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7c/ce/376842fb.jpg","comment_is_top":false,"comment_ctime":1555415894,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1555415894","product_id":100012101,"comment_content":"代码归类：<br><br>功能<br>控制<br>运维","like_count":0},{"had_liked":false,"id":66960,"user_name":"乔良qiaoliang","can_delete":false,"product_type":"c1","uid":1075315,"ip_address":"","ucode":"DDE301B3DF57A8","user_header":"https://static001.geekbang.org/account/avatar/00/10/68/73/3cda533e.jpg","comment_is_top":false,"comment_ctime":1550048193,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1550048193","product_id":100012101,"comment_content":"业务，控制，运维三个层面的划分好清楚","like_count":0},{"had_liked":false,"id":39047,"user_name":"CrazyCodes","can_delete":false,"product_type":"c1","uid":1081205,"ip_address":"","ucode":"C9C0E72522EB5B","user_header":"https://static001.geekbang.org/account/avatar/00/10/7f/75/551c5d6c.jpg","comment_is_top":false,"comment_ctime":1542178440,"is_pvip":false,"replies":[{"id":"14088","content":"🤝","user_name":"作者回复","user_name_real":"mindwind","uid":"1001723","ctime":1542274573,"ip_address":"","comment_id":39047,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1542178440","product_id":100012101,"comment_content":"优雅就是边界与距离，最后一句话说的真好<br>","like_count":1,"discussions":[{"author":{"id":1001723,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/fb/747fdba8.jpg","nickname":"mindwind","note":"","ucode":"21236147DFD116","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428892,"discussion_content":"🤝","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1542274573,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":33812,"user_name":"helloworld","can_delete":false,"product_type":"c1","uid":1015754,"ip_address":"","ucode":"00DF2FEC58D2E6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg","comment_is_top":false,"comment_ctime":1539907160,"is_pvip":false,"replies":[{"id":"12158","content":"分水岭不是一日形成的","user_name":"作者回复","user_name_real":"mindwind","uid":"1001723","ctime":1539951522,"ip_address":"","comment_id":33812,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1539907160","product_id":100012101,"comment_content":"大部分的程序员都停留在了功能代码上，迫于时间压力忽略了控制代码的重要性，时间长了，就出现分水岭了。","like_count":1,"discussions":[{"author":{"id":1001723,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/48/fb/747fdba8.jpg","nickname":"mindwind","note":"","ucode":"21236147DFD116","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":427057,"discussion_content":"分水岭不是一日形成的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539951522,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1008468,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/63/54/c9475cd0.jpg","nickname":"cz","note":"","ucode":"96385190176F78","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578686,"discussion_content":"重构时， 把业务代码内聚， 抽离出来了专门的业务流程控制代码， 用于控制异步、业务开关、业务降级等操作， 感觉代码好维护了很多。 \n重构最大的感受是业务代码要内聚， 逻辑分散的业务代码太难维护了。\n\n本来还在总结自己的小技巧，没想到老师已经总结好了  - 「控制代码」。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656944110,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}