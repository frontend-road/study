{"id":522343,"title":"36ï½œå®æˆ˜ä¸­çš„TDDï¼šRESTful Web Services","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å¾æ˜Šã€‚é€šè¿‡å‰é¢çš„é¡¹ç›®ç»ƒä¹ ï¼Œæˆ‘ä»¬å®Œæˆäº†DI Containerçš„åŠŸèƒ½ã€‚ä»è¿™èŠ‚è¯¾å¼€å§‹ï¼Œæˆ‘ä»¬å°±è¿›å…¥RESTful Web Servicesçš„å¼€å‘ã€‚</p><h2>æ•´ä½“åŠŸèƒ½ä»‹ç»</h2><p>åœ¨DI Containerçš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬å‚è€ƒäº†Jakarta Dependency Injectionä½œä¸ºåŠŸèƒ½ä¾æ®ã€‚åœ¨RESTful Web Serviceséƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†ä¼šå‚è€ƒJakarta RESTful Web Servicesã€‚</p><p>Jakarta RESTful Web Servicesçš„åŠŸèƒ½æ¯”Jakarta Dependency Injectionè¦åºæ‚ä¸€äº›ï¼Œå¦‚è§†é¢‘ä¸­æ‰€æ¼”ç¤ºçš„ï¼Œæˆ‘å°†ä»ä¸‰ä¸ªéƒ¨åˆ†æ¥è®²è§£è¯´æ˜ï¼š</p><p><video poster=\"https://media001.geekbang.org/9deec6681ac24038a675224d98b0ec71/snapshots/549820c28fae49269ca51bffd2057232-00005.jpg\" preload=\"none\" controls=\"\"><source src=\"https://media001.geekbang.org/customerTrans/7e27d07d27d407ebcc195a0e78395f55/31a6d78d-18112dc4831-0000-0000-01d-dbacd.mp4\" type=\"video/mp4\"><source src=\" https://media001.geekbang.org/639594971e7c49ca8e76790818dfad7c/4a43e220b81143a2bc93f706e7768be4-c00956a43345c90f2edf85cc23005da3-sd.m3u8\" type=\"application/x-mpegURL\"></video></p><p>ç»è¿‡å¤šå¹´å‘å±•ï¼ŒJakarta RESTful Web Servicesä¹Ÿå˜å¾—æ—¥æ¸å¤æ‚ï¼Œå…¶ä¸­æœ‰äº›â€œé«˜çº§â€ç‰¹æ€§å¾ˆå°‘åº”ç”¨ï¼Œåœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­éœ€è¦åšä¸€äº›å–èˆï¼š</p><p><video poster=\"https://media001.geekbang.org/3e22a3a8bc7b46f79dd9390703e18830/snapshots/d67c0769103a4b89b3a416855d686a54-00005.jpg\" preload=\"none\" controls=\"\"><source src=\"https://media001.geekbang.org/customerTrans/7e27d07d27d407ebcc195a0e78395f55/26894340-18112dc44d6-0000-0000-01d-dbacd.mp4\" type=\"video/mp4\"><source src=\" https://media001.geekbang.org/ece1ee47c0a0450284513d7b02d25049/55e1d22b63324d46a6b394e20cfc5e6f-f6941c38140762d39f7786678ab5a17f-sd.m3u8\" type=\"application/x-mpegURL\"></video></p><p>é‚£ä¹ˆä¸‹é¢è¿™æ®µä»£ç å±•ç¤ºäº†æˆ‘ä»¬éœ€è¦å®ç°çš„ä¸»è¦åŠŸèƒ½ï¼Œå¹¶æä¾›äº†ç›¸åº”çš„æ‰©å±•èƒ½åŠ›ï¼š</p><pre><code>public class UserOrdersResource {\n    private User user;\n    @Context\n    private Orders orders;\n    @Context\n    private Products products;\n    public UserOrdersResource(User user) {\n        this.user = user;\n    }\n    @GET\n    @Produces(MediaType.APPLICATION_JSON)\n    public CollectionModel&lt;Order&gt; all() {\n        return CollectionModel.of(orders.findBy(user.getId()))\n                .add(Link.of(&quot;/users/{id}/orders&quot;).expand(user.getId().value()),\n                        Link.of(&quot;/users/{id}&quot;, &quot;owner&quot;).expand(user.getId().value()));\n    }\n    @GET\n    @Path(&quot;/{id}&quot;)\n    @Produces(MediaType.APPLICATION_JSON)\n    public EntityModel&lt;Order&gt; findBy(@PathParam(&quot;id&quot;) long id) {\n        return orders.findBy(user.getId(), new Order.Id(id))\n                .map(o -&gt; EntityModel.of(o)\n                        .add(Link.of(&quot;/users/{id}/orders/{id}&quot;).expand(user.getId().value(), id),\n                                Link.of(&quot;/users/{id}&quot;, &quot;owner&quot;).expand(user.getId().value())))\n                .orElse(null);\n    }\n    @POST\n    @Consumes(MediaType.APPLICATION_FORM_URLENCODED)\n    public Response placeOrder(@FormParam(&quot;item&quot;) List&lt;Long&gt; items, @FormParam(&quot;quantity&quot;) List&lt;Double&gt; quantities) {\n        List&lt;Product&gt; products = this.products.find(items.stream().map(Product.Id::new).toList());\n        Map&lt;Product, Double&gt; orderItems = new HashMap&lt;&gt;();\n        for (int i = 0; i &lt; products.size(); i++)\n            orderItems.put(products.get(i), quantities.get(i));\n        Order order = orders.create(user, orderItems);\n        return Response.created(Link.of(&quot;/users/{uid}/orders/{oid}&quot;).expand(user.getId().value(), order.getId().value()).toUri()).build();\n    }\n}\n    \npublic class UserResource {\n    private User user;\n    public UserResource(User user) {\n        this.user = user;\n    }\n    @GET\n    @Produces(MediaType.APPLICATION_JSON)\n    public EntityModel&lt;User&gt; get() {\n        return EntityModel.of(user).add(Link.of(&quot;/users/{value}&quot;).expand(user.getId().value()));\n    }\n    @Path(&quot;/orders&quot;)\n    public UserOrdersResource orders(@Context ResourceContext context) {\n        return context.initResource(new UserOrdersResource(user));\n    }\n}\n    \n@Path(&quot;/users&quot;)\npublic class UsersResource {\n    @Context\n    private Users users;\n    @Path(&quot;{id}&quot;)\n    public UserResource findById(@PathParam(&quot;id&quot;) User.Id id) {\n        return users.findById(id).map(UserResource::new).orElse(null);\n    }\n    @POST\n    @Consumes(MediaType.APPLICATION_FORM_URLENCODED)\n    public Response register(@FormParam(&quot;name&quot;) String name, @FormParam(&quot;email&quot;) String email) {\n        User user = users.create(name, email);\n        return Response.created(Link.of(&quot;/users/{id}&quot;).expand(user.getId().value()).toUri()).build();\n    }\n}\n</code></pre><p>æˆ‘ä»¬å¾ˆå®¹æ˜“å¯ä»¥å‘ç°ï¼ŒRESTful Web Serviceséœ€è¦å¤šæ¨¡å—ååŒå®Œæˆã€‚è€Œä¸æ˜¯åƒDI Containeré‚£æ ·ï¼Œå¯ä»¥ä»å•ä¸€æ¨¡å—å…¥æ‰‹ï¼Œå®Œæˆå‡ ä¸ªåŠŸèƒ½ä¹‹åå†è¿›è¡Œé‡æ„ã€‚æ‰€ä»¥å¯¹äºRESTful Web Servicesï¼Œä¼¦æ•¦å­¦æ´¾æˆ–è®¸æ˜¯ä¸€ç§æ›´å¥½çš„æ–¹å¼ã€‚</p><!-- [[[read_end]]] --><p>é‚£ä¹ˆä¸‹èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°†ä»ä¼¦æ•¦å­¦æ´¾å…¥æ‰‹ï¼Œå¼€å§‹RESTful Web Servicesçš„å¼€å‘ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æŒ‰ç…§è§†é¢‘ä¸­æ‰€å±•ç¤ºçš„éœ€æ±‚ï¼Œæˆ‘ä»¬è¦è®¾è®¡æ€æ ·çš„æ¶æ„æ„¿æ™¯ï¼Œæ‰èƒ½é¡ºåˆ©åœ°è¿›å…¥ä¼¦æ•¦å­¦æ´¾çš„å¼€å‘ï¼Ÿ</p><p>æ¬¢è¿æŠŠä½ çš„æƒ³æ³•åˆ†äº«åœ¨ç•™è¨€åŒºï¼Œä¹Ÿæ¬¢è¿æŠŠä½ çš„é¡¹ç›®ä»£ç åˆ†äº«å‡ºæ¥ã€‚ç›¸ä¿¡ç»è¿‡ä½ çš„æ€è€ƒä¸å®æ“ï¼Œå­¦ä¹ æ•ˆæœä¼šæ›´å¥½ï¼</p>","neighbors":{"left":{"article_title":"35ï½œDI Containerï¼ˆ23ï¼‰ï¼šé¡¹ç›®å›é¡¾ä¸æ€»ç»“","id":522342},"right":{"article_title":"37ï½œRESTful Web Servicesï¼ˆ1ï¼‰ï¼šæ˜ç¡®æ¶æ„æ„¿æ™¯ä¸æ¶æ„ç»„ä»¶é—´çš„äº¤äº’","id":522346}},"comments":[{"had_liked":false,"id":347865,"user_name":"Flynn","can_delete":false,"product_type":"c1","uid":1174517,"ip_address":"","ucode":"293321CC198C0C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/aY5QA2COoiaGy7P3MJzUIam3GG94GpA0fTx8yJN3OyBiaP3eNL65ia99H4RbaqC4fypg7JhBOujlJs7bBTdJKdMUQ/132","comment_is_top":false,"comment_ctime":1654521593,"is_pvip":false,"replies":[{"id":"126811","content":"æŒ‡è·¯ã€Šå¦‚ä½•è½åœ°ä¸šåŠ¡å»ºæ¨¡ã€‹é‡Œçš„10ã€11èŠ‚ï¼Œè®²RESTfulçš„","user_name":"ç¼–è¾‘å›å¤","comment_id":347865,"uid":"2189689","ip_address":"","utype":2,"ctime":1654614898,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1654521593","product_id":100109401,"comment_content":"è€å¸ˆï¼Œç§‘æ™®ä¸€ä¸‹ä»€ä¹ˆæ˜¯RESTfulå‘—","like_count":0,"discussions":[{"author":{"id":2189689,"avatar":"https://static001.geekbang.org/account/avatar/00/21/69/79/b4132042.jpg","nickname":"ğŸ‘","note":"","ucode":"DE34B3B14287D1","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575152,"discussion_content":"æŒ‡è·¯ã€Šå¦‚ä½•è½åœ°ä¸šåŠ¡å»ºæ¨¡ã€‹é‡Œçš„10ã€11èŠ‚ï¼Œè®²RESTfulçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654614899,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":4}","child_discussion_number":0,"child_discussions":[]}]}]}