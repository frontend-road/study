{"id":435493,"title":"05 | æ ˆçš„é­”æ³•ï¼šä»æ ˆåˆ‡æ¢çš„è§’åº¦ç†è§£è¿›ç¨‹å’Œåç¨‹","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯æµ·çº³ã€‚</p><p>ä¸Šä¸€èŠ‚è¯¾ï¼Œæˆ‘ä»¬äº†è§£åˆ°å‡½æ•°åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œå°±ä¼šåœ¨æ ˆä¸Šåˆ›å»ºæ ˆå¸§ï¼Œé‚£ä¹ˆå‡½æ•°æ‰§è¡Œçš„ä¸Šä¸‹æ–‡éƒ½å°†ä¿å­˜åœ¨æ ˆå¸§é‡Œã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°±å†æ¥è¿›ä¸€æ­¥åˆ†æï¼Œæ ˆåˆ‡æ¢åœ¨è®¡ç®—æœºç³»ç»Ÿè®¾è®¡ä¸­æ‰€å‘æŒ¥çš„é‡è¦ä½œç”¨ã€‚</p><p>å‡ ä¹æ‰€æœ‰çš„ç¨‹åºå‘˜éƒ½ä¼šé‡åˆ°å¹¶å‘ç¨‹åºã€‚å› ä¸ºå¤šè¿›ç¨‹æˆ–è€…å¤šçº¿ç¨‹ç¨‹åºå¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œå……åˆ†åˆ©ç”¨å¤šCPUå¤šæ ¸çš„è®¡ç®—èµ„æºæ¥å®Œæˆä»»åŠ¡ï¼Œä¼šå¤§å¤§æå‡åº”ç”¨ç¨‹åºçš„æ€§èƒ½ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ç›¸ä¿¡ä½ åœ¨å·¥ä½œä¸­ä¹Ÿé‡åˆ°è¿‡å¤šçº¿ç¨‹ç¨‹åºï¼Œä½†ä¸çŸ¥é“ä½ æ˜¯å¦è€ƒè™‘è¿‡è¿›ç¨‹å’Œçº¿ç¨‹æ˜¯å¦‚ä½•åˆ‡æ¢çš„å‘¢ï¼Ÿå¾ˆå¤šæ–‡ç« éƒ½ä»‹ç»äº†ï¼Œæ“ä½œç³»ç»Ÿä¸ºäº†é¿å…é¢‘ç¹è¿›å…¥å†…æ ¸æ€ï¼Œä¼šæŠŠå¾ˆå¤šå·¥ä½œéƒ½å°½é‡æ”¾åœ¨ç”¨æˆ·æ€ã€‚é‚£ä¹ˆä½ æœ‰æ²¡æœ‰ä»”ç»†æ€è€ƒè¿‡å†…æ ¸æ€ã€ç”¨æˆ·æ€åˆ°åº•æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>è¦å›ç­”ä¸Šé¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬å°±è¦ç†è§£è¿™äº›æ¦‚å¿µèƒŒåæœ€é‡è¦çš„ä¸€ä¸ªæ­¥éª¤ï¼šå¯¹æ‰§è¡Œå•å…ƒçš„ä¸Šä¸‹æ–‡ç¯å¢ƒè¿›è¡Œåˆ‡æ¢ã€‚å®ƒå°±æ˜¯ç”±æ ˆè¿™ä¸ªæ ¸å¿ƒæ•°æ®ç»“æ„æ”¯æ’‘çš„ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä»Šå¤©å­¦ä¹ çš„é‡ç‚¹å†…å®¹ã€‚</p><p>é€šè¿‡ä»Šå¤©çš„å­¦ä¹ ï¼Œä½ å°†æŒæ¡åç¨‹çš„åŸºæœ¬çŸ¥è¯†ï¼Œè¿™æ ·ï¼Œä½ åœ¨C++ä¸­ä½¿ç”¨å„ç§åç¨‹åº“ï¼Œæˆ–è€…åœ¨Luaã€Goç­‰è¯­è¨€ä¸­ä½¿ç”¨åŸç”Ÿåç¨‹çš„æ—¶å€™ï¼Œå°±èƒ½ç†è§£å®ƒä»¬èƒŒåå‘ç”Ÿäº†ä»€ä¹ˆï¼Œä¹Ÿå¯ä»¥å¸®ä½ å†™å‡ºæ­£ç¡®çš„IOç¨‹åºã€‚ä½ è¿˜å°†æ·±å…¥ç†è§£æ“ä½œç³»ç»Ÿç”¨æˆ·æ€å’Œå†…æ ¸æ€ï¼Œè¿™æ ·ï¼Œä½ åœ¨åšæ¶æ„çš„æ—¶å€™ï¼Œå°±èƒ½æ­£ç¡®è¯„ä¼°æ“ä½œç³»ç»Ÿè¿›å…¥å†…æ ¸æ€çš„å¼€é”€æ˜¯å¤šå°‘ã€‚</p><p>åœ¨è®²è§£æ‰§è¡Œå•å…ƒçš„åˆ‡æ¢ä¸æ ˆçš„å…³ç³»ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥ç»™å‡ºå®ƒçš„å‡†ç¡®å®šä¹‰ã€‚</p><!-- [[[read_end]]] --><h3>ä»€ä¹ˆæ˜¯æ‰§è¡Œå•å…ƒ</h3><p>æ‰§è¡Œå•å…ƒæ˜¯æŒ‡CPUè°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ï¼Œå®ƒæ˜¯ä¸€ä¸ªCPUèƒ½æ­£å¸¸è¿è¡Œçš„åŸºæœ¬å•å…ƒã€‚æ‰§è¡Œå•å…ƒæ˜¯å¯ä»¥åœä¸‹æ¥çš„ï¼Œåªè¦èƒ½æŠŠCPUçŠ¶æ€ï¼ˆå…¶å®å°±æ˜¯å¯„å­˜å™¨çš„å€¼ï¼‰å…¨éƒ¨ä¿å­˜èµ·æ¥ï¼Œç­‰åˆ°è¿™ä¸ªæ‰§è¡Œå•å…ƒå†è¢«è°ƒåº¦çš„æ—¶å€™ï¼Œå°±æŠŠçŠ¶æ€æ¢å¤è¿‡æ¥å°±è¡Œäº†ã€‚æˆ‘ä»¬æŠŠè¿™ç§ä¿å­˜çŠ¶æ€ï¼ŒæŒ‚èµ·ï¼Œæ¢å¤æ‰§è¡Œï¼Œæ¢å¤çŠ¶æ€çš„å®Œæ•´è¿‡ç¨‹ï¼Œç§°ä¸ºæ‰§è¡Œå•å…ƒçš„è°ƒåº¦(Scheduling)ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œå¸¸è§çš„æ‰§è¡Œå•å…ƒæœ‰è¿›ç¨‹ï¼Œçº¿ç¨‹å’Œåç¨‹ä¸‰ç§ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¯¦ç»†è¯´æ˜è¿™ä¸‰ç§æ‰§è¡Œå•å…ƒçš„åŒºåˆ«å’Œè”ç³»ã€‚æˆ‘ä»¬å…ˆæ¥æ¯”è¾ƒè¿›ç¨‹å’Œçº¿ç¨‹ã€‚</p><h4>ç†è§£è¿›ç¨‹å’Œçº¿ç¨‹</h4><p>å½“è¿è¡Œä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºçš„æ—¶å€™ï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šå¯åŠ¨ä¸€ä¸ªè¿›ç¨‹ã€‚è¿›ç¨‹ä¼šè¢«æ“ä½œç³»ç»Ÿç®¡ç†å’Œè°ƒåº¦ï¼Œè¢«è°ƒåº¦åˆ°çš„è¿›ç¨‹å°±å¯ä»¥ç‹¬å CPUäº†ã€‚</p><p>CPUå°±åƒæ˜¯ä¸€ä¸ªå¯ä»¥è½®æµä½¿ç”¨çš„å·¥ä½œå°ï¼Œå¤šä¸ªè¿›ç¨‹å¯ä»¥åœ¨å·¥ä½œå°ä¸Šå·¥ä½œï¼Œæ—¶é—´åˆ°äº†å°±ä¼šå¸¦ç€è‡ªå·±çš„å·¥ä½œç¦»å¼€å·¥ä½œå°ï¼Œæ¢ä¸‹ä¸€ä¸ªè¿›ç¨‹ä¸Šæ¥å·¥ä½œã€‚</p><p>è¿›ç¨‹æœ‰è‡ªå·±ç‹¬ç«‹çš„å†…å­˜ç©ºé—´å’Œé¡µè¡¨ï¼Œä»¥åŠæ–‡ä»¶è¡¨ç­‰ç­‰å„ç§ç§æœ‰èµ„æºï¼Œå¦‚æœä½¿ç”¨å¤šè¿›ç¨‹ç³»ç»Ÿï¼Œè®©å¤šä¸ªä»»åŠ¡å¹¶å‘æ‰§è¡Œï¼Œé‚£ä¹ˆå®ƒæ‰€å ç”¨çš„èµ„æºå°±ä¼šæ¯”è¾ƒå¤šã€‚çº¿ç¨‹çš„å‡ºç°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p><p>åŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹åˆ™å…±äº«è¯¥è¿›ç¨‹çš„å†…å­˜ç©ºé—´ï¼Œæ–‡ä»¶è¡¨ï¼Œæ–‡ä»¶æè¿°ç¬¦ç­‰èµ„æºï¼Œå®ƒä¸åŒä¸€ä¸ªè¿›ç¨‹çš„å…¶ä»–çº¿ç¨‹å…±äº«èµ„æºåˆ†é…ã€‚é™¤äº†å…±äº«çš„èµ„æºï¼Œæ¯ä¸ªçº¿ç¨‹ä¹Ÿæœ‰è‡ªå·±çš„ç§æœ‰ç©ºé—´ï¼Œè¿™å°±æ˜¯çº¿ç¨‹çš„æ ˆã€‚çº¿ç¨‹åœ¨æ‰§è¡Œå‡½æ•°è°ƒç”¨çš„æ—¶å€™ï¼Œä¼šåœ¨è‡ªå·±çš„çº¿ç¨‹æ ˆé‡Œåˆ›å»ºå‡½æ•°æ ˆå¸§ã€‚</p><p>æ ¹æ®ä¸Šé¢æ‰€è¯´çš„ç‰¹ç‚¹ï¼Œäººä»¬å¸¸æŠŠè¿›ç¨‹çœ‹åšæ˜¯èµ„æºåˆ†é…çš„å•ä½ï¼ŒæŠŠçº¿ç¨‹æ‰çœ‹æˆä¸€ä¸ªå…·ä½“çš„æ‰§è¡Œå®ä½“ã€‚</p><p>ç”±äºçº¿ç¨‹çš„åˆ‡æ¢è¿‡ç¨‹å’Œè¿›ç¨‹çš„åˆ‡æ¢è¿‡ç¨‹ååˆ†ç›¸ä¼¼ï¼Œæˆ‘ä»¬è¿™èŠ‚è¯¾å°±åªä»¥è¿›ç¨‹çš„åˆ‡æ¢ä¸ºé‡ç‚¹è¿›è¡Œè®²è§£ï¼Œè¯·ä½ ä¸€å®šè¦è‡ªå·±æŸ¥æ‰¾ç›¸å…³èµ„æ–™ï¼Œå¯¹ç…§è¿›ç¨‹åˆ‡æ¢çš„è¿‡ç¨‹ï¼Œå»ç†è§£çº¿ç¨‹çš„åˆ‡æ¢è¿‡ç¨‹ã€‚</p><h4>ç†è§£åç¨‹</h4><p>åç¨‹æ˜¯æ¯”çº¿ç¨‹æ›´è½»é‡çš„æ‰§è¡Œå•å…ƒã€‚è¿›ç¨‹å’Œçº¿ç¨‹çš„è°ƒåº¦æ˜¯ç”±æ“ä½œç³»ç»Ÿè´Ÿè´£çš„ï¼Œè€Œåç¨‹åˆ™æ˜¯ç”±æ‰§è¡Œå•å…ƒç›¸äº’åå•†è¿›è¡Œè°ƒåº¦çš„ï¼Œæ‰€ä»¥å®ƒçš„åˆ‡æ¢å‘ç”Ÿåœ¨ç”¨æˆ·æ€ã€‚åªæœ‰å‰ä¸€ä¸ªåç¨‹ä¸»åŠ¨åœ°æ‰§è¡Œyieldå‡½æ•°ï¼Œè®©å‡ºCPUçš„ä½¿ç”¨æƒï¼Œä¸‹ä¸€ä¸ªåç¨‹æ‰èƒ½å¾—åˆ°è°ƒåº¦ã€‚</p><p>å› ä¸ºç¨‹åºè‡ªå·±è´Ÿè´£åç¨‹çš„è°ƒåº¦ï¼Œæ‰€ä»¥å¤§å¤šæ•°æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è®©ä¸é‚£ä¹ˆå¿™çš„åç¨‹å°‘å‚ä¸è°ƒåº¦ï¼Œä»è€Œæå‡æ•´ä¸ªç¨‹åºçš„ååé‡ï¼Œè€Œä¸æ˜¯åƒè¿›ç¨‹é‚£æ ·ï¼Œæ²¡æœ‰ç¹é‡ä»»åŠ¡çš„è¿›ç¨‹ï¼Œä¹Ÿæœ‰å¯èƒ½è¢«æ¢è¿›æ¥æ‰§è¡Œã€‚</p><p>åç¨‹çš„åˆ‡æ¢å’Œè°ƒåº¦æ‰€è€—è´¹çš„èµ„æºæ˜¯æœ€å°‘çš„ï¼ŒGoè¯­è¨€æŠŠåç¨‹å’ŒIOå¤šè·¯å¤ç”¨ç»“åˆåœ¨ä¸€èµ·ï¼Œæä¾›äº†éå¸¸ä¾¿æ·çš„IOæ¥å£ï¼Œä½¿å¾—åç¨‹çš„æ¦‚å¿µæ·±å…¥äººå¿ƒã€‚</p><p>ä»æ“ä½œç³»ç»Ÿå’ŒWeb Serveræ¼”è¿›çš„å†å²æ¥çœ‹ï¼Œå…ˆæ˜¯å¤šè¿›ç¨‹ç³»ç»Ÿçš„å‡ºç°ï¼Œç„¶åå‡ºç°äº†å¤šçº¿ç¨‹ç³»ç»Ÿï¼Œæœ€åæ‰æ˜¯åç¨‹è¢«å¤§è§„æ¨¡ä½¿ç”¨ï¼Œè¿™ä¸ªæ¼”è¿›å†ç¨‹èƒŒåçš„é€»è¾‘å°±æ˜¯æ‰§è¡Œå•å…ƒéœ€è¦è¶Šæ¥è¶Šè½»é‡ï¼Œä»¥æ”¯æŒæ›´å¤§çš„å¹¶å‘æ€»æ•°ã€‚</p><p>ä½†æˆ‘ä»¬è¿™èŠ‚è¯¾å´è¦å…ˆè®²åç¨‹ï¼Œè¿™æ˜¯å› ä¸ºä»å®ç°å±‚é¢æ¥è¯´ï¼Œåç¨‹æ˜¯æœ€ç®€å•çš„ï¼Œå½“ä½ ç†è§£äº†åç¨‹çš„å®ç°åŸç†ï¼Œå†å›å¤´å­¦ä¹ è¿›ç¨‹å°±æ¯”è¾ƒå®¹æ˜“äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆæ¥å­¦ä¹ åç¨‹çš„åŸç†ã€‚</p><h3>åç¨‹æ˜¯æ€ä¹ˆè°ƒåº¦å’Œåˆ‡æ¢çš„ï¼Ÿ</h3><p>åœ¨è®²è§£åç¨‹çš„ç†è®ºä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆé€šè¿‡ä¸€ä¸ªæœ€ç®€å•çš„åç¨‹çš„ä¾‹å­ï¼Œæ¥è§‚å¯Ÿåç¨‹çš„è¿ä½œæœºåˆ¶ï¼š</p><pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n\n#define STACK_SIZE 1024\n\ntypedef void(*coro_start)();\n\nclass coroutine {\npublic:\n    long* stack_pointer;\n    char* stack;\n\n    coroutine(coro_start entry) {\n        if (entry == NULL) {\n            stack = NULL;\n            stack_pointer = NULL;\n            return;\n        }\n\n        stack = (char*)malloc(STACK_SIZE);\n        char* base = stack + STACK_SIZE;\n        stack_pointer = (long*) base;\n        stack_pointer -= 1;\n        *stack_pointer = (long) entry;\n        stack_pointer -= 1;\n        *stack_pointer = (long) base;\n    }\n\n    ~coroutine() {\n        if (!stack)\n            return;\n        free(stack);\n        stack = NULL;\n    }\n};\n\ncoroutine* co_a, * co_b;\n\nvoid yield_to(coroutine* old_co, coroutine* co) {\n    __asm__ (\n        &quot;movq %%rsp, %0\\n\\t&quot;\n        &quot;movq %%rax, %%rsp\\n\\t&quot;\n        :&quot;=m&quot;(old_co-&gt;stack_pointer):&quot;a&quot;(co-&gt;stack_pointer):);\n}\n\nvoid start_b() {\n    printf(&quot;B&quot;);\n    yield_to(co_b, co_a);\n    printf(&quot;D&quot;);\n    yield_to(co_b, co_a);\n}\n\nint main() {\n    printf(&quot;A&quot;);\n    co_b = new coroutine(start_b);\n    co_a = new coroutine(NULL);\n    yield_to(co_a, co_b);\n    printf(&quot;C&quot;);\n    yield_to(co_a, co_b);\n    printf(&quot;E\\n&quot;);\n    delete co_a;\n    delete co_b;\n    return 0;\n}\n</code></pre><p>æˆ‘ä»¬ä½¿ç”¨g++å¯¹è¿™æ®µä»£ç è¿›è¡Œç¼–è¯‘ï¼Œæ³¨æ„è¦ä½¿ç”¨O0è¿›è¡Œç¼–è¯‘ï¼Œä¸èƒ½ä½¿ç”¨æ›´é«˜çš„ä¼˜åŒ–çº§åˆ«ï¼Œè¿™æ˜¯å› ä¸ºæ›´é«˜çº§åˆ«çš„ä¼˜åŒ–ä¼šå†…è”yield_toæ–¹æ³•ï¼Œè¿™å°±ä½¿å¾—æ ˆçš„å¸ƒå±€å’Œç¨‹åºä¸­æœŸæœ›çš„ä¸ç›¸ç¬¦äº†ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹è¿™æ®µä»£ç çš„è¿è¡Œçš„ç»“æœï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code># g++ -g -o co -O0 coroutine.cpp\n# ./co\nABCDE\n</code></pre><p>è¿™æ®µä»£ç çš„ç¥å¥‡ä¹‹å¤„åœ¨äºï¼Œmainå‡½æ•°åœ¨æ‰§è¡Œåˆ°ä¸€åŠçš„æ—¶å€™ï¼Œå¯ä»¥åœä¸‹æ¥å»æ‰§è¡Œstart_bå‡½æ•°ï¼Œè¿™å’Œæˆ‘ä»¬é€šå¸¸é‡åˆ°çš„å‡½æ•°è°ƒç”¨æ˜¯å¾ˆä¸ä¸€æ ·çš„ã€‚è€Œè¿™ç§æ•ˆæœæ˜¯é€šè¿‡åç¨‹è¾¾åˆ°çš„ã€‚</p><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨mainå‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ˆå³ä»£ç çš„57è¡Œï¼‰ï¼ŒCPUé€šè¿‡æ‰§è¡Œyield_toæ–¹æ³•è½¬åˆ°å¦å¤–ä¸€ä¸ªåç¨‹ã€‚æ–°çš„åç¨‹çš„å…¥å£å‡½æ•°æ˜¯start_bï¼Œæ‰€ä»¥ï¼ŒCPUå°±è½¬è€Œå»æ‰§è¡Œstart_bï¼Œåœ¨start_bæ‰§è¡Œåˆ°48è¡Œçš„æ—¶å€™ï¼Œè¿˜èƒ½å†é€šè¿‡yield_toï¼Œå†å›åˆ°mainå‡½æ•°ä¸­ç»§ç»­æ‰§è¡Œã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹åç¨‹æ˜¯æ€ä¹ˆå®ç°è¿™ä¸€ç‚¹çš„ã€‚</p><p>æˆ‘ä»¬è°ƒç”¨æ„é€ å‡½æ•°coroutineåˆ›å»ºäº†ä¸¤ä¸ªåç¨‹co_aå’Œco_bï¼ˆå³ä»£ç çš„55ã€56è¡Œï¼‰ã€‚å…¶ä¸­ï¼Œco_bçš„å…¥å£åœ°å€æ˜¯å‡½æ•°start_bï¼Œco_aæ²¡æœ‰å…¥å£åœ°å€ã€‚</p><p>æˆ‘ä»¬å…·ä½“æ¥çœ‹åœ¨coroutineé‡Œå‘ç”Ÿäº†ä»€ä¹ˆã€‚å…¶å®åœ¨åˆ›å»ºè¿™ä¸¤ä¸ªåç¨‹ä¹‹å‰ï¼Œcoroutineå·²ç»ç”³è¯·äº†ä¸€æ®µå¤§å°ä¸º1Kçš„å†…å­˜ä½œä¸ºåç¨‹æ ˆï¼Œç„¶åè®©æ ˆåº•æŒ‡é’ˆbaseæŒ‡å‘æ ˆçš„åº•éƒ¨ï¼ˆç¬¬21è¡Œï¼‰ã€‚å› ä¸ºæ ˆæ˜¯ç”±ä¸Šå‘ä¸‹å¢é•¿çš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åˆåœ¨åç¨‹æ ˆä¸Šæ”¾å…¥äº†baseåœ°å€å’Œèµ·å§‹åœ°å€ï¼ˆç¬¬23~27è¡Œï¼‰ï¼Œæ­¤æ—¶ï¼Œåç¨‹æ ˆå†…çš„æ•°æ®æ˜¯è¿™æ ·çš„ï¼Œå¦‚å›¾1æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/b1/55/b12a4941be1f61d5132500c3d1b8ec55.jpg?wh=2284x1151\" alt=\"\"></p><p>åœ¨å‡†å¤‡å¥½åç¨‹æ ˆä»¥åï¼Œå°±å¯ä»¥è°ƒç”¨yield_toæ–¹æ³•è¿›è¡Œåç¨‹çš„åˆ‡æ¢ã€‚åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬æåˆ°è¿‡åç¨‹è¦ä¸»åŠ¨è°ƒç”¨yieldæ–¹æ³•å°†CPUçš„å æœ‰æƒè®©å‡ºæ¥ï¼Œåé¢çš„åç¨‹æ‰èƒ½æ‰§è¡Œã€‚æ‰€ä»¥ï¼Œåç¨‹åˆ‡æ¢çš„å…³é”®æœºåˆ¶å°±è‚¯å®šéšè—åœ¨yield_toæ–¹æ³•é‡Œã€‚</p><p>yield_toæ–¹æ³•å…·ä½“åšäº†ä»€ä¹ˆäº‹æƒ…å‘¢ï¼Ÿæˆ‘ä»¬éœ€è¦é€šè¿‡æœºå™¨ç æ¥è¿›è¡Œè¯´æ˜ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨\"objdump -d\"å‘½ä»¤æŸ¥çœ‹yield_toæ–¹æ³•ç»è¿‡ç¼–è¯‘ä»¥åçš„æœºå™¨ç ï¼š</p><pre><code>000000000040076d &lt;_Z8yield_toP9coroutineS0_&gt;:\n  40076d:       55                      push   %rbp\n  40076e:       48 89 e5                mov    %rsp,%rbp\n  400771:       48 89 7d f8             mov    %rdi,-0x8(%rbp)\n  400775:       48 89 75 f0             mov    %rsi,-0x10(%rbp)\n  400779:       48 8b 45 f0             mov    -0x10(%rbp),%rax\n  40077d:       48 8b 00                mov    (%rax),%rax\n  400780:       48 8b 55 f8             mov    -0x8(%rbp),%rdx\n  400784:       48 89 22                mov    %rsp,(%rdx)\n  400787:       48 89 c4                mov    %rax,%rsp\n  40078a:       5d                      pop    %rbp\n  40078b:       c3                      retq\n</code></pre><p>yield_toä¸­ï¼Œå‚æ•°old_coæŒ‡å‘è€åç¨‹ï¼Œcoåˆ™æŒ‡å‘æ–°çš„åç¨‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦åˆ‡æ¢è¿‡å»æ‰§è¡Œçš„ç›®æ ‡åç¨‹ã€‚</p><p>è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯ï¼Œé¦–å…ˆï¼ŒæŠŠå½“å‰rspå¯„å­˜å™¨çš„å€¼å­˜å‚¨åˆ°old_coçš„stack_pointerå±æ€§ï¼ˆç¬¬9è¡Œï¼‰ï¼Œå¹¶ä¸”æŠŠæ–°çš„åç¨‹çš„stack_pointerå±æ€§æ›´æ–°åˆ°rspå¯„å­˜å™¨ï¼ˆç¬¬10è¡Œï¼‰ï¼Œç„¶åï¼ŒretqæŒ‡ä»¤å°†ä¼šä»æ ˆä¸Šå–å‡ºè°ƒç”¨è€…çš„åœ°å€ï¼Œå¹¶è·³è½¬å›è°ƒç”¨è€…ç»§ç»­æ‰§è¡Œï¼ˆç¬¬12è¡Œï¼Œè¿™æ˜¯ä¸Šä¸€èŠ‚è¯¾çš„å†…å®¹ï¼Œå¦‚æœä½ ä¸ç†Ÿæ‚‰ï¼Œå¯ä»¥å†è‡ªè¡Œå¤ä¹ ä¸€ä¸‹ï¼‰ã€‚</p><p>ç»“åˆä»¥ä¸Šåˆ†æï¼Œæˆ‘ä»¬å¯ä»¥æƒ³è±¡åœ¨åç¨‹ç¤ºä¾‹ä»£ç çš„ç¬¬57è¡Œï¼Œå½“è°ƒç”¨è¿™ä¸€æ¬¡yield_toæ—¶ï¼Œrspå¯„å­˜å™¨åˆšå¥½å°±ä¼šæŒ‡å‘æ–°çš„åç¨‹coçš„æ ˆï¼Œæ¥ç€å°±ä¼šæ‰§è¡Œ\"pop rbp\"å’Œ\"retq\"è¿™ä¸¤æ¡æŒ‡ä»¤ã€‚è¿™é‡Œä½ éœ€è¦æ³¨æ„ä¸€ä¸‹ï¼Œæ ˆçš„åˆ‡æ¢ï¼Œå¹¶æ²¡æœ‰æ”¹å˜æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºï¼Œå› ä¸ºæ ˆæŒ‡é’ˆå­˜å‚¨åœ¨rspå¯„å­˜å™¨ä¸­ï¼Œå½“å‰æ‰§è¡Œåˆ°çš„æŒ‡ä»¤å­˜å‚¨åœ¨IPå¯„å­˜å™¨ä¸­ï¼Œrspçš„åˆ‡æ¢å¹¶ä¸ä¼šå¯¼è‡´IPå¯„å­˜å™¨å‘ç”Ÿå˜åŒ–ã€‚</p><p>è€Œæ˜¾ç„¶ï¼Œå¦‚å›¾1æ‰€ç¤ºï¼Œæˆ‘ä»¬åˆšæ‰ç²¾å¿ƒå‡†å¤‡çš„baseåœ°å€æ­£å¥½å°±æ˜¯ä¸ºäº†\"pop rbp\"å‡†å¤‡çš„ï¼Œè€Œstart_båˆ™æ˜¯ä¸ºäº†retqå‡†å¤‡çš„ã€‚æ‰§è¡Œè¿™æ¬¡retqï¼ŒCPUå°±ä¼šè·³è½¬åˆ°start_bå‡½æ•°ä¸­å»è¿è¡Œäº†ã€‚</p><p>ç»è¿‡è¿™ç§åˆ‡æ¢ï¼Œç³»ç»Ÿä¸­ä¼šå‡ºç°ä¸¤ä¸ªæ ˆï¼Œå¦‚å›¾2æ‰€ç¤ºï¼š<br>\n<img src=\"https://static001.geekbang.org/resource/image/63/31/63ffc7601254bb2460d65c43f57a7931.jpg?wh=2284x1249\" alt=\"\"></p><p>å½“ç¨‹åºç»§ç»­æ‰§è¡Œæ—¶ï¼Œåœ¨start_bä¸­è°ƒç”¨äº†yield_toï¼ŒCPUåˆä¼šè½¬ç§»å›åç¨‹açš„æ ˆä¸Šï¼Œè¿™æ ·åœ¨æ‰§è¡Œretqæ—¶ï¼Œå°±ä¼šè¿”å›åˆ°mainå‡½æ•°é‡Œç»§ç»­è¿è¡Œäº†ã€‚</p><p>åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ä½¿ç”¨ä»»ä½•æ“ä½œç³»ç»Ÿçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå°±å®ç°äº†æ§åˆ¶æµçš„è½¬ç§»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œæˆ‘ä»¬çœŸæ­£å®ç°äº†ä¸¤ä¸ªæ‰§è¡Œå•å…ƒã€‚è¿™ä¸¤ä¸ªæ‰§è¡Œå•å…ƒå¹¶ä¸åƒçº¿ç¨‹é‚£æ ·æ˜¯æŠ¢å å¼åœ°è¿è¡Œï¼Œè€Œæ˜¯ç›¸äº’ä¸»åŠ¨åä½œå¼æ‰§è¡Œï¼Œæ‰€ä»¥ï¼Œè¿™æ ·çš„æ‰§è¡Œå•å…ƒå°±æ˜¯åç¨‹ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåç¨‹çš„åˆ‡æ¢å…¨é æœ¬æ‰§è¡Œå•å…ƒä¸»åŠ¨è°ƒç”¨yield_toæ¥æŠŠæ‰§è¡Œæƒè®©æ¸¡ç»™å…¶ä»–åç¨‹ã€‚</p><p>æ¯ä¸ªåç¨‹éƒ½æ‹¥æœ‰è‡ªå·±çš„å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆã€‚åç¨‹è°ƒåº¦åˆ‡æ¢æ—¶ï¼Œå°†å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆä¿å­˜åˆ°å…¶ä»–åœ°æ–¹ï¼ˆä¸Šè¿°ä¾‹å­ä¸­ï¼Œä¿å­˜åœ¨coroutineå¯¹è±¡ä¸­ï¼‰ï¼Œåœ¨åˆ‡å›æ¥çš„æ—¶å€™ï¼Œæ¢å¤å…ˆå‰ä¿å­˜çš„å¯„å­˜å™¨ä¸Šä¸‹æ–‡å’Œæ ˆã€‚</p><p>åˆ†æåˆ°è¿™é‡Œï¼Œè¿™ä¸ªç¨‹åºå¯¹æˆ‘ä»¬è€Œè¨€ï¼Œå·²ç»æ²¡æœ‰å¤ªå¤šç§˜å¯†äº†ï¼Œå®ƒæ‰€æœ‰çœ‹ä¸Šå»ç¥å¥‡çš„åœ°æ–¹ï¼Œä¸è¿‡å°±æ˜¯åˆ‡æ¢äº†ç¨‹åºè¿è¡Œçš„æ ˆæŒ‡é’ˆè€Œå·²ã€‚</p><p>åˆ†æåˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥å‡†ç¡®åœ°å®šä¹‰åç¨‹äº†ã€‚åç¨‹æ˜¯ä¸€ç§è½»é‡çº§çš„ï¼Œç”¨æˆ·æ€çš„æ‰§è¡Œå•å…ƒã€‚ç›¸æ¯”çº¿ç¨‹ï¼Œå®ƒå ç”¨çš„å†…å­˜éå¸¸å°‘ï¼Œåœ¨å¾ˆå¤šå®ç°ä¸­ï¼ˆæ¯”å¦‚Goè¯­è¨€ï¼‰ç”šè‡³å¯ä»¥åšåˆ°æŒ‰éœ€åˆ†é…æ ˆç©ºé—´ã€‚</p><p>å®ƒä¸»è¦æœ‰ä¸‰ä¸ªç‰¹ç‚¹ï¼š</p><ol>\n<li>å ç”¨çš„èµ„æºæ›´å°‘;</li>\n<li>æ‰€æœ‰çš„åˆ‡æ¢å’Œè°ƒåº¦éƒ½å‘ç”Ÿåœ¨ç”¨æˆ·æ€ã€‚</li>\n<li>å®ƒçš„è°ƒåº¦æ˜¯åå•†å¼çš„ï¼Œè€Œä¸æ˜¯æŠ¢å å¼çš„ã€‚</li>\n</ol><p>å‰ä¸¤ä¸ªç‰¹ç‚¹å®¹æ˜“ç†è§£ï¼Œæˆ‘æ¥ç»™ä½ é‡ç‚¹è§£é‡Šä¸€ä¸‹ç¬¬ä¸‰ä¸ªç‰¹ç‚¹ã€‚</p><p>ç›®å‰ä¸»æµè¯­è¨€åŸºæœ¬ä¸Šéƒ½é€‰æ‹©äº†å¤šçº¿ç¨‹ä½œä¸ºå¹¶å‘è®¾æ–½ï¼Œä¸çº¿ç¨‹ç›¸å…³çš„æ¦‚å¿µæ˜¯æŠ¢å å¼å¤šä»»åŠ¡ï¼ˆPreemptive multitaskingï¼‰ï¼Œè€Œä¸åç¨‹ç›¸å…³çš„æ˜¯åä½œå¼å¤šä»»åŠ¡ã€‚ä¸ç®¡æ˜¯è¿›ç¨‹è¿˜æ˜¯çº¿ç¨‹ï¼Œæ¯æ¬¡é˜»å¡ã€åˆ‡æ¢éƒ½éœ€è¦é™·å…¥ç³»ç»Ÿè°ƒç”¨(system call)ï¼Œå…ˆè®©CPUæ‰§è¡Œæ“ä½œç³»ç»Ÿçš„è°ƒåº¦ç¨‹åºï¼Œç„¶åå†ç”±è°ƒåº¦ç¨‹åºå†³å®šè¯¥å“ªä¸€ä¸ªè¿›ç¨‹(çº¿ç¨‹)ç»§ç»­æ‰§è¡Œã€‚</p><p>ç”±äºæŠ¢å å¼è°ƒåº¦æ‰§è¡Œé¡ºåºæ— æ³•ç¡®å®šï¼Œæˆ‘ä»¬ä½¿ç”¨çº¿ç¨‹æ—¶éœ€è¦éå¸¸å°å¿ƒåœ°å¤„ç†åŒæ­¥é—®é¢˜ï¼Œè€Œåç¨‹å®Œå…¨ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚å› ä¸ºåä½œå¼çš„ä»»åŠ¡è°ƒåº¦ï¼Œæ˜¯è¦ç”¨æˆ·è‡ªå·±æ¥è´Ÿè´£ä»»åŠ¡çš„è®©å‡ºçš„ã€‚å¦‚æœä¸€ä¸ªä»»åŠ¡ä¸ä¸»åŠ¨è®©å‡ºï¼Œå…¶ä»–ä»»åŠ¡å°±ä¸ä¼šå¾—åˆ°è°ƒåº¦ã€‚è¿™æ˜¯åç¨‹çš„ä¸€ä¸ªå¼±ç‚¹ï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨å¾—å½“ï¼Œè¿™å…¶å®æ˜¯ä¸€ä¸ªå¯ä»¥å˜å¾—å¾ˆå¼ºå¤§çš„ä¼˜ç‚¹ã€‚</p><p>ä½ å¯ä»¥å°è¯•å°†ç¼–è¯‘ä¼˜åŒ–ç­‰çº§è®¾ä¸ºO1ï¼Œè§‚å¯Ÿyield_toå‡½æ•°çš„æœºå™¨ç çš„å˜åŒ–ï¼Œç„¶åå°±å¯ä»¥ç†è§£å½“æ ˆåŸºå€å¯„å­˜å™¨çš„ä¿å­˜å’Œæ¢å¤å¦‚æœè¢«ä¼˜åŒ–æ‰ä»¥åï¼Œæˆ‘ä»¬å‡†å¤‡çš„é‚£ä¸ªæ•°æ®å°±ä¸å†èµ·ä½œç”¨äº†ã€‚ä¹Ÿè¯·ä½ å°è¯•å¯¹ä¸Šè¿°ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œä»¥é€‚åº”O1ä¼˜åŒ–ã€‚</p><p>åœ¨ç†è§£äº†åç¨‹ä»¥åï¼Œæˆ‘ä»¬å†å›è¿‡å¤´æ¥çœ‹è¿›ç¨‹ã€‚</p><h3>è¿›ç¨‹æ˜¯æ€ä¹ˆè°ƒåº¦å’Œåˆ‡æ¢çš„ï¼Ÿ</h3><p>è¿›ç¨‹åˆ‡æ¢çš„åŸç†å…¶å®ä¸åç¨‹åˆ‡æ¢çš„åŸç†å¤§è‡´ç›¸åŒï¼Œéƒ½æ˜¯å°†ä¸Šä¸‹æ–‡ä¿å­˜åœ¨ç‰¹å®šçš„ä½ç½®ï¼Œåˆ‡æ¢åˆ°æ–°çš„è¿›ç¨‹å»æ‰§è¡Œã€‚æ‰€ä¸åŒçš„æ˜¯ï¼Œæ“ä½œç³»ç»Ÿä¸ºæˆ‘ä»¬æä¾›äº†è¿›ç¨‹çš„åˆ›å»ºã€é”€æ¯ã€ä¿¡å·é€šä¿¡ç­‰åŸºç¡€è®¾æ–½ï¼Œè¿™ä½¿å¾—ç¨‹åºå‘˜å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åˆ›å»ºè¿›ç¨‹ã€‚å¦‚æœä¸€ä¸ªè¿›ç¨‹aåˆ›å»ºäº†å¦å¤–ä¸€ä¸ªè¿›ç¨‹bï¼Œåˆ™ç§°aä¸ºçˆ¶è¿›ç¨‹ï¼Œbä¸ºå­è¿›ç¨‹ã€‚</p><p>æˆ‘å…ˆå¸¦ä½ é€šè¿‡ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œç›´è§‚åœ°æ„Ÿå—å¤šè¿›ç¨‹è¿è¡Œçš„æƒ…å†µï¼š</p><pre><code>#include &lt;unistd.h&gt;\n#include &lt;stdio.h&gt;\n\nint main() {\n    pid_t pid;\n    if (!(pid = fork())) {\n        printf(&quot;I am child process\\n&quot;);\n        exit(0);\n    }\n    else {\n        printf(&quot;I am father process\\n&quot;);\n        wait(pid);\n    }\n\n    return 0;\n}\n</code></pre><p>ç¼–è¯‘æ‰§è¡Œè¿™æ®µä»£ç çš„ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code># gcc -o p process.c\n# ./p\nI am father process\nI am child process\n</code></pre><p>åœ¨è¿™ä¸ªç»“æœé‡Œï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ifåˆ†æ”¯å’Œelseåˆ†æ”¯ä¸­çš„ä»£ç éƒ½è¢«è¿è¡Œäº†ã€‚æ›¾ç»æœ‰ä¸ªç¬‘è¯è¯´ï¼Œè¿™ä¸ªä¸–ç•Œä¸Šæœ€è¿œçš„è·ç¦»ï¼Œä¸æ˜¯ä½ åœ¨å¤©æ¶¯ï¼Œæˆ‘åœ¨æµ·è§’ï¼Œè€Œæ˜¯ä½ åœ¨ifé‡Œï¼Œæˆ‘åœ¨elseé‡Œã€‚ç”±æ­¤å¯è§ï¼Œè¿™ä¸ªç¬‘è¯ä¹Ÿå¹¶ä¸æ­£ç¡®ï¼Œè¿˜æ˜¯è¦çœ‹ifæ¡ä»¶é‡Œå¡«çš„æ˜¯ä»€ä¹ˆã€‚</p><p>åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œforkæ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œç”¨äºåˆ›å»ºè¿›ç¨‹ï¼Œå¦‚æœå…¶è¿”å›å€¼ä¸º0ï¼Œåˆ™ä»£è¡¨å½“å‰è¿›ç¨‹æ˜¯å­è¿›ç¨‹ï¼Œå¦‚æœå…¶è¿”å›å€¼ä¸ä¸º0ï¼Œåˆ™ä»£è¡¨å½“å‰è¿›ç¨‹æ˜¯çˆ¶è¿›ç¨‹ï¼Œè€Œè¿™ä¸ªè¿”å›å€¼å°±æ˜¯å­è¿›ç¨‹çš„è¿›ç¨‹IDã€‚</p><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œå­è¿›ç¨‹åœ¨æ‰“å°å®Œä¸€è¡Œè¯­å¥åå°±è°ƒç”¨exité€€å‡ºæ‰§è¡Œäº†ã€‚çˆ¶è¿›ç¨‹åœ¨æ‰“å°å®Œä»¥åï¼Œå¹¶æ²¡æœ‰ç«‹å³é€€å‡ºï¼Œè€Œæ˜¯è°ƒç”¨waitå‡½æ•°ç­‰å¾…å­è¿›ç¨‹é€€å‡ºã€‚ç”±äºè¿›ç¨‹çš„è°ƒåº¦æ‰§è¡Œæ˜¯æ“ä½œç³»ç»Ÿè´Ÿè´£çš„ï¼Œå…·æœ‰å¾ˆå¤§çš„éšæœºæ€§ï¼Œæ‰€ä»¥çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹è°å…ˆé€€å‡ºï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½ç¡®å®šã€‚ä¸ºäº†é¿å…å­è¿›ç¨‹å˜æˆå­¤å„¿è¿›ç¨‹ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†è®©çˆ¶è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹é€€å‡ºçš„åŠæ³•ï¼Œå°±æ˜¯å¯¹ä¸¤ä¸ªè¿›ç¨‹è¿›è¡ŒåŒæ­¥ã€‚</p><p>å…¶å®ï¼Œè¿™æ®µç¨‹åºæœ€éš¾ç†è§£çš„æ˜¯ç¬¬6è¡Œï¼Œä¸ºä»€ä¹ˆä¸€æ¬¡forkåï¼Œä¼šæœ‰ä¸¤ç§ä¸åŒçš„è¿”å›å€¼ï¼Ÿè¿™æ˜¯å› ä¸ºforkæ–¹æ³•æœ¬è´¨ä¸Šåœ¨ç³»ç»Ÿé‡Œåˆ›å»ºäº†ä¸¤ä¸ªæ ˆï¼Œè¿™ä¸¤ä¸ªæ ˆä¸€ä¸ªæ˜¯çˆ¶è¿›ç¨‹çš„ï¼Œä¸€ä¸ªæ˜¯å­è¿›ç¨‹çš„ã€‚åˆ›å»ºçš„æ—¶å€™ï¼Œå­è¿›ç¨‹å®Œå…¨â€œç»§æ‰¿â€äº†çˆ¶è¿›ç¨‹çš„æ‰€æœ‰æ•°æ®ï¼ŒåŒ…æ‹¬æ ˆä¸Šçš„æ•°æ®ã€‚çˆ¶å­è¿›ç¨‹æ ˆçš„æƒ…å†µå¦‚å›¾3æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/05/bb/05f522cfcaa8ef2d79fa7221cc1bb8bb.jpg?wh=2284x1445\" alt=\"\"></p><p>åœ¨å›¾3é‡Œï¼Œåªè¦æœ‰ä¸€ä¸ªè¿›ç¨‹å¯¹æ ˆè¿›è¡Œä¿®æ”¹ï¼Œæ ˆå°±ä¼šå¤åˆ¶ä¸€ä»½ï¼Œç„¶åçˆ¶å­è¿›ç¨‹å„è‡ªæŒæœ‰ä¸€ä»½ã€‚å›¾ä¸­çš„é»„è‰²éƒ¨åˆ†ä¹Ÿæ˜¯è¿›ç¨‹å…±ç”¨çš„ï¼Œå¦‚æœæœ‰ä¸€ä¸ªè¿›ç¨‹ä¿®æ”¹å®ƒï¼Œä¹Ÿä¼šå¤åˆ¶ä¸€ä»½å‰¯æœ¬ï¼Œè¿™ç§æœºåˆ¶å«åšå†™æ—¶å¤åˆ¶ã€‚</p><p>æ¥ç€ï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šæ¥ç®¡ä¸¤ä¸ªè¿›ç¨‹çš„è°ƒåº¦ã€‚å½“çˆ¶è¿›ç¨‹å¾—åˆ°è°ƒåº¦æ—¶ï¼Œçˆ¶è¿›ç¨‹çš„æ ˆä¸Šæ˜¯forkå‡½æ•°çš„frameï¼Œå½“CPUæ‰§è¡Œforkçš„retè¯­å¥æ—¶ï¼Œè¿”å›å€¼å°±æ˜¯å­è¿›ç¨‹çš„IDã€‚</p><p>è€Œå½“å­è¿›ç¨‹å¾—åˆ°è°ƒåº¦æ—¶ï¼Œrspè¿™ä¸ªæ ˆæŒ‡é’ˆå°±å°†ä¼šæŒ‡å‘å­è¿›ç¨‹çš„æ ˆï¼Œå­è¿›ç¨‹çš„æ ˆä¸Šä¹ŸåŒæ ·æ˜¯forkå‡½æ•°çš„frameï¼Œå®ƒä¹Ÿä¼šæ‰§è¡Œä¸€æ¬¡forkçš„retè¯­å¥ï¼Œå…¶è¿”å›å€¼æ˜¯0ã€‚</p><p>æ‰€ä»¥ç¬¬6è¡Œè™½ç„¶æ˜¯åŒä¸€ä¸ªå˜é‡pidï¼Œä½†å®é™…ä¸Šï¼Œå®ƒåœ¨å­è¿›ç¨‹çš„mainå‡½æ•°çš„æ ˆå¸§é‡Œæœ‰ä¸€ä¸ªå‰¯æœ¬ï¼Œåœ¨çˆ¶è¿›ç¨‹çš„æ ˆå¸§é‡Œä¹Ÿæœ‰ä¸€ä¸ªå‰¯æœ¬ã€‚ä»forkå¼€å§‹ï¼Œçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹å°±å·²ç»åˆ†é“æ‰¬é•³äº†ã€‚ä½ å¯ä»¥å°†è¿›ç¨‹æ ˆçš„åˆ‡æ¢ä¸åç¨‹æ ˆçš„åˆ‡æ¢å¯¹æ¯”ç€è¿›è¡Œå­¦ä¹ ã€‚</p><p>æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­å±•ç¤ºäº†è¿›ç¨‹æ˜¯å¦‚ä½•åˆ›å»ºçš„ï¼Œå¹¶ä¸”åˆ†æäº†è¿›ç¨‹åˆ›å»ºèƒŒåæ ˆçš„å˜åŒ–è¿‡ç¨‹ã€‚ä½ å¯ä»¥çœ‹åˆ°ï¼Œè¿›ç¨‹åšä¸ºä¸€ç§æ‰§è¡Œå•å…ƒï¼Œå®ƒçš„åˆ‡æ¢è¿˜æ˜¯è¦ä¾èµ–äºæ ˆåˆ‡æ¢è¿™ä¸ªæ ¸å¿ƒæœºåˆ¶ã€‚</p><p>å…³äºforkçš„æ›´å¤šçš„ç»†èŠ‚ï¼Œæˆ‘ä»¬å°†åœ¨ç¬¬10è¯¾å†åŠ ä»¥åˆ†æã€‚åœ¨è¿™èŠ‚è¯¾ï¼Œå°†è¿›ç¨‹çš„æ ˆç±»æ¯”äºåç¨‹æ ˆå·²ç»è¶³å¤Ÿäº†ã€‚</p><h3>ç”¨æˆ·æ€å’Œå†…æ ¸æ€æ˜¯æ€ä¹ˆåˆ‡æ¢çš„ï¼Ÿ</h3><p>åœ¨ç¬¬äºŒèŠ‚è¯¾é‡Œï¼Œæˆ‘ä»¬è®²è§£äº†ä¸­æ–­æè¿°ç¬¦è¡¨ï¼Œå¹¶ä¸”ç”¨ç³»ç»Ÿè°ƒç”¨writeè¿™ä¸ªä¾‹å­ï¼Œæ¥å±•ç¤ºå¦‚ä½•é€šè¿‡è½¯ä¸­æ–­è¿›å…¥å†…æ ¸æ€ã€‚å®é™…ä¸Šï¼Œå†…æ ¸æ€å’Œç”¨æˆ·æ€çš„åˆ‡æ¢ä¹Ÿä¾èµ–æ ˆçš„åˆ‡æ¢ã€‚å› ä¸ºåœ¨ç¬¬äºŒèŠ‚è¯¾é‡Œï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰è®²åˆ°æ ˆï¼Œæ‰€ä»¥åœ¨è®²åˆ°ç”¨æˆ·æ€åˆ‡æ¢å†…æ ¸æ€çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰æ¶‰åŠåˆ°æ ˆçš„åˆ‡æ¢ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬è¡¥ä¸Šç”¨æˆ·æ€å’Œå†…æ ¸æ€åˆ‡æ¢çš„æœ€åä¸€å—æ‹¼å›¾ã€‚</p><p>æ“ä½œç³»ç»Ÿå†…æ ¸åœ¨è¿è¡Œçš„æ—¶å€™ï¼Œè‚¯å®šä¹Ÿæ˜¯éœ€è¦æ ˆçš„ï¼Œè¿™ä¸ªæ ˆç§°ä¸ºå†…æ ¸æ ˆï¼Œå®ƒä¸ç”¨æˆ·åº”ç”¨ç¨‹åºä½¿ç”¨çš„ç”¨æˆ·æ€æ ˆæ˜¯ä¸åŒçš„ã€‚åªæœ‰é«˜æƒé™çš„å†…æ ¸ä»£ç æ‰èƒ½è®¿é—®å®ƒã€‚è€Œå†…æ ¸æ€ä¸ç”¨æˆ·æ€çš„ç›¸äº’åˆ‡æ¢ï¼Œå…¶ä¸­æœ€é‡è¦çš„ä¸€ä¸ªæ­¥éª¤å°±æ˜¯ä¸¤ä¸ªæ ˆçš„åˆ‡æ¢ã€‚</p><p>ä¸­æ–­å‘ç”Ÿæ—¶ï¼ŒCPUæ ¹æ®éœ€è¦è·³è½¬çš„ç‰¹æƒçº§ï¼Œå»ä¸€ä¸ªç‰¹å®šçš„ç»“æ„ä¸­ï¼ˆä¸åŒçš„CPUä¼šæœ‰æ‰€ä¸åŒï¼Œæ¯”å¦‚i386å°±å­˜åœ¨TSSä¸­ï¼Œä½†ä¸ç®¡æ˜¯ä»€ä¹ˆCPUï¼Œä¸€å®šä¼šæœ‰ä¸€ä¸ªç±»ä¼¼çš„ç»“æ„ï¼‰ï¼Œå–å¾—ç›®æ ‡ç‰¹æƒçº§æ‰€å¯¹åº”çš„stackæ®µé€‰æ‹©å­å’Œæ ˆé¡¶æŒ‡é’ˆï¼Œå¹¶åˆ†åˆ«é€å…¥sså¯„å­˜å™¨å’Œrspå¯„å­˜å™¨ï¼Œè¿™å°±å®Œæˆäº†ä¸€æ¬¡æ ˆçš„åˆ‡æ¢ã€‚</p><p>ç„¶åï¼ŒIPå¯„å­˜å™¨è·³å…¥ä¸­æ–­æœåŠ¡ç¨‹åºå¼€å§‹æ‰§è¡Œï¼Œä¸­æ–­æœåŠ¡ç¨‹åºä¼šæŠŠå½“å‰CPUä¸­çš„æ‰€æœ‰å¯„å­˜å™¨ï¼Œä¹Ÿå°±æ˜¯ç¨‹åºçš„ä¸Šä¸‹æ–‡éƒ½ä¿å­˜åˆ°æ ˆä¸Šï¼Œè¿™å°±æ„å‘³ç€ç”¨æˆ·æ€çš„CPUçŠ¶æ€å…¶å®æ˜¯ç”±ä¸­æ–­æœåŠ¡ç¨‹åºåœ¨ç³»ç»Ÿæ ˆä¸Šè¿›è¡Œç»´æŠ¤çš„ã€‚å¦‚å›¾4æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/e0/65/e015b6a3b4d93431194614e065078e65.jpg?wh=2284x2101\" alt=\"\"></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œå½“ç¨‹åºå› ä¸ºcallæŒ‡ä»¤æˆ–è€…intæŒ‡ä»¤è¿›è¡Œè·³è½¬çš„æ—¶å€™ï¼Œåªéœ€è¦æŠŠä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€æ”¾åˆ°æ ˆä¸Šï¼Œä¾›è¢«è°ƒç”¨è€…æ‰§è¡ŒretæŒ‡ä»¤ä½¿ç”¨ï¼Œè¿™æ ·å¯ä»¥ä¾¿äºè¿”å›åˆ°è°ƒç”¨å‡½æ•°ä¸­ç»§ç»­æ‰§è¡Œã€‚ä½†å›¾4ä¸­çš„å†…æ ¸æ€æ ˆé‡Œæœ‰ä¸€ç‚¹ç‰¹æ®Šä¹‹å¤„ï¼Œå°±æ˜¯CPUè‡ªåŠ¨åœ°å°†ç”¨æˆ·æ€æ ˆçš„æ®µé€‰æ‹©å­ss3ï¼Œå’Œæ ˆé¡¶æŒ‡é’ˆrsp3éƒ½æ”¾åˆ°å†…æ ¸æ€æ ˆé‡Œäº†ã€‚è¿™é‡Œçš„æ•°å­—3ä»£è¡¨äº†CPUç‰¹æƒçº§ï¼Œå†…æ ¸æ€æ˜¯0ï¼Œç”¨æˆ·æ€æ˜¯3ã€‚</p><p>å½“ä¸­æ–­ç»“æŸæ—¶ï¼Œä¸­æ–­æœåŠ¡ç¨‹åºä¼šä»å†…æ ¸æ ˆé‡Œå°†CPUå¯„å­˜å™¨çš„å€¼å…¨éƒ¨æ¢å¤ï¼Œæœ€åå†æ‰§è¡Œ\"iret\"æŒ‡ä»¤ï¼ˆæ³¨æ„ä¸æ˜¯retï¼Œè€Œæ˜¯iretï¼Œè¿™è¡¨ç¤ºæ˜¯ä»ä¸­æ–­æœåŠ¡ç¨‹åºä¸­è¿”å›ï¼‰ã€‚è€ŒiretæŒ‡ä»¤å°±ä¼šå°†ss3/rsp3éƒ½å¼¹å‡ºæ ˆï¼Œå¹¶ä¸”å°†è¿™ä¸ªå€¼åˆ†åˆ«é€åˆ°sså’Œrspå¯„å­˜å™¨ä¸­ã€‚è¿™æ ·å°±å®Œæˆäº†ä»å†…æ ¸æ ˆåˆ°ç”¨æˆ·æ ˆçš„ä¸€æ¬¡åˆ‡æ¢ã€‚åŒæ—¶ï¼Œå†…æ ¸æ ˆçš„ss0å’Œrsp0ä¹Ÿä¼šè¢«ä¿å­˜åˆ°å‰æ–‡æ‰€è¯´çš„ä¸€ä¸ªç‰¹å®šçš„ç»“æ„ä¸­ï¼Œä»¥ä¾›ä¸‹æ¬¡åˆ‡æ¢æ—¶ä½¿ç”¨ã€‚</p><h3>æ€»ç»“</h3><p>è¿™èŠ‚è¯¾æˆ‘ä»¬ä¸¾ä¾‹è¯´æ˜äº†è¿›ç¨‹ï¼Œçº¿ç¨‹å’Œåç¨‹çš„åŸºæœ¬æ¦‚å¿µï¼Œå¹¶å¯¹å®ƒä»¬çš„è°ƒåº¦åšäº†ç®€å•çš„è¯´æ˜ã€‚ç„¶åä»‹ç»äº†æœåŠ¡ç«¯ç¼–ç¨‹æ¨¡å‹ä»å¤šè¿›ç¨‹å‘åç¨‹æ¼”è¿›çš„å†ç¨‹ã€‚</p><p>æ¥ç€ï¼Œæˆ‘ä»¬é‡ç‚¹ä»‹ç»äº†æ ˆåˆ‡æ¢çš„æ•´ä¸ªè¿‡ç¨‹ã€‚<strong>æ ˆåˆ‡æ¢çš„æ ¸å¿ƒå°±æ˜¯æ ˆæŒ‡é’ˆrspå¯„å­˜å™¨çš„åˆ‡æ¢ï¼Œåªè¦æˆ‘ä»¬æƒ³åŠæ³•æŠŠrspåˆ‡æ¢äº†å°±ç›¸å½“äºæ¢äº†æ‰§è¡Œå•å…ƒçš„ä¸Šä¸‹æ–‡ç¯å¢ƒ</strong>ã€‚è¿™ä¸€èŠ‚è¯¾æ‰€æœ‰çš„è®²è§£éƒ½å¯ä»¥å½’åˆ°è¿™æ¡çº¿ç´¢ä¸Šã€‚</p><p>æˆ‘ä»¬åˆç”¨äº†åç¨‹åˆ‡æ¢ï¼Œè¿›ç¨‹æ ˆçš„å†™æ—¶å¤åˆ¶å’Œåˆ‡æ¢ï¼Œä»¥åŠç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åˆ‡æ¢è¿™ä¸‰ä¸ªä¾‹å­æ¥è¯´æ˜ä¸¾ä¾‹è¯´æ˜æ ˆçš„åˆ‡æ¢æ‰€å‘æŒ¥çš„é‡è¦ä½œç”¨ã€‚</p><p>é€šè¿‡ä¸¤èŠ‚è¯¾çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å¯¹è¿›ç¨‹ä¸­çš„æ ˆç©ºé—´ç›¸å…³çš„çŸ¥è¯†è¿›è¡Œä¸€æ¬¡æ¯”è¾ƒæ·±å…¥çš„æ¢³ç†ã€‚ä»ä¸­æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªç»“è®ºï¼šæ ˆå¾€å¾€å’Œæ‰§è¡Œå•å…ƒæ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œæ ˆçš„æ´»è·ƒå°±ä»£è¡¨ç€å®ƒæ‰€å¯¹åº”çš„æ‰§è¡Œå•å…ƒçš„æ´»è·ƒã€‚æ ˆä¸Šçš„æ•°æ®éå¸¸æ•æ„Ÿï¼Œä¸€æ—¦è¢«æ”»å‡»ï¼Œå¾€å¾€ä¼šé€ æˆå·¨å¤§çš„ç ´åã€‚</p><p>åœ¨ç¬¬ä¸‰èŠ‚è¯¾é‡Œï¼Œæˆ‘ä»¬å­¦ä¹ äº†å †ç©ºé—´çš„ç®¡ç†æ–¹å¼ï¼Œè¿™ä¸¤èŠ‚è¯¾åˆå­¦ä¹ äº†æ ˆç©ºé—´çš„è¿è¡Œæœºåˆ¶ï¼Œè¿™ä¸¤éƒ¨åˆ†å†…å®¹éƒ½æ˜¯ç¨‹åºè¿è¡Œæ—¶æ‰€è¦æ“ä½œçš„å†…å­˜ã€‚åœ¨è¿™ä¹‹åï¼Œæˆ‘ä»¬å°†ç›®å…‰è½¬ç§»åˆ°ç¨‹åºçš„æ±‡ç¼–ä»£ç ï¼Œç ”ç©¶ä¸€ä¸‹ç¨‹åºçš„é™æ€æ•°æ®æ˜¯å¦‚ä½•ç»„ç»‡å’Œåˆ’åˆ†çš„ã€‚</p><h3>æ€è€ƒé¢˜</h3><p>æˆ‘ä»¬è¿™èŠ‚è¯¾è®²åˆ°äº†åç¨‹å’Œè¿›ç¨‹çš„æ ˆåˆ‡æ¢ï¼Œä½†æ²¡æœ‰è®²çº¿ç¨‹çš„æ ˆåˆ‡æ¢ã€‚è¯·ä½ æ€è€ƒï¼Œçº¿ç¨‹çš„æ ˆåˆ‡æ¢æ˜¯æ›´ç±»ä¼¼åç¨‹é‚£ç§æå‰åˆ›å»ºå¥½çš„æ–¹å¼ï¼Œè¿˜æ˜¯æ›´ç±»ä¼¼äºè¿›ç¨‹é‚£ç§æŒ‰éœ€å†™æ—¶å¤åˆ¶ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºå’Œæˆ‘äº¤æµä½ çš„æƒ³æ³•ï¼Œæˆ‘åœ¨ç•™è¨€åŒºç­‰ä½ ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/c4/e9/c481a2a217c906ed118770a91f17c4e9.jpg?wh=2284x1355\" alt=\"\"></p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„æƒ³æ³•å’Œæ”¶è·ï¼Œæˆ‘åœ¨ç•™è¨€åŒºç­‰ä½ ã€‚å¦‚æœè¿™èŠ‚è¯¾å¸®åˆ°äº†ä½ ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™è‡ªå·±çš„æœ‹å‹ã€‚æˆ‘ä»¬ä¸‹ä¸€è®²å†è§ï¼</p>","comments":[{"had_liked":false,"id":319781,"user_name":"éµ¼","can_delete":false,"product_type":"c1","uid":1101766,"ip_address":"","ucode":"F6561743835F7E","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/c6/6a2d0a5e.jpg","comment_is_top":false,"comment_ctime":1635937766,"is_pvip":false,"replies":[{"id":"116149","content":"Good","user_name":"ä½œè€…å›å¤","user_name_real":"æµ·çº³","uid":"1360512","ctime":1636279305,"ip_address":"","comment_id":319781,"utype":1}],"discussion_count":2,"race_medal":0,"score":"27405741542","product_id":100094901,"comment_content":"è¡¥å……ä¸€ä¸‹ï¼šå…³äºcoroutine,åœ¨ä¼˜åŒ–O1ä¸‹ï¼Œå› ä¸ºæ²¡æœ‰åŸºåœ°å€çš„å…¥æ ˆå‡ºæ ˆæ“ä½œï¼Œæ‰€ä»¥ ä»£ç åªç”¨åˆ é™¤coroutineä¸‹çš„åŸºåœ°å€¼å…¥æ ˆæ“ä½œï¼šstack_pointer -= 1; *stack_pointer = (long) base; å°±å¯ä»¥äº†","like_count":6,"discussions":[{"author":{"id":1360512,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/80/6ebf32e8.jpg","nickname":"æµ·çº³","note":"","ucode":"AB9F7ADB1428D2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529768,"discussion_content":"Good","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636279305,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2304123,"avatar":"","nickname":"Geek_ed84ef","note":"","ucode":"D64973A23FCAA8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587427,"discussion_content":"ä¸ºä»€ä¹ˆåœ¨ä¼˜åŒ–O1ä¸‹æ²¡æœ‰åŸºåœ°å€çš„å…¥æ ˆå‡ºæˆ˜æ“ä½œäº†å‘¢ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1663050930,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":319733,"user_name":"linker","can_delete":false,"product_type":"c1","uid":1803259,"ip_address":"","ucode":"6C5799F2FC2C82","user_header":"https://static001.geekbang.org/account/avatar/00/1b/83/fb/621adceb.jpg","comment_is_top":false,"comment_ctime":1635924876,"is_pvip":false,"replies":[{"id":"115895","content":"å›ç­”æ­£ç¡®ï¼å†™æ—¶å¤åˆ¶åªèƒ½å‘ç”Ÿåœ¨è¿›ç¨‹ä¹‹é—´ã€‚åŒä¸€ä¸ªè¿›ç¨‹çš„çº¿ç¨‹å› ä¸ºå…±äº«èµ„æºï¼Œåªèƒ½æå‰åˆ†é…ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æµ·çº³","uid":"1360512","ctime":1635932413,"ip_address":"","comment_id":319733,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23110761356","product_id":100094901,"comment_content":"æ€è€ƒé¢˜ï¼šçº¿ç¨‹çš„ç”¨æˆ·æ ˆæ˜¯pthreadå‡½æ•°æå‰åˆ›å»ºçš„å—ï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1360512,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/80/6ebf32e8.jpg","nickname":"æµ·çº³","note":"","ucode":"AB9F7ADB1428D2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529747,"discussion_content":"å›ç­”æ­£ç¡®ï¼å†™æ—¶å¤åˆ¶åªèƒ½å‘ç”Ÿåœ¨è¿›ç¨‹ä¹‹é—´ã€‚åŒä¸€ä¸ªè¿›ç¨‹çš„çº¿ç¨‹å› ä¸ºå…±äº«èµ„æºï¼Œåªèƒ½æå‰åˆ†é…ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635932413,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":319669,"user_name":"pedro","can_delete":false,"product_type":"c1","uid":1200704,"ip_address":"","ucode":"F40C839DDFD599","user_header":"https://static001.geekbang.org/account/avatar/00/12/52/40/e57a736e.jpg","comment_is_top":false,"comment_ctime":1635906024,"is_pvip":false,"replies":[{"id":"115863","content":"èµï¼å¾ˆå‡†ç¡®äº†ã€‚æˆ‘ä»¬åœ¨ç¬¬10èŠ‚è¯¾ä¼šè®²é¡µä¸­æ–­ï¼Œé‚£æ—¶å€™å°±ä¼šæ›´åŠ æ·±ä¸€å±‚ç†è§£ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æµ·çº³","uid":"1360512","ctime":1635923811,"ip_address":"","comment_id":319669,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18815775208","product_id":100094901,"comment_content":"fork ç³»ç»Ÿè°ƒç”¨ï¼Œåªä¼šæ–°å»ºä¸€ä¸ªå­è¿›ç¨‹è°ƒç”¨æ ˆï¼Œå¹¶å‘å…¶æ‹·è´çˆ¶è¿›ç¨‹è°ƒç”¨æ ˆæ•°æ®ï¼Œæ‰€ä»¥çˆ¶å­è¿›ç¨‹ä¿å­˜äº†åŒæ ·çš„å¯„å­˜å™¨æ•°æ®ï¼Œå› æ­¤é€ æˆäº† fork è°ƒç”¨ä¸€æ¬¡ï¼Œè€Œè¿”å›ä¸¤æ¬¡çš„ç°è±¡ã€‚<br><br>ç”±äº fork æœ¬è´¨ä¼šå°†çˆ¶è¿›ç¨‹æ‹·è´ä¸€ä»½ï¼Œä½œä¸ºå­è¿›ç¨‹ï¼Œè¿™æ ·å°±ä¼šæœ‰å¤§é‡çš„æ‹·è´å·¥ä½œï¼Œfork ä¼šå¾ˆæ…¢ï¼ŒåŒæ—¶å­è¿›ç¨‹å¯èƒ½ä¸éœ€è¦è¿™ä¹ˆå¤šçš„èµ„æºï¼Œä¼šé€ æˆèµ„æºæµªè´¹ï¼Œå› æ­¤ä¸»æµæ“ä½œç³»ç»Ÿï¼Œæ¯”å¦‚ linux éƒ½å®ç° COW æœºåˆ¶ï¼Œå³å†™æ—¶å¤åˆ¶ï¼Œfork æ—¶å¯¹æ ˆä»¥å¤–çš„èµ„æºéƒ½å…ˆæ˜ å°„åˆ°åœ°å€ç©ºé—´ä¸­ï¼Œæ–‡ä»¶ã€socket ç­‰å¥æŸ„èµ„æºå¼•ç”¨è®¡æ•°+1ï¼Œå¾…å­è¿›ç¨‹è®¿é—®è¿™äº›åœ°å€æ—¶ä¼šè§¦å‘ç¼ºé¡µä¸­æ–­ï¼Œæ­¤æ—¶å†…æ ¸å†æ¥ä¸ºå…¶åˆ†é…çœŸæ­£çš„ç‰©ç†é¡µï¼Œè¿™æ ·å°±èŠ‚çœäº†æ—¶é—´å’Œç©ºé—´ã€‚","like_count":5,"discussions":[{"author":{"id":1360512,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/80/6ebf32e8.jpg","nickname":"æµ·çº³","note":"","ucode":"AB9F7ADB1428D2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529716,"discussion_content":"èµï¼å¾ˆå‡†ç¡®äº†ã€‚æˆ‘ä»¬åœ¨ç¬¬10èŠ‚è¯¾ä¼šè®²é¡µä¸­æ–­ï¼Œé‚£æ—¶å€™å°±ä¼šæ›´åŠ æ·±ä¸€å±‚ç†è§£ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635923811,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321350,"user_name":"å§‘å°„ä»™äºº","can_delete":false,"product_type":"c1","uid":1008517,"ip_address":"","ucode":"3EFC1F3E592165","user_header":"https://static001.geekbang.org/account/avatar/00/0f/63/85/1dc41622.jpg","comment_is_top":false,"comment_ctime":1636807362,"is_pvip":false,"replies":[{"id":"116725","content":"ä½ åé¢çš„ç†è§£åœ¨linuxä¸Šå¤§è‡´æ˜¯å¯¹çš„ã€‚è™½ç„¶ç¡®å®æ¯ä¸ªè¿›ç¨‹æœ‰è‡ªå·±çš„å†…æ ¸æ€æ ˆï¼Œä½†ä½ è¦ç‰¢è®°ï¼Œåœ¨å†…æ ¸æ€è¿è¡Œæ—¶ï¼Œå†…æ ¸ä»£ç æ®µæœ‰èƒ½åŠ›è®¿é—®ä»»ä½•ä¸€ä¸ªè¿›ç¨‹çš„æ ¸å¿ƒç»“æ„ã€‚è¿™æ˜¯ç”¨æˆ·æ€å’Œå†…æ ¸æ€æœ€å¤§çš„ä¸åŒã€‚è¿˜æœ‰ï¼Œä½ å‰è¾¹çš„ç†è§£ä¹Ÿæ²¡é”™ï¼Œå¾®å†…æ ¸çš„æ“ä½œç³»ç»Ÿå°±æ˜¯è¿™ä¹ˆè®¾è®¡çš„ã€‚windowså’Œminixéƒ½æ˜¯ç”±å†…æ ¸è¿›ç¨‹æä¾›æœåŠ¡ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æµ·çº³","uid":"1360512","ctime":1636902348,"ip_address":"","comment_id":321350,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14521709250","product_id":100094901,"comment_content":"è¿›ç¨‹æœ‰ä¸¤ç§æ ˆï¼Œç”¨æˆ·æ€æ ˆå’Œå†…æ ¸æ€æ ˆã€‚ä¹‹å‰ä»¥ä¸ºä¸€ç›´æœ‰ä¸€ä¸ªå†…æ ¸è¿›ç¨‹åœ¨è¿è¡Œï¼Œå‘èµ·ç³»ç»Ÿè°ƒç”¨ç›¸å½“äºç”¨æˆ·è¿›ç¨‹å’Œå†…æ ¸è¿›ç¨‹åœ¨é€šä¿¡ã€‚æ˜¯ä¸æ˜¯å¯ä»¥è¿™æ ·ç†è§£ï¼Œè¿›ç¨‹æ‰§è¡Œçš„ä»£ç æ˜¯åŒ…å«å†…æ ¸ä»£ç å’Œç”¨æˆ·ä»£ç ï¼Œå½“æ‰§è¡Œå†…æ ¸ä»£ç æ—¶éœ€è¦è¿›å…¥å†…æ ¸æ€ï¼Œå½“æ‰§è¡Œç”¨æˆ·ä»£ç æ—¶åœ¨ç”¨æˆ·æ€ã€‚æ‰€ä»¥å„è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ä¸­å°±åŒ…å«ä¸¤éƒ¨åˆ†ï¼Œå†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´ï¼Œåˆ†åˆ«å­˜æ”¾å†…æ ¸ä»£ç å’Œç”¨æˆ·ä»£ç ã€‚æ„Ÿè§‰ç†è§£çš„å¾ˆé›¶ç¢ï¼Œè€å¸ˆå¸®çœ‹çœ‹å“ªå—ç†è§£çš„ä¸å¯¹ã€‚","like_count":3,"discussions":[{"author":{"id":1360512,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/80/6ebf32e8.jpg","nickname":"æµ·çº³","note":"","ucode":"AB9F7ADB1428D2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530275,"discussion_content":"ä½ åé¢çš„ç†è§£åœ¨linuxä¸Šå¤§è‡´æ˜¯å¯¹çš„ã€‚è™½ç„¶ç¡®å®æ¯ä¸ªè¿›ç¨‹æœ‰è‡ªå·±çš„å†…æ ¸æ€æ ˆï¼Œä½†ä½ è¦ç‰¢è®°ï¼Œåœ¨å†…æ ¸æ€è¿è¡Œæ—¶ï¼Œå†…æ ¸ä»£ç æ®µæœ‰èƒ½åŠ›è®¿é—®ä»»ä½•ä¸€ä¸ªè¿›ç¨‹çš„æ ¸å¿ƒç»“æ„ã€‚è¿™æ˜¯ç”¨æˆ·æ€å’Œå†…æ ¸æ€æœ€å¤§çš„ä¸åŒã€‚è¿˜æœ‰ï¼Œä½ å‰è¾¹çš„ç†è§£ä¹Ÿæ²¡é”™ï¼Œå¾®å†…æ ¸çš„æ“ä½œç³»ç»Ÿå°±æ˜¯è¿™ä¹ˆè®¾è®¡çš„ã€‚windowså’Œminixéƒ½æ˜¯ç”±å†…æ ¸è¿›ç¨‹æä¾›æœåŠ¡ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636902348,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":322893,"user_name":"é™ˆç‹„","can_delete":false,"product_type":"c1","uid":2011954,"ip_address":"","ucode":"456F00EB2EB43D","user_header":"https://static001.geekbang.org/account/avatar/00/1e/b3/32/0ee78a1a.jpg","comment_is_top":false,"comment_ctime":1637648739,"is_pvip":false,"replies":[{"id":"117248","content":"ç¼–è¯‘å™¨çš„ä¼˜åŒ–æ²¡åšå¥½ï¼Œå¼€O1ä¼˜åŒ–å°±ä¸ä¼šäº†","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1360512","ctime":1637716610,"ip_address":"","comment_id":322893,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10227583331","product_id":100094901,"comment_content":"mov    %rdi,-0x8(%rbp)<br>mov    %rsi,-0x10(%rbp)<br>mov    -0x10(%rbp),%rax<br>mov    (%rax),%rax<br>mov    -0x8(%rbp),%rdx<br>mov    %rsp,(%rdx)<br>è¯·é—®è€å¸ˆï¼Œè¿™æ®µæ±‡ç¼–ï¼Œæ˜æ˜rdiå’Œrsiå¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨ï¼Œä¸ºä»€ä¹ˆè¦å…ˆå­˜åˆ°æ ˆé‡Œé¢ï¼Œç„¶åå†ä»æ ˆé‡Œé¢å–å‡ºæ¥è®¿é—®ï¼Œè¦ç»•ä¸€é“ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1360512,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/80/6ebf32e8.jpg","nickname":"æµ·çº³","note":"","ucode":"AB9F7ADB1428D2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":532827,"discussion_content":"ç¼–è¯‘å™¨çš„ä¼˜åŒ–æ²¡åšå¥½ï¼Œå¼€O1ä¼˜åŒ–å°±ä¸ä¼šäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637716610,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321420,"user_name":"Geek_27eb54","can_delete":false,"product_type":"c1","uid":2715118,"ip_address":"","ucode":"7D1EE10A61C7C0","user_header":"","comment_is_top":false,"comment_ctime":1636863540,"is_pvip":false,"replies":[{"id":"117073","content":"ä¸æ˜¯è§„åˆ™ä¸ä¸€è‡´å“¦ã€‚è§„åˆ™æ˜¯æ°¸è¿œéƒ½ä¸€æ ·çš„ï¼Œéƒ½æ˜¯MMUæ ¹æ®é¡µè¡¨è¿›è¡Œä¸‰çº§æ˜ å°„ï¼Œä»è™šæ‹Ÿåœ°å€æ˜ å°„ä¸ºç‰©ç†åœ°å€ã€‚ä¸ä¸€æ ·çš„æ˜¯é¡µè¡¨é‡Œé¢çš„å†…å®¹ã€‚ä¸¤ä¸ªè¿›ç¨‹å¯ä»¥æŠŠè‡ªå·±çš„è™šæ‹Ÿåœ°å€æ˜ å°„åˆ°ç›¸åŒçš„ç‰©ç†åœ°å€ã€‚è¿™å°±æ˜¯å…±äº«å†…å­˜ã€‚ä¸€ä¸ªè¿›ç¨‹é‡Œçš„å¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€ä¸ªé¡µè¡¨ï¼Œæ‰€ä»¥çº¿ç¨‹çš„ç§æœ‰å†…å­˜æ˜¯è‚¯å®šä¸ä¼šæœ‰ç›¸åŒçš„åœ°å€çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1360512","ctime":1637375414,"ip_address":"","comment_id":321420,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10226798132","product_id":100094901,"comment_content":"æµ·çº³ï¼Œè€å¸ˆï¼Œæ ¹æ®ä¹‹å‰å­¦çš„ç‰©ç†åœ°å€å’Œè™šæ‹Ÿåœ°å€ï¼Œå…±äº«å†…å­˜å®é™…ä¸Šå¯ä¸å¯ä»¥ç†è§£æˆè™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„è½¬æ¢è§„åˆ™æ˜¯ä¸€è‡´çš„ï¼Œç§æœ‰åœ°å€ä¸­è½¬æ¢è§„åˆ™ä¸ä¸€è‡´ï¼Ÿé‚£ä¹ˆåœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹ä¸­çš„ç§æœ‰å†…å­˜ï¼Œä¼šä¸ä¼šæœ‰ç›¸åŒçš„åœ°å€å‘¢ï¼Ÿæˆ–è€…è¯´æˆ‘è¿™æ ·ç†è§£æœ‰é—®é¢˜å‘¢ï¼Ÿå¸Œæœ›è€å¸ˆå¯ä»¥è§£ç­”ä¸€ä¸‹","like_count":2,"discussions":[{"author":{"id":1360512,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/80/6ebf32e8.jpg","nickname":"æµ·çº³","note":"","ucode":"AB9F7ADB1428D2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":531653,"discussion_content":"ä¸æ˜¯è§„åˆ™ä¸ä¸€è‡´å“¦ã€‚è§„åˆ™æ˜¯æ°¸è¿œéƒ½ä¸€æ ·çš„ï¼Œéƒ½æ˜¯MMUæ ¹æ®é¡µè¡¨è¿›è¡Œä¸‰çº§æ˜ å°„ï¼Œä»è™šæ‹Ÿåœ°å€æ˜ å°„ä¸ºç‰©ç†åœ°å€ã€‚ä¸ä¸€æ ·çš„æ˜¯é¡µè¡¨é‡Œé¢çš„å†…å®¹ã€‚ä¸¤ä¸ªè¿›ç¨‹å¯ä»¥æŠŠè‡ªå·±çš„è™šæ‹Ÿåœ°å€æ˜ å°„åˆ°ç›¸åŒçš„ç‰©ç†åœ°å€ã€‚è¿™å°±æ˜¯å…±äº«å†…å­˜ã€‚ä¸€ä¸ªè¿›ç¨‹é‡Œçš„å¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€ä¸ªé¡µè¡¨ï¼Œæ‰€ä»¥çº¿ç¨‹çš„ç§æœ‰å†…å­˜æ˜¯è‚¯å®šä¸ä¼šæœ‰ç›¸åŒçš„åœ°å€çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637375414,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":331069,"user_name":"çŸ³å¤©å…°çˆ±å­¦ä¹ ","can_delete":false,"product_type":"c1","uid":1451826,"ip_address":"","ucode":"0D95CDA7463516","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/4C2AgnHBt1qmRSiaqPQfEPicCdEJp6IgLC1wsVJPa1zQoRztNaZcqiaRXIblkRc1sgn7dUdPmrE011uFbibEQtia3bg/132","comment_is_top":false,"comment_ctime":1642407524,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5937374820","product_id":100094901,"comment_content":"è€å¸ˆçš„æ–‡ç« åˆå¹²åˆç¡¬ï¼Œå•ƒçš„æˆ‘ç‰™ç–¼&#47;(ã„’oã„’)&#47;~~","like_count":1},{"had_liked":false,"id":320501,"user_name":"æµæµªåœ°çƒ","can_delete":false,"product_type":"c1","uid":1498137,"ip_address":"","ucode":"25210DCD353F97","user_header":"https://static001.geekbang.org/account/avatar/00/16/dc/19/c058bcbf.jpg","comment_is_top":false,"comment_ctime":1636355531,"is_pvip":false,"replies":[{"id":"116227","content":"æ˜¯çš„ï¼Œæˆ‘ä»¬æ˜¯æŠŠå †ä¸Šçš„ä¸€å—å†…å­˜åŒºåŸŸå½“æˆäº†æ ˆæ¥ç”¨ã€‚è¿™ä¸ªä¾‹å­ä¹Ÿè¯´æ˜äº†ï¼Œå†…å­˜åŒºåŸŸåˆ’åˆ†æ˜¯æˆ‘ä»¬æ ¹æ®äººçš„ç†è§£å»åšçš„åˆ’åˆ†ï¼Œè€Œä¸æ˜¯è¯´å°±æ­¤å›ºå®šäº†çš„ã€‚ä½ å¯ä»¥äº†è§£ä¸€ä¸‹jsæˆ–è€…pythonä¸­çš„generatorï¼Œä»–ä»¬æ˜¯stacklessçš„ï¼Œæˆ‘ä»¬è¿™èŠ‚è¯¾çš„åç¨‹æ˜¯stackfulçš„ã€‚å¯¹æ¯”ä¸€ä¸‹è‡ªå·±å°±æ¸…æ¥šäº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æµ·çº³","uid":"1360512","ctime":1636384630,"ip_address":"","comment_id":320501,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5931322827","product_id":100094901,"comment_content":"ç”¨æˆ·æ€çš„åç¨‹æ ˆæ˜¯åˆ†é…åœ¨å †ç©ºé—´çš„å—ï¼Ÿçœ‹ä»£ç æ˜¯ä½¿ç”¨äº†mallocå‡½æ•°ã€‚åç¨‹çš„stackfulå’Œéstackfulæ˜¯ä»€ä¹ˆå´åŒºåˆ«å‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1360512,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/80/6ebf32e8.jpg","nickname":"æµ·çº³","note":"","ucode":"AB9F7ADB1428D2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530016,"discussion_content":"æ˜¯çš„ï¼Œæˆ‘ä»¬æ˜¯æŠŠå †ä¸Šçš„ä¸€å—å†…å­˜åŒºåŸŸå½“æˆäº†æ ˆæ¥ç”¨ã€‚è¿™ä¸ªä¾‹å­ä¹Ÿè¯´æ˜äº†ï¼Œå†…å­˜åŒºåŸŸåˆ’åˆ†æ˜¯æˆ‘ä»¬æ ¹æ®äººçš„ç†è§£å»åšçš„åˆ’åˆ†ï¼Œè€Œä¸æ˜¯è¯´å°±æ­¤å›ºå®šäº†çš„ã€‚ä½ å¯ä»¥äº†è§£ä¸€ä¸‹jsæˆ–è€…pythonä¸­çš„generatorï¼Œä»–ä»¬æ˜¯stacklessçš„ï¼Œæˆ‘ä»¬è¿™èŠ‚è¯¾çš„åç¨‹æ˜¯stackfulçš„ã€‚å¯¹æ¯”ä¸€ä¸‹è‡ªå·±å°±æ¸…æ¥šäº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636384630,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":319770,"user_name":"éµ¼","can_delete":false,"product_type":"c1","uid":1101766,"ip_address":"","ucode":"F6561743835F7E","user_header":"https://static001.geekbang.org/account/avatar/00/10/cf/c6/6a2d0a5e.jpg","comment_is_top":false,"comment_ctime":1635935705,"is_pvip":false,"replies":[{"id":"115920","content":"å“ˆå“ˆå“ˆï¼Œè¯´å¾—å¾ˆæœ‰è¶£ä¹Ÿå¾ˆæ­£ç¡®","user_name":"ä½œè€…å›å¤","user_name_real":"æµ·çº³","uid":"1360512","ctime":1635939470,"ip_address":"","comment_id":319770,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5930903001","product_id":100094901,"comment_content":"å¯¹äºå­¦javaçš„æˆ‘çœ‹æ‡‚è¿™æ®µc++ä»£ç çœŸä¸å®¹æ˜“å•Šï¼Œå¥½æ­¹çœ‹æ‡‚äº† ã€‚æœ€éš¾æ‡‚çš„åº”è¯¥æ˜¯ åç¨‹aäº†ï¼Œä¸€å¼€å§‹ä¸€ç›´è§‰å¾—å‚æ•°NULLï¼Œé‚£ä¸ªstack_pointerå°±æ˜¯ä¸ªnullï¼Œåæ¥æŸ¥æŸ¥èµ„æ–™ï¼ŒæŒ‡é’ˆå˜é‡åœ¨å£°æ˜çš„æ—¶å€™å·²ç»åˆ†é…å†…å­˜åœ°å€äº†ï¼Œæ‰€ä»¥açš„stack_pointerå°±æ˜¯å†…å­˜ä¸­çš„ä¸€å—åœ°å€ï¼Œåªæ˜¯å®ƒæŒ‡å‘ çš„æ˜¯NULLï¼Œæœ¬èº«è¿˜æ˜¯ä¸€ä¸ªå†…å­˜åœ°å€ã€‚å®ƒçš„ä½œç”¨å…¶å®å°±æ˜¯ä¸ºäº†ä¿å­˜mianå‡½æ•°çš„rspï¼Œæ‰€ä»¥æ‰ä¸ç”¨èµ‹å€¼ï¼ˆæˆ–è€…è¯´ç»™æŒ‡å®šçš„åœ°å€ï¼‰ã€‚<br>å…³äºæ€è€ƒé¢˜ï¼šæˆ‘è§‰å¾—åº”è¯¥ç±»ä¼¼äºè¿›ç¨‹é‚£ç§æŒ‰éœ€å†™æ—¶å¤åˆ¶ã€‚åŸå› æˆ‘è®¤ä¸ºçš„æ¯”è¾ƒæµ…æ˜¾ï¼Œä¹Ÿæ¯”è¾ƒå°´å°¬ï¼Œå› ä¸ºforkå’Œpthread_createéƒ½æ˜¯è°ƒç”¨çš„cloneï¼ˆğŸ˜…ğŸ˜…ï¼‰ï¼Œå…¶æ¬¡çº¿ç¨‹çš„èµ„æºéƒ½æ˜¯ å…±äº«çš„çˆ¶äº² ï¼Œé¡µè¡¨ã€è™šæ‹Ÿåœ°å€ ã€æ–‡ä»¶æè¿°ç¬¦å•¥çš„åº”è¯¥éƒ½æ˜¯åŒä¸€ä¸ªã€‚ä¸å¯¹ ï¼Œpthread_createçš„æ—¶å€™æ˜¯æœ‰ å‚æ•°çš„ï¼Œforkæ²¡æœ‰ã€‚é‚£åº”è¯¥æ˜¯ç±»ä¼¼åç¨‹é‚£ç§æå‰åˆ›å»ºå¥½çš„æ–¹å¼ï¼Œç”¨äºä¿å­˜å‚æ•°æ•°æ®ã€‚","like_count":1,"discussions":[{"author":{"id":1360512,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/80/6ebf32e8.jpg","nickname":"æµ·çº³","note":"","ucode":"AB9F7ADB1428D2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529764,"discussion_content":"å“ˆå“ˆå“ˆï¼Œè¯´å¾—å¾ˆæœ‰è¶£ä¹Ÿå¾ˆæ­£ç¡®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635939470,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":319735,"user_name":"å¼ è´º","can_delete":false,"product_type":"c1","uid":1283181,"ip_address":"","ucode":"0254E40FB3EB5F","user_header":"https://static001.geekbang.org/account/avatar/00/13/94/6d/5cd6e8c7.jpg","comment_is_top":false,"comment_ctime":1635924962,"is_pvip":true,"replies":[{"id":"116151","content":"æ²¡æœ‰ã€‚å½“å‰çº¿ç¨‹çš„ç”¨æˆ·æ€çš„çŠ¶æ€è¿˜ä¼šä¿å­˜åœ¨å†…æ ¸æ€æ ˆä¸Šã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æµ·çº³","uid":"1360512","ctime":1636279455,"ip_address":"","comment_id":319735,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5930892258","product_id":100094901,"comment_content":"ç”¨æˆ·æ€å†…æ ¸æ€åˆ‡æ¢çš„æ—¶å€™ï¼Œçº¿ç¨‹åˆ‡æ¢äº†å—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1360512,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/80/6ebf32e8.jpg","nickname":"æµ·çº³","note":"","ucode":"AB9F7ADB1428D2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529749,"discussion_content":"æ²¡æœ‰ã€‚å½“å‰çº¿ç¨‹çš„ç”¨æˆ·æ€çš„çŠ¶æ€è¿˜ä¼šä¿å­˜åœ¨å†…æ ¸æ€æ ˆä¸Šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636279455,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":352413,"user_name":"Geek_a5edac","can_delete":false,"product_type":"c1","uid":1954784,"ip_address":"","ucode":"A47341B4DB9C8E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/d4MHbXBwovYHW7xA18j88ibw1wS2R1JCoH5oLJIMUTdXe07dyVeTNWNzqWUKT7nPg21oClPhy1rSZPFiaibHeUFBA/132","comment_is_top":false,"comment_ctime":1658651113,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1658651113","product_id":100094901,"comment_content":"ä½œä¸ºåç«¯å¼€å‘ï¼Œæ—¥å¸¸å·¥ä½œæ›´å¤šåå‘è®¾è®¡æ¨¡å¼ã€é¢†åŸŸæ¨¡å‹ã€ä¸Šå±‚æ¶æ„çš„è®¾è®¡ã€‚ä½†ä¹Ÿä¸€ç›´å¯¹åº•å±‚åŸç†æ„Ÿå…´è¶£ï¼Œæˆ‘è®¤ä¸ºåœ¨â€œè®¾è®¡â€ä¸Šå¾ˆå¤šæ€æƒ³æ˜¯æƒ³é€šçš„ï¼Œäº’ç›¸å€Ÿé‰´å¹¶èä¼šè´¯é€šæ–¹å¯æ¸¸åˆƒæœ‰ä½™ï¼Œæœ¬ç« èŠ‚æ·±å…¥äº†åº•å±‚ç»†èŠ‚æˆ‘æ€»ç®—æ˜¯å•ƒé€äº†ï¼Œç°åœ¨å¦‚æœè®©æˆ‘è®²ä¸€ä¸‹è¿›ç¨‹ã€çº¿ç¨‹ã€åç¨‹çš„è°ƒåº¦è¿‡ç¨‹ï¼Œè„‘å­é‡Œå·²ç»èƒ½è‡ªè¡Œæ„å»ºå‡ºå¯¹åº”çš„æ ¸å¿ƒæµç¨‹æ¥äº†ï¼Œæ„Ÿè°¢è€å¸ˆã€‚","like_count":1},{"had_liked":false,"id":348973,"user_name":"ç¨‹åºå‘˜ç­å‰","can_delete":false,"product_type":"c1","uid":1478098,"ip_address":"","ucode":"BD48CF7649609A","user_header":"https://static001.geekbang.org/account/avatar/00/16/8d/d2/8a6be8d8.jpg","comment_is_top":false,"comment_ctime":1655614555,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1655614555","product_id":100094901,"comment_content":"golangçš„å†…å­˜ç®¡ç†å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–å †ï¼Œä½†æ˜¯ä¸ºäº†åˆ©ç”¨CPUçš„å¤šæ ¸ç‰¹æ€§è¦å°†åç¨‹è°ƒåº¦åˆ°ä¸åŒçš„æ ¸ä¸Šï¼Œè¿™é‡Œæˆ‘ä¸€ç›´æœ‰å‡ ä¸ªç–‘é—®ã€‚<br>1.golangæ˜¯å•è¿›ç¨‹çš„å—ï¼Ÿå› ä¸ºä¸åŒçš„åç¨‹å¯ä»¥è®¿é—®åŒä¸€å—å †ä¸Šçš„å†…å­˜ã€‚<br>2.å¦‚æœæ˜¯å•è¿›ç¨‹çš„ï¼Œé‚£ä¹ˆå¦‚ä½•èƒ½è®©golangå‘æŒ¥cpuå¤šæ ¸çš„ä¼˜åŠ¿å‘¢ï¼Ÿéš¾é“åŒä¸€ä¸ªè¿›ç¨‹é‡Œçš„ä¸åŒçº¿ç¨‹Må¯ä»¥è¢«è°ƒåº¦åˆ°ä¸åŒçš„CPUæ ¸å¿ƒä¸Šå—ï¼Ÿ<br>","like_count":0},{"had_liked":false,"id":326145,"user_name":"Jerry_Yuan","can_delete":false,"product_type":"c1","uid":1387096,"ip_address":"","ucode":"525A52D7369DBC","user_header":"https://static001.geekbang.org/account/avatar/00/15/2a/58/fabdfe69.jpg","comment_is_top":false,"comment_ctime":1639393421,"is_pvip":false,"replies":[{"id":"118505","content":"æ­£ç¡®ã€‚åªæœ‰ä¸€ç‚¹å°ç‘•ç–µï¼Œå°±æ˜¯æœ€åé‚£ä¸€ç‚¹ï¼Œä¸€èˆ¬æ¥è¯´ä½¿ç”¨çš„æ˜¯popæŒ‡ä»¤ï¼Œè€Œä¸æ˜¯movæŒ‡ä»¤ï¼Œå› ä¸ºè¦ä»æ ˆä¸Šå¼¹å‡ºæ•°æ®ã€‚å½“ç„¶ï¼Œä½¿ç”¨movï¼Œæœ€åå†ä¸€æ¬¡æ€§è°ƒæ•´æ ˆæŒ‡é’ˆä¹Ÿæ˜¯å¯ä»¥çš„ï¼ˆè€Œä¸”åœ¨æŸäº›CPUä¸Šï¼Œå¯èƒ½æ•ˆç‡æ›´é«˜ï¼‰ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1360512","ctime":1639488432,"ip_address":"","comment_id":326145,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1639393421","product_id":100094901,"comment_content":"è¯·é—®è€å¸ˆä¸€ä¸‹ï¼Œåœ¨æœ€åè®²ç”¨æˆ·æ€å†…æ ¸æ€åˆ‡æ¢çš„æ—¶å€™ï¼Œå†…æ ¸ä¸ºäº†åˆ‡æ¢è¿›ç¨‹ï¼Œä¿å­˜ç”¨æˆ·è¿›ç¨‹çš„å¯„å­˜å™¨ç°åœºä»¥åŠpcå¯„å­˜å™¨å€¼ï¼Œç„¶åæ‰§è¡Œè°ƒåº¦ç›¸å…³çš„ç³»ç»Ÿè°ƒç”¨ã€‚æ˜¯ä¸æ˜¯å¯ä»¥ç†è§£æˆ æ¯ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªkernel stackï¼ˆå†…æ ¸åœ°å€ç©ºé—´æ ˆçš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œå­˜æ”¾ç”¨æˆ·è¿›ç¨‹çš„å¯„å­˜å™¨ä¸Šä¸‹æ–‡ä»¥åŠè¿”å›åœ°å€ã€‚ç­‰åˆ°ç³»ç»Ÿè°ƒç”¨ç»“æŸä¹‹åï¼Œå†å°†ä¹‹å‰ä¿å­˜åˆ°å†…æ ¸æ ˆä¸Šçš„ç”¨æˆ·è¿›ç¨‹çš„çŠ¶æ€é€šè¿‡movæŒ‡ä»¤é‡æ–°æ”¾åˆ°å¯„å­˜å™¨ä¸Šï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1360512,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/80/6ebf32e8.jpg","nickname":"æµ·çº³","note":"","ucode":"AB9F7ADB1428D2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538696,"discussion_content":"æ­£ç¡®ã€‚åªæœ‰ä¸€ç‚¹å°ç‘•ç–µï¼Œå°±æ˜¯æœ€åé‚£ä¸€ç‚¹ï¼Œä¸€èˆ¬æ¥è¯´ä½¿ç”¨çš„æ˜¯popæŒ‡ä»¤ï¼Œè€Œä¸æ˜¯movæŒ‡ä»¤ï¼Œå› ä¸ºè¦ä»æ ˆä¸Šå¼¹å‡ºæ•°æ®ã€‚å½“ç„¶ï¼Œä½¿ç”¨movï¼Œæœ€åå†ä¸€æ¬¡æ€§è°ƒæ•´æ ˆæŒ‡é’ˆä¹Ÿæ˜¯å¯ä»¥çš„ï¼ˆè€Œä¸”åœ¨æŸäº›CPUä¸Šï¼Œå¯èƒ½æ•ˆç‡æ›´é«˜ï¼‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639488433,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":1,"child_discussions":[{"author":{"id":1387096,"avatar":"https://static001.geekbang.org/account/avatar/00/15/2a/58/fabdfe69.jpg","nickname":"Jerry_Yuan","note":"","ucode":"525A52D7369DBC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1360512,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/80/6ebf32e8.jpg","nickname":"æµ·çº³","note":"","ucode":"AB9F7ADB1428D2","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":538740,"discussion_content":"è°¢è°¢è€å¸ˆï¼æ„Ÿè§‰å¬äº†è€å¸ˆè®²è§£ä¹‹åï¼Œè¡¥å……ä¸€ç‚¹x86æ±‡ç¼–çŸ¥è¯†ï¼Œè‡ªå·±å†™ä¸€ä¸ªåç¨‹coroutineçš„.soæ–‡ä»¶ä¹Ÿç»éä¸å¯èƒ½ã€‚åªè¦æŠ½è±¡ä¸€ä¸ªåç¨‹ç»“æ„ä½“å­˜æ”¾CPUçš„é€šç”¨å¯„å­˜å™¨å’Œpcï¼Œå†æ¨¡æ‹Ÿåç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œç»´æŠ¤æ¯ä¸€ä¸ªåç¨‹çš„æ ˆå¸§ï¼Œç”¨æ±‡ç¼–æ¢å¤è¢«è°ƒåº¦çš„åç¨‹çš„%rsp, %rbp,ä»¥åŠpcå¯„å­˜å™¨çš„å€¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639495437,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":538696,"ip_address":""},"score":538740,"extra":""}]}]},{"had_liked":false,"id":324934,"user_name":"Geek_d797a2","can_delete":false,"product_type":"c1","uid":2821112,"ip_address":"","ucode":"80027DA49D41BA","user_header":"","comment_is_top":false,"comment_ctime":1638725297,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1638725297","product_id":100094901,"comment_content":"è€å¸ˆå¥½ï¼Œæƒ³é—®ä¸‹ yield to æ–¹æ³•çš„æ±‡ç¼–ç ä¸­ï¼Œä¸ºä»€ä¹ˆæœ€åæ¢å¤æ ˆçš„è¯­å¥ä¸­å¥½è±¡ç¼ºå°‘äº† mov %rbp, %rspï¼Œå‡½æ•°è°ƒç”¨çš„æœ€åä¸‰è¡Œæ±‡ç¼–ä¸æ˜¯éƒ½æœ‰è¿™å¥å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1338751,"avatar":"https://static001.geekbang.org/account/avatar/00/14/6d/7f/e1c189c7.jpg","nickname":"é™ˆè¯š","note":"","ucode":"138DD00D245FEE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556403,"discussion_content":"å› ä¸ºåœ¨yield_toå‡½æ•°ä¸­ï¼Œæ²¡æœ‰ä¿®æ”¹rspçš„å€¼ï¼Œæ‰€ä»¥ä¸éœ€è¦mov %rbp, %rspçš„æ“ä½œ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1647342755,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1184102,"avatar":"https://static001.geekbang.org/account/avatar/00/12/11/66/ac631a36.jpg","nickname":"Geralt","note":"","ucode":"2F31ED777D06A0","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537506,"discussion_content":"&#34;pop %rbp&#34;ç­‰ä»·äº&#34;mov (%rsp), %rbp \\n\\t add $0x8, %rsp \\n\\t&#34;","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1639080381,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":323722,"user_name":"Geek_a5edac","can_delete":false,"product_type":"c1","uid":1954784,"ip_address":"","ucode":"A47341B4DB9C8E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/d4MHbXBwovYHW7xA18j88ibw1wS2R1JCoH5oLJIMUTdXe07dyVeTNWNzqWUKT7nPg21oClPhy1rSZPFiaibHeUFBA/132","comment_is_top":false,"comment_ctime":1638119803,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1638119803","product_id":100094901,"comment_content":"è€å¸ˆï¼Œæ–‡ä¸­ co_a = new coroutine(NULL); è¿™æ®µä»£ç æ²¡çœ‹æ‡‚ï¼Œæˆ‘çœ‹å…¥å‚æ˜¯Nullï¼ŒæŒ‰æ„é€ å‡½æ•°çš„å†™æ³•ï¼š<br>if (entry == NULL) { stack = NULL; stack_pointer = NULL; return; } æ‰€ä»¥æˆ‘çœ‹co_aå¹¶æ²¡æœ‰åˆå§‹åŒ–æ ˆç©ºé—´å•Šï¼Œé‚£åé¢co_açš„æ ˆæ€ä¹ˆèƒ½å­˜å‚¨rspç›¸å…³çš„ä¸Šä¸‹æ–‡ä¿¡æ¯çš„","like_count":0,"discussions":[{"author":{"id":1184102,"avatar":"https://static001.geekbang.org/account/avatar/00/12/11/66/ac631a36.jpg","nickname":"Geralt","note":"","ucode":"2F31ED777D06A0","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537507,"discussion_content":"yield_toå‡½æ•°é‡Œé‚£æ®µæ±‡ç¼–ï¼Œå°±ç›¸å½“äºco_a-&gt;stack_pointer = (å½“å‰%rspçš„å€¼); %rsp = co_b-&gt;stack_pointer","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1639080805,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1338751,"avatar":"https://static001.geekbang.org/account/avatar/00/14/6d/7f/e1c189c7.jpg","nickname":"é™ˆè¯š","note":"","ucode":"138DD00D245FEE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556404,"discussion_content":"å› ä¸ºæœ€ç»ˆæ˜¯ç”¨å½“å‰çš„ä¸»çº¿ç¨‹ä½œä¸ºco_aåç¨‹æ¥å·¥ä½œçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647342794,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321399,"user_name":"ä½™ç”Ÿ","can_delete":false,"product_type":"c1","uid":2421369,"ip_address":"","ucode":"AEF6C96738F03B","user_header":"https://static001.geekbang.org/account/avatar/00/24/f2/79/b2012f53.jpg","comment_is_top":false,"comment_ctime":1636847899,"is_pvip":true,"replies":[{"id":"117074","content":"TSSæ˜¯CPUè§„å®šçš„ã€‚pt_regsæ˜¯è½¯ä»¶å®šä¹‰çš„ã€‚ä½†å…¶å®ç»“æ„éƒ½å·®ä¸å¤šï¼Œå°±æ˜¯ä¿å­˜CPUçš„å¯„å­˜å™¨çš„å€¼è€Œå·²ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1360512","ctime":1637375467,"ip_address":"","comment_id":321399,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1636847899","product_id":100094901,"comment_content":"è€å¸ˆï¼Œè¿™é‡Œæåˆ°çš„TSSï¼Œè·Ÿlinuxé‡Œé¢çš„pt_regé‚£ä¸ªç»“æ„ä½“æ˜¯åŒä¸€ä¸ªä¸œè¥¿å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1360512,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/80/6ebf32e8.jpg","nickname":"æµ·çº³","note":"","ucode":"AB9F7ADB1428D2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":531654,"discussion_content":"TSSæ˜¯CPUè§„å®šçš„ã€‚pt_regsæ˜¯è½¯ä»¶å®šä¹‰çš„ã€‚ä½†å…¶å®ç»“æ„éƒ½å·®ä¸å¤šï¼Œå°±æ˜¯ä¿å­˜CPUçš„å¯„å­˜å™¨çš„å€¼è€Œå·²ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637375467,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":321351,"user_name":"å§‘å°„ä»™äºº","can_delete":false,"product_type":"c1","uid":1008517,"ip_address":"","ucode":"3EFC1F3E592165","user_header":"https://static001.geekbang.org/account/avatar/00/0f/63/85/1dc41622.jpg","comment_is_top":false,"comment_ctime":1636807542,"is_pvip":false,"replies":[{"id":"116723","content":"è¿™ä¸ªä¸“æ ä¸ä¼šå“¦ã€‚æˆ‘å€’æ˜¯æ›¾ç»åœ¨ç›´æ’­ä¸­è®²è¿‡ä¸€æ¬¡ioï¼Œä½ å¯ä»¥å»bç«™çš„æå®¢æ—¶é—´è´¦å·é‡ŒæŸ¥çœ‹","user_name":"ä½œè€…å›å¤","user_name_real":"æµ·çº³","uid":"1360512","ctime":1636902032,"ip_address":"","comment_id":321351,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1636807542","product_id":100094901,"comment_content":"ä¹‹å‰å¬è¯´goroutineæ—¢å®ç°äº†åç¨‹ï¼Œä¹Ÿå¯¹ç”¨æˆ·æ€çš„IOè¿›è¡Œäº†å®Œæ•´çš„å®ç°ï¼Œå…¶ä»–è¯­è¨€çš„åç¨‹å®ç°éƒ½æ˜¯ç¼ºå¤±çš„ï¼Œè¯´æ˜äº†golangçš„å¼ºå¤§ã€‚è€å¸ˆåé¢ä¼šè®²è¿™å—IOè¿™å—å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1360512,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/80/6ebf32e8.jpg","nickname":"æµ·çº³","note":"","ucode":"AB9F7ADB1428D2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530276,"discussion_content":"è¿™ä¸ªä¸“æ ä¸ä¼šå“¦ã€‚æˆ‘å€’æ˜¯æ›¾ç»åœ¨ç›´æ’­ä¸­è®²è¿‡ä¸€æ¬¡ioï¼Œä½ å¯ä»¥å»bç«™çš„æå®¢æ—¶é—´è´¦å·é‡ŒæŸ¥çœ‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636902032,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":320272,"user_name":"Geek_fd760d","can_delete":false,"product_type":"c1","uid":1453388,"ip_address":"","ucode":"03382EF49D900F","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eorbckvhLliahdDbuorLB5E1NhQddskOybChBic2Kf9FmF3Vr0aQnrmCT2JwVADWY3iapkRbXDmKI6gQ/132","comment_is_top":false,"comment_ctime":1636191973,"is_pvip":false,"replies":[{"id":"116144","content":"ä¸èƒ½ï¼Œåœ¨æ‰§è¡Œstartbçš„retæŒ‡ä»¤çš„æ—¶å€™ï¼Œå°±ä¼šå‘ç°rbpå’Œripå¯„å­˜å™¨çš„å€¼éƒ½ä¸æ­£ç¡®äº†ã€‚å¤§æ¦‚ç‡ä¼šå‡ºç°SIGSEGVæˆ–è€…SIGBUSé”™è¯¯ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æµ·çº³","uid":"1360512","ctime":1636278981,"ip_address":"","comment_id":320272,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1636191973","product_id":100094901,"comment_content":"å¯¹äºåç¨‹çš„æ¡ˆä¾‹ä¸­ï¼Œå¦‚æœstart_bå‡½æ•°ä¸­å¹¶æ²¡æœ‰åˆ‡æ¢å›åç¨‹açš„ä»£ç ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°æ‰§è¡Œå®Œåè¿˜èƒ½è¿›å…¥ä¸»å‡½æ•°å—ï¼Ÿå…·ä½“ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1360512,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/80/6ebf32e8.jpg","nickname":"æµ·çº³","note":"","ucode":"AB9F7ADB1428D2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529936,"discussion_content":"ä¸èƒ½ï¼Œåœ¨æ‰§è¡Œstartbçš„retæŒ‡ä»¤çš„æ—¶å€™ï¼Œå°±ä¼šå‘ç°rbpå’Œripå¯„å­˜å™¨çš„å€¼éƒ½ä¸æ­£ç¡®äº†ã€‚å¤§æ¦‚ç‡ä¼šå‡ºç°SIGSEGVæˆ–è€…SIGBUSé”™è¯¯ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636278981,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":319737,"user_name":"å¼ è´º","can_delete":false,"product_type":"c1","uid":1283181,"ip_address":"","ucode":"0254E40FB3EB5F","user_header":"https://static001.geekbang.org/account/avatar/00/13/94/6d/5cd6e8c7.jpg","comment_is_top":false,"comment_ctime":1635925298,"is_pvip":true,"replies":[{"id":"116150","content":"Linuxç³»ç»Ÿæ˜¯è¿™æ ·çš„ã€‚è¿™æ˜¯å› ä¸ºLinuxç³»ç»Ÿæ²¡æœ‰å¾ˆå¥½åœ°æ”¯æŒçº¿ç¨‹ï¼Œè€Œæ˜¯ç›´æ¥åˆ©ç”¨äº†è¿›ç¨‹çš„ç»“æ„ã€‚å½“ç„¶ï¼ŒLinuxçš„å¤šçº¿ç¨‹æ”¯æŒä¹Ÿåœ¨ä¸æ–­åœ°å®Œå–„ä¸­ï¼Œæœªæ¥ä¼šæ˜¯æ€ä¹ˆæ ·ï¼Œæˆ‘ä»¬æ‹­ç›®ä»¥å¾…ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æµ·çº³","uid":"1360512","ctime":1636279417,"ip_address":"","comment_id":319737,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1635925298","product_id":100094901,"comment_content":"æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥åˆ†é…ä¸€ä¸ªå†…æ ¸æ ˆå—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1360512,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/80/6ebf32e8.jpg","nickname":"æµ·çº³","note":"","ucode":"AB9F7ADB1428D2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529751,"discussion_content":"Linuxç³»ç»Ÿæ˜¯è¿™æ ·çš„ã€‚è¿™æ˜¯å› ä¸ºLinuxç³»ç»Ÿæ²¡æœ‰å¾ˆå¥½åœ°æ”¯æŒçº¿ç¨‹ï¼Œè€Œæ˜¯ç›´æ¥åˆ©ç”¨äº†è¿›ç¨‹çš„ç»“æ„ã€‚å½“ç„¶ï¼ŒLinuxçš„å¤šçº¿ç¨‹æ”¯æŒä¹Ÿåœ¨ä¸æ–­åœ°å®Œå–„ä¸­ï¼Œæœªæ¥ä¼šæ˜¯æ€ä¹ˆæ ·ï¼Œæˆ‘ä»¬æ‹­ç›®ä»¥å¾…ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636279417,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":319714,"user_name":"ç‹¬å­¤","can_delete":false,"product_type":"c1","uid":1294873,"ip_address":"","ucode":"301D08665822E7","user_header":"https://static001.geekbang.org/account/avatar/00/13/c2/19/16863a09.jpg","comment_is_top":false,"comment_ctime":1635920676,"is_pvip":true,"replies":[{"id":"115861","content":"å› ä¸ºæˆ‘ä»¬ç”¨äº†&quot;a&quot;(co-&gt;stack_pointer)æ¥çº¦æŸå®ƒåªèƒ½é€åˆ°raxå¯„å­˜å™¨é‡Œã€‚&quot;a&quot;ä»£è¡¨äº†raxå¯„å­˜å™¨ã€‚å…³äºå†…åµŒæ±‡ç¼–ï¼Œæˆ‘ä»¬åœ¨å¯¼å­¦çš„ç¬¬ä¸‰èŠ‚è¯¾é‡Œæœ‰è®²ï¼Œå¯ä¾›å‚è€ƒã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"æµ·çº³","uid":"1360512","ctime":1635923654,"ip_address":"","comment_id":319714,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1635920676","product_id":100094901,"comment_content":"ä¸‹é¢è¿™æ®µä»£ç ä¸­co-&gt;stack_pointerçš„å€¼ä¸ºä»€ä¹ˆä¼šå­˜åˆ°å¯„å­˜å™¨%raxä¸­ï¼Ÿè¿™æ˜¯çº¦å®šçš„å—ï¼Ÿ<br>void yield_to(coroutine* old_co, coroutine* co) <br>{    __asm__ (        &quot;movq %%rsp, %0\\n\\t&quot;        <br>                           &quot;movq %%rax, %%rsp\\n\\t&quot;       <br>                            :&quot;=m&quot;(old_co-&gt;stack_pointer):&quot;a&quot;(co-&gt;stack_pointer):);<br>}","like_count":0,"discussions":[{"author":{"id":1360512,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/80/6ebf32e8.jpg","nickname":"æµ·çº³","note":"","ucode":"AB9F7ADB1428D2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529735,"discussion_content":"å› ä¸ºæˆ‘ä»¬ç”¨äº†&amp;quot;a&amp;quot;(co-&amp;gt;stack_pointer)æ¥çº¦æŸå®ƒåªèƒ½é€åˆ°raxå¯„å­˜å™¨é‡Œã€‚&amp;quot;a&amp;quot;ä»£è¡¨äº†raxå¯„å­˜å™¨ã€‚å…³äºå†…åµŒæ±‡ç¼–ï¼Œæˆ‘ä»¬åœ¨å¯¼å­¦çš„ç¬¬ä¸‰èŠ‚è¯¾é‡Œæœ‰è®²ï¼Œå¯ä¾›å‚è€ƒã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635923654,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":319631,"user_name":"è´¹åŸçš„äºŒé¹","can_delete":false,"product_type":"c1","uid":1101293,"ip_address":"","ucode":"DE768A0CC3053D","user_header":"https://static001.geekbang.org/account/avatar/00/10/cd/ed/825d84ee.jpg","comment_is_top":false,"comment_ctime":1635896664,"is_pvip":false,"replies":[{"id":"115864","content":"å†™æ—¶å¤åˆ¶æ˜¯æŒ‰é¡µè¿›è¡Œå¤åˆ¶çš„ã€‚åœ¨åˆ›å»ºå­è¿›ç¨‹çš„æ—¶å€™å‘¢ï¼Œå­è¿›ç¨‹åªæ˜¯æŠŠé¡µè¡¨å¤åˆ¶ä¸€ä»½ï¼Œæ‰€ä»¥å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ä¸€å¼€å§‹æ˜¯æŒ‡å‘ç›¸åŒçš„ç‰©ç†åœ°å€çš„ã€‚åªæœ‰å½“æœ‰ä¸€ä¸ªè¿›ç¨‹åœ¨å†™çš„æ—¶å€™æ‰ä¼šå¤åˆ¶ä¸€é¡µå‡ºæ¥ã€‚ä½ è¦ç»“åˆç¬¬ä¸€è¯¾æƒ³ä¸€ä¸‹ï¼Œè™šæ‹Ÿç©ºé—´æ˜¯è¿ç»­çš„ï¼Œä½†ç‰©ç†ç©ºé—´ä¸å¿…æ˜¯è¿ç»­çš„ï¼Œæ‰€ä»¥æˆ‘åœ¨èƒŒåæ‚„æ‚„åœ°æŠŠæ˜ å°„åˆ°çš„ç‰©ç†åœ°å€æ›¿æ¢æ‰ï¼Œä½ å…¶å®æ˜¯ä¸çŸ¥é“çš„ã€‚å†æƒ³ä¸€ä¸‹ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"æµ·çº³","uid":"1360512","ctime":1635924327,"ip_address":"","comment_id":319631,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1635896664","product_id":100094901,"comment_content":"â€œå…¶å®ï¼Œè¿™æ®µç¨‹åºæœ€éš¾ç†è§£çš„æ˜¯ç¬¬ 6 è¡Œï¼Œä¸ºä»€ä¹ˆä¸€æ¬¡ fork åï¼Œä¼šæœ‰ä¸¤ç§ä¸åŒçš„è¿”å›å€¼ï¼Ÿè¿™æ˜¯å› ä¸º fork æ–¹æ³•æœ¬è´¨ä¸Šåœ¨ç³»ç»Ÿé‡Œåˆ›å»ºäº†ä¸¤ä¸ªæ ˆï¼Œè¿™ä¸¤ä¸ªæ ˆä¸€ä¸ªæ˜¯çˆ¶è¿›ç¨‹çš„ï¼Œä¸€ä¸ªæ˜¯å­è¿›ç¨‹çš„ã€‚â€<br><br>fork åï¼Œçˆ¶è¿›ç¨‹ä¸å­è¿›ç¨‹ä¼šæœ‰å•ç‹¬çš„æ ˆä¸å…¬ç”¨æ ˆï¼Œæˆ‘æƒ³äº†è§£ä¸‹è¿™ä¸ªåœ°æ–¹çš„æ•°æ®ç»“æ„æ˜¯æ€æ ·çš„ï¼Ÿæ ˆç©ºé—´ä¸€èˆ¬æ˜¯è¿ç»­çš„ï¼Œå¦‚æœæœ‰å…¬ç”¨éƒ¨åˆ†çš„æ ˆï¼Œé‚£éƒ¨åˆ†æ ˆåœ¨å†…å­˜ä¸­å¦‚ä½•å­˜å‚¨ï¼Ÿå¦‚ä½•èƒ½åŒæ—¶åœ¨çˆ¶å­è¿›ç¨‹å»¶ä¼¸å‡ºç‹¬ç«‹çš„æ ˆï¼Ÿå¦‚ä½•å®ç°å†™æ—¶å¤åˆ¶ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1360512,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/80/6ebf32e8.jpg","nickname":"æµ·çº³","note":"","ucode":"AB9F7ADB1428D2","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":529696,"discussion_content":"å†™æ—¶å¤åˆ¶æ˜¯æŒ‰é¡µè¿›è¡Œå¤åˆ¶çš„ã€‚åœ¨åˆ›å»ºå­è¿›ç¨‹çš„æ—¶å€™å‘¢ï¼Œå­è¿›ç¨‹åªæ˜¯æŠŠé¡µè¡¨å¤åˆ¶ä¸€ä»½ï¼Œæ‰€ä»¥å­è¿›ç¨‹å’Œçˆ¶è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ä¸€å¼€å§‹æ˜¯æŒ‡å‘ç›¸åŒçš„ç‰©ç†åœ°å€çš„ã€‚åªæœ‰å½“æœ‰ä¸€ä¸ªè¿›ç¨‹åœ¨å†™çš„æ—¶å€™æ‰ä¼šå¤åˆ¶ä¸€é¡µå‡ºæ¥ã€‚ä½ è¦ç»“åˆç¬¬ä¸€è¯¾æƒ³ä¸€ä¸‹ï¼Œè™šæ‹Ÿç©ºé—´æ˜¯è¿ç»­çš„ï¼Œä½†ç‰©ç†ç©ºé—´ä¸å¿…æ˜¯è¿ç»­çš„ï¼Œæ‰€ä»¥æˆ‘åœ¨èƒŒåæ‚„æ‚„åœ°æŠŠæ˜ å°„åˆ°çš„ç‰©ç†åœ°å€æ›¿æ¢æ‰ï¼Œä½ å…¶å®æ˜¯ä¸çŸ¥é“çš„ã€‚å†æƒ³ä¸€ä¸‹ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1635924327,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}