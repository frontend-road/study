{"id":174555,"title":"15 | 文档模型设计之一：基础设计","content":"<p><strong>课件和Demo地址</strong><br>\n<a href=\"https://gitee.com/geektime-geekbang/geektime-mongodb-course\">https://gitee.com/geektime-geekbang/geektime-mongodb-course</a></p>","comments":[{"had_liked":false,"id":160373,"user_name":"李英权","can_delete":false,"product_type":"c3","uid":1076081,"ip_address":"","ucode":"FECAC14A9C414B","user_header":"https://static001.geekbang.org/account/avatar/00/10/6b/71/e833b14a.jpg","comment_is_top":false,"comment_ctime":1575942780,"is_pvip":false,"replies":[{"id":61223,"content":"总结的很好！","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1575955034,"ip_address":"","comment_id":160373,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"找对象 明确关系 然后建模（结婚成家） 然后就可以运行生产数据孩子了","like_count":9,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":477356,"discussion_content":"总结的很好！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575955034,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1250935,"avatar":"https://static001.geekbang.org/account/avatar/00/13/16/77/30e059c8.jpg","nickname":"kindnull","note":"","ucode":"94733DC93AE2C0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":309368,"discussion_content":"总结的不错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601272995,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":164156,"user_name":"dream","can_delete":false,"product_type":"c3","uid":1117793,"ip_address":"","ucode":"65B33D32FA8BE9","user_header":"https://static001.geekbang.org/account/avatar/00/11/0e/61/ae68f8eb.jpg","comment_is_top":false,"comment_ctime":1576896718,"is_pvip":false,"replies":[{"id":62963,"content":"要看这种操作是否频繁。比如说，部门和人员之间的多对多，修改部门是很少见的操作，就可以接受。因为大部分时候是在读，那我们就是优化了读操作。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1577183927,"ip_address":"","comment_id":164156,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"感觉多对多这样做并不科学把，如果修改其中一个属性，那么就会有好多写的操作，性能不会有问题吗？","like_count":5,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478662,"discussion_content":"要看这种操作是否频繁。比如说，部门和人员之间的多对多，修改部门是很少见的操作，就可以接受。因为大部分时候是在读，那我们就是优化了读操作。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577183927,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":187690,"user_name":"fomy","can_delete":false,"product_type":"c3","uid":1125834,"ip_address":"","ucode":"CD87EA03B1F327","user_header":"https://static001.geekbang.org/account/avatar/00/11/2d/ca/02b0e397.jpg","comment_is_top":false,"comment_ctime":1584193359,"is_pvip":false,"replies":[{"id":73185,"content":"一般不需要。可以直接在联系人表里面有一个 groups 字段：\n\n{\n  _id:xxx,\n  contact_name: &#39;tj&#39;,\n  group_ids:[1, 2, 5] \n}\n对groups字段加个索引就可以快速的根据groupid快速检索该group 的所有成员了。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1584625001,"ip_address":"","comment_id":187690,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"在N-N时，当我要需要频繁查询某个组内的所有成员时，应该怎么设计呢？我自己的想法是加一张组到联系人id的表，不知道这样对不对？","like_count":2,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":487203,"discussion_content":"一般不需要。可以直接在联系人表里面有一个 groups 字段：\n\n{\n  _id:xxx,\n  contact_name: &amp;#39;tj&amp;#39;,\n  group_ids:[1, 2, 5] \n}\n对groups字段加个索引就可以快速的根据groupid快速检索该group 的所有成员了。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1584625001,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":239348,"user_name":"盟讯","can_delete":false,"product_type":"c3","uid":1590262,"ip_address":"","ucode":"EE057FC9ADEF91","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/ZLhicyPutHBNOfYrtwOT4K7D7MvORg3HJlm9HicVj6Zjzp9Cib0JnddrTNVoxFxiautXUgYNBXD6XEVyXK9eP87Y4g/132","comment_is_top":false,"comment_ctime":1596508536,"is_pvip":false,"replies":[{"id":88702,"content":"有可能是和ulimits相关。你看下这个\n\nhttps:&#47;&#47;docs.mongodb.com&#47;manual&#47;reference&#47;ulimit&#47;","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1596804828,"ip_address":"","comment_id":239348,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"唐老师：我使用的mongo是4.0.11版本的，架构是分片集群，现在问题是，默认的最大连接数不够用的，819，怎么调优最大连接数？","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":503075,"discussion_content":"有可能是和ulimits相关。你看下这个\n\nhttps://docs.mongodb.com/manual/reference/ulimit/","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596804828,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":200723,"user_name":"Jone_乔泓恺","can_delete":false,"product_type":"c3","uid":1407941,"ip_address":"","ucode":"158154301D5E40","user_header":"https://static001.geekbang.org/account/avatar/00/15/7b/c5/35f92dad.jpg","comment_is_top":false,"comment_ctime":1585643670,"is_pvip":false,"replies":[{"id":75808,"content":"不是所有的信息都可以嵌套，比如联系人的一些activity&#47;事件。但是联系人的静态属性（相对变化不频繁），则基本都可以内嵌。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1586081154,"ip_address":"","comment_id":200723,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"按照嵌套的方式 如果只建立一张联系人表，其他附属信息都通过嵌套的方式，这样是不是不太好呢？","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":490118,"discussion_content":"不是所有的信息都可以嵌套，比如联系人的一些activity/事件。但是联系人的静态属性（相对变化不频繁），则基本都可以内嵌。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1586081154,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":194605,"user_name":"hellojd_gk","can_delete":false,"product_type":"c3","uid":1679543,"ip_address":"","ucode":"319AF4C1AD568D","user_header":"https://static001.geekbang.org/account/avatar/00/19/a0/b7/1327ae60.jpg","comment_is_top":false,"comment_ctime":1585091450,"is_pvip":false,"replies":[{"id":74319,"content":"可以使用multi-update， 一次更新多条相关语句。mongo 有事务可以支持这个场景。","user_name":"作者回复","user_name_real":"远航的TJ 唐建法","uid":1260017,"ctime":1585221333,"ip_address":"","comment_id":194605,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"在mongo里，把数据和数据关系都存到一起，一是会产生数据冗余。数据的紧凑性能保证吗？以例子说明，比如开始没有头像信息和联系人，稍后再进行更新。这样在存储是会存储在多个位置吧。","like_count":0,"discussions":[{"author":{"id":1260017,"avatar":"https://static001.geekbang.org/account/avatar/00/13/39/f1/6d18a4d1.jpg","nickname":"远航的TJ 唐建法","note":"","ucode":"0719807390250A","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":488856,"discussion_content":"可以使用multi-update， 一次更新多条相关语句。mongo 有事务可以支持这个场景。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585221333,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":358270,"user_name":"Geek_480980","can_delete":false,"product_type":"c3","uid":3166865,"ip_address":"中国香港","ucode":"20ACE418DC835B","user_header":"","comment_is_top":false,"comment_ctime":1664159890,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"唐老师：Document中是否有必要对key进行精简化设计","like_count":0},{"had_liked":false,"id":159765,"user_name":"乘坐Tornado的线程魔法师","can_delete":false,"product_type":"c3","uid":1132661,"ip_address":"","ucode":"C4C9915866E769","user_header":"https://static001.geekbang.org/account/avatar/00/11/48/75/02b4366a.jpg","comment_is_top":false,"comment_ctime":1575782750,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040001,"comment_content":"请教下，mongo中的冗余是怎样定义的？1-N和N-N，我看到内嵌文档里面每一个数组里面都会有重复的字段。是不是意味着1-N和N-N都涉及到冗余呢？","like_count":0}]}