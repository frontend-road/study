{"id":107143,"title":"14丨什么是事务处理，如何使用COMMIT和ROLLBACK进行操作？","content":"<p>我们知道在MySQL 5.5版本之前，默认的存储引擎是MyISAM，在5.5版本之后默认存储引擎是InnoDB。InnoDB和MyISAM区别之一就是InnoDB支持事务，也可以说这是InnoDB取代MyISAM的重要原因。那么什么是事务呢？事务的英文是transaction，从英文中你也能看出来它是进行一次处理的基本单元，要么完全执行，要么都不执行。</p><p>这么讲，你可能觉得有些抽象，我换一种方式讲。</p><p>不知道你是否遇到过这样的情况，你去家门口的小卖铺买东西，已经交了钱，但是老板比较忙接了个电话，忘记你是否交过钱，然后让你重新付款，这时你还要找之前的付款记录证明你已经完成了付款。</p><p>实际上如果我们线下的交易也能支持事务（满足事务的特性），就不会出现交了钱却拿不到商品的烦恼了，同样，对于小卖铺的老板来说，也不存在给出了商品但没有收到款的风险。总之，事务保证了一次处理的完整性，也保证了数据库中的数据一致性。它是一种高级的数据处理方式，如果我们在增加、删除、修改的时候某一个环节出了错，它允许我们回滚还原。正是因为这个特点，事务非常适合应用在安全性高的场景里，比如金融行业等。</p><p>我们今天就来学习下SQL中的事务。今天的课程你将重点掌握以下的内容：</p><!-- [[[read_end]]] --><ol>\n<li>事务的特性是什么？如何理解它们？</li>\n<li>如何对事务进行控制？控制的命令都有哪些？</li>\n<li>为什么我们执行COMMIT、ROLLBACK这些命令的时候，有时会成功，有时会失败？</li>\n</ol><h2>事务的特性：ACID</h2><p>我刚才提到了事务的特性：要么完全执行，要么都不执行。不过要对事务进行更深一步的理解，还要从事务的4个特性说起，这4个特性用英文字母来表达就是ACID。</p><ol>\n<li>A，也就是原子性（Atomicity）。原子的概念就是不可分割，你可以把它理解为组成物质的基本单位，也是我们进行数据处理操作的基本单位。</li>\n<li>C，就是一致性（Consistency）。一致性指的就是数据库在进行事务操作后，会由原来的一致状态，变成另一种一致的状态。也就是说当事务提交后，或者当事务发生回滚后，数据库的完整性约束不能被破坏。</li>\n<li>I，就是隔离性（Isolation）。它指的是每个事务都是彼此独立的，不会受到其他事务的执行影响。也就是说一个事务在提交之前，对其他事务都是不可见的。</li>\n<li>最后一个D，指的是持久性（Durability）。事务提交之后对数据的修改是持久性的，即使在系统出故障的情况下，比如系统崩溃或者存储介质发生故障，数据的修改依然是有效的。因为当事务完成，数据库的日志就会被更新，这时可以通过日志，让系统恢复到最后一次成功的更新状态。</li>\n</ol><p>ACID可以说是事务的四大特性，在这四个特性中，原子性是基础，隔离性是手段，一致性是约束条件，而持久性是我们的目的。原子性和隔离性比较好理解，这里我讲下对一致性的理解（国内很多网站上对一致性的阐述有误，具体你可以参考Wikipedia对<a href=\"https://en.wikipedia.org/wiki/ACID\">Consistency</a>的阐述）。</p><p>我之前讲到过数据表的7种常见约束（<a href=\"https://time.geekbang.org/column/article/101697\">对应04篇</a>）。这里指的一致性本身是由具体的业务定义的，也就是说，任何写入数据库中的数据都需要满足我们事先定义的约束规则。</p><p>比如说，在数据表中我们将姓名字段设置为唯一性约束，这时当事务进行提交或者事务发生回滚的时候，如果数据表中的姓名非唯一，就破坏了事务的一致性要求。所以说，事务操作会让数据表的状态变成另一种一致的状态，如果事务中的某个操作失败了，系统就会自动撤销当前正在执行的事务，返回到事务操作之前的状态。</p><p>事务的另一个特点就是持久性，持久性是通过事务日志来保证的。日志包括了回滚日志和重做日志。当我们通过事务对数据进行修改的时候，首先会将数据库的变化信息记录到重做日志中，然后再对数据库中对应的行进行修改。这样做的好处是，即使数据库系统崩溃，数据库重启后也能找到没有更新到数据库系统中的重做日志，重新执行，从而使事务具有持久性。</p><h2>事务的控制</h2><p>当我们了解了事务的特性后，再来看下如何使用事务。我们知道Oracle是支持事务的，而在MySQL中，则需要选择适合的存储引擎才可以支持事务。如果你使用的是MySQL，可以通过SHOW ENGINES命令来查看当前MySQL支持的存储引擎都有哪些，以及这些存储引擎是否支持事务。</p><p><img src=\"https://static001.geekbang.org/resource/image/dd/45/ddfbb2ec8a03dc4eb3c77ae3dea63945.png?wh=1728*413\" alt=\"\"><br>\n你能看出在MySQL中，InnoDB是支持事务的，而MyISAM存储引擎不支持事务。</p><p>看到这里，我们已经对事务有了一定的了解，现在我们再来看下事务的常用控制语句都有哪些。</p><ol>\n<li>START TRANSACTION或者 BEGIN，作用是显式开启一个事务。</li>\n<li>COMMIT：提交事务。当提交事务后，对数据库的修改是永久性的。</li>\n<li>ROLLBACK或者ROLLBACK TO [SAVEPOINT]，意为回滚事务。意思是撤销正在进行的所有没有提交的修改，或者将事务回滚到某个保存点。</li>\n<li>SAVEPOINT：在事务中创建保存点，方便后续针对保存点进行回滚。一个事务中可以存在多个保存点。</li>\n<li>RELEASE SAVEPOINT：删除某个保存点。</li>\n<li>SET TRANSACTION，设置事务的隔离级别。</li>\n</ol><p>需要说明的是，使用事务有两种方式，分别为隐式事务和显式事务。隐式事务实际上就是自动提交，Oracle默认不自动提交，需要手写COMMIT命令，而MySQL默认自动提交，当然我们可以配置MySQL的参数：</p><pre><code>mysql&gt; set autocommit =0;  //关闭自动提交\n</code></pre><pre><code>mysql&gt; set autocommit =1;  //开启自动提交\n</code></pre><p>我们看下在MySQL的默认状态下，下面这个事务最后的处理结果是什么：</p><pre><code>CREATE TABLE test(name varchar(255), PRIMARY KEY (name)) ENGINE=InnoDB;\nBEGIN;\nINSERT INTO test SELECT '关羽';\nCOMMIT;\nBEGIN;\nINSERT INTO test SELECT '张飞';\nINSERT INTO test SELECT '张飞';\nROLLBACK;\nSELECT * FROM test;\n</code></pre><p>运行结果（1行数据）：</p><p><img src=\"https://static001.geekbang.org/resource/image/a7/26/a7a49569e87dd5c6f5333a81d33c2826.png?wh=222*121\" alt=\"\"></p><p>在这个事务中，整个SQL一共执行了2个事务，第一个是插入“关羽”，提交后执行成功，第二个是插入两次“张飞”，这里需要注意的是，我们将name设置为了主键，也就是说主键的值是唯一的，那么第二次插入“张飞”时就会产生错误，然后执行ROLLBACK相当于对事务进行了回滚，所以我们看到最终结果只有一行数据，也就是第一个事务执行之后的结果，即“关羽”。</p><p>那么如果我们进行下面的操作又会怎样呢？</p><pre><code>CREATE TABLE test(name varchar(255), PRIMARY KEY (name)) ENGINE=InnoDB;\nBEGIN;\nINSERT INTO test SELECT '关羽';\nCOMMIT;\nINSERT INTO test SELECT '张飞';\nINSERT INTO test SELECT '张飞';\nROLLBACK;\nSELECT * FROM test;\n</code></pre><p>运行结果（2行数据）：</p><p><img src=\"https://static001.geekbang.org/resource/image/df/f7/df437e577ce75363f5eb22dc362dbff7.png?wh=239*169\" alt=\"\"><br>\n你能看到这次数据是2行，上一次操作我把两次插入“张飞”放到一个事务里，而这次操作它们不在同一个事务里，那么对于MySQL来说，默认情况下这实际上就是两个事务，因为在autocommit=1的情况下，MySQL会进行隐式事务，也就是自动提交，因此在进行第一次插入“张飞”后，数据表里就存在了两行数据，而第二次插入“张飞”就会报错：<code>1062 - Duplicate entry '张飞' for key 'PRIMARY'</code>。</p><p>最后我们在执行ROLLBACK的时候，实际上事务已经自动提交了，就没法进行回滚了。</p><p>同样的我们再来看下这段代码，你又能发现什么不同呢？</p><pre><code>CREATE TABLE test(name varchar(255), PRIMARY KEY (name)) ENGINE=InnoDB;\nSET @@completion_type = 1;\nBEGIN;\nINSERT INTO test SELECT '关羽';\nCOMMIT;\nINSERT INTO test SELECT '张飞';\nINSERT INTO test SELECT '张飞';\nROLLBACK;\nSELECT * FROM test;\n</code></pre><p>运行结果（1行数据）：</p><p><img src=\"https://static001.geekbang.org/resource/image/26/80/26d1f5a4a534eb9b1415ce867f006b80.png?wh=221*116\" alt=\"\"></p><p>你能看到还是相同的SQL代码，只是我在事务开始之前设置了<code>SET @@completion_type = 1;</code>，结果就和我们第一次处理的一样，只有一个“关羽”。这是为什么呢？</p><p>这里我讲解下MySQL中completion_type参数的作用，实际上这个参数有3种可能：</p><ol>\n<li>completion=0，这是默认情况。也就是说当我们执行COMMIT的时候会提交事务，在执行下一个事务时，还需要我们使用START TRANSACTION或者BEGIN来开启。</li>\n<li>completion=1，这种情况下，当我们提交事务后，相当于执行了COMMIT AND CHAIN，也就是开启一个链式事务，即当我们提交事务之后会开启一个相同隔离级别的事务（隔离级别会在下一节中进行介绍）。</li>\n<li>completion=2，这种情况下COMMIT=COMMIT AND RELEASE，也就是当我们提交后，会自动与服务器断开连接。</li>\n</ol><p>在上面这段代码里，我使用了completion=1，也就是说当我提交之后，相当于在下一行写了一个START TRANSACTION或BEGIN。这时两次插入“张飞”会被认为是在同一个事务之内的操作，那么第二次插入“张飞”就会导致事务失败，而回滚也将这次事务进行了撤销，所以你能看到的结果就只有一个“关羽”。</p><p>通过这样简单的练习，你应该能体会到事务提交和回滚的操作。</p><p>当我们设置autocommit=0时，不论是否采用START TRANSACTION或者BEGIN的方式来开启事务，都需要用COMMIT进行提交，让事务生效，使用ROLLBACK对事务进行回滚。</p><p>当我们设置autocommit=1时，每条SQL语句都会自动进行提交。<br>\n不过这时，如果你采用START TRANSACTION或者BEGIN的方式来显式地开启事务，那么这个事务只有在COMMIT时才会生效，在ROLLBACK时才会回滚。</p><h2>总结</h2><p>关于SQL中的事务处理，内容相对比较多，因此我会采用两节来进行讲解。今天我们对事务的概念进行了理解，并进行了简单的事务操作。我们在做数据库操作的时候，可能会失败，但正是因为有事务的存在，即使在数据库操作失败的情况下，也能保证数据的一致性。同样，多个应用程序访问数据库的时候，事务可以提供隔离，保证事务之间不被干扰。最后，事务一旦提交，结果就会是永久性的，这就意味着，即使系统崩溃了，数据库也可以对数据进行恢复。</p><p>在使用事务的过程中，我们会采用控制流语句对事务进行操作，不过在实际操作中，不一定每次使用COMMIT或ROLLBACK都会成功，你还需要知道当前系统的事务执行方式，也就是一些常用的参数情况，比如MySQL中的autocommit和completion_type等。</p><p>事务是数据库区别于文件系统的重要特性之一，当我们有了事务就会让数据库始终保持一致性，同时我们还能通过事务的机制恢复到某个时间点，这样可以保证已提交到数据库的修改不会因为系统崩溃而丢失。</p><p><img src=\"\" alt=\"\"></p><p>今天的内容到这里就结束了，你能说一下MySQL中都有哪些存储引擎支持事务，通过什么命令可以查看它们吗？另外，你是如何理解事务的特性的？</p><p>欢迎你在评论区写下你的答案，也欢迎把这篇文章分享给你的朋友或者同事，一起来交流。</p>","comments":[{"had_liked":true,"id":113482,"user_name":"柔软的胖","can_delete":false,"product_type":"c1","uid":1573853,"ip_address":"","ucode":"32B0CDA0E03BC5","user_header":"https://static001.geekbang.org/account/avatar/00/18/03/dd/e9f4c243.jpg","comment_is_top":false,"comment_ctime":1563028214,"is_pvip":false,"replies":[{"id":"41349","content":"对的，在MySQL中，如果是连续BEGIN，开启了第一个事务，还没有进行COMMIT提交，而直接进行第二个事务的BEGIN，数据库会隐式的帮助COMMIT第一个事务，然后进入到第二个事务<br>","user_name":"作者回复","comment_id":113482,"uid":"1306094","ip_address":"","utype":1,"ctime":1563068594,"user_name_real":"cy"}],"discussion_count":1,"race_medal":0,"score":"250671131382","product_id":100029501,"comment_content":"set autocommit=0;<br>BEGIN;<br>INSERT INTO test1 VALUES (&#39;a&#39;) ;<br>BEGIN;<br>INSERT INTO test1 VALUES (&#39;b&#39;);<br>INSERT INTO test1 VALUES (&#39;b&#39;);<br><br>在上面代码中，第一个BEGIN没有显示提交。在执行第二个BEGIN时，自动把第一个事务提交了。请问这是MYSQL中默认的行为吗？","like_count":59,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458242,"discussion_content":"对的，在MySQL中，如果是连续BEGIN，开启了第一个事务，还没有进行COMMIT提交，而直接进行第二个事务的BEGIN，数据库会隐式的帮助COMMIT第一个事务，然后进入到第二个事务\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563068594,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113066,"user_name":"马以","can_delete":false,"product_type":"c1","uid":1344431,"ip_address":"","ucode":"3FEA06CA14DE28","user_header":"https://static001.geekbang.org/account/avatar/00/14/83/af/1cb42cd3.jpg","comment_is_top":false,"comment_ctime":1562892720,"is_pvip":false,"replies":[{"id":"63705","content":"感谢Ant同学","user_name":"作者回复","comment_id":113066,"uid":"1306094","ip_address":"","utype":1,"ctime":1577529619,"user_name_real":"cy"}],"discussion_count":1,"race_medal":0,"score":"65987402160","product_id":100029501,"comment_content":"老师能不能穿插着一些工作环境中的实例来介绍呢？比如说事务的自动提交，生产当中我们要设置成自动提交还是不自动提交，是基于什么样的情况下才这样设计，这样就更容易理解了～，一个小建议","like_count":16,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458041,"discussion_content":"感谢Ant同学","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577529619,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":123116,"user_name":"挠头侠","can_delete":false,"product_type":"c1","uid":1150474,"ip_address":"","ucode":"F96966832E2252","user_header":"https://static001.geekbang.org/account/avatar/00/11/8e/0a/31ec5392.jpg","comment_is_top":false,"comment_ctime":1565609019,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"44515281979","product_id":100029501,"comment_content":"老师，在第一个例子中，在第二个begin中插入了两个 ‘张飞’ ，但是执行时发生错误，不是说错误会回滚吗？为什么我们还需要指定 ROLLBACK？<br><br>如果将第一个例子中的ROLLBACK 改成COMMIT 为什么会有一条 ‘张飞’ 插入成功呢？这两个insert不应该是一个事务内吗？不应该都进行回滚吗？","like_count":11,"discussions":[{"author":{"id":1055819,"avatar":"https://static001.geekbang.org/account/avatar/00/10/1c/4b/2e5df06f.jpg","nickname":"三件事","note":"","ucode":"BCC867C8961A24","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":413834,"discussion_content":"所以这个问题的答案是啥？😂两年了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636567191,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1226968,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b8/d8/f81b5604.jpg","nickname":"hcyycb","note":"","ucode":"77FF6CA41F9E66","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1055819,"avatar":"https://static001.geekbang.org/account/avatar/00/10/1c/4b/2e5df06f.jpg","nickname":"三件事","note":"","ucode":"BCC867C8961A24","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":537514,"discussion_content":"第一个例子，rollbak，最后就是只有关羽。如果rollback改成commit，就会插入一条张飞。以上结果没有毛病啊。\n\n如果是默认的autocommit=1；并且没有用begin 或者其他显示开启事务的情况，一条 SQL语句本身就会隐式开启一个事务，如果这个SQL事务出错，当然就自动回滚，恢复到执行SQL之前的状态。\n\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1639091684,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":413834,"ip_address":""},"score":537514,"extra":""}]}]},{"had_liked":false,"id":113177,"user_name":"夜路破晓","can_delete":false,"product_type":"c1","uid":1353577,"ip_address":"","ucode":"9B875F94B759B9","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/3hZfficKPGCq2kjFBu9SgaMjibJTEl7iaW1ta6pZNyiaWP8XEsNpunlnsiaOtBpWTXfT5BvRP3qNByml6p9rtBvqewg/132","comment_is_top":false,"comment_ctime":1562908652,"is_pvip":false,"replies":[{"id":"41361","content":"可以这么理解，要么全部执行，要么全部不执行。不过实际操作的时候，还需要使用COMMIT和ROLLBACK来管理我们的事务","user_name":"作者回复","comment_id":113177,"uid":"1306094","ip_address":"","utype":1,"ctime":1563072097,"user_name_real":"cy"}],"discussion_count":2,"race_medal":0,"score":"40217614316","product_id":100029501,"comment_content":"事务是个有理想、有个性、讲爱憎的耿直BOY。跟这样的人打交道会很放心。","like_count":10,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458094,"discussion_content":"可以这么理解，要么全部执行，要么全部不执行。不过实际操作的时候，还需要使用COMMIT和ROLLBACK来管理我们的事务","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563072097,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1302228,"avatar":"https://static001.geekbang.org/account/avatar/00/13/de/d4/b83c4185.jpg","nickname":"David.cui","note":"","ucode":"AB46F310403612","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":171884,"discussion_content":"靠谱青年","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581755312,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":131829,"user_name":"森鱼","can_delete":false,"product_type":"c1","uid":1638587,"ip_address":"","ucode":"6AF86EB05088F4","user_header":"https://static001.geekbang.org/account/avatar/00/19/00/bb/25a29311.jpg","comment_is_top":false,"comment_ctime":1567926080,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"35927664448","product_id":100029501,"comment_content":"你好，在总结部分之前，音频中有一段“DELIMITER”操作方式，我看文本中并没有相应的段落，可否有空让工作人员补上？谢谢！","like_count":9},{"had_liked":false,"id":144741,"user_name":"半瓶醋","can_delete":false,"product_type":"c1","uid":1282746,"ip_address":"","ucode":"8C898E244D0417","user_header":"https://static001.geekbang.org/account/avatar/00/13/92/ba/9833f06f.jpg","comment_is_top":false,"comment_ctime":1572020673,"is_pvip":true,"replies":[{"id":"59759","content":"加油 总结的不错","user_name":"作者回复","comment_id":144741,"uid":"1306094","ip_address":"","utype":1,"ctime":1574739937,"user_name_real":"cy"}],"discussion_count":1,"race_medal":0,"score":"31636791745","product_id":100029501,"comment_content":"MySQL中InnoDB是支持事务的，MyISAM不支持事务的，可以通过SHOW ENGINES命令查看~<br>事务，简单来说就是：要么成功，要么失败。具体：四个特性（ACID）<br>A：原子性，不可分割；<br>C：一致性，无论事务是否提交成功，数据库的完整性约束不会改变，即会由原来的一致性状态变为另一种一致性状态；<br>I：隔离性，各个事务是独立的，不会互相影响；<br>D：持久性，一旦事务提交，对数据的修改是持久的，即使系统故障，修改依然有效。<br><br>----分割线---<br>记一下，加深印象~","like_count":8,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":472094,"discussion_content":"加油 总结的不错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574739937,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117208,"user_name":"庞鑫华","can_delete":false,"product_type":"c1","uid":1114368,"ip_address":"","ucode":"2A4B9FD568ADF7","user_header":"https://static001.geekbang.org/account/avatar/00/11/01/00/326f3d4d.jpg","comment_is_top":false,"comment_ctime":1564009979,"is_pvip":false,"replies":[{"id":"63800","content":"我记得专栏后面章节里有讲到过，可以看看","user_name":"作者回复","comment_id":117208,"uid":"1306094","ip_address":"","utype":1,"ctime":1577542227,"user_name_real":"cy"}],"discussion_count":1,"race_medal":0,"score":"31628781051","product_id":100029501,"comment_content":"老师，什么时候能讲一下redo,undo log","like_count":8,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459862,"discussion_content":"我记得专栏后面章节里有讲到过，可以看看","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577542227,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":130866,"user_name":"张小倔","can_delete":false,"product_type":"c1","uid":1574088,"ip_address":"","ucode":"6C1B2C4D8CE4C8","user_header":"https://static001.geekbang.org/account/avatar/00/18/04/c8/c75f4f2d.jpg","comment_is_top":false,"comment_ctime":1567561647,"is_pvip":false,"replies":[{"id":"53405","content":"对于复杂的事务来说，可以采用savepoint，可以回滚到指定的保留点，操作起来更灵活","user_name":"作者回复","comment_id":130866,"uid":"1306094","ip_address":"","utype":1,"ctime":1570434176,"user_name_real":"cy"}],"discussion_count":1,"race_medal":0,"score":"23042398127","product_id":100029501,"comment_content":"文章中提到的保存点 savepoint，实用场景有哪些呢 ","like_count":6,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":466165,"discussion_content":"对于复杂的事务来说，可以采用savepoint，可以回滚到指定的保留点，操作起来更灵活","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570434176,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113167,"user_name":"毛豆","can_delete":false,"product_type":"c1","uid":1547185,"ip_address":"","ucode":"7D838CA50D044D","user_header":"https://static001.geekbang.org/account/avatar/00/17/9b/b1/74b04ee6.jpg","comment_is_top":false,"comment_ctime":1562906648,"is_pvip":false,"replies":[{"id":"41208","content":"目前是围绕一个RDBMS来做举例，顺便举例下Oracle和SQL Server的不同，这些不同我回来再做个详细的整理，放到进阶篇中","user_name":"作者回复","comment_id":113167,"uid":"1306094","ip_address":"","utype":1,"ctime":1562920063,"user_name_real":"cy"}],"discussion_count":4,"race_medal":0,"score":"23037743128","product_id":100029501,"comment_content":"为什么一直重点在讲Mysql呢，oracle只是随口一提，而且oracle是有自动提交的，例如像create语句，oracle是自动提交","like_count":6,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458088,"discussion_content":"目前是围绕一个RDBMS来做举例，顺便举例下Oracle和SQL Server的不同，这些不同我回来再做个详细的整理，放到进阶篇中","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562920063,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1554764,"avatar":"https://static001.geekbang.org/account/avatar/00/17/b9/4c/8c9edc85.jpg","nickname":"小庞","note":"","ucode":"7C8367CDB47163","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":382213,"discussion_content":"在第四讲中老师是提到过这个的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1625475369,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1159283,"avatar":"https://static001.geekbang.org/account/avatar/00/11/b0/73/bdf14b17.jpg","nickname":"Z_Winner","note":"","ucode":"B397220071E198","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":38126,"discussion_content":"就oracle来说，ddl是不存在事务一说的啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571732787,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1211987,"avatar":"https://static001.geekbang.org/account/avatar/00/12/7e/53/c29c2fc9.jpg","nickname":"sdjdd","note":"","ucode":"512F2338DFF793","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1785,"discussion_content":"既然二者都有自动提交，那重点讲一个不就行了吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562912491,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":132329,"user_name":"Tyrant","can_delete":false,"product_type":"c1","uid":1478302,"ip_address":"","ucode":"CD053E316EB124","user_header":"https://static001.geekbang.org/account/avatar/00/16/8e/9e/7b4aa967.jpg","comment_is_top":false,"comment_ctime":1568085488,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"14452987376","product_id":100029501,"comment_content":"我发现在navicat里，rollback完全没用，不知道为啥","like_count":4,"discussions":[{"author":{"id":1964047,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/f8/0f/64c3acf5.jpg","nickname":"Ape","note":"","ucode":"B25C3AF51D7A5D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":245918,"discussion_content":"同感","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587712000,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":114471,"user_name":"演","can_delete":false,"product_type":"c1","uid":1075072,"ip_address":"","ucode":"8685926BDA0A66","user_header":"https://static001.geekbang.org/account/avatar/00/10/67/80/4e52c16f.jpg","comment_is_top":false,"comment_ctime":1563322888,"is_pvip":false,"discussion_count":5,"race_medal":0,"score":"14448224776","product_id":100029501,"comment_content":"CREATE TABLE test(name varchar(255), PRIMARY KEY (name)) ENGINE=InnoDB;<br>BEGIN;<br>INSERT INTO test SELECT &#39;关羽&#39;;<br>COMMIT;<br>INSERT INTO test SELECT &#39;张飞&#39;;<br>INSERT INTO test SELECT &#39;张飞&#39;;<br>ROLLBACK;<br>SELECT * FROM test;<br><br>老师 后面两次插入张飞不在一个事务里是什么意思？这两次插入前面也没有begin","like_count":3,"discussions":[{"author":{"id":1474214,"avatar":"https://static001.geekbang.org/account/avatar/00/16/7e/a6/4e331ef4.jpg","nickname":"骑行的掌柜J","note":"","ucode":"3163102651C653","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6879,"discussion_content":"个人理解正因这两次张飞前面没BEGIN，根据事务（是进行一次处理的基本单元）的定义，要么完全执行，要么都不执行。所以当第一次插入张飞的时候，因为没有BEGIN,所以会默认自动提交，此时数据表就有两条数据了；而再次插入同样的张飞，因为与事务的一致性违背了，所以该条不会执行，就会报错，这就是另一个事务了。","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1567152406,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1524154,"avatar":"https://static001.geekbang.org/account/avatar/00/17/41/ba/ae028565.jpg","nickname":"YqY","note":"","ucode":"73FB936045DCB9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1474214,"avatar":"https://static001.geekbang.org/account/avatar/00/16/7e/a6/4e331ef4.jpg","nickname":"骑行的掌柜J","note":"","ucode":"3163102651C653","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":204971,"discussion_content":"第二个张飞报错主要还是因为主键唯一性的原因吧，两个张飞重复了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584243223,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":6879,"ip_address":""},"score":204971,"extra":""}]},{"author":{"id":1186981,"avatar":"https://static001.geekbang.org/account/avatar/00/12/1c/a5/226ce8a7.jpg","nickname":"Noir","note":"","ucode":"985D4C4A5E1E85","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391604,"discussion_content":"CREATE TABLE test(name varchar(255), PRIMARY KEY (name)) ENGINE=InnoDB;\nBEGIN;\nINSERT INTO test SELECT &#39;AAA&#39;;\nCOMMIT; -- 事务结束，AAA 被提交\n\nINSERT INTO test SELECT &#39;BBB&#39;; -- 一个事务结束了，提交 BBB\nINSERT INTO test SELECT &#39;BBB&#39;; -- 这个事务失败了，无法提交\nROLLBACK; -- 回滚上一个事务，但是第一个 BBB 是上上个事务，无法被回滚\nSELECT * FROM test; -- AAA + BBB","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1630548643,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1706074,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/08/5a/4d709cf5.jpg","nickname":"Pray、PF","note":"","ucode":"1E3E4073763490","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":282393,"discussion_content":"因为这是隐式的事务，每条insert语句都是一个事务，执行完后都自动提交，又由于name为主键，不能重复，故会报错，回滚之后就还剩一个关羽，张飞\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1591962642,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1353712,"avatar":"https://static001.geekbang.org/account/avatar/00/14/a7/f0/e3212f18.jpg","nickname":"胡","note":"","ucode":"3917AFED7701CA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5454,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566282568,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113260,"user_name":"时间是最真的答案","can_delete":false,"product_type":"c1","uid":1183601,"ip_address":"","ucode":"B90F3EF769F865","user_header":"https://static001.geekbang.org/account/avatar/00/12/0f/71/9273e8a4.jpg","comment_is_top":false,"comment_ctime":1562926483,"is_pvip":false,"replies":[{"id":"41360","content":"采用默认的autocommit=1;<br>第一个实验后面那个应该是ROLLBACK，和后面的实验都一样，最后一个操作应该是ROLLBACK。所以结果：<br>实验1：关羽<br>实验2：关羽，张飞<br>实验3：关羽<br>","user_name":"作者回复","comment_id":113260,"uid":"1306094","ip_address":"","utype":1,"ctime":1563072031,"user_name_real":"cy"}],"discussion_count":4,"race_medal":0,"score":"14447828371","product_id":100029501,"comment_content":"不知道作者在什么样的环境下操作的，我实验结果和你的不一样；<br>我的 MySQL8.0，使用 Navicat 12 操作的，实验结果都不一样<br>第一个实验，数据库中插入两条数据：关羽，张飞<br>第二个实验，数据库中插入两条数据：关羽，张飞<br>第三个实验，数据库中插入一条数据：关羽<br>麻烦老师回复一下","like_count":3,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458136,"discussion_content":"采用默认的autocommit=1;\n第一个实验后面那个应该是ROLLBACK，和后面的实验都一样，最后一个操作应该是ROLLBACK。所以结果：\n实验1：关羽\n实验2：关羽，张飞\n实验3：关羽\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563072031,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1913261,"avatar":"","nickname":"Cookie123456","note":"","ucode":"F9EF63C38F8976","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":218881,"discussion_content":"我的和上面的一样，第一个实验也是，数据表里面只有一个关于，但是用Select 查询语句，结果显示 关羽和张飞两个数据，太神奇了","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1585710694,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1051663,"avatar":"https://static001.geekbang.org/account/avatar/00/10/0c/0f/93d1c8eb.jpg","nickname":"mickey","note":"","ucode":"8B490C2DDE4010","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2278,"discussion_content":"实验一，因为你是在 Navicat中执行，执行到插入第2个“张飞”是就报错了，后面的语句就不执行了，所以你能看到1个“张飞”。","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1563433854,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1624846,"avatar":"https://static001.geekbang.org/account/avatar/00/18/cb/0e/a9fee0b6.jpg","nickname":"闫城哲","note":"","ucode":"1903E022DF6A6F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":332869,"discussion_content":"执行之后手动执行以下 ROLLBACK , 因为之前报错了,所以ROLLBACK 没有执行哪个导致的","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1607361684,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113124,"user_name":"JustDoDT","can_delete":false,"product_type":"c1","uid":1127175,"ip_address":"","ucode":"6AF0B80F00EAEF","user_header":"https://static001.geekbang.org/account/avatar/00/11/33/07/8f351609.jpg","comment_is_top":false,"comment_ctime":1562900224,"is_pvip":false,"replies":[{"id":"41209","content":"不会的，逐渐会有感觉，尤其是跟着代码跑一遍的时候，效果更佳","user_name":"作者回复","comment_id":113124,"uid":"1306094","ip_address":"","utype":1,"ctime":1562920098,"user_name_real":"cy"}],"discussion_count":2,"race_medal":0,"score":"14447802112","product_id":100029501,"comment_content":"看着文章听一遍，然后在读文章实践一下。然后消化消化，然后1个小时学完一篇。<br>我是不是很菜。","like_count":3,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458069,"discussion_content":"不会的，逐渐会有感觉，尤其是跟着代码跑一遍的时候，效果更佳","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562920098,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1919541,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/4a/35/66caeed9.jpg","nickname":"完美坚持","note":"","ucode":"AE0261D8DDEF64","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":375984,"discussion_content":"一个小时学完一篇不算慢把","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1621913609,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":143943,"user_name":"知行合一","can_delete":false,"product_type":"c1","uid":1532274,"ip_address":"","ucode":"70649648B4D0C6","user_header":"https://wx.qlogo.cn/mmopen/vi_32/3Sltwd1ib5QAd2fq7UJSZ2EickmfEn9R2gl5Ot61ZPpEialyxCXiadp8ofD16oSc4QbTSOWgTvSVHPthaGibendgd3Q/132","comment_is_top":false,"comment_ctime":1571811275,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"10161745867","product_id":100029501,"comment_content":"为什么在navicat中，我和老师的代码一致。但是，实验结果，总是不同。 张飞，每次都被存进去了。很不理解！能说说吗？ 谢谢","like_count":3,"discussions":[{"author":{"id":1165201,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ7mAt63VrbLZPHpeZxSc4IlBYswQSnaAB5wGePaGFDehgiaNfIxI1SJ5yIHIlmVk8hsw0RaoaSCPA/132","nickname":"Stephen","note":"","ucode":"0D49223E6CB7B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333093,"discussion_content":"可能这个帖子对你有帮助:https://stackoverflow.com/questions/31072074/unable-to-start-simple-transaction-in-sqlite","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1607431564,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1149914,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIk46cor5XVFTPZbPOnb7pViabgy450pobo46hRHFQz5nR5ocYRKIzC8vShic36vwa553H4Vj50x5wA/132","nickname":"冲","note":"","ucode":"4191C8A4DF3840","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":42019,"discussion_content":"一样  。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572571722,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1717108,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/33/74/44dd4799.jpg","nickname":"包纸脸之王","note":"","ucode":"D1D539F56555B1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":40092,"discussion_content":"我也是，navicat 有毒，使用 mysql 命令行模式的话倒是和老师的实验结果一致。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1572077114,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113887,"user_name":"linus","can_delete":false,"product_type":"c1","uid":1246600,"ip_address":"","ucode":"910606671D1706","user_header":"https://static001.geekbang.org/account/avatar/00/13/05/88/0a1f1b1d.jpg","comment_is_top":false,"comment_ctime":1563179823,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"10153114415","product_id":100029501,"comment_content":"DROP TABLE test;<br>CREATE TABLE test(name varchar(255), PRIMARY KEY (name)) ENGINE=InnoDB;<br>set autocommit=0;<br>BEGIN;<br>INSERT INTO test SELECT &#39;aaa&#39;;<br>COMMIT;<br>BEGIN;<br>INSERT INTO test SELECT &#39;bbb&#39;;<br>INSERT INTO test SELECT &#39;bbb&#39;;<br>ROLLBACK;<br>SELECT * FROM test;<br><br>为什么我的结果还是<br> aaa<br> bbb","like_count":3,"discussions":[{"author":{"id":1474214,"avatar":"https://static001.geekbang.org/account/avatar/00/16/7e/a6/4e331ef4.jpg","nickname":"骑行的掌柜J","note":"","ucode":"3163102651C653","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6885,"discussion_content":"没有啊 我运行你这个程序后结果出来就是 aaa","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1567153818,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1524154,"avatar":"https://static001.geekbang.org/account/avatar/00/17/41/ba/ae028565.jpg","nickname":"YqY","note":"","ucode":"73FB936045DCB9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":204973,"discussion_content":"我的就是只有aaa  应该是你设置问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584243403,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1016284,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/81/dc/a1662051.jpg","nickname":"Bruce","note":"","ucode":"61E439EEF865A6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":3091,"discussion_content":"难道是你的set autocommit没有生效？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1564154406,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113474,"user_name":"柔软的胖","can_delete":false,"product_type":"c1","uid":1573853,"ip_address":"","ucode":"32B0CDA0E03BC5","user_header":"https://static001.geekbang.org/account/avatar/00/18/03/dd/e9f4c243.jpg","comment_is_top":false,"comment_ctime":1563026039,"is_pvip":false,"replies":[{"id":"41346","content":"在MySQL中BEGIN用于开启事务，对于连续BEGIN的情况，开启了第一个事务，还没有进行COMMIT提交，而直接进行第二个事务的BEGIN，这时数据库会隐式的帮助COMMIT第一个事务，然后进入到第二个事务<br>","user_name":"作者回复","comment_id":113474,"uid":"1306094","ip_address":"","utype":1,"ctime":1563068418,"user_name_real":"cy"}],"discussion_count":1,"race_medal":0,"score":"10152960631","product_id":100029501,"comment_content":"如果“INSERT INTO test SELECT &#39;关羽&#39;;”之后没有执行COMMIT，结果应该是空。<br>但是我执行出来的结果是&#39;关羽&#39;，为什么ROLLBACK没有全部回退。<br><br>代码如下<br>CREATE TABLE test(name varchar(255), PRIMARY KEY (name)) ENGINE=InnoDB;<br>BEGIN;<br>INSERT INTO test SELECT &#39;关羽&#39;;<br>BEGIN;<br>INSERT INTO test SELECT &#39;张飞&#39;;<br>INSERT INTO test SELECT &#39;张飞&#39;;<br>ROLLBACK;<br>SELECT * FROM test;<br>","like_count":2,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458238,"discussion_content":"在MySQL中BEGIN用于开启事务，对于连续BEGIN的情况，开启了第一个事务，还没有进行COMMIT提交，而直接进行第二个事务的BEGIN，这时数据库会隐式的帮助COMMIT第一个事务，然后进入到第二个事务\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563068418,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113225,"user_name":"Demon.Lee","can_delete":false,"product_type":"c1","uid":1052859,"ip_address":"","ucode":"7F0E5493A8E345","user_header":"https://static001.geekbang.org/account/avatar/00/10/10/bb/f1061601.jpg","comment_is_top":false,"comment_ctime":1562920382,"is_pvip":false,"replies":[{"id":"41351","content":"可以的 随着我们对事务理解的深入，对ACID这四个特性也会了解的越来越全面","user_name":"作者回复","comment_id":113225,"uid":"1306094","ip_address":"","utype":1,"ctime":1563069177,"user_name_real":"cy"}],"discussion_count":1,"race_medal":1,"score":"10152854974","product_id":100029501,"comment_content":"ACID 可以说是事务的四大特性，在这四个特性中，原子性是基础，隔离性是手段，一致性是约束条件，而持久性是我们的目的。<br>------以后面试就说这一句，如果问ACID","like_count":2,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458117,"discussion_content":"可以的 随着我们对事务理解的深入，对ACID这四个特性也会了解的越来越全面","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563069177,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113212,"user_name":"我不是矿长","can_delete":false,"product_type":"c1","uid":1232421,"ip_address":"","ucode":"6E31D775AA8D03","user_header":"https://static001.geekbang.org/account/avatar/00/12/ce/25/14a648ae.jpg","comment_is_top":false,"comment_ctime":1562916721,"is_pvip":true,"replies":[{"id":"41352","content":"谢谢 自己可以跑下代码 多加深理解","user_name":"作者回复","comment_id":113212,"uid":"1306094","ip_address":"","utype":1,"ctime":1563069208,"user_name_real":"cy"}],"discussion_count":1,"race_medal":0,"score":"10152851313","product_id":100029501,"comment_content":"学习了","like_count":2,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458113,"discussion_content":"谢谢 自己可以跑下代码 多加深理解","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563069208,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113092,"user_name":"hlz-123","can_delete":false,"product_type":"c1","uid":1433586,"ip_address":"","ucode":"B7E5EF0C260BD2","user_header":"","comment_is_top":false,"comment_ctime":1562896082,"is_pvip":false,"replies":[{"id":"41160","content":"对的 看你的MySQL都支持哪些存储引擎，一般是InnoDB和BDB支持事务","user_name":"作者回复","comment_id":113092,"uid":"1306094","ip_address":"","utype":1,"ctime":1562900190,"user_name_real":"cy"}],"discussion_count":1,"race_medal":0,"score":"10152830674","product_id":100029501,"comment_content":"1.在MySQL中，只有InnoDB引擎支持事务，可以通过命令SHOW ENGINES查看<br>2.事务的特性，可以理解为完整性，在一个事务中的所有指令要么全部有效，要么全部失效，<br>                       如果有一部分语句成功，有一部分语句失败，数据库也会撤销成功的语句效果，<br>                       回滚到该事务执行前的状态。","like_count":2,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458051,"discussion_content":"对的 看你的MySQL都支持哪些存储引擎，一般是InnoDB和BDB支持事务","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562900190,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":162516,"user_name":"tttttttttttt_SL","can_delete":false,"product_type":"c1","uid":1786450,"ip_address":"","ucode":"86F65220247250","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/60IQmdia47hpG35UJwqXuL52DdibibQJ5vkOxbjP6hjdoLpZsfDPOLYZiar9M0QAiaCZckVl8ZENjMnKmFlvpv9Ur2w/132","comment_is_top":false,"comment_ctime":1576547841,"is_pvip":false,"replies":[{"id":"62567","content":"加油~","user_name":"作者回复","comment_id":162516,"uid":"1306094","ip_address":"","utype":1,"ctime":1577068221,"user_name_real":"cy"}],"discussion_count":1,"race_medal":0,"score":"5871515137","product_id":100029501,"comment_content":"看了四五遍懂了","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":478074,"discussion_content":"加油~","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577068221,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":116606,"user_name":"Ronnyz","can_delete":false,"product_type":"c1","uid":1488280,"ip_address":"","ucode":"9F34527B1D343D","user_header":"https://static001.geekbang.org/account/avatar/00/16/b5/98/ffaf2aca.jpg","comment_is_top":false,"comment_ctime":1563880008,"is_pvip":false,"replies":[{"id":"63642","content":"整理的不错","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1577526259,"ip_address":"","comment_id":116606,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5858847304","product_id":100029501,"comment_content":"作业：<br>SHOW ENGINES; 显示的引擎有：MEMORY、MRG_MYISAM、CSV 、FEDERATED 、PERFORMANCE_SCHEMA、 MyISAM  、InnoDB 、BLACKHOLE 、ARCHIVE ，其中只有InnoDB Supports transactions<br>事务的保存点就相当于存档吧","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":459608,"discussion_content":"整理的不错","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1577526259,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113375,"user_name":"Better me","can_delete":false,"product_type":"c1","uid":1261959,"ip_address":"","ucode":"CADF08D357489A","user_header":"https://static001.geekbang.org/account/avatar/00/13/41/87/46d7e1c2.jpg","comment_is_top":false,"comment_ctime":1562987847,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"5857955143","product_id":100029501,"comment_content":"老师您好，数据库事务的隐式提交和显式提交分别有什么使用场景，能否具体举例说明下。","like_count":1,"discussions":[{"author":{"id":1585659,"avatar":"https://static001.geekbang.org/account/avatar/00/18/31/fb/e5918d39.jpg","nickname":"飞机","note":"","ucode":"D0CA3AE2B50686","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2303,"discussion_content":"你可以认为: 更改了数据库并使用了commit的就是显式提交,更改了数据库但是没有使用commit就是隐式提交","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1563445973,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113307,"user_name":"大斌","can_delete":false,"product_type":"c1","uid":1002183,"ip_address":"","ucode":"1434C2B0A29135","user_header":"https://static001.geekbang.org/account/avatar/00/0f/4a/c7/ec18673b.jpg","comment_is_top":false,"comment_ctime":1562941717,"is_pvip":false,"replies":[{"id":"41347","content":"对的 理解正确","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1563068481,"ip_address":"","comment_id":113307,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5857909013","product_id":100029501,"comment_content":"在mysql中用的最多的存储引擎有：innodb，bdb，myisam ,memory 等。其中innodb和bdb支持事务而myisam等不支持事务。<br><br>查看命令：show engines<br><br>对事务特性的理解：原子性是基础，隔离性是手段，一致性是约束条件，持久性是目的","like_count":1,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458160,"discussion_content":"对的 理解正确","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563068481,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113133,"user_name":"魏颖琪","can_delete":false,"product_type":"c1","uid":1184964,"ip_address":"","ucode":"097544C71EBDA7","user_header":"https://static001.geekbang.org/account/avatar/00/12/14/c4/e354d8ba.jpg","comment_is_top":false,"comment_ctime":1562901678,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5857868974","product_id":100029501,"comment_content":"在我的实验中，事务出现错误是不会自动回滚，必须显式有 ROLLBACK 命令。如果使用sql client工具，那很可能是工具进行了判断，并做了自动处理。如果在mysql client的命令行中，不会遇错自动回滚。","like_count":1},{"had_liked":false,"id":113040,"user_name":"mocobk","can_delete":false,"product_type":"c1","uid":1444632,"ip_address":"","ucode":"E82B6DF738BCBB","user_header":"https://static001.geekbang.org/account/avatar/00/16/0b/18/b82d4617.jpg","comment_is_top":false,"comment_ctime":1562891286,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5857858582","product_id":100029501,"comment_content":"<br>Mysql中什么情况下会用到显示事务？","like_count":1,"discussions":[{"author":{"id":1021539,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/96/63/7eb32c9b.jpg","nickname":"捞鱼的搬砖奇","note":"","ucode":"2FD194C4DA26E5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1938,"discussion_content":"这个主要出现在业务操作中，","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563109951,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345336,"user_name":"Geek_dc1862","can_delete":false,"product_type":"c1","uid":1888016,"ip_address":"","ucode":"DC3B41D6BC89D4","user_header":"","comment_is_top":false,"comment_ctime":1652196650,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1652196650","product_id":100029501,"comment_content":"怎么查看mysql数据库参数设置情况呢？","like_count":0},{"had_liked":false,"id":343065,"user_name":"Geek_77a67c","can_delete":false,"product_type":"c1","uid":2985088,"ip_address":"","ucode":"735E6C5E0865EC","user_header":"","comment_is_top":false,"comment_ctime":1650615362,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1650615362","product_id":100029501,"comment_content":"在mysql里面默认是自动提交事务的，也就是说每一条dml语句一个会自动提交的事务，在Oracle里面自动提交事务是默认关闭的，所以要手动开启事务并手动结束事务<br>","like_count":0},{"had_liked":false,"id":342303,"user_name":"PCC","can_delete":false,"product_type":"c1","uid":1330305,"ip_address":"","ucode":"BA27B7737E232B","user_header":"https://static001.geekbang.org/account/avatar/00/14/4c/81/34398512.jpg","comment_is_top":false,"comment_ctime":1650182031,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1650182031","product_id":100029501,"comment_content":"有个问题不是很明白：几个实验中最后都显式写ROLLBACK，那是因为我们知道第二次插入“张飞”十有八九会失败所以显式地写出来吗？如果最后不写ROLLBACK会怎样？而且如果不确定前面的语句执行是否会失败时，写了COMMIT，万一执行失败，失败的事务会自动回滚吗？","like_count":0},{"had_liked":false,"id":339703,"user_name":"程序员小酒栗子","can_delete":false,"product_type":"c1","uid":1507507,"ip_address":"","ucode":"3EB088DDFC1C8B","user_header":"https://static001.geekbang.org/account/avatar/00/17/00/b3/fd62aa8f.jpg","comment_is_top":false,"comment_ctime":1648301418,"is_pvip":true,"discussion_count":0,"race_medal":1,"score":"1648301418","product_id":100029501,"comment_content":"学习了以后要多多练习，不然理解得多深刻都会忘","like_count":0},{"had_liked":false,"id":338404,"user_name":"Geek_4e68bc","can_delete":false,"product_type":"c1","uid":2608672,"ip_address":"","ucode":"8EFF07E4D221AA","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKX6QqquojicLSgpgu88MibWkuXfIQcqlgoWReZ97bfygwThIHWqUmJyjGlOhJj1Be3tA1WFkJkSjFw/132","comment_is_top":false,"comment_ctime":1647487123,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1647487123","product_id":100029501,"comment_content":"老师，我发现savepoint只可以在当前事务中使用。如果我希望在不同事务之间也设置保存点，应该怎么设置呢？","like_count":0},{"had_liked":false,"id":337587,"user_name":"周俊","can_delete":false,"product_type":"c1","uid":2723993,"ip_address":"","ucode":"018FF939002C0B","user_header":"https://static001.geekbang.org/account/avatar/00/29/90/99/24cccca5.jpg","comment_is_top":false,"comment_ctime":1646904585,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1646904585","product_id":100029501,"comment_content":"老师，您好<br>在文章中你之前说是mysql默认自动提交，但是在后面的描述中，completion = 0您这边说是默认情况，但是completion = 0 是关闭自动提交，这里是不是有点矛盾","like_count":0},{"had_liked":false,"id":334237,"user_name":"H","can_delete":false,"product_type":"c1","uid":2370639,"ip_address":"","ucode":"D932D7F9DAFDB8","user_header":"https://static001.geekbang.org/account/avatar/00/24/2c/4f/be77ceac.jpg","comment_is_top":false,"comment_ctime":1644824639,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1644824639","product_id":100029501,"comment_content":"没有理解前两个示例的事务数量，百度看了下<br>①手动开启手动提交：当用户执行start transaction命令时（事务初始化），一个事务开启，当用户执行commit命令时当前事务提交。从用户执行start transaction命令到用户执行commit命令之间的一系列操作为一个完整的事务周期。若不执行commit命令，系统则默认事务回滚。<br><br>②自动开启自动提交：如果用户在当前情况下（参数autocommit=1）未执行start transaction命令而对数据库进行了操作，系统则默认用户对数据库的每一个操作为一个孤立的事务，也就是说用户每进行一次操作系都会即时提交或者即时回滚。这种情况下用户的每一个操作都是一个完整的事务周期。<br><br>示例中，第一个仅有2个事务是因为使用了begin，显示开启到结束，是不是必须有commit或rollback<br>第二个应该有3个事务，没有显示开启事务，那么每一个操作都会隐式的开启一个事务<br><br>这样理解对吗","like_count":0},{"had_liked":false,"id":322743,"user_name":"Fortune","can_delete":false,"product_type":"c1","uid":1508654,"ip_address":"","ucode":"6B9465AC996523","user_header":"https://static001.geekbang.org/account/avatar/00/17/05/2e/5a6b6b6e.jpg","comment_is_top":false,"comment_ctime":1637572979,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637572979","product_id":100029501,"comment_content":"Mysql的隐式事务体现有那些呢","like_count":0},{"had_liked":false,"id":321802,"user_name":"小柒·代购","can_delete":false,"product_type":"c1","uid":2762791,"ip_address":"","ucode":"94C67F0203BAF2","user_header":"https://static001.geekbang.org/account/avatar/00/2a/28/27/6246dc0d.jpg","comment_is_top":false,"comment_ctime":1637049769,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637049769","product_id":100029501,"comment_content":"MySQL [heros]&gt; DROP TABLE test;<br>Query OK, 0 rows affected (0.01 sec)<br><br>MySQL [heros]&gt; CREATE TABLE test(name varchar(255), PRIMARY KEY (name)) ENGINE=InnoDB;<br>Query OK, 0 rows affected (0.01 sec)<br><br>MySQL [heros]&gt; BEGIN;<br>Query OK, 0 rows affected (0.00 sec)<br><br>MySQL [heros]&gt; INSERT INTO test SELECT &#39;关羽&#39;;<br>Query OK, 1 row affected (0.00 sec)<br>Records: 1  Duplicates: 0  Warnings: 0<br><br>MySQL [heros]&gt; SELECT * FROM test;<br>+--------+<br>| name   |<br>+--------+<br>| 关羽   |<br>+--------+<br>1 row in set (0.00 sec)<br><br>MySQL [heros]&gt; INSERT INTO test SELECT &#39;张飞&#39;;<br>Query OK, 1 row affected (0.00 sec)<br>Records: 1  Duplicates: 0  Warnings: 0<br><br>MySQL [heros]&gt; SELECT * FROM test;<br>+--------+<br>| name   |<br>+--------+<br>| 关羽   |<br>| 张飞   |<br>+--------+<br>2 rows in set (0.00 sec)<br><br>MySQL [heros]&gt; INSERT INTO test SELECT &#39;张飞&#39;;<br>ERROR 1062 (23000): Duplicate entry &#39;张飞&#39; for key &#39;PRIMARY&#39;<br>MySQL [heros]&gt; SELECT * FROM test;<br>+--------+<br>| name   |<br>+--------+<br>| 关羽   |<br>| 张飞   |<br>+--------+<br>2 rows in set (0.00 sec)<br><br>MySQL [heros]&gt; ROLLBACK;<br>Query OK, 0 rows affected (0.00 sec)<br><br>MySQL [heros]&gt; SELECT * FROM test;<br>Empty set (0.00 sec)<br><br>从这段看出，COMMIT不仅是提交事务，同时也给这个事务画一个END，这是我的理解。","like_count":0},{"had_liked":false,"id":321799,"user_name":"小柒·代购","can_delete":false,"product_type":"c1","uid":2762791,"ip_address":"","ucode":"94C67F0203BAF2","user_header":"https://static001.geekbang.org/account/avatar/00/2a/28/27/6246dc0d.jpg","comment_is_top":false,"comment_ctime":1637049335,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1637049335","product_id":100029501,"comment_content":"MYSQL默认状态下，版本5.7.34<br><br>MySQL [(none)]&gt; SELECT @@autocommit;<br>+--------------+<br>| @@autocommit |<br>+--------------+<br>|            1 |<br>+--------------+<br>1 row in set (0.00 sec)<br><br>MySQL [(none)]&gt; use heros;<br>Database changed<br>MySQL [heros]&gt; DROP TABLE test;<br>Query OK, 0 rows affected (0.01 sec)<br><br>MySQL [heros]&gt; CREATE TABLE test(name VARCHAR(255), PRIMARY KEY (name)) ENGINE=InnoDB;<br>Query OK, 0 rows affected (0.01 sec)<br><br>MySQL [heros]&gt; BEGIN;<br>Query OK, 0 rows affected (0.00 sec)<br><br>MySQL [heros]&gt; INSERT INTO test SELECT &#39;关羽&#39;;<br>Query OK, 1 row affected (0.00 sec)<br>Records: 1  Duplicates: 0  Warnings: 0<br><br>MySQL [heros]&gt; SELECT * FROM test;<br>+--------+<br>| name   |<br>+--------+<br>| 关羽   |<br>+--------+<br>1 row in set (0.00 sec)<br><br>MySQL [heros]&gt; BEGIN;<br>Query OK, 0 rows affected (0.00 sec)<br><br>MySQL [heros]&gt; INSERT INTO test SELECT &#39;张飞&#39;;<br>Query OK, 1 row affected (0.00 sec)<br>Records: 1  Duplicates: 0  Warnings: 0<br><br>MySQL [heros]&gt; SELECT * FROM test;<br>+--------+<br>| name   |<br>+--------+<br>| 关羽   |<br>| 张飞   |<br>+--------+<br>2 rows in set (0.00 sec)<br><br>MySQL [heros]&gt; INSERT INTO test SELECT &#39;张飞&#39;;<br>ERROR 1062 (23000): Duplicate entry &#39;张飞&#39; for key &#39;PRIMARY&#39;<br>MySQL [heros]&gt; ROLLBACK;<br>Query OK, 0 rows affected (0.00 sec)<br><br>MySQL [heros]&gt; SELECT * FROM test;<br>+--------+<br>| name   |<br>+--------+<br>| 关羽   |<br>+--------+<br>1 row in set (0.00 sec)<br><br>BEGIN开启一个事务","like_count":0},{"had_liked":false,"id":318254,"user_name":"Geek_09c5c4","can_delete":false,"product_type":"c1","uid":2737389,"ip_address":"","ucode":"1A3981FC18E70A","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/WFcMMkjhJEorWesqXk1foJoIicIl7Y4J0PLibOouXSyxcqZICnDg2fiaHCEWJYJnNyaVZ09Iso53ibKGksHiaib5JVbg/132","comment_is_top":false,"comment_ctime":1635216996,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1635216996","product_id":100029501,"comment_content":"我用的mysql，三个运行后都是关羽和张飞，看了看时间戳，是否是随着mysql的更新，这篇已经不适用了呢","like_count":0,"discussions":[{"author":{"id":1897818,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/f5/5a/64e33940.jpg","nickname":"一树半哭","note":"","ucode":"1DB53D04F43DD0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587322,"discussion_content":"一样，有没有大神解答下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662975598,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"浙江"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":317691,"user_name":"Geek_28670d","can_delete":false,"product_type":"c1","uid":2814926,"ip_address":"","ucode":"7BA10C23E56F1E","user_header":"","comment_is_top":false,"comment_ctime":1634891757,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1634891757","product_id":100029501,"comment_content":"事务是指数据库为了完成某一件事情，要做的一组操作。它具有如下四个特性：<br>1.原子性，事务是不可分隔的，要么全部执行成功要么全部失败;<br>2.一致性，事务的提交或者回滚后，数据应满足数据库的约束规则；<br>3.隔离性，事务之间是独立的，它们执行互不影响；<br>4.持久性，事务提交后是永久保存的，即使宕机也不会丢失。","like_count":0},{"had_liked":false,"id":304272,"user_name":"墨染","can_delete":false,"product_type":"c1","uid":2702673,"ip_address":"","ucode":"7822312E4675A5","user_header":"https://static001.geekbang.org/account/avatar/00/29/3d/51/f5b7558c.jpg","comment_is_top":false,"comment_ctime":1627310923,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1627310923","product_id":100029501,"comment_content":"请问有里面有Oracle版本的吗","like_count":0},{"had_liked":false,"id":266663,"user_name":"Stephen","can_delete":false,"product_type":"c1","uid":1165201,"ip_address":"","ucode":"0D49223E6CB7B1","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJ7mAt63VrbLZPHpeZxSc4IlBYswQSnaAB5wGePaGFDehgiaNfIxI1SJ5yIHIlmVk8hsw0RaoaSCPA/132","comment_is_top":false,"comment_ctime":1607431457,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1607431457","product_id":100029501,"comment_content":"只有InnoDB支持,通过show engines来查看.<br>事务的特性:<br>A:原子性,要么全做,要么全不做,不会存在做一部分的情况.<br>C:一致性,执行前和执行后,结果是一致的,比如转账前后,双方的金额总量是一致的,不能出现钱不翼而飞的情况.<br>I:隔离性,我的事务提交对你来说是不可见的,相互之间不会干扰.<br>D:持久性,提交之后对数据的修改是持久的,即使过程中出现崩溃的情况,也可以通过日志进行恢复.","like_count":0},{"had_liked":false,"id":256915,"user_name":"盛艳明","can_delete":false,"product_type":"c1","uid":1132347,"ip_address":"","ucode":"E4C1C699572C44","user_header":"https://static001.geekbang.org/account/avatar/00/11/47/3b/15e4490f.jpg","comment_is_top":false,"comment_ctime":1603782545,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1603782545","product_id":100029501,"comment_content":"1. Innodb<br>2.show engines","like_count":0},{"had_liked":false,"id":253158,"user_name":"盛艳明","can_delete":false,"product_type":"c1","uid":1132347,"ip_address":"","ucode":"E4C1C699572C44","user_header":"https://static001.geekbang.org/account/avatar/00/11/47/3b/15e4490f.jpg","comment_is_top":false,"comment_ctime":1602638741,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1602638741","product_id":100029501,"comment_content":"1. MySql InnoDB 引擎 支持事务<br>2. show engines","like_count":0},{"had_liked":false,"id":239262,"user_name":"pan","can_delete":false,"product_type":"c1","uid":1439228,"ip_address":"","ucode":"7C95D66C95E1BA","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/1iaykDMsDvUbd13DxewFGibSExGyNyzmHK8cciam9EH9RRWbhfSgMDPIbGP5hfe9hX0uTEkybhmic3fdpYVHXmRpJg/132","comment_is_top":false,"comment_ctime":1596469407,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596469407","product_id":100029501,"comment_content":"当我们设置 autocommit=0 时，不论是否采用 START TRANSACTION 或者 BEGIN 的方式来开启事务，都需要用 COMMIT 进行提交，让事务生效，使用 ROLLBACK 对事务进行回滚。当我们设置 autocommit=1 时，每条 SQL 语句都会自动进行提交。不过这时，如果你采用 START TRANSACTION 或者 BEGIN 的方式来显式地开启事务，那么这个事务只有在 COMMIT 时才会生效，在 ROLLBACK 时才会回滚。 <br>这一段的描述是不是写反了，0的时候是默认commit，而1是需要显示commit因为被默认开启了事务。","like_count":0},{"had_liked":false,"id":237760,"user_name":"Value","can_delete":false,"product_type":"c1","uid":1443434,"ip_address":"","ucode":"5413E5E4A7326C","user_header":"https://static001.geekbang.org/account/avatar/00/16/06/6a/48fb83f3.jpg","comment_is_top":false,"comment_ctime":1595944693,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595944693","product_id":100029501,"comment_content":"我使用Navicat 15模拟实验一时，数据表中只有1条数据：“关羽”。但当前查询窗口“SELECT * FROM test” 却能得到结果：“关羽”，“张飞”。切换窗口时查询正常，显示为1条数据。<br><br>这个现象是因为Navicat 客户端的原因还是和MYSQL中的事务某些特性有关？这个现象也太迷惑了...<br>求老师解答。","like_count":0},{"had_liked":false,"id":214683,"user_name":"王锐浩","can_delete":false,"product_type":"c1","uid":1988541,"ip_address":"","ucode":"00FCBEACF7906D","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoeoiahO3vO8xnQbuLkriapWV5J6b08tUiaxhhA7oyRHoBQV7OQQ3TxmSASXs4J39rgibAD9hgptc5jhA/132","comment_is_top":false,"comment_ctime":1588781481,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588781481","product_id":100029501,"comment_content":"对于事务的一致性存在部分疑惑：数据库会由原来的一致性状态变为另一种一致性状态。网上经常会举的例子是银行转账业务，a有100，b有100，比如a向b转账一段金额，但是事务执行前后要保证ab的总金额为200。所以一致性是对我们编写事务的要求吗？","like_count":0},{"had_liked":false,"id":208897,"user_name":"Black","can_delete":false,"product_type":"c1","uid":1620774,"ip_address":"","ucode":"170977A014997C","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/iarwibic7h11K05YSJ9G6JERWqudL1ATGm0bib5pSCsP97rpSwuxLoDvp40RMsywibVH2g5DLphQGM51denSxx6hLZg/132","comment_is_top":false,"comment_ctime":1587460038,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1587460038","product_id":100029501,"comment_content":"事务就是一种元操作，进行一系列复杂的操作的时候可以使用事务，来确保失败后从头开始，而不是停在某个需要逐项查找的地方。","like_count":0},{"had_liked":false,"id":201072,"user_name":"Cookie123456","can_delete":false,"product_type":"c1","uid":1913261,"ip_address":"","ucode":"F9EF63C38F8976","user_header":"","comment_is_top":false,"comment_ctime":1585712011,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1585712011","product_id":100029501,"comment_content":"我对实验二 有一个问题，<br><br>CREATE TABLE test(name varchar(255), PRIMARY KEY (name)) ENGINE=InnoDB;<br>BEGIN;<br>INSERT INTO test SELECT &#39;关羽&#39;;<br>COMMIT;<br>INSERT INTO test SELECT &#39;张飞&#39;;<br>INSERT INTO test SELECT &#39;张飞&#39;;<br>ROLLBACK;<br>SELECT * FROM test;<br><br>当运行完第一提交的时候，按理说下面不会再次执行了。因为completion=0，这是默认情况。也就是说当我们执行 COMMIT 的时候会提交事务，在执行下一个事务时，还需要我们使用 START TRANSACTION 或者 BEGIN 来开启。  <br>","like_count":0,"discussions":[{"author":{"id":1682468,"avatar":"https://static001.geekbang.org/account/avatar/00/19/ac/24/0684a141.jpg","nickname":"彭纪程","note":"","ucode":"F9222D72E791C8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":221096,"discussion_content":"completion = 0 的情况不一定非要重写begin才能开启事务吧，文章结尾只是说了如果要有begin或start开启事务时必须有commit才能算结束一个事务，也就是说它重点是想说如果completion=1需要有commit关键字结束，否则就算一个事务，rollback会一起退回。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585973345,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":201060,"user_name":"Cookie123456","can_delete":false,"product_type":"c1","uid":1913261,"ip_address":"","ucode":"F9EF63C38F8976","user_header":"","comment_is_top":false,"comment_ctime":1585711203,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585711203","product_id":100029501,"comment_content":"首先第一个实验，运行完创建事务的语句之后，用SQL语句查询，得出的结果是关羽和张飞，然而数据表中只有关羽一条数据，可见SQL语句 运行读了脏数据 。如果在Navicat中再次新建查询，执行查询语句，则只有关羽一条数据，可是它为什么会读脏数据呢？？？很值得思考","like_count":0},{"had_liked":false,"id":194813,"user_name":"luck_tou","can_delete":false,"product_type":"c1","uid":1904497,"ip_address":"","ucode":"E6BACBB08C504E","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJKkThulMFj6MiaY8qlsmHWrlIzo1SEhwDjwpgLP2bhLYETx1f0DepRDsBdssd5dFKN35zzFUYnia1Q/132","comment_is_top":false,"comment_ctime":1585107406,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1585107406","product_id":100029501,"comment_content":"虽然这些都会，但是跟着老师再过一遍还是觉得会有新的思考","like_count":0},{"had_liked":false,"id":192731,"user_name":"史丂冰風","can_delete":false,"product_type":"c1","uid":1010780,"ip_address":"","ucode":"531CD21E85620B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/6c/5c/26d8efcd.jpg","comment_is_top":false,"comment_ctime":1584870153,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584870153","product_id":100029501,"comment_content":"老师你好，<br>这是我再mysql8.0 Client执行的结果：<br>mysql&gt; CREATE TABLE test(name varchar(255), PRIMARY KEY (name)) ENGINE=InnoDB;SET @@completion_type = 1;BEGIN;INSERT INTO test SELECT &#39;关羽&#39;;COMMIT;INSERT INTO test SELECT &#39;张飞&#39;;INSERT INTO test SELECT &#39;张飞&#39;;ROLLBACK;SELECT * FROM test;<br>Query OK, 0 rows affected (0.37 sec)<br><br>Query OK, 0 rows affected (0.00 sec)<br><br>Query OK, 0 rows affected (0.00 sec)<br><br>Query OK, 1 row affected (0.00 sec)<br>Records: 1  Duplicates: 0  Warnings: 0<br><br>Query OK, 0 rows affected (0.10 sec)<br><br>Query OK, 1 row affected (0.00 sec)<br>Records: 1  Duplicates: 0  Warnings: 0<br><br>ERROR 1062 (23000): Duplicate entry &#39;张飞&#39; for key &#39;PRIMARY&#39;<br>Query OK, 0 rows affected (0.08 sec)<br><br>+------+<br>| name |<br>+------+<br>| 关羽 |<br>+------+<br>1 row in set (0.00 sec)<br>是一条记录<br>--------------------------------------------------------------<br>以下是通过Navicat执行的结果：<br>CREATE TABLE test(name varchar(255), PRIMARY KEY (name)) ENGINE=InnoDB;<br>SET @@completion_type = 1;<br>BEGIN;<br>INSERT INTO test SELECT &#39;关羽&#39;;<br>COMMIT;<br>INSERT INTO test SELECT &#39;张飞&#39;;<br>INSERT INTO test SELECT &#39;张飞&#39;;ROLLBACK;<br>SELECT * FROM test;<br>结果：<br>CREATE TABLE test(name varchar(255), PRIMARY KEY (name)) ENGINE=InnoDB<br>&gt; OK<br>&gt; 时间: 0.391s<br><br><br>SET @@completion_type = 1<br>&gt; OK<br>&gt; 时间: 0.001s<br><br><br>BEGIN<br>&gt; OK<br>&gt; 时间: 0.001s<br><br><br>INSERT INTO test SELECT &#39;关羽&#39;<br>&gt; Affected rows: 1<br>&gt; 时间: 0.006s<br><br><br>COMMIT<br>&gt; OK<br>&gt; 时间: 0.065s<br><br><br>INSERT INTO test SELECT &#39;张飞&#39;<br>&gt; Affected rows: 1<br>&gt; 时间: 0.001s<br><br><br>INSERT INTO test SELECT &#39;张飞&#39;<br>&gt; 1062 - Duplicate entry &#39;张飞&#39; for key &#39;PRIMARY&#39;<br>&gt; 时间: 0.001s<br>关羽<br>张飞<br>为什么查出来的是两条结果，而且再执行的时候第一条张飞插入成功了，<br><br>","like_count":0},{"had_liked":false,"id":190752,"user_name":"supermouse","can_delete":false,"product_type":"c1","uid":1321860,"ip_address":"","ucode":"88072D5F881827","user_header":"https://static001.geekbang.org/account/avatar/00/14/2b/84/07f0c0d6.jpg","comment_is_top":false,"comment_ctime":1584689968,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1584689968","product_id":100029501,"comment_content":"老师，我执行您的第三个例子的时候，也就是下面的SQL语句，为什么最后表中的数据是“关羽，张飞”呢？我的用的是MySQL8.0，图形化工具用的是MySQL官方提供的workbench。<br>CREATE TABLE test(name varchar(255), PRIMARY KEY (name)) ENGINE=InnoDB;<br>SET @@completion_type = 1;<br>BEGIN;<br>INSERT INTO test SELECT &#39;关羽&#39;;<br>COMMIT;<br>INSERT INTO test SELECT &#39;张飞&#39;;<br>INSERT INTO test SELECT &#39;张飞&#39;;<br>ROLLBACK;<br>SELECT * FROM test;","like_count":0},{"had_liked":false,"id":178596,"user_name":"David.cui","can_delete":false,"product_type":"c1","uid":1302228,"ip_address":"","ucode":"AB46F310403612","user_header":"https://static001.geekbang.org/account/avatar/00/13/de/d4/b83c4185.jpg","comment_is_top":false,"comment_ctime":1581755410,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1581755410","product_id":100029501,"comment_content":"老师关于acid的解释是我见过的比较清楚的","like_count":0},{"had_liked":false,"id":166741,"user_name":"慕城暖阳","can_delete":false,"product_type":"c1","uid":1490699,"ip_address":"","ucode":"F6B58F377325DB","user_header":"https://static001.geekbang.org/account/avatar/00/16/bf/0b/173b87bb.jpg","comment_is_top":false,"comment_ctime":1577583029,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1577583029","product_id":100029501,"comment_content":"CREATE TABLE test(name varchar(255), PRIMARY KEY (name)) ENGINE=InnoDB;<br>BEGIN;<br>INSERT INTO test SELECT &#39;关羽&#39;;<br>COMMIT;<br>BEGIN;<br>INSERT INTO test SELECT &#39;张飞&#39;;<br>INSERT INTO test SELECT &#39;张飞&#39;;<br>ROLLBACK;<br>SELECT * FROM test;<br><br>老师，这段中第一个张飞为什么没有隐式提交呢","like_count":0,"discussions":[{"author":{"id":1024164,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a0/a4/b060c723.jpg","nickname":"阿斯蒂芬","note":"","ucode":"61D5E3BDA4EBC5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":159042,"discussion_content":"因为第一个「张飞」也在显式的「BEGIN」之后，即数据库被告知接下来的操作是由开启事务者主动控制，而不是数据库自动隐式提交。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580650040,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":149596,"user_name":"Geek-fans","can_delete":false,"product_type":"c1","uid":1184743,"ip_address":"","ucode":"56518D2121E884","user_header":"https://static001.geekbang.org/account/avatar/00/12/13/e7/202ac86f.jpg","comment_is_top":false,"comment_ctime":1573287484,"is_pvip":true,"discussion_count":2,"race_medal":0,"score":"1573287484","product_id":100029501,"comment_content":"如果事务中所有sql语句执行正确则需要自己手动提交commit；否则有任何一条执行错误，需要自己提交一条rollback，这时会回滚所有操作，而不是commit会给你自动判断和回滚。","like_count":0,"discussions":[{"author":{"id":1690807,"avatar":"https://static001.geekbang.org/account/avatar/00/19/cc/b7/af6ef83d.jpg","nickname":"抢小孩子糖吃","note":"","ucode":"09F302FC76582A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":54002,"discussion_content":"不明白为什么需要自己提交一条rollback  如果知道会出错 \n正常人肯定会改成正确的语句 而不是加上rollback\n如果是不确定是不是会出错 而我们加上了rollback  然后运行结果正常 那我们写的rollback还会不会被执行","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574249591,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1184743,"avatar":"https://static001.geekbang.org/account/avatar/00/12/13/e7/202ac86f.jpg","nickname":"Geek-fans","note":"","ucode":"56518D2121E884","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1690807,"avatar":"https://static001.geekbang.org/account/avatar/00/19/cc/b7/af6ef83d.jpg","nickname":"抢小孩子糖吃","note":"","ucode":"09F302FC76582A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":67835,"discussion_content":"sql有相关判错语法，类似if（条件出错）rollback。这个可以搜一下，我也是想到类似问题简单了解了一下","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575181688,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":54002,"ip_address":""},"score":67835,"extra":""}]}]},{"had_liked":false,"id":136641,"user_name":"Crush","can_delete":false,"product_type":"c1","uid":1586771,"ip_address":"","ucode":"5E6D4EE02525D8","user_header":"https://static001.geekbang.org/account/avatar/00/18/36/53/1e797289.jpg","comment_is_top":false,"comment_ctime":1569486802,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1569486802","product_id":100029501,"comment_content":"一般不是执行失败执行回滚才有意义吗？不通过流程语句判断一下吗？","like_count":0},{"had_liked":false,"id":129557,"user_name":"Tyrant","can_delete":false,"product_type":"c1","uid":1478302,"ip_address":"","ucode":"CD053E316EB124","user_header":"https://static001.geekbang.org/account/avatar/00/16/8e/9e/7b4aa967.jpg","comment_is_top":false,"comment_ctime":1567154138,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1567154138","product_id":100029501,"comment_content":"```sql<br>CREATE TABLE test(name varchar(255), PRIMARY KEY (name)) ENGINE=InnoDB;<br>BEGIN;<br>INSERT INTO test SELECT &#39;关羽&#39;;<br>COMMIT;<br>BEGIN;<br>INSERT INTO test SELECT &#39;张飞&#39;;<br>INSERT INTO test SELECT &#39;张飞&#39;;<br>ROLLBACK;<br>SELECT * FROM test;<br>```<br>为什么我直接复制老师的代码，结果却不一样，张飞也存进去了？？？","like_count":0,"discussions":[{"author":{"id":1360554,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c2/aa/fbff810a.jpg","nickname":"二刀田","note":"","ucode":"1854DA6F1017E5","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":82111,"discussion_content":"感觉事务的隔离性完全没起到效果","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576321493,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1697310,"avatar":"https://static001.geekbang.org/account/avatar/00/19/e6/1e/0f13edb4.jpg","nickname":"hello sunshine","note":"","ucode":"EC59DBE9AADA9A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":36519,"discussion_content":"我也是。。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1571388332,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":125963,"user_name":"胡","can_delete":false,"product_type":"c1","uid":1353712,"ip_address":"","ucode":"3917AFED7701CA","user_header":"https://static001.geekbang.org/account/avatar/00/14/a7/f0/e3212f18.jpg","comment_is_top":false,"comment_ctime":1566284134,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566284134","product_id":100029501,"comment_content":"CREATE TABLE test(name varchar(255), PRIMARY KEY (name)) ENGINE=InnoDB;<br>BEGIN;<br>INSERT INTO test SELECT &#39;关羽&#39;;<br>COMMIT;<br>BEGIN;<br>INSERT INTO test SELECT &#39;张飞&#39;;<br>INSERT INTO test SELECT &#39;张飞&#39;;<br>ROLLBACK;<br><br><br><br>CREATE TABLE test(name varchar(255), PRIMARY KEY (name)) ENGINE=InnoDB<br>&gt; OK<br>&gt; 时间: 0.034s<br><br><br>BEGIN<br>&gt; OK<br>&gt; 时间: 0s<br><br><br>INSERT INTO test SELECT &#39;关羽&#39;<br>&gt; Affected rows: 1<br>&gt; 时间: 0.005s<br><br><br>COMMIT<br>&gt; OK<br>&gt; 时间: 0.002s<br><br><br>BEGIN<br>&gt; OK<br>&gt; 时间: 0s<br><br><br>INSERT INTO test SELECT &#39;张飞&#39;<br>&gt; Affected rows: 1<br>&gt; 时间: 0s<br><br><br>INSERT INTO test SELECT &#39;张飞&#39;<br>&gt; 1062 - Duplicate entry &#39;张飞&#39; for key &#39;PRIMARY&#39;<br>&gt; 时间: 0s<br><br><br>关羽<br>张飞<br><br>1、运行下来就是关于张飞<br>2、不太理解第二种方式  默认是两个事务 ","like_count":0},{"had_liked":false,"id":124511,"user_name":"粗茶","can_delete":false,"product_type":"c1","uid":1543236,"ip_address":"","ucode":"B7EF050090A1A6","user_header":"https://static001.geekbang.org/account/avatar/00/17/8c/44/c50d62b2.jpg","comment_is_top":false,"comment_ctime":1565915187,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1565915187","product_id":100029501,"comment_content":"我还是有点懵。显式事务以START TRANSACTION 或者 BEGIN开头，那以什么结束呢？COMMIT吗？","like_count":0},{"had_liked":false,"id":114927,"user_name":"mickey","can_delete":false,"product_type":"c1","uid":1051663,"ip_address":"","ucode":"8B490C2DDE4010","user_header":"https://static001.geekbang.org/account/avatar/00/10/0c/0f/93d1c8eb.jpg","comment_is_top":false,"comment_ctime":1563434706,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563434706","product_id":100029501,"comment_content":"# 查看支持的引擎<br>SHOW ENGINES;<br><br>","like_count":0},{"had_liked":false,"id":114803,"user_name":"l_j_dota_1111","can_delete":false,"product_type":"c1","uid":1490128,"ip_address":"","ucode":"4CA8A41F5107C7","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEJwHLLQK3AicN8XqichEbfqSACpRB5kry8bIMBcuB3bSiaeic9hABrmn7TZgqaWJ8Xc1gWh6icasZCt3Fg/132","comment_is_top":false,"comment_ctime":1563410458,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563410458","product_id":100029501,"comment_content":"一直在用postgres，postgis，可以很好的支持空间数据","like_count":0},{"had_liked":false,"id":113640,"user_name":"🄽🄸🅇🅄🅂","can_delete":false,"product_type":"c1","uid":1000060,"ip_address":"","ucode":"853763C229A5AA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/42/7c/8ef14715.jpg","comment_is_top":false,"comment_ctime":1563101925,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563101925","product_id":100029501,"comment_content":"set autocommit=0了, 还需要begin或start transaction来开启事务?","like_count":0},{"had_liked":false,"id":113199,"user_name":"江南皮革厂研发中心保安队长","can_delete":false,"product_type":"c1","uid":1099584,"ip_address":"","ucode":"231419643A5CC5","user_header":"https://static001.geekbang.org/account/avatar/00/10/c7/40/66a203cd.jpg","comment_is_top":false,"comment_ctime":1562912951,"is_pvip":false,"replies":[{"id":"41359","content":"对的 都是在autocommit=1的环境下，第一个例子后面那个应该是ROLLBACK。第二次插入张飞会报Duplicate ERROR，需要ROLLBACK才会进行回滚。","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1563071862,"ip_address":"","comment_id":113199,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1562912951","product_id":100029501,"comment_content":"老师，前面两个例子您应该也是在autocommit=1的环境下运行的吧，我这边不管这个参数是1还是0，事务里连续提交两个一样的name字段会报错然后也会添加上一条，除非rollback，所以您前面两个例子是不是举反了？","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458107,"discussion_content":"对的 都是在autocommit=1的环境下，第一个例子后面那个应该是ROLLBACK。第二次插入张飞会报Duplicate ERROR，需要ROLLBACK才会进行回滚。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563071862,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113119,"user_name":"humor","can_delete":false,"product_type":"c1","uid":1181867,"ip_address":"","ucode":"9B48C4C7BEC92C","user_header":"https://static001.geekbang.org/account/avatar/00/12/08/ab/caec7bca.jpg","comment_is_top":false,"comment_ctime":1562899536,"is_pvip":false,"replies":[{"id":"41354","content":"对 应该是ROLLBACK","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1563069399,"ip_address":"","comment_id":113119,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1562899536","product_id":100029501,"comment_content":"第一例子插入两条‘张飞’，应该是用rollback而不是commit吧，我测试的使用commit的话，会有一条&#39;张飞&#39;的记录持久化到了数据库中","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458065,"discussion_content":"对 应该是ROLLBACK","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563069399,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1353712,"avatar":"https://static001.geekbang.org/account/avatar/00/14/a7/f0/e3212f18.jpg","nickname":"胡","note":"","ucode":"3917AFED7701CA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5453,"discussion_content":"怎么试都不对，原来原因在这里？\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566282323,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113112,"user_name":"cricket1981","can_delete":false,"product_type":"c1","uid":1001715,"ip_address":"","ucode":"758262F5958DA4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/48/f3/f1034ffd.jpg","comment_is_top":false,"comment_ctime":1562898295,"is_pvip":false,"replies":[{"id":"41358","content":"如果采用autocommit=1;的情况 应该就是aaa, bbb两条数据。如果是autocommit=0;的情况，应该就是你这个结果，也就是一条记录 aaa","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1563070561,"ip_address":"","comment_id":113112,"utype":1}],"discussion_count":4,"race_medal":0,"score":"1562898295","product_id":100029501,"comment_content":"第二个例子结果也不同<br><br>mysql&gt; DROP TABLE test;<br>Query OK, 0 rows affected (0.02 sec)<br><br>mysql&gt; CREATE TABLE test(name varchar(255), PRIMARY KEY (name)) ENGINE=InnoDB;<br>Query OK, 0 rows affected (0.04 sec)<br><br>mysql&gt; BEGIN;<br>Query OK, 0 rows affected (0.00 sec)<br><br>mysql&gt; INSERT INTO test SELECT &#39;aaa&#39;;<br>Query OK, 1 row affected (0.00 sec)<br>Records: 1  Duplicates: 0  Warnings: 0<br><br>mysql&gt; COMMIT;<br>Query OK, 0 rows affected (0.02 sec)<br><br>mysql&gt; INSERT INTO test SELECT &#39;bbb&#39;;<br>Query OK, 1 row affected (0.00 sec)<br>Records: 1  Duplicates: 0  Warnings: 0<br><br>mysql&gt; INSERT INTO test SELECT &#39;bbb&#39;;<br>ERROR 1062 (23000): Duplicate entry &#39;bbb&#39; for key &#39;PRIMARY&#39;<br>mysql&gt; ROLLBACK;<br>Query OK, 0 rows affected (0.00 sec)<br><br>mysql&gt; SELECT * FROM test;<br>+------+<br>| name |<br>+------+<br>| aaa  |<br>+------+<br>1 row in set (0.00 sec)<br>","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458059,"discussion_content":"如果采用autocommit=1;的情况 应该就是aaa, bbb两条数据。如果是autocommit=0;的情况，应该就是你这个结果，也就是一条记录 aaa","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563070561,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1083653,"avatar":"https://static001.geekbang.org/account/avatar/00/10/89/05/02b2f22a.jpg","nickname":"SleepyKoala","note":"","ucode":"C9A5CAC53107CE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290299,"discussion_content":"试一下，先设置\nset completion_type = 0;\nset autocommit=1;\n然后再跑例子二，就能得到两条数据了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594398058,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1127175,"avatar":"https://static001.geekbang.org/account/avatar/00/11/33/07/8f351609.jpg","nickname":"JustDoDT","note":"","ucode":"6AF0B80F00EAEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1768,"discussion_content":"只在你当前查询是这样，你新建一个查询看看，会和老师讲的结果一样。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562900085,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1127175,"avatar":"https://static001.geekbang.org/account/avatar/00/11/33/07/8f351609.jpg","nickname":"JustDoDT","note":"","ucode":"6AF0B80F00EAEF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1767,"discussion_content":"要刷新，去表里看看，是结果是和老师文章里说的一样的。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562899997,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113111,"user_name":"cricket1981","can_delete":false,"product_type":"c1","uid":1001715,"ip_address":"","ucode":"758262F5958DA4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/48/f3/f1034ffd.jpg","comment_is_top":false,"comment_ctime":1562898150,"is_pvip":false,"replies":[{"id":"41357","content":"采用默认的情况，也就是autocommit=1;<br>代码中调整了下，也就是最后一个是ROLLBACK，下面是完整代码，你再试下：<br>DROP TABLE test;<br>CREATE TABLE test(name varchar(255), PRIMARY KEY (name)) ENGINE=InnoDB;<br>BEGIN;<br>INSERT INTO test SELECT &#39;aaa&#39;;<br>COMMIT;<br>BEGIN;<br>INSERT INTO test SELECT &#39;bbb&#39;;<br>INSERT INTO test SELECT &#39;bbb&#39;;<br>ROLLBACK;<br>SELECT * FROM test;<br>运行结果应该只有 aaa","user_name":"作者回复","user_name_real":"cy","uid":"1306094","ctime":1563070461,"ip_address":"","comment_id":113111,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1562898150","product_id":100029501,"comment_content":"为什么我试下来的结果跟老师说的不一样呢？<br><br>mysql&gt; set autocommit=0;<br>Query OK, 0 rows affected (0.00 sec)<br><br>mysql&gt; <br>mysql&gt; DROP TABLE test;<br>Query OK, 0 rows affected (0.02 sec)<br><br>mysql&gt; CREATE TABLE test(name varchar(255), PRIMARY KEY (name)) ENGINE=InnoDB;<br>Query OK, 0 rows affected (0.05 sec)<br><br>mysql&gt; BEGIN;<br>Query OK, 0 rows affected (0.00 sec)<br><br>mysql&gt; INSERT INTO test SELECT &#39;aaa&#39;;<br>Query OK, 1 row affected (0.00 sec)<br>Records: 1  Duplicates: 0  Warnings: 0<br><br>mysql&gt; COMMIT;<br>Query OK, 0 rows affected (0.02 sec)<br><br>mysql&gt; BEGIN;<br>Query OK, 0 rows affected (0.00 sec)<br><br>mysql&gt; INSERT INTO test SELECT &#39;bbb&#39;;<br>Query OK, 1 row affected (0.00 sec)<br>Records: 1  Duplicates: 0  Warnings: 0<br><br>mysql&gt; INSERT INTO test SELECT &#39;bbb&#39;;<br>ERROR 1062 (23000): Duplicate entry &#39;bbb&#39; for key &#39;PRIMARY&#39;<br>mysql&gt; COMMIT;<br>Query OK, 0 rows affected (0.01 sec)<br><br>mysql&gt; SELECT * FROM test;<br>+------+<br>| name |<br>+------+<br>| aaa  |<br>| bbb  |<br>+------+<br>2 rows in set (0.00 sec)","like_count":0,"discussions":[{"author":{"id":1306094,"avatar":"https://static001.geekbang.org/account/avatar/00/13/ed/ee/c4779b67.jpg","nickname":"cy","note":"","ucode":"50D653399A31F6","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":458058,"discussion_content":"采用默认的情况，也就是autocommit=1;\n代码中调整了下，也就是最后一个是ROLLBACK，下面是完整代码，你再试下：\nDROP TABLE test;\nCREATE TABLE test(name varchar(255), PRIMARY KEY (name)) ENGINE=InnoDB;\nBEGIN;\nINSERT INTO test SELECT &amp;#39;aaa&amp;#39;;\nCOMMIT;\nBEGIN;\nINSERT INTO test SELECT &amp;#39;bbb&amp;#39;;\nINSERT INTO test SELECT &amp;#39;bbb&amp;#39;;\nROLLBACK;\nSELECT * FROM test;\n运行结果应该只有 aaa","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563070461,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1008920,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJqWuvuicHD7RVlEDJamWNmwVdkjeH4pLxPXoicwqbnpOibI1MFFz9SIVJmQeKSZQRP9np1NUV3wpmnA/132","nickname":"朱成亮","note":"","ucode":"669B049357B3FA","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":66032,"discussion_content":"我的是 aaa,  bbb两条；查了autocommit是1","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1575037659,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1353712,"avatar":"https://static001.geekbang.org/account/avatar/00/14/a7/f0/e3212f18.jpg","nickname":"胡","note":"","ucode":"3917AFED7701CA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5455,"discussion_content":"我也不一样。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566283079,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":113097,"user_name":"江南皮革厂研发中心保安队长","can_delete":false,"product_type":"c1","uid":1099584,"ip_address":"","ucode":"231419643A5CC5","user_header":"https://static001.geekbang.org/account/avatar/00/10/c7/40/66a203cd.jpg","comment_is_top":false,"comment_ctime":1562896648,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562896648","product_id":100029501,"comment_content":"举手------- 老师，事务的例子里连续插入两个一样的字段，插入第二个不会报错吗？报错了之后再执行后面的sql还是插入了一条吧？？？","like_count":0},{"had_liked":false,"id":113087,"user_name":"KEEPUP","can_delete":false,"product_type":"c1","uid":1436576,"ip_address":"","ucode":"D0B31031E2923F","user_header":"https://static001.geekbang.org/account/avatar/00/15/eb/a0/9d294a9a.jpg","comment_is_top":false,"comment_ctime":1562895096,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562895096","product_id":100029501,"comment_content":"关闭自动提交，如果没有begin，那么提交的时候事务从什么位置开始呢？<br>开启自动提交，如果有begin，那么不会自动提交，只能手动commit 提交吗？","like_count":0},{"had_liked":false,"id":113061,"user_name":"听雨","can_delete":false,"product_type":"c1","uid":1254493,"ip_address":"","ucode":"252754F9FCFF0C","user_header":"https://static001.geekbang.org/account/avatar/00/13/24/5d/65e61dcb.jpg","comment_is_top":false,"comment_ctime":1562892647,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1562892647","product_id":100029501,"comment_content":"老师，关于一致性，我是否可以这样理解：体现在代码中就是，预先定义一组代码，如果程序顺利执行完，就说是符合一致性，如果中间某个环节出了问题，比如抛个异常，就不符合一致性了，需要回滚，这样理解可以吗？","like_count":0},{"had_liked":false,"id":113030,"user_name":"Cyber_Derek","can_delete":false,"product_type":"c1","uid":1239646,"ip_address":"","ucode":"D9B3596BDC35A4","user_header":"https://static001.geekbang.org/account/avatar/00/12/ea/5e/79dd13b5.jpg","comment_is_top":false,"comment_ctime":1562890135,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1562890135","product_id":100029501,"comment_content":"关于一致性那个链接我打开无法加载能不能贴一段出来？国内很多博客关于一致性的讲解真的是很坑","like_count":0,"discussions":[{"author":{"id":1144692,"avatar":"https://static001.geekbang.org/account/avatar/00/11/77/74/c1f0aa46.jpg","nickname":"习惯沉淀","note":"","ucode":"9C590226330AD3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1755,"discussion_content":"Consistency\nMain article: Consistency (database systems)\nConsistency ensures that a transaction can only bring the database from one valid state to another, maintaining database invariants: any data written to the database must be valid according to all defined rules, including constraints, cascades, triggers, and any combination thereof. This prevents database corruption by an illegal transaction, but does not guarantee that a transaction is correct. Referential integrity guarantees the primary key - foreign key relationship.","likes_number":6,"is_delete":false,"is_hidden":false,"ctime":1562894594,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1673679,"avatar":"https://static001.geekbang.org/account/avatar/00/19/89/cf/1c7703b1.jpg","nickname":"夏天呀","note":"","ucode":"1C5C060C05923B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1144692,"avatar":"https://static001.geekbang.org/account/avatar/00/11/77/74/c1f0aa46.jpg","nickname":"习惯沉淀","note":"","ucode":"9C590226330AD3","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":299711,"discussion_content":"感谢！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1597796154,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":1755,"ip_address":""},"score":299711,"extra":""}]}]}]}