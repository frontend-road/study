{"id":546501,"title":"05ï½œç§»åŠ¨å¹³å°çš„è§†é¢‘æ¸²æŸ“ï¼ˆäºŒï¼‰ï¼šOpenGL ESä¸Šä¸‹æ–‡ç¯å¢ƒæ­å»º","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å±•æ™“å‡¯ã€‚ä»Šå¤©æˆ‘ä»¬æ¥ç»§ç»­å­¦ä¹ ç§»åŠ¨å¹³å°çš„è§†é¢‘æ¸²æŸ“ã€‚</p><p><a href=\"https://time.geekbang.org/column/article/545953\">ä¸Šä¸€èŠ‚è¯¾</a>ï¼Œæˆ‘ä»¬ä½¿ç”¨OpenGL ESæä¾›ç»™å¼€å‘è€…çš„æ¥å£ï¼Œåˆ›å»ºå‡ºäº†ä¸€ä¸ªGLProgramï¼Œä½†æ˜¯å¦‚æœè®©è¿™ä¸ªGLProgramè¿è¡Œèµ·æ¥è¿˜éœ€è¦æœ‰ä¸€ä¸ªä¸Šä¸‹æ–‡ç¯å¢ƒæ¥æ”¯æ’‘ã€‚ç”±äºOpenGL ESä¸€å¼€å§‹å°±æ˜¯ä¸ºè·¨å¹³å°è®¾è®¡çš„ï¼Œæ‰€ä»¥å®ƒæœ¬èº«å¹¶ä¸æ‰¿æ‹…çª—å£ç®¡ç†ä»¥åŠä¸Šä¸‹æ–‡ç¯å¢ƒæ„å»ºçš„èŒè´£ï¼Œè¿™ä¸ªèŒè´£éœ€è¦ç”±å„è‡ªçš„å¹³å°æ¥æ‰¿æ‹…ã€‚</p><p>Androidå¹³å°ä½¿ç”¨çš„æ˜¯EGLï¼ŒEGLæ˜¯Khronosåˆ›å»ºçš„ä¸€ä¸ªæ¡†æ¶ï¼Œç”¨æ¥ç»™OpenGLçš„è¾“å‡ºä¸è®¾å¤‡çš„å±å¹•æ­å»ºèµ·ä¸€ä¸ªæ¡¥æ¢ã€‚EGLçš„å·¥ä½œæœºåˆ¶æ˜¯åŒç¼“å†²æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯æœ‰ä¸€ä¸ªBack Frame Bufferå’Œä¸€ä¸ªFront Frame Bufferï¼Œæ­£å¸¸ç»˜åˆ¶æ“ä½œçš„ç›®æ ‡éƒ½æ˜¯Back Frame Bufferï¼Œæ¸²æŸ“å®Œæ¯•ä¹‹åï¼Œè°ƒç”¨eglSwapBufferè¿™ä¸ªAPIï¼Œä¼šå°†ç»˜åˆ¶å®Œæ¯•çš„Back Frame Bufferä¸å½“å‰çš„Front Frame Bufferè¿›è¡Œäº¤æ¢ï¼Œç„¶åæ˜¾ç¤ºå‡ºæ¥ã€‚EGLæ‰¿æ‹…äº†ä¸ºOpenGLæä¾›ä¸Šä¸‹æ–‡ç¯å¢ƒä»¥åŠçª—å£ç®¡ç†çš„èŒè´£ã€‚</p><p>iOSå¹³å°ä½¿ç”¨çš„æ˜¯EAGLï¼Œä¸EGLçš„åŒç¼“å†²æœºåˆ¶æ¯”è¾ƒç±»ä¼¼ï¼ŒiOSå¹³å°ä¹Ÿä¸å…è®¸æˆ‘ä»¬ç›´æ¥æ¸²æŸ“åˆ°å±å¹•ä¸Šï¼Œè€Œæ˜¯æ¸²æŸ“åˆ°ä¸€ä¸ªå«renderBufferçš„å¯¹è±¡ä¸Šã€‚è¿™ä¸ªå¯¹è±¡ä½ å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªç‰¹æ®Šçš„FrameBufferï¼Œæœ€ç»ˆå†è°ƒç”¨EAGLContextçš„presentRenderBufferæ–¹æ³•ï¼Œå°±å¯ä»¥å°†æ¸²æŸ“ç»“æœè¾“å‡ºåˆ°å±å¹•ä¸Šå»äº†ã€‚</p><!-- [[[read_end]]] --><p>ä¸‹é¢æˆ‘ä¼šåˆ†åˆ«å¯¹è¿™ä¸¤ä¸ªå¹³å°çš„ç¯å¢ƒæ­å»ºè¿›è¡Œè¯¦ç»†åœ°ä»‹ç»ã€‚</p><h2>Androidå¹³å°çš„ç¯å¢ƒæ­å»º</h2><p>è¦åœ¨Androidå¹³å°ä¸Šä½¿ç”¨OpenGL ESï¼Œæœ€ç®€å•çš„æ–¹å¼æ˜¯ä½¿ç”¨GLSurfaceViewï¼Œå› ä¸ºä¸éœ€è¦å¼€å‘è€…æ­å»ºOpenGL ESçš„ä¸Šä¸‹æ–‡ç¯å¢ƒä»¥åŠåˆ›å»ºOpenGL ESçš„æ˜¾ç¤ºè®¾å¤‡ï¼Œåªéœ€è¦éµå¾ªGLSurfaceViewå®šä¹‰çš„æ¥å£ï¼Œå®ç°å¯¹åº”çš„é€»è¾‘å³å¯ã€‚å°±åƒç¡¬å¸æœ‰æ­£åé¢ä¸€æ ·ï¼Œä½¿ç”¨GLSurfaceViewçš„ç¼ºç‚¹ä¹Ÿæ¯”è¾ƒæ˜æ˜¾ï¼Œå°±æ˜¯ä¸å¤Ÿçµæ´»ï¼ŒOpenGL ESå¾ˆå¤šæ ¸å¿ƒç”¨æ³•ï¼Œæ¯”å¦‚å…±äº«ä¸Šä¸‹æ–‡ï¼Œä½¿ç”¨èµ·æ¥å°±ä¼šæ¯”è¾ƒéº»çƒ¦ã€‚</p><p>æˆ‘ä»¬è¿™ä¸ªä¸“æ çš„OpenGL ESä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œä¼šç›´æ¥ä½¿ç”¨EGLæä¾›çš„APIï¼Œåœ¨Nativeå±‚åŸºäºC++ç¯å¢ƒè¿›è¡Œæ­å»ºã€‚åŸå› æ˜¯åœ¨Javaå±‚è¿›è¡Œæ­å»ºçš„è¯ï¼Œå¯¹äºæ™®é€šçš„åº”ç”¨ä¹Ÿè®¸å¯ä»¥ï¼Œä½†æ˜¯å¯¹äºè¦è¿›è¡Œè§£ç æˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“çš„åœºæ™¯ï¼Œæ¯”å¦‚äººè„¸è¯†åˆ«ï¼Œåˆéœ€è¦åˆ°Nativeå±‚æ¥å®æ–½ã€‚è€ƒè™‘åˆ°æ•ˆç‡å’Œæ€§èƒ½ï¼Œæˆ‘ä»¬è¿™é‡Œå°±ç›´æ¥ä½¿ç”¨Nativeå±‚çš„EGLæ¥æ­å»ºä¸€ä¸ªOpenGL ESçš„å¼€å‘ç¯å¢ƒã€‚</p><h3>å¼•å…¥å¤´æ–‡ä»¶ä¸soåº“</h3><p>é‚£ä¹ˆå¦‚ä½•åœ¨Nativeå±‚ä½¿ç”¨EGLå‘¢ï¼Ÿæˆ‘ä»¬å¿…é¡»è¦åœ¨CMakeæ„å»ºè„šæœ¬ï¼ˆCMakeLists.txtï¼‰ä¸­åŠ å…¥EGLè¿™ä¸ªåº“ï¼Œå¹¶åœ¨ä½¿ç”¨è¿™ä¸ªåº“çš„C++æ–‡ä»¶ä¸­å¼•å…¥EGLå¯¹åº”çš„å¤´æ–‡ä»¶ã€‚</p><p>éœ€è¦å¼•ç”¨çš„å¤´æ–‡ä»¶å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">#include &lt;EGL/egl.h&gt;\n#include &lt;EGL/eglext.h&gt;\n</code></pre><p>éœ€è¦å¼•å…¥çš„soåº“ï¼š</p><pre><code class=\"language-plain\">target_link_libraries(videoengine\n        # å¼•å…¥ç³»ç»Ÿçš„åŠ¨æ€åº“\n        EGL\n        )\n</code></pre><p>è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åœ¨Androidçš„Nativeå±‚ä¸­ä½¿ç”¨EGLäº†ï¼Œä¸è¿‡è¦ä½¿ç”¨OpenGL ESç»™å¼€å‘è€…æä¾›çš„æ¥å£ï¼Œè¿˜éœ€è¦å¼•å…¥OpenGL ESå¯¹åº”çš„å¤´æ–‡ä»¶ä¸åº“ã€‚</p><p>éœ€è¦åŒ…å«çš„å¤´æ–‡ä»¶ï¼š</p><pre><code class=\"language-plain\">#include &lt;GLES2/gl2.h&gt;\n#include &lt;GLES2/gl2ext.h&gt;\n</code></pre><p>éœ€è¦å¼•å…¥çš„soåº“ï¼Œæ³¨æ„è¿™é‡Œä½¿ç”¨çš„æ˜¯OpenGL ES 2.0ç‰ˆæœ¬ã€‚</p><pre><code class=\"language-plain\">target_link_libraries(videoengine\n        # å¼•å…¥ç³»ç»Ÿçš„åŠ¨æ€åº“\n        GLESv2\n        )\n</code></pre><p>è‡³æ­¤ï¼ŒOpenGL ESçš„å¼€å‘éœ€è¦ç”¨åˆ°çš„å¤´æ–‡ä»¶ä»¥åŠåº“æ–‡ä»¶å°±å¼•å…¥å®Œæ¯•äº†ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨EGLæ­å»ºå‡ºOpenGLçš„ä¸Šä¸‹æ–‡ç¯å¢ƒä»¥åŠå®ç°çª—å£çš„ç®¡ç†ã€‚</p><h3>EGLDisplayä½œä¸ºç»˜åˆ¶çš„ç›®æ ‡</h3><p>EGLé¦–å…ˆè¦è§£å†³çš„é—®é¢˜æ˜¯ï¼Œè¦å‘Šè¯‰OpenGL ESç»˜åˆ¶çš„ç›®æ ‡åœ¨å“ªé‡Œï¼Œè€ŒEGLDisplayå°±æ˜¯ä¸€ä¸ªå°è£…ç³»ç»Ÿç‰©ç†å±å¹•çš„æ•°æ®ç±»å‹ï¼Œä¹Ÿå°±æ˜¯ç»˜åˆ¶ç›®æ ‡çš„ä¸€ä¸ªæŠ½è±¡ã€‚å¼€å‘è€…è¦è°ƒç”¨eglGetDisplayè¿™ä¸ªæ–¹æ³•æ¥åˆ›å»ºå‡ºEGLDisplayçš„å¯¹è±¡ï¼Œåœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„ä¼ å‚ä¸­ï¼Œå¸¸é‡EGL_DEFAULT_DISPLAYä¼šè¢«ä¼ è¿›è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæ¯ä¸ªå‚å•†åœ¨è‡ªå·±çš„å®ç°ä¸­éƒ½ä¼šè¿”å›é»˜è®¤çš„æ˜¾ç¤ºè®¾å¤‡ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">EGLDisplay display;\nif ((display = eglGetDisplay(EGL_DEFAULT_DISPLAY)) == EGL_NO_DISPLAY) {\n&nbsp;&nbsp;&nbsp; LOGE(\"eglGetDisplay() returned error %d\", eglGetError());\n&nbsp;&nbsp;&nbsp; return false;\n}\n</code></pre><p>åœ¨è·å¾—äº†EGLDisplayçš„å¯¹è±¡ä¹‹åï¼Œå°±éœ€è¦å¯¹è¿™ä¸ªå¯¹è±¡åšåˆå§‹åŒ–å·¥ä½œï¼Œå¼€å‘è€…éœ€è¦è°ƒç”¨EGLæä¾›çš„eglInitializeæ–¹æ³•æ¥åˆå§‹åŒ–è¿™ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªboolå€¼æ¥ä»£è¡¨å‡½æ•°è¿è¡Œç»“æœã€‚å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯EGLDisplayå¯¹è±¡ï¼Œåé¢ä¸¤ä¸ªå‚æ•°æ˜¯è¿™ä¸ªå‡½æ•°ä¸ºäº†è¿”å›EGLç‰ˆæœ¬å·è€Œè®¾è®¡çš„ï¼Œä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯Majorå’ŒMinorçš„Versionï¼Œæ¯”å¦‚EGLçš„ç‰ˆæœ¬å·æ˜¯1.0ï¼Œé‚£ä¹ˆMajorè¿”å›1ï¼ŒMinoråˆ™è¿”å›0ï¼Œå¦‚æœæˆ‘ä»¬ä¸å…³å¿ƒç‰ˆæœ¬å·ï¼Œå¯ä»¥éƒ½ä¼ å…¥0æˆ–è€…NULLï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">if (!eglInitialize(display, 0, 0)) {\n&nbsp;&nbsp;&nbsp; LOGE(\"eglInitialize() returned error %d\", eglGetError());\n&nbsp;&nbsp;&nbsp; return false;\n}\n</code></pre><p>ä¸€æ—¦EGLDisplayåˆå§‹åŒ–æˆåŠŸä¹‹åï¼Œå®ƒå°±å¯ä»¥å°†OpenGL ESçš„è¾“å‡ºå’Œè®¾å¤‡çš„å±å¹•æ¡¥æ¥èµ·æ¥ï¼Œä½†æ˜¯éœ€è¦æˆ‘ä»¬æŒ‡å®šä¸€äº›é…ç½®é¡¹ï¼Œæ¯”å¦‚è‰²å½©æ ¼å¼ã€åƒç´ æ ¼å¼ã€OpenGLç‰ˆæœ¬ä»¥åŠSurfaceTypeç­‰ï¼Œä¸åŒçš„ç³»ç»Ÿä»¥åŠå¹³å°ä½¿ç”¨çš„EGLæ ‡å‡†æ˜¯ä¸åŒçš„ï¼Œåœ¨Androidå¹³å°ä¸‹ä¸€èˆ¬é…ç½®çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-plain\">EGLConfig config;\nconst EGLint attribs[] = {EGL_BUFFER_SIZE, 32,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EGL_ALPHA_SIZE, 8,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EGL_BLUE_SIZE, 8,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EGL_GREEN_SIZE, 8,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EGL_RED_SIZE, 8,&nbsp;&nbsp;&nbsp;&nbsp;\n&nbsp;&nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EGL_RENDERABLE_TYPE, EGL_OPENGL_ES2_BIT,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EGL_SURFACE_TYPE, EGL_WINDOW_BIT,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EGL_NONE };\nif (!eglChooseConfig(display, attribs, &amp;config, 1, &amp;numConfigs)) {\n&nbsp;&nbsp;&nbsp; LOGE(\"eglChooseConfig() returned error %d\", eglGetError());\n&nbsp;&nbsp;&nbsp;&nbsp;return false;\n}\n</code></pre><p>é…ç½®é€‰é¡¹è¿™ä¸ªå‡½æ•°ä¹Ÿæ˜¯è¿”å›ä¸€ä¸ªboolå€¼æ¥ä»£è¡¨é…ç½®çŠ¶æ€ï¼Œå¦‚æœé…ç½®æˆåŠŸï¼Œåˆ™ä»£è¡¨configä¼šè¢«æ­£ç¡®åˆå§‹åŒ–ã€‚</p><p><strong>EGLDisplayè¿™ä¸ªå¯¹è±¡æ˜¯EGLç»™å¼€å‘è€…æä¾›çš„æœ€é‡è¦çš„å…¥å£</strong>ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬è¦åŸºäºè¿™ä¸ªEGLDisplayå¯¹è±¡è¿˜æœ‰EGLConfigé…ç½®æ¥åˆ›å»ºä¸Šä¸‹æ–‡äº†ã€‚</p><h3>EGLContextæä¾›çº¿ç¨‹çš„ä¸Šä¸‹æ–‡</h3><p>ç”±äºä»»ä½•ä¸€æ¡OpenGL ESæŒ‡ä»¤ï¼ˆOpenGL ESæä¾›ç»™å¼€å‘è€…çš„æ¥å£ï¼‰éƒ½å¿…é¡»è¿è¡Œåœ¨è‡ªå·±çš„OpenGLä¸Šä¸‹æ–‡ç¯å¢ƒä¸­ï¼ŒEGLæä¾›EGLContextæ¥å°è£…ä¸Šä¸‹æ–‡ï¼Œå¯ä»¥æŒ‰ç…§å¦‚ä¸‹ä»£ç æ„å»ºå‡ºOpenGL ESçš„ä¸Šä¸‹æ–‡ç¯å¢ƒã€‚</p><pre><code class=\"language-plain\">EGLContext context;\nEGLint attributes[] = { EGL_CONTEXT_CLIENT_VERSION, 2, EGL_NONE };\nif (!(context = eglCreateContext(display, config, NULL,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; eglContextAttributes))) {\n&nbsp;&nbsp;&nbsp; LOGE(\"eglCreateContext() returned error %d\", eglGetError());\n&nbsp;&nbsp;&nbsp; return false;\n}\n</code></pre><p>å‡½æ•°eglCreateContextçš„å‰ä¸¤ä¸ªå‚æ•°å°±æ˜¯æˆ‘ä»¬åˆšåˆšåˆ›å»ºçš„ä¸¤ä¸ªå¯¹è±¡ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ç±»å‹ä¹Ÿæ˜¯EGLContextç±»å‹çš„ï¼Œä¸€èˆ¬ä¼šæœ‰ä¸¤ç§ç”¨æ³•ã€‚</p><ul>\n<li>å¦‚æœæƒ³å’Œå·²ç»å­˜åœ¨çš„æŸä¸ªä¸Šä¸‹æ–‡å…±äº«OpenGLèµ„æºï¼ˆåŒ…æ‹¬çº¹ç†IDã€frameBufferä»¥åŠå…¶ä»–çš„Bufferï¼‰ï¼Œåˆ™ä¼ å…¥å¯¹åº”çš„é‚£ä¸ªä¸Šä¸‹æ–‡å˜é‡ã€‚</li>\n<li>å¦‚æœç›®æ ‡ä»…ä»…æ˜¯åˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„ä¸Šä¸‹æ–‡ï¼Œä¸éœ€è¦å’Œå…¶ä»–OpenGL ESçš„ä¸Šä¸‹æ–‡å…±äº«ä»»ä½•èµ„æºï¼Œåˆ™è®¾ç½®ä¸ºNULLã€‚</li>\n</ul><p>åœ¨ä¸€äº›åœºæ™¯ä¸‹å…¶å®éœ€è¦å¤šä¸ªçº¿ç¨‹å…±åŒæ‰§è¡ŒOpenGL ESçš„æ¸²æŸ“æ“ä½œï¼Œè¿™ç§æƒ…å†µä¸‹å°±éœ€è¦ç”¨åˆ°å…±äº«ä¸Šä¸‹æ–‡ï¼Œå…±äº«ä¸Šä¸‹æ–‡çš„å…³é”®ç‚¹å°±åœ¨è¿™é‡Œï¼Œä¸€å®šè¦è®°ä½ã€‚</p><p>æˆåŠŸåˆ›å»ºå‡ºOpenGL ESçš„ä¸Šä¸‹æ–‡ï¼Œè¯´æ˜æˆ‘ä»¬å·²ç»æŠŠOpenGL ESçš„ç»˜åˆ¶ç›®æ ‡æå®šäº†ï¼Œä½†æ˜¯è¿™ä¸ªç»˜åˆ¶ç›®æ ‡å¹¶æ²¡æœ‰æ¸²æŸ“åˆ°æˆ‘ä»¬æŸä¸ªViewä¸Šï¼Œé‚£å¦‚ä½•å°†è¿™ä¸ªè¾“å‡ºæ¸²æŸ“åˆ°ä¸šåŠ¡æŒ‡å®šçš„Viewä¸Šå‘¢ï¼Ÿç­”æ¡ˆå°±åœ¨EGLSurfaceã€‚</p><h3>EGLSurfaceå°†EGLDisplayä¸ç³»ç»Ÿå±å¹•æ¡¥æ¥èµ·æ¥</h3><p>EGLSurfaceå®é™…ä¸Šæ˜¯ä¸€ä¸ªFrameBufferï¼Œå¼€å‘è€…å¯ä»¥è°ƒç”¨EGLæä¾›çš„eglCreateWindowSurfaceåˆ›å»ºä¸€ä¸ªå¯å®é™…æ˜¾ç¤ºçš„Surfaceï¼Œè°ƒç”¨eglCreatePbufferSufaceå¯ä»¥åˆ›å»ºä¸€ä¸ªOffScreenï¼ˆç¦»å±æ¸²æŸ“ï¼Œä¸€èˆ¬ç”¨æˆ·åå°ä¿å­˜åœºæ™¯ï¼‰çš„Surfaceï¼Œåˆ›å»ºå¯å®é™…æ˜¾ç¤ºçš„Surfaceä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">EGLSurface surface = NULL;\nEGLint format;\nif (!eglGetConfigAttrib(display, config, EGL_NATIVE_VISUAL_ID,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;format)) {\n&nbsp;&nbsp;&nbsp; LOGE(\"eglGetConfigAttrib() returned error %d\", eglGetError());\n&nbsp;&nbsp;&nbsp; return surface;\n}\nANativeWindow_setBuffersGeometry(_window, 0, 0, format);\nif (!(surface = eglCreateWindowSurface(display, config, _window, 0))) {\n&nbsp;&nbsp;&nbsp; LOGE(\"eglCreateWindowSurface() returned error %d\", eglGetError());\n}\n</code></pre><p>ä¸Šè¿°ä»£ç ä¸­ä¸å¾—ä¸æçš„å°±æ˜¯_windowè¿™ä¸ªå‚æ•°ï¼Œè¿™é‡Œæˆ‘éœ€è¦é‡ç‚¹å‘ä½ è§£é‡Šä¸€ä¸‹ï¼Œè¿™ä¸ª_windowæ˜¯ANativeWindowç±»å‹çš„å¯¹è±¡ï¼Œä»£è¡¨äº†æœ¬åœ°ä¸šåŠ¡å±‚æƒ³è¦ç»˜åˆ¶åˆ°çš„ç›®æ ‡Viewã€‚åœ¨Androidé‡Œé¢å¯ä»¥é€šè¿‡Surfaceï¼ˆé€šè¿‡SurfaceViewæˆ–TextureViewæ¥å¾—åˆ°æˆ–è€…æ„å»ºå‡ºSurfaceå¯¹è±¡ï¼‰å»æ„å»ºå‡ºANativeWindowã€‚ä½†æ„å»ºä¹‹å‰éœ€è¦æˆ‘ä»¬åœ¨ä½¿ç”¨çš„æ—¶å€™å¼•ç”¨å¤´æ–‡ä»¶ã€‚</p><pre><code class=\"language-plain\">#include &lt;android/native_window.h&gt;\n#include &lt;android/native_window_jni.h&gt;\n</code></pre><p>è°ƒç”¨ANAtiveWindowçš„APIæ¥å£å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">ANativeWindow* window = ANativeWindow_fromSurface(env, surface);\n</code></pre><p>é‡Œé¢çš„envæ˜¯JNIå±‚çš„JNIEnvæŒ‡é’ˆç±»å‹çš„å˜é‡ï¼Œsurfaceå°±æ˜¯jobjectç±»å‹çš„å˜é‡ï¼Œæ˜¯ç”±Javaå±‚çš„Surfaceç±»å‹å¯¹è±¡ä¼ é€’è€Œæ¥çš„ã€‚åˆ°è¿™é‡Œæˆ‘ä»¬å°±æŠŠEGLSurfaceå’ŒJavaå±‚çš„Viewï¼ˆå³è®¾å¤‡çš„å±å¹•ï¼‰è¿æ¥èµ·æ¥äº†ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å†è¡¥å……ä¸€ç‚¹ï¼Œå¦‚æœæƒ³åšç¦»å±æ¸²æŸ“ï¼Œä¹Ÿå°±æ˜¯åœ¨åå°ä½¿ç”¨OpenGLå¤„ç†ä¸€äº›å›¾åƒï¼Œå°±éœ€è¦ç”¨åˆ°å¤„ç†å›¾åƒçš„Surfaceäº†ï¼Œåˆ›å»ºç¦»å±Surfaceå¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">EGLSurface surface;\nEGLint PbufferAttributes[] = { EGL_WIDTH, width, EGL_HEIGHT, height, EGL_NONE,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; EGL_NONE };\nif (!(surface = eglCreatePbufferSurface(display, config, PbufferAttributes))) {\n&nbsp;&nbsp;&nbsp; LOGE(\"eglCreatePbufferSurface() returned error %d\", eglGetError());\n}\n</code></pre><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªSurfaceå¹¶ä¸ä¼šå’Œä»»ä½•ä¸€ä¸ªä¸šåŠ¡Viewè¿›è¡Œå…³è”ï¼Œè¿›è¡Œç¦»å±æ¸²æŸ“çš„æ—¶å€™ï¼Œå°±å¯ä»¥æŠŠè¿™ä¸ªSurfaceå½“ä½œç›®æ ‡è¿›è¡Œç»˜åˆ¶ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/7b/f3/7bbf36207fbb200f7de3636f88ea1bf3.png?wh=1920x860\" alt=\"å›¾ç‰‡\"></p><p>ç°åœ¨æˆ‘ä»¬å·²ç»ç”¨EGLå‡†å¤‡å¥½äº†ä¸Šä¸‹æ–‡ç¯å¢ƒä¸çª—å£ç®¡ç†ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå·¦ä¾§æˆ‘ä»¬ä¸ºOpenGL ESå‡†å¤‡å¥½ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå¹¶ä¸”ç”¨EGLDisplayç”¨æ¥æ¥æ”¶ç»˜åˆ¶çš„å†…å®¹ï¼Œå³è¾¹é€šè¿‡EGLSurfaceè¿æ¥å¥½äº†è®¾å¤‡çš„å±å¹•ï¼ˆJavaå±‚æä¾›çš„SurfaceViewæˆ–è€…TextureViewï¼‰ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å°±å…·ä½“çœ‹ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨åˆ›å»ºå¥½çš„EGLç¯å¢ƒè¿›è¡Œå·¥ä½œã€‚</p><h3>ä¸ºç»˜åˆ¶çº¿ç¨‹ç»‘å®šä¸Šä¸‹æ–‡</h3><p>OpenGL ESéœ€è¦å¼€å‘è€…è‡ªå·±å¼€è¾Ÿä¸€ä¸ªæ–°çš„çº¿ç¨‹ï¼Œæ¥æ‰§è¡ŒOpenGL ESçš„æ¸²æŸ“æ“ä½œï¼Œè¿˜è¦æ±‚å¼€å‘è€…åœ¨æ‰§è¡Œæ¸²æŸ“æ“ä½œå‰è¦ä¸ºè¿™ä¸ªçº¿ç¨‹ç»‘å®šä¸Šä¸‹æ–‡ç¯å¢ƒã€‚EGLä¸ºç»‘å®šä¸Šä¸‹æ–‡ç¯å¢ƒæä¾›äº†eglMakeCurrentè¿™ä¸ªæ¥å£ã€‚</p><pre><code class=\"language-plain\">eglMakeCurrent(display, eglSurface, eglSurface, context);\n</code></pre><p>åœ¨ç»‘å®šäº†ä¸Šä¸‹æ–‡ç¯å¢ƒä»¥åŠçª—å£ä¹‹åå°±å¯ä»¥æ‰§è¡ŒRenderLoopå¾ªç¯äº†ï¼Œæ¯ä¸€æ¬¡å¾ªç¯éƒ½æ˜¯å»è°ƒç”¨OpenGL ESæŒ‡ä»¤ç»˜åˆ¶å›¾åƒã€‚</p><p>è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰æåˆ°çš„EGLçš„åŒç¼“å†²æ¨¡å¼å—ï¼ŸEGLå†…éƒ¨æœ‰ä¸¤ä¸ªå¸§ç¼“å†²åŒºï¼ˆframeBufferï¼‰ï¼Œæˆ‘ä»¬æ‰§è¡Œçš„æ¸²æŸ“ç›®æ ‡éƒ½æ˜¯åå°çš„frameBufferã€‚å½“æ¸²æŸ“æ“ä½œå®Œæˆä¹‹åï¼Œè¦è°ƒç”¨å‡½æ•°eglSwapBuffersè¿›è¡Œå‰å°frameBufferå’Œåå°frameBufferçš„äº¤æ¢ã€‚</p><pre><code class=\"language-plain\">eglSwapBuffers(display, eglSurface)\n</code></pre><p>æ‰§è¡Œä¸Šè¿°å‡½æ•°ä¹‹åï¼Œç”¨æˆ·å°±å¯ä»¥åœ¨å±å¹•ä¸Šçœ‹åˆ°åˆšåˆšæ¸²æŸ“çš„å›¾åƒäº†ã€‚</p><h3>é”€æ¯èµ„æº</h3><p>æœ€åæ‰§è¡Œå®Œæ‰€æœ‰çš„ç»˜åˆ¶æ“ä½œä¹‹åï¼Œéœ€è¦é”€æ¯èµ„æºã€‚æ³¨æ„é”€æ¯èµ„æºä¹Ÿå¿…é¡»åœ¨è¿™ä¸ªç‹¬ç«‹çš„çº¿ç¨‹ä¸­ï¼Œé”€æ¯æ˜¾ç¤ºè®¾å¤‡ï¼ˆEGLSurfaceï¼‰çš„ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">eglDestroySurface(display, eglSurface);\n</code></pre><p>é”€æ¯ä¸Šä¸‹æ–‡ï¼ˆContextï¼‰ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">eglDestroyContext(display, context);\n</code></pre><p>åˆ°è¿™å„¿ï¼Œåœ¨Androidå¹³å°çš„Nativeå±‚ä¸­ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨EGLæˆåŠŸåœ°æŠŠOpenGL ESçš„ä¸Šä¸‹æ–‡ç¯å¢ƒæ­å»ºå‡ºæ¥äº†ï¼Œåé¢æˆ‘ä»¬ä¼šç”¨åˆ°è¿™äº›çŸ¥è¯†ã€‚</p><h2>iOSå¹³å°çš„ç¯å¢ƒæ­å»º</h2><p>iOSå¹³å°ä¸å…è®¸å¼€å‘è€…ä½¿ç”¨OpenGL ESç›´æ¥æ¸²æŸ“è¾“å‡ºåˆ°å±å¹•ä¸Šï¼Œè€Œæ˜¯ä½¿ç”¨Frame Bufferä¸Render Bufferç›¸ç»“åˆçš„æ–¹å¼æ¥è¿›è¡Œæ¸²æŸ“ã€‚EAGLæä¾›çš„æ–¹å¼æ˜¯å¿…é¡»åˆ›å»ºä¸€ä¸ªrender Bufferï¼Œç„¶åè®©OpenGL ESæ¸²æŸ“åˆ°è¿™ä¸ªRender Bufferä¸Šé¢å»ã€‚é‚£è¿™ä¸ªRenderbufferåˆæ˜¯å¦‚ä½•å…³è”åˆ°ä¸šåŠ¡å±‚Viewä¸Šå»çš„å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯RenderBufferéœ€è¦ç»‘å®šä¸€ä¸ªCAEAGLLayerï¼Œè€Œè¿™ä¸ªLayerå®é™…ä¸Šå°±å¯ä»¥ä¸€å¯¹ä¸€åœ°å…³è”åˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„ä¸€ä¸ªUIViewã€‚ä¹Ÿå°±æ˜¯å¼€å‘è€…æœ€åè°ƒç”¨EAGLContextçš„presentRenderBufferæ–¹æ³•ï¼Œè¿™æ ·å°±å¯ä»¥å°†æ¸²æŸ“ç»“æœè¾“å‡ºåˆ°å±å¹•ä¸Šå»äº†ã€‚å®é™…ä¸Šï¼Œåœ¨è¿™ä¸ªæ–¹æ³•çš„å†…éƒ¨å®ç°ä¸­ï¼ŒEAGLä¹Ÿä¼šæ‰§è¡Œç±»ä¼¼äºå‰é¢EGLä¸­çš„swapBufferçš„è¿‡ç¨‹ã€‚å…·ä½“ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š</p><h3>è‡ªå®šä¹‰ä¸€ä¸ªEAGLView</h3><p>æˆ‘ä»¬å…ˆè‡ªå®šä¹‰ä¸€ä¸ªç»§æ‰¿è‡ªUIViewçš„Viewï¼Œç„¶åé‡å†™çˆ¶ç±»UIViewçš„layerClassæ–¹æ³•ï¼Œå¹¶ä¸”ä¸€å®šè¦è¿”å›CAEAGLLayer è¿™ä¸ªç±»å‹ã€‚</p><pre><code class=\"language-plain\">+ (Class) layerClass\n{\n&nbsp;&nbsp;&nbsp; return [CAEAGLLayer class];\n}\n</code></pre><p>æ¥ä¸‹æ¥åœ¨è¿™ä¸ªViewçš„åˆå§‹åŒ–æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ‹¿åˆ°layerå¹¶å¼ºåˆ¶æŠŠç±»å‹è½¬æ¢ä¸ºCAEAGLLayerç±»å‹çš„å˜é‡ï¼Œç„¶åç»™è¿™ä¸ªlayerè®¾ç½®å¯¹åº”çš„å‚æ•°ã€‚</p><pre><code class=\"language-plain\">- (id) initWithFrame:(CGRect)frame{\n&nbsp;&nbsp;&nbsp; if ((self = [super initWithFrame:frame])){\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CAEAGLLayer *eaglLayer = (CAEAGLLayer *)[self layer];\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; NSDictionary *dict = [NSDictionary dictionaryWithObjectsAndKeys:\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [NSNumber numberWithBool:NO],\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; kEAGLDrawablePropertyRetainedBacking,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; kEAGLColorFormatRGB565,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; kEAGLDrawablePropertyColorFormat,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; nil];\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [eaglLayer setOpaque:YES];\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; [eaglLayer setDrawableProperties:dict];\n&nbsp;&nbsp;&nbsp; }\n&nbsp;&nbsp;&nbsp; return self;\n}\n</code></pre><h3>æ„å»ºEAGLContext</h3><p>åƒä¹‹å‰æåˆ°çš„ï¼Œæˆ‘ä»¬å¿…é¡»ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹ç»‘å®šOpenGL ESä¸Šä¸‹æ–‡ï¼Œæ‰€ä»¥è¦å¼€è¾Ÿä¸€ä¸ªçº¿ç¨‹ï¼Œå¼€å‘è€…åœ¨iOSä¸­å¼€è¾Ÿä¸€ä¸ªæ–°çº¿ç¨‹çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œå¯ä»¥ä½¿ç”¨GCDï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨NSOperationQueueï¼Œç”šè‡³è£¸ç”¨pthreadä¹Ÿå¯ä»¥ï¼Œåæ­£å¿…é¡»åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œåˆ›å»ºä¸Šä¸‹æ–‡çš„æ“ä½œã€‚åˆ›å»ºOpenGL ESçš„ä¸Šä¸‹æ–‡ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">EAGLContext* _context;\n_context = [[EAGLContext alloc]initWithAPI:kEAGLRenderingAPIOpenGLES2];\n</code></pre><p>åˆ›å»ºæˆåŠŸä»¥åå°±æ¥ç»‘å®šä¸Šä¸‹æ–‡ã€‚</p><pre><code class=\"language-plain\">[EAGLContext setCurrentContext:_context];\n</code></pre><p>æ‰§è¡ŒæˆåŠŸä¹‹åå°±ä»£è¡¨æˆ‘ä»¬ä¸ºè¿™ä¸ªçº¿ç¨‹ç»‘å®šäº†åˆšåˆšåˆ›å»ºå¥½çš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å·²ç»å»ºç«‹å¥½äº†EAGLä¸OpenGL ESçš„è¿æ¥ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥å»ºç«‹å¦ä¸€ç«¯çš„è¿æ¥ã€‚</p><h3>çª—å£ç®¡ç†</h3><p>è¿™æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºRenderBufferå¹¶ä¸”æŠŠå®ƒç»‘å®šåˆ°å‰é¢è‡ªå®šä¹‰EAGLViewçš„Layerä¸Šã€‚é¦–å…ˆæ˜¯åˆ›å»ºå¸§ç¼“å†²åŒºã€‚</p><pre><code class=\"language-plain\">glGenFramebuffers(1, &amp;_framebuffer);\n</code></pre><p>ç„¶ååˆ›å»ºç»˜åˆ¶ç¼“å†²åŒºã€‚</p><pre><code class=\"language-plain\">glGenRenderbuffers(1, &amp;renderbuffer);\n</code></pre><p>ç»‘å®šå¸§ç¼“å†²åŒºåˆ°æ¸²æŸ“ç®¡çº¿ã€‚</p><pre><code class=\"language-plain\">glBindFramebuffer(GL_FRAMEBUFFER, _framebuffer);\n</code></pre><p>ç»‘å®šç»˜åˆ¶ç¼“å­˜åŒºåˆ°æ¸²æŸ“ç®¡çº¿ã€‚</p><pre><code class=\"language-plain\">glBindRenderbuffer(GL_RENDERBUFFER, _renderbuffer);\n</code></pre><p>ä¸ºç»˜åˆ¶ç¼“å†²åŒºåˆ†é…å­˜å‚¨åŒºï¼Œè¿™é‡Œæˆ‘ä»¬æŠŠCAEAGLLayerçš„ç»˜åˆ¶å­˜å‚¨åŒºä½œä¸ºç»˜åˆ¶ç¼“å†²åŒºçš„å­˜å‚¨åŒºã€‚</p><pre><code class=\"language-plain\">[_context renderbufferStorage:GL_RENDERBUFFER fromDrawable:(CAEAGLLayer*)\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; self.layer]\n</code></pre><p>è·å–ç»˜åˆ¶ç¼“å†²åŒºçš„åƒç´ å®½åº¦ã€‚</p><pre><code class=\"language-plain\">glGetRenderBufferParameteriv(GL_RENDER_BUFFER, GL_RENDER_BUFFER_WIDTH,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;_backingWidth);\n</code></pre><p>è·å–ç»˜åˆ¶ç¼“å†²åŒºçš„åƒç´ é«˜åº¦ã€‚</p><pre><code class=\"language-plain\">glGetRenderBufferParameteriv(GL_RENDER_BUFFER, GL_RENDER_BUFFER_HEIGHT,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &amp;_backingHeight);\n</code></pre><p>ç»‘å®šç»˜åˆ¶ç¼“å†²åŒºåˆ°å¸§ç¼“å†²åŒºã€‚</p><pre><code class=\"language-plain\">glFramebufferRenderbuffer(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0, GL_RENDERBUFFER,\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; _renderbuffer);\n</code></pre><p>æ£€æŸ¥Framebufferçš„statusã€‚</p><pre><code class=\"language-plain\">GLenum status = glCheckFramebufferStatus(GL_FRAMEBUFFER);\nif(status != GL_FRAMEBUFFER_COMPLETE){\n&nbsp;&nbsp;&nbsp; //failed to make complete frame buffer object&nbsp;\n}\n</code></pre><p>å®Œæˆä»¥ä¸Šæ“ä½œï¼Œæˆ‘ä»¬å°±æŠŠEAGLå’Œæˆ‘ä»¬çš„Layerï¼ˆè®¾å¤‡çš„å±å¹•ï¼‰è¿æ¥èµ·æ¥äº†ï¼Œå½“æˆ‘ä»¬ç»˜åˆ¶äº†ä¸€å¸§ä¹‹åï¼ˆå½“ç„¶ç»˜åˆ¶è¿‡ç¨‹ä¹Ÿå¿…é¡»åœ¨è¿™ä¸ªçº¿ç¨‹ä¸­ï¼‰ï¼Œè°ƒç”¨ä»¥ä¸‹ä»£ç å°±å¯ä»¥å°†ç»˜åˆ¶çš„ç»“æœæ˜¾ç¤ºåˆ°å±å¹•ä¸Šäº†ã€‚</p><pre><code class=\"language-plain\">[_context presentRenderbuffer:GL_RENDERBUFFER];\n</code></pre><p>è¿™æ ·æˆ‘ä»¬å°±æ­å»ºå¥½äº†iOSå¹³å°çš„OpenGL ESçš„ä¸Šä¸‹æ–‡ç¯å¢ƒã€‚è¿™ç»™æˆ‘ä»¬ä¹‹åè¦å­¦çš„å†…å®¹æ‰“å¥½äº†åŸºç¡€ã€‚</p><p>è¿™é‡ŒOpen GLä¸Šä¸‹æ–‡ç¯å¢ƒæ­å»ºçš„é‡ç‚¹å·²ç»è®²å®Œäº†ï¼Œä½†æ˜¯å­¦åˆ°è¿™é‡Œä½ å¯èƒ½ä¼šæœ‰ä¸€äº›ç–‘é—®ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸€ä¸ªå¹³å°æ­å»ºè‡ªå·±çš„OpenGL ESä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œæ„Ÿè§‰å¥½å¤æ‚å‘€ï¼Œå¹¶ä¸”æ•´ä¸ªæ­å»ºè¿‡ç¨‹ä¹Ÿéƒ½æ¶‰åŠå¹³å°ç›¸å…³çš„APIæ¥å£ï¼Œé‚£æœ‰æ²¡æœ‰ä¸€ä¸ªå¼€æºæ¡†æ¶å¯ä»¥å°†ä¸Šä¸‹æ–‡ç¯å¢ƒé€æ˜æ‰å‘¢ï¼Ÿè¿™æ ·å¼€å‘è€…ä¸å°±å¯ä»¥ä¸“æ³¨åœ¨è‡ªå·±çš„ä¸šåŠ¡å’Œé‡ç‚¹ç®—æ³•æ”»åšä¸Šäº†å—ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯æœ‰çš„ï¼Œå°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥è¦å­¦ä¹ çš„ä¸€ä¸ªåº“â€”â€”SDLã€‚</p><h2>SDLçš„ä»‹ç»ä¸ä½¿ç”¨</h2><p>SDLå¯ä»¥ç»™å¼€å‘è€…æä¾›é¢å‘libSDLçš„APIç¼–ç¨‹ï¼Œå®ƒçš„å†…éƒ¨èƒ½è§£å†³å¤šä¸ªå¹³å°çš„OpenGLä¸Šä¸‹æ–‡ç¯å¢ƒå’Œçª—å£ç®¡ç†çš„é—®é¢˜ã€‚å¼€å‘è€…åªéœ€è¦äº¤å‰ç¼–è¯‘è¿™ä¸ªåº“åˆ°å„è‡ªçš„å¹³å°ä¸Šï¼Œå°±å¯ä»¥è¾¾åˆ°ä¸€ä»½ä»£ç è¿è¡Œåˆ°å¤šä¸ªå¹³å°çš„ç›®çš„äº†ã€‚FFmpegä¸­çš„ffplayå·¥å…·å°±æ˜¯åŸºäºlibSDLå¼€å‘çš„ï¼ŒSDLä¸å•å•å¯ä»¥æ¸²æŸ“è§†é¢‘ç”»é¢ï¼Œä¹Ÿå¯ä»¥æ¸²æŸ“éŸ³é¢‘ã€‚</p><p>ä½†æ˜¯å¯¹äºç§»åŠ¨å¼€å‘è€…æ¥è®²ï¼Œå®ƒä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹ï¼Œæ¯”å¦‚ä½¿ç”¨SDLä¼šç‰ºç‰²ä¸€äº›æ›´åŠ çµæ´»çš„æ§åˆ¶ï¼Œç”šè‡³æŸäº›åœºæ™¯ä¸‹çš„åŠŸèƒ½å®ç°ä¸äº†ã€‚æ‰€ä»¥åˆ°åº•ç”¨ä¸ç”¨SDLï¼Œä½ å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚å»è€ƒé‡ï¼Œä½†äº†è§£è¿™ä¸ªåº“æ˜¯ååˆ†æœ‰å¿…è¦çš„ã€‚</p><p>æˆ‘ä»¬è¿™ä¸ªéƒ¨åˆ†çš„è®²è§£æ˜¯åŸºäºMac + CLionçš„C++å·¥ç¨‹ï¼Œæœ€åå­¦ä¹ æ€ä¹ˆå»ä½¿ç”¨sdl2è¿™ä¸ªåº“æ¥æ„å»ºOpenGL ESçš„ä¸Šä¸‹æ–‡ç¯å¢ƒã€‚</p><p>é¦–å…ˆæ˜¯å®‰è£…sdl2åº“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæ¥å®‰è£…ã€‚</p><pre><code class=\"language-plain\">brew install sdl2\n</code></pre><p>å®‰è£…åï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤æ¥æŸ¥çœ‹å®‰è£…åˆ—è¡¨å’Œå®‰è£…è·¯å¾„ã€‚</p><pre><code class=\"language-plain\">brew list æŸ¥çœ‹å®‰è£…åˆ—è¡¨\nbrew list sdl2 æŸ¥çœ‹sdl2å®‰è£…è·¯å¾„\n</code></pre><p>å¦‚æœå®‰è£…è·¯å¾„æ˜¯ï¼š/usr/local/Cellar/sdl2/2.0.14_1ï¼Œéœ€è¦åœ¨å·¥ç¨‹çš„CMakeLists.txtæ–‡ä»¶é‡Œï¼ŒåŠ å…¥é…ç½®ã€‚</p><pre><code class=\"language-plain\">include_directories(/usr/local/Cellar/sdl2/2.0.14_1/include/)\nlink_directories(/usr/local/Cellar/sdl2/2.0.14_1/lib )\n</code></pre><p>åœ¨å·¥ç¨‹é‡ŒåŠ å…¥SDLåº“å’ŒOpenGLåº“é“¾æ¥é…ç½®ã€‚</p><pre><code class=\"language-plain\">target_link_libraries(\n  SDL_OpenGL\n  SDL2\n  \"-framework OpenGL\"\n)\n</code></pre><p>åŠ å…¥å¤´æ–‡ä»¶ã€‚</p><pre><code class=\"language-plain\">//SDL API\n#include \"SDL2/SDL.h\"\n//OpenGL API\n#include \"OpenGL/gl3.h\"\n</code></pre><p>æ¥ä¸‹æ¥å°±æ˜¯æ•´ä¸ªä½¿ç”¨SDLæ¸²æŸ“çš„æ•´ä½“æµç¨‹ï¼Œåœ¨è®²è§£è¿‡ç¨‹ä¸­æˆ‘ä»¬å‚è€ƒè¿™ä¸ªæµç¨‹ç»“æ„å›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/6e/4b/6ed519cb2dc8cced3ee7396513fc4e4b.png?wh=1920x1074\" alt=\"å›¾ç‰‡\"></p><p>ç»“åˆä¸Šå›¾ï¼Œæˆ‘ä»¬æ¥è¯¦ç»†åœ°è®²è§£ä¸€ä¸‹å…¶ä¸­çš„å…³é”®æµç¨‹ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºçª—å£å’ŒOpenGLä¸Šä¸‹æ–‡ã€‚</p><pre><code class=\"language-plain\">SDL_Window *window = SDL_CreateWindow(\"hello OpenGL\", 0, 0, 300, 300, SDL_WINDOW_OPENGL);\nSDL_GLContext context = SDL_GL_CreateContext(window);\n</code></pre><p>è¿›è¡Œå¾ªç¯æ¸²æŸ“å’Œæ›´æ–°çª—å£æ“ä½œï¼Œç„¶åé€€å‡ºã€‚</p><pre><code class=\"language-plain\">while(true) {\n  drawFromOpenGL();&nbsp;//æ‰§è¡Œè¦åšçš„æ¸²æŸ“\n  SDL_GL_SwapWindow(window); //ç›¸å½“äºæ‰§è¡Œäº†eglSwapBuffersæ“ä½œ\n  if (SDL_PollEvent(&amp;event) &amp;&amp; event.type == SDL_QUIT) {\n    //åœ¨ç‚¹å‡»çª—å£closeæ—¶é€€å‡ºå¾ªç¯\n    break;\n  }\n  SDL_Delay(30); //å•ä½ms,è®¾ç½®åˆ·æ–°é¢‘ç‡\n}\n</code></pre><p>æœ€åï¼Œé‡Šæ”¾èµ„æºã€‚</p><pre><code class=\"language-plain\">SDL_GL_DeleteContext(context);\nSDL_DestroyWindow(window);\nSDL_Quit();\n</code></pre><p>æŒ‰ç…§ä¸Šè¿°çš„æ•´ä¸ªæµç¨‹ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨SDLæ„å»ºèµ·OpenGL ESçš„ä¸Šä¸‹æ–‡ç¯å¢ƒäº†ï¼Œå…¶å®è¿™ä¹Ÿå›ç­”äº†åˆšæ‰æˆ‘ä»¬æå‡ºçš„é—®é¢˜ã€‚å¦‚æœä½ é€‰æ‹©ä½¿ç”¨SDLæ¥æ„å»ºï¼Œé‚£ä¹ˆä½ å†™çš„ä»£ç å°±æ˜¯è·¨å¹³å°çš„ï¼Œå®é™…ä¸Šæ˜¯SDLå†…éƒ¨å°†å¹³å°çš„å·®å¼‚æ€§å±è”½æ‰äº†ï¼Œè®©æˆ‘ä»¬å¯ä»¥æ›´æ–¹ä¾¿åœ°å»ä¹¦å†™è‡ªå·±çš„ä¸šåŠ¡ï¼Œè¿™ä¹Ÿæ˜¯é¢å‘å¯¹è±¡æ€æƒ³çš„ä¸€ä¸ªé‡è¦ç‰¹å¾ï¼Œä½ ä¹Ÿå¯ä»¥æ€è€ƒä¸€ä¸‹ï¼ŒæŠŠå®ƒç”¨åˆ°å¹³æ—¶çš„ç³»ç»Ÿä¸æ¶æ„è®¾è®¡ä¸­ã€‚</p><h2>æ€»ç»“</h2><p>è¿™èŠ‚è¯¾æˆ‘ä»¬åˆ†åˆ«ä¸ºAndroidå’ŒiOSå¹³å°æ„å»ºå‡ºäº†OpenGL ESçš„ä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œä¹Ÿç»™ä½ è®²è§£äº†ä½¿ç”¨SDLçš„æ–¹æ³•ä»¥åŠä¼˜åŠ¿ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/10/6c/1072af5f016e12b10874703310ac1a6c.png?wh=1920x895\" alt=\"å›¾ç‰‡\"></p><p>è¿˜è®°å¾—åœ¨ä¸Šä¸€èŠ‚è¯¾æˆ‘ä»¬åˆ›å»ºå‡ºæ¥çš„æ˜¾å¡æ‰§è¡Œç¨‹åºå—ï¼Ÿæ¥ä¸‹æ¥å°±æ˜¯è§è¯å¥‡è¿¹çš„æ—¶åˆ»ï¼šè®©æˆ‘ä»¬åˆ›å»ºçš„æ˜¾å¡æ‰§è¡Œç¨‹åºè¿è¡Œåœ¨æ„å»ºå‡ºæ¥çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸Šï¼Œæœ€ç»ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡OpenGL ESå°†YUVï¼ˆæˆ–è€…RGBAï¼‰æ•°æ®ç»˜åˆ¶åˆ°ç³»ç»Ÿå±å¹•ä¸Šã€‚é‚£ä¹ˆå¦‚ä½•å°†æ˜¾å¡æ‰§è¡Œç¨‹åºè¿è¡Œåˆ°å¹³å°çš„ä¸Šä¸‹æ–‡ç¯å¢ƒä¸­å‘¢ï¼Ÿæˆ‘ä»¬ä¸‹èŠ‚è¯¾æ¥ç€èŠã€‚</p><h2>æ€è€ƒé¢˜</h2><p>åœ¨ä»Šå¤©å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“äº†OpenGL ESçš„æ¸²æŸ“éœ€è¦åœ¨ä¸€ä¸ªç»‘å®šäº†ä¸Šä¸‹æ–‡çš„ç‹¬ç«‹çº¿ç¨‹ä¸­è¿›è¡Œï¼Œä½†æ˜¯åœ¨å®é™…çš„ä¸€äº›åœºæ™¯ä¸­ï¼ŒOpenGL ESçš„æ¸²æŸ“éœ€è¦åˆ†å¸ƒåœ¨å¤šä¸ªçº¿ç¨‹ä¸­ï¼Œå¹¶ä¸”å¤šä¸ªçº¿ç¨‹è¿˜éœ€è¦å…±äº«è¿™ä¸ªä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œé‚£è¿™ä¸ªæ—¶å€™æˆ‘ä»¬åº”è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿæ¬¢è¿åœ¨è¯„è®ºåŒºç•™ä¸‹ä½ çš„æ€è€ƒï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™éœ€è¦çš„æœ‹å‹ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ï¼</p>","comments":[{"had_liked":false,"id":353538,"user_name":"å¤§åœŸè±†","can_delete":false,"product_type":"c1","uid":1121636,"ip_address":"åŒ—äº¬","ucode":"67445DC3EC9DB0","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/64/52a5863b.jpg","comment_is_top":false,"comment_ctime":1659527174,"is_pvip":false,"replies":[{"id":128616,"content":"å°ç™½æ…¢æ…¢å­¦ä¹ ä¹Ÿæ˜¯å¯ä»¥çœ‹æ‡‚çš„ï¼Œåç»­æˆ‘ä¼šåŠ ä¸Šäº‹ä¾‹ä»£ç ï¼Œåªè¦æƒ³å­¦çš„äººè¿™å¥—è¯¾ç¨‹ä¸€å®šå¯ä»¥æä¾›æœ€ç³»ç»Ÿçš„å†…å®¹ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3069513,"ctime":1659771335,"ip_address":"åŒ—äº¬","comment_id":353538,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100117601,"comment_content":"æˆ‘æ„Ÿè§‰è¿™è¯¾ç¨‹å°ç™½æ˜¯å¬ä¸æ‡‚äº†ã€‚æˆ‘è¿™ç§ä¹‹å‰æŠŠEGLçš„ä»£ç å½“æˆå…«è‚¡æ–‡å’Œæ¨¡æ¿çš„ï¼Œå€’æ˜¯åˆé‡æ–°ç†è§£äº†ä¸€éã€‚","like_count":3,"discussions":[{"author":{"id":3069513,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/d6/49/27f68f7d.jpg","nickname":"Kevin","note":"","ucode":"5FCE361CB8C187","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582909,"discussion_content":"å°ç™½æ…¢æ…¢å­¦ä¹ ä¹Ÿæ˜¯å¯ä»¥çœ‹æ‡‚çš„ï¼Œåç»­æˆ‘ä¼šåŠ ä¸Šäº‹ä¾‹ä»£ç ï¼Œåªè¦æƒ³å­¦çš„äººè¿™å¥—è¯¾ç¨‹ä¸€å®šå¯ä»¥æä¾›æœ€ç³»ç»Ÿçš„å†…å®¹ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1659771335,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":355672,"user_name":"å°è·‘çŒ«","can_delete":false,"product_type":"c1","uid":1331188,"ip_address":"åŒ—äº¬","ucode":"59FF6D2D7ADF38","user_header":"https://static001.geekbang.org/account/avatar/00/14/4f/f4/55081288.jpg","comment_is_top":false,"comment_ctime":1661620244,"is_pvip":false,"replies":[{"id":129460,"content":"GLSurfaceviewå…¶å®å°±æ˜¯SurfaceView+OpenGLä¸Šä¸‹æ–‡ç®¡ç†ï¼Œä¸èƒ½å°†GLSurfaceVIewçš„Surfaceåœ¨ä¼ é€’åˆ°Nativeå±‚å»çš„ï¼Œæˆ‘ä»¬è¿™é‡Œè®²è§£çš„æ˜¯æŠŠSurfaceViewæˆ–è€…TexureViewçš„Surfaceä¼ é€’åˆ°Nativeå±‚å»æ„å»ºANativeWindowã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3069513,"ctime":1661680399,"ip_address":"åŒ—äº¬","comment_id":355672,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100117601,"comment_content":"æœ‰ä¸€ä¸ªå›°æƒ‘è¯·æ•™ï¼ŒGLSurfaceviewæœ¬èº«å®ç°äº†ä¸€å¥—openglä¸Šä¸‹æ–‡ï¼Œå¦‚æœå†æŠŠå®ƒçš„surfaceä¼ åˆ°nativeå»å…³è”ANAtiveWindowï¼Œå¹¶åœ¨nativeå±‚åˆ›å»ºä¸Šä¸‹æ–‡ä¹‹åè¿›è¡Œæ¸²æŸ“ï¼Œè¿™ä¸¤å¥—ä¸Šä¸‹æ–‡ä¼šä¸ä¼šå†²çªï¼Ÿ","like_count":1,"discussions":[{"author":{"id":3069513,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/d6/49/27f68f7d.jpg","nickname":"Kevin","note":"","ucode":"5FCE361CB8C187","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585580,"discussion_content":"GLSurfaceviewå…¶å®å°±æ˜¯SurfaceView+OpenGLä¸Šä¸‹æ–‡ç®¡ç†ï¼Œä¸èƒ½å°†GLSurfaceVIewçš„Surfaceåœ¨ä¼ é€’åˆ°Nativeå±‚å»çš„ï¼Œæˆ‘ä»¬è¿™é‡Œè®²è§£çš„æ˜¯æŠŠSurfaceViewæˆ–è€…TexureViewçš„Surfaceä¼ é€’åˆ°Nativeå±‚å»æ„å»ºANativeWindowã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661680399,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353462,"user_name":"æˆ‘çš„ç„¡åŠ›é›™è‡‚","can_delete":false,"product_type":"c1","uid":2636511,"ip_address":"åŒ—äº¬","ucode":"139B164CDA5CAB","user_header":"https://static001.geekbang.org/account/avatar/00/28/3a/df/f0f1ee84.jpg","comment_is_top":false,"comment_ctime":1659482964,"is_pvip":false,"replies":[{"id":128612,"content":"åœ¨è¯¾ç¨‹æ›´æ–°å®Œæ¯•ä¹‹åï¼Œä¼šæŠŠä»£ç å…¬å¸ƒå‡ºæ¥å“ˆï¼Œå¤§å®¶å…ˆå­¦çŸ¥è¯†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3069513,"ctime":1659771000,"ip_address":"åŒ—äº¬","comment_id":353462,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100117601,"comment_content":"demoçš„ç¤ºä¾‹ä»£ç æœ‰é“¾æ¥å—","like_count":1,"discussions":[{"author":{"id":3069513,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/d6/49/27f68f7d.jpg","nickname":"Kevin","note":"","ucode":"5FCE361CB8C187","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582903,"discussion_content":"åœ¨è¯¾ç¨‹æ›´æ–°å®Œæ¯•ä¹‹åï¼Œä¼šæŠŠä»£ç å…¬å¸ƒå‡ºæ¥å“ˆï¼Œå¤§å®¶å…ˆå­¦çŸ¥è¯†ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1659771000,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360320,"user_name":"Aaron","can_delete":false,"product_type":"c1","uid":2855005,"ip_address":"åŒ—äº¬","ucode":"76DCA4A53D0D05","user_header":"https://static001.geekbang.org/account/avatar/00/2b/90/5d/a177df1e.jpg","comment_is_top":false,"comment_ctime":1666427781,"is_pvip":false,"replies":[{"id":131823,"content":"ä»£ç ğŸ”— https:&#47;&#47;github.com&#47;zhanxiaokai","user_name":"ç¼–è¾‘å›å¤","user_name_real":"ç¼–è¾‘","uid":2843479,"ctime":1668529886,"ip_address":"åŒ—äº¬","comment_id":360320,"utype":2}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100117601,"comment_content":"è€å¸ˆï¼Œè¯·é—®æœ‰æºä»£ç çš„é“¾æ¥å—","like_count":0,"discussions":[{"author":{"id":2843479,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/63/57/cba4c68b.jpg","nickname":"å°è™å­ğŸ¯","note":"","ucode":"4C9530B3FB407B","race_medal":0,"user_type":8,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":593797,"discussion_content":"ä»£ç ğŸ”— https://github.com/zhanxiaokai","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1668529886,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":8}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":356727,"user_name":"ä¸€ä¸ªæ­£ç›´çš„å°é¾™çŒ«","can_delete":false,"product_type":"c1","uid":1028139,"ip_address":"åŒ—äº¬","ucode":"7C9CFFAA299D1A","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b0/2b/87aff702.jpg","comment_is_top":false,"comment_ctime":1662536359,"is_pvip":false,"replies":[{"id":129901,"content":"ä¹Ÿå¯ä»¥ï¼Œä¸è¿‡iOSç°åœ¨ä½¿ç”¨OpenGL ESåº•å±‚ä¹Ÿä¼šè½¬æ¢ä¸ºMetalçš„ï¼Œåƒæ’­æ”¾å™¨ã€ç¾é¢œã€é¢„è§ˆè¿™ç§ç®€å•åº”ç”¨ä½¿ç”¨OpenGL ESè¶³ä»¥æ»¡è¶³ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3069513,"ctime":1662800821,"ip_address":"åŒ—äº¬","comment_id":356727,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100117601,"comment_content":"è¿™èŠ‚è¯¾çœ‹ä¸æ‡‚äº†ï¼Œæƒ³é—®ä¸€ä¸ªå…¶ä»–ç›¸å…³çš„é—®é¢˜ï¼ŒiOSå¹³å°ä½¿ç”¨metal ä¼šä¸ä¼šæ›´åˆé€‚ä¸€äº›ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":3069513,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/d6/49/27f68f7d.jpg","nickname":"Kevin","note":"","ucode":"5FCE361CB8C187","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":587115,"discussion_content":"ä¹Ÿå¯ä»¥ï¼Œä¸è¿‡iOSç°åœ¨ä½¿ç”¨OpenGL ESåº•å±‚ä¹Ÿä¼šè½¬æ¢ä¸ºMetalçš„ï¼Œåƒæ’­æ”¾å™¨ã€ç¾é¢œã€é¢„è§ˆè¿™ç§ç®€å•åº”ç”¨ä½¿ç”¨OpenGL ESè¶³ä»¥æ»¡è¶³ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1662800821,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353562,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"åŒ—äº¬","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1659566388,"is_pvip":false,"replies":[{"id":128617,"content":"A1: EGLæ˜¯OpenGL ESåœ¨Androidæˆ–è€…linuxå¹³å°çš„å®ç°ï¼Œæä¾›äº†ä¸Šä¸‹æ–‡ç¯å¢ƒã€‚å¯ä»¥ç†è§£ä¸ºOpenGLå®šä¹‰äº†ä¸€å¥—æ ‡å‡†åè®®ï¼ŒEGLæŒ‰ç…§æ ‡å‡†è¿›è¡Œå®ç°ï¼Œå°±åƒJVMæœ‰å¾ˆå¤šå®¶å®ç°ä¸€æ ·ï¼›\nA2: ä¼šæœ‰çš„ï¼Œä¸è¿‡æœ€è¿‘åœ¨ç´§æ€¥çš„æ›´æ–°è¯¾ç¨‹ï¼Œæºç é¢„è®¡9æœˆä»½å¯ä»¥ä¼ ä¸Šå»ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3069513,"ctime":1659771440,"ip_address":"åŒ—äº¬","comment_id":353562,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100117601,"comment_content":"è¯·æ•™è€å¸ˆä¸¤ä¸ªé—®é¢˜ï¼š\nQ1ï¼šEGLå’ŒOpenGL ESæ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ\nEGLæ˜¯OpenGL ESçš„ä¸€éƒ¨åˆ†å—ï¼Ÿæ¯”å¦‚ï¼ŒEGLæ˜¯OpenGL ESçš„åº•å±‚éƒ¨åˆ†ã€‚æˆ–è€…ï¼Œä¸¤è€…æ˜¯ç›¸äº’ç‹¬ç«‹çš„ä¸¤ä¸ªå®ä½“ï¼Ÿ\nQ2ï¼šèƒ½å¦æä¾›å¯è¿è¡Œçš„æºä»£ç ï¼Ÿæˆ‘æ‡‚ä¸€ç‚¹å®‰å“ï¼Œèƒ½ç”¨ASåˆ›å»ºç®€å•çš„å·¥ç¨‹ï¼Œæ‰€ä»¥æœ€å¥½æ˜¯å®‰å“ç‰ˆæœ¬ï¼ŒåŸºäºAndroidStudioçš„æºä»£ç ï¼Œèƒ½è¿è¡Œåäº§ç”Ÿä¸€ä¸ªç®€å•çš„ç»“æœå³å¯ï¼Œæ¯”å¦‚æ‰“å°ä¸€å¥è¯ç­‰ã€‚æ–‡ç« å†™å¾—å¾ˆå¥½ï¼Œå¾ˆæµç•…ï¼Œé€»è¾‘æ¸…æ™°ï¼Œä½†æ²¡æœ‰å®é™…çš„æ“ä½œå°±å¥½åƒå°‘äº†ä¸€ç‚¹ä»€ä¹ˆã€‚","like_count":0,"discussions":[{"author":{"id":3069513,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/d6/49/27f68f7d.jpg","nickname":"Kevin","note":"","ucode":"5FCE361CB8C187","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582910,"discussion_content":"A1: EGLæ˜¯OpenGL ESåœ¨Androidæˆ–è€…linuxå¹³å°çš„å®ç°ï¼Œæä¾›äº†ä¸Šä¸‹æ–‡ç¯å¢ƒã€‚å¯ä»¥ç†è§£ä¸ºOpenGLå®šä¹‰äº†ä¸€å¥—æ ‡å‡†åè®®ï¼ŒEGLæŒ‰ç…§æ ‡å‡†è¿›è¡Œå®ç°ï¼Œå°±åƒJVMæœ‰å¾ˆå¤šå®¶å®ç°ä¸€æ ·ï¼›\nA2: ä¼šæœ‰çš„ï¼Œä¸è¿‡æœ€è¿‘åœ¨ç´§æ€¥çš„æ›´æ–°è¯¾ç¨‹ï¼Œæºç é¢„è®¡9æœˆä»½å¯ä»¥ä¼ ä¸Šå»ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659771440,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":353495,"user_name":"ç‹å‚é•¿","can_delete":false,"product_type":"c1","uid":1255794,"ip_address":"åŒ—äº¬","ucode":"FF41279DA5A860","user_header":"https://static001.geekbang.org/account/avatar/00/13/29/72/515e8867.jpg","comment_is_top":false,"comment_ctime":1659498822,"is_pvip":true,"replies":[{"id":128614,"content":"æœ‰çš„ï¼Œè¯¾ç¨‹æ›´æ–°å®Œæ¯•ä¹‹åï¼Œä¼šæ…¢æ…¢æ›´æ–°ä¸Šæ¥çš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3069513,"ctime":1659771217,"ip_address":"åŒ—äº¬","comment_id":353495,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100117601,"comment_content":"æœ‰exampleä»£ç å—ï¼Œè¿™ä¸ªå¾ˆé‡è¦å•Š","like_count":0,"discussions":[{"author":{"id":3069513,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/d6/49/27f68f7d.jpg","nickname":"Kevin","note":"","ucode":"5FCE361CB8C187","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582906,"discussion_content":"æœ‰çš„ï¼Œè¯¾ç¨‹æ›´æ–°å®Œæ¯•ä¹‹åï¼Œä¼šæ…¢æ…¢æ›´æ–°ä¸Šæ¥çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659771217,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":380138,"user_name":"ç‹å»ºå³°","can_delete":false,"product_type":"c1","uid":1968013,"ip_address":"é‡åº†","ucode":"8BF1AEFFA7EA5F","user_header":"https://static001.geekbang.org/account/avatar/00/1e/07/8d/3e76560f.jpg","comment_is_top":false,"comment_ctime":1693095951,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100117601,"comment_content":"æåˆ°æ¸²æŸ“åçš„æ˜¾ç¤ºçš„è¿‡ç¨‹ï¼Œæœ‰ç‚¹ä¸å¤ªæ˜ç™½ï¼Œæˆ‘ä»¬æ¸²æŸ“åçš„å›¾å½¢ï¼Œå¦‚æœæœ‰å¤šä¸ªå›¾å±‚è¿›è¡Œåˆæˆï¼Œåˆæˆåº”è¯¥åœ¨å“ªä¸ªåœ°æ–¹åšå‘¢ï¼Œè°æ¥æ‰§è¡Œè¿™éƒ¨åˆ†çš„ç¨‹åºï¼Ÿåˆæˆåçš„å›¾åƒä¼šå†™åˆ°backing bufferï¼Œç„¶åè®¾ç½®æˆ fronting buffer åˆ°æ˜¾ç¤ºå±ï¼Œå¯ä»¥è¿™æ ·åšå˜›ï¼Ÿ","like_count":0}]}