{"id":74687,"title":"19 | ä¸ºä»€ä¹ˆæˆ‘åªæŸ¥ä¸€è¡Œçš„è¯­å¥ï¼Œä¹Ÿæ‰§è¡Œè¿™ä¹ˆæ…¢ï¼Ÿ","content":"<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœæˆ‘è·Ÿä½ è¯´æŸ¥è¯¢æ€§èƒ½ä¼˜åŒ–ï¼Œä½ é¦–å…ˆä¼šæƒ³åˆ°ä¸€äº›å¤æ‚çš„è¯­å¥ï¼Œæƒ³åˆ°æŸ¥è¯¢éœ€è¦è¿”å›å¤§é‡çš„æ•°æ®ã€‚ä½†æœ‰äº›æƒ…å†µä¸‹ï¼Œâ€œæŸ¥ä¸€è¡Œâ€ï¼Œä¹Ÿä¼šæ‰§è¡Œå¾—ç‰¹åˆ«æ…¢ã€‚ä»Šå¤©ï¼Œæˆ‘å°±è·Ÿä½ èŠèŠè¿™ä¸ªæœ‰è¶£çš„è¯é¢˜ï¼Œçœ‹çœ‹ä»€ä¹ˆæƒ…å†µä¸‹ï¼Œä¼šå‡ºç°è¿™ä¸ªç°è±¡ã€‚</p><p>éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œå¦‚æœMySQLæ•°æ®åº“æœ¬èº«å°±æœ‰å¾ˆå¤§çš„å‹åŠ›ï¼Œå¯¼è‡´æ•°æ®åº“æœåŠ¡å™¨CPUå ç”¨ç‡å¾ˆé«˜æˆ–ioutilï¼ˆIOåˆ©ç”¨ç‡ï¼‰å¾ˆé«˜ï¼Œè¿™ç§æƒ…å†µä¸‹æ‰€æœ‰è¯­å¥çš„æ‰§è¡Œéƒ½æœ‰å¯èƒ½å˜æ…¢ï¼Œä¸å±äºæˆ‘ä»¬ä»Šå¤©çš„è®¨è®ºèŒƒå›´ã€‚</p><p>ä¸ºäº†ä¾¿äºæè¿°ï¼Œæˆ‘è¿˜æ˜¯æ„é€ ä¸€ä¸ªè¡¨ï¼ŒåŸºäºè¿™ä¸ªè¡¨æ¥è¯´æ˜ä»Šå¤©çš„é—®é¢˜ã€‚è¿™ä¸ªè¡¨æœ‰ä¸¤ä¸ªå­—æ®µidå’Œcï¼Œå¹¶ä¸”æˆ‘åœ¨é‡Œé¢æ’å…¥äº†10ä¸‡è¡Œè®°å½•ã€‚</p><pre><code>mysql&gt; CREATE TABLE `t` (\n  `id` int(11) NOT NULL,\n  `c` int(11) DEFAULT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB;\n\ndelimiter ;;\ncreate procedure idata()\nbegin\n  declare i int;\n  set i=1;\n  while(i&lt;=100000) do\n    insert into t values(i,i);\n    set i=i+1;\n  end while;\nend;;\ndelimiter ;\n\ncall idata();\n</code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šç”¨å‡ ä¸ªä¸åŒçš„åœºæ™¯æ¥ä¸¾ä¾‹ï¼Œæœ‰äº›æ˜¯å‰é¢çš„æ–‡ç« ä¸­æˆ‘ä»¬å·²ç»ä»‹ç»è¿‡çš„çŸ¥è¯†ç‚¹ï¼Œä½ çœ‹çœ‹èƒ½ä¸èƒ½ä¸€çœ¼çœ‹ç©¿ï¼Œæ¥æ£€éªŒä¸€ä¸‹å§ã€‚</p><h1>ç¬¬ä¸€ç±»ï¼šæŸ¥è¯¢é•¿æ—¶é—´ä¸è¿”å›</h1><p>å¦‚å›¾1æ‰€ç¤ºï¼Œåœ¨è¡¨tæ‰§è¡Œä¸‹é¢çš„SQLè¯­å¥ï¼š</p><pre><code>mysql&gt; select * from t where id=1;\n</code></pre><p>æŸ¥è¯¢ç»“æœé•¿æ—¶é—´ä¸è¿”å›ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/87/2a/8707b79d5ed906950749f5266014f22a.png?wh=436*70\" alt=\"\"></p><center><span class=\"reference\">å›¾1 æŸ¥è¯¢é•¿æ—¶é—´ä¸è¿”å›</span></center><p>ä¸€èˆ¬ç¢°åˆ°è¿™ç§æƒ…å†µçš„è¯ï¼Œå¤§æ¦‚ç‡æ˜¯è¡¨tè¢«é”ä½äº†ã€‚æ¥ä¸‹æ¥åˆ†æåŸå› çš„æ—¶å€™ï¼Œä¸€èˆ¬éƒ½æ˜¯é¦–å…ˆæ‰§è¡Œä¸€ä¸‹show processlistå‘½ä»¤ï¼Œçœ‹çœ‹å½“å‰è¯­å¥å¤„äºä»€ä¹ˆçŠ¶æ€ã€‚</p><p>ç„¶åæˆ‘ä»¬å†é’ˆå¯¹æ¯ç§çŠ¶æ€ï¼Œå»åˆ†æå®ƒä»¬äº§ç”Ÿçš„åŸå› ã€å¦‚ä½•å¤ç°ï¼Œä»¥åŠå¦‚ä½•å¤„ç†ã€‚</p><h2>ç­‰MDLé”</h2><!-- [[[read_end]]] --><p>å¦‚å›¾2æ‰€ç¤ºï¼Œå°±æ˜¯ä½¿ç”¨show processlistå‘½ä»¤æŸ¥çœ‹Waiting for table metadata lockçš„ç¤ºæ„å›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/50/28/5008d7e9e22be88a9c80916df4f4b328.png?wh=1312*213\" alt=\"\"></p><center><span class=\"reference\">å›¾2 Waiting for table metadata lockçŠ¶æ€ç¤ºæ„å›¾</span></center><p>å‡ºç°<strong>è¿™ä¸ªçŠ¶æ€è¡¨ç¤ºçš„æ˜¯ï¼Œç°åœ¨æœ‰ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨è¡¨tä¸Šè¯·æ±‚æˆ–è€…æŒæœ‰MDLå†™é”ï¼ŒæŠŠselectè¯­å¥å µä½äº†ã€‚</strong></p><p>åœ¨ç¬¬6ç¯‡æ–‡ç« <a href=\"https://time.geekbang.org/column/article/69862\">ã€Šå…¨å±€é”å’Œè¡¨é” ï¼šç»™è¡¨åŠ ä¸ªå­—æ®µæ€ä¹ˆæœ‰è¿™ä¹ˆå¤šé˜»ç¢ï¼Ÿã€‹</a>ä¸­ï¼Œæˆ‘ç»™ä½ ä»‹ç»è¿‡ä¸€ç§å¤ç°æ–¹æ³•ã€‚ä½†éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œé‚£ä¸ªå¤ç°è¿‡ç¨‹æ˜¯åŸºäºMySQL 5.6ç‰ˆæœ¬çš„ã€‚è€ŒMySQL 5.7ç‰ˆæœ¬ä¿®æ”¹äº†MDLçš„åŠ é”ç­–ç•¥ï¼Œæ‰€ä»¥å°±ä¸èƒ½å¤ç°è¿™ä¸ªåœºæ™¯äº†ã€‚</p><p>ä¸è¿‡ï¼Œåœ¨MySQL 5.7ç‰ˆæœ¬ä¸‹å¤ç°è¿™ä¸ªåœºæ™¯ï¼Œä¹Ÿå¾ˆå®¹æ˜“ã€‚å¦‚å›¾3æ‰€ç¤ºï¼Œæˆ‘ç»™å‡ºäº†ç®€å•çš„å¤ç°æ­¥éª¤ã€‚<br>\n<img src=\"https://static001.geekbang.org/resource/image/74/ca/742249a31b83f4858c51bfe106a5daca.png?wh=940*147\" alt=\"\"></p><center><span class=\"reference\">å›¾3 MySQL 5.7ä¸­Waiting for table metadata lockçš„å¤ç°æ­¥éª¤</span></center><p>session A é€šè¿‡lock tableå‘½ä»¤æŒæœ‰è¡¨tçš„MDLå†™é”ï¼Œè€Œsession Bçš„æŸ¥è¯¢éœ€è¦è·å–MDLè¯»é”ã€‚æ‰€ä»¥ï¼Œsession Bè¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚</p><p>è¿™ç±»é—®é¢˜çš„å¤„ç†æ–¹å¼ï¼Œå°±æ˜¯æ‰¾åˆ°è°æŒæœ‰MDLå†™é”ï¼Œç„¶åæŠŠå®ƒkillæ‰ã€‚</p><p>ä½†æ˜¯ï¼Œç”±äºåœ¨show processlistçš„ç»“æœé‡Œé¢ï¼Œsession Açš„Commandåˆ—æ˜¯â€œSleepâ€ï¼Œå¯¼è‡´æŸ¥æ‰¾èµ·æ¥å¾ˆä¸æ–¹ä¾¿ã€‚ä¸è¿‡æœ‰äº†performance_schemaå’Œsysç³»ç»Ÿåº“ä»¥åï¼Œå°±æ–¹ä¾¿å¤šäº†ã€‚ï¼ˆMySQLå¯åŠ¨æ—¶éœ€è¦è®¾ç½®performance_schema=onï¼Œç›¸æ¯”äºè®¾ç½®ä¸ºoffä¼šæœ‰10%å·¦å³çš„æ€§èƒ½æŸå¤±)</p><p>é€šè¿‡æŸ¥è¯¢sys.schema_table_lock_waitsè¿™å¼ è¡¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥æ‰¾å‡ºé€ æˆé˜»å¡çš„process idï¼ŒæŠŠè¿™ä¸ªè¿æ¥ç”¨kill å‘½ä»¤æ–­å¼€å³å¯ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/74/01/74fb24ba3826e3831eeeff1670990c01.png?wh=940*251\" alt=\"\"></p><center><span class=\"reference\">å›¾4 æŸ¥è·åŠ è¡¨é”çš„çº¿ç¨‹id</span></center><h2>ç­‰flush</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ç»™ä½ ä¸¾å¦å¤–ä¸€ç§æŸ¥è¯¢è¢«å µä½çš„æƒ…å†µã€‚</p><p>æˆ‘åœ¨è¡¨tä¸Šï¼Œæ‰§è¡Œä¸‹é¢çš„SQLè¯­å¥ï¼š</p><pre><code>mysql&gt; select * from information_schema.processlist where id=1;\n</code></pre><p>è¿™é‡Œï¼Œæˆ‘å…ˆå–ä¸ªå…³å­ã€‚</p><p>ä½ å¯ä»¥çœ‹ä¸€ä¸‹å›¾5ã€‚æˆ‘æŸ¥å‡ºæ¥è¿™ä¸ªçº¿ç¨‹çš„çŠ¶æ€æ˜¯Waiting for table flushï¼Œä½ å¯ä»¥è®¾æƒ³ä¸€ä¸‹è¿™æ˜¯ä»€ä¹ˆåŸå› ã€‚<br>\n<img src=\"https://static001.geekbang.org/resource/image/2d/24/2d8250398bc7f8f7dce8b6b1923c3724.png?wh=1221*147\" alt=\"\"></p><center><span class=\"reference\">å›¾5 Waiting for table flushçŠ¶æ€ç¤ºæ„å›¾</span></center><p>è¿™ä¸ªçŠ¶æ€è¡¨ç¤ºçš„æ˜¯ï¼Œç°åœ¨æœ‰ä¸€ä¸ªçº¿ç¨‹æ­£è¦å¯¹è¡¨tåšflushæ“ä½œã€‚MySQLé‡Œé¢å¯¹è¡¨åšflushæ“ä½œçš„ç”¨æ³•ï¼Œä¸€èˆ¬æœ‰ä»¥ä¸‹ä¸¤ä¸ªï¼š</p><pre><code>flush tables t with read lock;\n\nflush tables with read lock;\n</code></pre><p>è¿™ä¸¤ä¸ªflushè¯­å¥ï¼Œå¦‚æœæŒ‡å®šè¡¨tçš„è¯ï¼Œä»£è¡¨çš„æ˜¯åªå…³é—­è¡¨tï¼›å¦‚æœæ²¡æœ‰æŒ‡å®šå…·ä½“çš„è¡¨åï¼Œåˆ™è¡¨ç¤ºå…³é—­MySQLé‡Œæ‰€æœ‰æ‰“å¼€çš„è¡¨ã€‚</p><p>ä½†æ˜¯æ­£å¸¸è¿™ä¸¤ä¸ªè¯­å¥æ‰§è¡Œèµ·æ¥éƒ½å¾ˆå¿«ï¼Œé™¤éå®ƒä»¬ä¹Ÿè¢«åˆ«çš„çº¿ç¨‹å µä½äº†ã€‚</p><p>æ‰€ä»¥ï¼Œå‡ºç°Waiting for table flushçŠ¶æ€çš„å¯èƒ½æƒ…å†µæ˜¯ï¼šæœ‰ä¸€ä¸ªflush tableså‘½ä»¤è¢«åˆ«çš„è¯­å¥å µä½äº†ï¼Œç„¶åå®ƒåˆå µä½äº†æˆ‘ä»¬çš„selectè¯­å¥ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥å¤ç°ä¸€ä¸‹è¿™ç§æƒ…å†µï¼Œ<strong>å¤ç°æ­¥éª¤</strong>å¦‚å›¾6æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/2b/9c/2bbc77cfdb118b0d9ef3fdd679d0a69c.png?wh=939*203\" alt=\"\"></p><center><span class=\"reference\">å›¾6 Waiting for table flushçš„å¤ç°æ­¥éª¤</span></center><p>åœ¨session Aä¸­ï¼Œæˆ‘æ•…æ„æ¯è¡Œéƒ½è°ƒç”¨ä¸€æ¬¡sleep(1)ï¼Œè¿™æ ·è¿™ä¸ªè¯­å¥é»˜è®¤è¦æ‰§è¡Œ10ä¸‡ç§’ï¼Œåœ¨è¿™æœŸé—´è¡¨tä¸€ç›´æ˜¯è¢«session Aâ€œæ‰“å¼€â€ç€ã€‚ç„¶åï¼Œsession Bçš„flush tables tå‘½ä»¤å†è¦å»å…³é—­è¡¨tï¼Œå°±éœ€è¦ç­‰session Açš„æŸ¥è¯¢ç»“æŸã€‚è¿™æ ·ï¼Œsession Cè¦å†æ¬¡æŸ¥è¯¢çš„è¯ï¼Œå°±ä¼šè¢«flush å‘½ä»¤å µä½äº†ã€‚</p><p>å›¾7æ˜¯è¿™ä¸ªå¤ç°æ­¥éª¤çš„show processlistç»“æœã€‚è¿™ä¸ªä¾‹å­çš„æ’æŸ¥ä¹Ÿå¾ˆç®€å•ï¼Œä½ çœ‹åˆ°è¿™ä¸ªshow processlistçš„ç»“æœï¼Œè‚¯å®šå°±çŸ¥é“åº”è¯¥æ€ä¹ˆåšäº†ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/39/7e/398407014180be4146c2d088fc07357e.png?wh=1224*212\" alt=\"\"></p><center><span class=\"reference\">å›¾ 7 Waiting for table flushçš„show processlist ç»“æœ</span></center><h2>ç­‰è¡Œé”</h2><p>ç°åœ¨ï¼Œç»è¿‡äº†è¡¨çº§é”çš„è€ƒéªŒï¼Œæˆ‘ä»¬çš„select è¯­å¥ç»ˆäºæ¥åˆ°å¼•æ“é‡Œäº†ã€‚</p><pre><code>mysql&gt; select * from t where id=1 lock in share mode; \n</code></pre><p>ä¸Šé¢è¿™æ¡è¯­å¥çš„ç”¨æ³•ä½ ä¹Ÿå¾ˆç†Ÿæ‚‰äº†ï¼Œæˆ‘ä»¬åœ¨ç¬¬8ç¯‡<a href=\"https://time.geekbang.org/column/article/70562\">ã€Šäº‹åŠ¡åˆ°åº•æ˜¯éš”ç¦»çš„è¿˜æ˜¯ä¸éš”ç¦»çš„ï¼Ÿã€‹</a>æ–‡ç« ä»‹ç»å½“å‰è¯»æ—¶æåˆ°è¿‡ã€‚</p><p>ç”±äºè®¿é—®id=1è¿™ä¸ªè®°å½•æ—¶è¦åŠ è¯»é”ï¼Œå¦‚æœè¿™æ—¶å€™å·²ç»æœ‰ä¸€ä¸ªäº‹åŠ¡åœ¨è¿™è¡Œè®°å½•ä¸ŠæŒæœ‰ä¸€ä¸ªå†™é”ï¼Œæˆ‘ä»¬çš„selectè¯­å¥å°±ä¼šè¢«å µä½ã€‚</p><p>å¤ç°æ­¥éª¤å’Œç°åœºå¦‚ä¸‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/3e/75/3e68326b967701c59770612183277475.png?wh=920*173\" alt=\"\"></p><center><span class=\"reference\">å›¾ 8 è¡Œé”å¤ç°</span></center><p><img src=\"https://static001.geekbang.org/resource/image/3c/8f/3c266e23fc307283aa94923ecbbc738f.png?wh=1285*223\" alt=\"\"></p><center><span class=\"reference\">å›¾ 9 è¡Œé”show processlist ç°åœº</span></center><p>æ˜¾ç„¶ï¼Œsession Aå¯åŠ¨äº†äº‹åŠ¡ï¼Œå æœ‰å†™é”ï¼Œè¿˜ä¸æäº¤ï¼Œæ˜¯å¯¼è‡´session Bè¢«å µä½çš„åŸå› ã€‚</p><p>è¿™ä¸ªé—®é¢˜å¹¶ä¸éš¾åˆ†æï¼Œä½†é—®é¢˜æ˜¯æ€ä¹ˆæŸ¥å‡ºæ˜¯è°å ç€è¿™ä¸ªå†™é”ã€‚å¦‚æœä½ ç”¨çš„æ˜¯MySQL 5.7ç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡sys.innodb_lock_waits è¡¨æŸ¥åˆ°ã€‚</p><p>æŸ¥è¯¢æ–¹æ³•æ˜¯ï¼š</p><pre><code>mysql&gt; select * from t sys.innodb_lock_waits where locked_table='`test`.`t`'\\G\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/d8/18/d8603aeb4eaad3326699c13c46379118.png?wh=864*669\" alt=\"\"></p><center><span class=\"reference\">å›¾10 é€šè¿‡sys.innodb_lock_waits æŸ¥è¡Œé”</span></center><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªä¿¡æ¯å¾ˆå…¨ï¼Œ4å·çº¿ç¨‹æ˜¯é€ æˆå µå¡çš„ç½ªé­ç¥¸é¦–ã€‚è€Œå¹²æ‰è¿™ä¸ªç½ªé­ç¥¸é¦–çš„æ–¹å¼ï¼Œå°±æ˜¯KILL QUERY 4æˆ–KILL 4ã€‚</p><p>ä¸è¿‡ï¼Œè¿™é‡Œä¸åº”è¯¥æ˜¾ç¤ºâ€œKILL QUERY 4â€ã€‚è¿™ä¸ªå‘½ä»¤è¡¨ç¤ºåœæ­¢4å·çº¿ç¨‹å½“å‰æ­£åœ¨æ‰§è¡Œçš„è¯­å¥ï¼Œè€Œè¿™ä¸ªæ–¹æ³•å…¶å®æ˜¯æ²¡æœ‰ç”¨çš„ã€‚å› ä¸ºå æœ‰è¡Œé”çš„æ˜¯updateè¯­å¥ï¼Œè¿™ä¸ªè¯­å¥å·²ç»æ˜¯ä¹‹å‰æ‰§è¡Œå®Œæˆäº†çš„ï¼Œç°åœ¨æ‰§è¡ŒKILL QUERYï¼Œæ— æ³•è®©è¿™ä¸ªäº‹åŠ¡å»æ‰id=1ä¸Šçš„è¡Œé”ã€‚</p><p>å®é™…ä¸Šï¼ŒKILL 4æ‰æœ‰æ•ˆï¼Œä¹Ÿå°±æ˜¯è¯´ç›´æ¥æ–­å¼€è¿™ä¸ªè¿æ¥ã€‚è¿™é‡Œéšå«çš„ä¸€ä¸ªé€»è¾‘å°±æ˜¯ï¼Œè¿æ¥è¢«æ–­å¼€çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨å›æ»šè¿™ä¸ªè¿æ¥é‡Œé¢æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œä¹Ÿå°±é‡Šæ”¾äº†id=1ä¸Šçš„è¡Œé”ã€‚</p><h1>ç¬¬äºŒç±»ï¼šæŸ¥è¯¢æ…¢</h1><p>ç»è¿‡äº†é‡é‡å°â€œé”â€ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹ä¸€äº›æŸ¥è¯¢æ…¢çš„ä¾‹å­ã€‚</p><p>å…ˆæ¥çœ‹ä¸€æ¡ä½ ä¸€å®šçŸ¥é“åŸå› çš„SQLè¯­å¥ï¼š</p><pre><code>mysql&gt; select * from t where c=50000 limit 1;\n</code></pre><p>ç”±äºå­—æ®µcä¸Šæ²¡æœ‰ç´¢å¼•ï¼Œè¿™ä¸ªè¯­å¥åªèƒ½èµ°idä¸»é”®é¡ºåºæ‰«æï¼Œå› æ­¤éœ€è¦æ‰«æ5ä¸‡è¡Œã€‚</p><p>ä½œä¸ºç¡®è®¤ï¼Œä½ å¯ä»¥çœ‹ä¸€ä¸‹æ…¢æŸ¥è¯¢æ—¥å¿—ã€‚æ³¨æ„ï¼Œè¿™é‡Œä¸ºäº†æŠŠæ‰€æœ‰è¯­å¥è®°å½•åˆ°slow logé‡Œï¼Œæˆ‘åœ¨è¿æ¥åå…ˆæ‰§è¡Œäº† set long_query_time=0ï¼Œå°†æ…¢æŸ¥è¯¢æ—¥å¿—çš„æ—¶é—´é˜ˆå€¼è®¾ç½®ä¸º0ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/d8/3c/d8b2b5f97c60ae4fc4a03c616847503c.png?wh=873*88\" alt=\"\"></p><center><span class=\"reference\">å›¾11 å…¨è¡¨æ‰«æ5ä¸‡è¡Œçš„slow log</span></center><p>Rows_examinedæ˜¾ç¤ºæ‰«æäº†50000è¡Œã€‚ä½ å¯èƒ½ä¼šè¯´ï¼Œä¸æ˜¯å¾ˆæ…¢å‘€ï¼Œ11.5æ¯«ç§’å°±è¿”å›äº†ï¼Œæˆ‘ä»¬çº¿ä¸Šä¸€èˆ¬éƒ½é…ç½®è¶…è¿‡1ç§’æ‰ç®—æ…¢æŸ¥è¯¢ã€‚ä½†ä½ è¦è®°ä½ï¼š<strong>åæŸ¥è¯¢ä¸ä¸€å®šæ˜¯æ…¢æŸ¥è¯¢</strong>ã€‚æˆ‘ä»¬è¿™ä¸ªä¾‹å­é‡Œé¢åªæœ‰10ä¸‡è¡Œè®°å½•ï¼Œæ•°æ®é‡å¤§èµ·æ¥çš„è¯ï¼Œæ‰§è¡Œæ—¶é—´å°±çº¿æ€§æ¶¨ä¸Šå»äº†ã€‚</p><p>æ‰«æè¡Œæ•°å¤šï¼Œæ‰€ä»¥æ‰§è¡Œæ…¢ï¼Œè¿™ä¸ªå¾ˆå¥½ç†è§£ã€‚</p><p>ä½†æ˜¯æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å†çœ‹ä¸€ä¸ªåªæ‰«æä¸€è¡Œï¼Œä½†æ˜¯æ‰§è¡Œå¾ˆæ…¢çš„è¯­å¥ã€‚</p><p>å¦‚å›¾12æ‰€ç¤ºï¼Œæ˜¯è¿™ä¸ªä¾‹å­çš„slow logã€‚å¯ä»¥çœ‹åˆ°ï¼Œæ‰§è¡Œçš„è¯­å¥æ˜¯</p><pre><code>mysql&gt; select * from t where id=1ï¼›\n</code></pre><p>è™½ç„¶æ‰«æè¡Œæ•°æ˜¯1ï¼Œä½†æ‰§è¡Œæ—¶é—´å´é•¿è¾¾800æ¯«ç§’ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/66/46/66f26bb885401e8e460451ff6b0c0746.png?wh=831*74\" alt=\"\"></p><center><span class=\"reference\">å›¾12 æ‰«æä¸€è¡Œå´æ‰§è¡Œå¾—å¾ˆæ…¢</span></center><p>æ˜¯ä¸æ˜¯æœ‰ç‚¹å¥‡æ€ªå‘¢ï¼Œè¿™äº›æ—¶é—´éƒ½èŠ±åœ¨å“ªé‡Œäº†ï¼Ÿ</p><p>å¦‚æœæˆ‘æŠŠè¿™ä¸ªslow logçš„æˆªå›¾å†å¾€ä¸‹æ‹‰ä¸€ç‚¹ï¼Œä½ å¯ä»¥çœ‹åˆ°ä¸‹ä¸€ä¸ªè¯­å¥ï¼Œselect * from t where id=1 lock in share modeï¼Œæ‰§è¡Œæ—¶æ‰«æè¡Œæ•°ä¹Ÿæ˜¯1è¡Œï¼Œæ‰§è¡Œæ—¶é—´æ˜¯0.2æ¯«ç§’ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/bd/d2/bde83e269d9fa185b27900c8aa8137d2.png?wh=832*73\" alt=\"\"></p><center><span class=\"reference\">å›¾ 13 åŠ ä¸Šlock in share modeçš„slow log</span></center><p>çœ‹ä¸Šå»æ˜¯ä¸æ˜¯æ›´å¥‡æ€ªäº†ï¼ŸæŒ‰ç†è¯´lock in share modeè¿˜è¦åŠ é”ï¼Œæ—¶é—´åº”è¯¥æ›´é•¿æ‰å¯¹å•Šã€‚</p><p>å¯èƒ½æœ‰çš„åŒå­¦å·²ç»æœ‰ç­”æ¡ˆäº†ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰ç­”æ¡ˆçš„è¯ï¼Œæˆ‘å†ç»™ä½ ä¸€ä¸ªæç¤ºä¿¡æ¯ï¼Œå›¾14æ˜¯è¿™ä¸¤ä¸ªè¯­å¥çš„æ‰§è¡Œè¾“å‡ºç»“æœã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/1f/1c/1fbb84bb392b6bfa93786fe032690b1c.png?wh=595*353\" alt=\"\"></p><center><span class=\"reference\">å›¾14 ä¸¤ä¸ªè¯­å¥çš„è¾“å‡ºç»“æœ</span></center><p>ç¬¬ä¸€ä¸ªè¯­å¥çš„æŸ¥è¯¢ç»“æœé‡Œc=1ï¼Œå¸¦lock in share modeçš„è¯­å¥è¿”å›çš„æ˜¯c=1000001ã€‚çœ‹åˆ°è¿™é‡Œåº”è¯¥æœ‰æ›´å¤šçš„åŒå­¦çŸ¥é“åŸå› äº†ã€‚å¦‚æœä½ è¿˜æ˜¯æ²¡æœ‰å¤´ç»ªçš„è¯ï¼Œä¹Ÿåˆ«ç€æ€¥ã€‚æˆ‘å…ˆè·Ÿä½ è¯´æ˜ä¸€ä¸‹å¤ç°æ­¥éª¤ï¼Œå†åˆ†æåŸå› ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/84/ff/84667a3449dc846e393142600ee7a2ff.png?wh=936*322\" alt=\"\"></p><center><span class=\"reference\">å›¾15 å¤ç°æ­¥éª¤</span></center><p>ä½ çœ‹åˆ°äº†ï¼Œsession Aå…ˆç”¨start transaction with consistent snapshotå‘½ä»¤å¯åŠ¨äº†ä¸€ä¸ªäº‹åŠ¡ï¼Œä¹‹åsession Bæ‰å¼€å§‹æ‰§è¡Œupdate è¯­å¥ã€‚</p><p>session Bæ‰§è¡Œå®Œ100ä¸‡æ¬¡updateè¯­å¥åï¼Œid=1è¿™ä¸€è¡Œå¤„äºä»€ä¹ˆçŠ¶æ€å‘¢ï¼Ÿä½ å¯ä»¥ä»å›¾16ä¸­æ‰¾åˆ°ç­”æ¡ˆã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/46/8c/46bb9f5e27854678bfcaeaf0c3b8a98c.png?wh=1142*856\" alt=\"\"></p><center><span class=\"reference\">å›¾16 id=1çš„æ•°æ®çŠ¶æ€</span></center><p>session Bæ›´æ–°å®Œ100ä¸‡æ¬¡ï¼Œç”Ÿæˆäº†100ä¸‡ä¸ªå›æ»šæ—¥å¿—(undo log)ã€‚</p><p>å¸¦lock in share modeçš„SQLè¯­å¥ï¼Œæ˜¯å½“å‰è¯»ï¼Œå› æ­¤ä¼šç›´æ¥è¯»åˆ°1000001è¿™ä¸ªç»“æœï¼Œæ‰€ä»¥é€Ÿåº¦å¾ˆå¿«ï¼›è€Œselect * from t where id=1è¿™ä¸ªè¯­å¥ï¼Œæ˜¯ä¸€è‡´æ€§è¯»ï¼Œå› æ­¤éœ€è¦ä»1000001å¼€å§‹ï¼Œä¾æ¬¡æ‰§è¡Œundo logï¼Œæ‰§è¡Œäº†100ä¸‡æ¬¡ä»¥åï¼Œæ‰å°†1è¿™ä¸ªç»“æœè¿”å›ã€‚</p><p>æ³¨æ„ï¼Œundo logé‡Œè®°å½•çš„å…¶å®æ˜¯â€œæŠŠ2æ”¹æˆ1â€ï¼Œâ€œæŠŠ3æ”¹æˆ2â€è¿™æ ·çš„æ“ä½œé€»è¾‘ï¼Œç”»æˆå‡1çš„ç›®çš„æ˜¯æ–¹ä¾¿ä½ çœ‹å›¾ã€‚</p><h1>å°ç»“</h1><p>ä»Šå¤©æˆ‘ç»™ä½ ä¸¾äº†åœ¨ä¸€ä¸ªç®€å•çš„è¡¨ä¸Šï¼Œæ‰§è¡Œâ€œæŸ¥ä¸€è¡Œâ€ï¼Œå¯èƒ½ä¼šå‡ºç°çš„è¢«é”ä½å’Œæ‰§è¡Œæ…¢çš„ä¾‹å­ã€‚è¿™å…¶ä¸­æ¶‰åŠåˆ°äº†è¡¨é”ã€è¡Œé”å’Œä¸€è‡´æ€§è¯»çš„æ¦‚å¿µã€‚</p><p>åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œç¢°åˆ°çš„åœºæ™¯ä¼šæ›´å¤æ‚ã€‚ä½†å¤§åŒå°å¼‚ï¼Œä½ å¯ä»¥æŒ‰ç…§æˆ‘åœ¨æ–‡ç« ä¸­ä»‹ç»çš„å®šä½æ–¹æ³•ï¼Œæ¥å®šä½å¹¶è§£å†³é—®é¢˜ã€‚</p><p>æœ€åï¼Œæˆ‘ç»™ä½ ç•™ä¸€ä¸ªé—®é¢˜å§ã€‚</p><p>æˆ‘ä»¬åœ¨ä¸¾ä¾‹åŠ é”è¯»çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯è¿™ä¸ªè¯­å¥ï¼Œselect * from t where id=1 lock in share modeã€‚ç”±äºidä¸Šæœ‰ç´¢å¼•ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥å®šä½åˆ°id=1è¿™ä¸€è¡Œï¼Œå› æ­¤è¯»é”ä¹Ÿæ˜¯åªåŠ åœ¨äº†è¿™ä¸€è¡Œä¸Šã€‚</p><p>ä½†å¦‚æœæ˜¯ä¸‹é¢çš„SQLè¯­å¥ï¼Œ</p><pre><code>begin;\nselect * from t where c=5 for update;\ncommit;\n</code></pre><p>è¿™ä¸ªè¯­å¥åºåˆ—æ˜¯æ€ä¹ˆåŠ é”çš„å‘¢ï¼ŸåŠ çš„é”åˆæ˜¯ä»€ä¹ˆæ—¶å€™é‡Šæ”¾å‘¢ï¼Ÿ</p><p>ä½ å¯ä»¥æŠŠä½ çš„è§‚ç‚¹å’ŒéªŒè¯æ–¹æ³•å†™åœ¨ç•™è¨€åŒºé‡Œï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€ç¯‡æ–‡ç« çš„æœ«å°¾ç»™å‡ºæˆ‘çš„å‚è€ƒç­”æ¡ˆã€‚æ„Ÿè°¢ä½ çš„æ”¶å¬ï¼Œä¹Ÿæ¬¢è¿ä½ æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚</p><h1>ä¸ŠæœŸé—®é¢˜æ—¶é—´</h1><p>åœ¨ä¸Šä¸€ç¯‡æ–‡ç« æœ€åï¼Œæˆ‘ç•™ç»™ä½ çš„é—®é¢˜æ˜¯ï¼Œå¸Œæœ›ä½ å¯ä»¥åˆ†äº«ä¸€ä¸‹ä¹‹å‰ç¢°åˆ°è¿‡çš„ã€ä¸æ–‡ç« ä¸­ç±»ä¼¼çš„åœºæ™¯ã€‚</p><p>@å°å»ºçš„é£ æåˆ°ä¸€ä¸ªæœ‰è¶£çš„åœºæ™¯ï¼Œå€¼å¾—ä¸€è¯´ã€‚æˆ‘æŠŠä»–çš„é—®é¢˜é‡å†™ä¸€ä¸‹ï¼Œè¡¨ç»“æ„å¦‚ä¸‹ï¼š</p><pre><code>mysql&gt; CREATE TABLE `table_a` (\n  `id` int(11) NOT NULL,\n  `b` varchar(10) DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  KEY `b` (`b`)\n) ENGINE=InnoDB;\n</code></pre><p>å‡è®¾ç°åœ¨è¡¨é‡Œé¢ï¼Œæœ‰100ä¸‡è¡Œæ•°æ®ï¼Œå…¶ä¸­æœ‰10ä¸‡è¡Œæ•°æ®çš„bçš„å€¼æ˜¯â€™1234567890â€™ï¼Œ å‡è®¾ç°åœ¨æ‰§è¡Œè¯­å¥æ˜¯è¿™ä¹ˆå†™çš„:</p><pre><code>mysql&gt; select * from table_a where b='1234567890abcd';\n</code></pre><p>è¿™æ—¶å€™ï¼ŒMySQLä¼šæ€ä¹ˆæ‰§è¡Œå‘¢ï¼Ÿ</p><p>æœ€ç†æƒ³çš„æƒ…å†µæ˜¯ï¼ŒMySQLçœ‹åˆ°å­—æ®µbå®šä¹‰çš„æ˜¯varchar(10)ï¼Œé‚£è‚¯å®šè¿”å›ç©ºå‘€ã€‚å¯æƒœï¼ŒMySQLå¹¶æ²¡æœ‰è¿™ä¹ˆåšã€‚</p><p>é‚£è¦ä¸ï¼Œå°±æ˜¯æŠŠâ€™1234567890abcdâ€™æ‹¿åˆ°ç´¢å¼•é‡Œé¢å»åšåŒ¹é…ï¼Œè‚¯å®šä¹Ÿæ²¡èƒ½å¤Ÿå¿«é€Ÿåˆ¤æ–­å‡ºç´¢å¼•æ ‘bä¸Šå¹¶æ²¡æœ‰è¿™ä¸ªå€¼ï¼Œä¹Ÿå¾ˆå¿«å°±èƒ½è¿”å›ç©ºç»“æœã€‚</p><p>ä½†å®é™…ä¸Šï¼ŒMySQLä¹Ÿä¸æ˜¯è¿™ä¹ˆåšçš„ã€‚</p><p>è¿™æ¡SQLè¯­å¥çš„æ‰§è¡Œå¾ˆæ…¢ï¼Œæµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><ol>\n<li>\n<p>åœ¨ä¼ ç»™å¼•æ“æ‰§è¡Œçš„æ—¶å€™ï¼Œåšäº†å­—ç¬¦æˆªæ–­ã€‚å› ä¸ºå¼•æ“é‡Œé¢è¿™ä¸ªè¡Œåªå®šä¹‰äº†é•¿åº¦æ˜¯10ï¼Œæ‰€ä»¥åªæˆªäº†å‰10ä¸ªå­—èŠ‚ï¼Œå°±æ˜¯â€™1234567890â€™è¿›å»åšåŒ¹é…ï¼›</p>\n</li>\n<li>\n<p>è¿™æ ·æ»¡è¶³æ¡ä»¶çš„æ•°æ®æœ‰10ä¸‡è¡Œï¼›</p>\n</li>\n<li>\n<p>å› ä¸ºæ˜¯select *ï¼Œ æ‰€ä»¥è¦åš10ä¸‡æ¬¡å›è¡¨ï¼›</p>\n</li>\n<li>\n<p>ä½†æ˜¯æ¯æ¬¡å›è¡¨ä»¥åæŸ¥å‡ºæ•´è¡Œï¼Œåˆ°serverå±‚ä¸€åˆ¤æ–­ï¼Œbçš„å€¼éƒ½ä¸æ˜¯â€™1234567890abcdâ€™;</p>\n</li>\n<li>\n<p>è¿”å›ç»“æœæ˜¯ç©ºã€‚</p>\n</li>\n</ol><p>è¿™ä¸ªä¾‹å­ï¼Œæ˜¯æˆ‘ä»¬æ–‡ç« å†…å®¹çš„ä¸€ä¸ªå¾ˆå¥½çš„è¡¥å……ã€‚è™½ç„¶æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½ç»è¿‡å‡½æ•°æ“ä½œï¼Œä½†æ˜¯æœ€ç»ˆåœ¨æ‹¿åˆ°ç»“æœåï¼Œserverå±‚è¿˜æ˜¯è¦åšä¸€è½®åˆ¤æ–­çš„ã€‚</p><p>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š</p><blockquote>\n<p>@èµ–é˜¿ç”˜ æåˆ°äº†ç­‰å·é¡ºåºé—®é¢˜ï¼Œå®é™…ä¸ŠMySQLä¼˜åŒ–å™¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œwhere æ¡ä»¶éƒ¨åˆ†ï¼Œ a=bå’Œ b=açš„å†™æ³•æ˜¯ä¸€æ ·çš„ã€‚<br>\n@æ²™æ¼ é‡Œçš„éª†é©¼ æåˆ°äº†ä¸€ä¸ªå¸¸è§çš„é—®é¢˜ã€‚ç›¸åŒçš„æ¨¡æ¿è¯­å¥ï¼Œä½†æ˜¯åŒ¹é…è¡Œæ•°ä¸åŒï¼Œè¯­å¥æ‰§è¡Œæ—¶é—´ç›¸å·®å¾ˆå¤§ã€‚è¿™ç§æƒ…å†µï¼Œåœ¨è¯­å¥é‡Œé¢æœ‰order byè¿™æ ·çš„æ“ä½œæ—¶ä¼šæ›´æ˜æ˜¾ã€‚<br>\n@Justin å›ç­”äº†æˆ‘ä»¬æ­£æ–‡ä¸­çš„é—®é¢˜ï¼Œå¦‚æœid çš„ç±»å‹æ˜¯æ•´æ•°ï¼Œä¼ å…¥çš„å‚æ•°ç±»å‹æ˜¯å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œå¯ä»¥ç”¨ä¸Šç´¢å¼•ã€‚</p>\n</blockquote>","comments":[{"had_liked":false,"id":54285,"user_name":"æŸã€äºº","can_delete":false,"product_type":"c1","uid":1308784,"ip_address":"","ucode":"ADB42AA12A11C1","user_header":"https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg","comment_is_top":false,"comment_ctime":1545820838,"is_pvip":false,"replies":[{"id":"19688","content":"åˆ†æå¾—éå¸¸å¥½ã€‚<br>ä¸¤ä¸ªæ¨¡å¼ä¸‹ï¼Œå„å¢åŠ ä¸€ä¸ªsession 4 : update t set c=100 where id=10çœ‹çœ‹å“¦<br><br>åŸºæœ¬å°±å…¨äº†ğŸ‘ğŸ¿","user_name":"ä½œè€…å›å¤","comment_id":54285,"uid":"1264162","ip_address":"","utype":1,"ctime":1545832467,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":19,"race_medal":0,"score":"787524836006","product_id":100020801,"comment_content":"æœ€è¿‘å‡ å¼ å¹²è´§è¶Šæ¥è¶Šå¤šäº†,å¾ˆå®ç”¨,æ”¶è·ä¸å°‘.å…ˆå›ç­”ä»Šå¤©çš„é—®é¢˜<br>ç‰ˆæœ¬5.7.13<br>rcæ¨¡å¼ä¸‹:<br>session 1:<br>begin;<br>select * from t where c=5 for update; <br>session 2:<br>delete from t where c=10 --ç­‰å¾…<br>session 3:<br>insert into t values(100001,8) --æˆåŠŸ<br>session 1:<br>commit<br>session 2:äº‹åŠ¡æ‰§è¡ŒæˆåŠŸ<br>rræ¨¡å¼ä¸‹:<br>begin;<br>select * from t where c=5 for update; <br>session 2:<br>delete from t where c=10 --ç­‰å¾…<br>session 3:<br>insert into t values(100001,8) --ç­‰å¾…<br>session 1:<br>commit<br>session 2:äº‹åŠ¡æ‰§è¡ŒæˆåŠŸ<br>session 3ï¼šäº‹åŠ¡æ‰§è¡ŒæˆåŠŸ<br>ä»ä¸Šé¢è¿™ä¸¤ä¸ªç®€å•çš„ä¾‹å­,å¯ä»¥å¤§æ¦‚çœ‹å‡ºä¸Šé”çš„æµç¨‹.<br>ä¸ç®¡æ˜¯rræ¨¡å¼è¿˜æ˜¯rcæ¨¡å¼,è¿™æ¡è¯­å¥éƒ½ä¼šå…ˆåœ¨serverå±‚å¯¹è¡¨åŠ ä¸ŠMDL Sé”,ç„¶åè¿›å…¥åˆ°å¼•æ“å±‚ã€‚<br><br>rcæ¨¡å¼ä¸‹,ç”±äºæ•°æ®é‡ä¸å¤§åªæœ‰10Wã€‚é€šè¿‡å®éªŒå¯ä»¥è¯æ˜session 1ä¸Šæ¥å°±æŠŠè¯¥è¡¨çš„æ‰€æœ‰è¡Œéƒ½é”ä½äº†ã€‚<br>å¯¼è‡´å…¶ä»–äº‹åŠ¡è¦å¯¹è¯¥è¡¨çš„æ‰€æœ‰ç°æœ‰è®°å½•åšæ›´æ–°,æ˜¯é˜»å¡çŠ¶æ€ã€‚ä¸ºä»€ä¹ˆinsertåˆèƒ½æˆåŠŸ?<br>è¯´æ˜rcæ¨¡å¼ä¸‹for updateè¯­å¥æ²¡æœ‰ä¸Šgapé”,æ‰€ä»¥ä¸é˜»å¡insertå¯¹èŒƒå›´åŠ æ’å…¥æ„å‘é”,æ‰€ä»¥æ›´æ–°æˆåŠŸã€‚<br>session 1commitå,session 2æ‰§è¡ŒæˆåŠŸã€‚è¡¨æ˜æ‰€æœ‰è¡Œçš„xé”æ˜¯åœ¨äº‹åŠ¡æäº¤å®Œæˆä»¥åæ‰é‡Šæ”¾ã€‚<br><br>rræ¨¡å¼ä¸‹,session 1å’Œsession 2ä¸rcæ¨¡å¼ä¸‹éƒ½ä¸€æ ·,è¯´æ˜rræ¨¡å¼ä¸‹ä¹Ÿå¯¹æ‰€æœ‰è¡Œä¸Šäº†Xé”ã€‚<br>å”¯ä¸€çš„åŒºåˆ«æ˜¯insertä¹Ÿç­‰å¾…äº†,æ˜¯å› ä¸ºrræ¨¡å¼ä¸‹å¯¹æ²¡æœ‰ç´¢å¼•çš„æ›´æ–°,èšç°‡ç´¢å¼•ä¸Šçš„æ‰€æœ‰è®°å½•ï¼Œéƒ½è¢«åŠ ä¸Šäº†Xé”ã€‚å…¶æ¬¡ï¼Œèšç°‡ç´¢å¼•æ¯æ¡è®°å½•é—´çš„é—´éš™(GAP)ï¼Œä¹ŸåŒæ—¶è¢«åŠ ä¸Šäº†GAPé”ã€‚ç”±äºgapé”é˜»å¡äº†insertè¦åŠ çš„æ’å…¥æ„å‘é”,å¯¼è‡´insertä¹Ÿå¤„äºç­‰å¾…çŠ¶æ€ã€‚åªæœ‰å½“session 1 commitå®Œæˆä»¥åã€‚session 1ä¸Šçš„æ‰€æœ‰é”æ‰ä¼šé‡Šæ”¾,S2,S3æ‰§è¡ŒæˆåŠŸ<br><br>ç”±äºä¾‹å­ä¸­çš„æ•°æ®é‡è¿˜æ¯”è¾ƒå°,å¦‚æœæ•°æ®é‡è¾¾åˆ°åƒä¸‡çº§åˆ«,å°±æ¯”è¾ƒç›´è§‚çš„èƒ½çœ‹å‡º,ä¸Šé”æ˜¯é€è¡Œä¸Šé”çš„ä¸€ä¸ªè¿‡ç¨‹.æ‰«æä¸€æ¡ä¸Šä¸€æ¡,ç›´åˆ°æ‰€æœ‰è¡Œæ‰«æå®Œ,rcæ¨¡å¼ä¸‹å¯¹æ‰€æœ‰è¡Œä¸Šxé”ã€‚rræ¨¡å¼ä¸‹ä¸ä»…å¯¹æ‰€æœ‰è¡Œä¸ŠXé”,è¿˜å¯¹æ‰€æœ‰åŒºé—´ä¸Šgapé”.ç›´åˆ°äº‹åŠ¡æäº¤æˆ–è€…å›æ»šå®Œæˆå,ä¸Šçš„é”æ‰ä¼šè¢«é‡Šæ”¾ã€‚","like_count":184,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434417,"discussion_content":"åˆ†æå¾—éå¸¸å¥½ã€‚\nä¸¤ä¸ªæ¨¡å¼ä¸‹ï¼Œå„å¢åŠ ä¸€ä¸ªsession 4 : update t set c=100 where id=10çœ‹çœ‹å“¦\n\nåŸºæœ¬å°±å…¨äº†ğŸ‘ğŸ¿","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545832467,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1304123,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e6/3b/6d68cb72.jpg","nickname":"é‚¹æ¶›","note":"","ucode":"B81FF267A59CE9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":193397,"discussion_content":"\nç‰ˆæœ¬ï¼šmysql 5.6.39\nCREATE TABLE `t` (\n  `a` int(11) NOT NULL,\n  `b` int(11) DEFAULT NULL\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\ninsert into t values(1,1),(2,2),(3,3),(4,4),(5,5);\né‡‡ç”¨READ-COMMITTEDéš”ç¦»çº§åˆ«\næ¡ˆä¾‹1ã€\nsession Aï¼š\nbegin;\nupdate t set a=6 where b=1;\nsession Bï¼š\nbegin;\nupdate t set a=7 where b=2;\nAå’ŒBå‡èƒ½æ‰§è¡ŒæˆåŠŸ\né—®é¢˜1ï¼šå®˜æ¡£ä¸Šè¯´å¯¹äºRCä¸”å…¨è¡¨æ‰«æçš„updateï¼Œå…ˆé€è¡Œæ·»åŠ è¡Œé”ç„¶åé‡Šæ”¾æ‰ä¸ç¬¦åˆwhereæ¡ä»¶çš„ï¼Œé‚£ä¹ˆsession AæˆåŠŸå¯¹(1,1)åŠ é”ï¼Œç†è®ºä¸Šsession Båœ¨æ‰«æ(1,1)å¹¶å°è¯•åŠ é”æ—¶ä¼šè¢«é˜»å¡ï¼Œä¸ºä½•è¿˜èƒ½æ‰§è¡ŒæˆåŠŸï¼Ÿå®˜æ¡£é“¾æ¥ï¼šhttps://dev.mysql.com/doc/refman/8.0/en/innodb-transaction-isolation-levels.html\n\næ¡ˆä¾‹2ï¼š\nsession Aï¼š\nbegin;\nupdate t set a=6 where b=1;\nsession Bï¼š\nbegin;\ndelete from t where b=2; -- è¢«é˜»å¡\né—®é¢˜2ï¼šä¸ºä½•æ¡ˆä¾‹1 ä¸­çš„session Bä¸ä¼šè¢«é˜»å¡ï¼Œè€Œæ¡ˆä¾‹2çš„å´è¢«session Açš„è¡Œæ•°é˜»å¡ï¼Œupdateå’Œdeleteéƒ½æ˜¯å…¨éƒ¨æ‰«æï¼Œéš¾é“åŠ é”æœºåˆ¶ä¸ä¸€æ ·ï¼Ÿ\n\nä½œè€…å›å¤:\nå¥½é—®é¢˜ï¼Œåœ¨read-commitedéš”ç¦»çº§åˆ«ä¸‹ï¼Œupdateè¯­å¥\næœ‰ä¸€ä¸ªâ€œsemi-consistentâ€ readä¼˜åŒ–ï¼Œ\n\næ„æ€æ˜¯ï¼Œå¦‚æœupdateè¯­å¥ç¢°åˆ°ä¸€ä¸ªå·²ç»è¢«é”äº†çš„è¡Œï¼Œä¼šè¯»å…¥æœ€æ–°çš„ç‰ˆæœ¬ï¼Œç„¶ååˆ¤æ–­ä¸€ä¸‹æ˜¯ä¸æ˜¯æ»¡è¶³æŸ¥è¯¢æ¡ä»¶ï¼Œ\na)å¦‚æœä¸æ»¡è¶³ï¼Œå°±ç›´æ¥è·³è¿‡ï¼›\nb) å¦‚æœæ»¡è¶³ï¼Œæ‰è¿›å…¥é”ç­‰å¾…\n\nä½ çš„ç¬¬äºŒä¸ªé—®é¢˜ï¼šè¿™ä¸ªç­–ç•¥ï¼Œåªå¯¹updateæœ‰æ•ˆï¼Œdeleteæ— æ•ˆ\n","likes_number":29,"is_delete":false,"is_hidden":false,"ctime":1583151147,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1254801,"avatar":"https://static001.geekbang.org/account/avatar/00/13/25/91/46600294.jpg","nickname":"çŒ´å“¥ä¸€ä¸€ cium","note":"","ucode":"38EC64F8D1A0B4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312862,"discussion_content":"æ³¨æ„ä¸€ä¸‹,å±‚ä¸»å¯¹RCæ¨¡å¼ä¸‹çš„ç»“è®ºæœ‰äº›é”™è¯¯,\nRCæ¨¡å¼ä¸‹çš„ select * from t where c=5 for update;\næœ€ç»ˆé”çš„åªæ˜¯c=5çš„record,ä¸æ˜¯å…¨è¡¨,\nå› ä¸ºRCä¸‹,åšäº†è¿‡æ»¤,æŠŠä¸ç¬¦åˆæ¡ä»¶çš„æ•°æ®è¿›è¡Œäº†è§£é”!\n\n1.delete æ‰§è¡Œæ—¶,ç”±äºæ‰«ææ•°æ®éœ€è¦è·å–è¡Œé”,é”å†²çª,æ‰€ä»¥é˜»å¡.\n2.è€Œ update t set c=c+1 where c = 10 ä¸ä¼šè¢«é˜»å¡,\nå› ä¸ºRCæ¨¡å¼ä¸‹,é’ˆå¯¹UPDATEæ“ä½œ,æœ‰ä¸ª &#34;semi-consistent&#34; readä¼˜åŒ–ï¼Œä¿è¯å…¶è¯»åˆ°æœ€æ–°æ•°æ®.\n\næŒºè¿·æƒ‘çš„,ç°åœ¨æœ‰äº†ç¡®åˆ‡çš„ç­”æ¡ˆ. \ndelete ä¸äº«å—&#34;semi-consistent&#34;å¾…é‡\n","likes_number":13,"is_delete":false,"is_hidden":false,"ctime":1602837020,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1543040,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/80/8702bd5f.jpg","nickname":"evan","note":"","ucode":"491B073D5AFEDE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1254801,"avatar":"https://static001.geekbang.org/account/avatar/00/13/25/91/46600294.jpg","nickname":"çŒ´å“¥ä¸€ä¸€ cium","note":"","ucode":"38EC64F8D1A0B4","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":319917,"discussion_content":"æˆ‘æµ‹è¯•æƒ…å†µæ˜¯rcä¸‹ &#34;update t set c=c+1 where c = 10 &#34; ä¹Ÿé˜»å¡äº†!","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1604194885,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":312862,"ip_address":""},"score":319917,"extra":""},{"author":{"id":2448277,"avatar":"https://static001.geekbang.org/account/avatar/00/25/5b/95/462890c6.jpg","nickname":"å¶æ¶›","note":"","ucode":"B45348979BE159","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1543040,"avatar":"https://static001.geekbang.org/account/avatar/00/17/8b/80/8702bd5f.jpg","nickname":"evan","note":"","ucode":"491B073D5AFEDE","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":367224,"discussion_content":"ä½ æµ‹è¯•çš„æœ‰é—®é¢˜","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618299545,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":319917,"ip_address":""},"score":367224,"extra":""}]},{"author":{"id":1691243,"avatar":"https://static001.geekbang.org/account/avatar/00/19/ce/6b/ae7489a0.jpg","nickname":"Ccc","note":"","ucode":"EAEA0284948959","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":81981,"discussion_content":"rcæ¨¡å¼ä¸‹äº‹åŠ¡Aä¼šå…ˆé”ä½è¡¨é‡Œçš„è¡Œï¼Œç„¶åè¯­å¥æ‰§è¡Œå®Œä¼šé‡Šæ”¾ä¸ç¬¦åˆæ¡ä»¶çš„é”ï¼Œæ‰€ä»¥æœ€ç»ˆäº‹åŠ¡Aåªé”ä½äº†(i=5,c=5)è¿™ä¸€è¡Œã€‚å¯ä»¥ç”¨session 5éªŒè¯:update t set c=100 where id=5;è¿™ä¸ªè¯­å¥å°±ä¼šè¢«é˜»å¡","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1576304469,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1788647,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/4a/e7/6c16af5d.jpg","nickname":"æ±‰æ±Ÿ","note":"","ucode":"01622D984B8F9B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":343828,"discussion_content":"RC éš”ç¦»çº§åˆ«ä¸‹ mysql ç‰ˆæœ¬ 5.7.19 \nupdate t set c= c-1 where c =5 ä¸ update t set c= c-1 where c =6 ä¸é˜»å¡\nupdate t set c= c-1 where c =5 ä¸ delete from  t  where c =6 é˜»å¡\nselect * from t  where c =5 for update ä¸ update t set c= c-1 where c =6  ä¸é˜»å¡\nselect * from t  where c =5 for update ä¸ delete from  t  where c =6 é˜»å¡","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1611192565,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1308784,"avatar":"https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg","nickname":"æŸã€äºº","note":"","ucode":"ADB42AA12A11C1","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1788647,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/4a/e7/6c16af5d.jpg","nickname":"æ±‰æ±Ÿ","note":"","ucode":"01622D984B8F9B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344048,"discussion_content":"çœ‹è¯„è®ºä¸‹é¢çš„è§£ç­”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611264963,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":343828,"ip_address":""},"score":344048,"extra":""}]},{"author":{"id":1287774,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a6/5e/b05254a6.jpg","nickname":"Mhy","note":"","ucode":"DE19BCAD1F856E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4836,"discussion_content":"è¯·é—®åœ¨RCéš”ç¦»çº§åˆ«ä¸‹è€å¸ˆçš„session 4 : update t set c=100 where id=10è¿™ä¸ªSQLä¸ä¼šè¢«é˜»å¡çš„åŸå› æ˜¯ä»€ä¹ˆï¼ŒæŒ‰ç†è¯´å·²ç»è¢«äº‹åŠ¡Açš„è¡Œé”é”ä½äº†æ‰€æœ‰è¡Œ","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1565763931,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1357623,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJJmBKrLvqOIXDDbj3ocEIJzqsQx2e5VLDBSX6LmofYtprWwKaVAmHUqU2z3mjREHX8n9eLLiavlPg/132","nickname":"wg1993","note":"","ucode":"D5112FEFDB1DF7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1287774,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a6/5e/b05254a6.jpg","nickname":"Mhy","note":"","ucode":"DE19BCAD1F856E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":89070,"discussion_content":"mysqlåœ¨å®é™…æ‰§è¡Œè¿‡ç¨‹ä¸­serverå…¶å®è¿˜æ˜¯ä¼šè¿‡æ»¤çš„ï¼Œå¦‚æœä¸æ»¡è¶³é”çš„æ¡ä»¶ä¼šè°ƒç”¨unlock_rowæ–¹æ³•é‡Šæ”¾é”","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1576748585,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":4836,"ip_address":""},"score":89070,"extra":""},{"author":{"id":1257046,"avatar":"https://static001.geekbang.org/account/avatar/00/13/2e/56/aa3690ef.jpg","nickname":"äº‘äº‘","note":"","ucode":"1A08803F6EBD33","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1287774,"avatar":"https://static001.geekbang.org/account/avatar/00/13/a6/5e/b05254a6.jpg","nickname":"Mhy","note":"","ucode":"DE19BCAD1F856E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":103761,"discussion_content":"RRæ¨¡å¼ä¸‹ï¼ŒFor a unique index with a unique search condition, InnoDB locks only the index record found, not the gap before it. \nRCæ¨¡å¼ä¸‹ï¼ŒFor UPDATE or DELETE statements, InnoDB holds locks only for rows that it updates or deletes. Record locks for nonmatching rows are released after MySQL has evaluated the WHERE condition. This greatly reduces the probability of deadlocks, but they can still happen.","likes_number":12,"is_delete":false,"is_hidden":false,"ctime":1577376685,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":4836,"ip_address":""},"score":103761,"extra":""}]},{"author":{"id":2925869,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/a5/2d/dce6f248.jpg","nickname":"é£ä¸­å‘Šé€€","note":"","ucode":"6D157E902BECEA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554059,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646203426,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1322625,"avatar":"https://static001.geekbang.org/account/avatar/00/14/2e/81/1efeeb75.jpg","nickname":"winniewhwh","note":"","ucode":"0ED96152857B09","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":389538,"discussion_content":"æ•°æ®åº“æ“çºµè¯­è¨€æ˜¯DMLä¸æ˜¯MDL","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1629331574,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1668117,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJLgibqHsl97Oq3nvnEVz7V3kaGKLmia0Ja8c4yXO7QeLKiakganRJomNGgYToW4RnFs60zibDTHicjE5w/132","nickname":"å­¦è€Œä¸æ€åˆ™æƒ˜","note":"","ucode":"8ED2B08AA5A755","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1322625,"avatar":"https://static001.geekbang.org/account/avatar/00/14/2e/81/1efeeb75.jpg","nickname":"winniewhwh","note":"","ucode":"0ED96152857B09","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":391253,"discussion_content":"è¿™å†™çš„æ˜¯mdlè¯»é”ï¼Œä½ çœ‹çš„æ˜¯å•¥ã€‚ã€‚","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1630372561,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":389538,"ip_address":""},"score":391253,"extra":""}]},{"author":{"id":2278559,"avatar":"https://static001.geekbang.org/account/avatar/00/22/c4/9f/a01e4bd1.jpg","nickname":"æµ·æµª","note":"","ucode":"091941B3556B4B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":327412,"discussion_content":"èšç°‡ç´¢å¼•æ€ä¹ˆä¼šåŠ gapé”å‘¢ã€‚ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605832976,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2278559,"avatar":"https://static001.geekbang.org/account/avatar/00/22/c4/9f/a01e4bd1.jpg","nickname":"æµ·æµª","note":"","ucode":"091941B3556B4B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":327409,"discussion_content":"insertä¸æ˜¯ç›´æ¥åŠ æ’å…¥æ„å‘é”â€”â€”è€Œæ˜¯insertå‰ï¼Œåˆ¤æ–­å¦‚æœç°æœ‰é”ä¸ä¸æ’å…¥æ„å‘é”å†²çªçš„æƒ…å†µä¸‹ï¼Œæ˜¯ç›´æ¥å†™çš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1605832556,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1304123,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e6/3b/6d68cb72.jpg","nickname":"é‚¹æ¶›","note":"","ucode":"B81FF267A59CE9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":193184,"discussion_content":"ä½ å¥½ï¼Œ \nRCæ¨¡å¼ä¸‹ï¼Œæ·»åŠ æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š\nsession 5 ï¼š\nupdate t set c=200 where c=20 --æˆåŠŸã€‚ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿä¸ºå•¥è¿™ä¸ªèƒ½æˆåŠŸï¼Ÿï¼Ÿï¼Ÿï¼Ÿ \nè€Œä¸Šè¿°session 2:\ndelete from t where c=10 --ç­‰å¾… \nä¸ªäººç†è§£ï¼šè¿™ä¸¤ä¸ªç”±äºcæ²¡ç´¢å¼•ï¼Œæ‰€ä»¥è¦å…¨è¡¨æ‰«æï¼Œç”±äºselect * from t where c=5 for update;  è¿™è¡Œè¢«é”ä½ï¼Œæ‰€ä»¥åªèƒ½ç­‰å¾…ï¼ŒæŒ‰ç†è¯´session5 è·Ÿsession2æ˜¯ä¸€æ ·çš„ç»“æœéœ€ç­‰å¾…å•Šã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583134981,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1541014,"avatar":"https://static001.geekbang.org/account/avatar/00/17/83/96/73ff13a0.jpg","nickname":"å¤©äº®å‰è¯´æ™šå®‰","note":"","ucode":"1D82EE562A7C71","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":162186,"discussion_content":"è¿™é‡Œå…ƒæ•°æ®é”ä¸ä¼šé€ æˆç­‰å¾…å•Šï¼Œå…ƒæ•°æ®é”åªæœ‰ä¿®æ”¹è¡¨ç»“æ„çš„æ—¶å€™æ‰ä¼šå®Œæˆé˜»å¡å§ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580970213,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":3,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1335293,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKR3ibELhjgVicCNShZCBwvaDxibnzibggG4wUzVkS2mkDxUBZyIs87nDEdJ7PiahJBVoZcuhQ84RxAziag/132","nickname":"å‘¨æ²»æ…§","note":"","ucode":"7D56C4E66BEE17","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1541014,"avatar":"https://static001.geekbang.org/account/avatar/00/17/83/96/73ff13a0.jpg","nickname":"å¤©äº®å‰è¯´æ™šå®‰","note":"","ucode":"1D82EE562A7C71","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":194085,"discussion_content":"ä¸ä¼šé€ æˆé”ç­‰å¾…,DDLå’ŒDMLä¹‹é—´åˆ†åˆ«æ˜¯MDLçš„å†™é”å’ŒMDLçš„è¯»é”,æ‰€ä»¥è¡¨çº§åˆ«ä¸Šçš„éšå£«é”ä»¥ä¸Šåˆ—å­æ˜¯ä¸ä¼šäº’æ–¥çš„å› ä¸ºéƒ½æ˜¯æ‰§è¡ŒDMLè¯­å¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583189420,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":162186,"ip_address":""},"score":194085,"extra":""}]}]},{"had_liked":false,"id":54435,"user_name":"å¼ æ°¸å¿—","can_delete":false,"product_type":"c1","uid":1208727,"ip_address":"","ucode":"E54B75EF3F63B3","user_header":"https://static001.geekbang.org/account/avatar/00/12/71/97/f1a3d398.jpg","comment_is_top":false,"comment_ctime":1545870464,"is_pvip":false,"replies":[{"id":"19748","content":"å‡†ç¡®","user_name":"ä½œè€…å›å¤","comment_id":54435,"uid":"1264162","ip_address":"","utype":1,"ctime":1545875376,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":6,"race_medal":0,"score":"469697305728","product_id":100020801,"comment_content":"RRéš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸ºä¿è¯binlogè®°å½•é¡ºåºï¼Œéç´¢å¼•æ›´æ–°ä¼šé”ä½å…¨è¡¨è®°å½•ï¼Œä¸”äº‹åŠ¡ç»“æŸå‰ä¸ä¼šå¯¹ä¸ç¬¦åˆæ¡ä»¶è®°å½•æœ‰é€æ­¥é‡Šæ”¾çš„è¿‡ç¨‹ã€‚","like_count":110,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434454,"discussion_content":"å‡†ç¡®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545875376,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1788647,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/4a/e7/6c16af5d.jpg","nickname":"æ±‰æ±Ÿ","note":"","ucode":"01622D984B8F9B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344187,"discussion_content":"ä¿è¯binlogè®°å½•é¡ºåºï¼Œç„¶åå‘¢ï¼Ÿ RCçº§åˆ«ä¸‹éš¾é“å°±ä¸éœ€è¦ä¿è¯binlogè®°å½•é¡ºåºï¼Œä¸æ˜¯å¾ˆæ‡‚","likes_number":7,"is_delete":false,"is_hidden":false,"ctime":1611318565,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":3007210,"avatar":"","nickname":"Geek_a1699c","note":"","ucode":"CF7DB00BE36B77","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1788647,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/4a/e7/6c16af5d.jpg","nickname":"æ±‰æ±Ÿ","note":"","ucode":"01622D984B8F9B","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576108,"discussion_content":"https://www.hollischuang.com/archives/6427?spm=a2c6h.12873639.article-detail.4.a601addch9qNlF","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1655280228,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":344187,"ip_address":""},"score":576108,"extra":""}]},{"author":{"id":2497728,"avatar":"https://static001.geekbang.org/account/avatar/00/26/1c/c0/b8ff566a.jpg","nickname":"æˆ‘æ˜¯å¤§æ©™å­132","note":"","ucode":"61660568CF07C9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":564593,"discussion_content":"ä¸»è¦è¿˜æ˜¯ä¿è¯å¯é‡å¤è¯»ï¼Œè§£å†³å¹»è¯»é—®é¢˜å§ï¼Ÿä¿è¯statementçš„binlogé¡ºåºæ˜¯â€é¡ºå¸¦â€œå¥½å¤„å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650286232,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":3007210,"avatar":"","nickname":"Geek_a1699c","note":"","ucode":"CF7DB00BE36B77","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2497728,"avatar":"https://static001.geekbang.org/account/avatar/00/26/1c/c0/b8ff566a.jpg","nickname":"æˆ‘æ˜¯å¤§æ©™å­132","note":"","ucode":"61660568CF07C9","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":576107,"discussion_content":"RRä¹Ÿè§£å†³ä¸äº†å¹»è¯»å•Šã€‚ã€‚ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1655280160,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":564593,"ip_address":""},"score":576107,"extra":""},{"author":{"id":1780797,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/2c/3d/0bd58aa4.jpg","nickname":"Em","note":"","ucode":"32012A5C603C8A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":3007210,"avatar":"","nickname":"Geek_a1699c","note":"","ucode":"CF7DB00BE36B77","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577426,"discussion_content":"rrå°±æ˜¯è§£å†³äº†å¹»è¯»......","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656090294,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":576107,"ip_address":""},"score":577426,"extra":""}]}]},{"had_liked":false,"id":54002,"user_name":"è–›ç•…","can_delete":false,"product_type":"c1","uid":1307437,"ip_address":"","ucode":"1B665F467169F3","user_header":"https://static001.geekbang.org/account/avatar/00/13/f3/2d/711d73b2.jpg","comment_is_top":false,"comment_ctime":1545785290,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"250653888458","product_id":100020801,"comment_content":"å›æ¥è€å¸ˆçš„é—®é¢˜ï¼š<br>åœ¨ Read Committed éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¼šé”ä¸Šèšç°‡ç´¢å¼•ä¸­çš„æ‰€æœ‰è®°å½•ï¼›<br>åœ¨ Repeatable Read éš”ç¦»çº§åˆ«ä¸‹ï¼Œä¼šé”ä¸Šèšç°‡ç´¢å¼•ä¸­çš„æ‰€æœ‰è®°å½•ï¼Œå¹¶ä¸”ä¼šé”ä¸Šèšç°‡ç´¢å¼•å†…çš„æ‰€æœ‰ GAPï¼›<br>åœ¨ä¸Šé¢ä¸¤ä¸ªéš”ç¦»çº§åˆ«çš„æƒ…å†µä¸‹ï¼Œå¦‚æœè®¾ç½®äº† innodb_locks_unsafe_for_binlog å¼€å¯ semi-consistent read çš„è¯ï¼Œå¯¹äºä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶çš„è®°å½•ï¼ŒMySQL ä¼šæå‰æ”¾é”ï¼Œä¸è¿‡åŠ é”çš„è¿‡ç¨‹æ˜¯ä¸å¯é¿å…çš„ã€‚","like_count":59,"discussions":[{"author":{"id":1304123,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e6/3b/6d68cb72.jpg","nickname":"é‚¹æ¶›","note":"","ucode":"B81FF267A59CE9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":193231,"discussion_content":"innodb_locks_unsafe_for_binlog Â åº”è¯¥åªåœ¨RRæ¨¡å¼ä¸‹æœ‰ç”¨ï¼ŒRCæ¨¡å¼ä¸‹serverå±‚ä¼šæœ‰ä¸ªç±»ä¼¼åˆ¤æ–­è§£é”åŠ¨ä½œã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1583139728,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1813207,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/aa/d7/a417ad5b.jpg","nickname":"CharAt","note":"","ucode":"D7D44B48FC4E79","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381187,"discussion_content":"RRæ¨¡å‹ä¸‹æ˜¯ä¸€ä¸‹å…¨éƒ¨é”ï¼Ÿè¿˜æ˜¯é€è¡Œæ‰«æé€è¡ŒåŠ é”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624946648,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54097,"user_name":"è€æ¨åŒå¿—","can_delete":false,"product_type":"c1","uid":1246199,"ip_address":"","ucode":"3F334F0CFD3DE6","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/f7/3a493bec.jpg","comment_is_top":false,"comment_ctime":1545793685,"is_pvip":false,"replies":[{"id":"19568","content":"ğŸ‘ğŸ¿ æ€è·¯æ¸…æ™°<br><br><br>éš”ç¦»çº§åˆ«å†æ„‰å¿«åœ°æ”¹æˆRRè¯•è¯•ğŸ˜„","user_name":"ä½œè€…å›å¤","comment_id":54097,"uid":"1264162","ip_address":"","utype":1,"ctime":1545794483,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":6,"race_medal":0,"score":"203409256597","product_id":100020801,"comment_content":"æ„‰å¿«çš„åšä¸€ä¸‹æ€è€ƒé¢˜<br>begin;<br>select * from t where c=5 for update;<br>commit;<br>å†å²çŸ¥è¯†çš„ç»“è®ºæ˜¯ï¼Œinnodbå…ˆé”å…¨è¡¨çš„æ‰€æœ‰è¡Œï¼Œè¿”å›serverå±‚ï¼Œåˆ¤æ–­cæ˜¯å¦ç­‰äº5ï¼Œç„¶åé‡Šæ”¾cï¼=5çš„è¡Œé”ã€‚<br>éªŒè¯æ–¹æ³•ï¼š<br>äº‹åŠ¡Aæ‰§è¡Œ é”ä½ä¸€è¡Œcï¼=5çš„è®°å½• æ¯”å¦‚id =3 c=3<br> select * from t where id = 3 for update æˆ–è€… update t set c=4 where id =3<br>ç„¶åå¯åŠ¨æ–°äº‹åŠ¡Bæ‰§è¡Œä¸Šé¢çš„è¯­å¥select * from t where c=5 for update; çœ‹çœ‹æœ‰æ²¡æœ‰è¢«é˜»å¡ã€‚<br>ç”¨äºåˆ¤æ–­äº‹åŠ¡Bçš„è¯­å¥ä¼šä¸ä¼šè¯•å›¾é”ä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•ã€‚<br>ç„¶åæŠŠäº‹åŠ¡Aå’Œäº‹åŠ¡Bçš„æ‰§è¡Œé¡ºåºå¯¹è°ƒä¸€ä¸‹ï¼Œä¹Ÿå°±æ˜¯å…ˆæ‰§è¡ŒBåœ¨æ‰§è¡ŒAã€‚çœ‹çœ‹æœ‰æ²¡æœ‰é˜»å¡ï¼Œ<br>åˆ¤æ–­åœ¨äº‹åŠ¡BåŠ é”æˆåŠŸçš„æƒ…å†µä¸‹ä¼šä¸ä¼šé‡Šæ”¾ä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶è®°å½•çš„è¡Œé”ã€‚<br>","like_count":48,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434353,"discussion_content":"ğŸ‘ğŸ¿ æ€è·¯æ¸…æ™°\n\n\néš”ç¦»çº§åˆ«å†æ„‰å¿«åœ°æ”¹æˆRRè¯•è¯•ğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545794483,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2113915,"avatar":"https://static001.geekbang.org/account/avatar/00/20/41/7b/cda2e622.jpg","nickname":"è‡´è‰¯çŸ¥","note":"","ucode":"73C722E31B726A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":358897,"discussion_content":"è¿™æ ·çš„æè¿° æ€è·¯è¿˜æ¸…æ™°  éš”ç¦»çº§åˆ«éƒ½æ²¡æœ‰è¯´æ˜ ä½œè€… æé—®è€…çš„è„‘è¢‹é‡Œæ˜¯é¢ç²‰  ä½ è¿™å›ç­”ç»™äº†ç‚¹æ°´  æˆæµ†ç³Šäº†å“ˆ\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1616072896,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1813207,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/aa/d7/a417ad5b.jpg","nickname":"CharAt","note":"","ucode":"D7D44B48FC4E79","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2113915,"avatar":"https://static001.geekbang.org/account/avatar/00/20/41/7b/cda2e622.jpg","nickname":"è‡´è‰¯çŸ¥","note":"","ucode":"73C722E31B726A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381162,"discussion_content":"çœ‹ä¸æ‡‚ä¸è¦å–·ï¼Œå…ˆè‡ªå·±æ‰¾åŸå› ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624934363,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":358897,"ip_address":""},"score":381162,"extra":""},{"author":{"id":1986739,"avatar":"https://static001.geekbang.org/account/avatar/00/1e/50/b3/9269cd59.jpg","nickname":"LWD","note":"","ucode":"DDA444DB113C01","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2113915,"avatar":"https://static001.geekbang.org/account/avatar/00/20/41/7b/cda2e622.jpg","nickname":"è‡´è‰¯çŸ¥","note":"","ucode":"73C722E31B726A","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560038,"discussion_content":"æ˜¯ä½ æ°´å¹³ä¸å¤Ÿ,å·²ç»å¾ˆæ¸…æ™°äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649138435,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":358897,"ip_address":""},"score":560038,"extra":""}]},{"author":{"id":1338203,"avatar":"https://static001.geekbang.org/account/avatar/00/14/6b/5b/16a93d9d.jpg","nickname":"- -","note":"","ucode":"FBB2869AD5FEA5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":308888,"discussion_content":"æ¢æˆRRï¼Œå…ˆæ‰§è¡ŒBï¼Œä¼šé˜»å¡Aï¼Œä¸ºå•¥RR ä¸ä¼šé‡Šæ”¾ä¸æ»¡è¶³æ¡ä»¶çš„è¡Œï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1601110617,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2052476,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Qq6oLfOTgKzjiculoUDicdv7WoY1iabPfOTumibWeInVP2Mnod9XVPrNSClvIiaLbvtDlIjRnWUNaXcYwREGzlcaDog/132","nickname":"Geek_åœ¨ä¸‹èŸ‘è‚ç‹","note":"","ucode":"E1F5BBB5BC5962","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1338203,"avatar":"https://static001.geekbang.org/account/avatar/00/14/6b/5b/16a93d9d.jpg","nickname":"- -","note":"","ucode":"FBB2869AD5FEA5","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":320598,"discussion_content":"å›å°å°†å†›çš„è¯ï¼Œä¼šæœ‰é—´éš™é”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604409300,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":308888,"ip_address":""},"score":320598,"extra":""}]}]},{"had_liked":false,"id":54382,"user_name":"æ²™æ¼ é‡Œçš„éª†é©¼","can_delete":false,"product_type":"c1","uid":1012559,"ip_address":"","ucode":"5EC18A71B3A594","user_header":"https://static001.geekbang.org/account/avatar/00/0f/73/4f/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1545839069,"is_pvip":true,"discussion_count":3,"race_medal":0,"score":"199114334685","product_id":100020801,"comment_content":"@é«˜æ•<br>è¿™é‡Œæœ‰äº›èµ„æ–™æä¾›ç»™ä½ å‚è€ƒ: <br>1. ä½•ç™»æˆçš„æŠ€æœ¯åšå®¢: åŠ é”åˆ†æ http:&#47;&#47;hedengcheng.com&#47;?p=771<br>2. é”çš„å¸¸è§ç§ç±»: http:&#47;&#47;www.aneasystone.com&#47;archives&#47;2017&#47;11&#47;solving-dead-locks-two.html","like_count":46,"discussions":[{"author":{"id":1009527,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/67/77/c1310aad.jpg","nickname":"å‰‘è¡£æ¸…é£","note":"","ucode":"470CD81F6612F4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":338203,"discussion_content":"æ›´æ–°ä¸‹ ä½•ç™»æˆ çš„åšå®¢åŸŸåå·²ç»è¢«æŠ¢æ³¨ï¼Œå¯ä»¥çœ‹çœ‹è¿™é‡Œ https://github.com/hedengcheng/tech","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1609212567,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1691243,"avatar":"https://static001.geekbang.org/account/avatar/00/19/ce/6b/ae7489a0.jpg","nickname":"Ccc","note":"","ucode":"EAEA0284948959","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":81982,"discussion_content":"å¾ˆå¥½çš„å‚è€ƒèµ„æ–™ï¼Œè°¢è°¢","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1576304823,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1272315,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/nSvVtStiaQzslFM7YRnlhPyTgSHGoXvOqlSQS8rMEmfnFCtasNxRiaVfrRcMlkuOSq1iaReQD0CiaGHMVibsVMNkAxQ/132","nickname":"justin","note":"","ucode":"09AE502D6A28D9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373648,"discussion_content":"å†™çš„ç›¸å½“ä¸é”™","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620812852,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":119149,"user_name":"é’±","can_delete":false,"product_type":"c1","uid":1009652,"ip_address":"","ucode":"2C92A243A463D4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg","comment_is_top":false,"comment_ctime":1564532365,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"164773289613","product_id":100020801,"comment_content":"è¯¾å‰æ€è€ƒ<br>1ï¼šä¸ºå•¥åªæŸ¥ä¸€è¡Œçš„è¯­å¥ï¼Œä¹Ÿæ‰§è¡Œè¿™ä¹ˆæ…¢ï¼Ÿ<br>æŸ¥çš„æ…¢ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ç´¢å¼•ä½¿ç”¨çš„é—®é¢˜ï¼Œå’ŒæŸ¥ä¸€è¡Œè¿˜æ˜¯Nè¡Œ(Nä¸æ˜¯å·¨å¤§)ï¼Œæ²¡æœ‰å¿…ç„¶è”ç³»ã€‚æŸ¥ä¸€è¡Œæ…¢ï¼ŒçŒœæµ‹æ²¡æœ‰èµ°ç´¢å¼•æŸ¥è¯¢ï¼Œä¸”æ•°æ®é‡æ¯”è¾ƒå¤§ã€‚<br>è¯¾åæ€è€ƒ<br>1ï¼šé˜…åå‘ç°è‡ªå·±çš„æ— çŸ¥ï¼ŒåªæŸ¥è¯¢ä¸€è¡Œçš„è¯­å¥ï¼Œä¹Ÿæ¯”è¾ƒæ…¢ï¼ŒåŸå› ä»å¤§åˆ°å°å¯åˆ†ä¸ºä¸‰ç§æƒ…å†µï¼Ÿ<br>ç¬¬ä¸€MySQLæ•°æ®åº“æœ¬èº«è¢«å µä½äº†ï¼Œæ¯”å¦‚ï¼šç³»ç»Ÿæˆ–ç½‘ç»œèµ„æºä¸å¤Ÿ<br>ç¬¬äºŒSQLè¯­å¥è¢«å µä½äº†ï¼Œæ¯”å¦‚ï¼šè¡¨é”ï¼Œè¡Œé”ç­‰ï¼Œå¯¼è‡´å­˜å‚¨å¼•æ“ä¸æ‰§è¡Œå¯¹åº”çš„SQLè¯­å¥<br>ç¬¬ä¸‰ç¡®å®æ˜¯ç´¢å¼•ä½¿ç”¨ä¸å½“ï¼Œæ²¡æœ‰èµ°ç´¢å¼•<br>ç¬¬å››æ˜¯è¡¨ä¸­æ•°æ®çš„ç‰¹ç‚¹å¯¼è‡´çš„ï¼Œèµ°äº†ç´¢å¼•ï¼Œä½†å›è¡¨æ¬¡æ•°åºå¤§<br>æ„Ÿè°¢è€å¸ˆçš„åˆ†äº«ï¼ŒçœŸæ˜¯é†é†çŒé¡¶å‘€ğŸ˜„","like_count":38},{"had_liked":false,"id":54095,"user_name":"å°ç¡®å¹¸","can_delete":false,"product_type":"c1","uid":1099329,"ip_address":"","ucode":"C090505CB2DB69","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/41/b868f086.jpg","comment_is_top":false,"comment_ctime":1545793563,"is_pvip":false,"replies":[{"id":"19569","content":"ä¸€èˆ¬è¯´å…¨è¡¨æ‰«æé»˜è®¤æ˜¯å€¼â€œæ‰«ç„ä¸»é”®ç´¢å¼•â€","user_name":"ä½œè€…å›å¤","comment_id":54095,"uid":"1264162","ip_address":"","utype":1,"ctime":1545794511,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":2,"race_medal":0,"score":"138984747035","product_id":100020801,"comment_content":"é—®ä¸€ä¸‹ï¼šç´¢å¼•æ‰«æä¸å…¨è¡¨æ‰«æï¼Œæœ‰ä»€ä¹ˆå¼‚åŒç‚¹ï¼Ÿ","like_count":32,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434352,"discussion_content":"ä¸€èˆ¬è¯´å…¨è¡¨æ‰«æé»˜è®¤æ˜¯å€¼â€œæ‰«ç„ä¸»é”®ç´¢å¼•â€","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1545794511,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2148247,"avatar":"https://static001.geekbang.org/account/avatar/00/20/c7/97/fc90c7c3.jpg","nickname":"whoru","note":"","ucode":"5F7E10193089F6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":412107,"discussion_content":"å‡†ç¡®æ¥è¯´å…¨è¡¨æ‰«ææ˜¯æŒ‡éå†ä¸»é”®ç´¢å¼•çš„å¶å­èŠ‚ç‚¹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636078206,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54922,"user_name":"xm","can_delete":false,"product_type":"c1","uid":1254296,"ip_address":"","ucode":"9A08EB6F201D74","user_header":"https://static001.geekbang.org/account/avatar/00/13/23/98/bd96932f.jpg","comment_is_top":false,"comment_ctime":1545982182,"is_pvip":false,"replies":[{"id":"19882","content":"å—¯ï¼Œè¿™ä¸ªæ˜¯ä¸€ç§æ€è·¯ï¼Œè§è¿‡è¿™ä¹ˆå¹²çš„ğŸ˜„","user_name":"ä½œè€…å›å¤","comment_id":54922,"uid":"1264162","ip_address":"","utype":1,"ctime":1545988658,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":2,"race_medal":0,"score":"117510099174","product_id":100020801,"comment_content":"@Elvis<br>Elvis<br>î˜¦<br>0<br>è€å¸ˆï¼Œæœ€è¿‘é¡¹ç›®mysqlé‡åˆ°ä¸€ä¸ªéš¾é¢˜ï¼Œ è¡¨æ•°æ®æ¯å¤©230ä¸‡ï¼Œä¸€æ¡è¯­å¥çš„æŸ¥è¯¢æ¡ä»¶æœ‰1â€”40ä¸ªï¼Œæœ€åæƒ…å†µä¸‹40ï¼Œè¯·é—®è€å¸ˆæœ‰æ²¡æœ‰å¥½çš„å»ºè®®ï¼Œéå¸¸æ„Ÿè°¢<br>2018-12-27<br>î˜ˆ ä½œè€…å›å¤<br>è¿™ä¸ªæ˜¯ç´¢å¼•æœ€å¤´å¤§çš„é—®é¢˜ä¹‹ä¸€äº†â€¦ å¦‚æœæœ‰æ˜æ˜¾çš„æŸç±»ç»„åˆæŸ¥è¯¢æ˜¯æœ€å¤šçš„è¿˜å¥½ï¼Œå¦åˆ™ç¡®å®å¾ˆéº»çƒ¦ã€‚<br><br>æˆ‘è§‰å¾—åº”å¯¹è¿™ç§å¤§æ•°æ®é‡çš„å¤šæ¡ä»¶çš„æŸ¥è¯¢çš„è¯æ¢ç§æ€è·¯ï¼Œå°†mysqlå¤æ‚çš„ç»„åˆæŸ¥è¯¢æ¡ä»¶å¯¼å…¥åˆ°esä¸­ä½œä¸ºkeyï¼Œä¸»é”®idä½œä¸ºvalueï¼Œå¤æ‚çš„æŸ¥è¯¢ç»è¿‡esåå¾—åˆ°ä¸»é”®idï¼Œä¹‹åèµ°mysqlä¼šå¥½å¾ˆå¤šï¼Œç›®å‰å…¬å¸æ˜¯è¿™æ ·åšçš„ï¼Œè€å¸ˆè§‰å¾—æ€ä¹ˆæ ·ï¼Ÿ","like_count":28,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434612,"discussion_content":"å—¯ï¼Œè¿™ä¸ªæ˜¯ä¸€ç§æ€è·¯ï¼Œè§è¿‡è¿™ä¹ˆå¹²çš„ğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545988658,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2562181,"avatar":"https://static001.geekbang.org/account/avatar/00/27/18/85/83ac977e.jpg","nickname":"åŠå¹´ 2å·","note":"","ucode":"7F23C4532A5513","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":540671,"discussion_content":"å¦‚æœæœ‰å¾ˆå¤šç§ä¸åŒæŸ¥è¯¢æƒ…å†µï¼Œæ˜¯ç¬¬ä¸€æ¬¡æŸ¥è¯¢å°±æ’å…¥åˆ°es? åé¢æŸ¥è¯¢ç›¸åŒæ¡ä»¶çš„å°±å–esé‡Œé¢çš„idå€¼? ä½†æ˜¯å¦‚æœåœ¨è¿™æŸ¥è¯¢æ¡ä»¶ä¸‹åé¢æœ‰æ–°çš„æ•°æ®è¿›æ¥å°¼ï¼Œä¸ä¼šé€ æˆæ•°æ®ä¸å®Œæ•´å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1640135278,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54510,"user_name":"Tony Du","can_delete":false,"product_type":"c1","uid":1001661,"ip_address":"","ucode":"F5FCC400E615EA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/48/bd/6c7d4230.jpg","comment_is_top":false,"comment_ctime":1545886434,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"104625101538","product_id":100020801,"comment_content":"å¯¹äºè¯¾åé—®é¢˜ï¼Œselect * from t where c=5 for updateï¼Œ<br>å½“çº§åˆ«ä¸ºRRæ—¶ï¼Œå› ä¸ºå­—æ®µcä¸Šæ²¡æœ‰ç´¢å¼•ï¼Œä¼šæ‰«ä¸»é”®ç´¢å¼•ï¼Œè¿™æ—¶ä¼šæŠŠè¡¨ä¸­çš„è®°å½•éƒ½åŠ ä¸ŠXé”ã€‚åŒæ—¶ï¼Œå› ä¸ºå¯¹äºinnodbæ¥è¯´ï¼Œå½“çº§åˆ«ä¸ºRRæ—¶ï¼Œæ˜¯å¯ä»¥è§£å†³å¹»è¯»çš„ï¼Œæ­¤æ—¶å¯¹äºæ¯æ¡è®°å½•çš„é—´éš™è¿˜è¦åŠ ä¸ŠGAPé”ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¡¨ä¸Šæ¯ä¸€æ¡è®°å½•å’Œæ¯ä¸€ä¸ªé—´éš™éƒ½é”ä¸Šäº†ã€‚<br>å½“çº§åˆ«ä¸ºRCæ—¶ï¼Œå› ä¸ºå­—æ®µcä¸Šæ²¡æœ‰ç´¢å¼•ï¼Œä¼šæ‰«ä¸»é”®ç´¢å¼•ï¼Œè¿™æ—¶ä¼šæŠŠè¡¨ä¸­çš„è®°å½•éƒ½åŠ ä¸ŠXé”ã€‚<br><br>å¦å¤–ï¼Œä¹‹å‰çœ‹è¿‡ç›¸å…³æ–‡ç« ï¼ŒMySQLåœ¨å®é™…å®ç°ä¸­æœ‰äº›ä¼˜åŒ–æªæ–½ï¼Œæ¯”å¦‚å½“RCæ—¶ï¼Œåœ¨MySQL serverè¿‡æ»¤æ¡ä»¶ï¼Œå‘ç°ä¸æ»¡è¶³åï¼Œä¼šæŠŠä¸æ»¡è¶³æ¡ä»¶çš„è®°å½•é‡Šæ”¾é”ï¼ˆè¿™é‡Œå°±æ˜¯æŠŠ c!=5çš„è®°å½•é‡Šæ”¾é”ï¼‰ï¼Œè¿™é‡Œä¼šè¿èƒŒä¸¤é˜¶æ®µçš„çº¦æŸã€‚å½“ç„¶ï¼Œä¹‹å‰æ¯æ¡è®°å½•çš„åŠ é”æ“ä½œè¿˜æ˜¯ä¸èƒ½çœç•¥çš„ã€‚<br>è¿˜æœ‰ï¼Œå¯¹äºsemi consistent readå¼€å¯çš„æƒ…å†µä¸‹ï¼Œä¹Ÿä¼šæå‰é‡Šæ”¾é”ã€‚<br>","like_count":24,"discussions":[{"author":{"id":1810051,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK0uyg1IicbEhLwsgM2A2ROoyVdWdmUqZfQfs6G67w9m3hdRNBMOQJatQoACj3qNGgj2KVIgricaYiaQ/132","nickname":"æœ¨å¾—æ„Ÿæƒ…çš„ç¼–ç æœºå™¨","note":"","ucode":"9C6CD47ADCB8E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":185144,"discussion_content":"é—´éš™ æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582598432,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54791,"user_name":"ä¼¼æ°´æµå¹´","can_delete":false,"product_type":"c1","uid":1304443,"ip_address":"","ucode":"D114A8E273133C","user_header":"https://static001.geekbang.org/account/avatar/00/13/e7/7b/71da8283.jpg","comment_is_top":false,"comment_ctime":1545963065,"is_pvip":false,"discussion_count":12,"race_medal":0,"score":"96035243577","product_id":100020801,"comment_content":"è¯·é—®è€å¸ˆï¼Œä¸ºä»€ä¹ˆselect blocking_pid from sys.schema_table_lock_waits;æŸ¥ä¸åˆ°mdlé”çš„è¿›ç¨‹idï¼Œæ˜¾ç¤ºä¸ºç©ºã€‚","like_count":22,"discussions":[{"author":{"id":1228852,"avatar":"https://static001.geekbang.org/account/avatar/00/12/c0/34/0574bb44.jpg","nickname":"æœ€åˆçš„å°è±¡","note":"","ucode":"4DD68307FA274E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":131504,"discussion_content":"æ‰§è¡Œä»¥ä¸‹è¿™å¥å†è¯•ä¸€ä¸‹ï¼šupdate performance_schema.setup_instruments set ENABLED=&#39;YES&#39;,TIMED=&#39;YES&#39; where name=&#39;wait/lock/metadata/sql/mdl&#39;;","likes_number":9,"is_delete":false,"is_hidden":false,"ctime":1578841239,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":2034669,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/0b/ed/4969d2f8.jpg","nickname":"æŸ¯å—çˆ±ä¸ŠæŒ‡é’ˆ","note":"","ucode":"5BF7E8AC28F9CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1228852,"avatar":"https://static001.geekbang.org/account/avatar/00/12/c0/34/0574bb44.jpg","nickname":"æœ€åˆçš„å°è±¡","note":"","ucode":"4DD68307FA274E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":290107,"discussion_content":"è¿™å¥è¯æ˜¯å¹²å•¥çš„å‘¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1594346524,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":131504,"ip_address":""},"score":290107,"extra":""},{"author":{"id":1970443,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIx1V1QAxC4NHaxYZGyuibBN8lcURJWc5nrnO4yic1kxnDemYV2FJGialf47kYX9qtDnZZOfe1SJeLicg/132","nickname":"lleft","note":"","ucode":"D573EB509455AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2034669,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/0b/ed/4969d2f8.jpg","nickname":"æŸ¯å—çˆ±ä¸ŠæŒ‡é’ˆ","note":"","ucode":"5BF7E8AC28F9CF","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373692,"discussion_content":"å¯åŠ¨metadata lockçš„ç›‘æ§ï¼Œä¸ç„¶schema_table_lock_waitsè¡¨æ²¡æœ‰æ•°æ®","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1620826536,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":290107,"ip_address":""},"score":373692,"extra":""},{"author":{"id":3004698,"avatar":"https://static001.geekbang.org/account/avatar/00/2d/d9/1a/f5bb1a23.jpg","nickname":"LL","note":"","ucode":"1E498475B2D9EC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1228852,"avatar":"https://static001.geekbang.org/account/avatar/00/12/c0/34/0574bb44.jpg","nickname":"æœ€åˆçš„å°è±¡","note":"","ucode":"4DD68307FA274E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":577516,"discussion_content":"mark","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656158579,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":131504,"ip_address":""},"score":577516,"extra":""}]},{"author":{"id":1937317,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/8f/a5/d613dfc7.jpg","nickname":"å°æ­£","note":"","ucode":"D6D68DCC9650FA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":333675,"discussion_content":"æ–‡ç« é‡Œè®²äº†ï¼Œ5.7ä»¥åæ˜¯æŸ¥sys.innodb_lock_waits","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1607590562,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2679253,"avatar":"https://static001.geekbang.org/account/avatar/00/28/e1/d5/c57a4bd8.jpg","nickname":"Prisoner","note":"","ucode":"AE469ACC071692","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394403,"discussion_content":"ä¹Ÿæ˜¯emptyï¼Œmysqlç‰ˆæœ¬æ˜¯ 5.7.26-log","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631869698,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2213774,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLWlndLduM3SGiauJvia0oVdhH8FhbviaS9EsD0fM93PwEKg0Syk1I5strKbsZNoXE0klauTGAwW1DGQ/132","nickname":"é™ˆæ–°å«","note":"","ucode":"6EF232730D0FD7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":363999,"discussion_content":" 5.7.17-log ç‰ˆæœ¬å¯ä»¥æŸ¥è¯¢åˆ°é”è¡¨çš„è¿æ¥","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1617346220,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1140175,"avatar":"https://static001.geekbang.org/account/avatar/00/11/65/cf/326c0eea.jpg","nickname":"x-rayîŒº","note":"","ucode":"8363F0C4D0AC0B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":331019,"discussion_content":"mariadbæ²¡æœ‰sysåº“å’‹æï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1606747677,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1484273,"avatar":"https://static001.geekbang.org/account/avatar/00/16/a5/f1/8e3ce0e4.jpg","nickname":"ğŸ‹ğŸ¥¬ğŸŸ","note":"","ucode":"4191D6E6CB6D3B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":306926,"discussion_content":"é”ç­‰å¾…çš„æ—¶å€™æ‰§è¡Œ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1600419616,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1182120,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/oCx7GX9P4w5cml1cpbFD1x21Biad3MLCTOhTPJvicRW3xp9C8xTgdiaOSdpFyvibKSfcD1LL4miaT7VtqqKms6rgujg/132","nickname":"zshanjun","note":"","ucode":"0C99216D6FBDB8","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":52376,"discussion_content":"æˆ‘çš„ä¹Ÿæ˜¯empty","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1574045478,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1030164,"avatar":"https://wx.qlogo.cn/mmopen/vi_32/xEFZxrfm76MG5TBP2Bhfo8g8JPRuoKTYLmgcyvvzHswz4EpSC3SiaxP2ib6RYoAymicVVRTHJCMylHaNmFXOseUlg/132","nickname":"hq","note":"","ucode":"5630BE81A2D201","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":26704,"discussion_content":"æˆ‘æµ‹çš„ä¹Ÿæ˜¯empty(âŠ™ï¹âŠ™)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1570614479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1363803,"avatar":"https://static001.geekbang.org/account/avatar/00/14/cf/5b/4b96b6f3.jpg","nickname":"åˆ«åµæˆ‘ç¡è§‰","note":"","ucode":"A1BC2A1AB7CB82","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":22591,"discussion_content":"æ€ä¹ˆ@ä¸€ä¸‹è€å¸ˆï¼Œæˆ‘æµ‹ä¹Ÿæ˜¯empty","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569656828,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":98570,"user_name":"å¤å…´","can_delete":false,"product_type":"c1","uid":1363230,"ip_address":"","ucode":"C172A87873001A","user_header":"https://static001.geekbang.org/account/avatar/00/14/cd/1e/692c3313.jpg","comment_is_top":false,"comment_ctime":1559032645,"is_pvip":false,"replies":[{"id":"37471","content":"åœ¨5.5åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œlock table t1 write å°±æ˜¯é€šè¿‡åŠ mdlå†™é”ï¼Œæ¥é˜»æ­¢å…¶ä»–çº¿ç¨‹è®¿é—®çš„","user_name":"ä½œè€…å›å¤","comment_id":98570,"uid":"1264162","ip_address":"","utype":1,"ctime":1560473335,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"83163411269","product_id":100020801,"comment_content":"lock table t1 writeè¿™ä¸ªå†™é”è·Ÿmdlå†™é”ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼Ÿ","like_count":19,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451740,"discussion_content":"åœ¨5.5åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œlock table t1 write å°±æ˜¯é€šè¿‡åŠ mdlå†™é”ï¼Œæ¥é˜»æ­¢å…¶ä»–çº¿ç¨‹è®¿é—®çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560473335,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54431,"user_name":"å¼ æ°¸å¿—","can_delete":false,"product_type":"c1","uid":1208727,"ip_address":"","ucode":"E54B75EF3F63B3","user_header":"https://static001.geekbang.org/account/avatar/00/12/71/97/f1a3d398.jpg","comment_is_top":false,"comment_ctime":1545870009,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"78855281337","product_id":100020801,"comment_content":"RCéš”ç¦»çº§åˆ«ä¸‹ï¼Œå¯¹éç´¢å¼•å­—æ®µæ›´æ–°ï¼Œæœ‰ä¸ªé”å…¨è¡¨è®°å½•çš„è¿‡ç¨‹ï¼Œä¸ç¬¦åˆæ¡ä»¶çš„ä¼šåŠæ—¶é‡Šæ”¾è¡Œé”ï¼Œä¸å¿…ç­‰äº‹åŠ¡ç»“æŸæ—¶é‡Šæ”¾ï¼›è€Œç›´æ¥ç”¨ç´¢å¼•åˆ—æ›´æ–°ï¼Œåªä¼šé”ç´¢å¼•æŸ¥æ‰¾å€¼å’Œè¡Œã€‚<br><br><br>","like_count":18,"discussions":[{"author":{"id":1026078,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a8/1e/0b124c05.jpg","nickname":"å†¥ç‹æ˜Ÿ","note":"","ucode":"995A56EF84E5F6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":579822,"discussion_content":"æ‰€ä»¥æ— æ³•é˜²æ­¢é‡å¤è¯»å’Œå¹»è¯»å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1657703075,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78722,"user_name":"å­™å¿—å¼º","can_delete":false,"product_type":"c1","uid":1325997,"ip_address":"","ucode":"9C070F1E4EC6FF","user_header":"https://static001.geekbang.org/account/avatar/00/14/3b/ad/31193b83.jpg","comment_is_top":false,"comment_ctime":1553224188,"is_pvip":true,"replies":[{"id":"28898","content":"ä½ å†çœ‹ä¸‹08ç¯‡å“ˆ<br>ç®€å•è¯´ï¼Œä¸€è‡´æ€§è§†å›¾åªæ˜¯ä¸€ä¸ªæ•°ç»„+ä¸€ä¸ªé«˜æ°´ä½ï¼Œæ˜¯è¦é undo logæ¥è·å–è€ç‰ˆæœ¬çš„æ•°æ®çš„","user_name":"ä½œè€…å›å¤","comment_id":78722,"uid":"1264162","ip_address":"","utype":1,"ctime":1553415199,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":2,"race_medal":0,"score":"53092831740","product_id":100020801,"comment_content":"äº²çˆ±çš„è€å¸ˆ,æˆ‘è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜?å›°æƒ‘å¥½ä¹…<br>ä¸€è‡´æ€§è¯»ä¸ºå•¥è¿˜è¦å¤„ç†åˆ«çš„äº‹åŠ¡å›æ»šæ—¥å¿—?ä¸€è‡´æ€§è¯»ä¸æ˜¯ç›´æ¥è¿”å›è§†å›¾é‡Œçš„å€¼å—?undo logåœ¨æ²¡æœ‰äº‹åŠ¡ä½¿ç”¨çš„æ—¶å€™ä¼šæ¸…é™¤æ‰?","like_count":12,"discussions":[{"author":{"id":1314724,"avatar":"https://static001.geekbang.org/account/avatar/00/14/0f/a4/0b49469f.jpg","nickname":"æœ¨å­00","note":"","ucode":"8F78CA722EB29B","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":307567,"discussion_content":"ä¸€è‡´æ€§è§†å›¾åªæ˜¯ä¸€ä¸ªæ•°ç»„+ä¸€ä¸ªé«˜æ°´ä½  åˆ°ä½ã€‚","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1600687993,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":444208,"discussion_content":"ä½ å†çœ‹ä¸‹08ç¯‡å“ˆ\nç®€å•è¯´ï¼Œä¸€è‡´æ€§è§†å›¾åªæ˜¯ä¸€ä¸ªæ•°ç»„+ä¸€ä¸ªé«˜æ°´ä½ï¼Œæ˜¯è¦é undo logæ¥è·å–è€ç‰ˆæœ¬çš„æ•°æ®çš„","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1553415199,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54788,"user_name":"æ»”æ»”","can_delete":false,"product_type":"c1","uid":1303342,"ip_address":"","ucode":"6968B5771AF79D","user_header":"https://static001.geekbang.org/account/avatar/00/13/e3/2e/77ad18f4.jpg","comment_is_top":false,"comment_ctime":1545962792,"is_pvip":false,"replies":[{"id":"19863","content":"æ˜¯çš„","user_name":"ä½œè€…å›å¤","comment_id":54788,"uid":"1264162","ip_address":"","utype":1,"ctime":1545974654,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"40200668456","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæˆ‘æœ‰ä¸ªé—®é¢˜é—®ï¼Œåœ¨è®²éš”ç¦»çº§åˆ«çš„æ—¶å€™è®²è¿‡å¯é‡å¤è¯»çº§åˆ«ä¸‹ï¼Œé»˜è®¤è¯»æ“ä½œ(selectæŸ¥è¯¢ï¼Œä¸æ˜¯å½“å‰è¯»)è¯»åˆ°çš„æ˜¯æŸæ¡æ•°æ®çš„æŸä¸ªå†å²ç‰ˆæœ¬ï¼Œè€Œæ‰€æœ‰è¿™äº›å†å²ç‰ˆæœ¬æ•°æ®éƒ½æ˜¯ä»¥undo logçš„å½¢å¼å­˜åœ¨çš„å¯¹å—ï¼Ÿéœ€è¦æ‰¾æŸä¸ªå†å²ç‰ˆæœ¬æ•°æ®å°±ç›´æ¥æ‰§è¡Œå¯¹åº”undo logï¼Œè€Œä¸æ˜¯äº‹å…ˆæŠŠå†å²ç‰ˆæœ¬çš„æ•°æ®ä¿å­˜ä¸‹æ¥ï¼Œæ˜¯è¿™æ ·çš„å—ï¼Ÿ","like_count":9,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434564,"discussion_content":"æ˜¯çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545974654,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":74695,"user_name":"æµ©æ¶›","can_delete":false,"product_type":"c1","uid":1390697,"ip_address":"","ucode":"DCF935D3F9FC6D","user_header":"https://static001.geekbang.org/account/avatar/00/15/38/69/7b11b341.jpg","comment_is_top":false,"comment_ctime":1552282667,"is_pvip":false,"replies":[{"id":"27533","content":"ç›®å‰5.7æ˜¯æ¯”è¾ƒä¸»æµçš„ï¼Œå°±ç”¨æœ€æ–°GAç‰ˆæœ¬å§ï¼Œè®°å¾—åšå…¨é‡å›å½’æµ‹è¯•","user_name":"ä½œè€…å›å¤","comment_id":74695,"uid":"1264162","ip_address":"","utype":1,"ctime":1552407086,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"27322086443","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæˆ‘ä»¬å…¬å¸ä»Šå¹´æ‰“ç®—è¿æ•°æ®åº“ï¼Œä¹Ÿå°±æ˜¯oracleè¿åˆ°mysqlï¼Œç›®å‰è¦å†³å®šé€‰ç”¨å“ªä¸ªç‰ˆæœ¬å’Œåˆ†æ”¯ï¼Œä¸çŸ¥é“è¦æ€ä¹ˆåˆ†æï¼Œæ‚¨æœ‰ä»€ä¹ˆå¥½çš„å»ºè®®å—ï¼Ÿ","like_count":6,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":442654,"discussion_content":"ç›®å‰5.7æ˜¯æ¯”è¾ƒä¸»æµçš„ï¼Œå°±ç”¨æœ€æ–°GAç‰ˆæœ¬å§ï¼Œè®°å¾—åšå…¨é‡å›å½’æµ‹è¯•","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1552407086,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54889,"user_name":"è ¢è ¢æ¬²åŠ¨çš„è…¹è‚Œ","can_delete":false,"product_type":"c1","uid":1007326,"ip_address":"","ucode":"B10550BF463017","user_header":"https://static001.geekbang.org/account/avatar/00/0f/5e/de/4e7ec66d.jpg","comment_is_top":false,"comment_ctime":1545978396,"is_pvip":false,"discussion_count":6,"race_medal":0,"score":"27315782172","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½<br>    æˆ‘çš„mysqlç‰ˆæœ¬5.7.24ï¼Œå°è¯•çš„æ—¶å€™å‘ç°äº†å¦‚ä¸‹é—®é¢˜<br>    é”ä½äº†è¡¨T<br>        mysql&gt; lock table T write;<br>        Query OK, 0 rows affected (0.00 sec)<br>   å¦ä¸€ä¸ªterminalæŸ¥è¯¢æ—¶è¢«é˜»å¡ï¼Œä½†æ˜¯æŸ¥ä¸åˆ°blocking_pid ï¼Œè¿™æ˜¯ä»€ä¹ˆæƒ…å†µå‘¢<br>   mysql&gt; select blocking_pid  from sys.schema_table_lock_waits;<br>   Empty set (0.00 sec)<br>  ps:å‘ç°æŸ¥è¯¢schema_table_lock_waitsè¡¨ä¸lock tableçš„è¯­å¥ä¸èƒ½æ”¾åœ¨ä¸€ä¸ªterminalæ‰§è¡Œï¼Œå¦åˆ™ä¼šæŠ¥<br>Table &#39;schema_table_lock_waits&#39; was not locked with LOCK TABLES<br>è‡ªè¡Œå°è¯•çš„åŒå­¦è¦æ³¨æ„ä¸‹ï¼Œè€å¸ˆæœ‰ç©ºçš„è¯ä¹Ÿå¯ä»¥å¸®çœ‹çœ‹ä¸ºä»€ä¹ˆã€‚ã€‚ã€‚","like_count":6,"discussions":[{"author":{"id":1186252,"avatar":"https://static001.geekbang.org/account/avatar/00/12/19/cc/abb7bfe3.jpg","nickname":"Mr.0x16","note":"","ucode":"E1406E619EA8B2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1351,"discussion_content":"æ‰§è¡Œä¸€ä¸‹select * from performance_schema.setup_instruments where name=&#39;wait/lock/metadata/sql/mdl&#39;ï¼Œçœ‹ä¸€ä¸‹ENABLEDå’ŒTIMEDæ˜¯ä¸æ˜¯éƒ½æ˜¯YESï¼Œåªæœ‰ä¸¤ä¸ªéƒ½æ˜¯YESçš„æ—¶å€™æ‰èƒ½æ‰§è¡Œæ–‡ç« ä¸­è¯´çš„æ“ä½œã€‚\nå…·ä½“å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼š\nhttps://dev.mysql.com/doc/refman/5.7/en/sys-schema-table-lock-waits.html\nhttps://dev.mysql.com/doc/refman/5.7/en/metadata-locks-table.html","likes_number":12,"is_delete":false,"is_hidden":false,"ctime":1562571954,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1242455,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f5/57/ce10fb1b.jpg","nickname":"å¤©å¤©å‘ä¸Š","note":"","ucode":"0CCCA6F4DCC480","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":199161,"discussion_content":"è€å¸ˆåœ¨ç¬¬6è®²é‡Œè®²äº†ï¼Œlock tables è¯­æ³•é™¤äº†ä¼šé™åˆ¶åˆ«çš„çº¿ç¨‹çš„è¯»å†™å¤–ï¼Œä¹Ÿé™å®šäº†æœ¬çº¿ç¨‹æ¥ä¸‹æ¥çš„æ“ä½œå¯¹è±¡ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1583564717,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1350677,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9c/15/719f1f44.jpg","nickname":"ç­‰é£æ¥","note":"","ucode":"5B7FF74A51F534","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377254,"discussion_content":"æ’æŸ¥ä¸€ä¸‹æ˜¯å¦å¼€å¯performance_schema=on","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622560802,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2679253,"avatar":"https://static001.geekbang.org/account/avatar/00/28/e1/d5/c57a4bd8.jpg","nickname":"Prisoner","note":"","ucode":"AE469ACC071692","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1350677,"avatar":"https://static001.geekbang.org/account/avatar/00/14/9c/15/719f1f44.jpg","nickname":"ç­‰é£æ¥","note":"","ucode":"5B7FF74A51F534","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394404,"discussion_content":"å¼€å¯äº†ã€‚è¿˜æ˜¯æŸ¥ä¸åˆ°ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631869818,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":377254,"ip_address":""},"score":394404,"extra":""}]},{"author":{"id":1363803,"avatar":"https://static001.geekbang.org/account/avatar/00/14/cf/5b/4b96b6f3.jpg","nickname":"åˆ«åµæˆ‘ç¡è§‰","note":"","ucode":"A1BC2A1AB7CB82","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":22588,"discussion_content":"æˆ‘æµ‹è¯•select * from sys.schema_table_lock_waits;ä¹Ÿæ˜¯Empty set (0.01 sec)ï¼Œä½ çŸ¥é“åŸå› äº†å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1569656753,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":2679253,"avatar":"https://static001.geekbang.org/account/avatar/00/28/e1/d5/c57a4bd8.jpg","nickname":"Prisoner","note":"","ucode":"AE469ACC071692","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1363803,"avatar":"https://static001.geekbang.org/account/avatar/00/14/cf/5b/4b96b6f3.jpg","nickname":"åˆ«åµæˆ‘ç¡è§‰","note":"","ucode":"A1BC2A1AB7CB82","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":394405,"discussion_content":"æœ‰è§£å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631869835,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":22588,"ip_address":""},"score":394405,"extra":""}]}]},{"had_liked":false,"id":54320,"user_name":"Long","can_delete":false,"product_type":"c1","uid":1318970,"ip_address":"","ucode":"2417242560360A","user_header":"https://static001.geekbang.org/account/avatar/00/14/20/3a/90db6a24.jpg","comment_is_top":false,"comment_ctime":1545828513,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"23020664993","product_id":100020801,"comment_content":"ç°åœ¨æ¯å‘¨éƒ½åœ¨ç€æ€¥çš„ç­‰è¿™ä¸ªä¸“æ æ›´æ–°ï¼Œå› ä¸ºä¹‹å‰è‡ªå·±ä¹Ÿå­¦äº†ç”¨äº†å¾ˆä¹…ï¼Œä¹°ä¹‹å‰è¿˜åœ¨çŠ¹è±«æ˜¯å¦å€¼å¾—ä¹°ï¼Œç°åœ¨çœŸçš„æ„Ÿè§‰å¤ªå€¼äº†ï¼","like_count":5},{"had_liked":false,"id":54051,"user_name":"é¹","can_delete":false,"product_type":"c1","uid":1209661,"ip_address":"","ucode":"B514BA450CB317","user_header":"","comment_is_top":false,"comment_ctime":1545789473,"is_pvip":false,"replies":[{"id":"19563","content":"Flush è¿‡ç¨‹ä¸­ï¼ŒæŸ¥ä¹Ÿä¸è¡Œçš„","user_name":"ä½œè€…å›å¤","comment_id":54051,"uid":"1264162","ip_address":"","utype":1,"ctime":1545791006,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"23020625953","product_id":100020801,"comment_content":"æ‰€ä»¥ï¼Œå‡ºç° Waiting for table flush çŠ¶æ€çš„å¯èƒ½æƒ…å†µæ˜¯ï¼šæœ‰ä¸€ä¸ª flush tables å‘½ä»¤è¢«åˆ«çš„è¯­å¥å µä½äº†ï¼Œç„¶åå®ƒåˆå µä½äº†æˆ‘ä»¬çš„ select è¯­å¥ã€‚<br><br><br>è®°å¾—ä¹‹å‰æ–‡ç« è®² flush tableä¼šå¯¼è‡´è¯¥è¡¨ ä¸èƒ½å¢æ”¹åˆ   ä½†æ˜¯ä¸ºä»€ä¹ˆsession cçš„æŸ¥è¯¢ä¹Ÿä¼šè¢«blockå‘¢","like_count":5,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434340,"discussion_content":"Flush è¿‡ç¨‹ä¸­ï¼ŒæŸ¥ä¹Ÿä¸è¡Œçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545791006,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54028,"user_name":"æ»¡å¤©æ˜Ÿ","can_delete":false,"product_type":"c1","uid":1148315,"ip_address":"","ucode":"CE85702F2FB3D7","user_header":"https://static001.geekbang.org/account/avatar/00/11/85/9b/fc33c974.jpg","comment_is_top":false,"comment_ctime":1545787578,"is_pvip":false,"replies":[{"id":"19560","content":"è¿™æ˜¯è¢«åˆ«çš„å¹¶å‘äº‹åŠ¡åˆæ”¹å›å»äº†å—ğŸ˜“<br>è¦ä¹ˆæ˜¯updateçš„å€¼è·ŸåŸå€¼ç›¸åŒ<br>è¦ä¹ˆæ˜¯updateæ¡ä»¶æ²¡æœ‰åŒ¹é…åˆ°è¡Œ<br>é¢ï¼Œæœ€å¥½ç»™ä¸€ä¸‹æ¯ä¸ªè¯­å¥æ‰§è¡Œåçš„affacted rows , è¿˜æœ‰binlogé‡Œçš„æ—¥å¿—å†…å®¹ï¼Œæ‰å¥½åˆ†æ","user_name":"ä½œè€…å›å¤","comment_id":54028,"uid":"1264162","ip_address":"","utype":1,"ctime":1545789733,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":2,"race_medal":0,"score":"23020624058","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæœ€è¿‘é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œçœ‹æ‚¨æœ‰ä»€ä¹ˆå»ºè®®ã€‚<br>ä¸šåŠ¡åœºæ™¯æ˜¯è¿™æ ·çš„ï¼š<br>1.å¼€å¯äº‹åŠ¡<br>2.åœ¨è¡¨aæ’å…¥ä¸€æ¡è®°å½•<br>3.åœ¨è¡¨bæ›´æ–°ä¸€æ¡è®°å½•<br>4.åœ¨è¡¨cæ›´æ–°ä¸€æ¡è®°å½•<br>5.æäº¤äº‹åŠ¡<br>çœ‹ç¨‹åºæ—¥å¿—æ‰€æœ‰sqléƒ½æ²¡é—®é¢˜ï¼ˆæ²¡çœ‹æ•°æ®åº“æ—¥å¿—ï¼‰ï¼Œä½†æ˜¯ç»“æœæ˜¯2çš„é‚£æ¡æ’å…¥äº†ï¼Œ3å’Œ4éƒ½æ²¡æ›´æ–°ï¼Œè¿™ä¸ªé—®é¢˜æœ‰å“ªå‡ ç§æƒ…å†µï¼Ÿ","like_count":5,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434331,"discussion_content":"è¿™æ˜¯è¢«åˆ«çš„å¹¶å‘äº‹åŠ¡åˆæ”¹å›å»äº†å—ğŸ˜“\nè¦ä¹ˆæ˜¯updateçš„å€¼è·ŸåŸå€¼ç›¸åŒ\nè¦ä¹ˆæ˜¯updateæ¡ä»¶æ²¡æœ‰åŒ¹é…åˆ°è¡Œ\né¢ï¼Œæœ€å¥½ç»™ä¸€ä¸‹æ¯ä¸ªè¯­å¥æ‰§è¡Œåçš„affacted rows , è¿˜æœ‰binlogé‡Œçš„æ—¥å¿—å†…å®¹ï¼Œæ‰å¥½åˆ†æ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545789733,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1024486,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a1/e6/50da1b2d.jpg","nickname":"æ—­ä¸œ(Frank)","note":"","ucode":"176FA629800062","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":78760,"discussion_content":"å¦‚æœä»£ç æ²¡é—®é¢˜ï¼Œé‚£å°±æ˜¯å¹»è¯»æ‰€è‡´å§","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1576017649,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53969,"user_name":"å°˜å°","can_delete":false,"product_type":"c1","uid":1247006,"ip_address":"","ucode":"CEE0C006387A03","user_header":"https://static001.geekbang.org/account/avatar/00/13/07/1e/bdbe93f4.jpg","comment_is_top":false,"comment_ctime":1545783100,"is_pvip":false,"replies":[{"id":"19555","content":"æŠ±æ­‰ï¼Œæ˜¯è¦å†™æˆwhere c=5 , å‘èµ·å ªè¯¯äº†","user_name":"ä½œè€…å›å¤","comment_id":53969,"uid":"1264162","ip_address":"","utype":1,"ctime":1545789352,"user_name_real":"æ—æ™“æ–Œ"}],"discussion_count":1,"race_medal":0,"score":"23020619580","product_id":100020801,"comment_content":"è¯¾åé—®é¢˜ï¼šdè¿™ä¸€åˆ—ä¸å­˜åœ¨ï¼Œä½†æ˜¯è¿˜æ˜¯è¦åŠ MDLé”ï¼Œé‡Šæ”¾æ—¶é—´åº”è¯¥æ˜¯äº‹åŠ¡æäº¤æ—¶ã€‚","like_count":5,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434304,"discussion_content":"æŠ±æ­‰ï¼Œæ˜¯è¦å†™æˆwhere c=5 , å‘èµ·å ªè¯¯äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545789352,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112050,"user_name":"æ®‹å¤©å™¬é­‚","can_delete":false,"product_type":"c1","uid":1506609,"ip_address":"","ucode":"A2AD8303A4518D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/q2HwchogzNiavKhIB4GfAxH6B88NhSoC7B7keVEUqiaP6JPokDUNJLYehocOyqYqrhA3iaxywyRXLYkYJjDUQESZw/132","comment_is_top":false,"comment_ctime":1562660267,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"18742529451","product_id":100020801,"comment_content":"ä¸ºå•¥æˆ‘å¼€å¯äº†æ€§èƒ½ç›‘æ§ï¼ŒæŒ‰ç…§æ¡ˆä¾‹1æ‰§è¡ŒåŠ é”ï¼Œselect * from sys.schema_table_lock_waits;è¿™ä¸ªæ²¡æœ‰ç»“æœå•Š","like_count":4,"discussions":[{"author":{"id":1082785,"avatar":"https://static001.geekbang.org/account/avatar/00/10/85/a1/2442332c.jpg","nickname":"éƒ­ä¿Šæ°","note":"","ucode":"D328E5738A4413","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":1712,"discussion_content":"ä¿ºä¹Ÿä¸€æ ·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562835793,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54328,"user_name":"æŸã€äºº","can_delete":false,"product_type":"c1","uid":1308784,"ip_address":"","ucode":"ADB42AA12A11C1","user_header":"https://static001.geekbang.org/account/avatar/00/13/f8/70/f3a33a14.jpg","comment_is_top":false,"comment_ctime":1545829007,"is_pvip":false,"replies":[{"id":"19680","content":"Flush tablesæ˜¯ä¼šå…³æ‰è¡¨ï¼Œç„¶åä¸‹æ¬¡è¯·æ±‚é‡æ–°è¯»è¡¨ä¿¡æ¯çš„<br><br>ç¬¬ä¸€æ¬¡æ‰“å¼€è¡¨å…¶å®å°±æ˜¯open_table_definitionsï¼ŒåŒ…æ‹¬è¯»è¡¨ä¿¡æ¯ä¸€ç±»çš„<br><br>ä¹‹åå†æœ‰æŸ¥è¯¢å°±æ˜¯æ‹·è´ä¸€ä¸ªå¯¹è±¡ï¼ŒåŠ ä¸€ä¸ªè®¡æ•°è¿™æ ·çš„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545831983,"ip_address":"","comment_id":54328,"utype":1}],"discussion_count":2,"race_medal":0,"score":"18725698191","product_id":100020801,"comment_content":"è€å¸ˆæˆ‘è¯·æ•™ä¸€ä¸ªé—®é¢˜:<br>flush tablesä¸­close tableçš„æ„æ€æ˜¯è¯´çš„æŠŠopen_tablesé‡Œçš„è¡¨å…¨éƒ¨å…³é—­æ‰?ä¸‹æ¬¡å¦‚æœæœ‰å…³äºæŸå¼ è¡¨çš„æ“ä½œ<br>åˆæŠŠfrm fileç¼“å­˜è¿›Open_table_definitions,æŠŠè¡¨åç¼“å­˜åˆ°open_tables,è¿˜æ˜¯open_tableåªæ˜¯ä¸€ä¸ªè®¡æ•°?<br>ä¸æ˜¯ç‰¹åˆ«æ˜ç™½flush tableå’Œæ‰“å¼€è¡¨æ˜¯ä¸ªä»€ä¹ˆæµç¨‹","like_count":4,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434429,"discussion_content":"Flush tablesæ˜¯ä¼šå…³æ‰è¡¨ï¼Œç„¶åä¸‹æ¬¡è¯·æ±‚é‡æ–°è¯»è¡¨ä¿¡æ¯çš„\n\nç¬¬ä¸€æ¬¡æ‰“å¼€è¡¨å…¶å®å°±æ˜¯open_table_definitionsï¼ŒåŒ…æ‹¬è¯»è¡¨ä¿¡æ¯ä¸€ç±»çš„\n\nä¹‹åå†æœ‰æŸ¥è¯¢å°±æ˜¯æ‹·è´ä¸€ä¸ªå¯¹è±¡ï¼ŒåŠ ä¸€ä¸ªè®¡æ•°è¿™æ ·çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545831983,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1970443,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIx1V1QAxC4NHaxYZGyuibBN8lcURJWc5nrnO4yic1kxnDemYV2FJGialf47kYX9qtDnZZOfe1SJeLicg/132","nickname":"lleft","note":"","ucode":"D573EB509455AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373701,"discussion_content":"flush table with read lockä¸æ˜¯åŠ å…¨å±€è¯»é”å‘¢ï¼Œæ€ä¹ˆè¿˜å…³é—­è¡¨äº†ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620827624,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91316,"user_name":"ä¹”çº³æ£®","can_delete":false,"product_type":"c1","uid":1045107,"ip_address":"","ucode":"51EC9FAE071388","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f2/73/1c7bceae.jpg","comment_is_top":false,"comment_ctime":1556978204,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"14441880092","product_id":100020801,"comment_content":"performance_schema=ON;<br>server  version: 5.7.25-28 (percona server)<br>æ—è€å¸ˆï¼Œå¥½æƒ³æœ‰ä¸ªç¾¤å¯ä»¥å¿«é€Ÿäº¤æµçš„ï¼Œä½†ä¹ŸçŸ¥é“IM ä¿¡æ¯è¿‡å¤šï¼Œå®¹æ˜“ç»™äººå›°æ‰°<br>","like_count":3},{"had_liked":false,"id":62535,"user_name":"æ°ä¹‹7","can_delete":false,"product_type":"c1","uid":1297232,"ip_address":"","ucode":"F7DA2E21085332","user_header":"https://static001.geekbang.org/account/avatar/00/13/cb/50/66d0bd7f.jpg","comment_is_top":false,"comment_ctime":1548084534,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"14432986422","product_id":100020801,"comment_content":"é€šè¿‡è¿™ä¸€èŠ‚çš„é˜…è¯»å­¦ä¹ ï¼Œè€å¸ˆè®²è¿°äº†ä¸€ä¸ªæŸ¥è¯¢è¯­å¥è¢«é”ä½å’ŒæŸ¥è¯¢æ…¢çš„ä¸¤ç§æƒ…å†µã€‚<br><br>åœ¨è¢«é”ä½ä¸­ï¼Œé€šè¿‡ç­‰MDLé”ï¼Œå µä½äº†selectæŸ¥è¯¢è¯­å¥ï¼Œå¯ä»¥é€šè¿‡kissæ‰æŒæœ‰MDLå†™é”ã€‚ç¬¬äºŒç§æ˜¯flushè¢«åˆ«çš„è¯­å¥å µä½ï¼Œç„¶åflushå µä½selectè¯­å¥ã€‚ç¬¬ä¸‰ç§æ˜¯ç­‰è¡Œé”ï¼Œé€šè¿‡sys.innodb_lock_waitæŸ¥åˆ°ï¼Œç„¶åkillã€‚<br><br>åœ¨æŸ¥è¯¢æ…¢ä¸­ï¼Œlock in sharde modeç›´æ¥è¯»1000001<br>è€Œselect * from t where id=1éœ€è¦ä»1000001æ‰§è¡Œ100ç™¾ä¸‡è¡Œï¼Œæ‰€ä»¥æŸ¥è¯¢å°±æ…¢äº†ã€‚<br><br>è€å¸ˆæ˜¨å¤©ç»™æˆ‘äº†å­¦ä¹ çš„å»ºè®®ï¼Œæ¯ä¸ªäº‹ä¾‹åœ¨Mysqlä¸­å»è¿è¡Œåšï¼Œæœ‰ä¸æ‡‚çš„é—®è€å¸ˆã€‚çœŸçš„éå¸¸æ„ŸåŠ¨ï¼Œä¹Ÿç»™æˆ‘äº†ä¼šä¸€ç›´è·Ÿéšè€å¸ˆå­¦ä¹ çš„åŠ¨åŠ›å’Œå‹‡æ°”ã€‚å­¦äº†ä¸“æ çš„ä¸€åŠï¼Œéœ€è¦æŠŠä¹‹å‰å­¦çš„å†…å®¹å¤ä¹ ï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šè·Ÿè¿›è€å¸ˆçš„è¯¾ç¨‹åŒæ—¶åŠ¨æ‰‹åšä¹‹å‰çš„æ¡ˆä¾‹ï¼Œä¸æ‡‚æœ‰æˆ‘çš„æ€è€ƒä¹‹åï¼Œä¼šåŠæ—¶è¯·æ•™è€å¸ˆã€‚","like_count":3,"discussions":[{"author":{"id":1655940,"avatar":"https://static001.geekbang.org/account/avatar/00/19/44/84/4da14994.jpg","nickname":"å‘†ç“œ","note":"","ucode":"C98C7B224D0640","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":348733,"discussion_content":"Flushæ˜¯åŠ è¯»é”ï¼Œä¸ºä»€ä¹ˆä¼šé˜»å¡åé¢çš„selectè¯­å¥ï¼Ÿï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612693784,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1970443,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIx1V1QAxC4NHaxYZGyuibBN8lcURJWc5nrnO4yic1kxnDemYV2FJGialf47kYX9qtDnZZOfe1SJeLicg/132","nickname":"lleft","note":"","ucode":"D573EB509455AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1655940,"avatar":"https://static001.geekbang.org/account/avatar/00/19/44/84/4da14994.jpg","nickname":"å‘†ç“œ","note":"","ucode":"C98C7B224D0640","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373700,"discussion_content":"\nflushæˆåŠŸè·å¾—é”ä¹‹å‰å¿…é¡»è¦ç­‰æ‰€æœ‰çš„è¯­å¥æ‰§è¡Œå®Œä¹‹åï¼ŒåŒ…æ‹¬select","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620827496,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":348733,"ip_address":""},"score":373700,"extra":""}]}]},{"had_liked":false,"id":56118,"user_name":"ä½“è‚²è©è¨","can_delete":false,"product_type":"c1","uid":1322720,"ip_address":"","ucode":"AB4017CD117592","user_header":"https://static001.geekbang.org/account/avatar/00/14/2e/e0/b22a0145.jpg","comment_is_top":false,"comment_ctime":1546394163,"is_pvip":false,"replies":[{"id":"20203","content":"é¢å‰é¢çš„æ–‡ç« æœ‰ğŸ˜„ 04ç¯‡","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546394965,"ip_address":"","comment_id":56118,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14431296051","product_id":100020801,"comment_content":"è€å¸ˆ,å›è¡¨æ˜¯ä»€ä¹ˆæ„æ€,æœ‰æ˜ç¡®çš„å®šä¹‰å—?æœ‰æ‰§è¡Œçš„è¯¦ç»†æ­¥éª¤å—?æˆ‘åœ¨ç™¾åº¦ä¸Šæœä¸åˆ°ç›¸å…³çš„ä¿¡æ¯å•Š.å›è¡¨çš„è‹±æ–‡æ˜¯ä»€ä¹ˆ?æˆ‘æƒ³ä¸ŠgoogleæŸ¥ä¸€æŸ¥","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434935,"discussion_content":"é¢å‰é¢çš„æ–‡ç« æœ‰ğŸ˜„ 04ç¯‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546394965,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54600,"user_name":"å°æå­","can_delete":false,"product_type":"c1","uid":1196293,"ip_address":"","ucode":"C5593E33CA6F4C","user_header":"https://static001.geekbang.org/account/avatar/00/12/41/05/5ba603f2.jpg","comment_is_top":false,"comment_ctime":1545911451,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"14430813339","product_id":100020801,"comment_content":"è€å¸ˆï¼Œä¸ºä»€ä¹ˆsession B æ‰§è¡Œäº† select in share mode ï¼Œåœ¨ç­‰è¡Œé”çš„æ—¶å€™ï¼Œsession C æ‰§è¡Œ <br>select * from sys.innodb_lock_waits where locked_table=&#39;`test`.`t`&#39; ä¼šæŠ¥è¿™ä¸ªé”™ <br>[Err] 1356 - View &#39;sys.innodb_lock_waits&#39; references invalid table(s) or column(s) or function(s) or definer&#47;invoker of view lack rights to use themï¼Œè€Œè¶…æ—¶ä¹‹åï¼Œåˆå¯ä»¥æŸ¥äº†ï¼Ÿå¦å¤–ï¼Œ\\G å‚æ•°ä¼šæŠ¥è¯­æ³•é”™è¯¯ï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1228852,"avatar":"https://static001.geekbang.org/account/avatar/00/12/c0/34/0574bb44.jpg","nickname":"æœ€åˆçš„å°è±¡","note":"","ucode":"4DD68307FA274E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":131622,"discussion_content":"select * from sys.innodb_lock_waits;ä½ ç”¨è¿™å¥sqlæŸ¥ï¼Œä¸è¦åŠ whereæ¡ä»¶äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1578843046,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1615539,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI6LXcIqb5K48nia8d4zmdsD1M9AZeyXoGrLzX5xvqfN0fqXOsYKUWLbZvZ8TtJCXWmYbCkCXg93dQ/132","nickname":"æ¼è„šè„–","note":"","ucode":"214AE52EC201E6","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1228852,"avatar":"https://static001.geekbang.org/account/avatar/00/12/c0/34/0574bb44.jpg","nickname":"æœ€åˆçš„å°è±¡","note":"","ucode":"4DD68307FA274E","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":194477,"discussion_content":"è¯·é—®ä¸ºå•¥æˆ‘innodb_lock_waitsæŸ¥å‡ºæ¥éƒ½æ˜¯ç©ºçš„å‘¢ï¼Œéƒ½å·²ç»é”äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583224079,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":131622,"ip_address":""},"score":194477,"extra":""}]}]},{"had_liked":false,"id":54026,"user_name":"Arvin LI","can_delete":false,"product_type":"c1","uid":1275595,"ip_address":"","ucode":"23AA16137DBF6B","user_header":"https://static001.geekbang.org/account/avatar/00/13/76/cb/ca506ee2.jpg","comment_is_top":false,"comment_ctime":1545787379,"is_pvip":false,"replies":[{"id":"19561","content":"å¯¹çš„<br>è¿™ä¸ªçŸ¥è¯†ç‚¹ç”±äºåœ¨å‰é¢çš„æ–‡ç« ä¸­å·²ç»æåˆ°è¿‡ï¼Œå°±æ²¡å†å±•å¼€","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545789818,"ip_address":"","comment_id":54026,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14430689267","product_id":100020801,"comment_content":"select * from t where id = 1åŸ·è¡Œ800é‚£ä¸ªcaseï¼Œå¦‚æœå°†sessionAçš„start transaction with consistant snapshotæ”¹ä¸ºstart transactionåˆ™ä¸ä¼šæ‰§è¡Œé‚£ä¹ˆæ…¢ï¼ŒåŸå› ï¼Œè¿™ç§æƒ…å†µä¸‹ä¼šåœ¨æ‰§è¡Œç¬¬ä¸€ä¸ªselectçš„æ—¶å€™æ‰çœŸæ­£å¼€å¯äº‹åŠ¡ï¼Œå› ä¸ºsessionBæ²¡æœ‰æ˜¾ç¤ºå¼€å¯äº‹åŠ¡ï¼Œä½†æ˜¯æ‰§è¡Œupdateè¯­å¥æœ¬èº«å°±æœ‰äº‹åŠ¡ï¼Œåªä¸è¿‡æ‰§è¡Œå®Œå³æäº¤ï¼Œé‚£ä¹ˆselect * from t where id = 1å°†ä¼šè¿”å›æœ€æ–°å€¼ï¼Œä¹Ÿå°±æ˜¯1000001","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434329,"discussion_content":"å¯¹çš„\nè¿™ä¸ªçŸ¥è¯†ç‚¹ç”±äºåœ¨å‰é¢çš„æ–‡ç« ä¸­å·²ç»æåˆ°è¿‡ï¼Œå°±æ²¡å†å±•å¼€","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545789818,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53946,"user_name":"å°˜å°","can_delete":false,"product_type":"c1","uid":1247006,"ip_address":"","ucode":"CEE0C006387A03","user_header":"https://static001.geekbang.org/account/avatar/00/13/07/1e/bdbe93f4.jpg","comment_is_top":false,"comment_ctime":1545778878,"is_pvip":false,"replies":[{"id":"19557","content":"æœ‰ğŸ˜„ è¿™ä¸ªæ˜¯åœ¨åé¢çš„æ–‡ç« ä¸­ä¼šç”¨åˆ°çš„ä¾‹å­","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545789433,"ip_address":"","comment_id":53946,"utype":1}],"discussion_count":1,"race_medal":0,"score":"14430680766","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæœ‰æ²¡æœ‰é‡åˆ°è¿‡selectè¯­å¥ä¸€ç›´å¤„äºkilledçŠ¶æ€çš„æƒ…å†µï¼Ÿ","like_count":3,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434295,"discussion_content":"æœ‰ğŸ˜„ è¿™ä¸ªæ˜¯åœ¨åé¢çš„æ–‡ç« ä¸­ä¼šç”¨åˆ°çš„ä¾‹å­","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545789433,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":68030,"user_name":"çœ‹ä¸åˆ°deé¢œè‰²","can_delete":false,"product_type":"c1","uid":1162714,"ip_address":"","ucode":"88348CCAE81931","user_header":"https://static001.geekbang.org/account/avatar/00/11/bd/da/3d76ea74.jpg","comment_is_top":false,"comment_ctime":1550392679,"is_pvip":false,"replies":[{"id":"24113","content":"å¦‚æœå¯¹å¸¦ç´¢å¼•çš„å­—æ®µåŠ é”ï¼Œåªä¼šé”ä½æŒ‡å®šæ•°æ®è¡Œï¼Œ<br>è¿˜æœ‰é—´éš™å“ˆï¼Œ å¯ä»¥è·³çœ‹ä¸€ä¸‹21ç¯‡","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1550402186,"ip_address":"","comment_id":68030,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10140327271","product_id":100020801,"comment_content":"å®æ“äº†ä¸€æŠŠã€‚åœ¨RRçº§åˆ«ä¸‹ï¼Œæ— è®ºXé”è¿˜æ˜¯Sé”ã€‚å¦‚æœå¯¹å¸¦ç´¢å¼•çš„å­—æ®µåŠ é”ï¼Œåªä¼šé”ä½æŒ‡å®šæ•°æ®è¡Œã€‚ä½†æ˜¯å¯¹æ— ç´¢å¼•å­—æ®µè¿›è¡ŒåŠ é”ï¼Œä¼šå¯¹æ•´è¡¨æ•°æ®è¿›è¡Œé€ä¸€åŠ é”ã€‚","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":439480,"discussion_content":"å¦‚æœå¯¹å¸¦ç´¢å¼•çš„å­—æ®µåŠ é”ï¼Œåªä¼šé”ä½æŒ‡å®šæ•°æ®è¡Œï¼Œ\nè¿˜æœ‰é—´éš™å“ˆï¼Œ å¯ä»¥è·³çœ‹ä¸€ä¸‹21ç¯‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1550402186,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58669,"user_name":"å”åä¹‹","can_delete":false,"product_type":"c1","uid":1004394,"ip_address":"","ucode":"F472C71E043E03","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/JKKWS6TzhncvAA0p0NDiaATPIvMicSM76vNAg9IG1ibibcJYPAiaicYjZfq4gAV8GRtcTpOibfRD8vzqHBtL0ibmhwQsbg/132","comment_is_top":false,"comment_ctime":1547171064,"is_pvip":false,"replies":[{"id":"21220","content":"SELECT * from sys.schema_table_lock_waits; æ˜¯éœ€è¦é…ç½®é‡Œé¢æŠŠperformance_schemaæ‰“å¼€çš„ï¼›<br><br>å‰é¢ä¸¤ä¸ªè¯­å¥æ˜¯åªä¼šæ˜¾ç¤ºè·Ÿinnodbçš„è¡Œé”ç›¸å…³çš„ï¼Œè¡¨çº§çš„é”ä¸ä¼šæ˜¾ç¤ºåœ¨è¿™ä¸¤ä¸ªè¡¨","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547179511,"ip_address":"","comment_id":58669,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10137105656","product_id":100020801,"comment_content":"ç¯å¢ƒï¼šmysql-5.7.24<br>show VARIABLES LIKE &#39;performance%&#39;;<br>performance_schema ON<br><br>Açª—å£æ‰§è¡Œï¼šlock table t WRITE;<br><br>Bçª—å£æ‰§è¡Œï¼šselect * from t where id=1;<br><br>Cçª—å£æ‰§è¡Œï¼šshow PROCESSLIST;<br>53\tslave_user\tDESKTOP-00HHFO4:63064\t\tBinlog Dump\t3027\tMaster has sent all binlog to slave; waiting for more updates\t<br>54\troot\tlocalhost:64572\t\tSleep\t157\t\t<br>55\troot\tlocalhost:64573\tmysql_action\tSleep\t158\t\t<br>56\troot\tlocalhost:64575\tmysql_action\tSleep\t156\t\t<br>57\troot\tlocalhost:64576\tmysql_action\tSleep\t156\t\t<br>58\troot\tlocalhost:64577\tmysql_action\tSleep\t156\t\t<br>59\troot\tlocalhost:64578\tmysql_action\tSleep\t156\t\t<br>60\troot\tlocalhost:64579\tmysql_action\tSleep\t144\t\t<br>61\troot\tlocalhost:64581\tmysql_action\tQuery\t140\tWaiting for table metadata lock\tselect * from t where id=1<br>62\troot\tlocalhost:64583\tmysql_action\tQuery\t0\tstarting\t<br><br>show PROCESSLIST<br>å·²å‡ºç°ï¼šâ€œWaiting for table metadata â€ ä½†è¿™ä¸‰å¼ è¡¨éƒ½æŸ¥ä¸å‡ºæ•°æ®ï¼Œæ±‚è§£ï¼›<br>SELECT * FROM INFORMATION_SCHEMA.INNODB_LOCKS;<br>SELECT * FROM INFORMATION_SCHEMA.INNODB_LOCK_WAITSï¼›<br>SELECT * from sys.schema_table_lock_waits;","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436160,"discussion_content":"SELECT * from sys.schema_table_lock_waits; æ˜¯éœ€è¦é…ç½®é‡Œé¢æŠŠperformance_schemaæ‰“å¼€çš„ï¼›\n\nå‰é¢ä¸¤ä¸ªè¯­å¥æ˜¯åªä¼šæ˜¾ç¤ºè·Ÿinnodbçš„è¡Œé”ç›¸å…³çš„ï¼Œè¡¨çº§çš„é”ä¸ä¼šæ˜¾ç¤ºåœ¨è¿™ä¸¤ä¸ªè¡¨","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547179511,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58272,"user_name":"M","can_delete":false,"product_type":"c1","uid":1238308,"ip_address":"","ucode":"DFEA2ECECFAA6E","user_header":"https://static001.geekbang.org/account/avatar/00/12/e5/24/753e7a29.jpg","comment_is_top":false,"comment_ctime":1547024735,"is_pvip":false,"replies":[{"id":"21016","content":"å¤šè°¢é¼“åŠ±<br><br>çœ‹æ–‡ç« çš„åŒå­¦éƒ½å¾ˆç»†è‡´ï¼Œä¸æ•¢ä¸è®¤çœŸğŸ˜„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547043784,"ip_address":"","comment_id":58272,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10136959327","product_id":100020801,"comment_content":"è€å¸ˆè®²çš„å¾ˆå¥½","like_count":2,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435982,"discussion_content":"å¤šè°¢é¼“åŠ±\n\nçœ‹æ–‡ç« çš„åŒå­¦éƒ½å¾ˆç»†è‡´ï¼Œä¸æ•¢ä¸è®¤çœŸğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547043784,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54651,"user_name":"éƒ­å¥","can_delete":false,"product_type":"c1","uid":1102204,"ip_address":"","ucode":"169645EBF3B46C","user_header":"https://static001.geekbang.org/account/avatar/00/10/d1/7c/4639f22c.jpg","comment_is_top":false,"comment_ctime":1545922956,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10135857548","product_id":100020801,"comment_content":"è°¢è°¢è€å¸ˆçš„å›ç­”ï¼Œç½‘ä¸Šçš„æ€»æ˜¯è¯´æ²¡ç´¢å¼•ç”¨çš„æ˜¯è¡¨é”ï¼Œè¿™æ˜¯ä¸€ç§ä¸¥é‡çš„è¯¯å¯¼ï¼Œå¤ªè°¢è°¢è€å¸ˆäº†ï¼ï¼ï¼","like_count":2},{"had_liked":false,"id":54401,"user_name":"ä¿¡ä¿¡","can_delete":false,"product_type":"c1","uid":1303865,"ip_address":"","ucode":"8DF0EC045579FD","user_header":"https://static001.geekbang.org/account/avatar/00/13/e5/39/951f89c8.jpg","comment_is_top":false,"comment_ctime":1545843244,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10135777836","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œå›¾3ä¸Šæ–¹æåˆ°MySQL 5.7 ç‰ˆæœ¬ä¿®æ”¹äº† MDL çš„åŠ é”ç­–ç•¥ï¼Œä¸èƒ½å¤ç°ç¬¬å…­ç« çš„åœºæ™¯ã€‚ä½†æˆ‘è®¤ä¸ºåªè¦ä»ç„¶æ»¡è¶³ï¼šDMLæ“ä½œåŠ MDLè¯»é”ï¼ŒDDLæ“ä½œåŠ MDLå†™é”ï¼Œå¹¶ä¸”äº‹åŠ¡æäº¤æ‰é‡Šæ”¾é”ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¤ç°å•Šã€‚ã€‚ã€‚æ‰€ä»¥5.7åˆ°åº•æ˜¯æ”¹äº†ä»€ä¹ˆå¯¼è‡´æ— æ³•å¤ç°çš„å‘¢ï¼Ÿ<br>","like_count":2,"discussions":[{"author":{"id":1672786,"avatar":"https://static001.geekbang.org/account/avatar/00/19/86/52/91c7d112.jpg","nickname":"Garen","note":"","ucode":"0608C88F83EF0C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":35850,"discussion_content":"åº”è¯¥æ˜¯onlineDDLå§ï¼","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1571310331,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":342507,"user_name":"æˆ‘æ˜¯å¤§æ©™å­132","can_delete":false,"product_type":"c1","uid":2497728,"ip_address":"","ucode":"61660568CF07C9","user_header":"https://static001.geekbang.org/account/avatar/00/26/1c/c0/b8ff566a.jpg","comment_is_top":false,"comment_ctime":1650295355,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5945262651","product_id":100020801,"comment_content":"1ã€åŠ é”<br>RCï¼šä¼šé”ä¸Šä¸»é”®ç´¢å¼•ä¸­çš„æ‰€æœ‰è¡Œï¼›<br>RRï¼šä¼šé”ä¸Šä¸»é”®ç´¢å¼•ä¸­çš„è¡Œï¼Œå¹¶ä¸”è¿˜ä¼šé”ä¸Šidé—´çš„ç©ºéš™ï¼ˆé—´éš™é”ï¼‰ã€‚<br><br>2ã€é‡Šæ”¾<br>RCï¼šæ²¡åŒ¹é…åˆ°çš„è¡Œé”æå‰é‡Šæ”¾ï¼Œé™¤æ­¤ä»¥å¤–ï¼Œä¸¤é˜¶æ®µåè®®ï¼Œc=5å³id=5çš„è¡Œçš„è¡Œé”commitæ—¶é‡Šæ”¾ã€‚<br>RRï¼šä¸¤é˜¶æ®µåè®®ï¼Œè¡Œé”å’Œé—´éš™é”åœ¨commitæ—¶é‡Šæ”¾ã€‚<br><br>å¦å¤–ï¼ŒRCéš”ç¦»çº§åˆ«ä¸‹ï¼Œå¦‚æœè®¾ç½®äº†innodb_locks_unsafe_for_binlog å¼€å¯ semi-consistent readçš„è¯ï¼Œå¯¹äºä¸æ»¡è¶³æŸ¥è¯¢æ¡ä»¶çš„è®°å½•ï¼ŒMySQL ä¼šæå‰æ”¾é”ï¼Œä¸è¿‡åŠ é”çš„è¿‡ç¨‹æ˜¯ä¸å¯é¿å…çš„ã€‚ï¼ˆè¿™é‡Œçš„selectåŠ äº†for updateå¯ä»¥çº¦ç­‰updateè¯­å¥ï¼‰<br><br>å¯å‚è€ƒï¼š<br>15.7.2.1 Transaction Isolation Levels<br>https:&#47;&#47;dev.mysql.com&#47;doc&#47;refman&#47;8.0&#47;en&#47;innodb-transaction-isolation-levels.html<br><br>Using READ COMMITTED has additional effects:<br>For UPDATE or DELETE statements, InnoDB holds locks only for rows that it updates or deletes. <br>Record locks for nonmatching rows are released after MySQL has evaluated the WHERE condition. <br>This greatly reduces the probability of deadlocks, but they can still happen.<br><br>For UPDATE statements, if a row is already locked, <br>InnoDB performs a â€œsemi-consistentâ€ read, returning the latest committed version to MySQL so that MySQL can determine whether the row matches the WHERE condition of the UPDATE. <br>If the row matches (must be updated), MySQL reads the row again and this time InnoDB either locks it or waits for a lock on it.<br><br>å¤§è‡´æ„æ€ï¼š<br>RCéš”ç¦»çº§åˆ«æœ‰ä¸¤ä¸ªé¢å¤–æƒ…å†µï¼š<br>1ã€æ›´æ–°ï¼ˆUPDATEï¼‰å’Œåˆ é™¤ï¼ˆåˆ é™¤ï¼‰è¯­å¥æœ€ç»ˆä»…å¯¹åŒ¹é…åˆ°çš„è¡ŒåŠ é”ï¼›ï¼ˆåœ¨åˆ¤æ–­WHEREæ¡ä»¶åä¼šé‡Šæ”¾æ‰æ²¡åŒ¹é…åˆ°çš„è¡Œé”ï¼Œè™½ç„¶è¿˜ä¼šå‘ç”Ÿæ­»é”ï¼Œä½†è¿™ä¸ªé¢å¤–åŠ¨ä½œé™ä½äº†å‘ç”Ÿçš„å¯èƒ½æ€§ï¼‰<br>2ã€ä¸“é—¨é’ˆå¯¹æ›´æ–°ï¼ˆUPDATEï¼‰è¯­å¥è¿˜æœ‰ä¸€ä¸ªä¼˜åŒ–ï¼šæŸè¡Œå¦‚æœè¢«é”äº†ï¼ŒInnoDBä¼šæœ‰ä¸ªâ€œåŠä¸€è‡´æ€§è¯»ï¼ˆsemi-consistent readï¼‰â€ï¼Œå…·ä½“è¡¨ç°ä¸ºè·å–è¯¥è¡Œå½“å‰å€¼ï¼Œè‹¥åˆšå¥½æ˜¯è¦UPDATEçš„è¡Œï¼Œå°±åªèƒ½ç­‰å¾…ï¼Œå¦åˆ™è¿˜å¯ä»¥è·³è¿‡ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼ˆè€ŒDELETEè¯­å¥é‡åˆ°å¸¦é”è¡Œåªèƒ½é˜»å¡ç­‰é”é‡Šæ”¾ï¼‰<br>ç»¼ä¸Šä¸¤ç‚¹ï¼šUPDATEåªå¯¹åŒ¹é…åˆ°çš„è¡ŒåŠ é”ï¼Œåªè¦æ”¹è¡Œæ²¡é”å°±èƒ½æ‰§è¡Œï¼›DELETEä¹Ÿä»…å¯¹åŒ¹é…åˆ°çš„è¡ŒåŠ é”ï¼Œä½†æ˜¯æ‰«ææ—¶ä¸€é‡åˆ°æœ‰é”çš„è¡Œå°±è¢«é˜»å¡ï¼ˆBLOCKEDï¼‰ï¼›<br>","like_count":2},{"had_liked":false,"id":224752,"user_name":"Tomy","can_delete":false,"product_type":"c1","uid":1192601,"ip_address":"","ucode":"D7E49E90B0D60F","user_header":"https://static001.geekbang.org/account/avatar/00/12/32/99/91b58bf7.jpg","comment_is_top":false,"comment_ctime":1591529400,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"5886496696","product_id":100020801,"comment_content":"å¦‚ä½•æŸ¥çœ‹æ…¢æŸ¥è¯¢æ—¥å¿—","like_count":1,"discussions":[{"author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"æˆ’é…’çš„æç™½","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":403556,"discussion_content":"show variables like &#39;slow_query_log_file&#39;  æŸ¥çœ‹æ…¢æ—¥å¿—åç§°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634107919,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1970443,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIx1V1QAxC4NHaxYZGyuibBN8lcURJWc5nrnO4yic1kxnDemYV2FJGialf47kYX9qtDnZZOfe1SJeLicg/132","nickname":"lleft","note":"","ucode":"D573EB509455AE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":373704,"discussion_content":"å¯ä»¥åœ¨çº¿å¼€å¯ï¼Œlong_query_timeã€slow_query_log","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620829721,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2034632,"avatar":"https://static001.geekbang.org/account/avatar/00/1f/0b/c8/15f055d3.jpg","nickname":"å›¾çµæœº","note":"","ucode":"EB02DB653AD591","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":283169,"discussion_content":"çœ‹ä½ é…ç½®æ–‡ä»¶æ˜¯å¦é…ç½®äº†å¯åŠ¨æ…¢æŸ¥è¯¢ï¼Œä»¥åŠæ…¢æŸ¥è¯¢æ—¥å¿—æ–‡ä»¶ä½ç½®","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592202612,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":177365,"user_name":"escray","can_delete":false,"product_type":"c1","uid":1020525,"ip_address":"","ucode":"1F4204930E47C4","user_header":"https://static001.geekbang.org/account/avatar/00/0f/92/6d/becd841a.jpg","comment_is_top":false,"comment_ctime":1581372449,"is_pvip":true,"discussion_count":1,"race_medal":2,"score":"5876339745","product_id":100020801,"comment_content":"MySQLå®æˆ˜45è®²<br>19 | ä¸ºä»€ä¹ˆæˆ‘åªæŸ¥ä¸€è¡Œçš„è¯­å¥ï¼Œä¹Ÿæ‰§è¡Œè¿™ä¹ˆæ…¢ï¼Ÿ<br><br>ä¸ºäº†æ›´æ–° 1000000 æ¬¡ï¼Œæ‰€ä»¥ç®€å•å†™äº†ä¸ª procedureï¼Œä»æˆ‘çš„æ…¢æŸ¥è¯¢æ—¥å¿—æ¥çœ‹ï¼Œä¼¼ä¹ä¸¤æ¡ Select è¯­å¥çš„å·®åˆ«ä¸åƒä¸å¥‡è€å¸ˆä¸“æ é‡Œé¢è¯´çš„é‚£ä¹ˆæ˜æ˜¾ï¼Œå¤§æ¦‚æ˜¯ä¸åˆ°åå€çš„æ—¶é—´å·®è·ã€‚å¦‚æœå†æ‰§è¡Œä¸€è½®ï¼Œé‚£ä¹ˆå‡ ä¹æ²¡æœ‰å·®åˆ«ã€‚<br><br>delimiter ;;<br>create procedure update10k()<br>begin<br> declare i int;<br> set i=1;<br> while(i&lt;1000000) do<br>  update ttt set c=c+1 where id=1;<br>  set i=i+1;<br> end while;<br>end;;<br>delimiter ;<br><br>å¯¹äºæ€è€ƒé¢˜ï¼Œé‚£ä¸ª for update ä¸å¤ªç†è§£ï¼ŒæŸ¥äº†ä¸€ä¸‹ MySQL çš„åœ¨çº¿æ–‡æ¡£ï¼Œçœ‹åˆ°åœ¨ MySQL 8.0 ç‰ˆæœ¬ä¹‹å select â€¦ for share æ›¿ä»£äº† select â€¦ lock in share modeã€‚<br><br>select â€¦ for update å…¶å®å°±æ˜¯ä¸€ä¸ª reading lockï¼Œç”¨æ¥ä¿è¯åœ¨äº‹åŠ¡æ‰§è¡Œå®Œæˆä¹‹å‰ï¼Œè¯¥æ¡è®°å½•ä¸ä¼šè¢«å…¶ä»–è¿›ç¨‹æ”¹å†™ã€‚<br><br>è¿™ä¸¤ç§è¯»é”éƒ½ä¼šåœ¨äº‹åŠ¡æäº¤æˆ–è€…å›æ»šåè§£é™¤ã€‚å¦å¤–æ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ï¼Œselect è¿˜æœ‰ nowait å’Œ skip locked ä¸¤ä¸ªå‚æ•°ã€‚<br><br>å›åˆ°æ€è€ƒé¢˜ï¼Œæˆ‘è§‰å¾—åœ¨ begin ä¹‹åä¼šåŠ ä¸€ä¸ªé”ï¼ˆè¯»ä¸€è‡´æ€§é”ï¼Ÿï¼‰ï¼Œç„¶ååœ¨ select â€¦ for update çš„æ—¶å€™åŠ ä¸€ä¸ªè¯»é”ï¼Œç„¶å commit ä¹‹åï¼Œä¾æ¬¡é‡Šæ”¾è¯»é”å’Œè¯»ä¸€è‡´æ€§é”ã€‚<br><br>@å°å»ºçš„é£ çš„é‚£ä¸ªç•™è¨€ï¼Œåœ¨ä¸Šä¸€è®²è€å¸ˆæ²¡æœ‰å›å¤ï¼Œæˆ‘ä¹Ÿå°±å¿½ç•¥äº†ï¼Œç»è¿‡æ¥æ—¶çš„è®²è§£ï¼Œè¿˜çœŸæ˜¯ä¸€ä¸ªæŒºæœ‰æ„æ€çš„ä¾‹å­ã€‚<br><br>ä¹‹å‰ä¸€ç›´æ²¡ææ˜ç™½ä»€ä¹ˆæ˜¯ S é”ï¼Œä»€ä¹ˆæ˜¯ X é”ï¼Œè¿˜æœ‰ gap é”ï¼Œå†ä¸€æ¬¡å»æ‰¾ MySQL çš„æ–‡æ¡£ã€‚<br><br>åŸæ¥ S é”å°±æ˜¯ shared lock å…è®¸äº‹åŠ¡ä¿ç•™ä¸€ä¸ªè¯»é”ï¼ŒX é”å°±æ˜¯ exclusive lock å…è®¸äº‹åŠ¡æŒæœ‰å†™é”ï¼ˆä¸å…è®¸å…¶ä»–äº‹åŠ¡æ›´æ–°æˆ–åˆ é™¤è¡Œï¼‰ï¼Œè¿™ä¸¤ä¸ªéƒ½æ˜¯ InnoDB å¼•æ“å®ç°çš„è¡Œé”ã€‚<br><br>MySQL è¿˜æ”¯æŒ multiple granularity lockingï¼Œæœ‰ intention locksï¼Œå¯¹åº”çš„ select â€¦ for share è®¾ç½® IS é”ï¼ˆintention shared lockï¼‰ï¼Œselect â€¦ for update è®¾ç½® IX é”ï¼ˆintention exclusive lockï¼‰ã€‚<br><br>gap lock ç”¨äºåœ¨ç´¢å¼•è®°å½•ä¹‹é—´ä¸Šé”ï¼Œç±»ä¼¼äº <br><br>select c1 from t where c1 between 10 and 20 for update.<br><br>gap lock æ˜¯åœ¨å¹¶å‘å’Œæ€§èƒ½ä¹‹é—´çš„ä¸€ç§å¦¥åã€‚<br><br>è¿˜æœ‰ next-key lockï¼Œinsert intention lock, auto-inc lock, predicate lockï¼ŒInnoDB å¼•æ“çš„é”è¿˜çœŸæ˜¯å¤šå•Šã€‚<br><br>å¤ç°äº†ä¸€ä¸‹ @æŸã€äºº çš„æµ‹è¯•æ–¹æ¡ˆï¼Œå¹¶ä¸”æŒ‰ç…§è€å¸ˆçš„æç¤ºå¢åŠ äº† session 4: update t set c=100 where id=10; åœ¨ RC æ¨¡å¼ä¸‹ session 4 å¯ä»¥æ‰§è¡ŒæˆåŠŸï¼ŒRR æ¨¡å¼ä¸‹ session 4 ç­‰å¾…ã€‚<br><br>æŒ‰ç…§ @è€æ¨åŒå¿— çš„éªŒè¯æ–¹æ³•ï¼Œåœ¨ RR æ¨¡å¼ä¸‹ï¼Œsession A æ‰§è¡Œï¼š<br><br>begin;<br>select * from t where c=4 for update;<br><br>ç„¶å session B æ‰§è¡Œï¼šselect * from t where c=5 for update; è¢«é”ï¼Œç„¶å session A æäº¤ commit;ï¼Œsession B ä¹‹æ‰§è¡Œã€‚<br><br>å¦‚æœåè¿‡æ¥ï¼Œé‚£ä¹ˆ session A ä¸å—å½±å“ã€‚<br><br>åœ¨ RC æ¨¡å¼ä¸‹ï¼Œæˆ‘åšå‡ºæ¥çš„ç»“æœæ˜¯åŒæ ·çš„ï¼Œè¿™ä¸ªæœ‰ç‚¹å¥‡æ€ªã€‚<br><br>æˆ‘ç°åœ¨çš„å­¦ä¹ æ¨¡å¼åŸºæœ¬ä¸Šæ˜¯ç”¨åŠä¸ªå°æ—¶å·¦å³çœ‹ä¸“æ ï¼Œç„¶ååŠä¸ªå°æ—¶çœ‹ç•™è¨€ï¼Œå‰©ä¸‹çš„ç•™è¨€å°±æ”¾å¼ƒäº†ã€‚","like_count":1,"discussions":[{"author":{"id":1417349,"avatar":"https://static001.geekbang.org/account/avatar/00/15/a0/85/54e55c04.jpg","nickname":"ç‹‚å¥”çš„yå…ˆç”Ÿ","note":"","ucode":"C0D78EC4B16E7C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":393605,"discussion_content":"åä¸€ä¸ªsessionçš„æŸ¥è¯¢sqlï¼Œwhereæ¡ä»¶ä¸èƒ½å†ä»¥cä¸ºæ¡ä»¶äº†ï¼Œå¦‚æœè¿˜æ˜¯ä»¥cå­—æ®µä¸ºæ¡ä»¶çš„è¯ï¼Œåˆä¼šé”ä½å…¨éƒ¨è®°å½•ï¼Œæ‰€ä»¥ä½ åœ¨RRå’ŒRCçº§åˆ«ä¸‹åšå‡ºæ¥çš„åšè¿‡æ˜¯ä¸€æ ·çš„ã€‚åä¸€ä¸ªsessionçš„æŸ¥è¯¢sqlï¼Œwhereæ¡ä»¶æ¢æˆidå­—æ®µå°±å¯ä»¥çœ‹å‡ºRRå’ŒRCçº§åˆ«ä¸‹çš„å·®åˆ«äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1631515724,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":172145,"user_name":"å°æŸ’","can_delete":false,"product_type":"c1","uid":1137277,"ip_address":"","ucode":"09AFAB893C7CC9","user_header":"https://static001.geekbang.org/account/avatar/00/11/5a/7d/f25ef54e.jpg","comment_is_top":false,"comment_ctime":1579095645,"is_pvip":false,"replies":[{"id":"66826","content":"æ˜¯çš„ï¼ŒğŸ‘ç»†è‡´ï¼Œæˆ‘ä»¬å‘èµ·å‹˜è¯¯","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1579149394,"ip_address":"","comment_id":172145,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5874062941","product_id":100020801,"comment_content":"æ–‡æœ«<br><br>è¯„è®ºåŒºç•™è¨€ç‚¹èµæ¿ï¼š<br>@èµ–é˜¿ç”˜ æåˆ°äº†ç­‰å·é¡ºåºé—®é¢˜ï¼Œæ—¶é—´ä¸Š MySQL ä¼˜åŒ–å™¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œwhere æ¡ä»¶éƒ¨åˆ†ï¼Œ a=b å’Œ b=a çš„å†™æ³•æ˜¯ä¸€æ ·çš„ã€‚<br><br>ä¸­<br>â€œæ—¶é—´ä¸Šâ€æ˜¯å¦ç¬”è¯¯ï¼ŸæŒ‰è¯­å¢ƒå¯èƒ½æ˜¯â€œå®é™…ä¸Šâ€ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":481637,"discussion_content":"æ˜¯çš„ï¼ŒğŸ‘ç»†è‡´ï¼Œæˆ‘ä»¬å‘èµ·å‹˜è¯¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579149394,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":111034,"user_name":"hal","can_delete":false,"product_type":"c1","uid":1359844,"ip_address":"","ucode":"98E625F7327FD9","user_header":"https://static001.geekbang.org/account/avatar/00/14/bf/e4/45758517.jpg","comment_is_top":false,"comment_ctime":1562426718,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5857394014","product_id":100020801,"comment_content":"è¿™é‡Œå°æä¸€ä¸ªä¹‹å‰é‡åˆ°çš„é—®é¢˜ï¼Œåœºæ™¯æ˜¯åšä¸€ä¸ªåŠåŒæ­¥å¤åˆ¶ï¼Œåˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼Œæ­£å¸¸çš„grantå‘½ä»¤ï¼Œå¡ç€ï¼Œä¸åŠ¨äº†ã€‚ä¹Ÿæ²¡æœ‰ç»“æœè¿”å›ã€‚ç„¶åå¦èµ·ä¸ªè¿æ¥ï¼Œshow processlist;  ç ´æ¡ˆäº†ã€‚ã€‚ã€‚ã€‚<br>æˆ‘ä»¬è¿™è¾¹æ•°æ®åº“ä½¿ç”¨åŠåŒæ­¥å¤åˆ¶ï¼Œç›´æ¥ä¸€å¼€å§‹å°±æŠŠåŠåŒæ­¥çš„æ’ä»¶æ‰“å¼€äº†ï¼Œç„¶åæ‰§è¡Œgrant å‘½ä»¤æ‰§è¡Œä¹‹åä¸€ç›´ç­‰å¾…ä»åº“ç¡®è®¤ï¼Œä½†æ˜¯æ²¡æœ‰è¿™æ—¶è¿˜ä»åº“è¿æ¥ï¼Œå¯¼è‡´è¿™ä¸ªæ•°æ®åº“ä¸€ç›´åœ¨ç­‰ä»åº“è¿”å›ï¼Œç›´åˆ°10åˆ†é’Ÿåè¶…æ—¶ã€‚<br>å½“æ—¶è§£å†³çš„åŠæ³•å°±æ˜¯ä¸´æ—¶å…³é—­åŠåŒæ­¥å¤åˆ¶æ’ä»¶","like_count":1},{"had_liked":false,"id":102489,"user_name":"Larwas","can_delete":false,"product_type":"c1","uid":1105436,"ip_address":"","ucode":"AF6BAA7769311A","user_header":"https://static001.geekbang.org/account/avatar/00/10/de/1c/60ff644d.jpg","comment_is_top":false,"comment_ctime":1560234627,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5855201923","product_id":100020801,"comment_content":"è€å¸ˆè¯·æ•™ä¸€ä¸‹ï¼š æˆ‘çš„ 5.6 æ²¡æœ‰sys ç³»ç»Ÿåº“ã€‚ æ˜¯5.7 æ‰æœ‰çš„å—ï¼Ÿ5.6 çš„è¯è¦æ€ä¹ˆæŸ¥process id å‘¢ï¼Ÿ","like_count":1},{"had_liked":false,"id":54574,"user_name":"é«˜æ•","can_delete":false,"product_type":"c1","uid":1310312,"ip_address":"","ucode":"20F6CF75EC9AA4","user_header":"https://static001.geekbang.org/account/avatar/00/13/fe/68/e0bebd9a.jpg","comment_is_top":false,"comment_ctime":1545903034,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5840870330","product_id":100020801,"comment_content":"æ„Ÿè°¢è€å¸ˆè€å¿ƒè§£ç­”ï¼Œæ„Ÿè°¢æ²™æ¼ é‡Œçš„éª†é©¼çƒ­å¿ƒæ¨èï¼ğŸ™ğŸ™<br>","like_count":1},{"had_liked":false,"id":54376,"user_name":"Chu~â™¡Â·ã®~","can_delete":false,"product_type":"c1","uid":1057960,"ip_address":"","ucode":"69B0FBEC66FD48","user_header":"https://static001.geekbang.org/account/avatar/00/10/24/a8/c0148cb8.jpg","comment_is_top":false,"comment_ctime":1545837079,"is_pvip":false,"replies":[{"id":"19735","content":"ä¸‹ä¸€ç¯‡å°±è®²åˆ°ğŸ˜„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545841550,"ip_address":"","comment_id":54376,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5840804375","product_id":100020801,"comment_content":"ä¸ºä»€ä¹ˆRRçº§åˆ«ä¸‹ï¼Œselect * from t where c=5 for updateä¼šé”ä½ä¸»é”®ä¸Šçš„æ‰€æœ‰è¡Œå‘¢ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434438,"discussion_content":"ä¸‹ä¸€ç¯‡å°±è®²åˆ°ğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545841550,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":354490,"user_name":"æ— å°½è”šè“","can_delete":false,"product_type":"c1","uid":2721761,"ip_address":"ä¸Šæµ·","ucode":"A665DF46833A81","user_header":"https://static001.geekbang.org/account/avatar/00/29/87/e1/b85dce85.jpg","comment_is_top":false,"comment_ctime":1660461202,"is_pvip":true,"discussion_count":0,"race_medal":5,"score":"1660461202","product_id":100020801,"comment_content":"å…³äºselect * from sys.innodb_lock_waits where locked_table=&#39;`test`.`t`&#39;\\GæŸ¥ä¸åˆ°çš„é—®é¢˜ã€‚æ³¨æ„ï¼Œè¿™ä¸ªè¯­å¥é‡Œçš„testæ˜¯åº“åå­—ï¼Œè¦æ¢æˆè‡ªå·±çš„åº“åå­—ï¼Œå¦å¤–ï¼Œå¦‚æœä¹‹å‰é‚£ä¸ªselectè¯­å¥Lock wait timeout exceeded;ï¼Œä¹Ÿä¼šå¯¼è‡´è¿™ä¸ªè¯­å¥æŸ¥ä¸åˆ°ã€‚æˆ‘ç”¨çš„select * from sys.innodb_lock_waits where locked_table=&#39;`mysql_geek`.`t`&#39;\\G","like_count":1},{"had_liked":false,"id":354472,"user_name":"æ— å°½è”šè“","can_delete":false,"product_type":"c1","uid":2721761,"ip_address":"å¹¿ä¸œ","ucode":"A665DF46833A81","user_header":"https://static001.geekbang.org/account/avatar/00/29/87/e1/b85dce85.jpg","comment_is_top":false,"comment_ctime":1660450052,"is_pvip":true,"discussion_count":0,"race_medal":5,"score":"1660450052","product_id":100020801,"comment_content":"ç­‰ flush<br>æ¥ä¸‹æ¥ï¼Œæˆ‘ç»™ä½ ä¸¾å¦å¤–ä¸€ç§æŸ¥è¯¢è¢«å µä½çš„æƒ…å†µã€‚<br>æˆ‘åœ¨è¡¨ t ä¸Šï¼Œæ‰§è¡Œä¸‹é¢çš„ SQL è¯­å¥ï¼š<br>mysql&gt; select * from information_schema.processlist where id=1;<br><br><br>åŸæ–‡è¿™ä¸ªè¯­å¥å†™é”™äº†å§ï¼Ÿåº”è¯¥æ˜¯select * from t where id = 1å§ï¼Ÿ","like_count":1},{"had_liked":false,"id":342187,"user_name":"å†è§ç†æƒ³","can_delete":false,"product_type":"c1","uid":1245999,"ip_address":"","ucode":"FAC88B3F6F6DFD","user_header":"https://static001.geekbang.org/account/avatar/00/13/03/2f/0a5e0751.jpg","comment_is_top":false,"comment_ctime":1650092393,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1650092393","product_id":100020801,"comment_content":"å¯¼è‡´æŸ¥è¯¢ä¸€è¡Œæ•°æ®ä¹Ÿå¾ˆæ…¢çš„åŸå› æ€»ç»“<br>1.æœ‰å…¶ä»–çº¿æŒæœ‰è¿™ä¸ªè¡¨çš„mdlå†™é”ï¼Œåœ¨æ›´æ”¹è¡¨ç»“æ„<br>2.è¢«è¡¨æ‰€é˜»å¡<br>3.è¢«è¡Œé”é˜»å¡<br>4.æ²¡æœ‰å‘½ä¸­ç´¢å¼•","like_count":0},{"had_liked":false,"id":331073,"user_name":"å»ºå¼º","can_delete":false,"product_type":"c1","uid":1397126,"ip_address":"","ucode":"62B03D0E0C64EC","user_header":"https://static001.geekbang.org/account/avatar/00/15/51/86/b5fd8dd8.jpg","comment_is_top":false,"comment_ctime":1642408319,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1642408319","product_id":100020801,"comment_content":"æ€è€ƒé¢˜ï¼šMySQLåªä¼šåœ¨c=5è¿™ä¸€è¡Œçš„å½“å‰æ•°æ®ç‰ˆæœ¬ä¸ŠåŠ å†™é”ï¼Œä¸”åœ¨äº‹åŠ¡æäº¤æ—¶é‡Šæ”¾å†™é”ã€‚","like_count":0},{"had_liked":false,"id":315667,"user_name":"ç‰¹ç«‹ç‹¬è¡Œçš„çŒª","can_delete":false,"product_type":"c1","uid":1465344,"ip_address":"","ucode":"1440F96375740A","user_header":"https://static001.geekbang.org/account/avatar/00/16/5c/00/5d11e68d.jpg","comment_is_top":false,"comment_ctime":1633940153,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633940153","product_id":100020801,"comment_content":"ç¬¬ä¸€æ¬¡çŸ¥é“æœ‰flushè¿™ç§æ“ä½œ","like_count":0},{"had_liked":false,"id":314580,"user_name":"ç‰¹ç«‹ç‹¬è¡Œçš„çŒª","can_delete":false,"product_type":"c1","uid":1465344,"ip_address":"","ucode":"1440F96375740A","user_header":"https://static001.geekbang.org/account/avatar/00/16/5c/00/5d11e68d.jpg","comment_is_top":false,"comment_ctime":1633241078,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633241078","product_id":100020801,"comment_content":"æˆ‘æ›¾ç»é‡åˆ°ä¸€ä¸ªsqlï¼Œå°±æ˜¯è¡¨æ•°æ®é‡ä¸å¤§ï¼Œä½†æ˜¯å´ä¸€ç›´ä¸åä¼šç»“æœï¼Œç›´åˆ°åŠ äº†ä¸€ä¸ªç´¢å¼•ï¼Œæ‰è¿”å›ç»“æœã€‚ä½†æ˜¯æ•´è¿‡è¿‡ç¨‹ä¸­ï¼Œæ²¡æœ‰é”æŒæœ‰","like_count":0},{"had_liked":false,"id":312711,"user_name":"prader26","can_delete":false,"product_type":"c1","uid":1433707,"ip_address":"","ucode":"5EFFFC374ADECE","user_header":"https://static001.geekbang.org/account/avatar/00/15/e0/6b/f61d7466.jpg","comment_is_top":false,"comment_ctime":1631949649,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1631949649","product_id":100020801,"comment_content":"mysql ä¸­çš„æŸ¥è¯¢æ…¢ï¼Œå¯èƒ½æ˜¯æŸä¸€è¡Œè¢«é”ä½äº†ï¼Œè¿™å…¶ä¸­æ¶‰åŠåˆ°äº†è¡¨é”ã€è¡Œé”å’Œä¸€è‡´æ€§è¯»çš„æ¦‚å¿µã€‚","like_count":0},{"had_liked":false,"id":308614,"user_name":"å“‡å’”å’”","can_delete":false,"product_type":"c1","uid":2273219,"ip_address":"","ucode":"F34987823ED0D0","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Fdia5at9eFlgLbOrWaAYnYnpicfppm5AiaY5bMPpyRrLduewH1RvGFQicMpuCYG6RzWv1A7JicPy4J82ibOxdSribasicg/132","comment_is_top":false,"comment_ctime":1629703776,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1629703776","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæˆ‘æƒ³é—®ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯bufferpoolé‡ŒåŠ è½½äº†æ•°æ®åï¼Œå’Œæ²¡åŠ è½½æ•°æ®æ—¶ï¼Œè®¿é—®sqlçš„é€Ÿåº¦æ˜¯ä¸ä¸€æ ·çš„ï¼›æ—¥å¸¸è°ƒè¯•æ—¶ï¼Œå¦‚ä½•ä¸€ç›´ä¿æŒåœ¨bufferpoolæ²¡èµ·ä½œç”¨çš„åœºæ™¯ä¸‹è¿›è¡Œè°ƒè¯•å‘¢ï¼Ÿï¼ˆæˆ–è€…è¯´ï¼Œæˆ‘å¯ä»¥æ€æ ·æ¸…ç©ºbufferpoolé‡Œçš„ç¼“å­˜ï¼Ÿï¼‰","like_count":0,"discussions":[{"author":{"id":2166073,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/k3YD3y3BzGDSdrwRJyJY4BXsNJibfM4uzOdDVKIAlFApR2FZCLg2ibrZtJ4vuahA3LHLW9GKzH5CMGqCDhWjhZqg/132","nickname":"æˆ’é…’çš„æç™½","note":"","ucode":"744E1A22761647","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":403559,"discussion_content":"æŠŠè¿™ä¸ªå˜é‡  innodb_buffer_pool_sizeçš„å¤§å°è°ƒå°å³å¯ã€‚ å¯ä»¥é€šè¿‡show variables like &#39;innodb_buffer_pool_size&#39; æŸ¥çœ‹ç›®å‰çš„å¤§å°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634108316,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":306733,"user_name":"cz","can_delete":false,"product_type":"c1","uid":1008468,"ip_address":"","ucode":"96385190176F78","user_header":"https://static001.geekbang.org/account/avatar/00/0f/63/54/c9475cd0.jpg","comment_is_top":false,"comment_ctime":1628684842,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1628684842","product_id":100020801,"comment_content":"è¿™ä¸ªä¾‹å­ç»™åŠ›ï¼Œç«™åœ¨MySQLçš„è§’åº¦ï¼Œè¿™ä¸ªä¼˜åŒ–å®Œå…¨æ²¡æœ‰é—®é¢˜ï¼Œ æ˜¯æ­£å¸¸çš„ä¼˜åŒ–æ‰‹æ®µã€‚ ä½†æ˜¯å®é™…å¯¼è‡´äº†æ•ˆæœç‰¹åˆ«å·®ï¼Œè¿™ç§æƒ…å†µå°±åªèƒ½åº”ç”¨å±‚ä¸šåŠ¡ä»£ç æ¥é€‚é…ä¼˜åŒ–äº†","like_count":0},{"had_liked":false,"id":299945,"user_name":"CharAt","can_delete":false,"product_type":"c1","uid":1813207,"ip_address":"","ucode":"D7D44B48FC4E79","user_header":"https://static001.geekbang.org/account/avatar/00/1b/aa/d7/a417ad5b.jpg","comment_is_top":false,"comment_ctime":1624932090,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1624932090","product_id":100020801,"comment_content":"åœ¨åˆ·è„é¡µçš„æ—¶å€™ï¼Œæ•°æ®åº“å¯¹å¤–ä¹Ÿä¸æä¾›è¯»æœåŠ¡å˜›ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1518795,"avatar":"","nickname":"Geek_2ac804","note":"","ucode":"EDF69B20030BB8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555224,"discussion_content":"æ‰€ä»¥æ…¢æŸ¥è¯¢è¿˜æœ‰ç§å¯èƒ½æ˜¯é¡µä¸åœ¨å†…å­˜ï¼Œéœ€è¦åˆ·è¿›æ¥ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™redologæ»¡äº†ï¼Œæ­£åœ¨åˆ·ï¼Œæ‰€ä»¥å¯¼è‡´äº†SQLæ…¢","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646814299,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1813207,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/aa/d7/a417ad5b.jpg","nickname":"CharAt","note":"","ucode":"D7D44B48FC4E79","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":381210,"discussion_content":"æˆ‘ç†è§£é”™äº†ï¼Œåˆ·è„é¡µå¯¹å¤–æä¾›è¯»æœåŠ¡ï¼Œå¯èƒ½ä¼šæ…¢ã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1624954422,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":295059,"user_name":"çº¢é«˜ç²±","can_delete":false,"product_type":"c1","uid":2365564,"ip_address":"","ucode":"0DD331C8E01A81","user_header":"https://static001.geekbang.org/account/avatar/00/24/18/7c/91d6dd83.jpg","comment_is_top":false,"comment_ctime":1622199566,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1622199566","product_id":100020801,"comment_content":"èµ","like_count":0},{"had_liked":false,"id":294400,"user_name":"é™ˆå®¶ç¿","can_delete":false,"product_type":"c1","uid":1830128,"ip_address":"","ucode":"570EEC6AB6CB21","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJSaE2tKBHbZpdvicX7CNiaacXsvEHzcjMRQ5LiauDA7wFIwsCltj0HyggQsYh49VJCj5iciawceZZnl9w/132","comment_is_top":false,"comment_ctime":1621928544,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621928544","product_id":100020801,"comment_content":"5.7çš„MDLé”åŠ é”ç­–ç•¥ï¼Œä¸æ˜¯è¯»å†™äº’æ–¥äº†å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":292648,"user_name":"å¼ ä¸‰ä¸°","can_delete":false,"product_type":"c1","uid":1155275,"ip_address":"","ucode":"3A6215A40B3B21","user_header":"https://static001.geekbang.org/account/avatar/00/11/a0/cb/aab3b3e7.jpg","comment_is_top":false,"comment_ctime":1620911080,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1620911080","product_id":100020801,"comment_content":"ä¸‹é¢è¿™å¥è¯æœ‰ç‚¹ç–‘é—®ï¼Œä¸ºä»€ä¹ˆä¸æ–¹ä¾¿å‘¢ï¼Ÿç›´æ¥å·®åˆ°çº¿ç¨‹idç›´æ¥killä¸è¡Œï¼Ÿ<br><br><br>ä½†æ˜¯ï¼Œç”±äºåœ¨ show processlist çš„ç»“æœé‡Œé¢ï¼Œsession A çš„ Command åˆ—æ˜¯â€œSleepâ€ï¼Œå¯¼è‡´æŸ¥æ‰¾èµ·æ¥å¾ˆä¸æ–¹ä¾¿ã€‚","like_count":0,"discussions":[{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"æ¸©æ•…è€ŒçŸ¥æ–°å¯ä»¥ä¸ºå¸ˆçŸ£","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580344,"discussion_content":"å› ä¸ºå®é™…æƒ…å†µä¸‹å¯èƒ½å¾ˆå¤šè¿æ¥éƒ½æ˜¯è¿™ä¸ªçŠ¶æ€ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658114738,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":287002,"user_name":"åˆ˜é€¸","can_delete":false,"product_type":"c1","uid":2043906,"ip_address":"","ucode":"37E38490F2324C","user_header":"https://static001.geekbang.org/account/avatar/00/1f/30/02/d48d63f2.jpg","comment_is_top":false,"comment_ctime":1617722013,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1617722013","product_id":100020801,"comment_content":"RRéš”ç¦»çº§åˆ«ä¸‹ï¼Œä¸ºä¿è¯binlogè®°å½•é¡ºåºï¼Œéç´¢å¼•æ›´æ–°ä¼šé”ä½å…¨è¡¨è®°å½•ï¼Œä¸”äº‹åŠ¡ç»“æŸå‰ä¸ä¼šå¯¹ä¸ç¬¦åˆæ¡ä»¶è®°å½•æœ‰é€æ­¥é‡Šæ”¾çš„è¿‡ç¨‹ã€‚<br>----å¦‚ä½•ç†è§£â€œä¸ºä¿è¯binlogè®°å½•é¡ºåºâ€è¿™å¥è¯ï¼Ÿ","like_count":0},{"had_liked":false,"id":277531,"user_name":"å°ç™½ç™½ä¸ç™½","can_delete":false,"product_type":"c1","uid":1757797,"ip_address":"","ucode":"270EC3A197A8D9","user_header":"https://static001.geekbang.org/account/avatar/00/1a/d2/65/79d89c77.jpg","comment_is_top":false,"comment_ctime":1612444711,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1612444711","product_id":100020801,"comment_content":"è€å¸ˆ æˆ‘æœ‰å…³äºè¯¾åæœ‰è¶£åœºæ™¯çš„ç–‘é—®ã€‚<br>æˆ‘ä½¿ç”¨ where b=0123456789abc å»æŸ¥è¯¢åï¼Œåˆä½¿ç”¨show warnings æŸ¥çœ‹ä¼˜åŒ–å™¨é‡å†™åçš„sqlï¼Œå‘ç°sqlçš„whereå­—æ®µbå¹¶æ²¡æœ‰è¢«æˆªå–å‘€ï¼Ÿ<br>æ˜¯æˆ‘ç†è§£é”™show warningsçš„æ„æ€äº†ï¼Œè¿˜æ˜¯æœ‰å…¶ä»–åŸå› ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1171004,"avatar":"https://static001.geekbang.org/account/avatar/00/11/de/3c/96c1bc62.jpg","nickname":"å¢å»ºæ–‡","note":"","ucode":"900A0CE253F2BF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376394,"discussion_content":"å¯ä»¥ è¿™æ ·å­çœ‹ï¼Œå¯ä»¥çœ‹å‡ºmysqlæ‰§è¡Œçš„æ—¶å€™çœŸçš„ä¼˜åŒ–æˆªæ–­äº†\nset optimizer_trace=&#34;enabled=on&#34;;\n   select * from table_a where b=&#39;1234567890abcd&#39;;\nSELECT * FROM INFORMATION_SCHEMA.OPTIMIZER_TRACE;","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622107724,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":265054,"user_name":"x-rayîŒº","can_delete":false,"product_type":"c1","uid":1140175,"ip_address":"","ucode":"8363F0C4D0AC0B","user_header":"https://static001.geekbang.org/account/avatar/00/11/65/cf/326c0eea.jpg","comment_is_top":false,"comment_ctime":1606746984,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1606746984","product_id":100020801,"comment_content":"è¯·é—®ï¼Œmariadbï¼Œæ²¡æœ‰sysåº“æ€ä¹ˆæï¼Œæˆ‘åªçŸ¥é“sysåº“çš„æ•°æ®éƒ½æ˜¯æ¥è‡ªäºperformance_schemaï¼Œæ‰€ä»¥æ²¡æœ‰sysåº“çš„è¯ï¼Œæ€ä¹ˆæŸ¥performance_schemaï¼Œæ¥çœ‹innodb_lock_waits ï¼Ÿ","like_count":0},{"had_liked":false,"id":240199,"user_name":"Leon","can_delete":false,"product_type":"c1","uid":1380341,"ip_address":"","ucode":"9977EEE2D4934A","user_header":"https://static001.geekbang.org/account/avatar/00/15/0f/f5/dbbce3e9.jpg","comment_is_top":false,"comment_ctime":1596786637,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1596786637","product_id":100020801,"comment_content":"å‰è¾ˆæ‚¨å¥½ï¼š<br>å…³äº&lt;ä¸ŠæœŸæé—®æ—¶é—´&gt;ä¸­çš„é—®é¢˜ï¼Œå¦‚æœæ˜¯MySQL5.6ä¹‹åçš„ç‰ˆæœ¬ï¼Œé€šè¿‡ç´¢å¼•ä¸‹æ¨æŠ€æœ¯ï¼Œä¼šåœ¨é‚£æ¡sqlæ‰§è¡Œæµç¨‹çš„ç¬¬ä¸‰æ­¥å›è¡¨ä¹‹å‰åšæ¯”è¾ƒå§ï¼Ÿ","like_count":0},{"had_liked":false,"id":230550,"user_name":"Amo,","can_delete":false,"product_type":"c1","uid":1675087,"ip_address":"","ucode":"B77CBE5C61CDEB","user_header":"https://static001.geekbang.org/account/avatar/00/19/8f/4f/d42fdb9c.jpg","comment_is_top":false,"comment_ctime":1593415708,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1593415708","product_id":100020801,"comment_content":"è€å¸ˆï¼Œselect * from sys.schema_table_lock_waits; è¿™ä¸ªsql æŸ¥è¯¢ä¸å‡ºæ¥ç»“æœå‘¢ï¼Œä½†æ˜¯ä¹‹å‰çš„æ­¥éª¤éƒ½èƒ½å¤ç°ï¼Œæ•°æ®åº“ç‰ˆæœ¬æ˜¯5.7.30 ","like_count":0},{"had_liked":false,"id":226792,"user_name":"zhaozp","can_delete":false,"product_type":"c1","uid":1099706,"ip_address":"","ucode":"BF390F5ED762CD","user_header":"https://static001.geekbang.org/account/avatar/00/10/c7/ba/4c449be2.jpg","comment_is_top":false,"comment_ctime":1592205351,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1592205351","product_id":100020801,"comment_content":"è·ç›Šè‰¯å¤šï¼Œè°¢è°¢~","like_count":0},{"had_liked":false,"id":215046,"user_name":"æ˜ŸæœŸå…«","can_delete":false,"product_type":"c1","uid":1440429,"ip_address":"","ucode":"D8C66E7F61B0D1","user_header":"https://static001.geekbang.org/account/avatar/00/15/fa/ad/3fa02ac7.jpg","comment_is_top":false,"comment_ctime":1588897326,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588897326","product_id":100020801,"comment_content":"mdlé”ï¼Œç­‰flushï¼Œè¡Œé”ï¼Œæ…¢æŸ¥è¯¢","like_count":0},{"had_liked":false,"id":212586,"user_name":"å¹³å‡¡ä¹‹è·¯","can_delete":false,"product_type":"c1","uid":1669273,"ip_address":"","ucode":"96CE12339BD5FD","user_header":"https://static001.geekbang.org/account/avatar/00/19/78/99/6060eb2d.jpg","comment_is_top":false,"comment_ctime":1588156879,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1588156879","product_id":100020801,"comment_content":"è€å¸ˆï¼Œä½ å¥½ï¼Œçœ‹äº†ä½ çš„mysqlåï¼Œå­¦åˆ°äº†å¾ˆå¤šï¼Œè€å¸ˆæˆ‘æœ‰ä¸ªé—®é¢˜ï¼Œå°±æ˜¯æœ‰å¾ˆå¤šé¢è¯•çš„é—®ä¸€å¼ åƒä¸‡çº§åˆ«çš„è¡¨æ€ä¹ˆä¼˜åŒ–ï¼Ÿ","like_count":0},{"had_liked":false,"id":203618,"user_name":"saltedfish","can_delete":false,"product_type":"c1","uid":1946257,"ip_address":"","ucode":"936571E1AC4139","user_header":"https://static001.geekbang.org/account/avatar/00/1d/b2/91/cf0de36e.jpg","comment_is_top":false,"comment_ctime":1586242024,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586242024","product_id":100020801,"comment_content":"è€å¸ˆï¼Œ&quot;åœ¨ä¼ ç»™å¼•æ“æ‰§è¡Œçš„æ—¶å€™ï¼Œåšäº†å­—ç¬¦æˆªæ–­ã€‚å› ä¸ºå¼•æ“é‡Œé¢è¿™ä¸ªè¡Œåªå®šä¹‰äº†é•¿åº¦æ˜¯ 10ï¼Œæ‰€ä»¥åªæˆªäº†å‰ 10 ä¸ªå­—èŠ‚ï¼Œå°±æ˜¯â€™1234567890â€™è¿›å»åšåŒ¹é…ï¼›&quot;ï¼Œè¯·é—®ä¸‹MySQLä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå¹²å‘€ï¼Ÿç°åœ¨æ‰€æœ‰ç‰ˆæœ¬éƒ½æ˜¯è¿™æ ·çš„å—ï¼Ÿ","like_count":0},{"had_liked":false,"id":203610,"user_name":"saltedfish","can_delete":false,"product_type":"c1","uid":1946257,"ip_address":"","ucode":"936571E1AC4139","user_header":"https://static001.geekbang.org/account/avatar/00/1d/b2/91/cf0de36e.jpg","comment_is_top":false,"comment_ctime":1586240890,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586240890","product_id":100020801,"comment_content":"è™½ç„¶å†…å®¹æ˜¯å¹²è´§ï¼Œä½†æ˜¯æ„Ÿè§‰è¿™ä¸€èŠ‚çœ‹çš„å¾ˆä¸èˆ’æœï¼Œæ¯”å¦‚select * from t where id=1 lock in share modeé‚£é‡Œè¿”å›çš„æ˜¯1000001ï¼Œç¬¬ä¸€æ¬¡çœ‹åˆ°çš„æ—¶å€™å¾ˆæ‡µé€¼ã€‚ã€‚ã€‚éš¾é“è¿™ä¹ˆå®‰æ’çš„ç›®çš„æ˜¯è®©è¯»è€…æ¥åˆ†æä¸ºä»€ä¹ˆå—ï¼Ÿæˆ–è€…å¯èƒ½æ˜¯æˆ‘åŸºç¡€ä¸æ‰å®çš„åŸå› å§ï¼Œè€å¸ˆè§è°…ã€‚","like_count":0},{"had_liked":false,"id":201182,"user_name":"é™ˆå®¶ç¿","can_delete":false,"product_type":"c1","uid":1830128,"ip_address":"","ucode":"570EEC6AB6CB21","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJSaE2tKBHbZpdvicX7CNiaacXsvEHzcjMRQ5LiauDA7wFIwsCltj0HyggQsYh49VJCj5iciawceZZnl9w/132","comment_is_top":false,"comment_ctime":1585729073,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1585729073","product_id":100020801,"comment_content":"mysql&gt; select * from t where c=50000 limit 1;<br>+-------+-------+<br>| id    | c     |<br>+-------+-------+<br>| 50000 | 50000 |<br>+-------+-------+<br>1 row in set (1 min 43.17 sec)<br><br>mysql&gt; select * from t where id=1;<br>+----+------+<br>| id | c    |<br>+----+------+<br>|  1 |    1 |<br>+----+------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select * from t where id=1 lock in share mode;<br>+----+------+<br>| id | c    |<br>+----+------+<br>|  1 |    1 |<br>+----+------+<br>1 row in set (0.00 sec)<br><br>mysql&gt; select * from t where c=50000 limit 1;<br>+-------+-------+<br>| id    | c     |<br>+-------+-------+<br>| 50000 | 50000 |<br>+-------+-------+<br>1 row in set (0.01 sec)<br><br>mysql&gt; select * from t where c=50001 limit 1;<br>+-------+-------+<br>| id    | c     |<br>+-------+-------+<br>| 50001 | 50001 |<br>+-------+-------+<br>1 row in set (0.01 sec)<br><br>mysql&gt; select * from t where c=89001 limit 1;<br>+-------+-------+<br>| id    | c     |<br>+-------+-------+<br>| 89001 | 89001 |<br>+-------+-------+<br>1 row in set (0.02 sec)<br><br>mysql&gt; select * from t where c=66666 limit 1;<br>+-------+-------+<br>| id    | c     |<br>+-------+-------+<br>| 66666 | 66666 |<br>+-------+-------+<br>1 row in set (0.01 sec)<br><br>ä¸ºå•¥ä¹‹åçš„æŸ¥è¯¢éƒ½å¾ˆå¿«äº†å‘¢ï¼Œéš¾é“43ç§’æŸ¥è¯¢é‚£ä¸ªæŠŠå…¨è¡¨éƒ½è¯»åˆ°å†…å­˜ä¸­å»äº†å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1788647,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/4a/e7/6c16af5d.jpg","nickname":"æ±‰æ±Ÿ","note":"","ucode":"01622D984B8F9B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344253,"discussion_content":"ä¸ªäººåˆ†æ æ˜¯å› ä¸ºä½ åœ¨ç¬¬ä¸€æ¬¡select * from t where c=50000 limit 1;æ—¶æŠŠç›¸å…³çš„é¡µé¡ºå¸¦ä¸€èµ·åŠ è½½åˆ°å†…å­˜äº†ï¼Œåé¢åœ¨æŸ¥è¯¢çš„æ—¶å€™æ‰ä¼šæ¯”è¾ƒå¿«","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611372488,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":186097,"user_name":"ä¹”ä¸¹","can_delete":false,"product_type":"c1","uid":1217413,"ip_address":"","ucode":"D832A9F97A0C7E","user_header":"https://static001.geekbang.org/account/avatar/00/12/93/85/f5d9474c.jpg","comment_is_top":false,"comment_ctime":1583757184,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1583757184","product_id":100020801,"comment_content":"begin;select * from t where c=5 for update;commit;<br>åŠ çš„xé”ã€‚ç›´åˆ°commitæ‰é‡Šæ”¾ã€‚","like_count":0},{"had_liked":false,"id":179900,"user_name":"ipofss","can_delete":false,"product_type":"c1","uid":1018620,"ip_address":"","ucode":"DE3061C9259F9E","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8a/fc/d1dd57dd.jpg","comment_is_top":false,"comment_ctime":1582119507,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582119507","product_id":100020801,"comment_content":"sqlæŸ¥è¯¢æ…¢çš„åŸå› ï¼š<br>å…¨éƒ¨è¯­å¥ç‰¹åˆ«æ…¢ï¼šCPUé«˜ï¼ŒIOé«˜<br>ä¸ªåˆ«è¯­å¥ç‰¹åˆ«æ…¢ï¼šç­‰è¡¨é”ï¼Œç­‰è¡Œé”ï¼Œç­‰MDLé”<br>ä¸ªåˆ«è¯­å¥æœ‰æ—¶å€™æ…¢ï¼šæ²¡ä¸Šç´¢å¼•ï¼Œè¡¨æ•°æ®å¤ªå¤šäº†","like_count":0},{"had_liked":false,"id":175803,"user_name":"forever","can_delete":false,"product_type":"c1","uid":1574051,"ip_address":"","ucode":"3EBCD4AB045880","user_header":"https://static001.geekbang.org/account/avatar/00/18/04/a3/95de9a19.jpg","comment_is_top":false,"comment_ctime":1580829863,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1580829863","product_id":100020801,"comment_content":"å—ç›ŠåŒªæµ…","like_count":0},{"had_liked":false,"id":172147,"user_name":"å°æŸ’","can_delete":false,"product_type":"c1","uid":1137277,"ip_address":"","ucode":"09AFAB893C7CC9","user_header":"https://static001.geekbang.org/account/avatar/00/11/5a/7d/f25ef54e.jpg","comment_is_top":false,"comment_ctime":1579095795,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1579095795","product_id":100020801,"comment_content":"æ˜¨å¤©æ‰å‘ç°åŸæ¥ MySQL ç­‰å€¼æ¯”è¾ƒå­—ç¬¦ä¸²æ˜¯å¤§å°å†™ä¸æ•æ„Ÿçš„ï¼Œ<br>SELECT &#39;A&#39; ï¼&#39;a&#39; çš„æ‰§è¡Œç»“æœä¸º 1ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1282648,"avatar":"https://static001.geekbang.org/account/avatar/00/13/92/58/b4f6365d.jpg","nickname":"å°åŒ—","note":"","ucode":"3A23079E4AA92E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384754,"discussion_content":"å’Œå­—ç¬¦é›†è®¾ç½®æœ‰å…³","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626742760,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":160834,"user_name":"Anthony","can_delete":false,"product_type":"c1","uid":1309908,"ip_address":"","ucode":"9E0C98A9123365","user_header":"https://static001.geekbang.org/account/avatar/00/13/fc/d4/743d3f02.jpg","comment_is_top":false,"comment_ctime":1576043713,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1576043713","product_id":100020801,"comment_content":"ç»è¿‡æµ‹è¯•ï¼Œæ˜¯å¯¹æ•´ä¸ªè¡¨è¿›è¡Œäº†åŠ é”","like_count":0},{"had_liked":false,"id":153196,"user_name":"é•¿æœŸè§„åˆ’","can_delete":false,"product_type":"c1","uid":1019332,"ip_address":"","ucode":"5EF65E9115834B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","comment_is_top":false,"comment_ctime":1574178743,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574178743","product_id":100020801,"comment_content":"ç®€å•çš„æŸ¥è¯¢ï¼Œæ…¢çš„åŸå› ï¼šè¡¨é”ï¼Œè¡Œé”ï¼Œä¸€è‡´æ€§è¯»<br>é”æœ€å¸¸è§çš„æ˜¯MDLè¯»&#47;å†™é”ï¼Œè¡Œè¯»&#47;å†™é”ã€‚ä¸€è‡´æ€§è¯»æ…¢æ˜¯å› ä¸ºäº‹åŠ¡Aåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…¶å®ƒäº‹åŠ¡å¯¹è®°å½•æœ‰å¾ˆå¤šæ¬¡çš„æ›´æ–°ï¼Œå¯¼è‡´äº‹åŠ¡Aè¦ç”¨å¤§é‡undo logæ‰èƒ½æ‹¿åˆ°å¯åŠ¨æ—¶çš„å¿«ç…§","like_count":0},{"had_liked":false,"id":153191,"user_name":"é•¿æœŸè§„åˆ’","can_delete":false,"product_type":"c1","uid":1019332,"ip_address":"","ucode":"5EF65E9115834B","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8d/c4/6f97daea.jpg","comment_is_top":false,"comment_ctime":1574177547,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1574177547","product_id":100020801,"comment_content":"çœ‹äº†æœ€åé‚£ä¸ªä¾‹å­å¯¹MVCCæœ‰äº†æ–°çš„ç†è§£ï¼ŒMVCCä¸­çš„å¿«ç…§å…¶å®æ˜¯ç”¨æ•°æ®æœ€æ–°å€¼+undo log å®ç°çš„ï¼Œå¯¹å—ï¼Ÿè€å¸ˆ","like_count":0,"discussions":[{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"æ¸©æ•…è€ŒçŸ¥æ–°å¯ä»¥ä¸ºå¸ˆçŸ£","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":136884,"discussion_content":"åº”è¯¥æ˜¯è§†å›¾æ•°ç»„+é«˜æ°´ä½+undolog","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579170390,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":139952,"user_name":"happiness","can_delete":false,"product_type":"c1","uid":1026587,"ip_address":"","ucode":"C5F25D57C7A1DC","user_header":"https://static001.geekbang.org/account/avatar/00/0f/aa/1b/b43c8519.jpg","comment_is_top":false,"comment_ctime":1570772646,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1570772646","product_id":100020801,"comment_content":"for updateæ˜¯å†™é” æŒæœ‰é”ä»¥åä¼šæ‰§è¡Œå½“å‰è¯» åœ¨äº‹åŠ¡æäº¤ä»¥åé‡Šæ”¾é”","like_count":0},{"had_liked":false,"id":132839,"user_name":"alioo","can_delete":false,"product_type":"c1","uid":1022507,"ip_address":"","ucode":"F36A38C1F5FFAB","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqOpANMwDibLmj5IGJh6dTw300sZ1BHM5sG3sZv1A1rvCHOiblPD3jgFOiaMVVujtctWnQbVFoNPpRgw/132","comment_is_top":false,"comment_ctime":1568249858,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1568249858","product_id":100020801,"comment_content":"é€ æˆçš„åŸå› æ€»ç»“ï¼š<br>è¡¨çº§é”ï¼ˆmdlï¼Œè¡¨é”ï¼‰<br>mdl lock table t write<br>è¡¨é” flush tables t with read lock;<br><br>è¡Œé”<br>ä¹‹å‰çš„äº‹ç‰©updateåŒä¸€è¡Œæœªæäº¤ï¼Œè¡Œé”æœªé‡Šæ”¾<br><br>æŸ¥è¯¢æ…¢<br>æœªåŠ ç´¢å¼•æ‰«æè¡Œæ•°å¤š","like_count":0},{"had_liked":false,"id":130574,"user_name":"-W.LI-","can_delete":false,"product_type":"c1","uid":1210699,"ip_address":"","ucode":"3556786538664F","user_header":"https://static001.geekbang.org/account/avatar/00/12/79/4b/740f91ca.jpg","comment_is_top":false,"comment_ctime":1567486281,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1567486281","product_id":100020801,"comment_content":"è€å¸ˆå¥½!serverå±‚å’Œå­˜å‚¨å¼•æ“å±‚å…·ä½“è´Ÿè´£ä»€ä¹ˆå•Š?è§¦å‘å›è¡¨è¿™ä¸ªåŠ¨ä½œæ˜¯åœ¨å­˜å‚¨å¼•æ“å±‚è§¦å‘çš„è¿˜æ˜¯serverå±‚ã€‚ä»Šå¤©çš„è¯¾ä¸Šè®²åˆ¤æ–­æ˜¯å¦æ»¡è¶³æ¡ä»¶åœ¨serverå±‚åšã€‚å¦‚æœç´¢å¼•æ²¡æœ‰è¢«é˜¶æ®µã€‚æ˜¯å…¨çš„æ˜¯åœ¨å­˜å‚¨å¼•æ“å±‚åˆ¤æ–­ä¹ˆ?","like_count":0},{"had_liked":false,"id":119084,"user_name":"å’¸é±¼ä¸æœæ±","can_delete":false,"product_type":"c1","uid":1283861,"ip_address":"","ucode":"F79383599ACB02","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoRyUPicEMqGsbsMicHPuvwM8nibfgK8Yt0AibAGUmnic7rLF4zUZ4dBj4ialYz54fOD6sURKwuJIWBNjhg/132","comment_is_top":false,"comment_ctime":1564500533,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1564500533","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæˆ‘ä½¿ç”¨æ–‡ç« å¤´å­˜å‚¨è¿‡ç¨‹å†™å…¥æ•°æ®éå¸¸æ…¢ï¼Œå¹³å‡æ¯ç§’å¤§æ¦‚äºŒä¸‰åæ¡ï¼Œç¯å¢ƒwindows-dockerï¼Œmysql8ï¼Œæˆ‘çœ‹ä¸‹ç£ç›˜çš„å†™å…¥é€Ÿåº¦ä¸¤ä¸‰ç™¾KBï¼Œä½†æ˜¯ç£ç›˜å ç”¨æ¯”ä¾‹æ˜¯90%ï¼Œè€Œæˆ‘ä½¿ç”¨è¿…é›·ä¸‹è½½ï¼Œç£ç›˜å†™å…¥é€Ÿåº¦10+MBï¼Œç£ç›˜ä½¿ç”¨æ¯”ä¾‹10+%ï¼Œè¯·é—®è¿™ä¸ªä»€ä¹ˆåŸå› é€ æˆçš„ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"æ¸©æ•…è€ŒçŸ¥æ–°å¯ä»¥ä¸ºå¸ˆçŸ£","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":136895,"discussion_content":"set autocommit=OFFï¼Œè¯•è¯•ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579170930,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":119080,"user_name":"å’¸é±¼ä¸æœæ±","can_delete":false,"product_type":"c1","uid":1283861,"ip_address":"","ucode":"F79383599ACB02","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoRyUPicEMqGsbsMicHPuvwM8nibfgK8Yt0AibAGUmnic7rLF4zUZ4dBj4ialYz54fOD6sURKwuJIWBNjhg/132","comment_is_top":false,"comment_ctime":1564499454,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1564499454","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œè¯·æ±‚æ–‡ç« å¼€å¤´10Wè¡Œçš„æ•°æ®ï¼Œæ’å…¥ç”¨äº†åå‡ åˆ†é’Ÿ? ç¯å¢ƒï¼šdockerï¼Œmysql8.0.13","like_count":0},{"had_liked":false,"id":105993,"user_name":"immortalCockroach","can_delete":false,"product_type":"c1","uid":1157912,"ip_address":"","ucode":"9A4F497BEA7DFB","user_header":"https://static001.geekbang.org/account/avatar/00/11/ab/18/b01e71d1.jpg","comment_is_top":false,"comment_ctime":1561122231,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1561122231","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œæœ€è¿‘æˆ‘ä»¬é‡åˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå¤§æ¦‚500<br>wè¡Œçš„è¡¨ï¼Œæœ‰ç´¢å¼•ï¼Œå¹³æ—¶æŸ¥è¯¢åŸºæœ¬ä¸Šåœ¨å‡ åms<br>ä½†æ˜¯ç°åº¦å‘å¸ƒçš„æ—¶å€™ï¼Œçªç„¶å‡ºç°äº†å‡ åç§’ç”šè‡³ä¸Šç™¾ç§’çš„sqlï¼Œè¯·æ•™æ‚¨ä¸‹ï¼Œæ ¹æ®æ‚¨çš„ç»éªŒè¿™ä¸ªå¯èƒ½çš„åŸå› æ˜¯ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1303322,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e3/1a/061e77b6.jpg","nickname":"äº¢æ˜Ÿä¸œ","note":"","ucode":"5E4063E83B2BB9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":321361,"discussion_content":"åº”è¯¥æ˜¯æœ‰äº‹åŠ¡å›æ»šä¹‹ç±»","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604569837,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91344,"user_name":"skying","can_delete":false,"product_type":"c1","uid":1041865,"ip_address":"","ucode":"E7CFF50AB64BB1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e5/c9/1061582b.jpg","comment_is_top":false,"comment_ctime":1556987450,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1556987450","product_id":100020801,"comment_content":"æ¨¡æ‹ŸæŸ¥è¯¢è¢«å µä½çš„æƒ…å†µï¼Œä»¥ä¸‹æ˜¯ä¸€ç§åœºæ™¯ï¼Œä¸çŸ¥é“æ˜¯å¦åˆç†ï¼Œ<br>1.<br>ä¸€ä¸ªçº¿ç¨‹ï¼š<br>    beginï¼›<br>    select * from t;<br> ç¬¬2ä¸ªçº¿ç¨‹<br>    alter table t add column name varchar(32) ;<br>  ç¬¬3ä¸ªçº¿ç¨‹ï¼š<br>     begin;<br>     select * from t;<br>   è¿™æ—¶çº¿ç¨‹2å’Œ3ä¼šè¢«é˜»å¡ã€‚<br>æ ¹æ®ä¹‹å‰å­¦ä¹ çš„çŸ¥è¯†ï¼Œmdlè¯»å’Œå†™é”æ˜¯äº’æ–¥çš„ã€‚<br>","like_count":0},{"had_liked":false,"id":91315,"user_name":"ä¹”çº³æ£®","can_delete":false,"product_type":"c1","uid":1045107,"ip_address":"","ucode":"51EC9FAE071388","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f2/73/1c7bceae.jpg","comment_is_top":false,"comment_ctime":1556977964,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1556977964","product_id":100020801,"comment_content":"å¦å¤–å›¾4 ä¸­çš„é”ç­‰å¾…æ—¶ï¼ŒæŸ¥è¯¢å¦‚ä¸‹SQL æ˜¯ç©ºçš„ï¼Œå¹¶æ²¡æœ‰æ‰¾åˆ°é˜»å¡çš„processidï¼›<br>select blocking_pid from sys.schema_table_lock_waits;","like_count":0},{"had_liked":false,"id":91314,"user_name":"ä¹”çº³æ£®","can_delete":false,"product_type":"c1","uid":1045107,"ip_address":"","ucode":"51EC9FAE071388","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f2/73/1c7bceae.jpg","comment_is_top":false,"comment_ctime":1556977731,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1556977731","product_id":100020801,"comment_content":"mysql&gt; select * from table_a where b=&#39;1234567890abcd&#39;;<br>å®é™…ç»“æœå¹¶ä¸ä¼šæ…¢ï¼›ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ<br>root@192.168.100.1:3307 [longrun]&gt; show profile for query 100014;<br>+----------------------+----------+<br>| Status               | Duration |<br>+----------------------+----------+<br>| starting             | 0.000083 |<br>| checking permissions | 0.000010 |<br>| Opening tables       | 0.000033 |<br>| init                 | 0.000029 |<br>| System lock          | 0.000085 |<br>| optimizing           | 0.000010 |<br>| statistics           | 0.000076 |<br>| preparing            | 0.000022 |<br>| executing            | 0.000023 |<br>| Sending data         | 0.052002 |<br>| end                  | 0.000024 |<br>| query end            | 0.000027 |<br>| closing tables       | 0.000025 |<br>| freeing items        | 0.000134 |<br>| logging slow query   | 0.000013 |<br>| logging slow query   | 0.000152 |<br>| cleaning up          | 0.000059 |<br>+----------------------+----------+<br><br>- å»ºè¡¨è¯­å¥, count(*)=200 000<br>``` sql<br>CREATE TABLE `table_a` (<br>  `id` int(11) NOT NULL AUTO_INCREMENT,<br>  `b` varchar(10) DEFAULT NULL,<br>  `c_qing` varchar(16) NOT NULL DEFAULT &#39;qing&#39;,<br>  PRIMARY KEY (`id`),<br>  KEY `b` (`b`)<br>) ENGINE=InnoDB AUTO_INCREMENT=200001 DEFAULT CHARSET=utf8mb4;<br>```<br>","like_count":0,"discussions":[{"author":{"id":1308854,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLHKka9hn8hYxxXLOX7spkMRUAUiauzwib2po1aNWDfqHf5jh2EHX9DdI3zvdXL6KVaiajIU01bd8wyA/132","nickname":"éª‘é¾Ÿçš„å…”å­","note":"","ucode":"3B3AF0A4F324D3","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":6396,"discussion_content":"æ–‡ä¸­è™½ç„¶æ²¡è¯´æ˜ï¼Œä½†åº”è¯¥æ˜¯å…³æ‰icpäº† ä½ è¿™ä¸ªæ˜¯é»˜è®¤å¼€å¯icp è€Œä¸”ä½ çš„è¡¨ä¹Ÿä¸å¤Ÿå¤§ ä½ æƒ³åšè¿™ä¸ªå®éªŒéœ€è¦ ç¬¬ä¸€å…³æ‰icp ç¬¬äºŒ c_qing è¿™ä¸ªåˆ— éœ€è¦å¼„ä¸ªè¶…é•¿åˆ— å°±ä¼šæœ‰å›è¡¨æ•ˆæœ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566884007,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91065,"user_name":"è«å","can_delete":false,"product_type":"c1","uid":1487905,"ip_address":"","ucode":"852C2321C45EE3","user_header":"https://static001.geekbang.org/account/avatar/00/16/b4/21/17a88779.jpg","comment_is_top":false,"comment_ctime":1556843884,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1556843884","product_id":100020801,"comment_content":"ä»è€å¸ˆçš„å›¾15çš„ä¾‹å­ï¼Œå¯å¦å¾—å‡ºè¿™æ ·çš„ç»“è®ºï¼Œå¯¹äºæ›´æ–°éå¸¸éå¸¸é¢‘ç¹çš„ä¸šåŠ¡è¡¨ï¼Œå°½å¯èƒ½ä½¿ç”¨RCéš”ç¦»ï¼Œè€ŒéRRéš”ç¦»","like_count":0,"discussions":[{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"æ¸©æ•…è€ŒçŸ¥æ–°å¯ä»¥ä¸ºå¸ˆçŸ£","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":136897,"discussion_content":"NO","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1579171011,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":89449,"user_name":"Leen","can_delete":false,"product_type":"c1","uid":1304893,"ip_address":"","ucode":"708FE1916D8A2E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIibhnQsZ2ZpyZ49nCDibawkgztgWlL3zqfibVTDhfLryfBP5ay349wQn24Vd88sZMBX6MfAcfSGymXQ/132","comment_is_top":false,"comment_ctime":1556176933,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1556176933","product_id":100020801,"comment_content":"è€å¸ˆå¥½ï¼Œåœ¨READ-COMMITTED  è¿™ä¸ªéš”ç¦»çº§åˆ«çš„æ¨¡å¼ä¸‹ï¼Œä¸€ä¸ªå¾ˆç®€å•çš„select è¯­å¥,where åé¢æœ‰ è·Ÿä¸»é”®å­—æ®µç­›é€‰ï¼Œæ­£å¸¸æƒ…å†µä¸‹æ‰§è¡Œéå¸¸å¿«ï¼Œï¼ˆæœåŠ¡å™¨ç³»ç»Ÿå‹åŠ›å¾ˆå°ï¼‰ï¼Œæ’é™¤é”è¡¨çš„æƒ…å†µå¤–ï¼Œè¿˜æœ‰ä»€ä¹ˆæƒ…å†µä¼šå¯¼è‡´ç®€å•sql å´æ‰§è¡Œäº†å¾ˆé•¿æ—¶é—´ï¼Ÿ","like_count":0},{"had_liked":false,"id":83707,"user_name":"gerry pang","can_delete":false,"product_type":"c1","uid":1068169,"ip_address":"","ucode":"54BD1D8DE1DBBF","user_header":"https://static001.geekbang.org/account/avatar/00/10/4c/89/e698c0a9.jpg","comment_is_top":false,"comment_ctime":1554707201,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554707201","product_id":100020801,"comment_content":"è€å¸ˆï¼Œç­‰è¡Œé”å®éªŒä¸­<br>mysql&gt; select * from t sys.innodb_lock_waits where locked_table=`&#39;test&#39;.&#39;t&#39;`\\G<br>è¿™ä¸ªä»£ç ä¸­ï¼Œfrom åé¢å¥½åƒå¤šå†™äº†ä¸€ä¸ª t <br>","like_count":0},{"had_liked":false,"id":83363,"user_name":"GLADIATOR","can_delete":false,"product_type":"c1","uid":1448564,"ip_address":"","ucode":"6FE14E0BCD6240","user_header":"https://static001.geekbang.org/account/avatar/00/16/1a/74/8f7f8786.jpg","comment_is_top":false,"comment_ctime":1554545312,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554545312","product_id":100020801,"comment_content":"æ—è€å¸ˆï¼Œæ‚¨å¥½<br>    æˆ‘çš„performance_schema is ON <br>  mysql&gt; show variables like &#39;%perfor%&#39;;<br>+----------------------------------------------------------+-------+<br>| Variable_name                                            | Value |<br>+----------------------------------------------------------+-------+<br>| performance_schema                                       | ON    |<br>    æˆ‘çš„mysqlç‰ˆæœ¬5.7.24ï¼Œå°è¯•çš„æ—¶å€™å‘ç°äº†å¦‚ä¸‹é—®é¢˜<br>    é”ä½äº†è¡¨T<br>        mysql&gt; lock table T write;<br>        Query OK, 0 rows affected (0.00 sec)<br>   å¦ä¸€ä¸ªterminalæŸ¥è¯¢select * from t where id=1æ—¶è¢«é˜»å¡<br> ä½†æ˜¯æŸ¥ä¸åˆ°blocking_pid ï¼Œè¿™æ˜¯ä»€ä¹ˆæƒ…å†µå‘¢<br>   mysql&gt; select blocking_pid from sys.schema_table_lock_waits;<br>   Empty set (0.00 sec)<br>  ps:å‘ç°æŸ¥è¯¢schema_table_lock_waitsè¡¨ä¸lock tableçš„è¯­å¥ä¸èƒ½æ”¾åœ¨ä¸€ä¸ªterminalæ‰§è¡Œï¼Œå¦åˆ™ä¼šæŠ¥<br>Table &#39;schema_table_lock_waits&#39; was not locked with LOCK TABLES<br>è‡ªè¡Œå°è¯•çš„åŒå­¦è¦æ³¨æ„ä¸‹ï¼Œè€å¸ˆæœ‰ç©ºçš„è¯ä¹Ÿå¯ä»¥å¸®çœ‹çœ‹ä¸ºä»€ä¹ˆã€‚ã€‚ã€‚","like_count":0},{"had_liked":false,"id":83360,"user_name":"GLADIATOR","can_delete":false,"product_type":"c1","uid":1448564,"ip_address":"","ucode":"6FE14E0BCD6240","user_header":"https://static001.geekbang.org/account/avatar/00/16/1a/74/8f7f8786.jpg","comment_is_top":false,"comment_ctime":1554544882,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1554544882","product_id":100020801,"comment_content":"æ—è€å¸ˆæ‚¨å¥½ï¼Œæˆ‘æŒ‰ç…§æ‚¨çš„æ­¥éª¤ï¼ŒsessionA lock table writeï¼›SessionB æŸ¥select * from t where id=1,ç¡®å®è¢«å µä½ï¼Œä½†æ˜¯mysql&gt; select * from sys.schema_table_lock_waits;è¿”å›ä¸ºç©ºã€‚æŸ¥processlistç¡®å®æœ‰åœ¨ç­‰MDLé”ã€‚ä½†æ˜¯select * from sys.schema_table_lock_waits;è¿”å›ä¸ºç©ºï¼Œå¹¶æ²¡æœ‰è¿”å›æŒæœ‰MDLé”çš„IDå·ï¼Œè¯·é—®æ˜¯æ€ä¹ˆå›äº‹ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1246200,"avatar":"https://static001.geekbang.org/account/avatar/00/13/03/f8/55554b12.jpg","nickname":"kai","note":"","ucode":"CFDC240DA364FB","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":296888,"discussion_content":"æˆ‘ä¹Ÿæ˜¯","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596695254,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":82669,"user_name":"äº•ç§»","can_delete":false,"product_type":"c1","uid":1256811,"ip_address":"","ucode":"1B9F27BD09AEB2","user_header":"https://static001.geekbang.org/account/avatar/00/13/2d/6b/03456250.jpg","comment_is_top":false,"comment_ctime":1554273661,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1554273661","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæˆ‘è¿™è¾¹é‡åˆ°ä¸€ä¸ªMDLé”é—®é¢˜ï¼Œä½†æ˜¯sleepçš„çº¿ç¨‹infoä¸ºNULLï¼Œå¹¶ä¸”é€šè¿‡sys.schema_table_lock_waitsè¡¨æ²¡æœ‰æ•°æ®ã€‚ä½†æ˜¯ç¡®å®å¼€å¯äº†performance_schema=ONï¼Œæ‚¨çœ‹ä¸‹ï¼Œæ€ä¹ˆè§£å†³ã€‚<br>mysql&gt; show processlist;<br>+--------+------+-----------+------+---------+------+---------------------------------+----------------------------------+<br>| Id     | User | Host      | db   | Command | Time | State                           | Info                             |<br>+--------+------+-----------+------+---------+------+---------------------------------+----------------------------------+<br>| 245682 | root | localhost | mins | Sleep   | 1418 |                                 | NULL                             |<br>| 245734 | root | localhost | mins | Query   | 1320 | Waiting for table metadata lock | select * from lesson_t limit 100 |<br>| 245743 | root | localhost | mins | Query   | 1272 | Waiting for table metadata lock | select * from lesson_t limit 100 |<br>| 245746 | root | localhost | mins | Query   |  993 | Waiting for table metadata lock | select * from lesson_t limit 100 |<br>| 245749 | root | localhost | mins | Query   |    0 | starting                        | show processlist                 |<br>+--------+------+-----------+------+---------+------+---------------------------------+----------------------------------+<br>5 rows in set (0.00 sec)<br><br>mysql&gt; select * from sys.schema_table_lock_waits;<br>Empty set (0.00 sec)<br><br>mysql&gt; show variables like &#39;performance_schema&#39;;<br>+--------------------+-------+<br>| Variable_name      | Value |<br>+--------------------+-------+<br>| performance_schema | ON    |<br>+--------------------+-------+<br>1 row in set (0.00 sec)<br>","like_count":0},{"had_liked":false,"id":82086,"user_name":"å”¯å¥¹å‘½","can_delete":false,"product_type":"c1","uid":1240398,"ip_address":"","ucode":"8F687E8D306840","user_header":"https://static001.geekbang.org/account/avatar/00/12/ed/4e/ef406442.jpg","comment_is_top":false,"comment_ctime":1554116143,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1554116143","product_id":100020801,"comment_content":"å¦‚æœæ¢æˆ mysql&gt; select id from table_a where b=&#39;1234567890abcd&#39;;<br>Â è¿™æ˜¯æœ‰ç´¢å¼•è¦†ç›–çš„ï¼Œä¸å›è¡¨ï¼Œé‚£æ­¤æ—¶éš¾é“å¯ä»¥æŸ¥åˆ°ï¼Ÿ <br>","like_count":0,"discussions":[{"author":{"id":1171004,"avatar":"https://static001.geekbang.org/account/avatar/00/11/de/3c/96c1bc62.jpg","nickname":"å¢å»ºæ–‡","note":"","ucode":"900A0CE253F2BF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":376397,"discussion_content":"ä¸€æ ·è¦åœ¨serverå±‚åœ¨æ¯”å¯¹ä¸€æ¬¡ï¼Œå›è¡¨åªæ˜¯ä¸ºäº†æŸ¥é¢å¤–å­—æ®µ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1622108028,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1065351,"avatar":"https://static001.geekbang.org/account/avatar/00/10/41/87/d26efb2e.jpg","nickname":"SuperSnow","note":"","ucode":"84C89AA8083E6A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":161436,"discussion_content":"æˆ‘ä¼°è®¡æ˜¯ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580900469,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":78008,"user_name":"æ°¸å…‰","can_delete":false,"product_type":"c1","uid":1102702,"ip_address":"","ucode":"0C54531ABED1B0","user_header":"https://static001.geekbang.org/account/avatar/00/10/d3/6e/281b85aa.jpg","comment_is_top":false,"comment_ctime":1553053726,"is_pvip":false,"replies":[{"id":"28904","content":"1. ç›´æ¥è¯»è‚¯å®šå¿«å‘€<br>2. çœ‹ä»£ç æ€ä¹ˆå†™äº†ğŸ˜†","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1553415765,"ip_address":"","comment_id":78008,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1553053726","product_id":100020801,"comment_content":"å¸¦ lock in share mode çš„ SQL è¯­ï¤†ï¼Œæ˜¯å½“å‰è¯»ï¼Œå› æ­¤ä¼šç›´æ¥è¯»åˆ° 1000001 è¿™ä¸ªç»“æœï¼Œæ‰€ä»¥é€Ÿåº¦å¾ˆ<br>å¿«ï¼›è€Œ select * from t where id=1 è¿™ä¸ªè¯­ï¤†ï¼Œæ˜¯ä¸€è‡´æ€§è¯»ï¼Œå› æ­¤éœ€è¦ä» 1000001 å¼€å§‹ï¼Œä¾æ¬¡æ‰§ï¨ˆ<br>undo logï¼Œæ‰§ï¨ˆï¦º 100 ä¸‡æ¬¡ä»¥åï¼Œæ‰å°† 1 è¿™ä¸ªç»“æœè¿”å›ã€‚     <br>é—®é¢˜ï¼š<br>1ã€æ„æ€æ˜¯ç›´æ¥è¯»é€Ÿåº¦æ¯”æ‰§è¡Œundo logå¿«ï¼Ÿ<br>2ã€çœŸå®æƒ…å†µä¼šå­˜åœ¨è¿™ç§æƒ…å†µå—ï¼Ÿå³ï¼šä¸€æ¡è®°å½•è¢«updateæ‰§è¡Œäº†å¾ˆå¤šæ¬¡ï¼Œä¸€å †undo logï¼Œè€Œæ²¡æœ‰commintã€‚","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":443934,"discussion_content":"1. ç›´æ¥è¯»è‚¯å®šå¿«å‘€\n2. çœ‹ä»£ç æ€ä¹ˆå†™äº†ğŸ˜†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1553415765,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":71740,"user_name":"ä¹¦è±ª","can_delete":false,"product_type":"c1","uid":1068091,"ip_address":"","ucode":"212FBDE59E8457","user_header":"https://static001.geekbang.org/account/avatar/00/10/4c/3b/2780fc51.jpg","comment_is_top":false,"comment_ctime":1551424063,"is_pvip":false,"replies":[{"id":"25851","content":"æ­£å¸¸åº”è¯¥å¾ˆå¿«æ‰å¯¹ï¼Œ<br>ä½ show processlist å‘æ¥çœ‹ä¸‹ï¼Œä¸€ç§å¯èƒ½æ˜¯mdlé”ç­‰å¾…","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1551427099,"ip_address":"","comment_id":71740,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1551424063","product_id":100020801,"comment_content":"è€å¸ˆï¼Œåˆ›å»ºçš„è¿™ä¸ªåä¸‡è¡Œçš„è¡¨tï¼Œæˆ‘ç”¨drop table tè¿›è¡Œåˆ é™¤ï¼Œå‘ç°éœ€è¦å¾ˆé•¿æ—¶é—´ï¼Œæ˜¯ä»€ä¹ˆé—®é¢˜é€ æˆçš„ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":441307,"discussion_content":"æ­£å¸¸åº”è¯¥å¾ˆå¿«æ‰å¯¹ï¼Œ\nä½ show processlist å‘æ¥çœ‹ä¸‹ï¼Œä¸€ç§å¯èƒ½æ˜¯mdlé”ç­‰å¾…","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1551427099,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1303322,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e3/1a/061e77b6.jpg","nickname":"äº¢æ˜Ÿä¸œ","note":"","ucode":"5E4063E83B2BB9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":321391,"discussion_content":"æ²¡æœ‰å¸¦æ¡ä»¶å§ ï¼Œç´¢å¼•dropä¹Ÿéœ€è¦æ—¶é—´","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604575009,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58746,"user_name":"å”åä¹‹","can_delete":false,"product_type":"c1","uid":1004394,"ip_address":"","ucode":"F472C71E043E03","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/JKKWS6TzhncvAA0p0NDiaATPIvMicSM76vNAg9IG1ibibcJYPAiaicYjZfq4gAV8GRtcTpOibfRD8vzqHBtL0ibmhwQsbg/132","comment_is_top":false,"comment_ctime":1547187945,"is_pvip":false,"replies":[{"id":"21232","content":"è¯¶ã€‚ã€‚é‚£å¥‡æ€ªäº†<br>æ‰§è¡Œ<br>select * from performance_schema.metadata_locks; çœ‹çœ‹ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547190587,"ip_address":"","comment_id":58746,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1547187945","product_id":100020801,"comment_content":"show VARIABLES LIKE &#39;performance%&#39;;<br>performance_schema ON<br>é…ç½®å·²ç»æ˜¯æ‰“å¼€çš„","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":436198,"discussion_content":"è¯¶ã€‚ã€‚é‚£å¥‡æ€ªäº†\næ‰§è¡Œ\nselect * from performance_schema.metadata_locks; çœ‹çœ‹ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547190587,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57788,"user_name":"alias cd=rm -rf","can_delete":false,"product_type":"c1","uid":1318325,"ip_address":"","ucode":"E7B27D76305B75","user_header":"https://static001.geekbang.org/account/avatar/00/14/1d/b5/971261fd.jpg","comment_is_top":false,"comment_ctime":1546911270,"is_pvip":false,"replies":[{"id":"21108","content":"ä¸æ˜¯é”è¡¨å“ˆï¼Œinnodbé‡Œé¢é™¤éæ˜ç¡®å†™lock tableï¼Œä¸ä¼šé”è¡¨ï¼›<br><br>è§£é”æ—¶æœºå¯¹çš„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1547117759,"ip_address":"","comment_id":57788,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1546911270","product_id":100020801,"comment_content":"æ€è€ƒé¢˜<br>cæ— ç´¢å¼•xé”åº”è¯¥æ˜¯é”è¡¨ã€‚<br>è§£é”æˆ‘è§‰å¾—åº”è¯¥æ˜¯sessionbçš„äº‹ç‰©æäº¤ä¹‹å","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":435761,"discussion_content":"ä¸æ˜¯é”è¡¨å“ˆï¼Œinnodbé‡Œé¢é™¤éæ˜ç¡®å†™lock tableï¼Œä¸ä¼šé”è¡¨ï¼›\n\nè§£é”æ—¶æœºå¯¹çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1547117759,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":56862,"user_name":"Ê˜á´—Ê˜å°ç™½å¸½Ê˜á´—Ê˜","can_delete":false,"product_type":"c1","uid":1304567,"ip_address":"","ucode":"3519C67C3B1533","user_header":"https://static001.geekbang.org/account/avatar/00/13/e7/f7/8427bb06.jpg","comment_is_top":false,"comment_ctime":1546569979,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1546569979","product_id":100020801,"comment_content":"æ¶¨çŸ¥è¯†äº†","like_count":0},{"had_liked":false,"id":55547,"user_name":"Mr.Strive.Z.H.L","can_delete":false,"product_type":"c1","uid":1030198,"ip_address":"","ucode":"6D97E159E2EECD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b8/36/542c96bf.jpg","comment_is_top":false,"comment_ctime":1546228310,"is_pvip":false,"replies":[{"id":"20080","content":"ç„¶åæœ‰å‡ºç°é”ç­‰å¾…äº†æ‰ä¼šæ˜¾ç¤ºçš„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1546243440,"ip_address":"","comment_id":55547,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1546228310","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œ<br>æˆ‘å°†performance_schemaæ‰“å¼€äº†ï¼ŒæŸ¥è¯¢process_idè¿˜æ˜¯ä¸ºç©ºã€‚<br>ä¿¡æ¯å¦‚ä¸‹ï¼š<br>mysqlç‰ˆæœ¬ï¼š5.7.24<br>performance_schemaï¼š<br>| Variable_name      | Value |<br>+--------------------+-------+<br>| performance_schema | ON    |<br><br>ä¸çŸ¥é“è¿™æ˜¯ä¸ºä»€ä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434796,"discussion_content":"ç„¶åæœ‰å‡ºç°é”ç­‰å¾…äº†æ‰ä¼šæ˜¾ç¤ºçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1546243440,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1315049,"avatar":"https://static001.geekbang.org/account/avatar/00/14/10/e9/f5e55ccf.jpg","nickname":"å°é¬¼","note":"","ucode":"52EE8A18B90C6D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":582726,"discussion_content":"https://blog.51cto.com/wujianwei/3964674çœ‹ä¸‹è¿™ä¸ª","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1659607371,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54884,"user_name":"å—å±±","can_delete":false,"product_type":"c1","uid":1119593,"ip_address":"","ucode":"94656FE4A6C378","user_header":"https://static001.geekbang.org/account/avatar/00/11/15/69/187b9968.jpg","comment_is_top":false,"comment_ctime":1545976566,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1545976566","product_id":100020801,"comment_content":"è€å¸ˆ<br>1ï¼Œconsistent snapshot æ˜¯å¯é‡å¤è¯»éš”ç¦»çº§åˆ«å—ï¼Ÿ<br>2ï¼Œsession bæ˜¯æ‰§è¡Œå®Œé»˜è®¤å°±æäº¤äº†å—ï¼Ÿæ˜¯çš„è¯undo logåº”è¯¥å°±ä¸å­˜åœ¨äº†å§ï¼Ÿè¿˜æ˜¯session a å’Œsession bå› ä¸ºæ˜¯é’ˆå¯¹åŒä¸€è¡Œè®°å½•çš„æ“ä½œï¼Œæ‰€ä»¥undo logæ˜¯åŒä¸€ä¸ªï¼Ÿ<br>å¸Œæœ›è€å¸ˆå¸®å¿™è§£ç­”ä¸€ä¸‹å•Š","like_count":0},{"had_liked":false,"id":54837,"user_name":"ä¼¼æ°´æµå¹´","can_delete":false,"product_type":"c1","uid":1304443,"ip_address":"","ucode":"D114A8E273133C","user_header":"https://static001.geekbang.org/account/avatar/00/13/e7/7b/71da8283.jpg","comment_is_top":false,"comment_ctime":1545968294,"is_pvip":false,"replies":[{"id":"19860","content":"é¢ï¼Ÿæ˜¯è¯´è¯­å¥ä¸€æ¨¡ä¸€æ ·ï¼Œå·®åˆ«åªæ˜¯ç¬¬ä¸€ä¸ªæœ‰use dingtest?<br>ç¬¬äºŒä¸ªè¯­å¥çš„å½“å‰æ•°æ®åº“æ˜¯ä»€ä¹ˆ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545972608,"ip_address":"","comment_id":54837,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545968294","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæˆ‘åœ¨è¡Œé”æŸ¥è¯¢æ˜¯ï¼Œç”¨çš„æ˜¯dingtestæ•°æ®åº“ï¼Œç”¨æ‚¨çš„è¯­å¥æ€ä¹ˆæŸ¥å‡ºæ¥æœ‰æŠ¥è¯­æ³•é”™è¯¯ã€‚åˆ°åº•é”™åœ¨å“ªé‡Œäº†ï¼Ÿ<br>use dingtest;<br>select * from  sys.innodb_lock_waits where locked_table=`&#39;dingtest&#39;.&#39;t&#39;`\\G<br>[SQL] use dingtest;<br>å—å½±å“çš„è¡Œ: 0<br>æ—¶é—´: 0.004s<br><br>[SQL] <br>select * from  sys.innodb_lock_waits where locked_table=`&#39;dingtest&#39;.&#39;t&#39;`\\G<br><br>[Err] 1064 - You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;\\G&#39; at line 1<br><br><br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434579,"discussion_content":"é¢ï¼Ÿæ˜¯è¯´è¯­å¥ä¸€æ¨¡ä¸€æ ·ï¼Œå·®åˆ«åªæ˜¯ç¬¬ä¸€ä¸ªæœ‰use dingtest?\nç¬¬äºŒä¸ªè¯­å¥çš„å½“å‰æ•°æ®åº“æ˜¯ä»€ä¹ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545972608,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54623,"user_name":"éƒ­å¥","can_delete":false,"product_type":"c1","uid":1102204,"ip_address":"","ucode":"169645EBF3B46C","user_header":"https://static001.geekbang.org/account/avatar/00/10/d1/7c/4639f22c.jpg","comment_is_top":false,"comment_ctime":1545917267,"is_pvip":false,"replies":[{"id":"19821","content":"æ²¡æœ‰è¯´â€œè¦ç”¨åˆ°ç´¢å¼•æ‰ä½¿ç”¨è¡Œé”â€å‘€<br>å°±ç®—æ²¡æœ‰ç”¨åˆ°ç´¢å¼•ï¼Œä¹Ÿä¼šç»™æ‰€æœ‰è¡ŒåŠ è¡Œé”ï¼Œå¹¶ä¸ä¼šåŠ è¡¨é”<br>","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545919991,"ip_address":"","comment_id":54623,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545917267","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œä¹‹å‰çœ‹è¿‡ä¸€ç‚¹mysqlçš„ä¹¦ï¼Œæœ‰äº›åœ°æ–¹æœ‰ç‚¹è¿·ç³Šã€‚1.æ‚¨ä¹‹å‰è¯´è¡¨é”åªæœ‰ä¸¤ç§ï¼Œä¸€ç§æ˜¯DML,å¢åˆ æ”¹æŸ¥çš„æ—¶å€™ä¸Šè¯»é”ï¼Œå¢åŠ å­—æ®µåŠ å†™é”ã€‚é‚£ä¹ˆè¯´mysqlä¸­æ•°æ®å˜æ›´ä¸ä¼šå†²çªã€‚2.ä½†æ˜¯è®²åˆ°è¡Œé”çš„æ—¶å€™ï¼Œæ˜¯ç”¨åˆ°ç´¢å¼•æ‰èƒ½ä½¿ç”¨è¡Œé”ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨åˆ°è¡Œé”å°±ä½¿ç”¨è¡¨é”ï¼Œä½†æ˜¯è¡¨é”å¢åˆ æ”¹æŸ¥ä½¿ç”¨çš„æ˜¯è¯»é”ï¼Œç›¸äº’ä¸é˜»å¡ã€‚è¿™å°±éå¸¸å†²çªï¼Œè€å¸ˆå¯ä»¥è§£æƒ‘å—","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434517,"discussion_content":"æ²¡æœ‰è¯´â€œè¦ç”¨åˆ°ç´¢å¼•æ‰ä½¿ç”¨è¡Œé”â€å‘€\nå°±ç®—æ²¡æœ‰ç”¨åˆ°ç´¢å¼•ï¼Œä¹Ÿä¼šç»™æ‰€æœ‰è¡ŒåŠ è¡Œé”ï¼Œå¹¶ä¸ä¼šåŠ è¡¨é”\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545919991,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54613,"user_name":"Elvis","can_delete":false,"product_type":"c1","uid":1308724,"ip_address":"","ucode":"1FDE773C5AA43D","user_header":"https://static001.geekbang.org/account/avatar/00/13/f8/34/2ce5e546.jpg","comment_is_top":false,"comment_ctime":1545913881,"is_pvip":false,"replies":[{"id":"19845","content":"è¿™ä¸ªæ˜¯ç´¢å¼•æœ€å¤´å¤§çš„é—®é¢˜ä¹‹ä¸€äº†â€¦ å¦‚æœæœ‰æ˜æ˜¾çš„æŸç±»ç»„åˆæŸ¥è¯¢æ˜¯æœ€å¤šçš„è¿˜å¥½ï¼Œå¦åˆ™ç¡®å®å¾ˆéº»çƒ¦ã€‚<br><br>ğŸ˜“","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545961908,"ip_address":"","comment_id":54613,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545913881","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæœ€è¿‘é¡¹ç›®mysqlé‡åˆ°ä¸€ä¸ªéš¾é¢˜ï¼Œ è¡¨æ•°æ®æ¯å¤©230ä¸‡ï¼Œä¸€æ¡è¯­å¥çš„æŸ¥è¯¢æ¡ä»¶æœ‰1â€”40ä¸ªï¼Œæœ€åæƒ…å†µä¸‹40ï¼Œè¯·é—®è€å¸ˆæœ‰æ²¡æœ‰å¥½çš„å»ºè®®ï¼Œéå¸¸æ„Ÿè°¢","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434511,"discussion_content":"è¿™ä¸ªæ˜¯ç´¢å¼•æœ€å¤´å¤§çš„é—®é¢˜ä¹‹ä¸€äº†â€¦ å¦‚æœæœ‰æ˜æ˜¾çš„æŸç±»ç»„åˆæŸ¥è¯¢æ˜¯æœ€å¤šçš„è¿˜å¥½ï¼Œå¦åˆ™ç¡®å®å¾ˆéº»çƒ¦ã€‚\n\nğŸ˜“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545961908,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54595,"user_name":"çˆ±å­¦ä¹ çš„å¥½å­©å­","can_delete":false,"product_type":"c1","uid":1331195,"ip_address":"","ucode":"C51EA3E529BE0B","user_header":"https://static001.geekbang.org/account/avatar/00/14/4f/fb/3eb917f1.jpg","comment_is_top":false,"comment_ctime":1545908979,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1545908979","product_id":100020801,"comment_content":"æ—è€å¸ˆï¼Œä½ å¥½ï¼šæœ€è¿‘æˆ‘å¬æ‚¨çš„order byåŸç†ï¼Œç°åœ¨é‡åˆ°ä¸€ä¸ªå¥‡æ€ªçš„é—®é¢˜ï¼š<br>1ã€è¡¨ç»“æ„ï¼š<br>CREATE TABLE `test` (<br>  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT &#39;è‡ªå¢id&#39;,<br>  `bid` bigint(20) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;&#39;,<br>  `status` tinyint(4) NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;&#39;,<br>  `commit_time` timestamp NOT NULL DEFAULT &#39;0000-00-00 00:00:00&#39; COMMENT &#39;&#39;,<br>  PRIMARY KEY (`id`),<br>  KEY `idx_commit` (`commit_time`),<br>  KEY `idx_bid_commit` (`bid`,`commit_time`)<br>) ENGINE=InnoDB AUTO_INCREMENT=832330;<br>2ã€æ•°æ®é‡832330ï¼Œshow index from test,å¦‚ä¸‹åˆ†å¸ƒï¼š<br>| Table        | Non_unique | Key_name              | Seq_in_index | Column_name | Collation | Cardinality |<br>+--------------+------------+-----------------------+--------------+-------------+-----------+-------------+<br>| test         |          0 | PRIMARY               |            1 | id          | A         |      839932 |          <br>| test         |          1 | idx_commit            |            1 | commit_time | A         |      774559 |     <br>| test         |          1 | idx_bid_commit        |            1 | bid         | A         |           1 |    <br>| test         |          1 | idx_bid_commit        |            2 | commit_time | A         |      791388 |     <br>bidæœ‰ä¸¤ä¸ªå€¼åˆ†åˆ«ä¸º1,2ã€‚bid=1æœ‰825747è¡Œæ•°æ®ï¼Œbid=2æœ‰6554ï¼›<br><br>é—®é¢˜ï¼šç°åœ¨æœ‰ä¸¤æ¡sqlï¼Œå¼ºåˆ¶ä½¿ç”¨ç´¢å¼•ï¼š<br>è¯­å¥1ï¼šSELECT * FROM `pano_3d_task` use index(idx_commit) WHERE `bid` = &#39;1&#39; AND `status` in (&#39;0&#39;,&#39;4&#39;) ORDER BY `commit_time` asc limit 100<br>è¯­å¥2ï¼šSELECT * FROM `pano_3d_task` use index(idx_bid_commit) WHERE `bid` = &#39;1&#39; AND `status` in (&#39;0&#39;,&#39;4&#39;) ORDER BY `commit_time` asc limit 100<br>ä»å®é™…æ•ˆæœæ¥çœ‹ï¼Œè¯­å¥2æ¯”è¯­å¥1æ…¢ï¼Œæ…¢äº†æœ‰100æ¯«ç§’ï¼ŒæŒ‰ç…§åŸç†æ¥ï¼Œç¬¬ä¸€ä¸ªè¯­å¥å…¨ç´¢å¼•æ‰«æï¼Œç¬¬äºŒä¸ªæœ‰bidç´¢å¼•ï¼ŒæŒ‰ç†åˆ†æåº”è¯¥å¿«ä¸€äº›ï¼Œæœ€èµ·ç ä¹Ÿä¸€æ ·å¿«ï¼Œä¸ºä»€ä¹ˆä¼šæ¯”è¯­å¥1æ…¢å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1788647,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/4a/e7/6c16af5d.jpg","nickname":"æ±‰æ±Ÿ","note":"","ucode":"01622D984B8F9B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":344260,"discussion_content":"ä¸ªäººåˆ†æ ç¬¬ä¸€ä¸ªä¸éœ€è¦æ’åºï¼Œç¬¬äºŒä¸ªè¯­å¥æ˜¯éœ€è¦å†…å­˜æ’åºçš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1611373925,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54489,"user_name":"LeonğŸ“·","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1545881503,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545881503","product_id":100020801,"comment_content":"å°±æ˜¯session A  local table t write<br>session B select * from t where id=1<br>ç„¶åselect blocking_id from sys.schema_table_lock_waits<br>è¡¨ç»“æ„<br> t     | CREATE TABLE `t` (<br>  `id` int(11) NOT NULL,<br>  `c` int(11) DEFAULT NULL,<br>  PRIMARY KEY (`id`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8 |<br>mysqlç‰ˆæœ¬<br>Server version: 5.7.24-log MySQL Community Server (GPL)","like_count":0},{"had_liked":false,"id":54477,"user_name":"å¸†å¸†å¸†å¸†å¸†å¸†å¸†å¸†","can_delete":false,"product_type":"c1","uid":1304645,"ip_address":"","ucode":"0CB732FFD07463","user_header":"https://static001.geekbang.org/account/avatar/00/13/e8/45/c58cb283.jpg","comment_is_top":false,"comment_ctime":1545878922,"is_pvip":false,"replies":[{"id":"19802","content":"Performance_schemaå¼€äº†å—","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545903976,"ip_address":"","comment_id":54477,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545878922","product_id":100020801,"comment_content":"æˆ‘é€šè¿‡sys.schema_table_lock_waitsæ²¡æœ‰æŸ¥åˆ°MDLçš„blocking_pidå‘¢ï¼Œæ˜¯è¿˜éœ€è¦å…¶ä»–é…ç½®å—ã€‚<br>æˆ‘çš„ç‰ˆæœ¬æ˜¯mysql5.7.18<br>mysql&gt; show processlist;<br>+----+------+-----------+-------+---------+------+---------------------------------+----------------------------+<br>| Id | User | Host      | db    | Command | Time | State                           | Info                       |<br>+----+------+-----------+-------+---------+------+---------------------------------+----------------------------+<br>| 26 | root | localhost | dbmgr | Query   |    0 | starting                        | show processlist           |<br>| 27 | root | localhost | dbmgr | Sleep   |   85 |                                 | NULL                       |<br>| 28 | root | localhost | dbmgr | Query   |  281 | Waiting for table metadata lock | select * from t where id=1 |<br>+----+------+-----------+-------+---------+------+---------------------------------+----------------------------+<br>3 rows in set (0.00 sec)<br><br>mysql&gt; <br>mysql&gt; select blocking_pid from sys.schema_table_lock_waits;<br>Empty set (0.00 sec)<br><br>mysql&gt; <br>mysql&gt; ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434467,"discussion_content":"Performance_schemaå¼€äº†å—","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545903976,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54471,"user_name":"LeonğŸ“·","can_delete":false,"product_type":"c1","uid":1219496,"ip_address":"","ucode":"B9BBD1EFAAE5A2","user_header":"https://static001.geekbang.org/account/avatar/00/12/9b/a8/6a391c66.jpg","comment_is_top":false,"comment_ctime":1545877215,"is_pvip":false,"replies":[{"id":"19751","content":"è€¶ï¼Œä½ è¿™ä¸ªæ˜¯æ€ä¹ˆå¼„å‡ºæ¥çš„ï¼Œç‰ˆæœ¬å·å’Œå¤ç°æ­¥éª¤ç»™ä¸€ä¸‹","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545881200,"ip_address":"","comment_id":54471,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545877215","product_id":100020801,"comment_content":"è€å¸ˆï¼Œè¿™æ˜¯å•¥åŸå› <br>mysql&gt; select blocking_pid from sys.schema_table_lock_waits;<br>ERROR 1100 (HY000): Table &#39;schema_table_lock_waits&#39; was not locked with LOCK TABLES<br>å’Œç½‘ä¸Šæœåˆ°çš„ä¸æ˜¯ä¸€å›äº‹","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434464,"discussion_content":"è€¶ï¼Œä½ è¿™ä¸ªæ˜¯æ€ä¹ˆå¼„å‡ºæ¥çš„ï¼Œç‰ˆæœ¬å·å’Œå¤ç°æ­¥éª¤ç»™ä¸€ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545881200,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54357,"user_name":"é«˜æ•","can_delete":false,"product_type":"c1","uid":1310312,"ip_address":"","ucode":"20F6CF75EC9AA4","user_header":"https://static001.geekbang.org/account/avatar/00/13/fe/68/e0bebd9a.jpg","comment_is_top":false,"comment_ctime":1545834422,"is_pvip":false,"replies":[{"id":"19737","content":"åªè¦è®¿é—®è¡¨ï¼Œå¢åˆ æ”¹æŸ¥ï¼Œå°±è¦åŠ MDLè¯»é”<br><br>å¿«ç…§è¯»æ²¡æœ‰è¯»é”ï¼Œå…¶å®ƒè§åˆ°çš„åŸºæœ¬éƒ½åŠ é”ã€‚<br><br>è¿™ä¸ªå…¨åˆ—å‡ºæ¥æœ‰ç‚¹éš¾ğŸ˜“","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545841760,"ip_address":"","comment_id":54357,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545834422","product_id":100020801,"comment_content":"è€å¸ˆæ‚¨å¥½ï¼Œè¿˜æ˜¯å¿ä¸ä½é—®æ‚¨ä¸€ä¸‹ï¼š<br>è¡¨çº§é”ï¼Œè¡Œçº§é”çš„äº§ç”Ÿå¯ä»¥æ˜¯æ‰§è¡Œä¸€sqlçš„æ—¶å€™éšå¼è‡ªåŠ¨åŠ ä¸Šçš„ï¼Œä¹Ÿæœ‰æ—¶å€™éœ€è¦æ˜¾å¼çš„å†™å‡ºæ¥ï¼Œæ¯”å¦‚select... lock in share modeæˆ–è€…lock tableã€‚æˆ‘è¿·æƒ‘çš„æ˜¯ï¼Œåœ¨ä¸åŒçš„éš”ç¦»çº§åˆ«ä¸‹ï¼Œå“ªäº›è¯­å¥ä¼šéšå¼çš„åŠ å“ªä¸ªçº§åˆ«çš„ï¼ˆè¡¨ï¼Œè¡Œï¼‰çš„å“ªä¸ªï¼ˆè¯»ï¼Œå†™ï¼‰é”ï¼Ÿå“ªäº›è¯­å¥ä¼šæ˜¾å¼çš„åŠ å“ªä¸ªçº§åˆ«çš„ï¼ˆè¡¨ï¼Œè¡Œï¼‰çš„å“ªä¸ªï¼ˆè¯»ï¼Œå†™ï¼‰é”ï¼Ÿèƒ½å¦éº»çƒ¦æ‚¨è®²ä¸€ä¸‹ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434435,"discussion_content":"åªè¦è®¿é—®è¡¨ï¼Œå¢åˆ æ”¹æŸ¥ï¼Œå°±è¦åŠ MDLè¯»é”\n\nå¿«ç…§è¯»æ²¡æœ‰è¯»é”ï¼Œå…¶å®ƒè§åˆ°çš„åŸºæœ¬éƒ½åŠ é”ã€‚\n\nè¿™ä¸ªå…¨åˆ—å‡ºæ¥æœ‰ç‚¹éš¾ğŸ˜“","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545841760,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54250,"user_name":"éƒ­æ±Ÿä¼Ÿ","can_delete":false,"product_type":"c1","uid":1313994,"ip_address":"","ucode":"613D638619B5A2","user_header":"https://static001.geekbang.org/account/avatar/00/14/0c/ca/6173350b.jpg","comment_is_top":false,"comment_ctime":1545815570,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545815570","product_id":100020801,"comment_content":"begin<br>select * from  t where c=5 for update;<br>innodb æŠŠæ‰€æœ‰æ‰«æåˆ°çš„æ•°æ®è¡ŒåŠ é”ï¼Œè¿”å›server å±‚åˆ¤æ–­æ˜¯å¦æœ‰ç­‰äº5çš„ï¼Œå…·ä½“éªŒè¯ä¸ºï¼š<br>åœ¨è¿è¡Œä¸Šè¿°è¯­å¥åï¼Œå¼€å¦å¤–ä¸€ä¸ªä¼šè¯ï¼Œè¿è¡Œ show engine innodb status; å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä¿¡æ¯ï¼š<br>367 lock struct(s), heap size 44480, 100366 row lock(s)<br>MySQL thread id 8, OS thread handle 140526870746880, query id 300293 localhost root<br>å¦å¤–æ­¤æ—¶å¯¹tè¡¨ä»»ä½•è¡Œçš„updateéƒ½ä¼šè¢«å µå¡ï¼Œå……åˆ†è¯´æ˜é”å®šäº†æ‰€æœ‰çš„è¡Œã€‚<br>ä½†æ˜¯æœ‰ä¸ªç–‘é—®tè¡¨åªæœ‰10wè¡Œè®°å½•ï¼Œä¸ºä»€ä¹ˆä¸Šé¢æ˜¾ç¤ºæ˜¯100366 row locksï¼Ÿ<br>","like_count":0},{"had_liked":false,"id":54143,"user_name":"é«˜æ•","can_delete":false,"product_type":"c1","uid":1310312,"ip_address":"","ucode":"20F6CF75EC9AA4","user_header":"https://static001.geekbang.org/account/avatar/00/13/fe/68/e0bebd9a.jpg","comment_is_top":false,"comment_ctime":1545797203,"is_pvip":false,"replies":[{"id":"19614","content":"21ã€22è¿™ä¸¤ç¯‡æ–‡ç« çœ‹å®Œæä¸€ä¸‹ä½ çš„å…·ä½“é—®é¢˜å“ˆ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545815757,"ip_address":"","comment_id":54143,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1545797203","product_id":100020801,"comment_content":"è€å¸ˆï¼Œèƒ½å¦ä»‹ç»ä¸€æœ¬å…³äºmysqlé”æœºåˆ¶çš„ä¹¦æˆ–è€…æ–‡ç« ï¼ŒåŒ…æ‹¬é”çš„ç§ç±»ï¼Œæ¯”å¦‚xé”ï¼Œsé”ã€‚ä»€ä¹ˆé”è¦è¯­å¥æ˜¾ç¤ºçš„å»åŠ ï¼Œä»€ä¹ˆé”é»˜è®¤è¢«åŠ ä¸Šã€‚é”ä¸é”ä¹‹é—´çš„äº’æ–¥å…³ç³»ç­‰è¿™äº›åŸºç¡€çš„çŸ¥è¯†ï¼Ÿ<br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434368,"discussion_content":"21ã€22è¿™ä¸¤ç¯‡æ–‡ç« çœ‹å®Œæä¸€ä¸‹ä½ çš„å…·ä½“é—®é¢˜å“ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545815757,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1303322,"avatar":"https://static001.geekbang.org/account/avatar/00/13/e3/1a/061e77b6.jpg","nickname":"äº¢æ˜Ÿä¸œ","note":"","ucode":"5E4063E83B2BB9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":321392,"discussion_content":"x æ’ä»–é” så…±äº«é”","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1604575237,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54119,"user_name":"vvccoe","can_delete":false,"product_type":"c1","uid":1099892,"ip_address":"","ucode":"1BE9FDE72175BE","user_header":"https://static001.geekbang.org/account/avatar/00/10/c8/74/a1bd2307.jpg","comment_is_top":false,"comment_ctime":1545795223,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545795223","product_id":100020801,"comment_content":"è€å¸ˆ è¯·æ•™2ä¸ªé—®é¢˜ã€‚<br>ä¸€ä¸ªé—®é¢˜æ˜¯ æ ¹æ®ä¸»é”® èŒƒå›´æŸ¥è¯¢ï¼Œ éšç€èŒƒå›´è¶Šå¤§ explain é‡Œé¢æ˜¾ç¤ºROWS è¶Šå¤§<br>ä¾‹å¦‚ <br>select * from XX where ID between 10 and 20 ;<br>explain æ˜¾ç¤ºROW ä¸º10 <br>betweenæ˜¯10000 and 20000çš„æ—¶å€™æ˜¾ç¤º20000+<br>betweenæ˜¯100000 and 200000çš„æ—¶å€™æ˜¾ç¤º 190000+<br>æ˜¯ä»€ä¹ˆé€ æˆçš„å•Šï¼Œæ˜¯åœ¨ä»æ•°æ®åº“ä¸ŠæŸ¥è¯¢çš„ã€‚<br><br>ç¬¬äºŒä¸ªé—®é¢˜æ˜¯ æ…¢æŸ¥è¯¢é‡Œé¢ä¼šæœ‰ä¸€ä¸ªRows_examined ï¼Œæˆ‘ç†è§£ä»–å’Œexplainéƒ½æ˜¯æŠ¥å‘Šæ‰«æçš„è¡Œæ•°ï¼Œå¦‚æœä¸¤ä¸ªä¸ä¸€æ ·ï¼Œ æ…¢æŸ¥è¯¢é‡Œé¢è®°å½•çš„æ˜¯å‡†ç¡®çš„å—ï¼Ÿ<br><br><br>","like_count":0},{"had_liked":false,"id":54110,"user_name":"æå®¢ç«¥","can_delete":false,"product_type":"c1","uid":1250397,"ip_address":"","ucode":"D92EA8CA293B93","user_header":"https://static001.geekbang.org/account/avatar/00/13/14/5d/f4d789cc.jpg","comment_is_top":false,"comment_ctime":1545794773,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545794773","product_id":100020801,"comment_content":"select * from t where d=5 for updateï¼›ç”±äºdæ²¡æœ‰ç´¢å¼•ï¼Œéœ€è¦å…¨è¡¨æ‰«æï¼Œä¼šå¯¹å…¨è¡¨åŠ è¯»å†™é”ï¼Œç›´åˆ°æ‰¾åˆ°è¿™ä¸€è¡Œï¼Œæ‰ä¼šå˜æˆå¯¹è¿™è¡ŒåŠ é”","like_count":0},{"had_liked":false,"id":54104,"user_name":"å°ç¡®å¹¸","can_delete":false,"product_type":"c1","uid":1099329,"ip_address":"","ucode":"C090505CB2DB69","user_header":"https://static001.geekbang.org/account/avatar/00/10/c6/41/b868f086.jpg","comment_is_top":false,"comment_ctime":1545794229,"is_pvip":false,"replies":[{"id":"19567","content":"é¢ï¼Œæ¯”è¾ƒåé¢äº†â€œåˆ†åŒºè¡¨â€é‚£ç¯‡","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545794380,"ip_address":"","comment_id":54104,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545794229","product_id":100020801,"comment_content":"è€å¸ˆï¼Œä»€ä¹ˆæ—¶å€™è®²åˆ†åº“åˆ†è¡¨ï¼Ÿ<br><br>ç°åœ¨å‡†å¤‡æŠŠåŸå§‹æ•°æ®æ‹†åˆ†å‡ºæ¥ï¼ˆæŒ‰å¹´åˆ†åº“ï¼ŒæŒ‰æœˆåˆ†è¡¨ï¼‰ï¼Œä¸çŸ¥é“è¦æ³¨æ„äº›ä»€ä¹ˆã€‚","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434358,"discussion_content":"é¢ï¼Œæ¯”è¾ƒåé¢äº†â€œåˆ†åŒºè¡¨â€é‚£ç¯‡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545794380,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54094,"user_name":"en","can_delete":false,"product_type":"c1","uid":1157417,"ip_address":"","ucode":"C14EDEED543AC8","user_header":"https://static001.geekbang.org/account/avatar/00/11/a9/29/dad1f942.jpg","comment_is_top":false,"comment_ctime":1545793462,"is_pvip":false,"replies":[{"id":"19570","content":"ç»“è®ºğŸ˜„ï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545794539,"ip_address":"","comment_id":54094,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545793462","product_id":100020801,"comment_content":"éªŒè¯äº†ä¸€ä¸‹ï¼ŒåŠ çš„è¡¨é”ï¼Œåœ¨äº‹åŠ¡æäº¤åé‡Šæ”¾é”ã€‚<br>éªŒè¯æ–¹æ³•:<br>å¼€å¯äº†å¦ä¸€ä¸ªäº‹åŠ¡<br>select * from t where c=6 for update;é˜»å¡äº†ï¼Œä½†æ˜¯è¯­å¥commitåé”å°±è¢«é‡Šæ”¾äº†ã€‚","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434351,"discussion_content":"ç»“è®ºğŸ˜„ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545794539,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54089,"user_name":"å¾€äº‹éšé£ï¼Œé¡ºå…¶è‡ªç„¶","can_delete":false,"product_type":"c1","uid":1235692,"ip_address":"","ucode":"F266EC6B143E38","user_header":"https://static001.geekbang.org/account/avatar/00/12/da/ec/779c1a78.jpg","comment_is_top":false,"comment_ctime":1545792656,"is_pvip":false,"replies":[{"id":"19572","content":"æŠ¥é”™ä¿¡æ¯æ˜¯ï¼Ÿ<br>","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545794869,"ip_address":"","comment_id":54089,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545792656","product_id":100020801,"comment_content":"mysql&gt; select * from t sys.innodb_lock_waits where locked_table=`&#39;test&#39;.&#39;t&#39;`\\G<br><br>æŒ‰ç…§è¿™ä¸ªæ‰§è¡Œå¯¹åº”çš„æ•°æ®åº“ä¸­è¡¨ï¼ŒæŠ¥é”™ï¼Œè¿™æ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿ<br><br>","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434349,"discussion_content":"æŠ¥é”™ä¿¡æ¯æ˜¯ï¼Ÿ\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545794869,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54085,"user_name":"æˆè‘›æ ¼","can_delete":false,"product_type":"c1","uid":1030745,"ip_address":"","ucode":"A09A57D891FA50","user_header":"https://static001.geekbang.org/account/avatar/00/0f/ba/59/ffa298a2.jpg","comment_is_top":false,"comment_ctime":1545792406,"is_pvip":false,"replies":[{"id":"19571","content":"å¯åŠ¨æ—¶éœ€è¦Performance_schema=on","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545794844,"ip_address":"","comment_id":54085,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545792406","product_id":100020801,"comment_content":"æŸ¥è¯¢é€ æˆé˜»å¡çš„ process idæ—¶ï¼Œsys.schema_table_lock_waits è¿™å¼ è¡¨ï¼Œä¸€ç›´è¿”å›ç©ºã€‚<br>è¯·é—®æœ‰æ²¡æœ‰æ˜¯æˆ‘mysqlç‰ˆæœ¬çš„é—®é¢˜å—? æˆ‘çš„ç‰ˆæœ¬å·æ˜¯ mysql 5.7.17-log.","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434348,"discussion_content":"å¯åŠ¨æ—¶éœ€è¦Performance_schema=on","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545794844,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54073,"user_name":"ä¸€æ¯æ•¬æœˆå…‰","can_delete":false,"product_type":"c1","uid":1308687,"ip_address":"","ucode":"94C801115C41C8","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIPy34APc2QAOxvRWuZWLBrZZ134Qs89K0icGye4HLacic1ekZnu2s80gMRDF5hmmu8LD0mhDsleRVg/132","comment_is_top":false,"comment_ctime":1545791353,"is_pvip":false,"replies":[{"id":"19573","content":"è¿™ä¸ªç†è§£ä¸å¤ªæ°å½“å“ˆï¼šï¼‰","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545794903,"ip_address":"","comment_id":54073,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545791353","product_id":100020801,"comment_content":"innodbè¡Œé”æ˜¯é€šè¿‡ç´¢å¼•åŠ é”å®ç°çš„ï¼Œcå­—æ®µæ²¡æœ‰ç´¢å¼•ï¼Œä¼šç›´æ¥é”è¡¨","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434347,"discussion_content":"è¿™ä¸ªç†è§£ä¸å¤ªæ°å½“å“ˆï¼šï¼‰","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545794903,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":54060,"user_name":"å¾€äº‹éšé£ï¼Œé¡ºå…¶è‡ªç„¶","can_delete":false,"product_type":"c1","uid":1235692,"ip_address":"","ucode":"F266EC6B143E38","user_header":"https://static001.geekbang.org/account/avatar/00/12/da/ec/779c1a78.jpg","comment_is_top":false,"comment_ctime":1545790371,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545790371","product_id":100020801,"comment_content":"mysql&gt; select blocking_pid from sys.schema_table_lock_waits;<br>ERROR 1100 (HY000): Table &#39;schema_table_lock_waits&#39; was not locked with LOCK TABLES ä¸ºå•¥æŠ¥è¿™ä¸ªé”™è¯¯","like_count":0},{"had_liked":false,"id":54003,"user_name":"Arthur_08320","can_delete":false,"product_type":"c1","uid":1073453,"ip_address":"","ucode":"8D173FAB9CED25","user_header":"https://static001.geekbang.org/account/avatar/00/10/61/2d/9e731599.jpg","comment_is_top":false,"comment_ctime":1545785299,"is_pvip":false,"replies":[{"id":"19552","content":"Insert ... select ä¸æ˜¯å¿«ç…§è¯»ã€‚å¯¹selectéƒ¨åˆ†æ˜¯è¦åŠ é”çš„","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545788575,"ip_address":"","comment_id":54003,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545785299","product_id":100020801,"comment_content":"insert selectçš„æ—¶å€™selectçš„è¡¨ä¹Ÿä¼šè¢«é”ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆï¼Œä¸åº”è¯¥æ˜¯å¿«ç…§è¯»å˜›ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434322,"discussion_content":"Insert ... select ä¸æ˜¯å¿«ç…§è¯»ã€‚å¯¹selectéƒ¨åˆ†æ˜¯è¦åŠ é”çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545788575,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53991,"user_name":"æœé™µé‡å®¢","can_delete":false,"product_type":"c1","uid":1307054,"ip_address":"","ucode":"C6C341537A269B","user_header":"https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKWvGcULsbNorYBqjf9ICPpNIf8MQOdRSibXptrwGia5TMDpUiaGu58icpD8qicLY78BicjYF4tbdqFibM7Q/132","comment_is_top":false,"comment_ctime":1545784482,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545784482","product_id":100020801,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼Œå®é™…å·¥ä½œè¿‡ç¨‹ä¸­ï¼Œå‡ºç°è¿‡å¥½å‡ æ¬¡è¿™æ ·çš„æƒ…å†µï¼Œä¸‹é¢çš„sqlæŸ¥è¯¢ï¼Œå¯ä»¥æŸ¥è¯¢åˆ°æœ‰äº‹åŠ¡é”ï¼Œä½†æ˜¯trx_queryæ‰§è¡Œå†…å®¹ä¸ºç©ºï¼Œæ¯æ¬¡ç±»ä¼¼æƒ…å†µéƒ½åªèƒ½killè¿™ä¸ªäº‹åŠ¡ï¼Œæ¢å¤åº”ç”¨å¯¹è¯¥è¡¨çš„æ­£å¸¸æ“ä½œã€‚<br>select * from information_schema.innodb_trx  where trx_state=&#39;RUNNING&#39; ;<br>æƒ³è¯·æ•™ä¸‹è€å¸ˆï¼Œç±»ä¼¼çš„é—®é¢˜ï¼Œåº”è¯¥æ˜¯å“ªæ–¹é¢åŸå› ï¼Ÿ <br>å¼‚å¸¸æ—¶ï¼Œä¸‹é¢çš„sqlæŸ¥è¯¢é”ä¿¡æ¯ï¼Œéƒ½æ˜¯ä¸ºç©ºçš„ï¼Œmysqlç‰ˆæœ¬ä¸ºmysql5.6.24<br>select * from information_schema.innodb_lock_waits;<br>select * from information_schema.innodb_locks;","like_count":0},{"had_liked":false,"id":53988,"user_name":"Leo","can_delete":false,"product_type":"c1","uid":1126910,"ip_address":"","ucode":"341694ACBAB258","user_header":"https://static001.geekbang.org/account/avatar/00/11/31/fe/30a17a9d.jpg","comment_is_top":false,"comment_ctime":1545784311,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1545784311","product_id":100020801,"comment_content":"è€å¸ˆä½ å¥½ï¼Œæˆ‘åœ¨å­¦ä¹ mysqkçš„è¿‡ç¨‹ä¸­ä¸€ç›´æƒ³ç†è§£ æ•°æ®å’Œç´¢å¼• ç©¶ç«Ÿæ˜¯æ€æ ·å­˜å‚¨çš„ï¼Ÿè¿™æœŸé—´çœ‹äº†ä¸€äº›æ–‡ç« ï¼Œæ€»æ˜¯ä¸€çŸ¥åŠè§£ã€‚è¯·é—®æœ‰æ²¡æœ‰å·¥å…·å¯ä»¥æŸ¥çœ‹mysqlçš„æ•°æ®æ–‡ä»¶æˆ–ç´¢å¼•æ–‡ä»¶ï¼Ÿå¯ä»¥å¸®åŠ©ç†è§£æˆ–è°ƒè¯•ç›¸å…³é—®é¢˜ï¼Œè°¢è°¢ï¼","like_count":0},{"had_liked":false,"id":53985,"user_name":"heat nan","can_delete":false,"product_type":"c1","uid":1153826,"ip_address":"","ucode":"52D5CB17CE80E5","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/22/dd04892a.jpg","comment_is_top":false,"comment_ctime":1545784246,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545784246","product_id":100020801,"comment_content":"æ—è€å¸ˆæ‚¨å¥½ï¼Œçœ‹äº†æ‚¨çš„æ–‡ç« ï¼Œå¾ˆå¤šåœ°æ–¹æåŠundo logï¼Œä½†ä¸€ç›´æƒ³ä¸æ˜ç™½ï¼Œundo logæ˜¯æ€ä¹ˆå’Œredo logç»“åˆåœ¨ä¸€èµ·çš„ï¼Ÿæˆ–è€…è¯´undo åœ¨å®•æœºæ¢å¤æ—¶æ˜¯æ€ä¹ˆèµ·ä½œç”¨çš„ï¼Ÿè¯·è€å¸ˆè§£æƒ‘ï¼Œè°¢è°¢<br>â€¦â€¦â€¦â€¦â€¦â€¦â€¦â€¦<br>è¿™æ˜¯å†·ç¬‘çš„èŠ±çŒ«æçš„é—®é¢˜ï¼Œæˆ‘æƒ³å‘è¡¨ä¸‹æ„è§ã€‚é¦–å…ˆæˆ‘æƒ³çœ‹é—®é¢˜è¦ä»å¤§çš„æ–¹é¢çœ‹ï¼Œredo logå’Œundo logæœ€å¼€å§‹éƒ½æ˜¯å­˜åœ¨å†…å­˜ä¸­çš„ï¼Œåé¢é€šè¿‡ç­–ç•¥åˆ·æ–°åˆ°ç£ç›˜ã€‚å¦‚å´©æºƒåè‚¯å®šæ˜¯ä»ç£ç›˜å†æ¬¡åŠ è½½åˆ°å†…å­˜è¿›è¡Œæ¢å¤å¤„ç†çš„ã€‚è‡³äºundo log å®ƒçš„ä½œç”¨æ˜¯å®ç°äº‹åŠ¡çš„å›æ»šä»¥mvccã€‚ç»†çš„è¯´ä½ äº‹åŠ¡æäº¤åï¼Œåˆæ²¡æœ‰åˆ«çš„äº‹åŠ¡ä½¿ç”¨ä½ çš„è®°å½•undoå…¶å®å¯ä»¥è¢«å¤ç”¨äº†ã€‚å¦‚æœä½ å´©æºƒäº†æ¶‰åŠäº‹åŠ¡å›æ»šä»€ä¹ˆçš„éœ€è¦undo å°±éœ€è¦ä»ç£ç›˜ä¸­åŠ è½½åˆ°å†…å­˜ã€‚  ","like_count":0},{"had_liked":false,"id":53983,"user_name":"æ…§é‘«coming","can_delete":false,"product_type":"c1","uid":1324385,"ip_address":"","ucode":"7BAC9CA255630E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLE4LYb3jrH63ZV98Zpc8DompwDgb1O3nffMoZCmiaibauRyEFv6NDNsST9RWxZExvMLMWb50zaanoQ/132","comment_is_top":false,"comment_ctime":1545784159,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545784159","product_id":100020801,"comment_content":"æˆ‘åœ¨mysql5.7.24ä¸­ï¼Œä»ç„¶ç”¨ä¸€ä¸ªæ˜¾å¼äº‹åŠ¡æŸ¥è¯¢ä¸æäº¤ï¼Œå¦ä¸€ä¸ªäº‹åŠ¡å¯¹è¡¨å¢åŠ ä¸€ä¸ªå­—æ®µï¼Œç¬¬ä¸‰ä¸ªäº‹åŠ¡å†æŸ¥è¯¢è¯¥è¡¨blockã€‚ä¹Ÿå°±æ˜¯æ‚¨åœ¨æ–‡ç« ä¸­è¯´çš„mysql5.7æ— æ³•å¤ç°ç¬¬6ç¯‡æ–‡ç« ä¸­åœºæ™¯ï¼Œæˆ‘æƒ³çŸ¥é“æ‚¨è¯´çš„å¤ç°åœºæ™¯æ˜¯ä¸æ˜¯æˆ‘ä¸Šé¢æè¿°çš„é‚£ä¸ªï¼Ÿè¿˜æœ‰å°±æ˜¯5.7çš„MDLé”ä¸åŒäº5.6çš„åœ°æ–¹ï¼Ÿ","like_count":0},{"had_liked":false,"id":53974,"user_name":"heat nan","can_delete":false,"product_type":"c1","uid":1153826,"ip_address":"","ucode":"52D5CB17CE80E5","user_header":"https://static001.geekbang.org/account/avatar/00/11/9b/22/dd04892a.jpg","comment_is_top":false,"comment_ctime":1545783524,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545783524","product_id":100020801,"comment_content":"è€å¸ˆè¿™ä¸ªæ€è€ƒé¢˜æ˜¯åŠ çš„IXé”ï¼Œæ„å‘æ‹ä»–é”ã€‚åŠ äº†è¿™ä¸ªé”åsé”xé”éƒ½éœ€è¦ç­‰å¾…ã€‚åœ¨commitçš„æ—¶å€™é‡Šæ”¾ã€‚å¦‚æœdè¡Œæ˜¯unique key ï¼Œinnodb è¡¨åªé”ä¸€è¡Œï¼Œå¦‚æœæ˜¯éå”¯ä¸€ï¼Œå¯èƒ½é”åˆ°å¤šè¡Œã€‚ä¸çŸ¥é“è¯´çš„å‡†ç¡®ä¸å‡†ç¡®ã€‚","like_count":0},{"had_liked":false,"id":53973,"user_name":"HuaMax","can_delete":false,"product_type":"c1","uid":1118488,"ip_address":"","ucode":"2E78DE1AF098AF","user_header":"https://static001.geekbang.org/account/avatar/00/11/11/18/8cee35f9.jpg","comment_is_top":false,"comment_ctime":1545783432,"is_pvip":false,"replies":[{"id":"19554","content":"å“¦ï¼ŒæŠ±æ­‰ï¼Œæ˜¯where c=5 ","user_name":"ä½œè€…å›å¤","user_name_real":"æ—æ™“æ–Œ","uid":"1264162","ctime":1545789229,"ip_address":"","comment_id":53973,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1545783432","product_id":100020801,"comment_content":"é—®é¢˜é‡Œçš„sqlæ˜¯d=5ï¼Œæ˜¯ç¬”è¯¯å—ï¼Œid=5ï¼Ÿfor updateåŠ çš„æ˜¯è¡Œçº§å†™é”ï¼Œåœ¨commitæ—¶é‡Šæ”¾","like_count":0,"discussions":[{"author":{"id":1264162,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4a/22/2681d602.jpg","nickname":"æ—æ™“æ–Œ","note":"","ucode":"CDE42D44F26240","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":434308,"discussion_content":"å“¦ï¼ŒæŠ±æ­‰ï¼Œæ˜¯where c=5 ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1545789229,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53965,"user_name":"å†·ç¬‘çš„èŠ±çŒ«","can_delete":false,"product_type":"c1","uid":1119029,"ip_address":"","ucode":"6C368FBB577470","user_header":"https://static001.geekbang.org/account/avatar/00/11/13/35/45391914.jpg","comment_is_top":false,"comment_ctime":1545782657,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1545782657","product_id":100020801,"comment_content":"æ—è€å¸ˆæ‚¨å¥½ï¼Œçœ‹äº†æ‚¨çš„æ–‡ç« ï¼Œå¾ˆå¤šåœ°æ–¹æåŠundo logï¼Œä½†ä¸€ç›´æƒ³ä¸æ˜ç™½ï¼Œundo  logæ˜¯æ€ä¹ˆå’Œredo logç»“åˆåœ¨ä¸€èµ·çš„ï¼Ÿæˆ–è€…è¯´undo åœ¨å®•æœºæ¢å¤æ—¶æ˜¯æ€ä¹ˆèµ·ä½œç”¨çš„ï¼Ÿè¯·è€å¸ˆè§£æƒ‘ï¼Œè°¢è°¢ã€‚","like_count":0,"discussions":[{"author":{"id":1453053,"avatar":"https://static001.geekbang.org/account/avatar/00/16/2b/fd/7013289d.jpg","nickname":"æ¸©æ•…è€ŒçŸ¥æ–°å¯ä»¥ä¸ºå¸ˆçŸ£","note":"","ucode":"FADCDFA9F9E5E8","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":580346,"discussion_content":"undoæ˜¯äº‹åŠ¡å›æ»šå’Œä¸€è‡´æ€§è¯»çš„æ—¶å€™ç”¨åˆ°ï¼Œredo logæ˜¯crash safeï¼Œä¸æ˜¯ä¸€ä¸ªç»´åº¦ä¸Šï¼ŒäºŒè€…ä¹Ÿä¸éœ€è¦ç»“åˆåœ¨ä¸€èµ·","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1658115503,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":53958,"user_name":"giserway","can_delete":false,"product_type":"c1","uid":1067304,"ip_address":"","ucode":"139D579F323383","user_header":"https://static001.geekbang.org/account/avatar/00/10/49/28/4dcfa376.jpg","comment_is_top":false,"comment_ctime":1545782178,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1545782178","product_id":100020801,"comment_content":"for update åˆ©ç”¨è¡Œé”å®ç°æ‚²è§‚é”ï¼ŒæŸ¥è¯¢åæ›´æ–°æ•°æ®ï¼Œåœ¨æäº¤åè¯¥é”è¢«é‡Šæ”¾ã€‚","like_count":0},{"had_liked":false,"id":53947,"user_name":"æ…§é‘«coming","can_delete":false,"product_type":"c1","uid":1324385,"ip_address":"","ucode":"7BAC9CA255630E","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLE4LYb3jrH63ZV98Zpc8DompwDgb1O3nffMoZCmiaibauRyEFv6NDNsST9RWxZExvMLMWb50zaanoQ/132","comment_is_top":false,"comment_ctime":1545778880,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545778880","product_id":100020801,"comment_content":"åœ¨è¯­å¥æ‰§è¡Œæ—¶åŠ è¯»é”ï¼Œcommitæ—¶é‡Šæ”¾","like_count":0},{"had_liked":false,"id":53924,"user_name":"Justin","can_delete":false,"product_type":"c1","uid":1305601,"ip_address":"","ucode":"D49723FEA66731","user_header":"https://static001.geekbang.org/account/avatar/00/13/ec/01/978d54af.jpg","comment_is_top":false,"comment_ctime":1545755839,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1545755839","product_id":100020801,"comment_content":"æ–‡ä¸­çš„é—®é¢˜ ç”±äºæ²¡æœ‰èµ°ç´¢å¼• æˆ‘çŒœæ˜¯åŠ äº†è¡¨é”äº† ç„¶åç­‰commitä¹‹åé‡Šæ”¾","like_count":0}]}