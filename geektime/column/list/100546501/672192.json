{"id":672192,"title":"31ï½œé¡¹ç›®å®æˆ˜ä¸éƒ¨ç½²ï¼šå¦‚ä½•å®ç°æ¥å£éƒ¨ç½²ä¸è®¿é—®ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯Barryã€‚</p><p>å‰é¢æˆ‘ä»¬å·²ç»å®Œæˆäº†åç«¯çš„åŠŸèƒ½æ¥å£å¼€å‘ã€‚ä»æŠ€æœ¯çš„è§’åº¦å‡ºå‘ï¼Œæˆ‘ä»¬ä½œä¸ºç ”å‘è¿˜åº”å…·å¤‡é¡¹ç›®éƒ¨ç½²çš„èƒ½åŠ›ã€‚åœ¨ä¼ä¸šåº”ç”¨å½“ä¸­ï¼ŒæŠŠé¡¹ç›®éƒ¨ç½²åˆ°æœåŠ¡å™¨ä¸Šï¼Œä¸ä½†èƒ½è®©å‰ç«¯è®¿é—®æ¥å£ï¼Œä¹Ÿèƒ½ä¾›æ›´å¤šç”¨æˆ·ä½¿ç”¨æˆ‘ä»¬çš„å¹³å°ã€‚</p><p>è¿™èŠ‚è¯¾çš„æ“ä½œä»£ç éå¸¸å¤šï¼Œå­¦å®Œä»Šå¤©çš„å†…å®¹ä¹‹åï¼Œå»ºè®®ä½ åœ¨è¯¾åè‡ªå·±å¤šå¤šç»ƒä¹ ï¼Œå·©å›ºå­¦ä¹ æ•ˆæœã€‚è¦å®ç°é¡¹ç›®çš„éƒ¨ç½²ï¼Œé¦–å…ˆè¦ç¡®ä¿æœåŠ¡å™¨ç¯å¢ƒä»¥åŠç›¸å…³ç»„ä»¶æ˜¯å®Œå¤‡çš„ã€‚é™¤å»åŸºæœ¬çš„Pythonç¯å¢ƒã€MySQLä¹‹å¤–ï¼Œè¿˜æœ‰æœåŠ¡éƒ¨ç½²æ—¶ç”¨åˆ°çš„Nginxã€Gunicornã€Supervisoråº“ç­‰ã€‚æ‰€ä»¥éƒ¨ç½²çš„ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬å…ˆæ¥å®ŒæˆæœåŠ¡å™¨ç›¸å…³ç¯å¢ƒé…ç½®ã€‚</p><h2>é…ç½®Pythonç¯å¢ƒä¸è™šæ‹Ÿç¯å¢ƒ</h2><p>ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬è¦é…ç½®Pythonç¯å¢ƒã€‚åœ¨å®‰è£…ä¹‹å‰ï¼Œå¯ä»¥ç™»å½•æœåŠ¡å™¨æ£€æŸ¥ä¸€ä¸‹ä¸Šé¢æ˜¯å¦å®‰è£…äº†Pythonã€‚æ–¹æ³•å°±æ˜¯ç›´æ¥åœ¨ç»ˆç«¯ä¸­è¿è¡Œåé¢çš„å‘½ä»¤ã€‚</p><pre><code class=\"language-plain\">python --version\n</code></pre><p>å¦‚æœå·²å®‰è£…ï¼Œä½ ä¼šçœ‹åˆ°å¯¹åº”çš„ç‰ˆæœ¬å·ï¼Œå¦åˆ™å°±éœ€è¦ä½ åœ¨æœåŠ¡å™¨ä¸Šé‡æ–°å®‰è£…ã€‚å¯¹äºUbuntuç³»ç»Ÿï¼Œå®‰è£…å‘½ä»¤å¦‚ä¸‹ã€‚</p><pre><code class=\"language-plain\">sudo apt-get update  \nsudo apt-get install python3\n</code></pre><p>å¯¹äºCentOSæˆ–RHELç³»ç»Ÿï¼Œå®‰è£…å‘½ä»¤å¦‚ä¸‹ã€‚</p><pre><code class=\"language-plain\">sudo yum install python3\n</code></pre><p>ä¸ºäº†éš”ç¦»é¡¹ç›®ä¾èµ–å’Œç¯å¢ƒï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨è™šæ‹Ÿç¯å¢ƒï¼Œä¸ºæ¯ä¸ªé¡¹ç›®æä¾›ç‹¬ç«‹çš„Pythonç¯å¢ƒã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å®‰è£…è™šæ‹Ÿç¯å¢ƒå·¥å…·virtualenvã€‚</p><!-- [[[read_end]]] --><pre><code class=\"language-plain\">pip install virtualenv\n</code></pre><p>åœ¨å®‰è£…æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬è¦å»é¡¹ç›®ç›®å½•ä¸‹æ¿€æ´»è™šæ‹Ÿç¯å¢ƒæ–¹å¯ä½¿ç”¨ã€‚</p><pre><code class=\"language-plain\">virtualenv venv\nsource venv/bin/activate\n</code></pre><p>æå®šè™šæ‹Ÿç¯å¢ƒä»¥åï¼Œä¸‹ä¸€æ­¥å°±æ˜¯åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…é¡¹ç›®æ‰€éœ€çš„ä¾èµ–åŒ…ã€‚é€šè¿‡æ‰€éœ€çš„ä¾èµ–åŒ…ï¼Œå¯ä»¥ç¡®ä¿é¡¹ç›®ä½¿ç”¨çš„åŒ…ç‰ˆæœ¬ä¸å¼€å‘ç¯å¢ƒä¸­ä¸€è‡´ï¼Œå¹¶ä¸”ä¸ä¼šä¸å…¶ä»–é¡¹ç›®æˆ–å…¨å±€ç¯å¢ƒä¸­çš„åŒ…å†²çªã€‚</p><p>å…·ä½“çš„å®‰è£…å‘½ä»¤æ˜¯åé¢è¿™æ ·ã€‚å…¶ä¸­ï¼Œrequirements.txtè¡¨ç¤ºåŒ…å«é¡¹ç›®ä¾èµ–çš„æ–‡æœ¬æ–‡ä»¶ã€‚</p><pre><code class=\"language-plain\">pip install -r requirements.txt\n</code></pre><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±æˆåŠŸå®Œæˆäº†æœåŠ¡å™¨Pythonç¯å¢ƒå’Œè™šæ‹Ÿç¯å¢ƒçš„é…ç½®ã€‚</p><h2>MySQLé…ç½®</h2><p>é€šè¿‡å‰é¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬ç¡®å®šäº†é¡¹ç›®é‡Œè¦ç”¨åˆ°æ•°æ®åº“MySQLã€‚åŒæ ·ä¸ºäº†ä¿è¯åç«¯èƒ½å¤Ÿè®¿é—®æ•°æ®åº“ï¼Œæˆ‘ä»¬è¿˜è¦åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…MySQLæ•°æ®åº“ã€‚</p><p>è¿™é‡Œçš„æ€è·¯å’Œå‰é¢Pythonç¯å¢ƒå®‰è£…ç±»ä¼¼ï¼Œè¿˜æ˜¯å…ˆæŸ¥çœ‹ä¸€ä¸‹æœåŠ¡å™¨ä¸Šæ˜¯å¦å®‰è£…äº†MySQLã€‚æˆ‘ä»¬è¿˜æ˜¯åœ¨ç™»å½•æœåŠ¡å™¨ä¹‹åï¼Œè¿è¡Œåé¢çš„å‘½ä»¤ã€‚</p><pre><code class=\"language-plain\">mysql --version\n</code></pre><p>å¦‚æœèƒ½çœ‹åˆ°ç‰ˆæœ¬å·ï¼Œé‚£è¯æ˜å·²ç»å®‰è£…è¿‡äº†ï¼Œå¦åˆ™å°±éœ€è¦é‡æ–°å®‰è£…ã€‚å¦‚æœæ˜¯Ubuntuç¯å¢ƒï¼Œç›´æ¥è¿è¡Œåé¢çš„å‘½ä»¤å³å¯ã€‚</p><pre><code class=\"language-plain\">sudo apt-get update\nsudo apt-get install mysql-server\n</code></pre><p>ä¹‹åæˆ‘ä»¬è¿˜è¦å¯¹MySQLåšä¸€äº›åŸºæœ¬çš„é…ç½®ï¼Œè¾“å…¥åé¢çš„å‘½ä»¤å³å¯å¯åŠ¨æœåŠ¡ã€‚</p><pre><code class=\"language-plain\">sudo service mysql start\n</code></pre><p>å¯åŠ¨æœåŠ¡ä»¥åï¼Œä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å®Œæˆæ•°æ®åº“çš„å®‰å…¨é…ç½®ï¼Œmysql_secure_installation&nbsp;è„šæœ¬å¯ä»¥æé«˜ MySQL æ•°æ®åº“çš„å®‰å…¨æ€§ï¼Œå‡å°‘æ½œåœ¨çš„æ”»å‡»é£é™©ã€‚å…·ä½“æ‰§è¡Œä»£ç å¦‚ä¸‹ã€‚</p><pre><code class=\"language-plain\">sudo mysql_secure_installation\n</code></pre><p>è¾“å…¥å‰é¢çš„å‘½ä»¤åï¼Œæˆ‘ä»¬è¿˜è¦æŒ‰ç…§æç¤ºæ¥è®¾ç½®ï¼ŒåŒ…æ‹¬è®¾ç½®MySQLçš„rootå¯†ç å’Œå…¶ä»–ç›¸å…³é€‰é¡¹ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºä¸€ä¸ªç©ºçš„æ•°æ®åº“ã€‚</p><pre><code class=\"language-plain\">mysql -u root -p\n</code></pre><p>ä¸‹ä¸€æ­¥å°±æ˜¯åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·ï¼ŒåŒæ—¶å®Œæˆæƒé™è®¾ç½®ã€‚å…·ä½“æ“ä½œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre><code class=\"language-plain\">CREATE DATABASE database;\nCREATE USER 'username'@'localhost' IDENTIFIED BY 'password';\nGRANT ALL PRIVILEGES ON database.* TO 'username'@'localhost';\nFLUSH PRIVILEGES;\n</code></pre><p>è¯·æ³¨æ„ï¼Œä¸Šé¢è¿™æ®µé…ç½®ä½ éœ€è¦æ›¿æ¢usernameã€databaseã€passwordï¼Œæ¢æˆä½ è‡ªå·±çš„ç”¨æˆ·åã€æ•°æ®åº“åã€å¯†ç ã€‚å¯¹åº”é…ç½®ä¸­å…³è”çš„å°±æ˜¯æˆ‘ä»¬é¡¹ç›®ä¸­çš„æ•°æ®åº“ï¼Œæ•°æ®åº“çš„ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºï¼Œè¿™é‡Œç›¸ä¿¡ä½ ä¹Ÿéå¸¸ç†Ÿæ‚‰äº†ã€‚</p><pre><code class=\"language-python\">class Config:\n&nbsp; &nbsp; DEBUG = True\n&nbsp; &nbsp; LEVEL_LOG = logging.INFO\n&nbsp; &nbsp; SECRET_KEY = 'slajfasfjkajfj'\n&nbsp; &nbsp; SQL_HOST = '127.0.0.1'\n&nbsp; &nbsp; SQL_USERNAME = 'root'\n&nbsp; &nbsp; SQL_PASSWORD = 'root'\n&nbsp; &nbsp; SQL_PORT = 3306\n&nbsp; &nbsp; SQL_DB = 'my_project'\n&nbsp; &nbsp; JSON_AS_ASCII = False\n&nbsp; &nbsp; # æ•°æ®åº“çš„é…ç½®\n&nbsp; &nbsp; SQLALCHEMY_DATABASE_URI = f\"mysql+pymysql://{SQL_USERNAME}:{SQL_PASSWORD}@{SQL_HOST}:{SQL_PORT}/{SQL_DB}\"\n&nbsp; &nbsp; SQLALCHEMY_TRACK_MODIFICATIONS = False\n</code></pre><p>åˆ›å»ºæ•°æ®åº“ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨Flask-Migrateï¼ˆFlask-Migrateæ˜¯ä¸€ä¸ªåŸºäºFlaskæ¡†æ¶çš„æ•°æ®åº“è¿ç§»å·¥å…·ï¼‰æ¥å®ç°æ•°æ®åº“è¿ç§»ï¼Œå¹¶ä¸”é›†æˆåˆ°Flask-Scriptä¸­ã€‚</p><p>æ¯æ¬¡æˆ‘ä»¬éœ€è¦å¯¹æ•°æ®åº“è¿›è¡Œæ›´æ”¹æ—¶ï¼Œéƒ½éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„è¿ç§»æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨migrateå‘½ä»¤å°†å…¶åº”ç”¨åˆ°æ•°æ®åº“ä¸­ã€‚</p><p>å®‰è£…å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre><code class=\"language-plain\">pip install flask-migrate\n</code></pre><p>åœ¨é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®ä¾‹åŒ–Flask_Migrateæä¾›çš„Migrateç±»ï¼Œè¿›è¡Œåˆå§‹åŒ–æ“ä½œã€‚å¯¹åº”çš„æ–‡ä»¶å°±æ˜¯é¡¹ç›®ä¸­çš„manager.pyï¼Œæ–‡ä»¶ä¸­å…·ä½“çš„ä»£ç æ˜¯åé¢è¿™æ ·ã€‚</p><pre><code class=\"language-plain\">from flask_script import Manager\nfrom flask_migrate import Migrate, MigrateCommand\nfrom api.models.user import UserInfo\nfrom api.models.video import VideoInfo\nfrom api.models.content import ContentMain\nfrom api.models.gitinfo import GithubInfo\nfrom flask_cors import CORS\nfrom api import db, create_app\n\napp = create_app('dev')\n\nCORS(app, supports_credentials=True)\n\nmanager = Manager(app)\nMigrate(app, db)\nmanager.add_command('db', MigrateCommand)\n\nif __name__ == '__main__':\n    manager.run()\n</code></pre><p>æˆ‘æ¥ä¸ºä½ è§£é‡Šä¸€ä¸‹å‰é¢è¿™æ®µä»£ç ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä»Flask-Scriptåº“ä¸­å¯¼å…¥äº†ä¸€ä¸ªManagerå¯¹è±¡ï¼Œç”¨äºç®¡ç†å‘½ä»¤è¡Œè„šæœ¬ã€‚ç„¶åï¼Œä»Flask-Migrateåº“ä¸­å¯¼å…¥äº†Migrateå’ŒMigrateCommandå¯¹è±¡ï¼Œç”¨äºæ•°æ®åº“è¿ç§»ã€‚</p><p>ç´§æ¥ç€ï¼Œæˆ‘ä»¬å¯¼å…¥äº†ç›¸å…³çš„æ¨¡å‹ç±»ï¼ŒåŒ…æ‹¬UserInfoã€VideoInfoã€ContentMainç­‰ï¼Œè¿™äº›æ¨¡å‹ç±»å®šä¹‰äº†æ•°æ®åº“ä¸­çš„è¡¨ç»“æ„å’Œæ“ä½œã€‚</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªFlaskåº”ç”¨å®ä¾‹appï¼Œå¹¶ä½¿ç”¨Flask-Corsåº“æ¥å¤„ç†è·¨åŸŸèµ„æºå…±äº«é—®é¢˜ã€‚</p><p>ä»£ç çš„14-16è¡Œï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªManagerå¯¹è±¡managerï¼Œå¹¶å°†appå’Œdbå¯¹è±¡ä¼ é€’ç»™å®ƒã€‚ç„¶åï¼Œä½¿ç”¨Migrateå¯¹è±¡æ¥ç»‘å®šappå’Œdbå¯¹è±¡ï¼Œä»¥ä¾¿è¿›è¡Œæ•°æ®åº“è¿ç§»ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬å°†MigrateCommandå¯¹è±¡æ·»åŠ åˆ°managerä¸­ï¼Œä»¥ä¾¿å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œè¿è¡Œè¿ç§»å‘½ä»¤ã€‚</p><p>æˆ‘ä»¬ä¸»è¦åˆ†ä¸‰æ­¥æ¥å®Œæˆæ•°æ®åº“è¿ç§»ã€‚ç¬¬ä¸€æ­¥æˆ‘ä»¬å…ˆæ¥åˆ›å»ºè¿ç§»æ•°æ®åº“ï¼Œç›´æ¥åœ¨æˆ‘ä»¬çš„PyCharmä¸­æ‰§è¡Œå‘½ä»¤ã€‚</p><pre><code class=\"language-plain\">python manage.py db init\n</code></pre><p>è¿™é‡Œçš„dbæ˜¯è¿ç§»å‘½ä»¤çš„å¯¹è±¡ï¼Œå®ƒå¯ä»¥æ‰§è¡Œå„ç§æ•°æ®åº“æ“ä½œï¼ŒåŒ…æ‹¬åˆå§‹åŒ–æ•°æ®åº“ã€è¿ç§»æ•°æ®åº“ç­‰æ“ä½œï¼Œåå­—å¯ä»¥è‡ªå·±å‘½åï¼Œä½†æ˜¯<strong>ç›¸å…³åº”ç”¨è¦ä¿æŒå‘½åä¸€è‡´ã€‚</strong></p><p>è¿™ä¸ªå‘½ä»¤ç”¨æ¥åœ¨æˆ‘ä»¬çš„é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºmigrationsæ–‡ä»¶å¤¹ï¼ŒæŠŠæ‰€æœ‰è¿ç§»æ–‡ä»¶éƒ½æ”¾åœ¨é‡Œé¢ã€‚åé¢æ˜¯æ–‡ä»¶æˆªå›¾ï¼Œä¾›ä½ å‚è€ƒã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e6/2c/e6c6642e5ebf1bfd1ae4f009a2d2312c.jpg?wh=2886x1066\" alt=\"\"></p><p>ç¬¬äºŒæ­¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºè¿ç§»è„šæœ¬ï¼Œå¯¹åº”è„šæœ¬çš„æ–‡ä»¶ä½ç½®åœ¨migrations / versionsæ–‡ä»¶ï¼Œè‡ªåŠ¨åˆ›å»ºè¿ç§»è„šæœ¬éœ€è¦ç”¨åˆ°ä¸¤ä¸ªå‡½æ•°ã€‚upgrade()å‡½æ•°ç”¨æ¥æŠŠè¿ç§»ä¸­çš„æ”¹åŠ¨åº”ç”¨åˆ°æ•°æ®åº“ä¸­ï¼Œdowngrade()å‡½æ•°åˆ™ç”¨äºåˆ é™¤æ”¹åŠ¨ã€‚</p><p>ä¸ºäº†è®©ä½ è¿›ä¸€æ­¥ç†è§£è¿™ä¸¤ä¸ªå‡½æ•°çš„å…·ä½“ç”¨æ³•ï¼Œæˆ‘ä»¬ç»“åˆæ¡ˆä¾‹æ¥çœ‹çœ‹ã€‚</p><pre><code class=\"language-plain\">def upgrade():\n    # ### commands auto generated by Alembic - please adjust! ###\n    op.add_column('user_login', sa.Column('last_login_stamp', sa.Integer(), nullable=True))\n    # ### end Alembic commands ###\n\ndef downgrade():\n    # ### commands auto generated by Alembic - please adjust! ###\n    op.drop_column('user_login', 'last_login_stamp')\n    # ### end Alembic commands ###\n</code></pre><p>ç»“åˆä»£ç å¯ä»¥çœ‹åˆ°ï¼Œupgradeå‡½æ•°é€šè¿‡op.add_column()æ–¹æ³•æ·»åŠ äº†ä¸€ä¸ªåä¸ºlast_login_stampçš„åˆ—ï¼Œè¯¥åˆ—çš„æ•°æ®ç±»å‹æ˜¯æ•´æ•°ã€‚downgradeå‡½æ•°åˆ™æ˜¯é€šè¿‡op.drop_column()æ–¹æ³•ï¼Œåˆ é™¤äº†åä¸ºlast_login_stampçš„åˆ—ã€‚</p><p>åœ¨æ•°æ®åº“è¿ç§»è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡upgradeå‡½æ•°æ¥æ·»åŠ æ–°çš„åˆ—ã€ä¿®æ”¹è¡¨ç»“æ„ç­‰ï¼Œè€Œé€šè¿‡downgradeå‡½æ•°å¯ä»¥æ’¤é”€è¿™äº›æ›´æ”¹ã€‚ä½ éœ€è¦æ³¨æ„ï¼Œ<strong>è¿™äº›å‡½æ•°ä¸­çš„ä»£ç æ˜¯æ ¹æ®æ•°æ®åº“çš„ç‰ˆæœ¬æ§åˆ¶è‡ªåŠ¨ç”Ÿæˆçš„ï¼Œå¹¶éæ˜¯æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„</strong>ï¼Œå¯ä»¥æ ¹æ®æ•°æ®æ“ä½œéœ€æ±‚æ¥è°ƒæ•´å’Œä¿®æ”¹ã€‚</p><p>åˆ›å»ºè¿ç§»è„šæœ¬çš„æ‰§è¡Œå‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre><code class=\"language-plain\">python manage.py db migrate -m 'initial migration\n</code></pre><p>ä¸è¿‡ï¼Œè¿è¡Œå‘½ä»¤ä¹‹åï¼Œåªæ˜¯åœ¨migrationsæ–‡ä»¶å¤¹ä¸­æ–°å¢äº†æ•°æ®åº“è¿ç§»çš„ç‰ˆæœ¬æ–‡ä»¶ï¼Œè¿™æ—¶å€™è¿˜å¹¶æ²¡æœ‰ç”Ÿæˆå¯¹åº”çš„è¡¨ã€‚è¿˜éœ€è¦æˆ‘ä»¬å®Œæˆç¬¬ä¸‰æ­¥â€”â€”æ›´æ–°æ•°æ®åº“ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre><code class=\"language-plain\">python manage.py db upgrade\n</code></pre><p>æ›´æ–°ä¹‹åï¼Œæˆ‘ä»¬ä¼šå‘ç°æ•°æ®è¡¨å°±èƒ½å¤Ÿå®ç°åˆ›å»ºäº†ã€‚åˆ°è¿™é‡Œæˆ‘ä»¬å°±å®Œæˆäº†æ•°æ®åº“çš„è¿ç§»ï¼Œæ­å–œä½ ä¸€è·¯åšæŒåˆ°è¿™é‡Œã€‚</p><h2>Gunicornéƒ¨ç½²</h2><p>æå®šäº†æœåŠ¡å™¨ç›¸å…³ç¯å¢ƒé…ç½®ï¼Œæˆ‘ä»¬å°±å¯ä»¥éƒ¨ç½²é¡¹ç›®äº†ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€‰ç”¨æœ€å¸¸ç”¨çš„Flaskåº”ç”¨éƒ¨ç½²æ–¹æ¡ˆ Flask+Gunicorn+Nginx+Supervisorã€‚</p><p>æˆ‘ä»¬å…ˆæ¥è®¤è¯†å¹¶å®‰è£…Gunicornã€‚Gunicornæ˜¯ä¸€ä¸ªåŸºäºPythonçš„WebæœåŠ¡å™¨ï¼Œä½¿ç”¨Pre-forkingæ¨¡å‹æ¥å¤„ç†è¯·æ±‚ã€‚å®ƒçš„ä¸»è¦ç›®çš„æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½œä¸ºä¸»æµWebæœåŠ¡å™¨ï¼Œå¹¶æä¾›ä¸Python Webåº”ç”¨ç¨‹åºçš„é›†æˆã€‚</p><p>é‚£æˆ‘ä»¬åœ¨é¡¹ç›®éƒ¨ç½²ä¸­ä¸ºä»€ä¹ˆéœ€è¦ç”¨åˆ°Gunicornå‘¢ï¼Ÿ</p><p>è¿™æ˜¯å› ä¸ºï¼ŒGunicornå¯ä»¥å¤„ç†HTTPè¯·æ±‚å¹¶è¿”å›å“åº”ã€‚å®ƒå¯ä»¥ä½¿ç”¨ä¸åŒçš„é…ç½®æ¥é€‚åº”ä¸åŒçš„åº”ç”¨åœºæ™¯ï¼Œä¾‹å¦‚å¤„ç†é«˜å¹¶å‘çš„è¯·æ±‚ã€æä¾›é™æ€æ–‡ä»¶æœåŠ¡ç­‰ã€‚</p><p>Gunicornè¿˜å¯ä»¥ä½œä¸ºé¢„çƒ­æœåŠ¡å™¨ä½¿ç”¨ï¼Œå®ƒåœ¨å¯åŠ¨æ—¶ä¼šåŠ è½½ä¸€äº›åº”ç”¨ç¨‹åºä»£ç ï¼Œå¹¶é¢„å…ˆåˆ›å»ºå·¥ä½œè¿›ç¨‹ã€‚è¿™æ ·å¯ä»¥å‡å°‘è¯·æ±‚çš„ç­‰å¾…æ—¶é—´ï¼Œæé«˜æœåŠ¡å™¨çš„å“åº”é€Ÿåº¦ã€‚è¿™ä¹Ÿæ˜¯å®ƒéå¸¸çªå‡ºçš„ä¸€å¤§ä¼˜åŠ¿ã€‚</p><p>Gunicornä¹Ÿå¯ä»¥ä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨ä½¿ç”¨ï¼Œå°†è¯·æ±‚è½¬å‘åˆ°å…¶ä»–æœåŠ¡å™¨ã€‚å®ƒå¯ä»¥å°†è¯·æ±‚è½¬å‘åˆ°å¤šä¸ªå·¥ä½œè¿›ç¨‹ï¼Œä»è€Œå®ç°è´Ÿè½½å‡è¡¡å’Œç¼“å­˜ã€‚</p><p>åœ¨è®¤è¯†äº†Gunicornä¹‹åï¼Œæˆ‘ä»¬è¿™å°±æ¥çœ‹çœ‹é¡¹ç›®éƒ¨ç½²ä¸­å¦‚ä½•ä½¿ç”¨å®ƒã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦å®‰è£…Gunicornï¼Œç›´æ¥ä½¿ç”¨pipå‘½ä»¤å®‰è£…å³å¯ã€‚</p><pre><code class=\"language-plain\">pip install gunicorn\n</code></pre><p>å®‰è£…æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬è¦åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º<code>gunicorn.conf.py</code>çš„é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹å†…å®¹ã€‚</p><pre><code class=\"language-plain\">bind =\"%s:%s\" % (\"0.0.0.0\", 8000)\nworkers = 8\nworker_class = \"sync\"\n</code></pre><p>åœ¨ä¸Šé¢çš„é…ç½®ä¸­æœ‰ä¸‰ä¸ªæ ¸å¿ƒå‚æ•°ï¼šbindæŒ‡å®šäº†æœåŠ¡å™¨ç›‘å¬çš„IPåœ°å€å’Œç«¯å£å·ï¼ŒworkersæŒ‡å®šäº†è¿›ç¨‹æ•°ï¼Œworker_classæŒ‡å®šäº†å·¥ä½œè¿›ç¨‹çš„ç±»å‹ã€‚è‡³äºæ•´ä½“çš„é…ç½®æ–‡ä»¶ï¼Œä½ å¯ä»¥å‚è€ƒGiteeé‡Œçš„å®Œæ•´ä»£ç ï¼Œåˆ°æ—¶ä½ ç›´æ¥æ‹‰å–ä½¿ç”¨å°±å¯ä»¥ã€‚</p><p>åœ¨é…ç½®å®Œæˆä¹‹åï¼Œæˆ‘ä»¬åœ¨ç»ˆç«¯ä¸­è¿›å…¥é¡¹ç›®ç›®å½•ï¼Œå¹¶ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨Gunicornã€‚</p><pre><code class=\"language-plain\">gunicorn -c gun_conf.py manager:app\n</code></pre><p>è¿™é‡ŒåŒæ ·æœ‰ä¸‰ä¸ªå‚æ•°ã€‚-c ç”¨æ¥æŒ‡å®šgunicorné…ç½®æ–‡ä»¶ï¼Œmanageråˆ™æ˜¯Flaské¡¹ç›®å¯åŠ¨çš„æ–‡ä»¶åï¼Œè€Œapp&nbsp;ä»£è¡¨è„šæœ¬ä¸­åˆ›å»ºçš„Flaskå¯¹è±¡åã€‚</p><p>ä¸è¿‡åœ¨é¡¹ç›®éƒ¨ç½²ä¸­ï¼Œä»…æœ‰Gunicornè¿˜æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦ä½¿ç”¨Nginxä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨æ¥å®ç°æ›´é«˜çš„å¯ç”¨æ€§ã€æå‡æ€§èƒ½ï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨Nginxå‘¢ï¼Ÿä¸»è¦æœ‰ä¸‰ç‚¹è€ƒè™‘ã€‚</p><p>ç¬¬ä¸€ï¼ŒNginxå¯ä»¥å°†è¯·æ±‚è½¬å‘åˆ°GunicornæœåŠ¡å™¨ï¼Œå®ç°è´Ÿè½½å‡è¡¡å’Œç¼“å­˜ã€‚è¿™å°†å¸¦æ¥çš„å¥½å¤„æ˜¯å¯ä»¥å¸®åŠ©æé«˜ç³»ç»Ÿçš„æ€§èƒ½å’Œå¯é æ€§ã€‚</p><p>ç¬¬äºŒï¼Œå®ƒå¯ä»¥è§£å†³è·¨åŸŸé—®é¢˜ï¼Œåœ¨é¡¹ç›®ä¸­ï¼Œç»å¸¸éœ€è¦è·¨åŸŸè®¿é—®èµ„æºã€‚æˆ‘ä»¬åœ¨Nginxé‡Œè®¾ç½®é€‚å½“çš„å“åº”å¤´ï¼Œå³å¯å…è®¸è·¨åŸŸè¯·æ±‚ã€‚è¿™ä¹Ÿæ˜¯æˆ‘ä»¬åœ¨å¤„ç†è·¨åŸŸé—®é¢˜ä¸­æ¯”è¾ƒç»å…¸çš„æ–¹æ³•ï¼Œä¹Ÿæ˜¯é¢è¯•ä¸­çš„é«˜é¢‘è€ƒç‚¹ã€‚</p><p>ç¬¬ä¸‰ï¼ŒNginxæ˜¯ä¸€ä¸ªé«˜åº¦å¯æ‰©å±•å’Œç¨³å®šçš„æœåŠ¡å™¨ï¼Œèƒ½æä¾›é«˜æ•ˆçš„ç½‘ç»œè¿æ¥ç®¡ç†å’Œå®‰å…¨é˜²æŠ¤ã€‚åŒæ—¶å®ƒä¹Ÿæ”¯æŒä¸°å¯Œçš„é…ç½®é€‰é¡¹ï¼Œå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œçµæ´»é…ç½®ã€‚</p><h2>Nginxå®‰è£…</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±çœ‹çœ‹å¦‚ä½•é…ç½®å®‰è£…Nginxã€‚æˆ‘ä»¬ä¾ç„¶åœ¨é“¾æ¥æœåŠ¡å™¨ä¹‹åï¼Œä½¿ç”¨åé¢çš„å‘½ä»¤æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ï¼Œå¹¶å®‰è£…NginxæœåŠ¡å™¨ã€‚</p><pre><code class=\"language-plain\">sudo apt-get update  \nsudo apt-get install nginx\n</code></pre><p>ç„¶åï¼Œæˆ‘ä»¬éœ€è¦ç¼–è¾‘é…ç½®æ–‡ä»¶/etc/nginx/sites-available/defaultï¼Œä¿®æ”¹location /ï¼Œå…·ä½“çš„é…ç½®é¡¹å¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre><code class=\"language-plain\"># æ³¨æ„ä¸‹è¿™é‡Œçš„ç›‘å¬ç«¯å£ï¼Œè®¿é—®çš„æ—¶å€™ä¼šç”¨åˆ°\nlisten 80 default_server;\nlisten [::]:80 default_server;\n\nlocation / {\n&nbsp; &nbsp; proxy_pass http://localhost:8000/;\n&nbsp; &nbsp; proxy_redirect off;\n&nbsp; &nbsp; proxy_set_header Host $http_post;\n&nbsp; &nbsp; proxy_set_header X-Real-IP $remote_addr;\n&nbsp; &nbsp; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n}\n\n</code></pre><p>åœ¨ä¸Šè¿°é…ç½®ä¸­ï¼Œlisten 80è¡¨ç¤ºç›‘å¬80ç«¯å£ï¼Œserver_name example.comè¡¨ç¤ºåŸŸåï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹ã€‚location / è¡¨ç¤ºå°†æ‰€æœ‰è¯·æ±‚éƒ½è½¬å‘åˆ°GunicornæœåŠ¡å™¨ä¸Šï¼ŒGunicornçš„ç›‘å¬ç«¯å£ä¸º8000ã€‚</p><p>é…ç½®å®Œæˆä¹‹åï¼Œæˆ‘ä»¬è¦é€šè¿‡åé¢çš„æ‰§è¡Œå‘½ä»¤é‡æ–°å¯åŠ¨NginxæœåŠ¡ã€‚</p><pre><code class=\"language-plain\">sudo service nginx reload\n</code></pre><p>åˆ°è¿™é‡Œï¼ŒFlaské¡¹ç›®éƒ¨ç½²çš„å‡†å¤‡å·¥ä½œå‘Šä¸€æ®µè½ï¼Œæˆ‘ä»¬å®‰è£…å¹¶é…ç½®äº†NginxæœåŠ¡å™¨ï¼Œè¿˜è®©å®ƒä¸GunicornæœåŠ¡å™¨é…åˆä½¿ç”¨ã€‚ç°åœ¨ä½ å°±å¯ä»¥ç›´æ¥åœ¨å¤–ç½‘IPåœ°å€80ç«¯å£ä¸‹ï¼Œè®¿é—®ä½ çš„Flaské¡¹ç›®äº†ã€‚</p><p>åˆ°äº†è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†éƒ¨ç½²å’Œå¯åŠ¨ã€‚ä½†æ˜¯è¿™ä¸ªè¿‡ç¨‹ä¸­éœ€è¦æˆ‘ä»¬é€šè¿‡æ‰‹åŠ¨å‘½ä»¤æ“ä½œï¼Œè¿˜ä¸å¤Ÿçµæ´»ã€‚æˆ‘ä»¬è¿˜éœ€è¦ä½¿ç”¨Supervisorï¼Œè¿™æ˜¯ä¸€ä¸ªè¿›ç¨‹ç®¡ç†å·¥å…·ã€‚</p><p>å®ƒçš„ä¼˜åŠ¿æœ‰ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ã€‚</p><p>é¦–å…ˆï¼ŒSupervisorå¯ä»¥è´Ÿè´£å¯åŠ¨ã€åœæ­¢ã€é‡å¯å’ŒæŸ¥çœ‹Flaskåº”ç”¨çš„è¿›ç¨‹ã€‚è¿™æ ·ï¼Œå½“é¡¹ç›®å‡ºç°é—®é¢˜æˆ–éœ€è¦é‡å¯æ—¶ï¼ŒSupervisorå¯ä»¥è‡ªåŠ¨å¤„ç†è¿™äº›é—®é¢˜ï¼Œè€Œæ— éœ€æ‰‹åŠ¨å¹²é¢„ã€‚</p><p>å…¶æ¬¡ï¼ŒSupervisorå¯ä»¥æ•è·å’Œå¤„ç†Flaské¡¹ç›®ä¸­çš„å¼‚å¸¸ã€‚å¦‚æœé¡¹ç›®å‘ç”Ÿå´©æºƒæˆ–å‡ºç°æ•…éšœï¼ŒSupervisorå¯ä»¥è‡ªåŠ¨é‡æ–°å¯åŠ¨åº”ç”¨ï¼Œä»¥ä¿è¯æœåŠ¡çš„å¯ç”¨æ€§ã€‚</p><p>æœ€åï¼ŒSupervisorçš„é…ç½®éå¸¸çµæ´»ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚è¿›è¡Œå®šåˆ¶ã€‚æˆ‘ä»¬å¯ä»¥è®¾ç½®åº”ç”¨çš„å·¥ä½œç›®å½•ã€ç¯å¢ƒå˜é‡ã€ç”¨æˆ·æƒé™ç­‰ï¼Œä»¥ç¡®ä¿åº”ç”¨åœ¨æœ€ä½³ç¯å¢ƒä¸‹è¿è¡Œã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±çœ‹çœ‹å¦‚ä½•åº”ç”¨Supervisorå®ç°è¿›ç¨‹ç®¡ç†ã€‚</p><h2>Supervisoré…ç½®</h2><p>é¦–å…ˆè¦å®‰è£…Supervisorã€‚</p><pre><code class=\"language-plain\">sudo apt-get install supervisor\n</code></pre><p>å®‰è£…å®Œæˆåï¼Œåœ¨/etc/supervisor/conf.d/ç›®å½•ä¸‹åˆ›å»ºæˆ‘ä»¬æ§åˆ¶è¿›ç¨‹çš„é…ç½®æ–‡ä»¶ï¼Œå¹¶ä»¥.confç»“å°¾ï¼Œè¿™æ ·å°†ä¼šè‡ªåŠ¨åº”ç”¨åˆ°ä¸»é…ç½®æ–‡ä»¶å½“ä¸­ï¼Œå…·ä½“çš„é…ç½®å†…å®¹å¦‚ä¸‹æ‰€ç¤ºã€‚</p><pre><code class=\"language-plain\">[program:myproject]\ncommand=gunicorn -c $(é¡¹ç›®è·¯å¾„)/gun_conf.py manager:app\nuser Barry\nautostart true; è®¾ç½®ä¸ºéš supervisord å¯åŠ¨è€Œå¯åŠ¨\nautorestart=true; è®¾ç½®ä¸ºéš supervisord é‡å¯è€Œé‡å¯\nstartretires:5; supervisordå°è¯•å¯åŠ¨ä¸€ä¸ªç¨‹åºæ—¶å°è¯•çš„æ¬¡æ•°ã€‚é»˜è®¤æ˜¯3\nstartsecs 3; è‡ªåŠ¨é‡å¯æ—¶é—´é—´éš”,ä»¥ç§’ä¸ºå•ä½\nstderr_logfile=/var/log/myproject.err.log ;é”™è¯¯æ—¥å¿—æ–‡ä»¶\nstdout logfile=/var/log/myproject.out.log ;è¾“å‡ºæ—¥å¿—æ–‡ä»¶\n</code></pre><p>åœ¨ä¸Šé¢çš„é…ç½®é¡¹ä¸­ï¼Œ[program:myproject] æ˜¯é…ç½®æ–‡ä»¶çš„åç§°ï¼Œå¯ä»¥æ ¹æ®å®é™…åº”ç”¨åç§°è¿›è¡Œä¿®æ”¹ã€‚commandæ˜¯å¯åŠ¨åº”ç”¨ç¨‹åºçš„å‘½ä»¤ï¼Œè¿™é‡Œä½¿ç”¨äº†GunicornæœåŠ¡å™¨ã€‚useræ˜¯è¿è¡Œåº”ç”¨ç¨‹åºçš„ç”¨æˆ·ï¼Œå¯ä»¥æ ¹æ®å®é™…æƒ…å†µæ¥ä¿®æ”¹ã€‚autostartå’Œautorestartè¡¨ç¤ºè‡ªåŠ¨å¯åŠ¨å’Œè‡ªåŠ¨é‡å¯åº”ç”¨ç¨‹åºã€‚stdout_logfileå’Œstderr_logfileæ˜¯åº”ç”¨ç¨‹åºçš„è¾“å‡ºæ—¥å¿—æ–‡ä»¶è·¯å¾„ã€‚</p><p>ä¿å­˜å¹¶é€€å‡ºé…ç½®æ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°åŠ è½½Supervisorçš„é…ç½®ï¼Œshellå‘½ä»¤æ˜¯åé¢è¿™æ ·ã€‚</p><pre><code class=\"language-plain\">sudo supervisorctl reload\n</code></pre><p>æœ€åï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿è¡Œåé¢çš„å‘½ä»¤ï¼Œå¯åŠ¨æˆ‘ä»¬çš„é¡¹ç›®äº†ã€‚</p><pre><code class=\"language-plain\">sudo supervisorctl start myapp\n</code></pre><p>æœ‰æ²¡æœ‰æ„Ÿè§‰åˆ°ï¼Œåœ¨Flaské¡¹ç›®é‡Œå¼•å…¥Supervisorå¹¶ä¸å¤æ‚ã€‚ä¹‹åï¼ŒSupervisorå°†ä¼šç›‘æ§åº”ç”¨ç¨‹åºçš„è¿›ç¨‹å¹¶è‡ªåŠ¨é‡å¯åº”ç”¨ç¨‹åºï¼Œä¸ºæˆ‘ä»¬åº”ç”¨ç¨‹åºçš„ç¨³å®šè¿è¡Œä¿é©¾æŠ¤èˆªã€‚</p><h2>æ€»ç»“</h2><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å®Œæˆäº†Flaskåç«¯æ¥å£çš„éƒ¨ç½²å·¥ä½œï¼Œå…¶å®å‰ç«¯éƒ¨ç½²ä¹Ÿæ˜¯ä¸€æ ·çš„é€»è¾‘ã€‚ä¼°è®¡ä½ ä¹Ÿä½“ä¼šåˆ°äº†ï¼Œæ“ä½œé¡¹æ¯”è¾ƒå¤šï¼Œéœ€è¦ä½ è¶³å¤Ÿè€å¿ƒå’Œç»†å¿ƒã€‚ç°åœ¨ï¼Œæˆ‘å†ä¸ºä½ æ¢³ç†ä¸‹æ•´ä¸ªéƒ¨ç½²è¿‡ç¨‹é‡Œçš„é‡éš¾ç‚¹ã€‚</p><p>æœåŠ¡å™¨ç¯å¢ƒé…ç½®æ–¹é¢ï¼Œè¦æ³¨æ„åœ¨è™šæ‹Ÿç¯å¢ƒé‡Œæ„å»ºï¼Œç›®çš„æ˜¯ç¡®ä¿é¡¹ç›®ä½¿ç”¨çš„åŒ…ç‰ˆæœ¬ä¸å¼€å‘ç¯å¢ƒä¸­ä¸€è‡´ï¼Œå¹¶ä¸”ä¸ä¼šä¸å…¶ä»–é¡¹ç›®æˆ–å…¨å±€ç¯å¢ƒä¸­çš„åŒ…å†²çªã€‚æ•°æ®åº“åˆ›å»ºç¯èŠ‚çš„é‡ç‚¹æ˜¯ç†Ÿç»ƒæŒæ¡Flask-Migrateï¼Œä½ å¯ä»¥è¯¾åå†å›å‘³ä¸€ä¸‹ç›¸å…³ä»£ç ã€‚</p><p>é¡¹ç›®éƒ¨ç½²çš„æ ¸å¿ƒæ˜¯Gunicornå’ŒNginxç»„åˆåº”ç”¨ï¼Œä½ å¯ä»¥å‚è€ƒåé¢çš„è¡¨æ ¼å›é¡¾ä¸€ä¸‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/5e/c9/5ebd9afdf509a6341a3118c8b6721ac9.jpg?wh=3481x1135\" alt=\"\"></p><p>ä¸ºäº†æé«˜æ•ˆç‡ï¼Œå‘Šåˆ«æ‰‹åŠ¨æ“ä½œï¼Œæˆ‘ä»¬è¿˜éœ€è¦ç”¨åˆ°Supervisoræ¥ç®¡ç†è¿›ç¨‹ï¼Œæ­¤å¤–ï¼ŒSupervisoræ›´æ ¸å¿ƒçš„ä½œç”¨æ˜¯åŠæ—¶å¸®æˆ‘ä»¬æ•è·ä¸€äº›è¿›ç¨‹é—®é¢˜ï¼Œä¿è¯ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§ã€‚</p><p>åç«¯å®æˆ˜å†…å®¹å‘Šä¸€æ®µè½ï¼Œä¸‹èŠ‚è¯¾å¼€å§‹ï¼Œæˆ‘ä»¬å³å°†å¼€å¯ç›´æ’­æ¨¡å—çš„å­¦ä¹ ï¼Œæ•¬è¯·æœŸå¾…ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>åœ¨è¯¾ç¨‹ä¸­æˆ‘ä»¬æåˆ°äº†è·¨åŸŸé—®é¢˜ï¼Œä½ çŸ¥é“å¼•å‘è·¨åŸŸé—®é¢˜çš„ä¸»è¦åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨ç•™è¨€åŒºå’Œæˆ‘äº¤æµäº’åŠ¨ï¼Œå¦‚æœè¿™èŠ‚è¯¾å¯¹ä½ æœ‰å¯å‘ï¼Œä¹Ÿæ¨èä½ åˆ†äº«ç»™èº«è¾¹çš„æœ‹å‹ã€‚</p>","comments":[{"had_liked":false,"id":393262,"user_name":"Rongfan Leo","can_delete":false,"product_type":"c1","uid":1738062,"ip_address":"å®‰å¾½","ucode":"9E65C1AA80CE2C","user_header":"https://static001.geekbang.org/account/avatar/00/1a/85/4e/1cecdfba.jpg","comment_is_top":false,"comment_ctime":1723298628,"is_pvip":false,"replies":[{"id":143263,"content":"è¿™æ˜¯æ‰€æœ‰çš„ç‰ˆæœ¬ï¼ŒVue 2.7ï¼ˆå¤§éƒ¨åˆ†ä¼ä¸šåº”ç”¨ä¸­çš„ç¨³å®šç‰ˆæœ¬ï¼‰ã€Python 3.8ã€Flask 1.1.2ã€Node 10.13ã€NPM 6.4.1ã€Element 2.8.2ã€Echarts 4.9.0","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3050845,"ctime":1727424658,"ip_address":"åŒ—äº¬","comment_id":393262,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100546501,"comment_content":"å“¥å“¥ï¼Œä½ flask ç‰ˆæœ¬æ˜¯å•¥ï¼Œæœ‰requirements.txtå—ï¼Ÿ\n","like_count":0,"discussions":[{"author":{"id":3050845,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/8d/5d/9a86007c.jpg","nickname":"Barry","note":"","ucode":"82175C78B4CAED","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":651788,"discussion_content":"è¿™æ˜¯æ‰€æœ‰çš„ç‰ˆæœ¬ï¼ŒVue 2.7ï¼ˆå¤§éƒ¨åˆ†ä¼ä¸šåº”ç”¨ä¸­çš„ç¨³å®šç‰ˆæœ¬ï¼‰ã€Python 3.8ã€Flask 1.1.2ã€Node 10.13ã€NPM 6.4.1ã€Element 2.8.2ã€Echarts 4.9.0","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1727424658,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":386250,"user_name":"Geek_9d0de4","can_delete":false,"product_type":"c1","uid":3031731,"ip_address":"ä¹Œå…‹å…°","ucode":"6692B89D125E9B","user_header":"","comment_is_top":false,"comment_ctime":1704383727,"is_pvip":false,"replies":[{"id":140883,"content":"å¯ä»¥ å®Œå…¨å¯ä»¥çš„ï¼ŒæŠŠä¾èµ–installä¹‹å ç›´æ¥å¯åŠ¨å‘½ä»¤å³å¯ï¼\n","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3050845,"ctime":1704972530,"ip_address":"åŒ—äº¬","comment_id":386250,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100546501,"comment_content":"giteeä¸Šç»™çš„å‰åç«¯ä»£ç èƒ½è·‘èµ·æ¥å—ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":3050845,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/8d/5d/9a86007c.jpg","nickname":"Barry","note":"","ucode":"82175C78B4CAED","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635615,"discussion_content":"å¯ä»¥ å®Œå…¨å¯ä»¥çš„ï¼ŒæŠŠä¾èµ–installä¹‹å ç›´æ¥å¯åŠ¨å‘½ä»¤å³å¯ï¼\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704972530,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1151675,"avatar":"https://static001.geekbang.org/account/avatar/00/11/92/bb/f6e3cdba.jpg","nickname":"è¿‡æ²³å’","note":"","ucode":"B0E49555A3B161","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":640718,"discussion_content":"è€å¸ˆä½ å¥½ï¼Œè¿™é‡Œè¯´çš„â€œä¾èµ–installâ€å…·ä½“æŒ‡å“ªäº›ï¼Ÿå¯ä»¥ç»™ä¸ªæ“ä½œå‘½ä»¤å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1711769921,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":386249,"user_name":"Geek_9d0de4","can_delete":false,"product_type":"c1","uid":3031731,"ip_address":"ä¹Œå…‹å…°","ucode":"6692B89D125E9B","user_header":"","comment_is_top":false,"comment_ctime":1704383683,"is_pvip":false,"replies":[{"id":140882,"content":"åœ¨gitä¸Šå·²ç»ä¸Šä¼ äº†\n","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3050845,"ctime":1704972505,"ip_address":"åŒ—äº¬","comment_id":386249,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100546501,"comment_content":"ä½¿ç”¨çš„requirements.txtæ–‡ä»¶å¯ä»¥ä¸Šä¼ ä¸‹å—ï¼Ÿå¥½å¤šä¾èµ–é”™è¯¯flask_uploads ImportError: cannot import name &#39;secure_filename&#39; from &#39;werkzeug\n\nflask_sqlalchemy cannot import name &#39;app_ctx&#39; from &#39;flask.globals&#39;","like_count":0,"discussions":[{"author":{"id":3050845,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/8d/5d/9a86007c.jpg","nickname":"Barry","note":"","ucode":"82175C78B4CAED","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":635614,"discussion_content":"åœ¨gitä¸Šå·²ç»ä¸Šä¼ äº†\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1704972505,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2663531,"avatar":"https://static001.geekbang.org/account/avatar/00/28/a4/6b/c87bbaf7.jpg","nickname":"èµµå°å‹‡","note":"","ucode":"372A5CAD8EAC29","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":637515,"discussion_content":"è€å¸ˆï¼Œgiteeä¸Šé¢å¥½åƒè¿˜æ˜¯æ²¡æœ‰çœ‹åˆ°requirements.txtæ–‡ä»¶ï¼Œèƒ½éº»çƒ¦ä¸Šä¼ ä¸‹å—ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1708585152,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":385231,"user_name":"Geek_in7j5o","can_delete":false,"product_type":"c1","uid":1337670,"ip_address":"æ²³å—","ucode":"1F20D50F20B0C1","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/XxMiatkEbd8CrMgKk3NHzEhA2rQvNq2TgnOey35DOWLPpRh39MugzzE4M324pEsmg2JbGiazhVBt9rNZZvapgnicg/132","comment_is_top":false,"comment_ctime":1702298677,"is_pvip":false,"replies":[{"id":140505,"content":"è¿™ä¸ªé”™è¯¯ä¿¡æ¯æ˜¯æ¥è‡ªFaissåº“ï¼Œé”™è¯¯åŸå› æ˜¯åœ¨å°è¯•è¯»å–ä¸€ä¸ªç´¢å¼•æ—¶æŠ¥é”™ã€‚ä½ å¯ä»¥å°è¯•é€šè¿‡ä¸‹é¢çš„æ–¹æ³•è¿›è¡Œè°ƒæ•´ä¼˜åŒ–ä¸€ä¸‹ï¼š\né¦–å…ˆã€ç¡®ä¿&#47;opt&#47;cili&#47;data&#47;faiss-movie.indexè¿™ä¸ªæ–‡ä»¶å­˜åœ¨å¹¶ä¸”å¯è¯»ã€‚\nå…¶æ¬¡ï¼Œç¡®ä¿ä½ çš„ç¨‹åºæœ‰è¶³å¤Ÿçš„æƒé™æ¥è¯»å–è¿™ä¸ªæ–‡ä»¶ã€‚å¦‚æœè¿™ä¸ªç´¢å¼•æ–‡ä»¶æ˜¯å¤–éƒ¨åˆ›å»ºçš„ï¼Œå¯èƒ½éœ€è¦æ£€æŸ¥åˆ›å»ºç´¢å¼•æ—¶çš„ç‰ˆæœ¬å’Œä½ çš„Faissåº“ç‰ˆæœ¬æ˜¯å¦å…¼å®¹ã€‚\næœ€åï¼Œå°è¯•é‡æ–°åˆ›å»ºç´¢å¼•æˆ–ä½¿ç”¨ä¸åŒçš„ç´¢å¼•æ–‡ä»¶è·¯å¾„ã€‚å¦‚æœå¯èƒ½ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰ä»»ä½•ä¸è®¾å¤‡ç›¸å…³çš„æ“ä½œæˆ–é…ç½®éœ€è¦è°ƒæ•´ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3050845,"ctime":1702958497,"ip_address":"åŒ—äº¬","comment_id":385231,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100546501,"comment_content":"è€å¸ˆï¼ŒRuntimeError: Error in faiss::Index* faiss::read_index(faiss::IOReader*, int) at &#47;opt&#47;conda&#47;conda-bld&#47;faiss-pkg_1623024438023&#47;work&#47;faiss&#47;impl&#47;index_read.cpp:414: Error: &#39;ret == (1)&#39; failed: read error in &#47;opt&#47;cili&#47;data&#47;faiss-movie.index: 0 != 1 (Inappropriate ioctl for device)","like_count":0,"discussions":[{"author":{"id":3050845,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/8d/5d/9a86007c.jpg","nickname":"Barry","note":"","ucode":"82175C78B4CAED","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":634057,"discussion_content":"è¿™ä¸ªé”™è¯¯ä¿¡æ¯æ˜¯æ¥è‡ªFaissåº“ï¼Œé”™è¯¯åŸå› æ˜¯åœ¨å°è¯•è¯»å–ä¸€ä¸ªç´¢å¼•æ—¶æŠ¥é”™ã€‚ä½ å¯ä»¥å°è¯•é€šè¿‡ä¸‹é¢çš„æ–¹æ³•è¿›è¡Œè°ƒæ•´ä¼˜åŒ–ä¸€ä¸‹ï¼š\né¦–å…ˆã€ç¡®ä¿/opt/cili/data/faiss-movie.indexè¿™ä¸ªæ–‡ä»¶å­˜åœ¨å¹¶ä¸”å¯è¯»ã€‚\nå…¶æ¬¡ï¼Œç¡®ä¿ä½ çš„ç¨‹åºæœ‰è¶³å¤Ÿçš„æƒé™æ¥è¯»å–è¿™ä¸ªæ–‡ä»¶ã€‚å¦‚æœè¿™ä¸ªç´¢å¼•æ–‡ä»¶æ˜¯å¤–éƒ¨åˆ›å»ºçš„ï¼Œå¯èƒ½éœ€è¦æ£€æŸ¥åˆ›å»ºç´¢å¼•æ—¶çš„ç‰ˆæœ¬å’Œä½ çš„Faissåº“ç‰ˆæœ¬æ˜¯å¦å…¼å®¹ã€‚\næœ€åï¼Œå°è¯•é‡æ–°åˆ›å»ºç´¢å¼•æˆ–ä½¿ç”¨ä¸åŒçš„ç´¢å¼•æ–‡ä»¶è·¯å¾„ã€‚å¦‚æœå¯èƒ½ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰ä»»ä½•ä¸è®¾å¤‡ç›¸å…³çš„æ“ä½œæˆ–é…ç½®éœ€è¦è°ƒæ•´ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1702958497,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2,\"source\":0}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":379131,"user_name":"Lee","can_delete":false,"product_type":"c1","uid":1060230,"ip_address":"ç¾å›½","ucode":"357C3D2F33B325","user_header":"https://static001.geekbang.org/account/avatar/00/10/2d/86/07a10be2.jpg","comment_is_top":false,"comment_ctime":1691395029,"is_pvip":false,"replies":[{"id":138196,"content":"helloï¼ŒåŒå­¦ï¼Œrequirements.txtæ–‡ä»¶é€šå¸¸æ˜¯ç”±é¡¹ç›®æœ¬èº«ç”Ÿæˆçš„ã€‚åœ¨Pythoné¡¹ç›®ä¸­ï¼Œä½¿ç”¨pipå·¥å…·æ¥ç®¡ç†é¡¹ç›®çš„ä¾èµ–åŒ…ã€‚å½“ä½ å®‰è£…ä¸€ä¸ªåŒ…æ—¶ï¼Œpipä¼šè®°å½•å®‰è£…çš„åŒ…åŠå…¶ç‰ˆæœ¬ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å¯ä»¥ç”¨æ¥åˆ›å»ºä¸€ä¸ªrequirements.txtæ–‡ä»¶ã€‚\n\nåˆ›å»ºrequirements.txtæ–‡ä»¶çš„ç›®çš„æ˜¯ç¡®ä¿åœ¨ä¸åŒå¼€å‘ç¯å¢ƒå’Œå¹³å°ä¸Šè¿è¡Œé¡¹ç›®æ—¶ï¼Œæ‰€éœ€çš„ä¾èµ–åŒ…èƒ½å¤Ÿè¢«æ­£ç¡®åœ°å®‰è£…å’Œé…ç½®ã€‚è¿™æ ·å¯ä»¥é¿å…å› ä¸åŒç¯å¢ƒå¯¼è‡´çš„å·®å¼‚å’Œé”™è¯¯ã€‚\n\nåœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…é¡¹ç›®ä¾èµ–åŒ…æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä»requirements.txtæ–‡ä»¶ä¸­å®‰è£…æŒ‡å®šçš„ä¾èµ–åŒ…ï¼Œè¿™ä¸ªæ˜¯å‘½ä»¤ï¼š\npip install -r requirements.txt\n\nè¿™æ¡å‘½ä»¤å‘Šè¯‰pipå·¥å…·ä»requirements.txtæ–‡ä»¶ä¸­è¯»å–ä¾èµ–é¡¹åˆ—è¡¨ï¼Œå¹¶æŒ‰ç…§æŒ‡å®šçš„ç‰ˆæœ¬è¦æ±‚å®‰è£…è¿™äº›ä¾èµ–åŒ…ã€‚\n\nç¡®ä¿åœ¨è™šæ‹Ÿç¯å¢ƒä¸­æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œä»¥ä¾¿åœ¨éš”ç¦»çš„ç¯å¢ƒä¸­å®‰è£…é¡¹ç›®æ‰€éœ€çš„ä¾èµ–åŒ…ï¼Œè€Œä¸å½±å“å…¨å±€ç¯å¢ƒæˆ–å…¶ä»–é¡¹ç›®ã€‚\n\nä½ æ ¹æ®è¯¾ç¨‹çš„æ“ä½œå‘½ä»¤å°±å¯ä»¥ç”Ÿæˆæ–‡ä»¶äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3050845,"ctime":1691647516,"ip_address":"åŒ—äº¬","comment_id":379131,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100546501,"comment_content":"è€å¸ˆï¼Œé¡¹ç›®ä»£ç é‡Œæ²¡å‘ç°requirements.txt","like_count":0,"discussions":[{"author":{"id":3050845,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/8d/5d/9a86007c.jpg","nickname":"Barry","note":"","ucode":"82175C78B4CAED","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":625403,"discussion_content":"helloï¼ŒåŒå­¦ï¼Œrequirements.txtæ–‡ä»¶é€šå¸¸æ˜¯ç”±é¡¹ç›®æœ¬èº«ç”Ÿæˆçš„ã€‚åœ¨Pythoné¡¹ç›®ä¸­ï¼Œä½¿ç”¨pipå·¥å…·æ¥ç®¡ç†é¡¹ç›®çš„ä¾èµ–åŒ…ã€‚å½“ä½ å®‰è£…ä¸€ä¸ªåŒ…æ—¶ï¼Œpipä¼šè®°å½•å®‰è£…çš„åŒ…åŠå…¶ç‰ˆæœ¬ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å¯ä»¥ç”¨æ¥åˆ›å»ºä¸€ä¸ªrequirements.txtæ–‡ä»¶ã€‚\n\nåˆ›å»ºrequirements.txtæ–‡ä»¶çš„ç›®çš„æ˜¯ç¡®ä¿åœ¨ä¸åŒå¼€å‘ç¯å¢ƒå’Œå¹³å°ä¸Šè¿è¡Œé¡¹ç›®æ—¶ï¼Œæ‰€éœ€çš„ä¾èµ–åŒ…èƒ½å¤Ÿè¢«æ­£ç¡®åœ°å®‰è£…å’Œé…ç½®ã€‚è¿™æ ·å¯ä»¥é¿å…å› ä¸åŒç¯å¢ƒå¯¼è‡´çš„å·®å¼‚å’Œé”™è¯¯ã€‚\n\nåœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…é¡¹ç›®ä¾èµ–åŒ…æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä»requirements.txtæ–‡ä»¶ä¸­å®‰è£…æŒ‡å®šçš„ä¾èµ–åŒ…ï¼Œè¿™ä¸ªæ˜¯å‘½ä»¤ï¼š\npip install -r requirements.txt\n\nè¿™æ¡å‘½ä»¤å‘Šè¯‰pipå·¥å…·ä»requirements.txtæ–‡ä»¶ä¸­è¯»å–ä¾èµ–é¡¹åˆ—è¡¨ï¼Œå¹¶æŒ‰ç…§æŒ‡å®šçš„ç‰ˆæœ¬è¦æ±‚å®‰è£…è¿™äº›ä¾èµ–åŒ…ã€‚\n\nç¡®ä¿åœ¨è™šæ‹Ÿç¯å¢ƒä¸­æ‰§è¡Œè¯¥å‘½ä»¤ï¼Œä»¥ä¾¿åœ¨éš”ç¦»çš„ç¯å¢ƒä¸­å®‰è£…é¡¹ç›®æ‰€éœ€çš„ä¾èµ–åŒ…ï¼Œè€Œä¸å½±å“å…¨å±€ç¯å¢ƒæˆ–å…¶ä»–é¡¹ç›®ã€‚\n\nä½ æ ¹æ®è¯¾ç¨‹çš„æ“ä½œå‘½ä»¤å°±å¯ä»¥ç”Ÿæˆæ–‡ä»¶äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1691647516,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":377690,"user_name":"ğŸŒ€Pick Monster ğŸŒ€","can_delete":false,"product_type":"c1","uid":1141196,"ip_address":"é™•è¥¿","ucode":"EE67F41B360460","user_header":"https://static001.geekbang.org/account/avatar/00/11/69/cc/747c7629.jpg","comment_is_top":false,"comment_ctime":1689043580,"is_pvip":true,"replies":[{"id":137664,"content":"ä½ å¥½åŒå­¦ï¼Œfcntlæ˜¯ä¸€ä¸ªç”¨äºæ§åˆ¶æ–‡ä»¶çš„å‡½æ•°åº“ï¼Œå®ƒæä¾›äº†ä¸€ç³»åˆ—ç”¨äºæ–‡ä»¶æ§åˆ¶çš„å‡½æ•°ï¼Œfcntlæ¨¡å—æä¾›äº†æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨è¿™äº›å‡½æ•°æ¥æ§åˆ¶æ–‡ä»¶ã€‚\nWindowsä¸‹ä½¿ç”¨gunicornå‡ºç°&quot;ModuleNotFoundError: No module named &#39;fcntl&#39;&quot;é”™è¯¯ï¼Œä½ å¯ä»¥ä½¿ç”¨pipå®‰è£…fcntlæ¨¡å—ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼špip install fcntl\nå¦‚æœä½ ä½¿ç”¨çš„æ˜¯Linuxå­ç³»ç»Ÿï¼Œå¯ä»¥å°è¯•åœ¨Windowså­ç³»ç»Ÿä¸­è¿è¡Œgunicornã€‚åœ¨Windowså­ç³»ç»Ÿä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…fcntlæ¨¡å—ï¼š\nsudo apt-get install python3-dev  \npip install fcntl\næ— è®ºä½ é€‰æ‹©å“ªç§æ–¹æ³•ï¼Œç¡®ä¿ä½ çš„Pythonç¯å¢ƒæ­£ç¡®é…ç½®ï¼Œå¹¶ä¸”å·²ç»å®‰è£…äº†å¿…è¦çš„ä¾èµ–é¡¹ã€‚å¦‚æœè¿˜ä¸èƒ½è§£å†³å¯ä»¥è¿½è¯„","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3050845,"ctime":1689172591,"ip_address":"åŒ—äº¬","comment_id":377690,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100546501,"comment_content":"è€å¸ˆæ–‡ç« ä¸­çš„gunicornåœ¨windowsä¸‹ä¸å¯ç”¨ï¼Œä¼šæŠ¥ModuleNotFoundError: No module named &#39;fcntl&#39;é”™è¯¯","like_count":0,"discussions":[{"author":{"id":3050845,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/8d/5d/9a86007c.jpg","nickname":"Barry","note":"","ucode":"82175C78B4CAED","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":623218,"discussion_content":"ä½ å¥½åŒå­¦ï¼Œfcntlæ˜¯ä¸€ä¸ªç”¨äºæ§åˆ¶æ–‡ä»¶çš„å‡½æ•°åº“ï¼Œå®ƒæä¾›äº†ä¸€ç³»åˆ—ç”¨äºæ–‡ä»¶æ§åˆ¶çš„å‡½æ•°ï¼Œfcntlæ¨¡å—æä¾›äº†æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨è¿™äº›å‡½æ•°æ¥æ§åˆ¶æ–‡ä»¶ã€‚\nWindowsä¸‹ä½¿ç”¨gunicornå‡ºç°&#34;ModuleNotFoundError: No module named &#39;fcntl&#39;&#34;é”™è¯¯ï¼Œä½ å¯ä»¥ä½¿ç”¨pipå®‰è£…fcntlæ¨¡å—ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼špip install fcntl\nå¦‚æœä½ ä½¿ç”¨çš„æ˜¯Linuxå­ç³»ç»Ÿï¼Œå¯ä»¥å°è¯•åœ¨Windowså­ç³»ç»Ÿä¸­è¿è¡Œgunicornã€‚åœ¨Windowså­ç³»ç»Ÿä¸­ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…fcntlæ¨¡å—ï¼š\nsudo apt-get install python3-dev  \npip install fcntl\næ— è®ºä½ é€‰æ‹©å“ªç§æ–¹æ³•ï¼Œç¡®ä¿ä½ çš„Pythonç¯å¢ƒæ­£ç¡®é…ç½®ï¼Œå¹¶ä¸”å·²ç»å®‰è£…äº†å¿…è¦çš„ä¾èµ–é¡¹ã€‚å¦‚æœè¿˜ä¸èƒ½è§£å†³å¯ä»¥è¿½è¯„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1689172591,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1151675,"avatar":"https://static001.geekbang.org/account/avatar/00/11/92/bb/f6e3cdba.jpg","nickname":"è¿‡æ²³å’","note":"","ucode":"B0E49555A3B161","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":640763,"discussion_content":"å…³äºè€å¸ˆæœ€åæåˆ°çš„â€œå®‰è£…äº†å¿…è¦çš„ä¾èµ–é¡¹â€ï¼Œä¾èµ–é¡¹çš„å®‰è£…æœ‰å“ªäº›æ“ä½œå‘½ä»¤ï¼Ÿæœ‰ä»€ä¹ˆæ–¹å¼å¯ä»¥ç¡®è®¤ä¾èµ–é¡¹å®‰è£…æ˜¯å®Œæ•´çš„å‘¢ï¼Ÿå¹¶ä¸”ç›¸å…³çš„ç‰ˆæœ¬ä¹Ÿæ˜¯å…¼å®¹çš„ï¼Œè°¢è°¢ï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1711809989,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":377391,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"åŒ—äº¬","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1688435087,"is_pvip":false,"replies":[{"id":137554,"content":"1ã€æ”¶é›†æ—¥å¿—ã€è§£ææ—¥å¿—ã€åˆ†ææ—¥å¿—ã€å­˜å‚¨å’Œå¤‡ä»½ã€æ¸…ç†æ—¥å¿—å·®ä¸å¤šåˆ†ä¸ºè¿™å‡ æ­¥æ¥å®Œæˆï¼Œé‡ç‚¹æˆ‘ä»¬é€šè¿‡æ—¥å¿—æ¥å¿«é€Ÿå®šä½é—®é¢˜ï¼Œè¿˜æœ‰å°±æ˜¯èƒ½å¤Ÿè®°å½•ä¸€äº›å¹³å°ç”¨æˆ·çš„æ“ä½œã€‚\n2ã€ç½‘ç«™è¿è¥æ˜¯æŒ‡å¯¹ä¸€ä¸ªç½‘ç«™è¿›è¡Œç»´æŠ¤ã€ä¼˜åŒ–ã€æ¨å¹¿å’Œè¥é”€çš„ä¸€ç³»åˆ—æ´»åŠ¨ï¼Œç›®çš„æ˜¯ä¸ºäº†å¸å¼•æ›´å¤šçš„ç”¨æˆ·å’Œå®¢æˆ·ï¼Œæé«˜ç½‘ç«™çš„æµé‡å’Œæ”¶ç›Šã€‚ç½‘ç«™è¿è¥å’Œè¿ç»´æ˜¯å¯†åˆ‡ç›¸å…³çš„ã€‚è¿ç»´æ˜¯æŒ‡å¯¹ä¸€ä¸ªç½‘ç«™è¿›è¡ŒæŠ€æœ¯ä¸Šçš„ç»´æŠ¤å’Œç®¡ç†ï¼ŒåŒ…æ‹¬æœåŠ¡å™¨ã€ç½‘ç»œã€å®‰å…¨ç­‰æ–¹é¢çš„ç®¡ç†å’Œç»´æŠ¤å·¥ä½œã€‚è€Œè¿è¥åˆ™æ›´ä¾§é‡äºå¯¹ç½‘ç«™çš„å†…å®¹ã€ç”¨æˆ·ã€è¥é”€ç­‰æ–¹é¢è¿›è¡Œç®¡ç†å’Œæ¨å¹¿ã€‚\n\n\n\n","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":3050845,"ctime":1688550255,"ip_address":"åŒ—äº¬","comment_id":377391,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100546501,"comment_content":"Q1ï¼šç½‘ç«™åç«¯æ—¥å¿—ä¸€èˆ¬æ˜¯æ€ä¹ˆå¤„ç†çš„ï¼Ÿ\nQ2ï¼šç½‘ç«™â€œè¿è¥â€å…·ä½“åšä»€ä¹ˆï¼Ÿæ¨å¹¿ç½‘ç«™å—ï¼Ÿå’Œè¿ç»´æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":3050845,"avatar":"https://static001.geekbang.org/account/avatar/00/2e/8d/5d/9a86007c.jpg","nickname":"Barry","note":"","ucode":"82175C78B4CAED","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":622695,"discussion_content":"1ã€æ”¶é›†æ—¥å¿—ã€è§£ææ—¥å¿—ã€åˆ†ææ—¥å¿—ã€å­˜å‚¨å’Œå¤‡ä»½ã€æ¸…ç†æ—¥å¿—å·®ä¸å¤šåˆ†ä¸ºè¿™å‡ æ­¥æ¥å®Œæˆï¼Œé‡ç‚¹æˆ‘ä»¬é€šè¿‡æ—¥å¿—æ¥å¿«é€Ÿå®šä½é—®é¢˜ï¼Œè¿˜æœ‰å°±æ˜¯èƒ½å¤Ÿè®°å½•ä¸€äº›å¹³å°ç”¨æˆ·çš„æ“ä½œã€‚\n2ã€ç½‘ç«™è¿è¥æ˜¯æŒ‡å¯¹ä¸€ä¸ªç½‘ç«™è¿›è¡Œç»´æŠ¤ã€ä¼˜åŒ–ã€æ¨å¹¿å’Œè¥é”€çš„ä¸€ç³»åˆ—æ´»åŠ¨ï¼Œç›®çš„æ˜¯ä¸ºäº†å¸å¼•æ›´å¤šçš„ç”¨æˆ·å’Œå®¢æˆ·ï¼Œæé«˜ç½‘ç«™çš„æµé‡å’Œæ”¶ç›Šã€‚ç½‘ç«™è¿è¥å’Œè¿ç»´æ˜¯å¯†åˆ‡ç›¸å…³çš„ã€‚è¿ç»´æ˜¯æŒ‡å¯¹ä¸€ä¸ªç½‘ç«™è¿›è¡ŒæŠ€æœ¯ä¸Šçš„ç»´æŠ¤å’Œç®¡ç†ï¼ŒåŒ…æ‹¬æœåŠ¡å™¨ã€ç½‘ç»œã€å®‰å…¨ç­‰æ–¹é¢çš„ç®¡ç†å’Œç»´æŠ¤å·¥ä½œã€‚è€Œè¿è¥åˆ™æ›´ä¾§é‡äºå¯¹ç½‘ç«™çš„å†…å®¹ã€ç”¨æˆ·ã€è¥é”€ç­‰æ–¹é¢è¿›è¡Œç®¡ç†å’Œæ¨å¹¿ã€‚\n\n\n\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1688550255,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1809855,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/9d/bf/8785c879.jpg","nickname":"è‹ è¿œ å…´","note":"","ucode":"7FF387AF01E05C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":626870,"discussion_content":"æ˜¯è§†é¢‘æ•™ç¨‹è¿˜æ˜¯å°±å›¾æ–‡ï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1693458886,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ±Ÿè¥¿","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}