{"id":196785,"title":"30 | Coroutinesï¼šåä½œå¼çš„äº¤å‰è°ƒåº¦æ‰§è¡Œ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å´å’ç‚œã€‚</p><p>ä»Šå¤©æ˜¯æˆ‘ä»¬æœªæ¥ç¯‡çš„æœ€åä¸€è®²ï¼Œä¹Ÿæ˜¯è¿™ä¸ªä¸“æ æ­£æ–‡å†…å®¹çš„æœ€åä¸€ç¯‡äº†ã€‚æˆ‘ä»¬è®¨è®º C++20 é‡Œçš„åˆä¸€ä¸ªéå¸¸é‡è¦çš„æ–°åŠŸèƒ½â€”â€”åç¨‹ Coroutinesã€‚</p><h2>ä»€ä¹ˆæ˜¯åç¨‹ï¼Ÿ</h2><p>åç¨‹æ˜¯ä¸€ä¸ªå¾ˆæ—©å°±è¢«æå‡ºçš„ç¼–ç¨‹æ¦‚å¿µã€‚æ ¹æ®é«˜å¾·çº³çš„æè¿°ï¼Œåç¨‹çš„æ¦‚å¿µåœ¨ 1958 å¹´å°±è¢«æå‡ºäº†ã€‚ä¸è¿‡ï¼Œå®ƒåœ¨ä¸»æµç¼–ç¨‹è¯­è¨€ä¸­å¾—åˆ°çš„æ”¯æŒä¸é‚£ä¹ˆå¥½ï¼Œå› è€Œä½ å¾ˆå¯èƒ½å¯¹å®ƒå¹¶ä¸ç†Ÿæ‚‰å§ã€‚</p><p>å¦‚æœæŸ¥é˜…ç»´åŸºç™¾ç§‘ï¼Œä½ å¯ä»¥çœ‹åˆ°ä¸‹é¢è¿™æ ·çš„å®šä¹‰ <span class=\"orange\">[1]</span>ï¼š</p><blockquote>\n<p>åç¨‹æ˜¯è®¡ç®—æœºç¨‹åºçš„â¼€ç±»ç»„ä»¶ï¼Œæ¨â¼´äº†åä½œå¼å¤šä»»åŠ¡çš„â¼¦ç¨‹åºï¼Œå…è®¸æ‰§â¾è¢«æŒ‚èµ·ä¸è¢«æ¢å¤ã€‚ç›¸å¯¹â¼¦ä¾‹ç¨‹â½½â¾”ï¼Œåç¨‹æ›´ä¸ºâ¼€èˆ¬å’Œçµæ´»â€¦â€¦</p>\n</blockquote><p>ç­‰å­¦å®Œäº†è¿™ä¸€è®²ï¼Œä¹Ÿè®¸ä½ å¯ä»¥æ˜ç™½è¿™æ®µè¯çš„æ„æ€ã€‚ä½†å¯¹ä¸äº†è§£åç¨‹çš„äººæ¥è¯´ï¼Œä¼°è®¡åªèƒ½åæ§½ä¸€å¥äº†ï¼Œè¿™æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ</p><p><img src=\"https://static001.geekbang.org/resource/image/4d/f9/4d4fb4a1c16edb1087d934cd1bb7eef9.png?wh=1142*293\" alt=\"\" title=\"å›¾ç‰‡æºè‡ªç½‘ç»œ\"></p><p>å¾ˆé—æ†¾ï¼Œåœ¨ C++ é‡Œçš„æ ‡å‡†åç¨‹æœ‰ç‚¹å°å¤æ‚ã€‚æˆ‘ä»¬è¿˜æ˜¯ä»â€¦â€¦Python å¼€å§‹ã€‚</p><pre><code class=\"language-python\">def fibonacci():\n    a = 0\n    b = 1\n    while True:\n        yield b\n        a, b = b, a + b\n</code></pre><p>å³ä½¿ä½ æ²¡å­¦è¿‡ Pythonï¼Œä¸Šé¢è¿™ä¸ªç”Ÿæˆæ–æ³¢é‚£å¥‘æ•°åˆ—çš„ä»£ç åº”è¯¥ä¹Ÿä¸éš¾ç†è§£ã€‚å”¯ä¸€çœ‹èµ·æ¥è®©äººä¼šè§‰å¾—æœ‰ç‚¹å¥‡æ€ªçš„åº”è¯¥å°±æ˜¯é‚£ä¸ª <code>yield</code> äº†ã€‚è¿™ç§å†™æ³•åœ¨ Python é‡Œå«åšâ€œç”Ÿæˆå™¨â€ï¼ˆgeneratorï¼‰ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªå¯è¿­ä»£çš„å¯¹è±¡ï¼Œæ¯æ¬¡è¿­ä»£å°±èƒ½å¾—åˆ°ä¸€ä¸ª yield å‡ºæ¥çš„ç»“æœã€‚è¿™å°±æ˜¯ä¸€ç§å¾ˆå¸¸è§çš„åç¨‹å½¢å¼äº†ã€‚</p><!-- [[[read_end]]] --><p>å¦‚ä½•ä½¿ç”¨è¿™ä¸ªç”Ÿæˆå™¨ï¼Œè¯·çœ‹ä¸‹é¢çš„ä»£ç ï¼š</p><pre><code class=\"language-python\"># æ‰“å°å¤´ 20 é¡¹\nfor i in islice(fibonacci(), 20):\n    print(i)\n\n# æ‰“å°å°äº 10000 çš„æ•°åˆ—é¡¹\nfor i in takewhile(\n        lambda x: x &lt; 10000,\n        fibonacci()):\n    print(i)\n</code></pre><p>è¿™äº›ä»£ç å¾ˆå®¹æ˜“ç†è§£ï¼š<code>islice</code> ç›¸å½“äº<a href=\"https://time.geekbang.org/column/article/195553\">[ç¬¬ 29 è®²]</a> ä¸­çš„ <code>take</code>ï¼Œå–ä¸€ä¸ªèŒƒå›´çš„å¤´è‹¥å¹²é¡¹ï¼›<code>takewhile</code> åˆ™åœ¨èŒƒå›´ä¸­é€é¡¹å–å‡ºå†…å®¹ï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªå‚æ•°çš„æ¡ä»¶ä¸èƒ½è¢«æ»¡è¶³ã€‚ä¸¤ä¸ªå‡½æ•°çš„ç»“æœéƒ½å¯ä»¥è¢«çœ‹ä½œæ˜¯ C++ ä¸­çš„è§†å›¾ã€‚</p><p>æˆ‘ä»¬å”¯ä¸€éœ€è¦æçš„æ˜¯ï¼Œåœ¨ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œ<code>fibonacci</code> å’Œå®ƒçš„è°ƒç”¨ä»£ç æ˜¯äº¤å‰æ‰§è¡Œçš„ã€‚ä¸‹é¢æˆ‘ä»¬ç”¨ä»£ç è¡ŒåŠ æ³¨é‡Šçš„æ–¹å¼æ ‡ä¸€ä¸‹ï¼š</p><pre><code class=\"language-python\">a = 0  # fibonacci()\nb = 0  # fibonacci()\nyield b  # fibonacci()\nprint(i)  # è°ƒç”¨è€…\na, b = 1, 0 + 1  # fibonacci()\nyield b  # fibonacci()\nprint(i)  # è°ƒç”¨è€…\na, b = 1, 1 + 1  # fibonacci()\nyield b  # fibonacci()\nprint(i)  # è°ƒç”¨è€…\na, b = 2, 1 + 2  # fibonacci()\nyield b  # fibonacci()\nprint(i)  # è°ƒç”¨è€…\nâ€¦\n</code></pre><p>å­¦åˆ°è¿™å„¿çš„åŒå­¦åº”è¯¥éƒ½çŸ¥é“æˆ‘ä»¬åœ¨ C++ é‡Œæ€ä¹ˆå®Œæˆç±»ä¼¼çš„åŠŸèƒ½å§ï¼Ÿæˆ‘å°±ä¸è®²è§£äº†ï¼Œç›´æ¥ç»™å‡ºå¯å·¥ä½œçš„ä»£ç ã€‚è¿™æ˜¯å¯¹åº”çš„ <code>fibonacci</code> çš„å®šä¹‰ï¼š</p><pre><code class=\"language-c++\">#include &lt;iterator&gt;\n#include &lt;stddef.h&gt;\n#include &lt;stdint.h&gt;\n\nclass fibonacci {\npublic:\n  class sentinel;\n  class iterator;\n  iterator begin() noexcept;\n  sentinel end() noexcept;\n};\n\nclass fibonacci::sentinel {};\n\nclass fibonacci::iterator {\npublic:\n  // Required to satisfy iterator\n  // concept\n  typedef ptrdiff_t difference_type;\n  typedef uint64_t value_type;\n  typedef const uint64_t* pointer;\n  typedef const uint64_t&amp; reference;\n  typedef std::input_iterator_tag\n    iterator_category;\n\n  value_type operator*() const\n  {\n    return b_;\n  }\n  pointer operator-&gt;() const\n  {\n    return &amp;b_;\n  }\n  iterator&amp; operator++()\n  {\n    auto tmp = a_;\n    a_ = b_;\n    b_ += tmp;\n    return *this;\n  }\n  iterator operator++(int)\n  {\n    auto tmp = *this;\n    ++*this;\n    return tmp;\n  }\n  bool\n  operator==(const sentinel&amp;) const\n  {\n    return false;\n  }\n  bool\n  operator!=(const sentinel&amp;) const\n  {\n    return true;\n  }\n\nprivate:\n  uint64_t a_{0};\n  uint64_t b_{1};\n};\n\n// sentinel needs to be\n// equality_comparable_with iterator\nbool operator==(\n  const fibonacci::sentinel&amp; lhs,\n  const fibonacci::iterator&amp; rhs)\n{\n  return rhs == lhs;\n}\nbool operator!=(\n  const fibonacci::sentinel&amp; lhs,\n  const fibonacci::iterator&amp; rhs)\n{\n  return rhs != lhs;\n}\n\ninline fibonacci::iterator\nfibonacci::begin() noexcept\n{\n  return iterator();\n}\n\ninline fibonacci::sentinel\nfibonacci::end() noexcept\n{\n  return sentinel();\n}\n</code></pre><p>è°ƒç”¨ä»£ç è·Ÿ Python çš„ç›¸ä¼¼ï¼š</p><pre><code class=\"language-c++\">// æ‰“å°å¤´ 20 é¡¹\nfor (auto i :\n     fibonacci() | take(20)) {\n  cout &lt;&lt; i &lt;&lt; endl;\n}\n\n// æ‰“å°å°äº 10000 çš„æ•°åˆ—é¡¹\nfor (auto i :\n     fibonacci() |\n       take_while([](uint64_t x) {\n         return x &lt; 10000;\n       })) {\n  cout &lt;&lt; i &lt;&lt; endl;\n}\n</code></pre><p>è¿™ä¼¼ä¹è¿˜è¡Œã€‚ä½† <code>fibonacci</code> çš„å®šä¹‰å·®å¼‚å°±å¤§äº†ï¼šåœ¨ Python é‡Œæ˜¯ 6 è¡Œæœ‰æ•ˆä»£ç ï¼Œåœ¨ C++ é‡Œæ˜¯ 53 è¡Œã€‚C++ çš„ç”Ÿäº§ç‡ä¼¼ä¹æœ‰ç‚¹ä½å•Šâ€¦â€¦</p><h2>C++20 åç¨‹</h2><p>C++20 åç¨‹çš„åŸºç¡€æ˜¯å¾®è½¯æå‡ºçš„ Coroutines TSï¼ˆå¯æŸ¥çœ‹å·¥ä½œè‰æ¡ˆ <span class=\"orange\">[2]</span>ï¼‰ï¼Œå®ƒåœ¨ 2019 å¹´ 7 æœˆè¢«æ‰¹å‡†åŠ å…¥åˆ° C++20 è‰æ¡ˆä¸­ã€‚ç›®å‰ï¼ŒMSVC å’Œ Clang å·²ç»æ”¯æŒåç¨‹ã€‚ä¸è¿‡ï¼Œéœ€è¦æä¸€ä¸‹çš„æ˜¯ï¼Œç›®å‰è¢«æ ‡å‡†åŒ–çš„åªæ˜¯åç¨‹çš„åº•å±‚è¯­è¨€æ”¯æŒï¼Œè€Œä¸æ˜¯ä¸Šå±‚çš„é«˜çº§å°è£…ï¼›ç¨åï¼Œæˆ‘ä»¬ä¼šå›åˆ°è¿™ä¸ªè¯é¢˜ã€‚</p><p>åç¨‹å¯ä»¥æœ‰å¾ˆå¤šä¸åŒçš„ç”¨é€”ï¼Œä¸‹é¢åˆ—ä¸¾äº†å‡ ç§å¸¸è§æƒ…å†µï¼š</p><ul>\n<li>ç”Ÿæˆå™¨</li>\n<li>å¼‚æ­¥ I/O</li>\n<li>æƒ°æ€§æ±‚å€¼</li>\n<li>äº‹ä»¶é©±åŠ¨åº”ç”¨</li>\n</ul><p>è¿™ä¸€è®²ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦è¿˜æ˜¯æ²¿ç”¨ç”Ÿæˆå™¨çš„ä¾‹å­ï¼Œå‘ä½ å±•ç¤ºåç¨‹çš„åŸºæœ¬ç”¨æ³•ã€‚å¼‚æ­¥ I/O åº”å½“åœ¨åç¨‹å¾—åˆ°å¹¿æ³›é‡‡ç”¨ä¹‹åï¼Œæˆä¸ºæœ€èƒ½æœ‰æ˜æ˜¾æ”¶ç›Šçš„ä½¿ç”¨åœºæ™¯ï¼›ä½†ç›®å‰ï¼Œå°±æˆ‘çœ‹åˆ°çš„ï¼Œåªæœ‰ Windows å¹³å°ä¸Šæœ‰è¾ƒå¥½çš„æ”¯æŒâ€”â€”å¾®è½¯ç›®å‰è¿˜æ˜¯åšäº†å¾ˆå¤šåŠªåŠ›çš„ã€‚</p><p>å›åˆ° Coroutinesã€‚æˆ‘ä»¬ä»Šå¤©é‡‡ç”¨ Coroutines TS ä¸­çš„å†™æ³•ï¼ŒåŒ…æ‹¬ <code>std::experimental</code> åç©ºé—´ï¼Œä»¥ç¡®ä¿ä½ å¯ä»¥åœ¨ MSVC å’Œ Clang ä¸‹ç¼–è¯‘ä»£ç ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹åç¨‹ç›¸å…³çš„æ–°å…³é”®å­—ï¼Œæœ‰ä¸‹é¢ä¸‰ä¸ªï¼š</p><ul>\n<li><code>co_await</code></li>\n<li><code>co_yield</code></li>\n<li><code>co_return</code></li>\n</ul><p>è¿™ä¸‰ä¸ªå…³é”®å­—æœ€åˆæ˜¯æ²¡æœ‰ <code>co_</code> å‰ç¼€çš„ï¼Œä½†è€ƒè™‘åˆ° <code>await</code>ã€<code>yield</code> å·²ç»åœ¨å¾ˆå¤šä»£ç é‡Œå‡ºç°ï¼Œå°±æ”¹æˆäº†ç›®å‰è¿™ä¸ªæ ·å­ã€‚åŒæ—¶ï¼Œ<code>return</code> å’Œ <code>co_return</code> ä¹Ÿä½œå‡ºäº†æ˜ç¡®çš„åŒºåˆ†ï¼šä¸€ä¸ªåç¨‹é‡Œåªèƒ½ä½¿ç”¨ <code>co_return</code>ï¼Œä¸èƒ½ä½¿ç”¨ <code>return</code>ã€‚è¿™ä¸‰ä¸ªå…³é”®å­—åªè¦æœ‰ä¸€ä¸ªå‡ºç°åœ¨å‡½æ•°ä¸­ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯ä¸€ä¸ªåç¨‹äº†â€”â€”ä»å¤–éƒ¨åˆ™çœ‹ä¸å‡ºæ¥ï¼Œæ²¡æœ‰ç”¨å…¶ä»–è¯­è¨€å¸¸ç”¨çš„ <code>async</code> å…³é”®å­—æ¥æ ‡è®°ï¼ˆ<code>async</code> ä¹Ÿå·²ç»æœ‰å…¶ä»–ç”¨é€”äº†ï¼Œè§<a href=\"https://time.geekbang.org/column/article/186689\">[ç¬¬ 19 è®²]</a>ï¼‰ã€‚C++ è®¤ä¸ºä¸€ä¸ªå‡½æ•°æ˜¯å¦æ˜¯ä¸€ä¸ªåç¨‹æ˜¯ä¸€ä¸ªå®ç°ç»†èŠ‚ï¼Œä¸æ˜¯å¯¹å¤–æ¥å£çš„ä¸€éƒ¨åˆ†ã€‚</p><p>æˆ‘ä»¬çœ‹ä¸€ä¸‹ç”¨åç¨‹å®ç°çš„ <code>fibonacci</code> é•¿ä»€ä¹ˆæ ·å­ï¼š</p><pre><code class=\"language-c++\">uint64_resumable fibonacci()\n{\n  uint64_t a = 0;\n  uint64_t b = 1;\n  while (true) {\n    co_yield b;\n    auto tmp = a;\n    a = b;\n    b += tmp;\n  }\n}\n</code></pre><p>è¿™ä¸ªå½¢å¼è·Ÿ Python çš„éå¸¸ç›¸ä¼¼äº†å§ï¼Œä¹Ÿéå¸¸ç®€æ´ã€‚æˆ‘ä»¬ç¨åå†è®¨è®º <code>uint64_resumable</code> çš„å®šä¹‰ï¼Œå…ˆçœ‹ä¸€ä¸‹è°ƒç”¨ä»£ç çš„æ ·å­ï¼š</p><pre><code class=\"language-c++\">auto res = fibonacci();\nwhile (res.resume()) {\n  auto i = res.get();\n  if (i &gt;= 10000) {\n    break;\n  }\n  cout &lt;&lt; i &lt;&lt; endl;\n}\n</code></pre><p>è¿™ä¸ªä»£ç ä¹Ÿéå¸¸ç®€å•ï¼Œä½†æˆ‘ä»¬éœ€è¦ç•™æ„ <code>resume</code> å’Œ <code>get</code> ä¸¤ä¸ªå‡½æ•°è°ƒç”¨â€”â€”è¿™å°±æ˜¯æˆ‘ä»¬çš„ <code>uint64_resumable</code> ç±»å‹éœ€è¦æä¾›çš„æ¥å£äº†ã€‚</p><h3>co_awaitã€co_yieldã€co_return å’Œåç¨‹æ§åˆ¶</h3><p>åœ¨è®¨è®ºè¯¥å¦‚ä½•å®šä¹‰ <code>uint64_resumable</code> ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆè®¨è®ºä¸€ä¸‹åç¨‹çš„è¿™ä¸‰ä¸ªæ–°å…³é”®å­—ã€‚</p><p>é¦–å…ˆæ˜¯ <code>co_await</code>ã€‚å¯¹äºä¸‹é¢è¿™æ ·ä¸€ä¸ªè¡¨è¾¾å¼ï¼š</p><pre><code class=\"language-c++\">auto result = co_await è¡¨è¾¾å¼;\n</code></pre><p>ç¼–è¯‘å™¨ä¼šæŠŠå®ƒç†è§£ä¸ºï¼š</p><pre><code class=\"language-c++\">auto&amp;&amp; __a = è¡¨è¾¾å¼;\nif (!__a.await_ready()) {\n  __a.await_suspend(åç¨‹å¥æŸ„);\n  // æŒ‚èµ·/æ¢å¤ç‚¹\n}\nauto result = __a.await_resume();\n</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œâ€œè¡¨è¾¾å¼â€éœ€è¦æ”¯æŒ <code>await_ready</code>ã€<code>await_suspend</code> å’Œ <code>await_resume</code> ä¸‰ä¸ªæ¥å£ã€‚å¦‚æœ <code>await_ready()</code> è¿”å›çœŸï¼Œå°±ä»£è¡¨ä¸éœ€è¦çœŸæ­£æŒ‚èµ·ï¼Œç›´æ¥è¿”å›åé¢çš„ç»“æœå°±å¯ä»¥ï¼›å¦åˆ™ï¼Œæ‰§è¡Œ <code>await_suspend</code> ä¹‹åå³æŒ‚èµ·åç¨‹ï¼Œç­‰å¾…åç¨‹è¢«å”¤é†’ä¹‹åå†è¿”å› <code>await_resume()</code> çš„ç»“æœã€‚è¿™æ ·ä¸€ä¸ªè¡¨è¾¾å¼è¢«ç§°ä½œæ˜¯ä¸ª awaitableã€‚</p><p>æ ‡å‡†é‡Œå®šä¹‰äº†ä¸¤ä¸ª awaitableï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code class=\"language-c++\">struct suspend_always {\n  bool await_ready() const noexcept\n  {\n    return false;\n  }\n  void await_suspend(\n    coroutine_handle&lt;&gt;)\n    const noexcept {}\n  void await_resume()\n    const noexcept {}\n};\n\nstruct suspend_never {\n  bool await_ready() const noexcept\n  {\n    return true;\n  }\n  void await_suspend(\n    coroutine_handle&lt;&gt;)\n    const noexcept {}\n  void await_resume()\n    const noexcept {}\n};\n</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>suspend_always</code> æ°¸è¿œå‘Šè¯‰è°ƒç”¨è€…éœ€è¦æŒ‚èµ·ï¼Œè€Œ <code>suspend_never</code> åˆ™æ°¸è¿œå‘Šè¯‰è°ƒç”¨è€…ä¸éœ€è¦æŒ‚èµ·ã€‚ä¸¤è€…çš„ <code>await_suspend</code> å’Œ <code>await_resume</code> éƒ½æ˜¯å¹³å‡¡å®ç°ï¼Œä¸åšä»»ä½•å®é™…çš„äº‹æƒ…ã€‚ä¸€ä¸ª awaitable å¯ä»¥è‡ªè¡Œå®ç°è¿™äº›æ¥å£ï¼Œä»¥å®šåˆ¶æŒ‚èµ·ä¹‹å‰å’Œæ¢å¤ä¹‹åéœ€è¦æ‰§è¡Œçš„æ“ä½œã€‚</p><p>ä¸Šé¢çš„ <code>coroutine_handle</code> æ˜¯ C++ æ ‡å‡†åº“æä¾›çš„ç±»æ¨¡æ¿ã€‚è¿™ä¸ªç±»æ˜¯ç”¨æˆ·ä»£ç è·Ÿç³»ç»Ÿåç¨‹è°ƒåº¦çœŸæ­£äº¤äº’çš„åœ°æ–¹ï¼Œæœ‰ä¸‹é¢è¿™äº›æˆå‘˜å‡½æ•°æˆ‘ä»¬ç­‰ä¼šå°±ä¼šç”¨åˆ°ï¼š</p><ul>\n<li><code>destroy</code>ï¼šé”€æ¯åç¨‹</li>\n<li><code>done</code>ï¼šåˆ¤æ–­åç¨‹æ˜¯å¦å·²ç»æ‰§è¡Œå®Œæˆ</li>\n<li><code>resume</code>ï¼šè®©åç¨‹æ¢å¤æ‰§è¡Œ</li>\n<li><code>promise</code>ï¼šè·å¾—åç¨‹ç›¸å…³çš„ promise å¯¹è±¡ï¼ˆå’Œ<a href=\"https://time.geekbang.org/column/article/186689\">[ç¬¬ 19 è®²]</a> ä¸­çš„â€œæ‰¿è¯ºé‡â€æœ‰ç‚¹ç›¸ä¼¼ï¼Œæ˜¯åç¨‹å’Œè°ƒç”¨è€…çš„ä¸»è¦äº¤äº’å¯¹è±¡ï¼›ä¸€èˆ¬ç±»å‹åç§°ä¸º <code>promise_type</code>ï¼‰</li>\n<li><code>from_promise</code>ï¼ˆé™æ€ï¼‰ï¼šé€šè¿‡ promise å¯¹è±¡çš„å¼•ç”¨æ¥ç”Ÿæˆä¸€ä¸ªåç¨‹å¥æŸ„</li>\n</ul><p>åç¨‹çš„æ‰§è¡Œè¿‡ç¨‹å¤§è‡´æ˜¯è¿™ä¸ªæ ·å­çš„ï¼š</p><ol>\n<li>ä¸ºåç¨‹è°ƒç”¨åˆ†é…ä¸€ä¸ªåç¨‹å¸§ï¼Œå«åç¨‹è°ƒç”¨çš„å‚æ•°ã€å˜é‡ã€çŠ¶æ€ã€promise å¯¹è±¡ç­‰æ‰€éœ€çš„ç©ºé—´ã€‚</li>\n<li>è°ƒç”¨ <code>promise.get_return_object()</code>ï¼Œè¿”å›å€¼ä¼šåœ¨åç¨‹ç¬¬ä¸€æ¬¡æŒ‚èµ·æ—¶è¿”å›ç»™åç¨‹çš„è°ƒç”¨è€…ã€‚</li>\n<li>æ‰§è¡Œ <code>co_await promise.initial_suspsend()</code>ï¼›æ ¹æ®ä¸Šé¢å¯¹ <code>co_await</code> è¯­ä¹‰çš„æè¿°ï¼Œåç¨‹å¯èƒ½åœ¨æ­¤ç¬¬ä¸€æ¬¡æŒ‚èµ·ï¼ˆä½†ä¹Ÿå¯èƒ½æ­¤æ—¶ä¸æŒ‚èµ·ï¼Œåœ¨åé¢çš„åç¨‹ä½“æ‰§è¡Œè¿‡ç¨‹ä¸­æŒ‚èµ·ï¼‰ã€‚</li>\n<li>æ‰§è¡Œåç¨‹ä½“ä¸­çš„è¯­å¥ï¼Œä¸­é—´å¯èƒ½æœ‰æŒ‚èµ·å’Œæ¢å¤ï¼›å¦‚æœæœŸé—´å‘ç”Ÿå¼‚å¸¸æ²¡æœ‰åœ¨åç¨‹ä½“ä¸­å¤„ç†ï¼Œåˆ™è°ƒç”¨ <code>promise.unhandled_exception()</code>ã€‚</li>\n<li>å½“åç¨‹æ‰§è¡Œåˆ°åº•ï¼Œæˆ–è€…æ‰§è¡Œåˆ° <code>co_return</code> è¯­å¥æ—¶ï¼Œä¼šæ ¹æ®æ˜¯å¦æœ‰é void çš„è¿”å›å€¼ï¼Œè°ƒç”¨ <code>promise.return_value(â€¦)</code> æˆ– <code>promise.return_void()</code>ï¼Œç„¶åæ‰§è¡Œ <code>co_await promise.final_suspsend()</code>ã€‚</li>\n</ol><p>ç”¨ä»£ç å¯ä»¥å¤§è‡´è¡¨ç¤ºå¦‚ä¸‹ï¼š</p><pre><code class=\"language-c++\">  frame = operator new(â€¦);\n  promise_type&amp; promise =\n    frame-&gt;promise;\n\n  // åœ¨åˆæ¬¡æŒ‚èµ·æ—¶è¿”å›ç»™è°ƒç”¨è€…\n  auto return_value =\n    promise.get_return_object();\n\n  co_await promise\n    .initial_suspsend();\n  try {\n    æ‰§è¡Œåç¨‹ä½“;\n    å¯èƒ½è¢« co_waitã€co_yield æŒ‚èµ·;\n    æ¢å¤åç»§ç»­æ‰§è¡Œï¼Œç›´åˆ° co_return;\n  }\n  catch (...) {\n    promise.unhandled_exception();\n  }\n\nfinal_suspend:\n  co_await promise.final_suspsend();\n</code></pre><p>ä¸Šé¢æè¿°äº† <code>co_await</code> å’Œ <code>co_return</code>ï¼Œé‚£ <code>co_yield</code> å‘¢ï¼Ÿä¹Ÿå¾ˆç®€å•ï¼Œ<code>co_yield è¡¨è¾¾å¼</code> ç­‰ä»·äºï¼š</p><pre><code class=\"language-c++\">co_await promise.yield_value(è¡¨è¾¾å¼);\n</code></pre><h3>å®šä¹‰ <code>uint64_resumable</code></h3><p>äº†è§£äº†ä¸Šè¿°çŸ¥è¯†ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å±•ç¤ºä¸€ä¸‹ <code>uint64_resumable</code> çš„å®šä¹‰äº†ï¼š</p><pre><code class=\"language-c++\">class uint64_resumable {\npublic:\n  struct promise_type {â€¦};\n\n  using coro_handle =\n    coroutine_handle&lt;promise_type&gt;;\n  explicit uint64_resumable(\n    coro_handle handle)\n    : handle_(handle)\n  {\n  }\n  ~uint64_resumable()\n  {\n    handle_.destroy();\n  }\n  uint64_resumable(\n    const uint64_resumable&amp;) =\n    delete;\n  uint64_resumable(\n    uint64_resumable&amp;&amp;) = default;\n  bool resume();\n  uint64_t get();\n\nprivate:\n  coro_handle handle_;\n};\n</code></pre><p>è¿™ä¸ªä»£ç ç›¸å½“ç®€å•ï¼Œæˆ‘ä»¬çš„ç»“æ„å†…éƒ¨æœ‰ä¸ª <code>promise_type</code>ï¼ˆä¸‹é¢ä¼šå®šä¹‰ï¼‰ï¼Œè€Œç§æœ‰æˆå‘˜åªæœ‰ä¸€ä¸ªåç¨‹å¥æŸ„ã€‚åç¨‹æ„é€ éœ€è¦ä¸€ä¸ªåç¨‹å¥æŸ„ï¼Œææ„æ—¶å°†ä½¿ç”¨åç¨‹å¥æŸ„æ¥é”€æ¯åç¨‹ï¼›ä¸ºç®€å•èµ·è§ï¼Œæˆ‘ä»¬å…è®¸ç»“æ„è¢«ç§»åŠ¨ï¼Œä½†ä¸å¯å¤åˆ¶ï¼ˆä»¥å…é‡å¤è°ƒç”¨ <code>handle_.destroy()</code>ï¼‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿™ä¸ªç»“æ„åªæä¾›äº†è°ƒç”¨è€…éœ€è¦çš„ <code>resume</code> å’Œ <code>get</code> æˆå‘˜å‡½æ•°ï¼Œåˆ†åˆ«å®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code class=\"language-c++\">bool uint64_resumable::resume()\n{\n  if (!handle_.done()) {\n    handle_.resume();\n  }\n  return !handle_.done();\n}\n\nuint64_t uint64_resumable::get()\n{\n  return handle_.promise().value_;\n}\n</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>resume</code> ä¼šåˆ¤æ–­åç¨‹æ˜¯å¦å·²ç»ç»“æŸï¼Œæ²¡ç»“æŸå°±æ¢å¤åç¨‹çš„æ‰§è¡Œï¼›å½“åç¨‹å†æ¬¡æŒ‚èµ·æ—¶ï¼ˆè°ƒç”¨è€…æ¢å¤æ‰§è¡Œï¼‰ï¼Œè¿”å›åç¨‹æ˜¯å¦ä»åœ¨æ‰§è¡Œä¸­çš„çŠ¶æ€ã€‚è€Œ <code>get</code> ç®€å•åœ°è¿”å›å­˜å‚¨åœ¨ promise å¯¹è±¡ä¸­çš„æ•°å€¼ã€‚</p><p>ç°åœ¨æˆ‘ä»¬éœ€è¦çœ‹ä¸€ä¸‹ promise ç±»å‹äº†ï¼Œå®ƒé‡Œé¢æœ‰å¾ˆå¤šåç¨‹çš„å®šåˆ¶ç‚¹ï¼Œå¯ä»¥ä¿®æ”¹åç¨‹çš„è¡Œä¸ºï¼š</p><pre><code class=\"language-c++\">struct promise_type {\n  uint64_t value_;\n  using coro_handle =\n    coroutine_handle&lt;promise_type&gt;;\n  auto get_return_object()\n  {\n    return uint64_resumable{\n      coro_handle::from_promise(\n        *this)};\n  }\n  constexpr auto initial_suspend()\n  {\n    return suspend_always();\n  }\n  constexpr auto final_suspend()\n  {\n    return suspend_always();\n  }\n  auto yield_value(uint64_t value)\n  {\n    value_ = value;\n    return suspend_always();\n  }\n  void return_void() {}\n  void unhandled_exception()\n  {\n    std::terminate();\n  }\n};\n</code></pre><p>ç®€å•è§£è¯´ä¸€ä¸‹ï¼š</p><ul>\n<li>ç»“æ„é‡Œé¢åªæœ‰ä¸€ä¸ªæ•°æ®æˆå‘˜ <code>value_</code>ï¼Œå­˜æ”¾ä¾› <code>uint64_resumable::get</code> å–ç”¨çš„æ•°å€¼ã€‚</li>\n<li><code>get_return_object</code> æ˜¯ç¬¬ä¸€ä¸ªå®šåˆ¶ç‚¹ã€‚æˆ‘ä»¬å‰é¢æåˆ°è¿‡ï¼Œè°ƒç”¨åç¨‹çš„è¿”å›å€¼å°±æ˜¯ <code>get_return_object()</code> çš„ç»“æœã€‚æˆ‘ä»¬è¿™å„¿å°±æ˜¯ä½¿ç”¨ promise å¯¹è±¡æ¥æ„é€ ä¸€ä¸ª <code>uint64_resumable</code>ã€‚</li>\n<li><code>initial_suspend</code> æ˜¯ç¬¬äºŒä¸ªå®šåˆ¶ç‚¹ã€‚æˆ‘ä»¬æ­¤å¤„è¿”å› <code>suspend_always()</code>ï¼Œå³åç¨‹ç«‹å³æŒ‚èµ·ï¼Œè°ƒç”¨è€…é©¬ä¸Šå¾—åˆ° <code>get_return_object()</code> çš„ç»“æœã€‚</li>\n<li><code>final_suspend</code> æ˜¯ç¬¬ä¸‰ä¸ªå®šåˆ¶ç‚¹ã€‚æˆ‘ä»¬æ­¤å¤„è¿”å› <code>suspend_always()</code>ï¼Œå³ä½¿æ‰§è¡Œåˆ°äº† <code>co_return</code> è¯­å¥ï¼Œåç¨‹ä»å¤„äºæŒ‚èµ·çŠ¶æ€ã€‚å¦‚æœæˆ‘ä»¬è¿”å› <code>suspend_never()</code> çš„è¯ï¼Œé‚£ä¸€æ—¦æ‰§è¡Œäº† <code>co_return</code> æˆ–æ‰§è¡Œåˆ°åç¨‹ç»“æŸï¼Œåç¨‹å°±ä¼šè¢«é”€æ¯ï¼Œè¿åŒå·²åˆå§‹åŒ–çš„æœ¬åœ°å˜é‡å’Œ promiseï¼Œå¹¶é‡Šæ”¾åç¨‹å¸§å†…å­˜ã€‚</li>\n<li><code>yield_value</code> æ˜¯ç¬¬å››ä¸ªå®šåˆ¶ç‚¹ã€‚æˆ‘ä»¬è¿™å„¿ä»…å¯¹ <code>value_</code> è¿›è¡Œèµ‹å€¼ï¼Œç„¶åè®©åç¨‹æŒ‚èµ·ï¼ˆæ‰§è¡Œæ§åˆ¶å›åˆ°è°ƒç”¨è€…ï¼‰ã€‚</li>\n<li><code>return_void</code> æ˜¯ç¬¬äº”ä¸ªå®šåˆ¶ç‚¹ã€‚æˆ‘ä»¬çš„ä»£ç æ°¸ä¸è¿”å›ï¼Œè¿™å„¿æ— äº‹å¯åšã€‚</li>\n<li><code>unhandled_exception</code> æ˜¯ç¬¬å…­ä¸ªå®šåˆ¶ç‚¹ã€‚æˆ‘ä»¬è¿™å„¿ä¹Ÿä¸åº”è¯¥å‘ç”Ÿä»»ä½•å¼‚å¸¸ï¼Œæ‰€ä»¥æˆ‘ä»¬ç®€å•åœ°è°ƒç”¨ <code>terminate</code> æ¥ç»ˆç»“ç¨‹åºçš„æ‰§è¡Œã€‚</li>\n</ul><p>å¥½äº†ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†åç¨‹ç›¸å…³çš„æ‰€æœ‰å®šä¹‰ã€‚æœ‰æ²¡æœ‰è§‰å¾—è½»æ¾ç‚¹ï¼Ÿ</p><hr><p>æ²¡æœ‰ï¼Ÿé‚£å°±å¯¹äº†ã€‚æ­£å¦‚æˆ‘åœ¨è¿™ä¸€èŠ‚å¼€å¤´è¯´çš„ï¼ŒC++20 æ ‡å‡†åŒ–çš„åªæ˜¯åç¨‹çš„åº•å±‚è¯­è¨€æ”¯æŒï¼ˆæˆ‘ä¸Šé¢è¿˜å¹¶ä¸æ˜¯ä¸€ä¸ªéå¸¸å®Œæ•´çš„æè¿°ï¼‰ã€‚è¦ç”¨è¿™äº›åº•å±‚ç›´æ¥å†™åº”ç”¨ä»£ç ï¼Œé‚£æ˜¯éå¸¸ç—›è‹¦çš„äº‹ã€‚è¿™äº›æ¥å£çš„ç›®æ ‡ç”¨æˆ·å®é™…ä¸Šä¹Ÿä¸æ˜¯æ™®é€šå¼€å‘è€…ï¼Œè€Œæ˜¯åº“çš„ä½œè€…ã€‚</p><p>å¹¸å¥½ï¼Œæˆ‘ä»¬å¹¶ä¸æ˜¯æ²¡æœ‰ä»»ä½•é«˜å±‚æŠ½è±¡ï¼Œè™½ç„¶è¿™äº›å®ç°ä¸â€œæ ‡å‡†â€ã€‚</p><h2>C++20 åç¨‹çš„é«˜å±‚æŠ½è±¡</h2><h3>cppcoro</h3><p>æˆ‘ä»¬é¦–å…ˆçœ‹ä¸€ä¸‹è·¨å¹³å°çš„ cppcoro åº“ <span class=\"orange\">[3]</span>ï¼Œå®ƒæä¾›çš„é«˜å±‚æ¥å£å°±åŒ…å«äº† <code>generator</code>ã€‚å¦‚æœä½¿ç”¨ cppcoroï¼Œæˆ‘ä»¬çš„ <code>fibonacci</code> åç¨‹å¯ä»¥è¿™æ ·å®ç°ï¼š</p><pre><code class=\"language-c++\">#include &lt;cppcoro/generator.hpp&gt;\nusing cppcoro::generator;\n\ngenerator&lt;uint64_t&gt; fibonacci()\n{\n  uint64_t a = 0;\n  uint64_t b = 1;\n  while (true) {\n    co_yield b;\n    auto tmp = a;\n    a = b;\n    b += tmp;\n  }\n}\n</code></pre><p>ä½¿ç”¨ <code>fibonacci</code> ä¹Ÿæ¯”åˆšæ‰çš„ä»£ç è¦æ–¹ä¾¿ï¼š</p><pre><code class=\"language-c++\">for (auto i : fibonacci()) {\n  if (i &gt;= 10000) {\n    break;\n  }\n  cout &lt;&lt; i &lt;&lt; endl;\n}\n</code></pre><p>é™¤äº†ç”Ÿæˆå™¨ï¼Œcppcoro è¿˜æ”¯æŒå¼‚æ­¥ä»»åŠ¡å’Œå¼‚æ­¥ I/Oâ€”â€”é—æ†¾çš„æ˜¯ï¼Œå¼‚æ­¥ I/O ç›®å‰åªæœ‰ Windows å¹³å°ä¸Šæœ‰ï¼Œè¿˜æ²¡äººå®ç° Linux æˆ– macOS ä¸Šçš„æ”¯æŒã€‚</p><h3>MSVC</h3><p>ä½œä¸ºåç¨‹çš„å…ˆè¡Œè€…å’Œ Coroutines TS çš„æå‡ºè€…ï¼Œå¾®è½¯åœ¨åç¨‹ä¸Šåšäº†å¾ˆå¤šå·¥ä½œã€‚ç”Ÿæˆå™¨å½“ç„¶ä¹Ÿåœ¨å…¶ä¸­ï¼š</p><pre><code class=\"language-c++\">#include &lt;experimental/generator&gt;\nusing std::experimental::generator;\n\ngenerator&lt;uint64_t&gt; fibonacci()\n{\n  uint64_t a = 0;\n  uint64_t b = 1;\n  while (true) {\n    co_yield b;\n    auto tmp = a;\n    a = b;\n    b += tmp;\n  }\n}\n</code></pre><p>å¾®è½¯è¿˜æœ‰ä¸€äº›æœ‰è¶£çš„ç§æœ‰æ‰©å±•ã€‚æ¯”å¦‚ï¼ŒMSVC æŠŠæ ‡å‡† C++ çš„ <code>future</code> æ”¹é€ æˆäº† awaitableã€‚ä¸‹é¢çš„ä»£ç åœ¨ MSVC ä¸‹å¯ä»¥ç¼–è¯‘é€šè¿‡ï¼Œç®€å•åœ°å±•ç¤ºäº†åŸºæœ¬ç”¨æ³•ï¼š</p><pre><code class=\"language-c++\">future&lt;int&gt; compute_value()\n{\n  int result = co_await async([] {\n    this_thread::sleep_for(1s);\n    return 42;\n  });\n  co_return result;\n}\n\nint main()\n{\n  auto value = compute_value();\n  cout &lt;&lt; value.get() &lt;&lt; endl;\n}\n</code></pre><p>ä»£ç ä¸­æœ‰ä¸€ä¸ªåœ°æ–¹æˆ‘éœ€è¦æé†’ä¸€ä¸‹ï¼šè™½ç„¶ä¸Šé¢ <code>async</code> è¿”å›çš„æ˜¯ <code>future&lt;int&gt;</code>ï¼Œä½† <code>compute_value</code> çš„è°ƒç”¨è€…å¾—åˆ°çš„å¹¶ä¸æ˜¯è¿™ä¸ª <code>future</code>â€”â€”å®ƒå¾—åˆ°çš„æ˜¯å¦å¤–ä¸€ä¸ªç‹¬ç«‹çš„ <code>future</code>ï¼Œå¹¶æœ€ç»ˆç”± <code>co_return</code> æŠŠç»“æœæ•°å€¼å¡«å……äº†è¿›å»ã€‚</p><h2>æœ‰æ ˆåç¨‹å’Œæ— æ ˆåç¨‹</h2><p>æˆ‘ä»¬æœ€åéœ€è¦è¯´ä¸€ä¸‹æœ‰æ ˆï¼ˆstackfulï¼‰åç¨‹å’Œæ— æ ˆï¼ˆstacklessï¼‰åç¨‹çš„åŒºåˆ«ã€‚C++ é‡Œå¾ˆæ—©å°±æœ‰äº†æœ‰æ ˆçš„åç¨‹ï¼Œæ¦‚å¿µä¸Šæ¥è®²ï¼Œæœ‰æ ˆçš„åç¨‹è·Ÿçº¤ç¨‹ã€goroutines åŸºæœ¬æ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œéƒ½æ˜¯ç”±ç”¨æˆ·è‡ªè¡Œè°ƒåº¦çš„ã€æ“ä½œç³»ç»Ÿä¹‹å¤–çš„è¿è¡Œå•å…ƒã€‚æ¯ä¸ªè¿™æ ·çš„è¿è¡Œå•å…ƒéƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„æ ˆç©ºé—´ï¼Œç¼ºç‚¹å½“ç„¶å°±æ˜¯æ ˆçš„ç©ºé—´å ç”¨å’Œåˆ‡æ¢æ ˆçš„å¼€é”€äº†ã€‚è€Œæ— æ ˆçš„åç¨‹è‡ªå·±æ²¡æœ‰ç‹¬ç«‹çš„æ ˆç©ºé—´ï¼Œæ¯ä¸ªåç¨‹åªéœ€è¦ä¸€ä¸ªå¾ˆå°çš„æ ˆå¸§ï¼Œç©ºé—´å ç”¨å°ï¼Œä¹Ÿæ²¡æœ‰æ ˆçš„åˆ‡æ¢å¼€é”€ã€‚</p><p>C++20 çš„åç¨‹æ˜¯æ— æ ˆçš„ã€‚éƒ¨åˆ†åŸå› æ˜¯æœ‰æ ˆçš„åç¨‹å¯ä»¥ä½¿ç”¨çº¯åº“æ–¹å¼å®ç°ï¼Œè€Œæ— æ ˆçš„åç¨‹éœ€è¦ä¸€ç‚¹ç¼–è¯‘å™¨é­”æ³•å¸®å¿™ã€‚æ¯•ç«Ÿï¼Œåç¨‹é‡Œé¢çš„å˜é‡éƒ½æ˜¯è¦æ”¾åˆ°å †ä¸Šè€Œä¸æ˜¯æ ˆä¸Šçš„ã€‚</p><p>ä¸€ä¸ªç®€å•çš„æ— æ ˆåç¨‹è°ƒç”¨çš„å†…å­˜å¸ƒå±€å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/e3/66/e35d2b262c741acf40d69eedc6a5ad66.png?wh=1032*824\" alt=\"\"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œåç¨‹ C æœ¬èº«çš„æœ¬åœ°å˜é‡ä¸å ç”¨æ ˆï¼Œä½†å½“å®ƒè°ƒç”¨å…¶ä»–å‡½æ•°æ—¶ï¼Œå®ƒä¼šä½¿ç”¨çº¿ç¨‹åŸå…ˆçš„æ ˆç©ºé—´ã€‚åœ¨ä¸Šé¢çš„å‡½æ•° D çš„æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œåç¨‹æ˜¯ä¸å¯ä»¥æŒ‚èµ·çš„â€”â€”å¦‚æœæ§åˆ¶å›åˆ° B ç»§ç»­ï¼ŒB å¯èƒ½ä¼šä½¿ç”¨ç›®å‰å·²ç»è¢« D ä½¿ç”¨çš„æ ˆç©ºé—´ï¼</p><p>å› æ­¤ï¼Œæ— æ ˆçš„åç¨‹ç‰ºç‰²äº†ä¸€å®šçš„çµæ´»æ€§ï¼Œæ¢æ¥äº†ç©ºé—´çš„èŠ‚çœå’Œæ€§èƒ½ã€‚æœ‰æ ˆçš„åç¨‹ä½ å¯èƒ½èµ·å‡ åƒä¸ªå°±å ç”¨ä¸å°‘å†…å­˜ç©ºé—´ï¼Œè€Œæ— æ ˆçš„åç¨‹å¯ä»¥è½»è½»æ¾æ¾èµ·åˆ°äº¿çº§â€”â€”æ¯•ç«Ÿï¼Œç»´æŒåŸºæœ¬çŠ¶æ€çš„å¼€é”€æˆ‘å®æµ‹ä¸‹æ¥åªæœ‰ä¸€ç™¾å­—èŠ‚å·¦å³ã€‚</p><p>åè¿‡æ¥ï¼Œå¦‚æœæ— æ ˆçš„åç¨‹ä¸æ»¡è¶³éœ€è¦â€”â€”æ¯”å¦‚ï¼Œä½ çš„åç¨‹é‡Œéœ€è¦æœ‰é€’å½’è°ƒç”¨ï¼Œå¹¶åœ¨æ·±å±‚æŒ‚èµ·â€”â€”ä½ å°±ä¸å¾—ä¸å¯»æ‰¾ä¸€ä¸ªæœ‰æ ˆçš„åç¨‹çš„è§£å†³æ–¹æ¡ˆã€‚ç›®å‰å·²ç»æœ‰ä¸€äº›æˆç†Ÿçš„æ–¹æ¡ˆï¼Œæ¯”å¦‚ Boost.Coroutine2 <span class=\"orange\">[4]</span>ã€‚ä¸‹é¢çš„ä»£ç å±•ç¤ºå¦‚ä½•åœ¨ Boost.Coroutine2 é‡Œå®ç° <code>fibonacci</code>ï¼Œè®©ä½ æ„Ÿå—ä¸€ç‚¹ç‚¹å°åŒºåˆ«ï¼š</p><pre><code class=\"language-c++\">#include &lt;iostream&gt;\n#include &lt;stdint.h&gt;\n#include &lt;boost/coroutine2/all.hpp&gt;\n\ntypedef boost::coroutines2::\n  coroutine&lt;const uint64_t&gt;\n    coro_t;\n\nvoid fibonacci(\n  coro_t::push_type&amp; yield)\n{\n  uint64_t a = 0;\n  uint64_t b = 1;\n  while (true) {\n    yield(b);\n    auto tmp = a;\n    a = b;\n    b += tmp;\n  }\n}\n\nint main()\n{\n  for (auto i : coro_t::pull_type(\n         boost::coroutines2::\n           fixedsize_stack(),\n         fibonacci)) {\n    if (i &gt;= 10000) {\n      break;\n    }\n    std::cout &lt;&lt; i &lt;&lt; std::endl;\n  }\n}\n</code></pre><h2>ç¼–è¯‘å™¨æ”¯æŒ</h2><p>å‰é¢æåˆ°äº†ï¼ŒMSVC å’Œ Clang ç›®å‰æ”¯æŒåç¨‹ã€‚ä¸è¿‡ï¼Œå®ƒä»¬éƒ½éœ€è¦ç‰¹æ®Šçš„å‘½ä»¤è¡Œé€‰é¡¹æ¥å¼€å¯åç¨‹æ”¯æŒï¼š</p><ul>\n<li>MSVC éœ€è¦ <code>/await</code> å‘½ä»¤è¡Œé€‰é¡¹</li>\n<li>Clang éœ€è¦ <code>-fcoroutines-ts</code> å‘½ä»¤è¡Œé€‰é¡¹</li>\n</ul><p>ä¸ºäº†æ»¡è¶³ä½¿ç”¨ CMake çš„åŒå­¦çš„è¦æ±‚ï¼Œä¹Ÿä¸ºäº†æ–¹ä¾¿å¤§å®¶ç¼–è¯‘ï¼Œæˆ‘æŠŠç¤ºä¾‹ä»£ç æ”¾åˆ°äº† GitHub ä¸Šï¼š<a href=\"https://github.com/adah1972/geek_time_cpp\">https://github.com/adah1972/geek_time_cpp</a></p><h2>å†…å®¹å°ç»“</h2><p>æœ¬è®²è®¨è®ºäº† C++20 é‡Œçš„ç¬¬ä¸‰ä¸ªé‡è¦ç‰¹æ€§ï¼šåç¨‹ã€‚åç¨‹ä»ç„¶å¾ˆæ–°ï¼Œä½†å®ƒçš„é‡è¦æ€§æ˜¯æ¯‹åº¸ç½®ç–‘çš„â€”â€”å°¤å…¶åœ¨ç”Ÿæˆå™¨å’Œå¼‚æ­¥ I/O ä¸Šã€‚</p><h2>è¯¾åæ€è€ƒ</h2><p>è¯·ä»”ç»†æ¯”è¾ƒç¬¬ä¸€ä¸ª <code>fibonacci</code> çš„ C++ å®ç°å’Œæœ€åä½¿ç”¨ <code>generator</code> çš„ <code>fibonacci</code> çš„å®ç°ï¼Œä½“ä¼šåç¨‹ä»£ç å¦‚æœè‡ªè¡Œç”¨çŠ¶æ€æœºçš„æ–¹å¼æ¥å®ç°ï¼Œæ˜¯ä¸€ä»¶å¤šéº»çƒ¦çš„äº‹æƒ…ã€‚</p><p>å¦‚æœä½ å¯¹åç¨‹æœ‰å…´è¶£ï¼Œå¯ä»¥æŸ¥çœ‹å‚è€ƒèµ„æ–™ <span class=\"orange\">[5]</span>ï¼Œé‡Œé¢æä¾›äº†ä¸€äº›è¾ƒä¸ºæ·±å…¥çš„åŸç†ä»‹ç»ã€‚</p><h2><span class=\"reference\">å‚è€ƒèµ„æ–™ </span></h2><p><span class=\"reference\">[1] ç»´åŸºç™¾ç§‘, â€œåç¨‹â€. <a href=\"https://zh.wikipedia.org/zh-cn/%E5%8D%8F%E7%A8%8B\">https://zh.wikipedia.org/zh-cn/åç¨‹</a> </span></p><p><span class=\"reference\">[2] Gor Nishanov, â€œWorking draft, C++ extensions for coroutinesâ€. <a href=\"http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/n4775.pdf\">http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2018/n4775.pdf</a> </span></p><p><span class=\"reference\">[3] Lewis Baker, CppCoro. <a href=\"https://github.com/lewissbaker/cppcoro\">https://github.com/lewissbaker/cppcoro</a> </span></p><p><span class=\"reference\">[4] Oliver Kowalke, Boost.Coroutine2. <a href=\"https://www.boost.org/doc/libs/release/libs/coroutine2/doc/html/index.html\">https://www.boost.org/doc/libs/release/libs/coroutine2/doc/html/index.html</a> </span></p><p><span class=\"reference\">[5] Dawid Pilarski, â€œCoroutines introductionâ€. <a href=\"https://blog.panicsoftware.com/coroutines-introduction/\">https://blog.panicsoftware.com/coroutines-introduction/</a> </span></p>","neighbors":{"left":{"article_title":"29 | Rangesï¼šæ— è¿­ä»£å™¨çš„è¿­ä»£å’Œæ›´æ–¹ä¾¿çš„ç»„åˆ","id":195553},"right":{"article_title":"ç»“æŸè¯­ | ç»ˆç‚¹å·²è¾¾ï¼Œè¡Œç¨‹è¿˜è¦ç»§ç»­","id":198531}},"comments":[{"had_liked":false,"id":337612,"user_name":"å´å’ç‚œ","can_delete":false,"product_type":"c1","uid":1645639,"ip_address":"","ucode":"8C24C10AEC779F","user_header":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","comment_is_top":true,"comment_ctime":1646914064,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"å‚è€ƒèµ„æ–™ [3] çš„ cppcoro ç›®å‰çœ‹èµ·æ¥å·²ç»ä¸å†ç»´æŠ¤äº†ï¼Œè·Ÿæ–°ç‰ˆç¼–è¯‘å™¨çš„å…¼å®¹æ€§é—®é¢˜ä¸€ç›´æ— äººè§£å†³ã€‚ç›®å‰æ¯”è¾ƒå¥½çš„å¤åˆ»åœ¨ä¸‹é¢è¿™ä¸ªé“¾æ¥ï¼š\n\nhttps:&#47;&#47;github.com&#47;andreasbuhr&#47;cppcoro","like_count":2},{"had_liked":false,"id":230150,"user_name":"æ˜“è½»å°˜","can_delete":false,"product_type":"c1","uid":1136684,"ip_address":"","ucode":"0D0CB9D6D45A70","user_header":"https://static001.geekbang.org/account/avatar/00/11/58/2c/92c7ce3b.jpg","comment_is_top":false,"comment_ctime":1593281868,"is_pvip":false,"replies":[{"id":84988,"content":"ã€Œè®¡ç®—æœºçœ‹åˆ°çš„æ˜¯çº¿ç¨‹ï¼Œè°ƒåº¦çš„ä¹Ÿæ˜¯çº¿ç¨‹ã€‚ã€\n\næŠŠã€Œè®¡ç®—æœºã€æ”¹æˆã€Œæ“ä½œç³»ç»Ÿã€ï¼Œä½ çš„è¯„è®ºå°±æ²¡é—®é¢˜äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´å’ç‚œ","uid":1645639,"ctime":1593313267,"ip_address":"","comment_id":230150,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"ä¸ªäººå¯¹åç¨‹çš„ç†è§£ï¼Œå¯èƒ½ä¸å¤ªå‡†ç¡®ï¼š\nä¸å¯ä»¥æ··æ·†çº¿ç¨‹å’Œåç¨‹ä¸¤ä¸ªæ¦‚å¿µã€‚è®¡ç®—æœºçœ‹åˆ°çš„æ˜¯çº¿ç¨‹ï¼Œè°ƒåº¦çš„ä¹Ÿæ˜¯çº¿ç¨‹ã€‚ä¸€ä¸ªçº¿ç¨‹ä¸­å¯ä»¥æœ‰å¾ˆå¤šä¸ªåç¨‹ï¼Œè¿™äº›åç¨‹çš„æ‰§è¡Œé¡ºåºç”±ç¨‹åºå‘˜è‡ªå·±æ¥è°ƒåº¦ã€‚æ¯”è¾ƒæ˜æ˜¾çš„å¥½å¤„æ˜¯ï¼Œ1. åŒä¸€ä¸ªçº¿ç¨‹ä¸­çš„åç¨‹ä¸éœ€è¦è€ƒè™‘æ•°æ®çš„ç«äº‰é—®é¢˜ï¼Œå› ä¸ºè¿™äº›åç¨‹çš„æ‰§è¡Œé¡ºåºæ˜¯å›ºå®šçš„ï¼›2. åç¨‹èƒ½å¤Ÿå¾ˆæ–¹ä¾¿çš„ä¿å­˜æ‰§è¡ŒçŠ¶æ€ï¼Œä½¿å¤æ‚çŠ¶æ€æœºçš„å®ç°å˜å¾—ç®€å•ï¼›","like_count":7},{"had_liked":false,"id":292858,"user_name":"Fireplusplus","can_delete":false,"product_type":"c1","uid":1999021,"ip_address":"","ucode":"E19CBAECD7AA21","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqAEFC6klazFO4gurkagZqjPb4BCv1VbnqHiaA0WVX9uINI7Jd9BBh3rJN2ljRFqicZxLjpHodIicPUw/132","comment_is_top":false,"comment_ctime":1621039762,"is_pvip":false,"replies":[{"id":106055,"content":"æ— æ ˆåç¨‹åœ¨è¿›å…¥åç¨‹æ—¶ä»ä¼šä½¿ç”¨åŸå…ˆçš„æ ˆå¸§ï¼Œæ‰€æœ‰çš„æœ¬åœ°å˜é‡åˆ™å›ºå®šåˆ†é…åœ¨å †ä¸Šçš„ä¸€å—å†…å­˜é‡Œã€‚æœ‰æ ˆåç¨‹åœ¨æ‰§è¡Œæ—¶ä¼šå¯ç”¨ä¸€ä¸ªè‡ªå·±çš„ç‹¬ç«‹æ ˆå¸§ï¼Œåé¢æŒ‚èµ·å’Œæ¢å¤æ‰§è¡Œæ—¶ä¹Ÿéƒ½éœ€è¦åˆ‡æ¢æ ˆå¸§ï¼Œå› è€Œå¼€é”€æ¯”æ— æ ˆçš„è¦å¤§ã€‚\n\nå¯¹å…·ä½“ç»†èŠ‚æ„Ÿå…´è¶£çš„è¯ï¼Œç½‘ä¸Šè¿™ç¯‡æ–‡ç« è¯´å¾—è¿˜æ¯”è¾ƒç»†ï¼š\n\nhttps:&#47;&#47;mthli.xyz&#47;stackful-stackless&#47;","user_name":"ä½œè€…å›å¤","user_name_real":"å´å’ç‚œ","uid":1645639,"ctime":1621076582,"ip_address":"","comment_id":292858,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"æ— æ ˆåç¨‹çš„å†…å­˜å¸ƒå±€å¯ä»¥æ˜ç™½å‡½æ•°Dè°ƒç”¨ç»“æŸåï¼Œåº”è¯¥æ˜¯é€šè¿‡ç¼–è¯‘å™¨å¤„ç†åçš„æ–¹å¼è¿”å›åˆ°åç¨‹Cçš„å †ä¸Šç©ºé—´ï¼Œåç¨‹cæŒ‚èµ·ä¹‹åå †ä»ç„¶æ˜¯ä¿ç•™çš„ï¼Œä½†æ˜¯ä¸€ä¸ªæœ‰æ ˆåç¨‹çš„å†…å­˜å¸ƒå±€åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œåç¨‹æŒ‚èµ·ä¹‹åä¸æ˜¯è¦å‡ºæ ˆæ‰èƒ½å›åˆ°è°ƒç”¨è€…çš„æ ˆæ¡¢å—ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519985,"discussion_content":"æ— æ ˆåç¨‹åœ¨è¿›å…¥åç¨‹æ—¶ä»ä¼šä½¿ç”¨åŸå…ˆçš„æ ˆå¸§ï¼Œæ‰€æœ‰çš„æœ¬åœ°å˜é‡åˆ™å›ºå®šåˆ†é…åœ¨å †ä¸Šçš„ä¸€å—å†…å­˜é‡Œã€‚æœ‰æ ˆåç¨‹åœ¨æ‰§è¡Œæ—¶ä¼šå¯ç”¨ä¸€ä¸ªè‡ªå·±çš„ç‹¬ç«‹æ ˆå¸§ï¼Œåé¢æŒ‚èµ·å’Œæ¢å¤æ‰§è¡Œæ—¶ä¹Ÿéƒ½éœ€è¦åˆ‡æ¢æ ˆå¸§ï¼Œå› è€Œå¼€é”€æ¯”æ— æ ˆçš„è¦å¤§ã€‚\n\nå¯¹å…·ä½“ç»†èŠ‚æ„Ÿå…´è¶£çš„è¯ï¼Œç½‘ä¸Šè¿™ç¯‡æ–‡ç« è¯´å¾—è¿˜æ¯”è¾ƒç»†ï¼š\n\nhttps://mthli.xyz/stackful-stackless/","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1621076582,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":177879,"user_name":"è°¦è°¦å›å­","can_delete":false,"product_type":"c1","uid":1014684,"ip_address":"","ucode":"5A5B97B1CA7B73","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7b/9c/ffc2a5d9.jpg","comment_is_top":false,"comment_ctime":1581520284,"is_pvip":false,"replies":[{"id":69118,"content":"åœ¨æ ˆé‡Œæ˜¯ä¸€ä¸ªæ˜ç¡®çš„å‹æ ˆé¡ºåºçš„ï¼ˆx86æˆ–ç±»ä¼¼å¹³å°ä¸Šä¸ç®¡ä»€ä¹ˆç¼–è¯‘å™¨å®ç°éƒ½å·®ä¸å¤šï¼‰ã€‚è€Œåç¨‹çš„æ•°æ®æ”¾åœ¨å †é‡Œï¼Œå¹¶æ²¡æœ‰ç±»ä¼¼çš„é¡ºåºæƒ¯ä¾‹ï¼Œå®é™…å®ç°çš„é¡ºåºå¯èƒ½å®Œå…¨ä¸ä¸€æ ·ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´å’ç‚œ","uid":1645639,"ctime":1581609013,"ip_address":"","comment_id":177879,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"è€å¸ˆï¼Œ å›¾å·¦è¾¹â€œè°ƒç”¨Xçš„å‚æ•°â€åœ¨â€œè¿”å›Yçš„åœ°å€â€ä¸‹é¢ï¼Œ è€Œå³è¾¹â€œè°ƒç”¨Xçš„å‚æ•°â€åœ¨â€œè¿”å›Yçš„åœ°å€â€ä¸Šé¢ï¼Œ æ˜¯ç”»é”™äº†ä¹ˆï¼Œ è¿˜æ˜¯åæˆé‡Œé¢å°±æ˜¯è·Ÿæ ˆä¸Šå‡½æ•°è°ƒç”¨æ˜¯åçš„å‘¢ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483581,"discussion_content":"åœ¨æ ˆé‡Œæ˜¯ä¸€ä¸ªæ˜ç¡®çš„å‹æ ˆé¡ºåºçš„ï¼ˆx86æˆ–ç±»ä¼¼å¹³å°ä¸Šä¸ç®¡ä»€ä¹ˆç¼–è¯‘å™¨å®ç°éƒ½å·®ä¸å¤šï¼‰ã€‚è€Œåç¨‹çš„æ•°æ®æ”¾åœ¨å †é‡Œï¼Œå¹¶æ²¡æœ‰ç±»ä¼¼çš„é¡ºåºæƒ¯ä¾‹ï¼Œå®é™…å®ç°çš„é¡ºåºå¯èƒ½å®Œå…¨ä¸ä¸€æ ·ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1581609013,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383555,"user_name":"æäº‘é¾™","can_delete":false,"product_type":"c1","uid":3201926,"ip_address":"åŒ—äº¬","ucode":"785924B16BE788","user_header":"https://static001.geekbang.org/account/avatar/00/30/db/86/51ec4c41.jpg","comment_is_top":false,"comment_ctime":1699263559,"is_pvip":false,"replies":[{"id":140076,"content":"æœ‰co_çš„å…¶ä¸­ä¹‹ä¸€å°±æ˜¯åç¨‹äº†ã€‚åç¨‹çš„ç¬¬ä¸€æ¬¡â€œè¿”å›â€ä¸æ˜¯è¿”å›è¯­å¥ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1699941615,"ip_address":"å¹¿ä¸œ","comment_id":383555,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"è€å¸ˆä¸‹é¢çš„è¿™ä¸ªå‡½æ•°ä½“å†…æ²¡æœ‰å†™co_returnï¼Œä¸ºä»€ä¹ˆå‡½æ•°çš„è¿”å›å€¼å°±å¯ä»¥å†™uint64_resumable ? \nuint64_resumable fibonacci()\n{\n  uint64_t a = 0;\n  uint64_t b = 1;\n  while (true) {\n    co_yield b;\n    auto tmp = a;\n    a = b;\n    b += tmp;\n  }\n}","like_count":1,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483581,"discussion_content":"åœ¨æ ˆé‡Œæ˜¯ä¸€ä¸ªæ˜ç¡®çš„å‹æ ˆé¡ºåºçš„ï¼ˆx86æˆ–ç±»ä¼¼å¹³å°ä¸Šä¸ç®¡ä»€ä¹ˆç¼–è¯‘å™¨å®ç°éƒ½å·®ä¸å¤šï¼‰ã€‚è€Œåç¨‹çš„æ•°æ®æ”¾åœ¨å †é‡Œï¼Œå¹¶æ²¡æœ‰ç±»ä¼¼çš„é¡ºåºæƒ¯ä¾‹ï¼Œå®é™…å®ç°çš„é¡ºåºå¯èƒ½å®Œå…¨ä¸ä¸€æ ·ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1581609013,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":198538,"user_name":"englefly","can_delete":false,"product_type":"c1","uid":1145907,"ip_address":"","ucode":"E3FCF19E618718","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep2gRIticwS6CiatsCiaU4QRjAODKibQevrhSciatrmd90lNIZFxywE9yyZgAxKTmWiaBSH4zZUcRIV46qQ/132","comment_is_top":false,"comment_ctime":1585455798,"is_pvip":false,"replies":[{"id":74770,"content":"æœ€åŸºæœ¬åç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«å°±æ˜¯ï¼Œåç¨‹æ˜¯ç¨‹åºè‡ªå·±è°ƒåº¦çš„ï¼Œçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè°ƒåº¦çš„ã€‚æ“ä½œç³»ç»Ÿå¹²çš„äº‹æƒ…ï¼Œå¼€é”€è‡ªç„¶å¤§ä¸€äº›ã€‚åè¿‡æ¥ï¼Œåç¨‹çš„ä¼˜åŠ¿ï¼Œæ€§èƒ½å°±æ˜¯å¾ˆé‡è¦çš„ä¸€å—äº†ã€‚\n\nåç¨‹åœ¨å“ªä¸ªçº¿ç¨‹è¿è¡Œï¼Œæ˜¯ä½ çš„ä»£ç å†³å®šçš„ã€‚ä½ ä»å“ªä¸ªçº¿ç¨‹å»è°ƒç”¨åç¨‹æˆ–å» co_await&#47;co_yield äº†ï¼Œåç¨‹å°±åœ¨é‚£ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚åƒç”Ÿæˆå™¨é‚£æ ·çš„ç”¨æ³•ï¼Œå®Œå…¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿä¸é€‚åˆç”¨å¤šçº¿ç¨‹æ¥æ”¹é€ ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´å’ç‚œ","uid":1645639,"ctime":1585497005,"ip_address":"","comment_id":198538,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"å´è€å¸ˆï¼Œè¯·æ•™ä¸¤ä¸ªé—®é¢˜ï¼š\n1ã€‚coroutineçš„èƒ½åŠ›æ˜¯ä¸æ˜¯æ¯”çº¿ç¨‹å¼±ï¼Ÿæˆ‘ä»¬å¯ä»¥ç”¨çº¿ç¨‹çš„ mutex+condition-variable æˆ– primise+future æ¨¡æ‹Ÿcoroutineã€‚ä½†coroutineç©¶ç«Ÿå“ªäº›æ–¹é¢å¼±äºçº¿ç¨‹å‘¢ï¼Ÿ\n2ã€‚coroutineçš„åº•å±‚å®ç°ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Ÿå®ƒæœ‰cpuçš„ä¸Šä¸‹æ–‡åˆ‡æ¢å—ï¼Ÿè¿˜æ˜¯æ‰€æœ‰coroutineéƒ½è¿è¡Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œï¼Œcoroutineåªæ˜¯fibonacci c++å®ç°é‚£æ ·çš„ä¸€ç§ä»£ç ç»„ç»‡å½¢å¼ï¼Ÿ\nè°¢è°¢","like_count":1,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631763,"discussion_content":"æœ‰co_çš„å…¶ä¸­ä¹‹ä¸€å°±æ˜¯åç¨‹äº†ã€‚åç¨‹çš„ç¬¬ä¸€æ¬¡â€œè¿”å›â€ä¸æ˜¯è¿”å›è¯­å¥ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1699941615,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":180179,"user_name":"Gallen","can_delete":false,"product_type":"c1","uid":1821566,"ip_address":"","ucode":"CFB50D4E8170F0","user_header":"https://static001.geekbang.org/account/avatar/00/1b/cb/7e/dd9258dd.jpg","comment_is_top":false,"comment_ctime":1582205727,"is_pvip":false,"replies":[{"id":69990,"content":"æœ‰äº‹æƒ…å…ˆå‘æˆ‘é‚®ä»¶å¥½äº†ã€‚åº”è¯¥ä¸ä¼šæ‰¾ä¸åˆ°å§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´å’ç‚œ","uid":1645639,"ctime":1582245332,"ip_address":"","comment_id":180179,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"æ‚¨å¥½ï¼Œå´è€å¸ˆï¼Œä¹‹å‰åœ¨2018å¹´cppå¼€å‘è€…å¤§ä¼šä¸Šå¬è¿‡æ‚¨è®²string viewå’Œrangeï¼Œè¿˜å·§å¦™çš„ä½¿ç”¨|ç®¡é“ç¬¦è¿›è¡Œå‡½æ•°é—´å¯¹è±¡ä¼ é€’ï¼Œèƒ½å¦æœ‰å¹¸æ·»åŠ ä¸€ä¸‹æ‚¨çš„å¾®ä¿¡ï¼Ÿè°¢è°¢","like_count":1,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484554,"discussion_content":"æœ‰äº‹æƒ…å…ˆå‘æˆ‘é‚®ä»¶å¥½äº†ã€‚åº”è¯¥ä¸ä¼šæ‰¾ä¸åˆ°å§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582245332,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1821566,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/cb/7e/dd9258dd.jpg","nickname":"Gallen","note":"","ucode":"CFB50D4E8170F0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":179651,"discussion_content":"å¥½çš„è€å¸ˆï¼Œæ‰¾å¾—åˆ°çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582246532,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":177362,"user_name":"æ™šé£Â·å’Œç…¦","can_delete":false,"product_type":"c1","uid":1236047,"ip_address":"","ucode":"0B1DB8F437A4B2","user_header":"","comment_is_top":false,"comment_ctime":1581358814,"is_pvip":false,"replies":[{"id":68878,"content":"å…ˆè¯´æ˜¯ä¸æ˜¯ï¼Œç„¶åæ‰è°ˆå¾—ä¸Šä¸ºä»€ä¹ˆã€‚\n\nåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ²¡æœ‰å¿…è¦é‚£ä¹ˆåšã€‚æˆ‘ä»æ¥æ²¡åœ¨ä»£ç é‡Œå†™è¿‡ malloc_trimã€‚\n\nåœ¨æœ‰è™šæ‹Ÿå†…å­˜çš„ä¸–ç•Œé‡Œï¼Œæˆ‘çœ‹ä¸å‡ºè°ƒç”¨ malloc_trim çš„å¿…è¦æ€§ã€‚æ“ä½œç³»ç»Ÿè‡ªå·±èƒ½ç®¡å¥½ã€‚\n\nå¦‚æœåµŒå…¥å¼å¼€å‘ï¼Œæ²¡æœ‰è™šæ‹Ÿå†…å­˜ï¼Œä½ ç”¨ malloc_trim ä¹Ÿä¸è§å¾—æœ‰ç”¨ã€‚å› ä¸ºä¸€æ—¦å †çš„å°¾éƒ¨æœ‰åˆ†é…ï¼Œä½ å¹¶ä¸èƒ½é‡Šæ”¾å†…å­˜å›æ“ä½œç³»ç»Ÿã€‚\n\nè€Œä¸”ï¼Œä½ ä¸ºä»€ä¹ˆè¦è¿˜å†…å­˜ç»™æ“ä½œç³»ç»Ÿï¼Ÿä»¥åä½ ä¸ç”¨äº†å—ï¼Ÿæ˜¯ç¨‹åºè¦é€€å‡ºäº†å—ï¼Ÿå¦‚æœç¨‹åºè¦é€€å‡ºï¼Œæœ¬æ¥å ç”¨çš„èµ„æºå°±ä¼šè¢«é‡Šæ”¾æ‰ã€‚å¦‚æœç¨‹åºä¸é€€å‡ºï¼Œè¿›ç¨‹ç®¡å¥½è‡ªå·±çš„äº‹ï¼Œä¸‹æ¬¡åˆ†é…èƒ½ä¸éº»çƒ¦æ“ä½œç³»ç»Ÿå°±ä¸éº»çƒ¦æ“ä½œç³»ç»Ÿï¼Œåº”è¯¥åè€Œæ›´å¥½ã€‚\n\næˆ‘çš„ä¸ªäººè§è§£ï¼Œè°å‘Šè¯‰ä½ è¿™å¥è¯çš„ï¼ŒåŸºæœ¬ä¸Šå¹¶ä¸çœŸæ‡‚åº”ç”¨å¼€å‘ï¼Œåªæ˜¯å­¦äº†ç‚¹ Linux çš„çŸ¥è¯†ï¼Œåœ¨çå–å¼„è€Œå·²ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´å’ç‚œ","uid":1645639,"ctime":1581399512,"ip_address":"","comment_id":177362,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"è€å¸ˆï¼Œmap&lt;int, int&gt;().swap(map1);\nè¿™ä¸ªè¯­å¥ä¸ºä»€ä¹ˆä¸èƒ½è¾¾åˆ°çœŸæ­£é‡Šæ”¾map1å†…å­˜çš„æ•ˆæœå‘¢ï¼Ÿå¿…é¡»å¾—ç”¨malloc_trim","like_count":1,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483400,"discussion_content":"å…ˆè¯´æ˜¯ä¸æ˜¯ï¼Œç„¶åæ‰è°ˆå¾—ä¸Šä¸ºä»€ä¹ˆã€‚\n\nåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ²¡æœ‰å¿…è¦é‚£ä¹ˆåšã€‚æˆ‘ä»æ¥æ²¡åœ¨ä»£ç é‡Œå†™è¿‡ malloc_trimã€‚\n\nåœ¨æœ‰è™šæ‹Ÿå†…å­˜çš„ä¸–ç•Œé‡Œï¼Œæˆ‘çœ‹ä¸å‡ºè°ƒç”¨ malloc_trim çš„å¿…è¦æ€§ã€‚æ“ä½œç³»ç»Ÿè‡ªå·±èƒ½ç®¡å¥½ã€‚\n\nå¦‚æœåµŒå…¥å¼å¼€å‘ï¼Œæ²¡æœ‰è™šæ‹Ÿå†…å­˜ï¼Œä½ ç”¨ malloc_trim ä¹Ÿä¸è§å¾—æœ‰ç”¨ã€‚å› ä¸ºä¸€æ—¦å †çš„å°¾éƒ¨æœ‰åˆ†é…ï¼Œä½ å¹¶ä¸èƒ½é‡Šæ”¾å†…å­˜å›æ“ä½œç³»ç»Ÿã€‚\n\nè€Œä¸”ï¼Œä½ ä¸ºä»€ä¹ˆè¦è¿˜å†…å­˜ç»™æ“ä½œç³»ç»Ÿï¼Ÿä»¥åä½ ä¸ç”¨äº†å—ï¼Ÿæ˜¯ç¨‹åºè¦é€€å‡ºäº†å—ï¼Ÿå¦‚æœç¨‹åºè¦é€€å‡ºï¼Œæœ¬æ¥å ç”¨çš„èµ„æºå°±ä¼šè¢«é‡Šæ”¾æ‰ã€‚å¦‚æœç¨‹åºä¸é€€å‡ºï¼Œè¿›ç¨‹ç®¡å¥½è‡ªå·±çš„äº‹ï¼Œä¸‹æ¬¡åˆ†é…èƒ½ä¸éº»çƒ¦æ“ä½œç³»ç»Ÿå°±ä¸éº»çƒ¦æ“ä½œç³»ç»Ÿï¼Œåº”è¯¥åè€Œæ›´å¥½ã€‚\n\næˆ‘çš„ä¸ªäººè§è§£ï¼Œè°å‘Šè¯‰ä½ è¿™å¥è¯çš„ï¼ŒåŸºæœ¬ä¸Šå¹¶ä¸çœŸæ‡‚åº”ç”¨å¼€å‘ï¼Œåªæ˜¯å­¦äº†ç‚¹ Linux çš„çŸ¥è¯†ï¼Œåœ¨çå–å¼„è€Œå·²ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581399512,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":177127,"user_name":"Vackine","can_delete":false,"product_type":"c1","uid":1139588,"ip_address":"","ucode":"8E412EE82D3B59","user_header":"https://static001.geekbang.org/account/avatar/00/11/63/84/f45c4af9.jpg","comment_is_top":false,"comment_ctime":1581298887,"is_pvip":false,"replies":[{"id":68828,"content":"ç¼–ç¨‹é­”æ³•å’Œæ€§èƒ½æå‡æœ‰çŸ›ç›¾ä¹ˆï¼ŸğŸ¤ª\n\nä¸¥è‚ƒç‚¹ï¼Œåç¨‹ä¸æ˜¯ä¸ºäº†æé«˜ä»£ç æ€§èƒ½ï¼Œè€Œæ˜¯ä¸ºäº†æé«˜ç¨‹åºå‘˜çš„ç”Ÿäº§ç‡ã€‚ä»è¿™ç‚¹ä¸Šæ¥è¯´ï¼Œåç¨‹ä»ç„¶æ˜¯ä¸€ç§ç¼–è¯‘å™¨çš„é»‘é­”æ³•ã€‚\n\nè·Ÿæ‰‹å†™æ¯”èµ·æ¥ï¼Œæ²¡æœ‰æ€§èƒ½çš„æå‡ã€‚å°±å¦‚åŒé™¤äº†æå°‘æ•°çš„æƒ…å†µï¼ˆæ¯”å¦‚æ³›å‹å…è®¸å†…è”å¯¼è‡´C++çš„æ’åºæ¯”Cçš„qsortå¿«ï¼‰ï¼ŒC++ä»£ç ä¸ä¼šæ¯”Cä»£ç æ€§èƒ½æ›´é«˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´å’ç‚œ","uid":1645639,"ctime":1581335925,"ip_address":"","comment_id":177127,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"æ„Ÿè§‰è·Ÿpythoné‡Œé¢çš„asyncçš„æ–°çš„æ ‡å‡†åº“å¥½åƒï¼Œæ˜¯çœŸçš„æœ‰æ€§èƒ½ä¸Šçš„æå‡ä¹ˆï¼Œè¿˜æ˜¯åªæ˜¯ç¼–ç¨‹é­”æ³•ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483314,"discussion_content":"ç¼–ç¨‹é­”æ³•å’Œæ€§èƒ½æå‡æœ‰çŸ›ç›¾ä¹ˆï¼ŸğŸ¤ª\n\nä¸¥è‚ƒç‚¹ï¼Œåç¨‹ä¸æ˜¯ä¸ºäº†æé«˜ä»£ç æ€§èƒ½ï¼Œè€Œæ˜¯ä¸ºäº†æé«˜ç¨‹åºå‘˜çš„ç”Ÿäº§ç‡ã€‚ä»è¿™ç‚¹ä¸Šæ¥è¯´ï¼Œåç¨‹ä»ç„¶æ˜¯ä¸€ç§ç¼–è¯‘å™¨çš„é»‘é­”æ³•ã€‚\n\nè·Ÿæ‰‹å†™æ¯”èµ·æ¥ï¼Œæ²¡æœ‰æ€§èƒ½çš„æå‡ã€‚å°±å¦‚åŒé™¤äº†æå°‘æ•°çš„æƒ…å†µï¼ˆæ¯”å¦‚æ³›å‹å…è®¸å†…è”å¯¼è‡´C++çš„æ’åºæ¯”Cçš„qsortå¿«ï¼‰ï¼ŒC++ä»£ç ä¸ä¼šæ¯”Cä»£ç æ€§èƒ½æ›´é«˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581335925,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":369208,"user_name":"å¾","can_delete":false,"product_type":"c1","uid":1045869,"ip_address":"å¹¿ä¸œ","ucode":"4EE8B126738A29","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f5/6d/fa3ab44d.jpg","comment_is_top":false,"comment_ctime":1677222986,"is_pvip":false,"replies":[{"id":134573,"content":"ç°åœ¨è‘—åçš„å¼‚æ­¥æ¡†æ¶ Asio ä¹Ÿæ”¯æŒåç¨‹äº†ã€‚é˜¿é‡Œä¹Ÿæœ‰ä¸ªåç¨‹åº“ PhotonLibã€‚å°è€Œç¾çš„å¯ä»¥ç ”ç©¶ä¸€ä¸‹ netcan&#47;asyncioã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1677414295,"ip_address":"æ±Ÿè‹","comment_id":369208,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"å¾ˆæ—©äº†è§£è¿‡åç¨‹çš„æ¦‚å¿µï¼Œè¯´æ˜¯ç”¨æˆ·çº§çº¿ç¨‹ï¼Œåœ¨ç”¨æˆ·æ€è°ƒåº¦ï¼Œé¿å…çº¿ç¨‹çš„å†…æ ¸æ€åˆ‡æ¢ï¼Œæ€§èƒ½æ›´é«˜ï¼›\nåæ¥åœ¨ä¸€ä¸ª C++ æœåŠ¡æ¡†æ¶ä¸Šä¹Ÿä½¿ç”¨è¿‡ï¼Œå†åæ¥åˆ‡åˆ° Goï¼Œç”¨èµ·äº† goroutineï¼›\nç®€å•æ¥è¯´ï¼Œåç¨‹ç”¨èµ·æ¥æ˜¯çœŸçˆ½ï¼Œé¿å…äº†æ¶å¿ƒçš„å¼‚æ­¥ IO çš„ callback å†™æ³•ï¼Œè‡ªæˆ‘æ„Ÿè§‰ä¹Ÿç®—æ˜¯ç†è§£å¹¶ç†Ÿç»ƒä½¿ç”¨åç¨‹äº†ã€‚\n\nç›´åˆ°çœ‹äº† C++ 20 çš„åç¨‹ï¼Œå®Œäº†æƒŠæ‰ä¸‹å·´ç©è„‘è¢‹é—®å·ï¼Œè¿™ä»€ä¹ˆç©æ„å„¿ï¼Œè¿™æ˜¯åç¨‹å—ï¼Ÿ\næŸ¥å„ç§èµ„æ–™å’Œä¹¦ï¼Œéƒ½è·Ÿä»¥å‰ç†è§£çš„ä¸ä¸€æ ·ï¼Œç‰¹åˆ«æ˜¯çœ‹åˆ°æœ‰äººæ‰€è°“çš„ç”¨å‡ è¡Œä»£ç å®ç°åç¨‹ï¼Œé‚£æ›´æ˜¯ä¸çŸ¥æ‰€ä»¥ã€‚\n\næœ€åç»ˆäºåœ¨è¿™é‡Œè§£å¼€äº†æˆ‘çš„ç–‘æƒ‘ï¼ŒåŸæ¥ä»¥å‰ç†è§£å’Œä½¿ç”¨çš„åç¨‹ï¼Œå’Œ C++ 20 é‡Œçš„åç¨‹ï¼Œä¸€ä¸ªæ˜¯æœ‰æ ˆåç¨‹ï¼Œä¸€ä¸ªæ˜¯æ— æ ˆåç¨‹ï¼Œæœ‰å·¨å¤§å·®å¼‚ï¼Œä¸ºå•¥åœ¨é‚£äº›è®²ç°ä»£ C++ çš„ä¹¦é‡Œï¼Œéƒ½ä¸æè¿™ä¸ªç‚¹ï¼Œè¿™ä¸ªå¾ˆå…³é”®å‘ï¼ŒçœŸæ˜¯å›°æ‰°æˆ‘å¾ˆä¹…ã€‚","like_count":0,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":606801,"discussion_content":"ç°åœ¨è‘—åçš„å¼‚æ­¥æ¡†æ¶ Asio ä¹Ÿæ”¯æŒåç¨‹äº†ã€‚é˜¿é‡Œä¹Ÿæœ‰ä¸ªåç¨‹åº“ PhotonLibã€‚å°è€Œç¾çš„å¯ä»¥ç ”ç©¶ä¸€ä¸‹ netcan/asyncioã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1677414295,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"æ±Ÿè‹","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337612,"user_name":"å´å’ç‚œ","can_delete":false,"product_type":"c1","uid":1645639,"ip_address":"","ucode":"8C24C10AEC779F","user_header":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","comment_is_top":true,"comment_ctime":1646914064,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"å‚è€ƒèµ„æ–™ [3] çš„ cppcoro ç›®å‰çœ‹èµ·æ¥å·²ç»ä¸å†ç»´æŠ¤äº†ï¼Œè·Ÿæ–°ç‰ˆç¼–è¯‘å™¨çš„å…¼å®¹æ€§é—®é¢˜ä¸€ç›´æ— äººè§£å†³ã€‚ç›®å‰æ¯”è¾ƒå¥½çš„å¤åˆ»åœ¨ä¸‹é¢è¿™ä¸ªé“¾æ¥ï¼š\n\nhttps:&#47;&#47;github.com&#47;andreasbuhr&#47;cppcoro","like_count":2},{"had_liked":false,"id":230150,"user_name":"æ˜“è½»å°˜","can_delete":false,"product_type":"c1","uid":1136684,"ip_address":"","ucode":"0D0CB9D6D45A70","user_header":"https://static001.geekbang.org/account/avatar/00/11/58/2c/92c7ce3b.jpg","comment_is_top":false,"comment_ctime":1593281868,"is_pvip":false,"replies":[{"id":84988,"content":"ã€Œè®¡ç®—æœºçœ‹åˆ°çš„æ˜¯çº¿ç¨‹ï¼Œè°ƒåº¦çš„ä¹Ÿæ˜¯çº¿ç¨‹ã€‚ã€\n\næŠŠã€Œè®¡ç®—æœºã€æ”¹æˆã€Œæ“ä½œç³»ç»Ÿã€ï¼Œä½ çš„è¯„è®ºå°±æ²¡é—®é¢˜äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´å’ç‚œ","uid":1645639,"ctime":1593313267,"ip_address":"","comment_id":230150,"utype":1}],"discussion_count":3,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"ä¸ªäººå¯¹åç¨‹çš„ç†è§£ï¼Œå¯èƒ½ä¸å¤ªå‡†ç¡®ï¼š\nä¸å¯ä»¥æ··æ·†çº¿ç¨‹å’Œåç¨‹ä¸¤ä¸ªæ¦‚å¿µã€‚è®¡ç®—æœºçœ‹åˆ°çš„æ˜¯çº¿ç¨‹ï¼Œè°ƒåº¦çš„ä¹Ÿæ˜¯çº¿ç¨‹ã€‚ä¸€ä¸ªçº¿ç¨‹ä¸­å¯ä»¥æœ‰å¾ˆå¤šä¸ªåç¨‹ï¼Œè¿™äº›åç¨‹çš„æ‰§è¡Œé¡ºåºç”±ç¨‹åºå‘˜è‡ªå·±æ¥è°ƒåº¦ã€‚æ¯”è¾ƒæ˜æ˜¾çš„å¥½å¤„æ˜¯ï¼Œ1. åŒä¸€ä¸ªçº¿ç¨‹ä¸­çš„åç¨‹ä¸éœ€è¦è€ƒè™‘æ•°æ®çš„ç«äº‰é—®é¢˜ï¼Œå› ä¸ºè¿™äº›åç¨‹çš„æ‰§è¡Œé¡ºåºæ˜¯å›ºå®šçš„ï¼›2. åç¨‹èƒ½å¤Ÿå¾ˆæ–¹ä¾¿çš„ä¿å­˜æ‰§è¡ŒçŠ¶æ€ï¼Œä½¿å¤æ‚çŠ¶æ€æœºçš„å®ç°å˜å¾—ç®€å•ï¼›","like_count":7,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499784,"discussion_content":"ã€Œè®¡ç®—æœºçœ‹åˆ°çš„æ˜¯çº¿ç¨‹ï¼Œè°ƒåº¦çš„ä¹Ÿæ˜¯çº¿ç¨‹ã€‚ã€\n\næŠŠã€Œè®¡ç®—æœºã€æ”¹æˆã€Œæ“ä½œç³»ç»Ÿã€ï¼Œä½ çš„è¯„è®ºå°±æ²¡é—®é¢˜äº†ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1593313267,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1172429,"avatar":"https://static001.geekbang.org/account/avatar/00/11/e3/cd/82829bf9.jpg","nickname":"Gerry","note":"","ucode":"C3A8BC33F2A25A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":611337,"discussion_content":"ä¸¥è°¨ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680049666,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1136684,"avatar":"https://static001.geekbang.org/account/avatar/00/11/58/2c/92c7ce3b.jpg","nickname":"æ˜“è½»å°˜","note":"","ucode":"0D0CB9D6D45A70","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":286894,"discussion_content":"è°¢è°¢è€å¸ˆæŒ‡å‡ºï¼Œç²—å¿ƒå¤§æ„äº†ğŸ™ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593320991,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":292858,"user_name":"Fireplusplus","can_delete":false,"product_type":"c1","uid":1999021,"ip_address":"","ucode":"E19CBAECD7AA21","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqAEFC6klazFO4gurkagZqjPb4BCv1VbnqHiaA0WVX9uINI7Jd9BBh3rJN2ljRFqicZxLjpHodIicPUw/132","comment_is_top":false,"comment_ctime":1621039762,"is_pvip":false,"replies":[{"id":106055,"content":"æ— æ ˆåç¨‹åœ¨è¿›å…¥åç¨‹æ—¶ä»ä¼šä½¿ç”¨åŸå…ˆçš„æ ˆå¸§ï¼Œæ‰€æœ‰çš„æœ¬åœ°å˜é‡åˆ™å›ºå®šåˆ†é…åœ¨å †ä¸Šçš„ä¸€å—å†…å­˜é‡Œã€‚æœ‰æ ˆåç¨‹åœ¨æ‰§è¡Œæ—¶ä¼šå¯ç”¨ä¸€ä¸ªè‡ªå·±çš„ç‹¬ç«‹æ ˆå¸§ï¼Œåé¢æŒ‚èµ·å’Œæ¢å¤æ‰§è¡Œæ—¶ä¹Ÿéƒ½éœ€è¦åˆ‡æ¢æ ˆå¸§ï¼Œå› è€Œå¼€é”€æ¯”æ— æ ˆçš„è¦å¤§ã€‚\n\nå¯¹å…·ä½“ç»†èŠ‚æ„Ÿå…´è¶£çš„è¯ï¼Œç½‘ä¸Šè¿™ç¯‡æ–‡ç« è¯´å¾—è¿˜æ¯”è¾ƒç»†ï¼š\n\nhttps:&#47;&#47;mthli.xyz&#47;stackful-stackless&#47;","user_name":"ä½œè€…å›å¤","user_name_real":"å´å’ç‚œ","uid":1645639,"ctime":1621076582,"ip_address":"","comment_id":292858,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"æ— æ ˆåç¨‹çš„å†…å­˜å¸ƒå±€å¯ä»¥æ˜ç™½å‡½æ•°Dè°ƒç”¨ç»“æŸåï¼Œåº”è¯¥æ˜¯é€šè¿‡ç¼–è¯‘å™¨å¤„ç†åçš„æ–¹å¼è¿”å›åˆ°åç¨‹Cçš„å †ä¸Šç©ºé—´ï¼Œåç¨‹cæŒ‚èµ·ä¹‹åå †ä»ç„¶æ˜¯ä¿ç•™çš„ï¼Œä½†æ˜¯ä¸€ä¸ªæœ‰æ ˆåç¨‹çš„å†…å­˜å¸ƒå±€åº”è¯¥æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Œåç¨‹æŒ‚èµ·ä¹‹åä¸æ˜¯è¦å‡ºæ ˆæ‰èƒ½å›åˆ°è°ƒç”¨è€…çš„æ ˆæ¡¢å—ï¼Ÿ","like_count":4,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":499784,"discussion_content":"ã€Œè®¡ç®—æœºçœ‹åˆ°çš„æ˜¯çº¿ç¨‹ï¼Œè°ƒåº¦çš„ä¹Ÿæ˜¯çº¿ç¨‹ã€‚ã€\n\næŠŠã€Œè®¡ç®—æœºã€æ”¹æˆã€Œæ“ä½œç³»ç»Ÿã€ï¼Œä½ çš„è¯„è®ºå°±æ²¡é—®é¢˜äº†ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1593313267,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1172429,"avatar":"https://static001.geekbang.org/account/avatar/00/11/e3/cd/82829bf9.jpg","nickname":"Gerry","note":"","ucode":"C3A8BC33F2A25A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":611337,"discussion_content":"ä¸¥è°¨ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1680049666,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1136684,"avatar":"https://static001.geekbang.org/account/avatar/00/11/58/2c/92c7ce3b.jpg","nickname":"æ˜“è½»å°˜","note":"","ucode":"0D0CB9D6D45A70","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":286894,"discussion_content":"è°¢è°¢è€å¸ˆæŒ‡å‡ºï¼Œç²—å¿ƒå¤§æ„äº†ğŸ™ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1593320991,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":177879,"user_name":"è°¦è°¦å›å­","can_delete":false,"product_type":"c1","uid":1014684,"ip_address":"","ucode":"5A5B97B1CA7B73","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7b/9c/ffc2a5d9.jpg","comment_is_top":false,"comment_ctime":1581520284,"is_pvip":false,"replies":[{"id":69118,"content":"åœ¨æ ˆé‡Œæ˜¯ä¸€ä¸ªæ˜ç¡®çš„å‹æ ˆé¡ºåºçš„ï¼ˆx86æˆ–ç±»ä¼¼å¹³å°ä¸Šä¸ç®¡ä»€ä¹ˆç¼–è¯‘å™¨å®ç°éƒ½å·®ä¸å¤šï¼‰ã€‚è€Œåç¨‹çš„æ•°æ®æ”¾åœ¨å †é‡Œï¼Œå¹¶æ²¡æœ‰ç±»ä¼¼çš„é¡ºåºæƒ¯ä¾‹ï¼Œå®é™…å®ç°çš„é¡ºåºå¯èƒ½å®Œå…¨ä¸ä¸€æ ·ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´å’ç‚œ","uid":1645639,"ctime":1581609013,"ip_address":"","comment_id":177879,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"è€å¸ˆï¼Œ å›¾å·¦è¾¹â€œè°ƒç”¨Xçš„å‚æ•°â€åœ¨â€œè¿”å›Yçš„åœ°å€â€ä¸‹é¢ï¼Œ è€Œå³è¾¹â€œè°ƒç”¨Xçš„å‚æ•°â€åœ¨â€œè¿”å›Yçš„åœ°å€â€ä¸Šé¢ï¼Œ æ˜¯ç”»é”™äº†ä¹ˆï¼Œ è¿˜æ˜¯åæˆé‡Œé¢å°±æ˜¯è·Ÿæ ˆä¸Šå‡½æ•°è°ƒç”¨æ˜¯åçš„å‘¢ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":519985,"discussion_content":"æ— æ ˆåç¨‹åœ¨è¿›å…¥åç¨‹æ—¶ä»ä¼šä½¿ç”¨åŸå…ˆçš„æ ˆå¸§ï¼Œæ‰€æœ‰çš„æœ¬åœ°å˜é‡åˆ™å›ºå®šåˆ†é…åœ¨å †ä¸Šçš„ä¸€å—å†…å­˜é‡Œã€‚æœ‰æ ˆåç¨‹åœ¨æ‰§è¡Œæ—¶ä¼šå¯ç”¨ä¸€ä¸ªè‡ªå·±çš„ç‹¬ç«‹æ ˆå¸§ï¼Œåé¢æŒ‚èµ·å’Œæ¢å¤æ‰§è¡Œæ—¶ä¹Ÿéƒ½éœ€è¦åˆ‡æ¢æ ˆå¸§ï¼Œå› è€Œå¼€é”€æ¯”æ— æ ˆçš„è¦å¤§ã€‚\n\nå¯¹å…·ä½“ç»†èŠ‚æ„Ÿå…´è¶£çš„è¯ï¼Œç½‘ä¸Šè¿™ç¯‡æ–‡ç« è¯´å¾—è¿˜æ¯”è¾ƒç»†ï¼š\n\nhttps://mthli.xyz/stackful-stackless/","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1621076582,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":383555,"user_name":"æäº‘é¾™","can_delete":false,"product_type":"c1","uid":3201926,"ip_address":"åŒ—äº¬","ucode":"785924B16BE788","user_header":"https://static001.geekbang.org/account/avatar/00/30/db/86/51ec4c41.jpg","comment_is_top":false,"comment_ctime":1699263559,"is_pvip":false,"replies":[{"id":140076,"content":"æœ‰co_çš„å…¶ä¸­ä¹‹ä¸€å°±æ˜¯åç¨‹äº†ã€‚åç¨‹çš„ç¬¬ä¸€æ¬¡â€œè¿”å›â€ä¸æ˜¯è¿”å›è¯­å¥ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1699941615,"ip_address":"å¹¿ä¸œ","comment_id":383555,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"è€å¸ˆä¸‹é¢çš„è¿™ä¸ªå‡½æ•°ä½“å†…æ²¡æœ‰å†™co_returnï¼Œä¸ºä»€ä¹ˆå‡½æ•°çš„è¿”å›å€¼å°±å¯ä»¥å†™uint64_resumable ? \nuint64_resumable fibonacci()\n{\n  uint64_t a = 0;\n  uint64_t b = 1;\n  while (true) {\n    co_yield b;\n    auto tmp = a;\n    a = b;\n    b += tmp;\n  }\n}","like_count":1,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":631763,"discussion_content":"æœ‰co_çš„å…¶ä¸­ä¹‹ä¸€å°±æ˜¯åç¨‹äº†ã€‚åç¨‹çš„ç¬¬ä¸€æ¬¡â€œè¿”å›â€ä¸æ˜¯è¿”å›è¯­å¥ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1699941615,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"å¹¿ä¸œ","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":198538,"user_name":"englefly","can_delete":false,"product_type":"c1","uid":1145907,"ip_address":"","ucode":"E3FCF19E618718","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83ep2gRIticwS6CiatsCiaU4QRjAODKibQevrhSciatrmd90lNIZFxywE9yyZgAxKTmWiaBSH4zZUcRIV46qQ/132","comment_is_top":false,"comment_ctime":1585455798,"is_pvip":false,"replies":[{"id":74770,"content":"æœ€åŸºæœ¬åç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«å°±æ˜¯ï¼Œåç¨‹æ˜¯ç¨‹åºè‡ªå·±è°ƒåº¦çš„ï¼Œçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè°ƒåº¦çš„ã€‚æ“ä½œç³»ç»Ÿå¹²çš„äº‹æƒ…ï¼Œå¼€é”€è‡ªç„¶å¤§ä¸€äº›ã€‚åè¿‡æ¥ï¼Œåç¨‹çš„ä¼˜åŠ¿ï¼Œæ€§èƒ½å°±æ˜¯å¾ˆé‡è¦çš„ä¸€å—äº†ã€‚\n\nåç¨‹åœ¨å“ªä¸ªçº¿ç¨‹è¿è¡Œï¼Œæ˜¯ä½ çš„ä»£ç å†³å®šçš„ã€‚ä½ ä»å“ªä¸ªçº¿ç¨‹å»è°ƒç”¨åç¨‹æˆ–å» co_await&#47;co_yield äº†ï¼Œåç¨‹å°±åœ¨é‚£ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚åƒç”Ÿæˆå™¨é‚£æ ·çš„ç”¨æ³•ï¼Œå®Œå…¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿä¸é€‚åˆç”¨å¤šçº¿ç¨‹æ¥æ”¹é€ ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´å’ç‚œ","uid":1645639,"ctime":1585497005,"ip_address":"","comment_id":198538,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"å´è€å¸ˆï¼Œè¯·æ•™ä¸¤ä¸ªé—®é¢˜ï¼š\n1ã€‚coroutineçš„èƒ½åŠ›æ˜¯ä¸æ˜¯æ¯”çº¿ç¨‹å¼±ï¼Ÿæˆ‘ä»¬å¯ä»¥ç”¨çº¿ç¨‹çš„ mutex+condition-variable æˆ– primise+future æ¨¡æ‹Ÿcoroutineã€‚ä½†coroutineç©¶ç«Ÿå“ªäº›æ–¹é¢å¼±äºçº¿ç¨‹å‘¢ï¼Ÿ\n2ã€‚coroutineçš„åº•å±‚å®ç°ç©¶ç«Ÿæ˜¯ä»€ä¹ˆï¼Ÿå®ƒæœ‰cpuçš„ä¸Šä¸‹æ–‡åˆ‡æ¢å—ï¼Ÿè¿˜æ˜¯æ‰€æœ‰coroutineéƒ½è¿è¡Œåœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œï¼Œcoroutineåªæ˜¯fibonacci c++å®ç°é‚£æ ·çš„ä¸€ç§ä»£ç ç»„ç»‡å½¢å¼ï¼Ÿ\nè°¢è°¢","like_count":1,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489721,"discussion_content":"æœ€åŸºæœ¬åç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«å°±æ˜¯ï¼Œåç¨‹æ˜¯ç¨‹åºè‡ªå·±è°ƒåº¦çš„ï¼Œçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè°ƒåº¦çš„ã€‚æ“ä½œç³»ç»Ÿå¹²çš„äº‹æƒ…ï¼Œå¼€é”€è‡ªç„¶å¤§ä¸€äº›ã€‚åè¿‡æ¥ï¼Œåç¨‹çš„ä¼˜åŠ¿ï¼Œæ€§èƒ½å°±æ˜¯å¾ˆé‡è¦çš„ä¸€å—äº†ã€‚\n\nåç¨‹åœ¨å“ªä¸ªçº¿ç¨‹è¿è¡Œï¼Œæ˜¯ä½ çš„ä»£ç å†³å®šçš„ã€‚ä½ ä»å“ªä¸ªçº¿ç¨‹å»è°ƒç”¨åç¨‹æˆ–å» co_await/co_yield äº†ï¼Œåç¨‹å°±åœ¨é‚£ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚åƒç”Ÿæˆå™¨é‚£æ ·çš„ç”¨æ³•ï¼Œå®Œå…¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿä¸é€‚åˆç”¨å¤šçº¿ç¨‹æ¥æ”¹é€ ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585497005,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":180179,"user_name":"Gallen","can_delete":false,"product_type":"c1","uid":1821566,"ip_address":"","ucode":"CFB50D4E8170F0","user_header":"https://static001.geekbang.org/account/avatar/00/1b/cb/7e/dd9258dd.jpg","comment_is_top":false,"comment_ctime":1582205727,"is_pvip":false,"replies":[{"id":69990,"content":"æœ‰äº‹æƒ…å…ˆå‘æˆ‘é‚®ä»¶å¥½äº†ã€‚åº”è¯¥ä¸ä¼šæ‰¾ä¸åˆ°å§ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´å’ç‚œ","uid":1645639,"ctime":1582245332,"ip_address":"","comment_id":180179,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"æ‚¨å¥½ï¼Œå´è€å¸ˆï¼Œä¹‹å‰åœ¨2018å¹´cppå¼€å‘è€…å¤§ä¼šä¸Šå¬è¿‡æ‚¨è®²string viewå’Œrangeï¼Œè¿˜å·§å¦™çš„ä½¿ç”¨|ç®¡é“ç¬¦è¿›è¡Œå‡½æ•°é—´å¯¹è±¡ä¼ é€’ï¼Œèƒ½å¦æœ‰å¹¸æ·»åŠ ä¸€ä¸‹æ‚¨çš„å¾®ä¿¡ï¼Ÿè°¢è°¢","like_count":1,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":489721,"discussion_content":"æœ€åŸºæœ¬åç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ«å°±æ˜¯ï¼Œåç¨‹æ˜¯ç¨‹åºè‡ªå·±è°ƒåº¦çš„ï¼Œçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè°ƒåº¦çš„ã€‚æ“ä½œç³»ç»Ÿå¹²çš„äº‹æƒ…ï¼Œå¼€é”€è‡ªç„¶å¤§ä¸€äº›ã€‚åè¿‡æ¥ï¼Œåç¨‹çš„ä¼˜åŠ¿ï¼Œæ€§èƒ½å°±æ˜¯å¾ˆé‡è¦çš„ä¸€å—äº†ã€‚\n\nåç¨‹åœ¨å“ªä¸ªçº¿ç¨‹è¿è¡Œï¼Œæ˜¯ä½ çš„ä»£ç å†³å®šçš„ã€‚ä½ ä»å“ªä¸ªçº¿ç¨‹å»è°ƒç”¨åç¨‹æˆ–å» co_await/co_yield äº†ï¼Œåç¨‹å°±åœ¨é‚£ä¸ªçº¿ç¨‹æ‰§è¡Œã€‚åƒç”Ÿæˆå™¨é‚£æ ·çš„ç”¨æ³•ï¼Œå®Œå…¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œä¹Ÿä¸é€‚åˆç”¨å¤šçº¿ç¨‹æ¥æ”¹é€ ã€‚","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1585497005,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":177362,"user_name":"æ™šé£Â·å’Œç…¦","can_delete":false,"product_type":"c1","uid":1236047,"ip_address":"","ucode":"0B1DB8F437A4B2","user_header":"","comment_is_top":false,"comment_ctime":1581358814,"is_pvip":false,"replies":[{"id":68878,"content":"å…ˆè¯´æ˜¯ä¸æ˜¯ï¼Œç„¶åæ‰è°ˆå¾—ä¸Šä¸ºä»€ä¹ˆã€‚\n\nåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ²¡æœ‰å¿…è¦é‚£ä¹ˆåšã€‚æˆ‘ä»æ¥æ²¡åœ¨ä»£ç é‡Œå†™è¿‡ malloc_trimã€‚\n\nåœ¨æœ‰è™šæ‹Ÿå†…å­˜çš„ä¸–ç•Œé‡Œï¼Œæˆ‘çœ‹ä¸å‡ºè°ƒç”¨ malloc_trim çš„å¿…è¦æ€§ã€‚æ“ä½œç³»ç»Ÿè‡ªå·±èƒ½ç®¡å¥½ã€‚\n\nå¦‚æœåµŒå…¥å¼å¼€å‘ï¼Œæ²¡æœ‰è™šæ‹Ÿå†…å­˜ï¼Œä½ ç”¨ malloc_trim ä¹Ÿä¸è§å¾—æœ‰ç”¨ã€‚å› ä¸ºä¸€æ—¦å †çš„å°¾éƒ¨æœ‰åˆ†é…ï¼Œä½ å¹¶ä¸èƒ½é‡Šæ”¾å†…å­˜å›æ“ä½œç³»ç»Ÿã€‚\n\nè€Œä¸”ï¼Œä½ ä¸ºä»€ä¹ˆè¦è¿˜å†…å­˜ç»™æ“ä½œç³»ç»Ÿï¼Ÿä»¥åä½ ä¸ç”¨äº†å—ï¼Ÿæ˜¯ç¨‹åºè¦é€€å‡ºäº†å—ï¼Ÿå¦‚æœç¨‹åºè¦é€€å‡ºï¼Œæœ¬æ¥å ç”¨çš„èµ„æºå°±ä¼šè¢«é‡Šæ”¾æ‰ã€‚å¦‚æœç¨‹åºä¸é€€å‡ºï¼Œè¿›ç¨‹ç®¡å¥½è‡ªå·±çš„äº‹ï¼Œä¸‹æ¬¡åˆ†é…èƒ½ä¸éº»çƒ¦æ“ä½œç³»ç»Ÿå°±ä¸éº»çƒ¦æ“ä½œç³»ç»Ÿï¼Œåº”è¯¥åè€Œæ›´å¥½ã€‚\n\næˆ‘çš„ä¸ªäººè§è§£ï¼Œè°å‘Šè¯‰ä½ è¿™å¥è¯çš„ï¼ŒåŸºæœ¬ä¸Šå¹¶ä¸çœŸæ‡‚åº”ç”¨å¼€å‘ï¼Œåªæ˜¯å­¦äº†ç‚¹ Linux çš„çŸ¥è¯†ï¼Œåœ¨çå–å¼„è€Œå·²ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´å’ç‚œ","uid":1645639,"ctime":1581399512,"ip_address":"","comment_id":177362,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"è€å¸ˆï¼Œmap&lt;int, int&gt;().swap(map1);\nè¿™ä¸ªè¯­å¥ä¸ºä»€ä¹ˆä¸èƒ½è¾¾åˆ°çœŸæ­£é‡Šæ”¾map1å†…å­˜çš„æ•ˆæœå‘¢ï¼Ÿå¿…é¡»å¾—ç”¨malloc_trim","like_count":1,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":484554,"discussion_content":"æœ‰äº‹æƒ…å…ˆå‘æˆ‘é‚®ä»¶å¥½äº†ã€‚åº”è¯¥ä¸ä¼šæ‰¾ä¸åˆ°å§ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582245332,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1821566,"avatar":"https://static001.geekbang.org/account/avatar/00/1b/cb/7e/dd9258dd.jpg","nickname":"Gallen","note":"","ucode":"CFB50D4E8170F0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":179651,"discussion_content":"å¥½çš„è€å¸ˆï¼Œæ‰¾å¾—åˆ°çš„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582246532,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":177127,"user_name":"Vackine","can_delete":false,"product_type":"c1","uid":1139588,"ip_address":"","ucode":"8E412EE82D3B59","user_header":"https://static001.geekbang.org/account/avatar/00/11/63/84/f45c4af9.jpg","comment_is_top":false,"comment_ctime":1581298887,"is_pvip":false,"replies":[{"id":68828,"content":"ç¼–ç¨‹é­”æ³•å’Œæ€§èƒ½æå‡æœ‰çŸ›ç›¾ä¹ˆï¼ŸğŸ¤ª\n\nä¸¥è‚ƒç‚¹ï¼Œåç¨‹ä¸æ˜¯ä¸ºäº†æé«˜ä»£ç æ€§èƒ½ï¼Œè€Œæ˜¯ä¸ºäº†æé«˜ç¨‹åºå‘˜çš„ç”Ÿäº§ç‡ã€‚ä»è¿™ç‚¹ä¸Šæ¥è¯´ï¼Œåç¨‹ä»ç„¶æ˜¯ä¸€ç§ç¼–è¯‘å™¨çš„é»‘é­”æ³•ã€‚\n\nè·Ÿæ‰‹å†™æ¯”èµ·æ¥ï¼Œæ²¡æœ‰æ€§èƒ½çš„æå‡ã€‚å°±å¦‚åŒé™¤äº†æå°‘æ•°çš„æƒ…å†µï¼ˆæ¯”å¦‚æ³›å‹å…è®¸å†…è”å¯¼è‡´C++çš„æ’åºæ¯”Cçš„qsortå¿«ï¼‰ï¼ŒC++ä»£ç ä¸ä¼šæ¯”Cä»£ç æ€§èƒ½æ›´é«˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´å’ç‚œ","uid":1645639,"ctime":1581335925,"ip_address":"","comment_id":177127,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"æ„Ÿè§‰è·Ÿpythoné‡Œé¢çš„asyncçš„æ–°çš„æ ‡å‡†åº“å¥½åƒï¼Œæ˜¯çœŸçš„æœ‰æ€§èƒ½ä¸Šçš„æå‡ä¹ˆï¼Œè¿˜æ˜¯åªæ˜¯ç¼–ç¨‹é­”æ³•ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483400,"discussion_content":"å…ˆè¯´æ˜¯ä¸æ˜¯ï¼Œç„¶åæ‰è°ˆå¾—ä¸Šä¸ºä»€ä¹ˆã€‚\n\nåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ²¡æœ‰å¿…è¦é‚£ä¹ˆåšã€‚æˆ‘ä»æ¥æ²¡åœ¨ä»£ç é‡Œå†™è¿‡ malloc_trimã€‚\n\nåœ¨æœ‰è™šæ‹Ÿå†…å­˜çš„ä¸–ç•Œé‡Œï¼Œæˆ‘çœ‹ä¸å‡ºè°ƒç”¨ malloc_trim çš„å¿…è¦æ€§ã€‚æ“ä½œç³»ç»Ÿè‡ªå·±èƒ½ç®¡å¥½ã€‚\n\nå¦‚æœåµŒå…¥å¼å¼€å‘ï¼Œæ²¡æœ‰è™šæ‹Ÿå†…å­˜ï¼Œä½ ç”¨ malloc_trim ä¹Ÿä¸è§å¾—æœ‰ç”¨ã€‚å› ä¸ºä¸€æ—¦å †çš„å°¾éƒ¨æœ‰åˆ†é…ï¼Œä½ å¹¶ä¸èƒ½é‡Šæ”¾å†…å­˜å›æ“ä½œç³»ç»Ÿã€‚\n\nè€Œä¸”ï¼Œä½ ä¸ºä»€ä¹ˆè¦è¿˜å†…å­˜ç»™æ“ä½œç³»ç»Ÿï¼Ÿä»¥åä½ ä¸ç”¨äº†å—ï¼Ÿæ˜¯ç¨‹åºè¦é€€å‡ºäº†å—ï¼Ÿå¦‚æœç¨‹åºè¦é€€å‡ºï¼Œæœ¬æ¥å ç”¨çš„èµ„æºå°±ä¼šè¢«é‡Šæ”¾æ‰ã€‚å¦‚æœç¨‹åºä¸é€€å‡ºï¼Œè¿›ç¨‹ç®¡å¥½è‡ªå·±çš„äº‹ï¼Œä¸‹æ¬¡åˆ†é…èƒ½ä¸éº»çƒ¦æ“ä½œç³»ç»Ÿå°±ä¸éº»çƒ¦æ“ä½œç³»ç»Ÿï¼Œåº”è¯¥åè€Œæ›´å¥½ã€‚\n\næˆ‘çš„ä¸ªäººè§è§£ï¼Œè°å‘Šè¯‰ä½ è¿™å¥è¯çš„ï¼ŒåŸºæœ¬ä¸Šå¹¶ä¸çœŸæ‡‚åº”ç”¨å¼€å‘ï¼Œåªæ˜¯å­¦äº†ç‚¹ Linux çš„çŸ¥è¯†ï¼Œåœ¨çå–å¼„è€Œå·²ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581399512,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":369208,"user_name":"å¾","can_delete":false,"product_type":"c1","uid":1045869,"ip_address":"å¹¿ä¸œ","ucode":"4EE8B126738A29","user_header":"https://static001.geekbang.org/account/avatar/00/0f/f5/6d/fa3ab44d.jpg","comment_is_top":false,"comment_ctime":1677222986,"is_pvip":false,"replies":[{"id":134573,"content":"ç°åœ¨è‘—åçš„å¼‚æ­¥æ¡†æ¶ Asio ä¹Ÿæ”¯æŒåç¨‹äº†ã€‚é˜¿é‡Œä¹Ÿæœ‰ä¸ªåç¨‹åº“ PhotonLibã€‚å°è€Œç¾çš„å¯ä»¥ç ”ç©¶ä¸€ä¸‹ netcan&#47;asyncioã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1645639,"ctime":1677414295,"ip_address":"æ±Ÿè‹","comment_id":369208,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100040501,"comment_content":"å¾ˆæ—©äº†è§£è¿‡åç¨‹çš„æ¦‚å¿µï¼Œè¯´æ˜¯ç”¨æˆ·çº§çº¿ç¨‹ï¼Œåœ¨ç”¨æˆ·æ€è°ƒåº¦ï¼Œé¿å…çº¿ç¨‹çš„å†…æ ¸æ€åˆ‡æ¢ï¼Œæ€§èƒ½æ›´é«˜ï¼›\nåæ¥åœ¨ä¸€ä¸ª C++ æœåŠ¡æ¡†æ¶ä¸Šä¹Ÿä½¿ç”¨è¿‡ï¼Œå†åæ¥åˆ‡åˆ° Goï¼Œç”¨èµ·äº† goroutineï¼›\nç®€å•æ¥è¯´ï¼Œåç¨‹ç”¨èµ·æ¥æ˜¯çœŸçˆ½ï¼Œé¿å…äº†æ¶å¿ƒçš„å¼‚æ­¥ IO çš„ callback å†™æ³•ï¼Œè‡ªæˆ‘æ„Ÿè§‰ä¹Ÿç®—æ˜¯ç†è§£å¹¶ç†Ÿç»ƒä½¿ç”¨åç¨‹äº†ã€‚\n\nç›´åˆ°çœ‹äº† C++ 20 çš„åç¨‹ï¼Œå®Œäº†æƒŠæ‰ä¸‹å·´ç©è„‘è¢‹é—®å·ï¼Œè¿™ä»€ä¹ˆç©æ„å„¿ï¼Œè¿™æ˜¯åç¨‹å—ï¼Ÿ\næŸ¥å„ç§èµ„æ–™å’Œä¹¦ï¼Œéƒ½è·Ÿä»¥å‰ç†è§£çš„ä¸ä¸€æ ·ï¼Œç‰¹åˆ«æ˜¯çœ‹åˆ°æœ‰äººæ‰€è°“çš„ç”¨å‡ è¡Œä»£ç å®ç°åç¨‹ï¼Œé‚£æ›´æ˜¯ä¸çŸ¥æ‰€ä»¥ã€‚\n\næœ€åç»ˆäºåœ¨è¿™é‡Œè§£å¼€äº†æˆ‘çš„ç–‘æƒ‘ï¼ŒåŸæ¥ä»¥å‰ç†è§£å’Œä½¿ç”¨çš„åç¨‹ï¼Œå’Œ C++ 20 é‡Œçš„åç¨‹ï¼Œä¸€ä¸ªæ˜¯æœ‰æ ˆåç¨‹ï¼Œä¸€ä¸ªæ˜¯æ— æ ˆåç¨‹ï¼Œæœ‰å·¨å¤§å·®å¼‚ï¼Œä¸ºå•¥åœ¨é‚£äº›è®²ç°ä»£ C++ çš„ä¹¦é‡Œï¼Œéƒ½ä¸æè¿™ä¸ªç‚¹ï¼Œè¿™ä¸ªå¾ˆå…³é”®å‘ï¼ŒçœŸæ˜¯å›°æ‰°æˆ‘å¾ˆä¹…ã€‚","like_count":0,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":483314,"discussion_content":"ç¼–ç¨‹é­”æ³•å’Œæ€§èƒ½æå‡æœ‰çŸ›ç›¾ä¹ˆï¼ŸğŸ¤ª\n\nä¸¥è‚ƒç‚¹ï¼Œåç¨‹ä¸æ˜¯ä¸ºäº†æé«˜ä»£ç æ€§èƒ½ï¼Œè€Œæ˜¯ä¸ºäº†æé«˜ç¨‹åºå‘˜çš„ç”Ÿäº§ç‡ã€‚ä»è¿™ç‚¹ä¸Šæ¥è¯´ï¼Œåç¨‹ä»ç„¶æ˜¯ä¸€ç§ç¼–è¯‘å™¨çš„é»‘é­”æ³•ã€‚\n\nè·Ÿæ‰‹å†™æ¯”èµ·æ¥ï¼Œæ²¡æœ‰æ€§èƒ½çš„æå‡ã€‚å°±å¦‚åŒé™¤äº†æå°‘æ•°çš„æƒ…å†µï¼ˆæ¯”å¦‚æ³›å‹å…è®¸å†…è”å¯¼è‡´C++çš„æ’åºæ¯”Cçš„qsortå¿«ï¼‰ï¼ŒC++ä»£ç ä¸ä¼šæ¯”Cä»£ç æ€§èƒ½æ›´é«˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1581335925,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":297227,"user_name":"ç™¾å¹´","can_delete":false,"product_type":"c1","uid":1526311,"ip_address":"","ucode":"6D41E3D3282255","user_header":"https://static001.geekbang.org/account/avatar/00/17/4a/27/2702206d.jpg","comment_is_top":false,"comment_ctime":1623385491,"is_pvip":false,"replies":[{"id":107987,"content":"è¿™ä¸ªæ–¹å‘åº”è¯¥ä¸å¤ªä¼šè€ƒè™‘â€¦â€¦ç›®å‰çš„å·¥ä½œå…¨éƒ¨æ˜¯åœ¨ C++ ä¸Šäº†ã€‚ğŸ˜‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´å’ç‚œ","uid":1645639,"ctime":1623479662,"ip_address":"","comment_id":297227,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100040501,"comment_content":"è€å¸ˆç»“è¯¾æœ‰ä¸€å¹´å¤šäº†ï¼Œä»€ä¹ˆæ—¶å€™å¼€ä¸ªC++ä¸pythonè”åˆç¼–ç¨‹çš„è¯¾å•Šã€‚","like_count":0},{"had_liked":false,"id":297227,"user_name":"ç™¾å¹´","can_delete":false,"product_type":"c1","uid":1526311,"ip_address":"","ucode":"6D41E3D3282255","user_header":"https://static001.geekbang.org/account/avatar/00/17/4a/27/2702206d.jpg","comment_is_top":false,"comment_ctime":1623385491,"is_pvip":false,"replies":[{"id":107987,"content":"è¿™ä¸ªæ–¹å‘åº”è¯¥ä¸å¤ªä¼šè€ƒè™‘â€¦â€¦ç›®å‰çš„å·¥ä½œå…¨éƒ¨æ˜¯åœ¨ C++ ä¸Šäº†ã€‚ğŸ˜‚","user_name":"ä½œè€…å›å¤","user_name_real":"å´å’ç‚œ","uid":1645639,"ctime":1623479662,"ip_address":"","comment_id":297227,"utype":1}],"discussion_count":1,"race_medal":0,"score":3,"product_id":100040501,"comment_content":"è€å¸ˆç»“è¯¾æœ‰ä¸€å¹´å¤šäº†ï¼Œä»€ä¹ˆæ—¶å€™å¼€ä¸ªC++ä¸pythonè”åˆç¼–ç¨‹çš„è¯¾å•Šã€‚","like_count":0,"discussions":[{"author":{"id":1645639,"avatar":"https://static001.geekbang.org/account/avatar/00/19/1c/47/53c48284.jpg","nickname":"å´å’ç‚œ","note":"","ucode":"8C24C10AEC779F","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":521765,"discussion_content":"è¿™ä¸ªæ–¹å‘åº”è¯¥ä¸å¤ªä¼šè€ƒè™‘â€¦â€¦ç›®å‰çš„å·¥ä½œå…¨éƒ¨æ˜¯åœ¨ C++ ä¸Šäº†ã€‚ğŸ˜‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623479662,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]}]}