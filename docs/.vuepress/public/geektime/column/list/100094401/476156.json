{"id":476156,"title":"35ï½œViteåŸç†ï¼šå†™ä¸€ä¸ªè¿·ä½ çš„Vite","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å¤§åœ£ã€‚</p><p>ä¸Šä¸€è®²å­¦å®Œäº†Vueçš„ç¼–è¯‘åŸç†åï¼Œæˆ‘ä»¬å°±æŠŠVueçš„æ•´ä½“æµç¨‹æ¢³ç†å®Œæ¯•äº†ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨ä½¿ç”¨Vueçš„æ—¶å€™ï¼Œè¿˜ä¼šç”¨åˆ°å¾ˆå¤šVueç”Ÿæ€çš„åº“ã€‚æ‰€ä»¥ä»ä»Šå¤©å¼€å§‹ï¼Œæˆ‘ä¼šå¸¦ä½ äº†è§£å‡ ä¸ªVueç”Ÿæ€ä¸­é‡è¦æˆå‘˜çš„åŸç†å’Œæºç ï¼Œä»Šå¤©æˆ‘å…ˆå¸¦ä½ å‰–æä¸€ä¸‹æˆ‘ä»¬é¡¹ç›®ä¸­ç”¨çš„å·¥ç¨‹åŒ–å·¥å…·Viteçš„åŸç†ã€‚</p><h2>ç°åœ¨å·¥ç¨‹åŒ–çš„ç—›ç‚¹</h2><p>ç°åœ¨å‰ç«¯å¼€å‘é¡¹ç›®çš„æ—¶å€™ï¼Œå·¥ç¨‹åŒ–å·¥å…·å·²ç»æˆä¸ºäº†æ ‡å‡†é…ç½®ï¼Œwebpackæ˜¯ç°åœ¨ä½¿ç”¨ç‡æœ€é«˜çš„å·¥ç¨‹åŒ–æ¡†æ¶ï¼Œå®ƒå¯ä»¥å¾ˆå¥½åœ°å¸®åŠ©æˆ‘ä»¬å®Œæˆä»ä»£ç è°ƒè¯•åˆ°æ‰“åŒ…çš„å…¨è¿‡ç¨‹ï¼Œä½†æ˜¯éšç€é¡¹ç›®è§„æ¨¡çš„çˆ†ç‚¸å¼å¢é•¿ï¼Œ<strong>webpackä¹Ÿå¸¦æ¥äº†ä¸€äº›ç—›ç‚¹é—®é¢˜</strong>ã€‚</p><p>æœ€æ—©webpackå¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨JavaScriptæ–‡ä»¶ä¸­ä½¿ç”¨requireå¯¼å…¥å…¶ä»–JavaScriptã€CSSã€imageç­‰æ–‡ä»¶ï¼Œå¹¶ä¸”æä¾›äº†dev-serverå¯åŠ¨æµ‹è¯•æœåŠ¡å™¨ï¼Œæå¤§åœ°æé«˜äº†æˆ‘ä»¬å¼€å‘é¡¹ç›®çš„æ•ˆç‡ã€‚</p><p>webpackçš„æ ¸å¿ƒåŸç†å°±æ˜¯é€šè¿‡åˆ†æJavaScriptä¸­çš„requireè¯­å¥ï¼Œåˆ†æå‡ºå½“å‰JavaScriptæ–‡ä»¶æ‰€æœ‰çš„ä¾èµ–æ–‡ä»¶ï¼Œç„¶åé€’å½’åˆ†æä¹‹åï¼Œå°±å¾—åˆ°äº†æ•´ä¸ªé¡¹ç›®çš„ä¸€ä¸ªä¾èµ–å›¾ã€‚å¯¹å›¾ä¸­ä¸åŒæ ¼å¼çš„æ–‡ä»¶æ‰§è¡Œä¸åŒçš„loaderï¼Œæ¯”å¦‚ä¼šæŠŠCSSæ–‡ä»¶è§£ææˆåŠ è½½CSSæ ‡ç­¾çš„JavaScriptä»£ç ï¼Œæœ€ååŸºäºè¿™ä¸ªä¾èµ–å›¾è·å–æ‰€æœ‰çš„æ–‡ä»¶ã€‚</p><!-- [[[read_end]]] --><p>è¿›è¡Œæ‰“åŒ…å¤„ç†ä¹‹åï¼Œæ”¾åœ¨å†…å­˜ä¸­æä¾›ç»™æµè§ˆå™¨ä½¿ç”¨ï¼Œç„¶ådev-serverä¼šå¯åŠ¨ä¸€ä¸ªæµ‹è¯•æœåŠ¡å™¨æ‰“å¼€é¡µé¢ï¼Œå¹¶ä¸”åœ¨ä»£ç æ–‡ä»¶ä¿®æ”¹ä¹‹åå¯ä»¥é€šè¿‡WebSocketé€šçŸ¥å‰ç«¯è‡ªåŠ¨æ›´æ–°é¡µé¢ï¼Œ<strong>ä¹Ÿå°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„çƒ­æ›´æ–°åŠŸèƒ½</strong>ã€‚</p><p>ç”±äºwebpackåœ¨é¡¹ç›®è°ƒè¯•ä¹‹å‰ï¼Œè¦æŠŠæ‰€æœ‰æ–‡ä»¶çš„ä¾èµ–å…³ç³»æ”¶é›†å®Œï¼Œæ‰“åŒ…å¤„ç†åæ‰èƒ½å¯åŠ¨æµ‹è¯•ï¼Œå¾ˆå¤šå¤§é¡¹ç›®æˆ‘ä»¬æ‰§è¡Œè°ƒè¯•å‘½ä»¤åéœ€è¦ç­‰1åˆ†é’Ÿä»¥ä¸Šæ‰èƒ½å¼€å§‹è°ƒè¯•ã€‚è¿™å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œè¿™æ®µæ—¶é—´é™¤äº†æ‘¸é±¼ä»€ä¹ˆéƒ½å¹²ä¸äº†ï¼Œè€Œä¸”çƒ­æ›´æ–°ä¹Ÿéœ€è¦ç­‰å‡ ç§’é’Ÿæ‰èƒ½ç”Ÿæ•ˆï¼Œæå¤§åœ°å½±å“äº†æˆ‘ä»¬å¼€å‘çš„æ•ˆç‡ã€‚æ‰€ä»¥é’ˆå¯¹webpackè¿™ç§æ‰“åŒ…bundleçš„æ€è·¯ï¼Œç¤¾åŒºå°±è¯ç”Ÿäº†bundlessçš„æ¡†æ¶ï¼ŒViteå°±æ˜¯å…¶ä¸­çš„ä½¼ä½¼è€…ã€‚</p><p>å‰ç«¯çš„é¡¹ç›®ä¹‹æ‰€ä»¥éœ€è¦webpackæ‰“åŒ…ï¼Œæ˜¯å› ä¸º<strong>æµè§ˆå™¨é‡Œçš„JavaScriptæ²¡æœ‰å¾ˆå¥½çš„æ–¹å¼å»å¼•å…¥å…¶ä»–æ–‡ä»¶</strong>ã€‚webpackæä¾›çš„æ‰“åŒ…åŠŸèƒ½å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç»„ç»‡å¼€å‘ä»£ç ï¼Œä½†æ˜¯ç°åœ¨å¤§éƒ¨åˆ†æµè§ˆå™¨éƒ½æ”¯æŒäº†ES6çš„moduleåŠŸèƒ½ï¼Œæˆ‘ä»¬åœ¨æµè§ˆå™¨å†…ä½¿ç”¨type=\"module\"æ ‡è®°ä¸€ä¸ªscriptåï¼Œåœ¨src/main.jsä¸­å°±å¯ä»¥ç›´æ¥ä½¿ç”¨importè¯­æ³•å»å¼•å…¥ä¸€ä¸ªæ–°çš„JavaScriptæ–‡ä»¶ã€‚è¿™æ ·æˆ‘ä»¬å…¶å®å¯ä»¥ä¸ä¾èµ–webpackçš„æ‰“åŒ…åŠŸèƒ½ï¼Œåˆ©ç”¨æµè§ˆå™¨çš„moduleåŠŸèƒ½å°±å¯ä»¥é‡æ–°ç»„ç»‡æˆ‘ä»¬çš„ä»£ç ã€‚</p><pre><code class=\"language-javascript\">    &lt;script type=\"module\" src=\"/src/main.js\"&gt;&lt;/script&gt;\n</code></pre><h2>ViteåŸç†</h2><p>äº†è§£äº†scriptçš„ä½¿ç”¨æ–¹å¼ä¹‹åï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ª<strong>è¿·ä½ çš„ Vite</strong>æ¥è®²è§£å…¶å¤§è‡´çš„åŸç†ã€‚</p><p>é¦–å…ˆï¼Œæµè§ˆå™¨çš„moduleåŠŸèƒ½æœ‰ä¸€äº›é™åˆ¶éœ€è¦é¢å¤–å¤„ç†ã€‚æµè§ˆå™¨è¯†åˆ«å‡ºJavaScriptä¸­çš„importè¯­å¥åï¼Œä¼šå‘èµ·ä¸€ä¸ªæ–°çš„ç½‘ç»œè¯·æ±‚å»è·å–æ–°çš„æ–‡ä»¶ï¼Œæ‰€ä»¥åªæ”¯æŒ/\bã€./å’Œâ€¦/å¼€å¤´çš„è·¯å¾„ã€‚</p><p>è€Œåœ¨ä¸‹é¢çš„Vueé¡¹ç›®å¯åŠ¨ä»£ç ä¸­ï¼Œé¦–å…ˆæµè§ˆå™¨å¹¶ä¸çŸ¥é“Vueæ˜¯ä»å“ªæ¥ï¼Œæˆ‘ä»¬ç¬¬ä¸€ä¸ªè¦åšçš„ï¼Œå°±æ˜¯åˆ†ææ–‡ä»¶ä¸­çš„importè¯­å¥ã€‚å¦‚æœè·¯å¾„ä¸æ˜¯ä¸€ä¸ªç›¸å¯¹è·¯å¾„æˆ–è€…ç»å¯¹è·¯å¾„ï¼Œé‚£å°±è¯´æ˜è¿™ä¸ªæ¨¡å—æ˜¯æ¥è‡ªnode_modulesï¼Œæˆ‘ä»¬éœ€è¦å»node_modulesæŸ¥æ‰¾è¿™ä¸ªæ–‡ä»¶çš„å…¥å£æ–‡ä»¶åè¿”å›æµè§ˆå™¨ã€‚ç„¶å ./App.vueæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œå¯ä»¥æ‰¾åˆ°æ–‡ä»¶ï¼Œä½†æ˜¯æµè§ˆå™¨ä¸æ”¯æŒ .vueæ–‡ä»¶çš„è§£æï¼Œå¹¶ä¸”index.cssä¹Ÿä¸æ˜¯ä¸€ä¸ªåˆæ³•çš„JavaScriptæ–‡ä»¶ã€‚</p><p><strong>æˆ‘ä»¬éœ€è¦è§£å†³ä»¥ä¸Šä¸‰ä¸ªé—®é¢˜ï¼Œæ‰èƒ½è®©Vueé¡¹ç›®å¾ˆå¥½åœ°åœ¨æµè§ˆå™¨é‡Œè·‘èµ·æ¥ã€‚</strong></p><pre><code class=\"language-javascript\">import { createApp } from 'vue'\nimport App from './App.vue'\nimport './index.css'\n\nconst app = createApp(App)\napp.mount('#app')\n\n</code></pre><p>æ€ä¹ˆåšå‘¢ï¼Ÿé¦–å…ˆæˆ‘ä»¬éœ€è¦ä½¿ç”¨Koaæ­å»ºä¸€ä¸ªserverï¼Œç”¨æ¥æ‹¦æˆªæµè§ˆå™¨å‘å‡ºçš„æ‰€æœ‰ç½‘ç»œè¯·æ±‚ï¼Œæ‰èƒ½å®ç°ä¸Šè¿°åŠŸèƒ½ã€‚åœ¨ä¸‹é¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Koaå¯åŠ¨äº†ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå¹¶ä¸”è®¿é—®é¦–é¡µå†…å®¹è¯»å–index.htmlçš„å†…å®¹ã€‚</p><pre><code class=\"language-javascript\">const fs = require('fs')\nconst path = require('path')\nconst Koa = require('koa')\nconst app = new Koa()\n\napp.use(async ctx=&gt;{\n  const {request:{url,query} } = ctx\nif(url=='/'){\n    ctx.type=\"text/html\"\n    let content = fs.readFileSync('./index.html','utf-8')\n    \n    ctx.body = content\n  }\n})\napp.listen(24678, ()=&gt;{\n  console.log('å¿«æ¥å¿«æ¥æ•°ä¸€æ•°ï¼Œç«¯å£24678')\n})\n</code></pre><p>ä¸‹é¢å°±æ˜¯é¦–é¡µindex.htmlçš„å†…å®¹ï¼Œä¸€ä¸ªdivä½œä¸ºVueå¯åŠ¨çš„å®¹å™¨ï¼Œå¹¶ä¸”é€šè¿‡scriptå¼•å…¥src.main.jsã€‚æˆ‘ä»¬è®¿é—®é¦–é¡µä¹‹åï¼Œå°±ä¼šçœ‹åˆ°æµè§ˆå™¨å†…æ˜¾ç¤ºçš„geektimeæ–‡æœ¬ï¼Œå¹¶ä¸”å‘èµ·äº†ä¸€ä¸ªmain.jsçš„HTTPè¯·æ±‚ï¼Œ<strong>ç„¶åæˆ‘ä»¬æ¥è§£å†³é¡µé¢ä¸­çš„æŠ¥é”™é—®é¢˜</strong>ã€‚</p><pre><code class=\"language-javascript\">&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n  &lt;meta charset=\"UTF-8\"&gt;\n  &lt;link rel=\"icon\" href=\"/favicon.ico\" /&gt;\n  &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n  &lt;title&gt;Vite App&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;h1&gt;geek time&lt;/h1&gt;\n  &lt;div id=\"app\"&gt;&lt;/div&gt;\n  &lt;script type=\"module\" src=\"/src/main.js\"&gt;&lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n\n</code></pre><p>é¦–å…ˆimport {createApp} from Vueè¿™ä¸€æ­¥ç”±äºæµè§ˆå™¨æ— æ³•è¯†åˆ«Vueçš„è·¯å¾„ï¼Œå°±ä¼šç›´æ¥æŠ›å‡ºé”™è¯¯ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åœ¨Koaä¸­æŠŠVueçš„è·¯å¾„é‡å†™ã€‚ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨replaceè¯­å¥ï¼ŒæŠŠVueæ”¹æˆ/@modules/vueï¼Œä½¿ç”¨@moduleå¼€å¤´çš„åœ°å€æ¥å‘Šè¯‰Koaè¿™æ˜¯ä¸€ä¸ªéœ€è¦å»node_modulesæŸ¥è¯¢çš„æ¨¡å—ã€‚</p><p>åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ¤æ–­å¦‚æœè¯·æ±‚åœ°å€æ˜¯jsç»“å°¾ï¼Œå°±å»è¯»å–å¯¹åº”çš„æ–‡ä»¶å†…å®¹ï¼Œä½¿ç”¨rewriteImportå‡½æ•°å¤„ç†åå†è¿”å›æ–‡ä»¶å†…å®¹ã€‚åœ¨rewriteImportä¸­æˆ‘ä»¬å®ç°äº†è·¯å¾„çš„æ›¿æ¢ï¼ŒæŠŠVueå˜æˆäº† @modules/vueï¼Œ ç°åœ¨æµè§ˆå™¨å°±ä¼šå‘èµ·ä¸€ä¸ª<a href=\"http://localhost:24678/@modules/vue\">http://localhost:24678/@modules/vue</a> çš„è¯·æ±‚ï¼Œä¸‹ä¸€æ­¥æˆ‘ä»¬è¦åœ¨Koaä¸­æ‹¦æˆªè¿™ä¸ªè¯·æ±‚ï¼Œå¹¶ä¸”è¿”å›Vueçš„ä»£ç å†…å®¹ã€‚</p><pre><code class=\"language-javascript\">const fs = require('fs')\nconst path = require('path')\nconst Koa = require('koa')\nconst app = new Koa()\n\nfunction rewriteImport(content){\n  return content.replace(/ from ['|\"]([^'\"]+)['|\"]/g, function(s0,s1){\n    // . ../ /å¼€å¤´çš„ï¼Œéƒ½æ˜¯ç›¸å¯¹è·¯å¾„\n    if(s1[0]!=='.'&amp;&amp; s1[1]!=='/'){\n      return ` from '/@modules/${s1}'`\n    }else{\n      return s0\n    }\n  })\n}\n\napp.use(async ctx=&gt;{\n  const {request:{url,query} } = ctx\n  if(url=='/'){\n      ctx.type=\"text/html\"\n      let content = fs.readFileSync('./index.html','utf-8')\n      \n      ctx.body = content\n  }else if(url.endsWith('.js')){\n    // jsæ–‡ä»¶\n    const p = path.resolve(__dirname,url.slice(1))\n    ctx.type = 'application/javascript'\n    const content = fs.readFileSync(p,'utf-8')\n    ctx.body = rewriteImport(content)\n  }\n})\napp.listen(24678, ()=&gt;{\n  console.log('å¿«æ¥å¿«æ¥è¯´ä¸€ä¹¦ï¼Œç«¯å£24678')\n})\n\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/c3/62/c39f700e37b638345ae4cbd0228fd762.png?wh=1125x387\" alt=\"å›¾ç‰‡\"></p><p>ç„¶åæˆ‘ä»¬åœ¨Koaä¸­åˆ¤æ–­è¯·æ±‚åœ°å€ï¼Œå¦‚æœæ˜¯@moduleçš„åœ°å€ï¼Œå°±æŠŠåé¢çš„Vueè§£æå‡ºæ¥ï¼Œå»node_modulesä¸­æŸ¥è¯¢ã€‚ç„¶åæ‹¼æ¥å‡ºç›®æ ‡è·¯å¾„ ./node_modules/vue/package.jsonå»è¯»å–Vueé¡¹ç›®ä¸­package.jsonçš„moduleå­—æ®µï¼Œè¿™ä¸ªå­—æ®µçš„åœ°å€å°±æ˜¯ ES6 è§„èŒƒçš„å…¥å£æ–‡ä»¶ã€‚åœ¨æˆ‘ä»¬è¯»å–åˆ°æ–‡ä»¶åï¼Œå†ä½¿ç”¨rewriteImportå¤„ç†åè¿”å›å³å¯ã€‚</p><p>è¿™é‡Œè¿˜è¦ä½¿ç”¨rewriteImportçš„åŸå› æ˜¯ï¼ŒVueæ–‡ä»¶å†…éƒ¨ä¹Ÿä¼šä½¿ç”¨importçš„è¯­æ³•å»åŠ è½½å…¶ä»–æ¨¡å—ã€‚ç„¶åæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°æµè§ˆå™¨ç½‘ç»œè¯·æ±‚åˆ—è¡¨ä¸­å¤šäº†å¥½å‡ ä¸ªVueçš„è¯·æ±‚ã€‚</p><pre><code class=\"language-javascript\">else if(url.startsWith('/@modules/')){\n    // è¿™æ˜¯ä¸€ä¸ªnode_moduleé‡Œçš„ä¸œè¥¿\n    const prefix = path.resolve(__dirname,'node_modules',url.replace('/@modules/',''))\n    const module = require(prefix+'/package.json').module\n    const p = path.resolve(prefix,module)\n    const ret = fs.readFileSync(p,'utf-8')\n    ctx.type = 'application/javascript'\n    ctx.body = rewriteImport(ret)\n}\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/7f/fb/7fb5564ac59ffba085d9c7fd24f8f9fb.png?wh=1681x512\" alt=\"å›¾ç‰‡\"></p><p><strong>è¿™æ ·æˆ‘ä»¬å°±å®ç°äº†node_modulesæ¨¡å—çš„è§£æï¼Œç„¶åæˆ‘ä»¬æ¥å¤„ç†æµè§ˆå™¨æ— æ³•è¯†åˆ« .vueæ–‡ä»¶çš„é”™è¯¯ã€‚</strong></p><p>.vueæ–‡ä»¶æ˜¯Vueä¸­ç‰¹æœ‰çš„æ–‡ä»¶æ ¼å¼ï¼Œæˆ‘ä»¬ä¸Šä¸€èŠ‚è¯¾æè¿‡Vueå†…éƒ¨é€šè¿‡@vue/compiler-sfcæ¥è§£æå•æ–‡ä»¶ç»„ä»¶ï¼ŒæŠŠç»„ä»¶åˆ†æˆtemplateã€styleã€scriptä¸‰ä¸ªéƒ¨åˆ†ï¼Œæˆ‘ä»¬è¦åšçš„å°±æ˜¯åœ¨Nodeç¯å¢ƒä¸‹ï¼ŒæŠŠtemplateçš„å†…å®¹è§£ææˆrenderå‡½æ•°ï¼Œå¹¶ä¸”å’Œscriptçš„å†…å®¹ç»„æˆç»„ä»¶å¯¹è±¡ï¼Œå†è¿”å›å³å¯ã€‚</p><p>å…¶ä¸­ï¼Œcompiler-domè§£ætemplateçš„æµç¨‹æˆ‘ä»¬å­¦ä¹ è¿‡ï¼Œä»Šå¤©æˆ‘ä»¬æ¥çœ‹ä¸‹å¦‚ä½•ä½¿ç”¨ã€‚</p><p>åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ¤æ–­ .vueçš„æ–‡ä»¶è¯·æ±‚åï¼Œé€šè¿‡compilerSFC.parseæ–¹æ³•è§£æVueç»„ä»¶ï¼Œé€šè¿‡è¿”å›çš„descriptor.scriptè·å–JavaScriptä»£ç ï¼Œå¹¶ä¸”å‘èµ·ä¸€ä¸ªtype=templateçš„æ–¹æ³•å»è·å–renderå‡½æ•°ã€‚åœ¨query.typeæ˜¯templateçš„æ—¶å€™ï¼Œè°ƒç”¨compilerDom.compileè§£ætemplateå†…å®¹ï¼Œç›´æ¥è¿”å›renderå‡½æ•°ã€‚</p><pre><code class=\"language-javascript\">const compilerSfc = require('@vue/compiler-sfc') // .vue\nconst compilerDom = require('@vue/compiler-dom') // æ¨¡æ¿\n\n\n\n\n\nif(url.indexOf('.vue')&gt;-1){\n    // vueå•æ–‡ä»¶ç»„ä»¶\n    const p = path.resolve(__dirname, url.split('?')[0].slice(1))\n    const {descriptor} = compilerSfc.parse(fs.readFileSync(p,'utf-8'))\n\n    if(!query.type){\n      ctx.type = 'application/javascript'\n      // å€Ÿç”¨vueè‡ªå¯¼çš„compileæ¡†æ¶ è§£æå•æ–‡ä»¶ç»„ä»¶ï¼Œå…¶å®ç›¸å½“äºvue-loaderåšçš„äº‹æƒ…\n      ctx.body = `\n  ${rewriteImport(descriptor.script.content.replace('export default ','const __script = '))}\n  import { render as __render } from \"${url}?type=template\"\n  __script.render = __render\n  export default __script\n      `\n    }else if(query.type==='template'){\n      // æ¨¡æ¿å†…å®¹\n      const template = descriptor.template\n      // è¦åœ¨serverç«¯å§compileråšäº†\n      const render = compilerDom.compile(template.content, {mode:\"module\"}).code\n      ctx.type = 'application/javascript'\n\n      ctx.body = rewriteImport(render)\n    }\n    \n</code></pre><p>ä¸Šé¢çš„ä»£ç å®ç°ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°App.vueç»„ä»¶è§£æçš„ç»“æœã€‚App.vueä¼šé¢å¤–å‘èµ·ä¸€ä¸ªApp.vue?type=templateçš„è¯·æ±‚ï¼Œæœ€ç»ˆå®Œæˆäº†æ•´ä¸ªAppç»„ä»¶çš„è§£æã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f9/90/f986571970188eac47bb4fac1af37d90.png?wh=1920x552\" alt=\"å›¾ç‰‡\"><img src=\"https://static001.geekbang.org/resource/image/cc/46/cc696c23a2a6d4e9eacf401375320146.png?wh=1920x384\" alt=\"å›¾ç‰‡\"></p><p><strong>æ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥å®ç°å¯¹CSSæ–‡ä»¶çš„æ”¯æŒã€‚</strong>ä¸‹é¢çš„ä»£ç ä¸­ï¼Œå¦‚æœurlæ˜¯CSSç»“å°¾ï¼Œæˆ‘ä»¬å°±è¿”å›ä¸€æ®µJavaScriptä»£ç ã€‚è¿™æ®µJavaScriptä»£ç ä¼šåœ¨æµè§ˆå™¨é‡Œåˆ›å»ºä¸€ä¸ªstyleæ ‡ç­¾ï¼Œæ ‡ç­¾å†…éƒ¨æ”¾å…¥æˆ‘ä»¬è¯»å–çš„CSSæ–‡ä»¶ä»£ç ã€‚è¿™ç§å¯¹CSSæ–‡ä»¶çš„å¤„ç†æ–¹å¼ï¼Œè®©CSSä»¥JavaScriptçš„å½¢å¼è¿”å›ï¼Œè¿™æ ·æˆ‘ä»¬å°±å®ç°äº†åœ¨Nodeä¸­å¯¹Vueç»„ä»¶çš„æ¸²æŸ“ã€‚</p><pre><code class=\"language-javascript\">if(url.endsWith('.css')){\n    const p = path.resolve(__dirname,url.slice(1))\n    const file = fs.readFileSync(p,'utf-8')\n    const content = `\n    const css = \"${file.replace(/\\n/g,'')}\"\n    let link = document.createElement('style')\n    link.setAttribute('type', 'text/css')\n    document.head.appendChild(link)\n    link.innerHTML = css\n    export default css\n    `\n    ctx.type = 'application/javascript'\n    ctx.body = content\n  }\n</code></pre><p><img src=\"https://static001.geekbang.org/resource/image/9f/f7/9f50c5ca0d9b74b680e41963055c99f7.png?wh=1920x628\" alt=\"å›¾ç‰‡\"></p><h2>Viteçš„çƒ­æ›´æ–°</h2><p>æœ€åæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹çƒ­æ›´æ–°å¦‚ä½•å®ç°ã€‚çƒ­æ›´æ–°çš„ç›®çš„å°±æ˜¯åœ¨æˆ‘ä»¬ä¿®æ”¹ä»£ç ä¹‹åï¼Œ<strong>æµè§ˆå™¨èƒ½å¤Ÿè‡ªåŠ¨æ¸²æŸ“æ›´æ–°çš„å†…å®¹</strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦åœ¨å®¢æˆ·ç«¯æ³¨å…¥ä¸€ä¸ªé¢å¤–çš„JavaScriptæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ç”¨æ¥å’Œåç«¯å®ç°WebSocketé€šä¿¡ã€‚ç„¶ååç«¯å¯åŠ¨WebSocketæœåŠ¡ï¼Œé€šè¿‡chokidaråº“ç›‘å¬æ–‡ä»¶å¤¹çš„å˜åŒ–åï¼Œå†é€šè¿‡WebSocketå»é€šçŸ¥æµè§ˆå™¨å³å¯ã€‚</p><p>ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡chokidar.watchå®ç°äº†æ–‡ä»¶å¤¹å˜æ›´çš„ç›‘å¬ï¼Œå¹¶ä¸”é€šè¿‡handleHMRUpdateé€šçŸ¥å®¢æˆ·ç«¯æ–‡ä»¶æ›´æ–°çš„ç±»å‹ã€‚</p><pre><code class=\"language-javascript\">\nexport function watch() {\n  const watcher = chokidar.watch(appRoot, {\n    ignored: ['**/node_modules/**', '**/.git/**'],\n    ignoreInitial: true,\n    ignorePermissionErrors: true,\n    disableGlobbing: true,\n  });\n  watcher;\n\n  return watcher;\n}\nexport function handleHMRUpdate(opts: { file: string; ws: any }) {\n  const { file, ws } = opts;\n  const shortFile = getShortName(file, appRoot);\n  const timestamp = Date.now();\n\n  console.log(`[file change] ${chalk.dim(shortFile)}`);\n  let updates;\n  if (shortFile.endsWith('.css')) {\n    updates = [\n      {\n        type: 'js-update',\n        timestamp,\n        path: `/${shortFile}`,\n        acceptedPath: `/${shortFile}`,\n      },\n    ];\n  }\n\n  ws.send({\n    type: 'update',\n    updates,\n  });\n}\n\n</code></pre><p>ç„¶åå®¢æˆ·ç«¯æ³¨å…¥ä¸€æ®µé¢å¤–çš„JavaScriptä»£ç ï¼Œåˆ¤æ–­åç«¯ä¼ é€’çš„ç±»å‹æ˜¯js-updateè¿˜æ˜¯css-updateå»æ‰§è¡Œä¸åŒçš„å‡½æ•°å³å¯ã€‚</p><pre><code class=\"language-javascript\">async function handleMessage(payload: any) {\n  switch (payload.type) {\n    case 'connected':\n      console.log(`[vite] connected.`);\n\n      setInterval(() =&gt; socket.send('ping'), 30000);\n      break;\n\n    case 'update':\n      payload.updates.forEach((update: Update) =&gt; {\n        if (update.type === 'js-update') {\n          fetchUpdate(update);\n        } \n      });\n      break;\n  }\n}\n\n</code></pre><h2>æ€»ç»“</h2><p>ä»¥ä¸Šå°±æ˜¯ä»Šå¤©çš„ä¸»è¦å†…å®¹ï¼Œæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹å§ï¼</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡äº†è§£webpackçš„å¤§è‡´åŸç†ï¼ŒçŸ¥é“äº†ç°åœ¨webpackåœ¨å¼€å‘ä½“éªŒä¸Šçš„ç—›ç‚¹ã€‚é™¤äº†ç”¨æˆ·ä½“éªŒUXä¹‹å¤–ï¼Œå¼€å‘è€…çš„ä½“éªŒDXä¹Ÿæ˜¯é¡¹ç›®è´¨é‡çš„é‡è¦å› ç´ ã€‚</p><p>webpackå¯åŠ¨æœåŠ¡å™¨ä¹‹å‰éœ€è¦è¿›è¡Œé¡¹ç›®çš„æ‰“åŒ…ï¼Œè€ŒViteåˆ™æ˜¯å¯ä»¥ç›´æ¥å¯åŠ¨æœåŠ¡ï¼Œé€šè¿‡æµè§ˆå™¨è¿è¡Œæ—¶çš„è¯·æ±‚æ‹¦æˆªï¼Œå®ç°é¦–é¡µæ–‡ä»¶çš„æŒ‰éœ€åŠ è½½ï¼Œè¿™æ ·å¼€å‘æœåŠ¡å™¨å¯åŠ¨çš„æ—¶é—´å°±å’Œæ•´ä¸ªé¡¹ç›®çš„å¤æ‚åº¦è§£è€¦ã€‚ä»»ä½•æ—¶å€™æˆ‘ä»¬å¯åŠ¨Viteçš„è°ƒè¯•æœåŠ¡å™¨ï¼ŒåŸºæœ¬éƒ½å¯ä»¥åœ¨ä¸€ç§’ä»¥å†…å“åº”ï¼Œè¿™æå¤§åœ°æå‡äº†å¼€å‘è€…çš„ä½“éªŒï¼Œè¿™ä¹Ÿæ˜¯Viteçš„ä½¿ç”¨ç‡è¶Šæ¥è¶Šé«˜çš„åŸå› ã€‚</p><p>å¹¶ä¸”æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒViteçš„ä¸»è¦ç›®çš„å°±æ˜¯æä¾›ä¸€ä¸ªè°ƒè¯•æœåŠ¡å™¨ã€‚Viteä¹Ÿå¯ä»¥å’ŒVueè§£è€¦ï¼Œå®ç°å¯¹ä»»ä½•æ¡†æ¶çš„æ”¯æŒï¼Œå¦‚æœä½¿ç”¨Viteæ”¯æŒReactï¼Œåªéœ€è¦è§£æReactä¸­çš„JSXå°±å¯ä»¥å®ç°ã€‚è¿™ä¹Ÿæ˜¯Viteé¡¹ç›®çš„ç°çŠ¶ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨æ¡†æ¶å¯¹åº”çš„Viteæ’ä»¶å°±å¯ä»¥æ”¯æŒä»»æ„æ¡†æ¶ã€‚</p><p>Viteèƒ½å¤Ÿåšåˆ°è¿™ä¹ˆå¿«çš„åŸå› ï¼Œè¿˜æœ‰ä¸€éƒ¨åˆ†æ˜¯å› ä¸ºä½¿ç”¨äº†esbuildå»è§£æJavaScriptæ–‡ä»¶ã€‚esbuildæ˜¯ä¸€ä¸ªç”¨Goè¯­è¨€å®ç°çš„JavaScriptæ‰“åŒ…å™¨ï¼Œæ”¯æŒJavaScriptå’ŒTypeScriptè¯­æ³•ï¼Œç°åœ¨å‰ç«¯å·¥ç¨‹åŒ–é¢†åŸŸçš„å·¥å…·ä¹Ÿè¶Šæ¥è¶Šå¤šåœ°ä½¿ç”¨Goå’ŒRustç­‰æ›´é«˜æ•ˆçš„è¯­è¨€ä¹¦å†™ï¼Œè¿™ä¹Ÿæ˜¯æ€§èƒ½ä¼˜åŒ–çš„ä¸€ä¸ªæ–¹å‘ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ€åç•™ä¸€ä¸ªæ€è€ƒé¢˜å§ã€‚å¦‚æœä¸€ä¸ªæ¨¡å—æ–‡ä»¶æ˜¯åˆ†æ•£çš„ï¼Œå¯¼è‡´Viteé¦–é¡µä¸€ä¸‹å­è¦åŠ è½½1000ä¸ªJavaScriptæ–‡ä»¶é€ æˆå¡é¡¿ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å¤„ç†è¿™ç§æƒ…å†µå‘¢ï¼Ÿ</p><p>æ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„ç­”æ¡ˆï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²å†è§ï¼</p>","comments":[{"had_liked":false,"id":331162,"user_name":"è‹¥å·","can_delete":false,"product_type":"c1","uid":1230852,"ip_address":"","ucode":"B8C3DD4B38CC6F","user_header":"https://static001.geekbang.org/account/avatar/00/12/c8/04/fed4c1ad.jpg","comment_is_top":false,"comment_ctime":1642469948,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"78951881276","product_id":100094401,"comment_content":"æˆ‘ä¹‹å‰ä¹Ÿå†™è¿‡ä¸€ç¯‡mini-vueçš„åˆ†ææ–‡ç« ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ç»“åˆå¤§åœ£è€å¸ˆçš„æ–‡ç« å¯¹æ¯”çœ‹çœ‹å®ç°ï½<br><br>å°¤é›¨æºªå‡ å¹´å‰å¼€å‘çš„â€œç©å…· viteâ€ï¼Œæ‰100å¤šè¡Œä»£ç ï¼Œå´ååˆ†æœ‰åŠ©äºç†è§£ vite åŸç†<br>https:&#47;&#47;juejin.cn&#47;post&#47;7021306258057592862","like_count":19},{"had_liked":false,"id":330730,"user_name":"ç‰¹ä¾›ç‰ˆ","can_delete":false,"product_type":"c1","uid":1269739,"ip_address":"","ucode":"9D6D547DFA2C05","user_header":"https://static001.geekbang.org/account/avatar/00/13/5f/eb/ef7aa4c1.jpg","comment_is_top":false,"comment_ctime":1642136846,"is_pvip":false,"replies":[{"id":"120838","content":"very good","user_name":"ä½œè€…å›å¤","comment_id":330730,"uid":"1003715","ip_address":"","utype":1,"ctime":1642338359,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"23116973326","product_id":100094401,"comment_content":"æµç¨‹ï¼š<br>1.Â  è¯·æ±‚ é¦–é¡µhttp:&#47;&#47;xxx.xxx.xxx&#47;Â <br>2.Â  è¿”å› index.html<br>3.Â  è¯·æ±‚ &#47;src&#47;main.js<br>4. å‘ç°è¯·æ±‚jsæ–‡ä»¶ï¼Œæ›¿æ¢è·¯å¾„ä¸ºç›¸å¯¹è·¯å¾„åï¼Œè¿”å›ä¿®æ”¹åçš„jsæ–‡ä»¶<br>5.Â  è¯·æ±‚ @module&#47;vue<br>6.Â  å‘ç°è¯·æ±‚@moduleå†…çš„æ–‡ä»¶ï¼Œæ›¿æ¢æ–‡ä»¶å†…ä¸ºç›¸å¯¹è·¯å¾„åï¼Œè¿”å›package.jsonä¸­moduleå®šä¹‰çš„å…¥å£æ–‡ä»¶<br>7.Â  è¯·æ±‚ .&#47;App.vue<br>8.Â  åˆ¤æ–­ .vue çš„è¯·æ±‚åï¼Œé€šè¿‡ compilerSFC.parseè§£æ Vue ç»„ä»¶ï¼Œé€šè¿‡è¿”å›çš„ descriptor.script è·å– js ä»£ç <br>9.Â  è¯·æ±‚ .&#47;App.vue?type=template<br>10.Â  è°ƒç”¨ compilerDom.compile è§£æ template å†…å®¹ï¼Œç›´æ¥è¿”å› render å‡½æ•°","like_count":6,"discussions":[{"author":{"id":1003715,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/50/c3/0aa50246.jpg","nickname":"èŠ±æœå±±å¤§åœ£","note":"","ucode":"25C0A36D628037","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546539,"discussion_content":"very good","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642338359,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":330130,"user_name":"æ¶¦åŸ¹","can_delete":false,"product_type":"c1","uid":1334652,"ip_address":"","ucode":"1CC2CD568CECC5","user_header":"https://static001.geekbang.org/account/avatar/00/14/5d/7c/3cfece5e.jpg","comment_is_top":false,"comment_ctime":1641807955,"is_pvip":false,"replies":[{"id":"120844","content":"èµ","user_name":"ä½œè€…å›å¤","comment_id":330130,"uid":"1003715","ip_address":"","utype":1,"ctime":1642338666,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"14526709843","product_id":100094401,"comment_content":"æ¨¡å—å¦‚æœæ˜¯åˆ†æ•£çš„ï¼Œå¯ä»¥ä½¿ç”¨â€œä¾èµ–é¢„æ„å»ºâ€ï¼Œé€šè¿‡é¢„æ„å»ºç”Ÿæˆä¸€ä¸ªæ¨¡å—ï¼Œè¿™æ ·åªä¼šæœ‰ä¸€ä¸ª http è¯·æ±‚ã€‚<br><br>https:&#47;&#47;cn.vitejs.dev&#47;guide&#47;dep-pre-bundling.html<br><br>https:&#47;&#47;cn.vitejs.dev&#47;config&#47;#dep-optimization-options","like_count":3,"discussions":[{"author":{"id":1003715,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/50/c3/0aa50246.jpg","nickname":"èŠ±æœå±±å¤§åœ£","note":"","ucode":"25C0A36D628037","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546547,"discussion_content":"èµ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642338666,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":330907,"user_name":"tequ1lAneio","can_delete":false,"product_type":"c1","uid":1936087,"ip_address":"","ucode":"41336E87FF2E1A","user_header":"https://static001.geekbang.org/account/avatar/00/1d/8a/d7/daabec34.jpg","comment_is_top":false,"comment_ctime":1642266075,"is_pvip":true,"replies":[{"id":"120833","content":"è¿™éƒ¨åˆ†æºç åœ¨è¿™é‡Œ<br>https:&#47;&#47;github.com&#47;shengxinjing&#47;geektime-vue-course&#47;tree&#47;main&#47;vite-mini","user_name":"ä½œè€…å›å¤","comment_id":330907,"uid":"1003715","ip_address":"","utype":1,"ctime":1642337892,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"10232200667","product_id":100094401,"comment_content":"æœ‰æºç å—ï¼Œä¸€ç›´åœ¨æŠ¥processæœªå®šä¹‰çš„é”™è¯¯","like_count":3,"discussions":[{"author":{"id":1003715,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/50/c3/0aa50246.jpg","nickname":"èŠ±æœå±±å¤§åœ£","note":"","ucode":"25C0A36D628037","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546532,"discussion_content":"è¿™éƒ¨åˆ†æºç åœ¨è¿™é‡Œ\nhttps://github.com/shengxinjing/geektime-vue-course/tree/main/vite-mini","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642337892,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":330961,"user_name":"å´é¢œ","can_delete":false,"product_type":"c1","uid":1159556,"ip_address":"","ucode":"CB5EAFF67BA816","user_header":"https://static001.geekbang.org/account/avatar/00/11/b1/84/d7034d7c.jpg","comment_is_top":false,"comment_ctime":1642326479,"is_pvip":true,"replies":[{"id":"120888","content":"åªå®ç°äº†æ ¸å¿ƒçš„node_moduleä»¥åŠ.vueå’Œcssæ–‡ä»¶çš„è§£æ","user_name":"ä½œè€…å›å¤","comment_id":330961,"uid":"1003715","ip_address":"","utype":1,"ctime":1642384998,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"5937293775","product_id":100094401,"comment_content":"å†™çš„å¤ªç®€å•ï¼Œä½ è¿™ä¹Ÿæ²¡å†™å‡ºä¸€ä¸ªè¿·ä½ çš„viteå•Š","like_count":1,"discussions":[{"author":{"id":1003715,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/50/c3/0aa50246.jpg","nickname":"èŠ±æœå±±å¤§åœ£","note":"","ucode":"25C0A36D628037","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546656,"discussion_content":"åªå®ç°äº†æ ¸å¿ƒçš„node_moduleä»¥åŠ.vueå’Œcssæ–‡ä»¶çš„è§£æ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642384999,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":345901,"user_name":"Geek_07f3c3","can_delete":false,"product_type":"c1","uid":2979036,"ip_address":"","ucode":"658EFEBCEF60DD","user_header":"","comment_is_top":false,"comment_ctime":1652687849,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1652687849","product_id":100094401,"comment_content":"viteæ‰“åŒ…æ—¶æç¤ºåŒ…ä½“ç§¯è¿‡å¤§ï¼Œè¯·é—®åº”è¯¥æ€å‹ç¼©å‘¢æˆ–è€…æ€ä¹ˆåˆ†åŒ…","like_count":0,"discussions":[{"author":{"id":2859387,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTK2ibcQVCzwThRQWhAVVDHjiaaCOXqrYKC2qlM9iaAVrSZcpJmPAPBHoPiapG9pPYbjf4NtvNOVfrLOtw/132","nickname":"MIKE LIU","note":"","ucode":"ADD9672A6D7A80","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":578442,"discussion_content":"è¿™ä¸ªä¹‹å‰é‡åˆ°è¿‡ï¼Œæç¤ºæ‰“åŒ…ä½“ç§¯è¿‡å¤§ï¼Œå¯ä»¥è¯•ç€ä¿®æ”¹warningçš„å¤§å°ï¼Œå½“ç„¶æœ€å¥½çš„æ–¹æ³•å°±æ˜¯æŒ‰éœ€åŠ è½½ç»„ä»¶åº“ã€‚\n\nhttps://cn.vitejs.dev/config/build-options.html\n\nbuild.reportCompressedSize Â¶\nç±»å‹ï¼š boolean\né»˜è®¤ï¼š true\nå¯ç”¨/ç¦ç”¨ gzip å‹ç¼©å¤§å°æŠ¥å‘Šã€‚å‹ç¼©å¤§å‹è¾“å‡ºæ–‡ä»¶å¯èƒ½ä¼šå¾ˆæ…¢ï¼Œå› æ­¤ç¦ç”¨è¯¥åŠŸèƒ½å¯èƒ½ä¼šæé«˜å¤§å‹é¡¹ç›®çš„æ„å»ºæ€§èƒ½ã€‚\n\nbuild.chunkSizeWarningLimit Â¶\nç±»å‹ï¼š number\né»˜è®¤ï¼š 500\nchunk å¤§å°è­¦å‘Šçš„é™åˆ¶ï¼ˆä»¥ kbs ä¸ºå•ä½ï¼‰ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1656753135,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":334702,"user_name":"null","can_delete":false,"product_type":"c1","uid":1464663,"ip_address":"","ucode":"A0C199F5D731C7","user_header":"https://static001.geekbang.org/account/avatar/00/16/59/57/7201d6ce.jpg","comment_is_top":false,"comment_ctime":1645083750,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1645083750","product_id":100094401,"comment_content":"å¼€å‘è¿‡ç¨‹ä¸­å‡ºç°åŠ è½½æ…¢ï¼Œtimeoutã€‚","like_count":0},{"had_liked":false,"id":333364,"user_name":"é€—é€¼ç« é±¼","can_delete":false,"product_type":"c1","uid":1197314,"ip_address":"","ucode":"5E8A5E1CC375B7","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEJfTnE46bP9zFU0MJicYZmKYTPhm97YjgSEmNVKr3ic1BY3CL8ibPUFCBVTqyoHQPpBcbe9GRKEN1CyA/132","comment_is_top":false,"comment_ctime":1644311314,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1644311314","product_id":100094401,"comment_content":"ä»¥å importmap ä¼šå˜æˆä¸»æµå—ï¼Ÿ","like_count":0},{"had_liked":false,"id":331181,"user_name":"Geek_4da4e1","can_delete":false,"product_type":"c1","uid":2815773,"ip_address":"","ucode":"16BDB5EE676AD4","user_header":"","comment_is_top":false,"comment_ctime":1642476007,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1642476007","product_id":100094401,"comment_content":"cssæ–‡ä»¶æ›¿æ¢æ¢è¡Œç¬¦windowsä¸‹ä¸è¡Œï¼Œ&#47;rä¹Ÿæœ‰å¯èƒ½","like_count":0,"discussions":[{"author":{"id":2826309,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/20/45/6c8bb3aa.jpg","nickname":"å°èŠ±ï¼ˆfaï¼‰","note":"","ucode":"7F88A9F990712B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554081,"discussion_content":"windowsä¸‹ cssæ¢è¡Œæ›¿æ¢æ”¹ä¸ºï¼š const css = &#34;${file.replace(/\\r\\n/g, &#39;&#39;)}&#34;","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646207158,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":330937,"user_name":"Chen.Lu","can_delete":false,"product_type":"c1","uid":2646269,"ip_address":"","ucode":"37A6E7DE4441DA","user_header":"https://static001.geekbang.org/account/avatar/00/28/60/fd/c08731d7.jpg","comment_is_top":false,"comment_ctime":1642313375,"is_pvip":false,"replies":[{"id":"120889","content":"æ„Ÿè°¢æé†’  fix  ä¸‹é¢ä¸€å¥å°±è¯´çš„æ˜¯chokidar","user_name":"ä½œè€…å›å¤","comment_id":330937,"uid":"1003715","ip_address":"","utype":1,"ctime":1642385302,"user_name_real":"ç¼–è¾‘"}],"discussion_count":1,"race_medal":0,"score":"1642313375","product_id":100094401,"comment_content":"ã€Vite çƒ­æ›´æ–°ã€‘å°æ¨¡å—ä¸­ chalk æ˜¯å®šä¹‰ log é¢œè‰²çš„å·¥å…·ï¼Œä¸æ˜¯ç›‘å¬æ–‡ä»¶&#47;æ–‡ä»¶å¤¹çš„å·¥å…·å§ã€‚<br>chokidar æ˜¯ç›‘å¬æ–‡ä»¶&#47;æ–‡ä»¶å¤¹çš„å·¥å…·","like_count":0,"discussions":[{"author":{"id":1003715,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/50/c3/0aa50246.jpg","nickname":"èŠ±æœå±±å¤§åœ£","note":"","ucode":"25C0A36D628037","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546658,"discussion_content":"æ„Ÿè°¢æé†’  fix  ä¸‹é¢ä¸€å¥å°±è¯´çš„æ˜¯chokidar","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642385302,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":330107,"user_name":"InfoQ_e521a4ce8a54","can_delete":false,"product_type":"c1","uid":2128328,"ip_address":"","ucode":"6D8988948DD291","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTIkBhCDbibPDmDTEW6Uia1LAEOcFf75QxA897gcL4oXFMOwgsqFwf7rhPoUoJWgICl0xFT8Iz2cuWRg/132","comment_is_top":false,"comment_ctime":1641799935,"is_pvip":false,"replies":[{"id":"120845","content":"ç°åœ¨ä»£ç éƒ½é›†ä¸­æ¨åˆ°è¿™ä¸ªä»“åº“é‡Œ<br>https:&#47;&#47;github.com&#47;shengxinjing&#47;geektime-vue-course","user_name":"ä½œè€…å›å¤","comment_id":330107,"uid":"1003715","ip_address":"","utype":1,"ctime":1642338703,"user_name_real":"ç¼–è¾‘"}],"discussion_count":2,"race_medal":0,"score":"1641799935","product_id":100094401,"comment_content":"ä»[Vite çš„çƒ­æ›´æ–°]å¼€å§‹ï¼Œä»£ç ç‰‡æ®µæ‰€åœ¨çš„æ–‡ä»¶ç›®å½•å’Œæ‰€éœ€çš„ä¾èµ–å°±æä¸æ¸…æ¥šäº†ã€‚ã€‚ã€‚","like_count":0,"discussions":[{"author":{"id":1003715,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/50/c3/0aa50246.jpg","nickname":"èŠ±æœå±±å¤§åœ£","note":"","ucode":"25C0A36D628037","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":546549,"discussion_content":"ç°åœ¨ä»£ç éƒ½é›†ä¸­æ¨åˆ°è¿™ä¸ªä»“åº“é‡Œ\nhttps://github.com/shengxinjing/geektime-vue-course","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1642338703,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1020726,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/93/36/abb7bfe3.jpg","nickname":"Hhpon","note":"","ucode":"12FE37D4B67631","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":585415,"discussion_content":"è¿™ä¸ªä»“åº“é‡Œé¢å¥½åƒå¹¶æ²¡æœ‰viteçƒ­æ›´æ–°çš„å†…å®¹å‘€ğŸ˜‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661520426,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"æ¹–åŒ—"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}