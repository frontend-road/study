{"id":492306,"title":"09 | äº¤å‹ç³»ç»Ÿè®¾è®¡ï¼šå“ªç§åœ°ç†ç©ºé—´é‚»è¿‘ç®—æ³•æ›´å¿«ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ææ™ºæ…§ã€‚</p><p>äº¤å‹ä¸å©šæ‹æ˜¯äººä»¬æœ€åŸºæœ¬çš„éœ€æ±‚ä¹‹ä¸€ã€‚éšç€äº’è”ç½‘æ—¶ä»£çš„ä¸æ–­å‘å±•ï¼Œç§»åŠ¨ç¤¾äº¤è½¯ä»¶å·²ç»æˆä¸ºäº†äººä»¬ç”Ÿæ´»ä¸­å¿…ä¸å¯å°‘çš„ä¸€éƒ¨åˆ†ã€‚ç„¶è€Œï¼Œç†Ÿäººç¤¾äº¤å¹¶ä¸èƒ½å®Œå…¨æ»¡è¶³å¹´è½»äººçš„ç¤¾äº¤ä¸æƒ…æ„Ÿéœ€æ±‚ï¼Œäºæ˜¯é™Œç”Ÿäººäº¤å‹å¹³å°æ‚„ç„¶å…´èµ·ã€‚</p><p>æˆ‘ä»¬å†³å®šå¼€å‘ä¸€æ¬¾åŸºäºåœ°ç†ä½ç½®æœåŠ¡ï¼ˆLBSï¼‰çš„åº”ç”¨ï¼Œä¸ºç”¨æˆ·åŒ¹é…é‚»è¿‘çš„ã€äº’ç›¸æ„Ÿå…´è¶£çš„å¥½å‹ï¼Œåº”ç”¨åç§°ä¸ºâ€œLiaoâ€ã€‚</p><p>Liaoé¢ä¸´çš„æŠ€æœ¯æŒ‘æˆ˜åŒ…æ‹¬ï¼šé¢å¯¹æµ·é‡çš„ç”¨æˆ·ï¼Œå¦‚ä½•ä¸ºå…¶å¿«é€Ÿæ‰¾åˆ°é‚»è¿‘çš„äººï¼Œå¯ä»¥é€‰æ‹©çš„åœ°ç†ç©ºé—´é‚»è¿‘ç®—æ³•æœ‰å“ªäº›ï¼ŸLiaoå¦‚ä½•åœ¨è¿™äº›ç®—æ³•ä¸­é€‰æ‹©å‡ºæœ€åˆé€‚çš„é‚£ä¸ªï¼Ÿ</p><h2>éœ€æ±‚åˆ†æ</h2><p>Liaoçš„å®¢æˆ·ç«¯æ˜¯ä¸€ä¸ªç§»åŠ¨Appï¼Œç”¨æˆ·æ‰“å¼€Appåï¼Œä¸Šä¼ ã€ç¼–è¾‘è‡ªå·±çš„åŸºæœ¬ä¿¡æ¯ï¼Œç„¶åç³»ç»Ÿï¼ˆæ¨èç®—æ³•ï¼‰æ ¹æ®å…¶åœ°ç†ä½ç½®å’Œä¸ªäººä¿¡æ¯ï¼Œä¸ºå…¶æ¨èä½ç½®é‚»è¿‘çš„ç”¨æˆ·ã€‚ç”¨æˆ·åœ¨æ‰‹æœºä¸ŠæŸ¥çœ‹å¯¹æ–¹çš„ç…§ç‰‡å’Œèµ„æ–™ï¼Œå¦‚æœæ„Ÿå…´è¶£ï¼Œå¸Œæœ›è¿›ä¸€æ­¥è”ç³»ï¼Œå°±å‘å³æ»‘åŠ¨ç…§ç‰‡ï¼›å¦‚æœä¸æ„Ÿå…´è¶£ï¼Œå°±å‘å·¦æ»‘åŠ¨ç…§ç‰‡ã€‚</p><p>å¦‚æœä¸¤ä¸ªäººéƒ½å‘å³æ»‘åŠ¨äº†å¯¹æ–¹ï¼Œå°±è¡¨ç¤ºä»–ä»¬äº’ç›¸æ„Ÿå…´è¶£ã€‚ç³»ç»Ÿå°±é€šçŸ¥ä»–ä»¬é…å¯¹æˆåŠŸï¼Œå¹¶ä¸ºä»–ä»¬å¼€å¯èŠå¤©åŠŸèƒ½ï¼Œå¯ä»¥æ›´è¿›ä¸€æ­¥äº†è§£å¯¹æ–¹ï¼Œå†³å®šæ˜¯å¦å»ºç«‹æ›´æ·±å…¥çš„å…³ç³»ã€‚</p><p>Liaoçš„åŠŸèƒ½ç”¨ä¾‹å›¾å¦‚ä¸‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/ea/f3/ea2b93d940d97a069661b2eba296abf3.jpg?wh=1920x1276\" alt=\"å›¾ç‰‡\"></p><p><strong>ç”¨æˆ·è§„æ¨¡åˆ†æ</strong></p><p>Liaoçš„ç›®æ ‡ç”¨æˆ·æ˜¯å…¨çƒèŒƒå›´å†…çš„ä¸­é’å¹´å•èº«ç”·å¥³ï¼Œé¢„ä¼°ç›®æ ‡ç”¨æˆ·è¶…è¿‡10äº¿ï¼Œç³»ç»ŸæŒ‰10äº¿ç”¨æˆ·è¿›è¡Œè®¾è®¡ã€‚</p><!-- [[[read_end]]] --><h2>æ¦‚è¦è®¾è®¡</h2><p>Liaoçš„ç³»ç»Ÿæ¶æ„é‡‡ç”¨å…¸å‹çš„<strong>å¾®æœåŠ¡æ¶æ„</strong>è®¾è®¡æ–¹æ¡ˆï¼Œç”¨æˆ·é€šè¿‡ç½‘å…³æœåŠ¡å™¨è®¿é—®å…·ä½“çš„å¾®æœåŠ¡ï¼Œå¦‚ä¸‹å›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/e0/63/e00ce4d11671abb596561c5103636363.jpg?wh=1920x1276\" alt=\"å›¾ç‰‡\"></p><p>ç”±ä¸Šå›¾å¯çŸ¥ï¼Œé¦–å…ˆï¼Œç”¨æˆ·æ‰€æœ‰è¯·æ±‚éƒ½é€šè¿‡ç»Ÿä¸€çš„<strong>ç½‘å…³æœåŠ¡å™¨</strong>å¤„ç†ã€‚ç½‘å…³æœåŠ¡å™¨è´Ÿè´£é™æµã€é˜²æ”»å‡»ã€ç”¨æˆ·èº«ä»½è¯†åˆ«åŠæƒé™éªŒè¯ã€å¾®æœåŠ¡è°ƒç”¨åŠæ•°æ®èšåˆå°è£…ç­‰ï¼Œè€ŒçœŸæ­£çš„ä¸šåŠ¡é€»è¾‘åˆ™é€šè¿‡è®¿é—®å¾®æœåŠ¡æ¥å®Œæˆã€‚Liaoçš„å…³é”®å¾®æœåŠ¡æœ‰ï¼šç”¨æˆ·å¾®æœåŠ¡ã€å›¾ç‰‡å¾®æœåŠ¡ã€é…å¯¹å¾®æœåŠ¡ã€èŠå¤©å¾®æœåŠ¡ã€æ¨èå¾®æœåŠ¡ã€é‚»è¿‘ç®—æ³•å¾®æœåŠ¡ç­‰ã€‚Liaoçš„ç½‘å…³é¢„è®¡å°†æ‰¿æ‹…æ¯å¤©ç™¾äº¿æ¬¡è§„æ¨¡çš„è®¿é—®å‹åŠ›ã€‚</p><p><strong>ç”¨æˆ·å¾®æœåŠ¡</strong>ç®¡ç†ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ã€å…´è¶£çˆ±å¥½ä»¥åŠäº¤å‹åå¥½ç­‰ï¼Œæ­¤å¤–ä¹Ÿè´Ÿè´£ç”¨æˆ·ç™»å½•æœåŠ¡ï¼Œåªæœ‰ç™»å½•ç”¨æˆ·æ‰èƒ½è®¿é—®ç³»ç»Ÿã€‚å› ä¸ºéœ€è¦å­˜å‚¨åäº¿æ¡ç”¨æˆ·æ•°æ®ï¼Œæ‰€ä»¥ç”¨æˆ·æ•°æ®åº“é‡‡ç”¨åˆ†ç‰‡çš„MySQLæ•°æ®åº“ã€‚</p><p><strong>å›¾ç‰‡å¾®æœåŠ¡</strong>ç”¨äºç®¡ç†ç”¨æˆ·ç…§ç‰‡ï¼Œæä¾›ç”¨æˆ·ç…§ç‰‡å­˜å‚¨åŠå±•ç¤ºçš„åŠŸèƒ½ã€‚Liaoéœ€è¦å­˜å‚¨çš„å›¾ç‰‡æ•°å¤§çº¦å‡ ç™¾äº¿å¼ ã€‚æˆ‘ä»¬ä½¿ç”¨Nginxä½œä¸ºå›¾ç‰‡æœåŠ¡å™¨ï¼Œå›¾ç‰‡æœåŠ¡å™¨å¯ä»¥çº¿æ€§æ‰©å®¹ï¼Œæ¯å†™æ»¡ä¸€å°æœåŠ¡å™¨ï¼ˆåŠå…¶SlaveæœåŠ¡å™¨ï¼‰ï¼Œå°±ç»§ç»­å†™å…¥ä¸‹ä¸€å°æœåŠ¡å™¨ã€‚æœåŠ¡å™¨IPã€å›¾ç‰‡è·¯å¾„åˆ™è®°å½•åœ¨ç”¨æˆ·æ•°æ®åº“ä¸­ã€‚åŒæ—¶ï¼Œè´­ä¹°CDNæœåŠ¡ï¼Œç¼“å­˜çƒ­é—¨çš„ç”¨æˆ·ç…§ç‰‡ã€‚</p><p><strong>é…å¯¹<strong><strong>å¾®</strong></strong>æœåŠ¡</strong>è´Ÿè´£å°†äº’ç›¸å–œæ¬¢çš„ç”¨æˆ·é…å¯¹ï¼Œé€šçŸ¥ç”¨æˆ·ï¼Œå¹¶åŠ å…¥å½¼æ­¤çš„é€šè®¯å½•ä¸­ã€‚ç”¨æˆ·æ¯æ¬¡å³åˆ’æ“ä½œéƒ½è°ƒç”¨è¯¥å¾®æœåŠ¡ã€‚ç³»ç»Ÿè®¾ç½®ä¸€ä¸ªç”¨æˆ·æ¯å¤©å¯ä»¥å–œæ¬¢ï¼ˆå³åˆ’ï¼‰çš„äººæ˜¯æœ‰ä¸Šé™çš„ï¼Œä½†æ˜¯ï¼Œå¯¹äºæ´»è·ƒç”¨æˆ·è€Œè¨€ï¼Œé•¿æœŸç§¯ç´¯ä¸‹æ¥ï¼Œå–œæ¬¢çš„äººçš„æ•°é‡è¿˜æ˜¯éå¸¸å¤§çš„ï¼Œå› æ­¤é…å¯¹å¾®æœåŠ¡ä¼šå°†æ•°æ®å‘é€ç»™ä¸€ä¸ªæµå¼å¤§æ•°æ®å¼•æ“è¿›è¡Œè®¡ç®—ã€‚</p><p><strong>æ¨èå¾®æœåŠ¡</strong>è´Ÿè´£å‘ç”¨æˆ·å±•ç¤ºå…¶å¯èƒ½æ„Ÿå…´è¶£çš„ã€é‚»è¿‘çš„ç”¨æˆ·ã€‚å› æ­¤ï¼Œä¸€æ–¹é¢ï¼Œæ¨èå¾®æœåŠ¡éœ€è¦æ ¹æ®ç”¨æˆ·æ“ä½œã€ä¸ªäººå…´è¶£ã€äº¤å‹åå¥½è°ƒç”¨ååŒè¿‡æ»¤ç­‰æ¨èç®—æ³•è¿›è¡Œæ¨èï¼Œå¦ä¸€æ–¹é¢å¿…é¡»ä¿è¯æ¨èçš„ç”¨æˆ·åœ¨å½“å‰ç”¨æˆ·çš„é™„è¿‘ã€‚</p><h2>è¯¦ç»†è®¾è®¡</h2><p>è¯¦ç»†è®¾è®¡ä¸»è¦å…³æ³¨é‚»è¿‘ä½ç½®ç®—æ³•ï¼Œä¹Ÿå°±æ˜¯ï¼Œå¦‚ä½•æ ¹æ®ç”¨æˆ·çš„åœ°ç†ä½ç½®å¯»æ‰¾è·å…¶ä¸€å®šèŒƒå›´å†…çš„å…¶ä»–ç”¨æˆ·ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡Liao Appè·å–ç”¨æˆ·å½“å‰ç»ã€çº¬åº¦åæ ‡ï¼Œç„¶åæ ¹æ®ç»ã€çº¬åº¦ï¼Œè®¡ç®—ä¸¤ä¸ªç”¨æˆ·ä¹‹é—´çš„è·ç¦»ï¼Œè·ç¦»è®¡ç®—å…¬å¼é‡‡ç”¨åŠæ­£çŸ¢å…¬å¼ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/68/f4/68e7b8215ab87f9b6c631ee9bc0bbbf4.png?wh=562x100\" alt=\"å›¾ç‰‡\"></p><p>å…¶ä¸­ r ä»£è¡¨åœ°çƒåŠå¾„ï¼Œ$\\small \\varphi$è¡¨ç¤ºçº¬åº¦ï¼Œ$\\small \\lambda$è¡¨ç¤ºç»åº¦ã€‚</p><p>ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬æœ‰10äº¿ç”¨æˆ·çš„æ—¶å€™ï¼Œå¦‚æœæ¯æ¬¡è¿›è¡Œå½“å‰ç”¨æˆ·åŒ¹é…éƒ½è¦å’Œå…¶ä»–æ‰€æœ‰ç”¨æˆ·åšä¸€æ¬¡è·ç¦»è®¡ç®—ï¼Œç„¶åå†è¿›è¡Œæ’åºï¼Œé‚£ä¹ˆéœ€è¦çš„è®¡ç®—é‡è‡³å°‘ä¹Ÿæ˜¯åƒäº¿çº§åˆ«ï¼Œè¿™æ ·çš„è®¡ç®—é‡æ˜¯æˆ‘ä»¬ä¸èƒ½æ‰¿å—çš„ã€‚é€šå¸¸çš„ç©ºé—´é‚»è¿‘ç®—æ³•æœ‰ä»¥ä¸‹4ç§ï¼Œæˆ‘ä»¬ä¸€ä¸€è¿›è¡Œåˆ†æï¼Œæœ€ç»ˆé€‰æ‹©å‡ºæœ€åˆé€‚çš„æ–¹æ¡ˆã€‚</p><h4><strong>SQLé‚»è¿‘ç®—æ³•</strong></h4><p>æˆ‘ä»¬å¯ä»¥å°†ç”¨æˆ·ç»ã€çº¬åº¦ç›´æ¥è®°å½•åˆ°æ•°æ®åº“ä¸­ï¼Œçº¬åº¦è®°å½•åœ¨latitudeå­—æ®µï¼Œç»åº¦è®°å½•åœ¨longitudeå­—æ®µï¼Œç”¨æˆ·å½“å‰çš„çº¬åº¦å’Œç»åº¦ä¸ºXï¼ŒYï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦æŸ¥æ‰¾å’Œå½“å‰ç”¨æˆ·ç»ã€çº¬åº¦è·ç¦»Dä¹‹å†…çš„å…¶ä»–ç”¨æˆ·ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹SQLå®ç°ã€‚</p><pre><code class=\"language-sql\">select * from users where latitude between X-D and X+D and longitude between Y-D and Y+D;\n</code></pre><p>è¿™æ ·çš„SQLå®ç°èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯å¦‚æœæœ‰åäº¿ç”¨æˆ·ï¼Œæ•°æ®åˆ†ç‰‡åœ¨å‡ ç™¾å°æœåŠ¡å™¨ä¸Šï¼ŒSQLæ‰§è¡Œæ•ˆç‡å°±ä¼šå¾ˆä½ã€‚è€Œä¸”æˆ‘ä»¬ç”¨ç»ã€çº¬åº¦è·ç¦»è¿›è¡Œè¿‘ä¼¼è®¡ç®—ï¼Œåœ¨é«˜çº¬åº¦åœ°åŒºï¼Œè¿™ç§è¿‘ä¼¼è®¡ç®—çš„åå·®è¿˜æ˜¯éå¸¸å¤§çš„ã€‚</p><p>åŒæ—¶â€œbetween X-D and X+Dâ€ä»¥åŠâ€œbetween Y-D and Y+Dâ€ä¹Ÿä¼šäº§ç”Ÿå¤§é‡ä¸­é—´è®¡ç®—æ•°æ®ï¼Œè¿™ä¸¤ä¸ªbetwenä¼šå…ˆè¿”å›ç»åº¦å’Œçº¬åº¦å„è‡ªåŒºé—´å†…çš„æ‰€æœ‰ç”¨æˆ·ï¼Œå†è¿›è¡Œäº¤é›†andå¤„ç†ï¼Œå¦‚ä¸‹å›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/31/96/31a93a5d2b66f96378996d82bb849596.jpg?wh=1920x904\" alt=\"å›¾ç‰‡\"></p><p>æˆ‘ä»¬çš„ç”¨æˆ·é‡éå¸¸å¤§ï¼Œè€Œè®¡ç®—é‚»è¿‘å¥½å‹åˆæ˜¯ä¸€ä¸ªéå¸¸é«˜é¢‘çš„è®¿é—®ï¼ŒåŒæ—¶ï¼Œåˆ†ç‰‡æ•°æ®åº“è¿›è¡Œé›†åˆè®¡ç®—éœ€è¦åœ¨ä¸­é—´ä»£ç†æœåŠ¡å™¨æˆ–åº”ç”¨ç¨‹åºæœåŠ¡å™¨å®Œæˆè®¡ç®—ï¼Œå› æ­¤ï¼Œè¿™æ ·çš„äº¤é›†è®¡ç®—å¸¦æ¥è®¡ç®—è´Ÿè½½å‹åŠ›æ˜¯æˆ‘ä»¬çš„ç³»ç»Ÿå®Œå…¨ä¸èƒ½æ‰¿å—çš„ã€‚æ‰€ä»¥è¿™ä¸ªæ–¹æ¡ˆå¯ä»¥è¢«æ”¾å¼ƒã€‚</p><h4>åœ°ç†ç½‘æ ¼é‚»è¿‘ç®—æ³•</h4><p>ä¸ºäº†å‡å°‘ä¸Šè¿°äº¤é›†è®¡ç®—ä½¿ç”¨çš„ä¸­é—´æ•°æ®é‡ï¼Œæˆ‘ä»¬å°†æ•´ä¸ªåœ°çƒç”¨ç½‘æ ¼è¿›è¡Œåˆ’åˆ†ï¼Œå¦‚ä¸‹å›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/28/f8/2842ed8c7169608aee44927a627848f8.jpg?wh=1920x714\" alt=\"å›¾ç‰‡\"></p><p>äº‹å®ä¸Šï¼Œæˆ‘ä»¬åˆ’åˆ†çš„ç½‘æ ¼è¿œæ¯”å›¾ä¸­ç¤ºæ„çš„è¦å¯†é›†å¾—å¤šï¼Œèµ¤é“é™„è¿‘ï¼Œç»ã€çº¬åº¦æ–¹å‘æ¯10å…¬é‡Œä¸€ä¸ªç½‘æ ¼ã€‚</p><p>è¿™æ ·æ¯ä¸ªç”¨æˆ·å¿…ç„¶ä¼šè½å…¥åˆ°ä¸€ä¸ªç½‘æ ¼ä¸­ï¼Œæˆ‘ä»¬åœ¨ç”¨æˆ·è¡¨ä¸­è®°å½•ç”¨æˆ·æ‰€åœ¨çš„ç½‘æ ¼IDï¼ˆgridIDï¼‰ï¼Œç„¶åå€ŸåŠ©è¿™ä¸ªå­—æ®µè¿›è¡Œè¾…åŠ©æŸ¥æ‰¾ï¼Œå°†æŸ¥æ‰¾èŒƒå›´é™åˆ¶åœ¨ç”¨æˆ·æ‰€åœ¨çš„ç½‘æ ¼ï¼ˆgridIDx0ï¼‰åŠå…¶å‘¨å›´8ä¸ªç½‘æ ¼ï¼ˆgridIDx1 ~ gridIDx8ï¼‰ä¸­ï¼Œå¯ä»¥æå¤§é™ä½ä¸­é—´æ•°æ®é‡ï¼ŒSQLå¦‚ä¸‹ã€‚</p><pre><code class=\"language-sql\">select * from users where latitude between X-D and X+D and longitude between Y-D and Y+D and gridID in (gridIDx0,gridIDx1,gridIDx2,gridIDx3,gridIDx4,gridIDx5,gridIDx6,gridIDx7,gridIDx8);\n</code></pre><p>è¿™æ¡SQLè¦æ¯”ä¸Šé¢SQLçš„è®¡ç®—è´Ÿè½½å‹åŠ›å°å¾—å¤šï¼Œä½†æ˜¯å¯¹äºé«˜é¢‘è®¿é—®çš„åˆ†ç‰‡æ•°æ®åº“è€Œè¨€ï¼Œç”¨è¿™æ ·çš„SQLè¿›è¡Œé‚»è¿‘å¥½å‹æŸ¥è¯¢ä¾ç„¶æ˜¯ä¸èƒ½æ‰¿å—çš„ï¼ŒåŒæ ·è·ç¦»ç²¾åº¦ä¹Ÿä¸æ»¡è¶³è¦æ±‚ã€‚</p><p>ä½†æ˜¯åŸºäºè¿™ç§ç½‘æ ¼è®¾è®¡æ€æƒ³ï¼Œæˆ‘ä»¬å‘ç°ï¼Œæˆ‘ä»¬å¯ä»¥ä¸é€šè¿‡æ•°æ®åº“å°±èƒ½å®ç°é‚»è¿‘å¥½å‹æŸ¥è¯¢ï¼šæˆ‘ä»¬å¯ä»¥<strong>å°†æ‰€æœ‰çš„ç½‘æ ¼åŠå…¶åŒ…å«çš„ç”¨æˆ·éƒ½è®°å½•åœ¨å†…å­˜ä¸­</strong>ã€‚å½“æˆ‘ä»¬è¿›è¡Œé‚»è¿‘æŸ¥è¯¢æ—¶ï¼Œåªéœ€è¦åœ¨å†…å­˜ä¸­è®¡ç®—ç”¨æˆ·åŠå…¶é‚»è¿‘çš„8ä¸ªç½‘æ ¼å†…çš„æ‰€æœ‰ç”¨æˆ·çš„è·ç¦»å³å¯ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ä¼°ç®—ä¸‹æ‰€æœ‰ç”¨æˆ·ç»ã€çº¬åº¦éƒ½åŠ è½½åˆ°å†…å­˜ä¸­éœ€è¦çš„å†…å­˜é‡ï¼š$\\small 1G\\times3\\times4B=12GB$ï¼ˆç”¨æˆ·IDã€ç»åº¦ã€çº¬åº¦ï¼Œéƒ½é‡‡ç”¨4ä¸ªå­—èŠ‚ç¼–ç ï¼Œæ€»ç”¨æˆ·æ•°1Gï¼‰ã€‚è¿™ä¸ªå†…å­˜é‡æ˜¯å®Œå…¨å¯ä»¥æ¥å—çš„ã€‚</p><p>å®é™…ä¸Šï¼Œé€šè¿‡æ°å½“åœ°é€‰æ‹©ç½‘æ ¼çš„å¤§å°ï¼Œæˆ‘ä»¬ä¸åœè®¿é—®å½“å‰ç”¨æˆ·ä½ç½®å‘¨è¾¹çš„ç½‘æ ¼å°±å¯ä»¥ç”±è¿‘åŠè¿œä¸æ–­å¾—åˆ°é‚»è¿‘çš„å…¶ä»–ç”¨æˆ·ï¼Œè€Œä¸éœ€è¦å†é€šè¿‡SQLæ¥å¾—åˆ°ã€‚é‚£ä¹ˆå¦‚ä½•é€‰æ‹©ç½‘æ ¼å¤§å°ï¼Ÿå¦‚ä½•æ ¹æ®ç”¨æˆ·ä½ç½®å¾—åˆ°å…¶æ‰€åœ¨çš„ç½‘æ ¼ï¼Ÿåˆå¦‚ä½•å¾—åˆ°å½“å‰ç”¨æˆ·ä½ç½®å‘¨è¾¹çš„å…¶ä»–ç½‘æ ¼å‘¢ï¼Ÿæˆ‘ä»¬çœ‹ä¸‹å®è·µä¸­æ›´å¸¸ç”¨çš„åŠ¨æ€ç½‘æ ¼å’ŒGeoHashç®—æ³•ã€‚</p><h4>åŠ¨æ€ç½‘æ ¼ç®—æ³•</h4><p>äº‹å®ä¸Šï¼Œä¸ç®¡å¦‚ä½•é€‰æ‹©ç½‘æ ¼å¤§å°ï¼Œå¯èƒ½éƒ½ä¸åˆé€‚ã€‚å› ä¸ºåœ¨é™†å®¶å˜´å³ä½¿å¾ˆå°çš„ç½‘æ ¼å¯èƒ½å°±åŒ…å«è¿‘ç™¾ä¸‡çš„ç”¨æˆ·ï¼Œè€Œåœ¨å¯å¯è¥¿é‡Œï¼Œéå¸¸å¤§çš„ç½‘æ ¼ä¹ŸåŒ…å«ä¸äº†å‡ ä¸ªç”¨æˆ·ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤ŸåŠ¨æ€è®¾å®šç½‘æ ¼çš„å¤§å°ï¼Œå¦‚æœä¸€ä¸ªç½‘æ ¼å†…ç”¨æˆ·å¤ªå¤šï¼Œå°±æŠŠå®ƒåˆ†è£‚æˆå‡ ä¸ªå°ç½‘æ ¼ï¼Œå°ç½‘æ ¼å†…å¦‚æœç”¨æˆ·è¿˜æ˜¯å¤ªå¤šï¼Œç»§ç»­åˆ†è£‚æ›´å°çš„ç½‘æ ¼ï¼Œå¦‚ä¸‹å›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/a3/21/a35b51bcfe35de5a90a147172aa52021.jpg?wh=1920x1063\" alt=\"å›¾ç‰‡\"></p><p>è¿™æ˜¯ä¸€ä¸ªå››å‰æ ‘ç½‘æ ¼ç»“æ„ï¼Œå¼€å§‹çš„æ—¶å€™æ•´ä¸ªåœ°çƒåªæœ‰ä¸€ä¸ªç½‘æ ¼ï¼Œå½“ç”¨æˆ·å¢åŠ ï¼Œè¶…è¿‡é˜ˆå€¼ï¼ˆ500ä¸ªç”¨æˆ·ï¼‰çš„æ—¶å€™ï¼Œå°±åˆ†è£‚å‡º4ä¸ªå­æ ‘ï¼Œ4ä¸ªå­æ ‘å¯¹åº”çˆ¶èŠ‚ç‚¹ç½‘æ ¼çš„4ä¸ªåœ°ç†å­ç½‘æ ¼ã€‚åŒæ—¶ï¼Œå°†ç”¨æˆ·æ ¹æ®ä½ç½®ä¿¡æ¯é‡æ–°åˆ†é…åˆ°4ä¸ªå­æ ‘ä¸­ã€‚åŒæ ·ï¼Œå¦‚å›¾ä¸­æ‰€ç¤ºï¼Œå¦‚æœæŸä¸ªå­æ ‘ä¸­çš„ç”¨æˆ·å¢åŠ ï¼Œè¶…è¿‡äº†é˜ˆå€¼ï¼Œè¯¥å­æ ‘ç»§ç»­åˆ†è£‚æˆ4ä¸ªå­æ ‘ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¨çƒç”¨æˆ·åˆ†é…åœ¨è¿™æ ·ä¸€ä¸ª4å‰æ ‘ç½‘æ ¼ç»“æ„ä¸­ï¼Œæ‰€æœ‰çš„ç”¨æˆ·éƒ½å¿…ç„¶åœ¨è¿™ä¸ª4å‰æ ‘çš„å¶å­èŠ‚ç‚¹ä¸­ï¼Œè€Œä¸”æ¯ä¸ªèŠ‚ç‚¹å†…åŒ…å«çš„ç”¨æˆ·æ•°ä¸è¶…è¿‡500ä¸ªã€‚é‚£ä¹ˆï¼Œé™†å®¶å˜´çš„ç½‘æ ¼å¯èƒ½å°±ä¼šå¾ˆå°ï¼Œè€Œå¯å¯è¥¿é‡Œçš„ç½‘æ ¼å°±ä¼šå¾ˆå¤§ï¼Œå¤ªå¹³æ´‹å¯¹åº”çš„ç½‘æ ¼å¯èƒ½æœ‰å‡ åƒå…¬é‡Œã€‚</p><p>å½“ç»™å®šå½“å‰ç”¨æˆ·çš„ç»ã€çº¬åº¦ï¼ŒæŸ¥è¯¢é‚»è¿‘ç”¨æˆ·çš„æ—¶å€™ï¼Œé¦–å…ˆä»æ ¹èŠ‚ç‚¹å¼€å§‹æŸ¥æ‰¾ï¼Œå¦‚æœæ ¹èŠ‚ç‚¹å°±æ˜¯å¶å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆç›´æ¥éå†æ ¹èŠ‚ç‚¹ä¸­çš„æ‰€æœ‰ç”¨æˆ·ï¼Œè®¡ç®—è·ç¦»å³å¯ã€‚å¦‚æœæ ¹èŠ‚ç‚¹ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ ¹æ®ç»™å®šçš„ç»ã€çº¬åº¦åˆ¤æ–­å…¶åœ¨ç½‘æ ¼ä¸­çš„ä½ç½®ï¼Œå·¦ä¸Šã€å³ä¸Šã€å³ä¸‹ã€å·¦ä¸‹ï¼Œ4ä¸ªä½ç½®ï¼Œé¡ºåºå¯¹åº”4ä¸ªå­æ ‘ï¼Œæ ¹æ®ç½‘æ ¼ä½ç½®è®¿é—®å¯¹åº”çš„å­æ ‘ã€‚å¦‚æœå­æ ‘æ˜¯å¶å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆåœ¨å¶å­èŠ‚ç‚¹ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œç»§ç»­ä¸Šé¢çš„è¿‡ç¨‹ï¼Œç›´åˆ°å¶å­èŠ‚ç‚¹ã€‚</p><p>ä¸Šé¢çš„è¿‡ç¨‹åªèƒ½æ‰¾åˆ°å½“å‰ç”¨æˆ·æ‰€åœ¨ç½‘æ ¼çš„å¥½å‹ï¼Œå¦‚ä½•æŸ¥æ‰¾é‚»è¿‘ç½‘æ ¼çš„å…¶ä»–ç”¨æˆ·å‘¢ï¼Ÿäº‹å®ä¸Šï¼Œæˆ‘ä»¬åªéœ€è¦å°†4å‰æ ‘æ‰€æœ‰çš„å¶å­èŠ‚ç‚¹é¡ºåºç»„æˆä¸€ä¸ªåŒå‘é“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹åœ¨é“¾è¡¨ä¸Šçš„è‹¥å¹²ä¸ªå‰é©±å’Œåç»§èŠ‚ç‚¹æ­£å¥½å°±æ˜¯å…¶åœ°ç†ä½ç½®é‚»è¿‘çš„èŠ‚ç‚¹ã€‚</p><p>åŠ¨æ€ç½‘æ ¼ä¹Ÿå«4å‰æ ‘ç½‘æ ¼ï¼Œåœ¨ç©ºé—´é‚»è¿‘ç®—æ³•ä¸­è¾ƒä¸ºå¸¸ç”¨ï¼Œä¹Ÿèƒ½æ»¡è¶³Liaoçš„éœ€æ±‚ã€‚ä½†æ˜¯ç¼–ç¨‹å®ç°ç¨ç¨æœ‰ç‚¹éº»çƒ¦ï¼Œè€Œä¸”å¦‚æœç½‘æ ¼å¤§å°è®¾è®¡ä¸åˆé€‚ï¼Œå¯¼è‡´æ ‘çš„é«˜åº¦å¤ªé«˜ï¼Œæ¯æ¬¡æŸ¥æ‰¾éœ€è¦éå†çš„è·¯å¾„å¤ªé•¿ï¼Œæ€§èƒ½ç»“æœä¹Ÿæ¯”è¾ƒå·®ã€‚æˆ‘ä»¬å†çœ‹ä¸‹æ€§èƒ½å’Œçµæ´»æ€§æ›´å¥½çš„GeoHashç®—æ³•ã€‚</p><h4>GeoHashç®—æ³•</h4><p>é™¤äº†åŠ¨æ€ç½‘æ ¼ç®—æ³•ï¼ŒGeoHashäº‹å®ä¸Šæ˜¯å¦å¤–ä¸€ç§å˜å½¢äº†çš„ç½‘æ ¼ç®—æ³•ï¼ŒåŒæ—¶ä¹Ÿæ˜¯Redisä¸­Geoå‡½æ•°ä½¿ç”¨çš„ç®—æ³•ã€‚GeoHashæ˜¯å°†ç½‘æ ¼è¿›è¡Œç¼–ç ï¼Œç„¶åæ ¹æ®ç¼–ç è¿›è¡ŒHashå­˜å‚¨çš„ä¸€ç§ç®—æ³•ã€‚</p><p>ç»ã€çº¬åº¦æ•°å­—çš„ä¸åŒç²¾åº¦ï¼Œæ„å‘³ç€ç»ã€çº¬åº¦çš„è¯¯å·®èŒƒå›´ï¼Œæ¯”å¦‚ä¿ç•™ç»ã€çº¬åº¦åˆ°å°æ•°ç‚¹åç¬¬1ä½ï¼Œé‚£ä¹ˆè¯¯å·®èŒƒå›´æœ€å¤§å¯èƒ½ä¼šè¾¾åˆ°11å…¬é‡Œï¼ˆåœ¨èµ¤é“é™„è¿‘ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå°æ•°ç‚¹å1ä½ç²¾åº¦çš„ç»ã€çº¬åº¦ï¼Œå…¶è¦†ç›–èŒƒå›´æ˜¯ä¸€ä¸ª11km * 11kmçš„ç½‘æ ¼ã€‚</p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬ç”¨å°æ•°ç‚¹å1ä½ç²¾åº¦çš„ç»ã€çº¬åº¦åškeyï¼Œç½‘æ ¼å†…çš„ç”¨æˆ·é›†åˆåšvalueï¼Œå°±å¯ä»¥æ„å»ºä¸€ä¸ªHashè¡¨çš„&lt;key, value&gt;å¯¹ã€‚é€šè¿‡æŸ¥æ‰¾è¿™ä¸ªKVå¯¹åŠå…¶å‘¨å›´8ä¸ªç½‘æ ¼çš„KVå¯¹ï¼Œè®¡ç®—è¿™äº›valueå†…æ‰€æœ‰ç”¨æˆ·å’Œå½“å‰ç”¨æˆ·çš„è·ç¦»ï¼Œå°±å¯ä»¥æ‰¾åˆ°é‚»è¿‘11å…¬é‡Œå†…çš„æ‰€æœ‰ç”¨æˆ·ã€‚</p><p>å®è·µä¸­ï¼Œredisçš„GeoHashå¹¶ä¸ä¼šç›´æ¥ç”¨ç»ã€çº¬åº¦åškeyï¼Œè€Œæ˜¯é‡‡ç”¨ä¸€ç§åŸºäºZé˜¶æ›²çº¿çš„ç¼–ç æ–¹å¼ï¼Œå°†äºŒç»´çš„ç»ã€çº¬åº¦ï¼Œè½¬åŒ–ä¸ºä¸€ç»´çš„äºŒè¿›åˆ¶æ•°å­—ï¼Œå†è¿›è¡Œbase32ç¼–ç ï¼Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹ã€‚</p><p>é¦–å…ˆï¼Œåˆ†åˆ«é’ˆå¯¹ç»åº¦å’Œçº¬åº¦ï¼Œæ±‚å–å½“å‰åŒºé—´ï¼ˆå¯¹äºçº¬åº¦è€Œè¨€ï¼Œå¼€å§‹çš„åŒºé—´å°±æ˜¯[-90, 90], å¯¹äºç»åº¦è€Œè¨€ï¼Œå¼€å§‹åŒºé—´å°±æ˜¯[-180, 180]ï¼‰çš„å¹³å‡å€¼ï¼Œå°†å½“å‰åŒºé—´åˆ†ä¸ºä¸¤ä¸ªåŒºé—´ã€‚ç„¶åç”¨ç”¨æˆ·çš„ç»ã€çº¬åº¦å’ŒåŒºé—´å¹³å‡å€¼è¿›è¡Œæ¯”è¾ƒï¼Œç”¨æˆ·ç»ã€çº¬åº¦å¿…ç„¶è½åœ¨ä¸¤ä¸ªåŒºé—´ä¸­çš„ä¸€ä¸ªï¼Œå¦‚æœå¤§äºå¹³å‡å€¼ï¼Œé‚£ä¹ˆå–1ï¼Œå¦‚æœå°äºå¹³å‡å€¼ï¼Œé‚£ä¹ˆå–0ã€‚ç»§ç»­æ±‚å–å½“å‰åŒºé—´çš„å¹³å‡å€¼ï¼Œè¿›ä¸€æ­¥å°†å½“å‰åŒºé—´åˆ†ä¸ºä¸¤ä¸ªåŒºé—´ã€‚å¦‚æ­¤ä¸æ–­é‡å¤ï¼Œå¯ä»¥åœ¨ç»åº¦å’Œçº¬åº¦æ–¹å‘ä¸Šï¼Œå¾—åˆ°ä¸¤ä¸ªäºŒè¿›åˆ¶æ•°ã€‚è¿™ä¸ªäºŒè¿›åˆ¶æ•°è¶Šé•¿ï¼Œå…¶æ‰€åœ¨çš„åŒºé—´è¶Šå°ï¼Œç²¾åº¦è¶Šé«˜ã€‚</p><p>ä¸‹å›¾è¡¨ç¤ºç»ã€çº¬åº¦&lt;42.60411, -5.59041&gt;çš„äºŒè¿›åˆ¶ç¼–ç è¿‡ç¨‹ï¼Œæœ€ç»ˆå¾—åˆ°çº¬åº¦12ä½ç¼–ç ï¼Œç»åº¦13ä½ç¼–ç ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/f5/e2/f507bf873cb55401667e4dddc30fe5e2.png?wh=535x407\" alt=\"å›¾ç‰‡\"></p><p><img src=\"https://static001.geekbang.org/resource/image/72/ff/72bacbfce48d93bf4c7ebc70c6c2f9ff.png?wh=554x433\" alt=\"å›¾ç‰‡\"></p><p>å¾—åˆ°ä¸¤ä¸ªäºŒè¿›åˆ¶æ•°åï¼Œå†å°†å®ƒä»¬åˆå¹¶æˆä¸€ä¸ªäºŒè¿›åˆ¶æ•°ã€‚åˆå¹¶è§„åˆ™æ˜¯ï¼Œä»ç¬¬ä¸€ä½å¼€å§‹ï¼Œå¥‡æ•°ä½ä¸ºç»åº¦ï¼Œå¶æ•°ä½ä¸ºçº¬åº¦ï¼Œä¸Šé¢ä¾‹å­åˆå¹¶åçš„ç»“æœä¸º 01101&nbsp;11111&nbsp;11000&nbsp;00100&nbsp;00010 ï¼Œå…±25ä½äºŒè¿›åˆ¶æ•°ã€‚</p><p>å°†25ä½äºŒè¿›åˆ¶æ•°åˆ’åˆ†æˆ5ç»„ï¼Œæ¯ç»„5ä¸ªäºŒè¿›åˆ¶æ•°ï¼Œå¯¹åº”çš„10è¿›åˆ¶æ•°æ˜¯0-31ï¼Œé‡‡ç”¨Base32ç¼–ç ï¼Œå¯ä»¥å¾—åˆ°ä¸€ä¸ª5ä½å­—ç¬¦ä¸²ï¼ŒBase32ç¼–ç è¡¨å¦‚ä¸‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/8d/7e/8d8cf88e9a9e5645b2e7cfe9d5c2057e.png?wh=517x130\" alt=\"å›¾ç‰‡\"></p><p>ç¼–ç è®¡ç®—è¿‡ç¨‹å¦‚ä¸‹ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/36/cb/367b8eb29043415710a01a2cf752e0cb.png?wh=204x133\" alt=\"å›¾ç‰‡\"></p><p>æœ€åå¾—åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²â€œezs42â€ï¼Œä½œä¸ºHashè¡¨çš„keyã€‚25ä½äºŒè¿›åˆ¶çš„GeoHashç¼–ç ï¼Œå…¶è¯¯å·®èŒƒå›´å¤§æ¦‚2.4å…¬é‡Œï¼Œå³å¯¹åº”ä¸€ä¸ª$\\small 2.4km\\times2.4km$çš„ç½‘æ ¼ã€‚ç½‘æ ¼å†…çš„ç”¨æˆ·éƒ½ä½œä¸ºvalueæ”¾å…¥åˆ°Hashè¡¨ä¸­ã€‚</p><p>ä¸€èˆ¬è¯´æ¥ï¼Œé€šè¿‡é€‰æ‹©GeoHashçš„ç¼–ç é•¿åº¦ï¼Œå®ç°ä¸åŒå¤§å°çš„ç½‘æ ¼ï¼Œå°±å¯ä»¥æ»¡è¶³æˆ‘ä»¬é‚»è¿‘äº¤å‹çš„åº”ç”¨åœºæ™¯äº†ã€‚ä½†æ˜¯åœ¨Redisä¸­ï¼Œéœ€è¦é¢å¯¹æ›´é€šç”¨çš„åœ°ç†ä½ç½®è®¡ç®—åœºæ™¯ï¼Œæ‰€ä»¥Redisä¸­çš„GeoHashå¹¶æ²¡æœ‰ç”¨Hashè¡¨å­˜å‚¨ï¼Œè€Œæ˜¯ç”¨è·³è¡¨å­˜å‚¨ã€‚</p><p>Redisä½¿ç”¨52ä½äºŒè¿›åˆ¶çš„GeoHashç¼–ç ï¼Œè¯¯å·®èŒƒå›´0.6ç±³ã€‚Rediså°†ç¼–ç åçš„äºŒè¿›åˆ¶æ•°æŒ‰ç…§Zé˜¶æ›²çº¿çš„å¸ƒå±€ï¼Œè¿›è¡Œä¸€ç»´åŒ–å±•å¼€ã€‚å³å°†äºŒç»´çš„ç»ã€çº¬åº¦ä¸Šçš„ç‚¹ï¼Œç”¨ä¸€æ¡Zå‹æ›²çº¿è¿æ¥èµ·æ¥ï¼ŒZé˜¶æ›²çº¿å¸ƒå±€ç¤ºä¾‹å¦‚ä¸‹å›¾ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/67/2b/67fd93a5157f207721a1c493bf70d12b.png?wh=800x787\" alt=\"å›¾ç‰‡\"></p><p>äº‹å®ä¸Šï¼Œæ‰€è°“çš„Zé˜¶æ›²çº¿å¸ƒå±€ï¼Œæœ¬è´¨å…¶å®å°±æ˜¯åŸºäºGeoHashçš„äºŒè¿›åˆ¶æ’åºã€‚å°†è¿™äº›ç»è¿‡ç¼–ç çš„2è¿›åˆ¶æ•°æ®ç”¨è·³è¡¨å­˜å‚¨ã€‚æŸ¥æ‰¾ç”¨æˆ·çš„æ—¶å€™ï¼Œå¯ä»¥å¿«é€Ÿæ‰¾åˆ°è¯¥ç”¨æˆ·ï¼Œæ²¿ç€è·³è¡¨å‰åæ£€ç´¢ï¼Œå¾—åˆ°çš„å°±æ˜¯é‚»è¿‘çš„ç”¨æˆ·ã€‚</p><h4>Liaoçš„æœ€ç»ˆç®—æ³•é€‰æ‹©</h4><p>Liaoçš„é‚»è¿‘ç®—æ³•æœ€ç»ˆé€‰æ‹©ä½¿ç”¨Hashè¡¨å­˜å‚¨çš„GeoHashç®—æ³•ï¼Œç»åº¦é‡‡ç”¨13bitç¼–ç ï¼Œçº¬åº¦é‡‡ç”¨12bitç¼–ç ï¼Œå³æœ€åçš„GeoHashç¼–ç 5ä¸ªå­—ç¬¦ï¼Œæ¯ä¸ªç½‘æ ¼$\\small 4.9km\\times4.9km\\approx 25km^{2}$ï¼Œå°†æ•´ä¸ªåœ°çƒåˆ†ä¸º$\\small 2^{25}\\approx3300ä¸‡$ä¸ªç½‘æ ¼ï¼Œå»æ‰æµ·æ´‹å’Œå‡ ä¹æ— äººç”Ÿå­˜çš„è’æ¼ æåœ°ï¼Œéœ€è¦å­˜å‚¨çš„Hashé”®ä¸åˆ°500ä¸‡ä¸ªï¼Œé‡‡ç”¨Hashè¡¨å­˜å‚¨ã€‚Hashè¡¨çš„keyæ˜¯GeoHashç¼–ç ï¼Œvalueæ˜¯ä¸€ä¸ªListï¼Œå…¶ä¸­åŒ…å«äº†æ‰€æœ‰ç›¸åŒGeoHashç¼–ç çš„ç”¨æˆ·IDã€‚</p><p>æŸ¥æ‰¾é‚»è¿‘å¥½å‹çš„æ—¶å€™ï¼ŒLiaoå°†å…ˆè®¡ç®—ç”¨æˆ·å½“å‰ä½ç½®çš„GeoHashå€¼ï¼ˆ5ä¸ªå­—ç¬¦ï¼‰ï¼Œç„¶åä»Hashè¡¨ä¸­è¯»å–è¯¥Hashå€¼å¯¹åº”çš„æ‰€æœ‰ç”¨æˆ·ï¼Œå³åœ¨åŒä¸€ä¸ªç½‘æ ¼å†…çš„ç”¨æˆ·ï¼Œè¿›è¡ŒåŒ¹é…ï¼Œå°†æ»¡è¶³åŒ¹é…æ¡ä»¶çš„å¯¹è±¡è¿”å›ç»™ç”¨æˆ·ã€‚å¦‚æœä¸€ä¸ªç½‘æ ¼å†…åŒ¹é…çš„å¯¹è±¡æ•°é‡ä¸è¶³ï¼Œè®¡ç®—å‘¨å›´8ä¸ªç½‘æ ¼çš„GeoHashå€¼ï¼Œè¯»å–è¿™äº›Hashå€¼å¯¹åº”çš„ç”¨æˆ·åˆ—è¡¨ï¼Œç»§ç»­åŒ¹é…ã€‚</p><h2>å°ç»“</h2><p>ç®—æ³•æ˜¯è½¯ä»¶ç¼–ç¨‹ä¸­æœ€æœ‰æŠ€æœ¯æŒ‘æˆ˜æ€§ï¼Œä¹Ÿæœ€èƒ½è€ƒéªŒä¸€ä¸ªäººç¼–ç¨‹èƒ½åŠ›çš„é¢†åŸŸã€‚æ‰€ä»¥å¾ˆå¤šä¼ä¸šé¢è¯•çš„æ—¶å€™ç‰¹åˆ«å–œæ¬¢é—®ç®—æ³•ç±»çš„é—®é¢˜ï¼Œå³ä½¿è¿™äº›ç®—æ³•å’Œå°†æ¥çš„å·¥ä½œå†…å®¹å…³ç³»ä¸å¤§ï¼Œé¢è¯•å®˜ä¹Ÿå¯ä»¥å‡­å€Ÿè¿™äº›é—®é¢˜å¯¹å€™é€‰äººçš„ä¸“ä¸šèƒ½åŠ›å’Œæ™ºåŠ›æ°´å¹³è¿›è¡Œè¯„åˆ¤ï¼Œè€Œä¸”è¶Šæ˜¯å¤§å‚çš„é¢è¯•è¶Šæ˜¯å¦‚æ­¤ã€‚</p><p>æ¶æ„å’Œç®—æ³•é€šå¸¸æ˜¯ä¸€ä¸ªå¤æ‚ç³»ç»Ÿçš„ä¸€ä½“ä¸¤é¢ï¼Œæ¶æ„æ˜¯å…³äºæ•´ä½“ç³»ç»Ÿæ˜¯å¦‚ä½•ç»„ç»‡èµ·æ¥çš„ï¼Œè€Œç®—æ³•åˆ™æ˜¯å…³äºæ ¸å¿ƒåŠŸèƒ½å¦‚ä½•å¤„ç†çš„ã€‚æˆ‘ä»¬ä¸“æ å¤§å¤šæ•°æ¡ˆä¾‹ä¹Ÿéƒ½ä½“ç°äº†è¿™ç§ä¸€ä½“ä¸¤é¢ï¼Œå¾ˆå¤šæ¡ˆä¾‹è®¾è®¡éƒ½æœ‰ä¸€ä¸¤ä¸ªæ ¸å¿ƒç®—æ³•ï¼Œæ¯”å¦‚çŸ­URLç”Ÿæˆä¸é¢„åŠ è½½ç®—æ³•ã€ç¼©ç•¥å›¾ç”Ÿæˆä¸æ¨èç®—æ³•ã€æœ¬ç¯‡çš„ç©ºé—´é‚»è¿‘ç®—æ³•ä»¥åŠä¸‹ä¸€ç¯‡è¦è®²çš„å€’æ’ç´¢å¼•ä¸PageRankç®—æ³•ï¼Œéƒ½å±•ç°äº†è¿™ä¸€ç‚¹ã€‚</p><p>ä¸€ä¸ªåˆæ ¼çš„æ¶æ„å¸ˆé™¤äº†è¦æŒæ¡ç³»ç»Ÿçš„æ•´ä½“æ¶æ„ï¼Œä¹Ÿè¦èƒ½æŠŠæ¡ä½è¿™äº›å…³é”®çš„ç®—æ³•ï¼Œæ‰èƒ½åœ¨ç³»ç»Ÿçš„è®¾è®¡å’Œå¼€å‘ä¸­åšåˆ°å¿ƒä¸­æœ‰æ•°ã€æ§åˆ¶è‡ªå¦‚ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ¬æ–‡çš„è®¾è®¡èšç„¦åœ¨é‚»è¿‘ç®—æ³•ä¸Šï¼Œæ‰€ä»¥å¿½ç•¥äº†å¸¸è§„çš„TPSã€å¸¦å®½è´Ÿè½½ã€å­˜å‚¨ç©ºé—´ç­‰æ€§èƒ½æŒ‡æ ‡ï¼Œä½ èƒ½å¦ä¼°è®¡ä¸‹è¿™äº›æ€§èƒ½æŒ‡æ ‡ï¼Ÿ</p><p>æ¬¢è¿åœ¨è¯„è®ºåŒºåˆ†äº«ä½ çš„æ€è€ƒï¼Œæˆ–è€…æå‡ºå¯¹è¿™ä¸ªè®¾è®¡æ–‡æ¡£çš„è¯„å®¡æ„è§ï¼Œæˆ‘ä»¬å…±åŒè¿›æ­¥ã€‚</p>","comments":[{"had_liked":false,"id":337123,"user_name":"Geek_7347cf","can_delete":false,"product_type":"c1","uid":2343516,"ip_address":"","ucode":"2E25574FAB1B3B","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/mmTEibMibic5ibsVpNZkR3HBlpPpZYt0gHGdIqOduLGxRHZpTWRG3q56CT1eejoLgNsdaW5aQGWXfyibN4vm9CicYb3w/132","comment_is_top":false,"comment_ctime":1646636911,"is_pvip":false,"replies":[{"id":"123202","content":"ç”¨æˆ·æ‰“å¼€Appçš„æ—¶å€™ï¼Œæ›´æ–°æ•°æ®ï¼šåˆ é™¤æ—§çš„ä½ç½®hash keyçš„ç”¨æˆ·ï¼Œæ·»åŠ åˆ°æ–°çš„ä½ç½®hash keyã€‚æ‰€ä»¥åº”ç”¨è¿˜éœ€è¦è®°å½•é”®å€¼å¯¹ï¼šç”¨æˆ·-&gt;ä½ç½®ã€‚<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1007349","ctime":1646644007,"ip_address":"","comment_id":337123,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27416440687","product_id":100105701,"comment_content":"äº‹å®ä¸Šç”¨æˆ·æ˜¯ä¼šè‡ªä¸»è¡Œèµ°çš„ ï¼Œå½“ç”¨æˆ·åœ°ç†ç©ºé—´å‘ç”Ÿç§»åŠ¨æ—¶ï¼Œå¦‚ä½•æ›´æ–°æ•°æ®å‘¢","like_count":7,"discussions":[{"author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554871,"discussion_content":"ç”¨æˆ·æ‰“å¼€Appçš„æ—¶å€™ï¼Œæ›´æ–°æ•°æ®ï¼šåˆ é™¤æ—§çš„ä½ç½®hash keyçš„ç”¨æˆ·ï¼Œæ·»åŠ åˆ°æ–°çš„ä½ç½®hash keyã€‚æ‰€ä»¥åº”ç”¨è¿˜éœ€è¦è®°å½•é”®å€¼å¯¹ï¼šç”¨æˆ·-&gt;ä½ç½®ã€‚\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646644007,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337189,"user_name":"ğŸ‘½","can_delete":false,"product_type":"c1","uid":1274117,"ip_address":"","ucode":"D313AF941B412D","user_header":"https://static001.geekbang.org/account/avatar/00/13/71/05/db554eba.jpg","comment_is_top":false,"comment_ctime":1646667654,"is_pvip":false,"replies":[{"id":"123231","content":"èµï¼Œæ€è·¯å¾ˆæ¸…æ™°","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1007349","ctime":1646702992,"ip_address":"","comment_id":337189,"utype":1}],"discussion_count":1,"race_medal":0,"score":"18826536838","product_id":100105701,"comment_content":"ç›®æ ‡ç”¨æˆ·10äº¿<br>é¢„ä¼°æ—¥æ´»10%=1äº¿ï¼Œæœˆæ´»20%=2äº¿<br><br>TPSï¼šæ¯ä¸ªç”¨æˆ·ï¼Œæ²¡å¤©æ»‘åŠ¨10ä¸ªç›®æ ‡ç”¨æˆ·ã€‚1äº¿*10=10äº¿ã€‚<br>äº’ç›¸å‘é€æ¶ˆæ¯20æ¡ã€‚1äº¿*2*20=40äº¿ã€‚<br>TPS=50äº¿&#47;86400<br><br>å‡è®¾åŒæ—¶åœ¨çº¿ç”¨æˆ·ï¼Œé¢„ä¼°5%=500ä¸‡<br><br>å¸¦å®½ï¼šç”±äºæ–‡å­—å ç”¨çš„å¸¦å®½æå°ï¼Œä¸ªäººè®¤ä¸ºï¼Œå¯å¿½ç•¥ä¸è®¡ã€‚ä¸»è¦å ç”¨å¸¦å®½çš„èµ„æºä¸ºå›¾ç‰‡èµ„æºã€‚<br>å¹³å‡æ¯ä¸ªç”¨æˆ·ï¼Œå‘é€5å¼ å›¾ç‰‡è¡¨æƒ…åŒ…ã€‚å…¶ä¸­2å¼ æ–°å¢ï¼Œ3å¼ æœåŠ¡å™¨ä¿å­˜ã€‚ä¸€å¼ è¡¨æƒ…åŒ…100kbã€‚<br>å‡è®¾åŒæ—¶æŠ¤å‘å›¾ç‰‡çš„ç”¨æˆ·10%=50ä¸‡ã€‚å¸¦å®½=50ä¸‡*2*100kbã€‚<br>å¦‚æœåº”ç”¨å…è®¸äº’ç›¸å‘é€è§†é¢‘ï¼ŒéŸ³é¢‘ï¼Œæ–‡ä»¶ï¼Œåˆ™å¦å¤–è®¡ç®—ã€‚<br><br>å­˜å‚¨ï¼šåŸºäºä¸Šé¢çš„é¢„ä¼°ç»“æœã€‚å›¾ç‰‡ç­‰é™æ€èµ„æºéœ€è¦åœ¨æœåŠ¡å™¨ä¿å­˜7å¤©ï¼Œæ—¥æ´»1äº¿*æ¯ä¸ªç”¨æˆ·æ¯å¤©2å¼ æ–°å¢å›¾ç‰‡ã€‚7å¤©å›¾ç‰‡å­˜å‚¨=1äº¿*2*100k*7<br>å¹¶ä¸”åŒæ—¶ï¼Œå…è®¸æ¯ä¸ªç”¨æˆ·æ”¶è—100ä¸ªé™æ€èµ„æºï¼ˆé¢„ä¼°å¹³å‡ä½¿ç”¨ç‡10%ï¼‰ã€‚ä½†æ˜¯éœ€è¦è€ƒè™‘èµ„æºçš„é‡å¤æ€§ï¼Œå‡è®¾70%ä¸ºé‡å¤èµ„æºã€‚æ”¶è—èµ„æºå­˜å‚¨=10äº¿*10%*30%*100kã€‚<br>ç”±äºæ˜¯ç¤¾äº¤å¹³å°ï¼Œå¹³å‡æ¯ä¸ªç”¨æˆ·é™¤äº†å¤´åƒå¤–ï¼Œå­˜åœ¨1-9å¼ é«˜è´¨é‡ç…§ç‰‡ã€‚è¯¥ç…§ç‰‡ç´ è´¨ä¸ºåº”ç”¨å–ç‚¹ï¼Œæ‰€ä»¥ä¸åšè¿‡åº¦å‹ç¼©ã€‚é¢„è®¡ä¸€å¼ å›¾ç‰‡1mbã€‚å¹³å‡ä½¿ç”¨3å¼ é«˜è´¨é‡å›¾ç‰‡èµ„æºã€‚ç”¨æœˆæ´» 20äº¿*3*1mbã€‚è¡¥å……ï¼šè¿™ä¸ªå›¾ç‰‡çš„ä¸Šä¼ å’Œè®¿é—®ä¹Ÿéœ€è¦æ”¾åœ¨å¸¦å®½çš„è®¡ç®—ä¸Šé¢ã€‚<br><br>è¿™äº›ä¼°ç®—è‚¯å®šä¸ä¸¥è°¨ï¼Œåªæ˜¯å•çº¯åˆ—ä¸€ä¸‹ä¼°ç®—çš„æ€è·¯ã€‚","like_count":4,"discussions":[{"author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554965,"discussion_content":"èµï¼Œæ€è·¯å¾ˆæ¸…æ™°","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646702992,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337080,"user_name":"peter","can_delete":false,"product_type":"c1","uid":1058183,"ip_address":"","ucode":"261C3FC001DE2D","user_header":"https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg","comment_is_top":false,"comment_ctime":1646613776,"is_pvip":true,"replies":[{"id":"123200","content":"1 ç½‘å…³å‰åº”è¯¥æœ‰è´Ÿè½½å‡è¡¡ï¼Œæ–‡ä¸­ç®€åŒ–çœç•¥äº†ã€‚spring+nginxæ˜¯æ­£ç¡®ç”¨æ³•<br><br>2 å¾®æœåŠ¡å¯ä»¥å…±ç”¨dbï¼Œdbç‹¬ç«‹çš„ä¸»è¦è€ƒè™‘æ˜¯ä¸ºäº†é™ä½è´Ÿè½½å‹åŠ›ã€‚<br><br>3 javaå’Œredisä¸ä¼šåœ¨ä¸€ä¸ªæœºå™¨ä¸Šï¼Œå¾®æœåŠ¡æ¶æ„ä¸‹å°¤å…¶ä¸ä¼šã€‚PSï¼šæ–‡ä¸­ç®—æ³•ç”¨redisï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ç”¨redisçš„geoå‡½æ•°ã€‚<br><br>4 æ˜¯çš„<br><br>5 -5.5æ˜¯ç»åº¦longitudeï¼Œæ˜¯0ã€‚æ–‡ä¸­ç»ã€çº¬åº¦çš„å«æ³•æ˜¯äººä»¬ä¹ æƒ¯å«æ³•ï¼›äºŒå…ƒç»„&lt;43.60411, -5.59041&gt; å†™æ³•ï¼Œçº¬åº¦åœ¨å‰ï¼Œç»åº¦åœ¨åï¼Œæ˜¯ç»çº¬åº¦çš„ä¹ æƒ¯å†™æ³•ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":"1007349","ctime":1646643848,"ip_address":"","comment_id":337080,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10236548368","product_id":100105701,"comment_content":"è¯·æ•™è€å¸ˆå‡ ä¸ªé—®é¢˜å•Šï¼š<br>Q1ï¼šç½‘å…³å¯ä»¥æ˜¯æœ€å¤–å±‚å—ï¼Ÿ<br>æœ¬æ–‡ä¸­çš„æ¶æ„å›¾ï¼Œè¯·æ±‚ç›´æ¥åˆ°ç½‘å…³ï¼Œç½‘å…³åœ¨æœ€å¤–å±‚ï¼Œè¿™å¯ä»¥å—ï¼Ÿ<br>å¾®æœåŠ¡å¼€å‘ï¼Œç°åœ¨ä¸€èˆ¬ç”¨springcloud,å…¶ç½‘å…³æ˜¯spring gateway,å¯ä»¥è®©è¯·æ±‚ç›´æ¥åˆ°spring gatewayå—ï¼Ÿï¼ˆæœ‰çš„è¯´æœ€å¥½ä¸è¦è®©spring gatewayåœ¨æœ€å¤–é¢ï¼Œå…¶å‰é¢æœ€å¥½åŠ ä¸€ä¸ªnginxï¼‰ã€‚<br>Q2ï¼šæ¯ä¸ªå¾®æœåŠ¡ç”¨è‡ªå·±ç‹¬ç«‹çš„DBå—ï¼Ÿ<br>æœ¬æ–‡ä¸­çš„æ¶æ„å›¾ï¼Œæœ‰å‡ ä¸ªå¾®æœåŠ¡å…±ç”¨äº†ä¸€ä¸ªDBã€‚ä½†æœ‰çš„è¯´â€œå¾®æœåŠ¡ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼ŒDBä¹Ÿç›¸äº’ç‹¬ç«‹ï¼Œå³ä¸€ä¸ªå¾®æœåŠ¡ç”¨ä¸€ä¸ªDBâ€ã€‚è¯·é—®ï¼Œå…·ä½“è¯¥æ€ä¹ˆåšï¼Ÿ<br>Q3ï¼šç®—æ³•å¾®æœåŠ¡ç”¨rediså—ï¼Ÿ<br>æ–‡ä¸­çš„ç®—æ³•å¾®æœåŠ¡éœ€è¦ç”¨redisçš„geoå‡½æ•°ï¼Œé‚£ä¹ˆï¼Œç®—æ³•å¾®æœåŠ¡æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ æ˜¯é‡‡ç”¨â€œjavaä»£ç  + redisâ€å—ï¼Ÿï¼ˆå³åˆ›å»ºä¸€ä¸ªjavaå¾®æœåŠ¡ï¼Œè¿è¡Œåœ¨ä¸€å°æœºå™¨ä¸Šï¼ŒåŒæ—¶åœ¨è¿™å°æœºå™¨ä¸Šéƒ¨ç½²redisï¼‰<br>Q4ï¼šç½‘æ ¼å†…è·ç¦»è®¡ç®—ç”¨ä»€ä¹ˆï¼Ÿ<br>æœ€å¥½ç¼©å°åˆ°ä¸€ä¸ªç½‘æ ¼å†…çš„æ—¶å€™ï¼Œç”¨æˆ·æ•°å¤§çº¦500ï¼Œæ­¤æ—¶è®¡ç®—è·ç¦»æ˜¯ç”¨åŠæ­£çŸ¢å…¬å¼å…¬å¼å—ï¼Ÿ<br>Q5ï¼šçº¬åº¦ä¸ºè´Ÿå€¼ï¼Œæ€ä¹ˆçº¬åº¦çš„ç¬¬ä¸€ä¸ªbitä¸º1ï¼Ÿ<br>â€œç»ã€çº¬åº¦ &lt;43.60411, -5.59041&gt; çš„äºŒè¿›åˆ¶ç¼–ç è¿‡ç¨‹â€ï¼Œçº¬åº¦æ˜¯-5.5ï¼Œæ˜¯ä¸€ä¸ªè´Ÿå€¼ï¼Œç¬¬ä¸€æ¬¡è®¡ç®—ï¼Œå¹³å‡å€¼æ˜¯0ï¼Œ-5.5å°äº0å•Šï¼Œæ€ä¹ˆç®—å‡ºæ¥æ˜¯1ï¼Ÿ","like_count":2,"discussions":[{"author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":554869,"discussion_content":"1 ç½‘å…³å‰åº”è¯¥æœ‰è´Ÿè½½å‡è¡¡ï¼Œæ–‡ä¸­ç®€åŒ–çœç•¥äº†ã€‚spring+nginxæ˜¯æ­£ç¡®ç”¨æ³•\n\n2 å¾®æœåŠ¡å¯ä»¥å…±ç”¨dbï¼Œdbç‹¬ç«‹çš„ä¸»è¦è€ƒè™‘æ˜¯ä¸ºäº†é™ä½è´Ÿè½½å‹åŠ›ã€‚\n\n3 javaå’Œredisä¸ä¼šåœ¨ä¸€ä¸ªæœºå™¨ä¸Šï¼Œå¾®æœåŠ¡æ¶æ„ä¸‹å°¤å…¶ä¸ä¼šã€‚PSï¼šæ–‡ä¸­ç®—æ³•ç”¨redisï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ç”¨redisçš„geoå‡½æ•°ã€‚\n\n4 æ˜¯çš„\n\n5 -5.5æ˜¯ç»åº¦longitudeï¼Œæ˜¯0ã€‚æ–‡ä¸­ç»ã€çº¬åº¦çš„å«æ³•æ˜¯äººä»¬ä¹ æƒ¯å«æ³•ï¼›äºŒå…ƒç»„<43.60411, -5.59041> å†™æ³•ï¼Œçº¬åº¦åœ¨å‰ï¼Œç»åº¦åœ¨åï¼Œæ˜¯ç»çº¬åº¦çš„ä¹ æƒ¯å†™æ³•ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646643848,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337616,"user_name":"èµµå¸¸æƒ","can_delete":false,"product_type":"c1","uid":1243247,"ip_address":"","ucode":"1D101B3B2CF9FE","user_header":"https://static001.geekbang.org/account/avatar/00/12/f8/6f/f206b86a.jpg","comment_is_top":false,"comment_ctime":1646917180,"is_pvip":true,"replies":[{"id":"125192","content":"è¿™é‡Œçº¬åº¦åº”è¯¥æ˜¯42.60411ï¼Œæ„Ÿè°¢æé†’ï¼Œæˆ‘ä¿®æ­£ä¸€ä¸‹","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1007349","ctime":1650417663,"ip_address":"","comment_id":337616,"utype":1}],"discussion_count":3,"race_medal":0,"score":"5941884476","product_id":100105701,"comment_content":"geohash ç»´åº¦ç¬¬7 9 10 è¡Œ 43.60411å¤§äºçº¬åº¦å¹³å‡å€¼ ä¸ºä»€ä¹ˆæ˜¯0å‘¢","like_count":1,"discussions":[{"author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":565228,"discussion_content":"è¿™é‡Œçº¬åº¦åº”è¯¥æ˜¯42.60411ï¼Œæ„Ÿè°¢æé†’ï¼Œæˆ‘ä¿®æ­£ä¸€ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650417663,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1024994,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/a3/e2/5cb4f43f.jpg","nickname":"laolinshi","note":"","ucode":"269B879389D7D5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557083,"discussion_content":"æˆ‘æ„Ÿè§‰çº¬åº¦åº”è¯¥æ˜¯42.60411å§ï¼Œä¸ç„¶çœ‹ä¸æ‡‚è¿™ä¸ªå¤„ç†è¿‡ç¨‹ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647655941,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1610722,"avatar":"https://static001.geekbang.org/account/avatar/00/18/93/e2/1bde89e8.jpg","nickname":"æ—¥æœˆ","note":"","ucode":"2B6FCCA5CEBFB2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":556722,"discussion_content":"ç¡®å®ï¼Œæ„Ÿè§‰æ•´é”™äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647486661,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":360656,"user_name":"zhengyu.nie","can_delete":false,"product_type":"c1","uid":1541669,"ip_address":"æµ™æ±Ÿ","ucode":"FFE0377D323E46","user_header":"https://static001.geekbang.org/account/avatar/00/17/86/25/25ded6c3.jpg","comment_is_top":false,"comment_ctime":1666719056,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1666719056","product_id":100105701,"comment_content":"ä¹‹å‰åšé™„è¿‘åœ°å€æ¨èç”¨çš„æ˜¯google s2ç®—æ³•ï¼Œæ¯”geohashå¥½ä¸€äº›ï¼Œgeohashæœ‰å±€é™æ€§","like_count":0},{"had_liked":false,"id":342372,"user_name":"Geek_474df8","can_delete":false,"product_type":"c1","uid":2943008,"ip_address":"","ucode":"A96EFA119EC32F","user_header":"","comment_is_top":false,"comment_ctime":1650211631,"is_pvip":false,"replies":[{"id":"125193","content":"ç¡®å®ï¼Œæ­£è´Ÿè¯¯å·®åº”è¯¥âœ–ï¸2ï¼Œæ„Ÿè°¢æé†’ï¼Œæˆ‘ä¿®æ”¹ä¸€ä¸‹<br>","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1007349","ctime":1650417996,"ip_address":"","comment_id":342372,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1650211631","product_id":100105701,"comment_content":"5ä½geohashï¼Œåº”è¯¥æ˜¯4.9km*4.9km","like_count":0,"discussions":[{"author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":565233,"discussion_content":"ç¡®å®ï¼Œæ­£è´Ÿè¯¯å·®åº”è¯¥âœ–ï¸2ï¼Œæ„Ÿè°¢æé†’ï¼Œæˆ‘ä¿®æ”¹ä¸€ä¸‹\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650417997,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337727,"user_name":"å‘¨æ–‡ç«¥","can_delete":false,"product_type":"c1","uid":1005411,"ip_address":"","ucode":"0C65A0A67229FA","user_header":"https://static001.geekbang.org/account/avatar/00/0f/57/63/be6db73e.jpg","comment_is_top":false,"comment_ctime":1646996241,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"1646996241","product_id":100105701,"comment_content":"æ²ˆå‰‘è€å¸ˆä¹Ÿåˆ†äº«è¿‡å‡ ä¹ä¸€è‡´çš„è§£å†³æ–¹æ¡ˆï¼Œæœç„¶é«˜æ‰‹æ‰€è§ç•¥åŒå•Š","like_count":0,"discussions":[{"author":{"id":1045721,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/f4/d9/e572ae4d.jpg","nickname":"é£ŸæŒ‡å¯çˆ±å¤š","note":"","ucode":"B918E07F55AB9E","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":560469,"discussion_content":"æ¶æ„å¸ˆä¹‹è·¯ :)","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649340491,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337681,"user_name":"zhaobk","can_delete":false,"product_type":"c1","uid":1291596,"ip_address":"","ucode":"30BEE12D2CF020","user_header":"https://static001.geekbang.org/account/avatar/00/13/b5/4c/6b9528f8.jpg","comment_is_top":false,"comment_ctime":1646968861,"is_pvip":false,"replies":[{"id":"123385","content":"ä¸äº†è§£è¿™ä¸ªæ’ä»¶ï¼Œæ„Ÿè°¢æç¤ºã€‚ä¸è¿‡æ•°æ®åº“ä¸Šçš„æ“ä½œè´Ÿè½½å‹åŠ›å¿…ç„¶æ˜¯æ»¡è¶³ä¸äº†æˆ‘ä»¬è¿™ä¸ªåœºæ™¯éœ€æ±‚çš„ï¼Œå¤ªç¬¨é‡äº†ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1007349","ctime":1646976648,"ip_address":"","comment_id":337681,"utype":1}],"discussion_count":3,"race_medal":0,"score":"1646968861","product_id":100105701,"comment_content":"è€å¸ˆå¥½ï¼Œè¯·é—®ï¼Œpostgresql æœ‰ä¸ªgisæ’ä»¶ï¼Œæ˜¯å¦å¯ä»¥è€ƒè™‘ç”¨äºè®¡ç®—æŸ¥æ‰¾ä¸´è¿‘çš„å¥½å‹ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555568,"discussion_content":"ä¸äº†è§£è¿™ä¸ªæ’ä»¶ï¼Œæ„Ÿè°¢æç¤ºã€‚ä¸è¿‡æ•°æ®åº“ä¸Šçš„æ“ä½œè´Ÿè½½å‹åŠ›å¿…ç„¶æ˜¯æ»¡è¶³ä¸äº†æˆ‘ä»¬è¿™ä¸ªåœºæ™¯éœ€æ±‚çš„ï¼Œå¤ªç¬¨é‡äº†ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646976648,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":2,"child_discussions":[{"author":{"id":1291596,"avatar":"https://static001.geekbang.org/account/avatar/00/13/b5/4c/6b9528f8.jpg","nickname":"zhaobk","note":"","ucode":"30BEE12D2CF020","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"discussion":{"id":555569,"discussion_content":"è°¢è°¢è€å¸ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646976692,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":555568,"ip_address":""},"score":555569,"extra":""},{"author":{"id":1049798,"avatar":"https://static001.geekbang.org/account/avatar/00/10/04/c6/60e21baa.jpg","nickname":"stronghearted","note":"","ucode":"569C52E01AB0EF","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1291596,"avatar":"https://static001.geekbang.org/account/avatar/00/13/b5/4c/6b9528f8.jpg","nickname":"zhaobk","note":"","ucode":"30BEE12D2CF020","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555995,"discussion_content":"å¯ä»¥æ”¯æŒã€‚å…³é”®è¿˜çœ‹å¹¶å‘ï¼Œå¦‚mongdbï¼Œå¯ä»¥ç½‘ä¸Šæ‰¾ä¸‹æ€§èƒ½æµ‹è¯•æŠ¥å‘Šã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647160323,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":555569,"ip_address":""},"score":555995,"extra":""}]}]},{"had_liked":false,"id":337426,"user_name":"é€é£","can_delete":false,"product_type":"c1","uid":1257067,"ip_address":"","ucode":"F40166FA5E32DF","user_header":"https://static001.geekbang.org/account/avatar/00/13/2e/6b/9895de18.jpg","comment_is_top":false,"comment_ctime":1646817328,"is_pvip":true,"replies":[{"id":"123320","content":"Zé˜¶æ›²çº¿æœ¬èº«å°±æ˜¯ä¸€ä¸ªæ’åº","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1007349","ctime":1646876257,"ip_address":"","comment_id":337426,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1646817328","product_id":100105701,"comment_content":"geoHashæœ‰åŠæ³•å¯¹ä¸´è¿‘çš„ç”¨æˆ·è¿›è¡Œè·ç¦»æ’åºå—","like_count":0,"discussions":[{"author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555337,"discussion_content":"Zé˜¶æ›²çº¿æœ¬èº«å°±æ˜¯ä¸€ä¸ªæ’åº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646876257,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2911084,"avatar":"https://static001.geekbang.org/account/avatar/00/2c/6b/6c/3e80afaf.jpg","nickname":"HappyHasson","note":"","ucode":"B84CC43E349CFA","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":557255,"discussion_content":"åŒä¸€ä¸ªæ ¼å­é‡Œçš„æ‰€æœ‰ç©å®¶è·ç¦»ç›¸åŒ&#39; å¯ä»¥æ ¹æ®ç”¨æˆ·æ ‡ç­¾ç»§ç»­æ’åº","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1647741068,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337392,"user_name":"qc","can_delete":false,"product_type":"c1","uid":1111235,"ip_address":"","ucode":"71945EABCEB4DF","user_header":"https://static001.geekbang.org/account/avatar/00/10/f4/c3/7a9d1550.jpg","comment_is_top":false,"comment_ctime":1646802955,"is_pvip":true,"replies":[{"id":"123290","content":"æš´åŠ›ä¸€ç‚¹çš„è¯ï¼Œåœ¨ç”¨æˆ·è¡¨é‡Œï¼Œå¥½å‹ç”¨ä¸€ä¸ªå­—æ®µå°±å¯ä»¥è®°å½•äº†ï¼Œå…³æ³¨å¥½å‹æœ‰ä¸Šé™ï¼Œä¸€èˆ¬2000ä¸ªï¼Œå¥½å‹idç”¨æ•´å‹ï¼Œå­—æ®µæœ€å¤§é•¿åº¦8kã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ä½œè€…","uid":"1007349","ctime":1646810985,"ip_address":"","comment_id":337392,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1646802955","product_id":100105701,"comment_content":"10äº¿ç”¨æˆ·è¿™ä¸ªè§„æ¨¡ä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥é‡‡ç”¨ä»€ä¹ˆå­˜å‚¨æ–¹æ¡ˆè®°å½•ç”¨æˆ·ä¹‹é—´çš„å¥½å‹å…³ç³»å‘¢ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555209,"discussion_content":"æš´åŠ›ä¸€ç‚¹çš„è¯ï¼Œåœ¨ç”¨æˆ·è¡¨é‡Œï¼Œå¥½å‹ç”¨ä¸€ä¸ªå­—æ®µå°±å¯ä»¥è®°å½•äº†ï¼Œå…³æ³¨å¥½å‹æœ‰ä¸Šé™ï¼Œä¸€èˆ¬2000ä¸ªï¼Œå¥½å‹idç”¨æ•´å‹ï¼Œå­—æ®µæœ€å¤§é•¿åº¦8kã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646810985,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1005658,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/58/5a/15d1ffda.jpg","nickname":"ctsPrsvrnc","note":"","ucode":"19603345D9E641","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":571925,"discussion_content":"è€å¸ˆæ‚¨å¥½, ä¸€ä¸ªå­—æ®µè®°å½•2000ä¸ªå¥½å‹ID?, é‚£å¦‚ä½•åˆ¤æ–­å¯¹æ–¹æ˜¯å¥½å‹?å¾—åˆ¤æ–­IDæ˜¯å¦åœ¨è¿™ä¸ªå­—æ®µé‡Œå§?åŒ…å«?é‚£å¯èƒ½ä¸å¤ªé€‚åˆæ”¾åœ¨å…³ç³»å‹æ•°æ®åº“?","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652494500,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337311,"user_name":"é™å¿ƒ","can_delete":false,"product_type":"c1","uid":1335457,"ip_address":"","ucode":"EB264FA6519FDA","user_header":"https://static001.geekbang.org/account/avatar/00/14/60/a1/8f003697.jpg","comment_is_top":false,"comment_ctime":1646745344,"is_pvip":true,"replies":[{"id":"123283","content":"ç”¨GeoHashç çš„é•¿åº¦æ§åˆ¶ç½‘æ ¼å¤§å°ï¼Œç½‘æ ¼å¤§å°æ˜¯å›ºå®šçš„ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":"1007349","ctime":1646789678,"ip_address":"","comment_id":337311,"utype":1}],"discussion_count":1,"race_medal":1,"score":"1646745344","product_id":100105701,"comment_content":"GeoHashçš„ç®—æ³•ç¡®å®å¾ˆå·§å¦™ï¼Œä½†å¦‚æœæŒ‰è¿™æ ·å­˜å‚¨ï¼Œå¦‚ä½•æŒ‰ä¸åŒçš„è·ç¦»è¿‡æ»¤ç”¨æˆ·å‘¢ï¼Ÿè¦ç”Ÿæˆä¸åŒç½‘æ ¼å¤§å°çš„GeoHashç å—ï¼Ÿæ„Ÿè§‰åº”è¯¥æœ‰æ›´å¥½çš„æ–¹æ³•ã€‚","like_count":0,"discussions":[{"author":{"id":1007349,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5e/f5/018907ac.jpg","nickname":"ææ™ºæ…§","note":"","ucode":"8C9980C438AFD1","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":555159,"discussion_content":"ç”¨GeoHashç çš„é•¿åº¦æ§åˆ¶ç½‘æ ¼å¤§å°ï¼Œç½‘æ ¼å¤§å°æ˜¯å›ºå®šçš„ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1646789678,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":337229,"user_name":"aoe","can_delete":false,"product_type":"c1","uid":1121758,"ip_address":"","ucode":"1C6201EDB4E954","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","comment_is_top":false,"comment_ctime":1646707404,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1646707404","product_id":100105701,"comment_content":"åŸæ¥è·ç¦»æ˜¯é€šè¿‡ç½‘æ ¼è®¡ç®—å‡ºæ¥çš„ï¼","like_count":0}]}