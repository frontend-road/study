{"id":506825,"title":"08ï½œListï¼šå¦‚ä½•å®ç°é«˜æ€§èƒ½çš„æ— é™åˆ—è¡¨ï¼Ÿ","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯è’‹å®ä¼Ÿã€‚ä»Šå¤©æˆ‘ä»¬å­¦ä¹ çš„é‡ç‚¹æ˜¯åˆ—è¡¨ç»„ä»¶ RecyclerListViewã€‚</p><p>å¦‚æœä½ ç†Ÿæ‚‰ React Native ï¼Œé‚£ä½ å¯èƒ½ä¼šé—®äº†ï¼šâ€œReact Native ä¸­çš„åˆ—è¡¨ç»„ä»¶ä¸æ˜¯ FlatList å—ï¼Ÿâ€</p><p>æ²¡é”™ã€‚React Native å®˜æ–¹æä¾›çš„åˆ—è¡¨ç»„ä»¶ç¡®å®æ˜¯ FlatListï¼Œä½†æ˜¯æˆ‘æ¨èä½ ä¼˜å…ˆä½¿ç”¨å¼€æºç¤¾åŒºæä¾›çš„åˆ—è¡¨ç»„ä»¶ RecyclerListViewã€‚å› ä¸ºï¼Œå¼€æºç¤¾åŒºæä¾›çš„ RecyclerListView æ€§èƒ½æ›´å¥½ã€‚</p><p>å¯¹äºåˆ—è¡¨ç»„ä»¶æ¥è¯´ï¼Œæˆ‘ä»¬æœ€åº”è¯¥å…³å¿ƒçš„å°±æ˜¯æ€§èƒ½ã€‚è¿™é‡Œæˆ‘ç»™ä½ åˆ†äº«ä¸‹æˆ‘çš„ä¸ªäººç»å†ã€‚2016~2018 å¹´ï¼Œæˆ‘å‚ä¸äº†ä¸€ä¸ªç”¨ React Native æ­å»ºçš„ä¿¡æ¯æµé¡¹ç›®ã€‚ä¿¡æ¯æµè¿™ç§æ— é™åˆ—è¡¨é¡µæ˜¯éå¸¸å¸¸è§çš„ä¸šåŠ¡åœºæ™¯ï¼Œæ¯”å¦‚ä½ ä½¿ç”¨çš„äº¬ä¸œé¦–é¡µã€æŠ–éŸ³è§†é¢‘ã€å¾®ä¿¡æœ‹å‹åœˆéƒ½å±äºä¿¡æ¯æµé¡µé¢ã€‚ä½ çœ‹å®Œä¸€é¡µï¼Œè¿˜æœ‰ä¸‹ä¸€é¡µï¼Œçœ‹å®Œä¸‹ä¸€é¡µè¿˜æœ‰ä¸‹ä¸‹é¡µï¼Œæ— ç©·æ— å°½ã€‚è¿™æ—¶å°±è¦ç”¨åˆ°æˆ‘ä»¬é©¬ä¸Šè¦æ¢è®¨çš„åˆ—è¡¨ç»„ä»¶äº†ï¼Œè€Œä¸”å¿…é¡»æ˜¯é«˜æ€§èƒ½çš„åˆ—è¡¨ç»„ä»¶ï¼Œä¸èƒ½ç¿»ç€ç¿»ç€å°±å¡èµ·æ¥äº†ã€‚</p><p>2016 å¹´ï¼Œæ²¡æœ‰ RecyclerListViewï¼Œä¹Ÿæ²¡æœ‰ FlatListï¼Œæˆ‘ä»¬ç”¨çš„æ˜¯ç¬¬ä¸€ç‰ˆçš„ ListView ç»„ä»¶ã€‚ListView ç»„ä»¶æ€§èƒ½å¾ˆå·®ï¼Œæ²¡æœ‰å†…å­˜å›æ”¶æœºåˆ¶ï¼Œç¿»ä¸€é¡µå†…å­˜å°±æ¶¨ä¸€ç‚¹ï¼Œå†ç¿»ä¸€é¡µå†…å­˜åˆå†æ¶¨ä¸€ç‚¹ã€‚å‰ 5 é¡µæ»šåŠ¨éå¸¸æµç•…ï¼Œç¬¬ 10 é¡µå¼€å§‹å°±æ„Ÿè§‰åˆ°å¡é¡¿äº†ï¼Œåˆ° 50 é¡µçš„æ—¶å€™ï¼ŒåŸºæœ¬å°±æ»‘ä¸åŠ¨äº†ã€‚å¡é¡¿çš„åŸå› å°±æ˜¯æ— é™åˆ—è¡¨å¤ªåƒå†…å­˜äº†ã€‚å¦‚æœæ‰‹æœºçš„å¯ä½¿ç”¨å†…å­˜ä¸å¤Ÿäº†ï¼Œå¡é¡¿å°±ä¼šå‘ç”Ÿã€‚è¿™ä¹Ÿæ˜¯ React Native åˆšå‡ºæ¥æ—¶è¢«åæ§½å¾—æœ€å¤šçš„åœ°æ–¹ã€‚</p><!-- [[[read_end]]] --><p>2017 å¹´ï¼Œå®˜æ–¹çš„ç¬¬äºŒä»£åˆ—è¡¨ç»„ä»¶ FlatList å‡ºæ¥åï¼Œç¬¬ä¸€ä»£åˆ—è¡¨ç»„ä»¶ ListView å°±è¢«åºŸå¼ƒäº†ï¼Œè¿™æ—¶å€™æ— é™åˆ—è¡¨æ€§èƒ½å˜å¾—å¥½ä¸€äº›äº†ã€‚è™½ç„¶FlatList åœ¨ iOS ç«¯è¡¨ç°å¾ˆå¥½ï¼Œä½†åœ¨ Android ä½ç«¯æœºè¿˜æ˜¯èƒ½æ„Ÿè§‰åˆ°å¡é¡¿ã€‚</p><p>2018 å¹´ï¼Œéšç€ä¸šåŠ¡è¶Šæ¥è¶Šå¤æ‚ï¼ŒFlatList çš„æ€§èƒ½è¡¨ç°å˜å¾—æ›´åŠ ç³Ÿç³•äº†ã€‚ç»è¿‡è°ƒç ”ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†æ€§èƒ½æ›´å¥½çš„åˆ—è¡¨ç»„ä»¶ RecyclerListViewã€‚é€šå¸¸è¯„åˆ¤åˆ—è¡¨å¡é¡¿çš„æŒ‡æ ‡æ˜¯ UI çº¿ç¨‹çš„å¸§ç‡å’Œ JavaScript çº¿ç¨‹çš„å¸§ç‡ã€‚</p><p>ä½†ä¸šå†…æœ‰äººå®éªŒè¿‡ï¼Œåœ¨å·²ç»æ¸²æŸ“å®Œæˆçš„é¡µé¢ä¸­ï¼Œé€šè¿‡æ­»å¾ªç¯æŠŠ JavaScript çº¿ç¨‹å¡æ­»ï¼Œé¡µé¢ä¾æ—§èƒ½å¤Ÿæ»šåŠ¨ã€‚è¿™æ˜¯å› ä¸ºæ»šåŠ¨æœ¬èº«æ˜¯åœ¨ UI çº¿ç¨‹è¿›è¡Œçš„ï¼Œå’Œ JavaScript çº¿ç¨‹æ— å…³ã€‚ä½†å½“ç”¨æˆ·ä¸‹æ»‘ï¼Œéœ€è¦æ¸²æŸ“æ–°çš„åˆ—è¡¨é¡¹æ—¶ï¼Œå°±éœ€è¦JavaScript çº¿ç¨‹å‚ä¸è¿›æ¥äº†ã€‚å¦‚æœè¿™æ—¶å€™ JavaScript æ‰å¸§äº†ï¼Œæ–°çš„åˆ—è¡¨é¡¹å°±æ¸²æŸ“ä¸å‡ºæ¥ï¼Œå³ä¾¿èƒ½æ»šåŠ¨ï¼Œç”¨æˆ·çœ‹åˆ°ä¹Ÿæ˜¯ç©ºç™½é¡¹ï¼Œä¸€æ ·å½±å“ç”¨æˆ·ä½“éªŒã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬å½“æ—¶æ˜¯æŠŠ JavaScript å¸§ç‡ä½œä¸ºå®¢è§‚æŒ‡æ ‡ï¼Œå†åŠ ä¸Šå›¢é˜ŸåŒå­¦ä¸»è§‚ä½“éªŒï¼Œè¿›è¡Œç»¼åˆè¯„ä¼°ã€‚é‡‡é›† JavaScript å¸§ç‡ç”¨çš„æ‰‹æœºæ˜¯ OPPO R9ï¼Œç°åœ¨çœ‹æ¥æ˜¯å¦¥å¦¥çš„ä½ç«¯æœºäº†ï¼Œç»“æœæ˜¾ç¤ºï¼ŒFlatList  JavaScript å¸§ç‡å°äº 20 å¸§çš„å æ¯”æœ‰ 16%ï¼Œè€Œ RecyclerListView å æ¯”åªæœ‰ 3%ã€‚ä¸»è§‚ä½“éªŒä¸Šï¼Œå›¢é˜ŸåŒå­¦æ‹¿è‡ªå·±çš„æ‰‹æœºè¿›è¡Œæµ‹è¯•ï¼Œä½¿ç”¨æš´åŠ›æ»‘åŠ¨çš„æµ‹è¯•æ–¹æ³•ï¼Œæµ‹è¯„äº† 20 æ¥æ¬¾æœºå‹ã€‚åœ¨ä½ç«¯æœºä¸Š FlatList å¤šè¢«æ ‡è®°ä¸ºä¸€èˆ¬å¡ï¼Œè€Œ RecyclerListView å¤§å¤šæ ‡è®°æ˜¯æµç•…ï¼Œåªæœ‰å°‘é‡çš„è½»å¾®å¡é¡¿ã€‚</p><p><img src=\"https://static001.geekbang.org/resource/image/5e/bd/5ed5ba1e8a756d1065f1c70e14083abd.png?wh=1001x386\" alt=\"å›¾ç‰‡\"></p><p>å³ä½¿ç°åœ¨æ–°æ¶æ„é©¬ä¸Šè¦å‡ºæ¥äº†ï¼Œåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œæˆ‘æœ€æ¨èä½ ç”¨çš„è¿˜æ˜¯ RecyclerListViewã€‚å› ä¸ºä»åŸç†ä¸Š RecyclerListView æ¯” FlatList å¼ºä¸Šä¸å°‘ã€‚</p><p>ä½œä¸ºä¸€ä¸ªå¼€å‘è€…ï¼Œä½ æ€»æœ‰éœ€è¦æ‰‹åŠ¨ä¼˜åŒ–çš„æ—¶å€™ï¼Œä¸æ˜¯æ‰€æœ‰åœºæ™¯éƒ½æœ‰ç°æˆçš„ç»„ä»¶ï¼Œéƒ½æœ‰è‡ªåŠ¨åŒ–çš„è§£å†³æ–¹æ¡ˆã€‚å¦‚æœä½ ç°åœ¨æ²¡æœ‰é‡åˆ°ï¼Œå…´è®¸åªæ˜¯å› ä¸ºå¼€å‘å¹´å¤´å¤ªå°‘äº†ï¼Œä½ å¯ä»¥é—®é—®ä½ èº«è¾¹é‚£äº›å¼€å‘å¹´å¤´å¤šçš„åŒå­¦ï¼Œä»–ä»¬åœ¨è¿™æ–¹é¢åº”è¯¥æ˜¯æœ‰å¾ˆæ·±çš„ä½“ä¼šã€‚å­¦ä¹  FlatListã€RecyclerListView çš„ä¼˜åŒ–åŸç†ï¼Œå¯¹è‡ªå·±çš„åŠ¨æ‰‹ä¼˜åŒ–æ˜¯éå¸¸æœ‰å¸®åŠ©çš„ã€‚å½“ä½ ä»¥åé‡åˆ°åˆ—è¡¨æ€§èƒ½é—®é¢˜æ—¶ï¼Œä½ å¯ä»¥æœ‰ç°æˆçš„ä¼˜åŒ–æ€è·¯å€Ÿé‰´ï¼Œä¸ä¼šæ¯«æ— å¤´ç»ªã€‚</p><p>é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆå¼€æºç¤¾åŒºçš„ RecyclerListView æ¯”å®˜æ–¹çš„ FlatList æ€§èƒ½æ›´å¥½ï¼ŸFlatListã€RecyclerListView çš„ä¼˜åŒ–åŸç†æ˜¯ä»€ä¹ˆï¼ŸFlatList å’Œ RecyclerListView çš„åº•å±‚å®ç°éƒ½æ˜¯æ»šåŠ¨ç»„ä»¶ ScrollViewï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆä» ScrollView èŠèµ·ã€‚</p><h2>ScrollViewï¼šæ¸²æŸ“æ‰€æœ‰å†…å®¹çš„æ»šåŠ¨ç»„ä»¶</h2><p>ScrollView æ˜¯ä¸€ä¸ªæ”¯æŒæ¨ªå‘æˆ–ç«–å‘çš„æ»šåŠ¨ç»„ä»¶ï¼Œå‡ ä¹æ‰€æœ‰é¡µé¢éƒ½ä¼šç”¨åˆ°ã€‚</p><p>ScrollView ç»„ä»¶ç±»ä¼¼äº Web ä¸­çš„ <code>&lt;html/&gt;</code> æˆ– <code>&lt;body/&gt;</code> æ ‡ç­¾ï¼Œæµè§ˆå™¨ä¸­çš„é¡µé¢ä¹‹æ‰€ä»¥èƒ½ä¸Šä¸‹æ»šåŠ¨ï¼Œå°±æ˜¯å› ä¸º html æˆ– body æ ‡ç­¾é»˜è®¤æœ‰ä¸€ä¸ª overflow-y: scroll çš„å±æ€§ï¼Œå¦‚æœä½ æŠŠæ ‡ç­¾çš„å±æ€§è®¾ç½®ä¸º overflow-y: hiddenï¼Œé¡µé¢å°±ä¸èƒ½æ»šåŠ¨äº†ã€‚</p><p>React Native çš„ ScrollView ç»„ä»¶åœ¨ Android çš„åº•å±‚å®ç°ç”¨çš„æ˜¯ ScrollView å’Œ HorizontalScrollViewï¼Œåœ¨ iOS çš„åº•å±‚å®ç°ç”¨çš„æ˜¯ UIScrollViewã€‚</p><p>æ‰€è°“çš„æ»šåŠ¨ï¼Œè§£å†³çš„æ˜¯åœ¨æœ‰é™é«˜åº¦çš„å±å¹•å†…æµè§ˆæ— é™é«˜åº¦çš„å†…å®¹çš„é—®é¢˜ã€‚æœ‰é™é«˜åº¦çš„å®¹å™¨æ˜¯ ScrollViewï¼Œæ— é™é«˜åº¦ï¼Œæˆ–è€…è¯´é«˜åº¦ä¸ç¡®å®šçš„å†…å®¹æ˜¯ ScrollView çš„ childrenã€‚</p><p>ä½¿ç”¨ ScrollView ç»„ä»¶æ—¶ï¼Œæˆ‘ä»¬é€šå¸¸å¹¶ä¸ç›´æ¥ç»™ ScrollView è®¾ç½®å›ºå®šé«˜åº¦æˆ–å®½åº¦ï¼Œè€Œæ˜¯ç»™å…¶çˆ¶ç»„ä»¶è®¾ç½®å›ºå®šé«˜åº¦æˆ–å®½åº¦ã€‚</p><p>ä¸€èˆ¬è€Œè¨€ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨å®‰å…¨åŒºåŸŸç»„ä»¶ SafeAreaView ç»„ä»¶ä½œä¸º ScrollView çš„çˆ¶ç»„ä»¶ï¼Œå¹¶ç»™ SafeAreaView ç»„ä»¶è®¾ç½®å¸ƒå±€å±æ€§ flex:1ï¼Œè®©å†…å®¹è‡ªåŠ¨æ’‘é«˜ SafeAreaViewã€‚ä½¿ç”¨ SafeAreaView ä½œä¸ºæœ€å¤–å±‚ç»„ä»¶çš„å¥½å¤„æ˜¯ï¼Œå®ƒå¯ä»¥å¸®æˆ‘ä»¬é€‚é… iPhone çš„åˆ˜æµ·å±ï¼ŒèŠ‚çº¦æˆ‘ä»¬çš„é€‚é…æˆæœ¬ï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">&lt;SafeAreaView style={{flex: 1}}&gt;\n  &lt;ScrollView&gt;\n    &lt;Text&gt;1&lt;/Text&gt;\n  &lt;ScrollView/&gt;\n&lt;/SafeAreaView&gt;    \n</code></pre><p>äº†è§£å®Œ ScrollView ç»„ä»¶çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•åï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹ ScrollView çš„æ€§èƒ½ï¼Œçœ‹çœ‹å¦‚æœä½¿ç”¨ ScrollView æ¥å®ç°æ— é™åˆ—è¡¨ä¼šæ€ä¹ˆæ ·ã€‚</p><p>ä½ å¯ä»¥çœ‹çœ‹ä¸‹é¢è¿™æ®µä»£ç ï¼š</p><pre><code class=\"language-plain\">// 10 ä¸ª item å°±èƒ½å¡«æ»¡æ•´ä¸ªå±å¹•ï¼Œæ¸²æŸ“å¾ˆå¿«\n// 1000 ä¸ª item ç›¸å½“äº 100+ ä¸ªå±å¹•çš„é«˜åº¦ï¼Œæ¸²æŸ“å¾ˆæ…¢\nconst NUM_ITEMS = 1000; \n\nconst makeContent = (nItems: number, styles: any) =&gt; {\n  return Array(nItems)\n    .fill(1)\n    .map((_, i) =&gt; (\n      &lt;Pressable\n        key={i}\n        style={styles}&gt;\n        &lt;Text&gt;{'Item ' + i}&lt;/Text&gt;\n      &lt;/Pressable&gt;\n    ));\n};\n\nconst App = () =&gt; {\n  return (\n    &lt;SafeAreaView style={{flex: 1}}&gt;\n      &lt;ScrollView&gt;{makeContent(NUM_ITEMS, styles.itemWrapper)}&lt;/ScrollView&gt;\n    &lt;/SafeAreaView&gt;\n  );\n};\n</code></pre><p>ä¸Šé¢è¿™æ®µä»£ç ï¼Œè¯´çš„å°±æ˜¯ä½¿ç”¨ ScrollView ç»„ä»¶ä¸€æ¬¡æ€§ç›´æ¥æ¸²æŸ“ 1000 ä¸ªå­è§†å›¾ï¼Œè¿™é‡Œæ²¡æœ‰åšä»»ä½•æ‡’åŠ è½½ä¼˜åŒ–ã€‚</p><p>ä»¥ä¿¡æ¯æµä¸šåŠ¡ä¸ºä¾‹ï¼Œç”¨æˆ·è¿›å…¥é¡µé¢åç¬¬ä¸€çœ¼çœ‹åˆ°çš„åªæœ‰å±å¹•ä¸­çš„ä¿¡æ¯ï¼Œä¸€èˆ¬ä¸è¶…è¿‡ 10 æ¡ã€‚ä¸€æ¬¡æ€§æ¸²æŸ“ 10 æ¡ä¿¡æ¯ï¼Œå…¶å®å¾ˆå¿«ï¼Œå°±æ˜¯ä¸€çœ¨çœ¼çš„åŠŸå¤«ã€‚ä½†å¦‚æœæ˜¯ 1000 æ¡å‘¢ï¼Ÿç®—åŠ›ä¹˜ä»¥ 100ï¼Œå†…å­˜ä¹˜ä»¥ 100ï¼Œè€—æ—¶ä¹Ÿä¹˜ä»¥ 100ï¼Œæ¸²æŸ“é€Ÿåº¦å°±æ…¢ä¸‹æ¥äº†ã€‚å¤§é‡çš„è®¡ç®—å’Œå†…å­˜æµªè´¹åœ¨äº†ç”¨æˆ·çœ‹ä¸åˆ°çš„åœ°æ–¹ã€‚</p><p>ä½¿ç”¨ ScrollView ç»„ä»¶æ—¶ï¼ŒScrollView çš„æ‰€æœ‰å†…å®¹éƒ½ä¼šåœ¨é¦–æ¬¡åˆ·æ–°æ—¶è¿›è¡Œæ¸²æŸ“ã€‚å†…å®¹å¾ˆå°‘çš„æƒ…å†µä¸‹å½“ç„¶æ— æ‰€è°“ï¼Œå†…å®¹å¤šèµ·æ¥äº†ï¼Œé€Ÿåº¦ä¹Ÿå°±æ…¢ä¸‹æ¥äº†ã€‚</p><p>é‚£æœ‰ä»€ä¹ˆä¼˜åŒ–æ–¹æ¡ˆå—ï¼Ÿä½ è‚¯å®šæƒ³åˆ°äº†ä¸€äº›ä¼˜åŒ–æ–¹æ¡ˆï¼Œæ¯”å¦‚æŒ‰éœ€æ¸²æŸ“ã€‚</p><p>æˆ‘å‚åŠ è¿‡ä¸€ä¸ªä½¿ç”¨ React Native å¼€å‘çš„ã€ç±»ä¼¼æŠ–éŸ³çš„è§†é¢‘æµé¡µé¢ï¼Œç”¨çš„å°±æ˜¯æŒ‰éœ€æ¸²æŸ“ã€‚ç”¨æˆ·å§‹ç»ˆåªä¼šçœ‹åˆ°å½“å‰å±å¹•æ˜¾ç¤ºçš„è§†é¢‘ã€ä¸‹ä¸€ä¸ªè§†é¢‘å’Œä¸Šä¸€ä¸ªè§†é¢‘ï¼Œæˆ‘ä»¬åªéœ€è¦ç”¨ ScrollView æ¸²æŸ“ 3 ä¸ªè§†é¢‘å°±èƒ½æ»¡è¶³ç”¨æˆ·çš„æ‰€æœ‰æ“ä½œã€‚è¿™æ ·åšï¼Œæ— è®ºç”¨æˆ·æ€ä¹ˆç¿»é¡µï¼Œå†…å­˜ä¸­å°±åªæœ‰ 3 ä¸ªè§†é¢‘ï¼Œå½“ç„¶ä¹Ÿä¸ä¼šå¡äº†ã€‚</p><p>åˆšåˆšè¯´çš„è§†é¢‘æµæŒ‰éœ€åŠ è½½ï¼Œåšèµ·æ¥æ˜¯ç›¸å¯¹å®¹æ˜“ä¸€äº›çš„ï¼Œå› ä¸ºåªç”¨æ§åˆ¶ 3 ä¸ªè§†é¢‘å°±å¯ä»¥äº†ã€‚ä½†ç±»ä¼¼å¾®ä¿¡æœ‹å‹åœˆã€äº¬ä¸œé¦–é¡µè¿™ç§ä¸€å±æœ‰å¤šæ¡ä¿¡æ¯å†…å®¹çš„å¤æ‚åˆ—è¡¨é¡µï¼Œæ‰‹åŠ¨æŒ‰éœ€åŠ è½½å°±éº»çƒ¦å¾ˆå¤šã€‚é‚£æœ‰æ²¡æœ‰â€œè‡ªåŠ¨\"çš„æŒ‰éœ€åŠ è½½æ–¹æ¡ˆå‘¢ï¼Ÿæœ‰ã€‚</p><h2>FlatListï¼šæŒ‰éœ€æ¸²æŸ“çš„åˆ—è¡¨ç»„ä»¶</h2><p>FlatList åˆ—è¡¨ç»„ä»¶å°±æ˜¯ â€œè‡ªåŠ¨â€æŒ‰éœ€æ¸²æŸ“çš„ã€‚</p><p>FlatList æ˜¯ React Native å®˜æ–¹æä¾›çš„ç¬¬äºŒä»£åˆ—è¡¨ç»„ä»¶ã€‚FlatList ç»„ä»¶åº•å±‚ä½¿ç”¨çš„æ˜¯è™šæ‹Ÿåˆ—è¡¨ VirtualizedListï¼ŒVirtualizedList åº•å±‚ç»„ä»¶ä½¿ç”¨çš„æ˜¯ ScrollView ç»„ä»¶ã€‚å› æ­¤ VirtualizedList å’Œ  ScrollView ç»„ä»¶ä¸­çš„å¤§éƒ¨åˆ†å±æ€§ï¼ŒFlatList ç»„ä»¶ä¹Ÿå¯ä»¥ä½¿ç”¨ã€‚å…³äº FlatList æ›´å…·ä½“çš„ä½¿ç”¨æ–¹æ³•ï¼Œä½ å¯ä»¥æŸ¥çœ‹<a href=\"https://reactnative.dev/docs/flatlist\">å®˜æ–¹æ–‡æ¡£</a>ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬è¿˜æ˜¯å›åˆ° FlatList çš„åŸç†ï¼Œå…ˆä»ç†è®ºå±‚é¢ä¸Šç†è§£ FlatList ä¸ºä»€ä¹ˆå¯ä»¥è‡ªåŠ¨æŒ‰éœ€æ¸²æŸ“ã€‚</p><p>æˆ‘ä»¬è¦çŸ¥é“ï¼Œåˆ—è¡¨ç»„ä»¶å’Œæ»šåŠ¨ç»„ä»¶çš„å…³é”®åŒºåˆ«æ˜¯ï¼Œåˆ—è¡¨ç»„ä»¶æŠŠå…¶å†…éƒ¨å­ç»„ä»¶çœ‹åšç”±ä¸€ä¸ªä¸ªåˆ—è¡¨é¡¹ç»„æˆçš„é›†åˆï¼Œæ¯ä¸€ä¸ªåˆ—è¡¨é¡¹éƒ½å¯ä»¥å•ç‹¬æ¸²æŸ“æˆ–è€…å¸è½½ã€‚è€Œæ»šåŠ¨ç»„ä»¶æ˜¯æŠŠå…¶å†…éƒ¨å­ç»„ä»¶çœ‹åšä¸€ä¸ªæ•´ä½“ï¼Œåªèƒ½æ•´ä½“æ¸²æŸ“ã€‚è€Œè‡ªåŠ¨æŒ‰éœ€æ¸²æŸ“çš„å‰æå°±æ˜¯æ¯ä¸ªåˆ—è¡¨é¡¹å¯ä»¥ç‹¬ç«‹æ¸²æŸ“æˆ–å¸è½½ã€‚</p><p>ç®€å•åœ°è®²ï¼ŒFlatList æ€§èƒ½æ¯” ScrollView å¥½çš„åŸå› æ˜¯ï¼Œ FlatList åˆ—è¡¨ç»„ä»¶åˆ©ç”¨æŒ‰éœ€æ¸²æŸ“æœºåˆ¶å‡å°‘äº†é¦–æ¬¡æ¸²æŸ“çš„è§†å›¾ï¼Œåˆ©ç”¨ç©ºè§†å›¾çš„å ä½æœºåˆ¶å›æ”¶äº†åŸæœ‰è§†å›¾çš„å†…å­˜ï¼Œä½ å¯ä»¥å¯¹æ¯”ä¸€ä¸‹äºŒè€…çš„åŒºåˆ«ï¼š</p><pre><code>// ä»ä¸Šåˆ°ä¸‹æ»šåŠ¨æ—¶çš„æ¸²æŸ“æ–¹å¼\n// SrcollView æ¸²æŸ“æ–¹å¼ï¼šä¸€æ¬¡æ¸²æŸ“æ‰€æœ‰è§†å›¾\nSrcollView0_9  = [{ğŸ‘},{ },{ },{ }]  // æµè§ˆ0~9æ¡åˆ—è¡¨é¡¹\nSrcollView10_19 = [{ },{ğŸ‘},{ },{ }] // æµè§ˆ10~19æ¡åˆ—è¡¨é¡¹\nSrcollView20_29 = [{ },{ },{ğŸ‘},{ }] // æµè§ˆ20~29æ¡åˆ—è¡¨é¡¹\nSrcollView30_39 = [{ },{ },{ },{ğŸ‘}] // æµè§ˆ30~39æ¡åˆ—è¡¨é¡¹\n\n// FlatList æ¸²æŸ“æ–¹å¼ï¼šæŒ‰éœ€æ¸²æŸ“ï¼Œçœ‹ä¸è§çš„åœ°æ–¹ç”¨ $empty å ä½\nFlatList0_9  = [{ğŸ‘},{ }]               // æµè§ˆ0~9æ¡åˆ—è¡¨é¡¹\nFlatList10_19 = [{ },{ğŸ‘},{ }]          // æµè§ˆ10~19æ¡åˆ—è¡¨é¡¹\nFlatList20_29 = [$empty,{},{ğŸ‘},{}]     // æµè§ˆ20~29æ¡åˆ—è¡¨é¡¹\nFlatList30_39 = [$empty,$empty,{ },{ğŸ‘}]// æµè§ˆ30~39æ¡åˆ—è¡¨é¡¹\n</code></pre><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼ŒåŒæ ·æ˜¯æ¸²æŸ“ 40 æ¡åˆ—è¡¨ã€‚ScrollView ä¸€æ¬¡æ€§æ¸²æŸ“äº† 40 æ¡åˆ—è¡¨ï¼Œæ— è®ºä½ æ»šåŠ¨åˆ°å“ªå„¿ï¼Œæ‰€æœ‰çš„åˆ—è¡¨é¡¹éƒ½æ˜¯æ¸²æŸ“å¥½çš„ã€‚</p><p>ä½†FlatList åœ¨ä½ æµè§ˆ 0~9 æ¡åˆ—è¡¨é¡¹æ—¶ï¼Œåªæ¸²æŸ“äº†0~19æ¡åˆ—è¡¨ï¼Œå‰©ä½™çš„20~39æ¡åˆ—è¡¨é¡¹æ˜¯æ²¡æœ‰æ¸²æŸ“çš„ã€‚åœ¨ä½ æµè§ˆæ»šåŠ¨åˆ°ç¬¬ 10~19 æ¡æ—¶ï¼ŒFlatList æŠŠ 20~29 æ¡åˆ—è¡¨é¡¹æå‰åŠ è½½å‡ºæ¥äº†ï¼Œè¿™å°±æ˜¯æŒ‰éœ€æ¸²æŸ“åŠ è½½æœºåˆ¶.å½“ä½ ç»§ç»­æ»šåŠ¨åˆ° 20~29 æ¡åˆ—è¡¨é¡¹æ—¶ï¼ŒFlatList ä¼šæŠŠç¬¬ 0~9 æ¡åˆ—è¡¨é¡¹å›æ”¶ï¼Œç”¨ç©ºå…ƒç´  <span dollar=\"\">$</span>empty ä»£æ›¿ï¼Œå½“ä½ å†æ»šåŠ¨åˆ° 30~39 æ¡åˆ—è¡¨é¡¹æ—¶ï¼ŒåŒç† 10~19 æ¡åˆ—è¡¨é¡¹ä¹Ÿä¼šè¢«ç©ºå…ƒç´  <span dollar=\"\">$</span>emptyï¼Œè¿™å°±æ˜¯å†…å­˜å›æ”¶ã€‚</p><p>40 æ¡åˆ—è¡¨åªæ˜¯ä¸€ä¸ªå‡è®¾çš„ä¾‹å­ï¼Œå®ç° FlatListè‡ªåŠ¨æŒ‰éœ€æ¸²æŸ“çš„æ€è·¯å…·ä½“å¯ä»¥åˆ†ä¸ºä¸‰æ­¥ï¼š</p><ol>\n<li>é€šè¿‡æ»šåŠ¨äº‹ä»¶çš„å›è°ƒå‚æ•°ï¼Œè®¡ç®—éœ€è¦æŒ‰éœ€æ¸²æŸ“çš„åŒºåŸŸï¼›</li>\n<li>é€šè¿‡éœ€è¦æŒ‰éœ€æ¸²æŸ“çš„åŒºåŸŸï¼Œè®¡ç®—éœ€è¦æŒ‰éœ€æ¸²æŸ“çš„åˆ—è¡¨é¡¹ç´¢å¼•ï¼›</li>\n<li>åªæ¸²æŸ“éœ€è¦æŒ‰éœ€æ¸²æŸ“åˆ—è¡¨é¡¹ï¼Œä¸éœ€è¦æ¸²æŸ“çš„åˆ—è¡¨é¡¹ç”¨ç©ºè§†å›¾ä»£æ›¿ã€‚</li>\n</ol><p>ç¬¬ä¸€æ­¥ï¼Œè®¡ç®—æŒ‰éœ€æ¸²æŸ“åŒºåŸŸã€‚å…·ä½“åœ°è¯´ï¼Œæ¯æ¬¡ä½ æ»šåŠ¨é¡µé¢ï¼Œéƒ½ä¼šè§¦å‘æ»šåŠ¨ç»„ä»¶ ScrollView ç»„ä»¶çš„ä¸€ä¸ªâ€œå¼‚æ­¥â€å›è°ƒ onScroll äº‹ä»¶ã€‚</p><p>åœ¨ onScroll äº‹ä»¶ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è·å–åˆ°å½“å‰æ»šåŠ¨çš„åç§»é‡ offset ç­‰ä¿¡æ¯ã€‚ä»¥å½“å‰æ»šåŠ¨çš„åç§»é‡ä¸ºåŸºç¡€ï¼Œé»˜è®¤å‘ä¸Šæ•° 10 ä¸ªå±å¹•çš„é«˜åº¦ï¼Œå‘ä¸‹æ•° 10 ä¸ªå±å¹•çš„é«˜åº¦ï¼Œè¿™ä¸€å…± 21 ä¸ªå±å¹•çš„å†…å®¹å°±æ˜¯éœ€è¦æŒ‰éœ€æ¸²æŸ“çš„åŒºåŸŸï¼Œå…¶ä»–åŒºåŸŸéƒ½æ˜¯æ— éœ€æ¸²æŸ“çš„åŒºåŸŸã€‚è¿™æ ·ï¼Œå³ä¾¿æ˜¯å¼‚æ­¥æ¸²æŸ“ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½ä¿è¯æ‰€æœ‰ JavaScript æ‰§è¡Œçš„æ¸²æŸ“ä»»åŠ¡éƒ½å®æ—¶åœ°äº¤ç”± UI çº¿ç¨‹å¤„ç†ï¼Œç«‹åˆ»å±•ç¤ºå‡ºæ¥ã€‚ä½†å› ä¸ºæœ‰è¿™ 10 ä¸ªå±å¹•çš„å†…å®¹ä½œä¸ºç¼“å†²ï¼Œç”¨æˆ·æ— è®ºæ˜¯å‘ä¸Šæ»šåŠ¨è¿˜æ˜¯å‘ä¸‹æ»šåŠ¨ï¼Œéƒ½ä¸è‡³äºä¸€æ»šåŠ¨å°±çœ‹åˆ°ç™½å±ã€‚</p><p>ç°åœ¨æˆ‘ä»¬çŸ¥é“äº†æŒ‰éœ€æ¸²æŸ“çš„åŒºåŸŸï¼Œæ¥ç€è¦è®¡ç®—çš„å°±æ˜¯æŒ‰éœ€æ¸²æŸ“åˆ—è¡¨é¡¹çš„ç´¢å¼•ã€‚FlatList å†…éƒ¨å®ç°å°±æ˜¯é€šè¿‡ setState æ”¹å˜æŒ‰éœ€æ¸²æŸ“åŒºåŸŸç¬¬ä¸€ä¸ªç´¢å¼•å’Œæœ€åä¸€ä¸ªç´¢å¼•çš„å€¼ï¼Œæ¥å®ç°æŒ‰éœ€æ¸²æŸ“çš„ ã€‚</p><p>æ€ä¹ˆè®¡ç®—æŒ‰éœ€æ¸²æŸ“åˆ—è¡¨é¡¹çš„ç´¢å¼•å‘¢ï¼Ÿæ¥ç€æˆ‘ä»¬ç»§ç»­çœ‹ç¬¬äºŒæ­¥ã€‚è¿™é‡Œæˆ‘ä»¬åˆ†ä¸¤ç§æƒ…å†µï¼Œç¬¬ä¸€ç§æ˜¯åˆ—è¡¨é¡¹çš„é«˜åº¦æ˜¯ç¡®å®šçš„æƒ…å†µï¼Œå¦å¤–ä¸€ç§æ˜¯åˆ—è¡¨é¡¹çš„é«˜åº¦æ˜¯ä¸ç¡®å®šçš„æƒ…å†µã€‚</p><p>å¦‚æœè®¾è®¡å¸ˆç»™çš„åˆ—è¡¨é¡¹çš„é«˜åº¦æ˜¯ç¡®å®šçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨å†™ä»£ç çš„æ—¶å€™ï¼Œå°±å¯ä»¥é€šè¿‡è·å–åˆ—è¡¨é¡¹å¸ƒå±€å±æ€§ getItemLayout å‘Šè¯‰ FlastListã€‚åœ¨åˆ—è¡¨é¡¹é«˜åº¦ç¡®å®šï¼Œä¸”çŸ¥é“æŒ‰éœ€æ¸²æŸ“åŒºåŸŸçš„æƒ…å†µä¸‹ï¼Œâ€œæ±‚æŒ‰éœ€æ¸²æŸ“åˆ—è¡¨é¡¹çš„ç´¢å¼•â€å°±æ˜¯ä¸€ä¸ªç®€å•çš„å››åˆ™è¿ç®—çš„é—®é¢˜ï¼Œç¨‹åºèƒ½å¤Ÿå‡†ç¡®åœ°è®¡ç®—å‡ºæ¥ã€‚</p><p>å¦‚æœè®¾è®¡å¸ˆç»™çš„ UI ç¨¿ä¸­æ˜¯ä¸å®šé«˜çš„åˆ—è¡¨é¡¹ï¼Œä¹Ÿå°±æ˜¯é«˜åº¦æ˜¯ç”±æ¸²æŸ“å†…å®¹å†³å®šçš„ã€‚ä½ å°±æ²¡æœ‰åŠæ³•åœ¨å†™ä»£ç çš„æ—¶å€™æŠŠåˆ—è¡¨é¡¹çš„é«˜åº¦å‘Šè¯‰ FlastList äº†ï¼Œé‚£ä¹ˆ FlastList å°±è¦å…ˆæŠŠåˆ—è¡¨é¡¹æ¸²æŸ“å‡ºæ¥æ‰èƒ½è·å–é«˜åº¦ã€‚å¯¹äºé«˜åº¦æœªçŸ¥çš„æƒ…å†µï¼ŒFlastList ä¼šå¯ç”¨åˆ—è¡¨é¡¹çš„å¸ƒå±€å›è°ƒå‡½æ•° onLayoutï¼Œåœ¨ onLayout ä¸­ä¼šæœ‰å¤§é‡çš„åŠ¨æ€æµ‹é‡é«˜åº¦çš„è®¡ç®—ï¼ŒåŒ…æ‹¬æ¯ä¸ªåˆ—è¡¨é¡¹çš„å‡†ç¡®é«˜åº¦å’Œæ•´ä½“çš„å¹³å‡é«˜åº¦ã€‚</p><p>åœ¨è¿™ç§åˆ—è¡¨é¡¹é«˜åº¦ä¸ç¡®å®šï¼Œè€Œä¸”ç»™å®šæŒ‰éœ€æ¸²æŸ“åŒºåŸŸçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ—è¡¨é¡¹çš„å¹³å‡é«˜åº¦ï¼ŒæŠŠæŒ‰éœ€æ¸²æŸ“åˆ—è¡¨é¡¹çš„ç´¢å¼•å¤§è‡´ä¼°ç®—å‡ºæ¥äº†ã€‚å³ä¾¿æœ‰è¯¯å·®ï¼Œæ¯”å¦‚é¢„è®¡æŒ‰éœ€æ¸²æŸ“åŒºåŸŸä¸ºä¸Šä¸‹ 10 ä¸ªå±å¹•ï¼Œå®é™…æ¸²æŸ“æ—¶åªæœ‰ä¸Šä¸‹ 7ã€8 ä¸ªå±å¹•ä¹Ÿæ˜¯èƒ½æ¥å—çš„ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ç”¨æˆ·æ˜¯æ„ŸçŸ¥ä¸åˆ°çš„å±å¹•å¤–å†…å®¹æ¸²æŸ“çš„ã€‚</p><p>ä½†æ˜¯ï¼Œå®é™…ç”Ÿäº§ä¸­ï¼Œå¦‚æœä½ ä¸å¡« getItemLayout å±æ€§ï¼Œä¸æŠŠåˆ—è¡¨é¡¹çš„é«˜åº¦æå‰å‘Šè¯‰ FlastListï¼Œè®© FlastList é€šè¿‡ onLayout çš„å¸ƒå±€å›è°ƒåŠ¨æ€è®¡ç®—ï¼Œç”¨æˆ·æ˜¯å¯ä»¥æ„Ÿè§‰åˆ°æ»‘åŠ¨å˜å¡çš„ã€‚å› æ­¤ï¼Œå¦‚æœä½ ä½¿ç”¨ FlastListï¼Œåˆæå‰çŸ¥é“åˆ—è¡¨é¡¹çš„é«˜åº¦ï¼Œæˆ‘å»ºè®®ä½ æŠŠ getItemLayout å±æ€§å¡«ä¸Šã€‚</p><p>ç¬¬ä¸‰æ­¥ï¼Œæ¸²æŸ“éœ€è¦æŒ‰éœ€æ¸²æŸ“åˆ—è¡¨é¡¹ã€‚æœ‰äº†ç´¢å¼•åï¼Œæ¸²æŸ“åˆ—è¡¨é¡¹å°±å˜å¾—å¾ˆç®€å•ï¼Œç”¨ setState å³å¯ã€‚</p><p>å‡è®¾ 1 ä¸ªå±å¹•é«˜åº¦çš„å†…å®¹ç”± 10 ä¸ªåˆ—è¡¨é¡¹ç»„æˆã€‚åœ¨é¦–æ¬¡æ¸²æŸ“çš„æ—¶å€™ï¼ŒæŒ‰éœ€æ¸²æŸ“çš„åˆ—è¡¨é¡¹ç´¢å¼•æ˜¯ 0~110ï¼Œè¿™æ—¶ä¼šæ¸²æŸ“ 11 ä¸ªå±å¹•é«˜åº¦çš„å†…å®¹ã€‚å½“ç”¨æˆ·æ»‘åˆ°ç¬¬ 11 ä¸ªå±å¹•æ—¶ï¼Œç´¢å¼•å°±æ˜¯ 0~210ï¼Œè¿™æ—¶å†åœ¨åé¢æ¸²æŸ“ 10 ä¸ªå±å¹•é«˜åº¦çš„å†…å®¹ã€‚å½“ç”¨æˆ·æ»‘åˆ°ç¬¬ 21 ä¸ªå±å¹•æ—¶ï¼Œç´¢å¼•æ˜¯ 100~310ï¼Œåˆä¼šå†åœ¨åé¢æ¸²æŸ“ 10 ä¸ªå±å¹•é«˜åº¦çš„å†…å®¹ï¼ŒåŒæ—¶æŠŠå‰é¢ 10 ä¸ªå±å¹•é«˜çš„å†…å®¹ç”¨ç©ºè§†å›¾ä»£æ›¿ã€‚å½“ç„¶è¿™ä¸ªè¿‡ç¨‹æ˜¯é¡ºæ»‘çš„ï¼Œåˆ—è¡¨é¡¹æ˜¯ä¸€ä¸ªä¸ªæ¸²æŸ“çš„ï¼Œè€Œä¸æ˜¯ 1 ä¸ªå±å¹•æˆ– 10 ä¸ªå±å¹•æ¸²æŸ“çš„ã€‚</p><h2>RecyclerListViewï¼šå¯å¤ç”¨çš„åˆ—è¡¨ç»„ä»¶</h2><p>èŠå®Œ FlastListï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸‹ RecyclerListViewã€‚</p><p>RecyclerListView æ˜¯å¼€æºç¤¾åŒºæä¾›çš„åˆ—è¡¨ç»„ä»¶ï¼Œå®ƒçš„åº•å±‚å®ç°å’Œ FlatList ä¸€æ ·ä¹Ÿæ˜¯ ScrollViewï¼Œå®ƒä¹Ÿè¦æ±‚å¼€å‘è€…å¿…é¡»å°†å†…å®¹æ•´ä½“åˆ†å‰²æˆä¸€ä¸ªä¸ªåˆ—è¡¨é¡¹ã€‚</p><p>åœ¨é¦–æ¬¡æ¸²æŸ“æ—¶ï¼ŒRecyclerListView åªä¼šæ¸²æŸ“é¦–å±å†…å®¹å’Œç”¨æˆ·å³å°†çœ‹åˆ°çš„å†…å®¹ï¼Œæ‰€ä»¥å®ƒçš„é¦–æ¬¡æ¸²æŸ“é€Ÿåº¦å¾ˆå¿«ã€‚åœ¨æ»šåŠ¨æ¸²æŸ“æ—¶ï¼Œåªä¼šæ¸²æŸ“å±å¹•å†…çš„å’Œå±å¹•é™„è¿‘ 250 åƒç´ çš„å†…å®¹ï¼Œè·ç¦»å±å¹•å¤ªè¿œçš„å†…å®¹æ˜¯ç©ºçš„ã€‚</p><p>React Native çš„ RecyclerListView å¤ç”¨çµæ„Ÿæ¥æºäº Native çš„å¯å¤ç”¨åˆ—è¡¨ç»„ä»¶ã€‚</p><p>åœ¨ iOS ä¸­ï¼Œè¡¨å•è§†å›¾ UITableViewï¼Œå®é™…å°±æ˜¯å¯ä»¥ä¸Šä¸‹æ»šåŠ¨ã€å·¦å³æ»šåŠ¨çš„å¯å¤ç”¨åˆ—è¡¨ç»„ä»¶ã€‚å®ƒå¯ä»¥é€šè¿‡å¤ç”¨å”¯ä¸€æ ‡è¯†ç¬¦ reuseIdentifierï¼Œæ ‡è®°è¡¨å•ä¸­çš„å¤ç”¨å•å…ƒ cellï¼Œå®ç°å•å…ƒ cell çš„å¤ç”¨ã€‚</p><p>åœ¨ Android ä¸Šï¼ŒåŠ¨æ€åˆ—è¡¨ RecyclerView åœ¨åˆ—è¡¨é¡¹è§†å›¾æ»šå‡ºå±å¹•æ—¶ï¼Œä¸ä¼šå°†å…¶é”€æ¯ï¼Œç›¸åä¼šæŠŠæ»šåŠ¨åˆ°å±å¹•å¤–çš„å…ƒç´ ï¼Œå¤ç”¨åˆ°æ»šåŠ¨åˆ°å±å¹•å†…çš„æ–°çš„åˆ—è¡¨é¡¹ä¸Šã€‚è¿™ç§å¤ç”¨æ–¹æ³•å¯ä»¥æ˜¾è‘—æé«˜æ€§èƒ½ï¼Œæ”¹å–„åº”ç”¨å“åº”èƒ½åŠ›ï¼Œå¹¶é™ä½åŠŸè€—ã€‚</p><p>å¦‚æœä½ åªå¼€å‘è¿‡ Webï¼Œä½ å¯ä»¥è¿™æ ·ç†è§£å¤ç”¨ï¼šåŸæ¥ä½ è¦é”€æ¯ä¸€ä¸ªæµè§ˆå™¨ä¸­ DOMï¼Œå†é‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„ DOMï¼Œç°åœ¨ä½ åªæ”¹å˜äº†åŸæœ‰ DOM çš„å±æ€§ï¼Œå¹¶æŠŠåŸæœ‰çš„ DOM æŒªåˆ°æ–°çš„ä½ç½®ä¸Šã€‚</p><p>RecyclerListView çš„å¤ç”¨æœºåˆ¶æ˜¯è¿™æ ·çš„ï¼Œä½ å¯ä»¥æŠŠåˆ—è¡¨æ¯”ä½œæ•°ç»„ listï¼ŒæŠŠåˆ—è¡¨é¡¹ç±»æ¯”æˆæ•°ç»„çš„å…ƒç´ ã€‚ç”¨æˆ·ç§»åŠ¨ ScrollView æ—¶ï¼Œç›¸å½“äºå¾€æ•°ç»„ list åé¢ push æ–°çš„å…ƒç´ å¯¹è±¡ï¼Œè€Œ RecyclerListView ç›¸å½“äºæŠŠ list çš„ç¬¬ä¸€é¡¹æŒªåˆ°äº†æœ€åä¸€é¡¹ä¸­ã€‚æŒªåŠ¨å¯¹è±¡ä½ç½®ç”¨åˆ°çš„è®¡ç®—èµ„æºå°‘ï¼Œä¹Ÿä¸ç”¨åœ¨å†…å­˜ä¸­å¼€è¾Ÿä¸€ä¸ªæ–°çš„ç©ºé—´ã€‚è€Œåˆ›å»ºæ–°çš„å¯¹è±¡ï¼Œå ç”¨è®¡ç®—èµ„æºå¤šï¼ŒåŒæ—¶å ç”¨æ–°çš„å†…å­˜ç©ºé—´ã€‚</p><p>ç®€è€Œè¨€ä¹‹ï¼ŒRecyclerListView åœ¨æ»šåŠ¨æ—¶å¤ç”¨äº†åˆ—è¡¨é¡¹ï¼Œè€Œä¸æ˜¯åˆ›å»ºæ–°çš„åˆ—è¡¨é¡¹ï¼Œå› æ­¤æ€§èƒ½å¥½ã€‚</p><h2>ä»ä½¿ç”¨æ–¹å¼çœ‹åº•å±‚åŸç†</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä» RecyclerListView ä½¿ç”¨æ–¹å¼çš„è§’åº¦ï¼Œè¿›ä¸€æ­¥åœ°å‰–æå…¶åº•å±‚åŸç†ã€‚</p><p>RecyclerListView æœ‰ä¸‰ä¸ªå¿…å¡«å‚æ•°ï¼š</p><ul>\n<li>åˆ—è¡¨æ•°æ®ï¼šdataProvider(dp)ï¼›</li>\n<li>åˆ—è¡¨é¡¹çš„å¸ƒå±€æ–¹æ³•ï¼šlayoutProviderï¼›</li>\n<li>åˆ—è¡¨é¡¹çš„æ¸²æŸ“å‡½æ•°ï¼šrowRendererã€‚</li>\n</ul><p>å…ˆæ¥çœ‹<strong>ç¬¬ä¸€ä¸ªå¿…å¡«å‚æ•°åˆ—è¡¨æ•°æ® dataProviderï¼ˆdpï¼‰</strong>ã€‚ä¸ºäº†åŒºåˆ†åˆ—è¡¨æ•°æ® dataProviderï¼ˆç¬¬ä¸€ä¸ªå­—æ¯å°å†™ï¼‰å’Œåˆ—è¡¨æ•°æ®ç±» DataProviderï¼ˆç¬¬ä¸€ä¸ªå­—æ¯å¤§å†™ï¼‰ï¼Œåé¢æˆ‘ä¼šç”¨ç¼©å†™ dp æ¥ä»£æ›¿åˆ—è¡¨æ•°æ®ï¼Œå…¶ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><pre><code class=\"language-plain\">const listData = Array(300).fill(1).map( (_,i) =&gt; i)\n\nconst dp = new DataProvider((r1, r2) =&gt; {\n   return r1 !== r2;\n});\n\nthis.state = {\n    dataProvider: dp.cloneWithRows(listData),\n};\n\nthis.setState({\n  dataProvider: dp.cloneWithRows(newListData),\n})\n</code></pre><p>åœ¨ä¸Šé¢ä»£ç ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆé€šè¿‡ Array(300) åˆ›å»ºäº†ä¸€ä¸ªé•¿åº¦ä¸º 300 çš„æ•°ç»„ listDataï¼Œå…¶å†…å®¹æ˜¯ 0~299 çš„æ•°å­—ï¼Œæˆ‘ä»¬é€šè¿‡å®ƒæ¥æ¨¡æ‹Ÿ 300 æ¡ä¿¡æ¯æ•°æ®ã€‚</p><p>æ¥ç€ï¼Œdp æ˜¯åˆ—è¡¨æ•°æ®ç±» DataProvider new å‡ºæ¥çš„å¯¹è±¡ï¼Œå®ƒæ˜¯ä¸€ä¸ªå­˜æ”¾ listData çš„æ•°æ®å®¹å™¨ã€‚å®ƒæœ‰ä¸€ä¸ªå¿…å¡«å‚æ•°ï¼Œå°±æ˜¯å¯¹æ¯”å‡½æ•°ã€‚åœ¨åˆ—è¡¨é¡¹å¤ç”¨æ—¶ï¼Œå¯¹æ¯”å‡½æ•°ä¼šé¢‘ç¹åœ°è°ƒç”¨ï¼Œå› æ­¤æˆ‘ä»¬åªæ¨èå¯¹æ›´æ–°æ•°æ®è¿›è¡Œ r1 !== r2 çš„æµ…å¯¹æ¯”ï¼Œä¸æ¨èæ·±å¯¹æ¯”ã€‚</p><p>ç¬¬ä¸‰éƒ¨åˆ†ä»£ç ï¼Œæ˜¯æˆ‘ä»¬è°ƒç”¨ dp.cloneWithRow æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ listData æ•°ç»„ä½œä¸ºå‚æ•°ï¼Œè¿™æ—¶æˆ‘ä»¬æ­£å¼æŠŠ listData è£…åˆ°äº† dp å®¹å™¨ä¸­ã€‚å…¶è¿”å›å€¼ dataProviderï¼Œå°±æ˜¯ React çš„åˆ—è¡¨çŠ¶æ€ã€‚</p><p>ç¬¬å››éƒ¨åˆ†ä»£ç ï¼Œæ˜¯æˆ‘ä»¬è°ƒç”¨ setState æ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ¥æ”¶ dp.cloneWithRows()  çš„è¿”å›çš„ dp å¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œdp åˆ—è¡¨æ•°æ®å¯¹è±¡æ›´æ–°äº†ï¼Œæ•´ä¸ªåˆ—è¡¨ä¹Ÿå°±æ›´æ–°äº†ã€‚</p><p>æ¥ä¸‹æ¥æ˜¯<strong>ç¬¬äºŒä¸ªå¿…å¡«å‚æ•°ï¼Œåˆ—è¡¨é¡¹çš„å¸ƒå±€æ–¹æ³• layoutProviderã€‚</strong></p><pre><code class=\"language-plain\">const _layoutProvider = new LayoutProvider(\n  index =&gt; {\n    if (index % 3 === 0) {\n      return ViewTypes.FULL;\n    } else {\n      return ViewTypes.HALF_RIGHT;\n    }\n  },\n  (type, dimension) =&gt; {\n    switch (type) {\n      case ViewTypes.HALF_RIGHT:\n        dimension.width = width / 2;\n        dimension.height = 160;\n        break;\n      case ViewTypes.FULL:\n        dimension.width = width;\n        dimension.height = 140;\n        break;\n    }\n  },\n);\n</code></pre><p>layoutProvider ç±»åˆå§‹åŒ–æ—¶ï¼Œæœ‰ä¸¤ä¸ªå‡½æ•°å…¥å‚ã€‚ç¬¬ä¸€ä¸ªå…¥å‚å‡½æ•°æ˜¯é€šè¿‡ç´¢å¼• index è·å–ç±»å‹ typeï¼Œå¯¹åº”çš„æ˜¯ç±»å‹å¯æšä¸¾ã€‚ç¬¬äºŒä¸ªå…¥å‚å‡½æ•°æ˜¯é€šè¿‡ç±»å‹ type å’Œå¸ƒå±€å°ºå¯¸ dimension è·å–æ¯ä¸ªç±»å‹çš„å®½é«˜ width å’Œ heightï¼Œå¯¹åº”çš„æ˜¯ç¡®å®šå®½é«˜ã€‚</p><p>ç”¨èµ·æ¥å¾ˆç®€å•ï¼Œä½†è¿™ä¸¤ä¸ªå…¥å‚ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆè®¾è®¡ï¼Œå®ƒä»¬æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</p><p>ä½¿ç”¨åˆ—è¡¨ç»„ä»¶ RecyclerListView æœ‰ä¸¤ä¸ªå‰æï¼šé¦–å…ˆæ˜¯åˆ—è¡¨é¡¹çš„å®½é«˜å¿…é¡»æ˜¯ç¡®å®šçš„ï¼Œæˆ–è€…æ˜¯å¤§è‡´ç¡®å®šçš„ï¼›ç¬¬äºŒæ˜¯åˆ—è¡¨é¡¹çš„ç±»å‹å¿…é¡»æ˜¯å¯æšä¸¾çš„ã€‚è¿™ä¸¤ä¸ªå‰æï¼Œéƒ½ä½“ç°åœ¨äº†åˆ—è¡¨é¡¹çš„å¸ƒå±€æ–¹æ³• layoutProvider ä¸­äº†ã€‚</p><p>å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªå‰æï¼Œå®½é«˜å¿…é¡»ç¡®å®šã€‚RecyclerListView ç”¨çš„æ˜¯ position:absolute çš„ç»å¯¹å®šä½å¸ƒå±€ï¼Œæ‰€æœ‰çš„åˆ—è¡¨é¡¹çš„å®½åº¦ widthã€é«˜åº¦ heightã€é¡¶éƒ¨åç§»é‡ topã€å·¦è¾¹åç§»é‡ left éƒ½å¾—åœ¨å¸ƒå±€ä¹‹å‰è®¡ç®—å‡ºæ¥ã€‚</p><p>ä½†å®é™…ä¸Šå¸ƒå±€æ–¹æ³• layoutProviderï¼Œåªéœ€è¦çŸ¥é“åˆ—è¡¨é¡¹çš„å®½ï¼ˆwidthï¼‰ã€é«˜ï¼ˆheightï¼‰å°±å¯ä»¥äº†ï¼Œåç§»é‡ topã€left å¯ä»¥æ ¹æ®å®½é«˜æ¨ç®—å‡ºæ¥ã€‚æ¯”å¦‚ï¼Œç¬¬ N ä¸ªåˆ—è¡¨é¡¹çš„åç§»é‡ top å€¼ï¼Œå®é™…ç­‰äºå‰é¢ N - 1 ä¸ªåˆ—è¡¨é¡¹çš„é«˜åº¦ä¹‹å’Œã€‚</p><p>å¦‚æœå®½é«˜ä¸ç¡®å®šå‘¢ï¼Ÿåˆ†ä¸¤ç§æƒ…å†µï¼Œä¸€ç§å°±æ˜¯ä¸ç¡®å®šçš„ï¼Œå¦ä¸€ç§æ˜¯ä¸ç¡®å®šä½†å¯ä»¥è½¬æ¢ä¸ºå¤§è‡´ç¡®å®šçš„ã€‚å¯¹äºå°±æ˜¯ä¸ç¡®å®šçš„æƒ…å†µï¼ŒRecyclerListView æ˜¯æ— è§£çš„ï¼›å¯¹äºå¤§è‡´ç¡®å®šçš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥å¼€å¯ forceNonDeterministicRendering å°å¹…ä¿®æ­£å¸ƒå±€ä½ç½®ã€‚</p><p>æ¯”å¦‚ï¼Œä¿¡æ¯æµçš„æ ‡é¢˜æ–‡å­—å°‘çš„æ—¶å€™æ˜¯ä¸€è¡Œå¸ƒå±€ï¼Œæ–‡å­—å¤šçš„æ—¶å€™æ˜¯ä¸¤è¡Œå¸ƒå±€ï¼Œä¸€è¡Œä¸¤è¡Œçš„é«˜åº¦åå·®ä¸å¤§ï¼Œå¯ä»¥åœ¨æ¸²æŸ“åè®©æ¡†æ¶å¸®å¿™è¿›è¡Œå°å¹…ä¿®æ­£ã€‚é€šå¸¸åœ¨ç”¨æˆ·çœ‹åˆ°ä¹‹å‰ï¼Œè¿™ç§å°å¹…ä¿®æ­£å°±å·²ç»å®Œæˆäº†ï¼Œç”¨æˆ·æ„ŸçŸ¥ä¸åˆ°åˆ—è¡¨çš„åç§»ã€‚</p><p>ä½†å¦‚æœæ˜¯ä¿¡æ¯æµçš„å†…å®¹é«˜åº¦ä¸ç¡®å®šï¼Œç›¸å·®ç™¾æ¥ä¸ªåƒç´ ï¼Œè¿™ç§å¤§å¹…ä¿®æ­£å¯èƒ½ä¼šè®©ç”¨æˆ·å¯Ÿè§‰åˆ°ï¼Œä¸é€‚åˆä½¿ç”¨ RecyclerListView ã€‚</p><p>å†æ¥çœ‹ç¬¬äºŒä¸ªå‰æï¼Œç±»å‹å¯æšä¸¾ã€‚å¯æšä¸¾å¾ˆå¥½ç†è§£ï¼Œä¸¤ä¸ªåˆ—è¡¨é¡¹çš„åº•å±‚ UI è§†å›¾å¿…é¡»ä¸€æ ·æˆ–è€…å¤§è‡´ç›¸ä¼¼ï¼Œæ‰èƒ½åªæ”¹åˆ—è¡¨æ•°æ®å¤ç”¨åˆ—è¡¨è§†å›¾ã€‚å¦‚æœæ¯ä¸ªåˆ—è¡¨é¡¹çš„ JSX ç»“æ„å®Œå…¨ä¸ä¸€æ ·ï¼Œå°±ä¸å­˜åœ¨å¤ç”¨çš„å¯èƒ½æ€§ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ªç±»å‹å¯¹åº”ä¸€ä¸ªè‡ªå®šä¹‰ç»„ä»¶ã€‚</p><p>ç†è§£äº†ç¡®å®šå®½é«˜å’Œç±»å‹å¯æšä¸¾ä¸¤ä¸ªå‰æåï¼Œä½ å†æ¥çœ‹å¸ƒå±€æ–¹æ³• layoutProvider éœ€è¦çš„ä¸¤ä¸ªå‡½æ•°å…¥å‚ï¼Œå°±èƒ½æ¸…æ¥šå®ƒçš„åŸå› äº†ã€‚</p><p>æœ€åæ˜¯<strong>ç¬¬ä¸‰ä¸ªå¿…å¡«å‚æ•°ï¼Œåˆ—è¡¨é¡¹çš„æ¸²æŸ“å‡½æ•°ï¼šrowRendererã€‚</strong></p><p>æœ‰äº†æ•°æ®ã€å¸ƒå±€ï¼Œè¿˜å¾—æœ‰ç»„ä»¶è¿›è¡Œæ‰¿è½½ã€‚åˆ—è¡¨å†…å®¹è¢«åˆ†å‰²æˆäº†ä¸€ä¸ªä¸ªçš„åˆ—è¡¨é¡¹ï¼Œæ¯ä¸€ä¸ªåˆ—è¡¨é¡¹å±•ç¤ºéƒ½æ˜¯ç‹¬ç«‹çš„å†…å®¹ä¿¡æ¯ï¼Œè€Œå¯æšä¸¾çš„åˆ—è¡¨é¡¹ç»„ä»¶ç”¨äºæ‰¿è½½æ¯æ¡ä¿¡æ¯çš„è½½ä½“ã€‚åˆ—è¡¨é¡¹çš„æ¸²æŸ“å‡½æ•° rowRenderer çš„ä½œç”¨å°±æ˜¯æ ¹æ®ç±»å‹å’Œæ•°æ®ï¼Œè¿”å›å¯¹åº”çš„è‡ªå®šä¹‰åˆ—è¡¨é¡¹ç»„ä»¶ã€‚è¿™å—é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œæˆ‘å°±ä¸åšè¿‡å¤šè®²è§£äº†ã€‚</p><p>rowRenderer çš„å¯¹åº”ä»£ç ï¼Œæˆ‘ä¹Ÿæ”¾åœ¨äº†è¿™é‡Œï¼Œä½ å¯ä»¥å¯¹ç…§æŸ¥çœ‹ï¼š</p><pre><code class=\"language-plain\">//Given type and data return the view component\n  _rowRenderer(type, data) {\n    //You can return any view here, CellContainer has no special significance\n    switch (type) {\n      case ViewTypes.HALF_RIGHT:\n        return (\n          &lt;CellContainer style={styles.containerGridRight}&gt;\n            &lt;Text&gt;Data: {data}&lt;/Text&gt;\n          &lt;/CellContainer&gt;\n        );\n      case ViewTypes.FULL:\n        return (\n          &lt;CellContainer style={styles.container}&gt;\n            &lt;Text&gt;Data: {data}&lt;/Text&gt;\n          &lt;/CellContainer&gt;\n        );\n      default:\n        return null;\n    }\n  }\n</code></pre><h2>PKï¼šScrollViewã€FlatListã€RecyclerListView</h2><p>åˆ°è¿™é‡Œï¼Œæˆ‘ç›¸ä¿¡ä½ å·²ç»å¯¹ ScrollViewã€FlatList å’Œ RecyclerListView åº•å±‚åŸç†æœ‰äº†ä¸€å®šçš„äº†è§£ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å†æ¨ªå‘å¯¹æ¯”ä¸€ä¸‹è¿™ä¸‰ä¸ªç»„ä»¶ï¼Œå¸®ä½ åŠ æ·±ç†è§£ã€‚</p><p>ä»åº•å±‚åŸç†çœ‹ï¼š</p><ul>\n<li>ScrollView å†…å®¹çš„å¸ƒå±€æ–¹å¼æ˜¯ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡æ’åˆ—çš„ï¼Œä½ ç»™å¤šå°‘å†…å®¹ï¼ŒScrollView å°±ä¼šæ¸²æŸ“å¤šå°‘å†…å®¹ï¼›</li>\n<li>FlatList å†…å®¹çš„å¸ƒå±€æ–¹å¼è¿˜æ˜¯ä»ä¸Šåˆ°ä¸‹ä¾æ¬¡æ’åˆ—çš„ï¼Œå®ƒé€šè¿‡æ›´æ–°ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªåˆ—è¡¨é¡¹çš„ç´¢å¼•æ§åˆ¶æ¸²æŸ“åŒºåŸŸï¼Œé»˜è®¤æ¸²æŸ“å½“å‰å±å¹•å’Œä¸Šä¸‹ 10 å±å¹•é«˜åº¦çš„å†…å®¹ï¼Œå…¶ä»–åœ°æ–¹ç”¨ç©ºç™½è§†å›¾è¿›è¡Œå ä½ï¼›</li>\n<li>RecyclerListView æ€§èƒ½æœ€å¥½ï¼Œä½ åº”è¯¥ä¼˜å…ˆä½¿ç”¨å®ƒï¼Œä½†ä½¿ç”¨å®ƒçš„å‰ææ˜¯åˆ—è¡¨é¡¹ç±»å‹å¯æšä¸¾ä¸”é«˜åº¦ç¡®å®šæˆ–å¤§è‡´ç¡®å®šã€‚</li>\n</ul><p>ç†è§£äº†åº•å±‚åŸç†ï¼ŒFlatList å’Œ RecyclerListView å­°å¼ºå­°å¼±ï¼Œç›¸ä¿¡ä½ å·²ç»æœ‰äº†ç­”æ¡ˆã€‚</p><p>å†…å­˜ä¸Šï¼ŒFlatList  è¦ç®¡ç† 21 ä¸ªå±å¹•é«˜åº¦çš„å†…å®¹ï¼Œè€Œ RecyclerListView åªè¦ç®¡ç†å¤§æ¦‚ 1 ä¸ªå¤šç‚¹å±å¹•é«˜åº¦çš„å†…å®¹ï¼ŒRecyclerListView ä½¿ç”¨çš„å†…å­˜è‚¯å®šå°‘ã€‚è®¡ç®—é‡ä¸Šï¼ŒFlatList  è¦å®æ—¶åœ°é”€æ¯æ–°å»º Native çš„ UI è§†å›¾ï¼ŒRecyclerListView åªæ˜¯æ”¹å˜ UI è§†å›¾çš„å†…å®¹å’Œä½ç½®ï¼ŒRecyclerListView åœ¨ UI ä¸»çº¿ç¨‹è®¡ç®—é‡è‚¯å®šå°‘ã€‚</p><p>ä½ ä¹Ÿå¯ä»¥è‡ªå·±å®é™…çš„ä½“éªŒã€çœ‹çœ‹æ€§èƒ½æŒ‡æ ‡æˆ–è€… Debug ä¸€ä¸‹ï¼Œæ¥ä½è¯ä½ çš„ç»“è®ºã€‚</p><p>ç†è§£äº†åº•å±‚åŸç†ï¼ŒScrollViewã€FlatList å’Œ RecyclerListView ä½¿ç”¨åœºæ™¯ï¼Œä¼°è®¡ä½ ä¹Ÿèƒ½åŸºæœ¬æŠŠæ¡ä½äº†ï¼š</p><ul>\n<li>ScrollView é€‚åˆå†…å®¹å°‘çš„é¡µé¢ï¼Œåªæœ‰å‡ ä¸ªå±å¹•é«˜é¡µé¢æ˜¯é€‚åˆçš„ï¼›</li>\n<li>FlatList æ€§èƒ½è¿˜è¿‡å¾—å»ï¼Œä½†æˆ‘ä¸æ¨èä½ ä¼˜å…ˆä½¿ç”¨å®ƒï¼Œåªæœ‰åœ¨ä½ çš„åˆ—è¡¨é¡¹å†…å®¹é«˜åº¦ä¸èƒ½äº‹å…ˆç¡®å®šï¼Œæˆ–è€…ä¸å¯æšä¸¾çš„æƒ…å†µä¸‹ä½¿ç”¨å®ƒï¼›</li>\n<li>RecyclerListView æ€§èƒ½æœ€å¥½ï¼Œä½ åº”è¯¥ä¼˜å…ˆä½¿ç”¨å®ƒï¼Œä½†ä½¿ç”¨å®ƒçš„å‰ææ˜¯å¯æšä¸¾ä¸”é«˜åº¦ç¡®å®šæˆ–å¤§è‡´ç¡®å®šã€‚</li>\n</ul><p>è¿™é‡Œæˆ‘ä¹Ÿæ€»ç»“æˆäº†ä¸¤å¼ å›¾è¡¨ï¼Œä½ å¯ä»¥çœ‹çœ‹ï¼š</p><p><img src=\"https://static001.geekbang.org/resource/image/e9/71/e9572yy831332ba1fb8baf0a48bc7e71.png?wh=1920x1050\" alt=\"å›¾ç‰‡\"></p><p><img src=\"https://static001.geekbang.org/resource/image/e6/a0/e6cb77f6425810e752abbeb643dbb9a0.png?wh=1870x964\" alt=\"å›¾ç‰‡\"></p><h2>æ€»ç»“</h2><p>æœ€åï¼Œæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ä»Šå¤©è¿™èŠ‚è¯¾æ‰€è®²çš„é‡ç‚¹ï¼š</p><ol>\n<li>æ»šåŠ¨ç»„ä»¶ ScrollView æ˜¯åˆ—è¡¨ç»„ä»¶ FlastList å’Œ RecyclerListView çš„åº•å±‚å®ç°ï¼ŒScrollView çš„ç»å¤§éƒ¨åˆ†å±æ€§åœ¨ FlastList å’Œ RecyclerListView ä¸Šéƒ½æœ‰ï¼›</li>\n<li>ä»æŒ‰éœ€æ¸²æŸ“çš„å¯è§†åŒºåŸŸçš„å¤§å°å’Œå¯¹åº•å±‚ UI è§†å›¾çš„æ“ä½œæ–¹å¼ä¸Šåˆ†æï¼ŒRecyclerListView æ¯” FlastList çš„å†…å­˜æ›´å°‘ï¼Œåœ¨ UI çº¿ç¨‹çš„è®¡ç®—é‡ä¹Ÿæ›´å°‘ï¼›</li>\n<li>ä¸ºäº†è®©ä½ çš„æ— é™åˆ—è¡¨æ€§èƒ½æ›´å¥½ï¼Œæˆ‘æ¨èä½ ä¼˜å…ˆä½¿ç”¨ RecyclerListViewï¼Œç„¶åæ‰æ˜¯ FlastListã€‚</li>\n</ol><p>åˆ—è¡¨æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„è¯é¢˜ï¼Œç‰µæ¶‰åˆ°çš„æ€§èƒ½ä¼˜åŒ–ç»†èŠ‚å’Œå®è·µå†…å®¹å¾ˆå¤šï¼Œè¿™ä¸€è®²å¯ä»¥ç®—ä½œåˆ—è¡¨çš„ä¸€ä¸ªå…¥é—¨ã€‚</p><p>å—é™äºæ‰‹æœºæ€§èƒ½ï¼Œæ— é™åˆ—è¡¨æ˜¯ç»å¸¸å‡ºç°æ€§èƒ½é—®é¢˜çš„é‡ç¾åŒºï¼Œæˆ‘ä¹Ÿå‚ä¸å’Œä¼˜åŒ–è¿‡ä¸€äº›éå¸¸å¤æ‚çš„æ— é™åˆ—è¡¨åœºæ™¯ï¼ŒåŒ…æ‹¬ Hybridã€å°ç¨‹åº å’Œ React Nativeï¼Œæœ‰è¿‡éå¸¸å¤šçš„å®è·µã€‚åœ¨åé¢çš„ç¯‡ç« ä¸­ï¼Œæˆ‘ä¼šåŸºäºè¿™äº›å…¥é—¨çŸ¥è¯†ï¼Œå’Œä½ è®²è®²å…·ä½“ä¸šåŠ¡ä¸­çš„å®è·µæ“ä½œï¼Œè¿˜æœ‰ä¸€äº›æ–°æ¶æ„ä¸­æ— é™åˆ—è¡¨çš„å˜åŒ–ã€‚</p><p>åœ¨è¿™ä¸€è®²ä¸­ï¼Œæˆ‘å¸Œæœ›ä½ èƒ½æŠŠåŸºç¡€æ‰“å¥½ï¼Œè‡ªå·±åŠ¨æ‰‹å®è·µä¸€ä¸‹ ScrollViewã€FlastList å’Œ RecyclerListViewã€‚åŒæ ·ï¼Œä»Šå¤©æˆ‘ä¹Ÿç»™ä½ ç•™äº†è¡¥å……ææ–™å’Œä½œä¸šã€‚</p><h2>è¡¥å……ææ–™</h2><h3>ä½¿ç”¨æ–‡æ¡£ï¼š</h3><ul>\n<li><a href=\"https://reactnative.dev/docs/scrollview\">ScrollView</a> å’Œ <a href=\"https://reactnative.dev/docs/flatlist\">FlatList</a> ä½ å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œè¿›ä¸€æ­¥å­¦ä¹ å®ƒä»¬çš„å…·ä½“ä½¿ç”¨ã€‚</li>\n<li>RecyclerListView ä½ å¯ä»¥åœ¨ Github ä¸Šæ‰¾åˆ°å®ƒçš„<a href=\"https://github.com/Flipkart/recyclerlistview\">æ–‡æ¡£</a>ï¼Œåœ¨ä½œè€…çš„åšå®¢<a href=\"https://medium.com/@naqvitalha/recyclerlistview-high-performance-listview-for-react-native-and-web-e368d6f0d7ef\">ã€ŠRecyclerListView: High performance ListView for React Native and Webã€‹</a>äº†è§£å®ƒçš„è¯ç”ŸèƒŒæ™¯ã€‚</li>\n</ul><h3>å®æˆ˜æŒ‡å—ï¼š</h3><ul>\n<li>RecyclerListView çš„å†…éƒ¨çŠ¶æ€æ˜¯ renderStack ç”¨äºç¡®å®šå“ªäº›è§†å›¾åº”è¯¥æ¸²æŸ“ï¼Œ<a href=\"https://github.com/Flipkart/recyclerlistview/blob/c80825fabe510a48ced722e2e6e9dc1b50e8e273/src/core/VirtualRenderer.ts#L213-L222\">å®ƒçš„å¤ç”¨æœºåˆ¶æ˜¯é€šè¿‡åˆ—è¡¨é¡¹çš„ç±»å‹ type æ‰¾åˆ°è¦è¢«å›æ”¶åˆ—è¡¨é¡¹ renderStack[key]ï¼Œç„¶åç”¨æ–°åˆ—è¡¨é¡¹ç´¢å¼• index æ›¿æ¢è¢«å›æ”¶çš„åˆ—è¡¨é¡¹ç´¢å¼• oldIndex</a>ã€‚</li>\n<li>RecyclerListView æ˜¯å¯ä»¥å®ç°é«˜åº¦ä¸ç¡®å®šçš„æ— é™åˆ—è¡¨çš„ã€‚å›¾ç‰‡çš„é«˜åº¦å¯ä»¥é€šè¿‡æœåŠ¡ç«¯äº‹å…ˆä¼ è¿‡æ¥ï¼Œæ–‡å­—çš„é«˜åº¦å¯ä»¥æŒ‰ç…§æˆ‘åœ¨<a href=\"https://mp.weixin.qq.com/s/kN4MxfEkvICq3JneUvM56w\">ã€ŠReact Native æ— é™åˆ—è¡¨çš„ä¼˜åŒ–ä¸å®è·µã€‹</a>ä¸€æ–‡ä¸­æä¾›çš„ç®—æ³•æå‰ç®—å‡ºæ¥ï¼Œå†å¼€å¯é«˜åº¦åŠ¨æ€ä¿®æ­£ã€‚</li>\n<li>RecyclerListView ä¹Ÿæ˜¯å¯ä»¥å®ç°ç€‘å¸ƒæµå¸ƒå±€çš„ã€‚RecyclerListView å…¶å®å°±æ˜¯ç»å¯¹å®šä½(x,y,width,height)ï¼Œä½†ä¸æ”¯æŒåŒåˆ—ï¼Œä½ å¯ä»¥ç”¨ <a href=\"https://github.com/ds300/patch-package\">patch-package</a> ï¼ŒæŠŠåº•å±‚è®¡ç®— layout ç”¨çš„ <a href=\"https://github.com/Flipkart/recyclerlistview/blob/782e6ebb0ed944a653e8c83eac9329cfa243410c/src/core/layoutmanager/LayoutManager.ts#L99-L105\">â€œrelayoutFromIndexâ€ å’Œ â€œthis._layoutsâ€ </a>æ”¹äº†ã€‚</li>\n<li>å®ƒä»¬çš„ Demo æˆ‘æ”¾åœ¨äº† <a href=\"https://github.com/jiangleo/react-native-classroom/tree/main/src/08_List\">GitHub</a> ä¸Šï¼Œä½ å¯ä»¥åŠ¨æ‰‹æŠŠç©ä¸€ä¸‹ã€‚</li>\n</ul><h2>ä½œä¸š</h2><ol>\n<li>è¯·ä½ ä½¿ç”¨ React Hook çš„è¯­æ³•å®ç°ä¸€ä¸ª RecyclerListView æ— é™åˆ—è¡¨ã€‚</li>\n<li>ä½ é‡åˆ°è¿‡é‚£äº›åˆ—è¡¨æ€§èƒ½é—®é¢˜åˆæ˜¯æ€ä¹ˆè§£å†³çš„ï¼Œèƒ½ä¸èƒ½å’Œæˆ‘ä»¬åˆ†äº«ä¸€ä¸‹ä½ çš„å¿ƒå¾—ï¼Ÿ</li>\n</ol><p>æ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ä½ çš„è§è§£ã€‚æˆ‘æ˜¯è’‹å®ä¼Ÿï¼Œå’±ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p>","comments":[{"had_liked":false,"id":344220,"user_name":"å¯ç†™","can_delete":false,"product_type":"c1","uid":1382231,"ip_address":"","ucode":"37B33ADD3A9681","user_header":"https://static001.geekbang.org/account/avatar/00/15/17/57/ac61fff9.jpg","comment_is_top":false,"comment_ctime":1651377199,"is_pvip":false,"replies":[{"id":125707,"content":"ä¸å»ºè®®ä¸€æ¬¡è¯·æ±‚å›æ¥ã€‚\n1. æ— é™åˆ—è¡¨ï¼Œç†è®ºä¸Šé¡µç æ˜¯æ— é™çš„ï¼Œä¸å¯èƒ½ä¸€æ¬¡è¯·æ±‚å›æ¥ã€‚å› æ­¤ï¼Œè¿˜éœ€è¦å¯¹è¯·æ±‚çš„æ•°æ®è¿›è¡Œåˆ†é¡µã€‚\n2. æ¨èä½¿ç”¨ react queryï¼Œå¸®ä½ åšåˆ—è¡¨çš„çŠ¶æ€ç®¡ç†ï¼Œåªéœ€é…ç½®ä¸€ä¸‹å°±èƒ½å¸®ä½ è‡ªåŠ¨ç®¡ç†æ— é™åˆ—è¡¨çš„åˆ†é¡µã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1088541,"ctime":1651502103,"ip_address":"","comment_id":344220,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"è€å¸ˆï¼Œ æŒ‰éœ€æ¸²æŸ“ç»„ä»¶ï¼Œæ•°æ®è¿˜éœ€è¦åˆ†é¡µåŠ è½½å—ï¼Ÿæ˜¯ä¸æ˜¯å¯ä»¥ä¸ç”¨åˆ†é¡µåŠ è½½ï¼Œä¸€æ¬¡æ€§æŠŠæ•°æ®è¯·æ±‚å›æ¥ï¼Œå®ƒä¼šè‡ªåŠ¨æŒ‰éœ€æ¸²æŸ“ã€‚","like_count":1,"discussions":[{"author":{"id":1088541,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9c/1d/f0f10198.jpg","nickname":"è’‹å®ä¼Ÿ","note":"","ucode":"02226CABD5ECE7","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":569639,"discussion_content":"ä¸å»ºè®®ä¸€æ¬¡è¯·æ±‚å›æ¥ã€‚\n1. æ— é™åˆ—è¡¨ï¼Œç†è®ºä¸Šé¡µç æ˜¯æ— é™çš„ï¼Œä¸å¯èƒ½ä¸€æ¬¡è¯·æ±‚å›æ¥ã€‚å› æ­¤ï¼Œè¿˜éœ€è¦å¯¹è¯·æ±‚çš„æ•°æ®è¿›è¡Œåˆ†é¡µã€‚\n2. æ¨èä½¿ç”¨ react queryï¼Œå¸®ä½ åšåˆ—è¡¨çš„çŠ¶æ€ç®¡ç†ï¼Œåªéœ€é…ç½®ä¸€ä¸‹å°±èƒ½å¸®ä½ è‡ªåŠ¨ç®¡ç†æ— é™åˆ—è¡¨çš„åˆ†é¡µã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1651502103,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":341718,"user_name":"å±±æ–‡å®‹","can_delete":false,"product_type":"c1","uid":1456101,"ip_address":"","ucode":"D45AA950BDEDE8","user_header":"https://static001.geekbang.org/account/avatar/00/16/37/e5/92cf5c98.jpg","comment_is_top":false,"comment_ctime":1649804126,"is_pvip":false,"replies":[{"id":124893,"content":"åœ¨ç”Ÿæ€ç¯‡çš„ã€ŠReact Native Awesomeã€‹ä¼šæœ‰ä»‹ç»ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1088541,"ctime":1649907066,"ip_address":"","comment_id":341718,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"è€å¸ˆï¼Œæœ‰æ¯”è¾ƒå¥½çš„RNçš„ä¹¦æˆ–è€…èµ„æ–™æ¨èå—ï¼Ÿ","like_count":1,"discussions":[{"author":{"id":1088541,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9c/1d/f0f10198.jpg","nickname":"è’‹å®ä¼Ÿ","note":"","ucode":"02226CABD5ECE7","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":562914,"discussion_content":"åœ¨ç”Ÿæ€ç¯‡çš„ã€ŠReact Native Awesomeã€‹ä¼šæœ‰ä»‹ç»ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649907066,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":343502,"user_name":"æŒç»­æ€è€ƒæŒç»­åšçš„ç‰›ç‰›","can_delete":false,"product_type":"c1","uid":1060882,"ip_address":"","ucode":"3F8C050D0D6A02","user_header":"https://static001.geekbang.org/account/avatar/00/10/30/12/aa2d5cb3.jpg","comment_is_top":false,"comment_ctime":1650879930,"is_pvip":false,"replies":[{"id":125412,"content":"åªèƒ½é‡æ„äº† ListView ï¼Œç›®å‰ä¸æ”¯æŒå¤ç”¨ï¼Œæ€§èƒ½å¤ªå·®ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1088541,"ctime":1650944709,"ip_address":"","comment_id":343502,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"ç°åœ¨æ–°æ¶æ„é‡Œé¢åˆ†æ”¯ï¼Œ0.68ï¼Œæœ‰ç›¸åº”çš„listviewä¼˜åŒ–ä¹ˆï¼Ÿæ€ä¹ˆçœ‹ä¸åˆ°å¯¹åº”çš„scrollview osåº“ï¼Ÿrrc_scrollviewè¿™ä¸ªç»„ä»¶æ˜¯è¿˜æ²¡æœ‰å®Œæˆä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1088541,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9c/1d/f0f10198.jpg","nickname":"è’‹å®ä¼Ÿ","note":"","ucode":"02226CABD5ECE7","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":567572,"discussion_content":"åªèƒ½é‡æ„äº† ListView ï¼Œç›®å‰ä¸æ”¯æŒå¤ç”¨ï¼Œæ€§èƒ½å¤ªå·®ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650944709,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":343498,"user_name":"æŒç»­æ€è€ƒæŒç»­åšçš„ç‰›ç‰›","can_delete":false,"product_type":"c1","uid":1060882,"ip_address":"","ucode":"3F8C050D0D6A02","user_header":"https://static001.geekbang.org/account/avatar/00/10/30/12/aa2d5cb3.jpg","comment_is_top":false,"comment_ctime":1650877930,"is_pvip":false,"replies":[{"id":125413,"content":"å¯ä»¥ã€‚12è®²çš„ Github ä¸Šæœ‰ä»£ç ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1088541,"ctime":1650944763,"ip_address":"","comment_id":343498,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"å¯¹äºitemé«˜åº¦ä¼šå˜åŒ–çš„ï¼Œèƒ½é€‚é…ä¹ˆï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1088541,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9c/1d/f0f10198.jpg","nickname":"è’‹å®ä¼Ÿ","note":"","ucode":"02226CABD5ECE7","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":567574,"discussion_content":"å¯ä»¥ã€‚12è®²çš„ Github ä¸Šæœ‰ä»£ç ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650944763,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":342858,"user_name":"dao","can_delete":false,"product_type":"c1","uid":1087879,"ip_address":"","ucode":"4181FB270462CF","user_header":"https://static001.geekbang.org/account/avatar/00/10/99/87/5066026c.jpg","comment_is_top":false,"comment_ctime":1650509046,"is_pvip":false,"replies":[{"id":125235,"content":"ç»™åŠ¨æ‰‹èƒ½åŠ›ç‚¹èµğŸ‘\nä¸€ã€ä¼šå¼•èµ· RecyclerList ç»„ä»¶çš„ re-renderï¼Œä½†ä¸ä¼šå¼•èµ· ListItem ç»„ä»¶çš„ re- render ï¼Œä½ å¯æ‰“æ—¥å¿—è¯•è¯•ã€‚\näºŒã€  {loading &amp;&amp; &lt;Loading &#47;&gt;}ï¼Œå¼•èµ·äº†é«˜åº¦çš„æ”¹å˜ï¼Œæ‰€ä»¥æœ‰æŠ–åŠ¨ã€‚loading çŠ¶æ€åªæ”¹å˜æ–‡æ¡ˆå†…å®¹ï¼Œä¸æ§åˆ¶å…ƒç´ å‡ºç°å’Œæ¶ˆå¤±å°±ä¸ä¼šå¼•èµ·é«˜åº¦æ”¹å˜ã€‚\n","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1088541,"ctime":1650516180,"ip_address":"","comment_id":342858,"utype":1}],"discussion_count":2,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"ä½œä¸š \n1ï¼Œ https:&#47;&#47;github.com&#47;hdouhua&#47;hybrid-mobile-app&#47;tree&#47;main&#47;AwesomeProject&#47;src&#47;c08\n2ï¼Œ æ–°æ‰‹ï¼Œå·¥ä½œä¸­æ²¡æœ‰ä½¿ç”¨è¿‡ï¼Œä½œä¸šä¸­æœ‰ä¸‹é¢ä¸¤ä¸ªé—®é¢˜ï¼Œè¯·è€å¸ˆå¸®å¿™è§£ç­”ã€‚\nä¸€ï¼Œè®¾ç½® loading å±æ€§ä¼šå¼•èµ· RecyclerListView é‡æ–°æ¸²æŸ“\näºŒï¼Œå±å¹•ä¸‹æ–¹ â€œåŠ è½½æ›´å¤šâ€ æŒ‰é’®ï¼Œå±å¹•æœ‰ä¸€ç‚¹æŠ–åŠ¨","like_count":0,"discussions":[{"author":{"id":1087879,"avatar":"https://static001.geekbang.org/account/avatar/00/10/99/87/5066026c.jpg","nickname":"dao","note":"","ucode":"4181FB270462CF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":566217,"discussion_content":"æ„Ÿè°¢è€å¸ˆçš„å›å¤ã€‚\nre-render çš„é—®é¢˜ï¼Œæ‰“äº†æ—¥å¿—å‘ç°ä¹Ÿé‡æ–°æ¸²æŸ“äº† ListItem ï¼Œè§£å†³æ–¹å¼æ˜¯å°†å®ƒç”¨ React.memo è¾“å‡ºã€‚\nå…³äºåŠ è½½æ›´å¤šçš„æŠ–åŠ¨ï¼Œå³ä½¿æŠŠ Loading ç»„ä»¶ç§»é™¤ï¼Œä»ç„¶å­˜åœ¨é—®é¢˜ã€‚\næœ€å stackoverflow ä¸ŠæŸ¥åˆ°è¿™ä¸ª https://stackoverflow.com/questions/59573435/recyclerlistview-scrolls-to-top-onendreached-with-functional-component\nè§£å†³çš„å…³é”®æ˜¯ layoutProvider.shouldRefreshWithAnchoring = false ã€‚\nä¿®æ”¹äº†ä»¥ä¸Šå‡ ç‚¹ï¼Œæ•´ä¸ªæ— é™åˆ—è¡¨åŠ è½½æŒºå®Œç¾äº†ã€‚","likes_number":3,"is_delete":false,"is_hidden":false,"ctime":1650630897,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1088541,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9c/1d/f0f10198.jpg","nickname":"è’‹å®ä¼Ÿ","note":"","ucode":"02226CABD5ECE7","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":565686,"discussion_content":"ç»™åŠ¨æ‰‹èƒ½åŠ›ç‚¹èµğŸ‘\nä¸€ã€ä¼šå¼•èµ· RecyclerList ç»„ä»¶çš„ re-renderï¼Œä½†ä¸ä¼šå¼•èµ· ListItem ç»„ä»¶çš„ re- render ï¼Œä½ å¯æ‰“æ—¥å¿—è¯•è¯•ã€‚\näºŒã€  {loading &amp;&amp; &lt;Loading /&gt;}ï¼Œå¼•èµ·äº†é«˜åº¦çš„æ”¹å˜ï¼Œæ‰€ä»¥æœ‰æŠ–åŠ¨ã€‚loading çŠ¶æ€åªæ”¹å˜æ–‡æ¡ˆå†…å®¹ï¼Œä¸æ§åˆ¶å…ƒç´ å‡ºç°å’Œæ¶ˆå¤±å°±ä¸ä¼šå¼•èµ·é«˜åº¦æ”¹å˜ã€‚\n","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1650516180,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":342030,"user_name":"geeklyc","can_delete":false,"product_type":"c1","uid":1264061,"ip_address":"","ucode":"F25441AB6433B3","user_header":"https://static001.geekbang.org/account/avatar/00/13/49/bd/ae37990b.jpg","comment_is_top":false,"comment_ctime":1649984813,"is_pvip":false,"replies":[{"id":125006,"content":"æœ‰ï¼Œè§ 11 è®²å’Œ 12è®²","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1088541,"ctime":1649992949,"ip_address":"","comment_id":342030,"utype":1}],"discussion_count":1,"race_medal":5,"score":2,"product_id":100110101,"comment_content":"è€å¸ˆï¼Œæœ‰æ”¯æŒå¤šåˆ—ï¼Œç€‘å¸ƒæµçš„ä¸ã€‚RecyclerListView","like_count":0,"discussions":[{"author":{"id":1088541,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9c/1d/f0f10198.jpg","nickname":"è’‹å®ä¼Ÿ","note":"","ucode":"02226CABD5ECE7","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":563429,"discussion_content":"æœ‰ï¼Œè§ 11 è®²å’Œ 12è®²","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649992950,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":341739,"user_name":"Geek_e4a05b","can_delete":false,"product_type":"c1","uid":1093010,"ip_address":"","ucode":"C87428F72AF63B","user_header":"https://static001.geekbang.org/account/avatar/00/10/ad/92/98a1fd3c.jpg","comment_is_top":false,"comment_ctime":1649817236,"is_pvip":false,"replies":[{"id":124894,"content":"ä½ æ˜¯å°é£ä¾ ï¼Ÿ\næ˜¯çš„ï¼Œç°åœ¨æ€§èƒ½è¶Šæ¥è¶Šå¥½äº†ï¼Œä½†æˆ‘è¿˜æ˜¯æ¨è RecyclerListViewï¼Œå› ä¸ºä½ç«¯æœºåŠ è½½å¯èƒ½è¿˜æ˜¯ä¼šé‡åˆ°æ¸²æŸ“ windowSize å¤šå±çš„ç™½å±é—®é¢˜ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç¼–è¾‘","uid":1088541,"ctime":1649907304,"ip_address":"","comment_id":341739,"utype":1}],"discussion_count":1,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"RecyclerListView åœ¨å®‰å“åº•ç«¯æœºä¸Šæš´åŠ›æ»‘åŠ¨åº•éƒ¨æœ‰å¯èƒ½æœ‰é—ªåŠ¨æƒ…å†µã€‚RecyclerListViewå¦‚æœå¡ç‰‡é«˜åº¦ä¸å›ºå®šéœ€è¦æå‰è®¡ç®—å¡ç‰‡é«˜åº¦ï¼Œè¿™ä¸ªå¯èƒ½ä¼šç‰ºç‰²å±•ç¤ºæ—¶é—´ã€‚Flatlistå¯ä»¥é€šè¿‡æŒ‡å®šwindowSizeæ¥å‡å°‘ç™½å±å‡ºç°ï¼Œæ„Ÿè§‰æ€§èƒ½æ¯”ä¹‹å‰å¥½å¾ˆå¤šäº†ã€‚","like_count":0,"discussions":[{"author":{"id":1088541,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9c/1d/f0f10198.jpg","nickname":"è’‹å®ä¼Ÿ","note":"","ucode":"02226CABD5ECE7","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":562916,"discussion_content":"ä½ æ˜¯å°é£ä¾ ï¼Ÿ\næ˜¯çš„ï¼Œç°åœ¨æ€§èƒ½è¶Šæ¥è¶Šå¥½äº†ï¼Œä½†æˆ‘è¿˜æ˜¯æ¨è RecyclerListViewï¼Œå› ä¸ºä½ç«¯æœºåŠ è½½å¯èƒ½è¿˜æ˜¯ä¼šé‡åˆ°æ¸²æŸ“ windowSize å¤šå±çš„ç™½å±é—®é¢˜ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1649907304,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":"","group_id":0},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":378452,"user_name":"Luvian","can_delete":false,"product_type":"c1","uid":3681875,"ip_address":"ä¸Šæµ·","ucode":"010DEBFDC4D1C5","user_header":"https://static001.geekbang.org/account/avatar/00/38/2e/53/734a3675.jpg","comment_is_top":false,"comment_ctime":1690272646,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"ç°åœ¨æœ‰ä¸€ä¸ªæ–°çš„flashListï¼ŒåŸç†å’ŒrecycleListå·®ä¸å¤šï¼Œä½†æ˜¯ä½¿ç”¨æ›´ç®€å•","like_count":2},{"had_liked":false,"id":362491,"user_name":"Duke","can_delete":false,"product_type":"c1","uid":1014513,"ip_address":"é™•è¥¿","ucode":"ACB56A7C07C231","user_header":"https://static001.geekbang.org/account/avatar/00/0f/7a/f1/d785984a.jpg","comment_is_top":false,"comment_ctime":1668569286,"is_pvip":false,"replies":null,"discussion_count":1,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"æœ€åä¸€ä¸ªåˆ—è¡¨é¡¹å¯æšä¸¾æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1088541,"avatar":"https://static001.geekbang.org/account/avatar/00/10/9c/1d/f0f10198.jpg","nickname":"è’‹å®ä¼Ÿ","note":"","ucode":"02226CABD5ECE7","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":603202,"discussion_content":"UIç¨¿ä¸­ç»™åˆ—è¡¨é¡¹çš„æ ·å¼çš„ç§ç±»ï¼Œæ¯”å¦‚å·¦æ–‡å³å›¾ã€å·¦å›¾å³æ–‡ã€ICONså°±ç®—ä¸‰ç§ä¸åŒç§ç±»ï¼Œè¿™äº›ç§ç±»å¿…é¡»å¯ä»¥æšä¸¾ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1676015960,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"åŒ—äº¬","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":350039,"user_name":"IRONMAN","can_delete":false,"product_type":"c1","uid":3025357,"ip_address":"","ucode":"999D6739279846","user_header":"https://static001.geekbang.org/account/avatar/00/2e/29/cd/0e6994f8.jpg","comment_is_top":false,"comment_ctime":1656514717,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":2,"product_id":100110101,"comment_content":"ä½ å¥½ï¼Œè¿™ä¸ªæ˜¯æˆ‘å†™çš„rowRendererçš„å‡½æ•°:\n const _rowRenderer = (type,data)=&gt;{\n        console.log(data,data.name)\n        &#47;&#47;ç¼–å†™å¦‚ä½•æ¸²æŸ“æ•°æ®\n       return (\n        &lt;View style={{height:100}}&gt;\n             &lt;Text &gt;data&lt;&#47;Text&gt;\n          \n        &lt;&#47;View&gt;\n       )\n    }\n\nä½†æ˜¯åœ¨æ¨¡æ‹Ÿæ˜¾ç¤ºçš„æ—¶å€™å´æŠ¥é”™ï¼š\n  LayoutException: RecyclerListView needs to have a bounded size. Currently height or, width is 0.Consider adding style={{flex:1}} or, fixed dimensions\n\n     æˆ‘æ˜æ˜å·²ç»æ˜ç¡®äº†æ¯ä¸€ä¸ªåˆ—è¡¨é¡¹çš„heightï¼Œä¸ºä»€ä¹ˆè¿˜ä¼šæŠ¥é”™ï¼Ÿä½†æ˜¯ä¸€æ—¦æˆ‘é‡æ–°åˆ·æ–°ä¹‹åï¼ŒæŠ¥é”™å°±æ¶ˆå¤±äº†ï¼Œä½†æ˜¯æ§åˆ¶å°ä¸­å¹¶æ²¡æœ‰æ‰“å°æˆ‘åœ¨rowRendererå‡½æ•°ä¸­ä¸­æŒ‡å®šçš„ä¿¡æ¯ï¼Œæ‰€ä»¥ä¸ºä»€ä¹ˆrowRendererå‡½æ•°æ²¡æœ‰è¢«è°ƒç”¨ï¼Ÿ\n","like_count":0},{"had_liked":false,"id":350032,"user_name":"IRONMAN","can_delete":false,"product_type":"c1","uid":3025357,"ip_address":"","ucode":"999D6739279846","user_header":"https://static001.geekbang.org/account/avatar/00/2e/29/cd/0e6994f8.jpg","comment_is_top":false,"comment_ctime":1656513217,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100110101,"comment_content":"è€å¸ˆæˆ‘ç”¨å‡½æ•°ç»„ä»¶é‡æ–°å†™äº†ä¸€ä¸‹ä½ çš„demoï¼Œä¸ºä»€ä¹ˆRecycleListViewä¸­çš„å†…å®¹æ ¹æœ¬ä¸æ˜¾ç¤ºï¼Œé¡µé¢ä¸€ç¯‡ç©ºç™½ã€‚\nfunction  Scroll (props){\n    const {width} = useContext(devInfoContext)\n    &#47;&#47; const {data} =  props\n    const data = [1,2,3]\n\n    const [_dataProvider] = useState(new DataProvider((r1,r2)=&gt;{\n        return r1 !== r2\n    }))\n\n    &#47;&#47;å› ä¸ºå®¹å™¨å†…çš„æ•°æ®æ˜¯ä¸€ç›´åœ¨å˜åŒ–çš„ï¼Œæ‰€ä»¥éœ€è¦å®¹å™¨å†…éƒ¨çš„æ•°æ®ä¿å­˜åˆ°stateä¸­ï¼Œè¿›å…¥è®©å…¶ä¼šæ›´æ–°ç•Œé¢\n    const [dataProvider] = useState(_dataProvider.cloneWithRows(data))\n\n\n    const [_layoutProvider] = useState(new LayoutProvider(index=&gt;{\n        if (index % 3 === 0) {\n            return ViewTypes.FULL;\n          } else if (index % 20 === 0) {\n            return ViewTypes.HALF_LEFT;\n          } else {\n            return ViewTypes.HALF_RIGHT;\n          }\n    },(type,dim)=&gt;{\n        switch (type) {\n            case ViewTypes.HALF_LEFT:\n              dim.width = width &#47; 2 - 0.0001;\n              dim.height = 160;\n              break;\n            case ViewTypes.HALF_RIGHT:\n              dim.width = width &#47; 2;\n              dim.height = 160;\n              break;\n            case ViewTypes.FULL:\n              dim.width = width;\n              dim.height = 140;\n              break;\n            default:\n              dim.width = 0;\n              dim.height = 0;\n          }\n    }))\n&#47;&#47; console.log(dataProvider)\n    const _rowRenderer = (type,data)=&gt;{\n        console.log(data,data.name)\n        &#47;&#47;ç¼–å†™å¦‚ä½•æ¸²æŸ“æ•°æ®\n       return (\n        &lt;View style={{height:10}}&gt;\n           { [1,2,3].map(()=&gt;{\n               return  &lt;Text key={String(new Date().getUTCMilliseconds())}&gt;data&lt;&#47;Text&gt;\n            })}\n        &lt;&#47;View&gt;\n       )\n    }\n\n    return (\n        &lt;RecyclerListView\n            renderAheadOffset={100}\n            layoutProvider={_layoutProvider}\n            dataProvider={dataProvider}\n            rowRenderer={_rowRenderer}\n            style={{flex:1}}\n        \n        &#47;&gt;\n    )\n\n}","like_count":0},{"had_liked":false,"id":349958,"user_name":"å¤§é¾™é¾™é¾™","can_delete":false,"product_type":"c1","uid":2435368,"ip_address":"","ucode":"26C1A7C8A22AFA","user_header":"https://static001.geekbang.org/account/avatar/00/25/29/28/b6b73f57.jpg","comment_is_top":false,"comment_ctime":1656471389,"is_pvip":false,"replies":null,"discussion_count":0,"race_medal":0,"score":3,"product_id":100110101,"comment_content":"è€å¸ˆï¼Œ é—®ä¸€ä¸‹ ä¹‹å‰çš„ç« èŠ‚éƒ½æ˜¯ funcationå®ç°ç»„ä»¶ï¼Œ åˆ°è¿™é‡Œ æˆ‘çœ‹åˆ°demoé‡Œçš„recyclerlistview ä¸ºä»€ä¹ˆä½¿ç”¨ç±»æ¥å®ç°ç»„ä»¶äº†å‘¢ï¼Ÿ","like_count":0},{"had_liked":false,"id":347974,"user_name":"Aaaaaaaaaaayou","can_delete":false,"product_type":"c1","uid":1073601,"ip_address":"","ucode":"67BA315B87587D","user_header":"https://static001.geekbang.org/account/avatar/00/10/61/c1/93031a2a.jpg","comment_is_top":false,"comment_ctime":1654619745,"is_pvip":false,"replies":null,"discussion_count":2,"race_medal":0,"score":3,"product_id":100110101,"comment_content":"ä¸€èˆ¬ä¸šåŠ¡ä¸­åˆ—è¡¨æ•°æ®éƒ½æ˜¯åˆ†é¡µè¯·æ±‚çš„ï¼ŒæŒ‰ç…§æ–‡ä¸­çš„è¯´æ³•â€œå·²ç»æ¸²æŸ“å¥½çš„ç»„ä»¶æ»šåŠ¨æ˜¯è·Ÿjsæ²¡å…³ç³»çš„â€ï¼Œé‚£è¿™ç§åœºæ™¯æ˜¯ä¸æ˜¯ç”¨scrollviewå°±å¥½äº†ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":3681875,"avatar":"https://static001.geekbang.org/account/avatar/00/38/2e/53/734a3675.jpg","nickname":"Luvian","note":"","ucode":"010DEBFDC4D1C5","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":624178,"discussion_content":"åˆ†é¡µæ•°æ®ä¹Ÿæ˜¯è¦æ‹¼æ¥çš„ï¼Œä½ ç¿»é¡µå¤šäº†ï¼Œæ•°æ®å°±å¤šäº†ï¼Œè¿™æ—¶å€™scrollviewå…¨éƒ¨ç»™ä½ å±•ç¤ºäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1690276288,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2372639,"avatar":"","nickname":"æå®¢CEO","note":"","ucode":"BB61D4C694FAFF","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":589906,"discussion_content":"ä½ è¶Šæ»šï¼Œscrollviewåˆ—è¡¨å°±è¶Šé•¿ï¼Œå†…å­˜å°±è¶Šå¤§ï¼Œæ‰‹æœºä¼šå¡","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1665390445,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"ä¸Šæµ·","group_id":0},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}