{"id":41154,"title":"19 | 深入理解StatefulSet（二）：存储状态","content":"<p>你好，我是张磊。今天我和你分享的主题是：深入理解StatefulSet之存储状态。</p><p>在上一篇文章中，我和你分享了StatefulSet如何保证应用实例的拓扑状态，在Pod删除和再创建的过程中保持稳定。</p><p>而在今天这篇文章中，我将继续为你解读StatefulSet对存储状态的管理机制。这个机制，主要使用的是<span class=\"orange\">一个叫作Persistent Volume Claim的功能。</span></p><p>在前面介绍Pod的时候，我曾提到过，要在一个Pod里声明Volume，只要在Pod里加上spec.volumes字段即可。然后，你就可以在这个字段里定义一个具体类型的Volume了，比如：hostPath。</p><p>可是，你有没有想过这样一个场景：<strong>如果你并不知道有哪些Volume类型可以用，要怎么办呢</strong>？</p><p>更具体地说，作为一个应用开发者，我可能对持久化存储项目（比如Ceph、GlusterFS等）一窍不通，也不知道公司的Kubernetes集群里到底是怎么搭建出来的，我也自然不会编写它们对应的Volume定义文件。</p><p>所谓“术业有专攻”，这些关于Volume的管理和远程持久化存储的知识，不仅超越了开发者的知识储备，还会有暴露公司基础设施秘密的风险。</p><p>比如，下面这个例子，就是一个声明了Ceph RBD类型Volume的Pod：</p><!-- [[[read_end]]] --><pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: rbd\nspec:\n  containers:\n    - image: kubernetes/pause\n      name: rbd-rw\n      volumeMounts:\n      - name: rbdpd\n        mountPath: /mnt/rbd\n  volumes:\n    - name: rbdpd\n      rbd:\n        monitors:\n        - '10.16.154.78:6789'\n        - '10.16.154.82:6789'\n        - '10.16.154.83:6789'\n        pool: kube\n        image: foo\n        fsType: ext4\n        readOnly: true\n        user: admin\n        keyring: /etc/ceph/keyring\n        imageformat: &quot;2&quot;\n        imagefeatures: &quot;layering&quot;\n</code></pre><p>其一，如果不懂得Ceph RBD的使用方法，那么这个Pod里Volumes字段，你十有八九也完全看不懂。其二，这个Ceph RBD对应的存储服务器的地址、用户名、授权文件的位置，也都被轻易地暴露给了全公司的所有开发人员，这是一个典型的信息被“过度暴露”的例子。</p><p>这也是为什么，在后来的演化中，<strong>Kubernetes项目引入了一组叫作Persistent Volume Claim（PVC）和Persistent Volume（PV）的API对象，大大降低了用户声明和使用持久化Volume的门槛。</strong></p><p>举个例子，有了PVC之后，一个开发人员想要使用一个Volume，只需要简单的两步即可。</p><p><strong>第一步：定义一个PVC，声明想要的Volume的属性：</strong></p><pre><code>kind: PersistentVolumeClaim\napiVersion: v1\nmetadata:\n  name: pv-claim\nspec:\n  accessModes:\n  - ReadWriteOnce\n  resources:\n    requests:\n      storage: 1Gi\n</code></pre><p>可以看到，在这个PVC对象里，不需要任何关于Volume细节的字段，只有描述性的属性和定义。比如，storage: 1Gi，表示我想要的Volume大小至少是1 GiB；accessModes: ReadWriteOnce，表示这个Volume的挂载方式是可读写，并且只能被挂载在一个节点上而非被多个节点共享。</p><blockquote>\n<p>备注：关于哪种类型的Volume支持哪种类型的AccessMode，你可以查看Kubernetes项目官方文档中的<a href=\"https://kubernetes.io/docs/concepts/storage/persistent-volumes/#access-modes\">详细列表</a>。</p>\n</blockquote><p><strong>第二步：在应用的Pod中，声明使用这个PVC：</strong></p><pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: pv-pod\nspec:\n  containers:\n    - name: pv-container\n      image: nginx\n      ports:\n        - containerPort: 80\n          name: &quot;http-server&quot;\n      volumeMounts:\n        - mountPath: &quot;/usr/share/nginx/html&quot;\n          name: pv-storage\n  volumes:\n    - name: pv-storage\n      persistentVolumeClaim:\n        claimName: pv-claim\n</code></pre><p>可以看到，在这个Pod的Volumes定义中，我们只需要声明它的类型是persistentVolumeClaim，然后指定PVC的名字，而完全不必关心Volume本身的定义。</p><p>这时候，只要我们创建这个PVC对象，Kubernetes就会自动为它绑定一个符合条件的Volume。可是，这些符合条件的Volume又是从哪里来的呢？</p><p>答案是，它们来自于由运维人员维护的PV（Persistent Volume）对象。接下来，我们一起看一个常见的PV对象的YAML文件：</p><pre><code>kind: PersistentVolume\napiVersion: v1\nmetadata:\n  name: pv-volume\n  labels:\n    type: local\nspec:\n  capacity:\n    storage: 10Gi\n  accessModes:\n    - ReadWriteOnce\n  rbd:\n    monitors:\n    # 使用 kubectl get pods -n rook-ceph 查看 rook-ceph-mon- 开头的 POD IP 即可得下面的列表\n    - '10.16.154.78:6789'\n    - '10.16.154.82:6789'\n    - '10.16.154.83:6789'\n    pool: kube\n    image: foo\n    fsType: ext4\n    readOnly: true\n    user: admin\n    keyring: /etc/ceph/keyring\n</code></pre><p>可以看到，这个PV对象的spec.rbd字段，正是我们前面介绍过的Ceph RBD Volume的详细定义。而且，它还声明了这个PV的容量是10 GiB。这样，Kubernetes就会为我们刚刚创建的PVC对象绑定这个PV。</p><p>所以，Kubernetes中PVC和PV的设计，<strong>实际上类似于“接口”和“实现”的思想</strong>。开发者只要知道并会使用“接口”，即：PVC；而运维人员则负责给“接口”绑定具体的实现，即：PV。</p><p>这种解耦，就避免了因为向开发者暴露过多的存储系统细节而带来的隐患。此外，这种职责的分离，往往也意味着出现事故时可以更容易定位问题和明确责任，从而避免“扯皮”现象的出现。</p><p><span class=\"orange\">而PVC、PV的设计，也使得StatefulSet对存储状态的管理成为了可能。</span>我们还是以上一篇文章中用到的StatefulSet为例（你也可以借此再回顾一下<a href=\"https://time.geekbang.org/column/article/41017\">《深入理解StatefulSet（一）：拓扑状态》</a>中的相关内容）：</p><pre><code>apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: web\nspec:\n  serviceName: &quot;nginx&quot;\n  replicas: 2\n  selector:\n    matchLabels:\n      app: nginx\n  template:\n    metadata:\n      labels:\n        app: nginx\n    spec:\n      containers:\n      - name: nginx\n        image: nginx:1.9.1\n        ports:\n        - containerPort: 80\n          name: web\n        volumeMounts:\n        - name: www\n          mountPath: /usr/share/nginx/html\n  volumeClaimTemplates:\n  - metadata:\n      name: www\n    spec:\n      accessModes:\n      - ReadWriteOnce\n      resources:\n        requests:\n          storage: 1Gi\n</code></pre><p>这次，我们为这个StatefulSet额外添加了一个volumeClaimTemplates字段。从名字就可以看出来，它跟Deployment里Pod模板（PodTemplate）的作用类似。也就是说，凡是被这个StatefulSet管理的Pod，都会声明一个对应的PVC；而这个PVC的定义，就来自于volumeClaimTemplates这个模板字段。更重要的是，这个PVC的名字，会被分配一个与这个Pod完全一致的编号。</p><p>这个自动创建的PVC，与PV绑定成功后，就会进入Bound状态，这就意味着这个Pod可以挂载并使用这个PV了。</p><p>如果你还是不太理解PVC的话，可以先记住这样一个结论：<strong>PVC其实就是一种特殊的Volume</strong>。只不过一个PVC具体是什么类型的Volume，要在跟某个PV绑定之后才知道。关于PV、PVC更详细的知识，我会在容器存储部分做进一步解读。</p><p>当然，PVC与PV的绑定得以实现的前提是，运维人员已经在系统里创建好了符合条件的PV（比如，我们在前面用到的pv-volume）；或者，你的Kubernetes集群运行在公有云上，这样Kubernetes就会通过Dynamic Provisioning的方式，自动为你创建与PVC匹配的PV。</p><p>所以，我们在使用kubectl create创建了StatefulSet之后，就会看到Kubernetes集群里出现了两个PVC：</p><pre><code>$ kubectl create -f statefulset.yaml\n$ kubectl get pvc -l app=nginx\nNAME        STATUS    VOLUME                                     CAPACITY   ACCESSMODES   AGE\nwww-web-0   Bound     pvc-15c268c7-b507-11e6-932f-42010a800002   1Gi        RWO           48s\nwww-web-1   Bound     pvc-15c79307-b507-11e6-932f-42010a800002   1Gi        RWO           48s\n</code></pre><p>可以看到，这些PVC，都以“&lt;PVC名字&gt;-&lt;StatefulSet名字&gt;-&lt;编号&gt;”的方式命名，并且处于Bound状态。</p><p>我们前面已经讲到过，这个StatefulSet创建出来的所有Pod，都会声明使用编号的PVC。比如，在名叫web-0的Pod的volumes字段，它会声明使用名叫www-web-0的PVC，从而挂载到这个PVC所绑定的PV。</p><p>所以，我们就可以使用如下所示的指令，在Pod的Volume目录里写入一个文件，来验证一下上述Volume的分配情况：</p><pre><code>$ for i in 0 1; do kubectl exec web-$i -- sh -c 'echo hello $(hostname) &gt; /usr/share/nginx/html/index.html'; done\n</code></pre><p>如上所示，通过kubectl exec指令，我们在每个Pod的Volume目录里，写入了一个index.html文件。这个文件的内容，正是Pod的hostname。比如，我们在web-0的index.html里写入的内容就是\"hello web-0\"。</p><p>此时，如果你在这个Pod容器里访问<code>“http://localhost”</code>，你实际访问到的就是Pod里Nginx服务器进程，而它会为你返回/usr/share/nginx/html/index.html里的内容。这个操作的执行方法如下所示：</p><pre><code>$ for i in 0 1; do kubectl exec -it web-$i -- curl localhost; done\nhello web-0\nhello web-1\n</code></pre><p>现在，关键来了。</p><p>如果你使用kubectl delete命令删除这两个Pod，这些Volume里的文件会不会丢失呢？</p><pre><code>$ kubectl delete pod -l app=nginx\npod &quot;web-0&quot; deleted\npod &quot;web-1&quot; deleted\n</code></pre><p>可以看到，正如我们前面介绍过的，在被删除之后，这两个Pod会被按照编号的顺序被重新创建出来。而这时候，如果你在新创建的容器里通过访问<code>“http://localhost”</code>的方式去访问web-0里的Nginx服务：</p><pre><code># 在被重新创建出来的Pod容器里访问http://localhost\n$ kubectl exec -it web-0 -- curl localhost\nhello web-0\n</code></pre><p>就会发现，这个请求依然会返回：hello web-0。也就是说，原先与名叫web-0的Pod绑定的PV，在这个Pod被重新创建之后，依然同新的名叫web-0的Pod绑定在了一起。对于Pod web-1来说，也是完全一样的情况。</p><p><strong>这是怎么做到的呢？</strong></p><p>其实，我和你分析一下StatefulSet控制器恢复这个Pod的过程，你就可以很容易理解了。</p><p>首先，当你把一个Pod，比如web-0，删除之后，这个Pod对应的PVC和PV，并不会被删除，而这个Volume里已经写入的数据，也依然会保存在远程存储服务里（比如，我们在这个例子里用到的Ceph服务器）。</p><p>此时，StatefulSet控制器发现，一个名叫web-0的Pod消失了。所以，控制器就会重新创建一个新的、名字还是叫作web-0的Pod来，“纠正”这个不一致的情况。</p><p>需要注意的是，在这个新的Pod对象的定义里，它声明使用的PVC的名字，还是叫作：www-web-0。这个PVC的定义，还是来自于PVC模板（volumeClaimTemplates），这是StatefulSet创建Pod的标准流程。</p><p>所以，在这个新的web-0 Pod被创建出来之后，Kubernetes为它查找名叫www-web-0的PVC时，就会直接找到旧Pod遗留下来的同名的PVC，进而找到跟这个PVC绑定在一起的PV。</p><p>这样，新的Pod就可以挂载到旧Pod对应的那个Volume，并且获取到保存在Volume里的数据。</p><p><strong>通过这种方式，Kubernetes的StatefulSet就实现了对应用存储状态的管理。</strong></p><p><span class=\"orange\">看到这里，你是不是已经大致理解了StatefulSet的工作原理呢？现在，我再为你详细梳理一下吧。</span></p><p><strong>首先，StatefulSet的控制器直接管理的是Pod</strong>。这是因为，StatefulSet里的不同Pod实例，不再像ReplicaSet中那样都是完全一样的，而是有了细微区别的。比如，每个Pod的hostname、名字等都是不同的、携带了编号的。而StatefulSet区分这些实例的方式，就是通过在Pod的名字里加上事先约定好的编号。</p><p><strong>其次，Kubernetes通过Headless Service，为这些有编号的Pod，在DNS服务器中生成带有同样编号的DNS记录</strong>。只要StatefulSet能够保证这些Pod名字里的编号不变，那么Service里类似于web-0.nginx.default.svc.cluster.local这样的DNS记录也就不会变，而这条记录解析出来的Pod的IP地址，则会随着后端Pod的删除和再创建而自动更新。这当然是Service机制本身的能力，不需要StatefulSet操心。</p><p><strong>最后，StatefulSet还为每一个Pod分配并创建一个同样编号的PVC</strong>。这样，Kubernetes就可以通过Persistent Volume机制为这个PVC绑定上对应的PV，从而保证了每一个Pod都拥有一个独立的Volume。</p><p>在这种情况下，即使Pod被删除，它所对应的PVC和PV依然会保留下来。所以当这个Pod被重新创建出来之后，Kubernetes会为它找到同样编号的PVC，挂载这个PVC对应的Volume，从而获取到以前保存在Volume里的数据。</p><p>这么一看，原本非常复杂的StatefulSet，是不是也很容易理解了呢？</p><h2>总结</h2><p>在今天这篇文章中，我为你详细介绍了StatefulSet处理存储状态的方法。然后，以此为基础，我为你梳理了StatefulSet控制器的工作原理。</p><p>从这些讲述中，我们不难看出StatefulSet的设计思想：StatefulSet其实就是一种特殊的Deployment，而其独特之处在于，它的每个Pod都被编号了。而且，这个编号会体现在Pod的名字和hostname等标识信息上，这不仅代表了Pod的创建顺序，也是Pod的重要网络标识（即：在整个集群里唯一的、可被访问的身份）。</p><p>有了这个编号后，StatefulSet就使用Kubernetes里的两个标准功能：Headless Service和PV/PVC，实现了对Pod的拓扑状态和存储状态的维护。</p><p>实际上，在下一篇文章的“有状态应用”实践环节，以及后续的讲解中，你就会逐渐意识到，StatefulSet可以说是Kubernetes中作业编排的“集大成者”。</p><p>因为，几乎每一种Kubernetes的编排功能，都可以在编写StatefulSet的YAML文件时被用到。</p><h2>思考题</h2><p>在实际场景中，有一些分布式应用的集群是这么工作的：当一个新节点加入到集群时，或者老节点被迁移后重建时，这个节点可以从主节点或者其他从节点那里同步到自己所需要的数据。</p><p>在这种情况下，你认为是否还有必要将这个节点Pod与它的PV进行一对一绑定呢？（提示：这个问题的答案根据不同的项目是不同的。关键在于，重建后的节点进行数据恢复和同步的时候，是不是一定需要原先它写在本地磁盘里的数据）</p><p>感谢你的收听，欢迎你给我留言，也欢迎分享给更多的朋友一起阅读。</p>","comments":[{"had_liked":false,"id":30152,"user_name":"虎虎❤️","can_delete":false,"product_type":"c1","uid":1086535,"ip_address":"","ucode":"157F261E80291A","user_header":"https://static001.geekbang.org/account/avatar/00/10/94/47/75875257.jpg","comment_is_top":false,"comment_ctime":1538704026,"is_pvip":false,"replies":[{"id":"10866","content":"手动创建PV就是有这些问题，要不然为啥推崇storageclass呢。可以自己编写external provisioner来代替你自己写pv啊，跟你用storageclass一样。","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1538739162,"ip_address":"","comment_id":30152,"utype":1}],"discussion_count":6,"race_medal":0,"score":"293596480154","product_id":100015201,"comment_content":"老师，由于无法追问，恳请能够回复详细一些。提前谢过了。<br>pvc的使用方式当中，对于由运维人员去创建pv，我始终有些疑问。<br>首先，一个pv对应一个pvc。如果实际绑定的pvc小于pv声明的存储大小，会造成存储的浪费吗？<br>其次，运维人员事先要创建多少个，以及多大容量的pv呢？因为并不清楚开发人员将来可能用多少1g的,10g的或者100g的pvc。创建的数量或大小不合适，会导致pv不够用。开发还是会来找运维的。<br>最后，如果回收方式是retain，那么pvc删除后，原来的pv并不会删除，如果开发人员想重新使用同一块存储，需要重建pv。这带来了很多运维工作。<br>所以，手动创建pv的最佳实践是怎样的呢？当然，如果用storage class去动态创建pv可以解决这件事，但是有时我们希望针对namespace创建属于自己的pv来限制存储的使用quota，而不得不用手动创建pv的模式。<br>","like_count":68,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425872,"discussion_content":"手动创建PV就是有这些问题，要不然为啥推崇storageclass呢。可以自己编写external provisioner来代替你自己写pv啊，跟你用storageclass一样。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1538739162,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1566408,"avatar":"https://static001.geekbang.org/account/avatar/00/17/e6/c8/53c9027b.jpg","nickname":"haoxy","note":"","ucode":"CD74533613D367","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":374807,"discussion_content":"老师你没有回答人家的问题啊","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1621353417,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1610260,"avatar":"https://static001.geekbang.org/account/avatar/00/18/92/14/6ca50b3b.jpg","nickname":"大G来了呦","note":"","ucode":"97711D9CCA73B0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1566408,"avatar":"https://static001.geekbang.org/account/avatar/00/17/e6/c8/53c9027b.jpg","nickname":"haoxy","note":"","ucode":"CD74533613D367","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":377328,"discussion_content":"老师回答的很清楚呀 手动创建pv会存在提问者所说的这些问题，要想解决这些问题，就需要使用storageclass   ","likes_number":5,"is_delete":false,"is_hidden":false,"ctime":1622604090,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":374807,"ip_address":""},"score":377328,"extra":""},{"author":{"id":2651519,"avatar":"https://static001.geekbang.org/account/avatar/00/28/75/7f/ff5dd565.jpg","nickname":"Cantevenl","note":"","ucode":"F5A62BA4355F6A","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1566408,"avatar":"https://static001.geekbang.org/account/avatar/00/17/e6/c8/53c9027b.jpg","nickname":"haoxy","note":"","ucode":"CD74533613D367","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":378064,"discussion_content":"后续的storageclass能够解决这个问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1623041430,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":374807,"ip_address":""},"score":378064,"extra":""}]},{"author":{"id":1033169,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c3/d1/bdf895bf.jpg","nickname":"penng","note":"","ucode":"6087CFCB0AC434","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584140,"discussion_content":"storageclass是啥啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660640242,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"重庆"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1512942,"avatar":"https://static001.geekbang.org/account/avatar/00/17/15/ee/f461168f.jpg","nickname":"Jay","note":"","ucode":"D9A45EA47908C9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":551237,"discussion_content":"有答案可以分享一下\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1644937154,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":57601,"user_name":"秋风扫落叶","can_delete":false,"product_type":"c1","uid":1358233,"ip_address":"","ucode":"7E71F42B50800B","user_header":"https://static001.geekbang.org/account/avatar/00/14/b9/99/ef60d90f.jpg","comment_is_top":false,"comment_ctime":1546845979,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"242065014555","product_id":100015201,"comment_content":"老师这个里面创建pv需要有ceph存储支持，大家做实验可以搞一个rook-ceph，两步创建一个ceph集群，很好用，官网： https:&#47;&#47;rook.io&#47;。","like_count":57,"discussions":[{"author":{"id":1195204,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3c/c4/4ee2968a.jpg","nickname":"艾利特-G","note":"","ucode":"8C4DA0ABE77CDC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":197902,"discussion_content":"rook-ceph建议使用bluestorage作为rbd的storageType。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1583456314,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1218347,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLvdWoCic6ItzibF8ia8vrUTRuyj6AT3tg5f4QicIK0jTIFheJ6274ZkibuRLFP1NXG3jibv5TiaSKNoJpLw/132","nickname":"Geek_37984c","note":"","ucode":"7A319AE28599B0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":158520,"discussion_content":"赞  要先搞一个rook-ceph","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1580582175,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":244654,"user_name":"大G来了呦","can_delete":false,"product_type":"c1","uid":1610260,"ip_address":"","ucode":"97711D9CCA73B0","user_header":"https://static001.geekbang.org/account/avatar/00/18/92/14/6ca50b3b.jpg","comment_is_top":false,"comment_ctime":1598605248,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"113267754944","product_id":100015201,"comment_content":"不使用ceph的话，可以按照hostPath来进行实验：<br>cat pv.yaml<br>apiVersion: v1<br>kind: PersistentVolume<br>metadata:<br>  name: pv-test<br>  labels:<br>    name: pv-test<br>spec:<br>  storageClassName: manual<br>  capacity:<br>    storage: 1Gi<br>  accessModes:<br>    - ReadWriteOnce<br>  persistentVolumeReclaimPolicy: Recycle<br>  hostPath:<br>    path: &#47;test-volume<br>################<br> cat sts.yaml<br>apiVersion: apps&#47;v1<br>kind: StatefulSet<br>metadata:<br>  name: web<br>spec:<br>  serviceName: &quot;nginx&quot;<br>  replicas: 2<br>  selector:<br>    matchLabels:<br>      app: nginx<br>  template:<br>    metadata:<br>      labels:<br>        app: nginx<br>    spec:<br>      containers:<br>      - name: nginx<br>        image: nginx:1.9.1<br>        ports:<br>        - containerPort: 80<br>          name: web<br>        volumeMounts:<br>        - name: www<br>          mountPath: &#47;usr&#47;share&#47;nginx&#47;html<br>  volumeClaimTemplates:<br>  - metadata:<br>      name: www<br>    spec:<br>      accessModes:<br>      - ReadWriteOnce<br>      storageClassName: manual<br>      resources:<br>        requests:<br>          storage: 1Gi<br>注意要在woker节点创建本地目录 &#47;test-volume<br>还有实验结果如下：<br> kubectl get pv<br>NAME      CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM               STORAGECLASS   REASON   AGE<br>pv-test   1Gi        RWO            Recycle          Bound    default&#47;www-web-0   manual                  34m<br>[root@node1 pv]# kubectl get pvc<br>NAME        STATUS    VOLUME    CAPACITY   ACCESS MODES   STORAGECLASS   AGE<br>www-web-0   Bound     pv-test   1Gi        RWO            manual         5m31s<br>www-web-1   Pending                                       manual         5m28s<br>[root@node1 pv]# kubectl get po<br>NAME    READY   STATUS    RESTARTS   AGE<br>web-0   1&#47;1     Running   0          5m35s<br>web-1   0&#47;1     Pending   0          5m32s<br># pending是由于 ReadWritOnce 只能让一个pod去挂载使用，而不是一个节点的多个pod挂载使用<br>","like_count":26,"discussions":[{"author":{"id":1312366,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/CdR9bPIEjBCZQHEWKotibmRL8dSLwhL57Tw7b3FngWxO3pUVRwm9QD7knpHyFlVH44tyAysK8BNM4B7yzfNTtKA/132","nickname":"beast","note":"","ucode":"198CA31331CC50","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":411062,"discussion_content":"ReadWritOnce 只能让一个pod去挂载使用？\n---请问这个是为什么呢？(RWO) ReadWriteOnce 可被一个节点读写挂载，没有限制是一个pod","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1635840343,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1708412,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/11/7c/bf5049b3.jpg","nickname":"Freddy","note":"","ucode":"5822B746265DB4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572591,"discussion_content":"在work节点上创建两个不同名的pv即可，那么在创建statefulset的时候，两个pod的pvc会自动绑定不同的pv\n[root@k8s-work1 ~]# mkdir /test-volume\n[root@k8s-work1 ~]# mkdir /test-volume2\n[root@k8s-master example]# kubectl get pv\nNAME       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM               STORAGECLASS   REASON   AGE\npv-test    1Gi        RWO            Recycle          Bound    default/www-web-0   manual                  7m36s\npv-test2   1Gi        RWO            Recycle          Bound    default/www-web-1   manual                  3m45s\n创建完stateful-set后：\n[root@k8s-master example]# kubectl get pvc\nNAME        STATUS   VOLUME     CAPACITY   ACCESS MODES   STORAGECLASS   AGE\nwww-web-0   Bound    pv-test    1Gi        RWO            manual         116s\nwww-web-1   Bound    pv-test2   1Gi        RWO            manual         112s\n写入数据：\n[root@k8s-master example]# for i in 0 1; do kubectl exec web-$i -- sh -c &#39;echo hell0 $(hostname) &gt; /usr/share/nginx/html/index.html&#39;; done\nwork check数据：\n[root@k8s-work1 ~]# cat /test-volume/index.html \nhell0 web-0\n[root@k8s-work1 ~]# cat /test-volume2/index.html \nhell0 web-1\n[root@k8s-master example]# kubectl run -i --tty --image busybox:1.28.4 dns-test --restart=Never --rm /bin/sh\n/ # wget web-0.nginx &amp;&amp; cat index.html &amp;&amp; rm index.html\nConnecting to web-0.nginx (10.244.1.43:80)\nindex.html           100% |*********************************************************************************************************|    12   0:00:00 ETA\nhell0 web-0\n/ # wget web-1.nginx &amp;&amp; cat index.html &amp;&amp; rm index.html\nConnecting to web-1.nginx (10.244.1.44:80)\nindex.html           100% |*********************************************************************************************************|    12   0:00:00 ETA\nhell0 web-1\n/ #","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652864067,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1592298,"avatar":"https://static001.geekbang.org/account/avatar/00/18/4b/ea/a9e7bc50.jpg","nickname":"℡人见人爱浩然君゜","note":"","ucode":"D042A622533C72","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":567218,"discussion_content":"请问pv采用hostPath的方式的话pod重建后原数据还有吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1650858987,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1708412,"avatar":"https://static001.geekbang.org/account/avatar/00/1a/11/7c/bf5049b3.jpg","nickname":"Freddy","note":"","ucode":"5822B746265DB4","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1592298,"avatar":"https://static001.geekbang.org/account/avatar/00/18/4b/ea/a9e7bc50.jpg","nickname":"℡人见人爱浩然君゜","note":"","ucode":"D042A622533C72","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":572594,"discussion_content":"原来的数据有的\n[root@k8s-master example]# kubectl delete pod -l app=nginx\npod &#34;web-0&#34; deleted\npod &#34;web-1&#34; deleted\n[root@k8s-master example]# kubectl get pods\nNAME       READY   STATUS    RESTARTS   AGE\nweb-0      1/1     Running   0          8s\nweb-1      1/1     Running   0          6s\n[root@k8s-master example]# kubectl get pv\nNAME       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM               STORAGECLASS   REASON   AGE\npv-test    1Gi        RWO            Recycle          Bound    default/www-web-0   manual                  21m\npv-test2   1Gi        RWO            Recycle          Bound    default/www-web-1   manual                  18m\n[root@k8s-master example]# kubectl get pvc\nNAME        STATUS   VOLUME     CAPACITY   ACCESS MODES   STORAGECLASS   AGE\nwww-web-0   Bound    pv-test    1Gi        RWO            manual         16m\nwww-web-1   Bound    pv-test2   1Gi        RWO            manual         16m\n[root@k8s-master example]# kubectl run -i --tty --image busybox:1.28.4 dns-test --restart=Never --rm /bin/sh\n/ # wget web-0.nginx &amp;&amp; cat index.html &amp;&amp; rm index.html\nConnecting to web-0.nginx (10.244.1.45:80)\nindex.html           100% |*********************************************************************************************************|    12   0:00:00 ETA\nhell0 web-0\n/ # wget web-1.nginx &amp;&amp; cat index.html &amp;&amp; rm index.html\nConnecting to web-1.nginx (10.244.1.46:80)\nindex.html           100% |*********************************************************************************************************|    12   0:00:00 ETA\nhell0 web-1\n/ # ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1652864262,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":567218,"ip_address":""},"score":572594,"extra":""}]}]},{"had_liked":false,"id":48611,"user_name":"不知所措","can_delete":false,"product_type":"c1","uid":1201108,"ip_address":"","ucode":"6DEE7429E0A6D5","user_header":"https://static001.geekbang.org/account/avatar/00/12/53/d4/d5596933.jpg","comment_is_top":false,"comment_ctime":1544495553,"is_pvip":false,"replies":[{"id":"17500","content":"用operator ","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1544533216,"ip_address":"","comment_id":48611,"utype":1}],"discussion_count":2,"race_medal":0,"score":"91738808769","product_id":100015201,"comment_content":"老师你好，statefulset 如果 不同的pod ，需要不同的配置，<br>比如说 zk集群，每个集群的myid 都是不同的，比如mysql集群每个主机的serverid 也是不同的，这种的怎么处理呢？","like_count":21,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":432274,"discussion_content":"用operator ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1544533216,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":415052,"discussion_content":"Mark。这种情况很常见，关注后面老师讲operator。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636971821,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":80545,"user_name":"kevinsu","can_delete":false,"product_type":"c1","uid":1078506,"ip_address":"","ucode":"BAD46B815D6A5C","user_header":"https://static001.geekbang.org/account/avatar/00/10/74/ea/10661bdc.jpg","comment_is_top":false,"comment_ctime":1553678683,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"78863090011","product_id":100015201,"comment_content":"rook-ceph-mon的IP地址正确获取方式来自查阅rook官方文档，kubectl -n rook-ceph get service，非常重要！！！","like_count":18,"discussions":[{"author":{"id":1195204,"avatar":"https://static001.geekbang.org/account/avatar/00/12/3c/c4/4ee2968a.jpg","nickname":"艾利特-G","note":"","ucode":"8C4DA0ABE77CDC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":197909,"discussion_content":"你要把rook的example和它的官方文档里关于ceph的过一遍。有些manifest中有一大堆属性，仔细过一遍就知道了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1583456455,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1218347,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLvdWoCic6ItzibF8ia8vrUTRuyj6AT3tg5f4QicIK0jTIFheJ6274ZkibuRLFP1NXG3jibv5TiaSKNoJpLw/132","nickname":"Geek_37984c","note":"","ucode":"7A319AE28599B0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":158379,"discussion_content":"点赞","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580570013,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1244496,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM49ONuR097wB6LqR8nn5kWiaQiaPic1y8UznibDOScQergTj5qeL6zQ4bIicYEkqlMiash3CUCAYmSt9tQA/132","nickname":"哈希碰撞","note":"","ucode":"DF82678E60095D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2339,"discussion_content":"请问是什么原因？\nkubectl -n rook-ceph get service\nNo resources found.\n\nkubectl get pods --all-namespaces\nNAMESPACE              NAME                                          READY   STATUS    RESTARTS   AGE\n......\nrook-ceph              rook-ceph-agent-hrrzz                         1/1     Running   2          45h\nrook-ceph              rook-ceph-agent-tskg2                         1/1     Running   2          45h\nrook-ceph              rook-ceph-operator-775cf575c5-7pj4p           1/1     Running   0          42h\nrook-ceph              rook-discover-7zp9v                           1/1     Running   2          45h\nrook-ceph              rook-discover-dz5lc                           1/1     Running   2          45h\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563497955,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1845394,"avatar":"https://static001.geekbang.org/account/avatar/00/1c/28/92/436735f5.jpg","nickname":"晞月520","note":"","ucode":"4F05E02A5C1608","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1244496,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q3auHgzwzM49ONuR097wB6LqR8nn5kWiaQiaPic1y8UznibDOScQergTj5qeL6zQ4bIicYEkqlMiash3CUCAYmSt9tQA/132","nickname":"哈希碰撞","note":"","ucode":"DF82678E60095D","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":284862,"discussion_content":"你应该是get pod 啊 ， 你砸get service 了呢！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592662521,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":2339,"ip_address":""},"score":284862,"extra":""}]}]},{"had_liked":false,"id":69380,"user_name":"pepezzzz","can_delete":false,"product_type":"c1","uid":1143169,"ip_address":"","ucode":"414AD2DFD4BA1A","user_header":"https://static001.geekbang.org/account/avatar/00/11/71/81/4e47560f.jpg","comment_is_top":false,"comment_ctime":1550731512,"is_pvip":false,"discussion_count":7,"race_medal":0,"score":"74565175544","product_id":100015201,"comment_content":"原文中的PV创建不成功。<br> spec.accessModes: Required value<br> unknown field &quot;imagefeatures&quot; in io.k8s.api.core.v1.RBDPersistentVolumeSource<br> unknown field &quot;imageformat&quot; in io.k8s.api.core.v1.RBDPersistentVolumeSource<br>修改后如下：<br>kind: PersistentVolume<br>apiVersion: v1<br>metadata:<br>  name: pv-volume<br>  labels:<br>    type: local<br>spec:<br>  capacity:<br>    storage: 10Gi<br>  accessModes:<br>    - ReadWriteOnce <br>  rbd:<br>    monitors:<br>    - &#39;10.40.0.21:6789&#39; --修改为 kubectl get pods -n rook-ceph 查看 rook-ceph-mon- 开头的POD IP<br>    - &#39;10.32.0.10:6789&#39;<br>    - &#39;10.40.0.23:6789&#39;<br>    pool: kube<br>    image: foo<br>    fsType: ext4<br>    readOnly: false<br>    user: admin<br>    keyring: &#47;etc&#47;ceph&#47;keyring<br>","like_count":17,"discussions":[{"author":{"id":1033169,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c3/d1/bdf895bf.jpg","nickname":"penng","note":"","ucode":"6087CFCB0AC434","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584152,"discussion_content":"这是改了啥？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660643696,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"重庆"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1037514,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/d4/ca/bdb348db.jpg","nickname":"law","note":"","ucode":"3B664E2667ED63","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":190441,"discussion_content":"是的，k8s版本的问题。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1582944689,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1218347,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLvdWoCic6ItzibF8ia8vrUTRuyj6AT3tg5f4QicIK0jTIFheJ6274ZkibuRLFP1NXG3jibv5TiaSKNoJpLw/132","nickname":"Geek_37984c","note":"","ucode":"7A319AE28599B0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":158383,"discussion_content":"非常的感谢！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1580570127,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1630700,"avatar":"","nickname":"Geek_cc64e9","note":"","ucode":"44697DC4578AD7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":5626,"discussion_content":"请问这位同学后面的例子中通过“volumeClaimTemplates”能够自动创建吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566392149,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":3,"child_discussions":[{"author":{"id":1121758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","nickname":"aoe","note":"","ucode":"1C6201EDB4E954","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1630700,"avatar":"","nickname":"Geek_cc64e9","note":"","ucode":"44697DC4578AD7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":316640,"discussion_content":"如果是云平台，已经提供了PV可以自动创建。自己搭建的环境，好像不行，我也在寻找的道路上","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1603433709,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":5626,"ip_address":""},"score":316640,"extra":""},{"author":{"id":2117362,"avatar":"https://static001.geekbang.org/account/avatar/00/20/4e/f2/a3314a28.jpg","nickname":"鹤无双","note":"","ucode":"785B47B34FFBDC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1121758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","nickname":"aoe","note":"","ucode":"1C6201EDB4E954","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349963,"discussion_content":"你可以通过自己再后端搭建一个 NFS 服务器，然后再挂在过去也行","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613646320,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":316640,"ip_address":""},"score":349963,"extra":""},{"author":{"id":1121758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","nickname":"aoe","note":"","ucode":"1C6201EDB4E954","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":2117362,"avatar":"https://static001.geekbang.org/account/avatar/00/20/4e/f2/a3314a28.jpg","nickname":"鹤无双","note":"","ucode":"785B47B34FFBDC","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":350030,"discussion_content":"谢谢，用mac上的体验版就行，在ubuntu上太折腾了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613664136,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":349963,"ip_address":""},"score":350030,"extra":""}]}]},{"had_liked":false,"id":46048,"user_name":"程序修行","can_delete":false,"product_type":"c1","uid":1257409,"ip_address":"","ucode":"2CCD5ACAFF0E8D","user_header":"","comment_is_top":false,"comment_ctime":1543838830,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"70263315566","product_id":100015201,"comment_content":"老师能每次给出本次讲解全套的实现命令吗？貌似每次复现都会花很多时间，还不知道为什么。这次就是不知道pv该怎么创建，为什么总是创建失败。","like_count":16,"discussions":[{"author":{"id":1121758,"avatar":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","nickname":"aoe","note":"","ucode":"1C6201EDB4E954","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":316642,"discussion_content":"kubectl describe pv pv的名字，查看 Events 信息，看报什么错","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1603433757,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":44239,"user_name":"Terry Hu","can_delete":false,"product_type":"c1","uid":1219820,"ip_address":"","ucode":"9487EEECC051B5","user_header":"https://static001.geekbang.org/account/avatar/00/12/9c/ec/5da5c049.jpg","comment_is_top":false,"comment_ctime":1543392499,"is_pvip":false,"replies":[{"id":"15864","content":"吃一堑长一智","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1543417737,"ip_address":"","comment_id":44239,"utype":1}],"discussion_count":3,"race_medal":0,"score":"65967901939","product_id":100015201,"comment_content":"由于没有ceph server ，pv用hostPath方式，在master上创建了index.html，pv pvc都创建好了，bound上了，登陆容器后在&#47;usr&#47;share&#47;nginx&#47;html目录下死活找不到index.html，搞了一个小时。突然猛醒原来hostPath指的是worker节点的path......哎，蠢啊","like_count":15,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":430690,"discussion_content":"吃一堑长一智","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1543417737,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1218347,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLvdWoCic6ItzibF8ia8vrUTRuyj6AT3tg5f4QicIK0jTIFheJ6274ZkibuRLFP1NXG3jibv5TiaSKNoJpLw/132","nickname":"Geek_37984c","note":"","ucode":"7A319AE28599B0","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":158358,"discussion_content":"查看这个pod再那个节点运行","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1580569415,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1200676,"avatar":"https://static001.geekbang.org/account/avatar/00/12/52/24/bd63c4de.jpg","nickname":"Eason Tai","note":"","ucode":"4707577CC9C9E9","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":296431,"discussion_content":"这个时候 -o wide 或者 describe pod 就非常好用了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596540953,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":31291,"user_name":"silver","can_delete":false,"product_type":"c1","uid":1186740,"ip_address":"","ucode":"908E3C8560D6E1","user_header":"https://static001.geekbang.org/account/avatar/00/12/1b/b4/a6db1c1e.jpg","comment_is_top":false,"comment_ctime":1539143585,"is_pvip":false,"replies":[{"id":"11265","content":"是","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1539150635,"ip_address":"","comment_id":31291,"utype":1}],"discussion_count":4,"race_medal":0,"score":"61668685729","product_id":100015201,"comment_content":"所以大体是Pod与PVC绑定，PVC与PV绑定，所以完成了Pod与PV的绑定?","like_count":14,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426280,"discussion_content":"是","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539150635,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1352415,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/YD1RqdHwfuNHSot5OcjlNhWiatJLmlhF47sUiczmzo0znLYvOpssdsqdlGKjUenXJzTG4eBR0bIJkJeUTibQ04Yqw/132","nickname":"jking","note":"","ucode":"05611E2DC82125","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":405607,"discussion_content":"这里的Pv与pvc是怎么绑定的啊，看了模版，感觉没什么关联关系啊","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1634607321,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1014665,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7b/89/34f2cbcc.jpg","nickname":"杨宇","note":"","ucode":"EB74DF6E269F03","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":1352415,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/YD1RqdHwfuNHSot5OcjlNhWiatJLmlhF47sUiczmzo0znLYvOpssdsqdlGKjUenXJzTG4eBR0bIJkJeUTibQ04Yqw/132","nickname":"jking","note":"","ucode":"05611E2DC82125","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":406456,"discussion_content":"K8s自动做的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634777754,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":405607,"ip_address":""},"score":406456,"extra":""},{"author":{"id":1261493,"avatar":"https://static001.geekbang.org/account/avatar/00/13/3f/b5/5fe77e16.jpg","nickname":"不经意间","note":"","ucode":"C39D98697ACB8B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1352415,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/YD1RqdHwfuNHSot5OcjlNhWiatJLmlhF47sUiczmzo0znLYvOpssdsqdlGKjUenXJzTG4eBR0bIJkJeUTibQ04Yqw/132","nickname":"jking","note":"","ucode":"05611E2DC82125","race_medal":0,"user_type":1,"is_pvip":true},"discussion":{"id":533364,"discussion_content":"根据 访问模式，大小，StorageClass的provisioner来找对应的pv。pvc是给开发用的，他们只关心我要多大存储（访问模式他们也不是特别在意，毕竟最终目的是要让他的pod跑起来。）","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637846467,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":405607,"ip_address":""},"score":533364,"extra":"{\"user_type\":1}"}]}]},{"had_liked":false,"id":92962,"user_name":"kevinsu","can_delete":false,"product_type":"c1","uid":1078506,"ip_address":"","ucode":"BAD46B815D6A5C","user_header":"https://static001.geekbang.org/account/avatar/00/10/74/ea/10661bdc.jpg","comment_is_top":false,"comment_ctime":1557369195,"is_pvip":false,"discussion_count":7,"race_medal":0,"score":"53096976747","product_id":100015201,"comment_content":"我用ubuntu完全去按照之前的安装方法搞的环境，但是到持久化存储这块老是会有这个错：Warning  FailedMount             15s (x8 over 79s)   kubelet, izj6cbsxfhzowfxz65471sz  MountVolume.WaitForAttach failed for volume &quot;pv-volume&quot; : fail to check rbd image status with: (executable file not found in $PATH), rbd output: ()<br>超级郁闷","like_count":12,"discussions":[{"author":{"id":2371590,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoWkj13nDtjosQeeaZDIBcrzX3UPIMibWvq1KY0oqclpxUIZAIetRtvwia65IEl0AJgnetNV2XKLtPQ/132","nickname":"Geek_lee","note":"","ucode":"5BAA7A7B7BBD5A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575610,"discussion_content":"在每个节点上安装ceph-common\n\nubuntu: sudo apt-get install ceph-common\ncentos: yum install ceph-common","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654951141,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1394019,"avatar":"https://static001.geekbang.org/account/avatar/00/15/45/63/d3319b80.jpg","nickname":"奔跑的蜗牛","note":"","ucode":"88D855ED42F134","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349874,"discussion_content":"请问怎么解决的？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1613610324,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1478537,"avatar":"http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqibbTP09CH2pH3v7WXnCvHhnibcWKiafEW7U2IWePspzkJF9yTibJhU66c5ulzAC69Z0unD8tZDnMZ4A/132","nickname":"Fanggang","note":"","ucode":"F143AAE8ED027D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":265969,"discussion_content":"这个问题解决了吗？我也遇到了，郁闷一天了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1589461699,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1580926,"avatar":"","nickname":"ch_ort","note":"","ucode":"B79746E687F29E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":241620,"discussion_content":"这个问题解决了吗，我也碰到这个问题了","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587431335,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1063958,"avatar":"","nickname":"咕噜","note":"","ucode":"38A512132BB5B7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":216565,"discussion_content":"如果不是用dynamic provision的方式的话需要自己手动到ceph集群当中把PV中相应的rbd创建好","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585465784,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":2,"child_discussions":[{"author":{"id":1591045,"avatar":"https://static001.geekbang.org/account/avatar/00/18/47/05/4ee667bf.jpg","nickname":"岛","note":"","ucode":"6D38023B4CA3CD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1063958,"avatar":"","nickname":"咕噜","note":"","ucode":"38A512132BB5B7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":249717,"discussion_content":"亲，您所指手动到ceph集群中把pv对应的rbd创建好，能否再具体点嗯？WX：18055131811，期望得到您的指导！","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587955495,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":216565,"ip_address":""},"score":249717,"extra":""},{"author":{"id":1033169,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c3/d1/bdf895bf.jpg","nickname":"penng","note":"","ucode":"6087CFCB0AC434","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1063958,"avatar":"","nickname":"咕噜","note":"","ucode":"38A512132BB5B7","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584800,"discussion_content":"创建好了也是报这个错误，我也不知道怎么解决","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1661140149,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":216565,"ip_address":"重庆"},"score":584800,"extra":""}]}]},{"had_liked":false,"id":46357,"user_name":"Devil May Cry.Samsara","can_delete":false,"product_type":"c1","uid":1067416,"ip_address":"","ucode":"007363CC2BB184","user_header":"https://static001.geekbang.org/account/avatar/00/10/49/98/a29a006e.jpg","comment_is_top":false,"comment_ctime":1543906740,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"53083514292","product_id":100015201,"comment_content":"老师，文章有提到，即使pod删除，pvc和pc依然保留下来，这个地方是不是应该注明一下，应该是要受这个pv申明的回收策略影响的？因为之前踩过次坑，pod删除，把分配给mysql的pv里的数据也删除了。。。所以很在意这个","like_count":12},{"had_liked":false,"id":32273,"user_name":"Joe Black","can_delete":false,"product_type":"c1","uid":1052528,"ip_address":"","ucode":"21FE222A286445","user_header":"https://static001.geekbang.org/account/avatar/00/10/0f/70/c8680841.jpg","comment_is_top":false,"comment_ctime":1539508821,"is_pvip":false,"replies":[{"id":"11834","content":"关系数据库也可以做replication同步数据啊。pv跟机器没有绑定关系，除非用的是local pv，这时候调度器会保证pod的调度正确。","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1539581736,"ip_address":"","comment_id":32273,"utype":1}],"discussion_count":1,"race_medal":0,"score":"53079116373","product_id":100015201,"comment_content":"对于有些应用，比如关系数据库，它保存数据文件的位置必须严格符合POSIX接口，远程文件系统例如NFS对于类似锁定这样的操作支持的不好，即使是sqlite官方文档也不推荐用NFS。这种情况下，数据库应用好像只能用本地硬盘或者iSCSI的存储盘，这不就等同必须把重启的StatefulSet的Pod每次调度到同一个机器上才行吗？因为那个机器硬盘上的文件不会自动传输到其它机器上。是不是可以这么理解？","like_count":12,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426710,"discussion_content":"关系数据库也可以做replication同步数据啊。pv跟机器没有绑定关系，除非用的是local pv，这时候调度器会保证pod的调度正确。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539581736,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":30409,"user_name":"北卡","can_delete":false,"product_type":"c1","uid":1218128,"ip_address":"","ucode":"2D947A61689FC6","user_header":"https://static001.geekbang.org/account/avatar/00/12/96/50/bde525b1.jpg","comment_is_top":false,"comment_ctime":1538830267,"is_pvip":false,"replies":[{"id":"10972","content":"容量是重要的匹配条件之一","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1538840019,"ip_address":"","comment_id":30409,"utype":1}],"discussion_count":1,"race_medal":0,"score":"44488503227","product_id":100015201,"comment_content":"asdf100的问题应该是：一个集群中可能有很多个pv, pvc是如何找到他对应的pv的?<br><br>试着回答一下：<br>1、 指定了storageClassName的pv, 只有指定了同样storageClassName的pvc才能绑定到它上面。<br>2、对于没有指定storageClassName的pv,默认classname为&quot;&quot;, 同样只有没有指定classname的pvc才能绑定到它上面。<br>3、pvc可以用matchLabels和matchExpressions来指定标签完成更详细的匹配需求。<br>4、匹配成功应该还需要一些基本的存储条件吧，比如pvc申请的存储空间肯定不能大于指定的pv.<br><br>关于第四点没有验证过，用aws的efs可以动态扩展空间的，好像没有这些限制。请张老师详细解答一下。","like_count":10,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425985,"discussion_content":"容量是重要的匹配条件之一","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538840019,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":86636,"user_name":"kitsdk","can_delete":false,"product_type":"c1","uid":1018611,"ip_address":"","ucode":"A3570300D8A48C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/8a/f3/fc992148.jpg","comment_is_top":false,"comment_ctime":1555416031,"is_pvip":false,"replies":[{"id":"31572","content":"pv是cluster level的","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1555695639,"ip_address":"","comment_id":86636,"utype":1}],"discussion_count":3,"race_medal":0,"score":"40210121695","product_id":100015201,"comment_content":"pv对象不会绑定namespace吗？<br>命令 kubectl -n myns  delete pv --all --include-uninitialized <br>执行完了，所有的pv也进入删除状态，当然因为有其他的pv绑定，没有立即删除。","like_count":9,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":447105,"discussion_content":"pv是cluster level的","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1555695639,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1207457,"avatar":"https://static001.geekbang.org/account/avatar/00/12/6c/a1/80d83f0a.jpg","nickname":"Ellison","note":"","ucode":"A2FB94D4F6A332","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":328691,"discussion_content":"pv是全局的，不会绑定","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1606210540,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":1,"child_discussions":[{"author":{"id":1261493,"avatar":"https://static001.geekbang.org/account/avatar/00/13/3f/b5/5fe77e16.jpg","nickname":"不经意间","note":"","ucode":"C39D98697ACB8B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":1207457,"avatar":"https://static001.geekbang.org/account/avatar/00/12/6c/a1/80d83f0a.jpg","nickname":"Ellison","note":"","ucode":"A2FB94D4F6A332","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533367,"discussion_content":"你这句怎么理解啊","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637846826,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":328691,"ip_address":""},"score":533367,"extra":"{\"user_type\":1}"}]}]},{"had_liked":false,"id":32720,"user_name":"Alery","can_delete":false,"product_type":"c1","uid":1156557,"ip_address":"","ucode":"08F3F49181E67B","user_header":"https://static001.geekbang.org/account/avatar/00/11/a5/cd/3aff5d57.jpg","comment_is_top":false,"comment_ctime":1539678730,"is_pvip":false,"replies":[{"id":"11931","content":"deloyment不认识pvc模板","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1539691990,"ip_address":"","comment_id":32720,"utype":1}],"discussion_count":1,"race_medal":0,"score":"27309482506","product_id":100015201,"comment_content":"前辈，我有个疑问，我通过deployment创建一个pods，在podTemplate中我声明volume使用persistentVolumeClaim并指定我事先创建pvc name， 这个时候我删除pod， 同样当pod删除的时候并不影响我事先创建的这个pvc，我是不是可以认为deployment这种资源也是能保存存储状态的呢？","like_count":6,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426869,"discussion_content":"deloyment不认识pvc模板","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539691990,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":64091,"user_name":"佳期如梦","can_delete":false,"product_type":"c1","uid":1225244,"ip_address":"","ucode":"4605ABD60A75B2","user_header":"https://static001.geekbang.org/account/avatar/00/12/b2/1c/730af0ad.jpg","comment_is_top":false,"comment_ctime":1548665243,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"23023501723","product_id":100015201,"comment_content":"有个疑问，之前Deployment是通过ReplicaSet，实现所谓的版本控制（回滚，蓝绿发布之类的）。那么StatefulSet之类部署的应用该怎么实现这些功能？","like_count":5,"discussions":[{"author":{"id":1033219,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c4/03/f753fda7.jpg","nickname":"JianXu","note":"","ucode":"2A61BDBB573BDC","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":329625,"discussion_content":"好像只有一个一个顺序更新。要更高级的功能就只能自己定制了。","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1606437309,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1261493,"avatar":"https://static001.geekbang.org/account/avatar/00/13/3f/b5/5fe77e16.jpg","nickname":"不经意间","note":"","ucode":"C39D98697ACB8B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533368,"discussion_content":"你说的版本控制，并不正是deploy和rs的区别吗。他们三都是api资源。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637846935,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":70478,"user_name":"哈哼","can_delete":false,"product_type":"c1","uid":1417824,"ip_address":"","ucode":"C1108406573D49","user_header":"https://static001.geekbang.org/account/avatar/00/15/a2/60/f3939ab4.jpg","comment_is_top":false,"comment_ctime":1551104977,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"18730974161","product_id":100015201,"comment_content":"rolling uodate 咋搞？","like_count":4},{"had_liked":false,"id":32862,"user_name":"LQ","can_delete":false,"product_type":"c1","uid":1005635,"ip_address":"","ucode":"0E33CBE474F877","user_header":"https://static001.geekbang.org/account/avatar/00/0f/58/43/15be800e.jpg","comment_is_top":false,"comment_ctime":1539706007,"is_pvip":true,"replies":[{"id":"11980","content":"你让a通过挂载传播到宿主机上，然后b挂载宿主机目录试试。","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1539744550,"ip_address":"","comment_id":32862,"utype":1}],"discussion_count":3,"race_medal":0,"score":"18719575191","product_id":100015201,"comment_content":"在一个 Pod 里面有两个容器， 容器 a 里自己实现一个 fuse filesystem，将远程的文件（比如 hdfs 上的数据）mount 到该容器里，另外一个容器 b 通过什么方式能读取到容器 a 里 mount 的数据呢，通过 PV 吗？有啥解决方案没？","like_count":4,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426905,"discussion_content":"你让a通过挂载传播到宿主机上，然后b挂载宿主机目录试试。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539744550,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1261493,"avatar":"https://static001.geekbang.org/account/avatar/00/13/3f/b5/5fe77e16.jpg","nickname":"不经意间","note":"","ucode":"C39D98697ACB8B","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":533370,"discussion_content":"再写个volumes和volumeMounts呗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637847128,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":415053,"discussion_content":"a容器里的目录已经mount了远程文件，这个目录还能再mount宿主机目录吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636972311,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":316900,"user_name":"jking","can_delete":false,"product_type":"c1","uid":1352415,"ip_address":"","ucode":"05611E2DC82125","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/YD1RqdHwfuNHSot5OcjlNhWiatJLmlhF47sUiczmzo0znLYvOpssdsqdlGKjUenXJzTG4eBR0bIJkJeUTibQ04Yqw/132","comment_is_top":false,"comment_ctime":1634607450,"is_pvip":true,"discussion_count":1,"race_medal":0,"score":"14519509338","product_id":100015201,"comment_content":"这里的Pv与pvc是怎么绑定的啊，看了模版，感觉没什么关联关系啊","like_count":3,"discussions":[{"author":{"id":1592298,"avatar":"https://static001.geekbang.org/account/avatar/00/18/4b/ea/a9e7bc50.jpg","nickname":"℡人见人爱浩然君゜","note":"","ucode":"D042A622533C72","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":567621,"discussion_content":"同样的疑问，希望张老师能帮解答下心中的疑问@张磊","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1650959627,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":93383,"user_name":"Mr.Cling","can_delete":false,"product_type":"c1","uid":1141490,"ip_address":"","ucode":"9CC3868AE6C14B","user_header":"https://static001.geekbang.org/account/avatar/00/11/6a/f2/fee557fe.jpg","comment_is_top":false,"comment_ctime":1557460703,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"14442362591","product_id":100015201,"comment_content":"如果创建了两个存储类型和存储空间都一样的PV， pvc是怎么决定绑定哪一个pv呢？ 随机选择一个吗？ 可不可能通过类似label的筛选？","like_count":3},{"had_liked":false,"id":184945,"user_name":"艾利特-G","can_delete":false,"product_type":"c1","uid":1195204,"ip_address":"","ucode":"8C4DA0ABE77CDC","user_header":"https://static001.geekbang.org/account/avatar/00/12/3c/c4/4ee2968a.jpg","comment_is_top":false,"comment_ctime":1583456740,"is_pvip":false,"replies":[{"id":"72835","content":"只有 statefulset 才会编号pvc，但不是必须有pvc","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1584423237,"ip_address":"","comment_id":184945,"utype":1}],"discussion_count":2,"race_medal":0,"score":"10173391332","product_id":100015201,"comment_content":"老师您好，请问下只用Statefulset情况下，能做到指定编号的副本创建pvc，其他副本不创建pvc吗？还是说由Statefulset管理的副本必须有pvc呢？","like_count":2,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":486180,"discussion_content":"只有 statefulset 才会编号pvc，但不是必须有pvc","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1584423237,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1113864,"avatar":"https://static001.geekbang.org/account/avatar/00/10/ff/08/7c18d8a4.jpg","nickname":"团","note":"","ucode":"D56ABBCE4E4D90","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":415057,"discussion_content":"老师好像没有完全回答这个问题。我也想知道在一个STS下可不可以做到有的pod有PVC，有的没有。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1636975431,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":42655,"user_name":"xieshiyi","can_delete":false,"product_type":"c1","uid":1225074,"ip_address":"","ucode":"7E42CB6E1E60DD","user_header":"https://static001.geekbang.org/account/avatar/00/12/b1/72/535199ed.jpg","comment_is_top":false,"comment_ctime":1542991587,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"10132926179","product_id":100015201,"comment_content":"为什么有状态应用不驱逐？有反例吗？感觉驱逐也没问题。求解答","like_count":2},{"had_liked":false,"id":32131,"user_name":"我来也","can_delete":false,"product_type":"c1","uid":1205253,"ip_address":"","ucode":"773D6104F56767","user_header":"https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg","comment_is_top":false,"comment_ctime":1539426943,"is_pvip":false,"replies":[{"id":"11624","content":"没有的话可以装一个嘛……","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1539441397,"ip_address":"","comment_id":32131,"utype":1}],"discussion_count":3,"race_medal":0,"score":"10129361535","product_id":100015201,"comment_content":"表示 nginx:1.9.1 里并没有 curl 命令.<br>通过 for i in 0 1; do kubectl exec -it web-$i -- curl localhost; done 无法获取到期待的结果.<br>通过<br>不知道其他小伙伴尝试过没有.<br>当然最终通过其他方式 比如之前的:<br>kubectl run -i --tty --image busybox:1.28.4 dns-test --restart=Never --rm &#47;bin&#47;sh<br>使用 wget 也是可以验证.<br>","like_count":2,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426646,"discussion_content":"没有的话可以装一个嘛……","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539441397,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1018210,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/89/62/0777bf4f.jpg","nickname":"xiaoxi666","note":"","ucode":"BA4002A837BD99","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":396639,"discussion_content":"或者使用alpine镜像验证。可参见：https://stackoverflow.com/questions/62847331/is-there-possible-to-install-curl-into-busybox-in-kubernetes-pod","likes_number":1,"is_delete":false,"is_hidden":false,"ctime":1632467924,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2441261,"avatar":"https://static001.geekbang.org/account/avatar/00/25/40/2d/9a766753.jpg","nickname":"郭贻铖","note":"","ucode":"B14B1DB14031F2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":351193,"discussion_content":"nginx:1.9.1怎么安装curl","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1614174485,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":31457,"user_name":"yuliz","can_delete":false,"product_type":"c1","uid":1080693,"ip_address":"","ucode":"BFF5B4606559E6","user_header":"https://static001.geekbang.org/account/avatar/00/10/7d/75/c812597b.jpg","comment_is_top":false,"comment_ctime":1539184926,"is_pvip":false,"replies":[{"id":"11300","content":"是的","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1539216586,"ip_address":"","comment_id":31457,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10129119518","product_id":100015201,"comment_content":"storage: 1Gi，表示我想要的 Volume 大小至少是 1 GB；这里是笔误么？1Gi不等于1GB,如果这里是1G应该更符合语景","like_count":2,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426350,"discussion_content":"是的","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539216586,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":342441,"user_name":"Geek_674dce","can_delete":false,"product_type":"c1","uid":2962654,"ip_address":"","ucode":"AEA1A31A1A6EDA","user_header":"","comment_is_top":false,"comment_ctime":1650265423,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5945232719","product_id":100015201,"comment_content":"Rook-ceph 最近集群有所更新，按照老师yaml文件创建的pod会出现无法挂载的情况，搭建rook-ceph集群步骤可以参考github上的快速启动指南访问或者查看官方文件rook.io，切记搭建集群需要为每个台机器添加硬盘加载rbd模块，具体使用步骤可以参看deploy&#47;examples&#47;csi&#47;storageclass.yaml 和 example下的mysql.yaml文件<br>","like_count":1,"discussions":[{"author":{"id":1033169,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/c3/d1/bdf895bf.jpg","nickname":"penng","note":"","ucode":"6087CFCB0AC434","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":584151,"discussion_content":"老铁，没说明白呀","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1660643435,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":"重庆"},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":331187,"user_name":"阿甘","can_delete":false,"product_type":"c1","uid":1057843,"ip_address":"","ucode":"BC93175B70E05D","user_header":"https://static001.geekbang.org/account/avatar/00/10/24/33/bcf37f50.jpg","comment_is_top":false,"comment_ctime":1642477294,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"5937444590","product_id":100015201,"comment_content":"pvc怎样跟pv进行绑定呢？假设说我想绑定到tfs pv而不是cepf pv呢？","like_count":1},{"had_liked":false,"id":292857,"user_name":"罗峰","can_delete":false,"product_type":"c1","uid":1218501,"ip_address":"","ucode":"5F3D6AF8F28322","user_header":"https://static001.geekbang.org/account/avatar/00/12/97/c5/84491beb.jpg","comment_is_top":false,"comment_ctime":1621039588,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5916006884","product_id":100015201,"comment_content":"又有疑问，主挂了，访问它的服务会自动切换到从？还有statefulset如果定义专门，镜像一样，命令一样，感觉没有区别了","like_count":1},{"had_liked":false,"id":205241,"user_name":"Charles","can_delete":false,"product_type":"c1","uid":1201560,"ip_address":"","ucode":"C8C8A4F2B6C20F","user_header":"https://static001.geekbang.org/account/avatar/00/12/55/98/a49061ab.jpg","comment_is_top":false,"comment_ctime":1586575448,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"5881542744","product_id":100015201,"comment_content":"一直遇到这个问题<br>Apr 11 11:05:53 zw-104-162 kubelet[1936838]: E0411 11:05:53.192604 1936838 nestedpendingoperations.go:267] Operation for &quot;\\&quot;kubernetes.io&#47;rbd&#47;wlj-pool:foo\\&quot;&quot; failed. No retries permitted until 2020-04-11 11:07:55.192571833 +0800 CST m=+1121.839392212 (durationBeforeRetry 2m2s). Error: &quot;MountVolume.WaitForAttach failed for volume \\&quot;pv-volume\\&quot; (UniqueName: \\&quot;kubernetes.io&#47;rbd&#47;wlj-pool:foo\\&quot;) pod \\&quot;pv-pod\\&quot; (UID: \\&quot;6197a1f8-7b1f-11ea-bf15-aaaaaa4b0fce\\&quot;) : fail to check rbd image status with: (fork&#47;exec &#47;usr&#47;bin&#47;rbd: invalid argument), rbd output: ()&quot;","like_count":1,"discussions":[{"author":{"id":2300785,"avatar":"https://static001.geekbang.org/account/avatar/00/23/1b/71/791d0f5e.jpg","nickname":"饮水","note":"","ucode":"B8CA8D0A90310F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":368685,"discussion_content":"请问这个问题解决了么","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1618802290,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":46394,"user_name":"Adam","can_delete":false,"product_type":"c1","uid":1305633,"ip_address":"","ucode":"338BA720880E4F","user_header":"https://static001.geekbang.org/account/avatar/00/13/ec/21/b0fe1bfd.jpg","comment_is_top":false,"comment_ctime":1543915137,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5838882433","product_id":100015201,"comment_content":"老师写得很赞，多做几遍实验后就明白怎么使用pv，pvc了。需要提前创建好pv确实有点麻烦。这一步得自动完成才完美。","like_count":1},{"had_liked":false,"id":31297,"user_name":"silver","can_delete":false,"product_type":"c1","uid":1186740,"ip_address":"","ucode":"908E3C8560D6E1","user_header":"https://static001.geekbang.org/account/avatar/00/12/1b/b4/a6db1c1e.jpg","comment_is_top":false,"comment_ctime":1539144253,"is_pvip":false,"replies":[{"id":"11266","content":"PV并不跟机器绑定啊。数据是因为保存在远程存储里所以才有持久性。你这里把PV当成本地存储了。","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1539150737,"ip_address":"","comment_id":31297,"utype":1}],"discussion_count":1,"race_medal":0,"score":"5834111549","product_id":100015201,"comment_content":"如果一个stateful set的pod挂了，PV所在的机子被分配给了其他pod。那当stateful pod重新schedule的时候会不会出现PV所在机器资源不足导致无法schedule的情况？k8s是否针对这种问题有优化?","like_count":1,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426281,"discussion_content":"PV并不跟机器绑定啊。数据是因为保存在远程存储里所以才有持久性。你这里把PV当成本地存储了。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539150737,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":30790,"user_name":"虎虎❤️","can_delete":false,"product_type":"c1","uid":1086535,"ip_address":"","ucode":"157F261E80291A","user_header":"https://static001.geekbang.org/account/avatar/00/10/94/47/75875257.jpg","comment_is_top":false,"comment_ctime":1538997812,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"5833965108","product_id":100015201,"comment_content":"有必要。可以减少同步的数据量。","like_count":1},{"had_liked":false,"id":358634,"user_name":"陈麒文","can_delete":false,"product_type":"c1","uid":2187256,"ip_address":"福建","ucode":"41475885FA5AD5","user_header":"https://static001.geekbang.org/account/avatar/00/21/5f/f8/1d16434b.jpg","comment_is_top":false,"comment_ctime":1664504549,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1664504549","product_id":100015201,"comment_content":"看到这里，有没有人和我一样，还是一脸蒙蒙的😂😂😂","like_count":0},{"had_liked":false,"id":354653,"user_name":"penng","can_delete":false,"product_type":"c1","uid":1033169,"ip_address":"重庆","ucode":"6087CFCB0AC434","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c3/d1/bdf895bf.jpg","comment_is_top":false,"comment_ctime":1660641132,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1660641132","product_id":100015201,"comment_content":"  Warning  FailedScheduling  3m22s (x6 over 28m)  default-scheduler  0&#47;4 nodes are available: 4 pod has unbound immediate PersistentVolumeClaims. preemption: 0&#47;4 nodes are available: 4 Preemption is not helpful for scheduling.<br><br>pod报这个错事啥原因？","like_count":0},{"had_liked":false,"id":348576,"user_name":"Geek_9a323a","can_delete":false,"product_type":"c1","uid":2273209,"ip_address":"","ucode":"F2ADBBA2E645E6","user_header":"http://thirdwx.qlogo.cn/mmopen/Q3auHgzwzM40c11Be6KZpoegnZx1tus7BIGeX23rRvlIYbeAnpbHotEniaphdHsTQN4Fbfz9cJFp5Z9Nc22lUp4icqFLdEgmog7xic9cq0B9E8/132","comment_is_top":false,"comment_ctime":1655205882,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1655205882","product_id":100015201,"comment_content":"PV就是运维搭建的存储服务(可能有多套)？PVC就是开发者提的存储服务的需求？如果有可满足需求的存储服务就使用(也就是适配上了就使用)，如果没有就得按需准备？","like_count":0},{"had_liked":false,"id":348575,"user_name":"Geek_9a323a","can_delete":false,"product_type":"c1","uid":2273209,"ip_address":"","ucode":"F2ADBBA2E645E6","user_header":"http://thirdwx.qlogo.cn/mmopen/Q3auHgzwzM40c11Be6KZpoegnZx1tus7BIGeX23rRvlIYbeAnpbHotEniaphdHsTQN4Fbfz9cJFp5Z9Nc22lUp4icqFLdEgmog7xic9cq0B9E8/132","comment_is_top":false,"comment_ctime":1655205761,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1655205761","product_id":100015201,"comment_content":"PVC是开发者提出的存储需求？","like_count":0},{"had_liked":false,"id":348236,"user_name":"Geek_8d245b","can_delete":false,"product_type":"c1","uid":3009883,"ip_address":"","ucode":"D4EF5B59BFBEBC","user_header":"https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTLW4xGESQvNVvJiaOC8x29RJibCc4h2J4oc7mmCAYyecwjDNuticcicKXy66BicTmf4rAHCWDQOkMYgiabg/132","comment_is_top":false,"comment_ctime":1654855437,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1654855437","product_id":100015201,"comment_content":"老师好，我用的是hostpath类型的pv，我发现将pod删掉之后，调度器会将新的pod调度到与之前pod所在node节点不同的机器上，导致原先pv里的数据无法在新的pod里呈现。请问老师，如何让调度器确保调度新的pod所在node节点和旧pod所在node节点一致？","like_count":0},{"had_liked":false,"id":329918,"user_name":"Chino","can_delete":false,"product_type":"c1","uid":1347181,"ip_address":"","ucode":"0240D89E5F74B4","user_header":"https://static001.geekbang.org/account/avatar/00/14/8e/6d/c68e07ef.jpg","comment_is_top":false,"comment_ctime":1641645778,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1641645778","product_id":100015201,"comment_content":"折腾了好几个小时，试了无数方法，还是一样<br>MountVolume.WaitForAttach failed for volume &quot;pv-volume&quot; : fail to check rbd image status with: (executable file not found in $PATH), rbd output: ()<br>顶不住了。。。","like_count":0,"discussions":[{"author":{"id":2371590,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoWkj13nDtjosQeeaZDIBcrzX3UPIMibWvq1KY0oqclpxUIZAIetRtvwia65IEl0AJgnetNV2XKLtPQ/132","nickname":"Geek_lee","note":"","ucode":"5BAA7A7B7BBD5A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575611,"discussion_content":"在每个节点上安装ceph-common","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654951244,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":324643,"user_name":"追风筝的人","can_delete":false,"product_type":"c1","uid":1488020,"ip_address":"","ucode":"2993D60F94C396","user_header":"https://static001.geekbang.org/account/avatar/00/16/b4/94/2796de72.jpg","comment_is_top":false,"comment_ctime":1638523986,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1638523986","product_id":100015201,"comment_content":"首先，StatefulSet 的控制器直接管理的是 Pod<br>Kubernetes 通过 Headless Service，为这些有编号的 Pod，在 DNS 服务器中生成带有同样编号的 DNS 记录<br>最后，StatefulSet 还为每一个 Pod 分配并创建一个同样编号的 PVC","like_count":0},{"had_liked":false,"id":315078,"user_name":"Geek_515b9e","can_delete":false,"product_type":"c1","uid":1335734,"ip_address":"","ucode":"2D041B7679A2AF","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/dlj3u0jzg1gmCSxZ6daxUhhjtjmgqIwdOyalaEXYDYyQxibOsQdTrKFPPRs2I2XCHoehNaYUPrIffia9ZnR9efqQ/132","comment_is_top":false,"comment_ctime":1633681999,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1633681999","product_id":100015201,"comment_content":"还没讲怎么会按顺序创建出来两个pod对象","like_count":0},{"had_liked":false,"id":292856,"user_name":"罗峰","can_delete":false,"product_type":"c1","uid":1218501,"ip_address":"","ucode":"5F3D6AF8F28322","user_header":"https://static001.geekbang.org/account/avatar/00/12/97/c5/84491beb.jpg","comment_is_top":false,"comment_ctime":1621039296,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1621039296","product_id":100015201,"comment_content":"发现pvc还有隔离的功能，比如两个pvc都使用同一个nfs服务器，但是分别写入其实双方看不到对方的内容；如果想共享存储那就挂同样的pvc。","like_count":0},{"had_liked":false,"id":281233,"user_name":"吃两块云","can_delete":false,"product_type":"c1","uid":2383857,"ip_address":"","ucode":"A50874612046AF","user_header":"https://static001.geekbang.org/account/avatar/00/24/5f/f1/349c0f8b.jpg","comment_is_top":false,"comment_ctime":1614653047,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1614653047","product_id":100015201,"comment_content":"老师真是讲的太好了，解决了我之前很多不懂的地方。鞭辟入里。赞！！！","like_count":0},{"had_liked":false,"id":269382,"user_name":"Dunbreak","can_delete":false,"product_type":"c1","uid":1155210,"ip_address":"","ucode":"A64010733754BF","user_header":"https://static001.geekbang.org/account/avatar/00/11/a0/8a/69f4023c.jpg","comment_is_top":false,"comment_ctime":1608628860,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1608628860","product_id":100015201,"comment_content":"为什么阿里云的k8s服务所能挂载的磁盘都不支持csi中的ReadOnlyMany？","like_count":0},{"had_liked":false,"id":242593,"user_name":"dust！","can_delete":false,"product_type":"c1","uid":1433247,"ip_address":"","ucode":"7ADCCC7985B381","user_header":"https://static001.geekbang.org/account/avatar/00/15/de/9f/b6c59a75.jpg","comment_is_top":false,"comment_ctime":1597791695,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1597791695","product_id":100015201,"comment_content":"老师，分配的storage 1Gi如果用满了，怎么扩容，体直接修改.yaml中的storage的值吗？然后在apply -f .yaml吗","like_count":0},{"had_liked":false,"id":236796,"user_name":"艺超(鲁鸣)","can_delete":false,"product_type":"c1","uid":1029436,"ip_address":"","ucode":"7F749FA543E0F1","user_header":"https://static001.geekbang.org/account/avatar/00/0f/b5/3c/967d7291.jpg","comment_is_top":false,"comment_ctime":1595552269,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1595552269","product_id":100015201,"comment_content":"通常分布式环境下都是多副本，且有分布式一致性保障，所以可以从最新的主节点同步数据。但是，是不是这也取决于存储的数据本身特点呢？万一有必须和机器绑定的信息？","like_count":0},{"had_liked":false,"id":236032,"user_name":"徐海浪","can_delete":false,"product_type":"c1","uid":1078528,"ip_address":"","ucode":"21801C420D0610","user_header":"https://static001.geekbang.org/account/avatar/00/10/75/00/618b20da.jpg","comment_is_top":false,"comment_ctime":1595295280,"is_pvip":false,"discussion_count":0,"race_medal":1,"score":"1595295280","product_id":100015201,"comment_content":"思考题：这个也得看数据量，比如mongodb，数据量大的从零初始化比慢，绑定PV可以通过拷贝数据文件的方式来初始化。如果数据量比较小，比如一个redis或mysql节点，可以从选择从零初始化同步。","like_count":0},{"had_liked":false,"id":233715,"user_name":"吴小智","can_delete":false,"product_type":"c1","uid":1310798,"ip_address":"","ucode":"C7C9F58B5C9F7B","user_header":"https://static001.geekbang.org/account/avatar/00/14/00/4e/be2b206b.jpg","comment_is_top":false,"comment_ctime":1594401207,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1594401207","product_id":100015201,"comment_content":"pod 的名称，是全局唯一的吗？比如说 statefulSet A 和 statefulSet B 中的 pod ，name 可以一样吗？","like_count":0},{"had_liked":false,"id":205695,"user_name":"Andy","can_delete":false,"product_type":"c1","uid":1119133,"ip_address":"","ucode":"4BCA899B8E4E85","user_header":"https://static001.geekbang.org/account/avatar/00/11/13/9d/0ff43179.jpg","comment_is_top":false,"comment_ctime":1586703678,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1586703678","product_id":100015201,"comment_content":"打卡，没看懂，明天接着盘。","like_count":0},{"had_liked":false,"id":194269,"user_name":"Geek_c22199","can_delete":false,"product_type":"c1","uid":1441876,"ip_address":"","ucode":"1CE5B65513E360","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTI2vn8hyjICTCletGs0omz28lhriaZKX2XX9icYzAEon2IEoRnlXqyOia2bEPP0j7T6xexTnr77JJic8w/132","comment_is_top":false,"comment_ctime":1585044397,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1585044397","product_id":100015201,"comment_content":"Emm，第二遍看注意到一些之前没注意到的东西，Deployment 是不是就不能使用pvcTemplates字段呢，等会去看看文档。Deployment 确实也没有pv的需求，毕竟重启一个也是一样的","like_count":0},{"had_liked":false,"id":189355,"user_name":"星期八","can_delete":false,"product_type":"c1","uid":1185504,"ip_address":"","ucode":"34A37F73A48E7F","user_header":"https://static001.geekbang.org/account/avatar/00/12/16/e0/7abad3cc.jpg","comment_is_top":false,"comment_ctime":1584504715,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"1584504715","product_id":100015201,"comment_content":"存储是跟着dns记录走的吗？dns记录先有，然后绑定存储，这样在pod删除时候，再重新建的时候，由于dns记录和存储记录都在，先给重建的pod绑定dns记录，再绑定存储记录的吗","like_count":0,"discussions":[{"author":{"id":2100644,"avatar":"","nickname":"Geek_8e2759","note":"","ucode":"EBDBA4D92B5C50","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":312484,"discussion_content":"和 DNS 没有关系，删除重建的时候根据 Pod 名字查找 PVC， 再绑定","likes_number":2,"is_delete":false,"is_hidden":false,"ctime":1602720214,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":181050,"user_name":"Deephug","can_delete":false,"product_type":"c1","uid":1705587,"ip_address":"","ucode":"E32B54889F7E87","user_header":"https://static001.geekbang.org/account/avatar/00/1a/06/73/c9c6fb6a.jpg","comment_is_top":false,"comment_ctime":1582466559,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1582466559","product_id":100015201,"comment_content":"这个statefulset.yaml文件中的PV是哪个字段定义的","like_count":0},{"had_liked":false,"id":159429,"user_name":"xiaoxlm_0807","can_delete":false,"product_type":"c1","uid":1586508,"ip_address":"","ucode":"32B587038282BC","user_header":"","comment_is_top":false,"comment_ctime":1575621661,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1575621661","product_id":100015201,"comment_content":"创建ceph太麻烦了。 用hostPath来实验老师的讲解内容，就没那么多坑了","like_count":0},{"had_liked":false,"id":132944,"user_name":"随意门","can_delete":false,"product_type":"c1","uid":1316502,"ip_address":"","ucode":"6AADD9C133AFCB","user_header":"https://static001.geekbang.org/account/avatar/00/14/16/96/1538f36c.jpg","comment_is_top":false,"comment_ctime":1568280427,"is_pvip":false,"discussion_count":3,"race_medal":0,"score":"1568280427","product_id":100015201,"comment_content":"为什么我的“web-0” pod自己就把pv的10Gi容量全给占了呢，web-1就一直是pending状态，我的yaml文件直接拷贝的例子里的啊","like_count":0,"discussions":[{"author":{"id":1014665,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/7b/89/34f2cbcc.jpg","nickname":"杨宇","note":"","ucode":"EB74DF6E269F03","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":406469,"discussion_content":"前面有同学提到，如果在本地磁盘而不是Ceph做试验，ReadWriteOnce会导致只能绑一次","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634778502,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1058920,"avatar":"https://static001.geekbang.org/account/avatar/00/10/28/68/774b1619.jpg","nickname":"Fan","note":"","ucode":"F00ADED91FC429","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":285865,"discussion_content":"一样的问题","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1592976871,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1006336,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/5b/00/9078412c.jpg","nickname":"hellofuture","note":"","ucode":"6F76A79ECBE1B7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":214231,"discussion_content":"你好，请问问题解决了吗","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1585151495,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":128534,"user_name":"思考的小蜜蜂","can_delete":false,"product_type":"c1","uid":1571649,"ip_address":"","ucode":"E17F035342B1CE","user_header":"https://static001.geekbang.org/account/avatar/00/17/fb/41/50ca8761.jpg","comment_is_top":false,"comment_ctime":1566897316,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566897316","product_id":100015201,"comment_content":"初学者问下, pv 和 pvc 是怎么关联的 ","like_count":0},{"had_liked":false,"id":127974,"user_name":"胡鹏飞","can_delete":false,"product_type":"c1","uid":1337827,"ip_address":"","ucode":"E69B58440FAE4B","user_header":"https://static001.geekbang.org/account/avatar/00/14/69/e3/a01f9383.jpg","comment_is_top":false,"comment_ctime":1566815777,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1566815777","product_id":100015201,"comment_content":"有人按照这篇资料搭建成功的吗？我这边系统CentOS 7.6 kubernetes 1.11.10 rook 用的1.0.5 ,一直不成功。搞不定，感觉操作步骤写的不详细，一旦复杂的操作就很容易出现各种问题。","like_count":0},{"had_liked":false,"id":126480,"user_name":"Geek_cc64e9","can_delete":false,"product_type":"c1","uid":1630700,"ip_address":"","ucode":"44697DC4578AD7","user_header":"","comment_is_top":false,"comment_ctime":1566392520,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1566392520","product_id":100015201,"comment_content":"张老师您好，在创建pv的示例中按照“pepezzzz”同学的提示创建成功，但是后面通过“StatefulSet”创建POD始终是“Pending”查看原因是因为对应的pvc也是“Pending”，日志显示“<br>Events:<br>  Type    Reason         Age              From                         Message<br>  ----    ------         ----             ----                         -------<br>  Normal  FailedBinding  0s (x2 over 6s)  persistentvolume-controller  no persistent volumes available for this claim and no storage class is set”<br>请问老师可能是什么原因造成？","like_count":0,"discussions":[{"author":{"id":1225508,"avatar":"https://static001.geekbang.org/account/avatar/00/12/b3/24/8246675f.jpg","nickname":"天地有雪","note":"","ucode":"AEAA48B86001C7","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":297138,"discussion_content":"使用rook,至少需要三个节点，每个节点有一个未格式化vdb。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1596784739,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1954540,"avatar":"https://static001.geekbang.org/account/avatar/00/1d/d2/ec/27de7020.jpg","nickname":"zzz","note":"","ucode":"DF8939F2D953BE","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":241745,"discussion_content":"你好，我也遇到相同的问题了，请问你解决了吗？是什么导致的呢？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587437152,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":117009,"user_name":"爱学习","can_delete":false,"product_type":"c1","uid":1150431,"ip_address":"","ucode":"6CE61910D64428","user_header":"https://static001.geekbang.org/account/avatar/00/11/8d/df/1d1dbd57.jpg","comment_is_top":false,"comment_ctime":1563954172,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1563954172","product_id":100015201,"comment_content":"您好，老师，用hostpath的模式，可以将挂载的宿主机的目录加上后续标号的方式去访问吗？","like_count":0},{"had_liked":false,"id":92946,"user_name":"honnkyou","can_delete":false,"product_type":"c1","uid":1026608,"ip_address":"","ucode":"FD5EC4120EE803","user_header":"https://static001.geekbang.org/account/avatar/00/0f/aa/30/acc91f01.jpg","comment_is_top":false,"comment_ctime":1557366506,"is_pvip":false,"discussion_count":4,"race_medal":0,"score":"1557366506","product_id":100015201,"comment_content":"各位rook部署成功，但关联PVC的Pod还是无法创建成功不知各位有没有什么好的方法。<br>rook 相关的pod 情况如下。<br>===<br>$ kubectl -n rook-ceph get pods -o wide<br>NAME                                  READY   STATUS    RESTARTS IP            <br>:<br>rook-ceph-mon-a-7569894f78-9bv79      1&#47;1     Running   0        10.32.0.5     <br>rook-ceph-mon-d-69c8cf94db-hgq7m      1&#47;1     Running   0        10.40.0.5     <br>：  <br>===<br><br>pv的配置如大家提示过的：<br>===<br>$ cat pv-volume.yaml<br>apiVersion: v1<br>kind: PersistentVolume<br>metadata:<br>  name: pv-volume<br>：<br>  rbd:<br>    monitors:<br>    - &#39;10.101.28.45:6789&#39;<br>    - &#39;10.109.41.65:6789&#39;<br>    - &#39;10.32.0.5:6789&#39;<br>    - &#39;10.40.0.5:6789&#39;<br>：<br>    keyring: &#47;etc&#47;ceph&#47;keyring<br>===<br><br>不过还是无法成功创建使用PVC的Pod。<br>$ kubectl get pods web-0<br>NAME    READY   STATUS              RESTARTS<br>web-0   0&#47;1     ContainerCreating   0       <br>$<br><br>event 的结果如下。<br>===<br>$ kubectl describe pods web-0<br>：<br>  Warning  FailedMount 4m59s kubelet, kubeworker01.localdomain  MountVolume.WaitForAttach failed for volume &quot;pv-volume&quot; : fail to check rbd image status with: (exit status 110), rbd output: (2019-05-08 15:35:34.021129 7f710a8d4d80 -1 did not load config file, using default settings.<br>7f710a8d4d80 -1 auth: unable to find a keyring on &#47;etc&#47;ceph&#47;ceph.client.admin.keyring,&#47;etc&#47;ceph&#47;ceph.keyring,&#47;etc&#47;ceph&#47;keyring,&#47;etc&#47;ceph&#47;keyring.bin: (2) No such file or directory<br>0 monclient(hunting): authenticate timed out after 300<br>-1 monclient(hunting): authenticate NOTE: no keyring found; disabled cephx authentication<br>0 librados: client.admin authentication error (110) Connection timed out<br>rbd: couldn&#39;t connect to the cluster!)<br>  Warning  FailedMount  17s (x6 over 11m)  kubelet, kubeworker01.localdomain  Unable to mount volumes for pod &quot;web-0_default(5b3afb24-7163-11e9-88cc-080027beb86a)&quot;: timeout expired waiting for volumes to attach or mount for pod &quot;default&quot;&#47;&quot;web-0&quot;. list of unmounted volumes=[www]. list of unattached volumes=[www default-token-4z447]<br>===","like_count":0,"discussions":[{"author":{"id":2371590,"avatar":"https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eoWkj13nDtjosQeeaZDIBcrzX3UPIMibWvq1KY0oqclpxUIZAIetRtvwia65IEl0AJgnetNV2XKLtPQ/132","nickname":"Geek_lee","note":"","ucode":"5BAA7A7B7BBD5A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":575614,"discussion_content":"进入 rook-ceph-tools pod里，把/etc/ceph/keyring和/etc/ceph/ceph.conf拷贝到k8s各节点","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1654954783,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1580926,"avatar":"","nickname":"ch_ort","note":"","ucode":"B79746E687F29E","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":243055,"discussion_content":"同问","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587518259,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1488498,"avatar":"","nickname":"natian","note":"","ucode":"32E36D6EC79F26","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2267,"discussion_content":"同问，k8s 1.15.0版本没解决。。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563421420,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1241708,"avatar":"https://static001.geekbang.org/account/avatar/00/12/f2/6c/ae143c6f.jpg","nickname":"luff","note":"","ucode":"F85EAB6053F099","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2143,"discussion_content":"您好，我也遇到这样的问题了，您解决了没。我的k8s版本是1.15.0 最新版","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563281329,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":91451,"user_name":"kevinsu","can_delete":false,"product_type":"c1","uid":1078506,"ip_address":"","ucode":"BAD46B815D6A5C","user_header":"https://static001.geekbang.org/account/avatar/00/10/74/ea/10661bdc.jpg","comment_is_top":false,"comment_ctime":1557040951,"is_pvip":false,"discussion_count":2,"race_medal":0,"score":"1557040951","product_id":100015201,"comment_content":"第二次实验遇到一个恶心的问题，MountVolume.WaitForAttach failed for volume &quot;pv-volume&quot; : fail to check rbd image status with: (executable file not found in $PATH), rbd output: ()","like_count":0,"discussions":[{"author":{"id":1591045,"avatar":"https://static001.geekbang.org/account/avatar/00/18/47/05/4ee667bf.jpg","nickname":"岛","note":"","ucode":"6D38023B4CA3CD","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":249939,"discussion_content":"同上","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1587977735,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1585495,"avatar":"https://static001.geekbang.org/account/avatar/00/18/31/57/b2f831a7.jpg","nickname":"深圳小草","note":"","ucode":"F05D485AF07D8F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":2688,"discussion_content":"我的也是，请问您的这个问题解决了吗？","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1563860565,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":58618,"user_name":"lpf32","can_delete":false,"product_type":"c1","uid":1039717,"ip_address":"","ucode":"E1B127FDFF74BB","user_header":"https://static001.geekbang.org/account/avatar/00/0f/dd/65/3b4a2930.jpg","comment_is_top":false,"comment_ctime":1547137741,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1547137741","product_id":100015201,"comment_content":"能够同步数据的集群不是必须的，比如Etcd。当然，如果有是更好的，可以减少同步数据的时间","like_count":0},{"had_liked":false,"id":46753,"user_name":"xiaoshi","can_delete":false,"product_type":"c1","uid":1274195,"ip_address":"","ucode":"6E783D3CDB1DBA","user_header":"https://static001.geekbang.org/account/avatar/00/13/71/53/7b2daf6c.jpg","comment_is_top":false,"comment_ctime":1543977602,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543977602","product_id":100015201,"comment_content":"老师，最近在使用pvc时发现statefulset里面无法对pvc修改，对于一个已有的statefulset无法添加pvc也无法修改pvc size，这个感觉不太方便","like_count":0},{"had_liked":false,"id":43799,"user_name":"Mr.Yang","can_delete":false,"product_type":"c1","uid":1267639,"ip_address":"","ucode":"C2F6A361F3FFD8","user_header":"https://static001.geekbang.org/account/avatar/00/13/57/b7/a37f1bc5.jpg","comment_is_top":false,"comment_ctime":1543296113,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1543296113","product_id":100015201,"comment_content":"张老师你好：请问都有哪些方式可以让PV和PVC绑定在一起呢？这些发方式有没有好处和坏处？","like_count":0},{"had_liked":false,"id":38034,"user_name":"小谢同学","can_delete":false,"product_type":"c1","uid":1032544,"ip_address":"","ucode":"E809E6BC470631","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c1/60/fc3689d0.jpg","comment_is_top":false,"comment_ctime":1541898011,"is_pvip":false,"replies":[{"id":"13674","content":"不share","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1541938240,"ip_address":"","comment_id":38034,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1541898011","product_id":100015201,"comment_content":"请问pvc声明的存储容量是多个pod副本share还是每一个独立的存储容量？","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428569,"discussion_content":"不share","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541938240,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":37661,"user_name":"宋晓明","can_delete":false,"product_type":"c1","uid":1146507,"ip_address":"","ucode":"DC866DCE2FBA9E","user_header":"https://static001.geekbang.org/account/avatar/00/11/7e/8b/3cc461b3.jpg","comment_is_top":false,"comment_ctime":1541669218,"is_pvip":false,"replies":[{"id":"13574","content":"不是的。pvc和pv是同一个卷。","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1541719300,"ip_address":"","comment_id":37661,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1541669218","product_id":100015201,"comment_content":"我怎么感觉PV与PVC的关系就像LVM(逻辑卷管理)中的PV和VG的关系如出一辙呢？  也就是说PVC是在PV那么大的地盘里划出一小部分(PVC)供用户读写的，不知道理解的对不对？","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":428440,"discussion_content":"不是的。pvc和pv是同一个卷。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1541719300,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":37062,"user_name":"jssfy","can_delete":false,"product_type":"c1","uid":1137238,"ip_address":"","ucode":"F16353CFE607B7","user_header":"https://static001.geekbang.org/account/avatar/00/11/5a/56/115c6433.jpg","comment_is_top":false,"comment_ctime":1541436906,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1541436906","product_id":100015201,"comment_content":"请问pvc是只有sts才支持吗？在哪可以查到这种支持关系呢？","like_count":0},{"had_liked":false,"id":31329,"user_name":"silver","can_delete":false,"product_type":"c1","uid":1186740,"ip_address":"","ucode":"908E3C8560D6E1","user_header":"https://static001.geekbang.org/account/avatar/00/12/1b/b4/a6db1c1e.jpg","comment_is_top":false,"comment_ctime":1539151918,"is_pvip":false,"replies":[{"id":"11285","content":"local pv具体怎么回事儿，我在存储部分会详细讲。跟你这里说的关系不大。","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1539173555,"ip_address":"","comment_id":31329,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1539151918","product_id":100015201,"comment_content":"https:&#47;&#47;kubernetes.io&#47;blog&#47;2018&#47;04&#47;13&#47;local-persistent-volumes-beta&#47;<br>现在也开始支持本地pv了。看起来是用preempt缓解了一部分问题，但一些场景应该还会有问题","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":426296,"discussion_content":"local pv具体怎么回事儿，我在存储部分会详细讲。跟你这里说的关系不大。","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1539173555,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":30422,"user_name":"hugeo","can_delete":false,"product_type":"c1","uid":1042824,"ip_address":"","ucode":"438F289EDD21CD","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e9/88/941e488a.jpg","comment_is_top":false,"comment_ctime":1538837463,"is_pvip":false,"replies":[{"id":"10993","content":"有状态应用比较难","user_name":"作者回复","user_name_real":"Geek_6ef93d","uid":"1218095","ctime":1538873427,"ip_address":"","comment_id":30422,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1538837463","product_id":100015201,"comment_content":"最近两篇文章是都是看了两遍才明白，书读百遍其义自现，看来以后的文章估计要读更多遍了(^･ｪ･^)","like_count":0,"discussions":[{"author":{"id":1218095,"avatar":"https://static001.geekbang.org/account/avatar/00/12/96/2f/876085fa.jpg","nickname":"张磊 Kubernetes","note":"","ucode":"16E29BDAB1F5BC","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":425992,"discussion_content":"有状态应用比较难","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1538873427,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":30149,"user_name":"虎虎❤️","can_delete":false,"product_type":"c1","uid":1086535,"ip_address":"","ucode":"157F261E80291A","user_header":"https://static001.geekbang.org/account/avatar/00/10/94/47/75875257.jpg","comment_is_top":false,"comment_ctime":1538702948,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1538702948","product_id":100015201,"comment_content":"deployment的hostname和pod name是否相同？headless service是根据主机名还是pod名去创建dns记录的？<br>先记录下来我的问题，等方便时自己查证。","like_count":0}]}