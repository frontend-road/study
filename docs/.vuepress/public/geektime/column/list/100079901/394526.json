{"id":394526,"title":"ç­”ç–‘è§£æƒ‘02","content":"<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹æ²›ã€‚å®æˆ˜æ¨¡å—æ˜¯æˆ‘ä»¬è¿™é—¨è¯¾çš„å­¦ä¹ é‡ç‚¹ï¼Œæˆ‘çœ‹åˆ°ä¸å°‘åŒå­¦ä¸ä»…è·Ÿä¸Šäº†å­¦ä¹ è¿›åº¦ï¼Œè€Œä¸”è¿˜è·Ÿç€è¯¾ç¨‹ï¼ŒåŠ¨æ‰‹å†™ä»£ç ï¼Œå¹¶æŠŠå…¶ä¸­è®²è§£çš„æ€è·¯åº”ç”¨åˆ°äº†è‡ªå·±çš„å®é™…é¡¹ç›®ä¸­ã€‚ç†è®ºç»“åˆå®è·µï¼Œå­¦ä»¥è‡´ç”¨ï¼Œè¿™æ˜¯ä¸€ç§å¾ˆæœ‰æ•ˆçš„å­¦ä¹ æ–¹æ³•ã€‚</p><p>ä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä¹Ÿçœ‹åˆ°æœ‰åŒå­¦åœ¨ç•™è¨€åŒºæå‡ºäº†å¾ˆå¤šæœ‰ä»·å€¼çš„é—®é¢˜ã€‚æ‰€ä»¥è¿™èŠ‚è¯¾å‘¢ï¼Œæˆ‘ä¼šé’ˆå¯¹ä½ åœ¨å®æˆ˜æ¨¡å—æå‡ºçš„ä¸€äº›å…·æœ‰ä»£è¡¨æ€§çš„é—®é¢˜ï¼Œè¿›è¡Œä¸€ä¸ªé›†ä¸­çš„ç­”ç–‘ã€‚ä¸€æ–¹é¢ç®—æ˜¯å¯¹è¯¾ç¨‹å†…å®¹åšä¸€ä¸ªæœ‰é’ˆå¯¹æ€§åœ°è¡¥å……ï¼Œå¦å¤–ä¸€æ–¹é¢ä¹Ÿå¸Œæœ›èƒ½å¯¹æ›´å¤šçš„åŒå­¦æœ‰æ‰€å¯å‘å’Œå¸®åŠ©ã€‚</p><h2><a href=\"https://time.geekbang.org/column/article/384630\">ç¬¬9è®²</a></h2><p>é¢˜ç›®1ï¼šarticle?.userId å’Œ article&amp;&amp;article.userId çš„ä½œç”¨æ˜¯ä¸€æ ·çš„å—ï¼Ÿç¬¬ä¸€æ¬¡è§è¿™ç§å†™æ³•ï¼Œæ„Ÿè§‰å¥½ç®€æ´ã€‚</p><p>å›ç­”ï¼šè™½ç„¶è¿™æ˜¯ä¸€ä¸ª JS çš„è¯­æ³•é—®é¢˜ï¼Œä½†æ˜¯å› ä¸ºæ˜¯ä¸€ä¸ªæ–°è¯­æ³•ï¼Œæ‰€ä»¥æ—¢ç„¶æœ‰åŒå­¦é—®äº†ï¼Œå°±æ‹¿å‡ºæ¥è®²ä¸€ä¸‹ã€‚ç®€å•æ¥è¯´ï¼Œâ€œ?.\" æ˜¯ä¸€ä¸ªåä¸º optional chaining çš„æ–°è¯­æ³•ï¼Œæ˜¯åˆšåˆšè¿›å…¥ ECMAScript çš„æ ‡å‡†ã€‚å€ŸåŠ©äº Babel æˆ‘ä»¬ç°åœ¨å¯ä»¥æ”¾å¿ƒä½¿ç”¨ã€‚</p><p>article?.userId å’Œ article &amp;&amp; article.userIde è¿™ä¸¤ç§å†™æ³•åŠŸèƒ½æ˜¯åŸºæœ¬ç­‰ä»·çš„ï¼Œå°±æ˜¯åˆ¤æ–­ article æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åˆ™è·å– userId å±æ€§ï¼Œå¦åˆ™å°±æ˜¯ undefinedã€‚è¿™æ ·çš„è¯å¯ä»¥é¿å… JS è¿è¡Œæ—¶çš„æŠ¥é”™ã€‚å”¯ä¸€çš„ä¸€ç‚¹åŒºåˆ«åœ¨äºï¼Œåè€… &amp;&amp; çš„å†™æ³•å…¶å®å¦‚æœ article ä¸º null æˆ–è€… undefined æˆ–è€… 0 ç­‰ falsy çš„å€¼æ—¶ï¼Œä¼šè¿”å›è¿™ä¸ª falsy çš„å€¼æœ¬èº«ï¼Œæ¯”å¦‚ nullï¼Œundefined æˆ–è€… 0ã€‚è™½ç„¶è¿™åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯ä¸ç”¨è€ƒè™‘è¿™ç§å·®åˆ«çš„ã€‚</p><!-- [[[read_end]]] --><p>å¾ˆæ˜¾ç„¶ï¼Œoptional chaining è¿™ç§è¯­æ³•æ›´ç®€æ´è¯­ä¹‰ä¹Ÿæ›´æ˜ç¡®ã€‚ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†å®ƒçš„ç”¨æ³•ï¼š</p><pre><code>// é™æ€å±æ€§\nconst c = foo?.bar?.c;\n// åŠ¨æ€å±æ€§ï¼Œæ•°ç»„å±æ€§\nconst a = obj?.[key].a;\n// æ–¹æ³•è°ƒç”¨\nobj.getSomething?.();\n</code></pre><p>é¢˜ç›®2ï¼šå¯¹äº loading å’Œé”™è¯¯å¤„ç†ï¼Œæˆ‘ä»¬é¡¹ç›®æ˜¯åœ¨åšå…¨å±€å¤„ç†çš„ï¼Œä¸” loading æ˜¯é€šè¿‡ redux ç®¡ç†çš„ã€‚é‚£ä¹ˆè¿™ç§åšæ³•ï¼Œè·Ÿè¿™èŠ‚è¯¾æ‰€è®²çš„æ–¹æ³•ç›¸æ¯”ï¼Œç©¶ç«Ÿåº”è¯¥ä½¿ç”¨å“ªç§æ–¹æ³•å‘¢ï¼Ÿ</p><p>å›ç­”ï¼šä¸¤è€…ä¸å†²çªï¼Œåœ¨ Hooks ä¸­è¯¾ç¨‹é‡Œæ˜¯ç”¨çš„ useStateï¼Œä½†æ˜¯å¦‚æœ loading å’Œ error æ˜¯åœ¨ Redux ä¸­ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ useSelector å»è·å–çŠ¶æ€ã€‚å…¨å±€å¤„ç†çš„å¥½å¤„æ˜¯æ–¹ä¾¿å¤šç»„ä»¶å»é‡ç”¨çŠ¶æ€ï¼Œè€Œä¸”å¯ä»¥é¿å…é‡å¤çš„è¯·æ±‚ã€‚</p><p>æ¯”å¦‚ä¸¤ä¸ªç»„ä»¶éƒ½éœ€è¦å»ä½¿ç”¨ Article æ•°æ®ï¼Œå¦‚æœç”¨ useState ä¿å­˜æ•°æ®ï¼Œé‚£ä¹ˆä¸¤ä¸ªç»„ä»¶å°±éƒ½æœ‰å„è‡ªçš„æ•°æ®ã€‚å¦‚æœæ”¾åˆ° redux ä¸­ï¼Œé‚£ä¹ˆé€»è¾‘å°±å¯ä»¥æ ¹æ®æ˜¯å¦å·²ç»åœ¨ loading æ¥å†³å®šæ˜¯ä¸æ˜¯è¦å‘èµ·è¯·æ±‚ï¼Œè¿˜æ˜¯ç­‰å¾…å·²æœ‰çš„è¯·æ±‚ç»“æŸã€‚</p><h2><a href=\"https://time.geekbang.org/column/article/385358\">ç¬¬10è®²</a></h2><p>é¢˜ç›®ï¼šHOCå­˜åœ¨çš„æ„ä¹‰åœ¨å“ªé‡Œå‘¢ï¼Ÿæ„Ÿè§‰èƒ½å¤Ÿç”¨HOCçš„åœºæ™¯ï¼Œå…¶å®éƒ½å¯ä»¥ç”¨render propsæ¥æ›¿ä»£ã€‚è€Œä¸”ä»é€»è¾‘è§’åº¦è®²ï¼Œrender propsçš„é€»è¾‘æ›´æ¸…æ™°ï¼ŒHOCçš„ä½¿ç”¨é€»è¾‘åˆ™æ›´åŠ å†—ä½™ã€‚æ‰€ä»¥å®åœ¨æƒ³ä¸å‡ºæ¥æœ‰ä»€ä¹ˆåœºæ™¯æ˜¯ä¸€å®šéœ€è¦ä½¿ç”¨HOCçš„ã€‚</p><p>å›ç­”ï¼šHOC å¦‚æœä½œä¸º Controller ï¼Œè€Œä¸æ˜¯æä¾›é¢å¤–å±æ€§æ—¶ï¼Œå…¶è¯­ä¹‰æ˜¯æ›´åŠ æ¸…æ™°çš„ã€‚æ¯”å¦‚è¯´åœ¨ç¬¬14è¯¾æåˆ°çš„æµ®åŠ¨å±‚ï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹è¯æ¡†åœ¨ä¸å¯è§æ—¶å°±ä¸æ‰§è¡Œä»»ä½•é€»è¾‘ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ HOC æ¥å®ç°ä¸€ä¸ªè¿™æ ·çš„ Controllerï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç ï¼š</p><pre><code>const wrapModal = Modal\n  =&gt; ({visible, ...props})\n  =&gt; visible ? &lt;Modal visible {...props} /&gt; : null;\n</code></pre><p>å¯¹äºä¸€ä¸ª Modal ç»„ä»¶ï¼Œå½“ visible ä¸º false æ—¶ï¼Œå°±ç›´æ¥è¿”å› null è€Œä¸æ˜¯å» render Modal ç»„ä»¶ã€‚è¿™é‡Œå°±ç”¨ HOC çš„æ¨¡å¼æ–°å»ºäº†ä¸€ä¸ª Controller æ€§è´¨çš„ç»„ä»¶ï¼Œæ¥é‡ç”¨è¿™ç§é€»è¾‘ã€‚</p><h2><a href=\"https://time.geekbang.org/column/article/386843\">ç¬¬12è®²</a></h2><p>é¢˜ç›®3ï¼šjs-pluginçš„ç”¨å¤„æ„Ÿè§‰æ¯”è¾ƒå¤§ã€‚ä½†æ˜¯åœ¨reactç»„ä»¶ä¸­ï¼Œ<extension name=\"article.footer\" args=\"{article}\"> è¿™æ ·çš„å†™æ³•ï¼Œæˆ‘ç¡®å®ä¸å¤ªèƒ½ç†è§£ã€‚å°±åƒæ˜¯ä¸€ä¸ªå®¹å™¨ç»„ä»¶ï¼Œé€šè¿‡ä¼ å…¥ä¸åŒçš„å‚æ•°ï¼Œè¿”å›ä¸åŒçš„ç»„ä»¶ã€‚å› ä¸ºæˆ‘ä½¿ç”¨tsï¼Œæ„Ÿè§‰è¿™æ ·åˆå°‘äº†ç±»å‹æ£€æŸ¥ã€‚</extension></p><p>å›ç­”ï¼šæ˜¯çš„ï¼Œå¾ˆç±»ä¼¼ä¸€ä¸ªå®¹å™¨ç»„ä»¶ã€‚ä½†æ˜¯è¿™ä¸ªå®¹å™¨ç»„ä»¶çš„å†…å®¹æ¥è‡ªäºæ¾è€¦åˆçš„ä¸åŒéƒ¨åˆ†çš„å†…å®¹ã€‚ä¸æ˜¯ä»å®¹å™¨ç»„ä»¶å†…éƒ¨ä¾èµ–å…¶å®ƒå®ç°ï¼Œè€Œæ˜¯åæ–¹å‘ï¼Œå¤–éƒ¨çš„åŠŸèƒ½è‡ªå·±æä¾›å†…å®¹åˆ°è¿™ä¸ªå®¹å™¨ç»„ä»¶ã€‚å¯¹äº TypeScriptï¼Œç¡®å®æ˜¯ä¸å¤Ÿå‹å¥½çš„ï¼Œå› ä¸ºå¤ªåŠ¨æ€äº†ã€‚ä½†æ˜¯å…¶å®æ²¡æœ‰ç±»å‹æ£€æŸ¥ä¸ä¼šæ˜¯å¤ªå¤§é—®é¢˜ï¼Œå› ä¸ºå†…å®¹æä¾›è€…å’Œæ¶ˆè´¹è€…ä¸¤è€…å”¯ä¸€çš„è¿æ¥ç‚¹æ˜¯ article.footer è¿™ä¸ªæ‰©å±•ç‚¹ä»¥åŠå…¶å‡½æ•°ç­¾åã€‚å½“ç„¶ï¼Œå¦‚æœä¸€å®šè¦æ”¯æŒ TypeScriptï¼Œä¹Ÿæ˜¯å¯è¡Œçš„ï¼Œåªæ˜¯æ¯”è¾ƒç¹çã€‚é‚£å°±æ˜¯ä¸ºæ¯ä¸ªæ‰©å±•ç‚¹æä¾›ä¸€ä¸ªç±»å‹å®šä¹‰æ–‡ä»¶ï¼Œç„¶ååœ¨åˆ›å»º plugin æ—¶ï¼Œplugin å¯¹è±¡éœ€è¦æ»¡è¶³æ‰€æœ‰æ”¯æŒçš„æ‰©å±•ç‚¹çš„ç±»å‹å®šä¹‰ã€‚</p><p>##<a href=\"http://https://time.geekbang.org/column/article/387824\"> ç¬¬13è®²</a></p><p>é¢˜ç›®1ï¼šè™½ç„¶è¿™ä¸ª API åªæ”¯æŒé€šè¿‡å‡½æ•°æ‰§è¡Œè¿›è¡ŒéªŒè¯ï¼Œä½†æ˜¯æˆ‘ä»¬å¾ˆå®¹æ˜“è¿›è¡Œæ‰©å±•ï¼Œä»¥æ”¯æŒæ›´å¤šçš„ç±»å‹ï¼Œæ¯”å¦‚æ­£åˆ™åŒ¹é…ã€å€¼èŒƒå›´ç­‰ç­‰ã€‚è¿™ä¸ªèƒ½æ¼”ç¤ºä¸€ä¸‹å—ï¼Ÿ</p><p>å›ç­”ï¼šè¦æ”¯æŒæ›´å¤šç±»å‹çš„éªŒè¯ï¼Œå°±æ˜¯åˆ¤æ–­å½“å‰æä¾›çš„ validator çš„ç±»å‹ï¼Œæ¯”å¦‚å¦‚æœå‘ç°æä¾›çš„æ˜¯æ­£åˆ™ï¼Œå°±ç”¨æ­£åˆ™åŒ¹é…ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªåŒ…å«äº† minï¼Œmax å±æ€§çš„å¯¹è±¡å°±è¿›è¡Œè‡ªåŠ¨çš„èŒƒå›´åˆ¤æ–­ï¼Œå¦‚æœæ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆå°±è°ƒç”¨å‡½æ•°ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä»£ç åœ¨åŸæœ‰çš„åŸºç¡€ä¸Šæä¾›äº†è¿™å‡ ç§éªŒè¯æœºåˆ¶çš„æ”¯æŒï¼š</p><pre><code>if (validators[name]) {\n  const validator = validators[name];\n  let errMsg;\n  if (typeof validator === 'function') {\n    // å¦‚æœæ˜¯å‡½æ•°ï¼Œå°±è°ƒç”¨å‡½æ•°éªŒè¯\n    errMsg = validator(value);\n  } else if (validator.min) {\n    // å¦‚æœæŒ‡å®šäº† minï¼Œå°±åˆ¤æ–­æ˜¯å¦å°äº min\n    if (value &lt; validator.min) errMsg = `æ•°å€¼éœ€è¦å°äº ${value}`;\n  } else if (validator.max) {\n    // å¦‚æœæä¾›äº† maxï¼Œå°±åˆ¤æ–­æ˜¯å¦å¤§äº max\n    if (value &gt; validator.max) errMsg = `æ•°å€¼éœ€è¦å¤§äº ${value}`;\n  } else if (validator.test) {\n    // ç®€å•çš„é€šè¿‡æ˜¯å¦æœ‰ test æ–¹æ³•æ¥ç¡®å®šæ˜¯ä¸æ˜¯æ­£åˆ™è¡¨è¾¾å¼\n    if (!validator.test(value)) errMsg = `${name} éœ€è¦åŒ¹é…æ­£åˆ™ã€‚`\n  }\n \n  setErrors((errors) =&gt; ({\n    ...errors,\n    [name]: errMsg || null,\n  }));\n}\n</code></pre><p>è¿™æ ·æˆ‘ä»¬å°±æ”¯æŒäº†å¤šç§å½¢å¼çš„éªŒè¯ï¼Œä½†å…¶å®åªè¦æä¾›äº†å‡½æ•°ç±»å‹ï¼Œå°±èƒ½å¤Ÿæ”¯æŒä»»æ„å½¢å¼çš„åŒæ­¥éªŒè¯äº†ã€‚åŠ å…¥æ›´å¤šç±»å‹åªæ˜¯ä¸ºäº†æ–¹ä¾¿è¿™ä¸ª Form æœºåˆ¶çš„ä½¿ç”¨ã€‚</p><h2><a href=\"https://time.geekbang.org/column/article/388776\">ç¬¬14è®²</a></h2><p>é¢˜ç›®1ï¼šNiceModalé‡Œé¢æœ‰ const modal = useNiceModal(id);åœ¨MyModalExampleä¹Ÿç”¨äº† const modal = useNiceModal(\"my-modal\");ç”¨äº†ä¸¤æ¬¡useNiceModalï¼Œè¿”å›å€¼çš„ä¸¤ä¸ªmodalåº”è¯¥æ˜¯ä¸åŒçš„å¯¹è±¡å§ï¼Ÿ modalé‡Œé¢çš„hideã€showå‡½æ•°åº”è¯¥ä¹Ÿæ˜¯ä¸ä¸€æ ·çš„ï¼Œå¯¹å—ï¼Ÿä¸è¿‡æ•°æ®éƒ½å­˜åœ¨const store = createStore(modalReducer)çš„storeé‡Œäº†ï¼Œæ˜¯å…¨å±€çš„ã€‚</p><p>å›ç­”ï¼šæ˜¯çš„ï¼Œä¸¤ä¸ª modal æ˜¯ä¸åŒçš„å¯¹è±¡ï¼Œshowï¼Œhide å‡½æ•°ä¹Ÿä¸ä¸€æ ·ã€‚useModal è¿”å›çš„åªæ˜¯ç”¨äºæ§åˆ¶æŸä¸ªå¯¹è¯æ¡†çš„ä¸€ä¸ª handlerã€‚è¿™é‡Œçš„å…³é”®åœ¨äºè¦ç†è§£è‡ªå®šä¹‰ Hook å°±ç›¸å½“äºä¸€ä¸ªè‡ªå®šä¹‰ç»„ä»¶ï¼Œå†…éƒ¨ä½¿ç”¨çš„ä»»ä½•å…¶å®ƒ Hooksï¼Œæ¯”å¦‚ useStateï¼ŒuseEffect éƒ½æ˜¯å’Œå¤–å±‚ç»„ä»¶æ¯«æ— å…³ç³»çš„ã€‚ä»–ä»¬éƒ½æ˜¯å­˜åœ¨äºè‡ªå·±çš„ä½œç”¨åŸŸé‡Œï¼Œé€šè¿‡å‚æ•°å’Œè¿”å›å€¼å’Œè°ƒç”¨è€…äº¤äº’ã€‚æ‰€ä»¥ï¼Œè¦å®ç° Hooks ä¹‹é—´çš„çŠ¶æ€å…±äº«ï¼Œä»ç„¶éœ€è¦Contextï¼ŒRedux ç­‰å…¨å±€çš„çŠ¶æ€ç®¡ç†æœºåˆ¶ã€‚</p><p>é¢˜ç›®2ï¼šåœ¨è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ Redux æ¥ç®¡ç†æ‰€æœ‰å¯¹è¯æ¡†çš„æ‰€æœ‰çŠ¶æ€ã€‚ä½†æœ‰æ—¶å€™ä½ çš„é¡¹ç›®å¹¶ä¸ä¸€å®šä½¿ç”¨äº† Reduxï¼Œé‚£ä¹ˆæˆ‘ä»¬å…¶å®ä¹Ÿå¯ä»¥ä½¿ç”¨ Context æ¥ç®¡ç†å¯¹è¯æ¡†çš„å…¨å±€çŠ¶æ€ã€‚é‚£ä¹ˆè¯·ä½ æ€è€ƒä¸€ä¸‹ï¼Œå¦‚æœåŸºäº Context ï¼Œåº”è¯¥å¦‚ä½•å®ç° NiceModal å‘¢ï¼Ÿ</p><p>å›ç­”ï¼šåœ¨åŸºç¡€ç¯‡ä¸­ä½ æ›¾çœ‹åˆ°è¿‡ useContext çš„ç”¨æ³•ï¼Œå®ƒä¹Ÿæ˜¯å®ç°å…¨å±€çŠ¶æ€ç®¡ç†çš„ä¸€ä¸ªæœºåˆ¶ã€‚ä½†æ˜¯ï¼Œå½“æ—¶å¹¶æ²¡æœ‰æåˆ° useReducer è¿™ä¸ªä» Redux å€Ÿé‰´è¿‡æ¥çš„ APIã€‚æ²¡æœ‰ä»‹ç»çš„åŸå› å…¶å®åœ¨äºæˆ‘ä¸ªäººè§‰å¾— useReducer å…¶å®å¹¶ä¸å¸¸ç”¨ï¼Œå› ä¸ºé€šå¸¸æ¥è¯´æˆ‘ä»¬ä½¿ç”¨ Redux ç­‰ç‹¬ç«‹çš„æ¡†æ¶ä¼šæ›´åŠ æ–¹ä¾¿ï¼Œå› ä¸º API æ›´åŠ ä¸°å¯Œï¼Œä»¥åŠç”Ÿæ€æ›´å®Œå–„ï¼Œæ¯”å¦‚ Redux çš„ä¸€äº›ä¸­é—´ä»¶ç­‰ç­‰ã€‚</p><p>ä½†æ˜¯ï¼Œåœ¨è¿™é“é¢˜ç›®ä¸­ï¼Œè™½ç„¶å¯ä»¥ä¸ç”¨ useReducerï¼Œä½†æ˜¯å¦‚æœä½¿ç”¨çš„è¯ï¼Œæ˜¯å¯ä»¥å‡ ä¹å®Œå…¨é‡ç”¨è¯¾ç¨‹ä¸­ä¾‹å­çš„ä»£ç çš„ã€‚å› ä¸º Redux å’Œ useReducer çš„reducer å’Œ action çš„å®ç°æ˜¯å®Œå…¨å…¼å®¹çš„ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¾ˆå¤šäººè¯´ï¼ŒContext + useReducer æ˜¯å‡ ä¹å¯ä»¥æ›¿ä»£ Redux çš„ã€‚ä¸‹é¢çš„ä»£ç å±•ç¤ºäº†ä½¿ç”¨ Context çš„å®ç°ï¼š</p><pre><code>import React, { useContext, useReducer } from 'react';\n\n\n// ä½¿ç”¨ä¸€ä¸ª Context æ¥å­˜æ”¾ Modal çš„çŠ¶æ€\nconst NiceModalContext = React.createContext({});\n// modalReducer å’Œ Redux çš„åœºæ™¯å®Œå…¨ä¸€æ ·\nconst modalReducer = ...\nfunction NiceModalProvider({ children }) {\n  const [modals, dispatch] = useReducer(modalReducer,{});\n  return (\n    &lt;NiceModalContext.Provider value={{ modals, dispatch }}&gt;\n      {children}\n    &lt;/NiceModalContext.Provider&gt;\n  );\n};\n</code></pre><p>å› ä¸ºä½¿ç”¨äº† Contextï¼Œæ‰€ä»¥éœ€è¦åœ¨æ•´ä¸ªåº”ç”¨çš„æ ¹èŠ‚ç‚¹åˆ›å»º Context å¹¶æä¾›æ‰€æœ‰å¯¹è¯æ¡†çš„çŠ¶æ€ç®¡ç†æœºåˆ¶ã€‚è¿™é‡Œä¹Ÿçœ‹åˆ°äº†ä¸€ä¸ªéå¸¸å…³é”®çš„ç»„åˆï¼Œå°±æ˜¯ä½¿ç”¨äº† useReducer æ¥ç®¡ç†ä¸€ä¸ªå¤æ‚çš„çŠ¶æ€ï¼Œç„¶åå†å°†è¿™ä¸ªçŠ¶æ€ä½œä¸º Context çš„ valueã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒuseReducer ç®¡ç†çš„ä»ç„¶æ˜¯ä¸€ä¸ªç»„ä»¶çš„æœ¬åœ°çŠ¶æ€ï¼Œå’Œ useState ç±»ä¼¼ï¼Œä½†å…¶å®å•ä¸ªç»„ä»¶å¾ˆå°‘æœ‰çŠ¶æ€éœ€è¦ useReducer è¿™æ ·çš„é«˜çº§åŠŸèƒ½æ¥ç®¡ç†ï¼Œæ‰€ä»¥ä¸€èˆ¬å…¶å® useReducer éƒ½æ˜¯å’Œ Context ä¸€èµ·ä½¿ç”¨çš„ï¼Œå»ç®¡ç†ä¸€ä¸ªæ›´å¤§èŒƒå›´çš„æ•°æ®çŠ¶æ€ã€‚</p><h2><a href=\"https://time.geekbang.org/column/article/389596\">ç¬¬15è®²</a></h2><p>é¢˜ç›®1ï¼šåŸæ–‡å†™ï¼šâ€œå¦‚æœä½ çš„äº‹ä»¶å¤„ç†å‡½æ•°æ˜¯ä¼ é€’ç»™åŸç”ŸèŠ‚ç‚¹çš„ï¼Œé‚£ä¹ˆä¸å†™ callbackï¼Œä¹Ÿå‡ ä¹ä¸ä¼šæœ‰ä»»ä½•æ€§èƒ½çš„å½±å“ã€‚â€ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿæ˜¯ä¸æ˜¯å› ä¸ºåŸç”ŸèŠ‚ç‚¹ï¼Œæœ¬æ¥å°±è¦ä¸æ–­æ¸²æŸ“å‘¢ï¼Ÿ</p><p>å›ç­”ï¼šè¦å›ç­”è¿™ä¸ªé—®é¢˜ï¼Œå…³é”®è¿˜åœ¨äºç†è§£åœ¨useCallback ç©¶ç«Ÿæ˜¯ä¸ºäº†è§£å†³ä»€ä¹ˆé—®é¢˜ã€‚é—®é¢˜çš„æœ¬è´¨åœ¨äºï¼ŒReact ç»„ä»¶æ˜¯é€šè¿‡å¼•ç”¨æ¯”è¾ƒæ¥åˆ¤æ–­æŸä¸ªå€¼æ˜¯å¦å‘ç”Ÿäº†å˜åŒ–ï¼Œå¦‚æœå˜åŒ–äº†ï¼Œé‚£ä¹ˆç»„ä»¶å°±éœ€è¦é‡æ–°æ¸²æŸ“ï¼Œä»¥åŠè™šæ‹Ÿ DOM çš„ diff æ¯”è¾ƒã€‚é‚£ä¹ˆï¼Œå¦‚æœæ¯æ¬¡ä¼ è¿‡å»ä¸åŒçš„å‡½æ•°ï¼Œå³ä½¿è¿™äº›å‡½æ•°çš„åŠŸèƒ½å®Œå…¨ä¸€æ ·ï¼Œé‚£ä¹Ÿä¼šå¯¼è‡´ç»„ä»¶è¢«åˆ·æ–°ã€‚æ‰€ä»¥ï¼ŒuseCallback, useMemo å°±æ˜¯é€šè¿‡ç¼“å­˜ä¸Šä¸€æ¬¡çš„çš„ç»“æœæ¥ç¡®ä¿å¦‚æœåŠŸèƒ½æ²¡å˜ï¼Œé‚£ä¹ˆå°±ä½¿ç”¨åŒæ ·çš„å‡½æ•°ï¼Œæ¥é¿å…é‡æ–°æ¸²æŸ“ã€‚</p><p>æ‰€ä»¥ï¼ŒuseCallbackï¼ŒuseMemo åªæ˜¯ä¸ºäº†é¿å… React ç»„ä»¶çš„é‡å¤æ¸²æŸ“è€Œå¯¼è‡´çš„æ€§èƒ½æŸå¤±ã€‚è€Œå¯¹äºåŸç”Ÿçš„èŠ‚ç‚¹ï¼Œæ¯”å¦‚ div, input è¿™äº›ï¼Œå®ƒä»¬å·²ç»æ˜¯åŸå­èŠ‚ç‚¹äº†ï¼Œä¸å†æœ‰å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¸å­˜åœ¨é‡å¤åˆ·æ–°å¸¦æ¥çš„æ€§èƒ½æŸå¤±ã€‚</p><h2><a href=\"https://time.geekbang.org/column/article/390121\">ç¬¬16è®²</a></h2><p>é¢˜ç›®1ï¼šå¯¹äº react-loadable å’Œ Service Worker æœ‰ä¸¤ç‚¹æ¯”è¾ƒç–‘æƒ‘çš„åœ°æ–¹ã€‚</p><p>ï¼ˆ1ï¼‰react-loadable å’Œ React.lazy() çš„ä½¿ç”¨åœºæ™¯æœ‰ä»€ä¹ˆä¸ä¸€æ ·å—ï¼Ÿè¿˜æ˜¯è¯´ï¼Œä½¿ç”¨ react-loadable çš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨React.lazy()ä»£æ›¿ï¼Ÿ</p><p>å›ç­”ï¼šç¡®å®ï¼Œä¸¤è€…ç¡®å®å¯ä»¥è§£å†³ä¸€æ ·çš„é—®é¢˜ï¼Œæ¯•ç«Ÿ import() è¿™ä¸ªè¯­å¥æ˜¯ç”± Webpack æ¥å¤„ç†ï¼Œæœ€ç»ˆå®ç°åˆ†åŒ…çš„ã€‚æ‰€ä»¥ç»“åˆ React.lazy å’Œ Suspense å¯ä»¥å®ç° react-loadable çš„åŠŸèƒ½ã€‚ä½†æ˜¯å‘¢ï¼Œreact-loadabale æä¾›äº†æ›´ä¸°å¯Œçš„ APIï¼Œæ¯”å¦‚å¯ä»¥è®¾ç½®å¦‚æœåŠ è½½äº‹ä»¶å°äº300æ¯«ç§’ï¼Œå°±ä¸æ˜¾ç¤º loading çŠ¶æ€ã€‚è¿™åœ¨ä½¿ç”¨ service worker æ—¶å¯ä»¥è®©ç”¨æˆ·æ„ŸçŸ¥ä¸åˆ°æŒ‰éœ€åŠ è½½çš„å­˜åœ¨ï¼Œä½“éªŒæ›´å¥½ã€‚å› ä¸ºæœ‰ç ”ç©¶è¡¨æ˜ï¼Œå¦‚æœåŠ è½½æ—¶é—´æœ¬æ¥å¾ˆçŸ­ï¼Œä½ å´ä¸€é—ªè€Œè¿‡ä¸€ä¸ª loading çŠ¶æ€ï¼Œä¼šè®©ç”¨æˆ·è§‰å¾—æ—¶é—´å¾ˆé•¿ã€‚å¦å¤–å°±æ˜¯ï¼Œreact-loadable æä¾›äº†æœåŠ¡å™¨ç«¯æ¸²æŸ“çš„æ”¯æŒï¼Œè€Œ React.lazy æ˜¯ä¸è¡Œçš„ã€‚</p><p>ï¼ˆ2ï¼‰åœ¨Service Worker ä¸­ä½¿ç”¨ Cache Storage æ¥ç¼“å­˜é™æ€èµ„æºï¼Œæ˜¯å¦æœ‰å®¹é‡å¤§å°çš„é™åˆ¶å‘¢ï¼Ÿå¦‚æœæ˜¯åœ¨ç¼“å­˜ svgã€pngç­‰å…¶ä»–æ ¼å¼çš„é™æ€èµ„æºçš„æ—¶å€™ï¼Œæ˜¯å¦æœ‰ä»€ä¹ˆé™åˆ¶å‘¢ï¼Ÿ</p><p>å›ç­”ï¼šCache çš„å¤§å°å¹¶æ²¡æœ‰ç»Ÿä¸€çš„è§„å®šï¼Œå„ä¸ªæµè§ˆå™¨ä¼šæä¾›ä¸åŒçš„ sizeï¼Œä½†ä¸€ä¸ªå…±è¯†æ˜¯æ ¹æ®å½“å‰ç£ç›˜å‰©ä½™å¤§å°å»è°ƒæ•´ï¼Œä»è€Œå†³å®šæ˜¯å¦èƒ½ç»§ç»­å­˜å‚¨æ•°æ®ã€‚ä½†æ˜¯ï¼Œæ— è®º Size æ˜¯å¤šå°‘ï¼Œæˆ‘ä»¬éƒ½éœ€è¦åŠæ—¶æ¸…é™¤ä¸éœ€è¦çš„æ•°æ®ï¼Œä»¥åŠä¸€å®šè¦å¤„ç†å­˜å‚¨å¤±è´¥çš„åœºæ™¯ï¼Œè½¬è€Œä½¿ç”¨æœåŠ¡å™¨ç«¯çš„æ•°æ®ã€‚ä»è€Œä¿è¯å³ä½¿ Cache æ»¡äº†ï¼Œä¹Ÿä¸å½±å“åŠŸèƒ½çš„ä½¿ç”¨ã€‚</p>","comments":[{"had_liked":false,"id":303547,"user_name":"æåŒ—ä¹‹åœ°","can_delete":false,"product_type":"c1","uid":2683428,"ip_address":"","ucode":"D865D0F07CD48B","user_header":"https://static001.geekbang.org/account/avatar/00/28/f2/24/1415c086.jpg","comment_is_top":false,"comment_ctime":1626851894,"is_pvip":false,"replies":[{"id":"109861","content":"è¿™ä¹ˆè¯´å§ &lt;input onclick=&quot;dosomething&quot;&#47;&gt; è¿™æ ·çš„åŸç”ŸèŠ‚ç‚¹ï¼Œonclick æ¯æ¬¡ç»™ä¸€ä¸ªæ–°å€¼ï¼Œä¹Ÿåªæ˜¯å±æ€§çš„æ›´æ–°è€Œå·²ã€‚å¯¹äº divï¼Œå› ä¸ºå®ƒçš„ children ä¸æ˜¯ react å»æ§åˆ¶çš„ï¼Œæ‰€ä»¥å±æ€§å˜åŒ–ä¹Ÿå°±åªæ˜¯å±æ€§å˜åŒ–ï¼Œä¸ä¼šå½±å“ dom diffã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Nate","uid":"1018676","ctime":1626854080,"ip_address":"","comment_id":303547,"utype":1}],"discussion_count":1,"race_medal":0,"score":"23101688374","product_id":100079901,"comment_content":"è¿™å¥è¯è¿˜æ˜¯æ²¡å¤ªæ˜ç™½â€œè€Œå¯¹äºåŸç”Ÿçš„èŠ‚ç‚¹ï¼Œæ¯”å¦‚ div, input è¿™äº›ï¼Œå®ƒä»¬å·²ç»æ˜¯åŸå­èŠ‚ç‚¹äº†ï¼Œä¸å†æœ‰å­èŠ‚ç‚¹ï¼Œæ‰€ä»¥ä¸å­˜åœ¨é‡å¤åˆ·æ–°å¸¦æ¥çš„æ€§èƒ½æŸå¤±â€ğŸ˜­","like_count":6,"discussions":[{"author":{"id":1018676,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/34/61035278.jpg","nickname":"Nate","note":"","ucode":"844B4C20BB3D6E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":523733,"discussion_content":"è¿™ä¹ˆè¯´å§ &amp;lt;input onclick=&amp;quot;dosomething&amp;quot;/&amp;gt; è¿™æ ·çš„åŸç”ŸèŠ‚ç‚¹ï¼Œonclick æ¯æ¬¡ç»™ä¸€ä¸ªæ–°å€¼ï¼Œä¹Ÿåªæ˜¯å±æ€§çš„æ›´æ–°è€Œå·²ã€‚å¯¹äº divï¼Œå› ä¸ºå®ƒçš„ children ä¸æ˜¯ react å»æ§åˆ¶çš„ï¼Œæ‰€ä»¥å±æ€§å˜åŒ–ä¹Ÿå°±åªæ˜¯å±æ€§å˜åŒ–ï¼Œä¸ä¼šå½±å“ dom diffã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626854080,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":304957,"user_name":"1830","can_delete":false,"product_type":"c1","uid":1374337,"ip_address":"","ucode":"246FEF7C97F39C","user_header":"https://static001.geekbang.org/account/avatar/00/14/f8/81/bff52f91.jpg","comment_is_top":false,"comment_ctime":1627717118,"is_pvip":false,"replies":[{"id":"110355","content":"æ¯”å¦‚ &lt;Form onChange={onChange}&gt;...&lt;&#47;Form&gt; ï¼Œè¿™ä¸ª Form ç»„ä»¶ä¼šæ ¹æ® onChange æ˜¯å¦å˜åŒ–æ¥å†³å®šæ˜¯å¦é‡æ–° renderã€‚useCallback å¯ä»¥è®© onChange åœ¨å¤šæ¬¡æ¸²æŸ“ä¹‹é—´ä¸å˜ï¼Œé¿å… Form ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚","user_name":"ä½œè€…å›å¤","user_name_real":"Nate","uid":"1018676","ctime":1627820507,"ip_address":"","comment_id":304957,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1627717118","product_id":100079901,"comment_content":"è€å¸ˆéº»çƒ¦é—®ä¸€ä¸‹ï¼Œå½“è§¦å‘è§†å›¾renderæ—¶ï¼Œç»„ä»¶ä¸æ˜¯å…¨éƒ¨éƒ½è¦é‡æ–°æ¸²æŸ“å—ï¼Œå³ä½¿ç”¨äº†useCallbackä¹Ÿè¦æ¸²æŸ“å‘€ï¼Œä¸ºä»€ä¹ˆè¯´å¯ä»¥å‡å°‘é‡å¤æ¸²æŸ“å‘¢","like_count":0,"discussions":[{"author":{"id":1018676,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/8b/34/61035278.jpg","nickname":"Nate","note":"","ucode":"844B4C20BB3D6E","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":524226,"discussion_content":"æ¯”å¦‚ &amp;lt;Form onChange={onChange}&amp;gt;...&amp;lt;/Form&amp;gt; ï¼Œè¿™ä¸ª Form ç»„ä»¶ä¼šæ ¹æ® onChange æ˜¯å¦å˜åŒ–æ¥å†³å®šæ˜¯å¦é‡æ–° renderã€‚useCallback å¯ä»¥è®© onChange åœ¨å¤šæ¬¡æ¸²æŸ“ä¹‹é—´ä¸å˜ï¼Œé¿å… Form ç»„ä»¶çš„é‡æ–°æ¸²æŸ“ã€‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1627820507,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":302350,"user_name":"Geeker","can_delete":false,"product_type":"c1","uid":1032345,"ip_address":"","ucode":"9937127DE96D78","user_header":"https://static001.geekbang.org/account/avatar/00/0f/c0/99/259a412f.jpg","comment_is_top":false,"comment_ctime":1626175373,"is_pvip":true,"discussion_count":2,"race_medal":0,"score":"1626175373","product_id":100079901,"comment_content":"ç»“æŸäº†ï¼Ÿ","like_count":0,"discussions":[{"author":{"id":1394238,"avatar":"https://static001.geekbang.org/account/avatar/00/15/46/3e/f9ae9462.jpg","nickname":"ç›–ä¸–è‹±é›„","note":"","ucode":"50CD6CCD4D8B76","race_medal":1,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":384676,"discussion_content":"ç»“æŸå•¦\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626698279,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2311402,"avatar":"https://static001.geekbang.org/account/avatar/00/23/44/ea/8a9b868d.jpg","nickname":"ç¼æ–¯åŸºäºš","note":"","ucode":"24892258DF0CC2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":383727,"discussion_content":"å¥½åƒæœ‰ç‚¹ä»“ä¿ƒï¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1626224996,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]}]}