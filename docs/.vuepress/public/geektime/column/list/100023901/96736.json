{"id":96736,"title":"37 | è®¾è®¡æ¨¡å¼æ¨¡å—çƒ­ç‚¹é—®é¢˜ç­”ç–‘","content":"<p>å¤šçº¿ç¨‹è®¾è®¡æ¨¡å¼æ˜¯å‰äººè§£å†³å¹¶å‘é—®é¢˜çš„ç»éªŒæ€»ç»“ï¼Œå½“æˆ‘ä»¬è¯•å›¾è§£å†³ä¸€ä¸ªå¹¶å‘é—®é¢˜æ—¶ï¼Œé¦–é€‰æ–¹æ¡ˆå¾€å¾€æ˜¯ä½¿ç”¨åŒ¹é…çš„è®¾è®¡æ¨¡å¼ï¼Œè¿™æ ·èƒ½é¿å…èµ°å¼¯è·¯ã€‚åŒæ—¶ï¼Œç”±äºå¤§å®¶éƒ½ç†Ÿæ‚‰è®¾è®¡æ¨¡å¼ï¼Œæ‰€ä»¥ä½¿ç”¨è®¾è®¡æ¨¡å¼è¿˜èƒ½æå‡æ–¹æ¡ˆå’Œä»£ç çš„å¯ç†è§£æ€§ã€‚</p><p>åœ¨è¿™ä¸ªæ¨¡å—ï¼Œæˆ‘ä»¬æ€»å…±ä»‹ç»äº†9ç§å¸¸è§çš„å¤šçº¿ç¨‹è®¾è®¡æ¨¡å¼ã€‚ä¸‹é¢æˆ‘ä»¬å°±å¯¹è¿™9ç§è®¾è®¡æ¨¡å¼åšä¸ªåˆ†ç±»å’Œæ€»ç»“ï¼ŒåŒæ—¶ä¹Ÿå¯¹å‰é¢å„ç« çš„è¯¾åæ€è€ƒé¢˜åšä¸ªç­”ç–‘ã€‚</p><h2>é¿å…å…±äº«çš„è®¾è®¡æ¨¡å¼</h2><p><strong>Immutabilityæ¨¡å¼</strong>ã€<strong>Copy-on-Writeæ¨¡å¼</strong>å’Œ<strong>çº¿ç¨‹æœ¬åœ°å­˜å‚¨æ¨¡å¼</strong>æœ¬è´¨ä¸Šéƒ½æ˜¯<strong>ä¸ºäº†é¿å…å…±äº«</strong>ï¼Œåªæ˜¯å®ç°æ‰‹æ®µä¸åŒè€Œå·²ã€‚è¿™3ç§è®¾è®¡æ¨¡å¼çš„å®ç°éƒ½å¾ˆç®€å•ï¼Œä½†æ˜¯å®ç°è¿‡ç¨‹ä¸­æœ‰äº›ç»†èŠ‚è¿˜æ˜¯éœ€è¦æ ¼å¤–æ³¨æ„çš„ã€‚ä¾‹å¦‚ï¼Œ<strong>ä½¿ç”¨Immutabilityæ¨¡å¼éœ€è¦æ³¨æ„å¯¹è±¡å±æ€§çš„ä¸å¯å˜æ€§ï¼Œä½¿ç”¨Copy-on-Writeæ¨¡å¼éœ€è¦æ³¨æ„æ€§èƒ½é—®é¢˜ï¼Œä½¿ç”¨çº¿ç¨‹æœ¬åœ°å­˜å‚¨æ¨¡å¼éœ€è¦æ³¨æ„å¼‚æ­¥æ‰§è¡Œé—®é¢˜</strong>ã€‚æ‰€ä»¥ï¼Œæ¯ç¯‡æ–‡ç« æœ€åæˆ‘è®¾ç½®çš„è¯¾åæ€è€ƒé¢˜çš„ç›®çš„å°±æ˜¯æé†’ä½ æ³¨æ„è¿™äº›ç»†èŠ‚ã€‚</p><p><a href=\"https://time.geekbang.org/column/article/92856\">ã€Š28 | Immutabilityæ¨¡å¼ï¼šå¦‚ä½•åˆ©ç”¨ä¸å˜æ€§è§£å†³å¹¶å‘é—®é¢˜ï¼Ÿã€‹</a>çš„è¯¾åæ€è€ƒé¢˜æ˜¯è®¨è®ºAccountè¿™ä¸ªç±»æ˜¯ä¸æ˜¯å…·å¤‡ä¸å¯å˜æ€§ã€‚è¿™ä¸ªç±»åˆçœ‹ä¸Šå»å±äºä¸å¯å˜å¯¹è±¡çš„ä¸­è§„ä¸­çŸ©å®ç°ï¼Œè€Œå®è´¨ä¸Šè¿™ä¸ªå®ç°æ˜¯æœ‰é—®é¢˜çš„ï¼ŒåŸå› åœ¨äºStringBufferä¸åŒäºStringï¼ŒStringBufferä¸å…·å¤‡ä¸å¯å˜æ€§ï¼Œé€šè¿‡getUser()æ–¹æ³•è·å–userä¹‹åï¼Œæ˜¯å¯ä»¥ä¿®æ”¹userçš„ã€‚ä¸€ä¸ªç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯è®©getUser()æ–¹æ³•è¿”å›Stringå¯¹è±¡ã€‚</p><!-- [[[read_end]]] --><pre><code>public final class Account{\n  private final \n    StringBuffer user;\n  public Account(String user){\n    this.user = \n      new StringBuffer(user);\n  }\n  //è¿”å›çš„StringBufferå¹¶ä¸å…·å¤‡ä¸å¯å˜æ€§\n  public StringBuffer getUser(){\n    return this.user;\n  }\n  public String toString(){\n    return &quot;user&quot;+user;\n  }\n}\n</code></pre><p><a href=\"https://time.geekbang.org/column/article/93154\">ã€Š29 | Copy-on-Writeæ¨¡å¼ï¼šä¸æ˜¯å»¶æ—¶ç­–ç•¥çš„COWã€‹</a>çš„è¯¾åæ€è€ƒé¢˜æ˜¯è®¨è®ºJava SDKä¸­ä¸ºä»€ä¹ˆæ²¡æœ‰æä¾› CopyOnWriteLinkedListã€‚è¿™æ˜¯ä¸€ä¸ªå¼€æ”¾æ€§çš„é—®é¢˜ï¼Œæ²¡æœ‰æ ‡å‡†ç­”æ¡ˆï¼Œä½†æ˜¯æ€§èƒ½é—®é¢˜ä¸€å®šæ˜¯å…¶ä¸­ä¸€ä¸ªå¾ˆé‡è¦çš„åŸå› ï¼Œæ¯•ç«Ÿå®Œæ•´åœ°å¤åˆ¶LinkedListæ€§èƒ½å¼€é”€å¤ªå¤§äº†ã€‚</p><p><a href=\"https://time.geekbang.org/column/article/93745\">ã€Š30 | çº¿ç¨‹æœ¬åœ°å­˜å‚¨æ¨¡å¼ï¼šæ²¡æœ‰å…±äº«ï¼Œå°±æ²¡æœ‰ä¼¤å®³ã€‹</a>çš„è¯¾åæ€è€ƒé¢˜æ˜¯åœ¨å¼‚æ­¥åœºæ™¯ä¸­ï¼Œæ˜¯å¦å¯ä»¥ä½¿ç”¨ Spring çš„äº‹åŠ¡ç®¡ç†å™¨ã€‚ç­”æ¡ˆæ˜¾ç„¶æ˜¯ä¸èƒ½çš„ï¼ŒSpring ä½¿ç”¨ ThreadLocal æ¥ä¼ é€’äº‹åŠ¡ä¿¡æ¯ï¼Œå› æ­¤è¿™ä¸ªäº‹åŠ¡ä¿¡æ¯æ˜¯ä¸èƒ½è·¨çº¿ç¨‹å…±äº«çš„ã€‚å®é™…å·¥ä½œä¸­æœ‰å¾ˆå¤šç±»åº“éƒ½æ˜¯ç”¨ ThreadLocal ä¼ é€’ä¸Šä¸‹æ–‡ä¿¡æ¯çš„ï¼Œè¿™ç§åœºæ™¯ä¸‹å¦‚æœæœ‰å¼‚æ­¥æ“ä½œï¼Œä¸€å®šè¦æ³¨æ„ä¸Šä¸‹æ–‡ä¿¡æ¯æ˜¯ä¸èƒ½è·¨çº¿ç¨‹å…±äº«çš„ã€‚</p><h2>å¤šçº¿ç¨‹ç‰ˆæœ¬IFçš„è®¾è®¡æ¨¡å¼</h2><p><strong>Guarded Suspensionæ¨¡å¼</strong>å’Œ<strong>Balkingæ¨¡å¼</strong>éƒ½å¯ä»¥ç®€å•åœ°ç†è§£ä¸ºâ€œå¤šçº¿ç¨‹ç‰ˆæœ¬çš„ifâ€ï¼Œä½†å®ƒä»¬çš„åŒºåˆ«åœ¨äºå‰è€…ä¼šç­‰å¾…ifæ¡ä»¶å˜ä¸ºçœŸï¼Œè€Œåè€…åˆ™ä¸éœ€è¦ç­‰å¾…ã€‚</p><p>Guarded Suspensionæ¨¡å¼çš„ç»å…¸å®ç°æ˜¯ä½¿ç”¨<strong>ç®¡ç¨‹</strong>ï¼Œå¾ˆå¤šåˆå­¦è€…ä¼šç®€å•åœ°ç”¨çº¿ç¨‹sleepçš„æ–¹å¼å®ç°ï¼Œæ¯”å¦‚<a href=\"https://time.geekbang.org/column/article/94097\">ã€Š31 | Guarded Suspensionæ¨¡å¼ï¼šç­‰å¾…å”¤é†’æœºåˆ¶çš„è§„èŒƒå®ç°ã€‹</a>çš„æ€è€ƒé¢˜å°±æ˜¯ç”¨çº¿ç¨‹sleepæ–¹å¼å®ç°çš„ã€‚ä½†ä¸æ¨èä½ ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œæœ€é‡è¦çš„åŸå› æ˜¯æ€§èƒ½ï¼Œå¦‚æœsleepçš„æ—¶é—´å¤ªé•¿ï¼Œä¼šå½±å“å“åº”æ—¶é—´ï¼›sleepçš„æ—¶é—´å¤ªçŸ­ï¼Œä¼šå¯¼è‡´çº¿ç¨‹é¢‘ç¹åœ°è¢«å”¤é†’ï¼Œæ¶ˆè€—ç³»ç»Ÿèµ„æºã€‚</p><p>åŒæ—¶ï¼Œç¤ºä¾‹ä»£ç çš„å®ç°ä¹Ÿæœ‰é—®é¢˜ï¼šç”±äºobjä¸æ˜¯volatileå˜é‡ï¼Œæ‰€ä»¥å³ä¾¿objè¢«è®¾ç½®äº†æ­£ç¡®çš„å€¼ï¼Œæ‰§è¡Œ <code>while(!p.test(obj))</code> çš„çº¿ç¨‹ä¹Ÿæœ‰å¯èƒ½çœ‹ä¸åˆ°ï¼Œä»è€Œå¯¼è‡´æ›´é•¿æ—¶é—´çš„sleepã€‚</p><pre><code>//è·å–å—ä¿æŠ¤å¯¹è±¡  \nT get(Predicate&lt;T&gt; p) {\n  try {\n    //objçš„å¯è§æ€§æ— æ³•ä¿è¯\n    while(!p.test(obj)){\n      TimeUnit.SECONDS\n        .sleep(timeout);\n    }\n  }catch(InterruptedException e){\n    throw new RuntimeException(e);\n  }\n  //è¿”å›éç©ºçš„å—ä¿æŠ¤å¯¹è±¡\n  return obj;\n}\n//äº‹ä»¶é€šçŸ¥æ–¹æ³•\nvoid onChanged(T obj) {\n  this.obj = obj;\n}\n</code></pre><p>å®ç°Balkingæ¨¡å¼æœ€å®¹æ˜“å¿½è§†çš„å°±æ˜¯<strong>ç«æ€æ¡ä»¶é—®é¢˜</strong>ã€‚æ¯”å¦‚ï¼Œ<a href=\"https://time.geekbang.org/column/article/94604\">ã€Š32 | Balkingæ¨¡å¼ï¼šå†è°ˆçº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼ã€‹</a>çš„æ€è€ƒé¢˜å°±å­˜åœ¨ç«æ€æ¡ä»¶é—®é¢˜ã€‚å› æ­¤ï¼Œåœ¨å¤šçº¿ç¨‹åœºæ™¯ä¸­ä½¿ç”¨ifè¯­å¥æ—¶ï¼Œä¸€å®šè¦å¤šé—®è‡ªå·±ä¸€éï¼šæ˜¯å¦å­˜åœ¨ç«æ€æ¡ä»¶ã€‚</p><pre><code>class Test{\n  volatile boolean inited = false;\n  int count = 0;\n  void init(){\n    //å­˜åœ¨ç«æ€æ¡ä»¶\n    if(inited){\n      return;\n    }\n    //æœ‰å¯èƒ½å¤šä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°è¿™é‡Œ\n    inited = true;\n    //è®¡ç®—countçš„å€¼\n    count = calc();\n  }\n}  \n</code></pre><h2>ä¸‰ç§æœ€ç®€å•çš„åˆ†å·¥æ¨¡å¼</h2><p><strong>Thread-Per-Messageæ¨¡å¼</strong>ã€<strong>Worker Threadæ¨¡å¼</strong>å’Œ<strong>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼</strong>æ˜¯ä¸‰ç§<strong>æœ€ç®€å•å®ç”¨çš„å¤šçº¿ç¨‹åˆ†å·¥æ–¹æ³•</strong>ã€‚è™½è¯´ç®€å•ï¼Œä½†ä¹Ÿè¿˜æ˜¯æœ‰è®¸å¤šç»†èŠ‚éœ€è¦ä½ å¤šåŠ å°å¿ƒå’Œæ³¨æ„ã€‚</p><p>Thread-Per-Messageæ¨¡å¼åœ¨å®ç°çš„æ—¶å€™éœ€è¦æ³¨æ„æ˜¯å¦å­˜åœ¨çº¿ç¨‹çš„é¢‘ç¹åˆ›å»ºã€é”€æ¯ä»¥åŠæ˜¯å¦å¯èƒ½å¯¼è‡´OOMã€‚åœ¨<a href=\"https://time.geekbang.org/column/article/95098\">ã€Š33 | Thread-Per-Messageæ¨¡å¼ï¼šæœ€ç®€å•å®ç”¨çš„åˆ†å·¥æ–¹æ³•ã€‹</a>æ–‡ç« ä¸­ï¼Œæœ€åçš„æ€è€ƒé¢˜å°±æ˜¯å…³äºå¦‚ä½•å¿«é€Ÿè§£å†³OOMé—®é¢˜çš„ã€‚åœ¨é«˜å¹¶å‘åœºæ™¯ä¸­ï¼Œæœ€ç®€å•çš„åŠæ³•å…¶å®æ˜¯<strong>é™æµ</strong>ã€‚å½“ç„¶ï¼Œé™æµæ–¹æ¡ˆä¹Ÿå¹¶ä¸å±€é™äºè§£å†³Thread-Per-Messageæ¨¡å¼ä¸­çš„OOMé—®é¢˜ã€‚</p><p>Worker Threadæ¨¡å¼çš„å®ç°ï¼Œéœ€è¦æ³¨æ„æ½œåœ¨çš„çº¿ç¨‹<strong>æ­»é”é—®é¢˜</strong>ã€‚<a href=\"https://time.geekbang.org/column/article/95525\">ã€Š34 | Worker Threadæ¨¡å¼ï¼šå¦‚ä½•é¿å…é‡å¤åˆ›å»ºçº¿ç¨‹ï¼Ÿã€‹</a>æ€è€ƒé¢˜ä¸­çš„ç¤ºä¾‹ä»£ç å°±å­˜åœ¨çº¿ç¨‹æ­»é”ã€‚æœ‰åå«vectorçš„åŒå­¦å…³äºè¿™é“æ€è€ƒé¢˜çš„ç•™è¨€ï¼Œæˆ‘è§‰å¾—æè¿°å¾—å¾ˆè´´åˆ‡å’Œå½¢è±¡ï¼šâ€œå·¥å‚é‡Œåªæœ‰ä¸€ä¸ªå·¥äººï¼Œä»–çš„å·¥ä½œå°±æ˜¯åŒæ­¥åœ°ç­‰å¾…å·¥å‚é‡Œå…¶ä»–äººç»™ä»–æä¾›ä¸œè¥¿ï¼Œç„¶è€Œå¹¶æ²¡æœ‰å…¶ä»–äººï¼Œä»–å°†ç­‰åˆ°å¤©è’åœ°è€ï¼Œæµ·æ¯çŸ³çƒ‚ï¼â€å› æ­¤ï¼Œå…±äº«çº¿ç¨‹æ± è™½ç„¶èƒ½å¤Ÿæä¾›çº¿ç¨‹æ± çš„ä½¿ç”¨æ•ˆç‡ï¼Œä½†ä¸€å®šè¦ä¿è¯ä¸€ä¸ªå‰æï¼Œé‚£å°±æ˜¯ï¼š<strong>ä»»åŠ¡ä¹‹é—´æ²¡æœ‰ä¾èµ–å…³ç³»</strong>ã€‚</p><pre><code>ExecutorService pool = Executors\n  .newSingleThreadExecutor();\n//æäº¤ä¸»ä»»åŠ¡\npool.submit(() -&gt; {\n  try {\n    //æäº¤å­ä»»åŠ¡å¹¶ç­‰å¾…å…¶å®Œæˆï¼Œ\n    //ä¼šå¯¼è‡´çº¿ç¨‹æ­»é”\n    String qq=pool.submit(()-&gt;&quot;QQ&quot;).get();\n    System.out.println(qq);\n  } catch (Exception e) {\n  }\n});\n</code></pre><p>Javaçº¿ç¨‹æ± æœ¬èº«å°±æ˜¯ä¸€ç§ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼çš„å®ç°ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†åœºæ™¯ä½ éƒ½ä¸éœ€è¦è‡ªå·±å®ç°ï¼Œç›´æ¥ä½¿ç”¨Javaçš„çº¿ç¨‹æ± å°±å¯ä»¥äº†ã€‚ä½†è‹¥èƒ½è‡ªå·±çµæ´»åœ°å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ä¼šæ›´å¥½ï¼Œæ¯”å¦‚å¯ä»¥å®ç°æ‰¹é‡æ‰§è¡Œå’Œåˆ†é˜¶æ®µæäº¤ï¼Œä¸è¿‡è¿™è¿‡ç¨‹ä¸­è¿˜éœ€è¦æ³¨æ„å¦‚ä½•ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹ï¼Œ<a href=\"https://time.geekbang.org/column/article/96168\">ã€Š36 | ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ï¼šç”¨æµæ°´çº¿æ€æƒ³æé«˜æ•ˆç‡ã€‹</a>çš„æ€è€ƒé¢˜å°±æ˜¯å…³äºæ­¤çš„ã€‚</p><p>å¦‚ä½•ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹ï¼Ÿæˆ‘ä»¬åœ¨<a href=\"https://time.geekbang.org/column/article/95847\">ã€Š35 | ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼ï¼šå¦‚ä½•ä¼˜é›…åœ°ç»ˆæ­¢çº¿ç¨‹ï¼Ÿã€‹</a>æœ‰è¿‡è¯¦ç»†ä»‹ç»ï¼Œä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼æ˜¯ä¸€ç§é€šç”¨çš„è§£å†³æ–¹æ¡ˆã€‚ä½†å…¶å®ç»ˆæ­¢ç”Ÿäº§è€…-æ¶ˆè´¹è€…æœåŠ¡è¿˜æœ‰ä¸€ç§æ›´ç®€å•çš„æ–¹æ¡ˆï¼Œå«åš<strong>â€œæ¯’ä¸¸â€å¯¹è±¡</strong>ã€‚<a href=\"time://mall?url=https%3A%2F%2Fh5.youzan.com%2Fv2%2Fgoods%2F2758xqdzr6uuw\">ã€ŠJavaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹</a>ç¬¬7ç« çš„7.2.3èŠ‚å¯¹â€œæ¯’ä¸¸â€å¯¹è±¡æœ‰è¿‡è¯¦ç»†çš„ä»‹ç»ã€‚ç®€å•æ¥è®²ï¼Œâ€œæ¯’ä¸¸â€å¯¹è±¡æ˜¯ç”Ÿäº§è€…ç”Ÿäº§çš„ä¸€æ¡ç‰¹æ®Šä»»åŠ¡ï¼Œç„¶åå½“æ¶ˆè´¹è€…çº¿ç¨‹è¯»åˆ°â€œæ¯’ä¸¸â€å¯¹è±¡æ—¶ï¼Œä¼šç«‹å³ç»ˆæ­¢è‡ªèº«çš„æ‰§è¡Œã€‚</p><p>ä¸‹é¢æ˜¯ç”¨â€œæ¯’ä¸¸â€å¯¹è±¡ç»ˆæ­¢å†™æ—¥å¿—çº¿ç¨‹çš„å…·ä½“å®ç°ï¼Œæ•´ä½“çš„å®ç°è¿‡ç¨‹è¿˜æ˜¯å¾ˆç®€å•çš„ï¼šç±»Loggerä¸­å£°æ˜äº†ä¸€ä¸ªâ€œæ¯’ä¸¸â€å¯¹è±¡poisonPill ï¼Œå½“æ¶ˆè´¹è€…çº¿ç¨‹ä»é˜»å¡é˜Ÿåˆ—bqä¸­å–å‡ºä¸€æ¡LogMsgåï¼Œå…ˆåˆ¤æ–­æ˜¯å¦æ˜¯â€œæ¯’ä¸¸â€å¯¹è±¡ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™break whileå¾ªç¯ï¼Œä»è€Œç»ˆæ­¢è‡ªå·±çš„æ‰§è¡Œã€‚</p><pre><code>class Logger {\n  //ç”¨äºç»ˆæ­¢æ—¥å¿—æ‰§è¡Œçš„â€œæ¯’ä¸¸â€\n  final LogMsg poisonPill = \n    new LogMsg(LEVEL.ERROR, &quot;&quot;);\n  //ä»»åŠ¡é˜Ÿåˆ—  \n  final BlockingQueue&lt;LogMsg&gt; bq\n    = new BlockingQueue&lt;&gt;();\n  //åªéœ€è¦ä¸€ä¸ªçº¿ç¨‹å†™æ—¥å¿—\n  ExecutorService es = \n    Executors.newFixedThreadPool(1);\n  //å¯åŠ¨å†™æ—¥å¿—çº¿ç¨‹\n  void start(){\n    File file=File.createTempFile(\n      &quot;foo&quot;, &quot;.log&quot;);\n    final FileWriter writer=\n      new FileWriter(file);\n    this.es.execute(()-&gt;{\n      try {\n        while (true) {\n          LogMsg log = bq.poll(\n            5, TimeUnit.SECONDS);\n          //å¦‚æœæ˜¯â€œæ¯’ä¸¸â€ï¼Œç»ˆæ­¢æ‰§è¡Œ  \n          if(poisonPill.equals(logMsg)){\n            break;\n          }  \n          //çœç•¥æ‰§è¡Œé€»è¾‘\n        }\n      } catch(Exception e){\n      } finally {\n        try {\n          writer.flush();\n          writer.close();\n        }catch(IOException e){}\n      }\n    });  \n  }\n  //ç»ˆæ­¢å†™æ—¥å¿—çº¿ç¨‹\n  public void stop() {\n    //å°†â€œæ¯’ä¸¸â€å¯¹è±¡åŠ å…¥é˜»å¡é˜Ÿåˆ—\n    bq.add(poisonPill);\n    es.shutdown();\n  }\n}\n</code></pre><h2>æ€»ç»“</h2><p>åˆ°ä»Šå¤©ä¸ºæ­¢ï¼Œâ€œå¹¶å‘è®¾è®¡æ¨¡å¼â€æ¨¡å—å°±å‘Šä¸€æ®µè½äº†ï¼Œå¤šçº¿ç¨‹çš„è®¾è®¡æ¨¡å¼å½“ç„¶ä¸æ­¢æˆ‘ä»¬æåˆ°çš„è¿™9ç§ï¼Œä¸è¿‡è¿™é‡Œæåˆ°çš„è¿™9ç§è®¾è®¡æ¨¡å¼ä¸€å®šæ˜¯æœ€ç®€å•å®ç”¨çš„ã€‚å¦‚æœæ„Ÿå…´è¶£ï¼Œä½ ä¹Ÿå¯ä»¥ç»“åˆã€Šå›¾è§£Javaå¤šçº¿ç¨‹è®¾è®¡æ¨¡å¼ã€‹è¿™æœ¬ä¹¦æ¥æ·±å…¥å­¦ä¹ è¿™ä¸ªæ¨¡å—ï¼Œè¿™æ˜¯ä¸€æœ¬ä¸é”™çš„å¹¶å‘ç¼–ç¨‹å…¥é—¨ä¹¦ç±ï¼Œè™½ç„¶é‡ç‚¹æ˜¯è®²è§£è®¾è®¡æ¨¡å¼ï¼Œä½†æ˜¯ä¹Ÿè¯¦ç»†è®²è§£äº†è®¾è®¡æ¨¡å¼ä¸­æ¶‰åŠåˆ°çš„æ–¹æ–¹é¢é¢çš„åŸºç¡€çŸ¥è¯†ï¼Œè€Œä¸”æ·±å…¥æµ…å‡ºï¼Œéå¸¸æ¨èå…¥é—¨çš„åŒå­¦è®¤çœŸå­¦ä¹ ä¸€ä¸‹ã€‚</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºä¸æˆ‘åˆ†äº«ä½ çš„æƒ³æ³•ï¼Œä¹Ÿæ¬¢è¿ä½ åœ¨ç•™è¨€åŒºè®°å½•ä½ çš„æ€è€ƒè¿‡ç¨‹ã€‚æ„Ÿè°¢é˜…è¯»ï¼Œå¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©çš„è¯ï¼Œä¹Ÿæ¬¢è¿æŠŠå®ƒåˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ã€‚</p><p></p>","comments":[{"had_liked":false,"id":122534,"user_name":"æ‹¯æ•‘åœ°çƒå¥½ç´¯","can_delete":false,"product_type":"c1","uid":1339022,"ip_address":"","ucode":"7643439601EF4C","user_header":"https://static001.geekbang.org/account/avatar/00/14/6e/8e/5d309a85.jpg","comment_is_top":false,"comment_ctime":1565419711,"is_pvip":false,"replies":[{"id":"51085","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1568506744,"ip_address":"","comment_id":122534,"utype":1}],"discussion_count":4,"race_medal":0,"score":"194838948031","product_id":100023901,"comment_content":"å¹¶å‘è®¾è®¡æ¨¡å¼æ˜¯å‰äººåœ¨åšå¹¶å‘ç¼–ç¨‹æ—¶å·²ç»å½’çº³å¥½çš„ï¼Œåœ¨ä¸åŒåœºæ™¯ä¸‹å…·æœ‰å¯è¡Œæ€§çš„è®¾è®¡æ¨¡å¼ï¼Œæˆ‘ä»¬åœ¨è®¾è®¡å¹¶å‘ç¨‹åºæ—¶åº”å½“ä¼˜å…ˆè€ƒè™‘è¿™äº›è®¾è®¡æ¨¡å¼ï¼ˆä»¥åŠè¿™äº›è®¾è®¡æ¨¡å¼çš„ç»„åˆï¼‰ã€‚<br>å¯¹å„ç±»å¹¶å‘è®¾è®¡æ¨¡å¼ï¼Œè€ƒé‡å…¶æ ¸å¿ƒæ€æƒ³ã€æ ¸å¿ƒæŠ€æœ¯ã€trade-offã€é€‚ç”¨åœºæ™¯ã€ä¸å…¶ä»–è®¾è®¡æ¨¡å¼çš„å¯¹æ¯”ç­‰ã€‚<br>é¦–å…ˆï¼Œåº”å½“è€ƒè™‘æ²¡æœ‰å…±äº«çš„æ¨¡å¼ï¼Œè¿™ç±»æ–¹å¼ç”¨ä¸€äº›æŠ€æœ¯æ‰‹æ®µæ¥é¿å…å¹¶å‘ç¼–ç¨‹ä¸­éœ€è¦è€ƒè™‘çš„åŒæ­¥ã€äº’æ–¥ç­‰é—®é¢˜ï¼Œæœ‰äº›æ¨¡å¼çš„å®ç°ä¹Ÿè¢«ç§°ä¸ºæ— é”æœºåˆ¶ï¼Œå…¶ç®€å•ä¸”ä¸æ˜“å‡ºé”™ã€‚<br>Immutabilityæ¨¡å¼å……åˆ†åˆ©ç”¨äº†é¢å‘å¯¹è±¡çš„å°è£…ç‰¹æ€§ï¼Œå°†ç±»çš„mutatorçš„å…¥å£å…¨éƒ¨å–æ¶ˆï¼Œè‡ªèº«çš„çŠ¶æ€ä»…å…è®¸åˆ›å»ºæ—¶è®¾ç½®ã€‚çŠ¶æ€çš„æ”¹å˜é€šå¸¸é€šè¿‡æ–°å»ºä¸€ä¸ªå¯¹è±¡æ¥è¾¾æˆï¼Œä¸ºäº†é¿å…é¢‘ç¹åˆ›å»ºæ–°å¯¹è±¡ï¼Œé€šå¸¸é€šè¿‡äº«å…ƒæ¨¡å¼æˆ–å¯¹è±¡æ± æ¥è§£å†³è¯¥é—®é¢˜ã€‚å› æ­¤ï¼Œå…¶é€‚ç”¨äºå¯¹è±¡çŠ¶æ€è¾ƒå°‘æ”¹å˜æˆ–ä¸å˜çš„åœºæ™¯ï¼Œéœ€è¦å¯¹ä¸€å®šçš„å†…å­˜overheadå¯å®¹å¿ã€‚<br>COWæ¨¡å¼é€šè¿‡å†™æ—¶æ‹·è´çš„æ–¹å¼ä¿è¯è¯»å–æ—¶å€™çš„æ— é˜»å¡åŠå¤šçº¿ç¨‹è¯»å†™æ—¶çš„æ— å…±äº«ï¼Œç”±äºå…¶å†™å…¥æ—¶çš„æ‹·è´æœºåˆ¶å’ŒåŠ é”æœºåˆ¶ï¼ˆJAVAä¸­ï¼‰ï¼Œå› æ­¤ä»…é€‚åˆäºè¯»å¤šå†™éå¸¸å°‘çš„åœºæ™¯ã€‚ç›¸æ¯”äºImmutabilityæ¨¡å¼ï¼ŒCOWå°†å¼•ç”¨æŒ‡å‘æ–°å¯¹è±¡çš„æ“ä½œå°è£…åœ¨äº†å†…éƒ¨ï¼ˆJAVAä¸­ï¼‰æ¥å®ç°ä¸€å®šçš„å¯å˜æ€§ã€‚<br>çº¿ç¨‹æœ¬åœ°å­˜å‚¨æ¨¡å¼åˆ©ç”¨çº¿ç¨‹æœ¬åœ°å­˜å‚¨ç©ºé—´ï¼ˆTLABï¼‰æ¥å­˜å‚¨çº¿ç¨‹çº§åˆ«çš„å¯¹è±¡ä»¥ä¿è¯å„çº¿ç¨‹æ“ä½œå¯¹è±¡çš„éš”ç¦»æ€§ï¼Œä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥ç­‰åŒäºèƒ½å¤Ÿæºå¸¦ä¸Šä¸‹æ–‡ä¿¡æ¯çš„å±€éƒ¨å˜é‡ã€‚JAVAä¸­æ˜¯åœ¨ç”¨æˆ·ç©ºé—´å®ç°çš„ThreadLocalæ§åˆ¶çš„ï¼Œç›®å‰çš„å®ç°å¯ä»¥ä¿è¯mapçš„ç”Ÿå‘½å‘¨æœŸä¸å„Threadç»‘å®šï¼Œä½†Valueéœ€è¦æˆ‘ä»¬æ‰‹åŠ¨removeæ¥é¿å…å†…å­˜æ³„æ¼ã€‚<br>å…¶æ¬¡ï¼Œä»åˆ†å·¥ã€åŒæ­¥ã€äº’æ–¥ä¸‰ä¸ªè§’åº¦æ¥çœ‹å‡ ä¸ªè®¾è®¡æ¨¡å¼ã€‚<br>ä»åˆ†å·¥çš„è§’åº¦çœ‹ï¼Œä»¥ä¸‹ä¸‰ç§æ¨¡å¼åœ¨å¯¹çº¿ç¨‹å·¥ä½œç²’åº¦çš„åˆ’åˆ†ä¸Šé€æ¸å˜ç»†ã€‚<br>Thread-per-messageæ¨¡å¼é€šè¿‡ä¸€æ¶ˆæ¯&#47;è¯·æ±‚ä¸€çº¿ç¨‹çš„æ–¹å¼å¤„ç†æ¶ˆæ¯&#47;è¯·æ±‚ï¼Œè¿™ç§æ¨¡å¼è¦æ±‚çº¿ç¨‹åˆ›å»º&#47;é”€æ¯overheadä½ä¸”çº¿ç¨‹å ç”¨å†…å­˜çš„overheadä¹Ÿä½ï¼Œå› æ­¤åœ¨overheadé«˜æ—¶éœ€è¦ä¿è¯çº¿ç¨‹çš„æ•°é‡ä¸å¤šï¼Œæˆ–è€…é‡‡ç”¨æ›´è½»é‡çº§çš„çº¿ç¨‹ï¼ˆå¦‚åç¨‹ï¼‰æ¥ä¿è¯ã€‚<br>Worker Threadæ¨¡å¼ç›¸å½“äºåœ¨Thread-per-messageæ¨¡å¼çš„åŸºç¡€ä¸Šè®©æ¶ˆæ¯&#47;è¯·æ±‚ä¸threadsçš„å·¥å‚æ‰“äº¤é“ï¼Œåœ¨JAVAä¸­å¯ä»¥ç†è§£ä¸ºçº¿ç¨‹æ± ï¼Œé€šè¿‡å°†åŒç±»æ¶ˆæ¯&#47;è¯·æ±‚èšç±»åˆ°æŸç±»å·¥å‚ï¼ˆä¹Ÿæœ‰å·¥å‚æ¨¡å¼çš„æ„æ€åœ¨ï¼‰æ¥ä¸ºè¿™ç±»æ¶ˆæ¯&#47;è¯·æ±‚æä¾›ç»Ÿä¸€çš„æœåŠ¡ï¼ˆå®šé‡çš„çº¿ç¨‹æ•°ã€ç»Ÿä¸€çš„åˆ›å»ºæ–¹æ³•ã€ç»Ÿä¸€çš„å‡ºé”™å¤„ç†ç­‰ï¼‰ï¼Œå½“ç„¶ï¼Œå®ƒä¾ç„¶æœ‰Thread-per-messageä¸­éœ€è¦æ§åˆ¶çº¿ç¨‹å ç”¨å†…å­˜çš„é—®é¢˜ã€‚<br>ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼åœ¨Woker Threadæ¨¡å¼çš„åŸºç¡€ä¸ŠåŠ å…¥äº†å¯¹æ¶ˆæ¯&#47;è¯·æ±‚çš„æ§åˆ¶ï¼ˆå¤§éƒ¨åˆ†ä½¿ç”¨é˜Ÿåˆ—æ¥æ§åˆ¶ï¼‰ï¼Œå¹¶åˆ’å®šäº†ç”Ÿäº§è€…çº¿ç¨‹å’Œæ¶ˆè´¹è€…çº¿ç¨‹ï¼Œå…¶ä¸­å®ƒä¹ŸåŒ…å«äº†åŒæ­¥å’Œäº’æ–¥çš„è®¾è®¡ï¼Œåœ¨JAVAä¸­çš„çº¿ç¨‹æ± ä¸­ä¹Ÿå¯è§ä¸€æ–‘ã€‚è¿™ç±»è®¾è®¡å¸¸è§äºMQä¸­ã€‚<br>ä»åŒæ­¥å’Œäº’æ–¥çš„è§’åº¦çœ‹ï¼Œå¤šçº¿ç¨‹ç‰ˆæœ¬çš„ifè¢«åˆ’åˆ†ä¸ºäº†ä¸¤ç§æ¨¡å¼ï¼ˆGuarded Suspensionæ¨¡å¼å’ŒBalkingæ¨¡å¼ï¼‰ã€‚<br>Guarded Suspensionæ¨¡å¼æ˜¯ä¼ ç»Ÿçš„ç­‰å¾…-é€šçŸ¥æœºåˆ¶çš„å®ç°ï¼Œéå¸¸æ ‡å‡†åŒ–ï¼ŒJAVAä¸­åˆ™ä¾èµ–ç®¡ç¨‹å®ç°äº†å„ç§å·¥å…·ç±»æ¥ä¿è¯å¤šçº¿ç¨‹ç‰ˆæœ¬ifçš„æ­£ç¡®æ€§ã€‚<br>Balkingæ¨¡å¼ä¾èµ–äºäº’æ–¥ä¿è¯å¤šçº¿ç¨‹ç‰ˆæœ¬ifçš„æ­£ç¡®æ€§ã€‚<br>ä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼åœ¨çº¿ç¨‹ç²’åº¦çš„ç®¡ç†ä¸­é€šè¿‡ä¸­æ–­æ“ä½œå’Œç½®ä½æ ‡è®°æ¥ä¿è¯æ­£å¸¸ç»ˆæ­¢ï¼ŒJAVAä¸­åœ¨çº¿ç¨‹æ± ç²’åº¦çš„ç®¡ç†ä¸­å¯ä»¥é€šè¿‡SHUNDOWNæ–¹æ³•æ¥å¯¹çº¿ç¨‹æ± è¿›è¡Œæ“ä½œï¼Œæºç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®è´¨ä¹Ÿæ˜¯é€šè¿‡ç¬¬ä¸€ç§æ–¹å¼æ¥è¾¾æˆç›®çš„çš„ã€‚<br>","like_count":46,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":462296,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1568506744,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":2845977,"avatar":"https://static001.geekbang.org/account/avatar/00/2b/6d/19/204b0900.jpg","nickname":"Black Jack","note":"","ucode":"CB16C8F44EF422","race_medal":0,"user_type":1,"is_pvip":true},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":530677,"discussion_content":"mark\n","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1637123633,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"user_type\":1}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1542037,"avatar":"https://static001.geekbang.org/account/avatar/00/17/87/95/cba0a896.jpg","nickname":"å¢","note":"","ucode":"B6A9F41AEE348C","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":405617,"discussion_content":"å¤ªå¼ºäº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1634607796,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1264707,"avatar":"https://static001.geekbang.org/account/avatar/00/13/4c/43/150c70c2.jpg","nickname":"é™ˆæ¾Plus","note":"","ucode":"0074BDECFA3D1D","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":349090,"discussion_content":"æ’çœ¼","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1612879649,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":96948,"user_name":"coolrandy","can_delete":false,"product_type":"c1","uid":1022910,"ip_address":"","ucode":"F31620378A0D5C","user_header":"https://static001.geekbang.org/account/avatar/00/0f/9b/be/abb7bfe3.jpg","comment_is_top":false,"comment_ctime":1558545491,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"126112597075","product_id":100023901,"comment_content":"è€å¸ˆå¥½ èƒ½ä¸èƒ½åé¢è®²ä¸€è®²åˆ†å¸ƒå¼é”ç›¸å…³çš„ä¸œè¥¿ï¼Œæ¯”å¦‚å®ç°æ–¹æ¡ˆï¼ŒåŸç†å’Œåœºæ™¯ä¹‹ç±»çš„","like_count":30,"discussions":[{"author":{"id":2756739,"avatar":"https://static001.geekbang.org/account/avatar/00/2a/10/83/0facd0eb.jpg","nickname":"åˆ©å¨å°”å…µé•¿","note":"","ucode":"FDE0BD5BFB1B4A","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":538221,"discussion_content":"ä½ å¯ä»¥çœ‹ä¸€ä¸‹ redisä¸“æ ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1639372394,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":284654,"user_name":"å¼ ç”³å‚²","can_delete":false,"product_type":"c1","uid":1182372,"ip_address":"","ucode":"22D46BC529BA8A","user_header":"https://static001.geekbang.org/account/avatar/00/12/0a/a4/828a431f.jpg","comment_is_top":false,"comment_ctime":1616404210,"is_pvip":true,"discussion_count":0,"race_medal":2,"score":"44566077170","product_id":100023901,"comment_content":"é¿å…å…±äº«ï¼š Immutability æ¨¡å¼ã€Copy-On-Write æ¨¡å¼ã€Thread-Local-Storage æ¨¡å¼<br>é«˜æ•ˆåä½œï¼šGuarded Suspension æ¨¡å¼ã€Balkingæ¨¡å¼<br>åˆç†åˆ†å·¥ï¼šThread-Per-Message æ¨¡å¼ã€Worker Thread æ¨¡å¼ã€ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼<br>ä¼˜é›…å…³é—­ï¼šä¸¤é˜¶æ®µç»ˆæ­¢æ¨¡å¼","like_count":11},{"had_liked":false,"id":97826,"user_name":"é’è²","can_delete":false,"product_type":"c1","uid":1181787,"ip_address":"","ucode":"6BA5D5D47DE38E","user_header":"https://static001.geekbang.org/account/avatar/00/12/08/5b/2a342424.jpg","comment_is_top":false,"comment_ctime":1558787908,"is_pvip":true,"replies":[{"id":"35091","content":"æ²¡æœ‰å¥½çš„åŠæ³•ï¼Œå¯ä»¥é€šè¿‡åˆ†å¸ƒå¼æ¥è§£å†³ï¼ŒæŠŠæœªå¤„ç†çš„ä»»åŠ¡å…ˆæ”¾åˆ°æ•°æ®åº“é‡Œï¼Œå¤„ç†å®Œä»æ•°æ®åº“åˆ é™¤","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1558919369,"ip_address":"","comment_id":97826,"utype":1}],"discussion_count":1,"race_medal":0,"score":"44508460868","product_id":100023901,"comment_content":"è€å¸ˆæƒ³è¯·é—®ä¸‹ï¼Œå¦‚æœjvmæŒ‚äº†ï¼Œæœ‰æ²¡æœ‰å¥½çš„åŠæ³•èƒ½è®°å½•ä¸‹çº¿ç¨‹æ± å½“å‰æœªå¤„ç†çš„ä»»åŠ¡","like_count":11,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451441,"discussion_content":"æ²¡æœ‰å¥½çš„åŠæ³•ï¼Œå¯ä»¥é€šè¿‡åˆ†å¸ƒå¼æ¥è§£å†³ï¼ŒæŠŠæœªå¤„ç†çš„ä»»åŠ¡å…ˆæ”¾åˆ°æ•°æ®åº“é‡Œï¼Œå¤„ç†å®Œä»æ•°æ®åº“åˆ é™¤","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558919369,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":97061,"user_name":"PJ â—•â€¿â—•","can_delete":false,"product_type":"c1","uid":1309333,"ip_address":"","ucode":"6C1179D2B3B7D9","user_header":"https://static001.geekbang.org/account/avatar/00/13/fa/95/44eb9517.jpg","comment_is_top":false,"comment_ctime":1558578865,"is_pvip":false,"replies":[{"id":"34746","content":"æ–¹æ¡ˆå°±æ˜¯åˆ©ç”¨zkï¼Œredisï¼Œdbï¼Œä¹Ÿå¯ä»¥ç”¨atomixè¿™æ ·çš„å·¥å…·ç±»è‡ªå·±åšé›†ç¾¤ç®¡ç†ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šèµ„æ–™ï¼Œæœ€è¿‘å®åœ¨å¤ªå¿™äº†ğŸ˜‚ğŸ˜‚ğŸ˜‚","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1558616393,"ip_address":"","comment_id":97061,"utype":1}],"discussion_count":1,"race_medal":0,"score":"35918317233","product_id":100023901,"comment_content":"è€å¸ˆå¥½ èƒ½ä¸èƒ½åé¢è®²ä¸€è®²åˆ†å¸ƒå¼é”ç›¸å…³çš„ä¸œè¥¿ï¼Œæ¯”å¦‚å®ç°æ–¹æ¡ˆï¼ŒåŸç†å’Œåœºæ™¯ä¹‹ç±»çš„","like_count":9,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451119,"discussion_content":"æ–¹æ¡ˆå°±æ˜¯åˆ©ç”¨zkï¼Œredisï¼Œdbï¼Œä¹Ÿå¯ä»¥ç”¨atomixè¿™æ ·çš„å·¥å…·ç±»è‡ªå·±åšé›†ç¾¤ç®¡ç†ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šèµ„æ–™ï¼Œæœ€è¿‘å®åœ¨å¤ªå¿™äº†ğŸ˜‚ğŸ˜‚ğŸ˜‚","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1558616393,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":221823,"user_name":"kimoti","can_delete":false,"product_type":"c1","uid":1897671,"ip_address":"","ucode":"0A78077408C2B1","user_header":"https://static001.geekbang.org/account/avatar/00/1c/f4/c7/037235c9.jpg","comment_is_top":false,"comment_ctime":1590596609,"is_pvip":false,"discussion_count":1,"race_medal":0,"score":"10180531201","product_id":100023901,"comment_content":"æ¯’ä¸¸æ¨¡å¼å¤ªå½¢è±¡äº†ï¼çº¿ç¨‹åƒåˆ°æ¯’ä¸¸å°±æ­»äº†ã€‚","like_count":3,"discussions":[{"author":{"id":1554995,"avatar":"https://static001.geekbang.org/account/avatar/00/17/ba/33/2d83d174.jpg","nickname":"æ—¶å…‰å®ˆæŠ¤è€…-åŸºå…°","note":"","ucode":"F0B0887B1979D2","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":372696,"discussion_content":"ä½ è¯´åˆ°åƒåˆ°å°±æ­»äº†æ„Ÿè§‰åˆå½¢è±¡äº†","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1620437511,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104015,"user_name":"null","can_delete":false,"product_type":"c1","uid":1024294,"ip_address":"","ucode":"F9039EFED6B55D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","comment_is_top":false,"comment_ctime":1560589861,"is_pvip":false,"replies":[{"id":"37616","content":"ä¸‹æ¬¡è¿è¡Œæ—¶é‡å»ºçº¿ç¨‹æ± ã€‚ä½ å…³é—­çº¿ç¨‹æ± çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1560591518,"ip_address":"","comment_id":104015,"utype":1}],"discussion_count":1,"race_medal":0,"score":"10150524453","product_id":100023901,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼<br>æˆ‘æœ‰ä¸€ä¸ªæ‰¹è·‘ä»»åŠ¡ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨ start() æ–¹æ³•å¯åŠ¨ä»»åŠ¡ï¼Œå½“ä»»åŠ¡è·‘å®Œåï¼Œè°ƒç”¨ stop() æ–¹æ³•ï¼Œæ­£å¸¸é€€å‡ºçº¿ç¨‹æ± ã€‚<br>å½“ä¸‹ä¸€æ¬¡å†è°ƒç”¨ start() æ–¹æ³•å¯åŠ¨ä»»åŠ¡æ—¶ï¼ŒæŠ¥ï¼š<br>java.util.concurrent.RejectedExecutionException: com.xxx.LoggerService$$Lambda$12&#47;690901601@72f8abb rejected from java.util.concurrent.ThreadPoolExecutor@9e8742e[Terminated, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 1] é”™è¯¯ä½ç½®:ThreadPoolExecutor.java:2047<br><br>è¯·é—®è€å¸ˆï¼Œå½“æ¯æ¬¡ä»»åŠ¡è¿è¡Œå®Œæ¯•ä¹‹åï¼Œæˆ‘æƒ³æ­£å¸¸é€€å‡ºçº¿ç¨‹æ± ï¼Œä¹Ÿå¸Œæœ›ä¸‹ä¸€æ¬¡è¿è¡Œæ—¶ï¼Œèƒ½ç»§ç»­æ­£å¸¸è¿è¡Œï¼Œè¯¥å¦‚ä½•åšå‘¢ï¼Ÿ<br>è°¢è°¢è€å¸ˆ<br><br>ä¸‹é¢æ˜¯ demoï¼š<br>@Service<br>public class LoggerService {<br><br>  &#47;&#47; ç”¨äºç»ˆæ­¢æ—¥å¿—æ‰§è¡Œçš„â€œæ¯’ä¸¸â€<br>  final LogMsg poisonPill = new LogMsg(LEVEL.ERROR, &quot;&quot;);<br><br>  &#47;&#47; ä»»åŠ¡é˜Ÿåˆ—<br>  final BlockingQueue&lt;LogMsg&gt; bq = new LinkedBlockingQueue&lt;&gt;();<br><br>  &#47;&#47; åªéœ€è¦ä¸€ä¸ªçº¿ç¨‹å†™æ—¥å¿—<br>  ExecutorService es = Executors.newFixedThreadPool(1);<br><br>  &#47;&#47; å¯åŠ¨å†™æ—¥å¿—çº¿ç¨‹<br>  public void start()  {<br>    System.out.println(&quot;å¯åŠ¨æ—¥å¿—æœåŠ¡&quot;);<br><br>    this.es.execute(() -&gt; {<br>      try {<br>        while (true) {<br>          System.out.println(&quot;è·å–æ—¥å¿—å†…å®¹&quot;);<br>          LogMsg log = bq.poll(5, TimeUnit.SECONDS);<br>          &#47;&#47; å¦‚æœæ˜¯â€œæ¯’ä¸¸â€ï¼Œç»ˆæ­¢æ‰§è¡Œ<br>          if (poisonPill.equals(log)) {<br>              break;<br>          }<br>          &#47;&#47; çœç•¥æ‰§è¡Œé€»è¾‘<br>        }<br>      } catch (Exception e) {<br>      } finally {<br><br>      }<br>    });<br>  }<br><br>  &#47;&#47; ç»ˆæ­¢å†™æ—¥å¿—çº¿ç¨‹<br>  public void stop() {<br>    System.out.println(&quot;å…³é—­æ—¥å¿—æœåŠ¡&quot;);<br>    &#47;&#47; å°†â€œæ¯’ä¸¸â€å¯¹è±¡åŠ å…¥é˜»å¡é˜Ÿåˆ—<br>    bq.add(poisonPill);<br>    es.shutdown();<br>  }<br><br>  &#47;&#47; æ—¥å¿—çº§åˆ«<br>  enum LEVEL {<br>    INFO, ERROR<br>  }<br><br>  class LogMsg {<br>    LEVEL  level;<br>    String msg;<br><br>    &#47;&#47; çœç•¥æ„é€ å‡½æ•°å®ç°<br>    LogMsg(LEVEL lvl, String msg) {<br>    }<br>    &#47;&#47; çœç•¥ toString() å®ç°<br>  }<br><br>}<br>","like_count":3,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454091,"discussion_content":"ä¸‹æ¬¡è¿è¡Œæ—¶é‡å»ºçº¿ç¨‹æ± ã€‚ä½ å…³é—­çº¿ç¨‹æ± çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560591518,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":269428,"user_name":"Monday","can_delete":false,"product_type":"c1","uid":1250907,"ip_address":"","ucode":"77B9BACC783598","user_header":"https://static001.geekbang.org/account/avatar/00/13/16/5b/83a35681.jpg","comment_is_top":false,"comment_ctime":1608642567,"is_pvip":false,"replies":[{"id":"98295","content":"ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1609397073,"ip_address":"","comment_id":269428,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1608642567","product_id":100023901,"comment_content":"è¯´å®è¯è€å¸ˆçš„å­¦ä¹ æ¡†æ¶ï¼Œæ€»ç»“å½’çº³èƒ½åŠ›ä½©æœä½©æœã€‚æ¯ä¸ªå°ç»“éƒ½èƒ½ä¸²æˆä¸²ã€‚<br><br>æ„Ÿè§‰thread-per-messageï¼Œwork-threadæ¨¡å¼éƒ½æ˜¯å±äºç”Ÿäº§-æ¶ˆè´¹è€…æ¨¡å¼ã€‚<br>å‰è€…å±äºä¸é™çº¿ç¨‹ï¼Œä¸é‡å¤åˆ©ç”¨ï¼ˆæœ‰ç‚¹å‹‰å¼ºï¼‰ã€‚<br>åè€…å±äºå•ç”Ÿäº§è€…ï¼Œå¤šæ¶ˆè´¹è€…","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":512270,"discussion_content":"ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½ï¿½","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1609397073,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":258827,"user_name":"å‡ºå–çµé­‚çš„æ•™ç»ƒKerry","can_delete":false,"product_type":"c1","uid":1807943,"ip_address":"","ucode":"8C64517DA556FE","user_header":"https://static001.geekbang.org/account/avatar/00/1b/96/47/93838ff7.jpg","comment_is_top":false,"comment_ctime":1604564376,"is_pvip":true,"discussion_count":0,"race_medal":0,"score":"1604564376","product_id":100023901,"comment_content":"ä¸å¾—ä¸æ„Ÿå¹ï¼Œå¤ªæ£’äº†","like_count":0},{"had_liked":false,"id":153047,"user_name":"aoe","can_delete":false,"product_type":"c1","uid":1121758,"ip_address":"","ucode":"1C6201EDB4E954","user_header":"https://static001.geekbang.org/account/avatar/00/11/1d/de/62bfa83f.jpg","comment_is_top":false,"comment_ctime":1574147627,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1574147627","product_id":100023901,"comment_content":"è€å¸ˆæ¨èçš„ä¹¦éƒ½æŒºå¥½","like_count":0},{"had_liked":false,"id":127122,"user_name":"null","can_delete":false,"product_type":"c1","uid":1024294,"ip_address":"","ucode":"F9039EFED6B55D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","comment_is_top":false,"comment_ctime":1566559835,"is_pvip":false,"replies":[{"id":"47076","content":"ã€ŠJavaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹é‡Œæœ‰è¯¦ç»†çš„ä»‹ç»ï¼Œä½ å¯ä»¥å‚è€ƒä¸€ä¸‹","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1566617479,"ip_address":"","comment_id":127122,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1566559835","product_id":100023901,"comment_content":"è€å¸ˆï¼Œæ‚¨å¥½ï¼<br>æ–‡ç« ç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨æ¯’ä¸¸å¯¹è±¡ç»ˆæ­¢çº¿ç¨‹çš„åœºæ™¯æ˜¯å•çº¿ç¨‹ã€‚<br>å¦‚æœæ˜¯å¤šçº¿ç¨‹çš„æƒ…å†µï¼Œå¦‚ä½•ä¹Ÿè®©å…¶ä½™çº¿ç¨‹ä¼˜é›…é€€å‡ºå‘¢ï¼Ÿ<br>è°¢è°¢è€å¸ˆ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":464329,"discussion_content":"ã€ŠJavaå¹¶å‘ç¼–ç¨‹å®æˆ˜ã€‹é‡Œæœ‰è¯¦ç»†çš„ä»‹ç»ï¼Œä½ å¯ä»¥å‚è€ƒä¸€ä¸‹","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1566617479,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1022091,"avatar":"https://static001.geekbang.org/account/avatar/00/0f/98/8b/7a691d53.jpg","nickname":"HungerW","note":"","ucode":"75689EDF0F8E7F","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":288019,"discussion_content":"åƒåˆ°â€œæ¯’ä¸¸â€çš„çº¿ç¨‹ï¼Œbreak whileå¾ªç¯åå†æŠŠâ€œæ¯’ä¸¸â€ä¸¢å›é˜Ÿåˆ—","likes_number":4,"is_delete":false,"is_hidden":false,"ctime":1593613698,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":112147,"user_name":"å¤šè¥„ä¸¸","can_delete":false,"product_type":"c1","uid":1074310,"ip_address":"","ucode":"1AA1497C5A293C","user_header":"https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg","comment_is_top":false,"comment_ctime":1562674402,"is_pvip":false,"replies":[{"id":"40782","content":"ğŸ˜„","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1562687648,"ip_address":"","comment_id":112147,"utype":1}],"discussion_count":2,"race_medal":0,"score":"1562674402","product_id":100023901,"comment_content":"å–œæ¬¢å®ä»¤è€å¸ˆçš„ä¸“æ ","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":457599,"discussion_content":"ğŸ˜„","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1562687648,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]},{"author":{"id":1360095,"avatar":"https://static001.geekbang.org/account/avatar/00/14/c0/df/d52e7244.jpg","nickname":"èªèªä¸åŒ†åŒ†","note":"","ucode":"86CD1D2D85B8CA","race_medal":0,"user_type":1,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":4707,"discussion_content":"å–œæ¬¢å®ä»¤è€å¸ˆ","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1565679933,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":false,"parent_id":0,"ip_address":""},"score":2,"extra":"","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":104024,"user_name":"null","can_delete":false,"product_type":"c1","uid":1024294,"ip_address":"","ucode":"F9039EFED6B55D","user_header":"http://thirdwx.qlogo.cn/mmopen/vi_32/PiajxSqBRaELZPnUAiajaR5C25EDLWeJURggyiaOP5GGPe2qlwpQcm5e3ybib8OsP4tvddFDLVRSNNGL5I3SFPJHsA/132","comment_is_top":false,"comment_ctime":1560592769,"is_pvip":false,"replies":[{"id":"37655","content":"è¿™ç§æƒ…å†µå¯èƒ½æ²¡å¿…è¦ç”¨çº¿ç¨‹æ± ï¼Œå¦‚æœéœ€è¦ï¼Œå¯ä»¥è®¾ç½®åˆé€‚çš„corepoolsizeå’Œkeepalivetimeï¼Œä¹Ÿå¯ä»¥é‡å»º","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1560649804,"ip_address":"","comment_id":104024,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1560592769","product_id":100023901,"comment_content":"ä½œè€…: ä¸‹æ¬¡è¿è¡Œæ—¶é‡å»ºçº¿ç¨‹æ± ã€‚ä½ å…³é—­çº¿ç¨‹æ± çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ<br><br>è°¢è°¢è€å¸ˆå›å¤ï¼ï¼<br>æ¯å¤©å‡Œæ™¨è·‘ç»“ç®—æ•°æ®ï¼Œæ¯å¤©åªè·‘ä¸€æ¬¡ï¼Œå°±æƒ³ç€è·‘å®Œä»»åŠ¡ä¹‹åï¼Œå…³é—­çº¿ç¨‹æ± ï¼Œè¿™æ ·å°±ä¸ä¼šå†å ç”¨æœåŠ¡å™¨èµ„æºäº†ã€‚","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":454095,"discussion_content":"è¿™ç§æƒ…å†µå¯èƒ½æ²¡å¿…è¦ç”¨çº¿ç¨‹æ± ï¼Œå¦‚æœéœ€è¦ï¼Œå¯ä»¥è®¾ç½®åˆé€‚çš„corepoolsizeå’Œkeepalivetimeï¼Œä¹Ÿå¯ä»¥é‡å»º","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1560649804,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":97251,"user_name":"ç¼ªæ–‡","can_delete":false,"product_type":"c1","uid":1042262,"ip_address":"","ucode":"59603B50EF5FC6","user_header":"https://static001.geekbang.org/account/avatar/00/0f/e7/56/c72997f3.jpg","comment_is_top":false,"comment_ctime":1558620361,"is_pvip":false,"replies":[{"id":"35831","content":"ğŸ‘","user_name":"ä½œè€…å›å¤","user_name_real":"ç‹å®ä»¤","uid":"1269969","ctime":1559304412,"ip_address":"","comment_id":97251,"utype":1}],"discussion_count":1,"race_medal":0,"score":"1558620361","product_id":100023901,"comment_content":"æ¯’ä¸¸å¯¹è±¡ï¼Œæˆ‘ä¹Ÿç”¨è¿‡ï¼Œå°±æ˜¯ä¸€ä¸ªå¯ä»¥é€šè¿‡å¤–éƒ¨æ¥å£æˆ–æ¶ˆæ¯é€šçŸ¥è¿˜å†™çš„beanï¼Œéœ€è¦ç»ˆæ­¢æ—¶è®¾ç½®ä¸ºç»ˆæ­¢çŠ¶æ€ï¼Œä¸ç»ˆæ­¢æ—¶æ˜¯æ­£å¸¸çŠ¶æ€ï¼Œæ¶ˆè´¹çº¿ç¨‹åœ¨è¯»åˆ°ç»ˆæ­¢çŠ¶æ€æ—¶ç›´æ¥è·³è¿‡ä»»åŠ¡æ‰§è¡Œï¼Œçº¿ç¨‹ä¹Ÿå°±å®Œæˆç»ˆæ­¢äº†","like_count":0,"discussions":[{"author":{"id":1269969,"avatar":"https://static001.geekbang.org/account/avatar/00/13/60/d1/8efa89ab.jpg","nickname":"ç‹å®ä»¤","note":"","ucode":"4FE19F5BC32FCA","race_medal":0,"user_type":2,"is_pvip":false},"reply_author":{"id":0,"avatar":"","nickname":"","note":"","ucode":"","race_medal":0,"user_type":1,"is_pvip":false},"discussion":{"id":451193,"discussion_content":"ğŸ‘","likes_number":0,"is_delete":false,"is_hidden":false,"ctime":1559304412,"is_liked":false,"can_delete":false,"is_complain":false,"is_top":true,"parent_id":0,"ip_address":""},"score":2,"extra":"{\"reply\":true,\"user_type\":2}","child_discussion_number":0,"child_discussions":[]}]},{"had_liked":false,"id":97036,"user_name":"å¼ºå“¥","can_delete":false,"product_type":"c1","uid":1206726,"ip_address":"","ucode":"3B8DC780FE4EF9","user_header":"https://static001.geekbang.org/account/avatar/00/12/69/c6/513df085.jpg","comment_is_top":false,"comment_ctime":1558575190,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558575190","product_id":100023901,"comment_content":"å¾ˆæœŸå¾…æ¥ä¸‹æ¥ä¸¤ä¸ªæ¨¡å—çš„æ·±å…¥è®²è§£ï¼","like_count":0},{"had_liked":false,"id":97010,"user_name":"å¼ ä¸‰","can_delete":false,"product_type":"c1","uid":1004092,"ip_address":"","ucode":"1155528FAE1546","user_header":"https://static001.geekbang.org/account/avatar/00/0f/52/3c/d6fcb93a.jpg","comment_is_top":false,"comment_ctime":1558572527,"is_pvip":false,"discussion_count":0,"race_medal":0,"score":"1558572527","product_id":100023901,"comment_content":"æ‰“å¡ï¼","like_count":0}]}